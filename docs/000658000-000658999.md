# StackOverflow 问答 000658000-000658999

# c# - 如何使用按钮单击将文本从文本框中添加到 C# 数据网格

> ID：658001
> 
> 赞同：1
> 
> 时间：2009-03-18T12:13:24.217
> 
> 标签：c#

如何使用按钮单击将文本从文本框中添加到 C# 数据网格

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T12:15:55.757

在按钮的单击事件处理程序中，使用文本框中的内容向数据网格添加一行（假设您要添加一行）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T12:47:35.603

您需要提供更多信息。您是否已经将 DataTable 绑定到 DataGrid？您是否在 DataTable 中创建了列？您确定它实际上不是 DataGridView（DataGrid 的 .net 2.0 + 版本）吗？是 ASP 还是 Winforms？

# c++ - expat 解析器：内存消耗

> ID：658016
> 
> 赞同：0
> 
> 时间：2009-03-18T12:17:04.990
> 
> 标签：c++, xml, large-files, out-of-memory, expat-parser

我正在使用 expat 解析器来解析大约 15 GB 的 XML 文件。问题是它会引发“Out of Memory”错误并且程序 aborts 。

我想知道是否有任何机构面临与 expat 解析器类似的问题，或者它是一个已知的错误并已在以后的版本中得到纠正？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T12:49:28.077

我以前用 expat 来解析大文件，从来没有遇到过任何问题。我假设您使用的是 SAX 而不是 expat DOM 包装器之一。如果您使用的是 DOM，那么这就是您的问题所在 - 它本质上是试图将整个文件加载到内存中。

您是否在解析 XML 时分配对象并且可能不释放它们？那将是我要检查的第一件事。检查问题是否真的出在 expat 的一种方法 - 如果您将程序简化为具有空标记处理程序的简单版本（即它只是解析文件并且对结果不做任何事情），它仍然会耗尽内存吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T12:31:44.843

我根本不认识外籍人士，但我猜它出于某种原因不得不在内存中保存太多状态。XML 是否以某种方式形成错误？您是否为大块的结束标签注册了处理程序？

我在想，如果您为一个大块的末尾注册了一个处理程序，并且 expat 应该将该块传递给该处理程序，那么 expat 可能在它能够完全收集该块之前耗尽内存。正如我所说，我不认识外籍人士，所以这可能是不可能的，我只是在问。

或者，你确定外籍人士是记忆丧失的地方吗？我可以想象这样一种情况，您保留有关 XML 文件内容和您自己的数据结构的一些信息，或者因为数据太大，或者因为代码中的内存泄漏，导致内存不足的情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T13:06:50.267

Expat 是一个事件驱动的解析器，它不构造大型内存结构。因此，问题可能不是 expat（它被广泛用于解析大文件）——更有可能是您自己的代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-20T18:43:33.710

Expat 有泄漏——我已经开始在一个长时间运行的服务器中使用它，并且发现它一直在泄漏内存，无论解析器是否被释放。最新版本的 xmlparse.c 不能解决这个问题，只能隐藏现有的泄漏。

# c - 在 MSVC 2005 中执行 C 代码时出现奇怪的错误

> ID：658024
> 
> 赞同：1
> 
> 时间：2009-03-18T12:18:50.257
> 
> 标签：c, visual-studio-2005

我正面临以下古怪的错误。

我在所有 C 代码的 MSVS2005 中有一个工作区。我已经在一个 C 文件中声明了一个全局变量。（file1.c）该文件具有 main() 函数，在该函数中，我将该变量的值初始化为 0。在其他 C 文件（file2.c）中。从 main 函数调用一个函数（file2.c 中的 func1），该函数将此全局变量的值设置为 1。在 file2.c 中，我将全局变量声明为“extern ..”并访问它。但我注意到的是，在代码执行进入函数 func2 的主函数时刻，我在监视窗口中看到该全局变量本身的地址已更改为完全不同的地址（在监视窗口中，我正在查看 &variable）。结果，当该变量的值设置为 1 时，它会将值 1 写入完全不同的内存地址本身。

解决方法：我在现有的全局结构之一中声明了该变量，然后访问该变量以执行相同的操作；代码按预期工作。

那么，如果在某个 C 文件中将全局变量声明为全局变量，那么导致全局变量地址更改的错误的解释是什么？我在哪个 *.c 文件中声明它以及我使用“extern”访问哪个文件都没有关系，结果是相同的全局变量地址更改和随后的错误操作。没有启用优化选项。

谢谢，

-广告

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T14:31:49.783

只能在没有实际看到代码的情况下猜测，但这里有两种可能性：

1.  全局变量被本地人隐藏在`main()`or中`func2()`（或者可能`func1()`- 问题提到`func1()`但我怀疑这是一个错字 - 这就是剪切和粘贴代码非常重要的原因）；
2.  您错误地将全局变量声明为在 file1.c 中，并且在 file2.c 中`static`的声明中有一个初始化程序。`extern`在声明上有一个初始化器`extern`也会使该声明成为一个定义。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T12:26:21.410

也许尝试将其声明为 volatile （不确定这是否对全局变量有效）并禁用任何编译器优化，以防它以某种方式变得棘手。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T12:35:55.397

如果变量在不同的翻译单元中具有不同的地址，那么您看到的不是一个而是至少两个具有相同名称的变量。

最常见的原因：您可能不小心在堆栈上声明了同名的局部变量。检查您的代码。如果变量真的是全局的，那么如果两个翻译单元包含相同的符号，链接器应该会报错。

如果这没有帮助，并且如果您仍然看到相同符号名称的多个副本，则最好查看映射文件（可以在链接器设置中启用）。

所有外部符号都列在那里，它们的名称、地址和（在您的情况下最重要的）包含它们的目标文件。

映射文件中的地址可能只是偏移量。在这种情况下，针对已知仅存在一次的符号进行所有计算。main() 入口点可能对此有好处。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T12:43:38.747

可能是您的代码中的错字或类似的东西。试试这个工作演示：

文件1.c

```
int variable;
void fun1(int k);

int main()
{
    printf("%d\n", variable);
    fun1(4);
    printf("%d\n", variable);
} 
```

文件2.c

```
extern int variable;

void fun1(int k)
{
    variable = k;
} 
```

输出：

```
0
4 
```

编译：

```
cl.exe file1.c file2.c 
```

# c++ - 将 MFC/ATL 代码转换为 Windows 窗体应用程序

> ID：658026
> 
> 赞同：5
> 
> 时间：2009-03-18T12:18:52.333
> 
> 标签：c++, visual-studio-2008, mfc

我有大量的 MFC/ATL 程序代码，我想在 Windows 窗体应用程序中使用这些代码。什么是“转换”此代码以使其在启用 /clr 的情况下编译并找到基本类（例如 CObject、CString、CFile 和模板）的最简单方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-20T12:15:14.047

不需要做太多的“转换”，您只需启用 /clr 并编译即可。会有构建错误，但不会很大。

这是一个*不*应该掉以轻心的决定。一旦你越过 /clr 门槛，你就会牺牲一些东西：

*   构建性能变得更糟，尤其是链接。您不能增量链接 C++ /clr 项目。

*   额外的加载层被添加到您的 .Exe 或 .Dll 中。你必须小心初始化的顺序，尤其是静态的。使用 VS2005 时情况会好很多，但还是有一些小问题。我有一个无法正确卸载的 /clr DLL 项目，我无法弄清楚原因。此类问题的一个症状是您没有从调试中退出内存泄漏检测转储。

*   当您向项目添加功能时，您可以选择托管或本机实现。如果您选择对项目其他地方本地完成的事情进行管理，您必须选择，我是否要修改旧的实现？

*   跨越托管本机阈值会影响性能和调试。

*   异常处理变得更加复杂。

我推荐一种更有针对性的方法，而不是在整个项目上翻转 /clr 开关。让您的大型图书馆保持原生。创建混合模式 /clr bootstrapper / wrapper。这种“瘦代理”提供了访问本机库的好处，同时保持本机库的稳定性和性能。

如果您的本地库中有对话框（或者更糟的是 SDI/MDI 视图，请参见[此处](http://www.codeproject.com/KB/miscctrl/HostMFC.aspx)），则连接显示器可能会很棘手。但这将是值得的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T21:32:53.130

VC++.net，如果我没记错的话，有一个新版本的 MFC。将项目转换为 VC.net 项目，然后慢慢将类转换为托管代码。这使您可以慢慢地重新设计所有内容，而不是重新编写所有内容的巨大跳跃。顺便说一句，如果您还没有使用 MVC 设计模式将接口与内部工作分开。

# c# - 用脸书登出

> ID：658027
> 
> 赞同：8
> 
> 时间：2009-03-18T12:19:00.523
> 
> 标签：c#, .net, facebook

如何在不使用 fb-login 按钮的情况下从我的 facebook connect 网站注销用户？我想从代码隐藏（c#）中做到这一点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-18T12:44:51.973

我发现只有一个选项可以通过 Javascript 从`FB.logout()`. 似乎有点奇怪，没有来自代码隐藏的 API 来做同样的事情。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-01-06T23:32:55.383

如果你只想要一个简单的链接来注销用户，你可以形成一个这样的 url：

`https://www.facebook.com/logout.php?access_token=ACCESS_TOKEN&confirm=1&next=REDIRECT`

只需将`ACCESS_TOKEN`and替换`REDIRECT`为适当的值。Facebook 时不时地改变这一点，所以你必须注意这一点。这仅适用于浏览器，但这样做的好处是用户不必等待 JavaScript 库加载。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-08-18T13:22:32.957

您可以通过 facebook.API 类 (facebook.dll) 的实例轻松完成此操作。只需调用 _api.LogOff()

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-12-20T21:20:46.213

我的痛苦经历告诉我你必须有回报（假）；在 FB.Connect.logout() 之后；像这样打电话：

FB.Connect.logout(doOnUserLogout()); 返回（假）；

否则，它看起来像是正在注销，模式对话框说明了这一点，但它不会将用户注销。

我偶然发现了这一点，因为它再次没有记录在案。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-06-14T12:57:16.453

似乎 ConnectSession 在注销方法中没有任何代码。只是

```
void Logout(){ } 
```

没有任何东西。同样的`Login(){}`

所以基本上你需要使用 java-script 版本

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-11-18T14:45:19.387

curl 和类似 preg_match("/a href=\"\/logout.php(.*?)\"/", $page, $logout_param);

然后...

curl_setopt($ch, CURLOPT_URL, 'http://m.facebook.com/logout.php' . $logout_param[1]); curl_exec($ch);

??

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-19T14:46:08.303

至少在 php api 中有一个注销方法。为了使其正常工作，注销方法将用户重定向到 facebook.com 中的 url，然后将您重定向回您的站点

$facebook->注销（“ [http://site.com/returnAfterLogout.php](http://site.com/returnAfterLogout.php) ”）

但是我发现在该请求中，javascript api 仍然认为 php api 仍然认为他已登录，并且在您尝试执行 api 请求之前它会引发异常。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-08-22T09:07:25.907

我在 Webview 中使用：

```
 webview.loadUrl("http://www.facebook.com/logout.php?confirm=1"); 
```

# php - PHP中的输出缓冲？

> ID：658040
> 
> 赞同：2
> 
> 时间：2009-03-18T12:23:06.050
> 
> 标签：php, output-buffering

我似乎对 PHP 输出缓冲感到困惑。我有这样的代码：

```
function return_json($obj) {
  ob_get_clean();
  ob_start();
  header("Content-Type: application/json");
  echo json_encode($obj);
  exit;
} 
```

但它似乎不喜欢 ob_get_clean()。我这样做是因为一些 HTML 可能会在它到达那个点之前意外生成，但我认为这就是你应该这样做的方式。

我错过了什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-18T12:25:29.960

要使用 ob_get_clean ()，您必须确定，在某个时间点您早前已经使用了 ob_start ()。否则，没有要清理的缓冲区，所有内容都已刷新到用户代理。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-18T12:34:38.987

使用该[`ob_get_level()`函数](http://docs.php.net/ob_get_level)查看输出缓冲区是否处于活动状态并退出它：

```
while (ob_get_level()) {
    ob_end_clean();
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-18T12:25:18.400

在调用该函数之前，您必须在所有代码之前执行 ob_start 以捕获任何输出

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T12:27:11.313

如果您只想在开始输出缓冲后清理缓冲区

```
ob_start() 
```

采用

```
ob_clean() 
```

另请注意，没有任何内容已被 echo、print_r 等函数刷新。所以脚本中的第一件事应该是 ob_start()。确保您的包含尚未向浏览器发送内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T12:29:20.153

需要在生成任何内容之前调用 ob_start。正常用法是这样的：

```
ob_start();
# generated content here

$content = ob_get_contents(); # $content now contains anything that has been output already
ob_end_clean();

# generate any headers you need
echo $content; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T13:13:32.263

如果您遇到的问题是什么都不会输出，那么您似乎错过了 flush 方法？此外，ob_end_clean() 只能在输出缓冲开始后调用，否则返回“false”。您不能使用 ob_ 方法来清理已经发布的任何现有标头，您需要自己确保这一点。

```
function return_json($obj) {
  ob_start();
  header("Content-Type: application/json");
  echo json_encode($obj);
  ob_end_flush();
  exit;
} 
```

# html - HTML/XHTML 中的勾号

> ID：658044
> 
> 赞同：287
> 
> 时间：2009-03-18T12:25:35.530
> 
> 标签：html, xhtml

我们需要在内部 Web 应用程序中显示一个[勾号（✓ 或 ✔），并且最好避免使用图像。](http://en.wikipedia.org/wiki/Tick_(checkmark))

必须在 XP 机器上从 IE 6.0.2900 开始工作，理想情况下我们需要它是跨浏览器（IE + FF 的最新版本）。

以下显示框虽然将浏览器编码设置为 UTF-8（META 工作得很好，但不是问题）。默认字体是 Times New Roman（可能是个问题，但尝试 Lucida Sans Unicode 并没有帮助，而且我既没有安装 Arial Unicode MS，也没有安装 Lucida Grande）。

```
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
</head>
<body>
 &#10003; &#10004;
</body>
</html> 
```

任何帮助表示赞赏。

* * *

以下在 IE 6.0 和 IE 7 下工作：

```
<html>
<head>

</head>
<body>
 <span style="font-family: wingdings; font-size: 200%;">&#252;</span>
</body>
</html> 
```

如果有人可以在 Windows 上检查 FF，我将不胜感激。我很确定它不会在非 Windows 机器上工作。

* * *

## 回答 #1

> 赞同：465
> 
> 时间：2009-03-18T12:30:14.270

我认为您使用的是支持较少的 Unicode 值，这些值并不总是具有所有代码点的字形。
尝试以下字符：

*   ☐（ Unicode 十六进制中的[0x2610](http://www.unicodemap.org/details/0x2610/index.html) [HTML 十进制：`&#9744;`]）：一个空的（未选中）复选框
*   ☑ ( [0x2611](http://www.unicodemap.org/details/0x2611/index.html) [HTML decimal: `&#9745;`]): 前一个复选框的勾选版本
*   ✓ ( [0x2713](http://www.unicodemap.org/details/0x2713/index.html) [HTML 十进制: `&#10003;`])
*   ✔ ( [0x2714](http://www.unicodemap.org/details/0x2714/index.html) [HTML 十进制: `&#10004;`])

**编辑：**这里的第一个符号 ☐ / 0x2610 似乎有些混淆。这是一个空的（未选中的）复选框，所以如果您看到一个框，这就是它应该的样子。它是 ☑ / 0x2611 的对应项，即检查版本。

* * *

## 回答 #2

> 赞同：282
> 
> 时间：2013-08-18T00:49:51.333

首先，您应该意识到您实际上并不需要使用 HTML 实体——只要您的 HTML 文档的编码被正确声明为 UTF-8，您就可以简单地将这些符号复制/粘贴到您的文件/服务器端脚本/ JavaScript/不管。

话虽如此，以下是与该主题相关**的所有相关 UTF-8 字符/HTML 实体的详尽列表：**

*   ☐ (hex: `&#x2610;`/ dec: `&#9744;`): 投票箱（空的，应该是这样的）
*   ☑ (hex: `&#x2611;`/ dec: `&#9745;`): 带支票的投票箱
*   ☒ (hex: `&#x2612;`/ dec: `&#9746;`): 带 x 的投票箱
*   ✓ (hex: `&#x2713;`/ dec: `&#10003;`): 复选标记，相当于`&checkmark;`和`&check;`在[大多数浏览器中](http://code.google.com/p/doctype-mirror/wiki/CheckCharacterEntity)
*   ✔（十六进制：`&#x2714;`/十进制：）：重复选`&#10004;`标记
*   ✗ (hex: `&#x2717;`/ dec: `&#10007;`): 选票 x
*   ✘ (hex: `&#x2718;`/ dec: `&#10008;`): 重选票 x
*   (⚠ hex: `&#x1F5F8;`/ dec `&#128504;`): 浅复选标记 (自 2017 年起支持不佳)
*   ✅ (⚠ hex: `&#x2705;`/ dec: `&#9989;`)：白色重复选标记（截至 2017 年混合支持）
*   （⚠ hex: `&#x1F5F4;`/ dec: `&#128500;`）：选票脚本 X（截至 2017 年支持不佳）
*   (⚠ hex: `&#x1F5F6;`/ dec: `&#128502;`)：选票粗体字 X（截至 2017 年支持不佳）
*   ⮽ (⚠ hex: `&#x2BBD;`/ dec: `&#11197;`)：带灯 X 的投票箱（截至 2017 年支持不佳）
*   (⚠ hex: `&#x1F5F5;`/ dec: `&#128501;`)：带有脚本 X 的投票箱（截至 2017 年支持不佳）
*   (⚠ hex: `&#x1F5F9;`/ dec: `&#128505;`)：带粗体检查的投票箱（截至 2017 年支持不佳）
*   （⚠ hex: `&#x1F5F7;`/ dec: `&#128503;`）：带有粗体脚本 X 的投票箱（截至 2017 年支持不佳）

检查网络字体的刻度符号？以下是更常见的现成示例：`A☐B☑C☒D✓E✔F✗G✘H`- 只需将其复制/粘贴到您的 webfont 提供商的示例文本框中，然后查看哪些字体支持哪些刻度符号。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-03-18T12:30:26.830

客户端计算机需要一个适当的字体，该字体具有该字符的字形才能显示它。但时代新罗马没有。改用*Arial Unicode MS*或*Lucida Grande*：

```
<span style="font-family: Arial Unicode MS, Lucida Grande">
    &#10003; &#10004;
</span> 
```

这适用于我在 IE 5.5、IE 6.0、FF 3.0.6 中的 Windows XP 上。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2014-06-12T10:00:50.403

我通常使用 fontawesome 字体（[http://fontawesome.io/icon/check/](http://fontawesome.io/icon/check/)），您可以在 html 文件中使用它：

```
 <i class="fa fa-check"></i> 
```

或在 CSS 中：

```
content: "\f00c";
font-family: FontAwesome; 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-03-18T14:33:45.003

为什么不在只读模式下使用 HTML 输入复选框元素

```
<input type="checkbox" disabled="disabled" /> and
<input type="checkbox" checked="checked" disabled="disabled" /> 
```

我认为这将适用于所有浏览器。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2013-09-28T19:36:16.270

我遇到了同样的问题，但没有任何建议有效（Windows XP 上的 Firefox）。

所以我找到了一个可能的[解决方法](https://stackoverflow.com/a/3664495/1066234)，使用图像数据显示一个小复选标记：

```
span:before {
    content:url("data:image/gif;base64,R0lGODlhCgAKAJEAAAAAAP///////wAAACH5BAEAAAIALAAAAAAKAAoAAAISlG8AeMq5nnsiSlsjzmpzmj0FADs=");
} 
```

当然，您可以创建自己的复选标记图像并使用转换器将其添加为 data:image/gif。希望这可以帮助。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2013-05-23T14:53:56.087

参加聚会很晚，我发现`&check;`(✓) 在 Opera 工作。我没有在任何其他浏览器上测试过它，但它可能对某些人有用。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-03-18T14:16:46.993

> although sets browser encoding to UTF-8

(If you're using numeric character references of course it doesn't matter what encoding is being used, browsers will get the correct Unicode codepoint directly from the number.)

```
<span style="font-family: wingdings; font-size: 200%;">&#252;</span> 
```

> I would appreciate if someone could check under FF on Windows. I am pretty sure it won't work on a non Windows box.

Fails for me in Firefox 3, Opera, and Safari. Curiously, works in the other Webkit browser, Chrome. Also fails on Linux (obviously, as Wingdings isn't installed there; it is installed on Macs, but that doesn't help you if Safari's not having it).

Also it's a pretty nasty hack — that character is to all intents and purposes “ü” and will appear that way to things like search engines, or if the text is copy-and-pasted. Proper Unicode code points are the way to go unless you really have no alternative.

The problem is that no font bundled with Windows supplies U+2713 CHECK MARK (‘✓’). The only one that you're at all likely to find on a Windows machine is “Arial Unicode MS”, which is not really to be relied upon. So in the end I think you'll have to either:

*   use a different character which is better supported (eg. ‘●’ — [bullet](http://en.wikipedia.org/wiki/Bullet_(typography)), as used by SO), or
*   use an image, with ‘✓’ as the alt text.

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-03-18T13:31:32.110

√（平方根符号，√）就足够了吗？

或者，确保在将数据发送到浏览器**之前**`Content-Type:`设置标题。仅仅指定内容类型标签可能不足以鼓励浏览器使用正确的字符集。**`<meta>`**

 *** * *

## 回答 #10

> 赞同：5
> 
> 时间：2013-09-25T09:29:29.957

```
.className {
   content: '\&#x2713';
} 
```

使用 CSS content 属性，您可以显示带有图像或其他代码设计的刻度。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2015-01-28T10:46:43.707

使用 Windows 默认字体的解决方案`Wingdings`；它不是`unicode`基于并且在 Linux 中不起作用（除非已安装）：

```
Crossed Checkbox
<div style="font-family: Wingdings;">û</div> ☒

Checked Checkbox
<div style="font-family: Wingdings;">ü</div> ☑

Cross
<div style="font-family: Wingdings;">ý</div> ✗

Check
<div style="font-family: Wingdings;">þ</div> ✓ 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-05-14T23:28:00.590

使用*WebDing*或*WingDing*字体是实现本主题目标的唯一方法：**它必须从 IE 6.0.2900 开始工作**。因此，我会在此处发布一些内容，并对上面发布的内容进行一些更正：

```
Cross
<span style="font-family: Wingdings;">&#251;</span><br>

Check
<span style="font-family: Wingdings;">&#252;</span><br>

Crossed Checkbox
<span style="font-family: Wingdings;">&#253;</span><br>

Checked Checkbox
<span style="font-family: Wingdings;">&#254;</span><br>

Empty Checkbox
<span style="font-family: Wingdings;">&#168;</span><br>

Thick Check
<span style="font-family: Webdings;">&#97;</span><br>

Friendly asked in comments
<div style="display: inline; font-family: Wingdings; font-size: 15px; background-color: lightblue; border: 2px solid black; padding: 1px 4px 0 2px;">&#252;</div>
```

参考这里： [wingdings](http://www.alanwood.net/demos/wingdings.html) [webdings](http://www.alanwood.net/demos/webdings.html)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-18T12:31:24.830

你可以使用⊕或⊗

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-06-02T01:48:07.597

您可以添加一个带有 Base64 编码 GIF 的小白色（[此处为在线生成器](https://www.base64-image.de/)）：

```
url("data:image/gif;base64,R0lGODlhCwAKAIABAP////3cnSH5BAEKAAEALAAAAAALAAoAAAIUjH+AC73WHIsw0UCjglraO20PNhYAOw==") 
```

例如，对于 Chrome，我使用它来设置复选框控件的样式：

```
INPUT[type=checkbox]:focus
{
outline:1px solid rgba(0,0,0,0.2);
}

INPUT[type=checkbox]
{
background-color: #DDD;
border-radius: 2px;
-webkit-appearance: button;
width: 17px;
height: 17px;
margin-top: 1px;
cursor:pointer;
}

INPUT[type=checkbox]:checked
{
background:#409fd6 url("data:image/gif;base64,R0lGODlhCwAKAIABAP////3cnSH5BAEKAAEALAAAAAALAAoAAAIUjH+AC73WHIsw0UCjglraO20PNhYAOw==") 3px 3px no-repeat;
} 
```

如果您只是想在 IMG 标签中使用它，您可以将复选标记/勾选标记为：

```
<img alt="" src="data:image/gif;base64,R0lGODlhCwAKAIABAP////3cnSH5BAEKAAEALAAAAAALAAoAAAIUjH+AC73WHIsw0UCjglraO20PNhYAOw==" width="11" height="10"> 
```

# wpf - 在 MyUserControl.xaml 中以声明方式设置 MyUserControl 的属性

> ID：658045
> 
> 赞同：3
> 
> 时间：2009-03-18T12:25:38.447
> 
> 标签：wpf, xaml, user-controls

假设我们有这样的控制：

```
public partial class MyUserControl : UserControl
{
    public MyUserControl() {
        InitializeComponent();
    }

    public string Foo { get; set; }
} 
```

如何在 MyUserControl.xaml 中以声明方式设置“Foo”属性值？

```
<UserControl x:Class="Test.MyUserControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <!-- Looking for some thing like this -->
    <Foo>Hola</Foo>

</UserControl> 
```

更清楚一点：如何在 XAML 中为代码隐藏中定义的属性设置值。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-08T03:59:20.180

我过去发现，您可以使用样式从 xaml 设置 UserControl 上的属性，而无需继承。尝试这样的事情：

```
<UserControl x:Class="Test.MyUserControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:c="clr-namespace:Test.MyUserControl" >

    <UserControl.Style>
        <Style>
            <Setter Property="c:MyUserControl.Foo" Value="Hola" />
        </Style>
    </UserControl.Style>

</UserControl> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T12:47:41.903

在您的控件中将其设置在构造函数中

```
public MyUserControl{ this.Foo = "Hola";} 
```

如果您在其他地方使用该控件：

```
<Window xmlns:mycontrol="Test"     .... 
```

Intellisense 将帮助您使用正确的 xmlns 语法

```
<mycontrol:MyUserControl       Foo="Hola"/> 
```

我不确定，但 Foo 可能需要成为 DependencyProperty。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T10:11:08.993

这只能通过继承在 xaml 中实现：

您正在为您的控件提供实现。因此，在 xaml 中为您的控件实现值的唯一方法是通过继承。

您的第二个 UserControl 将如下所示：

```
<Test:MyUserControl x:Class="Test.MyUserControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:Test="clr-namespace:Test"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Test:MyUserControl.Foo>Hola</Test:MyUserControl.Foo>

</Test:MyUserControl> 
```

或者：

```
<Test:MyUserControl x:Class="Test.MyUserControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:Test="clr-namespace:Test"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Foo="Hola">

</Test:MyUserControl> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T17:37:35.700

看起来您真正想要的是`UserControl`. 不幸的是，您不能将其设置为 a `Style`，除非它是 a `DependencyProperty`。它也不能成为 a 的目标`Binding`。

如果`Foo`是 a `DependencyProperty`，您可以在[`PropertyMetadata`](http://msdn.microsoft.com/en-us/library/system.windows.propertymetadata.aspx)声明时将其设置为`DependencyProperty`：

```
public static readonly DependencyProperty FooProperty = DependencyProperty.Register("Foo", typeof(String), typeof(MyUserControl), new PropertyMetadata("Hola")); 
```

否则，您最好在代码隐藏中设置默认值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-16T02:53:16.473

非字符串属性怎么样。例如 MyCustomObject=

# php - 如何防止 PHP 源代码被转售？

> ID：658052
> 
> 赞同：2
> 
> 时间：2009-03-18T12:28:03.293
> 
> 标签：php, licensing, protection

你有这方面的策略吗？如果我将网络系统卖给客户，并且按照法律协议，客户不允许将其卖给其他人，我怎么能确定他无论如何都不会这样做？

我的第一个想法是某种必须在根目录中的密钥，并且该文件仅对该特定域有效。

其他想法？

**更新 1** 我同意这主要是一个法律问题。但事实是：我有一个客户从我这里购买了这个系统，然后再卖给其他人。他希望这个系统能够正常运行，这样他就可以轻松获利。打包和销售 Web 服务器的能力是规范的一部分。

**UPDATE 2** 另一种观点是[这样](https://stackoverflow.com/questions/658052/how-to-prevent-resale-of-php-source/658130#658130)的。在那种情况下，很难证明有多少转售的软件来自我原来的系统。

**更新 3** 混淆对我来说不是一个选择，真的很讨厌它。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-18T12:35:16.567

有些人使用[Zend Guard](http://www.zend.com/en/products/guard/)之类的混淆器，但老实说，我认为此类问题的技术解决方案就像 DRM 用于音频和视频内容一样注定失败。从根本上说，你给他们的东西是为了工作，所以让它以你不想要的方式工作只是一个技术问题。

您在这里的追索权是（恕我直言）合法而非技术性的。您与客户签订了一份合同，其中列出了他们能做什么和不能做什么。你有一位优秀的律师起草该合同。如果他们不遵守它，那么您几乎必须将他们告上法庭。

不要指望任何形式的混淆或复制保护作为任何形式的保证。

这对于脚本语言来说尤其是一个问题，因为（尽管有 Zend），它们基本上是纯文本分发方法。Java 和 .Net 以及其他字节码编译语言有更多的保护，但它们也可以被反汇编成中间代码（但混淆在这里更有用）。真正编译的语言（例如 c、C++）具有最大的保护，因为将 50 meg 的二进制文件反汇编成汇编代码通常没有多大用处。

即便如此，也没有任何保证。如果您对此不满意，那么您需要仔细选择您的客户，忍受潜在的违约行为（以及可能迫使您追求的可能执行）或寻找另一份工作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-18T13:33:24.447

我认为唯一可以确定的方法是将您的产品作为托管解决方案提供，这样客户就永远无法访问代码。如果您带着这个目标来构建它，您仍然可以拥有经销商并让他们为系统蒙皮，使其看起来像他们自己的产品。

这在我工作的地方效果很好，理论上客户可以许可代码在他们自己的基础设施上运行，但它的定价水平只有大公司愿意支付，而且大公司总体上更关心法律细节所以不太可能只是跑掉你的工作。

如果价格合适，人们很乐意使用托管解决方案，并且它可以为每个人带来好处。客户不必担心设置所有内容，他们也可以安全地知道，如果某些东西确实需要调整，我们（开发人员）会在那里做。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-18T12:33:20.393

这是一个社会问题，而不是技术问题。您有版权法；不再需要了。（任何和所有的技术解决方案都相当于 DRM，这本质上是无效的。）

关于你的更新：所以基本上你成为你这个客户的 DRM 供应商。那么：*客户*是否了解 DRM 无效？在浪费时间实施之前尝试教育他们。
如果客户仍然坚持，我会仔细研究当前 DRM 供应商在做什么。例如，大量的挥手，一些混淆，以及，呃......我不知道......他们还能做什么？无论哪种方式，您都可以确定您实施的任何解决方案将在不到您实施它的时间的 10% 内被撤消 - 所以花尽可能短的时间来解决这个问题。（在它被编辑之前，你写了“它在规范中”关于“确保系统没有出售”：这可能意味着你**当然**），并且需要您花费无限的时间来构建接近的东西...）

您可能会调查让应用程序在首次运行时联系某个中央注册表（使用嵌入式指纹，每次销售都不同，因此您知道谁传递了他们的代码）。这样，您的客户就可以找到应用程序正在运行的位置，并有机会联系未经许可使用它的人。（有可能将他们变成新的付费客户。）也许让中央存储库能够发回终止信号？但这*真的很*可怕，而且责任问题会很大。尽可能避免。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-18T13:16:43.410

以我的经验，混淆来源比它的价值更麻烦，除非你试图保守一些复杂的算法秘密。

我建议执行以下操作：

1.  确保您和您的客户以及您的律师都理解并同意您的合同。
2.  在每个源文件中插入简短的版权声明作为注释。
3.  将版权声明作为 HTML 注释插入生成的网页（通过页面模板或 php 代码），因此“查看源代码”将证明您的代码在未经许可的应用程序中。

如果您真的很担心，并且这不是一个仅限 Intranet 的应用程序，您可以扩展 (3) 并将唯一的隐藏文本插入到 Google 可以看到但用户看不到的页面中。

这些都不会阻止一个坚定的小偷，但将有助于阻止和发现“意外”盗窃。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-18T12:33:31.407

禁止转售软件的正确方法是通过法律限制，而不是技术限制。让您的客户签署一份他们同意不转售的合同。

技术预防措施普遍使产品变得更糟，在技术意义上也是如此，这降低了对客户的价值。技术保护越强，滋扰越大。

例如，假设客户合法地想要更改其域名。他们应该购买新副本吗？我想不是。如果您告诉他们如何更改密钥文件以匹配他们的新域，他们就可以使用该信息使他们能够转售。但是，无论他们想出什么技术技巧，法律保护都适用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-18T12:48:26.833

但一个问题是，当您不害怕客户转售您所做的事情时，开箱即用，律师可以跟踪。问题可能是客户正在重构它。我的意思是花我*很多*小时的工作，改变一些东西，把它称为他的……以更便宜的价格卖掉它，赢得生意……

这就是为什么我正在寻找技术解决方案来保护我的工作。它还可能帮助我将来自律师的发票保持在最低限度，这对于让他/她保护我的工作来说是一个很大的变化。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-18T12:54:40.047

> > 我怎么能确定他不会那样做呢？

你无法阻止它......期间。如果任何人有消息来源，就没有办法阻止他们……如果他们这样做了，你只能诉诸惩罚他们。

也许您的合同，除了禁止他们转售之外，还有与他们转售相关的价格，即您通常支付的价格的 10 倍或 20 倍，加上法律费用（如果需要让他们付款）......这样，如果他们无论如何都选择这样做，你有一张漂亮的纸，上面有他们的签名，上面已经有一个很好的脂肪预先商定的价格，如果他们继续出售它，他们需要支付。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-18T14:39:28.767

我还没有看到提到 Ioncube，所以想知道是否有理由不使用它？

是的，设置需要花钱，是的，它需要安装服务器端库（我敢说现在大多数主机都已经在运行），但它确实允许域限制以及基于时间的限制。

也许您甚至可以将它与 PHPAudit 结合使用？

# java - Java 中的 Graphics.drawImage() 在某些计算机上非常慢，但在其他计算机上却快得多

> ID：658059
> 
> 赞同：16
> 
> 时间：2009-03-18T12:31:09.573
> 
> 标签：java, graphics

我有一个奇怪的问题，基本上在 Java Graphics.drawImage() 在某些计算机上非常慢，而在其他计算机上则更快。这也与计算机的能力无关，一些较弱的计算机运行良好，而一些较强的计算机似乎在 drawImage 调用中窒息。

它可能与宽度和高度有关，也可能无关，我定义了一个非常非常大的宽度和高度（类似于 5000 x 2500）。我认为这不是问题，除非我说它在某些计算机上以实时速度运行，而在其他计算机上运行速度较慢，并且似乎与计算机的相对功率无关。

两台计算机都有相同版本的 Java，都使用 Vista。一个有 1.83ghz Core 2 Duo，1gb RAM 和板载图形（运行一切正常），另一个有 2.53ghz core 2 duo，9600GS（最新的 nVidia 驱动程序）和 4gb 内存，它在 drawImage 调用中确实会突突突突。

有任何想法吗？

编辑：好的，这真的很奇怪，我正在将图像绘制到 Swing 中的窗口，现在当我调整窗口大小并使其非常小时，图像也会按比例缩小并变小。突然间一切都运行得很顺利，当我把它放大到它仍然运行顺利之前的大小时！

它也有多个监视器问题，如果我使用调整大小技巧使其在一个监视器上运行得更快，然后当超过一半的窗口在新监视器中时将其滚动到另一台监视器，它会再次开始跳动。我必须再次将窗口大小调整为小然后恢复到其原始大小以恢复速度。

如果我在一台显示器上进行调整大小技巧，将其移到另一台显示器上，它当然会突突，但如果我将它返回到我进行调整大小技巧的原始显示器，它可以 100% 工作

如果我打开了两个摆动窗口（显示相同的图像），它们都运行缓慢，但如果我在一个窗口上执行调整大小的技巧，它们都开始平稳运行（但情况并非总是如此）。

*当我说调整窗口大小时，我的意思是使其尽可能小到实际无法看到图像的程度。

这可能是Java中的错误吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-18T18:25:56.070

将图像写入屏幕的性能在很大程度上受图像存储格式的影响。如果格式与屏幕内存所需的格式相同，则可以非常快；如果不是，则必须进行转换，有时是逐像素的，这非常慢。

如果您可以控制图像的存储方式，则应将其存储为屏幕正在查找的格式。这是一些示例代码：

```
 GraphicsEnvironment env = GraphicsEnvironment.getLocalGraphicsEnvironment();
    GraphicsDevice device = env.getDefaultScreenDevice();
    GraphicsConfiguration config = device.getDefaultConfiguration();
    BufferedImage buffy = config.createCompatibleImage(width, height, Transparency.TRANSLUCENT);
    Graphics g = buffy.getGraphics(); 
```

如果您要多次绘制图像，则可能值得将其转换为兼容格式，即使它采用其他格式。

如果您在绘制时对其进行转换，则绘制图像也会变慢，您的描述中的“调整大小”部分让我认为您可能会这样。再次，调整大小一次（当窗口调整大小时）并缓存调整大小和兼容的图像，以便可以快速重绘。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-18T13:48:00.870

如果您使用 sun 的 Java，请尝试以下一些系统属性，作为命令行参数或 main 中的第一行

```
sun.java2d.opengl=true //强制 ogl  
sun.java2d.ddscale=true //仅在使用direct3d时  
sun.java2d.translaccel=true //仅在使用direct3d时  

```

可以在[此页面查看更多标志](http://download.oracle.com/javase/6/docs/technotes/guides/2d/flags.html#win)

查看`sun.java2d.trace`哪些可以让您确定图形性能不佳的来源。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T12:38:44.670

这里有几件事可能会影响性能：

*   可用内存
*   中央处理器速度
*   显卡（板载或单独）
*   显卡驱动
*   爪哇版
*   使用的视频模式（分辨率、位深度、加速支持）

编辑：看看编辑过的问题，我建议检查 9600GS 系统是否安装了最新的 NVIDIA 驱动程序。我最近为英特尔板载显卡安装了一个驱动程序，它取代了通用的 Windows 驱动程序，使移动窗口、观看视频、浏览等速度更快。

所有其他规格看起来都不错。也许Java没有检测到9600GS，也没有使用硬件加速，但我对此表示怀疑。

还要检查操作系统配置。在 Windows 上，您可以关闭硬件加速以进行调试。

当然，处理这个问题的最佳方法是更改​​您的代码 - 调整图像大小或按照 DNS 建议将其拆分为块。您将永远无法看到屏幕上的整个图像。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-18T12:39:43.513

您如何判断计算机的性能？50x25 K 32 位图像需要超过 4.5 GB RAM 才能保存在内存中（50000 * 25000 * 4 字节）。如果一台计算机的 RAM 比另一台多，那么速度会产生巨大差异，因为它不必经常交换到磁盘。您应该考虑抓取图像的子部分并使用这些部分，而不是整个部分。

编辑：您使用的是最新的 Java 和图形驱动程序吗？如果您的图像只有 5Kx2.5K，我唯一能想到的就是它在没有任何硬件加速的情况下这样做。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-18T12:59:39.490

检查屏幕设置。我敢打赌，两个系统的像素深度不同，而慢速系统的像素深度与您要显示的图像对象有关。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T13:02:40.760

由于 Java[使用 OpenGL 进行 2D 绘图](http://weblogs.java.net/blog/campbell/archive/2005/03/strcrazy_improv_1.html)，因此您的应用程序的性能将受到相应计算机中图形芯片的 OpenGL 性能的影响。3D 行业对 OpenGL 的支持正在减少，这意味着（具有讽刺意味的是）较新的芯片在 OpenGL 渲染上可能比旧的芯片慢 - 不仅是由于硬件，还有驱动程序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-02-16T21:57:36.467

您是否尝试过全屏独占模式？

这可能会有所帮助：http: [//download.oracle.com/javase/tutorial/extra/fullscreen/index.html](http://download.oracle.com/javase/tutorial/extra/fullscreen/index.html)

# perl - Perl、LibXML 和模式

> ID：658060
> 
> 赞同：2
> 
> 时间：2009-03-18T12:31:22.210
> 
> 标签：perl, schema, libxml2, xml-libxml

我有一个示例 Perl 脚本，我试图根据模式加载和验证文件，它们询问各种节点。

```
#!/usr/bin/env perl
use strict;
use warnings;
use XML::LibXML;

my $filename = 'source.xml';
my $xml_schema = XML::LibXML::Schema->new(location=>'library.xsd');
my $parser = XML::LibXML->new ();
my $doc = $parser->parse_file ($filename);

eval {
    $xml_schema->validate ($doc);
};

if ($@) {
    print "File failed validation: $@" if $@;
}

eval {
    print "Here\n";
    foreach my $book ($doc->findnodes('/library/book')) {
        my $title = $book->findnodes('./title');
        print $title->to_literal(), "\n";

    }
};

if ($@) {
    print "Problem parsing data : $@\n";
} 
```

不幸的是，虽然它可以很好地验证 XML 文件，但它没有找到任何 $book 项目，因此没有打印出任何东西。

如果我从 XML 文件中删除架构并从 PL 文件中删除验证，那么它工作正常。

我正在使用默认命名空间。如果我将其更改为不使用默认命名空间 (xmlns:lib="http://libs.domain.com" 并在 XML 文件中的所有项目前加上 lib 并更改 XPath 表达式以包含命名空间前缀 (/lib: library/lib:book) 然后它再次工作文件。

为什么？我错过了什么？

XML:

```
<?xml version="1.0" encoding="utf-8"?>
<library xmlns="http://lib.domain.com" 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
         xsi:schemaLocation="http://lib.domain.com .\library.xsd">
    <book>
        <title>Perl Best Practices</title>
        <author>Damian Conway</author>
        <isbn>0596001738</isbn>
        <pages>542</pages>
        <image src="http://www.oreilly.com/catalog/covers/perlbp.s.gif" width="145" height="190"/>
    </book>
    <book>
        <title>Perl Cookbook, Second Edition</title>
        <author>Tom Christiansen</author>
        <author>Nathan Torkington</author>
        <isbn>0596003137</isbn>
        <pages>964</pages>
        <image src="http://www.oreilly.com/catalog/covers/perlckbk2.s.gif" width="145" height="190"/>
    </book>
    <book>
        <title>Guitar for Dummies</title>
        <author>Mark Phillips</author>
        <author>John Chappell</author>
        <isbn>076455106X</isbn>
        <pages>392</pages>
        <image src="http://media.wiley.com/product_data/coverImage/6X/07645510/076455106X.jpg" width="100" height="125"/>
    </book>
</library> 
```

XSD：

```
<?xml version="1.0" encoding="utf-8"?>
<xs:schema xmlns="http://lib.domain.com" xmlns:xs="http://www.w3.org/2001/XMLSchema" elementFormDefault="qualified" targetNamespace="http://lib.domain.com">
    <xs:attributeGroup name="imagegroup">
        <xs:attribute name="src" type="xs:string"/>
        <xs:attribute name="width" type="xs:integer"/>
        <xs:attribute name="height" type="xs:integer"/>
    </xs:attributeGroup>
    <xs:element name="library">
        <xs:complexType>
            <xs:sequence>
                <xs:element maxOccurs="unbounded" name="book">
                    <xs:complexType>
                        <xs:sequence>
                            <xs:element name="title" type="xs:string"/>
                            <xs:element maxOccurs="unbounded" name="author" type="xs:string"/>
                            <xs:element name="isbn" type="xs:string"/>
                            <xs:element name="pages" type="xs:integer"/>
                            <xs:element name="image">
                                <xs:complexType>
                                    <xs:attributeGroup ref="imagegroup"/>
                                </xs:complexType>
                            </xs:element>
                        </xs:sequence>
                    </xs:complexType>
                </xs:element>
            </xs:sequence>
        </xs:complexType>
    </xs:element>
</xs:schema> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T16:29:31.840

来自[XML::LibXML 文档](http://search.cpan.org/perldoc?XML::LibXML::Node)：

> 关于 XPath 的一个常见错误是假设节点测试由一个元素名称组成，而没有前缀匹配默认命名空间中的元素。这个假设是错误的——根据 XPath 规范，这样的节点测试只能匹配不在（即 null）命名空间中的元素。...（和以后）... ...推荐的方法是使用[XML::LibXML::XPathContext](http://search.cpan.org/perldoc?XML::LibXML::XPathContext) 模块

因此，从 XPath 的角度来看，没有“默认”命名空间……对于任何非空命名空间，您必须在 XPath 中指定它。XML::LibXML::XPathContext 模块允许您为要在 XPath 表达式中使用的任何名称空间创建前缀。

# database - 通过哈希码在数据库中搜索大字符串是否更快？

> ID：658065
> 
> 赞同：12
> 
> 时间：2009-03-18T12:31:48.120
> 
> 标签：database, performance, hash

如果我需要从数据库中检索一个大字符串，使用字符串本身搜索它是否会更快，或者我会通过对字符串进行散列并将散列存储在数据库中然后基于它进行搜索来获得？

如果是，我应该使用什么哈希算法（安全不是问题，我正在寻找性能）

如果重要：我正在使用 C# 和 MSSQL2005

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T12:36:02.633

一般来说：可能不是，假设列被索引。数据库服务器旨在快速有效地进行此类查找。一些数据库（例如 Oracle）提供了基于散列构建索引的选项。

但是，最终这只能通过使用代表性（您的需求）数据和使用模式进行性能测试来回答。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-18T12:38:15.467

虽然我从来没有做过，但听起来这在原则上是可行的。您可能会得到误报，但这可能非常渺茫。

我会使用诸如 MD5 之类的快速算法，因为您不想花费更长的时间来散列字符串，而不是仅仅搜索它。

**我要说的最后一件事是，只有尝试并衡量**性能，您才会知道它是否更好。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-18T12:41:21.670

如果这提供了巨大的改进，我会感到惊讶，我建议不要使用您自己的性能优化来进行数据库搜索。

如果您使用数据库索引，则 DBA 可以使用经过验证且受信任的方法来调整性能。对您自己的索引优化进行硬编码将防止这种情况发生，并且可能会阻止您在未来版本的数据库中获得任何索引性能改进。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-18T12:40:38.787

您是在进行*平等*匹配还是*包含*匹配？对于*相等*匹配，您应该让数据库处理这个（但添加一个非聚集索引）并通过`WHERE table.Foo = @foo`. 对于*包含*匹配，您或许应该查看[全文索引](http://msdn.microsoft.com/en-us/library/ms142591.aspx)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-18T12:47:07.087

首先 - 测量它。这是唯一可以确定的方法。
第二 - 如果您对字符串搜索的速度没有问题，请保持简单并且不要使用哈希。

但是，对于您的实际问题（并且只是因为这是一个有趣的想法）。这取决于字符串的相似程度。请记住，数据库引擎不需要比较字符串中的所有字符，只需要找出差异即可。如果您正在查看 1000 万个都以相同的 300 个字符开头的字符串，那么哈希几乎肯定会更快。但是，如果您正在寻找唯一以 x 开头的字符串，那么字符串比较可能会更快。我认为尽管 SQL 仍然必须从磁盘中获取整个字符串，即使它只使用第一个字节（或多字节字符的前几个字节），所以总字符串长度仍然会产生影响。

如果您正在尝试哈希比较，那么您应该使哈希成为索引计算列。如果每次运行查询时都计算所有字符串的哈希值，它不会更快！

您还可以考虑使用 SQL 的 CRC 函数。它会产生一个 int，它的计算速度更快，计算速度也更快。但是您必须通过实际测试字符串值来仔细检查此查询的结果，因为 CRC 函数不是为这种用法而设计的，而且更可能返回重复值。您将需要在一个查询中进行 CRC 或哈希检查，然后有一个比较字符串的外部查询。您还需要查看生成的 QEP 以确保优化器正在按照您想要的顺序处理查询。它可能决定先进行字符串比较，然后再进行 CRC 或哈希检查。

正如其他人指出的那样，只有在进行完全匹配时，这才有用。如果您尝试进行任何类型的范围或部分匹配，哈希将无济于事。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-18T12:34:30.703

如果您使用固定长度的字段和索引，它可能会更快......

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-18T12:36:53.443

如果你的字符串很短（一般少于 100 个字符），字符串会更快。

如果字符串很大，`HASH`搜索可能而且很可能会更快。

`HashBytes(MD4)`似乎是最快的`DML`。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-18T13:08:46.580

提示：如果要将哈希存储在数据库中，MD5 哈希始终为 16 个字节，因此可以保存在 uniqueidentifier 列中（以及 .NET 中的 System.Guid）

与以不同方式保存哈希相比，这可能会提供一些性能提升（我使用此方法检查二进制/ntext 字段更改，但不检查字符串/nvarchars）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-18T13:10:10.290

“理想”的答案肯定是肯定的。与索引列匹配的字符串总是比匹配存储在索引列中的哈希值慢。这就是哈希值的设计目的，因为它们采用大型数据集（例如 3000 个比较点，每个字符一个）并将其合并成一个较小的数据集（例如，16 个比较点，每个字节一个）。

所以，最优化的字符串比较工具会比优化的哈希值比较慢。

但是，如前所述，实现自己的优化散列函数是危险的，并且可能不会顺利进行。（我已经尝试过但失败得很惨）哈希冲突并不是一个特别的问题，因为那样你将不得不依赖字符串匹配算法，这意味着它（在最坏的情况下）与你的字符串比较方法一样快。

但是，这一切都假设您的散列以最佳方式完成（可能不会）并且您的散列组件中不会有任何错误（将会有）并且性能提升将是值得努力（可能不是）。字符串比较算法，特别是在索引列中已经非常快了，并且散列工作（程序员时间）可能比您可能获得的收益要高得多。

如果您想了解性能，只需测量即可。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-18T12:46:04.060

我很困惑，可能误解了你的问题。

如果您已经有了字符串（因此您可以计算哈希），为什么需要检索它？

您是否使用大字符串作为某些东西的键？

# xslt - XSLT foreach

> ID：658088
> 
> 赞同：0
> 
> 时间：2009-03-18T12:38:10.867
> 
> 标签：xslt

嗨，我在匹配 xml 节点的特定属性时遇到了一个奇怪的问题。不起作用的示例代码：

```
<xsl:for-each select="../../unit/service/price/season[@name=$period_name]">
     <xsl:attribute name="std_bed_price">
          <xsl:value-of select="../@amount"/>
     </xsl:attribute>
</xsl:for-each> 
```

可以工作但我不太喜欢这种方式的示例代码：

```
 <xsl:for-each select="../../unit/service/price/season">
     <xsl:if test="@name = $period_name">
          <xsl:attribute name="std_bed_price">
               <xsl:value-of select="../@amount"/>
          </xsl:attribute>
     </xsl:if>
 </xsl:for-each> 
```

如果在第一个示例中，我将变量名称替换为一些值，例如“A”，它可以工作，我还测试了选择的变量名称并且它内部有正确的数据（所以，“A”、“B”、“C” ...)

以前有人遇到过这个问题吗？

肿瘤坏死因子

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T23:31:30.420

您可以尝试将其更改为 apply-templates 而不是 foreach。像下面这样的东西应该可以工作。

```
<xsl:template match="price">
    <xsl:attribute name="std_bed_price">
        <xsl:value-of select="@amount" />
    </xsl:attribute>
</xsl:template> 
```

然后这样称呼它：

```
<xsl:apply-template select="../../unit/service/price/[season/@name=$period_name]" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T12:44:51.553

以前没见过这个。它可能是一个模棱两可的@name 属性。因此尝试像下面这样访问它？

```
select="../../unit/service/price/season[./@name=$period_name] 
```

除此之外，对不起，对我来说，它看起来应该双向完美。

# visual-studio - .NET 引用的程序集 - 版本号

> ID：658090
> 
> 赞同：0
> 
> 时间：2009-03-18T12:38:28.387
> 
> 标签：visual-studio, nant, version

我最近接手了一个项目，原来的开发者已经走了。我现在正在尝试在新服务器上安装该应用程序，但我遇到了依赖程序集版本的问题。

该项目是一个报告工具，（不幸的是）引用了水晶。在我的机器上，我有版本 11.5.9500.313 的 CrystalDecisions.CrystalReports.Engine.dll。

执行构建的 NAnt 脚本定义了引用，包括 Crystal dll，但没有定义版本号。

当我使用 NAnt 脚本构建应用程序并使用 Reflector 分析程序集时，参考是针对版本 11.5.3300.0。

谁能解释这个参考的版本号来自哪里？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T12:44:17.873

它来自 vs. 项目文件中的引用。在文本编辑器中打开项目文件并检查它。无论如何，要修复在视觉工作室中重新添加引用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T12:54:31.233

程序集版本（来自`AssemblyVersionAttribute`）不一定与文件版本（来自`AssemblyFileVersionAttribute`）相同。除非您使用一致地返回程序集版本的工具（例如反射器），否则比较版本将完全不可靠。

# wordpress - WordPress previous_posts_link() 导致找不到 404 错误

> ID：658097
> 
> 赞同：0
> 
> 时间：2009-03-18T12:40:12.000
> 
> 标签：wordpress

下面是我正在使用的代码。我已经尝试了所有我能找到的东西，但它仍然不起作用。我的永久链接结构是`/%category%/%postname%/`. 我相信它试图去的 url 是正确的，即[http://localhost:8888/wordpress/blog/page/2](http://localhost:8888/wordpress/blog/page/2)。令人讨厌的是，完全相同的代码可以在我之前设计的另一个网站上运行。

有人可以指出我正确的方向吗？谢谢

```
<?php get_header(); ?>
    <div id="content" class="narrowcolumn">
    <?php 
        $paged = (get_query_var('paged')) ? get_query_var('paged') : 1;
        query_posts("cat=3&showposts=2&paged=" . $paged);

        $wp_query->is_archive = true; $wp_query->is_home = false;
    ?>

    <?php if (have_posts()) : ?>
    <div id="lefttop"></div>

    <div id="blogpoint">
    <div id="leftcol">
        <?php while (have_posts()) : the_post(); ?>

            <div id="leftsquidge">
                <h2><a href="<?php the_permalink() ?>" rel="bookmark" title="Permanent Link to <?php the_title_attribute(); ?>"><?php the_title(); ?></a></h2><br /><br />

                    <?php the_excerpt(); ?>
            </div>  
            <div id="rightsquidge">
                <?php the_tags( '<p><strong>File under:</strong> ', ', ', '</p>'); ?>
                <?php the_time('F jS, Y') ?>  by <strong><?php the_author() ?></strong>
            </div>
            <div style="clear:both;"></div> 
            <br /><br />
        <?php endwhile; ?>
        <div class="navigation" style="padding:0px;margin:0px;">
            <div class="alignleft"><?php next_posts_link('&laquo; Older Entries') ?></div>
            <div class="alignright"><?php previous_posts_link('Newer Entries &raquo;') ?></div>
        </div>
    <?php endif; ?> 
        <div style="clear:both;"></div> 
        </div>

        </div>
        <div id="leftbot"></div>
    </div>

<?php get_sidebar(); ?>

<?php get_footer(); ?> 
```

* * *

编辑

我已经回答了我自己的问题。这是我之前尝试过的东西，但没有奏效。您必须在仪表板上创建一个使用您的类别作为模板的页面。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-09-14T07:22:36.250

Try going to "Reading Settings" in the Wordpress admin, and makes sure the "Blog pages show at most _ posts" is set to 2, or whatever your 'showposts' limit is in your query. Your query_posts is giving you accurate results but Wordpress is paging it based on your reading settings.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T12:51:40.007

如果相同的代码在另一个站点上运行良好，请检查您对该站点的设置。比较两个站点上的永久链接设置。

两个站点是否都在相同的环境（Apache 或 iis）上工作？

# unity-container - 为什么 Unity 的 RegisterInstance<...> 会导致 Unity 返回多个实例？

> ID：658110
> 
> 赞同：3
> 
> 时间：2009-03-18T12:44:09.370
> 
> 标签：unity-container

Unity 的文档中提到了 RegisterInstance<> 方法，该方法注册一个实例，以便**每次调用 Resolve<> 时都会返回该特定实例**。

但是，下面的示例显示每次调用 Resolve<> 时，**都会返回该类型的新实例**。

为什么是这样？

```
using System;
using System.Windows;
using Microsoft.Practices.Unity;

namespace TestUnity34
{
    public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();

            Validator validator1 = new Validator();
            IUnityContainer container = new UnityContainer();
            container.RegisterInstance<IValidator>(validator1);

            Validator validatorCopied = validator1;
            Console.WriteLine(validator1.GetHashCode()); //14421545
            Console.WriteLine(validatorCopied.GetHashCode()); //14421545

            Validator validator2 = container.Resolve<Validator>();
            Console.WriteLine(validator2.GetHashCode()); //35567111

            Validator validator3 = container.Resolve<Validator>();
            Console.WriteLine(validator3.GetHashCode()); //65066874
        }
    }

    interface IValidator
    {
        void Validate();
        string GetStatus();
    }

    public class Validator : IValidator
    {
        public void Validate() { }

        public string GetStatus() { return "test"; }
    }
} 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-18T13:05:47.150

您已经使用 IValidator 配置了容器，因此您必须使用 IValidator 而不是 Validator 来解决：

```
Validator validator1 = new Validator(); 
IUnityContainer container = new UnityContainer(); 
container.RegisterInstance<IValidator>(validator1); 
Validator validatorCopied = validator1; 
Console.WriteLine(validator1.GetHashCode());
Console.WriteLine(validatorCopied.GetHashCode());
IValidator validator2 = container.Resolve<IValidator>();            
Console.WriteLine(validator2.GetHashCode());             
IValidator validator3 = container.Resolve<IValidator>();            
Console.WriteLine(validator3.GetHashCode()); 
```

或者，您可以使用 Validator 保留您的注册，但您也必须使用 Validator 来解决：

```
Validator validator1 = new Validator();
IUnityContainer container = new UnityContainer();
container.RegisterInstance<Validator>(validator1);
Validator validatorCopied = validator1;
Console.WriteLine(validator1.GetHashCode());
Console.WriteLine(validatorCopied.GetHashCode());
Validator validator2 = container.Resolve<Validator>();
Console.WriteLine(validator2.GetHashCode());
Validator validator3 = container.Resolve<Validator>();
Console.WriteLine(validator3.GetHashCode()); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-18T12:47:12.747

我认为如果您使用 IValidator 作为类型参数调用 Resolve，它将按您的预期工作：

```
...
var validator2 = container.Resolve<IValidator>();
... 
```

# windows - Mac Spaces 的 Windows 实现

> ID：658118
> 
> 赞同：2
> 
> 时间：2009-03-18T12:46:50.830
> 
> 标签：windows, macos, desktop

我刚刚听了 StackOverflow 播客的第 6 集，我只是想知道，是否有免费且足够好的 Mac Spaces for Windows 实现？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-01-09T23:25:51.430

试试[德博](http://www.dexpot.de)

从他们的网站

> 使用 Dexpot，您可以为不同的应用程序拥有单独的虚拟桌面。例如，一个桌面可能具有用于图形设计的应用程序，而另一个可能具有您的业务应用程序。
> 
> 在虚拟桌面之间切换以跟踪您打开的窗口。使用 Dexpot，您将大大增加您的工作流程。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-04-28T01:37:21.227

试试**[Microsoft Sysinternals Desktops](http://technet.microsoft.com/en-us/sysinternals/cc817881)**，它提供了 4 个虚拟桌面。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T13:01:59.303

不，没有，至少对于 XP 来说没有。这很难，因为 xp 在设计时没有考虑到这一点，而 Mac 和 Linux 处理得很好。

我发现的最好的 XP 是[VirtualWin](http://virtuawin.sourceforge.net/)，它只是通过隐藏窗口来工作。这很 hacky，但至少它把主要思想搞定了。我认为如果你有一个像 vista 这样的加速桌面，[VDM](http://www.codeplex.com/vdm)可能值得一看。但由于我没有vista，我不能确定。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T12:49:46.407

微软有一个虚拟桌面管理器[PowerToy](http://www.microsoft.com/windowsxp/Downloads/powertoys/Xppowertoys.mspx)。不过，不如 Linux 和 OSX 上的好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-05-06T05:35:30.980

Dexpot 是我找到的选项和功能最好的，但是免费版本在安装程序中附带一些垃圾软件，如果您只是安装专业试用版，然后使用 7zip 拆除免费版本安装程序并将程序文件复制到程序目录 - 它就像一个冠军但是 - 没有垃圾软件。

尽量不要破坏你的电脑这样做。

# iphone - 如何在iphone中调用外部.h文件的方法

> ID：658119
> 
> 赞同：1
> 
> 时间：2009-03-18T12:47:01.750
> 
> 标签：iphone, file, header

对所有人

在我的 iphone 游戏中，我想添加外部 .h 和 .a 文件。我通过使用 Xcode 中给出的添加项目选项来添加它们。它被添加了，但我想调用头文件中给出的方法。根据给我们的指令，我们必须调用一个在外部头文件中声明的方法。我们必须在 AppDelegate 的 applicationDidFinishLaunching 方法中调用该方法。但是在编译时，它给出了一个错误，引用自：并且找不到符号。我不明白如何调用此方法以及如何引用该方法。

我正在发送一个链接，请查看。我的应用程序也出现了同样的问题。

[http://forums.macrumors.com/showthread.php?t=443437](http://forums.macrumors.com/showthread.php?t=443437)

在这三个屏幕截图中，一些 toddburch 在 2009 年 1 月 24 日上午 7:37 给出了我的方法的相同错误，但我的代码在 Cocoa 中，objective-c 不在 ruby​​ 中。

如果有人知道解决方案，请尽快回复我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T12:53:04.903

.h 是不够的。您还需要实现，源代码或编译框架。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-21T22:43:18.887

您目前有两个文件

*   描述第三方库中可用的类和函数的 *.h 头文件
*   *.a 静态库文件，其中包含 *.h 文件描述的函数的预编译代码。

假设您已经到了可以#include 或#import "xyz.h" 并编译您的应用程序的阶段，那么缺少的一点是将您的可执行文件与 *.a 文件链接起来。

未找到符号错误消息是链接器告诉您它知道您的某些代码正在调用特定函数，但它当前无法找到提供该函数实现的另一个代码模块。

要检查的一件事是您的 *.a 文件在您的项目中正确配置以传递给链接器。一种方法是展开 XCode 主窗口的“Targets”部分。如果您深入到代表您的应用程序的部分，您应该会看到一个标有“Link Binaries with Libraries”的子节点。应该列出您的 *.a 文件，如果不是一种添加方法，只需将文件拖放到此部分即可。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-15T11:24:06.943

您是否有权访问源代码本身？尝试将 .h 和 .m/.c 文件从框架目录直接拖到您的项目中。这有点乱，但我认为它会根据您收到的错误消息解决您的问题。您可以将它们全部放在一个组中，这样在您将它们拖过来后，您的项目就不会显得那么拥挤，如果您愿意的话。

# configuration - 如何在 Windows ClearCase 中使用 ediff (emacs diff) 作为 diff/merge 工具？

> ID：658127
> 
> 赞同：8
> 
> 时间：2009-03-18T12:47:46.413
> 
> 标签：configuration, emacs, diff, clearcase

我在工作中被迫使用 ClearCase（Windows 版本），我想使用 emacs ediff 作为差异和合并工具。ClearCase 映射文件的问题在于它需要 .exe 文件——我试图指定一个批处理文件调用`ediff`，但它不起作用。

我不想编写一个 C/C++ 程序（自从我用 C 为 Win32 编写任何东西以来已经有 10 多年了），它将`ediff`使用正确的参数进行调用。有没有更简单的方法？

### 也可以看看：

[有什么方法可以将自定义差异工具与 cleartool/clearcase 一起使用？](https://stackoverflow.com/questions/375398/any-way-to-use-a-custom-diff-tool-with-cleartool-clearcase/375437#375437)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T13:08:04.820

正如这个[SO question](https://stackoverflow.com/questions/375398/any-way-to-use-a-custom-diff-tool-with-cleartool-clearcase/375437#375437)中提到的，地图文件允许您调用外部差异工具。

对于 Windows，您应该首先尝试[在 ediff 模式下调用 emacs](http://groups.google.com/group/gnu.emacs.help/msg/2e85eb36ec291ebe)：

```
 emacs --eval "(ediff-files \"file_1\" \"file_2\")" 
```

或者

```
 xemacs -eval "(ediff-files \"file_1\" \"file_2\")" 
```

（应该调用XEmacs ediff的*新实例）*

如果这可行，您可以编写一个`.bat`由地图文件调用的文件，并构建适当的“ `emacs ediff`”命令行。

类似于[以下内容](http://www.groupsrv.com/computers/about178715.html)：

```
@echo off
set local
if !%XEMACS_PATH%!==!! SET
XEMACS_PATH=C:\<XEmacs-Path>\i586-pc-win32
set FILE1=%~1
set FILE2=%~2
REM * Bad habit - working on administrative shares.. Why is $->$$ not needed?
REM SET FILE1=%FILE1:$=$$%
REM SET FILE2=%FILE2:$=$$%
REM * Escaping backslash..
SET FILE1=%FILE1:\=\\%
SET FILE2=%FILE2:\=\\%

"%XEMACS_PATH:"=%\gnudoit.exe" "(ediff \"%FILE1%\" \"%FILE2%\")" 
```

如果地图文件不方便调用 .bat 文件，只需[从您的 .bat 文件](http://www.commentcamarche.net/telecharger/telechargement-34057824-bat-to-exe-converter)[生成一个`.exe``.bat`](http://www.commentcamarche.net/telecharger/telechargement-34057824-bat-to-exe-converter)。

* * *

我做了一些测试，结果是：

*   “与以前的版本比较”实际上调用：

    `cleartool diff -graphical -pred myFile`

*   通过 cmd.exe 调用调用 .bat 不起作用

    `c:\Program Files\Rational\ClearCase\lib\mgrs\map`

    `text_file_delta xcompare "c:\WINDOWS\system32\cmd.exe /c c:\cc\test.bat"`

    `cleartool: Error: Operation "xcompare" unavailable for manager "text_file_delta"` `(Operation pathname was: "C:\Program Files\Rational\ClearCase\lib\mgrs\"c:\WINDOWS\system32\cmd.exe /c c:\cc\test.bat"")`

*   在 .exe 中转换 .bat 确实有效

*   arg2 ( `%2`) 和 arg4 ( `%4`) 是您要查找的内容，其中 arg5 ( `%5`) 是为先前版本的内容创建的临时文件的名称（对于无法访问扩展路径名的快照视图）

因此，以下 bat（在 exe 中转换）**只能从命令行**工作（而不是来自 ClearCase Explorer：DrWatson）：

```
"C:\Program Files\WinMerge\WinMergeU.exe" %4 %5 
```

您应该能够使其适应 Xemacs，但[Alex 的建议](https://stackoverflow.com/questions/658127/how-can-i-use-ediff-emacs-diff-as-a-diff-merge-tool-in-windows-clearcase/658436#658436)（[使用 Emacs 的 Clearcase](http://xtalk.msk.su/~ott/en/writings/emacs-vcs/EmacsClearCase.html)）可能是另一个更实用的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T14:20:16.987

[您可以使用此处](http://xtalk.msk.su/~ott/en/writings/emacs-vcs/EmacsClearCase.html)描述的 clearcase 包

# excel - 调整行范围

> ID：658129
> 
> 赞同：0
> 
> 时间：2009-03-18T12:48:23.370
> 
> 标签：excel, rows, spreadsheet

在我的 Excel 电子表格中，我有一个单元格是`=SUM(C6:C19)`. 如果我去`C20`添加一行，该公式将不会调整。我希望它更改为`=SUM(C6:C20)`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T13:14:43.837

您可以使用动态范围，而不是在公式中使用静态范围：

```
=SUM(OFFSET(reference, rows, cols, height, [width])) 
```

例如：

```
=SUM(OFFSET('My Sheet'!$C$6, 0, 0, COUNTA('My Sheet'!$C:$C))) 
```

这假设 C 列中没有其他内容。如有必要，您可以限制高度范围*：

```
=SUM(OFFSET('My Sheet'!$C$6, 0, 0, COUNTA('My Sheet'!$C$6:$C$30))) 
```

*来自 Lunatik 的评论

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T08:04:21.983

最**简单的方法**是在值的底部和求和公式之间留一个单元格空间。

**例如**，单元格 A20 当前对单元格 A1 到 A19 求和。在您在 A19 下方插入一行时，总和不会包含新行，对吗？

好吧，如果您**将求和公式放入单元格 A21**并**从 A1 求和到 A20**（即使 a20 中没有任何内容），**当您在单元格 A20 上方插入一行时，您的求和公式将包含它。**

作为替代答案提到的偏移量也是一种很好的方法，但更令人困惑，如果我想保持**简单**，这就是我要做的。

# c++ - c++：什么时候使用指针？

> ID：658133
> 
> 赞同：16
> 
> 时间：2009-03-18T12:49:05.817
> 
> 标签：c++, qt, pointers, object

在阅读了一些教程后，我得出结论，应该始终使用指针来表示对象。[但是我在阅读一些 QT 教程（ http://zetcode.com/gui/qt4/painting/](http://zetcode.com/gui/qt4/painting/) ）时也看到了一些例外，其中 QPaint 对象是在堆栈上创建的。所以现在我很困惑。什么时候应该使用指针？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-03-18T13:07:55.850

**如果您不知道何时应该使用指针，请不要使用它们。**

很明显，当您需要使用它们时，每种情况都不同。何时应该使用它们并不容易简明总结。不要养成“总是使用对象指针”的习惯，这肯定是个坏建议。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-03-18T12:56:06.720

使用指针的主要原因：

1.  控制对象生命周期；
2.  不能使用引用（例如，您想在向量中存储不可复制的内容）；
3.  您应该将指针传递给某个第三方函数；
4.  也许是一些优化原因，但我不确定。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-03-18T13:43:42.457

我不清楚您的问题是ptr-to-obj vs stack-based-obj还是ptr-to-obj vs reference-to-obj。还有一些用途不属于任何一类。

关于 vs stack，上面似乎已经介绍过了。几个原因，最明显的是对象的生命周期。

关于 vs 引用，总是尽量使用引用，但是有些事情你只能用 ptrs 做，例如（有很多用途）：

*   遍历数组中的元素（例如，遍历标准数组 []）
*   当被调用的函数分配一些东西并通过 ptr 返回它时

**最重要的是，指针（和引用，与自动/基于堆栈和静态对象相反）支持多态性。指向基类的指针实际上可能指向派生类。这是 C++ 支持的 OO 行为的基础。**

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-03-18T13:54:56.720

首先，问题是错误的：困境不在指针和堆栈之间，而是在堆和堆栈之间。您可以在堆栈上有一个对象并将指针传递给该对象。我假设您真正要问的是您是否应该声明指向类的指针或类的实例。

答案是这取决于你想对对象做什么。如果在控件离开函数后对象必须存在，那么您必须使用指针并在堆上创建对象。例如，当您的函数必须返回指向已创建对象的指针或将对象添加到在调用您的函数之前创建的列表时，您将执行此操作。

另一方面，如果对象是函数的本地对象，那么最好在堆栈上使用它。这使编译器能够在控件离开函数时调用析构函数。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-18T12:53:21.360

那会是哪些教程？实际上，规则是只有在绝对必要时才应该使用指针，这种情况很少见。你需要阅读一本关于 C++ 的好书，比如Koenig & Moo 的[Accelerated C++](http://www.acceleratedcpp.com/)。

**编辑：**澄清一下 - 两个**不**使用指针的实例（这里使用字符串作为示例 - 任何其他类型也一样）：

```
class Person {
   public:
      string name;       // NOT string * name;
   ...
};

void f() {
   string value;        // NOT string * value
   // use vvalue
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-18T12:58:46.870

您通常必须在以下情况下使用指针：

1.  您需要属于不同类的对象集合（在大多数情况下，它们将具有共同的基础）。

2.  您需要一个堆栈分配的对象集合，该集合非常大，可能会导致堆栈溢出。

3.  您需要一种可以快速重新排列对象的数据结构——如链表、树等。

4.  您需要一些复杂的对象生命周期管理逻辑。

5.  您需要一个允许从对象直接导航到对象的数据结构——例如链表、树或任何其他图形。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-18T13:19:07.820

除了其他人提出的观点（尤其是控制对象生命周期）之外，如果您需要处理 NULL 对象，您应该使用指针，而不是引用。可以通过类型转换创建 NULL 引用，但这通常是个坏主意。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-18T12:56:21.510

通常在以下情况下使用对象的指针/引用：

*   将它们传递给其他方法

*   创建一个大数组（我不确定正常的堆栈大小是多少）

在以下情况下使用堆栈：

*   您正在创建一个在方法中生存和死亡的对象

*   对象是 CPU 寄存器的大小或更小

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-18T13:41:42.600

我实际上在这种情况下使用指针：

```
class Foo
{
    Bar* bar;

    Foo(Bar& bar) : bar(&bar) { }

    Bar& Bar() const { return *bar; }
}; 
```

在此之前，我使用了从构造函数初始化的引用成员，但是编译器在创建复制构造函数、赋值运算符等时遇到了问题。

戴夫

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-28T00:00:36.900

使用指针与两个正交的事物有关：

1.  **动态分配**。通常，当对象的寿命要长于创建它的范围时，您应该动态分配。这样的对象是必须明确指定所有者的资源（最常见的是某种智能指针）。

2.  **按地址访问**（不管对象是如何创建的）。在这种情况下，指针并不意味着所有权。在以下情况下可能需要此类访问：

    *   一些已经存在的界面需要这样。
    *   应该对可能为空的关联进行建模。
    *   应该避免复制大对象，否则根本不可能复制，但不能使用引用（例如，stl 集合）。

#1 和#2 可以出现在不同的配置中，例如，您可以想象通过指针访问动态分配的对象，但这样的对象也可以通过引用传递给某个函数。您还可以获得指向在堆栈上创建的某个对象的指针等。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-28T00:05:48.527

使用表现良好的可复制对象按值传递是处理大量代码的方法。

如果速度真的很重要，请尽可能使用按引用传递，最后使用指针。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-03-03T05:44:51.507

如果可能，永远不要使用指针。依靠引用传递，或者如果你要返回一个结构或类，假设你的编译器有返回值优化。（但是，您必须避免返回类的条件构造）。

Java没有指针是有原因的。C++ 也不需要它们。如果您避免使用它们，您将在对象离开范围时获得自动对象销毁的额外好处。否则，您的代码将生成各种类型的内存错误。由于未处理的异常，内存泄漏可能很难找到并且经常发生在 C++ 中。

如果必须使用指针，请考虑一些智能指针类，例如 auto_ptr。对象的自动销毁不仅仅是释放底层内存。有一个概念叫做 RAII。一些对象需要额外处理销毁。例如互斥锁和关闭文件等。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-18T12:57:39.430

当您不想在堆栈帧被清空时销毁对象时，请使用指针。

尽可能使用引用传递参数。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-10T00:21:24.747

说到 C++，当程序离开创建它的范围时，在堆栈上创建的对象不能使用。所以一般来说，当你知道不需要通过函数或右括号的变量时，你可以创建它在堆栈上。

具体来说Qt，Qt通过处理堆对象的大量内存管理来帮助程序员。对于派生自`QObject`（几乎所有以“ `Q`”为前缀的类都是）的对象，构造函数采用可选参数 parent。然后父对象拥有该对象，当父对象被删除时，所有拥有的对象也将被删除。本质上，子对象的销毁责任被传递给了父对象。使用这种机制时，`QObject`必须在堆上创建child。

简而言之，在 Qt 中，您可以轻松地在堆上创建对象，并且只要设置适当的父对象，您只需担心销毁父对象。但是，在一般 C++ 中，您需要记住销毁堆对象或使用智能指针。

# silverlight - 有人找到 Blend V3 试用版吗？

> ID：658138
> 
> 赞同：0
> 
> 时间：2009-03-18T12:50:13.303
> 
> 标签：silverlight, expression-blend

现在 Silverlight 3 Beta 1 已经发布，有人找到 Blend V3 beta 预览版了吗？Silverlight 提供的一个链接现在无效：

[http://www.nextbestgeek.com/2009/03/18/silverlight-3-its-here/](http://www.nextbestgeek.com/2009/03/18/silverlight-3-its-here/)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T17:08:27.707

[http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=a04aa0ae-87be-4201-a65e-e792859122fc](http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=a04aa0ae-87be-4201-a65e-e792859122fc)

它现在可用，刷新几次，直到你得到正确的网络分片。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T13:02:54.833

我也无法在我的 MSDN 订阅下载中看到它。我不认为它还没有。

[更新：现在](http://www.microsoft.com/expression/blendpreview)可用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T05:38:21.210

在这里能找到它。

[http://www.microsoft.com/expression/blendpreview](http://www.microsoft.com/expression/blendpreview)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T13:30:32.370

如果您对尝试 SketchFlow 感到兴奋并因此尝试获取 Blend 3 预览版，那么请注意，当前预览版中不提供 SketchFlow 功能，团队博客说，它可能会在未来的版本中提供。

# c# - 杀死或关闭进程

> ID：658157
> 
> 赞同：1
> 
> 时间：2009-03-18T12:57:33.050
> 
> 标签：c#, process

我想知道如何关闭或杀死一个进程（xyz.exe），即使在关闭它或通过任务管理器杀死它之后它占用内存。

来自另一个 c# appln

有没有其他方法可以停止挂在内存中的进程，我迫切需要知道该怎么做。

是否可以编写内核级程序并尝试终止该进程？

是否有任何工具可用于执行此过程？

无法使用杀死进程`process.kill()`，进程被挂起，是否可以通过其他方式杀死它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T13:10:42.223

[ProcessExplorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)可以杀死一切，但我认为作者实际上必须编写一个新的内核潜水器来实现它（虽然我不确定）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T13:09:02.023

如果你通过任务管理器杀死了它，它应该已经死了。如果它拒绝通过任务管理器关闭（并且您是管理员），您将很难通过代码做得更好。但是，您可以获取`Process`对象（可能通过`Process.GetProcessesByName(...)`）和`.Kill()`它。不过，我不希望它比任务人做得更好。

# java - 安装Tomcat + Solr问题

> ID：658162
> 
> 赞同：2
> 
> 时间：2009-03-18T12:58:20.333
> 
> 标签：java, web-services, tomcat, ubuntu, solr

我正在尝试在我的 Ubuntu 机器上安装 Tomcat + Solr。我正在使用ubuntu repo：

```
http://packages.ubuntu.com/intrepid/web/solr-tomcat5.5
http://packages.ubuntu.com/intrepid/tomcat5.5 
```

当我启动 tomcat 时，solr 不起作用：

```
sudo service tomcat5.5 start 
```

网页面板没有找到 solr，并给我这个错误：

```
HTTP Status 404 - /solr/admin 
```

有谁知道这可能是什么？

先感谢您

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T05:57:10.657

Tomcat 和 Solr 的 Ubuntu 打包版本并不是以运行良好而闻名。我强烈建议您离开包管理器并从源头获取它们。本指南应该为您提供您需要知道的一切：http: [//justin-hayes.com/2009-04-08/installing-apache-tomcat-6-and-solr-nightly-on-ubuntu-804](http://justin-hayes.com/2009-04-08/installing-apache-tomcat-6-and-solr-nightly-on-ubuntu-804)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T15:21:21.083

我发现这个链接很有用，因为我无法从 ubuntu 存储库中完成任何事情：

[http://wiki.apache.org/solr/SolrTomcat#Simple_Example_Install](http://wiki.apache.org/solr/SolrTomcat#Simple_Example_Install)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-14T21:03:16.810

我能够 apt-get install tomcat6，并按照以下说明进行操作：

[https://wiki.fourkitchens.com/display/TECH/Solr+1.4+on+Ubuntu+9.10+and+CentOS+5](https://wiki.fourkitchens.com/display/TECH/Solr+1.4+on+Ubuntu+9.10+and+CentOS+5)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-08-03T05:33:00.023

从版本 5 开始，不建议在外部容器中运行 Solr。不再支持在 Tomcat 等容器中部署 solr 作为战争。它最好与它附带的内置 Jetty 服务器一起使用。查看 Solr wiki 文档中的此链接，它可能会清除您的疑虑[https://cwiki.apache.org/confluence/display/solr/Running+Solr+on +雄猫](https://cwiki.apache.org/confluence/display/solr/Running+Solr+on+Tomcat)。

# linux - scp 文件未设置正确的所有者

> ID：658166
> 
> 赞同：0
> 
> 时间：2009-03-18T12:58:51.347
> 
> 标签：linux, ssh, file-permissions, scp, umask

SCP 在设置文件权限时是否有问题或我的服务器配置错误？

## 用例：

我要编辑的服务器上有一个名为“importantFile.txt”的文件。该文件具有“主”的所有者和组：

```
ls -l importantFile.txt:
-rw-rw-r--  1 master master     7 Mar 18 08:11 importantFile.txt 
```

我被称为“奴隶”，但幸运的是，我在“主人”组中，所以我可以根据需要编辑文件。但是，我是一个懒惰的奴隶，懒得在服务器上编辑文件，我更愿意在我的本地机器上编辑文件并将其 SCP 到服务器：

```
echo "bored slave info" > importantFile.txt
scp importantFile.txt slave@theServerAddress:/pathToFile/importantFile.txt 
```

如果我这样做，服务器上的文件内容上传正常，文件的时间戳会更新，但文件的权限不会改变，文件仍然归“master”所有。这是一个问题，因为如果“奴隶”上传了不良内容，没有人会知道是“奴隶”造成了问题，“主人”会显得很内疚。

也许我必须设置一个umask？如果是在哪里？我尝试了 .bash_profile 没有成功，并且在 Google 上没有找到任何关于 .bash_profile 中的 umask 的信息`/etc/ssh/sshd_config`。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T13:43:27.263

您必须删除文件才能覆盖它。您是否能够做到这一点取决于目录的权限和所有权。劫持已经存在的文件的所有权是不可能的。您拥有的写入权限仅适用于文件的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T14:11:26.947

这对 scp 没什么特别的 - 尝试以从属身份登录服务器，并使用您最喜欢的文本编辑器编辑文件...您会发现发生相同的行为...写入文件不会使您成为该文件的所有者文件。

* * *

例子：

作为根

```
#cd /tmp
#mkdir fubar
#chgrp vboxusers fubar
#cd fubar/
#touch testfile
#chgrp vboxusers testfile 
#chmod g+w . testfile
#ls -al
total 16
drwxrwxr-x  2 root vboxusers  4096 2009-03-19 10:30 .
drwxrwxrwt 15 root root      12288 2009-03-19 10:29 ..
-rw-rw-r--  1 root vboxusers     0 2009-03-19 10:30 testfile
#echo foo > testfile 
#ls -al
total 20
drwxrwxr-x  2 root vboxusers  4096 2009-03-19 10:30 .
drwxrwxrwt 15 root root      12288 2009-03-19 10:29 ..
-rw-rw-r--  1 root vboxusers     4 2009-03-19 10:30 testfile 
```

作为用户（在 vboxusers 组中）

```
>cd /tmp/fubar
>ls -al
total 20
drwxrwxr-x  2 root vboxusers  4096 2009-03-19 10:30 .
drwxrwxrwt 15 root root      12288 2009-03-19 10:29 ..
-rw-rw-r--  1 root vboxusers     4 2009-03-19 10:30 testfile
>echo bar >> testfile 
>ls -al
total 20
drwxrwxr-x  2 root vboxusers  4096 2009-03-19 10:30 .
drwxrwxrwt 15 root root      12288 2009-03-19 10:29 ..
-rw-rw-r--  1 root vboxusers     8 2009-03-19 10:31 testfile
>vim testfile
>ls -al
total 20
drwxrwxr-x  2 root vboxusers  4096 2009-03-19 10:31 .
drwxrwxrwt 15 root root      12288 2009-03-19 10:31 ..
-rw-rw-r--  1 root vboxusers    12 2009-03-19 10:31 testfile
>cat testfile 
foo
bar
baz 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-10-27T15:31:59.510

`backup-by-copying-when-mismatch`似乎您可以通过变量配置 Emacs 如何处理此问题（请参阅 Emacs 手册或输入`C-h-v backup-by-copying-when-mismatch`Emacs）。

我实际上提交了一份关于此的[错误报告](http://debbugs.gnu.org/cgi/bugreport.cgi?bug=7289)，因为我认为这是 Tramp 中的错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T08:12:54.693

我误解了文件的工作方式，修改文件内容不会改变所有权或组。

为什么会出现混乱？**EMACS** - 每当我编辑文件时，我都在使用 Emacs，而 Emacs 确实会将所有者和组更改为当前用户。它这样做是因为它在保存时通过将“文件名”移动到“文件名~”并创建一个名为“文件名”的新文件来制作备份文件 - 因为它是一个新文件，它具有当前用户的文件权限。我猜这是1up to VI的粉丝？

# .net - .NET 中是否有一个属性可以将类或方法标记为线程安全？

> ID：658167
> 
> 赞同：8
> 
> 时间：2009-03-18T12:58:54.763
> 
> 标签：.net, multithreading

在 .NET 中，我如何知道一个类或方法是否是线程安全的？默认情况下不是线程安全的吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T13:09:28.170

这不是属性：您必须阅读您感兴趣的每个项目的文档。您不能简单地通过向其添加属性来使其成为线程安全的。这就像拿一个橘子并在上面贴上“苹果”的贴纸。

当然，序列化也是如此，它并没有阻止它们，但仍然：没有属性。阅读文档。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-04-09T14:13:41.583

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T13:11:13.190

我在这个问题上支持 Joel Coehoorn，很容易“伪造”这样的说法。

为什么不在函数描述中添加线程安全文本

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-24T18:43:08.917

可以通过串行方式对您的对象进行所有访问，`IContributeObjectSink/IContextAttribute`尽管这会受到很大的性能影响，因为它需要您的对象进行子类化`MarshalByRefObject`、上下文创建开销等......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-04-18T17:27:44.423

要将类标记为线程安全的，您可以使用命名空间中的类级别`[Synchronization]`属性`System.Runtime.Remoting.Contexts`。请注意从 继承您的类 `ContextBoundObject`以使其与上下文相关。

```
using System.Runtime.Remoting.Contexts;

// Every member of this class is thread-safe... 
[Synchronization]
public class ThreadSafeClass: ContextBoundObject
{
        // Some functionality... 

} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-18T13:13:35.663

没有使类同步的用例场景，就方法而言，您使用以下编码风格：

```
using System.Runtime.CompilerServices;
[MethodImpl(MethodImplOptions.Synchronized)]   
void MyMethod()   
{   
DoSomething();   
} 
```

# linq - Linq to NHibernate 在 2.1 Alpha 版本中吗？

> ID：658168
> 
> 赞同：5
> 
> 时间：2009-03-18T12:59:21.097
> 
> 标签：linq, nhibernate, linq-to-nhibernate

所以 nHibernate 2.1 Alpha 几天前就出来了，但是 sourceforge 上的公告没有提到附加功能。特别是，它没有提到是否包含 LINQ。我知道我已经读过 LINQ 将成为 2.1 的一部分，但那是 6 个月前的事了。有人知道 LINQ 是否在 2.1 中或有哪些新功能？官方网站上没有关于 2.1 alpha 功能的文档。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-18T14:43:29.177

LinqToNHibernate由[IMeta](http://blogs.imeta.co.uk/sstrong/archive/2009/03/09/628.aspx)的 Steve Strong 编写。Steve 正在尝试一项了不起的任务，他将 NHibernate 解析 HQL 从基于字符串的系统转换为抽象语法树的方式。公平地说，他确实有一个先机，因为这是在 Hibernate 中使用他正在移植到 .Net 的[ANTLR完成的。](http://www.antlr.org/)我仍然对他所做的事情感到困惑。我必须对[IMeta](http://www.imeta.co.uk/)表示干得好，因为它给了史蒂夫时间来解决这个问题。

如果你想看看他能走多远，你可以查看[uNhAddIns 存储库](http://code.google.com/p/unhaddins/)。

还有一个可行的 LinqToNHibernate 提供程序，您可以在[NHContrib](http://nhcontrib.wiki.sourceforge.net/)中找到它

# wpf - XAML 中只读属性的 OneWayToSource 绑定

> ID：658170
> 
> 赞同：89
> 
> 时间：2009-03-18T13:02:03.587
> 
> 标签：wpf, data-binding, xaml, readonly

我正在尝试`Readonly`使用 as 模式绑定到属性`OneWayToSource`，但似乎这无法在 XAML 中完成：

```
<controls:FlagThingy IsModified="{Binding FlagIsModified, 
                                          ElementName=container, 
                                          Mode=OneWayToSource}" /> 
```

我得到：

> 无法设置属性“FlagThingy.IsModified”，因为它没有可访问的集访问器。

`IsModified`是只读`DependencyProperty`的`FlagThingy`。我想将该值绑定到`FlagIsModified`容器上的属性。

要清楚：

```
FlagThingy.IsModified --> container.FlagIsModified
------ READONLY -----     ----- READWRITE -------- 
```

这可能只使用 XAML 吗？

* * *

**更新：**好吧，我通过在容器上而不是在`FlagThingy`. 但我仍然想知道这是否可能。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-03-18T15:11:02.090

OneWayToSource 的一些研究结果...

选项1。

```
// Control definition
public partial class FlagThingy : UserControl
{
    public static readonly DependencyProperty IsModifiedProperty = 
            DependencyProperty.Register("IsModified", typeof(bool), typeof(FlagThingy), new PropertyMetadata());
} 
```

```
<controls:FlagThingy x:Name="_flagThingy" /> 
```

```
// Binding Code
Binding binding = new Binding();
binding.Path = new PropertyPath("FlagIsModified");
binding.ElementName = "container";
binding.Mode = BindingMode.OneWayToSource;
_flagThingy.SetBinding(FlagThingy.IsModifiedProperty, binding); 
```

选项#2

```
// Control definition
public partial class FlagThingy : UserControl
{
    public static readonly DependencyProperty IsModifiedProperty = 
            DependencyProperty.Register("IsModified", typeof(bool), typeof(FlagThingy), new PropertyMetadata());

    public bool IsModified
    {
        get { return (bool)GetValue(IsModifiedProperty); }
        set { throw new Exception("An attempt ot modify Read-Only property"); }
    }
} 
```

```
<controls:FlagThingy IsModified="{Binding Path=FlagIsModified, 
    ElementName=container, Mode=OneWayToSource}" /> 
```

选项#3（真正的只读依赖属性）

System.ArgumentException：“IsModified”属性不能是数据绑定的。

```
// Control definition
public partial class FlagThingy : UserControl
{
    private static readonly DependencyPropertyKey IsModifiedKey =
        DependencyProperty.RegisterReadOnly("IsModified", typeof(bool), typeof(FlagThingy), new PropertyMetadata());

    public static readonly DependencyProperty IsModifiedProperty = 
        IsModifiedKey.DependencyProperty;
} 
```

```
<controls:FlagThingy x:Name="_flagThingy" /> 
```

```
// Binding Code
Same binding code... 
```

反射器给出了答案：

```
internal static BindingExpression CreateBindingExpression(DependencyObject d, DependencyProperty dp, Binding binding, BindingExpressionBase parent)
{
    FrameworkPropertyMetadata fwMetaData = dp.GetMetadata(d.DependencyObjectType) as FrameworkPropertyMetadata;
    if (((fwMetaData != null) && !fwMetaData.IsDataBindingAllowed) || dp.ReadOnly)
    {
        throw new ArgumentException(System.Windows.SR.Get(System.Windows.SRID.PropertyNotBindable, new object[] { dp.Name }), "dp");
    }
 .... 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2011-08-29T07:29:09.977

这是 WPF 的限制，这是设计使然。据报道在这里连接：
[OneWayToSource binding from a readonly dependency property](http://connect.microsoft.com/VisualStudio/feedback/details/540833/onewaytosource-binding-from-a-readonly-dependency-property)

我制定了一个解决方案，能够动态地将只读依赖属性推送到`PushBinding`我[在此处写过的博客](http://meleak.wordpress.com/2011/08/28/onewaytosource-binding-for-readonly-dependency-property/)中调用的源。下面的示例执行`OneWayToSource`从只读 DP到 Width`ActualWidth`和`ActualHeight`Height 属性的绑定`DataContext`

```
<TextBlock Name="myTextBlock">
    <pb:PushBindingManager.PushBindings>
        <pb:PushBinding TargetProperty="ActualHeight" Path="Height"/>
        <pb:PushBinding TargetProperty="ActualWidth" Path="Width"/>
    </pb:PushBindingManager.PushBindings>
</TextBlock> 
```

`PushBinding`通过使用两个依赖属性，Listener 和 Mirror 来工作。侦听器绑定`OneWay`到 TargetProperty，并在其中更新绑定到 Binding 中指定的任何内容`PropertyChangedCallback`的 Mirror 属性。`OneWayToSource`

[演示项目可以在这里下载。](https://www.dropbox.com/s/eqkmsp0q7hb568z/PushBindingInStyleDemo.zip?dl=0)
它包含源代码和简短的示例用法。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2016-02-03T11:26:29.543

写了这个：

用法：

```
<TextBox Text="{Binding Text}"
         p:OneWayToSource.Bind="{p:Paths From={x:Static Validation.HasErrorProperty},
                                         To=SomeDataContextProperty}" /> 
```

代码：

```
using System;
using System.Windows;
using System.Windows.Data;
using System.Windows.Markup;

public static class OneWayToSource
{
    public static readonly DependencyProperty BindProperty = DependencyProperty.RegisterAttached(
        "Bind",
        typeof(ProxyBinding),
        typeof(OneWayToSource),
        new PropertyMetadata(default(Paths), OnBindChanged));

    public static void SetBind(this UIElement element, ProxyBinding value)
    {
        element.SetValue(BindProperty, value);
    }

    [AttachedPropertyBrowsableForChildren(IncludeDescendants = false)]
    [AttachedPropertyBrowsableForType(typeof(UIElement))]
    public static ProxyBinding GetBind(this UIElement element)
    {
        return (ProxyBinding)element.GetValue(BindProperty);
    }

    private static void OnBindChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        ((ProxyBinding)e.OldValue)?.Dispose();
    }

    public class ProxyBinding : DependencyObject, IDisposable
    {
        private static readonly DependencyProperty SourceProxyProperty = DependencyProperty.Register(
            "SourceProxy",
            typeof(object),
            typeof(ProxyBinding),
            new PropertyMetadata(default(object), OnSourceProxyChanged));

        private static readonly DependencyProperty TargetProxyProperty = DependencyProperty.Register(
            "TargetProxy",
            typeof(object),
            typeof(ProxyBinding),
            new PropertyMetadata(default(object)));

        public ProxyBinding(DependencyObject source, DependencyProperty sourceProperty, string targetProperty)
        {
            var sourceBinding = new Binding
            {
                Path = new PropertyPath(sourceProperty),
                Source = source,
                Mode = BindingMode.OneWay,
            };

            BindingOperations.SetBinding(this, SourceProxyProperty, sourceBinding);

            var targetBinding = new Binding()
            {
                Path = new PropertyPath($"{nameof(FrameworkElement.DataContext)}.{targetProperty}"),
                Mode = BindingMode.OneWayToSource,
                Source = source
            };

            BindingOperations.SetBinding(this, TargetProxyProperty, targetBinding);
        }

        public void Dispose()
        {
            BindingOperations.ClearAllBindings(this);
        }

        private static void OnSourceProxyChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            d.SetCurrentValue(TargetProxyProperty, e.NewValue);
        }
    }
}

[MarkupExtensionReturnType(typeof(OneWayToSource.ProxyBinding))]
public class Paths : MarkupExtension
{
    public DependencyProperty From { get; set; }

    public string To { get; set; }

    public override object ProvideValue(IServiceProvider serviceProvider)
    {
        var provideValueTarget = (IProvideValueTarget)serviceProvider.GetService(typeof(IProvideValueTarget));
        var targetObject = (UIElement)provideValueTarget.TargetObject;
        return new OneWayToSource.ProxyBinding(targetObject, this.From, this.To);
    }
} 
```

尚未在样式和模板中对其进行测试，猜测它需要特殊的外壳。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-06-20T01:10:34.270

这是另一个基于 SizeObserver 的附加属性解决方案，详细信息在此处[将只读 GUI 属性推回 ViewModel](https://stackoverflow.com/questions/1083224/pushing-read-only-gui-properties-back-into-viewmodel)

```
public static class MouseObserver
{
    public static readonly DependencyProperty ObserveProperty = DependencyProperty.RegisterAttached(
        "Observe",
        typeof(bool),
        typeof(MouseObserver),
        new FrameworkPropertyMetadata(OnObserveChanged));

    public static readonly DependencyProperty ObservedMouseOverProperty = DependencyProperty.RegisterAttached(
        "ObservedMouseOver",
        typeof(bool),
        typeof(MouseObserver));

    public static bool GetObserve(FrameworkElement frameworkElement)
    {
        return (bool)frameworkElement.GetValue(ObserveProperty);
    }

    public static void SetObserve(FrameworkElement frameworkElement, bool observe)
    {
        frameworkElement.SetValue(ObserveProperty, observe);
    }

    public static bool GetObservedMouseOver(FrameworkElement frameworkElement)
    {
        return (bool)frameworkElement.GetValue(ObservedMouseOverProperty);
    }

    public static void SetObservedMouseOver(FrameworkElement frameworkElement, bool observedMouseOver)
    {
        frameworkElement.SetValue(ObservedMouseOverProperty, observedMouseOver);
    }

    private static void OnObserveChanged(DependencyObject dependencyObject, DependencyPropertyChangedEventArgs e)
    {
        var frameworkElement = (FrameworkElement)dependencyObject;
        if ((bool)e.NewValue)
        {
            frameworkElement.MouseEnter += OnFrameworkElementMouseOverChanged;
            frameworkElement.MouseLeave += OnFrameworkElementMouseOverChanged;
            UpdateObservedMouseOverForFrameworkElement(frameworkElement);
        }
        else
        {
            frameworkElement.MouseEnter -= OnFrameworkElementMouseOverChanged;
            frameworkElement.MouseLeave -= OnFrameworkElementMouseOverChanged;
        }
    }

    private static void OnFrameworkElementMouseOverChanged(object sender, MouseEventArgs e)
    {
        UpdateObservedMouseOverForFrameworkElement((FrameworkElement)sender);
    }

    private static void UpdateObservedMouseOverForFrameworkElement(FrameworkElement frameworkElement)
    {
        frameworkElement.SetCurrentValue(ObservedMouseOverProperty, frameworkElement.IsMouseOver);
    }
} 
```

声明受控制的附加属性

```
<ListView ItemsSource="{Binding SomeGridItems}"                             
     ut:MouseObserver.Observe="True"
     ut:MouseObserver.ObservedMouseOver="{Binding IsMouseOverGrid, Mode=OneWayToSource}"> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-09-08T13:22:49.780

这是绑定到 Validation.HasError 的另一个实现

```
public static class OneWayToSource
{
    public static readonly DependencyProperty BindingsProperty = DependencyProperty.RegisterAttached(
        "Bindings",
        typeof(OneWayToSourceBindings),
        typeof(OneWayToSource),
        new PropertyMetadata(default(OneWayToSourceBindings), OnBinidngsChanged));

    public static void SetBindings(this FrameworkElement element, OneWayToSourceBindings value)
    {
        element.SetValue(BindingsProperty, value);
    }

    [AttachedPropertyBrowsableForChildren(IncludeDescendants = false)]
    [AttachedPropertyBrowsableForType(typeof(FrameworkElement))]
    public static OneWayToSourceBindings GetBindings(this FrameworkElement element)
    {
        return (OneWayToSourceBindings)element.GetValue(BindingsProperty);
    }

    private static void OnBinidngsChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        ((OneWayToSourceBindings)e.OldValue)?.ClearValue(OneWayToSourceBindings.ElementProperty);
        ((OneWayToSourceBindings)e.NewValue)?.SetValue(OneWayToSourceBindings.ElementProperty, d);
    }
}

public class OneWayToSourceBindings : FrameworkElement
{
    private static readonly PropertyPath DataContextPath = new PropertyPath(nameof(DataContext));
    private static readonly PropertyPath HasErrorPath = new PropertyPath($"({typeof(Validation).Name}.{Validation.HasErrorProperty.Name})");
    public static readonly DependencyProperty HasErrorProperty = DependencyProperty.Register(
        nameof(HasError),
        typeof(bool),
        typeof(OneWayToSourceBindings),
        new FrameworkPropertyMetadata(default(bool), FrameworkPropertyMetadataOptions.BindsTwoWayByDefault));

    internal static readonly DependencyProperty ElementProperty = DependencyProperty.Register(
        "Element",
        typeof(UIElement),
        typeof(OneWayToSourceBindings),
        new PropertyMetadata(default(UIElement), OnElementChanged));

    private static readonly DependencyProperty HasErrorProxyProperty = DependencyProperty.RegisterAttached(
        "HasErrorProxy",
        typeof(bool),
        typeof(OneWayToSourceBindings),
        new PropertyMetadata(default(bool), OnHasErrorProxyChanged));

    public bool HasError
    {
        get { return (bool)this.GetValue(HasErrorProperty); }
        set { this.SetValue(HasErrorProperty, value); }
    }

    private static void OnHasErrorProxyChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        d.SetCurrentValue(HasErrorProperty, e.NewValue);
    }

    private static void OnElementChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        if (e.NewValue == null)
        {
            BindingOperations.ClearBinding(d, DataContextProperty);
            BindingOperations.ClearBinding(d, HasErrorProxyProperty);
        }
        else
        {
            var dataContextBinding = new Binding
                                         {
                                             Path = DataContextPath,
                                             Mode = BindingMode.OneWay,
                                             Source = e.NewValue
                                         };
            BindingOperations.SetBinding(d, DataContextProperty, dataContextBinding);

            var hasErrorBinding = new Binding
                                      {
                                          Path = HasErrorPath,
                                          Mode = BindingMode.OneWay,
                                          Source = e.NewValue
                                      };
            BindingOperations.SetBinding(d, HasErrorProxyProperty, hasErrorBinding);
        }
    }
} 
```

xaml 中的用法

```
<StackPanel>
    <TextBox Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}">
        <local:OneWayToSource.Bindings>
            <local:OneWayToSourceBindings HasError="{Binding HasError}" />
        </local:OneWayToSource.Bindings>
    </TextBox>
    <CheckBox IsChecked="{Binding HasError, Mode=OneWay}" />
</StackPanel> 
```

此实现特定于绑定`Validation.HasError`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T13:28:49.060

WPF 不会使用 CLR 属性设置器，但似乎它会基于它进行一些奇怪的验证。

可能在您的情况下，这可以：

```
 public bool IsModified
    {
        get { return (bool)GetValue(IsModifiedProperty); }
        set { throw new Exception("An attempt ot modify Read-Only property"); }
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-27T22:10:22.927

嗯...我不确定我是否同意这些解决方案中的任何一个。在你的属性注册中指定一个忽略外部变化的强制回调怎么样？例如，我需要实现一个只读的 Position 依赖属性来获取 MediaElement 控件在用户控件中的位置。我是这样做的：

```
 public static readonly DependencyProperty PositionProperty = DependencyProperty.Register("Position", typeof(double), typeof(MediaViewer),
        new FrameworkPropertyMetadata(0d, FrameworkPropertyMetadataOptions.BindsTwoWayByDefault | FrameworkPropertyMetadataOptions.Journal, OnPositionChanged, OnPositionCoerce));

    private static void OnPositionChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        var ctrl = d as MediaViewer;
    }

    private static object OnPositionCoerce(DependencyObject d, object value)
    {
        var ctrl = d as MediaViewer;
        var position = ctrl.MediaRenderer.Position.TotalSeconds;

        if (ctrl.MediaRenderer.NaturalDuration.HasTimeSpan == false)
            return 0d;
        else
            return Math.Min(position, ctrl.Duration);
    }

    public double Position
    {
        get { return (double)GetValue(PositionProperty); }
        set { SetValue(PositionProperty, value); }
    } 
```

换句话说，只需忽略更改并返回由没有 public 修饰符的不同成员支持的值。-- 在上面的例子中，MediaRenderer 实际上是私有的 MediaElement 控件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-07-23T20:36:06.533

我解决这个限制的方法是在我的类中只公开一个 Binding 属性，使 DependencyProperty 完全保持私有。我实现了一个“PropertyBindingToSource”只写属性（这不是 DependencyProperty），它可以设置为 xaml 中的绑定值。在这个只写属性的设置器中，我调用 BindingOperations.SetBinding 以将绑定链接到 DependencyProperty。

对于 OP 的具体示例，它看起来像这样：

FlatThingy 实现：

```
public partial class FlatThingy : UserControl
{
    public FlatThingy()
    {
        InitializeComponent();
    }

    public Binding IsModifiedBindingToSource
    {
        set
        {
            if (value?.Mode != BindingMode.OneWayToSource)
            {
                throw new InvalidOperationException("IsModifiedBindingToSource must be set to a OneWayToSource binding");
            }

            BindingOperations.SetBinding(this, IsModifiedProperty, value);
        }
    }

    public bool IsModified
    {
        get { return (bool)GetValue(IsModifiedProperty); }
        private set { SetValue(IsModifiedProperty, value); }
    }

    private static readonly DependencyProperty IsModifiedProperty =
        DependencyProperty.Register("IsModified", typeof(bool), typeof(FlatThingy), new PropertyMetadata(false));

    private void Button_Click(object sender, RoutedEventArgs e)
    {
        IsModified = !IsModified;
    }
} 
```

请注意，静态只读 DependencyProperty 对象是私有的。在控件中，我添加了一个按钮，其单击由 Button_Click 处理。在我的 window.xaml 中使用 FlatThingy 控件：

```
<Window x:Class="ReadOnlyBinding.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="clr-namespace:ReadOnlyBinding"
    mc:Ignorable="d"
    DataContext="{x:Static local:ViewModel.Instance}"
    Title="MainWindow" Height="450" Width="800">
<Grid>
    <Grid.RowDefinitions>
        <RowDefinition />
        <RowDefinition />
    </Grid.RowDefinitions>

    <TextBlock Text="{Binding FlagIsModified}" Grid.Row="0" />
    <local:FlatThingy IsModifiedBindingToSource="{Binding FlagIsModified, Mode=OneWayToSource}" Grid.Row="1" />
</Grid> 
```

请注意，我还实现了一个用于绑定的 ViewModel，此处未显示。它公开了一个名为“FlagIsModified”的 DependencyProperty，您可以从上面的源代码中收集到。

它工作得很好，允许我以松散耦合的方式将信息从 View 推回 ViewModel，并明确定义信息流的方向。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-03-18T13:45:52.810

您现在正在错误的方向进行绑定。每当 IsModified 更改您正在创建的控件时，OneWayToSource 将尝试更新容器上的 FlagIsModified。您想要相反，即让 IsModified 绑定到 container.FlagIsModified。为此，您应该使用绑定模式 OneWay

```
<controls:FlagThingy IsModified="{Binding FlagIsModified, 
                                          ElementName=container, 
                                          Mode=OneWay}" /> 
```

枚举成员的完整列表：http: [//msdn.microsoft.com/en-us/library/system.windows.data.bindingmode.aspx](http://msdn.microsoft.com/en-us/library/system.windows.data.bindingmode.aspx)

# debugging - 加快 Jboss Seam 调试周期的技巧

> ID：658171
> 
> 赞同：4
> 
> 时间：2009-03-18T13:02:40.497
> 
> 标签：debugging, seam, performance

我们从 Eclipse 中部署和调试 Jboss Seam 2.0 EAR 应用程序，在 Jboss AS 4.2.2 上启动它。现在，每次更改消息包、pages.xml、components.xml 或模型时，我们都需要重新启动它，这最多需要 45 秒。

是否可以在热部署中包含上述文件，以及提高启动速度的选项有哪些？

作为参考，我们使用英特尔四核 6600 或更好的处理器，内存至少为 4GB。

编辑：除了热部署消息包、pages.xml、components.xml 等之外，我正在寻找提高启动速度（即 45 秒）的方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-23T12:12:40.270

多年来，这一直是 Seam 的一个突出问题：[https ://jira.jboss.org/jira/browse/EJBTHREE-1096](https://jira.jboss.org/jira/browse/EJBTHREE-1096)

这不是一个技巧——更多的是一种工作方法——但我将我所有的 UI 代码（页面处理程序等）都作为 POJO，以便它们可以轻松地进行热部署。我将任何更严肃的业务逻辑放入 SLSB/SFSB 并对它们进行彻底的单元测试，因此希望在通过 UI 测试应用程序时我的部署更少。

目前 pages.xml***可以***热部署。我已经阅读了一些重新加载消息包的解决方案，但它从来没有让我感到困扰，以至于需要进一步调查。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T13:24:00.720

当您说“重新启动”时，听起来您的意思是“关闭并重新启动 JBoss”。

您只需通过触摸文件（对于 EAR 或 WAR 存档）或部署描述符（`app.ear/META-INF/application.xml`或`app.war/WEB-INF/web.xml`）来强制 JBoss 重新加载应用程序以用于展开的存档。

在我的机器上重新加载 Seam 应用程序 EAR 大约需要 15 秒，而启动 JBoss 大约需要 30 秒，不包括关闭但包括启动 Seam 应用程序。

如果您确实想重新启动 JBoss，您可以通过删除开发环境中不需要的组件（例如 JBossHA（高可用性和集群））来加快它的启动速度。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-09-06T12:17:46.437

自从将 JRebel 与 JBoss 一起使用以来，我节省了很多时间。 [http://www.zeroturnaround.com/jrebel/](http://www.zeroturnaround.com/jrebel/)

它不是免费的，但恕我直言，它是物有所值的工具之一，并且可以节省大量重启时间，只需进行少量更改即可重新部署应用程序。

例如，它重新加载messages.properties。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T13:36:51.707

在这 45 秒内它在做什么？如果它是从硬盘驱动器加载数据，那么你可以投资一个更快的。如今，非 SSD 硬盘驱动器仍然是一个瓶颈。虽然时间指出了其他一些问题......

我认为您最好在以下位置打开（或查找）问题：
[https ://jira.jboss.org/jira/browse/JBSEAM](https://jira.jboss.org/jira/browse/JBSEAM)

（注意：要发布问题，您需要先登录。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T17:55:28.183

我通过转向战争并将 Jboss 剥离到最低限度来加快启动时间（因为我只使用 seam POJO 而不是 EJB）。

# wpf-controls - WPF 自定义控件资源

> ID：658175
> 
> 赞同：1
> 
> 时间：2009-03-18T13:05:42.063
> 
> 标签：wpf-controls

我有一个自定义控件，需要在代码中配置一个 MultiBinding，它需要一个 IMultiValueConverter。使用 FrameworkElement.FindResource 并要求将 Converter 定义为资源是一种好习惯，还是应该在代码中实例化转换器？

我可以在主题资源中使用它，这样它就一直存在，但这似乎有点容易出错。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T13:10:00.010

我不听你的问题，但也许我可以提供帮助。

它通常归结为转换器是否在您的控制范围之外有意义。如果没有，请在您的控制范围内声明它。如果有，为什么会这样？您是否应该公开控件上的属性而不是转换器本身？

至于如何创建它，您可能需要查看[这篇](http://www.drwpf.com/blog/Home/tabid/36/EntryID/48/Default.aspx)有助于保持 XAML 清洁的帖子。

# architecture - URL 重写场景中 URL 和 Filepath 之间的关系

> ID：658189
> 
> 赞同：0
> 
> 时间：2009-03-18T13:10:48.167
> 
> 标签：architecture, url, url-rewriting, path

经验告诉我，我不应该在我的媒体项目数据库中存储 url。

然而，这就是我的建筑师告诉我的。将文件路径映射到 url 肯定是前端服务器的工作吗？

有什么提示吗？关于 URL 重写，我应该考虑什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T13:34:17.173

上次我使用 URL 重写处理项目时 - 不，我们没有将实际的 url 存储在数据库中，但类别（或文件夹名称）确实存储在那里。这是一个电子商务网站，所以我们有这样的类别层次结构：

父类别 -> 子类别 -> 产品

这些项目中的每一个都存储在数据库中，并在网站中转换为：

[http://domain/ParentCategory/SubCateogry/Product](http://domain/ParentCategory/SubCateogry/Product)

所以没有实际的 url 不存在，但该 url 的片段肯定存在于数据库中。

# design-patterns - 将标记树解析为对象模型的设计模式

> ID：658191
> 
> 赞同：1
> 
> 时间：2009-03-18T13:11:05.560
> 
> 标签：design-patterns, parsing

我很难过，我有一个任务，我必须采取一些标记（json 格式，这并不重要）并将其解析为对象模型。我们已经有了一个域模型，它只是运行标记并创建相关对象的问题。

它并不真正适合复合模式，因为正在创建的对象并不相似。此外，标记并不那么大，只有三层深，所以我对组织模式比原始速度更感兴趣。我真的很想实现以下目标：

*   避免使用大量嵌套循环的怪物方法
*   将来易于添加新标签/对象
*   为下一个必须修改它的人清理易于阅读的代码

关于适合此的可能模式的任何建议？如果愿意，请随意以任何语言举例。

问候，

克里斯

编辑：这是标记的示例 -[链接文本](http://pastebin.com/m51d84e1d)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T13:26:33.527

好吧，如果您正在查看 JSON 或 XML 等标准标记，那么您可以使用在大多数编程语言（如 .NET C#、Java、Ruby、C++ 等）中可用的即用型低级解析器。

此类解析器使用的模式是 AbstractFactory、Composite、Singleton 和 Builder 模式的组合。

您可以参考 Java 的 SAXParser 和 SAXParser Factory 实现作为示例。

[![维基百科上的建造者模式类图](https://i.stack.imgur.com/pbzpd.png)](https://i.stack.imgur.com/pbzpd.png)
[（来源：[wikimedia.org](https://upload.wikimedia.org/wikipedia/en/6/6e/Builder2.png)）]

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-04T13:26:04.867

看看下面的链接——它涵盖了一些设计模式——并非所有都适用于你，但我猜命令、收集参数和可插入选择器可以使用。

[http://junit.sourceforge.net/doc/cookstour/cookstour.htm](http://junit.sourceforge.net/doc/cookstour/cookstour.htm)

# delphi - 为 Delphi 应用程序设置帮助

> ID：658193
> 
> 赞同：7
> 
> 时间：2009-03-18T13:11:25.217
> 
> 标签：delphi

为 Delphi 应用程序设置帮助（特别是[HTML Help ）的最佳方式是什么？](http://msdn.microsoft.com/en-us/library/ms670068(VS.85).aspx)我可以看到几个选项，所有这些都有缺点。具体来说：

1.  我可以在适当的地方在表单设计器中设置 HelpContext，但是我不得不跟踪数字而不是符号常量。
2.  我可以以编程方式设置 HelpContext。然后我可以使用符号常量，但是我有更多的代码要跟上，而且我不能轻易地检查文本 DFM 以查看哪些表单仍然需要帮助。
3.  我可以设置HelpKeyword，但由于它是关键字查找（如Application.HelpKeyword）而不是主题跳转（如Application.HelpJump），我必须确保我的每个帮助页面都有一个唯一的、不变的, 顶级关键字；这似乎是额外的工作。（还有一些与 HelpKeyword 相关的 VCL 错误，例如[this](http://qc.codegear.com/wc/qcmain.aspx?d=31175)和[this](http://qc.embarcadero.com/wc/qcmain.aspx?d=69784)。）
4.  我可以设置 HelpKeyword，设置一个 Application.OnHelp 处理程序以将 HelpKeyword 请求转换为 HelpJump 请求，以便我可以通过主题 ID 而不是关键字查找来分配帮助，并添加代码，例如我自己的帮助查看器（基于[HelpScribble 的代码](http://www.helpscribble.com/delphi-bcb.html)）来修复VCL 错误并让 HelpJump 与锚点一起工作。不过，到现在为止，我觉得我是在反对 VCL 而不是使用它。

**您为您的应用选择了哪种方法？**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-19T00:04:13.620

几年前，当我第一次开始研究如何做到这一点时，我首先从：[http ://www.ec-software.com/support_tutorials.html 获得了“Borland Delphi 中的所有关于帮助文件”教程](http://www.ec-software.com/support_tutorials.html)

在该文档中，“为上下文相关帮助准备帮助文件”部分（在我的文档版本中从第 28 页开始）。它描述了一个很好的编号方案，您可以使用它来将您的数字组织成多个部分，例如，从 100000 开始用于您的主表单，然后继续使用 101000 或 110000 用于每个辅助表单，等等。

但后来我想在我的帮助主题中使用描述性字符串 ID 而不是数字。我开始使用 THelpRouter，它是 EC Software 的免费帮助套件的一部分，位于：http: [//www.ec-software.com/downloads_delphi.html](http://www.ec-software.com/downloads_delphi.html)

但后来我选择了一个直接支持主题字符串 ID 的帮助工具（我使用解释博士：[http](http://www.drexplain.com/) ://www.drexplain.com/ ）所以现在我只使用 HelpJump，例如：

> Application.HelpJump('UGQuickStart');

我希望这会有所帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-18T13:37:16.420

我们使用符号常量。是的，这是一个多一点的工作，但它得到了回报。特别是因为我们的一些对话框是动态构建的，有时需要不同的帮助 ID。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T13:54:03.663

我创建了帮助文件，它获取帮助主题 ID，然后遍历表单并将其 HelpContext 值设置为它们。由于所需的维护级别非常低 - 除非发生重大事件，否则表单不太可能更改帮助文件上下文 - 这很好用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T14:44:06.180

我们使用Help&Manual——它是一个很棒的工具，几乎可以输出任何你想要的格式，doc、rtf、html、pdf——所有这些都来自同一个来源。它甚至会读入（或从 rtf 粘贴（例如 MSWord）。它使用主题 ID（字符串），我只保留一个列表，然后我手动将每个主题 ID 放入适合我的表单（或类）中。听起来很困难，但相信我，你会花更长的时间讨厌错误的创作工具。我花了好几年才找到它！布赖恩

# .net - WebInvoke 属性可以被绑定配置替换吗

> ID：658195
> 
> 赞同：6
> 
> 时间：2009-03-18T13:12:23.467
> 
> 标签：.net, wcf, wcf-binding

为了让 WCF 服务与 JQuery 一起工作，我在操作合同上添加了一个 WebInvoke 属性来控制 JSON 序列化，如下所示：

```
[WebInvoke(Method = "GET", ResponseFormat = WebMessageFormat.Json, BodyStyle = WebMessageBodyStyle.Bare)] 
```

有没有办法通过配置中的服务绑定来控制这种序列化，因为它限制了这个服务向不同的端点提供不同的序列化。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-03-29T05:06:30.767

我有一个不同的解决方案，它在 @Marc Gravell 的另一端工作：不是复制合同，而是从服务*实现*派生 2 个不同的类。这些只是类型别名；它们是必要的，因为 WCF 激活系统（至少在 IIS 上）不允许您在不同的 URL 激活相同的服务类型（我不确定 Gravell 的解决方案为什么没有遇到这个问题 - 我的错误当我尝试在同一站点的不同 URL 上激活相同的服务类时，得到的是“URI 的注册已经存在...”）。*请注意，如果您想同时*使用 pox 和 json 运行相同的服务，这只是一个问题。如果您只想控制响应格式，则不需要此解决方法。

我的解决方案背后的关键概念是为同一个服务使用 2 个不同的 URI，然后使用端点行为来设置默认的出站响应格式。[您可以在这个问题](https://stackoverflow.com/questions/2914633/philosophy-of-webinvokeresponseformat-webmessageformat-json)中找到更多信息，该问题还涉及概念纯度问题：我们是否应该使用合约属性来指定属于网络协议的属性？我认为 Marc Gravell 对这个问题的看法本身是有效的，但它与 WCF 的原始概念不一致，其中合约应该从协议栈中抽象出来。但是端点行为不允许您指定所有与 REST 相关的属性，您必须使用 URI 模板和入站格式的属性。

REST 是否可以以不同的方式实现？尽管 WCF 的设计者在设计通用框架方面做得非常出色，但我认为他们没有看到 REST 的到来。有些东西，比如 URI 模板，似乎确实属于合同。

说够了！这是代码。首先是 web.config 文件。这就是魔法发生的地方。请注意，我在此示例中使用基于 WCF 4 配置的激活，但您也可以通过使用 2 个 svc 文件来表示 2 个 URI 来完成相同的操作。

```
<?xml version="1.0"?>
<configuration>
  <system.web>
    <compilation debug="true" targetFramework="4.0" />
  </system.web>
  <system.serviceModel>
    <services>
      <service name="StackOverflow.QuoteOfTheDayAsJson">
        <endpoint binding="webHttpBinding" contract="StackOverflow.IQuoteOfTheDay" 
                  behaviorConfiguration="jsonBehavior" />
      </service>
      <service name="StackOverflow.QuoteOfTheDayAsPox">
        <endpoint binding="webHttpBinding" contract="StackOverflow.IQuoteOfTheDay" 
                  behaviorConfiguration="poxBehavior" />
      </service>
    </services>
    <behaviors>
      <endpointBehaviors>
        <behavior name="jsonBehavior">
          <webHttp defaultOutgoingResponseFormat="Json" />
        </behavior>
        <behavior name="poxBehavior">
          <webHttp defaultOutgoingResponseFormat="Xml"/>
        </behavior>
      </endpointBehaviors>
    </behaviors>
    <serviceHostingEnvironment multipleSiteBindingsEnabled="false">
      <serviceActivations>
        <add relativeAddress="QuoteOfTheDayJson.svc" 
             service="StackOverflow.QuoteOfTheDayAsJson"/>
        <add relativeAddress="QuoteOfTheDayPox.svc" 
             service="StackOverflow.QuoteOfTheDayAsPox"/>
      </serviceActivations>
    </serviceHostingEnvironment>
  </system.serviceModel>
</configuration> 
```

下面是代码，包括服务契约、服务实现和实现这项工作所必需的类型别名：

```
namespace StackOverflow
{
    [DataContract]
    public class Quotation
    {
        [DataMember]
        public string Text { get; set; }

        [DataMember]
        public string Author { get; set; }
    }

    [ServiceContract]
    public interface IQuoteOfTheDay
    {
        [OperationContract]
        [WebInvoke(Method="GET", UriTemplate="GetTodaysQuote")]
        Quotation GetTodaysQuote();
    }

    public class QuoteOfTheDayImp : IQuoteOfTheDay
    {
        public Quotation GetTodaysQuote()
        {
            return new Quotation()
            {
                Text = "Sometimes it's better to appologize for not asking permission",
                Author = "Admiral Grace Murray Hopper"
            };
        }
    }

    /// <summary>
    /// A type alias used for json activation
    /// </summary>
    public class QuoteOfTheDayAsJson : QuoteOfTheDayImp 
    {}

    /// <summary>
    /// A type alias used for pox activation
    /// </summary>
    public class QuoteOfTheDayAsPox : QuoteOfTheDayImp
    {}
} 
```

如果不是因为类型别名的必要性，我会说这是一个完整的解决方案。如果您不想同时支持多种格式，这是一个完整的解决方案。这优于多合约解决方案，因为只有一个合约，您不需要保持 2 个合约同步。

# c# - 在 app.config 中存储树状信息的最佳方式

> ID：658204
> 
> 赞同：1
> 
> 时间：2009-03-18T13:16:39.760
> 
> 标签：c#, .net, asp.net, c#-3.0, scsf

在 app.config 中存储像下面这样的树的最佳方法是什么，我将如何从中反序列化这些信息？

```
Tree
|-node1-
|       |-name - value
|       |-name - value
|       | ......
|-node2-
|       |-name - value
|       |-name - value
|       | ......
|-node3-
|       |-name - value
|       |-name - value
|       | ...... 
```

如果有帮助，我可以将该树转换为 xml。

感谢您提前提供任何帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T13:20:45.507

使用自定义配置部分。有关执行此操作的一种方法，请参阅[配置部分设计器](http://www.codeplex.com/csd/)。您可以手动完成，但您可能喜欢使用 CSD 并查看它生成的代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T13:21:39.373

您可以使用自己的类型扩展 .config。这些可以是包含其他元素和属性的元素。这个领域似乎没有很好的记录，但有一些例子。

从课堂开始`System.Configuration.ConfigurationElement`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-11T16:42:34.663

您可以在应用程序中使用基于 xml 的文档，扩展名为 .config（如 NLog.config ，...），并使用自定义数据提供程序来读取 xml 数据并将它们转换为树状 ds。

```
<Nodes>
    <Node Name="Node1" Value="Value1">
       <Node Name="Node1.1" Value="Value1.2">
       </Node>

       <Node Name="Node1.2" Value="Value1.2">
       </Node>
    </Node>

    <Node Name="Node2" Value="Value2">
    </Node>
</Nodes> 
```

或者您可以使用自定义配置部分

# ruby-on-rails - 在 Rails 中 has_and_belongs_to_many

> ID：658206
> 
> 赞同：22
> 
> 时间：2009-03-18T13:16:47.373
> 
> 标签：ruby-on-rails, has-and-belongs-to-many

在 rails 中使用 has_and_belongs_to_many 关联而不是 has_many :through 有什么明显错误吗？我知道[这些](http://blog.hasmanythrough.com/2006/4/20/many-to-many-dance-off) [描述差异和解决方法的](http://blog.hasmanythrough.com/2006/08/19/magic-join-model-creation)[文章](http://blog.hasmanythrough.com/2006/4/17/join-models-not-proxy-collections) ，但它们是从 2006 年开始的。从我在 SO 上阅读的内容来看，似乎人们认为 habtm 既旧又笨重，但如果一个简单的多对多加入没有必要的模型是你要找的吗？

想法？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-18T13:22:33.193

has_and_belongs_to_many 用于简单的多对多关系。

has_many :through 另一方面，用于间接的一对多关系，或与属性的多对多关系。

如果您只是在寻找简单的多对多关系，我看不出有任何理由不使用 has_and_belongs_to_many。

**多对多关系示例：**

用户属于零个或多个组，组有零个或多个成员（用户）。

**与属性的多对多关系示例：**

用户属于零个或多个组，组有零个或多个具有等级的成员。

例如，Alice 可能是组 A 中的管理员和组 B 中的主持人。您可以在连接表中保留此属性。

**间接一对多关系示例：**

一个类别有零个或多个子类别，每个子类别有零个或多个项目。

因此，一个类别通过其子类别具有零个或多个项目。

考虑以下类别：

> 食品→水果、蔬菜
> 水果→苹果、橙子等
> 蔬菜→胡萝卜、芹菜等

所以：

> 食物→苹果、橙子、胡萝卜、芹菜等

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-18T13:36:48.900

`has_and_belongs_to_many`如果您不需要连接模型，则使用没有任何问题。我刚刚在最近的一个项目中使用了它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-18T20:54:14.200

我永远不会使用HABTM，不是因为担心优雅，而是因为我总是可以想象将来想在关系中添加数据，即使我现在看不到重点。懒惰的我希望能够将列添加到连接中，而不必重新处理关系然后添加列。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-05-25T03:30:17.100

我是这样想的。假设您已经发现需要一个多对多模型：

```
X----1
  __/
 /
Y----2
  __/
 /  
Z----3 
```

(x->1 y->1,2 z->2,3)

如果您不需要存储关于我上面（希望可识别）图片中每一行的信息，请使用 HABTM 关系。

如果您需要存储有关这些行（关系）的信息，请使用“通过”。

因此，如果您只是说人 [XYZ] 拥有并属于项目 [123]，但不需要在项目 1 中提及人 X，请使用 HABTM。

如果你想说那个人 X 有项目 1 并且*在给定日期*被分配了那个项目，那么你突然之间就有了一个适合这种特定关系的关系并更好地使用 HMT。

# html - 字段集是否必须在表单中？

> ID：658208
> 
> 赞同：24
> 
> 时间：2009-03-18T13:17:29.227
> 
> 标签：html

我对DTD一无所知。

[http://www.bls.gov/oco/ocos292.htm](http://www.bls.gov/oco/ocos292.htm)

在此页面上查看 fieldset 如何在表单之外使用，这很酷！我喜欢这种风格！

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-03-18T13:38:45.917

我认为这个问题中的问题和选择的答案具有误导性。a 是否`form`必须有 a`fieldset`以及 a 是否`fieldset`必须在 a`form`中是两个不同的问题，有两个不同的答案。

根据 HTML4.01 规范，字段集是表单内的有效元素，但由于它是标准块级元素，因此在其他地方也可以接受：http: [//www.w3.org/TR/html401/交互/forms.html#h-17.10](http://www.w3.org/TR/html401/interact/forms.html#h-17.10) [http://www.w3.org/TR/html401/sgml/dtd.html#block](http://www.w3.org/TR/html401/sgml/dtd.html#block)

但是，我无法想象这样的用例，除非您使用字段集进行装饰，否则使用不正确。

但是，表单不需要字段集：http: [//www.w3.org/TR/html401/interact/forms.html#h-17.3](http://www.w3.org/TR/html401/interact/forms.html#h-17.3)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2017-08-18T01:37:06.803

颠簸，因为没有人为字段集无表单提供有效的用例。使用没有表单的字段集的一个正当理由是当您使用输入来收集信息以进行动态显示时。输入的每次更改都会使显示的信息有所不同。填写表格并点击提交是没有意义的。您可以在字段集周围放置一个表单，但它没有用。然而，字段集在视觉上对用于控制显示（或游戏或其他）的输入进行分组。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-18T13:37:24.843

[`FIELDSET`](http://www.w3.org/TR/html401/interact/forms.html#edef-FIELDSET)是一个常规的[块级元素](http://www.w3.org/TR/html401/sgml/dtd.html#block)，可以在允许块级元素的任何地方使用（除了在[`BUTTON`元素](http://www.w3.org/TR/html401/interact/forms.html#edef-BUTTON)中）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-23T16:07:59.237

如果您将字段集放在表单之外，则页面会验证，但我看不出有什么好的理由这样做，如果您阅读**[xhtml 1.0 DTD](http://www.w3.org/TR/xhtml1/dtds.html)**，您会在字段集部分找到以下注释：

> fieldset 元素用于对表单字段进行分组。内容中只能出现一个图例元素，如果存在，则只能在前面加上空格。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-18T13:21:52.710

不，您不需要表单中的字段集。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-07-09T22:41:45.880

HTML5 为 fieldset 添加了新属性：

form_id - 指定字段集所属的一个或多个表单

[http://www.w3schools.com/tags/tag_fieldset.asp](http://www.w3schools.com/tags/tag_fieldset.asp)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-07-29T16:55:35.320

它不必在表单内，但最好至少与带有`form="[form_ID]"`.

一个有效的用例是当您有多组控件分布在非表单内容中时。在这种情况下，您通常必须将所有相关或不相关的内容放在表单中（坏）或一遍又一遍地重复相同的表单（奇怪）。

而只是将所有字段集链接到单个表单要容易得多。

示例：在每个部分之后需要一些反馈的测试或民意调查或诸如此类的东西。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-18T13:19:46.320

是的，因为 fieldset 元素用于对相关的表单字段进行分组。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-08-27T06:44:29.733

我使用表单外部的字段集将自定义 jquery 数据表过滤器组合在一起。我在字段集中有几个“选择”下拉元素，每个元素用于不同的过滤类别。I had onchange events attached to each dropdown so that when something was selected the rows in the data table would be filtered accordingly. 现在使用 javascript/jquery 似乎不需要实际的表单标签。

# reporting-services - RSKeyMgmt -r 无法删除安装 ID

> ID：658225
> 
> 赞同：0
> 
> 时间：2009-03-18T13:20:50.217
> 
> 标签：reporting-services

我已经在一个上备份了数据库，`2005 SQL Server`并在第二个上恢复了这些数据库`2005 SQL Server`。我目前正在尝试使用`Reporting Services Key Manager`( `RSKeyMgmt -r`) 删除新服务器的 OLD 密钥实例 ID。

在运行删除命令之前，当前实例列表显示新服务器的旧实例 ID 以及来自第一个 SQL Server 的新实例 ID。执行`RSKeyMgmt -r`命令会导致：

> 命令成功完成

但是，当我重新检查当前实例 ID 的列表时，我会同时看到 OLD 和 NEW 实例 ID。此外，当我检查应用程序事件查看器时，我看到一个错误：

> 报表服务器 Windows 服务 (MSSQLSERVER) 未被授予对目录内容的访问权限

有谁知道为什么我会收到上述应用程序错误？

或者...有谁知道我需要做什么才能将目录访问权限授予报表服务器窗口服务？

备份数据库的第一个 SQL Server 是企业版 SQL Server，而恢复数据库的第二个 SQL Server 是`Standard edition`. 这可能是问题的原因吗？有没有办法让这个备份和恢复迁移工作？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-20T20:43:46.570

原来/旧的 TFS 环境没有设置任何自定义报告，并且报告服务器的加密是不必要的。所以我最终只是删除了加密密钥。这让我绕过了这个问题。

# c# - 如何在列表上实现增量搜索

> ID：658235
> 
> 赞同：8
> 
> 时间：2009-03-18T13:22:40.650
> 
> 标签：c#, .net, search

我想在字符串列表上实现增量搜索。考虑我有一个数组，其中包含字符串 store、state、stamp、crawl、crow。我的应用程序有一个文本框，用户可以在其中输入搜索字符串。现在，当用户输入文本时，我需要突出显示所有匹配项。例如，当用户输入“st”时，我现在需要在输入“a”时突出显示“Store,state,stamp”，我需要从列表中删除“Store”。我正在使用 c# 和 .net 开发应用程序框架。我打算做的是，在文本更改的事件中，我在后台进行搜索并显示结果。有没有其他方法可以解决这个问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T13:52:26.023

You could just look at the newly entered letter; if the new third letter is an 'a' just throw out all elements without 'a' at position three. If the user deletes a letter you have to rescan the whole original list and bring back all priviously removed items.

But what if the user pastes multiple letters from the clipboard, deletes multiple letters by selecting them, inserts or deletes a single or multiple letters somewhere in the middle?

You have just to many cases to watch for. You could do the method with the newly entered letter an fall back to a complete rescan if the search text changed in a way other than adding a single letter, but even this simple method is probably not worth the effort just to avoid a few ten or hundred string comparisons. As already mentioned, a [Trie](http://en.wikipedia.org/wiki/Trie) or [Patricia trie](http://en.wikipedia.org/wiki/Radix_tree) is the way to go if you have really large data sets or want to be really quick.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-18T15:01:02.207

过去我不得不使用包含大约 500,000 个单词的集合来做类似的事情。我发现有[向无环词图](http://en.wikipedia.org/wiki/Directed_acyclic_graph)效果很好。DAWG 的性能与 trie 大致相同，但空间效率更高。但是，实现起来稍微复杂一些。

不幸的是，我的工作是用 C 语言编写的，我没有很好的 C# DAWG 实现参考。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T13:38:31.220

如果您的列表可以增长到显着长度（超过数百个条目），则[trie 数据结构可以很好地扩展。](http://en.wikipedia.org/wiki/Trie)查看例如[这个示例实现](http://www.koders.com/csharp/fid5C76413E2B0F5B83CEB84CB3DD9E38437858DBD2.aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T13:30:17.467

下面是一个函数，它将逐步搜索字符串以查找要匹配的子字符串。

```
public IEnumerable<int> FindAllMatches(string toMatch, string source) {
  var last = 0;
  do {
    var cur = source.IndexOf(toMatch,last);
    if ( cur < 0 ) {
      break;
    }
    yield return cur;
    last = cur + toMatch.Length;
  while(true);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T13:35:39.433

您可以使用通用集合来代替字符串数组。这样，您可以使用 FindAll 方法和委托来搜索项目。

```
string searchString = "s";
List<string> sl = new List<string>();
sl.Add("store");
sl.Add("state");
sl.Add("stamp");
sl.Add("crawl");
sl.Add("crow");
List<string> searchResults = sl.FindAll(delegate(string match) 
                                                { 
                                                    return   match.StartsWith(searchString, StringComparison.CurrentCultureIgnoreCase); 
                                                }); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-03-20T22:27:13.007

好吧，我已经为这个问题实现了一个 Trie 和一个 DAWG，我偶然发现了 2 个挠头：

1) DAWG -->**有向无环**字图。您如何使用“bot”和“boot”之类的词创建此图/遍历它，启动中的“oo”会导致基于 DAWG 的循环 2) Trie 消除了此问题，但随后引入了一些分支管理问题。

构建图表比实际使用它来生成您想要的单词要容易得多（IMO），而且不会产生更多的运行时间。

我仍在努力。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-18T16:54:33.340

哇...

只需使用文本框上的内置自动完成功能。您可以向它提供您的单词列表，它会为您进行匹配。

# javascript - 调试消息“资源解释为其他但使用 MIME 类型应用程序/javascript 传输”

> ID：658238
> 
> 赞同：64
> 
> 时间：2009-03-18T13:26:09.130
> 
> 标签：javascript, apache, safari, mime-types

好的，我了解这些消息的*含义*，但我真的不确定是什么原因造成的。顺便说一句，我在 Mac OS X 上使用 Safari 和 Web Inspector。

我的文档头中有以下内容：

```
<script src="http://local.url/a/js/jquery.js" type="text/javascript"></script>
<script src="http://local.url/a/js/jquery.inplace.js" type="text/javascript"></script> 
```

`jquery.js`处理得很好，但另一个文件会导致警告。这个文件中的 javascript 似乎也永远不会被执行。

该文件是通过 提供的`mod_deflate`，因此它是 gzip 编码的，但另一个文件也是如此。

有没有人知道是什么原因造成的，或者如何解决它？

干杯，盖兹。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2010-03-30T02:07:23.763

具有空“src”属性的图像在 Windows-Chrome 下会生成此错误：

```
<img src=""> 
```

... 然而 ...

```
<img> 
```

... 才不是。

我来到这里是因为我的 ajax 结果集返回的是空的“src”数据，但 img 仍被插入到页面中。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2011-02-22T23:21:16.727

解决了！

我有这个错误好几天了。这让我发疯，因为它不允许我使用 firefox firebug 的脚本调试器。**最后，当我在 "background-image: url()" 样式属性中**删除一个空 url 时，我的错误得到了解决。

这比我真的希望有人可以使用这个建议更痛苦。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-01-02T05:11:55.827

我不认为这是一个错误，尝试将 MIME 类型添加到您的 .htaccess 文件例如，将以下内容放入或添加到您的 .htaccess 文件（应该与您的 .js 或以上文件夹相同的位置）

```
#JavaScript
AddType application/x-javascript .js 
```

这解决了我的树“资源解释为其他但已转移......”警告。每次您收到这种警告时，都意味着您的 .htaccess 文件中没有足够的信息。

~~BTW1：由于您正在修改 .htaccess 文件，请确保重新启动服务器。~~

BTW2：我也可以使用以下命令清除 Safari 4 中 GIF 文件的相同警告：

```
#GIF
AddType image/gif .gif 
```

BTW3：对于其他文件类型：请参阅[w3schools 列表](http://www.w3schools.com/media/media_mimeref.asp)或[htaccess-guide](http://www.htaccess-guide.com/adding-mime-types/)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-18T14:58:57.703

似乎是 safari / webkit 中的一个错误。也许[这个](https://bugs.webkit.org/show_bug.cgi?id=22994)，或者其中[任何一个](https://bugs.webkit.org/buglist.cgi?query_format=specific&order=relevance+desc&bug_status=__open__&product=WebKit&content=Resource+interpreted+as+other)。尝试升级您的 Safari。如果没有更新的稳定版本，请尝试 4 beta。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-05-03T08:28:04.023

出现此警告是因为未指定默认脚本类型。尝试将以下指令添加到您的 HTML 文件中：

`<meta http-equiv="content-script-type" content="text/javascript">`

您可以在此处阅读有关默认脚本规范的更多信息：http: [//www.w3.org/TR/REC-html40/interact/scripts.html#h-18.2.2.1](http://www.w3.org/TR/REC-html40/interact/scripts.html#h-18.2.2.1)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-09T15:54:11.563

您需要使用工具来查看随文件发送的 HTTP 标头，我使用的是[LiveHTTPHeaders](https://addons.mozilla.org/en-US/firefox/addon/3829)或[HTTPFox 之类的工具。](https://addons.mozilla.org/en-US/firefox/addon/6647)如果文件是从没有 MIME 类型或默认 MIME 类型（如 text/plain）的 Web 服务器发送的，则可能是此错误的原因。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-05-01T15:48:41.720

这是因为文件名中的句点。这很愚蠢，但是只要 js 文件名中有句点，您就会收到此错误，而且我遇到过它实际上会阻止 js 文件加载的情况。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-06-11T03:23:06.370

这似乎是 Safari 缓存处理策略中的一个错误。

apache中的解决方法：

```
Header unset ETag
Header unset Last-Modified 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-06-12T03:29:38.947

我刚刚得到这个并在我的mac上本地解决了它。由于某种原因，有问题的 javascript 文件具有错误的权限。我注意到当我在萤火虫中查看它时，我得到了 403。我希望这对任何人都有帮助。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-06-10T14:53:29.317

我在使用 css 文件而不是 javascript 时遇到了同样的问题。（使用 xitami 网络服务器）

对我来说固定的是在 xitami.cfg 的 MIME 部分下添加：

css=文本/css

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-03-22T10:37:48.727

我发现我的 css 文件的命名与代理过滤器冲突

www.dating.com（不是我的网站）被屏蔽了，我的 css 和 js 文件被称为 dating.css 和 dating.js。过滤器阻止了这一点。也许你们中的一些人就是这种情况，在公司系统上工作。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-11-23T08:10:01.423

这个错误似乎重新出现（2010 年 11 月注意到）

我认为涉及的 WebKit 错误报告是[this](https://bugs.webkit.org/show_bug.cgi?id=26572)和[this](https://bugs.webkit.org/show_bug.cgi?id=46968)。本质上，它归结为在`If-Modified-Since`获取`304`响应时不正确的缓存处理。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-12-21T20:22:51.273

Mac 上此错误的另一个常见原因是 Apple 的隔离标志。

`ls`包含相关资源的目录。如果您看到扩展属性指示符，即`@`权限块末尾的小符号（例如`-rw-r--r--@`），则该文件可能被隔离。

尝试`ls -la@e`寻找`com.apple.quarantine`

以下命令将删除隔离区：

```
xattr -d com.apple.quarantine /path/to/file 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-01-23T16:18:23.387

造成这种情况的原因似乎很多。对我来说，这是 IIS 中的小写重写规则。将问题文件（js 和 png）更改为小写，问题就消失了。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-08-20T14:47:34.440

**在 APACHE 上**

将这些 MIME 类型附加到根目录中的 .htaccess 中。我推荐第二行，因为它可能有助于防止任何未来的潜在 MIME 解释警告与 CSS 文件。

```
AddType application/x-javascript .js
AddType text/css .css 
```

重启你的 Apache...

**在 NGINX 上**

添加到您的 nginx.conf 或 mime.types 导入文件（推荐方法）。根据需要/相关添加任何或全部。

```
types {
    text/html                             html htm shtml;
    text/css                              css;
    text/xml                              xml;
    image/gif                             gif;
    image/jpeg                            jpeg jpg;
    application/x-javascript              js;
    application/rss+xml                   rss;
    text/plain                            txt;
    image/png                             png;
    image/tiff                            tif tiff;
    image/svg+xml                         svg svgz;
    image/webp                            webp;
    application/postscript                ps eps ai;
    application/pdf                       pdf;
    application/rtf                       rtf;
    application/vnd.ms-excel              xls;
    application/vnd.ms-powerpoint         ppt;
    application/msword                    doc;
    application/x-shockwave-flash         swf;
    application/xhtml+xml                 xhtml;
    application/zip                       zip;
} 
```

# sql - 从一串项目中选择项目

> ID：658240
> 
> 赞同：0
> 
> 时间：2009-03-18T13:26:40.297
> 
> 标签：sql, sql-server-2005, tsql

我有一串格式如下的电子邮件收件人：

```
 DECLARE @recipients VARCHAR(MAX);
 ....
 PRINT @recipients;
 /* the result
 person1@yahoo.com;person2@hotmail.com;person1@yahoo.com;...
 */ 
```

"SELECT DISTIECT ..." 是一个简单而强大的 SQL 语句，但它适用于一个表。是否有一种简单的方法可以从收件人列表变量中选择**不同的收件人，例如 C# 或 Ruby 中的 FOR 循环？**

```
 FOR @recipient IN @recipients
 BEGIN
    -- send email to @recipient
 END 
```

顺便说一句，我在 SQL Server 2005 中使用 TSQL。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T13:35:02.260

这是一个使用临时表的解决方案。

```
declare @emails varchar(2000)
set @emails = 'person1@yahoo.com;person2@hotmail.com;person1@yahoo.com;'

declare @results table (row int identity(1,1), email varchar(500))

while ((select charindex(';',@emails)) > 0)
begin   
    insert into @results select substring(@emails,1,charindex(';',@emails))
    select @emails = substring(@emails,charindex(';',@emails)+1,len(@emails))
end

select distinct email from @results 
```

这个想法是不断地从字符串中解析电子邮件，将其插入到临时表中，然后从剩余的字符串中删除已解析的电子邮件。

之后您可以使用循环遍历临时表来发送您的个人电子邮件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T13:39:14.447

例如

```
CREATE FUNCTION dbo.Split (@sep char(1), @s varchar(512))
RETURNS table
AS
RETURN (
    WITH Pieces(pn, start, stop) AS (
      SELECT 1, 1, CHARINDEX(@sep, @s)
      UNION ALL
      SELECT pn + 1, stop + 1, CHARINDEX(@sep, @s, stop + 1)
      FROM Pieces
      WHERE stop > 0
    )
    SELECT pn,
      SUBSTRING(@s, start, CASE WHEN stop > 0 THEN stop-start ELSE 512 END) AS s
    FROM Pieces
  )
GO 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T13:28:17.267

您在 Split 函数中想要什么，它将返回一个表供您使用。

[周围](http://www.google.com/search?q=sql+server+split)有无数的实现，但我不知道内置的实现，或者“最佳”的共识。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T13:44:30.660

当从前端接收这样的列表时，我使用下面的函数来处理类似的情况。然后，您可以使用此代码将字符串作为表格返回：

```
SELECT DISTINCT String FROM dbo.GetTableFromStringList(@recipients) 
```

不过，您可能希望以 T-SQL 代码以外的方式实际发送电子邮件。

这是功能：

```
CREATE FUNCTION [dbo].[GetTableFromStringList]
(
    @StringList VARCHAR(1000),
    @Delimiter  CHAR(1) = ','
)
RETURNS @Results TABLE
(
    String  VARCHAR(1000)   NOT NULL
)
AS
BEGIN
    DECLARE
        @string     VARCHAR(1000),
        @position   SMALLINT

    SET @StringList = LTRIM(RTRIM(@StringList)) + @Delimiter
    SET @position = CHARINDEX(@Delimiter, @StringList)

    WHILE (@position > 0)
    BEGIN
        SET @string = LTRIM(RTRIM(LEFT(@StringList, @position - 1)))

        IF (@string <> '')
        BEGIN
            INSERT INTO @Results (String) VALUES (@string)
        END

        SET @StringList = RIGHT(@StringList, LEN(@StringList) - @position)
        SET @position = CHARINDEX(@Delimiter, @StringList, 1)
    END

    RETURN
END 
```

# c# - 将我的 siteLanguage 参数放在哪里（横切关注点？）

> ID：658245
> 
> 赞同：0
> 
> 时间：2009-03-18T13:27:59.263
> 
> 标签：c#, .net, asp.net-mvc, translation

在我的项目中，每一页都可以翻译成多种语言。为此，我将一个站点语言参数传递给每个操作。我的自定义基控制器类捕获了这个“siteLanguage”参数并负责进一步的翻译逻辑。

这很好用，唯一的事情是现在我必须在每个动作过程签名中添加一个名为 sitelanguage 的字符串，这样我的基本控制器才能捕获它。在我的实际操作逻辑中，我没有对这个参数做任何事情。

有没有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T13:37:54.327

我会将站点语言放在会话中，并让控制器将其提供给视图，或者也许，只是也许，允许视图从那里检索它。

我建议使用 Culture 和 CurrentCulture 等，但如果您是从法国登录的说英语的人，那么这些当然不起作用。我通常将语言与数据库中的用户偏好联系起来，尽管我很欣赏您的网站可能不需要这样的登录。

# php - 你用 Delphi for PHP 做什么？

> ID：658249
> 
> 赞同：2
> 
> 时间：2009-03-18T13:28:18.110
> 
> 标签：php, delphi

好吧，我刚刚得到了 Delphi for PHP，因为我们在 Delphi 中编写了我们的应用程序，而我是网络人。想想看，它看起来很酷而且超级简单，但我无法想象制作一个带有绝对定位标签的整个网站，这会有点淫秽，跨浏览器兼容，但淫秽。

任何人都可以建议使用 Delphi for PHP 的良好资源/用户组/教程/示例/博客/wiki

我对 PHP 或 Delphi 并不陌生，但我确实想证明获得这个软件是合理的，因为它看起来很酷。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-18T14:34:36.483

我不知道它是否有帮助，但我刚读完 PHP Architect 杂志上的一篇文章，似乎暗示 Delphi for PHP 与 VCL4PHP 有很大关系。

我敢说阅读它（也许从[http://www.qadram.com/vcl4php/](http://www.qadram.com/vcl4php/)开始）可能会有所帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-18T17:22:19.967

你也可以看看：

[http://www.phpclasses.org/reviews/id/B0018RTNSO.html](http://www.phpclasses.org/reviews/id/B0018RTNSO.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-23T11:33:14.027

Although it has been quite a while this product is on the market, it could not gain a momentum as expected. VCL4PHP seems a good framework but not good enough to beat the existing ones. The lack of documentation and community support are major drawbacks for D4PHP. I am trying to develop some basic web app (a todo list). And if I progress enough I'll make a blog about it. Apart from

*   [http://www.qadram.com/vcl4php/](http://www.qadram.com/vcl4php/) and
*   [http://forums.delphi-php.net](http://forums.delphi-php.net)
*   [https://forums.embarcadero.com/category.jspa?categoryID=18](https://forums.embarcadero.com/category.jspa?categoryID=18)

you cannot find much of a resource.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-18T15:19:09.637

这是一个包含一些有趣内容的论坛： [http ://forums.delphi-php.net/](http://forums.delphi-php.net/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T13:49:25.163

[很好的论坛和新闻组列表](http://forums.delphi-php.net/embarcadero-public-delphiphp-vclforphp-components-writing/796-writing-component.html#post2376)显然在 sourceforge 上有一个活跃的 VCL4PHP 开发人员社区。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-19T06:30:31.943

Delphi for PHP 非常酷 - 遗憾的是 PHP 处理数据结构的速度非常慢（就像 Python 一样），因此，您的 Web 应用程序的速度不会令人印象深刻。

但是，Delphi for PHP 在速度上与大多数其他基于 PHP 的框架相比还算不错，而且它肯定擅长组织代码。

# c# - 在 C# 中确定调用对象类型

> ID：658253
> 
> 赞同：14
> 
> 时间：2009-03-18T13:30:15.203
> 
> 标签：c#, types

不管这是否是一个好主意，是否可以实现一个接口，其中执行函数知道调用对象的类型？

```
class A
{
   private C;

   public int doC(int input)
   {
      return C.DoSomething(input);
   }
}

class B
{
   private C;

   public int doC(int input)
   {
      return C.DoSomething(input);
   }
}

class C
{
   public int DoSomething(int input)
   {
      if(GetType(CallingObject) == A)
      {
         return input + 1;
      }
      else if(GetType(CallingObject) == B)
      {
         return input + 2;
      } 
      else
      {
         return input + 3;
      }
   }
} 
```

在我看来，这是一种不好的编码习惯（因为参数不会改变，但输出会改变），但除此之外还有可能吗？

我的情况是我希望一些特定类型能够调用某个函数，但我不能排除对该函数的访问。我想过有一个“类型”参数

```
DoSomething(int input, Type callingobject) 
```

但是不能保证调用对象会使用 GetType(this)，而不是 GetType(B) 来欺骗 B，而不管它们自己的类型如何。

这会像检查调用堆栈一样简单（相对简单）吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-18T13:35:26.050

首先，是的，这样做是一个糟糕的主意，并且破坏了各种可靠的设计原则。如果它是开放的，你绝对应该考虑另一种方法，比如简单地使用多态——这似乎可以重构为一个非常清晰的单分派案例。

其次，是的，这是可能的。用于[`System.Diagnostics.StackTrace`](http://msdn.microsoft.com/en-us/library/system.diagnostics.stacktrace.aspx)遍历堆栈；然后得到适当的`StackFrame`一级。[`GetMethod()`](http://msdn.microsoft.com/en-us/library/system.diagnostics.stackframe.getmethod.aspx)然后通过在 that 上使用来确定调用者是哪个方法`StackFrame`。请注意，构建堆栈跟踪可能是一项昂贵的操作，并且您的方法的调用者可能会掩盖事物的真正来源。

* * *

**编辑：**来自 OP 的这条评论清楚地表明这可能是一种通用或多态方法。**@devinb**，您可能想考虑提出一个新问题，提供有关您正在尝试做的事情的更多详细信息，我们可以看看它是否适合一个好的解决方案。

> 简短的版本是我最终将拥有 30 或 40 个相同的功能，这些功能只需一两行即可。– devinb（12 秒前）

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-18T13:35:45.813

作为一种替代方法，您是否考虑过根据请求类的对象类型提供不同的类。说以下

```
public interface IC {
  int DoSomething();
}

public static CFactory { 
  public IC GetC(Type requestingType) { 
    if ( requestingType == typeof(BadType1) ) { 
      return new CForBadType1();
    } else if ( requestingType == typeof(OtherType) { 
      return new CForOtherType();
    }  
    ...
  }
} 
```

这将是一种比让每个方法都根据调用对象更改其行为更简洁的方法。它将清楚地将关注点与 IC 的不同实现分开。此外，它们都可以代理回真正的 C 实现。

**编辑**检查调用堆栈

正如其他几个人指出的那样，您可以检查调用堆栈以确定立即调用该函数的对象。但是，这不是确定您想要特殊情况的对象之一是否正在呼叫您的万无一失的方法。例如，我可以执行以下操作从 SomeBadObject 给您打电话，但让您很难确定我这样做了。

```
public class SomeBadObject {
  public void CallCIndirectly(C obj) { 
    var ret = Helper.CallDoSomething(c);
  }
}

public static class Helper {
  public int CallDoSomething(C obj) {
    return obj.DoSomething();
  }
} 
```

您当然可以在调用堆栈上走得更远。但这更加脆弱，因为`SomeBadObject`当另一个对象调用`DoSomething()`.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-11-17T18:29:00.260

从 Visual Studio 2012 (.NET Framework 4.5) 开始，您可以使用调用者属性（VB 和 C#）自动将[调用者信息传递给方法。](http://msdn.microsoft.com/en-us/library/hh534540.aspx)

```
public void TheCaller()
{
    SomeMethod();
}

public void SomeMethod([CallerMemberName] string memberName = "")
{
    Console.WriteLine(memberName); // ==> "TheCaller"
} 
```

调用者属性位于`System.Runtime.CompilerServices`命名空间中。

* * *

这是理想的实现`INotifyPropertyChanged`：

```
private void OnPropertyChanged([CallerMemberName]string caller = null) {
     var handler = PropertyChanged;
     if (handler != null) {
        handler(this, new PropertyChangedEventArgs(caller));
     }
} 
```

例子：

```
private string _name;
public string Name
{
    get { return _name; }
    set
    {
        if (value != _name) {
            _name = value;
            OnPropertyChanged(); // Call without the optional parameter!
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-18T13:43:37.900

最简单的答案是像使用典型的发送者 eventargs 方法的任何事件一样传递发送者对象。

您的调用代码如下所示：

```
return c.DoSomething(input, this); 
```

您的 DoSomething 方法将简单地使用 IS 运算符检查类型：

```
public static int DoSomething(int input, object source)
{
    if(source is A)
        return input + 1;
    else if(source is B)
        return input + 2;
    else
        throw new ApplicationException();

} 
```

这似乎有点面向对象的东西。您可能会认为 C 是具有方法的抽象类，并且 A、B 继承自 C 并简单地调用该方法。这将允许您检查基础对象的类型，这显然不是被欺骗的。

出于好奇，你想用这个构造做什么？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-18T18:50:12.250

由于运行时内联的可能性，不可靠。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T13:35:40.993

（几乎）总有一个合适的设计可以满足您的需求。如果你退后一步来描述你真正需要做的事情，我相信你会得到至少一个好的设计，而不需要你不得不求助于这样的东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-18T13:37:13.783

好吧，您可以尝试获取堆栈跟踪并从那里确定调用者的类型，在我看来这有点过头了，而且会很慢。

一个接口如何`A,B`实现？

```
interface IFoo { 
     int Value { get; } 
} 
```

然后您的`DoSomething`方法将如下所示：

```
 public int DoSomething(int input, IFoo foo)
   {
        return input + foo.Value;
   } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-18T13:37:31.893

您可以使用`System.Diagnostics.StackTrace`该类来创建堆栈跟踪。然后你可以寻找`StackFrame`与调用者相关联的那个。有`StackFrame`一个`Method`属性，您可以使用它来获取调用者的类型。

但是，上述方法在性能关键代码中不应该使用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-18T13:41:25.847

您可以检查调用堆栈，但这既昂贵又脆弱。当您的代码被 jit'ed 时，编译器可能会内联您的方法，因此虽然它可以在调试模式下工作，但在发布模式下编译时您可以获得不同的堆栈。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-18T14:11:49.940

像事件处理程序一样构建它，我相信 FX cop 甚至会建议你这样做

```
static void Console_CancelKeyPress(object sender, ConsoleCancelEventArgs e)
        {
            throw new NotImplementedException();
        } 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-07-07T22:12:10.330

我可能会觉得我会以不同的方式处理这个问题，但是......

我假设：

A 类调用 E 类获取信息
C 类调用 E 类获取信息
两者都通过 E 中的相同方法

您知道并创建了所有三个类，并且可以向公众隐藏 E 类的内容。如果不是这种情况，您将永远失去控制。

从逻辑上讲：如果您可以隐藏 E 类的内容，则很可能通过 DLL 进行分发。

如果你仍然这样做，为什么不隐藏类 A 和 C 的内容（相同的方法），但允许 A 和 C 用作派生类 B 和 D 的基础。

在 A 类和 C 类中，您将有一个方法来调用 E 类中的方法并传递结果。在该方法中（派生类可以使用，但内容对用户隐藏）您可以将长字符串作为“键”传递给 E 类中的方法。这些字符串不能被任何用户猜到，只会被知道到基类 A、C 和 E。

我认为让基类封装如何正确调用 E 中的方法的知识将是完美的 OOP 实现

再说一次......我可能会忽略这里的复杂性。

# c# - 检查 WPF DataGrid 中的可见行

> ID：658258
> 
> 赞同：7
> 
> 时间：2009-03-18T13:31:37.417
> 
> 标签：c#, .net, wpf, datagrid

我有一个 WPF `DataGrid`，当屏幕上要查看的行太多时，它会得到一个垂直滚动条。我想知道的是，是否有办法知道用户滚动时顶部可见行是什么。

理想情况下，我希望能够连接一个事件以了解用户何时滚动和滚动，检查顶部可见行以更新一些信息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-09-29T18:05:34.740

订阅 DataGrid 的 ScrollViewer 上的 ScrollViewer.ScrollChanged 事件怎么样？它的事件参数非常广泛，描述了 ScrollViewer 移动了多少以及它的新垂直偏移量是多少。此外，根据 MSDN：

> 如果 CanContentScroll 为 true，则 ExtentHeight、ScrollableHeight、ViewportHeight 和 VerticalOffset 属性的值是项目数。如果 CanContentScroll 为 false，则这些属性的值是与设备无关的像素。

CanContentScroll 确实是 DataGrid 的 ScrollViewer 的情况。

您所要做的就是找到 ScrollViewer：

```
ScrollViewer scrollview = FindVisualChild<ScrollViewer>(dataGrid); 
```

使用可以在各个地方找到的 FindVisualChild 的实现（例如：[在 WPF itemscontrol 中查找控件](https://stackoverflow.com/questions/980120/finding-control-within-wpf-itemscontrol)）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-14T05:29:31.137

使用以下方法对我有用：

```
// mHorizontalScrollBar is the HorizontalScrollBar subclass control's instance

// Get the total item count
nTotalCount = DataGrid1.Items.Count; 

// Get the first visible row index 
nFirstVisibleRow = mHorizontalScrollBar.Value;

// Get the last visible row index
nLastVisibleRow = nFirstVisibleRow + nTotalCount - mHorizontalScrollBar.Maximum; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-09-21T15:10:39.147

检测滚动就像

```
<DataGrid ScrollViewer.ScrollChanged="DataGrid_ScrollChanged" /> 
```

现在您必须获取 ScrollViewer 实例：

```
void DataGrid_ScrollChanged(object sender, RoutedEventArgs e)
{
    var scroll = FindVisualChild<ScrollViewer>((DependencyObject)sender);
    ...
} 
```

（不确定 FindVisualChild 的起源在哪里，但有很多实现，例如[这里](https://stackoverflow.com/a/10279201/1997232)）

然后你可以

```
int firstRow = (int)scroll.VerticalOffset;
int lastRow = (int)scroll.VerticalOffset + (int)scroll.ViewportHeight + 1; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T16:12:21.227

这是一种过于复杂的方法，但它可能会奏效。首先，继承 DataGridRowsPresenter 并覆盖[OnViewportOffsetChanged 方法](http://msdn.microsoft.com/en-us/library/system.windows.controls.virtualizingstackpanel.onviewportoffsetchanged.aspx)。然后，复制数据网格的标准控件模板，并将 DataGridRowsPresenter 替换为您自己的。我将与视口相关的一行命中测试的详细信息留给您；-)。

具体来说，您要完成什么？也许我们可以想出一个更好的方法，因为这可能非常脆弱并且需要大量额外的工作（即在更新控制模板时保持同步）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-10-20T15:25:44.650

也许是一个迟到的答案，也许不是最好的方法，而是最简单的方法之一。

```
 public void SelectPatient(string patientID)
    {
        var item = PatientList.FirstOrDefault(ro => ro.Pati_ID == patientID);
        if (item != null)
        {
            grdPatients.SelectedItem = item;
            grdPatients.ScrollIntoView(grdPatients.Items[grdPatients.Items.Count - 1]); //Scrolls to the last row
            grdPatients.UpdateLayout();
            grdPatients.ScrollIntoView(grdPatients.SelectedItem);
            grdPatients.UpdateLayout();
        }
    } 
```

# sql - 使用 oracle 在外连接中只获取一行

> ID：658259
> 
> 赞同：2
> 
> 时间：2009-03-18T13:31:42.157
> 
> 标签：sql, oracle, outer-join

我有一个表，想要外连接另一个表，使用 Oracle 10g 只获取第二个表的第一行（具有最低 nr 的行）。

**编辑：** nr 在 id 中是唯一的

```
Table x    Table y
id         id  nr  code
 1          1   1   B
 2          1   2   A
 3          2   2   A

Expected result:
id   nr     code
 1    1      B
 2    2      A
 3    NULL   NULL 
```

测试数据示例（不限制单行，但应该允许更快的测试）：

```
WITH
  x AS( SELECT 1 id FROM dual UNION SELECT 2 FROM dual UNION SELECT 3 FROM dual ),
  y AS( SELECT 1 id, 1 nr, 'B' code FROM dual
        UNION SELECT 1, 2, 'A'  FROM dual
        UNION SELECT 2, 2, 'A' FROM dual
) -- end of test data
SELECT x.id, y.nr, y.code
  FROM x
  LEFT OUTER JOIN y ON ( y.id = x.id ) 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-18T13:32:52.763

```
WITH
  x AS( SELECT 1 id FROM dual UNION SELECT 2 FROM dual UNION SELECT 3 FROM dual ),
  y AS( SELECT 1 id, 1 nr, 'B' code FROM dual
        UNION SELECT 1, 2, 'A'  FROM dual
        UNION SELECT 2, 2, 'A' FROM dual
) -- end of test data
SELECT  *
FROM    (
        SELECT  x.id, y.nr, y.code, ROW_NUMBER() OVER (PARTITION BY x.id ORDER BY y.nr) AS rn
        FROM    x
        LEFT OUTER JOIN y
        ON   y.id = x.id
)
WHERE rn = 1 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T12:19:56.657

```
WITH
  x AS( SELECT 1 id FROM dual UNION SELECT 2 FROM dual UNION SELECT 3 FROM dual ),
  y AS( SELECT 1 id, 1 nr, 'B' code FROM dual
        UNION SELECT 1, 2, 'A'  FROM dual
        UNION SELECT 2, 2, 'A' FROM dual
) -- end of test data
SELECT x.id, y.nr, y.code
  FROM x
  LEFT OUTER JOIN y ON ( y.id = x.id )
WHERE rownum = 1 --Add this 
```

# php - gzip 编码与 JSON 兼容吗？

> ID：658261
> 
> 赞同：9
> 
> 时间：2009-03-18T13:32:46.587
> 
> 标签：php, json, encoding, gzip

我正试图缩小我的 AJAX 调用中发生的一些奇怪之处。我的 PHP 脚本一开始就有这个：

```
ob_start("ob_gzhandler"); 
```

适用于 HTML。但是用 application/json 数据做这件事有什么问题吗？任何人都知道的任何浏览器问题？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-18T13:35:17.377

我不这么认为...我以前使用过存储为 gzip 压缩 JSON 的静态文件，并且它在 AJAX 上运行良好。

**编辑：**我检查了我的 php 脚本，我做的唯一特别的事情就是包含这些标题：

```
Content-Encoding: gzip
Content-Type: text/plain 
```

如果我没记错的话，每当我尝试将 Content-Type 更改为指示 JSON 的内容时，客户端都会遇到问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-18T13:38:01.457

一些较旧的浏览器，例如某些版本的 IE6，会破坏 gzip 压缩的内容，尤其是 js 内容。

只需检查您的服务器是否发送了正确的内容编码标头，即

```
Content-Encoding: gzip 
```

您还应该在发送 gzip 压缩内容之前检查浏览器发送的标头是否有正确的接受编码标头...也就是说，

```
Accept-Encoding: gzip,deflate 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T13:36:15.470

只要浏览器`gzip`在`Accept-Encoding`请求标头中指定，您就可以提供 gzip 压缩的内容。在这种情况下，JSON 和 HTML 之间没有区别，也不会引起任何问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T19:47:36.357

我不会在 PHP 中启用压缩，而是在 Apache 中启用压缩（使用 mod_deflate），这样您就可以检查各种不兼容的浏览器，并且只为接受并正确处理它的浏览器发送压缩数据。

[http://httpd.apache.org/docs/2.0/mod/mod_deflate.html](http://httpd.apache.org/docs/2.0/mod/mod_deflate.html)

# .net - 如何在运行时确定我的根调用程序集的版本号？（。网）

> ID：658263
> 
> 赞同：0
> 
> 时间：2009-03-18T13:33:17.490
> 
> 标签：.net, reflection, assemblies

例子：

MyProgram.exe 被执行。它调用 MyClassLibrary1.dll，后者调用 MyClassLibrary2.dll。如何从 MyClassLibrary2.dll 中确定 MyProgram.exe 的程序集版本是什么？

这可能吗？

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-18T13:38:10.537

```
System.Reflection.Assembly.GetEntryAssembly().GetName().Version 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T13:39:48.440

**编辑**我的答案只有在 DLL 引用了实际的 EXE 时才有效，这会很奇怪。

尝试以下

```
typeof(SomeTypeInMyProgram).Assembly.GetName().Version 
```

这将返回一个版本结构，您可以使用它来分析 MyProgram.exe 的版本。

# entity-framework - 与引用的实体一起分离实体

> ID：658286
> 
> 赞同：2
> 
> 时间：2009-03-18T13:37:52.610
> 
> 标签：entity-framework

好的，我打算使用实体框架开发一个项目。在我开始实施之前尝试做一些研发，我发现了这个问题，希望你们中的一些人帮助我找到解决方案。

我有一个名为“Person”的实体，它被“Members”实体引用，具有一对多（1：N）关系。任务是查询 Person 实体及其对应的 Members 集合，并将其传递给表示层以查看、修改或删除它，然后将修改后的实体对象传递回 Model 层以将实体附加到上下文并将其保存到数据库。

至于我分离/附加一个像“人”这样的单一实体并将其保存到数据库中，一切都很好。但是，当我尝试使用其引用的实体（成员）查询实体（人）并分离时，我可以将其发送到表示层。我发现我只得到了 Person 实体集合，并且引用 Member 实体集合在从上下文中分离后被完全删除。

在这里，我粘贴我的代码片段以供参考：

```
using (GOLProfessionalEntities context = new GOLProfessionalEntities())
{
     ObjectQuery<Person> query =
        context.Person.Include("Members");

     var person = query.First();
     context.Detach(person);

     return person;
} 
```

如果有人提出解决方案，我会非常高兴。

提前致谢。-ssak32

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-31T14:00:50.950

您可以将 ObjectQuery 上的 MergeOption 设置为 NoTracking。这样，Person 一开始就不会被附加到 ObjectContext 上。

```
 using (GOLProfessionalEntities context = new GOLProfessionalEntities())
            {
                ObjectQuery<Person> query =
                   context.Person.Include("Members");
                query.MergeOption = MergeOption.NoTracking;// <--

                var person = query.First();

                return person;
            } 
```

我的答案太晚了，它可能会对某人有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T18:14:57.613

我相信您还需要分离每个成员：

使用 (GOLProfessionalEntities context = new GOLProfessionalEntities()) { ObjectQuery query = context.Person.Include("Members");

```
 var person = query.First();

 while (person.Member.Count > 0)
 {
     context.Detach(person.Member.First());
 }

 context.Detach(person);

 return person; 
```

}

我希望这行得通。

# asp.net - 用户控件中的 JS 路径

> ID：658289
> 
> 赞同：0
> 
> 时间：2009-03-18T13:38:04.357
> 
> 标签：asp.net, javascript

我们的文件夹结构是这样的：

```
ParentFolder
   HostPage1.aspx
   UserControlsFolder
      UserControl.ascx
   AnotherFolder
      HostPage2.aspx 
```

UserControl.ascx 用于 HostPage1.aspx 和 HostPage2.aspx

我在 ASCX 中包含一个外部 JS 文件，并且路径需要相对于页面。由于我有不同层次结构的页面，我将如何根据是否在 HostPage1 或 HostPage2 中使用有条件地更改路径？

如果可以避免，我不想在主机页面中添加 JS 包含指令

**编辑我可以在用户控件中使用网络资源吗？**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T15:42:17.350

我建议使用该[`RegisterClientScriptResource`](http://msdn.microsoft.com/en-us/library/system.web.ui.clientscriptmanager.registerclientscriptresource.aspx)实用程序。您当然可以在用户控件中执行此操作。

1.  右键单击 JavaScript 文件并单击属性。
2.  将构建操作设置为嵌入式资源
3.  修改下面的代码并将其添加到您的用户控件中。

```
Page.ClientScript.RegisterClientScriptResource(typeof(CurrentTypeHere), "Your.Namespace.Class.Folder.File.js"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T13:47:10.297

您可以使用[网络资源](http://support.microsoft.com/kb/910442)

# .net - Is there a .NET version of Concordion?

> ID：658297
> 
> 赞同：1
> 
> 时间：2009-03-18T13:40:27.877
> 
> 标签：.net, automated-tests, concordion, nbehave

Apart from [Fitnesse](http://fitnesse.org/) is there anything like concordion for .NET?

> [Concordion](http://www.concordion.org/) is an open source framework for Java that lets you turn a plain English description of a requirement into an automated test

David Peterson (the author of Concordion) has told me that there is no .net port of Concordion that he knows of. However he says I should look at [Nbehave](http://www.codeplex.com/NBehave) (and [here](http://code.google.com/p/nbehave/)) as well as FitNesse.

I have also found [Twist](http://studios.thoughtworks.com/twist-agile-test-automation/) that [Thoughtworks Studios](http://studios.thoughtworks.com) has just released, it is not cheep. It claims to support Selenium and Frankenstein out of the box, on a quick look, its Domain Specific Languages look a lot like Concordion. **However it is Java, not .NET** Thoughtworks claims..

> Twist is the next generation of software test automation tools. It provides a rich environment for authoring, executing, and maintaining tests.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-23T09:22:08.603

[concordion-net](http://code.google.com/p/concordion-net/) is a .net port of Concordion, apparently "its still pretty alpha".

Also consider [SpecFlow](http://www.specflow.org/).

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-22T13:23:04.147

[StoryTeller](http://storyteller.tigris.org/) does what you want. It actually goes a step farther than Concordion, providing a UI that allows the creation of tests without knowing HTML or the structure of the test fixtures. This allows folks like BAs, TPMs, and QAs to write and execute tests easily.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-05-19T18:32:31.700

A new version of Concordion.NET has been release. Please find some documentation here: [http://concordion.org/dotnet/](http://concordion.org/dotnet/)

Now Concordion.NET has a NUnit integration to run the Concordion.NET tests: [https://github.com/concordion/concordion-net/releases/tag/v1.0.0](https://github.com/concordion/concordion-net/releases/tag/v1.0.0)

Cheers, Jacek

# c# - 线程和 ArcGIS

> ID：658301
> 
> 赞同：1
> 
> 时间：2009-03-18T13:42:15.703
> 
> 标签：c#, multithreading, backgroundworker, arcgis

我刚刚偶然发现了 Backgroundworker 对象，它似乎是我正在寻找的工具，可以让我的 GUI 在执行计算时做出响应。我正在为 ArcGIS 编写 IO 插件。

我正在 ArcGIS 之外进行一些数据处理，使用 backgroundworker 可以正常工作。但是当我将数据插入 ArcGIS 时，后台工作人员似乎将持续时间增加了 9 倍左右。将处理代码放在 DoWork 方法之外，可以将性能提高 9 倍。

我在网上读过这几个地方，但我没有多线程编程的经验，而且像 STA 和 MTA 这样的术语对我来说毫无意义。[链接文本](http://edndoc.esri.com/arcobjects/9.2/NET/2c2d2655-a208-4902-bf4d-b37a1de120de.htm) 我也尝试使用简单的线程实现，但结果相似。

有谁知道我可以做些什么才能使用 ArcGIS 处理和维护响应式 GUI？

编辑：我已经包含了我与后台工作人员交互的示例。如果我将 StartImporting 方法中的代码放在 cmdStart_Click 方法中，它的执行速度会快得多。

```
private void StartImporting(object sender, DoWorkEventArgs e)
{
    DateTime BeginTime = DateTime.Now;
    // Create a new report object.
    SKLoggingObject loggingObject = new SKLoggingObject("log.txt");
    loggingObject.Start("Testing.");

    SKImport skImporter = new SKImport(loggingObject);
    try
    {
        // Read from a text box - no writing.
    skImporter.Open(txtInputFile.Text);
    }
    catch
    {
    }
    SKGeometryCollection convertedCollection = null;

    // Create a converter object.
    GEN_SK2ArcGIS converter = new GEN_SK2ArcGIS(loggingObject);

    // Convert the data.
    convertedCollection = converter.Convert(skImporter.GetGeometry());

    // Create a new exporter.
    ArcGISExport arcgisExporter = new ArcGISExport(loggingObject);

    // Open the file.            
    // Read from a text box - no writing.
    arcgisExporter.Open(txtOutputFile.Text);

    // Insert the geometry collection.
    try
    {
    arcgisExporter.Insert(convertedCollection);
    }
    catch
    {
    }
    TimeSpan totalTime = DateTime.Now - BeginTime;
    lblStatus.Text = "Done...";

}

private void ChangeProgress(object sender, ProgressChangedEventArgs e) 
{
    // If any message was passed, display it.
    if (e.UserState != null && !((string)e.UserState).Equals(""))
    {
    lblStatus.Text = (string)e.UserState;
    }
    // Update the progress bar.
    pgStatus.Value = e.ProgressPercentage;
}

private void ImportDone(object sender, RunWorkerCompletedEventArgs e)
{
    // If the process was cancelled, note this.
    if (e.Cancelled)
    {
    pgStatus.Value = 0;
    lblStatus.Text = "Operation was aborted by user...";
    }
    else
    {
    }

}

private void cmdStart_Click(object sender, EventArgs e)
{
    // Begin importing the sk file to the geometry collection.

    // Initialise worker.
    bgWorker = new BackgroundWorker();
    bgWorker.RunWorkerCompleted += new RunWorkerCompletedEventHandler(ImportDone);
    bgWorker.ProgressChanged += new ProgressChangedEventHandler(ChangeProgress);
    bgWorker.DoWork += new DoWorkEventHandler(StartImporting);
    bgWorker.WorkerReportsProgress = true;
    bgWorker.WorkerSupportsCancellation = true;

    // Start worker.
    bgWorker.RunWorkerAsync();

}

private void cmdCancel_Click(object sender, EventArgs e)
{
    bgWorker.CancelAsync();
} 
```

亲切的问候，卡斯帕

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-05T15:10:20.827

在 ArcGIS 中处理 COM 对象时应该使用 STA 线程是正确的。尽管如此，您仍然可以获得 BackgroundWorker 的便利，它始终是来自系统线程池的 MTA 线程。

```
private static void OnBackgroundWorkerDoWork(object sender, DoWorkEventArgs e)
{
    BackgroundWorker worker = (BackgroundWorker)sender;
    ToolToStart tool = e.Argument as ToolToStart;

    if (tool != null)
    {
        tool.BackgroundWorker = worker;

        // The background worker thread is an MTA thread, 
        // and should not operate on ArcObjects/COM types.
        // Instead we create an STA thread to run the tool in.
        // When the the tool finishes the infomation from the STA thread 
        // is transferred to the background worker's event arguments.
        Thread toolThread = new Thread(STAThreadStart);
        toolThread.SetApartmentState(ApartmentState.STA);
        toolThread.Start(tool);

        toolThread.Join();
        e.Cancel = m_ToolCanceled;
        e.Result = m_ToolResult;
    }
} 
```

STA 线程现在可以使用 BackgroundWorker 的方法，例如报告进度、检查取消和报告结果。

```
protected virtual void StatusUpdateNotify(ProgressState progressState)
{
    if (BackgroundWorker.CancellationPending)
    {
        throw new OperationCanceledException();
    }

    BackgroundWorker.ReportProgress(progressState.Progress, progressState);
} 
```

除了在对 ArcGIS 对象进行操作时仅使用 STA 线程外，您不应在两个线程之间共享对象。从您的代码中，您似乎可以从后台工作人员访问 GUI `lblStatus.Text = "Done...";`：，这可以在例如 RunWorkerComplete 的委托中完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T14:37:54.527

通常，为了维护响应式 GUI，您需要执行在不同线程中工作的代码。使用 BeginInvoke 方法使用 .net 非常容易：http: [//msdn.microsoft.com/en-us/library/aa334867 (VS.71).aspx](http://msdn.microsoft.com/en-us/library/aa334867(VS.71).aspx)

简而言之，将所有非 GUI 代码包含在一个单独的类（或多个类）中，而不是直接调用每个方法，而是创建一个委托并在其上调用 BeginInvoke 方法。然后该方法将启动并执行此操作，而无需与 GUI 进一步交互。如果您希望它更新 GUI（例如进度条），那么您可以从类中引发事件并从 GUI 中捕获它们，但是您需要确保以线程安全的方式更新控件。如果您希望 GUI 在方法完成时更新，那么您可以使用 EndInvoke 方法来处理它

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-25T07:53:24.197

我一直在努力寻找解决方案，以下是我最终做的事情。代码是从各种文件中剪切和粘贴的，并呈现给我一个关于我所做的事情的想法。它演示了如何调用使用线程与 ArcGIS 通信的方法。该代码允许我在主线程中更新 GUI、中止操作并执行操作后的操作。我最终使用了我最初发布的链接中的第一个线程部分。

最初性能损失的原因可能是由于 ArcGIS 所需的单线程单元 (STA)。Backgroundworker 似乎是 MTA，因此不适合使用 ArcGIS

好了，我希望我没有忘记任何事情，并且可以随意编辑我的解决方案。它既可以帮助我，也可以帮助其他人为 ArcGIS 开发东西。

```
public class Program
{
    private volatile bool AbortOperation;
    Func<bool> AbortOperationDelegate;
    FinishProcessDelegate finishDelegate;
    UpdateGUIDelegate updateGUIDelegate;

    private delegate void UpdateGUIDelegate(int progress, object message);
    private delegate void FinishProcessDelegate();

    private void cmdBegin_Click(...)
    {
        // Create finish delegate, for determining when the thread is done.
        finishDelegate = new FinishProcessDelegate(ProcessFinished);
        // A delegate for updating the GUI.
        updateGUIDelegate = new UpdateGUIDelegate(UpdateGUI);
        // Create a delegate function for abortion.
        AbortOperationDelegate = () => AbortOperation;

        Thread BackgroundThread = new Thread(new ThreadStart(StartProcess));            
        // Force single apartment state. Required by ArcGIS.
        BackgroundThread.SetApartmentState(ApartmentState.STA);
        BackgroundThread.Start();
    }

    private void StartProcess()
    {    
        // Update GUI.
        updateGUIDelegate(0, "Beginning process...");

        // Create object.
        Converter converter = new Converter(AbortOperationDelegate);
        // Parse the GUI update method to the converter, so it can update the GUI from within the converter. 
        converter.Progress += new ProcessEventHandler(UpdateGUI);
        // Begin converting.
        converter.Execute();

        // Tell the main thread, that the process has finished.
        FinishProcessDelegate finishDelegate = new FinishProcessDelegate(ProcessFinished);
        Invoke(finishDelegate);

        // Update GUI.
        updateGUIDelegate(100, "Process has finished.");
    }

    private void cmdAbort_Click(...)
    {
        AbortOperation = true;
    }

    private void ProcessFinished()
    {
        // Post processing.
    }

    private void UpdateGUI(int progress, object message)
    {
        // If the call has been placed at the local thread, call it on the main thread.
        if (this.pgStatus.InvokeRequired)
        {
            UpdateGUIDelegate guidelegate = new UpdateGUIDelegate(UpdateGUI);
            this.Invoke(guidelegate, new object[] { progress, message });
        }
        else
        {
            // The call was made on the main thread, update the GUI.
            pgStatus.Value = progress;
            lblStatus.Text = (string)message;   
        }
    }
}

public class Converter
{
    private Func<bool> AbortOperation { get; set;}

    public Converter(Func<bool> abortOperation)
    {
        AbortOperation = abortOperation;
    }

    public void Execute()
    {
        // Calculations using ArcGIS are done here.
        while(...) // Insert your own criteria here.
        {
            // Update GUI, and replace the '...' with the progress.
            OnProgressChange(new ProgressEventArgs(..., "Still working..."));

            // Check for abortion at anytime here...
            if(AbortOperation)
            {
                return;
            }
        }
    }

    public event ProgressEventHandler Progress;
    private virtual void OnProgressChange(ProgressEventArgs e)
    {
        var p = Progress;
        if (p != null)
        {
            // Invoke the delegate. 
        p(e.Progress, e.Message);
        }
    }    
}

public class ProgressEventArgs : EventArgs
{
    public int Progress { get; set; }
    public string Message { get; set; }
    public ProgressEventArgs(int _progress, string _message)
    {
        Progress = _progress;
        Message = _message;
    }
}

public delegate void ProgressEventHandler(int percentProgress, object userState); 
```

# c# - 如何获取带有名称和任何扩展名的图像？

> ID：658303
> 
> 赞同：1
> 
> 时间：2009-03-18T13:42:53.067
> 
> 标签：c#, asp.net, javascript, html, vb.net

我正在建立一个 asp.net 网站。我想在页面上显示图像，但是虽然我知道图像名称，但我不知道扩展名。

因此，我想打开图像目录并通过其名称获取图像，无论其扩展名如何。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-18T13:46:04.480

您可以使用 Directory 对象获取目录中的文件列表

```
string imageFilename = System.IO.Directory.GetFiles( imageDirectory, name + ".*" ).First(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T13:45:14.357

文件实际上并不是这样工作的——您需要知道整个名称。例如，如果有多个图像具有相同的基本名称和不同的扩展名，会发生什么？比较`foo.png`和`foo.jpg`，例如。

一个建议是尝试对该目录中具有某个基本名称的所有文件进行通配符搜索（这就是 bstoney 的解决方案所做的；[**请参见此处**](http://#658317)）。如果你找到一个匹配，你就完成了。如果您获得多场比赛，则需要制定关于哪一场获胜的规则。

# unit-testing - 我在哪里可以找到一些关于集成测试的代码示例

> ID：658306
> 
> 赞同：2
> 
> 时间：2009-03-18T13:43:34.140
> 
> 标签：unit-testing, testing, integration, functional-programming

我有与数据库和外部文件交互的方法。我需要编写集成测试，但我不知道该怎么做。

你知道我在哪里可以找到一些关于使用数据库或外部文件进行集成测试的源代码吗？

如果您编写一个测试方法来测试一个生产方法，其中调用了其他方法，这是集成测试、系统测试还是功能测试？这显然不是单元测试。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-12-27T00:08:04.550

集成测试通常从用户/外部系统的角度对应用程序的所有部分进行测试。

对于带有 GUI 的 DB 应用程序，它可以是 Sikuli ( [http://doc.sikuli.org/tutorials/helloworld/helloworld-win.html](http://doc.sikuli.org/tutorials/helloworld/helloworld-win.html) )

对于没有 GUI 的 DB 应用程序，使用任何带有测试框架的脚本语言（f.exmpl.Python：[http](http://docs.pylonsproject.org/projects/pyramid/en/latest/narr/testing.html) ://docs.pylonsproject.org/projects/pyramid/en/latest/narr/testing.html ）

这是测试外部资源（如 DB）的示例：http: [//agiletesting.blogspot.com/2009/07/python-mock-testing-techniques-and.html](http://agiletesting.blogspot.com/2009/07/python-mock-testing-techniques-and.html)

# c# - 运行时创建泛型 Func

> ID：658316
> 
> 赞同：17
> 
> 时间：2009-03-18T13:45:57.850
> 
> 标签：c#, .net, reflection

我需要实现该方法：

```
object GetFactory(Type type); 
```

此方法需要返回一个 Func<T>，其中 typeparam 'T' 是 'type'。

所以，我的问题是我不知道如何在运行时使用反射创建 Func<?> 。Activator.CreateInstance 不起作用，因为委托上没有构造函数。

有任何想法吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-03-18T13:53:18.737

您使用`Delegate.CreateDelegate`, 即来自`MethodInfo`; 下面，我已经硬编码，但你会使用一些逻辑，或者`Expression`，来获得实际的创建方法：

```
using System;
using System.Reflection;
class Foo {}

static class Program
{
    static Func<T> GetFactory<T>()
    {
        return (Func<T>)GetFactory(typeof(T));
    }
    static object GetFactory(Type type)
    {
        Type funcType = typeof(Func<>).MakeGenericType(type);
        MethodInfo method = typeof(Program).GetMethod("CreateFoo",
            BindingFlags.NonPublic | BindingFlags.Static);
        return Delegate.CreateDelegate(funcType, method);
    }
    static Foo CreateFoo() { return new Foo(); }
    static void Main()
    {
        Func<Foo> factory = GetFactory<Foo>();
        Foo foo = factory();
    }
} 
```

对于非静态方法，有一个`Delegate.CreateDelegate`接受目标实例的重载。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2020-11-08T03:36:12.410

我在 EF Core 中将它与泛型一起使用，包括制作 Expression<Func<SomeModelType,bool>> 让我们说一个 Where 子句，您可以将 MakeGenericType 调用与嵌套泛型链接起来。

```
var someType = SomeDbContext.SomeDataModelExample.GetType();
var funcType1 = typeof(Func<>).MakeGenericType(new Type[] { someType });
var result = Activator.CreateInstance(funcType1);
var result2 = Activator.CreateInstance(funcType1, someParams); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T13:49:15.127

我认为通常的方法是让“哑”版本成为你在 runtme 上欺骗的东西，然后提供一个辅助扩展方法来在它之上提供类型安全的版本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T14:06:23.230

您可以创建 Expression 对象而不是 func，然后 compile() 表达式以获取 Func 委托。

# asp.net - 动态网格视图中的问题

> ID：658321
> 
> 赞同：0
> 
> 时间：2009-03-18T13:48:47.967
> 
> 标签：asp.net

我有一个动态创建的网格视图。网格视图的每个单元格都有动态创建的文本框。文本框的值来自 xml 文件，文本框的 ID 来自数据库。

问题是，当我使用断点检查但未显示在输出中时，值（要显示在文本框中）被分配。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-19T05:28:47.160

您需要发布代码，但是......这里有一个猜测：如果这些值不在输出中，那么它们可能是在ASP.NET Render 事件*之后分配的。*您需要在创建控件时设置值。

# vmware-server - 我需要更多虚拟机，我应该扩展我当前的服务器，还是让另一台服务器来托管它们？

> ID：658322
> 
> 赞同：1
> 
> 时间：2009-03-18T13:48:59.557
> 
> 标签：vmware-server

我目前在我的办公室里有几台物理服务器，它们在 VMWare 服务器之外托管了许多 VMware 来宾操作系统。

我们需要增加在内部进行一些测试和开发所需的虚拟机数量。

我们的客户可以在世界范围内访问其中的一小部分，但它们并没有做任何特别负载密集的事情（CPU、带宽或内存）

其中一台服务器有第二个 CPU 插槽和一些额外的内存空间。我们目前在以下决定之间挣扎：

1.  升级服务器。目前它是 1xQuad 核心 Xeon 和 4 gigs 内存。
    *   简单的升级是添加第二个相同的 CPU 使其成为 2xQuad 核心 Xeon
    *   以及升级到 8 gigs 的 ram
2.  获取另一台相同规格的服务器（1x 四核 4gig）并将新的虚拟机放在那里。

每个 VM 实例不使用超过 1 个虚拟 CPU 或超过 1 个 ram tops。它们中的大多数都是用于特定任务的轻量级 Linux 机器。

我们想知道的问题是，如果我们用 CPU 和 RAM 完全欺骗我们的服务器并堆积尽可能多的 VM，那么 VMWare 及其客户操作系统会受到多大的影响？

这似乎是 VMware 为节省电力和货架空间而规定的路线，特别是对于我们的低利用率......但是有没有任何经验表明更多的物理机器仍然更好？

机器的升级路线对我们来说仍然是一个有吸引力的选择，因为它大约是获得同等价格新机器的价格的 1/3 到 1/4。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T21:43:54.797

对于您要升级到的配置，我们有类似的配置。

*   双四核至强
*   8Gb RAM（服务器最多可处理 32Gb）
*   虚拟机

我们目前正在运行大约 25 台虚拟机，随着需求的增加，最终将拥有完整的 32 Gb RAM。大多数只是为我们的支持团队测试机器以复制客户环境，所以只是 24/7 空闲，我们有 8Gb 物理内存和 16Gb 分配给虚拟机 - 通常不是问题，除非我们积极使用多个 Vista 或 Server 2008 虚拟机.

我们进行的第一次升级是获得一个硬件 RAID 卡（以支持 ESXi），它以您不相信的方式提升了性能（软件 raid + vista = 啊！），接下来的步骤是将 ram 升级到 12Gb，然后是 16Gb，因为我们添加越来越多的虚拟机。一旦内存价格足够下降，我们将开始用成对的 4Gb 替换成对的 2Gb 棒。

即使在重负载下，我们机器上的瓶颈是内存。所以我建议升级你现在的机器，它还有很多生命。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T13:56:37.947

我会说升级可能就足够了。但见鬼，我不知道你的最终要求是什么。

如果您正在做任何需要故障转移的事情，那么您将需要第二台机器来实现冗余。

也就是说，您可能值得花时间从 VMWare 服务器升级到 VMWare esx 或价格更具竞争力的 VMWare esxi（免费）。esx(i) 在您的硬盘驱动器 (32MB) 或内存中几乎没有占用空间。假设您在 Windows 上托管，这是一个很大的节省。如果您已经有了精简的 linux 操作系统，那么更改可能不值得。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T13:56:50.490

构建当前的机器可以节省购买价格、机架空间、功耗和冷却。再过 18 个月，当您想再次扩展时，一台新计算机将完成当前计算机所能完成的所有工作 + 您想要添加的所有新负载，并且比您预期的要便宜。

如果出现硬件问题，现在购买第二台主机是提供冗余的好方法。假设您有良好的虚拟机备份，您可以很快从硬件故障中恢复。

这取决于你真正需要什么。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T14:42:23.097

不要忘记考虑磁盘空间。除非您拥有 SAN，否则很难满足少数​​ VM 的直接附加存储要求（空间和速度）。当你有 6-8 台机器都使用同一个磁盘控制器时，它可能会有点争议。

话虽如此，在购买新的物理服务器之前，我几乎总是希望扩展虚拟服务器。不过，ascalonx 和 Jay Bazuzi 提出了很好的观点，如果第一台服务器出现故障，拥有一些冗余的虚拟主机对于保持停机时间很重要。我总是想知道我有另一个虚拟服务器可以承担任何可能出现故障的 VM 主机的负载。如果您没有，您可能需要考虑获得更多硬件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T14:50:41.640

如果唯一的选择是“升级”或“购买新”，我会选择升级。引入一台没有在服务器之间进行主动负载平衡的新服务器，您最终可能会导致一台主机在其容量限制下工作，而另一台主机只是闲置并且只会产生热量。

如果您对虚拟机做了很多工作，您应该查看 VMwares ESX 服务器。有了这个和 Virtual Center，您可以设置“动态资源调度”，这是一种在达到特定阈值（例如 CPU 或内存负载）时自动在服务器之间移动正在运行的 VM 的机制。不利的一面是许可成本，并且您的服务器需要访问 SAN。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T17:01:04.073

另一种选择是[Amazon EC2](http://aws.amazon.com/ec2/)。这可以让您在一次可以运行多少台机器方面具有很大的可扩展性。而且你得到的成本很低。

# c# - 我可以阻止 COM dll 显示表单吗？

> ID：658324
> 
> 赞同：2
> 
> 时间：2009-03-18T13:49:11.413
> 
> 标签：c#, .net, com, vb6, interop

更具体：

我们有一个 Web 服务（用 .Net 编写），它利用大量 COM dll 用于核心业务逻辑（用 VB6 编写）。现在假设这些是密封的库。

不幸的是，这些 COM 库中的许多都实现了自己的错误处理或验证消息。如果我们传入不完整的数据，或者缺少另一个 COM 依赖项，它们将显示一个对话框。这些对话框就是问题所在……在IIS中运行时，这些消息框挂起请求，等待用户点击ok到一个看不到的框。

有谁知道在.Net 端捕获这些 UI 调用（可能是 form.show 而不是消息框）的方法，所以我们可以抛出异常？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T13:57:01.737

需要注意的是我个人没有这样做，我相信你想要的拦截和重定向可以通过[Win32 Hooks来实现](http://msdn.microsoft.com/en-us/library/ms997537.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T15:11:04.150

如果这些是用 VB6 编写的，用于桌面应用程序，那么表单的显示是最少的问题。这些 COM 对象可能也不希望被多个线程同时访问。这可以非常壮观或非常微妙地爆炸。

如果管理层依靠这一点为 10,000 个图书馆工作，那么您需要让他们明白，违反 10,000 段十年前代码的假设并不是一个好主意。

如果管理层已经足够老了（并且在美国），那么请提醒他们关于“愚弄大自然母亲不好”的旧*margerine广告。*坏事可能会发生。

* * *

我想我需要更具体地说明“坏事”。

我假设这些是为与一个或多个 VB6 表单应用程序交互而创建的 VB6 COM 对象。然后这些 COM 对象可以合理地假设一次只有一个线程访问它们，一次只有一个用户访问它们，实际上只有一个线程和一个用户在它们的整个生命周期中访问它们。

一旦你在服务器上运行它们，你就违反了他们的假设。

谁能说出这会导致什么？没有人会进行这种分析，因为它们是基本（且有效）的假设！代码可能会在线程本地存储中缓存一些东西吗？这将适用于原始场景。也许共享数据用于缓存信息。如果它将被多个线程使用，则需要互锁，然后您必须希望每个用户的信息不会有所不同，因为不同的线程可能代表不同的用户运行。

我曾经被告知去修复内存泄漏。长话短说，这不是内存泄漏。它是一段遗留的非托管代码，假设它在桌面或批处理应用程序中运行。在 Web 服务中，它在整个堆中喷吐垃圾。因此，它到处抛出异常，并导致其他不相关的代码也这样做。非托管异常没有提供太多细节，因此无法查看导致问题的原因或解决方法。

在这种情况下，我可以简单地在所有访问权限周围设置一个互锁。这已经足够好了，因为这段代码假定了一个批处理环境，而不是一个交互式环境。如果您的 COM 对象假设他们十年前的需求没有从它们下面改变，那么这可能还不够。

如果 COM 对象都可以在单个用户身份下运行，那可以为您省去一件麻烦事。除此之外，您可能只需要确保一次只有一个给定对象的实例，并且对它的所有访问都是序列化的。为此，请在 VB.NET 中使用 SyncLock 语句。

最终的解决方案是对代码进行“测试驱动端口”。我会使用现有的代码库来创建自动化单元测试（也许使用[vbunit](http://www.vbunit.com/)）。一旦一段代码具有足够的单元测试覆盖率，您就可以将该代码（仍作为 COM 对象）移植到 VB.NET。单元测试可用于确认端口仍在工作。

这样的端口可能没有您想象的那么艰难。“复制和粘贴并修复编译器错误”在 VB6 和 VB.NET 之间运行良好。甚至有工具可以提供帮助。但正是自动化测试使这变得实用。否则，您会合理地担心端口的完成情况。

请注意，原始 VB6 代码应该仍然可以使用新的 COM 对象。事实上，这应该是一个测试。

另请注意，这将是记录正在移植的代码的好机会，这样在未来十年内这将不再是一个问题。只是不要丢失文档！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T15:25:27.627

查看 Jesse Kaplan 在 msdn 杂志上的一些文章。他的专栏名为 CLR Inside Out。查找 COM 互操作文章。问题可在此处下载：http: [//msdn.microsoft.com/en-us/magazine/cc159440.aspx](http://msdn.microsoft.com/en-us/magazine/cc159440.aspx)

编辑：看起来卡普兰先生只是该部分的偶尔贡献者。它仍然是 Interop 相关建议的绝佳资源。

# php - 在 Drupal 6 中主题化 CCK 输入表单

> ID：658332
> 
> 赞同：2
> 
> 时间：2009-03-18T13:50:45.030
> 
> 标签：php, drupal, drupal-6, themes, cck

在我的 template.php 文件中，我有这个：

```
function myadmintheme_theme(&$existing, $type, $theme, $path) {
  return array(
    'node_form' => array(
        'arguments' => array('form' => NULL),
        'template' => 'ccktype',
    ),
  );
} 
```

我在同一个目录中有一个 ccktype.tpl.php ：

```
<b>works!</b> 
```

但是不工作，如果我进入 node/add/ccktype 我没有得到“工作！” 消息..我什么都试过了！

任何帮助，将不胜感激

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-18T14:43:16.197

您需要覆盖的主题函数是 ccktype_node_form，而不是 node_form。由节点模块维护的所有节点表单都映射到 node_form 函数以进行构建，但它们仍然具有唯一的表单 ID。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T15:09:14.153

这是解决方案：

```
function myadmintheme_theme($existing, $type, $theme, $path) {
  return array(
    'ccktype_node_form' => array(
        'arguments' => array('form' => NULL),
        'template' => 'ccktype',
    ),
  );
} 
```

非常感谢伊顿！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-16T05:29:34.073

它开始对我有用，但经过长时间的试验。:) 我正在使用 Drupal 6，并且我犯了为 Drupal 5 编写代码的错误。我在我的 node-minister-edit.php 中使用`form_render`（至于 D5）而不是（对于 D6）。`drupal_render`

template.php 的下一个变化是函数

```
waffles_theme($existing, $type, $theme, $path){ 
    return array( 'minister_node_form' => array( 'arguments' => array('form' => NULL), 'template' => 'node-minister-edit' ) ); 
} 
```

查看数组参数`template`从哪个更改`minister`为`node-minister-edit`我的节点特定模板文件。在这里`minister_node_form`，第一个单词“部长”是我的内容类型。

正如[Seb](https://stackoverflow.com/users/76583/seb)所说，我在开始使用任何此类更改之前清除了缓存。希望这对其他人有帮助:)

以下项目帮助了我：
1\. [http://drupal.org/node/601646](http://drupal.org/node/601646)
2\. [http://drupal.org/node/98253](http://drupal.org/node/98253)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T14:14:06.673

首先，看到 Drupal 没有缓存你的模块。转到管理 > 站点配置 > 性能，然后清除所有缓存。

如果这不起作用，请尝试将文件重命名为 node-add-ccktype.tpl.php。

# inversion-of-control - 如何用城堡温莎覆盖组件？

> ID：658344
> 
> 赞同：16
> 
> 时间：2009-03-18T13:55:26.813
> 
> 标签：inversion-of-control, castle-windsor, ioc-container, castle

我想在给定的 Windsor 容器中重新定义（默认）实现。这就是 OverWrite 的用途吗？不过，这不起作用。

```
container.Register(
                    Component.For<IServiceOperationAuthorization>()
                            .OverWrite()
                            .Instance(_authorization)
                    ); 
```

还有其他想法吗？

干杯，拉斯

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2013-05-30T09:15:18.220

您可以在需要覆盖默认实现的地方非常简单地执行此操作。这是我们集成测试的一个例子。两种实现现在都已注册，但您的代码将使用默认的实现，即您刚刚注册的实现。像炸弹一样工作，对应用程序的其余部分没有任何影响：

```
 var sendMailStub = MockRepository.GenerateStub<ISendMail>();
        _container.Register(
            Component
                .For<ISendMail>()
                .Instance(sendMailStub)
                .IsDefault()
            ); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-20T00:25:24.487

我同意 Krzysztof 的观点，这通常不是一个好主意……但是据我所知，OverWrite() 不会覆盖默认组件，它只会覆盖由属性定义的生活方式（即 [Singleton]）。

如果要更换一个组件，可以使用`container.Kernel.RemoveComponent(string key)`后跟注册的新组件。

这*是*一个有意义[的例子。](http://ayende.com/Blog/archive/2007/09/22/Introducing-MonoRail.HotSwap.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-21T22:13:44.600

这可能是通过使用装饰器设置容器可以更好地解决的问题，您可以在其中显式更改装饰器正在引导调用的实现......特别是如果您想替换现有组件的实现（即单例）已被注入，它可能在您的应用程序的生命周期中存在。

真的需要更多关于你想要达到的目标的背景。

* * *

[这是有关在 Windsor 注册装饰器的更多信息](http://blog.bittercoder.com/PermaLink,guid,63653be2-d0d4-4a0b-b3e5-a1572aad5c8b.aspx)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-10-28T21:00:42.030

在集成测试套件中运行系统时，我需要切换组件实现并且无法使用 container.Kernel.RemoveComponent()。所以我最终得到了一个[简单的设施](http://johan.andersson.net/blog/2009/10/switching-component-implementations-in.html)来为我处理这个问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-21T08:39:10.757

我实际上找到了一个很好的解决方案，我将 xml 文件结合起来进行覆盖，并使用流利的注册作为默认值。

fluent-API 将 impl 的全名作为默认键。在运行中，我覆盖了 xml-config 的 id 以模仿 fluent-API 的键约定。

然后我一边听一边注册 xml-config `Kernel.ComponentRegistered`。

之后，我只从 xml 尚未定义服务的代码配置中添加服务。

*（这是不久前，我只是复制粘贴代码。希望你能让它工作。如果你发现任何问题，我会进行编辑）*

```
IList<Type> unnamedServices = new List<Type>();
IDictionary<string, Type> namedServices = new Dictionary<string, Type>();

ComponentDataDelegate registered = captureRegistrations(unnamedServices, namedServices);

container.Kernel.ComponentRegistered += registered;

// The method that captures the services
private static ComponentDataDelegate captureRegistrations(
    IList<Type> unnamedServices, IDictionary<string, Type> namedServices)
{
        return (key, handler) =>
               {
                   if (handler.ComponentModel.Name == handler.ComponentModel.Implementation.FullName)
                   {
                       unnamedServices.Add(handler.Service);
                   }
                   else
                   {
                       namedServices.Add(key, handler.Service);
                   }
               };
} 
```

之后，在我用代码注册服务之前，我会检查它们是否已经注册。我还创建了一个基类，使这更容易。这是一个应用程序配置：

```
public class ApplicationConfiguration : WindsorConfigurationSkeleton
{
    internal static WindsorServiceLocator create()
    {
        var container = createWith(null, "components-config.xml", coreServices, caches, roles);
        return new WindsorServiceLocator(container);
    }

    internal static IEnumerable<IRegistration> coreServices()
    {
        yield return Component.For<ISystemClock>()
            .ImplementedBy<PreciseSystemClock>()
            .Parameters(Parameter.ForKey("synchronizePeriodSeconds").Eq("10"))
            .LifeStyle.Singleton;

        yield return Component.For<IMailService>()
            .ImplementedBy<MailQueueService>()
            .LifeStyle.Singleton;
    }

    internal static IEnumerable<IRegistration> caches()
    {
        yield return Component.For<IDataCache<ServiceAttributes>>()
            .ImplementedBy<NoDataCache<ServiceAttributes>>()
            .LifeStyle.Singleton;

        // ....
    }
} 
```

进行接线的基类：（Logging 来自 Commons.Logging）

```
public class WindsorConfigurationSkeleton
{
    private static readonly ILog _log = LogManager.GetLogger(
        typeof(WindsorConfigurationSkeleton));

    internal static IWindsorContainer createWith(
        IRegistration[] customs, string configFile, params Func<IEnumerable<IRegistration>>[] methods)
    {
        IWindsorContainer container = new WindsorContainer();
        BugFix.Kernel = container.Kernel;

        container.AddFacility("factory.support", new FactorySupportFacility());

        IList<Type> unnamedServices = new List<Type>();
        IDictionary<string, Type> namedServices = new Dictionary<string, Type>();

        ComponentDataDelegate registered = captureRegistrations(unnamedServices, namedServices);

        container.Kernel.ComponentRegistered += registered;

        if (customs != null)
        {
            container.Register(customs);
        }

        if (configFile != null)
        {
            tryAddXmlConfig(container, configFile);
        }

        container.Kernel.ComponentRegistered -= registered;

        if (methods != null && methods.Length > 0)
        {
            container.Register(union(unnamedServices, namedServices, methods));
        }

        return container;
    }

    private static ComponentDataDelegate captureRegistrations(
        IList<Type> unnamedServices, IDictionary<string, Type> namedServices)
    {
        return (key, handler) =>
               {
                   if (handler.ComponentModel.Name == handler.ComponentModel.Implementation.FullName)
                   {
                        var text = unnamedServices.Contains(handler.Service) ? "another" : "default";
                       _log.Info(
                           m => m(
                                    "Registered {2} service for {0} with {1}.",
                                    handler.Service.GetDisplayName(),
                                    handler.ComponentModel.Implementation.GetDisplayName(),
                                    text
                                    ));

                       unnamedServices.Add(handler.Service);
                   }
                   else
                   {
                        var text = namedServices.ContainsKey(key) ? "another" : "default";
                       _log.Info(
                           m => m(
                                    "Registered {3} service {0} with name '{1}' and {2}.",
                                    handler.ComponentModel.Service,
                                    handler.ComponentModel.Name,
                                    handler.ComponentModel.Implementation.GetDisplayName(),
                                    text
                                    ));
                       namedServices.Add(key, handler.Service);
                   }
               };
    }

    protected static void tryAddXmlConfig(IWindsorContainer container, string filename)
    {
        var fi = Resources.GetFileFromResourceHierarchy(typeof(ApplicationContext).Namespace, filename);
        if ( fi == null ) {
            return;
        }
        var configFile = fi.FullName;
        var xd = immitateFluentApiDefaultIdBehaviour(configFile);
        container.Install(Configuration.FromXml(new StaticContentResource(xd.OuterXml)));

    }

    private static XmlDocument immitateFluentApiDefaultIdBehaviour(string configFile)
    {
        var xd = new XmlDocument();
        xd.Load(configFile);

        foreach (
            XmlElement component in
                xd.SelectNodes("/configuration/components/component[@type and (not(@id) or @id = '')]"))
        {
            var type = Type.GetType(component.GetAttribute("type"), true);
            component.SetAttribute("id", type.FullName);
        }

        return xd;
    }

    private static IRegistration[] union(
        IList<Type> unnamed, IDictionary<string, Type> named, params Func<IEnumerable<IRegistration>>[] methods)
    {
        var all = new List<IRegistration>();
        foreach (var method in methods)
        {
            foreach (var registration in method())
            {
                var registrationType = registration.GetType();
                if (registrationType.IsGenericTypeOf(typeof(ComponentRegistration<>)))
                {
                    var componentType = registrationType.GetGenericArgumentsFor(typeof(ComponentRegistration<>))[0];

                    var name = (string)registrationType.GetProperty("Name").GetValue(registration, null);

                    if (name != null)
                    {
                        if (named.ContainsKey(name))
                        {
                            _log.Debug(
                                m => m("Skipped registering default named component {0}.", name));
                            continue;
                        }
                    }
                    else if (unnamed.Contains(componentType))
                    {
                        _log.Debug(
                            m => m("Skipped registering default component for type {0}.", componentType));
                        continue;
                    }

                    all.Add(registration);
                }
                else
                {
                    all.Add(registration);
                }
            }
        }

        return all.ToArray();
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T12:31:45.833

是的，它确实重新定义了服务的默认实现。你为什么这么做？为什么不首先注册它，而不是重新定义它？

你能提供更多的上下文吗？

# wpf - winforms新手试图进入wpf，寻找资源

> ID：658350
> 
> 赞同：2
> 
> 时间：2009-03-18T13:57:29.833
> 
> 标签：wpf, graphics

我在 Wpf 的世界里是全新的，我想是时候为我的下一个项目进入它了。

我是一个铁杆 Winforms 人。我的许多项目都执行了大量的自定义绘图——例如绘制一个虚拟棒球击球区，然后绘制图标来表示投手投出的球或击球手看到的投球。音高是交互式的 - 用户可以选择一个或多个音高（单击、shift-click、矩形拖动），然后播放所选音高的视频。

我还有一些应用程序，我可以在其中绘制自定义对象，然后允许用户拖动它们并将它们放置在空白画布上。

我正在尝试学习如何在 Wpf 世界中做这些类型的事情。今天我的第一个“hello world”图形程序开始工作了，在那里我覆盖了 ArrangeOverride 并在一个空白窗口上画了一些线条。但我一直在阅读有关 UIElement 类和 Adorner 的内容，并希望确保我以“正确的方式”做事。例如，我所有的宣传都应该是他们自己的 UIElement 吗？

我想知道是否有人可以指导我使用一些示例代码或书籍或文章来帮助我入门。如果我能看到创建自定义绘制对象的“正确方法”（任何复杂性，一个简单的矩形都可以），让用户选择它（以某种方式突出显示它以显示它已被选中）然后让用户拖动它在 Wpf 窗口周围，我会顺利进行。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-18T14:01:06.067

我也来自 WinForms 背景，我发现的最好的书是 Adam Nathan 的“Windows Presentation Foundation Unleashed”。

亚马逊：[http ://www.amazon.com/Windows-Presentation-Foundation-Unleashed-WPF/dp/0672328917](https://rads.stackoverflow.com/amzn/click/com/0672328917)

这是一本非常关注 XAML 的书。我觉得对于 WinForms 人来说非常重要，因为您必须摆脱代码控制 UI 的思维方式。XAML 在 WPF 世界中很友好，您需要养成从 XAML 与代码开始的习惯。

# string - How to find common strings among two very large files?

> ID：658351
> 
> 赞同：9
> 
> 时间：2009-03-18T13:58:14.403
> 
> 标签：string, algorithm, file

I have **two very large files** (and **neither of them would fit in memory**). **Each file has one string** (which doesn't have spaces in it and is either 99/100/101 characters long) **on each line.**

**Update:** The strings are not in any sorted order.
**Update2:** I am working with Java on Windows.

Now I want to figure out the best way **to find out all the strings that occur in both the files.**

I have been thinking about using external merge sort to sort both the files and then do comparison but I am not sure if that would be the best way to do it. Since the strings are mostly around the same length, I was always wondering if computing some kind of a hash for each string would be a good idea, since that should make comparisons between strings easier, but then that would mean I have to store the hashes computed for the strings I have encountered from the files so far so that they can be used later when comparing them with other strings. I am not able to pin down on what exactly would be the best way. I am looking for your suggestions.

When you suggest a solution, also please state if the solution would work if there were more than 2 files and strings which occur in all of them had to be figured out.

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-18T14:14:54.037

You haven't said what platform you're working on, so I assume you're working on Windows, but in the unlikely event that you're on a Unix platform, standard tools will do it for you.

```
sort file1 | uniq > output
sort file2 | uniq >> output
sort file3 | uniq >> output
...
sort output | uniq -d 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-18T14:33:02.790

我会这样做（对于任意数量的文件）：

*   仅排序**1 个文件**(#1)。
*   遍历下一个文件 (#2) 的每一行并对 #1 文件进行二进制搜索（基于行数）。
*   如果找到字符串；将其写入另一个临时文件（#temp1）。
*   完成#2 后，将#temp1 排序到#3 并执行相同的搜索，但这次是在#temp1，而不是#1，它应该比第一个要少得多，因为它只有重复的行。
*   对新的临时文件重复此过程，删除以前的#temp 文件。随着重复行数的减少，每次迭代的时间应该越来越少。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-20T13:08:17.633

根据一个文件中条目的相似程度，可能会从中创建一个[Trie](http://en.wikipedia.org/wiki/Trie#Compressing_tries)（而不是树）。使用这个 trie，您可以迭代另一个文件并检查每个条目是否在 trie 内。

当您有超过 2 个文件时，迭代一个文件并从匹配项中构建一个新的 trie。这样，您拥有的最后一次尝试将包含所有文件中包含的所有匹配项。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T14:43:17.180

我会对每个文件进行排序，然后使用平衡线算法，从一个文件或另一个文件中一次读取一行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T14:05:42.933

Is there any order to the data in the files? The reason I ask is that though a line by line comparison would take an eternity, going through one file line by line whilst doing a binary search in the other would be much quicker. This can only work if the data is sorted in a particular way though.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T14:14:27.220

I would load both files into two database tables so that each string in the file became a row in the table and use SQL queries to find duplicate rows using a join.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-11-08T12:58:31.063

要在 Windows 中执行此操作，非常简单。假设您有两个文件 A 和 B。“A”文件包含您要在文件 B 中搜索的字符串。只需打开命令提示符并使用以下命令

```
FINDSTR /G:A B > OUTPUT 
```

这个命令非常快，可以非常有效地比较两个文件。文件 OUTPUT 将包含 A 和 B 中常见的字符串。

如果要执行 OR 操作（B 中除 A 之外的字符串），请使用

```
FINDSTR /V /G:A B > OUTPUT 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-18T15:36:37.007

基于哈希的解决方案可能如下所示（在 python 伪代码中）：

```
hashes = dict()
for file in files:
    for line in lines:
        h = md5(line)
        hashes[h] += 1 
```

然后再次循环，打印匹配行：

```
for file in files:
    for line in lines:
        h = md5(line)
        if hashes[h] == nfiles:
            print line
            del hashes[h]  # since we only want each once. 
```

有两个潜在的问题。

1.  潜在的哈希冲突（可以减轻一些，但有风险。）
2.  需要能够处理大小为 |uniq lines in all files| 的 dict（关联数组）

这是 O(lines * cost(md5) )。

（如果人们有一个更完整的python实现，它很容易编写，虽然我不知道java！）。

# c# - 计算前一周的开始和结束日期

> ID：658353
> 
> 赞同：45
> 
> 时间：2009-03-18T13:59:11.203
> 
> 标签：c#

在 C# 中计算前一周的开始和结束日期的最佳方法是什么？即今天 3 月 18 日将导致 3 月 9 日（上周星期一）和 3 月 15 日（上周星期日）。

我已经看到使用 DayOfWeek 和 switch 语句来计算偏移量，但想知道是否有更优雅的方法。

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2009-03-18T14:08:37.280

您可以跳过 while 循环并使用

```
DateTime mondayOfLastWeek = date.AddDays( -(int)date.DayOfWeek - 6 ); 
```

这假设您使用星期一作为一周的第一天。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-03-18T14:02:35.750

```
DayOfWeek weekStart = DayOfWeek.Monday; // or Sunday, or whenever
DateTime startingDate = DateTime.Today;

while(startingDate.DayOfWeek != weekStart)
    startingDate = startingDate.AddDays(-1);

DateTime previousWeekStart = startingDate.AddDays(-7);
DateTime previousWeekEnd = startingDate.AddDays(-1); 
```

阅读：一次回溯一天，直到我们在本周开始，然后减去七到上周开始。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-09-04T12:35:16.480

使用流利的日期时间[https://github.com/FluentDateTime/FluentDateTime](https://github.com/FluentDateTime/FluentDateTime)

```
var dateTime = 1.Weeks().Ago();
var monday = dateTime.Previous(DayOfWeek.Sunday);
var sunday = dateTime.Next(DayOfWeek.Sunday); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-18T14:05:49.033

使用 DayOfWeek 将是实现此目的的一种方式：

```
 DateTime date = DateTime.Now.AddDays(-7);
    while (date.DayOfWeek != DayOfWeek.Monday)
    {
        date = date.AddDays(-1);
    }

    DateTime startDate = date;
    DateTime endDate = date.AddDays(7); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-01-21T20:41:02.207

您可以创建一个可以与 DayOfWeek 参数一起使用的 DateTime 扩展方法：

```
public static class DateTimeExtension
{
    public static DateTime GetPreviousWeekDay(this DateTime currentDate, DayOfWeek dow)
    {
        int currentDay = (int)currentDate.DayOfWeek, gotoDay = (int)dow;
        return currentDate.AddDays(-7).AddDays(gotoDay-currentDay);
    }        
} 
```

然后按如下方式使用它：

```
DateTime testDate = new DateTime(2017, 01, 21);

Console.WriteLine(testDate.GetPreviousWeekDay(DayOfWeek.Sunday));
Console.WriteLine(testDate.GetPreviousWeekDay(DayOfWeek.Saturday)); 
```

* * *

要使用它从当前日期获取前一周（如问题中所述）：

```
var prevWkStartDate = DateTime.Now.GetPreviousWeekDay(DayOfWeek.Monday); 
var prevWkEndDate = DateTime.Now.GetPreviousWeekDay(DayOfWeek.Sunday);
Console.Write($"Previous week starts at {prevWkStartDate.ToShortDateString()}");
Console.WriteLine($" and ends at {prevWkEndDate.ToShortDateString()}"); 
```

更新：似乎这需要修复（示例日期：2020 年 12 月 10 日）：

```
public static DateTime GetPreviousWeekDay(this DateTime currentDate, DayOfWeek dow)
{
    int d = 0; if (dow == DayOfWeek.Sunday) { dow = DayOfWeek.Saturday; d = 1; }
    int currentDay = (int)currentDate.DayOfWeek, gotoDay = (int)dow;
    return currentDate.AddDays(-7).AddDays(gotoDay - currentDay + d);
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-10-02T15:19:09.823

当前接受的答案将通过给出本周的星期一而不是最后几周的星期一而在星期日失败。（带有单元测试输出的代码）

```
DateTime mondayOfLastWeek = date.AddDays( -(int)date.DayOfWeek - 6 );
//Failed to get start of last-week from date-time: 2020-03-01T00:00:00.0000000Z
//  Expected: 2020-02-17 00:00:00.000
//  But was:  2020-02-24 00:00:00.000 
```

以下代码解决了这个问题：

```
var dayOfWeek = (int) date.DayOfWeek - 1;
if (dayOfWeek < 0) dayOfWeek = 6;

var thisWeeksMonday = date.AddDays(-dayOfWeek).Date;
var lasWeeksMonday = thisWeeksMonday.AddDays(-7); 
```

如果您愿意，可以将其简化为单行代码（我不建议使用这种几乎不可读的代码......）：

```
var mondayOfLastWeek  = date.AddDays(-(7 + ((int)date.DayOfWeek - 1 == -1 ? 6 : (int)date.DayOfWeek - 1))); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-12-07T21:23:23.733

公认的解决方案实际上是不正确的。

您必须在一周“休息”时进行切换，即当它认为一周结束或开始时，并且接受的解决方案中的公式没有。

这在星期一不像一周开始那么明显，但如果您将星期四视为本周末，则更是如此。

正确的公式是（以星期四为结束日）：

```
DateTime thu = date.AddDays(-(int)(date.AddDays(-5).DayOfWeek) -1); 
```

对于星期一，-5 将切换到 -2。

打印输出示例代码

```
 String s = "";
        DateTime date = new DateTime(2017, 1, 1);
        for (int i = 0; i < 14; i++)
        {
            date = date.AddDays(1);
            DateTime thu = date.AddDays(-(int)(date.AddDays(-5).DayOfWeek) -1);
            DateTime mon = date.AddDays(-(int)(date.AddDays(-2).DayOfWeek) -1);
            s += date.ToString() + " - Thu: " + thu.ToString() + " - Mon: " + mon.ToString() + "\r\n";
        }
        Console.WriteLine(s); 
```

# c++ - 为什么子窗口可能收不到鼠标事件？

> ID：658355
> 
> 赞同：1
> 
> 时间：2009-03-18T13:59:44.167
> 
> 标签：c++, windows, winapi, wtl

我有一个自定义 WTL 控件，它是一个带有列表和自定义滚动条的面板。

```
class Panel
: public ATL::CWindowImpl<Panel>, public WTL::CDoubleBufferImpl<Panel> {
public:
    DECLARE_WND_CLASS("Panel")

    BEGIN_MSG_MAP_EX(Panel)
        MSG_WM_CREATE(OnCreate)
        MSG_WM_DESTROY(OnDestroy)
        MSG_WM_SIZE(OnSize)
        CHAIN_MSG_MAP(CDoubleBufferImpl<Panel>)
        REFLECT_NOTIFICATIONS()
    END_MSG_MAP() 
```

滚动条由面板在 OnCreate() 中创建：

```
m_scrollBar.Create(m_hWnd, WTL::CRect(...)); 
```

该滚动条在许多其他对话框窗口中工作正常。但是，在该面板控件内，滚动条出现，但根本没有接收到鼠标事件。如果我将`WM_MOUSEMOVE`处理程序添加到面板，它会被调用。

可能是什么问题呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T14:32:03.557

诊断 Windows 消息传递问题的一个好方法是使用 Spy++ 或[Winspector](http://www.windows-spy.com/)，它们可以让您深入了解 Windows 消息传递。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T14:36:13.657

找到了。问题出在滚动条类声明中：

```
class CScrollBase : public ATL::CWindowImpl<CScrollBase, WTL::CStatic> 
```

更改为：

```
class CScrollBase : public ATL::CWindowImpl<CScrollBase> 
```

使滚动条在面板上工作。

# php - PHP rand() ...获得真正的 50/50 结果？

> ID：658357
> 
> 赞同：8
> 
> 时间：2009-03-18T14:00:24.287
> 
> 标签：php

我想运行一个具有 2 个不同结果的函数，但我希望每个结果都是真正的 50%。我假设 rand(0,1) 是要走的路，但我很好奇这是否可能有利于另一个。获得 50/50 结果的最佳方法是什么？

谢谢。

编辑：谢谢大家，我不希望它是随机的，我希望结果是 101010101 而不是 111001101。也许我应该用最后一个值输出更新数据库，然后返回相反的结果？

EDIT2：好的，我很抱歉我的最后一次编辑具有误导性。我只为每个用户调用一次该函数，并将该值作为 cookie 分配给用户。我希望每个访问用户都收到 1 或 0 的订单 1010101。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-03-18T14:07:31.197

在 PHP[`mt_rand()`](http://is.php.net/manual/en/function.mt-rand.php)中是一个更好的随机数生成器

```
mt_rand(0,1); 
```

就足够了，应该会产生一个相当不错的 50/50 值。

**引用 mt_rand:**

> 许多旧 libcs​​ 的随机数生成器具有可疑或未知的特性并且速度很慢。默认情况下，PHP 使用带有 rand() 函数的 libc 随机数生成器。mt_rand() 函数是它的替代品。
> 
> 它使用具有已知特性的随机数生成器，使用 » Mersenne Twister，生成随机数的速度比 libc rand() 提供的平均速度快四倍。

比尔有一个关于视觉示例的很好的链接。我不知道用户那里有什么 PHP 用于 PHP，但由于他包含了我将它托管在我的服务器上的代码（带有 PHP 5.1.6 的 Linux）

*   [rand() 可视化示例](http://cznp.com/rand/?rand)
*   [mt_rand() 可视化示例](http://cznp.com/rand/?mt_rand)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-18T14:08:11.913

**对已编辑问题的回应：**如果您想保持准确的 50% 比率，那么随机性是您最不想要的。出于您的目的，您可能只想为每个新用户（未检测到 cookie）分配数据库中的自动编号，然后给偶数用户的一页和奇数用户的另一页（如 RobS 在评论中建议的那样）。

```
if( ($user_id % 2) == 0 )
    // user id is even
else
    // user id is odd 
```

**原始答案：** PHP 的 rand() 函数不是一个特别好的伪随机数生成器（请参阅[简单的可视化示例](http://www.boallen.com/random-numbers.html)）。我会推荐[mt_rand()](http://us2.php.net/mt_rand)代替。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T14:10:05.107

(rand() 和 mt_rand()) 都返回 50%/50% 的好机会。

这是一个例子：

```
$array1 = array(0,0);
$array2 = array(0,0);

for ($x = 0; $x < 10000; $x++) {
  $array1[mt_rand(0,1)] ++;
  $array2[rand(0,1)] ++;
}

print_r($array1);
print_r($array2); 
```

结果：

```
Array 1 (mt_rand):
  [0] => 4910
  [1] => 5090
Array 2 (rand):
  [0] => 4970
  [1] => 5030 
```

根据作者的要求，他想要一个公平的分配。所以尝试这样的事情：

```
$digits = 200;
$array = array_fill(0, $digits/2, 0); 
for ($x = 0; $x < $digits/2; $x++)
  $array[] = 1;
shuffle($array); 
```

均匀分布且足够随机。（布赖恩建议）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-18T14:25:23.697

根据您将使用此数字的特定上下文（例如，基于每个用户、应用程序的生命周期等），您可以将其存储在多个位置、$_SESSION、数据库值，或者如果范围仅涵盖当前页面然后您可以将其直接保存在该页面的代码中。

切换值的简单方法是：

```
$val = 1 - $val; 
```

对于数据库调用：

```
UPDATE YourTable SET `next_value` = 1 - `next_value` 
```

ETC...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-18T14:05:12.983

根据[php手册](http://uk3.php.net/rand)rand(0,1) 是要走的路。但这一切都取决于随机数生成器的好坏。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-18T14:05:42.933

没有什么是真正的 50/50。如果您想要 50/50，则创建函数，使前 5 个结果为 1，其他 5 个为 2，依此类推。

rand 用于随机数生成。这意味着它可以连续给出 10 次相同的结果，但这是随机的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-18T14:12:12.043

免责声明：对于您的特定问题，这是一件愚蠢的事情，但是如果您坚持不信任您的随机数生成器是均匀分布的......

当您不相信您的生成器均匀分布时，生成 50/50 结果的经典算法是以下算法。请注意，与伪随机数相比，此算法更适用于修复随机数，实际上可能会使基于 mod 的结果更糟：

1.  生成两个随机位 A 和 B。
2.  如果 A==B，则转到 1
3.  返回 B

您还可以通过从大量 1 和 0（均匀分布）开始并随机打乱它们来保证均匀分布。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-18T14:40:12.210

RobS 在评论中有一个很好的解决方案，基本上是说每个用户可以获得一个序号，然后通过使用该数字 % 2，你得到一个 0 或一个 1，这将决定提供哪个页面。当然，即使这样也不能绝对保证给出 50/50 的比例……可能是奇数！

此外，根据您确定用户的方式，可能值得验证是否存在某种相关性会使偶数人更有可能购买......不太可能，但只是要记住一些事情。

有一个可供您选择的解决方案，您不必担心奇怪的意外关联：根据您的评论和修改后的问题，您只是想在两种不同页面布局的有效性之间进行公平的分析比较，您可以简单地将每个页面布局销售额除以随机提供的次数。即，您使用随机数生成器，并跟踪它为页面 A 提供多少次 0，以及为页面 B 提供多少次为 1。

假设您在 A 页面上的销售额为 50,000 美元，点击次数为 43 次，而在页面 B 上的销售额为 46,000 美元，点击次数为 38 次，您只需计算一下...

```
Page A                      Page B

50000                       46000
----- = 1163 $/hit          ----- = 1211 $/hit
  43                          38 
```

给页面 B 一点优势。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-18T14:10:03.733

也许您可以尝试[mt_rand(0,1)](http://www.php.net/mt_rand)而不是[rand(0,1)](http://www.php.net/manual/en/function.rand.php)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-18T14:10:56.713

伪随机性永远不可能是真正的随机性。基于种子或其他方式的随机数的每次计算都具有某种程度的预先确定性，这些预先确定性可能会或可能不会以明显的方式出现 - 例如迷你模式。您可以期望的最好结果几乎是 50/50。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-18T14:12:54.587

虽然它是一个伪随机生成器，但它永远不会达到 50/50 ... 阅读。关于这里的随机数生成器：[http ://www.robertnz.net/true_rng.html](http://www.robertnz.net/true_rng.html)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-18T14:24:36.197

如果你只想交替 1 和 0：

```
$n = 0;
$myval = ($n==1 ? $n=0 : $n=1); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-18T14:25:35.833

如果您真的希望它在每次迭代中返回相反的值...

```
function flip() {
    static $truthiness = false;
    $truthiness = !$truthiness;
    return $truthiness;
} 
```

这应该返回真，假，真，假，真等......

当然，这仅在 PHP 解释器在调用之间保留在内存中时才有效。

此外，如果您不知道 static 关键字的作用，请参阅 PHP 手册中关于[变量范围](http://www.php.net/manual/en/language.variables.scope.php)的条目。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-18T14:27:42.727

这个 10101010 不是随机的，它是一个模式。
结果 = 不是结果

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-18T14:38:38.470

这是对您对原始帖子的评论的回应：

您的目标是查看哪个版本的页面产生了更多的销售额。

将每个页面随机显示给访问者比为每个后续访问者翻转 ABABAB 更有意义。

虽然我无法想象您的方法存在系统性偏见的任何原因，但您不能排除它。（牵强的场景：一些跟踪机器人“跟随”用户访问您的页面，因此用户 1 获得 A，机器人获得 B，用户 2 获得 A，机器人获得 B，等等）

在进行像您这样的研究时，获得更好的随机性比确保每个页面的显示准确率为 50% 更明智。

# java - Seam：将文件内容流式传输到页面上的区域

> ID：658358
> 
> 赞同：2
> 
> 时间：2009-03-18T14:00:53.727
> 
> 标签：java, seam

我只是想知道是否有人可以给我一些关于将文件内容输出给使用 Seam 应用程序的用户的最佳方式的指导。

我有一部分应用程序希望在其中显示日志文件的内容。此日志文件可能非常大，因此我不想将其加载到内存中 - 我希望从文件中读取内容流，直接到我页面上的一个区域。实现这一目标的最佳方法是什么？

我知道如何通过将文件的内容写入响应来将文件的内容返回到它自己的页面，但理想情况下，我希望将它流式传输到页面某个区域的响应中。这可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T20:48:44.603

[a4j:poll](http://livedemo.exadel.com/richfaces-demo/richfaces/poll.jsf?c=poll)或 a4j:push 可能会让你到达你想去的地方。也许刷新链接到支持 bean 的面板，以便它始终显示最后 X 行，或者引入一些 javascript，在执行时，将新的文本行附加到页面上的可滚动 div。

# dependency-injection - 如何让 Unity 的自动注入在接口注入的构造函数上工作？

> ID：658360
> 
> 赞同：2
> 
> 时间：2009-03-18T14:01:26.080
> 
> 标签：dependency-injection, unity-container

Unity 文档指出：

> *如果开发人员使用 Unity 容器的 Resolve 方法实例化的类具有定义对其他类的一个或多个依赖项的构造函数，则 Unity 容器会自动创建在构造函数的参数中指定**的依赖对象实例***

这很好，但大多数情况下我不指定注入***类，而是指定******接口***，以保持事物解耦。

**那么，当我 .Resolve<>指定接口注入**而不是类注入的类时，如何利用 Unity 的自动注入？

**即在下面的代码中，当我将我的客户构造函数更改为“ public Customer(ILogger logger)** ”时，如何使它工作？

```
using System;
using Microsoft.Practices.Unity;

namespace TestUnityInjection23
{
    public class Program
    {
        static void Main(string[] args)
        {
            Customer customer1 = new Customer(new BasicLogger());
            //Customer customer2 = new Customer(new AdvancedLogger()); //can't use this since Customer only accepts BasicLogger

            UnityContainer container = new UnityContainer();
            container.RegisterType<Customer>();
            container.RegisterType<ILogger, BasicLogger>();
            Customer customer3 = container.Resolve<Customer>();

            Console.ReadLine();
        }
    }

    public class Customer
    {
        public Customer(BasicLogger logger) //would like to have Customer depend on ILogger here so logger can be swapped out
        {
            logger.WriteToLog("creating the customer");
        }
    }

    public interface ILogger
    {
        void WriteToLog(string text);
    }

    public class BasicLogger : ILogger
    {

        public void WriteToLog(string text)
        {
            Console.WriteLine(text);
        }
    }

    public class AdvancedLogger : ILogger
    {
        public void WriteToLog(string text)
        {
            Console.WriteLine("*** {0} ***", text);
        }
    }

} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T14:28:07.857

我从未使用过 Unity，但我知道的所有其他 DI 框架都这样做，而且我确信 Unity 也必须这样做。

您是否尝试过更改 Customer 构造函数并查看它是否有效？因为它应该。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-23T10:24:42.793

不确定是否为时已晚，但我认为

使用 (IUnityContainer container = new UnityContainer()) { container.RegisterType();

```
 container
                .RegisterType<ILogger, BasicLogger>()
                .Configure<InjectedMembers>()
                .ConfigureInjectionFor<Customer>(new InjectionConstructor(typeof(BasicLogger)));

            var customer3 = container.Resolve<Customer>();
        }
        Console.ReadLine();

public class Customer
        {
            public BasicLogger Logger { get; set; }
            public Customer(ILogger logger) 
            {
                logger.WriteToLog("creating the customer");
            }
        } 
```

会成功的

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-10-19T17:50:05.143

使用泛型

```
public interface ILogger<T> where T: class
{

}

public class BasicLogger:ILogger<BasicLogger>
{

}

public class AdvanceLogger:ILogger<AdvanceLogger>
{

} 
```

# wcf - 带有对象继承的WCF序列化？

> ID：658361
> 
> 赞同：5
> 
> 时间：2009-03-18T14:02:00.680
> 
> 标签：wcf, .net-3.5, serialization

我有两个对象，一个在我们的企业级别，另一个在我们的服务级别。服务对象继承自企业。这是一个简单的例子：

```
[DataContract]
public class EnterpriseObject{
     [DataMember]
     int ID{get; set;}

     string InternalUse{get; set;}
}

[DataContract]
public class ServiceObject: EnterpriseBaseObject{
     [DataMember]     
     string Address{get; set;}
} 
```

是否可以在序列化中仅公开 ServiceObject（具有从 EnterpriseObject 继承的属性）？我不希望客户看到企业对象列为选项？正如您在示例中看到的那样，未为 InternalUser 属性设置 DataMember 属性。这是唯一的方法吗？谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-18T14:06:44.040

您通过添加`[KnownType(typeof(ServiceObject))]`to 来处理继承`EnterpriseBaseObject`- 但是，`EnterpriseBaseObject`仍然是合同的一部分，并且它的存在将是公开的。但只有被标记的成员`[DataMember]`才会被发布。

一种选择（删除继承）是有一个单独的 DTO 用于序列化目的，并在 DTO 版本和实际版本之间进行转换——但这会产生额外的工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T14:08:43.987

您可以将其从 Is A 模式更改为 Has A 模式吗？如果 ServiceObject 有一个 EnterpriseObject，那么您可以只公开您需要的属性。

# 编辑

如果我理解正确，您希望将 ServiceObject 公开给客户端，包括其所有属性（标记为 DataMember），包括从 EnterpriseObject 继承的属性。但是您不希望客户端知道有一个名为 EnterpriseObject 的对象。

您可以通过隐藏存在企业对象的事实来做到这一点。而不是使用继承模式的“Is A”关系。您可以使用合成或“有 A”模式。

```
public class ServiceObject
{
   private EnterpriseObject _myEntObject;

   public string MyServiceObjectProperty
   {
      get;
      set;
   }

   public string MyEntObjectProperty
   {
     get { return _myEntObject.MyEntObjectProperty;}
   }
} 
```

现在您已将 EnterpriseObject 与您的客户端隔离开来。您所有的通信都是 ServiceObject 具有一些您没有向客户端公开的属性，这些属性是由其他对象在服务器上实现的。

这也类似于拥有 DTO，这是一个唯一目的是传输数据的对象。DTO 允许您通过以客户需要的格式准确地提供他们需要的内容来隐藏您的实现，而不会暴露您的内部对象。

# java - Java：在排序列表中查找元素的最佳方法是什么？

> ID：658364
> 
> 赞同：6
> 
> 时间：2009-03-18T14:02:38.307
> 
> 标签：java, list, collections, findall, sorted

我有一个

```
List<Cat> 
```

按猫的生日排序。是否有一种有效的 Java 集合方法来查找所有出生于 1983 年 1 月 24 日**的猫？**或者，一般来说什么是好的方法？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-18T14:06:16.427

[`Collections.binarySearch()`](http://java.sun.com/javase/6/docs/api/java/util/Collections.html).

假设猫按生日排序，这将给出其中一只生日正确的猫的索引。从那里，您可以前后迭代，直到找到一个不同生日的人。

如果列表很长和/或没有多少猫共享生日，这应该是直接迭代的重大胜利。

这是我正在考虑的那种代码。请注意，我假设一个[随机访问](http://java.sun.com/javase/6/docs/api/java/util/RandomAccess.html)列表；对于链表，你几乎被迭代困住了。（感谢 fred-o 在评论中指出这一点。）

```
List<Cat> cats = ...; // sorted by birthday
List<Cat> catsWithSameBirthday = new ArrayList<Cat>();
Cat key = new Cat();
key.setBirthday(...);
final int index = Collections.binarySearch(cats, key);
if (index < 0)
    return catsWithSameBirthday;
catsWithSameBirthday.add(cats.get(index));
// go backwards
for (int i = index-1; i > 0; i--) {
    if (cats.get(tmpIndex).getBirthday().equals(key.getBirthday()))
        catsWithSameBirthday.add(cats.get(tmpIndex));
    else
        break;
}
// go forwards
for (int i = index+1; i < cats.size(); i++) {
    if (cats.get(tmpIndex).getBirthday().equals(key.getBirthday()))
        catsWithSameBirthday.add(cats.get(tmpIndex));
    else
        break;
}
return catsWithSameBirthday; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-18T14:06:21.777

二进制搜索是经典的方法。

澄清：我说你使用二进制搜索。没有一个具体的方法。算法是：

```
//pseudocode:

index = binarySearchToFindTheIndex(date);
if (index < 0) 
  // not found

start = index;
for (; start >= 0 && cats[start].date == date; --start);
end = index;
for (; end < cats.length && cats[end].date == date; ++end);

return cats[ start .. end ]; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-18T14:18:14.527

[Google Collections](http://code.google.com/p/google-collections/)可以通过使用谓词并创建一个过滤集合，其中谓词与日期匹配，来做您想做的事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T14:12:34.617

如果您需要非常快速的搜索，请使用以生日为键的 HashMap。如果您需要对键进行排序，请使用 TreeMap。

因为要允许多只猫的生日相同，所以需要在 Hast/TreeMap 中使用 Collection 作为值，例如

```
 Map<Date,Collection<Cat>> 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-18T14:10:40.037

除非您以某种方式按日期索引集合，否则唯一的方法是遍历所有集合

# iphone - 是否有可用于获取当前壁纸图像的 iPhone SDK API？

> ID：658366
> 
> 赞同：3
> 
> 时间：2009-03-18T14:04:33.157
> 
> 标签：iphone, objective-c, cocoa-touch

是否有可用于获取当前壁纸图像的 iPhone SDK API？我想在游戏中使用这个图像。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-18T14:29:54.623

据我所知，目前没有 API 可以让您执行此操作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-19T04:56:29.173

没有 API 可以执行此操作，但您可以使用 /User/Library/LockBackground.jpg 加载`+[UIImage imageWithContentsOfFile:]`

注意：如果用户没有更改默认的“地球”壁纸，则此文件将不存在

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-12T10:03:19.633

有一个私有 API，通常的 App Store 拒绝免责声明适用

[UIImage defaultDesktopImage]

# .net - 如何定位 .NET Framework 3.5 的依赖项

> ID：658389
> 
> 赞同：2
> 
> 时间：2009-03-18T14:08:46.467
> 
> 标签：.net, deployment, dependencies

我正在努力解决一个让我完全迷失的部署问题。它是这样的：

我有一个 Visual Studio 部署项目，它安装了一个应用程序 - 每个程序集都编译为面向 .NET Framework 2.0。我最近对它们都进行了强命名（因为其中一个程序集是 MS Word 和 MS Outlook 的“共享加载项”，并且指南说这些应该被强命名。我不知道为什么。）我*认为*这是什么时候我的问题开始了。但我也可能是错的。

现在的问题是，在安装 .MSI 包后，我尝试运行该应用程序并崩溃。当我现在转向 Windows 更新时 - 它以某种方式检测到需要安装 .NET Framework 3.5 sp1。如果我在安装 .MSI 包之前运行它，它不会检测到这一点！

安装 .NET Framework 3.5 后，我的应用程序开始运行。

我不知道这种依赖来自哪里！（如果我无法弄清楚，那么我将不得不为我的应用程序设置 3.5，但如果我能找到依赖项的来源，我会很高兴。）

我不知道这是否是一个线索，但在我安装 3.5 之前，我尝试使用 Reflector 检查程序集，并且 Reflector 无法从一个程序集导航到另一个程序集，说“以下程序集名称无法自动解析”然后它说明存在于同一文件夹中的文件的正确程序集名称、版本和 PublicKeyToken。更奇怪的是，它依赖于 Microsoft.VisualC 程序集。但话又说回来：安装 3.5 后，一切都解决了。

我非常感谢任何可以阐明我的问题的东西，
   TIA

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-23T10:46:38.027

嗯，嗯，经过几个不眠之夜，我终于弄清楚，它真的不是完整的 .NET Framework 3.5 所需要的。只是碰巧与它一起分发的一些文件。我的一个程序集是用 C++/CLI 编写的，然后我还需要分发先决条件“Visual C++ Runtime Libraries (x86)”。一旦你发现它就很明显了。*叹*

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T14:15:32.443

如果没有看到您的代码，很难理解您在哪里引入了依赖关系。您可以使用[Reflector](http://www.red-gate.com/products/reflector/)（免费工具）来分析您的 DLL 并查看其中包含的引用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T14:16:20.710

转到您的解决方案资源管理器。选择您的安装项目。右键点击。转到视图 > 启动条件。然后在打开的新窗口中，选择 .NET Framework，然后转到其属性。其中一个属性称为版本。在那里，如果您有 3.5，那么这就是您的问题。将其更改为2.0，您会没事的。

# .net - .Net 二进制序列化 - 如何限制对象图？

> ID：658392
> 
> 赞同：1
> 
> 时间：2009-03-18T14:09:55.000
> 
> 标签：.net, serialization

我有一个对象，我想尽可能高效地在进程之间进行序列化和分发。对象本身具有对另一个对象的引用，如下所示：

```
public class Foo
{
    // Unique Identifier:
    public int Id;
    public Bar Bar;
}

public class Bar
{
    // Unique Identifier:
    public int Id;
} 
```

问题是我只想序列化 Foo 并通过网络运行它。我宁愿不在我通过网络发送的内容中包含 Bar，因为它在另一端是已知的，发送它会浪费我的“带宽”。

我想做的是这样的：

1.  在序列化时，我将对 Bar (Foo.Bar) 的引用序列化为一个 int，其中包含： Bar.Id （这是 Bar 实例的唯一标识符）

2.  只有 Foo 将通过网络发送（包含 int 而不是 Bar 属性）。

3.  在反序列化时，我会获取 int，从存储库中获取正确的 Bar 并将其放入 Foo.Bar 属性中。

这是限制正在序列化的对象图任务的有效方法吗？有没有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-18T14:41:11.477

我不确定我是否在这里遗漏了什么。

只需`NonSerialized`在您不想序列化的字段上使用属性。

然后查看[SerializationSurrogate](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.iserializationsurrogate.aspx)以在反序列化时修复引用。

我正在使用类似的方法来二进制序列化 LINQ2SQL 对象。

更新：

更好的主意（忘了这个）。使用[OnDeserializedAttribute](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.ondeserializedattribute.aspx)，这很容易使用。

如果已经加载到内存中，使用代理方法将允许您返回该对象的另一个实例。我使用它（在 IronScheme 中）来修复对可能在运行时已经存在的盒装值类型的引用。

更新 2：

[您可以在以下文件](https://ironscheme.svn.codeplex.com/svn/IronScheme/IronScheme/Runtime/psyntax/Serialization.cs)的中间看到一个 ISerializationSurrogate 示例。（我提前为丑陋道歉）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-18T14:21:49.633

您所描述的内容需要`ISerializable`（自定义序列化）与常规`BinaryFormatter`- 但是，protobuf-net 将允许您简化事情（因此您不需要自己处理细节），同时通常在过程中使数据更小：

```
[ProtoContract]
public class Foo : ISerializable
{
    // Unique Identifier:
    [ProtoMember(1)]
    public int Id;
    public Bar Bar;

    [ProtoMember(2)]
    private int? BarProxy {
        get {
           if(Bar == null) return null;
           return Bar.Id;
        }
        set {
           if(value == null) { Bar = null; }
           else { // fetch from repository
             Bar = new Bar(); 
             Bar.Id = value;
           }
        }
    }

    public Foo() { }

    void ISerializable.GetObjectData(SerializationInfo info,
           StreamingContext context) {
        Serializer.Serialize(info, this);
    }
    protected Foo(SerializationInfo info, StreamingContext context) {
        Serializer.Merge(info, this);
    }
}

public class Bar
{
    // Unique Identifier:
    public int Id;
} 
```

* * *

对于更简单的设置：

你用的是什么序列化器？

*   使用`BinaryFormatter`，您将不需要的字段标记为`[NonSerialized]`
*   ，`XmlSerializer`您将不想要的成员标记为`[XmlIgnore]`
*   with `DataContractSerializer`，你根本**不把**它们标记为`[DataContract]`

另外 - 也许考虑[protobuf-net](http://code.google.com/p/protobuf-net/)；这有一个非常有效的二进制机制；比`BinaryFormatter`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T14:13:01.013

从本质上讲，这听起来是可行的，您在 Foo 上实现 ISerializable 接口，这将让您控制如何序列化 Foo。

然后你实现相应的构造函数，你就可以访问你保存的状态，并且可以拉出 id。

# sql - Find the number of columns in a table

> ID：658395
> 
> 赞同：145
> 
> 时间：2009-03-18T14:10:05.747
> 
> 标签：sql, mysql

I would like to know if it's possible to find the number of both rows and columns within a table.

```
SELECT COUNT(*)
FROM tablename 
```

* * *

## 回答 #1

> 赞同：227
> 
> 时间：2009-03-18T14:12:31.030

```
SELECT COUNT(*)
  FROM INFORMATION_SCHEMA.COLUMNS
 WHERE table_catalog = 'database_name' -- the database
   AND table_name = 'table_name' 
```

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2014-07-25T10:42:51.507

```
SELECT COUNT(COLUMN_NAME) 
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE 
    TABLE_CATALOG = 'Database name' 
    AND TABLE_SCHEMA = 'dbo' 
    AND TABLE_NAME = 'table name' 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2017-01-30T07:40:01.120

```
SELECT count(*)
FROM information_schema.columns
WHERE table_name = 'Your_table_name'; 
```

注意：Your_table_name 应替换为您的实际表名

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-02-16T06:29:44.590

在 Java 中使用 JDBC：

```
 String quer="SELECT * FROM sample2 where 1=2";

    Statement st=con.createStatement();
    ResultSet rs=st.executeQuery(quer);
    ResultSetMetaData rsmd = rs.getMetaData();
    int NumOfCol=0;
    NumOfCol=rsmd.getColumnCount();
    System.out.println("Query Executed!! No of Colm="+NumOfCol); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-03-02T06:25:25.103

有点晚了，但请把它从我这里拿走……

在编辑器（新查询）中**选择数据库对象**，它也可以是一个表，如果我们使用快捷键**Alt+F1**，我们将获得对象的所有信息，我认为也可以解决您的问题。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2016-01-31T09:41:54.897

好吧，我尝试了 Nathan Koop 的答案，但它对我不起作用。我将其更改为以下内容，并且确实有效：

```
SELECT COUNT(*)
FROM INFORMATION_SCHEMA.COLUMNS
WHERE table_name = 'table_name' 
```

`USE 'database_name'`如果我把nor 也不起作用`WHERE table_catalog = 'database_name' AND table_name' = 'table_name'`。我真的很高兴知道为什么。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-18T18:31:57.647

或使用 sys.columns

```
--SQL 2005
SELECT  *
FROM    sys.columns
WHERE   OBJECT_NAME(object_id) = 'spt_values'
-- returns 6 rows = 6 columns

--SQL 2000
SELECT  *
FROM    syscolumns
WHERE   OBJECT_NAME(id) = 'spt_values'
-- returns 6 rows = 6 columns

SELECT  *
FROM    dbo.spt_values
    -- 6 columns indeed 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2014-04-09T11:36:23.923

```
SELECT count(*) FROM information_schema.`COLUMNS` C
WHERE table_name = 'your_table_name'
AND TABLE_SCHEMA = "your_db_name" 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-11-03T03:01:51.507

只需使用 3 行简单的 PHP 代码，就可以找到表中的列数。

```
$sql="SELECT * FROM table";
$query=mysqli_query($connect_dude,$sql);    
$num=mysqli_num_fields($query); 
```

`$num``columns`在这种情况下，将返回给定表上的数量。

希望它会帮助其他人。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-04-30T05:47:45.750

```
SELECT COUNT(COLUMN_NAME) FROM INFORMATION_SCHEMA.COLUMNS WHERE 
TABLE_CATALOG = 'database_name' AND TABLE_SCHEMA = 'dbo'
AND TABLE_NAME = 'table_name' 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2021-02-09T22:22:11.580

它正在工作（mysql）：

```
SELECT TABLE_NAME , count(COLUMN_NAME)
FROM information_schema.columns
GROUP BY TABLE_NAME 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2018-01-06T00:59:59.400

```
SELECT COUNT(*) 
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE 
   TABLE_NAME = 'table_name'; 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-04-01T06:57:04.710

可以使用以下sql语句获取：

```
select count(*) Noofcolumns from SYSCOLUMNS where id=(select id from SYSOBJECTS where name='table_name') 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-11-01T09:47:07.240

查询以计算表中的列数：

```
select count(*) from user_tab_columns where table_name = 'tablename'; 
```

将 tablename 替换为要返回其总列数的表的名称。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2019-06-20T17:47:32.230

`db2 'describe table "SCHEMA_NAME"."TBL_NAME"'`

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-08-07T22:34:30.080

MySQL 的答案略微改编自[MySqlDataReader.GetValues 的 MSDN 示例](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqldatareader.getvalues.aspx)：

```
//assumes you've already created a connection, opened it, 
//and executed a query to a reader

while(reader.Read())
{
    Object[] values = new Object[reader.FieldCount];
    int fieldCount = reader.GetValues(values);

    Console.WriteLine("\nreader.GetValues retrieved {0} columns.",   fieldCount);
    for (int i = 0; i < fieldCount; i++)
        Console.WriteLine(values[i]);
} 
```

使用`MySqlDataReader.FieldCount`将允许您检索您查询的行中的列数。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-02-28T07:36:49.400

以下查询查找表中的列：-

```
 SELECT COUNT(COLUMN_NAME) FROM USER_TAB_COLUMNS
 WHERE TABLE_NAME = 'TableName'; 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-06-09T09:14:54.453

由于所有答案都在使用`COUNT()`，您还可以使用`MAX()`来获取特定表中的列数

```
SELECT MAX(ORDINAL_POSITION) NumberOfColumnsInTable
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_CATALOG = 'YourDatabaseNameHere'
      AND 
      TABLE_SCHEMA = 'YourSchemaNameHere'
      AND
      TABLE_NAME = 'YourTableNameHere'; 
```

看**[`The INFORMATION_SCHEMA COLUMNS Table`](https://dev.mysql.com/doc/mysql-infoschema-excerpt/5.5/en/columns-table.html)**

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-06-27T12:50:27.227

```
SELECT TABLE_SCHEMA
    , TABLE_NAME
    , number = COUNT(*) 
FROM INFORMATION_SCHEMA.COLUMNS
GROUP BY TABLE_SCHEMA, TABLE_NAME; 
```

这个对我有用。

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2018-12-30T02:11:55.970

以下是使用 Python 3、sqlite3 和 pragma 语句获取多个表列的方法：

```
con = sqlite3.connect(":memory:")    
con.execute("CREATE TABLE tablename (d1 VARCHAR, d2 VARCHAR)")
cur = con.cursor()
cur.execute("PRAGMA table_info(tablename)")
print(len(cur.fetchall())) 
```

[资源](https://www.daniweb.com/programming/software-development/threads/124403/sqlite3-how-to-see-column-names-for-table)

# asp.net - Recent Windows Updates and Credentials

> ID：658400
> 
> 赞同：-2
> 
> 时间：2009-03-18T14:11:24.403
> 
> 标签：asp.net, windows

Hi I recently applied Windows Updates to my server and all of a sudden most of my applications which have credentials such as DefaultNetworkCredentials or hard-coded username/passwords have stopped working. I am unable to get these functioning... is this a known issue? Any work arounds? Thank you.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T15:01:18.167

这是您的方法：

*   找出什么不起作用
*   找出更新期间安装了什么
*   找出导致问题的更新组件
*   采取措施回滚更新或修复您的应用程序

# c++ - 你将如何实现一个基本的事件循环？

> ID：658403
> 
> 赞同：69
> 
> 时间：2009-03-18T14:12:02.950
> 
> 标签：c++, python, blocking, event-loop

如果您使用过 gui 工具包，您就会知道在一切完成后应该执行一个事件循环/主循环，这将使应用程序保持活跃并响应不同的事件。例如，对于 Qt，您可以在 main() 中执行此操作：

```
int main() {
    QApplication app(argc, argv);
    // init code
    return app.exec();
} 
```

在这种情况下， app.exec() 是应用程序的主循环。

实现这种循环的明显方法是：

```
void exec() {
    while (1) {
        process_events(); // create a thread for each new event (possibly?)
    }
} 
```

但这会将 CPU 限制为 100%，并且实际上毫无用处。现在，我怎样才能实现这样一个响应式的事件循环而不完全占用 CPU 呢？

答案在 Python 和/或 C++ 中表示赞赏。谢谢。

脚注：为了学习，我将实现自己的信号/槽，并使用它们来生成自定义事件（例如`go_forward_event(steps)`）。但是，如果您知道我如何手动使用系统事件，我也想知道这一点。

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-03-18T14:29:21.863

我曾经想知道很多同样的事情！

GUI 主循环在伪代码中如下所示：

```
void App::exec() {
    for(;;) {
        vector<Waitable> waitables;
        waitables.push_back(m_networkSocket);
        waitables.push_back(m_xConnection);
        waitables.push_back(m_globalTimer);
        Waitable* whatHappened = System::waitOnAll(waitables);
        switch(whatHappened) {
            case &m_networkSocket: readAndDispatchNetworkEvent(); break;
            case &m_xConnection: readAndDispatchGuiEvent(); break;
            case &m_globalTimer: readAndDispatchTimerEvent(); break;
        }
    }
} 
```

什么是“等待”？好吧，它取决于系统。在 UNIX 上，它称为“文件描述符”，“waitOnAll”是 ::select 系统调用。所谓在 UNIX 上`vector<Waitable>`是 a `::fd_set`，而“whatHappened”其实是通过`FD_ISSET`. 实际的等待句柄是通过各种方式获取的，例如`m_xConnection`可以从 ::XConnectionNumber() 中获取。X11 还为此提供了一个高级的、可移植的 API——::XNextEvent()——但是如果您要使用它，您将无法同时等待多个事件*源*。

阻塞是如何工作的？“waitOnAll”是一个系统调用，它告诉操作系统将您的进程放在“睡眠列表”中。这意味着在其中一个可等待对象上发生事件之前，您不会获得任何 CPU 时间。那么，这意味着您的进程处于空闲状态，消耗 0% 的 CPU。当事件发生时，您的进程将对其做出短暂反应，然后返回空闲状态。GUI 应用程序几乎*所有*时间都处于闲置状态。

你睡觉时所有的 CPU 周期会发生什么？依靠。有时另一个过程会对它们有用。如果没有，您的操作系统将忙于 CPU 循环，或将其置于临时低功耗模式等。

请询问更多详情！

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-19T01:45:14.093

Python：

您可以查看[Twisted reactor](http://docs.huihoo.com/python/twisted/howto/reactor-basics.html)的实现，这可能是 python 中事件循环的最佳实现。Twisted 中的反应器是接口的实现，您可以指定要运行的反应器类型：select、epoll、kqueue（均基于使用这些系统调用的 ac api），还有基于 QT 和 GTK 工具包的反应器。

一个简单的实现是使用 select：

```
#echo server that accepts multiple client connections without forking threads

import select
import socket
import sys

host = ''
port = 50000
backlog = 5
size = 1024
server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server.bind((host,port))
server.listen(backlog)
input = [server,sys.stdin]
running = 1

#the eventloop running
while running:
    inputready,outputready,exceptready = select.select(input,[],[])

    for s in inputready:

        if s == server:
            # handle the server socket
            client, address = server.accept()
            input.append(client)

        elif s == sys.stdin:
            # handle standard input
            junk = sys.stdin.readline()
            running = 0

        else:
            # handle all other sockets
            data = s.recv(size)
            if data:
                s.send(data)
            else:
                s.close()
                input.remove(s)
server.close() 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-03-18T14:23:12.690

一般来说，我会用某种[计数信号量](http://en.wikipedia.org/wiki/Semaphore_(programming))来做到这一点：

1.  信号量从零开始。
2.  事件循环等待信号量。
3.  事件进入，信号量增加。
4.  事件处理程序解除阻塞和递减信号量并处理事件。
5.  处理完所有事件后，信号量为零，事件循环再次阻塞。

如果您不想变得那么复杂，您可以在您的 while 循环中添加一个 sleep() 调用，并且睡眠时间非常短。这将导致您的消息处理线程将其 CPU 时间交给其他线程。CPU 不会再固定在 100% 上，但它仍然非常浪费。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-03-18T16:37:08.420

[我会使用一个名为 ZeroMQ ( http://www.zeromq.org/](http://www.zeromq.org/) )的简单、轻量级的消息传递库。它是一个开源库（LGPL）。这是一个很小的图书馆；在我的服务器上，整个项目编译大约需要 60 秒。

ZeroMQ 将极大地简化您的事件驱动代码，并且在性能方面它也是最有效的解决方案。使用 ZeroMQ 在线程之间进行通信（就速度而言）比使用信号量或本地 UNIX 套接字要快得多。ZeroMQ 也是一个 100% 可移植的解决方案，而所有其他解决方案都会将您的代码绑定到特定的操作系统。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2021-04-25T05:18:15.400

这是一个 C++ 事件循环。在创建 object`EventLoop`时，它会创建一个线程，该线程不断运行给它的任何任务。如果没有可用的任务，则主线程进入睡眠状态，直到添加了一些任务。

首先，我们需要一个线程安全队列，它允许多个生产者和至少一个消费者（`EventLoop`线程）。`EventLoop`控制消费者和生产者的对象。稍加改动，就可以添加多个消费者（runners 线程），而不是只添加一个线程。

```
#include <stdio.h>
#include <thread>
#include <mutex>
#include <condition_variable>
#include <iostream>
#include <set>
#include <functional>

#if defined( WIN32 )
    #include <windows.h>
#endif

class EventLoopNoElements : public std::runtime_error
{
public:
    EventLoopNoElements(const char* error)
        : std::runtime_error(error)
    {
    }
};

template <typename Type>
struct EventLoopCompare {
    typedef std::tuple<std::chrono::time_point<std::chrono::system_clock>, Type> TimePoint;

    bool operator()(const typename EventLoopCompare<Type>::TimePoint left, const typename EventLoopCompare<Type>::TimePoint right) {
        return std::get<0>(left) < std::get<0>(right);
    }
};

/**
 * You can enqueue any thing with this event loop. Just use lambda functions, future and promises!
 * With lambda `event.enqueue( 1000, [myvar, myfoo](){ myvar.something(myfoo); } )`
 * With futures we can get values from the event loop:
 * ```
 * std::promise<int> accumulate_promise;
 * event.enqueue( 2000, [&accumulate_promise](){ accumulate_promise.set_value(10); } );
 * std::future<int> accumulate_future = accumulate_promise.get_future();
 * accumulate_future.wait(); // It is not necessary to call wait, except for syncing the output.
 * std::cout << "result=" << std::flush << accumulate_future.get() << std::endl;
 * ```
 * It is just not a nice ideia to add something which hang the whole event loop queue.
 */
template <class Type>
struct EventLoop {
    typedef std::multiset<
        typename EventLoopCompare<Type>::TimePoint,
        EventLoopCompare<Type>
    > EventLoopQueue;

    bool _shutdown;
    bool _free_shutdown;

    std::mutex _mutex;
    std::condition_variable _condition_variable;
    EventLoopQueue _queue;
    std::thread _runner;

    // free_shutdown - if true, run all events on the queue before exiting
    EventLoop(bool free_shutdown)
        : _shutdown(false),
        _free_shutdown(free_shutdown),
        _runner( &EventLoop<Type>::_event_loop, this )
    {
    }

    virtual ~EventLoop() {
        std::unique_lock<std::mutex> dequeuelock(_mutex);
        _shutdown = true;
        _condition_variable.notify_all();
        dequeuelock.unlock();

        if (_runner.joinable()) {
            _runner.join();
        }
    }

    // Mutex and condition variables are not movable and there is no need for smart pointers yet
    EventLoop(const EventLoop&) = delete;
    EventLoop& operator =(const EventLoop&) = delete;
    EventLoop(const EventLoop&&) = delete;
    EventLoop& operator =(const EventLoop&&) = delete;

    // To allow multiple threads to consume data, just add a mutex here and create multiple threads on the constructor
    void _event_loop() {
        while ( true ) {
            try {
                Type call = dequeue();
                call();
            }
            catch (EventLoopNoElements&) {
                return;
            }
            catch (std::exception& error) {
                std::cerr << "Unexpected exception on EventLoop dequeue running: '" << error.what() << "'" << std::endl;
            }
            catch (...) {
                std::cerr << "Unexpected exception on EventLoop dequeue running." << std::endl;
            }
        }
        std::cerr << "The main EventLoop dequeue stopped running unexpectedly!" << std::endl;
    }

    // Add an element to the queue
    void enqueue(int timeout, Type element) {
        std::chrono::time_point<std::chrono::system_clock> timenow = std::chrono::system_clock::now();
        std::chrono::time_point<std::chrono::system_clock> newtime = timenow + std::chrono::milliseconds(timeout);

        std::unique_lock<std::mutex> dequeuelock(_mutex);
        _queue.insert(std::make_tuple(newtime, element));
        _condition_variable.notify_one();
    }

    // Blocks until getting the first-element or throw EventLoopNoElements if it is shutting down
    // Throws EventLoopNoElements when it is shutting down and there are not more elements
    Type dequeue() {
        typename EventLoopQueue::iterator queuebegin;
        typename EventLoopQueue::iterator queueend;
        std::chrono::time_point<std::chrono::system_clock> sleeptime;

        // _mutex prevents multiple consumers from getting the same item or from missing the wake up
        std::unique_lock<std::mutex> dequeuelock(_mutex);
        do {
            queuebegin = _queue.begin();
            queueend = _queue.end();

            if ( queuebegin == queueend ) {
                if ( _shutdown ) {
                    throw EventLoopNoElements( "There are no more elements on the queue because it already shutdown." );
                }
                _condition_variable.wait( dequeuelock );
            }
            else {
                if ( _shutdown ) {
                    if (_free_shutdown) {
                        break;
                    }
                    else {
                        throw EventLoopNoElements( "The queue is shutting down." );
                    }
                }
                std::chrono::time_point<std::chrono::system_clock> timenow = std::chrono::system_clock::now();
                sleeptime = std::get<0>( *queuebegin );
                if ( sleeptime <= timenow ) {
                    break;
                }
                _condition_variable.wait_until( dequeuelock, sleeptime );
            }
        } while ( true );

        Type firstelement = std::get<1>( *queuebegin );
        _queue.erase( queuebegin );
        dequeuelock.unlock();
        return firstelement;
    }
}; 
```

打印当前时间戳的实用程序：

```
std::string getTime() {
    char buffer[20];
#if defined( WIN32 )
    SYSTEMTIME wlocaltime;
    GetLocalTime(&wlocaltime);
    ::snprintf(buffer, sizeof buffer, "%02d:%02d:%02d.%03d ", wlocaltime.wHour, wlocaltime.wMinute, wlocaltime.wSecond, wlocaltime.wMilliseconds);
#else
    std::chrono::time_point< std::chrono::system_clock > now = std::chrono::system_clock::now();
    auto duration = now.time_since_epoch();
    auto hours = std::chrono::duration_cast< std::chrono::hours >( duration );
    duration -= hours;
    auto minutes = std::chrono::duration_cast< std::chrono::minutes >( duration );
    duration -= minutes;
    auto seconds = std::chrono::duration_cast< std::chrono::seconds >( duration );
    duration -= seconds;
    auto milliseconds = std::chrono::duration_cast< std::chrono::milliseconds >( duration );
    duration -= milliseconds;
    time_t theTime = time( NULL );
    struct tm* aTime = localtime( &theTime );
    ::snprintf(buffer, sizeof buffer, "%02d:%02d:%02d.%03ld ", aTime->tm_hour, aTime->tm_min, aTime->tm_sec, milliseconds.count());
#endif
    return buffer;
} 
```

使用这些的示例程序：

```
// g++ -o test -Wall -Wextra -ggdb -g3 -pthread test.cpp && gdb --args ./test
// valgrind --leak-check=full --show-leak-kinds=all --track-origins=yes --verbose ./test
// procdump -accepteula -ma -e -f "" -x c:\ myexe.exe
int main(int argc, char* argv[]) {
    std::cerr << getTime().c_str() << "Creating EventLoop" << std::endl;
    EventLoop<std::function<void()>>* eventloop = new EventLoop<std::function<void()>>(true);

    std::cerr << getTime().c_str() << "Adding event element" << std::endl;
    eventloop->enqueue( 3000, []{ std::cerr << getTime().c_str() << "Running task 3" << std::endl; } );
    eventloop->enqueue( 1000, []{ std::cerr << getTime().c_str() << "Running task 1" << std::endl; } );
    eventloop->enqueue( 2000, []{ std::cerr << getTime().c_str() << "Running task 2" << std::endl; } );

    std::this_thread::sleep_for( std::chrono::milliseconds(5000) );
    delete eventloop;
    std::cerr << getTime().c_str() << "Exiting after 10 seconds..." << std::endl;
    return 0;
} 
```

输出测试示例：

```
02:08:28.960 Creating EventLoop
02:08:28.960 Adding event element
02:08:29.960 Running task 1
02:08:30.961 Running task 2
02:08:31.961 Running task 3
02:08:33.961 Exiting after 10 seconds... 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-08-20T17:44:10.947

这个答案适用于 Linux 或 Mac OS X 等类 unix 系统。我不知道这是如何在 Windows 中完成的。

选择（）或选择（）。Linux 也有 poll()。

检查手册页以获取详细信息。该系统调用需要文件描述符列表、超时和/或信号掩码。这个系统调用让程序等到一个事件。如果列表中的文件描述符之一准备好读取或写入（取决于设置，请参阅手册页），超时到期或信号到达，此系统调用将返回。然后程序可以读/写文件描述符，处理信号或做其他事情。之后，它再次调用 (p)select/poll 并等待下一个事件。

套接字应该以非阻塞方式打开，以便在没有数据/缓冲区已满时返回读/写函数。使用通用显示服务器 X11，GUI 通过套接字处理并具有文件描述符。所以可以用同样的方式处理。

# java - Should all methods be static if their class has no member variables

> ID：658407
> 
> 赞同：35
> 
> 时间：2009-03-18T14:12:47.253
> 
> 标签：java, static

I've just had an argument with someone I work with and it's really bugging me. If you have a class which just has methods like `calculateRisk` or/and `calculatePrice`, the class is immutable and has no member variables, should the methods be static so as not to have to create an instance of the class each time. I use the following example:

```
public class CalcService {
  public int calcPrice(Trade trade, Date date) {
    ...
  }
  public double calcRisk(Trade trace, Date date) {
    ...
  }
} 
```

Should those methods be `static`?

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-03-18T14:16:27.137

The class you describe is simply just a set of functions that operate on inputs only. It's perfectly reasonable to make such functions static methods of a class. Doing so groups them logically and eliminates possible name conflicts. The class in fact acts as a namespace and nothing more.

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-18T14:17:33.763

I would say yes, but an argument could also be made in this case for just putting those methods on the Trade object.

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-03-18T14:18:47.020

There is a general feeling against static classes these days, for testability reasons.

This is because static classes cannot implement an interface and so cannot be easily substituted for test classes if needed. I think that cases like this that deal with price are an excellent example of this. It is possible in future that there may be multiple ways of calculating a price, and it is nice to be able to substitute these calculators for one another as the need arises.

It may not be useful now but I see more advantages in not using a static class than using one.

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-19T15:58:43.410

这是一个艰难的决定。记住[Josh Bloch 对 API 的评价](http://www.infoq.com/articles/API-Design-Joshua-Bloch)：

> API 就像钻石一样，是永恒的。你有一次机会把它做好，所以要尽力而为。

（这可能不是公共 API，但如果您有同事将使用此代码，它实际上是一个 API。）如果您将这些方法声明为静态，您将限制它们未来的发展，并且在类中合并状态将是困难或不可能。您将不得不忍受这些静态方法签名。如果您因为需要状态而决定使它们成为非静态的，那么您将破坏客户端代码。我会说，当有疑问时，不要让它们成为静态的。也就是说，包含一堆函数（例如计算圆的面积）的静态实用程序类有一个地方。您的类可能属于该类别。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-03-18T15:14:52.907

我会*避免*使这些静态。虽然目前这可能有意义，但您将来可能想要添加一些行为。例如，此时您将拥有一个默认计算引擎（策略）：

```
CalcService cs = new CalcService();
cs.calcPrice(trade, date); 
```

稍后您可能想要添加一个新的计算引擎：

```
CalcService cs = new CalcService(new WackyCalculationStrategy());
cs.calcPrice(trade, date); 
```

如果你使这个类可实例化，那么你可以创建不同的实例并传递它们，即时实例化等。你可以给它们长时间运行的行为（例如，这个对象完成了多少涉及交易 X 的计算？等等）

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-18T14:16:48.447

I would make the whole thing static.

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-18T14:48:25.000

虽然您可以使用 JMockit 或任何类似工具来模拟静态方法，但我个人的选择是尽可能避免使用静态方法，因为静态方法通常会增加耦合。

一些答案暗示该方法是无状态的，但我真的不想那样看。该方法接受方法参数形式的状态。如果这些参数是对象中的状态呢？

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-18T15:18:48.763

我显然会**说不**。

如果您调用静态方法而不是实例方法，那么将来更改起来会困难得多。使用实例方法很容易注入您的服务，例如在 Java 中使用**Guice**或**Spring**等 IoC/DI 容器。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-03-19T02:37:05.110

答案是肯定的和否定的。这完全取决于方法行为的目的。例如：

1.  如果这些方法只是实用方法，那么将它们设为静态就非常有意义。

2.  如果这些方法代表您的应用程序的某种业务逻辑（比方说...一个 Web 应用程序），那么您可能希望使它们尽可能灵活。在这种情况下，它们将成为一个简单的 POJO 类，作为实例方法。这具有不太明显的好处，即它们可以轻松转换为 Spring 事务 bean，甚至 EJB3 会话 bean。它还使这些方法更易于测试。您还可以为这个 bean 创建接口并按照您需要的方式向它添加其他方面。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-18T14:16:40.363

Imo, they should be static. I see no reason why they shouldn't be, since instance objects would have no state, and calling the methods without instantiating would require less code and thus improved readability.

Actually, i would probably make sure the class won't be instantiated by making it abstract.

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-03-18T14:21:51.397

如果将其设为静态，则无法轻松注入不同的实现。

调用非静态方法不再有任何运行时成本，因此对于新代码，尽可能避免使用静态方法。

OTOH，重构工具可以相当容易地替换对静态方法的所有调用，因此无论哪种方式都不是关键。

我不知道您所在领域的价格或风险计算是否会有所不同。如果有不同的策略，传递一个无状态的策略实现可能会有好处。但它的代码更多，而且很有可能是 YAGNI。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-03-18T14:27:18.483

我相信无状态方法通常应该是静态的。

*   在代码中很清楚没有涉及任何对象
*   它避免了无意义的构造函数调用

正如许多人在此处指出的那样，我可以看到打破了策略模式实施的这条规则。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-19T15:34:04.640

我最近遇到了同样的问题。我是使用静态方法。此方法基本上返回我需要保存所有用户定义的设置的文件夹路径。现在的问题是我需要编写一个测试用例，基本上清除文件夹中的所有内容。我绝对不想删除实际文件，因此我希望该方法返回其他内容。Yakes .... 我不能因为它是静态的而不能模拟该方法。没有运气，只能将其更改为非静态方法并让类使用该方法实现接口。然后我可以轻松地模拟该接口并让该方法返回我想要的任何路径。

```
End result. Making it a not static gives you more functionality. Make class Singleton and you have everything a static does for you plus loosely coupling. 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-03-18T14:42:05.700

这取决于你的目标是什么：

如果您的目标是编写尽可能少的代码行，那么静态方法将是最好的。

如果您的目标是可测试性，我们发现静态方法是一个很容易模拟出来的错误。遗憾的是，我们最终为其中的一些编写了一个接口和一个类，只是为了能够轻松地模拟它们。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-03-18T15:06:45.440

如果这些方法需要 Trade 实例中的信息来完成它们的工作，那么为什么这些方法不是 Trade 类的非静态成员？

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-03-19T02:50:27.167

如果没有明确要求将其设置为“静态”，我建议您将它们设为实例。

不仅因为这会产生一种健康的实践，而且，如果您在生产代码中使用它，将来可能会发生变化，那么有一天您可能真的需要更改特定模块的实现并且不希望仅出于这个原因破坏整个应用程序。

同样，这可能不会发生在您的特定代码中，但我曾经在这个应用程序中使用过大量这样的类（40-60 或更多）

很多时候，将这些类作为静态变量会阻止我们轻松更改某些模块，并导致很多痛苦和眼泪。

如果我可以为这些特定部分注入新的实现，那就更容易了。

这个应用程序的代码行数为 500k，而且并非所有代码都在 java 中，这使得重构更加困难。

如果您在 1k 行项目中使用它，则根本没有关系。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-03-19T09:21:54.823

在上面的答案中，我读到了出于测试原因不使其成为静态的论点。我不明白为什么，但我不熟悉您使用的测试程序。

在我们公司，我们使用 Junit 进行单元和系统测试。(org.junit) 用这个测试包测试静态方法完全没有问题。

所以我会说：是的，让它们成为静态的。

（附言我不知道测试静态方法有问题的测试程序）

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-03-18T14:17:56.167

In my opinion they should be static. You might even get performance improvements because the compiler/jit might inline the methods

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-03-18T14:19:53.273

In this case, I would probably make a couple of static methods. I would assume that the calc function does not depend upon other resources to calculate the values, and it is generally segregated from the rest of the code.

In general, however, I tend to shy away from doing overly complicated things in static methods. If you were unit testing and wanted to swap in a MockCalcService, having the static calls spread out across your code would make it very difficult.

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2009-04-07T07:01:43.180

*静电气味*

在大多数情况下，静态方法是与数据分离的行为示例。它表明某些东西没有被封装。例如，如果您在实用程序类中看到电话号码、电子邮件等的验证方法，请询问为什么它们不是这些字段没有自己的类。甚至可以扩展库类以适应自定义行为。最后在像 java.lang.String （这是最终的）这样的特殊情况下，您可以使用委托给 java.lang.String 的自定义 myproject.String （具有附加行为）

对象是在 OO 语言中访问行为的方式。担心对象实例化的成本并改用静态是没有用的。对于大多数商业软件来说，这是一种“一分钱一分货”的性能方法。

有时，您使用函子（不使用对象状态的方法）来表达意图。并不意味着它们应该是静态的。不应认真对待暗示“方法可以设为静态”的 IDE 警告。

# wpf - WPF - 创建自定义 ItemsControl

> ID：658410
> 
> 赞同：3
> 
> 时间：2009-03-18T14:13:12.697
> 
> 标签：wpf, itemscontrol, coda-slider, custom-controls

我正在研究为 WPF 创建自定义控件，并且我发现了一些相当有用的博客，并且模糊地进入了足够的细节，但我仍然有点挣扎。

基本上，我正在尝试创建类似于臭名昭著的“Coda Slider”的东西，但我只是不知道如何正确开始。任何人都可以向我指出某人/某处的方向，让我了解如何创建自定义 ItemControls，或者向我提供基本信息，例如我需要覆盖哪些 ItemsControl 成员？

所有的帮助都将得到慷慨的接受。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T14:20:27.750

构建**自定义 WPF 控件**只不过是编写一个类并从 WPF 中提供的基类继承该类。

[如何创建自定义 WPF 控件](http://nayyeri.net/blog/how-to-create-a-custom-wpf-control/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T14:25:47.847

我认为您必须问自己的第一个问题是为什么您觉得需要自定义控件？你在暴露新的行为吗？如果没有，那么样式和模板是您需要关注的地方。

如果您*真的*打算添加一些新功能，例如公开新属性或创建一些真正不同的东西，那么我相信通过 Google 搜索会找到您需要的内容。例如，这里是Sacha Barber[的一篇优秀文章](http://www.codeproject.com/KB/WPF/WPF_CustomerControl.aspx)，他展示了从现有控件继承。

我并不是要装腔作势：也许您可以更具体地说明您遇到的问题或疑问。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T14:36:27.713

我在一个名为“WittyTwitter”的开源 WPF 项目中看到了同样的功能。当我查看代码时，他们正在使用 Kevin Moore 的“WPF Bag-o-Tricks”库中称为 ZapScroller 的东西。他是微软 WPF 的 PM。看看这里：

[http://work.j832.com/2008/03/bag-o-tricks-march-edition.html](http://work.j832.com/2008/03/bag-o-tricks-march-edition.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T14:26:45.987

如果我错了，请纠正我，但只看“尾声滑块”，它看起来基本上是一个带有动画的 TabControl。

我很确定使用动画和/或附加属性的 TabControl 自定义模板会更好地为您服务。

如果是这种情况，请告诉我们，我们当然可以为您指明正确的方向。WPF 很少需要自定义控件。

# linux - /proc/meminfo 中的条目

> ID：658411
> 
> 赞同：22
> 
> 时间：2009-03-18T14:13:55.690
> 
> 标签：linux, memory, procfs

我可以理解**/proc/meminfo**中包含的大部分信息，例如总内存、缓冲区、缓存等。你能告诉我下面列出的那些不太明显的信息是什么意思吗？

*   匿名页面
*   映射
*   板坯
*   NFS_不稳定
*   弹跳
*   VmallocTotal
*   VmallocUsed
*   VmallocChunk

如果有人想知道，我说的是 linux 命令**cat /proc/meminfo的输出**

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-03-18T17:10:25.703

此信息的规范来源是[/usr/src/linux/Documentation/filesystems/proc.txt](http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=Documentation/filesystems/proc.txt;hb=HEAD#l451)。具体来说，

> ```
>  AnonPages: Non-file backed pages mapped into userspace page tables
>       Mapped: files which have been mmaped, such as libraries
>         Slab: in-kernel data structures cache
> NFS_Unstable: NFS pages sent to the server, but not yet committed to stable
>         storage
>       Bounce: Memory used for block device "bounce buffers"
> VmallocTotal: total size of vmalloc memory area
>  VmallocUsed: amount of vmalloc area which is used
> VmallocChunk: largest contigious block of vmalloc area which is free 
> ```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2011-07-31T00:08:12.473

我的理解如下。
我同意这些数字很难理解并且显示出不一致的值。

*   内存总量

    ```
    = MemFree + Active + Inactive + Slab + PageTables + VmallocUsed + X
    (X : alloc_pages() (get_free_pages(), etc)) 
    ```

    但是最近内核的 vmallocused 值可能是错误的。这是因为它计算了 VM_xxx 区域，例如 VM_IOREMAP、VM_MAP、...而不是 VM_ALLOC 区域。

    VM_IOREMAP 区域可以是内核内存管理之外的映射内存，所以上面的公式可能不精确，或者完全错误。

    你可以这样做：

    *   检查 /proc/vmallocinfo 将所有条目整理出来并自行过滤，
    *   修改 fs/proc/mmu.c: get_vmalloc_info() 以仅在 if(vma->flags & VM_ALLOC) 时计算区域
*   活跃+不活跃

    ```
     = Buffers + Cached + SwapCached + AnonPages 
    ```

*   匿名页面

    ```
     = /proc/*/task/*/smaps anonymous area all sum
     (anonymous: no name|[heap]|/dev/zero|/dev/shm/*|[stack]) 
    ```

    虽然我无法匹配这些数字。如果您有任何线索，请参见[此处并帮助我。](https://stackoverflow.com/questions/6885107/want-to-make-smaps-output-anonymous-region-sum-and-proc-meminfo-anonpages-to-mat)

*   总页面缓存

    ```
     = Buffers + Cached + SwapCached 
    ```

*   板坯

    ```
     = SReclaimable + SUnreclaim 
    ```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T14:25:30.343

来自[红帽](http://www.redhat.com/docs/manuals/enterprise/RHEL-5-manual/Deployment_Guide-en-US/s2-proc-meminfo.html)

> VMallocTotal — 总分配的虚拟地址空间的内存总量，以千字节为单位。VMallocUsed — 已用虚拟地址空间的内存总量，以千字节为单位。VMallocChunk — 可用虚拟地址空间的最大连续内存块，以千字节为单位。

# vb.net - 自定义水印文本框行为异常

> ID：658428
> 
> 赞同：3
> 
> 时间：2009-03-18T14:17:16.807
> 
> 标签：vb.net, visual-studio-2008, custom-controls

# 解决方案：

感谢下面的[Patrick](https://stackoverflow.com/questions/658428/custom-watermarked-textbox-behaving-strangely/658613#658613)，我已将 C# CodeProject 版本重构为适合我的 VB.NET 版本。希望它也可以帮助你们：

```
Partial Public Class WatermarkedTextBox
    Inherits TextBox

    Private _waterMarkColor As Color = Color.LightGray
    Public Property WaterMarkColor() As Color
        Get
            Return _waterMarkColor
        End Get
        Set(ByVal value As Color)
            _waterMarkColor = value
        End Set
    End Property
    Private _waterMarkText As String = "Watermark"
    Public Property WaterMarkText() As String
        Get
            Return _waterMarkText
        End Get
        Set(ByVal value As String)
            _waterMarkText = value
        End Set
    End Property
    Sub New()

    End Sub
    Protected Overloads Overrides Sub OnCreateControl()
        MyBase.OnCreateControl()
    End Sub
    Protected Overrides Sub WndProc(ByRef m As System.Windows.Forms.Message)
        MyBase.WndProc(m)
        Const WM_PAINT As Integer = &HF
        If m.Msg = WM_PAINT Then
            If Text.Length <> 0 Then
                Return
            End If
            Using g As Graphics = Me.CreateGraphics
                g.DrawString(WaterMarkText, Me.Font, New SolidBrush(WaterMarkColor), 0, 0)
            End Using
        End If
    End Sub
    Protected Overrides Sub OnTextChanged(ByVal e As System.EventArgs)
        MyBase.OnTextChanged(e)
        Invalidate()
    End Sub
    Protected Overrides Sub OnLostFocus(ByVal e As System.EventArgs)
        MyBase.OnLostFocus(e)
        Invalidate()
    End Sub
    Protected Overrides Sub OnFontChanged(ByVal e As System.EventArgs)
        MyBase.OnFontChanged(e)
        Invalidate()
    End Sub
    Protected Overrides Sub OnGotFocus(ByVal e As System.EventArgs)
        '' added so the watermark is not cleared until text is entered
        MyBase.OnGotFocus(e)
        Invalidate()
    End Sub
End Class 
```

* * *

我正在构建一个信息亭应用程序，为了保持美观，我决定实现一个带水印的文本框作为输入字段。我在[CodeProject上找到](http://www.codeproject.com/)[了这个项目](http://www.codeproject.com/KB/miscctrl/WaterMark.aspx)，将其转换为 VB.NET 并将其放入我的应用程序中。它可以工作，因为它可以很好地添加水印并清除它们，但是当我输入文本时会发生这种情况：

空的：

![替代文字](https://i.stack.imgur.com/4qaOg.jpg "空的")

填充：

![替代文字](https://i.stack.imgur.com/VxrAh.jpg "填充")

所以基本上它不是清除整个水印，只是为文本框的默认高度分配的空间。这是转换后的代码：

```
Imports System
Imports System.Collections.Generic
Imports System.Linq
Imports System.Text
Imports System.Windows.Forms
Imports System.Drawing

Partial Public Class WatermarkedTextBox
    Inherits TextBox
    Private oldFont As Font = Nothing
    Private waterMarkTextEnabled As Boolean = False

#Region "Attributes"
    Private _waterMarkColor As Color = Color.LightGray
    Public Property WaterMarkColor() As Color
        Get
            Return _waterMarkColor
        End Get
        Set(ByVal value As Color)
            _waterMarkColor = value
            Invalidate()
        End Set
    End Property
    Private _waterMarkText As String = "Water Mark"
    Public Property WaterMarkText() As String
        Get
            Return _waterMarkText
        End Get
        Set(ByVal value As String)
            _waterMarkText = value
            Invalidate()
        End Set
    End Property
#End Region

    Public Sub New()
        JoinEvents(True)
    End Sub  
    Protected Overloads Overrides Sub OnCreateControl()
        MyBase.OnCreateControl()
        WaterMark_Toggle(Nothing, Nothing)
    End Sub
    Protected Overloads Overrides Sub OnPaint(ByVal args As PaintEventArgs)
        'Dim drawFont As New System.Drawing.Font(Font.FontFamily, Font.Size, Font.Style, Font.Unit)
        Dim drawFont As New Font("Arial", 28, FontStyle.Bold) 'New System.Drawing.Font(oldFont.FontFamily, oldFont.Size, oldFont.Style, oldFont.Unit)
        Dim drawBrush As New SolidBrush(WaterMarkColor)
        args.Graphics.DrawString((If(waterMarkTextEnabled, WaterMarkText, Text)), drawFont, drawBrush, New PointF(0.0F, 0.0F))
        MyBase.OnPaint(args)
    End Sub

    Private Sub JoinEvents(ByVal join As Boolean)
        If join Then
            AddHandler Me.TextChanged, AddressOf WaterMark_Toggle
            AddHandler Me.LostFocus, AddressOf Me.WaterMark_Toggle
            AddHandler Me.FontChanged, AddressOf Me.WaterMark_FontChanged
        End If
    End Sub

    Private Sub WaterMark_Toggle(ByVal sender As Object, ByVal args As EventArgs)
        If Me.Text.Length <= 0 Then
            EnableWaterMark()
        Else
            DisableWaterMark()
        End If
    End Sub

    Private Sub EnableWaterMark()
        oldFont = New System.Drawing.Font(Font.FontFamily, Font.Size, Font.Style, Font.Unit)
        Me.SetStyle(ControlStyles.UserPaint, True)
        Me.waterMarkTextEnabled = True
        Refresh()
    End Sub

    Private Sub DisableWaterMark()
        Me.waterMarkTextEnabled = False
        Me.SetStyle(ControlStyles.UserPaint, False)
        If oldFont IsNot Nothing Then
            Me.Font = New System.Drawing.Font(oldFont.FontFamily, oldFont.Size, oldFont.Style, oldFont.Unit)
        End If
    End Sub

    Private Sub WaterMark_FontChanged(ByVal sender As Object, ByVal args As EventArgs)
        If waterMarkTextEnabled Then
            oldFont = New System.Drawing.Font(Font.FontFamily, Font.Size, Font.Style, Font.Unit)
            Refresh()
        End If
    End Sub
End Class 
```

我试图强制班级在 OnPaint 事件中使用我设置的字体大小，但没有运气。还有什么我遗漏的东西让这变得比它应该的更困难吗？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T14:56:42.547

您只是在 DisableWaterMark 子末尾缺少刷新：

```
Private Sub DisableWaterMark()
    Me.waterMarkTextEnabled = False
    Me.SetStyle(ControlStyles.UserPaint, False)
    If oldFont IsNot Nothing Then
        Me.Font = New System.Drawing.Font(oldFont.FontFamily, oldFont.Size, oldFont.Style, oldFont.Unit)
    End If
    Refresh()
End Sub 
```

**编辑：**

您可以在 WndProc 中处理 WM_PAINT 消息，而不是使用 UserPaint 控件样式，并且仅在文本为空时打印水印。结果基本一样。

```
Protected Overrides Sub WndProc(ByRef m As System.Windows.Forms.Message)
    MyBase.WndProc(m)
    Const WM_PAINT As Integer = &HF
    If m.Msg = WM_PAINT Then
        If Text.Length <> 0 Then
            Return
        End If
        Using g As Graphics = Me.CreateGraphics
            g.DrawString("Water Mark", Me.Font, Brushes.LightGray, 0, 0)
        End Using
    End If
End Sub

Protected Overrides Sub OnTextChanged(ByVal e As System.EventArgs)
    MyBase.OnTextChanged(e)
    Invalidate()
End Sub

Protected Overrides Sub OnLostFocus(ByVal e As System.EventArgs)
    MyBase.OnLostFocus(e)
    Invalidate()
End Sub

Protected Overrides Sub OnFontChanged(ByVal e As System.EventArgs)
    MyBase.OnFontChanged(e)
    Invalidate()
End Sub 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T15:16:05.510

[这里](http://www.codeproject.com/KB/edit/TextBoxHint.aspx)和[这里](http://www.codeproject.com/KB/edit/PromptedTextBox.aspx)有一些东西可以帮助你

# c - execvp 返回后，为什么我的程序没有从中断的地方继续？

> ID：658431
> 
> 赞同：4
> 
> 时间：2009-03-18T14:18:08.207
> 
> 标签：c, multithreading, execvp

我有一个像这样作为子线程运行的代码块：

```
if(someVar == 1){
doSomeStuff;

_exit(0)
}
else
   execvp(*(temp->_arguments), temp->_arguments);
printf("I'm done\n"); 
```

当我使用 someVar == 1 运行程序时，我知道 _exit(0) 调用会杀死我的线程。但是，当它设置为 0 时，为什么程序在 execvp() 调用后不继续执行 printf 语句？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-18T14:22:33.847

如果您[`exec*`](http://www.opengroup.org/onlinepubs/9699919799/functions/execvp.html)（调用 exec 系列中的任何 exec 函数），则新程序的代码将加载到您当前的进程中，并继续执行其 main 函数及其内容。成功执行这些函数后，它们将永远不会返回，因为您`printf`的内存中不再存在。

我认为您`exec*`对[`fork`](http://www.opengroup.org/onlinepubs/9699919799/functions/fork.html)功能感到困惑。这将拼接出一个新的子进程，它将运行与父进程相同的代码。

如果您想要创建一个与主线程共享数据和地址空间的新线程，您应该使用该[`pthread_create`](http://www.kernel.org/doc/man-pages/online/pages/man3/pthread_create.3.html)函数。新进程不会共享数据，您必须使用其他机制（如管道或共享内存）与其他进程通信。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T14:21:58.667

[execvp()](http://linux.die.net/man/3/execvp)用新的可执行文件覆盖您的程序并且不会返回，除非发生错误。您需要先[fork()](http://linux.die.net/man/2/fork)然后在子进程上调用 exec* 。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T14:22:22.003

因为用你*exec的进程*`execvp` *替换*你*正在*运行的进程。如果*execvp*返回，那是因为它失败了。否则它不应该返回。

 **# visual-studio-2008 - 从源代码管理中忽略 Web.Config 而不从 VS 2008 中的项目中排除

> ID：658435
> 
> 赞同：2
> 
> 时间：2009-03-18T14:20:11.167
> 
> 标签：visual-studio-2008, version-control, web-config

我有一个我正在从事的项目，我的团队位于两个不同的位置。我们正在使用与 VS 2008 集成的源代码控制系统。我们创建了一个解决方案文件夹，其中存储了不同的 web.config 文件，因此不同的位置可以选择运行项目所需的配置。

我想做的是让我们正在处理的 Web 项目在项目中有一个 web.config 文件，但被源代码控制系统忽略。我们使用的源代码控制系统是 SourceGear，它在默认配置下运行，这让我想起了 VSS。我想避免必须从项目中排除 web.config 文件，但是如果源代码控制系统不断尝试将文件添加回存储库，我看不到任何其他方式。

我怎样才能忽略关于我的源代码控制系统的 web.config 文件，而不必从我的项目中排除该文件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T14:23:29.367

查看 sourcegear 的 Cloaking 功能。唯一的缺点是它是特定于用户的设置，因此团队中的每个人都必须遵守。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T14:33:49.387

虽然我的回答并不特定于源代码控制，但您可能需要考虑的一件事是将自定义配置部分添加到您的 web.config，并根据位置（部署它的服务器）检索不同的配置。

我目前这样做是为了处理部署到登台、测试、生产服务器。我的配置类将确定服务器名称，并检索该特定服务器的配置设置。这样，我不必担心再次触摸 web.config，或者排除它并使用不同的文件。

这是一篇关于如何做到这一点的文章。是的，这并不完全符合您的要求，但可能比依赖源代码控制和使用不同的配置文件更好。

[http://aspnet.4guysfromrolla.com/articles/032807-1.aspx](http://aspnet.4guysfromrolla.com/articles/032807-1.aspx)

# algorithm - 我的布隆过滤器需要多少个哈希函数？

> ID：658439
> 
> 赞同：22
> 
> 时间：2009-03-18T14:20:57.703
> 
> 标签：algorithm, bloom-filter

[维基百科](http://en.wikipedia.org/wiki/Bloom_filter)说：

> 一个空的布隆过滤器是一个由 m 位组成的位数组，全部设置为 0。还必须定义 k 个不同的散列函数，每个散列函数将某个集合元素映射或散列到具有均匀随机分布的 m 个数组位置之一。

我读了这篇文章，但我不明白的是 k 是如何确定的。它是表大小的函数吗？

此外，在我编写的哈希表中，我使用了一种简单但有效的算法来自动增加哈希的大小。基本上，如果表中超过 50% 的桶被填满，我会将表的大小加倍。我怀疑您可能仍想使用布隆过滤器来减少误报。正确的 ？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2014-03-17T23:28:51.737

鉴于：

*   **`n`**：您希望过滤器中有多少项目（例如[216,553](https://softwareengineering.stackexchange.com/a/145633/6654)）
*   **`p`**：您可接受的误报率 {0..1}（例如`0.01`→ 1%）

我们要计算：

*   **`m`**: 布隆过滤器所需的位数
*   **`k`**：我们应该应用的哈希函数的数量

公式：

`m = -n*ln(p) / (ln(2)^2)` *位数*
`k = m/n * ln(2)` *哈希函数的数量*

在我们的例子中：

*   `m`= `-216553*ln(0.01) / (ln(2)^2)`= `997263 / 0.48045`=`2,075,686`位 (253 kB)
*   `k`= `m/n * ln(2)`= `2075686/216553 * 0.693147`=`6.46`哈希函数（7 个哈希函数）

> **注意**：任何发布到公共领域的代码。无需归属。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-03-18T14:28:31.037

如果您进一步阅读[有关 Bloom 过滤器的 Wikipedia 文章](http://en.wikipedia.org/wiki/Bloom_filter)，您会发现*“误报概率”*部分。本节说明哈希函数的数量如何影响误报的概率，并为您提供从所需的预期概率中确定*k的公式。*的误报。

* * *

引用维基百科文章：

> 显然，误报的概率随着 m（数组中的位数）的增加而降低，并且随着 n（插入元素的数量）的增加而增加。对于给定的 m 和 n，最小化概率的 k（散列函数的数量）的值是
> 
> ![公式](https://upload.wikimedia.org/math/b/0/f/b0f40d1a75913391ffe91c2f11285495.png)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-11-08T02:46:56.020

并把它放在一张整洁的小桌子上：

[http://pages.cs.wisc.edu/~cao/papers/summary-cache/node8.html](http://pages.cs.wisc.edu/~cao/papers/summary-cache/node8.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-11-14T07:02:21.897

给定您想要“投资”的每个密钥的位数，最好的 k 是：

```
max(1, round(bitsPerKey * log(2))) 
```

其中`max`，两者中较高的一个，`round`四舍五入到最接近的整数，`log`是自然对数（以 e 为底）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-07-29T06:12:31.083

有一个出色的[在线布隆过滤器](https://hur.st/bloomfilter)计算器。

这个交互式布隆过滤器计算器可让您估计和找出满足布隆过滤器需求的系数。它还向您显示图表以直观地查看结果并提供所有公式例如，以 0.01`n`的概率计算 216,553 个项目：`p`

[![在此处输入图像描述](https://i.stack.imgur.com/RPZBx.png)](https://i.stack.imgur.com/RPZBx.png)

```
n = ceil(m / (-k / log(1 - exp(log(p) / k))))
p = pow(1 - exp(-k / (m / n)), k)
m = ceil((n * log(p)) / log(1 / pow(2, log(2))));
k = round((m / n) * log(2)); 
```

# c# - 如何找到程序集的完全限定名称？

> ID：658446
> 
> 赞同：53
> 
> 时间：2009-03-18T14:21:50.650
> 
> 标签：c#, deployment, assemblies, strongname

如何找出我的程序集的完全限定名称，例如：

```
MyNamespace.MyAssembly, version=1.0.3300.0, 
Culture=neutral, PublicKeyToken=b77a5c561934e089 
```

我已经设法使用`sn.exe`SDK 中的 PublicKeyToken 获得了我的 PublicKeyToken，但我想轻松获得完整的限定名称。

* * *

## 回答 #1

> 赞同：150
> 
> 时间：2013-07-01T02:16:54.513

[这是来自I Note It Down](http://inoteitdown.blogspot.co.nz/2011/07/get-assembly-fully-qualified-name.html)的无耻复制粘贴，是获取项目输出的 FQN 的简单方法：

```
Open Visual Studio
Go to Tools –&gt; External Tools –&gt; Add
    Title: Get Qualified Assembly Name
    Command: Powershell.exe
    Arguments: -command "[System.Reflection.AssemblyName]::GetAssemblyName(\"$(TargetPath)\").FullName"
    Check "Use Output Window". 
```

新工具出现在 下`Tools –&gt; Get Qualified Assembly Name`。选择菜单项时，在输出窗口中会给出程序集名称。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-03-18T14:23:46.417

如果您可以将程序集加载到 .NET 应用程序中，您可以执行以下操作：

```
typeof(SomeTypeInTheAssembly).Assembly.FullName 
```

如果你不能，那么你可以使用 ildasm.exe，它会在某处：

```
ildasm.exe MyAssembly.dll /text 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2013-03-07T12:01:50.087

派对迟到了，但在谷歌上搜索了更多关于这个问题的信息并找到了这个页面：

*   [http://www.pvle.be/2010/04/getting-an-assemblys-strong-name-with-powershell/](http://www.pvle.be/2010/04/getting-an-assemblys-strong-name-with-powershell/)

他描述了一个可以做到这一点的 powershell 函数。所以。我以前从未使用过powershell，但我想我会尝试一下：

```
C:\> cd PATH_TO_ASSEMBLY   
C:\PATH_TO_ASSEMBLY>powershell
Windows PowerShell
Copyright (C) 2009 Microsoft Corporation. All rights reserved.

PS C:\PATH_TO_ASSEMBLY> [System.Reflection.AssemblyName]::GetAssemblyName('System.Data.SQLite.dll').FullName
System.Data.SQLite, Version=1.0.66.0, Culture=neutral, PublicKeyToken=db937bc2d44ff139
PS C:\PATH_TO_ASSEMBLY> 
```

这可以通过使用代码来完成其他答案中提到的技巧，除非您不必创建项目来执行此操作 - 只需在提示符下键入即可；）

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-18T14:27:44.783

使用[Assembly.GetExecutingAssembly()](http://msdn.microsoft.com/en-us/library/system.reflection.assembly.getexecutingassembly.aspx)获取当前程序集，使用[Assembly.GetEntryAssembly()](http://msdn.microsoft.com/en-us/library/system.reflection.assembly.getentryassembly.aspx)获取启动它的程序集，或使用[Assembly.GetCallingAssembly()](http://msdn.microsoft.com/en-us/library/system.reflection.assembly.getcallingassembly.aspx)获取调用您的函数的代码的程序集（在堆）。

拥有正确的程序集后，请使用 FullName 属性，如其他答案中所示。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-08-16T16:20:27.170

此外，如果您正在寻找 GAC 中已经存在的程序集的完全限定名称，您可以启动 Visual Studio 命令提示符（设置正确路径的最简单方法）并使用`gacutil /l`它们各自的 FQN 列出所有程序集。用于`gacutil /l <yourassemblyname>`过滤列表以更轻松地找到您要查找的内容。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-08-27T09:52:46.613

您也可以使用开源 ILSpy，加载程序集后，它的全名将显示在代码窗口顶部的注释中

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-03-18T14:25:15.057

[如果您在Reflector](http://www.red-gate.com/products/reflector/)中加载程序集（DLL、EXE 等），它会在底部告诉您完整的强名称。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2013-03-14T15:27:04.353

JetBrains [dotPeek](http://www.jetbrains.com/decompiler/)或 Telerik [JustDecompile](http://www.telerik.com/products/decompiler.aspx)相当不错。只需打开 DLL，即可立即获得名称。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-18T14:26:11.403

几种方式。

在代码中：

[Assembly.FullName](http://msdn.microsoft.com/en-us/library/system.reflection.assembly.fullname.aspx) 例如

```
typeof(Thingy).Assembly.FullName 
```

或者，如果它是已安装的程序集，则从 GAC 使用[msdn 上这篇文章中](http://msdn.microsoft.com/en-us/library/2exyydhb.aspx)的步骤。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-01-24T16:31:04.233

作为老派并且比 powershell 更喜欢 cmd，我为自己编写了这个批处理脚本来做到这一点：

```
@REM fqn.bat <dll_path>
powershell -command "([system.reflection.assembly]::loadfile('%~f1')).FullName" 
```

将`%~f1`第一个参数扩展为绝对路径，因此运行：

```
fqn mydll.dll 
```

将打印您想要的完全限定名称。

# c# - 手动更改数据库时如何同步应用程序缓存

> ID：658451
> 
> 赞同：1
> 
> 时间：2009-03-18T14:22:18.293
> 
> 标签：c#

我正在使用多个使用数据缓存的应用程序 WinForm / ASP.NET。当发生手动数据库更改时，如何使我的应用程序自动保持同步？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T14:24:46.460

Quick and Dirty：回收应用程序池。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T17:49:27.937

对于asp.net，您可以配置sql依赖项，当数据库中的数据发生更改时，它将刷新缓存中的数据。这假设 ms sql 服务器，并且根据 ms sql asp.net 的版本，它适用于轮询与接收通知。

# vb.net - 将 OSGB 36 坐标转换为纬度/经度

> ID：658454
> 
> 赞同：2
> 
> 时间：2009-03-18T14:22:29.320
> 
> 标签：vb.net, coordinates

我想将英国[OSGB 36](http://en.wikipedia.org/wiki/British_national_grid_reference_system)坐标转换为[WGS 84](http://en.wikipedia.org/wiki/World_Geodetic_System)（即“标准”纬度和经度），以便将它们绘制成 Google 地球的 KML 文件。

解决此问题的最佳方法是什么？我在 VB .NET 中实现。

我可能应该补充一点，我的问题不是“如何编写 KML 文件？”。我的问题是“如何在这两个坐标系之间进行转换？”！！

我希望有一个我可以使用的库，而不是滚动我自己的函数——这似乎是其他人会实现的那种东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-03-10T16:18:39.547

我工作的公司刚刚开源了一个库来做到这一点：[http ://code.google.com/p/geocoordconversion/](http://code.google.com/p/geocoordconversion/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T14:28:37.293

您需要实现[Helmert 转换](http://en.wikipedia.org/wiki/Helmert_transformation)。我用 Javascript 写了一个转换，你可以适应它。脚本用于 WGS84-OSGB36 转换的算法源自获得许可的 OSGB 电子表格。对于英国 90% 的地区，转换精度在 7m 左右，应该与典型 GPS 接收器进行的转换相似。

有关更多详细信息，请参阅[文档](http://en.wikipedia.org/wiki/Helmert_transformation)和[源代码](http://www.nearby.org.uk/tests/geotools2.js)。

*编辑：您可能想查看这个包含源代码的[OCX 。](http://www.anotherurl.com/mapping/OSGB_Convert.htm)*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T14:29:47.917

首先，根据从[OSGB 36链接的](http://en.wikipedia.org/wiki/British%5Fnational%5Fgrid%5Freference%5Fsystem)[这个](http://www.ordnancesurvey.co.uk/oswebsite/gps/information/coordinatesystemsinfo/guidecontents/guide1.html)页面：

> 误区 4：“坐标系之间有精确的数学公式可以改变”</p>

其次，来自同一链接：“[从一个坐标系到另一个坐标系：大地转换](http://www.ordnancesurvey.co.uk/oswebsite/gps/information/coordinatesystemsinfo/guidecontents/guide6.html)”包括“近似 WGS84 到 OSGB36/ODN 转换”部分

编辑：注意，当操作系统说“近似”时，它们的意思是错误> 5m。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-21T01:35:41.923

```
//=======================================================================
/* Project: Geocode.Service
*  Author: Steve Loughran
*  Copyright (C) 2000 Steve Loughran
*  See license.txt or license.html for license and copyright information 
*  RCS $Header: /cvsroot/geocode/geocode.net/src/library/Osgb.cs,v 1.4 2002/04/23 05:12:37 steve_l Exp $
*  jedit:mode=csharp:tabSize=4:indentSize=4:syntax=true:
*/
//=======================================================================

using System;

namespace net.sourceforge.geocode {

/// <summary>
/// OSGB conversion routines. xlated from C++ to Java to C#
/// </summary>

public class OsgbGridReference: GeoMath
{

private string _gridSquare="";
private long _easting=0;
private long _northing=0;

/// <summary>
/// empty constructor
/// </summary>
public OsgbGridReference() {}

/// <summary>
/// constructor from gridref
/// </summary>
public OsgbGridReference(String gridSquare, 
  long easting,
  long northing) {
 SetGridRef(gridSquare,northing,easting);
}

/// <summary>
/// constructor from co-ordinates
/// </summary>
public OsgbGridReference(double latitude, double longitude) {
 SetPosition(latitude,longitude);
}

/// <summary>
/// constructor from position
/// </summary>
public OsgbGridReference(Position position)
 : this(position.Latitude,position.Longitude) {
}

/// <summary>grid square property</summary>    
public string GridSquare {
 get {return _gridSquare;}
 set {_gridSquare=value;}
}
/// <summary>northing property</summary>    

public long Northing {
 get {return _northing;}
 set {_northing=value;} 
}

/// <summary>easting property</summary>    
public long Easting {
 get {return _easting;}
 set {_easting=value;} 
}

/// <summary>
/// set the grid refernce
/// </summary>
/// <returns> </returns>

public void SetGridRef(String gridSquare, 
  long northing, 
  long easting) {
 _gridSquare=gridSquare;
 _northing=northing;
 _easting=easting;
}

/// <summary>
///  rudimentary validity test. A better one is to
/// extract the position
/// </summary>
/// <returns>true iff there is a gridsquare </returns>

public bool IsValid() 
 {return _gridSquare.Length==2;}

/// <summary>
/// get a position object from a location
/// </summary>
/// <returns> Position </returns>

public Position ToPosition() {
 double lat,lon;
 ConvertOSGBtoLL(_gridSquare,_northing,_easting,
   out lat, out lon);
 Position p=new Position(lat,lon);
 p.Name=ToString();
 return p;
}   

/// <summary>
/// set a gridref from a lat/long tuple
/// </summary>
/// <returns> success flag </returns>

public bool SetPosition(double latitude, double longitude) {
 _gridSquare=ConvertLLtoOSGB(latitude,
   longitude,
   out _northing,
   out _easting);
 return IsValid();
}

/// <summary>
/// set a gridref from a position
/// </summary>
/// <returns> success flag </returns>

public bool SetPosition(Position position) {
 return SetPosition(position.Latitude,position.Longitude);
}

/// <summary>
///  stringify
/// </summary>

public override string ToString() {
 return String.Format("{0} {1:000} {2:000}",
  _gridSquare,Easting,Northing);
}

/// <summary>
///  equality test: works on lat and long
/// </summary>

public override bool Equals(object o) {
 OsgbGridReference pos=(OsgbGridReference)o;
 return _gridSquare==pos._gridSquare &&
  _northing==pos._northing &&
  _easting==pos._easting;
}

/// <summary>
/// hash code builder
/// </summary>

public override int GetHashCode() {
        return (int)(_easting+_northing); 
}

/// <summary>
/// determines base co-ordinates of a square like "ST"
/// </summary>
///    <parameter name="OSGBGridSquare"> square </parameter>
///    <parameter name="easting"> easting</parameter>  
///    <parameter name="northing"> northing</parameter> 
/// <returns>true if the coordinates were in range</returns>

static bool ConvertOSGBSquareToRefCoords(string OSGBGridSquare,
         out long  easting,
                           out long  northing) {
 int pos, x_multiplier=0, y_multiplier=0;
 string GridSquare = "VWXYZQRSTULMNOPFGHJKABCDE";
 bool trouble=false;
 long east,north;
 easting=northing=0;
 //find 500km offset
    OSGBGridSquare=OSGBGridSquare.ToUpper();
 char ch = OSGBGridSquare[0];
 switch(ch) {
  case 'S': x_multiplier = 0; y_multiplier = 0; break;
  case 'T': x_multiplier = 1; y_multiplier = 0; break;
  case 'N': x_multiplier = 0; y_multiplier = 1; break;
  case 'O': x_multiplier = 1; y_multiplier = 1; break;
  case 'H': x_multiplier = 0; y_multiplier = 2; break;
  case 'J': x_multiplier = 1; y_multiplier = 2; break;
        default: trouble=true; break;
 }
    if(!trouble) {
  east=x_multiplier * 500000L;
  north=y_multiplier * 500000L;
  //find 100km offset and add to 500km offset to get coordinate of
  //square point is in
  char subsquare=OSGBGridSquare[1];
  pos = GridSquare.IndexOf(subsquare);
     if(pos>-1) {
   east += ((pos % 5) * 100000L);
   north += ((pos / 5) * 100000L);
     easting=east;
   northing=north;
     }
     else {
         trouble=true;
     }
    }
    return !trouble;
}

///<summary>
///convert a internal OSGB coord to lat/long
///Equations from USGS Bulletin 1532
///East Longitudes are positive, West longitudes are negative.
///North latitudes are positive, South latitudes are negative
///Lat and Long are in decimal degrees.
///Written by Chuck Gantz- chuck.gantz@globalstar.com
///</summary>
///    <parameter name="OSGBEasting">easting </parameter> 
///   <parameter name="OSGBEasting">northing </parameter> 
///   <parameter name="OSGBZone"> gridsquare</parameter>  
///   <parameter name="latitude"> latitude</parameter> 
///   <parameter name="longitude"> longitude</parameter> 

static void ConvertOSGBtoLL(string OSGBZone,
   double OSGBNorthing,
   double OSGBEasting,
   out double latitude,
   out double longitude) {
 double k0 = 0.9996012717;
 double a;
 double eccPrimeSquared;
 double N1, T1, C1, R1, D, M;
 double LongOrigin = -2;
 double LatOrigin = 49;
 double LatOriginRad = LatOrigin * deg2rad;
 double mu, phi1, phi1Rad;
 double x, y;
    long northing;
    long easting;

 //Airy model of the ellipsoid.
 double majoraxis = a = 6377563.396;
 double minoraxis = 6356256.91;
 double eccSquared = (majoraxis * majoraxis - minoraxis * minoraxis) /
       (majoraxis * majoraxis);
 double e1 = (1-sqrt(1-eccSquared))/(1+sqrt(1-eccSquared));
 //only calculate M0 once since it is based on the origin of the OSGB projection, which is fixed
 double  M0 = a*((1 - eccSquared/4 - 3*eccSquared*eccSquared/64 - 5*eccSquared*eccSquared*eccSquared/256)*LatOriginRad
    - (3*eccSquared/8 + 3*eccSquared*eccSquared/32 + 45*eccSquared*eccSquared*eccSquared/1024)*sin(2*LatOriginRad)
    + (15*eccSquared*eccSquared/256 + 45*eccSquared*eccSquared*eccSquared/1024)*sin(4*LatOriginRad)
    - (35*eccSquared*eccSquared*eccSquared/3072)*sin(6*LatOriginRad));
 ConvertOSGBSquareToRefCoords(OSGBZone, out easting, out northing);
 //remove 400,000 meter false easting for longitude
 x = OSGBEasting - 400000.0 + easting;
 //remove 100,000 meter false easting for longitude
 y = OSGBNorthing + 100000.0 + northing;
 eccPrimeSquared = (eccSquared)/(1-eccSquared);
 M = M0 + y / k0;
 mu = M/(a*(1-eccSquared/4-3*eccSquared*eccSquared/
      64-5*eccSquared*eccSquared*eccSquared/256));
 phi1Rad = mu + (3*e1/2-27*e1*e1*e1/32)*sin(2*mu)
    + (21*e1*e1/16-55*e1*e1*e1*e1/32)*sin(4*mu)
    +(151*e1*e1*e1/96)*sin(6*mu);
 phi1 = phi1Rad*rad2deg;
 N1 = a/sqrt(1-eccSquared*sin(phi1Rad)*sin(phi1Rad));
 T1 = tan(phi1Rad)*tan(phi1Rad);
 C1 = eccPrimeSquared*cos(phi1Rad)*cos(phi1Rad);
 R1 = a*(1-eccSquared)/pow(1-eccSquared*sin(phi1Rad)*sin(phi1Rad), 1.5);
 D = x/(N1*k0);
 latitude = phi1Rad - (N1*tan(phi1Rad)/R1)*(D*D/2-(5+3*T1+10*C1-4*C1*C1-9*eccPrimeSquared)*D*D*D*D/24
     +(61+90*T1+298*C1+45*T1*T1-252*eccPrimeSquared-3*C1*C1)*D*D*D*D*D*D/720);
 latitude *= rad2deg;
 longitude = (D-(1+2*T1+C1)*D*D*D/6+(5-2*C1+28*T1-3*C1*C1+8*eccPrimeSquared+24*T1*T1)
     *D*D*D*D*D/120)/cos(phi1Rad);
 longitude = LongOrigin + longitude * rad2deg;
}

/// <summary>
/// converts lat/long to OSGB coords.  Equations from USGS Bulletin 1532
/// East Longitudes are positive, West longitudes are negative.
/// North latitudes are positive, South latitudes are negative
/// Lat and Long are in decimal degrees
/// </summary>
///  Written by Chuck Gantz- chuck.gantz@globalstar.com
///   <parameter name="latitude"> IN latitude</parameter> 
///   <parameter name="longitude">IN longitude </parameter> 
///   <parameter name="OSGBEasting"> OUT easting</parameter> 
///  <parameter name="OSGBNorthing"> OUT northing</parameter> 

static public string ConvertLLtoOSGB(double latitude,
    double longitude,                
                out long OSGBNorthing,
    out long OSGBEasting) {
 double a;
 double eccSquared;
 double k0 = 0.9996012717;
 double LongOrigin = -2;
 double LongOriginRad = LongOrigin * deg2rad;
 double LatOrigin = 49;
 double LatOriginRad = LatOrigin * deg2rad;
 double eccPrimeSquared;
 double N, T, C, A, M;
 double LatRad = latitude*deg2rad;
 double LongRad = longitude*deg2rad;
 double easting, northing;
 double majoraxis = a = 6377563.396;//Airy
 double minoraxis = 6356256.91;//Airy
 eccSquared = (majoraxis * majoraxis - minoraxis * minoraxis) /
       (majoraxis * majoraxis);
 //only calculate M0 once since it is based on the origin
 //of the OSGB projection, which is fixed
 double  M0 = a*((1  - eccSquared/4 - 3*eccSquared*eccSquared/64 - 5*eccSquared*eccSquared*eccSquared/256)*LatOriginRad
    - (3*eccSquared/8 + 3*eccSquared*eccSquared/32 + 45*eccSquared*eccSquared*eccSquared/1024)*sin(2*LatOriginRad)
    + (15*eccSquared*eccSquared/256 + 45*eccSquared*eccSquared*eccSquared/1024)*sin(4*LatOriginRad)
    - (35*eccSquared*eccSquared*eccSquared/3072)*sin(6*LatOriginRad));
 eccPrimeSquared = (eccSquared)/(1-eccSquared);
 N = a/sqrt(1-eccSquared*sin(LatRad)*sin(LatRad));
 T = tan(LatRad)*tan(LatRad);
 C = eccPrimeSquared*cos(LatRad)*cos(LatRad);
 A = cos(LatRad)*(LongRad-LongOriginRad);
 M = a*((1 - eccSquared/4 - 3*eccSquared*eccSquared/64- 5*eccSquared*eccSquared*eccSquared/256)*LatRad
    - (3*eccSquared/8 + 3*eccSquared*eccSquared/32 + 45*eccSquared*eccSquared*eccSquared/1024)*sin(2*LatRad)
    + (15*eccSquared*eccSquared/256 + 45*eccSquared*eccSquared*eccSquared/1024)*sin(4*LatRad)
    - (35*eccSquared*eccSquared*eccSquared/3072)*sin(6*LatRad));
 easting = (double)(k0*N*(A+(1-T+C)*A*A*A/6
    + (5-18*T+T*T+72*C-58*eccPrimeSquared)*A*A*A*A*A/120));
 easting += 400000.0; //false easting
 northing = (double)(k0*(M-M0+N*tan(LatRad)*(A*A/2+(5-T+9*C+4*C*C)*A*A*A*A/24
     + (61-58*T+T*T+600*C-330*eccPrimeSquared)*A*A*A*A*A*A/720)));
 northing -= 100000.0;//false northing
 return ConvertCoordsToOSGBSquare(easting, northing,out OSGBEasting, out OSGBNorthing);
}

/// <summary>
/// convert a internal OSGB coord to a gridsquare and internal values.
/// </summary>
///    <parameter name="easting"> easting</parameter> 
///    <parameter name="northing"> northing</parameter>
///    <parameter name="OSGBEasting">OSGBEasting out </parameter>
///    <parameter name="OSGBNorthing">OSGBNorthing out </parameter>

static string ConvertCoordsToOSGBSquare(double easting,
     double northing,
                    out long  OSGBEasting,
                    out long  OSGBNorthing)
{
 string GridSquare = "VWXYZQRSTULMNOPFGHJKABCDE";
 long posx, posy; //positions in grid
 OSGBEasting = (long)(easting + 0.5); //round to nearest int
 OSGBNorthing = (long)(northing + 0.5); //round to nearest int
 string OSGBGridSquare="";

 //find correct 500km square
 posx = OSGBEasting / 500000L;
 posy = OSGBNorthing / 500000L;
 if(posx<0 || posx>4 || posy<0 || posy>4)
  return "";
 long offset=posx + posy * 5 + 7;
    OSGBGridSquare+= GridSquare[(int)offset];

 //find correct 100km square
 posx = OSGBEasting % 500000L;//remove 500 km square
 posy = OSGBNorthing % 500000L;//remove 500 km square
 posx = posx / 100000L;//find 100 km square
 posy = posy / 100000L;//find 100 km square
 if(posx<0 || posx>4 || posy<0 || posy>4)
  return "";
 offset=posx + posy * 5; 
 OSGBGridSquare+= GridSquare[(int)offset];

 //remainder is northing and easting
 OSGBNorthing = OSGBNorthing % 500000L;
 OSGBNorthing = OSGBNorthing % 100000L;
 OSGBEasting = OSGBEasting % 500000L;
 OSGBEasting = OSGBEasting % 100000L;
    return OSGBGridSquare;
}

/// <summary>
/// turn the latitude and longitude into a string
/// </summary>
///    <parameter name="latitude"> lat</parameter>
///    <parameter name="longitude"> long</parameter> 
///    <parameter name="infill"> text between coordinates</parameter>  
///    <returns>return something like E004 N123</returns>

static string GetSensibleLatLongstring(double latitude,
  double longitude,
        int decimals,
        string infill) {
    bool bNorth=latitude>=0;
 bool bWest=longitude<=0;
    latitude=Math.Abs(latitude);
    longitude=Math.Abs(longitude);
    double multiplier=(int)pow(10,decimals);
 int hiLat=(int)latitude;
    int lowLat=(int)((latitude-hiLat)*multiplier);
    double newLat=lowLat/multiplier+hiLat;
 int hiLong=(int)longitude;
    int lowLong=(int)((longitude-hiLong)*multiplier);
    double newLong=lowLong/multiplier+hiLong;
 return (bNorth?"N":"S")+newLat+infill+
  (bWest?"W":"E")+newLong;
}

/* legacy java test harness
  public static void main(string[] args)
 {
    string message;
    if(args.length!=3)
     {
        message="need a grid reference like ST 767 870";
        }
    else
     {
        LongRef north=new LongRef();
        LongRef east=new LongRef();
        bool b=ConvertOSGBSquareToRefCoords(args[0],east,north);
        double easting=Double.valueOf(args[1]).doubleValue();
        double northing=Double.valueOf(args[2]).doubleValue();
        DoubleRef rlatitude=new DoubleRef ();
        DoubleRef rlongitude=new DoubleRef ();
        OSGBtoLL(easting,northing,args[0],rlatitude,rlongitude);
        double latitude=rlatitude.getValue();
        double longitude=rlongitude.getValue();

        bool bNorth=latitude>=0;
        bool bWest=longitude<=0;

  message="Latitude & Longitude ="+latitude+" , " + longitude;
        message+="\r\n or "+GetSensibleLatLongstring(latitude,
             longitude,
                            3,
                            " ");
  string square=new string();
  square=LLtoOSGB(latitude,longitude,north,east);
  message+="\r\n Grid ="+square+" "+east+" "+north;
//       message="evaluation failure on "+args[0];
        }
        System.out.print(message);
    }
*/

}; //class
};//namespace 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-20T22:10:03.477

我们使用[proj.4](http://trac.osgeo.org/proj/)库进行 WGS84 <-> OSGB36 <-> OSGBGRID 坐标变换，它工作得很好。但是我们使用 C++，所以我不知道你是否可以让它在 VB.NET 下工作。可能有包装纸之类的？（在上面的链接中提到了 PROJ.4 VB Wrappers）。

# asp.net-mvc - MVC Html.CheckBox 和表单提交问题

> ID：658458
> 
> 赞同：14
> 
> 时间：2009-03-18T14:22:46.263
> 
> 标签：asp.net-mvc, checkbox

在 ASP.NET MVC RC 中的 Html.Checkbox 中提交值的疯狂问题

一些值只是没有来到 Request.Params

在我的表格中，我在循环中有这条线：

`<%=Html.CheckBox("cb" + p.Option.Id, p.Option.IsAllowed, new { value = 6 })%>`

它呈现到下一个：

```
 <input checked="checked" id="cb17" name="cb17" type="checkbox" value="6" />
<input name="cb17" type="hidden" value="false" /> 

    <input checked="checked" id="cb18" name="cb18" type="checkbox" value="6" />
<input name="cb18" type="hidden" value="false" /> 

    <input id="cb19" name="cb19" type="checkbox" value="6" />
<input name="cb19" type="hidden" value="false" />

    <input id="cb20" name="cb20" type="checkbox" value="6" />
<input name="cb20" type="hidden" value="false" />

    <input checked="checked" id="cb21" name="cb21" type="checkbox" value="6" />
<input name="cb21" type="hidden" value="false" /> 
```

提交表单后，我得到如下信息：

```
Form.Params["cb17"] = {6, "false"}
Form.Params["cb18"] = {6, "false"}
Form.Params["cb19"] = {"false"}
Form.Params["cb20"] = {"6,false"}
Form.Params["cb21"] = {"false"} 
```

在请求字符串中有些参数显示两次（正常情况），有些只显示一次（只有隐藏字段的值）。似乎它不依赖于复选框是否被选中，值是否发生了变化......

有人遇到过这种情况吗？我该如何解决？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-18T14:33:18.203

```
 <% using(Html.BeginForm("Retrieve", "Home")) %>//Retrieve is the name of the action while Home is the name of the controller
       <% { %>
    <%foreach (var app in newApps)              { %>  
  <tr> 
       <td><%=Html.CheckBox(""+app.ApplicationId )%></td>      

   </tr>  
<%} %>
 <input type"submit"/>
<% } %> 
```

在你的控制器中

```
 List<app>=newApps; //Database bind
 for(int i=0; i<app.Count;i++)
 {

    var checkbox=Request.Form[""+app[i].ApplicationId];
    if(checkbox!="false")// if not false then true,false is returned
 } 
```

您检查 false 的原因是因为 Html Checkbox 助手为 value true 做了一些奇怪的事情

**真返回为：**

```
it makes the string read "true, false" 
```

所以你可能认为这是两个值，但它只是一个值，并且意味着真实

**False 返回为：**

```
it makes the string read "false" 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-18T14:26:44.303

这实际上是它应该按照规范工作的方式。

它与 ASP.NET MVC 无关，但是当未选中复选框时，它**不**包含在 POST 集合中。

你得到两个值，因为你有一个复选框和一个同名的输入（你有两个值的很可能是复选框选中的那个）。

编辑：来自 W3C 的[规范](http://www.w3.org/TR/html401/interact/forms.html#checkbox)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T15:11:08.643

在表单提交之后/保存之前（无状态模式）无需向数据库询问 id，我已经生成了这样的代码：

```
 foreach (string key in Request.Form)
    {
        var checkbox = String.Empty;
        if (key.StartsWith("cb"))
        {
          checkbox = Request.Form["" + key];

          if (checkbox != "false")
          {
              int id = Convert.ToInt32(key.Remove(0, 2));
          }
        }
    } 
```

谢谢你们帮助我解决这个问题！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-09-26T17:31:35.803

我用这个：

```
public struct EditedCheckboxValue
{
    public bool Current { get; private set; }

    public bool Previous { get; private set; }

    public bool Changed { get; private set; }

    public EditedCheckboxValue(System.Web.Mvc.FormCollection collection, string checkboxID) : this()
    {
        string[] values = collection[checkboxID].Split(new char[] { ',' });
        if (values.Length == 2)
        {   // checkbox value changed, Format: current,old
            Current = bool.Parse(values[0]);
            Previous = bool.Parse(values[1]);
            Changed = (Current != Previous);
        }
        else if (values.Length == 1)
        {
            Current = bool.Parse(values[0]);
            Previous = Current;
            Changed = false;
        }
        else
            throw new FormatException("invalid format for edited checkbox value in FormCollection");
    }
} 
```

然后这样称呼它：

```
EditedCheckboxValue issomething = new EditedCheckboxValue(collection, "FieldName");
instance.IsSomething = issomething.Current; 
```

# java - 在 ant 任务中使用 eclipse 类路径

> ID：658467
> 
> 赞同：7
> 
> 时间：2009-03-18T14:25:15.570
> 
> 标签：java, eclipse, ant

我想使用 Ant 传递 JAR 文件，如何在我的 Ant 任务中使用 Eclipse 类路径？

问候，托拜厄斯

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-18T14:42:50.410

试试[ant4eclipse](http://ant4eclipse.sourceforge.net/)。

# php - 从 JSON 反序列化到 PHP，使用强制转换？

> ID：658469
> 
> 赞同：28
> 
> 时间：2009-03-18T14:25:28.970
> 
> 标签：php, json, serialization

假设我有一个具有“名称”和“密码”属性的用户类，以及一个“保存”方法。当通过 json_encode 将此类的对象序列化为 JSON 时，该方法被正确跳过，我最终得到类似 {'name': 'testName', 'password': 'testPassword'} 的内容。

然而，当通过 json_decode 反序列化时，我最终得到一个 StdClass 对象而不是 User 对象，这是有道理的，但这意味着该对象缺少“保存”方法。有什么方法可以将生成的对象转换为用户，或者为 json_decode 提供一些关于我期望什么类型的对象的提示？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2015-09-17T14:29:55.060

老问题，但也许有人会觉得这很有用。
我创建了一个带有静态函数的抽象类，您可以在对象上继承它，以便将任何 JSON 反序列化为继承类实例。

```
abstract class JsonDeserializer
{
    /**
     * @param string|array $json
     * @return $this
     */
    public static function Deserialize($json)
    {
        $className = get_called_class();
        $classInstance = new $className();
        if (is_string($json))
            $json = json_decode($json);

        foreach ($json as $key => $value) {
            if (!property_exists($classInstance, $key)) continue;

            $classInstance->{$key} = $value;
        }

        return $classInstance;
    }
    /**
     * @param string $json
     * @return $this[]
     */
    public static function DeserializeArray($json)
    {
        $json = json_decode($json);
        $items = [];
        foreach ($json as $item)
            $items[] = self::Deserialize($item);
        return $items;
    }
} 
```

您可以通过在具有 JSON 将具有的值的类上继承它来使用它：

```
class MyObject extends JsonDeserializer
{
    /** @var string */
    public $property1;

    /** @var string */
    public $property2;

    /** @var string */
    public $property3;

    /** @var array */
    public $array1;
} 
```

示例用法：

```
$objectInstance = new MyObject();
$objectInstance->property1 = 'Value 1';
$objectInstance->property2 = 'Value 2';
$objectInstance->property3 = 'Value 3';
$objectInstance->array1 = ['Key 1' => 'Value 1', 'Key 2' => 'Value 2'];

$jsonSerialized = json_encode($objectInstance);

$deserializedInstance = MyObject::Deserialize($jsonSerialized); 
```

`::DeserializeArray`如果您的 JSON 包含目标对象的数组，则可以使用该方法。

[这](http://ideone.com/1xMSev)是一个可运行的示例。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-18T14:31:46.367

我认为处理这个问题的最好方法是通过构造函数，直接或通过工厂：

```
class User
{
   public $username;
   public $nestedObj; //another class that has a constructor for handling json
   ...

   // This could be make private if the factories below are used exclusively
   // and then make more sane constructors like:
   //     __construct($username, $password)
   public function __construct($mixed)
   {
       if (is_object($mixed)) {
           if (isset($mixed->username))
               $this->username = $mixed->username;
           if (isset($mixed->nestedObj) && is_object($mixed->nestedObj))
               $this->nestedObj = new NestedObject($mixed->nestedObj);
           ...
       } else if (is_array($mixed)) {
           if (isset($mixed['username']))
               $this->username = $mixed['username'];
           if (isset($mixed['nestedObj']) && is_array($mixed['nestedObj']))
               $this->nestedObj = new NestedObj($mixed['nestedObj']);
           ...
       }
   }
   ...

   public static fromJSON_by_obj($json)
   {
       return new self(json_decode($json));
   }

   public static fromJSON_by_ary($json)
   {
       return new self(json_decode($json, TRUE)); 
   }
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-18T15:06:13.240

简短的回答：不（不是我所知道的*）

长答案： json_encode 只会序列化公共变量。正如您在[JSON 规范](http://json.org/)中看到的那样，没有“函数”数据类型。这些都是您的方法未序列化为 JSON 对象的两个原因。

Ryan Graham 是对的 - 将这些对象重新创建为非 stdClass 实例的唯一方法是在反序列化后重新创建它们。

例子

```
<?php

class Person
{
    public $firstName;
    public $lastName;

    public function __construct( $firstName, $lastName )
    {
        $this->firstName = $firstName;
        $this->lastName = $lastName;
    }

    public static function createFromJson( $jsonString )
    {
        $object = json_decode( $jsonString );
        return new self( $object->firstName, $object->lastName );
    }

    public function getName()
    {
        return $this->firstName . ' ' . $this->lastName;
    }
}

$p = new Person( 'Peter', 'Bailey' );
$jsonPerson = json_encode( $p );

$reconstructedPerson = Person::createFromJson( $jsonPerson );

echo $reconstructedPerson->getName(); 
```

或者，除非您真的需要 JSON 格式的数据，否则您可以使用[普通序列化](http://us.php.net/manual/en/language.oop.serialization.php)并利用[__sleep() 和 __wakeup() 挂钩](http://us.php.net/manual/en/language.oop.magic-functions.php)来实现额外的自定义。

`*`在[我自己的上一个问题中](https://stackoverflow.com/questions/401908/php-tostring-and-jsonencode-not-playing-well-together)，有人建议您可以实现一些 SPL 接口来自定义 json_encode() 的输入/输出，但我的测试表明这些都是徒劳的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-18T16:47:48.800

您可以创建某种 FactoryClass：

```
function create(array $data)  
{
    $user = new User();
    foreach($data as $k => $v) {
        $user->$k = $v;
    }
    return $user;
} 
```

它不像您想要的解决方案，但它可以完成您的工作。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-07-16T13:30:14.130

看看我写的这个类：

[https://github.com/mindplay-dk/jsonfreeze/blob/master/mindplay/jsonfreeze/JsonSerializer.php](https://github.com/mindplay-dk/jsonfreeze/blob/master/mindplay/jsonfreeze/JsonSerializer.php)

它保留了一个名为“#type”的 JSON 对象属性来存储类名，它有一些限制，如下所述：

[将 PHP 对象图序列化/反序列化为 JSON](https://stackoverflow.com/questions/10489876)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-18T15:29:54.230

我知道 JSON 不支持函数的序列化，这是完全可以接受的，甚至是期望的。我的类目前用作与 JavaScript 通信的值对象，并且函数没有意义（并且常规的序列化函数不可用）。

然而，随着与这些类相关的功能的增加，将它们的实用函数（例如本例中的用户的 save() ）封装在实际类中对我来说是有意义的。这确实意味着它们不再是严格意义上的价值对象，这就是我遇到上述问题的地方。

我的一个想法是在 JSON 字符串中指定类名，最终可能会是这样：

```
$string = '{"name": "testUser", "password": "testPassword", "class": "User"}';
$object = json_decode ($string);
$user = ($user->class) $object; 
```

反过来是在 json_encode 期间/之后设置类属性。我知道，有点令人费解，但我只是想将相关代码放在一起。我可能最终会再次将我的实用程序函数从类中移除；修改后的构造方法似乎有点不透明，并且在嵌套对象时遇到了麻烦。

不过，我非常感谢这一点以及任何未来的反馈。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-10-04T13:55:49.013

也许`hydration`模式会有所帮助。

基本上，您实例化一个新的空对象 ( )，然后使用来自该对象`new User()`的值填充属性。`StdClass`例如，您可以`hydrate`在`User`.

如果可能的话，您可以将`User` `constructor`接受类型的可选参数设置`StdClass`为实例化时的值。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-08-16T08:20:23.040

有点晚了，但另一种选择是使用 symfony 序列化程序来反序列化 xml、json 以及任何对象。

这是文档： [http ://symfony.com/doc/current/components/serializer.html#deserializing-in-an-existing-object](http://symfony.com/doc/current/components/serializer.html#deserializing-in-an-existing-object)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-18T17:09:32.773

要回答您的直接问题，不，没有用 json_encode/json_decode 来做到这一点。JSON 被设计并指定为一种用于编码信息的格式，而不是用于序列化对象的格式。PHP 功能不会超出此范围。

如果您对从 JSON 重新创建对象感兴趣，一种可能的解决方案是对层次结构中的所有对象使用静态方法，该方法接受 stdClass/string 并填充看起来像这样的变量

```
//semi pseudo code, not tested
static public function createFromJson($json){
    //if you pass in a string, decode it to an object
    $json = is_string($json) ? json_decode($json) : $json;

    foreach($json as $key=>$value){
        $object = new self();
        if(is_object($value)){
            $object->{$key} = parent::createFromJson($json);
        }
        else{
            $object->{$key} = $value;
        }
    }

    return $object;
} 
```

我没有对此进行测试，但我希望它能传达这个想法。理想情况下，您的所有对象都应该从某个基础对象（通常称为“类对象”）扩展而来，因此您只能在一个地方添加此代码。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-11-15T02:17:03.503

下面是使用静态（即您知道代码中的类类型）和动态（即您只知道运行时的类类型）将 JSON 反序列化回 PHP 对象的示例：

## 代码

```
<?php

class Car
{
    private $brand;
    private $model;
    private $year;

    public function __construct($brand, $model, $year)
    {
        $this->brand = $brand;
        $this->model = $model;
        $this->year = $year;
    }

    public function toJson()
    {
        $arr = array(
            'brand' => $this->brand,
            'model' => $this->model,
            'year' => $this->year,
        );

        return json_encode($arr);
    }

    public static function fromJson($json)
    {
        $arr = json_decode($json, true);

        return new self(
            $arr['brand'],
            $arr['model'],
            $arr['year']
        );
    }
}

// original object
echo 'car1: ';
$car1 = new Car('Hyundai', 'Tucson', 2010);
var_dump($car1);

// serialize
echo 'car1class: ';
$car1class = get_class($car1); // need the class name for the dynamic case below. this would need to be bundled with the JSON to know what kind of class to recreate.
var_dump($car1class);

echo 'car1json: ';
$car1Json = $car1->toJson();
var_dump($car1Json);

// static recreation with direct invocation. can only do this if you know the class name in code.
echo 'car2: ';
$car2 = Car::fromJson($car1Json);
var_dump($car2);

// dynamic recreation with reflection. can do this when you only know the class name at runtime as a string.
echo 'car3: ';
$car3 = (new ReflectionMethod($car1class, 'fromJson'))->invoke(null, $car1Json);
var_dump($car3); 
```

## 输出

```
car1: object(Car)#1 (3) {
  ["brand":"Car":private]=>
  string(7) "Hyundai"
  ["model":"Car":private]=>
  string(6) "Tucson"
  ["year":"Car":private]=>
  int(2010)
}
car1class: string(3) "Car"
car1json: string(48) "{"brand":"Hyundai","model":"Tucson","year":2010}"
car2: object(Car)#2 (3) {
  ["brand":"Car":private]=>
  string(7) "Hyundai"
  ["model":"Car":private]=>
  string(6) "Tucson"
  ["year":"Car":private]=>
  int(2010)
}
car3: object(Car)#4 (3) {
  ["brand":"Car":private]=>
  string(7) "Hyundai"
  ["model":"Car":private]=>
  string(6) "Tucson"
  ["year":"Car":private]=>
  int(2010)
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-06-01T01:53:02.023

老问题，新答案。

创建自己的接口来匹配[JsonSerializable](https://www.php.net/manual/en/class.jsonserializable.php)怎么样？;)

```
/**
 * Interface JsonUnseriablizable
 */
interface JsonUnseriablizable {
    /**
     * @param array $json
     */
    public function jsonUnserialize(array $json);
} 
```

例子：

```
/**
 * Class Person
 */
class Person implements JsonUnseriablizable {

    public $name;
    public $dateOfBirth;

    /**
     * @param string $json
     */
    public function jsonUnserialize(array $json)
    {
        $this->name = $json['name'] ?? $this->name;
        $this->dateOfBirth = $json['date_of_birth'] ?? $this->dateOfBirth;
    }
}

$json = '{"name":"Bob","date_of_birth":"1970-01-01"}';

$person = new Person();
if($person instanceof JsonUnseriablizable){
    $person->jsonUnserialize(json_decode($json, true, 512, JSON_THROW_ON_ERROR));
}

var_dump($person->name); 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2010-05-11T22:04:23.377

我必须说我有点沮丧，这不仅仅是标准的、现成的功能——如果不是 JSON 本身的话，是某些库的。为什么你*不想*在两边都有本质上相似的对象？（无论如何，只要 JSON 允许你）

我在这里错过了什么吗？有没有这样做的图书馆？（AFAICT，[thrift，protocol buffers，avro] 实际上都没有用于 javascript 的 API。对于我的问题，我对 JS <-> PHP 最感兴趣，也对 JS <-> python 最感兴趣。）

# java - 你如何管理 Hibernate 的无数 JAR 文件

> ID：658477
> 
> 赞同：3
> 
> 时间：2009-03-18T14:26:16.113
> 
> 标签：java, hibernate

对于我以前的雇主，我曾使用过 Hibernate，现在我在一家小型初创公司，我想再次使用它。然而，同时下载 Hibernate 核心和 Hibernate 注释发行版是相当痛苦的，因为它需要将*大量*JAR 文件放在一起。因为 JAR 被分为诸如“必需”和“可选”之类的类别，所以我假设每个开发人员最终都会得到不同的 lib 文件夹内容。

处理这个问题的常用方法是什么？基本上，我希望有一种正式的方式来获取 Hibernate 的所有 JAR，这样（理论上）如果我下个月再次需要另一个项目，我最终会得到完全相同的东西。

**编辑：**我大致知道 Maven 做了什么，但我想知道是否有另一种方法来管理这类事情。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-18T14:40:39.573

正如 Aaron 已经提到的，Maven 是一种选择。

如果您想要一些更灵活的东西，您可以将 Apache Ant 与[Ivy](http://ant.apache.org/ivy/)一起使用。

Ivy 是一个依赖解析工具，其工作方式与 Maven 类似，您只需定义项目所需的库，它就会为您下载所有依赖项。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T15:36:04.013

Maybe this is not much of an answer, but I really don't see any problem with Hibernate dependencies. Along with `hibernate3.jar`, you need to have:

1.  6 required jars, out of which commons-collections, dom4j and slf4j are more often used in other open-source projects
2.  1 of either javassist or CGLIB jars
3.  depending on cache and connection pooling, up to 2 jar files, which are pretty much Hibernate specific

So, at the very worst, you will have a maximum of 10 jars, Hibernate's own jar included. And out of those, only commons-collections, dom4j and slf4j will probably be used by some other library in your project. That is hardly a zillion, it can be managed easily, and surely does not warrant using an "elephant" like Maven.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T14:34:25.937

我使用[Maven 2](http://maven.apache.org/)并让它为我管理我的依赖项。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T15:29:16.120

在考虑使用 Maven 或 Ivy 管理依赖项时要注意的一点是，存储库的质量直接影响您的构建体验。如果 repo 不可用或工件的元数据（pom.xml 或 ivy.xml）不正确，您可能无法构建。构建自己的本地存储库需要一些工作，但可能值得付出努力。例如，Ivy 有一个 ANT 任务，它将从 Maven 存储库导入工件并将它们发布到您自己的 Ivy 存储库。一旦您拥有 Maven 存储库的本地副本，您就可以调整元数据以适应您认为适合使用的任何方案。有时最新和最好的版本不在公共存储库中，这有时可能是一个问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T15:11:36.193

我假设您明确使用 Hibernate API？是否可以选择使用标准 API（比如 JPA）并让 J2EE 容器为您管理实现？

否则，请使用 Maven 或 Ivy，具体取决于您当前选择的构建系统。

# windows - 恢复与 Visual Web Developer 2008 的总文件关联？

> ID：658479
> 
> 赞同：0
> 
> 时间：2009-03-18T14:26:25.583
> 
> 标签：windows, dreamweaver, visual-web-developer, file-association

这可能吗？我安装 Dreamweaver 是为了利用一些第三方插件来制作特殊的 xml 文件，但是在安装它后，它接管了我所有的 ASP.NET 文件类型（即使我在第一次启动时单击了弹出窗口中的“选择无”）。无论如何，有谁知道是否有一种快速的自动化方法可以将它们恢复到 Visual Web Developer？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T14:33:52.227

不确定这是否是 Express 版本，但 VS2008 在工具/选项.../环境/常规属性页面上有一个“恢复文件关联”按钮。

如果 Express 中没有，我会尝试执行“修复”安装。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T14:30:33.840

我认为[这](http://support.microsoft.com/kb/307859)是唯一的方法。可悲的是，您必须为要更改的每种文件类型执行此操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T14:32:45.850

修复安装？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-06T09:44:00.670

在 VS 中转到工具-选项-环境-通用并单击恢复文件关联按钮。:)

# report - 在网站上显示大数据

> ID：658482
> 
> 赞同：1
> 
> 时间：2009-03-18T14:26:47.580
> 
> 标签：report, large-data

我的数据库中有一些大约 7K 行的表，我需要在网站 (asp.net) 上使用自定义格式、数据透视表等详细信息制作报告。

什么是最好的解决方案，因为当我用这么多的数据渲染转发器时，它非常慢。

谢谢你的建议

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T14:31:23.027

**关闭视图状态**

除非你需要

```
Page.EnableViewState = false; 
```

**拆分表**

如果您不想沿着寻呼路线走，您也可以尝试将大的`<table>`分成几个较小`<table>`的 s。（过去浏览器只能在看到 final 后才能渲染表格`</table>`。我不确定这是否仍然正确，但绝对值得一试）

**摆脱废话**

确保您使用的是 css 而不是使用类似的东西

```
<td width="40" valign="top"> 50 </td>
<td class="a"> 50 </td> <!-- better  -->
<td>50</td> <!-- best  -->
<!-- if you need to specify a width, you only need to do it in one row  --> 
```

记住`crap * 7000 = alot of crap`

**不惜一切代价减小页面大小**

有时问题不是页面的呈现，而是导致问题的下载，所以检查一下。

**嵌套表真的会伤害你**

纳夫说

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T14:39:34.320

如果您不想分页，那么您可能需要一些 AJAX 来在滚动时获取行，并可能在行滚动出视图时删除行，如果您需要节省内存。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T14:27:52.443

我建议使用分页。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T14:42:15.157

考虑这样的典型行：

```
<tr><td>ID</td><td>Some data</td><td>More and more data</td></tr> 
```

每行有 66 个字符，因此有 7k 行将汇总近 500k 的数据。这对于网络显示来说已经很多了。

因此，如果您真的想在一页中显示所有内容，请尽量减少：

*   不要浪费空间
*   除非完全无法避免，否则不要使用属性
*   如果您没有针对不同行的不同类，请不要使用 class="" （改为将相同的类应用于所有行）

无论如何，取决于目标计算机+浏览器，如果您的行更大，这可能会变得非常缓慢。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-18T15:38:28.233

你没有提到你正在使用哪种语言，但提到中继器暗示了 ASP.Net？以我的经验，在较大的数据集上将数据绑定到 DataGrid 会更快。

但是，我想知道你为什么要在网页上显示这么多数据。没有一个头脑正常的用户会坐下来滚动浏览这么多数据并发现它很有用。将您的数据限制为对用户有用的相关数据——通常过滤到少于 100 行。

IMO，无论格式如何，包含这么多数据的报告都是无用的，但是如果您绝对必须拥有所有这些数据来打印报告等，请考虑在服务器上生成 PDF 文档。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T14:39:00.077

您可能想为这么多数据尝试自定义报告工具。我的公司制作了一个名为[RSinteract](http://www.rsinteract.com)（无耻插件）的工具。这使用 SQL Server 报告服务。

如果您只想转储数据。我认为浏览器在呈现该浏览器时或在查询运行时处于锁定状态。如果您知道您的目标浏览器是什么...您可以使用“更多...”链接来获取下一组数据并限制 1000 行。但是，这会影响 Ctrl+F 搜索。类似于分页，但我猜是把责任交给了用户。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-18T14:47:28.667

如果您真的在寻找“网络应用程序”的“最佳”解决方案，我会公然建议您使用 Flash/Flex 来有效地呈现那么多行。如果不能使用基本 HTML 之外的任何内容，那么我建议在用户滚动时动态获取新行，如@mbeckish 建议的那样......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-18T15:50:02.607

我为一位客户使用 Dev Express 网格来处理报告，他们喜欢它（尽管我宁愿自己滚动！）

请参阅[http://demos.devexpress.com/ASPxGridViewDemos/](http://demos.devexpress.com/ASPxGridViewDemos/)

# mysql - 启用缓存但在 MySQL 中大小为 0 的缺点？

> ID：658484
> 
> 赞同：0
> 
> 时间：2009-03-18T14:27:29.653
> 
> 标签：mysql

在 MySQL 5 中启用查询缓存，但将缓存大小调整为 0 字节，是否存在性能损失或任何其他缺点？

我认为任何性能影响都会很小，但我想知道是否还有其他我没有考虑过的问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T14:32:03.230

将[query_cache_size](http://dev.mysql.com/doc/refman/5.1/en/server-system-variables.html#sysvar_query_cache_size)设置为 0 将在 MySQL 中完全禁用[查询缓存。](http://dev.mysql.com/doc/refman/5.1/en/query-cache-configuration.html)

[那么什么时候使用查询缓存是个好主意呢？](http://www.mysqlperformanceblog.com/2006/07/27/mysql-query-cache/)

# java - 存储在数组中的哈希映射中所有元素的迭代器

> ID：658488
> 
> 赞同：1
> 
> 时间：2009-03-18T14:27:59.447
> 
> 标签：java, collections

我有一个名为 Graph 的自定义类，我在其中使用邻接列表。更具体地说，我有一个哈希映射数组，其中每个哈希映射都包含该节点的所有邻居作为边。键是结束节点，值是 Edge 对象。

现在我想让这个 Graph 类实现 Iterable。有没有一种方法可以合并所有这些哈希映射并为它们的所有元素返回一个公共迭代器？

使用的方法是有效的，这一点非常重要。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T14:33:25.973

您可以`ChainedIterator`从 apache commons 集合中使用：

```
Iterator current = IteratorUtils.emptyIterator();
for(map: arrayOfHashmaps) {
   current = IteratorUtils.chainedIterator(current, map.keySet().iterator);
} 
```

如果你想避免公共集合，你可以只收集一个列表中的键集并迭代它：

```
List allKeys = new LinkedList();
for(map: arrayOfHashmaps) {
   allKeys.addAll(map.KeySet());
}
return allKey.iterator(); 
```

第二种解决方案将使用稍微多一点的内存并且会慢一点。但是我怀疑这会很重要。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T14:36:06.417

根据[API](http://java.sun.com/javase/6/docs/api/) HashMap 有一个名为 entrySet() 的函数，它返回哈希中映射的集合视图。集合是一个可迭代的对象。要制作迭代器，只需遍历数组，将每个散列转换为一个集合，然后将各个迭代器组合成一个迭代器......

在 java 中没有内置的方式来组合迭代器，但是，编写自己的 compose 函数应该是微不足道的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T14:36:21.003

我这样做的方法是创建一个实现迭代器的内部类。在内部，它跟踪 1) 映射数组中的当前索引，以及 2) 当前映射中的迭代器。它`hasNext()`和`next()`方法将简单地委托给当前迭代器，或者如果迭代器完成，只需增加索引并更改迭代器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T14:37:09.707

为什么不自己滚动在各种地图上连续迭代呢？

```
public class MapCollection<K,V> implements Iterable<V> {
  Map [] maps;

  public Iterator<V> iterator(){
           return new MapCollectionIterator(maps);
   }

   private class MapCollectionIterator<T>{
        public boolean hasNext() {
        public T next(){... (code omitted due to lazyness..)
  } 
```

}

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T15:42:30.673

作为替代方案，您可以尝试将图的所有条目存储在单个 HashMap 中，其中键是包含节点号和相邻节点号的对象。我假设节点号通常是 HashMaps 数组的索引，而邻居节点是当前 HashMap 的键。这将使您能够执行与现在相同的检索，并迭代所有条目而无需编写任何特殊代码。

不要忘记，您需要为用作键的对象编写一个 equals() 和一个好的散列函数（否则该对象可能非常简单）。如果您有非常大的图表，这当然可能不合适。

# c# - 升级到 VS2008 Sp1 后，网站报告 xxx 在当前上下文中不存在

> ID：658490
> 
> 赞同：0
> 
> 时间：2009-03-18T14:28:06.437
> 
> 标签：c#, asp.net, visual-studio-2008, visual-studio-2008-sp1

我刚刚升级到 VS2008 Sp1，我遇到了一个奇怪的问题。我从页面后面的代码中收到很多错误，表明当前上下文中不存在控件，并且我还收到页面没有方法的错误。

似乎 ide 正在尝试编译 c# 代码而不编译 aspx 代码。

该站点通过 IIS 和 Visual Web Developer 运行良好，事实上，当我打开页面背后的代码时，所有错误都消失了。有人知道为什么 VS2008 SP1 会这样吗？

我正在使用 C# 和网站项目模式。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T14:45:31.620

检查以确保您的目标是正确版本的 .NET Framework。您可以在解决方案文件的属性中查看它。

VS2008 允许您针对多个框架版本。

还要检查 Web.config，我知道 VS Web Developer 和 VS Standard/Pro 与 Web 配置之间可能存在差异。也许将一个新的 web.config 文件复制到项目中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T15:10:25.510

对于听起来可能是我的问题的[知识库文章](http://support.microsoft.com/kb/957259)和[修补程序。](http://code.msdn.microsoft.com/kb957259)如果这是我的具体问题但行为匹配，我将对此进行测试并更新我的答案。我需要提高我的谷歌技能..应该通过谷歌找到这个。

这个补丁解决了我的问题，奇怪

# c# - 如何使用所有引用递归地将程序集加载到 AppDomain？

> ID：658498
> 
> 赞同：116
> 
> 时间：2009-03-18T14:30:09.567
> 
> 标签：c#, .net, reflection, assemblies, appdomain

我想加载一个`AppDomain`具有复杂引用树的新程序集（MyDll.dll -> Microsoft.Office.Interop.Excel.dll -> Microsoft.Vbe.Interop.dll -> Office.dll -> stdole.dll）

据我了解，当一个程序集被加载到时`AppDomain`，它的引用不会自动加载，我必须手动加载它们。所以当我这样做时：

```
string dir = @"SomePath"; // different from AppDomain.CurrentDomain.BaseDirectory
string path = System.IO.Path.Combine(dir, "MyDll.dll");

AppDomainSetup setup = AppDomain.CurrentDomain.SetupInformation;
setup.ApplicationBase = dir;
AppDomain domain = AppDomain.CreateDomain("SomeAppDomain", null, setup);

domain.Load(AssemblyName.GetAssemblyName(path)); 
```

并得到`FileNotFoundException`：

> 无法加载文件或程序集“MyDll，Version=1.0.0.0，Culture=neutral，PublicKeyToken=null”或其依赖项之一。该系统找不到指定的文件。

我认为关键部分是**它的依赖项之一**。

好的，我下一个`domain.Load(AssemblyName.GetAssemblyName(path));`

```
foreach (AssemblyName refAsmName in Assembly.ReflectionOnlyLoadFrom(path).GetReferencedAssemblies())
{
    domain.Load(refAsmName);
} 
```

但是`FileNotFoundException`又在另一个（引用的）程序集上得到了。

如何递归加载所有引用？

在加载根程序集之前是否必须创建引用树？如何在不加载程序集的情况下获取程序集的引用？

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2012-11-13T04:43:50.747

您需要`CreateInstanceAndUnwrap`在代理对象在外部应用程序域中执行之前调用。

```
 class Program
{
    static void Main(string[] args)
    {
        AppDomainSetup domaininfo = new AppDomainSetup();
        domaininfo.ApplicationBase = System.Environment.CurrentDirectory;
        Evidence adevidence = AppDomain.CurrentDomain.Evidence;
        AppDomain domain = AppDomain.CreateDomain("MyDomain", adevidence, domaininfo);

        Type type = typeof(Proxy);
        var value = (Proxy)domain.CreateInstanceAndUnwrap(
            type.Assembly.FullName,
            type.FullName);

        var assembly = value.GetAssembly(args[0]);
        // AppDomain.Unload(domain);
    }
}

public class Proxy : MarshalByRefObject
{
    public Assembly GetAssembly(string assemblyPath)
    {
        try
        {
            return Assembly.LoadFile(assemblyPath);
        }
        catch (Exception)
        {
            return null;
            // throw new InvalidOperationException(ex);
        }
    }
} 
```

另外，请注意，如果您使用`LoadFrom`，您可能会遇到`FileNotFound`异常，因为程序集解析器将尝试在 GAC 或当前应用程序的 bin 文件夹中查找您正在加载的程序集。用于`LoadFile`加载任意程序集文件 - 但请注意，如果这样做，您需要自己加载任何依赖项。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2013-12-05T13:30:06.210

一旦您将程序集实例传递回调用者域，调用者域将尝试加载它！这就是你得到异常的原因。这发生在您的最后一行代码中：

```
domain.Load(AssemblyName.GetAssemblyName(path)); 
```

因此，无论您想对程序集做什么，都应该在代理类中完成 - 一个继承*MarshalByRefObject*的类。

考虑到调用者域和新创建的域都应该可以访问代理类程序集。如果您的问题不是太复杂，请考虑保持 ApplicationBase 文件夹不变，因此它将与调用者域文件夹相同（新域将仅加载它需要的程序集）。

在简单的代码中：

```
public void DoStuffInOtherDomain()
{
    const string assemblyPath = @"[AsmPath]";
    var newDomain = AppDomain.CreateDomain("newDomain");
    var asmLoaderProxy = (ProxyDomain)newDomain.CreateInstanceAndUnwrap(Assembly.GetExecutingAssembly().FullName, typeof(ProxyDomain).FullName);

    asmLoaderProxy.GetAssembly(assemblyPath);
}

class ProxyDomain : MarshalByRefObject
{
    public void GetAssembly(string AssemblyPath)
    {
        try
        {
            Assembly.LoadFrom(AssemblyPath);
            //If you want to do anything further to that assembly, you need to do it here.
        }
        catch (Exception ex)
        {
            throw new InvalidOperationException(ex.Message, ex);
        }
    }
} 
```

如果您确实需要从与当前应用程序域文件夹不同的文件夹加载程序集，请使用特定的 dll 搜索路径文件夹创建新的应用程序域。

例如，上述代码中的应用程序域创建行应替换为：

```
var dllsSearchPath = @"[dlls search path for new app domain]";
AppDomain newDomain = AppDomain.CreateDomain("newDomain", new Evidence(), dllsSearchPath, "", true); 
```

这样，所有的 dll 将自动从 dllsSearchPath 解析。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-06-17T06:10:35.550

[http://support.microsoft.com/kb/837908/en-us](http://support.microsoft.com/kb/837908/en-us)

C#版本：

创建一个主持人类并从以下位置继承它`MarshalByRefObject`：

```
class ProxyDomain : MarshalByRefObject
{
    public Assembly GetAssembly(string assemblyPath)
    {
        try
        {
            return Assembly.LoadFrom(assemblyPath);
        }
        catch (Exception ex)
        {
            throw new InvalidOperationException(ex.Message);
        }
    }
} 
```

从客户站点调用

```
ProxyDomain pd = new ProxyDomain();
Assembly assembly = pd.GetAssembly(assemblyFilePath); 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-03-18T14:55:28.227

在您的新 AppDomain 上，尝试设置[AssemblyResolve](http://msdn.microsoft.com/en-us/library/system.appdomain.assemblyresolve.aspx)事件处理程序。缺少依赖项时会调用该事件。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-18T14:52:53.663

如果引用的程序集不在 GAC 或 CLR 的探测路径中，则需要处理 AppDomain.AssemblyResolve 或 AppDomain.ReflectionOnlyAssemblyResolve 事件（取决于您正在执行的加载）。

[AppDomain.AssemblyResolve](http://msdn.microsoft.com/en-us/library/system.appdomain.assemblyresolve.aspx)

[AppDomain.ReflectionOnlyAssemblyResolve](http://msdn.microsoft.com/en-us/library/system.appdomain.reflectiononlyassemblyresolve.aspx)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2014-03-20T04:24:03.013

我花了一段时间才理解@user1996230 的答案，所以我决定提供一个更明确的例子。在下面的示例中，我为另一个 AppDomain 中加载的对象创建代理，并从另一个域调用该对象的方法。

```
class ProxyObject : MarshalByRefObject
{
    private Type _type;
    private Object _object;

    public void InstantiateObject(string AssemblyPath, string typeName, object[] args)
    {
        assembly = Assembly.LoadFrom(AppDomain.CurrentDomain.BaseDirectory + AssemblyPath); //LoadFrom loads dependent DLLs (assuming they are in the app domain's base directory
        _type = assembly.GetType(typeName);
        _object = Activator.CreateInstance(_type, args); ;
    }

    public void InvokeMethod(string methodName, object[] args)
    {
        var methodinfo = _type.GetMethod(methodName);
        methodinfo.Invoke(_object, args);
    }
}

static void Main(string[] args)
{
    AppDomainSetup setup = new AppDomainSetup();
    setup.ApplicationBase = @"SomePathWithDLLs";
    AppDomain domain = AppDomain.CreateDomain("MyDomain", null, setup);
    ProxyObject proxyObject = (ProxyObject)domain.CreateInstanceFromAndUnwrap(typeof(ProxyObject).Assembly.Location,"ProxyObject");
    proxyObject.InstantiateObject("SomeDLL","SomeType", new object[] { "someArgs});
    proxyObject.InvokeMethod("foo",new object[] { "bar"});
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-03-05T16:52:49.227

关键是 AppDomain 引发的 AssemblyResolve 事件。

```
[STAThread]
static void Main(string[] args)
{
    fileDialog.ShowDialog();
    string fileName = fileDialog.FileName;
    if (string.IsNullOrEmpty(fileName) == false)
    {
        AppDomain.CurrentDomain.AssemblyResolve += CurrentDomain_AssemblyResolve;
        if (Directory.Exists(@"c:\Provisioning\") == false)
            Directory.CreateDirectory(@"c:\Provisioning\");

        assemblyDirectory = Path.GetDirectoryName(fileName);
        Assembly loadedAssembly = Assembly.LoadFile(fileName);

        List<Type> assemblyTypes = loadedAssembly.GetTypes().ToList<Type>();

        foreach (var type in assemblyTypes)
        {
            if (type.IsInterface == false)
            {
                StreamWriter jsonFile = File.CreateText(string.Format(@"c:\Provisioning\{0}.json", type.Name));
                JavaScriptSerializer serializer = new JavaScriptSerializer();
                jsonFile.WriteLine(serializer.Serialize(Activator.CreateInstance(type)));
                jsonFile.Close();
            }
        }
    }
}

static Assembly CurrentDomain_AssemblyResolve(object sender, ResolveEventArgs args)
{
    string[] tokens = args.Name.Split(",".ToCharArray());
    System.Diagnostics.Debug.WriteLine("Resolving : " + args.Name);
    return Assembly.LoadFile(Path.Combine(new string[]{assemblyDirectory,tokens[0]+ ".dll"}));
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-04-09T23:47:46.343

我不得不这样做几次，并研究了许多不同的解决方案。

我发现的最优雅和最容易完成的解决方案可以这样实现。

### 1.创建一个可以创建简单界面的项目

*该界面将包含您希望呼叫的任何成员的签名。*

```
public interface IExampleProxy
{
    string HelloWorld( string name );
} 
```

保持这个项目干净和精简很重要。这是一个项目，两者`AppDomain`都可以引用，并且允许我们不引用`Assembly`我们希望从客户端程序集加载到单独域中的项目。

### 2\. 现在创建项目，其中包含要单独加载的代码`AppDomain`。

*与客户端项目一样，该项目将引用代理项目，您将实现接口。*

```
public interface Example : MarshalByRefObject, IExampleProxy
{
    public string HelloWorld( string name )
    {
        return $"Hello '{ name }'";
    }
} 
```

### 3\. 接下来，在客户端项目中，加载另一个`AppDomain`.

*所以，现在我们创建一个新的`AppDomain`. 可以指定装配参考的基准位置。探测将检查 GAC 和当前目录以及`AppDomain`基本位置中的依赖程序集。*

```
// set up domain and create
AppDomainSetup domaininfo = new AppDomainSetup
{
    ApplicationBase = System.Environment.CurrentDirectory
};

Evidence adevidence = AppDomain.CurrentDomain.Evidence;

AppDomain exampleDomain = AppDomain.CreateDomain("Example", adevidence, domaininfo);

// assembly ant data names
var assemblyName = "<AssemblyName>, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null|<keyIfSigned>";
var exampleTypeName = "Example";

// Optional - get a reflection only assembly type reference
var @type = Assembly.ReflectionOnlyLoad( assemblyName ).GetType( exampleTypeName ); 

// create a instance of the `Example` and assign to proxy type variable
IExampleProxy proxy= ( IExampleProxy )exampleDomain.CreateInstanceAndUnwrap( assemblyName, exampleTypeName );

// Optional - if you got a type ref
IExampleProxy proxy= ( IExampleProxy )exampleDomain.CreateInstanceAndUnwrap( @type.Assembly.Name, @type.Name );    

// call any members you wish
var stringFromOtherAd = proxy.HelloWorld( "Tommy" );

// unload the `AppDomain`
AppDomain.Unload( exampleDomain ); 
```

*如果需要，有很多不同的方法来加载程序集。您可以在此解决方案中使用不同的方式。如果您有程序集限定名称，那么我喜欢使用它，`CreateInstanceAndUnwrap`因为它会加载程序集字节，然后为您实例化您的类型并返回一个`object`您可以简单地转换为您的代理类型，或者如果您不是强类型代码，您可以使用动态语言运行时并将返回的对象分配给`dynamic`类型化变量，然后直接调用该变量上的成员。*

### 你有它。

这允许单独加载您的客户端项目没有引用的程序集，`AppDomain`并从客户端调用其上的成员。

### 为了进行测试，我喜欢使用 Visual Studio 中的 Modules 窗口。它将显示您的客户端程序集域以及该域中加载的所有模块以及您的新应用程序域以及该域中加载的程序集或模块。

关键是要确保您的代码是派生的`MarshalByRefObject`或可序列化的。

`MarshalByRefObject 将允许您配置其所在域的生命周期。例如，假设您希望域在 20 分钟内未调用代理时销毁。

### 我希望这有帮助。

# sql - 加入查询或子查询

> ID：658501
> 
> 赞同：5
> 
> 时间：2009-03-18T14:31:04.497
> 
> 标签：sql, join, subquery

开发人员何时使用联接而不是子查询是否有经验法则，或者它们是否相同。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-18T17:23:03.490

第一个原则是“准确地陈述查询”。第二个原则是“简单明了地陈述查询”（这是您通常做出选择的地方）。第三个是“说明查询，以便有效处理”。

如果它是一个具有良好查询处理器的 dbms，那么等效的查询设计应该会产生相同的查询计划（或至少同样有效）。

我第一次使用 MySQL 时最大的挫败感是我必须有意识地预测优化器。在长期使用 Oracle、SQL Server、Informix 和其他 dbms 产品之后，我很少期望自己会关注这些问题。现在使用更新版本的 MySQL 会更好，但与其他版本相比，我最终需要更频繁地关注它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-18T14:33:47.610

在性能方面，它们在大多数现代数据库引擎中没有任何区别。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-18T14:36:28.070

子查询的问题是您可能会在没有任何键的情况下结束子结果集，因此加入它们会更昂贵。

如果可能，请始终尝试使用 ON 子句而不是 WHERE 进行 JOIN 查询和过滤（尽管它应该是相同的，因为现代引擎为此进行了优化）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-18T14:33:25.940

理论上，每个子查询都可以更改为连接查询。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-18T14:33:29.140

取决于关系数据库管理系统。您应该比较两个查询的执行计划。

根据我使用 Oracle 10 和 11 的经验，执行计划总是相同的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-18T14:41:03.457

与许多事情一样，这取决于。- 子查询有多复杂 - 在查询中子查询多久执行一次

我尽量避免子查询。尤其是当期望大的结果集永远不要使用子查询时——以防子查询是针对结果集的每个项目执行的。

保重，亚历克斯

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-18T17:22:00.653

现在让我们忽略性能影响（如果我们知道“过早的优化是万恶之源”，我们应该这样做）。

选择看起来更清晰、更易于维护的内容。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-18T17:16:05.223

在 SQL Server 中，相关子查询的性能通常比连接更差，或者甚至在性能方面甚至更好，连接到派生表。我几乎从不为必须多次执行的任何事情编写子查询。这是因为相关子查询通常基本上将您的查询变成游标并一次运行一行。在数据库中，通常最好以基于集合的方式做事

# algorithm - k路合并中合并与项目数之间的关系是什么

> ID：658502
> 
> 赞同：0
> 
> 时间：2009-03-18T14:31:20.767
> 
> 标签：algorithm, performance

问题是：在一次 k 路合并中，我们将执行多少次合并操作。例如：2路合并：2节点1合并；3节点2合并；4 个节点 3 个合并。所以我们得到 M(n)=n-1。

当 k 是任意的时，M(n) 是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T17:08:44.867

2-way merge 在合并大小相等的块时效率最高，因此基于 2-way 合并的最有效的*k* -way 合并是先将块 1 与块 2 合并，将块 3 与块 4 合并，以此类推，然后合并前两个结果块，依此类推。这基本上是归并排序的工作原理，并导致 O( *kn* log *k* ) 时间，假设*k*个块中的每一个包含*n 个*项目。但只有当所有块都恰好有*n 个*项目并且*k*是 2 的幂时，它才是完全有效的，所以......

您可以使用包含每个块的第一项（即总共*k*项）的堆，而不是执行*k个单独的合并通道：*

 *1.  从堆中读取最低项（O(log *k* ) 时间）
2.  把它写出来
3.  从堆中删除它
4.  如果该项目来自的块尚未耗尽，则将其下一个项目放入堆中（再次O（log *k*）一次）。
5.  重复直到堆为空。

如果总共有*kn*个项目，这总是需要 O( *kn* log *k* ) 时间，无论它们如何在块之间分布，也不管*k*是否是 2 的幂。您的堆需要包含`(item, block_index)`对，以便您可以识别每个项目来自哪个块。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T04:05:33.087

好的，按照说明回答原始问题：

要使用一系列 2 路合并来合并*k个块，**总是*需要恰好*k* - 1 次合并，因为无论您在任何时间点选择合并哪对块，合并它们都会将块的总数减少 1。

正如我在原始答案中所说，您选择合并的哪对块*确实会*影响整体时间复杂度——最好合并大小相似的块——但它不会影响 2 路合并操作的*数量*。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T01:55:17.113

是的，堆的方式可能更有效。但是原始问题的答案是什么？我发现可能没有答案，因为它可能不是一个完整的 k 路树，所以 4 路可能会回归到 3 路、2 路。

# linq - 优化或“调整”LINQ 表达式的最佳方法是什么？

> ID：658506
> 
> 赞同：3
> 
> 时间：2009-03-18T14:31:54.430
> 
> 标签：linq, optimization, query-optimization, metrics

在构造 LINQ 表达式（对我来说，是 linq to objects）时，有很多方法可以完成某事，有些方法比其他方法好得多、效率高。

*   有没有“调整”或优化这些表达式的好方法？
*   人们使用哪些基本指标，您如何收集它们？
*   有没有办法获得“总迭代次数”计数或其他一些指标，您可以“知道”越低意味着越好？

**编辑**

感谢理查德/乔恩的回答。

看起来我真正想要的是一种为 LINQ 表达式获取简单操作计数“OCount”的方法，尽管我不确定 LINQ 中是否存在允许它的钩子。假设我有一个特定机器硬件（SLA）的目标性能水平。理想情况下，我会添加一个单元测试来确认通过该查询移动的典型数据将在分配的时间内（来自 SLA）处理。问题是这将在构建服务器/开发人员机器/等上运行。这可能与 SLA 的机器硬件几乎没有相似之处。所以我的想法是，我将为表达式确定一个可接受的最大“OCount”，知道如果 OCount 小于 X，它肯定会在目标“典型”硬件上在 SLA 下提供可接受的性能。如果 OCount 超过此阈值，构建/单元测试会产生警告。理想情况下，我想要这样的东西（伪代码）：

```
var results = [big linq expression run against test dataset];
Assert.IsLess(MAXALLOWABLE_OCOUNT, results.OCount) 
```

其中 results.OCount 只会给我生成结果集所需的总迭代次数 (n)。

为什么我会喜欢这个？？

好吧，即使是大小适中的 LINQ 表达式，由于增加了整体操作数，微小的更改/添加也会对性能产生巨大影响。应用程序代码仍然会通过所有单元测试，因为它仍然会产生正确的结果，但在部署时运行缓慢。

另一个原因是简单的学习。如果你做某事并且 OCount 上升或下降一个数量级，那么你就会学到一些东西。

**编辑#2** 我也会提出一个潜在的答案。这不是我的，它来自[Cameron MacFarland](https://stackoverflow.com/users/3820/cameron-macfarland)，来自我问的另一个问题，它产生了这个问题。事实证明，我认为这个问题的答案可以在单元测试环境中工作，就像我在第一次编辑这个问题时描述的那样。

它的本质是在单元测试夹具中创建测试数据集，您按照此答案中概述的方式将其输入 LINQ 表达式，然后将迭代计数相加并与最大允许迭代计数进行比较。

在这里查看[卡梅伦的答案](https://stackoverflow.com/questions/655803/how-do-i-report-progress-while-executing-a-linq-expression-on-a-large-ish-data-se/657181#657181)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T14:43:56.087

您基本上需要计算出复杂度函数。这取决于操作员，但不幸的是，这往往没有很好的记录。

（对于一般原则，我同意理查德的回答——这只是 LINQ to Objects 的东西。）

如果您有感兴趣的特定运营商，那么值得询问他们，但在我的脑海中：

*   选择 = O(n)
*   其中 = O(n)
*   Join = O(inner + outer + matches) （即它不比 便宜`inner + outer`，但可能与结果一样糟糕`inner * outer`）
*   GroupJoin = 与 Join 相同，但由外部缓冲而不是流式传输
*   OrderBy = O(n log n)
*   SelectMany = O(n + 结果)
*   Count = O(1) 或 O(n) 取决于它是否实现 IList
*   计数（谓词）= O（n）
*   最大值/最小值 = O(n)
*   All/Any = O(n)（可能提前退出）
*   不同 = O(n)
*   跳过/采取 = O(n)
*   SkipWhile/TakeWhile = O(n)

确切的特征取决于操作员是缓冲还是流。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-18T14:37:11.297

1.  获取描述所需整体性能的 SLA（或其他定义）。

2.  测量应用程序性能，以及它低于要求的程度（如果在要求范围内，则停止并做一些有用的事情）。

3.  使用分析器获取详细的性能细分，确定系统中最可以改进的部分（对热门代码进行小幅改进可能比对很少被调用的代码进行大改进要好）。

4.  进行更改，重新运行单元/功能测试（没有必要快速做错事）。

5.  转到 1。

如果在 #3 中您发现 LINQ 表达式是一个性能问题，那么请开始考虑需要对这个问题的答案。答案将完全取决于您使用的 LINQ 提供程序以及在您的情况下使用它的详细信息。没有普遍的答案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T15:14:26.013

添加到正在添加到理查德的 Jon

要考虑的另一个问题是您是否正在处理 LINQ 查询的所有结果。在某些情况下，尤其是 UI，您最终只处理从 LINQ 查询返回的结果的子集。在这些情况下，了解哪些 LINQ 查询支持惰性求值很重要。这是在不处理整个集合的情况下返回结果子集的能力。

例如，在以下 LINQ 操作上调用 MoveNext() 将一次处理一个结果

*   选择
*   在哪里

但是以下必须在返回单个项目之前处理集合中的每个元素。

*   排序依据
*   除了（完全处理其他集合）

# c# - C# Web 应用程序中的 ASP 控件“移动”

> ID：658513
> 
> 赞同：2
> 
> 时间：2009-03-18T14:33:10.060
> 
> 标签：c#, asp.net

我正在开发一个 2.0 框架 C# Web 应用程序。最近引起我注意的是，当页面上发生事件（特别是按钮提交）然后其他 ASP 控件被鼠标悬停（文本框、单选按钮、常规按钮）时，它们似乎一直向下移动，而你可以查看下方原始位置的控件（这会产生重复控件的效果，一个与另一个重叠）。刷新页面后，问题就会消失，直到发生另一个事件。

提供一些背景知识，用户只能在 IE 中体验到这一点。在我测试过的所有人中，它只发生在极少数计算机上。最后要添加的一件事是，我在似乎“中断”的控件上方的 div 中合并了 JQuery 圆角。

以前有没有人见过这个问题，如果有，它是如何解决的？一点洞察力会很棒。

提前致谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T14:36:00.443

我猜你的 jQuery 代码正在克隆 HTML 元素。如果你关闭你的jQuery来圆角，问题仍然存在吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T14:37:35.867

我以前没有听说过这个特定的错误，但它可能是使用[IE Zoom fix 修复](http://www.positioniseverything.net/articles/haslayout.html)的，它修复了由 IE6 奇怪的浮动模型引起的错误。

# javascript - 使用 JQuery 从出生日期算起的年龄

> ID：658522
> 
> 赞同：20
> 
> 时间：2009-03-18T14:33:56.017
> 
> 标签：javascript, jquery, datetime

我需要使用 JQuery 计算某人从出生日期起是否超过 18 岁。

```
var curr = new Date();
curr.setFullYear(curr.getFullYear() - 18);

var dob = Date.parse($(this).text());

if((curr-dob)<0)
{
    $(this).text("Under 18");
}
else
{
    $(this).text(" Over 18");
} 
```

必须使用一些更简单的函数来比较日期，而不是使用 setFullYear 和 getFullYear 方法。

注意：我想要找到一种新方法的真正原因是代码的长度。我必须将此代码放入限制为 250 个字符的数据库字段中。更改数据库不是一件可以快速或轻松地发生的事情。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-18T15:03:03.450

您可能会发现开源[Datejs](http://www.datejs.com/)库很有帮助。具体[`addYears`](http://code.google.com/p/datejs/wiki/APIDocumentation#addYears)功能。

```
var dob = Date.parse($(this).text());
if (dob.addYears(18) < Date.today())
{
    $(this).text("Under 18");
}
else
{
    $(this).text(" Over 18");
} 
```

以更简洁的方式：

```
$(this).text(
    Date.parse($(this).text()).addYears(18) < Date.today() ?
    "Under 18" :
    " Over 18"
) 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-07-28T22:07:30.793

```
Date.prototype.age=function(at){
    var value = new Date(this.getTime());
    var age = at.getFullYear() - value.getFullYear();
    value = value.setFullYear(at.getFullYear());
    if (at < value) --age;
    return age;
};

var dob = new Date(Date.parse($(this).text()));

if(dob.age(new Date()) < 18)
{
    $(this).text("Under 18");
}
else
{
    $(this).text(" Over 18");
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-18T14:55:49.973

您可以删除 DOB 的单独变量并折叠 if 语句。以下代码包含 165 个字符：

```
var check = new Date();
check.setFullYear(check.getFullYear() - 18);
$(this).text((new Date("3/6/2009").getTime() - check.getTime() < 0)?"Under 18":"Over 18"); 
```

这仍将保留处理闰年所需的逻辑。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T14:51:16.427

```
$(this).text(((new Date().getFullYear()-Date.parts($(this).text()))>=18)?"Over 18":"Under 18"); 
```

更好的？:D

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-09-24T09:17:04.547

请记住，以上所有答案仅适用于使用分隔符“/”的日期。如果您使用的是其他的，那么您必须先更换该分隔符。

```
var startDate = $('#start_date').val().replace('-','/');
var endDate = $('#end_date').val().replace('-','/');

if(startDate > endDate){
   // do stuff here...
} 
```

快乐编码 :D

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T14:49:26.760

您可以使用 Date 对象。这将返回两个日期之间的毫秒数。一年有 31556952000 毫秒。

```
function dateDiff(var now, var dob)
{
    return now.getTime() - dob.getTime();
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-11-22T12:02:32.890

我的解决方案。

```
var startDt=document.getElementById("startDateId").value;
var endDt=document.getElementById("endDateId").value;
if( (new Date(startDt).getTime() > new Date(endDt).getTime()))
{
    ----------------------------------  
} 
```

# sql - 执行非常具体的 SQL 查询以以不同格式放置数据的问题

> ID：658524
> 
> 赞同：0
> 
> 时间：2009-03-18T14:34:29.137
> 
> 标签：sql, sql-server, sql-server-2005

我在处理需要查询并重新格式化为另一个表以用于报告目的的 SQL 表时遇到了一些麻烦。这是初始表：

```
id               int, 
logtimestamp    datetime, 
serialnumber    varchar(255), 
robotid         int, 
amountconsumed  float 
```

' `robotid`s 仅从 1 到 4。每 15-20 分钟添加新行。通常，每个机器人都会报告一个序列号，但并非总是如此。序列号可以定期重复。（这仅在测试时发生，但也可能发生。）

我的目标是总结给定日期每个机器人的消费量，并将这些值放在一个结果表中，如下所示：

```
id              int, 
logtimestamp   datetime,
robot1consumed float, 
robot2consumed float, 
robot3consumed float, 
robot4consumed float 
```

我很难创建一个准确考虑到以下事实的查询

*   可能存在重复的序列号
*   并非每个序列号都包含所有 4 个机器人 ID（如果当天不存在机器人 ID，则该值应设置为 0）。

到目前为止，这是我想出的（给出了@startDate 和@endDates）：

```
SELECT 
    timestamp=dateadd(month,((Year(R1.logtimestamp)-1900)*12)+Month(R1.logtimestamp)-1,Day(R1.logtimestamp)-1),
    sum(R1.robot1consumed ), 
    sum(R2.robot1consumed ), 
    sum(R3.robot1consumed ), 
    sum(R4.robot1consumed )
FROM 
    Robot_Consumption R1, 
    Robot_Consumption R2, 
    Robot_Consumption R3, 
    Robot_Consumption R4
WHERE
   R1.robotid = '1' 
   AND R2.robotid = '2' 
   AND R3.robotid = '3' 
   AND R4.robotid = '4' 
   AND R1.logtimestamp BETWEEN @startDate AND @endDate 
   AND R1.serialnumber = R2.serialnumber 
   AND R1.serialnumber = R3.serialnumber 
   AND R1.serialnumber = R4.serialnumber 
GROUP BY 
   Year(R1.logtimestamp), Month(R1.logtimestamp), Day(R1.logtimestamp) 
```

除了上面列出的限制之外，这工作正常。鉴于先前列出的约束，是否有人建议更改此查询以使其正常工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T14:49:01.160

```
SELECT  '0000-00-00' + INTERVAL dte DAY AS robot_date,
        id,
        SUM(amountconsumed)
FROM    (
        SELECT 1 AS id
        UNION ALL
        SELECT 2
        UNION ALL
        SELECT 3
        UNION ALL
        SELECT 4
        ) r
-- this is to select all robotids
JOIN
        (
        SELECT  DISTINCT TO_DAYS(logtimestamp) AS dte
        FROM    Robot_Consumption
        WHERE   logtimestamp BETWEEN @startDate AND @endDate 
        ) rd
-- this is to select all days that have any records
LEFT OUTER JOIN
        RobotConsumption rc
ON      rc.robotid = r.id
        AND rc.logtimestamp BETWEEN '0000-00-00' + INTERVAL dte DAY AND '0000-00-00' + INTERVAL dte + 1 DAY 
WHERE   NOT EXISTS
        (
        SELECT  1
        FROM    Robot_Consumption rci
        WHERE   rci.robotid = rc.robotid
                AND rci.serial_number = rc.serial_number
                AND rci.id < rc.id
        )
-- this is to handle duplicates
GROUP BY
        dte, id 
```

如果您需要连续获得结果，请使用：

```
SELECT  '0000-00-00' + INTERVAL dte DAY AS robot_date,
        COALESCE(
        (
        SELECT  SUM(amountconsumed)
        FROM    Robot_Consumption rc
        WHERE   rc.robotid = 1
                AND rc.logtimestamp BETWEEN '0000-00-00' + INTERVAL dte DAY AND '0000-00-00' + INTERVAL dte + 1 DAY
                AND NOT EXISTS
                (
                SELECT  1
                FROM    Robot_Consumption rci
                WHERE   rci.robotid = rc.robotid
                        AND rci.serial_number = rc.serial_number
                        AND rci.id < rc.id
                )
        ), 0) AS robot1consumed,
        COALESCE(
        (
        SELECT  SUM(amountconsumed)
        FROM    Robot_Consumption rc
        WHERE   rc.robotid = 2
                AND rc.logtimestamp BETWEEN '0000-00-00' + INTERVAL dte DAY AND '0000-00-00' + INTERVAL dte + 1 DAY
                AND NOT EXISTS
                (
                SELECT  1
                FROM    Robot_Consumption rci
                WHERE   rci.robotid = rc.robotid
                        AND rci.serial_number = rc.serial_number
                        AND rci.id < rc.id
                )
        ), 0) AS robot2consumed,
        COALESCE(
        (
        SELECT  SUM(amountconsumed)
        FROM    Robot_Consumption rc
        WHERE   rc.robotid = 3
                AND rc.logtimestamp BETWEEN '0000-00-00' + INTERVAL dte DAY AND '0000-00-00' + INTERVAL dte + 1 DAY
                AND NOT EXISTS
                (
                SELECT  1
                FROM    Robot_Consumption rci
                WHERE   rci.robotid = rc.robotid
                        AND rci.serial_number = rc.serial_number
                        AND rci.id < rc.id
                )
        ), 0) AS robot3consumed,
        COALESCE(
        (
        SELECT  SUM(amountconsumed)
        FROM    Robot_Consumption rc
        WHERE   rc.robotid = 4
                AND rc.logtimestamp BETWEEN '0000-00-00' + INTERVAL dte DAY AND '0000-00-00' + INTERVAL dte + 1 DAY
                AND NOT EXISTS
                (
                SELECT  1
                FROM    Robot_Consumption rci
                WHERE   rci.robotid = rc.robotid
                        AND rci.serial_number = rc.serial_number
                        AND rci.id < rc.id
                )
        ), 0) AS robot4consumed,
FROM    (
        SELECT  DISTINCT TO_DAYS(logtimestamp) AS dte
        FROM    Robot_Consumption
        WHERE   logtimestamp BETWEEN @startDate AND @endDate 
        ) rd 
```

# ruby-on-rails - mod_rewrite 规则检查维护页面（某些子域除外）

> ID：658535
> 
> 赞同：3
> 
> 时间：2009-03-18T14:36:33.327
> 
> 标签：ruby-on-rails, apache, mod-rewrite

我已将 Apache 配置为查找是否存在维护页面，如果存在则重定向到该页面：

```
RewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f
RewriteCond %{SCRIPT_FILENAME} !maintenance.
RewriteRule ^.*$ /system/maintenance.html [L] 
```

这是部署 Ruby on Rails 应用程序的相当标准的做法。

我想创建一个 URL 排除列表，以便特定子域不会发生重定向，例如：`https://user1.myapp.com/any_request_url`或`https://user2.myapp.com/any_request_url`

这可以通过额外的`RewriteCond`语句来实现吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-18T14:44:06.133

这应该这样做：

```
RewriteCond %{HTTP_HOST} !^(user1|user2)\.myapp\.com$ 
```

# .net - 在 .NET 中格式化字符串的正确位置在哪里？

> ID：658552
> 
> 赞同：3
> 
> 时间：2009-03-18T14:40:37.483
> 
> 标签：.net, vb.net

我们的数据库中有一个名为员工编号的字段。它是 char(10) 字段。我们存储的数字是正确的。所以我们将数字存储为`" 1"`等`" 2"`。我不确定我们为什么开始这样做，因为它发生在我开始在这里工作之前。

因此，业务逻辑中将员工编号作为参数之一的每个函数都需要右对齐该编号。如果我们忘记了这一点，它将无法正确更新数据库。

我的问题是：

有没有更好的方法来做到这一点，这样我们就不必在每个函数中格式化数字？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-18T14:44:22.343

停止将您的员工 ID 正确存储在数据库中，并在您想要显示它们时将它们拉出后进行任何理由。

**编辑**：员工编号至少应存储为 varchar(10) （假设它可以接受非数字字符）或整数（如果它是假设的实际“数字”）。检索到该数字后，如果有必要，您可以在显示它的任何应用程序中正确证明它。

**注意**：我在评论中说过这一点，但需要明确说明：试图解决潜在问题只会导致更多问题，并且在从事该项目的不同开发人员之间产生整体混乱感未来将继承该项目。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T14:51:15.337

我不同意使用 char 数据类型，但要解决这个问题，你可以这样做的一种方法是使用触发器。使用整数形式的数字更新表格，然后使用触发器对其进行格式化并将其存储在正确的表格中。

同样，我只是重构数据类型，但听起来你无法做到这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T14:47:55.657

即使这是其他人发布的不好的做法，你不能从他们的员工类中公开一个只读属性来处理格式

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T14:50:47.787

我同意其他人的观点，即重构将是第一个建议。将员工 ID 存储为原始数据，并在视图级别进行任何需要正确对齐的格式化。

如果这绝对不是一个选项，我会在字符串上编写一个扩展方法来处理这个问题。然后你可以存储 someString.RightJustify(10)。扩展方法必须是静态类中的静态方法。像下面这样的东西会起作用：

```
public static class ExtensionMethods
{
    public static string RightJustify(this string s, int chars)
    {
        if (s.Length > chars)
            return s.Substring(0, chars);
        else
            return s.PadLeft(chars, ' ');
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T13:32:35.210

```
Public Function foo(ByVal valToStore As Object) As String
    Dim RetVal As String = String.Empty
    If TypeOf valToStore Is String Then
        RetVal = DirectCast(valToStore, String)
    ElseIf TypeOf valToStore Is Integer Then
        RetVal = DirectCast(valToStore, Integer).ToString
    End If
    RetVal = RetVal.Trim.PadLeft(10, " "c)
    Return RetVal
End Function 
```

我同意数据库应该将其存储为数字，而不是字符串。我猜你想要一个 VB 答案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T14:47:16.437

这当然取决于系统的架构。您有供企业使用的数据层吗？也许你可以在那里进行格式化？

我想将数据库更改为 int 或 bigint 是一个很大的重构，如果不是，请这样做。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-18T14:48:24.203

您可能需要考虑一种扩展方法来扩展（假设是）您的员工 ID 的整数类型。

```
public static int ToRightAlignedString(this int obj)
{
    return ("          " + obj.ToString()).Right(10);
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-18T15:00:22.803

您可以定义一个包装整数的类型（结构，最有可能），并在您的代码中将其用于员工编号。像这样的东西（C#）。

```
struct EmployeeNumber
{
    private int empNumber;

    public String EmpNum
    {
        set
        {
            int test;
            if (Int32.TryParse(value, out test))
            {
                empNumber = test;
            }
        }

        get
        {
            return empNumber.ToString("D10");
        }
    }
} 
```

注意：我同意修复数据库是正确的事情™。但是，我也知道该选项并不总是可用的。在代码中使用自定义数据类型而不是 int 将是消除来回转换为数据库字符串的问题的便捷方法。

# iphone - 我应该在哪里存储在 iPhone 上选择的图像？

> ID：658555
> 
> 赞同：1
> 
> 时间：2009-03-18T14:41:10.463
> 
> 标签：iphone, objective-c, cocoa-touch

我想拍照或从用户现有照片中选择现有照片。做这个的最好方式是什么？

具体来说，我关心我应该在哪里存储图像。存储位置应该是应用程序私有的。每次应用程序打开时，我都需要能够重用图像作为背景。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T14:54:10.540

您应该使用 UIImagePickerController 从库或相机中检索图像。您可以将图片保存在 App 的 Documents 文件夹中。此文件夹对您的应用程序是私有的并且是可写的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-20T01:52:04.887

您可以像这样获取文档文件夹的路径

```
NSArray *sysPaths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory,NSUserDomainMask, YES); 
NSString *docDirectory = [sysPaths objectAtIndex:0]; 
```

并在那里保存一个文件。

```
NSString *filePath = [NSString stringWithFormat:@"%@whatever.jpg",docDirectory];
NSData *toSave = UIImageJPEGRepresentation(image,1.0); //image is a UIImage
[toSave writeToFile:filePath atomically:YES]; 
```

# cookies - asp-classic Request.Cookies 为 1 个 cookie 带来了这个值 "ϑ" 而不是 "ÅÙÏ'‹„‰Š„‹"

> ID：658557
> 
> 赞同：0
> 
> 时间：2009-03-18T14:41:26.343
> 
> 标签：cookies, asp-classic

这发生在一个只有一个键的 cookie 中。该值应为“ÅÙÏ'‹„‰Š„‹”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T15:28:15.187

> 该值应为“ÅÙÏ'‹„‰Š„‹”。

嗯，真的吗？对我来说，这看起来像是损坏的错误字符集版本！:-) 无论哪种方式，“ϑ”都是当您将该字符串保存为 Windows 西欧编码 (cp1252) 然后将其以 UTF-8 格式读回时得到的，删除所有导致的“无效字符”代码，因为它不是一个有效的 UTF-8 字符串。所以你有一个经典的使用不同编码的读写问题。

作为一般规则，您无法直接将非 ASCII 字符放入 cookie（名称或值）中。您将需要某种应用程序级编码机制；最流行的方法之一是对所需字符的 UTF-8 表示进行 URL 编码，类似于 JavaScript 的 encodeURIComponent 的做法。

（不幸的是，经典的 ASP 对处理 Unicode 的支持很差。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-30T20:57:46.830

最终解决方案：另存为具有“正确”编码的不同文件更改编码

*   来自“Unicode（带签名的 UTF-8）-代码页 65001”
*   至“西欧 (Windows) - 代码页 1252”

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-06-29T22:32:04.183

我们在 cookie 上使用了编码，一些生成的字符可能会导致问题。所以我们所做的就是获取 cookie 字符串并用 HEX 对其进行编码。- 已解决的问题。

# ant - ant 遍历文件

> ID：658561
> 
> 赞同：2
> 
> 时间：2009-03-18T14:42:50.257
> 
> 标签：ant, ant-contrib

我想遍历一个 jar 列表（未定义的数字）并将它们全部添加到 jar 文件中。要添加它们，我计划使用这样的东西：

```
<jar id="files" jarfile="all.jar">
   <zipfileset src="first.jar" includes="**/*.java **/*.class"/>
   <zipfileset src="second.jar" includes="**/*.java **/*.class"/>
</jar> 
```

但我如何迭代它们？我没有 ant-contrib

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-21T15:53:30.677

只需`zipgroupfileset`与 Ant [Zip 任务一起使用](http://ant.apache.org/manual/Tasks/zip.html)

```
<zip destfile="out.jar">
    <zipgroupfileset dir="lib" includes="*.jar"/>
</zip> 
```

这将展平所有包含的 jar 库的内容。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-18T15:38:04.723

如果您无权访问[`ant-contrib` `For`task](http://ant-contrib.sourceforge.net/tasks/tasks/for.html)，您可能最终必须定义您的[自定义 Task](http://www.nabble.com/New-iterating-task-td21069242.html)来做您需要的事情......

如果你有`ant1.6`及以上，你也可以尝试[`subant`](http://ant.apache.org/manual/Tasks/subant.html)（见[大项目的新 Ant 1.6 功能](http://www.oracle.com/technology/pub/articles/bodewig_ant1.6.html)）：

> 如果您使用`<subant>`'s`genericantfile`属性，它的工作方式类似于`<antcall>`在包含任务的同一构建文件中调用目标。
> 不像`<antcall>`,`<subant>`需要一个或一组目录，并且会为每个设置项目基目录的目录调用一次目标。
> 
> 如果您想在任意数量的目录中执行完全相同的操作，这很有用。

# java - 适合JavaME的语法编译器推荐？

> ID：658572
> 
> 赞同：3
> 
> 时间：2009-03-18T14:44:25.430
> 
> 标签：java, parsing, java-me, grammar, bnf

我想解析一些数据，我有一个 BNF 语法来解析它。谁能推荐任何能够生成可在移动设备上使用的代码的语法编译器？

由于这是针对 JavaME 的，因此生成的代码必须是：

*   希望很小
*   对外来 Java 库的低依赖
*   不依赖于任何运行时 jar 文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T15:00:39.073

我以前用过[JFlex](http://jflex.de/)，我知道它可以满足您的第二和第三个要求。但我不知道生成的代码有多大。根据[手册](http://jflex.de/manual.html#CodeGeneration)，它默认生成一个打包的 DFA 表，所以它可能不会太糟糕。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-04T01:19:00.370

第一个问题是你有现有的语法定义吗？当我将 LALR 语法移植到 Java 时，我使用了 JFlex/CUP。

如果您从头开始，我建议您使用 JavaCC/FreeCC，它是一个 LL(k) 解析器。它有很好的文档记录，并且没有运行时依赖项。

# sharepoint - 在 WSS 2.0 中设置文档库权限

> ID：658576
> 
> 赞同：0
> 
> 时间：2009-03-18T14:45:41.217
> 
> 标签：sharepoint, wss

我正在使用 WSS2.0。我正在尝试为文档库设置一些权限，但没有获得所需的行为。我创建了一个共享点用户并将其分配给“读者”组。我只希望该用户查看文档库内容，但不进行任何更改，例如签出或上传新文档或删除等。因此我分配了 Reader 组。但是，当我以该用户身份登录该站点时，我可以删除文档并执行其他更改。我检查了文档库权限，它包含 Reader、Contributor、Administrator 组，并且权限不是从父级继承的。

是否有任何其他设置我需要检查。我错过或误解了什么吗？

请指教。

谢谢，贾格纳特

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T21:57:17.870

根据提供的详细信息，相关用户似乎也属于另一个具有额外权限的组（本地、Active Directory 或 SharePoint）。

# actionscript-3 - 如何使用 as3 在影片剪辑中动态创建文本？

> ID：658577
> 
> 赞同：0
> 
> 时间：2009-03-18T14:46:25.597
> 
> 标签：actionscript-3, text, dynamic, movieclip, gravity

我想创建像彗星一样动画的文本。我想创建重力效果，在矢量上加速影片剪辑，在舞台上设置起始位置并从 xml 文件加载文本。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-14T19:14:49.527

> 如何使用 as3 在影片剪辑中动态创建文本？

您可以像任何其他 DisplayObject 一样创建一个 TextField 并将其添加到您想要的父级。

例如

```
var myText:TextField = new TextField();
myClip.addChild(myText);
myText.text = 'Hello!'; 
```

我不认为我完全理解你的问题。据我了解，您应该：

1.  加载 xml，这样您就可以事先获得文本（在播放动画时您无需等待 xml 加载
2.  添加你的剪辑和文本
3.  动画

如果您正在为文本设置动画，请注意一件事：当您嵌入字体时，动态文本看起来会更好地动画，如果您打算为旋转或 alpha 设置动画，则需要嵌入字体，否则您将无法为这些属性设置动画。

祝你好运！

# vb.net - 在数据上下文中，插入的值在提交更改之前在数据上下文中不可用吗？

> ID：658578
> 
> 赞同：0
> 
> 时间：2009-03-18T14:46:43.787
> 
> 标签：vb.net, linq, linq-to-sql, datacontext, submitchanges

我正在浏览一篇文章和撰写文章的记者的 XML 文件。当我们将文章添加到 _Data 我们的数据上下文中时，我们可能会遇到需要添加的记者，所以我们这样做：

```
newJourno = New journalist With {.name = strJournalist}
_Data.journalists.InsertOnSubmit(newJourno)
.articles_journalists.Add(New articles_journalist With {.id_journalist = newJourno.id,         .id_article = .id}) 
```

然而，随后我们可能会再次遇到同一个记者，但当我们这样做时没有返回任何内容：

```
Dim journo = _Data.journalists.Where(Function(s) s.name = strJournalist).SingleOrDefault 
```

所以它再次使用上面的代码再次插入同一个记者。

一旦我们所有的插入完成，我们就会做一个提交更改。在这一点上，它有一个头部适合：

INSERT 语句与 COLUMN FOREIGN KEY 约束“FK_articles_journalists_journalists”冲突。冲突发生在数据库'blah'、表'journalists'、列'id'中。该语句已终止。

通过查看 sql profiler 中生成的 sql，您可以看到它多次尝试添加一些记者，这将失败，因为名称必须不同。由于未更新该记者，随后试图插入这些记者的记录失败。

当然，如果我有一个记者收藏，添加一些，然后查看我的收藏，我应该看到所有这些，而不仅仅是原始的。我猜我可以通过提交更改来捏造它，但这似乎有点愚蠢。

提前致谢，

戴夫。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T15:00:44.347

如果要向数据库添加两个子父行，则必须分配实体，而不是 Id 列，Id 将自动生成，并且仅在提交更改后才可用。

你必须做一个`articles_journalist`对象，然后将 newJourno 实体分配给这个：

```
articles_journalist.journalist = newJourno; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T13:13:23.847

CMS 关于需要分配对象而不是 id 是正确的。

然而，这似乎并没有解决 datacontext 的问题，在您提交更改之前没有意识到它已经添加了新内容。我只能假设这是设计使然，因此我现在在代码插入我们稍后搜索的对象时调用 submitchanges。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T13:19:54.783

“名称必须不同。”

这是一个严重的设计缺陷。人名从来都不是唯一的。

# c# - 从 ASP.NET 日历控件的单元格触发事件

> ID：658595
> 
> 赞同：1
> 
> 时间：2009-03-18T14:50:59.643
> 
> 标签：c#, asp.net, javascript, calendar, custom-server-controls

我正在使用 ASP.NET/C# 框架构建一个事件日历。我可以通过在`OnDayRender`事件处理程序中手动绑定数据来显示相应日期单元格中的事件摘要。客户端需要能够单击单元格内的事件以查看弹出框中的详细信息。

ASP.NET 提供的日历控件不允许将动态控件（可以触发事件）放置在单元格内，因此任何链接按钮都是不可能的。谷歌搜索后，我决定以编程方式在每个代表摘要的单元格内添加超链接，并添加一个 javascript 函数作为超链接`OnClick`事件处理程序。javascript 函数接受事件详细信息并将其显示在警报框中。

在显示事件详细信息（RSVP、提醒我等）的弹出框中，我需要更多功能。理想情况下，我不想走 Javascript 路线，因为我不太了解它。我更喜欢 C/C++ 和 C#。

有人可以给我关于如何使用/不使用 javascript 的一般指示吗？

使用 ASP.NET 框架的事件日历如何能够在传统日历控件的单元格内显示事件触发控件？MSDN 库明确表示无法做到这一点，我尝试并失败了，正如预期的那样。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-19T18:12:33.953

根据我的经验，System.Web.UI.WebControls.Calendar 并不是一段特别好的代码，尤其是当您尝试自定义它时。

我建议您尝试一些可用的日历/计划控制套件。您可以从这个（开源）开始：

[http://www.daypilot.org/daypilot-lite.html](http://www.daypilot.org/daypilot-lite.html)

# javascript - Javascript 在页面期间阻止您网站上的内容下载

> ID：658599
> 
> 赞同：1
> 
> 时间：2009-03-18T14:51:59.717
> 
> 标签：javascript, web, blocking

这是在您的网站上包含 javascript 的最佳方式吗？[http://www.webdigi.co.uk/blog/2009/avoid-javascript-blocking-content-download-on-your-website-during-page-load/](http://www.webdigi.co.uk/blog/2009/avoid-javascript-blocking-content-download-on-your-website-during-page-load/)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T14:54:18.387

[在您的网站上包含 JavaScript 的最佳方法是在页面](http://developer.yahoo.com/performance/rules.html#js_bottom)[末尾](http://developer.yahoo.com/performance/rules.html#js_bottom)*包含尽可能少的文件*，在所有标记和其他资产都已加载之后[*。*](http://developer.yahoo.com/performance/rules.html#js_bottom)这样做还具有鼓励“[渐进增强](http://www.alistapart.com/articles/understandingprogressiveenhancement)”开发模式的额外好处。*

 **雅虎积极投入大量资金进行研究，并聘请了专职的全职人员（包括才华横溢的史蒂夫·苏德斯）[在线](http://developer.yahoo.com/performance/)和以[书本的形式](https://rads.stackoverflow.com/amzn/click/com/0596529309)发布他们的发现。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T15:01:55.857

似乎不是一刀切的情况，所以我经常求助于这篇著名的文章来帮助我回答这样的问题：

[http://developer.yahoo.com/performance/rules.html](http://developer.yahoo.com/performance/rules.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T15:15:35.277

它在其中一个播客中提到过，但如果您将 javascript 托管在单独的域甚至子域上，浏览器可以打开更多连接并同时下载 js 和页面的其余部分。这就是为什么很多人选择链接到 google 的 jQuery 实例，而不是他们自己的。这个例子也有缓存的好处，但核心原则是成立的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T15:22:18.693

简而言之，这篇文章是说`<script>`动态附加节点`DOM`以实现脚本文件的并行下载。这有效，并不是什么新鲜事。

但是它没有提到该方法的最大缺点：虽然脚本将并行下载，但它们的*执行*顺序是不确定的。**IE 将按照它们完成下载的顺序执行它们，而 Firefox 按照它们在 DOM 中的附加顺序执行它们。**

这是个问题。例如，假设脚本 A 和脚本 B 是使用该技术添加的。现在假设脚本 A 是 jQuery，脚本 B 这样做：

```
$(document).ready(function(){...}) 
```

在 IE 中，如果出于某种原因（例如，网络流量、缓存未命中）脚本 B 在脚本 A 之前完成下载，您会被搞砸，因为它将在 jQuery 加载之前执行。

请参阅[这篇文章](http://blogs.msdn.com/kristoffer/archive/2006/12/22/loading-javascript-files-in-parallel.aspx)以获得更好的解释。

[雷克斯 M 的答案](https://stackoverflow.com/questions/658599/javascript-blocking-content-download-on-your-website-during-page#658604)是要走的路。

# ajax - 如何使用动态信息进行整页缓存

> ID：658602
> 
> 赞同：0
> 
> 时间：2009-03-18T14:53:49.637
> 
> 标签：ajax, caching

我想一个非常常见的场景是整个动态页面可以以这样的方式被缓存，从而可以绕过整个框架/CMS堆栈，除了一些少量信息会根据某人是否登录而改变。例如，菜单可能从“登录”变为“欢迎某人！”。不，显然没有办法缓存页面。我正在考虑的一种解决方案是在页面已经加载后通过 AJAX 加载此信息。有人在这里有什么建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T15:04:19.517

将页面流写入文件系统。使用包括查询字符串的整个 URL 命名文件。如果页面包含会话数据，请在文件名中包含会话 ID。将缓存页面列表及其名称保存在某处，以便您无需访问文件系统即可查找缓存中是否存在某些内容。

这基本上就是 FatWire Content Server 所做的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T15:03:11.157

由于这似乎与语言无关，您可以使用页面的原始输出创建一个临时文件，然后当再次加载同一页面时，将临时文件的内容直接转储到当前页面的 HTTP 响应中。

# iphone - iPhone Out of Memory WEIRD 崩溃

> ID：658609
> 
> 赞同：2
> 
> 时间：2009-03-18T14:55:37.370
> 
> 标签：iphone, objective-c, out-of-memory

我的应用程序在大约 20 分钟后崩溃，状态为 101（我相信内存不足）

使用 Instruments - ObjectAlloc 和 Leaks 进行调试没有给我任何线索。ObjectAlloc 图保持在大约 100 万字节 (1MB) 的稳定水平，分配的 Net # 也是如此。我已经摆脱了所有的泄漏。

我认为这可能与线程数有关，但在 ObjectAlloc 中绘制这些图也表明它们是恒定的。

谁能指出我使用另一种工具或另一种调查途径的方向？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T20:24:35.893

修复 Clang 找到的所有内容。[LLVM Clang 静态分析](http://clang-analyzer.llvm.org)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T21:01:04.090

请记住，系统分配的对象（包括图像和声音之类的东西）不会在 Instruments 中被跟踪（当然，顶级保留计数可以）。因此，您可以加载图像，例如，这不会对您的内存使用量产生太大影响，但会消耗大量实际内存！

如果这些都没有引起任何共鸣，您可以尝试减法调试方法 - （复制您的项目）删除功能块，直到问题消失或您获得重现它的最小可能东西。这至少应该可以帮助您找到瓶颈所在。诚然，这会很困难（a）因为每次测试时您都必须等待 20 分钟左右（但如果您将其设为后台程序，那还不错）和（b）因为内存问题的本质是可能不是一个单一的原因，而是一大堆较小的原因。

祝你好运！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T04:22:00.067

我对 Object Alloc 的体验并不那么好。它并不总是为您提供应用程序使用的实际内存。

相反，将 Object Alloc 与 Activity Monitor 一起使用。确保使用活动监视器中的“可用物理内存”和“已使用物理内存”选项。这将准确地告诉您应用程序正在使用多少内存。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T15:14:57.417

你说的“好水平”是什么意思。它根本不会随着时间的推移而上升吗？总共有多少内存 - 可能只是手机需要一些内存来存储其他应用程序，而你的内存太大而无法使用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T19:36:08.350

错误代码 101 表示 iPhone OS 强制退出您的应用程序。如果您在应用程序中使用 UIImageViews，请务必管理它们的内存。我发现一旦我的应用程序超过 10/12 MB，iPhone 就会终止它。

如果您不使用任何图像视图（或大图像），那么您的后端代码会占用太多空间。

我只能说，您需要更仔细地查看您的分配，并随时管理您在内存中保留的视图。

在 Instruments 中运行您的应用程序（运行 -> 使用 Performamce Tool 开始 -> 泄漏）以查看内存分配的位置。

希望这可以帮助！

# asp.net - 用于 ASP.Net 表单的自动筛选组合框

> ID：658611
> 
> 赞同：1
> 
> 时间：2009-03-18T14:56:03.907
> 
> 标签：asp.net, sharepoint

我需要一个类似于 的控件`SharePoint:LookupField`，但可以绑定到任何数据源。（即允许输入的下拉框，并根据迄今为止输入的内容过滤项目）最好与`LookupField`.
有什么建议吗？
谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T19:52:42.193

如果你想要 AJAX： [自动完成](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/AutoComplete/AutoComplete.aspx)

# .net - 哪个数据库适合 Asp.Net？

> ID：658614
> 
> 赞同：2
> 
> 时间：2009-03-18T14:57:05.667
> 
> 标签：.net, asp.net

我在整个数据库课程中一直在使用 oracle 数据库，并且在那里进行了很多编程。然而，现在，我必须在 ASP.NET 中开发现实生活中的 Web 应用程序，有些人建议我使用 SQL 服务器，因为它与 ASP.NET 更兼容。

但是我根本不喜欢使用它，因为我习惯了 oracle 编程，而 SQL server MAnagement studio 在我的计算机上运行速度非常慢，不像 oracle。

那么，你们建议我怎么做，ASP.NET 对它的支持真的很差吗？我不确定我可能会使用 linq-to-sql 和 Nhibernate。哪些数据库在使用时不会产生太大问题？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-18T15:00:35.923

将 SQL 与 ASP.NET 一起使用肯定有一些好处，因为两者在架构上是同步的。但是，许多高性能应用程序都使用 Oracle。NHibernate 与 Oracle 配合得很好。坚持你所知道的东西所带来的生产力收益可能会超过 .NET 已经融入的 SQL 的任何糖分。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-18T15:02:06.277

据我所知，LINQ to SQL 根本不适用于 Oracle。NHibernate 可以，我相信 Entity Framework 可以（它当然*应该*- 使用多个数据库是 EF 优于 LINQ to SQL 的卖点之一；尽管在做出坚定决定之前尝试一下！）

在此之前，我已经知道 Oracle .NET 驱动程序中的一些怪癖，但它们通常可以正常工作。如果您不介意失去 LINQ to SQL 的选项，并且您使用 Oracle 更加舒适和高效，那么我会坚持使用它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-18T15:01:41.613

由于两者都是MS产品，是的，你朋友说的是对的。但是使用 oracle 并没有什么坏处。许可费用如何？您可以使用免费的快递版。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-18T15:07:19.527

我目前正在开发一个连接到 oracle 数据库的 .NET web 应用程序，虽然我*个人*更喜欢 MSSQL 而不是 Oracle，但你会没事的。

当您要使用 linq 2 sql 时，请记住您将需要[LinqToOracle](http://www.codeplex.com/LinqToOracle)或[DbLinq](http://code.google.com/p/dblinq2007/)。它不会“开箱即用”。而且，正如其他人所说，NHibernate 应该可以正常工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-18T15:38:57.077

首先，您必须选择数据提供者。有不同的数据提供者用于组合 .NET 和 Oracle：ODP.NET、Devart 的提供者和 Microsoft 的提供者 (System.Data.OracleClient)。

也许还有其他数据提供者？

**编辑：**

以上如果你选择了Oracle，*首先*意味着在开始编码之前。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T15:02:38.350

ASP.NET 可以很好地与 Oracle 配合使用，并带有大量可以与 Oracle 通信的数据源和其他组件。正如 Rex M 所说，与适应新环境所需的时间和精力相比，完全切换到 SQL Server 是不值得的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-26T16:50:33.550

我之前回答了另一个问题，但是如果数据库要增长，您肯定必须考虑许可成本。sqlserver 的企业成本非常昂贵（每个处理器 23k），对于一个 92k 的四核处理器来说......很多钱！

MySQL 6.0 .net 连接器显然支持 ado.net 实体数据框架，我期待着检查一下。无论如何，我正计划使用 MySQL 来降低成本。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-26T17:08:50.713

我很想了解更多关于 ASP.NET（一个 Web 应用程序开发平台）如何与 SQL Server（一个数据库引擎）“更兼容”的详细信息，因为它们是完全不同的技术。

我认为瓶颈不是数据库本身，而是您对所述数据库的了解。如果您已经精通 Oracle RDBMS，我敢说您可以比学习 SQL Server 更快地创建一个站点。

我使用各种数据库在 ASP.NET 上开发了应用程序，包括 Access、MySQL、Oracle、Sybase 和 SQL Server。被抓挠是普遍的——从数据库中取出数据并显示它或将数据推回数据库。

Linq2SQL 是一个仅适用于 SQL Server 的选项，与 NHibernate 不同，NHibernate 对许多数据库都有很好的支持。

您还可以评估其他 ORM，例如[LLBLGEN](http://www.llblgen.com/)

# silverlight - SilverLight 数据网格

> ID：658616
> 
> 赞同：0
> 
> 时间：2009-03-18T14:57:28.380
> 
> 标签：silverlight, datagrid

我正在构建一个时间管理系统，我在其中使用 Datagrid 列出任务/天，因此您可以记录在给定日期花费在给定任务上的时间。

我想要的是在每天的底部做一​​个总结。

```
| Tasks  | Moanday | Tuesday | Wednesday | Thursday | Friday |
| Task 1 |   1     |   1     |    0      |    0     |   0    |
| Task 2 |   2     |   0     |    0      |    0     |   0    |
| Task 3 |   3     |   2     |    0      |    0     |   0    |
         |   6     |   3     |    0      |    0     |   0    | 
```

有没有人有任何提示，关于如何添加类似页脚的效果，像这样？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T15:11:23.243

我建议你看看 DevExpress 的 agDataGridSuite。它支持摘要。他们提供这个网格作为免费下载。见[链接文字](http://www.devexpress.com/Products/NET/Controls/Silverlight/Grid/)

# random - 真（非伪）随机数生成器。外面有什么？

> ID：658622
> 
> 赞同：9
> 
> 时间：2009-03-18T15:00:02.443
> 
> 标签：random, hardware

我正在寻找能够生成真正随机数的经济实惠的解决方案。

我找到[了 LavaRnd](http://www.lavarnd.org/what/index.html)，它是一个加密健全的随机数生成器。有没有人在这个领域有经验和/或知道其他解决方案？

PS：恕我直言，SO问题[真正的随机数生成器](https://stackoverflow.com/questions/37702/true-random-number-generator)并没有真正涵盖这个

* * *

**编辑**：

我的好奇心更多的是学术性质。我**不想知道**对于实际应用来说足够好的 PRNG。我知道他们存在并且他们会这样做。

当然，生成真正的随机数需要硬件设备。这就是为什么我用*hardware*标记它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T15:15:22.860

您没有指定环境。

来自 Linux 的 /dev/random 的文档

> 随机数生成器将来自设备驱动程序和其他来源的环境噪声收集到一个熵池中。生成器还保持对熵池中噪声位数的估计。从这个熵池中创建随机数。

所以这是一个加密安全的随机源，基于来自以太网数据包的任意时间、键盘和鼠标输入等的不可预测的输入。

还有 Bruce Schneier 的[Yarrow](http://www.schneier.com/yarrow.html) PRNG 服务器。不是真正随机的，但被认为是加密安全的。

...还有[EGD](http://egd.sourceforge.net/)，熵收集守护进程。用 Perl 编写，因此可在许多平台上移植。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-18T16:51:40.883

我一直想购买[PCI 或 USB 量子随机数发生器](http://www.idquantique.com/products/quantis.htm)，但我不知道它们的价格，坦率地说，它可能很多！它们确实分别提供了惊人的 16 Mibit/s 和 4 Mibit/s 的随机数，但可在 *NIX 盒子和 Windows 上使用。这比我需要的多！

除此之外，一本装满它们的书怎么样？[一百万个随机数字和 100,000 个正态偏差](https://rads.stackoverflow.com/amzn/click/com/0833030477)可能是他们在亚马逊上卖的最酷的书！我还没有买，但这只是时间问题。在你的书架上有这么多真正的随机数一定非常方便！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-11-17T02:11:59.083

充分解决这个问题是一个广泛的话题。

存在硬件随机数生成器。这些使用热噪声甚至量子效应（在最快的模型中）来生成高质量的随机数。

有人怀疑热噪声随机数生成可能存在“偏差”。也就是说，从长远来看，某些数字的生成频率高于其他数字。生成的数字仍然是真正随机的。

要了解这是怎么回事，请考虑一个不公平的硬币，它有 60% 的时间出现正面。抛硬币仍然是一个随机过程——只是从长远来看，我们应该期望其中 60% 是正面。执行随机过程会编码信息或“熵”，因为任何确定的结果只是许多可能结果中的一种。另一方面，使用不公平硬币生成的正面和反面序列将包含比使用公平硬币生成的相同序列更少的信息！

结果是，为了可证明的、偏执级别的安全性，您不想直接使用硬件随机数生成器的数字。您想将它们输入熵池中，随机（但可能有偏差）数字可能会搅动。

事实上，大多数硬件随机数生成器都设计为通过内核（或 Windows 等价物）提供 /dev/random，以处理这种偏差/熵问题。

另一方面，任何体面的随机数生成器都足够均匀，可以快速进行蒙特卡罗模拟。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T15:26:45.780

c't 2/2009 中有一篇关于真随机数和伪随机数的文章。除了 LavaRnd，还讨论了 RandCam 和威盛的 PadLock。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T15:12:00.280

*计算中的真正*随机数不存在，也永远不会存在。计算机是确定性的，如果你在同样的环境下重复同样的经历，就会得到同样的结果。

您使用计算机获得的是伪随机数，主要取决于当前情况：日期、时间、其他变量（例如正在使用的内存、当前的网络流量等）。

例如，一些在线扑克网站，为了在一定程度上保证他们发牌的随机性，不得不安装特定的硬件来接收环境噪声并根据它生成随机数（不仅如此，它还是一个主要因素）。

因此，要获得接近真实随机性的伪随机数，您需要考虑外部因素。

# perl - 如何集成 Perl 和 Abyss Web Server？

> ID：658628
> 
> 赞同：2
> 
> 时间：2009-03-18T15:00:46.500
> 
> 标签：perl

我不知道 Perl。我什至不喜欢它，但我不得不使用用 Perl 编码的脚本。

我的 PC 上有 Abyss 网络服务器（我将它用于 .net 和 PHP），我想知道我是否可以简单地下载所需的文件并将它们链接到当前服务器；如果没有，有人可以将我链接到一个可以工作的简单 Perl 服务器。

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-18T15:04:19.547

查看[Aprelium 集成 ActiveState 和 Abyss 的说明](http://www.aprelium.com/abyssws/perl.html)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-18T15:26:01.010

您可能刚刚下载了**免费的** [Apache Server](http://httpd.apache.org/)来处理这项工作

# .htaccess - Joomla 和非 Joomla 子文件夹

> ID：658634
> 
> 赞同：1
> 
> 时间：2009-03-18T15:01:41.973
> 
> 标签：.htaccess, joomla

我在域的根级别安装了带有搜索友好 URL 的 Joomla，但我的主机允许我访问 domain.com/stats 中的网站统计信息（需要身份验证），我看不到它，只是一个Joomla 产生 404 错误。

我认为这可能是由于 .htaccess 所以我尝试将此行添加到顶部：

```
RewriteRule ^(/stats) - [L] 
```

但我仍然得到 404。这就是 .htaccess: 的其余部分的样子

```
##  Can be commented out if causes errors, see notes above.
Options +FollowSymLinks

#
#  mod_rewrite in use

RewriteEngine On

########## Begin - Rewrite rules to block out some common exploits
## If you experience problems on your site block out the operations listed below
## This attempts to block the most common type of exploit `attempts` to Joomla!
#
# Block out any script trying to set a mosConfig value through the URL
RewriteCond %{QUERY_STRING} mosConfig_[a-zA-Z_]{1,21}(=|\%3D) [OR]
# Block out any script trying to base64_encode crap to send via URL
RewriteCond %{QUERY_STRING} base64_encode.*\(.*\) [OR]
# Block out any script that includes a <script> tag in URL
RewriteCond %{QUERY_STRING} (\<|%3C).*script.*(\>|%3E) [NC,OR]
# Block out any script trying to set a PHP GLOBALS variable via URL
RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
# Block out any script trying to modify a _REQUEST variable via URL
RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2})
# Send all blocked request to homepage with 403 Forbidden error!
RewriteCond %{REQUEST_URI} !^/stats
RewriteRule ^(.*)$ index.php [F,L]
#
########## End - Rewrite rules to block out some common exploits

#  Uncomment following line if your webserver's URL
#  is not directly related to physical file paths.
#  Update Your Joomla! Directory (just / for root)

# RewriteBase /

########## Begin - Joomla! core SEF Section
#
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/index.php
RewriteCond %{REQUEST_URI} (/|\.php|\.html|\.htm|\.feed|\.pdf|\.raw|/[^.]*)$  [NC]
RewriteRule (.*) index.php
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization},L]
#
########## End - Joomla! core SEF Section 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-18T15:37:36.333

编辑：这些（直接在之后`RewriteEngine On`）有帮助吗？：

```
RewriteCond %{REQUEST_URI} ^/stats/.* [NC]
RewriteRule .* - [L] 
```

或者

```
RewriteCond %{ENV:REDIRECT_STATUS} 200 RewriteRule .* - [L] 
```

另外，尝试启用

```
RewriteBase / 
```

如果它仍然不起作用，并且您能够更改为服务器/虚拟主机配置，[请尝试记录重写过程](http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html#rewritelog)。

编辑结束

尝试添加一个

```
RewriteCond %{REQUEST_URI} !^/stats 
```

之前

```
RewriteRule ^(.*)$ index.php [F,L] 
```

# windows-vista - Windows Vista 中的交互式服务对话检测

> ID：658640
> 
> 赞同：2
> 
> 时间：2009-03-18T15:02:58.413
> 
> 标签：windows-vista, cruisecontrol.net

我已经在 Windows Vista 上安装了 cc.net 1.4.3 版本。但是当我执行测试时，它不断给我交互式服务对话框检测。我什至禁用了服务面板中的交互式服务。但仍然得到这个。

任何想法如何摆脱这个问题关于山姆

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T15:22:49.380

没有简单的解决方法可以做到。该服务正在尝试在用户桌面上弹出 UI。在 XP 中这是可行的，因为服务和第一个用户登录都在会话 0 中运行。在 Vista 中，服务在会话 0 中运行，第一个用户在会话 1 中运行，因此服务无法直接向用户显示 UI . 这是由于安全问题 - 搜索 Win32 Shatter Attack 以获取更多详细信息，但基本上不受信任的用户可以向服务发送格式错误的窗口消息，在某些情况下甚至可能导致任意代码执行。

您可以通过禁用系统上的“交互式服务检测”服务来完全禁用它。但是您根本不会看到通知，这将禁用所有交互式服务。最好的方法是向供应商投诉以更新他们的 Vista 软件。

编辑：当多个用户登录并且活动用户不在会话 0 中时，XP 上的软件会损坏。

# java - Java中的字符串索引集合

> ID：658644
> 
> 赞同：2
> 
> 时间：2009-03-18T15:03:59.410
> 
> 标签：java, collections

使用 Java，假设为 v1.6。

我有一个集合，其中唯一索引是一个字符串，非唯一值是一个 int。我需要尽快对这个集合执行数千次查找。

我目前正在使用 a`HashMap<String, Integer>`但我担心将 Integer 装箱/拆箱到 int 会使其变慢。

我曾想过使用一个`ArrayList<String>`加上一个`int[]`。

即代替：

```
int value = (int) HashMap<String, Integer>.get("key"); 
```

我可以做

```
int value = int[ArrayList<String>.indexOf("key")]; 
```

有什么想法吗？有没有更快的方法来做到这一点？

ps我只会构建一次集合，可能会修改一次，但每次我都会知道大小，所以我可以使用`String[]`而不是`ArrayList`但不确定是否有更快的方法来复制 indexOf...

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-18T15:08:23.173

拆箱速度很快 - 不需要分配。装箱可能较慢，因为它需要分配一个新对象（除非它使用池化对象）。

你确定你真的有问题吗？在您真正证明这是一个重大打击之前，不要使您的代码复杂化。我非常怀疑它是。

有可用于原始类型的集合库，但我会坚持使用 JRE 中的普通 HashMap，直到您分析并检查这是否会导致问题。如果它真的只是*成千上万*的查找，我非常怀疑这根本不会是一个问题。同样，如果您是基于查找而不是基于添加的（即您获取的次数比添加的次数多），那么装箱成本不会特别显着，只是拆箱，这很便宜。

我建议使用`intValue()`而不是强制转换将值转换为`int`虽然 - 它使 (IMO) 发生了什么更清楚。

编辑：要回答评论中的问题，`HashMap.get(key)`将比`ArrayList.indexOf(key)` *集合足够大时*更快。如果您实际上只有五个项目，那么列表可能会更快。我认为情况并非如此。

如果您真的，真的不想装箱/拆箱，请尝试[Trove](http://trove4j.sourceforge.net/) (TObjectHashMap)。还有[COLT](http://acs.lbl.gov/~hoschek/colt/)需要考虑，但我在那里找不到合适的类型。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-18T15:20:53.393

您无需装箱/拆箱而获得的任何性能提升都会被您需要使用 indexOf 方法的 for 循环显着抹去。

使用哈希映射。此外，您不需要 (int) 强制转换，编译器会为您处理它。

如果数组中有少量项目，数组就可以了，但是 HashMap 也是如此......

您可以快速查找数组的唯一方法（这*不是*一个真正的建议，因为它有太多问题）是如果您使用字符串的 hashCode 作为数组的索引 - 不要甚至不考虑这样做！（我之所以提到它，是因为您可能会通过谷歌找到一些谈论它的东西......如果他们不解释为什么它不好，请不要再阅读它！）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T15:08:14.390

我猜 HashMap 会提供更快的查找，但我认为这需要一些基准测试才能正确回答。

编辑：此外，不涉及装箱，只是对已存储的对象进行拆箱，这应该非常快，因为在该步骤中没有进行对象分配。所以，我认为这不会给你更多的速度，但你仍然应该运行基准测试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T15:10:19.097

我认为扫描您的 ArrayList 以找到您的“密钥”的匹配项将比您的装箱/拆箱问题慢得多。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-18T15:25:12.807

既然你说它确实是一个瓶颈，我会建议[Java 的 Primitive Collections](http://pcj.sourceforge.net/)；特别是，[ObjectKeyIntMap](http://pcj.sourceforge.net/docs/api/bak/pcj/map/ObjectKeyIntMap.html)看起来正是您想要的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-18T15:42:01.890

如果一次构建地图的成本无关紧要，您可能需要查看[完美哈希](http://en.wikipedia.org/wiki/Perfect_hash_function)，例如[Bob Jenkins 的代码](http://burtleburtle.net/bob/hash/perfect.html)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-18T15:09:02.767

这里有一个小问题：列表中可能有重复的元素。如果您真的想以第二种方式进行操作，请考虑使用 Set 代替。

话虽如此，您是否对两者进行了性能测试，看一个是否比另一个快？

编辑：当然，最流行的 Set 类型 (HashSet) 本身是由 HashMap 支持的，因此切换到 set 可能并不是一个明智的改变。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-18T15:17:52.510

`List.indexOf`将对列表进行线性扫描 - 通常为 O(n)。二进制搜索将在 O(log n) 中完成这项工作。哈希表将在 O(1) 中完成。

在内存中拥有大量`Integer`对象可能是个问题。但是对于`String`s（`String`和`char[]`）也是如此。您可以自己定制 DB 风格的实现，但我建议先进行基准测试。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-18T16:42:51.230

地图访问不会对查找进行拆箱，只有稍后对结果的访问才会使其变慢。

我建议为 int 引入一个带有 getter 的小型包装器，例如 SimpleInt。它保存 int 而不进行转换。构造函数并不昂贵，总体而言比整数便宜。

```
public SimpleInt
{
    private final int data;

    public SimpleInt(int i)
    {
        data = i;
    }

    // getter here
    ....
} 
```

# installation - 关于使用后台智能传输服务的问题

> ID：658652
> 
> 赞同：1
> 
> 时间：2009-03-18T15:05:39.577
> 
> 标签：installation, windows-installer, auto-update, microsoft-bits, bits-service

关于使用后台智能传输服务 (BITS) 作为向 Windows 应用程序添加自动更新功能的方案，我有几个问题。

1 - 如果用户禁用 Windows 更新进程，Windows 是否会禁用 BITS？

2 - BITS 如何与防火墙（硬件和软件）交互？

比如我安装了一个程序FOO.exe，当我把它连接到网络时，防火墙会提示我，询问我是否要允许Foo.exe访问网络。BITS 是否以这种方式提示，如果是，如何描述提示？

3 - 可以通过域级别的 GROUP POLICY 禁用/关闭 BITS 吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T18:56:22.923

1 - 不。BITS 是 Windows 更新服务所依赖的外部服务。

2 - BITS 是操作系统的一个内部方面，因此它本质上受到软件防火墙的信任。

3 - 是的。BITS 即服务受域的 GROUP POLICY 控制。

# c - 如何从 ac 程序内部调用 awk 或 sed？

> ID：658653
> 
> 赞同：5
> 
> 时间：2009-03-18T15:05:40.420
> 
> 标签：c, sed, awk, exec

如何在 ac 程序中调用 awk 或 sed？我知道我可以使用 exec()，但我不想处理 fork() 和所有其他的麻烦事。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-18T15:07:03.770

会`popen`工作吗？它产生进程，然后你用`FILE*`句柄读/写

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-18T15:07:02.990

然后你的选择是`system()`，或者使用一些为你包装进程生成的库。如果您想对错误、管道等进行精细控制，建议使用后者或您想要避免的核心方式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-18T15:22:04.140

system() 很简单。

但如果可以的话，你应该尽量不要这样做。当脚本在事物之上而不是在之下时，它们的效果最好。如果您在 UNIX 中，通常最好分解工作并编写一个顶级脚本来调用所有部分。

我记得看到一个程序员在他的 C 代码中添加了大量的系统调用，以避免学习 Bourne shell。他认为这是一个聪明而快速的方法，但当它失败时，它就失败了。他浪费了大量的时间来调试这个烂摊子。学习一些简单的shell命令会更快......

保罗。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T15:22:32.110

`libc`有函数`system`and `popen`，它的工作方式有点像这样：

```
int system(cont char *command) {
    const char *argv[4] = {"/bin/sh", "-c", command};
    int status;
    pid_t child = fork();
    if (child == 0) {
        execve(argv[0], argv, NULL);
        exit(-1);
    }
    waitpid(child, &status, 0);
    return status;
}

FILE *popen(const char *command, const char *type) {
    int fds[2];
    const char *argv[4] = {"/bin/sh", "-c", command};
    pipe(fds);
    if (fork() == 0) {
        close(fds[0]);
        dup2(type[0] == 'r' ? 0 : 1, fds[1]);
        close(fds[1]);
        execve(argv[0], argv, NULL);
        exit(-1);
    }
    close(fds[1]);
    return fdopen(fds[0], type);
} 
```

（除了更多的错误检查和东西）

如果您想更好地控制参数处理（而不是通过`sh`），或者您想控制多个`{stdin, stdout, stderr}`，您必须自己编写或查找库。但是标准库涵盖了大多数用例。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-18T15:30:45.397

您可以通过**system() 调用来**完成此[线程](http://www.unix.com/high-level-programming/29079-how-include-shell-script-c-program.html)是一个很好的例子

# networking - 流和 UDP

> ID：658654
> 
> 赞同：4
> 
> 时间：2009-03-18T15:05:53.303
> 
> 标签：networking

为什么 UDP 协议不像 TCP 协议那样支持流？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-18T15:18:04.600

其他人给出了非常好的答案，但我认为一个类比可能会有所帮助。

想象一下，UDP 有点像一个邮递员——把信从人们的门里送出去，但从不检查他们是否真的*看到*了这封信，或者这个人是否存在。这很便宜，并且适用于发送给许多人的垃圾邮件（阅读：广播数据包）。

TCP 更像是一个信使，他会亲自敲门并传递消息。如果你不在，他稍后会回来尝试。最终，您会收到消息 - 或者信使会知道他没有发送消息。您还可以通过信使将消息发回给发件人。

不要试图过多地解读我的类比——它*实际上*并不像TCP 中只有一个“信使”——但它可能有助于思考问题。特别是，假设您正在向某人发送一系列信件，他们必须按顺序阅读 - 这不能（可靠地）与邮递员一起工作，因为您可能会在您的门垫上找到 10 封信，不知道按什么顺序阅读它们。邮递员可能在途中也丢了一些 - 没有人会知道。这不是可靠流的合适基础。

（另一方面，它是报纸发行的一个很好的模式。如果你碰巧错过了一些，那不是问题——你仍然会得到后面的，到那时你会更感兴趣。这就是为什么一些流媒体*媒体*解决方案使用 UDP，尽管它没有提供可靠的实际流。）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-18T15:09:19.020

好 ...

UDP是一种数据报协议。它旨在让应用程序发送单独的数据报，而无需高级协议来控制发生的事情。

“流”是一个高级概念，因此 UDP 不可能支持。

许多应用程序最终会在 UDP 上重新实现部分 TCP，以获得它们所需的延迟、顺序独立性、错误处理和带宽的特定组合。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-18T15:35:58.457

原因很简单：它没有，因为它没有，因为那不是协议的设计目标之一。

使 UDP 作为流工作意味着添加 TCP 具有的几乎所有功能。你最终会得到两个相同的协议。有什么意义？

UDP 旨在成为最小的轻量级协议。它旨在补充 TCP。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T05:40:46.197

如果将“流”定义为 IP(& L4) 标头的 5 元组，则 UDP 确实支持流。我想您要传达的意思是 UDP 是否支持连接（在每个流中，也就是 5 元组，被视为逻辑连接），并且或多或少保证了属于该流的数据包传递的可靠性。然而，在 UDP 的情况下，尽管数据包是流（5 元组）的一部分，但没有努力确保可靠性，而是依靠底层网络层来进行正确的传递。如果失败了，就这样吧。Jon Skeet 的类比非常有道理。

# javascript - 将 Subversion 修订添加到包含的 Javascript 和 CSS 文件

> ID：658663
> 
> 赞同：2
> 
> 时间：2009-03-18T15:07:43.393
> 
> 标签：javascript, svn

我正在寻找将 Subversion 的修订号添加到我们包含的每个 .js 文件的名称中，因此每当更新 .js 文件时，浏览器都会自动获取新版本。我相信 Stackoverflow 可以做到这一点，但我想知道如何做到这一点。这是发布程序的一部分吗？关于如何使用 Subversion 工具实现这一点的任何提示？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-18T15:21:00.367

没有标准的方法让 Subversion 将修订添加到文件名。为此，请使用构建工具（例如[ant](http://ant.apache.org/)）和自定义目标。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-05T19:37:23.073

如果在声明标签的文件上设置 SVN 关键字“Revision”，则文字文本 $Revision$ 将成为 SVN 关键字。每次更新工作副本时，$Revision$ 都会更新为 $Revision 1234 $，其中 1234 是当前修订号。

请注意，我们在使用这种方法时遇到了 IE6 的问题。我们已经为我们的所有标签添加了（并对其应用了 SVN 修订关键字），因此每次我们将新的代码副本推送到我们的生产箱时，我们都知道所有客户都将获得当前修订。但是 IE6 有时会在这种情况下产生奇怪的错误；好像你错过了一些脚本标签。最后我们把它们删掉了，因为它给我们带来的 IE6 问题比它给我们解决的问题还多。

# .net - 从 Web 服务返回业务对象

> ID：658673
> 
> 赞同：2
> 
> 时间：2009-03-18T15:09:25.247
> 
> 标签：.net, web-services

想象一下，如果你愿意的话，下面的场景：

*   BusinessObjects.dll 包含一个类“BusinessObject”
*   WinClient 引用 BusinessObjects.dll
*   Web 服务引用 BusinessObjects.dll

Web Service 有一个方法：

```
public BusinessObject GetBusinessObject()
{
  BusinessObject result = new BusinessObject;
  result.Name = "MyBusinessObject";
  return result;
} 
```

该方法由 WinClient 调用。

当我添加对 WebService 的引用时，将创建一个代理类。因此，如果我像这样从 WinClient 访问 BusinessObject：

```
BusinessObject bObj = service.GetBusinessObject(); 
```

那么 bObj 不是 BusinessObject.dll 中的同一个对象，但实际上是代理。

此处记录了一种解决方法-http: [//ryanfarley.com/blog/archive/2004/05/26/737.aspx](http://ryanfarley.com/blog/archive/2004/05/26/737.aspx)

我的问题 - 这是个好主意吗？还是应该将服务返回的对象始终视为简单的 DTO？因此，如果我们想要逻辑，那么我们应该将值复制到 REAL 业务对象中。但是这样做会对性能造成什么影响 - 我应该担心吗？

欢迎任何反馈，谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T15:13:06.237

是的，总是使用 DTO 或类似的东西。

与数据将要遍历的网络的性能相比，在内存中复制数据的性能影响可能微不足道。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T15:13:39.043

这取决于服务的“纯度”是否重要。如果**唯一**的客户是你的 exe，那么我就不会感到压力；然后，您可以在客户端获得一个“智能”（如果您明白我的意思）对象（例如，实现`IDataErrorInfo`验证），而无需任何代码重复。

但是如果你需要支持 ad-hoc 客户端，你应该坚持使用基本的 DTO（代理对象）。

请注意，如果您想走这条路线（装配共享），那么您可以在 WCF 中执行此操作而无需任何更改；`svcutil`并且 IDE 提供了从现有程序集中重用类型的选项，尽管实际上您甚至不需要这个（您可以直接访问通道）。您所需要的只是 app.config 中正确的配置数据，因此它知道在哪里可以找到服务。

# c# - 如何在 Web 设置项目中创建新的应用程序池？

> ID：658675
> 
> 赞同：14
> 
> 时间：2009-03-18T15:09:57.163
> 
> 标签：c#, web-services, iis, iis-6, windows-installer

我需要部署我的网络服务。它需要使用自己的凭据在 IIS 中的单独应用程序池中运行。

是否可以通过在 VS 2008 中使用 Web 设置项目来做到这一点？

默认情况下，我似乎只能选择现有的应用程序池。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-21T18:33:35.460

查看这篇文章[http://forums.iis.net/t/1061734.aspx](http://forums.iis.net/t/1061734.aspx)，它将对 Microsoft.Web.Administration dll 提供一些粗略的了解。

我还没有研究过整个概念，但我想出了如何创建新池以及如何附加新网站/虚拟目录。

创建应用程序池

```
Microsoft.Web.Administration.ServerManager manager = new Microsoft.Web.Administration.ServerManager();
manager.ApplicationPools.Add("NewApplicationPool");
manager.CommitChanges(); 
```

附加现有的虚拟目录

```
Microsoft.Web.Administration.ServerManager manager = new Microsoft.Web.Administration.ServerManager();
Site defaultSite = manager.Sites["Default Web Site"];

// defaultSite.Applications will give you the list of 'this' web site reference and all
// virtual directories inside it -- 0 index is web site itself.

Microsoft.Web.Administration.Application oVDir = defaultSite.Applications["/myApp"];            
oVDir.ApplicationPoolName = "NewApplicationPool";
manager.CommitChanges(); 
```

这样，您可以使用自定义操作将应用程序池分配给您的新网站，覆盖安装程序类的提交方法。

如果仍然发现自己在挣扎，请告诉我，我会尝试发送代码。

问候 Faiyaz faiyazkhan@hotmail.com

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-18T15:43:52.603

我以前一直走这条路，不幸的是，您需要手动创建应用程序池或编写自定义操作来为您管理它。

除了 Grzenio 在下面的评论中提出的问题：

*“你能给我一个提示，从哪里开始寻找代码/帮助类？你是把你的项目保留为 Web 设置项目，还是只使用标准的应用程序设置项目？”*

我向`InstallHelper`包含安装项目的解决方案添加了一个新项目。在那个项目中，我创建了一个名为的类`InstallActions`，它源自：

[`System.Configuration.Install.Installer`(MSDN)](http://msdn.microsoft.com/en-us/library/system.configuration.install.installer.aspx)。

您可以在基类上覆盖四种方法，`Installer`以允许您根据安装程序运行时是否处于安装、提交、卸载或回滚阶段来指定自定义操作。

我还在设置项目用户界面中添加了一些文本框对话框。从这些对话中捕获的输入和状态通过字典传递给您的自定义安装操作。IE：

```
using System.Collections.Specialized;
using System.ComponentModel;
using System.Configuration.Install;
using System.Windows.Forms;

namespace InstallHelper
{
  [RunInstaller(true)]
  public partial class PostInstallActions : Installer
  {   
    public override void Install(IDictionary state)
    {
      base.Install(state);
      // Do my custom install actions
    }

    public override void Commit(IDictionary state)
    {
      base.Commit(state);
      // Do my custom commit actions
    }

    public override void Uninstall(IDictionary state)
    {
      base.Uninstall(state);
      // Do my custom uninstall actions
    }
    public override void Rollback(IDictionary state)
    {
      base.Uninstall(state);
      // Do my custom rollback actions
    }
  }
} 
```

要将您的自定义操作项目添加到设置项目，请打开自定义操作查看器/编辑器并指定`InstallHelper`项目的输出。

这是基础知识，应该让你开始。Web 设置项目还支持自定义操作和其他用户输入对话框，因此您可能希望在自定义操作之外重新使用现有项目。

# ms-office - 如何在 PowerPoint 2007 中禁用/删除菜单项“PowerPoint 选项”？

> ID：658678
> 
> 赞同：1
> 
> 时间：2009-03-18T15:10:14.543
> 
> 标签：ms-office, powerpoint, ribbon, office-automation

我正在尝试锁定 PowerPoint，我可以通过使用一些功能区自定义 xml 和组策略来摆脱一些命令。但我需要删除或禁用另外两个选项。

**PowerPoint 选项**- 当您单击 Office 图标时显示此按钮

此项目在 Word（Word 选项）和 Excel（Excel 选项）中也有，所以应该是同一个解决方案。

在 Office 2003 中，我可以通过从 _pptApplication.CommandBars 中删除对象来删除我想要的任何项目。

**更新：**我现在可以[使用组策略禁用快速访问工具栏](http://technet.microsoft.com/en-us/library/cc179081.aspx)。但我在“PowerPoint 选项”中找不到任何东西。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-24T14:50:10.287

似乎没有“官方”方法可以做到这一点，所以我为我的（受控）环境创建了一个解决方法。

基本上，我会检查屏幕何时“办公球”变成深橙色，然后在“PowerPoint 选项”按钮所在的位置显示最上面的表单。

我有人有更好的解决方案，我想**知道**！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-08-18T12:50:42.940

它可以在 PowerPoint/Office 2007 中使用一些 customUI-xml 和 ID“ApplicationOptionsDialog”被禁用（不隐藏）；见[http://excelusergroup.org/blogs/nickhodge/archive/2008/02/03/ribbon-step-by-step-part-3-the-office-menu-and-re-purposing.aspx](http://excelusergroup.org/blogs/nickhodge/archive/2008/02/03/ribbon-step-by-step-part-3-the-office-menu-and-re-purposing.aspx)

```
<?xml version="1.0" encoding="utf-8"?>
<customUI xmlns="http://schemas.microsoft.com/office/2009/07/customui">
    <commands>
        <command idMso="ApplicationOptionsDialog" enabled="false"/>
    </commands>
</customUI> 
```

在 PowerPoint/Office 2010 中也可以隐藏；见[http://www.rondebruin.nl/backstage.htm](http://www.rondebruin.nl/backstage.htm)

```
<?xml version="1.0" encoding="utf-8"?>
<customUI xmlns="http://schemas.microsoft.com/office/2009/07/customui">
    <commands>
        <command idMso="ApplicationOptionsDialog" enabled="false"/>
    </commands>
    <backstage>
        <button idMso="ApplicationOptionsDialog" visible="false"/>
    </backstage>
</customUI> 
```

# html - 如何将标签与单选按钮相关联

> ID：658689
> 
> 赞同：36
> 
> 时间：2009-03-18T15:12:00.060
> 
> 标签：html, asp.net-mvc

我正在使用 MVC，并且我有一个简单的单选按钮设置：

```
<%=Html.RadioButton("my_flag", True)%><label>Yes</label>
<%=Html.RadioButton("my_flag", False)%><label>No</label> 
```

我唯一缺少的是您无法单击标签来选择单选按钮。通常你会使用：

```
<label for="my_flag"> 
```

但这将两个标签与最后一个单选按钮相关联。有没有办法将标签与正确的单选按钮相关联？

注意：这是模仿纸质表格，因此不能切换到复选框。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-03-18T15:27:04.470

您有两种不同的方法来实现这一点。

第一个是简单的解决方案是将单选按钮嵌入`<label/>`标签内。

```
<p>
    <label><%=Html.RadioButton("option", "yes") %> Yes</label>
</p>

<p>
    <label><%=Html.RadioButton("option", "no") %> No</label>
</p> 
```

第二条路径是将每个单选按钮与一个 ID 相关联。这个`htmlAttributes`参数也很简单，它允许在表单布局方面有更大的灵活性：

```
<p>
    <label for="option_yes">Yes:</label>
    <%=Html.RadioButton("option", "yes", new { id = "option_yes" }) %>
</p>

<p>
    <label for="option_no">Np:</label>
    <%=Html.RadioButton("option", "no", new { id = "option_no" }) %>
</p> 
```

我会推荐后者，它似乎也是您所要求的。

**编辑**

实际上，无论如何，您都应该使用 ID 属性给出参数。如果您不这样做，您的站点将有多个具有相同 ID 的元素，这会导致 HTML 验证失败。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-03-18T15:14:58.993

您需要为这两个单选按钮提供相同的**名称**（以便它们在同一组中），但使用不同的**ID**（以便您可以将标签与每个单独关联）。我不熟悉 ASP.NET MVC，所以我不知道如何实际完成这个，但这就是解决方案。

编辑：第二种可能性是将单选按钮包装在标签标签内，如下所示：

```
<label><%=Html.RadioButton("my_flag", True)%>Yes</label>
<label><%=Html.RadioButton("my_flag", False)%>No</label> 
```

** 请注意，这种方式实际上可能具有更好的浏览器兼容性，我知道有些浏览器仍然对名称/id的区别感到困惑*

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-03-18T15:15:59.833

我不是 asp 程序员，很抱歉，如果我会告诉你一些事情：P

标签的属性被引用到输入的 id。所以你将不得不做类似的事情

```
<input type="radio" name="rad1" id="rad1_1"><label for="rad1_1">Rad1</label>
<input type="radio" name="rad1" id="rad1_2"><label for="rad1_2">Rad2</label> 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2015-06-10T14:31:48.923

你可以这样做：（这是使用 Razor，但很容易翻译。）

```
@Html.RadioButtonFor(model => model.MyValue, true, new { id = "MyValue_True" })
<label for="MyValue_True">Yes, this is true</label>

@Html.RadioButtonFor(model => model.MyValue, false, new { id = "MyValue_False" })
<label for="MyValue_False">No, this is false</label> 
```

基本上，您手动指定`id`单选按钮的属性。

# sql - 如何从两个表中选择不包含在映射表中的值？

> ID：658691
> 
> 赞同：3
> 
> 时间：2009-03-18T15:12:24.490
> 
> 标签：sql, sql-server, stored-procedures, subquery, nested-queries

可以说我有以下表格：

*   顾客
*   产品
*   客户产品

有没有办法从客户和产品表中进行选择，其中值不在映射表中？基本上我需要一份他们不拥有的客户和产品的匹配列表。

另一个转折点：我需要为每个产品配对一个客户。所以如果 5 个客户没有产品 A，那么只有查询中的第一个客户应该有产品 A。所以结果看起来像这样：

（假设所有客户都拥有产品 B，并且不止一个客户拥有产品 A、C 和 D）

1.  客户 1，产品 A
2.  客户 2，产品 C
3.  客户 3，产品 D

最后的转折：我需要将此查询作为 SQL Sever 中 UPDATE 语句的一部分运行。所以我需要从第一行取值：

客户 1，产品 A

并将客户记录更新为类似

```
UPDATE Customers
SET Customers.UnownedProduct = ProductA
WHERE Customers.CustomerID = Customer1ID 
```

但如果我能在一个 SQL 语句中完成整个过程，那就太好了。所以我运行了一次查询，它用他们不拥有的产品更新了 1 个客户。希望这不会让您感到困惑！提前致谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T15:22:39.443

```
WITH q AS
        (
        SELECT  c.*, p.id AS Unowned,
                ROW_NUMBER() OVER (PARTITION BY p.id ORDER BY c.id) AS rn
        FROM    Customers c
        CROSS JOIN
                Products p
        LEFT JOIN 
                CustomerProducts cp
        ON      cp.customer = c.id
                AND cp.product = p.id
        WHERE   cp.customer IS NULL
        )
UPDATE  q
SET     UnownedProduct = Unowned
WHERE   rn = 1 
```

`UPDATE`声明将更新第*一个*不拥有特定产品的客户。

如果要选择列表，则需要：

```
SELECT  *
FROM    (
        SELECT  c.*, p.id AS Unowned,
                ROW_NUMBER() OVER (PARTITION BY p.id ORDER BY c.id) AS rn
        FROM    Customers c
        CROSS JOIN
                Products p
        LEFT JOIN 
                CustomerProducts cp
        ON      cp.customer = c.id
                AND cp.product = p.id
        WHERE   cp.customer IS NULL
    ) cpo
WHERE   rn = 1 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T15:23:00.533

如果您一次只更新一个客户，您可能需要记住哪些产品是自动分配的（在 CustomerProducts 中）或有一个计数器自动分配产品的频率（在 Products 中）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T16:25:35.127

我在 oracle 中试过这个（希望它也适用于你）

```
UPDATE customers c
   SET unownedProduct =
       ( SELECT MIN( productid )
           FROM products
          WHERE productid NOT IN (
              SELECT unownedProduct
                FROM customers
               WHERE unownedProduct IS NOT NULL )
            AND productid NOT IN (
              SELECT productid
                FROM customerProducts cp
               WHERE cp.customerId = c.customerid )
       )
 WHERE customerId = 1 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T17:29:12.070

What if the customer doesn't own more than one product? and how are you going to maintain this field as the data changes? I thinkyou really need to do some more thinking about your data structure as it doesn't make sense to store this information in the customer table.

# asp.net - 如何使用 ScriptManager 在另一个项目中引用 Web 服务？

> ID：658693
> 
> 赞同：0
> 
> 时间：2009-03-18T15:13:22.867
> 
> 标签：asp.net, ajax, web-services, asp.net-ajax

我有一个 Web 应用程序项目和一个 Web 服务应用程序项目。我正在使用 ASP.Net AJAX，我想从 Web 服务项目中引用一个名为 Tickets.asmx 的服务并使用 JavaScript 调用它。（我在页面上的 ScriptManager 中引用它[或试图]）

我之前已经将 Web 服务作为 asp.net Web 应用程序的一部分进行了此操作，但在其他项目中没有这样做。无论我做什么，我都会收到 [namespace] undefined javascript 错误。

我可能做错了什么？我什至尝试将服务的完整路径放在 ScriptManager 中（类似于[http://localhost:4080/Tickets.asmx](http://localhost:4080/Tickets.asmx)）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T22:54:31.010

我已经确定这是不可能的。JavaScript 不能调用另一个域，因此 ASP.Net AJAX 根本不支持外部 Web 服务。

# windows - 用于网站的 Windows Server 2008 SMTP 服务

> ID：658695
> 
> 赞同：0
> 
> 时间：2009-03-18T15:14:15.030
> 
> 标签：windows, windows-server-2008

我正在开发需要向客户发送电子邮件的.net 应用程序。我试图弄清楚发送电子邮件的最佳解决方案是什么。这是我考虑过的。**您能否建议最好的方法是什么？**

```
1>Windows server 2008 in built smtp
service.

2>Exchange server hosted in our
datacenter.

3>Use google apps for sending
emails(Basically same as gmail like
for custom domain). 
```

我已经探索了所有选项，以下是调查结果。

```
1>I think would be way to go. Also
supports drop in directory to send
emails so can achieve disconnected
email activity.

2>Application would be tied up with
availability of exchange server and
we dont have any exchange server
support personal. Only developers
poke around in exchange server and
got it working. So if option 1 is as
good as 2 then would like to go with 1\. 
Is there any drop in directory feature in exchange server like 1?

3>Tried gmail smtp stuff didnt
work. I was receiving timeout error.
Also there is no guarantee that
gmail will send our mail
reliability. They can decide anytime
to stop sending our mails as we are
using free standard version of
google apps. 
```

**其他问题：** 我在 windows server 2008 中安装了 smtp 服务。现在要使用它，我需要更改任何 MX 记录吗？我需要做的是，它可以使用我的域名发送电子邮件。或者它可以为任何域发送电子邮件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T15:19:40.917

我会使用 1 和 2 的混合。使用本地 SMTP，但让它中继到您的交换服务器。如果电子邮件无法中继以进行交换，并且您有一台服务器可以处理所有传出/传入邮件，则电子邮件将排队。此支持文档解释了此设置：http: [//support.microsoft.com/kb/303734](http://support.microsoft.com/kb/303734)

如果您也将接收来自该域的邮件，则只需要 MX 记录。

我还会为您的域添加一个反向 DNS 条目，这将有助于垃圾邮件检测。

# objective-c - 如何访问另一个类的变量？

> ID：658697
> 
> 赞同：9
> 
> 时间：2009-03-18T15:14:27.590
> 
> 标签：objective-c, cocoa, class, import

可能有一个非常简单的解决方案，但我无法让它工作。

我的 Cocoa 文件中有多个类。在其中一个类中，`class1`我创建了一个也需要在另一个类中使用的变量`class2`。有没有一种简单的方法来导入这个变量`class2`？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-18T15:25:13.180

您可以将变量设为公开，也可以将其设为属性。例如，将其公开：

```
@interface Class1
{
@public
    int var;
}
// methods...
@end

// Inside a Class2 method:
Class1 *obj = ...;
obj->var = 3; 
```

使其成为属性：

```
@interface Class1
{
    int var;  // @protected by default
}
@property (readwrite, nonatomic) int var;
// methods...
@end

@implementation Class1
@synthesize var;
...
@end

// Inside a Class2 method:
Class1 *obj = ...;
obj.var = 3;  // implicitly calls [obj setVar:3]
int x = obj.var;  // implicitly calls x = [obj var]; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-18T15:26:01.820

您可以将 class2 中的变量作为属性公开。如果 class1 具有对 class2 的引用，则 class1 可以看到该变量。不过，老实说，听起来您是 Objective-C 和面向对象编程的初学者。我建议你阅读更多关于两者的内容。

[这是](http://developer.apple.com/documentation/Cocoa/Conceptual/OOP_ObjC/Introduction/Introduction.html)使用 Objective-C 进行面向对象编程的起点。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-01-15T23:36:53.697

尝试创建一个文件来保存需要在整个应用程序中访问的变量。

```
extern NSString *stringVariable;

@interface GlobalVariables

@property (retain, nonatomic) NSString *stringVariable;    

@end 
```

并在 GlobalVariables.m 文件中添加

```
#import "GlobalVariables.h"

@implements GlobalVariables

@synthesize stringVariable;

NSString *stringVariable;

@end 
```

然后，只要您将 GlobalVariables.h 导入到您需要访问该变量的任何 .m 文件中，您就可以在整个程序中的任何位置分配和访问。

**编辑**

我上面给出的答案与我现在要做的不同。它会更像

```
@interface MyClass

@property (nonatomic, strong) NSString *myVariable;

@end 
```

然后在 .m 文件中

```
@implementation MyClass

@sythesize = myVariable = _myVariable; // Not that we need to do this anymore

@end 
```

然后在另一个类中以某种方法我会

```
// .....
MyClass *myClass = [[MyClass alloc] init];
[myClass setMyVariable:@"My String to go in my variable"];
// ..... 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-11-12T03:32:28.333

在“XCode”中，您需要进行导入，通过将其声明为属性来创建对象，然后使用“object.variable”语法。文件“Class2.m”将如下所示：

```
#import Class2.h
#import Class1.h;

@interface Class2 ()
...
@property (nonatomic, strong) Class1 *class1;
...
@end

@implementation Class2

//accessing the variable from balloon.h
...class1.variableFromClass1...;

...
@end 
```

谢谢！:-)

# asp.net - 跨域会话，同一应用程序 (ASP.NET)

> ID：658698
> 
> 赞同：3
> 
> 时间：2009-03-18T15:14:36.917
> 
> 标签：asp.net

如何保留域之间的会话？它们都属于同一个 asp.net-application。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T15:20:26.467

如果没有自定义实现，我认为您无法做到这一点。您的会话 ID 存储在浏览器中的 cookie 中，并随每个请求发送回服务器。这就是服务器如何知道你是谁以及哪个会话对象是你的。当您切换域时，浏览器不再发送此 cookie（cookie 是按域发送的，因此服务器将永远不会看到原始会话 cookie，因此会为新域生成新的会话 cookie）。

我不知道您的应用程序架构与用户何时从一个域转到另一个域相关，但您可能只能在用户每次第一次访问每个域时向浏览器发送一个通用 cookie 并使用用于关联服务器上的内存对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T15:29:15.387

假设您在托管应用程序的网站的主机标头中指定了多个域，并且应用程序驻留在不使用任何形式的网络花园的应用程序池中，它将由单个工作进程 w3wp 提供服务。可执行程序。只要您的 web.config 没有指定要存储在 outproc 中而不是 inproc 的会话，那么会话数据将可用于驻留在应用程序中的所有代码。

# c# - 使用正则表达式从字符串中提取子字符串

> ID：658710
> 
> 赞同：2
> 
> 时间：2009-03-18T15:17:00.097
> 
> 标签：c#, regex

想象一下，用户正在多台计算机中插入字符串。

在一台计算机上，配置中的模式将提取该字符串的一些字符，例如位置 4 到 5。在另一台计算机上，提取模式将返回其他字符，例如，字符串的最后 3 个位置。

这些配置（Regex 模式）对于每台计算机都是不同的，管理员应该可以更改，而无需更改源代码。

一些例子：

```
 Original_String       Return_Value
User1 -  abcd78defg123         78
User2 -  abcd78defg123         78g1
User3 -  mm127788abcd          12
User4 -  123456pp12asd         ppsd 
```

可以用正则表达式完成吗？谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-18T15:18:47.953

为什么要为此使用正则表达式？出什么问题了：

```
string foo = s.Substring(4,2);
string bar = s.Substring(s.Length-3,3); 
```

（您可以将它们包装起来以轻松地对长度进行一些边界检查）

如果你真的想要，你可以把它包起来`Func<string,string>`放在某个地方——不过我不确定我会打扰：

```
Func<string, string> get4and5 = s => s.Substring(4, 2);
Func<string,string> getLast3 = s => s.Substring(s.Length - 3, 3);
string value = "abcd78defg123";
string foo = getLast3(value);
string bar = get4and5(value); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-18T15:22:45.837

如果你真的想使用正则表达式：

```
^...(..) 
```

和：

```
.*(...)$ 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T15:19:27.343

我不确定您希望通过使用 RegEx 获得什么。RegEx 用于模式匹配。如果要根据位置提取，只需使用子字符串。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T15:20:35.093

在我看来，Regex 真的不是这里的解决方案。要返回从位置*pos*（从 0 开始）且长度为*length*的字符串部分，您只需调用 Substring 函数，如下所示：

```
string section = str.Substring(pos, length) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-18T15:20:45.327

分组。您可以在 /^.{3}(.{2})/ 上进行匹配，然后查看 $1 组。

问题是为什么？正常的字符串处理，即实际的子字符串方法将在意图上更快更清晰。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-18T15:58:16.347

要让正则表达式捕获值以供进一步使用，您通常使用 ()，这取决于正则表达式编译器它可能是 () 或对于 microsoft MSVC，我认为它是 []

例子

```
User4 -  123456pp12asd         ppsd 
```

最有趣的是你在这里有 2 个单独的捕获区域。是否有一些关于如何将它们连接在一起的默认规则，或者您是否希望能够指定如何生成结果？

也许像

```
r/......(..)...(..)/\1\2/  for ppsd
r/......(..)...(..)/\2-\1/ for sd-pp 
```

你想运行一个正则表达式来获取捕获并自己处理它们，还是你想运行更高级的操作命令？

# c++ - wxWidgets：使用 wxGLCanvas/wxGLContext 崩溃

> ID：658714
> 
> 赞同：1
> 
> 时间：2009-03-18T15:18:06.893
> 
> 标签：c++, wxwidgets

至少在 Windows XP 上的 wxWidgets 2.8.9 和 2.8.10 会发生这种情况，没有在其他 patforms 上测试：

我有两个 dll，a.dll 和 b.dll，它们是在主机定序器中运行的 VST 插件。他们使用 wxWidgets 和 OpenGL。在初始化时，我在两个插件中都调用它（但 m_width 和 m_height 不同）：

```
MyControl(..)
{
    ..
    m_canvas = new wxGLCanvas(this, wxID_ANY, 0, wxPoint(0, 0), wxSize(m_width, m_height));
    m_context = new wxGLContext(m_canvas);
    ..
    m_canvas->SetCurrent(*m_context);
}

void MyControl::onPaint(wxPaintEvent& event)
{
    m_canvas->SetCurrent(*m_context);
    wxPaintDC dc(m_canvas);
    ..
    m_canvas->SwapBuffers();
} 
```

只要我只打开 a.dll 或 b.dll，它就可以正常工作。此外，打开 a.dll 或 b.dll 的多个实例也可以正常工作。但是，一旦我同时打开 a.dll 和 b.dll，主机定序器在调用此行后立即关闭（即使在调试时）：

```
m_canvas->SetCurrent(*m_context); 
```

这就是我在输出中可以看到的：

```
"host.exe": "D:\something\b.dll" geladen, Symbole wurden geladen.
14:49:02: ..\..\src\msw\app.cpp(364): 'RegisterClass(frame)' failed with error 0x00000582 (klasse ist bereits vorhanden).
14:49:03: ..\..\src\msw\app.cpp(373): 'RegisterClass(no redraw frame)' failed with error 0x00000582 (klasse ist bereits vorhanden).
14:49:03: ..\..\src\msw\app.cpp(383): 'RegisterClass(MDI parent)' failed with error 0x00000582 (klasse ist bereits vorhanden).
14:49:03: ..\..\src\msw\app.cpp(392): 'RegisterClass(no redraw MDI parent frame)' failed with error 0x00000582 (klasse ist bereits vorhanden).
.... 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T22:02:40.243

输出中的错误消息似乎表明您已将 wxWidgets 静态链接到两个插件中。只要您只加载一个插件，甚至多次加载，这将起作用，因为 wxWidgets 库将只初始化一次。

但是，如果您在第一个插件仍然加载的情况下尝试加载第二个插件，那么第二个插件中 wxWidgets 的初始化将失败，因此迟早会崩溃。

您应该使用 wxWidgets 动态链接这两个插件。谷歌 wxWidgets 和插件/可加载模块，你应该能够找到关于这个问题的更多信息。

# php - 如何在 PHP 和 MySQL 中生成循环赛？

> ID：658727
> 
> 赞同：6
> 
> 时间：2009-03-18T15:20:20.790
> 
> 标签：php, mysql

我需要使用循环算法生成游戏序列。我有一个 php 页面，用户可以在其中输入将插入数据库的锦标赛名称，并且它有一个下拉菜单，最多 32 支球队（选择球队数量）。

因此，如果我在页面中选择 4 支球队，那么将从 1 队到 4 队，这将是 6 场比赛，因为每支球队都与另一支球队比赛一次。我知道算法是如何工作的，但我不太确定如何为此编写查询。

我创建了表团队：

```
Team_id    01     02     03     etc
Team_name  Team1  Team2  Team3  etc. 
```

我应该从这里做什么？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2012-04-27T04:31:30.800

I created a roundrobin function from scratch as i thought it might be easier to get the same results and also allowing me to use arrays filled with strings directly instead of numbers.

Because i pull a list of names from a database and add into an array i can now schedule this directly with below function. No extra step needed to link numbers to names etc.

Please feel free to try it and if it works then leave a comment. I also have a version which allows for 2 way (home & return) schedule and or shuffle option. If somone is interested in that one then leave a coment as well.

```
<?php

/**
 * @author D.D.M. van Zelst
 * @copyright 2012
 */

function scheduler($teams){
    if (count($teams)%2 != 0){
        array_push($teams,"bye");
    }
    $away = array_splice($teams,(count($teams)/2));
    $home = $teams;
    for ($i=0; $i < count($home)+count($away)-1; $i++){
        for ($j=0; $j<count($home); $j++){
            $round[$i][$j]["Home"]=$home[$j];
            $round[$i][$j]["Away"]=$away[$j];
        }
        if(count($home)+count($away)-1 > 2){
            array_unshift($away,array_shift(array_splice($home,1,1)));
            array_push($home,array_pop($away));
        }
    }
    return $round;
}
?> 
```

How to use, for example create an array like:

```
<?php $members = array(1,2,3,4); ?> 
```

or

```
<?php $members = array("name1","name2","name3","name4"); ?> 
```

then call the function to create your schedule based on above array:

```
<?php $schedule = scheduler($members); ?> 
```

To display the resulted array schedule simply do like below or anyway you like: This little code displays the schedule in a nice format but use it anyway you like.

```
<?php
foreach($schedule AS $round => $games){
    echo "Round: ".($round+1)."<BR>";
    foreach($games AS $play){
        echo $play["Home"]." - ".$play["Away"]."<BR>";
    }
    echo "<BR>";
}
?> 
```

Leave a note if it worked for you or if you are interested in the 2-way version with shuffle.

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-18T15:32:24.130

循环比赛有一个相当简单的算法，我的解决方案如下（伪代码）：

*   以任意顺序将所有团队从数据库中取出到一个数组中
*   for (i = 1; i < 团队数; i++)
    *   打印第 #i 轮比赛：
    *   前半场的球队与后半场的球队以相同的顺序进行匹配。也就是说，任何索引 [n] 的团队与索引 [n + 一半团队数量] 的团队匹配。如果您有 32 个团队，则 [0] 与 [16] 匹配，[1] 与 [17] 匹配，等等直到 [15] 和 [31]。
    *   现在，通过阵列“轮换”团队，**但保留阵列中的第一个**。也就是说，[1] 变为 [2]，[2] 变为 [3]，...，直到 [31] 变为 [1]，但不要移动索引 [0] 处的团队。

就是这样，它将产生您需要的所有对决。

一个例子，有 4 个团队：

阵列的前半部分在顶部，后半部分在底部，比赛是彼此上方/下方的数字。数组索引（为了说明我的意思）：

```
[0] [1]
[2] [3] 
```

第1轮：

```
1 2
3 4 
```

第 2 轮：

```
1 4
2 3 
```

第三轮：

```
1 3
4 2 
```

# apache-flex - “出售” trac/buildbot/etc 给高层管理人员

> ID：658731
> 
> 赞同：7
> 
> 时间：2009-03-18T15:20:48.900
> 
> 标签：apache-flex, project-management, continuous-integration, trac, buildbot

我的团队主要使用基于 Flex 的应用程序。话虽如此，几乎没有任何约定（甚至让它们重构本身就是一个奇迹）等等。

来自 .NET + CruiseControl.NET 背景，我一直渴望让每个人都使用一些像样的跟踪软件（我们现在使用的是用 PHP 编码的待办事项列表）和 CI；我认为 trac+BuildBot 将是一个不错的选择。

您将如何说服高层管理人员相信这是要走的路，以及本文中提到的一些[规则](https://stackoverflow.com/questions/513953/i-am-compiling-a-rules-of-programming-mindset-for-my-team-what-are-yours)？我的主要问题之一是每个人都在不假思索的情况下编码（你会惊讶于这种产生的“逻辑”类型......）

谢谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-18T15:48:35.400

你现在有什么不需要别人许可的事情吗？您是否可以先将 trac/buildbot/etc 用于您自己的工作，然后根据他们的兴趣添加其他人？

以我的经验，你可以通过不问而走得很远。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-18T16:04:07.127

告诉管理层，使用这样的工具，他们将能够更好地关注进度。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-22T18:16:17.330

您建议您可以向他们展示而无需他们购买的路线是否有特定的好处？

我有让我的团队接受 maven + Cruisecontrol CI 设置的经验。基本上我试图让他们接受它几天，但他们一直犹豫不决，因为它不熟悉。然后我自己做了，所有损坏的构建都通过电子邮件发送到邮件列表。那天晚上，项目负责人进行了一次检查，破坏了构建（他只是忘记了一个文件），当然，每个人都收到了他搞砸的电子邮件。

第二天他走过来对我说：“我现在明白了。”

他毫不费力地参与其中，并免费看到了好处。

# asp-classic - 在经典 ASP 中创建地图的最佳方式

> ID：658738
> 
> 赞同：0
> 
> 时间：2009-03-18T15:22:14.683
> 
> 标签：asp-classic, maps

我目前正在将一些 PHP 4 代码重写为 Classic ASP（不要问），并尝试确定是否有更好的方法将大型 Map 加载到内存中，而不仅仅是硬编码每一对。

为了让您了解一下，PHP 中的散列数组定义（或任何名称）中有大约 300 个唯一键值对。
我很想在 ASP 中再次这样做，例如：

```
<%
dim map
set map = CreateObject("Scripting.Dictionary")
map.add('key','value')
map.add('key2','value2')
...
%> 
```

每次调用都会将此地图加载到内存中，还有其他更快的方法吗？唯一使用映射的时间是找出参数是否与其中一个键匹配 - 如果匹配，则将值拉出并返回。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T15:41:22.657

如果您使用的是经典 ASP，那么您将不得不依赖这些对象之一。使用数据库表或 XML 是您可以探索的其他选项。

如果您将其用于大约 300 个项目，我建议您确保不要一次又一次地调用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T17:26:57.443

我刚刚发现了一个全局 ASP 缓存，它允许我构建地图一次，将其放入缓存中，并且任何未来的请求都可以简单地将其从缓存中拉出。缓存保存在内存中，因此性能应该会显着提高。

```
<%
Application.Contents(object here)
%> 
```

干杯

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T20:59:18.477

那么在继续项目之前，您需要了解 ASP 中的 Application 和 Session 对象。我假设您有理由将其保留在全局缓存之外（例如必须根据用户偏好不断更新对象的内容）

祝一切顺利

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-30T22:59:03.013

就像 schar 所说，将字典对象存储在 Application 对象中。

# c# - 使用 RedirectToAction 时如何维护 ModelState 错误？

> ID：658747
> 
> 赞同：26
> 
> 时间：2009-03-18T15:24:03.230
> 
> 标签：c#, asp.net, asp.net-mvc

我有一些代码可以在我们的系统中保存一张票。如果有错误，它会执行`RedirectToAction()`. 问题是我在新动作中似乎没有错误。我怎样才能解决这个问题？

```
 ModelState.AddModelError("_FORM", "Unable to save ticket");
 ModelState.AddModelError("_FORM", "Phone number was invalid.");
 ModelState.AddModelError("_FORM", "Lane number is required.");
 return RedirectToAction("CreateStep", "Ticket"); 
```

我知道有些人建议使用`TempData`，但我将如何解决每个错误`ModelState`？

谢谢。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-11T22:18:44.663

PRG 模式没问题，但我这样做了：

基本控制器：

```
protected override void OnActionExecuted(ActionExecutedContext filterContext)
{
    if (TempData["ModelState"] != null && !ModelState.Equals(TempData["ModelState"]))
        ModelState.Merge((ModelStateDictionary)TempData["ModelState"]);

    base.OnActionExecuted(filterContext);
} 
```

行动（我正在使用[xVal](http://www.codeplex.com/xval)）：

```
try
{
    user.Login();
    AuthenticationManager.SignIn(user);
}
catch (RulesException rex)
{
    // on bad login
    rex.AddModelStateErrors(ModelState, "user");
    TempData["ModelState"] = ModelState;
    return Redirect(Request.UrlReferrer.ToString());
} 
```

该操作引发异常，添加`ModelState`到`TempData`并重定向回引荐来源网址。由于动作被捕获，`OnActionExecuted`仍然被执行，但第一次周围`ModelState`是相同的`TempData["ModelState"]`，所以你不想与自己合并。执行重定向操作时，`OnActionExecuted`再次触发。这一次，如果有任何东西`TempData["ModelState"]`，它会与这个动作的 ModelState 合并。

您可以通过使用`TempData["ModelState.user"] = ModelState`然后合并每个`TempData`以`ModelState.`.

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2011-11-18T21:12:14.567

我知道这个线程很旧，但是[这个关于 ASP.NET 最佳实践的博客](http://weblogs.asp.net/rashid/archive/2009/04/01/asp-net-mvc-best-practices-part-1.aspx#prg)有一些很好的建议。
页面上的 #13 处理使用 2 个操作过滤器`ModelState`在重定向之间保存和恢复。

这是我的工作使用的模式，我喜欢它。

这是简化的示例：

```
[ImportModelStateFromTempData]
public ActionResult Dashboard()
{
    return View();
}

[AcceptVerbs(HttpVerbs.Post), ExportModelStateToTempData]
public ActionResult Dashboard(string data)
{
    if (ValidateData(data))
    {
        try
        {
            _service.Submit(data);
        }
        catch (Exception e)
        {
            ModelState.AddModelError(ModelStateException, e);
        }
    }

    return RedirectToAction("Dashboard");
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-24T12:02:45.870

这篇博文描述了如何在 MVC 中实现 PRG 模式 [http://blog.simonlovely.com/archive/2008/11/26/post-redirect-get-pattern-in-mvc.aspx](http://blog.simonlovely.com/archive/2008/11/26/post-redirect-get-pattern-in-mvc.aspx)

hth

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-18T20:55:35.460

使用 TempData[] 集合

临时数据从一个请求存储到下一个请求，然后就消失了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-11-15T22:30:22.467

无论我去哪里重定向，我为维护我的 ModelState 所做的事情如下：

1.  在您的模型中，添加：

    ```
    public ModelStateDictionary modelstate { get; set; } 
    ```

2.  在模型的构造函数中，添加：

    ```
    this.modelstate = new System.Web.Mvc.ModelStateDictionary(); 
    ```

3.  我的模型的示例帖子名为 Models.ContactInformation：

    ```
    [HttpPost]
    [ValidateAntiForgeryToken]
    public ActionResult contact(Models.ContactInformation con)
    {
      if (string.IsNullOrEmpty(con.SelectedAgencySelectorType))
      {
        ModelState.AddModelError("", "You did not select an agency type.");
      }

      con.modelstate = ModelState;
      TempData["contact"] = con;
      if (!ModelState.IsValid) return RedirectToAction("contactinformation", "reports");

        //do stuff

        return RedirectToAction("contactinformation", "reports");
    } 
    ```

4.  所以现在你的临时数据有你的模型和模型状态。

5.  以下是我的观点，它对任何事物的状态都是不可知的，除非它有什么东西。这是代码：

    ```
    [HttpGet]
    public ActionResult contactinformation()
    {
        //try cast to model
        var m = new Models.ContactInformation();
        if (TempData["contact"] is Models.ContactInformation) m = (Models.ContactInformation)TempData["contact"];

        //restore modelstate if needed
        if (!m.modelstate.IsValid)
        {
            foreach (ModelState item in m.modelstate.Values)
            {
                foreach (ModelError err in item.Errors)
                {
                    ModelState.AddModelError("", err.ErrorMessage.ToString());
                }
            }
        }

        return View(m);
    } 
    ```

# .net - LINQ to SQL 执行联合和左外连接

> ID：658748
> 
> 赞同：4
> 
> 时间：2009-03-18T15:24:13.120
> 
> 标签：.net, linq-to-sql, union, left-join

我有 3 张桌子。2 包含我需要执行 UNION 以获取所有唯一文件的文件列表，然后我想对第三个表进行左外连接以查找仅在第三个表中而不在另一个表中的所有文件2.

要执行 UNION，我有以下内容：

```
var imageUnion = (from img in dc.ImageT1
                  select img.filename).Union(
                  from img in dc.ImageT2
                  select img.filename); 
```

现在，要仅在第三个表中获取文件，我将执行左外连接：

```
var query = from image in dc.ImageT1
            join active in dc.ActiveImages on image.filename equals 
            active.filename into gj
            from subimage in gj.DefaultIfEmpty()
            where subimage.filename == null
            select new { image.filename, image.size }; 
```

我了解如何简单地针对 ONE 表进行左外连接，但是如何将第一个查询的结果集放入左外连接？基本上，我不想对 ImagesT1 进行左外连接，而是想对 imageUnion 结果进行操作。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-18T16:08:15.340

您需要在您的联盟中选择多个属性；当前结果是 IEnumerable<string> （假设您的文件名是字符串）。

```
var imageUnion = (from img in dc.ImageT1
                  select new { Filename = img.filename, Size = img.size }).Union(
                  from img in dc.ImageT2
                  select new { Filename = img.filename, Size = img.size }); 
```

然后您应该可以在第二个查询中使用它来替换 dc.ImageT1。

尽管考虑得更多，但 Union 可能不适用于 2 种匿名类型；为了支持这一点，也许值得定义一个只有文件名和大小的类？

```
public class TempImage
{
    public string Filename { get; set; }
    public int Size { get; set; }
}

var imageUnion = (from img in dc.ImageT1
                  select new TempImage() { Filename = img.filename, Size = img.size }).Union(
                  from img in dc.ImageT2
                  select new TempImage() { Filename = img.filename, Size = img.size }); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T15:36:04.357

您应该能够再次从第一个查询而不是图像表中进行选择。就像是：

```
var query = from image in imageUnion
            join active in dc.ActiveImages on image.filename equals 
            active.filename into gj
            from subimage in gj.DefaultIfEmpty()
            where subimage.filename == null
            select new { image.filename, image.size }; 
```

编辑：您还必须编辑 imageUnion 查询以选择大小和文件名（以及最终查询中需要的任何其他列）。

# iis-6 - 如何确定哪个 w3wp.exe 进程属于哪个网站？

> ID：658749
> 
> 赞同：26
> 
> 时间：2009-03-18T15:25:07.597
> 
> 标签：iis-6, w3wp

我有一个托管两个应用程序池的 IIS6 Web 服务器。有时，其中一个 w3wp 进程会在一段时间内使 CPU 达到峰值，而这两个应用程序池似乎都会受到影响。我不确定哪个是哪个，如果没有这些信息，我不知道应该归咎于哪个应用程序。

如何判断哪个 w3wp 属于哪个 App Pool？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2012-02-24T20:24:57.307

对于 IIS7，您需要以管理员身份从 %systemroot%\system32\inetsrv\ 使用 APPCMD

IE

%systemroot%\system32\inetsrv\appcmd list wp

有关详细信息，请参阅[http://learn.iis.net/page.aspx/114/getting-started-with-appcmdexe/#HowToUse](http://learn.iis.net/page.aspx/114/getting-started-with-appcmdexe/#HowToUse)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-18T15:32:30.930

转到 cmd 窗口，然后键入`c:\windows\system32\cscript c:\windows\system32\iisapp.vbs`.

现在您将获得工作进程列表以及应用程序池名称。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-18T15:32:51.977

[来自 microsoft 的lisapp.vbs](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/b8721f32-696b-4439-9140-7061933afa4b.mspx?mfr=true)正是为此。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-04-16T21:51:00.967

您还可以使用 Sysinternals 的 Process Explorer。右键单击顶部的列，然后选择“命令行”列。在命令行列中，您将看到完整命令中包含的 Web 应用程序的名称。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T12:14:49.240

您还可以从 IIS 调试诊断工具获取此信息

# c# - 在方法签名中使用泛型有什么好处？

> ID：658760
> 
> 赞同：4
> 
> 时间：2009-03-18T15:26:45.797
> 
> 标签：c#, generics

**（感谢大家的回答，[这是我重构的示例](https://stackoverflow.com/questions/659232/it-this-an-example-of-the-single-responsibility-principle)，又是关于单一职责原则的另一个 StackOverflow 问题。）**

从 PHP 到 C#，这种语法令人生畏：

```
container.RegisterType<Customer>("customer1"); 
```

直到我意识到它表达的意思是一样的：

```
container.RegisterType(typeof(Customer), "customer1"); 
```

正如我在下面的代码中演示的那样。

那么**这里使用泛型有什么原因**（例如，在整个 Unity 和大多数 C# IoC 容器中），除了它只是一种更简洁的语法，即发送类型时不需要 typeof() 吗？

```
using System;

namespace TestGenericParameter
{
    class Program
    {
        static void Main(string[] args)
        {
            Container container = new Container();
            container.RegisterType<Customer>("test");
            container.RegisterType(typeof(Customer), "test");

            Console.ReadLine();
        }
    }

    public class Container
    {
        public void RegisterType<T>(string dummy)
        {
            Console.WriteLine("Type={0}, dummy={1}, name of class={2}", typeof(T), dummy, typeof(T).Name);
        }

        public void RegisterType(Type T, string dummy)
        {
            Console.WriteLine("Type={0}, dummy={1}, name of class={2}", T, dummy, T.Name);
        }

    }

    public class Customer {}
}

//OUTPUT:
//Type=TestGenericParameter.Customer, dummy=test, name of class=Customer
//Type=TestGenericParameter.Customer, dummy=test, name of class=Customer 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T15:35:52.577

泛型非常有用的一个原因是泛型类型参数用作参数的类型或方法的返回类型。这意味着，您可以编写类似的方法

```
public T GetAs<T>(string name) 
```

编译器可以检查返回类型，有时可以避免装箱值类型。调用者会写：

```
int value = GetAs<int>("foo"); 
```

如果没有泛型，您将不得不编写

```
public object GetAs(Type t, string name) 
```

并且调用者必须再次转换结果：

```
int value = (int)GetAs(typeof(int), "foo"); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-18T15:38:50.743

一个主要原因是编译时的类型安全。如果您要传递两个`Type`对象，那么您将责任放在开发人员而不是编译器身上。

这也是许多 IoC 容器使用它的原因，因为如果具体类型没有继承抽象类型，编译器会报错。

```
public void Register<TAbstract, TConcrete>() where TConcrete : TAbstract
{
} 
```

此代码仅在`TConcrete`实现或继承时才有效`TAbstract`。如果此方法采用两个`Type`参数，则您的方法应验证此关系。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-18T15:42:00.177

一个简单的答案是尽可能进行*类型推断*。

如果在方法签名中使用了泛型类型，则可以省略它，因为可以推断出类型：

```
void SomeMethod<T>(T x, T y) where T : IComparable<T> {
    Console.WriteLine("Result: {0} to {1} is {2}", x, y, x.CompareTo(y));
} 
```

所以简化了用法：

```
SomeMethod(3, 4);         // instead of SomeMethod<int>(3, 4);
SomeMethod("one", "two"); // instead of SomeMethod<string>("one", "two"); 
```

如果方法签名中未使用泛型类型参数，则无法进行类型推断：

```
var emptySequence = Enumerable.Empty<int>(); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-18T15:32:30.260

例如，比较使用`typeof`选项和泛型创建类型实例所需的代码。或者返回该类型的一个实例。或者接受该类型的一个实例作为参数。或者在该类型的实例上设置一个属性。

通常，如果您只使用类型本身，则可以接受类型参数。如果您想对该类型的*实例*执行任何操作，请使用泛型。

使用泛型的另一个原因是如果您想对类型应用约束。例如，您可以要求该类型实现一个或多个接口、继承另一种类型、作为引用类型或值类型、具有默认构造函数或以上的某种组合。编译器将强制执行此操作，因此您无法构建不符合您要求的代码。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-18T15:35:17.650

我认为主要用途之一是带有参数和返回值的类型安全。在您的示例案例中，泛型没有太多用处，因为输入/输出类型（字符串）与泛型案例（客户）不匹配。

更合适的用法可能是：

```
public T RegisterType<T>(string name) 
{
    T obj = new T();
    obj.DoSomething();
    return obj;
} 
```

或许

```
public void DoSomething<T>(T obj) 
{
    //operate on obj
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-18T15:37:07.707

如果您不使用泛型，则必须为要支持的每种类型重载方法，或者必须将参数作为对象接受并执行强制转换逻辑。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-18T15:45:47.047

我想说最好的理由是类型安全，使用“where”关键字来确保泛型类型是某种类型（或子类/实现者）。使用“typeof”可以让你发送任何东西。

# c# - 删除 .net 代码中的文字字符串

> ID：658761
> 
> 赞同：1
> 
> 时间：2009-03-18T15:26:46.217
> 
> 标签：c#, .net

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T15:44:13.167

这就是“资源”和“设置”的用途。您可以通过在 Visual Studio 中右键单击您的项目并单击“属性”，然后转到“资源”或“设置”选项卡来找到它。

对于不会经常更改的预构建资源，请使用资源。对于您希望可配置的内容，请改用设置，因为它会为您的 App.config 自动生成配置块。如果您不想使用默认值，您仍需要手动复制和粘贴这些值。

两者的好处是 VS 将构建一个很好的静态类，其中包含可以在整个代码中使用的属性。只要您继续使用该向导，VS 就会为您动态维护类和资源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T15:42:07.930

我通常将它们声明为常量，或者，如果我有相关字符串组，我将创建一个枚举。

无论哪种方式，至少它们都有一个描述性的名称（而不是使用“魔术字符串”），并且它们的使用将始终保持一致。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T15:45:10.900

过去，我使用 CodeRush（或您最喜欢的重构工具）在类中转换为 const 字符串，然后将所述 const 字符串移动为它们所应用的实体类的公共成员。

真正的答案是，如果你想让你的代码在重构时不那么脆弱，那就是退出字符串业务，并使用 Linq 4/to NHibernate，但你必须研究它的完整性是否足够为您的目的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-05T06:27:39.300

意识到我可以用表达式树的方式做到这一点。使用代码作为数据！

*像这样的东西*

```
 protected IList<T> _FindByProperty<TResult>(Expression<Func<T, TResult>> expression, TResult value)  
   {  
   return _FindByProperty((expression.Body as MemberExpression).Member.Name, value);  
  } 

IList<User> costCenters = _FindByProperty( user=> user.Name, "name"); 
```

***学分***： [http ://suryagaddipati.wordpress.com/2009/03/14/code-as-data-in-c-taking-advantage-of-expression-trees/](http://suryagaddipati.wordpress.com/2009/03/14/code-as-data-in-c-taking-advantage-of-expression-trees/)

[这与表达式树](https://stackoverflow.com/questions/tagged/expression-trees)标签中的很多问题有关。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-05T06:32:30.443

我使用与 Cherian 类似的方法。我的想法来自 FluentNhibernate 的 ReflectionHelper。

原理是使用表达式树，然后你可以放入 ax => x.Status 表达式。该方法将属性名称作为字符串返回。

事实上，你也可以只使用 FluentNHibernate？但是，我不知道他们的查询模型是否与他们的映射接口一样广泛......

# python - 打印浮点值时如何抑制科学计数法？

> ID：658763
> 
> 赞同：198
> 
> 时间：2009-03-18T15:27:21.630
> 
> 标签：python, floating-point

这是我的代码：

```
x = 1.0
y = 100000.0    
print x/y 
```

我的商显示为`1.00000e-05`.

有没有办法抑制科学记数法并使其显示为 `0.00001`？我将使用结果作为字符串。

* * *

## 回答 #1

> 赞同：136
> 
> 时间：2015-10-19T16:41:27.840

使用较新的版本`''.format`（还记得在您希望显示的后面指定多少位`.`，这取决于浮点数有多小）。看这个例子：

```
>>> a = -7.1855143557448603e-17
>>> '{:f}'.format(a)
'-0.000000' 
```

如上图，默认为6位！这对我们的案例没有帮助，因此我们可以使用如下内容：

```
>>> '{:.20f}'.format(a)
'-0.00000000000000007186' 
```

## 更新

从 Python 3.6 开始，这可以使用新[的格式化字符串 literal](https://docs.python.org/3/whatsnew/3.6.html#whatsnew36-pep498)进行简化，如下所示：

```
>>> f'{a:.20f}'
'-0.00000000000000007186' 
```

* * *

## 回答 #2

> 赞同：75
> 
> 时间：2009-03-18T15:30:48.003

```
'%f' % (x/y) 
```

但是您需要自己管理精度。例如，

```
'%f' % (1/10**8) 
```

将仅显示零。
[详细信息在文档中](https://docs.python.org/3/library/string.html#formatstrings)

或者对于 Python 3 [，等效的旧格式](http://docs.python.org/py3k/library/stdtypes.html#old-string-formatting-operations)或[更新样式的格式](http://docs.python.org/py3k/library/string.html#string-formatting)

* * *

## 回答 #3

> 赞同：51
> 
> 时间：2011-03-28T19:05:07.623

使用较新版本的 Python（2.6 及更高版本），您可以使用[`''.format()`](http://docs.python.org/library/string.html#format-string-syntax)来完成@SilentGhost 的建议：

```
'{0:f}'.format(x/y) 
```

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2019-05-24T15:34:03.477

另一种选择是，如果您使用 pandas 并希望禁止所有浮点数的科学记数法，则调整 pandas 选项。

```
import pandas as pd
pd.options.display.float_format = '{:.2f}'.format 
```

* * *

## 回答 #5

> 赞同：33
> 
> 时间：2019-09-25T21:06:41.350

上面的大多数答案都要求您指定精度。但是如果你想像这样显示浮点数，没有不必要的零怎么办：

```
1
0.1
0.01
0.001
0.0001
0.00001
0.000001
0.000000000001 
```

`numpy`有一个答案：[`np.format_float_positional`](https://docs.scipy.org/doc/numpy/reference/generated/numpy.format_float_positional.html)

```
import numpy as np

def format_float(num):
    return np.format_float_positional(num, trim='-') 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2017-08-10T03:56:19.870

这适用于任何指数：

```
def getExpandedScientificNotation(flt):
    str_vals = str(flt).split('e')
    coef = float(str_vals[0])
    exp = int(str_vals[1])
    return_val = ''
    if int(exp) > 0:
        return_val += str(coef).replace('.', '')
        return_val += ''.join(['0' for _ in range(0, abs(exp - len(str(coef).split('.')[1])))])
    elif int(exp) < 0:
        return_val += '0.'
        return_val += ''.join(['0' for _ in range(0, abs(exp) - 1)])
        return_val += str(coef).replace('.', '')
    return return_val 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2017-09-19T10:40:33.963

这是使用[黄瓜船长的答案](https://stackoverflow.com/a/45604186/8282282)，但增加了 2 个。

1) 允许函数获取非科学记数法数字并按原样返回它们（因此您可以输入大量输入，其中一些数字是 0.00003123 vs 3.123e-05 并且仍然具有功能工作。

2) 增加了对负数的支持。（在原始函数中，负数最终会像 -1.08904e-05 的 0.0000-108904）

```
def getExpandedScientificNotation(flt):
    was_neg = False
    if not ("e" in flt):
        return flt
    if flt.startswith('-'):
        flt = flt[1:]
        was_neg = True 
    str_vals = str(flt).split('e')
    coef = float(str_vals[0])
    exp = int(str_vals[1])
    return_val = ''
    if int(exp) > 0:
        return_val += str(coef).replace('.', '')
        return_val += ''.join(['0' for _ in range(0, abs(exp - len(str(coef).split('.')[1])))])
    elif int(exp) < 0:
        return_val += '0.'
        return_val += ''.join(['0' for _ in range(0, abs(exp) - 1)])
        return_val += str(coef).replace('.', '')
    if was_neg:
        return_val='-'+return_val
    return return_val 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2021-06-26T21:31:36.583

您可以使用内置`format`功能。

```
>>> a = -3.42142141234123e-15
>>> format(a, 'f')
'-0.000000'
>>> format(a, '.50f') # Or you can specify precision
'-0.00000000000000342142141234122994048466990874926279' 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-18T15:34:09.367

除了 SG 的回答，您还可以使用 Decimal 模块：

```
from decimal import Decimal
x = str(Decimal(1) / Decimal(10000))

# x is a string '0.0001' 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2015-02-06T08:43:32.657

如果是，`string`则使用其内置的`float`进行转换，例如： `print( "%.5f" % float("1.43572e-03"))` 答案：`0.00143572`

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2018-07-02T17:16:05.837

由于这是 Google 上的最高结果，因此在未能找到解决问题的方法后，我将在此处发布。**如果您正在寻找格式化浮点对象的显示值并使其保持浮点而不是字符串，则可以使用此解决方案：**

创建一个修改浮点值显示方式的新类。

```
from builtins import float
class FormattedFloat(float):

    def __str__(self):
        return "{:.10f}".format(self).rstrip('0') 
```

您可以通过更改整数值来自己修改精度`{:f}`

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-05-18T13:52:18.853

将浮点数显示为任意数量的有效数字的更简单的解决方案。`numpy`此处不需要或列出推导：

```
def sig(num, digits=3):
    "Return number formatted for significant digits"
    if num == 0:
        return 0
    negative = '-' if num < 0 else ''
    num = abs(float(num))
    power = math.log(num, 10)
    if num < 1:
        step = int(10**(-int(power) + digits) * num)
        return negative + '0.' + '0' * -int(power) + str(int(step)).rstrip('0')
    elif power < digits - 1:
        return negative + ('{0:.' + str(digits) + 'g}').format(num)
    else:
        return negative + str(int(num)) 
```

我在示例中去除尾随 0 并显示完整整数：`sig(31415.9) = 31415`而不是 31400。如果您不喜欢，请随意修改代码。

测试：

```
for power in range(-8,8):
    num = math.pi * 10**power
    print(str(num).ljust(25), sig(num)) 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2022-01-24T07:36:10.540

在 numpy 数组的情况下，您可以使用抑制命令进行抑制

```
import numpy as np
np.set_printoptions(suppress=True) 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2018-04-13T23:07:51.740

使用 3.6.4，我遇到了一个类似的问题，即在使用此命令时，输出文件中的数字会随机格式化为科学计数法：

```
fout.write('someFloats: {0:0.8},{1:0.8},{2:0.8}'.format(someFloat[0], someFloat[1], someFloat[2])) 
```

我所要做的就是添加'f'：

```
fout.write('someFloats: {0:0.8f},{1:0.8f},{2:0.8f}'.format(someFloat[0], someFloat[1], someFloat[2])) 
```

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2019-07-22T01:52:07.207

从 3.6 开始（可能也适用于稍旧的 3.x），这是我的解决方案：

```
import locale
locale.setlocale(locale.LC_ALL, '')

def number_format(n, dec_precision=4):
    precision = len(str(round(n))) + dec_precision
    return format(float(n), f'.{precision}n') 
```

计算的目的`precision`是确保我们有足够的精度来避免科学记数法（默认精度仍然是 6）。

该`dec_precision`参数增加了用于小数点的额外精度。由于这使用了`n`格式，因此不会添加无关紧要的零（与`f`格式不同）。`n`也将负责渲染没有小数的整数。

`n`确实需要`float`输入，因此需要演员表。

# asp.net - ASP.Net 文件上传进度条

> ID：658766
> 
> 赞同：1
> 
> 时间：2009-03-18T15:28:09.273
> 
> 标签：asp.net

有没有关于如何在 asp.net 中使用进度条编写 FileUpload 的教程？如果有一个免费的组件也可以工作，我找不到任何一个！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T15:31:09.593

我在那里找到了一些不同的选择。我没有使用过它们中的任何一个，但我很可能会在不久的将来在这里研究第三个选项。

*   [http://en.fileuploadajax.subgurim.net/](http://en.fileuploadajax.subgurim.net/)
*   [http://ajaxuploader.com/](http://ajaxuploader.com/)
*   [http://mattberseth.com/blog/2008/07/aspnet_file_upload_with_realti.html](http://mattberseth.com/blog/2008/07/aspnet_file_upload_with_realti.html)

这篇文章也可以在[这里](https://stackoverflow.com/questions/614945/whats-the-best-most-simple-ajax-file-uploader/615557#615557)找到...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T15:31:48.640

我过去曾在我的一个项目中使用过[NeatUpload](http://neatupload.codeplex.com/)。自从我开始工作以来，我没有遇到任何问题。

该软件是免费的，并且受到 LGPL 许可的保护，如果您打算将其用于工作，那就太好了。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-18T19:50:25.367

ASP.NET 附带的 FileUpload 控件只是传输带有请求负载的文件。因此，您将获得的唯一进度条是浏览器底部的进度条。您必须使用第 3 方解决方案。

# xml - 如何访问两个不同 MXML 文件中的配置文件

> ID：658768
> 
> 赞同：0
> 
> 时间：2009-03-18T15:28:23.530
> 
> 标签：xml, apache-flex, actionscript-3

我有这样的东西

1.mxml

```
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" creationComplete="init()">
  <mx:Script source="_Public.as"/>
</mx:Application> 
```

_public.as

```
[Bindable]
public var config:XML;  
public function init():void 
{
  var request:URLRequest = new URLRequest("config/config.xml");
  try {
    loader.load(request);
  } catch (error:Error) {
    trace("Unable to load requested document.");
  }
  loader.addEventListener(Event.COMPLETE,init_continue);
}

public function init_continue(event:Event):void {
  config =  new XML(loader.data);
} 
```

配置已填充，我可以使用它。之后我按下一个按钮`1.mxml`并创建`2.mxml popup`（没有初始化）。

配置文件

```
<data>
  <LOGIN_BUTTON>Inloggen</LOGIN_BUTTON>
</data> 
```

现在我想访问`config.LOGIN_BUTTON`. 但是配置并没有给我任何东西。

是否可以“访问”配置？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T15:46:49.807

首先，总是先添加一个监听器，然后才发出 load() ，像这样：

```
 loader.addEventListener(Event.COMPLETE, init_continue);
  try {
    loader.load(request);
  } catch (error:Error) {
    trace("Unable to load requested document.");
  } 
```

否则，负载可能很快就足以跳过您的听众。那么，对于你的问题。我不确定您所说的“访问”config.LOGIN_BUTTON 是什么意思。但是如果成功加载了 xml 数据，则 XML 结构应该可以作为 访问`config.LOGIN_BUTTON`，即后者应该返回一个 XMLList 对象。恐怕我需要更清楚地解释您要达到的目标，才能给出比这更好的答案。

**编辑**：根据您的跟进，我认为最好为标签设置一个单独的变量，如下所示：

```
[Bindable]
private var buttonLabel:String;
....
public function init_continue(event:Event):void {
    config =  new XML(loader.data);
    buttonLabel = config.BUTTON_LABEL;
} 
```

然后在 2.mxml 中：

```
<mx:FormItem label="{buttonLabel}" required="true" 
```

我不确定变量绑定是否在 XML 结构中起作用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T18:11:36.930

您可以使用它访问它

```
Application.application.config.LOGIN_BUTTON 
```

# xml-serialization - 如何控制 xsi:nill= 上的 XML 序列化行为

> ID：658769
> 
> 赞同：0
> 
> 时间：2009-03-18T15:28:35.713
> 
> 标签：xml-serialization, xsd, xml-nil

我正在开发一个 Web 服务以在 2 个 ERP 系统之间共享数据。第一个 ERP 调用 web 服务，它序列化数据对象并将其发送到第二个 ERP。

数据对象如下所示：

```
 <xs:complexType name="Parent">
        <xs:sequence>
            <xs:element ref="ta:ReceiptLine" maxOccurs="unbounded"/>
        </xs:sequence>
    </xs:complexType>
    <xs:complexType name="Child">
        <xs:sequence>
            ...
            <xs:element name="SerialNo" type="xs:string" nillable="true" minOccurs="0"/>
            <xs:element name="Quantity" type="xs:int" nillable="false"/>
            ...
        </xs:sequence>
    </xs:complexType>
    ...
    <xs:element name="Child" type="ta:Child" nillable="true"/> 
```

XSD 生成的类：

```
[System.Serializable]
    [System.Xml.Serialization.XmlTypeAttribute(Namespace="http://FSM4TA/DataObjects/")]
    [System.Xml.Serialization.XmlRootAttribute(Namespace="http://FSM4TA/DataObjects/", IsNullable=false)]
public partial class Parent {
    private Child[] child;

    [System.Xml.Serialization.XmlElementAttribute("Child", IsNullable=true)]
        public Child[] Child {
            get {return this.child;}
            set {this.child = value;}
}

[System.Serializable]
    [System.Xml.Serialization.XmlTypeAttribute(Namespace="http://FSM4TA/DataObjects/")]
    [System.Xml.Serialization.XmlRootAttribute(Namespace="http://FSM4TA/DataObjects/", IsNullable=true)]
    public partial class Child{
        private string serialNo;
        private int quantity;

        [System.Xml.Serialization.XmlElementAttribute(IsNullable=true)]
        public string SerialNo {
            get {return this.serialNo;}
            set {this.serialNo = value;}
        }

        public int Quantity {
            get { return this.quantity;}
            set {this.quantity = value;}
        }
} 
```

我正在使用 XmlSerializer 序列化我的数据对象

**问题是**：（在序列化上）每次如果子对象为空（xsi:nil="true"）XSD 无论如何都会生成整个子结构。并且因为 Quantity 不是 nillable/nullable XSD 写入**0**作为值...像这样：

```
<Parent>
  <Child xsi:nil="true">
    <SerialNo xsi:nil="true" />
    <Quantity>0</Quantity>
  </Child>
</Parent> 
```

我希望得到这样的东西：

```
<Parent>
  </Child xsi:nil="true">
</Parent> 
```

**问题是**：有没有办法阻止 XSD 解析 xsi:nil="true"-Object ？

有什么建议么？

TIA

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T09:46:27.950

行，

我现在明白了！您必须使用 XmlElementAttribute 显式标记*Quantity属性！*

```
[XmlElement(IsNullable=false)]
public int Quantity {
        get { return this.quantity;}
        set {this.quantity = value;}
    } 
```

不知道为什么这没有自动生成......

# security - 确定附加文档在打开时是否会伤害用户的最佳方法

> ID：658771
> 
> 赞同：1
> 
> 时间：2009-03-18T15:28:59.863
> 
> 标签：security, document, attachment

我们正在编写一项功能，允许我们的用户将诸如 Word 文档、Excel 电子表格、图片、pdf 之类的内容“附加”到我们应用程序中的文档中——就像电子邮件一样。

但是，我们不希望允许他们附加 .exe、.bat、.reg 文件或其他任何可能在他们打开文件时对他们造成伤害的文件 - 因此我们建议将允许的文件类型列入白名单。

有谁知道确定文件是否安全的更好方法？（即没有能力损害用户的计算机）。或者取而代之的是一个资源，它会给我们一个常用安全文档的列表，作为默认值添加到我们的白名单中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T15:41:02.610

[Word宏病毒](http://support.microsoft.com/kb/187243)呢？没有一种“安全”的文档类型。如果有人将 .exe 文件重命名为 .doc 怎么办？这是否允许？不要只依赖文件类型或名称，也不要只相信客户输入。如果可能的话，在服务器端验证它，很可能使用防病毒程序或其他一些已知的实用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T15:42:07.883

您可以使用白名单加上 AssocIsDangerous ( [http://msdn.microsoft.com/en-us/library/bb773465(VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb773465(VS.85).aspx) ) 的结果来确定是否应允许该文件。附加文件的白名单没有警告，AssocIsDangerous 完全阻止，其余的可以获得默认的警告对话框。

请注意白名单，因为复杂文档可能包含宏，并且其关联的应用程序可能在其解析器中包含安全漏洞。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T10:24:56.533

使用反向代理设置，例如

www <-> **HAVP** <-> 网络服务器

HAVP ( [http://www.server-side.de/](http://www.server-side.de/) ) 是一种通过 ClamAV 或任何其他商业防病毒软件**扫描 http 流量的方法。**它将阻止用户下载受感染的文件。如果您需要 https 或其他任何东西，那么您可以将另一个反向代理或 Web 服务器置于反向代理模式，以在 HAVP 之前处理 SSL

然而，它在上传时不起作用，因此它不会阻止文件存储在服务器上，但会**阻止文件被下载并因此传播**。因此，将它与常规文件扫描（例如 clamscan）一起使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T15:31:54.990

老实说，我认为 Linux 上的 Clam AV 或 Windows 上的 Trend Micro 最适合你。

# unix - gunzip 预制任务和重新压缩

> ID：658774
> 
> 赞同：1
> 
> 时间：2009-03-18T15:29:48.457
> 
> 标签：unix, awk, gunzip

我想执行此操作

```
awk -F, '$1 ~ /F$/' file.dat 
```

在整个 gzip 文件目录上

我希望能够遍历每个文件解压缩它执行上述命令（打印出任何发现）重新压缩并移动到下一个压缩文件

如何才能做到这一点？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T16:06:07.763

好吧，如果您必须将所有内容集中在一行中：

```
find . -name \*.gz -print0 | xargs -0 gunzip -c | awk -F, '$1 ~ /F$/' 
```

那*应该*对你有用

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T16:13:17.183

在我看来，您想要输出以逗号分隔的字段列表中的第一个字段以“F”结尾的行

如果您不关心列出这些行来自哪个 .gz 文件，或者在 gzip 压缩文件中列出哪个文件 - 也就是说，您只希望列出这些行 - 您甚至不必先对 .gz 文件进行压缩，这样您就不必重新压缩它们。

```
zcat file.gz | awk -F, '$1 ~ /F$/' 
```

对于当前目录树中的每个文件，使用带有 xargs 的查找。此示例将其限制为仅当前目录，但只需省略“-maxdepth 1”即可获取整个目录树

```
find . -maxdepth 1 -name \*.gz -print0 | xargs -0 zcat | awk -F, '$1 ~ /F$/' 
```

这表示要查找以“.gz”结尾的文件并*用 NUL 终止符*（-print0 中的 0）写入它们的名称，通过 xargs 管道输出，这将根据 NUL 字符（“-0”arg ) 并在文件上运行 zcat。通过您的 awk 命令管道输出*，*您将得到写出的相关行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T15:32:17.033

一个shell脚本怎么样：

```
gunzip $1.gz
awk -F, '$1 ~ /F$/' $1
gzip $1 
```

只要确保`$1`没有`.gz`扩展名。

那么您可以执行以下操作：

```
find -name \*.gz -type f|xargs my_shell_script 
```

# sql - 将存储过程传递给 sp_send_dbmail

> ID：658780
> 
> 赞同：6
> 
> 时间：2009-03-18T15:31:13.977
> 
> 标签：sql, sql-server, email, stored-procedures

我在 SQL Server 2008 中使用 sp_send_dbmail 发送查询结果。我将查询移动到一个过程中，并尝试在 sp_send_dbmail 过程中使用过程，如下所示：

```
EXEC msdb.dbo.sp_send_dbmail 
@profile_name               = 'myprofile',
@from_address               = 'email@somedomain.com',
@reply_to                   = 'email@somedomain.com',
@recipients                 = 'email@differentdomain.com',  
@importance                 = 'NORMAL', 
@sensitivity                = 'NORMAL', 
@subject                    = 'My Subject',
@body                       = 'Here you go.',
@attach_query_result_as_file= 1,
--@query_result_header      = 1,
@query_result_width         = 1000, 
@query_result_separator     = '~',
@query_attachment_filename  = 'myFile.txt',
@query                      = 'EXEC dbo.myProc' 
```

我也尝试过在 proc 上使用 4 部分命名；有和没有'EXEC'等。它作为一个查询工作得很好，但我似乎无法让它作为一个proc工作。这甚至可能吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-21T00:50:39.223

您需要添加数据库上下文：

```
@execute_query_database = 'MyDatabaseName', 
```

我刚刚对 AdventureWorks2008 运行了这个，没有任何问题：

```
EXEC msdb.dbo.sp_send_dbmail
    @profile_name = 'DBMail',
    @recipients = 'mitch@domain.com',
    @query = 'exec dbo.uspGetManagerEmployees 5' ,
    @execute_query_database = 'AdventureWorks2008',
    @subject = 'Work Order Count',
    @attach_query_result_as_file = 1 ; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T20:27:17.883

您是否尝试过创建用户定义的函数而不是存储过程？

就像是：

`@query = 'select something from dbo.myFunction()'`

# perl - 为什么在 Perl 中用 '%>' 替换字符串时会出现空行？

> ID：658781
> 
> 赞同：1
> 
> 时间：2009-03-18T15:31:14.337
> 
> 标签：perl

这是输入文本：

```
<title>Company Selection</title>
<link rel="stylesheet" type="text/css" href="../css/style_hbpSA_css.jsp" /> 
```

我想用两行替换 CSS 参考：

```
<%@ include file="../common/cmufx.jsp" %>
<link rel="stylesheet" type="text/css" href="<%=basePath%>/<fmt:message key="application.version"/>/css/style_hbpSA_css.jsp" /> 
```

这是 Perl 语句：

```
while(<>){
    s{<link rel="stylesheet" type="text/css" href="../css/style_hbpSA_css.jsp" />}{
--><%@ include file="../common/cmufx.jsp" %> 
<link rel="stylesheet" type="text/css" href="<%=basePath%>/<fmt:message key="application.version"/>/css/style_hbpSA_css.jsp" />;};
print;
} 
```

在输出中我得到：

```
<title>Company Selection</title>

-->
<link rel="stylesheet" type="text/css" href="<%=basePath%>/<fmt:message key="application.version"/>/css/style_hbpSA_css.jsp" /> 
```

*   如果我删除第一个替换行末尾的 '%>' 元素，我会得到要打印的行。
*   如果替换行以 '% >' 结尾，它将被打印。
*   如果我转义 %，则不会打印该行

* * *

我的脚本的整个来源：

```
#!/usr/bin/perl

use strict;
use warnings;

while(<>){
    s{<link rel="stylesheet" type="text/css" href="../css/style_hbpSA_css.jsp" />}{
--><%@ include file="../common/cmufx.jsp" %>
<link rel="stylesheet" type="text/css" href="<%=basePath%>/<fmt:message key="application.version"/>/css/style_hbpSA_css.jsp" />;};

    s{<link rel="stylesheet" type="text/css" href="../css/style_hbp_css.jsp" />}{
<link rel="stylesheet" type="text/css" href="<%=basePath%>/<fmt:message key="application.version"/>/css/style_hbp_css.jsp" />};

    s{<%@ include file="../common/cmufx.jsp" %>}{};

    s{../img/banner.jpg}{<%=basePath%>/<fmt:message key="application.version"/>/img/banner.jpg};

    print;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T15:57:32.573

我才恍然大悟，您正在通过网络服务器查看结果，不是吗？<% %> 东西应该被模板程序或服务器端包含替换。您将永远不会看到该文本。很可能文件 ../common/cmufx.jsp 不存在（例如路径错误）或者它什么都不包含。看看程序在命令行上吐出什么。如果这是您所期望的，那么问题就出在其他地方（例如 cmufx.jsp 的路径或您的 ssi 设置不正确）。

您的数据有一个空间，您的正则表达式有一个 /：

```
data                                               V
<link rel="stylesheet" type="text/css" href="../css style_hbpSA_css.jsp" />
regex                                              V
<link rel="stylesheet" type="text/css" href="../css/style_hbpSA_css.jsp" /> 
```

此外，您正在使用 . 在你的正则表达式中而不转义它们。这 。正则表达式中的字符匹配除换行符以外的任何字符（除非使用 /s 选项）。您的正则表达式可能看起来像

```
s{<link rel="stylesheet" type="text/css" href="\.\./css style_hbpSA_css\.jsp" />}{} 
```

或者

```
s{<link rel="stylesheet" type="text/css" href="[.][.]/css style_hbpSA_css[.]jsp" />}{} 
```

取决于哪个对你来说看起来不那么难看。第一个转义了 . 的特殊含义，第二个创建了一个字符的字符类，即 ..

你说你仍然有问题，这是一个完整的脚本，它做正确的事情，你能告诉我们你的代码与这个不同的地方：

```
#!/usr/bin/perl

use strict;
use warnings;

while(<DATA>){
s{<link rel="stylesheet" type="text/css" href="../css/style_hbpSA_css.jsp" />}{
<%@ include file="../common/cmufx.jsp" %> 
<link rel="stylesheet" type="text/css" href="<%=basePath%>/<fmt:message key="application.version"/>/css/style_hbpSA_css.jsp" />;};
print;
}

__DATA__
<title>Company Selection</title>
<link rel="stylesheet" type="text/css" href="../css/style_hbpSA_css.jsp" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T15:59:08.823

首先，我强烈建议不要使用正则表达式来操作 HTML。使用类似[HTML::Tree](http://search.cpan.org/dist/HTML-Tree)的东西。

尽管如此，当我尝试您的代码时，它仍然有效。我唯一改变的是我认为是一个错字：您的输入包括：

```
href="../css style_hbpSA_css.jsp" 
```

你的模式是：

```
href="../css/style_hbpSA_css.jsp" 
```

我假设您希望两者相同（尽管在模式中包含“..”会更好）。

我要检查的一件事是输入文件中奇怪的（即 Windows）行结尾。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T16:34:22.187

答案是在那次替换之后，我还要求

```
s{<%@ include file="../common/cmufx.jsp" %>}{}; 
```

因此该行被删除。

很抱歉浪费了您的时间，我**非常感谢您**的所有回答。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T16:35:35.663

这是因为您在 { 之后有一个新行

```
s{<link rel="stylesheet" type="text/css" href="../css/style_hbpSA_css.jsp" />}{ #your new line is here
<%@ include file="../common/cmufx.jsp" %> 
```

# oop - 验证类数据

> ID：658791
> 
> 赞同：0
> 
> 时间：2009-03-18T15:32:36.127
> 
> 标签：oop, error-handling, theory, validation

在我的应用程序中，我正在创建一系列验证类来检查，例如，用户输入的类的 Name 属性（来自 WinForm）不超过数据库中 varchar() 的大小。

目前，如果 Name 字段太大，验证代码将抛出自定义异常。（自定义异常，当被 UI 捕获时，将在 MessageBox 中显示自定义异常消息，而不是我的常规异常的通用错误表单。）验证类在应用程序的类库中，并且范围为 Friend。流程如下所示：

*   WinForms 使用的 DLL 的公共服务层 --(calls)--> Friend Validation Layer
*   如果验证成功，则 WinForms 使用的 DLL 的公共服务层 --(调用)--> Friend 数据访问层。

简化示例：

```
Public Shared Sub CreateCustomer(cust as Customer)
    Validation.Customer.ValidateForCreate(cust) ' scoped as Friend
    Dal.Customer.Create(cust) ' scoped as Friend
End Sub 
```

当验证失败时，让验证层将自定义异常抛出回 UI 是否是“智能”设计？

仅从验证层返回 True/False 以及失败的字符串消息，并让服务层处理抛出异常，这是更好的设计吗？

仅从验证层返回 True/False 并让服务层将 True/False 冒泡到 UI 以及失败的字符串消息是更好的设计吗？

我试图保持面向对象的方法。我的观点是抛出自定义异常不会违反 OOP 原则，但我想要其他意见:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T15:48:47.990

AFAIK 异常机制实际上是 OOP 方法的核心，并且实际上在将其内置到编程语言中时受到鼓励。我想说让你的验证抛出一个自定义异常是一件非常好的事情，特别是如果你有几个自定义异常（NameTooLongException、NameIncludesNonStandardCharactersException...），这些异常是自记录的，并且对于代码的未来维护者来说很容易阅读。

一旦您的异常到达您的服务层，您可以决定是捕获并处理它（这取决于您的业务逻辑）还是让它一直到 UI。如果异常带有有意义的错误消息，并且总是合适的，那么让 UI 将其呈现给用户可能不是一个坏主意。（请记住，您可能希望在某些时候将您的应用程序国际化，在这种情况下，消息需要使用正确的语言。）

我的观点是，层分离虽然有时纯粹是逻辑上的，但有其原因，不应该从后端抛出异常到前端，但这更像是一种指导而不是规则。最重要的是，做需要做的事情，不要过度考虑设计。

希望这会有所帮助...

尤瓦尔=8-)

# c# - C#：如何在对象到类型转换期间使用隐式强制转换运算符？

> ID：658797
> 
> 赞同：4
> 
> 时间：2009-03-18T15:34:27.073
> 
> 标签：c#, enums, casting

你好！

这是我的情况：我有一些值类型，它使用适当的隐式转换器包装成另一种类型。如果我将包装类型转换为对象，然后尝试获取原始值，我只能在两步转换中做到这一点。如果简化我的代码如下：

```
public enum MyEnum : int
    {
        First,
        Second
    }

    public class Test<T>
    {
        public Test(T val)
        {
            Value = val;
        }

        private T Value { get; set; }

        public static implicit operator T(Test<T> m)
        {
            return m.Value;
        }

        public static implicit operator Test<T>(T m)
        {
            var res = new Test<T>(m);
            return res;
        }
    }

    static void Main()
    {
        object res = new Test<MyEnum>(MyEnum.First);
        Console.WriteLine((MyEnum)(Test<MyEnum>)res);
        Console.WriteLine((MyEnum)res);
    } 
```

首先“Console.WriteLine”工作正常。第二个失败。

有什么办法可以修改这种行为并让它在没有双重转换的情况下工作？

**更新 1**

我必须使用对象来进行值转换（在实际应用程序中，我必须转换 ComboBox.SelectedItem 属性，并且我不想向 ComboBox 添加额外的属性，因为我必须在任何地方更改我的 UI 交互代码）。

**更新 2**

不允许与 System.Object 进行隐式转换。

**更新 3**

更新了我的示例代码以反映整个问题。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T15:36:37.847

不要用`object`那种方式。像这样写你的第一行：

```
Test res = new Test(1); 
```

如果您必须首先将它包含在一个对象中，请记住，此时*编译器*所知道的只是它是一个对象，仅此而已。作为程序员，你有关于你期望这个对象是什么的额外信息，但是为了让编译器利用这些信息，你必须把它放在你的代码中的某个地方。

**更新：**
我很高兴我能再次找到这个，因为从事 C# 语言设计工作的 Eric Lippert 的这篇几乎非常及时的文章今天早上起来并深入解释了这个问题：
[http://blogs .msdn.com/ericlippert/archive/2009/03/19/representation-and-identity.aspx](http://blogs.msdn.com/ericlippert/archive/2009/03/19/representation-and-identity.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-18T16:54:44.760

如果你想简化转换而不关心性能效果，那么创建扩展方法。

```
public static T To<T>(this object obj) {
    Type type = obj.GetType();
    MethodInfo[] methods = type.GetMethods(BindingFlags.Public | BindingFlags.Static);
    MethodInfo method = methods.FirstOrDefault(mi => (mi.Name == "op_Implicit" || mi.Name == "op_Explicit") && mi.ReturnType == typeof(T));
    if (method == null)
        throw new ArgumentException();
    return (T)method.Invoke(null, new[] { obj });
} 
```

用法

```
Console.WriteLine(res.To<MyEnum>()); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T15:59:34.547

[考虑实现IConvertible](http://msdn.microsoft.com/en-us/library/system.iconvertible.aspx)，而不是添加隐式运算符。只需要实现 ToInt32 方法，其他没有意义，可以在其他方法中抛出 InvalidCastException。

之后，您可以使用[Convert.ToInt32()](http://msdn.microsoft.com/en-us/library/system.convert.toint32.aspx)方法一步转换您的对象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T15:41:14.170

甚至

```
var res = new Test(1); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-18T15:43:48.313

您的局部变量 res 始终是 object 类型；所以不起作用的行是试图将一个不是 int 的对象转换为一个 int，这是无法完成的。与此失败相同：

```
 object d = 5.5d;
        Console.WriteLine((int)d); 
```

编辑：

也许可能有帮助的模式是这样的：

```
 if (res.GetType() == typeof(Test))
        {
            Console.WriteLine((int)(Test)res);
        }
        else
        {
            Console.WriteLine((int)res);
        } 
```

这是针对您的问题的非常本地化的解决方案，但也许它对您有用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T15:51:17.907

虽然错误是由于 res 是 object 类型，但我会让 Test->int 运算符显式...

# visual-studio-2008 - 调试时 Visual Studio 始终位于最前面

> ID：658807
> 
> 赞同：16
> 
> 时间：2009-03-18T15:36:34.900
> 
> 标签：visual-studio-2008, debugging, installation, resharper, multiple-monitors

当我开始调试我们当前正在处理的项目时，程序窗口在窗口中没有得到适当的焦点，而是堆叠在 Visual Studio 窗口的后面。我认为我的团队成员的任何计算机上都不会出现此问题，因此它看起来像是我的系统上的问题。

VS2008 中是否有始终在顶部或类似的设置？我好像一个都找不到...

知道是什么原因造成的吗？视觉工作室？程序代码？

我知道这是一个模糊的问题，但如果没有人认识到这个问题，我会考虑添加更多细节。

**编辑：** 我正在使用带有 ReSharper、GhostDoc 和资源重构工具的 Visual Studio 2008。

**编辑：** 我已经查看了我在 VS 中可以找到的每一个选项，但我找不到任何可以解释这种行为的东西。

**编辑：** 我在双显示器设置联想 Thinkpad T 系列笔记本电脑上运行它。显示器通过扩展坞连接。显示器 1 用 DVI 电缆连接，显示器 2 用 VGA 电缆连接。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2011-10-31T01:20:03.097

我遇到了与 Visual Studio 2010 运行 Always-On-Top 相同的问题。

我不知道这是否总是有效。有趣的是，我关闭了 Visual Studio 2010。然后我以管理员身份重新运行。然后 Visual Studio 正常运行，而不是 Always-On-Top。我关闭了 Visual Studio。我正常运行 Visual Studio（不是以管理员身份）。Visual Studio 没有作为 Always-On-Top 运行。

注意：“以管理员身份运行”是指我右键单击；在弹出菜单上单击属性；在对话框中单击“高级”；选中“以管理员身份运行”。

I did not try running as administrator by right clicking and then clicking "run as administrator" on the popup menu.

I only did this one time because once I got Visual Studio running normally, I did not know how to make it run Always-On-Top again.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2014-12-10T21:22:03.387

You can toggle “Always on top” option for the Active window using:

"Windows Key + A"

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-05T11:48:06.600

这只是一个理论，但在我最近升级到 ReSharper 4.5 之后，这个问题似乎得到了解决。这可能是巧合，但我倾向于认为这不是......：P

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-11-25T09:50:02.100

I had this problem with Visual Studio 2013 running on windows 10, I'm not 100% sure when or why it started, but it may have been after installing some Windows updates.

I resolved it using a minor variation of the method described by Indinfer:

*   Close Visual Studio
*   Right click on the Visual Studio shortcut, Run As Administrator. The problem is no longer there.
*   Stop and start Visual Studio as normal. The problem is no longer there.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-10-23T06:36:38.333

See also this answer: [https://superuser.com/a/704621/710593](https://superuser.com/a/704621/710593)

1.  Select a different application (e.g. Chrome).
2.  Press Windows-Home (which will minimise everything else).
3.  Press Windows-Home again (which will restore everything else).
4.  Visual Studio will function normally again.

It just happened to me in VS 2019, and this weird sequence fixed the problem.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-12-07T12:39:30.990

I got this when I have AppVerifier set for vstest.discoveryengine.x86.exe

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-02-22T08:15:43.377

Simplest solution is to reset your custom settings on Visual studio.

1.  Goto -> Tools -> import and export settings -> select "Reset all settings"
2.  Close all instances of Visual Studio, re-open.

This is safest solution but you will loose all customization you did, e.g. adding line numbers for code files, themeing, etc.

It worked for my Visual Studio 2012 Ultimate.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-04-16T16:21:44.843

None of the above worked for me, but it went away while I was troubleshooting a different problem. I could not register MSVS 2019 as the Just-In-Time debugger even though I was running in admin. The message as "Another Debugger is Registered...". I uninstalled MSVS Shell (2015) and MSVS 2017, and deleted the registry keys listed in the accepted asnwer here: [How to stop “Just In Time Debugging” messages blocking a buildserver](https://stackoverflow.com/questions/1893567/how-to-stop-just-in-time-debugging-messages-blocking-a-buildserver) , and it solved both problems.

BTW - The problem Always On Top problem did not happen with C++ debugging and I am using ReSharper Ultimate 2020.

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-03-25T08:29:40.757

没有解决方案，但也许是一个观察：我有时也会在启用双显示器的机器上调试 WinForms 应用程序时得到这个。想一想，我从未尝试过关闭一台显示器，而且在我的新工作中，我们不会创建 WinForms 应用程序。随着 Webforms 开始一个新的浏览器，我从来没有遇到过这个问题（还）。

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2019-05-06T17:58:30.940

Very Simple. Just Toggle Maximise Button on Visual Studio 2017

# javascript - 为什么 Microsoft Visual Studio 中的脚本调试器对我不起作用

> ID：658811
> 
> 赞同：0
> 
> 时间：2009-03-18T15:37:17.707
> 
> 标签：javascript, visual-studio, visual-studio-2008, internet-explorer

我正在使用 Visual Studio 2008，当我启动一个启动 IE6 的 Asp.net 项目时，我在解决方案的“脚本文档”文件夹中看不到任何 jscript 文件。

[替代文字 http://img21.imageshack.us/img21/8338/example1t.png](http://img21.imageshack.us/img21/8338/example1t.png)

但是，如果我手动启动 IE 并将其指向我的网站，然后将 Visual Studio 2008 调试器附加到 IE，它会在“脚本文档”中显示 jscript 文件。 **但是，当我移动到另一个页面时，“脚本文档”中的文件列表不会更新。**

[替代文字 http://img9.imageshack.us/img9/6198/example2f.png](http://img9.imageshack.us/img9/6198/example2f.png)

所以我知道调试器必须在 IE 等中打开。 **这是怎么回事？**

我刚刚创建了一个新的 Asp.net 项目，其中包含一个仅包含一个控件的页面，并且得到了相同的结果。

所有文件都托管在与 Visual Studio 和 IE 相同的计算机上。

请参阅我的答案以了解为我解决此问题的方法，其他人*可能会*觉得[这](https://stackoverflow.com/questions/658912/reenabling-javascript-debugger-in-ie7-with-visual-studio-2008)很有用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T15:53:37.450

如果控件托管在不同的机器上，则需要使用该方法进行调试。请参阅此[博客文章](http://blogs.msdn.com/mikeormond/archive/2006/01/13/512496.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T14:00:58.367

*   我卸载了VS 2008
*   然后我进行了 VS 2008 的全新安装，但没有成功
*   然后我决定安装 VS 2008 SP1 以便我可以继续做一些其他的工作
*   SP1的安装需要重启（VS 2008的卸载/安装不需要重启）
*   **脚本调试器开始工作。**

我仍然不知道是什么导致了问题，并且在一天的工作中迷失了方向。脚本调试器再次停止工作需要多长时间..

# asp.net - ASP.NET DataGrid - DropDownLists 在单独的行中？

> ID：658813
> 
> 赞同：1
> 
> 时间：2009-03-18T15:37:26.223
> 
> 标签：asp.net, datagrid

我有一个 Datagrid，里面有 3 个 DropDownLists。虽然它是一个 DataGrid，但它实际上只有两行。我在我的代码中使用 DataTable 填充 BoundColumns。

通常，设置和创建两行、保存两行值并稍后检索它们不是问题。但事实证明，我的每一行都必须有不同的列表

例如：

第一行：--- 3 个 DropDownLists 每个都有四个选项：Apples、Oranges、Apples 和 Oranges，两者都不

第二行：--- 3 个 DropDownLists 每个都有四个选项：Grapes、Cherries、Grapes and Cherries，两者都不

所以我想知道实现这一点的最轻松的方法是什么。我认为解决方案与 DropDownList 的 DataSource、DataTextField 和/或 DataValueField 属性有关。但是，如果我在 DataSource 中放置一个函数，我不确定如何将行索引传递给它，以便它知道要返回哪个列表。使用 ItemTypes (Item, AlternatingItem) 也可能有一个解决方案，但如何最好地使用它们？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T16:05:56.997

补充肯布朗宁的回应（如果我理解正确的话）。

如何创建一个从 Datagrid 继承的新控件。在该控件中，有一个公共的通用下拉列表：

```
public List<DropDownList> FruitLists
{
    get;set;
} 
```

如果您像 Ken 建议的那样将控件添加到 RowDataBound 事件中的单元格，请将 DropDownList 添加到列表中，您将能够在回发后遍历它们。

我希望这会有所帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T15:46:40.553

通常，当您在不同的行上需要不同的行为时，最好的方法是使用`RowDataBound`事件。此事件将允许您检查行的 DataItem 以有条件地绑定模板列中的任何控件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T16:05:00.340

您必须检查事件 RowdataBound 事件并在其中检查下拉列表，或者您可以在源代码中使用标签 AlternatingItem ，在这种情况下，您有两行与网格重复并将每个下拉列表的 #Eval 设置为适当的数据如果项目是静态的，您想要从数据源中获取或给它的项目他们的值

# jquery - web2.0弹出？

> ID：658817
> 
> 赞同：1
> 
> 时间：2009-03-18T15:38:07.157
> 
> 标签：jquery, popup, thickbox, modalpopups

我需要的网站需要在用户单击链接时对其进行检查，这些链接会将他们带到外部网站（不要问为什么，它就是这样......）

客户想要某种弹出框，然后会显示“你真的想去吗？” 以及 2 个是或否按钮。

现在，到目前为止，我已经在经典浏览器弹出窗口中完成了所有这些操作，因为如果 JS 关闭，它会非常优雅地降级以离开计划 ahref 链接。我的问题是……有没有比普通的蹩脚弹出窗口更时髦的另一种方法？

我一直在尝试使用[thickbox](http://jquery.com/demo/thickbox/#sectiond-1)和一些[JQuery 滑块](http://www.learningjquery.com/2006/09/slicker-show-and-hide)，但是一旦你禁用了Javascript

a）没有“弹出窗口” b）由于激活不再工作的“弹出窗口”所需的标记，即使链接不再指向它应该去的地方

有什么想法或想法吗？:P

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T15:44:04.553

你应该做的是这样的：

```
$("a.outside").click(function (){
  openPopupWithThickbox();
  var result = getResultFromThickbox();
  return result;
}); 
```

如果用户单击“否”，这将阻止链接激活，但如果用户想离开该站点，该链接将起作用。

当然，它也会优雅地降级。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T15:43:32.963

鉴于可用的选项很多，我会选择 jQuery UI 的[对话框组件](http://jqueryui.com/demos/dialog/#modal-confirmation)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T09:31:00.263

答案是使用thickbox：

```
<a href="http://www.whatever.com" onclick="tb_show('Warning', 'ajax.html?height=300&width=440', 'thickbox');return false"> 
```

然后您可以检索 ajax.html（或其他）并显示。如果要使用按钮关闭厚盒，只需添加：

```
<a href="#" onclick="tb_remove()"> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T21:00:08.347

我有一个使用 jQuery 在页面上执行此操作的请求，并想出了这个：

```
jQuery( function () {
  jQuery( '#warn-dialog' )
    .dialog({
      autoOpen: false,
      modal: true,
      buttons : { 
        'Yes' : function () { 
          document.location.href = jQuery( '#email-link' ).attr( 'href' );
        },
        'No' : function () { 
          jQuery( '#warn-dialog' ).dialog( 'close' ); 
        }
      }
    });
  jQuery( '.warn-link' ).click( function ( event ) {
    event.preventDefault();
    jQuery( '#warn-dialog' ).dialog( 'open' );
  });
}); 
```

使用 HTML 如下：

```
<div id="warn-dialog" class="ui-helper-hidden" title="Warning">
  <p>Are you sure you want to leave?</p>
</div>

<p>
  <a class="warn-link" href="http://link1.com">link1</a>
  <a class="warn-link" href="http://link2.com">link2</a>
</p> 
```

# c# - LinqToSql 奇怪的行为

> ID：658818
> 
> 赞同：4
> 
> 时间：2009-03-18T15:38:25.643
> 
> 标签：c#, linq, linq-to-sql, lambda

我有以下代码：

```
 var tagToPosts = (from t2p in dataContext.TagToPosts
                                    join t in dataContext.Tags on t2p.TagId equals t.Id
                                    select new { t2p.Id, t.Name });
//IQueryable tag2postsToDelete;
foreach (Tag tag in tags)
{
    Debug.WriteLine(tag);
    tagToPosts = tagToPosts.Where(t => t.Name != tag.Name);
}
IQueryable tagToPostsToDelete = (from t2p in dataContext.TagToPosts
                                            join del in tagToPosts on t2p.Id equals del.Id
                                            select t2p);
dataContext.TagToPosts.DeleteAllOnSubmit(tagToPostsToDelete); 
```

where`tags`是一个`List<Tag>`- 由构造函数创建的标签列表，因此它们没有 id。我运行代码，将刹车点与 Debug 对齐，然后等待几个周期。然后我将 tagToPosts.ToList() 放在 Watch 窗口中以执行查询。在 SQL 探查器中，我可以看到以下查询：

```
exec sp_executesql N'SELECT [t0].[Id], [t1].[Name]
FROM [dbo].[tblTagToPost] AS [t0]
INNER JOIN [dbo].[tblTags] AS [t1] ON [t0].[TagId] = [t1].[Id]
WHERE ([t1].[Name]  @p0) AND ([t1].[Name]  @p1) AND ([t1].[Name]  @p2)',N'@p0 nvarchar(4),@p1 nvarchar(4),@p2 nvarchar(4)',@p0=N'tag3',@p1=N'tag3',@p2=N'tag3' 
```

我们可以看到每个参数参数`tag.Name`在一个循环中都有最后一个值。你知道如何解决这个问题并让循环`Where`每次都添加新的条件吗？我可以看到 IQueryable 在执行之前只存储指向变量的指针。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-18T15:42:16.523

将您更改`foreach`为：

```
foreach (Tag tag in tags){
    var x = tag.Name;
    tagToPosts = tagToPosts.Where(t => t.Name != x);
} 
```

这背后的原因是惰性评估和变量捕获。基本上，您在`foreach`声明中所做的*并不是*过滤掉看起来可能的结果。您正在构建一个表达式树，它依赖于一些要执行的变量。重要的是要注意，实际变量是在该表达式树中捕获的，而不是它们在捕获时的值。由于`tag`每次都使用变量（并且它的范围是整体`foreach`，所以它不会在每次迭代结束时超出范围），它被捕获用于表达式的每个部分，最后一个值将用于*所有*它的出现。*解决方案是使用一个在 foreach*范围内的临时变量*所以它会在每次迭代时超出范围，并且在下一次迭代时，它将被视为一个**新变量**。*

 ** * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T17:02:57.763

是的，Mehrdad 的回答是正确的。当闭包在 C# 中捕获变量时（当您的“Where”lambda 引用变量“tag”时会发生这种情况），编译器会应用非常精确的规则来进行捕获。如果捕获的变量在同一范围内，由周围的 { 和 } 括号确定，则该变量的值将按原样捕获。如果它在范围之外，则只会捕获对该变量的引用。在您原来的帖子中，“标签”变量已经在整个循环中循环到最后一个值。但是，如果您进行 Mehrdad 建议的修改，那么您将在同一范围内捕获一个变量，因此该变量的各个值将嵌入到您的闭包中，从而为您提供所需的结果。

顺便说一句，你可能会说，“是的，但是‘tag’变量在同一个范围内。” 但这不是真的，因为在引擎盖下，编译器将 for-each 变成了这样的东西（这非常粗糙，只是为了显示括号会发生什么）：

```
{ 
   var iterator = GetTheIterator();
   { 
      while(iterator.MoveNext())
      {
          // Your loop code here
      }
   }
} 
```

重点是，您的 for-each 迭代器将始终位于循环代码所在的范围之外。

# c# - Nhibernate 与其他 ORM 的区别是什么？

> ID：658824
> 
> 赞同：3
> 
> 时间：2009-03-18T15:39:45.330
> 
> 标签：c#, .net, nhibernate, orm

除了开源和成熟之外，将**nhibernate**与其他 .net ORM 框架（如**Subsonic**、**ADO.NET Entity Framework**等）区分开来的区别因素是什么？

更好的说法是，为什么我应该选择 nhibernate 而不是其他 .net 实体框架？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T15:49:47.740

最大的原因可能是 nHibernate 支持持久化无知；您的实体可以是普通的旧 CLR 对象（无基类）。它还支持 Subsonic 不支持的工作单元（自动跟踪和批处理更新）。此外，Entity 框架不支持隐式延迟加载（当您要访问 Order.OrerItems 时，您必须调用 Order.OrerItems.Load()）。它迫使您考虑延迟加载，但也会因基础设施问题而污染您的业务逻辑。

# java - 需要一个示例 - 使用 Microsoft Crypto API 在 Java 中解密字符串

> ID：658826
> 
> 赞同：0
> 
> 时间：2009-03-18T15:40:19.027
> 
> 标签：java, encryption, cryptography, mscapi

首先，我不是 Java 程序员。我正在寻找这个问题的示例解决方案，因为我的 Java 开发人员没有太多使用加密的经验。我们在网上找到的所有内容都与加密网页和处理 MS 密钥库有关。我们只想使用来自 PowerBuilder (PB) 的单个字符串并能够在 Java 中对其进行解密。这里的限制是 MS 库。由于某些限制，我们坚持使用这种加密方法，因此由 Java 端来处理被抛出的内容。

我有一个 PB 版本 10.2 程序，它需要调用这个 Java 实用程序并传递一个用户名和密码。我们正在尝试将密码加密为命令行友好字符串，因为这就是 PB 调用 Java 应用程序的方式。

在 PB 中，我使用以下对象： [http ://www.topwizprogramming.com/freecode_crypto.html](http://www.topwizprogramming.com/freecode_crypto.html)

代码的作用是包装 advapi32.dll 中的 Microsoft 加密 API。它使用的功能是：

CryptAcquireContext [http://msdn.microsoft.com/en-us/library/aa379886(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa379886(VS.85).aspx)

CryptCreateHash [http://msdn.microsoft.com/en-us/library/aa379908(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa379908(VS.85).aspx)

CryptHashData [http://msdn.microsoft.com/en-us/library/aa380202(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa380202(VS.85).aspx)

CryptDeriveKey [http://msdn.microsoft.com/en-us/library/aa379916(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa379916(VS.85).aspx)

CryptEncrypt [http://msdn.microsoft.com/en-us/library/aa379924(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa379924(VS.85).aspx)

它使用 Microsoft Strong Cryptographic Provider 和 PROV_RSA_FULL。该代码将要加密的数据转换为 BLOB，然后将其传递给加密函数。在那里，它获取一个上下文，从上下文创建一个哈希对象，对密码进行哈希处理，从哈希中获取一个会话密钥，然后调用加密/解密。最后一件事是它接受返回的 BLOB 并将其转换为 ANSI 字符集下的字符串。

有许多常量，我一眼就知道其中一些来自哪里，而另一些则不是： ULong CRYPT_NEWKEYSET = 8 常量 ULong ERROR_MORE_DATA = 234

无论是在 1.5 中使用 BouncyCastle 之类的东西还是在 1.6 中使用用于 MS 的 Sun 加密接口来完成，我都不在乎，我们只是渴望看到这项工作，而且老实说我们都在头疼。

* * *

嘿，我需要加密一个字符串并将其存储为一个文件，然后我需要再次读取该文件并解密相同的字符串。但我不想加密整个文件。一旦我将所需的加密值存储在文件中，我需要将其单独转换为原始字符串。你能帮我看看示例代码吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-18T18:10:39.803

```
import java.security.GeneralSecurityException;
import java.security.MessageDigest;

import javax.crypto.Cipher;
import javax.crypto.spec.SecretKeySpec;

public class Decrypt
{

  public static void main(String... argv)
    throws Exception
  {
    byte[] password = "password".getBytes("UTF-8");
    byte[] ciphertext = { -68, -112,  66, 78,   85,   50, 22, -63, 
                           16,   24, -45,  4, -116,  -14, 88,  34, 
                          -85,  116, 105, 59,   45, -126 };
    byte[] plaintext = decrypt(password, ciphertext);
    System.out.println(new String(plaintext, "UTF-8"));
  }

  public static byte[] decrypt(byte[] password, byte[] ciphertext)
    throws GeneralSecurityException
  {
    MessageDigest digest = MessageDigest.getInstance("MD5");
    byte[] hash = digest.digest(password);
    Cipher rc4 = Cipher.getInstance("RC4");
    rc4.init(Cipher.DECRYPT_MODE, new SecretKeySpec(hash, "RC4"));
    return rc4.doFinal(ciphertext);
  }

} 
```

*注意：*

这种“加密”是可怕的。RC4 是一种密钥流密码。**切勿将相同的密钥流密码密钥用于多条消息！**以这种方式对多条消息使用相同的密码使得恢复明文和给定多个密文的密钥变得微不足道。鉴于 MD5 的弱点，他们可能也可以恢复密码。这些缺陷足以破坏良好的流密码，但 RC4 与 MD5 一样，也有其自身的漏洞，不建议用于新应用程序。

我敢肯定你知道这一切，并且受到一些遗留应用程序的限制，但如果其他人看到这个答案，他们需要了解你被迫使用的 PowerBuilder“加密”库是没有能力实现的。

* * *

由于密码输入和输出始终是“二进制”，因此当密文必须通过面向文本的通道（如命令行）时，通常使用文本编码，例如 Base-64 或 Base-85。如果可能，您能否在调用 Java 实用程序之前对密文进行 Base-64 编码？这将使您免受任何字符编码问题的影响。

# apache-flex - Adobe AIR 更新框架——更新时总是创建一个新的桌面图标

> ID：658829
> 
> 赞同：0
> 
> 时间：2009-03-18T15:40:55.670
> 
> 标签：apache-flex, air

我正在使用 AIR 更新框架 (ApplicationUpdaterUI)，每当用户更新应用程序时，都会创建一个新的桌面图标（覆盖那里的任何现有桌面图标）。有没有办法抑制这种行为，或者有人可以提出解决方法？

情况如下：

我们的 AIR 应用程序使用单独的引导应用程序在 AIR 应用程序启动之前启动一些服务，因此用户不要自己运行 AIR 可执行文件，这一点很重要。我们的安装程序会创建一个指向引导可执行文件的桌面图标。当用户更新应用程序时，它会将我们的桌面图标替换为 AIR 快捷方式。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-09-21T09:32:50.487

我认为您不能覆盖标准 AIR 图标的创建..

也许您可以将您的帮助应用程序配置为 Windows 服务/unix 守护程序，在系统启动时自动启动它？

# mfc - 处理过时的 RTF 版本

> ID：658833
> 
> 赞同：2
> 
> 时间：2009-03-18T15:41:57.913
> 
> 标签：mfc, rtf

总结问题：

1.  你知道可以将文件保存为 RTF 1.6 格式的轻量级应用程序吗？
2.  你知道RTF Abiword的“旧应用的富文本格式”对应哪个版本吗？
3.  您知道一种检查 RTF 文件并确定其编码的 RTF 版本的方法吗？
4.  你知道哪个 DLL 描述了 Windows NT 4.0 机器上的 RTF 格式以及它是否可以升级？

* * *

我有一个在嵌入式 Windows NT 4.0 机器上运行的旧版 MS Visual C++ 6.0 MFC 应用程序。该应用程序使用 MFC 的[CRichEditView](http://msdn.microsoft.com/en-us/library/bcb28z09(VS.80).aspx)类提供应用程序内帮助，以从名为 help.rtf的[RTF文件中提取文本。](http://en.wikipedia.org/wiki/Rich_Text_Format)帮助文件保存为 RTF 版本 1.6。它一直使用 MS Word 2000 或 Windows NT 4.0 附带的写字板版本进行编辑。

问题是我们的开发人员工作站倾向于安装 Windows XP（及其版本的写字板）和 Office 2003 或更高版本，两者都使用比 1.6 更新的 RTF 版本，而且要找到一台安装了文件可以以该过时的格式进行编辑和重新保存。如果使用较新版本的 Word 或写字板来保存文件，则会将其保存为较新版本的 RTF。然后，当应用程序在 NT 机器上运行时，帮助文本不能正确显示。（虽然在 XP 机器上运行相同的应用程序时，帮助文本确实可以正确显示。）

所以，我想做两件事之一：

1.  找到一个应用程序（最好比 Word 2000 更轻量级），它将以 RTF 版本 1.6 格式保存文件，我们可以使用它来编辑帮助文件。
2.  想办法让 NT 机器正确读取更高版本的 RTF。

在第一方面，我试过[AbiWord](http://www.abisource.com/)，它有一个[“旧应用程序的富文本格式”](http://www.abisource.com/help/en-US/info/infoformats.html)选项，但我不知道这个选项输出的是什么版本的 RTF。你知道这是什么版本吗？[不幸的是，根据所有版本的RTF 规范](http://msdn.microsoft.com/en-us/library/aa140301(office.10).aspx)的这段可爱的段落，文件中的元数据并不明显，它只是说“rtf1” 。有没有办法分析 RTF 文件并确定它编码的 RTF 版本？

> 本 RTF 规范中描述的 RTF 标准，虽然标题为 1.6 版，但在语法上继续对应于 RTF 规范版本 1。因此，\rtf 控制字的数字参数 N 仍应作为 1 发出。

在第二方面，我想知道是否有一些我可以更新的 DLL，以便 Windows NT 能够识别该格式的较新版本。你知道哪个 DLL 描述了 RTF 格式，是否可以升级？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T16:21:41.343

我相信富编辑格式是由富编辑控件本身决定的。我不会尝试升级 DLL，因为有很多东西可能会损坏。

有关使用更高版本的富编辑控件的提示，请参阅此 MSDN 说明。NT 4.0 中应该有 2.0 版。

[http://msdn.microsoft.com/en-us/library/tt1cfb9f(VS.80).aspx](http://msdn.microsoft.com/en-us/library/tt1cfb9f(VS.80).aspx)

您可以尝试从 NT 系统复制写字板版本，看看是否可以作为替代方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T17:58:22.763

[遵循以 Mark Ransom 的回答](https://stackoverflow.com/questions/658833/dealing-with-obsolete-versions-of-rtf/658994#658994)开始的一系列提示，我最终将 XP 机器上的 C:\Windows\System32\ 中的riched20.dll 和riched32.dll 复制到 NT 机器上的 C:\WinNT\System32\ 中。在我这样做之后，在 XP 机器上用 WordPad 或 Word 编辑的 RTF 文件在 WordPad 和我在 NT 机器上的应用程序上都正确呈现。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-18T16:20:53.827

首先想到的是写字板。它在每台机器上，并且在它的 RTF 中非常轻量级。在许多简单的 RTF 任务中，我发现它比 Word 好得多。

# scrum - 您如何将 Scrum 应用到 Web 开发的设计部分？

> ID：658836
> 
> 赞同：16
> 
> 时间：2009-03-18T15:42:05.323
> 
> 标签：scrum, agile

我开始学习 Scrum，我有兴趣与我们的开发团队一起尝试。我对此有很多疑问……但我最大的心理障碍是实际的图形设计。

在我们当前的开发周期 [瀑布式] 中，我们的图形设计师根据松散的 PRD 来布置带有所有图像等的页面。如果我们要利用 Scrum 的方法，这种发展将如何进行？我认为我们习惯于看到全局并朝着它前进……而不是在我们进行时将视觉部分组合在一起，这就是我期望的图形设计的 Scrum 政策。

至少线框积压中的所有功能是闻所未闻的吗？还是更明智的做法——对于第一个 sprint——以这样一种方式设计它的功能，以便我们可以随时添加其他 sprint 的新特性？（即，当需要新功能时，讨论“这适合当前设计的什么地方？”）

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-03-18T16:12:49.743

这就是我建议你这样做的方式（即，我们如何尝试这样做）

Pre-sprint 0：确保你对自己想做的事情有一个很好的愿景。不必非常详细，但不应该是“我们想建立一个社交网站”

**Sprint 0**：开发者工具——设置 CI 服务器，处理部署脚本等，所以所有的基本框架都完成了。最后，您应该能够按下一个按钮（最坏的情况：在远程服务器上运行单个命令），该按钮在您的源代码控制系统中获取代码，构建它，打包它，运行您想要的所有测试它，报告回来，如果可能的话，将它安装在测试服务器上（或者至少导致你可以在测试服务器上安装一个包）。

这时候，设计师正在做线框图。他们的目标是为您认为需要的尽可能多的站点制作基本线框（考虑站点地图和流程，而不是字段和像素）。然后，完成后，与项目经理一起制定最重要的事情，并详细了解线框图。还不是像素。

项目经理等正在与设计师和业务/利益相关者合作，为您编写故事和任务以供您执行和跟踪。显然，他们需要了解站点地图等才能做到这一点。

这可能需要不止一个冲刺。从一个开始（我建议 2-3 周的冲刺 - 1 太短，4 太长），看看你还需要做多少等。

所以在 sprint 0 结束时，你有：

*   很多故事，按优先顺序排列（你可以稍后添加更多，事实上你总是会随着需求的变化而变化）
*   站点地图（即，对整个事物将包含的内容的总体概念）
*   第一个工作块的线框
*   您所有的工具都在工作和设置
*   您的 CI、错误跟踪、源代码控制和部署系统已到位

**那么你开始 sprint 1**

请记住，对于前 3-4 个 sprint，您将不知道您在 sprint 中可以做多少工作，所以希望会出错！尽可能多地完成工作（按照业务/ PM 安排的优先顺序），你认为你可以肯定完成。您以后可以随时服用更多！

您大量开发这些页面，并且设计人员在下一个页面块上进行线框（由 PM 确定）。也许设计师为这些页面做艺术，所以你可以在下一个冲刺中做

所以，你正在开发你拥有的东西，而设计师正在为你的下一个 sprint 设计东西。

**当然，他们也可以进行 Scrum 流程，只是他们更早开始了 sprint！**

**现在重复，直到你用完工作**

在冲刺期间，如果（比如说）需求发生变化或添加了新内容，那么就会为此编写一个新故事，并将其安排到工作中。如果它是超高优先级，它可能会排在首位，并成为下一个 sprint 的首要项目（通常是 1-2 周之后）。或者它可能是一个很好的，所以它在底部 - 业务决定。

PM/设计师需要知道他们可以改变事情，但改变确实会产生后果，所以前后改变不符合他们的（财务）利益。但需求确实会发生变化，XP 和 Scrum 比瀑布式更好地处理这个问题。

不要忘记：

*   您可以随时停止 sprint 并重新开始计划，例如，如果需求变化太大，或者您的工作已用完
*   你可以安排比你有时间做更多的工作，只要该工作没有被承诺（即，它是“额外的”或“延伸的”工作）

你的 PM 应该能够预测项目何时结束——看看你在上一个 sprint 中做了多少工作（你的速度），然后用这个数字除以剩下的工作量，你就得到了要进行的 sprint 的数量。简单的。

哦，阅读故事点 - 不要以数小时或数天来估计故事。使用积分。为了引导它，只需制作您估计（例如）8 的第一个故事（序列为 1、2、3、5、8、13、21、40、60、100、无限）。然后取第二个故事，并相对于第一个故事估计它 - 它是工作的两倍（13）吗？一半的工作（5）？差不多（8）？

在冲刺结束时，把你做了多少分加起来，这就是你的速度。你可以承诺在下一个 sprint 中做的最大工作量就是这个量。你总是可以提前停止冲刺，或者如果你提前用完，就从积压的工作中抽出更多的工作。随着您的前进，您的速度将稳定下来。

该死，我敢肯​​定有关于如何运行它的书籍等，所以我会停下来:)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-21T18:13:13.077

我强烈不同意杰森提供的答案。Scrum 的全部意义在于摆脱设计师首先“做他们的事情”然后继续做其他事情的方法。这完全 100% 违反了所有精益 / Scrum 原则！

将设计师纳入 Scrum 流程的方法？把它们扔进去！确保您不只是将瀑布项目包装到 Scrum 中，因为这是通往失败的最佳途径！Scrum 只有在没有例外地实施时才有效。“Scrum，但是……”是最糟糕的项目模型。组织工作，以便可以同时进行设计和开发。不要过度设计初始设计，而是让它成为一个推拉式的情况，硬币的两面都会影响另一面。Scrum 的重点是迭代、迭代和迭代，因此要充分利用它。

此外，实际上完全避开传统的基于 Photoshop 的设计非常简单。您可以从 Signal vs. Noise 中这篇出色的博客文章中了解更多信息： [http ://www.37signals.com/svn/posts/1061-why-we-skip-photoshop](http://www.37signals.com/svn/posts/1061-why-we-skip-photoshop)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T16:12:00.370

我之前做过这样的事情，设计师在早期迭代中做他们的事情，他们的工作产品被开发团队在以后的迭代中使用。随着开发团队开始工作，设计人员将继续进行项目的其他部分，或者可能进行其他项目。

> 我认为我们习惯于看到大局并朝着大局前进

你仍然可以这样做。您的设计师可以进行更大的前期设计，开发团队可以使用 Scrum 进行迭代。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-03-10T20:14:41.763

对于 sprint 0 中的设计部分，您可以使用 Styletyles ( [http://styletil.es](http://styletil.es) ) 之类的技术来确定项目所需的图形样式。因此，您不需要预先进行大型设计，并且在冲刺时仍然保持敏捷。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-12-13T22:13:20.803

这很容易！:) 好吧，让我分享一下我们是如何做到的。

# 第一次冲刺

1) 产品负责人创建线框并添加到 backlog（我们使用 Yodiz，www.yodiz.com） 2) 我们的平面设计师创建模型并将它们放在模型共享工具 (www.concept.ly) 3) 我们的开发人员致力于设置服务器。如果一切准备就绪，我们有非常聪明的产品负责人，您将始终有待选择的待办事项项目。

# 冲刺二

1) 开发人员开始制作最终的模型，这些模型在概念上已经完成。2) 设计师在积压中由产品所有者添加的其他线框工作。

我告诉过你这很容易！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-09T17:06:37.277

我愿意分享。我是未来社交应用程序开发团队的 Scrum Master。这个团队有 1 名用户界面设计师、1 名用户体验设计师（我）、1 名前端开发人员（css、ajax 等）和 3 名程序员。

这是我们第一个使用 SCRUM 框架的项目，因此非常具有挑战性。Scrum 日常会议的趋势是，我们的设计工作从未完全完成，因为我们最初的产品积压中有“用户希望被说服注册”之类的故事，然后我们在该故事中添加了“演示方式”，因此在那里我们可以确定需要做什么（即我们需要做线框，完成文案等......）

那，可以做得更好。根据该故事逐项列出每项任务，并估计每项任务的时间。例如，在产品积压期间，我们可以从那里按顺序创建这些：站点地图 > 任务流 > 线框

现在的问题是，我们是否在冲刺中完成所有这些工作？或者我们应该在任何 sprint 之前就这样做吗？如果我们在 sprint 之外进行，就违背了 scrum 的目的，对吗？

做过用户体验设计的人都知道，这些任务需要相当长的时间来准备。那么为什么不把所有这些都作为冲刺的一部分呢？让程序员也参与这些任务。

线框图在整个项目期间非常重要。它就像建筑物的蓝图，从头到尾都在使用。

因此，在您的第一个 sprint 期间，根据产品积压工作做一个初始线框图。并在每隔一个 sprint 期间相应地调整线框。我们的程序员将根据任务流程设计他们的代码，然后根据线框图直观地创建它。

哦，顺便说一句，不要太在意产品的外观（尽管拥有初始设计模型总是一件好事）。相反，专注于用户的需求和愿望，并设计一个非常以用户为中心的流程来实现这一点。然后我们的设计师会弄清楚他将要设计什么样的界面。如果线框设计得当，设计师在设计用户界面时会遇到很少的问题。创建文案也是如此。

总之，在每次迭代中携手并进。对于那里的初学者（比如我），给 SCRUM 一个为你工作的机会。如果它适用于像[Fantasyinteractive.com](http://www.kontain.com/fi/entries/25191/fi-goes-agile/)这样的公司，那么它也适用于你和我 :)

ps 对于伟大的线框，使用omnigraffle (mac) 是狗屎！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-05-19T06:50:06.557

> 如果我们要利用 Scrum 的方法，这种发展将如何进行？

虽然这篇文章很老，但它促使我自己研究。我找到了 Jeff Patton 为 UX 设计师/从业者编写的“十二种新兴实践”，我认为它特别适合这个问题，并且是一个非常有用的框架集：

1.  驱动力：用户体验从业者是客户或产品所有者团队的一部分。
2.  预先进行研究、建模和设计 - 但仅此而已。
3.  分块你的设计工作
4.  使用并行轨道开发来领先，并跟随在后面。
5.  用复杂的工程故事来争取设计时间。
6.  培养用户验证组，用于持续的用户验证。
7.  将持续的用户研究安排在与开发不同的轨道上。
8.  将用户时间用于多项活动。
9.  在开发之前使用 RITE 迭代 UI。
10.  低保真原型。
11.  将原型视为规范。
12.  成为设计促进者。

如果您想更深入地挖掘，杰夫将其拼写为[agileproductdesign.com。](http://agileproductdesign.com/blog/emerging_best_agile_ux_practice.html)

# internet-explorer - Internet Explorer 自动化：如何抑制打开/保存对话框？

> ID：658839
> 
> 赞同：4
> 
> 时间：2009-03-18T15:42:13.420
> 
> 标签：internet-explorer, automation, mshtml

**通过 MSHTML 控制 IE 实例时，如何禁止打开/保存非 HTML 内容的对话框？**

我需要从另一个系统获取数据并将其导入我们的系统。由于预算限制，一段时间内无法在另一边进行开发（例如 WS），所以我现在唯一的选择是进行网络抓取。

远程站点是基于 ASP.NET 的，所以简单的 HTML 请求不起作用——太多的 JS。

我编写了一个简单的 C# 应用程序，它使用 MSHTML 和 SHDocView 来控制 IE 实例。到目前为止一切顺利：我可以执行登录、导航到所需页面、填充必填字段并提交。

然后我面临几个问题：

首先是该报告正在另一个窗口中打开。我怀疑我也可以通过枚举系统中的 IE 窗口来附加到该窗口。

其次，比较麻烦的是报告本身是CSV文件，并触发打开/保存对话框。我想避免它并让 IE 将文件保存到给定的位置，或者我也可以以编程方式单击对话框按钮（如何？）

我实际上完全不是 Windows 人（unix/J2EE），希望有更好知识的人能给我提示如何完成这些任务。

谢谢！

**更新**

我在 MSDN 上找到了一份有前途的文件：http: [//msdn.microsoft.com/en-ca/library/aa770041.aspx](http://msdn.microsoft.com/en-ca/library/aa770041.aspx)

*控制下载的内容类型以及下载后 WebBrowser 控件对它们的处理方式。例如，您可以阻止在用户单击链接时播放视频、运行脚本或打开新窗口，或者阻止下载或执行 Microsoft ActiveX 控件。*

慢慢地读...

**更新 2：让它工作，有点……**

最后我让它工作了，但是以一种丑陋的方式。本质上，我在“导航之前”注册了一个处理程序，然后，在处理程序中，如果 URL 与我的目标文件匹配，我取消导航，但记住 URL，并使用 WebClient 类直接访问和下载该临时 URL。

我不能在这里复制整个代码，它包含很多垃圾，但这里是必不可少的部分：

安装处理程序：

```
_IE2.FileDownload += new DWebBrowserEvents2_FileDownloadEventHandler(IE2_FileDownload);
_IE.BeforeNavigate2 += new DWebBrowserEvents2_BeforeNavigate2EventHandler(IE_OnBeforeNavigate2); 
```

记录 URL，然后取消下载（从而阻止保存对话框出现）：

```
public string downloadUrl;

void IE_OnBeforeNavigate2(Object ob1, ref Object URL, ref Object Flags, ref Object Name, ref Object da, ref Object Head, ref bool Cancel)
{
    Console.WriteLine("Before Navigate2 "+URL);

    if (URL.ToString().EndsWith(".csv"))
    {
        Console.WriteLine("CSV file");
        downloadUrl = URL.ToString();
    }

    Cancel = false;
}

void IE2_FileDownload(bool activeDocument, ref bool cancel)
{
    Console.WriteLine("FileDownload, downloading "+downloadUrl+" instead");
    cancel = true;
}

    void IE_OnNewWindow2(ref Object o, ref bool cancel)
    {
        Console.WriteLine("OnNewWindow2");

        _IE2 = new SHDocVw.InternetExplorer();
        _IE2.BeforeNavigate2 += new DWebBrowserEvents2_BeforeNavigate2EventHandler(IE_OnBeforeNavigate2);
        _IE2.Visible = true;
        o = _IE2;

        _IE2.FileDownload += new DWebBrowserEvents2_FileDownloadEventHandler(IE2_FileDownload);

        _IE2.Silent = true;

        cancel = false;
        return;
    } 
```

并在调用代码中使用找到的 URL 进行直接下载：

```
 ...
        driver.ClickButton(".*_btnRunReport");
        driver.WaitForComplete();

        Thread.Sleep(10000);

        WebClient Client = new WebClient();
        Client.DownloadFile(driver.downloadUrl, "C:\\affinity.dump"); 
```

（驱动程序是 IE 实例的简单包装器 = _IE）

希望对某人有所帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T18:33:15.223

您无法完全控制浏览器的行为方式，因为最终用户可以将其浏览器设置为始终打开具有特定内容类型的文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T15:53:58.570

最简单的方法是在进行下载的系统上调整 CSV 文件的 MIME 类型。由于与 .CSV 文件相关的操作，IE 正在尝试下载该文件。

我认为您可以通过转到工具-文件夹选项-文件类型在 Windows 资源管理器中更改此设置。如果将 CSV 文件与 Internet Explorer 关联，则 CSV 文件将在 IE 中打开。此时您应该能够使用 IE 自动化将当前打开的文档保存到文件中。

# c# - 这段代码在性能方面有什么问题？List.Contains，随机使用，线程？

> ID：658868
> 
> 赞同：1
> 
> 时间：2009-03-18T15:47:01.817
> 
> 标签：c#, multithreading, loops, list, performance

我有一个本地类，它有一个用于构建字符串列表的方法，我发现当我点击这个方法（在 1000 次的 for 循环中）时，它通常不会返回我请求的数量。

我有一个全局变量：

```
string[] cachedKeys 
```

传递给方法的参数：

```
int requestedNumberToGet 
```

该方法看起来与此类似：

```
List<string> keysToReturn = new List<string>();
int numberPossibleToGet = (cachedKeys.Length <= requestedNumberToGet) ? 
cachedKeys.Length : requestedNumberToGet;
Random rand = new Random();

DateTime breakoutTime = DateTime.Now.AddMilliseconds(5);

//Do we have enough to fill the request within the time? otherwise give 
//however many we currently have
while (DateTime.Now < breakoutTime
    && keysToReturn.Count < numberPossibleToGet
    && cachedKeys.Length >= numberPossibleToGet)
{
    string randomKey = cachedKeys[rand.Next(0, cachedKeys.Length)];
    if (!keysToReturn.Contains(randomKey))
        keysToReturn.Add(randomKey);
}

if (keysToReturn.Count != numberPossibleToGet)
    Debugger.Break(); 
```

我在 cachedKeys 中有大约 40 个字符串，长度不超过 15 个字符。

我不是线程专家，所以我实际上只是在循环中调用此方法 1000 次，并始终在那里进行调试。

运行它的机器是一个相当强大的台式机，所以我希望突破时间是现实的，实际上它在循环的任何点随机中断（我见过 20 秒、100 秒、200 秒、300 秒）。

有人知道我在哪里出错了吗？

**编辑：仅限于 .NET 2.0**

**编辑：突破的目的是，如果该方法执行时间过长，客户端（使用 XML 提要数据的几个 Web 服务器）将不必等待其他项目依赖项初始化，它们只需给出0个结果。**

**编辑：以为我会发布性能统计数据**

**原来的**

*   '0.0042477465711424217323710136' - 10
*   '0.0479597267250446634977350473' - 100
*   '0.4721072091564710039963179678' - 1000

**飞碟**

*   '0.0007076318358897569383818334' - 10
*   '0.007256508857969378789762386' - 100
*   '0.0749829936486341141122684587' - 1000

**弗雷迪里奥斯**

*   '0.0003765841748043396576939248' - 10
*   '0.0046003053460705201359390649' - 100
*   '0.0417058592642360970458535931' - 1000

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-18T15:57:49.687

为什么不直接获取列表的副本 - O(n) - 随机播放它，也是 O(n) - 然后返回已请求的键数。实际上，shuffle 只需要 O(nRequested)。继续将列表中未洗牌位的随机成员与未洗牌位的最开始交换，然后将洗牌位扩展 1（只是一个名义计数器）。

编辑：这是一些产生结果的代码`IEnumerable<T>`。请注意，它使用延迟执行，因此如果您在第一次开始迭代结果之前更改传入的源，您将看到这些更改。获取第一个结果后，元素将被缓存。

```
static IEnumerable<T> TakeRandom<T>(IEnumerable<T> source,
                                    int sizeRequired,
                                    Random rng)
{
    List<T> list = new List<T>(source);

    sizeRequired = Math.Min(sizeRequired, list.Count);

    for (int i=0; i < sizeRequired; i++)
    {
        int index = rng.Next(list.Count-i);            
        T selected = list[i + index];
        list[i + index] = list[i];
        list[i] = selected;
        yield return selected;
    }
} 
```

这个想法是，在您获取`n`元素之后的任何时候，`n`列表的第一个元素将是那些元素 - 所以我们确保我们不会再次选择这些元素。然后从“其余”中选择一个随机元素，将其交换到正确的位置并产生它。

希望这可以帮助。如果您使用的是 C# 3，您可能希望通过将“this”放在第一个参数前面来使其成为扩展方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-18T16:12:21.897

一些想法。

首先，您的 keysToReturn 列表可能会在每次循环中添加，对吗？您正在创建一个空列表，然后将每个新键添加到列表中。由于列表没有预先确定大小，因此每个添加都变成了 O(n) 操作（[请参阅 MSDN 文档](http://msdn.microsoft.com/en-us/library/3wcytfd1.aspx)）。要解决此问题，请尝试像这样预先调整列表的大小。

```
int numberPossibleToGet = (cachedKeys.Length <= requestedNumberToGet) ? cachedKeys.Length : requestedNumberToGet;
List<string> keysToReturn = new List<string>(numberPossibleToGet); 
```

其次，你的突破时间在 Windows 上是不现实的（好的，好的，不可能的）。我读过的关于 Windows 计时的所有信息都表明，您可能希望的最好分辨率是 10 毫秒，但实际上它更像是 15-18 毫秒。事实上，试试这段代码：

```
for (int iv = 0; iv < 10000; iv++) {
    Console.WriteLine( DateTime.Now.Millisecond.ToString() );
} 
```

您将在输出中看到的是离散跳跃。这是我刚刚在我的机器上运行的示例输出。

```
13
...
13
28
...
28
44
...
44
59
...
59
75
... 
```

毫秒值从 13 跳到 28 到 44 到 59 到 75。这大约是我机器的 DateTime.Now 函数中 15-16 毫秒的分辨率。此行为与您在 C 运行时 ftime() 调用中看到的一致。换句话说，它是 Windows 计时机制的系统特征。关键是，你不应该依赖一致的 5 毫秒突破时间，因为你不会得到它。

第三，我是否正确假设突破时间是防止主线程锁定？如果是这样，那么很容易将您的函数生成到 ThreadPool 线程并让它运行完成，无论需要多长时间。然后您的主线程可以对数据进行操作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-18T21:20:39.020

主要问题是在随机场景中使用重试以确保您获得唯一值。这很快就会失控，特别是如果请求的项目数量接近获得的项目数量，即如果您增加密钥的数量，您将不会经常看到该问题，但这是可以避免的。

以下方法通过保留剩余键的列表来实现。

```
List<string> GetSomeKeys(string[] cachedKeys, int requestedNumberToGet)
{
    int numberPossibleToGet = Math.Min(cachedKeys.Length, requestedNumberToGet);
    List<string> keysRemaining = new List<string>(cachedKeys);
    List<string> keysToReturn = new List<string>(numberPossibleToGet);
    Random rand = new Random();
    for (int i = 0; i < numberPossibleToGet; i++)
    {
        int randomIndex = rand.Next(keysRemaining.Count);
        keysToReturn.Add(keysRemaining[randomIndex]);
        keysRemaining.RemoveAt(randomIndex);
    }
    return keysToReturn;
} 
```

您的版本需要超时，因为您可能会长时间重试以获取值。特别是当您想要检索整个列表时，在这种情况下，您几乎肯定会因依赖重试的版本而失败。

**更新：**上面的表现比这些变化更好：

```
List<string> GetSomeKeysSwapping(string[] cachedKeys, int requestedNumberToGet)
{
    int numberPossibleToGet = Math.Min(cachedKeys.Length, requestedNumberToGet);
    List<string> keys = new List<string>(cachedKeys);
    List<string> keysToReturn = new List<string>(numberPossibleToGet);
    Random rand = new Random();
    for (int i = 0; i < numberPossibleToGet; i++)
    {
        int index = rand.Next(numberPossibleToGet - i) + i;
        keysToReturn.Add(keys[index]);
        keys[index] = keys[i];
    }
    return keysToReturn;
}
List<string> GetSomeKeysEnumerable(string[] cachedKeys, int requestedNumberToGet)
{
    Random rand = new Random();
    return TakeRandom(cachedKeys, requestedNumberToGet, rand).ToList();
} 
```

一些具有 10.000 次迭代的数字：

```
Function Name    Elapsed Inclusive Time Number of Calls
GetSomeKeys              6,190.66       10,000
GetSomeKeysEnumerable     15,617.04       10,000
GetSomeKeysSwapping        8,293.64       10,000 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-18T16:23:37.017

`HashSet`改为使用，`HashSet`查找速度比`List`

```
HashSet<string> keysToReturn = new HashSet<string>();
int numberPossibleToGet = (cachedKeys.Length <= requestedNumberToGet) ? cachedKeys.Length : requestedNumberToGet;
Random rand = new Random();

DateTime breakoutTime = DateTime.Now.AddMilliseconds(5);
int length = cachedKeys.Length;

while (DateTime.Now < breakoutTime && keysToReturn.Count < numberPossibleToGet) {
    int i = rand.Next(0, length);
    while (!keysToReturn.Add(cachedKeys[i])) {
        i++;
        if (i == length)
            i = 0;
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-18T16:25:19.540

考虑使用`Stopwatch`而不是`DateTime.Now`. 这可能只是`DateTime.Now`因为您谈论毫秒时的不准确性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T15:52:48.947

问题很可能在这里：

```
if (!keysToReturn.Contains(randomKey))
    keysToReturn.Add(randomKey); 
```

这将需要遍历列表以确定键是否在返回列表中。但是，可以肯定的是，您应该尝试使用工具对其进行分析。此外，5 毫秒在 0.005 秒时相当快，您可能需要增加它。

# xml - 使用来自数据库的 XML 而不是 XML 文件填充标准 .net 2.0 GridView / TreeView 控件

> ID：658876
> 
> 赞同：-1
> 
> 时间：2009-03-18T15:50:26.007
> 
> 标签：xml, gridview, .net-2.0, treeview, xslt

目前，我正在使用使用 XSLT 样式表的物理 XML 文档填充标准 .net 2.0 GridView 和 TreeView 控件。但我需要使网格的填充更加动态，同时仍然使用 XSLT 样式表

有谁知道除了使用物理 XML 文档之外，是否可以通过另一种方式填充标准 .net 2.0 Gridview 和 TreeView 控件？

我目前有一些 XML 代码存储在数据库中。我可以从数据库中检索它，在其上应用 XSLT 样式表并将其传递到网格/树上，而无需制作物理文件吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T17:26:19.207

如果您使用的是 XmlDataSource，则可以将 Data 属性设置为任何 Xml 块。例如，您可以有一个调用 Web 服务、返回一些 Xml、执行转换然后分配给 Data 属性的方法。然后在您的网格上调用 DataBind 将更新。请务必注意，如果您在 DataFile 属性中设置了一个值，那么这将始终优先于您为 Data 指定的任何内容。

您可以使用完全相同的方法从数据库中检索一些 Xml，转换并分配给 XmldataSource.Data

高温高压

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T16:14:10.067

可以使用 XML`GridView`通过[`XmlDataSource`](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.xmldatasource.aspx)控件来填充 a。以下链接应该可以帮助您入门：

> [XmlDataSource Web 服务器控件概述 (MSDN)](http://msdn.microsoft.com/en-us/library/494y92bs.aspx)
> 
> [ASP.NET 2.0 的 GridView 示例：使用数据源控件访问数据 (MSDN)](http://msdn.microsoft.com/en-us/library/aa479341.aspx)
> 
> [ASP.NET 快速入门教程 - XmlDataSource](http://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/data/xmldatasource.aspx)

最后一个链接没有专门介绍将 a 绑定`GridView`到 the`XmlDataSource`但确实提供了一些有用的参考代码。您可能需要将源 XML 转换为`GridView`可以理解的格式。

# windows - 在 windows / direct3d 中使用 ttf 文件中的字体

> ID：658878
> 
> 赞同：3
> 
> 时间：2009-03-18T15:52:10.150
> 
> 标签：windows, fonts, directx, direct3d

我正在使用 direct3d 9 并使用 D3DXCreateFont 创建可用于将文本写入屏幕的字体对象。但是我想使用我在 TTF 文件中的字体而不是安装的字体。有什么方法可以从 TTF 文件创建字体对象，而无需先将字体安装到我不想做的窗口中？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-18T15:57:57.890

尝试使用[AddFontResourceEx 函数](http://msdn.microsoft.com/en-us/library/dd183327(VS.85).aspx)。

re: MSDN[字体安装和删除](http://msdn.microsoft.com/en-us/library/dd144833(VS.85).aspx)

# python - 在 Visual Studio 2005 中链接到 Python 导入库

> ID：658879
> 
> 赞同：8
> 
> 时间：2009-03-18T15:52:48.450
> 
> 标签：python, visual-studio, import, linker

我有一个嵌入了 Python 的 C++ 应用程序。我正在使用 Visual Studio 2005 构建。当我尝试链接到 python26.lib 时，我得到了许多未解析的符号，所有这些符号都以“__imp”开头：

错误 LNK2019：函数 _main 中引用的未解析的外部符号 __imp__Py_Initialize

python26.lib 是一个导入库（由 Python 2.6 安装程序安装）。我该怎么做才能解决这些符号？它们确实存在于导入库中（dumpbin /all 显示它们）。谢谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-18T21:26:04.233

看起来我试图将 64 位 Python 库链接到 32 位应用程序。我希望链接器能告诉我“未解析的符号”以外的其他信息。链接到 32 位库解决了这个问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T16:45:12.147

尝试包含`C:\WINDOWS\system32\python26.dll`在您的参考文献中。`python26.lib`包含主 DLL 的符号名称。

# git - 你如何让 git 总是从特定的分支中提取？

> ID：658885
> 
> 赞同：496
> 
> 时间：2009-03-18T15:53:59.087
> 
> 标签：git, version-control

我不是 git 大师，但我已经使用它一段时间了，有几个不同的项目。在每个项目中，我总是`git clone [repository]`并且从那时起，我总是可以，当然`git pull`，只要我没有突出的变化。

最近，我不得不恢复到以前的分支，并且使用`git checkout 4f82a29`. 当我再次准备拉取时，我发现我必须将我的分支设置回 master。现在，我不能使用直线拉动，`git pull`而是必须指定`git pull origin master`，这很烦人，并向我表明我不完全理解发生了什么。

发生了什么变化，不允许我在`git pull`不指定原产地主控的情况下进行直线运动，以及如何将其改回？

更新：

```
-bash-3.1$ cat config
[core]
    repositoryformatversion = 0
    filemode = true
    bare = false
    logallrefupdates = true
[branch "master"]
[remote "origin"]
    url = git@github.com:user/project.git
    fetch = refs/heads/*:refs/remotes/origin/* 
```

更新 2：为了清楚起见，我知道我原来的方法可能不正确，但我需要修复这个 repo，以便我可以`git pull`再次使用。目前， git pull 导致：

```
-bash-3.1$ git pull
You asked me to pull without telling me which branch you
want to merge with, and 'branch.master.merge' in
your configuration file does not tell me either.  Please
name which branch you want to merge on the command line and
try again (e.g. 'git pull  ').
See git-pull(1) for details on the refspec.

If you often merge with the same branch, you may want to
configure the following variables in your configuration
file:

    branch.master.remote = 
    branch.master.merge = 
    remote..url = 
    remote..fetch = 

See git-config(1) for details. 
```

我可以知道`git pull`要合并哪个分支，它可以正常`git pull`工作，但不能像我之前那样工作`git checkout`。

* * *

## 回答 #1

> 赞同：745
> 
> 时间：2009-03-18T19:40:26.280

在 下`[branch "master"]`，尝试将以下内容添加到 repo 的 Git 配置文件 ( `.git/config`)：

```
[branch "master"]
    remote = origin
    merge = refs/heads/master 
```

这告诉 Git 2 件事：

1.  当您在 master 分支上时，默认远程是 origin。
2.  `git pull`在主分支上使用时，没有指定远程和分支，使用默认远程（原点）并合并来自远程主分支的更改。

不过，我不确定为什么会从您的配置中删除此设置。您可能也必须遵循其他人发布的建议，但这可能有效（或至少有帮助）。

如果您不想手动编辑配置文件，可以使用命令行工具：

```
$ git config branch.master.remote origin
$ git config branch.master.merge refs/heads/master 
```

* * *

## 回答 #2

> 赞同：142
> 
> 时间：2010-02-22T00:36:25.057

如果您愿意，可以通过命令行（而不是编辑配置文件）设置这些选项，如下所示：

```
 $ git config branch.master.remote origin
  $ git config branch.master.merge refs/heads/master 
```

或者，如果您像我一样，希望这是您所有项目的默认设置，包括您将来可能从事的项目，则将其添加为全局配置设置：

```
 $ git config --global branch.master.remote origin
  $ git config --global branch.master.merge refs/heads/master 
```

* * *

## 回答 #3

> 赞同：86
> 
> 时间：2011-06-11T04:25:57.953

```
git branch --set-upstream master origin/master 
```

这会将以下信息添加到您的`config`文件中：

```
[branch "master"]
    remote = origin
    merge = refs/heads/master 
```

如果你有，`branch.autosetuprebase = always`那么它还会添加：

```
 rebase = true 
```

* * *

## 回答 #4

> 赞同：53
> 
> 时间：2012-10-15T00:11:47.340

我发现很难记住 mipadi 和 Casey 的答案中的确切`git config`或`git branch`参数，所以我使用这两个命令来添加上游参考：

```
git pull origin master
git push -u origin master 
```

这会将相同的信息添加到您的 .git/config 中，但我发现它更容易记住。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2009-03-18T18:12:17.273

[**Git pull**](http://www.kernel.org/pub/software/scm/git/docs/git-pull.html)结合了两个操作——从跟踪分支中的远程存储库获取新提交，然后将它们合并到*您当前的分支*中。

当您签出特定提交时，您没有当前分支，您只有 HEAD 指向您所做的最后一次提交。所以`git pull`没有指定它的所有参数。这就是为什么它不起作用。

根据您更新的信息，您要做的是恢复您的远程仓库。如果您知道引入错误的提交，最简单的处理方法是`git revert`记录一个新的提交，该提交撤消指定的错误提交：

```
$ git checkout master
$ git reflog            #to find the SHA1 of buggy commit, say  b12345
$ git revert b12345
$ git pull
$ git push 
```

由于您要更改的是您的服务器，因此我假设您不需要重写历史记录来隐藏错误提交。

如果错误是在合并提交中引入的，则此过程将不起作用。请参阅 [如何恢复错误合并](http://www.kernel.org/pub/software/scm/git/docs/howto/revert-a-faulty-merge.txt)。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2012-06-18T17:05:44.153

还有一种配置 Git 的方法，它总是将等效的远程分支拉入并推送到当前签出到工作副本的分支。它被称为[**git ready**建议默认设置](http://gitready.com/beginner/2009/03/09/remote-tracking-branches.html)的跟踪分支。

对于当前工作目录上方的下一个存储库：

```
git config branch.autosetupmerge true 
```

对于所有未配置的 Git 存储库：

```
git config --global branch.autosetupmerge true 
```

有点神奇，恕我直言，但这在*特定分支*始终*是当前分支*的情况下可能会有所帮助。

当您第一次`branch.autosetupmerge`设置`true`并签出一个分支时，Git 会告诉您如何跟踪相应的远程分支：

```
(master)$ git checkout gh-pages
Branch gh-pages set up to track remote branch gh-pages from origin.
Switched to a new branch 'gh-pages' 
```

然后 Git 会自动推送到相应的分支：

```
(gh-pages)$ git push
Counting objects: 8, done.
Delta compression using up to 2 threads.
Compressing objects: 100% (6/6), done.
Writing objects: 100% (6/6), 1003 bytes, done.
Total 6 (delta 2), reused 0 (delta 0)
To git@github.com:bigben87/webbit.git
   1bf578c..268fb60  gh-pages -> gh-pages 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2009-07-03T00:56:24.627

不想编辑我的 git 配置文件，我按照@mipadi 帖子中的信息使用：

```
$ git pull origin master 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-03-18T16:36:37.360

您的直接问题是如何使其成为大师，您需要按照它所说的去做。在分支配置中指定要从中提取的 refspec。

```
[branch "master"]
    merge = refs/heads/master 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-10-08T03:50:33.717

只是想添加一些信息，我们可以检查此信息是否`git pull`自动引用任何分支。

如果您运行命令 , `git remote show origin`（假设 origin 是 remote 的简称），git 会显示此信息，无论是否存在任何默认引用`git pull`。

下面是一个示例输出。（取自 git 文档）。

```
$ git remote show origin
* remote origin
  Fetch URL: https://github.com/schacon/ticgit
  Push  URL: https://github.com/schacon/ticgit
  HEAD branch: master
  Remote branches:
    master                               tracked
    dev-branch                           tracked
  Local branch configured for 'git pull':
    master merges with remote master
  Local ref configured for 'git push':
    master pushes to master (up to date) 
```

请注意它显示的部分，为 git pull 配置的本地分支。

在这种情况下，`git pull`将参考`git pull origin master`

最初，如果您使用 git clone 克隆了存储库，这些事情会自动处理。但是，如果您使用 git remote add 手动添加了远程，则 git 配置中缺少这些。如果是这种情况，那么它显示“为 'git pull' 配置的本地分支：”的部分将在`git remote show origin`.

The next steps to follow if no configuration exists for `git pull`, have already been explained by other answers.

# .net - 企业库异常处理应用程序块和日志记录应用程序块在 ASP.NET 中的正确使用

> ID：658886
> 
> 赞同：2
> 
> 时间：2009-03-18T15:54:18.273
> 
> 标签：.net, asp.net, logging, exception-handling, enterprise-library

我使用 ASP.NET 掌握了这个应用程序块，但我不确定我是否在 ASP.NET 中正确使用它进行编码。

我已经到处寻找有关如何使用企业库异常处理应用程序块的正确示例，但只找到有关 Windows 窗体的文章。

有人可以为我指出正确的方向来使用 ASP.NET 的企业库异常处理应用程序块吗？（例如在类中处理异常，何时将异常传播到 Global.asax 中的 Application_Error，如何处理 Application_Error 中已处理和未处理的异常）。

我真的很想看看其他人在做什么。

将企业库错误处理应用程序块与日志记录应用程序块结合起来的代码也会有所帮助。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T16:04:15.007

也许最好从你的目标开始，然后确定如何实现它们。

我们团队的做法是`Application_Error`在 global.asax 中记录事件中的异常。这会捕获所有未处理的异常并将它们记录到我们的数据库中。我们没有使用异常处理块的许多特性，因为我们还没有确定对它们的需求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-07T11:55:26.463

使用 ELEHAB 处理异常在所有类型的应用程序中基本相同。你捕捉到错误并调用`ExceptionPolicy.HandleException`. 唯一的区别就是你把你的“全局”catch 块放在哪里。在 WinForms 中，您可以将其放在`Main`方法中。在 ASP.NET 中，您可以将其放入`Application_Error`事件中。在 Windows 服务中，您可以将其放在后台线程启动方法中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T15:01:03.460

您还可以尝试下面链接中提供的方法和库

[http://sites.google.com/site/spyderhoodcommunity/tech-stuff/aspnetexceptionhandlingandlogginglibrary](http://sites.google.com/site/spyderhoodcommunity/tech-stuff/aspnetexceptionhandlingandlogginglibrary)

异常处理块基本上用于企业级应用程序。它会带来性能和学习曲线方面的开销。

如果您的需要更简单，上面的链接将为您提供进行异常处理的架构以及日志库。

# python - 使用 mysql alchemy 和 python ping mysql

> ID：658888
> 
> 赞同：0
> 
> 时间：2009-03-18T15:54:39.660
> 
> 标签：python, mysql

我如何使用 mysql alchemy 和 python ping mysql？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T17:44:57.667

使用 mysqlshow 查看 MySQL 是否按预期运行。

[http://dev.mysql.com/doc/refman/5.1/en/mysqlshow.html](http://dev.mysql.com/doc/refman/5.1/en/mysqlshow.html)

确保 SQLAlchemy 支持 MySQL。

[http://www.sqlalchemy.org/docs/05/dbengine.html#supported-dbapis](http://www.sqlalchemy.org/docs/05/dbengine.html#supported-dbapis)

通过 SQLAlchemy 使用简单查询。

[http://www.sqlalchemy.org/docs/05/ormtutorial.html](http://www.sqlalchemy.org/docs/05/ormtutorial.html)

# visual-studio - 使用 EnvDTE.Solution - 如何删除源代码管理绑定

> ID：658889
> 
> 赞同：3
> 
> 时间：2009-03-18T15:55:01.207
> 
> 标签：visual-studio, version-control, tfs, automation

如何使用 EnvDTE.Solution API 从解决方案文件中删除 TFS 源代码控制绑定？

我知道我可以在记事本中打开文件并删除 GlobalSection 部分，但我不确定是否（或如何）我可以在下面的方法中做到这一点......

```
 public void Export(Solution solution, TemplateInput model)
 {
    if(model.RemoveSourceControlBindings)
    {
       /* here */
    }
 } 
```

我发现 MSDN 对这个 API 帮助不大。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T16:21:27.600

不知道怎么做，但我已经看到它用一些正则表达式魔法完成了

看：

*   [使用 TFS 离线工作](http://www.wintellect.com/cs/blogs/jrobbins/archive/2006/12/26/working-offline-with-tfs.aspx)
*   [构建任务以删除 TFS 绑定](http://stevennagy.spaces.live.com/blog/cns!B2EFDBF0964586B3!358.entry?wa=wsignin1.0&sa=87898335)

来源： [Wintellect.Build.Tasks.zip](http://www.wintellect.com/cs/DasBlogContentBinary/Wintellect.Build.Tasks.zip)

# iphone - 蓝牙的范围是多少，严格来说是1：1吗？

> ID：658899
> 
> 赞同：17
> 
> 时间：2009-03-18T15:57:52.383
> 
> 标签：iphone, bluetooth

有谁知道你可以从 iPhone 蓝牙获得什么样的范围？另外，这种连接是否严格是一对一的？我知道您可以从多个对等方中选择连接，但是一旦建立连接，您似乎只能在一个对等方之间传输数据？所以基本上，是否有可能创造某种“多人”体验？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-04-30T11:16:00.090

只是回答你问题的范围部分......

2 类设备（其中 iPhone 就是一个例子）的 10 米数字在很大程度上是一个指导方针。

蓝牙设备的范围受到许多现实世界因素的限制。蓝牙使用的 2.4 GHz 射频被水强烈吸收。例如，考虑连接到蓝牙单声道耳机的 iPhone。如果耳机放在一只耳朵里，而 iPhone 在你身体另一侧的裤兜里，那么这两个设备之间会有很多水。这在实践中通常会导致大量的数据包丢失（您可以在传输的音频中听到这一点）。因此，在这种情况下，范围约为一米。

在相反的极端，两个仅被清洁空气隔开的 2 类设备可以达到数百米的范围。

其他影响事物的因素是：

1.  干扰 - 很多东西都使用 2.4 GHz。例如，WiFi 可能会导致问题。
2.  天线设计——空间和成本限制通常意味着天线设计不是最佳的。我不知道iPhone在这方面有多好。
3.  墙壁 - 通常墙壁会衰减蓝牙信号。然而，有时它们是有用的反射器。
4.  硬件质量——一些芯片比其他芯片工作得更好。甚至同一芯片的不同固件版本也可能执行不同的操作。不同版本的 iPhone 可能有（或将有）不同的芯片。
5.  协议 - 可以通过纠错和重传来解决信号质量差的问题。即使 iPhone SDK 强制您使用特定的协议，仔细设计您的应用程序也会有所作为。

因此，总而言之，您可能应该进行一些真实世界的测试。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-18T16:33:55.403

连接是一对一的，但您可以创建一个 adhoc 网络，其中一部手机充当主/协调器。其他电话将通过主/协调器路由所有通信。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-06-18T18:20:52.323

范围基本上足以覆盖正常大小的房间。根据环境情况，它可以更长或更短，但请记住，创建蓝牙是为了实现短距离连接。

蓝牙设备可以是 8 个设备、一个主设备和多达 7 个从设备的微微网的一部分。从机不能相互通信，必须通过主机进行通信，想一个以主机为中心的星型拓扑。iPhone SDK 有一个 GameKit 框架，可用于为多人游戏创建网络。前往 developer.apple.com 查看 GKTank 和 GKRocket 示例代码以了解其使用方式。这些游戏只支持两个玩家，但 GameKit 框架支持更多。查看应用商店，您会看到有四个或更多玩家的游戏。

希望这有助于开始。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-05T11:03:17.567

一台设备理论上可以连接7台设备。根据主从角色，设备可以在它们之间多路复用，给用户一种你同时连接到所有它们的印象。蓝牙规范不会阻止您这样做。这是理论。

现在对于iphone来说，能否连接到多个设备只能由苹果或者知道iphone蓝牙API的人来回答。但我很确定 iphone 内部的蓝牙芯片应该能够连接到多个设备。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-18T16:37:20.417

Apple iPhone 3G 具有 2 类蓝牙模块。2 类蓝牙设备的通信范围为 10 米。

在给定的情况下，设备只能连接到一个设备，因为它遵循主/从通信模型。但是我们仍然可以执行多路复用。因此，我们可以通过快速更改连接的设备来虚拟连接多个设备。

我在[这里](http://en.kioskea.net/contents/bluetooth/bluetooth-fonctionnement.php3)找到了一篇好文章。它很好地解释了蓝牙。

据我所知，使用蓝牙进行多播并非不可能。因此，获得多人游戏体验并非不可能。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-18T16:06:17.497

iPhone 中的蓝牙为 Class-2，范围约为 10 米。

不幸的是，我无法回答您问题的其他部分。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-06-18T18:29:36.823

我每天都通过蓝牙将我的 iPhone 连接到我的笔记本电脑上，而且我似乎记得我在使用蓝牙耳机的同时做到了这一点。YMMV。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-27T10:01:51.160

一台设备最多可连接 8 台其他设备。这完全取决于 iPhone 蓝牙 API（我对此一无所知），但使用蓝牙本身，您可以将数据发送到多个设备。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2011-11-10T11:16:06.533

它是蓝牙的最新版本，是一种无线设备到设备技术，可让您的手机直接与耳机、汽车音响、键盘和其他设备通话，无需路由器或共享无线网络。

# entity-framework - 实体框架 - 获取对象作为集合

> ID：658901
> 
> 赞同：4
> 
> 时间：2009-03-18T15:58:04.037
> 
> 标签：entity-framework

是否可以从实体对象中获取集合（字典）？我需要这个才能将对象的部分属性传递给需要 IDictionary 的函数。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-18T18:56:05.683

采用：

```
Context.EntitySetName.AsEnumerable().ToDictionary(o => o.Key, o => o.Value); 
```

这方面的一些细节：

LINQ to Entities 不支持 ToDictionary。这意味着包含 ToDictionary 的 LINQ 查询字符串将编译，但不会执行，因为实体框架不知道如何将它们转换为 SQL。因此，您必须首先在数据库服务器上执行查询。因此，您必须首先将您的集合投影到一个列表中，该列表会枚举实体集。AsEnumerable 会这样做。显然，如果实体集很大，您可能不想对整个事物执行此操作。使用 Where 调用或 LINQ 查询将结果集减少为仅在字典中首先需要的项目。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T16:08:07.493

我不认为我完全理解你的问题。如果这是您所指的，我不知道将您的数据库表绑定到 IDictionary 属性的任何方法，但是您应该能够创建构建字典所需的任何属性或方法，并传递它。出于某种原因，编写业务对象方法不是一种选择吗？

# java - 如何录制声音并将其从 Web 应用程序发送到服务器？

> ID：658909
> 
> 赞同：2
> 
> 时间：2009-03-18T15:59:51.177
> 
> 标签：java, flash, web-applications, audio

我正在开发一个网络应用程序。它将允许人们将书面短语与口语短语联系起来。为了使此应用程序有用，随机用户必须能够录制自己的声音并将声音发送到服务器。如果我只有一个“上传 wav”表格，没有人会使用它。 **如果我有一个“记录”按钮，可以将音频流式传输或打包到服务器，人们会使用它。**

我很乐意使用 Flash 来做到这一点。我很乐意使用 Java 来做到这一点。我*愿意*使用 .NET 来做到这一点；）如果有可用的外部服务 API，我可以使用它。只要我可以在其他网页上重播，音频的格式并不重要。

如何在我的网站上放置记录按钮？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T16:05:05.317

听起来您正在重塑[Forvo.com](http://www.forvo.com) ;-) AFAIR，他们使用 Flash 进行录制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T16:06:41.630

Flash 具有录制声音的能力。

您不需要闪存媒体服务器，因为您不需要将音频“流式传输”到服务器。您网站的服务器端可以用 PHP、.Net 或任何您喜欢的方式编写。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T16:12:00.323

使用 Flash 可能会遇到的一个问题：[NellyMoser Codec](http://nellymoser.codec.googlepages.com/learnmore)。

听起来有一些工具可以进行转换（虽然我不确定合法性），显然有些网站已经让这种功能正常工作，但这是需要注意的事情。

# javascript - （重新）使用 Visual Studio 2008 在 IE7 中启用 JavaScript 调试器

> ID：658912
> 
> 赞同：5
> 
> 时间：2009-03-18T16:00:31.003
> 
> 标签：javascript, visual-studio, debugging, internet-explorer

Visual Studio 2008 带有很好的 javascript 调试功能。

但是我玩了一点 NetBeans 调试器，它从微软安装了一个丑陋的脚本调试器到我的 IE ......通常 IE 应该问我想用什么来调试，但现在我不能用 Visual Studio 开始调试，脚本调试器自动启动...卸载脚本调试器后，我根本无法在 IE 中调试。即使附加到 iexplore.exe 进程也无济于事......

已再次安装脚本调试器... :(((((

如何让我的 Visual Studio 调试再次在 IE 中工作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-18T16:35:23.730

确保您没有在 IE 设置中禁用脚本调试。可能不是您情况的答案，但我一直忘记这一点。

[![IE7 工具 - Internet 选项 - 高级](https://i.stack.imgur.com/lKgvQ.png)](https://i.stack.imgur.com/lKgvQ.png)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-19T08:20:11.213

我也有同样的问题。它还没有完全解决，但我会分享我所拥有的。

要让 IE 再次看到调试器，请执行以下操作： 1\. 打开 Visual Studio。2\. 转到工具 > 选项 > 调试 > 即时。3\. 启用脚本复选框，单击确定。4\. 关闭 Visual Studio。

现在，当我尝试调试时，它会打开 Visual Studio，但会出现此错误：“无法附加到崩溃进程。发生的错误通常表明安装损坏（代码 0x80040155）。如果问题仍然存在，请通过“修复 Visual Studio 安装”在控制面板中添加或删除程序。”

明天我回到办公室时，我会尝试修复 Visual Studio。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T18:12:52.480

[如何调试 Windows 脚本宿主、VBScript 和 JScript 文件](http://support.microsoft.com/kb/308364)。尤其

> 确保以下注册表项设置为 1： `HKEY_CURRENT_USER\Software\Microsoft\Windows Script\Settings\JITDebug`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-04T13:45:31.870

如果您使用全局错误处理程序**window.onError**，则此处理程序可以防止 JS 错误被捕获，并且 IE 不会询问我们是否要使用 VS 首次亮相。

作为另一种选择，您可以将 VS 附加到 IE 进程，然后在资源视图中可用的任何 JS 脚本中放置断点。VS 应该在进程列表中的 IE 进程旁边显示 (Script,x86)，如果脚本不在列表中，则意味着您没有正确取消选中 @Jon Erickson 提到的“禁用脚本调试”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-09T15:05:58.177

IE (7) Tools -> Manage Add-ons -> Enable or Disable Add-ons...：禁用麻烦的调试器。

# c++ - C++ 风格从 unsigned char * 转换为 const char *

> ID：658913
> 
> 赞同：81
> 
> 时间：2009-03-18T16:00:37.073
> 
> 标签：c++, constants, casting

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-03-18T16:10:41.213

`char *` and `const unsigned char *` are considered unrelated types. So you want to use `reinterpret_cast`.

But if you were going from `const unsigned char*` to a non `const` type you'd need to use `const_cast` first. `reinterpret_cast` cannot cast away a `const` or `volatile` qualification.

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2009-03-18T16:05:41.820

Try `reinterpret_cast`

```
unsigned char *foo();
std::string str;
str.append(reinterpret_cast<const char*>(foo())); 
```

* * *

## 回答 #3

> 赞同：51
> 
> 时间：2009-03-18T16:01:44.480

reinterpret_cast

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2010-07-16T20:17:56.737

unsigned char* is basically a byte array and should be used to represent raw data rather than a string generally. A unicode string would be represented as wchar_t*

According to the C++ standard a reinterpret_cast between unsigned char* and char* is safe as they are the same size and have the same construction and constraints. I try to avoid reintrepret_cast even more so than const_cast in general.

If static cast fails with what you are doing you may want to reconsider your design because frankly if you are using C++ you may want to take advantage of what the "plus plus" part offers and use string classes and STL (aka std::basic_string might work better for you)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-18T16:04:27.000

You would need to use a `reinterpret_cast<>` as the two types you are casting between are unrelated to each other.

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2018-10-12T17:22:41.467

Too many comments to make to different answers, so I'll leave another answer here.

You can and should use `reinterpret_cast<>`, in your case

```
str.append(reinterpret_cast<const char*>(foo())); 
```

because, while these two are different types, the 2014 standard, chapter `3.9.1 Fundamental types [basic.fundamental]` says **there is** a relationship between them:

> Plain `char`, `signed char` and `unsigned char` are three distinct types, collectively called narrow character types. **A `char`, a `signed char`, and an `unsigned char` occupy the same amount of storage and have the same alignment requirements (3.11); that is, they have the same object representation.**

(selection is mine)

Here's an available link: [https://en.cppreference.com/w/cpp/language/types#Character_types](https://en.cppreference.com/w/cpp/language/types#Character_types)

Using `wchar_t` for Unicode/multibyte strings is outdated: [Should I use wchar_t when using UTF-8?](https://stackoverflow.com/questions/17871880/should-i-use-wchar-t-when-using-utf-8)

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2011-10-25T04:02:34.897

> Hope it help. :)

```
const unsigned attribName = getname();
const unsigned attribVal = getvalue();
const char *attrName=NULL, *attrVal=NULL;
attrName = (const char*) attribName;
attrVal = (const char*) attribVal; 
```

# iis-6 - IIS 6 - 创建一个指向不同服务器上的 IIS 应用程序的虚拟目录？

> ID：658916
> 
> 赞同：2
> 
> 时间：2009-03-18T16:02:27.677
> 
> 标签：iis-6

场景如下： 服务器 A 托管“主”应用程序 (www.example.com) 服务器 B 托管支持应用程序 (b.example.com) 它们通过 192.* 地址在内部相互连接，并且都是通过 DNS 外部可用

服务器 A 有几个通过 UNC 共享映射的虚拟目录：www.example.com/virtual1 -> \192.168.1.1\virtual1（在服务器 B 上）

我希望能够运行位于服务器 B 上的应用程序（通过 IIS 提供服务）并使其看起来好像在服务器 A 上运行：

www.example.com/application -> b.example.com/app

我仍然希望能够直接访问服务器 B

b.example.com/app

有任何想法吗？

编辑：

* * *

原来代理背后的应用程序拒绝让我动态地改变它的形式“动作”（它也没有让我改变任何其他东西）。我能够显示来自服务器的数据；就是不能发帖:(

因此，两个答案都为我指明了正确的方向。我使用了代理：

[http://code.google.com/p/iisproxy/](http://code.google.com/p/iisproxy/)

我在服务器 A 上创建了一个虚拟目录，它与我在服务器 B 上所需的目录相匹配 - 它有效！:-)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T16:22:44.213

这在 IIS 中应该是可能的。我记得我必须这样做一次。

只需使用指向`\\ServerB\SharedAppDirOnB`服务器 B 所需凭据的 UNC 路径和（如有必要）“连接为...”创建一个虚拟目录。

如果您对“连接为...”有问题，则可能是服务器 B 的文件夹权限问题。尝试以下操作：在主服务器上添加一个新用户帐户，该用户帐户与服务器 B 上的帐户具有相同的名称和密码. 这听起来很愚蠢，但我记得它解决了我的问题。例如，您可以在两台服务器上添加一个新用户帐户：“IisCommon”，在两台服务器上使用相同的密码。然后确保为服务器 B 上的文件夹授予所有必要的文件访问权限（以及共享权限！）。如果您可以访问共享，请先尝试使用 Windows 资源管理器手动连接。

确保**将新的虚拟目录标记为应用程序**并赋予正确的执行权限。

* * *

另一种解决方案是某种**反向代理**。为此，我在 IIS 6.0 上使用了第三方产品：[ISAPIrewrite](http://www.isapirewrite.com/) for IIS。“代理”模式允许您将向您的主服务器（www.example.com/...）发出的请求“转发”到您的其他服务器，但提供结果响应，就好像它们由您的主“域”应用程序处理一样. 该功能称为“代理指令”。它接受正则表达式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T16:39:46.463

由于通过 UNC 共享从服务​​器 A 提供虚拟目录显然不起作用，因此您需要从服务器 b 提供 b.example.com/app。

DNS 将域名解析为 IP 地址。您要求基于不同的 URL 将相同的域名解析为两个不同的 IP 地址。这不是 IIS 或 Windows 可以做到的。

您的选择是：

*   在服务器 A 上编写一个代理服务，将请求传递到服务器 B。如果您希望它完全透明（不仅仅是重定向），您还必须流回响应。这不是微不足道的，而是可能的。

*   将服务器 B 页面放入服务器 A 上新页面上的 IFRAME。

*   在两台服务器前使用负载均衡器，可以根据 URL 拆分流量

# c# - 带有 MEF 的 Winforms

> ID：658929
> 
> 赞同：1
> 
> 时间：2009-03-18T16:07:11.130
> 
> 标签：c#, winforms, mef

我有一个使用不同选项卡的 winforms 应用程序。我想使用 MEF 来添加更多在启动时导入的选项卡。我很难弄清楚如何去做。

编辑：这就是我所做的。

我采用了主要的 winforms 类并将其剥离，以便其中只有一个 TabControl，我通过一个接口向每个 TabPage 公开它。然后，我还创建了第二个接口 ITab，我将其与 MEF 一起使用以获取标签页，然后将其添加到主 tabcontrol。要创建一个新的标签页，我只需添加一个新表单，然后向其中添加一个 tabcontrol 并设计标签页。我将 ITab 界面添加到新表单中，并添加了以下将页面移动到主表单的方法。

```
public void MoveTabPages(IForm fm)
{
   while (this.tabControl1.Controls.Count > 0)
   {
      fm.tab.Controls.Add(this.tabControl1.Controls[0]);
   }
} 
```

只要事件委托和所有这些好东西只引用他们的表单类中的内容，它们就可以工作。

这是完整的代码。

```
 //Form1.cs
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using System.ComponentModel.Composition;
using System.ComponentModel.Composition.Hosting;

namespace Winforms_Mef
{
   public interface IForm
   {
      TabControl tab { get; }
   }

   public interface ITab
   {
      void MoveTabPages(IForm fm);
   }

   public partial class Form1 : Form,IForm
   {
      private CompositionContainer _container;

      [Import]
      public IEnumerable Tabs { get; set; }

      public TabControl tab
      {
         get { return tabControl1; }
      }

      public Form1()
      {
         Compose();
         InitializeComponent();

         foreach (ITab tab in Tabs)
         {
            tab.MoveTabPages(this);
         }

      }

      private void Compose()
      {
         var catalog =new AssemblyCatalog(typeof(ITab).Assembly);
         var batch = new CompositionBatch();
         batch.AddPart(this);

         _container =new CompositionContainer(catalog);
         _container.Compose(batch);
      }
   }
}

//Form2.cs
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using System.ComponentModel.Composition;

namespace Winforms_Mef
{
   [Export(typeof(ITab))]
   public partial class Form2 : Form,ITab
   {
      public Form2()
      {
         InitializeComponent();
      }

      public void MoveTabPages(IForm fm)
      {
         while (this.tabControl1.Controls.Count > 0)
         {
            fm.tab.Controls.Add(this.tabControl1.Controls[0]);
         }
      }
   }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T07:38:44.010

在继续之前，我认为您的 Compose 方法需要清理。为什么要将容器和目录添加到批处理中？

```
batch.AddExportedObject(_container);
batch.AddExportedObject(catalog); 
```

**AddExportedObject**用于将预先存在的对象实例添加为导出，尝试将容器和目录用作导出没有多大意义

```
privat void Compose()
{
    var catalog =
        new AssemblyCatalog(typeof(ITab).Assembly);

    var batch =
        new CompositionBatch();
    batch.AddPart(this);

    var container =
        new CompositionContainer(catalog);
    container.Compose(batch);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T15:44:14.117

这是一个通用版本，允许您使用 Mef 将您的 winforms 表单替换为另一个。有一个使用 Mef 公开的 IForm 接口，它有一个名为 public void MoveForm(Form form) 的方法，它将新表单复制到旧表单上。

这是代码。

```
 //// Form1 default form
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using System.ComponentModel.Composition;
using System.ComponentModel.Composition.Hosting;

namespace Winforms_Mef
{
   public interface IForm
   {
      void MoveForm(Form form);
   }

   public partial class Form1 : Form 
   {
      private CompositionContainer _container;

      [Import]
      public IEnumerable Forms { get; set; }

      public Form1()
      {
         Compose();
         InitializeComponent();

         foreach (IForm form in Forms)
         {
            this.SuspendLayout();
            this.Controls.Clear(); // wipe out the current version of the form
            this.ResumeLayout(false);
            form.MoveForm(this);
         }

      }

      private void Compose()
      {
         var catalog = new AssemblyCatalog(typeof(IForm).Assembly);
         var batch = new CompositionBatch();
         batch.AddPart(this);

         _container = new CompositionContainer(catalog);
         _container.Compose(batch);
      }
   }
}

//// Form 2 uses Mef to replace Form1
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using System.ComponentModel.Composition;

namespace Winforms_Mef
{
   [Export(typeof(IForm))]
   public partial class Form2 : Form,IForm
   {
      public Form2()
      {
         InitializeComponent();
      }

      public void MoveForm(Form form)
      {
         this.SuspendLayout();
         form.SuspendLayout();

         form.AutoScaleDimensions = this.AutoScaleDimensions;
         form.AutoScaleMode=this.AutoScaleMode;
         form.ClientSize=this.ClientSize;
         form.Name=this.Name;
         form.Text=this.Text;
         while (this.Controls.Count > 0)
         {
            form.Controls.Add(this.Controls[0]);
         }

         this.ResumeLayout(false);
         form.ResumeLayout(false);
      }
   }
} 
```

# sharepoint - 我们如何使用 VSeWSS 1.2 和 Source Safe 设置 SharePoint 开发环境？

> ID：658934
> 
> 赞同：2
> 
> 时间：2009-03-18T16:09:09.407
> 
> 标签：sharepoint, visual-studio-2005, wss, visual-sourcesafe

是否有人在源代码安全的多开发人员环境中使用 MS SharePoint 解决方案生成器和 VSeWSS 1.2？我们在**重新**部署时遇到了问题（因为它并没有真正使用 stsadm**升级解决方案）。***它一直说已经安装了相同的功能 - 确实如此，但它应该收回该功能并重新安装它 - 在某些机器*上它没有。该功能的 GUID 出现了问题，但我们找不到可能的位置。一个开发人员将能够部署和重新部署，但下一个开发人员将不能。VSeWSS 1.2 在哪里更改 GUID？ARG！！！

我们在 STSDev 中看到了不错的部署目标（升级等），但我们不愿意使用 STSDev 或其他 codeplex 工具，因为它们不受 Microsoft 支持。我们有 Visual Studio 2005，但没有钱升级到 VS 2008 来获得 VSeWSS 1\. **3** - 太糟糕了。

---更新--- 我认为我们在 VSeWSS 中发现了其他人评论过的错误：[编辑项目属性会重置一些功能 GUID。](http://www.wsswiki.com/Visual_Studio_Extensions_For_WSS_3.0 "错误描述")

这也可能是安装范围的问题。我们如何在 VSeWSS 1.2 中将站点定义安装到 FARM 范围？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T20:12:16.330

不要太担心微软的支持太多。虽然这是一个考虑因素，但 MS SharePoint 解决方案生成器（糟糕）和 VSeWSS 1.2 的最终结果仍然是 SharePoint 解决方案，并且所有解决方案都需要包含相同的 xml。

是否可以修改 STSDev 的部署目标以与您的 VSeWSS 解决方案一起使用？毕竟，[这里](https://stackoverflow.com/questions/541108/is-it-possible-to-develop-for-sharepoint-using-continuous-integration-techniques)的部署目标只是使用 STSAdm 和一个解决方案文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T21:10:26.470

为了避免通常的“在我的机器上工作”，您应该设置一个构建和部署系统。如果您使用的是虚拟服务器或 ESX 服务器，它应该相当简单，而且也很便宜。如果您的人力多于金钱，您应该能够一直使用开源软件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-21T14:38:54.193

VSeWSS 1.2 和 1.3 将功能 GUID 存储在 Visual Studio 解决方案的 /PKG 目录中的文件中。如果您删除这些文件，或者在没有这些文件的情况下将我们的项目签入源代码管理并在另一台机器上签出，您将丢失您的 GUID。当然，VSeWSS 会为您重新创建丢失的文件，但它会使用新的 GUID 和新的功能名称来执行此操作。

一个常见的要求是将 /PKG 目录添加到您的 Visual Studio 2008 项目并将其放入源代码管理中。

[您可以在此处](http://www.microsoft.com/downloads/details.aspx?familyid=FB9D4B85-DA2A-432E-91FB-D505199C49F6&displaylang=en)阅读有关 VSeWSS 1.3 发行说明中 /PKG 目录中文件的更多信息。

PS：我们对 VSeWSS 1.3 中的解决方案生成器做了一些改进，但它不会为您生成 100% 完美的解决方案。

# java - 是否有将 Java POJO 转换为 JSON 和 XML 的库？

> ID：658936
> 
> 赞同：30
> 
> 时间：2009-03-18T16:10:29.670
> 
> 标签：java, xml, json, pojo

我有一个对象图，我想在 JSON 和 XML 之间进行转换，以创建 REST 样式的 API。我觉得肯定有人已经这样做了，但是使用 Google 和 Stack Overflow 快速搜索什么也没有发现。

有谁知道合适的（Apache 或同等许可首选）库来执行此操作？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2011-08-15T21:01:52.623

**来自谷歌的GSON**：[http](http://code.google.com/p/google-gson/) ://code.google.com/p/google-gson/ ，

或者

**Jackson**春季使用的库：[https ://github.com/FasterXML/jackson](https://github.com/FasterXML/jackson)

我同意其他人建议将 jaxb 用于 XML 到 pojo，很好地支持很多工具：它是标准。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-18T16:31:09.417

对于 POJO 到 XML，我建议使用[JAXB](http://www.oracle.com/technetwork/articles/javase/index-140168.html)（还有其他库，例如 XStream，但 JAXB 是标准化的）。

对于 JSON，我什么都不知道，但如果你想实现一个 RESTful API，你可能会对[JSR-311感兴趣，它定义了一个用于 RESTful API 和](http://jcp.org/en/jsr/detail?id=311)[Jersey](http://jersey.java.net/)的服务器端 API ，它是它的参考实现。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-18T16:33:27.243

使用 Xstream [http://x-stream.github.io/](http://x-stream.github.io/)用于 xml 和 JSON [http://www.json.org/java/](http://www.json.org/java/)用于 JSON。我认为没有一个图书馆可以两者兼得。

或者编写一个包装器，根据您的需要委托给 XStream 渲染器/JSON 渲染器。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-18T16:23:19.593

我想你可能正在寻找类似于这里的东西：[JSON.org Java section](http://www.json.org/java/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-08-24T10:38:46.167

**注意：** 我是[**EclipseLink JAXB (MOXy)**](http://www.eclipse.org/eclipselink/moxy.php)负责人，也是[**JAXB (JSR-222)**](http://jcp.org/en/jsr/detail?id=222)专家组的成员。

**EclipseLink JAXB (MOXy)**支持将单个对象模型映射到具有相同元数据的 XML 和 JSON：

*   [http://blog.bdoughan.com/2011/08/binding-to-json-xml-geocode-example.html](http://blog.bdoughan.com/2011/08/binding-to-json-xml-geocode-example.html)

**许可证信息**

*   [http://wiki.eclipse.org/EclipseLink/FAQ/General#How_is_EclipseLink_Licensed.3F](http://wiki.eclipse.org/EclipseLink/FAQ/General#How_is_EclipseLink_Licensed.3F)

* * *

**领域模型**

下面是我们将用于此示例的域模型。对于此示例，我仅使用自 Java SE 6 起在 JDK/JRE 中可用的标准 JAXB (JSR-222) 注释。

***顾客***

```
package forum658936;

import java.util.List;
import javax.xml.bind.annotation.*;

@XmlRootElement
@XmlAccessorType(XmlAccessType.FIELD)
public class Customer {

    String firstName;

    @XmlElement(nillable=true)
    String lastName;

    @XmlElement(name="phone-number")
    List<PhoneNumber> phoneNumbers;

} 
```

***电话号码***

```
package forum658936;

import javax.xml.bind.annotation.*;

@XmlAccessorType(XmlAccessType.FIELD)
public class PhoneNumber {

    @XmlAttribute
    int id;

    @XmlValue
    String number;

} 
```

***jaxb.properties***

要将 MOXy 指定为您的 JAXB 提供程序，您需要包含一个`jaxb.properties`在与域模型相同的包中调用的文件，其中包含以下条目（请参阅： [http ://blog.bdoughan.com/2011/05/specifying-eclipselink-moxy-as -your.html](http://blog.bdoughan.com/2011/05/specifying-eclipselink-moxy-as-your.html) )。

```
javax.xml.bind.context.factory=org.eclipse.persistence.jaxb.JAXBContextFactory 
```

* * *

**XML**

***输入.xml***

这是我们的演示代码将读取并转换为域对象的 XML。

```
<?xml version="1.0" encoding="UTF-8"?>
<customer xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <firstName>Jane</firstName>
    <lastName xsi:nil="true"/>
    <phone-number id="123">555-1234</phone-number>
</customer> 
```

关于 XML 的注意事项：

*   该`xsi:nil`属性用于指示`lastName`为空。
*   该`phone-number`元素是具有简单内容的复杂类型（参见： [http](http://blog.bdoughan.com/2011/06/jaxb-and-complex-types-with-simple.html) ://blog.bdoughan.com/2011/06/jaxb-and-complex-types-with-simple.html ）。

* * *

**JSON**

***输出***

下面是运行演示代码输出的 JSON。

```
{
   "firstName" : "Jane",
   "lastName" : null,
   "phone-number" : [ {
      "id" : 123,
      "value" : "555-1234"
   } ]
} 
```

关于 JSON 的注意事项：

*   该`null`值用于表示`lastName`为空。不存在该`xsi:nil`属性。
*   电话号码集合的大小为 1，并由方括号正确绑定。许多库错误地将大小为 1 的集合视为 JSON 对象。
*   `property`of 类型`int`被正确编组，不带引号。
*   在 XML 表示`id`中是一个属性，但在 JSON 表示中，不需要专门表示它。

* * *

**演示代码**

在下面的演示代码中，我们会将 XML 文档转换为对象，然后将这些相同的实例转换为 JSON。

***演示***

MOXy 不仅解释 JAXB 注释，它还是一个 JAXB 实现，因此使用标准 JAXB 运行时 API。JSON 绑定是通过在`Marshaller`.

```
package forum658936;

import java.io.File;
import javax.xml.bind.*;
import org.eclipse.persistence.jaxb.MarshallerProperties;

public class Demo {

    public static void main(String[] args) throws Exception {
        JAXBContext jc = JAXBContext.newInstance(Customer.class);

        Unmarshaller unmarshaller = jc.createUnmarshaller();
        File xml = new File("src/forum658936/input.xml");
        Customer customer = (Customer) unmarshaller.unmarshal(xml);

        Marshaller marshaller = jc.createMarshaller();
        marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);
        marshaller.setProperty(MarshallerProperties.MEDIA_TYPE, "application/json");
        marshaller.setProperty(MarshallerProperties.JSON_INCLUDE_ROOT, false);
        marshaller.marshal(customer, System.out);
    }

} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-18T16:32:13.893

[Json-lib](http://json-lib.sourceforge.net/)在 Apache 2.0 许可下获得许可。

它还可以将 JSON 对象转换为 XML，但您需要先通过它将 POJO 转换为 JSON。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-18T16:50:11.370

就我个人而言，我会分别处理这两个问题；并通过 JSON<-> Pojo <-> XML 转换 JSON<->XML。

有了它：带有 JAXB 的 Java<->POJO（[http://jaxb.dev.java.net](http://jaxb.dev.java.net)；也与 JDK 1.6 捆绑在一起）带有注释（XStream 也可以）；对于 JSON，Jackson 的 ObjectMapper ( [http://jackson.codehaus.org/Tutorial](http://jackson.codehaus.org/Tutorial) )。与 Jersey 配合得很好，我自己也在使用它（当前 Jersey 版本默认不捆绑完整的 Pojo 数据绑定，但会在不久的将来）

我实际上不会使用任何 xml 库来生成“json”：XStream 和 JAXB/Jettison 可以生成某种 JSON，但它使用了相当不直观的丑陋约定。

编辑（2011 年 7 月 18 日）：杰克逊实际上有一个名为“ [jackson-xml-databind](https://github.com/FasterXML/jackson-xml-databind) ”的扩展，它可以读/写 XML，类似于 JAXB。所以它可以用于 JSON 和 XML，来往/来自 POJO。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-05-09T14:03:12.073

几乎有数百个。我最喜欢的是用于 POJO <-> JSON 的 GSON 和用于 POJO <-> XML 的 castor-xml。

作为奖励，两者都在 Apache License 2.0 样式许可下获得许可。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-18T20:12:27.640

上次我在网站上看到，XStream 两者都可以。它支持 XML 和 JSON 作为序列化目标。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2012-08-24T13:00:26.360

看看 Genson 库[http://code.google.com/p/genson/wiki/GettingStarted](http://code.google.com/p/genson/wiki/GettingStarted)。

它易于使用、性能卓越，并且在设计时考虑了扩展性。实际上它进行 json/java 转换但不是 xml。但是，将来的版本中可能会添加 xml 支持。

我在 web 应用程序和球衣的 REST web 服务中使用它，但在某些情况下也将对象以 json 形式存储到数据库中。

啊，它在 Apache 2.0 许可下。

# mysql - 在 MySQL 中缓存/重用子查询

> ID：658937
> 
> 赞同：14
> 
> 时间：2009-03-18T16:10:31.043
> 
> 标签：mysql, subquery

我有一个非常复杂的 MySQL 查询，其中包括三次使用相同的子查询。MySQL 会实际运行子查询 3 次吗？（这是一个昂贵的。）如果是这样，我有没有办法告诉 MySQL 保存或缓存结果，所以它不会那样做？我可以将数据保存在一个大数组中，然后将其重新输入 MySQL，但我不想像那样将它移出并放回数据库中。

这是出现 3 次的子查询：

```
SELECT id FROM programs 
WHERE submitter_id=32 AND id in (
    SELECT id FROM programs 
    WHERE feed_id=2478 AND id in (
        SELECT program_id FROM playlist_program_map 
        WHERE playlist_id=181))) 
```

这是查询出现的完整查询的示例：

```
SELECT object_id, programs.created AS created, 
MATCH(text) AGAINST ('excellent ' IN BOOLEAN MODE) AS relevance 
FROM comments_programs USE INDEX (text) 
LEFT JOIN programs ON programs.id=object_id 
WHERE object_id IN (
    SELECT id FROM programs 
    WHERE 1 AND id IN (
        SELECT id FROM programs 
        WHERE submitter_id=32 AND id in (
            SELECT id FROM programs 
            WHERE feed_id=2478 AND id in (
                SELECT program_id FROM playlist_program_map 
                WHERE playlist_id=181)))) 
AND MATCH(text) AGAINST ('excellent ' IN BOOLEAN MODE)>0)

UNION (

SELECT object_id, programs.created AS created, 
MATCH(text) AGAINST ('excellent ' IN BOOLEAN MODE) AS relevance 
FROM descriptions_programs USE INDEX (text) 
LEFT JOIN programs ON programs.id=object_id 
WHERE object_id IN (
    SELECT id FROM programs 
    WHERE 1 AND id IN (
        SELECT id FROM programs 
        WHERE submitter_id=32 AND id in (
            SELECT id FROM programs 
            WHERE feed_id=2478 AND id in (
                SELECT program_id FROM playlist_program_map 
                WHERE playlist_id=181)))) 
AND MATCH(text) AGAINST ('excellent ' IN BOOLEAN MODE)>0 AND current=1 ) 

UNION (

SELECT object_id, programs.created AS created, 
MATCH(text) AGAINST ('excellent ' IN BOOLEAN MODE) AS relevance 
FROM titles_programs USE INDEX (text) 
LEFT JOIN programs ON programs.id=object_id 
WHERE object_id IN (
    SELECT id FROM programs 
    WHERE 1 AND id IN (
        SELECT id FROM programs 
        WHERE submitter_id=32 AND id in (
            SELECT id FROM programs 
            WHERE feed_id=2478 AND id in (
                SELECT program_id FROM playlist_program_map 
                WHERE playlist_id=181)))) 
AND MATCH(text) AGAINST ('excellent ' IN BOOLEAN MODE)>0 AND current=1; 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-18T16:13:42.190

看看怎么`EXPLAIN EXTENDED`说。

如果显示`DEPENDENT SUBQUERY`or `UNCACHEABLE SUBQUERY`，则每次使用时都会重新评估。

如果子查询使用会话变量或者是相关子查询，就会发生这种情况。

如果没有，它很可能会被缓存。

If your case the subquery will not be cached, it will be reevaluated in each `UNION`'ed set.

You subquery, though, seems to be too complicated. Why don't you just use:

```
SELECT id
FROM   playlist_program_map ppm, programs p
WHERE  ppm.playlist_id = 181
       AND p.id = ppm.program_id
       AND submitter_id = 32
       AND feed_id = 2478 
```

If you have an index on `playlist_program_map (playlist_id)`, this query should work like a charm.

Could you please tell me two more things:

1.  How many rows are there in `playlist_program_map` and how many `DISTINCT playlist_id` values are there?
    *   How many rows are there in `programs` and how many `DISTINCT submitter_id, feed_id` pairs are there?

From your comment I can conclude that there are **10** `programs` per `playlist` in average, and **200** `programs` per `(submitter, feed)` pair. This means your index on `playlist_program_map` is more selective than the one on `(submitter, feed)`, and `playlist_program_map` must be leading in the join.

The fulltext index in your case also doesn't seem to be very selective, given that you need to join **10** programs out of **2,000,000**.

You may better try the following:

```
SELECT object_id, programs.created AS created
FROM   playlist_program_map ppm, programs p, comments_programs cp
WHERE  ppm.playlist_id = 181
       AND p.id = ppm.program_id
       AND p.submitter_id = 32
       AND p.feed_id = 2478
       AND cp.object_id = p.id
       AND cp.text REGEXP 'excellent' 
```

, and repeat this for all three tables.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-03-09T01:21:17.683

For whatever reason, mysql IN clauses with a sub-select run very slow. Better to use join. Your sub-query becomes:

SELECT id from programs P1 INNER JOIN programs P2 ON P1.id = P2.id INNER JOIN playlist_program_map PMAP ON P2.id = PMAP.program_id WHERE P1.submitter_id=32 AND P2.feed_id=2478 AND PMAP.playlist_id=181

It will run much faster.

# php - Python 相当于“php -s”

> ID：658939
> 
> 赞同：6
> 
> 时间：2009-03-18T16:10:57.237
> 
> 标签：php, python, syntax-highlighting

**您可能知道也可能不知道，您可以使用php -s**从 PHP 源文件生成颜色语法高亮的 HTML 文件。

我知道 Stackoverflow 使用的[syntaxhighlighter](http://code.google.com/p/syntaxhighlighter/)，这并不是我真正想要的。我正在寻找可以在没有 Javascript 的情况下生成 HTML 输出的东西。

有谁知道相当于***php*** - ***s*** for Python 的东西？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-18T16:26:33.237

```
$ pygmentize -O full -O style=native -o test.html test.py 
```

要安装[Pygments](http://pygments.org/)：

```
$ easy_install Pygments 
```

您可以将其用作库。

```
from pygments import highlight
from pygments.lexers import guess_lexer
from pygments.formatters import HtmlFormatter

code = '#!/usr/bin/python\nprint "Hello World!"'
lexer = guess_lexer(code) # or just pygments.lexers.PythonLexer()
formatter = HtmlFormatter(noclasses=True, nowrap=True, lineseparator="<br>\n")
print highlight(code, lexer, formatter) 
```

输出：

```
<span style="color: #408080; font-style: italic">#!/usr/bin/python</span><br>
<span style="color: #008000; font-weight: bold">print</span> 
<span style="color: #BA2121">&quot;Hello World!&quot;</span><br> 
```

（为清楚起见添加了空格）

作为html：

#!/usr/bin/python
打印“Hello World！”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-27T12:08:56.330

我发现[http://www.andre-simon.de](http://www.andre-simon.de)上的 Highlight 是一个非常好的工具。它是开源的（虽然是 GPL 的！）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T16:29:04.087

如果您可以从 KDE 访问 kwrite，则可以将文件导出为 HTML，该文件将具有与您用于编辑相同的颜色。这适用于所有语言。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T16:32:24.033

如果您只需要几个文件来转换为 html 页面并且在 Windows 上，您可以使用 Notepad++。它（截至最新版本）带有 NppExport 插件，让我们可以将源代码转换为突出显示的 HTML 和 RTF（根据您的着色方案）。当然，它不仅适用于 python，而且适用于您可以在 Notepad++ 中使用的任何语言。

# php - PHP 摆脱讨厌的 \n 方块

> ID：658940
> 
> 赞同：1
> 
> 时间：2009-03-18T16:11:33.957
> 
> 标签：php

最难解释的问题：

```
$lol = "hello";
$that = "* music
* books
* games
* asos
* cry";

$lol = str_replace("*", $line, $that);

$name = str_replace(" ", "-", $line);
$myFile = "output/$name.csv";
$fh = fopen($myFile, 'w') or die("can't open file");

$stringData = $lol;
fwrite($fh, $stringData);
fclose($fh); 
```

我正在运行一个大的 $​​lol 变量列表并为每个变量生成一个文本文件，您可以在 $that 中看到文本文件的模板，其中 * 将成为循环中的 $lol 。

所以如果 $lol = "softlayer" 我会得到一个 csv

```
softlayer music
softlayer books
softlayer games
etc.. 
```

问题是当我在记事本中打开它们时，它们不是软层音乐等都在同一行，由那些可怕的方块隔开，这意味着“新行”。因此，根据我尝试使用的软件，我生成的 CSV 应该是无效的。

这是一个绝对可怕的问题，所以请原谅我 :)

任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-18T16:16:03.883

在史前的迷雾中，Windows Folk、Mac Folk 和 Unix 人无法就哪些字符应该表示行尾达成一致。在经典的 Mac OS 上，它是一个回车符 (\r)。在 Unix 上，它是一个换行符 (\n)。在 Windows 上，它是一个回车，后跟一个换行符 (\r\n)。

从历史上看，在旧打字机上，你必须做**两件事**才能让打字机换行。回车（大臂的东西）会将打字机头移回纸张的左侧（或右侧；shalom！）。但是，头部仍然在同一条线上。您必须使用第二种机制（换行或换行）才能将纸张本身向上移动一行。

ASCII 标准的原因之一是对稍后要打印的数据进行编码（通过电报、电传打字机等），因此在标准中同时包含这两个字符是有意义的。当需要为主要目的是存储在计算机中的文件制定标准时，没有人会同意。Windows 标准 (\r\n) 最符合字面意义，但 Unix 和 Classic Mac 标准（\n 代表 Unix，\r 代表 Classic Mac）每行节省了一点，这在早期很重要。

这已经造成了几十年的混乱，并将在未来继续造成混乱。在 Windows 环境中使用 Unix 工具时尤其如此。许多这些工具假定 \n 作为行尾。此外，您的 PHP 源文件可能使用 unix 样式的行尾编码，这意味着分隔为多行的字符串实际上由 \n 换行符分割，并且您的程序运行正常。

大多数现代文本编辑器将弄清楚文本文件的编码方式，并按作者“按预期”显示行。记事本不是那样工作的，它遵循文本文件中的字面意思。

无论如何，以下 reg ex 应该将您的行尾规范化为 Windows 上的标准

```
$stringData = preg_replace('/[\n\r]{1,2}$/',"\r\n",$stringData); 
```

或者，您可以将字符串构造为以回车/换行结尾

```
$string = "line 1\r\nline 2";
$string = "line 1\r\n".
          "line 2\r\n"; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T16:15:34.433

试试“\r”？

# c# - 异步引发事件

> ID：658945
> 
> 赞同：8
> 
> 时间：2009-03-18T16:12:24.173
> 
> 标签：c#, .net, winforms

我正在研究在具有许多事件订阅者的组件中进行异步事件分派的选项。在仔细阅读这些选项时，我遇到了这个例子：

```
public event ValueChangedEvent ValueChanged;
public void FireEventAsync(EventArgs e)
{
    Delegate[] delegates = ValueChanged.GetInvocationList();
    foreach (Delegate d in delegates)
    {
        ValueChangedEvent ev = (ValueChangedEvent)d;
        ev.BeginInvoke(e, null, null);
    }
} 
```

除了较旧的语法（示例来自 .NET 1.1）之外，在我看来这是一个严重的资源泄漏。没有完成方法，没有完成的轮询，或任何其他`EndInvoke`将被调用的方式。

我的理解是，每一个都`BeginInvoke` *必须有*一个对应的`EndInvoke`. 否则会有待处理的`AsyncResult`对象实例，以及在异步事件期间引发的（可能）异常。

我意识到通过提供回调并执行 来更改它很容易`EndInvoke`，但如果我不需要 . . .

处理异步异常完全是另一回事，并且结合与 UI 线程（即`InvokeRequired`等）同步的需要，可以很好地解决执行这些异步通知的整个想法。

所以，两个问题：

1.  我是否正确地相信每个都`BeginInvoke`需要一个对应的`EndInvoke`？
2.  除了我上面提到的之外，在 Windows 窗体应用程序中执行异步事件通知是否还有其他陷阱？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T17:25:22.110

调用`BeginInvoke()`应该与 a 配对，`EndInvoke()`但不这样做不会导致资源泄漏。`IAsyncResult`返回的将`BeginInvoke()`被垃圾收集。

这段代码中最大的缺陷是您很容易受到终止应用程序的异常的影响。您可能希望将委托调用包装在异常处理程序中，并考虑如何传播发生的异常（报告第一个异常，产生聚合异常等）。

调用删除使用`BeginInvoke()`将从线程队列中取出一个线程以开始运行事件。这意味着该事件将始终触发主 UI 线程。这可能会使某些事件处理程序场景更难处理（例如更新 UI）。处理程序需要意识到他们需要调用`SynchronizationContext.Send()`或`.Post()`与主 UI 线程同步。当然，所有其他多线程编程陷阱也适用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T23:11:05.410

在考虑了一段时间后，我得出的结论是，在 Windows 窗体控件中执行异步事件可能是个坏主意。应在 UI 线程上引发 Windows 窗体事件。否则会给客户端带来过度的负担，并且可能会弄乱`AsyncResult`对象和异步异常。

让客户端触发他们自己的异步处理（使用`BackgroundWorker`或其他一些技术）或同步处理事件会更干净。

当然，也有例外。 `System.Timers.Timer`例如，`Elapsed`在线程池线程上引发事件。但是随后，初始通知来自池线程。看起来一般规则是：在获得初始通知的同一线程上引发事件。至少，这是最适合我的规则。这样就没有关于泄漏对象的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T17:19:19.753

1.  不需要。仅当指定了返回类型时才需要 EndInvoke。看看这个：[线程](http://social.msdn.microsoft.com/Forums/en-US/clr/thread/b18b0a27-e2fd-445a-bcb3-22a315cd6f0d/)。另外，我发布了这个半相关的[线程。](https://stackoverflow.com/questions/435772/the-proper-way-to-end-a-begininvoke)

2.  我真的帮不了你！：-） 对不起。

# c# - 在 C# 中，如何在方法中实例化传递的泛型类型？

> ID：658951
> 
> 赞同：109
> 
> 时间：2009-03-18T16:13:07.887
> 
> 标签：c#, generics

如何在`InstantiateType<T>`下面的方法中实例化类型 T ？

我收到错误消息：**“T”是“类型参数”，但用作“变量”。**：

## （向下滚动查看重构答案）

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace TestGeneric33
{
    class Program
    {
        static void Main(string[] args)
        {
            Container container = new Container();
            Console.WriteLine(container.InstantiateType<Customer>("Jim", "Smith"));
            Console.WriteLine(container.InstantiateType<Employee>("Joe", "Thompson"));
            Console.ReadLine();
        }
    }

    public class Container
    {
        public T InstantiateType<T>(string firstName, string lastName) where T : IPerson
        {
            T obj = T();
            obj.FirstName(firstName);
            obj.LastName(lastName);
            return obj;
        }

    }

    public interface IPerson
    {
        string FirstName { get; set; }
        string LastName { get; set; }
    }

    public class Customer : IPerson
    {
        public string FirstName { get; set; }
        public string LastName { get; set; }
        public string Company { get; set; }
    }

    public class Employee : IPerson
    {
        public string FirstName { get; set; }
        public string LastName { get; set; }
        public int EmployeeNumber { get; set; }
    }
} 
```

## 重构答案：

感谢所有的评论，他们让我走上了正确的道路，这就是我想做的：

```
using System;

namespace TestGeneric33
{
    class Program
    {
        static void Main(string[] args)
        {
            Container container = new Container();
            Customer customer1 = container.InstantiateType<Customer>("Jim", "Smith");
            Employee employee1 = container.InstantiateType<Employee>("Joe", "Thompson");
            Console.WriteLine(PersonDisplayer.SimpleDisplay(customer1));
            Console.WriteLine(PersonDisplayer.SimpleDisplay(employee1));
            Console.ReadLine();
        }
    }

    public class Container
    {
        public T InstantiateType<T>(string firstName, string lastName) where T : IPerson, new()
        {
            T obj = new T();
            obj.FirstName = firstName;
            obj.LastName = lastName;
            return obj;
        }
    }

    public interface IPerson
    {
        string FirstName { get; set; }
        string LastName { get; set; }
    }

    public class PersonDisplayer
    {
        private IPerson _person;

        public PersonDisplayer(IPerson person)
        {
            _person = person;
        }

        public string SimpleDisplay()
        {
            return String.Format("{1}, {0}", _person.FirstName, _person.LastName);
        }

        public static string SimpleDisplay(IPerson person)
        {
            PersonDisplayer personDisplayer = new PersonDisplayer(person);
            return personDisplayer.SimpleDisplay();
        }
    }

    public class Customer : IPerson
    {
        public string FirstName { get; set; }
        public string LastName { get; set; }
        public string Company { get; set; }
    }

    public class Employee : IPerson
    {
        public string FirstName { get; set; }
        public string LastName { get; set; }
        public int EmployeeNumber { get; set; }
    }
} 
```

* * *

## 回答 #1

> 赞同：149
> 
> 时间：2009-03-18T16:15:28.877

像这样声明你的方法：

```
public string InstantiateType<T>(string firstName, string lastName) 
              where T : IPerson, new() 
```

注意最后的附加约束。然后在方法体中创建一个`new`实例：

```
T obj = new T(); 
```

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-03-18T16:18:39.150

几种方法。

不指定类型必须有构造函数：

```
T obj = default(T); //which will produce null for reference types 
```

使用构造函数：

```
T obj = new T(); 
```

但这需要以下子句：

```
where T : new() 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-03-18T16:25:36.297

为了扩展上述答案，向`where T:new()`泛型方法添加约束将要求 T 具有公共的、无参数的构造函数。

如果你想避免这种情况——并且在工厂模式中，你有时会强制其他人通过你的工厂方法而不是直接通过构造函数——那么替代方法是使用反射（`Activator.CreateInstance...`）并保持默认构造函数私有。但这当然会带来性能损失。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-18T16:15:15.027

你想要**新的**T()，但你还需要添加`, new()`到`where`工厂方法的规范中

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-12-28T23:48:39.833

有点旧，但对于其他寻找解决方案的人来说，也许这可能会引起人们的兴趣：[http ://daniel.wertheim.se/2011/12/29/c-generic-factory-with-support-for-private-constructors/](http://daniel.wertheim.se/2011/12/29/c-generic-factory-with-support-for-private-constructors/)

两种解决方案。一种使用 Activator，另一种使用 Compiled Lambdas。

```
//Person has private ctor
var person = Factory<Person>.Create(p => p.Name = "Daniel");

public static class Factory<T> where T : class 
{
    private static readonly Func<T> FactoryFn;

    static Factory()
    {
        //FactoryFn = CreateUsingActivator();

        FactoryFn = CreateUsingLambdas();
    }

    private static Func<T> CreateUsingActivator()
    {
        var type = typeof(T);

        Func<T> f = () => Activator.CreateInstance(type, true) as T;

        return f;
    }

    private static Func<T> CreateUsingLambdas()
    {
        var type = typeof(T);

        var ctor = type.GetConstructor(
            BindingFlags.Instance | BindingFlags.CreateInstance |
            BindingFlags.NonPublic,
            null, new Type[] { }, null);

        var ctorExpression = Expression.New(ctor);
        return Expression.Lambda<Func<T>>(ctorExpression).Compile();
    }

    public static T Create(Action<T> init)
    {
        var instance = FactoryFn();

        init(instance);

        return instance;
    }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-04-20T20:40:38.263

您还可以使用反射来获取对象的构造函数并以这种方式实例化：

```
var c = typeof(T).GetConstructor();
T t = (T)c.Invoke(); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-12-11T00:36:53.977

使用工厂类通过编译的 Lamba 表达式构建对象：我发现实例化泛型类型的最快方法。

```
public static class FactoryContructor<T>
{
    private static readonly Func<T> New =
        Expression.Lambda<Func<T>>(Expression.New(typeof (T))).Compile();

    public static T Create()
    {
        return New();
    }
} 
```

这是我设置基准所遵循的步骤。

创建我的基准测试方法：

```
static void Benchmark(Action action, int iterationCount, string text)
{
    GC.Collect();
    var sw = new Stopwatch();
    action(); // Execute once before

    sw.Start();
    for (var i = 0; i <= iterationCount; i++)
    {
        action();
    }

    sw.Stop();
    System.Console.WriteLine(text + ", Elapsed: {0}ms", sw.ElapsedMilliseconds);
} 
```

我也尝试过使用工厂方法：

```
public static T FactoryMethod<T>() where T : new()
{
    return new T();
} 
```

对于测试，我创建了最简单的类：

```
public class A { } 
```

要测试的脚本：

```
const int iterations = 1000000;
Benchmark(() => new A(), iterations, "new A()");
Benchmark(() => FactoryMethod<A>(), iterations, "FactoryMethod<A>()");
Benchmark(() => FactoryClass<A>.Create(), iterations, "FactoryClass<A>.Create()");
Benchmark(() => Activator.CreateInstance<A>(), iterations, "Activator.CreateInstance<A>()");
Benchmark(() => Activator.CreateInstance(typeof (A)), iterations, "Activator.CreateInstance(typeof (A))"); 
```

> **超过 1 000 000 次迭代的结果：**
> 
> 新 A(): 11 毫秒
> 
> 工厂方法 A()：275 毫秒
> 
> FactoryClass A .Create(): 56ms
> 
> Activator.CreateInstance A()：235ms
> 
> Activator.CreateInstance(typeof (A)): 157ms

**备注**：我已经使用**.NET Framework 4.5 和 4.6**进行了测试（等效结果）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-03-29T18:12:54.387

而不是创建一个函数来实例化类型

```
public T InstantiateType<T>(string firstName, string lastName) where T : IPerson, new()
    {
        T obj = new T();
        obj.FirstName = firstName;
        obj.LastName = lastName;
        return obj;
    } 
```

你可以这样做

```
T obj = new T { FirstName = firstName, LastName = lastname }; 
```

# java - 如果带有字符串比较的语句失败

> ID：658953
> 
> 赞同：45
> 
> 时间：2009-03-18T16:13:18.540
> 
> 标签：java, multithreading, if-statement, string-comparison

我真的不知道为什么下面的 if 语句没有执行：

```
if (s == "/quit")
{
    System.out.println("quitted");
} 
```

下面是全班。

这可能是一个非常愚蠢的逻辑问题，但我一直在这里拉头发，无法弄清楚这一点。

谢谢你看:)

```
class TextParser extends Thread {
    public void run() {
        while (true) {
            for(int i = 0; i < connectionList.size(); i++) {
                try {               
                    System.out.println("reading " + i);
                    Connection c = connectionList.elementAt(i); 
                    Thread.sleep(200);

                    System.out.println("reading " + i);

                    String s = "";

                    if (c.in.ready() == true) {
                        s = c.in.readLine();
                        //System.out.println(i + "> "+ s);

                        if (s == "/quit") {
                            System.out.println("quitted");
                        }

                        if(! s.equals("")) {
                            for(int j = 0; j < connectionList.size(); j++) {
                                Connection c2 = connectionList.elementAt(j);
                                c2.out.println(s);
                            }
                        }
                    }
                } catch(Exception e){
                    System.out.println("reading error");
                }
            }
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2009-03-18T16:14:59.237

在您的示例中，您正在比较字符串对象，而不是它们的内容。

您的比较应该是：

```
if (s.equals("/quit")) 
```

或者如果`s`字符串 nullity 不介意/或者你真的不喜欢 NPE：

```
if ("/quit".equals(s)) 
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-03-18T16:21:06.633

要比较字符串是否相等，**请不要使用 ==**。**==**运算符检查两个对象是否完全相同：

在**Java**中有很多字符串比较。

```
String s = "something", t = "maybe something else";
if (s == t)      // Legal, but usually WRONG.
if (s.equals(t)) // RIGHT
if (s > t)    // ILLEGAL
if (s.compareTo(t) > 0) // also CORRECT> 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-02-14T07:23:57.890

`String`Java 中的 s 是对象，因此与 比较时`==`，您是在比较引用，而不是值。正确的方法是使用`equals()`.

不过，有办法。如果要`String`使用运算符比较对象`==`，可以利用 JVM 处理字符串的方式。例如：

```
String a = "aaa";
String b = "aaa";
boolean b = a == b; 
```

`b`将是`true`。为什么？

因为 JVM 有一个`String`常量表。因此，无论何时使用字符串文字（引号`"`），虚拟机都会返回*相同的*对象，因此会`==`返回`true`.

[`intern()`](http://java.sun.com/javase/6/docs/api/java/lang/String.html#intern%28%29)通过使用该方法，即使是非文字字符串，您也可以使用相同的“表” 。它返回对应于该表中当前字符串值的对象（或将其放在那里，如果不是）。所以：

```
String a = new String("aa");
String b = new String("aa");
boolean check1 = a == b; // false
boolean check1 = a.intern() == b.intern(); // true 
```

> 由此可见，对于任何两个字符串 s 和 t，当且仅当 s.equals(t) 为真时，s.intern() == t.intern() 才为真。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-14T19:36:18.633

You can use

```
if("/quit".equals(s))
   ... 
```

or

```
if("/quit".compareTo(s) == 0) 
    ... 
```

The latter makes a [lexicographic](http://www.inf.unibz.it/~calvanese/teaching/04-05-ip/lecture-notes/uni05/node19.html) comparison, and will return 0 if the two strings are the same.

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-18T16:18:41.243

您不应该使用 == 进行字符串比较。该运算符只会检查它是否是同一个实例，而不是同一个值。使用 .equals 方法检查相同的值。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-11-23T22:10:24.637

如果您使用 C++ 和 Java 编写代码，最好记住在 C++ 中，字符串类重载了 == 运算符。但在 Java 中并非如此。你需要使用`equals()`or `equalsIgnoreCase()`。

# perl - 如何为不与内置或 CPAN 包名称冲突的自定义 Perl 模块选择包名称？

> ID：658955
> 
> 赞同：28
> 
> 时间：2009-03-18T16:13:46.683
> 
> 标签：perl, module, naming-conventions, cpan

我已经阅读了[有关 modules 的 perldoc](http://perldoc.perl.org/perlmod.html)，但我没有看到关于命名包的建议，因此它不会与内置或 CPAN 模块/包名称冲突。

过去，为了开发本地的Session.pm模块，我用我公司的名字创建了一个本地目录，例如：

```
package Company::Session; 
```

...和 ​​Session.pm 将在目录 Company/ 中找到。

但我只是不喜欢这种命名约定。我宁愿将包层次结构命名为更接近代码的功能。但这通常是在 CPAN 上完成的......

我觉得我错过了一些基本的东西。我还查看了 Damian 的*Perl 最佳实践*，但我可能没有找对地方......

关于以正确的方式避免包命名空间冲突的任何建议？

**更新 w/ 相关问题**：如果存在*包*名冲突，Perl 如何选择使用哪一个？谢谢大家。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-03-18T17:05:52.923

命名空间`Local::`已为此目的而保留。CPAN 或核心不会接受以该前缀开头的任何模块。或者，您可以在顶级名称中使用下划线（like`My_Corp::Session`或 just `My_Session`）。所有带下划线的类别也已保留。（这在[perlmodlib](https://perldoc.perl.org/perlmodlib.html)中提到，在“为模块选择名称”下。）

请注意，这两个保留仅适用于顶级名称。例如，有名为`Time::Local`和的 CPAN 模块`Text::CSV_XS`。但是`Local::Time`和`Text_CSV::XS`是保留名称，不会在 CPAN 上被接受。

在您的公司之后命名模块也可以。（好吧，除非你为一些听起来很普通的公司工作。）使用反向域名可能是矫枉过正，除非你打算将你的模块分发给其他人。（但在这种情况下，您可能应该注册一个普通的模块名称。）

**Perl 如何解决冲突：**

Perl 在目录中搜索`@INC`具有指定名称的模块。找到的第一个模块就是使用的模块。因此，目录的顺序`@INC`决定了将使用哪个模块（如果您在不同的位置安装了同名的模块）。

`perl -V`将报告`@INC`（优先级最高的目录首先列出）的内容。但是也有很多方法可以`@INC`在运行时进行操作。

顺便说一句，Raku 可以[处理不同作者的多个同名模块](https://design.raku.org/S11.html#Versioning)，甚至可以在单个程序中使用多个模块。那是一个不同的解决方案。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-18T16:44:22.850

以公司名称命名内部模块并没有错；我总是这样做。我的 90% 的代码最终都在 CPAN 上，所以它有“正常”的名称，但内部的东西总是以`ClientName::`.

我相信其他人也这样做。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T16:25:29.963

只为您喜欢的包选择一个名称然后在谷歌上搜索“perl *the-name-you-picked* ”有什么问题？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-02T12:29:02.367

该`@INC`变量包含要在其中查找模块的目录列表。它从第一个条目开始，如果没有找到请求模块，则转到下一个条目。 `@INC`具有编译 perl 时创建的默认值，但您可以使用[`PERL5LIB`](http://perldoc.perl.org/perlrun.html#PERL5LIB)环境变量[`lib`pragma](http://perldoc.perl.org/lib.html)更改它，并直接在块中操作`@INC`数组：`BEGIN`

```
#!/usr/bin/perl

BEGIN {
    @INC = (); #no modules can be found
}

use strict; #error: Can't locate strict.pm in @INC (@INC contains:) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-18T16:36:41.277

如果您需要最大程度地确定您的模块名称不会与其他人的名称冲突，您可以从 Java 的书中获取一页：用公司域的名称命名模块。因此，如果您为 Example, Inc. 工作，并且他们的域名是 example.com，您可以将 HTML 解析器模块命名为 Com::Example::HTML::Parser 或 Example::Com::HTML::Parser。第一个的好处是，如果您有多个子单元，它们都可以有自己的名称空间，但模块仍然会一起排序：

*   Com::Example::Biz::FindCustomers
*   Com::Example::IT::ParseLogs
*   Com::Example::QA::TestServer

但乍一看确实很奇怪。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-02T12:09:10.213

（我知道这篇文章已经过时了，但由于过去几个月我不得不解决这个问题，我想我会权衡一下）

在工作中，我们认为“Local::”感觉过于地域化。CompanyName:: 对我们来说也有一些与开发无关的问题，我会跳过这些，虽然我会说 CompanyName 很长，因为你必须输入几十次。

所以我们选择了'Our::'。当然，我们不是“CPAN 安全”的，因为可能有一天我们想使用带有 Our:: 前缀的 CPAN 模块。不过感觉不错。

Our::Data 是我们的 Class::DBI 模块 Our::App 是我们的通用应用程序框架，它执行配置处理和 Getopt 内容

读起来很舒服，打字也很好。

# asp.net - Visual SVN 使用新端口指定 URL

> ID：658960
> 
> 赞同：2
> 
> 时间：2009-03-18T16:14:14.763
> 
> 标签：asp.net, visual-studio, svn, version-control, visualsvn

我们的 SVN 服务器最初设置为在端口 443 上运行，我们不得不将其更改为在端口 8443 上运行，因为它会导致与 IIS 冲突。

我的问题是如何更改我所有项目的存储库 URL 以指向新地址？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-18T16:16:53.103

选择您的项目文件夹单击颠覆菜单中的重新分配并添加新地址

# sorting - 使用 bindingsource 在正确位置向用户排序的 wingrid 添加新行

> ID：658967
> 
> 赞同：3
> 
> 时间：2009-03-18T16:15:50.843
> 
> 标签：sorting, infragistics, bindingsource, ultrawingrid

我有一个使用 bindingSource 的 Infragistics UltraGrid。

如果我在绑定列表中添加一个新对象，它会在网格底部添加一行，如果没有用户定义的排序，这很好。

问题是如果用户单击列标题对网格进行排序，有没有办法让新行以正确的排序顺序出现，而不是总是在底部？

在每次插入时重新排序所有行太昂贵了。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-26T19:40:19.640

似乎有点贫民窟。Infragistics 支持还表明 RefreshSortPosition() 方法是唯一的选择。

```
// Add to binding list which will trigger a row to be added to the bound ultragrid.
this.bindingList.Add(new Person("Smith", "John"));

// Get length since we know this will always be added to the end
int length = this.ultraGrid.Rows.All.Length;

// Get it to sort
this.ultraGrid.Rows[length - 1].RefreshSortPosition(); 
```

为了提高效率，您总是可以通过禁用重绘等来变得聪明，然后在一批订单之后对一堆行调用刷新等......

希望有帮助。我在谷歌搜索这个问题时运气不佳。

# c++ - 何时以及为什么需要 sleep()？

> ID：658973
> 
> 赞同：2
> 
> 时间：2009-03-18T16:16:58.797
> 
> 标签：c++, c, operating-system

```
cout<<"abcd";

sleep(100);

cout<<'\b'; 
```

如果我想打印字符串然后取回一个字符，为什么这里需要 sleep() ？

但是在 C 中使用 printf 时，似乎没有必要，为什么？

```
char* a = "12345";
char* b = "67890";
threadA(){cout<<a;}
threadB(){cout<<b;}

beginthread (threadA);
sleep(100);
beginthread (threadB); 
```

在上面的第二个伪代码中，使用 sleep() 是否正确？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-18T16:23:46.177

计算明天的日期：

```
void get_tomorrow_date( struct timeval *date )
{
    sleep( 86400 ); // 60 * 60 * 24
    gettimeofday( date, 0 );
} 
```

;)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-18T16:25:54.267

您需要了解两个微妙的问题：

> *   多线程
> *   I/O 和缓冲

我会试着给你一些想法：

> 多线程和睡眠

在线程环境中拥有 a`sleep`是有意义的。该调用使您等待，从而为初始线程提供了一些范围以完成其处理，即在另一个线程插入退格字符之前将`sleep`字符串写出到标准输出。`abcd`如果您不等待第一个线程完成其处理，您会先写退格字符，然后是字符串`abcd`，不会注意到任何区别。

> 缓冲 I/O

I/O 通常发生在缓冲、非缓冲和半缓冲状态。这可能会影响您必须等待输出出现在控制台上的时间（如果有的话）。

您的 cout 实现可能正在使用缓冲模型。`endl`尝试在语句末尾添加换行符或 the`cout`以打印新行并立即刷新，或者使用`cout << "abcd" << flush;`to 刷新而不打印新行。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-18T16:21:38.537

在没有睡眠的第二种情况下，第二个线程在第一个线程之前开始工作的*可能性*很小，导致输出“6789012345”。

然而，“睡眠”并不是真正处理线程之间同步的方法。您通常会使用信号量或类似的信号量，在`threadA()`其`threadB()`工作之前必须等待。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-18T17:22:03.977

我认为您需要了解`sleep`一般情况下会发生什么，并了解它可能存在的原因。

`sleep`做它听起来的样子。它指示操作系统通过将请求任务（其中任务是执行线程）从当前正在运行的进程列表中删除并将其放在某种等待队列中来将其置于睡眠状态。

请注意，无论您喜欢与否，有时操作系统都会让您入睡。例如，任何形式的阻塞 I/O，例如从磁盘读取文件。操作系统这样做是为了在您等待数据时其他任务可能会引起 CPU 的注意。

人们会`sleep`自愿将其用于与操作系统类似的目的。例如，如果您有多个线程并且它们正在等待某些计算的完成，您可能希望自愿放弃 CPU 以便计算可以完成。您也可以自愿放弃 CPU，以便其他线程有机会运行。例如，如果您有一个高度受 CPU 限制的紧密循环，您会希望`sleep`不时地让其他线程有机会运行。

看起来你正在做的事情是为了将某些东西刷新到标准输出而睡觉，这样其他线程就不会在你之前写入标准输出。但是，这不能保证有效。它可能会偶然起作用，但它肯定不是你**想要**做的设计。您要么想显式刷新缓冲区而不是休眠，要么使用某种形式的同步。

至于为什么`printf`不表现出这些问题......好吧，这是一个废话。两者都`printf`使用`cout`某种形式的缓冲输出，但每个的实现可能不同。

总之，最好记住以下几点：

*   当您想要同步时，请使用同步原语。
*   当你想给别人一个跑步的机会时，睡吧。
*   操作系统更擅长判断 I/O 操作是否阻塞。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-18T16:23:11.263

调用 sleep 使您的代码工作的原因是因为您正在使用它将两个输出流操作的潜在并行执行转换为单个顺序操作。对 sleep() 的调用将允许调度程序从主执行线程切换并执行线程 A。

如果您不放入 sleep() ，则无法保证线程执行的顺序，并且线程 B 很可能在线程 A 有机会执行此操作之前就开始执行/打印。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-18T17:29:07.873

在启动两个线程的代码中：

```
beginthread (threadA);
sleep(100);
beginthread (threadB); 
```

sleep() 等待 100 毫秒，然后继续。程序员这样做可能是为了让线程A 有机会在启动线程B 之前启动。如果在启动threadB之前必须等待threadA初始化并运行，那么就需要一种等待threadA启动的机制，但这是错误的做法。

100 是一个神奇的 cookie，可以任意选择，可能伴随着一个想法，例如“线程 A 的启动时间永远不应该超过 100 毫秒”。像这样的假设是错误的，因为您无法知道 threadA 需要多长时间才能启动。如果机器很忙，或者如果 threadA 的实现发生了变化，那么线程启动、运行它的启动代码并进入它的主循环（如果它是那种线程）很容易花费超过 100 毫秒的时间。

threadA 需要在主线程启动和运行时通知主线程，而不是休眠一段时间。执行此操作的一种常见方法是发出事件信号。

说明如何执行此操作的示例代码：

```
#include "stdafx.h"
#include <windows.h>
#include <process.h>

struct ThreadParam
{
    HANDLE running_;
    HANDLE die_;
};

DWORD WINAPI threadA(void* pv)
{
    ThreadParam* param = reinterpret_cast<ThreadParam*>(pv);
    if( !param )
        return 1;

    // do some initialization
    //  :   :

    SetEvent(param->running_);
    WaitForSingleObject(param->die_, INFINITE);
    return 0;
}

DWORD WINAPI threadB(void* pv)
{
    ThreadParam* param = reinterpret_cast<ThreadParam*>(pv);
    if( !param )
        return 1;

    // do some initialization
    //  :   :

    SetEvent(param->running_);
    WaitForSingleObject(param->die_, INFINITE);
    return 0;
}

int main(int argc, char** argv) 
{
    ThreadParam 
        paramA = {CreateEvent(0, 1, 0, 0), CreateEvent(0, 1, 0, 0) },
        paramB = {CreateEvent(0, 1, 0, 0), CreateEvent(0, 1, 0, 0) };

    DWORD idA = 0, idB = 0;
    // start thread A, wait for it to initialize
    HANDLE a = CreateThread(0, 0, threadA, (void*)&paramA, 0, &idA);
    WaitForSingleObject(paramA.running_, INFINITE);
    // start thread B, wait for it to initi
    HANDLE b = CreateThread(0, 0, threadB, (void*)&paramB, 0, &idB);
    WaitForSingleObject(paramB.running_, INFINITE);
    // tell both threads to die
    SetEvent(paramA.die_);
    SetEvent(paramB.die_);
    CloseHandle(a);
    CloseHandle(b);
    return 0;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-18T16:21:29.287

第一个示例中的 sleep 只是在您看到“退格”动作之前打印一点消息。在第二个示例中，睡眠“可以”提供帮助。但这很奇怪。在某些更复杂的情况下，您将无法将控制台输出与睡眠同步。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-18T16:24:38.153

如果您在看到正在打印的“abcd”时遇到问题，那是因为您没有给 cout 一个结束字符来刷新缓冲区。

如果你把

```
cout << "abcd" << endl; 
```

您将能够看到字符，然后它会发出哔哔声。不需要睡觉。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-18T16:38:39.400

```
while( true )
{
   msgStack.Lock();
   process( msgStack.pop_msg());   
   msgStack.Unlock();
   sleep(0);
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-18T16:19:43.157

它不是必需的——如果你省略它，你会得到什么输出？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-18T16:20:22.440

sleep 唯一要做的就是在调用线程上暂停执行指定的毫秒数。它绝不会影响您可能进行的任何打印的结果。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-18T16:21:23.107

睡眠可用于避免某个线程/进程（是的，我知道它们是不同的东西）占用处理器。

另一方面， printf 是线程安全的。库特不是。这或许可以解释他们行为上的差异。

# regex - mod_rewrite：将 URL 中的“文件夹”转换为查询参数

> ID：658978
> 
> 赞同：0
> 
> 时间：2009-03-18T16:18:33.567
> 
> 标签：regex, apache, mod-rewrite

我希望能够采用如下 URL：

```
http://www.example.com/valOne/valTwo/valThree/valFour/valFive 
```

并将其转换为：

```
http://www.example.com/index.php?one=valOne&two=valTwo&three=valThree&four=valFour&five=valFive 
```

我的应用程序真的只需要几个查询参数，因此正则表达式可以对这五个硬编码，但如果它可以动态创建新的查询参数，因为额外的“文件夹”被添加到 URL，那就太好了。此外，并非所有五个文件夹或 QP 都将始终存在，因此它必须能够适当地处理它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T16:25:21.053

这是满足您需求的 mod_rewrite 规则：

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^([^/]*)/?([^/]*)/?([^/]*)/?([^/]*)/?([^/]*)/?$ index.php?one=$1&two=$2&three=$3&four=$4&five=$5 
```

但是，如果您使用 PHP 解析请求的 URI 路径，那肯定会更容易：

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule !^index\.php$ index.php

$_SERVER['REQUEST_URI_PATH'] = preg_replace('/\?.*/', '', $_SERVER['REQUEST_URI']);
$segments = explode('/', trim($_SERVER['REQUEST_URI_PATH'], '/'));
var_dump($segments); 
```

# xna - XNA 和 DarkBasic

> ID：658982
> 
> 赞同：4
> 
> 时间：2009-03-18T16:20:14.157
> 
> 标签：xna

各自的优势是什么，一个比另一个更容易学习？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T17:12:14.623

注意：我使用 XNA 进行开发，直到现在才听说过 DarkBasic。

XNA 提供对 Xbox 和 Zune 平台的支持，并拥有一个庞大的社区，并得到 Microsoft 的官方支持。

XNA 文档和教程非常丰富，并且围绕它存在许多第 3 方站点和博客。

XNA 使用 C# 编写，与 VB 相比，作为程序员，我发现它更加直观。

经过大约 10 个小时的阅读和 XNA 小教程，我觉得能够快速有效地编写几乎任何类型的游戏。我发现基本架构非常直观。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T17:28:39.997

正如在别处提到的，XNA 允许在 Windows 之外轻松开发 Xbox 360 和 Zune 平台。XNA 也是建立在 C# 之上的，而 DarkBASIC 似乎使用了一种专有的类似 BASIC 的语言（如您所料）。

我不确定我对花大量时间使用这种语言进行开发的前景有多疯狂，因为我将我的 XNA 项目视为一种在学习新的 XNA 框架工具的同时提高我的 C#/.NET 知识的方式同时。（但这只是个人喜好，当然。）

除非使用 DarkBASIC 有一些我没有看到的主要优势，否则我会很自在地说 XNA 在几乎所有方面都优于 DB。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T17:27:32.747

DarkBasic 比较老，基于基础，对于非学生来说可能不是一个好主意，而且要花钱，虽然很少。XNA 基于 .NET，通常基于 C#，并且可以针对某些设备，例如 XBox 和 Zune。就个人而言，我会推荐 XNA 而不是 DarkBasic，因为您可以从 Microsoft 获得非常可靠的工具（IDE、调试器）。它们同样难以学习。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-10-22T02:42:30.080

几年来，我一直在用 Dark GDK 为 C++ 程序员教授游戏开发，发现它的执行速度非常快（因为 DirectX 9）并且非常容易编程（如果你是 C++ 或 C# 程序员）

来自 [http://en.wikipedia.org/wiki/DarkBASIC_Professional](http://en.wikipedia.org/wiki/DarkBASIC_Professional)：

> 暗 GDK 和暗 GDK .NET
> 
> Dark GDK 是一个用于 C++ 的软件开发工具包。它实现了 DBPro 中可用的大多数命令，并为用户提供了对 API 的较低级别的访问权限。目前支持 Microsoft Visual Studio 6 和 Visual Studio .NET 2003，但 The Game Creators 表示他们计划在未来的版本中支持 Dev-C++，尽管他们尚未扩展对 Dev-C++ 的支持，计划可能会被放弃现在支持 Visual C++ 2005。[需要引用]。Dark GDK 的 API 与 DarkBASIC Professional 的 API 非常相似，因此代码可以很容易地在使用 Dark GDK 的 C++ 代码和 DarkBASIC Professional 代码之间移植。Dark GDK 现在也可用于 Visual C++ 2008 Express。Dark GDK 可供个人免费使用，但如果您打算销售使用 Dark GDK 制作的游戏，则必须购买许可证。黑暗的GDK。NET 的创建目的相同，只是它允许用户使用 Visual C# .NET 或 Visual Basic .NET 创建游戏。与 Dark GDK 不同，Dark GDK .NET 仅在商业上可用，没有免费版本。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-03-13T07:00:47.810

作为一名初级程序员，在过去的一年里，我一直在断断续续地学习 DarkBASIC Pro。我喜欢它，我希望我只是早点开始。我有两套书来帮助自己使用 DBpro；

“DarkBASIC Pro - 游戏编程第二版” “Hands On DarkBASIC Pro” I & II 如果你刚刚开始，我可以推荐所有这些。

此外，如果您正在使用 DarkBASIC 进行编码，您最好选择一个较新的 IDE，最流行的是 Synergy Editor 或 CodeSurge。一旦您尝试了这些新的免费 IDE，在旧的原始 IDE 中编码几乎是不可能的。

有了这个，我不能评论从一个包到另一个包的优势。我想这在很大程度上取决于你想要做什么。但我确实喜欢使用 DB Pro。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-08-03T18:39:25.177

在我看来，每个系统相对于另一个系统的主要优势如下：

1.  **XNA 允许您针对更多目标平台进行开发，尤其是 Xbox 360 游戏机**。DarkBasic 的目标平台仅限于 Windows PC，而 XNA 可以为 Windows PC 和 Xbox 360（以及便携式 Zune 设备，据我了解不是一个非常流行的平台）制作游戏。

2.  **与 XNA 相比，DarkBasic 似乎允许更大程度的 RAD（快速应用程序开发）编程。** 我的假设部分基于查看 GameCreator 的“The 3D Gamemaker”产品，它当然允许 RAD 开发（实际上，甚至不需要编程！）。我意识到“The 3D Gamemaker”和 DarkBasic 不是同一产品；然而，Dark Game Studio（包括 DarkBasic）是在“使用专业工具构建游戏内容”的前提下进行基础设计的。

3.  **在我看来，XNA 作为一种开发语言可能略胜一筹。** 这不会影响最终产品的整体质量，而只会影响程序员和产品的开发。XNA 被设计成一种真正的面向对象语言，并且基于强制面向对象设计的.NET 框架。据我所知，DarkBasic 的 SDK 确实支持面向对象的实践。但是我不知道 DarkBasic 在多大程度上支持面向对象的编程。话虽如此，但 DarkBasic 可能确实支持足够的面向对象编程，如果不是很好的话。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2011-08-21T02:26:54.997

Dark Ba​​sic 适合业余爱好者。它快速、简单且有效。
XNA 适合有技能和时间的人。
这是经典的力量与效率。类似于 Python vs. C++，一个快速，一个强大。

# visual-studio-2008 - 应用程序没有引用需要在 GAC 中为 ClickOnce 使用 Office 12 (2007) 的 Office

> ID：658984
> 
> 赞同：0
> 
> 时间：2009-03-18T16:20:30.177
> 
> 标签：visual-studio-2008, .net-3.5, ms-office

我有一种情况，我试图通过 ClickOnce 向许多用户部署应用程序更新，但在某些情况下，它失败并出现错误，指出他们的 GAC 中需要 Office 12.0.0.0。

这发生在我安装 Office 2007 之后，所以我卸载了 2007 并重新安装了 Office 2003，然后重新构建/重新发布了该应用程序。修复了一些，但不是全部。

应用程序中没有对 Office 的引用，所以我不确定它为什么要检查依赖项。

我检查了我的 GAC，它仍然列出了 office 12 并且不允许我删除它 - 说它是 Windows Installer 所必需的

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T16:28:20.860

在此处检查：项目属性 - 发布 - 先决条件。

在这里：安装包属性 - 先决条件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T17:46:01.577

我想我已经解决了这个问题，但我不确定它是如何发生的。在发布选项卡上的应用程序文件中有对 office.dll 的引用。它被列为必需的先决条件，但未列在先决条件下（这就是为什么我不接受 WakeUpScreaming 的回答，尽管我确实根据他的建议找到了它。

由于我的应用程序中没有对任何 Office 的引用，我将该文件标记为排除，现在它将部署给我的用户。

只是想我会让每个人都知道我发现了什么。

2009 年 4 月 6 日更新：卸载所有可能的 Office 2007 组件（包括 PIA）后，我仍然遇到问题。事实证明，GAC 中仍然存在将 Office 11 重定向到 Office 12 的策略，并且它们不会卸载。我使用 GACBrowser 删除了策略，一切都很好。

# java - 是否提供基于 Web 的电子邮件回复/报价代码？

> ID：658986
> 
> 赞同：4
> 
> 时间：2009-03-18T16:20:39.163
> 
> 标签：java, html, email

我想编写一种需要与来自客户（许多不同系统）的电子邮件进行交互的迷你 CRM 系统。我希望它能够回复他们的电子邮件，并像其他电子邮件应用程序一样将原始电子邮件放在一个很好的引用回复格式中。

这在回复 ASCII 电子邮件时似乎相当容易，但是我们如何将传入的 HTML 格式化为引用的（即，左侧下方的小条表示它是引用的文本）？是否已经有代码可以执行此操作（最好是 Java）？

或者是我想太多问题了……

[类似但不完全相同的问题](https://stackoverflow.com/questions/278788/parse-email-content-from-quoted-reply)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T19:47:20.803

在大多数情况下，最好的解决方案是将 HTML 电子邮件转换为文本电子邮件（大多数电子邮件都是同时发送的，因此您也可以只“首选”文本）。

也就是说，如果您必须以 HTML 格式发送电子邮件，请使用 <blockquote> 标记。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-02T14:03:29.737

只需`<blockquote>`在引用的文本周围添加标签。也许您可以使用一点 CSS 来设置引用文本的样式，但我不确定这是否适用于所有邮件客户端。*******