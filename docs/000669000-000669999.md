# StackOverflow 问答 000669000-000669999

# iphone - 下载后收到通知？

> ID：669000
> 
> 赞同：0
> 
> 时间：2009-03-21T08:58:40.580
> 
> 标签：iphone

imageData = [[NSData alloc] initWithContentsOfURL:[NSURL URLWithString:srcAddres]];

将 jpeg 下载到我的图像数据会花费一些时间，例如：2 秒，所以我想显示一个活动指示器，直到下载完成。我如何知道下载何时完成？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T11:12:20.040

您需要改用异步 URL 加载系统（`NSURLConnection`在 iPhone SDK 上）。这是苹果的文档：

[http://developer.apple.com/DOCUMENTATION/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html](http://developer.apple.com/DOCUMENTATION/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-23T05:52:45.970

您需要所谓的“选择器”。

我建议仍然使用同步调用 - 但在单独的线程中。这背后的原因是，尽管是异步的，但如果您在当前线程中传输数据，您仍然会遇到 UI 缓慢的问题。如果您使用全局网络活动指示器，这不是问题 - 但您的应用程序（或任何其他屏幕重绘）本地的指示器 - 似乎已被锁定。

因此，创建一个名为 ImageDownloader（或类似）的类，并将同步下载调用放在那里，以获取图像数据。作为类的成员之一，声明（在接口中）：

```
SEL successSelector; 
```

当你创建这个类时（假设你想传入一个 URL，并取回你的图像数据，创建一个以下形式的 init 函数（它接受一个 SEL），并使用以下方法调用它：

```
[ImageDownloader alloc] initWithSelector: @"http://url string" :self : @selector(yourFunction:) 
```

]

基本上，您需要传递一个对象以及该对象中的方法，以便在完成后回调。

'initWithSelector' 实现如下所示：

```
-(id) initWithSelector: (NSString*)url :(id)adelegate :(SEL) successSeletor {
     self.url = url;
     self.delegate = adelegate;
     self.sel = successSelector;
} 
```

（注意 'yourFunction' 后面的冒号 - 你的回调函数的每个参数都需要一个冒号。

所以 yourFunction 的信号看起来像：

```
-(void) yourFunction: (NSData*)imageData; 
```

要从您的 ImageDownloader 类中调用它（下载完成后），只需使用以下命令调用您的选择器：

```
[delegate performSelector:sel withObject:imageData]; 
```

享受！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T16:16:52.227

假设这项工作在控制器中，按照建议使用 NSURLConnection 作为 Graham Lee，并将 self（控制器）设置为该对象的委托。

然后在控制器中声明以下方法（[有关更多信息，请参阅此链接](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/Foundation/Classes/NSURLConnection_Class/Reference/Reference.html#//apple_ref/doc/uid/20001697-BAJHIAJA)）：

```
- (void)connectionDidFinishLoading:(NSURLConnection *)connection 
```

加载完成后，将调用您的委托。顺便说一句，要显示网络活动指示器，您可以使用如下代码：

```
UIApplication* app = [UIApplication sharedApplication];
app.networkActivityIndicatorVisible = YES; // to stop it, set this to NO 
```

同样，各种代表将在这里为您提供帮助。

# linux - 什么是好的免费终端多路复用器？

> ID：669005
> 
> 赞同：6
> 
> 时间：2009-03-21T09:04:27.273
> 
> 标签：linux, terminal

你能推荐一些开发得很好的终端多路复用器吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-21T09:04:43.390

使用[screen](http://www.manpagez.com/man/1/screen/)，一个由 GNU 项目开发的免费终端多路复用器，它允许您将多个终端合二为一。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-12-28T16:27:13.970

另一种选择是[tmux](http://tmux.sourceforge.net/)，有些人认为它是旧“屏幕”的替代品。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-01-08T14:09:43.543

还有 byobu - 见：

*   [http://byobu.co](http://byobu.co)
*   [http://en.wikipedia.org/wiki/Byobu_%28software%29](http://en.wikipedia.org/wiki/Byobu_%28software%29)
*   [https://launchpad.net/byobu](https://launchpad.net/byobu)
*   [https://help.ubuntu.com/10.04/serverguide/C/byobu.html](https://help.ubuntu.com/10.04/serverguide/C/byobu.html)

# php - IDE 代码模板可以提高我的工作效率吗？

> ID：669007
> 
> 赞同：2
> 
> 时间：2009-03-21T09:04:51.267
> 
> 标签：php, ide, intellisense

在我的用于 PHP 开发的 Eclipse IDE 中阅读[http://www.symfony-framework.com/2008/06/03/speed-symfony-developing-with-eclipse-snippets-templates/](http://www.symfony-framework.com/2008/06/03/speed-symfony-developing-with-eclipse-snippets-templates/)后，我最近尝试了代码模板。

我有一个想法，当这些工具可以使开发人员受益时。开发人员不断学习新工具、编程语言、框架等。当您使用新的东西时，您的工作效率通常不会很高，因为您不知道（或不记得语法）。

我认为代码模板在这一点上会变得非常有用。

只是为了给你一个想法，我将举一个例子：

这是 PHP Doctrine ORM finder 方法使用的代码片段。

```
$table = Doctrine::getTable('User');
// find by primary key
$user = $table->find(2); 
```

如果我记得这个片段，就像 Dfind（ctrl+space 运行智能感知和代码模板替换稍后）。Dfind（D - Doctrine 单词中的第一个字母）。

所以，我不需要记住所有这些 API 语法，只需使用 Dfind 来运行 Doctrine 的 finder 方法。

这是一个非常微不足道的例子，也许很难看出这种方法的好处，但是您可以使用此功能来替换更大的构造（更难记住）。

我之前在该主题上搜索过，但没有找到有关`unusual`使用此 IDE 功能的任何信息。

那么，请让我知道您对此有何看法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T09:14:21.087

我在 Visual Studio 中使用 devexpress coderush 和重构。我确实经常使用代码模板，我发现它们大大提高了我的工作效率。但对一些人来说更多，对另一些人来说更少。这是个人的事情，取决于你的工作方式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T09:31:53.590

我认为这是一种好处。有些人强烈反对使用模板和代码完成，原因从“它烦人”到“它让程序员变得懒惰”不等。我个人不使用模板，但这只是个人喜好。

我确实同意，在使用具有大约 200 多个公开函数的库时，在您使用它足以记住之前获得提示会更有效率。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T09:43:49.067

IMO 这绝对是一个非常有用的功能，尤其是对于所有通用语言功能 - 例如 for 循环。

您可以使用片段节省大量按键 - 例如自动完成片段并允许您快速移动可更改的部分。

```
for ( variable = value ; variable < value2 ; variable++ )
{

} 
```

因此，当您更改变量时，所有三个事件都会发生变化。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-21T15:54:49.283

从长远来看不是。最好提高你的打字技巧。除了自动为您关闭大括号和引号之外的任何事情都是危险的。它为您的代码添加了一些东西，并可能诱使您使用冗长的解决方案来解决可以用更少的代码和更多的思考来解决的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T15:38:45.547

自动完成绝对有用，尤其是在使用大型库时。但是代码模板听起来像是鼓励违反 DRY 原则的东西。

# iphone - iPhone 开发 - 开发和分发配置之间有什么区别？

> ID：669019
> 
> 赞同：42
> 
> 时间：2009-03-21T09:14:16.970
> 
> 标签：iphone

我无法在 Apple 文档中找到关于**开发**和**分发**配置之间的区别的明确解释。我目前正在使用开发配置在我的 iPhone 上进行开发和测试。我打算将应用程序分发给我的 beta 测试，我想知道：

*   我需要使用**分发**配置吗？
*   我应该为每个单独的测试人员制作一个 .mobileprovision 文件，还是我可以为所有测试人员制作一个？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-03-21T10:05:45.410

开发配置文件用于在开发阶段测试您的应用程序。

分布配置文件有两种类型

1.  用于临时测试
2.  提交到应用商店

即席测试是当您完成开发并希望将您的应用程序分发给多个用户进行测试时（您的第二个问题）。只需为临时测试创建一个分发配置文件并选择配置文件对其有效的所有设备 ID。在这种情况下，您只需将 .app 文件和 .mobileprovision 文件发送给每个测试您的应用程序的用户。

要将应用程序提交到应用程序商店，您必须创建一个分发 mobileprovision 文件，并选择“App Store”选项。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-21T17:40:43.320

我认为开发配置文件允许您在调试器中运行应用程序，而临时配置文件则不能。（无论如何，这就是我所观察到的，假设它应该表现得那样。）

# c - 如何让夹板忽略我声明变量的位置？

> ID：669023
> 
> 赞同：6
> 
> 时间：2009-03-21T09:17:13.623
> 
> 标签：c, static-analysis, c99, lint, splint

你知道我怎样才能让夹板忽略我声明变量的地方吗？

我知道老派 c 告诉你在每个函数的开头声明变量，但由于我是一个坏人，我喜欢在我使用它们的地方声明东西。一个很好的例子是把 int i; 就在 for(i=0;...) 之前。

我们举一个非常简单的例子

```
#include  <stdio.h>
int main()
{
    printf("Hello splint test\n");

    int i;
    for(i=5;i>0;i--)
    {
        printf("%2d...\n",i);
    }

    return 0;
} 
```

这里夹板和大多数旧的 c 编译器都想移动 int i; 向上一行，或将 {} 放在声明和 for 循环周围。

现在的问题是，我如何关闭此检查？但是保持其他检查好？

谢谢约翰

* * *

注意 1：我已经使用 gcc 警告（见下文）作为第一道防线，而 valgrind 作为第二道防线。但是我正在考虑将夹板添加到可以控制我的愚蠢的事物列表中；-) 但是这个检查很烦人，

我使用的 gcc 警告： -Wall -W -Wextra -Wconversion -Wshadow -Wcast-qual -Wwrite-strings -Werror

注意 2：我知道这种不良行为可能带来的潜在可移植性问题。但我觉得它增加了可读性，也就是不需要上下跳跃来搜索这种类型的 off 声明更有价值（我们可以在另一个线程中讨论这个）。

* * *

**更新**：更多信息，我将上面的代码放在一个名为 main.c 的文件中。使用的平台是 Ubuntu 8.04 和 gvim 作为编辑器，这是我运行时 splint 的输出：

```
splint +gnuextensions main.c
Splint 3.1.1 --- 03 Nov 2006

Command Line: Setting +gnuextensions redundant with current value
main.c:8:8: Parse Error. (For help on parse errors, see splint -help
                 parseerrors.) 
```

这又提出了两个我以前没有考虑过的问题。

1.  “与当前值冗余”，当前值是多少？

2.  为什么它是解析错误而不是警告？

* * *

**更新：：**有可能修补夹板来支持这个问题，我还没有尝试过，但我认为这是解决方案。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-23T16:58:15.090

这是一个补丁： [http ://www.cs.virginia.edu/pipermail/splint-discuss/attachments/20080718/52cc25f6/attachment.obj](http://www.cs.virginia.edu/pipermail/splint-discuss/attachments/20080718/52cc25f6/attachment.obj)

如果您在 splint/src 目录中，您应该能够通过 patch -p2 提供它，然后它应该只是重建。

这是来自这封电子邮件： [http ://www.cs.virginia.edu/pipermail/splint-discuss/2008-July/001190.html](http://www.cs.virginia.edu/pipermail/splint-discuss/2008-July/001190.html)

（对不起那个间距。）

你最终会发现，如果你跟随starblue链接的线程，但我想我会为你跳到最后。

不幸的是，Splint 现在似乎没有维护者。如果我不那么忙，我会考虑加强并做更多的事情。

杰克

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-21T12:35:10.683

[Splint 邮件列表上的这个线程](http://www.cs.virginia.edu/pipermail/splint-discuss/2008-August/001210.html)讨论了这个问题。

好像解析器大多是C89/C90，只有库好像是C99。

由于问题出在解析器上，因此您无法通过设置标志来解决问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-21T10:38:50.060

我不熟悉夹板，但来自[他们的常见问题解答](http://www.splint.org/faq.html)：

> Splint 独立于您的编译器。它根据 ISO C99 规范检查标准 C 代码。Splint 支持大部分（但不是全部）对 ANSI C 的 C99 扩展。Splint 支持一些 gcc 编译器扩展（如果使用了 +gnuextensions）。

您声明的位置完全符合 C99 标准，因此也许您可以将其视为夹板中的错误。或者它是夹板尚未支持的“扩展”之一。无论哪种方式，他们都可能对您的反馈感兴趣。符合 C99 的 lint 工具应该没有理由抱怨变量声明。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-21T09:45:44.303

通常，使用夹板，如果可以抑制某些东西，它会说“用 +thisflag 或 -thisflag 抑制它”

您可以尝试 splint +gnuextensions foo.c ，它会打开（大多数） GNU/GCC 扩展，否则 splint 会遇到问题。

我使用夹板的频率几乎和使用 valgrind 一样频繁。

编辑：

正如其他人所说，您遇到了解析器（而不是分析器），所以在这种情况下，标志真的无济于事。

# java - Java 中的 GoogleMaps API

> ID：669025
> 
> 赞同：2
> 
> 时间：2009-03-21T09:18:32.263
> 
> 标签：java, google-maps

在 Java 项目中使用 GoogleMaps 是否有一种很好的高性能方式，而无需使用 SWT 浏览器。我只知道 SwingX Toolkit (swinglabs.org) 有一个很好的实现，但它只能使用 OpenMaps（与 GoogleMaps 的功能不同）或 Nasa BlueMarble。提前感谢卢卡斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T09:28:22.850

恐怕谷歌地图的许可只允许在可公开访问的网站上使用它。我怀疑您的申请是否符合资格。

# html - 在网页上使用印刷引号是一种好习惯吗？

> ID：669026
> 
> 赞同：8
> 
> 时间：2009-03-21T09:19:33.977
> 
> 标签：html, css, xhtml, encoding

最近，我看到越来越多的设计文章鼓励在网页中使用印刷引号（Curly Quotes）而不是直引号。

虽然我同意排版，但正确的引号更具吸引力并为设计增添了不错的感觉，但我想知道从编码的角度来看它是否实际上是更好的做法。

我发现这些引号也不能跨文档复制和粘贴，也不一定要刮掉，并且最终会出现烦人的缺失字符符号。不要介意它们在示例代码块中使用时，我讨厌这样。

我对文本编码不是很了解，所以我想知道是否有人对这个主题有任何建议？

那么`&quot;`更好或更可靠`&ldquo;`

编辑：这个问题主要适用于内容区域，其中`<q>`或`<blockquote>`语义上不是最佳选择。此外，诸如复数之类的东西。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-21T09:56:52.467

您可能应该使用实体 “ (左双引号) 和 ” （右双引号）而不是剪切和粘贴您从 Word 复制到剪贴板的任何内容。你会发现它几乎可以在任何地方工作。

短连字符和长连字符（分别是 – 和 —）也是如此。

（我花了太多时间在 HTML 中清理这些内容。:-)

[这](http://www.htmlhelp.com/reference/html40/entities/)是所有可用 HTML 实体的一个很好的参考。

编辑：在回答问题时：“*使用 “ 有什么不同吗？而不是“ ? 这些实体中的任何一个也需要特定的字符集吗？我应该使用 UTF-8 吗？*”

我不认为有任何区别。 在[HTML 4.0 规范中，](http://www.w3.org/TR/1998/REC-html40-19980424/cover.html#toc)[此处提供了指向](http://www.w3.org/TR/1998/REC-html40-19980424/struct/global.html#idx-entity_sets)[HTMLSpecial.ent](http://www.w3.org/TR/1998/REC-html40-19980424/HTMLspecial.ent) DTD的链接，其中包括以下内容：

```
<!ENTITY rdquo   CDATA "&#8221;" -- right double quotation mark,
                                    U+201D ISOnum --> 
```

所以我会说它们是等价的。至于它们是否属于特定的字符集，HTML 4.0 规范的第[5.3.1节说：](http://www.w3.org/TR/1998/REC-html40-19980424/charset.html#h-5.3.1)

> 数字字符引用指定文档字符集中字符的 [代码位置](http://www.w3.org/TR/1998/REC-html40-19980424/charset.html#code-position)。

[5.1](http://www.w3.org/TR/1998/REC-html40-19980424/charset.html#h-5.1)说：

> …所以 HTML 使用了更完整的字符集，称为通用字符集 (UCS)，在[[ISO10646]](http://www.w3.org/TR/1998/REC-html40-19980424/references.html#ref-ISO10646)中定义。… [[ISO10646]](http://www.w3.org/TR/1998/REC-html40-19980424/references.html#ref-ISO10646)中定义的字符集逐个字符地等效于 Unicode 2.0 ( [[UNICODE]](http://www.w3.org/TR/1998/REC-html40-19980424/references.html#ref-UNICODE) )。

我不是Unicode 方面的[专家](http://joelonsoftware.com/articles/Unicode.html)，但我认为这几乎可以说明您可以使用几乎任何基于 Unicode 的字符编码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T09:29:20.693

我认为这纯粹是一个设计问题。对我来说，网页的主要目标应该是语义结构。网页的机器和人类读者可以毫不费力地使用直接引用。使用通常字符范围之外的字符只会自找麻烦。也许你可以使用一些 CSS 来满足你的设计师？

使用 blockquote 可能是最好的，因为这是语义，看看[http://simonwillison.net/2003/May/21/stylingBlockquotes/](http://simonwillison.net/2003/May/21/stylingBlockquotes/)

# windows - 从 C# 调用 MsiEnumRelatedProducts 崩溃

> ID：669027
> 
> 赞同：4
> 
> 时间：2009-03-21T09:20:16.923
> 
> 标签：windows, installation, windows-installer, pinvoke

我从 C# 调用 MsiEnumRelatedProducts 时遇到了无穷无尽的麻烦。我在 p/invoke 定义上尝试了几种变体，但没有运气（out 和 ref）。我认为问题出在最后一个参数上，它是一个 LPTSTR，它应该指向一个 39 个字符长的字符串。

这是 pinvoke 和调用：

```
public static string EnumRelatedProducts(string UpgradeCode, int Index)
{
    string ProductCode;
    UInt32 rc = MsiEnumRelatedProducts(UpgradeCode, 0, Index, out ProductCode);
    Console.WriteLine("Returned");
    if (rc != 0)
    {
        return string.Empty;
    }

    return ProductCode;
}

[DllImport("msi.dll", CharSet = CharSet.Auto)]
private static extern UInt32 MsiEnumRelatedProducts(string UpgradeCode, int reserved, int Index, out string ProductCode); 
```

请注意，仅当传递的 UpgradeCode 至少安装了 1 个产品时才会发生崩溃。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-21T09:28:37.187

尝试像这样声明：

```
[DllImport("msi.dll")]
private static extern uint MsiEnumRelatedProducts(
             string lpUpgradeCode, 
             uint dwReserved, 
             uint lProductIndex, 
             StringBuilder lpProductBuf); 
```

# wordpress - 使用 .htaccess 从一个域重定向到另一个域

> ID：669029
> 
> 赞同：2
> 
> 时间：2009-03-21T09:27:05.097
> 
> 标签：wordpress, url, .htaccess, url-rewriting

我最近为我的 WordPress 网站购买了一个新域，我想将使用旧域访问的任何人重定向到新域。我没有移动服务器，只是添加了一个新域。

例如，如果他们去以下任何一个：

```
http://www.example.net/some-article/
http://example.net/some-article/ 
```

然后我希望他们被重定向到适当的 URL：

```
http://www.example.com/some-article/
http://example.com/some-article/ 
```

您将如何使用 .htaccess 文件进行这个简单的 .net -> .com 重定向？任何规则都应适用于 .net 域下的所有 URL。

提前致谢。

* * *

**编辑：**我已经在服务器上有 .htaccess 文件：

```
# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>

# END WordPress

AddHandler php5-script .php 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-21T09:30:35.153

您需要将这样的命令添加到您的 .htaccess 文件中：

重定向永久/some-article/ [http://www.example.com/some-article/](http://www.example.com/some-article/)

这是带有 mod_rewrite 的服务器吗？在这种情况下，您可以对所有路径进行通用重定向：

```
RewriteEngine On

RewriteRule ^(.*)$ http://www.example.com/$1 [R=301] 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-23T13:56:37.617

我会将您现有的重写块修改为如下所示：

```
# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /

# New code to redirect from example.net to example.com
# Permanent redirect for caching purposes, also include the query string
RewriteCond %{HTTP_HOST} ^example\.net
RewriteRule (.*) http://example.com/$1 [R=permanent,QSA,L]

# New code to redirect from www.example.net to www.example.com
RewriteCond %{HTTP_HOST} ^www\.example\.net
RewriteRule (.*) http://www.example.com/$1 [R=permanent,QSA,L]

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>

# END WordPress

AddHandler php5-script .php 
```

请注意，我还没有实际测试过这个......

`REMOTE_HOST`也可以代替`HTTP_HOST`. [mod_rewrite 文档](http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html#RewriteRule)建议使用，但如果浏览器只理解 HTTP/1.0 ，`HTTP_HOST`这将不起作用

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-23T13:43:52.187

不久前，我从 Drupal 转换为 WordPress，最后我花了很多时间试图让这些重定向正常工作。我最大的问题是弄清楚如何将 RewriteCond 与 RewriteRule 结合使用。这是我写的一篇文章的摘录：

```
 # Rewrite drupal urls to worpress
RewriteCond %{QUERY_STRING} ^q=node/(.+)$
RewriteRule ^(.*)$ http://blog.componentoriented.com/?p=%1 [R=301,L]

# Forward RSS feed
RewriteCond %{QUERY_STRING} ^q=rss.xml$
RewriteRule ^(.*)$ http://blog.componentoriented.com/?feed=rss2 [R=301,L]
RewriteCond %{QUERY_STRING} ^q=atom/feed$
RewriteRule ^(.*)$ http://blog.componentoriented.com/?feed=rss2 [R=301,L] 
```

密切关注入站点击和链接以查看是否有人使用您尚未翻译的旧形式的 URL 也非常有帮助。我有一个被编码为 PostNuke URL 的入站链接（来自两个博客平台之前！），这种技术使它非常容易修复。

这是我的文章的链接，顺便说一句：[使用 .htaccess 从 Drupal 重定向到 Wordpress](http://blog.componentoriented.com/?p=196)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-08-01T07:35:07.120

旧域：RewriteCond %{HTTP_HOST} !^abcd.com$ [NC]

新域：RewriteRule ^(.*)$ [http://abcdef.com/](http://abcdef.com/) $1 [R=301,L]

我敢打赌，如果你把它放在你的旧域中，只需将第二行更改为你的新域，使用你的新域，它就会起作用。

# url - 在 .htaccess 或 PHP 代码中管理 url 编写？

> ID：669036
> 
> 赞同：2
> 
> 时间：2009-03-21T09:31:17.037
> 
> 标签：url, .htaccess, url-rewriting

我正在研究如何在 LAMP 框架中进行 url 重写。我通过研究 wordpress 代码开始了我的研究。我查看了 wordpress 的 .htaccess 并看到了这个：

```
# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>

# END WordPress 
```

我很惊讶也很高兴！我很惊讶，因为我没有看到任何类似正则表达式的规则。我很高兴，因为我可以延迟学习 .htaccess 文件的工作方式（急于截止日期），使用上面的脚本并在 PHP 中解析 $_SERVER 变量以获取 url 数据。

所以我的问题是，在 .htaccess 文件中管理 url 重写的优点/缺点是什么？在 PHP 代码中管理 url 重写的优点/缺点是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-21T11:32:29.557

ModRewrite：当有几个不同的变化时使用。如果你有很多正则表达式，服务器会感觉到负载（我的经验是使用 30 个复杂的正则表达式）。此外，这会将您锁定在 Apache（或支持此功能的其他供应商）中。优点：实现起来非常简单。缺点：供应商锁定，灵活性较低。

PHP：在您可能更换供应商时使用（我有在 Apache 中完成开发并且实时系统运行 lighttpd 的实例）。如果您想提供自定义 URL 重写，也可以使用（我们将此与管理配置屏幕一起使用，以允许客户定义自己的 URL 重写规则）。优势：更高的灵活性和平台独立性。缺点：它可能会使用更多的系统资源。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-21T09:40:39.357

在 PHP 中这样做会导致更多 PHP 脚本/代码的加载、解析和执行。如果您这样做，请不要使用外部重定向访问正确的页面。请记住，PHP 脚本基本上每次被命中时都会被编译（尽管有操作码缓存）。

mod_rewrite 这样做会更有效率。它还将迫使您保持此类规则相当简单，因为 mod_rewrite 只能使用正则表达式（和其他一些东西），而在 PHP 中您可能会做任何事情（例如进行数据库查找以找到正确的页面等）。不好。

正则表达式并不难。通常这只是以下情况：

```
RewriteRule ^account/orders/(\w+)$ /account/orders.php?type=$1 [L] 
```

我 90% 以上的重写规则都是这样的。很基本的东西。

# language-agnostic - OO 设计的优势是语义还是封装？

> ID：669042
> 
> 赞同：19
> 
> 时间：2009-03-21T09:36:59.363
> 
> 标签：language-agnostic, oop, functional-programming, encapsulation, semantics

面向对象设计 (OOD) 结合了数据及其方法。据我所知，这实现了两件伟大的事情：它提供了封装（所以我不关心有什么数据，只关心我如何获得我想要的值）和语义（它将数据与名称联系起来，以及它的方法始终如一地使用数据）。

那么OOD的实力在哪里呢？相比之下，函数式编程将丰富性归因于动词而不是名词，因此封装和语义都是由方法而不是数据结构提供的。

我使用的系统处于功能范围的末端，并且一直渴望 OO 的语义和封装。但我可以看到，OO 的封装可能成为对象灵活扩展的障碍。所以目前，我可以将语义视为更大的力量。

还是封装是所有有价值代码的关键？

编辑：我的意思是这里提供的封装 OO 的类型。`changeColor(door,blue)`变成`door.changeColor(blue)`.

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-23T09:34:55.157

您似乎使用了“封装”的相当狭窄的定义。假设您将封装定义为“将数据与方法相结合”，我是否正确？</p>

如果我错了，请忽略这篇文章的其余部分。

封装不是一个松散的术语；事实上，它是由国际标准化组织定义的。ISO 的开放分布式处理参考模型 - 定义了以下五个概念：

实体：任何具体或抽象的感兴趣的事物。

对象：实体的模型。一个对象的特征在于它的行为，双重地，它的状态。

（对象的）行为：行为的集合，对何时可能发生具有一组约束。

接口：对象行为的抽象，由该对象的交互的子集以及它们何时可能发生的一组约束组成。

封装：对象中包含的信息只能通过对象支持的接口的交互来访问的属性。

我们可以进一步提出一个不言而喻的建议：由于某些信息可以通过这些接口访问，因此某些信息必须在对象中隐藏和无法访问。此类信息表现出的属性称为信息隐藏，Parnas 通过认为模块应该被设计为隐藏困难的决策和可能改变的决策来定义，参见一篇伟大的计算论文：

[http://www.cs.umd.edu/class/spring2003/cmsc838p/Design/criteria.pdf](http://www.cs.umd.edu/class/spring2003/cmsc838p/Design/criteria.pdf)

重要的是要注意，不仅数据是信息隐藏的：它是与对象相关联的一些行为的子集，这些行为很难或可能会改变。

在您的帖子中，您似乎在说 OO 和函数式编程中的封装之间的区别源于数据管理，但至少根据 ISO 和 Parnas，数据管理不是封装的关键。所以我不明白为什么函数式编程中的封装需要与 OO 中的封装有任何不同。

此外，您在帖子中提到函数式编程提供封装，“……通过方法而不是数据结构。” 我认为，这是规模上的差异，而不是绝对的差异。如果我使用“对象”这个词而不是“数据结构”（如果我误解了，请再次告诉我），那么您似乎发现了 OO 的对象封装和函数式编程的方法封装的意义。

然而，根据上面的 ISO 定义，对象是我希望建模的任何东西。因此类可以被封装在一个包中，只要这些类中的一些对包的接口有贡献（即包的公共类）并且一些是信息隐藏的（包中的私有类）。

出于同样的原因，方法被封装在一个类中——一些方法是公共的，一些是私有的。您甚至可以将其降低一个档次，并说 McCabian 顺序代码序列封装在方法中。每个都形成一个封装在封装区域内的节点图；所有这些图形成一个图栈。因此函数式编程可以很好地封装在函数/文件级别，但这与OO的方法/类图没有区别，与OO的类/包图本质上也没有区别。

另外，请注意 Parnas 在上面使用的词：change。信息隐藏涉及潜在事件，例如未来困难设计决策的变化。你问OO的优势在哪里；好吧，封装当然是面向对象的强项，但问题就变成了，“封装的强项在哪里？” 答案非常明确：变革管理。特别是，封装减少了最大的潜在变化负担。

“潜在耦合”的概念在这里很有用。

“耦合”本身被定义为“通过从一个模块到另一个模块的连接建立的关联强度的度量”，在另一篇计算的伟大论文中：

[http://www.research.ibm.com/journal/sj/382/stevens.pdf](http://www.research.ibm.com/journal/sj/382/stevens.pdf)

正如论文所说，用从未有过的改进的话，“最小化模块之间的连接还可以最小化更改和错误传播到系统其他部分的路径，从而消除灾难性的“涟漪”效应，其中一个部分的变化会导致另一个错误，需要在其他地方进行额外的更改，从而产生新的错误，等等。”</p>

然而，正如这里所定义的，有两个限制可以很容易地解除。首先，耦合不能衡量模块内的连接，这些模块内的连接会产生与模块间连接一样多的“涟漪”效应（论文确实定义了“内聚”来关联模块内元素，但这不是根据定义耦合的元素之间的连接（即，对标签或地址的引用）来定义的）。其次，任何计算机程序的耦合都是给定的，因为模块是相互连接的；在耦合的定义中几乎没有管理 Parnas 所说的潜在变化的范围。

在某种程度上，这两个问题都通过潜在耦合的概念得到解决：程序的所有元素之间可形成的最大可能连接数。例如，在 Java 中，包中的包私有（默认访问器）类不能在其上形成连接（即，没有外部类可以依赖它，尽管有反射），但包中的公共类可以对它有依赖。即使目前没有其他类依赖它，这个公共类也会促成潜在的耦合——当设计发生变化时，类可能会依赖它。

要查看封装的强度，请考虑负担原则。负担原则有两种形式。

强形式表明，转换实体集合的负担是转换实体数量的函数。弱形式表明转换实体集合的最大潜在负担是转换实体的最大潜在数量的函数。

创建或修改任何软件系统的负担是创建或修改的类数量的函数（这里我们使用“类”，假设一个 OO 系统，并且关注类/包级别的封装；我们同样可以有关注函数式编程的函数/文件级别）。（请注意，“负担”是现代软件开发通常是成本或时间，或两者兼而有之。）依赖于特定修改类的类比不依赖于修改类的类更有可能受到影响.

修改后的类可以施加的最大潜在负担是对依赖它的所有类的影响。

因此，减少对已修改类的依赖关系会降低其更新影响其他类的可能性，从而减少该类可能施加的最大潜在负担。（这只不过是对“结构化设计”论文的重新陈述。）

因此，减少系统中所有类之间的最大潜在依赖关系数会降低对特定类的影响将导致对其他类进行更新的可能性，从而减少所有更新的最大潜在负担。

封装通过减少所有类之间的最大潜在依赖数，因此减轻了负担原则的弱形式。这一切都包含在“封装理论”中，它试图用数学方法证明这样的断言，使用潜在的耦合作为构建程序的逻辑手段。

但是请注意，当您问“封装是所有有价值代码的关键吗？”时，请注意。答案肯定是：不。所有有价值的代码都没有单一的关键。在某些情况下，封装只是一种帮助提高代码质量的工具，因此它可能变得“值得”。</p>

您还写道，“……封装可能成为对象灵活扩展的障碍。” 是的，它肯定可以：它确实被设计为阻止扩展难以或可能更改的对象的设计决策。然而，这并不是一件坏事。另一种方法是让所有类都公开，并让程序表达其最大的潜在耦合；但随后负担原则的弱形式表明更新将变得越来越昂贵；这些是衡量扩展障碍的成本。

最后，您在封装和语义之间进行了有趣的比较，在您看来，OO 的语义是其更大的优势。我也不是语义学家（在优秀的拉姆齐先生在他的评论中提到它之前，我什至不知道存在这样一个词）但我认为你的意思是“语义”，在“意义或解释一个词的含义”，并且非常基本的是，具有 woof() 方法的类应该称为 Dog。

这种语义确实有很大的力量。

令我好奇的是，您将语义与封装相提并论并寻找赢家；我怀疑你会找到一个。

在我看来，有两种力量推动封装：语义和逻辑。

语义封装仅仅意味着基于节点（使用通用术语）封装的含义的封装。所以如果我告诉你我有两个包，一个叫做“动物”，一个叫做“矿物”，然后给你三个类 Dog、Cat 和 Goat 并询问这些类应该封装到哪些包中，那么，给定没有其他信息，您完全正确地声称系统的语义表明这三个类被封装在“动物”包中，而不是“矿物”包中。

然而，封装的另一个动机是逻辑，特别是上面提到的潜在耦合的研究。封装理论实际上提供了用于封装多个类以最小化潜在耦合的包数量的方程式。

对我来说，封装作为一个整体是这种语义和逻辑方法之间的权衡：如果这使程序在语义上更易于理解，我将允许我的程序的潜在耦合高于最小值；但是巨大而浪费的潜在耦合级别将警告我的程序需要重新构建，无论它在语义上多么明显。

（如果优秀的拉姆齐先生还在阅读，你或你的语义学家朋友能否给我一个更好的词来形容我在这里使用的“语义”阶段？最好使用更合适的术语。）

问候，埃德。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-21T09:44:32.560

封装和由此产生的抽象显然是 OO 的主要优势。“事物”表示可以对它们调用什么“动作”，因此名词比动词具有更高的语义重要性。

最终，如果没有某种程度的封装，很难设想以一致且可维护的形式设计一个复杂的系统。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-22T18:56:33.520

作为一个 Lisp 程序员，他的对象系统可以说没有提供这些，我说：以上都没有。

jwz：“伪 Smalltalk 对象模型失败，通用函数（适当地受无外部覆盖规则约束）获胜”。

我认为您和其他人在此处列出的理想属性（封装、模块化等）并不像您想象的那样在 OO 中固有。它们通常与 Java 风格的 OO 一起提供，但不仅仅是它的结果。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-21T11:19:17.653

**隔离复杂性**是 IMO 任何设计的主要目标：将功能封装在比功能本身*更易于使用*的接口后面。

OO 为此提供了各种机制 - 两个 oyu 提到：

**封装**允许设计一个独立于实际实现的自定义表面。（套用一句，“更简单意味着不同”）。

**语义**允许对表示问题域元素的实体进行建模，因此它们更容易理解。

* * *

任何达到一定规模的项目都会成为管理复杂性的练习。我敢打赌，多年来，编程已经超越了我们学会管理的复杂性的极限。

多年来我没有涉足函数式编程，但在我的理解中，最好用数学家对强大、优雅、和美丽这些词的含义来描述。在这种情况下，“美丽”和“优雅”试图描述对复杂系统的真实或相关结构的出色洞察力，从非常简单的角度看待它。它接受给定的复杂性，并尝试导航它。

根据我的理解，您提到的灵活性是根据您的需要更改 POV 的能力 - 但这与封装背道而驰：一个位置的无意义细节可能是另一个位置唯一相关的内容。

OO，OTOH，是还原论者的方法：我们通过提升到更高的水平来改变 POV。在“旧 OO”中，POV 有一个单一的层次结构，在这个模型中，接口是一种建模不同 POV 的方法。

如果我可以这样说，OO的力量更适合“普通人”。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-22T16:22:41.050

某种形式的**模块化**是任何可扩展设计的关键。人类的局限性使人们无法一次“摸索”太多信息，因此我们必须将问题细分为易于管理的、有凝聚力的块，既为**理解**大型项目提供基础，也为**细分工作分配**提供了一种方法在许多人中的一个大项目。

如何选择一个大项目最有效的“划分”/“分区”来实现上述目标？经验表明，OO 是这里的大赢家，我想很多人会同意 OO 擅长这一点的两个关键属性是：

*   **封装**：每个类都封装了一个“秘密”——一组特定于实现的假设——这些假设可能随着时间的推移而改变——并公开一个与这些假设无关的接口；将这种封装的抽象分层，可以构建一个健壮的设计，其中组件/实现可以在面对预期的变化时轻松交换。
*   **以名词为中心**：在大多数领域中，人类似乎首先通过考虑领域的名词/数据来分解领域模型，然后识别与每个名词相关的支持动词。

关于函数式编程 (FP) 与 OO，我曾[在博客](http://lorgonblog.spaces.live.com/blog/cns!701679AD17B6D310!511.entry)中对此进行过讨论，但简要地说，我认为 FP 更多的是关于实现技术，而 OO 更多的是关于程序结构和设计，因此两者是互补的，而 OO 在规模的“大”端和 FP 在“小”端更占主导地位。也就是说，在大型项目中，高层结构最好由 OO 类设计来描述，但许多模块级细节（实现，以及模块接口形状的细节）最好由 FP 塑造影响。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-01T02:20:17.310

*面向对象设计的强度与设计中发生的后期绑定*的数量成正比。这是面向对象的 Kay 概念，而不是 Nygaard 概念。[艾伦凯写道](http://www.purl.org/stefan_ram/pub/doc_kay_oop_en)：

> 对我来说，OOP 仅意味着消息传递、本地保留、保护和隐藏状态过程，以及所有事物的极端后期绑定。它可以在 Smalltalk 和 LISP 中完成。可能还有其他系统可以做到这一点，但我不知道它们。

许多文献都忽略了后期绑定，而支持 C++ 面向对象的思想。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-02T18:26:22.373

让我们退后一步，从更高的层面来看这个问题。任何语言功能的优点在于能够以更自然的方式就问题域简洁地表达问题/解决方案。

OOP 的机制很容易用带有结构和函数指针的普通 C 语言实现。你甚至可以通过这种方式获得一点 OOP 的感觉。然而，在这样的环境中，OOP 习语几乎不会出现。当对 OOP 有实际的语言支持时，范式的表达能力就会出现，语言实现想法的方式对“说”什么以及如何说有非常真实的影响。例如，查看在 lisp、python、ruby 等中使用闭包/lambdas 的代码差异。

因此，最终它不是关于组件和底层概念，而是它们如何组合和使用使 C++ 中的 OO 成为什么样子。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-03T19:11:50.633

封装与多态性结合。大多数 OOP 语言中的类实现一个或多个接口的能力对我的软件开发产生了最大的影响。这个特性允许我精确定义两个对象之间的交互。

不仅要定义交互，还要记录它，以便多年后我可以回到那段代码并清楚地看到发生了什么。

这个特性是我更喜欢使用 OOP 语言而不是函数式语言的主要原因。虽然非常强大，但我发现用函数式语言编写的软件在维护周期以数十年为单位时维护起来很痛苦。（AutoCAD 中的 AutoLisp 软件）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-06T03:58:25.733

恕我直言，OO 仅表示与其他对象交互的对象。封装只是意味着抽象一个概念。因此，您创建了一个 Socket 和 .Connect() 到某个东西。它是如何连接的，你并不关心（这基本上是我对封装的定义）。

而且，纯函数式编程可以使用对象进行通信。但这些对象需要是不可变的。因此，恕我直言，FP 可以轻松使用 OO 概念；命令式语言（例如 C）仍然可以使用 OO 的概念。例如，每个“类”的文件都有一个不应使用的私有部分。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-05T15:55:38.903

您的问题类似于您想通过分析砖块来获得房屋的好处。

能够提供语义上下文和封装只是面向对象中类的基本能力。（就像一块砖可以承受一定的力量并占据一定的空间。）

继续类比：为了最大限度地利用积木，只需将它们放在一起即可。这同样适用于类和对象。

有[很多设计模式](http://en.wikipedia.org/wiki/Design_pattern_(computer_science))可用于 OO 编程。它们中的大多数依赖于您提到的“封装”和“语义”能力。

其中一些模式甚至是您问题第三段的答案：

*   如果要扩展现有类的行为，可以创建派生类。
*   如果您想扩展或更改现有对象的行为，您可以考虑使用[装饰器模式](http://en.wikipedia.org/wiki/Decorator_pattern)。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-05-29T00:43:04.520

OO 的真正威力在于多态性而不是封装。封装在一定程度上是可以实现的，并且用在函数式语言中，但是如果用函数式语言实现，多态会很尴尬。

（阅读*四人组*的“设计模式”以了解 OO 的力量。）

@Phil，如果我理解正确，您提到的区别在于程序调用数据/方法的方式之间：在oo中，首先有一个对象/实例，然后通过对象调用对象的数据/方法; 在函数式中，直接调用方法。

但是，查看函数式程序的实现，我们看到数据和方法被包装（在文件中而不是在类中）。例如，一个 C 程序的头文件中声明了其他文件可以访问的函数，如果只能通过这些声明的函数访问，则该数据是私有数据。只要程序员足够细心，OO中的大部分封装都可以在函数式程序中实现。（甚至可以通过使用某些指针技巧来实现继承。）

# python - 为什么 GQL 查询不匹配？

> ID：669043
> 
> 赞同：1
> 
> 时间：2009-03-21T09:37:24.963
> 
> 标签：python, google-app-engine, google-cloud-datastore

我想要做的是构建一些包含 uri 页面的迷你 cms。

我的 urls.py 中的最后一条路由指向我的 views.py 中的一个函数，该函数在数据存储中检查是否存在具有与当前请求相同的 uri 的可用页面，如果有，则显示该页面。

我有一个模型：

```
class Page(db.Model): 
  title = db.StringProperty(required=True) 
  uri = db.TextProperty(required=True) 
  created = db.DateTimeProperty(auto_now_add=True) 
  modified = db.DateTimeProperty(auto_now=True) 
  content = db.TextProperty() 
```

在我看来：

```
def show(request): 
  page = db.GqlQuery('SELECT * FROM Page WHERE uri=:uri', uri=request.path).get() 
  if page is None: 
    return http.HttpResponseNotFound() 
  else: 
    return respond(request, 'pages_show', {'content': request.path}) 
```

我已经将一个带有“/work”的实体作为 uri 添加到数据存储区。

即使 request.path 恰好是“/work”，查询也不会返回匹配项。

感谢您给我的任何建议！

是的，我是一个 python 菜鸟，App Engine 非常适合最终学习这门语言。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-21T18:16:25.623

我找到了解决方案！

问题在于模型。

应用引擎数据存储不索引 TextProperty。从一开始就使用该类型是错误的，所以我将其更改为 StringProperty，它确实被索引，因此哪个数据存储允许我们在 WHERE 子句中使用。

工作模型示例：

```
 class Page(db.Model): 
      title = db.StringProperty(required=True) 
      // string property now
      uri = db.StringProperty(required=True) 
      created = db.DateTimeProperty(auto_now_add=True) 
      modified = db.DateTimeProperty(auto_now=True) 
      content = db.TextProperty() 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T09:59:51.477

如果使用命名关键字参数（“uri=:uri”），则必须将参数显式绑定到命名关键字。代替：

```
# incorrect named parameter
GqlQuery('SELECT * FROM Page WHERE uri=:uri', request.path).get() 
```

你要

```
# correct named parameter
GqlQuery('SELECT * FROM Page WHERE uri=:uri', uri=request.path).get() 
```

或者您可以只使用位置参数：

```
# correct positional parameter
GqlQuery('SELECT * FROM Page WHERE uri=:1', request.path).get() 
```

# asp.net - 实施访客计数器

> ID：669049
> 
> 赞同：5
> 
> 时间：2009-03-21T09:45:37.393
> 
> 标签：asp.net, count, popularity, visitor-pattern

我是一个新手，正在使用带有 C# 2005 的 ASP .Net 2.0 开发一个网站。我想添加一个工具来计算编号。我网站的访问者。我已经收集了使用 Global.asax 添加此功能的基本信息。我通过在 system.web 部分下添加“”行对 Web.config 进行了修改。

我正在使用一张桌子来记录访客人数。但我不知道如何完成任务。我的默认 Global.asax 文件带有不同的部分 Application_Start、Application_End、Application_Error、Session_Start 和 Session_End。我试图在 Application_Start 部分中提取计数器的当前值并将其存储在全局变量中。我将增加 Session_Start 中的计数器并将修改后的值写入 Application_End 中的表。

我曾尝试使用公共子例程/函数。但是我应该把这些子程序放在哪里呢？我试图在 Global.asax 本身中添加子例程。但是现在我遇到了错误，因为我无法在 Global.asax 中添加对 Data.SqlClient 的引用，并且我需要对 SqlConnection、SqlCommand、SqlDataReader 等的引用来实现这些功能。我必须为每个子例程添加类文件吗？请指导我。

我还想对我的网站实施跟踪功能，并存储我的网站访问者的 IP 地址、使用的浏览器、访问日期和时间、屏幕分辨率等。我该怎么做？

等待建议。

拉利特·库马尔·巴里克

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-21T15:16:26.570

对于简单的实现，您可以使用自定义 HttpModule。对于您的应用程序的每个请求，您将：

1.  检查 Request.Cookies 是否包含跟踪 Cookie
2.  如果跟踪 cookie 不存在，这可能是新访问者（或者，他们的 cookie 已过期 - 参见 4。）
3.  对于新访问者，记录访问者统计信息，然后更新访问者计数
4.  将跟踪 cookie 添加到发送回访问者的响应中。您需要将此 cookie 设置为具有相当长的有效期，这样您就不会在 cookie 已过期的返回用户中收到很多“误报”。

下面是一些骨架代码（另存为*StatsCounter.cs*）：

```
using System;
using System.Data;
using System.Web;
using System.Web.Security;
using System.Transactions;

namespace hitcounter
{
    public class StatsCounter : IHttpModule
    {
        // This is what we'll call our tracking cookie.
        // Alternatively, you could read this from your Web.config file:
        public const string TrackingCookieName = "__SITE__STATS";

        #region IHttpModule Members

        public void Dispose()
        { ;}

        public void Init(HttpApplication context)
        {
            context.BeginRequest += new EventHandler(context_BeginRequest);
            context.PreSendRequestHeaders += new EventHandler(context_PreSendRequestHeaders);
        }

        void context_PreSendRequestHeaders(object sender, EventArgs e)
        {
            HttpApplication app = sender as HttpApplication;
            HttpResponse response = app.Response;
            if (response.Cookies[TrackingCookieName] == null)
            {
                HttpCookie trackingCookie = new HttpCookie(TrackingCookieName);
                trackingCookie.Expires = DateTime.Now.AddYears(1);  // make this cookie last a while
                trackingCookie.HttpOnly = true;
                trackingCookie.Path = "/";
                trackingCookie.Values["VisitorCount"] = GetVisitorCount().ToString();
                trackingCookie.Values["LastVisit"] = DateTime.Now.ToString("dd/MM/yyyy hh:mm:ss");

                response.Cookies.Add(trackingCookie);
            }
        }

        private long GetVisitorCount()
        {
            // Lookup visitor count and cache it, for improved performance.
            // Return Count (we're returning 0 here since this is just a stub):
            return 0;
        }

        void context_BeginRequest(object sender, EventArgs e)
        {
            HttpApplication app = sender as HttpApplication;
            HttpRequest request = app.Request;

            // Check for tracking cookie:
            if (request.Cookies[TrackingCookieName] != null)
            {
                // Returning visitor...
            }
            else
            {
                // New visitor - record stats:
                string userAgent = request.ServerVariables["HTTP_USER_AGENT"];
                string ipAddress = request.ServerVariables["HTTP_REMOTE_IP"];
                string time = DateTime.Now.ToString("dd/MM/yyyy hh:mm:ss");
                // ...
                // Log visitor stats to database

                TransactionOptions opts = new TransactionOptions();
                opts.IsolationLevel = System.Transactions.IsolationLevel.Serializable;
                using (TransactionScope scope = new TransactionScope(TransactionScopeOption.Required, opts))
                {
                    // Update visitor count.
                    // Invalidate cached visitor count.
                }
            }
        }

        #endregion
    }
} 
```

通过将以下行添加到您的 Web.config 文件来注册此模块：

```
<?xml version="1.0"?>
<configuration>
    ...
    <system.web>
        ...
        <httpModules>
          <add name="StatsCounter" type="<ApplicationAssembly>.StatsCounter" />
        </httpModules>
    </system.web>
</configuration> 
```

（替换为您的 Web 应用程序项目的名称，或者如果您使用的是网站项目，则将其删除。

希望这足以让您开始尝试。正如其他人所指出的那样，对于一个实际的站点，最好使用谷歌（或其他一些）分析解决方案来解决这个问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-21T10:06:44.160

使用[谷歌分析](http://www.google.com/analytics/)。不要试图重新发明轮子，除非 a) 轮子没有做你想要的，或者 b) 你只是想弄清楚轮子是如何工作的

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T11:44:21.447

我只能支持 Gareth 的建议，即使用已经可用的流量分析。如果您不喜欢向 Google 提供有关您网站流量的数据，您还可以下载日志文件并使用众多可用的[网络服务器日志文件分析工具](http://en.wikipedia.org/wiki/List_of_web_analytics_software)之一对其进行分析。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-21T12:11:05.873

谷歌分析脚本正是你所需要的。因为会话，也会为爬虫打开。

# oracle11g - 如何安装 Enterprise Manager for Oracle 11g R1？

> ID：669051
> 
> 赞同：2
> 
> 时间：2009-03-21T09:47:38.997
> 
> 标签：oracle11g, windows-xp, oracle-enterprise-manager

我正在运行一台具有 22gb 可用空间、1.5ghz Intel Pentium M 和 768MB RAM 的 windows xp sp3 机器。每次我尝试安装 oracle 11g 时，除了运行 emca 脚本外，安装一切正常。

> 企业管理器因以下错误而失败 - 启动数据库控制时出错

由于 OracleDBConsoleorcl 无法启动

> 无法在本地计算机上启动 OracleDBConsoleorcl。错误 1053：服务未及时响应启动或控制请求。

事件日志显示

> OracleDBConsoleorcl 服务因服务特定错误 2(0x2) 而终止

我已经尝试了从编辑主机文件、设置静态 IP 到配置环回适配器的所有方法。这些似乎都不起作用。我做错了什么吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T18:56:59.883

我找到了一个解决方案：

1.  进行正常安装并忽略此消息，如果您看到它：

> 企业管理器因以下错误而失败 - 启动数据库控制时出错

2.  设置静态 IP，如果您使用的是笔记本电脑，最好在环回适配器上设置，并确保它在主机文件中列为第一个 IP O 建议使用来自[funkytoad](http://www.funkytoad.com/index.php?option=com_content&task=view&id=13)的 HostExpert。

3.  在命令提示符下运行以下命令（cmd 而不是运行/打开）

    ```
    set oracle_sid=orcl
    emca -repos recreate
    emca start dbconsole 
    ```

你应该很高兴。就我而言，企业管理器位于端口 1158 而不是 5500，因此您的里程可能会有所不同。

# django - 好的网络书应用程序堆栈？

> ID：669052
> 
> 赞同：1
> 
> 时间：2009-03-21T09:47:53.193
> 
> 标签：django, pdf

我想知道有没有像“The Django Book”这样的网络书创建开源解决方案？

它有一个真正可用的网络界面、评论系统（带有针对特定文本和平的评论）、pdf 每晚自动生成，所有内容都从 repo 中提取...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T10:34:14.453

[据报道，构成Drupal Core](http://drupal.org/features)一部分的[Book 模块](http://drupal.org/node/284)是协作书籍创作的一个很好的工具。

警告：虽然我使用 Drupal 创建了几个网站，但我自己并没有使用 Book 模块。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T20:16:32.010

我所知道的唯一基于 Django 的项目是[openbookplatform](http://code.google.com/p/openbookplatform/source/browse/)，但它是一个废弃的项目，甚至还没有针对 Django 1.x 进行更新。但是，这可能是一个很好的起点。

# c# - 在共享数据结构上同步

> ID：669056
> 
> 赞同：1
> 
> 时间：2009-03-21T09:52:53.087
> 
> 标签：c#, java, multithreading, concurrency

考虑涉及多个线程写入共享数据结构的代码。现在，这些线程中的每一个都将对象写入共享容器，这些对象本质上是唯一的。举一个（虚构的）例子：

```
class Logger
{
   IDictionary<string, Log> logDictionary = new Dictionary<string, Log>();

   // Method called by several other threads
   void AddLog(Log log)
   {
      logDictionary[log.ID] = log;
   }

   // Method called by a separate thread
   IList GetLog(/*some criteria*/)
   {
      // loop through logDictionary and
      // create an IList based on criteria
   }
} 
```

我清楚地了解，如果多个线程尝试更新相同的“变量”（或插槽）导致竞争条件，那么对共享对象的并发访问可能会成为问题。现在我的问题有 3 个部分。

(1) 如果线程进行盲更新，是否需要同步？（即使他们正在更新相同的插槽/变量）？

(2) 假设每个线程都在写一个唯一的对象，假设它是线程安全的，就不需要同步对共享字典/容器的访问吗？

(3) 另一个线程对 GetLog() 的调用是否真的会造成问题，即使字典正在被其他线程同时更新？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T09:58:27.113

最大的问题是是否有任何线程添加/删除了字典中的键。这可能会导致内部进行重大重建（很可能会破坏正在进行的任何竞争性读写），所以是的；您**确实**需要同步访问。如果所有线程都在对现有密钥进行读/写，您*可能*会没事，但我认为不能保证。

我不了解 java，但在 C#`ReaderWriterLockSlim`中可能（如果你绝对需要它）允许多个并发读取器*或*一个写入器（不是两者） - 但它通常更简单（有时甚至更快）只是去互斥（通过`lock`等）。

**编辑**

另外 - 对于强类型字典类型（即泛型等），具有过大的值类型，更新不会被互锁；另一个线程*理论上*可以看到这样一个值的正在进行的更新。例如，x86 上的 guid 等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-21T10:02:46.307

C# 中的容器类在编写时不是线程安全的，这意味着您必须确保只有一个线程同时访问容器类实例，即使每个线程写入字典中的不同键也是如此。

对于阅读，Dictionary 是线程安全的，即您可以同时从多个线程中读取字典。但是，同时读写是不安全的。

详情[在这里](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T10:00:12.680

1）“盲目更新”是什么意思？

2）不。假设 Dicitonary 是用哈希表实现的，您需要同步访问以处理哈希冲突，增加表的大小等。您可能能够避免锁定表中的单个元素，而不是在某些情况下，整个数据结构的共享锁，但这也有开销。

3）取决于更新是否是原子的。

# sql - 在哪种情况下，您更喜欢使用 mysql 而不是 sql server，反之亦然？

> ID：669059
> 
> 赞同：2
> 
> 时间：2009-03-21T09:57:10.050
> 
> 标签：sql, mysql, sql-server

在哪个实际场景中，您更喜欢其中一个？我知道有很多参数你可以比较，你能给我一些实际的例子吗？

示例：mysql 在多个数据库的表很少的情况下，sql server 用于单个数据库的很多表，因为......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-21T10:09:08.913

在实际情况下，除非您有一个庞大的系统，其中镜像、RAC 之类的东西都需要您的解决方案，否则这并没有什么区别。对于大多数应用程序来说，数据库平台是无关紧要的。如果它是相关的，那么硬件/功能变得更重要

一些想法：

*   公司的其他人是做什么的？如果您的 DBA 团队支持数百个 MS SQL Server，那么尝试 MySQL 毫无意义

*   客户端语言。我个人的观点是，一些客户端语言更适合他们的“自然”数据库平台，但这源于你是否在 MS、Java 或 PHP 商店

*   预算。如果您想在 4 小时内有一位 MS 顾问到现场，您必须为此付费。如果出现问题，每分钟对您的业务造成的损失是多少？

*   政治。我不同意我们的数据库工程如何设置公司 MS SQL 构建的某些方面，但我别无选择。如果你在学术界，你的开衫+拖鞋穿着烟斗的导师会讨厌微软。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T17:12:48.317

我使用的标准：

*   解决方案是否托管在 Linux 上？如果是这样，那么讨论将转向 MySQL 与 PostgreSQL。
*   DBA 员工的专业知识是什么？这有很大的不同。
*   将针对它进行什么类型的开发？如果主要是 .NET，那么这将有利于 SQL Server，因为关于如何在 SQL Server 中使用 .NET 代码而不是在 MySQL 中使用 .NET 代码的示例等等。
*   是否有您需要使用的特定功能？例如，SQL Server 2008 Enterprise 具有变更数据捕获、审计对象、DDL 和登录触发器，用于协助 ETL 和安全性，而这些特性是 MySQL 显然不具备的（目前）。

至于之前的一张海报，我在一定程度上同意预算，但对于 Sun/MySQL 对 MySQL 的支持，你也要付费。如果你想要一个 MySQL 顾问，同样，你需要为他们的时间和服务付费。两者都有非常活跃的社区，因此除非这是一个重大问题，否则您可能会找到很多帮助和好人来回答一般问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T19:39:57.653

尽管我更喜欢使用操作系统软件和在多个平台上运行的软件，但我不得不承认我更喜欢使用 MS SQL 而不是 MySQL。IMO，MS SQL 是 MS 中唯一的好东西（虽然它是购买的；）

MS SQL simple 在编写存储过程、用户定义的函数、子查询、派生表等方面具有更大的功能。每当我使用 My SQL 时，我最终都会感到非常受限制（我**确实**在文档中搜索了我常用查询的替代方案）

也就是说，如果您只是将您的 sql 服务器用作存储实体（不幸的是，许多开发人员都这样做），那么您使用 My SQL 和使用 MS SQL 一样好。

/乙

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-21T10:08:50.567

苹果与橙子。Mysql 不是一个有效的、符合 ACID 的数据库，因此，它实际上只有在您进行读取而不是写入时才可用。但是，我仍然更喜欢一个可靠的 ACID 兼容数据库，所以在使用 mysql 之前我会选择任何真正的数据库（如果你想使用免费的 db，postgresql 是 mysql 的一个很好的替代品）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-21T16:32:37.587

我先指出房间里的大象：mysql 是免费的。说真的，这是一个很大的优势。因此，如果我正在领导一家初创公司，我会给它一个大大的赞许。

除此之外，如果我有一家只有 Windows 的商店，我会更喜欢 SQL Server，因为它可以很好地与其他 MS 开发工具（如 Visual Studio、sharepoint 等）集成。

MySQL 可以在 *nix 上运行，因此在某些情况下 SQL 服务器会退出竞争。

除了这些明显的差异之外，两者都是成熟的数据库，很少会为了性能和/或其他技术优势而选择其中一个。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T17:57:56.710

最好的选择将是最适合您工具集的其余部分的选择。如果您是 .NET 商店，那么 SQL Server 将是最合适的。如果您部分或全部是 LAMP 或 WAMP 商店，那么 MySQL。如果您是其他人，那么您可能已经足够熟练地决定，但除此之外，您的工具的教程和其他文档中最常使用哪个数据库？

# c# - 在 WPF DataGrid 中绑定 DataGridColumn 的 Visible 属性

> ID：669060
> 
> 赞同：3
> 
> 时间：2009-03-21T09:57:15.977
> 
> 标签：c#, wpf, data-binding

我无法将 WPF datagridtextcolumn 的 Visible 属性绑定到布尔值。

我的绑定表达式是，

```
{Binding Path=DataContext.IsThisColumnVisible, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Window},Converter={StaticResource vc}} 
```

我检查了转换器是否工作（布尔到可见性枚举）并且在范围内。

如果我对列的标题使用相同的表达式，标题会按预期显示“假”。

Visible 是一个依赖属性，所以应该是可绑定的。

有人看到我做错了什么吗？或者有没有其他人能够绑定到可见属性。

问候，

马特

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-21T11:35:06.773

我解决了这个问题。

DataGridCOlumn 不是框架元素，因此 FindAncestor 调用失败（DataGridColumn 不是可视树的一部分）

必须将绑定表达式的源属性设置为静态资源，它工作正常。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T10:02:51.097

很难从你的代码中说出来。Visual Studio 的输出窗口（在调试下）中有什么？这通常会给你一个关于问题的线索。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-22T11:45:33.073

我一直在寻找同样的东西，并在[一篇关于将数据上下文转发到列的文章](http://blogs.msdn.com/b/jaimer/archive/2008/11/22/forwarding-the-datagrid-s-datacontext-to-its-columns.aspx)中找到了一种出色的方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-16T18:47:29.723

如果您可以从代码绑定，则可以使用

```
BindingOperations.SetBinding(DatagridColumInstance,
                             DatagridColum.VisibilityProperty,
                             myNewBindDef); 
```

# c# - 集合类型属性的设置器

> ID：669066
> 
> 赞同：4
> 
> 时间：2009-03-21T10:03:06.540
> 
> 标签：c#, oop, collections

集合类型属性是否需要设置器

```
//Type 1    
class Company
{
    private IList<Customer> customers;

    public IList<Customer> Customers
    {
        get { return customers; }
        set { customers = value; }
    }
}

 //Type 2 
 class Company
 {
       private readonly IList<Customer> customers = new List<Customer>();

       public IList<Customer> Customers
       {
               get { return customers; }
       }
  } 
```

我什么时候使用 Type 1 和 Type 2 ？如果我初始化一个 List 并使用只读属性 Customers 还不够吗？如在`Company.Customers.Add(new Customer)`

为集合类型属性提供设置器的最佳实践是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T10:26:22.087

请阅读 FxCop 建议 CAS2227“集合属性应为只读” [http://msdn.microsoft.com/en-us/library/ms182327(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms182327(VS.80).aspx)

它包含很好的建议:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T10:39:58.417

一般不会（而且我通常不会添加它们），但如果您想使用`XmlSerializer`. 这是一种痛苦。它还必须是具体类型（例如`List<T>`or `T[]`- not `IList<T>`）。幸运的是，`DataContractSerializer`没有遭受同样的命运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T10:10:29.393

我更喜欢

```
public IList<Customer> Customers { get; private set; } 
```

但这需要

```
this.Customers = new List<Customer>(); 
```

在`Company`构造函数中

# seo - 将 SEO 的 URL 从 example.com/dbtable_id/ 升级到 example.com/dbtable_id/article-title

> ID：669067
> 
> 赞同：0
> 
> 时间：2009-03-21T10:03:42.530
> 
> 标签：seo

我有一个现有的期刊网站，具有以下 url 结构

```
http://example.com/dbtable_id/
(eg. http://example.com/89348/) 
```

其中 89348 是期刊文章的主键 ID。

我想将文章的标题添加到 url 以用于 SEO 目的，例如

```
http://example.com/dbtable_id/article-title
(eg. http://example.com/89348/hello-world) 
```

我喜欢这种方法，因为我不需要更改 PHP 代码，因为它仍会按 dbtable_id 查找文章。我所要做的就是将 url 友好的标题附加到模板文件中的相关链接，然后再向 .htaccess 文件添加一条规则。

有什么我应该担心的吗？我是否遵循最佳实践？“dbtable_id”和“article-title”不匹配的可能性会影响SEO吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T10:35:17.057

有些人认为浅路径比深路径更好，但我对此并没有过多关注。带有错误 URL 的语义页面总是比带有“完美” URL 的无语义页面做得更好。

所以我说，去吧。只要它没有任何查询字符串参数，就应该没问题。

# c# - Canvas.GetTop() 返回 NaN

> ID：669071
> 
> 赞同：11
> 
> 时间：2009-03-21T10:09:03.703
> 
> 标签：c#, wpf

我有一个带有一些 UIElements 的画布。在我通过动画 top 和 left 属性将它们移动到画布上之后，偶尔对 Canvas.GetTop 的后续调用会导致 NaN。

我没有正确“关闭”动画吗？

这是我的动作

```
private void InternalMove(double durationMS, FrameworkElement fElement, Point point, EventHandler callback)
{
   _moveElement = fElement;
   _destination = point;

   Duration duration = new Duration(TimeSpan.FromMilliseconds(durationMS));

   DoubleAnimation moveLeftAnimation = new DoubleAnimation(Canvas.GetLeft(fElement), point.X, duration, FillBehavior.Stop);
   Storyboard.SetTargetProperty(moveLeftAnimation, new PropertyPath("(Canvas.Left)"));

   DoubleAnimation moveTopAnimation = new DoubleAnimation(Canvas.GetTop(fElement), point.Y, duration, FillBehavior.Stop);
   Storyboard.SetTargetProperty(moveTopAnimation, new PropertyPath("(Canvas.Top)"));

   // Create a storyboard to contain the animation.
   _moveStoryboard = new Storyboard();
   if (callback != null) _moveStoryboard.Completed += callback;

   _moveStoryboard.Completed += new EventHandler(s1_Completed);
   _moveStoryboard.Children.Add(moveLeftAnimation);
   _moveStoryboard.Children.Add(moveTopAnimation);
   _moveStoryboard.FillBehavior = FillBehavior.Stop;
   _moveStoryboard.Begin(fElement);
}

private void s1_Completed(object sender, EventArgs e)
{
    if (_moveStoryboard != null)
    {
       _moveStoryboard.BeginAnimation(Canvas.LeftProperty, null, HandoffBehavior.Compose);
       _moveStoryboard.BeginAnimation(Canvas.TopProperty, null, HandoffBehavior.Compose);
    }

    Canvas.SetLeft(_moveElement, _destination.X);
    Canvas.SetTop(_moveElement, _destination.Y);
} 
```

谢谢

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-08-25T12:32:38.910

如果没有明确设置该值，则似乎普遍的共识是`Canvas.GetTop(x)`返回“Nan”（即使我明确设置了它，我有时仍然会得到该结果）。

我现在使用的另一种方法是

```
Vector offset = VisualTreeHelper.GetOffset(fElement); 
```

它返回 fElement 在其容器中的位置。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-23T12:03:29.993

我遇到了类似的情况（NaN），但在不同的上下文中。我记得，它与元素在容器中的定位方式有关。

抱歉，我无法提供更多帮助，但也许这会提供一些指导。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-04-25T12:36:12.217

在属性布局中检查您的 xaml 文件，确保左侧或顶部的值仅显示数字但不混合（自动）。示例：Top 123(auto)，这导致 Canvas.GetTop 将返回 NaN。

# delphi - Delphi中GetLastError和FormatMessage的正确用法是什么？

> ID：669073
> 
> 赞同：29
> 
> 时间：2009-03-21T10:10:03.403
> 
> 标签：delphi, winapi, error-handling

我在 Delphi 2006（也是 Delphi 7）中使用第三方组件时遇到问题，在执行对该组件的函数调用时出现“未指定错误”。您是否有在 Delphi 中使用 GetLastError 和 FormatMessage 的示例代码，可以让我访问有关错误的更多信息？蒂亚:)

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-03-21T10:31:35.990

Delphi 中有一个集成的辅助函数：`SysErrorMessage`. 它本质上是一个包装器`FormatMessage`，但在您的情况下使用起来要简单得多。只需提供您需要文本描述的错误代码。

例如，您可以使用它来显示最后一个错误：

```
ShowMessage(SysErrorMessage(GetLastError)) 
```

如果您想使用此消息引发异常，则更简单：

```
RaiseLastOSError; 
```

**重要提示**：确保在失败的函数和您的调用之间没有额外的 API 调用`GetLastError`，否则最后的错误将被重置。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-07-13T07:30:28.877

虽然 DR 是正确的，但这种方法存在一个问题：它不允许您指定发生错误的上下文。见过错误“API 函数失败”。不知道它是哪个功能以及它发生在哪里？

这就是我编写 RaiseLastOsErrorEx 和 Win32CheckEx 函数的原因：

```
procedure RaiseLastOsErrorEx(const _Format: string);
begin
  RaiseLastOsErrorEx(GetLastError, _Format);
end;

procedure RaiseLastOsErrorEx(_ErrorCode: integer; _Format: string); overload;
var
  Error: EOSError;
begin
  if _ErrorCode <> ERROR_SUCCESS then
    Error := EOSError.CreateFmt(_Format, [_ErrorCode, SysErrorMessage(_ErrorCode)])
  else
    Error := EOsError.CreateFmt(_Format, [_ErrorCode, _('unknown OS error')]);
  Error.ErrorCode := _ErrorCode;
  raise Error;
end;

function GetLastOsError(out _Error: string; const _Format: string = ''): DWORD;
begin
  Result := GetLastOsError(GetLastError, _Error, _Format);
end;

function GetLastOsError(_ErrCode: integer; out _Error: string; const _Format: string = ''): DWORD;
var
  s: string;
begin
  Result := _ErrCode;
  if Result <> ERROR_SUCCESS then
    s := SysErrorMessage(Result)
  else
    s := _('unknown OS error');
  if _Format <> '' then
    try
      _Error := Format(_Format, [Result, s])
    except
      _Error := s;
    end else
    _Error := s;
end;

function Win32CheckEx(_RetVal: BOOL; out _ErrorCode: DWORD; out _Error: string;
  const _Format: string = ''): BOOL;
begin
  Result := _RetVal;
  if not Result then
    _ErrorCode := GetLastOsError(_Error, _Format);
end; 
```

（它们是我的 dzLib 库的单元 u_dzMiscUtils 的一部分，可在此处获得： [https ://osdn.net/projects/dzlib-tools/svn/view/dzlib/trunk/src/u_dzMiscUtils.pas?view=markup&root=dzlib-tools# l313](https://osdn.net/projects/dzlib-tools/svn/view/dzlib/trunk/src/u_dzMiscUtils.pas?view=markup&root=dzlib-tools#l313)

# crystal-reports - 水晶报表

> ID：669079
> 
> 赞同：0
> 
> 时间：2009-03-21T10:14:30.007
> 
> 标签：crystal-reports

我的问题是我必须通过 Outlook 将水晶报告邮寄给不同的供应商。我已经有了如何通过 Outlook 邮寄的解决方案，但我现在面临的问题是我必须附加报告，并且报告应该显示数据库中特定行的详细信息。我尝试使用 .rpt 文件并将其附加，但由于 .rpt 是保存的数据，因此相同的数据会发送给所有供应商，而不是不同的报价。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T12:07:32.653

“rpt”文件本身只是报告的定义。它不包含数据。您必须运行报告并将其导出为某种文件格式，例如 PDF。您可以将该 PDF 文件附加到您的电子邮件中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-22T19:59:07.380

就像 splattne 所说...您将为供应商使用报告参数。[在调用ReportDocument.ExportToDisk()](http://devlibrary.businessobjects.com/BusinessObjectsXI/en/en/CrystalReports_dotNET_SDK/crystalreports_net_doc/doc/crsdk_net_doc/html/crlrfreportdocumentclassexporttodiskmethodtopic.htm)之前设置参数值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-02-09T03:41:38.537

有不同的选择可以做你想做的事。最受欢迎的是爆款。您将创建一个报告，其中包含所有供应商的信息并按供应商分组数据。然后使用软件解析此报告并将其保存到每个供应商的单独文件中，这些文件将通过电子邮件发送到供应商的电子邮件地址（也是报告的一部分）。

如果您有 BOE，您可以使用突发发布，否则您可以查看此网站以获取支持突发的 3rd 方解决方案：http: [//kenhamady.com/cru/comparisons/desktop-scheduling-engines](http://kenhamady.com/cru/comparisons/desktop-scheduling-engines)

大多数解决方案都是付费的，但通常都可以负担得起。有一些像这样的免费选项：

[http://www.r-tag.com/Pages/CommunityEdition.aspx](http://www.r-tag.com/Pages/CommunityEdition.aspx)

# php - 数据对象太大

> ID：669081
> 
> 赞同：1
> 
> 时间：2009-03-21T10:16:09.350
> 
> 标签：php, refactoring

最近，我在我正在工作的一个项目中发现了非常强烈的代码气味。

特别是在其成本计算功能中。要计算某些操作的总成本，我们必须将多种信息传递给“解析器类”。

例如：

*   电话号码
*   选定的广告系列
*   选定的模板
*   选定的联系人
*   选定的组
*   以及大约2-4种信息类型更多

在重构之前，所有这些参数都通过构造函数传递给 Counter 类（8 个参数，你可以想象一下……）。

为了提高可读性，我引入了一个名为 CostCountingData 的 Data 类，其中所有这些属性都具有可读的 getter 和 setter。

但我不认为，在这次重构之后，该代码变得更具可读性：

```
$cost_data = new CostCountingData();
$cost_data->setNumbers($numbers);
$cost_data->setContacts($contacts);
$cost_data->setGroups($groups);
$cost_data->setCampaigns($campaigns);
$cost_data->setUser($user);
$cost_data->setText($text);
$cost_data->setTotalQuantity($total_quantity);

$CostCounter = new TemplateReccurentSendingCostCounter($cost_data);  
$total_cost = $CostCounter->count(); 
```

你能告诉我这段代码片段的可读性是否有问题吗？也许您可以看到任何代码异味并可以指出它们..

我对如何重构此代码的唯一想法是将这个大数据对象拆分为几个，由相关的数据类型组成。但我不确定我是否应该这样做..

你怎么想？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T10:40:35.500

如果您想要的是命名参数（在我看来这是您想要实现的），您是否会考虑只传入一个关联数组，并将名称作为键？还有命名参数成语，[虽然我只能为 C++ 找到一个很好的参考](http://www.parashift.com/c++-faq-lite/ctors.html#faq-10.18)，也许它被 PHP 程序员称为别的东西。

为此，您将更改 CostCountingData 上的方法，以便它们都返回原始对象。这样你就可以将你的最上面的代码重写为：

```
$cost_data = new CostCountingData();
$cost_data
 ->setNumbers($numbers)
 ->setContacts($contacts)
 ->setGroups($groups)
 ->setCampaigns($campaigns)
 ->setUser($user)
 ->setText($text)
 ->setTotalQuantity($total_quantity); 
```

所以有两种选择。我可能会自己使用命名参数习语，因为它是自我记录的，但我认为差异不会太大。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T11:13:48.320

如果我需要数据对象（并且称为“数据”的类本身就是一种气味），我会在其构造函数中设置它的值。但有趣的问题是这些值从何而来？值的来源本身应该是某种对象，并且可能是您真正感兴趣的对象。

**编辑：**如果数据来自 POST，那么我会让类包装 POST 数据。我不会提供任何 setter 函数，并且会让读取访问器看起来像这样（我的 PHP 有点生疏）：

```
class CostStuff {

   constructor CostStuff( $postdata ) {
       $mypost = $postdata;
   }

   function User() {
      return $mypost[ "user_name" ];
   }

   ...

} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T13:53:21.760

这里有几种可能性：

*   如果您每次只需要几个参数，则此答案中其他地方建议的[命名参数方法是一个不错的解决方案。](https://stackoverflow.com/questions/669081/too-big-data-objects/669104#669104)

*   如果您总是需要所有参数，我建议气味来自**计算成本所需数据的损坏语义模型**。

无论您如何修饰对带有八个参数的方法的调用，需要八条所谓不相关的信息来计算某些东西的事实总是很臭。

退后一步：

*   八个独立的论点*真的*都是无关的吗，或者你能不能更好地组合反映现实情况的中间对象？产品？发票项目？还有什么？

*   成本方法是否可以拆分为更小的方法，根据更少的参数计算部分成本，以及将组件成本相加产生的总成本？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T12:37:01.163

您认为您的代码片段有什么问题？如果您有几个已经使用过的变量现在需要进入 $cost_data，那么您需要依次设置每个变量。没有办法解决这个问题。

不过，有一个问题是，为什么您现在决定需要将这些变量 $numbers、$contracts 等移入 $cost_data ？

您正在寻找的重构是否可能是您设置 $numbers 的代码点实际上应该是您设置 $cost_data->numbers 的点，并且完全拥有 $numbers 变量是多余的？

例如

```
$numbers=getNumbersFromSomewhere() ; 
// do stuff
$contracts=getContracstFromSomewhere() ;
// do stuff 
$cost_data=new dataObject() ; 
$cost_data->setNumbers($numbers);
$cost_data->setContracts($contracts) ; 
$cost_data->someOperation() ; 
```

变成

```
$cost_data=new dataObject() ; 

$cost_data->setNumbers(getNumbersFromSomewhere()) ; 
// do stuff
$cost_data->setContracts(getContractsFromSomewhere()) ; 
// do stuff
$cost_data->someOperation() ; 
```

# java - Java 类混淆

> ID：669082
> 
> 赞同：0
> 
> 时间：2009-03-21T10:17:09.893
> 
> 标签：java, oop, class

在 Java 教程和学习材料中，“class”这个词的使用非常松散。这个词有许多不同的含义。请一些人列举并解释这个词的所有含义。例如：'class' 表示对象，'class' 是文件扩展名，'class' 是声明对象时使用的第一个词，等等。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-21T11:17:04.787

> 这个词有许多不同的含义。

不，只有一个含义：

*   类是对象实例的蓝图
*   您可以使用“类”关键字在 Java 源代码中定义这样的蓝图
*   编译器会将您的源代码转换为字节码文件——源代码中每个类的扩展名为 .class 的文件

“类”这个词出现在不同的地方，但它们都与相同的基本含义有关。或者您是否也对“魔兽世界”是您在商店购买的游戏、桌面上的快捷方式以及硬盘上的文件夹名称这一事实感到困惑？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T10:22:21.317

类是一个面向对象的术语。类是一组对象的描述，它们的共同行为和状态。类可以从超类继承状态和行为。换句话说：

人是一类。人类有状态：

*   眼睛的颜色;
*   肤色;
*   头发的类型和颜色；
*   高度;
*   重量;
*   等等。

和行为：

*   走;
*   跑;
*   游泳;
*   吃;
*   喝;
*   等等

在此示例中，人类有两个子类：男人和女人。它们具有人类的所有状态和行为，但也有一些独特的状态和行为，例如明显的解剖学差异作为状态和行为，例如，女性可以生孩子。

对象是 slass 的一个实例。换句话说：Megan Fox 是 Woman 类的一个实例。作为一个女人，她也是超类人类的一个实例。

至于Java，它为编译源代码时遇到的每个类生成一个.class 文件。源文件可以包含多个类文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-21T12:18:39.553

有一个关键字“class”用于在 Java 中定义一个类。有一个“类”类，它是所有类的父类。还有一个“.class”，它是一个文件扩展名。

您应该能够根据上下文确定哪个是哪个。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-21T10:24:11.030

*   **类**描述了创建对象的蓝图或原型。
*   **对象**是该类的单个实例或单元

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-21T10:43:36.427

一个文件可以有多个类，但只有一个是公共的。公共类必须与文件同名，例如公共类 Car - 必须是 Car.java。

您应该以大写字母开头命名类，以小写字母开头命名对象。一个类包含一组变量，这些变量告诉您​​该类中对象的状态。一个类包含一组方法，这些方法告诉您对象的行为。

一个类就像一个或多个相似对象的描述。对象是该类的一个实例。您可以拥有具有变量速度、颜色、名称的 Class Car。然后，您可以制作例如 2 件标致和保时捷。两者都可以有不同的速度、颜色和名称。通过从 Car 类中制作一个对象，您可以制作任意数量的汽车。

# asp.net-mvc - 将视图文件作为资源嵌入到二进制文件中

> ID：669088
> 
> 赞同：7
> 
> 时间：2009-03-21T10:30:08.630
> 
> 标签：asp.net-mvc

我正在尝试创建一个带有少量控制器的 .Net 库，并且我想在多个 Web 项目中重用它们。

我已经完成了一半，但我遇到的问题是，每当我将库添加到新的 Web 项目时，我需要将所有相应的视图文件分别复制到新项目中。每当我更新库时，我都需要再次重复这些步骤。

有什么办法，我可以将视图文件作为资源嵌入到 dll 中，并将其作为嵌入式资源传递给“View()”函数。

**我想要实现的是，我想将控制器和相应的视图放在单个 dll 文件中，以便我可以轻松地将库作为单个 dll 文件分发/管理**

（我已经找到了一种方法，使用 IView 接口创建自定义视图类，并通过写入 HTML 输出编写器直接渲染输出，但我更喜欢使用视图文件。）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-27T15:09:47.417

Phil Haack几天前刚刚发布了[一篇博文，可能会对您有所帮助；](http://haacked.com/archive/2009/04/22/scripted-db-views.aspx)他正在使用数据库来存储视图并使用 ruby​​ 来处理它们，但我认为您可以采用他的原型并使其适用于存储在单独程序集中的视图相当容易。

快速浏览一下代码，我认为神奇的方法是实现 VirtualPathProviderViewEngine（例如参见“RubyViewEngine”类）并将您的 ViewEngine 插入 ViewEngines.Engines 集合（参见 Global.asax.cs）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T23:13:41.730

您可能可以为此使用[VirtualPathProvider 。](http://msdn.microsoft.com/en-us/library/system.web.hosting.virtualpathprovider.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-23T13:36:11.020

WebFormView 类型最终调用 BuildManager.CreateInstanceFromVirtualPath。BuildManager 中没有重载或其他函数来从流而不是从虚拟路径中获取输入。因此，如果您不想自己实现 IView，则需要将文件实际解压缩到磁盘，以便 BuildManager 可以编译它们。您仍然可以将 DLL 作为单个文件分发，但需要生成 aspx 文件以便 BuildManager 编译它们。有关详细信息，请参阅[BuildManager 帮助](http://msdn.microsoft.com/en-us/library/system.web.compilation.buildmanager_members.aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T17:04:27.630

[在 CodePlex http://vbmvc.codeplex.com](http://vbmvc.codeplex.com)上使用 VB.NET XML Literals 项目查看 ASP.NET MVC 视图引擎

它是最初由 Dmitry Robsman 构思的自定义视图引擎，他是 Microsoft 的 ASP.NET 的 PUM。每个视图都是一个 VB.NET 类，命名空间（而不是文件路径）用于将视图连接到控制器。将 ASPX 视图文件的内容复制到这些 VB 类中的 XML 文本中是相当直接的。作为类，它们无需任何额外的努力就可以编译到程序集中。

如果您的控制器是 C#，那么您很可能最终会得到 2 个 DLL，但 Scott Hanselman 有一篇关于让 C# 和 VB 在同一个程序集中一起存在的博客文章。[http://www.hanselman.com/blog/MixingLanguagesInASingleAssemblyInVisualStudioSeamlessWithILMergeAndMSBuild.aspx](http://www.hanselman.com/blog/MixingLanguagesInASingleAssemblyInVisualStudioSeamlesslyWithILMergeAndMSBuild.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-01T00:40:18.487

看一眼 codeplex 并查看[托管可扩展性框架](http://mef.codeplex.com/)

一旦你在那里完成...

查看[Maarten Balliauw](http://blog.maartenballiauw.be/)对[ASP.NET MVC 和托管可扩展性框架 (MEF) 的评价](http://blog.maartenballiauw.be/post/2009/04/21/ASPNET-MVC-and-the-Managed-Extensibility-Framework-(MEF).aspx)

# sqlite - SQLite - 获取数据库中的行数

> ID：669092
> 
> 赞同：50
> 
> 时间：2009-03-21T10:34:39.040
> 
> 标签：sqlite

我想在我的表中使用`max(id)`. 当它返回时`NULL`——如果表中没有行——我想返回 0。当有行时我想返回`max(id) + 1`。

我的行从 0 开始编号并自动增加。

这是我的声明：

```
SELECT CASE WHEN MAX(id) != NULL THEN (MAX(id) + 1) ELSE 0 END FROM words 
```

但它总是返回我 0。我做错了什么？

* * *

## 回答 #1

> 赞同：253
> 
> 时间：2009-03-21T10:37:26.397

您可以查询实际的行数

```
从 tblName 中选择计数（*）
```

见[https://www.w3schools.com/sql/sql_count_avg_sum.asp](https://www.w3schools.com/sql/sql_count_avg_sum.asp)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-21T10:59:50.820

如果您想使用 MAX(id) 而不是计数，在阅读 Pax 的评论后，以下 SQL 将为您提供您想要的

```
SELECT COALESCE(MAX(id)+1, 0) FROM words 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-21T10:37:56.770

在 SQL 中，NULL = NULL 为 false，通常必须使用 IS NULL：

```
SELECT CASE WHEN MAX(id) IS NULL THEN 0 ELSE (MAX(id) + 1) END FROM words 
```

但是，如果你想要行数，你应该只使用，`count(id)`因为如果你的行是（0,1,3,5,9），你的解决方案会给出 10，它应该给出 5。

如果你能保证你的 id 总是从 0 到 N，max(id)+1*可能*会更快，具体取决于索引的实现（遍历平衡树的右侧可能会更快，而不是遍历整个树，计数。

但这是非常特定于实现的，我建议不要依赖它，尤其是因为它将您的性能锁定到特定的 DBMS。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-08-16T23:22:12.373

不确定我是否理解你的问题，但 max(id) 根本不会给你行数。例如，如果您只有一行 id = 13（假设您删除了前面的行），您将拥有 max(id) = 13 但行数为 1。正确（最快）的解决方案是使用数数（）。顺便说一句，如果您想知道为什么会有一颗星，那是因为您可以根据标准计算行数。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-02-23T17:34:01.870

如果我正确理解您的问题，我会遇到同样的问题，我想知道 SQLite 操作中每次插入性能后最后插入的 id。我尝试了以下语句：

```
select * from table_name order by id desc limit 1 
```

id 是 table_name 的第一列和主键，上面提到的语句显示了具有最大 id 的记录。

但前提是您从未删除任何行，因此 id 的数量等于行数。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-10-01T20:50:46.893

VolkerK 答案的扩展，为了使代码更具可读性，您可以使用 AS 来引用计数，示例如下：

`SELECT COUNT(*) AS c from profile`

这使得在某些框架中更容易阅读，例如，我正在使用 Exponent 的（React Native）Sqlite 集成，并且没有 AS 语句，代码非常难看。

# java - Java 事件绑定

> ID：669099
> 
> 赞同：1
> 
> 时间：2009-03-21T10:38:27.377
> 
> 标签：java, swing, event-handling

我是使用 java 开发 Windows 应用程序的新手。问题是“如何将事件绑定到自定义类方法？

据我所见，我可以注册侦听器类来摆动组件来处理事件。没关系，但我必须实现一个类，例如实现 ActionListener 接口来处理事件，然后实现 actionPerformed 方法。这意味着我必须处理的每个事件都有一个类？

我不能让一个类“监听”来自所有组件的事件，并让这个类中的每个方法都进行事件处理吗？”

一个例子：

```
class MyEventListener { //pseudo code [no constructors, etc]

    public void handleSubmitFormBtn(Event e) {

    }

    //other methods go here handling events from other swing components
} 
```

注意：我不确定方法签名，但我希望你明白这一点。

结论：处理从摆动组件触发的事件的一种方法..可能吗？为每个事件创建一个类是唯一的方法吗？我不能将事件处理路由到单个类的特定方法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-21T10:52:40.400

在摇摆中，您通常做的是使用匿名类来处理您的事件，如下所示：

```
 someControl.addActionListener(new ActionListener() {
      public void actionPerformed(ActionEvent e) {
          // handle the event
      }
  }); 
```

虽然基本上可以让一个类处理所有事件，并将其注册到所有处理程序，但如上所述，匿名类是处理事件的正确摇摆习惯。

您可以找到更多信息 @ [http://java.sun.com/docs/books/tutorial/uiswing/events/generalrules.html](http://java.sun.com/docs/books/tutorial/uiswing/events/generalrules.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T15:53:27.790

您有几个选择，每个都有其特定的优点/缺点。

**匿名内部类**

```
component.addActionListener(
    new ActionListener()
    {
        public void actionPerformed(final ActionEvent e)
        {
            outerClassesMethod();
        }
    }); 
```

**内部阶级**

```
class Foo
    implements ActionListener
{
    public void actionPerformed(final ActionEvent e)
    {
        outerClassMethod();
    }
} 
```

**外层**

```
public class Foo
    implements ActionListener
{
    private final OuterClass target;

    public Foo(final OuterClass t)
    {
        target = t;
    }

    public void actionPerformed(final ActionEvent e)
    {
        target.targetClassMethod();
    }
} 
```

**类实现监听器**

```
public class OuterClass
    implements ActionListener
{
    public void actionPerformed(final ActionEvent e)
    {
        method();
    }

    // somewhere else in the code
    {
         component.addActionListener(this);
    }
} 
```

每种方式都有好处和坏处。

匿名内部类不允许你做你要求的事情，它只能实现一个监听器。

其他三个都可以让你做你想做的事（例如，只需将 , WindowListener 添加到实现列表中）。您可能希望内部类或外部类实现侦听器的方式来做您想做的事。我建议这样做，因为监听器可能与您的程序高度耦合，并且您需要执行大量“if”语句来确定执行实际操作的控件（您使用 evt.getSource()找出正在执行哪个控件，然后将其与您的实例变量进行比较以查看它是哪个）。

但是，除非您使用内存受限的设备，例如 Android 手机，否则您可能不应该为所有侦听器执行一种方法，因为它很容易导致非常糟糕的代码。如果内存是一个问题，那就去吧，但如果不是，你最好做以下事情之一：

*   每个控件一个监听器类
*   所有控件的每个事件类型一个侦听器类
*   每个事件类型每个控件一个侦听器类

我更喜欢以下方式编码，我发现它是最灵活的：

```
public class Outer
    extends JFrame
{
    private final JButton buttonA;
    private final JButton buttonB;

    {
        buttonA = new JButton("A");
        buttonB = new JButton("B");
    }

    // do not put these in the constructor unless the Outer class is final
    public void init()
    {
        buttonA.addActionListener(new AListener());
        buttonB.addActionListener(new BListener());
    }

    private void aMethod()
    {
    }

    private void bMethod()
    {
    }

    public void AListener
        implements ActionListener
    {
        public void actionPerformed(final ActionEvent evt)
        {
            aMethod();
        }
    }

    public void BListener
        implements ActionListener
    {
        public void actionPerformed(final ActionEvent evt)
        {
            bMethod();
        }
    }
} 
```

我更喜欢这种方式，因为它强制将方法排除在侦听器之外，这意味着我只有一个地方可以查找代码（而不是分散在内部类中）。这也意味着可以重用 aMethod() 和 bMethod() - 如果代码位于不实用的侦听器中（这是可能的，但不值得努力）。

这样做也是一致的，我更喜欢一致性而不是大多数事情，除非有充分的理由不这样做。例如，在 Android 上，我不这样做，因为创建类很昂贵（我仍然只有侦听器调用方法，但类本身实现了侦听器并且我执行了一个 if 语句）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T10:52:14.207

您可以通过创建单个动作侦听器来执行此操作，然后根据输入源进行切换，例如：

```
public void actionPerformed(ActionEvent e) {
   if (e.getSource() == buttonA) {
       doSomethingForButtonA(e);
   } else if (e.getSource() == buttonB) {
       doSomethingForButtonB(e);
   }
} 
```

但由于各种原因，这不是推荐的方法。为什么为每个要接收的事件创建侦听器时会遇到问题？它是用于处理 UI 事件的 Java 模型，如果其他人使用您的代码或您曾经使用其他人的代码，这将是意料之中的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T11:09:59.330

您可以拥有一个具有许多事件的侦听器方法的类：

```
class EventHandler implements ActionListener, ..., MouseListener {
   // implementation
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T15:56:51.510

一个概念性的解决方案是实施观察者模式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-12-30T11:08:04.040

Melasse 框架允许将 UI 组件与模型粘合，无需创建类（甚至是匿名类），语法`Binder.bind(/* source, target, options */)`。

例如，仅当文本字段中存在某些文本时才需要启用操作/按钮的新类：[https ://github.com/cchantep/melasse/blob/master/README.md#bind-buttonaction-to-provided -值](https://github.com/cchantep/melasse/blob/master/README.md#bind-buttonaction-to-provided-value)。与显示/隐藏信息或错误标签相同。

大多数 UI 组件都受支持，所有 Java Bean（具有属性更改支持）都受支持。

# c++ - C++“this”不匹配对象方法被调用

> ID：669105
> 
> 赞同：6
> 
> 时间：2009-03-21T10:41:08.587
> 
> 标签：c++, pointers, debugging

在 Microsoft Visual C++ 2003 下运行我的 C++ 程序时，我遇到了一个看起来非常烦人的错误，但这可能只是我做错了，所以我想我会把它扔在这里，看看是否有人有任何想法。

我有一个这样的类层次结构（完全一样 - 例如，真实代码中没有多重继承）：

```
class CWaitable
{
public:
    void WakeWaiters() const
    {
        CDifferentClass::Get()->DoStuff(this);  // Breakpoint here
    }
};

class CMotion : public CWaitable
{
   virtual void NotUsedInThisExampleButPertinentBecauseItsVirtual() { }
};

class CMotionWalk : public CMotion
{ ... };

void AnnoyingFunctionThatBreaks(CMotion* pMotion)
{
    pMotion->WakeWaiters();
} 
```

好的，所以我用“CMotionWalk”实例调用“AnnoyingFunctionThatBreaks”（例如，调试器说它是 0x06716fe0），一切看起来都很好。但是当我进入到调用“DoStuff”的断点时，“this”指针与我调用该方法的 pMotion 指针具有不同的值（例如，现在调试器说高一个字 - 0x06716fe4）。

换一种说法：pMotion 的值为 0x06716fe0，但是当我在其上调用方法时，该方法将“this”视为 0x06716fe4。

我不只是要疯了是吗？这很奇怪，对吧？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-21T12:27:29.173

我相信您只是看到了编译器构建 vtable 的方式的产物。我怀疑 CMotion 有它自己的虚函数，因此你最终会在派生对象中使用偏移量来到达基础对象。因此，不同的指针。

如果它正常工作（即，如果这不会产生崩溃，并且对象之外没有指针），那么我不会太担心它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-21T11:11:52.070

CMotion 类是否正在派生其他一些也包含虚函数的类？我发现 this 指针不会随着您发布的代码而改变，但是如果您有这样的层次结构，它会改变：

```
class Test
{
public:
    virtual void f()
    {

    }
};

class CWaitable 
{
public:
    void WakeWaiters() const
    {
        const CWaitable* p = this;
    }
};

class CMotion : public CWaitable, Test
{ };

class CMotionWalk : public CMotion
{
public:
 };

void AnnoyingFunctionThatBreaks(CMotion* pMotion)
{
    pMotion->WakeWaiters();
} 
```

我相信这是因为 CMotion 类的多重继承和 CMotion 中指向 Test::f() 的 vtable 指针

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-21T11:04:02.853

另请参阅[关于 thunking 的维基百科文章](http://en.wikipedia.org/wiki/Thunk#Thunks_in_object-oriented_programming)。如果您将调试器设置为单步执行汇编代码，您应该会看到它正在发生。（无论是 thunk 还是简单地更改偏移量取决于您从您提供的代码中省略的细节）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-21T21:34:19.000

我认为我可以解释这一点……在迈耶或萨特的书中的某处有更好的解释，但我不想搜索。我相信您所看到的是如何实现虚函数 (vtables) 以及 C++ 的“在使用之前无需付费”性质的结果。

如果没有使用虚拟方法，则指向对象的指针指向对象的数据。一旦引入了虚拟方法，编译器就会插入一个虚拟查找表（vtable），而指针则指向它。我可能遗漏了一些东西（而且我的大脑还没有工作），因为直到我在基类中插入一个数据成员之前我无法做到这一点。如果基类有一个数据成员并且第一个子类有一个虚拟，那么偏移量会因 vtable 的大小而不同（在我的编译器上为 4）。这是一个清楚地表明这一点的例子：

```
template <typename T>
void displayAddress(char const* meth, T const* ptr) {
    std::printf("%s - this = %08lx\n", static_cast<unsigned long>(ptr));
    std::printf("%s - typeid(T).name() %s\n", typeid(T).name());
    std::printf("%s - typeid(*ptr).name() %s\n", typeid(*ptr).name());
}

struct A {
    char byte;
    void f() { displayAddress("A::f", this); }
};
struct B: A {
    virtual void v() { displayAddress("B::v", this); }
    virtual void x() { displayAddress("B::x", this); }
};
struct C: B {
    virtual void v() { displayAddress("C::v", this); }
};

int main() {
   A aObj;
   B bObj;
   C cObj;

   std::printf("aObj:\n");
   aObj.f();

   std::printf("\nbObj:\n");
   bObj.f();
   bObj.v();
   bObj.x();

   std::printf("\ncObj:\n");
   cObj.f();
   cObj.v();
   cObj.x();

   return 0;
} 
```

在我的机器（MacBook Pro）上运行它会打印以下内容：

```
aObj:
A::f - this = bffff93f
A::f - typeid(T)::name() = 1A
A::f - typeid(*ptr)::name() = 1A

bObj:
A::f - this = bffff938
A::f - typeid(T)::name() = 1A
A::f - typeid(*ptr)::name() = 1A
B::v - this = bffff934
B::v - typeid(T)::name() = 1B
B::v - typeid(*ptr)::name() = 1B
B::x - this = bffff934
B::x - typeid(T)::name() = 1B
B::x - typeid(*ptr)::name() = 1B

cObj:
A::f - this = bffff930
A::f - typeid(T)::name() = 1A
A::f - typeid(*ptr)::name() = 1A
C::v - this = bffff92c
C::v - typeid(T)::name() = 1C
C::v - typeid(*ptr)::name() = 1C
B::x - this = bffff92c
B::x - typeid(T)::name() = 1B
B::x - typeid(*ptr)::name() = 1C 
```

有趣的是，在和或上调用方法之间，两者都表现出地址`bObj`变化。不同之处在于它包含一个虚方法。这允许编译器插入实现功能虚拟化所需的附加表。该程序显示的另一个有趣的事情是它在虚拟调用时有所不同。您还可以在插入虚拟表后立即看到大小增加。`cObj``A``B``C``B``typeid(T)``typeid(*ptr)``B::x``sizeof`

在您的情况下，一旦您创建了`CWaitable::WakeWaiters`虚拟表，就会插入 vtable，它实际上会注意对象的真实类型以及插入必要的簿记结构。这会导致对象底部的偏移量不同。我真的希望我能找到描述神话般的内存布局以及为什么对象的地址取决于它被解释为当继承与乐趣混合时的类型的参考。

**一般规则：（**你之前听说过）*基类总是有虚拟析构函数*。这将有助于消除这样的小惊喜。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T11:06:38.680

您需要发布一些实际代码。以下指针的值与预期的一样 - 即它们是相同的：

```
#include <iostream>
using namespace std;

struct A {
    char x[100];
    void pt() {
        cout << "In A::pt this = " << this << endl;
    }
};

struct B : public A { 
    char z[100];
};

void f( A * a ) {
    cout << "In f ptr = " << a << endl;
    a->pt();
}

int main() {
    B b;
    f( &b );
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T12:30:21.303

我无法解释为什么会这样，但是将 CWaitable::WakeWaiters 声明为虚拟可以解决问题

# .net - 最佳字符串容器：StringCollection、Collection ， 列表 ， 数组列表， ..？

> ID：669106
> 
> 赞同：31
> 
> 时间：2009-03-21T10:41:25.683
> 
> 标签：.net, list, collections, containers, ilist

什么是最合适的容器，仅用于保存在具有未确定上边界的某个数组中的字符串，该数组的长度在其创建时是未知的。

对于简单的代码，例如：

```
var list = new SomeContainer(); // size is unknown
for()/foreach()/do()/while() // any loop
{
  list.Add(string);
} 
```

它是`StringCollection`作为字符串的优化集合，还是只是`Collection<string>`or `List<string>`or `ArrayList`？他们之间有什么不同？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-03-21T10:51:13.430

对于您所需要的，`List<string>`可能是最通用的。`StringCollection`在 1.1 中很方便，当（没有泛型）您需要特定的类用于类型化集合时。`Collection<string>`如果您想对其进行子类化以提供验证等，这很方便。

无论哪种方式，在 3.5 中，LINQ 都会为它们提供许多额外的方法——但没有 LINQ，`List<T>`会有更多的特性（`Find`、、`Sort`等）

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-21T10:56:47.940

A`List<T>`将是最有效的。

该类`Collection<T>`只是另一种类型列表的包装器，无参数构造函数`Collection<T>`使用`List<T>`.

An`ArrayList`本质上与 a 相同，因此在从中读取时`List<object>`必须将项目转换为。`String`

A`StringCollection`只是一个类型安全的包装器`ArrayList`。

# java - 在 Java Web 应用程序中首先调用默认 servlet

> ID：669108
> 
> 赞同：2
> 
> 时间：2009-03-21T10:42:58.147
> 
> 标签：java, servlets

`SampleServlet`每当以这种方式访问​​我的 java web 应用程序时，我希望首先调用我：

`http://server:8080/appname/`

有什么方法可以实现吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-21T11:11:52.040

使用[Servlet 过滤器](http://docs.oracle.com/cd/B31017_01/web.1013/b28959/filters.htm)调用您的 Servlet。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-21T11:45:23.207

如果您想将 servlet 作为您的主页，那么这在[http://feelitlive.com/上对我有用](http://feelitlive.com/)

```
<welcome-file-list>
    <welcome-file>homepage</welcome-file>
</welcome-file-list>

...

<servlet>
    <description>Shows stuff on the homepage</description>
    <display-name>Homepage Servlet</display-name>
    <servlet-name>HomepageServlet</servlet-name>        
    <servlet-class>com.cantorva.gigcalendar.servlets.HomepageServlet</servlet-class>
</servlet>

...

<servlet-mapping>
    <servlet-name>HomepageServlet</servlet-name>
    <url-pattern>/homepage</url-pattern>
</servlet-mapping> 
```

这意味着通过您指定的 URL 到达您的应用程序的用户将受到您的 servlet 的欢迎。它还在“/homepage”处为主页创建一个别名，但您不必使用它。

如果您想在启动时运行一些代码，那么[asalamon74 的答案](https://stackoverflow.com/questions/669108/calling-a-default-servlet-first-in-java-web-application/669113#669113)看起来是正确的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-21T10:46:02.913

不确定您的意思，但您需要将您的 servlet 映射到“/”

```
<servlet-mapping>
    <servlet-name>SampleServlet</servlet-name>
    <url-pattern>/</url-pattern>
</servlet-mapping> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-21T10:50:33.307

不知道你的目标是什么，但是 Web 应用程序初始化可以通过 ServletContextListener 来实现：

```
public class AppListener implements ServletContextListener {
    public void contextInitialized(ServletContextEvent event) {
        // place your code here
    }

    public void contextDestroyed(ServletContextEvent event) {
    }
} 
```

后来在 web.xml 中：

```
<web-app>
<listener>
    <listener-class>
        package.AppListener
    </listener-class>
</listener>
...
</web-app> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T16:40:25.807

如果你想在启动时运行代码确实[asalamon74 的答案](https://stackoverflow.com/questions/669108/calling-a-default-servlet-first-in-java-web-application/669113#669113)应该没问题。如果您有遗留情况并且必须使用 servlet，则参数 load-on-startup 可以为您解决问题：

```
<servlet>
    <servlet-name>SampleServlet</servlet-name>
    <display-name>SampleServlet</display-name>
    <description>Sample Servlet</description>
    <servlet-class>...</servlet-class>
    <init-param>...</init-param>
    <load-on-startup>1</load-on-startup>
  </servlet> 
```

load-on-startup 标记指定 servlet 应在 Web 应用程序启动时自动加载；数值只是给那些在启动时加载的加载顺序。如果未指定任何值，则 servlet 将在容器决定需要加载时加载 - 通常在第一次访问时加载。

# c# - 校长搜索结果 , Lambda 表达式

> ID：669122
> 
> 赞同：1
> 
> 时间：2009-03-21T10:59:51.367
> 
> 标签：c#, lambda, ienumerable

我正在尝试`principalcollection`使用我认为所谓的 lambda 表达式从 a 中过滤掉实体。

我不能让它工作，我没有得到任何结果。 `user.GetGroups()`返回用户是成员的所有组，但`user.GetGroups().Where(....)`不返回任何内容。

假设 userprincipal user = Administrator
假设 MyFilterString = "Exchange"
假设 Administrator 是以下组的成员：

```
Exchange Domain Servers
Exchange Services
Administrators
Enterprise Admins 
```

域管理员架构管理员

```
 UserPrincipal user = new UserPrincipal(MyActiveDirectoryContext);
..
..
PrincipalSearchResult<Principal> memberOfGroups = user.GetGroups().Where(g => g.SamAccountName.Contains(MyFilterString) == true) as PrincipalSearchResult<Principal>; 

```

我期望 memberOfGroups 现在应该包含 2 个组：

```
Exchange Domain Servers
Exchange Services 
```

但它最终是空的，拉链为零，nada。非常感谢您的帮助。

西蒙·O·奥尔森

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T11:45:06.810

如果`.Where`是标准`Enumerable.Where`，那么它永远不会返回 a `PrincipalSearchResult`; 所以每次`as`都会回来。`null`考虑使用`.ToList()`：

```
var memberOfGroups = user.GetGroups()
      .Where(g => g.SamAccountName.Contains(MyFilterString)).ToList() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T11:31:14.113

我想你应该像这样使用**IndexOf()**而不是**Contains()**：

```
PrincipalSearchResult memberOfGroups = user.GetGroups().Where(g => >g.SamAccountName.IndexOf(MyFilterString) > -1) as PrincipalSearchResult; 
```

您可能想重新表述您的问题，使其更清晰！

# java - 小程序和 JDBC

> ID：669123
> 
> 赞同：0
> 
> 时间：2009-03-21T11:00:12.143
> 
> 标签：java, jdbc, applet

嗨，我是 Applets 的新手，我正在尝试设置一个连接到我的 mySQL 数据库的登录小程序。它在 Netbeans 中显示，但在我加载它时不显示...。有人可以看看并反馈任何建议吗？

PS我需要将我的文件放在Tomcat中吗？

```
/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

import java.awt.*;
import javax.swing.*;
import java.awt.event.*;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import javax.swing.JApplet;

public class Login extends JApplet{

    static int i=0;
    static String Logged="";
    static int ID=0;
    double total=0.0;
    double Firsttotal=0.0,x1=0.0,y1=0.0;
    double weight=50.00;
    static int level=1,count=0;
    Connection con = null;
    Statement st = null;
    Statement st2 = null;
    ResultSet rs = null;
    double score=0.0,score1=0.0,score2=0.0,score3=0.0;
    double Game1=0.0,Game2=0.0,Game3=0.0;

private static final String text = "<html> <center><b><font size=+3>Brain</font></b><b><font size=+3>Game</font></b></center> </html>";
DataB db=new DataB();

JPanel jPanel1 = new JPanel();
BorderLayout borderLayout1 = new BorderLayout();
JLabel jLabel1 = new JLabel();
JPanel jPanel2 = new JPanel();
GridBagLayout gridBagLayout1 = new GridBagLayout();
JLabel jLabel2 = new JLabel();
JLabel jLabel3 = new JLabel();
JTextField loginTextField = new JTextField(20);
JPasswordField passwordTextField = new JPasswordField(20);
JPanel jPanel3 = new JPanel();
JButton registerButton = new JButton();
JButton enterButton = new JButton();
FlowLayout flowLayout1 = new FlowLayout();
static String logged="";
boolean fInBrowser = true;

public void init() {
try {
jbInit();
}
catch(Exception e) {
e.printStackTrace();
}
}

private void authenticate(String l){

    if (!(logged.equals(""))) {
        System.out.println("login successfull");
        showTreeView();
    } else {
        JOptionPane.showMessageDialog(this,"Incorrect login or password","Error",JOptionPane.ERROR_MESSAGE);
        loginTextField.setText("");
        passwordTextField.setText("");
        loginTextField.requestFocusInWindow();
    } 
}

private void login(ActionEvent e) {
String login = loginTextField.getText();
String password = new String(passwordTextField.getPassword());
//validate login and password here. validity will be done by sending login/password to the server

if (login.equals("") || password.equals("")){       
    JOptionPane.showMessageDialog(this,"Either of the following have not been entered:\n\n-UserName\n-PassWord\n-UserName And PassWord\n\n *Please fill in all fields*","Error",JOptionPane.ERROR_MESSAGE);
}else{
logged=loginit(login,password);
authenticate(logged);
}
}

public String loginit(String login,String password){

        Connection con ;
        Statement st1 = null;
        ResultSet rs1 = null;

        String url = "jdbc:mysql://localhost:3306/braingame"; //where 3306 is the port, localhost is address of DB, and mysql is name of the database you wanna use...

        try{

        Class.forName("com.mysql.jdbc.Driver").newInstance();
        con = DriverManager.getConnection(url, "root", "admin");
        st1 = con.createStatement();
        if (login.equals("") && password.equals("")){
            Logged="";
        }else{
        rs1=st1.executeQuery("select user_id,level from players where name like '%"+ login +"%' and password like '%"+password+"%' ");

        if (rs1.next()) {
            ID=rs1.getInt("user_id"); 
            level=rs1.getInt("level");
            Logged="yes";
        }
        }

        if (con != null) con.close(); //same for st and rs...

        } 

        catch(Exception e){System.out.println(e.getMessage());}

        return Logged;

}

 public static void main (String[] args) {
    //
    int frame_width=450;
    int frame_height=300;

    // Create an instance of this applet an add to a frame.
    Login applet = new Login ();
    applet.fInBrowser = true;
    applet.init ();

    // Following anonymous class used to close window & exit program
    JFrame f = new JFrame ("Demo");
    f.setDefaultCloseOperation (JFrame.EXIT_ON_CLOSE);

    // Add applet to the frame
    f.getContentPane ().add ( applet);
    f.setSize (new Dimension (frame_width, frame_height));
    f.setVisible (true);
  } // main

private void jbInit() throws Exception {
jPanel1.setLayout(borderLayout1);
jLabel1.setHorizontalAlignment(SwingConstants.CENTER);
jLabel1.setText(text);
jPanel2.setLayout(gridBagLayout1);
jLabel2.setText("Password:");
jLabel3.setText("Login:");
registerButton.setText("Register");

passwordTextField.addActionListener(new java.awt.event.ActionListener() {
public void actionPerformed(ActionEvent e) {

    login(e);

}
});

loginTextField.addActionListener(new java.awt.event.ActionListener() {
public void actionPerformed(ActionEvent e) {
    login(e);

}
});

registerButton.addActionListener(new java.awt.event.ActionListener() {
public void actionPerformed(ActionEvent e) {
register(e);
}
});
enterButton.setText("Enter");

enterButton.addActionListener(new java.awt.event.ActionListener() {
public void actionPerformed(ActionEvent e) {
login(e);
}
});

jPanel3.setLayout(flowLayout1);
flowLayout1.setAlignment(FlowLayout.RIGHT);
this.getContentPane().add(jPanel1, BorderLayout.CENTER);
jPanel1.add(jLabel1, BorderLayout.NORTH);
jPanel1.add(jPanel2, BorderLayout.CENTER);
jPanel2.add(loginTextField, new GridBagConstraints(2, 1, 1, 1, 0.0, 0.0
,GridBagConstraints.CENTER, GridBagConstraints.NONE, new Insets(0, 11, 0, 0), 0, 0));
jPanel2.add(jLabel2, new GridBagConstraints(1, 2, 1, 1, 0.0, 0.0
,GridBagConstraints.CENTER, GridBagConstraints.BOTH, new Insets(11, 0, 0, 0), 0, 0));
jPanel2.add(passwordTextField, new GridBagConstraints(2, 2, 1, 1, 0.0, 0.0
,GridBagConstraints.CENTER, GridBagConstraints.NONE, new Insets(11, 11, 0, 0), 0, 0));
jPanel2.add(jLabel3, new GridBagConstraints(1, 1, 1, 1, 0.0, 0.0
,GridBagConstraints.CENTER, GridBagConstraints.BOTH, new Insets(0, 0, 0, 0), 0, 0));
jPanel1.add(jPanel3, BorderLayout.SOUTH);
jPanel3.add(enterButton, null);
jPanel3.add(registerButton, null);
}
} 
```

HTML 代码：

```
<HTML>
<HEAD>
   <TITLE>Applet HTML Page</TITLE>
</HEAD>
<BODY>

<H3><HR WIDTH="100%">Applet HTML Page<HR WIDTH="100%"></H3>

<P>
<APPLET codebase="classes" code="Login.class" width=850 height=500></APPLET>
</P>

<HR WIDTH="100%"><FONT SIZE=-1><I>Generated by NetBeans IDE</I></FONT>
</BODY>
</HTML> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T11:20:48.490

您必须签署您的 JAR(s) 才能访问数据库。[在这里](http://www.captain.at/programming/java/)查看快速教程：

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T11:46:02.907

您如何尝试“加载”？这就是这里出错的部分，此时小程序的源代码无关紧要。

由于小程序只允许连接到它们加载的服务器的安全限制，可能确实需要将小程序和包含它的 HTML 页面放在网络服务器中，以便它能够连接到数据库从。

另请注意，除了学习练习外，小程序不应直接连接到数据库，因为它本质上是不安全的。运行小程序的任何人都可以反编译它并获取数据库用户和密码（在您的情况下为“root”和“admin” - 哎呀，当您猜对了时为什么要反编译？）。到那时，您的数据库中的用户和密码变得无关紧要，他们可以做任何数据库用户可以做的事情：读取所有数据并至少以任意用户身份登录，并且可能还可以随意更改、添加和删除数据.

**编辑** “它显示小程序，但没有连接”是什么意思？将你的 .class 和 HTML 文件放在 Tomcat 的 webapp-root 中是正确的，而 .java 文件不是必需的。

从 HTML 代码来看，您可能需要做的就是删除 APPLET 标记的 codebase 属性 - 只有当 Java .class 文件位于名为“classes”的子目录中时才会正确。

此外，当您谈论“在字符串中分配”的内容时，这听起来很奇怪。JDBC URL 与 HTML 文件在 Tomcat 中的位置无关。

至于安全性：将连接到数据库的方法放在哪里并不重要：就浏览器而言，类都是小程序的一部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T12:17:56.140

@ Micheal：我从浏览器加载了 html 页面 JShow .html ......它显示了小程序，但没有连接......

我将文件放在名为 Braingame 的文件夹中，放入 Tomcat/Webapps/Root..这是我在字符串中分配的内容：

字符串 url = "jdbc:mysql://localhost:3306/braingame";

这包括 html 和类文件。

我还需要包含 java 文件吗？

关于安全性..我最初在另一个类中建立了连接，我只是从那个类中调用了一个方法……这仍然会被视为不安全吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T17:13:36.497

> 字符串 url = "jdbc:mysql://localhost:3306/braingame";

小程序在客户端浏览器中运行，因此它需要使用从客户端可见的 IP 地址或主机名连接到服务器 URL。在这种情况下，本地主机将是客户端本身。所以应该是

> “jdbc:mysql://www.yourappletdomain.com:3306/braingame”；

也需要为 3306 端口打开防火墙...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T11:42:13.870

作为仅供参考，由于必须在防火墙中打开端口等，创建通过 Internet 连接到数据库的小程序并不是一个好习惯。

# c# - ASP.NET中静态内部类的作用域

> ID：669124
> 
> 赞同：0
> 
> 时间：2009-03-21T11:02:25.807
> 
> 标签：c#, asp.net, class, static, scope

我不确定非静态类的一个静态内部类的范围。

在下面的行中，变量 DataContextCreator.Instance（单例模式的一部分）是否会指向所有 Page 对象/页面请求的相同 PDataContext 实例，还是每个对象都有自己的实例？

```
public class Page : System.Web.UI.Page
{

    private class DataContextCreator
    {
        static DataContextCreator() { }

        public static readonly PDataContext Instance = new PDataContext(TUtil.GetConnectionString());
    }

    public PDataContext DataContext
    {
        get
        {
            return DataContextCreator.Instance;
        }
    }
} 
```

我是否必须使用 HttpContext.Current 才能以所需的方式工作，即没有共享 DataContext？如果是这样，还有其他方法吗？

我不确定将静态类修改为私有（正如我所做的那样）是否有效。

谢谢！

编辑：这是我的解决方案，我现在具有相同的延迟加载功能但没有静态变量。在这种情况下，我认为我不需要在持有变量周围放置一个互斥锁。

```
 private PDataContext _DataContext;
    private PDataContext DataContext
    {
        get
        {
            if (this._DataContext == null)
            {
                this._DataContext = new PDataContext(TUtil.GetConnectionString());
            }
            return this._DataContext;
        }
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T11:14:29.117

每一页都是一样的。静态变量是静态变量，但它是嵌套的。（泛型使事情变得“有趣”，因为静态变量 in`Foo<int>`与 in 等是分开的`Foo<string>`，但这在这里不相关。）

如果你想让某些东西依赖于 的实例`Page`，它需要是`Page`. （顺便说一句，我建议不要将案例命名为与其基类相同。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T11:14:38.193

嵌套类纯粹是为了命名方便（以及一些修饰符更改（私有等））。在行为方面，它们实际上与常规（顶级）类相同。所以 `Instance`是完全共享的（它不绑定到 Page 实例）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T11:21:09.537

由于`Instance`变量是静态的，它只存在一次，所以所有线程共享相同的值。将变量放在另一个类中不会改变静态变量的工作方式。

要创建页面实例本地的单例，您可以将引用存储在页面上下文中：

```
public PDataContext DataContext {
   get {
      PDataContext result = HttpContext.Current["PData"];
      if (result == null) {
         result = new PDataContext(TUtil.GetConnectionString());
         HttpContext.Current["PData"] = result;
      }
      return result;
   }
} 
```

# asp.net - IIS 6.0 远程共享的访问权限

> ID：669129
> 
> 赞同：1
> 
> 时间：2009-03-21T11:07:02.737
> 
> 标签：asp.net, iis, file-permissions, virtual-directory

在 IIS 下使用远程共享的 UNC 路径设置虚拟目录时，我应该期望看到对共享的读取请求的用户身份是什么？

我已经设置了上述场景并将“连接为”下的用户配置为具有远程共享权限的已知用户，我使用 Windows 资源管理器进行了检查。

但是，当尝试使用[http://localhost/myfiles/atestfile.txt](http://localhost/myfiles/atestfile.txt)从共享上的 Web 浏览器中访问文件时，我收到 HTTP 错误 401.5 - Unauthorized: Authorization failed by an ISAPI/CGI application error 返回。'myfiles' 映射到远程共享，并且 atestfile.txt 驻留在共享文件夹中。

如果我使用 sysinternals filemon 应用程序查看正在执行对共享的读取请求的进程和用户，那么我会得到请求是通过 w3wp.exe 进程的详细信息，并且用户显示为“NT AUTHORITY\NETWORK ”。

我期望用户显示为我在“连接为”选项下配置的用户。

任何指导表示赞赏。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-21T11:49:04.977

如果我没记错的话（大约 4 年前使用 iis）它是 IUSR_。我不确定它是否仍然如此，但试一试。

**编辑**：试着看看这篇[文章](http://blogs.msdn.com/david.wang/archive/2005/06/29/IIS_User_Identity_to_Run_Code_Part_2.aspx)，也许你会找到一些线索；）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T11:57:13.193

您是否也尝试过使用“txt”以外的其他文件扩展名，也许是“test.html”？ISAPI 扩展配置（web -> 主目录 -> 配置...）中的 txt 使用什么 DLL？

MSDN 文章“[如何：在 IIS 5.0 和 6.0 中创建和配置虚拟](http://msdn.microsoft.com/en-us/library/zwk103ab.aspx)目录”中的“为虚拟目录配置安全性和身份验证”部分应包含查找正确配置所需的信息。

我想安全设置中使用的帐户应该能够访问网络共享。这可以通过将帐户插入正确的组或更改该帐户来完成。

# c# - 在 Windows Mobile 中调整图像大小

> ID：669137
> 
> 赞同：0
> 
> 时间：2009-03-21T11:12:52.597
> 
> 标签：c#, .net, windows-mobile, compact-framework

有没有人知道在 .net 2.0 **Compact** Framework 上调整图像大小的方法？

我希望能够从手机内存中获取用手机上的相机拍摄的图像，调整它们的大小，然后将它们上传到网络服务，这样我实际上不需要将调整大小的图像存储在磁盘上。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-19T13:21:40.440

这是我用来在 .NET CF 2.0 应用程序中调整图像大小的 C# 代码：

```
public static Image ResizePicture( Image image, Size maxSize )
{
  if( image == null )
    throw new ArgumentNullException( "image", "Null passed to ResizePictureToMaximum" );

  if( ( image.Width > maxSize.Width ) || ( image.Height > maxSize.Height ) )
  {
    Image resizedImage = new Bitmap( maxSize.Width, maxSize.Height );

    using( Graphics graphics = Graphics.FromImage( resizedImage ) )
    {
      graphics.Clear( Color.White );

      float widthRatio = maxSize.Width / image.Width;
      float heightRatio = maxSize.Height / image.Height;

      int width = maxSize.Width;
      int height = maxSize.Height;

      if( widthRatio > heightRatio )
      {
        width = ( int )Math.Ceiling( maxSize.Width * heightRatio );
      }
      else if( heightRatio > widthRatio )
      {
        height = ( int )Math.Ceiling( maxSize.Height * widthRatio );
      }

      graphics.DrawImage(
        image,
        new Rectangle( 0, 0, width, height ),
        new Rectangle( 0, 0, image.Width, image.Height ),
        GraphicsUnit.Pixel );
    }

    return resizedImage;
  }

  return image;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-23T07:29:44.037

Graphics.FromImage 应该适用于 jpg 图像，但是您可能会遇到内存问题。

看看这个[论坛帖子](http://www.eggheadcafe.com/forumarchives/netframeworkcompactframework/jul2005/post23568565.asp)以获得一些想法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-25T09:09:56.507

c# 代码中缺少强制转换

```
float widthRatio = (float) maxSize.Width / image.Width;

  float heightRatio = (float) maxSize.Height / image.Height; 
```

以及使图像居中：

```
graphics.DrawImage(image, new Rectangle((maxSize.Width - width) / 2, (maxSize.Height -height ) / 2, width, height), new Rectangle(0, 0, image.Width, image.Height), GraphicsUnit.Pixel); 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-19T09:27:22.800

这个 vb.net 适用于 Windows Mobile。唯一的限制：大型位图在打开时会导致 OutOfMemoryException：

```
 Private Function ResizedImage(ByVal image As Bitmap, ByVal maxW As Integer, ByVal maxH As Integer) As Bitmap
    Dim divideByH, divideByW As Double
    Dim width, height As Integer
    divideByW = image.Width / maxW
    divideByH = image.Height / maxH
    If divideByW > 1 Or divideByH > 1 Then
        If divideByW > divideByH Then
            width = CInt(CDbl(image.Width) / divideByW)
            height = CInt(CDbl(image.Height) / divideByW)
        Else
            width = CInt(CDbl(image.Width) / divideByH)
            height = CInt(CDbl(image.Height) / divideByH)
        End If
        Dim scaled As New Bitmap(width, height)
        Dim g As Graphics
        g = Graphics.FromImage(scaled)
        g.DrawImage(image, New Rectangle(0, 0, width, height), New Rectangle(0, 0, image.Width, image.Height), GraphicsUnit.Pixel)
        g.Dispose()
        ResizedImage = scaled
    Else
        ResizedImage = image
    End If

End Function 
```

# forms - Compact-Framework：最小化和恢复不起作用

> ID：669147
> 
> 赞同：0
> 
> 时间：2009-03-21T11:21:00.287
> 
> 标签：forms, compact-framework, c#-2.0, minimization

我在 Program.cs 中编写了一个包含以下内容的应用程序：

```
 rsCursor.Wait();

        // Load the settings
        rsAppConfig.LoadConfig("iVirtualDocket.exe.config");

        fSplash splash = new fSplash(IvdConfig.VERSION);
        splash.Initialise();

        DialogResult result = splash.ShowDialog();
        rsCursor.Go();

        if (result == DialogResult.Yes)
        {
            IvdInstances.Main.Initialise();
            Application.Run(IvdInstances.Main);
        } 
```

我在所有表单上都使用全屏，所以没有 X 按钮，但是我认为使用 Form.Close() 执行相同的功能？

我希望能够从我的主菜单 (Main) 中最小化我的应用程序，然后在用户重新运行应用程序时让它立即再次出现。目前，每次我重新运行应用程序时，我的应用程序都会执行加载屏幕。

我究竟做错了什么？

提前致谢。

**编辑：我需要能够检测我的应用程序何时运行，然后在主菜单运行时恢复主菜单，这样它就不会不断地将自身加载到内存中。**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T12:54:28.627

Form.Close 关闭窗体。没有最小化 - 使用隐藏和显示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T21:07:40.600

```
[System.Runtime.InteropServices.DllImport("coredll.dll")]
static extern int ShowWindow(IntPtr hWnd, int nCmdShow);

ShowWindow(this.Handle, SW_MINIMIZED); 
```

这成功了，this.Hide() 不起作用，因为当我重新运行应用程序时它没有再次最大化窗口。

# python - 如何在 Gtk2 中更改 MenuItem 的显示文本？

> ID：669152
> 
> 赞同：2
> 
> 时间：2009-03-21T11:28:47.410
> 
> 标签：python, gtk, pygtk

我需要更改 MenuItem 的显示文本。有没有办法在不删除 MenuItem 然后添加另一个具有不同文本的情况下做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T15:03:39.063

这在一定程度上取决于您如何创建菜单项，因为 MenuItem 是一个可以包含任何内容的容器。如果您像这样创建它：

```
menuitem = gtk.MenuItem('This is the label') 
```

然后您可以通过以下方式访问菜单项中的标签小部件：

```
label = menuitem.child 
```

然后可以将其视为普通标签：

```
label.set_text('This is the new label') 
```

但是，除非您自己制作菜单项，否则无法保证子小部件会是这样的标签，因此您应该小心。

# entity-framework - 使用 Include() 预加载

> ID：669158
> 
> 赞同：1
> 
> 时间：2009-03-21T11:35:12.280
> 
> 标签：entity-framework, linq-to-entities

想象一下这种情况：

```
var locations = from Locations in this.LocationDataContext.Locations
                                      .Include("ChildLocations")                      
                where
                     (Locations.LocationType.ID == 3) 
                select
                     Locations; 
```

此查询将加载类型 == 3 的所有位置以及所有相关的子位置，好的。但我想弄清楚的是如何过滤正在加载的子位置。如果位置有 300 万个子位置怎么办？

也许是这样的？（不起作用，因为 ChildLocations 是一组实体）

```
var locations = from Locations in this.LocationDataContext.Locations
                                      .Include("ChildLocations")                      
                where
                     (Locations.LocationType.ID == 3) &&
                     (Locations.ChildLocations.LocationType.ID == 2)
                select
                     Locations; 
```

谢谢你。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-23T14:13:48.077

实体框架永远不会实现部分完成的实例。换句话说，你不能用它的*一些*ChildLocations 来实现一个 Location。这将是一个“不完整”的对象，实体框架不允许这样做。

但是，有一些解决方法。如果您只需要来自 ChildLocations 而不是来自 Location 本身的信息，只需选择：

```
from Locations in this.LocationDataContext.Locations
where Locations.LocationType.ID == 3
from ChildLocation in Locations 
where ChildLocation.LocationType.ID == 2
select ChildLocation; 
```

在这种情况下，由于我们只选择 ChildLocations，因此只选择其中的几个是可以的，因为它们可以完全实现。只有在实现位置时，我们才需要*所有*的孩子。

另一种解决方法是将部分位置信息具体化为匿名类型。这使您可以获取有关位置和*某些*ChildLocations 的信息，而不会违反实例只能以其完整形式实现的规则。由于您实际上并没有具体化一个真实的位置，因此不需要具体化整个事物：

```
from Locations in this.LocationDataContext.Locations
where Locations.LocationType.ID == 3
select new 
{
    ID = Locations.ID,
    LocationType= Locations.LocationType
    ChildLocations = from ChildLocation in Locations 
                     where ChildLocation.LocationType.ID == 2
                     select ChildLocation
} 
```

# mod-rewrite - 我的 RewriteRule 有什么问题？

> ID：669161
> 
> 赞同：0
> 
> 时间：2009-03-21T11:40:36.337
> 
> 标签：mod-rewrite

我的 .htaccess 文件目前看起来像这样

```
AddType x-mapp-php5 .php
Options +FollowSymLinks
Options +Indexes
RewriteEngine On
RewriteBase /
RewriteRule ^account$ /account/orders.php [L] 
```

当我转到`http://mywebsite.com/account`它时，它会正确显示页面`http://mywebsite.com/account/orders.php`。但是当我将 RewriteRule 更改为

```
RewriteRule ^account/orders$ /account/orders.php [L] 
```

然后我去`http://mywebsite.com/account/orders`，我得到错误 404 Page Not Found。我做错什么了？

******额外细节**

我终于诊断出了问题。但我不明白为什么我的解决方案有效。考虑 account/orders.php 存在的场景。

以下规则将不起作用

```
RewriteRule ^account/orders$ account/orders.php [L] 
```

以下规则将起作用

```
RewriteRule ^account/order$ account/orders.php [L] 
```

即，如果 Pattern 评估为现有文件，则重写规则将失败。因此，当模式与替换相同但减去扩展名时，重写规则将失败。如果我添加一个名为 account/order.php 的文件，那么这两个规则都会失败。

为什么会这样？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T12:37:20.180

我看不出你的第一个例子是如何工作的，因为我相信初始斜线也会被传递。

RewriteRule ^/account/orders$ /account/orders.php [L]

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T11:45:55.310

奇怪，对我来说似乎没问题...如果您有权访问 Apache 配置，请尝试启用 RewriteLog 和 RewriteLogLevel 以进行一些调试...

还请查看站点的日志文件（如果您有权访问，则始终查看）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T12:41:20.637

您是否尝试过相对路径？

```
RewriteRule ^account/orders$ account/orders.php [L] 
```

* * *

**编辑**   您还应该确保禁用[MultiViews 。](http://httpd.apache.org/docs/2.2/content-negotiation.html#multiviews)这会导致 Apache 执行一些额外的模糊文件匹配来查找类似的命名文件，因此在传递给 mod_rewrite 之前`/account/orders`会被映射到。`/account/orders.php`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T13:33:08.533

我首先会尝试将重定向添加到我的规则中，这样我就可以在浏览器中看到服务器上发生了什么。

```
RewriteRule ^account$ /account/orders.php [L,R] 
```

还要确保没有其他规则（以前的规则）干扰，以防万一您没有在此处显示所有 .htaccess 文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T20:21:47.817

我正在回答我自己的问题，因为我终于诊断出了这个问题。但我不明白为什么我的解决方案有效。考虑 account/orders.php 存在的场景。

以下规则将不起作用

```
RewriteRule ^account/orders$ account/orders.php [L] 
```

以下规则将起作用

```
RewriteRule ^account/order$ account/orders.php [L] 
```

即，如果 Pattern 评估为现有文件，则重写规则将失败。因此，当模式与替换相同但减去扩展名时，重写规则将失败。如果我添加一个名为 account/order.php 的文件，那么这两个规则都会失败。

为什么会这样？

# certificate - 为什么我们需要 pfx（密钥交换）文件？

> ID：669163
> 
> 赞同：2
> 
> 时间：2009-03-21T11:42:00.967
> 
> 标签：certificate, pki

如果我们使私钥可导出（使用 makecert 中的 -pe 选项），那么理论上我们同时拥有可导出的私钥和公钥（证书中的公钥）——可以将其传输或导入另一台机器。

所以，我的问题是，为什么我们仍然需要创建 .pfx 文件（密钥交换文件，其中包含私钥和公钥）——让私钥在证书中可导出可以做任何我们想做的事情？任何场景 pfx 文件都可以涵盖哪些使证书中的私钥可导出无法实现？

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-21T12:57:32.940

您是否发现了一个 makecert 命令行会生成一个包含私钥的证书文件？我从来没有。我看到有人提到有一个版本的 makecert 可以生成 .pfx 文件，但也从未见过。

这意味着如果您想要一个私钥文件，您最多可以使用 makecert 创建两个文件。一个用于证书，一个用于私钥。您可以将这两个文件复制到另一台计算机并使用 makecert 导入它们。

.pfx 证书格式的优点是您可以将证书和私钥这两个文件合二为一。这更方便，也意味着您可以将文件与 .Net X509Certificate2 类一起用于 SslStream。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-21T11:45:23.097

您的 pfx 文件可以受密码保护，这将增加一层保护

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-09T21:11:11.723

问题是，[X509 证书标准](http://www.ietf.org/rfc/rfc2459.txt)（证书）不包括私钥。证书包含主题公钥信息（又名公钥）和关于私钥持有者的信息，但标准不支持包含私钥。这是 PKI 的基本理念——证书是您与世界共享的公共信息，私钥是您非常安全地持有的东西。

使私钥可在任何机制（例如，makecert）中导出，意味着您告诉该产品可以导出密钥。它没有指定您将用来存储它的文件格式。pfx 文件是存储私钥的一种方式 - 它使用[PKCS 12 标准](http://en.wikipedia.org/wiki/PKCS12)。Java Key Stores (*.jks) 是做同样事情的另一种方式。大多数商业支持的标准都有类似的共同特征——它们通过加密来保护私钥。可以使用密码解锁加密。他们将私钥与描述它的证书结合起来。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-09T07:24:58.130

如果要构建 PFX 文件，您应该同时拥有 x509 证书公钥和私钥文件，您可以使用 makecert 命令生成它们。PFX 可以使用 PVk2PFX 命令生成，您可以在 Microsoft SDK 安装目录中找到该命令。

# c# - 单元测试 ASP.Net MVC Authorize 属性以验证重定向到登录页面

> ID：669175
> 
> 赞同：70
> 
> 时间：2009-03-21T11:52:38.947
> 
> 标签：c#, asp.net-mvc

这可能会变成只需要另一双眼睛的情况。我一定遗漏了一些东西，但我无法弄清楚为什么不能测试这种东西。我基本上是在尝试通过使用 [Authorize] 属性标记控制器来确保未经身份验证的用户无法访问视图，并且我正在尝试使用以下代码对此进行测试：

```
[Fact]
public void ShouldRedirectToLoginForUnauthenticatedUsers()
{
    var mockControllerContext = new Mock<ControllerContext>()
                         { DefaultValue = DefaultValue.Mock };
    var controller = new MyAdminController() 
              {ControllerContext = mockControllerContext.Object};
    mockControllerContext.Setup(c =>
               c.HttpContext.Request.IsAuthenticated).Returns(false);
    var result = controller.Index();
    Assert.IsAssignableFrom<RedirectResult>(result);
} 
```

我正在寻找的 RedirectResult 是某种指示，表明用户正在被重定向到登录表单，但总是返回 ViewResult 并且在调试时我可以看到 Index() 方法已成功命中，即使用户是未认证。

难道我做错了什么？在错误的级别进行测试？我是否应该在路由级别测试这种事情？

我知道 [Authorize] 属性正在工作，因为当我打开页面时，登录屏幕确实是强加给我的 - 但是我如何在测试中验证这一点？

控制器和索引方法非常简单，以便我可以验证行为。为了完整起见，我将它们包括在内：

```
[Authorize]
public class MyAdminController : Controller
{
    public ActionResult Index()
    {
        return View();
    }
} 
```

任何帮助表示赞赏...

* * *

## 回答 #1

> 赞同：110
> 
> 时间：2009-03-22T10:52:15.383

您在错误的级别进行测试。[Authorize] 属性确保*路由*引擎永远不会为未经授权的用户调用该方法 - RedirectResult 实际上将来自路由，而不是来自您的控制器方法。

好消息是——已经有测试覆盖（作为 MVC 框架源代码的一部分），所以我想说你不需要担心它；只需确保您的控制器方法在被调用*时*执行正确的操作，并相信框架不会在错误的情况下调用它。

编辑：如果你想在你的单元测试中验证属性的存在，你需要使用反射来检查你的控制器方法，如下所示。此示例将验证随 MVC2 一起安装的“新 ASP.NET MVC 2 项目”演示中 ChangePassword POST 方法中是否存在 Authorize 属性。

```
[TestFixture]
public class AccountControllerTests {

    [Test]
    public void Verify_ChangePassword_Method_Is_Decorated_With_Authorize_Attribute() {
        var controller = new AccountController();
        var type = controller.GetType();
        var methodInfo = type.GetMethod("ChangePassword", new Type[] { typeof(ChangePasswordModel) });
        var attributes = methodInfo.GetCustomAttributes(typeof(AuthorizeAttribute), true);
        Assert.IsTrue(attributes.Any(), "No AuthorizeAttribute found on ChangePassword(ChangePasswordModel model) method");
    }
} 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2011-03-10T03:48:35.730

好吧，您可能在错误的级别进行测试，但这是有意义的测试。我的意思是，如果我用 authorize(Roles="Superhero") 属性标记一个方法，如果我标记它，我真的不需要测试。我（想我）想要的是测试未经授权的用户没有访问权限，而授权用户可以。

对于未经授权的用户，这样的测试：

```
// Arrange
var user = SetupUser(isAuthenticated, roles);
var controller = SetupController(user);

// Act
SomeHelper.Invoke(controller => controller.MyAction());

// Assert
Assert.AreEqual(401,
  controller.ControllerContext.HttpContext.Response.StatusCode, "Status Code"); 
```

嗯，这并不容易，我花了 10 个小时，但就是这样。我希望有人能从中受益或说服我转行。:)（顺便说一句 - 我正在使用犀牛模拟）

```
[Test]
public void AuthenticatedNotIsUserRole_Should_RedirectToLogin()
{
    // Arrange
    var mocks = new MockRepository();
    var controller = new FriendsController();
    var httpContext = FakeHttpContext(mocks, true);
    controller.ControllerContext = new ControllerContext
    {
        Controller = controller,
        RequestContext = new RequestContext(httpContext, new RouteData())
    };

    httpContext.User.Expect(u => u.IsInRole("User")).Return(false);
    mocks.ReplayAll();

    // Act
    var result =
        controller.ActionInvoker.InvokeAction(controller.ControllerContext, "Index");
    var statusCode = httpContext.Response.StatusCode;

    // Assert
    Assert.IsTrue(result, "Invoker Result");
    Assert.AreEqual(401, statusCode, "Status Code");
    mocks.VerifyAll();
} 
```

虽然，如果没有这个辅助函数，那不是很有用：

```
public static HttpContextBase FakeHttpContext(MockRepository mocks, bool isAuthenticated)
{
    var context = mocks.StrictMock<HttpContextBase>();
    var request = mocks.StrictMock<HttpRequestBase>();
    var response = mocks.StrictMock<HttpResponseBase>();
    var session = mocks.StrictMock<HttpSessionStateBase>();
    var server = mocks.StrictMock<HttpServerUtilityBase>();
    var cachePolicy = mocks.Stub<HttpCachePolicyBase>();
    var user = mocks.StrictMock<IPrincipal>();
    var identity = mocks.StrictMock<IIdentity>();
    var itemDictionary = new Dictionary<object, object>();

    identity.Expect(id => id.IsAuthenticated).Return(isAuthenticated);
    user.Expect(u => u.Identity).Return(identity).Repeat.Any();

    context.Expect(c => c.User).PropertyBehavior();
    context.User = user;
    context.Expect(ctx => ctx.Items).Return(itemDictionary).Repeat.Any();
    context.Expect(ctx => ctx.Request).Return(request).Repeat.Any();
    context.Expect(ctx => ctx.Response).Return(response).Repeat.Any();
    context.Expect(ctx => ctx.Session).Return(session).Repeat.Any();
    context.Expect(ctx => ctx.Server).Return(server).Repeat.Any();

    response.Expect(r => r.Cache).Return(cachePolicy).Repeat.Any();
    response.Expect(r => r.StatusCode).PropertyBehavior();

    return context;
} 
```

这样您就可以确认不属于某个角色的用户无权访问。我尝试编写一个测试来确认相反的情况，但经过两个多小时的挖掘 mvc 管道后，我将把它留给手动测试人员。（当我进入 VirtualPathProviderViewEngine 类时，我放弃了。WTF？我不想做任何事情来做 VirtualPath 或 Provider 或 ViewEngine 这三者的结合！）

我很好奇为什么这在一个所谓的“可测试”框架中如此困难。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-12T11:08:10.993

为什么不直接使用反射来查找`[Authorize]`控制器类的属性和/或您正在测试的操作方法？假设框架确实确保了 Attribute 得到尊重，这将是最简单的事情。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-09-19T21:08:58.420

我不同意 Dylan 的回答，因为“用户必须登录”并不意味着“控制器方法用 AuthorizeAttribute 注释”

为了确保在调用操作方法时“用户必须登录”，ASP.NET MVC 框架会执行类似的操作（请稍等，最终会变得更简单）

```
let $filters = All associated filter attributes which implement
               IAuthorizationFilter

let $invoker = instance of type ControllerActionInvoker
let $ctrlCtx = instance or mock of type ControllerContext
let $actionDesc = instance or mock of type ActionDescriptor
let $authzCtx = $invoker.InvokeAuthorizationFilters($ctrlCtx, $filters, $actionDesc);

then controller action is authorized when $authzCtx.Result is not null 
```

很难在有效的 c# 代码中实现这个伪脚本。很可能，[Xania.AspNet.Simulator](https://www.nuget.org/packages/Xania.AspNet.Simulator/)使设置这样的测试变得非常简单，并在后台执行这些步骤。这是一个例子。

首先从 nuget 安装软件包（撰写本文时版本 1.4.0-beta4）

> PM > 安装包 Xania.AspNet.Simulator -Pre

然后您的测试方法可能如下所示（假设安装了 NUnit 和 FluentAssertions）：

```
[Test]
public void AnonymousUserIsNotAuthorized()
{
  // arrange
  var action = new ProfileController().Action(c => c.Index());
  // act
  var result = action.GetAuthorizationResult();
  // assert
  result.Should().NotBeNull(); 
}

[Test]
public void LoggedInUserIsAuthorized()
{
  // arrange
  var action = new ProfileController().Action(c => c.Index())
     // simulate authenticated user
     .Authenticate("user1", new []{"role1"});
  // act
  var result = action.GetAuthorizationResult();
  // assert
  result.Should().BeNull(); 
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-02-23T20:31:56.557

对于 .NET Framework，我们使用此类来验证每个 MVC 和 API 控制器是否具有`AuthorizeAttribute`，并且每个 API 控制器都应该具有`RoutePrefixAttribute`.

```
[TestFixture]
public class TestControllerHasAuthorizeRole
{
    private static IEnumerable<Type> GetChildTypes<T>()
    {
        var types = typeof(Startup).Assembly.GetTypes();
        return types.Where(t => t.IsSubclassOf(typeof(T)) && !t.IsAbstract);
    }

    [Test]
    public void MvcControllersShouldHaveAuthrorizeAttribute()
    {
        var controllers = GetChildTypes<Controller>();
        foreach (var controller in controllers)
        {
            var authorizeAttribute = Attribute.GetCustomAttribute(controller, typeof(System.Web.Mvc.AuthorizeAttribute), true) as System.Web.Mvc.AuthorizeAttribute;
            Assert.IsNotNull(authorizeAttribute, $"MVC-controller {controller.FullName} does not implement AuthorizeAttribute");
        }
    }

    [Test]
    public void ApiControllersShouldHaveAuthorizeAttribute()
    {
        var controllers = GetChildTypes<ApiController>();
        foreach (var controller in controllers)
        {
            var attribute = Attribute.GetCustomAttribute(controller, typeof(System.Web.Http.AuthorizeAttribute), true) as System.Web.Http.AuthorizeAttribute;
            Assert.IsNotNull(attribute, $"API-controller {controller.FullName} does not implement AuthorizeAttribute");
        }
    }

    [Test]
    public void ApiControllersShouldHaveRoutePrefixAttribute()
    {
        var controllers = GetChildTypes<ApiController>();
        foreach (var controller in controllers)
        {
            var attribute = Attribute.GetCustomAttribute(controller, typeof(System.Web.Http.RoutePrefixAttribute), true) as System.Web.Http.RoutePrefixAttribute;
            Assert.IsNotNull(attribute, $"API-controller {controller.FullName} does not implement RoutePrefixAttribute");
            Assert.IsTrue(attribute.Prefix.StartsWith("api/", StringComparison.OrdinalIgnoreCase), $"API-controller {controller.FullName} does not have a route prefix that starts with api/");
        }
    }
} 
```

在 .NET Core 和 .NET 5< 中要容易一些。这里一个 MVC 控制器继承自`Controller`那反过来又继承自`ControllerBase`. Api Controller 直接继承自`ControllerBase`，因此我们可以使用单一方法测试 MVC 和 API Controller：

```
public class AuthorizeAttributeTest
{
    private static IEnumerable<Type> GetChildTypes<T>()
    {
        var types = typeof(Startup).Assembly.GetTypes();
        return types.Where(t => t.IsSubclassOf(typeof(T)) && !t.IsAbstract);
    }

    [Fact]
    public void ApiAndMVCControllersShouldHaveAuthorizeAttribute()
    {
        var controllers = GetChildTypes<ControllerBase>();
        foreach (var controller in controllers)
        {
            var attribute = Attribute.GetCustomAttribute(controller, typeof(Microsoft.AspNetCore.Authorization.AuthorizeAttribute), true) as Microsoft.AspNetCore.Authorization.AuthorizeAttribute;
            Assert.NotNull(attribute);
        }
    }
} 
```

# php - PHP中的这个正则表达式真的有效吗？

> ID：669178
> 
> 赞同：1
> 
> 时间：2009-03-21T11:53:42.983
> 
> 标签：php, regex

我希望正则表达式专家能告诉我为什么会出错：

这个正则表达式：

```
$pattern = '/(?<percent>[0-9]{1,3}\.[0-9]{1,2})% of (?<filesize>.+) at/'; 
```

应该匹配这种字符串：

```
[download] 87.1% of 4.40M at 107.90k/s ETA 00:05 
[download] 89.0% of 4.40M at 107.88k/s ETA 00:04 
[download] 91.4% of 4.40M at 106.09k/s ETA 00:03 
[download] 92.9% of 4.40M at 105.55k/s ETA 00:03 
```

正确的？该正则表达式是否有任何问题无法使其与上述输入相匹配？这里的完整用法：

```
while(!feof($handle))
{
    $progress = fread($handle, 8192);
    $pattern = '/(?<percent>[0-9]{1,3}\.[0-9]{1,2})% of (?<filesize>.+) at/';
    if(preg_match_all($pattern, $progress, $matches)){
    //matched
    }
} 
```

**fread**读取的内容会影响正则表达式的正常工作吗？

我真的需要确认，因为我正在尝试确定它为什么不能在新服务器上运行。这个问题与[更改服务器许可脚本不起作用有关。这可能是由于 PHP.ini 不同吗？](https://stackoverflow.com/questions/664332/change-in-server-permits-script-not-to-work-can-this-be-due-to-php-ini-being-dif)

谢谢大家

## 更新 2

我已经制作了一个测试脚本来测试正则表达式，但即使它自己也不起作用？

```
<?php 

error_reporting(E_ALL);

echo 'Start';

$progress = "[download]75.1% of 4.40M at 115.10k/s ETA 00:09 [download] 77.2% of 4.40M at 112.36k/s ETA 00:09 [download] 78.6% of 4.40M at 111.41k/s ETA 00:08 [download] 80.3% of 4.40M at 110.80k/s ETA 00:07 [download] 82.3% of 4.40M at 110.30k/s ETA 00:07 [download] 84.3% of 4.40M at 108.33k/s ETA 00:06 [download] 85.7% of 4.40M at 107.62k/s ETA 00:05 [download] 87.5% of 4.40M at 107.21k/s ETA 00:05 [download] 89.5% of 4.40M at 105.10k/s ETA 00:04 [download] 90.7% of 4.40M at 106.45k/s ETA 00:03 [download] 93.2% of 4.40M at 104.92k/s ETA 00:02 [download] 94.8% of 4.40M at 104.40k/s ETA 00:02 [download] 96.5% of 4.40M at 102.47k/s ETA 00:01 [download] 97.7% of 4.40M at 103.48k/s ETA 00:01 [download] 100.0% of 4.40M at 103.15k/s ETA 00:00 [download] 100.0% of 4.40M at 103.16k/s ETA 00:00
";

$pattern = '/(?<percent>\d{1,3}\.\d{1,2})%\s+of\s+(?<filesize>[\d.]+[kBM]) at/';

if(preg_match_all($pattern, $progress, $matches)){
    echo 'match';
}

echo '<br>Done<br>';    

?> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T13:54:49.587

我对命名捕获不太熟悉，但我认为在 PHP 中应该是：

```
$pattern = '/(?P<percent>[0-9]{1,3}\.[0-9]{1,2})% of (?P<filesize>.+) at/'; 
```

注意问号后面的**P。**

**来源：**

*   掌握正则表达式
*   [PCRE 正则表达式模式语法参考](http://www.regextester.com/pregsyntax.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T12:02:16.770

正则表达式对我来说似乎没问题。

但是，有一些事情我会改进：

*   `"\s+"`用, 代替的空格`" "`
*   数字`"\d"`，而不是`"[0-9]"`（同样的，只是更短）
*   文件大小不是用`".+"`，而是用更具体的东西

这将是我的版本：

```
(?<percent>\d{1,3}\.\d{1,2})%\s+of\s+(?<filesize>[\d.]+[kBM]) 
```

根据您期望得到多少错误的数字格式（我猜：不太可能），您可以将其缩短为：

```
(?<percent>[\d.]+)%\s+of\s+(?<filesize>[\d.]+[kBM]) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T12:49:14.020

如果您的流实际上在一次读取中提供了超过 8kb 的数据，您可能会截断最后一行，这将阻止它被匹配。[尝试使用fgets()](http://se2.php.net/fgets)一次读取一行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-21T12:50:33.143

我会使用 fgets() 来读取基于行的，因为你想匹配我假设的每一行。如果改为按行匹配，则不需要使用 preg_match_all，而只需使用 preg_match。

您的百​​分比似乎只有 1 位小数，但您匹配 1,2 位数字？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T13:01:08.470

> 该正则表达式是否有任何问题无法使其与上述输入相匹配？

不是我能看到的，但是确实有一些问题使它匹配得太多：如果你真的没有换行符，那么这个：

```
(?P<filesize>.+) at 
```

可以贪婪地匹配输入中从头到尾的“at”。因此，如果我匹配您发布的整个示例输入，我会得到一个 <percent>：

```
75.1 
```

（好）和文件大小：

```
4.40M at 115.10k/s ETA 00:09 [download] 77.2% of 4.40M at 112.36k/s ETA 00:09 [download] 78.6% of 4.40M at 111.41k/s ETA 00:08 [download] 80.3% of 4.40M at 110.80k/s ETA 00:07 [download] 82.3% of 4.40M at 110.30k/s ETA 00:07 [download] 84.3% of 4.40M at 108.33k/s ETA 00:06 [download] 85.7% of 4.40M at 107.62k/s ETA 00:05 [download] 87.5% of 4.40M at 107.21k/s ETA 00:05 [download] 89.5% of 4.40M at 105.10k/s ETA 00:04 [download] 90.7% of 4.40M at 106.45k/s ETA 00:03 [download] 93.2% of 4.40M at 104.92k/s ETA 00:02 [download] 94.8% of 4.40M at 104.40k/s ETA 00:02 [download] 96.5% of 4.40M at 102.47k/s ETA 00:01 [download] 97.7% of 4.40M at 103.48k/s ETA 00:01 [download] 100.0% of 4.40M at 103.15k/s ETA 00:00 [download] 100.0% of 4.40M 
```

（不太好）。为避免这种情况，请使用非贪婪匹配“.+?”，或更具体的表达式，如“[^ ]+”或 Tomalak 的版本。

> fread 读取的内容会影响正则表达式的正常工作吗？

是的。分块读取是非常不可靠的：如果一个“[下载]”行在一个块边界上被分割，它将不匹配并且会丢失。您可以：

*   不在乎，或
*   一次读取整个输入，或
*   如果输入中确实有换行符（通常有），则使用基于行的阅读
*   通过保留输入的最后 n 个字符（其中 n 是找到的最终匹配结束的索引）并将新的传入输入附加到它来手动管理缓冲区。

至于服务器差异，我唯一能想到的是，如果其中一台服务器是 Windows 和一台 *ix，他们对换行符的概念会有所不同，这可能会导致“有没有换行符？” 困惑。

# php - 有效地保持 PHP 中的前 5 个值

> ID：669181
> 
> 赞同：1
> 
> 时间：2009-03-21T11:57:34.753
> 
> 标签：php, algorithm, sorting, optimization, linear-programming

我正在用 PHP 编写一个小算法，它遍历*n*部带有评级的电影，并将存储前 5 部。我不是从数据文件中读取，而是从流中读取，所以我不能简单地按评级对电影进行排序。

我的问题是，当我阅读流媒体时，跟踪排名前 5 的电影的最有效方法是什么？目前我执行以下操作：

1.  读入 5 部电影（进入名为 movies[] 的数组），带有两个键 movies[][name] 和 movies[][rating]
2.  使用 array_multisort() 按 movies[rating] 排序数组（最高评分现在位于 movies[4]）
3.  在下一部电影中阅读
4.  如果这个新电影评分 > movies[0][rating] 则用这个新电影替换 movies[0]
5.  重新排序列表
6.  重复 3-5 直到完成

我的方法有效，但每次阅读后都需要对列表进行排序。我相信这是一种昂贵的方法，主要是因为每次我使用 array_multisort() 时，我都必须对 5 部电影进行 for 循环，以构建要排序的索引。谁能提出一个更好的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-21T12:12:59.520

链接列表可以在这里工作。

建立一个以正确顺序链接前 5 部电影的链表。对于每部新电影，只需从链的末端开始，一直走到您的电影介于评分较高的电影和评分较低的电影之间。然后将您的链接插入到此处的列表中。如果这部电影比最差的电影好（因此您的列表现在长 6 个），只需删除链中的最后一个链接，您就会回到第 5 个。

没有排序，没有索引。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-21T12:02:56.270

你的算法看起来不错。我不确定数组是如何在 PHP 中实现的。从算法的角度来看：使用堆而不是数组。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-21T12:34:47.317

每次阅读后重新排序没有意义，因为您实际上只需要插入一个新条目。使用以下算法，它可能会为您提供最佳速度。它基本上是一个展开的循环，而不是最漂亮的代码。

```
set movies[0..4].rating to -1.
while more movies in stream:
    read in next movie.
    if movie.rating < movies[0].rating:
        next while
    if movie.rating < movies[1].rating:
        movies[0] = movie
        next while
    if movie.rating < movies[2].rating:
        movies[0] = movies[1]
        movies[1] = movie
        next while
    if movie.rating < movies[3].rating:
        movies[0] = movies[1]
        movies[1] = movies[2]
        movies[2] = movie
        next while
    if movie.rating < movies[4].rating:
        movies[0] = movies[1]
        movies[1] = movies[2]
        movies[2] = movies[3]
        movies[3] = movie
        next while
    movies[0] = movies[1]
    movies[1] = movies[2]
    movies[2] = movies[3]
    movies[3] = movies[4]
    movies[4] = movie 
```

最后，您有排序的电影列表。如果少于 5 个，则其他人的评分为 -1，因此您会知道它们是无效的。这是假设真实电影的评分为零或更高，但如果不是，您可以调整值。

如果您需要针对超过 5 部电影进行调整，则可以。最好的选择是再次卷起循环。然而，在某些时候，对它进行排序会比使用这种方法更有效。这种方法只适用于小数据集。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-21T12:26:07.243

> 我的方法有效，但每次阅读后都需要对列表进行排序。

不，它没有，它只需要在你找到一部评级为 > movies[0][rating] 的新电影后进行排序。

这种方法对我来说似乎很有效。只有当前 5 名有新条目时，您才会偶尔进行排序，您处理的电影越多，这种情况发生的次数就越少。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T12:22:08.593

名单有多大？我猜这不是将整个列表保存在内存中并在最后对其进行排序的选项吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T12:52:38.427

1.  数组中不需要两个键。以名称为键，以评级为值的数组就可以了。使用[arsort()](http://www.php.net/manual/en/function.arsort.php)对其进行排序；
2.  该算法并不完美，您可以使用链表优化。虽然我认为在 PHP 中实现的链表实际上会更慢，对 6 个元素的 asort() 函数调用。对于大 O 估计，您可以假设对 6 个元素进行排序具有恒定时间。
3.  只有当您遇到比实际评分更高的电影时，您才会进行排序，因此在平均情况下，您会在进步的同时少做少做。只有在最坏的情况下，您才会对每部电影进行排序，即初始列表从最低评分开始排序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-21T13:45:37.300

这是我要做的：

```
// let’s say get_next_movie () returns array with 'rating' and 'name' keys

while ($m = get_next_movie ()) {

  $ratings[$m['rating']][] = $m['movie'];

  $temp_ratings = $ratings;
  $top5 = array ();
  $rating = 5;
  while (1) {
    if (count ($temp_ratings[$rating])) {
      $top5[] = array_shift ($temp_ratings[$rating]);
    } elseif ($rating > 0) {
      --$rating;
    } else {
      break;
    }
  }

  // $top5 has current top 5 :-)

} 
```

$ratings 数组看起来像这样，每个评分里面都有电影数组：

```
Array
    (
    [5] => Array
        (
            [0] => Five!
        )

    [3] => Array
        (
            [0] => Three
            [1] => Threeeeee
            [2] => Thr-eee-eee
        )

    [4] => Array
        (
            [0] => FOR
        )
    ) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-21T16:12:45.013

也许这会有所帮助。

```
class TopList {
    private $items = array();
    private $indexes = array();
    private $count = 0;
    private $total = 5;
    private $lowest;
    private $sorted = false;

    public function __construct($total = null) {
        if (is_int($total))
            $this->total = $total;

        $this->lowest = -1 * (PHP_INT_MAX - 1);
    }

    public function addItem($index, $item) {
        if ($index <= $this->lowest)
            return;

        $setLowest = $this->count === $this->total;
        if ($setLowest) {
            /* //remove first added
            $lowestIndex = array_search($this->lowest, $this->indexes);
            /*/ //remove last added
            $lowestIndex = end(array_keys($this->indexes, $this->lowest));
            //*/
            unset($this->indexes[$lowestIndex], $this->items[$lowestIndex]);
        } else {
            ++$this->count;
            $setLowest = $this->count === $this->total;
        }

        $this->indexes[] = $index;
        $this->items[] = $item;
        $this->sorted = false;

        if ($setLowest)
            $this->lowest = min($this->indexes);
    }

    public function getItems() {
        if (!$this->sorted) {
            array_multisort($this->indexes, SORT_DESC, $this->items);
            $this->sorted = true;
        }
        return $this->items;
    }
}

$top5 = new TopList(5);
foreach ($movies as $movie) {
    $top5->addItem($movie['rating'], $movie);
}
var_dump($top5->getItems()); 
```

# .net - AJAX Web 服务调用问题：Microsoft JScript 运行时错误：Sys.Net.WebServiceFailedException：

> ID：669188
> 
> 赞同：0
> 
> 时间：2009-03-21T12:03:19.793
> 
> 标签：.net, ajax, web-services

我正在尝试从同一台机器上的客户端网站调用 AJAX Web 服务调用 [Win XP Home]。在这样做时，我收到以下错误。

```
Microsoft JScript runtime error: Sys.Net.WebServiceFailedException: The server method 'Greetings' failed with the following error: <html>
    <head>
        <title>Not Found</title>
        <style>
            body {font-family:"Verdana";font-weight:normal;font-size: 8pt;color:black;} 
            p {font-family:"Verdana";font-weight:normal;color:black;margin-top: -5px}
            b {font-family:"Verdana";font-weight:bold;color:black;margin-top: -5px}
            h1 { font-family:"Verdana";font-weight:normal;font-size:18pt;color:red }
            h2 { font-family:"Verdana";font-weight:normal;font-size:14pt;color:maroon }
            pre {font-family:"Lucida Console";font-size: 8pt}
            .marker {font-weight: bold; color: black;text-decoration: none;}
            .version {color: gray;}
            .error {margin-bottom: 10px;}
            .expandable { text-decoration:underline; font-weight:bold; color:navy; cursor:hand; }
        </style>
    </head>
    <body bgcolor="white">

            <span><h1>Server Error in '/WebServiceClient1' Application.<hr width=100% size=1 color=silver></h1>

            <h2> <i>HTTP Error 404 - Not Found.</i> </h2></span>

            <hr width=100% size=1 color=silver>

            <b>Version Information:</b>&nbsp;ASP.NET Development Server 9.0.0.0

            </font>

    </body>
</html> 
```

下面是服务器和客户端代码

## 服务器代码：

```
[WebService(Namespace = "http://tempuri.org/")]
    [WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
    // To allow this Web Service to be called from script, using ASP.NET AJAX, uncomment the following line. 
    [System.Web.Script.Services.ScriptService]
    public class Service : System.Web.Services.WebService
    {

        [WebMethod]
        public string Greetings(string name)
        {
            string msg;
            msg = String.Format("Hello {0}: Processed on {1}", name, System.DateTime.Now.ToLongTimeString());
            return msg;
        }
    } 
```

## 客户端代码：

```
<script type ="text/javascript">
    function GreetingsButtonOnClick() {
        Service.Greetings($get("NameTextBox").value, OnGreetingsComplete);
    }  //error occurs at this line and the control goes to scriptresource.axd file

    function OnGreetingsComplete(result) {
        var elem = $get("Results");
        elem.innerHTML = result;
    }
</script>

    <asp:ScriptManager ID="ScriptManager1" runat="server">
        <Services>
            <asp:ServiceReference Path="http://localhost:4033/WebService1_AJAX/Service.asmx" />
        </Services>
    </asp:ScriptManager> 
```

（请注意，在服务器中调用 Web 服务函数调用工作正常，并且我已经正确定义了 & 服务标签）

```
js file (http://localhost:4033/WebService1_AJAX/Service.asmx/js)
--------
var Service=function() {
Service.initializeBase(this);
this._timeout = 0;
this._userContext = null;
this._succeeded = null;
this._failed = null;
}
Service.prototype={
_get_path:function() {
 var p = this.get_path();
 if (p) return p;
 else return Service._staticInstance.get_path();},
Greetings:function(name,succeededCallback, failedCallback, userContext) {
return this._invoke(this._get_path(), 'Greetings',false,{name:name},succeededCallback,failedCallback,userContext); }}
Service.registerClass('Service',Sys.Net.WebServiceProxy);
Service._staticInstance = new Service();
Service.set_path = function(value) { Service._staticInstance.set_path(value); }
Service.get_path = function() { return Service._staticInstance.get_path(); }
Service.set_timeout = function(value) { Service._staticInstance.set_timeout(value); }
Service.get_timeout = function() { return Service._staticInstance.get_timeout(); }
Service.set_defaultUserContext = function(value) { Service._staticInstance.set_defaultUserContext(value); }
Service.get_defaultUserContext = function() { return Service._staticInstance.get_defaultUserContext(); }
Service.set_defaultSucceededCallback = function(value) { Service._staticInstance.set_defaultSucceededCallback(value); }
Service.get_defaultSucceededCallback = function() { return Service._staticInstance.get_defaultSucceededCallback(); }
Service.set_defaultFailedCallback = function(value) { Service._staticInstance.set_defaultFailedCallback(value); }
Service.get_defaultFailedCallback = function() { return Service._staticInstance.get_defaultFailedCallback(); }
Service.set_path("/WebService1_AJAX/Service.asmx");
Service.Greetings= function(name,onSuccess,onFailed,userContext) {Service._staticInstance.Greetings(name,onSuccess,onFailed,userContext); } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T14:45:34.757

Web 服务是一个不同的项目吗？如果是这样，.NET 将认为它是一个跨域调用（我认为是因为客户端和服务在开发人员 Web 服务器的不同实例中运行），它不受 ASP.NET AJAX 支持。

简单的解决方案是将服务移动到同一个项目和使用它的客户端中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-25T07:33:54.327

你必须使用`Method=POST`. 例子：

```
WebInvoke(BodyStyle = WebMessageBodyStyle.WrappedRequest,
          Method = "POST",
          RequestFormat = WebMessageFormat.Json,
          ResponseFormat = WebMessageFormat.Json)]
[OperationContract]
public string DoMyWork()
{

} 
```

# apache - 调试 .htaccess 的流行技术

> ID：669189
> 
> 赞同：19
> 
> 时间：2009-03-21T12:03:33.037
> 
> 标签：apache, debugging, .htaccess

我是一名自学成才的程序员，我喜欢通过回显可疑变量和注释掉代码来进行调试。

最近，我不得不了解更多关于 .htaccess 文件的信息。我需要它来做一些事情，比如将 php 脚本解释为 php5、url 重写、限制文件上传大小等......我在调试 .htaccess 文件时遇到了很多麻烦。我经常不得不将 PHP 应用程序从一个共享托管环境迁移到另一个。有时这会破坏 .htaccess 文件（或者相反，.htaccess 文件中的某些内容会破坏站点）。我检查以确保域名已更新。

是否有用于调试 .htaccess 文件的流行技术？它只是查看apache日志吗？还要别的吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-21T12:09:48.780

查看 apache 日志是调试 .htaccess imho 的最简单方法（如有必要，添加 rewriteLog 指令）

关于迁移：如果您没有使用 .htaccess 中的任何物理文件路径（即 /var/www/site/script.php），它们应该可以正常工作。如果不是这种情况，首先尝试删除所有选项并只保留重定向指令，在这种模式下，您可以查看服务器配置是否有问题，拒绝重写默认设置。

[一些参考](http://httpd.apache.org/docs/2.0/mod/mod_rewrite.html)

# html - 有没有可以嵌入网站的图库软件，很简单，我可以让其他人添加图片（和标题）

> ID：669199
> 
> 赞同：1
> 
> 时间：2009-03-21T12:12:31.737
> 
> 标签：html, image-gallery

我正在寻找可以让我将照片库放到我的网站上的东西。我还想让其他人能够轻松添加/删除图片。

使用照片共享网站（如 Flickr）会很好，但不是必需的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T12:40:48.317

[http://gallery.menalto.com/](http://gallery.menalto.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T15:11:32.087

就个人而言，我使用基于 PHP 的[Coppermine Photo Gallery 。](http://coppermine-gallery.net/)它需要一个数据库（我使用的是 MySQL），但还有其他使用基于平面文件的数据源的替代方案。

Coppermine 允许用户创建帐户、上传自己的照片以及对照片进行评论和投票。有很多高级功能我还没有深入研究。主网站有完整的功能列表。

显然，ASP.net 解决方案也有其他选择。您托管在哪个网络服务器上？

[Coppermine的要求是](http://coppermine-gallery.net/demo/cpg14x/docs/faq.htm#MinimumRequirements)：

*   任何网络服务器，Apache 推荐（据报道，Coppermine 可与 Apache、Microsoft Internet Information Server (IIS)、Roxen WebServer、Abyss、JanaServer 一起使用）
*   PHP 4.2.0 或更高版本
*   GD lib 或 Image Magick
*   mySQL 3.23.23 或更高版本（推荐 4.x）。不要将客户端 api 版本（显示在 phpinfo 中）与 mySQL 版本混淆！

哦，另外，Coppermine 是免费软件，在 GNU GPL 许可下发布。

[ [http://coppermine-gallery.net/](http://coppermine-gallery.net/) ]

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T13:16:05.140

CoolIris 通过“Vido wall”风格的 Flash 组件支持 XML/Flickr。

但是没有添加/删除功能，这取决于其他代码来做到这一点。也许使用这个*以及*其他人的建议？

[http://developer.cooliris.com/?p=embed](http://developer.cooliris.com/?p=embed)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-17T20:43:25.470

我可以添加 xFlow！到这个杰出的名单？

[http://xflow.pwhitrow.com](http://xflow.pwhitrow.com)

流！是一个画廊应用程序，旨在满足互联网对功能齐全的 Coverflow 风格画廊的需求。

用 PHP 和 Javascript 编写，设置和管理轻而易举，并拥有丰富的功能，包括对 Flickr 和 YouTube 的支持。

# .net - 您如何处理模型类中的外键关系

> ID：669202
> 
> 赞同：1
> 
> 时间：2009-03-21T12:14:42.497
> 
> 标签：.net, asp.net, linq-to-sql, orm

假设我有一个带有 FK CompanyId 的项目表，它将项目与公司表相关联。

在您的 Project 模型中，您是添加 Company 对象，还是仅添加 CompanyId 属性并在代码中需要时检索 Company？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T15:17:50.963

这取决于你要用它做什么。例如，如果您有一个包含创建项目所需的所有字段的 UI，并且在该 UI 中您选择了将项目与下拉框相关联的公司，那么可能只关联键将是合理有效的做法。

我更愿意在“纯度”方面附加一个公司对象，但如果我从来没有遇到过我实际上会对那个客户做任何事情的情况，我只会使用密钥。我不知道您使用什么语言/平台，但您可以考虑某种延迟加载方案，其中公司对象在 JIT 基础上填充其数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T12:25:42.440

使用 LinqToSQL 时，外键关系在 SQLMetal 生成的业务实体中自动建模。实体类型具有以子或父类型命名的子属性或父属性。您可以使用它们来检索相关的业务实体。

这些属性支持延迟加载，因此您各自的子实体或父实体仅在需要时从数据库加载。

# c# - 在 C# 中拖放？

> ID：669204
> 
> 赞同：4
> 
> 时间：2009-03-21T12:17:18.467
> 
> 标签：c#, drag-and-drop

如何仅在我的程序和 Explorer ya windows 应用程序之间实现拖放

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T12:24:03.160

只要您使用的是 WinForms，它实际上非常简单。请参阅这两篇文章以帮助您入门：

*   [将文件从 Windows 资源管理器拖放到 Windows 窗体](http://www.codeproject.com/KB/cs/dragdrop.aspx)
*   [将文本文件从 Windows 资源管理器拖放到 Windows 窗体应用程序](http://www.dotnetcurry.com/ShowArticle.aspx?ID=192&AspxAutoDetectCookieSupport=1)

以防万一您使用 WPF，[本教程](http://www.wpftutorial.net/DragAndDrop.html)和[此 SO 线程](https://stackoverflow.com/questions/316900/dragndrop-one-or-more-mails-from-outlook-to-c-wpf-application)应该会有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T12:22:15.317

CodeProject 上有一篇关于如何做到这一点的好文章：

> 此示例项目列出了一个包含文件的文件夹，并允许您将它们拖放到资源管理器中。您也可以从 Explorer 中拖动到示例中，并且可以使用 Shift 和 Ctrl 键来修改操作，就像在 Explorer 中一样。

[使用 Windows 资源管理器拖放、剪切/复制和粘贴文件](http://www.codeproject.com/KB/shell/Explorer_Drag_Drop.aspx)

> 为了在资源管理器中开始拖动操作，我们实现了 中的`ItemDrag` 事件，`Listview`在您拖动项目超过几个像素后调用该事件。我们简单地调用 `DoDragDrop`传递要拖动的文件包裹在一个`DataObject`. 你真的不需要了解 `DataObject`——它实现 `IDataObject`了通信中使用的接口。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T12:25:13.313

在 Drag enter 事件中添加此项（这将在您拖动文件时更改光标类型）

```
 private void Form1_DragEnter(object sender, DragEventArgs e)
    {
        // If file is dragged, show cursor "Drop allowed"
        if (e.Data.GetDataPresent(DataFormats.FileDrop))
            e.Effect = DragDropEffects.Copy;
        else
            e.Effect = DragDropEffects.None;
    } 
```

然后在 DragDrop 事件中，您需要处理您想要做什么。并将 AllowDrop 属性设置为 true

# com - VB6 到 C# 互操作：无法直接设置“对象”类型的属性

> ID：669208
> 
> 赞同：1
> 
> 时间：2009-03-21T12:19:26.667
> 
> 标签：com, vb6, interop, object

给定以下 C# 类：

```
namespace ComTest
{
    [InterfaceType(ComInterfaceType.InterfaceIsIDispatch)]
    [Guid("A1D11BE5-40A1-4566-A1CA-418ABC76017C")]
    public interface IThing
    {
        [DispId(1)]
        void SetValue( object input );
        [DispId(2)]
        object Value {get; set;}
    }

    [ComVisible(true)]
    public class Thing: IThing
    {
        internal object PValue;

        public void SetValue(object input)
        {
            PValue = input;
        }

        public object Value
        {
            get
            {
                return PValue;
            }
            set
            {
                PValue = (object)value;
            }
        }

    }
} 
```

谁能解释VB6中的以下行为？

```
Dim oThing as Thing
Dim input as Variant, output as Variant
input = "Some text"
Set oThing = new Thing
oThing.SetValue(input)    ' works fine
output = oThing.Value     ' works fine
Set oThing.Value = input  ' fails with runtime error '424': Object required 
```

[新] 我将程序集设置为 COM 可见并选中标记为“注册 COM 互操作”的项目属性框（构建选项卡）。

正如您可能猜到的那样，该示例是我正在使用的实际类的精简版。我比较了实际类和 Thing 类（下）生成的 TLB 信息。标记为 ** 的行在 Thing 类中找到，但在实际类中没有（实际的 coclass 包含 [default] dispinterface IThing），并且这个额外生成的接口 _Thing 似乎以两种方式改变了 VBA 中的行为：（1）属性将不再自动完成，(2) 直接分配给 Value 现在像贡献者发现的那样工作。有什么想法吗？

```
// Generated .IDL file (by the OLE/COM Object Viewer)
// 
// typelib filename: ThingLib.tlb
[
  uuid(92093AA7-870E-498A-8B80-97545D221E24),
  version(1.0),
  helpstring("AAA Testing COM interop")
]
library ThingLib
{
    // TLib :     // TLib : mscorlib.dll : {BED7F4EA-1A96-11D2-8F08-00A0C9A6186D}
    importlib("mscorlib.tlb");
    // TLib : OLE Automation : {00020430-0000-0000-C000-000000000046}
    importlib("stdole2.tlb");

    // Forward declare all types defined in this typelib
    dispinterface IThing;
**  interface _Thing;

    [
      uuid(7FC255DD-F82F-4B39-8755-9680A97033B5),
      version(1.0),
        custom({0F21F359-AB84-41E8-9A78-36D110E6D2F9}, "ComTest.IThing")    

    ]
    dispinterface IThing {
        properties:
        methods:
            [id(0x00000001)]
            void SetValue([in] VARIANT input);
            [id(0x00000002), propget]
            VARIANT Value();
            [id(0x00000002), propputref]
            void Value([in] VARIANT rhs);
    };

    [
      uuid(D96FB9C7-A0AF-35D3-A0F6-A07A9ED47984),
      version(1.0),
        custom({0F21F359-AB84-41E8-9A78-36D110E6D2F9}, "ComTest.Thing")
    ]
    coclass Thing {
**      [default] interface _Thing;
        interface _Object;
        dispinterface IThing;
    };

**    [
**      odl,
**      uuid(C309BDD0-239F-38AA-A057-254F8E01BD4B),
**      hidden,
**      dual,
**      oleautomation,
**        custom({0F21F359-AB84-41E8-9A78-36D110E6D2F9}, "ComTest.Thing")    
**    ]
**    interface _Thing : IDispatch {
**    };
}; 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-23T05:47:58.120

将您的代码更改为：

```
Dim oThing as Thing
Dim input as Variant, output as Variant
input = "Some text"
Set oThing = new Thing
oThing.SetValue(input)    ' works fine
output = oThing.Value     ' works fine
Set oThing.Value = input  ' Change this line 
```

一切都应该工作。（你必须在 VB6 中设置对象，你试图让一个对象，这只能用于原子类型）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T14:49:42.593

杰里米，我试过你的代码，它工作正常（虽然我使用 Excel VBA，因为我没有安装 VB6）。您的代码中有错字

```
object Value (get; set;) 
```

应该

```
object Value {get; set;} 
```

但我怀疑它与你的错误有什么关系，因为它应该给你一个编译错误。您是否完全按照您在此处放置的代码尝试了代码？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-22T15:44:30.300

我还用 VB6 客户端尝试了您的 COM 接口实现，没有任何问题（属性中提到的 Jakob 拼写错误除外`Value`）。

# iphone - iPhone - initWithFrame 不适用于 UIActivityIndi catorView？

> ID：669216
> 
> 赞同：1
> 
> 时间：2009-03-21T12:22:42.197
> 
> 标签：iphone

我正在使用带有自定义单元格的表格视图，并希望在单击按钮时更改表格视图的内容。当单元格加载数据时，我正在使用活动指示器。

这就是我创建指标视图的方式

```
indicator = [[UIActivityIndicatorView alloc] initWithFrame:CGRectMake(141.0, 190.0, 37.0, 37.0)];
indicator.activityIndicatorViewStyle = UIActivityIndicatorViewStyleWhite;
indicator.hidesWhenStopped = YES;
[[self tableView] addSubview:indicator]; 
```

但似乎框架对指标没有影响。指示器不是显示在表格的中心，而是显示在视图左上角的导航栏中。

我不知道这有什么问题以及为什么会这样。有人可以帮帮我吗。 [替代文字 http://www.freeimagehosting.net/uploads/95cbe49850.png](http://www.freeimagehosting.net/uploads/95cbe49850.png)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-21T13:53:15.287

`initWithFrame:`不是创建`UIActivityInidcator`. 看一下 API，你可以看到要创建一个`UIActivityIndicator`，你应该使用

```
[[UIActivityIndicator alloc] initWithActivityIndicatorStyle:UIActivityIndicatorViewStyleWhite]; 
```

`setCenter:`然后将其添加到您的视图并按照 Pablo 的建议设置其位置。

此外，如果用户向上或向下滚动，将其添加到表格视图中的位置将使其与表格一起滚动。如果你把它放在表的超级视图中，它会留在原地。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-21T12:40:32.590

试试这个：

```
 activityIndicator = [[UIActivityIndicatorView alloc] initWithFrame:CGRectMake(0.0f, 0.0f, 32.0f, 32.0f)];
    [activityIndicator setCenter:CGPointMake(160.0f, 208.0f)];
    [activityIndicator setActivityIndicatorViewStyle:UIActivityIndicatorViewStyleGray];
    [activityIndicator startAnimating]; 
```

调用**setCenter**应该会给出您所期望的行为。

祝你好运！

# .net - WCF：我应该如何在客户端和服务器中维护合同类？

> ID：669228
> 
> 赞同：5
> 
> 时间：2009-03-21T12:29:14.443
> 
> 标签：.net, wcf, client-server

我正在开发一个带有服务器和客户端的 WCF 应用程序（自然）。在服务器项目中，我定义了具有*合同*属性的类。

现在，当服务器准备就绪时，我添加了服务引用并为我创建了代理。我用过它，它确实工作得很好。

我想问的问题是，如果我创建一个包含具有合同属性的类定义的通用 DLL 并将其用于服务器和客户端（而不是使用 Visual Studio 为客户端生成的类），是否可以。如果我使用通用类，我不必担心在自动代码生成时泛型集合被转换为数组。傻吗？是否可以？以前有人做过吗？这样做可以吗？

部署方案是这样的，即安全 Intranet 中的客户端数量有限（很少），并且只要服务器发生更改，就可以更新现有客户端。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T12:41:12.743

**只要**您控制客户端，这种方法就很好（我经常使用这种方法） 。它（显然）不适用于 java 客户端等。如果您知道永远不需要支持非 .NET 客户端，那么它可能很强大，但它违反了一些纯粹的 SOA 规则。特别是，是的，Intranet 场景是我可能会考虑这种方法的场景。

svcutil.exe 和 IDE 都可以选择重用现有程序集中的类型来完全做到这一点。

**编辑**这种方法的另一个优点是，如果您想在客户端使用相同的验证逻辑，而无需对其进行两次编码 - 例如`IDataErrorInfo`等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T13:07:36.287

如果您唯一关心的是将集合转换为数组，那么您不必走这么远。“添加服务引用”对话框上的“高级”按钮允许您指定用于此类情况的类型。你可以让它使用 List 而不是 T[]。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-31T20:58:52.187

在单独的通用程序集中维护合同类型是一个非常好的主意。它使您有机会添加[适配器](http://www.google.com/search?q=adapter+pattern)，例如，在合同类型和您可能拥有的其他业务对象之间进行转换，或者在这些类型之间进行中介等。

*即使您不控制所有客户端*，使用通用类型也是有意义的。假设您的服务由使用 .NET 的内部应用程序以及合作伙伴公司的受信任第三方使用。合作伙伴应用程序使用 Java、Ruby 或 Python。在这种情况下，合作伙伴将无法访问共享类型，但依靠 WSD/XSD，可以滚动他们自己的客户端类型库。这不应该妨碍您向内部开发人员提供一个很好的共享类型包。

当您使用 REST 接口而不是 WS/SOAP 时，此共享类型的建议也适用。对于 REST，缺少 WSDL，但 XSD（或类似的）仍将用于描述服务器及其客户端交换的消息的类型。因此，无论您使用 SOAP 还是 REST，建议都不会改变。

编辑：而且，无论您使用 .NET 还是 Java 或其他任何东西，它都适用。如果您控制电线的两端并且平台相同，那么是的，您应该共享类型。你为什么不呢？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-31T21:18:35.587

一旦您创建了单独的程序集来保存合同，您就可以引用这些程序集并使用它们从客户端创建到服务的通道（使用[ChannelFactory](http://msdn.microsoft.com/en-us/library/ms576132.aspx)）。通过这样做，您不再需要在每次更改服务合同时更新“服务参考”。

```
ChannelFactory<IContract> factory = 
    new ChannelFactory<IContract>("endpointName"); 
```

# mshtml - MSHTML 教程

> ID：669236
> 
> 赞同：5
> 
> 时间：2009-03-21T12:36:43.253
> 
> 标签：mshtml, ihtmldocument2, ihtmldocument

我想学习一些关于 MSHTML 的基础知识，比如如何使用 IHtmlDocument 和 IHtmlDocument2 接口。我搜索了很长时间，但找不到适合初学者的教程。有人可以推荐一些东西来阅读吗？

编辑：我更喜欢使用 C#。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T12:57:23.173

当我学习使用 MSHTML 时，我主要依赖于[MSDN 文档](http://msdn.microsoft.com/en-us/library/aa752038(VS.85).aspx)并询问新闻组和此类网站中的*具体*细节。

它还帮助我下载了整个[Windows SDK](http://msdn.microsoft.com/de-de/windows/bb980924.aspx)而不是在线阅读。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-21T13:56:23.203

如果您使用的是 C#，那么您不应该使用 MSHTML。如果您使用 Windows 窗体，请使用 WebBrowser 组件，如果您尝试生成 HTML（如 XHTML），请使用任何 XML API。您可能想要使用 HtmlWriter，但如果可以提供帮助，请远离非托管代码。

* * *

链接：

*   [WebBrowser 控件（Windows 窗体）](http://msdn.microsoft.com/en-us/library/2te2y1x6.aspx)
*   [HtmlTextWriter 类 (System.Web.UI)](http://msdn.microsoft.com/en-us/library/system.web.ui.htmltextwriter.aspx)
*   [http://social.msdn.microsoft.com/Search/en-US/?query=mshtml%20tutorial&ac=1](http://social.msdn.microsoft.com/Search/en-US/?query=mshtml%20tutorial&ac=1)

顺便说一句，MSHTML 不是新事物——它是老事物。顺便说一句，这***是*** [George2](http://social.msdn.microsoft.com/en-US/profile/?user=George2&referrer=http%3A//social.msdn.microsoft.com/Forums/en-US/users/%23page%3A1%3Bsearchexpression%3Ageorge2)吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-24T17:10:24.753

在 IE SDK 文档的“托管和重用”部分下有一些教程。但我想您还需要阅读 HTML/CSS 部分下的 DHTML 教程。

# c# - ADO.NET 数据服务在整体设计中的位置

> ID：669242
> 
> 赞同：2
> 
> 时间：2009-03-21T12:40:26.630
> 
> 标签：c#, wcf-data-services

ADO.NET 数据服务是应用程序中的下一代数据访问层。我已经看到很多直接从 UI 层（例如 Silverlight 或 Ajax）使用它来获取数据的示例。这几乎就像拥有一个两层系统，业务层完全移除。DAL 是否应该由业务层访问，而不是直接从 UI 访问？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T13:53:20.543

> ADO.NET 数据服务是应用程序中的下一代数据访问层

我不知道你从哪里得到*的*！也许您将 ADO.NET 数据服务与 ADO.NET 实体框架混淆了？

* * *

不应假设 Microsoft 生产的所有东西对每个开发人员都有价值。在我看来，ADO.NET 数据服务是一种快速创建 CRUD 服务的方法，它可能在实体上定义了一些其他操作，但这些操作都是存储过程。如果您只需要一个面向数据库的服务，那么这可能就是您想要的。当然，除了在数据库中之外，没有必要为这样的服务进行任何编码。

但这并不意味着 ADO.NET 数据服务“在每个项目的整体设计中都占有一席之地”。它满足了对足够客户的需求，微软认为值得花钱开发和维护它。

就此而言，他们还认为 ASP.NET MVC 是个好主意……

:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-25T01:15:23.437

ADO.NET 数据服务是另一种为了移动数据而需要评估的工具。

.NET RIA 服务是另一种。我会说好多了。

我将 ADO.NET 数据服务视为供某些高级框架使用的低级服务。我不会让我的 UI 直接与它对话。

我看到的 ADO.NET 数据服务的主要问题与安全性有关，而不是其他任何问题。

对于简单/快速的任务，在 Intranet 中，如果你对你的设计不太挑剔，它会很有用。(IMO) 当您需要从现有数据库中快速公开数据时，它会非常方便。

我说得心应手，但这不是我的第一选择，因为我尽可能避免“快速而肮脏”的解决方案。那些解决方案就像鬼魂，总是回来困扰你。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-23T03:00:26.553

在我看来，其他答案低估了 ADO.Net 数据服务的重要性。尽管在您的应用程序中直接使用它会带来与两层系统的一些相似性，但其他 Microsoft 产品，如基于它的 .Net RIA Services、Windows Asure Storage Services。与答案之一中的短语“对于简单/快速的任务，在 Intranet 中，如果您对自己的设计不太挑剔，它可能很有用”相反，它可能对公共网站有用，包括 ASP 中的网站。网络 MVC。

Dino Esposito 在他的博客中描述了 Ado.Net 数据服务的驱动力

[http://weblogs.asp.net/despos/archive/2008/04/21/the-quot-driving-force-quot-pattern-part-1-of-n.aspx](http://weblogs.asp.net/despos/archive/2008/04/21/the-quot-driving-force-quot-pattern-part-1-of-n.aspx)

“ADO.NET 数据服务（又名 Astoria）

驱动力：构建富交互性 Web 系统的需求。抽象地说：用于构建中间层的新工具集，或者更好的是，在任何类型的应用程序（包括企业级应用程序）的中间层之上的服务层。具体是什么：为您提供从超链接调用的 URL，以将数据传送到客户端。更适合客户端需要对数据进行直接|部分过滤访问的场景。不适合从 IE 查询数据，但适合构建具有 AJAX 气息的新一代 Web 控件。仅此而已。”

# internet-explorer - 如何使用 HTML 在 IE 中显示 Unicode 字符

> ID：669265
> 
> 赞同：10
> 
> 时间：2009-03-21T12:59:44.090
> 
> 标签：internet-explorer, unicode, html-entities

我正在尝试使用以下代码在页面底部显示版权和无穷大符号：

```
&#x00A9 Copyright Mikle 2009 - &#x221E 
```

这在 Firefox 2、3 和 Chrome 中完美运行。不过，IE7 向我展示了实际代码（如您在上面看到的），而不是我所期望的，而其他浏览器则显示：

```
© Copyright Mikle 2009 - ∞ 
```

这可能是一些愚蠢的事情，但这让我明白为什么 IE 会受到如此多的仇恨。我该如何解决？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-21T13:03:36.013

实体需要分号：

```
&#x00A9; 
```

在这种情况下，Firefox 错误地提供了过多的帮助。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-21T13:02:22.383

1.  使用十进制值。
2.  总是用 ; 终止实体 （分号）即使在上下文中也是可选的。
3.  尽可能使用命名实体。您的示例实体应写为`&copy;`© 和`&infin;`∞

* * *

另一种方法是忘记实体，只需将纯 UTF-8 字符放在那里。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-21T13:08:13.100

你不能用“ `&copy;`”吗？

[此页面](http://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references)包含常用符号的 HTML 代码列表。

# design-patterns - 模板方法和策略模式有什么区别？

> ID：669271
> 
> 赞同：188
> 
> 时间：2009-03-21T13:06:12.653
> 
> 标签：design-patterns, strategy-pattern, template-method-pattern

有人可以向我解释一下模板方法模式和策略模式有什么区别吗？

据我所知，它们 99% 是相同的——唯一的区别是模板方法模式有一个抽象类作为基类，而策略类使用由每个具体策略类实现的接口。

然而，就*客户*而言，它们以完全相同的方式被消耗——这是正确的吗？

* * *

## 回答 #1

> 赞同：170
> 
> 时间：2009-03-21T13:33:46.783

当特定操作具有一些可以根据其他不同的原始行为定义的不变行为时，使用模板模式。抽象类定义了不变的行为，而实现类定义了依赖的方法。

在一个策略中，行为实现是独立的——每个实现类都定义了行为，并且它们之间没有共享代码。两者都是行为模式，因此，客户以几乎相同的方式消费。通常策略有一个公共方法——`execute()`方法，而模板可以定义一组公共方法以及一组支持子类必须实现的私有原语。

这两种模式可以很容易地一起使用。您可能有一个策略模式，其中几个实现属于使用模板模式实现的一系列策略。

* * *

## 回答 #2

> 赞同：157
> 
> 时间：2009-03-21T14:15:04.563

两者的主要区别在于选择具体算法的时间。

使用**模板方法模式**，这通过*子类化模板在**编译时*发生。每个子类通过实现模板的抽象方法来提供不同的具体算法。当客户端调用模板外部接口的方法时，模板会根据需要调用其抽象方法（其内部接口）来调用算法。

 *```
class ConcreteAlgorithm : AbstractTemplate
{
    void DoAlgorithm(int datum) {...}
}

class AbstractTemplate
{
    void run(int datum) { DoAlgorithm(datum); }

    virtual void DoAlgorithm() = 0; // abstract
} 
```

相反，**策略模式允许在***运行时*通过*包含*来选择算法。具体算法由单独的类或函数实现，这些类或函数作为参数传递给策略的构造函数或 setter 方法。为此参数选择哪种算法可以根据程序的状态或输入动态变化。

```
class ConcreteAlgorithm : IAlgorithm
{
    void DoAlgorithm(int datum) {...}
}

class Strategy
{
    Strategy(IAlgorithm algo) {...}

    void run(int datum) { this->algo.DoAlgorithm(datum); }
} 
```

## 总之：

*   模板方法模式：通过**子类化选择****编译时**算法
***   策略模式：**包含****运行时算法**选择**

 ***** * *

## 回答 #3

> 赞同：30
> 
> 时间：2009-03-21T15:21:15.840

我认为这两种模式的类图都显示了差异。

**策略**
在类中封装算法
[链接到图像](http://www.dofactory.com/Patterns/Diagrams/strategy.gif) ![在此处输入图像描述](https://i.stack.imgur.com/jIjIF.gif)

**模板方法**
将算法的确切步骤推迟到子类
[Link to Image](http://www.dofactory.com/Patterns/Diagrams/template.gif) ![在此处输入图像描述](https://i.stack.imgur.com/z1N7Q.gif)

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2009-03-21T13:38:36.680

您可能是指模板方法模式。你是对的，它们满足非常相似的需求。如果您有一个“模板”算法具有定义的步骤，其中子类覆盖这些步骤以更改一些细节，我会说最好使用模板方法。在策略的情况下，您需要创建一个接口，而不是继承，您使用的是委托。我会说这是一个更强大的模式，并且根据 DIP - 依赖倒置原则可能更好。它更强大，因为您清楚地定义了一种新的策略抽象——一种做某事的方式，它不适用于模板方法。所以，如果这个抽象是有意义的——使用它。但是，使用模板方法可能会在简单的情况下为您提供更简单的设计，这也很重要。考虑哪些词更合适：你有模板算法吗？或者这里的关键是你有一个抽象的策略 - 做某事的新方法

模板方法示例：

```
Application.main()
{
Init();
Run();
Done();
} 
```

在这里，您从应用程序继承并替换将在 init、run 和 done 上完成的操作。

策略示例：

```
array.sort (IComparer<T> comparer) 
```

在这里，在编写比较器时，您不会从数组继承。Array 将比较算法委托给比较器。

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2016-09-12T14:02:40.207

[![策略与模板方法的区别模式策略与模板方法](https://i.stack.imgur.com/e5d0h.jpg)](https://i.stack.imgur.com/e5d0h.jpg)

* * *

## 相似之处

策略和模板方法模式之间有很多相似之处。策略模式和模板方法模式都可以用于满足开闭原则，使软件模块易于扩展而无需更改其代码。这两种模式都代表了通用功能与该功能的详细实现的分离。但是，它们在提供的粒度方面略有不同。

* * *

## 差异

以下是我在研究这两种模式时观察到的一些差异：

1.  在 Strategy 中，客户端和策略之间的耦合更加松散，而在 Template Method 中，这两个模块的耦合更加紧密。
2.  在Strategy中，主要使用接口，但也可以根据情况使用抽象类，不使用具体类，而在Template方法中，主要使用抽象类或具体类，不使用接口。
3.  在策略模式中，通常类的整个行为都用接口表示，另一方面，模板方法用于减少代码重复，样板代码定义在基础框架或抽象类中。在模板方法中，甚至可以有一个具有默认实现的具体类。
4.  简单来说，你可以在 Strategy 模式中改变整个策略（算法），但是，在 Template 方法中，只有一些东西改变（部分算法），其余的东西保持不变。在模板方法中，不变步骤在抽象基类中实现，而变体步骤要么被赋予默认实现，要么根本没有实现。在模板方法中，组件设计者要求算法的所需步骤和步骤的顺序，但允许组件客户端扩展或替换其中一些步骤。

* * *

图片取自[一口](http://www.bitesizedcsharp.com/)大小的博客。

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2009-03-21T13:32:43.807

继承与聚合（is-a 与 has-a）。这是实现同一目标的两种方法。

这个问题显示了选择之间的一些权衡：[继承与聚合](https://stackoverflow.com/questions/269496/inheritance-vs-aggregation)

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2012-01-25T20:03:53.970

两者都非常相似，并且都以相似的方式被客户端代码使用。与上面最受欢迎的答案不同，**两者都允许在运行时选择算法**。

两者之间的区别在于，虽然*策略模式*允许不同的实现使用完全不同的方式来实现预期的结果，但*模板方法模式*指定了一种用于实现结果的总体算法（“模板”方法）—— - 留给特定实现（子类）的唯一选择是所述模板方法的某些细节。这是通过让模板方法调用一个或多个被子类覆盖（即实现）的*抽象*方法来完成的，这与模板方法本身不是抽象的并且不会被子类覆盖.

客户端代码使用抽象类类型的引用/指针来调用模板方法，该引用/指针指向可以在运行时确定的具体子类之一的实例，就像使用策略模式时一样。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2016-02-10T06:38:20.653

*模板方法：*

1.  它基于*继承*
2.  定义不能被子类改变的算法骨架。在子类中只能覆盖某些操作
3.  父类完全*控制算法*，仅与具体类的某些步骤不同
4.  绑定在编译时完成

[模板](https://en.wikipedia.org/wiki/Template_method_pattern)方法结构：

[![在此处输入图像描述](https://i.stack.imgur.com/V8s9U.png)](https://i.stack.imgur.com/V8s9U.png)

*战略：*

1.  它基于*委托/组合*
2.  *它通过修改方法行为来改变*对象的内容**
**   它用于*在算法系列之间切换**   *它通过在运行时用另一种算法完全替换一种算法来*改变对象在运行时的行为**   绑定在运行时完成**

 **[策略](https://en.wikipedia.org/wiki/Strategy_pattern)结构：

[![在此处输入图像描述](https://i.stack.imgur.com/RHI6Q.png)](https://i.stack.imgur.com/RHI6Q.png)

查看[模板方法](http://www.journaldev.com/1763/template-method-design-pattern-in-java)和[策略](http://www.journaldev.com/1754/strategy-design-pattern-in-java-example-tutorial)文章以获得更好的理解。

相关文章：

[JDK中的模板设计模式，找不到定义要按顺序执行的方法集的方法](https://stackoverflow.com/questions/35559360/template-design-pattern-in-jdk-could-not-find-a-method-defining-set-of-methods/38740810#38740810)

[策略模式的真实示例](https://stackoverflow.com/questions/370258/real-world-example-of-the-strategy-pattern/35180265#35180265)

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2014-02-28T12:31:52.477

我建议你阅读[这篇](http://www.codeproject.com/Articles/695871/Comparison-of-Template-and-Strategy-Design-Pattern)文章。它解释了一个真实案例的差异。

**引用文章**

> ”*正如我们所看到的，实现类也依赖于模板方法类。如果要更改算法的某些步骤，这种依赖关系会导致更改模板方法。另一方面，策略完全封装了算法。它给出了实现类来完全定义一个算法。因此，如果有任何变化，确实需要更改以前编写的类的代码。这是我选择设计类的策略的主要原因。*
> 
> *模板方法的一个特点是模板方法控制算法。在其他情况下这可能是一件好事，但在我的问题中，这限制了我设计课程。另一方面，策略不控制算法的步骤，这使我能够添加完全不同的转换方法。因此，就我而言，策略有助于我实施。*
> 
> *策略的一个缺点是代码冗余过多，代码共享较少。正如在本文的示例中很明显，我必须一次又一次地在四个类中重复相同的代码。因此很难维护，因为如果我们的系统的实现（例如对所有人通用的第 4 步）发生更改，那么我将不得不在所有 5 个类中更新它。另一方面，在模板方法中，我只能更改超类，更改会反映到子类中。因此模板方法提供了非常低的冗余量和类之间的大量代码共享。*
> 
> *策略还允许在运行时更改算法。在模板方法中，必须重新初始化对象。策略的这一特性提供了很大的灵活性。从设计的角度来看，人们必须更喜欢组合而不是继承。因此使用策略模式也成为了发展的首要选择。”*

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-03-21T13:47:52.040

不，它们不一定以相同的方式消费。“模板方法”模式是一种为未来的实现者提供“指导”的方式。您是在告诉他们，“所有 Person 对象都必须有一个社会安全号码”（这是一个微不足道的例子，但它正确地理解了这个想法）。

策略模式允许切换**多种**可能的实现。它不是（通常）通过继承实现的，而是让调用者传入所需的实现。一个示例可能是允许为 ShippingCalculator 提供几种不同的税收计算方式之一（NoSalesTax 实现，可能还有 PercentageBasedSalesTax 实现）。

因此，有时，**客户端**实际上会告诉对象使用哪种策略。如在

```
myShippingCalculator.CalculateTaxes(myCaliforniaSalesTaxImpl); 
```

但是客户端永远不会为基于模板方法的对象这样做。事实上，客户甚至可能不知道一个对象是基于模板方法的。模板方法模式中的那些抽象方法甚至可能受到保护，在这种情况下，客户端甚至都不知道它们的存在。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2011-09-05T04:46:43.563

在策略模式中，子类正在运行并控制算法。这里的代码在子类中重复。该算法的知识以及如何实现它分布在许多类中。

在模板模式中，基类有算法。它最大化子类之间的重用。由于算法位于一个地方，基类保护它。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-05-07T05:12:01.580

模板模式类似于策略模式。这两种模式在范围和方法上有所不同。

策略用于允许调用者改变整个算法，例如如何计算不同类型的税，而模板方法用于改变算法中的步骤。因此，策略的粒度更粗。模板允许在后续操作中进行更细粒度的控制，但允许这些细节的实现发生变化。

另一个主要区别是策略使用委托，而模板方法使用继承。在 Strategy 中，算法被委托给另一个 xxxStrategy 类，主题将引用该类，但是使用 Template 您将基类子类化并覆盖方法以进行更改。

来自[http://cyruscrypt.blogspot.com/2005/07/template-vs-strategy-patterns.html](http://cyruscrypt.blogspot.com/2005/07/template-vs-strategy-patterns.html)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2016-02-16T05:38:41.767

# 模板模式：

模板方法是关于让子类重新定义算法的某些步骤，而不改变基类中定义的算法的主要结构和步骤。模板模式通常使用继承，因此可以在基类中提供算法的通用实现，如果需要，子类可能会选择覆盖它。

```
public abstract class RobotTemplate {
    /* This method can be overridden by a subclass if required */
    public void start() {
        System.out.println("Starting....");
    }

    /* This method can be overridden by a subclass if required */
    public void getParts() {
        System.out.println("Getting parts....");
    }

    /* This method can be overridden by a subclass if required */
    public void assemble() {
        System.out.println("Assembling....");
    }

    /* This method can be overridden by a subclass if required */
    public void test() {
        System.out.println("Testing....");
    }

    /* This method can be overridden by a subclass if required */
    public void stop() {
        System.out.println("Stopping....");
    }

    /*
     * Template algorithm method made up of multiple steps, whose structure and
     * order of steps will not be changed by subclasses.
     */
    public final void go() {
        start();
        getParts();
        assemble();
        test();
        stop();
    }
}

/* Concrete subclass overrides template step methods as required for its use */
public class CookieRobot extends RobotTemplate {
    private String name;

    public CookieRobot(String n) {
        name = n;
    }

    @Override
    public void getParts() {
        System.out.println("Getting a flour and sugar....");
    }

    @Override
    public void assemble() {
        System.out.println("Baking a cookie....");
    }

    @Override
    public void test() {
        System.out.println("Crunching a cookie....");
    }

    public String getName() {
        return name;
    }
} 
```

请注意，在上面的代码中，go() 算法步骤将始终相同，但子类可能会为执行特定步骤定义不同的配方。

# 策略模式：

策略模式是让客户端在运行时选择具体的算法实现。所有算法都是孤立和独立的，但实现了一个通用接口，并且没有在算法中定义特定步骤的概念。

```
/**
 * This Strategy interface is implemented by all concrete objects representing an
 * algorithm(strategy), which lets us define a family of algorithms.
 */
public interface Logging {
    void write(String message);
}

/**
 * Concrete strategy class representing a particular algorithm.
 */
public class ConsoleLogging implements Logging {

    @Override
    public void write(String message) {
        System.out.println(message); 
    }

}

/**
 * Concrete strategy class representing a particular algorithm.
 */
public class FileLogging implements Logging {

    private final File toWrite;

    public FileLogging(final File toWrite) {
        this.toWrite = toWrite;
    }

    @Override
    public void write(String message) {
        try {
            final FileWriter fos = new FileWriter(toWrite);
            fos.write(message);
            fos.close();
        } catch (IOException e) {
            System.out.println(e);
        }
    }

} 
```

如需完整的源代码，请查看我的 github[存储库](https://github.com/sahmed10315/Design-Patterns-Java/tree/master/Behavioral%20Patterns)。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-11-10T09:04:17.537

> 策略设计模式

*   支持合成。
*   为您提供在运行时更改对象行为的灵活性。
*   客户端代码和解决方案/算法代码之间的耦合更少。

> 模板方法设计模式

*   继承优于组合
*   在您的基类中定义算法。可以在子类中自定义各个算法。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-06-22T18:33:09.653

策略作为接口公开，模板方法作为抽象类公开。这通常在框架中大量使用。例如 Spring 框架的 MessageSource 类是一个解析消息的策略接口。客户端使用此接口的特定实现（策略）。

以及同一个接口AbstractMessageSource的抽象实现，它具有解析消息的通用实现，并暴露了resolveCode()抽象方法，以便子类可以按照自己的方式实现它们。AbstractMessageSource 是模板方法的一个示例。

[http://docs.spring.io/spring/docs/4.1.7.RELEASE/javadoc-api/org/springframework/context/support/AbstractMessageSource.html](http://docs.spring.io/spring/docs/4.1.7.RELEASE/javadoc-api/org/springframework/context/support/AbstractMessageSource.html)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-07-28T13:12:06.267

在此设计模式的模板方法中，一个或多个算法步骤可以被子类覆盖以允许不同的行为，同时确保仍然遵循总体算法（Wiki）。

模式名称模板方法意味着它是什么。假设我们有一个方法 CalculateSomething() 并且我们想要模板化这个方法。这个方法会在基类中声明一个非虚方法。说方法看起来像这样。

```
CalculateSomething(){
    int i = 0;
    i = Step1(i);
    i++;
    if (i> 10) i = 5;
    i = Step2(i);
    return i; 
```

} Step1 和 Step2 方法实现可以由派生类给出。

在 Strategy Pattern 中，base 没有提供实现（这就是为什么 base 在类图中实际上是一个接口的原因）

经典的例子是排序。根据需要排序的对象数量，创建适当的算法类（合并、气泡、快速等），并将整个算法封装在每个类中。

现在我们可以将排序实现为模板方法吗？当然可以，但是您不会发现太多/任何共性被抽象出来并放置在基本实现中。所以它违背了模板方法模式的目的。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-12-28T23:27:18.493

我认为主要区别在于，使用模板您需要一个算法来做某事，但是让我们说在该算法的中间您想要运行不同的行为，以便您可以发送接口的实现以在运行时动态地使该算法。

但是使用策略，您实际上拥有完全不同的算法执行，而不仅仅是算法的变体，然后您选择运行哪个算法，但是模板您只有一个带有变体的算法。

最后，您可以根据需要实施并将模板用作策略，反之亦然，但我看到了不同之处。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-01-14T09:23:53.493

模板方法模式擅长阐明整体算法步骤，而策略模式适合灵活性和可重用性，因此您可以根据需要将策略组合在一起，例如：jdk8中的许多功能接口就像`Comparator.reversed().thenComparing(Comparator)`是策略的角色。

模板方法模式关注更高的内聚，而策略模式与上下文对象松散耦合以分离关注点。

策略很容易维护，因为上下文不知道具体的策略，只要上下文中的主要算法发生变化，就不会影响策略。另一方面，如果您在抽象模板类中更改了算法的骨架，可能会影响其子类的升级。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-03-28T12:46:48.367

它们都是不同的技术来达到相同的结果，所以问题是什么时候使用。

*   如果您正在使用无法访问源代码的框架或库，并且想要更改类的某些行为，那么您必须使用模板方法。这意味着简单的继承。
*   如果您正在开发一个类，并且很明显某些部分的逻辑需要以不同的方式实现以处理各种情况，请采用策略模式。策略比模板方法更可靠。它涵盖了依赖倒置和打开/关闭原则。所以它是可扩展的，也很容易测试。
*   如果您正在开发一个类，并且您不知道将来会发生什么变化，请尽可能将您的逻辑划分为单独和单一的负责函数。只是。（既不是模板方法也不是策略）。

# php - 数据库中的日期时间值落后三个小时

> ID：669287
> 
> 赞同：0
> 
> 时间：2009-03-21T13:16:57.993
> 
> 标签：php, mysql, datetime, timezone

我`DATETIME`用作列类型并`NOW()`用于插入。当它打印出来时，它落后了三个小时。我该怎么做才能比美国东部标准时间提前三个小时工作？

我正在使用 php date`DATETIME`在我的页面上格式化。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T13:21:28.530

如果使用 NOW() 存储在数据库中的日期不正确，则需要将[MySQL 服务器设置更改为正确的 timezone](http://dev.mysql.com/doc/refman/5.1/en/time-zone-support.html)。如果仅在打印后不正确，则需要[修改 php 脚本以使用正确的 timezone](http://nl3.php.net/manual/en/function.date-default-timezone-set.php)。

编辑：

有关如何使用 date() 格式化日期的信息，请参阅[W3schools 的方便的 php 日期概述。](http://www.w3schools.com/php/func_date_date.asp)

编辑2：

要么让 GoDaddy 更改设置（值得怀疑），要么在插入表格时增加 3 小时。当您在表中设置日期时，请参考[MySQL 日期添加功能来修改您的日期。](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_date-add)像 date_add(now(), interval 3 hour) 这样的东西应该可以工作。

您的确切问题在[此处](http://www.webmasterworld.com/forum88/3069.htm)描述。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T14:52:00.963

看看gmdate [()](http://us.php.net/gmdate)和[gmmktime()](http://us.php.net/gmmktime)。如果您使用 GMT，我发现时间戳算法会更容易，特别是如果您的代码在多台机器上运行，或者修改 MySQL 服务器设置不是一个选项，或者您最终处理不同的时区、夏令时等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-26T15:44:42.450

我建议在 UTC 时区插入日期。这将在未来为您省去很多麻烦（夏令时问题等......）

```
"INSERT INTO abc_table (registrationtime) VALUES (UTC_TIMESTAMP())" 
```

当我查询我的数据时，我使用以下 PHP 脚本

```
<?  while($row = mysql_fetch_array($registration)){ 

  $dt_obj = new DateTime($row['message_sent_timestamp']." UTC");
  $dt_obj->setTimezone(new DateTimeZone('Europe/Istanbul'));
  echo $formatted_date_long=date_format($dt_obj, 'Y-m-d H:i:s'); } ?> 
```

您可以在此处将 datetimezone 值替换为可用的[php 时区](http://us3.php.net/manual/en/timezones.php)之一：

# xml - XSLT 基于输入 XML 的十进制格式

> ID：669291
> 
> 赞同：0
> 
> 时间：2009-03-21T13:19:30.140
> 
> 标签：xml, xslt, formatting, decimal, xslt-1.0

我有一种情况，我的 XSLT 文件应该有条件地显示价格和小数，这取决于输入 XML 是否包含小数。所以，我可以接收具有两种类型值的 XML 文件 - XML 将包含所有以小数格式格式化的价格，最多两位（我称之为“十进制 XML”），或者价格将四舍五入到最接近的整数（我称之为一个“整数-XML”）。

我的问题是我需要在 XSLT 文件中尽可能少地重构，但允许它们以与 XML 输入相同的格式将转换应用于 XHTML。为了做到这一点，我实施并向我的团队提出了三个指导方针：

1.  `format-number()`当计算值以进行计算或存储在变量中时，删除所有函数调用。改为使用`number(<value>)`。但是，某些条件适用于该规则（见下文）。
2.  当要显示值时，使用`format-number(<value>, '#.##')`格式。这应该确保整数或十进制值将显示为 XML 中的原始值。
3.  对于可选标签（例如“折扣”），`format-number(<value>, '0.00')`即使只是计算值，也要使用该函数。这是必要的，因为如果标签不存在，尝试获取值将给出`NaN`结果。

这是 XSLT 的说明性示例：

```
 <x:stylesheet version="1.0" xmlns:x="http://www.w3.org/1999/XSL/Transform">
  <x:template match="/">
    <html>
      <body>
        <table border="1" width="60%">
          <tr>
            <th>Simple</th>
            <th>number()</th>
            <th>format-number(&lt;expression&gt;, '0.00')</th>
            <th>format-number(&lt;expression&gt;, '#.##')</th>
          </tr>
          <x:apply-templates />
        </table>
      </body>
    </html>
  </x:template>

  <x:template match="Item">
    <x:variable name="qty" select="number(@numItems)" />
    <x:variable name="cost" select="number(ItemCost) * $qty" />
    <x:variable name="extraCharges" select="(number(Tax) + number(TxnFee)) * $qty"/>
    <x:variable name="discount" select="format-number(Discount, '0.00') * $qty"/>
    <tr>
      <td>
      <!-- Works for Integer-XML, but values in Decimal-XML are
      *sometimes* rendered upto 14 decimal places. Even though Quickwatch
      shows it correctly in the debugger in VS. I cannot figure out what's
      special about the error cases. -->
        <x:value-of select="$cost + $extraCharges - $discount"/>
      </td>
      <td>
        <!-- Works same as the above case. -->
        <x:value-of select="number($cost + $extraCharges - $discount)"/>
      </td>
      <td>
      <!-- Works for Decimal-XML, but values in Integer-XML are always
      rendered with decimal digits. -->
        <x:value-of select="format-number(($cost + $extraCharges - $discount), '0.00')"/>
      </td>
      <td>
      <!-- Works for Integer-XML, but some values in Decimal-XML are
      rendered incorrectly. For example, 95.20 is rendered as 95.2;
      95.00 is rendered as 95 -->
        <x:value-of select="format-number(($cost + $extraCharges - $discount), '#.##')"/>
      </td>
    </tr>
  </x:template>
</x:stylesheet> 
```

正如 HTML 注释所指出的，它在大多数情况下都有效，但不是全部。

我想使用单个表达式来格式化与输入相同的所有价格，而不是在任何地方应用“when-otherwise”构造，这将另外需要传递给 XSLT 的布尔参数来确定显示格式。XSLT 的当前状态是，无论输入如何，所有数字都被四舍五入，使用`format-number(<expression>, '0')`.

我该如何做到这一点？

* * *

**编辑：**在 Dimitre 的评论之后，我决定创建一个示例 XML（以及上面的 XSLT），以便专家可以轻松地试用它。

示例 XML（这个包含小数）：

```
<ShoppingList>
  <Item numItems="2">
    <ItemCost>10.99</ItemCost>
    <Tax>3.99</Tax>
    <TxnFee>2.99</TxnFee>
    <Discount>2.99</Discount>
  </Item>
  <Item numItems="4">
    <ItemCost>15.50</ItemCost>
    <Tax>5.50</Tax>
    <TxnFee>3.50</TxnFee>
    <Discount>3.50</Discount>
  </Item>
</ShoppingList> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-22T10:59:57.567

如果我理解正确，你想要：

*   "Integer-XML" 总是显示为一个四舍五入的数字，没有小数位
*   "Decimal-XML" 总是显示两位小数
*   不要使用进行格式化的模板，而是使用 XPath 单线

你得到的最接近你想要的是这个表达式：

```
<xsl:value-of select="
  format-number($cost + $extraCharges - $discount, '0.00')
" /> 
```

由于 XPath 1.0 中没有易于使用的条件表达式（[XPath 2.0 有`if/then/else`](http://www.w3.org/TR/xpath20/#id-conditionals)），因此折衷方案是：

```
<xsl:value-of select="
  substring-before(
    concat(format-number($cost + $extraCharges - $discount, '0.00'), '.00')
    , '.00'
  )
" /> 
```

`$cost`但是，当,`$extraCharges`和`$discount`加起来是一个整数时，这个“失败”（截断小数） 。

没有吸引力的替代方法是使用 Becker 方法（以[HU Berlin的](http://www.informatik.hu-berlin.de/)[Oliver Becker](http://www2.informatik.hu-berlin.de/~obecker/XSLT/)命名）：

```
concat(
  substring($s1, 1, number($condition)      * string-length($s1)),
  substring($s2, 1, number(not($condition)) * string-length($s2))
) 
```

从技术上讲，这是一个单行。这两个`sub-string()`部分基于 是互斥的`$condition`，因此`concat()`只会返回一个值或另一个值。

实际上（尤其是对于您的情况），这将是一个无法控制的混乱，缓慢且完全隐藏了意图：

```
concat( 
  substring(
    format-number($cost + $extraCharges - $discount, '0.00')
    , 1
    , number(
      contains($cost, '.')
    ) * string-length(format-number($cost + $extraCharges - $discount, '0.00'))
  ),
  substring(
    format-number($cost + $extraCharges - $discount, '#.##')
    , 1
    , number(
      not(contains($cost, '.')) 
    ) * string-length(format-number($cost + $extraCharges - $discount, '#.##'))
  )
) 
```

由于您声明所有输入值都包含小数，或者都不包含小数，因此上述表达式仅检查是否`$cost`包含小数点。检查是正确的`$extraCharges`，`$discount`我猜也是。

# continuous-integration - 带 VSS 的 CruiseControl - 检查所有文件

> ID：669293
> 
> 赞同：0
> 
> 时间：2009-03-21T13:21:30.463
> 
> 标签：continuous-integration, cruisecontrol.net, visual-sourcesafe

我有巡航控制和 VSS 6.0。我已经在 IfModificationExists 条件下每小时配置一次巡航控制。

它检查修改并获取源，但它检查 VSS 中的所有文件。即我的VSS 包含1000 个文件，只有1 个文件被修改。CCNet 检测到 1 处修改，但使用我的本地检查 VSS 中的所有文件。由于脚本每次运行很长时间。

是否有任何选项可以仅获取修改后的文件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T19:13:47.543

好的，我冒着在这里有很多反对票的危险，但从长远来看，我真的想提供帮助。我已将我的答案标记为“社区维基”，以便证明我的意图是高尚的。

我不知道你问的问题的答案。我有义务尝试告诉您，但不想听起来教条，您可能会考虑切换到另一个版本控制系统。我不会说哪个，虽然我不禁说我正在使用带有 CruiseControl.NET 的 Subversion，它工作得非常好。

如果您访问“CruiseControl.NET：Visual Source Safe Source Control Block” [文档页面](http://ccnet.net.henu.edu.cn/ccnet/doc/CCNET/Visual%20Source%20Safe%20Source%20Control%20Block.html)，他们甚至在底部有一个部分：您可能想要考虑不同版本控制系统的原因。我想这意味着什么。

# java - 生产者/消费者应用程序的设计

> ID：669294
> 
> 赞同：0
> 
> 时间：2009-03-21T13:22:55.267
> 
> 标签：java, multithreading, concurrency

我有一个生成索引的生产者应用程序（将其存储在一些内存树数据结构中）。消费者应用程序将使用索引来搜索部分匹配项。

我不希望消费者 UI 在生产者索引数据时必须阻止（例如通过一些进度条）。基本上，如果用户希望使用部分索引，它就会这样做。在这种情况下，生产者可能不得不停止索引一段时间，直到用户离开另一个屏幕。

粗略地说，我知道我需要等待/通知协议来实现这一点。我的问题：是否可以在生产者线程进行业务时使用等待/通知来中断生产者线程？我需要什么 java.util.concurrent 原语来实现这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T13:35:26.873

按照您描述的方式，您没有理由需要等待/通知。只需同步访问您的数据结构，以确保它在访问时处于一致状态。

编辑：通过“同步访问”，我并不是指同步整个数据结构（最终会阻塞生产者或消费者）。相反，仅同步正在更新的那些位，并且仅在您更新它们时同步。您会发现生产者的大部分工作都可以以非同步方式进行：例如，如果您正在构建一棵树，您可以识别需要插入的节点，在该节点上同步，进行插入，然后继续。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T13:51:31.157

生产者应用程序可以有两个索引：已发布和工作中。生产者只能在工作中工作，消费者只能在已发布的情况下工作。一旦生产者完成索引，它可以用已发布的替换工作中的一个（通常交换一个指针）。如果会带来价值，生产者也可以发布部分索引的副本。这样您将避免长期锁定——当失去消费者访问索引时它会很有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T14:06:47.203

不，那是不可能的。

在线程本身没有任何显式代码的情况下通知线程的唯一方法是使用 Thread.interrupt()，这将导致线程中的异常。虽然 interrrupt() 通常不是很可靠，因为在代码中的某个随机点抛出异常是在所有代码路径中正确处理的噩梦。除此之外，线程某处（包括您使用的任何库）中的单个 try{}catch(Throwable){} 就足以吞下信号。

在大多数情况下，唯一正确的解决方案是使用共享标志或消费者可以用来将消息传递给生产者的队列。如果您担心生产者没有响应或冻结，请在单独的线程中运行它并要求它每 n 秒发送一次心跳消息。如果它没有发送心跳，就杀死它。（请注意，确定生产者是否真正冻结，而不仅仅是等待外部事件，通常也很难正确处理）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T03:37:19.720

在您的生产者线程中，您可能有某种主循环。这可能是打断制片人的最佳场所。我建议你使用 java 5 中引入的 java 同步对象，而不是使用 wait() 和 notify()。

你可能会做这样的事情

```
class Indexer {

   Lock lock = new ReentrantLock();    

    public void index(){
        while(somecondition){
            this.lock.lock();
            try{
                // perform one indexing step
            }finally{
                lock.unlock();
            }
        }
    }

    public Item lookup(){
        this.lock.lock();
        try{
            // perform your lookup
        }finally{
            lock.unlock();
        }
    }
} 
```

您需要确保每次索引器释放锁时，您的索引都处于一致、合法的状态。在这种情况下，当索引器释放锁时，它会为新的或等待的 lookup() 操作留下机会来获取锁、完成并释放锁，此时您的索引器可以继续执行下一步。如果当前没有 lookup() 正在等待，那么您的索引器只需重新​​获取锁本身并继续其下一个操作。

如果您认为您可能有多个线程同时尝试进行查找，您可能需要查看 ReadWriteLock 接口和 ReentrantReadWriteLock 实现。

当然，这个解决方案是简单的方法。它将阻塞任何一个没有锁的线程。您可能想检查是否可以直接在数据结构上同步，但这可能会很棘手，因为构建索引往往会使用某种平衡树或 B-Tree 或其他节点插入远非微不足道的东西。

我建议您首先尝试这种简单的方法，然后看看它的行为方式是否适合您。如果没有，您可以尝试将索引步骤分解为更小的步骤，或者尝试仅在数据结构的某些部分上进行同步。

不要太担心锁定的性能，在java中非竞争锁定（当只有一个线程试图获取锁定时）很便宜。只要您的大部分锁定不满足，锁定性能就无需担心。

# .net - 从 .net Web 应用程序在哪里登录？- 由于特权，无法使用 %APPDATA%

> ID：669295
> 
> 赞同：2
> 
> 时间：2009-03-21T13:22:57.980
> 
> 标签：.net, security, logging, log4net

我需要一个可以在 log4net 文件附加程序中指定的路径，以便日志文件可以去那里。但是，aspnet 或任何帐户都没有对 %APPDATA% 文件夹的写入权限。有没有我可以写信而不要求客户管理员提供额外访问权限的地方？Path.GetTempFile() 可能不是一个好主意。我需要一些可以告诉用户查看的已定义位置，以及 Web 应用程序也可以从中读取的位置。关于如何实现我需要的任何其他想法？

**我想强调：重点是不要问客户任何事情！**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T15:21:14.607

嘿，我确实想到了一些东西。呃……我觉得有点傻，没有早点提到这一点。如果您的应用程序正在与数据库通信，您可以在其中为日志创建一个或多个表。有写入数据库的 log4net 附加程序。我确定如果您使用的是数据库，那么权限问题已经解决。数据库中的日志条目有一些优点（也有一些缺点）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T15:22:24.887

在我当前的应用程序中，安装程序（使用 Windows Installer XML 构建的 .msi）创建了一个用于日志输出的可写文件夹（以及一个用于压缩所有日志文件并在出现问题时将它们发回给我的工具）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T16:10:51.650

使用 EventLogAppender 的系统事件日志呢？这对你来说是一个选择吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T13:38:42.263

据我所知，默认情况下，ASPNET 用户没有写入权限的地方。根据设计，它作为一个非常有限的帐户开箱即用。我认为必须进行一些管理更改，尽管有一些方法可以使它们自动化，这样您的客户就不必手动进行。例如，它们可以放置在您提供的脚本中，当然也可以内置到安装程序中。我敢肯定，您仍然希望确保您的客户能够接受这些更改，具体取决于他们对安全性或 IT 的意识。我希望我能想出一种方法让你做你想做的事，但没有别的想法。

# windows - 理想的后台文件系统备份

> ID：669302
> 
> 赞同：5
> 
> 时间：2009-03-21T13:31:33.217
> 
> 标签：windows, linux, backup, filesystems, background

我正在考虑一个可以在后台运行的脚本/程序，并尝试将给定的文件系统路径备份或同步到镜像位置（可能位于外部/单独的存储设备上）。

这应该适用于 Windows，但也可以在 Linux 下使用。

*   差异/增量备份是一个奖励。
*   Windows 系统状态备份也是一个好处。
*   保持源头没有元数据是必不可少的。（与版本控制不同）
*   按文件或活动日期搜索可能很有趣（如版本控制）
*   备份存储库应该易于浏览且占用空间小。
*   删除的文件应该可以在一段时间内恢复。
*   Windows 备份乏味、臃肿且有限。
*   Tar-gzipping 不可访问。
*   备份期间的用户交互应该不存在。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T16:03:29.920

[Amanda](http://www.amanda.org/)是终极的全功能开源备份解决方案，并且有一个（相对）新的[Zmanda Windows 客户端](http://wiki.zmanda.com/index.php/Zmanda_Windows_Client)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T13:44:15.543

[Duplicity](http://duplicity.nongnu.org/)是免费的，可以创建加密的、增量的、压缩的异地备份。这是一个 linux 应用程序，但您可以在 cygwin 或小型虚拟机中运行它。

我编写了一个 perl 脚本，通过 cronjob 运行它以通过 DSL 备份几个非常大的目录，并且效果很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T13:38:37.053

查看[AJCBackup](http://www.ajcsoft.com/index.php)。以优惠的价格完成出色的工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T15:40:01.707

**Acronis True Image**很棒。它不是免费的，但家庭版的功能相当便宜，而且运行可靠。基于图像和文件的备份、计划、从资源管理器上下文菜单访问的所选文件夹的即时备份、增量/差异备份、可以将备份文件挂载为 Windows 卷并浏览它们、复制文件等。已经好几次了。

# c# - 在为 COM 互操作注册的 ac# 程序集中调用简单方法时出现“类型不匹配”错误

> ID：669303
> 
> 赞同：0
> 
> 时间：2009-03-21T13:32:31.653
> 
> 标签：c#, com, interop, type-mismatch

我已经使用 c# 和 .net framework 3.5 构建了一个类库。在我的类库中有一个名为 Utilities 的类，它有两种方法。

```
public string Method1(int length)
{
}

public string Method2(int length, string aStringParameter)
{
} 
```

现在我去构建一个简单的 asp 页面来调用我的方法。Method1 像魅力一样工作。Method2 导致“类型不匹配”错误。我在这里想念什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T13:57:13.920

试着放

```
 MarshalAs(UnmanagedType.BStr) 
```

对于您传递给方法 2 的字符串类型。

[这里](http://msdn2.microsoft.com/en-us/library/aa645736(VS.71).aspx)有一个详细的解释。

# jasper-reports - 子报表中的子报表 (IReport-JasperReports)

> ID：669314
> 
> 赞同：0
> 
> 时间：2009-03-21T13:35:43.393
> 
> 标签：jasper-reports, ireport

我有一个需要在子报表中包含子报表的要求。有我可以参考的示例代码吗？

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T06:48:00.897

您实际上根本不需要任何代码来在子报表中生成子报表。这可以通过没有动态组件（详细信息带中没有）的报告来完成。当然，生成的报告对于任何有趣的事情都没有多大用处。

如果您想要一个比这更有趣的报告，您需要为报告和/或子报告提供数据。届时，代码将根据您的数据来自何处而有所不同。如果您可以提供有关您正在尝试做的事情的更多信息，我们也许可以提供更多帮助。

如果子报表具有动态内容，您将需要向其传递对实现 JRDataSource 的对象的访问权。

例如，我最近创建了一个单页报告，其中包含多个“子句”。为了让我的生活更简单，我将子句存储在 Map 中，并使用以下代码派生 JRDataSource 对象。然后将 JRDataSource 对象作为主报告的字段传入。

```
private static class ListMapDataSource implements JRRewindableDataSource {

    private Map currentMap = null;
    private int currentRow;
    private int numberOfMoveFirsts = 0;
    private List<Map<String, ? extends Object>> rowList;

    ListMapDataSource(List<Map<String, ? extends Object>> rowList) {
        this.rowList = rowList;
        moveFirst();
    }

    ListMapDataSource(Map<String, ? extends Object> singleRow) {
        this.rowList = new ArrayList<Map<String, ? extends Object>>(1);
        this.rowList.add(singleRow);
        moveFirst();
    }

    public boolean next() throws JRException {
        if (currentRow >= rowList.size() - 1) {
            return false;
        }

        currentRow++;
        currentMap = rowList.get(currentRow);

        return true;
    }

    public Object getFieldValue(JRField jrField) throws JRException {
        String name = jrField.getName();
        Class valueClass = jrField.getValueClass();

        if (JasperReport.class.isAssignableFrom(valueClass)) {
        }

        return currentMap.get(name);
    }

    public void moveFirst() {
        numberOfMoveFirsts++;

        if (numberOfMoveFirsts > 10) {
            System.out.println("Exceeded 10 moveFirst() calls.  Aborting.");
            System.exit(1);
        }

        currentRow = - 1;
        currentMap = null;
    }
} 
```

# biztalk - 帮助业务规则

> ID：669316
> 
> 赞同：0
> 
> 时间：2009-03-21T13:36:21.020
> 
> 标签：biztalk, business-rules

我有一个节点集，其中包含具有唯一值的各种数量的节点。如果节点集包含具有某些可能值的节点，我希望触发规则。

示例：包含一个节点集的实例，其中一个节点 Y=1 和另一个 Y=2 节点应该触发规则。

应该触发的实例：
- X
- - Y - 1
- - Y - 2
- - Y - 3
- - Y - 4

不应触发的实例：
- X
- - Y - 1
- - Y - 3
- - Y - 4

我尝试使用 AND、OR 和其他方法，但“问题”是，由于引擎进行模式匹配，它会测试每个节点的条件，它要么总是触发，要么永远不会触发。

这不是那么复杂的问题。有多难 :) 当我找到“一组价值观”时，我以为我是安全的，但那更多的是“枚举”。感谢任何建议。

问候马丁带来

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-09T16:49:33.707

尝试按照您将在[此处](http://timrayburn.net/blog/timrayburn-customfunctoids-logical-xor/)找到的内容 它创建一个异或（当这个*或*那个*但不是*这个*和*那个）功能。并不是说它会为您解决问题，但它可能会帮助您走上正轨。

# delphi - Delphi - TClientDataset 线程安全吗？

> ID：669319
> 
> 赞同：10
> 
> 时间：2009-03-21T13:37:01.160
> 
> 标签：delphi, tclientdataset

我有一个在线程 1 中管理的 TClientDataset。

在另一个线程中，我有一个 TClientDataset 的克隆图像。

我会遇到线程问题吗？

**编辑**

克隆的图像以只读模式使用。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-07-10T22:39:12.987

简短的回答是否定的，ClientDataSet 不是线程安全的。更复杂的答案是，这取决于你如何使用它。无论您拥有多少个 ClientDataSet 克隆，只要您只读取数据，它们就可以安全地从多个线程中使用。即使您设置不同的范围、当前记录、过滤器等，也是如此。

而且，尽管您没有问过这个问题，但您可以释放任何克隆的 ClientDataSet，甚至是克隆的原始 ClientDataSet，而不会出现问题。

另一方面，如果需要向任何克隆发布记录或重新加载数据，则必须使用同步对象。如果更改很少，则 TMultiReadExclusiveWriteSynchronizer 类非常适合用于此目的。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-21T15:52:24.627

一句话：没有。

所有的 VCL 都应该被认为是“线程不安全的”。对 TThread 中可视组件的任何调用都应在 Synchronize 事件中进行。

任何 VCL/RTL 类都应该完全在 TThread 中创建和销毁。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-21T13:52:44.977

克隆过程应该使用 TCriticalSection 来处理，但是每个 TClientDataSet 在自己的线程中都应该没问题。

# programming-languages - 什么是编程语言上下文中的演员模型？

> ID：669323
> 
> 赞同：9
> 
> 时间：2009-03-21T13:38:49.300
> 
> 标签：programming-languages, actor-model

我已经在 Erlang 演员模型、Groovy 演员、Scala 演员模型等上下文中的多个地方看到过它。这是指什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T13:44:27.570

我认为[维基百科](http://en.wikipedia.org/wiki/Actor_model)总结得最好：

> Actor模型采用了万物皆为Actor的理念。这类似于某些面向对象编程语言使用的一切都是对象哲学，但不同之处在于，面向对象软件通常是按顺序执行的，而 Actor 模型本质上是并发的。*[snip]* Actor 模型是关于消息传递的语义。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2017-10-03T22:09:47.733

前段时间我写了[这篇博](https://monades.roperzh.com/get-to-know-the-actor-model/)文，解释了模型的基本概念，并用 JavaScript 构建了一个基本的实现。从帖子：

> 在 Actor 模型中，Actor 是您构建应用程序结构的基础，它具有对外部世界不可见的内部状态，并通过异步消息与其他 Actor 交互。
> 
> 如果这听起来很像面向对象编程 (OOP)，那么您是对的。Actor 模型可以被认为是对消息进行特殊处理的 OOP：它们异步传递并由接收者同步执行。
> 
> 每个参与者都有一个唯一的地址，您可以通过该地址向其发送消息。当消息被处理时，它与参与者的当前行为相匹配；这只不过是一个函数，它定义了为响应消息而要采取的行动。作为对消息的响应，参与者可以：
> 
> *   创造更多的演员。
> *   向其他参与者发送消息。
> *   指定内部状态来处理下一条消息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2019-05-22T22:04:29.523

**Actor 模型**的主要思想是将 Actor 作为并发计算的原语进行管理。Actor 可以向其他 Actor 发送消息，接收消息并对消息做出反应并产生新的 Actor。

这里的**关键思想**是通过消息进行通信，而不是在不同线程之间共享内存。

重要的是要补充一点，Actor 是**异步**和**并发**的，但它们**不能保证消息的顺序或时间限制**，即何时可以对消息采取行动（因此不能将原子事务拆分为 Actor）。

Actor模型的使用主要适用于两种情况：

*   当可以将您的解决方案分解为一组独立的任务时。
*   当您可以将解决方案分解为一组由清晰的工作流程链接的任务时。

插图：

[![在此处输入图像描述](https://i.stack.imgur.com/Vgvje.png)](https://i.stack.imgur.com/Vgvje.png)

# java - “找不到符号变量 VK_NEXT”

> ID：669325
> 
> 赞同：0
> 
> 时间：2009-03-21T13:42:21.240
> 
> 标签：java

我的代码说它找不到 VK_NEXT。它可以很好地找到所有其他 VK_ 按钮，但不是这个。是否有另一个 VK_ 让我使用向下翻页按钮？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T13:53:31.683

KeyEvent 中没有定义 VK_NEXT。也许你的意思是[VK_PAGE_DOWN](http://java.sun.com/javase/6/docs/api/java/awt/event/KeyEvent.html#VK_PAGE_DOWN)？

# c# - 数据绑定到网格时限制 LINQ 子查询

> ID：669336
> 
> 赞同：2
> 
> 时间：2009-03-21T13:50:05.217
> 
> 标签：c#, linq, linq-to-sql

我想限制我返回的子元素的数量。在此示例中，Order.CustomerID "VINET" 有 3 个订单详细信息。我只想查看单价为 14 的记录。我不想查看单价等于 9.8 或 43.8 的订单详情

最后，我想在动态 where 查询或谓词中执行此操作，但简单的示例应该显示我的问题。我尝试了几种不同的方法，包括下面显示的两种。我意识到问题在于 LINQ 在我扩展时会自动运行自己的查询，但是有人有好的解决方案吗？

```
private void btnJoinProblem_Click(object sender, EventArgs e)
{
NorthwindDataContext db = new NorthwindDataContext();
var tempQ2 = (from od in db.Order_Details   
join o in db.Orders on od.OrderID equals o.OrderID
where od.UnitPrice == 14
select o).Distinct();
} 
```

还会在订单详细信息级别带回太多子记录

```
NorthwindDataContext db = new NorthwindDataContext();
var tempQ = from o in db.Orders 
            where o.Order_Details.Any(od => od.UnitPrice == 14) 
            select o;

var bindingSource = new BindingSource();
bindingSource.DataSource = tempQ;
ultraGrid1.DataSource = bindingSource; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T14:08:10.617

尝试绑定到 a`BindingSource`并`AsDataView()`在您的查询上使用并查看是否有效，如下所示：

```
var bindingSource = new BindingSource();
bindingSource.DataSource = tempQ.AsDataView(); 
```

当然，不要忘记将网格的数据源设置为`BindingSource`.

快速说明：`AsDataView()`如果有连接，则不能使用。IIRC，以下*应该可以*工作：

```
var tempQ = from o in db.Orders
            where o.Order_Details.Any(od => od.UnitPrice == 14)
            select o; 
```

请注意，您可能想要使用子关系 o.Order_Details，而不是 db.Order_Details（假设它在您的数据集中正确设置）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T20:01:34.510

好吧，我要做的第一件事是“选择”您想要的列到匿名类型（或命名类型）中 - 这意味着您正在获取矩形数据，并且您不必担心延迟加载. 其次，您需要一个网格列表。

尝试类似：

```
using(NorthwindDataContext db = new NorthwindDataContext()) {
    var query= from od in db.Order_Details   
               join o in db.Orders on od.OrderID equals o.OrderID
               where od.UnitPrice == 14
               select new {o.OrderId, o.Customer.CustomerName,
                          od.UnitPrice}; // etc

    ultraGrid1.DataSource = query.Distinct().ToList();
} 
```

# xml - UTF8、ISO-8859-x 或 7 位 ASCII 和实体

> ID：669337
> 
> 赞同：0
> 
> 时间：2009-03-21T13:51:07.570
> 
> 标签：xml, xhtml

您对在 XHTML 和 XML 中编码重音字符和特殊字符有何看法。

*   您是否将每个非 US-ASCII 字符都转换为命名实体？
*   您使用 ISO-8859-x 或 Win-125x 并编码为其他实体？
*   还是您直接用 UTF-8 编写所有内容，而不用担心实体？

请详细说明是哪个以及**为什么**。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-21T13:59:48.470

我不能确切地告诉你为什么会发生这种情况，但是在我为每个网页使用 UTF-8 的 5 年经验中（我主要使用西里尔文和波罗的海符号），我还没有看到任何字符显示不正确。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-21T14:11:43.527

UTF-8。

它的设计完全是为了解决 kdgregory 提到的 UTF-16 出现的问题，它做得非常好。今天几乎每个编辑器（包括记事本）都支持 UTF-8，它也是 XML 的默认编码。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-21T14:03:24.060

不要打扰命名实体。当您需要手动编辑 HTML 文件并希望能够读取字符并且没​​有 UTF-8 编辑器时，它们非常适合。但除此之外，UTF-8 是要走的路。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-21T14:07:29.900

我总是直接用utf8写。在此期间我遇到的唯一问题是服务器强制对标头进行 iso 编码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-21T19:53:11.457

始终为您的站点使用 UTF-8

1.  现代框架和数据库服务器在支持 UTF-8 方面没有异议/问题。

2.  当有人以与预期不同的语言输入文本并且您得到 ?????? 时，您将避免问题 而不是一些 unicode 符号，甚至在页面模板没有被渲染时甚至更糟。

3.  即使您的网站被标记为一种没有多语言界面的语言（将来也是如此），有人可能会在您的网站上发布材料并以他们自己的语言从他的朋友那里获得评论。

问候， 帕维尔

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T14:05:54.383

从美国人的角度来说：几乎所有文本都是 US-ASCII，带有一些符号和重音字符，我强烈建议使用数字或命名实体。

原因很简单：少了一件需要担心的事情。您无需确保您的网络服务器设置为宣传与您的内容相同的编码。因为迟早会有人在 Windows 上编辑页面，使用 Cp1252 编码，而其他人在 Linux 上使用 ISO-8859 工作，虽然两者很接近，但它们并不相同。如果网络服务器配置为 UTF-8，它们都会损坏。

也就是说，我给了 Sergej +1，因为如果您正在处理主要不是 ASCII 的文本，您不想要大量的实体。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-22T04:11:04.850

我个人总是使用 UTF-8。它得到了很好的支持，并且每种语言、操作系统和浏览器都以某种方式支持它。实体很容易显示，但编辑起来很麻烦。命名实体可以引用很多字符，但只会涵盖西方字符集。对于亚洲语言，您将不得不回到十六进制实体，这并不漂亮。无论如何，十六进制实体也必须使用 Unicode 表进行解码或编码，因此您可能希望首先使用 unicode 风格对文本进行编码。

如果您的主要受众是英语，您可能会认为您可以使用 ISO-8859-1 或 cp1252，但这是一个错误。迟早有人会写重音或其他外来字符，当这种情况发生时，修复你的编码为时已晚：一些文本已经搞砸了。

这里有一堆进一步阅读，在玩 charsets 时让我省了很多麻烦：

[每个软件开发人员绝对、肯定地必须了解 Unicode 和字符集（没有借口！）](http://www.joelonsoftware.com/articles/Unicode.html) joelonsoftware.com 对字符集及其用法和区别进行了详细介绍。那里的信息非常笼统，但有助于确定选择哪种编码。

[从浏览器到数据库的字符集](http://java.sun.com/developer/technicalArticles/Intl/HTTPCharset/)是 SUN 的一篇非常实用和实用的文章，其中涵盖了很多关于您必须验证您的编码没有被转换为其他内容的各个地方。

[什么是 UTF-8，为什么它很重要？](http://developers.sun.com/dev/gadc/technicalpublications/articles/utf8.html)是 SUN 的另一篇文章，深入探讨了 UTF-8 的本质，在阅读了前 2 篇文章后，应该允许您回答有关 UTF-8 细节的任何问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-22T05:16:30.123

如果我在主要在 ASCII 空间（英语，大多数浪漫语言）中工作的网站，我会将所有非 ASCII 转换为命名或编号的实体。这使我或其他没有适当字体的人可以使用它。这似乎不太可能，但总有一天你会在 SSH 上使用一些不支持 UTF-8 的被遗忘的终端，即使它支持，主机系统也不会安装正确的字体。

如果我编写的文本大多不是 ASCII，我将使用 UTF-8。如果文本是所有与 Unicode 替换框一样不可读的实体。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-22T06:08:18.563

Unicode 的前 128 个字符与 ASCII 兼容。用这 128 个字符编写的文本既是有效的 ASCII 文件，又是 UTF-8 文件。Unicode 是一个标准，每个人都应该使用。说英语的人不会看到差异，但不会说英语的人会。就个人而言，如果它无法正确存储和显示我的姓氏，我对该软件及其创建者感到非常失望。

我还必须注意到，字符编码只是有关内部化的一系列问题中的第一个。尤其是在那些根本不设计用于处理各种非英语语法问题的小型软件中，这一点尤其明显。

# c++ - COM 方法调用返回灾难性故障

> ID：669347
> 
> 赞同：1
> 
> 时间：2009-03-21T13:55:08.963
> 
> 标签：c++, windows, visual-studio-2008, com

**笔记：**

*   **将BSTR**变量传递给**COM**方法，**HRESULT**返回为`8000FFFF`
*   **以前使用接口指针**调用，**成功**：HRESULT 是`0`
*   执行，Visual Studio 内部**成功**，外部**失败**- 发布和调试

**插图：**

```
const char *simFile;
simFile = new char;
//omitted
_bstr_t simFileToOpen(simFile);
BSTR raw_sim_Open = simFileToOpen.copy();
SysFreeString(simFileToOpen);
delete simFile;

hresult = pis8->raw_Open (raw_sim_Open); //0x8000FFFF returned 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-21T13:59:09.297

simFile 看起来是存储在 const char* 中的单个字符。

它不是一个以 NULL 结尾的字符串，除非它是一个空字符串并且它的内容是 0。你确定你不是要这样做：

```
const char *simFile = new char[1024];
strcpy(simFile, "path"); 
```

更好的是，您可以直接使用 SysAllocString 来获取 BSTR。

```
BSTR str = SysAllocString(_T("path")); 
```

# wpf - WPF 用户控件设计器问题与 Strech

> ID：669349
> 
> 赞同：0
> 
> 时间：2009-03-21T13:56:27.853
> 
> 标签：wpf, visual-studio-2008

我有一个 WPF UserControl (Foo.xaml) 应该在窗口上显示拉伸 (VerticalAlignment="Stretch" Horizo​​ntalAlignment="Stretch")。

*   如果我没有在 UserControl 上指定宽度/高度，它将在运行时按预期显示。不幸的是，如果我打开 Foo.xaml，VS WPF 设计器将无法正确显示控件（大小可能为 0x0，具体取决于子控件）。

*   如果我在 UserControl 上指定大小，则设计器将与 Foo.xaml 一起正常工作，但它不会在运行时拉伸。

我该如何解决这个问题，以便它在设计和运行时工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T14:09:20.177

听起来你`UserControl`只有在某个最小尺寸时才有用。如果是这样，请设置`MinWidth`和`MinHeight`属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T14:11:36.443

您可以在 UserControl 上设置 DesignWidth 和 DesignHeight 属性来调整设计视图中控件的高度和宽度。

您可以通过拖动在为 UserControl 选择调整大小工具时显示的方形矩形来调整这些属性。

# xcode - 我可以安装多个 Xcode 版本吗？

> ID：669367
> 
> 赞同：184
> 
> 时间：2009-03-21T14:15:52.220
> 
> 标签：xcode, macos

是否可以同时安装多个版本的 Xcode？

如果是这样，请发布任何需要注意的提示、技巧或潜在问题。

编辑：

我想安装多个版本的原因是尝试新的 sdk beta，但如果新的 Xcode 有问题，我希望能够将旧版本用于我现有的项目。

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2009-03-21T14:41:46.027

是的，您可以安装多个版本的 Xcode。它们将安装到单独的目录中。我发现最好的做法是先安装 Mac 附带的版本，然后安装下载的版本，但这可能不会有太大的不同。请参阅~~[http://developer.apple.com/documentation/Xcode/Conceptual/XcodeCoexistence/Contents/Resources/en.lproj/Details/Details.html](http://developer.apple.com/documentation/Xcode/Conceptual/XcodeCoexistence/Contents/Resources/en.lproj/Details/Details.html)这个 Apple Developer Connection 页面了解更多详细信息。~~ ***<- 页面不存在了！***

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2010-05-05T16:00:54.963

安装多个 Xcode 很容易。

在安装程序中有一个位置下拉菜单...您只需要在安装测试版时选择一个新位置。

这些来自 Apple 开发工具传播者的说明包含完整的详细信息（需要 Apple 开发用户名/密码）： [https ://devforums.apple.com/message/40847#40847](https://devforums.apple.com/message/40847#40847)

然后为您正在使用的 XCode Beta 版本获取一个自定义图标，这样您就可以在 Dock 中区分它们：http: [//iphonedevelopment.blogspot.com/2009/03/multiple-developer-tool-installs.html](http://iphonedevelopment.blogspot.com/2009/03/multiple-developer-tool-installs.html)

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2015-09-20T18:34:44.960

# 我可以安装多个 Xcode 版本吗？

**解决方案：**
实际上，正如上述许多答案所说，这是可能的。即使根据下面的[Oracle 移动平台博客](https://developer.apple.com/downloads/)，您也可以在同一台 Mac 上安装多个 XCode。您需要这样做的原因可能因您而异。

**场景：**
您现在可能只安装了一个版本的 XCode。主要是最新 XCode 版本背后的一个版本，可通过 App Store 获得（我的 Xcode 6.3.2，我需要保留它并安装可通过 App Store 获得的 Xcode 7）。

**例如：-**

> 您已经安装了 XCode 6.x，并且 App Store 已经有 App Store 提供的 XCode 7。无论出于何种原因，您都需要保留旧的 XCode 6.x（您知道它已经稳定了一段时间）并且您需要安装并试用新的 XCode 7
> 
> 所以第一个问题可能是，您可以**如何以及在哪里**下载适用于 XCode 7 的 Mac OS X 可安装 DMG 文件（或者如果您想尝试较旧的 XCode 版本）？好的，这是苹果下载的直接[链接](https://developer.apple.com/downloads/)（您可能必须先登录 Apple 开发者帐户才能正确查看此链接），否则下面是[StackOverflow Q&A 链接，它给出了在哪里下载 XCode IDE 的 DMG 文件的答案](https://stackoverflow.com/questions/10335747/how-to-download-xcode-4-5-6-7-and-get-the-dmg-file)。

所以现在让我们假设您已经获得了您需要安装的 XCode 版本的任何 DMG 文件？

**步骤：**
按照我从上面给出的 Oracles 移动平台博客的第一个链接中获得的下面给出的步骤。

1.  如果正在运行则关闭 Xcode
2.  重命名`/Applications/Xcode.app`为`/Applications/Xcode_6.x.app`
3.  出现提示时输入管理员密码
4.  双击所需的预下载 Xcode 的 DMG 文件并安装它
5.  一旦安装它，在运行它之前，将 `/Applications/Xcode.app`刚刚安装的新的更改为（根据我上面给出的示例）`/Application/Xcode_7.app`

### 笔记*：

**[请耐心阅读本节，直到下一篇注意]**当您安装了两个版本的 Xcode 时，您的工作站也安装了两个版本的命令行工具 ( `xcodebuild`)。问题是当您构建 iOS 应用程序时，您的终端和 Xcode 构建命令将用于什么用途。因为与命令行工具一起，用于构建您的应用程序的 iOS SDK 也依赖于。

我的经验是我有两个 Xcode 版本。Xcode 10（旧版 iOS12.0 - iphoneos12.0）和 Xcode 10.1（新版 iOS 12.1 - iphoneos12.1）。所以很明显，命令行工具的设置被选为使用`xcodebuild`旧应用程序中的工具。我不得不在 Xcode 首选项窗口中手动选择它。

### 在 Xcode 首选项窗口中在哪里设置命令行工具？

*   选择`Locations`选项卡，您可以选择所有已安装的命令行工具版本（即`xcodebuild`）。

### 如何确定正在使用哪个版本的 iOS SDK 来构建您的 iOS 应用程序？

*   在您的终端发出以下命令： `$> xcodebuild -showsdks`
*   上面的命令应该打印出您当前 Xcode 配置用于构建您的应用程序的所有 SDK 详细信息。通过查看结果，您将了解您的 iOS/iphoneos SDK 版本取决于更改`xcodebuild`Xcode 上的命令行工具 ( ) 设置。

**注意**：**
以上给出的 Apple 下载链接和 Oracle MPF 博客文章链接将来可能会更改和/或不可用。

所以我希望我的这个答案可能对其他人有帮助！
干杯!

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2011-07-28T20:59:11.413

您可能希望在终端中使用“xcode-select”命令在已安装文件夹中的不同 Xcode 版本之间切换。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2016-09-30T09:12:26.193

似乎 Xcode 真的很喜欢放在 Applications 文件夹中并被称为 Xcode，尤其是在使用`xcodebuild`时（例如，在为 Carthage 构建时）——而且`xcode-select`似乎并不总是会削减它。

我有一个仍在使用 Swift 2.2 的客户端项目，为此我坚持使用 Xcode 7 并使用 Xcode 8 进行其他任何操作。

因此，在我的 Applications 文件夹中，我有 Xcode 7（重命名为**Xcode_7**）和 Xcode 8（重命名为**Xcode_8**）。然后我将我需要的任何一个重命名为**Xcode**，并在完成后再次返回。这是一个球痛，但似乎工作。

这个 shell 脚本稍微简化了一点……</p>

*`xcode-version.sh`*

```
cd /Applications

if  [[ $1 = "-8" ]]
then 
    if [ -e Xcode_8.app ] 
    then            
        mv Xcode.app Xcode_7.app
        mv Xcode_8.app Xcode.app
        echo "Switched to Xcode 8"
    else
        echo "Already using Xcode 8"
    fi
elif  [[ $1 = "-7" ]]
then
    if [ -e Xcode_7.app ] 
    then            
        mv Xcode.app Xcode_8.app
        mv Xcode_7.app Xcode.app
        echo "Switched to Xcode 7"
    else
        echo "Already using Xcode 7"
    fi
else
    echo "usage: xcode-version -7/8"
fi

xcode-select --switch Xcode.app 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2011-06-27T08:26:36.783

请注意，如果您使用`xcodebuild`命令行工具，那么最后安装的 Xcode 版本将成为默认版本。（符号链接安装在 /usr/bin 中。）要使用`xcodebuild`其他版本的 Xcode，您需要使用`(xcode_install_directory)/usr/bin`目录中的版本。

**note**要在不同版本的 Xcode 命令行工具之间切换，请使用`xcode-select`其他评论者提到的工具。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2019-12-29T06:33:26.547

### 使用 gem Xcode::Install 的多个版本的 Xcode 和模拟器

**自动安装和更新您的 Xcode。**

您可以使用 [Xcode::Install](https://github.com/xcpretty/xcode-install) Ruby Gem 大大简化此过程。

您应该已经安装了 *Xcode 命令行工具*和**支持构建本机扩展的***Ruby* 版本。

 **我建议使用[Homebrew](https://brew.sh)安装 [rbenv](https://github.com/rbenv/rbenv)并使用*rbenv*安装 Ruby。可以在[此处](https://www.moncefbelyamani.com/the-definitive-guide-to-installing-ruby-gems-on-a-mac/)和许多其他地方找到这方面的指南。

*但是，如果您在安装gem*时使用`sudo`（不推荐）或使用 --user-install 安装 gem ，它也应该与较新 macOS 版本提供的库存 Ruby 一起使用。

### 安装

基本上：

```
# Install the Ruby Gem (I'm using rbenv, so no sudo or --user-install)
$ gem install xcode-install

# To list available versions:
# PS!You will get prompted for your Apple Developer / iCloud credentials)
# It's using Apple's own API's so 2FA are supported if enabled

$ xcversion list
6.0.1
6.1
6.1.1
6.2 (installed)
6.3
# To update the list of available versions, run:
$ xcversion update

# To install a certain version, simply:
$ xcversion install 8

##################################################################### 100.0%
Please authenticate for Xcode installation...

Xcode 8
Build version 6D570 
```

这应该下载并安装并激活该版本的 Xcode。您可以像往常一样从 /Applications 启动它。

*新版本也将自动为 CLI 命令* 选择 要选择不同的版本作为活动版本，您将运行：

`xcversion select <version_number>`

从已安装版本列表中，标记为`(installed)`：

```
# To see the active version in use:
$ xcversion selected

# To select and activate an installed version:
$ xcversion select 8

# To select, activate and change the symlink in /Apllications
$ xcversion select 8 --symlink 
```

### 其他有趣的东西，模拟器等

Xcode::Install 也可以通过调用来安装 Xcode 的命令行工具

`xcversion install-cli-tools` 并且还可以使用该`simulators`命令管理您的本地模拟器。

但是，不要重复更多可能会随着时间而改变的信息，而是转到项目的[GitHub 页面](https://github.com/xcpretty/xcode-install#simulators) 以获取有关此 gem 的更多信息。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2017-07-29T05:04:51.170

从**Xcode 9**开始，测试版 Xcode 被标记为“Xcode-beta.app”，旨在与生产版本并存。可以在[此处的 Xcode](https://developer.apple.com/download/)*发行说明* 中找到信息。（不使用直接链接，因为它经常中断）。

来自苹果：

> Xcode 9 beta 4 可以与以前的 Xcode 版本共存。Xcode 的预发布版本可从 developer.apple.com 获得，打包在一个压缩的 XIP 文件中。要在 beta 期间安装 Xcode，请下载 XIP 文件，双击文件将其展开，然后将 Xcode-beta.app 拖到 Applications 文件夹

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-05-26T13:29:02.403

要安装多个 Xcode 实例，您可以将它们放在不同的文件夹中，例如 /Developer5.0.2/Xcode，但是要在 CI 或构建环境（命令行）中使用它们，您需要在构建期间设置一些环境变量。您可以在[此处](https://asile.digitalhusky.com/2015/05/25/multiple-xcode-versions-on-ci-node/)获得更多说明。所以它不仅适用于 beta 和新版本，也适用于真正的旧版本，您可能需要它与尚不支持最新 Xcode 版本的 Marmalade 或 Unity 插件一起使用（有时会发生）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-06-10T11:45:57.927

## 下载一个版本

测试版和稳定版可以从开发人员软件下载应用程序选项卡获取，[这里](https://developer.apple.com/download/)），但旧版本可以从[这里](https://developer.apple.com/download/all/?q=xcode)获取。只需提取`.xib`并放入`Xcode-beta.app`您的应用程序文件夹中。

## 切换版本

*   使用**测试版**：`sudo xcode-select -s /Applications/`**`Xcode-beta.app`**`/Contents/Developer`
*   使用**原版**：`sudo xcode-select -s /Applications/Xcode.app/Contents/Developer`

## 检查版本已更改

您可以通过运行来验证版本是否已更改`xed --version`，它将输出正确的版本：例如`xed version 12.5`或`xed version 13.0`

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-04-15T00:00:05.043

无论您选择哪种建议路径，复制您的项目文件夹，并重命名最外部的文件夹以反映正在打开的 XCode 版本。您可以选择是否要更新语法，但主要原因是所有这一切都是您的故事板将通过查看来改变。它可能会在将来有新读者遇到此问题时解决，或者

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-06-14T05:30:03.460

如果您从 appstore 安装了新版本的 xcode，所有更新都将在 appstore 中提供。如果您只是粘贴下载的版本，应用商店将显示安装未更新。因此，将从 appstore 下载的稳定版本保存在您的应用程序文件夹中。

要尝试新的 beta 版本，我通常将它放在单独的驱动器中并解压缩并安装在那里。这将避免在稳定版本上工作时出现混淆。

为避免混淆，您可以仅将稳定版本保留在您的 Dock 中，并从 Spotlight（Command + Space）打开 beta 版本。这会将测试版暂时放在码头上。但它会确保您不会意外地在 beta 版本中编辑您的客户端项目。

最重要的是：- 在两个不同的 xcode 上处理同一个项目可能会产生一些不需要的结果。就像在特定版本的 xcode 中引入的界面构建器中存在错误一样。这打破了限制。下一个又修好了。

跟踪发行说明以准确了解哪些是附加功能以及哪些是已知问题。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2017-01-11T06:35:39.197

1.  首先，从您的机器上删除当前的 Xcode 安装。你可以跳过这一步，但我想重新开始。另外——Xcode 最近的行为有点奇怪，所以这是一个很好的机会。
2.  从 App Store 安装 Xcode 8。确保项目文件 ( *.xcodeproj) 和工作区文件 (* .xcworkspace) 可以使用新的 Xcode 安装打开（记住在出现提示时选择稍后选项）。
3.  从 Apple 下载 Xcode 7.3.1 dmg 文件。双击新下载的 dmg 文件以获得标准的“Drag to install Xcode in your Applications folder”。不要那样做。而是将 Xcode 图标拖到桌面上。将文件名更改为 Xcode 7.3.1。现在将它拖到应用程序文件夹中。

现在您的机器上安装了两个版本的 Xcode。Xcode 7.3.1 和 Xcode 8。

详细信息：[并排安装 Xcode 7 和 Xcode 8](https://medium.com/@YogevSitton/install-xcode-7-and-xcode-8-side-by-side-5bf40ea8f5ac#.ys1ib3eed)

# eclipse - 过滤 Eclipse 控制台输出文本的最简单方法

> ID：669369
> 
> 赞同：29
> 
> 时间：2009-03-21T14:17:51.030
> 
> 标签：eclipse, console, flexbuilder, filtering

我问的是与 Flex Builder 相关的问题，但它通常可能适用于 Eclipse。

Flex Builder 中的跟踪语句被发送到 Eclipse 输出控制台。在 Eclipse 端过滤此文本的最简单方法是什么？

具体来说，我希望能够按模式过滤（忽略）行。

我遇到了 Logback，但在这种情况下似乎有点矫枉过正。有没有办法编写像这个 Eclipse 本身这样的脚本？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-22T17:20:55.577

没有任何特定于 FlexBuilder 的内容。如果您需要这样的功能，则需要编写一个 Eclipse 插件。

看看[grep-console](http://marketplace.eclipse.org/content/grep-console) one 开始。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-08-15T08:53:47.843

GrepClipse[也](http://grepclipse.sourceforge.net/)可能会有所帮助。也可在[Eclipse 市场上买到](http://marketplace.eclipse.org/content/grepclipse)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-03-17T11:19:34.743

还有[Easy Console Grepper](https://marketplace.eclipse.org/content/easy-console-grepper) 可以打开自己的控制台，一开始我认为比 grep-console 更容易。只需定义您搜索的内容，它将**在控制台执行**行之后显示搜索表达式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-06-10T20:59:58.900

请使用[Easy Console Grepper](https://marketplace.eclipse.org/content/easy-console-grepper) Eclipse 插件，因为这比 grep-console 更简单、更直观。

# sql-server-2005 - 未通过 VPN 连接到 SQL Server

> ID：669372
> 
> 赞同：18
> 
> 时间：2009-03-21T14:22:34.623
> 
> 标签：sql-server-2005, vpn

我第一次通过 VPN 连接到现有网络。我可以从 VPN 客户端 ping SQL Server 使用的 IP 地址，但 SSMS 没有连接到 SQL Server。我正在使用正确的登录 ID 和密码。

为什么会发生这种情况？有任何想法吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-21T16:55:10.200

在默认实例上，SQL Server 默认侦听 TCP/1433。这可以改变。在命名实例上，除非配置不同，否则 SQL Server 会侦听动态 TCP 端口。这意味着如果 SQL Server 发现该端口正在使用中，它将选择另一个 TCP 端口。在命名实例的情况下，客户端通常如何通过与 SQL Server 侦听器服务/SQL 浏览器通信来找到正确的端口。侦听 UDP/1434 并且无法更改。如果你有一个命名实例，你可以配置一个静态端口，如果你需要使用 Kerberos 身份验证/委托，你应该这样做。

您需要确定的是您的 SQL Server 正在侦听的端口。然后，您需要与您的网络/安全人员联系，以确定他们是否允许通过 VPN 与该端口进行通信。如果它们是，如所示，请检查您的防火墙设置。有些系统有多个防火墙（我的笔记本电脑就是一个例子）。如果是这样，您需要检查系统上的所有防火墙。

如果所有这些都正确，请验证服务器没有限制通过 IP 地址访问 SQL Server 端口的 IPSEC 策略。这也可能导致您被阻止。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-21T14:31:06.130

当这种情况发生在我身上时，那是因为 DNS 无法正常工作。尝试在 SQL Server 登录中使用 IP 地址而不是服务器名称。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-21T14:52:15.083

确保为 TCP/IP 启用了 SQL Server（可能有人禁用了它）？

这也将帮助您检查/验证 SQL 实例正在使用的端口号（以防有人将其从默认端口 1433 更改）。

显然，端口 1433（或 SQL 正在侦听的任何端口）需要被您的机器和运行 SQL 的机器之间的任何防火墙解除阻塞。

检查 SQL 的网络配置（需要安装 SQL Server 客户端工具）：开始 -> 程序 -> SQL Server 200x -> 配置工具 -> SQL Server 配置管理器

连接到您需要的机器，然后展开 Tree Item (LHS) “SQL Server Network Configuration”，然后选择实例。您应该有四个选项 - 共享内存、命名管道、TCP/IP 和 VIA。您可以在 RHS 窗口中检查 TCP/IP 是否已启用。

如果您双击 TCP/IP 并点击“高级”选项卡，您还可以查看端口号。

其他想法..您使用的是 SQL 身份验证还是 Windows（域）身份验证？

*   如果 SQL 身份验证（假设您使用的是用户名和密码），您确定要连接的 SQL 实例启用了混合模式身份验证吗？如果没有，您必须以管理员身份连接并更改默认安全设置以允许 SQL 身份验证。

*   如果是 Windows 身份验证，您的网络是否可能正在使用 Kerberos？有人会认为 VPN 凭据将用于握手。我会检查您的帐户是否具有适当的登录权限。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-11-07T19:36:13.323

我在尝试通过 Hamachi VPN 远程连接时也遇到了这个问题。我已经尝试了互联网上所有可用的东西（包括这篇文章），但仍然没有用。请注意，当我的本地网络上的机器上安装了相同的数据库时，一切正常。最后，我能够使用以下修复取得成功：在远程机器上，启用 TCP/IP 协议上的 IP 地址，如下所示：

在远程计算机上，启动 SQL Server 配置管理器，展开 SQL Server 网络配置，选择“SQLEXPRESS 协议”（或“MSSQLSERVER”），右键单击 TCP/IP，在出现的对话框中转到 IP 地址选项卡，并确保“IP1”元素是`Active=Yes`and `Enabled=Yes`。记下 IP 地址（对我来说没有必要修改这些）。然后停止并启动 SQL Server 服务。之后，确保远程计算机上的防火墙被禁用，或者端口 1433 允许例外，该端口包括本地子网和上一个对话框中记录的地址的子网。在您的本地计算机上，您应该能够通过将服务器名称设置为`192.168.1.22\SQLEXPRESS`（或`[ip address of remote machine]\[SQL server instance name]`）来进行连接。

希望有帮助。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-21T14:28:32.160

检查 SQL Server 正在使用的端口是否未被防火墙或 VPN 阻止。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-06-06T17:29:29.937

Citrix Access Gateway 经常遇到这个问题。我通常会收到超时错误。如果您能够从网络上的客户端连接到数据库，但不能通过 VPN 从远程客户端连接到数据库，那么您可以忘记这里给出的大多数建议，因为它们都解决了服务器端问题。

当我将超时时间从默认值（15 秒）增加到 60 秒时，我能够连接，并且为了更好地衡量，将协议强制为 TCP/IP。这些事情可以在登录对话框的选项屏幕上完成：

![`](https://i.stack.imgur.com/xt3gu.jpg)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-03-10T03:40:31.420

只要您将防火墙设置为允许 SQL Server 实例使用的端口，您只需将数据源从更改`=Server name`为`=IP,Port`

即，在连接字符串中使用类似的东西。

```
Data Source=190.190.1.100,1433; 
```

您不必在客户端更改任何内容。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-21T14:28:36.170

您可能没有打开/VPN 转发的 UDP 端口，它的端口号是 1433。

尽管客户端协议名称为“TCP/IP”，但 mssql 使用 UDP 进行 bitbanging。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-21T14:28:51.613

SQL Server 使用 TCP 端口 1433。这可能被 VPN 隧道或服务器上的防火墙阻止。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-21T14:31:28.690

连接到 VPN 时，每条消息都会通过 VPN 服务器，它无法将您的消息转发到 SQL 服务器正在处理的端口。

尝试

禁用 VPN 设置-> 属性-> TCP/IP 属性-> 高级-> 在远程网络上使用默认网关。

这样，您将首先尝试连接 SQL 服务器的本地 IP，然后才使用 VPN 服务器转发您

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-06-30T17:58:43.240

如果您使用的是 sql server 2005，请先启动 sql server browser 服务。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-01-01T13:36:06.427

**这解决了我通过 VPN 访问 SQL Server 2012 数据库的连接问题**

使用 SQL Server 2012 配置管理器，

我去了 SQL Server 网络配置

然后单击新服务器实例并双击 TCP/IP 协议 [我之前也启用了此选项并重新启动了服务器，但仍然没有修复它]

现在 TCP/IP 已启用，我注意到 TCP/IP 属性高级对话框的“IP 地址”选项卡中的所有 IP 端口插槽都设置为 Enabled=No。

我很好奇为什么我的新安装将所有这些 IP 插槽都设置为 NO 而不是 Yes，所以我只是将它们更改为 YES。

现在通过 VPN 与服务器的连接效果很好，我没有更改任何端口号。

注意：我还卸载了 Visual Studio 2010 中的 SQL Server 2008 默认值，但我认为这对 TCP/IP 情况没有直接影响。一位同事告诉我，Visual Studio 附带的 2008 和 2005 安装可能会干扰 SQL 2012。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2018-02-08T06:57:09.203

我在使用 SQL Server 2017 时也遇到了这个问题。

我通过VPN与服务器在同一个网络上，并且可以ping通它。在对无法使用任何身份验证方法感到沮丧之后——我在 SQL 服务器上设置了一个 SSH 服务器——并且我能够正常连接。这证实了正确的端口由于某种原因没有被击中。我什至创建了一个新的用户帐户、域帐户、两端的防火墙检查等......

**我的解决方案是：** 1\. 将连接设置为在 SSMS 上严格使用 TCP/IP 2\. 使用自定义字符串指向默认端口（例如：Data Source=192.168.168.166,1433;）

到目前为止，上面的所有其他评论都没有奏效。看起来必须包含端口（即使它是默认的）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-11-20T04:26:19.143

例如，尝试使用其 IP 更改服务器名称

```
SERVERNAME//SQLSERVER -> 192.168.0.2//SQLSERVER 
```

它与我使用 VPN 完美结合

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-03-26T12:52:12.600

确保将端口 1433 添加到防火墙例外，并确保在防火墙端口设置下选中“任何 IP 地址”（见附件）。

[![在此处输入图像描述](https://i.stack.imgur.com/MPVzd.png)](https://i.stack.imgur.com/MPVzd.png)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-09-20T14:12:12.997

如果在您的**LAN**上一切正常，但当客户端应用程序尝试通过**VPN**建立连接时失败，您可以考虑将路由器**MTU（最大传输单元）**设置从**AUTO**更改为低于最大值。

更多参考资料：

*   [https://faq.draytek.com.au/2021/03/15/adjusting-vpn-mss-mtu-settings/](https://faq.draytek.com.au/2021/03/15/adjusting-vpn-mss-mtu-settings/)
*   [https://community.spiceworks.com/topic/217130-mtu-issues-in-vpn-connections](https://community.spiceworks.com/topic/217130-mtu-issues-in-vpn-connections)
*   [https://community.ui.com/questions/EdgeRouter-4-FortiGate-VPN-Performance-issues/84932edc-d2ee-4bdd-bd47-e0993210f17e?page=1](https://community.ui.com/questions/EdgeRouter-4-FortiGate-VPN-Performance-issues/84932edc-d2ee-4bdd-bd47-e0993210f17e?page=1)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-12-08T06:36:30.593

我的解决方案是启用并启动服务“SQL Server Browser”。还要确保，您在防火墙中允许此服务。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2022-02-22T11:26:11.990

我有类似的问题，但效果很奇怪。如果我通过 VPN (site2site) 使用 SMSS，我将无法连接。但如果我使用 OpenVPN 客户端，它就可以工作。这不是唯一的事情......使用相同的site2site vpn但使用DBeaver或HeidiSQL我可以连接......我编写了一个简单的c＃控制台应用程序来测试连接并且它正在工作。唯一的问题是 SMSS。我不知道为什么，但我对此很好奇:)

# cocoa-touch - 试图找到在 UIView 中绘制 UIImage 的适当上下文

> ID：669383
> 
> 赞同：1
> 
> 时间：2009-03-21T14:28:53.983
> 
> 标签：cocoa-touch

我正在尝试在我的 UIView 中绘制背景图像。这是在 UIAlertView 委托方法 alertView: 我弹出上下文，因为在此之前我在称为游戏的 OpenGL 视图中使用上下文。

```
UIGraphicsPopContext();
UIImage* background = [UIImage imageNamed:@"Background.png"];
[background drawAtPoint:CGPointMake(0.0, 0.0)];

// fade the game out
[UIView beginAnimations:nil context:NULL];
[UIView setAnimationDuration:1];
[game setAlpha:0];
[UIView commitAnimations];

[game release]; 
```

我收到一堆错误消息，例如： CGContextSaveGState: invalid context 我试了一下没有弹出。我想我需要做的是找到我的 UIView 的 CGContextRef，并将其设置为我当前的上下文，但文档不包含有关 CGContextRef 的信息。如何显示我的图像？我试图在它淡出时显示游戏视图后面的图像。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-22T07:50:31.407

解决了。我所要做的就是将 UIImage 放在 UIImageView 中，并将其添加到我的视图的子视图中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-07-20T12:51:07.180

@hyn 是对的！举个例子：

```
UIImageView *logoView = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"38-airplane.png"]]; 
```

# .net - 编译失败：抛出异常还是不抛出？

> ID：669388
> 
> 赞同：0
> 
> 时间：2009-03-21T14:34:49.790
> 
> 标签：.net, exception, architecture

我正在为 CLR 脚本编写[.NET On-the-Fly编译器。](http://fly.sf.net)并且有一个两难境地：在构建失败时抛出异常是否更好？

那么最佳实践的观点是什么，哪种方法更合适呢？

```
try
{
  compiler.Compile(); // do not throws an exception only if build succeed
}
catch(CompilerException ex)
{
  string err = ex.Message;
} 
```

或者

```
compiler.Compile(); // throws an exception only in case of crash, etc
if(!compiler.BuildSucceed)
{
  string err = compiler.Output.ToString();
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T14:37:08.253

异常应该用于*异常*情况。我想说一个失败的构建不是*异常*的，所以你应该让你的编译器的接口返回一个指示成功或失败的值（例如一个布尔值或一个枚举），并提供一个用于返回错误列表的接口。这可以像返回一个串联在一起的所有错误的字符串一样简单，或者它可以像您事先将一个输出流传递给它，并将每个错误记录到该流中，因为它遇到它们。

# multithreading - 同时或顺序写入——在速度方面重要吗？

> ID：669389
> 
> 赞同：2
> 
> 时间：2009-03-21T14:35:47.133
> 
> 标签：multithreading, multicore, disk-access

同时或顺序写操作——在速度方面重要吗？

对于多核处理器，使用多线程并行化所有文件写入操作是否有意义，只是为了提高速度？当然，所有这些写操作都是独立的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T15:10:19.343

一般来说，没有。

到目前为止，对磁盘的物理写入是几个数量级的瓶颈，并且在大多数情况下是相当顺序的。并行化写入你很有可能通过引发搜索来**降低**性能。在大多数情况下，顺序读取和写入将大大优于交错。

每磁盘并行化（TCQ 和 NCQ）主要通过减少不同客户端同时从磁盘的不同部分请求数据时自然需要的寻道来工作。如果你能从一开始就避免这些寻求，那么你会过得更好。

在某些情况下 - RAID 1、JBOD 或不同的数据流到达相当缓慢时 - 正确的调度可以提高您的吞吐量，但这需要对手头的硬件有深入的了解，并且其他过程不会破坏您的乐趣。

* * *

充其量，您可以将其作为最终用户的决定（例如，提供关闭它的选项），并提供性能指标来指导他。（你甚至可能证明我错了；））

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T14:49:18.273

这取决于磁盘及其控制器。他们有 TCQ/NCQ 吗？是RAID吗？如果是这样，那可能有点道理。对于一个没有 NCQ 的普通 SATA 磁盘，它不会。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-21T15:01:56.027

先写最简单的代码，看看它*在目标环境下*是否表现得足够好。（不同的磁盘、操作系统版本、CPU、驱动程序等可能会显着影响结果。）

如果最简单的正确代码还不够快，*那么*尝试找出执行 IO 的更快方法是有意义的。*猜测一下*，如果您正在写入不同的磁盘，并行化写入操作可能是有意义的，但可能不是。不过，这只是一个完整的猜测。

纯属巧合，我计划很快对相关情况进行基准测试。我有一篇[博客文章](http://msmvps.com/blogs/jon_skeet/archive/2009/03/20/benchmarking-io-buffering-vs-streaming.aspx)描述了我打算执行的测试，当我有一些结果时，我会用一个指向结果的链接来更新条目。它与您所描述的并不完全相同，但足够接近可能会引起您的兴趣。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T16:21:49.237

从技术上讲，您可以 mmap 一个文件并让多个线程写入它，但磁盘可能仍会造成瓶颈。

如果您需要最大化 I/O 吞吐量，那么首先要研究您的环境支持的异步 I/O。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T17:16:37.747

这是一个简单的问题，但答案可能非常复杂。Les 尝试通过一些假设来缩小范围：操作系统是 Windows，您有相对大量的真正独立的写入。

1.  您可以通过简单地异步发出写入来跳过多线程。
2.  一次性发布它们 - 让操作系统安排写入
3.  写入是针对同一个文件还是针对不同的文件都没有关系。请注意，仅当上述关于写入独立的假设为真时，这才是正确的。

最坏的情况是，这将比并行 ATA 控制器上的单个普通旧磁盘慢：它会很慢。

最好的情况是，操作系统可以非常高效地调度写入。对于具有大量主轴的存储系统或具有支持 NCQ 的磁盘的情况，这将是正确的。

这里要记住的关键是磁盘 I/O（通常）不受 CPU 限制，因此竭尽全力使用多核对您没有帮助；它只会让生活变得复杂。

请注意，如果您对写入进行排序，以便它们在文件（整体）中是连续的，或者通过按范围对它们进行排序来在磁盘上是连续的，则可以提供帮助。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-21T15:17:56.517

如果您正在谈论写入一个文件，答案是否定的。您不能并行写入一个文件，因为每个进程或线程都必须从操作系统获取文件的锁才能进行写入。

否则，这必须取决于硬件控制器和存储类型、操作系统内核和文件系统实现。

# asp.net-mvc - ASP.NET MVC：如何保留字段字节 []

> ID：669399
> 
> 赞同：1
> 
> 时间：2009-03-21T14:44:21.967
> 
> 标签：asp.net-mvc, data-binding, types

我有一个类型为 byte[] 的字段。该字段将保存我实体的 RecordVersion 属性（数据库中的时间戳）。如何保留此字段，以便在保存实体时它可用？

我已经尝试了两种不同的方法，但到目前为止还没有成功：这会呈现“System.Byte []”：

```
<%= Html.Hidden("RecordVersion", Model.RecordVersion.ToString()) %> 
```

这会引发类型无法转换的 ModelStateError：

```
ViewData["RecordVersion"] = entity.RecordVersion 
```

显然，执行绑定/取消绑定的默认 MVC 机制不喜欢太多 byte[] 字段.....

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-22T21:51:07.983

你需要制作一个modelbinder并注册它。

本文展示了如何在隐藏字段[中](http://stephenwalther.com/blog/archive/2009/02/25/asp.net-mvc-tip-49-use-the-linqbinarymodelbinder-in-your.aspx)使用来自 linq 数据库的时间戳，就像您正在做的那样。

```
 ModelBinders.Binders.Add(typeof(Binary), new LinqBinaryModelBinder()); 
```

在 global.asax 中注册它。

LinqBinaryModelBinder 在期货程序集中。如果你想使用 byte[] 你必须自己写一个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T15:56:52.510

你有没有尝试过。

```
<%= Html.Hidden("RecordVersion", System.Text.Encoding.Unicode.GetString(Model.RecordVersion)) %> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T15:10:24.883

我不会把时间戳放在表格上。如果您想保留对象，我会在服务器端缓存它并使用 id 从缓存中检索它。否则，您可以从数据库中重新检索对象并应用表单数据中的更改。后者是我所做的，使用 TryUpdateModel。

```
public ActionResult Update( int id )
{
     using (var context = new DataContext())
     {
         var model = context.Models.Where( m => m.ID == id ).Single();
         if (TryUpdateModel( model ))
         {
            ...
            context.SubmitChanges(); // wrapped in try/catch
            ...
         }
         else
         {
            ...
         }
     }
     return RedirectToAction( "Show", new { id = id } );
} 
```

# user-interface - “一万分钱”是如何实施的？

> ID：669406
> 
> 赞同：5
> 
> 时间：2009-03-21T14:50:01.390
> 
> 标签：user-interface, drawing, mechanicalturk

[万分钱](http://www.tenthousandcents.com/)是如何实现的？我对接受用户图纸的接口的实现特别感兴趣？有没有图书馆可以促进这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T15:14:18.150

一个关键成分似乎是[处理](http://www.processing.org/)库——这可能是您正在寻找的。从他们的[常见问题解答](http://www.tenthousandcents.com/top.html#faq)：

> 你是怎么把所有东西放在一起的？
> 
> 我们使用了一些不同的工具来创建一切。界面是用 Flash 完成的，电影是用 After Affects 完成的，其他大部分都是用[Processing](http://www.processing.org/)完成的，当然还有成千上万在线工作人员的眼睛和手。

# function - Common Lisp：Remove 函数，它是如何使用的？

> ID：669407
> 
> 赞同：5
> 
> 时间：2009-03-21T14:50:17.100
> 
> 标签：function, common-lisp, sbcl

我有一个“/node/143”形式的查询请求uri（只是格式的一个例子）。

我想从字符串中删除第一个正斜杠，我查找了函数[remove](http://www.cs.cmu.edu/Groups/AI/html/cltl/clm/node144.html)并试了一下。我似乎无法让它工作（我在 Linux 上使用 SBCL）。

我已经使用此代码设置了请求 uri。

```
(setq request-uri "/node/143") 
```

当我检查变量时，我将其返回。

```
request-uri
"/node/143" 
```

我现在尝试删除第一个斜线（此时只需查看如何正确使用该功能）。

```
(remove "/" request-uri)
"/node/143"

(remove '/ request-uri)
"/node/143" 
```

我什至尝试提供一份清单

```
(remove '("/") request-uri)
"/node/143"

(remove '('/) request-uri)
"/node/143" 
```

即使字符串是[字符的向量，](http://www.cs.cmu.edu/Groups/AI/html/cltl/clm/node164.html#SECTION002200000000000000000)我认为可能整个字符串可能会放在一个单元格中，我试图删除整个内容，但仍然没有运气。

```
(remove "/node/143" request-uri)
"/node/143"

(remove '/node143 request-uri)
"/node/143" 
```

所以我现在很茫然，这个看似简单的功能真的让我望而却步，我以为我完全按照文档进行操作，但没有任何效果。

任何人都可以阐明这里发生的事情吗？

谢谢。

***编辑：我找到了我的问题的答案，这又提出了另一个问题。***

从我使用的字符串中删除一个元素

```
(remove #\/ request-uri) 
```

整个字符串怎么样

```
`(remove #\node request-uri`) 
```

仅适用于第一个字符并引发错误，以下均不执行任何操作。

```
(remove "node" request-uri)
(remove 'node request-uri)
(remove ?\node request-uri)
(remove #\node request-uri)
(remove '("node") request-uri) 
```

我不确定这里应该如何解决。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-21T17:36:25.733

学习阅读[Common Lisp HyperSpec](http://www.lispworks.com/documentation/HyperSpec/Front/index.htm)。

字符串是[序列](http://www.lispworks.com/documentation/HyperSpec/Body/c_sequen.htm)、[数组](http://www.lispworks.com/documentation/HyperSpec/Body/c_arrays.htm)（字符的一维向量）以及[字符串](http://www.lispworks.com/documentation/HyperSpec/Body/c_string.htm)。这意味着大多数这些功能都适用。

让我们看看[REMOVE](http://www.lispworks.com/documentation/HyperSpec/Body/f_rm_rm.htm)。CLHS 给出了这个签名：

```
remove item sequence &key from-end test test-not start end count key
    => result-sequence 
```

字符串是字符序列。所以删除的调用是：

```
(remove #\/ "/foo/") 
```

或（例如）

```
(remove #\/ "/foo/" :start 2) 
```

记住：`#\a`是一个字符。 `#\node`是没有字符。非法的。一个字符串是`"/foo/"`.

从字符串中删除的项目必须是一个字符。没有其他的。为什么？因为 TEST 默认为 EQL，而 EQL 将字符串中的字符与您的 item 参数进行比较。默认情况下， key 是 IDENTITY 并且不会更改项目。

如果你的论点是一个字符串怎么办？那么，你必须做更多：

```
 (remove "/" "/abc/" :key #'string :test #'equal) 
```

这会查看序列的每个字符并将其转换为字符串。`"/"`然后将使用函数 EQUAL将字符串与您的项目进行比较。这也有效。代价是它需要从 的每个字符生成一个字符串`"/abc/"`，每个字符串都是一个新对象。

另一种方法是：

```
 (remove "/" "/abc/" :test (lambda (a b) (eql (aref a 0) b))) 
```

上面检索`"/"`每个测试中的第一个字符，并将其与字符串中的字符进行比较`"/abc/"`。再次，成本是它需要获得五次角色（在这个例子中）。

因此，如果您的原始对象以字符串形式出现，那么最好的编写方法是：

```
(remove (aref "/" 0) "/abc/") 
```

上面我们从字符串中获取字符`"/"`一次，然后 REMOVE 将此字符与默认 EQL 测试与字符串中的每个字符进行比较 - 它返回一个新字符串，其中包含那些不是 EQL 的字符`#\/`。

你期望 ?\foo 是什么？在 Common Lisp 中，这是符号`|?fOO|`。

也`(remove "foo" "afoob")`不起作用，因为字符串（`"foo"`此处）不是字符串的元素。请记住，字符是字符串的元素。还要记住，带有一个项目`"/"`的字符串仍然是字符串而不是字符。因此`"/"`和`#\/`是不同的类型。第一个是字符串，第二个是字符。

SUBSEQ 从一个序列中提取一个序列。这意味着它还会从另一个字符串中提取一个字符串：

```
(subseq "0123456" 1 5)
     where 1 is the start and 5 is the end index. 
```

CONCATENATE 附加序列。这意味着它还附加了字符串。

```
(concatenate 'string "abc" "123")
  returns a new string with the strings "abc" and "123" appended. 
```

要删除字符串的一部分，另请参见函数 STRING-TRIM、STRING-LEFT-TRIM 和 STRING-RIGHT-TRIM。

因此，与从字符串中删除子字符串的另一个答案一样，您需要编写一些代码来提取一些字符串，然后将它们连接起来。

SEARCH 在字符串中搜索字符串。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T16:47:32.060

要删除整个子字符串，您必须创建一个新函数，例如：

```
(defun remove-string (rem-string full-string &key from-end (test #'eql)
                      test-not (start1 0) end1 (start2 0) end2 key)
  “返回删除 rem 字符串的完整字符串”
  (let ((subst-point (search rem-string full-string
                             :从头到尾
                             :test 测试 :test-not test-not
                             :start1 开始1 :end1 结束1
                             :start2 start2 :end2 end2 :key key)))
    （如果子点
        （连接'字符串
                     (subseq full-string 0 subst-point)
                     (subseq full-string (+ subst-point (length rem-string))))
        全字符串）））

```

这只是一个起点。我复制了 SEARCH 的所有选项，但我认为某些选项在这种情况下没有意义。至少这有效：

```
（删除字符串“节点”“这是不是一个节点”）

```

对于更复杂的情况，您也许应该看看 cl-ppcre，一个正则表达式库。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-21T17:28:30.323

解释：

```
(remove "node" request-uri)
(remove 'node request-uri)
(remove ?\node request-uri)
(remove #\node request-uri)
(remove '("node") request-uri) 
```

它们（分别）是：字符串、（引用的）符号、（评估的）符号、格式错误的字符文字和包含一个字符串的列表。 [REMOVE](http://www.lispworks.com/documentation/HyperSpec/Body/f_rm_rm.htm)从对象序列中删除一个对象，而字符串不是这些事物的序列。

如果您只想删除部分字符串，则 SUBSEQ 可能会解决问题：

```
(let ((uri "/node/143"))
  (when (string= (subseq uri 0 6) "/node/")
    (format t "user wants node ~D" (parse-integer (subseq uri 6))))) 
```

对于更复杂的事情，您可能需要像 cl-ppcre 和/或 split-sequence 这样的库。（如果您使用的是 Hunchentoot，则您已经加载了前者。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T15:05:11.323

这失败了，因为“/”是一个字符串，而不是一个字符。

```
(remove "/" request-uri)
"/node/143" 
```

如果你想要这个字符，你需要使用#/ 即正斜杠字符。

```
(remove #\/ request-uri)
"node143" 
```

但正如您所看到的，它将删除*所有*正斜杠。根据您链接的文档页面，remove 需要一个名为 :count 的关键字参数，它表示要删除多少项目。所以你可以这样做。

```
(remove #\/ request-uri :count 1)
"node/143" 
```

希望这可以帮助。

：：编辑：：

不是？/，是#/。谢谢道格拉斯！

# video - 制作产品视频演示的软件？

> ID：669408
> 
> 赞同：1
> 
> 时间：2009-03-21T14:50:19.347
> 
> 标签：video, demo

你认为什么样的软件是用来制作演示的，比如曾经在微软的 PDC 等中看到的或者在 Channel 9 看到的。

示例：http: [//download.microsoft.com/download/c/e/2/ce28874c-4f44-4dbd-babb-727685e2be96/WinFS_IWish_720x486_2mbs.wmv](http://download.microsoft.com/download/c/e/2/ce28874c-4f44-4dbd-babb-727685e2be96/WinFS_IWish_720x486_2mbs.wmv)

基本上你有文字和声音。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-21T14:59:04.817

我打赌他们使用[Camtasia Studio](http://www.techsmith.com/camtasia.asp)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T14:57:02.060

[SnagIt](http://www.techsmith.com/screen-capture.asp)完全是 rad

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T15:30:42.057

还检查

*   [调试模式眨眼](http://www.debugmode.com/wink/)
*   [摄影棚](http://camstudio.org/)

两者都功能齐全且免费

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T16:02:03.887

[xvidcap](http://xvidcap.sourceforge.net/) (GPL) 用于任何 X 会话，例如 Linux 上的 GUI。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-06-21T09:23:05.610

ShowBiz 开放制作各种视频。在此处找到有关[如何制作视频的教程](http://www.arcsoft.com/topics/video-editor/how-to-make-a-video.html)

# c++ - 传递 BSTR 时，COM 方法调用返回 Catastrophic Failure

> ID：669415
> 
> 赞同：1
> 
> 时间：2009-03-21T14:55:17.913
> 
> 标签：c++, windows, visual-studio-2008, com

从[上一个问题修改](https://stackoverflow.com/questions/669347/com-method-call-returns-catastrophic-failure)

**笔记：**

*   **将BSTR**变量传递给**COM**方法，**HRESULT**返回为`8000FFFF`
*   **以前使用接口指针**调用，**成功**：HRESULT 是`0`
*   执行，Visual Studio 内部**成功**，外部**失败**- 发布和调试

**插图：**

```
BSTR raw_sim_Open = SysAllocString (L"c:\\example.S8");

hresult = pis8->raw_Open (raw_sim_Open); //0x8000FFFF returned 
```

## 编辑-WinDbg：

```
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=003a5be8 ebx=00009000 ecx=003a0208 edx=77606e00 esi=0012ec90 edi=00191b14
eip=003a0283 esp=0012ec34 ebp=0012ecb4 iopl=0         nv up ei ng nz ac pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010296
Missing image name, possible paged-out or corrupt data.
Missing image name, possible paged-out or corrupt data.
<Unloaded_PI32.dll>+0x3a0282:
003a0283 0080023a0088    add     byte ptr [eax-77FFC5FEh],al ds:0023:883a95ea=?? 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T05:00:50.283

就像 danbystrom 提到的那样，不同之处可能在于初始化。但这也会间接影响执行。例如，如果该方法不调用 SysStringLen 来确定字符串的长度，而是尝试将其用作以 null 结尾的字符串，该怎么办？这不太可能是问题的原因，但值得检查。

如果是这种情况，以下将有所帮助。使用 SysAllocStringLen() 获取一个尾随空字符的 BSTR。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T16:30:29.450

调试构建和发布构建之间最显着的区别之一是调试库将内存初始化为零，而发布库不会。因此，如果某些东西在调试版本中有效但在发布版本中失败，可能的原因是一个或多个未初始化的变量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T15:10:12.497

一般来说，返回`E_UNEXPECTED`并不直接暗示任何事情。

更多 COM 运行时错误更具体（例如 DCOM 连接丢失），因此很可能是 COM 组件本身正在返回`E_UNEXPECTED`.

您需要查看或调试 COM 组件本身的实现。

# cobol - 在 Fujitsu COBOL 3.0 中编译时出错

> ID：669416
> 
> 赞同：1
> 
> 时间：2009-03-21T14:55:53.780
> 
> 标签：cobol

在 Fujitsu COBOL 3.0 中编译时出现错误，提示 c://cobol/sample2.cbl 文件不存在或文件名无效或文件被另一个程序使用。但是该文件存在于确切的位置，并且没有被任何其他 prog 使用。任何人都可以告诉可能是什么问题

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-08-12T07:07:30.900

还要确保您没有将 Fujitsu COBOL 3.0 安装在具有 LFN 的路径中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-07T19:31:08.157

在尝试编译源代码之前，您必须先关闭编辑器。本参考资料将为您提供概述。

[http://www.wiley.com/college/info/stern318817/resources/compilers/comp_comparison.html](http://www.wiley.com/college/info/stern318817/resources/compilers/comp_comparison.html)

# ruby-on-rails - Windows 上的 Ruby relative_path_from 调用

> ID：669417
> 
> 赞同：2
> 
> 时间：2009-03-21T14:56:42.030
> 
> 标签：ruby-on-rails, ruby

我遇到了 Rails 生成脚本部分的问题，该脚本在插件路径中搜索适当命名的文件以查找生成器。在我的一个系统上，我安装了 Ruby，`c:\dev\ruby`并且我的项目目录位于`d:\local\projects`

Ruby`Pathname#relative_path_from`方法（由 Rails 生成器脚本调用）在尝试查找`c:\`和`d:\`...

`relative_path_from`有没有人在 Windows 上使用多个驱动器遇到这种情况？rails 生成器脚本有解决方法吗？

这是来自 IRB 的示例：

```
>> x = Pathname.new('c:/dev/ruby')
=> #<Pathname:c:/dev/ruby>
>> y = Pathname.new('d:/local/projects')
=> #<Pathname:d:/local/projects>
>> x.relative_path_from(y)
ArgumentError: different prefix: "c:/" and "d:/local/projects"
        from c:/dev/ruby/lib/ruby/1.8/pathname.rb:709:in `relative_path_from'
        from (irb)... 
```

如果没有解决方案，我总是可以确保我的 Ruby 安装和项目目录在同一个驱动器上，但这会阻止我在 pendrive 上处理项目目录......

**更新：**原来这个问题与 Radiant CMS 对 Rails 配置变量所做的一些修改有关。此更改为项目添加了额外的插件目录，其中一些可以跨越驱动器边界。由于 Rails 生成器代码不希望发生那种驱动跳跃，因此生成器在我的计算机上中断了......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T15:34:56.010

有没有办法计算 Windows 中两个不同驱动器之间的相对路径？我不知道。

假设您使用的是 NTFS，您可以通过将驱动器安装`D:`为驱动器上的文件夹来避免此问题。`C:`如果这是不可接受的，您可以创建一个交汇点，`D:\local`让`C:\local`您可以`D:\local`从`D:`和访问`C:`。然后，从`C:`驱动器运行相同的脚本应该没有问题。

*   [如何在 Windows XP 和 Windows Server 2003 中创建和使用安装了 NTFS 的驱动器](http://support.microsoft.com/kb/307889)
*   [如何创建和操作 NTFS 连接点](http://support.microsoft.com/kb/205524)
*   [SysInternals 的连接实用程序](http://technet.microsoft.com/en-us/sysinternals/bb896768.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-05-26T20:24:47.243

问题是在[http://redmine.ruby-lang.org/issues/show/1366的票中记录的](http://redmine.ruby-lang.org/issues/show/1366)

在 Windows 上，驱动器号的大小写可以是大写或小写（例如，`"C:"`或`"c:"`），同时在不同的命令提示符 Windows 中的同一台机器上（详见下文）。将根据运行它的命令提示符返回驱动器号（或）`Dir.pwd`的小写或大写。但是，始终使用小写驱动器号。这可能会导致比较和使用. 版本 1.9.1p0 也会发生这种情况。应处理论据的情况不同的情况。`"C:"``"c:"``__FILE__``ArgumentError``Dir.pwd``__FILE__``Pathname#relative_path_from``Pathname#relative_path_from`

我的 ruby​​ 安装文件夹和我的项目文件夹都在 c: 驱动器上，但我仍然收到错误消息。我在 pathname.rb 文件中对以下行进行了猴子修补，如下所示，在两个星号内标记。修补时删除两个星号。

```
 def relative_path_from(base_directory)
    dest_directory = self.cleanpath.to_s.**capitalize**
    base_directory = base_directory.cleanpath.to_s.**capitalize**
    ... 
```

它在补丁后工作。希望能帮助到你。

# c++ - 如何使用 C++ 在运行时获取内存使用情况？

> ID：669438
> 
> 赞同：95
> 
> 时间：2009-03-21T15:11:41.387
> 
> 标签：c++, linux, memory-management

我需要在程序运行时获取内存使用 VIRT 和 RES 并显示它们。

到目前为止我尝试了什么：

getrusage ( [http://linux.die.net/man/2/getrusage](http://linux.die.net/man/2/getrusage) )

```
int who = RUSAGE_SELF; 
struct rusage usage; 
int ret; 

ret=getrusage(who,&usage);

cout<<usage.ru_maxrss; 
```

但我总是得到 0。

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-03-22T18:17:54.283

在 Linux 上，我从未找到*ioctl()*解决方案。对于我们的应用程序，我们基于读取*/proc/pid*中的文件编写了一个通用实用程序例程。有许多这些文件会给出不同的结果。这是我们解决的问题（问题标记为 C++，我们使用 C++ 结构处理 I/O，但如果需要，它应该很容易适应 C i/o 例程）：

```
#include <unistd.h>
#include <ios>
#include <iostream>
#include <fstream>
#include <string>

//////////////////////////////////////////////////////////////////////////////
//
// process_mem_usage(double &, double &) - takes two doubles by reference,
// attempts to read the system-dependent data for a process' virtual memory
// size and resident set size, and return the results in KB.
//
// On failure, returns 0.0, 0.0

void process_mem_usage(double& vm_usage, double& resident_set)
{
   using std::ios_base;
   using std::ifstream;
   using std::string;

   vm_usage     = 0.0;
   resident_set = 0.0;

   // 'file' stat seems to give the most reliable results
   //
   ifstream stat_stream("/proc/self/stat",ios_base::in);

   // dummy vars for leading entries in stat that we don't care about
   //
   string pid, comm, state, ppid, pgrp, session, tty_nr;
   string tpgid, flags, minflt, cminflt, majflt, cmajflt;
   string utime, stime, cutime, cstime, priority, nice;
   string O, itrealvalue, starttime;

   // the two fields we want
   //
   unsigned long vsize;
   long rss;

   stat_stream >> pid >> comm >> state >> ppid >> pgrp >> session >> tty_nr
               >> tpgid >> flags >> minflt >> cminflt >> majflt >> cmajflt
               >> utime >> stime >> cutime >> cstime >> priority >> nice
               >> O >> itrealvalue >> starttime >> vsize >> rss; // don't care about the rest

   stat_stream.close();

   long page_size_kb = sysconf(_SC_PAGE_SIZE) / 1024; // in case x86-64 is configured to use 2MB pages
   vm_usage     = vsize / 1024.0;
   resident_set = rss * page_size_kb;
}

int main()
{
   using std::cout;
   using std::endl;

   double vm, rss;
   process_mem_usage(vm, rss);
   cout << "VM: " << vm << "; RSS: " << rss << endl;
} 
```

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2013-02-17T23:29:22.353

[David Robert Nadeau](http://nadeausoftware.com/about)在他的网站上放了一个很好的自包含[多平台 C 函数来获取进程驻留集大小（物理内存使用）](http://nadeausoftware.com/articles/2012/07/c_c_tip_how_get_process_resident_set_size_physical_memory_use)：

```
/*
 * Author:  David Robert Nadeau
 * Site:    http://NadeauSoftware.com/
 * License: Creative Commons Attribution 3.0 Unported License
 *          http://creativecommons.org/licenses/by/3.0/deed.en_US
 */

#if defined(_WIN32)
#include <windows.h>
#include <psapi.h>

#elif defined(__unix__) || defined(__unix) || defined(unix) || (defined(__APPLE__) && defined(__MACH__))
#include <unistd.h>
#include <sys/resource.h>

#if defined(__APPLE__) && defined(__MACH__)
#include <mach/mach.h>

#elif (defined(_AIX) || defined(__TOS__AIX__)) || (defined(__sun__) || defined(__sun) || defined(sun) && (defined(__SVR4) || defined(__svr4__)))
#include <fcntl.h>
#include <procfs.h>

#elif defined(__linux__) || defined(__linux) || defined(linux) || defined(__gnu_linux__)
#include <stdio.h>

#endif

#else
#error "Cannot define getPeakRSS( ) or getCurrentRSS( ) for an unknown OS."
#endif

/**
 * Returns the peak (maximum so far) resident set size (physical
 * memory use) measured in bytes, or zero if the value cannot be
 * determined on this OS.
 */
size_t getPeakRSS( )
{
#if defined(_WIN32)
    /* Windows -------------------------------------------------- */
    PROCESS_MEMORY_COUNTERS info;
    GetProcessMemoryInfo( GetCurrentProcess( ), &info, sizeof(info) );
    return (size_t)info.PeakWorkingSetSize;

#elif (defined(_AIX) || defined(__TOS__AIX__)) || (defined(__sun__) || defined(__sun) || defined(sun) && (defined(__SVR4) || defined(__svr4__)))
    /* AIX and Solaris ------------------------------------------ */
    struct psinfo psinfo;
    int fd = -1;
    if ( (fd = open( "/proc/self/psinfo", O_RDONLY )) == -1 )
        return (size_t)0L;      /* Can't open? */
    if ( read( fd, &psinfo, sizeof(psinfo) ) != sizeof(psinfo) )
    {
        close( fd );
        return (size_t)0L;      /* Can't read? */
    }
    close( fd );
    return (size_t)(psinfo.pr_rssize * 1024L);

#elif defined(__unix__) || defined(__unix) || defined(unix) || (defined(__APPLE__) && defined(__MACH__))
    /* BSD, Linux, and OSX -------------------------------------- */
    struct rusage rusage;
    getrusage( RUSAGE_SELF, &rusage );
#if defined(__APPLE__) && defined(__MACH__)
    return (size_t)rusage.ru_maxrss;
#else
    return (size_t)(rusage.ru_maxrss * 1024L);
#endif

#else
    /* Unknown OS ----------------------------------------------- */
    return (size_t)0L;          /* Unsupported. */
#endif
}

/**
 * Returns the current resident set size (physical memory use) measured
 * in bytes, or zero if the value cannot be determined on this OS.
 */
size_t getCurrentRSS( )
{
#if defined(_WIN32)
    /* Windows -------------------------------------------------- */
    PROCESS_MEMORY_COUNTERS info;
    GetProcessMemoryInfo( GetCurrentProcess( ), &info, sizeof(info) );
    return (size_t)info.WorkingSetSize;

#elif defined(__APPLE__) && defined(__MACH__)
    /* OSX ------------------------------------------------------ */
    struct mach_task_basic_info info;
    mach_msg_type_number_t infoCount = MACH_TASK_BASIC_INFO_COUNT;
    if ( task_info( mach_task_self( ), MACH_TASK_BASIC_INFO,
        (task_info_t)&info, &infoCount ) != KERN_SUCCESS )
        return (size_t)0L;      /* Can't access? */
    return (size_t)info.resident_size;

#elif defined(__linux__) || defined(__linux) || defined(linux) || defined(__gnu_linux__)
    /* Linux ---------------------------------------------------- */
    long rss = 0L;
    FILE* fp = NULL;
    if ( (fp = fopen( "/proc/self/statm", "r" )) == NULL )
        return (size_t)0L;      /* Can't open? */
    if ( fscanf( fp, "%*s%ld", &rss ) != 1 )
    {
        fclose( fp );
        return (size_t)0L;      /* Can't read? */
    }
    fclose( fp );
    return (size_t)rss * (size_t)sysconf( _SC_PAGESIZE);

#else
    /* AIX, BSD, Solaris, and Unknown OS ------------------------ */
    return (size_t)0L;          /* Unsupported. */
#endif
} 
```

## 用法

```
size_t currentSize = getCurrentRSS( );
size_t peakSize    = getPeakRSS( ); 
```

有关更多讨论，请查看网站，它还提供[了获取系统物理内存大小的功能](http://nadeausoftware.com/articles/2012/09/c_c_tip_how_get_physical_memory_size_system)。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-03-21T15:39:56.170

老的：

> maxrss 声明进程的最大可用内存。0 表示对进程没有限制。您可能想要的是非共享数据使用`ru_idrss`。

新：似乎上面的内容实际上不起作用，因为内核没有填充大部分值。起作用的是从proc获取信息。与其自己解析，不如使用 libproc（procps 的一部分），如下所示：

```
// getrusage.c
#include <stdio.h>
#include <proc/readproc.h>

int main() {
  struct proc_t usage;
  look_up_our_self(&usage);
  printf("usage: %lu\n", usage.vsize);
} 
```

`gcc -o getrusage getrusage.c -lproc`用“ ”编译

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-21T15:58:37.107

在 linux 上，如果你能负担得起运行时间成本（用于调试），你可以使用 valgrind 和 massif 工具：

[http://valgrind.org/docs/manual/ms-manual.html](http://valgrind.org/docs/manual/ms-manual.html)

它很重，但非常有用。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2012-10-01T14:24:04.147

Don Wakefield 方法的一种更优雅的方法：

```
#include <iostream>
#include <fstream>

using namespace std;

int main(){

    int tSize = 0, resident = 0, share = 0;
    ifstream buffer("/proc/self/statm");
    buffer >> tSize >> resident >> share;
    buffer.close();

    long page_size_kb = sysconf(_SC_PAGE_SIZE) / 1024; // in case x86-64 is configured to use 2MB pages
    double rss = resident * page_size_kb;
    cout << "RSS - " << rss << " kB\n";

    double shared_mem = share * page_size_kb;
    cout << "Shared Memory - " << shared_mem << " kB\n";

    cout << "Private Memory - " << rss - shared_mem << "kB\n";
    return 0;
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-08-03T19:08:40.090

The existing answers are better for how to get the correct value, but I can at least explain why getrusage isn't working for you.

man 2 getrusage:

> The above struct [rusage] was taken from BSD 4.3 Reno. Not all fields are meaningful under Linux. Right now (Linux 2.4, 2.6) only the fields ru_utime, ru_stime, ru_minflt, ru_majflt, and ru_nswap are maintained.

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-21T15:41:51.267

除了您的方式之外，您
还可以调用系统 ps 命令并从它的输出中获取内存使用情况。
或从 /proc/pid 读取信息（请参阅 PIOCPSINFO 结构）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2013-11-04T14:53:59.813

基于 Don W 的解决方案，变量更少。

```
void process_mem_usage(double& vm_usage, double& resident_set)
{
    vm_usage     = 0.0;
    resident_set = 0.0;

    // the two fields we want
    unsigned long vsize;
    long rss;
    {
        std::string ignore;
        std::ifstream ifs("/proc/self/stat", std::ios_base::in);
        ifs >> ignore >> ignore >> ignore >> ignore >> ignore >> ignore >> ignore >> ignore >> ignore >> ignore
                >> ignore >> ignore >> ignore >> ignore >> ignore >> ignore >> ignore >> ignore >> ignore >> ignore
                >> ignore >> ignore >> vsize >> rss;
    }

    long page_size_kb = sysconf(_SC_PAGE_SIZE) / 1024; // in case x86-64 is configured to use 2MB pages
    vm_usage = vsize / 1024.0;
    resident_set = rss * page_size_kb;
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2020-01-07T18:25:28.327

在您的系统上有一个名为`/proc/self/statm`. proc 文件系统是一个伪文件系统，它为内核数据结构提供接口。此文件包含您需要的信息，列中只有以空格分隔的整数。

列号：

1.  = 总程序大小（/proc/[pid]/status 中的 VmSize）

2.  = 驻留集大小（/proc/[pid]/status 中的 VmRSS）

有关更多信息，请参阅[链接](http://man7.org/linux/man-pages/man5/proc.5.html)。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-09T21:17:25.110

我正在使用其他方式来做到这一点，这听起来很现实。我所做的是通过 getpid() 函数获取进程的 PID，然后使用 /proc/pid/stat 文件。我相信 stat 文件的第 23 列是 vmsize（查看 Don 的帖子）。您可以在代码中需要的任何位置从文件中读取 vmsize。如果您想知道一段代码可能会占用多少内存，您可以在该代码段之前和之后读取该文件一次，然后您可以将它们彼此相减。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-10-02T15:57:46.103

I was looking for a Linux app to measure maximum memory used. valgrind is an excellent tool, but was giving me more information than I wanted. [tstime](https://bitbucket.org/gsauthof/tstime) seemed to be the best tool I could find. It measures "highwater" memory usage (RSS and virtual). See [this answer](https://unix.stackexchange.com/a/18858/15954).

# php - PHP 函数 array_unique 不起作用

> ID：669439
> 
> 赞同：0
> 
> 时间：2009-03-21T15:13:50.927
> 
> 标签：php, arrays

我在 PHP 中有一个数组，我想删除重复项。

我只是求助于函数`array_unique()`来创建一个新数组并删除重复项。

这是代码：

```
$unlink = array();
$unlink = array_unique($linkphoto);

foreach ($unlink as $link) {
    echo $link, "<br />";
} 
```

仍然显示重复！关于出了什么问题的任何建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T15:18:28.310

根据[文档](http://us2.php.net/array_unique)，相等的条件如下：

> **注意：**当且仅当 (string) $elem1 === (string) $elem2 时，才认为两个元素相等。换句话说：当字符串表示相同时。将使用第一个元素。

您使用的是什么类型的数据？如果两个项目的字符串不相等，那么它们都将保留在数组中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T18:19:05.163

我们需要更多上下文以便能够为您提供帮助，例如`$linkphoto`之前`array_unique`应用的内容。例如：

```
<?php
$array = Array('A','B','C','D','B');
print_r($array); // Array ( [0] => A [1] => B [2] => C [3] => D [4] => B )
$result = array_unique($array);
print_r($result); // Array ( [0] => A [1] => B [2] => C [3] => D ) 
?> 
```

正如@nobody_ 所提到的，如果它们的字符串表示相同，它只会消除重复项。

# bash - 在 Bash 中，双方括号 [[ ]] 是否优于单方括号 [ ]？

> ID：669452
> 
> 赞同：800
> 
> 时间：2009-03-21T15:28:45.137
> 
> 标签：bash, if-statement, syntax

一位同事最近在代码审查中声称，该`[[ ]]`构造`[ ]`在构造中比

```
if [ "`id -nu`" = "$someuser" ] ; then
     echo "I love you madly, $someuser"
fi 
```

他无法提供理由。有吗？

* * *

## 回答 #1

> 赞同：792
> 
> 时间：2009-03-21T15:44:09.887

`[[`惊喜较少，通常使用起来更安全。但它不是可移植的——POSIX 没有指定它的作用，只有一些 shell 支持它（除了 bash，我听说 ksh 也支持它）。例如，你可以做

```
[[ -e $b ]] 
```

测试文件是否存在。但是对于`[`，您必须引用`$b`，因为它会拆分论点并扩展诸如`"a*"`（`[[`字面意思是）之类的内容。这也与如何`[`成为外部程序并像其他所有程序一样正常接收其参数有关（尽管它也可以是内置程序，但它仍然没有这种特殊处理）。

`[[`还有一些其他不错的功能，例如正则表达式匹配`=~`以及类似 C 语言中已知的运算符。这是一个很好的页面：测试[和测试有](http://mywiki.wooledge.org/BashFAQ/031)[什么区别？`[``[[`](http://mywiki.wooledge.org/BashFAQ/031)和[Bash 测试](http://mywiki.wooledge.org/BashGuide/Practices#Bash_Tests)

* * *

## 回答 #2

> 赞同：320
> 
> 时间：2017-11-30T15:04:25.730

**行为差异**

Bash 4.3.11 的一些区别：

*   POSIX 与 Bash 扩展：

    *   `[` [是 POSIX](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/test.html)
    *   `[[` [是一个受KornShell](https://en.wikipedia.org/wiki/KornShell)启发[的 Bash 扩展](https://www.gnu.org/software/bash/manual/html_node/Conditional-Constructs.html#index-_005b_005b)
*   常规命令与魔法

    *   `[`只是一个带有奇怪名称的常规命令。

        `]`只是 的最后一个参数`[`。

        [Ubuntu 16.04](https://en.wikipedia.org/wiki/Ubuntu_version_history#Ubuntu_16.04_LTS_.28Xenial_Xerus.29)实际上有一个`/usr/bin/[`由[coreutils](https://www.gnu.org/software/coreutils/manual/html_node/test-invocation.html#test-invocation)提供的可执行文件，但 Bash 内置版本优先。

        Bash 解析命令的方式没有任何改变。

        特别是，`<`是重定向，`&&`并`||`连接多个命令，`( )`生成子shell，除非转义`\`，并且单词扩展照常发生。

    *   `[[ X ]]`是一个`X`可以神奇地解析的单一结构。`<`, `&&`,`||`和`()`被特殊对待，分词规则不同。

        还有更多的区别，如`=`和`=~`。

    在 Bashese: `[`is a built-in command, and `[[`is a keyword: *[shell builtin 和 shell 关键字有什么区别？](https://askubuntu.com/questions/445749/whats-the-difference-between-shell-builtin-and-shell-keyword)*

*   `<`

    *   `[[ a < b ]]`: 字典比较
    *   `[ a \< b ]`: 同上。`\`required 或者像任何其他命令一样进行重定向。Bash 扩展。
    *   `expr x"$x" \< x"$y" > /dev/null`或`[ "$(expr x"$x" \< x"$y")" = 1 ]`：POSIX 等价物，请参阅：*[How to test strings for lexicographic less than or equal in Bash?](https://stackoverflow.com/questions/21294867/how-to-test-strings-for-lexicographic-less-than-or-equal-in-bash/52707989#52707989)*
*   `&&`和`||`

    *   `[[ a = a && b = b ]]`: 真实的，合乎逻辑*的*
    *   `[ a = a && b = b ]`: 语法错误，`&&`解析为 AND 命令分隔符`cmd1 && cmd2`
    *   `[ a = a ] && [ b = b ]`: POSIX 可靠等价物
    *   `[ a = a -a b = b ]``a`: 几乎等价，但被 POSIX 弃用，因为它是疯狂的，并且对于or `b`like `!`or的某些值会失败，或者`(`将被解释为逻辑操作
*   `(`

    *   `[[ (a = a || a = b) && a = b ]]`： 错误的。没有`( )`它会是真的，因为`[[ && ]]`它的优先级高于`[[ || ]]`
    *   `[ ( a = a ) ]`: 语法错误，`()`被解释为子shell
    *   `[ \( a = a -o a = b \) -a a = b ]`: 等效，但是`()`, `-a`, 和`-o`被 POSIX 弃用。没有`\( \)`它会是真的，因为`-a`它的优先级高于`-o`
    *   `{ [ a = a ] || [ a = b ]; } && [ a = b ]`不推荐使用的 POSIX 等效项。然而，在这种特殊情况下，我们可以只写: `[ a = a ] || [ a = b ] && [ a = b ]`，因为`||`和`&&`shell 运算符具有相同的优先级，不像`[[ || ]]`and`[[ && ]]`和`-o`, `-a`and`[`
*   扩展时的分词和文件名生成 (split+glob)

    *   `x='a b'; [[ $x = 'a b' ]]`： 真的。不需要报价
    *   `x='a b'; [ $x = 'a b' ]`: 语法错误。它扩展到`[ a b = 'a b' ]`
    *   `x='*'; [ $x = 'a b' ]`: 如果当前目录中有多个文件，则语法错误。
    *   `x='a b'; [ "$x" = 'a b' ]`: POSIX 等价物
*   `=`

    *   `[[ ab = a? ]]`：是的，因为它会进行[模式匹配](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_13)（`* ? [`很神奇）。不 glob 扩展到当前目录中的文件。
    *   `[ ab = a? ]`: `a?`glob 扩展。因此，根据当前目录中的文件，它可能是 true 或 false。
    *   `[ ab = a\? ]`: false，不是全局扩展
    *   `=`and在and`==`中是相同的，但是是一个 Bash 扩展。`[``[[``==`
    *   `case ab in (a?) echo match; esac`: POSIX 等价物
    *   `[[ ab =~ 'ab?' ]]`: false，`''`在 Bash 3.2 及更高版本中失去魔力，并且未启用对 Bash 3.1 的兼容性（如`BASH_COMPAT=3.1`）
    *   `[[ ab? =~ 'ab?' ]]`： 真的
*   `=~`

    *   `[[ ab =~ ab? ]]`： 真的。POSIX[扩展正则表达式](http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap09.html#tag_09_04)匹配并且`?`不全局扩展
    *   `[ a =~ a ]`: 语法错误。没有 Bash 等价物。
    *   `printf 'ab\n' | grep -Eq 'ab?'`: POSIX 等效项（仅单行数据）
    *   `awk 'BEGIN{exit !(ARGV[1] ~ ARGV[2])}' ab 'ab?'`: POSIX 等价物。

**建议：一直使用`[]`**

`[[ ]]`我见过的每个构造都有 POSIX 等价物。

如果你使用`[[ ]]`你：

*   失去便携性
*   迫使读者了解另一个 Bash 扩展的复杂性。`[`只是一个名称怪异的常规命令，不涉及特殊语义。

感谢[Stéphane Chazelas](https://unix.stackexchange.com/users/22565/st%C3%A9phane-chazelas)的重要更正和补充。

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2009-03-21T15:32:50.133

`[[ ]]`有更多的特性——我建议你看一下*[Advanced Bash Scripting Guide](http://tldp.org/LDP/abs/html/)*以获得更多信息，特别是[第 7 章中的](http://tldp.org/LDP/abs/html/testconstructs.html#EX11)*[扩展测试命令](http://tldp.org/LDP/abs/html/testconstructs.html#DBLBRACKETS)*部分。测试。

顺便说一下，正如指南所指出的，`[[ ]]`它是在 ksh88（KornShell 的 1988 版本）中引入[的](https://en.wikipedia.org/wiki/KornShell)。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-03-21T15:34:15.340

哪个*[比较器、测试、支架或双支架最快？](http://web.archive.org/web/20120311112022/http://bashcurescancer.com/which-comparator-test-bracket-or-double-bracket-is-fastest.html)*：

> 双括号是一个“复合命令”，其中 test 和单括号是 shell 内置的（实际上是相同的命令）。因此，单括号和双括号执行不同的代码。
> 
> 测试和单括号是最便携的，因为它们作为单独的外部命令存在。但是，如果您使用任何远程现代版本的 BASH，则支持双括号。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2019-06-25T21:55:54.207

如果您喜欢遵循[​​Google 的风格指南](https://google.github.io/styleguide/shellguide.html#s6.3-tests)：

> ## 测试`[ … ]`, 和`[[ … ]]`
> 
> `[[ … ]]`优于`[ … ]`,`test`和`/usr/bin/[`.
> 
> `[[ … ]]``[[`减少了错误，因为和之间没有路径名扩展或分词`]]`。此外，`[[ … ]]`允许正则表达式匹配，而`[ … ]`不允许。
> 
> ```
> # This ensures the string on the left is made up of characters in
> # the alnum character class followed by the string name.
> # Note that the RHS should not be quoted here.
> if [[ "filename" =~ ^[[:alnum:]]+name ]]; then
>   echo "Match"
> fi
> 
> # This matches the exact pattern "f*" (Does not match in this case)
> if [[ "filename" == "f*" ]]; then
>   echo "Match"
> fi 
> ```
> 
> ```
> # This gives a "too many arguments" error as f* is expanded to the
> # contents of the current directory
> if [ "filename" == f* ]; then
>   echo "Match"
> fi 
> ```
> 
> 有关血腥细节，请参阅[http://tiswww.case.edu/php/chet/bash/FAQ上的 E14](http://tiswww.case.edu/php/chet/bash/FAQ)

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2020-07-14T13:05:18.583

在标题中明确包含“in Bash”的标记为“bash”的问题中，我对所有回复说你应该避免`[[`......`]]`因为它只在 bash 中有效！

确实，可移植性是主要的反对意见：如果你想编写一个在 Bourne 兼容的 shell 中工作的 shell 脚本，即使它们不是 bash，你应该避免`[[`...。`]]`（如果你想在更严格的 POSIX shell 中测试你的 shell 脚本，我建议`dash`；虽然它是一个不完整的 POSIX 实现，因为它缺乏标准所需的国际化支持，但它也缺乏对发现的许多非 POSIX 构造的支持在 bash、ksh、zsh 等中）

我看到的另一个反对意见至少适用于 bash 的假设：那`[[`...`]]`有它自己的特殊规则，你必须学习，而`[`...`]`就像另一个命令一样。这又是真的（桑蒂利先生带来了显示所有差异的收据），但差异是好是坏是相当主观的。我个人发现，双括号结构让我可以使用`(`...`)`进行分组、`&&`布尔`||`逻辑、`<`比较`>`和不带引号的参数扩展。它就像它自己的小封闭世界，表达式的工作方式更像是在传统的非命令 shell 编程语言中。

我没有看到的一点是 ... 的这种行为`[[`与算术扩展构造...的行为`]]`完全一致，它*由*POSIX 指定，并且还允许不带引号的括号以及布尔和不等式运算符（在此处执行数字而不是词法比较）。本质上，每当您看到双括号字符时，您都会获得相同的引号屏蔽效果。`$((``))`

 *（Bash 和它的现代亲戚也使用`((`... `))`- 没有前导`$`- 作为 C 风格的`for`循环头或执行算术运算的环境；这两种语法都不是 POSIX 的一部分。）

所以有一些很好的理由更喜欢`[[`...... `]]`；也有理由避免它，这可能适用于您的环境，也可能不适用。至于你的同事，“我们的风格指南这么说”是一个有效的理由，就它而言，但我也会从理解风格指南为什么推荐它的人那里寻找背景故事。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-03-21T17:23:12.980

您无法使用的典型情况`[[`是在 autotools configure.ac 脚本中。括号有一个特殊的和不同的含义，所以你将不得不使用`test`代替`[`或`[[`-- 注意 test 和`[`是同一个程序。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-03-19T14:59:51.953

[[ ]] 双括号在某些版本的[SunOS](https://en.wikipedia.org/wiki/SunOS)下不受支持，并且在函数声明中完全不受支持：

GNU Bash，版本 2.02.0(1)-release (sparc-sun-solaris2.6)

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2010-11-24T16:08:48.837

简而言之， [[ 更好，因为它不会分叉另一个进程。没有括号或单括号比双括号慢，因为它分叉了另一个进程。

# .net - WinForms中.NET 1.1的任何图片库控件？

> ID：669455
> 
> 赞同：0
> 
> 时间：2009-03-21T15:30:48.937
> 
> 标签：.net, winforms, image-gallery, .net-1.1

我需要一个 UserControl 来在 Winforms 中将图片显示为图库。我有我的图片作为图像集合，但更改以适应控制功能没有问题。

如果它适用于 .NET 1.1 可能会很好，但由于我计划将所有代码迁移到 2.0，如果控件位于该框架中，它在未来可能会很有用

如果它是免费的更好:)

有没有人知道这样的控件？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-21T16:31:12.613

AFAIK 没有内置任何东西来显示画廊，但如果你愿意使用 2.0，你可以很容易地将一个与 TableLayoutPanel 放在一起。

# jquery - ASP.NET MVC jQuery AJAX 调用 Action 方法太晚了？

> ID：669459
> 
> 赞同：2
> 
> 时间：2009-03-21T15:32:56.747
> 
> 标签：jquery, asp.net-mvc, ajax

我在一个外部 Javascript 文件中有一些 jQuery 代码，它正在对我的控制器中的操作方法进行 ajax 调用。外部 Javascript 文件中的代码如下。action 方法最终被调用，但是它没有被及时调用。当我在操作方法中设置断点时，直到提交按钮单击返回 false 后才会调用它。当 EmailExist 函数返回“isvalid”时，isvalid 未定义。

所以它不是最终调用动作方法的问题，它只是不会因为任何原因被调用 EmailExist 总是返回 undefined 并且在返回按钮单击之前不会调用 MVC Action 方法。有什么想法吗？

行动方法：

```
 [AcceptVerbs(HttpVerbs.Post)]
    public JsonResult EmailExist(string email)
    {
        Account account = _generalService.GetAccountByEmail(email);

        bool exist = false;
        if (account != null)
            exist = true;

            return Json(new { indb = exist });
    } 
```

Javascript：

```
$(document).ready(function() {
$("input[type=submit]").click(function() {

    var valid = true;

    // email - check required and valid

    var email = $("input[name='email']");
    var emailtrim = jQuery.trim(email.val());

    // email exists in db ajax request
    if (EmailExist(emailtrim)) {
        valid = false;
    }

    return valid;
})

function EmailExist(emailval) {

    var isvalid;

    // hit db
    $.ajax(
    {
    type: "POST",
    url: "/Account/EmailExist",
    data: { 'email': emailval },
    success: function(result) {

        if (result.indb) {
            isvalid = true;

        }
    },
    error: function(error) {
        alert(error);
    }
});

    return isvalid;
} 
```

});

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-21T15:37:08.267

看起来您希望请求是同步的。要实现这一点，您需要将请求上的 async 选项设置为 false。默认设置是异步请求，以便在请求完成之前从 ajax 调用返回。或者，您可以重写代码，以便成功回调实际完成工作。后者对于 AJAX 更为惯用——但有时可能更复杂。

```
$.ajax(
    {
    type: "POST",
    async: false,              // <- note addition
    url: "/Account/EmailExist",
    data: { 'email': emailval },
    success: function(result) {

        if (result.indb) {
            isvalid = true;

        }
    },
    error: function(error) {
        alert(error);
    }
}); 
```

或者

```
$("input[type=submit]").click(function() {

    // email - check required and valid

    var form = $(this).parent('form');
    var email = $("input[name='email']");
    var emailtrim = jQuery.trim(email.val());

    SubmitIfNoEmailExists(form,emailtrim);

    return false;
});

function SubmitIfNoEmailExists(form,emailval) {

    // hit db
    $.ajax({
        type: "POST",
        url: "/Account/EmailExist",
        data: { 'email': emailval },
        success: function(result) {
            if (!result.indb) {
               form.submit();
            }
        },
        error: function(error) {
            alert(error);
        }
    });
} 
```

**编辑**：根据您的评论，您可能还想考虑使用 jQuery[验证插件](http://plugins.jquery.com/project/validate)作为您所有验证需求的解决方案。

# c - ANSI C 蓝牙 API 和 Linux 教程

> ID：669462
> 
> 赞同：5
> 
> 时间：2009-03-21T15:34:30.143
> 
> 标签：c, linux, bluetooth

Linux 中是否有适用于 ANSI C 的蓝牙 API 和教程？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-21T16:15:27.847

显然它不会是 ANSI C，但在 Linux 中有一个很棒的[蓝牙堆栈](http://www.bluez.org/)，与[D-BUS](http://www.freedesktop.org/wiki/Software/dbus)结合让您可以轻松地做伟大的事情。

[您可以在他们的 wiki 上](http://wiki.bluez.org/)找到教程。

我希望你和我一样喜欢在 Linux 上编程蓝牙。

# compiler-construction - 需要一个后端编译器

> ID：669466
> 
> 赞同：8
> 
> 时间：2009-03-21T15:35:12.030
> 
> 标签：compiler-construction

我创建了一个生成中间代码的编译器。我没有时间为我的项目编写后端。

**有什么软件可以用来评估生成的中间代码吗？我在哪里可以下载这个软件？**

输出看起来像这样：

```
 t1 = 0.67596e-7
    sum = t1

    t1 = 2
    t2 = 3
    t3 = t2 + t1
    i = t3

L0:
    t1 = sum
    t2 = 20
t3 = compare(t1 <= t2)
    t4 = sum
    t5 = 12
t6 = compare(t4 ~= t5)
t7 = t3 | t6
    t8 = sum
    t9 = 20
t10 = compare(t8 > t9)
t11 = t7 & t10
if t11 true then goto L1 else goto L2
L1: 
    t1 = 2
    t2 = sum
    t3 = t2 + t1
    sum = t3

    t1 = 1
    t2 = i
    t3 = t2 + t1
    i = t3
    goto L0
L2: 
```

谢谢阅读。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-21T20:07:02.597

代码生成是我的事:-)

对几个选项的评论：

*   CLR：

    *   优点：工业支持
    *   缺点：你必须完全接受他们的类型系统；取决于你想对类型做什么，这可能无关紧要
    *   缺点：只有 Windows 平台才是真正的黄金时间质量
*   LLVM：

    *   优点：热情的用户社区和有魅力的领导者
    *   优点：许多有趣的性能改进
    *   缺点：有点复杂的界面
    *   缺点：工程漏洞的历史；随着 LLVM 的成熟，期望通过增加接口的复杂性来填补工程中的漏洞
*   [C -](http://www.cminusminus.org/)

    *   优点：目标是一种实际的书面语言，而不是 API；您可以轻松地检查、调试和编辑您的 C 代码
    *   优点：设计相当成熟且相当干净
    *   Pro：支持准确的垃圾回收
    *   优点：大多数用户报告它非常易于使用
    *   缺点：非常小的开发团队
    *   缺点：截至 2009 年初，仅支持三个硬件平台（x86、PPC、ARM）
    *   缺点：不附带垃圾收集器
    *   缺点：项目的未来不确定
*   C 作为目标语言

    *   优点：看起来很简单
    *   缺点：几乎不可能获得体面的表现
    *   缺点：从长远来看会让你发疯；询问那些尝试使用这种技术编译 Haskell、ML、Modula-3、Scheme 等的人。在某些时候，这些人中的每一个人都放弃了并构建了自己的本机代码生成器。

总结：**除了 C 以外**的任何东西都是合理的选择。对于灵活性、质量和预期寿命的最佳组合，我可能会推荐 LLVM。但是您的示例代码非常接近 C--，因此这可能是一个优势。

全面披露：我隶属于 C-- 项目。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-21T15:39:13.457

看看[llvm 编译器基础设施项目](http://llvm.org/)。它被用于许多现实世界的项目中。LLVM 是一个低级虚拟机，易于创建代码并易于转换为本机代码。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-21T15:38:28.917

您发出的代码看起来非常接近 C - 为什么不让您的编译器发出 C 并使用 C 编译器作为后端 - 这就是原始 C++ cfront 编译器的工作方式。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-21T20:50:52.413

我建议吐出 Pascal 代码并使用[Free pascal](http://www.freepascal.org/)。

它是本地编译的，编译速度非常快，您可以针对大量平台。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-21T15:39:52.957

为什么不将另一种高级语言作为中间输出，例如您可以生成 C 代码，并使用任何 C 编译器来编译它。过去，这已被许多高级语言使用。

另一个稍低级别的选项是生成 IL 代码并使用 .NET 运行时。如果编译器是用 .NET 编写的，您可以使用 Reflection.Emit 命名空间来生成一个 .NET 程序集，然后该程序集可以在任何 .NET 环境中运行。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-21T16:34:53.917

选择编译器堆栈并使用该堆栈支持的中间代码可能会更好。例如，gcc 使用[RTL](http://gcc.gnu.org/onlinedocs/gccint/RTL.html)，将寄存器传输语言作为 gcc 支持的所有语言的公分母。我怀疑.net 有类似的东西用于 IronPython 之类的东西。

如果您想使用提供虚拟机来评估代码的东西，[SPIM MIPS](http://pages.cs.wisc.edu/~larus/spim.html) vm 支持摩托罗拉 68000 架构，并且非常易于使用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-21T16:57:52.457

[NekoVM](http://nekovm.org/specs)旨在接受类似于您的高级 IL，然后运行它。Neil Butterworth 建议使用 C 也是一个不错的选择。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-21T18:05:41.467

如果您可以容忍对 JVM 的依赖，那么使用[ASM](http://asm.objectweb.org/)生成字节码非常简单。

如果你不能，那么[gnu 闪电](http://www.gnu.org/software/lightning/)可以用于动态代码生成（比 LLVM 更小更简单，但没有优化）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-21T18:14:28.997

由于您的代码是`C`-ish，您可以尝试[`C--`](http://www.cminusminus.org/). 它是`C`编译器后端的类似语言。IIRC，它被主要的 Haskell 编译器之一使用。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-06-07T12:24:40.890

强烈推荐 llvm，一个跨平台的基础设施，支持机器代码生成和多次优化。llvm.org 上的教程非常简单。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-04-14T20:03:50.530

没有人提到的另一个选择是[QBE](https://c9x.me/compile/)。

> QBE 旨在成为一个纯 C 可嵌入后端，在 10% 的代码中提供高级编译器 70% 的性能。

它就像 LLVM，但作为依赖项要轻得多。从[与 LLVM 的比较](https://c9x.me/compile/doc/llvm.html)：

> QBE 适用于业余语言设计师。
> 
> 它并没有解决在构思工业级语言时面临的所有问题。如果你在玩弄一些语言创意，使用 LLVM 就像用卡车拖着你的背包，但使用 QBE 感觉更像是骑自行车。

# macos - 将 Yahoo Messenger 日志转换为 Adium 日志

> ID：669470
> 
> 赞同：0
> 
> 时间：2009-03-21T15:38:00.293
> 
> 标签：macos, yahoo-messenger, adium

有没有办法将日志从 YM for mac 转换为 Adium ？

谢谢塞萨尔

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-10-11T12:35:32.090

```
#!/usr/bin/perl
use warnings;
use strict;
use File::Find;
use File::Copy;
use Getopt::Long;

my $inDir = undef;
my $outDir = undef ;
my $adiumUser = undef;
my $force = 0;
my $foundLogs = 0;
my $help = 0;

my %Protocols = (               #Map gaim protocol IDs to Adium ones
                                "aim"   =>      "AIM",
                                "yahoo" =>      "Yahoo!",
                                "msn"   =>      "MSN"
                                #Add the rest here, or tell me what they are, someone who uses other protocols
                                );

sub usage
{
        my $msg = shift;
        print   "Error: $msg\n" if $msg;
        print   "Usage: gaim2adium.pl [--adiumUser <user> | --outDir <output dir>] [--inDir <input dir>] [--yes]\n";
        print   "Options: (defaults)\n\n";
        print   "\tinDir:\t\t\tDirectory to import logs from (~/.gaim/logs)\n";
        print   "\toutDir:\t\t\tDirectory to import logs to (./Logs)\n";
        print   "\tadiumUser:\t\tAttempt to automatically import logs to the specified Adium user\n";
        print   "\tyes:\t\t\tDon't prompt before overwriting existing logs\n";
        print   "\thelp:\t\t\tDisplay this help.\n";
        print   "\nOnce the logs have been imported, the contents of outDir can be dragged to your Adium log folder\n\n";
        exit(1);
}

sub process_log
{
        -f or return;
        #gaim logs are LOG_BASE/Protocol/Account/Contact/YYYY-MM-DD-TIME.(html|txt)
        if($File::Find::name =~ m!^$inDir(?:/)?(.*?)/(.*?)/(.*?)/(\d{4})-(\d{2})-(\d{2})\.(\d{4})(\d{2}).(html|txt)!)
        {
                my ($proto,$acct,$contact,$year,$month,$day,$hour,$seconds,$ext) = ($1,$2,$3,$4,$5,$6,$7,$8,$9);
                return unless defined ($proto = $Protocols{lc $proto});
                $foundLogs = 1;         #Set the logs found flag
                my $outFN = "$contact ($year|$month|$day).";
                $outFN .= ((lc $ext) eq "html") ? "html" : "adiumLog";
                mkdir("$outDir/$proto.$acct");
                mkdir("$outDir/$proto.$acct/$contact");
                my $file = "$outDir/$proto.$acct/$contact/$outFN";
                if(-e $file && !$force)
                {
#                       print(($adiumUser?"$adiumUser already has":"There already exists"),
#                        " a log from $proto.$acct to $contact on $day/$month/$year.\n");
                        `cat '$File::Find::name' >> '$file'`;
                } else {
                        copy($File::Find::name,$file);
                }
                `touch -t $year$month$day$hour.$seconds '$file'`;
        }
}

#Sort a list of log files by time
sub sort_logs
{
        my @files = @_;
        return sort logcmp @files;
}

sub logcmp
{
        my ($t1,$t2);
        $t1 = $& if $a =~ /\d{6}/;
        $t2 = $& if $b =~ /\d{6}/;
        return 0 unless defined($t1) && defined($t2);
        return $t1 <=> $t2;
}

GetOptions(     "adiumUser=s"   =>      \$adiumUser,
                        "inDir=s"               =>      \$inDir,
                        "outDir=s"              =>      \$outDir,
                        "yes"                   =>      \$force,
                        "help"                  =>      \$help)
        or usage();
usage() if $help;
usage("You must supply at most one of adiumUser and outDir") if defined($outDir) && defined($adiumUser);

$outDir ||= "$ENV{HOME}/Library/Application Support/Adium 2.0/Users/$adiumUser/Logs" if defined $adiumUser;
$outDir ||= "$ENV{PWD}/Logs";

$inDir ||= shift;
$inDir ||= "$ENV{HOME}/.gaim/logs";

print "NOTE: Output directory exists, existing logs will be appended to.\n" if(-d $outDir);

mkdir($outDir) unless -e $outDir;
usage("Output dir must be a directory") unless -d $outDir;
usage("Output dir must be writeable") unless -w $outDir;

usage("Input directory '$inDir' does not exist") unless -d $inDir;
usage("Input directory '$inDir' is not readable") unless -r $inDir;

#Spider the logs dir
find({wanted => \&process_log,
                preprocess => \&sort_logs}, $inDir);

#Warn if we didn't find any logs
unless($foundLogs)
{
        print "Warning: No recognized logs found.\n";
        print "Note:\tThis script only supports logs generated by gaim 0.73 and above.\n";
        print "\tYou may be able to update older gaim logs to the new format using the script from\n";
        print "\thttp://sourceforge.net/forum/message.php?msg_id=2392758\n";
        exit(1);
}

exit(0); 
```

# iphone - iPhone cocos2d sprites in array，内存问题

> ID：669482
> 
> 赞同：3
> 
> 时间：2009-03-21T15:42:30.530
> 
> 标签：iphone, cocos2d-iphone, sprite

我试图在一个数组中跟踪我的精灵，在图层中添加和删除它们，然后最终将它们从数组中清除。

我正在使用以下代码：

```
Sprite * Trees[50];
Layer * Forest;

Forest =  [Layer node];
Forest.isTouchEnabled = YES;
[self addChild:Forest z:30];

// do this a bunch of times
Trees[0] = [[Sprite spriteWithFile:@"mytree.png"] retain];
[Trees[0] setPosition:cpv(240,160)];
[Forest addChild:Trees[0] z:5]; 
```

然后当我想摧毁一棵树时，我使用：

```
[Forest removeChild:Trees[0] cleanup:YES];
[Trees[0] release]; 
```

我的问题是，当我查看 Instruments 时，我永远不会回收该内存，永远不会有下降。我认为通过释放精灵可以释放内存。我这样做完全错了吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-14T01:26:20.487

我知道当你使用 cocos2d 的模拟器时，内存看起来并没有被释放，所以你必须在设备上运行它才能准确了解正在发生的事情。

[这里](http://groups.google.com/group/cocos2d-iphone-discuss/browse_thread/thread/8503654350dc4239/12bccf1375831ea5?lnk=gst&q=memory#12bccf1375831ea5)有一个关于 cocos2d 和内存的很好的讨论。

我注意到的是，您创建和保留的所有内容都必须释放，但在我这样做之前它不会从内存中释放：

```
[[TextureMgr sharedTextureMgr] removeAllTextures]; 
```

这将释放内存。

这是一个更大的例子：

```
Sprite * sPopup = [[Sprite spriteWithFile:@"popup.png"] retain];
    sPopup.position = cpv(240,440);
    [self addChild: sPopup z:2];
[sPopup release]; 
```

然后，当我在另一个函数中完成 sPopup 时，我有这个：

```
[[TextureMgr sharedTextureMgr] removeAllTextures]; 
```

并且内存被释放。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-21T16:11:18.450

我的怀疑是你“过度”保留：

```
Trees[0] = [[Sprite spriteWithFile:@"mytree.png"] retain]; 
```

如果 Trees 是函数中的局部变量，如果 spriteWithFile 返回具有自动释放功能的 Sprite，则在这种情况下您不必保留。

[Apple 文档](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/mmObjectOwnership.html#//apple_ref/doc/uid/20000043-1000580)中关于延迟发布的部分对此进行了进一步讨论。总而言之，自动释放的接收者保证让对象在其范围内有效。如果您需要超出函数范围的对象（例如 Trees 是类的属性），那么是的，在这种情况下，您需要一个保留（或者只是合成一个配置为保留的属性）。

通过发出额外的保留，您的保留计数可能总是太高（永远不会达到 0），因此您的对象不会被垃圾收集。

为了更好地衡量，我建议[您也回顾一下关于 objects 有效性的这一段](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/mmObjectOwnership.html#//apple_ref/doc/uid/20000043-1000922)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T00:13:39.857

即使您调用 [Trees[x] release]，我相信您仍然需要从数组中“删除”该项目，例如 Trees[x] = nil 或其他东西，因为数组本身仍然包含该对象。

Sprite 创建中的“保留”也不是必需的，因为 [Forest addChild:z:] 也会在其上放置保留（afaik）。

# database-design - 在 RDBMS 中为好友和追随者建模

> ID：669483
> 
> 赞同：3
> 
> 时间：2009-03-21T15:42:43.977
> 
> 标签：database-design, data-modeling, rdbms

我正在尝试确定在关系数据库中对记录关系进行建模的最佳方法。这是经典的朋友/关注模式：

~~~~

一个用户可以有零到多个朋友。
一个用户可以有零到多个关注者。

朋友和追随者都是用户本身。

~~~~~

对此进行建模的最佳方法是什么？

谢谢！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-21T15:44:48.420

用户 (UserId, ...)
订阅 (Subscriber, Publisher)
友谊 (FirstUser, SecondUser)

```
CREATE TABLE Users (
    UserID int not null primary key,
    ...
)

CREATE TABLE Subscription (
    Subscriber int not null references Users(UserID),
    Publisher int not null references Users(UserID),
    constraint ck_NotEqual check (Subscriber <> Publisher)
)

CREATE TABLE Friendship (
    FirstUser int not null references Users(UserID), 
    SecondUser int not null references Users(UserID),
    constraint ck_Order check (FirstUser < SecondUser) -- since friendship is reflective
) 
```

# c# - 从文本文件中读取和解析整数

> ID：669485
> 
> 赞同：2
> 
> 时间：2009-03-21T15:42:59.907
> 
> 标签：c#, parsing, file-io

我正在尝试从文本文件中获取一行整数并将它们解析为单独的变量。文本文件设置如下：

ID:HP:MP:STR:WIS:SPD:GOLD:XP

0:100:50:10:5:12:5:10

我想在它们之间用 : 符号分割它们。我遇到的问题之一是能够逐行读取文件作为字符串，解析它们，然后将解析的字符串存储为整数。这是我到目前为止尝试使用的代码：

```
class monster
{
    string line;
    string[] mstats;
    string[] mname;
    char[] delimeterChars = {':'};
    int id;
    int i = -1;
    int j = 0;
    int hp;
    int mp;
    int str;
    int wis;
    int spd;
    int gold;
    int xp;

    public monster(int id)
    {
        StreamReader stats = new StreamReader("monsterStats.txt");
        while(i != id)
        {
            i++;
            line = stats.ReadLine();
            mstats = line.Split(delimeterChars);
            j = 0;
            foreach(string s in mstats)
            {
                if (j == 0) id = int.Parse(s);
                else if (j == 1) hp = int.Parse(s);
                else if (j == 2) mp = int.Parse(s);
                else if (j == 3) str = int.Parse(s);
                else if (j == 4) wis = int.Parse(s);
                else if (j == 5) spd = int.Parse(s);
                else if (j == 6) gold = int.Parse(s);
                else if (j == 7) xp = int.Parse(s);
                j++;
            }
        }
        curHp = hp;
        curMp = mp;
        curSpd = spd;
        curStr = str;
        curWis = wis;
    }
} 
```

运行此代码时出现以下错误：

输入字符串的格式不正确。它引用了这部分代码：

```
if (j == 0) id = int.Parse(s); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T15:48:42.280

为什么`foreach`？怎么样：

```
id = int.Parse(mstats[0]);
hp = int.Parse(mstats[1]); 
```

等等。事先检查`mstats`足够长的时间。

一点 Linq 可以让你一次获得一个整数数组：

```
int[] fields = line.Split(delimeterChars).Select(s => int.Parse(s)).ToArray();

id = field[0];
hp = field[2]; 
```

至于让代码正常工作，请尝试在将文本传递给 Parse 之前打印出文本行和每段文本。如果它不是整数，那是你的问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-21T15:57:57.297

嗯，第一件事是找出错误的输入是什么。

如果您*预计*输入数据错误，请使用[`int.TryParse`](http://msdn.microsoft.com/en-us/library/system.int32.tryparse.aspx)而不是仅使用[`int.Parse`](http://msdn.microsoft.com/en-us/library/system.int32.parse.aspx). 如果您*没有*预料到错误的输入数据，那么它引发异常的事实可能是合适的 - 但您应该检查您的数据以找出问题所在。

我还建议进行*一次*解析调用，而不是每次都进行。这不像您正在为每个字段进行不同类型的解析。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-21T16:44:57.743

解析文本输入的一个非常好的方法总是正则表达式。

```
Regex r = new Regex(@"(?<id>\d+):(?<hp>\d+):(?<mp>\d+):(?<str>\d+):(?<wis>\d+):(?<spd>\d+):(?<gold>\d+):(?<xp>\d+)");

// loop over lines
Monster m = new Monster();
Match mc = r.Match(input);

m.hp = GetValue(mc.Groups["hp"], m.hp);
m.mp = GetValue(mc.Groups["mp"], m.mp);
m.str = GetValue(mc.Groups["str"], m.str);
...

// method to handle extracted value
private static int GetValue(Group g, int fallback)
{
    if (g == null) throw new ArgumentNullException("g");
    return g.Success ? Convert.ToInt32(g.Value) : fallback;
} 
```

GetValue 方法检查提取的值。如果匹配失败（可能是“”或“AB”而不是数字 - g.Success 为假），您可以按照您想要的方式处理它。以我的方式，我只是使用后备值。

[http://msdn.microsoft.com/en-us/library/hs600312.aspx](http://msdn.microsoft.com/en-us/library/hs600312.aspx)

# php - 检测不足的 PHP 变量：FALSE vs NULL vs unset() vs empty()？

> ID：669488
> 
> 赞同：1
> 
> 时间：2009-03-21T15:44:29.543
> 
> 标签：php

定义一个值在 PHP 中不存在或不足以满足应用程序需求的最佳方法是什么。

`$var = NULL`, `$var = array()`, `$var = FALSE`?

什么是最好的测试方法？

`isset($var)`, `empty($var)`, `if($var != NULL)`, `if($var)`?

将变量初始化为它们将是什么，例如，`NULL`如果一个字符串，`array()`如果它们将是数组，有一些好处，因为它们将在它们被设置的设置中起作用而没有任何意外结果。

eg`foreach($emptyArray)`不会抱怨它只是不会输出任何东西，而`foreach($false)`会抱怨错误的变量类型。

但是，有这么多不同的方式来做基本相同的事情，这似乎是一种不必要的麻烦。例如。`if(empty($var))`或者`if ($var == NULL)`

* * *

**重复：** [在 PHP 中测试变量是否存在的最佳方法；isset() 明显坏了](https://stackoverflow.com/questions/418066)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-21T17:07:06.443

您命名的每个函数都有不同的用途，应相应地使用它们：

*   **[empty](http://us2.php.net/manual/en/function.empty.php)**：告诉现有变量是否具有可被视为空的值（数字为 0，数组为空数组，等于 NULL 等）。
*   **[isset($var)](http://us2.php.net/manual/en/function.isset.php)**：告诉脚本是否在变量位于赋值左侧的位置之前遇到了一行（即 $var = 3;）或任何其他晦涩的方法，例如[extract](http://us2.php.net/manual/en/function.extract.php)、 [list](http://us2.php.net/manual/en/function.list.php)或[eval](http://us2.php.net/manual/en/function.eval.php)。这是查找变量是否已设置*的方法。*
*   **[$var == NULL](http://us2.php.net/manual/en/types.comparisons.php)**：这很棘手，因为 0 == NULL。如果你真的想判断一个变量是否为NULL，你应该使用triple =: $var === NULL。
*   **[if($var)](http://us2.php.net/manual/en/types.comparisons.php)** : 与 $var == NULL 相同。

有用的链接是[http://us2.php.net/manual/en/types.comparisons.php](http://us2.php.net/manual/en/types.comparisons.php)。

判断变量是否适合您正在编写的一段脚本的方法将完全取决于您的代码，因此没有单一的检查方法。

最后一条建议：如果您希望一个变量是一个数组，不要等待它被设置在某个地方。相反，事先初始化它，然后让你的代码运行，也许它会被一个新数组覆盖：

```
// Initialize the variable, so we always get an array in this variable without worrying about other code.
$var = array();

if(some_weird_condition){
  $var = array(1, 2, 3);
}

// Will work every time.
foreach($var as $key => $value){
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T17:08:54.287

要记住的另一件事是，由于 php 在允许评估为 NULL 或空的方面是自由的，因此有必要使用身份运算符（===，！== 请参阅[http://php.net/operators.comparison](http://ca.php.net/operators.comparison)。这这就是所有这些比较和相等函数存在的原因，因为您经常必须区分具有细微差异的值。

如果您明确检查 NULL，请始终使用 $var === NULL

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-21T16:05:43.580

我投票支持 unset()，因为不存在的变量在使用时应该生成通知。

测试变得有点复杂，因为如果变量“不存在”或为空， isset() 将是错误的。（如果你问我，语言设计缺陷）

您可以将array_key_exists() 用于$GLOBALS、$_POST 等中的变量。
对于类属性，有property_exists()。

# asp.net-mvc - windows 7 asp.net mvc RC

> ID：669491
> 
> 赞同：2
> 
> 时间：2009-03-21T15:44:54.473
> 
> 标签：asp.net-mvc, visual-studio-2008, windows-7

我在 Windows 7 上遇到了 asp.net mvc 的问题...以前安装了 asp.net mvc RC，我安装了 MVC rtm...它说“此安装不支持项目类型”...无论如何将此项目类型注册到 Visual Studio 或取消注册 rc 版本？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-21T17:04:31.410

卸载每个 ASP.NET MVC 安装（在控制面板中）并重新安装最终的 1.0 版本。如果没有帮助，请以管理员身份运行 Visual Studio 命令提示符并运行：

```
devenv /resetskippkgs 
```

没有把握。帮过我一次。我希望这对你有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-08T01:04:27.017

我遇到过同样的问题。即使您可能拥有 MVC 2，您也必须安装 MVC 1.0。我这样做了，它对我有用。操作系统版本：Windows 7 IDE：Visual Web Developer 2008 Express

# asp.net - ASP.NET MVC - 有没有办法模拟 ViewState？

> ID：669492
> 
> 赞同：9
> 
> 时间：2009-03-21T15:45:55.780
> 
> 标签：asp.net, asp.net-mvc, session, viewstate, state-management

我有以下情况... 在某个View中，用户必须选择开始时间、结束时间和工作日。但是，我无法将这些信息保存到数据库，因为我需要保存整个页面并且我需要主表的主键，但这不是重点。

所以，虽然我没有将这些数据保存到数据库中，但我正在保存到会话中。我被告知要保存到 cookie，但似乎 cookie 有大小限制。所以，我正在保存到一个会话。

Buuuut，我还被告知我可以将这些信息（小时和工作日）保存到用户页面，模拟 ASP.NET ViewState...

有谁知道如何做到这一点？？有谁知道如何在不使用 cookie 或 Session 的情况下临时保存这些数据？

谢谢！！

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-21T15:48:30.220

隐藏的输入字段没有帮助？

```
<%= Html.Hidden(...) %> 
```

更新（将对象序列化为 base64）：

```
var formatter = new BinaryFormatter();
var stream = new MemoryStream();
formatter.Serialize(stream, myObject); // myObject should be serializable.
string result = Convert.ToBase64String(stream.ToArray()); 
```

当你想取回它时：

```
var formatter = new BinaryFormatter();
var stream = new MemoryStream(Convert.FromBase64String(hiddenFieldValue));
var myObject = (MyObjectType)formatter.Deserialize(stream); 
```

确保在使用字段时验证存储在字段中的数据，因为客户端可能会更改它。`ViewState`自动处理这个。

*旁注：* ASP.NET 使用[`LosFormatter`](http://msdn.microsoft.com/en-us/library/system.web.ui.losformatter.aspx)而不是`BinaryFormatter`序列化`ViewState`，因为它更有效或基于 ASCII 的序列化。您可能也想考虑这一点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-21T23:56:26.710

TempData["MyData"]，请注意，这只会持续一次往返。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T15:59:31.910

您可以在客户端上保存一个 javascript 数组......然后在用户最终保存时传输所有信息。

你必须多做一点工作，但最终它会得到回报。

我大量使用[jQuery](http://jquery.com/)来做这样的事情，它比看起来更容易。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T16:15:23.463

如果您只想保存该请求和下一个请求的数据，我建议使用 Tempdata，否则我建议使用 Mehrdad 的答案。

# string - 编程语言参考：字符串替换

> ID：669494
> 
> 赞同：0
> 
> 时间：2009-03-21T15:48:14.823
> 
> 标签：string, reference, replace

我正在查看是否值得创建一个参考来展示如何用多种编程语言做常见的事情。

请在下面列出您将用于以您选择的编程语言实现以下目标的命令：

字符串替换

例子：

PHP：

```
mixed str_replace ( mixed $search , mixed $replace , mixed $subject [, int &$count ] ) 
```

目标-C：

```
- (NSString *)stringByReplacingOccurrencesOfString:(NSString *)target withString:(NSString *)replacement 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T15:55:38.987

爪哇：

```
String replaceAll(String regex, String replacement) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T16:00:01.253

TSQL

```
REPLACE ( string_expression , string_pattern , string_replacement ) 
```

# window - 无法使用 RIL WM6 获取 CID 和 LAC 以外的任何其他值

> ID：669505
> 
> 赞同：0
> 
> 时间：2009-03-21T15:53:42.487
> 
> 标签：window, windows-mobile, ril

无法使用 GetCellTowerInfo 使用 RIL WM6 获取 CID 和 LAC 以外的任何其他值，欢迎提供任何信息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-22T21:47:33.470

根据特定 Windows Mobile 设备的实现，RILCELLTOWERINFO 结构可能未完全填充。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-23T02:19:38.313

您使用的是哪个电话网络？

您会发现 Mcc 和 Mnc 仅存在于 GSM 设备上。

# version-control - 源代码管理：本地源代码树应该镜像服务器源代码树吗？

> ID：669515
> 
> 赞同：3
> 
> 时间：2009-03-21T15:59:54.997
> 
> 标签：version-control

让我的本地源代码树镜像服务器源代码树是最佳做法吗？在我看来应该是这样，但是我的工作部门并没有这样做，我觉得这很混乱。如果不是，那么在哪些情况下偏离服务器源代码树是有意义的？

编辑：为了澄清我的意思 - 说我们要在本地机器上映射的源目录在服务器上：

\\TeamServer\Project\Releases\2008

在我们的本地机器上，该目录将被映射如下：

D:\2008_Releases

代替：

D:\项目\发布\2008

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T16:26:25.013

我不知道这是否是最佳实践，但我也更喜欢镜像源代码树。就让新开发人员启动和运行而言，它少了一个“陷阱”。当涉及到相对路径时，不镜像源代码树最终会反过来咬你。

可能有人在最初设置时犯了错误，并且从未得到纠正。恕我直言，这是一个小烦恼；只是不生活在完美世界的副作用之一；）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T18:22:03.550

如果您的本地树需要与服务器上的路径相同，那么您不能签出多个副本。在我工作的最后两个地方，根据我正在处理的不同错误或功能的数量以及分支的数量，在任何给定时间检查树的（部分）副本是很常见的错误或功能所在的产品。

就个人而言，我不知道源代码树存储在服务器上的什么位置，我也不需要。我只是在我的工作目录中运行`cvs co`或`svn co`获取树的副本。只要我运行`make`或`ant`在源代码树的某个地方，它下面的所有内容都会编译。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T16:49:48.747

我更喜欢在自己的目录中尽可能接近根目录中的单个项目/发布对。这是一个可怕的 PITA，点击目录树或不得不无数次输入“c:\project\releases\2008”部分。

我还认为，检查不同路径的源代码往往会消除有关项目位置的错误假设（我们有构建后事件会做一些讨厌的事情）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T16:38:57.370

不这样做的原因之一是：当您可以访问生产机器时。在这种情况下，我更喜欢有不同的路径。这使我更有可能注意到我的“rm -rf”在错误的盒子上......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T18:28:22.193

我认为 mirrowing 是一种很好的做法，我也喜欢这样做，但是我有一个额外的临时文件夹，以防我需要签出新版本，例如使用当前版本测试某些内容或修复具有高优先级然后是我在做什么。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T18:36:22.127

最重要的是了解做出选择的原因，并与团队一起确定这是否是您想要改变的。团队购买对于这类决策很重要——团队不仅仅是开发人员。源代码控制树包含文档、测试、资源等内容，因此该结构很有可能由多方确定以找到共同点。

我们在我工作的地方也使用 TFS。我们确实有一个名为 C:\Source Control 的公共根文件夹，它是所有团队项目所在的主文件夹。之所以做出这个选择，是因为各方都非常不喜欢驱动器会被各种文件夹弄得乱七八糟。

使用 TFS，您可以选择映射多个工作区，因此您在本地计算机上执行的操作*不受*服务器结构的限制。我个人的偏好以及我的团队的偏好是使用单个工作区映射到源代码控制根目录。鉴于 TFS 中的搁置功能，不必担心签出多个副本，因为如果需要处理其他事情，它们可以被搁置。

构建服务器也具有相同的映射。然而，这绝不与部署结构相匹配。根据项目的标准删除构建。唯一出现问题的情况是在使用绝对路径时，例如在配置文件中。由于我们没有使用绝对路径（根据我们的开发人员指南中的定义），这不是问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-21T19:12:12.383

人们对如何组织硬盘有不同的看法，为什么要强制执行特定的布局？

应该能够在存储库中检出同一项目的多个工作副本——如果您坚持使用相同的层次结构，这是不可能的。

在我参与的一个大型项目中，数以千计的文件假定工作副本位于固定的绝对硬编码路径 ( `\projectname`) 中。为了与项目的多个分支一起工作，我们不得不求助于使用不同的驱动器号（在 Windows 上），这意味着我们必须将硬盘分成许多分区（通常 6 个或更多分区）。这很不方便。

最终，我们不得不将项目整合为一个更大项目的子项目。这意味着更改所有这些绝对路径，这是一项乏味且耗时的任务。

Using relative paths gives you much more flexibility; however, if everybody has the project root at the exact same location, you won't notice if someone adds an absolute path somewhere by accident.

# .net - 开源 RSS 解析器

> ID：669518
> 
> 赞同：3
> 
> 时间：2009-03-21T16:02:07.363
> 
> 标签：.net, open-source, rss

在推出我自己的 RSS 解析器之前，是否已经为 C# 编写了一个非常好的开源解析器？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T16:27:25.680

似乎[RSS.NET](http://sourceforge.net/projects/rss-net/)库值得一试。它似乎是相当完整的。[从代码示例](http://www.rssdotnet.com/documents/code_examples.html)来看，它似乎很容易使用。

**编辑：**我之前一直在寻找它，但由于某种原因找不到它...... RSS 联合现在实际上已作为 WCF 的一部分内置到 .NET Framework 3.5 中。有关介绍，请参阅[此 MSDN 杂志文章](http://msdn.microsoft.com/en-us/magazine/cc135976.aspx)（向下滚动查看有关联合 API 的部分）。[另请参阅此 SO 线程](https://stackoverflow.com/questions/576267/c-rss-reader)的答案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T16:56:04.363

有一个叫做[Argotic Syndication Framework](http://www.codeplex.com/Argotic)

如果我要自己动手，我可能会用这个作为参考。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T16:29:14.287

我最近使用了 codeplex 的[FeedDotNet](http://feeddotnet.codeplex.com/)。它使用起来非常简单，只需很少的时间就可以开始工作。

# ms-access - 在访问中禁用 msgbox

> ID：669520
> 
> 赞同：4
> 
> 时间：2009-03-21T16:03:48.827
> 
> 标签：ms-access, vba

我正在尝试在 MS Access 2003 SP3 中制作一个小表单，我使用了一些其他人制作的功能，这些功能中有 msgbox。我想在运行表单时禁用 msgbox。是否可以在 Access 中禁用 msgbox？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-25T17:53:53.833

我创建了名为 msgbox 的 finction。似乎它的工作。感谢大家的帮助。

```
Public Function MsgBox(Prompt, Optional Buttons As VbMsgBoxStyle = vbOKOnly, Optional Title, Optional HelpFile, Optional Context) As VbMsgBoxResult

If myProcedureisRunning then 
    VBA.MsgBox Prompt
else
    debug.print prompt
endif
End Function 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T02:25:19.847

如果事实上这些消息框是由 VBA 代码产生的，那么将它们注释掉。但是，如果它们是 Access 生成的，例如插入或更新记录时的消息框，则需要使用命令**DoCmd.SetWarnings False**来抑制它们。只需确保仅在需要时关闭警告，然后再将其打开。否则，Access 中的所有消息框都将关闭，即使在“设计模式”下​​也是如此。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T18:22:23.923

执行 CTRL-F 并查找 MSGBOX 并对其进行评论。我想这是你能做到的唯一方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T20:06:07.900

按 Alt+F11 打开 Visual Basic IDE，然后按 CTRL+F 进行搜索。类型

```
消息框
```

进入查找，选择“替换”并输入

```
'消息框
```

进入“替换为”框（注意撇号）。这将注释掉项目中的所有 msgbox 语句。

# .net - 如何在 ms 项目服务器中更新 TimeSheet

> ID：669522
> 
> 赞同：0
> 
> 时间：2009-03-21T16:06:35.823
> 
> 标签：.net, project-server

情况就是这样，我希望有一个用户可以代表其他人（以编程方式）输入时间。

当我为 ms 项目服务器的 web 服务执行 QueueUpdateTimeSheet 时，如果尝试为另一个输入时间，它就不起作用。

我尝试模拟，但我需要知道我想模拟的人的用户名和密码。我可以拥有这些信息，但我不想管理它。

我开始查看代理时间表。我不知道这是否会回应我的问题。

有谁能够帮助我 ...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T16:03:29.497

据我所知，没有什么神奇的方法可以让你替代时间表。如果您希望能够代表其他用户使用 QueueUpdateTimesheet 的方法，您将不得不“破解”一点您的 DataSet。

请注意，您需要完成模拟用户的先决条件 ( [http://msdn.microsoft.com/en-us/library/aa974413.aspx](http://msdn.microsoft.com/en-us/library/aa974413.aspx) )。全部完成后，您可以继续；）

首先，检索您的 timesheetRow：

```
Proxy.TimesheetListDataSet.TimesheetsRow tsFound = null;
            foreach (Proxy.TimesheetListDataSet.TimesheetsRow ts in ds.Timesheets)
            {
                if (ts.WPRD_START_DATE <= day.Date && ts.WPRD_FINISH_DATE > day.Date)
                {
                    tsFound = ts;
                    break;
                }
            } 
```

然后检索时间表数据集：

```
Proxy.TimesheetDataSet tds = timesheetSvc.ReadTimesheet(tsFound.TS_UID); 
```

然后执行此操作以启用代理：

```
if (Boolean.Parse(tds.Headers.Rows[0]["TS_IS_CONTROLLED_BY_OWNER"].ToString()) == true)
                {
                    tds.Headers.Rows[0]["TS_IS_CONTROLLED_BY_OWNER"] = false;
                    tds.Headers.Rows[0]["TS_CREATOR_RES_UID"] = "[SUPER USER GUID]"
                } 
```

最后推送更新的数据集：

```
timesheetSvc.QueueUpdateTimesheet(Guid.NewGuid(), tsFound.TS_UID, updatedTimesheetDataSet); 
```

希望能帮助到你！

告别

# sql - MSSQL 2005 存储过程中最大的文本可用变量？

> ID：669524
> 
> 赞同：1
> 
> 时间：2009-03-21T16:07:51.470
> 
> 标签：sql, sql-server, tsql, stored-procedures, stored-functions

MSSQL 存储过程中最大大小的文本可用变量是多少。我看到您可以使用的最大尺寸是 varchar(8000)。

我们可以使用ntext，text等。那么它需要将varchars拼接在一起吗？

如果我使用 CLR 存储过程呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T16:11:15.750

你试过 nvarchar(max) 吗？

另外，请说明您使用的是哪个版本的 SQL Server。

# asp.net - 动态设置控制适配器

> ID：669535
> 
> 赞同：1
> 
> 时间：2009-03-21T16:13:59.957
> 
> 标签：asp.net, dynamic, adapter

在 ASP.Net 中有没有办法动态设置控制适配器？应用控制适配器的标准方法是通过“.browser”文件。但是，我有一种情况，我想在某些情况下使用控制适配器，而不是在其他情况下 - 我找不到实现此目的的方法。

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-10-06T06:40:11.750

你想要的代码是：

```
Type controlType = typeof(HtmlForm);
Type adapterType = typeof(MyHtmlFormAdapter);
HttpContext.Current.Request.Browser.Adapters[controlType.AssemblyQualifiedName]
                    = adapterType.AssemblyQualifiedName; 
```

# iphone - 将 iphone 应用程序降级到以前的 SDK 是否安全？

> ID：669538
> 
> 赞同：2
> 
> 时间：2009-03-21T16:15:35.710
> 
> 标签：iphone

我发布了一个带有 2.2.1 SDK 的应用程序，意识到我正在毫无意义地失去大部分仍在使用固件 2.2 的客户（请参阅这篇文章：[http ://arstechnica.com/apple/news/2009/03/ app-store-lessons-firmware-followup.ars](http://arstechnica.com/apple/news/2009/03/app-store-lessons-firmware-followup.ars)）所以我正在考虑将应用程序更新到以前的 SDK，2.2。

我想知道是否有人在这样做时遇到任何问题？对于已经安装了以前版本的客户来说，安装我的“降级”更新是否安全？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T17:28:35.503

经验法则是针对最低版本的 SDK 构建和测试您的应用程序（基于所需的功能）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T16:25:37.587

我不知道这将是一个问题。尤其是 2.2.1 到 2.2——它确实是一个非常小的错误修复版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T16:34:47.440

我已经把一个应用商店应用从2.2.1换到了2.2，切换的时候没有遇到任何问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-21T17:51:07.103

Iphone os 版本 2.2.1 没有引入新的 API，因此将其降级到 2.2 应该没有问题。

在其他 SDK 版本（即 2.0 和 2.1）方面，苹果引入了新的/更新的 API。如果您的应用程序利用了这些新的/更新的 API，您应该针对将成功运行您的程序的最低版本的 iPhone OS 编译它。

对尽可能低的 iPhone OS 版本进行编译将确保您的应用程序能够由尽可能多的人运行。

# .net - 将旧的 .NET 代码拆分为设计器部分类

> ID：669540
> 
> 赞同：38
> 
> 时间：2009-03-21T16:16:53.257
> 
> 标签：.net, visual-studio

我正在开发一个较旧的 .NET 代码库，该代码库将所有设计器代码都填充到与我的代码相同的代码文件中（预部分类）。

是否有一种机制可以告诉 Visual Studio 2008 返回并将设计器代码重构为 X.designer.cs 部分类文件？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-04-21T11:33:51.570

我刚刚所做的完全是手动的：

1.  创建您的表单*.Designer.cs*
2.  将其添加到 Visual Studio（右键单击，添加现有项）
3.  将*partial*关键字添加到现有类中。
4.  **将与原始 cs 中完全相同的***命名空间* 添加到*yourform* .designer.cs
****   在这个命名空间中，添加*类*定义（不要忘记包含*partial*关键字）。**不要**在 Designer.cs 中向这个分部类添加继承和/或接口。*   完成后，您就可以*剪切*和*粘贴*以下内容了：***

 ***a) 删除您在原始 Winform 中可能拥有的*组件*对象。如果应用程序是 .NET 1.1，您将拥有如下内容：

```
 /// <summary>
    /// Required designer variable.
    /// </summary>
    private Container components = null; 
```

b)在 Designer 类中添加一个新的*组件对象：*

```
 /// <summary>
    /// Required designer variable.
    /// </summary>
    private System.ComponentModel.IContainer components = null; 
```

c) 除非您有*特定*的处置方法，否则这是标准。如果您没有任何形式的继承，我认为 base.Dispose 可以安全删除：

```
 /// <summary>
    /// Clean up any resources being used.
    /// </summary>
    /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
    protected override void Dispose( bool disposing )
    {
        if ( disposing && ( components != null ) )
        {
            components.Dispose();
        }
        base.Dispose( disposing );
    } 
```

d) 将**#region Windows 窗体设计器生成的代码中的****所有**代码 复制到新的 Designer.cs 类。

 **e) 您还应该复制您在设计器中使用的所有对象（标签、texbox 等）的**所有成员变量。**

这应该就是全部了。保存并编译。

## 请记住，一个部分类可以在 N 个文件中拆分，但所有文件都必须共享相同的命名空间。

值得吗？好吧，就我而言，我有一堆带有大量代码和控件的**巨大winform。**每次我从设计师切换到设计师时，VS2008 都会爬行。这使代码视图更具响应性。我记得在获得响应代码之前必须等待 3-5 秒。现在需要 1…</p>

* * *

## 更新：

执行步骤 1 到 5 并移动现有控件或添加新控件不会自动将任何内容移动到 Designer.cs 类。新的东西进入了新的 Designer 类，但不幸的是，旧的东西仍然保留在原来的位置。

您还必须*关闭*并重新打开文件（在添加/创建部分类之后），以便 VS 在设计器中正确绘制；不这样做可能会导致绘制空表格。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-10-08T15:00:47.610

如果有人仍在寻找一种自动执行此操作的方法，那么这里有一个 VS 宏[可以](http://blog.dotsmart.net/2008/05/20/converting-visual-studio-2003-winforms-to-visual-studio-20052008-partial-classes/)为您完成大部分工作。

一个非常好的工具。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-04-11T11:28:44.203

我对免费的独立应用程序[DeCodEx](http://coolsoft.altervista.org/en/decodex)（Designer Code Extractor）很幸运。

DeCodeEx 加载到 Visual Studio 项目中，检测哪些文件是 WinForms，并自动将设计器代码从原始文件`.cs`或`.vb`文件中拆分为新文件`.designer.cs`或`.designer.vb`文件。

对于大型项目，这比尝试自己手动拆分文件要容易得多。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-05-21T07:09:56.717

要将 yourForm.designer.cs 合并到 yourForm.cs，请按照以下步骤操作

在记事本中编辑`.csproj`并添加以下代码

```
<Compile Include="yourForm.designer.cs">
    <DependentUpon>yourForm.cs</DependentUpon>
</Compile> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-21T17:06:06.367

旧 .NET 代码的解决方案文件是 2003/2005 吗？我已经尝试通过使用 VS2008 中的转换向导来完成您所说的事情。在转换期间，它应该尝试解析您的 .aspx 页面并为它们构建设计器文件。设计器生成器的问题在于，这些较旧的 .aspx 页面格式错误，根本无法解析。

我已经意识到，也许尝试将旧的 ASP.NET 代码转换为 2.0 或 3.5 本身就是一个大项目。我还没有找到一种有效的方法来从旧的现有代码中提取设计器代码，所以我也很乐意在这里学习解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T17:14:29.873

如果是 WinForms - 我有一个 PowerShell 脚本，它可以编辑项目并为所有表单/控件添加 .designer.cs。

不过，您仍然必须手动移动设计器代码（或改进脚本）——我只有几个表单，而且也不值得添加这些表单。

如果有帮助，我可以查找并发布它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-22T01:32:04.623

如果您在设计器中打开这些表单之一并保存它，我很想看看会发生什么；或修改并保存；或者在创建一个只有部分类的空壳的 .designer.cs 文件后执行上述操作之一。发现设计师至少将更改放入 .designer.cs 文件中，这并不让我感到惊讶。

# php - 使用 PHP 将图像传输到服务器

> ID：669543
> 
> 赞同：0
> 
> 时间：2009-03-21T16:18:19.150
> 
> 标签：php, upload, image

我有一些网上的图片，图片很简单，例如[http://domain.com/pic.jpg ；](http://domain.com/pic.jpg)有一个上传功能，但这是用户上传用户不会上传，它是一个自动上传。这意味着我有一个数组上的 Urls，我希望 php 自动将这些 Urls 照片上传到服务器任何帮助！谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T16:27:21.577

```
define('IMAGE_PATH', '/path/to/images');

foreach ($urlArray as $url) {
    file_put_contents(IMAGE_PATH . "/" . basename($url), file_get_contents($url));
} 
```

这将要求运行 Apache 的用户对 IMAGE_PATH 具有写入权限。此外，这可能不是您的情况的确切解决方案。您似乎需要一个数据库来存储这些文件名，然后可能应该使用 id 而不是它们的原始文件名。

# c# - 二维骨骼系统

> ID：669547
> 
> 赞同：4
> 
> 时间：2009-03-21T16:22:54.443
> 
> 标签：c#, xna

我正在尝试在 XNA 中编写 2D Bone 系统。

我最初的想法是使用矩阵来跟踪骨骼树的旋转和定位，以便轻松显示项目。

我想很酷，然后当我看到矩阵只能应用于单个精灵批次时，我感到沮丧。开始调用而不是每次绘制调用！

我进行了一些性能测试，以检查我的沮丧是否值得，确实是，调用 spritebatch.Begin 和 End 一段时间后，我的帧速率大幅下降（且不可接受）。

因此，在绘制单个骨骼图像之前，我将不得不手动构建它的最终位置和旋转（可能在未来进行缩放）。在这种情况下，您是否仍会使用矩阵并在最后绘制骨骼之前以某种方式提取信息？如果是这样，关于如何获得我需要的最终信息的任何想法？或者尝试从其父节点的原始位置和旋转来构建它会更容易吗？

提前感谢任何有想法的人。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-21T16:38:32.177

老实说，我会放弃 Sprite 渲染对象并切换到屏幕空间四边形。屏幕空间四边形没有人为限制，您可以使用骨骼系统的标准实现：沿树向下移动应用变换，然后在向上移动时弹出它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T20:05:11.413

无论如何，当您在 2D 中工作时，矩阵不是矫枉过正吗？我的意思是当您可以使用 4 次旋转乘法和 2 次平移求和时，每个矩阵向量乘积 16 次标量乘法？

# asp.net - Loginview 控件：如何在登录模板中引用服务器端控件

> ID：669551
> 
> 赞同：5
> 
> 时间：2009-03-21T16:27:13.170
> 
> 标签：asp.net, loginview

在表单的 PageLoad 事件中，我无法在登录的模板中引用服务器端控件。我错过了什么。因此，当我登录时，我将显示文本框控件，否则我将显示诸如“请登录以执行此操作..”之类的文本

请帮忙 ..

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-21T16:29:39.293

您可以在 loginview 控件上使用 FindControl 方法来获取它们...

```
TextBox t = (TextBox)LoginView2.FindControl("TextBox1");
string s = null;

if (t != null)
{
    // textbox is in the current scope of the LoginView
    s = t.text;
}
else
{
    // the textbox is not in the current scope of the LoginView.
} 
```

但是，这仅适用于当前显示在 LoginView 控件视图中的控件。在尝试抓取文本框之前，您必须测试您正在显示登录视图，或者您还可以测试 FindControl 不返回空引用。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2012-01-13T22:14:18.697

如果您在引用隐藏对象时仍然遇到问题，则可能没有为它输入正确的值。假设您有一个名为“DropDownList1”的下拉列表嵌套在loggedInView 中。您必须设置一个使用 DropDownList 类的 FindControl 方法的新对象，然后使用该新对象：

```
DropDownList d = (DropDownList)ucLogin.FindControl("DropDownList1");

       bool answer = d.SelectedValue.StartsWith("S");
       if (answer == true)
       {
           Response.Redirect("~/MemberPages/ChangePassword.aspx");
       } 
```

就我而言，如果该对象选择的值以“S”开头，我会将用户重定向到新页面。

对我有用，我希望它对你有用！

*   本·苏厄兹

# wpf - WPF：XAML 自定义命名空间

> ID：669560
> 
> 赞同：2
> 
> 时间：2009-03-21T16:33:03.000
> 
> 标签：wpf, xaml, namespaces

好的，所以我在 WPF 中有一个窗口。我在其中添加以下行：

```
xmlns:controls="clr-namespace:mCubed.Controls" 
```

这编译并运行得很好，但是 Visual Studio 设计器给了我这个错误：

> 无法加载文件或程序集“mCubed，Version=1.0.0.0，Culture=neutral，PublicKeyToken=null”或其依赖项之一。该系统找不到指定的文件。

当我从窗口中删除这一行时，它编译并运行得很好，Visual Studio 设计器就像一个魅力！

我很困惑为什么那一行会破坏设计师？***如果我将以下行***放在 XAML 文档的正文中，就会发生这种情况。

```
<controls:MyControl/> 
```

我所有的 .cs 文件都在同一个 VS 项目中。我有一个 mCubed 命名空间，其中包含我巧妙命名的 mCubedWindow 类。我在 mCubed.Controls 命名空间中定义了所有控件类。不要告诉我这是一个装配问题，我所有的文件都在同一个项目中！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T16:42:28.593

不是组装问题，只是设计师问题。2008 年的 VS WPF 设计器充其量是原始的 - 恕我直言，完全没用。我将其完全关闭并改用 XML 编辑器。希望 2010 年情况会大为改观。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T01:11:48.690

MyControl 是否与窗口在同一个程序集中？如果不是，则需要在声明中包含程序集名称：

```
xmlns:controls="clr-namespace:mCubed.Controls;assembly=mCubed" 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T19:52:53.970

这有点奇怪。我已经开发了几个可以做到这一点的项目。这是一个快速的虚拟项目，全部在一个 .exe 中：

首先，`UserControl`有几个按钮：

```
<UserControl x:Class="WpfApplication1.UserControl1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid Width="30">
        <Button HorizontalAlignment="Left">A</Button>
        <Button HorizontalAlignment="Right">B</Button>
    </Grid>
</UserControl> 
```

现在是主窗口，添加了我的控件：

```
<Window x:Class="WpfApplication1.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:p="clr-namespace:WpfApplication1"
    Title="Window1" Height="300" Width="300">
    <Grid>
        <p:UserControl1/>
    </Grid>
</Window> 
```

任何地方都没有错误消息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-25T20:37:36.877

XAML 是松散的（构建操作：无，无代码后面）还是已编译（构建操作：页面，可以有代码后面）？

如果 XAML 是松散的，或者如果 MyControl 在不同的程序集中，您必须指定 MyControl 所在的程序集，如 Daniel Pratt 所述：

```
xmlns:controls="clr-命名空间:mCubed.Controls;assembly=mCubed"

```

确保将程序集 mCubed 及其依赖项（引用）复制到您的输出目录。如果不是，则添加 mCubed 作为对启动项目的引用。

# apache - 在开发机器上配置 Mass Virtual Hosting + SSL

> ID：669572
> 
> 赞同：0
> 
> 时间：2009-03-21T16:43:26.907
> 
> 标签：apache, ssl, virtual

有没有办法为启用 SSL 的主机使用这个或类似的东西？

VirtualDocumentRoot /www/vhosts/%0/public

我想避免每次在我的开发机器上开始使用新域时都必须配置 Apache。最好只添加一个目录，遵循标准命名约定，并能够使用 HTTP 或 HTTPS 自动访问该站点。

我意识到这绝对不是生产服务器的路线，但它应该可以用于开发。

一个使用 mod_rewrite 的例子非常接近，但它仍然需要在添加主机时更新配置映射文件（我试图避免这种情况）。 [http://sweon.net/2008/01/hosting-multiple-ssl-vhosts-on-a-single-ipportcertificate-with-apache2](http://sweon.net/2008/01/hosting-multiple-ssl-vhosts-on-a-single-ipportcertificate-with-apache2)。

有任何想法吗？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-21T18:34:57.637

我上面引用的文章的作者很好地提出了解决方案。

这适用于 Apache 2.2：

RewriteRule ^/(.*)$ /var/www/%{HTTP_HOST}/htdocs/$1 [E=VHOST:${lowercase:%{HTTP_HOST}}]

# unicode - 使用 unicode 输入显示“输入太长”错误的最佳方法？

> ID：669576
> 
> 赞同：3
> 
> 时间：2009-03-21T16:47:13.090
> 
> 标签：unicode, error-handling

当单个字符不等于一个字节时，是否有人对向用户显示“超出最大长度”错误有很好的建议？

我不知所措，但我找到[了一个更有说服力的报价](http://www.inter-locale.com/demos/countBytes.html)：

> 如果缓冲区超过三个字节，你会告诉用户什么？三个字节可以是用户需要修剪的一个、两个或三个字符。根据他们修剪的字符，结果可能仍然太长。回想一下，用户对“字符”的感知可能更接近于字素或字素簇，而不是字符。所以他们可能会在没有意识到的情况下删除太多字符。最后，如果缓冲区限制很小（如 10 或 20），则某些语言（如中文）将严格限制允许的字符数。

我遇到的几个限制是它是一个表单驱动的网站，并且基础数据库列的大小不能改变（报价页面建议有一个 40 字节的缓冲区并强制执行 10 个字符的限制）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-21T16:53:11.033

我最喜欢的解决这个问题的方法是**突出显示超过最大长度的输入部分。**这提供了关于哪个部分使其“太长”的视觉提示，而无需了解它有多少字节或字符的细节。

如果你可以使用 Javascript（例如，如果你不需要满足 508 标准），我也喜欢监控字段的长度并在它太长时提醒用户（当然还要进行服务器端验证） .

如果您不想在输入字段中进入复杂的 CSS，您可以重现字段下方的错误输入并在此处突出显示。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T16:52:24.577

显而易见的*正确*答案是不限制文本长度。

但如果你不能告诉用户他们必须玩多少个角色，那就不要。当字符串太长时，只需告诉他们。跟踪当前字符串需要多少字节，如果超出限制，请为用户启用警告消息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T17:53:20.310

只是大声思考......为什么不更具体：“最大长度超过 N”（例如“最大长度超过 4”）。您不会告诉用户最大长度是多少......只是他们超过了它。而且您不会告诉用户 N 代表什么（字节）......当他们看到“太长 3”的消息时......他们将删除至少 3 个字符（即使他们可能会删除 9 个实际字节）。

我认为没有办法向用户解释为什么某些“字符”需要多个字节，而这些字节很可能不会混淆它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T21:29:40.400

好问题。除了将架构更改为使用 Unicode 字符而不是字节之外，不确定是否有一个好的答案。例如，在带有 NVARCHAR 的 SQL Server 或带有 UTF-8 排序规则的 MySQL 中，列受字符长度的限制。当然，即使它们在技术上是相同的“长度”，这也对“列长度不能改变”有所推动。

值得一提的是，东亚用户将习惯于字符不是字节的想法，因为“半角”拉丁字符占用的存储空间和屏幕空间是中国人的一半，这是由来已久的传统。象形文字。

不过，您通常不能指望任何人了解 UTF-8 字节数。也许在客户端，您可以使用“使用量”栏而不是字节数来纯粹地在视觉上做到这一点：

```
<style type="text/css">
    .field { width: 12em; }
    .field input { width: 100%; }
    .field input { box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box; -khtml-box-sizing: border-box; }
    .indicator { background: blue; height: 5px; }
    .indicator-over { background: red; height: 5px; }
</style>

<div class="field">
    <input type="text" name="pwd" class="limited-12">
</div>

<script type="text/javascript">
    function limitInput(element, limit) {
        var indicator= document.createElement('div');
        element.parentNode.insertBefore(indicator, element.nextSibling);
        element.onchange=element.onkeyup= function() {
            var utf8= unescape(encodeURIComponent(element.value));
            indicator.className= utf8.length>limit? 'indicator-over' : 'indicator';
            var used= Math.min(utf8.length/limit, 1);
            indicator.style.width= Math.floor(used*100)+'%';
        }
        element.onchange();
    }

    var inputs= document.getElementsByTagName('input');
    for (var i= inputs.length; i-->0;)
        if (inputs[i].className.substring(0, 8)=='limited-')
            limitInput(inputs[i], parseInt(inputs[i].className.substring(8)));
</script> 
```

# .net - 休眠和 MS 访问

> ID：669585
> 
> 赞同：13
> 
> 时间：2009-03-21T16:57:19.557
> 
> 标签：.net, database, nhibernate, ms-access, orm

1.  NHibernate 可以用作 MS Access 的 ORM 工具吗？我们正在使用 Nhibernate 来访问 Sql Server，所以想知道它是否可以重用。
2.  如果可以使用，体验如何？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-21T16:59:36.820

以下是[使用 NHibernate 和 MS Access](http://www.hibernate.org/361.html#A4)的详细信息。我个人没有这样做，因为 MS Access 不包括主要的完整数据库选项，如存储过程等，所以我通常避免使用它。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-21T17:43:47.777

我已经将 NHibernate 与 Access 一起使用。根据我的经验，

*   我推荐使用 NHibernate。
*   我建议避免访问。

如果您需要基于文件的进程内小型数据库，有许多可用选项，包括[SQL Server CE](http://sqlserverce.org/)（Microsoft，专有）、[Firebird](http://www.firebirdsql.org/)（免费开源）、[SQLite](http://www.sqlite.org/)（免费开源）。NHibernate 支持所有这些数据库引擎（尽管我没有机会使用它们）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-21T16:59:57.723

它可以与 MS Access 一起使用。这种体验就像使用 MS Access 作为应用程序数据库的任何其他体验一样，您希望使用其他东西。

# asp.net - 绑定FormView时设置Label的值

> ID：669591
> 
> 赞同：0
> 
> 时间：2009-03-21T17:00:27.893
> 
> 标签：asp.net

我有一个带有 FormView 控件的 ASP.NET 页面。当 FormView 绑定时，我还想设置 FormView 之外的 Label 控件的 Text 属性。

做这个的最好方式是什么？我考虑过使用 FormView 的 DataBinding 或 DataBound 事件，但提供的 EventArgs 参数似乎无法让我访问当前值。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T17:43:46.607

该`FormView`控件有一个[`DataItem`属性](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.formview.dataitem.aspx)。再给`DataBound`事件一次机会。

# c++ - c\c++中的socket编程问题

> ID：669598
> 
> 赞同：1
> 
> 时间：2009-03-21T17:06:29.143
> 
> 标签：c++, c, sockets, winsock

```
#include "stdafx.h"
#include <windows.h>
#include <winsock.h>
#include <stdio.h>

int APIENTRY WinMain(HINSTANCE hInstance,HINSTANCE hPrevInstance,LPSTR IpCmdLine,int nCmdShow)
{
    WSADATA ws;
    char buf[100];

    WSAStartup(0x0101,&ws);

    sprintf(buf,"%d.%d",HIBYTE(ws.wVersion),LOBYTE(ws.wVersion));
    MessageBox(0,buf,"info",0);
    WSACleanup();
    return 0;
} 
```

该程序用于获取计算机中可用 wsock 版本的信息。我不明白为什么程序中包含“stdafx.h”。APIENTRY的意义是什么？我们不能改用 _stdcall 吗？我也无法在 VC++ 中编译它。代码有什么问题？

以下是执行程序时的错误，编译期间没有错误。

```
--------------------Configuration: sa - Win32 Debug--------------------
Linking...
sa.obj : error LNK2001: unresolved external symbol _WSACleanup@0
sa.obj : error LNK2001: unresolved external symbol _WSAStartup@8
LIBCD.lib(crt0.obj) : error LNK2001: unresolved external symbol _main
Debug/sa.exe : fatal error LNK1120: 3 unresolved externals
Error executing link.exe.

sa.exe - 4 error(s), 0 warning(s) 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-21T17:26:44.103

1.  `stdafx`用于在 VC++中实现[预编译头文件。](http://msdn.microsoft.com/en-us/library/szfdksca.aspx)您可以将您的库头文件（如 windows.h 和 winsock.h 等）放在那里，并且每次修改 stdafx.h 时它们只会编译一次。

2.  APIENTRY 通常只是 __stdcall 的定义，但有时它定义为空白（例如，如果不支持 __stdcall）。这是为了使您的代码更具可移植性。

3.  如果没有您遇到的实际错误，我将无能为力。但我的第一个猜测是你的构建中有 unicode，它抱怨 MessageBoxW 不接受 char[100] 作为参数。在这种情况下，要么在任何地方使用宽字符，要么关闭 unicode，或者使用 MessageBoxA 显式使用 ASCII 版本。

编辑：

现在有了错误，这很容易。在项目属性 -> 链接器 -> 输入 -> 附加依赖项下，添加 ws2_32.lib。所以你可以得到链接的 Winsock 函数。

缺少的 _main 表示您正在将应用程序构建为控制台应用程序，而不是 Windows 应用程序。返回项目属性 -> 链接器 -> 系统并将子系统设置为 Windows (/Subsystem:Windows) 而不是控制台。否则，只需将 WinMain 重命名为`int main()`（确保删除 APIENTRY）。

此外，如果您使用的是 MSVC++，您不妨使用更安全的 sprintf_s：

```
sprintf_s(buf,100,"%d.%d",HIBYTE(ws.wVersion),LOBYTE(ws.wVersion)); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-21T17:56:36.933

至于错误：您需要链接到 ws2_32.lib 库。您可以通过两种方式做到这一点：

1.  将其添加到项目属性 -> 链接器 -> 输入 -> “其他库”中（不要忘记为调试和发布配置执行此操作）。
2.  在你的头文件中添加这个编译器指令：

    #pragma 注释（lib，“ws2_32.lib”）

我更喜欢第二种方法，因为您所做的更改在源代码中可见，而不是隐藏在项目选项的深处。

至于 APIENTRY 和类似的定义——它只是一种方便，比如返回 NULL 而不是 0 来指出你没有返回任何东西而不是数字零。使代码更易于阅读和理解。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T17:36:57.137

stdafx 与 Visual Studio 中的预编译头文件有关。它与套接字没有任何特定关系。

APIENTRY 与 WinMain 的调用约定有关，同样它不应该与套接字有任何关系。

发布错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T17:53:10.233

尝试下一个
打开项目属性，选择链接器属性，选择输入子项在附加依赖项中添加 Ws2_32.lib 不要忘记对所有项目配置执行相同的操作。
看来你也需要改变使用 int main() 而不是 WinMain(...)

stdafx.h - 通常意味着预编译的头文件 VC++ 项目
APIENTRY - 调用约定。在您的情况下，它是 __stdcall，但有时可能意味着其他。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T17:57:23.703

就链接器错误而言，您应该链接到 wsock32.lib。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T17:57:53.217

如果链接器抱怨它找不到 _main，这意味着它正在尝试将您的程序链接为控制台应用程序，这意味着您应该定义 main() 而不是 WinMain()。如果您有 WinMain()，您可能应该将您的应用程序构建为 Windows 应用程序。

# java - 添加到 JPanel 时，图像显示为灰色方块

> ID：669615
> 
> 赞同：1
> 
> 时间：2009-03-21T17:27:38.080
> 
> 标签：java, swing

我正在为大学做一个项目，该项目本质上是对 Space Invaders 游戏的重新设计，但规则有所改变。到目前为止，我有一个主 JFrame，其中包含 JPanel 的子类（用于背景图像），其中包含我用于精灵的另一个 JPanel 子类。但是，当我运行它时，JFrame 和背景 JPanel 工作正常，但是当我绘制精灵时，它只会生成一个灰色正方形，我无法更改它的大小或位置。这是我的 Sprite 类的代码：

```
import java.awt.*;
import java.io.File;
import javax.swing.*;

public class Sprite extends JPanel
{
Image spriteImage;
int speedX;
int speedY;
Point pos;
final boolean MV_LEFT = false;
final boolean MV_RIGHT = true;

public Sprite(File _imageFile)
{
    try {
        spriteImage = javax.imageio.ImageIO.read(_imageFile);
    } catch (Exception e) {
        /* handled in paintComponent() */
    }
    speedX = 1;
    speedY = 1;
    pos = new Point(100,100);
}

@Override
protected void paintComponent(Graphics g)
{
    super.paintComponent(g);
    if (spriteImage != null)
        g.drawImage(this.spriteImage, this.pos.x, this.pos.y, this.getWidth(), this.getHeight(), this);
}

public void move(boolean direction)
{
    if (direction == true)
    {
        this.pos = new Point((pos.x + speedX), pos.y);
        repaint();
    }
    else
    {
        this.pos = new Point((pos.x - speedX), pos.y);
        repaint();
    }
}
} 
```

我确定那里有一些问题，但是对于 paintComponent() 方法，我只是模仿了我在互联网上找到的所有图像处理教程，但它似乎仍然不起作用。有什么我忘记的大事吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T18:09:59.477

我在paintComponent() 方法中看到的一个问题是绘制图像的位置。我的理解是游戏中的每个精灵都是一个单独的 JPanel。因此，在 paintComponent 方法中传递的 Graphics 对象 (g) 对于每个 Sprite 都是不同的。您可以将 Graphics 对象想象为画布。如果整个游戏只有 1 个 Graphics 对象，而这个图形对象代表整个游戏窗口，那么你的逻辑是正确的，一切都应该正常工作。

但是，这里的每个 Sprite 都有自己的图形对象，大概具有与 sprite 相关的高度和宽度。在这种情况下，您的 paintComponent 方法可能看起来像：

```
public void paintComponent(Graphics g)
{
    if (spriteImage != null)
        g.drawImage(this.spriteImage, 0, 0, getWidth(), getHeight(); // always at (0,0)
} 
```

为什么？因为在您的设计中，您正在游戏窗口周围移动 Sprite 和它的 Graphics 对象！您传递给 drawImage() 的坐标是相对于 Graphics 对象的；您总是希望从 Sprite 的左上角 (0,0) 开始绘画。你得到的只是一个灰色方块，因为你试图将图像绘制到 Graphics 对象的边界之外。

从长远来看，我认为这种方法不会奏效，因为在其父容器内移动 JPanel 并不容易（除非您使用绝对定位）。它也不是真正可扩展的，因为 JPanel 非常重量级并且需要大量资源来创建和显示。

您可能最好拥有一个代表整个游戏区域的 JPanel。每个 Sprite 都不是 JPanel 的子类，因此您没有 paintComponent 方法。你可以这样做：

```
public class GameArea extends JPanel
{
    private final Collection<Sprite> sprites; // sprites to draw

    public void paintComponent(Graphics g)
    {
        for(Sprite sprite : sprites)
        {
            sprite.drawOnSurface(g);
        }
    }
}

public class Sprite // no need to extend anything
{
    /* Your other code looks OK */

    public void drawOnSurface(Graphics surface)
    {
        surface.drawImage(image, x, y, getWidth(), getHeight());
    }
} 
```

# zend-framework - 如何提高 Zend Framework 的学习速度？

> ID：669619
> 
> 赞同：13
> 
> 时间：2009-03-21T17:29:49.103
> 
> 标签：zend-framework, prototype

序言：我时不时地使用 PHP 超过 8 年，但从未使用过框架，只编写脚本和插件。大多数情况下，我使用 CodeCharge Studio 之类的代码生成器或 Intranet 应用程序的自定义代码。因为我对设计模式很满意，所以**Zend 框架**对我来说学习起来并不难。

从 ZF 开始：我阅读了 QuickStart 手册，想知道什么可以让我快速掌握基本的 Zend Web 应用程序开发。据我了解，有些**重复的任务**需要花费大量时间。

问题：例如，对于我开发的几乎每个站点，都必须有用户注册过程，我不想重新发明轮子并花一周的时间来填写登录/个人资料表格。

1) Zend 开发人员，您是否使用您编写的某种原型来快速推出基本站点？

2）或者是否有一些已经可用的站点源代码可以构建？

3) 对于带有网格、记录等的页面，是否有一些应用程序生成器或次要工具？

PS 我在 6 年前停止学习 EJB，因为我没有人问类似的问题。蒂亚！

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-22T18:27:52.293

> 1) ZF 开发人员是否使用某种原型来快速推出基本站点？

Zend 框架对于这个领域的组件来说还太年轻，但是有[一个非官方的 PEAR 频道](http://ralphschindler.com/2009/01/07/the-semi-official-zend-framework-pear-channel)。截至 09 年 3 月，思想领袖似乎仍在争论组织一切的最佳方式。我个人对[领域驱动的计划](http://blog.fedecarg.com/2009/03/22/zend-framework-domain-driven-design/)最为兴奋，因为它们将是最强大的。

> 2) 是否有一些站点源代码可供构建？

目前最好的资源是采埃孚思想领袖的博客、网站和存储库。以下是一些帮助您入门的链接：

*   布赖恩在评论中注释了[Rob Allen 的教程](http://akrabat.com/zend-framework-tutorial/)。它是第一个真正超越基础的东西，也是他的著作 Zend Framework In Action 的基础。

*   Padraic Brady 的[博客应用程序教程](http://blog.astrumfutura.com/archives/367-Example-Zend-Framework-Blog-Application-Tutorial-Parts-1-8-Revisited.html)和[svn 存储库](http://svn.astrumfutura.org/zfblog/)是展示许多组件如何组合在一起的最完整示例之一。它正在迁移到名为[Survive The Deep End的在线书籍中，但正如](http://www.survivethedeepend.com/)[他在博客中提到的那样，他非常忙，这](http://blog.astrumfutura.com/archives/396-Zend-Framework-Survive-The-Deep-End-Update.html)需要一些时间。

*   Matthew Weier O'Phinney 完成了一些有趣的设置，您可以[从他的 github 存储库中](http://github.com/weierophinney/pastebin/tree/master)[阅读](http://weierophinney.net/matthew/archives/202-Model-Infrastructure.html)和克隆这些设置。'bugapp' 分支，特别是在那个 repo 中有一些有趣的技术。他最近一直在本地工作，所以[最新的更新在他的博客上](http://weierophinney.net/matthew/)。

*   Damien Mathieu 一直致力于基于最佳实践的[DRY 框架。](http://github.com/dmathieu/zendry/tree/master)

> 3) 对于带有网格、记录等的页面，是否有一些应用程序生成器或次要工具？

[作为 Zend_Tool 的一部分，](http://devzone.zend.com/article/3811-Using-Zend_Tool-to-start-up-your-ZF-Project)有一个脚手架生成器，计划在 ZF v1.8 中发布。它目前在孵化器中，我上周尝试了它并且它可以工作，但是在它的当前状态下生成的组件并不多。

上周我终于花时间收集资源（包括 Stack Overflow ZF 问题提要）。我已将它们放在[Google Reader 中的 Zend Framework 标记](https://www.google.com/reader/shared/user%2F10630184177735816807%2Flabel%2FZend%20Framework)下，并将随着时间的推移改进提要源。如果您更愿意自己管理它们，这里是当前的 OPML。

祝你好运！-马特

```
<?xml version="1.0" encoding="UTF-8"?>
<opml version="1.0">
    <head>
        <title>expertseries | Zend Framework | Google Reader</title>
    </head>
    <body>
        <outline title="Zend Framework" text="Zend Framework">
            <outline text="A.J. Brown" title="A.J. Brown" type="rss"
                xmlUrl="http://feeds.feedburner.com/ajbrowns_blog" htmlUrl="http://ajbrown.org/blog"/>
            <outline text="Armando Padilla" title="Armando Padilla"
                type="rss" xmlUrl="http://www.armando.ws/?feed=rss2" htmlUrl="http://www.armando.ws"/>
            <outline text="Benjamin Eberlei" title="Benjamin Eberlei"
                type="rss"
                xmlUrl="http://www.whitewashing.de/about/rss/all" htmlUrl="http://www.whitewashing.de"/>
            <outline text="Bradley Holt" title="Bradley Holt" type="rss"
                xmlUrl="http://bradley-holt.blogspot.com/feeds/posts/default" htmlUrl="http://bradley-holt.blogspot.com/"/>
            <outline text="Cal Evans" title="Cal Evans" type="rss"
                xmlUrl="http://blog.calevans.com/feed/" htmlUrl="http://blog.calevans.com"/>
            <outline text="Chris Hope" title="Chris Hope" type="rss"
                xmlUrl="http://feedproxy.google.com/ElectricToolboxBlog" htmlUrl="http://www.electrictoolbox.com"/>
            <outline text="Codecaine.co.za" title="Codecaine.co.za"
                type="rss" xmlUrl="http://www.codecaine.co.za/rss/" htmlUrl="http://www.codecaine.co.za/"/>
            <outline text="Douglas Brown" title="Douglas Brown"
                type="rss" xmlUrl="http://www.brownphp.com/feed/" htmlUrl="http://www.brownphp.com"/>
            <outline text="Federico Cargnelutti"
                title="Federico Cargnelutti" type="rss"
                xmlUrl="http://blog.fedecarg.com/feed/" htmlUrl="http://blog.fedecarg.com"/>
            <outline text="Jani Hartikainen" title="Jani Hartikainen"
                type="rss" xmlUrl="http://codeutopia.net/blog/feed/" htmlUrl="http://codeutopia.net/blog"/>
            <outline text="Juozas Kaziukėnas" title="Juozas Kaziukėnas"
                type="rss" xmlUrl="http://dev.juokaz.com/feed/rdf" htmlUrl="http://dev.juokaz.com"/>
            <outline text="Matthew Turland" title="Matthew Turland"
                type="rss" xmlUrl="http://ishouldbecoding.com/atom/1" htmlUrl="http://ishouldbecoding.com/"/>
            <outline text="Matthew Weier O'Phinney"
                title="Matthew Weier O'Phinney" type="rss"
                xmlUrl="http://weierophinney.net/matthew/feeds/index.rss2" htmlUrl="http://weierophinney.net/matthew/"/>
            <outline text="Michelangelo van Dam"
                title="Michelangelo van Dam" type="rss"
                xmlUrl="http://www.dragonbe.com/feeds/posts/default" htmlUrl="http://www.dragonbe.com/"/>
            <outline text="Mike Rötgers" title="Mike Rötgers" type="rss"
                xmlUrl="http://www.roetgers.org/feed/" htmlUrl="http://www.roetgers.org"/>
            <outline text="Nick Lo" title="Nick Lo" type="rss"
                xmlUrl="http://www.ingredients.com.au/nick/feed/" htmlUrl="http://www.ingredients.com.au/nick"/>
            <outline text="Pádraic Brady" title="Pádraic Brady"
                type="rss"
                xmlUrl="http://blog.astrumfutura.com/feeds/index.rss2" htmlUrl="http://blog.astrumfutura.com/"/>
            <outline text="Raphael Stolt" title="Raphael Stolt"
                type="rss"
                xmlUrl="http://raphaelstolt.blogspot.com/feeds/posts/default" htmlUrl="http://raphaelstolt.blogspot.com/"/>
            <outline text="Rob Allen" title="Rob Allen" type="rss"
                xmlUrl="http://akrabat.com/feed/" htmlUrl="http://akrabat.com"/>
            <outline text="Robert Basic" title="Robert Basic" type="rss"
                xmlUrl="http://feeds2.feedburner.com/robertbasic/blog/" htmlUrl="http://robertbasic.com/blog"/>
            <outline text="Stack Overflow ZF" title="Stack Overflow ZF"
                type="rss"
                xmlUrl="http://stackoverflow.com/feeds/tag/zend-framework" htmlUrl="http://stackoverflow.com/questions/tagged/zend-framework"/>
            <outline text="Thomas Weidner" title="Thomas Weidner"
                type="rss"
                xmlUrl="http://www.thomasweidner.com/flatpress/feed/rss2/" htmlUrl="http://www.thomasweidner.com/flatpress/"/>
            <outline text="Tom Graham" title="Tom Graham" type="rss"
                xmlUrl="http://www.noginn.com/feed/" htmlUrl="http://www.noginn.com"/>
            <outline text="Zend Dev Zone" title="Zend Dev Zone"
                type="rss"
                xmlUrl="http://feeds.feedburner.com/ZendDeveloperZone" htmlUrl="http://devzone.zend.com/"/>
        </outline>
    </body>
</opml> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-21T18:07:01.683

Akra 的 DevNotes 有一个很棒的教程，可以创建一个示例应用程序：

[http://akrabat.com/zend-framework-tutorial/](http://akrabat.com/zend-framework-tutorial/)

这就是我开始与 ZF 合作的地方。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-24T15:10:27.540

如果您已经熟悉 MVC 和设计模式，那么为什么不研究一些工具来帮助您更快地编写代码呢？

虽然我通常喜欢免费工具，但我必须说使用 Zend Studio IDE（基于 Eclipse）有助于加快速度（30 天免费试用）。

要点（除了调试器/分析器）：

*   *它可以为 MVC 应用程序*生成骨架
**   *基本积木（控制器、视图、模型）的*默认代码骨架***

 **最后但并非最不重要-

*   **所有 Zend 类的**自动完成（您可以通过 Ctrl+单击类名称来打开它们）。**不得不说非常方便。**

 **只要确保有一台具有大量内存的计算机！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-21T18:02:19.197

我现在正处于你的确切情况（使用 php 的年限更少：P）

目前我正在使用 Zend FrameWork 作为参考，就我到目前为止所看到的而言，从旧工作中重用您的结构非常容易。设置好首选选项和树结构后，您可以反复使用它。

所以我认为最好不要依赖第三方生成器并创建自己的骨架。在这种模式下，您将对代码结构更加熟悉，并且对代码有更好的把握。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-21T19:53:37.447

*   对于基本站点，只需按照[QuickStart](http://framework.zend.com/docs/quickstart)即可；
*   更高级的东西，例如[http://devzone.zend.com/](http://devzone.zend.com/)或[http://www.zftutorials.com/](http://www.zftutorials.com/)

使用框架意味着，您不必做所有那些乏味的重复性工作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-21T23:27:35.233

> 据我了解，有些重复的任务需要花费大量时间。

这是真的，正如你所说，几乎每个网站都有一个注册过程等。虽然我同意一遍又一遍地实现这些功能可能是重复的，但在某种程度上，每个应用程序都会有自己独特的一组需求——这意味着至少会涉及一些定制工作，即使你正在重用来自一个较旧的基于 ZF 的项目。我现在会很高兴地回答你编号的问题

> Zend 开发人员，您是否使用您编写的某种原型来快速推出一个基本站点？

并不真地。我不会为“基本”站点选择 ZF，也不会使用任何 MVC 框架。我目前的假设是一个基本站点由大约 8 到 12 个独立的部分组成，没有真正的特殊功能和有限的要求。请记住，一旦我们说“框架”，除了该框架内可能固有的任何错误和问题之外，几乎总是会出现明显的性能损失。您所说的“原型”将位于 Zend 框架中可用的类中，例如[Zend_Auth](http://framework.zend.com/manual/en/zend.auth.html)用于在大约 15 分钟内创建一个功能齐全的身份验证系统。

> 2）或者是否有一些已经可用的站点源代码可以构建？

可能，尽管我不得不说，我最糟糕的噩梦将不得不支持一个构建在某种框架上的应用程序，该框架包装了另一个框架。想象一下调试会有多有趣。想象一下教别人支持它会有多有趣。您已经在使用一个框架，我们现在不要贪婪。

> 3) 对于带有网格、记录等的页面，是否有一些应用程序生成器或次要工具？

我不太清楚你的意思是什么，但如果我不得不猜测，也许是 Zend Studio？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-09-14T17:42:36.960

有一本很好的德语书，你可以在这个网站的存档中找到一个入门应用程序并研究代码：[http ://www.zend-framework-buch.de/](http://www.zend-framework-buch.de/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-10-22T12:34:54.527

我们有一个可以提供帮助的工具：[nWire for PHP](http://www.nwiresoftware.com/products/nwire-php)分析您的代码，帮助您浏览它并直观地表示组件和关联。您最终将需要阅读代码，而使用 nWire 这会变得容易得多。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-10-19T21:19:30.220

为了快速入门，您可以阅读“ [Learn ZF2](http://learnzf2.com) ”一书。它是在 Zend Framework 2 (ZF2) 核心团队成员和 ZF2 课程创建者的帮助下编写的，可能是深入了解 Zend Framework 2 及其特性的最佳选择。这些书附有源代码，它会引导您逐步了解不同的概念。有趣的阅​​读，每一页都会变得更好。

# svn - SVN：跨项目共享通用代码的最佳方式

> ID：669628
> 
> 赞同：9
> 
> 时间：2009-03-21T17:38:45.370
> 
> 标签：svn, repository, branch

我在一个存储库中有多个网站项目，每个项目都有一个 WordPress 副本。更新 WordPress 意味着更新所有项目文件夹并保留冗余副本。这对于同步整个文件夹的 rsync 脚本很有用。它还为我提供了该站点的完整工作本地副本。

我可以通过多种方式改进这一点，并希望得到一些反馈。我在 Windows 上，最近迁移到 Subversion。

1.  在每个网站文件夹中创建指向 WordPress 位的符号链接。这会在 Subversion 和 Apache 中得到支持吗？有什么缺点吗？
2.  拥有一个 WordPress 文件夹并将其分支到其他网站主干。我读到分支很便宜，并且维护一个副本，但我不确定是否应该跨主干进行分支。就个人而言，我认为这是最好的方法。有什么理由避免这种情况吗？
3.  最后，我可以保留当前结构并使用脚本在所有网站文件夹中进行复制。

最好的方法是什么，是否有任何替代解决方案？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-21T17:45:13.730

一种选择是将 WordPress 位分离到一个单独的存储库中（因为它实际上并不是您项目的一部分，它只是您用来构建它们的东西），然后使用 svn:externals 将其提取到您的项目中的正确位置.

[SVN 书中的外部定义](http://svnbook.red-bean.com/en/1.0/ch07s03.html)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-21T17:57:09.490

如果您已经将所有站点一起托管在一个存储库中，则可以使用 svn:externals 以多种方式将同一存储库的不同部分拉到一起。

例如，使用类似的存储库

```
回购/站点1
回购/站点2
回购/commonPieces

```

您可以在 site1 和 site2 目录中引入一个“svn:externals”属性，上面写着“commonPieces url-to-repo/commonPieces”。

显然，您需要避免任何递归循环。但这有一个优势，那就是所有东西都在同一个存储库中并且可以共享历史——您可以使用“svn copy”将越来越常见的东西从 site1 或 site2 拉到 commonPieces 中。

比较我正在工作的当前解决方案——将东西从我们*单独*的项目存储库迁移到一个*单独的*“coreLibraries”存储库会丢失开发历史。由于我们通常为一个项目开发功能，然后决定重用它们，这种历史损失经常发生......

* * *

编辑：值得记住的是，虽然 site1 上的“svn update”会使用这个“svn:externals”属性自动更新 commonPieces，但 site1 上的“svn commit”不会显示 site1/commonPieces 中发生变化的内容。您必须进行两个单独的提交，一个来自 site1，一个来自 site1/commonPieces。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-21T17:45:57.007

您可以添加一个指向[WordPress 存储库的](http://svn.automattic.com/wordpress/tags/2.7.1/)[svn:external](http://svnbook.red-bean.com/en/1.5/svn.advanced.externals.html)定义，或者使用您使用的插件和自定义创建自己的单独“自定义 WordPress 存储库”。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-21T17:47:16.660

我经常会为不同的项目重用相同的类库，在我的情况下，我更喜欢为每个项目提供一个单独的 - 冻结 - 副本。唯一的原因是我不想破坏我有一段时间没有从事过的项目，以防其中一个库过时了。但是，如果每个项目都是某种主要项目的一部分，那么您一直在致力于它是不同的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-21T17:46:08.597

也许我只是以错误的方式使用 Subversion，但我们的文件夹结构如下所示

主干 - 核心 - 消息 - 超级强大的应用程序 #1 - 超级强大的应用程序 #2 - 超级强大的应用程序 #3

所以我们所有的应用程序共享相同的核心和消息组件。唯一的缺点是当人们分支时，他们会得到所有的应用程序，但这比任何事情都更令人烦恼。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-21T17:49:36.280

更好的方法是将 wordpress 拉到存储库的单独分支中。然后，为每个存储 Wordpress 路径的网站引入一个配置文件。您可以将此位置附加到您的 php 包含路径。这是一个图表：

```
Svn repo-v
         |-Websites--v
         |           |---One
         |           |---Two
         |-Wordpress-v
                     |---branch one
                     |---branch two 
```

这有几个优点：

*   您可以一次试验多个版本的 Wordpress，进行测试等等。您可以在所有网站之间共享这些
*   您不必担心 wordpress 在哪里签出。在项目中包含一个库通常很麻烦，但是这种类型的设置可以更容易地将东西放在某个公共位置。
*   您不必维护库的多个版本，更新更容易。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-21T17:51:56.913

传统上，一切都应该在 SVN 上分开。听起来您正在使用 SVN 作为一种从不同区域获取代码并将它们拼接在一起的方法。

因此，您使用 SVN 作为构建工具。最好：

*   保持你的插件分开
*   不要将 wordpress 本身存储在 SVN 中，除非您使用供应商分支
*   当您需要获取具有特定组件的特定应用程序时，请使用构建脚本。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-21T18:00:25.300

> 最好的方法是什么，是否有任何替代解决方案？

不要跑题，但我建议你仔细看看**[git。](http://git-scm.com)**我们用子模块日复一日地做这种事情，这很容易。

仅供参考 - 由于这些类型的问题，大约 2 年前从 SVN 迁移。

# java - 当我在构建时使用配置文件填充属性文件时，如何在 Eclipse 中运行 Maven webapp？

> ID：669639
> 
> 赞同：13
> 
> 时间：2009-03-21T17:45:19.817
> 
> 标签：java, eclipse, maven-2

这是我的 POM 中的示例配置文件：

```
 <profiles>
    <profile>
        <id>QA</id>
        <activation>
            <activeByDefault>true</activeByDefault>
        </activation>
        <properties>
            <jdbc.url>jdbc:mysql://127.0.0.1:3306/SomeDB</jdbc.url>
            <jdbc.username>webapp</jdbc.username>
            <jdbc.password>somepassword</jdbc.password>
        </properties>
    </profile>
    ... 
```

然后我的资源文件夹中有一个属性文件，如下所示：

```
jdbc.url = ${jdbc.url}
jdbc.username = ${jdbc.username}
jdbc.password = ${jdbc.password} 
```

最后我在我的 POM 中打开过滤：

```
 <build>
    <resources>
        <resource>
            <directory>src/main/resources</directory>
            <filtering>true</filtering>
        </resource>
    </resources>
    ... 
```

这实际上是一个简化的示例，但您明白了。基本上当我跑步时

> mvn install -P QA

Maven 将过滤我的 app.properties 文件，将所有占位符替换为配置文件中保存的值，然后部署填充的属性文件。

所有这一切的问题是我喜欢在 Eclipse 中利用服务器机制，我在 IDE 中运行 Tomcat。我的项目在这种情况下运行，Eclipse 负责更新、重新部署等。但是，在 IDE 中的部署期间，Maven 被排除在外，而且这个属性文件永远不会被正确填充。

那么，我怎样才能继续在 IDE 中运行我的项目，但要正确填充此属性文件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T20:11:39.307

[您可以通过m2eclipse](http://m2eclipse.codehaus.org/)插件有效地运行任何 Maven 命令（包括带有配置文件的命令） 。此外，m2eclipse 与 WTP 一起使用（我相信这是 Servers 选项卡的来源）。我不确定这部分，但我已经使用它在 Eclipse 中为 Maven 项目将 Web 应用程序部署到 Tomcat。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T08:58:53.097

谢谢亚历克斯。我最终安装了[Eclipse Integration for Apache Maven (Eclipse IAM)，以前是 Q for Eclipse](http://maven.apache.org/eclipse-plugin.html)

这个插件解决了两个问题：在 Eclipse 中的 Publish to Server 事件期间填充属性文件和填充 WEB-INF/lib 文件夹。之前，即使我运行 mvn eclipse:eclipse 来满足我在 Eclipse 中的构建路径，它也没有正确地将这些依赖项发布到嵌入式服务器。这个插件就是这样做的。解决了这两个问题后，我没有看到使用嵌入式服务器在 Eclipse 中开发 Maven 项目的任何其他障碍。

# interface - 具有不同特异性水平的 OCaml 类型

> ID：669641
> 
> 赞同：9
> 
> 时间：2009-03-21T17:45:32.217
> 
> 标签：interface, ocaml

我正在尝试在 OCaml 中模拟一个接口并使用“类型”构造。我有两种类型：

```
type fooSansBar = {a: string; b: int};;
type fooConBar = {a:string; b:int; bar:char};; 
```

...并想定义一个特定的 fooSansBar：

```
let fsb = {a="a"; b=3};; 
```

...但被告知 bar 字段未定义。由此看来，与我在匹配 fooSansBar 的签名中传递的值相反，系统认为我正在尝试创建一个 fooConBar。如果存在上面定义的两种类型，是否可以创建 fooSansBar？

此外（因为我是 OCaml 的新手）是否有更好的方法来模拟界面？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-21T23:34:51.877

在 OCaml 中，记录类型中的字段名称必须是唯一的，因此您定义的两种类型不能同时共存。Caml 是我知道的唯一具有此属性的语言。

因为第二个定义隐藏了第一个，所以当编译器看到 a 和 b 字段时，它希望它们属于该`fooConBar`类型，因此抱怨缺少 bar 字段。

如果您尝试模拟接口，在 Caml 中执行此操作的正确功能方法是定义一个`module type`.

```
module type FOO_CON_BAR = sig
  val a : string
  val b : int
  val bar : char
end 
```

还有一个例子：

```
module Example = struct
  let a = "hello"
  let b = 99
  let c = '\n'
end 
```

使用模块和模块类型，您还可以获得子类型；没有必要求助于对象。

PS 我的 Caml 生锈了；语法可能已关闭。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-06T12:01:34.563

OCaml 中有几种可能的解决方案，具体取决于您如何使用您提供的代码。最简单的是将两种类型结合起来：

```
type fooBar = { a: string; b: int; bar: char option } 
```

另一种解决方案是用对象替换记录，因为对象支持子类型化（并且可以推断出它们的类型，因此无需声明类型！）：

```
# let fsb = object
    method a = "a"
    method b = 3
  end;;
val fsb : < a : string; b : int > = <obj>

# fsb#a, fsb#b;;
- : string * int = ("a", 3) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-21T18:10:48.320

第二种类型重新定义了 a 和 b，有效地隐藏了第一种，这就是它不能再构造的原因。您可以在不同的模块中定义这些类型，但这与为 a 和 b 使用不同的名称相同。

只有当您不尝试从另一个接口“派生”而只是实现它时，才能使用这些构造。

如果您希望在 Ocaml 中使用这些面向对象的概念，您可以查看对象系统，或者，根据您的问题，模块系统。或者，您可以尝试以实用的方式解决您的问题。你想解决什么问题？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-11-23T22:32:00.773

OCaml 提供了两种实现接口的方法。如前所述，一种是模块类型。

另一种是类类型。您可以编写一个类类型（接口）`fooSansBar`：

```
class type fooSansBar = object
    method a: string
    method b: int
end 
```

和一个类类型 fooConBar：

```
class type fooConBar = object
    inherit fooSansBar
    method bar: char
end 
```

这将允许您在需要 a 的`fooConBar`任何地方使用 a `fooSansBar`。您现在可以创建一个`fooSansBar`, 使用类型推断：

```
let fsb = object
    method a = "a"
    method b = 3
end 
```

现在，`fsb`' 的类型恰好是`<a: string; b: int>`，正如 Jon 所指出的那样，但`fooSansBar`由于 OCaml 的结构子类型，它完全可以用作 a 。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-11-23T07:55:31.047

在 OCaml 中，不可能有两种具有相交字段集的记录类型存在于同一范围内。

如果您确实需要使用具有相交字段集的记录类型，则可以通过将类型包含在它们自己的专用模块中来解决此限制：

```
module FooSansBar = struct type t = {a:string; b:int} end
module FooConBar = struct type t = {a:string; b:int; bar:char} end 
```

然后你可以像这样构造这些类型的实例：

```
let fsb = {FooSansBar.a="a"; b=3}
let fcb = {FooConBar.a="a"; b=4; bar='c'} 
```

这些实例具有以下类型：

```
fsb : FooSansBar.t 
fcb : FooConBar.t 
```

# c# - 从 ironpython 引用 web 项目

> ID：669657
> 
> 赞同：1
> 
> 时间：2009-03-21T17:53:29.017
> 
> 标签：c#, .net, ironpython

我有一个用 C# 编写的 mvc 项目。我正在尝试从 Ironpython 中引用它。我导入对象和引用 dll 没有问题，但是有些对象依赖于 web.config 中的连接字符串，有什么方法可以让我引用 dll，然后指定它应该使用的 web.config ?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-04-04T23:32:15.333

两种选择：

*   将连接字符串外部化为一个设置类，在使用 ironpython 时可以覆盖该类
*   [在这里](https://stackoverflow.com/questions/2068396/assembly-redirection-in-code-instead-of-app-config)尝试我自己的问题的两个答案之一。它们都不漂亮，但我认为对于连接字符串，它们可能会奏效。

# c# - 无法使用 WSDL 定义

> ID：669661
> 
> 赞同：2
> 
> 时间：2009-03-21T17:55:27.980
> 
> 标签：c#, java, web-services, wsdl, svcutil.exe

下面是对问题的系统分解。[重写！]

**客户端代码**

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

// This is a "sanitized" version of the real deal, of course. In reality I also require to
// sign all incomming and outgoing messages and com. over SSL. The basic model is the same
// though and the sanitized WSDL captures the problem in its minimal form.

namespace MissileDefenseSystem
{
    using MissileDefenseSystemServiceReference;

    class Program
    {
        static void Main(string[] args)
        {
            try
            {
                var client = new TestPortTypeClient();
                var req = "just do it";
                Console.WriteLine("request>" + req + "<");
                var rsp = client.LaunchMissiles(req);
                Console.WriteLine("response>" + rsp + "<");
            }
            catch (Exception e)
            {
                Console.WriteLine("exception>" + e.Message + "<");
                Console.WriteLine(e.StackTrace);
            }
        }
    }
} 
```

**WSDL**

```
<?xml version="1.0" encoding="ISO-8859-1"?>
<definitions targetNamespace="java:bla.bla.bla.bla"
             xmlns="http://schemas.xmlsoap.org/wsdl/"
             xmlns:tns="java:bla.bla.bla.bla"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:xsd="http://www.w3.org/2001/XMLSchema"
             xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/">
  <types>
    <schema targetNamespace='java:bla.bla.bla.bla' xmlns='http://www.w3.org/2001/XMLSchema'/>
  </types>
  <message name="TestRequest">
    <part name="arg0" type="xsd:string"/>
  </message>
  <message name="TestResponse">
    <part name="return" type="xsd:string"/>
  </message>
  <portType name="TestPortType">
    <operation name="LaunchMissiles">
      <input message="tns:TestRequest"/>
      <output message="tns:TestResponse"/>
    </operation>
    <operation name="AbortMission">
      <input message="tns:TestRequest"/>
      <output message="tns:TestResponse"/>
    </operation>
  </portType>
  <binding name="TestBinding" type="tns:TestPortType">
    <soap:binding style="rpc"  transport="http://schemas.xmlsoap.org/soap/http"/>
    <operation name="LaunchMissiles">
      <soap:operation soapAction="urn:LaunchMissiles"/>
      <input>
        <soap:body use="encoded" namespace='urn:Test' encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/>
      </input>
      <output>
        <soap:body use="encoded" namespace='urn:Test' encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/>
      </output>
    </operation>
    <operation name="AbortMission">
      <soap:operation soapAction="urn:AbortMission"/>
      <input>
        <soap:body use="encoded" namespace='urn:Test' encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/>
      </input>
      <output>
        <soap:body use="encoded" namespace='urn:Test' encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/>
      </output>
    </operation>
  </binding>
  <service name="Test">
    <documentation>todo</documentation>
    <port name="TestPort" binding="tns:TestBinding">
      <soap:address location="https://demo.blablablablablabla.com:123/Bla"/>
    </port>
  </service>
</definitions> 
```

**错误跟踪**

```
request>just do it<
exception>RPC Message LaunchMissilesRequest in operation AbortMission has an invalid body name LaunchMissiles. It must be AbortMission<
   at System.ServiceModel.Description.XmlSerializerOperationBehavior.Reflector.OperationReflector.EnsureMessageInfos()
   at System.ServiceModel.Description.XmlSerializerOperationBehavior.Reflector.EnsureMessageInfos()
   at System.ServiceModel.Description.XmlSerializerOperationBehavior.Reflector.OperationReflector.get_Request()
   at System.ServiceModel.Description.XmlSerializerOperationBehavior.CreateFormatter()
   at System.ServiceModel.Description.XmlSerializerOperationBehavior.System.ServiceModel.Description.IOperationBehavior.ApplyClientBehavior(OperationDescription description, ClientOperation proxy)
   at System.ServiceModel.Description.DispatcherBuilder.BindOperations(ContractDescription contract, ClientRuntime proxy, DispatchRuntime dispatch)
   at System.ServiceModel.Description.DispatcherBuilder.ApplyClientBehavior(ServiceEndpoint serviceEndpoint, ClientRuntime clientRuntime)
   at System.ServiceModel.Description.DispatcherBuilder.BuildProxyBehavior(ServiceEndpoint serviceEndpoint, BindingParameterCollection& parameters)
   at System.ServiceModel.Channels.ServiceChannelFactory.BuildChannelFactory(ServiceEndpoint serviceEndpoint)
   at System.ServiceModel.ChannelFactory.CreateFactory()
   at System.ServiceModel.ChannelFactory.OnOpening()
   at System.ServiceModel.Channels.CommunicationObject.Open(TimeSpan timeout)
   at System.ServiceModel.ChannelFactory.EnsureOpened()
   at System.ServiceModel.ChannelFactory`1.CreateChannel(EndpointAddress address, Uri via)
   at System.ServiceModel.ChannelFactory`1.CreateChannel()
   at System.ServiceModel.ClientBase`1.CreateChannel()
   at System.ServiceModel.ClientBase`1.CreateChannelInternal()
   at System.ServiceModel.ClientBase`1.get_Channel()
   at MissileDefenseSystem.MissileDefenseSystemServiceReference.TestPortTypeClient.MissileDefenseSystem.MissileDefenseSystemServiceReference.TestPortType.LaunchMissiles(LaunchMissilesRequest request) in C:\Users\bra\Documents\Visual Studio 2008\Projects\MissileDefenseSystem\MissileDefenseSystem\Service References\MissileDefenseSystemServiceReference\Reference.cs:line 90
   at MissileDefenseSystem.MissileDefenseSystemServiceReference.TestPortTypeClient.LaunchMissiles(String arg0) in C:\Users\bra\Documents\Visual Studio 2008\Projects\MissileDefenseSystem\MissileDefenseSystem\Service References\MissileDefenseSystemServiceReference\Reference.cs:line 96
   at MissileDefenseSystem.Program.Main(String[] args) in C:\Users\bra\Documents\Visual Studio 2008\Projects\MissileDefenseSystem\MissileDefenseSystem\Program.cs:line 22 
```

使用Visual Studio 2008 (SvcUtil.exe)**生成的代理代码。**

```
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:2.0.50727.3074
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

[System.CodeDom.Compiler.GeneratedCodeAttribute("System.ServiceModel", "3.0.0.0")]
[System.ServiceModel.ServiceContractAttribute(Namespace="java:bla.bla.bla.bla", ConfigurationName="TestPortType")]
public interface TestPortType
{

    // CODEGEN: Generating message contract since the wrapper namespace (urn:Test) of message LaunchMissilesRequest does not match the default value (java:bla.bla.bla.bla)
    [System.ServiceModel.OperationContractAttribute(Action="urn:LaunchMissiles", ReplyAction="*")]
    [System.ServiceModel.XmlSerializerFormatAttribute(Style=System.ServiceModel.OperationFormatStyle.Rpc, Use=System.ServiceModel.OperationFormatUse.Encoded)]
    LaunchMissilesResponse LaunchMissiles(LaunchMissilesRequest request);

    // CODEGEN: Generating message contract since the wrapper namespace (urn:Test) of message AbortMissionRequest does not match the default value (java:bla.bla.bla.bla)
    [System.ServiceModel.OperationContractAttribute(Action="urn:AbortMission", ReplyAction="*")]
    [System.ServiceModel.XmlSerializerFormatAttribute(Style=System.ServiceModel.OperationFormatStyle.Rpc, Use=System.ServiceModel.OperationFormatUse.Encoded)]
    LaunchMissilesResponse AbortMission(LaunchMissilesRequest request);
}

[System.Diagnostics.DebuggerStepThroughAttribute()]
[System.CodeDom.Compiler.GeneratedCodeAttribute("System.ServiceModel", "3.0.0.0")]
[System.ServiceModel.MessageContractAttribute(WrapperName="LaunchMissiles", WrapperNamespace="urn:Test", IsWrapped=true)]
public partial class LaunchMissilesRequest
{

    [System.ServiceModel.MessageBodyMemberAttribute(Namespace="", Order=0)]
    public string arg0;

    public LaunchMissilesRequest()
    {
    }

    public LaunchMissilesRequest(string arg0)
    {
        this.arg0 = arg0;
    }
}

[System.Diagnostics.DebuggerStepThroughAttribute()]
[System.CodeDom.Compiler.GeneratedCodeAttribute("System.ServiceModel", "3.0.0.0")]
[System.ServiceModel.MessageContractAttribute(WrapperName="LaunchMissilesResponse", WrapperNamespace="urn:Test", IsWrapped=true)]
public partial class LaunchMissilesResponse
{

    [System.ServiceModel.MessageBodyMemberAttribute(Namespace="", Order=0)]
    public string @return;

    public LaunchMissilesResponse()
    {
    }

    public LaunchMissilesResponse(string @return)
    {
        this.@return = @return;
    }
}

[System.CodeDom.Compiler.GeneratedCodeAttribute("System.ServiceModel", "3.0.0.0")]
public interface TestPortTypeChannel : TestPortType, System.ServiceModel.IClientChannel
{
}

[System.Diagnostics.DebuggerStepThroughAttribute()]
[System.CodeDom.Compiler.GeneratedCodeAttribute("System.ServiceModel", "3.0.0.0")]
public partial class TestPortTypeClient : System.ServiceModel.ClientBase<TestPortType>, TestPortType
{

    public TestPortTypeClient()
    {
    }

    public TestPortTypeClient(string endpointConfigurationName) : 
            base(endpointConfigurationName)
    {
    }

    public TestPortTypeClient(string endpointConfigurationName, string remoteAddress) : 
            base(endpointConfigurationName, remoteAddress)
    {
    }

    public TestPortTypeClient(string endpointConfigurationName, System.ServiceModel.EndpointAddress remoteAddress) : 
            base(endpointConfigurationName, remoteAddress)
    {
    }

    public TestPortTypeClient(System.ServiceModel.Channels.Binding binding, System.ServiceModel.EndpointAddress remoteAddress) : 
            base(binding, remoteAddress)
    {
    }

    [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Advanced)]
    LaunchMissilesResponse TestPortType.LaunchMissiles(LaunchMissilesRequest request)
    {
        return base.Channel.LaunchMissiles(request);
    }

    public string LaunchMissiles(string arg0)
    {
        LaunchMissilesRequest inValue = new LaunchMissilesRequest();
        inValue.arg0 = arg0;
        LaunchMissilesResponse retVal = ((TestPortType)(this)).LaunchMissiles(inValue);
        return retVal.@return;
    }

    [System.ComponentModel.EditorBrowsableAttribute(System.ComponentModel.EditorBrowsableState.Advanced)]
    LaunchMissilesResponse TestPortType.AbortMission(LaunchMissilesRequest request)
    {
        return base.Channel.AbortMission(request);
    }

    public string AbortMission(string arg0)
    {
        LaunchMissilesRequest inValue = new LaunchMissilesRequest();
        inValue.arg0 = arg0;
        LaunchMissilesResponse retVal = ((TestPortType)(this)).AbortMission(inValue);
        return retVal.@return;
    }
} 
```

这是使用**SvcUtil.exe**生成的代理代码。

在此处下载完整的 Visual Studio 项目文件：

[http://dl.getdropbox.com/u/797094/MissileDefenseSystem.zip](http://dl.getdropbox.com/u/797094/MissileDefenseSystem.zip)

现在，我再次尝试使用 WSDL.exe。这效果更好，但现在下一个问题是丑陋的头。不使用 WCF 的 app.config。所以我需要配置代理类来使用证书。对于 WCF，我只是说

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <system.serviceModel>
        <bindings>
            <basicHttpBinding>
              <binding name="TestBinding"/>
            </basicHttpBinding>
        </bindings>
        <client>
            <endpoint address="https://demo.blablablablablabla.com:123/Bla"
                binding="basicHttpBinding" bindingConfiguration="TestBinding"
                contract="MissileDefenseSystemServiceReference.TestPortType"
                name="TestPort">
                <identity>
                    <certificateReference storeLocation="CurrentUser" x509FindType="FindByThumbprint"
                        findValue="the thumbprint to be used" />
                </identity>
            </endpoint>
        </client>
    </system.serviceModel>
</configuration> 
```

OK，现在用一段代码来提供签名

```
 proxy.ClientCertificates.Add(cert); 
```

这现在几乎可以工作了，只是它无法解码响应。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T21:12:25.370

这取决于你期望得到什么。这反映了您如何定义 wsdl。例如，如果你用 java:bla.bla.bla.bla 替换所有“urn:Test”，你会得到一个更简单的定义，它只接收/返回字符串。

如果您仍想获得 2 种不同的请求/响应类型，则可以使用此定义：

```
<?xml version="1.0" encoding="ISO-8859-1"?>
<definitions targetNamespace="java:bla.bla.bla.bla"
             xmlns="http://schemas.xmlsoap.org/wsdl/"
             xmlns:tns="java:bla.bla.bla.bla"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:xsd="http://www.w3.org/2001/XMLSchema"
             xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/">
  <types>
    <schema targetNamespace='java:bla.bla.bla.bla' xmlns='http://www.w3.org/2001/XMLSchema'/>
  </types>
  <message name="AbortTestRequest">
    <part name="arg0" type="xsd:string"/>
  </message>
  <message name="AbortTestResponse">
    <part name="return" type="xsd:string"/>
  </message>
  <message name="LaunchTestRequest">
    <part name="arg0" type="xsd:string"/>
  </message>
  <message name="LaunchTestResponse">
    <part name="return" type="xsd:string"/>
  </message>
  <portType name="TestPortType">
    <operation name="LaunchMissiles">
      <input message="tns:LaunchTestRequest"/>
      <output message="tns:LaunchTestResponse"/>
    </operation>
    <operation name="AbortMission">
      <input message="tns:AbortTestRequest"/>
      <output message="tns:AbortTestResponse"/>
    </operation>
  </portType>
  <binding name="TestBinding" type="tns:TestPortType">
    <soap:binding style="rpc"  transport="http://schemas.xmlsoap.org/soap/http"/>
    <operation name="LaunchMissiles">
      <soap:operation soapAction="urn:LaunchMissiles"/>
      <input>
        <soap:body use="encoded" namespace='java:bla.bla.bla.bla/launch' encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/>
      </input>
      <output>
        <soap:body use="encoded" namespace='java:bla.bla.bla.bla/launch' encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/>
      </output>
    </operation>
    <operation name="AbortMission">
      <soap:operation soapAction="urn:AbortMission"/>
      <input>
        <soap:body use="encoded" namespace='java:bla.bla.bla.bla/launch' encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/>
      </input>
      <output>
        <soap:body use="encoded" namespace='java:bla.bla.bla.bla/launch' encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/>
      </output>
    </operation>
  </binding>
  <service name="Test">
    <documentation>todo</documentation>
    <port name="TestPort" binding="tns:TestBinding">
      <soap:address location="https://demo.blablablablablabla.com:123/Bla"/>
    </port>
  </service>
</definitions> 
```

附言。由于您似乎想要所有操作/方法的请求/响应文档，您可能希望完全切换到文档样式。

* * *

关于无法做出重大更改的评论。更改消息元素的名称空间或名称是重大更改。

也就是说，如果您只对使其工作感兴趣（而不关心您获得的课程的形式），您可以使用您拥有的版本。生成的类对这两种方法都使用 LaunchMissileResponse 并不重要，因为底层 XML 将是相同的（一个 TestResponse）。同样对于调用代码，请记住您有一个接收/发送简单字符串的版本：

```
public string AbortMission(string arg0) 
```

# linux - 如何检查文件是否存在并在不存在时执行命令？

> ID：669675
> 
> 赞同：32
> 
> 时间：2009-03-21T18:01:01.417
> 
> 标签：linux, shell

我有一个使用 Python 编写的守护程序。当它运行时，它有一个位于 /tmp/filename.pid 的 PID 文件。如果守护程序未运行，则 PID 文件不存在。

在 Linux 上，如何检查以确保 PID 文件存在，如果不存在，请执行命令重新启动它？

该命令将是

```
python daemon.py restart 
```

必须从特定目录执行。

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2009-03-21T18:05:34.867

```
[ -f /tmp/filename.pid ] || python daemon.py restart 
```

`-f`检查给定路径是否存在并且是常规文件（仅`-e`检查路径是否存在）

执行`[]`测试并返回`0`成功，`1`否则

是`||`一个 C-like `or`，所以如果左边的命令失败，执行右边的命令。

所以最后的语句说，如果`/tmp/filename.pid`不存在则启动守护进程。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2014-11-26T07:14:26.757

```
test -f filename && daemon.py restart || echo "File doesn't exists" 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-21T18:07:20.697

如果它是您想知道的 bash 脚本，那么这样的事情会起作用：

```
if [ ! -f "$FILENAME" ]; then
   python daemon.py restart
fi 
```

更好的选择可能是查看[锁定文件](http://linux.die.net/man/1/lockfile)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-21T18:10:07.900

其他答案适用于检测文件的存在。但是，对于一个完整的解决方案，您可能应该检查 pidfile 中的 PID 是否仍在运行，并且它是您的程序。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-21T18:51:03.620

解决问题的另一种方法是编写一个脚本，确保你的守护进程“保持”活着......

像这样的东西（注意：应添加信号处理以正确启动/关闭）：

```
$PIDFILE = "/path/to/pidfile"

if [ -f "$PIDFILE" ]; then
    echo "Pid file exists!"
    exit 1
fi

while true; do
    # Write it's own pid file
    python your-server.py ;

    # force removal of pid in case of unexpected death.
    rm -f $PIDFILE;

    # sleep for 2 seconds
    sleep 2;

done 
```

这样，即使服务器意外死亡，它也会保持活力。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-21T18:56:13.357

您还可以使用像[Monit](http://mmonit.com/monit/)这样的现成解决方案。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-03-21T05:23:28.817

```
ls /tmp/filename.pid 
```

如果文件存在，则返回 true。如果文件不存在，则返回 false。

# c# - 您发现在 c# 中断言参数正确性的最流畅、最吸引人的语法是什么？

> ID：669678
> 
> 赞同：30
> 
> 时间：2009-03-21T18:04:22.220
> 
> 标签：c#, c#-3.0, lambda

任何语言的一个常见问题是断言发送到方法的参数满足您的要求，如果不满足，则发送漂亮的、信息丰富的错误消息。这种代码会一遍又一遍地重复，我们经常尝试为它创建助手。然而，在 C# 中，这些助手似乎被迫处理语言和编译器强加给我们的一些重复。为了说明我的意思，让我展示一些没有助手的原始代码，然后是一个可能的助手。然后，我将指出助手中的重复内容并准确地表达我的问题。

**首先，没有任何助手的代码：**

```
public void SomeMethod(string firstName, string lastName, int age)
{
     if(firstName == null)
     {
          throw new WhateverException("The value for firstName cannot be null.");
     }

     if(lastName == null)
     {
          throw new WhateverException("The value for lastName cannot be null.");
     }

     // Same kind of code for age, making sure it is a reasonable range (< 150, for example).
     // You get the idea
} 
```

}

**现在，对助手进行合理尝试的代码：**

```
public void SomeMethod(string firstName, string lastName, int age)
{
      Helper.Validate( x=> x !=null, "firstName", firstName);
      Helper.Validate( x=> x!= null, "lastName", lastName);
} 
```

**主要问题是：**注意代码如何传递参数的值和参数**的**名称（“firstName”**和**firstName）。这样错误消息就可以说“Blah blah blah the value for the **firstName** parameter”。你有没有找到任何方法来使用反射或其他方法来解决这个问题？或者有什么方法可以减轻痛苦？

更一般地说，您是否找到了任何其他方法来简化验证参数的任务，同时减少代码重复？

编辑：我读过人们谈论使用参数属性，但从来没有完全找到解决重复的方法。有人有运气吗？

谢谢！

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-21T18:11:19.347

您应该查看[**代码合同**](http://weblogs.asp.net/podwysocki/archive/2008/11/08/code-contracts-for-net-4-0-spec-comes-alive.aspx)；他们几乎完全按照您的要求做。例子：

```
[Pure]
public static double GetDistance(Point p1, Point p2)
{
    CodeContract.RequiresAlways(p1 != null);
    CodeContract.RequiresAlways(p2 != null); 
    // ...
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-22T02:58:49.843

哇，我在这里发现了一些非常有趣的东西。上面的 Chris 给出了另一个 Stack Overflow 问题的链接。其中一个答案指向一篇博客文章，该文章描述了如何获取这样的代码：

```
public static void Copy<T>(T[] dst, long dstOffset, T[] src, long srcOffset, long length)
{
    Validate.Begin()
            .IsNotNull(dst, “dst”)
            .IsNotNull(src, “src”)
            .Check()
            .IsPositive(length)
            .IsIndexInRange(dst, dstOffset, “dstOffset”)
            .IsIndexInRange(dst, dstOffset + length, “dstOffset + length”)
            .IsIndexInRange(src, srcOffset, “srcOffset”)
            .IsIndexInRange(src, srcOffset + length, “srcOffset + length”)
            .Check();

    for (int di = dstOffset; di < dstOffset + length; ++di)
        dst[di] = src[di - dstOffset + srcOffset];
} 
```

我不相信这是**最好的**答案，但它肯定很有趣。[这是 Rick Brewster 的博客文章](http://blog.getpaint.net/2008/12/06/a-fluent-approach-to-c-parameter-validation/)。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-21T19:22:50.767

几周前我解决了这个确切的问题，因为我认为测试库似乎需要一百万个不同版本`Assert`来使它们的消息具有描述性，这很奇怪。

[这是我的解决方案](http://incrediblejourneysintotheknown.blogspot.com/2009/02/displaying-nested-evaluation-tree-from.html)。

简要总结 - 给出这段代码：

```
int x = 3;
string t = "hi";
Assert(() => 5*x + (2 / t.Length) < 99); 
```

我的 Assert 函数可以打印出以下传递给它的摘要：

```
(((5 * x) + (2 / t.Length)) < 99) == True where
{
  ((5 * x) + (2 / t.Length)) == 16 where
  {
    (5 * x) == 15 where
    {
      x == 3
    }
    (2 / t.Length) == 1 where
    {
      t.Length == 2 where
      {
        t == "hi"
      }
    }
  }
} 
```

因此，所有标识符名称和值以及表达式的结构都可以包含在异常消息中，而您不必在带引号的字符串中重新声明它们。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-21T20:54:41.233

这可能有点帮助：

[按合同设计/C# 4.0/避免 ArgumentNullException](https://stackoverflow.com/questions/434088/design-by-contract-c-4-0-avoidng-argumentnullexception)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-22T03:09:38.523

好吧，伙计们，又是我，我发现了其他令人惊讶和令人愉快的东西。这是上面克里斯提到的另一个 SO 问题中提到的另一篇博客文章。

这家伙的方法可以让你这样写：

```
public class WebServer
    {
        public void BootstrapServer( int port, string rootDirectory, string serverName )
        {
            Guard.IsNotNull( () => rootDirectory );
            Guard.IsNotNull( () => serverName );

            // Bootstrap the server
        }
    } 
```

**请注意，没有包含“rootDirectory”的字符串，也没有包含“serverName”的字符串！！**然而，他的错误消息可能会说诸如“rootDirectory 参数不能为空”之类的内容。

这正是我想要的，而且比我希望的还要多。[这是该人博客文章的链接。](http://jonfuller.codingtomusic.com/2008/12/11/static-reflection-method-guards/)

而且实现也很简单，如下：

```
public static class Guard
    {
        public static void IsNotNull<T>(Expression<Func<T>> expr)
        {
            // expression value != default of T
            if (!expr.Compile()().Equals(default(T)))
                return;

            var param = (MemberExpression) expr.Body;
            throw new ArgumentNullException(param.Member.Name);
        }
    } 
```

请注意，这使用了“静态反射”，因此在紧密循环或其他情况下，您可能希望使用上述 Rick Brewster 的方法。

一旦我发布这个，我就会投票赞成克里斯，以及对另一个 SO 问题的回应。这是一些好东西！！！

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-21T18:31:19.580

使用我的图书馆[The Helper Trinity](http://thehelpertrinity.codeplex.com/)：

```
public void SomeMethod(string firstName, string lastName, int age)
{
    firstName.AssertNotNull("firstName");
    lastName.AssertNotNull("lastName");

    ...
} 
```

还支持断言枚举参数是正确的，集合及其内容是非`null`，字符串参数是非空等等。有关详细示例，请参阅[此处](http://thehelpertrinity.codeplex.com/Wiki/View.aspx?title=wiki%20documentation&referringTitle=Home#ArgumentHelper)的用户文档。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-07-05T15:05:34.390

这是我对这个问题的回答。我称之为“[守卫爪](http://github.com/littlebits/guard_claws/ "护爪")”。它使用 Lokad 共享库中的 IL 解析器，但有一种更直接的方法来说明实际的保护子句：

```
string test = null;
Claws.NotNull(() => test); 
```

[您可以在specs](http://github.com/littlebits/guard_claws/tree/master/specs "眼镜")中看到更多关于它的使用示例。

由于它使用真正的 lambdas 作为输入，并且仅在违规情况下使用 IL Parser 来生成异常，因此它在“快乐路径”上的性能应该比这些答案中其他地方的基于表达式的设计更好。

链接不起作用，这里是 URL：http: [//github.com/littlebits/guard_claws/](http://github.com/littlebits/guard_claws/)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-18T00:20:40.887

[Lokad 共享库](http://abdullin.com/journal/2008/12/22/better-c-design-contracts-in-lokad-shared-libraries.html)还有一个基于 IL 解析的实现，避免了在字符串中重复参数名称。

例如：

```
Enforce.Arguments(() => controller, () => viewManager,() => workspace); 
```

如果列出的任何参数为空，将使用适当的参数名称引发异常。它还有一个非常简洁的基于策略的规则实现。

例如

```
Enforce.Argument(() => username,    StringIs.Limited(3, 64), StringIs.ValidEmail); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-21T18:21:19.493

我的偏好是只评估条件并传递结果，而不是传递要评估的表达式和评估它的参数。此外，我更喜欢能够自定义整个消息。请注意，这些只是偏好——我并不是说你的样本是错误的——但在某些情况下这非常有用。

```
Helper.Validate( firstName != null || !string.IsNullOrEmpty(directoryID),
                 "The value for firstName cannot be null if a directory ID is not supplied." ); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-21T18:11:00.673

在这种情况下，不要使用您自己的异常类型，或者像 ApplicationException 这样的真正通用类型。我认为最好使用专门用于此用途的内置异常类型：

其中.. System.ArgumentException，System.ArgumentNullException ...

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-21T18:14:06.610

不知道这种技术是否从 C/C++ 转移到 C#，但我已经用宏完成了这个：

```
    #define CHECK_NULL(x) { (x) != NULL || \
           fprintf(stderr, "%s 中 %s 的值，第 %d 行为空。\n", \
           #x, __FILENAME__, __LINE__); }

```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-21T19:24:17.237

[Postsharp](http://www.postsharp.org/)或其他一些[AOP](http://en.wikipedia.org/wiki/Aspect-oriented_programming) [框架](http://csharp-source.net/open-source/aspect-oriented-frameworks)。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-22T23:17:38.667

它并不适用于所有地方，但在许多情况下可能会有所帮助：

我认为“SomeMethod”正在对数据“姓氏”、“名字”和“年龄”进行一些行为操作。评估您当前的代码设计。如果这三个数据都在哭一个类，就把它们放到一个类中。在该课程中，您还可以放置支票。这将使“SomeMethod”免于输入检查。

最终结果将是这样的：

```
public void SomeMethod(Person person)
{
    person.CheckInvariants();
    // code here ...
} 
```

调用将是这样的（如果您使用 .NET 3.5）：

```
SomeMethod(new Person { FirstName = "Joe", LastName = "White", Age = 12 }); 
```

假设该类看起来像这样：

```
public class Person
{
    public string FirstName { get; set; }
    public string LastName { get; set; }
    public int Age { get; set; }

    public void CheckInvariants()
    {
        assertNotNull(FirstName, "first name");
        assertNotNull(LastName, "last name");
    }

    // here are your checks ...
    private void assertNotNull(string input, string hint)
    {
        if (input == null)
        {
            string message = string.Format("The given {0} is null.", hint);
            throw new ApplicationException(message);
        }
    } 
```

除了 .NET 3.5 的语法糖，您还可以使用构造函数参数来创建 Person 对象。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-22T23:35:36.330

作为对比，[Miško Hevery](http://misko.hevery.com/)在[Google 测试博客上的](http://googletesting.blogspot.com/)[这篇](http://googletesting.blogspot.com/2009/02/to-assert-or-not-to-assert.html)文章认为，这种参数检查可能并不总是一件好事。评论中由此产生的辩论也提出了一些有趣的观点。

# ruby-on-rails - 有没有像 ruby on rails 这样的 .net mvc 应用程序控制器？

> ID：669685
> 
> 赞同：2
> 
> 时间：2009-03-21T18:07:32.647
> 
> 标签：ruby-on-rails, asp.net-mvc

每次请求页面时，我都有一些导航需要访问数据库。在 Rails 中，我只需在 ApplicationController.rb 中设置一个实例变量，每个控制器/视图都可以使用它。

现在我看到我所有的控制器都来自：.NET MVC 中的控制器。我可以为 Controller 打开一个部分类并添加一个每次请求页面时都会调用的操作过滤器吗？

或者我应该创建一个 ApplicationController : Controller，并让我的所有其他控制器都继承自该控制器？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T18:30:51.797

Controller 是一个抽象（不是部分）类，因此您需要创建一个扩展 Controller 的基本控制器类并让您的控制器继承自它。[您可以在http://aspnet.codeplex.com/SourceControl/ListDownloadableCommits.aspx](http://aspnet.codeplex.com/SourceControl/ListDownloadableCommits.aspx)找到源代码（目前适用于 RC1）。或者，您可以简单地使用适当的自定义 ActionFilterAttribute 装饰您的控制器，但我的首选是自定义基本控制器，除非过滤器需要为每个控制器采用不同的参数。

# .net - 在richtextbox（vb.net）中以编程方式反向选择文本

> ID：669686
> 
> 赞同：0
> 
> 时间：2009-03-21T18:07:45.813
> 
> 标签：.net, vb.net, scrollbar, selection

我有一个带有richtextbox 和滚动条的表单。我希望能够继续将文本附加到文本框而不会丢失我的选择。我可以在添加文本并将其设置回来之前保存 selectionstart 和 selectionlength 并且它可以工作。问题在于反向选择。我能做的最好的就是将 selectionstart 设置在正确的位置，但我必须移动鼠标才能再次选择文本。我在附加文本之前和之后使用以下函数：

```
Private Sub StopRepaint()
Dim pt As Point
' Stop redrawing:
SendMessage(txtchat.Handle, WM_SETREDRAW, 0, pt)
' Stop sending of events:
eventmask = SendMessage(txtchat.Handle, EM_GETEVENTMASK, 0, pt)
End Sub

Private Sub StartRepaint()
Dim pt As Point
' turn on events
SendMessage(txtchat.Handle, EM_SETEVENTMASK, 0, pt)
' turn on redrawing
SendMessage(txtchat.Handle, WM_SETREDRAW, 1, pt)
' this forces a repaint, which for sotxtchat reason is necessary in sotxtchat cases.
txtchat.Invalidate()
End Sub 
```

如果我的滚动条位置不在完全底部，我将在附加文本后使用它重新设置：

```
If Not isbottom(getpos) Then
    PostMessageA(txtchat.Handle, WM_VSCROLL, SB_THUMBPOSITION + _
                       &H10000 * getpos(), Nothing)
End If 
```

我的主要目标是即使将新文本附加到richtextbox 也能够选择和复制文本。任何人都知道如何正确选择反向文本或轻松解决我关于取消选择文本的问题？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-11T10:50:05.640

我会尝试制作“可选块”，让每个附加的文本块独立于下一个块。有点像MSN Messenger。您可以使“面板”看起来无缝，并且使用 stringbuilder 可以将最终块安全地导出为单个流。

# .net - 使用 Visual Studio 2008 的 .NET 安装项目

> ID：669690
> 
> 赞同：10
> 
> 时间：2009-03-21T18:09:57.243
> 
> 标签：.net, deployment, installation, windows-installer

当您为 Windows/Console 应用程序创建安装项目时，您会发现有两个输出。

1.  安装程序
2.  .msi

setup.exe 和*.MSI*有什么作用？安装时应该使用哪一种？

我已经看到我可以使用两者来安装应用程序。*但是与.MSI*文件相比，Setup.exe 是相当小的文件。

**问题**

1.  如果我必须运送给客户。我无法发送两个文件。将这两个文件合并为一个安装文件的最佳方法是什么？

2.  我读过 Setup.exe 是一个引导程序，它检查 .NET 框架，然后调用 .MSI 文件。这是正确的吗？

3.  我无法测试 .NET 框架的不可用性，因为我是 .NET 开发人员，而且我的团队也在 .NET 上工作并安装了 .NET。我不想通过卸载 .NET 框架和测试安装应用程序来冒险使用 Visual Studio。

它如何安装 .NET 框架？它是 200 MB 奇数，但我的设置小于 3 MB。

它是否提供下载或其他选项？

任何帮助表示赞赏。

谢谢，

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-21T18:13:43.553

MSI 是您应用程序的安装程序。安装文件是一个引导程序，将检查 pre-reqs。就像 Windows 安装程序的正确版本一样。我认为这也是 setup.exe 将允许下载正确版本的 .NET 框架。您可以单独使用 .MSI，而不能只使用 setup.exe。

您是正确的，该设置允许下载正确版本的 .NET 框架。

有多种方法可以合并 MSI 和 Setup.exe 以创建单个 exe。诸如自解压 zip 或 iexpress 之类的东西。

为什么你不能同时发送他们两个文件呢？我认为，如果您在服务器上发布设置和 msi 以供下载，则设置会在需要时找到并下载您的 MSI。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T18:27:37.937

我认为单独 setup.exe 的原因是因为您不能同时运行两个 MSI 安装。因此，如果您的应用程序需要 MSI 安装的先决条件，您的安装将遇到麻烦。

关于设置框架，您可以在项目设置中包含 .NET 框架作为应用程序的先决条件，如果目标计算机上尚未安装它，是否会安装它。您可以进一步选择打包安装或从互联网下载

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T18:20:51.603

Setup.exe 确实是一个引导程序，用于检查客户端计算机上是否存在先决条件。这包括 .Net 框架，但也包括例如 SQL Compact Edition，当您在项目的属性中选择它时。它不会卸载任何东西。当需要先决条件时，它将提供从 Internet 下载或停止安装的选项。

MSI 文件是包含您的软件的 Windows 安装程序文件。此 MSI 负责在客户端机器上安装您的产品。如果您仅提供 MSI，则该产品将仅安装在启动 MSI 之前已安装所有先决条件的计算机上。

如果要进行单个文件分发，可以使用 iexpress 将 2 个文件合并到一个 EXE 中。（Iexpress 是一个随 Windows 一起分发的软件，允许您创建安装包。）

希望这可以帮助。

# c# - Enumerable.Except 问题

> ID：669709
> 
> 赞同：6
> 
> 时间：2009-03-21T18:19:31.073
> 
> 标签：c#, linq

有人可以解释为什么这不像我认为的那样有效。

```
double[] numbers1 = { 2.0, 2.1, 2.2, 2.3, 2.3, 2.3, 2.4, 2.5 };
double[] numbers2 = { 2.2 };

IEnumerable<double> onlyInFirstSet = numbers1.Except(numbers2);

foreach (double number in onlyInFirstSet)
    Console.WriteLine(number);

/*
 This code produces the following output:

 2
 2.1
 2.3
 2.4
 2.5
*/ 
```

我期望的是 2、2.1、2.3、2.3、2.3、2.4、2.5。为什么除了返回一个不同的列表？这是一个错误吗？

更新：

好的，完全错过了文档中的这一点。有趣的 4 人回答相同的答案。你会认为你会投票给第一个回答的人。:)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-21T18:27:51.007

> 为什么除了返回一个不同的列表？这是一个错误吗？

没有。`Except`产生一**组差异**。请参阅[文档](http://msdn.microsoft.com/en-us/library/bb300779.aspx)：

> 通过使用默认相等比较器比较值来产生两个序列的集合差。

要执行您想要的操作，只需使用`Where`适当地过滤值。例如：

```
"abcdddefffg".Where(e => !"cde".Contains(e));       // Produces "abfffg". 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T18:29:43.483

这实际上是正确的行为。该`Except`方法被记录为返回两个 IEnumerable 参数的*集合*差异。由于根据定义，集合不能包含重复元素，因此这些元素在结果中被消除。有关详细信息，请参阅[MSDN 文档](http://msdn.microsoft.com/en-us/library/bb300779.aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T18:31:10.907

因为“Except”是一个“集合”函数，而“集合”的概念被定义为一个唯一的项目列表。换句话说，根据定义，集合不能包含重复项。

# cobol - Fujitsu COBOL 3.0 - 执行问题

> ID：669719
> 
> 赞同：1
> 
> 时间：2009-03-21T18:22:40.973
> 
> 标签：cobol

在 Fujitsu COBOL 3.0 中运行 cobol prog 时发生错误，提示找不到 F3BIPRCT.dll。可能是什么问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T18:35:22.627

你能追踪到`F3BIPRCT.dll`吗？如果是这样，请确保它所在的目录在您的`PATH`变量中。

# c# - 检查格式为“yyyy/mm/dd”的字符串是否为有效日期的正则表达式，包括月份范围

> ID：669741
> 
> 赞同：0
> 
> 时间：2009-03-21T18:37:35.977
> 
> 标签：c#, regex, datetime

我正在尝试以“yyyy/mm/dd”格式验证 c# 中的日期。甚至有可能（使用正则表达式）验证二月份没有 30 天吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-21T18:44:26.443

使用正则表达式可以做到这一点，但它会非常复杂。我很喜欢编写正则表达式，但我不会使用该解决方案来验证日期。

使用另一种解决方案来验证日期要简单得多。每种编程语言都有可用的日期验证组件。我不是 .NET 的用户，但通过快速搜索我找到了`DateTime`该类，它似乎可以做到这一点。

请参阅 .NET Framework 开发人员指南，“[解析日期和时间字符串](http://msdn.microsoft.com/en-us/library/2h3syy57(VS.71).aspx)”。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-21T18:46:35.283

正如其他人所说，正则表达式不是最好的方法，除非你被迫（例如，出于客户端 JavaScript 的原因）。

我建议您使用[`DateTime.TryParseExact`](http://msdn.microsoft.com/en-us/library/system.datetime.tryparseexact.aspx)“yyyy/MM/dd”模式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-21T18:45:40.187

是的，这是可能的，但它变得相当冗长。仅用于检查月份和日期的模式有相当多的变化，并且必须在闰年重复。

例如，下面是[Michael Ash 的 Regex 博客](http://regexadvice.com/blogs/mash/archive/2004/04/02/300.aspx)中 mm/dd/yyyy 格式的模式：

```
^(?:(?:(?:0?[13578]|1[02])(\/|-|\.)31)\1|(?:(?:0?[1,3-9]|1[0-2])(\/|-|\.)(?:29|30)\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:0?2(\/|-|\.)29\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:(?:0?[1-9])|(?:1[0-2]))(\/|-|\.)(?:0?[1-9]|1\d|2[0-8])\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$ 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-21T18:47:52.113

有可能做到这一点。甚至可以在闰年这样做，但这会很复杂。

此日期格式的简单表达式：

```
^\d{4}/\d{2}/\d{2}$ 
```

考虑每月天数的更复杂的表达式（但 2 月仍然允许每年 29 天）：

```
^\d{4}/(?:02/(?:0[1-9]|[12]\d)|(?:0[13578]|1[02])/(?:0[1-9]|[12]\d|3[01])|(?:0[469]|11)/(?:0[1-9]|[12]\d|30))$ 
```

但是使用内置的 C# 函数可能更容易做到这一点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T18:42:27.527

可能，但是闰年的东西真的很难，所以你可能想要使用正则表达式以外的东西。

# c++ - 在 NULL 指针上访问类成员

> ID：669742
> 
> 赞同：50
> 
> 时间：2009-03-21T18:38:52.697
> 
> 标签：c++, null, virtual, null-pointer

我正在试验 C++，发现下面的代码很奇怪。

```
class Foo{
public:
    virtual void say_virtual_hi(){
        std::cout << "Virtual Hi";
    }

    void say_hi()
    {
        std::cout << "Hi";
    }
};

int main(int argc, char** argv)
{
    Foo* foo = 0;
    foo->say_hi(); // works well
    foo->say_virtual_hi(); // will crash the app
    return 0;
} 
```

我知道虚拟方法调用会崩溃，因为它需要 vtable 查找并且只能使用有效对象。

我有以下问题

1.  非虚方法如何`say_hi`在 NULL 指针上工作？
2.  对象在哪里`foo`分配？

有什么想法吗？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2009-03-21T18:53:42.817

该对象`foo`是一个类型为 的局部变量`Foo*`。`main`就像任何其他局部变量一样，该变量可能会在函数的堆栈上分配。但是存储的*值*`foo`是一个空指针。它没有指向任何地方。任何地方都没有`Foo`表示类型的实例。

要调用虚函数，调用者需要知道该函数是在哪个对象上被调用的。那是因为对象本身告诉我们应该真正调用哪个函数。（这通常通过给对象一个指向 vtable 的指针、一个函数指针列表来实现，而调用者只知道它应该调用列表中的第一个函数，而事先不知道该指针指向的位置。）

但是要调用一个非虚拟函数，调用者不需要知道所有这些。编译器确切地知道将调用哪个函数，因此它可以生成`CALL`机器代码指令以直接转到所需的函数。它只是将一个指向函数调用对象的指针作为隐藏参数传递给函数。换句话说，编译器将您的函数调用转换为：

```
void Foo_say_hi(Foo* this);

Foo_say_hi(foo); 
```

现在，由于该函数的实现从不引用其`this`参数所指向的对象的任何成员，因此您有效地避开了取消引用空指针的子弹，因为您从不取消引用空指针。

正式地，在空指针上调用*任何*函数——甚至是非虚拟函数——都是未定义的行为。未定义行为的允许结果之一是您的代码似乎完全按照您的预期运行。*您**不*应该依赖它，尽管有时您会从编译器供应商那里找到依赖它的库。但是编译器供应商的优势在于能够为原本未定义的行为添加进一步的定义。不要自己做。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-21T18:45:07.130

`say_hi()`成员函数通常由编译器实现为

```
void say_hi(Foo *this); 
```

由于您不访问任何成员，因此您的调用成功（即使您根据标准输入未定义的行为）。

`Foo`根本没有被分配。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-21T18:44:21.797

取消引用 NULL 指针会导致“未定义的行为”，这意味着任何事情都可能发生 - 您的代码甚至可能看起来正常工作。但是，您不能依赖于此 - 如果您在不同的平台上（甚至可能在同一平台上）运行相同的代码，它可能会崩溃。

在您的代码中没有 Foo 对象，只有一个以 NULL 值初始化的指针。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-21T19:00:08.387

这是未定义的行为。但是如果您不访问成员变量和虚拟表，大多数编译器都会做出正确处理这种情况的指令。

让我们看看 Visual Studio 中的反汇编，了解会发生什么

```
 Foo* foo = 0;
004114BE  mov         dword ptr [foo],0 
    foo->say_hi(); // works well
004114C5  mov         ecx,dword ptr [foo] 
004114C8  call        Foo::say_hi (411091h) 
    foo->say_virtual_hi(); // will crash the app
004114CD  mov         eax,dword ptr [foo] 
004114D0  mov         edx,dword ptr [eax] 
004114D2  mov         esi,esp 
004114D4  mov         ecx,dword ptr [foo] 
004114D7  mov         eax,dword ptr [edx] 
004114D9  call        eax 
```

如您所见， Foo:say_hi 像往常一样调用函数，但在 ecx 寄存器中使用了*this 。*为简化起见，您可以假设*this*作为隐式参数传递，我们在您的示例中从未使用过。
但在第二种情况下，我们计算函数到期虚拟表的地址 - 到期 foo 地址并获取核心。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-21T18:49:43.920

a) 它之所以有效，是因为它不会通过隐含的“this”指针取消引用任何内容。一旦你这样做，繁荣。我不是 100% 确定，但我认为空指针取消引用是通过 RW 保护前 1K 的内存空间完成的，所以如果你只取消引用它超过 1K 行（即一些实例变量这将被分配得很远，例如：

```
 class A {
     char foo[2048];
     int i;
 } 
```

那么当 A 为空时 a->i 可能未被捕获。

b）无处，您只声明了一个指针，该指针分配在 main():s 堆栈上。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-21T18:53:28.623

对 say_hi 的调用是静态绑定的。所以计算机实际上只是简单地对一个函数进行标准调用。该函数不使用任何字段，因此没有问题。

对 virtual_say_hi 的调用是动态绑定的，因此处理器会转到虚拟表，由于那里没有虚拟表，它会随机跳转到某个地方并使程序崩溃。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-04-24T17:49:57.963

重要的是要认识到这*两个*调用都会产生未定义的行为，并且这种行为可能会以意想不到的方式表现出来。即使电话*似乎*奏效，它也可能正在埋下雷区。

考虑对您的示例进行这个小改动：

```
Foo* foo = 0;
foo->say_hi(); // appears to work
if (foo != 0)
    foo->say_virtual_hi(); // why does it still crash? 
```

由于第一次调用`foo`if 为 null 时启用未定义的行为`foo`，编译器现在可以自由地假设它`foo`不为*null*。这使得`if (foo != 0)`冗余，编译器可以优化它！你可能认为这是一个非常无意义的优化，但是编译器编写者已经变得非常激进，并且在实际代码中也发生过类似的事情。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-21T18:59:31.323

在 C++ 的最初时代，C++ 代码被转换为 C。对象方法被转换为像这样的非对象方法（在你的情况下）：

```
foo_say_hi(Foo* thisPtr, /* other args */) 
{
} 
```

当然，名称 foo_say_hi 是简化的。有关更多详细信息，请查看 C++ 名称修饰。

如您所见，如果 thisPtr 从未被取消引用，则代码很好并且成功。在您的情况下，没有使用实例变量或任何依赖于 thisPtr 的东西。

但是，虚函数是不同的。有很多对象查找来确保正确的对象指针作为参数传递给函数。这将取消引用 thisPtr 并导致异常。

# ruby - 屏幕抓取网页，使用 Mechanize 明智地显示数据页面

> ID：669745
> 
> 赞同：0
> 
> 时间：2009-03-21T18:40:40.853
> 
> 标签：ruby, screen-scraping, paging, mechanize

我正在尝试筛选一个网页（使用 Mechanize），它以网格页面的方式显示记录。我能够读取第一页中显示的值，但现在需要导航到下一页以读取适当的值。

```
<tr>
    <td><span>1</span></td>
    <td><a href="javascript:__doPostBack('gvw_offices','Page$2')">2</a></td>
    <td><a href="javascript:__doPostBack('gvw_offices','Page$3')" >3</a></td>
    <td><a href="javascript:__doPostBack('gvw_offices','Page$4')" >4</a></td>
    <td><a href="javascript:__doPostBack('gvw_offices','Page$5')" >5</a></td>
    <td><a href="javascript:__doPostBack('gvw_offices','Page$6')">6</a></td>
    <td><a href="javascript:__doPostBack('gvw_offices','Page$7')" >7</a></td>
    <td><a href="javascript:__doPostBack('gvw_offices','Page$8')">8</a></td>
    <td><a href="javascript:__doPostBack('gvw_offices','Page$9')" >9</a></td>
    <td><a href="javascript:__doPostBack('gvw_offices','Page$10')" >10</a></td>
    <td><a href="javascript:__doPostBack('gvw_offices','Page$11')">...</a></td>
</tr> 
```

我能够通过所有链接但是当我尝试这个时： -

```
links = (row/"a")
links.each do |link|
    agent.click link.attributes['href']   # This fails 
    agent.click link   # This also fails
end 
```

原因是 agent.click 期望 URL 作为参数。

有没有一种方法可以在页面显示时读取所有值？如果不是，当 href 是回发而不是 URL 时，我们怎么能有这样的点击操作？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T18:56:08.163

Mechanize 不能处理 javascript，所以基本上你有两个选择：

*   使用[scrubyt](http://scrubyt.org/)和 firewatir：这是一种编写浏览器脚本的方法（因此 Firefox 处理 javascript 部分）
*   手动检查base url并动态添加页码

就像是：

```
base_url = 'http://example.com/gvw_offcies&page='
links.each do |link|
  page_number = ... #get the page number from link
  agent.get base_url+page_number
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-09-23T19:36:41.817

上面的所有解决方案我过去已经尝试了很长时间（尤其是 Celerity），但我的结论是它们都很糟糕并且有严重的缺点，这让生活变得非常困难，因为它们基于相同的 HtmlUnit 引擎处理 Javascript。

Celerity 不是屏幕抓取工具，它缺少 Windows 管理，并且基于 HTMLUNIT 引擎，在处理 Javascript 方面一点也不擅长。但是，对于使用最低到中等级别的 Javascript 和 AJAX 请求的站点，它可以快速运行。它基于 ruby​​，这对于那些不喜欢 Java 的人来说是一种解脱。

你最好的选择是使用 Selenium WebDriver API。这需要在您的 linux 服务器上显示 X，并且它比 HtmlUnit 慢，但它不会让您烦恼使用任何派生或包装 HtmlUnit 时会遇到的许多问题。有一个使用 HtmlUnit 的选项，但是你牺牲了准确性和一致性来换取速度。HtmlUnit 的抓取速度要快得多。

但是，抓取不属于您的其他网站的速度总是不是一件好事，因为它通常会导致 IP 禁令。

我个人的建议是远离使用 HtmlUnit 引擎的任何事情，并使用 Selenium 直接远程控制您选择的浏览器，以获得最大的准确性和可靠性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-20T22:03:48.777

您可以尝试在 Jruby 中使用 Celerity 并将页面传递给 HTML 解析库。Celerity 应该与 Watir 兼容 API，并且是 HtmlUnit 的包装器。我使用 mechanize 进行数据收集，但对于一些用 JS 生成的站点，我不得不切换到这个。

[http://celerity.rubyforge.org/](http://celerity.rubyforge.org/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-12T11:10:08.623

我会使用类似[webscarab](http://www.owasp.org/index.php/Category:OWASP_WebScarab_Project)的东西来简单地查看 Javascript 所做的 POST 请求的实际去向。特别是对于 AJAX 的东西，无论如何它们只是 HTTP 请求。
只需启动它并将其设置为 Firefox 中的代理。大多数时候，您可以看到某种模式，然后直接抓取这些 URL

# smtp - 需要帮助设置 windows server 2008 SMTP 服务器

> ID：669754
> 
> 赞同：2
> 
> 时间：2009-03-21T18:44:41.450
> 
> 标签：smtp, windows-server-2008, sysadmin

我正在尝试设置 windows server 2008 smtp 服务器以将电子邮件中继到 gmail smtp。一切似乎都已设置，但它没有发送电子邮件。你能帮我弄清楚什么是错的。

下面是设置：

*   安装了 SMTP 服务器功能的 Windows server 2008。需要 SMTP 服务器将所有消息转发到 gmail smtp 服务器发送。
*   我为我的域设置了谷歌应用程序，我也可以使用
    gmail smtp 通过我的测试应用程序发送电子邮件。
*   SMTP 服务器配置：默认有默认的 smtp 服务器虚拟目录。
*   在该虚拟 smtp 服务器的属性中更改如下。

*   完全限定域名 = **mydomain.com**

*   智能主机 = **smtp.gmail.com**
*   TCP 端口 = **587**
*   出站安全 =**基本身份验证（我的谷歌应用程序电子邮件帐户的用户名密码）**
*   在虚拟 smtp 服务器下的域列表中。我有一个默认域，即服务器 dns。我为我的域名添加了另一个。

通过上述设置，我正在尝试将所有电子邮件重定向到 gmail smtp。我通过 telnet 测试了从 587 端口上的服务器到 smtp.gmail.com 的连接，它可以工作。

**我正在尝试从我的 Web 应用程序中使用上面的服务器，也只是将电子邮件放在拾取目录中。它被接收并接受请求表单网络应用程序，但从不发送电子邮件。**

**我可以看到它在队列文件夹中添加了这些电子邮件，但它永远留在那里。**

**当我尝试从网络应用程序向上述服务器发送电子邮件时，如果收件人地址不是我的域，它会拒绝。（我是否在域列表中遗漏了某些内容）**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-04T05:23:48.777

感谢所有答案，终于找到了解决方案，有一个最大会话属性，默认值为 0。将其更改为 100 并立即发送所有待处理的电子邮件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T21:08:08.587

这听起来像是一个 DNS 问题。检查您的 /badmail 目录。里面会有 .bad 和 .bdp 文件。您可以在记事本中打开它们（那里会有一些二进制文件）。

但是，它可能指向可能的问题。

您可能还想尝试在 SMTP 服务上启用日志记录。里面可能有东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-25T04:39:51.947

可能的原因是某些 SMTP 服务器会在域名不匹配的情况下阻止外发邮件，以防止垃圾邮件被发送。例如，我将无法从我的域 yourdomain.com 发送地址为 abc@mydomain.com 的电子邮件。

希望有帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-28T02:10:30.537

确保您的发送域与 Google Apps 域相同

确保您的发送地址是真实地址，而不仅仅是别名

IIRC 您需要使用 STARTTLS (SSL) 而不是基本身份验证

# iphone - 如何在 tableView viewForHeaderInSection 中使用 NIB 加载的 UIView 而不会影响性能

> ID：669759
> 
> 赞同：2
> 
> 时间：2009-03-21T18:46:20.213
> 
> 标签：iphone, uitableview

我正在实现 tableView viewForHeaderInSection，我返回一个 nib 加载的 UITableViewCell。

为了这个问题，我已经简化了它。

```
- (UIView *)tableView:(UITableView *)tableView viewForHeaderInSection:(NSInteger)section {
    UIView* header = [CellFactoryController newSectionHeader];
    header.text = "Some Text Depending on the section"
    return header;

} 
```

不幸的是，这非常慢，因为有时我有 50 多个标题，这些标题在表格绘​​制时都从 nib 一次全部加载，即使这些标题不在视图中。

有没有什么现实的方法可以让我克隆 UIViews 并在这个例子中克隆标题？或者是我创建标题 UIView 硬编码的唯一方法？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-02-01T02:28:48.057

前几天晚上我正在阅读关于[UINib 课程](http://developer.apple.com/library/ios/#documentation/uikit/reference/UINib_Ref/Reference/Reference.html)的文档，它正在谈论它如何缓存 nib 的内部结构，以便重复请求执行得更快。这可能是适合您的选择。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-01T02:32:54.723

好吧，我不知道你是否还需要这个问题的答案，但是……这到底是怎么回事。我们开工吧。我会做一些假设，但如果你遇到性能问题，真正解决这个问题的唯一方法是测试它，如果不了解你的视图的复杂性，我们就无法真正获得可靠的指标. 所以我会假设你已经尝试了一些东西，然后扔了一些你可能没有尝试过的东西。

当您从 nib 加载视图时，它会从文件中取消归档它。*如果*该加载发生 50 次，那可能会对您的性能问题大有帮助。那么我们还能做些什么呢？好吧，在您的表视图控制器类中，创建一个类型为 的新实例变量`NSData`。然后，在您的`-init`方法（或其他指定的初始化程序）中，从属性列表中加载视图：

```
- (id)init
{
    self = [super init];

    if (self) {
        // Other initialization code.

        NSString *filePath = [[NSBundle mainBundle] pathForResource:@"MyView"
                                                             ofType:@"plist"];
        myData = [[NSData alloc] initWithContentsOfFile:filePath];
    }

    return self;
} 
```

好的，所以您已将此属性列表加载到`NSData`. 现在，剩下的应该很清楚了：

```
- (UIView *)tableView:(UITableView *)tableView
viewForHeaderInSection:(NSInteger)section 
{
    UIView *view = [NSKeyedUnarchiver unarchiveObjectWithData:myData];

    return view;
} 
```

我的目标是始终将完全实例化的视图保留在内存中。但后来我想，“他将如何创建那个 plist？” 所以我稍微修改了一下。不要从文件中加载数据，而是在代码中创建视图：

```
- (UIView *)tableView:(UITableView *)tableView
viewForHeaderInSection:(NSInteger)section 
{
    UIView *headerView;

    if (myData == nil) {
        headerView = [[UIView alloc] init];
        // Configure your view, but only that part that isn’t customized.

        myData = [[NSKeyedArchiver archivedDataWithRootObject:headerView] copy];
    } else {
        headerView = [NSKeyedArchiver unarchiveObjectWithData:myData];
    }

    // Now customize the view for your particular section.

    return headerView;
} 
```

这应该为您提供在代码中创建视图的灵活性，但也希望将其保存在内存中并为您缓存。试试看！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-01T02:22:20.653

您可以将您的视图分解为单独的 .xib 文件以加快加载速度，但是（正如您所说）您最好的选择可能是按程序创建这些视图。在 quickie 示例代码之外，.xib 文件通常保留用于整个应用程序或全屏视图所需的非常高级的容器布局。布局和绘图面向细节的元素——例如表格视图中的单元格、页眉和页脚——通常在程序上处理得更好。

# html - 是否可以使用相同的底层 HTML 结构使用 CSS 创建这三种不同的布局？

> ID：669761
> 
> 赞同：2
> 
> 时间：2009-03-21T18:47:13.927
> 
> 标签：html, css

我必须在 HTML 中创建一个名称-值列表。（实际上它们是表单元素，`label`并且`input`）

如何构建此输出，以便网页设计师可以在不更改原始 HTML 结构的情况下创建以下三种不同的布局？

变体 1：

```
Name One:
Value One

Name Two:
Value Two 
```

变体 2：

```
Name One:         Value One
Longer Name Two:  Value Two 
```

变体 3：

```
 Name One:  Value One
Longer Name Two:  Value Two 
```

单独为变体 2 和 3 创建输出将是微不足道的，我只需使用表格并使用 CSS 更改对齐方式。

但是，当我想允许所有三个变体时，我该怎么做呢？CSS 代码会是什么样子？甚至可能吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-21T18:51:49.563

我会使用 DL 列表，例如：

```
<dl>
   <dt>Name One:</dt>
   <dd>Value One</dd>
   <dt>Name Two:</dt>
   <dd>Value Two</dd>
   <dt>Name Three:</dt>
   <dd>Value Three</dd>
</dl> 
```

和风格使用（大致）：

示例 1：

```
dl dt { }
dl dd { margin: 0px; padding: 0px; } 
```

示例 2：

```
dl dt { display: block; float: left; width: 150px; clear:left; }
dl dd { display: block; float: left; } 
```

示例 3：

```
dl dt {display: block; float: left; width: 150px; text-align: right; clear:left; }
dl dd {display: block; float: left; } 
```

...而且它是语义的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-21T19:02:17.353

[这是可能的，你可以在CSS Zen Garden](http://www.csszengarden.com/)找到很多很棒的例子（你可以复制！）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-21T19:19:26.720

HTML：

```
<div class="container">
   <label for="Name" class="label">Name:</label>
   <input id="Name" name="Name" />
</div>
<div class="container">
   <label for="LongName" class="label">Long Name:</label>
   <input id="LongName" name="LongName" />
</div> 
```

CSS1：

```
.container {}
.label
{
   display: block;
} 
```

CSS2：

```
.container
{
   margin-left: 12em;
}

.label
{
   float: left;
   margin-left: -12em;
} 
```

CSS3：

```
.container
{
    margin-left: 8em;
}

.label
{
    float: left;
    margin-left: -8em;
    width: 8em;
    text-align: right;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T19:25:11.963

每当我必须做这样的事情时，我发现的问题是列表的左侧（例如示例 2 和 3）是没有办法（或者至少我不知道）让两列都有可变宽度。

当要在第一列中显示的数据是可变的（即不是标签）或来自不同语言时，这尤其是一个问题。

如果这些都不是您的问题，那么使用 Program.X 中的 DL 的解决方案应该可以解决。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T20:00:07.387

[我构建了一个名为Formy](http://code.google.com/p/formy-css-framework/)的CSS 表单框架。包含所有 3 个变体，无需更改任何 HTML。

例子：

1.  [变体1](http://www.allapis.com/formy/vertical-form.html)
2.  [变体2](http://www.allapis.com/formy/horizontal-form.html)
3.  [变体 3](http://www.allapis.com/formy/horizontal-form1.html)

# .net - 如何使用 Android 使用 WCF 服务

> ID：669764
> 
> 赞同：79
> 
> 时间：2009-03-21T18:48:26.950
> 
> 标签：.net, android, wcf, rest

我正在.NET 中创建服务器和 Android 客户端应用程序。我想实现一种身份验证方法，将用户名和密码发送到服务器，服务器发回会话字符串。

我不熟悉 WCF，所以非常感谢您的帮助。

在java中，我编写了以下方法：

```
private void Login()
{
  HttpClient httpClient = new DefaultHttpClient();
  try
  {
      String url = "http://192.168.1.5:8000/Login?username=test&password=test";

    HttpGet method = new HttpGet( new URI(url) );
    HttpResponse response = httpClient.execute(method);
    if ( response != null )
    {
      Log.i( "login", "received " + getResponse(response.getEntity()) );
    }
    else
    {
      Log.i( "login", "got a null response" );
    }
  } catch (IOException e) {
    Log.e( "error", e.getMessage() );
  } catch (URISyntaxException e) {
    Log.e( "error", e.getMessage() );
  }
}

private String getResponse( HttpEntity entity )
{
  String response = "";

  try
  {
    int length = ( int ) entity.getContentLength();
    StringBuffer sb = new StringBuffer( length );
    InputStreamReader isr = new InputStreamReader( entity.getContent(), "UTF-8" );
    char buff[] = new char[length];
    int cnt;
    while ( ( cnt = isr.read( buff, 0, length - 1 ) ) > 0 )
    {
      sb.append( buff, 0, cnt );
    }

      response = sb.toString();
      isr.close();
  } catch ( IOException ioe ) {
    ioe.printStackTrace();
  }

  return response;
} 
```

但到目前为止，在服务器端我还没有想出任何东西。

如果有人能解释如何使用适当的 App.config 设置和具有适当 [OperationContract] 签名的接口创建适当的方法字符串登录（字符串用户名，字符串密码），以便从客户端读取这两个参数并回复，我将非常感激会话字符串。

谢谢！

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-03-24T02:05:31.203

要开始使用 WCF，最简单的方法可能是使用默认的 SOAP 格式和 HTTP POST（而不是 GET）来绑定 Web 服务。最简单的 HTTP 绑定是“basicHttpBinding”。以下是登录服务的 ServiceContract/OperationContract 的示例：

```
[ServiceContract(Namespace="http://mycompany.com/LoginService")]
public interface ILoginService
{
    [OperationContract]
    string Login(string username, string password);
} 
```

服务的实现可能如下所示：

```
public class LoginService : ILoginService
{
    public string Login(string username, string password)
    {
        // Do something with username, password to get/create sessionId
        // string sessionId = "12345678";
        string sessionId = OperationContext.Current.SessionId;

        return sessionId;
    }
} 
```

您可以使用 ServiceHost 将其托管为 Windows 服务，也可以将其托管在 IIS 中，就像普通的 ASP.NET Web（服务）应用程序一样。这两个都有很多教程。

WCF 服务配置可能如下所示：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>

    <system.serviceModel>
        <behaviors>
            <serviceBehaviors>
                <behavior name="LoginServiceBehavior">
                    <serviceMetadata />
                </behavior>
            </serviceBehaviors>
        </behaviors>

        <services>
            <service name="WcfTest.LoginService"
                     behaviorConfiguration="LoginServiceBehavior" >
                <host>
                    <baseAddresses>
                        <add baseAddress="http://somesite.com:55555/LoginService/" />
                    </baseAddresses>
                </host>
                <endpoint name="LoginService"
                          address=""
                          binding="basicHttpBinding"
                          contract="WcfTest.ILoginService" />

                <endpoint name="LoginServiceMex"
                          address="mex"
                          binding="mexHttpBinding"
                          contract="IMetadataExchange" />
            </service>
        </services>
    </system.serviceModel>
</configuration> 
```

（MEX 的内容对于生产来说是可选的，但在使用 WcfTestClient.exe 进行测试和公开服务元数据时需要）。

您必须修改 Java 代码以将 SOAP 消息发布到服务。WCF 在与非 WCF 客户端进行互操作时可能会有点挑剔，因此您必须稍微弄乱 POST 标头才能使其正常工作。一旦你开始运行它，你就可以开始调查登录的安全性（可能需要使用不同的绑定来获得更好的安全性），或者可能使用 WCF REST 来允许使用 GET 而不是 SOAP/POST 登录。

以下是 Java 代码中 HTTP POST 的示例。有一个名为“ [Fiddler](http://www.fiddler2.com/fiddler2/) ”的工具对于调试 Web 服务非常有用。

```
POST /LoginService HTTP/1.1
Content-Type: text/xml; charset=utf-8
SOAPAction: "http://mycompany.com/LoginService/ILoginService/Login"
Host: somesite.com:55555
Content-Length: 216
Expect: 100-continue
Connection: Keep-Alive

<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">
<s:Body>
<Login xmlns="http://mycompany.com/LoginService">
<username>Blah</username>
<password>Blah2</password>
</Login>
</s:Body>
</s:Envelope> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-24T02:10:19.320

另一种选择可能是完全避免 WCF，而只使用 .NET HttpHandler。HttpHandler 可以从您的 GET 中获取查询字符串变量，然后将响应写回 Java 代码。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-23T00:01:32.023

除非您的 WCF 服务具有 REST 接口，否则您将需要比 http 请求更多的东西来与 WCF 服务交互。要么寻找在 android 上运行的 SOAP Web 服务 API，要么让你的服务 RESTful。您将需要 .NET 3.5 SP1 来执行 WCF REST 服务：

[http://msdn.microsoft.com/en-us/netframework/dd547388.aspx](http://msdn.microsoft.com/en-us/netframework/dd547388.aspx)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-08-05T02:41:09.227

根据我最近的经验，我建议使用[ksoap](http://code.google.com/p/ksoap2-android/)库来使用 Soap WCF 服务，它实际上非常简单，这个 anddev[线程](http://www.anddev.org/webservice_soap_with_complex_data_type_and_ksoap_client-t2195.html)也可以帮助你。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-31T20:47:26.003

如果我这样做，我可能会在服务器上使用 WCF REST，在 Java/Android 客户端上 使用[REST 库。](https://stackoverflow.com/questions/221442/rest-clients-for-java)

# python - GetUserName() 返回的字符串编码

> ID：669770
> 
> 赞同：2
> 
> 时间：2009-03-21T18:51:08.393
> 
> 标签：python, winapi, encoding, pywin32

如何获取用于`GetUserName`从 win32 API 返回的字符串的编码？我正在使用 pywin32，它返回一个 8 位字符串。在我的德语 XP 上，这个字符串显然是使用 Latin-1 编码的，但其他 Windows 安装可能不是这种情况。

我可以使用`GetUserNameW`，但我必须自己使用 ctypes 来包装它，如果有更简单的解决方案，我现在想避免这种情况。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T19:09:41.547

您可以调用[GetACP](http://msdn.microsoft.com/en-us/library/dd318070(VS.85).aspx)来查找当前的 ANSI 代码页，这是非 Unicode API 使用的。您还可以使用[MultiByteToWideChar](http://msdn.microsoft.com/en-us/library/bb202786.aspx)并将零作为代码页传递（CP_ACP 在 Windows 标头中定义为零）以将代码页字符串转换为 Unicode。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-21T19:09:53.607

我意识到这并不能直接回答您的问题，但我*强烈*建议您解决使用 Unicode-clean 的麻烦，`GetUserNameW`如您所提到的。

非宽命令在不同的 Windows 版本上的工作方式不同（例如我，虽然我承认这个例子是旧的！），所以恕我直言，让它正确是值得的。

做了很多多语言的 Windows 开发，虽然宽 API 可以添加一层翻译或包装（正如你所建议的那样！），这是值得的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-22T13:05:37.203

好的，这就是我现在使用的：

```
>>> import win32api
>>> u = unicode(win32api.GetUserName(), "mbcs")
>>> type(u)
<type 'unicode'> 
```

`mbcs`是Windows中的一种特殊[标准编码：](http://docs.python.org/dev/2.5/lib/standard-encodings.html)

> 仅限 Windows：根据 ANSI 代码页 (CP_ACP) 对操作数进行编码

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T19:09:16.697

从 API 文档中，GetUserNameA 将以 ANSI 格式返回名称，而 GetUserNameW 将以 Unicode 格式返回名称。您将不得不使用 GetUserNameW。

# javascript - 自定义滚动条

> ID：669780
> 
> 赞同：2
> 
> 时间：2009-03-21T18:57:55.600
> 
> 标签：javascript, user-interface, air

我正在制作一个应用程序，`adobe air`并且我有一个使用溢出-y 的 div。为了让 UI 看起来漂亮和性感，用我自己的创建替换丑陋的[默认滚动条[链接断开] 的最佳方法是什么？](http://grabup.nakedsteve.com/a0fd084a9117dc8b1fe6626eda535d98.png)

谢谢

编辑：每个人都记得这是 on `adobe air`，而不是浏览器（我知道最好不要弄乱滚动条，这就是 web -4.2）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-21T19:16:17.817

不。

用户知道如何使用默认的平台 UI 小部件：他们知道它们的外观、行为方式等。而且平台的小部件工作得非常好。

他们不会知道如何使用您的小部件。即使您尝试复制除外观之外的平台，您的小部件也会表现得像廉价的仿冒品；它将缺少用户期望的功能：

*   您的滚动拇指是否会放大/缩小以显示文档的长度，并以最小尺寸使其始终可以抓取——但仅限于预期的平台上？
*   中键是否滚动到单击的位置，左键仅向下滚动，右键单击仅向上滚动，并且每个都与单击滚动条的位置成比例 - 在预期的平台上？
*   单击拇指和向上或向下箭头之间的空白区域是否有效？它是否按用户期望的数量滚动，这因平台而异？
*   按住滚动按钮时，滚动是否以用户期望的速度进行？
*   当鼠标移出滚动条时，用户如何拖动拇指？或在上述平台上单击鼠标中键。
*   您的自定义滚动条是否遵循用户选择的视觉主题，例如，因为他因残疾需要超高对比度和/或超大小部件？

大多数问题的答案可能是“不”。至少，这是我对设计师认为平台滚动条不够可爱的网站的经验。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T20:30:16.907

像对待任何其他 flex 组件一样给[它们蒙皮。](http://www.adobe.com/devnet/flex/quickstart/skinning_components/)为了使您的代码保持整洁，您可以通过 css 文件中的样式指定嵌入皮肤文件。

编辑： [关于如何给滚动条换肤的链接](http://www.gskinner.com/blog/archives/2008/05/designer_scroll.html)

# asp.net - aspnet_users：获取用户 id 并使用 id 网页

> ID：669781
> 
> 赞同：1
> 
> 时间：2009-03-21T18:59:25.550
> 
> 标签：asp.net

当我使用内置的 asp.net sql 表和登录控件创建用户时，我想获取用户 ID。我怎么做？谷歌正在返回一大堆信息，但我找不到一个简单的例子来获取用户 ID。

如果用户确实存在，那么我应该获得一个用户 ID，我可以将其存储在我自己的自定义表中，以便进一步管理用户个人信息。

整个会员资格和个人资料的事情让我很困惑。谷歌返回的结果中所有这些页面都有很长的解释，但这只会让我感到困惑。在一些愚蠢的例子中，我什至找不到命名空间。

你可以说我很沮丧。

请帮忙 ！！！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T19:14:46.340

这将为您提供当前登录用户的 MembershipUser

```
MembershipUser currentUser = Membership.GetUser(True) 
```

从中您将使用[ProviderUserKey](http://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.provideruserkey.aspx)属性来获取提供者特定的标识符。这是一个对象，因此，假设您需要将 SqlMembershipProvider 转换为 GUID。然后你可以在你的表中使用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T19:10:04.167

您正在寻找有关[Forms Authentication](http://www.google.com/search?q=Forms+Authentication)的信息。

您的具体问题的答案是通过[`HttpContext.Current.User`](http://msdn.microsoft.com/en-us/library/system.web.httpcontext.user.aspx)。该类`Page`有一个名为[`User`](http://msdn.microsoft.com/en-us/library/system.web.ui.page.user.aspx)which wraps的属性`HttpContext`。

```
If HttpContext.Current.User.Identity.IsAuthenticated Then
    Dim userName As String = HttpContext.Current.User.Identity.Name
    ' ... 
End If 
```

# ruby-on-rails - Rails 中的路由

> ID：669788
> 
> 赞同：0
> 
> 时间：2009-03-21T19:06:15.173
> 
> 标签：ruby-on-rails, ruby

我正在 RoR 中设计一个简约的 wiki。基本上一个项目有很多页面。我的路由文件如下所示：

```
map.root :controller => "projects"
map.resources :projects, :has_many => :pages
map.connect ':id', :controller => 'projects', :action => 'show'
map.connect ':project_id/:id', :controller => 'pages', :action => 'show'
map.connect ':controller/:action/:id'
map.connect ':controller/:action/:id.:format' 
```

例如，这允许我访问“教学”项目的“主”页面，如下所示：

```
http://localhost:3000/teaching/main 
```

但是，只要我单击一个链接，它就会变成这样：

```
http://localhost:3000/projects/teaching/pages/main 
```

如何使创建 URL 的辅助方法坚持我想要的方案？我尝试了命名路线，但我一定错过了一些东西，因为它没有用......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T19:26:54.657

我会放弃 map.connect 的东西——它不是很 RESTful，而且会让你很困惑。

乍一看，我以为您可以使用 :member 和 :collection 指令来添加您想要的内容，但当我仔细观察时，我意识到这无济于事。

我在理解您的数据模型时遇到了一点困难——一个页面可以有很多页？或者是教项目名称，然后它有页面？

如果是这种情况，那么您可能需要查看像 SubDomainFu 这样的插件并根据项目名称使用子域，而不是直接破解路由文件。我们已经成功地使用它来提供一个像你描述的方案（域意味着项目，需要一些额外的代码）以及诸如 Teaching.yourdomain.com 和 learning.yourdomain.com 之类的东西（如果你想使用它会很有趣SSL，但那是另一回事）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T19:46:57.853

Rails 是关于约定优于配置的。如果你想要 Rails 带来的便利，你必须接受这些约定。我强烈鼓励坚持使用 RESTful 模型并接受 rails 现在正在做的事情。

话虽如此，你可能可以一起破解一些东西。它不会很漂亮，每次你想创建一个链接时都会很痛苦。

所以首先摆脱

```
 map.resources :projects, :has_many => :pages
 map.connect ':controller/:action/:id'
 map.connect ':controller/:action/:id.:format' 
```

因为`map.resources`这是将您发送到您不想要的 url 的东西，而这两个`map.connect`'s 也对您没有帮助。所以现在你应该有

```
 map.connect ':project_id/:id', :controller => 'pages', :action => 'show'
 map.connect ':id', :controller => 'projects', :action => 'show' 
```

然后，当您想创建一个链接时，您将不得不自己创建它。你会想要使用这样的东西：

```
 <%= link_to 'Blah', :project_id => @project, :id => @project.pages.first %> 
```

或类似的东西。我不知道这是否正是如何指定路线，您可能必须更改 :project_id 和 :id 符号。

就像我说的，如果你不需要，你不想走这条路。尽可能地遵守约定，因为它会让你的生活更轻松。

# c# - 浏览器收集哪些值作为回发数据？

> ID：669797
> 
> 赞同：0
> 
> 时间：2009-03-21T19:13:36.250
> 
> 标签：c#, asp.net, ado.net

当页面被发送回服务器时，浏览器收集每个控件的当前值并将其粘贴到一个字符串中。然后，此回发数据通过 HTTP POST 发送回服务器。

Q1 - 除了控件的 Text 属性和 SelectedIndexchanged （因此除了用户输入数据之外），是否还有其他控件的属性/值被浏览器保存为回发数据？

Q2 - 对于 GridView，浏览器在回发时保存了哪些值？只有那些用户选择编辑的行？

字节

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-21T19:47:43.610

`textarea`、`select`和字段的值在帖子中`input`返回。`button`每个值都是一个键值对，其中键是`name`元素的属性。

我认为我已经获得了帖子中包含数据的所有元素：

*   `textarea`:`value`包括属性，即在文本区域中输入的内容。

*   `select`：`value`包含所选选项的属性。如果所选选项没有`value`指定属性，则使用选项的文本。

*   `input type="text"`:`value`包括属性，即输入字段中输入的内容。

*   `input type="password"`:`value`包括属性，即输入字段中输入的内容。

*   `input type="submit"`：如果按钮用于发送表单，`value`则包含属性，即按钮的文本。

*   `input type="image"`：如果使用按钮发送表单，则鼠标在图像内单击的坐标在帖子中发送。x 和 y 坐标的名称是通过在元素名称中添加“.x”和“.y”来创建的。

*   `input type="checkbox"`：如果选中该复选框，`value`则包含该属性。如果元素没有`value`指定属性，则使用值“on”。

*   `input type="radio"`：`value`属性包含在每个组的选定项目中。（组是所有具有相同名称的单选按钮。）

*   `input type="file"`：包含所选文件的内容以及原始文件路径（或仅文件名，取决于浏览器和安全设置）。

*   `input type="hidden"`:`value`财产包括在内。

*   `button`：如果按钮用于发送表单，`innerText`则包含该属性，即删除了任何 html 标记的按钮文本。

根据属性，`TextBox`控件呈现为 a `input type="text"`、 an`input type="password"`或 a 。控件呈现为元素。控件呈现为. 控件呈现为. 等等...检查渲染的 html 代码以查看实际渲染的 html 元素是什么。`textarea``TextMode``DropDownList``select``Button``input type="submit"``CheckBox``input type="checkbox"`

如果 GridView 包含任何可编辑的表单字段，或者如果它导致回发（例如通过在列表中导航），则 GridView 仅包含帖子中的任何数据。在进行回发时，一些信息存储在一对隐藏字段中，因此任何导致回发但自身不发送任何表单数据的控件（例如 LinkBut​​ton）都包含有关导致回发的原因的信息。

Controls may also put data in the ViewState, which is kept in a hidden field in the form. This is also included in the post, but it's just sent to the browser and back again without being changed by the browser.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T19:28:20.287

我不是 asp 程序员，所以我不能给出确切的答案，但我建议你将 firefox 与插件 Live Http Headers 和 Firebug（控制台部分）一起使用。

通过此设置，您将能够看到浏览器发送到您的服务器的确切数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T19:32:54.503

您可能还想使用 ViewState 解码器。您可以在浏览器扩展中获取它们，并在网络上使用它们。Scott Gu 在这里推荐一个：[http](http://weblogs.asp.net/scottgu/archive/2003/02/16/2495.aspx) ://weblogs.asp.net/scottgu/archive/2003/02/16/2495.aspx 。ViewState 应该告诉你所有你需要知道的持久化服务器属性。

# asp.net-mvc - 存储库之间的调用方法 - 存储库模式

> ID：669799
> 
> 赞同：7
> 
> 时间：2009-03-21T19:14:01.443
> 
> 标签：asp.net-mvc, repository-pattern

我在 ASP.NET MVC 应用程序中使用存储库模式（如[https://dotnet.microsoft.com/apps/aspnet/mvc](https://dotnet.microsoft.com/apps/aspnet/mvc)站点中的示例）。我有两个存储库，一个称为 CategoryRepository，另一个称为 ProductRepository。我还使用了两个服务，即 CategoryService 和 ProductService 来验证和调用存储库方法。我需要 ProductService 中的类别列表，返回一个的方法已经在 CategoryRepository 中实现。我的问题是，从 ProductService 调用 CategoryRepository 中存在的 ListCategories 方法的正确方法是什么？我不想在 ProductRepository 中实现另一个 ListCategories 方法（DRY 哲学）。谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-22T14:37:30.100

我建议将类似的存储库整合到一项服务中。因此，如果您正在创建一个电子商务应用程序，请将 ProductRepository、CategoryRepository 等汇总到 CatalogService 之类的东西中，并让它托管所有相关的存储库。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T06:33:11.700

一种选择是为 ProductService 类提供 CategoryService 的实例。

```
public class ProductService {
    ICategoryService _categoryService = null;

    public ProductService(ICategoryService categoryService) {
        _categoryService = categoryService;
    }
} 
```

然后，您可以从 ProductService 访问类别列表，而无需建立与任何特定 CategoryService 实现的直接耦合。

# mysql - 如何从mysql中的得分表中获取每场比赛的3个第一名？

> ID：669803
> 
> 赞同：1
> 
> 时间：2009-03-21T19:17:40.060
> 
> 标签：mysql, sql, greatest-n-per-group

我有下表：

```
CREATE TABLE `score` (  
    `score_id` int(10) unsigned NOT NULL auto_increment,  
    `user_id` int(10) unsigned NOT NULL,  
    `game_id` int(10) unsigned NOT NULL,  
    `thescore` bigint(20) unsigned NOT NULL,  
    `timestamp` timestamp NOT NULL default CURRENT_TIMESTAMP,  
    PRIMARY KEY  (`score_id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8; 
```

这是一个分数表，存储了每个游戏的 user_id 和 game_id 和分数。每场比赛的前3名都有奖杯。我有一个 user_id，我想检查该特定用户是否从任何游戏中获得任何奖杯。

我可以在不创建临时表的情况下以某种方式创建此查询吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-21T19:24:39.797

```
SELECT game_id, user_id
FROM score score1  
WHERE (SELECT COUNT(*) FROM score score2  
       WHERE score1.game_id = score2.game_id AND score2.thescore > score1.thescore) < 3   
ORDER BY game_id ASC, thescore DESC; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T19:39:00.557

一种更清晰的方法，并且经过半测试。

> ```
> SELECT DISTINCT user_id
> FROM
> (
>     select s.user_id, s.game_id, s.thescore,
>     (SELECT count(1)
>     from scores
>     where game_id = s.game_id
>         AND thescore > s.thescore  
>     ) AS acount FROM scores s
> ) AS a 
> ```
> 
> 其中帐户 < 3

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T20:46:27.057

```
SELECT s1.*
FROM score s1 LEFT OUTER JOIN score s2 
 ON (s1.game_id = s2.game_id AND s1.thescore < s2.thescore)
GROUP BY s1.score_id
HAVING COUNT(*) < 3; 
```

此查询返回所有获胜游戏的行。虽然包括领带；如果分数是 10、16、16、16、18，则有四个获胜者：16、16、16、18。我不确定你是如何处理的。您需要一些方法来解决连接条件中的关系。

例如，如果平局是由较早的游戏获胜解决的，那么您可以这样修改查询：

```
SELECT s1.*
FROM score s1 LEFT OUTER JOIN score s2 
 ON (s1.game_id = s2.game_id AND (s1.thescore < s2.thescore
     OR s1.thescore = s2.thescore AND s1.score_id < s2.score_id))
GROUP BY s1.score_id
HAVING COUNT(*) < 3; 
```

`timestamp`如果您可以依赖它，您也可以使用该列来解决关系`UNIQUE`。

然而，无论如何，MySQL 倾向于为这种查询创建一个临时表。`EXPLAIN`这是此查询的输出：

```
+----+-------------+-------+------+---------------+------+---------+------+------+---------------------------------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra                           |
+----+-------------+-------+------+---------------+------+---------+------+------+---------------------------------+
|  1 | SIMPLE      | s1    | ALL  | NULL          | NULL | NULL    | NULL |    9 | Using temporary; Using filesort | 
|  1 | SIMPLE      | s2    | ALL  | PRIMARY       | NULL | NULL    | NULL |    9 |                                 | 
+----+-------------+-------+------+---------------+------+---------+------+------+---------------------------------+ 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T19:32:29.107

没有测试它，但应该可以正常工作：

```
SELECT
  *,
  @position := @position + 1 AS position
FROM
  score
  JOIN (SELECT @position := 0) p
WHERE
  user_id = <INSERT_USER_ID>
  AND game_id = <INSERT_GAME_ID>
ORDER BY
  the_score 
```

在那里您可以检查*位置*字段以查看它是否在 1 和 3 之间。

# c++ - 虚拟赋值运算符 C++

> ID：669818
> 
> 赞同：74
> 
> 时间：2009-03-21T19:28:00.037
> 
> 标签：c++, operator-overloading, virtual, virtual-functions

C++ 中的赋值运算符可以是虚拟的。为什么需要它？我们可以让其他运营商也虚拟化吗？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-03-21T20:05:59.430

不需要将赋值运算符设为虚拟。

下面的讨论是关于 的`operator=`，但它也适用于接受相关类型的任何运算符重载，以及接受相关类型的任何函数。

下面的讨论表明，在查找匹配的函数签名方面，virtual 关键字不知道参数的继承。在最后一个示例中，它展示了在处理继承类型时如何正确处理赋值。

* * *

**虚函数不知道参数的继承：**

函数的签名必须相同才能使 virtual 发挥作用。因此，即使在下面的示例中，operator= 被设置为 virtual，调用也不会在 D 中充当虚拟函数，因为 operator= 的参数和返回值是不同的。

功能`B::operator=(const B& right)`和`D::operator=(const D& right)`100% 完全不同，被视为 2 个不同的功能。

```
class B
{
public:
  virtual B& operator=(const B& right)
  {
    x = right.x;
    return *this;
  }

  int x;

};

class D : public B
{
public:
  virtual D& operator=(const D& right)
  {
    x = right.x;
    y = right.y;
    return *this;
  }
  int y;
}; 
```

* * *

**默认值并具有 2 个重载运算符：**

您可以定义一个虚函数，以允许您在将 D 分配给 B 类型的变量时为其设置默认值。即使您的 B 变量实际上是存储在 B 的引用中的 D，您也不会得到`D::operator=(const D& right)`功能。

在以下情况下，来自存储在 2 B 引用中的 2 D 对象的分配......`D::operator=(const B& right)`使用了覆盖。

```
//Use same B as above

class D : public B
{
public:
  virtual D& operator=(const D& right)
  {
    x = right.x;
    y = right.y;
    return *this;
  }

  virtual B& operator=(const B& right)
  {
    x = right.x;
    y = 13;//Default value
    return *this;
  }

  int y;
};

int main(int argc, char **argv) 
{
  D d1;
  B &b1 = d1;
  d1.x = 99;
  d1.y = 100;
  printf("d1.x d1.y %i %i\n", d1.x, d1.y);

  D d2;
  B &b2 = d2;
  b2 = b1;
  printf("d2.x d2.y %i %i\n", d2.x, d2.y);
  return 0;
} 
```

印刷：

```
d1.x d1.y 99 100
d2.x d2.y 99 13 
```

这表明`D::operator=(const D& right)`从未使用过。

如果没有 virtual 关键字，`B::operator=(const B& right)`您将获得与上面相同的结果，但不会初始化 y 的值。即它将使用`B::operator=(const B& right)`

* * *

**最后一步，RTTI：**

您可以使用 RTTI 正确处理接受您的类型的虚函数。这是解决在处理可能继承的类型时如何正确处理赋值的最后一块难题。

```
virtual B& operator=(const B& right)
{
  const D *pD = dynamic_cast<const D*>(&right);
  if(pD)
  {
    x = pD->x;
    y = pD->y;
  }
  else
  {
    x = right.x;
    y = 13;//default value
  }

  return *this;
} 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-21T19:34:45.653

这取决于运营商。

将赋值运算符设为虚拟的目的是让您从能够覆盖它以复制更多字段的好处中受益。

因此，如果您有 Base& 并且实际上将 Derived& 作为动态类型，并且 Derived 具有更多字段，则复制正确的内容。

但是，您的 LHS 是 Derived 的风险，而 RHS 是 Base 的风险，因此当虚拟运算符在 Derived 中运行时，您的参数不是 Derived 并且您无法从中获取字段。

这是一个很好的讨论：http: [//icu-project.org/docs/papers/cpp_report/the_assignment_operator_revisited.html](http://icu-project.org/docs/papers/cpp_report/the_assignment_operator_revisited.html)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-09-04T14:07:30.490

> ## [Brian R. Bondy](https://stackoverflow.com/users/3153/brian-r-bondy) wrote:
> 
> * * *
> 
> **One last step to tie it all together, RTTI:**
> 
> You can use RTTI to properly handle virtual functions that take in your type. Here is the last piece of the puzzle to figure out how to properly handle assignment when dealing with possibly inherited types.
> 
> ```
> virtual B& operator=(const B& right)
> {
>   const D *pD = dynamic_cast<const D*>(&right);
>   if(pD)
>   {
>     x = pD->x;
>     y = pD->y;
>   }
>   else
>   {
>     x = right.x;
>     y = 13;//default value
>   }
> 
>   return *this;
> } 
> ```

I would like to add to this solution a few remarks. Having the assignment operator declared the same as above has three issues.

The compiler generates an assignment operator that takes a **const D&** argument which is not virtual and does not do what you may think it does.

Second issue is the return type, you are returning a base reference to a derived instance. Probably not much of an issue as the code works anyway. Still it is better to return references accordingly.

Third issue, derived type assignment operator does not call base class assignment operator (what if there are private fields that you would like to copy?), declaring the assignment operator as virtual will not make the compiler generate one for you. This is rather a side effect of not having at least two overloads of the assignment operator to get the wanted result.

Considering the base class (same as the one from the post I quoted):

```
class B
{
public:
    virtual B& operator=(const B& right)
    {
        x = right.x;
        return *this;
    }

    int x;
}; 
```

The following code completes the RTTI solution that I quoted:

```
class D : public B{
public:
    // The virtual keyword is optional here because this
    // method has already been declared virtual in B class
    /* virtual */ const D& operator =(const B& b){
        // Copy fields for base class
        B::operator =(b);
        try{
            const D& d = dynamic_cast<const D&>(b);
            // Copy D fields
            y = d.y;
        }
        catch (std::bad_cast){
            // Set default values or do nothing
        }
        return *this;
    }

    // Overload the assignment operator
    // It is required to have the virtual keyword because
    // you are defining a new method. Even if other methods
    // with the same name are declared virtual it doesn't
    // make this one virtual.
    virtual const D& operator =(const D& d){
        // Copy fields from B
        B::operator =(d);
        // Copy D fields
        y = d.y;
        return *this;
    }

    int y;
}; 
```

This may seem a complete solution, it's not. This is not a complete solution because when you derive from D you will need 1 operator = that takes **const B&**, 1 operator = that takes **const D&** and one operator that takes **const D2&**. The conclusion is obvious, the number of operator =() overloads is equivalent with the number of super classes + 1.

Considering that D2 inherits D, let's take a look at how the two inherited operator =() methods look like.

```
class D2 : public D{
    /* virtual */ const D2& operator =(const B& b){
        D::operator =(b); // Maybe it's a D instance referenced by a B reference.
        try{
            const D2& d2 = dynamic_cast<const D2&>(b);
            // Copy D2 stuff
        }
        catch (std::bad_cast){
            // Set defaults or do nothing
        }
        return *this;
    }

    /* virtual */ const D2& operator =(const D& d){
        D::operator =(d);
        try{
            const D2& d2 = dynamic_cast<const D2&>(d);
            // Copy D2 stuff
        }
        catch (std::bad_cast){
            // Set defaults or do nothing
        }
        return *this;
    }
}; 
```

It is obvious that the **operator =(const D2&)** just copies fields, imagine as if it was there. We can notice a pattern in the inherited operator =() overloads. Sadly we cannot define virtual template methods that will take care of this pattern, we need to copy and paste multiple times the same code in order to get a full polymorphic assignment operator, the only solution I see. Also applies to other binary operators.

* * *

## Edit

As mentioned in the comments, the least that can be done to make life easier is to define the top-most superclass assignment operator =(), and call it from all other superclass operator =() methods. Also when copying fields a _copy method can be defined.

```
class B{
public:
    // _copy() not required for base class
    virtual const B& operator =(const B& b){
        x = b.x;
        return *this;
    }

    int x;
};

// Copy method usage
class D1 : public B{
private:
    void _copy(const D1& d1){
        y = d1.y;
    }

public:
    /* virtual */ const D1& operator =(const B& b){
        B::operator =(b);
        try{
            _copy(dynamic_cast<const D1&>(b));
        }
        catch (std::bad_cast){
            // Set defaults or do nothing.
        }
        return *this;
    }

    virtual const D1& operator =(const D1& d1){
        B::operator =(d1);
        _copy(d1);
        return *this;
    }

    int y;
};

class D2 : public D1{
private:
    void _copy(const D2& d2){
        z = d2.z;
    }

public:
    // Top-most superclass operator = definition
    /* virtual */ const D2& operator =(const B& b){
        D1::operator =(b);
        try{
            _copy(dynamic_cast<const D2&>(b));
        }
        catch (std::bad_cast){
            // Set defaults or do nothing
        }
        return *this;
    }

    // Same body for other superclass arguments
    /* virtual */ const D2& operator =(const D1& d1){
        // Conversion to superclass reference
        // should not throw exception.
        // Call base operator() overload.
        return D2::operator =(dynamic_cast<const B&>(d1));
    }

    // The current class operator =()
    virtual const D2& operator =(const D2& d2){
        D1::operator =(d2);
        _copy(d2);
        return *this;
    }

    int z;
}; 
```

There is no need for a *set defaults* method because it would receive only one call (in the base operator =() overload). Changes when copying fields are done in one place and all operator =() overloads are affected and carry their intended purpose.

Thanks [sehe](https://stackoverflow.com/users/85371/sehe) for the suggestion.

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-11-13T10:11:02.327

**虚拟分配用于以下场景：**

```
//code snippet
Class Base;
Class Child :public Base;

Child obj1 , obj2;
Base *ptr1 , *ptr2;

ptr1= &obj1;
ptr2= &obj2 ;

//Virtual Function prototypes:
Base& operator=(const Base& obj);
Child& operator=(const Child& obj); 
```

> **案例1：obj1 = obj2；**

`operator=`在这个虚拟概念中，我们在`Child`课堂上调用的任何角色都没有。

> **案例 2&3: *ptr1 = obj2;**
>                   ***ptr1 = *ptr2;**

这里的分配不会像预期的那样。原因是在课堂`operator=`上被调用。`Base`

可以使用以下任一方法进行纠正：
1）铸造

```
dynamic_cast<Child&>(*ptr1) = obj2;   // *(dynamic_cast<Child*>(ptr1))=obj2;`
dynamic_cast<Child&>(*ptr1) = dynamic_cast<Child&>(*ptr2)` 
```

2) 虚拟概念

现在通过简单地使用`virtual Base& operator=(const Base& obj)`将无济于事，因为签名在`Child`和`Base`for中是不同的`operator=`。

我们需要添加`Base& operator=(const Base& obj)`Child 类及其通常的`Child& operator=(const Child& obj)`定义。包含以后的定义很重要，因为在没有默认赋值运算符的情况下将被调用。（`obj1=obj2`可能不会给出想要的结果）

```
Base& operator=(const Base& obj)
{
    return operator=(dynamic_cast<Child&>(const_cast<Base&>(obj)));
} 
```

> **案例 4：obj1 = *ptr2；**

在这种情况下，编译器在 Child上调用时查找`operator=(Base& obj)`定义。但是由于它不存在并且类型不能被隐式提升，它将通过错误。（需要强制转换，如）`Child``operator=``Base``child``obj1=dynamic_cast<Child&>(*ptr1);`

如果我们按照case2&3来实现，这个场景就会被处理。

**可以看出，在使用基类指针/引用进行赋值的情况下，虚拟赋值使调用更加优雅。**

> 我们可以让其他运营商也虚拟化吗？ **是的**

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-21T19:31:17.970

仅当您要保证从您的类派生的类正确复制其所有成员时才需要它。如果你没有对多态性做任何事情，那么你真的不需要担心这个。

我不知道有什么会阻止您虚拟化您想要的任何运算符——它们只不过是特殊情况的方法调用。

[此页面](http://www.icu-project.org/docs/papers/cpp_report/the_assignment_operator_revisited.html)对所有这些工作原理进行了出色而详细的描述。

# asp.net - 如何使用 asp.net 生成 HTML 电子邮件内容

> ID：669824
> 
> 赞同：1
> 
> 时间：2009-03-21T19:30:47.813
> 
> 标签：asp.net

我想以 HTML 格式发送电子邮件。如何使用 asp.net 为电子邮件生成 HTML 内容。

1.  使用 .aspx 页面的输出（尝试在电子邮件正文中没有任何内容。必须是页面中不能用于电子邮件的内容）
2.  使用 Webcontrol 并获取 Web 控件输出并将其用作电子邮件正文。
3.  使用自定义 http 处理程序，因此可以调用处理程序来获取电子邮件正文。

你能建议什么是最好的解决方案吗？

如果知道的话，一些指南或示例参考会很棒。

感谢所有答案：

我在下面实现代码：

```
 string lcUrl = "http://localhost:50771/webform1.aspx";

        // *** Establish the request
        HttpWebRequest loHttp =
             (HttpWebRequest)WebRequest.Create(lcUrl);

        // *** Set properties
        //loHttp.Timeout = 10000;     // 10 secs
        loHttp.UserAgent = "Code Web Client";

        // *** Retrieve request info headers
        HttpWebResponse loWebResponse = (HttpWebResponse)loHttp.GetResponse();

        Encoding enc;
        try
        {
            enc = Encoding.GetEncoding(loWebResponse.ContentEncoding);
        }
        catch
        {
            enc = Encoding.GetEncoding(1252);
        }

        StreamReader loResponseStream =
           new StreamReader(loWebResponse.GetResponseStream(), enc);

        string lcHtml = loResponseStream.ReadToEnd();

        loWebResponse.Close();
        loResponseStream.Close(); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T19:37:46.020

我认为 ASPX 文件将成为最容易编辑的机制。您可以使用

```
var stream = new MemoryStream();
var textWriter = new StreamWriter(stream);
Server.Execute("EmailGenerator.aspx", textWriter); 
```

捕获该页面的输出。

我个人不喜欢你的任何选择。我可能会通过使用 HTML 文件（或存储在数据库中的模板）并`{{name}}`用适当的参数替换类似的东西来做到这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T19:46:32.393

我这样做了，基本上我们有一个用户可以查看的页面，然后他们可以单击一个按钮并通过电子邮件发送页面上的 html。基本上我的页面负责生成电子邮件。我通过重写 Render 方法并提供我自己的流或使用传递给我们的流来做到这一点。如果我们渲染用户将看到的内容或通过电子邮件发送，我们会这样做。

```
 protected override void Render(HtmlTextWriter writer)
    {

        if (_altPrintMethod)
        {
            System.Net.Mail.MailMessage....

            mailMsg.Body=RenderHtml(baseUrl);

        }
     }
        protected virtual string RenderHtml(string baseUrl)
        {
            RemapImageUrl(baseUrl);

            StreamWriter sw = new StreamWriter(new MemoryStream());
            HtmlTextWriter writer = new HtmlTextWriter(sw);
            base.Render(writer);
            writer.Flush();
            StreamReader sr = new StreamReader(sw.BaseStream);
            sr.BaseStream.Position = 0;
            return sr.ReadToEnd();

        } 
```

需要注意的一件事是您必须确保所有链接都是完全合格的。您也许可以使用基本功能。这就是我在 RemapImageUrl 中所做的，基本上我在所有图像文件上附加了一个绝对路径。

# java - How to have 2 collections of the same type in JPA?

> ID：669828
> 
> 赞同：15
> 
> 时间：2009-03-21T19:31:30.653
> 
> 标签：java, hibernate, jpa, collections, persistence

I've got 2 entities in JPA: Entry and Comment. Entry contains two collections of Comment objects.

```
@Entity
public class Entry {
    ...

    @OneToMany(fetch = FetchType.EAGER, cascade = CascadeType.ALL)
    @IndexColumn(base = 1, name = "dnr")
    private List<Comment> descriptionComments = new ArrayList<Comment>();

    @OneToMany(fetch = FetchType.EAGER, cascade = CascadeType.ALL)
    @IndexColumn(base = 1, name = "pmnr")
    private List<Comment> postMortemComments = new ArrayList<Comment>();

    ...
} 
```

To store such objects, JPA+Hibernate creates "Entry" table, "Comment" table and SINGLE "Entry_Comment":

`create table Entry_Comment (Entry_id integer not null, postMortemComments_id integer not null, pmnr integer not null, descriptionComments_id integer not null, dnr integer not null, primary key (Entry_id, dnr), unique (descriptionComments_id), unique (postMortemComments_id))`

Storing of objects fail as `descriptionComments_id` and `postMortemComments_id` cannot be "not null" at the same time.

How do I store object containing two collections of the same type using JPA+Hibernate?

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-07-03T09:51:24.617

This is one of the many Hibernate bugs ([HHH-3410](http://opensource.atlassian.com/projects/hibernate/browse/HHH-3410) to be precise).

I've managed to fix it by adding `@JoinTable` annotations to `@OneToMany` relationships, each having its own table name.

In your case it would look like this:

```
@OneToMany(fetch = FetchType.EAGER, cascade = CascadeType.ALL)
@JoinTable(name="entity_descriptioncomments")
@IndexColumn(base = 1, name = "dnr")
private List<Comment> descriptionComments = new ArrayList<Comment>();

@OneToMany(fetch = FetchType.EAGER, cascade = CascadeType.ALL)
@JoinTable(name="entity_postmortemcomments")
@IndexColumn(base = 1, name = "pmnr")
private List<Comment> postMortemComments = new ArrayList<Comment>(); 
```

**Note**: you must add `@IndexColumn` annotation as well (because of the other Hibernate issue with multiple EAGER bags: [HHH-1718](https://hibernate.onjira.com/browse/HHH-1718)/[EJB-346](https://hibernate.onjira.com/browse/EJB-346)).

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-22T17:35:01.797

To store 2 collections like that in JPA with *DataNucleus* ([http://www.datanucleus.org](http://www.datanucleus.org)) you would do exactly as you've done. You have no `@JoinTable` annotation hence a FK should be placed in `Comment` for each of the collections. If you actually do have `@JoinTable` somewhere (or XML equivalent) then setting the names of the respective join tables (one for each collection) would work too (so they have their own join table). Having a shared join table between 2 collections is possible in DataNucleus too, but that's not standard JPA, instead a vendor extension.

How that maps to Hibernate I've no idea, but then this is JPA so should be consistent since thats the point of having a spec ;-)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-22T17:46:22.893

There is a flaw with current mapping from data model/domain model point of view: you actaully have a **single** *@OneToMany* relationship between *Entry* and *Comment*. And *Comment* entity should have one more attribute called *type* that takes 2 values: '*description*' or '*postMortem*'.

To be inline with your current implementation of *Entry* entity you may want to consider breaking down *Comment* entity into 2 different entities (possibly using JPA inheritance features) and using *@JoinTable* annotation in *Entry*.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-23T02:45:01.943

If all you care about is ordering, how about configuring the two index column definitions to have the same name?

# iphone - 通过应用程序引用图像的最佳方式？

> ID：669833
> 
> 赞同：1
> 
> 时间：2009-03-21T19:34:08.337
> 
> 标签：iphone, cocoa-touch, sqlite, uiwebview

我的应用程序是数据库驱动的。每行包含我在 UIWebView 中显示的主要内容列。大多数行（内容列）都有对 image1 的引用和一些对 image2 的引用。我将这些转换为 base64 并将图像字符串添加到行中。但是，如果任一图像发生更改，则意味着我必须返回所有行并更新 base64 字符串。

我可以在行内容中提供一个唯一的字符串，例如 {image1}。这意味着我必须搜索该行的整个内容并替换为图像的 base64 版本。这些图像也始终位于行内容的底部。不确定如何在替换之前先浏览所有内容会影响性能。有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-14T05:02:31.590

我希望我能正确理解你的问题。

如果图像不是很大，那么使用 like 关键字可能是可以的，如下所示：

```
sqlite3_stmt *statement = nil;
if(statement == nil)
{
    const char *sql = [[NSString stringWithFormat:@"SELECT imageContent FROM imageDatabase WHERE imageContent LIKE '%@%@%@'", @"%", imageValue, @"%"] UTF8String];
    if (sqlite3_prepare_v2(db, sql, -1, &statement, NULL) != SQLITE_OK) {
        //NSAssert1(0, @"Error: failed to prepare statement with message '%s'.", sqlite3_errmsg(db));
        return;
    }
}
while (sqlite3_step(statement) == SQLITE_ROW) {
    // query was successful
    // perform some action on the resulting data
}
sqlite3_finalize(statement);
statement = nil; 
```

如果您设置 imageValue = image1、image2 或其他任何值，这将为您提供您正在从数据库中查找的项目，而无需在代码中进行字符串操作。我假设你知道 SQL，如果这是多余的信息，很抱歉，但上面将搜索你的 imageDatabase 以查找包含 image1、image2 imageValue 的任何内容。找到该行后，您可以更新它，或者您可以将 WHERE 子句与 UPDATE SQL 语句一起使用，但我发现这有点危险，因为可能会在不先检查内容以确保不经意地更新多行的情况下这就是你想要的。

此外，如果您正在使用它进行数据库更新，您会发现通过使用以下事务包装插入和更新可以显着提高性能：

```
const char *sql = "BEGIN TRANSACTION;";
    char *errMsg;
    sqlite3_exec(db, sql, nil, 0, &errMsg);

const char *commit = "COMMIT;";
    sqlite3_exec(db, commit, nil, 0, &errMsg); 
```

它在执行之前准备和优化您的查询。我已经看到插入和更新查询的速度是事务的两倍。

如果数据库非常大，这将对性能产生重大影响，但是在内存中进行字符串操作会产生很大的内存成本。如果您使用 SQLite LIKE 方法，则字符串搜索以串行方式在磁盘上完成，并且内存命中较少。

找到特定项目后，您可以对特定字符串进行正则表达式搜索和替换，从而使代码的内存占用更小。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T19:37:10.983

为什么不在表中使用 image_ID（唯一整数）和 image_data（blob）中的图像？然后在您的主表中，仅存储 image_ID，如果您需要实际图像，请进行连接？

关于您的问题的另一种解释（如果该答案对您没有意义），为什么不将内容分为三个字段：图像之前的内容、图像和之后的内容。存储中间部分的 image_ID（不是数据——通过图像表上的 sql JOIN 获取）。然后通过连接构建最终内容。

# soa - Why would you make your product SOA compatible?

> ID：669837
> 
> 赞同：2
> 
> 时间：2009-03-21T19:36:04.527
> 
> 标签：soa

You have a good software product, so why would you make it SOA compatible?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T19:46:44.920

You may want to do this to provide a looser coupling between your data services and your application layer. This will give more flexibility to reuse the service components for other products and allow you to change the underlying service architecture if need be without the need for your application to even know about the change.

Having said all that, I would first want to have an actual business use case that warrants making the switch before making the change. Changing simply to keep up with the latest buzzwords is just a waste of money. If you're starting a new project, however, you may want to consider a service-based architecture if it makes sense for your application.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T19:52:56.933

If you want your product to be integratable with other applications and your customers have actually voiced this wish / requirement then I would consider it, but otherwise it might be a big waste of time and money, especially if doing it might cause some lengthly architectural refactoring to make it work. But with no clear reason, it probably doesn't make sense to follow a trend just because others maybe doing it. Your customers will let you know when this is necessary.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T20:23:17.843

In my opinion, only one good reason: you need *interoperability* between different platforms or technologies. Otherwise, save yourself a lot of grief and "just" make a well-mudlarized architecture - tell your boss it is SOA if that's what he wants to hear. Don't do it because you might move to or use other platforms in the future - you don't have an interoperability problem yet.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T19:48:27.477

That's a very difficult question to answer without more detail about your "good software product", but speaking in sweeping generalities:

*   If you implement an SOA scheme on your product, more developers will be able to consume the API services provided by your product because web services work across almost any development platform.
*   If your product is already a web application that publishes certain data, you might discover that you have readers/consumers of your data that are interested in doing analysis or building additional applications that you never thought of or may not ever have the available time to build.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-22T17:47:47.383

The fact is: you don't need to.

SOA structure is very complicated to achieve. It requires care and organization style that I believe most companies will not have. (I'm glad if yours has such organization).

Tomas Erls talks about Contemporary SOA and Web Service First Generation. WS-I is the traditional web service style such as asp.net web services. Actually this traditional web services doesn't mean any service oriented; And what happens is people build simple web services and call them SOA.

Contemporary SOA, I believe, is an entire system structured based on services. Inside this "ecosystem", services would call each other to perform some tasks.

SOA analysis is painful and you need care. To build an ecosystem like that, you need to be prepared from the first moment.

Engineering service interfaces (contracts) is also paradigm. If you put some Lean Thinking at your belt, you should cut some desire to make state-of-art design. If your system already works, fine! If someone will need integration in possible future which you don't know yet about it, don't do it now. But if your system is born to be consumed, them you think about it.

Best

# wpf - Silverlight Toolkit：为什么我不能更改 Chart.Series 上的 ItemsSource？

> ID：669839
> 
> 赞同：2
> 
> 时间：2009-03-21T19:37:00.140
> 
> 标签：wpf, silverlight, silverlight-3.0, charts, wpftoolkit

我开始尝试`System.Windows.Controls.DataVisualization.Charting`（来自[Silverlight 3 Toolkit](http://www.codeplex.com/Silverlight)）中的新图表控件

我想绑定一个包含预算列表（名称和值列）的数据表。它在我第一次加载页面时起作用：

```
<v:Chart x:Name="BudgetChart" 
         Title="Budget Distribution">
    <v:PieSeries x:Name="PieSeries" 
                 IndependentValueBinding="{Binding Path=CategoryName}"
                 DependentValueBinding="{Binding Path=Value}"/>
</v:Chart> 
```

我将我的数据绑定到这样的图表：

```
void RefreshChart()
{ 
    PieSeries.ItemsSource = dataTable;
} 
```

我的问题是，如果我`RefreshChart()`第二次打电话，我会遇到一个奇怪的异常：

> KeyNotFoundException：给定的键不在字典中。

有什么我做的不对吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T02:10:31.173

这实际上是图表控件的一个错误，仅在 WPF 端表现出来（在 Silverlight 中工作正常）。在我将其报告为[延迟博客](http://blogs.msdn.com/delay/archive/2009/03/25/supporting-the-unsupported-two-fixes-for-the-unofficial-wpf-charting-assembly.aspx?CommentPosted=true#commentmessage)报告后，该问题已迅速修复！

# mysql - 监控 Rails 中站点性能的最佳方法是什么

> ID：669845
> 
> 赞同：6
> 
> 时间：2009-03-21T19:39:55.763
> 
> 标签：mysql, ruby-on-rails, performance

我想要一个管理区域的特殊部分，它显示过去一周缓慢的页面/查询列表。

是否有 gem / plugin 或其他简单的方法来为 Rails 框架实现/自动化此类功能？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T22:38:04.977

[http://www.newrelic.com/features.html](http://www.newrelic.com/features.html)

以及 RPM 的简短截屏视频：

[http://railslab.newrelic.com/2009/01/22/new-relic-rpm](http://railslab.newrelic.com/2009/01/22/new-relic-rpm)

PS 我不为 New Relic 工作:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-21T19:46:31.520

这是[一个例子](http://www.fiveruns.com/)，[一个又](http://railstips.org/2008/9/17/rails-app-monitoring)一个[例子](http://onrails.org/articles/2007/08/31/monitoring-rails-performance-with-munin-and-a-mongrel)。更多信息请参见[谷歌](http://www.google.com/search?q=rails+performance+monitoring)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T19:45:29.480

是的，这似乎是个好主意。我以前从未见过它，但我想你可以只记录每个请求到数据库的时间；然后一个简单的查询将向您显示最慢的请求。

你如何优化你的应用程序完全取决于你的代码；我想这没有灵丹妙药。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T19:52:47.607

想到的第一件事：可以跟踪查询的执行时间，如果它超过了一些被认为是正常的阈值（可能是平均值），它会与一些分析信息一起记录（否则将被丢弃）。

分析查询的各个部分（如从数据库中获取数据、逻辑等）也是可行的，然后再次将时间与一些平均值进行比较。

一个陷阱是，由于它们所做的“工作”量不同，某些页面/查询的处理时间必然比其他页面/查询长得多。人们必须为网站的不同部分/不同类型的查询保留大量平均值，以便摆脱设计执行时间更长的正常查询的持续流动。

这是一个非常简单的方法，我相信有更好的方法来做到这一点。

# encryption - URL 和 salt 中的加密数据

> ID：669849
> 
> 赞同：4
> 
> 时间：2009-03-21T19:42:06.820
> 
> 标签：encryption, platform-agnostic

在 URL 中传递对称加密数据或可能将加密数据存储在 cookie 中时，是否合理和/或必要和/或也可以在同一 URL 中传递对称加密 IV (Salt)？在网络等无状态环境中使用 Salt 的想法是否有效？

（我了解盐在给定名称或帐户列表的数据库中是如何工作的，但鉴于我们在无状态环境中传递数据，我们无法保存盐。

假设一个用于加密数据然后解密数据的服务器端密码，如何使用 Salt？我想可以在查询字符串中传递一个单独的 IV，但公开暴露盐好吗？

或者可以从“密码”的哈希中生成密钥和 IV。假设 IV 和 Key 来自哈希的非重叠区域，这可以吗？（我意识到给定密码的盐/密钥总是相同的。）

编辑：通常使用 AES。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T19:46:36.513

鼓励为每个加密例程生成随机 IV，它们可以与密文一起安全地传递。

**编辑：**

我可能应该问一下您要存储什么类型的信息以及为什么要使用带有 AES 加密的盐，因为盐通常用于散列，而不是对称加密。如果盐是公开的，它就违背了拥有它的目的。

您真正需要做的是确保密钥的强度，因为如果攻击者拥有盐、IV 和密文，则很容易对较弱的密钥进行暴力攻击。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T20:02:19.407

您不应从密钥生成初始化向量。对于给定的消息，初始化向量应该是不可预测的；如果您从密钥（或用于生成密钥的密码）生成它，IV 将始终相同，这违背了它的目的。

然而，IV 不需要保密。用密文发送它是很常见的，不受保护。将 IV 包含在 URL 中比尝试在某些服务器端状态下尝试跟踪给定链接的 IV 要容易得多。

* * *

Salt 和 IV 有不同的应用，但它们的作用方式相似。

加密“盐”用于基于密码的密钥派生算法；存储用于身份验证的散列密码是此功能的特例。Salt 使相同的密码产生不同的哈希值，并阻止“字典攻击”，在这种攻击中，黑客预先计算了常见密码的哈希值，并建立了一个“反向查找”索引，以便他们可以快速发现给定密码的密码哈希。像静脉注射一样，使用的盐也不是秘密。

初始化向量与 DES 和 AES 等分组密码一起以反馈模式（如 CBC）使用。每个块在加密时与下一个块组合。例如，在 CBC 下，前一个块密文在加密之前与当前块的纯文本进行异或运算。IV 是随机生成的，用作引导进程的虚拟初始块。

因为为每条消息选择（或至少应该）不同的 IV，所以当使用相同的密钥加密相同的消息时，生成的密文是不同的。从这个意义上说，静脉注射与盐非常相似。加密随机生成器通常是盐或 IV 最简单和最安全的来源，因此它们也具有相似性。

* * *

密码学很容易搞砸。如果您对自己正在做的事情没有信心，您应该考虑您所保护的信息的价值，并相应地进行预算以获得您需要的培训或咨询。

# xpath - xPath 遍历

> ID：669850
> 
> 赞同：1
> 
> 时间：2009-03-21T19:42:31.267
> 
> 标签：xpath, traversal

我正在尝试使用 xPath 遍历报纸的代码（为了练习）现在我想获得主要文章，它是图片和我得到的小描述。但到目前为止，我对 xPath 的技术还不是很熟练，也无法进行详细的描述。

使用此代码：

```
<div class="margenesPortlet">

<div class="fondoprincipal">
<div class="margenesPortlet">
<a href='notas/n1092329.htm' ><img id="LinkNotaA1_Foto" src="http://i.oem.com.mx/5cfaf266-bb93-436c-82bc-b60a78d21fb6.jpg" height="250" width="300" border="0" /></a>

<div class="piefoto_esto">Un tubo de 12 pulgadas al lado de la Vialidad Sacramento que provoc&#243; el corte del servicio durante toda la ma&#241;ana y hasta alrededor de las cuatro de la tarde. Foto: El Heraldo de Chihuahua</div>

<div class="cabezaprincesto"><a href='notas/n1092329.htm' class='cabezaprincesto'  >Sin agua 8 mil usuarios</a></div>
<div class="resumenesto"><a href='notas/n1092329.htm' class='resumenesto'  >La ruptura de una l&#237;nea en el tanque de rebombeo de agua Sacramento dej&#243; sin servicio a ocho mil usuarios, en once colonias del sur de la ciudad. </a></div>
</div>
</div>

</div> 
```

我想得到图片（有或没有标题），然后是文章的标题。这三件事我可以通过使用得到：

//div[@class='fondoprincipal'] <-- 给我主要图片和标题

//a[@class='cabezaprincesto']/text() <-- 给我文章的标题

但是我无法获得带有class =“resumenesto”的div的小描述，我没有尝试通过该id获取任何东西，因为相同的id在HTML的其余部分反复使用，所以它返回很多额外的项目。

我怎样才能得到这个特定的？然后你们中的任何人会推荐我一种将其解析到另一个网页的好方法吗？我在想也许 php 使用这些值编写一些 html，但我不确定真的......

* * *

**编辑**

我所说的“这个特定的”的意思是我如何获得这个 div class="resumenesto"，它位于 div class="fondoprincipal" 中......

* * *

**编辑 2**

谢谢，现在 xPath Traversing 更加清晰了。但是关于我的第二个问题，你们中有人会推荐我一种将其解析到另一个网页的好方法吗？我在想也许 php 使用这些值编写一些 html，但我不确定真的..

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T19:49:16.820

你说 resumenesto 的“id”，但在你的代码示例中，你正在谈论的 div 有一个 resumenesto 类。

此外，当您使用类似这样的 xpath 时：

```
//div[@class='resumenesto'] 
```

您得到的是与该 xpath 匹配的节点列表。因此，如果您只想专门引用该列表中的单个项目，则需要指定列表中的哪个项目：

```
//div[@class='resumenesto'][1] 
```

此外，您所说的“这个特定的”是什么意思？告诉 xpath 特异性的唯一方法是为其提供上下文，例如“具有类 resumenesto 的 div 位于其他 div 中”，或“第一个具有类 resumenesto 的 div”。

阅读[W3Schools 的 XPath 语法概述了解](http://www.w3schools.com/xsl/xpath_syntax.asp)更多信息。

编辑：

要让 div 位于“fondoprincipal”中：

```
//div[@class='fondoprincipal']//div[@class='resumenesto'] 
```

这告诉 xpath 在文档中找到任何具有类 fondoprincipal 的后代 div，并在该 div 中找到任何具有类 resumenesto 的后代 div。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T20:48:15.290

为了缩小搜索范围，您也可以添加 div：

```
//div[@class='resumenesto']/a[@class='resumenesto']/text() 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T21:26:23.293

要让它通过测试，您需要：

```
//div[@class='fondoprincipal']//a[@class='resumenesto'] 
```

请注意，您想获得 a （而不是 Raul 建议的 div ），因为它在您获得文本的那个元素中。

Regarding putting it on a page, you can do it in asp.net. Use the XElement to load the values and then the XPathSelectElement to get the values ([http://msdn.microsoft.com/en-us/library/bb156083.aspx](http://msdn.microsoft.com/en-us/library/bb156083.aspx)).

# vim - 使用带有斯堪的纳维亚字符的 vim+LaTeX

> ID：669858
> 
> 赞同：4
> 
> 时间：2009-03-21T19:48:09.363
> 
> 标签：vim, ubuntu, latex

我想在 Ubuntu 中使用 LaTeX 创建一个实验室文章，但是我的文本包含斯堪的纳维亚字符，目前我必须使用 /"a 和 "/o 等输入它们。是否可以让乳胶编译器读取这些特殊字符是按原样输入的吗？此外，我希望 vim 能够“读取”芬兰语：现在，当我打开一个包含斯堪的纳维亚字符的 .tex 文档时，它们根本不会在 vim 中显示。我该如何纠正？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T19:50:31.450

对于乳胶，使用 inputenc 选项：

```
\usepackage[utf8]{inputenc} 
```

除了 utf8，你也可以使用任何适合你的东西，比如 latin1。

现在的诀窍是让您的终端运行相同的字符编码。似乎它运行的字符/输入编码现在不适合您的输入。

为此，请参阅您的发行版的“区域设置”设置。您始终可以通过发出来检查终端中的区域设置`locale`。如今，UTF8 语言环境成为首选，因为它们可以处理所有可以想象的字符。如果您的终端环境设置正确，vim 应该可以愉快地处理您的所有特殊字符，而不会感到悲伤。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-21T20:07:04.390

要找出 Vim 认为文档是哪种编码，请尝试：

```
:set enc 
```

要将编码设置为 UTF-8，请尝试：

```
:set enc=utf8 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T20:45:56.947

我对 vim 无能为力，但对于 LaTeX，我建议您查看[XeTeX](http://scripts.sil.org/cms/scripts/page.php?site_id=nrsi&id=xetex)，它是 TeX 的扩展，旨在支持 Unicode 输入。XeTeX 现在是 Texlive 的一部分，所以如果您安装了 TeX，那么您可能已经安装了它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T20:00:46.043

我使用 UCS unicode 支持：http: [//iamleeg.blogspot.com/2007/10/nice-looking-latex-unicode.html](http://iamleeg.blogspot.com/2007/10/nice-looking-latex-unicode.html)

# c# - 这个正则表达式怎么写？

> ID：669859
> 
> 赞同：1
> 
> 时间：2009-03-21T19:48:14.293
> 
> 标签：c#, regex

一个 20 - 24 字符长的字母数字字符串，没有空格和符号，至少有 2 位数字

```
AAAAAAAAAAAAAAAAAAAA - not valid
AAAAAA0AAAAAAAAA0AAA - valid
AAAAAA01AAAAAAAAA0AAA - valid
AAAAAA0AAAAAAAAA0AAA@ - not valid 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T19:52:36.000

我认为这只有通过前瞻断言才有可能：

```
^(?=[a-zA-Z\d]{20,24}$)[a-zA-Z]*\d[a-zA-Z]*\d[a-zA-Z\d]*$ 
```

前瞻断言 ( `(?=[a-zA-Z\d]{20,24}$)`) 检查字符串是否具有预期的形式（20-24 个字母数字字符）。第二部分 ( `[a-zA-Z]*\d[a-zA-Z]*\d[a-zA-Z\d]*`) 检查它是否包含至少两位数字。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T21:18:40.613

我认为这是最简单的模式：首先进行肯定的前瞻以检查是否至少有两位数字，然后匹配 20-24 个字母数字字符：

```
^(?=.*\d.*\d)[A-Za-z\d]{20,24}$ 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T19:54:58.863

我要抽象一点，因为这听起来像是作业（如果是，请这样标记）。

*   `{`您可以限制模式与min `,`max匹配的次数`}`
*   您可以限制哪些字符与`[`charlist匹配`]`
*   您可以使用所谓的零宽度正向前瞻来施加额外的限制（还有一种否定形式）。语法各不相同，因此请查看适合您环境的文档。

如果您需要更多帮助，请更新您的问题（和标签）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-21T20:36:28.467

Gumbo 对需求有正确的表述。

它可以缩短，但他的更清晰，可能比短版本更快。

var rX=/^(?=[a-zA-Z\d]{20,24}$)([a-zA-Z]*\d){2,}/

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-24T08:54:49.733

在 JS 中（对 C# 语法不够自信）：

```
if (str.length >= 20 && str.length <= 24 && /([a-z]*[0-9]){2}[a-z0-9]*/i.test(str)) {
  // match found
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-21T20:13:18.680

基本上与 Gumbo 相同的想法只是更短一点：

```
^(?=[\w\d]{20,24}$)[\w]*\d[\w]*\d[\w\d]*$ 
```

# java - 将二进制文件提交到 SVN

> ID：669863
> 
> 赞同：0
> 
> 时间：2009-03-21T19:50:13.540
> 
> 标签：java, svn, netbeans, resources

SVN没有提交像MySql连接器这样的库，所以当我提交我的项目时它没有上传到服务器，我该怎么做，我如何同步图片等其他资源？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T20:00:45.887

SVN 就像任何其他源代码控制管理系统一样，也可以处理二进制文件。这不应该造成问题。

检查文件是否不在`.svn-ignore`或任何类似的忽略标志下。检查定义文件的任何其他 SVN 属性是否设置正确。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T20:01:57.227

Subversion 可以支持任何类型的文件，您使用什么软件进行提交？如果您使用的是 TortoiseSVN：请确保您选中了“显示未版本控制的文件”框，并且选择了您要提交的每个文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-21T20:05:32.053

请记住，SVN 仅提交标记为已添加到项目的文件。

我相信您一定忘记将您的文件添加到存储库中，或者正如 Yuval A 所说，它可能在忽略列表中。

# c - typedef数组的混合索引行为？

> ID：669882
> 
> 赞同：0
> 
> 时间：2009-03-21T20:01:25.650
> 
> 标签：c, pointers, typedef

我有一个类型定义：

```
typedef unsigned char MyType[2]; 
```

我将它传递给一个函数，结果是失败！

```
void f(MyType * m)
{
*m[0] = 0x55;
*m[1] = 0x66;
}

void main(void)
{
Mytype a;
a[0] = 0x45;
a[1] = 0x89;

f(&a);
} 
```

变量`a`in的操作`main()`适用于 1 字节索引，因此`a`等于 {0x45, 0x89}。然而，在功能`f`上，索引作用于 2 个字节（`sizeof`类型）。

所以在 function中`f`，`*m[1]`在这种情况下实际上是修改内存越界。

这是为什么，我忘记了什么？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-21T20:06:20.523

尝试：

```
(*m)[1] 
```

代替`*m[1]`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T20:06:50.770

啊放弃后才解决！括号男孩，括号。

```
void f(MyType * m)
{
(*m)[0] = 0x55;
(*m)[1] = 0x66;
}

void main(void)
{
Mytype a;
a[0] = 0x45;
a[1] = 0x89;

f(&a);
} 
```

# php - 同一个根文件夹下的几个 Zend 框架项目

> ID：669885
> 
> 赞同：0
> 
> 时间：2009-03-21T20:01:56.960
> 
> 标签：php, zend-framework, directory

Zend Framework 项目结构假定您在每台服务器上只运行一个应用程序，例如 localhost/guessbook，其中控制器和内容位于该级别之上的一个文件夹中。

如何在我的 localhost 中有几个不同的基于 ZF 的项目，以便像使用常规 php 脚本应用程序一样处理它们 - 使用 localhost/app1、localhost/app2？

理想情况下，我想不使用 DocumentRoot，我想使用浏览器立即在应用程序之间切换。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T20:17:50.183

我不明白这是什么问题？也许您指的是发送到的典型重写规则`/index.php`？好吧，你可以改变重写规则

```
RewriteRule ^.*$ /index.php [NC,L] 
```

至

```
RewriteRule ^/app1/.*$ /app1/index.php [NC,L]
RewriteRule ^/app2/.*$ /app2/index.php [NC,L] 
```

在 bootstrap.php 中定义所有包含路径，因此您可以共享 Zend Framework 库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-07T12:43:41.820

您可以通过将 Zend 库与您的多个项目共享来做到这一点，这个 Url 将向您展示如何做到这一点

[http://www.mauriciocuenca.com/blog/2009/03/two-or-more-zend-framework-projects-on-a-shared-host/](http://www.mauriciocuenca.com/blog/2009/03/two-or-more-zend-framework-projects-on-a-shared-host/)

除此之外，在 wamp 中，您可以配置 Vhost 以创建多个本地域：

[http://mikebernat.com/blog/Adding_Virtual_Hosts_to_Apache_&_Wampserver](http://mikebernat.com/blog/Adding_Virtual_Hosts_to_Apache_&_Wampserver)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T20:17:35.033

我认为你在这一点上是错误的。您可以在同一个主机名上拥有多个 zend 框架应用程序。即我一直在我的服务器上使用多个 magento 的安装来尝试一些东西。据我所知，Zend 没有固定的文件结构（我选择框架的原因之一）

您甚至可以将 Zend 库放置在 webroot 文件夹之外，并使用以下内容调用它：

```
$lib = realpath(dirname(basename(__FILE__)) . '/../../../lib');
set_include_path(get_include_path() . PATH_SEPARATOR . $lib);

$rootDir = dirname(dirname(__FILE__));
        define('ROOT_DIR', $rootDir);

        set_include_path(get_include_path()
            . PATH_SEPARATOR . ROOT_DIR . '/library/'
            . PATH_SEPARATOR . ROOT_DIR . '/app/models/'
        );

        include 'Zend/Loader.php';
        spl_autoload_register(array('Zend_Loader', 'autoload'));

        // Load configuration
        Zend_Registry::set('configSection', $configSection);
        $config = new Zend_Config(new Zend_Config_Ini(ROOT_DIR.'/application/config.ini', $configSection));
        Zend_Registry::set('config', $config); 
```

# php - 如何让这个 PHP 代码输出 HTML？

> ID：669887
> 
> 赞同：-4
> 
> 时间：2009-03-21T20:01:59.940
> 
> 标签：php

如何让这个 PHP 代码输出 HTML 以输入玩家号码并生成锦标赛？

```
<?php
class RoundRobin
{
 var $MaxTeams;
 var $MaxCombinations;
 var $tourn;
 var $mList;
 var $cList;
 var $cUsed;
 function RoundRobin($max)
 {
  $this->MaxTeams=$max;
  $this->MaxCombinations=($this->MaxTeams/2)*($this->MaxTeams-1);
 }
 function ShowSchedule($players,$totalChecks)
 {
   echo $players.' players'."\n";
   for ($r=1; $r <= $players/2; $r++) echo 'Game'.$r;
   echo "\n";
   echo"        +-";
   for ($r=1; $r <= ($players/2)*6-2; $r++) echo '-';
   echo "\n";
   $index = 1;
   for ($r=1; $r <= $players-1; $r++)
   {
     echo 'Week '.$r. '|';
     for ($m=1; $m <= $players/2; $m++)
     {
       echo $this->tourn[$index]['one'].'&amp;'. $this->tourn[$index]['two'];
       $index++;
     }
     echo "\n";
   }
   echo "\n".$totalChecks,' combinations tried'. "\n\n";
 }
 function array_copy(&$dest,$source)
 {
  if(count($source)>count($dest)) {echo 'fatal'; exit;}
  //for($a=0;$a<count($source);$a++)
  $dest['one']=$source['one'];
  $dest['two']=$source['two'];
 }
 function ClearArrays()
 {
   for ($i=0; $i <= $this->MaxCombinations; $i++)
   {
    $this->tourn[$i]['one']=0;
    $this->tourn[$i]['two']=0;
    $this->cList[$i]['one']=0;
    $this->cList[$i]['two']=0;
    $this->cUsed[$i]=0;
    if($i<=$this->MaxTeams/2)$this->mList[$i] = 0;
   }
 }
 function Scheldule($players)
 {
  while ($players <= $this->MaxTeams)
  {
 $combinations = $players/2 * ($players-1);
    $totalChecks = 0;
 $this->ClearArrays();
    /* set up list of all combinations */
     $m=1;
     for ($a=1; $a<$players; $a++)
      for ($b=$a+1; $b<=$players; $b++)
      {
       $this->cList[$m]['one'] = $a;
       $this->cList[$m]['two'] = $b;
       $m++;
      }
    $roundCount=1;
    $index=1;
    while ($roundCount <= $players-1)
     {
       $matchCount = 1;
       $round_set = 0;
       for ($i=0; $i<=$this->MaxTeams/2; $i++) $this->mList[$i] = 0;
       $startC = $roundCount;
         while ($matchCount <= $players/2)
         {
            $c = $combinations + 1;
            while ($c > $combinations)
            {
              $c = $startC;
              /* find an unused pair that would be legitimate */
              while (
                 ($c <= $combinations)
                 &&
                      ( //
                      ($round_set & (1 << $this->cList[$c]['one'])) ||
                       ($round_set & (1 << $this->cList[$c]['two'])) ||
                       (!empty($this->cUsed[$c]))
                      )
                    )   $c++;
                if ($c > $combinations)
                 {
                  do {
                    $this->mList[$matchCount] = 0;
                    $matchCount--;
                    $index--;
                    $round_set &= ~(1 << $this->cList[$this->mList[$matchCount]]['one']);
                    $round_set &= ~(1 << $this->cList[$this->mList[$matchCount]]['two']);
                    $this->cUsed[$this->mList[$matchCount]] = false;
                    $this->tourn[$index]['one'] = 0;
                    $this->tourn[$index]['two'] = 0;
                   }
                   while ($this->cList[$this->mList[$matchCount]]['one'] != $this->cList[$this->mList[$matchCount]+1]['one']);
                  $startC = $this->mList[$matchCount]+1;
                }
            }
            $this->array_copy(&$this->tourn[$index],$this->cList[$c]);
            $totalChecks++;
            if (($totalChecks % 1000) == 0) printf("%d\033A\n", $totalChecks );
            $this->cUsed[$c] = true;
            $this->mList[$matchCount] = $c;
            $startC = 1;
            $round_set |= (1 <<  $this->cList[$c]['one']);
            $round_set |= (1 <<  $this->cList[$c]['two']);
            $index++;
            $matchCount++;
         }
      $roundCount++;
     }
   /* yahoo!, scheduled all the rounds */
    printf("          " );
    $this->ShowSchedule($players,$totalChecks);
    /* try and make a schedule using two more teams */
   $players += 2;
   }
     }
}
?> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T20:31:55.280

这是一个PHP类。阅读[手册](http://us.php.net/manual/en/language.oop5.php)可能会对您有所帮助。

类似这样的东西*可能会*起作用：

```
$rr = new RoundRobin( 5 );

$rr->Scheldule( $_POST['PlayerCount'] ); 
```

但我不会费心去破译代码来解决它是否真的会。

另外，如果您还没有学习过 HTML 表单，请阅读[w3schools 之](http://www.w3schools.com/html/DEFAULT.asp)类的教程。

# sqlite - 从 Webkit 的 HTML5 数据库存储中获取插入 ID

> ID：669892
> 
> 赞同：8
> 
> 时间：2009-03-21T20:05:09.993
> 
> 标签：sqlite, webkit, auto-increment

Webkit（至少在 iPhone 和 Safari 上）通过 SQLite 支持 HTML5 的数据库存储。

我试图弄清楚如何最好地获取以下事务的插入 ID（数据库中有一个自动增量字段“id”）。

```
db.transaction(function(tx) {
  tx.executeSql("INSERT INTO teams (name) VALUES (?)", [$('#team_name').val()]);
}); 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-31T18:39:41.163

下面的代码示例来自 Apple 的文档，我知道它适用于 iPhone 和 Safari，可能还有 WebKit。您可以使用 resultSet 响应对象获取插入 id`resultSet.insertId` 此外，您可以获取受影响的行数，例如通过使用 resultSet 对象的 rowsAffected 属性进行更新查询。

```
db.transaction(
function (transaction) {
    transaction.executeSql('INSERT into tbl_a (name) VALUES ( ? );',
        [ document.getElementById('nameElt').innerHTML ],
        function (transaction, resultSet) {
            if (!resultSet.rowsAffected) {
                // Previous insert failed. Bail.
                alert('No rows affected!');
                return false;
            }
            alert('insert ID was '+resultSet.insertId);
            transaction.executeSql('INSERT into tbl_b (name_id, color) VALUES (?, ?);',
                [ resultSet.insertId,
                  document.getElementById('colorElt').innerHTML ],
                nullDataHandler, errorHandler);
        }, errorHandler);
}, transactionErrorCallback, proveIt); 
```

[Apple 的 HTML5 数据库文档](http://developer.apple.com/library/safari/#documentation/iPhone/Conceptual/SafariJSDatabaseGuide/UsingtheJavascriptDatabase/UsingtheJavascriptDatabase.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T22:19:25.303

像这样的东西应该可以工作：

```
SELECT last_insert_rowid(); 
```

# javascript - 在另一个完成时执行函数，使用 ajaxComplete()？

> ID：669901
> 
> 赞同：3
> 
> 时间：2009-03-21T20:08:26.227
> 
> 标签：javascript, jquery, json, ajax

两个函数需要在 Javascript 中执行，一个应该在另一个完成时启动。

第一个用 填充一个数组`getJSON`，然后第二个将对其进行操作。

但是，`getJSON`它是异步的，它不会暂停执行顺序以使程序正常工作，以便数组在第二个函数执行之前完成加载。

一旦`ajaxComplete()`数据`getJSON`通过`getJSON`.

谢谢。

* * *

这是代码：

```
function fetch_ids(user) {
  var url = 'http://test.com/ids/' + escape(user) + '.json?callback=?';
  // populate array ids[] with JSON data --uid[] array declared globally
  $.getJSON(url, function(data) {
    for (var i = 0; i < data.length; i++) ids[i] = data[i];
  });
  // test array and run alert
  for (i = 0; i < uid.length; i++) {
    for (j = 0; j < ids.length; j++) {
      if (uid[i] == ids[j]) {
        alert('matched: ' + uid[i]);
      }
    }
  }
  // finish test
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-21T20:16:04.600

这不行吗？

```
$.getJSON(url, params, function (jsonData){
  // populate array
  // call 2nd function.
}); 
```

最坏的情况是，如果您已经在其他地方定义了 2 个函数：

```
$.getJSON(url, params, function (jsonData){
  firstFunction(jsonData);
  secondFunction(jsonData);
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T20:33:07.337

检查这个类似的帖子... [如何根据初始 .ajax 调用的结果启动另一个 jQuery .ajax 调用？](https://stackoverflow.com/questions/665218/how-to-initiate-another-jquery-ajax-call-based-on-the-result-from-an-initial-aj)

诀窍是将第二次调用放在第一次调用的成功函数中。

# python - Django中基于日期的通用视图的分页

> ID：669903
> 
> 赞同：6
> 
> 时间：2009-03-21T20:08:56.787
> 
> 标签：python, django, pagination

我有一个非常简单的问题。我想在 Django 站点上创建一些基于日期的通用视图，但我也想对它们进行分页。根据文档， object_list 视图具有 page 和 paginate_by 参数，但 archive_month 视图没有。什么是“正确”的做法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-25T05:50:15.730

我创建了一个模板标签来对传递给尚未分页的模板的集合进行基于模板的分页。将以下代码复制到`app/templatetags/pagify.py`文件中。

```
from django.template import Library, Node, Variable
from django.core.paginator import Paginator
import settings

register = Library()

class PagifyNode(Node):
    def __init__(self, items, page_size, varname):
        self.items = Variable(items)
        self.page_size = int(page_size)
        self.varname = varname

    def render(self, context):
        pages = Paginator(self.items.resolve(context), self.page_size)
        request = context['request']
        page_num = int(request.GET.get('page', 1))

        context[self.varname] = pages.page(page_num)
        return ''

@register.tag
def pagify(parser, token):
    """
    Usage:

    {% pagify items by page_size as varname %}
    """

    bits = token.contents.split()
    if len(bits) != 6:
        raise TemplateSyntaxError, 'pagify tag takes exactly 5 arguments'
    if bits[2] != 'by':
        raise TemplateSyntaxError, 'second argument to pagify tag must be "by"'
    if bits[4] != 'as':
        raise TemplateSyntaxError, 'fourth argument to pagify tag must be "as"'
    return PagifyNode(bits[1], bits[3], bits[5]) 
```

要在模板中使用它（假设我们已经传入了一个名为**items**的未分页列表）：

```
{% load pagify %}

{% pagify items by 20 as page %}
{% for item in page %}
    {{ item }}
{% endfor %} 
```

page_size 参数（20）也可以是一个变量。该标签会自动检测`page=5`查询字符串中的变量。如果您需要获取属于该页面的分页器（例如，对于页数），您可以简单地调用：

```
{{ page.paginator.num_pages }} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T09:35:00.453

基于日期的通用视图没有分页。似乎您也无法通过包装它们来添加分页，因为它们返回渲染结果。

在这种情况下，我会简单地写下我自己的观点。您也可以查看通用视图的代码，但在您的情况下可能不需要其中的大部分。

由于您的问题是有效的，并查看代码；我想知道为什么他们不将查询集生成分离为单独的函数。您可以使用它们并按照您的意愿进行渲染。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-25T08:33:50.590

我昨天正在处理一个类似的问题，我发现对我个人来说最好的解决方案是对所有基于日期的页面使用 object_list 通用视图，但传递一个过滤的查询集，如下所示：

```
import datetime, time

def post_archive_month(request, year, month, page=0, template_name='post_archive_month.html', **kwargs):
    # Convert date to numeric format
    date = datetime.date(*time.strptime('%s-%s' % (year, month), '%Y-%b')[:3])
    return list_detail.object_list(
      request,
      queryset = Post.objects.filter(publish__year=date.year, publish__date.month).order_by('-publish',),
      paginate_by = 5,
      page = page,
      template_name = template_name,
      **kwargs) 
```

urls.py 的内容如下：

```
url(r'^blog/(?P<year>\d{4})/(?P<month>\w{3})/$',
    view=path.to.generic_view,
    name='archive_month'), 
```

我发现这是解决问题的最简单方法，无需求助于破解其他通用视图或编写自定义视图。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-09T15:55:12.080

还有一个优秀[的 django-pagination](http://code.google.com/p/django-pagination/)插件，它完全独立于底层视图。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-12T21:50:22.727

Django 基于日期的通用视图不支持分页。有[一张从 2006 年开始的公开票](http://code.djangoproject.com/ticket/2367)。如果您愿意，可以试用提供的代码补丁来实现此功能。我不确定为什么补丁还没有应用于代码库。

# asp.net - 如何使用 wwScriptCompressionModule？使用 asp.net 进行 gzip 压缩

> ID：669905
> 
> 赞同：2
> 
> 时间：2009-03-21T20:10:05.740
> 
> 标签：asp.net, compression, gzip, westwind

好的，我下载了 WestWind Ajax 控件，并将其添加到我的 web.config 中：

```
<httpModules>
    <add name="ScriptModule" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35"/>
    <add name="wwScriptCompressionModule" type="Westwind.Web.Controls.wwScriptCompressionModule,Westwind.AjaxToolKit"/>
</httpModules> 
```

我在我的母版页 .cs 文件中注册我的 js：

```
Page.ClientScript.RegisterClientScriptInclude(typeof(name_of_masterpage), "scripts", ResolveUrl("~/js/all_script.js")); 
```

现在据我了解，它应该可以工作，但不是吗？我可能遗漏了一些非常明显的东西，但我似乎在任何地方都找不到简单的教程或解释。我只使用 IIS 6。

非常感谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-16T06:28:23.113

这应该像我想的那样工作

```
Page.ClientScript.RegisterClientScriptInclude(this.GetType(), "scripts", ResolveUrl("~/js/all_script.js")); 
```

或其他方法

```
HtmlGenericControl Include = new HtmlGenericControl("script"); 
Include.Attributes.Add("type", "text/javascript"); 
Include.Attributes.Add("src", sInclude); 
this.Page.Header.Controls.Add(Include); 
```

希望这可以帮助

# svn - 有哪些最佳 SCM 实践？

> ID：669906
> 
> 赞同：5
> 
> 时间：2009-03-21T20:10:31.883
> 
> 标签：svn, git, version-control

一段时间以来，我一直在使用 Git 来管理我自己的个人项目。我并没有真正考虑过我是如何使用它的。每当有一个里程碑没有真正思考时，我通常都会提交所有更改。

但是在阅读了[一篇](http://railstips.org/2009/3/12/3-simple-guidelines-for-contributing)提到如何纠正提交消息的博客文章后，我意识到我真的不知道如何正确利用 SCM。

所以我想知道您是否有任何关于以下内容的提示：

*   何时应该提交更改
*   如何编写提交消息
*   如何使用存储库与他人合作
*   还要别的吗...

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T23:10:34.637

由于您使用的是 git，以下是我的一些做法，可能适合您，也可能不适合您：

1.  始终在具有描述性名称的本地分支中工作，例如 work/feature_name（使用令人敬畏的 git bash 完成来帮助您输入）
2.  在本地分支机构中尽可能多地提交简洁的评论（以记录提醒自己的意图。）因此，您拥有可以返回的完整原始思想/发展历史。
3.  在你推送/发布提交/补丁之前，从你的工作分支创建一个 pu（提议的更新）分支（git checkout -b pu/feature_name）并使用 git rebase -i 进行完美的提交，即，分组相关的小提交（和/或将大型提交拆分为逻辑提交并编写有意义的描述（为他人和您自己）确保每个逻辑提交都构建并通过回归。
4.  发布您的 pu/feature_name（要求人们拉取或只是推送到像 github 这样的公共服务器。）
5.  如果您有代码审查流程，您可能需要多次迭代 3 和 4 次。

听起来很复杂，但练习起来真的很开心（至少对我来说），因为 git 速度如此之快，并且在完成所有这些步骤时感觉如此正确。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-21T20:43:14.537

我知道提交权力的两种合理且普遍的使用方式：

*   细粒度提交，您可以尽早提交，经常提交，并且分小块提交。系统可能不会在每次提交时都处于良好状态。这种做法的主要好处是，您可以非常清楚地了解更改的内容和时间，并且使用像[darcs](http://darcs.net/)这样的系统或像这样的命令，`git-rebase`您有机会“采摘”您感兴趣的提交。

*   可靠的提交，只有在系统处于固态时才提交，例如，它不仅可以构建而且还可以通过回归测试。

在大型团体项目中，某种可靠的方案是必要的，尽管您仍然可以在本地进行细粒度提交，并且只有在固态时才将它们公开。

多年后，我一直观察到，大多数学生和其他初学者都害怕承诺，而且承诺的频率不够高。对于我自己的项目，我倾向于使用细粒度的方法，而对于较大的项目，我通常至少有两个分支，对一个进行实体系统提交，对另一个进行细粒度提交。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-21T20:47:22.297

其他答案适用于使用多人使用的中央存储库。当我使用 git 时，我通常有自己的私有分支来处理我正在处理的事情，而且我倾向于进行很多小提交。在开发过程中，我发现这很有用，因为当我意识到我应该做一些不同的事情时，我可以快速回溯，而且我也有一个相对详细的日志记录我所做的事情。

然后，当我准备好向上游推送（即测试、记录等）时，我将推送作为单个提交，避免中央存储库中的混乱。两全其美。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-21T20:25:04.173

查看Eric Sink 的[Source Control HOWTO](http://www.ericsink.com/scm/)。上次我浏览它时，它主要集中在集中式 VCS，但其中仍然有很多好东西。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-23T09:44:08.690

*   尽早提交，经常提交。
*   保持提交很小。如果提交很大，请尝试在有意义的地方将其分解。
*   不要破坏代码。每次提交都应使代码保持工作状态。
*   尝试在提交消息中包含意图，而不仅仅是“什么”。
*   不要注释掉代码。而是删除它们。
*   利用分支进行实验性或潜在的代码破坏更改。
*   标记您的发货版本。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-21T20:13:52.953

我通常在添加新功能或完成已记录的错误修复后提交。基本上，一次做一件事。这使得回滚更改更容易。

至于提交消息，我将列出为新特性添加的功能。对于错误修复，我包含了我们错误数据库中的错误 ID。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-21T20:32:20.553

在处理一个小型个人项目时，它可能不太重要，因为您知道您的代码，您记得您做了什么，大约是什么时候等 - 至少我是这样。

但是对于有许多开发人员的大型项目，重要的是

*   始终指定问题编号（可以使用任何好的 SCM 强制执行）
*   减少提交次数
*   只提交工作代码
*   只提交比之前代码更好的代码
*   提交干净的代码（即不要留下测试代码、旧的注释代码等）
*   不仅要写“已修复问题 X”作为评论，还要说明有关错误/更改的更多信息，例如“已修复问题 X，其中面板将扩展超出窗口大小”。

当查看更改文件的历史并试图找出特定问题何时出现时，好的注释将帮助您更快地找到正确的提交。

通过减少提交次数，检查与新功能相关的更改、恢复“功能”或将其合并到另一棵树中也会更容易。

/乙

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-21T20:14:57.647

当您提交更改时，请确保代码已构建并且基本上可以正常工作。提交破坏构建的代码是不好的形式。如果您在团队环境中工作，没有什么比查看最新代码发现它破坏了应用程序甚至无法编译更糟糕的了。

至于注释，请粗略描述代码的作用以及理想的原因。这使您无需阅读代码即可了解签入的功能

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-21T20:19:21.473

对于个人项目，我倾向于尽可能频繁地提交，这可能是一个小时几次，因为当我意识到自己走错了路时，这可以让我及时回到之前的“快照”。

对于多用户项目，它将取决于规则，在达到这些目标之前，您不能提交某些内容。就我个人而言，当我可以按照“修复此票证”或“实现此功能”之类的方式写评论时，我倾向于承诺。

至于评论，我放了更改摘要或票证或维基参考。代码和差异应该有足够的记录以提供详细信息。

# c# - 数据源控件和参数类型转换

> ID：669908
> 
> 赞同：1
> 
> 时间：2009-03-21T20:10:58.607
> 
> 标签：c#, asp.net, sql, sql-server, ado.net

Q1 - 在下面的代码示例中，运行时在两种不兼容的类型之间转换一个值：

```
 <SelectParameters>
 <asp:Parameter Name="City" Type="Int32" />
 </SelectParameters>

protected void SqlDataSource2_Selecting(object sender,
       SqlDataSourceSelectingEventArgs e)
{e.Command.Parameters["@City"].Value = "100";} 
```

我得到的例外：

“将 nvarchar 值 'Seattle' 转换为数据类型 int 时转换失败。”

A) 上述异常表明运行时确实设法将 String 类型的值转换为 Int32 类型的值，因此异常发生在 SqlServer 上？！

B）既然 String 和 Int32 是不兼容的类型，为什么运行时首先执行从 String 到 Int32 的转换？

我们正在处理不兼容的类型这一事实是否使运行时“意识到”应用程序很可能存在错误，类似于编译器“意识到”它正在处理（在下面的代码中）两种不兼容类型的方式：

```
String s = ”something”;
int i = (int)s; //error 
```

Q2：

A) public void GetEmployee(int EmployeeID);

```
<asp:ObjectDataSource  SelectMethod=”GetEmployee” …&gt;
  <SelectParameters>
    <asp:ControlParameter Name = ”EmployeeID” ...>
  </SelectParameters> 
```

如果出于某种原因 EmployeeID 参数为 NULL，ObjectDataSource 会将 Null 转换为零并将其作为参数传递给 GetEmployee() 方法。

为什么运行时会进行这样的转换？抛出异常不是更有意义吗？

B) “使用 ConvertEmptyStringToNull 属性指定在数据源中更新数据字段时，是否将空字符串值自动转换为 null。”
我不太明白这个属性的用处。为什么空字符串表示我们希望将 null 插入到源的数据字段中？我假设这个数据字段是字符串类型的？那么为什么不也有 ConvertZeroInt32ToNull 等呢？

问题 3：

```
<asp:SqlDataSource ID="sourceEmployees" runat="server"
     ProviderName="System.Data.SqlClient"
     ConnectionString="<%$ ConnectionStrings:Northwind %>"
     SelectCommand="SELECT EmployeeID, FirstName,LastName,
     Title, City FROM Employees WHERE City=@City">
         <SelectParameters>
             <asp:Parameter Name="City"/>
         </SelectParameters>
</asp:SqlDataSource> 
```

A) 我假设当您没有指定参数实例“City”是哪种类型时，它会自动属于 Object 类型，这意味着以后可以为其分配任何类型的值。因此，如果“City”稍后（例如在 SqlDataSource2_Selecting() 事件处理程序中）分配了错误类型的值，则只会在 Sql server 上检测到此错误分配，而不是之前（当然 Sql server 会将该错误报告回 web服务器 ）？

B) 如果我们创建一个 NVarChar(20) 类型的 SqlParameter 实例并希望将此参数传递给存储过程，Ado.net 是否会仅将这个参数的值传递给存储过程，或者它还会以某种方式通知该过程此参数的确切类型（即 NVarChar(20)）？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-25T05:11:01.810

这是一个 SQL Server 错误。您遇到了[数据类型优先级](http://msdn.microsoft.com/en-us/library/ms190309(SQL.90).aspx)问题。

线索在这里：

```
SELECT EmployeeID, FirstName,LastName, Title, City FROM Employees WHERE
City=@City --here exactly 
```

City 列是 nvarchar 参数**显式**设置为 int

把它们加在一起，你得到：

```
SELECT EmployeeID, FirstName,LastName, Title, City FROM Employees WHERE
City=100 
```

根据数据类型优先规则，数据库引擎尝试将 City 的所有值更改为“int”。当然，失败了。

不过，对于您的观点：

*   Q1：同样的问题。你没有告诉 SQL Server “100”应该是字符串
*   Q2：空字符串在 SQL 中强制转换为零。如果您想要 SQL 空值，请发送 dbnull.value
*   问题 3a。SQL 没有对象数据类型。它查看 100 并决定“int”
*   问题 3b。是的，使用存储过程并正确定义它。

总体而言，SQL Server 的行为与宣传的完全一样。在这种情况下，您根本没有提供足够的信息。

编辑：存储过程使用

当您将参数添加到参数集合时，您会告诉 SQL 数据类型是什么。您定义（并创建）存储过程以具有 nvarchar 参数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T21:00:06.243

我将尝试回答您的第一个问题——“将 nvarchar 值 'Seattle' 转换为数据类型 int 时转换失败。”</p>

由于我没有在任何地方看到“西雅图”，我猜这个错误实际上来自你正在调用的存储过程——即。无论您在 proc 中使用 @City 是什么，都是问题所在。听起来你不是在做“where CityID=@City”之类的事情，而是在做“where CityName=@City”，它抱怨它不能将 CityName（“Seattle”）的值之一转换为将其与@City 进行比较的整数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T22:31:34.057

> 我猜这个错误实际上来自您正在调用的存储过程 - 即。无论您在 proc 中使用 @City 是什么，都是问题所在。听起来你不是在做“where CityID=@City”之类的事情，而是在做“where CityName=@City”，它抱怨它不能将 CityName（“Seattle”）的值之一转换为将其与@City 进行比较的整数。

我故意使用不兼容的类型只是为了表达我的观点->这就是'为什么运行时甚至会费心尝试将一个值从一种不兼容的类型转换为另一种，因为用户将字符串分配给整数类型的变量这一事实表明这很可能是一个错误，而不是用户故意做的事情？

# asp.net - 在 URL 查询字符串中显示为 1 的多个 Base64 编码参数

> ID：669928
> 
> 赞同：0
> 
> 时间：2009-03-21T20:21:58.283
> 
> 标签：asp.net

我需要在查询字符串中传递 2 个参数，但希望它们作为单个参数显示给用户。在低级别，我如何连接这两个值，然后再将它们分开？这两个值都是 Base64 编码的。

```
?Name=abcyxz 
```

其中 abc 和 xyz 都是单独的 Base64 编码字符串。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-21T20:28:17.053

你为什么不做这样的事情

```
temp = base64_encode("var1=abc&var2=yxz") 
```

然后打电话

```
?Name=temp 
```

稍后您可以解码整个字符串并拆分变量。（对于伪代码：P）

编辑：来自维基百科的一小段引述

> 当前版本的 PEM（在 RFC 1421 中指定）使用 64 个字符的字母表，由大写和小写罗马字母字符（A-Z、a-z）、数字 (0-9) 和“+ " 和 "/" 符号。“=”符号也用作特殊的后缀代码。原始规范 RFC 989 还使用“*”符号来分隔输出流中编码但未加密的数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T20:26:04.873

您应该使用一些分隔符或存储第一项的长度。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T20:29:04.913

首先，我很好奇为什么你不能只传递两个参数。但是在给定的情况下，只需在 URL 查询字符串中选择任何有效字符，但不会出现在您的 base64 编码中，例如 ~

# .net - ClickOnce 是否支持将应用程序部署到需要身份验证的代理后面的客户端？

> ID：669929
> 
> 赞同：3
> 
> 时间：2009-03-21T20:22:26.147
> 
> 标签：.net, clickonce, isaserver

凭借 ClickOnce 的所有优点，我们希望将其用作我们应用程序的部署机制。

但是我在 Microsoft Connect 中发现了这条消息，它说 ClickOnce 代理身份验证失败。

[https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=115468&wa=wsignin1.0](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=115468&wa=wsignin1.0)

那么这是否意味着公司中最常见的场景之一（Windows 服务器 + ISA 服务器）不适用于 ClickOnce？

“解决方案”是为每个客户端修改 machine.config！。这对我们来说是绝对不能接受的（此外，ClickOnce 的目的是什么？？）

我们的应用程序使用 3.5，我想知道这个问题是否仍然存在。或者，如果有人设法完成这项工作。

（我知道有 v2 的补丁，但是 v3> 呢？）

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T06:50:51.690

没有回答您关于 3.5 中是否仍然存在该问题的确切问题，因为我仍在使用 2.0 代码库。但是，我希望以下内容对您有用，具体取决于部署环境中的可用选项：

> 那么这是否意味着公司中最常见的场景之一（Windows 服务器 + ISA 服务器）不适用于 ClickOnce？

UNC 部署是我在部署 ClickOnce（2.0 版）应用程序时遇到此代理身份验证问题时多次使用的解决方法。在公司环境中，共享的 NTFS 权限可以提供所需的安全级别

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T21:03:24.830

我的回答可能有点离题，但我认为你不应该担心这个：

*   个人用户和小公司没有带身份验证的代理

*   大公司确实有专门的 IT 人员来解决这类问题。他们要么找到让 ClickOnce 工作的方法（包括在每个客户端上部署本地 machine.conf），要么关闭整个应用程序，因为使用 ClickOnce 违反了他们的政策（IT 安全部门不喜欢拥有可执行文件的想法代码通过互联网自动更新到他们的安全网络中，我知道第一手资料）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-27T12:21:06.843

对于使用 .NET 框架 2.0 的客户，Microsoft 提供了针对此问题的热修复程序，可在[此处](http://code.msdn.microsoft.com/KB917952/Release/ProjectReleases.aspx?ReleaseId=790)找到。

请注意，此问题受您的客户正在运行的 .NET 版本（而不是您正在运行的版本）的影响。如果您的客户需要 .NET 3.5 来安装/运行您的 ClickOnce 应用程序，该版本已经解决了这个问题。

# python - 如何创建一个不重新创建具有相同输入参数的对象的类

> ID：669932
> 
> 赞同：2
> 
> 时间：2009-03-21T20:24:02.787
> 
> 标签：python, multiton

我正在尝试创建一个不会重新创建具有相同输入参数的对象的类。当我尝试使用用于创建已存在对象的相同参数来实例化一个类时，我只希望我的新类返回一个指向已创建（昂贵创建）对象的指针。这是我到目前为止所尝试的：

```
class myobject0(object):
# At first, I didn't realize that even already-instantiated
# objects had their __init__ called again
instances = {}
def __new__(cls,x):
    if x not in cls.instances.keys():
        cls.instances[x] = object.__new__(cls,x)
    return cls.instances[x]
def __init__(self,x):
    print 'doing something expensive'

class myobject1(object):
    # I tried to override the existing object's __init__
    # but it didnt work.
    instances = {}
    def __new__(cls,x):
        if x not in cls.instances.keys():
            cls.instances[x] = object.__new__(cls,x)
        else:
            cls.instances[x].__init__ = lambda x: None
        return cls.instances[x]
    def __init__(self,x):
        print 'doing something expensive'

class myobject2(object):
    # does what I want but is ugly
    instances = {}
    def __new__(cls,x):
        if x not in cls.instances.keys():
            cls.instances[x] = object.__new__(cls,x)
            cls.instances[x]._is_new = 1
        else:
            cls.instances[x]._is_new = 0
        return cls.instances[x]
    def __init__(self,x):
        if self._is_new:
            print 'doing something expensive' 
```

这是我第一次尝试压倒一切`__new__`，我确信我不会以正确的方式去做。请让我直截了当。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2011-09-21T01:27:16.197

这是一个类装饰器，可以使一个类成为 multiton：

```
def multiton(cls):
   instances = {}
   def getinstance(id):
      if id not in instances:
         instances[id] = cls(id)
      return instances[id]  
   return getinstance 
```

（这是 PEP 318 中单例装饰器的一个轻微变体。）

然后，为了让你的类成为一个 multiton，使用装饰器：

```
@multiton
class MyObject( object ):
   def __init__( self, arg):
      self.id = arg
      # other expensive stuff 
```

现在，如果您使用相同的 id 实例化 MyObject，您将获得相同的实例：

```
a = MyObject(1)
b = MyObject(2)
c = MyObject(2)

a is b  # False
b is c  # True 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-21T20:31:15.173

首先，在 Python 中使用大写类名。

其次，使用**工厂**设计模式来解决这个问题。

```
class MyObject( object ):
    def __init__( self, args ):
        pass # Something Expensive

class MyObjectFactory( object ):
    def __init__( self ):
        self.pool = {}
    def makeMyObject( self, args ):
        if args not in self.pool:
            self.pool[args] = MyObject( args )
        return self.pool[args] 
```

这比玩弄新的和拥有类级别的对象池要简单得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2021-07-09T08:57:52.230

这是我对 Jerry 方式的实现，使用数组作为池

```
def pooled(cls):
    """
    decorator to add to a class, so that when you call YourClass() it actually returns an object from the pool
    """

    pool = []

    def get_instance(*args, **kwargs):
        try:
            instance = pool.pop()
        except IndexError:
            instance = cls(*args, **kwargs)
        returned_instance = yield instance
        pool.append(returned_instance)
        print(len(pool))
        yield

    return get_instance

@pooled
class MyClass():
    def __init__(self, num):
      self.num = num

for i in range(10):
    m_gen =MyClass(i)
    n_gen = MyClass(i + 5)
    m = next(m_gen)
    n = next(n_gen)
    print(f'm num: {m.num}')
    print(f'n num: {n.num}')
    m_gen.send(m)
    n_gen.send(n) 
```

然后是使用元类的另一种方式，以便您可以继承功能。这个使用weakreaf valuedicts作为池，所以对象得到更好的垃圾收集

```
import weakref

class PooledMeta(type):
  def __init__(self, *args, **kwargs):
    super().__init__(*args, **kwargs)
    self._pool = weakref.WeakValueDictionary()

  def __call__(self, *args):
    if args in self._pool:
      print('got cached')
      return self._pool[args]
    else:
      # print(self._pool.valuerefs())
      instance = super().__call__(*args)
      self._pool[args] = instance
      return instance

class MyPooled(metaclass=PooledMeta):
  def __init__(self, num):
    print(f'crating: {num}')
    self.num = num

class MyPooledChild(MyPooled):
  def __init__(self, num):
    print(f'crating child: {num}')
    self.num = num

p = []
for i in range(10):
  m = MyPooled(i)
  n = MyPooledChild(i)
  p.extend([m,n]) 
```

# php - 有没有办法返回刚刚在 MySQL 中使用 PHP 创建的行的 id？

> ID：669942
> 
> 赞同：4
> 
> 时间：2009-03-21T20:31:47.170
> 
> 标签：php, mysql

当我在我的 MySQL 数据库中创建一个新条目时，我希望查询返回刚刚创建的表的 id。如果它不能做到这一点，是否有另一种方法来找出这个 id？我想这样做的原因是我可以将新行链接到产生它的行（并且不能保证它们是连续的）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-21T20:34:47.707

你的意思是最后一个自动增量ID？

```
<?php
$link = mysql_connect('localhost', 'mysql_user', 'mysql_password');
if (!$link) {
    die('Could not connect: ' . mysql_error());
}
mysql_select_db('mydb');

mysql_query("INSERT INTO mytable (product) values ('kossu')");
printf("Last inserted record has id %d\n", mysql_insert_id());
?> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-21T20:35:39.187

你要[`mysql_insert_id()`](http://us2.php.net/manual/en/function.mysql-insert-id.php)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-21T20:35:46.427

你的意思是你刚刚插入到表中的记录的 ID，如果是这样，你正在寻找[mysql_insert_id](http://uk.php.net/manual/en/function.mysql-insert-id.php)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-21T20:35:53.463

看看[http://us3.php.net/mysql_insert_id](http://us3.php.net/mysql_insert_id)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-21T20:37:44.253

使用 mysql_insert_id 函数... [http://php.net/mysql_insert_id](http://php.net/mysql_insert_id)

请原谅将“插入”转换为斜体的下划线......点击链接，你应该没问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T20:36:09.343

您在 My SQL 中有 LAST_INSERT_ID()（在 ms sql 中有 @@IDENTITY），在 php 中有 mysql_insert_id。

不过，就个人而言，我尽量避免自动递增/标识列并以其他方式生成我的 id。除其他原因外，因为它们使插入多个表变得更加困难。

/乙

# php - 我下载的php分页类给了我错误

> ID：669953
> 
> 赞同：0
> 
> 时间：2009-03-21T20:36:19.887
> 
> 标签：php

[这是我使用http://www.goodphptutorials.com/out/Simple_PHP_MySQL_Pagination](http://www.goodphptutorials.com/out/Simple_PHP_MySQL_Pagination)的脚本

这是我放在页面上的代码（不包括所有其他代码）

```
//pagination
$page = 1;

// how many records per page
$size = 10;

// we get the current page from $_GET
if (isset($_GET['page'])){
    $page = (int) $_GET['page'];
}

// create the pagination class
$pagination = new Pagination();
$pagination->setLink("listing.php?page=%s");
$pagination->setPage($page);
$pagination->setSize($size);
$pagination->setTotalRecords($total_records); 
```

我的查询看起来像这样

```
$query = mysql_query("select * from tbl_listing ".$pagination->getLimitSql()) or die(mysql_error()); 
```

我得到的错误是这个

```
Notice: Undefined variable: total_records in D:\wamp\www\lolallday\admin\listing.php on line 25 
```

第 25 行是这样的： $pagination->setTotalRecords($total_records);

并且分页链接不显示。有谁知道可能是什么问题？我想不通。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T20:43:01.667

$total_records 需要分配表中的记录总数。对表执行“select count(*) from x”查询以获取记录总数，并将其初始化为该值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T20:40:45.183

您收到此错误是因为 $total_records 未初始化。初始化它或降低error_reporting。

编辑：通过初始化我的意思是它的值从未被分配（教程似乎有点不完整）

# sql - 我应该如何将数据从“糟糕”的数据库设计迁移到可用的设计？

> ID：669957
> 
> 赞同：8
> 
> 时间：2009-03-21T20:38:22.223
> 
> 标签：sql, sql-server, refactoring, rdbms, normalization

我继承的当前项目主要围绕一个未规范化的表。有一些标准化的尝试，但没有设置必要的限制。

示例：在 Project 表中，有一个客户名称（以及其他值），还有一个客户表，其中仅包含客户名称 [任何地方都没有键]。客户表仅用作在添加新项目时为用户提供的值池。客户表上没有主键或外键。

诸如此类的“设计模式”在数据库的当前状态和使用它的应用程序中很常见。我可以使用的工具是 SQL Server 2005、SQL Server Management Studio 和 Visual Studio 2008。我最初的方法是手动确定哪些信息需要规范化并运行 Select INTO 查询。有没有比个案更好的方法，或者无论如何这可以自动化？

**编辑：** 另外，我发现“工作订单号”不是 IDENTITY（自动编号，唯一）字段，它们是按顺序生成的，并且对于每个工作订单都是唯一的。现有编号中也有一些空白，但都是独一无二的。这是编写存储过程以在迁移之前生成虚拟行的最佳方法吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-21T21:07:42.823

迁移到可用设计的最佳方法是什么？**小心**

除非您愿意破坏（并修复）当前使用数据库的每个应用程序，否则您的选择是有限的，因为您无法对现有结构进行太多更改。

在开始之前，请仔细考虑您的动机 - 如果您有一个现有问题（要修复的错误，要进行的增强），那么请慢慢进行。然而，为了获得别人不会注意到的改进而在工作的生产系统上胡闹是不值得的。请注意，这可能对您有利 - 如果存在现有问题，您可以向管理层指出解决问题的最具成本效益的方法是以*这种*方式更改数据库结构。这意味着您对更改有管理支持 - 如果某些东西变成梨形，则（希望）他们的支持。

一些实际的想法...

**一次进行一项更改**……而且**只有**一项更改。在继续之前，请确保每个更改都是正确的。古老的谚语“两次测量，一次切割”是相关的。

**自动化 Automate Automate** ...永远不要使用 SQL Server Management Studio 对生产系统进行“实时”更改。编写一次性执行整个更改的 SQL 脚本；**针对数据库副本**开发和测试这些，以确保您得到正确的结果。不要将生产环境用作测试服务器——你可能会不小心对生产环境运行脚本；使用专用的测试服务器（如果数据库大小在 4G 以下，请使用在您自己的机器上运行的 SQL Server Express）。

**备份**......任何脚本的第一步都应该是备份数据库，这样如果出现问题，您就有办法回去。

**文档**...如果有人在十二个月内来找您，询问他们应用程序的功能**X**为何损坏，您将需要对数据库所做的确切更改的历史记录，以帮助诊断和修复。第一个好的步骤是保留所有更改脚本。

**键**...在数据库中保持主键和外键抽象而不通过应用程序显示通常是一个好主意。在业务层面看起来像钥匙的东西（比如您的工作订单号）有一个令人不安的习惯，即出现异常。将您的键作为具有适当约束的附加列引入，但不要更改现有键的定义。

祝你好运！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T21:04:43.563

1.  按照您认为应该构建的方式创建新数据库。
2.  在新数据库中创建一个 importError 表，其中包含“oldId”和“errorDesc”等列
3.  编写一个简单、程序化、易读的脚本，尝试从旧结构中选择一行并将其插入到新结构中。如果插入失败，请在 importError 表中记录尽可能具体的错误（特别是插入失败的*原因）。*
4.  运行脚本。
5.  验证新数据。检查是否有错误记录到 importError 表中。如果数据无效或有错误，重构您的脚本并再次运行它，可能在必要时修改您的新数据库结构。
6.  重复步骤 1-5，直到您拥有可靠的转换脚本。

此过程的结果将是您拥有： a) 一个新的数据库结构，该结构已针对旧结构进行验证并针对“实用主义”进行了测试；b）您可能需要编写代码的潜在问题的日志（例如您无法通过转换修复的错误，因为它们需要您不想要的架构中的让步）

（我可能会注意到，用您选择的脚本/编程语言而不是 SQL 来编写脚本会很有帮助。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T20:56:15.533

我想不出一种明智的方式来自动化这个......如果你希望输出有用的话，一些人工输入是这种重构的关键。

重新工单号；假设您希望它继续作为 IDENTITY 列；您能否填充数据，找到最大的，然后使用 ALTER TABLE 使其成为 IDENTITY？我手头没有任何 TSQL 工具，所以很遗憾，我无法测试。或者，只需将其视为*natural key*。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T21:21:52.883

我建议使用存储过程来帮助翻译过程。

具体来说：

1.  将代码中使用的查询一一替换为存储过程。作为替换的一部分，直接针对存储过程编写单元（或集成）测试。考虑一个代码级`StoredProcs`帮助器类来整合那里的数据库访问。
2.  在所有查询都是存储过程之后，您可以重构数据库，使用这些单元测试来确保您没有更改预期的行为。
3.  附加优势：您将拥有这些单元测试以防止将来出现故障。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T22:11:49.767

您没有说是否需要保留当前的应用程序界面，或者您是否打算重写应用程序中的任何查询。

无论哪种方式，我都会

*   设计新模式
*   编写 T-SQL 批处理，在必要时使用游标来迁移数据

游标虽然不是操作查询的首选，但非常适合这种类型的应用程序，因为您可以以非常结构化的方式完成任务。这些脚本往往非常易读，当它不能立即工作并且您已经经历了几次迭代时，这一点很重要。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T22:12:29.237

您可以使用作为 SQL Server 2005 一部分的 SQL Server Integration Services (SSIS) 来帮助您进行迁移。它用于将数据从一种形式传输到另一种形式：

[http://en.wikipedia.org/wiki/SQL_Server_Integration_Services](http://en.wikipedia.org/wiki/SQL_Server_Integration_Services) [http://www.microsoft.com/sqlserver/2005/en/us/integration-services.aspx](http://www.microsoft.com/sqlserver/2005/en/us/integration-services.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-15T19:58:34.877

只是添加一个简单的提示。当您将实体关系图放在您面前的一张 A4 或 A3 上时，适当的规范化将意味着没有多对多的关系。检查这[本书或至少该网站](http://databaserefactoring.com/)。

# fortran77 - 如何将代码从 Fortran77 转换为 Visual Fortran？

> ID：669958
> 
> 赞同：-1
> 
> 时间：2009-03-21T20:38:39.460
> 
> 标签：fortran77

我需要将代码从 Fortran77 转换为 Compaq Visual Fortran。可能吗？如果“是”：是否也可以将结果保存为可以在 EXCEL 2003 中导入的形式？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T22:04:44.387

有几个 fortran 标准；fortran77、90、95、2003 和 2008 即将推出。“Visual fortran”不是标准的名称，而纯粹是 Compaq（现在是 Intel）的编译器系列的商业名称。由于他们添加了一个 IDE，因此他们将其命名为“Visual”。由于 fortran 向后兼容，因此 fortran77 成为 fortran90 标准的子集（意思是，fortran90 包括整个 f77 标准）。F95 对标准进行了一点扩展，保持了向后兼容性。

因此，除了尝试“现代化”代码语法本身之外，无需更改任何内容。由于我见过的大多数 f77 代码都运行得非常高效，因此我很少看到需要重写。

Compaq 的编译器是该系列的一部分：Microsoft Fortran Powerstation 1.0 --> 然后是 4.0 --> Digital 的第 5 版 --> Compaq 和现在的 Intel 的 Visual Fortran，目前是第 11 版。它是一个相对稳定和高质量的编译器系列，在 fortran 用户中很受欢迎。

关于最后一个问题，MS Excel 可以通过导入读取文本文件，这些文本文件可以用 fortran 编写。如果您正在考虑直接编写 .xls 文件，那么到目前为止我还没有看到可以做到这一点的库（如果您知道的话，请给我一个链接）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T20:59:45.777

CVF 是一个 Fortran 95 编译器，而 Fortran 77 或多或少是 F95 的一个子集，所以是的，这当然是可能的。您的实际问题是什么，或者您到底想做什么？

是的，您当然可以以 excel 可以导入的格式输出数据。

另请注意，CVF 在多年前就已停产。

# sqlite - SQLite - 对表进行排序

> ID：669964
> 
> 赞同：8
> 
> 时间：2009-03-21T20:43:16.313
> 
> 标签：sqlite

我在 SQLlite 中有一个数据库，我想按字母顺序对表进行排序。我该怎么做？有没有办法只使用 SQLite 对条目进行排序，还是我必须先将表读入数组，对其进行排序，然后再将其写入数据库？

这是我的查询：“SELECT entry FROM table WHERE id=?” 我需要使用此语句从表中获取数据，以便一次只获取一个条目。

提前谢谢你，伊利亚。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-21T20:46:50.330

```
'Select name from table order by name asc' 
```

'asc' 是升序，将按字母顺序为您提供文本字段，相反，'desc' 将以相反的字母顺序提供给您。

编辑：作为一般规则，您应该让数据库进行排序。下面的帖子是相关的，可以说几乎是一样的。您可能会发现它很有帮助：

[PHP/SQL：ORDER BY 或排序（$array）？](https://stackoverflow.com/questions/655226/php-sql-order-by-or-sortarray)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-29T12:06:14.153

还值得强调的是，任何 SQL 数据库表中的数据顺序，或使用不包含 order by 子句的查询从此类表中检索的数据，都没有定义。

在实践中，直接读取没有 order by 的表将以某种固定顺序检索数据，并且通常是 insert 的顺序。然而，依赖这一点*总是*一个错误，尽管这种错误经常令人震惊。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-29T11:21:56.503

如果您想在不区分大小写或使用特定语言环境（不是英语）的情况下对表进行排序，则必须将排序规则添加到您的 sqlite。[这](https://stackoverflow.com/questions/611459/how-to-sort-text-in-sqlite3-with-specified-locale)是如何做到这一点的示例。

# sqlite - 使用 insert into database.table1 select * from table2 where id=some_value;

> ID：669971
> 
> 赞同：2
> 
> 时间：2009-03-21T20:49:15.083
> 
> 标签：sqlite

我想将数据库中的表中的一行复制到另一个数据库中的相同表中。出于测试目的，我创建了这个：

```
CREATE TABLE stuff  (absid integer primary key, otherfield string ); 
```

和表`'stuff'`在两个数据库中如上，`testdb1`和`testdb2`。然后我将两行放入`'stuff'`in `testdb1`。然后，我可以从命令行将一行从一个数据库复制到另一个数据库，因此：

```
prompt> sqlite3 testdb1

sqlite> attach database testdb2 as testdb2;

sqlite> insert into testdb2.stuff select * from stuff where absid=2;

sqlite> ^d

prompt> 
```

到现在为止还挺好。但是：在我真正想要真正做到这一点的应用程序中，很可能会出现键冲突。例如，如果我使用上述序列将行复制回`testdb1`，我得到：

```
SQL error: PRIMARY KEY must be unique 
```

我想要发生的是，当复制行时，如果存在冲突，则会自动选择一个新的唯一absid。有没有办法可以用`select * ...`上面更复杂的方法来指定它？

我想我可以通过创建另一个具有相同表但没有主键约束的数据库（例如在内存中）并分两步进行复制（将absid设置为null）来解决这个问题，但我更喜欢如果存在更聪明的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-21T20:55:28.143

您可以指定列，省略主键列，插入的新行将激活自动键生成。例如，假设主键在 column 中`col1`，并且`col2`通过`col4`的列是非键列，试试这个：

```
sqlite> insert into testdb2.stuff (col2, col2, col4) 
  select col2, col3, col4 from stuff where absid=2; 
```

不幸的是，这意味着您不能使用“ `*`”通配符。SQL 中无法使用通配符来表示“除我指定的列之外的所有列”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-04T10:57:29.893

最后，我制作了一个内存数据库，除了省略“主键”外，它具有相同的表。我在内存数据库中执行了第一个“insert into mytable select * from ...”，然后将 absid 设置为 null，然后将第二个“insert into ...”设置为目标数据库。这样我就复制了行并使用了新的键值。

尽管还有第二步，但整个操作（在我的应用程序中）并没有通过大量的行来完成，因此效率成为可维护性的次要因素。

# flash - 如何获得仍在加载的 Sound 对象的最终长度？

> ID：669974
> 
> 赞同：5
> 
> 时间：2009-03-21T20:51:39.213
> 
> 标签：flash, actionscript-3, audio, mp3

我在 ActionScript 3 中创建了一个基本的 MP3 播放器。我有一个基本的进度条来指示歌曲的播放量。进度计算为在 0 和 1 之间标准化的小数百分比，如下所示：

```
var progress:Number = channel.position / sound.length; 
```

问题是，如果音频仍在加载/缓冲 sound.length 不正确。这会导致我的进度条四处跳动，甚至向后移动，直到声音完全加载并且 sound.length 不再改变。

确定仍在加载的声音对象的最终长度的最佳方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-21T22:29:38.867

至少有两种选择：

1：将进度条保持在 0%，在声音完全加载之前不要移动它。那是：

```
sound.addEventListener(Event.COMPLETE, onSoundComplete);

private function onSoundComplete(event:Event):void {
    // Calculate progress
} 
```

2：基于已加载文件百分比的近似百分比。像这样的东西：

```
private var _sound:Sound = /* Your logic here */;
private var _channel:SoundChannel = _sound.play();

_sound.addEventListener(ProgressEvent.PROGRESS, onSoundProgress);

private function onSoundProgress(event:ProgressEvent):void {
    var percentLoaded:Number = event.bytesLoaded / event.bytesTotal;
    var approxProgress:Number
        = _channel.position / _sound.length * percentLoaded;
    // Update your progress bar based on approxProgress
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T09:02:51.887

如果声音已被正确[标记，您还可以通过其](http://en.wikipedia.org/wiki/ID3)[ID3](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/media/Sound.html#event:id3)标签找出声音的长度。

# lisp - 使用 ASDF 启动 Hunchentoot

> ID：669976
> 
> 赞同：8
> 
> 时间：2009-03-21T20:53:49.817
> 
> 标签：lisp, packages, common-lisp, startupscript, hunchentoot

我正在使用 Hunchentoot（在 SBCL 和 Linux 上）开发一个 Web 应用程序，通常我只是从 Emacs（SLIME）运行它，但对于部署，我想要一些更容易自动化的东西。所以我试图弄清楚 ASDF，因为这似乎是现在每个人都在使用的东西。

myapp.asd：

```
(in-package #:asdf)
(defsystem :myapp
  :name "my app"
  :depends-on ("hunchentoot")
  :components ((:file "package")
               (:file "server" :depends-on ("package")))) 
```

包.lisp：

```
(defpackage myapp
  (:use :cl)) 
```

服务器.lisp：

```
(setq hunchentoot:*dispatch-table*
      (list (hunchentoot:create-static-file-dispatcher-and-handler "/foo" "foo")))
(hunchentoot:start-server :port 8705) 
```

如果我尝试手动加载它：

```
$ sbcl
* (require 'asdf)
* (asdf:operate 'asdf:load-op 'myapp) 
```

它加载并编译了一大堆函数，然后就停止了。Hunchentoot 没有运行，提示不接受输入。我不知道它认为它处于什么状态：打印的最后几行是：

```
STYLE-WARNING: Implicitly creating new generic function STRINGIFY-COOKIE.
STYLE-WARNING: Implicitly creating new generic function DISPATCH-REQUEST.
STYLE-WARNING: Implicitly creating new generic function WRITE-HEADER-LINE. 
```

有没有办法使这项工作？（坦白：我真的不太了解 ASDF 或 Common Lisp 包，尽管阅读了很多小时。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T19:38:05.750

# 从命令行运行 Lisp 应用程序

许多（不是全部）Lisp 实现支持保存图像（或保存世界或转储）机制，该机制将封装代码体并在启动时运行函数。正如另一位海报所说，这些机制是特定于平台和供应商的。

大多数 Lisp 实现（全部？）都有命令行界面。因此，部署 Lisp 应用程序的传统方法是在 Lisp 周围包装一个 shell 脚本。该脚本必须设置程序环境并传递命令行参数。通常，运行时上下文包括要加载的应用程序文件（通过 ASD 或 LOAD-FILE）以及要评估的一个或多个表单或要运行的函数。

## 使用/扩展 clbuild

您可以推出自己的脚本，也可以重复使用某些现有技术。看看[clbuild](http://common-lisp.net/projects/clbuild/ "clbuild")，它很有用，有几个原因。（有关 clbuild 功能和可移植性的更多信息，请参见下文。）

您可以扩展 clbuild 以使用命令行参数运行您自己的应用程序。例如，要加载“myapps”系统并运行函数“myapp1:start”，您将调用 clbuild，如下所示：

```
clbuild run any :myapps "\\(myapp1:start 1 2 3\\)" 
```

注意括号的字符转义语法；这是大多数命令解释器所需要的。

另一种方法是从文件重定向标准输入。例如：

```
clbuild run any :myapps < commands.lisp 
```

## clbuild 功能和可移植性

clbuild 最常用于安装和运行开源 CommonLisp 库。

它是一个 bash 脚本，因此具有很高的可移植性。下载工具依赖于 CVS、Subversion、darcs、git 和 Mercurial 等程序。

默认情况下 clbuild 运行 sbcl 但很容易将其配置为运行另一个 Lisp，例如*(shameless plug)* [Clozure CL (ccl)](http://trac.clozure.com/openmcl)。复制并编辑`clbuild.conf.default`以指向您要使用的 Lisp 可执行文件。`clbuild.conf``clbuild.conf`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-22T10:10:40.837

您的示例对我有用，至少修改为可以与当前的 Hunchentoot 1.0.0 一起使用，但这只是更改`(hunchentoot:start-server :port 8705)`为`(hunchentoot:start (make-instance 'hunchentoot:acceptor :port 8705))`.

在任何情况下，尽管可能，您实际上不应该从 ASDF 加载的内部文件中运行东西。它的作用类似于构建系统，我认为`make`启动网络服务器并不常见......

对于部署，请参见[cl-launch](http://www.cliki.net/cl-launch)、 sbcl[命令行选项](http://www.sbcl.org/manual/Toplevel-Options.html#Toplevel-Options)，特别是`--eval`，或[保存图像](http://www.sbcl.org/manual/Saving-a-Core-Image.html#Saving-a-Core-Image)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-22T11:11:43.233

我要做的是创建一个文件，为我的 Web 应用程序加载 ASDF 系统定义，然后启动 Hunchentoot 并按照应有的方式设置所有内容。然后使用 sbcl --load start-stuff 运行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-10-30T07:27:12.750

看看这里：http: [//xach.livejournal.com/278047.html](http://xach.livejournal.com/278047.html)

我自己也是个新手，Zach Beane 的这篇博客文章将拼图放在了一些地方。他解释了如何使用 ASDF 启动一个小项目、放置什么、如何尝试以及如何将其构建为二进制文件。伟大的底漆。

读完你将在 .asd 中使用 ":serial t" 之后，将启动 Hunchentoot 移动到一个函数，在 REPL 中尝试它并为你的应用程序构建一个二进制文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-23T12:35:33.957

您应该避免将任何逻辑放在 asd 文件中。您可以将它们视为简单的 makefile。您需要的是一种保存 lisp 图像的方法，该图像将在启动时启动您的服务器实例。这取决于平台，您需要搜索您的 lisp 实现文档。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T21:03:49.977

我知道的比你还少，但这个链接似乎很相关：[http](http://common-lisp.net/pipermail/tbnl-devel/2008-November/004455.html) ://common-lisp.net/pipermail/tbnl-devel/2008-November/004455.html 。显然只是在 SLIME 中运行它（有点）毕竟不是一个糟糕的主意。通过谷歌搜索“部署 hunchentoot”找到。

# java - Swing 组件在大量更新时闪烁

> ID：669979
> 
> 赞同：4
> 
> 时间：2009-03-21T20:56:15.253
> 
> 标签：java, multithreading, swing, flicker, jtextpane

我在某处有几千行代码，我注意到当我更新太多 JTextPane 时它​​会闪烁。我在这里写了一个简化版本：

```
import java.awt.*;
import javax.swing.*;

public class Test
{
    static JFrame f;
    static JTextPane a;
    static final String NL = "\n";

    public static void main(String... args)
    {
        EventQueue.invokeLater(new Runnable(){
        public void run()
        {
        f = new JFrame();
        f.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        f.setVisible(true);
        f.setSize(400, 300);
        f.setLocationRelativeTo(null);

        a = new JTextPane();
        f.add(new JScrollPane(a));

        new Thread(new Runnable(){
            public void run()
            {
                int i = 0;
                StringBuffer b = new StringBuffer();
                while(true)
                {
                    b.append(++i+NL);
                    a.setText(b.toString());
                    a.setCaretPosition(b.length());
                    try{Thread.sleep(10);}catch(Exception e){}
                }
            }
        }).start();
        }
        });

    }
} 
```

这是一个终端 (cmd) 样式的 GUI 组件——

我想我已经在这里做了所有我可以做的优化，包括`\n`作为一个最终变量，所以它不会被构造数百次。尽管如此，闪烁是明显且不可接受的。几分钟后，组件完全冻结。我必须非常快速地更新组件，并且更新时窗格必须滚动到底部。

我一直在考虑从头开始制作我自己的 JTextPane 版本，但我想看看你们是否有更简单的解决方案。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-22T02:54:41.493

您的部分错误是您正在从事件线程外部访问 Swing 组件！是的，[setText()](http://java.sun.com/javase/6/docs/api/javax/swing/JEditorPane.html#setText(java.lang.String))是线程安全的，但 Swing 方法不是线程安全的，除非它们明确声明为这样。因此，[setCaretPosition()](http://java.sun.com/javase/6/docs/api/javax/swing/text/JTextComponent.html#setCaretPosition(int))不是线程安全的，必须从事件线程访问。这几乎肯定是您的应用程序最终冻结的原因。

注意： `JTextPane`从 继承其`setText()`方法`JEditorPane`和`setCaretPosition`从继承其方法`JTextComponent`，这解释了上一段中的链接不会转到[`JTextPane`](http://java.sun.com/javase/6/docs/api/javax/swing/JTextPane.html)JavaDoc 页面。

为了线程安全，您至少需要`setCaretPosition()`从事件线程中调用，您可以使用如下代码执行此操作：

```
SwingUtilities.invokeAndWait(new Runnable() {
  public void run() {
    a.setText(b.toString());
    a.setCaretPosition(b.length());
  }
} 
```

而且由于您必须`setCaretPosition()`从事件线程中调用，您还不如`setText()`从同一个地方调用。

您可能不需要手动设置插入符号的位置。查看[JTextComponent](http://java.sun.com/javase/6/docs/api/javax/swing/text/JTextComponent.html)的 JavaDoc 中的“插入符号更改”部分。

最后，您可能想查看一系列两篇文章：

*   [更快的 JTextPane 文本插入（第一部分）](http://javatechniques.com/blog/faster-jtextpane-text-insertion-part-i/)
*   [更快的 JTextPane 文本插入（第二部分）](http://javatechniques.com/blog/faster-jtextpane-text-insertion-part-ii/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-21T21:12:33.453

不确定这是否可行，但您可以尝试使用`insertString()`文本窗格`Document`实例的方法。我会尝试在文档末尾有一个空格，并将插入符号放在该空格之后；但是当你插入一个字符串时，将它插入到空格之前。这样插入符号位置将自动保留在文档的末尾。

我认为文本窗格可能会被重绘两次，一次是在您调用时`setText()`，一次是在您调用时`setCaretPosition()`，这可能会导致闪烁。不过不确定（自从我使用 Swing 以来已经有一段时间了）。

# c# - 退出时杀死进程

> ID：669981
> 
> 赞同：2
> 
> 时间：2009-03-21T20:56:31.650
> 
> 标签：c#, .net, locking

我的项目有一个创建流程的对象。它是这个对象的 Dispose 函数，它会杀死进程（或试图）。但是，如果程序崩溃，它会使进程继续运行并且不会清理。这会导致程序下次失败，因为它尝试再次启动该进程并且无法锁定它。

我怎样才能确保这个进程被杀死？`using`我总是使用在一个块中创建进程的对象

作为参考，我使用的是 C# 和 .NET 3.5

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-21T21:02:08.483

定义“崩溃”；有不同级别的崩溃...例如，如果某些事情主动杀死了您的进程，您将几乎没有机会运行任何 Dispose/finalizer 等 - 但如果您的线程优雅地展开（即使通过异常），您应该没问题（因为你正在使用`using`）。你能澄清一下设置是什么吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-21T21:11:49.570

我知道这会让我大喊大叫，但是 Enviroment.Exit() 怎么样。这应该会杀死一切，每次=）尽管执行上述选项仍然更好。

还：

在 Program.cs 中，在调用 Application.Run(Form) 之前，执行以下操作：

AppDomain.CurrentDomain.UnhandledException += new UnhandledExceptionEventHandler(CurrentDomain_UnhandledException);

然后放入一个类似这样的处理程序：

```
 static void CurrentDomain_UnhandledException(object sender, UnhandledExceptionEventArgs e)
    {
        try
        {
            String CurrentThreadName = System.Threading.Thread.CurrentThread.Name;

            if (e.IsTerminating)
                Logger.Log("Program", 0, String.Format("Received fatal unhandled exception on '{0}' thread.  Exception will follow.", CurrentThreadName), MsgCategory.Critical, 50);
            else
                Logger.Log("Program", 0, String.Format("Received unhandled exception on '{0}' thread.  Exception will follow.", CurrentThreadName), MsgCategory.Error, 25);

            if (e.ExceptionObject != null)
                Logger.LogException("Program", String.Format("Unhandled System Exception on '{0}' thread.", CurrentThreadName), 50, (Exception)e.ExceptionObject);
        }
        catch
        {
        }
        if (e.IsTerminating)
        {
            Exception ThisException = (Exception)e.ExceptionObject;
            String CurrentThreadName = System.Threading.Thread.CurrentThread.Name;
            MessageBox.Show(
                    String.Format(Localization.GetString("fatal_error"), ThisException.GetType().ToString(), ThisException.Message, ThisException.StackTrace, CurrentThreadName)
                    , Localization.GetString("dialogtitle")
                    , MessageBoxButtons.OK
                    , MessageBoxIcon.Error
                    , MessageBoxDefaultButton.Button1);
        }
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-21T21:30:43.237

如果您想确保子进程终止，请考虑创建一个单独且更简单的看门狗进程，观察进程空间以终止任一进程。使其防弹通常更容易。无法保证在**所有**情况下都执行清理代码。

但是，您并没有真正提供有关如何创建子进程的足够上下文，以允许就如何设计看门狗以了解父进程和子进程提供任何相关建议。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T21:10:30.757

您真正想要的是双向进程监控，以便如果父进程或子进程死亡，您可以采取适当的措施。最简单的方法是让他们在计时器上相互 ping 一次（每 30 秒，例如，您必须根据自己的需要进行调整），如果在您发送下一个 ping 时没有响应，那么您可以假设另一个进程已死亡、锁定或以其他方式停止正常运行。

如果父母停止响应，孩子应该退出。如果孩子停止反应，杀死它并开始一个新的。

如何实现 ping 留给读者作为练习，但任何 IPC 机制都可以——窗口消息、RPC 调用、管道……任何你喜欢的东西。把事情简单化; 我确信.net 有一些你可以使用的东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T20:58:51.707

正在推出什么样的计划？即使第一个实例仍在运行，也应该可以启动第二个实例 - 启动进程不会锁定任何东西（除非程序本身做了一些奇怪的事情）。

对象是如何启动进程的？如果它有句柄，它应该能够通过调用[TerminateProcess](http://msdn.microsoft.com/en-us/library/ms686714(VS.85).aspx) API 立即终止它。

如果调用者死了，确保生成的进程会死，这是一个非常hacky的解决方案：调用[DebugActiveProcess](http://msdn.microsoft.com/en-us/library/ms679295(VS.85).aspx)，传递子进程ID。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T21:00:23.840

```
Foo bar = new Foo();
try
{
  bar.DoSomething();
}
catch // if required
{
}
finally
{
  if(bar != null)
  {
    bar.Dispose(); // code from finally clause is ~always executed
  }
} 
```

这等于

```
using(Foo bar = new Foo())
{
  // ..
} 
```

# c++ - 如何在 C++ 中实现进程全局变量？

> ID：669989
> 
> 赞同：4
> 
> 时间：2009-03-21T21:00:10.860
> 
> 标签：c++

通常在 .cpp 文件中使用变量会导致该变量全局可用，如下所示：

```
.h file:
extern int myGlobal;
void work();

.cpp file:
int myGlobal = 42;
void work(){ myGlobal++; } 
```

当 .cpp 文件放入静态库和多个共享库 (DLL) 或针对静态库的可执行链接时，每个都有自己的 .cpp 副本`myGlobal`。work() 将修改它自己的变量版本。

我现在的问题是：有没有办法获得一个进程范围的唯一变量或指向该变量的指针？与线程范围变量的线程本地存储类似。它不必独立于平台。如果它在 Win32 中工作，则加分 :)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-21T21:08:30.607

很简单：将进程中的所有 DLL 链接到公开变量的单个 DLL。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-21T21:11:04.580

要么不静态链接到它（将 myGlobal 粘贴在 DLL 中），要么只链接到静态库一次（可能更难实现）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-21T21:11:54.203

我建议你看看 Boost.Interprocess，尤其是[这个](http://www.boost.org/doc/libs/1_38_0/doc/html/interprocess/sharedmemorybetweenprocesses.html)关于在多个进程之间共享内存的页面。在那里你可以找到如何使用这个库来创建一个共享内存空间，打开一个已经创建的（实际上是“打开或创建”），根据你的需要调整它的大小并访问它。有一个简单的例子可以让你快速上手。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T15:07:38.033

也许这对于单个进程来说是多余的，但我已经使用[共享部分](http://support.microsoft.com/kb/125677)来实现类似于您所描述的内容。

# asp.net - app_themes css 文件和版本号

> ID：669991
> 
> 赞同：5
> 
> 时间：2009-03-21T21:01:02.573
> 
> 标签：asp.net, app-themes

我希望能够将版本号附加到位于我的 asp.net 网站的 app_themes 文件夹中的 css 文件中，以便对文件的修改将强制浏览器从服务器获取文件，而不是使用缓存。

css 输出路径看起来像 ~/app_themes/blue/blue.css?v=1234

知道如何在无需手动编辑文件名的情况下完成它吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-01-08T14:28:57.660

此处提供了更详细的解决方案：
[将 url 参数添加到 asp 主题文件夹中的 css 文件](https://stackoverflow.com/questions/2019807/add-url-parameter-to-css-file-in-asp-themes-folder)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-21T21:06:50.143

我会尝试这样的事情

```
<link 
  rel="stylesheet" 
  href="/app_themes/blue/blue.css?v=<%=Global.VERSION_NUM%>"> 
```

对所有 CSS 引用执行此操作，然后当您部署到实时站点时，您只需更改常量 VERSION_NUM

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-06-16T10:12:32.723

通过以下概念在 .net 应用程序中实现 css 版本控制将是简单且最佳的概念

```
<link href="<%="../../App_Themes/Base/css/main.css?v="+ DateTime.Now.ToString("yyyyMMddhhmmss") +""%>" rel="stylesheet" /> 
```

# ruby - Ruby 的 Pygame 等价物？

> ID：669994
> 
> 赞同：8
> 
> 时间：2009-03-21T21:03:07.360
> 
> 标签：ruby

我想知道是否有人知道 Ruby 的 PyGame 等价物。我见过 Ruby/SDL，我正在寻找更适合游戏的东西。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-22T08:27:43.877

还有可能很有趣的[gosu 。](http://www.libgosu.org/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-21T21:04:52.910

[http://sourceforge.net/projects/rubygame/](http://sourceforge.net/projects/rubygame/)

编辑：确实，链接已经改变：[http](http://rubygame.sourceforge.net/) ://rubygame.sourceforge.net/ （正如radioact1ve提到的）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-21T21:06:57.647

[http://rubygame.sourceforge.net/](http://rubygame.sourceforge.net/)

编辑：慢...

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-24T15:32:11.200

是的，gosu 是一个很棒的图书馆，在这里查看：[http ://www.libgosu.org/](http://www.libgosu.org/)*******************