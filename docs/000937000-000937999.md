# StackOverflow 问答 000937000-000937999

# python - 递归和返回语句

> ID：937000
> 
> 赞同：18
> 
> 时间：2009-06-01T21:55:29.350
> 
> 标签：python, recursion

我对 Python 和整个递归函数都很陌生，所以请原谅我的无知。

我正在尝试在 Python 中实现二叉搜索树并具有以下插入方法（从类中取出）：

```
def insert(self, key, root=None):
    '''Inserts a node in the tree'''
    if root == None:
        root = self.root
    if root.key == None:
        self._update(root, key)
        return 0
    else:
        tmp = root
        if key > tmp.key: # we work with the right subtree
            self.insert(key, root=tmp.right)
        elif key < tmp.key: # we work with the left subtree
            self.insert(key, root=tmp.left)
        else: # key already exists
            return 0 
```

我不确定这是否清晰可辨，但它会遍历树，直到达到 None 值并使用要插入的键更新节点。

现在，该方法运行良好且正确地从头开始创建 BST。但是 return 语句有一个问题，因为如果没有执行递归，它只会返回 0。

```
>>> bst.insert(10)
0
>>> bst.insert(15)
>>> bst.root.right.key
15
>>> 
```

“插入”根键再次以应有的方式返回 0（从第 15 行开始）。

```
>>> bst.insert(10)
0 
```

我不明白为什么会这样。如果我在第 6 行放置一个打印语句，它会正确执行，但它不会返回第一次插入之后的任何内容。为什么是这样？（我很确定我错过了一些关于 Python 和递归的基本信息）

谢谢你的帮助，

伊万

PS：我读过递归不是实现 BST 的最佳方式，所以我会研究其他解决方案，但在继续之前我想知道这个问题的答案。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-06-01T21:58:31.153

在您的递归行上，您不返回任何内容。如果您希望它返回 0，则应将它们替换为以下行：

```
return self.insert(key, root=tmp.left) 
```

而不仅仅是

```
self.insert(key, root=tmp.left) 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-06-01T22:09:20.400

你在一个函数里面，想要返回一个值，你会怎么做？你写

```
def function():
    return value 
```

在您的情况下，您想返回函数调用返回的值，所以您必须这样做。

```
def function():
    return another_function() 
```

不管你怎么做

```
def function():
    another_function() 
```

为什么你认为这应该有效？当然你使用递归，但在这种情况下你应该记住 Python 之禅，它简单地说：

> 特殊情况不足以打破规则。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-07-19T19:41:28.800

在递归情况下，您需要一个 return 语句。试试这个调整。

```
def insert(self, key, root=None):
    '''Inserts a node in the tree'''
    if root == None:
        root = self.root
    if root.key == None:
        self._update(root, key)
        return 0
    else:
        tmp = root
        if key > tmp.key: # we work with the right subtree
            return self.insert(key, root=tmp.right)
        elif key < tmp.key: # we work with the left subtree
            return self.insert(key, root=tmp.left)
        else: # key already exists
            return 0 
```

# c++ - Borland中的bcc32和bcc32ide有什么区别？

> ID：937018
> 
> 赞同：1
> 
> 时间：2009-06-01T22:00:20.823
> 
> 标签：c++, borland-c++

*   `bcc32`我们发现文件的方式和`bcc32ide`行为略有不同。
*   `bcc32ide`工作和`bcc32`崩溃。

`bcc32ide`切换到我们的自动化构建会有任何有害的副作用吗？

另外，这两个编译器之间有什么区别（除了一个崩溃和一个不崩溃）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-12-16T06:03:13.983

请参阅*[Re：BCB 6 编译器速度缓慢以及如何显着加快速度](http://www.codenewsfast.com/cnf/article/0/waArticleBookmark.6088114)*以获得解释。

引用：

> bcc32ide.exe 是一个 bcc32.exe，但它使用 IDE 编译器。例如，某些编译器断言不会由 IDE 编译器引发，而是由 bcc32.exe 引发。因此，用 bcc32ide.exe 替换 makefile 中的 bcc32.exe 将允许编译在 IDE 中编译的项目，但不能在控制台中编译。
> 
> bcc32ide.exe 还增加了一些额外的参数：
> 
> -automake 只编译修改过的文件
> -verbose 编译时输出当前编译的行号
> -pch=filename_pch.h 使用高级预编译头文件
> -FIfilename 强制包含（多个，用法类似-Iincludedir）
> 
> 并且它支持多个-进程共享访问高级 PCH 文件（mtbcc32.exe 需要）。

# asp.net - 你能有一个由字段列表组成的动态数据字段吗？

> ID：937020
> 
> 赞同：1
> 
> 时间：2009-06-01T22:00:35.517
> 
> 标签：asp.net, asp.net-dynamic-data

这是一个纯粹的理论问题（至少在我开始尝试实现它之前），但这里有。

我很久以前写了一个网络表单，其中有一个可配置的部分用于获取信息。基本上对于某些客户没有字段，对于其他客户最多有 20 个字段。我通过在页面生命周期中的正确时间动态创建字段并经历了很多令人头疼的事情来让它工作。

2 年后，我需要对这个 web 表单进行一些相当大的更新，并且有一些漂亮的新技术。我刚刚使用过 ASP.NET 动态数据，好吧，我刚刚想到了一个半疯狂的计划：

Ticket 对象与 ExtendedField 具有一对多的关系，为简洁起见，我们将这种关系称为 Fields。

使用它，想法是创建一个动态生成字段列表并显示它的 FieldTemplate。

这里的大问题可能是：

1) 单个字段模板可以解析为多个 Web 控件而不破坏事物吗？

2）动态数据可以以这种方式处理更新/插入多行吗？

3）几分钟前我有第三个问题，但同事打断了我，我忘记了。所以现在第三个问题是：第三个问题是什么？

所以基本上，这听起来像它可以工作还是我错过了一个更好/更明显的解决方案？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-08T14:10:12.507

您是否尝试过创建一个包含所有字段的“ListView”的 FieldTemplate？（ListView 将使用动态数据来确定为每个字段显示哪个 FieldTemplate。）

我不明白为什么这是不可能的。尽管“开箱即用”，您可能必须在新 FieldTemplate 的 ListView 的每一行上点击“编辑”才能编辑值。这就像用“订单详细信息”的内联列表替换订单列表中的“订单详细信息”链接。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-23T21:55:39.453

1.) 不是很好。您能想象仅使用一个用户控件（如 text.ascx）显示日期时间、整数、电话号码、网址等吗？为什么不使用多个字段模板并使用 UIHint 来指定每列的使用情况？

2.) 是的。

3.) 基本定义？

关于一对多关系，您可以查看动态数据中的 ListDetails.aspx 页面模板。希望这可以帮助。

# iphone - 支持 iphone a2dp 编解码器

> ID：937023
> 
> 赞同：1
> 
> 时间：2009-06-01T22:01:15.687
> 
> 标签：iphone, bluetooth

我正在环顾四周，看看 iphone 上的 a2dp 配置文件支持哪些音频编解码器（我猜是 3.0）。

aac、apt-x、mp3 等...

有人知道吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-21T03:02:03.313

据我所知，iPhone 仅实现了 SBC，尽管直接从 Apple 获得的信息并没有完全公开。（我想因为这只对配件硬件供应商很重要，而不是对平台开发人员。）

例如，请参阅[此论坛讨论](http://discussions.apple.com/thread.jspa?threadID=2087488)和[此博客文章](http://www.wirelessaudioblog.com/archives/532)（咆哮）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-08-08T02:03:11.063

自从第一次提出问题以来，这可能已经改变，但根据 2013 年的文档，iPhone 支持 AAC LC：
[https ://developer.apple.com/hardwaredrivers/BluetoothDesignGuidelines.pdf](https://developer.apple.com/hardwaredrivers/BluetoothDesignGuidelines.pdf)

# .net - 带有 Silverlight 的 OpenId

> ID：937037
> 
> 赞同：4
> 
> 时间：2009-06-01T22:04:41.110
> 
> 标签：.net, silverlight, openid

你的解决方案是什么？

有没有人使用 Silverlight 2 应用程序成功实现 OpenId？

OpenId 需要重定向到外部站点。我期待我的应用程序有一个漂亮的 Silverlighty 登录页面，但从表面上看这不会发生！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T05:31:11.000

这是一个有趣的问题。SL2 应用程序不得验证 OpenID 断言本身，而是将其传递给服务器进行验证。SL2 应用程序*可以*验证它，但随后消耗了 nonce，服务器无法重新验证它，但最终服务器必须验证它是安全的。因此，最有可能的登录应该发生在 SL2 应用程序出现之前，然后它可能会在已经存在的登录上下文中出现。

可能还有其他方法可以做到这一点，但是服务器作为断言验证者的上述限制是明确的。

# jquery - jQuery 中的 bind 和 live 方法有什么区别？

> ID：937039
> 
> 赞同：65
> 
> 时间：2009-06-01T22:05:33.840
> 
> 标签：jquery, bind, live

我很想知道绑定和实时函数之间的区别。

对我来说，它们似乎几乎相同。

我阅读[了 live/bind 方法的好处](https://stackoverflow.com/questions/748076/using-live-benefits-similar-to-bind)，但它并没有告诉我不同​​之处......

谢谢！

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2009-06-02T00:25:22.370

简而言之：`.bind()`仅适用于您当前在 jQuery 对象中选择的项目。`.live()`将适用于所有当前匹配的元素，以及您将来可能添加的任何元素。

它们之间的根本区别在于`live()`使用[事件冒泡](http://www.quirksmode.org/js/events_order.html)。也就是说，当您单击一个按钮时，该按钮可能存在于一个`<p>`、一个`<div>`、一个`<body>`元素中；所以实际上，您实际上是在同时点击所有这些元素。

`live()`通过将事件处理程序附加到*文档*而不是*元素*来工作。当您单击该按钮时，如前所述，文档会收到相同的单击事件。然后，它会查找事件所针对的元素行，并检查它们是否与您的查询匹配。

这样做的结果是双重的：首先，这意味着您不必继续将事件重新应用于新元素，因为它们会在事件发生时被隐式添加。但是，更重要的是（取决于您的情况），这意味着您的代码要轻得多！如果`<img>`页面上有 50 个标签并运行以下代码：

```
$('img').click(function() { /* doSomething */ }); 
```

...然后将该函数*复制*到每个元素中。但是，如果您有此代码：

```
$('img').live('click', function() { /* doSomething */ }); 
```

...然后该函数仅存储在一个位置（在文档上），并在事件发生时应用于与您的查询匹配的任何内容。

但是，由于这种冒泡行为，并非所有事件都可以这样处理。正如 Ichiban 所指出的，这些支持的事件是 click、dblclick、mousedown、mouseup、mousemove、mouseover、mouseout、keydown、keypress、keyup。

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2009-06-01T22:09:30.430

.bind() 将事件附加到在调用时存在或匹配选择器的元素。之后创建的任何元素或由于类更改而向前匹配的任何元素都不会触发绑定事件。

.live() 适用于现有和未来的匹配元素。在 jQuery 1.4 之前，这仅限于以下事件：click、dblclick mousedown、mouseup、mousemove、mouseover、mouseout、keydown、keypress、keyup

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-06-01T22:12:44.183

Bind 会将事件绑定到指定的模式，在您调用它时针对当前 DOM 中的所有匹配项。Live 会将事件绑定到当前 DOM 的指定模式以及 DOM 中的未来匹配项，即使它发生了变化。

例如，如果您绑定 $("div").bind("hover", ...) 它将应用于当时 DOM 中的所有“div”。如果您随后操作 DOM 并添加一个额外的“div”，它将不会绑定悬停事件。使用 live 而不是 bind 也会将事件分派到新的 div。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-01-13T13:18:32.817

很好的阅读：[http ://www.alfajango.com/blog/the-difference-between-jquerys-bind-live-and-delegate/](http://www.alfajango.com/blog/the-difference-between-jquerys-bind-live-and-delegate/)

现在（自 jQuery 1.7 起）已弃用 .on() 函数 - [http://api.jquery.com/on/](http://api.jquery.com/on/)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-06-01T22:13:05.837

想象一下这种情况：

1.  我有几个`<img>`元素。
    *   `$('img').bind('click', function(){...});`
    *   添加一些额外的图像（使用`get()`，或`html()`，任何东西）
    *   新图像没有任何约束力！！

当然，由于在您执行第 2 步时新图像不存在`$('img')...`，因此它没有将事件处理程序绑定到它们。

现在，如果你这样做：

1.  我有几个`<img>`元素。
    *   `$('img').live('click', function(){...});`
    *   添加一些额外的图像（使用`get()`，或`html()`，任何东西）
    *   新图像*确实*具有约束力！

魔法？只是一点点。事实上，jQuery 将一个通用事件处理程序绑定到 DOM 树中更高的另一个元素（正文？文档？不知道）并让事件冒泡。当它到达通用处理程序时，它会检查它是否与您的`live()`事件匹配，如果匹配，它们就会被触发，无论元素是在`live()`调用之前还是之后创建的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-06-01T22:17:47.573

除了他们所说的之外，我认为最好尽量坚持`bind`何时/何地，`live`只在必要时使用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-02-12T14:09:39.063

所有这些 jQuery 方法都用于将事件附加到选择器或元素。但它们都彼此不同。

**.bind()：**这是绑定事件最简单快捷的方法。但是 bind() 的问题在于它不适用于动态添加的匹配相同选择器的元素。bind() 仅将事件附加到当前元素而不是未来元素。除此之外，它在处理大量选择时也存在性能问题。

**.live()：**该方法克服了 bind() 的缺点。它适用于动态添加的元素或未来的元素。由于它在大页面上的性能不佳，从 jQuery 1.7 开始不推荐使用此方法，您应该停止使用它。使用此方法不正确支持链接。

[在这里](http://www.elijahmanor.com/2012/02/differences-between-jquery-bind-vs-live.html)了解更多

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-10T04:16:41.717

由于我自己的愚蠢而不得不进行一些调试后，我想补充一下。我将 .live() 应用于页面上的一类按钮，假设它只会呈现我试图传递查询字符串的正确 ID，并执行我想要对 ajax 调用执行的操作。我的应用程序动态添加了与库存项目关联的按钮。例如，向下钻取类别到“COKE”按钮以将可乐添加到您的订单中。再次从顶部向下钻取，并添加“BUDLITE” - 每次我希望通过 AJAX 调用将这些项目输入到表中。

**但是**，由于我将 .live() 绑定到整个按钮类，它会记住我所做的每个 ajax 调用并为每个后续按钮重新触发它！这有点棘手，因为我不太清楚 bind 和 live 之间的区别（上面的答案是关于它的水晶），所以我想我会把它放在这里以防万一有人在搜索这些东西.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-10-09T15:34:36.387

有一种方法可以获得现场效果，但它有点讨厌。

$(this).unbind('mouseout').bind('mouseout',function(){ });

这将清除以前的并重置新的。随着时间的推移，它对我来说似乎工作得很好。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-10-14T19:55:11.290

[这里讨论了](http://www.neeraj.name/blog/articles/882-how-live-method-works-in-jquery-why-it-does-not-work-in-some-cases-when-to-use-livequery)live 和 livequery 之间的区别。

# sql-server - SQL Server 中的 XML 问题

> ID：937040
> 
> 赞同：0
> 
> 时间：2009-06-01T22:05:50.187
> 
> 标签：sql-server, xml, sql-server-2005

在我的一个 sql 脚本中，我需要使用以下 xml 字符串执行存储过程

```
<Collection xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
    <Field>
        <Attributes>
            <Attribute Name="CODE1" IsRequired="true" Order="1" IsVisible="true"/>
            <Attribute Name="CODE2" IsRequired="true" Order="2" IsVisible="true"/>
        </Attributes>
        <Rows>
            <Row ProductState="5">
                <Items>
                    <Item Name="PROD1" SendCustomer="false"/>
                    <Item Name="PROD2" SendCustomer="false"/>
                </Items>
            </Row>
        </Rows>
    </Field>
</Collection> 
```

我从不同`Attribute`的表中获取和信息。`Item`我正在编写一个通用函数，您可以在其中传递一个 ID 并返回 SQL 脚本用来执行存储过程的 XML 字符串

有时，我需要覆盖某些元素的属性值，例如`SendCustomer`. 我最初的想法是将其反序列化为临时表，使用覆盖值更新临时表，然后将其序列化回 XML。

因此，基本上，整个过程归结为：

1.  查询表，在函数中序列化为XML
2.  反序列化 XML，存储在临时表中
3.  必要时覆盖值
4.  再次从表序列化到 XML

sql server 2005 中是否有更优雅的方式来完成整个过程？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-01T22:21:03.247

XML 数据类型实际上可以使用 XQuery 进行修改。请参阅[modify() 方法](http://msdn.microsoft.com/en-us/library/ms187093.aspx)。

```
declare @x XML;
select @x = N'<Collection xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns:xsd="http://www.w3.org/2001/XMLSchema">
    <Field>
        <Attributes>
                <Attribute Name="CODE1" IsRequired="true" Order="1" IsVisible="true"/>
                <Attribute Name="CODE2" IsRequired="true" Order="2" IsVisible="true"/>
        </Attributes>
        <Rows>
                <Row ProductState="5">
                        <Items>
                                <Item Name="PROD1" SendCustomer="false"/>
                                <Item Name="PROD2" SendCustomer="false"/>
                        </Items>
                </Row>
        </Rows>
    </Field>
</Collection>';

set @x.modify(N'replace value of 
    (/Collection/Field/Rows/Row/Items/Item[@Name="PROD2"]/@SendCustomer)[1]
    with "true"');

select @x; 
```

# sql - 如何在MYSQL中进行评论回复查询？

> ID：937042
> 
> 赞同：9
> 
> 时间：2009-06-01T22:05:52.403
> 
> 标签：sql, mysql, comments

我有评论回复（只到一级）功能。所有评论都可以有尽可能多的回复，但没有回复可以有更多的回复。

所以我的数据库表结构如下

```
Id    ParentId    Comment
1     0           this is come sample comment text
2     0           this is come sample comment text
3     0           this is come sample comment text
4     1           this is come sample comment text
5     0           this is come sample comment text
6     3           this is come sample comment text
7     1           this is come sample comment text 
```

在上述结构中，commentid、1（有 2 个回复）和 3（1 个回复）有回复。因此，要获取评论及其回复，一个简单的方法是首先获取所有 ParentId 为 0 的评论，然后通过运行 while 循环获取该特定评论 ID 的所有回复。但是，如果我对特定记录有大约 200 条评论，那似乎会运行数百个查询。

因此，我想进行一个查询，该查询将按以下顺序获取评论及其回复；

```
Id    ParentId    Comment
1     0           this is come sample comment text
4     1           this is come sample comment text
7     1           this is come sample comment text
2     0           this is come sample comment text
3     0           this is come sample comment text
6     3           this is come sample comment text    
5     0           this is come sample comment text 
```

如果有人想将它与评论查询一起使用，我的评论表中也有一个评论日期列。

所以最后我想通过使用一个 mysql 查询来获取所有评论及其回复。请告诉我我该怎么做？

谢谢

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-06-02T00:34:30.497

您可以在 ORDER BY 中使用表达式。尝试这个：

```
SELECT *
FROM comments
ORDER BY IF(ParentId = 0, Id, ParentId), Id 
```

如果 ParentId = 0，这将首先按 Id 排序，否则按 ParentId 排序。第二个排序标准是 Id，以确保按顺序返回回复。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T23:31:16.567

我强烈建议您重构您的数据库模式。主要问题是您试图将评论和回复视为同一件事，而它们简单不是同一件事。这迫使您进行一些困难的查询。

想象有两个表：[COMMENTS:(id, text)]，并在另一个表中回复评论 [REPLIES(id, commentid, text)]。以这种方式考虑时，问题似乎要容易得多。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2010-12-30T18:01:23.893

如果您/某人正在寻找简单的解决方案，那么它可能会有所帮助。

结构更改 - 我想您已经通过添加博客 ID 对其进行了更改，如果没有博客 ID，您如何说哪些评论是特定于博客的？

首先这样做，它不会对您的数据库造成任何损害，

```
update `tblcomments` set ParentId=Id where ParentId=0; 
```

然后按顺序获取博客评论和评论回复（评论 - 回复1，回复2......在评论下）

使用 bleow 查询

```
SELECT * 
FROM  tblcomments 
ORDER BY  ParentId ASC; 
```

干杯，-PM。

# linux - 新安装的 apache 将 html 内容作为文本提供

> ID：937043
> 
> 赞同：1
> 
> 时间：2009-06-01T22:06:08.347
> 
> 标签：linux, apache, ubuntu-9.04

我在 Ubuntu 上运行 Apache 实例并且遇到了这个问题： .HTML 内部带有真正 HTML 的文件被用作文本文件：

```
> **For eg. <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN"> <html>
> <body> <h1>Index to Butterthlies
> Catalogs</h1> 
```

等等等等**

我检查了 firebug 中的标题，果然页面是`plain\text`. 我想我可能错过了这个`mod_mime`模块，所以我尝试将它包含为这样的模块：

```
LoadModule mod_mime /usr/lib/apache2/modules/mod_mime.so
TypesConfig conf/mime.types 
```

其中`/usr/lib`... 路径包含`mod_mime.so`. 但这不起作用并给出以下错误：

> /usr/www/APACHE3/site.first/conf/httpd.conf 第 1 行的语法错误：无法在文件 /usr/lib/apache2/modules/mod_mime.so 中找到 API 模块结构“mod_mime”：/usr /lib/apache2/modules/mod_mime.so：未定义符号：mod_mime

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-11T20:17:43.593

将 LoadModule 行更改为如下所示：

```
LoadModule mime_module /usr/lib/apache2/modules/mod_mime.so 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-01T22:15:08.703

这么长的描述没用，最后一段就足够了。

从头开始重新安装你的 apache，你的安装有问题。

顺便说一句，从任何分发包安装的 apache 应该已经正确配置为提供 HTML 文件。

# c++ - 从 C++ 中的 HKEY 句柄确定注册表项的路径

> ID：937044
> 
> 赞同：20
> 
> 时间：2009-06-01T22:06:13.993
> 
> 标签：c++, registry, handle

给定 Windows 注册表项的句柄，例如由 ::RegOpenKeyEx() 设置的那些，是否可以确定该键的完整路径？

我意识到，在一个简单的应用程序中，您所要做的就是查找 5 或 10 行并阅读......但在像我正在调试的应用程序这样的复杂应用程序中，我感兴趣的密钥可以从一系列中打开的电话。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-06-02T00:09:29.017

使用`LoadLibrary`和`NtQueryKey`导出函数，如以下代码片段所示。

```
#include <windows.h>
#include <string>

typedef LONG NTSTATUS;

#ifndef STATUS_SUCCESS
#define STATUS_SUCCESS ((NTSTATUS)0x00000000L)
#endif

#ifndef STATUS_BUFFER_TOO_SMALL
#define STATUS_BUFFER_TOO_SMALL ((NTSTATUS)0xC0000023L)
#endif

std::wstring GetKeyPathFromKKEY(HKEY key)
{
    std::wstring keyPath;
    if (key != NULL)
    {
        HMODULE dll = LoadLibrary(L"ntdll.dll");
        if (dll != NULL) {
            typedef DWORD (__stdcall *NtQueryKeyType)(
                HANDLE  KeyHandle,
                int KeyInformationClass,
                PVOID  KeyInformation,
                ULONG  Length,
                PULONG  ResultLength);

            NtQueryKeyType func = reinterpret_cast<NtQueryKeyType>(::GetProcAddress(dll, "NtQueryKey"));

            if (func != NULL) {
                DWORD size = 0;
                DWORD result = 0;
                result = func(key, 3, 0, 0, &size);
                if (result == STATUS_BUFFER_TOO_SMALL)
                {
                    size = size + 2;
                    wchar_t* buffer = new (std::nothrow) wchar_t[size/sizeof(wchar_t)]; // size is in bytes
                    if (buffer != NULL)
                    {
                        result = func(key, 3, buffer, size, &size);
                        if (result == STATUS_SUCCESS)
                        {
                            buffer[size / sizeof(wchar_t)] = L'\0';
                            keyPath = std::wstring(buffer + 2);
                        }

                        delete[] buffer;
                    }
                }
            }

            FreeLibrary(dll);
        }
    }
    return keyPath;
}

int _tmain(int argc, _TCHAR* argv[])
{
    HKEY key = NULL;
    LONG ret = ERROR_SUCCESS;

    ret = RegOpenKey(HKEY_LOCAL_MACHINE, L"SOFTWARE\\Microsoft", &key);
    if (ret == ERROR_SUCCESS)
    {
        wprintf_s(L"Key path for %p is '%s'.", key, GetKeyPathFromKKEY(key).c_str());    
        RegCloseKey(key);
    }

    return 0;
} 
```

这将在控制台上打印密钥路径：

> 00000FDC 的密钥路径是 '\REGISTRY\MACHINE\SOFTWARE\Microsoft'。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-01T22:19:55.947

名义上没有，因为它只是一个句柄，而且我知道没有 API 可以让您在普通的 Windows API 中执行此操作。

然而，Native API 有很多功能，其中一些可以为您提供打开给定文件等的句柄，因此注册表可能有类似的东西。那和 SysInternals 的 RegMon 可能会做这样的事情，但恐怕你必须谷歌：/

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-01T22:40:32.380

您可以使用[RegSaveKey](http://msdn.microsoft.com/en-us/library/ms724917(VS.85).aspx)并将其写入文件，然后查看该文件。

或者，您可以保留 HKEY 到 LPCWSTR 的全局映射，并在打开它们时添加条目并随时进行查找。

您也可以使用 WinDBG / NTSD 中的 !reg 命令做一些事情，但您不能只给它 HKEY。你必须做一些其他的诡计才能得到你想要的信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-12-16T01:48:57.563

我很高兴找到这篇文章及其广受欢迎的解决方案。直到我发现我系统的NTDLL.DLL 没有NtQueryKeyType。

经过一番搜索，我在 DDK 论坛中遇到了 ZwQueryKey。

它在 C# 中，但这是对我有用的解决方案：

```
enum KEY_INFORMATION_CLASS
{
    KeyBasicInformation,            // A KEY_BASIC_INFORMATION structure is supplied.
    KeyNodeInformation,             // A KEY_NODE_INFORMATION structure is supplied.
    KeyFullInformation,             // A KEY_FULL_INFORMATION structure is supplied.
    KeyNameInformation,             // A KEY_NAME_INFORMATION structure is supplied.
    KeyCachedInformation,           // A KEY_CACHED_INFORMATION structure is supplied.
    KeyFlagsInformation,            // Reserved for system use.
    KeyVirtualizationInformation,   // A KEY_VIRTUALIZATION_INFORMATION structure is supplied.
    KeyHandleTagsInformation,       // Reserved for system use.
    MaxKeyInfoClass                 // The maximum value in this enumeration type.
}
[StructLayout(LayoutKind.Sequential)]
public struct KEY_NAME_INFORMATION
{
    public UInt32 NameLength;     // The size, in bytes, of the key name string in the Name array.
    public char[] Name;           // An array of wide characters that contains the name of the key.
                                  // This character string is not null-terminated.
                                  // Only the first element in this array is included in the
                                  //    KEY_NAME_INFORMATION structure definition.
                                  //    The storage for the remaining elements in the array immediately
                                  //    follows this element.
}

[DllImport("ntdll.dll", SetLastError = true, CharSet = CharSet.Unicode)]
private static extern int ZwQueryKey(IntPtr hKey, KEY_INFORMATION_CLASS KeyInformationClass, IntPtr lpKeyInformation, int Length, out int ResultLength);

public static String GetHKeyName(IntPtr hKey)
{
    String result = String.Empty;
    IntPtr pKNI = IntPtr.Zero;

    int needed = 0;
    int status = ZwQueryKey(hKey, KEY_INFORMATION_CLASS.KeyNameInformation, IntPtr.Zero, 0, out needed);
    if ((UInt32)status == 0xC0000023)   // STATUS_BUFFER_TOO_SMALL
    {
        pKNI = Marshal.AllocHGlobal(sizeof(UInt32) + needed + 4 /*paranoia*/);
        status = ZwQueryKey(hKey, KEY_INFORMATION_CLASS.KeyNameInformation, pKNI, needed, out needed);
        if (status == 0)    // STATUS_SUCCESS
        {
            char[] bytes = new char[2 + needed + 2];
            Marshal.Copy(pKNI, bytes, 0, needed);
            // startIndex == 2  skips the NameLength field of the structure (2 chars == 4 bytes)
            // needed/2         reduces value from bytes to chars
            //  needed/2 - 2    reduces length to not include the NameLength
            result = new String(bytes, 2, (needed/2)-2);
        }
    }
    Marshal.FreeHGlobal(pKNI);
    return result;
} 
```

我只是在以管理员身份运行时尝试过它，这可能是必需的。

结果的格式有点奇怪：`\REGISTRY\MACHINE\SOFTWARE\company\product`例如，而不是`HKEY_LOCAL_MACHINE\SOFTWARE\company\product`.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-05T01:08:45.050

对于`ntsd/windbg`：

`!handle yourhandle 4`

# jquery - 只获取文件的一部分

> ID：937046
> 
> 赞同：3
> 
> 时间：2009-06-01T22:06:28.813
> 
> 标签：jquery

我有一些非常简单的示例代码，如下所示：

```
$.ajax({
  url: 'demo2.htm',
  success: function(loadeddata){
    $("#loaded_data").html(loadeddata);
    alert('success');
  },
  error: function(){
    alert('failure');
  }
}); 
```

加载的数据当前返回所有内容。我需要的是只获取一个特定的 div 并将其设置为#loaded_data 的 html。

我怎么做？

谢谢！

编辑：

在尝试使用 .load() 时...

这是我在评论中写的。

谢谢，您更新的示例很棒。但是我不确定我的有什么问题。

这：有效

```
$("#loaded_data").load("demo2.htm #mydiv", function(text, status, request) {
    if(status == 'success') {
        alert('success');
    } else {
        alert('error');
    }
}); 
```

这个：

```
$("#loaded_data").load("demo5.htm #mydiv", function(text, status, request) {
    if(status == 'success') {
        alert('success');
    } else {
        alert('error');
    }
}); 
```

才不是。它只是挂起。没有demo5.htm 但是没有返回错误。

再次感谢您的所有帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-01T22:09:11.133

你可以用[`.load()`](http://docs.jquery.com/Ajax/load#urldatacallback)这个：

```
$("#loaded_data").load("demo2.htm #mydiv", function(text, status, request) {
    if(status == 'success') {
        alert('success');
    } else {
        alert('error');
    }
}); 
```

如果这对您不起作用，那么您做错了什么，我们需要查看更多代码。

这是使用上面的代码[从该页面](http://jsbin.com/ekari)获取单个 div 到该页面的示例[。](http://jsbin.com/ajopi)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-01T22:24:30.680

我已经更新了我的另一个示例，但我会将它克隆到这个可能有问题的问题中（没有双关语）......但是，唉，我们有两个关于同一件事的问题......

检查响应的[文本状态](http://docs.jquery.com/Ajax/load)。

```
$("#links").load("/Main_Page #jq-p-Getting-Started li", 
  function (responseText, textStatus, XMLHttpRequest) {
    if (textStatus == "success") {
         // all good!
    }
    if (textStatus == "error") {
         // oh noes!
    }
  } 
```

为了解决这个问题：

一个成功的例子：

[http://jsbin.com/ageju](http://jsbin.com/ageju)

失败的例子：

[http://jsbin.com/arite](http://jsbin.com/arite)

# .net - ASP.NET 成员资格防止人们同时在不同机器上以同一用户身份登录

> ID：937048
> 
> 赞同：1
> 
> 时间：2009-06-01T22:06:49.797
> 
> 标签：.net, asp.net, security, asp.net-membership

我的基于 Web 的系统的安全要求之一是防止人们同时在不同机器上以同一用户身份登录。

例如，确保人们不能都使用相同的密码/共享密码登录。

有没有办法使用 ASP.NET 成员资格提供程序来实现这一点。我是否需要手动存储每个会话的信息，如果需要，这是否可靠？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-01T22:11:29.943

用户登录时检查 System.Web.Security.MembershipUser.IsOnline。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T00:02:26.380

没有好的标准方法可以做到这一点。[forum.asp.net 上](http://forums.asp.net/p/983590/1692943.aspx)有一个关于实现类似功能的帖子。希望它会帮助你。
但请注意，这有时不起作用。即使您实现了自己的检查器，它将在会话中存储有关 ip、ma​​c 和浏览器的信息，用户也可以使用虚拟机（例如，VirtualPC，或 Windows 7 中的 XP 模式）来通过这些检查（例如，ip、ma​​c 和浏览器功能）将是相同的）。

# c# - 编辑并继续在某些时候停止为我工作

> ID：937049
> 
> 赞同：4
> 
> 时间：2009-06-01T22:07:12.540
> 
> 标签：c#, visual-studio-2008, debugging

我已经用 C# 开发一个应用程序（使用 VS2008）已经有一段时间了，大约一周前，“编辑并继续”已经停止为我工作。我可以在调试时编辑代码，但是我对代码所做的任何小改动都会迫使我停止项目并重新启动它。我得到的信息是这样的：

`Modifying a 'method' which contains a lambda expression will prevent the debug session from continuing while edit and continue is enabled.`

奇怪的是，发生这种情况时我什至没有使用 lambda。上周在调试模式下修改了相同的代码块，让我可以毫无问题地继续。我在互联网上进行了各种搜索，以找出我可以做些什么来导致这种行为改变。我在网上能找到的唯一帮助与调试 ASP.NET Web 项目直接相关。但是，我的解决方案的这一部分是一个 Windows 窗体项目。

问题可能是什么？有没有办法来解决这个问题？我将不胜感激任何帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-01T23:28:13.657

只是一个猜测，但也许您正在调试的方法包含从 lambda 捕获的类型。

下面是来自[这里](http://social.msdn.microsoft.com/Forums/en-US/vcsharp2008prerelease/thread/9b6cb03d-9a0a-42e0-938b-37beff246a27)的报价。

> ... EnC [EditAndContinue] 可以修改 IL，但不能修改类型——也就是说，它不能向类型添加字段或方法、删除类型或创建新类型。捕获局部变量的 Lambda 表达式可能会导致在后台创建隐藏类型。修改包含 lambda 表达式的方法可能会更改捕获的局部变量，这将需要更改隐藏类型。自 C# 2.0 和 VS 2005 起，匿名方法也存在同样的限制。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-01T22:11:28.583

“使用附加到进程开始调试时，不支持编辑并继续。混合模式、组合托管和本机、调试、SQL 调试、Compact Framework（智能设备）项目、Windows 98 上的调试不支持编辑并继续，或 64 位调试。”

[http://msdn.microsoft.com/en-us/library/ba77s56w.aspx](http://msdn.microsoft.com/en-us/library/ba77s56w.aspx)

**编辑**——那个链接说的是 VB，但我确信在使用 c# 时，我在混合本机代码和托管代码以及 64 位调试方面遇到了同样的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-01T22:33:34.360

这是一个长镜头，但您可能正在使用**LINQ** - 它只是 lambda 表达式的语法糖。那么，也许您在代码中添加了一些 LINQ？

# sql - 用于在 Stackoverflow 上进行类似于“相关问题”的搜索的 SQL 是什么

> ID：937059
> 
> 赞同：6
> 
> 时间：2009-06-01T22:10:04.610
> 
> 标签：sql, search, text

我正在尝试实现类似于 Stackoverflow 上的“相关问题”的功能。

如何编写 SQL 语句来搜索我的数据库的标题和摘要字段以查找类似问题？

如果我的问题是：“用于在 Stackoverflow 上进行类似于“相关问题”的搜索的 SQL 是什么？

我能想到的步骤是；

1.  去掉引号
2.  将句子拆分为单词数组并对每个单词运行 SQL 搜索。

如果我这样做，我猜我不会得到任何有意义的结果。我不确定服务器上是否启用了全文搜索，所以我没有使用它。使用全文搜索会有优势吗？

我发现了一个类似的问题，但没有答案：[类似的问题](https://stackoverflow.com/questions/39240/similar-posts-like-functionality-using-ms-sql-server)

使用 SQL 2005

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-01T22:33:26.497

看看这个[播客](https://blog.stackoverflow.com/2008/12/podcast-32/)。

> 我们对“相关问题”查询的主要性能优化之一是在将查询提交到 SQL Server 2008 全文引擎之前删除前 10,000 个最常见的英语词典单词（由 Google 搜索确定）。删除前 10k 英语词典单词后，大多数帖子所剩无几，令人震惊。这有助于限制和缩小返回的结果，从而大大加快查询速度。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-01T22:12:07.460

它们可能基于添加到问题中的标签相关......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-03T19:48:32.383

在我的 SQL 2005 服务器上启用全文搜索后，我正在使用以下存储过程来搜索文本。

```
ALTER PROCEDURE [dbo].[GetSimilarIssues] 
(
 @InputSearch varchar(255)
)
AS
BEGIN
-- SET NOCOUNT ON added to prevent extra result sets from
-- interfering with SELECT statements.
SET NOCOUNT ON;

DECLARE @SearchText varchar(500);

SELECT @SearchText = '"' + @InputSearch + '*"'

SELECT  PostId, Summary, [Description], 
Created
FROM Issue

WHERE FREETEXT (Summary, @SearchText);
END 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-01T22:14:53.943

我很确定根据与每个帖子关联的标签来实现该功能是最有效的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-01T22:19:17.307

它可能是使用匹配单词/短语的全文搜索来完成的。我已经在 MySQL 和 SQL Server 中使用它，并通过开箱即用的功能取得了不错的成功。

您可以在以下位置找到有关 MySQL 全文搜索的更多信息：

[http://dev.mysql.com/doc/refman/5.1/en/fulltext-search.html](http://dev.mysql.com/doc/refman/5.1/en/fulltext-search.html)

或者只是谷歌全文搜索，你会发现很多信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-01T22:22:57.657

它根据您输入的标题查找关键字，针对其他问题的标题和内容进行查询。在 Lucene（或类似的）中比在关系数据库中更容易（也更合适）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-01T22:28:44.993

我想说这可能是使用您输入的单个单词（而不是整个标题）对问题标题、问题内容和答案进行全文搜索。然后，利用全文的排名特征，显示排名最高的前10个左右的问题。

正如 tydok 指出的那样，看起来他们正在使用全文搜索（我无法想象任何其他方式）。

这是[全文搜索的 MSDN 参考](http://msdn.microsoft.com/en-us/library/ms142547.aspx)，确定使用的特定查询可能不会发生。

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2009-06-01T22:12:18.800

SQL 很可能只是“SELECT * FROM questions;”。我很难想象寻找相似问题的算法是用 SQL 实现的。

# c# - 根据内容过滤 OpenFileDialog 中显示的文件？

> ID：937061
> 
> 赞同：8
> 
> 时间：2009-06-01T22:11:20.487
> 
> 标签：c#, wpf, openfiledialog

有没有办法修改 OpenFileDialog 的行为，以便它查看它打开的文件夹中的文件，然后根据它们的内容忽略某些文件？

一个例子是打开一个充满 Zip 文件的文件夹，但只显示包含某个文件的文件夹。

从文档中，有 HookProc 但我不确定如何使用它。

请注意，如果可能的话，我意识到这将是一个相对缓慢的操作。目前我并不关心性能。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-01T23:35:57.010

我不会忽视 OpenFileDialog 的复杂性。构建一个真正有效的产品并不容易。当您自己构建时，它不是“正常”对话框，因此它会使用户感到困惑。即使你做得很好也是如此，这很难。所以我建议你坚持扩展已经存在的东西，而不是写新的东西。

查看这篇文章以了解可能/可以调整以完全满足您的需求[的 OFD 扩展。](http://www.codeproject.com/KB/dialog/OpenFileDialogEx.aspx)您在 C# 中编写了一个回调来响应路径选择。

相关：[FolderBrowserDialogEx](http://dotnetzip.codeplex.com/SourceControl/changeset/view/29832#432677)是 FolderBrowserDialog 上的一个类似扩展。尽管有名称，但您可以将其配置为搜索文件和文件夹。There's a callback that gets invoked when something (a folder, a file) is selected, and within that callback you can do what you need to do. 例如，查看文件夹内的文件并填充文件列表以仅显示这些文件。

* * *

您可能会考虑的另一个选项是[来自 Ookii 的对话框库](http://www.ookii.org/software/dialogs/)。这是 OpenFileDialog 的一个开源实现，它包括用于 Vista 中所有新对话框内容的 COM 包装器。使用该库，您可以在 C# 代码中弹出一个 Vista OpenFileDialog 并从[IFileDialogEvents接口接收事件。](http://msdn.microsoft.com/en-us/library/bb775876.aspx)一个这样的事件是 OnFolderChange()。在处理程序中，您可以调用 IFolder.GetFolder() 它将为您提供一个[IShellItem](http://msdn.microsoft.com/en-us/library/bb761144(VS.85).aspx)，它为您提供用户正在更改的文件夹。下一步是逐项列出并可能过滤文件集，这是我将留给读者的练习......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-01T22:14:20.607

不，您必须为此实现自己的功能。但老实说，OpenFileDialog 确实并没有做很多事情。老实说，是的，您可能会陷入其中，但是当真正的工作是检查文件的内容然后您可以编写自己的简单 OpenFileDialog 类那。

您可能会发现这个问题对列出 zip 文件的内容很有帮助：

[如何在 C# 中列出 .zip 文件夹的内容？](https://stackoverflow.com/questions/307774/how-to-list-the-contents-of-a-zip-folder-in-c)

（请注意，您可能会对其进行线程化以提​​高性能，只是不要跨越多个线程）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-01T23:20:04.450

您可能可以使用 Windows API 代码包（源附带）。与 Winforms/WPF 中的版本相比，通用文件对话框功能提供了更多的文件对话框功能。

[http://code.msdn.microsoft.com/WindowsAPICodePack](http://code.msdn.microsoft.com/WindowsAPICodePack)

# vb.net - DllImport 与 VB.NET 中的声明

> ID：937064
> 
> 赞同：16
> 
> 时间：2009-06-01T22:11:40.190
> 
> 标签：vb.net, dllimport, declare

我在 MSDN 文档中注意到，有[多种方法](http://msdn.microsoft.com/en-us/library/w4byd5y4.aspx)可以在 VB.NET 程序中声明对外部 DLL 中函数的引用。

令人困惑的是，MSDN 声称您只能在“[在极少数情况下](http://msdn.microsoft.com/en-us/library/26thfadc.aspx)”使用带有共享函数原型的[DllImportAttribute](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.dllimportattribute.aspx)类，但我找不到该声明的解释，而您可以简单地使用关键字来代替。[`Declare`](http://msdn.microsoft.com/en-us/library/4zey12w5.aspx)

为什么这些不同，我应该在哪里适当地使用每种情况？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2012-01-09T19:03:09.643

显然 Declare 和 DllImport 语句基本相同。你可以使用任何你喜欢的。

以下是对可能在每个方面略有不同的几点的讨论，这可能会影响对另一个的偏好：

我从 MSDN 上一篇关于 Visual Studio 2003 的文章开始，标题为[Using the DllImport Attribute](http://msdn.microsoft.com/en-us/library/aa984739%28v=vs.71%29.aspx)。（有点陈旧，但由于 DllImport 语句似乎起源于 .NET，因此回到开头似乎是合适的。）

给定一个示例 DllImport 语句：

```
[DllImport("user32.dll", EntryPoint = "MessageBox", CharSet = Unicode)]
int MessageBox(void* hWnd, wchar_t* lpText, wchar_t* lpCaption, unsigned int uType); 
```

它表示如果EntryPoint 值被忽略，[CLR](http://en.wikipedia.org/wiki/Common_Language_Runtime)将查找函数的名称（在本例中为MessageBox）作为默认值。但是，在这种情况下，由于指定了 Unicode 的 CharSet，CLR 将首先查找名为“MessageBoxW”的函数 - 表示 Unicode 返回类型的“W”。（ANSI 返回类型版本将是“MessageBoxA”。）如果没有找到“MessageBoxW”，则 CLR 将查找实际上称为“MessageBox”的 API 函数。

可以在此处找到有关 DllImportAttribute 类的当前详细信息，我在此处查看了 .NET Framework 4 版本：[DLLImportAttribute 类](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.dllimportattribute.aspx)

此 .NET Framework 4 页面的备注部分中的关键评论是：

> 您将此属性直接应用于 C# 和 C++ 方法定义；但是，当您使用 Declare 语句时，Visual Basic 编译器会发出此属性。

因此，在 VB.NET 中，使用该`Declare`语句会导致编译器生成一个`DLLImportAttribute`.

此页面中还有一个重要说明：

> DllImportAttribute 不支持泛型类型的封送处理。

因此，如果您想使用泛型类型，您似乎必须使用`Declare`语句。

接下来，我前往Declare statement information。Visual Studio 2010 版本（Visual Basic 语句信息）在这里：[Declare Statement](http://msdn.microsoft.com/en-us/library/4zey12w5%28v=VS.100%29.aspx)

这里的一个关键项目是这个注释：

> 您只能在模块级别使用 Declare。这意味着外部引用的声明上下文必须是类、结构或模块，并且不能是源文件、命名空间、接口、过程或块。

显然，如果您想在类、结构或模块之外设置 API 调用，则必须使用 DllImport 语句而不是`Declare`.

此页面上的示例`Declare`语句是：

```
Declare Function getUserName Lib "advapi32.dll" Alias "GetUserNameA" (
  ByVal lpBuffer As String, ByRef nSize As Integer) As Integer 
```

在这个例子之后是这个小信息：

> DllImportAttribute 提供了在非托管代码中使用函数的另一种方法。以下示例在不使用 Declare 语句的情况下声明导入的函数。

接下来当然是一个 DllImport 用法的示例。

关于 Unicode 与 ANSI 结果，根据此 Declare 页面，如果您指定 CharSet 值（在 Declare 中可用，但未在上面的示例中显示），CLR 将执行与 DllImport 相同类型的自动名称搜索 - 对于 Unicode 或ANSI。

如果您没有在`Declare`语句中指定 CharSet 值，那么您必须确保您在 Declare 中的函数名称与实际 API 函数的头文件中的函数名称相同，或者您必须指定一个`Alias`与实际函数匹配的值头文件中的名称（如上例所示）。

我找不到任何特定的 Microsoft 文档，说明在上述情况以外的任何情况下，DllImport 或 Declare 都比其他任何情况下都更受欢迎，甚至被推荐。

因此，我的结论是：

1.  除非您需要将定义放在`Declare`不能使用语句的地方之一，否则任何一种技术都可以正常工作，

和

2.  如果您使用 DllImport，请确保指定所需的 CharSet 值（Unicode 或 ANSI），否则您可能会得到意外的结果。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-06-01T23:50:37.277

Declare 确实是维护[P/Invoke语法的一种尝试，这对于转换为](http://en.wikipedia.org/wiki/Platform_Invocation_Services)[VB.NET](http://en.wikipedia.org/wiki/Visual_Basic_.NET)的 Visual Basic 6.0 用户来说会更熟悉。它具有许多与 P/Invoke 相同的功能，但某些类型（尤其是字符串）的编组非常不同，并且可能会给更熟悉 DllImport 规则的人带来一些混淆。

我不完全确定文档所暗示的“罕见”区别是什么。我经常从 VB.NET 和 C# 在我的代码中使用 DllImport 没有问题。

通常，除非您来自 Visual Basic 6.0 背景，否则我会使用 DllImport 而不是 Declare。DllImport 的文档和示例要好得多，并且有许多工具旨在生成 DllImport 声明。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-06-21T01:53:20.290

在我看来，由于从我搜索的内容来看，这个关键字看起来并没有被弃用等，所以只需使用编译时关键字而不是属性。

此外，当您使用 时`Declare`，您不需要编写`End Function`. 这样做的好处是您可以逐行创建函数导入声明的整个模块，而无需使用`DllImport`s 和`End Function`s 来处理您的代码。

当您使用`Declare`关键字声明时，编译器将此函数视为`Shared`无论如何，因此可以通过其他外部对象访问它。

但我认为在当前的 VB.NET 中，它们都针对相同的目标并且没有性能差异——对此没有任何保证。

**所以我的结论是：一定要使用 Declare 而不是 DllImport**，尤其是阅读你引用的[微软声明](http://msdn.microsoft.com/en-us/library/26thfadc.aspx)它应该在极少数情况下使用的内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-02-10T17:11:52.387

如果您需要设置以下选项之一，则使用`DllImportAttribute`属性，否则使用`Declare`. 来自[https://msdn.microsoft.com/en-us/library/w4byd5y4.aspx](https://msdn.microsoft.com/en-us/library/w4byd5y4.aspx)

> 要将 BestFitMapping、CallingConvention、ExactSpelling、PreserveSig、SetLastError 或 ThrowOnUnmappableChar 字段应用于 Microsoft Visual Basic 2005 声明，您必须使用 DllImportAttribute 属性而不是 Declare 语句。

仅从上述参考中尚不清楚这是否仅适用于“Visual Basic 2005”，因为上述参考来自 .NET 4.5 文章。但是，我还发现了这篇文章（[https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.dllimportattribute(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.dllimportattribute(v=vs.110).aspx)），它特定`DllImportAttribute`于 .NET 中的类4.5：

> 当您使用 Declare 语句时，Visual Basic 编译器会发出此属性。**对于包括 BestFitMapping、CallingConvention、ExactSpelling、PreserveSig、SetLastError 或 ThrowOnUnmappableChar 字段的复杂方法定义，您可以将此属性直接应用于 Visual Basic 方法定义**。

这告诉您该选项是在编译时`Declare`转换为的 VB.net 语法糖，并概述了建议直接使用时的确切场景。`DllImportAttribute``DllImportAttribute`

# apache-flex - 对静态属性的更改做出反应

> ID：937067
> 
> 赞同：1
> 
> 时间：2009-06-01T22:12:26.507
> 
> 标签：apache-flex, actionscript-3, data-binding, static, mxml

我正在用纯 AS 重写一个 MXML 项目渲染器。我似乎无法解决的一个问题是如何让每个项目渲染器对项目渲染器类上的静态属性的更改做出反应。在 MXML 版本中，我在项目渲染器上设置了以下绑定：

```
instanceProperty={callInstanceFunction(ItemRenderer.staticProperty)} 
```

在 AS 中设置它的等效方法是什么（我假设使用 BindingUtils）？

**更新：**
所以我认为以下内容不起作用，但似乎 Flex 正在抑制 instanceFunction 中引发的错误，使其看起来好像绑定本身是坏的。

```
BindingUtils.bindSetter(instanceFunction, ItemRenderer, "staticProperty"); 
```

但是，当调用 instanceFunction 时，给定实例上已经初始化的变量全部为空，这就是上面提到的错误的原因。任何想法为什么会这样？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-03-07T17:41:34.193

我知道您有 2 个选项：

**选项 1** 您可以深入研究 flex 编译器基于您的 MXML 构建的代码，以了解它如何处理与静态属性的绑定。有一个名为 -keep-generated-actionscript 的编译器指令会导致生成的文件保留下来。通过这些进行调查可以让您了解发生了什么。此选项将涉及实例化 Binding 对象和 StaticPropertyWatcher 对象。

**选项 2** 在构建时将 staticEventDispatcher 对象添加到包含静态变量的类中，请参见这篇文章[http://thecomcor.blogspot.com/2008/07/adobe-flex-undocumented-buildin.html](http://thecomcor.blogspot.com/2008/07/adobe-flex-undocumented-buildin.html)。根据帖子，该对象仅根据静态变量的存在而不是 getter 函数来添加。

**选项 2 的示例** 假设我们有一个名为 MyClassContainingStaticVariable 的类，其中有一个名为**MyStaticVariable****的**静态变量和另一个变量 someobject.somearrayproperty，我们希望在 MyStaticVariable 更改时对其进行更新。

 **```
Class(MyClassContainingStaticVariable).staticEventDispatcher.addEventListener(
PropertyChangeEvent.PROPERTY_CHANGE,
function(event:PropertyChangeEvent):void
{
    if(event.property == "MyStaticVariable")
    {
        someobject.somearrayproperty = event.newValue as Array;
    }
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T22:37:03.197

我认为您需要响应“PropertyChanged”事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-01T23:03:14.050

如果您要这样做，请使用单例而不是静态。我认为它不适用于静态。（如果你必须这样做，可能有几种方法可以让你重新处理它会更好）。

```
var instance:ItemRenderer = ItemRenderer.getInstance();
BindingUtils.bindProperty(this, "myProperty", instance, "theirProperty"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-12T00:44:19.900

在摆弄了一段时间之后，我得出的结论是，目前这在 ActionScript 中是不可能的，甚至在 bindSetter 中也是如此。从 Adob​​e 文档的以下摘录来看，似乎有一些仅限 MXML 的数据绑定功能（尽管它不是全部编译为 AS 代码）？

> 您不能在由 bindProperty() 或 bindSetter() 方法定义的数据绑定表达式中包含属性链中的函数或数组元素。有关属性链的更多信息，请参阅使用可绑定的属性链。

来源：[http ://livedocs.adobe.com/flex/3/html/help.html?content=databinding_7.html](http://livedocs.adobe.com/flex/3/html/help.html?content=databinding_7.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-14T14:09:47.123

您可以创建一个 HostProxy 类来代替函数调用。有点像从代理扩展的 HostFunctionProxy 类，并且有一个`getProperty("functionInvokeStringWithParameters")`将从主机远程调用该函数，并调度一个“更改”事件以触发典型`[Bindable("change")]`代理类中的绑定。

您比让 HostProxy 类充当主机，并使用该属性来远程触发函数调用。当然，如果有一些`TypeHelperUtil`允许在运行时将原始字符串值转换为方法参数的序列化类型值（通常用逗号分隔），那就更酷了。

示例：例如。

```
 var standInHost:Object = new HostFunctionProxy(someModelClassWithMethod, "theMethodToCall(20,11)");
// With BindingUtils.....
// bind host: standInHost
// bind property: "theMethodToCall(20,11)" 
```

当然，您需要创建这样的实用程序来帮助支持超出基本 Flex 处方的此类功能。似乎很多这样的（更高级的）Flex 绑定通常是在编译时完成的，但是现在您必须在运行时以完全跨平台的 Actionscript 方式创建代码来执行此操作，而不依赖于 Flex 框架。

# asp.net - ColdFusion 对 web 服务的调用给出了 org.xml.sax.SAXException

> ID：937075
> 
> 赞同：1
> 
> 时间：2009-06-01T22:13:27.940
> 
> 标签：asp.net, web-services, coldfusion, sax

我们是一个小团队，有一个 ASP.NET Web 开发人员和一个 ColdFusion 开发人员。我们都不知道对方的环境。我使用 Visual Studio 2005 编写了一个 ASMX Web 服务，并在 Visual Studio 2008 中编写了一个成功使用 Web 服务的 Web 应用程序项目。但是现在我们正试图让我的 ColdFusion 同事使用 Web 服务，并且我们得到了我们无法解释的结果（除了推测目标 Web 服务甚至没有被达到，但是 ColdFusion 使用的某些“系统层”正在失败。

编辑 - 更新：2009 年 6 月 2 日：

CF 开发人员看到的错误消息的最重要部分：

```
"Could not generate stub objects for web service invocation" 
```

这是 CF 客户端看到的堆栈跟踪：

```
org.xml.sax.SAXException: Fatal Error: URI=null Line=11: The element type "META" must be terminated by the matching end-tag "</META>".
    at org.apache.axis.utils.XMLUtils$ParserErrorHandler.fatalError(XMLUtils.java:723)
    at org.apache.xerces.util.ErrorHandlerWrapper.fatalError(Unknown Source)
    at org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)
    at org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)
    at org.apache.xerces.impl.XMLScanner.reportFatalError(Unknown Source)
    at org.apache.xerces.impl.XMLNSDocumentScannerImpl.scanEndElement(Unknown Source)
    at org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown Source)
    at org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)
    at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)
    at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)
    at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)
    at org.apache.xerces.parsers.DOMParser.parse(Unknown Source)
    at org.apache.xerces.jaxp.DocumentBuilderImpl.parse(Unknown Source)
    at org.apache.axis.utils.XMLUtils.newDocument(XMLUtils.java:369)
    at org.apache.axis.utils.XMLUtils.newDocument(XMLUtils.java:388)
    at coldfusion.xml.rpc.XmlRpcServiceImpl.retrieveWSDL(XmlRpcServiceImpl.java:647)
    at coldfusion.xml.rpc.XmlRpcServiceImpl.access$000(XmlRpcServiceImpl.java:51)
    at coldfusion.xml.rpc.XmlRpcServiceImpl$1.run(XmlRpcServiceImpl.java:208)
    at java.security.AccessController.doPrivileged(Native Method)
    at coldfusion.xml.rpc.XmlRpcServiceImpl.registerWebService(XmlRpcServiceImpl.java:201)
    at coldfusion.xml.rpc.XmlRpcServiceImpl.getWebService(XmlRpcServiceImpl.java:475)
    at coldfusion.xml.rpc.XmlRpcServiceImpl.getWebServiceProxy(XmlRpcServiceImpl.java:430)
    at coldfusion.tagext.lang.InvokeTag.doEndTag(InvokeTag.java:381)
    at cfuploadfileSimple2ecfm1056043715.runPage(D:\AMTSTEST\webservice\uploadfileSimple.cfm:68)
    at coldfusion.runtime.CfJspPage.invoke(CfJspPage.java:152)
    at coldfusion.tagext.lang.IncludeTag.doStartTag(IncludeTag.java:349)
    at coldfusion.filter.CfincludeFilter.invoke(CfincludeFilter.java:65)
    at coldfusion.filter.ApplicationFilter.invoke(ApplicationFilter.java:225)
    at coldfusion.filter.PathFilter.invoke(PathFilter.java:86)
    at coldfusion.filter.ExceptionFilter.invoke(ExceptionFilter.java:69)
    at coldfusion.filter.BrowserDebugFilter.invoke(BrowserDebugFilter.java:52)
    at coldfusion.filter.ClientScopePersistenceFilter.invoke(ClientScopePersistenceFilter.java:28)
    at coldfusion.filter.BrowserFilter.invoke(BrowserFilter.java:38)
    at coldfusion.filter.GlobalsFilter.invoke(GlobalsFilter.java:38)
    at coldfusion.filter.DatasourceFilter.invoke(DatasourceFilter.java:22)
    at coldfusion.filter.RequestThrottleFilter.invoke(RequestThrottleFilter.java:115)
    at coldfusion.CfmServlet.service(CfmServlet.java:107)
    at coldfusion.bootstrap.BootstrapServlet.service(BootstrapServlet.java:78)
    at jrun.servlet.ServletInvoker.invoke(ServletInvoker.java:91)
    at jrun.servlet.JRunInvokerChain.invokeNext(JRunInvokerChain.java:42)
    at jrun.servlet.JRunRequestDispatcher.invoke(JRunRequestDispatcher.java:257)
    at jrun.servlet.ServletEngineService.dispatch(ServletEngineService.java:541)
    at jrun.servlet.jrpp.JRunProxyService.invokeRunnable(JRunProxyService.java:204)
    at jrunx.scheduler.ThreadPool$DownstreamMetrics.invokeRunnable(ThreadPool.java:318)
    at jrunx.scheduler.ThreadPool$ThreadThrottle.invokeRunnable(ThreadPool.java:426)
    at jrunx.scheduler.ThreadPool$UpstreamMetrics.invokeRunnable(ThreadPool.java:264)
    at jrunx.scheduler.WorkerThread.run(WorkerThread.java:66) 
```

这是我们试图调用的 webmethod 的签名：

```
[WebMethod]
    public string UploadFileBasic(string trimURL
        , byte[] incomingArray
        , string FileName
        , string TrimRecordTypeName) 
```

我们对如何进行感到很困惑。明天我可以发布 CF 源代码，如果有用的话，但据我所知，它非常简单，并且在我们的单元测试中，服务的 CF 调用中的大多数参数都是常量（字符串）。

任何适当的 CF 论坛的帮助或建议将不胜感激。谢谢。

编辑更新 2009 年 6 月 2 日：

这是 CFML 代码：

```
<!--- read test.txt file into a binary variable --->
<cffile action="readBinary"   file="#FileName#" variable="objBinaryData">
<!--- convert the binary variable to Base64 --->  
<cfset b64file = #toBase64(objBinaryData)#>
<!--- invoke .net web service --->
<cfinvoke webservice =  "http://trim/trimbroker/fileservice.asmx?wsdl" 
          method = "UploadFileBasic"      
          returnVariable = "recordNumber">
    <cfinvokeargument name="trimURL" value="trim/trimWSdev/trim.asmx" />
    <cfinvokeargument name="incomingArray" value="#b64file#" />
    <cfinvokeargument name="FileName" value="#form.FILENAME#" />
    <cfinvokeargument name="TrimRecordTypeName" value="Document" />
</cfinvoke> 
```

请注意，我们已经大大简化了这一点，试图让事情正常进行。上面的参数 1 和 4 只是字符串常量。参数 2 是我们对 .Net 期望的字节数组的尝试。我们相信我们不会被 .Net 网络服务拒绝；相反，从堆栈跟踪中可以看出，在消息甚至通过网络发送之前，它就陷入了 SAX 异常。.Net Web 服务不会将任何内容记录到运行它的服务器的应用程序日志或系统日志中。

ColdFusion 版本是：ColdFusion MX 7。

编辑 - 2009 年 6 月 4 日：

通过另一个更专业的论坛解决了这个问题：

[http://forums.adobe.com/message/2009491#2009491](http://forums.adobe.com/message/2009491#2009491)

简而言之，当在 IIS 中使用“集成 Windows 身份验证”配置目标 Web 服务（我们的就是这样并且需要）时，CF MX 7 惨遭失败（错误消息没有给出任何线索）。更多的研究导致了这一点：

[http://blog.tagworldwide.com/?p=16](http://blog.tagworldwide.com/?p=16)

我们仍在追求这一点，并试图找到一个完全可行的解决方案。最重要的是，ColdFusion“管理员”必须进行一些“特殊配置”以使“生成的 Java 存根”能够连接到需要 Windows 身份验证的 .Net Web 服务。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-01T22:27:21.767

> 元素类型“META”必须以匹配的结束标签“ `<`/META `>`”结束。

该错误消息使我怀疑 ColdFusion 正在尝试使用 XML 解析器来解析 HTML 文档。如果我不得不猜测，我会说它可能试图解析 ASP.NET “黄屏死机”。我怀疑来自 CF 的格式错误的请求会导致 .NET 端出现错误，您需要检查 .NET 端的错误日志以了解具体反对的内容。

**编辑：** “黄屏死机”我只是指标准的 ASP.NET 错误页面，它在黄色背景上显示错误消息和堆栈跟踪。

为了响应您的更新，我可以想到一些检查的可能性：

1.  您发布的堆栈跟踪和第二条错误消息似乎表明问题正在发生，而 CF 正在下载和解析 WSDL 以创建代理对象，早在实际调用您的方法之前。如果您将“ [http://trim/trimbroker/fileservice.asmx?wsdl](http://trim/trimbroker/fileservice.asmx?wsdl) ”粘贴到 Web 浏览器中，您得到的是 WSDL 还是 HTML？也许您被重定向到登录页面或其他什么？如果您没有在浏览器中获得 WSDL XML 文档，那么 CF 也将无法获得它。

2.  您的 CF 代码将 base-64 字符串传递到需要字节数组的参数中。CF webservice 堆栈是否足够智能，可以将 base-64 字符串转换为字节数组？我会感到惊讶，但也许。你能在 CF 中创建字节数组吗？你不能上次我使用 CF，但那是很久以前的事了。您可以尝试将objBinaryData 直接传递给incomingArray 参数而不转换为base-64，但如果这不起作用，将.NET 端的incomingArray 类型更改为字符串，然后调用Convert.FromBase64String() 可能是最简单的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-13T01:57:22.790

我遇到了同样的问题，原来是因为 CF 服务在本地系统下运行，没有访问 wsdl，所以 ASP.Net 返回未经授权的访问。

尝试使用 cfhttp 获取 wsdl 并查看 cfhttp.fileContent 是什么，您可能会遇到同样的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-01T22:17:53.907

CFML 会很方便。另外，你用的是什么版本的CF？如果您的 Web 服务中有任何重载方法，我知道早期版本的 CF 会出现问题。我不知道这是否是最新版本中的问题。

# sql - 在公式属性上使用投影

> ID：937081
> 
> 赞同：1
> 
> 时间：2009-06-01T22:15:49.777
> 
> 标签：sql, oracle, properties, formula, projection

我的 XML 映射文件中有一个属性，例如

```
<property name="CreatedByLogin"  formula="(select x.fst_name || ' ' || x.last_name from sebl_dev.S_CONTACT x where x.ROW_ID=CREATED_BY)" type="String" /> 
```

我想在这个特定的名字上使用一个投影，比如

```
.Add(Projections.Property("CreatedByLogin"), "CreatedByLogin") 
```

我确实得到了 Oracle 异常。

有没有办法对使用公式声明的属性进行投影？

我生成的 SQL 是

```
select
     *
from (
     SELECT
         this_.ROW_ID as y0_,
         this_.CREATED as y1_,
         this_.CREATED_BY as y2_,
         this_.STATUS as y3_,
         this_.PSR_NUM as y4_,
         this_.ORDER_ID as y5_,
         this_.WFM_ID as y6_,
         this_.VIRTUAL_SS_ID as y7_,
         this_.VERIFIED_WITH as y8_,
         this_.REQ_DUE_DATE as y9_,
         this_.TYPE as y10_,
         account1_.NAME as y11_,
         account1_.OU_NUM as y12_,
         this_.DESCRIPTION as y13_,
         account1_.MARKET_TYPE_CD as y14_,
         account1_.X_SALES_CHANNEL as y15_,
         this_.QUOTE_ID as y16_,
         (
            select
                 x.fst_name || ' ' || x.last_name
            from sebl_dev.S_CONTACT x
            where x.ROW_ID=this_.CREATED_BY)
         as y17_,
         (
            select
                 x.fst_name || ' ' || x.last_name
            from sebl_dev.S_CONTACT x
            where x.ROW_ID=this_.LAST_UPD_BY)
         as y18_,
         serviceacc2_.INTEGRATION_ID as y19_,
         serviceacc2_.NAME as y20_,
         accountadd3_.ADDR as y21_,
         accountadd3_.ADDR_LINE_2 as y22_,
         accountadd3_.CITY as y23_,
         accountadd3_.STATE as y24_,
         accountadd3_.ZIPCODE as y25_
        FROM XOOE.XO_SS_HEADER this_
inner join XOOE.XO_SS_DETAILS this_1_
on this_.ROW_ID=this_1_.ROW_ID
 inner join sebl_dev.S_ORG_EXT account1_
on this_.CUST_ACCNT_ID=account1_.ROW_ID
left outer join sebl_dev.S_org_ext_x account1_1_
on account1_.ROW_ID=account1_1_.Row_id
 left outer join sebl_dev.S_ORG_EXT_UTX account1_2_
on account1_.ROW_ID=account1_2_.PAR_ROW_ID
inner join sebl_dev.S_ORG_EXT serviceacc2_ on this_.SERV_ACCNT_ID=serviceacc2_.ROW_ID
 left outer join sebl_dev.S_org_ext_x serviceacc2_1_
 on serviceacc2_.ROW_ID=serviceacc2_1_.Row_id
left outer join sebl_dev.S_ORG_EXT_UTX serviceacc2_2_
 on serviceacc2_.ROW_ID=serviceacc2_2_.PAR_ROW_ID
 inner join sebl_dev.S_ADDR_PER accountadd3_
on serviceacc2_.PR_ADDR_ID=accountadd3_.ROW_ID
        WHERE this_.TYPE = :p0 )

    where rownum <= :p1 
```

结果异常是

```
InnerException    {"ORA-01445: cannot select ROWID from, or sample, a join view without a key-preserved table"}    System.Exception {Oracle.DataAccess.Client.OracleException} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-01-25T04:28:00.393

这是 Oracle 版本 9、10 和 11 的早期版本中的一个已知错误。它显然已在最新版本中修复。

该问题是由这些旧版本处理 SQL-92 样式连接的方式中的错误引起的。因此，如果无法升级，您可以使用旧式 SQL-89 连接来解决这些问题。例如，一个 INNER JOIN：

```
SELECT column
FROM table1 t1, table2 t2
WHERE t1.pk = t2.fk 
```

另一个例子，这次是 LEFT JOIN：

```
SELECT column
FROM table1 t1, table2 t2
WHERE t1.pk = t2.fk(+) 
```

更多信息：

[http://awads.net/wp/2007/06/14/when-ansi-sql-join-syntax-does-not-work-in-oracle/](http://awads.net/wp/2007/06/14/when-ansi-sql-join-syntax-does-not-work-in-oracle/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T22:28:32.607

我最好的猜测：

您正在从没有定义键的表中选择一个键。您将不得不弄清楚它是哪个表，并将主键字段添加到其中。

# .net - 我什么时候应该使用 Odbc、OleDb、SQLClient？有哪些取舍

> ID：937083
> 
> 赞同：9
> 
> 时间：2009-06-01T22:16:16.063
> 
> 标签：.net, database, odbc, oledb, sqlclient

我从一个 SQLServer 数据库开始。所以看起来我应该使用`System.Data.SqlClient`命名空间。但是，我们可能会关闭 SqlServer 数据库并转到 MySql 或 Oracle。出于这个原因，我提出了一套关于我们的 .Net 应用程序如何与数据库通信的标准，以便将来在需要时更容易迁移到不同的数据库系统。

**所以这里是标准：**

1.  尽可能使用 ORM（例如 NHibernate）（没有 LINQ，因为它只支持 SqlServer，但是实体框架及其对 Oracle 和 MySql 的支持呢？）
2.  如果 ORM 是一种过度杀戮，那么使用参数化 SQL 查询。
3.  仅将存储过程用于需要在数据库上执行的长时间运行或复杂的操作。

这让我想到了我**手头的主要问题。** ***我应该使用哪个命名空间来编码我的 DAL？***

在我看来，选择在`System.Data.ODBC`和之间`System.Data.OleDB`：

*   有哪些取舍？
*   一个比另一个更受欢迎吗？
*   您对前 3 个标准有何看法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2015-08-02T12:38:20.780

### System.Data.SQLClient

仅连接到 SQL Server 2000 及更高版本，但在连接到这些数据库时您将获得最佳性能。

### System.Data.OledbClient

连接到 SQL 6.5

OLEDBClient 使您能够连接到其他数据库，如 ORACLE 或 Access。但是对于使用 SQL Server，您将使用 SQLClient 获得更好的性能。

注意：为了连接到 ORACLE，微软也有 ORACLEClient。

### System.Data.ODBCClient

仅使用 ODBC 驱动程序连接到旧数据库。（例如 MS Access 97。）

[原始来源](https://social.msdn.microsoft.com/Forums/sqlserver/en-US/b1cf6249-cbc2-4ab7-90d9-dbea8acf523a/what-is-the-difference-between-systemdatasqlclient-systemdataoledbclient-and?forum=sqldataaccess)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-01T22:26:10.647

您想使用 SQL Server 驱动程序。我了解您要做什么，但是您要完成支持多个数据库的方法是插入另一层抽象。您可以通过多种方式做到这一点。但是您将特定于数据库的代码放在类层次结构的边缘。因此，每个类都可以获得数据库特定功能的好处，但更高级别的调用者不知道也不关心下面使用的是什么数据库。至于 ORM，我更喜欢[LLBLGen](http://www.llblgen.com/defaultgeneric.aspx)，但这只是我的偏好。

另外，澄清一下，LINQ 并不特定于 SQL Server。那就是LINQ-to-SQL。LINQ 是一种查询技术，可以在 LINQ-to-SQL、LINQ-to-Entities、LINQ-to-objects 中使用，甚至 LLBLGen 都支持 LINQ。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-05-06T12:53:29.743

无论您现在使用 SQLClient 还是 Odbc，如果您使用存储过程或其他特定于数据库的功能，则在更改数据库引擎时都必须重写它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-01T22:25:31.177

如果 DAL 发生更改，我将只使用 SqlClient 并重新编写/重新生成 DAL。

除非您现在要在多个平台上实施和测试，否则我不确定现在的额外努力是否重要或是否比重做 DAL 的努力以及您拥有 DAL 的事实无论如何，您已经将所有内容放在一个地方以供以后更改。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-01T22:31:47.937

如果您有任何迹象表明您将交换数据库（或支持多个后端），那么 ORM 就是要走的路。否则，您仍然需要重构/重写大量 DAL 以支持更改。如果您的应用程序很小，它不会很糟糕，但是任何实质性的东西都会让您受到伤害。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-01T22:43:00.440

您会发现使用 SQL Server SqlClient 比 OleDB 和 ODBC 开发更快、更容易 - 除非您极有可能需要支持多个平台，否则您会发现好处大于需要重写的风险你的 DAL。

此外，使用 OleDB / ODBC 只是维护平台独立性的一种方式 - 您可能会发现拥有多个 DAL 实现更有效，每个实现都使用所用平台的本机客户端。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-01T22:33:26.730

我听说它说除非它是一个关键特性，否则你不应该太担心维护平台独立性。也就是说，

SQLClient 将为您提供本机访问权限，并且应该具有更高的性能（它不必进行任何抽象/翻译）。

要使 OLEDB 与 ODBC 相比，您唯一需要更改的是您的连接字符串。OLEDB 具有更多的客户端智能，因此它提供了更好的性能。

# svn - 令人困惑的颠覆状态！M

> ID：937098
> 
> 赞同：0
> 
> 时间：2009-06-01T22:20:06.493
> 
> 标签：svn

版本化项目如何“丢失或不完整”但也“修改”？这是已签出仓库的“根”状态：

```
!M    . 
```

试图弄清楚它如何被修改和丢失（目录或任何东西上没有修改的属性）。我将如何解决此状态？谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-02T00:11:10.793

可能是文件被修改并且不完整/损坏。来自`SVN help status`：

```
'!' item is missing (removed by non-svn command) or incomplete 
```

# c# - 不会消失的启动画面

> ID：937102
> 
> 赞同：0
> 
> 时间：2009-06-01T22:21:39.237
> 
> 标签：c#, splash-screen

我正在使用来自[Here](http://www.codersource.net/csharp_splash_screen.aspx)的启动画面。我喜欢它的简单。但它的问题是，在我点击它之前，闪屏不会消失。在 IDE 中运行时，它工作正常。有任何想法吗？我会在此处附上代码，但由于某种原因它没有正确插入。

```
private System.Windows.Forms.Timer timer1;
//private Splash sp=null;

public Form1()
{
    InitializeComponent();

    Thread th = new Thread(new ThreadStart(DoSplash));
    //th.ApartmentState = ApartmentState.STA;
    //th.IsBackground=true;
    th.Start();
    Thread.Sleep(3000);
    th.Abort();
    Thread.Sleep(1000);
}

private void DoSplash()
{
    Splash sp = new Splash();
    sp.ShowDialog();
}

private void timer1_Tick(object sender, System.EventArgs e)
{
//      sp.Close();
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-01T22:29:33.057

首先，使用[Thread.Abort](http://msdn.microsoft.com/en-us/library/system.threading.thread.abort(VS.71%29.aspx)在该页面上完成启动画面的方式**不是**正确的做事方式。

切勿调用[Thread.Abort](http://msdn.microsoft.com/en-us/library/system.threading.thread.abort(VS.71%29.aspx)，除非您正在关闭线程所在的[AppDomain 。](http://msdn.microsoft.com/en-us/library/system.appdomain.aspx)

让我再次强调这一点。**您应该调用[Thread.Abort的唯一时间是当您对](http://msdn.microsoft.com/en-us/library/system.threading.thread.abort(VS.71%29.aspx)[Thread.Abort](http://msdn.microsoft.com/en-us/library/system.threading.thread.abort(VS.71%29.aspx)及其行为有足够的了解时，知道您永远不应该调用它。**

看看 StackOverflow 上的另一个问题：[C# 中的多线程启动画面？](https://stackoverflow.com/questions/48916/multi-threaded-splash-screen-in-c).

* * *

如果您想保留现有解决方案，一种可能的更好方法是将计时器放入启动屏幕表单，将其计时器设置为您希望启动屏幕停留在屏幕上的时间，然后在其 Tick 事件处理程序中调用[Close 。](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.close.aspx)

在同一地点，我会简单地关闭原始线程，并删除其他行。

换句话说，从该页面的第一个代码块开始，我会保留这两行：

```
Thread th = new Thread(new ThreadStart(DoSplash));
th.Start(); 
```

将它与表单上的计时器相结合，使表单自动关闭，你的状态比试图掌握 Thread.Abort 更好。

你不应该打电话。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-01T22:29:09.127

DoSplash 可能应该调用`sp.Show()`而不是 `sp.ShowDialog()`

但是从主线程调用 Sleep(x000) 来显示启动屏幕并不是很有效，并且应该保留 Thread.Abort() 以便更好地使用。

更好的方法是使用 Timer 关闭 SplashForm 并设置最小延迟。在启动时，您可以 Show() 和 Update() SplahForm 并继续加载内容。在 MainForm 完成初始化并进入 EventLoop 之前，计时器事件不会触发。不需要线程，也不需要涉及 MainForm。

只是为了给你一个 MessageLoop 驱动的 SplashForm 的主要成分：

```
public partial class SplashForm : Form
{
    //  default stuff

    public static void Splash()
    {
        var s = new SplashForm();
        s.Show();
        s.Update();// force paint
    }

    private void SplashForm_Load(object sender, EventArgs e)
    {
        Timer t = new Timer();
        t.Interval = 1; // wait for EventLoop
        t.Tick += GoAway;
        t.Enabled = true;
    }

    private void GoAway(object sender, EventArgs e)
    {
        this.Close();
    }
} 
```

然后，在 Program.cs 中，

```
Application.EnableVisualStyles();
Application.SetCompatibleTextRenderingDefault(false);
SplashForm.Splash();
Application.Run(new MainForm()); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-01T22:29:14.867

这是一个丑陋的实现。你应该看看[这个 SO 线程](https://stackoverflow.com/questions/48916/multi-threaded-splash-screen-in-c)。这描述了如何使用 C# 中的 VisualBasic.NET 命名空间和[OnCreateSplashScreen](http://msdn.microsoft.com/en-us/library/microsoft.visualbasic.applicationservices.windowsformsapplicationbase.oncreatesplashscreen.aspx)方法来实现更清晰的启动画面。

# objective-c - 使用 NSImage 的垃圾收集崩溃

> ID：937105
> 
> 赞同：1
> 
> 时间：2009-06-01T22:22:04.413
> 
> 标签：objective-c, cocoa, garbage-collection

这段代码是从我正在从事的项目中分离出来的。它始终在我的 Mac OS 10.5.7 上重现垃圾收集错误，有时还会崩溃。我已经研究它太久了，所以我的问题是：有没有其他人知道为什么在垃圾收集开启时这会出错？

```
- (void) doCrash: (id) sender
{
    NSArray *lURLArray = [ NSArray arrayWithObjects:
                          @"http://userserve-ak.last.fm/serve/300x300/23621007.jpg",
                          @"http://userserve-ak.last.fm/serve/300x300/26675609.png",
                          @"http://userserve-ak.last.fm/serve/300x300/26675609.png",
                          nil ];
    NSString *lImageURL = nil;
    for (lImageURL in lURLArray)
    {
        NSImage *lImage = [[NSImage alloc] initWithContentsOfURL: [NSURL URLWithString: lImageURL]];

        NSSize targetSize = NSMakeSize(80,80);
        NSImage *newImage = [[NSImage alloc] initWithSize:targetSize];
        [newImage lockFocus];

        NSRect thumbnailRect = NSMakeRect(0,0,80,80);
        NSRect sourceRect = NSMakeRect(0,0,[lImage size].width,[lImage size].height);

        [lImage drawInRect: thumbnailRect
                  fromRect: sourceRect
                 operation: NSCompositeSourceOver
                  fraction: 1.0];                

        [newImage unlockFocus];
    }
} 
```

在使用 lURLArray 中的 URL 时，我会得到不同的行为：有时会崩溃，有时会出现错误消息。

当垃圾收集器释放其中一个图像时触发垃圾收集错误消息，如下所示：

```
reference count underflow for <address>, break on auto_refcount_underflow_error to debug. 
```

非常感谢任何帮助，谢谢，克里斯托夫

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T00:24:18.973

Apple 的某个人已向我证实这是 OX X 10.5.7 中的一个错误。

rdar://problem/6938657

# c++ - 模板特化是否需要 template<> 语法？

> ID：937107
> 
> 赞同：9
> 
> 时间：2009-06-01T22:22:36.393
> 
> 标签：c++, templates, syntax, template-specialization

我有一个类似于这样的访客类：

```
struct Visitor 
{
    template <typename T>
    void operator()(T t)
    {
        ...
    }

    void operator()(bool b)
    {
        ...
    }
}; 
```

显然，**`operator()(bool b)`**它旨在成为上述模板函数的特化。

但是，它没有**`template<>`**我之前看到的语法，将其声明为模板特化。但它确实编译。

这安全吗？它是否正确？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-06-01T22:48:07.450

您的代码不是模板特化，而是非模板函数。那里有一些差异。非模板化的 operator() 将优先于模板化的版本（对于完全匹配，但类型转换不会在那里发生），但您仍然可以强制调用模板化函数：

```
class Visitor
{
public: // corrected as pointed by stefanB, thanks
   template <typename T>
   void operator()( T data ) {
      std::cout << "generic template" << std::endl;
   }
   void operator()( bool data ) {
      std::cout << "regular member function" << std::endl;
   }
};
template <> // Corrected: specialization is a new definition, not a declaration, thanks again stefanB 
void Visitor::operator()( int data ) {
   std::cout << "specialization" << std::endl;
}
int main()
{
   Visitor v;
   v( 5 ); // specialization
   v( true ); // regular member function
   v.operator()<bool>( true ); // generic template even if there is a non-templated overload
   // operator() must be specified there (signature of the method) for the compiler to 
   //    detect what part is a template. You cannot use <> right after a variable name
} 
```

在您的代码中没有太大区别，但如果您的代码需要传递模板参数类型，它会变得更有趣：

```
template <typename T>
T g() { 
   return T();
}
template <>
int g() {
   return 0;
}
int g() {
   return 1;
}
int main()
{
   g<double>(); // return 0.0
   g<int>(); // return 0
   g(); // return 1 -- non-templated functions take precedence over templated ones
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-01T22:41:53.687

您在这里拥有的是函数重载；要获得模板专业化，您确实需要`template <>`语法。但是，您应该知道这两种方法，即使它们看起来相同，也有细微的不同，甚至编译器在选择要调用的正确函数时也可能会迷失方向。列出所有可能的情况对于这个答案来说有点太长了，但你可能想检查一下[Herb Sutter GoTW #49](http://www.gotw.ca/gotw/049.htm)关于这个问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-01T22:27:07.680

哦，它会编译。它只是不会是模板功能。您将拥有一个常规的非模板函数，而不是模板特化。

它是安全的，实际上也可能是您想要的。访问者模式通常通过重载来实现。无论如何，专门化函数模板[并不是一个好主意。](http://www.gotw.ca/publications/mill17.htm)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-01T22:32:17.543

你做的不是模板序列化，而是函数重载。这是安全的。

PS很难说它是否正确，不知道你想要实现什么。请记住，无论是模板还是重载函数，都会在编译时选择您的运算符。如果需要运行时分派，则需要多态性，而不是重载。好吧，无论如何您可能都知道；以防万一。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-01T23:11:34.250

你有

*   `void operator()(bool b)`那是非模板化的功能
*   `template< typename T > void operator()(T t)`这是一个单独的基础模板，重载了上述内容

您可以对第二个进行完全专业化，因为只有在不匹配`template<> void operator(int i)`时才会考虑。`void operator()(bool b)`

基础模板的特化用于选择调用哪个基础模板方法。但是，在您的情况下，您有一个将首先考虑的非模板化方法。

文章[为什么不专门化函数模板？](http://www.gotw.ca/publications/mill17.htm)很好地解释了如何选择该方法。

总而言之：

1.  首先考虑非模板函数（这是上面的普通 operator()(bool) ）
2.  其次检查函数基本模板（这是您的模板化函数），选择最专业的基本模板，然后如果它具有特定类型的专门化，则使用专门化，否则基本模板与“正确”类型一起使用（参见文章中的解释）

例子：

```
#include <iostream>
using namespace std;

struct doh
{
    void operator()(bool b)
    {
        cout << "operator()(bool b)" << endl;
    }

    template< typename T > void operator()(T t)
    {
        cout << "template <typename T> void operator()(T t)" << endl;
    }
};
// note can't specialize inline, have to declare outside of the class body
template<> void doh::operator()<>(int i)
{
    cout << "template <> void operator()<>(int i)" << endl;
}
template<> void doh::operator()<>(bool b)
{
    cout << "template <> void operator()<>(bool b)" << endl;
}

int main()
{
    doh d;
    int i;
    bool b;
    d(b);
    d(i);
} 
```

您会接到以下电话：

```
operator()(bool b)       <-- first non template method that matches
template <> void operator()(int i)     <-- the most specialized specialization of templated function is called 
```

# php - php评论脚本

> ID：937108
> 
> 赞同：0
> 
> 时间：2009-06-01T22:22:46.957
> 
> 标签：php, mysql, database, comments

任何人都知道我在哪里可以找到 php/mysql 中的简单评论脚本，我只想要一个具有基本字体增强、url 链接、图像和回复功能的系统。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-01T22:36:22.653

这些似乎符合要求

[http://www.scriptsmi​​ll.com/comments_demo.html](http://www.scriptsmill.com/comments_demo.html)

[http://www.gentlesource.com/comment-script/](http://www.gentlesource.com/comment-script/)

[http://www.digitalmidget.com/php_noob/comment.php](http://www.digitalmidget.com/php_noob/comment.php)

然而，第二个不像**免费****啤酒**那样免费。第一个看起来还可以。

我刚刚用谷歌搜索了“php”+“page-comments”+“script”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-03-29T18:48:31.107

我会将评论添加到列表中，因为它有很多功能，而且是免费的 -

[简单的评论率脚本](http://www.commentics.org/demo-menu.php)

# apache-flex - Using FlashVars with Flex 3

> ID：937116
> 
> 赞同：1
> 
> 时间：2009-06-01T22:26:42.813
> 
> 标签：apache-flex, flash, actionscript-3, flex3

I'm trying to pass parameters from HTML-land to Flex-3 Flash-land, and can't seem to get it to work. Here's what I've got (basically the default template, modified with FlashVars):

```
<noscript>
<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"
        id="${application}" width="${width}" height="${height}"
        codebase="http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab">
        <param name="movie" value="${swf}.swf" />
        <param name="quality" value="high" />
        <param name="bgcolor" value="${bgcolor}" />
        <param name="allowScriptAccess" value="sameDomain" />

    <param name="flashVars" value="userID=foo&assignmentID=1"/>

        <embed src="${swf}.swf" quality="high" bgcolor="${bgcolor}"
            width="${width}" height="${height}" name="${application}" align="middle"
            play="true"
            loop="false"
            quality="high"
            allowScriptAccess="sameDomain"
            type="application/x-shockwave-flash"
            pluginspage="http://www.adobe.com/go/getflashplayer"
           flashVars="userID=foo&assignmentID=1">
        </embed>
</object>
</noscript> 
```

And here's the ActionScript (called after the app's `creationComplete` event is fired):

```
function initApp() : void
{
    // default params
    userID = Application.application.parameters.userID;
    assignmentID = Application.application.parameters.assignmentID;
    if (userID == null || assignmentID == null)
    {
        Alert.show("I didn't get any params!", "Error");
    }
} 
```

Anybody know what's going wrong? I've tried several permutations of this with no luck. (Firefox 3, OS-X, Flash Player 9 FWIW)

Thanks!

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-01T22:59:25.913

I think you want to be setting query params after the .swf stuff too. Try

```
 <embed src="${swf}.swf?userID=foo" quality="high" bgcolor="${bgcolor}" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T22:34:18.977

Try "FlashVars" instead of "flashVars".

# ide - 浏览路径/点击问题

> ID：937120
> 
> 赞同：1
> 
> 时间：2009-06-01T22:28:01.670
> 
> 标签：ide, delphi-2007

我在 D2007 中安装了 Raize 3.0。无论出于何种原因，我似乎无法让 Ctr-click 加载它的单元，即使该功能在我所有其他 Delphi 和第三方组件上都可以正常工作。

这是我在图书馆路径上为 Raize 准备的内容：

```
$(ProgramFiles)\Raize\RC3\Lib6  
$(ProgramFiles)\Raize\RC3\Source 
```

...和浏览路径：

```
$(ProgramFiles)\Raize\RC3\Source 
```

Lib6 包含`*.dcu`和`*.dfm`文件，而 Source 显然包含源代码。将 Lib6 添加到浏览路径似乎不会以某种方式影响事物。

我不明白为什么这个 Ctrl-click 单元加载功能不起作用，仅适用于这个组件。有什么想法我可能会错过吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-02T01:35:15.350

对于 lib 路径，您通常不需要源文件。我用：

> C:\Program Files\Raize\RC4\Lib\BDS2007

对于浏览路径，您需要指定语言目录，例如：

> C:\Program Files\Raize\RC4\Source\Lang\English

如果这不能解决问题，您的单元是否编译没有错误？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T04:47:39.183

您的库路径中不应该需要源路径。应将 Lib6 添加到库路径，并将源添加到浏览路径。

如果你这样做了，但它仍然不起作用，那么你和我有类似的问题：

[在 Delphi 选项页面中设置浏览路径的问题](https://stackoverflow.com/questions/782341/problem-with-setting-browsing-path-in-delphi-option-page)

# search - 如何用 nutch 进行 OR 搜索？

> ID：937130
> 
> 赞同：0
> 
> 时间：2009-06-01T22:30:16.177
> 
> 标签：search, nutch

比如说，搜索字段为“A”或“B”的结果？

似乎默认值是 AND。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-05-11T10:25:05.403

从未使用 nutch 进行查询（仅用于索引），但 schmea.xml 应该包含一个可以设置为 AND 或 OR 的 defaultOperator。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T23:28:40.800

从来没有积极与 Nutch 合作过，但既然它是基于 Lucene 的，难道不应该适用 Lucene 的规则吗？也就是说，[Query Parser Syntax](http://lucene.apache.org/java/2_3_2/queryparsersyntax.html#Boolean%20operators)应该是适用的。看看这是否有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-25T07:24:18.730

我最近开始使用 nutch 。您需要在 nutch 中修改 query.java 以执行 OR 查询。在 Query.java 中添加代码

public void addShouldTerm(String term, String field) { Clause.add(new Clause(new Term(term), field, false, false, this.conf)); }

public void addShouldTerm(String term) { addShouldTerm(term, Clause.DEFAULT_FIELD); }

并形成您的查询

查询查询=新查询（conf）；query.addNotRequiredTerm("A"); query.addNotRequiredTerm("B"); 您将获得 A 或 B 的结果。

如果有任何其他方式或更好的方式，请纠正我。

# c# - 有没有办法动态创建和处置 Webbrowser 控件？

> ID：937135
> 
> 赞同：3
> 
> 时间：2009-06-01T22:32:18.153
> 
> 标签：c#, winforms, webbrowser-control, dispose, instantiation

我有这个使用 Webbrowser 控件进行自动浏览的应用程序。我需要想出一种方法来自动关闭浏览器（处置），然后创建另一个实际工作的实例。

这是我到目前为止的一些代码。

```
this.webBrowser2 = new System.Windows.Forms.WebBrowser();
this.webBrowser2.Dock = System.Windows.Forms.DockStyle.Bottom;
this.webBrowser2.Location = new System.Drawing.Point(0, 34);
this.webBrowser2.MinimumSize = new System.Drawing.Size(20, 20);
this.webBrowser2.Name = "webBrowser2";
this.webBrowser2.ScriptErrorsSuppressed = true;
this.webBrowser2.Size = new System.Drawing.Size(616, 447);
this.webBrowser2.TabIndex = 1; 
```

所以我在想如果我处理 webbrower 实例。

```
webBrowser2.dispose(); 
```

然后创建 webbrowser 对象的新实例。

```
WebBrowser w = new WebBroswer();
w.Navigate(url); 
```

不幸的是，这不起作用。浏览器的新实例不会显示，并且已处理的浏览器对象只是在 windows 窗体中保持冻结状态。

有什么我做错了吗？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-01T22:37:59.687

您需要从表单的 Controls 属性中添加和删除 WebBrowsers：

```
this.Controls.Remove(webBrowser2);
this.Controls.Add(w); 
```

如果您遇到困难，还有[这篇文章](http://support.microsoft.com/kb/319266)对添加和删除控件进行了*几乎*完整的演练（它不包含太多关于事件的内容）。

# iphone - iPhone上的Lua？

> ID：937136
> 
> 赞同：15
> 
> 时间：2009-06-01T22:33:11.020
> 
> 标签：iphone, cocoa-touch, macos, lua, linker-errors

我正在尝试在 iPhone 上使用 Lua。在 Mac OS X 上，在普通（非 iOS）Cocoa 应用程序中，我使用了以下代码：

```
lua_State* l;
l = lua_open();
luaL_openlibs(l);
luaL_loadstring(l, "print(\"Hi from Lua\");");
lua_pcall(l, 0, 0, 0); 
```

我从 lua.org/ftp 下载了 Lua 5.1.4 并为 Mac OS X 编译了它。在 Xcode 项目中，我使用“添加现有框架”添加`liblua.a`，我使用“添加现有文件”添加包含目录。

这按预期工作，并打印字符串：“Hi from Lua”。当我在 iOS 项目中尝试同样的事情时，它会给出错误：

```
"_luaL_newstate", referenced from:
_main in main.o
more of the same thing...
symbol(s) not found
collect2: ld returned 1 exit status 
```

.a 文件似乎没有链接到 iPhone 应用程序。有谁知道如何使这项工作？

（顺便说一句，如果 Apple 中包含 Lua，我并不关心 Apple 可能不会接受我的应用程序。）

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-06-01T22:43:03.980

您需要为 ARM 而不是 Intel 编译 Lua .a。如果 Lua 库使用 autoconf，你可以使用我最喜欢的 iphone/autoconf builder: [`build_for_iphoneos`](http://pseudogreen.org/blog/build_autoconfed_libs_for_iphone.html). 如果它不是 autoconf，那么您可以使用该脚本来了解如何攻击它。有时您可以只构建一个静态库 Xcode 项目，将所有文件转储到其中并点击构建。如果构建足够简单，它将为您完成大部分工作。

我知道这对您的使用无关紧要，但基于 Lua 的工具通常可以在应用商店中提供。您只是不能在运行时下载任意代码并对其进行解释。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-10-05T17:22:58.777

您可能想查看 iPhone Wax。它是一个 lua/iPhone 桥，让您可以在纯 lua 中编写原生 iPhone 应用程序！这是一个[很好的教程](http://www.mobileorchard.com/announcing-iphone-wax-native-uikit-iphone-apps-written-in-lua/)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-03-30T09:58:06.327

如果你想为 iOS 编写 Lua 代码，那么立即查看 MOAI：http: [//getmoai.com/](http://getmoai.com/)

它是在 iOS 和 Android 以及 Windows 和 OSX 上开发游戏的绝对令人愉快的框架。不仅如此，它还为如何正确实现基于 Lua-VM 的托管环境以跨平台方式编写脚本提供了一个很好的想法：从 MOAI 中，您可以学到很多这方面的知识。到目前为止，我已经用 MOAI 完成了 4 个标题，并且不会很快停止.. MOAI 绝对踢屁股！

另请查看 LOAD81，这是一项类似的工作，尽管使用 SDL 作为目标环境：http: [//github.com/antirez/load81](http://github.com/antirez/load81)

（我为 LOAD81 项目做出了一些贡献，特别是赋予它对 OpenPandora 社区感兴趣/有价值的功能。MOAI 更商业化，LOAD81 更业余..）

对于那些试图学习 Lua 以及将 Lua VM 集成到一个项目以实现多个平台目标的不同方法的人来说，MOAI 和 LOAD81 都可以提供很多很好的背景知识和关于正确方法的线索。

# entity-framework - 在实体框架中删除一个对象及其所有相关实体

> ID：937140
> 
> 赞同：26
> 
> 时间：2009-06-01T22:33:52.160
> 
> 标签：entity-framework, ado.net

有谁知道如何在不手动遍历对象图并删除每个对象的情况下删除 EF 中的对象及其所有相关实体？

例如，我有 SalesOrder 和 SalesOrderDetails，它们之间的关系是 1:N。当我删除 SalesOrder 时，我希望自动删除所有 SalesOrderDetails。

这在EF中可能吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-06-01T23:59:21.520

您不应该在实体框架中执行此操作。所有流行的关系数据库都支持`ON CASCADE DELETE`外键，这也更加有效。我建议你就这样吧。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-10-21T10:21:32.307

在这篇文章中，Alex Jamese（他发布了他的答案）有一篇关于这个主题的完整文章。

[关联](https://web.archive.org/web/20160125222743/http://blogs.msdn.com:80/b/alexj/archive/2009/08/19/tip-33-how-cascade-delete-really-works-in-ef.aspx)

> EF 负责 SaveChanges() 之后 ObjectContext 的正确性。因此，EF 尝试将 ObjectContext 与数据库中预期级联之后的预期数据库状态同步。一个明显的迹象是，如果您打开类似 SqlProfiler 的东西，**您会注意到当删除主体时，EF 会针对它知道的相关实体（即加载到 ObjectContext 中）发出 DELETE 请求。** 本质上，这里发生的是实体框架期望删除数据库中的主体，将删除它在数据库中的所有依赖项。所以它发出，应该是，一个冗余的 DELETE 来请求自己，以便从 ObjectContext 中删除已经加载的依赖项。需要注意的关键是 EF*不*检索所有依赖实体并为它们发出删除：它只删除已经在内存中的依赖项。

# .net - .NET 角色和 IIS7

> ID：937148
> 
> 赞同：0
> 
> 时间：2009-06-01T22:36:32.857
> 
> 标签：.net, roles

在 IIS7 中，我单击 .NET 角色并看到我的角色列表，但是当我单击角色时，没有用户显示，页面为空白。我已将用户添加到角色中，并且它确实在角色名称旁边显示了正确的计数。

这些东西是我想念的吗？

还有其他人分享这个问题吗？

这是一个错误吗？

感谢您的帮助！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-01T22:45:56.987

这是正常行为。.NET 角色部分管理角色提供者，但不管理角色中的用户。您将需要使用页面内的标准成员控制来管理用户。将 asp.net 部分的所有管理操作视为基本上是在编辑 web.config 文件。这完全是关于配置而不是应用程序管理。

# javascript - 来自数据库的图像上的 Javascript 图像映射

> ID：937149
> 
> 赞同：0
> 
> 时间：2009-06-01T22:36:39.907
> 
> 标签：javascript

我使用下面的 displayMainImage.php 链接调用图像，它工作正常，它从 mysql 数据库中提取图像名称。我现在正在尝试将图像映射连接到图像，该部分不起作用。这是否可能，如果可以，如何。下面的代码是在 php 站点上运行的 javascript 中。

```
<?php echo '
<script language="javascript">

function openit() {
newWindow = window.open(\'http://www.mysite.com/front_page/\', \'dfac\', \'width=900,height=700\');
}

</script>  
'; ?>  <br/>

<script language="JavaScript" type="text/javascript" 
src="http://www.mysite.com/idevaffiliate/displayMainImage.php?token=logo" usemap="#Map"> 
```

```
<map name="Map" id="Map">  
  <area shape="rect" coords="175,247,366,280" href="javascript:openit();" />
</map> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-01T23:16:48.360

是的，这是可能的。以下缺少的打开标签是错字吗？

```
area shape="rect" coords="175,247,366,280" href="javascript:openit();" /> 
```

应该：

```
<area shape="rect" coords="175,247,366,280" href="javascript:openit();" /> 
```

“usemap”属性应该在“img”元素上，而不是在脚本标签上。

另一方面，该函数的名称应该比“openit()”更具描述性。

# asp.net - 大型应用程序的附属部分的架构

> ID：937150
> 
> 赞同：1
> 
> 时间：2009-06-01T22:36:53.527
> 
> 标签：asp.net, architecture

我为一家在美国大多数州提供某些类型的金融咨询服务的公司工作。我们目前有一个相当简单的 CRUD 应用程序，可以管理客户以及我们为每个客户执行的资产和服务的相关信息。它只关注所有地点共有的基本数据点和流程——最小公分母。

现在，我们希望实现对跟踪因州而异的不同数据点和流程的支持，同时保留面向国家的核心系统。像这样：（ [来源：][[flickr.com](https://farm4.static.flickr.com/3353/3587038000_b0d2dacc08_o.png)][）][![NationalWithStates](https://i.stack.imgur.com/tkJAx.png)](https://i.stack.imgur.com/tkJAx.png)

我正在使用的堆栈是 ASP.Net 和 SQL Server 2008。国家应用程序是一个相当简单的 Web 表单。它的数据访问层是围绕 LINQ to SQL 实体和数据上下文的存储库包装器。目前除了 CRUD 操作之外几乎没有业务逻辑，但随着每个状态的复杂性的引入，会有更多的业务逻辑。

那么，如何植入卫星碎片...

*   刚开始关注功能并追求一个大泥球
*   构建一系列卫星应用程序，这些应用程序重复使用数据访问层，但在其他方面是独立的
*   将（金钱和/或时间）投资于规则引擎（类似于 Windows 工作流）并将每个状态的唯一位隔离为单独的规则集
*   像 MEF 一样在插件框架中投入（时间），并将每个状态的功能实现为插件
*   别的东西

理想的用户体验将显示为单个应用程序，该应用程序可以无缝地将其呈现和流程调整到用户正在使用的任何位置。这特别有用，因为一些用户使用多种状态的资产。因此，对二号人物进行了罢工。

我没有使用 MEF 或 WF 的经验，所以我的问题在很大程度上是我的问题是否是要解决的问题类型。根据炒作，它们听起来有点像，但结果可能是圆孔的方形钉。

在所有情况下，每个州都会引入新的数据点，而不仅仅是新的流程，所以我想数据访问层会增长以适应新表和列的添加，但我也完全支持替代方案。

**编辑：**我试着想一些我可以分享的例子。一种可能是在一个州，我们提交了涉及客户资产的某些法律文件。备案具有不同于可能需要类似备案的其他州的属性和工作流程，并且所涉及的资产可能具有完全不同的属性。其他州可能根本没有类似的文件，还有一些州可能有一系列不断升级的文件，需要了解该州独有的其他相关实体。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T05:38:09.633

从[策略](http://en.wikipedia.org/wiki/Strategy_pattern)设计模式开始，它基本上允许你勾勒出一个“占位符”，在运行时被具体的类替换。

您必须在核心应用程序和“插件”之间勾勒出一个清晰的界面，并且您让每个策略都实现它。然后，在运行时，当您知道用户正在处理哪个状态时，您可以实例化适当的状态策略类（可能使用[工厂方法](http://en.wikipedia.org/wiki/Factory_method)），并在其上调用通用方法，例如类似

```
IStateStrategy stateStrategy = StateSelector.GetStateStrategy("TX"); //State id from db, of course...
stateStrategy.Process(nationalData); 
```

当然，这些策略中的每一个都应该使用现有的数据层等。

此解决方案的（明显）缺点是您将对每个状态的规则进行硬编码，并且您无法在不更改代码的情况下透明地添加新规则（或新状态）。不要被愚弄，[这不是一件坏事](http://thedailywtf.com/articles/soft_coding.aspx)——你的业务逻辑*应该*在代码中实现，即使它依赖于运行时数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T23:01:55.863

只是一个想法：无论你做什么，首先完全编码 3 个状态（使用 2 个你仍然很想重复相同的代码，如果你决定更改设计，那么它太耗时了）。

我必须承认我对规则或WF完全一无所知。但是，在没有任何额外语言/程序的情况下，难道不可能只拥有一个大而愚蠢的 ASP.Net 包含文件，其中包含与主逻辑分离的状态指令吗？

**编辑：**或者仅仅是每个州都引用了很多完全不同的功能，而不仅仅是一些位？

# reverse-proxy - Apache Config 将子目录发送到不同的服务器 - mod_proxy

> ID：937156
> 
> 赞同：1
> 
> 时间：2009-06-01T22:38:27.063
> 
> 标签：reverse-proxy, apache-config, mod-proxy

我们使用 Apache 作为反向代理服务器。这一直运作良好，但我现在需要有[http://domain.com/sub1](http://domain.com/sub1)代理到 serverA 和[http://domain.com/sub2](http://domain.com/sub2)代理到 serverB。这可能吗？如果是这样，它的配置是什么？

这是我现有的配置：

```
...
<VirtualHost 555.55.555.555:80>
ServerName domain.com
DocumentRoot c:/docroot

ProxyPass / http://serverA/
ProxyPassReverse / http://serverA/
</VirtualHost>
... 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-01T22:50:27.820

你几乎明白了。你想要这样的东西：

```
ProxyPass /sub1 http://serverA/
ProxyPassReverse /sub1 http://serverA/
ProxyPass /sub2 http://serverB/
ProxyPassReverse /sub2 http://serverB/ 
```

查看[ProxyPass 指令](http://httpd.apache.org/docs/2.0/mod/mod_proxy.html#proxypass)的文档，您可以使用它做一些巧妙的技巧。

# wpf - 如何创建包含具有公共超类的对象的 F# 列表？

> ID：937157
> 
> 赞同：2
> 
> 时间：2009-06-01T22:38:51.807
> 
> 标签：wpf, list, f#, types, supertype

我有两个功能，水平和垂直，用于布置控件。他们是这样工作的：

```
let verticalList = vertical [new TextBlock(Text = "one"); 
                             new TextBlock(Text = "two"); 
                             new TextBlock(Text = "three")] 
```

现在verticalList是一个垂直显示三个文本块的控件：

```
one
two
three 
```

以下是定义：

```
let horizontal controls = 
    let wrap = new WrapPanel() in
    List.iter (wrap.Children.Add >> ignore) controls ;
    wrap

let vertical controls = 
    let stack = new StackPanel() in
    List.iter (stack.Children.Add >> ignore) controls ;
    stack 
```

当我组合不同类型时出现问题：

```
let foo = vertical [new TextBlock(Text = "Title"); vertical items] 
```

这抱怨列表的元素不是同一类型。这是真的，但它们有一个共同的超类型（UIElement）。

我知道我可以使用 :> UIElement 向上转换列表中的两个项目，但这是一个丑陋的解决方案。F# 可以推断出常见的超类型。如果不是，为什么不呢？

如果好看就太好了

```
vertical [X; Y; Z] 
```

不必成为

```
vertical [(X :> UIElement); (Y :> UIElement); (Z :> UIElement)] 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-01T22:59:14.150

有几种方法，包括

```
type Animal() = class end
type Cat() =
    inherit Animal()
type Dog() =
    inherit Animal()
let animals1 : list<Animal> = [upcast new Cat(); upcast new Dog()]
let animals2 = ([upcast new Cat(); upcast new Dog()] : list<Animal>)
let animals3 = [(new Cat() :> Animal); upcast new Dog()] 
```

动物1：在 var 声明中的类型注释，向上转换每个元素

动物2：列表表达式上的类型注释，向上转换每个元素

动物3：第一个元素的显式类型，向上转换的休息

在 F# 的未来版本中，向上转换可能变得不必要了。

（另见[http://cs.hubfs.net/forums/thread/9953.aspx](http://cs.hubfs.net/forums/thread/9953.aspx)，但那里没有“新”。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-09T11:59:17.377

如果您同意为了可读性而牺牲类型安全，那么您就是解决方法：

```
open System
let to_list (tuple: Object) = 
    let rec list_after_index (n: int) = 
        let prop = tuple.GetType().GetMethod("get_Item"+n.ToString())
        match prop with
            | null -> []
            | _ -> prop.Invoke(tuple, [||]) :: list_after_index(n+1)
    match tuple with 
        | :? unit -> []
        | _ when tuple.GetType().FullName.Contains(".Tuple`") -> list_after_index(1)
        | _ -> [tuple] 
```

那么你可以像这样使用它：

```
> to_list ();;
val it : obj list = []
> to_list (1);;
val it : obj list = [1]
> to_list([], 1, "2", 3.0);;
val it : obj list = [[]; 1; "2"; 3.0] 
```

例如，在您的垂直功能内。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T01:01:58.413

我更喜欢我之前的答案，但在此基础上，如果您有一个应用程序，您不断创建非同质动物列表，您可以随时执行以下操作：

```
let Animalize (x:Animal) = x  // define a function to upcast
let animals4 = [ Animalize <| new Cat(); Animalize <| new Dog()]
// or even
let (~++) = Animalize // define a prefix operator to upcast (~ makes it prefix)
let animals5 = [ ++ new Cat(); ++ new Dog()] 
```

最后一个几乎可以肯定是对运算符的滥用，除非您处于一个非常专业的领域并且您经常需要像这样的强制，并且您愿意为了简洁而牺牲固有的可读性。

# vb.net - 从本地时间转换为 UTC（给定本地时区）

> ID：937159
> 
> 赞同：1
> 
> 时间：2009-06-01T22:39:10.260
> 
> 标签：vb.net

我在不同的时区约会。

如何将它们转换为 UTC 并给出相应的时区。

像这样的东西：

```
Dim Dated as DateTime = TempDate.ConvertToUniversalTime(TimeZone) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-01T22:53:30.670

.net 中的[DateTime](http://msdn.microsoft.com/en-us/library/system.datetime.aspx)对象提供了[DateTime.ToUniversalTime](http://msdn.microsoft.com/en-us/library/system.datetime.touniversaltime.aspx)方法。由于您使用的是 VB [Date](http://msdn.microsoft.com/en-us/library/3eaydw6e(VS.80).aspx)类型，[DateTime.FromOADate](http://msdn.microsoft.com/en-us/library/system.datetime.fromoadate(VS.80).aspx)和[DateTime.ToOAdate](http://msdn.microsoft.com/en-us/library/system.datetime.tooadate(VS.80).aspx)将提供 Date 和 DateTime 类型之间的转换（请参阅[此处](http://msdn.microsoft.com/en-us/library/3eaydw6e(VS.80).aspx)*编程技巧*下的*互操作注意事项*）。

 ***更新：**您可能还想查看[Converting Times Between Time Zones](http://msdn.microsoft.com/en-us/library/bb397769.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-01T23:42:10.650

这是怎么做的

```
Dim TimeZone As TimeZoneInfo = TimeZoneInfo.FindSystemTimeZoneById("W. Europe Standard Time")
Dim Dated As DateTime = TimeZoneInfo.ConvertTimeToUtc(TempDate, TimeZone) 
```

对于 TimeZones ID 检查：

```
TimeZone.GetSystemTimeZones 
```

# linux - 如何使用 inittab 自动重启 PHP 程序？

> ID：937160
> 
> 赞同：1
> 
> 时间：2009-06-01T22:39:52.130
> 
> 标签：linux

似乎它有一个重生参数，

但是我还没有弄清楚如何使用它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-01T22:41:14.920

如

```
mine:234:respawn:/usr/local/bin/myscript 
```

请参阅此页面以获得很好的解释

[http://aplawrence.com/Unixart/startup.html](http://aplawrence.com/Unixart/startup.html)

一个更详细的例子：

```
# Level to run in
id:2:initdefault:

# Boot-time system configuration/initialization script.
si::sysinit:/etc/rc.sysinit

# What to do in single-user mode.
~:S:wait:/sbin/sulogin

# /etc/init.d executes the S and K scripts upon change
# of runlevel.
#
# Runlevel 0 is halt.
# Runlevel 1 is single-user.
# Runlevels 2-5 are multi-user.
# Runlevel 6 is reboot.

l0:0:wait:/etc/rc 0
l1:1:wait:/etc/rc 1
l2:2:wait:/etc/rc 2
l3:3:wait:/etc/rc 3
l4:4:wait:/etc/rc 4
l5:5:wait:/etc/rc 5
l6:6:wait:/etc/rc 6

# What to do at the "3 finger salute".
ca::ctrlaltdel:/sbin/shutdown -t3 -r now

# Runlevel 2,3: getty on virtual consoles
# Runlevel   3: mgetty on terminal (ttyS0) and modem (ttyS1)
1:23:respawn:/sbin/mingetty tty1
2:23:respawn:/sbin/mingetty tty2
3:23:respawn:/sbin/mingetty tty3
4:23:respawn:/sbin/mingetty tty4
S0:3:respawn:/sbin/agetty ttyS0 9600 vt100-nav
S1:3:respawn:/sbin/mgetty -x0 -D ttyS1 
```

# javascript - JavaScript 和 Jaws 屏幕阅读器

> ID：937165
> 
> 赞同：1
> 
> 时间：2009-06-01T22:41:10.333
> 
> 标签：javascript, asp.net, .net, accessibility, jaws-screen-reader

我正在着手一个项目，其中对 WCAG 2.0 的可访问性和在 JAWS 屏幕阅读器中使用 Web 应用程序的能力是关键要求。

我正在寻找有关 JAWS 如何处理 Javascript 的见解，这是完全不行还是 JAWS 足够聪明以应对！？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-01T23:18:55.250

我是一个下巴用户，简短的回答是它主要是有效的。在不知道您的确切要求的情况下，我不能非常具体。基本 html 视图中的 gmail 之类的应用程序可以完美运行，普通视图中的 gmail 可以正常工作，尽管我经常使用下颚光标来模拟鼠标，stackoverflow 工作正常，谷歌电子表格完全无法访问，谷歌文档几乎无法访问，谷歌阅读器工作正常，尽管我必须使用颚形光标单击展开或列表视图等选项。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T15:45:51.587

您应该研究[ARIA](http://www.w3.org/WAI/intro/aria)，这就是标准正在朝着使 JavaScript 更易于访问的方向发展。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-01T23:45:52.933

jaws 不了解 javascript，它只是读取屏幕并执行一些操作。它只是一个浏览器插件。
不久前，我正在从事一个具有类似要求的项目。我们使用了专为可访问性设计的 YAML css 框架。而且我们只使用了一些 ajax 和 javascript 改进。
我希望[这个](http://v1.boxofchocolates.ca/archives/2005/06/12/javascript-and-accessibility)和[这个](http://juicystudio.com/article/improving-ajax-applications-for-jaws-users.php)链接也能帮助你。

# php - 登录系统就像stackoverflow的，用php编写的

> ID：937168
> 
> 赞同：17
> 
> 时间：2009-06-01T22:41:25.903
> 
> 标签：php, openid, oauth

**问题**有没有一种简单的方法来实现stackoverflow使用php的登录系统？

很长一段时间以来，我一直在开发网站，并使用典型的 Web 表单用户名/密码和 mysql 数据库来登录系统。

我想拥有它，这样用户就可以使用 google、yahoo、facebook 等登录系统，而不必记住一些长的 openid url（他们应该只需点击 google 并能够使用他们的用户名/密码登录） ）。

我不希望使用服务提供商（例如 RPX）来实现这一点。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-01T22:50:09.410

如果您想自己实现它，[这里](http://remysharp.com/2007/12/21/how-to-integrate-openid-as-your-login-system/)有一个很棒的演练。还有[PHP OpenID Library](http://openidenabled.com/php-openid/)，但这可能比您需要的要多得多。

[这](http://code.google.com/p/openid-selector/)是 SO 在其登录屏幕上使用的客户端 OpenID 选择器。

编辑：堆栈溢出不再使用我链接到的那个，但据我所知它仍然有效。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-01T22:50:15.277

检查单击这些按钮会将您发送到哪些页面，然后将您的用户重定向到这些页面。他们都是“openid”提供者，所以你只需要一个开放的 id 库来验证响应。

我在 PHP [http://openidenabled.com/php-openid/](http://openidenabled.com/php-openid/)中使用了这个。他们在该软件包中有一些很好的示例可以帮助您入门。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T00:17:16.303

如果您正在考虑使用预先存在的代码，[Zend 框架](http://framework.zend.com/manual/en/zend.openid.html)提供了 OpenID 支持。虽然库本身相当大，但您应该能够以相对独立的方式来处理各个组件。

# vb.net - 将希腊字符转换为 Unicode

> ID：937172
> 
> 赞同：2
> 
> 时间：2009-06-01T22:43:03.280
> 
> 标签：vb.net, unicode

是否有任何简单的方法可以将 windows-1252 字符串转换为 Unicode 字符串？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-01T23:18:06.173

.NET 中的所有字符串在内存中都是 Unicode。如果您有一个从 1252 编码的字符串生成的*字节数组，您可以使用*

```
Dim S as String = System.Text.Encoding.GetEncoding(1252).GetString(array) 
```

它现在是内存中的 unicode 字符串。如果您想将该字符串编码为 UTF-8 字节数组以进行传输或存储，则相反：

```
Dim A as byte() = System.Text.Encoding.GetEncoding("UTF-8").GetBytes(S) 
```

（我认为这是正确的 VB 语法！）

# algorithm - 如何将非线性范围指向线性和反向？

> ID：937177
> 
> 赞同：0
> 
> 时间：2009-06-01T22:44:58.923
> 
> 标签：algorithm, range, intervals

我有一个代表一个大范围的线性范围列表：

```
 X'
 100    200 300    400 500    600 700     |       900    (X)
|----------|----------|----------|--------+----------|
 0                                        |       100    (Y)
                                          Y' 
```

X 由以下范围组成（*偶数和整数只是为了便于理解的示例，它们可以是任何东西，这里根本没有比例*）：

*   从 100 到 200
*   从 300 到 400
*   从 500 到 600
*   从 700 到 900

另一方面，Y 只有一个范围：

*   从 0 到 100

X 和 Y 的长度相同，只是单位不同。假设一个是美元，另一个是百分比（或任何其他类似不相关的单位）。所以 Y'0 == X'100 和 Y'100 == X'900。

给定 Y 中的任何点，X 中的等价点是什么，反之亦然，给定 X 中的一个点 - Y 中的什么？

这是一道典型的数学题吗？它有名字吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-01T23:37:35.633

你有多少个范围？算法为 O（范围数）是否可以接受？

如果是这样，下面是算法的描述。让我在您的（原始）示例中解释一下。

```
 100    200 300    400 500    600 700    800
|----------|----------|----------|----------|
 0%                                     100% 
```

1）您要做的是将范围A（100-800）中的值X映射到连续范围B（0-399）中的值Y（因为您范围内的元素总数为400）。然后很容易将B中的位置更改为百分比，我将省略这部分。

2）创建记录列表，其中每条记录代表一个范围映射。

```
struct RangeRecord {
  int start_in_a;
  int start_in_b;
}; 
```

在您的情况下，您将获得以下列表：

```
{100, 0}, {300, 100}, {500, 200}, {700, 300} 
```

3）当您需要将数字 X 从 A 映射到 B 时，您迭代列表以找到 start_in_a <= X 的第一条记录。那么您的值 Y 是

```
Y = X + start_in_b - start_in_a; 
```

4）算法是对称的，你只需迭代列表以找到 start_in_b <= Y 的第一条记录，然后

```
X = Y + start_in_a - start_in_b. 
```

注意 1\. 出于错误检查的目的，您也可以将范围大小保留在 RangeRecord 中。

注意 2\. 如果 O（范围数）不够好，请将记录保留为树而不是列表。然后，您将需要 O(log(number of range)) 操作，

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T23:55:24.180

在从某些 X' 转换为 Y' 时，您需要调整三件事，反之亦然：

1.  范围从不同的地方开始。
2.  其中之一是不连续的。
3.  每个步骤的大小在两个范围之间是不同的。

考虑一个类似的范围 Z 可能会有所帮助（至少在开发您的解决方案时），该范围是 0 到 503 的范围，并且与 X 中的 504 个可能值具有一对一的映射。也就是说，对于每个不连续性，如果 X 值大于不连续的上端，则减​​去 99（不连续的大小）。那么X'100 = Z'0, X'200 = Z'100, X'300 = Z'101, X'400 = Z'201, X'500 = Z'202等。引入Z范围解决了上面列表中的问题 1 和 2。

要将 Z 转换为 Y，您只需乘以 101/504，它将 Z 缩放到 Y。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-01T23:01:14.757

假设您有一个范围（a，b）和另一个范围（c，d）。现在你有一个数字 i，它的 a < i < b。您可以通过减去 a 并除以 b - a 来“标准化”它 - 这会给您一个介于 0 和 1 之间的值。然后您可以使用此值通过将此计算与其他边界相反来将其转移到其他范围，因此说把它乘以 (d - c) 并加上 c。

假设另一个范围内的对应点是 i'。然后，

```
i' = (i - a) / (b - a) * (d - c) + c 
```

您正在搜索的术语是缩放和平移。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-01T23:16:33.117

这并不是真正可以解决的，因为问题未得到充分说明。即使对于相同的范围，也可以有不同的滑块，如下所示：

```
1  100 101       1000
|-----|-----------|

1        100 101 1000
|-----------|-----| 
```

对于每个范围，`[1..100]`您需要知道滑块上的哪些百分比点与其对应。在上面的示例中，这可能类似于`[0%..33%]`or `[0%..66%]`。一旦您获得了这些信息，就很容易确定给定数据点位于哪个范围内以及该范围的哪个位置以及它对应的值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-01T23:34:58.650

假设您暗示的分段线性排列，您可以通过以下方式找到 X：

```
X = 4*Y + 100*int(1 + Y/25.) 
```

而 Y 则相反：

```
X2 = int(X/100.)
X3 = X2-int(X2/2.)
Y = (X-100*X3)/4. 
```

编辑：此解决方案适用于您提供的原始范围：

```
 100    200 300    400 500    600 700    800
|----------|----------|----------|----------|
 0%                                     100% 
```

当然，反向公式仅适用于 X 的有效值。

这是两条曲线的图。绿色是您的原始规格，蓝色是反向曲线（同样，仅对有效的 x 值有效）。 [替代文字 http://img523.imageshack.us/img523/8858/66945008.png](http://img523.imageshack.us/img523/8858/66945008.png)

# sql-server - SQL Server 2000 死锁

> ID：937178
> 
> 赞同：1
> 
> 时间：2009-06-01T22:45:47.970
> 
> 标签：sql-server, sql-server-2000, deadlock

我们在生产 SQL Server 2000 数据库中遇到了一些非常烦人的死锁情况。

主要设置如下：

*   SQL Server 2000 企业版。
*   服务器使用 ATL OLE 数据库以 C++ 编码。
*   所有数据库对象都通过存储过程进行访问。
*   所有 UPDATE/INSERT 存储过程都将其内部操作包装在 BEGIN TRANS ... COMMIT TRANS 块中。

我在网上收集了几篇类似[这样](http://www.simple-talk.com/sql/learn-sql-server/how-to-track-down-deadlocks-using-sql-server-2005-profiler/)的文章后，用 SQL Profiler 收集了一些初步的痕迹（*忽略它是指 SQL Server 2005 工具，同样的原则适用*）。**从跟踪来看，这似乎是两个 UPDATE 查询之间的死锁。**

我们已经采取了一些措施来降低问题发生的可能性，例如：

*   **选择（不锁定）**。我们已将存储过程中的所有 SELECT 查询更改为使用 WITH (NOLOCK)。我们了解脏读的含义，但查询的数据并不那么重要，因为我们进行了大量的自动刷新，并且在正常情况下 UI 将具有正确的值。
*   **阅读未提交**。我们已将服务器代码上的事务隔离级别更改为 READ UNCOMMITED。
*   **缩小交易范围**。我们减少了事务被保持的时间，以最大限度地减少发生数据库死锁的可能性。

我们还质疑我们在大多数存储过程中都有一个事务（BEGIN TRANS ... COMMIT TRANS 块）。在这种情况下，我的猜测是事务隔离级别是 SERIALIZABLE，对吧？如果我们在调用存储过程的源代码中也指定了事务隔离级别，那又会怎样呢？

这是一个处理密集型应用程序，我们在数据库中大量读取（更大的百分比）和一些写入。

**如果这是一个 SQL Server 2005 数据库，我可以使用[Geoff Dalgas 回答有关 Stack Overflow 的死锁问题](https://stackoverflow.com/questions/20047/diagnosing-deadlocks-in-sql-server-2005/21158#21158)**，如果这甚至适用于我遇到的问题。但目前升级到 SQL Server 2005 并不是一个可行的选择。

由于这些最初的尝试失败了，我的问题是：**你将如何从这里开始？**您将采取哪些步骤来减少甚至避免发生死锁，或者我应该使用哪些命令/工具来更好地暴露问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-01T23:14:56.693

几点评论：

1.  在存储过程中明确指定的隔离级别会覆盖调用者的隔离级别。

2.  如果 sp_getapplock 在 2000 上可用，我会使用它：

    [http://sqlblogcasts.com/blogs/tonyrogerson/archive/2006/06/30/855.aspx](http://sqlblogcasts.com/blogs/tonyrogerson/archive/2006/06/30/855.aspx)

3.  在许多情况下，可序列化的隔离级别会增加出现死锁的机会。

4.  2000年的好资源：

    [http://www.code-magazine.com/article.aspx?quickid=0309101&page=1](http://www.code-magazine.com/article.aspx?quickid=0309101&page=1)

Bart Duncan 的一些建议也可能适用：

[http://blogs.msdn.com/bartd/archive/2006/09/09/747119.aspx](http://blogs.msdn.com/bartd/archive/2006/09/09/747119.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T05:37:20.493

我的猜测是您遇到了死锁，或者：

1.  因为您的 DML（可能更新）语句正在升级到表锁，或者
2.  不同的存储过程在事务中访问相同的表，但顺序不同。

为了解决这个问题，我将首先检查存储过程，并确保修改语句具有它们需要的索引。

注意：这适用于目标表和源表（尽管 NOLOCK，UPDATE 的源表也会获得锁。检查查询计划以扫描用户存储过程。与批处理或批量操作不同，大多数用户查询和 DML 都适用表行的一小部分，因此不应该锁定整个表。

其次，我会检查存储过程以确保存储过程中的所有数据访问都以一致的顺序进行（通常首选父级 -> 子级）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-29T07:29:56.030

在我的设置场景中死锁的原因是所有索引。我们使用（默认生成）`non clustered`表的主键索引。更改为`clustered`索引解决了这个问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T04:36:01.333

除了亚历克斯的回答：

*   观察代码以查看是否以相同的顺序访问表。我们最近这样做了，并将代码重新排序为始终先父后子。系统变大了，代码和功能更复杂，用户更多：我们只是开始陷入死锁。

~~- 查看是否可以缩短事务（例如，稍后开始，更早完成，更少处理）~~

*   确定您希望哪些代码不会失败并在另一个代码中使用 SET DEADLOCK PRIORITY LOW 我们已经使用了这个（SQL 2005 在这里有更多选项）来确保某些代码永远不会死锁并牺牲其他代码。

*   如果您在事务开始时有 SELECT 来准备一些东西，请考虑 HOLDLOCK（可能是 UPDLOCK）在持续时间内保持锁定状态。我们偶尔会使用它，因此停止其他进程对该表的写入。

# c# - C# 模式以防止事件处理程序被钩住两次

> ID：937181
> 
> 赞同：108
> 
> 时间：2009-06-01T22:46:49.137
> 
> 标签：c#, event-handling, delegates

重复：[如何确保一个事件只订阅一次](https://stackoverflow.com/questions/367523/how-to-ensure-an-event-is-only-subscribed-to-once) 并且[已经添加了一个事件处理程序？](https://stackoverflow.com/questions/136975/has-an-event-handler-already-been-added)

我有一个提供一些服务的单例，我的类挂钩到它上面的一些事件，有时一个类会挂钩两次事件，然后被调用两次。我正在寻找一种经典的方法来防止这种情况发生。不知何故，我需要检查我是否已经迷上了这个事件......

* * *

## 回答 #1

> 赞同：193
> 
> 时间：2009-07-09T14:33:38.573

先用 删除事件怎么样`-=`，如果没有找到，不会抛出异常

```
/// -= Removes the event if it has been already added, this prevents multiple firing of the event
((System.Windows.Forms.WebBrowser)sender).Document.Click -= new System.Windows.Forms.HtmlElementEventHandler(testii);
((System.Windows.Forms.WebBrowser)sender).Document.Click += new System.Windows.Forms.HtmlElementEventHandler(testii); 
```

* * *

## 回答 #2

> 赞同：159
> 
> 时间：2009-06-01T22:58:45.090

显式实现事件并检查调用列表。您还需要检查 null：

```
using System.Linq; // Required for the .Contains call below:

...

private EventHandler foo;
public event EventHandler Foo
{
    add
    {
        if (foo == null || !foo.GetInvocationList().Contains(value))
        {
            foo += value;
        }
    }
    remove
    {
        foo -= value;
    }
} 
```

使用上面的代码，如果调用者多次订阅事件，它将被简单地忽略。

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2013-06-20T20:15:55.163

我已经测试了每种解决方案，最好的一个（考虑性能）是：

```
private EventHandler _foo;
public event EventHandler Foo {

    add {
        _foo -= value;
        _foo += value;
    }
    remove {
        _foo -= value;
    }
} 
```

无需使用 Linq。在取消订阅之前无需检查 null（有关详细信息，请参阅 MS EventHandler）。无需记住到处退订。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-06-01T23:38:02.857

您确实应该在接收器级别而不是源级别处理此问题。也就是说，不要在事件源处规定事件处理程序逻辑 - 将其留给处理程序（接收器）本身。

作为一个服务的开发者，你是谁说 sinks 只能注册一次呢？如果他们出于某种原因想要注册两次怎么办？如果您试图通过修改源来纠正接收器中的错误，那么这也是在接收器级别纠正这些问题的一个很好的理由。

我相信你有你的理由；重复接收器非法的事件源并非深不可测。但也许您应该考虑另一种架构，使事件的语义保持不变。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-06-01T22:54:42.367

您需要在事件上实现添加和删除访问器，然后检查委托的目标列表，或者将目标存储在列表中。

在 add 方法中，您可以使用[Delegate.GetInvocationList](http://msdn.microsoft.com/en-us/library/system.delegate.getinvocationlist.aspx)方法获取已添加到委托的目标列表。

由于委托被定义为如果它们链接到同一目标对象上的同一方法时比较相等，因此您可能可以遍历该列表并进行比较，如果您发现没有比较相等的，则添加新的。

这是示例代码，编译为控制台应用程序：

```
using System;
using System.Linq;

namespace DemoApp
{
    public class TestClass
    {
        private EventHandler _Test;

        public event EventHandler Test
        {
            add
            {
                if (_Test == null || !_Test.GetInvocationList().Contains(value))
                    _Test += value;
            }

            remove
            {
                _Test -= value;
            }
        }

        public void OnTest()
        {
            if (_Test != null)
                _Test(this, EventArgs.Empty);
        }
    }

    class Program
    {
        static void Main()
        {
            TestClass tc = new TestClass();
            tc.Test += tc_Test;
            tc.Test += tc_Test;
            tc.OnTest();
            Console.In.ReadLine();
        }

        static void tc_Test(object sender, EventArgs e)
        {
            Console.Out.WriteLine("tc_Test called");
        }
    }
} 
```

输出：

```
tc_Test called 
```

（即只有一次）

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-08-13T14:28:01.730

Microsoft 的[Reactive Extensions (Rx) 框架](http://msdn.microsoft.com/en-us/devlabs/ee794896.aspx)也可用于“仅订阅一次”。

给定鼠标事件 foo.Clicked，以下是订阅和仅接收单个调用的方法：

```
Observable.FromEvent<MouseEventArgs>(foo, nameof(foo.Clicked))
    .Take(1)
    .Subscribe(MyHandler);

...

private void MyHandler(IEvent<MouseEventArgs> eventInfo)
{
   // This will be called just once!
   var sender = eventInfo.Sender;
   var args = eventInfo.EventArgs;
} 
```

除了提供“订阅一次”功能之外，RX 方法还提供了将事件组合在一起或过滤事件的能力。这很漂亮。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-06-19T14:35:47.967

创建一个动作而不是一个事件。您的课程可能如下所示：

```
public class MyClass
{
                // sender   arguments       <-----     Use this action instead of an event
     public Action<object, EventArgs> OnSomeEventOccured;

     public void SomeMethod()
     {
          if(OnSomeEventOccured!=null)
              OnSomeEventOccured(this, null);
     }

} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-01T22:56:48.180

让您的单例对象检查它的通知对象列表，如果重复则只调用一次。或者，如果可能，拒绝事件附件请求。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-08-23T18:24:10.493

在 Silverlight 中，你需要说 e.Handled = true; 在事件代码中。

```
void image_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
{
    e.Handled = true; //this fixes the double event fire problem.
    string name = (e.OriginalSource as Image).Tag.ToString();
    DoSomething(name);
} 
```

如果这有帮助，请勾选我。

# .net - 转义 SQL 查询 - 支持 .Net 中的不同数据库平台

> ID：937184
> 
> 赞同：1
> 
> 时间：2009-06-01T22:47:59.760
> 
> 标签：.net, sql, database, projects

是否有 .Net 项目/dll 支持将用户提供的输入转义到各种数据库系统的数据库查询？

我希望我们的整个团队标准化并使用一个模块来执行用户提供的输入的转义，然后将其用于参数化的 SQL 查询。

理想情况下，我想在配置文件中指定数据库系统（oracle、SqlServer、mySql 等）并能够调用 Escape(variableName)，它会根据 web.xml 中的当前数据库设置转义字符串内容。配置文件。

如果不是，那么下一个最好的东西就是 EscapeForOracle、EscapeForSqlServer 等。

该项目至少应支持 Oracle、SqlServer 和 MySql。

我想知道我是否需要在内部创建这个，或者是否存在现有的商业/开源产品来做到这一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-01T22:52:05.663

我不认为你会需要这样的东西。

运行参数化查询/存储过程时，请使用参数集合。
指定适当的数据类型、长度、精度并提供有效值。
转义将由数据库提供者完成。

如果我没有正确理解您的问题，请告诉我。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T23:11:47.463

在 .NET 中，您可以使用 DbReader 和 DbConnection 等通用类来代替 SqlConnection。就像 shahkalpesh 和 Lasse V. Karlsen 所说，您可以使用参数，框架或驱动程序将为您处理转义。

但实际上，如果您希望同时为 Oracle 和 Sql Server 开发产品，那么您说的是主要开销。正确逃避只是冰山一角。如果您还没有安装 Oracle 和 Sql Server 测试服务器，那么您可能还没有开始 :)

# c# - 根据 Msdn GridView.DataKeyNames 必须设置如果我们要更新数据库

> ID：937197
> 
> 赞同：2
> 
> 时间：2009-06-01T22:52:22.950
> 
> 标签：c#, asp.net, gridview, ado.net

> 使用*DataKeyNames*属性指定表示数据源主键的一个或多个字段。您必须设置*DataKeyNames*属性才能使 GridView 控件的*自动更新*和删除功能起作用。

a）根据上面的报价，只有在设置了 DataKeyNames 时才可以更新，但即使我没有设置 DataKeyNames，我也能够更新数据库。

b）或者术语*自动更新*是否意味着其他？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T02:08:38.077

GridView 或 Formview 可以支持自动更新，前提是它与某种正确配置的 *Datasource（ObjectDataSource、SqlDataSource 等）一起使用。对于删除/更新操作，需要唯一键，因此需要 DataKeyNames 集合。例如，如果 DataSource 是强类型数据集，它会自动开箱即用。

# c# - 在 C# 中以编程方式创建 HTML 网页

> ID：937201
> 
> 赞同：8
> 
> 时间：2009-06-01T22:53:53.023
> 
> 标签：c#, html

我想知道：有没有一种方法可以像使用 XML 一样在 C# 中以编程方式创建 HTML 文件？我的是一个控制台应用程序，所以可能有些选项不可用。基本上，我想做一些比仅仅构建一个大字符串更聪明的事情。

可能的情况：

而不是写：

```
 string html="<html><head>Blah</head><body>{0}</html>", myotherstring 
```

我想像在 XML 中一样工作

```
 XmlTextWriter w = new XmlTextWriter(xml_file_path + xml_file_name,
                                        System.Text.Encoding.UTF8);

     w.WriteProcessingInstruction("xml", "version='1.0' encoding='UTF-8'");

     // construct xml
     XmlElement root = xmlDoc.CreateElement("element");

     ...

     xmlDoc.Save(w);
     w.Close(); 
```

为这个幼稚的问题道歉。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-01T23:11:34.610

不要忘记：您可以像使用 XmlTextWriter 方法生成纯 XML 一样轻松地生成 XHTML。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-01T23:07:50.827

您可以使用 NVelocity。它是 Java Velocity 模板系统的 .Net 端口。该 API 与 XmlWriter 不同。相反，您将使用简单的脚本语言编写一个文本文件，将您的对象放入一个“上下文”中，然后将模板和上下文合并以生成 HTML 文件。

[速度](https://github.com/castleproject/NVelocity)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-03-16T12:58:41.313

您可以使用一些第三方开源库来生成强类型验证 (X)HTML，例如[CityLizard Framework](http://citylizard.codeplex.com/ "CityLizard 框架")或 Sharp DOM。

例如

```
html
    [head
        [title["Title of the page"]]
        [meta_(
            content: "text/html;charset=UTF-8",
            http_equiv: "Content-Type")
        ]
        [link_(href: "css/style.css", rel: "stylesheet", type: "text/css")]
        [script_(type: "text/javascript", src: "/JavaScript/jquery-1.4.2.min.js")]
    ]
    [body
        [div
            [h1["Test Form to Test"]]
            [form_(action: "post", id: "Form1")
                [div
                    [label["Parameter"]]
                    [input_(type: "text", value: "Enter value")]
                    [input_(type: "submit", value: "Submit!")]
                ]
            ]
            [div
                [p["Textual description of the footer"]]
                [a_(href: "http://google.com/")
                    [span["You can find us here"]]
                ]
                [div["Another nested container"]]
            ]
        ]
    ]; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-04-19T06:39:37.417

我意识到这个问题已经过时了，但是最近发布的 ASP.Net MVC 3 Razor 视图引擎现在让您可以选择使用相同的 Razor 视图引擎为任何目的生成 HTML。

有关如何执行此操作的指南，请参阅[在 ASP.Net 之外托管 Razor 。](http://vibrantcode.com/blog/2010/11/16/hosting-razor-outside-of-aspnet-revised-for-mvc3-rc.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-01T22:58:43.247

几个月前我做了什么，我有一个 asp.net 文件 (aspx) 作为模板保存在文本文件中，每当用户需要新页面时，我只需将该模板复制到用户指定的文件夹中，更改扩展名.txt 到 .aspx，并根据用户的需要以编程方式添加一些选项。虽然这是一个简单的页面。当然，你越复杂，代码就越复杂。

# javascript - 在不使用 jQuery 或任何其他库的情况下实现 blockUI 功能的最佳方法？

> ID：937202
> 
> 赞同：0
> 
> 时间：2009-06-01T22:54:14.660
> 
> 标签：javascript

尽管我很喜欢 jQuery，但并不总是可以使用开源库（原因与技术无关）。如何最好地使用原始 javascript 实现 BlockUI 功能？我真的只想让用户知道浏览器很忙，并阻止用户进行更多选择。我的 jQuery-less 情况碰巧只涉及 IE 6，所以此时我只对 IE 6 感兴趣。我试图避免“复制/粘贴 BlockUI 的相关部分”类型的解决方案。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-01T22:58:28.583

总体思路是创建一个覆盖整个视口并具有高 z-index 的 div，并设置一定程度的不透明度。快速浏览一下 BlockUI 源代码应该可以帮助您编写自己的代码。

# web-services - 正在寻找免费的地理定位服务（来自国家/省/城市）或数据库？

> ID：937203
> 
> 赞同：6
> 
> 时间：2009-06-01T22:54:17.967
> 
> 标签：web-services, geocoding

我正在寻找一项免费服务（提供网络服务或定期更新的数据库），该服务将允许我检索国家/省/城市的地理位置（经度/纬度）。

雅虎和谷歌的 API 是不可接受的，因为它们限制了每日请求的总量。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-01T23:00:28.517

我是[Geolite](http://www.maxmind.com/app/ip-location)的粉丝，他们有[城市](http://www.maxmind.com/app/geolitecity)和[国家](http://www.maxmind.com/app/geolitecountry)数据库，免费提供多种语言的[api](http://www.maxmind.com/app/api)，并且他们定期更新数据库。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-01T23:00:14.413

你看过[GeoNames](http://www.geonames.org/)吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-27T13:33:09.217

试试 iopatch.com。它也是免费且无限制的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-01T22:57:13.470

看看[TIGER](http://www.census.gov/geo/www/tiger/)线数据

编辑：根据我的经验，它不如 NAVTEQ 数据准确（我认为谷歌和雅虎使用它们），但它是你免费获得的。

# c# - 如何以编程方式设置或清除 32BIT 标志？

> ID：937206
> 
> 赞同：4
> 
> 时间：2009-06-01T22:55:11.493
> 
> 标签：c#, .net, runtime, corflags

编译时，我总是将其设置为 Any CPU。然而，有些客户没有所需二进制文件的 64 位版本，即使在 x64 系统上运行时也是如此。在这些情况下，我要求他们使用 corflags.exe /32BIT+ 选项修改我的二进制文件：

[http://msdn.microsoft.com/en-us/library/ms164699(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms164699(VS.80).aspx)

如果 64 位版本不存在，我想让它透明并在安装期间自己修改二进制文件。我不**希望**自己调用 corflags.exe，因为这意味着我需要重新分发应用程序，这在我们的运输要求中是不允许的。

所以我的问题是；有没有办法自己以编程方式修改这个标志，或者直接修改二进制文件（它只是在文件本身的某处设置一个字节）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T04:16:20.817

我还没有尝试过，但是您是否能够在二进制副本上运行 corflags 并执行二进制 diff 以确定修改了哪些偏移量。您可以将其作为安装脚本的构建操作来执行，并将偏移量存储在安装程序中。

在安装时只需根据需要更改偏移量。

当然，我永远不会支持这样的行为，只是说'

;-)

顺便说一句，如果您不断需要将程序集标记为 32 位，您可以考虑只针对该平台而不是事后将其更改为 32 位。

干杯。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T03:44:39.777

为什么不专门为两种架构（32 位和 64 位）构建您的程序集，将两者都包含在您的安装程序中，然后在安装时检测您的客户端拥有的此依赖程序集的哪个版本，然后安装适当的架构版本你的申请。这样，手动修改二进制文件或需要在安装程序中包含 corflags 就不会搞砸了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T00:51:59.353

对于文件本身，我相信（尚未确认）您可以自己修改 IMAGE_COR20_HEADER。只需设置 MinorRuntimeVersion 就可以了。这是关于如何使用 IMAGE_COR20_HEADER 来确定加载哪个运行时的（有些过时的）解释：http: [//blogs.msdn.com/joshwil/archive/2004/10/15/243019.aspx](http://blogs.msdn.com/joshwil/archive/2004/10/15/243019.aspx)

为什么不总是为 x86 编译，64 位运行时会给您带来什么好处？

请注意，某些代码（interop/P/invoke）只能在 32 位或 64 位运行时中工作，因此仅将相同的程序集加载到另一个运行时中是行不通的。

编辑：快速而肮脏的示例来读取 IMAGE_COR20_HEADER：

```
_pDosHeader = reinterpret_cast<PIMAGE_DOS_HEADER>(_pFileBase);
_pNTHeader = reinterpret_cast<PIMAGE_NT_HEADERS>(_pFileBase + _pDosHeader->e_lfanew);
_pFileHeader = reinterpret_cast<PIMAGE_FILE_HEADER>(&_pNTHeader->FileHeader);
_pOptionalHeader = reinterpret_cast<PIMAGE_OPTIONAL_HEADER>(&_pNTHeader->OptionalHeader);
IMAGE_DATA_DIRECTORY const* entry = NULL;
entry = &pOptionalHeader->DataDirectory[IMAGE_DIRECTORY_ENTRY_COMHEADER];
if (entry->VirtualAddress == 0 || entry->Size == 0  || entry->Size < sizeof(IMAGE_COR20_HEADER)) {
return E_FAIL;
}
pClrHeader = reinterpret_cast<IMAGE_COR20_HEADER*>(RtlImageRvaToVa32(_pNTHeader, _pFileBase, entry->VirtualAddress, 0)); 
```

不相信这是一个好主意，但将其作为安装程序步骤。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T02:40:41.367

如果您可以在安装过程中检测到这一点，为什么不直接从安装程序中运行 corflags.exe？这对我来说听起来好多了，而不是尝试自己更改二进制数据。

# perl - 在 Perl 中打印多行字符串而不用变量替换的简单方法是什么？

> ID：937207
> 
> 赞同：4
> 
> 时间：2009-06-01T22:55:13.333
> 
> 标签：perl

我有一个 Perl 程序，它读取一堆数据，处理它，然后输出几种不同的文件格式。我想让 Perl 成为其中一种格式（以 .pm 包的形式），并允许人们在他们自己的 Perl 脚本中使用经过处理的数据。

[使用Data::Dump::pp](http://search.cpan.org/dist/Data-Dump)打印数据很容易。

我还想将一些辅助函数打印到生成的包中。

***在没有***变量替换的情况下打印多行字符串的简单方法是什么？

我希望能够做到：

```
print <<EOL;
  sub xyz { 
    my $var = shift;
  }
EOL 
```

但后来我不得不逃避所有的$。

有没有一种简单的方法可以做到这一点？也许我可以创建一个实际的子并让一些神奇的漂亮打印机打印内容？打印的代码不必与输入相匹配，甚至是清晰的。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-06-01T23:05:30.300

将分隔符的名称用单引号括起来，不会发生插值。

```
print <<'EOL';
  sub xyz { 
    my $var = shift;
  }
EOL 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-01T23:08:54.413

您可以使用模板包，例如[Template::Toolkit](http://search.cpan.org/dist/Template-Toolkit/)或[Text::Template](http://search.cpan.org/dist/Text-Template/)。

或者，您可以推出自己的原始模板系统，如下所示：

```
my %vars = qw( foo 1 bar 2 );
Write_Code(\$vars);

sub Write_Code {
    my $vars = shift;

    my $code = <<'END';

    sub baz {
        my $foo = <%foo%>;
        my $bar = <%bar%>;

        return $foo + $bar;
    }

END

    while ( my ($key, $value) = each %$vars ) {
        $code =~ s/<%$key%>/$value/g;
    }

    return $code;
} 
```

这看起来很简单，但如果你 DIY，有各种陷阱和技巧等着你。您是否注意到我没有在替换中的键名上使用quotemeta？

我建议您使用经过时间考验的模板库，就像我上面提到的那样。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-02T00:14:04.703

您实际上可以在下一行继续字符串文字，如下所示：

```
my $mail = "Hello!

Blah blah."; 
```

就个人而言，我发现它比 heredocs（`<<<EOL`其他地方提到的东西）更具可读性。

双引号 " 插入变量，但您可以使用 '。请注意，您需要转义字符串中的任何 ' 才能使其正常工作。

Perl 实际上有很多方便的东西来使东西更易读，例如其他的引用操作。qq 和 q 对应于 " 和 ' 并且您可以使用任何有意义的分隔符：

```
my $greeting = qq/Hello there $name!
Nice to meet you/;  # Interpolation

my $url = q|http://perlmonks.org/|;     # No need to escape / 
```

（注意这里的语法着色跟不上）

阅读`perldoc perlop`（在页面中找到：“引用和类似引用的运算符”）以获取更多信息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-01T23:53:23.543

使用数据部分来存储 Perl 代码：

```
#!/usr/bin/perl

use strict;
use warnings;

print <DATA>;
#print munged data

__DATA__
package MungedData;

use strict;
use warnings;

sub foo {
    print "foo\n";
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-01T23:13:28.897

尝试将代码编写为实际的 perl 子例程，然后使用[B::Deparse](http://search.cpan.org/~nwclark/perl-5.8.9/ext/B/B/Deparse.pm)在运行时获取源代码。

# c# - PropertyInfo.GetValue() - 如何在 C# 中使用反射索引泛型参数？

> ID：937224
> 
> 赞同：13
> 
> 时间：2009-06-01T22:59:34.977
> 
> 标签：c#, generics, reflection

这个（缩短的）代码..

```
for (int i = 0; i < count; i++)
{
    object obj = propertyInfo.GetValue(Tcurrent, new object[] { i });
} 
```

.. 正在引发“TargetParameterCountException：参数计数不匹配”异常。

'propertyInfo' 的基础类型是一些 T 的集合。'count' 是集合中的项目数。我需要遍历集合并对 obj 执行操作。

建议表示赞赏。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-06-01T23:07:03.513

反射一次只能在一个级别上起作用。

你试图索引到属性，这是错误的。

相反，读取属性的值，以及您返回的对象，这就是您需要索引的对象。

这是一个例子：

```
using System;
using System.Collections.Generic;
using System.Reflection;

namespace DemoApp
{
    public class TestClass
    {
        public List<Int32> Values { get; private set; }

        public TestClass()
        {
            Values = new List<Int32>();
            Values.Add(10);
        }
    }

    class Program
    {
        static void Main()
        {
            TestClass tc = new TestClass();

            PropertyInfo pi1 = tc.GetType().GetProperty("Values");
            Object collection = pi1.GetValue(tc, null);

            // note that there's no checking here that the object really
            // is a collection and thus really has the attribute
            String indexerName = ((DefaultMemberAttribute)collection.GetType()
                .GetCustomAttributes(typeof(DefaultMemberAttribute),
                 true)[0]).MemberName;
            PropertyInfo pi2 = collection.GetType().GetProperty(indexerName);
            Object value = pi2.GetValue(collection, new Object[] { 0 });

            Console.Out.WriteLine("tc.Values[0]: " + value);
            Console.In.ReadLine();
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-19T17:41:30.770

在我看到这个之前，我大部分时间都在那里，我发布这个是因为我在其他任何地方都没有看到它；关键是使用 GetValue(collection, new Object[] { i }); 在循环中而不是尝试使用 GetValue(collection, new Object[i]); 在循环之外。（在我的示例中，您可能可以忽略“输出”）；

```
private static string Recursive(object o)
{ 
        string output="";
        Type t = o.GetType();
        if (t.GetProperty("Item") != null)
        {
            System.Reflection.PropertyInfo p = t.GetProperty("Item");
            int count = -1;
            if (t.GetProperty("Count") != null && 
                t.GetProperty("Count").PropertyType == typeof(System.Int32))
            {
                count = (int)t.GetProperty("Count").GetValue(o, null);
            }
            if (count > 0)
            {
                object[] index = new object[count];
                for (int i = 0; i < count; i++)
                {
                    object val = p.GetValue(o, new object[] { i });
                    output += RecursiveWorker(val, p, t);
                }
            }
       }
       return output;        
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-11T15:13:55.780

```
Assembly zip_assembly = Assembly.LoadFrom(@"C:\Ionic.Zip.Reduced.dll");
Type ZipFileType = zip_assembly.GetType("Ionic.Zip.ZipFile");
Type ZipEntryType = zip_assembly.GetType("Ionic.Zip.ZipEntry");
string local_zip_file = @"C:\zipfile.zip";
object zip_file = ZipFileType.GetMethod("Read", new Type[] { typeof(string) }).Invoke(null, new object[] { local_zip_file });

// Entries is ICollection<ZipEntry>
IEnumerable entries = (IEnumerable)ZipFileType.GetProperty("Entries").GetValue(zip_file, null);
foreach (object entry in entries)
{
    string file_name = (string)ZipEntryType.GetProperty("FileName").GetValue(entry, null);
    Console.WriteLine(file_name);
} 
```

# php - 当 if-then-else 太多导致代码不可读时，如何坚持 Don't-Repeat-Yourself (DRY) 原则？

> ID：937225
> 
> 赞同：1
> 
> 时间：2009-06-01T22:59:40.720
> 
> 标签：php, dry, code-reuse, maintainability

我想坚持 Don't-Repeat-Yourself 原则，但有时当我将 PHP 与 HTML 和 CSS 一起编写时，如果我在不同的情况下重复使用相同的代码，我的代码很快就会有很多 if- then-else 代码不容易维护。

如果使用Smarty这个模板引擎，这可能是一个更大的问题，因为大多数代码编辑器不会匹配{if} {else} {/if} 所以程序员需要直观地寻找匹配的标签，并不容易当有 3 或 4 层嵌套 {if} {else} {/if} 时。

在这种情况下，有没有办法坚持 DRY，但仍然有良好的可维护代码？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-02T04:03:40.970

只是为了让我们有更多的信息.​​.....你用什么程序来编写你的代码？

不要重复自己的提示：

**使用某种模板。**这样做可以使您不必重复代码以在每个页面中显示内容。IE 如果您有一个有 20 个页面的站点并且您决定更改布局，那么您不希望必须经历然后更改所有 20 个页面。

**使用函数。**如果您有执行特定任务的代码，请不要在整个程序/页面中多次编写该代码。创建一个函数，然后在需要执行该任务的每个位置调用它。这样，如果您需要进行更改，您只需修改一个函数，而不必搜索您的代码来查找您执行该任务的每个位置。如果您了解类和方法（方法是类中的函数），对于许多任务，这会更好，因为它为您提供数据封装并允许您将相关函数组合在一起，以便您将来可以包含该类根据需要进行项目。

如果您在处理大量 if/else 语句时遇到困难并且代码可读性较差，您可以采取以下措施：

**1\. 考虑尝试新的编辑器。**代码折叠是必须的。一些编辑器也有垂直线来突出和匹配缩进的代码，这样你就知道什么是什么。如果您想要一个像样的免费编辑器，我会推荐 Notepad++，因为它具有这两个功能（只需 google 即可，我无法在此处添加链接）。

**2\. 您可以使用一些技术来减少您拥有的嵌套 if 语句的数量......**

示例（此代码）：

```
if (item1 == true) {
   if (item2 == true) {
      item3 = 5;
   }
   else {
      item3 = 10;
   }
}
else {
   if (item2 == true) {
      item3 = 15;
   }
   else {
      item3 = 20;
   }
} 
```

也可以展平为：

```
if (item1 == true && item2 == true) {
   item3 = 5;
}
else if (item1 == true && item2 == false) {
   item3 = 10;
}
else if (item1 == false && item2 == true) {
   item3 = 15;
}
else {
   item3 = 20;
} 
```

因此，如果您有 3 或 4 层嵌套的 if/else 并且您想将它们展平，您可能会发现您的代码更易于使用多个参数，例如上面的。它做同样的事情，只是你做这件事的偏好问题。

**试着不要混合你的逻辑（我假设 PHP）和你的显示（我假设 HTML/CSS）。**这并不总是容易做到的，但是使用模板和 css 是可能的。让我给您一个实际示例，说明如何在将用户名显示为欢迎消息的主页上执行此操作。

内联 PHP（尽量避免）：

```
<html>
   <body>
      <?php
      if ($logged_in == true) {
         echo "Welcome ",$user->name(),"!";
      }
      else {
         echo "Welcome Guest!";
      }
      ?>
   </body>
</html> 
```

逻辑与显示分离（更好）：

```
<?php
if ($logged_in == true) {
   $greetingMessage = "Welcome ",$user->name(),"!";
}
else {
   $greetingMessage = "Welcome Guest!";
}
?>

<html>
   <body>
      <?php echo $greetingMessage; ?>
   </body>
</html> 
```

^ 将逻辑与视图 (HTML) 分开将有助于您在项目开始变得非常复杂时不会不知所措。最好不要混合！:)

祝你好运！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-01T23:03:46.840

由于缺乏完整的框架，我倾向于对内容（即使它包含逻辑）做的是**将其分离**到文件中并使用另一个逻辑评估将它们合并在一起（对它们进行处理），然后评估模板逻辑。这会将您的内容分块，并使块在公共状态下可共享/可重用。

这样，每个最终模板缓冲区都是离散的可重用内容块的扁平树，您可以将其存储在磁盘或数据库上。甚至像一个小解析器这样简单的东西也可以替换：

```
<h1>{{insert:shared_page_header}}</h1> 
```

With`shared_page_header.txt`有助于将事物分开。即使在嵌入在模板中的逻辑中，它也迫使您查看关注点的分离。**任何东西（动态或非动态）的可管理、可重复使用的块**总是要走的路。您的模板在评估之前只是字符串，因此将它们视为**合并到 big-dirty-string(TM) 中的共享组件**，然后进行评估。

**祝你好运**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-01T23:04:15.717

你问题的第一句话就是问题，IMO。您真的不应该将代码与您的视图混合在一起（即 HTML 和 CSS）。有几个 PHP MVC 框架可以帮助您避免这样做。Zend 框架相当不错，但也有其他框架。

如果您不想使用框架，那么我建议重构您的页面以不使用这样的代码并在后端调用对象。*快速混合您的代码和视图变得无法在任何*语言中维护，而不仅仅是 PHP。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-01T23:04:34.890

现在我可能不太熟悉使用 PHP 实现 OOP 概念，但是重构那些嵌套的 if-else 语句并将它们放在一个命名良好的函数中有助于跟上 DRY 原则。此外，坚持 DRY 原则确实使您的代码可维护。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-02T00:11:37.093

使用示例脚本文件，我们可以更容易地指出您出错的地方，但是根据您要实现的目标，有些事情可能对您有帮助，也可能对您没有帮助：

*   看看[控制结构的替代语法](http://au.php.net/manual/en/control-structures.alternative-syntax.php)。有些人在编写主要包含 HTML 的文件时更喜欢使用这种风格，而 PHP 仅用于决定要输出哪些 HTML 部分。

*   将可重用的代码部分拆分为以后可以包含的文件，即。header.php、footer.php 等

*   使用支持代码折叠的 IDE

祝你好运

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-02-10T21:59:22.340

如果语句被认为是逻辑语句，则应在视图中尽可能避免，因为它们违反了 MVC 原则。

改为查看助手，例如：

```
class LoggedUsernameHelper
{
    protected $user;

    public function __construct(SomeUserObject $user)
    {
        $this->user=$user;
    }

    public function __toString()
    {
        return $user->isLogged() ? sprintf('Welcome %s', $user->getUsername()) :
            'Welcome guest';
    }
} 
```

这段代码是可重用的、可测试的，会让你的代码保持干枯:)

# c# - 实现线程安全单例模式的最安全/正确的方法是什么？

> ID：937226
> 
> 赞同：1
> 
> 时间：2009-06-01T22:59:42.543
> 
> 标签：c#, multithreading, singleton

如何在 C# 中实现单例模式并确保它是线程安全的？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-01T23:03:51.897

Jon Skeet 有[一篇](http://csharpindepth.com/Articles/General/Singleton.aspx)关于这方面的文章，涵盖了您的大部分选择。

# asp.net - WebForms 中的强类型容器

> ID：937244
> 
> 赞同：7
> 
> 时间：2009-06-01T23:05:41.393
> 
> 标签：asp.net, webforms

以以下代码示例为例：（ASP.NET WebForms）

```
<asp:Content ContentPlaceHolderID="Contents" runat="server">
    <div class="blogpost-list">
        <asp:Repeater ID="blogList" runat="server">
            <ItemTemplate>
                <h2 class="blogpost-title">
                    <%# (Container.DataItem as BlogPost).Title %>
                </h2>
                <p class="blogpost-meta">
                </p>
                <p class="blogpost-content">
                    <%# (Container.DataItem as BlogPost).ParsedContent %>
                </p>
            </ItemTemplate>
        </asp:Repeater>
    </div>
</asp:Content> 
```

现在我想做的是避免DataItem的内容转换，即。这一行：

```
<%# (Container.DataItem as BlogPost).Title %> 
```

我受到 ASP.NET MVC 的启发，想知道我是否可以创建一个强类型、视图并将其定义为：

```
<%@ Page
    Language="C#" MasterPageFile="~/Blog.Master" 
    AutoEventWireup="true" CodeBehind="Default.aspx.cs" 
    Inherits="MyBlog.Default<MyStrongViewType>"
%> 
```

或任何其他避免类型转换的方法，并且通常为 ASP.NET WebForms 提供强类型化视图。

有什么好主意吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2013-04-25T16:14:34.290

.NET 4.5 对此有一个很好的解决方案。您只需设置要在中继器本身上使用的数据类型。

```
 <asp:Repeater ID="blogList" runat="server" ItemType="BlogPost">
        <ItemTemplate>
            <h2 class="blogpost-title">
                <%# Item.Title %>
            </h2>
            <p class="blogpost-meta">
            </p>
            <p class="blogpost-content">
                <%# Item.ParsedContent %>
            </p>
        </ItemTemplate>
    </asp:Repeater> 
```

看：

*   [http://weblogs.asp.net/scottgu/archive/2011/09/02/strongly-typed-data-controls-asp-net-vnext-series.aspx](http://weblogs.asp.net/scottgu/archive/2011/09/02/strongly-typed-data-controls-asp-net-vnext-series.aspx)
*   [http://www.asp.net/web-forms/videos/aspnet-web-forms-vnext/aspnet-vnext-videos-strongly-typed-data-controls](http://www.asp.net/web-forms/videos/aspnet-web-forms-vnext/aspnet-vnext-videos-strongly-typed-data-controls)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-04-11T21:40:58.607

这可能有点晚了，但这似乎是一个不错的解决方案：

[http://dotnetminute.blogspot.com/2012/04/creating-strongly-typed-repeater.html](http://dotnetminute.blogspot.com/2012/04/creating-strongly-typed-repeater.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-01T23:30:53.260

我认为您可以从Repeater 控件继承并使其通用（例如Repeater）。但是您也需要重写/继承 RepeaterItem 类。
您可以使用[本文](http://www.codeproject.com/KB/aspnet/TypedRepeater.aspx)或[本文](http://www.codeproject.com/KB/webforms/advancedwebforms-generics.aspx)作为示例。

# c# - 在接口中使用泛型

> ID：937247
> 
> 赞同：5
> 
> 时间：2009-06-01T23:07:04.683
> 
> 标签：c#, generics, collections, interface

如何允许我`CookieData`在以下代码中通用？我在声明`ICookieService2`.

```
public struct CookieData<T>
{
    T Value { get; set; }
    DateTime Expires { get; set; }
}

public interface ICookieService2: IDictionary<string, CookieData<T>>
{
   // ...
} 
```

我的错误是：

> 找不到类型或命名空间名称“T”（您是否缺少 using 指令或程序集引用？）

我想`ICookieService2`将通用数据插入其中。谢谢！

**编辑**这不会把我锁在一个单曲`T`中`ICookieService2`吗？

**编辑 2**我想要做的是以下内容：

```
CookieData<int> intCookie = { Value = 27, Expires = DateTime.Now };
CookieData<string> stringCookie = { Value = "Bob", Expires = DateTime.Now };

CookieService2 cs = new CookieService2();
cs.Add(intCookie);
cs.Add(stringCookie); 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-01T23:29:08.817

看起来你在这里有 3 个选项

使 ICookieService2 通用

```
public interface ICookieService2<T> : IDictionary<string, CookieData<T> {
...
} 
```

为 CookieData 创建一个非泛型基类并在接口中使用它

```
public interface ICookieData {}
public class CookieData<T>: ICookieData{}
public interface ICookieService2 : IDictionary<string, ICookieData> {} 
```

选择一个具体的实现

```
public interface ICookieService : IDictionary<string, CookieData<int>> {} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-01T23:08:07.567

您还必须使 ICookieService2 通用：

```
public interface ICookieService2<T>: IDictionary<string, CookieData<T>>
{
   // ...
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-01T23:08:12.013

好的，这就是你想要的：

```
public interface ICookieDataBase
{
    DateTime Expires { get; set; }
}

public struct CookieData<T> : ICookieDataBase
{
    public T Value { get; set; }
    public DateTime Expires { get; set; }
}

public class ICookieService : IDictionary<string, ICookieDataBase>
{
    // ...
}

public void DoWork()
{
    var intCookie =
        new CookieData<int> { Value = 27, Expires = DateTime.Now };

    var stringCookie =
        new CookieData<string> { Value = "Bob", Expires = DateTime.Now };

    ICookieService cs = GetICookieService();
    cs.Add(intCookie);
    cs.Add(stringCookie);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-01T23:08:53.710

我想你想要的是：

```
public interface ICookieService2<T>: IDictionary<string, CookieData<T>>
{
   // ...
} 
```

目前 ICookieService2 不是通用的，所以没有定义 T。

这允许您创建实现`ICookieService2<string>`或`ICookieService2<int>`等的类。

编辑：响应您的最新请求，我认为这实际上取决于您需要什么。但是，这样的事情可能对您有用。

```
public interface ICookieData
{
    object Value {get;} // if you need to be able to set from CookieService, life gets harder, but still doable.
    DateTime Expires {get;}
}

public struct CookieDate<T> : ICookieData
{
    T Value {get;set;}
    DateTime Expires {get;set;}

    object ICookieData.Value
    {
        get
        {
            return Value;
        }
    }
} 
```

然后 CookieService 可以是或有一个列表，您将能够同时添加 CookieData 和 CookieData。如果您需要从 CookieService 编写（设置），它会稍微复杂一些，并且最好不要使用泛型。但是，如果您只需要能够检索 CookieData，那么这可能对您有用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-01T23:24:03.837

您需要一个非通用接口来执行此操作：

```
public interface ICookieData
{
  // you need this to get the value without knowing it's type
  object UntypedValue { get; }
  // whatever you need additionally ...
  Type DataType { get; } 

  DateTime Expires { get; set; }
}

public struct CookieData<T> : ICookieData
{
    // ICookieData implementation
    public object UntypedValue { get { return Value; } }
    public Type DataType { get { return typeof(T); } }
    public DateTime Expires { get; set; }

    // generic implementation
    T Value { get; set; }
}

public interface ICookieService2: IDictionary<string, ICookieData>
{
   // ...
}

CookieData<int> intCookie = { Value = 27, Expires = DateTime.Now };
CookieData<string> stringCookie = { Value = "Bob", Expires = DateTime.Now };

CookieService2 cs = new CookieService2();
cs.Add(intCookie);
cs.Add(stringCookie); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-01T23:08:49.950

不确定 C#，但 Java 方法是也声明你`ICookieService2`有`<T>`参数，或者`<T>`在`CookieData`.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-01T23:47:54.647

如果我正确理解您的问题，您希望将泛型类型视为相同，但在当前的 .NET 实现中，您不能这样做。

CookieData<string> 不能作为 CookieData<int> 传递，它们实际上是不同的类型，泛型类型不相关，不能像它们一样被强制转换或传递。将 ICookieService2 创建为一个开放的泛型（意思是 ICookieService2<T>）并不能解决问题，因为这样每个不同的类型都会有不同的 ICookieService2 类型，并且它们都将位于不同的字典中。

您可以创建一个 ICookieData 接口并在 CookieData<T> 中实现它，并使用 ICookieData 将项目存储在字典中（正如 Stefan 已经建议的那样）。

你可以在 C# 4.0 中做你想做的事（有一些限制）。[在此](http://blogs.msdn.com/charlie/archive/2008/10/28/linq-farm-covariance-and-contravariance-in-visual-studio-2010.aspx)之前有一篇关于它的文章，您必须将其作为它们共有的非泛型类型（例如接口）传递，或者只是将 value 参数作为字典上的对象，因为您将不得不区分大小写如果您使用原语作为类型参数，它无论如何都要使用它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-02T00:28:28.840

你可以试试

```
public struct CookieData<T>
    where T : Object
{
    T Value { get; set; }
    DateTime Expires { get; set; }
} 
```

这样，T 的所有实例都将被迫具有 Object 的基本类型。（C# 中的几乎所有内容（例如 int == System.Integer 等）。

# wpf - 在 WPF 中以编程方式选择 tabItem

> ID：937251
> 
> 赞同：7
> 
> 时间：2009-06-01T23:07:55.537
> 
> 标签：wpf, tabcontrol, tabitem

我在 TabControl 中有不同的 tabItems，每个 tabItem 都有一些输入字段。

我正在以编程方式在 tabItems 之间移动（就像从第一个移动到下一个的向导）

我在“下一步”按钮中使用此代码

tabItem2.isSelected = true;

我的问题是，当我通过单击它们在 tabItems 之间移动时，焦点（键盘焦点）将移动到第一个文本框输入。

但是使用前面的代码以编程方式，焦点不会移动到 tabItem 内的第一个输入文本框项。

任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T04:28:16.420

如果您强制使用 IsSelected 属性，我还会为第一个 TextBox 命名并在设置选定选项卡后设置焦点。

如果您正在动态构建 UI，这将不起作用，但您可以创建一个实用程序方法来搜索逻辑树（或如果您使用演示者/视图模型，则为可视树）以查找第一个输入控件，然后设置焦点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-08-17T05:20:03.163

这些解决方案对我不起作用。它已经选择了我想要的 TabItem，但它无法选择/聚焦所需的 TreeViewItem。（如果已经选择了 TabItem，它只会关注 TVI。）下面的解决方案最终对我有用。

（仅供参考：下面的片段是类似于 Microsoft Help Viewer 2.0 的应用程序的一部分。当您单击“同步”按钮时，它首先选择“内容”选项卡（如果尚未选择），然后遍历树视图直到找到匹配的树查看项目。然后它会选择/聚焦。）

干杯

```
private void OnClick_SyncContents(object sender, RoutedEventArgs e)
{
    // If the help-contents control isn't visible (ie., some other tab is currently selected),
    // then use our common extension method to make it visible within the tab control.  Once
    // it visible, the extension method will call the event handler passed (which is this method)
    if (!this.m_UcHelpFileContents.IsVisible)
    {
      this.m_UcHelpFileContents.
      SelectParentTabItem_WaitForMeToBecomeVisible_ThenCallThisEventHandlerWithNullArguments
      (this.OnClick_SyncContents);
    }
    else 
    {
      // Else the help-contents control is currently visible, thus focus the 
      // matching tree view item
      /* Your code here that focuses the desired tree view item */
    }
}

public static class CommonExtensionMethods
{
  public static void
    SelectParentTabItem_WaitForMeToBecomeVisible_ThenCallThisEventHandlerWithNullArguments
    (this FrameworkElement frameworkElement, RoutedEventHandler eventHandlerToCallWhenVisible)
  {
    // First, define the handler code for when the given framework element becomes visible
    DependencyPropertyChangedEventHandler HANDLER = null;
    HANDLER = (s, e) =>
    {
      // If here, the given framework element is now visible and its tab item currently selected
      // Critical: first and foremost, undo the latch to is-visible changed
      frameworkElement.IsVisibleChanged -= HANDLER;

      // Now invoke the event handler that the caller wanted to invoke once visible
      frameworkElement.Dispatcher.BeginInvoke(eventHandlerToCallWhenVisible, null, null);
    };

    // Use our common extension method to find the framework element's parent tab item
    TabItem parentTabItem = frameworkElement.GetFirstParentOfType<TabItem>();

    if (parentTabItem != null)
    {
      // Assign the handler to the given framework element's is-visible-changed event
      frameworkElement.IsVisibleChanged += HANDLER;

      // Now set the tab item's is-selected property to true (which invokes the above 
      // handler once visible)
      parentTabItem.IsSelected = true;
    }
  }

  public static T GetFirstParentOfType<T>
    (this FrameworkElement frameworkElement) where T : FrameworkElement
  {
    for (FrameworkElement fe = frameworkElement.Parent as FrameworkElement; 
         fe != null; 
         fe = fe.Parent as FrameworkElement)
    {
      if (fe is T)
        return fe as T;
    }

    // If here, no match
    return null;
  }
} 
```

# c++ - 如何将类型名作为函数中的参数？(C++)

> ID：937268
> 
> 赞同：2
> 
> 时间：2009-06-01T23:15:43.167
> 
> 标签：c++, file-io, typename, function-parameter

我需要能够将类型名作为参数传递：

```
int X = FileRead(file, 9, char); 
```

FileRead(std::fstream, int pos, ???) 的概念是读取 pos*sizeof(无论类型是什么) 以获得所需的位置。我试过模板：

```
template<typename T>
T FileRead(std::fstream file, int pos, T type)
{
    T data;
    file.read(reinterpret_cast<char*>(&data), sizeof(data));
    return data;
} 
```

但这要求我每次想使用 FileRead 时都创建一个要使用的类型的变量，而且我真的不想仅仅因为一个函数而重新设计整个程序，所以无论如何都要使用类型名作为参数?

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-06-01T23:18:16.750

要将类型的名称用作参数，请使用模板。

```
template<typename T>
T FileRead(std::fstream &file, int pos)
{
    T data;
    file.read(reinterpret_cast<char*>(&data), sizeof(T));
    return data;
} 
```

这假定该类型是默认可构造的。如果不是，我想你无论如何都很难将它从文件中流出来。

像这样称呼它：

```
char value=FileRead<char>(file, pos); 
```

如果您不想在调用中指定类型，您可以修改您的 API：

```
template<typename T>
void FileRead(std::fstream &file, int pos, T &data)
{
    file.read(reinterpret_cast<char*>(&data), sizeof(T));
} 
```

然后像这样调用它 - 推断类型：

```
char value;
FileRead(file, pos, value); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-01T23:19:36.013

非常简单：

```
template<typename T>
T FileRead(std::fstream file, int pos)
{
    T data;
    file.read(reinterpret_cast<char*>(&data), sizeof(data));
    return data;
} 
```

并通过以下方式调用它：

```
char x = FileRead<char>(file, pos); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-11-22T15:16:46.423

我知道这篇文章得到了回答，但我仍然有一个问题，我从这个页面的答案中找到了一个简单的方法。您可以将类型名称传递给任何函数，如下所示：

```
template<typename T>
void function_name()
{
    //you can access your type here with T
    //you can create an object from T or anything you want
    //for example :

    T obj;

    //or:

    T obj=new T;

}

int main(){
    function_name<YourTypeName>();
} 
```

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2009-06-01T23:17:45.393

一旦你的程序被编译，就没有类型之类的东西了。这是 C++ 的风格。

# zend-framework - 当我无法更改文档根目录时，我应该如何设置我的应用程序？

> ID：937269
> 
> 赞同：0
> 
> 时间：2009-06-01T23:16:28.627
> 
> 标签：zend-framework, bootstrapping

我没有权限将文档根目录更改为 /public/ 目录，那么我应该如何设置我的 Zend Framework 应用程序以从当前根目录运行？使用 Zend Framework 1.8 命令行工具，不知道有没有办法告诉它以这种方式创建目录结构。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T07:13:22.600

如果您只能访问上层网络（即公共），您应该在那里设置索引以及整个应用程序文件夹。*使用Deny from all*创建一个 .htaccess 并将其放入您的 /application。

您的配置将是：

```
/application
/library
index.php 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T12:46:40.600

只需使用[快速入门指南](http://framework.zend.com/docs/quickstart)并根据它进行调整。Zend_Tool 仍然是实验性的。让我知道这是否有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T07:53:54.393

所以这就是我最终做的事情：

1.  下载快速入门示例代码。
2.  将公共的所有内容移动到主目录，以及应用程序、库目录。
3.  在 index.php 中更改包含库和应用程序的路径以指向正确的位置
4.  我想这就是我所要做的。采埃孚新如何休息。

我不认为这是理想的，但是，正如已经提到的，应用程序目录可以从 Web 访问，但现在，它已经完成了工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-01T23:26:45.233

在不更改大量配置的情况下，最简单的方法是将`public`您提到的文件夹中的所有内容放入您的`public_html`文件夹中，然后将所有其他内容（如应用程序和库文件夹）放入从`public_html`.

您也可以将所有内容都放入您的`public_html`文件夹中，尽管不建议这样做。每个类都有提供不同路径的选项。例如在 Front_Controller 上，您可以将 Controllers 目录设置为您想要的任何位置。有指定不同路径的选项，但如果您遵循约定，它会为您完成。

# sql - 有没有办法从变量中选择数据库？

> ID：937271
> 
> 赞同：4
> 
> 时间：2009-06-01T23:16:44.770
> 
> 标签：sql, sql-server, dynamic-sql

有没有办法从变量中选择数据库？

```
Declare @bob as varchar(50);
Set @bob = 'SweetDB';
GO
USE @bob 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-01T23:36:24.030

很不幸的是，不行。

除非您可以将批处理的其余部分作为动态 SQL 执行。

使用`execute`动态执行 SQL 将更改语句范围的上下文`execute`，但不会对执行`execute`语句的范围产生持久影响。

换句话说，这：

```
DECLARE @db VARCHAR(100)
SET @db = 'SweetDB'
EXECUTE('use ' + @db) 
```

不会永久设置当前数据库，但是如果您像这样更改上述代码：

```
DECLARE @db VARCHAR(100)
SET @db = 'SweetDB'
EXECUTE('use ' + @db + ';select * from sysobjects')
select * from sysobjects 
```

那么这两个查询的结果会有所不同（假设您还没有在 SweetDB 中），因为在里面`execute`执行的第一个选择是在 SweetDB 中执行的，但第二个不是。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T23:23:53.260

```
declare @NewDB varchar(50)
set @NewDB = 'NewDB'
execute('use ' + @NewDB) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T13:02:15.750

**#TempTables 将存在于 GO 中**

您可以在第一批中创建表，在该批或任何后续批中根据需要插入/选择数据。

这是一些示例语法：

```
CREATE TABLE #YourTableName
(
     col1   int         not null   primary key   identity(1,1)
    ,col2   varchar(10)
) 
```

# .net - 使用 ApplicationSettings 存储 WinForms RadioButtons 的 Checked 属性

> ID：937281
> 
> 赞同：5
> 
> 时间：2009-06-01T23:21:00.253
> 
> 标签：.net, vb.net, winforms, radio-button

我有一个包含 3 个单选按钮的 WinForms 对话框。我正在使用`ApplicationSettings`绑定每个`RadioButton`控件的 Checked 属性，但它没有做我期望它做的事情。现在，我必须在每个单选按钮被选中之前单击它两次，并且选定的单选按钮不会被保留。

关闭表单时是否需要执行一行代码来保存用户设置？

如何消除两次单击单选按钮的需要？

有没有更好的方法来保留这种类型的用户设置？我确实在对话框类上有一个公共属性，它根据选中的单选按钮获取/设置枚举值，但我没有看到将该属性绑定到用户设置的简单方法。

**编辑：**应该指定我正在使用 vb.net。我认为这意味着`My.Settings`而不是`Properties.Settings`.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-06-26T12:00:27.650

我回答你问题的这一部分：

> 如何消除两次单击单选按钮的需要？

您可以将以下事件处理程序添加到 GroupBox 中三个 RadioButtons（其中 Checked 属性绑定到应用程序设置）中的每一个的 Click 事件中：

```
Private Sub RadioButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles tomRadioButton.Click, dickRadioButton.Click, harryRadioButton.Click
    If sender.Checked = False Then
        sender.Checked = True
    End If
End Sub 
```

它可以工作，即使在单击后检查未选中的 RadioButton 需要半秒钟。

问题的原因在两年前（2008 年）Turbulent Intelect 博客上的[Surviving WinForms Databinding](http://turbulentintellect.blogspot.com/2008/07/surviving-winforms-databinding.html)帖子的第 5 节中进行了解释（感谢[ohadsc](https://stackoverflow.com/users/67824/ohadsc)提供链接）：

> **规则 5：不要绑定到可点击的单选按钮**
> 
> 我知道如果您可以将一堆单选按钮绑定到一个枚举属性，那该有多好。我真的。你认为你只是要连接一些 Format 和 Parse 事件来翻译回你的枚举，一切都会好起来的。如果它真的有效，那就太方便了。但是 WinForms 并不适合这个。对于现在的 3 个完整版本（或者是 3.5 个版本？），情况就是如此。这是因为事件顺序，这不是 MS 可以在不让成千上万的开发人员真正感到厌烦的情况下切换的东西。
> 
> 问题实际上归结为这样一个事实，即与其他控件的数据属性不同，单选按钮的 Checked 属性在焦点离开单选按钮之前实际上并没有改变。与所有 WinForms 控件一样，焦点实际上不会离开单选按钮，直到焦点被赋予另一个控件之后，实际上直到新焦点控件的 Click 事件被触发之后。与单选按钮有关的结果是，如果您尝试绑定到它们，**数据源中的绑定属性实际上会一键滞后于单选按钮的视觉状态**. 如果您只有两个单选按钮，则数据源将与可见状态完全相反，直到您单击不会触发引用这些数据源属性的操作的其他位置。这可以使它成为一个非常令人恼火的错误。我差点以为自己出现幻觉了。
> 
> 现在，老实说，有可能让它发挥作用。但它是有史以来最笨拙的笨拙。好吧，也许它不是那么糟糕......但它肯定是一个混乱的黑客。真正应该已经可用的东西需要做很多工作。据我所知，在不放弃数据绑定机制的情况下解决此问题的唯一方法是从本质上制作您自己的 RadioButton 控件，并具有实际有用的属性更改和事件顺序。您可以从头开始编写一个，或者子类 RadioButton 并使用自定义消息处理覆盖所有事件逻辑。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-08-02T14:32:58.810

感谢 Geoffrey Van Wyk 和 ohadsc（链接），我想出了以下自定义控件。它基本上是一个自定义框架，它将在其中包含的所有单选按钮上自动实现 Geoffrey 的代码。优点是您现在可以使用 ApplicationSettings 来绑定控件的选中属性，并且它将按预期工作。

这是我制作自定义控件的 c# 代码：

```
 public partial class RadioPanel : System.Windows.Forms.Panel
    {
        protected override void OnControlAdded(ControlEventArgs e)
        {
            base.OnControlAdded(e);
            var radioButton = e.Control as RadioButton;
            if (radioButton != null)
                radioButton.Click += radioButton_Click;
        }

        void radioButton_Click(object sender, EventArgs e)
        {
            var radio = (RadioButton)sender;
            if (!radio.Checked)
                radio.Checked = true;
        }

    } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-01T23:25:38.483

我可以回答你问题的这一部分：

> 关闭表单时是否需要执行一行代码来保存用户设置？

应用程序设置存储在您的`Settings`类中，在`Properties`命名空间中。该类`Settings`有一个名为 的静态属性`Default`，它表示您的应用程序的当前设置。因此，在主窗体的 Closing 事件中，您调用：

```
Properties.Settings.Default.Save(); 
```

...保存设置。

同样，您可以使用设置的名称以编程方式访问设置：（`Properties.Settings.Default.MyRadioButtonState`或您所称的任何名称）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-03-06T17:42:50.400

此行为在此处的第 5 项中进行了解释：

[http://turbulentintellect.blogspot.com/2008/07/surviving-winforms-databinding.html](http://turbulentintellect.blogspot.com/2008/07/surviving-winforms-databinding.html)

一个可能的解决方案是自定义 GroupGox： [Best way to databind a group of a radiobuttons in WinForms](https://stackoverflow.com/questions/675137/best-way-to-databind-a-group-of-radiobuttons-in-winforms/2394429#2394429)

# c# - 所有关于例外：做什么以及在哪里记录？

> ID：937285
> 
> 赞同：3
> 
> 时间：2009-06-01T23:21:54.263
> 
> 标签：c#, design-patterns, exception, exception-handling

我的问题实际上分为两部分，因此标题模棱两可。

**第一部分**

据我所知，你永远不应该吞下一个例外。甚至没有记录它并忘记。在一般情况下，我尝试解决异常并重试代码 - 例如，假设我收到 FileNotFound 异常。

我提示用户检查文件是否存在并重试，提供另一个文件选择器对话框并希望获得最好的结果。未能尝试解决问题，我最终通知用户并记录异常。有人告诉我，这不是在 catch 块中做的正确事情，所以我通过尝试解决问题来做对了吗？

我想不出我还能做什么。我怀疑我被误导了——我是一个容易上当受骗的人。

**第二部分**

我认为在我的程序目录中创建日志以记录异常很好，但我再次被告知应将异常写入 Windows 事件日志。它是否正确？在什么情况下应该写入事件日志？

愚蠢的问题需要愚蠢的答案。

编辑：除了一般模糊的域外，这个问题没有上下文。我和我的朋友正在喋喋不休地谈论在特定情况下应该做的正确事情。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-01T23:48:32.243

首先，如果您听到“**永远不要**竖起耳朵”这个词...这就是为什么它们被称为“最佳实践”而不是“您必须遵循的石刻规则...”

这是微软的[异常处理最佳实践指南](http://msdn.microsoft.com/en-us/library/seyhszts(VS.71).aspx)

还有很多其他的......

这真的归结为您作为开发人员、您的团队标准、您的客户等。您希望应用程序做什么？

**问题 1：**如果抛出异常，您是否希望应用程序能够继续运行？然后我会“吞下”异常。

**问题 2**：将特定异常记录到事件日志是否有好处，或者它只会用无用的信息使其膨胀，您可能希望在开发和测试期间将每个异常写入日志并拥有详细信息，然后在生产中精简它......我希望我已经回答了你的问题，即使真的没有一个通用的......

我会说你应该有一些一般性的指导方针，然后如果你有更**具体的情况**，那么现在是重新发布到这个网站的好时机，并从尝试过不同路线的人那里获得一些反馈，并且可以谈谈利弊.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T00:54:07.460

[代码分析团队博客](http://blogs.msdn.com/fxcop/archive/2006/06/14/631923.aspx)是开始讨论此主题的好地方。也看看

[Martin Fowler - 快速失败](http://www.martinfowler.com/ieeeSoftware/failFast.pdf)

[MSDN 关于异常处理](http://msdn.microsoft.com/en-us/library/ms229005.aspx)

[已检查与未检查的异常](http://www.javapractices.com/topic/TopicAction.do?Id=129)

你问题的第二部分真的取决于。在许多需要集中异常报告的应用程序中，写入事件日志是一个好主意。还有很多其他情况下这样做会浪费时间，您必须对此做出自己的判断。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-01T23:43:59.320

**第一部分**

通常，您不希望在 catch 块中出现异常生成行为。

```
try
{
   ExceptionThrowingMethod();
}
Catch(Exception ex)
{
   //Log It
   //Try Again
   ExceptionThrowingMethod();
} 
```

显然，第二个异常不会被捕获，并且您通常不希望将 try-catch 嵌套*在 catch-block*中。通常你的 catch 块应该

1.  记录错误。总是。即使您将其设置为最低日志记录级别，并且从不阅读这些日志。
2.  确定您当前的状态是否可恢复。（正确的变量是设置还是为空？它是在关键函数期间还是在它们之间中断？）
3.  如果可以恢复，请设置一些指示“重试”的变量，并允许执行从 catch-block 流出。如果无法恢复，请尝试添加一些上下文，然后重新抛出错误。

捕获块用于错误恢复，而不是用于常规执行。因此，即使通过 FileNotFound 是一个异常发生，提示用户尝试定位他们的文件*不是*，所以它应该发生在它自己的 try-catch 中（或循环回到最初的那个）。

**第二部分**

一般来说，我更喜欢将日志写入他们自己的目录，因为这样我就可以确切地知道它们在哪里，而且我也知道日志中的所有内容都是相关的。如果您的应用程序是关键应用程序（即需要运行框架才能运行的服务），那么您可能会考虑将日志记录到事件查看器。还有每个人都赢的方法来记录到两者。您可以在程序目录中有完整的日志，并将任何严重错误记录到事件查看器中。

在不知道您被告知登录事件查看器的原因的情况下，我无法判断这是否是个好建议。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-01T23:30:48.660

以下是异常处理的一些最佳实践。

[Java 或 C# 中异常管理的最佳实践](https://stackoverflow.com/questions/409563/best-practices-for-exception-management-in-java-or-c)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-03T00:48:19.893

我发现[这](https://stackoverflow.com/questions/238583/windows-exception-handling-to-event-log-or-to-database)可以回答我的问题的第二部分，并且从进一步的研究看来，将异常记录到事件日志中并不是一种神秘而黑暗的做法。谢谢大家的帮助。

# c - 信号安全使用 sem_wait()/sem_post()

> ID：937289
> 
> 赞同：4
> 
> 时间：2009-06-01T23:24:20.950
> 
> 标签：c, posix

我正在尝试在 Linux 上创建一个包装器，它控制一次允许多少个并发执行。为此，我使用了系统范围的计数信号量。我创建信号量，执行 a `sem_wait()`，启动子进程，然后在子进程`sem_post()`终止时执行 a 。没事儿。

问题是如何安全地处理发送到这个包装器的信号。如果它没有捕捉到信号，则命令可能会在不执行 a 的情况下终止`sem_post()`，从而导致信号量计数永久减少 1。所以，我创建了一个信号处理程序来执行`sem_post()`. 但是，还是有问题。

如果在`sem_wait()`执行之前附加了处理程序，则信号可能会在`sem_wait()`完成之前到达，从而导致 a`sem_post()`发生而没有`sem_wait()`. 如果我`sem_wait()`在设置信号处理程序之前执行此操作，则相反的情况是可能的。

显而易见的下一步是在设置处理程序和`sem_wait()`. 这是我现在拥有的伪代码：

```
void handler(int sig)
{
  sem_post(sem);
  exit(1);
}

...
sigprocmask(...);   /* Block signals */
sigaction(...);     /* Set signal handler */
sem_wait(sem);
sigprocmask(...);   /* Unblock signals */
RunChild();
sem_post(sem);
exit(0); 
```

现在的问题是`sem_wait()`罐子阻塞，在此期间，信号被阻塞。试图终止进程的用户最终可能会诉诸“kill -9”，这是我不想鼓励的行为，因为无论如何我都无法处理这种情况。我可以使用`sem_trywait()`一小段时间进行测试`sigpending()`，但这会影响公平性，因为不再保证等待信号量最长的进程接下来会运行。

这里有一个真正安全的解决方案，可以让我在信号量采集期间处理信号吗？我正在考虑求助于“我有信号量”全局并消除信号阻塞，但这并不是 100% 安全的，因为获取信号量并设置全局不是原子的，但可能比在等待时阻塞信号更好。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-01T23:39:37.737

Are you sure `sem_wait()` causes signals to be blocked? I don't think this is the case. The [man page for `sem_wait()`](http://linux.die.net/man/3/sem_wait) says that the `EINTR` error code is returned from `sem_wait()` if it is interrupted by a signal.

You should be able to handle this error code and then your signals will be received. Have you run into a case where signals have not been received?

I would make sure you handle the error codes that `sem_wait()` can return. Although it may be rare, if you want to be 100% sure you want to cover 100% of your bases.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T00:04:22.443

Are you sure you are approaching the problem correctly? If you want to wait for a child terminating, you may want to use the `waitpid()` system call. As you observed, it is not reliable to expect the child to do the `sem_post()` if it may receive signals.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-10-11T22:40:02.223

I know this is old, but for the benefit of those still reading this courtesy of Google...

The simplest (and only?) robust solution to this problem is to use a System V semaphore, which allows the client to acquire the semaphore resource in a way which is automatically returned by the kernel NO MATTER HOW THE PROCESS EXITS.

# c# - 使用多个监视器恢复窗口大小/位置

> ID：937298
> 
> 赞同：35
> 
> 时间：2009-06-01T23:28:04.547
> 
> 标签：c#, winforms, multiple-monitors, appsettings

许多关于恢复 WinForm 位置和大小的帖子。

例子：

*   [www.stackoverflow.com/questions/92540/save-and-restore-form-position-and-size](http://www.stackoverflow.com/questions/92540/save-and-restore-form-position-and-size)
*   [www.codeproject.com/KB/dialog/restoreposition.aspx?fid=1249382&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2595746](http://www.codeproject.com/KB/dialog/restoreposition.aspx?fid=1249382&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2595746)

但是我还没有找到代码来使用多个监视器来做到这一点。

也就是说，如果我用监视器 2 上的窗口关闭我的 .NET Winform 应用程序，我希望它将窗口大小、位置和状态保存到应用程序设置中，以便稍后在我重新启动应用程序时恢复到监视器 2。如果像上面的代码项目示例中那样，它包含一些健全性检查，那就太好了，因为如果保存的位置大部分都在屏幕外，它会“修复”它。或者，如果保存的位置在一个不再存在的显示器上（例如，我的笔记本电脑现在自己没有第二个显示器），那么它会正确地将其移动到显示器 1。

有什么想法吗？

我的环境：C#，.NET 3.5 或以下，VS2008

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-06-02T15:44:04.753

试试这个代码。兴趣点：

*   检查窗口是否（部分）在任何屏幕的工作区域上可见。例如，将其拖到任务栏后面或将其完全移出屏幕会将位置重置为 Windows 默认值。
*   即使表单被最小化或最大化也保存正确的边界（常见错误）
*   正确保存 WindowState。保存 FormWindowState.Minimized 被设计禁用。

边界和状态以其对应的类型存储在 appsettings 中，因此无需进行任何字符串解析。让框架发挥它的序列化魔法。

```
public partial class MainForm : Form
{
    public MainForm()
    {
        InitializeComponent();

        // this is the default
        this.WindowState = FormWindowState.Normal;
        this.StartPosition = FormStartPosition.WindowsDefaultBounds;

        // check if the saved bounds are nonzero and visible on any screen
        if (Settings.Default.WindowPosition != Rectangle.Empty &&
            IsVisibleOnAnyScreen(Settings.Default.WindowPosition))
        {
            // first set the bounds
            this.StartPosition = FormStartPosition.Manual;
            this.DesktopBounds = Settings.Default.WindowPosition;

            // afterwards set the window state to the saved value (which could be Maximized)
            this.WindowState = Settings.Default.WindowState;
        }
        else
        {
            // this resets the upper left corner of the window to windows standards
            this.StartPosition = FormStartPosition.WindowsDefaultLocation;

            // we can still apply the saved size
            this.Size = Settings.Default.WindowPosition.Size;
        }
    }

    private bool IsVisibleOnAnyScreen(Rectangle rect)
    {
        foreach (Screen screen in Screen.AllScreens)
        {
            if (screen.WorkingArea.IntersectsWith(rect))
            {
                return true;
            }
        }

        return false;
    }

    protected override void OnClosed(EventArgs e)
    {
        base.OnClosed(e);

        // only save the WindowState if Normal or Maximized
        switch (this.WindowState)
        {
            case FormWindowState.Normal:
            case FormWindowState.Maximized:
                Settings.Default.WindowState = this.WindowState;
                break;

            default:
                Settings.Default.WindowState = FormWindowState.Normal;
                break;
        }

        // reset window state to normal to get the correct bounds
        // also make the form invisible to prevent distracting the user
        this.Visible = false;
        this.WindowState = FormWindowState.Normal;

        Settings.Default.WindowPosition = this.DesktopBounds;
        Settings.Default.Save();
    }
} 
```

供参考的设置文件：

```
<?xml version='1.0' encoding='utf-8'?>
<SettingsFile xmlns="http://schemas.microsoft.com/VisualStudio/2004/01/settings" CurrentProfile="(Default)" GeneratedClassNamespace="ScreenTest" GeneratedClassName="Settings">
    <Profiles />
    <Settings>
        <Setting Name="WindowPosition" Type="System.Drawing.Rectangle" Scope="User">
            <Value Profile="(Default)">0, 0, 0, 0</Value>
        </Setting>
        <Setting Name="WindowState" Type="System.Windows.Forms.FormWindowState" Scope="User">
            <Value Profile="(Default)">Normal</Value>
        </Setting>
    </Settings>
</SettingsFile> 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-06-02T21:48:15.340

VVS提供的答案很有帮助！不过，我发现了两个小问题，所以我用这些修订版重新发布了他的大部分代码：

(1) 应用程序第一次运行时，表单以正常状态打开，但其大小使其仅显示为标题栏。我在构造函数中添加了一个条件来解决这个问题。

(2) 如果应用程序在最小化或最大化时关闭，则 OnClosing 中的代码无法记住处于正常状态的窗口的尺寸。（这 3 行代码——我现在已经注释掉了——看起来很合理，但由于某种原因根本不起作用。）幸运的是，我之前已经解决了这个问题，并在代码末尾包含了该代码的新区域跟踪窗口状态，而不是等待关闭。

* * *

有了这两个修复程序，我已经测试了：

A. 以正常状态关闭--恢复到相同的大小/位置和状态

B. 以最小化状态关闭——恢复到具有最后正常大小/位置的正常状态

C. 以最大化状态关闭——恢复到最大化状态并在以后调整到正常状态时记住它的最后大小/位置。

D. 关闭监视器 2——恢复到监视器 2。

E. 关闭监视器 2，然后断开监视器 2——恢复到监视器 1 上的相同位置

大卫：你的代码让我几乎毫不费力地达到了 D 点和 E 点——你不仅为我的问题提供了解决方案，而且在一个完整的程序中提供了它，所以我几乎在将它粘贴到 Visual Studio 的几秒钟内就启动并运行了它. 非常感谢你！

```
public partial class MainForm : Form
{
    bool windowInitialized;

    public MainForm()
    {
        InitializeComponent();

        // this is the default
        this.WindowState = FormWindowState.Normal;
        this.StartPosition = FormStartPosition.WindowsDefaultBounds;

        // check if the saved bounds are nonzero and visible on any screen
        if (Settings.Default.WindowPosition != Rectangle.Empty &&
            IsVisibleOnAnyScreen(Settings.Default.WindowPosition))
        {
            // first set the bounds
            this.StartPosition = FormStartPosition.Manual;
            this.DesktopBounds = Settings.Default.WindowPosition;

            // afterwards set the window state to the saved value (which could be Maximized)
            this.WindowState = Settings.Default.WindowState;
        }
        else
        {
            // this resets the upper left corner of the window to windows standards
            this.StartPosition = FormStartPosition.WindowsDefaultLocation;

            // we can still apply the saved size
            // msorens: added gatekeeper, otherwise first time appears as just a title bar!
            if (Settings.Default.WindowPosition != Rectangle.Empty)
            {
                this.Size = Settings.Default.WindowPosition.Size;
            }
        }
        windowInitialized = true;
    }

    private bool IsVisibleOnAnyScreen(Rectangle rect)
    {
        foreach (Screen screen in Screen.AllScreens)
        {
            if (screen.WorkingArea.IntersectsWith(rect))
            {
                return true;
            }
        }

        return false;
    }

    protected override void OnClosed(EventArgs e)
    {
        base.OnClosed(e);

        // only save the WindowState if Normal or Maximized
        switch (this.WindowState)
        {
            case FormWindowState.Normal:
            case FormWindowState.Maximized:
                Settings.Default.WindowState = this.WindowState;
                break;

            default:
                Settings.Default.WindowState = FormWindowState.Normal;
                break;
        }

        # region msorens: this code does *not* handle minimized/maximized window.

        // reset window state to normal to get the correct bounds
        // also make the form invisible to prevent distracting the user
        //this.Visible = false;
        //this.WindowState = FormWindowState.Normal;
        //Settings.Default.WindowPosition = this.DesktopBounds;

        # endregion

        Settings.Default.Save();
    }

    # region window size/position
    // msorens: Added region to handle closing when window is minimized or maximized.

    protected override void OnResize(EventArgs e)
    {
        base.OnResize(e);
        TrackWindowState();
    }

    protected override void OnMove(EventArgs e)
    {
        base.OnMove(e);
        TrackWindowState();
    }

    // On a move or resize in Normal state, record the new values as they occur.
    // This solves the problem of closing the app when minimized or maximized.
    private void TrackWindowState()
    {
        // Don't record the window setup, otherwise we lose the persistent values!
        if (!windowInitialized) { return; }

        if (WindowState == FormWindowState.Normal)
        {
            Settings.Default.WindowPosition = this.DesktopBounds;
        }
    }

    # endregion window size/position
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-05-19T17:09:37.457

这里的大多数其他解决方案都依赖于手动确定每台显示器的当前位置。边缘情况非常难以弄清楚，很少有应用程序可以自行解决。

Windows 本身中的 SetWindowPlacement 函数可以正确处理所有边缘情况 - 如果窗口将位于可见屏幕之外，它会相应地对其进行调整。

我在 C# 中看到的最好的例子是 David Rickard 的博客。它不仅展示了如何使用 SetWindowPlacement，还展示了如何序列化整个结果。 [http://blogs.msdn.com/b/davidrickard/archive/2010/03/09/saving-window-size-and-location-in-wpf-and-winforms.aspx](http://blogs.msdn.com/b/davidrickard/archive/2010/03/09/saving-window-size-and-location-in-wpf-and-winforms.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-02-24T11:25:10.357

## 根据您的回答和评论，我认为这是完美的。

* * *

该解决方案是通过**多显示器**+**多文档**、**多表单**或多**主表单**支持来**保存/恢复表单大小和位置。**它**不是 MDI**表单，而是 Microsoft Word 之类的具有不同主表单实例的多文档。

 ******感谢 VVS、msorens 和 Ian Goldby。我合并了来自 VVS、msorens 和 MSDN [Application.Run Method (ApplicationContext)](http://msdn.microsoft.com/en-us/library/ms157901.aspx)示例的解决方案，以制作多 MainForm 但不是 MDI。

此修复程序包括来自 Ian Goldby 的评论，`Form.RestoreBounds`用于消除`OnResize()`,`OnMove()`和`TrackWindowState()`。

我还修复了当表单移动到另一个监视器并在退出前最大化时记住监视器，因为我没有跟踪 OnResize、OnMove。通过此修复，此解决方案支持[Windows 7 捕捉功能](http://www.microsoft.com/windows/windows-7/features/snap.aspx)，您可以拖动标题栏或 Win+箭头键将表单窗口捕捉到任何监视器边缘或使其最大化/正常以及最小化。

此解决方案在 Program 中实现，但不在主窗体中实现，以支持多主窗体。但是，您也可以用于单个主表单。

```
using System;
using System.Collections.Generic;
using System.Windows.Forms;
using SimpleTestForm.Properties;
using System.Drawing;

namespace SimpleTestForm
{
    static class Program
    {
        static MultiMainFormAppContext appContext;

        /// <summary>
        /// The main entry point for the application.
        /// </summary>
        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);

            appContext = new MultiMainFormAppContext();
            Application.Run(appContext);
        }

        /// <summary>
        /// Create a new MainForm and restore the form size and position if necessary. This method can be called like from Menu File > New click event.
        /// </summary>
        /// <returns></returns>
        public static MainForm createNewMainForm()
        {
            return appContext.createNewMainForm();
        }

        /// <summary>
        /// Get the current active MainForm event if a dialog is opened. Useful to create Dictionary (MainForm, T) to store Form/document dependent field. Please set the Owner of child form to prevent null reference exception.
        /// </summary>
        /// <returns></returns>
        public static MainForm GetCurrentMainFormInstance()
        {
            Form mainForm = Form.ActiveForm;
            while (!(mainForm is MainForm) && mainForm.Owner != null)
                mainForm = mainForm.Owner;
            return mainForm as MainForm;
        }
    }

    class MultiMainFormAppContext : ApplicationContext
    {
        List<MainForm> mainForms = new List<MainForm>();
        Point newRestoredLocation = Point.Empty;

        internal MultiMainFormAppContext()
        {
            createNewMainForm();
        }

        internal MainForm createNewMainForm()
        {
            MainForm mainForm = new MainForm();
            mainForm.FormClosed += new FormClosedEventHandler(mainForm_FormClosed);
            mainForm.LocationChanged += new EventHandler(mainForm_LocationChanged);
            RestoreFormSizeNPosition(mainForm);
            PreventSameLocation(mainForm);
            mainForms.Add(mainForm);
            mainForm.Show();
            return mainForm;
        }

        private void PreventSameLocation(MainForm mainForm)
        {
            const int distance = 20;
            foreach (MainForm otherMainForm in mainForms)
            {
                if (Math.Abs(otherMainForm.Location.X - mainForm.Location.X) < distance &&
                    Math.Abs(otherMainForm.Location.Y - mainForm.Location.Y) < distance)
                    mainForm.Location = new Point(mainForm.Location.X + distance, mainForm.Location.Y + distance);
            }
        }

        /// <summary>
        /// Restore the form size and position with multi monitor support.
        /// </summary>
        private void RestoreFormSizeNPosition(MainForm mainForm)
        {
            // this is the default
            mainForm.WindowState = FormWindowState.Normal;
            mainForm.StartPosition = FormStartPosition.WindowsDefaultBounds;

            // check if the saved bounds are nonzero and visible on any screen
            if (Settings.Default.WindowPosition != Rectangle.Empty &&
                IsVisibleOnAnyScreen(Settings.Default.WindowPosition))
            {
                // first set the bounds
                mainForm.StartPosition = FormStartPosition.Manual;
                mainForm.DesktopBounds = Settings.Default.WindowPosition;

                // afterwards set the window state to the saved value (which could be Maximized)
                mainForm.WindowState = Settings.Default.WindowState;
            }
            else
            {
                // this resets the upper left corner of the window to windows standards
                mainForm.StartPosition = FormStartPosition.WindowsDefaultLocation;

                // we can still apply the saved size if not empty
                if (Settings.Default.WindowPosition != Rectangle.Empty)
                {
                    mainForm.Size = Settings.Default.WindowPosition.Size;
                }
            }
        }

        private void SaveFormSizeNPosition(MainForm mainForm)
        {
            // only save the WindowState as Normal or Maximized
            Settings.Default.WindowState = FormWindowState.Normal;
            if (mainForm.WindowState == FormWindowState.Normal || mainForm.WindowState == FormWindowState.Maximized)
                Settings.Default.WindowState = mainForm.WindowState;

            if (mainForm.WindowState == FormWindowState.Normal)
            {
                Settings.Default.WindowPosition = mainForm.DesktopBounds;
            }
            else
            {
                if (newRestoredLocation == Point.Empty)
                    Settings.Default.WindowPosition = mainForm.RestoreBounds;
                else
                    Settings.Default.WindowPosition = new Rectangle(newRestoredLocation, mainForm.RestoreBounds.Size);
            }

            Settings.Default.Save();
        }

        private bool IsVisibleOnAnyScreen(Rectangle rect)
        {
            foreach (Screen screen in Screen.AllScreens)
            {
                if (screen.WorkingArea.IntersectsWith(rect))
                    return true;
            }
            return false;
        }

        void mainForm_LocationChanged(object sender, EventArgs e)
        {
            MainForm mainForm = sender as MainForm;
            if (mainForm.WindowState == FormWindowState.Maximized)
            {
                // get the center location of the form incase like RibbonForm will be bigger and maximized Location wll be negative value that Screen.FromPoint(mainForm.Location) will going to the other monitor resides on the left or top of primary monitor.
                // Another thing, you might consider the form is in the monitor even if the location (top left corner) is on another monitor because majority area is on the monitor, so center point is the best way.
                Point centerFormMaximized = new Point (mainForm.DesktopBounds.Left + mainForm.DesktopBounds.Width/2, mainForm.DesktopBounds.Top + mainForm.DesktopBounds.Height/2);
                Point centerFormRestored = new Point(mainForm.RestoreBounds.Left + mainForm.RestoreBounds.Width / 2, mainForm.RestoreBounds.Top + mainForm.RestoreBounds.Height / 2);
                Screen screenMaximized = Screen.FromPoint(centerFormMaximized);
                Screen screenRestored = Screen.FromPoint(centerFormRestored);
                // we need to change the Location of mainForm.RestoreBounds to the new screen where the form currently maximized.
                // RestoreBounds does not update the Location if you change the screen but never restore to FormWindowState.Normal
                if (screenMaximized.DeviceName != screenRestored.DeviceName)
                {
                    newRestoredLocation = mainForm.RestoreBounds.Location;
                    int screenOffsetX = screenMaximized.Bounds.Location.X - screenRestored.Bounds.Location.X;
                    int screenOffsetY = screenMaximized.Bounds.Location.Y - screenRestored.Bounds.Location.Y;
                    newRestoredLocation.Offset(screenOffsetX, screenOffsetY);
                    return;
                }
            }
            newRestoredLocation = Point.Empty;
        }

        void mainForm_FormClosed(object sender, FormClosedEventArgs e)
        {
            MainForm mainForm = sender as MainForm;
            SaveFormSizeNPosition(mainForm);
            mainForm.FormClosed -= new FormClosedEventHandler(mainForm_FormClosed);
            mainForm.LocationChanged -= new EventHandler(mainForm_LocationChanged);
            mainForm.Dispose();
            mainForms.Remove(mainForm);
            if (mainForms.Count == 0) ExitThread();
        }
    }
} 
```

编辑：添加了 PreventSameLocation 方法以确保打开的第二个表单不完全位于第一个表单的顶部，并且用户会注意到新打开的表单。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-02T00:39:05.603

如果您有多个显示器，我相信屏幕 UI 尺寸会更大。因此，存储和恢复位置的正常“1 个监视器”方法将起作用。我没有尝试过这个，因为我远离我的第二台显示器，但它应该不难测试。您提出问题的方式似乎您还没有测试过。

您的第二个要求意味着您必须在恢复应用程序时检查最大屏幕尺寸，然后根据需要重新定位。为此，我使用以下代码：

```
 private System.Drawing.Rectangle ConstrainToScreen(System.Drawing.Rectangle bounds)
    {
        Screen screen = Screen.FromRectangle(bounds);
        System.Drawing.Rectangle workingArea = screen.WorkingArea;
        int width = Math.Min(bounds.Width, workingArea.Width);
        int height = Math.Min(bounds.Height, workingArea.Height);
        // mmm....minimax            
        int left = Math.Min(workingArea.Right - width, Math.Max(bounds.Left, workingArea.Left));
        int top = Math.Min(workingArea.Bottom - height, Math.Max(bounds.Top, workingArea.Top));
        return new System.Drawing.Rectangle(left, top, width, height);
    } 
```

我在恢复表单时调用此方法。我在表单关闭时将屏幕几何图形存储在注册表中，然后在表单打开时读取几何图形。我得到了边界，然后使用上面的方法将恢复的边界约束到实际的当前屏幕。

关闭时保存：

```
 // store the size of the form
      int w = 0, h = 0, left = 0, top = 0;
      if (this.Bounds.Width < this.MinimumSize.Width || this.Bounds.Height < this.MinimumSize.Height)
      {
          // The form is currently minimized.  
          // RestoreBounds is the size of the window prior to last minimize action.
          w = this.RestoreBounds.Width;
          h = this.RestoreBounds.Height;
          left = this.RestoreBounds.Location.X;
          top = this.RestoreBounds.Location.Y;
      }
      else
      {
          w = this.Bounds.Width;
          h = this.Bounds.Height;
          left = this.Location.X;
          top = this.Location.Y;
      }
      AppCuKey.SetValue(_rvn_Geometry,
        String.Format("{0},{1},{2},{3},{4}",
              left, top, w, h, (int)this.WindowState)); 
```

在表单打开时恢复：

```
 // restore the geometry of the form
    string s = (string)AppCuKey.GetValue(_rvn_Geometry);
    if (!String.IsNullOrEmpty(s))
    {
        int[] p = Array.ConvertAll<string, int>(s.Split(','),
                         new Converter<string, int>((t) => { return Int32.Parse(t); }));
        if (p != null && p.Length == 5)
            this.Bounds = ConstrainToScreen(new System.Drawing.Rectangle(p[0], p[1], p[2], p[3]));
    } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-07-24T01:32:33.687

这是一个老问题，但这里是基于先前答案的 VB 版本。

VVS 和 Michael Sorens 提出的答案的一个问题是，在屏幕上仅显示几个像素的已保存位置被视为可见。此解决方案需要至少 50x50 像素的交叉点才能恢复先前的位置。

设置：

```
<Settings>
  <Setting Name="WindowState" Type="System.Windows.Forms.FormWindowState" Scope="User">
    <Value Profile="(Default)">Normal</Value>
  </Setting>
  <Setting Name="WindowBounds" Type="System.Drawing.Rectangle" Scope="User">
    <Value Profile="(Default)">10, 10, 800, 600</Value>
  </Setting>
</Settings> 
```

形式：

```
Partial Public Class MainForm

    Private loadingComplete As Boolean = False

    Public Sub New()

        InitializeComponent()
        RestoreWindowLocation()

    End Sub

    Private Sub MainForm_Load(sender As System.Object, e As System.EventArgs) Handles MyBase.Load

        loadingComplete = True

    End Sub

    Private Sub MainForm_Resize(sender As System.Object, e As System.EventArgs) Handles MyBase.Resize

         TrackWindowLocation()

     End Sub

     Private Sub MainForm_Move(sender As System.Object, e As System.EventArgs) Handles MyBase.Move

         TrackWindowLocation()

     End Sub

    Private Sub MainForm_FormClosing(sender As System.Object, e As System.Windows.Forms.FormClosingEventArgs) Handles MyBase.FormClosing

        SaveWindowLocation()

     End Sub

    Private Sub RestoreWindowLocation()

        If IsRectangleVisible(My.Settings.WindowBounds) Then
            Me.StartPosition = FormStartPosition.Manual
            Me.DesktopBounds = My.Settings.WindowBounds
        End If

        If Not My.Settings.WindowState = FormWindowState.Minimized Then
            Me.WindowState = My.Settings.WindowState
        End If

    End Sub

    Private Sub TrackWindowLocation()

        If loadingComplete Then
            If Me.WindowState = FormWindowState.Normal Then
                My.Settings.WindowBounds = Me.DesktopBounds
                My.Settings.WindowState = Me.WindowState
            End If
        End If

    End Sub

    Private Sub SaveWindowLocation()

        If Not Me.WindowState = FormWindowState.Minimized Then
            My.Settings.WindowState = Me.WindowState
        End If

        If Me.WindowState = FormWindowState.Normal Then
            My.Settings.WindowBounds = Me.DesktopBounds
        End If

        My.Settings.Save()

    End Sub

    Private Function IsRectangleVisible(Rectangle As Rectangle) As Boolean

        For Each screen As Screen In screen.AllScreens
            Dim r As Rectangle = Rectangle.Intersect(Rectangle, screen.WorkingArea)
            If Not r.IsEmpty Then
                If r.Width > 50 And r.Height > 50 Then Return True
            End If
        Next

        Return False

    End Function

End Class 
```

# java - 简单的java消息调度系统

> ID：937302
> 
> 赞同：19
> 
> 时间：2009-06-01T23:28:52.673
> 
> 标签：java, design-patterns, events

我正在开发一个可以发生各种事件的小型 Java 游戏。至少有几十个基本事件是各种事件处理程序可能感兴趣的。代码中还有几个地方可能会触发这些事件。我不想强迫事件侦听器知道他们需要注册哪个类，而是想创建某种集中式消息调度系统，一些类会将事件提交到该系统中，感兴趣的类可以挂钩以侦听某些类型的事件。

但我有一些问题。首先，这似乎是一个明显且普遍的问题。有没有最喜欢的简单、虚拟机内消息传递系统的实现？好像会有。

其次，更重要的是，我正在尝试为调度类制定一种相当优雅的方式，以尽可能少地了解消息类型。我希望能够在完全不修改消息调度程序的情况下创建新类型的事件。但是，我有一个相反的担忧。我真的很希望处理方法的方法签名清晰。换句话说，我更喜欢以下内容：

```
public class CollisionConsoleHandler implements CollisionListener {
  @Override
  public void spaceshipCollidedWithMeteor( Spaceship spaceship, Meteor meteor ) {
      //...
  }
} 
```

关于更通用且更难阅读的内容：

```
public class CollisionConsoleHandler implements GameMessageListener {
   @Override
   public void handleMessage( GameMessage message ) {
     if( message instanceof SpaceshipCollisionMessage ) {
        Spaceship spaceship = ((SpaeshipCollisionMessage)message).getSpaceship();
        Meteor meteor = ((SpaeshipCollisionMessage)message).getMeteor();
        //...
     }
   }
} 
```

但是我没有看到任何好的方法可以将特定于类型的知识排除在调度程序之外，同时保持方法签名的清洁和可读性。

想法？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-06-03T03:59:32.847

如果每个事件都有特定的侦听器接口。每个事件都能够自己发出监听器调用。然后，调度程序的作用是识别目标侦听器并在它们上触发事件通知。

例如，通用事件定义可以是：

```
public interface GameEvent<L> {

   public void notify( final L listener);
} 
```

如果您的 CollisionListener 是：

```
public interface CollisionListener {

    public void spaceshipCollidedWithMeteor( Spaceship spaceship, Meteor meteor );

} 
```

那么，对应的事件可以是：

```
public final class Collision implements GameEvent<CollisionListener> {

   private final Spaceship ship;
   private final Meteor meteor;

   public Collision( final Spaceship aShip, final Meteor aMeteor ) {
      this.ship = aShip;
      this.meteor = aMeteor;
   }

   public void notify( final CollisionListener listener) {
      listener.spaceshipCollidedWithMeteor( ship, meteor );
   }

} 
```

您可以想象一个调度程序能够在目标侦听器上传播此事件，如下面的场景（Events 是调度程序类）：

```
// A unique dispatcher
final static Events events = new Events();

// Somewhere, an observer is interested by collision events 
CollisionListener observer = ...
events.listen( Collision.class, observer );

// there is some moving parts        
Spaceship aShip = ...
Meteor aMeteor = ...

// Later they collide => a collision event is notified trough the dispatcher
events.notify( new Collision( aShip, aMeteor  ) ); 
```

在这种情况下，调度程序不需要任何有关事件和侦听器的知识。它仅使用 GameEvent 接口向每个侦听器触发单独的事件通知。每个事件/侦听器对选择它自己的对话模式（如果他们愿意，他们可以交换许多消息）。

这种调度程序的典型实现应该是这样的：

```
public final class Events {

   /** mapping of class events to active listeners **/
   private final HashMap<Class,ArrayList> map = new HashMap<Class,ArrayList >( 10 );

   /** Add a listener to an event class **/
   public <L> void listen( Class<? extends GameEvent<L>> evtClass, L listener) {
      final ArrayList<L> listeners = listenersOf( evtClass );
      synchronized( listeners ) {
         if ( !listeners.contains( listener ) ) {
            listeners.add( listener );
         }
      }
   }

    /** Stop sending an event class to a given listener **/
    public <L> void mute( Class<? extends GameEvent<L>> evtClass, L listener) {
      final ArrayList<L> listeners = listenersOf( evtClass );
      synchronized( listeners ) {
         listeners.remove( listener );
      }
   }

   /** Gets listeners for a given event class **/
   private <L> ArrayList<L> listenersOf(Class<? extends GameEvent<L>> evtClass) {
      synchronized ( map ) {
         @SuppressWarnings("unchecked")
         final ArrayList<L> existing = map.get( evtClass );
         if (existing != null) {
            return existing;
         }

         final ArrayList<L> emptyList = new ArrayList<L>(5);
         map.put(evtClass, emptyList);
         return emptyList;
      }
   }

   /** Notify a new event to registered listeners of this event class **/
   public <L> void notify( final GameEvent<L> evt) {
      @SuppressWarnings("unchecked")
      Class<GameEvent<L>> evtClass = (Class<GameEvent<L>>) evt.getClass();

      for ( L listener : listenersOf(  evtClass ) ) {
         evt.notify(listener);
      }
   }

} 
```

我想它可以满足您的要求：

*   很轻，
*   快速地，
*   没有演员表（使用时），
*   在编译时检查每件事（没有可能的错误），
*   对侦听器没有 API 限制（每个事件都选择自己的消息），
*   进化（不同事件和/或侦听器之间没有依赖关系），
*   调度程序是一个通用的黑匣子，
*   消费者和生产者不需要相互了解。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T23:33:53.490

如果您想避免`instanceof`，那么您唯一的选择是使用继承将方法调用路由到正确的方法。您不能使用方法重载，因为这是在编译时由您传递给方法的变量的*声明类型决定的。*你必须使用继承。

如果您不能使用继承，那么您唯一的其他选择（我知道）涉及很多`instanceof`.

关于消息传递系统，您可以使用[ActiveMQ](http://activemq.apache.org/)作为 JVM 内消息传输。您不必通过套接字或其他方式使用它。我无法想象 ActiveMQ 的效率不足以满足您的需求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T00:06:43.827

Java bean 应该有这个接口：它让生活变得更简单。

```
interface PropertyChangeProvider {
  void addPropertyChangeListener(PropertyChangeListener l);
  void addPropertyChangeListener(String property, PropertyChangeListener l);
  void removePropertyChangeListener(PropertyChangeListener l);
  void removePropertyChangeListener(String property, PropertyChangeListener l);
} 
```

到处实施。

做一个黑板课（可能是一个单例。这只是一个草图）

```
public class Blackboard implements PropertyChangeListener,PropertyChangeProvider {

static Blackboard getInstance(){
    // implement this
}

void initialise(){
   // start the thread here
}

void republish(){
     // this can save you heartache too.
}

} 
```

给 Blackboard 一个线程，监听事件并使用它自己的线程重新发布。

班级可以将他们的事件发布到黑板上。

订阅黑板上的活动。

如果你愿意，你可以持久化事件，允许重新发布等。

对于应用程序内部的某些东西，它非常好。（与数据交换接口一样好用！）

# iphone - 如何相对于其超级视图的坐标系移动旋转视图？

> ID：937303
> 
> 赞同：1
> 
> 时间：2009-06-01T23:28:58.443
> 
> 标签：iphone, cocoa-touch, uikit, core-graphics

当改变 10 度旋转视图的中心点时，中心点的指定坐标将与父视图的坐标系不匹配。

例如，当您想直线向上移动 y - 50，并且没有水平移动（即 x = theRotatedView.center.x）时，y 方向的偏移将被旋转。视图将向上和向右，而不仅仅是向上。

旋转是在视图上完成的，而不是在图层上。

我可以将它包装在一个进行移动的超级视图中，而子视图进行旋转。然后我在转换方面没有问题。但也许有一些简单的解决方案。我只想移动旋转视图的中心，就好像视图没有旋转一样，即当希望 y 减少 10 时，只需这样做而不用担心旋转的坐标。是否有任何方法或函数可以在坐标系之间进行转换，以便我可以在超级视图坐标中指定中心点坐标，并且在将这些应用于旋转视图的 center 属性时会正确吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T06:01:51.623

查看 CGAffineTransform 方法，例如 CGAffineTransformMake，以更轻松地生成所需的转换。您可以在一个矩阵中组合旋转和平移。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T23:37:37.960

您可以将坐标乘以变换矩阵。这会将您的坐标放入父视图的“坐标空间”中。您还可以使用父视图的逆矩阵来获取父视图中的坐标并将它们返回到“世界空间”。

[http://en.wikipedia.org/wiki/Rotation_matrix](http://en.wikipedia.org/wiki/Rotation_matrix)

进一步阅读页面下方的伪代码示例。

# java - 在 ExpandableListView 中，如何在子结果的末尾再显示一行？

> ID：937307
> 
> 赞同：4
> 
> 时间：2009-06-01T23:31:03.760
> 
> 标签：java, android, expandablelistview, expandablelistadapter

我创建了一个自定义[ExpandableListAdapter](http://developer.android.com/reference/android/widget/ExpandableListAdapter.html)并且一切正常。我想做的是在每个组的末尾添加不同类型的孩子。我尝试将`getChildrenCount()`数字加 1，然后`isLastChild`在该`getChildView()`方法中进行测试，但这似乎不起作用。

如果一个小组有三个孩子，我的工作如下所示：

```
团体
    正常儿童
    正常儿童
    正常儿童

```

但我真的很喜欢这样的东西：

```
团体
    正常儿童
    正常儿童
    正常儿童
    备用子

```

这个想法是`AlternateChild`可以链接到有关该组的更多信息。有任何想法吗？

**编辑：** [ListView](http://developer.android.com/reference/android/widget/ListView.html)有[addFooterView()](http://developer.android.com/reference/android/widget/ListView.html#addFooterView(android.view.View))可以让你添加一个页脚到一个整体`ListView`......想知道如何将它们添加到 ExpandableListView 的孩子，或者如果它甚至可能

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-03T18:40:53.997

也许你可以尝试一种稍微不同的方法。

与其尝试直接向 ListView 添加额外的项目，不如尝试使用“isAlternateChild”标志（或子类化`NormalChild`或创建使用and`IChild`扩展的接口）将“AlternateChild”对象添加到底层数据源。`NormalChild``AlternateChild`

然后，`getChildView`您可以检查视图中显示的对象是正常的还是备用的，并相应地创建或填充适当的视图类型。

通过直接将额外对象添加到基础数据/列表中，您可以让 ExtendedListView 正常执行其操作。作为额外的好处，这意味着您可以使 AlternateChild 数据动态化，并通过修改相应的对象轻松更改视图中显示的数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-01-27T19:00:37.550

在我看来，这是一个更好的[答案](https://stackoverflow.com/a/4598346/3050951)

如果需要，我试图在每个组的最后一个孩子下方放置一个操作栏，这非常有用。由于操作栏与我的数据无关，我不能使用同一个对象。

# android - 网格布局上的 Fling 手势检测

> ID：937313
> 
> 赞同：1147
> 
> 时间：2009-06-01T23:35:31.800
> 
> 标签：android, listener, gesture-recognition

我想`fling`在我的 Android 应用程序中进行手势检测。

我所拥有的是一个`GridLayout`包含 9 `ImageView`s。可以在此处找到源：[Romain Guys 的网格布局](https://github.com/selmanon/apps-for-android/blob/master/Photostream/src/com/google/android/photostream/GridLayout.java)。

我拍摄的那个文件来自 Romain Guy 的[Photostream 应用程序](http://code.google.com/p/apps-for-android/)，只是稍作修改。

对于简单的点击情况，我只需要将添加的`onClickListener`for each设置为实现`ImageView`的 main 。实现识别. 我想这是因为它可能跨越？`activity``View.OnClickListener``fling``views`

*   如果我的活动实现 `OnGestureListener`了，我不知道如何将其设置为我添加`Grid`的视图或视图的手势监听器。`Image`

    ```
    public class SelectFilterActivity extends Activity implements
       View.OnClickListener, OnGestureListener { ... 
    ```

*   如果我的活动实现了 `OnTouchListener`，那么我没有 `onFling`办法`override`（它有两个事件作为参数，允许我确定投掷是否值得注意）。

    ```
    public class SelectFilterActivity extends Activity implements
        View.OnClickListener, OnTouchListener { ... 
    ```

*   如果我进行自定义`View`，就像`GestureImageView`这样扩展，`ImageView`我不知道如何告诉活动`fling`从视图中发生了 a 。无论如何，我尝试了这个，当我触摸屏幕时没有调用这些方法。

我真的只需要一个跨视图工作的具体示例。什么，何时以及如何附上这个`listener`？我还需要能够检测到单击。

```
// Gesture detection
mGestureDetector = new GestureDetector(this, new GestureDetector.SimpleOnGestureListener() {

    public boolean onFling(MotionEvent e1, MotionEvent e2, float velocityX, float velocityY) {
        int dx = (int) (e2.getX() - e1.getX());
        // don't accept the fling if it's too short
        // as it may conflict with a button push
        if (Math.abs(dx) > MAJOR_MOVE && Math.abs(velocityX) > Math.absvelocityY)) {
            if (velocityX > 0) {
                moveRight();
            } else {
                moveLeft();
            }
            return true;
        } else {
            return false;
        }
    }
}); 
```

是否可以在我的屏幕顶部放置一个透明视图来捕捉一闪而过？

如果我选择不`inflate`从 XML 到我的子图像视图，我可以将`GestureDetector`作为构造函数参数传递给`ImageView`我创建的新子类吗？

这是我试图让`fling`检测工作的非常简单的活动：[SelectFilterActivity (Adapted from photostream)](http://code.google.com/p/miffed/source/browse/GUI/src/uk/ac/ic/doc/gea05/miffed/gui/SelectFilterActivity.java?r=210)。

我一直在寻找这些来源：

*   [检测手势 - 教程](http://www.anddev.org/gesturedetector_and_gesturedetectorongesturelistener-t3204.html)

*   [开发工具包文档](http://developer.android.com/reference/android/view/GestureDetector.SimpleOnGestureListener.html)

*   [计算器代码](http://www.google.co.in/codesearch/p?hl=en#RzGvLIykRFs/src/com/android/calculator2/PanelSwitcher.java&q=android%20package:git://android.git.kernel.org%20Calculator2)

到目前为止，没有什么对我有用，我希望得到一些指示。

* * *

## 回答 #1

> 赞同：835
> 
> 时间：2009-06-02T09:30:55.207

感谢[Code Shogun](https://web.archive.org/web/20090503094429/http://www.codeshogun.com/blog/2009/04/16/how-to-implement-swipe-action-in-android/)，我根据我的情况调整了他的代码。

让您的活动`OnClickListener`照常实施：

```
public class SelectFilterActivity extends Activity implements OnClickListener {

  private static final int SWIPE_MIN_DISTANCE = 120;
  private static final int SWIPE_MAX_OFF_PATH = 250;
  private static final int SWIPE_THRESHOLD_VELOCITY = 200;
  private GestureDetector gestureDetector;
  View.OnTouchListener gestureListener;

  @Override
  protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);

    /* ... */

    // Gesture detection
    gestureDetector = new GestureDetector(this, new MyGestureDetector());
    gestureListener = new View.OnTouchListener() {
      public boolean onTouch(View v, MotionEvent event) {
        return gestureDetector.onTouchEvent(event);
      }
    };

  }

  class MyGestureDetector extends SimpleOnGestureListener {
    @Override
    public boolean onFling(MotionEvent e1, MotionEvent e2, float velocityX, float velocityY) {
      try {
        if (Math.abs(e1.getY() - e2.getY()) > SWIPE_MAX_OFF_PATH)
          return false;
        // right to left swipe
        if(e1.getX() - e2.getX() > SWIPE_MIN_DISTANCE && Math.abs(velocityX) > SWIPE_THRESHOLD_VELOCITY) {
          Toast.makeText(SelectFilterActivity.this, "Left Swipe", Toast.LENGTH_SHORT).show();
        } else if (e2.getX() - e1.getX() > SWIPE_MIN_DISTANCE && Math.abs(velocityX) > SWIPE_THRESHOLD_VELOCITY) {
          Toast.makeText(SelectFilterActivity.this, "Right Swipe", Toast.LENGTH_SHORT).show();
        }
      } catch (Exception e) {
         // nothing
      }
      return false;
    }

    @Override
    public boolean onDown(MotionEvent e) {
      return true;
    }
  }
} 
```

将您的手势监听器附加到您添加到主布局的所有视图；

```
// Do this for each view added to the grid
imageView.setOnClickListener(SelectFilterActivity.this); 
imageView.setOnTouchListener(gestureListener); 
```

敬畏地观看你的重写方法，无论是`onClick(View v)`活动的`onFling`还是手势监听器的。

```
public void onClick(View v) {
  Filter f = (Filter) v.getTag();
  FilterFullscreenActivity.show(this, input, f);
} 
```

后“投掷”舞蹈是可选的，但鼓励。

* * *

## 回答 #2

> 赞同：215
> 
> 时间：2011-04-20T17:26:49.330

上面的答案之一提到处理不同的像素密度，但建议手动计算滑动参数。值得注意的是，您实际上可以使用`ViewConfiguration`类从系统中获取缩放的、合理的值：

```
final ViewConfiguration vc = ViewConfiguration.get(getContext());
final int swipeMinDistance = vc.getScaledPagingTouchSlop();
final int swipeThresholdVelocity = vc.getScaledMinimumFlingVelocity();
final int swipeMaxOffPath = vc.getScaledTouchSlop();
// (there is also vc.getScaledMaximumFlingVelocity() one could check against) 
```

我注意到使用这些值会使应用程序和系统其余部分之间的“感觉”更加一致。

* * *

## 回答 #3

> 赞同：152
> 
> 时间：2011-04-21T10:24:21.823

我做的有点不同，并编写了一个额外的检测器类来实现`View.onTouchListener`

`onCreate`只需将其添加到最低布局，如下所示：

```
ActivitySwipeDetector activitySwipeDetector = new ActivitySwipeDetector(this);
lowestLayout = (RelativeLayout)this.findViewById(R.id.lowestLayout);
lowestLayout.setOnTouchListener(activitySwipeDetector); 
```

其中 id.lowestLayout 是布局层次结构中最低视图的 id.xxx，lowestLayout 被声明为 RelativeLayout

然后是实际的活动滑动检测器类：

```
public class ActivitySwipeDetector implements View.OnTouchListener {

static final String logTag = "ActivitySwipeDetector";
private Activity activity;
static final int MIN_DISTANCE = 100;
private float downX, downY, upX, upY;

public ActivitySwipeDetector(Activity activity){
    this.activity = activity;
}

public void onRightSwipe(){
    Log.i(logTag, "RightToLeftSwipe!");
    activity.doSomething();
}

public void onLeftSwipe(){
    Log.i(logTag, "LeftToRightSwipe!");
    activity.doSomething();
}

public void onDownSwipe(){
    Log.i(logTag, "onTopToBottomSwipe!");
    activity.doSomething();
}

public void onUpSwipe(){
    Log.i(logTag, "onBottomToTopSwipe!");
    activity.doSomething();
}

public boolean onTouch(View v, MotionEvent event) {
    switch(event.getAction()){
        case MotionEvent.ACTION_DOWN: {
            downX = event.getX();
            downY = event.getY();
            return true;
        }
        case MotionEvent.ACTION_UP: {
            upX = event.getX();
            upY = event.getY();

            float deltaX = downX - upX;
            float deltaY = downY - upY;

       // swipe horizontal?
        if(Math.abs(deltaX) > Math.abs(deltaY))
        {
            if(Math.abs(deltaX) > MIN_DISTANCE){
                // left or right
                if(deltaX > 0) { this.onRightSwipe(); return true; }
                if(deltaX < 0) { this.onLeftSwipe(); return true; }
            }
            else {
                    Log.i(logTag, "Horizontal Swipe was only " + Math.abs(deltaX) + " long, need at least " + MIN_DISTANCE);
                    return false; // We don't consume the event
            }
        }
        // swipe vertical?
        else 
        {
            if(Math.abs(deltaY) > MIN_DISTANCE){
                // top or down
                if(deltaY < 0) { this.onDownSwipe(); return true; }
                if(deltaY > 0) { this.onUpSwipe(); return true; }
            }
            else {
                    Log.i(logTag, "Vertical Swipe was only " + Math.abs(deltaX) + " long, need at least " + MIN_DISTANCE);
                    return false; // We don't consume the event
            }
        }

            return true;
        }
    }
    return false;
}

} 
```

对我来说真的很好用！

* * *

## 回答 #4

> 赞同：98
> 
> 时间：2012-01-10T16:11:19.260

我稍微修改和修复了**[Thomas Fankhauser的解决方案](https://stackoverflow.com/a/5742763/492624)**

整个系统由两个文件组成，**SwipeInterface**和**ActivitySwipeDetector**

* * *

*SwipeInterface.java*

```
import android.view.View;

public interface SwipeInterface {

    public void bottom2top(View v);

    public void left2right(View v);

    public void right2left(View v);

    public void top2bottom(View v);

} 
```

* * *

*探测器*

```
import android.util.Log;
import android.view.MotionEvent;
import android.view.View;

public class ActivitySwipeDetector implements View.OnTouchListener {

    static final String logTag = "ActivitySwipeDetector";
    private SwipeInterface activity;
    static final int MIN_DISTANCE = 100;
    private float downX, downY, upX, upY;

    public ActivitySwipeDetector(SwipeInterface activity){
        this.activity = activity;
    }

    public void onRightToLeftSwipe(View v){
        Log.i(logTag, "RightToLeftSwipe!");
        activity.right2left(v);
    }

    public void onLeftToRightSwipe(View v){
        Log.i(logTag, "LeftToRightSwipe!");
        activity.left2right(v);
    }

    public void onTopToBottomSwipe(View v){
        Log.i(logTag, "onTopToBottomSwipe!");
        activity.top2bottom(v);
    }

    public void onBottomToTopSwipe(View v){
        Log.i(logTag, "onBottomToTopSwipe!");
        activity.bottom2top(v);
    }

    public boolean onTouch(View v, MotionEvent event) {
        switch(event.getAction()){
        case MotionEvent.ACTION_DOWN: {
            downX = event.getX();
            downY = event.getY();
            return true;
        }
        case MotionEvent.ACTION_UP: {
            upX = event.getX();
            upY = event.getY();

            float deltaX = downX - upX;
            float deltaY = downY - upY;

            // swipe horizontal?
            if(Math.abs(deltaX) > MIN_DISTANCE){
                // left or right
                if(deltaX < 0) { this.onLeftToRightSwipe(v); return true; }
                if(deltaX > 0) { this.onRightToLeftSwipe(v); return true; }
            }
            else {
                Log.i(logTag, "Swipe was only " + Math.abs(deltaX) + " long, need at least " + MIN_DISTANCE);
            }

            // swipe vertical?
            if(Math.abs(deltaY) > MIN_DISTANCE){
                // top or down
                if(deltaY < 0) { this.onTopToBottomSwipe(v); return true; }
                if(deltaY > 0) { this.onBottomToTopSwipe(v); return true; }
            }
            else {
                Log.i(logTag, "Swipe was only " + Math.abs(deltaX) + " long, need at least " + MIN_DISTANCE);
                v.performClick();
            }
        }
        }
        return false;
    }

} 
```

* * *

它是这样使用的：

```
ActivitySwipeDetector swipe = new ActivitySwipeDetector(this);
LinearLayout swipe_layout = (LinearLayout) findViewById(R.id.swipe_layout);
swipe_layout.setOnTouchListener(swipe); 
```

* * *

在实现过程中`Activity`，您需要实现**SwipeInterface**中的方法，您可以找出在哪个 View 上调用了*Swipe 事件。*

```
@Override
public void left2right(View v) {
    switch(v.getId()){
        case R.id.swipe_layout:
            // do your stuff here
        break;
    }       
} 
```

* * *

## 回答 #5

> 赞同：69
> 
> 时间：2011-02-18T09:45:16.207

上面的滑动手势检测器代码非常有用！但是，您可能希望通过使用以下相对值`(REL_SWIPE)`而不是绝对值来使此解决方案密度不可知`(SWIPE_)`

```
DisplayMetrics dm = getResources().getDisplayMetrics();

int REL_SWIPE_MIN_DISTANCE = (int)(SWIPE_MIN_DISTANCE * dm.densityDpi / 160.0f);
int REL_SWIPE_MAX_OFF_PATH = (int)(SWIPE_MAX_OFF_PATH * dm.densityDpi / 160.0f);
int REL_SWIPE_THRESHOLD_VELOCITY = (int)(SWIPE_THRESHOLD_VELOCITY * dm.densityDpi / 160.0f); 
```

* * *

## 回答 #6

> 赞同：39
> 
> 时间：2012-07-18T01:00:52.337

[我的Thomas Fankhauser](https://stackoverflow.com/a/5742763/676369)和[Marek Sebera](https://stackoverflow.com/a/8806468/676369)提出的解决方案版本（不处理垂直滑动）：

**SwipeInterface.java**

```
import android.view.View;

public interface SwipeInterface {

    public void onLeftToRight(View v);

    public void onRightToLeft(View v);
} 
```

**ActivitySwipeDetector.java**

```
import android.content.Context;
import android.util.DisplayMetrics;
import android.util.Log;
import android.view.MotionEvent;
import android.view.View;
import android.view.ViewConfiguration;

public class ActivitySwipeDetector implements View.OnTouchListener {

    static final String logTag = "ActivitySwipeDetector";
    private SwipeInterface activity;
    private float downX, downY;
    private long timeDown;
    private final float MIN_DISTANCE;
    private final int VELOCITY;
    private final float MAX_OFF_PATH;

    public ActivitySwipeDetector(Context context, SwipeInterface activity){
        this.activity = activity;
        final ViewConfiguration vc = ViewConfiguration.get(context);
        DisplayMetrics dm = context.getResources().getDisplayMetrics();
        MIN_DISTANCE = vc.getScaledPagingTouchSlop() * dm.density;
        VELOCITY = vc.getScaledMinimumFlingVelocity();
        MAX_OFF_PATH = MIN_DISTANCE * 2;            
    }

    public void onRightToLeftSwipe(View v){
        Log.i(logTag, "RightToLeftSwipe!");
        activity.onRightToLeft(v);
    }

    public void onLeftToRightSwipe(View v){
        Log.i(logTag, "LeftToRightSwipe!");
        activity.onLeftToRight(v);
    }

    public boolean onTouch(View v, MotionEvent event) {
        switch(event.getAction()){
        case MotionEvent.ACTION_DOWN: {
            Log.d("onTouch", "ACTION_DOWN");
            timeDown = System.currentTimeMillis();
            downX = event.getX();
            downY = event.getY();
            return true;
        }
        case MotionEvent.ACTION_UP: {
            Log.d("onTouch", "ACTION_UP");
            long timeUp = System.currentTimeMillis();
            float upX = event.getX();
            float upY = event.getY();

            float deltaX = downX - upX;
            float absDeltaX = Math.abs(deltaX); 
            float deltaY = downY - upY;
            float absDeltaY = Math.abs(deltaY);

            long time = timeUp - timeDown;

            if (absDeltaY > MAX_OFF_PATH) {
                Log.i(logTag, String.format("absDeltaY=%.2f, MAX_OFF_PATH=%.2f", absDeltaY, MAX_OFF_PATH));
                return v.performClick();
            }

            final long M_SEC = 1000;
            if (absDeltaX > MIN_DISTANCE && absDeltaX > time * VELOCITY / M_SEC) {
                if(deltaX < 0) { this.onLeftToRightSwipe(v); return true; }
                if(deltaX > 0) { this.onRightToLeftSwipe(v); return true; }
            } else {
                Log.i(logTag, String.format("absDeltaX=%.2f, MIN_DISTANCE=%.2f, absDeltaX > MIN_DISTANCE=%b", absDeltaX, MIN_DISTANCE, (absDeltaX > MIN_DISTANCE)));
                Log.i(logTag, String.format("absDeltaX=%.2f, time=%d, VELOCITY=%d, time*VELOCITY/M_SEC=%d, absDeltaX > time * VELOCITY / M_SEC=%b", absDeltaX, time, VELOCITY, time * VELOCITY / M_SEC, (absDeltaX > time * VELOCITY / M_SEC)));
            }

        }
        }
        return false;
    }

} 
```

* * *

## 回答 #7

> 赞同：30
> 
> 时间：2012-04-23T19:54:51.073

这个问题有点老了，2011 年 7 月谷歌发布了[兼容包，修订版 3)](http://developer.android.com/sdk/compatibility-library.html)，其中包括`ViewPager`适用于 Android 1.6 以上的版本。为这个问题发布的`GestureListener`答案在 Android 上感觉不是很优雅。如果您正在寻找在 Android 图库中的照片之间切换或在新的 Play 市场应用程序中切换视图时使用的代码，那么它肯定是`ViewPager`.

**以下是一些链接以获取更多信息：**

*   [http://android-developers.blogspot.com/2011/08/horizo​​ntal-view-swiping-with-viewpager.html](http://android-developers.blogspot.com/2011/08/horizontal-view-swiping-with-viewpager.html)
*   [http://mobile.tutsplus.com/tutorials/android/android-user-interface-design-horizo​​ntal-view-paging/](http://mobile.tutsplus.com/tutorials/android/android-user-interface-design-horizontal-view-paging/)
*   [http://thepseudocoder.wordpress.com/2011/10/05/android-page-swiping-using-viewpager/](http://thepseudocoder.wordpress.com/2011/10/05/android-page-swiping-using-viewpager/)

* * *

## 回答 #8

> 赞同：24
> 
> 时间：2013-04-05T14:28:13.783

有一个内置界面，您可以直接将其用于所有手势：
以下是针对基本级别用户的说明： ![在此处输入图像描述](https://i.stack.imgur.com/elTuu.jpg) 有2个进口要小心选择两者不同 ![在此处输入图像描述](https://i.stack.imgur.com/pvkQn.jpg) ![在此处输入图像描述](https://i.stack.imgur.com/bZJ78.jpg)

* * *

## 回答 #9

> 赞同：21
> 
> 时间：2012-02-09T21:33:44.973

在网络（和这个页面）上有一些使用 ViewConfiguration 的提议。**getScaledTouchSlop()**为`SWIPE_MIN_DISTANCE`.

`getScaledTouchSlop()`用于“**滚动**阈值”距离，而不是滑动。滚动阈值距离必须小于“页面之间的摆动”阈值距离。例如，此函数在我的三星 GS2 上返回 12 像素，而本页引用的示例约为 100 像素。

使用 API 级别 8（Android 2.2，Froyo），您就拥有了**`getScaledPagingTouchSlop()`**，用于页面滑动。在我的设备上，它返回 24（像素）。因此，如果您的 API 级别 < 8，我认为“2 * `getScaledTouchSlop()`”应该是“标准”滑动阈值。但是我的应用程序的小屏幕用户告诉我它太少了......就像我的应用程序一样，你可以垂直滚动，水平改变页面。使用建议的值，他们有时会更改页面而不是滚动。

* * *

## 回答 #10

> 赞同：16
> 
> 时间：2011-04-12T21:14:06.220

也作为一个小的增强。

try/catch 块的主要原因是 e1 对于初始移动可能为空。除了 try/catch，还包括对 null 和 return 的测试。类似于以下

```
if (e1 == null || e2 == null) return false;
try {
...
} catch (Exception e) {}
return false; 
```

* * *

## 回答 #11

> 赞同：16
> 
> 时间：2014-12-07T07:49:00.777

如果有人想要一个有效的实现，这是顶部两个答案的组合答案。

```
package com.yourapplication;

import android.content.Context;
import android.view.GestureDetector;
import android.view.MotionEvent;
import android.view.View;
import android.view.ViewConfiguration;

public abstract class OnSwipeListener implements View.OnTouchListener {

    private final GestureDetector gestureDetector;

    public OnSwipeListener(Context context){
        gestureDetector = new GestureDetector(context, new OnSwipeGestureListener(context));
        gestureDetector.setIsLongpressEnabled(false);
    }

    @Override
    public boolean onTouch(View view, MotionEvent event) {
        return gestureDetector.onTouchEvent(event);
    }

    private final class OnSwipeGestureListener extends GestureDetector.SimpleOnGestureListener {

        private final int minSwipeDelta;
        private final int minSwipeVelocity;
        private final int maxSwipeVelocity;

        private OnSwipeGestureListener(Context context) {
            ViewConfiguration configuration = ViewConfiguration.get(context);
            // We think a swipe scrolls a full page.
            //minSwipeDelta = configuration.getScaledTouchSlop();
            minSwipeDelta = configuration.getScaledPagingTouchSlop();
            minSwipeVelocity = configuration.getScaledMinimumFlingVelocity();
            maxSwipeVelocity = configuration.getScaledMaximumFlingVelocity();
        }

        @Override
        public boolean onDown(MotionEvent event) {
            // Return true because we want system to report subsequent events to us.
            return true;
        }

        // NOTE: see http://stackoverflow.com/questions/937313/android-basic-gesture-detection
        @Override
        public boolean onFling(MotionEvent event1, MotionEvent event2, float velocityX,
                               float velocityY) {

            boolean result = false;
            try {
                float deltaX = event2.getX() - event1.getX();
                float deltaY = event2.getY() - event1.getY();
                float absVelocityX = Math.abs(velocityX);
                float absVelocityY = Math.abs(velocityY);
                float absDeltaX = Math.abs(deltaX);
                float absDeltaY = Math.abs(deltaY);
                if (absDeltaX > absDeltaY) {
                    if (absDeltaX > minSwipeDelta && absVelocityX > minSwipeVelocity
                            && absVelocityX < maxSwipeVelocity) {
                        if (deltaX < 0) {
                            onSwipeLeft();
                        } else {
                            onSwipeRight();
                        }
                    }
                    result = true;
                } else if (absDeltaY > minSwipeDelta && absVelocityY > minSwipeVelocity
                        && absVelocityY < maxSwipeVelocity) {
                    if (deltaY < 0) {
                        onSwipeTop();
                    } else {
                        onSwipeBottom();
                    }
                }
                result = true;
            } catch (Exception e) {
                e.printStackTrace();
            }
            return result;
        }
    }

    public void onSwipeLeft() {}

    public void onSwipeRight() {}

    public void onSwipeTop() {}

    public void onSwipeBottom() {}
} 
```

* * *

## 回答 #12

> 赞同：15
> 
> 时间：2011-11-02T23:14:45.690

这里有很多很棒的信息。不幸的是，很多这样的处理代码分散在不同的站点上，处于不同的完成状态，尽管人们会认为这对许多应用程序来说是必不可少的。

我花时间创建了一个[fling 侦听](https://svn.globalmentor.com/java/trunk/globalmentor-android/src/main/java/com/globalmentor/android/widget/VerifiedFlingListener.java)器来验证是否满足适当的条件。我添加了一个[页面投掷侦听](https://svn.globalmentor.com/java/trunk/globalmentor-android/src/main/java/com/globalmentor/android/widget/PageFlingListener.java)器，它添加了更多检查以确保投掷符合页面投掷的阈值。这两个侦听器都允许您轻松地将投掷限制在水平或垂直轴上。您可以看到它是如何在[滑动图像视图中](https://svn.globalmentor.com/java/trunk/globalmentor-android/src/main/java/com/globalmentor/android/widget/ImageSlideView.java)使用的。我承认这里的人已经完成了大部分研究——我只是把它放在一个可用的库中。

这几天是我第一次尝试在 Android 上编码。期待[更多](https://svn.globalmentor.com/java/trunk/globalmentor-android/)。

* * *

## 回答 #13

> 赞同：14
> 
> 时间：2013-01-24T17:49:57.550

您可以使用[droidQuery](http://bit.ly/droidquery)库来处理轻击、点击、长按和自定义事件。该实现是基于我之前在下面的答案构建的，但*droidQuery*提供了一种巧妙、简单的语法：

```
//global variables    private boolean isSwiping = false;
private SwipeDetector.Direction swipeDirection = null;
private View v;//must be instantiated before next call.

//swipe-handling code
$.with(v).swipe(new Function() {
    @Override
    public void invoke($ droidQuery, Object... params) {
        if (params[0] == SwipeDetector.Direction.START)
            isSwiping = true;
        else if (params[0] == SwipeDetector.Direction.STOP) {
            if (isSwiping) {                    isSwiping = false;
                if (swipeDirection != null) {
                    switch(swipeDirection) {
                        case DOWN :                                //TODO: Down swipe complete, so do something
                            break;
                        case UP :
                            //TODO: Up swipe complete, so do something
                            break;
                        case LEFT :
                            //TODO: Left swipe complete, so do something
                            break;
                        case RIGHT :
                            //TODO: Right swipe complete, so do something
                            break;
                        default :                                break;
                    }
                }                }
        }
        else {
            swipeDirection = (SwipeDetector.Direction) params[0];
        }
    }
}); 
```

## 原始答案

此答案使用此处其他答案中的组件组合。它由`SwipeDetector`类组成，该类具有用于侦听事件的内部接口。我还提供了一个 `RelativeLayout`来展示如何覆盖 a`View`的`onTouch`方法以允许滑动事件和其他检测到的事件（例如点击或长按）。

**滑动检测器**

```
package self.philbrown;

import android.view.MotionEvent;
import android.view.View;
import android.view.ViewConfiguration;

/**
 * Detect Swipes on a per-view basis. Based on original code by Thomas Fankhauser on StackOverflow.com,
 * with adaptations by other authors (see link).
 * @author Phil Brown
 * @see <a href="http://stackoverflow.com/questions/937313/android-basic-gesture-detection">android-basic-gesture-detection</a>
 */
public class SwipeDetector implements View.OnTouchListener
{
    /**
     * The minimum distance a finger must travel in order to register a swipe event.
     */
    private int minSwipeDistance;

    /** Maintains a reference to the first detected down touch event. */
    private float downX, downY;

    /** Maintains a reference to the first detected up touch event. */
    private float upX, upY;

    /** provides access to size and dimension contants */
    private ViewConfiguration config;

    /**
     * provides callbacks to a listener class for various swipe gestures.
     */
    private SwipeListener listener;

    public SwipeDetector(SwipeListener listener)
    {
        this.listener = listener;
    }

    /**
     * {@inheritDoc}
     */
    public boolean onTouch(View v, MotionEvent event)
    {
        if (config == null)
        {
                config = ViewConfiguration.get(v.getContext());
                minSwipeDistance = config.getScaledTouchSlop();
        }

        switch(event.getAction())
        {
        case MotionEvent.ACTION_DOWN:
            downX = event.getX();
            downY = event.getY();
            return true;
        case MotionEvent.ACTION_UP:
            upX = event.getX();
            upY = event.getY();

            float deltaX = downX - upX;
            float deltaY = downY - upY;

            // swipe horizontal?
            if(Math.abs(deltaX) > minSwipeDistance)
            {
                // left or right
                if (deltaX < 0)
                {
                        if (listener != null)
                        {
                                listener.onRightSwipe(v);
                                return true;
                        }
                }
                if (deltaX > 0)
                {
                        if (listener != null)
                        {
                                listener.onLeftSwipe(v);
                                return true;
                        }
                }
            }

            // swipe vertical?
            if(Math.abs(deltaY) > minSwipeDistance)
            {
                // top or down
                if (deltaY < 0)
                {
                        if (listener != null)
                        {
                                listener.onDownSwipe(v);
                                return true;
                        }
                }
                if (deltaY > 0)
                {
                        if (listener != null)
                        {
                                listener.onUpSwipe(v);
                                return true;
                        }
                }
            }
        }
        return false;
    }

    /**
     * Provides callbacks to a registered listener for swipe events in {@link SwipeDetector}
     * @author Phil Brown
     */
    public interface SwipeListener
    {
        /** Callback for registering a new swipe motion from the bottom of the view toward its top. */
        public void onUpSwipe(View v);
        /** Callback for registering a new swipe motion from the left of the view toward its right. */
        public void onRightSwipe(View v);
        /** Callback for registering a new swipe motion from the right of the view toward its left. */
        public void onLeftSwipe(View v);
        /** Callback for registering a new swipe motion from the top of the view toward its bottom. */
        public void onDownSwipe(View v);
    }
} 
```

**滑动拦截器视图**

```
package self.philbrown;

import android.content.Context;
import android.util.AttributeSet;
import android.view.MotionEvent;
import android.widget.RelativeLayout;

import com.npeinc.module_NPECore.model.SwipeDetector;
import com.npeinc.module_NPECore.model.SwipeDetector.SwipeListener;

/**
 * View subclass used for handling all touches (swipes and others)
 * @author Phil Brown
 */
public class SwipeInterceptorView extends RelativeLayout
{
    private SwipeDetector swiper = null;

    public void setSwipeListener(SwipeListener listener)
    {
        if (swiper == null)
            swiper = new SwipeDetector(listener);
    }

    public SwipeInterceptorView(Context context) {
        super(context);
    }

    public SwipeInterceptorView(Context context, AttributeSet attrs) {
        super(context, attrs);
    }

    public SwipeInterceptorView(Context context, AttributeSet attrs, int defStyle) {
        super(context, attrs, defStyle);
    }

    @Override
    public boolean onTouchEvent(MotionEvent e)
    {
        boolean swipe = false, touch = false;
        if (swiper != null)
            swipe = swiper.onTouch(this, e);
        touch = super.onTouchEvent(e);
        return swipe || touch;
    }
} 
```

* * *

## 回答 #14

> 赞同：10
> 
> 时间：2014-08-06T09:27:13.540

我知道现在回答为时已晚，但我仍在**为 ListView 发布 Swipe Detection**如何*在 ListView Item 中使用 Swipe Touch Listener*。

Refrence：Exterminator13（本页答案之一）

制作一个**ActivitySwipeDetector.class**

```
package com.example.wocketapp;

import android.content.Context;
import android.util.DisplayMetrics;
import android.util.Log;
import android.view.MotionEvent;
import android.view.View;
import android.view.ViewConfiguration;

public class ActivitySwipeDetector implements View.OnTouchListener 
{
    static final String logTag = "SwipeDetector";
    private SwipeInterface activity;
    private float downX, downY;
    private long timeDown;
    private final float MIN_DISTANCE;
    private final int VELOCITY;
    private final float MAX_OFF_PATH;

    public ActivitySwipeDetector(Context context, SwipeInterface activity)
    {
        this.activity = activity;
        final ViewConfiguration vc = ViewConfiguration.get(context);
        DisplayMetrics dm = context.getResources().getDisplayMetrics();
        MIN_DISTANCE = vc.getScaledPagingTouchSlop() * dm.density;
        VELOCITY = vc.getScaledMinimumFlingVelocity();
        MAX_OFF_PATH = MIN_DISTANCE * 2;
    }

    public void onRightToLeftSwipe(View v) 
    {
        Log.i(logTag, "RightToLeftSwipe!");
        activity.onRightToLeft(v);
    }

    public void onLeftToRightSwipe(View v) 
    {
        Log.i(logTag, "LeftToRightSwipe!");
        activity.onLeftToRight(v);
    }

    public boolean onTouch(View v, MotionEvent event) 
    {
        switch (event.getAction()) 
        {
            case MotionEvent.ACTION_DOWN:
            {
                Log.d("onTouch", "ACTION_DOWN");
                timeDown = System.currentTimeMillis();
                downX = event.getX();
                downY = event.getY();
                v.getParent().requestDisallowInterceptTouchEvent(false);
                return true;
            }

        case MotionEvent.ACTION_MOVE:
            {
                float y_up = event.getY();
                float deltaY = y_up - downY;
                float absDeltaYMove = Math.abs(deltaY);

                if (absDeltaYMove > 60) 
                {
                    v.getParent().requestDisallowInterceptTouchEvent(false);
                } 
                else
                {
                    v.getParent().requestDisallowInterceptTouchEvent(true);
                }
            }

            break;

            case MotionEvent.ACTION_UP: 
            {
                Log.d("onTouch", "ACTION_UP");
                long timeUp = System.currentTimeMillis();
                float upX = event.getX();
                float upY = event.getY();

                float deltaX = downX - upX;
                float absDeltaX = Math.abs(deltaX);
                float deltaY = downY - upY;
                float absDeltaY = Math.abs(deltaY);

                long time = timeUp - timeDown;

                if (absDeltaY > MAX_OFF_PATH) 
                {
                    Log.e(logTag, String.format(
                            "absDeltaY=%.2f, MAX_OFF_PATH=%.2f", absDeltaY,
                            MAX_OFF_PATH));
                    return v.performClick();
                }

                final long M_SEC = 1000;
                if (absDeltaX > MIN_DISTANCE && absDeltaX > time * VELOCITY / M_SEC) 
                {
                     v.getParent().requestDisallowInterceptTouchEvent(true);
                    if (deltaX < 0) 
                    {
                        this.onLeftToRightSwipe(v);
                        return true;
                    }
                    if (deltaX > 0) 
                    {
                        this.onRightToLeftSwipe(v);
                        return true;
                    }
                }
                else 
                {
                    Log.i(logTag,
                            String.format(
                                    "absDeltaX=%.2f, MIN_DISTANCE=%.2f, absDeltaX > MIN_DISTANCE=%b",
                                    absDeltaX, MIN_DISTANCE,
                                    (absDeltaX > MIN_DISTANCE)));
                    Log.i(logTag,
                            String.format(
                                    "absDeltaX=%.2f, time=%d, VELOCITY=%d, time*VELOCITY/M_SEC=%d, absDeltaX > time * VELOCITY / M_SEC=%b",
                                    absDeltaX, time, VELOCITY, time * VELOCITY
                                            / M_SEC, (absDeltaX > time * VELOCITY
                                            / M_SEC)));
                }

                 v.getParent().requestDisallowInterceptTouchEvent(false);

            }
        }
        return false;
    }
    public interface SwipeInterface 
    {

        public void onLeftToRight(View v);

        public void onRightToLeft(View v);
    }

} 
```

**从您的活动类中调用它，如下所示：**

```
yourLayout.setOnTouchListener(new ActivitySwipeDetector(this, your_activity.this)); 
```

并且不要忘记*实现* **SwipeInterface**它将为您提供两个 @override 方法：

```
 @Override
    public void onLeftToRight(View v) 
    {
        Log.e("TAG", "L to R");
    }

    @Override
    public void onRightToLeft(View v) 
    {
        Log.e("TAG", "R to L");
    } 
```

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2017-05-30T18:51:04.923

如果您不喜欢创建单独的类或使代码复杂，
您可以在 OnTouchListener 中创建一个 GestureDetector 变量，让您的代码更简单

namVyuVar 可以是您需要在其上设置侦听器的 View 的任何名称

```
namVyuVar.setOnTouchListener(new View.OnTouchListener()
{
    @Override
    public boolean onTouch(View view, MotionEvent MsnEvtPsgVal)
    {
        flingActionVar.onTouchEvent(MsnEvtPsgVal);
        return true;
    }

    GestureDetector flingActionVar = new GestureDetector(getApplicationContext(), new GestureDetector.SimpleOnGestureListener()
    {
        private static final int flingActionMinDstVac = 120;
        private static final int flingActionMinSpdVac = 200;

        @Override
        public boolean onFling(MotionEvent fstMsnEvtPsgVal, MotionEvent lstMsnEvtPsgVal, float flingActionXcoSpdPsgVal, float flingActionYcoSpdPsgVal)
        {
            if(fstMsnEvtPsgVal.getX() - lstMsnEvtPsgVal.getX() > flingActionMinDstVac && Math.abs(flingActionXcoSpdPsgVal) > flingActionMinSpdVac)
            {
                // TskTdo :=> On Right to Left fling

                return false;
            }
            else if (lstMsnEvtPsgVal.getX() - fstMsnEvtPsgVal.getX() > flingActionMinDstVac && Math.abs(flingActionXcoSpdPsgVal) > flingActionMinSpdVac)
            {
                // TskTdo :=> On Left to Right fling

                return false;
            }

            if(fstMsnEvtPsgVal.getY() - lstMsnEvtPsgVal.getY() > flingActionMinDstVac && Math.abs(flingActionYcoSpdPsgVal) > flingActionMinSpdVac)
            {
                // TskTdo :=> On Bottom to Top fling

                return false;
            }
            else if (lstMsnEvtPsgVal.getY() - fstMsnEvtPsgVal.getY() > flingActionMinDstVac && Math.abs(flingActionYcoSpdPsgVal) > flingActionMinSpdVac)
            {
                // TskTdo :=> On Top to Bottom fling

                return false;
            }
            return false;
        }
    });
}); 
```

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2015-07-23T05:50:58.093

手势是触发触摸屏和用户之间交互的微妙动作。它持续从第一次触摸屏幕到最后一根手指离开表面的时间。

Android 为我们提供了一个名为[GestureDetector](http://developer.android.com/reference/android/view/GestureDetector.html)的类，使用它我们可以检测常见的手势，例如*向下和向上点击、垂直和水平滑动（轻扫）、长按和短按、双击等*。并将听众附加到他们身上。

让我们的 Activity[类实现 GestureDetector.OnDoubleTapListener](http://developer.android.com/reference/android/view/GestureDetector.OnDoubleTapListener.html)（用于双击手势检测）和[GestureDetector.OnGestureListener 接口](http://developer.android.com/reference/android/view/GestureDetector.OnGestureListener.html)并实现所有抽象方法。有关更多信息。您可以访问[https://developer.android.com/training/gestures/detector.html](https://developer.android.com/training/gestures/detector.html)。[礼貌](http://codetheory.in/android-gesturedetector/)

用于演示测试。[GestureDetectorDemo](https://github.com/ZaneLove/GestureDetector)

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2013-12-28T12:13:04.880

对所有人：不要忘记**案例 MotionEvent.ACTION_CANCEL：**

它在没有 ACTION_UP 的情况下调用 30% 的滑动

在这种情况下它等于 ACTION_UP

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2014-07-31T05:26:38.987

我创建了一个更通用的 Class ，我学习了 Tomas 的课程并添加了一个将事件发送到您的 Activity 或 Fragment 的接口。它将在构造函数上注册侦听器，因此请确保您实现了接口，否则将引发 ClassCastException。该接口返回类中定义的四个最终 int 之一，并将返回激活它的视图。

```
import android.app.Activity;
import android.support.v4.app.Fragment;
import android.util.Log;
import android.view.MotionEvent;
import android.view.View;

public class SwipeDetector implements View.OnTouchListener{

    static final int MIN_DISTANCE = 100;
    private float downX, downY, upX, upY;
    public final static int RIGHT_TO_LEFT=1;
    public final static int LEFT_TO_RIGHT=2;
    public final static int TOP_TO_BOTTOM=3;
    public final static int BOTTOM_TO_TOP=4;
    private View v;

    private onSwipeEvent swipeEventListener;

    public SwipeDetector(Activity activity,View v){
        try{
            swipeEventListener=(onSwipeEvent)activity;
        }
        catch(ClassCastException e)
        {
            Log.e("ClassCastException",activity.toString()+" must implement SwipeDetector.onSwipeEvent");
        } 
        this.v=v;
    }
    public SwipeDetector(Fragment fragment,View v){
        try{
            swipeEventListener=(onSwipeEvent)fragment;
        }
        catch(ClassCastException e)
        {
            Log.e("ClassCastException",fragment.toString()+" must implement SwipeDetector.onSwipeEvent");
        } 
        this.v=v;
    }

    public void onRightToLeftSwipe(){   
        swipeEventListener.SwipeEventDetected(v,RIGHT_TO_LEFT);
    }

    public void onLeftToRightSwipe(){   
        swipeEventListener.SwipeEventDetected(v,LEFT_TO_RIGHT);
    }

    public void onTopToBottomSwipe(){   
        swipeEventListener.SwipeEventDetected(v,TOP_TO_BOTTOM);
    }

    public void onBottomToTopSwipe(){
        swipeEventListener.SwipeEventDetected(v,BOTTOM_TO_TOP);
    }

    public boolean onTouch(View v, MotionEvent event) {
        switch(event.getAction()){
        case MotionEvent.ACTION_DOWN: {
            downX = event.getX();
            downY = event.getY();
            return true;
        }
        case MotionEvent.ACTION_UP: {
            upX = event.getX();
            upY = event.getY();

            float deltaX = downX - upX;
            float deltaY = downY - upY;

            //HORIZONTAL SCROLL
            if(Math.abs(deltaX) > Math.abs(deltaY))
            {
                if(Math.abs(deltaX) > MIN_DISTANCE){
                    // left or right
                    if(deltaX < 0) 
                    {
                        this.onLeftToRightSwipe();
                        return true;
                    }
                    if(deltaX > 0) {
                        this.onRightToLeftSwipe();
                        return true; 
                    }
                }
                else {
                    //not long enough swipe...
                    return false; 
                }
            }
            //VERTICAL SCROLL
            else 
            {
                if(Math.abs(deltaY) > MIN_DISTANCE){
                    // top or down
                    if(deltaY < 0) 
                    { this.onTopToBottomSwipe();
                    return true; 
                    }
                    if(deltaY > 0)
                    { this.onBottomToTopSwipe(); 
                    return true;
                    }
                }
                else {
                    //not long enough swipe...
                    return false;
                }
            }

            return true;
        }
        }
        return false;
    }
    public interface onSwipeEvent
    {
        public void SwipeEventDetected(View v , int SwipeType);
    }

} 
```

# haskell - 什么是隐式递归？

> ID：937315
> 
> 赞同：4
> 
> 时间：2009-06-01T23:36:00.020
> 
> 标签：haskell, functional-programming, recursion, lisp, scheme

什么是隐式递归？它与显式递归有何不同？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-02T02:36:43.480

我没有看到经常使用的术语。谷歌搜索揭示了一本关于 lambda 演算的书中的用法。那本书的论点如下：

1.  声称是定义的等式不应包括右侧定义的事物。（我同意这一点。）
2.  如果这样的方程，比如

    ```
    FAC = \n. if n = 0 then 1 else n * FAC (n-1), 
    ```

    确实出现了，我们称之为“隐式递归”并说它是非法的。（我对此有点怀疑。）

我不知道为什么这个术语被认为是有用的；对我来说，这只是另一个术语。重要的是将真正的数学**定义**与必须求解的**递归方程区分开来。**并非每个递归方程都有有用或有趣的解；例如，虽然阶乘函数是`FAC`上述的解决方案，但唯一有用的解决方案

```
x = x + 1 
```

是“底部”，可能代表“错误”或“未定义”或“分歧”。

我认为教科书中的这一行试图区分“隐式递归”（我称之为递归方程或递归方程）和使用像 Y 组合子这样的**显式定点运算符的数学定义。**

当谈到实用的编程语言时，所有这些讨论都非常学术。编程语言完全设置为支持“隐式递归”，尽管[显式定点组合器也非常有用](https://stackoverflow.com/questions/869497/y-combinator-practical-example)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2017-02-06T14:28:16.237

我听说过**显式**和**隐式递归**来对比递归函数定义（显式）的术语，例如：

```
sum (x:xs) = x + sum xs
sum [] = 0 
```

对于使用显式递归函数的函数，如`fold`s 和`map`,（隐式），例如：

```
sum xs = foldr (+) 0 xs 
```

# python - 在syncdb期间阻止代码运行

> ID：937316
> 
> 赞同：1
> 
> 时间：2009-06-01T23:36:12.580
> 
> 标签：python, django, django-models, django-syncdb, syncdb

我有一些抛出的代码会导致syncdb 抛出错误（因为它会在创建表之前尝试访问模型）。

有没有办法阻止代码在syncdb上运行？就像是：

```
if not syncdb:
    run_some_code() 
```

谢谢 ：）

~~**编辑**： PS - 我考虑过使用 post_init 信号......对于访问数据库的代码，这是个好主意吗？~~

## 更多信息

以下是要求提供的更多信息:)

例如，我已经遇到过几次这种情况......我在 django-cron 上进行了黑客攻击，并确定有必要在加载 django 时确保没有现有作业（因为它会搜索所有已安装的应用程序以查找作业并添加无论如何，它们都在加载）。

所以我在文件顶部添加了以下代码`__init__.py`：

```
import sqlite3

try:
        # Delete all the old jobs from the database so they don't interfere with this instance of django
        oldJobs = models.Job.objects.all()
        for oldJob in oldJobs:
                oldJob.delete()
except sqlite3.OperationalError:
        # When you do syncdb for the first time, the table isn't 
        # there yet and throws a nasty error... until now
        pass 
```

出于显而易见的原因，这是废话。它与 sqlite 相关联，我有更好的地方放置此代码（这就是我遇到这个问题的方式），但它可以工作。

如您所见，您得到的错误是操作错误（在 sqlite 中），并且堆栈跟踪说明了“未找到表 django_cron_job”的内容

# 解决方案

最后，目标是**在加载任何页面之前运行一些代码**。

这可以通过在 urls.py 文件中执行它来完成，因为它必须在页面可以被提供之前被导入（显然）。

而且我能够删除那个丑陋的 try/except 块 :) 感谢上帝（和 S. Lott）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-02T01:40:02.393

“编辑：PS - 我考虑过使用 post_init 信号......对于访问数据库的代码，这是个好主意吗？”

绝不。

如果您有在创建表之前访问模型的代码，那么您就会遇到很大很大的问题。你可能做错了什么。

通常，您大约运行一次syncdb。数据库已创建。您的 Web 应用程序使用数据库。

有时，您进行了设计更改，删除并重新创建了数据库。然后您的 Web 应用程序会长时间使用该数据库。

您（通常）不需要`__init__.py`模块中的代码。`__init__.py`您应该（几乎）永远不会拥有在模块中真正起作用的可执行代码。这对于 Django 来说非常、非常罕见且不合适。

`__init__.py`当[Django Cron](http://code.google.com/p/django-cron/)说你在`urls.py`.

* * *

**编辑**

清除记录是一回事。

摆弄`__init__.py`和 Django-cron`base.py`显然是完全错误的方法。如果它那么复杂，那你就错了。

不可能说出你想要做什么，但这应该是微不足道的。

您`urls.py`只能在 syncdb 之后并且在所有 ORM 材料都已正确配置和绑定之后运行。

`urls.py`例如，您可以删除一些行，然后将一些行添加到表中。至此，所有同步数据库问题都已解决。

你怎么没有你的逻辑`urls.py`？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T01:21:25.957

在创建模型之前尝试访问模型的代码几乎只能存在于模块级别；正如您的示例所示，它必须是在导入模块时运行的可执行代码。正如您已经猜到的那样，这就是syncdb失败的原因。它尝试导入模块，但导入模块的行为会导致应用程序级代码执行；如果你愿意，一个“副作用”。

在 Python 中，避免导致副作用的模块导入的愿望是如此强烈，以至于`if __name__ == '__main__':`可执行 Python 脚本的约定已变得司空见惯。当仅加载代码库导致应用程序开始执行时，随之而来的是头痛:-)

对于 Django 应用程序，这不仅仅是一个令人头疼的问题。考虑`oldJob.delete()`每次导入模块时执行的效果。当您使用 Django 开发服务器运行时，它似乎只执行一次，但在生产环境中它会经常执行。例如，如果您使用 Apache，Apache 会经常启动几个等待处理请求的子进程。随着长时间运行的服务器的进展，每次为您的 Web 服务器派生处理程序时，您的 Django 应用程序都会被引导，这意味着模块将被导入并被`delete()`多次调用，通常是不可预测的。不幸的是，信号不会有帮助，因为每次初始化 Apache 进程时都会触发信号。

顺便说一句，它不仅仅是一个可能导致您的代码无意执行的网络服务器。例如，如果您使用 epydoc 之类的工具，它们将导入您的代码以生成 API 文档。这反过来会导致您的应用程序逻辑开始执行，这显然是仅运行文档解析器的不良副作用。

出于这个原因，像这样的清理代码最好由 cron 作业处理，该作业会定期查找过时的作业并清理数据库。此自定义脚本也可以手动运行，也可以通过任何进程运行（例如在部署期间，或作为单元测试`setUp()`功能的一部分以确保干净的测试运行）。不管你怎么做，重要的一点是这样的代码应该总是*显式*地执行，而不是由于打开源文件而*隐式地执行。*

我希望这会有所帮助。我知道它没有提供一种方法来确定 syncdb 是否正在运行，但是如果您在设计 Django 应用程序时考虑到生产部署，那么 syncdb 问题就会神奇地消失。

# c# - C#:: 何时使用事件或从事件处理接口派生的对象集合？

> ID：937318
> 
> 赞同：5
> 
> 时间：2009-06-01T23:37:25.870
> 
> 标签：c#, .net, events, delegates, collections

我有一个我认为是一个简单的“问题”的问题，我已经找到了几个解决方案，但我不确定该走哪条路以及 C# 中的最佳实践。

我有一个主对象（比如一个单例）在应用程序的生命周期内实例化一次。这个“MasterClass”创建了一堆新类型的对象，每次调用 MasterClass.Instance.CreateSlaveObject 时都说“SlaveClass”。

这个 MasterClass 还监视一些其他对象的状态变化，当发生这种情况时，通知它创建的 SlaveClass 对象发生了变化。看起来很简单。

因为我来自原生 C++ 世界，所以我首先要做的就是拥有一个接口

```
Interface IChangeEventListener
{
    void ChangeHappened();
} 
```

我从中派生了“SlaveClass”。然后在我的“大师班”中，我有：

```
...
IList<IChangeEventListener> slaveList;
...
CreateSlaveObject
{
    ...
    slaveList.Add(slave);
}
...
ChangeHappened()
{
    ...
    foreach(var slave in slaveList)
    {
       slave.ChangeHappened();
    }
} 
```

这有效。但是我一直在想，是否还有另一种（更好的）方法可以做到这一点。因此，我对该主题进行了更多研究，并看到了 C# 事件。

因此，我基本上不会在 MasterClass 中维护从属的集合，而是将 MasterClass 注入到 SlaveClass 的 ctor 中（或通过属性），并让 SlaveClass 对象添加它的 ChangeHappened 作为事件处理程序。这将被说明：

```
 ...Master...          
  public delegate void ChangeHappenedDelegate(object sender, NewsInfoArgs args);
  public event NewUpdateDelegate ChangeHappenedEvent;
  ....

  public SlaveClass (MasterClass publisher) //inject publisher service
  {
      publisher.ChangeHappenedEvent += ChangeHappened;
  } 
```

但这似乎是 Slave 和 Master 之间不必要的耦合，但我喜欢提供的内置事件通知机制的优雅。

那么我应该保留我当前的代码，还是转向基于事件的方法（使用发布者注入）？为什么？

或者，如果您能提出一个我可能错过的替代解决方案，我也将不胜感激。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-01T23:42:36.247

好吧，在我看来，像您展示的事件和界面是同一枚硬币的两个方面（至少在您描述的上下文中），但它们实际上是这个方面的两个*方面*。

我对事件的看法是“我需要订阅你的事件，因为我需要你告诉我什么时候发生了什么事”。

而接口方式是“我需要在你身上调用一个方法来通知你我发生了什么事”。

听起来可能一样，但说话的人不同，在这两种情况下，都是你的“大师班”在说话，这一切都不同。

请注意，如果您的从属类有一个可用的方法，该方法适用于在您的主类发生某些事情时调用，则您不需要从属类包含将其连接起来的代码，您可以在您的CreateSlaveClass 方法：

```
SlaveClass sc = new SlaveClass();
ChangeHappenedEvent += sc.ChangeHappened;
return sc; 
```

这将基本上使用事件系统，但让 MasterClass 代码完成所有事件的连接。

SlaveClass 对象的寿命是否与单例类一样长？如果不是，那么您需要在它们变得陈旧/不再需要时处理这种情况，如上述情况（基本上在您和我的情况下），您在 MasterClass 中持有对这些对象的引用，因此它们除非您强制删除这些事件或取消注册接口，否则永远不会有资格进行垃圾收集。

* * *

要处理 SlaveClass 的寿命不如 MasterClass 的问题，您将遇到相同的耦合问题，正如您在评论中所指出的那样。

“处理”（注意引号）的一种方法可能是不真正直接链接到 SlaveClass 对象上的正确方法，而是创建一个内部将调用此方法的包装器对象。这样做的好处是包装器对象可以在内部使用 Wea​​kReference 对象，因此一旦您的 SlaveClass 对象符合垃圾回收条件，它可能会被回收，然后下次您尝试对其调用正确的方法时，您会注意到这一点，因此您必须进行清理。

例如，像这样（这里我在没有 Visual Studio 智能感知和编译器的帮助下打字，请理解这段代码的含义，而不是语法（错误）。）

```
public class WrapperClass
{
    private WeakReference _Slave;

    public WrapperClass(SlaveClass slave)
    {
        _Slave = new WeakReference(slave);
    }

    public WrapperClass.ChangeHappened()
    {
        Object o = _Slave.Target;
        if (o != null)
            ((SlaveClass)o).ChangeHappened();
        else
            MasterClass.ChangeHappenedEvent -= ChangeHappened;
    }
} 
```

因此，在您的 MasterClass 中，您将执行以下操作：

```
SlaveClass sc = new SlaveClass();
WrapperClass wc = new WrapperClass(sc);
ChangeHappenedEvent += wc.ChangeHappened;
return sc; 
```

收集到 SlaveClass 对象后，从 MasterClass 到事件处理程序的下一次调用（但不早于该调用）以通知它们更改，所有不再具有对象的包装器将被删除。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-01T23:42:31.413

我认为这只是个人喜好问题......我个人喜欢使用事件，因为它更适合.NET“哲学”。

在您的情况下，如果 MasterClass 是单例，则无需将其传递给 SlaveClass 的构造函数，因为可以使用单例属性（或方法）检索它：

```
public SlaveClass ()
{
    MasterClass.Instance.ChangeHappenedEvent += ChangeHappened;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-01T23:44:30.830

由于您似乎有一个 MasterClass 的单例实例，为什么不订阅 MasterClass.Instance.ChangeHappenedEvent？它仍然是一个紧密的耦合，但相对整洁。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-08-27T17:23:17.613

尽管事件是公开订阅/取消订阅功能的正常范例，但在许多情况下，当订阅/取消订阅功能不需要公开时，它们并不是最佳范例。在这种情况下，唯一允许订阅/取消订阅事件的是您自己创建的事件，因此不需要公共订阅/取消订阅方法。此外，主人对奴隶的了解远远超过了典型的事件发布者对订阅者的了解。因此，我倾向于让 master 显式处理订阅的连接/断开连接。

不过，我可能会添加一个功能，它通过主从之间的耦合变得更加容易，它是一种在所有外部引用都被放弃的情况下允许对从属进行垃圾收集的方法。最简单的方法可能是让主服务器保留一个“弱引用”列表给从服务器。当有必要通知从站发生了某事时，遍历列表，取消引用任何仍然存在的 WeakReference，然后通知从站。如果自上次扫描以来添加了列表中超过一半的项目，并且列表包含至少 250 个左右的项目，请将所有实时引用复制到新列表并替换旧列表。

另一种避免经常取消引用 Wea​​kReference 对象的方法是让公共“从属”对象成为私有对象的包装器，并让公共对象覆盖 Finalize 以让私有对象知道没有外部引用它存在。这将需要为对对象的公共访问添加额外级别的强间接，但它会避免创建——即使是暂时的——对废弃对象的强引用。

# sql - 有没有办法在整个过程中保持一个变量？

> ID：937336
> 
> 赞同：94
> 
> 时间：2009-06-01T23:47:08.423
> 
> 标签：sql, sql-server, sql-server-2008, sql-server-2012, sql-server-2000

有没有办法在整个过程中保持一个变量？

```
Declare @bob as varchar(50);
Set @bob = 'SweetDB'; 
GO
USE @bob  --- see note below
GO
INSERT INTO @bob.[dbo].[ProjectVersion] ([DB_Name], [Script]) VALUES (@bob,'1.2') 
```

有关“使用@bob”行，请参阅此[SO](https://stackoverflow.com/questions/937271/is-there-a-way-to-select-a-database-from-a-variable)问题。

* * *

## 回答 #1

> 赞同：143
> 
> 时间：2009-06-02T05:14:50.007

使用临时表：

```
CREATE TABLE #variables
(
    VarName VARCHAR(20) PRIMARY KEY,
    Value VARCHAR(255)
)
GO

Insert into #variables Select 'Bob', 'SweetDB'
GO

Select Value From #variables Where VarName = 'Bob'
GO

DROP TABLE #variables
go 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-06-02T00:08:29.580

该`go`命令用于将代码拆分为单独的批次。如果这正是您想要做的，那么您应该使用它，但这意味着批次实际上是分开的，并且您不能在它们之间共享变量。

在您的情况下，解决方案很简单；您可以删除`go`语句，该代码中不需要它们。

旁注：您不能在`use`语句中使用变量，它必须是数据库的名称。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2015-06-18T06:39:31.713

我更喜欢这个问题[Global Variables with GO的](https://stackoverflow.com/questions/5410690/global-variables-with-go)[这个](https://stackoverflow.com/a/22918130/1462615)答案

这还有一个额外的好处，就是能够做你最初想做的事情。

需要注意的是，您需要打开 SQLCMD 模式（在 Query->SQLCMD 下）或默认为所有查询窗口打开它（工具->选项然后查询结果->默认情况下，在 SQLCMD 模式下打开新查询）

[然后您可以使用以下类型的代码（完全从Oscar E. Fraxedas Tormo](https://stackoverflow.com/users/1074245/oscar-e-fraxedas-tormo)的相同答案中抄袭）

```
--Declare the variable
:setvar MYDATABASE master
--Use the variable
USE $(MYDATABASE);
SELECT * FROM [dbo].[refresh_indexes]
GO
--Use again after a GO
SELECT * from $(MYDATABASE).[dbo].[refresh_indexes];
GO 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-08-31T09:35:59.097

如果您使用的是 SQL Server，您可以为整个脚本设置全局变量，例如：

```
:setvar sourceDB "lalalallalal" 
```

稍后在脚本中使用：

```
$(sourceDB) 
```

确保 SQLCMD 模式在 Server Managment Studi 中打开，您可以通过顶部菜单单击 Query 并打开 SQLCMD 模式。

可以在此处找到有关该主题的更多信息： [MS 文档](https://docs.microsoft.com/en-us/sql/relational-databases/scripting/edit-sqlcmd-scripts-with-query-editor)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-09-18T09:03:17.993

临时表保留在 GO 语句上，所以......

```
SELECT 'value1' as variable1, 'mydatabasename' as DbName INTO #TMP

-- get a variable from the temp table
DECLARE @dbName VARCHAR(10) = (select top 1 #TMP.DbName from #TMP)
EXEC ('USE ' + @dbName)
GO

-- get another variable from the temp table
DECLARE @value1 VARCHAR(10) = (select top 1 #TMP.variable1 from #TMP)

DROP TABLE #TMP 
```

它不漂亮，但它有效

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-04-06T09:19:35.057

创建您自己的存储过程，将其保存/加载到临时表。

```
MyVariableSave   -- Saves variable to temporary table. 
MyVariableLoad   -- Loads variable from temporary table. 
```

然后你可以使用这个：

```
print('Test stored procedures for load/save of variables across GO statements:')

declare @MyVariable int = 42
exec dbo.MyVariableSave @Name = 'test', @Value=@MyVariable
print('  - Set @MyVariable = ' + CAST(@MyVariable AS VARCHAR(100)))

print('  - GO statement resets all variables')
GO -- This resets all variables including @MyVariable

declare @MyVariable int
exec dbo.MyVariableLoad 'test', @MyVariable output
print('  - Get @MyVariable = ' + CAST(@MyVariable AS VARCHAR(100))) 
```

输出：

```
Test stored procedures for load/save of variables across GO statements:
  - Set @MyVariable = 42
  - GO statement resets all variables
  - Get @MyVariable = 42 
```

您还可以使用这些：

```
exec dbo.MyVariableList       -- Lists all variables in the temporary table.
exec dbo.MyVariableDeleteAll  -- Deletes all variables in the temporary table. 
```

输出`exec dbo.MyVariableList`：

```
Name    Value
test    42 
```

事实证明，能够列出表中的所有变量实际上非常有用。因此，即使您稍后不加载变量，也非常适合调试目的，以便在一个地方查看所有内容。

这使用了一个带有`##`前缀的临时表，因此它足以在 GO 语句中存活。它旨在在单个脚本中使用。

和存储过程：

```
-- Stored procedure to save a variable to a temp table.
CREATE OR ALTER PROCEDURE MyVariableSave 
    @Name varchar(255),
    @Value varchar(MAX)
WITH EXECUTE AS CALLER
AS  
BEGIN
    SET NOCOUNT ON
    IF NOT EXISTS (select TOP 1 * from tempdb.sys.objects where name = '##VariableLoadSave')
    BEGIN
        DROP TABLE IF EXISTS ##VariableLoadSave
        CREATE TABLE ##VariableLoadSave
        (
            Name varchar(255),
            Value varchar(MAX)
        )
    END
    UPDATE ##VariableLoadSave SET Value=@Value WHERE Name=@Name
    IF @@ROWCOUNT = 0
        INSERT INTO ##VariableLoadSave SELECT @Name, @Value
END
GO
-- Stored procedure to load a variable from a temp table.
CREATE OR ALTER PROCEDURE MyVariableLoad 
    @Name varchar(255),
    @Value varchar(MAX) OUT
WITH EXECUTE AS CALLER
AS  
BEGIN
    IF EXISTS (select TOP 1 * from tempdb.sys.objects where name = '##VariableLoadSave')
    BEGIN
        IF NOT EXISTS(SELECT TOP 1 * FROM ##VariableLoadSave WHERE Name=@Name)
        BEGIN
            declare @ErrorMessage1 as varchar(200) = 'Error: cannot find saved variable to load: ' + @Name
            raiserror(@ErrorMessage1, 20, -1) with log
        END

        SELECT @Value=CAST(Value AS varchar(MAX)) FROM ##VariableLoadSave
        WHERE Name=@Name
    END
    ELSE
    BEGIN
        declare @ErrorMessage2 as varchar(200) = 'Error: cannot find saved variable to load: ' + @Name
        raiserror(@ErrorMessage2, 20, -1) with log
    END
END
GO
-- Stored procedure to list all saved variables.
CREATE OR ALTER PROCEDURE MyVariableList
WITH EXECUTE AS CALLER
AS  
BEGIN
    IF EXISTS (select TOP 1 * from tempdb.sys.objects where name = '##VariableLoadSave')
    BEGIN
        SELECT * FROM ##VariableLoadSave
        ORDER BY Name
    END
END
GO
-- Stored procedure to delete all saved variables.
CREATE OR ALTER PROCEDURE MyVariableDeleteAll
WITH EXECUTE AS CALLER
AS  
BEGIN
    DROP TABLE IF EXISTS ##VariableLoadSave
    CREATE TABLE ##VariableLoadSave
    (
        Name varchar(255),
        Value varchar(MAX)
    )
END 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-02T00:23:20.503

不确定，如果这有帮助

```
declare @s varchar(50)
set @s='Northwind'

declare @t nvarchar(100)
set @t = 'select * from ' + @s + '.[dbo].[Customers]'

execute sp_executesql @t
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-06-07T19:35:22.977

如果您只需要二进制是/否（例如是否存在列），则可以使用`SET NOEXEC ON`来禁用语句的执行。 `SET NOEXEC ON`跨 GO（跨批次）工作。但请记住在脚本末尾**重新打开 EXEC 。**`SET NOEXEC OFF`

```
IF COL_LENGTH('StuffTable', 'EnableGA') IS NOT NULL
    SET NOEXEC ON -- script will not do anything when column already exists

ALTER TABLE dbo.StuffTable ADD EnableGA BIT NOT NULL CONSTRAINT DF_StuffTable_EnableGA DEFAULT(0)
ALTER TABLE dbo.StuffTable SET (LOCK_ESCALATION = TABLE)
GO
UPDATE dbo.StuffTable SET EnableGA = 1 WHERE StuffUrl IS NOT NULL
GO
SET NOEXEC OFF 
```

这编译语句但不执行它们。因此，如果您引用不存在的架构，您仍然会收到“编译错误”。所以它可以“关闭”第二次运行的脚本（我正在做的事情），但不能在第一次运行时关闭部分脚本，因为如果引用列或表，你仍然会遇到编译错误还不存在。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-09-17T08:11:01.423

您可以按照以下步骤使用 NOEXEC：

创建表

```
#temp_procedure_version(procedure_version varchar(5),pointer varchar(20)) 
```

将过程版本和指向版本的指针插入到临时表中`#temp_procedure_version`

--example 过程版本指针

插入`temp_procedure_version`值（1.0，'第一个版本'）

插入`temp_procedure_version`值（2.0，'最终版本'）

然后检索过程版本，您可以使用 where 条件，如以下语句

`@ProcedureVersion=ProcedureVersion`从`#temp_procedure_version`哪里 选择`pointer='first version'`

```
IF (@ProcedureVersion='1.0')
    BEGIN
    SET NOEXEC OFF  --code execution on 
    END
ELSE
    BEGIN 
    SET NOEXEC ON  --code execution off
    END 
```

--在此处插入程序版本 1.0

创建过程版本 1.0 为.....

```
SET NOEXEC OFF -- execution is ON 
```

`@ProcedureVersion=ProcedureVersion`从`#temp_procedure_version`where pointer='final version' 中选择

```
IF (@ProcedureVersion='2.0')
    BEGIN
    SET NOEXEC OFF  --code execution on 
    END
ELSE
    BEGIN 
    SET NOEXEC ON  --code execution off
    END 
```

创建过程版本 2.0 为.....

```
SET NOEXEC OFF -- execution is ON 
```

--删除临时表

删除表`#temp_procedure_version`

# php - 使用 php 和 curl 更新 mediawiki

> ID：937338
> 
> 赞同：0
> 
> 时间：2009-06-01T23:48:03.803
> 
> 标签：php, post, curl, mediawiki

我一直在编写一个 php 脚本来更新 mediawiki 条目，但是每当我运行它时，它似乎根本没有更新 wiki，只是返回未经编辑的文章页面。

我已经包含了一个首先登录到 wiki 的部分，并且我已经成功地从 wiki 中读取了信息，但我无法更新它。

有什么我遗漏或更好的东西吗？是否有一个现有的 php 包可用于更新 mediawiki。

提前致谢，

示例代码如下：

```
function curl_post_page($site, $post ) {
$headers = array();
$headers[] = 'Accept: image/gif, image/x-bitmap, image/jpeg, image/pjpeg';
$headers[] = 'Connection: Keep-Alive';
$headers[] = 'Content-type: application/x-www-form-urlencoded;charset=UTF-8'; 

//var_dump($post);
$cl = curl_init($site);
curl_setopt($process, CURLOPT_HTTPHEADER, $headers); 
curl_setopt($cl, CURLOPT_HEADER, true);
curl_setopt($cl, CURLOPT_VERBOSE, true);
curl_setopt($cl, CURLOPT_FAILONERROR, true); 
curl_setopt($cl, CURLOPT_POST, TRUE);
curl_setopt($cl, CURLOPT_POSTFIELDS, $post);
curl_setopt($cl, CURLOPT_CONNECTTIMEOUT, 30);
curl_setopt($cl, CURLOPT_USERAGENT,"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT)");
curl_setopt($cl, CURLOPT_RETURNTRANSFER, true);
curl_setopt($cl, CURLOPT_SSL_VERIFYPEER, false);
curl_setopt($cl, CURLOPT_FOLLOWLOCATION, 1);
curl_setopt($cl, CURLOPT_COOKIEFILE, "cookie.txt"); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-02T03:15:16.053

api写入启用了吗？( [$wgEnableWriteAPI](http://tinyurl.com/wgEnableWriteAPI) = false;) 1.14 以下的版本默认禁用。

您是否收到任何[错误](http://www.mediawiki.org/wiki/API:Errors#Standard_errors)？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T00:14:22.987

有[几个可用的客户端库](http://en.wikipedia.org/wiki/Wikipedia:Creating_a_bot#PHP)（[已知良好的修订版](http://en.wikipedia.org/w/index.php?title=Wikipedia:Creating_a_bot&oldid=522287489#PHP)| [archive.org 上的镜像](http://web.archive.org/web/20110717110455/http://en.wikipedia.org/wiki/Wikipedia:Creating_a_bot#PHP)）

# gcc - 构建 R 包时如何链接静态库

> ID：937346
> 
> 赞同：3
> 
> 时间：2009-06-01T23:52:20.283
> 
> 标签：gcc, compiler-construction, r, static-libraries

我正在创建一个将由 R（统计程序）使用的包，我不是使用此应用程序的专家，但我设法使用以下逻辑创建了一个非常简单的包，我有一些类C++，因为代码必须使用 R 编译器编译并且它只允许 C 代码，所以我有一个调用 C++ 方法的包装 C 代码，后来我有一个调用 C 代码公开的方法的 R 脚本，所以基本上是像 R <-> C<->C++ 这样的通信。

[在这里](http://www.stat.columbia.edu/~gelman/stuff_for_blog/AlanRPackageTutorial.pdf)可以找到我用来创建此包的完整教程，我将其添加为参考。

现在我的问题是我需要向我已经创建的包添加一些功能，我需要做的是添加用于后期绑定到 COM 对象的代码，这是我创建的另一个产品并使用 regasm 工具注册。

这是我用来尝试后期绑定到 COM 对象的 c++ 代码，我正在尝试使用 IDispatch 来执行此操作：

```
{
...
CLSID clsid;    
HRESULT hr = CLSIDFromProgID((WCHAR*)"My Com object ProgId", &clsid);
if(FAILED(hr))                      
  return;   
...     
} 
```

我没有粘贴整个代码，因为只有这些行编译器已经给我带来了麻烦，我用来编译的命令是

```
R CMD SHLIB Cclass.cc C++class.cc
```

其中“Cclass.cc”具有调用 C++ 方法的 C 代码，而“C++class.cc”实际上是 C++ 代码。

当我编译这些类时，编译器会说

```
"undefined reference to `CLSIDFromProgID@8'collect2: ld returned 1 exit status"
```

我确定我已经添加了我需要的所有头文件，这就是为什么我认为我的问题是我不包括静态库 ole32.lib 和 oleaut32.lib。

所以，我的问题是，我怎样才能包含这个库以便能够使用后期绑定的方法，比如 CLSIDFromProgID(...) 或 QueryInterface(...)。此外，如果有人认为我的问题不是链接这个库，而是其他东西，如果能指出我的问题可能是什么，那就太好了。

还请记住，我需要以一种可以通过 R 编译器毫无问题地编译它们的方式链接这些静态库，如果我没记错的话，它只是一个 c 编译器。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T09:25:43.190

我没有尝试使用 C/C++ 而是使用 Fortran 来执行此操作。我有一个类似的问题，一些标准 IO 库没有包含在我创建的库中。最后，我只是将它们全部包含在内并使用 Fortran 编译器进行编译。我没有使用任何 R 编译器实用程序，只是像编译静态 Fortran 库一样进行编译，以便与其他任何东西一起使用。这工作得很好。

调试路径可能是使用 gcc（或您正在使用的任何东西）编译为静态库，然后尝试从另一个 C 程序包含并调用该静态库，然后如果可行，请尝试使用 R。

希望这会有所帮助，编写这些 R 包非常困难，除非据我所知您使用的是 vanilla C 或 Fortran。

# wcf - 使用哪个...REST、ASMX、WSE 或 WCF？

> ID：937349
> 
> 赞同：1
> 
> 时间：2009-06-01T23:53:48.737
> 
> 标签：wcf, web-services

我有一个执行特定功能的 Windows 服务，然后需要将该信息发送到 Web 服务进行处理。Web 服务由远程 Web 应用程序托管。我正在尝试确定调用 Web 服务的最佳方式，因为每个 Web 应用程序可能只有 2.0 或 3.5 等。在我的 Windows 服务中，我在 app.config 中定义每个“客户端”，例如

```
<Client WebServiceUrl="http://location.com/webservice.svc" Username="" Password="">

</Client> 
```

Web 应用程序必须实现我的 Windows 服务运行所需的两个 Web 服务，但不确定为 Web 应用程序实现“规则”的最佳方式。

**编辑：**

我会尝试改写.. Windows 服务每 30 秒运行一次并获取信息列表。该服务支持多个“客户端”，如上所示。当每个客户端进程运行时，都会收集数据，然后需要将其发送到支持的 Web 应用程序。

Windows 服务不知道如何处理数据，它只是发送它。客户端的每个 Web 应用程序将位于不同的位置，并且可能内置于 2.0、3.5、PHP 等。所有 Windows 服务关心的是，当它为客户端执行处理时，它能够发送数据到在 windows 服务的 app.config 中定义的 web 服务位置。

我要确定的是如何连接到 web 服务（我倾向于 WCF，但基本或 WS 不确定），以及在如何构建响应时需要为 web 应用程序定义哪些规则。

如果 Windows 服务要支持 php 应用程序等，则 WSHttpBinding 将不是一个选项，这意味着 BasicHttpBinding 将起作用。要决定的另一件事是是否使用 RESTful 服务或 SOAP 服务。

希望这更有意义。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-02T00:24:15.540

我不太清楚你在做什么。

看起来你有 3 个东西：一个 Windows 服务，然后是一个 Web 服务，托管在一个 Web 应用程序中。
我认为您的问题是，*在将 Windows 服务应用程序与远程 Web 服务互连时，使用什么，REST、ASMX、WSE 或 WCF*。

ASMX、WSE 和 WCF 是 Web 服务的替代编程模型。REST 不是一种编程模型。它不像其他三个。

ASMX 和 WSE 将要求您使用 Web 服务和 SOAP。
WCF 可以允许您使用 Web 服务和 SOAP、基于 HTTP 的 REST（XML 或 JSON）或基于 TCP 的二进制格式，以及其他选项。

因为它是灵活且最新的技术，所以我推荐 WCF。ASMX 现在被 Microsoft 称为“遗留技术”。并不意味着它不会工作，但它不会得到更新。（很像 WinForms 与 WPF）。据我所知，WSE 不再受到主流支持。由于这些原因，我不建议在 WSE 或 ASMX 上启动新项目。

* * *

由于这个原因，WCF 比 ASMX 更通用并且看起来更复杂。但是，一旦您做出一些选择并将您想要的东西归零（例如选择 HTTP 和 REST，或者选择二进制和 TCP），它就会更加强大。WCF 可以用作客户端或发送方（在您的情况下，我猜是 Windows 服务）和/或服务器（托管在 Web 应用程序中的 Web 服务）上的编程模型。

在客户端使用 WCF 并不意味着您必须在服务器端使用它，反之亦然。另一方面，如果您控制两端的源代码，我建议在两端都使用 WCF。

至于“如何实施网络应用程序的规则” - 我不明白你在那里问什么。也许如果您对那里的问题更具体，有人将能够提供帮助。

* * *

更新：根据您的额外解释，我建议您查看 WCF 中的 .NET 3.5 中的 REST 内容。在 PHP 中实现 REST 样式的服务非常容易，而使用 WCF，对于 .NET 也是如此。现在，在您的情况下，Windows 服务是*客户端*，它正在向驻留在客户网络上的各种*服务器*发送请求（更新请求） 。根据 REST 原则，我会根据调用的语义将这些出站请求设为 PUT 或 POST。

然后，您可以将一些示例服务代码发送给您的（大写）客户端，让他们开始构建接收您的出站 PUT/POST 消息所需的内容。

不过，安全性是一个问题。你根本没有提到它，这令人惊讶。安全性不是最好推迟的事情之一，因此您“稍后再添加”。您应该尽早考虑它 - 它可能会影响您所做的协议选择。例如，如果您需要相互验证客户端和服务器（后者在您的“大写”客户端网络中），那么您可能想要使用 SOAP，它在协议方面为您提供了很好的安全选项。WCF 很好地支持安全 Web 服务扩展（WS-Sec 等），但不确定 PHP 中此功能的状态。

# mono - JScript.NET 可以用于编写 .NET 应用程序的脚本吗？

> ID：937351
> 
> 赞同：8
> 
> 时间：2009-06-01T23:53:58.910
> 
> 标签：mono, automation, dynamic-language-runtime, jscript.net, managed-jscript

由于 MS[似乎已经在](https://stackoverflow.com/questions/775339/where-can-you-download-managed-jscript-for-the-dlr/886173#886173)服务器端（ASP.NET Futures）和客户端（Silverlight）的最新 DLR 中杀死了托管 JavaScript，是否有人成功使用过时的 API 来允许使用 JScript.NET 对其应用程序对象进行脚本编写和/或可以解释如何做到这一点？如果 Mono/JScript 解决方案稳定且满足以下要求，它也可能是可接受的。

我们有兴趣从使用 Microsoft JScript 引擎和 ActiveScript API 的脚本宿主升级到具有更高性能和更容易扩展的东西。我们有超过 16,000 个服务器端脚本，源代码超过 42MB，因此重写为另一种脚本语言是不可能的。

我们的具体要求是：

*   性能明显优于 Microsoft JScript (ActiveScript) 引擎
    *   更好的运行时性能和/或
    *   保留预解析或编译的脚本（不要在每次运行时重新解析）
    *   较低或相等的内存消耗
*   完全兼容 ECMA-262 ECMAScript
    *   可以容忍一点移植
*   将自定义对象注入脚本命名空间
    *   .NET 对象（不是硬性要求）
    *   COM 对象或包装在 .NET 中的 COM 对象
*   从脚本实例化 COM 对象
    *   à la "new ActiveXObject(progid)"
    *   考虑到前面的低优先级
*   包含文件
    *   将“帮助脚本”预加载到脚本执行上下文中
    *   “包含”函数或语句（易于创建，鉴于上述情况）
*   支持全局范围内的代码
    *   在全局范围内执行代码
    *   保留在全局范围内初始化的值
    *   从全局范围中提取值
    *   在全局范围内注入和替换值
*   调用脚本定义的函数
    *   带参数
    *   并可以访问先前初始化的全局范围
*   源码级调试
*   商业或开源支持
*   过时的 API

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-04-08T20:22:24.317

[我在这里](https://stackoverflow.com/questions/775339/where-can-you-download-managed-jscript-for-the-dlr/2603141#2603141)回答了一个类似的问题。看看[IronJS](http://github.com/fholm/IronJS)，一个在 DLR 上运行的 F# 中的 JavaScript 实现。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T17:08:39.700

迟早，我想有人会写一个 DLR Javascript。我知道这对你现在不是很方便，但也许你可以开始这个项目。我怀疑使用 JScript.NET 会有更好的成本/收益分析。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-16T15:16:54.053

如果离开 .NET 和 Microsoft 对您来说没问题，那么您应该尝试 Mozilla 的[Rhino](http://www.mozilla.org/rhino/)。它是完全用 Java 编写的 JavaScript 的开源实现。许多现代服务器端 js 库都针对这个平台。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-12-23T00:38:10.763

我使用[了 CSScript.net](http://csscript.net/)，因为它允许您将 C# 作为脚本平台运行。从网站：

> CS-Script 结合了 C# 和 FCL 的强大功能和丰富性以及脚本系统的灵活性。CS-Script 对系统和网络管理员、开发人员和测试人员很有用。对于任何需要自动化来解决各种编程任务的人。

CS Script 满足您制定的所有条件。我在生产中使用它作为 Boo 的替代品，它的表现非常好。[您可以在这里](http://www.codeproject.com/KB/cs/cs-script_for_cp.aspx)看到它的实际效果。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-01T04:40:05.420

Com interop 的使用意味着您仅限于一个 MS 解决方案，Java 和开源希望尽可能少地使用它。

我没有看到任何支持您所有要求的解决方案，要么您放弃所有 COM/.NET 的东西并使用 Java (Rhino)/Linux/开源，要么您质疑使用 Javascript 作为您的服务器语言，即使在我们使用 PHP 的 Linux 世界中/Python/Ruby 如果我们不能运行 Java，则在服务器上更多。您不会看到 Java 脚本的性能大幅提升，因为语言是主要障碍。

我不会指望人们编写新的 DLR，因为服务器 Java 脚本正在快速消亡。

考虑到您想要性能，F# 怎么样，Microsoft 将保持对 Jscript 引擎的支持至少 5 年，让您有时间在 F# 中创建新东西，同时慢慢迁移代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-12-08T23:29:26.533

[侏罗纪](http://jurassic.codeplex.com/)引擎是活生生的。

从他们的 codeplex 网站：

*   支持所有 ECMAScript 3 和 ECMAScript 5 功能，包括 ES5 严格模式
*   经过良好测试 - 通过超过五千个单元测试（超过三万个断言）
*   简单而强大的 API
*   将 JavaScript 编译成 .NET 字节码 (CIL)；不是口译员
*   部署为单个 .NET 程序集（无本机代码）
*   对 Visual Studio 中集成调试的基本支持
*   使用轻量级代码生成，因此生成的代码完全被垃圾回收
*   在 .NET 3.5、.NET 4 和 Silverlight 上测试

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-07-22T12:59:39.963

你见过 ROScript 吗？ [http://www.remobjects.com/script.aspx](http://www.remobjects.com/script.aspx)

支持 PascalScript 和 ECMAScript (Javascript) 语法

# c# - 先进先出的最佳收集对象和按位置查看项目的能力

> ID：937353
> 
> 赞同：1
> 
> 时间：2009-06-01T23:55:21.900
> 
> 标签：c#, .net, data-structures, collections

我正在寻找一个允许 FIFO 的集合对象/策略，并让我通过简单地指定它们的位置来查看集合中的项目。澄清：

1.  我希望这个数据结构可以容纳 100 个 DTO 对象，然后当它达到 101 时，我可以通过删除第一项等来腾出空间（FIFO）。

2.  我希望能够在请求时返回这些对象中最新的 x # 个。

我尝试使用 .Net 队列对象，但据我所知它不支持 #2，尽管我可能会忽略那里的某些东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T00:08:37.227

当您想从队列中弹出一个项目时，包装一个 List 并执行 RemoveAt(0) 并不难。这将为您提供 FIFO 并让您在任何您想要的地方建立索引。您可能应该包装它以保护队列的完整性（仅限 FIFO）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T00:11:54.550

我快速浏览了 .NET 文档，但找不到任何可以满足您需要的内容。看起来您需要自己实现它，尽管这并不太难。我建议使用适当大小的数组，并保留数组中当前位置的读写索引，并将其用作循环数组。

Enqueue 会将值写入 readIndex，然后将 readIndex 设置为 ((readIndex + 1) % queueSize)。如果 readIndex == writeIndex，出队将抛出异常，否则在 writeIndex 处获取值，然后将 writeIndex 增加 ((writeIndex + 1) % queueSize)。查看队列索引（从队列顶部，即最后排队的项目）将返回位于 ((queueSize + (readIndex - index)) % queueSize) 的项目。

# visual-c++-6 - 无法在 VC++6 中加载工作区

> ID：937358
> 
> 赞同：1
> 
> 时间：2009-06-01T23:57:29.120
> 
> 标签：visual-c++-6, workspace

我已经将一个项目复制到一个新目录，现在工作区将不会加载到 vc++6 ide。没有错误，只是没有工作区。我区分了 dsw 和 dsp 文件，它们是相同的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-04T04:43:25.113

嗯，这*真的很*烦人。问题原来是 dsw 工作空间文件中的 CRLF->LF 问题。Git 已删除 CR，notepad++ 内部的差异显示相同的文件。添加回 CR，工作区现在加载到 VC6 中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T00:03:33.773

使用文本编辑器检查项目和解决方案文件以查找指向无法找到的文件的任何路径 - 可能存在无法找到的相对或绝对路径？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T19:53:31.703

当从基于 ide 的开发迁移到命令行构建，然后再回到 ide 时，就会出现这个问题。dsw 和 dsp 文件需要比源文件更新，否则工作区将拒绝加载。只需在文本编辑器中打开文件并保存它们而不做任何更改，或者使用 touch.exe，它可以在 sourceforge 的 UnxUtils 中拥有。

# mysql - 每天存储 2000 万行的最佳免费方式？

> ID：937360
> 
> 赞同：2
> 
> 时间：2009-06-01T23:59:59.770
> 
> 标签：mysql, database

每天 20-25 百万行将在午夜删除以获取第二天的数据。mySQL 可以处理 2500 万条索引行吗？另一个好的解决方案是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-02T00:20:12.553

您提供的有关上下文的信息很少，但有时*不*使用数据库，而是使用二进制/纯文本文件就可以了，并且可以 - 根据您的要求 - 更加高效和可维护。例如，如果传感器数据将其存储在二进制文件中，每条记录的偏移量已知，这可能是一个很好的解决方案。您说数据将每 24 小时删除一次似乎表明您可能不需要关系数据库解决方案的某些属性，例如 ACID、复制、集成备份等，所以也许平面文件方法就可以了？

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-02T00:33:44.820

我们的 MySQL 数据库有超过 3 亿行的索引，我们只遇到过复杂连接运行速度有点慢的问题——尽管大多数都可以优化。

处理行没有问题——我们性能的关键是良好的索引。

考虑到您在午夜删除信息，我还将查看 MySQL 分区，这将允许您删除表的该部分，同时允许第二天继续插入（如果需要）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-02T01:29:33.023

问题不在于行数本身——而是你对数据库所做的事情。您是否只在白天进行插入，然后进行一些批处理报告？或者，您是否每秒对数据进行数千次查询？插入/更新/删除？如果您在任何数据库平台上猛击足够的负载，您可以使用单个表和单个行来最大化它（将其发挥到最极端）。我在具有 40M 行用户表的站点上使用了带有 MyISAM 的 MySQL 4.1（几乎不是最现代的）。我认为它的查询时间小于 5 毫秒。我们在不到 200 毫秒的时间内渲染页面。但是，我们设置了很多缓存，所以查询的数量并不算多。而且，我们正在执行简单的语句，例如 SELECT * FROM USER WHERE USER_NAME = 'SMITH'

你能对你的用例发表更多评论吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-02T01:36:36.907

如果您使用的是 Windows，则可能比使用 SqlExpress 2008 做得更糟，它应该可以轻松处理该负载，具体取决于您在其上创建的索引数量。只要您保持 < 4GB 的总数据库大小，这应该不是问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-02T00:04:02.303

根据我的经验，mySQL 往往根本无法很好地扩展。如果您必须为此提供免费解决方案，我**强烈**推荐[postgreSQL](http://www.postgresql.org/)。

此外（这对您来说可能是也可能不是问题），但请记住，如果您要处理这么多数据，如果我没记错的话，mySQL 数据库的最大大小为 4 TB。

我认为 mySQL 中的最大行数没有实际限制，所以如果您必须使用 mySQL，我认为它可以满足您的需求，但对于生产系统，我个人不推荐它.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-02T00:27:44.143

作为一般解决方案，我也推荐 PostgreSQL，但根据您的具体需求，其他解决方案可能会更好/更快。例如，如果您在编写数据时不需要查询数据，[TokyoCabinet](http://tokyocabinet.sourceforge.net/)（基于表的 API / TDB）可能会更快、更轻量/更健壮。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-02T00:31:42.500

我没有在 mysql 中研究过它们，但这听起来像是一个完美的[表分区应用程序](http://dev.mysql.com/tech-resources/articles/mysql_5.1_partitions.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-06-12T15:07:02.357

仅用作索引数据库并以文件的形式存储会更有效，因为您将在 24 小时内删除，并且过程会更快，也不会给您的服务器造成负担

# asp.net - 从 BaseDataBoundControl.DataSource (ASP.NET GridView) 读取数据

> ID：937364
> 
> 赞同：0
> 
> 时间：2009-06-02T00:02:36.053
> 
> 标签：asp.net, gridview, datasource

我在 WebForm 上有一个 ASP.NET 3.5 GridView。GridView 从通过前面代码中的 DataSourceID 属性设置的 ObjectDataSource 获取数据。ObjectDataSource 返回自定义数据类对象的列表（只是一个具有公共属性的类）以填充 GridView。

我想要做的是在另一个代码隐藏方法中使用 GridView 使用的列表。概括地说： 1\. GridView 加载了来自 ObjectDataSource 的列表数据。2\. 在 GridView.OnDataBound 方法中我调用 GridView.DataSource 来获取 List 对象。3.我枚举List并使用相同的数据来做一些其他的操作。

该理论是减少一次重复的方法调用和一次对后端数据库的调用。

我尝试从 GridView 的 DataBound 方法调用 DataSource 并调用 GridView.Rows[x].DataItem。在每种情况下，我只得到一个空引用异常（“对象引用未设置为对象的实例”）。

有什么办法可以实现我所追求的吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-02T00:23:20.020

如果我理解正确，你想要这个[`OnRowDataBound`事件](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.onrowdatabound.aspx)。这样，您可以使用刚刚数据绑定的行中的数据：

```
protected void gvGrid_RowDataBound(object sender, GridViewRowEventArgs e)
{
    CustomDataClass data = e.Row.DataItem as CustomDataClass;
    if (data != null) 
    {
        // access data here...
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-01T15:55:01.310

但是你想要 onRowDataBound 事件吗？看起来你想要 GridView 的整个数据源的 onDataBound 事件......

因此，您不一定需要 CustomDataClass 的一个实例（行），您希望整个 CustomDataClass[] 行数组在其他地方使用。

帮助！我也需要这个。

******更新******

我找到了答案。执行以下操作并在您的 objectdatasource 中设置 OnSelected 事件：

protected void ObjectDataSource_Selected(object sender, ObjectDataSourceStatusEventArgs e) { ObjectListRow[] objectArray = (ObjectListRow[])e.ReturnValue; 列表 objectList = objectArray.ToList(); }

事实证明我的数据源是一个数组，但如果你的数据源是 List<>，那么只需将 e.ReturnValue 转换为 List。

简单的俗气。

# c# - 更改 PropertyGrid 左侧集合编辑器/视图的宽度

> ID：937365
> 
> 赞同：1
> 
> 时间：2009-06-02T00:03:12.540
> 
> 标签：c#, .net, collections, propertygrid

任何带有长字符串的东西都只会引入一个带有滚动条的不可用视图。

集合编辑器的宽度是否由设计固定，是否可以在这个很棒的演示文稿中引入拆分器？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-02T04:31:12.270

我还没有看到使用常规的方法来做到这一点，但如果你不介意付费，Visualhint 在[这里](http://www.visualhint.com/index.php/propertygrid/)`PropertyGrid`有一个更发达的产品——也许可以试用一下。

* * *

这使用反射来完成工作；谨慎使用...

```
using System;
using System.Reflection;
using System.Windows.Forms;
class Program {
    [STAThread]
    static void Main() {
        Application.EnableVisualStyles();
        Form form = new Form();
        // this bar will control the splitter
        ScrollBar sb = new HScrollBar {
            Minimum = 10, Maximum = 200,
            Dock = DockStyle.Bottom
        };
        // the grid we want to control
        PropertyGrid grid = new PropertyGrid {
            SelectedObject = form, Dock = DockStyle.Fill
        };
        // add to the form
        form.Controls.Add(grid);
        form.Controls.Add(sb);
        // event to update the grid
        sb.ValueChanged += delegate {
            MoveSplitterTo(grid, sb.Value);
        };
        Application.Run(form);
    }
    static void MoveSplitterTo(PropertyGrid grid, int x) {
        // HEALTH WARNING: reflection can be brittle...
        FieldInfo field = typeof(PropertyGrid)
            .GetField("gridView",
                BindingFlags.NonPublic | BindingFlags.Instance);
        field.FieldType
            .GetMethod("MoveSplitterTo", 
                BindingFlags.NonPublic | BindingFlags.Instance)
            .Invoke(field.GetValue(grid), new object[] { x });
    }
} 
```

# c# - 如何阻止我的 System.Messaging.MessageQueue 将我的字符串包装在 XML 中？

> ID：937372
> 
> 赞同：6
> 
> 时间：2009-06-02T00:05:52.130
> 
> 标签：c#, .net, xml-serialization, msmq

我需要通过 Windows 消息队列从我的 C# 应用程序与旧应用程序通信。

旧版应用程序在特定的私有队列中需要纯字符串消息，但我似乎无法阻止 System.Messaging.MessageQueue 将我的消息包装在 XML 中！

我正在测试的代码非常简单：

```
MessageQueue myQueue = new MessageQueue(@".\Private$\tolegacy");
Message msg = new Message("My Test String");
myQueue.Send(msg); 
```

问题是消息正在被 XML 序列化并在队列中显示为：

```
<?xml version="1.0"?><string>My Test String</string> 
```

**我无法修改旧应用程序的行为，因此我需要阻止 System.Messaging.MessageQueue 将我的消息格式化为 XML。**

任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-05-09T00:53:42.617

使用[ActiveXMessageFormatter](http://msdn.microsoft.com/en-us/library/system.messaging.activexmessageformatter.aspx)将为您提供所需的结果。我们只是想将一个字符串传递给一个队列并让侦听器进程作为字符串在正文中读取时遇到了同样的问题。**ActiveXMessageFormatter**用于序列化/反序列化原始数据类型，不会像默认的 XmlMessageFormatter 那样在您的输入上放置 XML包装**器**。

```
mq.Formatter = new ActiveXMessageFormatter(); 
```

[这](http://msinnovations.wordpress.com/2008/05/22/activexmessageformatter-rocks/)是另一个描述 3 种不同格式化程序的链接。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-02T00:21:09.477

您可以创建自己的格式化程序（它是一个实现 IMessageFormatter 并将其分配给 Message 的 Formatter 属性的类

这是MSDN 到 Message.Formatter 属性 的[链接。](http://msdn.microsoft.com/en-us/library/system.messaging.message.formatter.aspx)

我没有尝试过，但您应该可以使用 BodyStream 编写您的消息，我相信这将绕过格式化程序。

# c++ - 通过引用从 C++ 中的类访问变量

> ID：937378
> 
> 赞同：1
> 
> 时间：2009-06-02T00:09:13.823
> 
> 标签：c++

我在 C++ 中有一个类，其中一部分在下面

```
class Node{
    public:
       vector<string> getNames() const;
    private:
        vector<string> names_;
};
vector<string> Node::getNames(){
    return names_;
} 
```

函数 getNames() 传递向量的副本。如何修改我的类，以便我可以从我声明 Node 对象而不是传递副本的任何其他类中“通过 const 引用”引用向量？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-02T00:12:47.967

尝试这个：

```
class Node
{
    public:
       const vector<string>& getNames() const;

    private:
        vector<string> names_;
};

const vector<string>& Node::getNames() const
{
    return names_;
} 
```

一些事情：

1.  getNames() 现在是一个 const 方法，因为 Node 在逻辑上不会改变。
2.  作为常量引用返回，因此您不会复制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T00:11:02.603

将定义更改为

```
const vector<string>& getNames() const; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T01:35:21.870

只是一些反对返回对成员的引用的论点：

*   您的类的客户可能持有该引用的时间比您的实例存在的时间长（内存损坏，）
*   方法和返回的引用`const`-ness 并不能真正保护您免受`const_cast`用于删除它的客户端的影响（逻辑访问冲突，）
*   在线程环境中很危险（竞争条件。）

我会把它放在[过早优化](http://c2.com/cgi/wiki?PrematureOptimization)部分下。

# c# - 界面设计？我可以迭代地做吗？我应该如何处理界面的变化？

> ID：937380
> 
> 赞同：2
> 
> 时间：2009-06-02T00:09:34.760
> 
> 标签：c#, java, oop, interface

在 C# 或 Java 中定义接口的最佳方法是什么？当真正需要出现时，我们是否需要通用或添加方法？

问候， 斯里尼瓦斯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T00:14:58.350

一旦定义了接口，它就**不会**被更改。您必须考虑界面的目的并尽可能完整。

如果您以后发现需要添加一个方法，那么您真的应该使用附加方法定义一个新接口，可能是一个 _V2 接口。

**附录**： [在这里，您将找到一些关于 C# 界面设计的良好指南](http://en.csharp-online.net/.NET_Type_Design_Guidelines%E2%80%94Interface_Design)，作为一般 C# 设计的更大、有价值的工作的一部分。它通常也适用于 Java。

摘录：

> 尽管大多数 API 最好使用类和结构进行建模，但在某些情况下接口更合适或者是唯一的选择。
> **DO**至少提供一种类型，它是接口的实现。这有助于验证界面的设计。例如，System.Collections.ArrayList 是 System.Collections.IList 接口的实现。
> **请**提供至少一个 API 来使用您定义的每个接口（将接口作为参数的方法或类型化为接口的属性）。这有助于验证界面设计。例如， List.Sort 使用 IComparer 接口。
> **不要**将成员添加到以前发布的接口。这样做会破坏接口的实现。您应该创建一个新接口以避免版本控制问题。

我建议依靠[广泛的类型设计指南](http://en.csharp-online.net/.NET_Type_Design_Guidelines)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T13:09:22.520

引用约书亚·布洛赫的话：

> 如有疑问，请忽略它。

您以后可以随时添加到界面。一旦成员成为您界面的一部分，就很难更改或删除它。在创建接口时要非常保守，因为它们是具有约束力的合同。

作为旁注[，这里是对 Vance Morrison（Microsoft CLR 团队的）的一次精彩采访](http://channel9.msdn.com/shows/Going+Deep/Vance-Morrison-CLR-Through-the-Years/)，他在其中提到了 CLR 的未来版本允许“mixins”或与其成员的默认实现接口的可能性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T13:24:35.783

如果您的界面是与其他项目和团队共享的代码的一部分，请听听 Cheeso。但是，如果您的界面是私人项目的一部分并且您可以访问所有更改点，那么您可能不需要界面开始，而是继续更改它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T13:40:13.707

如果接口要公开，我觉得在设计中需要非常小心，因为如果大量代码在下一次迭代中突然中断，对接口的更改将会很困难。

对接口的更改需要谨慎，因此，如果在初始版本之后不必进行更改，那将是理想的。这意味着，就设计而言，第一次迭代将非常重要。

但是，如果需要更改，实现接口更改的一种方法是[弃用](http://java.sun.com/j2se/1.4.2/docs/guide/misc/deprecation/deprecation.html)旧方法，并为旧代码提供过渡路径以使用新设计的功能。这确实意味着已弃用的方法仍将保留以防止使用旧方法的代码被破坏——这并不理想，因此第一次没有正确处理是“要付出的代价”。

在一个相关的问题上，昨天，我偶然发现了由[Joshua Bloch 撰写的 Google Tech Talk：](http://en.wikipedia.org/wiki/Joshua_Bloch) [How to Design a Good API and Why It Matters](http://www.youtube.com/watch?v=aAb7hSCtvGw)。他是 Java Collection 库等的设计和实现的幕后推手，并且是[Effective Java](http://java.sun.com/docs/books/effective/)的作者。

这段视频大约一个小时，他详细介绍了什么是好的 API，为什么我们应该制作设计良好的 API 等等。这是一个很好的视频，可以观看一些想法和灵感，以了解在考虑设计 API 时要注意的某些事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-02T13:40:46.123

稍后向接口添加方法会立即破坏接口的所有未意外实现这些方法的实现。因此，请确保您的接口规范是完整的。我建议您从接口的（示例）客户端开始，该部分实际上使用实现所述接口的类的实例。无论客户需要什么，都必须是界面的一部分（显然）。然后制作接口的（示例）实现，并查看哪些附加方法通常有用且可用（在可能的其他实现中），因此它们也应该是接口的一部分。检查对称完整性（例如，如果有“openXYZ”，也应该有“closeXYZ”。如果有“addFooBar”，应该有“removeFooBar”。等等）如果可能，

并且：确保你真的想要一个界面。也许抽象基类更适合您的需求。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-07-12T22:34:15.730

嗯，这真的取决于你的具体情况。如果您的团队是该界面的唯一用户/维护者，那么无论如何，按照您认为合适的方式对其进行修改，并忘记所有关于“最佳实践 blabla”之类的东西。毕竟这是你的代码......永远不要在不了解其基本原理的情况下盲目遵循最佳实践。

现在，如果您正在创建一个其他团队或客户可以使用的公共 API（想想插件、扩展点或类似的东西），那么您必须对您在界面中放置的内容保持保守。正如其他提到的，您可能必须在这些情况下添加 _V2 类型的接口。Microsoft 使用了几个 Web 浏览器 COM 接口。

Microsoft 在框架设计指南中发布的指南就是：PUBLIC 接口指南。不适用于私人内部物品；艰难的其中许多仍然适用。知道什么适用于您的情况。

没有规则可以弥补缺乏常识。

# nhibernate - 使用 NHibernate 急切加载子集合

> ID：937388
> 
> 赞同：25
> 
> 时间：2009-06-02T00:11:21.073
> 
> 标签：nhibernate, eager-loading, querying

我想加载根实体并急切地加载它的所有子集合和聚合成员。

一直在尝试`SetFetchMode`在 FluentNHibernate 中使用，但由于我的深度为 3 个级别，因此我在其中一个子集合中得到了重复项。`DistinctRootEntityResultTransformer`不幸的是，只删除了根重复。

```
return Session.CreateInvoiceBaseCriteria(query, archived)
    .AddOrder(new Order(query.Order, query.OrderType == OrderType.ASC))
    .SetFetchMode("States", FetchMode.Eager)
    .SetFetchMode("Attestations", FetchMode.Eager)
    .SetFetchMode("AttestationRequests", FetchMode.Eager)
    .SetFetchMode("AttestationRequests.Reminders", FetchMode.Eager)
    .SetResultTransformer(new DistinctRootEntityResultTransformer())
    .List<Invoice>(); 
```

我可以使用多个查询或类似的东西来存档吗？

此外，这种方法不会导致数据库中不必要的巨大结果集吗？

有什么建议么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-04T23:00:33.023

找到了解决方案，但它并不漂亮。首先我去查找所有发票 ID，然后在多查询中使用它们，最后通过 HashedSet 过滤结果。由于项目数量众多，有时我无法使用 normalt Restriction.In 并被迫将其作为字符串发送。

任何建议的调整？

```
var criteria = Session.CreateInvoiceBaseCriteria(query, archived)
    .SetProjection(Projections.Id());

var invoiceIds = criteria.List<int>();
if (invoiceIds.Count > 0)
{
    var joinedIds = JoinIDs(criteria.List<int>()); // To many ids to send them as parameters.

    var sql1 = string.Format("from Invoice i inner join fetch i.States where i.InvoiceID in ({0}) order by i.{1} {2}", joinedIds, query.Order, query.OrderType.ToString());
    var sql2 = string.Format("from Invoice i inner join fetch i.AttestationRequests where i.InvoiceID in ({0})", joinedIds);
    var sql3 = string.Format("from Invoice i inner join fetch i.Attestations where i.InvoiceID in ({0})", joinedIds);

    var invoiceQuery = Session.CreateMultiQuery()
        .Add(sql1)
        .Add(sql2)
        .Add(sql3);

    var result = invoiceQuery.List()[0];

    return new UniqueFilter<Invoice>((ICollection)result);
}

return new List<Invoice>(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-21T08:57:37.183

回答您的问题：是的，它会产生巨大的结果集。

我建议：

*   只是天真地写你的查询而不急于获取
*   在某些地方，放置一个急切的提取，但每个查询只有一个
*   如果您确实遇到了无法通过索引或通过增强查询和映射策略解决的性能问题，请将您的解决方案与多个查询一起使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T08:39:19.337

虽然它可能不是您正在寻找的东西，但我建议您查看这篇文章：

[具有许多子集合的急切加载聚合](http://nhibernate.info/blog/2008/09/06/eager-loading-aggregate-with-many-child-collections.html)

如果您浏览该站点的其余部分，您会发现更多讨论急切加载和其他出色的 nHibernate 内容的帖子。

# java - 我可以将 CSS 应用于摆动文本组件吗？

> ID：937393
> 
> 赞同：1
> 
> 时间：2009-06-02T00:13:57.403
> 
> 标签：java, css, swing

许多摆动文本组件将解释 HTML。如果可能的话，我想用 CSS 来设置这个 HTML 的样式。有人知道怎么做吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T00:22:38.243

[Jaxx 框架](http://www.aboutus.org/JaXxFramework.org)允许您执行此操作。

# wcf - 在 Silverlight 中使用 WCF 时添加服务引用有什么问题？

> ID：937395
> 
> 赞同：4
> 
> 时间：2009-06-02T00:14:16.370
> 
> 标签：wcf, silverlight, service-reference

[本文](http://www.netfxharmonics.com/2008/11/Understanding-WCF-Services-in-Silverlight-2)讨论了在 Silverlight 中使用 WCF 服务，但声称：

**没有代理，没有生成的代码，没有第 3 方实用程序，也没有令人作呕的“添加服务参考”用法。**

我在 Silverlight 项目中添加服务引用有什么问题？是否有隐藏的开销？还是作者对汽车魔法的恐惧？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T01:08:58.243

作者发表该声明的理由似乎是：

> 首先，让我提醒大家不要在 Visual Studio 中使用“添加服务引用”来创建神奇的服务客户端。代码非常冗长，难以管理，编辑很容易被覆盖，而且几乎总是被用作不真正学习 WCF 的借口。没有什么比仅仅因为他们知道如何使用鼠标而不得不与了解产品的人打交道更糟糕的了。

作为一个完全依赖 Silverlight 中“添加服务参考”的人，我认为这有点过头了。我同意自动生成的代码是冗长的，它不应该被编辑，因为它会被覆盖。然而，就可管理性而言，它并没有变得更简单，为了响应我的服务更改，只需单击一下即可使服务引用恢复同步。

尽管如此，我认为这篇文章非常好，而且我可以保证添加服务引用的便利性阻止了我深入研究 WCF。这不一定是一件坏事，因为在一天结束时 WCF 正在管道中，我有兴趣编写我的应用程序而不是成为 WCF 专家。碰巧的是，我现在遇到了 Silverlight 和我的服务之间的一些序列化问题，我怀疑这些问题与浏览器有关。我需要更深入地研究 WCF 以对其进行整理，而那篇文章看起来是一个完美的起点。

“添加服务参考”对我来说已经用了 1.5 年了，虽然学习 WCF 的内部结构当然有好处，但在 Visual Studio 中使用快速简单的点击方式开始使用绝对没有错.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-03T04:10:55.250

Silverlight 中的“添加服务引用”现在存在一些问题......每次更新服务时都会重新生成配置文件。

它比人们强调的“汽车魔术”更进一步。首先，通过服务引用，您将“耦合”到服务及其公开的方法。如果您重新生成服务，客户端也必须这样做。动态创建服务可以缓解这个问题。此外，通过抽象/反射/依赖注入，您现在可以解耦服务引用。

我不认为服务引用不好，但是 WCF 和 Web 概念正在远离它。例如，WCF REST 标准没有您使用的“服务引用”……它只是 URL 路由表。越来越多的人建议将此作为标准，例如 Juwal Lowy（idesign.net 和几本 WCF 书籍的作者）也建议不要使用服务引用。

# c# - 我在哪里可以找到设计网页的标准规则集？

> ID：937396
> 
> 赞同：2
> 
> 时间：2009-06-02T00:14:22.753
> 
> 标签：c#, javascript, html, css

我已经制作网页大约 5 年了。我是一名 C# 程序员，但我确实了解 HTML、JavaScript 和 CSS，而且我所有的网站看起来都像是刚刚走出 1995 年的互联网。是否有快速参考网页设计中的一组注意事项？

**注意：**尽管我的网站看起来不太好，但至少它们可以工作 ;-)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T00:21:33.643

您是否尝试过查看您喜欢的网站的 HTML、CSS、JavaScript 和资产？一切都在那里——这就是开放网络的伟大之处。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-02T00:29:51.097

一些较旧但仍然相关的链接：

[美丽网页设计的原则](http://www.sitepoint.com/article/principles-beautiful-web-design/)

[色彩设计的五个简单步骤](http://www.markboulton.co.uk/journal/comments/five_simple_steps_to_designing_with_colour/)

[你的网站设计有多垃圾？](http://thinkvitamin.com/features/design/how-crap-is-your-site-design/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-02T00:17:32.090

我知道您正在寻找更多视觉帮助，但请参阅本指南了解一些技术问题：
[https ://stackoverflow.com/questions/72394/what-should-a-developer-know-before-building-a-public-网站](https://stackoverflow.com/questions/72394/what-should-a-developer-know-before-building-a-public-web-site)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-02T00:21:32.783

这是不要做的一个很好的参考：

[http://csszengarden.com/?cssfile=http://www.brucelawson.co.uk/zen/sample.css](http://csszengarden.com/?cssfile=http://www.brucelawson.co.uk/zen/sample.css)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-03T05:49:47.580

这本书在我刚开始的时候对我非常有用，我推荐的很多人都对它很满意：

[非设计师的网络书](https://rads.stackoverflow.com/amzn/click/com/020168859X)

事实上，她关于设计的一般书几乎一样好，因为它主要是关于原则的，而不是关于技术细节的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-02T04:22:51.583

只需对设计原则进行自我教育......诸如三分法，平衡，对称，对比，节奏和图案，比例（神圣比例）之类的东西。

花一个小时搜索“设计原则”，您可能会惊讶于您的网站会想到什么想法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-02T00:34:56.923

可悲的是，真的没有一套做/不做的事情。对于给定的外观/感觉和用户体验，我不知道针对 Web 应用程序的任何类型的 CUA 类指南。

美学：

*   [ASP.NET MVC 设计库](http://www.asp.net/mvc/gallery/default.aspx)- 用于 MVC
*   [ASP.NET 设计模板](http://msdn.microsoft.com/en-us/asp.net/aa336613.aspx)- 用于 web 表单
*   [25 个 Magento 网站设计](http://www.smashingmagazine.com/2009/05/05/25-magento-templates-for-your-e-commerce-business/)

我还会定期阅读[Smashing Magazine](http://www.smashingmagazine.com/) （我相信还有其他杂志），它有关于布局、设计模板、画廊、排版以及优化网站中不同类型的工作流程（例如购物车、非利润网站等）。

令人惊讶的是，在我的上一个项目中，刚开始使用其中一个 asp.net 模板使我的应用程序开箱即用看起来更好，并且最大限度地减少了最终用户在最初使用该应用程序时的阻力。当然是 YMMV。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-03T10:59:18.940

还可以查看[dan cederholm 的防弹 CSS](http://simplebits.com/publications/bulletproof/)

# sql - 如何在 SQL*Plus 中获取 Oracle 创建表语句

> ID：937398
> 
> 赞同：21
> 
> 时间：2009-06-02T00:14:56.590
> 
> 标签：sql, oracle, sqlplus

我有一个存在于 Oracle 数据库中的表，但没有显示在我的工具 SQL Developer 中的表列表中。但是，如果我使用 SQL*Plus 并执行

```
select table_name from user_tables; 
```

我列出了表格。如果我输入

```
desc snp_clearinghouse; 
```

它向我展示了这些领域。我想获得 create 语句，因为我需要添加一个字段。我可以修改表格以添加字段，但我仍然需要将 create 语句放入我们的源代码管理中。什么 pl/sql 语句用于获取表的创建语句？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-06-02T00:26:05.287

从[Get table and index DDL 最简单的方法](http://www.dba-oracle.com/oracle_tips_dbms_metadata.htm)：

```
set heading off;
set echo off;
Set pages 999;
set long 90000;

spool ddl_list.sql

select dbms_metadata.get_ddl('TABLE','DEPT','SCOTT') from dual;

select dbms_metadata.get_ddl('INDEX','DEPT_IDX','SCOTT') from dual;

spool off; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-08-22T05:56:20.977

与上面相同，但在此处找到通用脚本 [gen_create_table_script.sql](http://www.akadia.com/services/scripts/gen_create_table_script.sql)

```
-- #############################################################################################
--
-- %Purpose: Generate 'CREATE TABLE' Script for an existing Table in the database
--
-- Use:      SYSTEM, SYS or user having SELECT ANY TABLE  system privilege
--
-- #############################################################################################
--
set serveroutput on size 200000
set echo off
set feedback off
set verify off
set showmode off
--
ACCEPT l_user CHAR PROMPT  'Username: '
ACCEPT l_table CHAR PROMPT 'Tablename: '
--
DECLARE
 CURSOR TabCur IS
 SELECT table_name,owner,tablespace_name,
        initial_extent,next_extent,
        pct_used,pct_free,pct_increase,degree
   FROM sys.dba_tables
  WHERE owner=upper('&&l_user')
    AND table_name=UPPER('&&l_table');
--
 CURSOR ColCur(TableName varchar2) IS
 SELECT column_name col1,
        DECODE (data_type,
                'LONG',       'LONG   ',
                'LONG RAW',   'LONG RAW  ',
                'RAW',        'RAW  ',
                'DATE',       'DATE   ',
                'CHAR',       'CHAR' || '(' || data_length || ') ',
                'VARCHAR2',   'VARCHAR2' || '(' || data_length || ') ',
                'NUMBER',     'NUMBER' ||
                DECODE (NVL(data_precision,0),0, ' ',' (' || data_precision ||
                DECODE (NVL(data_scale, 0),0, ') ',',' || DATA_SCALE || ') '))) ||
        DECODE (NULLABLE,'N', 'NOT NULL','  ') col2
   FROM sys.dba_tab_columns
  WHERE table_name=TableName
    AND owner=UPPER('&&l_user')
 ORDER BY column_id;
--
 ColCount    NUMBER(5);
 MaxCol      NUMBER(5);
 FillSpace   NUMBER(5);
 ColLen      NUMBER(5);
--
BEGIN
 MaxCol:=0;
 --
 FOR TabRec in TabCur LOOP
    SELECT MAX(column_id) INTO MaxCol FROM sys.dba_tab_columns
     WHERE table_name=TabRec.table_name
       AND owner=TabRec.owner;
    --
    dbms_output.put_line('CREATE TABLE '||TabRec.table_name);
    dbms_output.put_line('( ');
    --
    ColCount:=0;
    FOR ColRec in ColCur(TabRec.table_name) LOOP
      ColLen:=length(ColRec.col1);
      FillSpace:=40 - ColLen;
      dbms_output.put(ColRec.col1);
      --
      FOR i in 1..FillSpace LOOP
         dbms_output.put(' ');
      END LOOP;
      --
      dbms_output.put(ColRec.col2);
      ColCount:=ColCount+1;
      --
      IF (ColCount < MaxCol) THEN
         dbms_output.put_line(',');
      ELSE
         dbms_output.put_line(')');
      END IF;
    END LOOP;
    --
    dbms_output.put_line('TABLESPACE '||TabRec.tablespace_name);
    dbms_output.put_line('PCTFREE '||TabRec.pct_free);
    dbms_output.put_line('PCTUSED '||TabRec.pct_used);
    dbms_output.put_line('STORAGE ( ');
    dbms_output.put_line('  INITIAL     '||TabRec.initial_extent);
    dbms_output.put_line('  NEXT        '||TabRec.next_extent);
    dbms_output.put_line('  PCTINCREASE '||TabRec.pct_increase);
    dbms_output.put_line(' )');
    dbms_output.put_line('PARALLEL '||TabRec.degree);
    dbms_output.put_line('/');
 END LOOP;
END;
/ 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2022-02-03T22:37:10.197

如果您使用 oracle SQLcl 命令行客户端，最简单的方法是使用`ddl`内置命令。例如

```
ddl ownername.tablename 
```

您将获得该表的完整定义。警告：根据您的目标表，它可能会很长。

[![在此处输入图像描述](https://i.stack.imgur.com/wnaT3.png)](https://i.stack.imgur.com/wnaT3.png)

# php - 我在哪里可以找到 wordpress “推广”类？

> ID：937405
> 
> 赞同：0
> 
> 时间：2009-06-02T00:20:23.567
> 
> 标签：php, wordpress

我使用 wordpress 创建了一个网站。我安装了“starkers”主题并对其进行了修改。然而，在single.php 里面，有一堆文字在宣传这个博客。这包含在一个promote类中。我一直在寻找这个文本在我的网站中的位置，但我似乎找不到它。我最初以为它位于我的functions.php 中，但该文件是空的。

我希望这里有人能帮助我。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-02T01:05:25.473

您能否提供更具体的信息，例如相关网站的链接？我下载了 Starkers 主题的副本并做了一个快速的操作`grep -ri promote .`，似乎该主题没有与生俱来的“提升”类。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-21T14:09:04.377

哎呀......对不起，我刚刚发现提升类在我创建的插件中。它不在斯塔克斯主题中。我的错。

# java - 在 JAAS Security 中创建一个可以传递用户名和密码的 URLConnection

> ID：937412
> 
> 赞同：2
> 
> 时间：2009-06-02T00:23:02.063
> 
> 标签：java, proxy, proxy-authentication

嗨，我有类似以下内容的内容，可以创建 URL 连接并检索数据。问题是，当我点击一个首先需要身份验证的页面时，我得到了登录页面。我不确定如何在 URLConnection 中传递用户名和密码。我正在访问一个使用 JAAS 身份验证的网站。

```
import java.net.URL;
import java.net.URLConnection;

.....

URL location = new URL("www.sampleURL.com");
URLConnection yc = location.openConnection();
BufferedReader in = new BufferedReader(
    new InputStreamReader(
    yc.getInputStream()));
String inputLine;
while ((inputLine = in.readLine()) != null) 
    data += inputLine + "\n";
in.close(); 
```

我试过这样的东西，但它似乎没有用......

```
URL url = new URL("www.myURL.com");
URLConnection connection = url.openConnection();
String login = "username:password";
String encodedLogin = new BASE64Encoder().encodeBuffer(login.getBytes());
connection.setRequestProperty("Proxy-Authorization", "Basic " + encodedLogin); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-02T08:09:50.583

尝试“授权”，而不是“代理授权”。当针对代理而不是您尝试访问的实际 Web 服务器进行身份验证时，将使用“Proxy-Authorization”标头。

# c# - 3 层架构和下拉列表等小细节

> ID：937415
> 
> 赞同：2
> 
> 时间：2009-06-02T00:23:48.240
> 
> 标签：c#, design-patterns

所以我以重构一个小应用程序为例来获得更多的实践。该应用程序（假设）的目的是从“注册新用户”表单中收集数据，并将其保存在数据库中。我唯一的限制是我必须使用一个特殊的自定义数据访问类，它直接与数据库通信并在 DataTable 对象中返回数据（如果适用）。

我有一个关于表单上的一些细节以及它们如何融入层架构的问题。例如，我的表单有一个从数据库提供的下拉列表，但同时下拉列表并不代表每个 SE 的对象（与作为对象的 User 不同，有一个类 User 有多个方法，数据成员等）。我不想在后面的代码中调用存储过程，但我也不希望过度抽象。

在不创建大量类抽象的情况下处理这些小细节的优雅方式是什么？

希望我很清楚

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T15:17:00.127

将非对象数据获取到 UI 的一种选择是创建一个或多个查找类，这些查找类是一个存储桶或“服务”，用于获取诸如下拉列表等之类的奇数位数据……

例子：

myDDL.DataSource = Lookup.GetAllCountries(); // GetAllCountries 是一个静态方法
// 设置名称/值字段等...
myDDL.DataBind();

使用这种方法，您仍然可以支持层分离。它不是面向对象或优雅的，但它非常实用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T00:30:22.593

有趣的是你应该问那个。我在[这里](https://stackoverflow.com/questions/686960/datatable-wrapper-or-how-to-decouple-ui-from-business-logic/686997#686997)解决了这个问题。

我回答的这些其他堆栈溢出问题显示了其他部分（切线相关）：

[从对象中获取 ListView 数据项](https://stackoverflow.com/questions/609276/listview-dataitem-shows-null)
[使用 ListView](https://stackoverflow.com/questions/583689/dictionaryt-of-listt-and-listviews-in-asp-net)
[在 DropDownList 中连接属性](https://stackoverflow.com/questions/595761/concatenating-two-properties-for-display-in-a-dropdownlist)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T00:31:12.687

我不知道什么是最佳实践，但我所做的是我有一个实用程序类，它有一个方法将 DropDownList 对象和枚举作为参数，所以我这样做了

FillDropDown(ddlistPhoneType, DropDownTypes.PhoneTypes);

实用程序类有时会从数据库中填充下拉列表，有时会从 XML 中填充，有时还会填充一些硬编码的值。但至少 GUI 不必担心这一点。

# java - 将 jvm 与应用程序捆绑在一起

> ID：937416
> 
> 赞同：2
> 
> 时间：2009-06-02T00:23:58.067
> 
> 标签：java, jvm, bundle

我如何捆绑一个精简的 JVM 来运行我的应用程序？

我想剥离 JVM，以便我可以将它包含在我的应用程序中。我知道 exe 包装器可以做到这一点，但我想知道的是如何做到的？这样我就可以编写脚本并为多个操作系统创建捆绑包，而不仅仅是 Windows。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T05:52:33.307

尽管从技术角度来看可能会剥离 JRE 发行版，但请仔细查看许可协议。对于 Java 6，它指出：

*[...] Sun 向您授予复制和分发软件的非排他性、不可转让、有限许可，且不收取任何费用，前提是 (i) 您分发的软件是完整的、未经修改的，并且仅作为一部分捆绑在一起，并且用于运行您的程序的唯一目的 [...]* {补充许可条款，(B)}

我会这样读：您只允许分发**完整**的（Sun）JRE 6（或 JDK 6）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-12-22T07:09:02.513

您可以大大**[减少 Java 应用程序的下载大小，](http://www.excelsior-usa.com/java-download-size.html)**同时保持对许可证的遵守。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-06-02T04:35:05.953

对于绝大多数用户（即安装了 Java 运行时的用户）来说，您不应该需要分发自己的自定义执行环境，实际上这样做违背了Java 的[“精神”](http://en.wikipedia.org/wiki/Write_once,_run_anywhere)。

`.exe`Java 代码设计为可在任何环境中运行，您可以通过创建[可执行文件`.jar`](https://stackoverflow.com/questions/5258159/how-to-make-an-executable-jar-file)轻松复制 Java 程序的双击运行行为。

这可能不是您正在寻找的答案，如果是这样，讨论许可剥离 JVM 的答案就是您所需要的。但是大多数 Java 开发人员应该没有必要跳过这样的圈子。只需分发您的 Jars 并让用户自己安装 Java 运行时。

# apache-flex - 为什么我的覆盖保护函数 createChildren 被忽略？

> ID：937420
> 
> 赞同：1
> 
> 时间：2009-06-02T00:24:24.917
> 
> 标签：apache-flex, actionscript-3

这是错误：

```
    TypeError：错误 #1009：无法访问空对象引用的属性或方法。
        在视图::ScoreBoard/setChipCount()[C:\Flex Builder 3\StackOverflowQuestion\src\view\ScoreBoard.as:32]
        在模型::MainDeckScoreBoard()[C:\Flex Builder 3\StackOverflowQuestion\src\model\MainDeckScoreBoard.as:21]
        在模型::MainDeckScoreBoard$cinit()
        在 global$init()[C:\Flex Builder 3\StackOverflowQuestion\src\model\MainDeckScoreBoard.as:5]
        在 main()[C:\Flex Builder 3\StackOverflowQuestion\src\main.mxml:13]
        在 _main_mx_managers_SystemManager/create()
        在 mx.managers::SystemManager/initializeTopLevelWindow()[C:\autobuild\3.2.0\frameworks\projects\framework\src\mx\managers\SystemManager.as:3188]
        在 mx.managers::SystemManager/ http://www.adobe.com/2006/flex/mx/internal::docFrameHandler ()[ C:\autobuild\3.2.0\frameworks\projects\framework\src\mx\经理\SystemManager.as:3064]
        在 mx.managers::SystemManager/docFrameListener()[C:\autobuild\3.2.0\frameworks\projects\framework\src\mx\managers\SystemManager.as:2916]
```

这是 main.mxml：

```
 <?xml version="1.0"?>
    <mx:Application
        xmlns:mx="http://www.adobe.com/2006/mxml"
        creationComplete="initApp()"
    >
        <mx:Script>
            <![CDATA[
                import model.MainDeckScoreBoard;

                public var _mainDeckScoreBoard:MainDeckScoreBoard = MainDeckScoreBoard.instance;

                private function initApp():void {
                    this.addChild(_mainDeckScoreBoard);
                }
            ]]>
        </mx:Script>
    </mx:Application> 
```

这是 MainDeckScoreBoard.as：

```
package model {
    import view.ScoreBoard;

    [Bindable]
    public dynamic class MainDeckScoreBoard extends ScoreBoard {

        /** Storage for the singleton instance. */
        private static const _instance:MainDeckScoreBoard = new MainDeckScoreBoard( SingletonLock );

        /** Provides singleton access to the instance. */
        public static function get instance():MainDeckScoreBoard {
            return _instance;
        }

        public function MainDeckScoreBoard( lock:Class ) {
            super();
            // Verify that the lock is the correct class reference.
            if ( lock != SingletonLock ) {
                throw new Error( "Invalid Singleton access.  Use MainDeckScoreBoard.instance." );
            }
            this.setChipCount("0");
        }

    } // end class
} // end package

class SingletonLock {
} // end class 
```

这是记分板.as：

```
package view {
    import mx.containers.HBox;
    import view.ScoreBoardLabel;
    import view.ChipCountContainer;
    import view.CardRankList;

    public dynamic class ScoreBoard extends HBox {

        /** The chip count. */
        public var _chipCount:ChipCountContainer;

        public function ScoreBoard() {

            super();

            this.width = 489;
            this.height = 40;
            this.setStyle("horizontalScrollPolicy", "off");
        }

        override protected function createChildren():void {

            super.createChildren();

            if(!_chipCount) {
                _chipCount = new ChipCountContainer();
                this.addChild(_chipCount);
            }
        }

        public function setChipCount(labelText:String):void {
            _chipCount._chipCountLabel.text = labelText;
            invalidateDisplayList();
        }
    }
} 
```

这是 ChipCountContainer.as：

```
package view {
    import mx.containers.Canvas;

    public dynamic class ChipCountContainer extends Canvas {

        /** The label. */
        public var _chipCountLabel:ChipCountLabel;

        public function ChipCountContainer() {

            super();

            this.width = 20;
            this.height = 20;
        }

        override protected function createChildren():void {

            super.createChildren();

            if(!_chipCountLabel) {
                _chipCountLabel = new ChipCountLabel();
                this.addChild(_chipCountLabel);
            }
        }
    }
} 
```

我有条不紊地四处移动并挥舞着无效的显示列表香，同时表演创造儿童舞蹈，但我只是成功地完全混淆了自己。我在 Flex 库中搜索了类似的结构，对我来说它看起来不错，但我想我只是不明白这个概念。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T01:00:35.653

我认为您混淆了实例化的顺序。即，如果要在组件的子组件初始化后使用 setChipCount，则应等待初始化事件触发，即：

```
 public dynamic class MainDeckScoreBoard extends ScoreBoard {

    ...

        public function MainDeckScoreBoard( lock:Class ) {
            super();
            // Verify that the lock is the correct class reference.
            if ( lock != SingletonLock ) {
                throw new Error( "Invalid Singleton access.  Use MainDeckScoreBoard.instance." );
            }

            // wait for the children to be created
            addEventListener(FlexEvent.INITIALIZE, onInitialize);
        }

        // executes when the children of this component have been created
        private function onInitialize(event:FlexEvent):void {
            this.setChipCount("0");
        }

    } // end class 
```

有关组件实例化生命周期的更详细说明，此 adobe 文档可能会有所帮助：

[http://livedocs.adobe.com/flex/3/html/help.html?content=components_06.html](http://livedocs.adobe.com/flex/3/html/help.html?content=components_06.html)

# c# - 接口和演员表

> ID：937423
> 
> 赞同：0
> 
> 时间：2009-06-02T00:25:59.267
> 
> 标签：c#

为什么这不起作用，以及如何解决？

```
public interface ITheInterface
{

  string a{get;set;}
  string b{get;set;}
}

public class SomeObject: ITheInterface
{
  string a{get;set;}
  string b{get;set;}
  ...
}

public class SomeGroup
{
  ITheInterface Result;
  ...   
}

 var results= from y in dc.Groups
              where y.id==1
              select new SomeGroup
                        {
                         Result= (from x in dc.Objects
                         select new SomeObject{... }
                        ).SingleOrDefault(),
                        }

 return results.ToList(); 
```

无法从类型转换`System.Collections.Generic.List`为接口

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T00:38:27.837

我想你的问题出在`Results.ToList()`电话上？它会失败，因为`ITheInterface`不支持`ToList()`. 您正在调用`SingleOrDefault()`LINQ 查询，它为您提供了一个项目。`ToList()`调用单个项目没有意义。

相反，如果您的代码如下所示：

```
IEnumerable<SomeObject> Results = from x in dc.Objects
                                     select new SomeObject{... }; 
```

然后，`Results.ToList()`会给你一个`List<SomeObject>`。

如果您实际上要寻找的是 a `List<ITheInterface>`，则可以这样做：

```
Results.Cast<ITheInterface>().ToList() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T01:41:55.477

你想说

```
SomeGroup result = results.SingleOrDefault()
return result; 
```

这是因为您的方法的返回类型是`SomeGroup`（我在推断）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T00:38:52.187

结果是单个对象；ToList() 仅适用于 Enumerables。

您需要编写`return new List { Results };`（这使用集合初始化程序）或摆脱对的调用`SingleOrDefault`并将结果声明为`IEnumerable<ITheInterface>`.

如果您只想要一个对象，为什么要返回一个列表？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T00:42:48.483

除了其他答案之外，当您实现接口时，您必须将成员函数声明为`public`：

```
public class SomeObject: ITheInterface
{
  public string a{get;set;}
  public string b{get;set;}
  ...
} 
```

# c# - 格式化难读的 try..catch..finally 块？

> ID：937426
> 
> 赞同：5
> 
> 时间：2009-06-02T00:27:38.577
> 
> 标签：c#, formatting, try-catch-finally

你是如何格式化你的`try..catch.finally`块的？尤其是当只将它包装在少量代码上时，它会破坏一切，使代码在我看来非常不可读和难看。

如：

```
try
{
     MyService service = new Service();
     service.DoSomething();
     return something;
}
catch (Exception ex)
{
     LogSomething();
     return somethingElse;
}
finally
{
     MarkAsComplete();
     service.Dispose();
} 
```

这 7 行代码变成了 16 行代码。

关于更好的`try..catch..finally`格式的任何建议？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-02T00:32:57.550

实际上，这对我来说非常好。如果您的实际代码看起来很像这样，那么我真的不会担心。很清楚发生了什么。

如果您的实际代码更复杂，请考虑将块分解为命名良好的方法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-07-15T22:30:58.920

您可以使用`using`block 而不是显式`Dispose()`，否则您可能必须在处理它之前检查 null ，`using`blocks 会为您执行此操作。不幸的是，它确实增加了嵌套 =/

```
try
{
     using(MyService service = new MyService()) 
     {
        service.DoSomething();
        return something;
     }
}
catch (SpecificException ex)
{
     LogSomething(ex);
     return somethingElse;
}
finally
{
     MarkAsComplete();
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-02T00:31:36.977

嗯，我认为这很好。其中一些进入了大括号放置辩论。你可以这样做：

```
try {
  //
} catch(Exception ex) {
  //
} finally {
  //
} 
```

我更喜欢你所拥有的。但是，您可能需要考虑将代码修改为只有一个 return 语句。我发现这是一个更好的设计。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-02T00:32:03.793

我在同一行使用括号格式化代码：

```
try {
   MyService service = new Service();
   service.DoSomething();
   return something;
} catch (Exception ex) {
   LogSomething();
   return somethingElse;
} finally {
   MarkAsComplete();
   service.Dispose();
} 
```

如果我想要更多间距，我更喜欢添加空行。这也可以作为逻辑代码块之间的分隔符。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-02T01:04:31.963

您可能会考虑容器（非常智能的工厂）和建议（处理所有杂乱的细节）。

```
Dear Mr. Container Sir,
Whenever I request from you an instance object of the interface ISomething,
    please construct for me an instance of the concrete class SomethingImpl;
    in addition, please see to it (however you do it) that, whenever I call a
    method on this instance, it is wrapped within a complicated and messy try-
    catch-finally which logs exceptions and mark calls as completed. That way,
    all I have to do is write the business logic that goes into the SomethingImpl
    and I don't have to worry about all the messy infrastuctural details.
Sincerely,
Mr. Agile. 
```

您可能会在代码中看到这一点：

```
//a class that knows how to take care of the messy infrastructure details
public class MyMessyInterceptor : IInterceptor {
    public void Intercept(IInvocation invocation) {
        //handle the messy details of continuing with the method-invocation,
        //but within a try-catch-finally that includes exception handling and
        //call logging.
    }
}

//a function that will configure a container (very smart factory)
public IContainer CreateContainer() {
    var builder = new ContainerBuilder();

    //tell the container-builder about the interceptor
    builder
        .Register(c => new MyMessyInterceptor())
        .Named("keep-my-code-clean")
    ;

    //tell the container what to do when you ask it for a ISomething
    builder
        .Register<SomethingImpl>()
        .As<ISomething>()
        .InterceptedBy("keep-my-code-clean")
    ;

    return builder.BuildContainer();
}

//some function out there in your code somewhere that needs to make a
//service call; there's hundreds of functions out there just like this
//in your code, and they all just got much simpler
public object GottaGoDoSomething() {
    //find the container
    var container = GetTheSingletonContainerObject();
    //ask for an instance of ISomething - it knows to provide a
    //SomethingImpl wrapped in an interceptor that takes care of all
    //the logging and exception handling
    var something = container.resolve<ISomething>();
    //call the big method
    return something.DoSomething();
    //magically (not really), the exception handling and logging are
    //already taken care of
} 
```

提出拦截器类只发生一次。注册每个拦截器和服务类也只发生一次。设置容器（非常智能的工厂）当然很复杂。

但是，代码中必须使用服务对象的每个地方，并且必须将其嵌入到复杂而混乱的基础设施细节中，例如异常处理和日志记录，都变得非常干净和简单。只有一个`CreateContainer`，但有数百个`GottaGoDoSomething`，所以这很容易，但代价是有点复杂。

（注意：代码示例使用 Autofac 容器框架和 Castle 拦截器框架。我知道这是服务定位模式的示例，而不是依赖注入模式，但重点是说明拦截器并将它们注册到一个容器，不是为了说明依赖注入。）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-02T00:29:58.413

空白。作为最低要求，我总是在每个 return 语句之前以及代码的“做事”和“创建变量”部分之间放置一行空格。

```
try
{
     MyService service = new Service();

     service.DoSomething();

     return something;

 }
catch (Exception ex)
{
     LogSomething();

     return somethingElse;

}
finally
{
     MarkAsComplete();
     service.Dispose();
} 
```

好多了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-02T00:48:33.073

我认为你的格式也很好读。我的建议是仅`catch`谨慎使用该语句。仅在您确实需要捕获某些东西时才使用它。否则，您可以让程序的其他部分处理异常。整个“早期失败”的概念。

```
try
{
    //do something that may throw an exception.
}
finally
{
    //handle clean up.
}

//let a method further down the stack handle the exception. 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-02T01:02:30.207

就个人而言，我倾向于在我的代码中遵循前面的风格......它为发表评论提供了空间，并更好地展示了我的逻辑流程。

我有一个宽屏，我打开它的一侧，所以空白可以让各个列很好地排列，并且不会对我造成太大伤害，因为我有这么多的屏幕空间......

```
try { // getting a service

     MyService service = new Service();
     service.DoSomething();

     return something;

}

catch (Exception ex) { // the fact that a service might be full/timedout

     LogSomething();

     return somethingElse;

} 

finally { // remove any resources the service may still hold.

     MarkAsComplete();
     service.Dispose();

} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-02T01:14:22.537

我也喜欢你原来的。.cs 文件中的物理行不会花费您任何费用，也不会更改最终输出代码。因此，请使用您需要的所有内容，以便为您或您的团队提供最佳的可读性。

事实上，您实际上应该尝试使用比您在编码时显示的 16 行更多的行数，方法是为自己或他人添加注释。

通过增加

```
// a comment that says what's going on 
```

通常，当您在 6 个月后重新使用该 Try.Catch 时，您可以更好地提醒自己该做什么。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-09-15T18:05:06.227

我总是尝试重构所有的 try catch 块，并将它们封装在自己的方法中。

这似乎总是让一切都更具可读性，而且让你的方法只做一件事是一种很好的编程实践。奇怪的是，如果您在 try-catch-finally 语句的上方和下方都有代码，那么您所做的不止一件事。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-06-03T18:35:25.593

如果您真的想摆脱**强制性**但*丑陋的格式*（是的，我同意：p）

去**Aspect Oriented Programming**，你会得到 try...catch...finally 免费嵌入到你的程序集中并自动记录异常。

试试[PostSharp](https://www.postsharp.net/)或[Spring.Net](http://www.springframework.net/)

# activerecord - ActiveRecord::Base 无表

> ID：937429
> 
> 赞同：23
> 
> 时间：2009-06-02T00:28:19.463
> 
> 标签：activerecord, ruby-on-rails-2

这在不久前出现（[rails 模型属性在 db 中没有相应的列](https://stackoverflow.com/questions/399490)），但看起来提到的 Rails 插件没有维护（[http://agilewebdevelopment.com/plugins/activerecord_base_without_table](http://agilewebdevelopment.com/plugins/activerecord_base_without_table)）。有没有办法用 ActiveRecord 做到这一点？

如果没有，有没有办法在不使用 ActiveRecord 的情况下获取 ActiveRecord 验证规则？

ActiveRecord 当然希望表存在。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-06-02T10:10:08.297

这是我过去使用的一种方法：

在**app/models/tableless.rb**

```
class Tableless < ActiveRecord::Base
  def self.columns
    @columns ||= [];
  end

  def self.column(name, sql_type = nil, default = nil, null = true)
    columns << ActiveRecord::ConnectionAdapters::Column.new(name.to_s, default,
      sql_type.to_s, null)
  end

  # Override the save method to prevent exceptions.
  def save(validate = true)
    validate ? valid? : true
  end
end 
```

在**app/models/foo.rb**

```
class Foo < Tableless
  column :bar, :string  
  validates_presence_of :bar
end 
```

在**脚本/控制台中**

```
Loading development environment (Rails 2.2.2)
>> foo = Foo.new
=> #<Foo bar: nil>
>> foo.valid?
=> false
>> foo.errors
=> #<ActiveRecord::Errors:0x235b270 @errors={"bar"=>["can't be blank"]}, @base=#<Foo bar: nil>> 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-06-02T02:56:42.503

验证只是 ActiveRecord 中的一个模块。您是否尝试将它们混合到您的非 ActiveRecord 模型中？

```
class MyModel
  include ActiveRecord::Validations

  # ...
end 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-11-29T23:37:30.537

我认为答案越多越好，因为这是在谷歌搜索“没有表格的 Rails 3.1 模型”时的第一个结果之一

我在不使用 ActiveRecord::Base 的情况下实现了同样的事情，同时包含了 ActiveRecord::Validations

主要目标是让一切都以形式进行，下面我提供了一个示例付款，它不会保存在任何地方，但仍然能够使用我们都知道和喜爱的验证进行验证。

```
class Payment
  include ActiveModel::Validations
  attr_accessor :cc_number, :payment_type, :exp_mm, :exp_yy, :card_security, :first_name, :last_name, :address_1, :address_2, :city, :state, :zip_code, :home_telephone, :email, :new_record

  validates_presence_of :cc_number, :payment_type, :exp_mm, :exp_yy, :card_security, :first_name, :last_name, :address_1, :address_2, :city, :state

  def initialize(options = {})
    if options.blank?
      new_record = true
    else
      new_record = false
    end
    options.each do |key, value|
      method_object = self.method((key + "=").to_sym)
      method_object.call(value)
    end
  end

  def new_record?
    return new_record
  end

  def to_key
  end

  def persisted?
    return false
  end
end 
```

我希望这对某人有所帮助，因为我今天花了几个小时试图弄清楚这一点。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-12-17T15:55:39.810

**更新：**对于 Rails 3，这可以很容易地完成。在 Rails 3+ 中，您可以使用新`ActiveModel`模块及其子模块。现在应该可以了：

```
class Tableless
  include ActiveModel::Validations

  attr_accessor :name

  validates_presence_of :name
end 
```

有关更多信息，您可以查看有关该主题的[Railscast](http://railscasts.com/episodes/219-active-model)（或[在 AsciiCasts 上阅读](http://asciicasts.com/episodes/219-active-model)），以及[Yehuda Katz 的这篇博客文章](http://yehudakatz.com/2010/01/10/activemodel-make-any-ruby-object-feel-like-activerecord/)。

**旧答案如下：**

您可能需要将此添加到解决方案中，由 John Topley 在之前的评论中提出：

```
class Tableless

  class << self
    def table_name
      self.name.tableize
    end
  end

end

class Foo < Tableless; end
Foo.table_name # will return "foos" 
```

如果您需要，这会为您提供一个“假”表名。如果没有这种方法，`Foo::table_name`将评估为“tablelesses”。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-08-14T17:02:33.810

只是对已接受答案的补充：

使您的子类继承父列：

```
class FakeAR < ActiveRecord::Base
  def self.inherited(subclass)
    subclass.instance_variable_set("@columns", columns)
    super
  end

  def self.columns
    @columns ||= []
  end

  def self.column(name, sql_type = nil, default = nil, null = true)
    columns << ActiveRecord::ConnectionAdapters::Column.new(name.to_s, default, sql_type.to_s, null)
  end

  # Overrides save to prevent exceptions.
  def save(validate = true)
    validate ? valid? : true
  end
end 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-10-25T20:53:15.650

这是一个搜索表单，它显示了一个称为*条件*的对象，该条件具有一个嵌套的*句*点对象，其中包含*开始*和*结束*属性。

控制器中的操作非常简单，但它会从表单上的嵌套对象加载值，并在必要时使用错误消息重新呈现相同的值。

在 Rails 3.1 上工作。

该模型：

```
class Criteria < ActiveRecord::Base
  class << self

    def column_defaults
      {}
    end

    def column_names
      []
    end
  end # of class methods

  attr_reader :period

  def initialize values
    values ||= {}
    @period = Period.new values[:period] || {}
    super values
  end

  def period_attributes
    @period
  end
  def period_attributes= new_values
    @period.attributes = new_values
  end
end 
```

在控制器中：

```
def search
  @criteria = Criteria.new params[:criteria]
end 
```

在助手中：

```
def criteria_index_path ct, options = {}
  url_for :action => :search
end 
```

在视图中：

```
<%= form_for @criteria do |form| %>
  <%= form.fields_for :period do |prf| %>
    <%= prf.text_field :beginning_as_text %>
    <%= prf.text_field :end_as_text %>
  <% end %>
  <%= form.submit "Search" %>
<% end %> 
```

生成 HTML：

```
<form action="/admin/search" id="new_criteria" method="post">
  <input id="criteria_period_attributes_beginning_as_text" name="criteria[period_attributes][beginning_as_text]" type="text"> 
  <input id="criteria_period_attributes_end_as_text" name="criteria[period_attributes][end_as_text]" type="text"> 
```

**注意**：助手提供的动作属性和嵌套属性命名格式使得控制器一次加载所有值变得如此简单

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-02-20T14:12:16.240

有[activerecord-tableless gem](https://github.com/softace/activerecord-tableless)。它是创建无表 ActiveRecord 模型的宝石，因此它支持验证、关联和类型。它支持 Active Record 2.3、3.0、3.2

在 Rails 3.x 中推荐的方法（使用 ActiveModel）不支持关联或类型。

# oracle - oracle对象中的关系？

> ID：937434
> 
> 赞同：0
> 
> 时间：2009-06-02T00:28:54.063
> 
> 标签：oracle, object

如何在 oracle 对象中建立关系 1 到 n 和 n 到 n？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T03:11:04.440

[编辑] 我相信这个问题是指 Oracle Objects for OLE (OO40) [/EDIT]

对于此示例，请考虑 order 和 line_item 之间的一对多关系。（一个订单可能有零个、一个或多个 line_item，并且一个 line_item 只与一个订单相关联。）我们跳过了所有的建模步骤，并了解了定义的外观。

一种选择是使用参考：

```
create type order_typ as object
( id    integer
, ...
);

create table order_obj_table of order_type;

create table line_item
( order_ref ref order_typ scope is order_obj_table
, ...
); 
```

另一种选择是使用嵌套表（称为集合类型）：

```
create type line_item_typ as object
( id  integer
, ...
);

create type line_item_collection_typ as table of line_item_typ;

create type order_typ as object
( id          integer
, line_items  line_item_collection_typ 
, ...
); 
```

**[编辑]**

附录：

托尼安德鲁斯（相当合理地）问为什么要使用“嵌套表”。Tony 指出生成的数据库结构将“更难访问”，他的意思是（我认为）所需的查询结构是“非标准”SQL。

坦率地说，我想不出使用嵌套表的充分理由，但我至少必须承认 OO4O 确实提供了对嵌套表的支持。

为什么会选择使用OO4O呢？通过避免 ODBC 或 OLE 产生的开销的本机驱动程序，它（表面上）提供了针对 Oracle 数据库的改进性能。它也是专门针对 Oracle 的技术，针对 OO4O 接口编写应用程序意味着应用程序本质上将绑定到 Oracle 数据库，如果应用程序不需要支持多个（可互换的）数据库引擎，这可能是可以的。

有关 OO4O 的更多信息和示例，请访问 Oracle 网站：

[http://www.oracle.com/technology/tech/windows/ole/index.html](http://www.oracle.com/technology/tech/windows/ole/index.html)

**[/编辑]**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T01:01:15.170

除非“Oracle 对象”是某种产品（大写字母有助于区分普通单词和产品名称），否则您的操作方式与在任何其他 DBMS 中的操作方式相同。

对于 1:n 关系：

```
CREATE TABLE Master
(
    PK_Column    <sometype> NOT NULL PRIMARY KEY,
    ...
);
CREATE TABLE Detail
(
    FK_Column    <sometype> NOT NULL REFERENCES Master,
    OtherColumn  <anothertype> NOT NULL,
    PRIMARY KEY (FK_Column, OtherColumn),
    ...
); 
```

对于 n:m 关系：

```
CREATE TABLE TableN
(
    N_Identifier  <sometype> NOT NULL PRIMARY KEY,
    ...
);
CREATE TABLE TableM
(
    M_Identifier  <anothertype> NOT NULL PRIMARY KEY,
    ...
);
CREATE TABLE CrossRef
(
    N_Identifier  <sometype>    NOT NULL REFERENCES TableN,
    M_Identifier  <anothertype> NOT NULL REFERENCES TableM,
    PRIMARY KEY (N_Identifier, M_Identifier),
    ...
); 
```

SQL 语法或多或少与 DBMS 无关（它应该关闭 SQL 标准语法）。

# iphone - 我应该担心 NSUserDefaults 中的冲突吗？

> ID：937438
> 
> 赞同：0
> 
> 时间：2009-06-02T00:30:24.983
> 
> 标签：iphone, objective-c, cocoa, cocoa-touch

在我正在处理的应用程序中，我正在生成用户名和密码并将它们存储在`[NSUserDefaults standardUserDefaults]`. 我知道您可以从那里检索一些系统范围的信息；这是否意味着手机上的所有应用程序都可以访问其中的所有内容？我目前在其中使用的键前面加上一些与我的应用程序名称相关的字符串，以避免与其他应用程序冲突，但这有必要吗？如果是这样，有没有更好的方法来避免这种碰撞？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-02T01:27:28.127

您还应该将用户名和密码存储在钥匙串中，而不是用户默认值中。在将数据备份到他们的 Mac 时，将它们存储在用户默认值中会打开它们以进行窥探。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T00:51:45.673

不。NSUserDefaults 不是系统范围的。给他们起任何你喜欢的名字，你会没事的。:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T01:29:24.050

NSUserDefaults 使用“搜索路径”的抽象概念来查找默认值。除非您自定义它，否则标准用户默认对象将在三个地方查找；启动参数、应用程序的首选项和系统首选项（例如全局本地化选项）。如果您想在多个应用程序之间共享相同的首选项，您还可以手动添加其他搜索路径的标识符（我没有在 iPhone 上尝试过，所以我不确定它是否可以在 Cocoa Touch 上使用，或者如果您只能在 OS X 上执行此操作）。

您可能会与系统范围的首选项之一发生冲突，但由于首先搜索您的应用程序的搜索路径，因此这绝不是问题。

# css - css中有很多背景图像会影响性能吗？

> ID：937439
> 
> 赞同：2
> 
> 时间：2009-06-02T00:30:52.547
> 
> 标签：css, performance, background-image, css-sprites

一些用户报告说我的网站太慢了我认为 css 中的背景图片可能是罪魁祸首

我有一个使用自定义构建系统连接所有 css、压缩它们（yui 压缩器）、自动制作 css sprites（smartsprites）的站点，我最终得到了整个页面的 9kb CSS，这包括背景图像的所有 css最后是 d 他们大约 60 岁（几个去同一个精灵不知道有多少）

我想知道浏览器的默认行为是根据需要下载图像（当它们与选择器匹配时）或全部下载。

现在firefox中的firebug似乎表明它们都已被下载。你会建议我用什么技术来避免这个问题，或者减轻它。

编辑：我误读了萤火虫，正在下载的图像属于隐藏的 lightview，但背景图像与 dom 匹配。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T08:51:28.500

不，实际上将它们放在 CSS 中比放在标记中更好。

图像调用不会阻塞页面，并且随着图像的加载，它们将呈现在页面上，因此总体而言，通过 CSS 加载它们是一个好主意。更不用说这种设计也更加灵活。

（不用说，这些图像中的每一个都会占用带宽和额外的 HTTP 请求）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T00:36:30.057

默认浏览器行为是一次下载两个项目（即 2 个 http 请求），如果您认为您有很多图像，请为您的图像创建一个子域，`images.yoursite.com`您将开始看到浏览器发出并行请求，您可以看到性能上的一些改进

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T11:31:00.380

（副题。没有真正回答你的问题。但可能很有趣甚至相关。）

我认为另一个可能的罪魁祸首是“某些用户”总是会觉得您的网站“太慢”。（也许这更像是精神崩溃而不是 Stack Overflow 的事情？这些用户认为什么是快速站点？他们能举个例子吗？他们的连接和计算机有多快？他们在哪里，你的服务器在哪里？*到底*是什么慢？注册过程？看高清视频？滚动窗口？加载 Firefox？毕竟，这是人类.. n'est pas？）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T00:47:42.467

也许仔细看看你发送的图像，特别是如果有很多它们被编译成一个单一的“精灵”图像。

可能发生的是您指向的图像非常大。当然，它应该只加载一次（sprite 方法的好处），但如果它是几百 KB，它肯定会导致一些性能问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-03T21:52:40.180

有一个不错的 Firefox 插件，名为 Yslow，它为您提供了一些有关性能优化的有用信息。它向您显示它检测到的性能问题，并为您提供指向建议改进的文章的链接。 [http://developer.yahoo.com/yslow/](http://developer.yahoo.com/yslow/)

有关最佳实践的一些信息 [http://developer.yahoo.com/performance/rules.html](http://developer.yahoo.com/performance/rules.html)

# javascript - 功能类似于 jQuery 的模块化 Javascript 库

> ID：937443
> 
> 赞同：0
> 
> 时间：2009-06-02T00:31:39.830
> 
> 标签：javascript, jquery, dom

jQuery 和类似的库为 DOM 遍历和操作提供了许多有用的 API。当您的网站有大量重复访问者时，他们的使用很容易证明是合理的，因为缓存将抵消最终用户的任何带宽成本。

在其他情况下，站点的访问者可能始终是唯一的，因此这些库的带宽损失相对于开发团队的收益而言可能过于严重。

是否有任何库提供这种风格的 DOM 交互，同时允许您选择与页面相关的部分。

例如，

```
jQuery('#myId').addClass('error'); 
```

jQuery 中的许多其他 API 可以在几行代码中复制，从而避免了大约 50kB 的下载量。

所以问题是，是否存在包含这些函数且对库的其他方面几乎没有依赖的库，或者我是否需要根据需要自己创建它们？

是否有可用的机制/工具将现有的库（如 jQuery）分解成最小的组件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-02T00:36:12.193

[正如这里](https://stackoverflow.com/questions/936399/should-i-link-to-google-apis-cloud-for-js-libraries/936419#936419)所讨论的，如果您使用 google 作为库的主机，则用户可能在访问您的站点之前已经将其缓存。

[此页面](http://code.google.com/apis/ajaxlibs/)向您显示支持哪些库。目前：

*   jQuery
*   jQuery 用户界面
*   原型
*   脚本.aculo.us
*   MooTools
*   道场
*   SWFObject*新！*
*   雅虎！用户界面库 (YUI)*新！*

* * *

我完全支持你自己，但如果你不使用库，请确保你知道所有浏览器版本的所有错误。

不过，这不是一个坏主意。如果您可以创建自定义版本的 jQuery，那就太好了。我特别喜欢 iPhone 的 Mobile Safari 和 Adob​​e AIR，它去掉了所有非 webkit 的东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-02T00:37:59.833

jQuery 的生产版本是 19k，相当于一个相当小的图像。在我的书中没有严重的带宽惩罚！

**编辑**：..也值得每 k 。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T02:40:10.850

MooTools 允许您只下载您想要的部分。因此，如果您想要的只是 JSON AJAX 请求就足够了，那么您就可以了。

[http://mootools.net/core](http://mootools.net/core)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-09T04:50:51.030

抱歉，我不知何故丢失了询问 JS 库冲突解决方案的页面。

我有同样的问题，但现在我在玩了一些 JQuery 脚本后解决了它。*我知道**有点痛苦，但让我们一步一步来。

首先让我告诉你，在我的项目中，我使用了两个不同的库。我正在使用 Lightwindow 和 JQuery。我无法使两个库都正常运行，但我想出了以下脚本。您必须在每个要使用 JQuery 函数的函数中使用此脚本：

//这一行说，美元符号 $ 属于 JQuery 库。

jQuery(document).ready(function($) { //你的源代码在这里。

});

让我们稍微详细地使用它。在我的场景中，我有一个点击按钮，假设调用以下函数：

```
 function popups(message, heading, actionlink, linkName) { 
```

//这是告诉源代码的其余部分 // 识别 JQuery 函数的 LINE。

```
 jQuery(document).ready(function($) {

            // get the screen height and width    
            var maskHeight = $(document).height();    
            var maskWidth = $(window).width();  

            // assign values to the overlay and dialog box  
            $('#dialog-overlay').css({height:maskHeight, width:maskWidth}).show();  
            $('#dialog-box1').show();  

            // display the message  
            $('#dialog-message-row').html(message);  
            $('#dialog-message-heading').html(heading);  
            $('#dialog-message-actionlink').html("<a onclick=function('x') class='button' id='delete'>"+linkName+"</a>");

           });//CLOSE JQuery translator
        } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-02T00:37:03.313

看看[狡猾](http://digitarald.de/journal/89737433/rolling-out-sly-the-javascript-selector-engine/)的。只有 3kB。

# database - 有效使用 ms-access 的资源

> ID：937451
> 
> 赞同：0
> 
> 时间：2009-06-02T00:33:56.347
> 
> 标签：database, winforms, ms-access, vba

**更新：管理层看到了曙光，我们将使用 php 和 mysql。谢谢你的帮助。**

主题：Access 2007

如果是我的选择，我会用 perl 和 mysql 编写一个基于 Web 的应用程序……但是高层对计算机并不擅长，并且对 microsoft excel 的了解比对命令行的了解更多。他们擅长组织和解决问题，而不是编程和数据库。

*话虽如此，我基本上继承了一个已完成一半的项目。我只是一个具有一定编程经验的帮助台技术人员，目前我是唯一一个对编程有任何了解并且能够从事它的人。*

通过将所有内容都包含在一个简单的访问文件中，他们可以对其进行备份和版本控制等......它不涉及运行任何服务器或拥有任何特殊程序（我们所有的机器都可以访问，在站点许可证上）。它**适用于库存系统**，我们在其中扫描条形码并输入位置、型号、所有者等信息。我们的想法是我们可以在添加东西时移植这个小东西。超越了我们之前拥有的简单 excel 文件。

所以我的问题是，**我对访问的经验很少，而且我需要为它制作各种精美的表格和报告。** 我已经做了非常非常少的 VB6，但不知道我的方式值得豆。

我之前的人建立了一个像样的小数据库，**我负责制作一个可用的前端**。

**请帮我提供资源**。与最佳实践、gui 指南等有关的东西将是一个加分项。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T01:08:28.320

我在一个大型 Access 项目上做了几年的开发。在某些方面，在 Access 中开发业务应用程序比在 VB6 中更容易。您拥有内置的数据绑定、可视化查询创建和出色的报表功能等等。但是，在开始之前，您应该了解有关 Access 的一些事项：

1.  Access 背后的数据库引擎不能很好地扩展。除非这是一个具有少数（理想情况下少于 5 个）并发用户的小型应用程序，否则您最终会将数据移植到 SQL Server（这并不像听起来那么困难）。

2.  数据表必须保存在与实际应用程序 MDB 不同的 MDB 文件中。这是通过对数据 MDB 使用“链接表”来完成的。

如果您刚刚开始使用 Access，那么您真的应该买一本好书。关于构建 Access 应用程序的权威性工作曾经是 Access [2002 Desktop Developer's Handbook](https://rads.stackoverflow.com/amzn/click/com/0782140092)。值得注意的是，从那时起，Access 的核心部分（除了功能区）没有太大变化。这本书有一个名为[Access 2002 Enterprise Developer's Handbook](https://rads.stackoverflow.com/amzn/click/com/0782140106)的同伴，任何构建具有两个以上用户的应用程序的人都需要阅读。

如果您以前从未使用过 Access，并且不熟悉 Windows 风格的编程，那么您还没有准备好阅读这些书籍。有很多好的（和当前的）书籍可以教授基础知识。我之所以提到这两本书，是因为如果您对 Access 中的开发有任何疑问，答案可能在这两本书的其中一本中。

因此，如果您的老板真的要强迫您这样做，请让他为这两本书跃跃欲试。

最后，Access 编程中不可缺少的网络资源：

[http://mvps.org/access/](http://mvps.org/access/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T01:26:49.063

我找到的最好的资源可能是[Access 97 Developers Handbook](https://rads.stackoverflow.com/amzn/click/com/0782119417)（真正的瑰宝）。

这些也非常好：

*   [访问网络](http://mvps.org/access/)

*   [托尼·托斯访问页面](http://www.granite.ab.ca/accsmstr.htm)

*   [更好地访问应用程序的 SSW 规则](http://www.ssw.com.au/ssw/Standards/Rules/RulestoBetterAccessApplications.aspx)

*   [更好地访问 UI 的 SSW 规则](http://www.ssw.com.au/ssw/Standards/Rules/RulesToBetterAccessUI.aspx)

*   [更好地访问数据库的 SSW 规则](http://www.ssw.com.au/ssw/Standards/Rules/RulesToBetterAccessDatabases.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T00:42:42.180

我很确定 2007 版附带了许多方便的向导，它们将为您完成大部分工作。在让自己从事一堆不必要的体力劳动之前，试着处理好这些问题。

编辑：了解如何创建查询。然后，您可以将您的查询传输到不同的报告中，它应该允许您做任何事情。如果您需要更多的自定义...嗯...您将学习一些 VB 并开始使用 Access。这可能比我们在这里可以为您提供的帮助更多。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-02T01:37:58.637

这是我喜欢的一个网站……它[在 SQL Server 中如何做事与在 Access 中如何做事](http://sqlserver2000.databases.aspfaq.com/what-are-the-main-differences-between-access-and-sql-server.html)之间有一个映射。因此，如果您知道如何在 TSQL 中执行此操作，但在 Access 中无法弄清楚，此站点非常有帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-02T02:46:19.810

你有一些很好的答案。跟进 Robert Harvey 关于将数据库拆分为前端 (FE) 并将表链接到后端 (BE) 的评论。

前端 (FE) 包含指向表、查询、表单、报告、宏（如果有）和 VBA 代码的链接。后端 (BE) 包含表、索引、关系和一个启动表单，告诉用户不要考虑进行任何更改并立即退出

您真的想将 FE 放在每台机器上或放置在服务器上的用户特定目录中。当用户更改相同的表单记录源、过滤器等以及损坏时，这将有助于避免一些奇怪的错误消息。使用更改的查询、表单、报告和 VBA 代码来实现新版本的数据库也容易得多。

我专门创建了 Auto FE Updater 实用程序，以便我可以根据需要随时更改 FE MDE，并且非常有信心下次有人运行该应用程序时它会引入最新版本。有关错误或实用程序的更多信息，请访问我的网站上的[http://www.granite.ab.ca/access/autofe.htm](http://www.granite.ab.ca/access/autofe.htm)，以使每台 PC 上的 FE 保持最新。

在终端服务器或 Citrix 环境中，自动 FE 更新程序支持在服务器上创建以用户命名的目录。如果可以选择将 FE 放在 Citrix 服务器上，以减少网络流量并避免通过网络加载可能有些缓慢的对象。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-02T03:02:45.017

这个网站有一些很好的视频培训，让我快速了解 2007 版。

[http://www.keystonelearning.com/](http://www.keystonelearning.com/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-02T04:09:50.580

我发现花了几个小时阅读一本关于数据库设计的好介绍性书籍（来自本地图书馆）确实帮助我理解了很多已经存在的帮助。以及帮助文档中的概念。我仍然不是数据库专家，但至少我对设计数据库的意义以及它对 IT 的重要性有了更好的理解。（我以前认为这意味着硬件管理和软件安装）。

# programming-languages - 如何以减少完全返工可能性的方式实现代码

> ID：937457
> 
> 赞同：7
> 
> 时间：2009-06-02T00:36:40.053
> 
> 标签：programming-languages, modularity

由于一个小的规格更改结果证明没有正确指定规格，我丢掉了一项工作。[如果它在项目开始时就完成了，那么一开始就不需要](https://stackoverflow.com/questions/923545/)大部分工作。

有哪些好的技巧/设计原则可以防止这些事情发生？

或者减少为了实现功能请求或在实现过程中进行设计更改所需的代码返工量？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-02T00:39:12.513

模块化。制作能够很好地完成工作的小代码块。然而，这仅仅是开始。它通常是导致代码如此糟糕以至于需要彻底返工的因素的大量组合。从高度不稳定的需求、糟糕的设计、缺乏代码所有权，等等，不胜枚举。

添加到其他人提出的内容：沟通。
你和客户、你和管理层、你和其他开发人员、你和你的 QA 部门之间的沟通，每个人之间的沟通是关键。确保管理层了解合理的时间框架，并确保您和客户都准确了解您的建筑物是什么。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-02T00:45:12.020

花时间与您构建产品的客户保持开放的沟通。制定里程碑并设置时间在每个里程碑向客户展示项目。即使客户在展示里程碑时对它完全失望，您也可以从头开始，从最后一个里程碑重新开始。正如 Csunwold 所说，这还要求您的工作构建在彼此独立工作的块中。

点...

1.  保持开放的沟通
2.  对产品进步坦诚相待
3.  愿意每天根据客户业务需求和产品变更规格进行更改。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-02T02:33:46.980

正如已经说过的那样，模块化就是答案。但在实践中使用它可能是一个很难的答案。我建议重点关注：

*   做好预定义工作的小型库
*   模块之间的最小依赖

首先编写接口是实现这两者的好方法（使用用于依赖项的接口）。接下来，在编写代码之前针对接口编写测试，通常会突出显示非模块化的设计选择。

我不知道你的应用是否是 UI 密集型的；这会使模块化变得更加困难。它通常仍然值得付出努力，但如果不是，那么假设它很快就会被丢弃并遵循冰山原则，即 90% 的工作与 UI 无关，因此更容易保持模块化。

最后，我推荐 andrew Hunt 和 dave thomas 的“实用程序员”，因为它充满了技巧。我个人最喜欢的是 DRY——“不要重复你自己”——任何说同一件事两次的代码都有味道。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-02T01:02:12.843

软件需求发生变化，除了与客户更频繁的交互外，没有什么可以做的。

然而，人们可以构建在面对变化时更加健壮的代码。它不会使您免于丢弃满足不再需要的要求的代码，但可以减少此类更改的影响。

例如，只要适用，请使用接口而不是类（或您的语言中的等价物），并避免向接口添加操作，除非您绝对确定需要它们。通过以这种方式构建程序，您不太可能依赖特定实现的知识，并且您不太可能实现不需要的东西。

这种方法的另一个优点是您可以轻松地将一种实现换成另一种。例如，有时为您的原型编写最愚蠢的（效率上）但最快的编写和测试实现是有回报的，并且只有在原型是产品的基础并且实际上是性能时才用更智能的东西代替它很重要。我发现这是一种非常有效的方法来避免过早的优化，从而丢弃东西。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-02T01:13:04.630

*   小迭代

*   经常迭代

*   迭代之间的测试

*   尽快得到一个简单的工作产品，以便客户可以提供输入。

基本上假设***东西会被扔掉，所以适当地编码***，并且不要深入到让它被扔掉的东西会花费很多时间。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-02T02:44:45.880

天，

浏览此处的其他答案，我注意到每个人都在提到您的下一个项目要做什么。

不过，似乎缺少的一件事是进行清洗以找出规范的原因。不同步。以客户实际需求为准。

我只是担心，如果您不这样做，无论您采用何种方法来实施您的下一个项目，如果您仍然存在实际需求和规范之间的不匹配。对于您的下一个项目，您将再次处于相同的情况。

这可能是简单的沟通不畅或客户需求蔓延之类的事情。

但至少如果你知道原因并且你可以尝试帮助减少它再次发生的机会。

不要敲其他答案在说什么，那里有一些很棒的东西，但请从发生的事情中吸取教训，这样你就不会被谴责重复它。

高温高压

干杯，

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-02T02:58:50.097

有时重写是最好的解决方案！
如果您正在为相机编写软件，您可以假设下一个版本也将进行视频、立体视频或 3D 激光扫描，并包含所有这些功能的所有挂钩，或者您可以编写这样一个通用的可扩展宇航员架构，它可以应对包括喷气发动机在内的下一台相机——但它会在金钱、资源和性能上花费如此多的成本，你可能最好不这样做。

在新角色中完全重写新功能并不总是一个坏主意。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-02T00:49:05.613

就像 csunwold 所说，模块化你的代码非常重要。编写它以便如果一个部分容易出错，它不会弄乱系统的其余部分。这样，您可以调试单个错误部分，同时能够安全地依赖其余部分。

除此之外，文档是关键。如果你的代码被整齐清晰的注释，那么在未来对你或任何碰巧正在调试的人来说，重新编写它将会变得无比容易。

使用源代码控制也很有帮助。如果您发现一段代码不能正常工作，总有机会恢复到过去的健壮迭代。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-02T00:52:45.670

尽管它并不直接适用于您的示例，但在编写代码时，我会尽量留意我可以看到软件在未来发展的方式。

基本上，我试图预测软件将走向何方，**但**至关重要的是，我抵制实施任何我能想象到的事情的诱惑。我所追求的只是尝试让 API 和接口支持可能的未来而不实现这些功能，希望这些“可能的场景”能帮助我提出更好、更面向未来的接口。

当然并不总是有效。

# c# - 简单的客户端/服务器、TCP/IP 加密消息流、SSL

> ID：937459
> 
> 赞同：7
> 
> 时间：2009-06-02T00:37:44.373
> 
> 标签：c#, ssl, client, tcp

编写一个小的 TCP/IP 客户端服务器应用程序。基本上它会创建一个服务器，然后您可以创建几个不同的客户端并设置一些聊天会话。我想知道是否有任何方法可以使用标准.net 库进行某种形式的加密？

m_mainSocket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);

有没有使用 rsa 指定 tcp 的方法？

或者您（我就是）是否必须编写一些自定义库来进行密钥交换，然后加密随后的聊天消息？我以前为 uni 做过，但那是在 java 中，但我知道转换它们并不难。只是试图不必重新发明轮子......

或者使用 ssl 怎么样？

谢谢，罗恩。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-06-02T01:21:40.260

加密通信的最简单方法是将整个套接字流包装在[SslStream](http://msdn.microsoft.com/en-us/library/system.net.security.sslstream.aspx)中。

这可以直接与 TcpClient/TcpListener 一起使用，因此使用它来加密数据流非常容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T01:47:40.833

只需将其包装在一个库或 SSL 隧道应用程序中即可。

# sql - 需要一些有关 Sql Server 和简单触发器的帮助

> ID：937468
> 
> 赞同：2
> 
> 时间：2009-06-02T00:39:23.823
> 
> 标签：sql, sql-server-2008, triggers

我希望触发，但我不确定如何获取触发触发的数据。

我有一张简单的桌子。

```
FooId INT PK NOT NULL IDENTITY
Name VARCHAR(100) NOT NULL 
```

我希望有一个触发器，以便在发生 UPDATE、INSERT 或 DELETE 时执行以下操作。

### 伪码

```
IF INSERT
    Print 'Insert' & Name
ELSE IF UPDATE
    Print 'Update' & FooId & Name
ELSE IF DELETE
    Print 'Delete' & FooId & Name 
```

现在，我知道如何为表格制作触发器了。我不知道该怎么做是根据触发器类型找出值。

任何人都可以帮忙吗？

### 编辑：不确定是否有帮助，但 db 是 Sql Server 2008

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-02T00:46:18.727

伪表“已插入”包含新数据，“已删除”表包含旧数据。

你可以做类似的事情

```
create trigger mytrigger on mytable for insert, update, delete
as
    if ( select count(*) from inserted ) > 0
        -- insert or update
        select FooId, Name from inserted
    else
        -- delete
        select FooId, Name from deleted 
```

为了澄清其他人所做的所有评论，在插入时，*插入*的表包含数据并且*删除*的是空的。在删除时，情况正好相反。在更新时，*deleted*和*insert*包含任何更新行的“之前”和“之后”副本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T01:09:05.170

当您编写触发器时，您必须考虑到您的触发器可能被一次影响不止一行的语句调用。

正如其他人指出的那样，您引用**插入**的表来获取更新或插入行的新值的值，并且引用已删除的表来获取**已删除**行的值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T00:42:52.883

SQL 触发器提供了一个名为“inserted”的隐式定义表，它返回受影响的行，允许您执行以下操作

```
UPDATE mytable SET mytimestamp = GETDATE() WHERE id IN (SELECT id FROM inserted) 
```

关于您的代码示例，如果您为每个触发器执行单独的操作，您将需要创建单独的 INSERT、UPDATE 和 DELETE 触发器。

（至少，在 SQL Server 中是这种情况……您没有指定平台。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T00:59:18.510

在 2008 年，还有 MERGE 命令。你想怎么处理？

从 2008 年开始，您可以使用以下四种命令修改表：INSERT、UPDATE、DELETE 和 MERGE：

[http://blogs.conchango.com/davidportas/archive/2007/11/14/SQL-Server-2008-MERGE.aspx](http://blogs.conchango.com/davidportas/archive/2007/11/14/SQL-Server-2008-MERGE.aspx)

[http://sqlblogcasts.com/blogs/grumpyolddba/archive/2009/03/11/reasons-to-move-to-sql-2008-merge.aspx](http://sqlblogcasts.com/blogs/grumpyolddba/archive/2009/03/11/reasons-to-move-to-sql-2008-merge.aspx)

当有人对您的表发出 MERGE 命令时，您希望触发器做什么？

# vb.net - 哪里是开始学习 VB 的好地方？

> ID：937469
> 
> 赞同：2
> 
> 时间：2009-06-02T00:41:44.537
> 
> 标签：vb.net

我知道的唯一编程语言是 C++，我想学习其他一些，特别是 Visual Basic。那么——有哪些好的 VB 初学者教程，以及您建议学习的其他语言有哪些好主意？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-02T01:02:37.413

我建议你从 C# 开始，因为它与 C++ 更相关，并且会给你一个很好的 .net 介绍

Petzold book [.NET Book Zero - C or C++ Programmer Needs to Know About C# and the .NET Framework](http://www.charlespetzold.com/dotnet/)非常适合这项任务（免费）

然后你可以学习VB.net，C#的表弟。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T03:20:02.987

试试这个：http: [//msdn.microsoft.com/en-us/vbasic/ms789086.aspx](http://msdn.microsoft.com/en-us/vbasic/ms789086.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-22T19:00:21.177

如果您已经想要这些教程，可以从这里开始：[http](http://cuinl.tripod.com/tutorials.htm) ://cuinl.tripod.com/tutorials.htm，但这里也很好：www.tutorialized.com/tutorials/Visual-Basic/1。对不起我的英语。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T04:01:08.690

您可以在[http://www.asp.net/learn上找到大量文章和视频](http://www.asp.net/learn)

享受

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-22T19:07:26.063

> VB有哪些好的初学者教程

[http://www.programmersheaven.com/2/VB-NET-School](http://www.programmersheaven.com/2/VB-NET-School)

> 您会建议哪些其他语言是学习的好主意？

对于语法与 C++ 相似的强大语言：C#
对于快速开发脚本语言：Python

# flash - 如何在 AS2 中获取加载的 swf 舞台的宽度/高度？

> ID：937472
> 
> 赞同：2
> 
> 时间：2009-06-02T00:42:44.613
> 
> 标签：flash, actionscript-2, flash-cs4, swfloader

我正在使用 MovieClipLoader 将外部 as2 swf 文件加载到我的 as2 flash 项目中，但我无法获取加载的 swf 的原始舞台大小。

当我运行以下代码时：

```
var popup:MovieClip = _root.createEmptyMovieClip("popup", 1);
var loader:MovieClipLoader = new MovieClipLoader();
var loadHandler:Object = new Object();
loader.addListener(loadHandler);
loader.loadClip(url, popup); 
loadHandler.onLoadInit = function(mc:MovieClip) {
    trace(mc._width + ", " + mc._height);
} 
```

当我真正想要的是加载的 swf 文件的舞台大小时，我得到奇怪的宽度/高度值（mc._width=601.95，mc._height=261.15），在这种情况下我知道它是 300px x 250px。

任何建议表示赞赏！谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T02:15:06.643

这里的问题是加载的 swf 在加载到另一个 swf 时会丢失它的舞台大小。父级的阶段成为加载 swf 的阶段。当请求加载的 swf 的大小时，就像您一样，它将返回第一帧的整个表面的宽度和高度，而不是舞台的宽度和高度。

我过去解决这个问题的方法是在加载的 swf 的第一帧上创建一个具有该 swf 舞台大小的影片剪辑实例。一旦加载了 swf，您就可以定位该 swf 并获取它的尺寸。当然，这仅在您对尝试加载的 swf 具有发布控制权时才有效。

用一个例子来说明这一点。在要加载的 swf 中，在第一帧上放置一个movieclip（例如矩形的movieclip）并将其命名为stage_mc。当您现在加载 swf 时，您可以像这样定位该 stage_mc 实例：

```
loadHandler.onLoadInit = function(mc:MovieClip) {
    trace(mc.stage_mc._width + ", " + mc.stage_mc._height);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-31T17:19:42.447

在 AS3 中，您可以使用 loaderinfo 属性获取已加载 SWF 的高度：

```
// imports
    import flash.display.LoaderInfo;

// loading code
    var loader:Loader = new Loader();
    loader.load(new URLRequest('some_swf.swf'));
    loader.contentLoaderInfo.addEventListener(Event.INIT, loaderInitHandler);

// listener
    function loaderInitHandler(event:Event):void 
    {
        var info:LoaderInfo = event.target as LoaderInfo;
        trace('Loaded swf is ' + info.width + ' x ' + info.height + ' px');
    }

// Loaded swf is 500 x 300 px 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-06-02T02:25:16.107

尝试

```
stage.width; 
stage.height; 
```

# c# - 在 Delphi 2007 中使用 SDK 蓝屏但在 C# 中工作的应用程序

> ID：937480
> 
> 赞同：1
> 
> 时间：2009-06-02T00:47:08.943
> 
> 标签：c#, delphi, delphi-2007

我正在编写一个使用第三方 SDK (OCX) 的应用程序。我在 C# 中使用 SDK，它工作得很好。但是，我可以使用 Delphi 2007 中的 SDK 中的相同对象创建最简单的测试应用程序，并且它可以编译，但是当它到达某个点时，在同一台机器上会出现 BSOD。我已经运行了一些其他使用 SDK 的测试应用程序并且它们运行正常，所以我知道 SDK 安装正常并且运行正常。

我从事的其他不使用此特定 SDK 的 Delphi 项目可以正常运行。

有关如何尝试解决此问题的任何想法？我可能需要删除我在 Delphi 中安装的 OCX 并将它们添加回来吗？你是怎样做的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T03:04:34.233

很不寻常的问题。基于 Windows NT 的操作系统通常非常擅长包含用户应用程序内部环 3 处发生的故障。有问题的 SDK 是否通过内核级驱动程序与硬件交互？另外，系统蓝屏时屏幕上会出现什么信息。有时这是关于问题性质的线索（例如，中断处理程序重入问题、硬件故障、中断冲突）。我有时会在 Dialogic 板上看到这种类型的问题。该问题也可能是与驱动程序无关的内核级故障。

如果没有更多细节，除了推测原因之外，很难做更多的事情。我倾向于认为这不是 FPU 控制字问题，但我可能是错的。FPU 控制字问题可能会导致异常，但异常需要发生在关键执行上下文中，例如操作系统不会捕获和处理的驱动程序。

FWIW 我在 Delphi JNI 库中看到了导致 JVM 和主机应用程序崩溃的 FPU 控制字问题。修复方法是使用代码显式包装调用，以更改和恢复 NineBerry 建议的控制字。如果应用程序不是多线程的，则此方法有效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T10:36:23.080

It turns out this was caused by Kaspersky antivirus. I tracked it down by running [Windbg](http://www.microsoft.com/whdc/devtools/debugging/install64bit.mspx#) against the crash dump and it pointed to kl1.dll. After searching around I tracked down [this article](http://www.techsupportforum.com/microsoft-support/windows-vista-support/296140-bsod-problems.html) which identified it as Kaspersky. I disabled Kaspersky and the BSOD no longer occurs.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T00:53:19.960

浮点异常有可能导致问题。大多数运行时环境禁用浮点异常，但在 Delphi 中，它们是启用的。

禁用浮点异常，使用以下代码：

```
Set8087CW($133f); 
```

请注意，这也会改变您自己代码的行为。如果浮点计算出现错误，您将不会再遇到任何异常，而是将结果变量设置为 NaN、Inf+ 或 Inf-。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T03:49:17.687

Just because you can use the SDK fine from other applications doesn't inherently mean that it doesn't have a problem. It may be reacting badly to certain data items or even to items that shouldn't exist--assuming the contents of memory that doesn't formally contain anything.

I'm sure you've run into bugs caused by uninitialized data items that simply get whatever value was in memory, something like this could be going on with the data area in question being passed in. (Say, a padding byte in a record structure...)

# c++ - 为什么不能在 C++ 模板参数中定义新类型？

> ID：937486
> 
> 赞同：2
> 
> 时间：2009-06-02T00:50:46.657
> 
> 标签：c++, templates

我正在创建一个库以允许类似 OCaml/Haskell 的代数数据类型和模式匹配。代数数据类型使用类似于[Boost.Variant](http://www.boost.org/doc/libs/1_39_0/doc/html/variant.html)的类来实现。我希望能够在模板参数中定义新类型（构造函数），但出现错误。我将自己的类型与可变参数模板一起使用，但`variant`为了简单起见，我将在这里使用 Boost。为什么不是这样的：

```
typedef variant <
    class Foo { ... },
    class Bar { ... }
> Baz; 
```

允许吗？我知道我可以单独定义类型，但这意味着我不能使用一些不错的宏。在大多数情况下，在 C++中，*您*可以在使用它的地方定义新类型，例如：

```
struct Foo { ... } bar; 
```

在这里，我定义了一个新类型`Foo`和一个`bar`类型变量`Foo`。如果允许这样的事情，为什么它不适用于模板？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T01:08:43.750

除了它不存在之外，真的没有任何理由，而且我猜它还没有被提议添加，或者如果它有，没有足够的支持。

如果你想追求它，我建议从标准委员会开始

[http://www.open-std.org/Jtc1/sc22/wg21/](http://www.open-std.org/Jtc1/sc22/wg21/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T01:13:28.857

我猜这是因为模板参数的处理方式与函数参数类似，您不能声明

```
void func( class A{} a, class B{} b ); 
```

任何一个。我还认为，如果您需要多个模板（typedef）中的类，则不可能遵守[ODR 。](http://en.wikipedia.org/wiki/One_Definition_Rule)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-06-02T01:18:10.330

我认为即将到来的[C++0x 概念](http://en.wikipedia.org/wiki/C%2B%2B0x#Concepts)非常接近，尽管与您所描述的并不完全相同。

# python - 使用“打印”时语法无效？

> ID：937491
> 
> 赞同：118
> 
> 时间：2009-06-02T00:51:52.457
> 
> 标签：python

我正在学习 Python，甚至无法编写第一个示例：

```
print 2 ** 100 
```

这给了`SyntaxError: invalid syntax`

指着2。

为什么是这样？我正在使用 3.1 版

* * *

## 回答 #1

> 赞同：243
> 
> 时间：2009-06-02T01:02:17.413

那是因为在 Python 3 中，他们用*函数替换了*`print` *语句*。`print`

 *语法现在或多或少与以前相同，但它需要括号：

来自“ [python 3 中的新功能](http://docs.python.org/3.0/whatsnew/3.0.html)”文档：

```
Old: print "The answer is", 2*2
New: print("The answer is", 2*2)

Old: print x,           # Trailing comma suppresses newline
New: print(x, end=" ")  # Appends a space instead of a newline

Old: print              # Prints a newline
New: print()            # You must call the function!

Old: print >>sys.stderr, "fatal error"
New: print("fatal error", file=sys.stderr)

Old: print (x, y)       # prints repr((x, y))
New: print((x, y))      # Not the same as print(x, y)! 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-06-02T00:55:22.810

你需要括号：

```
print(2**100) 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-06-02T01:02:33.810

它们`print`在 Python 3 中发生了变化。在 2 中它是一个语句，现在它是一个函数并且需要括号。

这是[来自 Python 3.0 的文档](http://docs.python.org/3.0/whatsnew/3.0.html#print-is-a-function)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-01-04T14:53:07.497

新的 3.x 版本而不是旧的 2.x 版本中的语法发生了变化：例如，在 python 2.x 中，您可以编写： print "Hi new world" 但在新的 3.x 版本中，您需要使用新语法并这样写： print("Hi new world")

检查文档： [http ://docs.python.org/3.3/library/functions.html?highlight=print#print](http://docs.python.org/3.3/library/functions.html?highlight=print#print)

# ocaml - 为什么“**”没有比 OCaml 中的否定绑定更紧密？

> ID：937497
> 
> 赞同：2
> 
> 时间：2009-06-02T00:53:52.377
> 
> 标签：ocaml

在[这个问题](https://stackoverflow.com/questions/936904/why-does-bind-more-tightly-than-negation)之后，我不知道该怎么想。

在 OCaml 中，如果您执行 -1.0**2.0 之类的操作（因为您需要使用浮点数键入），您将获得 1.00。根据[标准的操作顺序](http://en.wikipedia.org/wiki/Order%5Fof%5Foperations)，结果应该是-1（在python中）。

我无法在 OCaml 中找到运算符优先级的原因或明确定义......

这是因为类型系统吗？还是 pow 下面有绑定的事实？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-02T01:33:30.657

正如您引用的那一页所说，“一元运算符 - （通常读作“减号”）的行为顺序通常是有问题的。” -- 它引用 Excel 和 bc 为它与 O'CAML 具有相同的优先级，但也说“在书面或印刷数学中”它在 Python 中工作。因此，基本上，在这个具体问题上没有普遍共识。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T06:22:57.953

运算符优先级在 OCaml 中是语法导向的，这意味着函数标识符的第一个字符（以及它是一元还是二元）根据固定的顺序确定运算符的优先级。将此与 Haskell 等语言进行对比，在这些语言中，可以在函数定义中指定运算符优先级，而不管使用哪些字符来形成函数标识符。

# php - “原始二进制数据”哈希应该如何存储在 MySQL 中？

> ID：937503
> 
> 赞同：3
> 
> 时间：2009-06-02T00:56:55.693
> 
> 标签：php, mysql, hash

我想在 MySQL 中存储散列密码，我正在使用 PHP：

```
<?php
    $salt = '!£$%^&*()#';
    $username = 'abc';
    $password = '123';
    $hash = hash('sha1', $username . $salt . $password, true);
?> 
```

hash() 中的 true 参数会将值作为原始二进制数据返回。但我不明白这到底是什么意思。它应该如何正确存储在 MySQL 中？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-02T06:18:27.803

我找到了解决方案。

sha1() 的正常（十六进制）哈希的长度始终为 CHAR(40)。当您在 php 中将哈希作为原始二进制数据返回时，它将返回一个字符串作为 CHAR(20)，节省 50% 的数据库空间，但表示完全相同的值。这是因为可以将 2 个十六进制字符压缩为 1 个字符，从而将所需空间减半。

因此，将密码存储为 CHAR(20) 并使用 *_bin 排序规则。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-02T01:05:42.603

hash() 函数的最后一个参数表示如何返回哈希值：

*   要么作为原始二进制数据。通过这种方式，您可以获得您正在使用的特定哈希函数的直接输出，在本例中为 sha1。
*   或者作为包含相同原始二进制数据的十六进制表示的字符串。

它们都是相同的，只是在表示上有所不同。除非您有充分的理由，否则我建议您使用十六进制表示并将其作为字符串存储在数据库中。这种方式更容易调试问题，因为您可以轻松打印出十六进制哈希值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T01:26:25.837

如果您确实想在 MySQL 中存储原始二进制字符串，请声明该列`BINARY(16)`，如果它具有 16 字节的已知固定长度，`VARBINARY(32)`如果它的可变长度最多 32 字节，或者二进制字段的一种 BLOB 类型可能会变得非常长（例如，`BLOB`高达 64K，`LONGBLOB`高达 4G）。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-06-02T01:07:49.900

AFAIK 执行此操作的“正常”方式是使用 addlashes() 函数。

例如：

```
$hash = hash('sha1', $username . $salt . $password, true);
$query_safe_hash = addslashes($hash);
$query_safe_username = addslashes($username);
$query = "INSERT INTO DBTable(username, password) VALUES ('$query_safe_username', '$query_safe_hash')";
mysql_query($query) or die("Failed to store credentials!"); 
```

旁注：从加密最佳实践的角度来看，盐应该是已知长度，应该随机生成，并在存储到数据库之前添加到您的哈希中。就像是

```
$salt = generate_random_salt();
$query_safe_hash = addslashes($salt) . addslashes(hash('sha1', $salt . $username . $password, true); 
```

然后为了验证用户的凭据，您检索存储的哈希，删除斜杠，并从存储的哈希的开头剥离已知的盐长度，并使用相同的盐生成所提供凭据的哈希，然后进行比较。这有助于强化您的哈希算法以抵御各种密码分析攻击（特别是差分密码分析）。

# unit-testing - Starbasic 有单元测试框架吗？

> ID：937507
> 
> 赞同：2
> 
> 时间：2009-06-02T00:58:54.283
> 
> 标签：unit-testing

好的，我知道这是一个非常蹩脚的问题，因为 Starbasic 是一种非常蹩脚的语言，但是……有人知道 Starbasic 的单元测试框架吗？有时我们没有奢侈的使用像 .net 这样合理的语言来做事，因为有时 80% 的项目已经编写好了...... :-D

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-03-20T20:50:17.570

虽然可能没有，但您可以创建一个相对较少的工作。虽然作为一门语言的基本语言可能缺少反射等一些不错的功能，但您可以用不到一百行代码创建一个基本的测试框架。有像 CppUnitLite 这样的例子并不复杂，可以作为灵感。

# selenium-rc - Selenium RC 定位器 - 指的是后续元素？

> ID：937511
> 
> 赞同：0
> 
> 时间：2009-06-02T01:00:55.153
> 
> 标签：selenium-rc

当页面中有多个具有相同定位器的元素时，应该如何引用下一个元素？

使用 Xpath 定位器可以添加数组表示法，例如 xpath=(//span/div)[1] 但是使用简单的定位器？

例如，如果有 3 个由“link=Click Here”标识的链接，则简单地附加 [3] 不会得到第 3 个元素。

解决元素数组的权威参考在哪里？我找不到任何东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-13T04:39:42.150

Selenium 本身不处理定位器数组。它只返回满足您查询的第一个元素，因此如果您想这样做，您必须使用 xpath、dom 甚至更好的 css。

因此，对于链接示例，您应该使用：

```
selenium.click("css=a:contains('Click Here'):nth-child(3)") 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-02T20:53:54.970

Santi 是正确的，Selenium 返回与您指定的定位器匹配的第一个元素，并且您必须应用您使用的定位器类型的适当表达式。不过，我认为在这里提供细节会很有用，因为在这种情况下，它们确实接近于“*血腥细节*”：

## CSS

`:nth-child`伪类很难使用；它有一些鲜为人知*且*没有明确记录的微妙之处，即使在 W3C 页面上也是如此。考虑如下列表：

```
<ul>
  <li class="bird">petrel</li>
  <li class="mammal">platypus</li>
  <li class="bird">albatross</li>
  <li class="bird">shearwater</li>
</ul> 
```

然后选择器`css=li.bird:nth-child(3)`返回**信天翁**元素而不是**海鸥**！这样做的原因是它使用您的索引 (3) 到元素列表中，这些元素是第一个匹配元素的兄弟元素 -*未被 .bird 类过滤*！一旦它有了正确的元素，在这个例子中是第三个，它*就会*应用bird类过滤器：如果手头的元素匹配，它就会返回它。如果不匹配，则匹配失败。

现在考虑选择器`css=li.bird:nth-child(2)`。这从第二个元素 - 鸭嘴兽开始 - 看到它不是鸟并且空无一物。这表现为您的代码抛出“未找到”异常！

可能适合查找索引条目的典型心理模型的是 CSS`:nth-of-type`伪类，它在索引*之前应用过滤器。*不幸的是，根据 locators 的官方文档，这不受 Selenium[支持](http://release.seleniumhq.org/selenium-core/1.0.1/reference.html#locators)。

## XPath

您的问题已经表明您知道如何在 XPath 中执行此操作。在带有方括号的表达式中的任意点添加数组引用。例如，您可以使用以下内容：`//*[@id='abc']/div[3]/p[2]/span`在指定 id 下的第三个 div 下的第二段中查找跨度。

## DOM

DOM 使用与 XPath 相同的方括号表示法，*除了*DOM 从零开始索引，而 XPath 从 1 开始索引：`document.getElementsByTagName("div")[1]`返回第二个 div，而不是第一个 div！DOM 也提供了另一种语法：`document.getElementsByTagName("div").item(0)`完全等价。请注意，使用 getElementsByTagName 时，您*始终*必须使用索引，因为它返回的是节点集，而不是单个节点。

# mysql - mysql假选择

> ID：937523
> 
> 赞同：29
> 
> 时间：2009-06-02T01:03:52.713
> 
> 标签：mysql, select

我的目的是：从值列表中获取多行，例如 (1,2,3,4,5),('a','b','c','anything') 等等。

```
mysql> select id from accounts where id in (1,2,3,4,5,6);
+----+
| id |
+----+
|  1 |
|  2 |
|  3 |
|  5 |
|  6 |
+----+
5 rows in set (0.00 sec) 
```

上面的 sql 肯定没问题，但我的问题是：有没有办法在没有的情况下获得相同的结果

指定一个表？因为我在这里的目的只是通过 id_set 传播行

另一个例子：

```
mysql> select now() as  column1;
+---------------------+
| column1             |
+---------------------+
| 2009-06-01 20:59:33 |
+---------------------+
1 row in set (0.00 sec)

mysql> 
```

此示例在未指定表的情况下传播单行结果，

但是如何从（1,2,3,4,5,6）这样的字符串传播多行？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-06-02T01:13:58.403

像这样的东西应该工作：

```
SELECT 0 as id
UNION SELECT 1
UNION SELECT 2
UNION SELECT 3
UNION SELECT 4
UNION SELECT 5 
```

之后，您可以通过给它一个别名来从中选择您需要的内容：

```
SELECT *
FROM (
    SELECT 0 as id
    UNION SELECT 1
    UNION SELECT 2
    UNION SELECT 3
    UNION SELECT 4
    UNION SELECT 5
) `table1` 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-02T01:14:32.413

MySQL 有一个虚拟表：DUAL。但是使用 DUAL 不会改变任何东西（只是为了方便），当然不会使这个查询工作。

我相信有更好的方法来实现你想要做的事情。如果您解释您的问题，我们可能会提供帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-20T08:01:45.610

一种简单而老式的方法是使用包含连续值的表。

```
DROP TABLE IF EXISTS `range10`;
CREATE TABLE IF NOT EXISTS `range10` (
  `id` int(11) NOT NULL,
  KEY `id` (`id`)
) ENGINE=MyISAM;
INSERT INTO `range10` (`id`) VALUES (1),(2),(3),(4),(5),(6),(7),(8),(9),(10); 
```

安装后，您可以编写查询，如下所示。

**每隔两行获取一次：**

```
select * from your_data_table where id in (
 SELECT id*2 as id FROM `range10` WHERE id in(
  select id from `range10`
 )
) 
```

**获取从 1101 到 1111 的行：**

```
select * from your_data_table where id in (
 SELECT id+1100 as id FROM `range10` WHERE id in(
  select id from `range10`
 )
) 
```

因此，如果您需要更大的范围，则只需增加表 range10 中连续值的大小。查询简单，成本低，无需存储过程或函数。

**笔记：**

您也可以创建具有连续 char 值的表。但改变内容不会那么容易。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-02T01:15:28.370

这并不能完全回答您的问题，但我相信这将解决您的实际问题..

SET @counter = 0; SELECT (@counter := @counter + 1 as counter) ...其余的查询

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-02T01:18:00.580

我发现一种非常有价值的技术是[“整数表”](http://www.xaprb.com/blog/2005/12/07/the-integers-table/)，它可以让您轻松地做各种巧妙的事情，包括这个（xaprb 已经写了几篇关于这种技术的博客文章和密切相关的“互斥表”）。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2020-08-16T15:54:37.340

这是一种直接使用 MySQL 请求创建自定义行的方法`SELECT`：

```
SELECT ALL *
FROM (
    VALUES
        ROW ('1.1', '1.2', '1.3'),
        ROW ('2.1', '2.2', '2.3'),
        ROW ('3.1', '3.2', '3.3')
) AS dummy (c1, c2, c3) 
```

给我们一张桌子`dummy`：

```
c1   c2   c3
-------------
1.1  1.2  1.3
2.1  2.2  2.3
3.1  3.2  3.3 
```

# java - OS X 上的 JFileChooser

> ID：937533
> 
> 赞同：7
> 
> 时间：2009-06-02T01:07:51.507
> 
> 标签：java, macos, widget, jfilechooser

JFileChooser 看起来一点也不像本机小部件。我似乎记得读过一些 hack 让它看起来像本机小部件但搜索它知道我似乎无法再次找到它我遇到了建议使用 java.awt.FileChooser 但该类似乎不在分布。我怎样才能让 JFileChooser 看起来像本机小部件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-02T01:35:11.577

`java.awt.FileDialog`将是帖子所指的课程。不出所料，它比 Swing 版本更受限制。所有 Java SE 实现都必须具有`FileDialog`该类（尽管无头配置可能无法用它做任何有用的事情）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-02T01:15:12.053

看看[这个页面](http://nadeausoftware.com/node/89#UsingtheJFileChoosertogetMacfileandfoldericons)。它经历了很多 UI 调整，但第三个最相关：“使用 JFileChooser 获取 Mac 文件和文件夹图标。”

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-02T06:15:03.067

[Quaqua 的外观和感觉](http://www.randelshofer.ch/quaqua/)可能值得一看，它用更好、更原生的版本替换了文件选择器，包括文件夹着色等。

# javascript - 你能得到（如果可能的话使用jQuery）一个元素的当前滚动位置吗？

> ID：937546
> 
> 赞同：2
> 
> 时间：2009-06-02T01:15:10.727
> 
> 标签：javascript, jquery

我在“向下”按钮上使用此代码来滚动溢出 div 中的文本。

```
var textHeight = text.outerHeight();
var pageDown = $('#page-down');
var pageUp = $('#page-up');

pageDown.bind('click', function () {
    pageUp.fadeIn(500);
    text.animate({ scrollTop: '+=' + textHeight + 'px' }, 500);
}); 
```

这很好用，但是我需要一种方法来确定向下滚动按钮何时应该消失......即当最后一个内容出现在 div 中时。

是否有属性或方法可以获取该 div 中的滚动位置？谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T01:35:32.870

以下是您可能想要查看的几个链接：

[http://yelotofu.com/2008/10/jquery-how-to-tell-if-youre-scroll-to-bottom/](http://yelotofu.com/2008/10/jquery-how-to-tell-if-youre-scroll-to-bottom/)

[http://www.mail-archive.com/jquery-en@googlegroups.com/msg22400.html](http://www.mail-archive.com/jquery-en@googlegroups.com/msg22400.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T01:37:37.327

我觉得很愚蠢......这会返回一个我可以使用的数字：

```
 console.log($('#text').attr('scrollTop')); 
```

# sql-server-2008 - 在 Sql Server 2008 和全文搜索方面需要帮助

> ID：937553
> 
> 赞同：0
> 
> 时间：2009-06-02T01:17:30.817
> 
> 标签：sql-server-2008, full-text-search

我已经在单个表中的单个字段上设置了 FTS。

```
Field: Name NVARHCHAR(350) NOT NULL 
```

现在，当我搜索以下内容时

```
1 ave
10 ave 
```

我没有得到我期望的结果。

首先，将搜索查询`1 ave`转换为`"1*" AND "ave*"`. 现在我运行我的 CONTAINS(..) 查询...

```
SELECT FooId, Name
FROM [dbo].[Names] 
WHERE CONTAINS(Name, @SearchQuery) 
```

然后，随着正确的结果，我也得到了这些不正确的结果......

```
2 Ave  (a couple of entries .. but they are all unique entires). 
```

那么，这个是怎么找回来的呢？`1*`在那段文字中没有？它就像..这个数字被忽略了？

另外 - 这很重要 - 我已经删除了对停止列表的引用并重建了目录。

唔。我很混乱。有人有什么建议吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-02T01:49:59.377

“1”可以出现在全文搜索索引列中的任何位置，它不必直接位于“Ave”之前（甚至之前），该行的其他地方是否有 1？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T01:53:18.043

全文索引将找到单词的派生词——例如，如果您搜索 RUN，它可能会找到 RUNNING、RAN、RUN 等。

我想知道它是否决定 2 接近 1，并将其作为接近匹配返回。您应该尝试将查询切换到 CONTAINSTABLE 查询，以便您还可以评估 RANK 以确定哪个答案更接近匹配。然后，您可以决定一个阈值并过滤掉任何不符合您的标准的行，以确定它们的匹配程度。

编辑：它没有考虑 1 接近 2 的变化。我在一个看起来像这样的示例表上运行了一个测试查询......

```
PK          Name
1           1 ave
2           10 ave
3           2 ave
4           12 avenue
5           13 avenue
6           100 ave.
7           200 ave
8           210 avenue 
```

这是我运行的查询...

```
select  *
from    Table_1
where   contains(name, '"1*" and "ave*"') 
```

这是我得到的结果......

```
PK          Name
2           10 ave
4           12 avenue
5           13 avenue
6           100 ave. 
```

这里有趣的是没有找到表中的第一条记录。（我在 SQL 2008 开发版上运行此程序）。根据这些结果（没有找到以 2 开头的内容） - 我会仔细检查您的查询。也许发布整个查询的全文，包括设置搜索变量的位置。

# asp.net - Using Oracle session state, and SessionStateStoreProviderBase in my web.config

> ID：937564
> 
> 赞同：0
> 
> 时间：2009-06-02T01:24:21.097
> 
> 标签：asp.net, oracle, web-config, webserver

Does anyone know or ran into an issue with images not getting rendered when using a custom session state. (I'm using oracle session provider)

```
<sessionState cookieless="UseUri" timeout="20" mode="Custom" customProvider="MyOracleSessionStateStore" regenerateExpiredSessionId="true">
<providers>
<add name="MyOracleSessionStateStore" type="Oracle.Web.SessionState.OracleSessionStateStore, Oracle.Web, Version=2.111.7.0, Culture=neutral, PublicKeyToken=89b483f429c47342" connectionStringName="SESSION_STATE"/>
</providers>
</sessionState> 
```

It's the weirdest thing to me, i have like 20 pie charts on a page and they are all image controls. out of those 20, only 10 of them render and when you refresh the page more gets rendered!! If i change the config file back to InProc or stateServer then it works perfectly.
just random images gets rendered and some images get skipped. Does anyone know whats going on or have any solutions. Thanks, Thanks,

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-01T15:25:19.877

The issues seemed to be only on developers local machine using the same port..We haven't had any issues on the production yet.

# javascript - 如何将 Javascript 事件发送回 Rails 进行处理？

> ID：937568
> 
> 赞同：1
> 
> 时间：2009-06-02T01:26:44.633
> 
> 标签：javascript, ruby-on-rails, client-server

如果我的 Javascript 层中有用户交互，我可以让 Javascript 操作触发 Rails 控制器操作并将数据从 Javascript 传递到这些 Rails 方法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-02T02:24:55.423

是的。`XMLHttpRequest`您通常使用 Prototype 或其他一些 Javascript 库对 Rails 应用程序进行异步调用。您使用查询参数将数据传回服务器，就像任何其他请求一样，您的应用程序返回浏览器用来更新页面相关部分的 HTML 片段或 Javascript 代码。

[PrototypeHelper](http://api.rubyonrails.org/classes/ActionView/Helpers/PrototypeHelper.html)类对于在服务器中生成正确的东西很有用。[Ajax.Request](http://www.prototypejs.org/api/ajax/request)是您将在客户端上使用的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T02:10:53.657

我相信您可以将 AJAX 请求返回给您的控制器。Rails 默认包含原型，因此您可以使用它的 AJAX 功能（[http://www.prototypejs.org/api/ajax/request](http://www.prototypejs.org/api/ajax/request)）

# .net - 犀牛用单身人士嘲笑

> ID：937570
> 
> 赞同：1
> 
> 时间：2009-06-02T01:27:13.043
> 
> 标签：.net, singleton, rhino-mocks

我正在使用第三方的组件。该组件为我们的应用程序的上下文提供了一个单例模式。我在我这边使用这个单例，但我想模拟这个对象进行测试。有没有办法在这个对象上完成模拟。

此外，构造函数被声明为私有的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T01:57:52.997

使用 RhinoMocks 你必须有一个界面。如果你真的需要模拟这个，那么你将不得不通过将单例包装在另一个实例化接口的类中来作弊。这个接口基本上需要是第三方单例类型上所有公共成员的副本。

这个概念类似于[Duck Typing](http://en.wikipedia.org/wiki/Duck_typing)，但由于 CLR 不支持 Duck Typing ，因此您必须使用代理类。

这是一个例子：

```
public interface ISingleton
{
    void SomePublicMethod();
    Int32 SomePublicProperty{ get; set; }
}

public class SingletonProxy: ISingleton
{
    private ThirdPartySingleton _singleton = StaticType.GetSingleton(); // ???

    public void SomePublicMethod()
    {
        _singleton.SomePublicMethod();
    }

    public Int32 SomePublicProperty
    {
        get{ return _singleton.SomePublicProperty; }
        set{ _singleton.SomePublicProperty = value; }
    }
} 
```

因此，现在无论您使用什么类型，您都可以将其作为服务依赖项传递，如下所示：

```
public class TypeThatUsesSingleton
{
    private ISingleton _singleton;    

    public TypeThatUsesSingleton([HopefullySomeDependencyInjectionAttributeHere] ISingleton singleton)
    {
        _singleton = singleton;
    }

    public void DoStuff()
    {
        _singleton.SomePublicMethod();
    }
} 
```

现在您应该能够愉快地在测试中模拟该类并将其作为依赖项传递，以便让您的单元测试继续进行：

```
[Test]
public void ShouldAssertSomeBehavior()
{
    var repo = new MockRepository();
    var singleton = repo.DynamicMock<ISingleton>();

    var sut = new TypeThatUsesSingleton(singleton);

    using(repo.Record())
    {
        singleton.SomePublicMethod();
    }
    using(repo.Playback())
    {
        sut.DoStuff();
    }
} 
```

瞧！愉快地嘲笑单身人士没有头痛（好吧，有点头痛）。您可能认为整个 Proxy 类会让人头疼，但幸运的是，一些好心人已经让这变得更容易了。我之前提到的整个 Duck Typing ……有一个开源库可以在运行时为你生成代理类。

[鸭打字.Net](http://www.deftflux.net/blog/page/Duck-Typing-Project.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T01:39:21.630

如果第三方 Singleton 返回一个接口而不是一个具体的类（它应该），那么 Rhino 模拟将能够模拟它。

如果你只是想把它存根，请查看 Rhino mocks'`MockRepository.Stub<IMyInterface>()`

# c# - 更改 WebBrowser 控件的用户代理

> ID：937573
> 
> 赞同：49
> 
> 时间：2009-06-02T01:27:59.123
> 
> 标签：c#, winforms, webbrowser-control, user-agent

我正在尝试在 Winforms 应用程序中更改 WebBrowser 控件的 UserAgent。

我已经通过使用以下代码成功地实现了这一点：

```
[DllImport("urlmon.dll", CharSet = CharSet.Ansi)]
private static extern int UrlMkSetSessionOption(
    int dwOption, string pBuffer, int dwBufferLength, int dwReserved);

const int URLMON_OPTION_USERAGENT = 0x10000001;

public void ChangeUserAgent()
{
    List<string> userAgent = new List<string>();
    string ua = "Googlebot/2.1 (+http://www.google.com/bot.html)";

    UrlMkSetSessionOption(URLMON_OPTION_USERAGENT, ua, ua.Length, 0);
} 
```

唯一的问题是这只能工作一次。当我第二次尝试运行 ChangeUserAgent() 方法时，它不起作用。它保持设置为第一个更改的值。这很烦人，我已经尝试了一切，但它不会改变不止一次。

有谁知道另一种更灵活的方法？

谢谢

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2011-09-23T17:44:47.133

最简单的方法：

```
webBrowser.Navigate("http://localhost/run.php", null, null,
                    "User-Agent: Here Put The User Agent"); 
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-06-02T02:02:24.967

我不确定是否应该从[网站](http://wallerdev.com/2008/12/25/changing-the-user-agent-in-ie-net-webbrowser-control-via-csharp)复制/粘贴，但我宁愿将答案留在这里，而不是链接。如果有人可以在评论中澄清，我将非常感激。

基本上，您必须扩展 WebBrowser 类。

```
public class ExtendedWebBrowser : WebBrowser
{
    bool renavigating = false;

    public string UserAgent { get; set; }

    public ExtendedWebBrowser()
    {
        DocumentCompleted += SetupBrowser;

        //this will cause SetupBrowser to run (we need a document object)
        Navigate("about:blank");
    }

    void SetupBrowser(object sender, WebBrowserDocumentCompletedEventArgs e)
    {
        DocumentCompleted -= SetupBrowser;
        SHDocVw.WebBrowser xBrowser = (SHDocVw.WebBrowser)ActiveXInstance;
        xBrowser.BeforeNavigate2 += BeforeNavigate;
        DocumentCompleted += PageLoaded;
    }

    void PageLoaded(object sender, WebBrowserDocumentCompletedEventArgs e)
    {

    }

    void BeforeNavigate(object pDisp, ref object url, ref object flags, ref object targetFrameName,
        ref object postData, ref object headers, ref bool cancel)
    {
        if (!string.IsNullOrEmpty(UserAgent))
        {
            if (!renavigating)
            {
                headers += string.Format("User-Agent: {0}\r\n", UserAgent);
                renavigating = true;
                cancel = true;
                Navigate((string)url, (string)targetFrameName, (byte[])postData, (string)headers);
            }
            else
            {
                renavigating = false;
            }
        }
    }
} 
```

注意：要使用上述方法，您需要添加对“Microsoft Internet Controls”的 COM 引用。

他也提到了你的方法，并指出 WebBrowser 控件似乎缓存了这个用户代理字符串，所以它不会在不重新启动进程的情况下更改用户代理。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2013-08-06T12:55:38.880

此外，该功能中有一个刷新选项（根据[MSDN](http://msdn.microsoft.com/en-us/library/ms775125%28v=vs.85%29.aspx)）。它对我来说效果很好（你应该在任何用户代理更改之前设置它）。然后可以像这样更改问题代码：

```
[DllImport("urlmon.dll", CharSet = CharSet.Ansi)]
private static extern int UrlMkSetSessionOption(
    int dwOption, string pBuffer, int dwBufferLength, int dwReserved);

const int URLMON_OPTION_USERAGENT = 0x10000001;
const int URLMON_OPTION_USERAGENT_REFRESH = 0x10000002;

public void ChangeUserAgent()
{
    string ua = "Googlebot/2.1 (+http://www.google.com/bot.html)";

    UrlMkSetSessionOption(URLMON_OPTION_USERAGENT_REFRESH, null, 0, 0);
    UrlMkSetSessionOption(URLMON_OPTION_USERAGENT, ua, ua.Length, 0);
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-10-21T22:53:42.727

我想补充一下@Jean Azzopardi 的回答。

```
void BeforeNavigate(object pDisp, ref object url, ref object flags, ref object targetFrameName,
        ref object postData, ref object headers, ref bool cancel)
{
    // This alone is sufficient, because headers is a "Ref" parameters, and the browser seems to pick this back up.
    headers += string.Format("User-Agent: {0}\r\n", UserAgent);
} 
```

这个解决方案最适合我。使用重新导航给我带来了其他奇怪的问题，比如浏览器内容突然消失，有时仍然出现不支持的浏览器。使用这种技术，Fiddler 中的所有请求都具有正确的用户代理。

# windows - 适用于 Windows 的最佳免费可编写脚本的 SFTP 客户端是什么？

> ID：937579
> 
> 赞同：7
> 
> 时间：2009-06-02T01:30:40.320
> 
> 标签：windows, sftp

适用于 Windows 的最佳免费可编写脚本的 SFTP 客户端是什么？

我看过 WinSCP 和 FileZilla。WinSCP 似乎有很多[错误（单击此处）](http://winscp.net/forum/viewtopic.php?p=24476#24476)，并且 FileZilla 似乎不太可编写脚本。

有什么建议么？

基本上我想做的是：从计划任务中，登录到远程服务器，拉出任何文件，然后从远程服务器中删除它们。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-02T02:34:50.550

你可以使用putty pscp自带的scp客户端。您可以在命令行上使用 pscp，就像在 linux 命令行中使用 scp。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-02T01:35:14.523

[赛格温](http://www.cygwin.com/)。您可以将命令行[sftp](http://en.wikipedia.org/wiki/SSH_file_transfer_protocol)的强大功能与[BASH](http://www.gnu.org/software/bash/)脚本的强大功能结合起来。所有这一切，在 Windows 中！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-03-15T00:45:10.967

腻子 scp 已经被提及。

我想提一下腻子 psftp.exe，它可能是新的。

使用以下命令行：

psftp.exe -l -pw -b

这将登录到 ftp 服务器并针对它运行*file-with-ftp-cmds*。

完整文档在这里：

[http://the.earth.li/~sgtatham/putty/0.52/htmldoc/Chapter6.html](http://the.earth.li/~sgtatham/putty/0.52/htmldoc/Chapter6.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-02T01:38:32.397

您可以查看 VanDyke 的 SecureFX。 [http://www.vandyke.com/products/securefx/](http://www.vandyke.com/products/securefx/)

或 MKS 系统管理员工具包 [http://mkstoolkit.com/products/tk/ds_tkother.asp](http://mkstoolkit.com/products/tk/ds_tkother.asp)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-09-04T02:11:24.710

我知道这是一个非常古老的问题，但看看 [http://redpark.posterous.com/lftp-for-windows](http://redpark.posterous.com/lftp-for-windows)

从 cygwin 我只使用 3 个文件：bash.exe、ssh.exe 和 cygssp-0.dll。将它们放在与 redpark 的 lftp 的 Windows 端口相同的目录中，然后编写脚本。

命令行示例：

```
D:\lftp>bash
bash-4.1# export PATH=.
bash-4.1# lftp sftp://user:pass@somehost.com
lftp user@somehost.com:~> put -c cx160sd.flv
194749860 bytes transferred in 112 seconds (1.67M/s)
lftp user@somehost.com:/> exit
bash-4.1# exit
exit

D:\lftp> 
```

它不是单一的 exe 解决方案，但事实证明上传速度是 pscp.exe 上传速度的两倍

编辑：现在后继的新 URL 已停止： [http ://envelopepushing.wordpress.com/2010/08/24/lftp-for-windows/](http://envelopepushing.wordpress.com/2010/08/24/lftp-for-windows/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-04T01:14:54.497

不是免费的，但请查看[edtFTPnet/PRO](http://www.enterprisedt.com/products/edtftpnetpro/overview.html)以获得在 Windows 上支持 SFTP 的综合脚本引擎。

这是一个示例脚本：

```
# Sample SFTP script 
set remotehost=edtmobile
set user=javaftp
set password=javaftp
set protocol=sftp
set localdir=D:\work\tmp

# connect to the server
open

# change dir
cd remote/test

# put the local file test.txt to the server as mytest.txt
put test.txt mytest.txt

# disconnect
close 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-05-24T21:55:11.310

其他人注意：要创建计划任务，只需打开文本编辑器并写出 pscp 命令。然后将文件保存为 .bat 文件。文档的第 5 章和第 6 章包含您想知道的有关 pscp 工作原理的所有内容。

请注意， pscp 对于具有源和目标非常特别。如果您不提供这些，pscp 将简单地默认返回使用消息。

这是一个例子：

```
c:\pscp.exe -pw [your password] -batch -sftp someuser@example.com:/* c:\yourlocation 
```

在此示例中，pscp.exe 位于 c 目录的根目录中。-batch 禁用交互式提示，以便它们不会中断自动化任务。-sftp 强制使用 sftp 协议，因为在问题中指定了 sftp。:/* 通配符将带回源中的所有内容，而 c:\yourlocation 指定它在您的计算机上的最终位置。

要将其安排为自动化任务，只需打开计划任务。在 XP 中，这是在系统工具中。然后将任务指向您创建的 .bat 文件，给它一个运行时间，然后您就设置好了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-07-30T09:11:51.810

急速FTP；免费，提供可移植版本，并具有全面的脚本 API（与 LUA 语言兼容）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-07-31T20:30:57.677

如果您使用 powershell，您可以使用 netcmdlets (www.netcmdlets.com) 之类的东西。它本身不是客户端，而是一组用于 Internet 通信的库 (cmdlet)。还有一个免费的个人版。很容易配置调度任务来调用 powershell 脚本，并且您可以通过代码获得完全灵活/可扩展的好处。

# php - XSLT 缓存问题

> ID：937583
> 
> 赞同：0
> 
> 时间：2009-06-02T01:34:28.487
> 
> 标签：php, xslt, caching

我正在尝试从 NYTimes ( [http://code.nytimes.com/projects/xslcache](http://code.nytimes.com/projects/xslcache) )安装这个 PHP 模块

不幸的是，我在最后一个障碍中跌倒了。我已经安装它，添加到我的 php.ini 中，但是在我的 PHP 代码中运行时出现此错误。

```
Fatal error: Class 'xsltCache' not found in... 
```

我的 php 代码如 NYTimes 网站所述

```
$xslt = new xsltCache; 
```

任何想法为什么会发生这种情况？

我的模块安装脚本是

```
cd ~
mkdir setups
cd setups
wget http://code.nytimes.com/downloads/xslcache.tar.gz
tar -xvf xslcache.tar.gz
cd xslcache
phpize && ./configure --with-xslcache=/usr/lib/libxslt.so --with-xsl-exsl-dir=/usr/lib/libexslt.so
make
make install 
```

它似乎工作得很好，没有错误，php.ini 很好。我已经通知了一些东西，它没有出现在 phpinfo() 中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-12T18:46:20.137

检查您是否将扩展名添加到正确的 php.ini 文件中。

如果您有一个 PHP 目录，则其中可能有一个，但您要添加扩展的目录可能在您的服务器目录中。

IE 在我的电脑上，要修改的正确 php.ini 是 apache\bin\php.ini

PS不要忘记重新启动服务器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-07T17:29:37.630

听起来你还没有在你的 php.ini 文件中加载扩展名，extension=xslcache.so。如果您的 php.ini 文件中确实有该行，请检查您的错误日志并查看 PHP 是否在加载扩展时遇到问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-10T15:34:09.297

这是一个大小写问题，但并不完全是 SpliFF 所建议的：

如果您查看nytimes 网站上的[这个测试包含文件](http://code.nytimes.com/projects/xslcache/browser/trunk/tests/prepare.inc)，大写应该是：

```
$proc = new xsltcache; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-12T02:47:39.753

会不会是 /usr/lib/libexslt.so 文件的权限问题？也许php无法访问它？

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-06-10T13:02:22.910

在这里抛出一个猜测，但大小写问题？API 文档将该类称为 XSLTCache() 但纽约时报的封面和您的代码说 xsltCache(); 我无法从我读过的内容或在 Google 上找到的内容中判断 PHP 类名是否区分大小写。

# java - struts 教程或示例

> ID：937584
> 
> 赞同：7
> 
> 时间：2009-06-02T01:34:33.120
> 
> 标签：java, jsp, struts, struts-validation

我正在尝试在 Struts 中创建一个登录页面。这个想法是验证用户是否存在等，然后如果有错误，则返回登录页面，错误为红色（典型登录或任何表单页面验证）。

我想知道是否有人知道 Struts 中的错误管理教程。我正在寻找专门的教程（或示例）

```
<html:errors> 
```

标签，我认为这可以解决我的问题。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-06-02T03:22:27.897

这是一个：//struts.apache.org/1.3.5/struts-taglib/apidocs/org/apache/struts/taglib/html/package-summary.html#package_description

这里我假设 Struts 1。我不知道 Struts 2 是否发生了变化。

您可以将 errors.header 和 errors.footer 放入您的消息资源文件中：

```
errors.header=<h3><font color="red">Errors:</font></h3><ul>
errors.footer=</ul> 
```

仅当 ActionErrors 对象中有任何错误时，才会显示页眉和页脚。

在您的 Action 类中，执行以下操作：

```
ActionErrors errors = new ActionErrors();
if (badInput) {
  errors.add(ActionErrors.GLOBAL_ERROR,
    new ActionError("error.bad.input", badString);    // key in messages resource file
                                    // badString will replace {0} in message
} 
```

然后在返回之前：

```
saveErrors(request, errors); 
```

在您的消息资源文件中：

```
error.bad.input=<li>Bad input:  '{0}' is invalid.</li> 
```

现在当`<html:errors/>`标签被处理时，它会变成：

```
<h3><font color="red">Errors:</font></h3><ul>
<li>Bad input: 'xxyyzzz' is invalid.<li>
</ul> 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-06-04T16:40:59.200

这是一个快速的总结。你有一`ActionForm`堂课，说`MyForm`：

```
<form-bean name="myForm" type="myapp.forms.MyForm"/> 
```

你有一`Action`堂课，说`MyAction`：

```
<action path="/insert" type="myapp.actions.MyAction" name="myForm"
   input="/insert.jsp" validate="true" />
  <forward name="success" path="/insertDone.jsp"/>
</action> 
```

动作中的“name”指的是form-b​​ean中的“name”。因为你有`validate="true"`你的`ActionForm`类`MyForm`必须定义`validate()`将自动调用的方法：

```
public ActionErrors validate(ActionMapping mapping, HttpServletRequest request) {
  ActionErrors errors = new ActionErrors();
  if ((username==null) || (username.length() < 1)) 
      errors.add("username", new ActionError("error.username.required"));
  return errors;
} 
```

如果它返回一个空的 ActionErrors 对象，Struts 会继续调用您的 MyAction.execute()。否则，Struts 将显示 /insert.jsp（因为这是您提供的 input= parm）并展开 html.errors 标记以显示来自 ActionErrors 的错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-05-12T15:26:53.673

在struts动作中：

```
ActionErrors errors = new ActionErrors();
errors.add("", new ActionMessage("login.msg.err"));
saveErrors(request, errors); 
```

“hello.msg.err”在 MessageBundle.properties 中定义

```
login.msg.err=Wrong user name or password 
```

在您的 JSP 中，错误将由 h:errors 标签显示：

```
<h:errors/> 
```

该视频逐步向您展示并为您解释所有这些内容： [https ://youtu.be/YcCsJtqI72A](https://youtu.be/YcCsJtqI72A)

# function - PHP 和 C++ 是我们需要注意的仅有的两个地方吗？看起来传递值确实是传递引用？

> ID：937585
> 
> 赞同：0
> 
> 时间：2009-06-02T01:34:58.953
> 
> 标签：function, pass-by-reference, pass-by-value

PHP 和 C++ 是我们在将简单数据类型变量作为函数参数传递并且值可以更改时唯一需要注意的两个地方吗？

如

```
$count = 2;
foo($count);
echo $count; 
```

第三行，echo $count 显示 2 以外的内容。我只知道 PHP 和 C++ 会在哪里发生。还有其他地方可以发生吗？

**更新：**也就是说，看起来像“按值传递”实际上是“按引用传递”。如果它在 Java、Perl、PHP、Python 和 Ruby 中传递对象，它会自动通过引用传递，并且可以更改对象的实例变量的值。那么传入非对象呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T01:38:12.660

许多其他语言都支持这种“通过引用”——Perl、Fortran、Pascal、Visual Basic，...

你关心哪些，好吧，我们很难说！-)

编辑：在您的更新中，您将 Java 和 Python 归为同一类别，但这是错误的：您无法使用 (Java) 重现您的示例：

```
 int count = 2;
  whatever(count);
  /* count here is CERTAIN to be still 2 */ 
```

或（Python）：

```
count = 2
whatever(count)
# count here is CERTAIN to be still 2 
```

Python 和 Java 的风格有时被称为“通过对象引用”（与“通过变量引用”相反）：传递（或分配）的是对对象的引用（因此，如果对象具有 mutators，则被调用者可以调用这些 mutators 和因此改变对象），而不是“变量”（这样在调用之后，用于传递参数的变量（如果有的话）仍然引用同一个对象，而不是另一个对象）。这种区别在不可变对象中最为明显，例如（在 Java 和 Python 中）数字和字符串。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T01:41:44.307

**除非您明确**将其定义为引用，否则您无法更改 C++ 中的变量。如果您有常规（非参考）参数，它们是副本并且**不能**更改。如果您阅读并理解 API，则无需*小心将简单的数据类型变量作为函数参数传递*。

```
void func(type & arg); 
```

可以改变和

```
void func(type arg); 
```

不能。通常在 C++ 中它不会是引用参数，除非 API 想要首先更改值（输出参数）。

正如亚历克斯已经提到的，有许多语言支持*通过引用*成语。

**如果一种语言不清楚**变量是*按值*传递还是*按引用*传递，您只需要小心。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T03:47:11.197

回到过去，FORTRAN 通过引用传递常量。您可以将常量 2​​ 传递给子例程，而子例程可以为其分配 3。然后返回后，这段代码

```
x = 2 + 2 
```

会将 x 设置为 6。我不知道现代 FORTRAN 编译器是否允许这种情况发生。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-07T02:29:39.493

根据上面的讨论，最近我了解到 y 编程语言设计使用术语“传递引用”是相当严格的，例如在 java 中实际上只是传递值，严格。

要么，你通过值传递一个原语（我想每个人都清楚），或者你通过值传递对对象的引用。好的，我现在明白了，但请考虑以下 perl 代码。

```
sub addFoo {
  my ($arrayRef) = @_;
  push @{$arrayRef},"foo"; 
}

my @array = (1,2,3);
my $arrayRef; # FUTURE reference (equivalent to pointer C) to @array.

addFoo($arrayref = \@array); #1.
addFoo(\@array); #2.
addFoo($arrayRef); #3.

print join(" ",@array),"\n"; # result "1 2 3 foo foo foo\n"; 
```

我的问题是，三个对 addFoo 的替代调用中的哪一个被视为传递引用而不是传递引用？似乎数字三的答案很明确，但我不能说数字 #1。#2。和做的完全一样。在某些 perl 手册页和网站中，至少数字 2 被明确视为传递引用。

# .net - 路由与 URL 重写 (IIS7) 性能

> ID：937600
> 
> 赞同：7
> 
> 时间：2009-06-02T01:39:50.753
> 
> 标签：.net, asp.net, url-rewriting, url-routing

我想知道这两种方法在性能方面有什么区别吗？有这方面的好文章吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-02T01:59:55.940

让我们考虑一下实际发生的差异：

网址重写：

*   IIS 接收请求并将其传递给非托管模块
*   模块将请求与一组模式匹配并返回一个转换
*   IIS 将返回的转换传递给 ASP.NET 模块并启动请求生命周期

路由：

*   IIS 接收请求并将其传递给 ASP.NET
*   ASP.NET 将请求与一组模式进行匹配，并确定处理请求的入口点
*   ASP.NET 在该处理程序上开始请求生命周期

我想说这两者是如此接近，你很难找到差异明显的情况。

# javascript - 关于变量和选择器的 jQuery 问题

> ID：937603
> 
> 赞同：6
> 
> 时间：2009-06-02T01:40:11.067
> 
> 标签：javascript, jquery

最近，我一直在努力提高性能（有时它有助于可维护性）

```
var objectToReference = $('div .complicated #selector ul:last'); 
```

那么什么是`objectToReference`真正成立的呢？有时事情让我很痛苦，所以我回到使用完整的选择器并且它已经工作了。

变量是否包含引用、指针等（我不确定这些术语的确切定义）

谢谢

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-06-02T03:00:51.310

许多人在创建这样的变量时使用的最佳实践是以 $ 开头的名称，以表明它是一个 jquery 对象。所以你可以将变量命名为$o，然后你可以直接在它之后调用其他jQuery链函数，而不必在变量周围加上$()。

```
$o.hide(); 
```

最好从您正在操作的区域的周围元素开始，以避免搜索整个文档。例如，要获取文档单个部分中的所有链接（无需搜索整个文档）：

```
var $o = $('#mysection');
var $links = $('a', $o); // equiv to $o.find('a') 
```

最后，通过 jQuery 传回 jQuery 对象永远不会有什么坏处：

```
$o === $($o) 
```

这有一个很好的副作用——你可以编写一个接受以下任何一个参数的函数：选择器、元素或 jQuery 对象：

```
function myFunc(e) {
    var $e = $(e);
}
// All of the following will work:
myFunc('#mysection');
myFunc(document.getElementById('mysection'));
myFunc($('#mysection a')); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-02T02:03:51.987

**[jQuery 选择器](http://docs.jquery.com/Selectors)**的返回值是一个 jQuery 元素数组。如果选择器没有找到任何匹配项，则它包含一个包含 0 个元素的数组。

数组中的每个元素本质上都是对 HTML 文档中匹配的 DOM 元素的引用。这使您可以根据需要遍历和操作它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T01:51:50.857

它拥有一个 jQuery 集合，它是一个数组。如果你的 DOM 发生了变化，你可能会遇到麻烦。

* * *

进一步研究它，发现集合（您可以将其视为数组）是具有类似数组属性的对象。

[http://www.learningjquery.com/2008/12/peeling-away-the-jquery-wrapper-and-finding-an-array](http://www.learningjquery.com/2008/12/peeling-away-the-jquery-wrapper-and-finding-an-array)

请记住，数组和对象在 JavaScript 中非常相似。有关更多信息，请参阅我的[柯克和芝士蛋糕帖子](http://dreaminginjavascript.wordpress.com/2008/06/27/how-weird-are-javascript-arrays/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-02T02:06:05.553

它包含对返回的 jQuery 对象的引用。对对象的任何更改都会更改底层 DOM 元素以及对同一元素的所有其他引用。

```
$('div .complicated #selector ul:last') 
```

您的变量`objectToReference`将是一个 jQuery 对象，您可以对其执行 jQuery 操作。此外，即使您不必这样做，您也可以使用它`objectToReference`来创建一个新的 jQuery 对象，它不应该施加任何性能限制，因为它应该只返回对自身的引用而不是重新搜索该元素。

```
var objectToReference = $('div .complicated #selector ul:last');
var copyOfObject = $(objectToReference); 
```

您可能在尝试引用`objectToReference`. 如果你想获取`objectToReference`jQuery 选择器返回的底层 DOM 元素，你可以这样做：

```
var objectToReference = $('div .complicated #selector ul:last');
var domOfObject = objectToReference.get(0); 
```

或者，您可以选择执行此操作，在 1 行中执行相同操作：

```
var domObjectToReference= $('div .complicated #selector ul:last').get(0); 
```

同样，您可以`domObjectToReference`在 jQuery 构造函数中使用 来创建对该对象的另一个引用：

```
var objectToReference2 = $(domObjectToReference); 
```

所有这些示例都存储对 DOM 元素的引用。如果您修改其中一个引用的值，它们都将被修改/更新。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-19T23:10:35.710

对于任何有兴趣的人，我已经发布了 jQuery 参考的 V2，如果你想看看它就在这里：[http ://www.skidoosh.co.uk/jquery/jquery-selectors-and-attribute-selectors-reference -and-examples-v2/](http://www.skidoosh.co.uk/jquery/jquery-selectors-and-attribute-selectors-reference-and-examples-v2/) for jQuery 1.2 我将在几天后将其更新为 1.3。

# iphone - 带有 UITableView 的 UIToolBar - 加载时 TableView 不刷新

> ID：937605
> 
> 赞同：2
> 
> 时间：2009-06-02T01:40:59.020
> 
> 标签：iphone, uitableview, uitabbarcontroller

UIToolBar 有两个视图，一个带有 UITextViews 的 UIView 和一个带有 UITableView 的 UIView。

通过 UIToolBar 调用的 UITableView。UITableView 第一次加载时，它会访问数据库并获取信息。我“tab”回到 UIView w/UITextViews 选择一些数据，然后“tab”回到 UITableView，但是没有一个委托方法被调用，比如 viewDidLoad 或 initWithNibName 或任何东西，因此表中的数据是陈旧的。

所以，我找到了方法

```
-(void)viewWillAppear:(BOOL)animated { 
```

被称为，但是，它无权访问 tableView，例如，

```
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath { 
```

我确实偶然发现了这个建议：

> “我似乎无法弄清楚如何使 UITableView 刷新......我确实找到了这个，这似乎与我遇到的问题相同，
> 
> 我所做的是在 MyModalViewController 类中创建一个 MyTableViewController* 属性。在 presentModalView 之前，我将表视图控制器指针存储在模态视图控制器中。
> 
> 现在，当我在模态视图控制器中时，我有了对表视图控制器的引用。现在只需使用这个存储的 table view 控制器来定位它的 tableView，然后 reloadData。
> 
> 感觉很脏，但可以完成工作。”

如果这是答案，我不知道如何编码。

提前谢谢！

*   sk

注意：我刚试过这个：

。H

```
 UITableView *tableViewPtr; 
@property (nonatomic, retain) UITableView *tableViewPtr; 
```

.m

```
@synthesize tableViewPtr; 
```

并将其存储在 -

```
(UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {:
 ... 
 self.tableViewPtr = tableView; 
 ... 
```

然后尝试从

```
-(void)viewWillAppear:(BOOL)animated {
 [self.tableViewPtr reloadData]; 
```

但这似乎不起作用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-27T19:30:12.183

mr-sk：您可能需要更多地了解 Objective-C 的工作原理。当您声明 UIViewController（或子类）时，您只需实现 UITableView 协议：

```
@interface ViewWithTableView : UIViewController
    <UITableViewDelegate, UITableViewDataSource> {...} 
```

然后在 viewController 中实现所需的协议方法。您只需要实现少数几种方法即可支持 tableView。

如果您使用的是 IB，请像这样定义您的接口：

```
@interface ViewWithTableView : UIViewController
    <UITableViewDelegate, UITableViewDataSource> {
    IBOutlet UITableView *yourTableView;
    . . .
} 
```

并保存，然后转到IB并右键单击tableView。单击并将绑定从 DataSource 和 Delegate 拖动到您的 viewController（可能是您的文件所有者。）然后单击 viewController 并键入 cmd-4。在“类标识”部分的“类”下拉菜单中选择“ViewWithTableView”或任何您称之为的名称。保存一切，一切都会好起来的。

请注意，除非您为 tableView 添加@property，否则您不会调用 self 因为没有访问器：

```
[yourTableView whatever:withWhatever]; 
```

与袖带上键入的任何代码一样，您的里程可能会有所不同。:\

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-03T00:48:55.023

谢谢您的帮助。终于解决了，问题来了：

1) 我的控制器正在扩展 UIViewController，而不是 UITableViewController。

一旦我扩展了正确的类，然后通过 File's Owner 和 IB 正确连接它，它就起作用了。现在在 viewWillAppear 中我可以调用 self.tableView reloadData。

永远不会再犯这种错误了！

谢谢大家-

sk

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-17T16:52:58.683

你可以使用 UIViewController——你只需要实现 UITableViewDelegate 和 UITableViewDataSource 协议。

--r

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T01:50:13.090

在视图中将出现方法（我假设在您的控制器类中）调用

```
[self.tableView reloadData]; 
```

# ruby-on-rails - 安装 gem 时出现此错误：“错误：执行 gem 时 ... (Zlib::GzipFile::Error)”

> ID：937608
> 
> 赞同：1
> 
> 时间：2009-06-02T01:42:10.547
> 
> 标签：ruby-on-rails, rubygems, gzip, zlib

> **可能重复：**
> [错误：执行 gem 时……（Zlib::GzipFile::Error）不是 gzip 格式](https://stackoverflow.com/questions/13684137/error-while-executing-gem-zlibgzipfileerror-not-in-gzip-format)

在我的系统上安装 gem 时，我收到以下错误：

```
gem install blackbook --version ">= 1.0.7" --source http://github.com/tamoyal/blackbook/tree/master
ERROR:  While executing gem ... (Zlib::GzipFile::Error)
    not in gzip format 
```

关于为什么会发生这种情况的任何想法？我构建了 gem，所以也许我的 gem 构建有问题？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-11-12T20:15:35.050

可能您的宝石来源设置不正确。 [http://gems.rubyforge.org/](http://gems.rubyforge.org/)曾经是通往 ruby​​gems 的正确路径，但它不再存在。

运行这个命令：

```
gem sources 
```

如果您在列表中看到[http://gems.rubyforge.org/](http://gems.rubyforge.org/)，请运行：

```
gem sources -r http://gems.rubyforge.org/ 
```

您可能还需要添加 ruby​​gems.org 作为有效来源

```
gem sources -a http://rubygems.org 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T02:49:49.147

从 GitHub 获取 gem 的设置不正确。

尝试`gem fetch -V`

```
steve@macpro:~$ gem fetch blackbook --version ">= 1.0.7" --source http://github.com/tamoyal/blackbook/tree/master -V
GET 301 永久移动：http://github.com/tamoyal/blackbook/tree/master/specs.4.8.gz
获得 200 好：http://github.com/tamoyal/blackbook/tree/master/
错误：执行 gem 时...（Zlib::GzipFile::Error）
    不是 gzip 格式

```

您收到“不是 gzip 格式”错误，因为`gem`can't fetch `specs.4.8.gz`。GitHub 将 301 重定向返回到您的项目主页，这当然不是它想要的，也没有经过 gzip 压缩。

抱歉，我无法进一步帮助您，但我还没有构建 gem，更不用说在 GitHub 上。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-12-20T19:36:45.520

你没有提到你的系统。但是，如果您没有 zlib 库，它会在 Ubuntu 上发生。解决方案：

```
sudo apt-get install libzlib-ruby 
```

PS我知道这个问题已经超过2年了。我只是希望它可以帮助别人。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-07-31T07:58:00.257

这种错误也出现在我身上。最后我发现代理设置不正确。请检查您是否可以从命令行访问 gem 服务器。只是ping它:)

# javascript - 堆叠的 HTML 元素的顺序

> ID：937613
> 
> 赞同：0
> 
> 时间：2009-06-02T01:45:29.043
> 
> 标签：javascript, jquery, html, css

我正在看一个 jQuery 截屏视频（[绝对初学者的 jQuery：第 8 天](http://blog.themeforest.net/tutorials/jquery-for-absolute-beginners-day-8/)）。它有这个代码：

```
$(function() {
  $('.wrap').hover(function() {
    $(this).children('.front').stop().animate({
      "top": '300px'
    }, 900);
  }, function() {
    $(this).children('.front').stop().animate({
      "top": '0'
    }, 700);
  });
});
```

```
#container {
  width: 850px;
  text-align: center;
  margin: auto;
}

.wrap {
  width: 250px;
  height: 140px;
  position: relative;
  overflow: hidden;
  padding: 0 1em;
}

img {
  position: absolute;
  top: 0;
  left: 0;
}
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<div id="container">
  <div class="wrap">
    <img src="back.jpg" alt="image" />
    <img src="front.jpg" class="front" alt="image" />
  </div>
</div>
```

为什么front.jpg出现在back.jpg之上？仅仅是因为front.jpg位于back.jpg标签之后的标签中吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-02T02:07:40.887

当 z-index 被省略时，后面的兄弟姐妹会自动比之前的兄弟姐妹在更高的层上。这是预期的行为。

引用下面的 MDC 页面：

> 当没有元素具有 z-index 时，元素按以下顺序堆叠（从下到上）：
> 
> 1.  根元素的背景和边框
> 2.  正常流程中的后代块，按出现顺序（在 HTML 中）
> 3.  后代定位元素，按出现顺序（在 HTML 中）

请参阅：[https](https://developer.mozilla.org/en/understanding_css_z-index) ://developer.mozilla.org/en/understanding_css_z-index ，尤其是第一部分，[https://developer.mozilla.org/en/Understanding_CSS_z-index/Stacking_without_z-index](https://developer.mozilla.org/en/Understanding_CSS_z-index/Stacking_without_z-index)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T01:50:08.270

是的，这有点侥幸... z-index 应该在两者上都设置以确保。

# multithreading - 开发人员在使用多线程时会遇到哪些常见的陷阱？

> ID：937616
> 
> 赞同：0
> 
> 时间：2009-06-02T01:48:09.007
> 
> 标签：multithreading

> **可能重复：**
> [常见的并发陷阱是什么？](https://stackoverflow.com/questions/520837/what-are-common-concurrency-pitfalls)

我有线程的基本知识，没有什么特别的。我和一些同事正在学习认证，我们正在讨论关于多线程的章节。

在实现多线程应用程序时，您会犯哪些常见错误？

在开发多线程应用程序时，我们应该注意哪些“陷阱”？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T01:51:40.700

多线程应用程序的典型困难是两个不同的线程同时修改相同的内存。解决这个问题的方法称为同步。

[在这里查看我更完整的答案](https://stackoverflow.com/questions/902137/902321#902321)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T01:52:22.820

查看[Joe Albahari 关于线程的免费电子书](http://www.albahari.com/threading/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T02:16:32.257

最大的问题是

*   从不同线程更新数据（并发写入）；即使像 i++ 这样简单的东西也不总是原子的，或者换句话说，如果两个线程同时执行它，结果可能是 i+=2 或者它可能是 i++ （或者它可能是任何东西，具体取决于你的语言）重新使用）；答案是确保写访问在“互斥”（互斥）锁上“同步”，以便在给定时间最多一个线程可以写入该易失性数据块

*   死锁，其中一个线程必须在 A 上获取互斥锁，然后在 B 上获取互斥锁，而另一个线程以相反的顺序获取互斥锁；如果第一个线程获得 A，而第二个线程获得 B，则两个线程都无法继续；这里的答案是确保以规范的顺序获取互斥锁

但最好的建议是亲吻，保持简单愚蠢。复杂的线程模型调试起来非常痛苦。如果可能的话，不要有多个线程进行写入，特别是尽量避免多个嵌套的互斥锁（需要 A 和 B 来做某事）。

另一条建议是使用著名的线程安全数据类型库，例如原子对象和并发映射和队列。

考虑到未来（云计算），您可能会考虑编写应用程序，就好像线程在不同的机器上一样，尽可能少地交叉通信。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T02:27:13.343

我认为最大的问题是忘记多个区域是否可以启动线程，因为您可能有竞争条件，因为一个部分可能是同步的，但如果有另一个入口点，您将很难找到问题。

但是，最难的部分是知道何时使用多线程。它并不适合所有情况。

应该传入哪些参数，以及你可以摆脱多少全局变量。

我认为函数式编程有很多好的想法可以限制副作用，因为你开始了解到，如果全局变量可以通过许多不同的线程进行更改，它们可能会很糟糕。

当您有多个线程时进行调试也将是一个挑战，具体取决于您使用的语言，例如，在 unix 上使用 C 调试器并不好玩，但 Visual Studio 使它更容易。

# c++ - 为什么 std queue 没有定义交换方法专业化

> ID：937621
> 
> 赞同：4
> 
> 时间：2009-06-02T01:50:52.993
> 
> 标签：c++, stl, queue, swap, stl-algorithm

我读过所有 stl 容器都提供了交换算法的专门化，以避免调用默认方法使用的复制构造函数和两个赋值操作。但是，当我认为在我正在处理的某些代码中使用队列会很好时，我注意到（与向量和双端队列不同）队列不提供这种方法？我刚刚决定使用双端队列而不是队列，但我仍然很想知道这是为什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T01:56:13.343

[C++0x](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2738.pdf)会将交换添加到容器适配器，如 std::queue。我只能推测为什么当前标准中缺少它。在[这个讨论](http://www.cpptalk.net/stdswap-not-specialised-for-container-adaptors-2323-vt23335.html)中，有人提出了一种解决方法：

> 由于标准使所需部分受到保护，因此有一个解决方案，称为继承。[只是不要通过 std 适配器进行破坏] 创建一个模板结构，继承所需的适配器，仅提供构造函数并将 args 转发给适配器类，编写交换成员很容易，因为所需的项目是标准的受保护成员适配器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T02:03:29.990

我敢肯定，他们被排除在外是一个疏忽。平心而论，我经常使用 std::queue 和 std::stack 并且从来不需要交换两个。我认为您使用双端队列而不是队列很好。类似的东西`typedef std::deque<MyType> QueueType`应该给出足够的提示应该如何使用容器。

# php - 如何将 STDOUT 重定向到 PHP 中的文件？

> ID：937627
> 
> 赞同：58
> 
> 时间：2009-06-02T01:53:07.357
> 
> 标签：php, stdout, stdin

下面的代码几乎可以工作，但这不是我真正的意思：

```
ob_start();
echo 'xxx';
$contents = ob_get_contents();
ob_end_clean();
file_put_contents($file,$contents); 
```

有没有更自然的方法？

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2010-09-29T15:17:51.670

可以将 STDOUT 直接写入 PHP 中的文件，这比使用输出缓冲更容易和直接。

在脚本的最开始执行此操作：

```
fclose(STDIN);
fclose(STDOUT);
fclose(STDERR);
$STDIN = fopen('/dev/null', 'r');
$STDOUT = fopen('application.log', 'wb');
$STDERR = fopen('error.log', 'wb'); 
```

为什么一开始你可能会问？还不应打开任何文件描述符，因为当您关闭标准输入、输出和错误文件描述符时，前三个新的描述符将成为新的标准输入、输出和错误文件描述符。

在我的示例中，我将标准输入重定向到 /dev/null 并将输出和错误文件描述符重定向到日志文件。这是在 PHP 中制作守护程序脚本时的常见做法。

要写入**application.log**文件，这就足够了：

```
echo "Hello world\n"; 
```

要写入**error.log**，必须这样做：

```
fwrite($STDERR, "Something went wrong\n"); 
```

请注意，当您更改输入、输出和错误描述符时，内置 PHP 常量 STDIN、STDOUT 和 STDERR 将无法使用。PHP 不会将这些常量更新为新的描述符，并且不允许重新定义这些常量（毕竟它们被称为常量是有原因的）。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2012-11-06T23:01:15.790

这是一种转移 OUTPUT 的方法，这似乎是原始问题

```
$ob_file = fopen('test.txt','w');

function ob_file_callback($buffer)
{
  global $ob_file;
  fwrite($ob_file,$buffer);
}

ob_start('ob_file_callback'); 
```

更多信息在这里：

[http://my.opera.com/zomg/blog/2007/10/03/how-to-easily-redirect-php-output-to-a-file](http://my.opera.com/zomg/blog/2007/10/03/how-to-easily-redirect-php-output-to-a-file)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-06-02T02:24:21.943

不，输出缓冲是最好的。虽然这样做稍微好一点

```
ob_start();
echo 'xxx';
$contents = ob_get_flush();
file_put_contents($file,$contents); 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2017-02-24T18:56:19.480

没有一个答案适用于我的特殊情况，我需要一种跨平台的方式来在输出回显后立即重定向输出，以便我可以使用 tail -f log.txt 或其他日志查看应用程序跟踪日志。我想出了以下解决方案：

```
$logFp = fopen('log.txt', 'w');

ob_start(function($buffer) use($logFp){
    fwrite($logFp, $buffer);
}, 1); //notice the use of chunk_size == 1

echo "first output\n";
sleep(10)
echo "second output\n";

ob_end_clean(); 
```

我没有注意到任何性能问题，但如果你这样做了，你可以将 chunk_size 更改为更大的值。

现在只需 tail -f 日志文件：

```
tail -f log.txt 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2016-05-31T21:55:48.363

使用 eio pecl 模块 eio 非常简单，您还可以捕获 PHP 内部错误、var_dump、echo 等。在这段代码中，您可以找到一些不同情况的示例。

```
$fdout = fopen('/tmp/stdout.log', 'wb');
$fderr = fopen('/tmp/stderr.log', 'wb');

eio_dup2($fdout, STDOUT);
eio_dup2($fderr, STDERR);
eio_event_loop();

fclose($fdout);
fclose($fderr);

// output examples
echo "message to stdout\n";

$v2dump = array(10, "graphinux");
var_dump($v2dump);

// php internal error/warning
$div0 = 10/0;

// user errors messages
fwrite(STDERR, "user controlled error\n"); 
```

调用 eio_event_loop 用于确保先前的 eio 请求已被处理。如果您需要在日志中追加，在 fopen 调用时，使用模式 'ab' 而不是 'wb'。

安装 eio 模块非常容易（[http://php.net/manual/es/eio.installation.php](http://php.net/manual/es/eio.installation.php)）。我用 1.2.6 版的 eio 模块测试了这个例子。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-11-25T00:04:06.397

这是一个丑陋的解决方案，对我遇到的问题（需要调试）很有用。

```
if(file_get_contents("out.txt") != "in progress")
{
    file_put_contents("out.txt","in progress");
    $content = file_get_contents('http://'.$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI']);
    file_put_contents("out.txt",$content);
} 
```

这样做的主要缺点是您最好不要使用 $_POST 变量。但你不必把它放在最开始。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-09-09T11:02:53.967

您可以安装 Eio 扩展

> pecl 安装 eio

并复制一个文件描述符

```
$temp=fopen('/tmp/my_stdout','a');
$my_data='my something';
$foo=eio_dup2($temp,STDOUT,EIO_PRI_MAX,function($data,$esult,$request){
    var_dump($data,$esult,$request);
    var_dump(eio_get_last_error($request));
},$my_data);
eio_event_loop();
echo "something to stdout\n";
fclose($temp); 
```

这会创建新的文件描述符并重写 STDOUT 的目标流

这也可以用 STDERR 完成

和常量 STD[OUT|ERR] 仍然可用

# xml - 如何在 Jquery 中访问 xml 文本节点

> ID：937640
> 
> 赞同：6
> 
> 时间：2009-06-02T02:04:27.617
> 
> 标签：xml, jquery

假设我得到以下 XML 结构：

```
<root>
<item>
 <item1>text1</item1>
 <item2>text2</item2>
 more text here
</item>
</root> 
```

“more text here”是一个文本节点，与层次结构中的其他数据节点处于同一级别，但似乎无法访问。

有没有一种方法可以使用 jQuery 函数提取上面显示的文本节点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-02T02:33:08.853

我想出了相同的解决方案：

```
 var xml = $("<root><item1>text1</item1><item2>text2</item2>more text here</root>");
  alert($(xml).contents().empty().end().text()); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-02T02:29:59.297

所以我想出的解决方案是删除 item1 和 item2 节点，只留下文本：

```
 $(responseXML).find('item').each(function(){
         var item1_text = $(this).find('item1').text();
         var item2_text = $(this).find('item2').text();

         $(this).contents().empty(); //removes the other nodes

         var extra_text = $(this).text();

    } 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-02T02:41:26.607

使用 content() 函数。例如，如果您有一个 XML 片段，例如：

```
var root = $('<root><item1>text1</item1><item2>text2</item2>more text here</root>'); 
```

然后您可以通过以下方式获取文本：

```
var txt = root.contents()[2] 
```

假设文本节点始终是 <root> 的第三个子节点。否则，如果您不知道位置，或者可能有一个节点包含多个文本节点，则应通过过滤收集所有文本节点：

```
var textList = root.contents().filter(function() { return this.nodeType == 3; }); 
```

这将返回在 XML 片段中找到的文本节点数组。要获取列表中的字符串，只需访问数组切片：

```
var txt = textList[0]; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T03:19:20.227

这将获得正确的根/文本值。文本可以放置在根节点中的任何位置。

`<script type="text/javascript"> $().ready(function() { var xml = $('#xml').find('root').contents().each(function(i){ if (this.nodeName=="#text" && this.nodeType=="3" && this.nodeValue.length>2) alert(this.nodeValue); }); });
</script>`

为了：

```
<div id="xml"><root><item1>text1</item1><item2>text2</item2>more text here</root></div> 
```

*注意：“内联”xml 在 Internet Explorer 中不起作用，但如果您将示例中的 root 和 itemX 替换为有效的 Html 节点名，它也会起作用。*

说明：DOM 将空节点和文本节点视为元素。如果您调试上面的 .each()，您将看到以下内容：

```
alert( this.nodeName + '|' + this.nodeType + "|" + this.nodeValue);

#text|3| , ITEM1|1|null , #text|3| , ITEM2|1|null , #text|3| more text here 
```

（抱歉，匈牙利语键盘仍然无法进行格式化）

# winapi - 确定窗口消息队列深度

> ID：937641
> 
> 赞同：2
> 
> 时间：2009-06-02T02:04:38.053
> 
> 标签：winapi, message-queue, postmessage

我们有一个应用程序使用窗口消息队列将数据从套接字传递到消费者 HWND（速率约为 2100Hz）。此应用程序已经工作了 2 年以上。最近，我们的应用程序开始出现 WM_TIMER 没有被我们的应用程序触发/执行的问题。我认为这是由于数据被泵入消息队列。

我的问题是有没有办法确定给定线程/HWND 的消息队列中有多少待处理消息？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-02T02:45:07.957

Raymond Chen 在他的帖子中非常详细地回答了这个问题，“[但是当我们开始每秒发布 10,000 条消息时，我们遇到了问题](https://devblogs.microsoft.com/oldnewthing/20090126-00/?p=19393)”。

> 研究团队要求与用户界面团队会面，以帮助解决他们在负载下的问题。他们概述了他们的设计并解释说它在低数据速率下运行良好，“但是当我们开始每秒发布 10,000 条消息时，我们遇到了问题。”
> 
> 那时，所有用户界面的负责人只是坐在那里，愣了几秒钟。
> 
> “这就像说你的丰田凯美瑞在时速超过 500 英里时出现稳定性问题。”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T02:35:21.890

没有好的方法可以做到这一点。您可以做的一件事是积极清空消息队列并将它们放入您自己的队列中。但是，这并不能解决您的问题。

我讨厌告诉你这个，但你真的应该找到一种方法来处理你的套接字数据。我认为您会发现其他一些机制比使用 Windows 消息队列更容易扩展、执行更好并且更容易调试。

福特克

# mysql - mysql 按日期选择总和组

> ID：937652
> 
> 赞同：47
> 
> 时间：2009-06-02T02:13:00.593
> 
> 标签：mysql, select, group-by

快速提问，我有下表

```
+-------------+---------------------+
| total       | o_date              |
+-------------+---------------------+
|          35 | 01-11-2009 19:32:44 | 
|        41.5 | 01-12-2009 22:33:49 | 
|        61.5 | 01-23-2009 22:08:24 | 
|          66 | 02-01-2009 22:33:57 | 
|       22.22 | 02-01-2009 22:37:34 | 
|       29.84 | 04-20-2009 15:23:49 | 
+-------------+---------------------+ 
```

我想把每个月的总数加起来，然后按月分组。因此，例如1 月- **> 2 月 138 日-> 4 月 88.2 日-> 29.84**

关于它的任何线索。谢谢

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-06-02T02:17:21.490

此解决方案将为您提供月份名称作为结果集的列，然后根据需要提供总计。

```
SELECT MONTHNAME(o_date), SUM(total) 
FROM theTable
GROUP BY YEAR(o_date), MONTH(o_date) 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-06-02T02:15:25.660

```
select year(o_date), month(o_date), sum(total)
from table
group by year(o_date), month(o_date); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2015-03-30T10:20:32.817

从 MySQL 数据库中获取月份和年份数据：

```
SELECT MONTHNAME(o_date), YEAR(o_date), SUM(total) 
FROM the_table 
GROUP BY YEAR(date), MONTH(date) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-02T02:15:36.953

```
SELECT SUM(total)
FROM table
GROUP BY MONTH(o_date) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-03-20T09:20:08.333

试试`Group BY`，像这样：

```
select count(A_id) As Tid,Day(CrDate) from Ap Group By Day(CrDate) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-06-19T20:04:56.513

```
SELECT year(FROM_UNIXTIME(created)) year, month(FROM_UNIXTIME(created)) month, sum(amount) total
FROM {my_table}
GROUP BY year, month
ORDER BY year, month; 
```

# asp.net - 带有 ASP.NET 的 jQuery - 如何创建、填充和显示 UL

> ID：937665
> 
> 赞同：0
> 
> 时间：2009-06-02T02:21:23.557
> 
> 标签：asp.net, jquery

在 ASP.NET Web 应用程序中，我正在尝试根据用户输入创建和填充 UL。这不是一个快速填充。用户输入几个字母，单击一个按钮，服务器返回所有记录，如条目。如果有多个匹配项，则会创建一个显示所有匹配项的 UL。

我试图从插件中调整这段代码。我可以使用调试器逐步完成它，一切似乎都很好，但是 UL 要么没有生成到文档中，要么是不可见的。

这是简化的代码：

```
function fillBusinessDropdown(ListOfBusinesses) {

 var results = document.createElement("div");
 var $results = $(results);
 $results.hide().addClass("ac_results").css("position", "absolute");

 if ($.browser.msie) {
    $results.append(document.createElement('iframe'));
 }

 results.appendChild(businessToDom(ListOfBusinesses));

 $results.css({
 width: 400 + "px",
 top: 100 + "px",
 left: 150 + "px"
 }).show();

function businessToDom(ListOfBusinesses) {

  var ul = document.createElement("ul");

  var iLen = ListOfBusinesses.length - 1

  for (var i = 0; i <= iLen; i++) {
    var row = ListOfBusinesses[i];
    if (!row) continue;
       var li = document.createElement("li");

    // add the business name

    li.innerHTML = row.Bu_name;

// add the business ID
li.selectValue = row.Bupk;
var extra = null;
if (row.length > 1) {
  extra = [];
  for (var j = 1; j < row.length; j++) {
    extra[extra.length] = row[j];
  }
}
li.extra = extra;
ul.appendChild(li);

$(li).hover(
    function() { $("li", ul).removeClass("ac_over");      
            $(this).addClass("ac_over"); active = $("li", ul).indexOf($(this).get(0)); },
    function() { $(this).removeClass("ac_over"); }
    ).click(function(e) { e.preventDefault(); e.stopPropagation();   selectItem(this) });
  }
  return ul;
} 
```

我难住了。有没有人知道我哪里出错了？谢谢迈克托马斯

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-02T03:10:03.223

不确定该代码有什么问题，但您使用的是 javascript 和 Jquery 的混合。我建议一直使用 JQuery。使用 .appendTo() 等

# asp.net-mvc - 如何在 ASP.NET MVC 中支持 ETag？

> ID：937668
> 
> 赞同：65
> 
> 时间：2009-06-02T02:22:22.573
> 
> 标签：asp.net-mvc, etag

如何在 ASP.NET MVC 中支持 ETag？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2013-07-15T16:08:07.000

[@Elijah Glover 的答案](https://stackoverflow.com/a/937685/592958)是答案的一部分，但并不完整。这将设置 ETag，但如果不在服务器端进行检查，您将无法获得 ETag 的好处。你这样做：

```
var requestedETag = Request.Headers["If-None-Match"];
if (requestedETag == eTagOfContentToBeReturned)
        return new HttpStatusCodeResult(HttpStatusCode.NotModified); 
```

另外，另一个提示是您需要设置响应的可缓存性，否则默认情况下它是“私有的”并且不会在响应中设置 ETag：

```
Response.Cache.SetCacheability(HttpCacheability.ServerAndPrivate); 
```

所以一个完整的例子：

```
public ActionResult Test304(string input)
{
    var requestedETag = Request.Headers["If-None-Match"];
    var responseETag = LookupEtagFromInput(input); // lookup or generate etag however you want
    if (requestedETag == responseETag)
        return new HttpStatusCodeResult(HttpStatusCode.NotModified);

    Response.Cache.SetCacheability(HttpCacheability.ServerAndPrivate);
    Response.Cache.SetETag(responseETag);
    return GetResponse(input); // do whatever work you need to obtain the result
} 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-06-02T02:32:56.933

MVC 中的 ETAG 与 WebForms 或 HttpHandlers 相同。

您需要一种创建 ETAG 值的方法，我发现最好的方法是使用 File MD5 或[ShortGuid](http://www.singular.co.nz/blog/archive/2007/12/20/shortguid-a-shorter-and-url-friendly-guid-in-c-sharp.aspx)。

由于 .net 接受字符串作为 ETAG，因此您可以使用轻松设置它

```
String etag = GetETagValue(); //e.g. "00amyWGct0y_ze4lIsj2Mw"
Response.Cache.SetETag(etag); 
```

来自[MIX](http://videos.visitmix.com/MIX09/T64M)的视频，最后他们使用 ETAG 和 REST

# c++ - c++中访问重载运算符

> ID：937670
> 
> 赞同：1
> 
> 时间：2009-06-02T02:23:41.930
> 
> 标签：c++

我在课堂上重载了 [] 运算符。这是实现

```
Node* List::operator [](int index) const{
    Node* p = head_;

    for (int i = 0; i < index; i++){
            p = p->link();
    }

    return p;
} 
```

我想访问返回的 Node* 的类中有另一个函数。其中一条是

```
if ((n = index_of_name(artistName)) >= 0){
  Node* p = // code needed here
} 
```

我希望能够通过使用重载 [] 访问 n 处的节点。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-02T02:25:48.213

```
(*this)[n] 
```

# git - Git 和 Hg 版本控制系统的优缺点是什么？

> ID：937680
> 
> 赞同：3
> 
> 时间：2009-06-02T02:29:35.803
> 
> 标签：git, tfs, version-control, mercurial

我现在可以选择哪个版本控制系统，所以我想从使用过这些版本的开发人员那里得到一些评论。我应该在什么条件下使用哪一个？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-02T04:23:22.910

Google Code 最近为他们的系统选择了 Mercurial 而不是 Git。在他们的分析中，他们发现 Mercurial

*   学习曲线更容易
*   有良好的 Windows 支持
*   更容易维护
*   通过 HTTP 运行得更快

请参阅[http://code.google.com/p/support/wiki/DVCSAnalysis](http://code.google.com/p/support/wiki/DVCSAnalysis)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-02T04:12:51.673

请记住，Git 和 Mercurial 都是 DVCS（分布式版本控制），这与中央 VCS 完全不同。请参阅[核心概念](https://stackoverflow.com/questions/645008/what-are-the-basic-clearcase-concepts-every-developer-should-know/645771#645771)SO 问题以了解差异。

否则，您也可以参考 Eric Weblog，其中“ [Git 是 Wesley Snipes。Mercurial 是 Denzel Washington](http://www.ericsink.com/entries/hg_denzel.html) ”；）

> 我选择 Bazaar 和 Git 作为体验。但如果我选择 DVCS 作为普通用户，我会选择 Mercurial。`[...]`
> 人们钦佩丹泽尔华盛顿。但韦斯利·斯奈普斯更有趣。

就个人而言，我发现 Git 在分支和存储库克隆方面更直观，但 Hg 在 Windows 上有更好的支持（尽管我对[msysgit](http://code.google.com/p/msysgit/)非常满意）

另请参阅[“Git 和 Mercurial 之间的区别”](https://stackoverflow.com/questions/35837/what-is-the-difference-between-mercurial-and-git/892688) SO 问题，特别是：
“ [Git 是 MacGyver 而 Mercurial 是 James Bond](http://importantshock.wordpress.com/2008/08/07/git-vs-mercurial/) ”；）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-02T11:57:35.443

GitHub 人员最近发布了[Hg-Git](http://hg-git.github.com/)的 beta 版本，旨在无缝弥合这两个版本控制系统之间的差距：

> 这是 Mercurial 的 Hg-Git 插件，增加了从 Hg**向 Git 服务器存储库推送和拉取的**功能。这意味着您可以从 Hg 就基于 Git 的项目进行协作，或者使用 Git 服务器作为团队与使用 Git 和 Hg 的开发人员的协作点。

凭借 Mercurial 和 Git 中强大的后端数据存储，我认为这两个相互竞争的版本控制系统之间的界限在不久的将来会变得相当模糊。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-02T04:33:31.103

两者都非常强大且用途广泛。看看同事和上游项目正在使用什么，因为使用相同的 VCS 可以更轻松地进行协作。

作为一名开源开发者，你不可避免地会接触到所有常用的 VCS。查看各种项目选择的系统可能会有所帮助。Python、Mozilla、OpenJDK 是 Mercurial 用户。许多较小的项目使用 Git，尤其是在 Web 空间中。当然，如果你在做内核的东西，你会想要使用 Git。

我将 Git 用于我的软件项目以及对我的文档进行版本控制，并且对它的健壮性和可用性、易于分支和合并等感到非常满意。

Mercurial（我个人经验有限）具有更好的可移植性（Windows等）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-02T02:36:42.620

公平地说，我在 Git 方面的经验有限，而在 Hg 方面没有经验，但是在我使用 svn、perforce 等的几次中，我想念的一件事是一个不错的低整数修订号，我可以向其他开发人员报告。

否则，Git 非常棒。它简化了我使用大量的分支，并且可以离线使用，这在我的笔记本电脑上开发时非常好。

此外，[Github](http://github.com/) = 真棒。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-02T02:38:19.450

我还没有使用这两者中的任何一个，但我希望这些链接可能有用：

*   [http://versioncontrolblog.com/comparison/Bazaar/CVS/Git/Mercurial/Subversion/index.html](http://versioncontrolblog.com/comparison/Bazaar/CVS/Git/Mercurial/Subversion/index.html)
*   [http://www.rockstarprogrammer.org/post/2008/apr/06/differences-between-mercurial-and-git/](http://www.rockstarprogrammer.org/post/2008/apr/06/differences-between-mercurial-and-git/)
*   [http://www.infoq.com/articles/dvcs-guide](http://www.infoq.com/articles/dvcs-guide)

# msbuild - CreateItem 与 ItemGroup

> ID：937681
> 
> 赞同：34
> 
> 时间：2009-06-02T02:29:59.157
> 
> 标签：msbuild

在这样的目标内创建项目有什么区别：

```
<Target Name="DoStuff">
    <CreateItem Include="@(IntermediateAssembly)" >
        <Output TaskParameter="Include" ItemName="FileWrites"/>
    </CreateItem>
</Target> 
```

像这样：

```
<Target Name="DoStuff">
    <ItemGroup>
        <FileWrites Include="@(IntermediateAssembly)" />
    </ItemGroup>
</Target> 
```

你什么时候会使用其中一种，为什么？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-06-02T17:23:51.787

在 3.5 之前的 MSBuild 版本中，您无法在目标内定义属性或项目（如在第二个示例中）。所以使用了一个任务（CreateItem 和 CreateProperty）

如果您使用的是 ToolsVersion 3.5，那么您不再需要使用 CreateItem（尽管如果您愿意，您仍然可以使用）。

最后，他们都创建了相同的项目，具有相同的范围。使用第二种语法更具可读性，并且设置自定义元数据更容易（在我看来）。

注意：3.5 版本的 MSBuild 随 .NET 3.5 一起安装。尽管您需要在 MSBuild 文件`ToolsVersion="3.5"`的`Project`标记中定义以使用 3.5 功能。

`Inside the Microsoft® Build Engine: Using MSBuild and Team Foundation Build`如果您想知道，我从我真正喜欢的书中获得了大部分信息（但与任何方式无关）。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-06-27T06:46:56.250

CreateItem 和 CreateProperty 在 MSBuild 3.5 中已过时（当然，将始终继续工作）。很明显，我们需要相同的熟悉语法来让 ItemGroup 和 PropertyGroup 在目标中工作。

但是目标中的 ItemGroup 有一些特殊的额外能力。它可以修改项目：例如，这将对资源列表中具有名为 Primary 且值为 true 的元数据的所有项目添加 true；仅当还没有复制元数据时：

```
<ItemGroup>
  <Resources Condition=" '%(Primary)' == 'true' ">
    <Copy Condition=" '%(Copy)' == '' ">true</Copy>
  </Resources>
</ItemGroup> 
```

另一种魔力：您现在可以从列表中删除项目。此示例将从资源列表中删除所有元数据类型为位图的项目：

```
<ItemGroup>
  <Resources Condition=" '%(Type)'=='Bitmap' " Remove="@(Resources)"/>
</ItemGroup> 
```

这些神通目前只在内部起作用，在外部不起作用。

有关这些内容的完整详细信息，我强烈推荐 Sayed Hashimi 的关于 MSBuild 的书。在亚马逊上很容易找到。

Dan——msbuild 团队。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-06-05T17:37:29.130

我不认为接受的答案定义了差异。

区别在于：

*   `ItemGroup`在加载 MSBuild 脚本时进行评估。
*   `CreateItem`在执行目标时评估

这可能导致脚本中的 Item 值不同。

以一个任务为例，它对目录中与“*.txt”匹配的所有文件执行某些操作。如果您的 MSBuild 脚本是在 Visual Studio 中加载的，那么如果您使用 ItemGroup，则只有 VS 启动时存在的文件才会在 Item 中。

如果您使用 CreateItem - 它会在执行目标时搜索所有 *.txt 文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-03-06T11:11:33.050

作为此处传递的其他人的附加信息：包含用于构建 MSBuild 项目的 API 的 Build-Engine 不支持将 ItemGroups 添加到 Target 的新方式。在这里，您将不得不使用老式的方式。

# xcode - 如何在 OS X 10.5 上使用 SDL 和 Xcode 加载图像？

> ID：937684
> 
> 赞同：0
> 
> 时间：2009-06-02T02:31:53.333
> 
> 标签：xcode, opengl, file-io, load, sdl

编辑：在 toastie 的建议下使用 bmp 后，我仍然无法加载图像：

我正在将 SDL 和 OpenGL 与 Xcode 一起使用，并且我正在尝试加载图像以用作立方体上的纹理。图像是 256x256 RBG jpeg。该图像与我的所有源代码位于同一目录中，并且位于 Xcode 项目的 Resources 文件夹下。该文件名为 texture.bmp

```
if (textureSurface = SDL_LoadBMP("texture.bmp")) 
{
  // ...
}
else printf("%s", SDL_GetError()); 
```

我继续运行它并收到控制台错误：`Couldn't open texture.bmp`

在这些条件下加载文件的路径或正确语法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T02:40:18.963

SDL_LoadBMP 只加载 BMP 文件，正如其名称所暗示的那样 :)

您将需要另一个库来加载其他图像格式。

尝试 SDL_image： [http ://www.libsdl.org/projects/SDL_image/](http://www.libsdl.org/projects/SDL_image/)

或 DevIL： [http ://openil.sourceforge.net/](http://openil.sourceforge.net/)

或者滚动你自己的加载器： [http ://www.libpng.org/pub/png/libpng.html](http://www.libpng.org/pub/png/libpng.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T03:34:59.587

[在这里](http://www.idevgames.com/forum/archive/index.php/t-13476.html)找到了答案。本质上，图像路径是相对于正在运行的应用程序的，因此我必须移动图像或使路径相对于调试版本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T16:07:46.920

我面前没有 Xcode，但我认为如果您右键/选项单击资源列表中的文件以获取文件的首选项，您可以将其设置为相对于项目、包含目录等.

# python - Python如何计算数字？

> ID：937692
> 
> 赞同：2
> 
> 时间：2009-06-02T02:35:24.760
> 
> 标签：python

> **可能重复：**
> [python - 浮点数的小数位问题](https://stackoverflow.com/questions/286061/python-decimal-place-issues-with-floats)

[4]中：52+121.2

出[4]：173.19999999999999

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-06-02T02:37:24.210

简短的回答：Python 对浮点数使用二进制算术，而不是十进制算术。小数部分不能完全用二进制表示。

长答案：[每个计算机科学家都应该了解浮点运算](http://docs.sun.com/source/806-3568/ncg_goldberg.html)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-06-02T02:50:29.067

如果您熟悉数字“十三点二”以十为基数写为“13.2”的想法，因为它是“10^1 * 1 + 10^0 * 3 + 10^-1 * 2”，然后尝试对数字 173.2 以 2 而不是 10 为基数做同样的事情。

这是整个部分： (1 * 2^7) + (0 * 2^6) + (1 * 2^5) + (0 * 2^4) + (1 * 2^3) + (1 * 2^ 2) + (0 * 2^1) + (0 * 2^0)

现在这是开始的小数部分： (0 * 2^-1) + (0 * 2^-2) + (1 * 2^-3)

那是 .125，还不是 2/10，所以我们需要更多形式为 (1 * 2^-n) 的加法，我们可以用 (1 * 2^-4) + ( 1 * 2^-7)，这让我们更接近...接近 0.1953125，但无论我们这样做多久，我们永远不会达到“.2”，因为“.2”不能表示为加法(1 * 2^-n) 形式的数字总和。

另见 .9999... = 1.0 ( [http://en.wikipedia.org/wiki/0.999..](http://en.wikipedia.org/wiki/0.999..) )

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-06-02T03:34:10.680

尝试这个：

```
>>> from decimal import Decimal
>>> Decimal("52") + Decimal("121.2")
Decimal("173.2") 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-02T15:52:16.190

指向良好浮点资源的其他答案是从哪里开始。但是，如果您了解浮点舍入错误，并且只是希望您的数字看起来更漂亮，并且不包含十几个额外的数字来获得额外的最后一点精度，请尝试使用 str() 而不是 repr() 来打印数字：

```
>>> 52+121.2 
173.19999999999999
>>> str(52+121.2)
'173.2' 
```

# php - 在 Python 中替换字符串时可以传递字典吗？

> ID：937697
> 
> 赞同：6
> 
> 时间：2009-06-02T02:37:59.827
> 
> 标签：php, python, regex, string

在 PHP 中，`preg_replace($patterns, $replacements, $string)`您可以通过传入一组模式和替换来一次完成所有替换。

Python中的等价物是什么？

我注意到 string 和 re 函数`replace()`并且`sub()`不使用字典......

根据 rick 的评论进行了编辑以澄清：想法是有一个带有键的 dict 被视为正则表达式模式，例如`'\d+S'`, 和（希望）常量字符串值（希望没有反向引用）。现在相应地编辑我的答案（即回答实际问题）。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-02T02:56:43.983

最接近的可能是：

```
somere.sub(lambda m: replacements[m.group()], text) 
```

例如：

```
>>> za = re.compile('z\w')
>>> za.sub(lambda m: dict(za='BLU', zo='BLA')[m.group()], 'fa za zo bu')
'fa BLU BLA bu' 
```

`.get`如果要`[]`为`replacements`.

编辑： rick 真正想要的是有一个带有键的字典，可以作为正则表达式模式，例如`'\d+S'`, 和（希望）常量字符串值（希望没有反向引用）。食谱食谱可用于此目的：

```
def dict_sub(d, text): 
  """ Replace in 'text' non-overlapping occurences of REs whose patterns are keys
  in dictionary 'd' by corresponding values (which must be constant strings: may
  have named backreferences but not numeric ones). The keys must not contain
  anonymous matching-groups.
  Returns the new string.""" 

  # Create a regular expression  from the dictionary keys
  regex = re.compile("|".join("(%s)" % k for k in d))
  # Facilitate lookup from group number to value
  lookup = dict((i+1, v) for i, v in enumerate(d.itervalues()))

  # For each match, find which group matched and expand its value
  return regex.sub(lambda mo: mo.expand(lookup[mo.lastindex]), text) 
```

示例使用：

```
 d={'\d+S': 'wot', '\d+T': 'zap'}
  t='And 23S, and 45T, and 66T but always 029S!'
  print dict_sub(d, t) 
```

发出：

```
And wot, and zap, and zap but always wot! 
```

您可以避免构建`lookup`并只使用`mo.expand(d.values()[mo.lastindex-1])`，但如果它非常大并且有很多匹配项，那么这可能会有点慢`d`（抱歉，没有精确测量/基准化这两种方法，所以这只是一个猜测；-)。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2011-06-22T12:05:15.247

这是使用reduce的简单方法

```
mynewstring=reduce(lambda a,(b,c): a.replace(b, c), mydict.items(), mystring) 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-06-02T04:11:41.250

这样做很容易：

```
replacements = dict(hello='goodbye', good='bad')
s = "hello, good morning";
for old, new in replacements.items():
    s = s.replace(old, new) 
```

您会发现很多地方 PHP 函数接受值数组并且没有直接的 Python 等效项，但是在 Python 中使用数组（列表）要容易得多，因此问题不大。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2012-07-19T10:00:49.937

您可以在替换 python 中的字符串时传递字典。考虑上面的例子：

```
replacement = {'hello' : 'goodbye', 'good' : 'bad' } 
```

你已经用这种格式写了字符串

```
s = "%(hello)s, %(good)s morning"
changed_s = s%replacement 
```

changed_s 的输出将是

```
"goodbye, bad morning" 
```

# ruby-on-rails - 在脚手架式 rails 应用程序的索引页面中引用控制器方法

> ID：937703
> 
> 赞同：0
> 
> 时间：2009-06-02T02:39:37.013
> 
> 标签：ruby-on-rails, scaffolding

导轨新手在这里。我已经开始制作一个基于价值的待办事项列表。

到目前为止，我已经像这样搭建了我的应用程序：

```
dir> rails --database=mysql test1
dir> cd test1
test> ruby script/generate scaffold list item:string done:boolean value:int
[Changed default value of done to false in the migration file]
test> rake db:migrate 
```

一切运行良好，我已经更改了我的索引视图以执行我想要的操作，除了更简单的方法将任务标记为已完成。每次我想将任务的 done 布尔值从 false 更改为 true 时，我不想使用 link_to 帮助器转到编辑页面，而是希望能够按下一个按钮来更改该布尔值的值。我该怎么做？我环顾了网络和我的使用 Rails 进行敏捷 Web 开发，但一无所获。谁能指出我正确的方向？

编辑：这是编辑视图更改表中值的方式：

```
<h1>Editing list</h1>

<%= error_messages_for :list %>

<% form_for(@list) do |f| %>
  <p>
    <b>Item</b><br />
    <%= f.text_field :item %>
  </p>

  <p>
    <b>Done</b><br />
    <%= f.check_box :done %>
  </p>

  <p>
    <%= f.submit "Update" %>
  </p>
<% end %>

<%= link_to 'Show', @list %>
<%= link_to 'Back', lists_path %> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T08:44:19.047

这篇[博文](http://www.russellquinn.com/2008/02/03/customing-form-controls-in-rails/)大致包含您正在寻找的内容。只需更改图像，使它们成为您想要的按钮。

# url - 建立一个 url 队列

> ID：937704
> 
> 赞同：0
> 
> 时间：2009-06-02T02:39:37.560
> 
> 标签：url, queue, web-crawler

哪个更适合在大型网络爬虫中构建 URL 队列。链表还是 B 树？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T02:46:44.490

如果您不需要搜索队列（并且队列通常不需要搜索），那么使用链表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-15T18:44:25.257

如果你正在构建一个大型爬虫，你几乎肯定想要使用类似 AMQP 消息队列的东西，很可能是 RabbitMQ。RabbitMQ（和许多其他类似的 MQ）在正常安装的情况下每秒将执行超过 100,000 个事务。我在自己的蜘蛛/爬虫设置中使用它，它就像一个魅力。当然比从头开始构建类似的东西要容易得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T03:00:11.777

如果顺序很重要（并且队列很重要），则使用链表。如果你需要搜索队列，那么B-tree。

# performance - 轮询还是等待更好？

> ID：937713
> 
> 赞同：13
> 
> 时间：2009-06-02T02:44:51.513
> 
> 标签：performance, multithreading, wait, polling

我看到了一个关于为什么“投票不好”的问题。就最小化一个线程使用的处理器时间而言，最好是进行自旋等待（即轮询 while 循环中所需的更改）还是等待内核对象（例如 Windows 中的内核事件对象） ?

对于上下文，假设代码需要在任何类型的处理器、单核、超线程、多核等上运行。还假设轮询或等待的线程在轮询结果令人满意之前无法继续而不是等待。最后，线程开始等待（或轮询）和满足条件之间的时间可能会从很短的时间到很长的时间不等。

由于操作系统可能在“等待”的情况下更有效地“轮询”，我不想看到“等待只是意味着其他人进行轮询”的说法，这是旧消息，不一定 100% 准确.

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-06-02T02:51:05.137

如果操作系统对这些类型的并发原语有合理的实现，那么等待内核对象肯定会更好。

除其他原因外，这让操作系统知道在等待的对象处于适当的状态之前，不要为额外的时间片安排有问题的线程。否则，您有一个线程不断被重新调度，上下文切换到，然后运行一段时间。

您特别询问了如何最小化线程的处理器时间：在此示例中，内核对象上的线程阻塞将使用零时间；轮询线程将使用各种时间。

此外，“其他人正在投票”的论点不必是真的。当内核对象进入适当的状态时，内核可以在那个时刻查看哪些线程正在等待该对象......然后安排其中一个或多个执行。在这种情况下，内核（或任何其他人）不需要轮询任何东西。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-06-02T02:53:53.087

等待是“更好”的行为方式。当您等待内核对象时，您的线程将不会被授予任何 CPU 时间，因为调度程序知道没有工作准备好。只有在满足等待条件时，您的线程才会获得 CPU 时间。这意味着您不会不必要地占用 CPU 资源。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-02T03:52:27.003

我认为尚未提出的一点是，如果您的操作系统有很多工作要做，那么阻塞会将您的线程交给另一个进程。如果所有进程都在它们应该使用的地方使用阻塞原语（例如内核等待、文件/网络 IO 等），那么您正在为内核提供更多信息来选择应该运行哪些线程。因此，它将在相同的时间内完成更多的工作。如果您的应用程序在等待该文件打开或数据包到达时可以做一些有用的事情，那么 yeilding 甚至可以帮助您成为自己的应用程序。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-02T03:01:17.097

等待确实涉及更多资源，并且意味着额外的上下文切换。事实上，一些同步原语，如 CLR Monitors 和 Win32 临界区使用两阶段锁定协议——一些自旋等待在真正等待之前完成。

我想做两阶段的事情会非常困难，并且会涉及大量的测试和研究。因此，除非您有时间和资源，否则请坚持使用 Windows 原语……他们已经为您进行了研究。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-02T03:03:13.473

只有少数地方，通常在操作系统低级事物（中断处理程序/设备驱动程序）中，旋转等待是有意义的/是必需的。通用应用程序总是最好等待一些同步原语，如互斥锁/条件变量/信号量。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-02T03:15:49.983

我同意 Darksquid 的观点，如果你的操作系统有不错的并发原语，那么你不需要轮询。轮询通常出现在实时系统或没有操作系统的受限硬件上，然后您需要轮询，因为您可能没有等待（）的选项，还因为它可以让您精确控制多长时间您希望在特定状态下等待，而不是受调度程序的摆布。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-06-02T03:21:18.897

等待（阻塞）几乎总是最佳选择（“最佳”是指有效利用处理资源并最大限度地减少对同一系统上运行的其他代码的影响）。主要的例外是：

1.  当预期的轮询持续时间很短（与阻塞系统调用的成本相似）时。
2.  主要在嵌入式系统中，当 CPU 专门用于执行特定任务并且 CPU 空闲没有任何好处时（例如，90 年代后期构建的一些软件路由器使用了这种方法。）

在 OS 内核中通常不使用轮询来实现阻塞系统调用 - 相反，事件（中断、计时器、互斥锁上的操作）会导致阻塞的进程或线程可以运行。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-05-15T15:17:18.203

可以采取四种基本方法：

1.  使用一些操作系统等待原语等到事件发生
2.  使用一些操作系统计时器原语以某个定义的速率检查事件是否已经发生
3.  反复检查事件是否已发生，但使用 OS 原语在未发生的任何时间产生任意且未知持续时间的时间片。
4.  反复检查事件是否发生，如果没有发生则不让出 CPU。

当 #1 可行时，它通常是最好的方法，除非延迟对事件的反应可能是有益的。例如，如果您希望在几秒钟内接收大量串口数据，并且如果在发送后 100 毫秒处理数据将与立即处理一样好，则使用后两者之一进行定期轮询方法可能比设置“收到数据”事件更好。

方法#3 相当粗糙，但在许多情况下可能是一个不错的方法。与方法 1 相比，它通常会浪费更多的 CPU 时间和资源，但在许多情况下实现起来会更简单，而且在许多情况下资源浪费会小到无所谓。

方法 #2 通常比 #3 更复杂，但具有能够使用单个计时器处理许多资源且无需专用线程的优势。

方法#4 在嵌入式系统中有时是必要的，但通常非常糟糕，除非直接轮询硬件并且在相关事件发生之前不会做任何有用的事情。在许多情况下，等待的条件不可能发生，直到等待它的线程让出 CPU。在方法#3 中让出 CPU 实际上会让等待线程比占用它更快地看到事件。

# bash - 你如何将ls的输出发送到mv？

> ID：937716
> 
> 赞同：48
> 
> 时间：2009-06-02T02:45:16.770
> 
> 标签：bash, command-line

我知道你可以用 a 来做到这一点`find`，但是有没有办法在 unix 命令行中发送`ls`to的输出？`mv`

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2009-06-02T05:49:39.803

`ls`是一种用于显示有关目录中文件名的一些统计信息的工具。

它**不是**您应该用来枚举它们并将它们传递给另一个工具以便在那里使用它的工具。解析`ls`几乎**总是**错误的事情，并且在很多方面都存在错误。

有关解析 ls 的坏处的详细文档，您**真的**应该阅读，请查看：[http://mywiki.wooledge.org/ParsingLs](http://mywiki.wooledge.org/ParsingLs)

相反，您应该使用 glob 或 find，具体取决于您要实现的目标：

```
mv * /foo
find . -exec mv {} /foo \; 
```

* * *

解析错误的主要来源`ls`是 ls 将所有文件名转储到单个输出字符串中，并且无法从那里区分文件名。如您所知，整个`ls`输出可能是一个文件名！

解析不良的第二个来源`ls`来自半个世界使用 bash 的破坏方式。当他们做类似的事情时，他们会`for`神奇地做他们想做的事情：

```
for file in `ls`  # Never do this!
for file in $(ls) # Exactly the same thing. 
```

`for`是一个迭代参数的 bash 内置函数。并`$(ls)`获取 的输出`ls`并将其拆分为任何有`spaces`或`newlines`的参数`tabs`。这基本上意味着，您正在迭代**words**，而不是**filenames**。更糟糕的是，您要求 bask 获取每个残缺的文件名单词，然后将它们视为可能与当前目录中的文件名匹配的 glob。因此，如果您的文件名包含一个单词，该单词恰好是与当前目录中的其他文件名匹配的 glob，则该单词将消失，而所有匹配的文件名将代替它出现！

```
mv `ls` /foo      # Exact same badness as the ''for'' thing. 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-06-02T02:47:57.870

一种方法是使用反引号：

```
mv `ls *.boo` subdir 
```

**编辑**：但是，这很*脆弱*，**不**推荐使用——请参阅@lhunath 的 asnwer 以获得详细的解释和建议。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-06-02T05:55:24.830

到目前为止，对于带有空格的文件名，没有一个答案是安全的。试试这个：

```
for i in *; do mv "$i" some_dir/; done 
```

你当然可以使用任何你喜欢的 glob 模式来代替`*`.

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-06-02T03:02:38.700

不完全确定您要在这里实现什么，但这是一种可能性：

“xargs”部分是重要的部分，其他一切都只是设置。这样做的效果是获取“ls”输出的所有内容并为其添加“.txt”扩展名。

```
$ mkdir xxx #
$ cd xxx
$ 触摸 abcxyz
$ ls
abxyz
$ ls | xargs -Ifile mv 文件 file.txt
$ ls
a.txt b.txt c.txt x.txt y.txt z.txt
$

```

这样的事情也可以通过以下方式实现：

```
$ 触摸 abcxyz
$ for i in `ls`;do mv $i ${i}.txt; 完毕
$ ls
a.txt b.txt c.txt x.txt y.txt z.txt
$

```

我更喜欢第二种方式。如果不阅读手册页或转到我的“可爱的技巧”文件，我永远不会记得*xargs是如何工作的。*

希望这可以帮助。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-06-02T03:06:37.570

检查一下，`find -exec {}`因为它可能是一个更好的选择，`ls`但这取决于您要实现的目标。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-02T04:10:23.280

您不应该使用 ls 的输出作为另一个命令的输入。名称中带有空格的文件很困难，如果您有以下情况，则包含 ANSI 转义序列也是如此：

```
alias ls-'ls --color=always' 
```

例如。

始终使用 find 或 xargs（带 -0）或通配符。

此外，您没有说是要移动文件还是重命名它们。每个都将被不同地处理。

编辑：将 -0 添加到 xargs （感谢提醒）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-02T03:10:25.657

正如其他人所建议的那样，反引号效果很好。也见 xargs。对于真正复杂的东西，将其通过管道传输到 sed，制作所需的命令列表，然后再次运行它，将 sed 的输出通过管道传输到 sh。

这是 find 的一个示例，但它也适用于 ls：

[http://github.com/DonBranson/scripts/blob/f09d24629ab6eb3ce509d4d3078818430306b063/jarfinder.sh](http://github.com/DonBranson/scripts/blob/f09d24629ab6eb3ce509d4d3078818430306b063/jarfinder.sh)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-02T05:04:21.610

```
/bin/ls | tr '\n' '\0' | xargs -0 -i% mv % /path/to/destdir/ 
```

“无用的 ls”，但应该可以。通过指定 ls(1) 的完整路径，您可以避免与前面一些帖子中提到的 ls(1) 别名冲突。tr(1) 命令与“xargs -0”一起使该命令适用于包含（ugh）空格的文件名。它不适用于包含换行符的文件名，但在文件系统中有这样的文件名是自找麻烦，所以它可能不会是一个大问题。但是可能存在带有换行符的文件名，因此更好的解决方案是使用“find -print0”：

```
find /path/to/srcdir -type f -print0 | xargs -0 -i% mv % dest/ 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-06-02T15:33:16.397

只需使用`find`或你的贝壳 globing！

```
find . -depth=1 -exec mv {} /tmp/blah/ \; 
```

..或者..

```
mv * /tmp/blah/ 
```

您不必担心 ls 输出中的颜色或其他管道异常 - Linux 基本上允许文件名中的任何字符，除了空字节。例如：

```
$ touch "blah\new|
> "
$ ls | xargs file
blahnew|:                  cannot open `blahnew|' (No such file or directory) 
```

..但是 find 完美地工作：

```
$ find . -exec file {} \;
./blah\new|
: empty 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2015-12-09T19:26:02.123

对于更复杂的情况（通常在脚本中），使用 bash 数组来构建参数列表可能非常有用。可以创建一个数组并使用适当的条件逻辑向其推送。例如：

按照@lhunath 的[建议](https://stackoverflow.com/a/938052/430128)使用 glob 或查找，将匹配 glob 模式的文件推送到数组：

```
myargs=()
# don't push if the glob does not match anything
shopt -s nullglob
myargs+=(myfiles*) 
```

将与查找匹配的文件推送到数组：[https](https://stackoverflow.com/a/23357277/430128) ://stackoverflow.com/a/23357277/430128 。

根据需要添加其他参数：

```
myargs+=("Some directory") 
```

`myargs`在调用如下命令时使用`mv`：

```
mv "${myargs[@]}" 
```

请注意数组的引用`myargs`以正确传递带有空格的数组元素。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2009-06-02T02:48:10.727

您将 ls 用反引号括起来并将其放在 mv 之后，所以就像这样......

```
mv `ls` somewhere/ 
```

但请记住，如果您的任何文件名中有空格，它就不会很好地工作。

做这样的事情也会更简单： `mv filepattern* somewhere/`

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2009-06-02T05:22:15.193

```
#!/bin/bash

for i in $( ls * );
do
mv $1 /backup/$1
done 
```

否则，这是 sybreon 的 find 解决方案，而不是绿色 mv ls 解决方案。

# vb.net - 当绑定的 DataSource 为空时如何处理更新 DataGridView？

> ID：937717
> 
> 赞同：0
> 
> 时间：2009-06-02T02:45:36.800
> 
> 标签：vb.net, list, datagridview, datasource

我有一个 DataGridView，我已将对象列表设置为 DataSource。（我在 VS 2005 中使用 VB。）我通过创建 AssetIdentifier 类型的数据源并将该数据源拖到我的表单上来创建 DataGridView。

当组合框或另一个 DataGridView 中的选择发生更改时，我想更新 DataGridView。（下面我正在考虑单击另一个 DataGridView。）以下工作：

```
Public Class dlgShowAssets

    ' class member variable

    Private assetIdList As List(Of AssetIdentifier)

    ' pertinent subs and functions

    Private Sub RefreshAssetIdentifierDataGridView()
        AssetIdentifierDataGridView.DataSource = assetIdList
    End Sub

    Private Sub AssetDataGridView_CellClick(ByVal sender As Object, ByVal e As System.Windows.Forms.DataGridViewCellEventArgs) Handles AssetDataGridView.CellClick     
        assetIdList = RepopulateTheList(id)
        Me.RefreshAssetIdentifierDataGridView()
    End Sub

End Class 
```

在这种情况下，我一直都知道assetIdList 至少有一个元素。我会更新列表，并将 DataGridView 的数据源重置为该列表，一切都很好。

当我将此应用于另一种情况时，我无法保证列表中至少有一个元素，只要列表中至少有一个元素，一切都会正常工作，但如果列表为空， DataGridView 多次抛出 System.IndexOutOfRangeException。如果我从非零元素数变为零，DataGridView 中的行不会消失。

我尝试了一种解决方法，即删除所有元素，添加一个“虚拟”元素，然后将列表重新绑定到控件，但它仍然不起作用。

此外，在所有这些异常之后，当我将鼠标悬停在 DataGridView 中的单元格上时，我会遇到其他类似的异常。

几个小时以来，我一直试图追踪这种行为。有什么见解吗？谢谢！

如果需要，将很乐意添加更多信息。

**更新：** AssetIdentifier 的一些成员是“Nothing”，但我在构造函数中修复了它，异常仍然发生。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-09-08T23:36:53.280

重构代码，它可以工作......

# algorithm - 按位和处理添加和删除项目的有效方法

> ID：937719
> 
> 赞同：2
> 
> 时间：2009-06-02T02:46:27.687
> 
> 标签：algorithm, language-agnostic, data-structures

因此，假设您有一个项目集合。每个项目都有一个标识符，可以使用位域来表示。举个简单的例子，假设你的集合是：0110, 0111, 1001, 1011, 1110, 1111

所以，然后你想实现一个函数，`Remove(bool bitval, int position)`. 例如，调用`Remove(0, 2)`将删除索引 2（即第 3 位）为 0 的所有项目。在这种情况下，仅是 1001。 `Remove(1,1)`将删除 1110、1111、0111 和 0110。在可能的情况下提出 O(n) 集合是微不足道的（只需使用链表），其中 n 是集合中的项目数。一般来说，要删除的项目数将是 O(n)（假设给定位有 ≥ c% 的机会为 1 和 ≥ c% 的机会为 0，其中 c 是某个常数 > 0），所以“更好”的算法在某种程度上是 O(l)，其中 l 是被删除的项目数，是令人兴奋的。

是否可以定义一个数据结构，其中平均（或更好，最坏的情况）删除时间优于 O(n)？二叉树可以做得很好（只需删除高度 m 处的所有左/右分支，其中 m 是正在测试的索引），但我想知道是否有任何方法可以做得更好（老实说，我不知道如何以有效的方式移除特定高度的所有左或右分支）。或者，是否有证据表明不可能做得更好？

编辑：我不确定我对效率的期望是什么（对不起，Arno），但它可能的应用的基本解释是：假设我们正在使用二叉决策树。这样的树可以用于游戏树或解谜器或其他任何东西。进一步假设树足够小，我们可以将所有叶节点放入内存。每个这样的节点基本上只是一个列出所有决策的位域。现在，如果我们想从这棵树中修剪任意决策，一种方法是跳到做出特定决策的高度并修剪每个节点的左侧或右侧（左侧表示一个决策，右侧表示另一个） . 通常在决策树中，您一次只想修剪子树（因为该子树的父级与其他子树的父级不同，因此应该在一个子树中修剪的决策不应该从其他子树中修剪），但在某些类型的情况可能并非如此。此外，您通常只想修剪特定节点下方的所有内容，但在这种情况下，您将在节点下方留下一些内容，但也会修剪树中其他节点下方的内容。

无论如何，这在某种程度上是基于好奇的问题。我不确定使用任何结果是否实用，但我对人们不得不说的内容感兴趣。

编辑：进一步考虑，我认为树方法实际上是 O(n / logn)，假设它相当密集。证明：假设你有一棵包含 n 项的二叉树。它的高度是 log(n)。移除一半的底部将需要 n/2 次移除。删除上面行的一半将需要 n/4。每行的操作总和为 n-1。所以平均移除次数是 n-1 / log(n)。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T03:14:29.567

如果您的位域的长度是有限的，以下可能会起作用：

*   首先，将集合中的位域表示为布尔数组，因此在您的情况下（4位位域），`new bool[16];`
*   将这个布尔数组本身转换成一个位域，所以在这种情况下是一个 16 位的位域，其中每个位表示是否包含与其索引对应的位域

然后操作变为：

*   `Remove(0, 0)`= 并且位掩码为 1010101010101010
*   `Remove(1, 0)`= 并带有位掩码 0101010101010101
*   `Remove(0, 2)`= 并且位掩码为 1111000011110000

请注意，更复杂的“添加/删除”操作也可以添加为 O(1) 位逻辑。

唯一的缺点是需要额外的工作来将生成的 16 位位域解释回一组值，但查找数组也可能不会太糟糕。

**附录：**
其他缺点：

*   一旦超过整数的大小，原始位域的每个添加位都会使存储空间翻倍。然而，这并不比使用另一个集合的典型场景差多少，在这个集合中，您必须平均存储一半可能的位掩码值（假设典型场景不会存储少得多的剩余值）。

*   一旦超过整数的大小，每个添加的位也会使实现逻辑所需的“与”操作数加倍。

所以基本上，我会说如果你的原始位域不比一个字节大很多，那么你可能会更好地使用这种编码，除此之外你可能会更好地使用原始策略。

**进一步的附录：**
如果你只执行`Remove`操作，随着时间的推移，设置的状态空间越来越薄，你可以通过做一个更聪明的抽象来进一步扩展这种方法（不是双关语），以某种方式只保留跟踪`int`非零值。如果 JIT 知道它在做什么，那么检测零值可能并不像听起来那么昂贵，因为如果结果为零，CPU 的“与”操作通常会设置“零”标志。

与所有性能优化一样，这需要一些测量来确定它是否值得。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T19:42:24.130

如果使用数组存储二叉树，则可以快速索引任何元素（索引 n 处的节点的子节点位于索引 (n+1)*2 和 (n+1)*2-1。所有节点在给定级别按顺序存储。在级别 x 的第一个节点是 2^x-1 并且在该级别有 2^x 个元素。

不幸的是，从复杂性的角度来看，我认为这并不能真正让你得到什么。删除一个级别的所有左侧节点是 O(n/2) 最坏的情况，当然是 O(n)。当然，实际工作取决于您检查的是哪个位，因此平均值可能会更好一些。这也需要 O(2^n) 内存，这比链表差得多，而且根本不实用。

我认为这个问题真正要求的是一种有效地将一组集合分成两组的方法。使用 bitset 来描述该集合可以让您快速检查成员资格，但似乎无法让问题变得更容易。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T04:14:28.303

如果每个决策位和位置都被列为对象，{bit value, k-th position}，你最终会得到一个长度为 2*k 的数组。如果您从您的项目链接到这些数组位置中的每一个，表示为链表（长度为 k），使用指向 {bit, position} 对象的指针作为节点值，您可以“无效”一堆只需删除 {bit, position} 对象即可。这将要求您在搜索项目列表时找到“完整”项目（它使搜索真的很慢？）。

所以像：[{0,0}, {1,0}, {0,1}, {1, 1}, {0,2}, {1, 2}, {0,3}, {1, 3}]

并从“0100”链接，表示为：{0->3->4->6}

在您尝试找到它们之前，您不会知道哪些项目是无效的（因此它不会真正限制您的搜索空间，这就是您所追求的）。

哦，好吧，我试过了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T04:20:03.890

当然，这是可能的（即使这是“作弊”）。只需保留一堆 Remove 对象：

```
struct Remove {
    bool set;
    int index;
} 
```

remove 函数只是将一个对象压入堆栈。中提琴，O（1）。

如果你想变得花哨，你的堆栈不能超过（位数）而不包含重复或不可能的场景。

每当事物被撤回或迭代时，集合的其余部分必须应用逻辑。

插入集合的两种方法：

1.  在插入时应用删除规则，以清除堆栈，在 O(n) 中进行。必须在某个地方付款。
    *   每个位域都必须将其索引存储在删除堆栈中，以了解适用于它的规则。然后，上面的堆栈大小限制无关紧要

# django - Django 1.1 beta 1 - Flatpages 错误，Debug = False，带有 404.html

> ID：937721
> 
> 赞同：2
> 
> 时间：2009-06-02T02:47:16.280
> 
> 标签：django, django-flatpages

Django flatpages 应用程序有一个众所周知且经常在网络上讨论的错误，该错误与项目模板目录中缺少的*404.html “页面未找到”模板有关。*如果您的*settings.py*文件中有 DEBUG = False，并且您缺少*404.html*文件，则平面页面将生成 500 服务器错误而不是加载平面页面，因为项目会尝试查找*404.html*模板，并且生成 500 是因为它不存在。

我的问题与此不同。我的模板目录中确实有一个*404.html*，连接到我的项目中，连接了中间件，每个平面页面的 SITE_ID 都是正确的，并且存在*templates/flatpages/default.html*文件。

当我尝试加载任何平面页面时，我的自定义*404.html*错误页面返回给我。因此，404 模板正在工作，但在返回 404 之前，平面中间件似乎没有检查平面模型中的 URL。

有没有其他人经历过这个和/或找到解决方案？这是一个测试版，所以当我输入时，也许一个解决方案正在开发中。我正在使用 Django 1.1 beta 1。

这是我的整个 MIDDLEWARE_CLASSES：

```
MIDDLEWARE_CLASSES = (
    'django.middleware.common.CommonMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.flatpages.middleware.FlatpageFallbackMiddleware',
    'djangodblog.DBLogMiddleware',
    'ecomstore.SSLMiddleware.SSLRedirect',
    'ecomstore.marketing.urlcanon.URLCanonicalizationMiddleware',
    'django.contrib.redirects.middleware.RedirectFallbackMiddleware',
) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-20T10:33:16.273

我浏览了平面页面资源并通过在管理区域的页面 URL 末尾添加斜杠解决了同样的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-08T23:05:58.913

我今天遇到了类似的问题。经过大量检查后，我终于通过为有问题的平面页面打开“启用评论”（在管理界面中）来修复它......

在[http://www.petersanchez.com/2007/08/19/django-flatpages-wtf/](http://www.petersanchez.com/2007/08/19/django-flatpages-wtf/)页面上 ，Peter Sanchez 列出了 4 项检查，但对我来说没有帮助。

# iphone - iPhone、Android 和 Blackberry 的移动开发

> ID：937724
> 
> 赞同：4
> 
> 时间：2009-06-02T02:48:55.373
> 
> 标签：iphone, android, blackberry, cordova

我最近偶然发现了PhoneGap，我喜欢这个概念，但我无法在Android 应用程序上进行第一次尝试。文档跳过了一些细节，评论中充满了遇到问题的人。

有没有人在运行PhoneGap？你为安卓做了什么调整？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-03T20:34:54.970

大约有 3 种不同的框架，PhoneGap、QuickConnect 和 Rhomobile。

QuickConnect 和 Rhomobile 至少对于 Android 支持有更好的文档。

我使用了一点PhoneGap，然后切换到QuickConnect 和Rhomobile。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-05T15:51:13.780

我是如何设置 phonegap 的，使用 Linux liveCD 启动，进入 phonegap 文件夹，然后运行 ​​makefile。它将生成 javascript 文件。将 phonegap.js 复制到资产中，再次使用 Windows 启动并将 phonegap javascript 文件包含在您的主 html 中。

# .net - 以编程方式获取表的外键约束

> ID：937732
> 
> 赞同：3
> 
> 时间：2009-06-02T02:54:15.503
> 
> 标签：.net, vb.net, datatable, foreign-keys

我正在尝试使用 DataTable 来获取 SQL Server DB 的架构。
但是，当尝试检测 ForeignKeys 时，约束集合只带来 UNIQUE 约束。

```
Private Sub ShowConstraints(ByVal tableName As String)

    Dim table As DataTable = New DataTable(tableName)
    Using connection As SqlConnection = New SqlConnection(GetConnectionString)

        Dim adapter As SqlDataAdapter = New SqlDataAdapter("Select top 1 * from " + _                  
                                                  tableName, connection)
        connection.Open()
        adapter.FillSchema(table, SchemaType.Mapped)

        For Each c As Constraint In table.Constraints
            If TypeOf c Is ForeignKeyConstraint Then
                Dim fk As ForeignKeyConstraint = CType(c, ForeignKeyConstraint)
                Console.WriteLine("** FK ** relatedTable: {0}; RelatedColumns: {1}", _
                    fk.RelatedTable, fk.RelatedColumns)
            Else
                Console.WriteLine("** Whatever ** Name: {0}; Type: {1}", _
                                           c.ConstraintName, c.GetType.ToString)
            End If
        Next

    End Using

End Sub 
```

**如何获得 ForeignKey 约束？**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-02T02:56:18.290

嗯，这是出乎意料的。事实证明，FillSchema 方法毕竟没有返回外键信息。我有一些看起来应该这样做的示例代码，但实际上并没有。

如果您真正想要的是一种编程方式来查询数据库中的所有 FK，那么请从您的代码中尝试这个系统存储过程。

msdb.dbo.sp_Help 'tableName'

它返回一个数据集。第 7 个表具有表的所有约束，包括 FK。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T04:24:55.217

我最终使用了对模式的直接查询。感觉不对，但可以完成工作：

```
Private Sub ShowFKs()
    Dim sqlstmt As New StringBuilder

    sqlstmt.Append(" SELECT ")
    sqlstmt.Append("    rc.CONSTRAINT_NAME,         ")
    sqlstmt.Append("    rcu.TABLE_NAME 'Referencing Table', ")
    sqlstmt.Append("    rcu.COLUMN_NAME 'Referencing Column',")
    sqlstmt.Append("    rcu1.TABLE_NAME 'Referenced Table',")
    sqlstmt.Append("    rcu1.COLUMN_NAME 'Referenced Column'")
    sqlstmt.Append(" FROM")
    sqlstmt.Append("    INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS rc")
    sqlstmt.Append(" INNER JOIN ")
    sqlstmt.Append("    INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE rcu ")
    sqlstmt.Append("      ON rc.CONSTRAINT_CATALOG = rcu.CONSTRAINT_CATALOG ")
    sqlstmt.Append("         AND rc.CONSTRAINT_NAME = rcu.CONSTRAINT_NAME")
    sqlstmt.Append(" INNER JOIN ")
    sqlstmt.Append("    INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE rcu1 ")
    sqlstmt.Append("      ON rc.UNIQUE_CONSTRAINT_CATALOG = rcu1.CONSTRAINT_CATALOG ")
    sqlstmt.Append("         AND rc.UNIQUE_CONSTRAINT_NAME = rcu1.CONSTRAINT_NAME")

    Using connection As SqlConnection = New SqlConnection(GetConnectionString)
        Dim cmd As New SqlCommand(sqlstmt.ToString, connection)
        Dim reader As SqlDataReader

        cmd.CommandType = CommandType.Text

        connection.Open()
        reader = cmd.ExecuteReader(CommandBehavior.CloseConnection)

        Do While reader.Read
            For i As Integer = 0 To reader.FieldCount - 1
                Console.WriteLine("** {0} = {1}", reader.GetName(i), reader.GetValue(i).ToString)
            Next
            Console.WriteLine("---------------------")
        Loop
    End Using

End Sub 
```

此问题的信息：[查询以获取 SQL Server 2000 中的所有外键约束](https://stackoverflow.com/questions/831589/query-to-get-all-foreign-key-constraints-in-sqlserver-2000)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T04:09:54.090

嗯，如果 DataRelations 被禁用或者没有强制或级联约束，则可能不会填充 ForeignKeyConstraint 对象。

但是，这可能有效：

```
 Private Sub ShowConstraints(ByVal tableName As String)

    Dim table As DataTable = New DataTable(tableName)
    Using connection As SqlConnection = New SqlConnection(GetConnectionString)

        Dim adapter As SqlDataAdapter = New SqlDataAdapter("Select top 1 * from " + _
                                                  tableName, connection)
        connection.Open()
        adapter.FillSchema(table, SchemaType.Mapped)

        Console.WriteLine(" ** Parent Relations ** ")
        For Each dr As DataRelation In table.ParentRelations
            Console.Write("name: {0}: ", dr.RelationName)
            Dim fk As ForeignKeyConstraint = dr.ChildKeyConstraint
            If Not (fk Is Nothing) Then
                Console.WriteLine(" RelatedTable {0}; RelatedColums {1}", _
                    fk.RelatedTable, fk.RelatedColumns)
            Else
                Console.WriteLine(" no constraint.")
            End If
        Next

        Console.WriteLine(" ** child Relations ** ")
        For Each dr As DataRelation In table.ChildRelations
            Console.Write("name: {0}: ", dr.RelationName)
            Dim fk As ForeignKeyConstraint = dr.ChildKeyConstraint
            If Not (fk Is Nothing) Then
                Console.WriteLine(" RelatedTable {0}; RelatedColums {1}", _
                    fk.RelatedTable, fk.RelatedColumns)
            Else
                Console.WriteLine(" no constraint.")
            End If
        Next
    End Using

End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T03:52:31.357

查询**information_schema**表（ oracle 的**user_tables** / **all_tables**） - 它们包含有关您的数据库的元数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-02T04:10:51.703

最好的方法是直接查询*information_schema*表：

```
 SELECT 
      cu.TABLE_SCHEMA + '.' + cu.TABLE_NAME AS TABLE_NAME 
    , cu.COLUMN_NAME 
    , rc.CONSTRAINT_NAME AS FK_NAME 
    , rc.UNIQUE_CONSTRAINT_NAME AS REFERENCE 
   FROM INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE cu INNER JOIN INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS rc 
       ON cu.CONSTRAINT_NAME = rc.CONSTRAINT_NAME 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-07-02T07:58:19.877

这个查询对我有用。

```
SELECT rc.[CONSTRAINT_NAME]
  ,fk.[TABLE_NAME]
  ,fk.[COLUMN_NAME]
  ,pk.[TABLE_NAME]
  ,pk.[COLUMN_NAME]
 FROM [LocalV4].[INFORMATION_SCHEMA].[REFERENTIAL_CONSTRAINTS] rc
 inner join [LocalV4].[INFORMATION_SCHEMA].[CONSTRAINT_COLUMN_USAGE] fk on fk.[CONSTRAINT_NAME] = rc.[CONSTRAINT_NAME]
 inner join [LocalV4].[INFORMATION_SCHEMA].[CONSTRAINT_COLUMN_USAGE] pk on pk.[CONSTRAINT_NAME] = rc.[UNIQUE_CONSTRAINT_NAME] 
```

# mysql - mysql性能对比

> ID：937734
> 
> 赞同：0
> 
> 时间：2009-06-02T02:55:32.880
> 
> 标签：mysql, performance, insert

哪个更有效率，多少？

类型 1：

```
insert into table_name(column1,column2..) select column1,column2 ... from another_table where 

columnX in (value_list) 
```

类型 2：

```
insert into table_name(column1,column2..) values (column1_0,column2_0..),(column1_1,column2_1..) 
```

第一版看起来很短，第二版可能会变得非常长，当 value_list 包含时，比如 500 甚至更多的值。

但我不知道谁的表现会更好，虽然感觉第一个应该更有效，直观。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T03:08:25.990

第一个更干净，特别是如果您的列已经在 mysql 中（我假设您在说？）。您可以在发送数据和解析时间的网络开销上节省一些时间，并且不必担心达到客户端的任何查询大小限制。

但是，总的来说，我希望随着行数的增加，性能会相似，尤其是在索引良好的表上。插入大型查询的大部分时间都花在构建索引之类的事情上（请参阅[此处](http://dev.mysql.com/doc/refman/5.0/en/insert-speed.html)），而这两个查询（如果没有关闭索引）都必须这样做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T03:23:43.837

我同意 Todd，第一个查询更简洁，发送到 MySQL 服务器的速度更快，编译速度也更快。而且随着插入记录数量的增加，速度差异会下降，这可能是真的。

但第**一种形式**还有很多其他好处需要考虑：

*   它更容易维护：您只需不时添加或修改一个字段。
*   您避免了查询 another_table 和处理结果以连接第二个查询的费用（该方法的隐藏成本）。
*   如果您需要多次运行此更新，则可以将第一个查询连同其编译后的表单和查询计划一起缓存在 MySQL 服务器中。这使得查询的后续调用运行得更快一些。

# php - 有没有可以帮助我正确引用 SQL 字符串的服务？

> ID：937735
> 
> 赞同：0
> 
> 时间：2009-06-02T02:55:58.620
> 
> 标签：php, sql, mysql

我很难正确引用 SQL 字符串，我想知道是否有程序或网站可以帮助我正确引用该字符串。我可以在哪里输入 SQL 字符串，然后网站将为我分析和引用它。或者也许是一个程序..我需要它，因为我遇到了他们的麻烦..

抱歉没有提供关于我的问题的详细信息，我有这个 SQL 字符串。我从一本书中得到它，但我很难正确引用它。

```
$sql = "INSERT INTO books(title, author, isbn, publisher, year, summary) VALUES (" .$conn->quote($_POST['title']) .
', ' . $conn->quote($_POST['author']) .
', ' . $conn->quote($_POST['isbn']) .
', ' . $conn->quote($_POST['publisher']) .
', ' . $conn->quote($_POST['year']) .
', ' . $conn->quote($_POST['summary']) .
')'; 
```

您可以看到那里发生了许多报价！我从一本书中得到它，但是当我需要以同样的困难设计自己的 SQL 字符串时，也许我会分裂。

你有什么推荐的网站或程序可以帮助我正确地转义/引用字符串吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-02T02:59:34.540

你能更具体一点吗？在编写 ADO.NET 代码时，您通常会使用这样的 SqlParameter 对象，它会自动处理所有这些内容：

```
var cmd = new SqlCommand("select * from foo where fooName = @fooName;", connection);
cmd.Parameters.AddWithValue("@fooName", "O'Reilly is a bloviator");
cmd.ExecuteReader(); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-02T05:09:42.150

好的，看起来您正在使用 PHP。您不应手动引用，而应使用准备好的语句。以下是使用 PDO 的一种方法。其他有效语法在[PDOStatement->execute](http://us2.php.net/manual/en/pdostatement.execute.php)中给出：

```
$stmt = $db->prepare("INSERT INTO books(title, author, isbn, publisher, year, summary) VALUES(:title, :author, :isbn, :publisher, :year, :summary)");
$title="Hitchhiker's Guide";
$author="Douglas Adams";
$isbn="0345391802";
$publisher="Del Rey";
$year="1995";
$summary="Arthur Dent accidentally saves the world.";
$stmt->bindParam(":title", $title);
$stmt->bindParam(":author", $author);
$stmt->bindParam(":isbn", $isbn);
$stmt->bindParam(":publisher", $publisher);
$stmt->bindParam(":year", $year);
$stmt->bindParam(":summary", $summary);
$stmt->execute(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T03:20:26.200

在编写 sql 时对我帮助最大的是一个好的文本编辑器，它可以突出显示文本。关于使用哪个文本编辑器有很多讨论。我更喜欢 vi，但我很肯定 emacs 也会这样做，还有 eclipse 以及几乎所有不是普通旧 Windows 记事本的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T05:55:27.420

> 你有什么推荐的网站或程序可以帮助我正确地转义/引用字符串吗？

如果调用的设置打开，您可能不需要转义**php**`magic_quotes_gpc`中的字符串。您可以通过编写包含以下代码的 php 文件来确定它是否打开：

```
<?php
    var_dump(get_magic_quotes_gpc());
?> 
```

它将显示 bool(true) 或 bool(false)。如果为假，则使用调用的函数`mysql_real_escape_string`进行转义。如果是真的，你不需要做任何事情，你的输入会被自动转义。记住，不要两者都做，你不想逃避两次。或者，您可以使用此功能来确定您是否需要转义：

```
<?php
    function clean($input) {
        if (get_magic_quotes_gpc()) {
            // magic quotes are on, no need to escape
            return $input;
        } else {
            // magic quotes are off, we need to escape
            return mysql_real_escape_string($input);
    }
?> 
```

然后像这样使用它：

```
<?php
    $result = mysql_query(sprintf('SELECT * FROM `table` WHERE user="%s"', clean($_POST['user'])));
?> 
```

我无法检查我提交的代码是否存在拼写错误，但希望......

# python - 独立使用 Django ORM

> ID：937742
> 
> 赞同：64
> 
> 时间：2009-06-02T02:58:16.167
> 
> 标签：python, django, postgresql, orm

> **可能的重复：**
> [仅使用 Django 的某些部分？](https://stackoverflow.com/questions/302651/use-only-some-parts-of-django)
> [仅使用 Django 的 DB 部分](https://stackoverflow.com/questions/579511/using-only-the-db-part-of-django)

我想独立使用 Django ORM。尽管在谷歌上搜索了一个小时，我仍然有几个问题：

*   是否需要我使用 setting.py、/myApp/ 目录和 modules.py 文件来设置我的 Python 项目？
*   我可以创建一个新的`models.py`并运行`syncdb`它以自动设置表和关系，还是只能使用现有 Django 项目中的模型？
*   似乎有很多关于`PYTHONPATH`. 如果您不调用现有模型，是否需要这样做？

我想最简单的事情是让某人发布一个基本模板或流程演练，阐明文件的组织，例如：

```
db/
   __init__.py
   settings.py
   myScript.py
orm/
   __init__.py
   models.py 
```

和基本要领：

```
# settings.py
from django.conf import settings

settings.configure(
     DATABASE_ENGINE   = "postgresql_psycopg2",
     DATABASE_HOST     = "localhost",
     DATABASE_NAME     = "dbName",
     DATABASE_USER     = "user",
     DATABASE_PASSWORD = "pass",
     DATABASE_PORT     = "5432"
)

# orm/models.py
# ...

# myScript.py
# import models.. 
```

以及您是否需要运行以下内容：`django-admin.py inspectdb`...

（哦，如果这改变了有关命令行参数的任何内容，我正在运行 Windows。）。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-06-02T07:50:11.277

啊，好吧，我想通了，并将为任何尝试做同样事情的人发布解决方案。

此解决方案假定您要创建新模型。

首先创建一个新文件夹来存储您的文件。我们将其称为“独立”。在“standAlone”中，创建以下文件：

```
__init__.py
myScript.py
settings.py 
```

显然“myScript.py”可以随便命名。

接下来，为您的模型创建一个目录。

我们将模型目录命名为“myApp”，但要意识到这是项目中的普通 Django 应用程序，因此，请将其命名为您正在编写的模型集合。

在此目录中创建 2 个文件：

```
__init__.py
models.py 
```

您将需要来自现有 Django 项目的 manage.py 副本，或者您可以从 Django 安装路径中获取副本：

```
django\conf\project_template\manage.py 
```

将 manage.py 复制到您的 /standAlone 目录。好的，所以您现在应该具有以下结构：

```
\standAlone
    __init__.py
    myScript.py
    manage.py
    settings.py
\myApp
    __init__.py
    models.py 
```

**将以下内容添加到您的 myScript.py 文件中：**

```
# settings.py
from django.conf import settings

settings.configure(
    DATABASE_ENGINE    = "postgresql_psycopg2",
    DATABASE_NAME      = "myDatabase",
    DATABASE_USER      = "myUsername",
    DATABASE_PASSWORD  = "myPassword",
    DATABASE_HOST      = "localhost",
    DATABASE_PORT      = "5432",
    INSTALLED_APPS     = ("myApp")
)

from django.db import models
from myApp.models import * 
```

**并将其添加到您的 settings.py 文件中：**

```
 DATABASE_ENGINE    = "postgresql_psycopg2"
    DATABASE_NAME      = "myDatabase"
    DATABASE_USER      = "myUsername"
    DATABASE_PASSWORD  = "myPassword"
    DATABASE_HOST      = "localhost"
    DATABASE_PORT      = "5432",
    INSTALLED_APPS     = ("myApp") 
```

**最后是你的 myApp/models.py：**

```
# myApp/models.py
from django.db import models

class MyModel(models.Model):
     field = models.CharField(max_length=255) 
```

就是这样。现在让 Django 管理您的数据库，在命令提示符下导航到我们的 /standalone 目录并运行：

```
manage.py sql MyApp 
```

# c++ - 函数模板特化格式

> ID：937744
> 
> 赞同：30
> 
> 时间：2009-06-02T02:59:26.383
> 
> 标签：c++, templates, syntax, template-specialization

以下函数模板中第二个括号 <> 的原因是什么：

```
template<> void doh::operator()<>(int i) 
```

这出现在[SO question](https://stackoverflow.com/questions/937107/do-template-specializations-require-template-syntax)中，有人建议在 之后缺少括号`operator()`，但是我找不到解释。

如果它是以下形式的类型专业化（完全专业化），我理解其含义：

```
template< typename A > struct AA {};
template<> struct AA<int> {};         // hope this is correct, specialize for int 
```

但是对于函数模板：

```
template< typename A > void f( A );
template< typename A > void f( A* ); // overload of the above for pointers
template<> void f<int>(int);         // full specialization for int 
```

这在哪里适合这个场景？：

```
template<> void doh::operator()<>(bool b) {} 
```

似乎可以工作并且没有给出任何警告/错误的示例代码（使用 gcc 3.3.3）：

```
#include <iostream>
using namespace std;

struct doh
{
    void operator()(bool b)
    {
        cout << "operator()(bool b)" << endl;
    }

    template< typename T > void operator()(T t)
    {
        cout << "template <typename T> void operator()(T t)" << endl;
    }
};
// note can't specialize inline, have to declare outside of the class body
template<> void doh::operator()(int i)
{
    cout << "template <> void operator()(int i)" << endl;
}
template<> void doh::operator()(bool b)
{
    cout << "template <> void operator()(bool b)" << endl;
}

int main()
{
    doh d;
    int i;
    bool b;
    d(b);
    d(i);
} 
```

输出：

```
operator()(bool b)
template <> void operator()(int i) 
```

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-06-02T03:06:24.993

我查了一下，发现是14.5.2/2指定的：

> 本地类不应有成员模板。访问控制规则（第 11 条）适用于成员模板名称。析构函数不应是成员模板。具有给定名称和类型的普通（非模板）成员函数和可用于生成相同类型的特化的同名成员函数模板都可以在类中声明。当两者都存在时，除非提供了显式模板参数列表，否则使用该名称和类型指的是非模板成员。

它提供了一个例子：

```
template <class T> struct A {
    void f(int);
    template <class T2> void f(T2);
};

template <> void A<int>::f(int) { } // non-template member
template <> template <> void A<int>::f<>(int) { } // template member

int main()
{
    A<char> ac;
    ac.f(1); //non-template
    ac.f(’c’); //template
    ac.f<>(1); //template
} 
```

请注意，在标准术语中，`specialization`指的是您使用显式特化编写的函数和使用实例化生成的函数，在这种情况下，我们必须处理生成的特化。`specialization`不仅仅指您使用显式特化模板创建的函数，它通常仅用于该模板。

结论：GCC 弄错了。Comeau，我也用它测试了代码，得到它并发出诊断：

> `"ComeauTest.c"`，第 16 行：错误：`"void doh::operator()(bool)"`不是可以显式特化的实体 `template<> void doh::operator()(bool i)`

Note that it isn't complaining about the specialization of the template for `int` (only for `bool`), since it doesn't refer to the same name *and* type: The function type that specialization would have is `void(int)`, which is distinct from the function type of the non-template member function, which is `void(bool)`.

# java - Java 中的 Tail -n 1000 （Apache commons 等）

> ID：937747
> 
> 赞同：5
> 
> 时间：2009-06-02T03:00:00.093
> 
> 标签：java, tail

我想知道是否已经存在用于实现部分/全部 *NIX 尾部的 util 代码。我想将某个文件/阅读器的最后 n 行复制到另一个文件/阅读器等。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T03:09:18.483

这似乎是一个不错的选择：[Tailer Library](http://www.informit.com/guides/content.aspx?g=java&seqNum=226)。[此实现](http://snipplr.com/view/4859/simple-tail-like-assertion/)基于它，但并不相同。不过，两者都没有实现回溯以获取最后 100 行。:(

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T09:52:06.100

您可以在[Heritrix](http://crawler.archive.org)的一个实用程序类中查看这个[尾部实现。](http://crawler.archive.org/xref-test/org/archive/crawler/util/LogReader.html#762)我没有写它，但我写了使用它的代码，据我所知，它可以正常工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T05:27:57.743

“最后 n 行”对于潜在的可变宽度编码等非常棘手。

我在 C# 中编写了一个反向行迭代器以响应[另一个 SO question](https://stackoverflow.com/questions/452902/how-to-read-a-text-file-reversely-with-iterator-in-c)。代码就在那里，尽管它使用了 C# 中不可用的迭代器块 - 你最好将所需的大小传递给方法并让它构建一个列表。（然后您可以将`yield return`我代码中的语句转换为`list.add()`调用。）您当然需要使用 Java`Charset`而不是`Encoding`，它们的 API 也略有不同。最后，您需要在完成后反转列表。

这一切都假设您*不想*只阅读整个文件。如果您不介意这样做，您可以使用循环缓冲区来保留“此刻的最后 n 行”，通读到最后并在之后返回缓冲区。这实现起来会简单*得多*，但对于非常长的文件来说效率会低得多。不过，它很容易应对*任何*读者，而不是只在流上选择几个选定的字符集（我的反向迭代器就是这样做的）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T04:39:23.763

这是一个 UI 应用程序 - 您可以查看源代码以了解它的作用（基本上是一些线程和 IO）。[跟随](http://follow.sourceforge.net/)。

# silverlight - 从 silverlight 线或区域系列中删除标记

> ID：937755
> 
> 赞同：1
> 
> 时间：2009-06-02T03:03:12.473
> 
> 标签：silverlight, charts

是否可以轻松地从线系列或面积系列图表中删除数据点标记。我正在使用 Silverlight Toolkit 图表。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-02T03:58:17.677

找到了：

```
<chartingToolkit:AreaSeries ItemsSource="{Binding Path=ChartData}" DependentValuePath="used" IndependentValuePath="date" IsSelectionEnabled="True">
<chartingToolkit:AreaSeries.DataPointStyle>
    <Style TargetType="Control">
        <Setter Property="Visibility" Value="Collapsed" />
    </Style>
</chartingToolkit:AreaSeries.DataPointStyle> 
```

# iphone - UIView 的 addSubview 真的保留视图吗？

> ID：937767
> 
> 赞同：12
> 
> 时间：2009-06-02T03:09:18.890
> 
> 标签：iphone, cocoa-touch, uikit

我遇到了一个似乎暗示相反的情况。在下面的代码片段中，如果我删除该行：self.navigationController = nav，根控制器的视图将不会显示，这表明 addSubview 可能实际上不会像其他建议的那样保留视图。任何的想法？

```
- (void)applicationDidFinishLaunching:(UIApplication *)application {   
   self.testViewController = [[TestViewController alloc] initWithNibName:@"TestView" bundle:  [NSBundle mainBundle]];

   UINavigationController *nav = [[UINavigationController alloc]  initWithRootViewController:self.testViewController];

   self.navigationController = nav;  //<-- if this line is removed, test view won't show up

   [window addSubview:nav.view];

   [nav release];
} 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-06-02T06:26:47.010

这一行：

```
[window addSubview:nav.view]; 
```

不会立即向屏幕添加视图。它由操作系统在可能不同的线程上的某个未来运行循环中显示。我们无法确定的实际实现。

这就是 Apple 定义像 viewDidAppear/viewWillAppear 这样的委托方法的原因，否则我们不需要它们，因为我们会准确地知道这些事件何时发生。

此外，如您所说，添加子视图确实保留了视图。但是它不**保留**视图控制器或导航控制器。由于导航控制器**将**保留任何添加的视图控制器，我们不必用 ivar 支持它们。

但是，您对导航控制器的引用**必须**超出该方法的范围。或者根据您的代码，它可能会被解除分配或丢失其引用。

因此，您必须使用 ivar 保留对导航控制器的引用并将其设置为：

```
self.navigationController = nav; 
```

因此，即使 nav.view 包含一个指向 testViewController.view 的指针，应用程序也没有引用导航控制器，进而也没有引用视图。结果是一个空白屏幕。

* * *

为了使这不是保留/释放问题更明显，您实际上是在以下方法中泄漏：

```
self.testViewController = [[TestViewController alloc] initWithNibName:@"TestView" bundle: [NSBundle mainBundle]]; 
```

您需要通过以下方式自动释放以平衡您的保留/释放：

```
self.testViewController = [[[TestViewController alloc] initWithNibName:@"TestView" bundle: [NSBundle mainBundle]] autorelease]; 
```

因此，这意味着您的视图在您运行此代码时从未被释放过。这进一步向我们保证，您的问题确实是一个丢失的参考。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T03:45:33.960

问题可能不是视图没有保留，而是控制器没有保留。

没有这一行：

```
self.navigationController = nav 
```

没有任何东西保留导航控制器。让视图比控制器更有效会很奇怪。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T03:23:33.277

对我来说，这看起来不像是一个保留/释放问题。如果您注释掉，您的视图将不会显示，`self.navigationController = nav;`因为在下一行中，`[window addSubview:self.navigationController.view]`您的 self.navigationController 属性将不会被设置。它可能是 nil 或者它会崩溃，但如果没有更多代码就不能肯定地说。

# c# - 亚音速定制采集类型

> ID：937772
> 
> 赞同：1
> 
> 时间：2009-06-02T03:11:37.450
> 
> 标签：c#, subsonic, collections

这似乎是一个简单的问题，但是我花了最后一个小时试图解决这个问题。

我想创建一个自定义亚音速集合，以便我可以使用 .ExecuteAsCollection<>(); 填充来自具有多个连接的查询的数据；方法。

我已经创建了自定义类和自定义集合，甚至创建了一个带有 load 方法的控制器，但是我不断从 ExecuteAsCollection<>();

堆栈轨道说它来自 SubSonic.Load 方法的错误。

我已经省略了所有其他亚音速课程都有的课程“SQLProps”，但我希望我不必费力地通过每个领域。

我必须有一些简单的东西。这样做的人可以让我快速了解亚音速使用查询填充自定义集合所需的内容吗？

谢谢道格

更新：

我忘了提到我还在我的所有列中添加了公共 Columns 结构。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T04:22:13.347

ExecuteAsCollection<T>() 仅适用于 SubSonic 生成的集合。您可以使用 ExecuteTypedList<T>() 将查询结果映射到任意对象类型。这会将查询返回的列与具有相同名称的 T 类型的属性相匹配，并为您提供 List<T>。

# c++ - 如何确定 C++ 中对象的大小？

> ID：937773
> 
> 赞同：51
> 
> 时间：2009-06-02T03:11:51.990
> 
> 标签：c++, class, memory, size, memory-management

例如，假设我有一个 Temp 类：

```
class Temp
{
    public:
        int function1(int foo) { return 1; }
        void function2(int bar) { foobar = bar; }

    private:
        int foobar;
}; 
```

当我创建 Temp 类的对象时，我将如何计算它需要多少空间，以及它在内存中的表示方式（例如| foobar 为 4 个字节| function1 为 8 个字节 | 等 | ）

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2009-06-02T03:27:17.027

对于一阶近似，对象的大小是其组成数据成员的大小之和。你可以肯定它永远不会小于这个。

更准确地说，编译器有权在数据成员之间插入填充空间，以确保每个数据成员满足平台的对齐要求。一些平台对对齐非常严格，而另一些（x86）则更宽容，但在正确对齐的情况下会表现得更好。因此，即使是编译器优化设置也会影响对象大小。

继承和虚函数增加了额外的复杂性。正如其他人所说，您的类的成员函数本身并不占用“每个对象”空间，但是该类接口中虚函数的存在通常意味着虚表的存在，本质上是用于查找函数指针的表动态解析正确的函数实现以在运行时调用。虚拟表 (vtbl) 通常通过存储在每个对象中的指针来访问。

派生类对象还包括其基类的所有数据成员。

最后，访问说明符（public、private、protected）赋予编译器一定的数据成员打包余地。

简短的回答是 sizeof(myObj) 或 sizeof(MyClass) 将始终告诉您对象的正确大小，但其结果并不总是容易预测。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-06-02T03:16:07.830

```
sizeof(Temp) 
```

会给你尺寸。最有可能的是，它是 4 个字节（给出了很多假设），并且仅适用于 int。这些函数在每个对象的基础上不占用任何空间，它们被编译一次，并在每次使用时由编译器链接。

不可能确切地说出对象布局是什么，但是，标准没有定义对象的二进制表示。

[使用二进制表示需要注意一些事项，例如由于结构填充](http://www.codeguru.com/forum/showthread.php?t=276622)等原因，它们不一定是数据成员字节的总和

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2017-07-08T01:42:34.357

我一直想知道这种事情，所以我决定想出一个完整的答案。这是关于你可能期望的，它是可以预测的（耶）！因此，通过以下信息，您应该能够预测类的大小。

使用 Visual Studio Community 2017（版本 15.2），*在禁用所有优化和 RTTI（[运行时类型信息](https://en.wikipedia.org/wiki/Run-time_type_information)）关闭*的发布模式下，我确定了以下内容：

* * *

**简短的回答：**

首先：

*   在 32 (x86) 位中，`<size of pointer> == 4`字节
*   在 64 (x64) 位中，`<size of pointer> == 8`字节
*   当我说“虚拟类继承”时，我的意思是：`class ChildClass: virtual public ParentClass`

现在，我的发现是：

*   空类为 1 个字节
*   空类的继承还是1字节
*   具有函数的空类仍然是 1 个字节（？！请参阅下面的**注释**以获取解释）
*   用函数继承空类还是1字节
*   将变量添加到空类是`<size of variable>`字节
*   继承一个带有变量的类并添加另一个变量是`<size of variables>`字节
*   **继承一个类并覆盖它的函数会添加一个 vtable（在结论**部分提供了进一步的解释）并且是`<size of pointer>`字节
*   简单地声明一个函数 virtual 也会添加一个 vtable，使其成为`<size of pointer>`字节
*   空类的虚拟类继承（有或没有成员函数）也添加了一个 vtable，并使类`<size of pointer>`字节
*   非空类的虚拟类继承也添加了一个 vtable，但它变得有些复杂：它将字节**添加** `<size of pointer>`到总数中，将所有成员变量**包装**`<size of pointer>`成尽可能多的字节增量以覆盖`<total size of member variables>`- 是的，你没看错...（请参阅我对**结论**中发生的事情的猜测...）

**请注意**，我什至尝试让 function() cout 一些文本，创建类的实例并调用该函数；它不会改变函数类的大小（这不是优化）！我有点惊讶，但这实际上是有道理的：成员函数不会改变，因此它们可以存储在类本身的外部。

**结论：**

*   空类是 1 个字节，因为这是它在内存中存在的最低要求。**但是，一旦添加了数据或 vtable 数据，就从 0 字节开始计数。**
*   添加（*非虚拟*）成员函数对大小没有任何影响，因为成员函数存储在外部。
*   将成员函数声明为虚拟（即使该类没有被覆盖！）或覆盖子类中的成员函数会添加所谓的[“vtable”或“虚拟函数表”](https://en.wikipedia.org/wiki/Virtual_method_table)，这允许[动态调度](https://en.wikipedia.org/wiki/Dynamic_dispatch)（这实际上是不过使用起来超级棒，我强烈推荐使用它）。此 vtable 消耗`<size of pointer>`字节，将`<size of pointer>`字节添加到所述类。当然，这个 vtable 每个类只能存在一次（它存在或不存在）。
*   添加成员变量会通过该成员变量增加类的大小，无论所述成员变量是在父类还是子类中（当然，父类仍然保持自己的大小）。
*   虚拟类继承是唯一变得复杂的部分......所以......我认为经过一些实验后发生的事情是：类的大小实际上`<size of pointer>`一次以字节为单位递增，即使它不需要消耗这么多内存，我猜是因为它为每个`<size of pointer>`字节的内存或其他东西添加了一个vtable“帮助块”......

* * *

**长答案：**

我使用以下代码确定了所有这些：

```
#include <iostream>

using namespace std;

class TestA
{

};

class TestB: public TestA
{

};

class TestC: virtual public TestA
{

};

class TestD
{
    public:
        int i;
};

class TestE: public TestD
{
    public:
        int j;
};

class TestF: virtual public TestD
{
    public:
        int j;
};

class TestG
{
    public:
        void function()
        {

        }
};

class TestH: public TestG
{
    public:
        void function()
        {

        }
};

class TestI: virtual public TestG
{
    public:
        void function()
        {

        }
};

class TestJ
{
    public:
        virtual void function()
        {

        }
};

class TestK: public TestJ
{
    public:
        void function() override
        {

        }
};

class TestL: virtual public TestJ
{
    public:
        void function() override
        {

        }
};

void main()
{
    cout << "int:\t\t" << sizeof(int) << "\n";
    cout << "TestA:\t\t" << sizeof(TestA) << "\t(empty class)\n";
    cout << "TestB:\t\t" << sizeof(TestB) << "\t(inheriting empty class)\n";
    cout << "TestC:\t\t" << sizeof(TestC) << "\t(virtual inheriting empty class)\n";
    cout << "TestD:\t\t" << sizeof(TestD) << "\t(int class)\n";
    cout << "TestE:\t\t" << sizeof(TestE) << "\t(inheriting int + int class)\n";
    cout << "TestF:\t\t" << sizeof(TestF) << "\t(virtual inheriting int + int class)\n";
    cout << "TestG:\t\t" << sizeof(TestG) << "\t(function class)\n";
    cout << "TestH:\t\t" << sizeof(TestH) << "\t(inheriting function class)\n";
    cout << "TestI:\t\t" << sizeof(TestI) << "\t(virtual inheriting function class)\n";
    cout << "TestJ:\t\t" << sizeof(TestJ) << "\t(virtual function class)\n";
    cout << "TestK:\t\t" << sizeof(TestK) << "\t(inheriting overriding function class)\n";
    cout << "TestL:\t\t" << sizeof(TestL) << "\t(virtual inheriting overriding function class)\n";

    cout << "\n";
    system("pause");
} 
```

* * *

**输出：**

32 (x86) 位：

```
int:            4
TestA:          1       (empty class)
TestB:          1       (inheriting empty class)
TestC:          4       (virtual inheriting empty class)
TestD:          4       (int class)
TestE:          8       (inheriting int + int class)
TestF:          12      (virtual inheriting int + int class)
TestG:          1       (function class)
TestH:          1       (inheriting function class)
TestI:          4       (virtual inheriting function class)
TestJ:          4       (virtual function class)
TestK:          4       (inheriting overriding function class)
TestL:          8       (virtual inheriting overriding function class) 
```

64 (x64) 位：

```
int:            4
TestA:          1       (empty class)
TestB:          1       (inheriting empty class)
TestC:          8       (virtual inheriting empty class)
TestD:          4       (int class)
TestE:          8       (inheriting int + int class)
TestF:          24      (virtual inheriting int + int class)
TestG:          1       (function class)
TestH:          1       (inheriting function class)
TestI:          8       (virtual inheriting function class)
TestJ:          8       (virtual function class)
TestK:          8       (inheriting overriding function class)
TestL:          16      (virtual inheriting overriding function class) 
```

* * *

如果您想了解有关多重继承的信息，**请自己弄清楚！-.-**

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-06-02T03:29:27.880

如果您想了解有关对象在运行时如何在内存中表示的详细信息，则可以查看 ABI（[应用程序二进制接口](http://en.wikipedia.org/wiki/Application_binary_interface)）规范。您需要确定您的编译器实现了哪个 ABI；例如，GCC 3.2 及更高版本实现了[Itanium C++ ABI](http://www.codesourcery.com/public/cxx-abi/)。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-06-02T03:30:36.867

方法属于类，而不是任何特定的实例化对象。

除非有虚方法，否则对象的大小是其非静态成员大小的总和，加上成员之间用于对齐的可选填充。成员可能会在内存中按顺序排列，但规范不保证具有不同访问规范的部分之间的顺序，也不保证相对于超类布局的顺序。

使用虚拟方法时，可能会为[vtable](http://en.wikipedia.org/wiki/Virtual_method_table)和其他 RTTI 信息占用额外的空间。

在大多数平台上，可执行代码位于可执行文件或库的只读`.text`（或类似名称）部分，并且永远不会被复制到任何地方。当`class Temp`有一个方法`public: int function1(int)`时，`Temp`元数据可能有一个指向`_ZN4Temp9function1Ei`实际实现的（损坏的名称可能因编译器而异）函数的指针，但它肯定永远不会包含嵌入的可执行代码。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-06-02T03:19:03.627

成员函数不考虑特定类的对象的大小。对象的大小仅取决于成员变量。对于包含虚函数的类，VPTR 被添加到对象布局中。所以对象的大小基本上是成员变量的大小 + VPTR 的大小。有时这可能不是真的，因为编译器试图在 DWORD 边界处定位成员变量。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-11-02T13:36:46.680

如果您使用的是 Microsoft Visual C++，则有一个编译器选项可以告诉您您的对象实际有多大：/d1reportSingleClassLayout

除了 Lavavej [http://channel9.msdn.com/Shows/Going+Deep/C9-Lectures-Stephan-T-Lavavej-Advanced-STL-3-of-n的这个视频外，它没有记录](http://channel9.msdn.com/Shows/Going+Deep/C9-Lectures-Stephan-T-Lavavej-Advanced-STL-3-of-n)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-02T04:36:15.547

如果您想检查特定结构的布局，`offsetof(s,member)`宏也可能有用。它告诉你一个特定成员离结构的基地址有多远：

```
struct foo {
  char *a;
  int b;
};

// Print placement of foo's members
void printFoo() {
  printf("foo->a is %zu bytes into a foo\n", offsetof(struct foo, a));
  printf("foo->b is %zu bytes into a foo\n", offsetof(struct foo, b));
}

int main() {
  printFoo();
  return 0;
} 
```

将在典型的 32 位机器上打印：

```
foo->a is 0 bytes into a foo
foo->b is 4 bytes into a foo 
```

而在典型的 64 位机器上，它会打印

```
foo->a is 0 bytes into a foo
foo->b is 8 bytes into a foo 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-02T03:16:59.297

[这](http://www.parashift.com/c++-faq-lite/classes-and-objects.html)可能会有所帮助。

此外，类函数的表示方式与任何其他函数一样。C++ 对函数所做的唯一魔术是修改函数名称以唯一标识具有特定类中特定参数集的特定函数。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-06-06T04:28:45.497

有一个实用程序调用`pahole`（用于['Poke-A-HOLE'](http://git.kernel.org/cgit/devel/pahole/pahole.git)），名义上旨在研究对象布局如何被填充，但对于总体上可视化对象大小和布局非常有用。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2013-05-30T05:16:25.400

一个类的对象的大小等于该类的所有数据成员的大小之和。例如，如果我有一堂课

```
class student
{
private:   
   char name[20];
   int rollno, admno;
   float marks;

public:
  float tmarks, percentage;

  void getdata();

  void putdata();
}; 
```

现在，如果我创建这个类的一个对象，比如说`s1`，那么这个对象的大小将是 36 字节：

```
[20(name)+2(rollno)+2(admno)+4(marks)+4(tmarks)+4(percentage)] 
```

# asp.net - 在 ASP.NET MVC 中引用 Javascript 的正确方法？

> ID：937779
> 
> 赞同：17
> 
> 时间：2009-06-02T03:15:19.673
> 
> 标签：asp.net, javascript, asp.net-mvc

在 ASP.NET MVC 中引用 Javascript 的正确方法是什么？使用 ../../Scripts/Myscript.js 之类的东西似乎适用于传统的 {controller}/{action}/{id} 路由，但对于任何或多或少复杂的东西来说都更脆弱。更令人担忧的是，理性绝对引用 (/Scripts/Myscript.js) 会破坏 Visual Studio 中的 Intellisense。

你如何处理它？

编辑：此时这显然是一个非常古老的问题，但我正在编辑中提到在 MVC4 中，您所需要的只是：

```
src="~/Scripts/Whatever.js" 
```

这足以让 Razor 使用根路径找出您的意思。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-06-02T03:21:21.610

`<script src="<%= Url.Content("~/Scripts/Myscript.js") %>" type="text/javascript"></script>`

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2012-02-21T21:03:06.743

万一其他人找到使用 MVC Razor 的答案，以下是它的语法：

```
<script type="text/javascript" src="@Url.Content("/Scripts/MyScript.js")"></script> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-02T05:10:18.500

我也引用了与CMerat相同的js：

```
<script type="text/javascript" src="<% =Url.Content("~/Scripts/jquery-1.3.2.min.js") %>"></script> 
```

如果您需要 jquery 的 Intellisense，您可以在此处找到[有关如何设置它的说明](http://weblogs.asp.net/scottgu/archive/2008/11/21/jquery-intellisense-in-vs-2008.aspx)。据我所知，您无法为您引用的任何自定义 js 文件获取 Intellisense - 您需要先为其创建 Intellisense 文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-02T05:35:19.903

我自己目前为此使用 mvccontrib htmlhelpers。

[这](http://weblogs.asp.net/rashid/archive/2009/04/28/script-and-css-management-in-asp-net-mvc.aspx)也很有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-02T09:36:14.933

我创建了自己的 HtmlHelper 扩展，如下所示：

```
public static string MEScriptBlock(this HtmlHelper html, string path, string releasePath)
{
#if DEBUG
#else
    if (!string.IsNullOrEmpty(releasePath))
        path = releasePath;
#endif

    return string.Format("<script type=\"text/javascript\" src=\"{0}\"></script>\r\n",
                         path);
} 
```

如果智能感知是您所追求的，那么您可以欺骗 VS 认为已加载 JS 文件......例如

```
<% if (false)
   { %>
    <script src="../../Scripts/Myscript.js" type="text/javascript"></script>
<% } %> 
```

HTH，查尔斯

# svn - 如何使用 svn export 将文件从 dev 或 QA 移动到生产环境？

> ID：937786
> 
> 赞同：2
> 
> 时间：2009-06-02T03:19:21.070
> 
> 标签：svn

您会将文件从 DEV 移动到 Prod 还是将 QA 移动到 Prod？您如何在您的环境中使用 svn export？您可以分享任何方便的脚本吗？

我查看了其他线程，但他们没有足够的信息。

我想知道将应用程序/数据库更新从 QA、DEV 或 Staging 推送到生产环境的最佳实践。这是一个 LaMP 环境。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-10T15:44:03.067

好吧，首先，我不会将文件直接从 dev 或 qa 移动到生产环境。就像您的问题所暗示的那样，我会将您的 SCM（在本例中为 subversion）中的标记版本直接部署到您各自的环境中。

从广义上讲，我建议使用专门的部署工具，例如[Capistrano](http://www.capify.org)。学习该工具和设置部署脚本需要花费一些前期时间，但是稍后能够说“cap deploy qa”或“cap rollback production”以更改您正在运行的版本的能力几秒钟的时间将a）超过最初的时间投资，并且b）在出现问题时节省你的屁股。

但是，要直接解决您的问题，如果您是手动完成的，我会推荐一个类似这样的过程（在必要时插入 sudo）：

1.  有一个`/opt/my_app/`目录，其中包含多个包含不同版本的子目录，以及指向任何一个活动的“当前”符号链接。
2.  将您的 apache 配置指向`/opt/my_app/current`
3.  要推出新版本，请运行类似“ `svn export https://my_repo/my_app /opt/my_app/1.2.3`”的命令（假设新版本是 1.2.3）。
4.  更改符号链接：“ `rm /opt/my_app/current; ln -s /opt/my_app/1.2.3 opt/my_app/current`”
5.  根据需要重新启动 Apache 或其他进程。

数据库更新是一个更有趣的问题。就个人而言，我喜欢 Rails 的迁移。如果您是手动执行的，您可能会在项目中包含几个 shell 脚本来分别更新数据库并回滚，但是保持这些版本正确会有点棘手，因为它们仅特定于一个特定版本. 我建议使用像 Migrations 这样的现有系统（它可以与 Rails 分开使用——我认为它是一些基于 Java 的项目中唯一的 Ruby 组件），或者将其作为一个单独的问题提出。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T03:29:49.097

有很多方法可以做到这一点，具体取决于应用程序和环境。

在 LAMP 环境中，我经常在生产服务器上创建一个帐户并检查开发文件，就像我在那里开发一样，进行构建，然后在本地部署。

1.  该应用程序可以部署为非特权用户。
2.  出于安全原因，部署后可能会删除用户帐户。
3.  如果您对远程操作（例如通过 ssh）感到满意，这通常是一种非常简单的方法。

# c# - 关闭时发送到托盘

> ID：937792
> 
> 赞同：7
> 
> 时间：2009-06-02T03:23:09.173
> 
> 标签：c#, .net, wpf, system-tray

单击关闭按钮时，如何将最小化的窗口发送到托盘？应用程序启动时如何在托盘中显示图标？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-06-02T03:32:49.997

**赢表格：**

一种方法是在窗口的 F​​ormClosing 事件中设置 FormClosingEventArgs 的 Cancel 属性，而是最小化到托盘。要最小化到托盘，请参阅这篇文章：

[窗口托盘最小化器](http://www.codeproject.com/KB/cs/Trayminimizer.aspx)

Code Project 有更多关于该主题的文章，但我链接的那一篇对我有用。

**WPF：**

我从来没有在 WPF 中这样做过，但确实四处寻找解决方案。我找到了这个：

[为 WPF 应用程序创建托盘图标](http://www.pandemoniumincarnate.com/category/wpf/)

您会发现代码有效，但我建议您进行测试。这篇文章解决了打开最小化到托盘的应用程序。

您可能还会发现 MSDN 上的这个示例很有用：

[通知图标示例](http://msdn.microsoft.com/en-us/library/aa972170.aspx?ppud=4)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-02T03:41:33.303

WPF 没有嵌入任何内容。从您可以在网上找到的实现中，有一个使用 WinForms 的“简单”实现：

[http://msdn.microsoft.com/en-us/library/aa972170.aspx](http://msdn.microsoft.com/en-us/library/aa972170.aspx)

但我更喜欢这个（也可以用于气球提示）

[http://www.codeproject.com/KB/WPF/wpf_notifyicon.aspx](http://www.codeproject.com/KB/WPF/wpf_notifyicon.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T03:54:56.050

在 winforms 中，您可以重载 WndProc 并注意 WM_CLOSE 消息。

```
 WM_CLOSE = 0x0010

    protected override void WndProc(ref Message m)
    {
      if(m.Msg == WM_CLOSE)
      {
        this.Hide();
        trayIcon.Show();
      }

    } 
```

# ruby - 提供静态文件时如何设置标题

> ID：937796
> 
> 赞同：1
> 
> 时间：2009-06-02T03:24:37.953
> 
> 标签：ruby, apache, http-headers

我想托管一个 ical 文件，但是在提供它时，我需要将 Content-type 标头设置为日历等

在php中，我只想

```
<?php
  header ("Content-type: text/calendar")
?>
//calendar stuff proceeds 
```

我可以用红宝石做同样的事情吗？或者我可以以某种方式告诉 apache 在提供此文件时设置不同的标头吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T03:32:59.153

使用[mod_headers](http://httpd.apache.org/docs/1.3/mod/mod_headers.html)

# sql - 如何在 Access 中使用固定数量的列进行交叉表查询

> ID：937797
> 
> 赞同：2
> 
> 时间：2009-06-02T03:25:50.743
> 
> 标签：sql, ms-access, crosstab

我想使用 MS Access 交叉表查询提取数据，以便将其绑定到报表。当我加载页面时，出现运行时错误“3637”：无法使用非固定列的交叉表作为子查询。

我想要一种在运行查询时取回固定网格的方法，如果单元格为空，则显示零。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-02T04:30:25.000

子查询？这是我在 Access 方面的弱点之一，所以我无法帮助你。我建议发布查询的 SQL，以便其他人可以查看。运行查询时还会发生什么？

以下是我用来为给定单位提供过去十年成本的查询。TRANSFORM Sum(ServiceRecords.srTotalCost) AS AnnualCost 从 ServiceRecords GROUP BY ServiceRecords.srEquipmentID 中选择 ServiceRecords.srEquipmentID PIVOT "C" & DateDiff("yyyy",[srServiceDate],Date()) In ("C9","C8"," C7","C6","C5","C4","C3","C2","C1","C0");

诀窍是在 PIVOT 之后。由于我想要最近十年的数据，“C”和 DateDiff 部分设置了一个字符串变量，调用 C0 到 C9。In 之后的部分告诉将内容放入哪一列。

另一个提取有关设备数据的查询称为此查询。我们通常使用的术语是堆叠查询。

如果这还不足以让您继续前进，请说明您尝试创建交叉表的数据类型。

Access MVP 研究员 Allen Browne 在这个主题上有一个很好的页面。 [交叉表查询技术](http://allenbrowne.com/ser-67.html)

# php - 如何在 Microsoft Virtual PC 的 Windows XP 中运行 xampp？

> ID：937802
> 
> 赞同：1
> 
> 时间：2009-06-02T03:28:48.787
> 
> 标签：php, cross-browser, xampp

已安装 Firefox 和 IE 7。我使用 MS Virtual PC 在 IE6 中测试网站，它可以在实时站点上运行，但我使用 XAMPP 来呈现 PHP 文件，但 h.ttp://localhost 无法使用 IE6 虚拟运行 XP。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-04T17:08:31.367

你有一个 XAMPP 服务器在你的开发机器上运行，你可以从[http://localhost 本地](http://localhost)访问它吗？

在 Virtual PC 中运行的 Windows XP 副本是一台完全独立的机器。在这台机器上，localhost 指的是虚拟机，而不是您的开发机器。

您需要通过网络连接到开发机器。如果你的开发机器的 IP 地址是 123.123.123.123，你应该可以使用[http://123.123.123.123连接到它](http://123.123.123.123)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T03:35:55.017

确保 IIS 已打开。如果您使用的是 Apache，请确保 IIS 已关闭。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-04T10:26:08.540

我遇到了同样的问题——我个人放弃并使用了 Wamp——效果很好。知道这不是最有用的答案...

+

只是一个想法-您尝试过 127.0.0.1 吗？

我问，因为一些 XP 更新导致环回地址停止工作一段时间。如果您刚刚安装了新的 XP，则可能尚未应用已修复的更新。

# c++ - 如何将 clog 重新定义为原始 clog 和日志文件？

> ID：937805
> 
> 赞同：4
> 
> 时间：2009-06-02T03:30:02.827
> 
> 标签：c++, stream, tee, clog

我在这里看到了一个有用的开始：

[http://www.cs.technion.ac.il/~imaman/programs/teestream.html](http://www.cs.technion.ac.il/~imaman/programs/teestream.html)

并且它非常适合制作一个同时进入 clog 和日志文件的新流。

但是，如果我尝试将 clog 重新定义为新流，则它不起作用，因为新流具有与 clog 相同的 rdbuf() ，因此以下内容无效：

```
clog.rdbuf(myTee.rdbuf()); 
```

那么如何修改 tee 类以拥有自己的 rdbuf() ，然后它可以成为阻塞的目标？

谢谢。

-威廉

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-03T02:00:28.483

如果你真的想继续为 tee 使用 std::clog 而不是将输出发送到不同的流，你需要工作低一级：而不是从 ostream 派生，从 streambuf 派生。然后你可以这样做：

```
fstream logFile(...);
TeeBuf tbuf(logFile.rdbuf(), clog.rdbuf());
clog.rdbuf(&tbuf); 
```

有关如何派生您自己的 streambuf 类的更多信息，请参见[此处](http://www2.roguewave.com/support/docs/sourcepro/edition9/html/stdlibug/39-2.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T06:59:57.540

您不想做您想做的事情，因为“tee”不在 rdbuf 级别上工作。因此将 rdbuf 设置为其他内容将不起作用，输出只会转到一个流。

你需要按照那里的例子：

例如

```
fstream clog_file(...);
xstream clog_x(...);
TeeStream clog(clog_file, clog_x); 
```

然后到处使用木屐代替原来的木屐。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-04T03:54:49.010

这是我创建的似乎可以完成这项工作的课程，感谢所有提供帮助的人！

-威廉

```
class TeeStream : public std::basic_filebuf<char, std::char_traits<char> >
{
private:
  class FileStream : public std::ofstream {
  public:
    FileStream()
      : logFileName("/my/log/file/location.log") {
      open(logFileName.c_str(), ios::out | ios::trunc);

      if (fail()) {
        cerr << "Error: failed to open log file: " << logFileName << endl;
        exit(1);
      }
    }
    ~FileStream() {
      close();
    }

    const char *getLogFileName() const {
      return logFileName.c_str();
    }

  private:
    const string logFileName;

  };

public:
  typedef std::char_traits<char> traits;
  typedef std::basic_filebuf<char, traits> baseClass;

  TeeStream()
    :  baseClass(),
       _logOutputStream(),
       _clogBuf(clog.rdbuf()),
       _fileBuf(_logOutputStream.rdbuf()) {
    clog.rdbuf(this);
    _logOutputStream << "Log file starts here:" << endl;
  }
  ~TeeStream() {
    clog.rdbuf(_clogBuf);
  }

  int_type overflow(char_type additionalChar =traits::eof()) {
    const int_type eof = traits::eof();
    const char_type additionalCharacter = traits::to_char_type(additionalChar);
    const int_type result1 = _clogBuf->sputc(additionalCharacter);
    const int_type result2 = _fileBuf->sputc(additionalCharacter);

    if (traits::eq_int_type(eof, result1)) {
      return eof;
    } else {
      return result2;
    }
  }

  int sync() {
    const int result1 = _clogBuf->pubsync();
    const int result2 = _fileBuf->pubsync();

    if (result1 == -1) {
      return -1;
    } else {
      return result2;
    }
  }

private:
  FileStream _logOutputStream;
  streambuf * const _clogBuf;
  streambuf * const _fileBuf;

}; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-14T10:27:11.707

我只会使用 Boost iostreams 的东西来做到这一点。

``#include <iostream>`
`#include <fstream>`
`#include <boost/iostreams/tee.hpp>`
`#include <boost/iostreams/stream.hpp>`` 

 ````
int main(const int a_argc, const char *a_args[])
{
    namespace io = boost::iostreams;
    typedef io::tee_device<std::ofstream, std::ostream> TeeDevice;
    typedef io::stream<TeeDevice> TeeStream;

    std::ofstream flog("logFile.txt");
    //We need to copy clog, otherwise we get infinite recursion
    //later on when we reassign clog's rdbuf.
    std::ostream clogCopy(std::clog.rdbuf());

    TeeDevice logTee(flog, clogCopy);
    TeeStream logTeeStream(logTee);

    logTeeStream << "This text gets clogged and flogged." << std::endl;

    //Modify clog to automatically go through the tee.
    std::streambuf *originalRdBuf = std::clog.rdbuf(logTeeStream.rdbuf());  

    std::clog << "This text doesn't only get clogged, it's flogged too." << std::endl;

    std::clog.rdbuf(originalRdBuf);
    std::clog << "This text avoids flogging." << std::endl;
} 
````  `# c# - Linq 有没有办法根据不同的条件应用不同的计算

> ID：937807
> 
> 赞同：3
> 
> 时间：2009-06-02T03:31:00.890
> 
> 标签：c#, linq

我正在尝试找出正确的语法以使其正常工作。这是一个例子。你能纠正它/把它翻译成 linq 语法吗？

```
 From p In products() 
      group p by p.Category into g 
      select new { Category = g.Key, 
                   TotalUnitsInStock = if(g.key="b", g.Avg(p => p.UnitsInStock),
                                          g.Sum(p => p.UnitsInStock)) 
```

在此示例中，产品将是一个数据表。谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T03:39:24.753

```
from p in products()
group p by p.Category into g
select new
{
    Category = g.Key,
    TotalUnitsInStock = g.Key == "b"
        ? g.Average(p => p.UnitsInStock)
        : g.Sum(p => p.UnitsInStock)
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T03:38:09.307

尝试以下

```
 var query = from p In products() 
              group p by p.Category into g 
              select new { Category = g.Key, 
                  TotalUnitsInStock = (g.key=="b") ? g.Avg(p => p.UnitsInStock) :
                                      g.Sum(p => p.UnitsInStock)); 
```

# pdf - 如何从 PDF 文件中提取数据，同时跟踪其结构？

> ID：937808
> 
> 赞同：32
> 
> 时间：2009-06-02T03:31:12.963
> 
> 标签：pdf, parsing, extraction

我的目标是从 PDF 文件中提取文本和图像，同时解析其结构。解析结构的范围并不详尽；我只需要能够识别标题和段落。

我尝试了一些不同的东西，但我在其中的任何一个中都没有走得太远：

*   将 PDF 转换为文本。它对我不起作用，因为我丢失了图像和文档的结构。
*   将 PDF 转换为 HTML。我找到了一些可以帮助我解决这个问题的工具，迄今为止最好的工具是 pdftohtml。该工具在演示方面非常出色，但我无法成功解析 HTML。
*   将 PDF 转换为 XML。和上面一样。

有人对如何解决这个问题有任何建议吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2014-05-03T14:35:42.637

本质上没有一个简单的剪切和粘贴解决方案，因为 PDF 对结构并不是很感兴趣。该站点上还有许多其他答案可以更详细地告诉您，但是这个答案应该为您提供要点：

[如果识别 PDF 文档中的文本结构如此困难，那么 PDF 阅读器是如何做到如此出色的呢？](https://stackoverflow.com/questions/22675690/if-identifying-text-structure-in-pdf-documents-is-so-difficult-how-do-pdf-reade/)

如果您想在 PDF 本身中执行此操作（您将拥有对该过程的大部分控制权），则必须遍历页面上的所有文本并通过查看其文本属性（使用的字体、相对于页面上的其他文本等...）。

最重要的是，您还必须通过查看文本片段的位置、页面上的空白、某些字母、单词和行的接近程度来识别段落...... PDF 本身甚至没有一个概念“单词”，更不用说“行”或“段落”了。

更复杂的是，文本在页面上的绘制方式（以及它在 PDF 文件本身中出现的顺序）甚至不必是正确的阅读顺序（或者我们人类认为正确的顺序）阅读顺序）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-02-16T10:07:19.830

您可以将以下方法与 iTextSharp 或其他开源库一起使用：

*   使用[iTextSharp](http://itextpdf.com)或类似的开源工具读取 PDF 文件并将所有文本对象收集到一个数组中（或使用[pdftohtml](http://sourceforge.net/projects/pdftohtml/)之类的工具将 PDF 转换为 HTML ，然后解析 HTML）
*   按坐标对所有文本对象进行排序，以便将它们放在一起
*   然后遍历对象并检查它们之间的距离，看看是否可以将 2 个或多个对象合并到一个段落中

或者您可以使用商业工具，例如[ByteScout PDF Extractor SDK](http://bytescout.com/products/developer/pdfextractorsdk/extract-from-pdf-to-excel-csv-in-csharp)，它能够做到这一点：

*   提取文本和图像以及分析文本的布局
*   XML 或 CSV，其中文本对象在虚拟布局网格内合并或拆分为段落
*   通过特殊的 API 访问对象，这使得可以通过其“虚拟”行和列索引来处理每个对象，而不管它如何存储在原始 PDF 中。

*免责声明：我隶属于 ByteScout*

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2018-03-17T01:50:18.613

PDF 解析标题及其子内容确实非常困难（这并不意味着它不可能），因为 PDF 有多种格式。但我最近遇到了一个名为**GROBID**的工具，它可以在这种情况下提供帮助。我知道这并不完美，但如果我们提供适当的培训，它可以实现我们的目标。

Grobid 作为 github 上的开源提供。

[https://github.com/kermitt2/grobid](https://github.com/kermitt2/grobid)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2019-02-09T03:05:49.987

PDF 文件可以用 tabula-py 或 tabula-java 解析。

[我在这篇文章](https://aegis4048.github.io/parse-pdf-files-while-retaining-structure-with-tabula-py)中做了一个关于如何使用 tabula-py 的完整教程。只要您安装了 Java，您也可以在 Web 浏览器中制作表格。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-02T07:11:14.693

除非它是标记内容，否则 PDF 没有结构......您必须“猜测”它，这就是各种工具正在做的事情。有一篇很好的博客文章解释了 [http://blog.idrsolutions.com/2010/09/the-easy-way-to-discover-if-a-pdf-file-contains-structured-content/上的问题](http://blog.idrsolutions.com/2010/09/the-easy-way-to-discover-if-a-pdf-file-contains-structured-content/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-06-02T07:07:29.427

如上面的答案所述，PDF 不是很容易解析。但是，如果您有关于要解析的文本的某些附加信息，则可以将其关闭。

1.  如果您的标题位于页面的特定部分，您可以解析 PDF 文件并按坐标对解析后的输出进行排序。

2.  如果您事先了解标题和段落之间的间距，您还可以利用此信息来解析文件。

[PDFBox](https://pdfbox.apache.org/)是一个 PDF 解析工具，您可以使用它来提取文本和图像，您可以在其上定义自定义的解析规则。

但是，要解析 PDF，您需要先了解 PDF 文件的一般格式。您可以查看以下博客 [文章文档解析](https://nanonets.com/blog/document-parsing/)以获取有关文档解析的更多信息。

免责声明：我参与了这篇博文的撰写。

* * *

## 回答 #7

> 赞同：-10
> 
> 时间：2018-02-23T10:01:05.587

iText api: PdfReader pr=new PdfReader("C:\test.pdf");

参考资料：PDFReader

# gwt - GWT-Ext EditorGridPanel 渲染问题

> ID：937810
> 
> 赞同：1
> 
> 时间：2009-06-02T03:32:58.903
> 
> 标签：gwt, grid, gwt-ext

我正在使用 GWT 1.6.4 和 GWT-Ext 2.0.6。我正在尝试使用 EditorGridPanel 并面临渲染问题。

当模块加载时，我使用 BorderLayout 创建一个面板（TopPanel）并将其添加到 ViewPort。然后我创建另一个面板 (CenterPanel) 并将 EditorGridPanel，三个按钮添加到 BorderLayout 面板 (TopPanel) 的中心。我为 CenterPanel 尝试了许多布局，但仍然无法得到我想要的。

我希望表格显示所需的数据和滚动条。所有三个按钮都位于表格下方。表的数据在模块加载时通过异步调用来，因此当屏幕呈现给用户时，数据会填充到表中。但看起来表格在没有数据的情况下呈现，并且当异步过程完成时，表格被填充但没有调整大小以适应屏幕，所以只显示一行。

问题出在网格上，我没有得到任何滚动条。其次，我不想定义网格的高度和宽度。我希望它尽可能多地显示滚动条，就像我们在 html 表格中通过将宽度和高度设置为 100% 一样。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-08T03:00:11.237

我找到了解决方案。我必须在面板上添加网格。我必须将该面板的布局设置为 FitLayout()。其次，在将数据加载到 Store 之后，必须在该面板上调用 doLayout()。我现在得到了表格的滚动条，它适合整个可用空间。

# database - 任何使用签名树的生产应用程序示例？

> ID：937812
> 
> 赞同：13
> 
> 时间：2009-06-02T03:33:06.487
> 
> 标签：database, data-structures, indexing, theory

我最近读了很多关于签名树或 S-Trees 的文章。例如，[这篇论文](http://en.scientificcommons.org/43485787)。文献对它们给予了高度评价，并提供了证据表明，对于某些应用程序，其性能比倒置文件或 B 树有相当大的提升。

现在，为什么我没有看到 S-Trees 被大量使用？您知道流行应用程序中这种数据结构的任何突出实例吗？是否有提供签名树索引的 DBMS 实现？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T09:23:17.097

> 现在，为什么我看不到它的`S-Trees`使用频率很高？

在数据库中包含新的索引或连接方法是一项非常复杂的任务。

`MySQL`例如，它还没有阻碍`MERGE JOIN`，并且`HASH JOIN`是由古罗马人或阿基米德或大约在那个时候发明的。

而且您引用的论文已过时`2006`，甚至在`Wikipedia`.

这意味着开发人员要么还不知道它，要么不值得在一个`RDBMS`（或两者）中使用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T04:51:46.790

我听说过类似的东西被描述为“C-tree”——它是对象数据库的一部分，我想它的索引方法类似于链接中的论文描述的方法。一家名为 InterSystems 的公司制造了一个名为 Caché 的数据库系统，他们将其描述为“后关系”并且非常分层……我对这些不同系统的细节了解得不够多，无法确定它们都是不同的名称相同的功能，但是，它们有一些重叠的基本概念。

# assembly - MIPS 程序集分配 - 加载字问题

> ID：937818
> 
> 赞同：1
> 
> 时间：2009-06-02T03:36:24.940
> 
> 标签：assembly, mips

以下代码用于实现指令

```
sllv $s0, $s1, $s2 
```

它使用寄存器 $s2 中值的最低 5 位来指定寄存器 $s1 应左移的数量：

```
 .data
   mask:  .word  0xfffff83f
          .text
  start:  lw     $t0, mask
          lw     $s0, shifter
          and    $s0,$s0,$t0
          andi   $s2,$s2,0x1f
          sll    $s2,$s2,6
          or     $s0,$s0,$s2
          sw     $s0, shifter
shifter:  sll    $s0,$s1,0 
```

我知道大多数指令在做什么。

然而，我不明白第二个加载字是如何从移位器加载一些东西的，它本身是一个指令而不是一个词。

此外，正如问题所说，当转换为二进制时，十六进制掩码的值在至少 5 个重要位置没有零，所以我不确定它将如何屏蔽至少 5 个 sig 位置。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T04:04:16.397

这是一种迂回的做法。它实际上是在修改内存中的指令来执行移位！如果您按照代码进行操作，您将看到`sll $s0,$s1,0`指令已加载，其`sa`字段从`0`to修改`$s2`，然后保存回内存并执行。

# .net - 在哪里下载包含 NHibernate.Caches.Prevalence.PrevalenceCacheProvider、NHibernate.Caches.Prevalence 的程序集？

> ID：937828
> 
> 赞同：3
> 
> 时间：2009-06-02T03:44:16.640
> 
> 标签：.net, nhibernate, caching

在 nhibernate 文档中，声明使用流行缓存使用提供程序类“NHibernate.Caches.Prevalence.PrevalenceCacheProvider, NHibernate.Caches.Prevalence” [https://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en /html/performance.html#performance-cache](https://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html/performance.html#performance-cache)

我该去哪里下载包含这种类型的程序集？

根据文档（[https://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html/caches.html](https://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html/caches.html)）可以从[http://bbooprevalence.sourceforge.net/](http://bbooprevalence.sourceforge.net/)获得。但是我下载了 Bamboo.Prevalence-1.4.4.4 并且找不到任何缓存程序集。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T04:14:43.593

原来它是 NHContrib 的一部分

[http://sourceforge.net/projects/nhcontrib/](http://sourceforge.net/projects/nhcontrib/)

# opengl - XNA 或 OpenGL 球体纹理映射

> ID：937831
> 
> 赞同：1
> 
> 时间：2009-06-02T03:45:41.587
> 
> 标签：opengl, xna, geometry, mapping, textures

我正在尝试将完全正常的纹理映射到球体中。

我无法将我的纹理更改为包裹的，所以我需要找到一些映射函数。

这是我的顶点着色器代码：

```
vec3 north = vec3(0.0, 0.0, 1.0);
vec3 equator = vec3(0.0, 1.0, 0.0);
vec3 northEquatorCross = cross(equator, north);
vec3 vertexRay = normalize(gl_Vertex.xyz);
float phi = acos(vertexRay.z);
float tv = (phi / (PI*tiling));    
float tu = 0.0;
if (vertexRay.z == 1.0 || vertexRay.z == -1.0) {
    tu = 0.5;
} else {
    float ang_hor = acos(max(min(vertexRay.y / sin(phi), 1.0), -1.0));      
    float temp = ang_hor / ((2.0*tiling) * PI);
    tu = (vertexRay.x >= 0.0) ? temp : 1.0 - temp;
} 

texPosition  = vec2(tu, tv); 
```

它直接来自这里：http: [//blogs.msdn.com/coding4fun/archive/2006/10/31/912562.aspx](http://blogs.msdn.com/coding4fun/archive/2006/10/31/912562.aspx)

这是我的片段着色器：

```
color = texture2D(debugTex, texPosition); 
```

正如您在此屏幕截图中看到的那样：http: [//img189.imageshack.us/img189/4695/sphereproblem.png](http://img189.imageshack.us/img189/4695/sphereproblem.png)，它显示了球体中的裂缝......这就是我要修复的问题。（使用的纹理：http: [//img197.imageshack.us/img197/56/debug.jpg](http://img197.imageshack.us/img197/56/debug.jpg)）

XNA 网站上的第一条评论确实使用以下方法解决了问题： device.RenderState.Wrap0 = WrapCoordinates.Zero;

但是因为我对 XNA 内部的了解不够多，所以我无法理解这在这个特定问题中解决了什么问题。

在网络上，有些人经历过同样的事情，并且报告说是关于插值错误，但是因为我直接将它作为片段着色器（每像素/片段）实现，所以我不应该有这个问题（在纹理 uv)。

关于此的任何信息/解决方案？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-05-31T21:38:34.487

这很有趣 ！我遇到了同样的问题，但它得到了修复，我怀疑存在一些浮点问题......这是我的着色器！

```
uniform float r;
void main(void) {
    float deg1, deg2, rr, sdeg1, sdeg2, cdeg2;
    deg1 = (gl_Vertex.y / " "32" ".0) * 2.0 * 3.1415926;
    deg2 = (gl_Vertex.x / " "32" ".0) * 2.0 * 3.1415926;
    sdeg1 = sin(deg1);
    sdeg2 = sin(deg2);
    cdeg2 = cos(deg2);
    gl_Vertex.y = r*sdeg1;
    rr = r*cos(deg1);
    if(rr < 0.0001) rr = 0.0001;
    gl_Vertex.x = rr*sdeg2;
    gl_Vertex.z = rr*cdeg2;
    vec3 vertexRay = normalize(gl_Vertex.xyz);
    float phi = acos(vertexRay.y);
    float tv = (phi / (3.1415926));
    float sphi = sin(phi);
    float theta = 0.5;
    float temp = vertexRay.z / sphi;
    if(temp > 1.0) temp = 1.0;
    if(temp < -1.0) temp = -1.0;
    theta = acos(temp) / (2.0*3.1415926);
    float tu = 0.0;
    if(deg2 > 3.1415926) tu = theta;
    else tu = 1.0 - theta;
    gl_TexCoord[0].x = tu;
    gl_TexCoord[0].y = tv;
    gl_Position = ftransform();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T04:02:33.090

[WrapCoordinates.Zero](http://msdn.microsoft.com/en-us/library/microsoft.windowsmobile.directx.direct3d.wrapcoordinates%28VS.80%29.aspx)有效地表示从纹理的角度来看，纹理是水平包裹的，而不是垂直包裹的。

# sharepoint - 每小时重启 OWSTIMER 有什么影响吗？

> ID：937832
> 
> 赞同：2
> 
> 时间：2009-06-02T03:46:06.220
> 
> 标签：sharepoint

我发现 OWSTIMER 在创建个人网站时会消耗大量内存。（我必须为许多用户预先创建个人网站）

谷歌搜索后，我发现了一些重新启动 OWSTIMER 的建议，但在创建几个个人网站后它会再次长大。所以我必须每小时重新启动 OWSTIMER。

您知道每小时重新启动 OWSTIMER 的影响吗？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-11T11:17:34.310

OWSTIMER 因泄漏而臭名昭著，有时会在@$$ 中引起普遍的痛苦。

唯一的影响应该是在服务重新启动时的短暂（5-10 秒）中断期间不会启动定时作业。

更多信息可从 Ben Curry 获得，网址为[http://www.mindsharpblogs.com/ben/archive/2007/09/25/2965.aspx](http://www.mindsharpblogs.com/ben/archive/2007/09/25/2965.aspx)

# c++ - 避免 printscreen 函数渲染文本

> ID：937843
> 
> 赞同：0
> 
> 时间：2009-06-02T03:54:31.013
> 
> 标签：c++, opengl

我正在寻找一种方法来避免用户从一个桌面应用程序中截取屏幕截图。是的，这似乎很奇怪，但我们需要它。我尝试使用 OpenGL (SDL_tff) 来呈现文本，但似乎并没有阻止用户截取屏幕截图。请问，有人对如何做有一些聪明的想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T04:24:36.060

将其渲染为视频并使用硬件覆盖。这些更难捕捉，因为它们在技术上从未像其他应用程序那样呈现到屏幕上。它直接进入硬件并通过显卡显示，绕过正常的屏幕截图域。

不过还是可以抢的。

就个人而言，我会拍一张高分辨率照片并通过 img2txt 转换器运行它：D

编辑：查看[http://www.gamedev.net/community/forums/topic.asp?topic_id=359319](http://www.gamedev.net/community/forums/topic.asp?topic_id=359319)，他们似乎有一个例子，它具体说明了效果的“截图”是如何有点愚蠢的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T04:12:01.970

正如我在评论中提到的，您无法阻止用户截屏。

不过，您可能可以采取一些措施使其变得更加困难，并且可能会阻止知识渊博或缺乏动力的人截取屏幕截图。

一个建议：您可能要注意经常用于截屏的组合键，然后短暂隐藏您的文本。它**可能会**得到您正在寻找的行为：允许用户在不显示文本的情况下截取屏幕截图。

另一种选择是提供一种非常简单且明显的方法，让应用程序为用户截取屏幕截图，而无需保存文本。如果您不是试图使文本“无法”捕获，而是用户希望屏幕截图是无文本的，这可能很有用。

从您的问题中不清楚您的请求背后的动机是什么。如果你只是想要“更漂亮”的没有文字的屏幕截图，这应该不是一个很难解决的问题：就像我之前提到的那样，并提供一个内置机制来保存“干净”的屏幕截图。

请记住，如果用户确实想要保存该文本，您**无法**阻止他们这样做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T03:58:58.533

你无法完成你想要的。事实上，你想要的是荒谬的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-02T04:04:24.807

即使您找到了一些巧妙的方法来阻止他们使用计算机进行操作，使用优质数码相机为他们的显示器拍照也可以提供非常优质的屏幕截图。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-02T15:15:12.843

不要忘记添加 VM[检测例程](http://www.codegurus.be/codegurus/Programming/virtualpc&vmware_en.htm)，以便在发现自己在虚拟机下运行时禁用显示。这样他们就无法截取 VM 窗口的屏幕截图。

除非他们修改一个开放的虚拟机来消除那种简单的迹象，在这种情况下你将不得不使用[更强大](http://en.wikipedia.org/wiki/Taylor_algorithms_(fiction))的 .

# xcode - 在 XCode 文档窗口中增加字体大小

> ID：937852
> 
> 赞同：13
> 
> 时间：2009-06-02T04:02:00.063
> 
> 标签：xcode

我在这样做时遇到了一些问题，但下面列出了一种方法。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2011-09-13T19:47:39.483

给定的答案在 Xcode 4.1 中对我不起作用。

但是，Xcode->Preferences->Documentation->Never Use 使用小于 'x' 的字体大小是一种解决方法。

编辑：在最新的 Xcode (4.6.2) 中略有移动。现在 Xcode->Preferences->Downloads->Documentation->Never use font size小于：'x'。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-12-01T09:52:33.870

在 Xcode 4.3（仍然是测试版）上：转到首选项 -> 下载 在底部标记处选择文档：切勿使用小于：__ 的字体大小（选择您的大小）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-09-02T03:54:28.453

Xcode菜单栏，选择Editor->Zoom in。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T04:03:11.797

在菜单栏上的 XCode 中，选择 EDIT-> FORMAT -> FONT -> BIGGER

# asp.net - ASP.NET 动态地重新分配控件树中的控件

> ID：937874
> 
> 赞同：2
> 
> 时间：2009-06-02T04:16:13.280
> 
> 标签：asp.net, dynamic, controls

假设我有一个看起来像这样的自定义控件

```
<cc:MyControl runat="server" ID="myc" LinkControlID="NewParent" /> 
```

并且，在同一页面上：

```
<asp:TextBox runat="server" ID="NewParent" /> 
```

我想做的是，从 MyControl 更改 NewParent 的父级，使其成为 MyControl 的 Controls 集合的一部分。当我尝试从 OnInit 执行此操作时，我得到：

> 在 DataBind、Init、Load、PreRender 或 Unload 阶段不能修改控件集合。

这是有道理的，但是有没有办法解决这个问题？我可以，如果 NewParent 仍然是 Page 的子项，只要从 MyControl 我可以以某种方式将呈现重定向到 MyControl 的控件。

这可以做到吗？谢谢。

**编辑**：

为了澄清这里是 MyControl 的模型：

```
public class MyControl : Panel
{
  protected override void OnInit(System.EventArgs e)
  {
    base.OnInit(e);
    if (!String.IsNullOrEmpty(LinkControlID))
    {
      Control link = Parent.FindControl(LinkControlID);
      if (link != null)
      {
        Controls.Add(link);
      }
    }
  }
  public string LinkControlID { get; set; }
} 
```

这假设 MyControl 和 LinkControlID 位于树层次结构中的同一级别，这在我的情况下是可以的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T04:55:02.450

为什么不尝试在**Page_LoadComplete中添加它**

```
myc.Controls.Add(NewParent); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T05:03:20.973

我无法重现它，但正如 aman.tur 建议的那样，您是否尝试过其他活动？覆盖`CreateChildControls()`似乎是适合它的地方。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-08-04T19:51:19.967

@TheVillageIdiot 的建议对我有用：

```
protected void Page_Init(object sender, EventArgs e)
{
  Page.LoadComplete += Page_LoadComplete;
}

private void Page_LoadComplete(object sender, EventArgs e)
{
  if (InHeader)
  {
    Page.Header.Controls.Add(this);
  }
} 
```

请注意，我有不同的要求，但我认为如果您可以从`MyControl`. 一般的格式是在 上添加一个事件监听`Page`器来进行更改`LoadComplete`。

# .net - 数据驱动的依赖注入

> ID：937877
> 
> 赞同：1
> 
> 时间：2009-06-02T04:16:46.573
> 
> 标签：.net, dependency-injection, data-driven

是否有任何框架允许数据驱动的依赖注入（理想情况下在 .NET 中）？例如，我在想一些受 Spring.NET 启发的东西，在结构化数据库表中配置对象图，而不是使用 XML 配置文件。在数据库而不是 XML 文件中配置应用程序的优缺点是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T05:56:16.733

这是[.Net IOC 框架的列表](http://www.hanselman.com/blog/ListOfNETDependencyInjectionContainersIOC.aspx)

还有一个我喜欢的微软模式和实践...... [Unity](http://codeplex.com/unity)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-04T01:31:41.967

[Autofac](http://code.google.com/p/autofac/)有[modules](http://code.google.com/p/autofac/wiki/StructuringWithModules)的概念，它允许你有条件地配置容器中的注册。

模块还允许重复使用相关的注册集。

# c# - 用户配置文件定义问题

> ID：937882
> 
> 赞同：1
> 
> 时间：2009-06-02T04:22:38.743
> 
> 标签：c#, frameworks, profile

我正在开发一个网站，我需要构建一个数据结构来存储用户个人资料信息。就像我们填写的关于我们的性别/年龄/教育/等的内容一样。Facebook等的信息

我目前遇到的问题是，

1.  目前我可能不会考虑当前设计/开发阶段所需的所有用户配置文件信息，如何设计一个可扩展的框架以便将来我可以轻松扩展用户配置文件？是否有任何成熟的（开源）用户配置文件框架可供参考？
2.  关于我们需要在用户档案中收集哪些标准项目，是否有任何标准？
3.  如何确保安全/灵活地共享不同应用程序的用户个人资料信息？例如，app1 只需要用户配置文件的一部分，出于安全原因，我只需将用户配置文件的一部分暴露给 app1。但是我们需要让它足够灵活，以便当 app1 需要额外的用户配置项时，我们可以轻松地公开更多。

C# 或中性编程语言的解决方案值得赞赏。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T04:25:17.840

用户资料没有什么特别之处。您所要求的几乎适用于我曾经开发过的所有应用程序：存储和共享数据。

不同的平台在不同的事情上做得更好，但没有解决这个问题的灵丹妙药——这就是软件的全部意义所在。

例如，您可以在数据库中创建用户表和一些 CRUD 屏幕来管理它。您可以使用多种方法在该数据中创建 API。

当您的要求发生变化时，请重复（并希望您不必更改太多）。

# c++ - 如何在 boost::python 嵌入式 python 代码中导入模块？

> ID：937884
> 
> 赞同：12
> 
> 时间：2009-06-02T04:23:02.613
> 
> 标签：c++, boost-python

我正在使用 boost::python 将一些 python 代码嵌入到应用程序中。我能够正确评估打印语句或其他表达式，但是当我尝试导入模块时，它没有导入并且应用程序正在退出。此外，嵌入式代码中的 globals() 函数调用也会产生运行时错误。

```
#include <boost/python.hpp>

using namespace boost;
using namespace boost::python;
using namespace boost::python::api;

int main(void) {
    Py_Initialize();
    object main_module = import("__main__");
    object main_namespace = main_module.attr("__dict__");
    main_namespace["urllib2"] = import("urllib2");

    object ignored = exec(
            "print 'time'\n", main_namespace);
} 
```

在这里，我尝试使用 boost 导入函数导入 urllib2，这可以正常编译和运行，但是使用以下 exec 语句，它会出错。

```
 object ignored = exec(
            "print urllib2\n"
            "print 'time'\n", main_namespace); 
```

或者当我删除 boost 导入功能并从嵌入式代码中进行导入时，它会给出错误。我尝试使用 try: except: block 但这也不起作用。这是因为 C++ 应用程序无法找到 urllib2 py 模块的位置还是什么？有没有办法在尝试导入之前设置模块的路径？

这只是为内部使用而构建的，因此可以接受一些路径的硬编码。

*编辑：更多信息：*
这就是发生的事情。我尝试了.. catch 并在出现异常时调用 PyErr_Print() ，并且在有模块导入甚至函数调用时一直将其视为错误。错误信息：

```
Traceback (most recent call last):
  File "<string>", line 1, in <module>
TypeError: 'NoneType' object does not support item assignment 
```

谁能想到任何理由？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-02T06:38:06.587

如果你还没有，你需要

```
导入系统
sys.path.append("/home/user/whatever")

```

几年前嵌入 boost::python (Python v2.5) 时，这解决了我的问题。

编辑：

在旧代码中翻来覆去。也许这可以解决问题：

```
Py_SetProgramName(argv[0]);
Py_InitializeEx(0);

```

听起来不确定你是否真的需要`Py_SetProgramName()`，但我隐约记得那里有一些可疑的事情。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-11T18:04:14.537

这没有帮助，但我找到了一个不同的解决方案来解决我的问题。我当前的代码如下所示：

```
#include <boost/python.hpp>
#include <iostream>

using namespace std;
using namespace boost;
using namespace boost::python;
using namespace boost::python::api;

int main(void) {
        Py_Initialize();
        boost::python::object http = boost::python::import("urllib2");

        try
        {
                boost::python::object response = http.attr("urlopen")("http://www.google.com");
                boost::python::object read = response.attr("read")();
                std::string strResponse = boost::python::extract<string>(read);
                cout << strResponse << endl;
        }
        catch(...)
        {
                PyErr_Print();
                PyErr_Clear();
        }
} 
```

无论如何，感谢乔纳斯的回答

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-03T18:38:27.743

我遇到了与您相同的问题，即导致 TypeError 的一个非常简单的示例，并在[这个问题](https://stackoverflow.com/questions/215752/python-embedded-in-cpp-how-to-get-data-back-to-cpp/215772)中找到了答案，即提供两次命名空间，作为全局和本地。

# c# - 使用 phpMyAdmin 更改 MySql 区分大小写？

> ID：937886
> 
> 赞同：4
> 
> 时间：2009-06-02T04:23:32.377
> 
> 标签：c#, .net, mysql, blogengine.net

我正在运行 Blogengine.Net 并注意到这些表都是小写的（表名 be_settings），但很多查询都是混合大小写的（Select * from be_Settings）。如果您的 MySql 实例在 Windows 上运行或设置为与 Windows 兼容，则此方法可以正常工作。我收到一个错误，因为我的托管服务提供商 MySql 实例区分大小写。是否可以更改设置以通过 phpMyAdmin 修复此错误？如果我不需要，我不想浏览所有代码并修复 BlogEngine.Net。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T05:06:05.027

MySQL 表名中的大小写敏感度特定于操作系统。MySQL 数据存储在文件中，这些文件受操作系统强制执行的任何规则的约束。例如，Linux 区分大小写。

有一个可以操作的变量“lower_case_table_names”，但似乎您必须重新创建所有表。

[http://dev.mysql.com/doc/refman/5.0/en/identifier-case-sensitive.html](http://dev.mysql.com/doc/refman/5.0/en/identifier-case-sensitivity.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T04:38:29.803

您所追求的设置是 lower_case_table_names （设置为 1 或 2）。不幸的是，这需要在 MySQL 守护进程启动时设置，而不是通过 phpmyadmin。您能否要求您的托管服务提供商为您执行此操作？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T20:38:54.437

如果您尝试为 BlogEngine.Net 解决这个问题，您可以轻松地重命名所有表以使用 CamelCase，因为 BlogEngine.Net 中的所有查询都是使用 CamelCase 编写的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T04:37:43.220

数据库是如何创建的？您可能会发现创建表的查询使用了正确的大小写：

```
CREATE TABLE be_Settings ( ... ) 
```

只是 myisam 表作为文件存储在文件系统中，并且由于它在 Windows 上，它们只是转换为小写。如果您在 linux 系统上从这些查询创建数据库，您会发现所有表的大小写都是正确的。

从中吸取的教训是始终使表名小写...

# asp.net - jQuery POST 不改变 IsPostback 变量

> ID：937890
> 
> 赞同：3
> 
> 时间：2009-06-02T04:26:40.633
> 
> 标签：asp.net, jquery, forms

当使用 jQuery 将数据 POST 回服务器时，我遇到了一些奇怪的行为。

如果我在我的序列化表单数据中包含 __VIEWSTATE 和 __EVENTVALIDATION，则 IsPostback 页面变量设置为 true，如果我排除这两个，则 IsPostback 设置为 false。

包含这两个变量对我来说很容易，但有人知道幕后发生了什么吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-02T04:31:09.573

viewstate 和 eventvalidation 跟踪的一件事是是否发生了回发。考虑到基于事件的 ASP.NET 页面生命周期，除了简单地将值存储在某处之外，没有其他方法可以跟踪是否发生了回发。

换句话说，您可以通过深入查看视图状态对象并找到回发布尔值并将其更改为 true 来手动检查回发。这可能与描述的不完全一样，但它更好地突出了视图状态内部发生的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T06:01:12.980

IsPostBack() 有点乱，但是是的，它正在检查 __VIEWSTATE 和 __EVENTVALIDATION 而不是其他的。它当然不会检查 HTTP 动词是 POST 还是 GET，这是大多数人假设的（如果您设置一个简单的页面并将 viewstate 和 eventvalidation（如果存在）字段放在查询中，您可以看到这一点）字符串然后检查 IsPostBack()

但是，您为什么要检查？实际上，这仅在发送完整表单提交时才起作用，如果您要部分发布，则倾向于将其发送到 IsPostBack 不重要的 Web 服务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T16:39:50.390

如果你想用 jquery 发出一个“回发”，你应该包括 __VIEWSTATE 和 __EVENTVALIDATION。这是 ASP.NET WebForms 需要能够正确传播完整回发的两个关键数据块。如果您只希望发出服务调用，那么您不需要这些字段中的任何一个，但是您将失去发布到具有 WebForms 事件管道的所有好处的页面的能力。

# objective-c - 如何从 compileAndReturnError 获得错误消息？

> ID：937891
> 
> 赞同：1
> 
> 时间：2009-06-02T04:26:43.813
> 
> 标签：objective-c, cocoa, applescript

我看过很多关于如何使用的例子`NSAppleScript`，例如：

```
NSAppleScript *script = = [[NSAppleScript alloc] initWithSource:source];
NSDictionary *errorDict;
if ( ![script compileAndReturnError:&errorDict] ) {
    // ...
} 
```

但我从未见过任何与`errorDict`. 就我而言，我想提取错误消息字符串。如何做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T04:51:33.937

首先，由于返回的对象是一个字典，你可以通过简单的检查来了解它。例如，尝试将以下内容添加到您的 if 块中；

```
NSLog(@"Got error dict %@", errorDict); 
```

这将向您显示返回给您的命名键和值。

显然，最好对键值使用命名常量，因此请参阅此处的文档：

[http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSAppleScript_Class/Reference/Reference.html#//apple_ref/c/data/NSAppleScriptErrorMessage](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSAppleScript_Class/Reference/Reference.html#//apple_ref/c/data/NSAppleScriptErrorMessage)

搜索“错误字典键”以获取更多信息。要在这里回答您的具体问题，听起来您需要 NSAppleScriptErrorBriefMessage 或 NSAppleScriptErrorMessage。

# visual-studio-2008 - 用于测量 Windows 服务进程和使用资源的工具

> ID：937895
> 
> 赞同：0
> 
> 时间：2009-06-02T04:29:58.153
> 
> 标签：visual-studio-2008, wcf, load-testing, stress-testing

嗨
，我为我的 WCF 服务编写了压力测试，但服务在远程机器上，我可以测量 Windows 服务使用进程和其他资源吗？有没有其他工具？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T05:44:51.743

本质上，您需要一个监控远程[WMI](http://en.wikipedia.org/wiki/Windows_Management_Instrumentation)事件的工具。

如果您想与压力测试集成，那么 Visual Studio 2008 中的负载测试会在执行测试时提供对远程服务器的监控（有关负载测试的[示例章节](http://www.packtpub.com/files/software-testing-with-visual-studio-team-system-2008-sample-chapter-5-load-testing.pdf)提供了详细信息）。

如果您不想使用 Visual Studio，则使用内置的[perfmon.msc](http://technet.microsoft.com/en-us/library/cc961845.aspx)来监控大量计数器（例如 cpu 负载、磁盘使用情况）。这可能是您最好的选择。例如，如果您查看“ServiceModelService 3.0.0.0”对象，则有几个 WCF 特定计数器，例如调用次数、调用故障等。

但是 prefmon 不会（afaik）向您显示每个进程的特定 cpu 使用情况。为此，您将需要一个 3rd-party 工具，该工具将更具体地监控每个进程的 cpu 使用情况。例子是：

*   [远程进程浏览器](http://lizardsystems.com/remote-process-explorer/index.php)
*   [远程任务管理器](http://www.devicelock.com/rtm/)
*   [远程进程查看器](http://www.file.net/remote-process-viewer/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T04:36:19.727

我从未真正做过，但我读过关于将探查器附加到 .NET 服务的信息。这里有一篇文章可能会给你一些想法：

[http://msdn.microsoft.com/en-us/library/dd255414.aspx](http://msdn.microsoft.com/en-us/library/dd255414.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T04:39:49.037

您是否考虑过使用性能监视器 (perfmon.msc) 来监视各种 WMI 事件？

# iphone - 解析和下载 iTunes Connect 和 AppStore 数据的脚本

> ID：937899
> 
> 赞同：33
> 
> 时间：2009-06-02T04:31:32.693
> 
> 标签：iphone, app-store, app-store-connect

我正在寻找有关下载和解析 iTunes Connect 销售数据以及 AppStore 评论、评级和排名数据的已定义应用程序的脚本或一系列脚本的建议。

我也知道以下解决方案：

*   ~~[应用可视化](http://www.ideaswarm.com/products/appviz/)~~
*   ~~[appsales-移动](http://code.google.com/p/appsales-mobile/)~~（死的）
*   ~~[iphone-stats](http://github.com/kasatani/iphone-stats/tree/master)（死）~~
*   [Heartbeat.app](http://heartbeatapp.com)（死）

我相信我会通过更多搜索找到更多。

考虑到现在有多少开发人员正在为 AppStore 编写应用程序，我不禁觉得必须有一套非常不错的开源脚本才能做到这一点。

也有兴趣听到任何商业产品（尽管我个人偏爱开源，所以我至少可以看到它用我的 iTunes Connect 登录凭据做了什么）。

需要明确的是，我真的在寻找能够触及所有提到的领域的东西：

**应用商店**（每个商店）

*   评论
*   收视率
*   品类/店铺排名

**iTunes 连接**

*   销售报告的内容

数据的分析/图表不是必需的（但我猜会很好）。我并不是真的在寻找像上面的 AppSales Mobile 这样的东西，我想要原始数据，以便我可以进行自己的分析和格式化。到目前为止，AppViz（上面列出的）看起来是最好的。

关于什么是好的/可用的任何建议，还是我应该自己动手？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2010-06-28T07:45:58.180

[www.appannie.com](http://www.appannie.com)是一个相对较新的网站，可以完成您提到的所有事情。我认为它符合您的需求，因为它专注于简单易用。

它现在是免费的，所以你可能想试一试。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-06-29T12:53:59.030

查看 www.appfigures.com，它几乎涵盖了上述所有内容，包括：自动报告下载（并以完全访问权限存档）、按日期、国家、地区等分类的各种交互式销售报告，来自所有应用商店的评论（ 123），并在所有国家/地区排名前 400 名。

它还通过电子邮件发送报告，因此您甚至不必登录。

而且它是免费的（在测试版中）

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-09-29T07:38:53.567

~~Apple 的官方 AutoIngest 工具可以使用吗？[见第 3.2 节](http://www.apple.com/itunesnews/docs/AppStoreReportingInstructions.pdf)~~

编辑：截至 2016 年 12 月 6 日，Autoingest 已被[Reporter](https://help.apple.com/itc/appsreporterguide/#/itcbe21ac7db)工具弃用。您应该改用它。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-06-18T08:02:55.967

有关排名的详细信息，请查看这篇文章

[抓取 AppStore 评论](http://blogs.oreilly.com/iphone/2008/08/scraping-appstore-reviews.html)

许多评论还继续发展在页面上完成的工作。

[对于评论，有一个 Adob​​e Air 应用程序可以从这里](http://www.peterelst.com/blog/2008/12/25/iphone-app-reviews-air-application/)收集全球商店评论 ，但我不相信来源可用。然而，事实证明这是可能的。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-04-15T12:45:33.520

这仅涵盖评论，但它适用于该评论，并且免费：[AppsReviewFinder](http://www.massycat.co.uk/iphonedev/AppReviewsFinder/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-06-02T21:49:44.590

Rogue Amoeba 家伙制作了[iTunesConnectArchiver](http://www.rogueamoeba.com/utm/2009/05/04/itunesconnectarchiver/)来持久化和存储原始数据。我没有使用它，所以我不确定是处理评论/评级还是只是销售数据，但代码是可用的，至少看起来是一个很好的起点

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-02-09T17:18:49.377

我编写了一个 C# 应用程序来获取和显示来自所有 AppStore 的所有评论。

**更新：**它不是脚本，但源代码可在 GitHub ( [http://github.com/berzniz/SimpleAppReviews/](http://github.com/berzniz/SimpleAppReviews/) ) 上获得，因此您可以对其进行扩展。

目前它可以：

*   下载每个商店的所有评论和评分
*   在可排序的表格中显示评论
*   将数据导出到 CSV

你可以在这里得到它：[SimpleAppReviews](http://www.ketacode.com/simpleappreviews/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-12-15T12:59:37.597

如果您允许我在这里推广我自己的小脚本：我已经编写了一个 Ruby 脚本来将来自 iTunes Connect 的原始财务报告格式化为一个漂亮的 HTML 表格。它不会从 iTunesConnect 下载文件，因此您必须先使用其他工具之一。您可以[在 GitHub 上获取脚本](http://github.com/ole/itunesconnect-financialreports)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-06-11T08:32:11.870

我使用[WWW::iTunesConnect](https://metacpan.org/pod/WWW::iTunesConnect)但那是因为我写的

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-06-19T00:16:40.830

您可能还对我编写的用于检查 App Store 主页、What's new、What's hot 或 Staff pick 中精选应用的脚本感兴趣：

[http://www.futuretap.com/blog/scraping-app-store-featured-entries/](http://www.futuretap.com/blog/scraping-app-store-featured-entries/)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-08-02T05:14:05.387

我已经在 Sourceforge 开始了一个项目：[https](https://sourceforge.net/projects/itunesanalytics/) ://sourceforge.net/projects/itunesanalytics/ 。它现在处于规划阶段，但如果有人想加入，我认为有潜力开发一个简单、强大、开源、免费、自托管的网络应用程序。我在想一些东西，它会拉下数据，将其添加到数据库中，然后提供这里许多其他项目正在尝试创建的图形和视图。

我认为有很多功能是可取的，但是让一些代码启动并运行并在那里运行可能会对让更多人参与其中大有帮助。

这可能是我学习 Ruby on Rails 的好时机。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-10-21T20:26:50.403

我编写了一个小脚本来同步来自 iTunes Connect 的过去 12 个月的财务报告（不是销售额，而是付款报告）：

[https://gist.github.com/futuretap/69c6289e791b10b43fba](https://gist.github.com/futuretap/69c6289e791b10b43fba)

它基于 Apples Autoingestion 工具。

# c - C - strftime() 中不正确的指针/整数组合

> ID：937905
> 
> 赞同：3
> 
> 时间：2009-06-02T04:36:08.743
> 
> 标签：c, strftime

我收到编译器错误：（83）错误：不正确的指针/整数组合：arg #1。

这是执行此操作的代码：

```
char boot_time[BUFSIZ]; 
```

...第 83 行：

```
strftime(boot_time, sizeof(boot_time), "%b %e %H:%M", localtime(table[0].time)); 
```

其中 table 是一个结构， time 是一个 time_t 成员。

我读到“不正确的指针/整数组合”意味着函数未定义（因为在 C 中，函数在找不到时返回整数），正常的解决方案是包含一些库。strftime() 和 localtime() 都在 time.h 中，而 sizeof() 在 string.h 中，我已经包含了这两个（连同 stdio.h）我在这里完全被难住了。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-02T04:44:01.903

```
struct tm * localtime ( const time_t * timer ); 
```

正确的[用法](http://www.cplusplus.com/reference/clibrary/ctime/localtime/)是：

```
time_t rawtime;
localtime(&rawtime); 
```

在你的情况下：`localtime(&(table[0].time))`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T04:41:37.660

`localtime`接受 a `time_t*`，所以通过`&table[0].time`（地址，而不是值）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-02T04:43:01.933

问题似乎是对本地时间的调用。这个函数需要一个`time_t`指针而不是一个值。我相信您需要按以下方式拨打电话

```
localtime(&(table[0].time)) 
```

当地时间签名

```
struct tm * localtime ( const time_t * timer ); 
```

参考本地时间 API

*   [http://www.cplusplus.com/reference/clibrary/ctime/localtime/](http://www.cplusplus.com/reference/clibrary/ctime/localtime/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-02T05:46:05.300

正如其他人所提到的，特定的问题是您需要将 a 传递`time_t *`给本地时间。

然而，普遍的问题是你在一条复杂的生产线上遇到了一个不清楚的问题，它做了很多事情。当您遇到错误时，首先要尝试的是将线路拆分为其组成部分，以缩小问题所在，如下所示：

```
char boot_time[BUFSIZ];
// Temporary, putting the sizeof() call inline is normally better.
size_t boot_time_size = sizeof(boot_time); 
time_t temp_time = table[0].time;
// Use a more descriptive name here.
struct tm *mytime = localtime(temp_time); 

strftime(boot_time, boot_time_size, "%b %e %H:%M", mytime); 
```

通过这种方式，编译器可以告诉您哪个调用是真正给您带来问题的调用。一旦你弄清楚了，你可以在你认为合适的时候把它压缩回去——我可能仍然会把 localtime() 调用保持在自己的线路上，但这只是我。

# sql - 如何检测存储过程是否已存在

> ID：937908
> 
> 赞同：138
> 
> 时间：2009-06-02T04:37:18.713
> 
> 标签：sql, sql-server-2005, stored-procedures

我必须编写一个部署脚本，如果存储过程存在或不存在，它将起作用。即如果它存在，那么我需要改变它，否则创建它。

我怎样才能在 sql 中做到这一点。

我正在使用 SQL Server 2005

* * *

## 回答 #1

> 赞同：163
> 
> 时间：2009-06-02T06:39:27.143

如果您 DROP 和 CREATE 过程，您将失去安全设置。这可能会惹恼您的 DBA 或完全破坏您的应用程序。

我所做的是创建一个微不足道的存储过程，如果它还不存在的话。之后，您可以根据自己的喜好更改存储过程。

```
IF object_id('YourSp') IS NULL
    EXEC ('create procedure dbo.YourSp as select 1')
GO
ALTER PROCEDURE dbo.YourSp
AS
... 
```

这样，安全设置、评论和其他元数据将在部署后继续存在。

* * *

## 回答 #2

> 赞同：151
> 
> 时间：2009-06-02T04:50:52.533

最干净的方法是测试它的存在，如果存在则删除它，然后重新创建它。您不能在 IF 语句中嵌入“create proc”语句。这应该做得很好：

```
IF OBJECT_ID('MySproc', 'P') IS NOT NULL
DROP PROC MySproc
GO

CREATE PROC MySproc
AS
BEGIN
    ...
END 
```

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2009-06-02T04:51:47.213

如果您只处理存储过程，最简单的方法是删除 proc，然后重新创建它。您可以使用 SQL Server 中的“生成脚本”向导生成所有代码来执行此操作。

```
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[YourSproc]') AND type in (N'P', N'PC'))
DROP PROCEDURE [dbo].[YourSproc]

CREATE PROCEDURE YourSproc... 
```

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2015-11-22T14:24:02.933

从`SQL Server 2016 CTP3`您可以使用新的*DIE* 语句而不是大`IF`包装器

句法：

> 删除 { 过程 | 过程 } [ 如果存在 ] { [ schema_name. ] 程序 } [ ,...n ]

询问：

```
DROP PROCEDURE IF EXISTS usp_name 
```

更多信息[**在这里**](https://msdn.microsoft.com/en-us/library/ms174969.aspx)

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-06-02T04:43:59.903

```
if not exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[xxx]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
BEGIN
CREATE PROCEDURE dbo.xxx 
```

`xxx`过程名称在哪里

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2019-04-09T09:51:53.933

您可以编写如下查询：

```
IF OBJECT_ID('ProcedureName','P') IS NOT NULL
    DROP PROC ProcedureName
GO

CREATE PROCEDURE [dbo].[ProcedureName]
...your query here.... 
```

更具体地说明上述语法：
**OBJECT_ID**是数据库中对象的唯一 ID 号，由 SQL Server 内部使用。因为我们传递了**ProcedureName**后面跟着你的对象类型**P**，它告诉 SQL Server 你应该找到名为**ProcedureName**的对象，它的类型是**procedure，即 P**

此查询将找到该过程，如果它可用，它将删除它并创建一个新的。

有关 OBJECT_ID 和对象类型的详细信息，请访问：**[SYS.Objects](https://docs.microsoft.com/en-us/sql/relational-databases/system-catalog-views/sys-objects-transact-sql?view=sql-server-2017)**

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-06-02T18:30:03.930

除了已经说过的内容之外，我还想添加一种不同的方法，并提倡使用差异化脚本部署策略。[与其制作一个始终检查当前状态并根据该状态进行操作的有状态脚本，不如通过一系列从众所周知的版本升级的无状态脚本进行部署](http://rusanu.com/2009/05/15/version-control-and-your-database/)。我已经使用了这种策略，并且它带来了巨大的回报，因为我的部署脚本现在都是“IF”免费的。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-06-02T04:47:49.870

```
IF OBJECT_ID('SPNAME') IS NULL
     -- Does Not Exists
ELSE
     -- Exists 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-02T04:47:15.673

更好的选择可能是使用 Red-Gate SQL Compare 或 SQL Examiner 等工具来自动比较差异并生成迁移脚本。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-11-22T06:01:01.543

I have a stored proc that allows the customer to extend validation, if it exists I do not want to change it, if it doesn't I want to create it, the best way I have found:

```
IF OBJECT_ID('ValidateRequestPost') IS NULL
BEGIN
    EXEC ('CREATE PROCEDURE ValidateRequestPost 
    @RequestNo VARCHAR(30),
    @ErrorStates VARCHAR(255) OUTPUT
AS
BEGIN
    SELECT @ErrorStates = @ErrorStates
END')
END 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-08-18T10:03:38.100

下面的代码将检查存储过程是否已经存在。

如果存在，它将改变，如果不存在，它将为您创建一个新的存储过程：

```
//syntax for Create and Alter Proc 
DECLARE @Create NVARCHAR(200) = 'Create PROCEDURE sp_cp_test'; 
DECLARE @Alter NVARCHAR(200) ='Alter PROCEDURE sp_cp_test'; 
//Actual Procedure 
DECLARE @Proc NVARCHAR(200)= ' AS BEGIN select ''sh'' END'; 
//Checking For Sp
IF EXISTS (SELECT * 
           FROM   sysobjects 
           WHERE  id = Object_id('[dbo].[sp_cp_test]') 
                  AND Objectproperty(id, 'IsProcedure') = 1 
                  AND xtype = 'p' 
                  AND NAME = 'sp_cp_test') 
  BEGIN 
      SET @Proc=@Alter + @Proc 

      EXEC (@proc) 
  END 
ELSE 
  BEGIN 
      SET @Proc=@Create + @Proc 

      EXEC (@proc) 
  END 

go 
```

# jquery - 使用Jquery解析xml时如何保留html

> ID：937911
> 
> 赞同：3
> 
> 时间：2009-06-02T04:38:33.767
> 
> 标签：jquery, xml

假设我有以下 XML 结构：

```
<root>
 <item>
  <item1>some text is <b>here</b></item1>
  <item2>more text is here</item2>
 </item>
</root> 
```

我可以使用以下方式解析 xml：

```
$(responseXML).find('item').each(function(){
             var first_text = $(this).find('item1').text();
             var second_text = $(this).find('item2').text();
} 
```

但是使用 .text() 时不会保留 html。html() 不适用于 jquery 中的 xml。

关于在解析 xml 时如何保留内部 html 的任何想法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-02T04:40:20.657

将您不想解释为 xml 的部分嵌套在 CDATA 部分中，例如

```
<root>
 <item>
  <item1><![CDATA[some text is <b>here</b>]]></item1>
  <item2><![CDATA[more text is here]]></item2>
 </item>
</root> 
```

编辑：注意，如果使用 .text() 不起作用，请尝试以下操作：

引用自：[http ://dev.jquery.com/ticket/2425](http://dev.jquery.com/ticket/2425)

> 我刚刚又遇到了这种情况。出于好奇，我的解决方法不是使用 .text() 来使用我创建的这个插件（只需将 .text() 替换为 .getCDATA()：

```
jQuery.fn.getCDATA = function() {
if($.browser.msie)
    return this[0].childNodes[0].nodeValue;
    // Other browsers do this
return this[0].childNodes[1].nodeValue;
 }; 
```

> 它不漂亮，但在我的情况下完成了这项工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-10-09T15:44:14.237

`Text()`会给你节点的文本信息。但是，如果您使用：

```
var first_text = $(this).find('item1').html();
var second_text = $(this).find('item2').html(); 
```

你也会得到 HTML 标签。

# php - 编写 PHP 文件以从 CSV 读取并执行 SQL 查询

> ID：937912
> 
> 赞同：8
> 
> 时间：2009-06-02T04:39:18.273
> 
> 标签：php, mysql, csv

我想要一个 PHP 脚本以下列格式从 CSV 文件中读取内容

```
id, sku
1,104101
2,105213 
```

总共有 1486 个条目，我认为最好使用 for 循环而不是 while !EOF。

之后，我想对名为 m118 的数据库表 catalog_product_entity 执行 SQL 查询。

查询类似于 UPDATE sku=$csvSku WHERE id=$csvId

作为 PHP 和 MySQL 的新手，我不知道从哪里开始编码。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-06-02T05:10:42.587

fgetcsv 可用于解析 CSV 文件。mysql_query 方法可用于执行 MySQL 查询。

完整代码如下：

```
<?php
$fin = fopen('catalog_product_entity.csv','r') or die('cant open file');
$link = mysql_connect('localhost', 'm118', 'pw');
If (!$link) {
    die ('Could not connect: ' . mysql_error());
}
@mysql_select_db('m118') or die ('Unable to select database');
echo "Connection succeeded <br />\n";
while (($data=fgetcsv($fin,1000,","))!==FALSE) {
    $query = "UPDATE catalog_product_entity SET sku='$data[1]' WHERE entity_id='$data[0]'";
    mysql_query($query);
    echo "Record updated <br />\n";
    }
fclose($fin);
mysql_close();
?> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-02T05:10:07.360

您将需要执行以下操作：

```
$filename = "file_name_on_server.csv"
$fp = fopen( $filename ,"r");
while ($line = fgets ($fp))
{ 
```

现在使用[Split](http://au2.php.net/split)来获取逗号分隔值的数组

```
 $arr = split (",", $line); 
```

现在你有一个用于 $line 上逗号分隔值的数组。您可以进行简单的字符串格式化以将这些值粘贴到 SQL 查询中。

```
 $query = "INSERT INTO `TableBlah` (Field1, Field2) VALUES (" . $arr[0] . "," . $arr[1] . ")"; 
```

使用[mysql api](http://au.php.net/manual/en/book.mysql.php)将这些查询发送到数据库

```
}
fclose($fp); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-02T06:02:39.423

学习成绩不错：）

您现在或许应该了解PHP 中的[PDO](http://www.php.net/pdo)，因为它（在我看来）是在 PHP 中执行 MySQL 查询的最佳、最安全和最快的方法：

```
<?php
$fin = fopen('catalog_product_entity.csv','r') or die('cant open file');
try {
    $link = new PDO('mysql:dbname=m118;host=localhost', 'm118', 'pw');
    echo 'Connection succeeded <br />' . PHP_EOL;
    $stmt = $db->prepare('UPDATE catalog_product_entity SET sku = :sku WHERE entity_id = :id');
    //Only give the length parameter if you **KNOW** that no line will be longer than that
    while (($data=fgetcsv($fin,1000,","))!==FALSE) {
        if ($stmt->execute(array(':sku' => $data[1], ':id' => $data[0]))) {
            echo 'Record updated <br />' . PHP_EOL;
        } else {
            $err = $stmt->errorInfo();
            echo 'Update Failed: ' . $err[2] . PHP_EOL;
        }
    }
} catch (PDOException $e) {
    echo 'Connection failed: ' . $e->getMessage();
}
fclose($fin); 
```

PDO 脚本与您的相比具有以下优点：

*   更安全：PDO 会根据需要自动引用插入的数据。这可以防止 SQL 注入攻击。
*   更快：PDO 缓存查询（在准备中），然后使用传入的参数执行。
*   它是可移植的：PDO 可以连接到各种类型的 DB，而不仅仅是 MySQL，所以如果您需要切换 DB，它会容易得多。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-02T05:02:37.493

好吧，我不会为您编写代码，因为如果我这样做，您将不会学习。但我会为你指出正确的方向。查看此链接[http://us.php.net/fgetcsv](http://us.php.net/fgetcsv)以获取有关在 PHP 中解析 CSV 文件的信息。一个简单的谷歌搜索也应该为您提供将其输入 MySQL 表的必要信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-02T05:08:52.260

Goblyn27 是正确的。看看 php.net 上的 fgetcsv() 和 mysql_query()。文档中甚至还有如何执行此操作的示例。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-18T12:21:05.903

```
<?php
include ("dbsanjog.php");
$uploadedfile=$_REQUEST['uploadedfile'];
  $target_path = "dataupload/";
  $user=$_REQUEST['username'];
$target_path = $target_path.$user.".csv"; 

if(move_uploaded_file($_FILES['uploadedfile']['tmp_name'], $target_path)) 
{
    echo "The file ".  basename( $_FILES['uploadedfile']['name']). "has been uploaded";
} 

//echo $target_path; die;
//$row = 1;
$handle = fopen($target_path, 'r');
//$sql="update agents_det set where user='$user'";

while (($data = fgetcsv($handle, 1000, ",")) !== FALSE) 
{
    $query = "UPDATE agents_det SET contact='$data[3]' WHERE user='$user'";   

}

fclose($handle);
//mysql_query($test);
//echo ($test[1]); die;
//echo $test; die;

?> 
```

# winforms - DataGridViewImageColumn 红色 x

> ID：937919
> 
> 赞同：5
> 
> 时间：2009-06-02T04:42:16.570
> 
> 标签：winforms, datagridview

我创建了一个 DataGridView 并添加了一个 DataGridViewImageColumn（使用设计器）。

DataGridView 具有“AllowUserToAddRows = true”，因此会显示一个空白行供用户输入新行。在此空白行中，DataGridViewImageColumn 显示一个红色 x。无论该行是否有任何数据，我都希望始终在列中显示相同的图像（我正在绑定单元格的单击事件，因此使用 DataGridViewImageColumn 作为按钮）。

我如何摆脱红色x？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-09T14:38:01.467

我使用 ImageList 来保存我的所有图像，但这里有一个精简的版本应该会有所帮助。您设置值是正确的，但您应该将其设置为位图的空等效项，这只是一个静态空白图像。我用：

```
e.Value = (imageIndex != int.MinValue) ? imageList.Images[imageIndex] : nullImage; 
```

其中 nullImage 在类的前面定义为：

```
private readonly Image nullImage = new Bitmap(1, 1); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-11-24T18:29:11.270

我查看了这些解决方案，我让它工作的方式是`InitializeComponent()`在构造函数中调用后执行此操作，以使数据绑定行的默认图像为空图像

```
dataGridView1.Columns[0].DefaultCellStyle.NullValue = null; 
```

并钩住`RowPrePaintEvent`以删除网格末尾空行的红色 X，因为`AllowUserToAddRows = true`：

```
private void dataGridView1_RowPrePaint(object sender, DataGridViewRowPrePaintEventArgs e)
{
      if (e.RowIndex >= numberOfRows)
      {
           dataGridView1.Rows[e.RowIndex].Cells[0].Value = null;
      }
} 
```

哪里`numberOfRows`是网格中的有效行数。只花了几个小时处理这个问题。希望这可以避免其他人的头痛......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-09-19T12:53:23.013

我像这样使用了 grid.row 的 IsNewRow 属性

```
private void dgUserFileList_RowPrePaint(object sender, DataGridViewRowPrePaintEventArgs e) {
      DataGridViewRow row = dgUserFileList.Rows[e.RowIndex];
      if (row.IsNewRow) {
          row.Cells[0].Value = null;
        }
      }
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-02T23:35:44.720

我找到了解决方案，但我不确定这是最好的方法。

我覆盖 RowsAdded 事件并将 DataGridViewImageColumn 的值设置为 null。我认为由于该值为空，因此它会显示图像。

```
private void dgvWorksheet_RowsAdded(object sender, 
     DataGridViewRowsAddedEventArgs e)
{
    dgvWorksheet.Rows[e.RowIndex].Cells[colStartClock.Index].Value = null;
} 
```

我还在 Form_Load 中将 Column 的 NullValue 设置为 null

```
colStartClock.DefaultCellStyle.NullValue = null; 
```

我不确定我是否还有其他需要做的事情。它似乎正在工作，但似乎有点错误 - 随机点击有时会导致异常，因此需要进行更多调查。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-09-24T18:34:28.237

[MSDN 文档](https://msdn.microsoft.com/en-us/library/system.windows.forms.datagridviewimagecolumn(v=vs.110).aspx)对此相当冗长：

> 默认情况下，空单元格显示默认错误图形。若要防止此图形出现在等于**null**或 [DBNull.Value](https://msdn.microsoft.com/en-us/library/system.dbnull.value(v=vs.110).aspx)的单元格值中，请 在将行添加到控件之前将[DefaultCellStyle](https://msdn.microsoft.com/en-us/library/system.windows.forms.datagridviewimagecolumn.defaultcellstyle(v=vs.110).aspx)属性返回的单元格样式对象的[DataGridViewCellStyle.NullValue](https://msdn.microsoft.com/en-us/library/system.windows.forms.datagridviewcellstyle.nullvalue(v=vs.110).aspx)属性设置为**null 。**但是，这不会影响新记录的行。[当控件AllowUserToAddRows](https://msdn.microsoft.com/en-us/library/system.windows.forms.datagridview.allowusertoaddrows(v=vs.110).aspx)属性值为**true**时，要防止错误图形出现在新记录的行中，您还必须在控件[RowsAdded](https://msdn.microsoft.com/en-us/library/system.windows.forms.datagridview.rowsadded(v=vs.110).aspx)的处理程序中将单元格值显式设置为 **null********事件或将列 [CellTemplate属性设置为](https://msdn.microsoft.com/en-us/library/system.windows.forms.datagridviewimagecolumn.celltemplate(v=vs.110).aspx)[DataGridViewImageCell](https://msdn.microsoft.com/en-us/library/system.windows.forms.datagridviewimagecell(v=vs.110).aspx)派生类型 的实例，该 类型具有返回**null的重写**[DefaultNewRowValue](https://msdn.microsoft.com/en-us/library/system.windows.forms.datagridviewimagecell.defaultnewrowvalue(v=vs.110).aspx)属性。******

 ******转换为代码意味着您可以在添加任何行之前执行此操作：

```
var column = new DataGridViewImageColumn();
column.DefaultCellStyle.NullValue = null;
column.CellTemplate = new DataGridViewEmptyImageCell(); 
```

然后把这个类放在某个地方：

```
private class DataGridViewEmptyImageCell : DataGridViewImageCell
{
    public override object DefaultNewRowValue { get { return null; } }
} 
```

或者在事件中设置`Cell.Value`为 null 。`Rows.Added`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-07-20T18:08:19.910

为 DataGridView 中的所有 DataGridViewImageColumn 元素避免这种默认行为的另一种方法是拦截 CellFormatting 事件：

```
dataGridView1.CellFormatting += delegate(object sender, DataGridViewCellFormattingEventArgs e)
{
    if (e.RowIndex < 0 || e.ColumnIndex < 0)
        return;

    var grid = (DataGridView)sender;
    if (grid.Columns[e.ColumnIndex] is DataGridViewImageColumn &&
        grid[e.ColumnIndex, e.RowIndex].DefaultNewRowValue.Equals(e.Value))
        e.Value = null;
}; 
```

这样，组件将始终为单元格使用 NullValue 图像，而不是默认的“不可用图像”。

# php - 内置 Kohana 方法可帮助开发 RSS 提要

> ID：937921
> 
> 赞同：0
> 
> 时间：2009-06-02T04:43:05.023
> 
> 标签：php, rss, kohana

我发现有一个助手可以帮助解析 Kohana 框架上的 RSS 提要。

有没有一个可以帮助创建一个？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-07-04T21:56:45.750

使用 Kohana 3 中的类的`create()`方法来处理它`Feed`。您将在以下位置找到它的代码：

> 系统/类/kohana/feed.php

您[至少需要定义频道信息及其提要项目](http://www.kerkness.ca/kowiki/doku.php?id=working_with_atom_and_rss_feeds "使用 Atom 和 RSS 提要")。

```
$info = array(
           'title' => 'Dark into the Narwhal',
           'pubDate' => date("D, d M Y H:i:s T"),
           'description' => 'Eating bacon, taking names and leaving fortunes',
           'link' => 'http://example.com/',
           'copyright' => 'The Narwhal Peon',
           'language' => 'en-us',
           'ttl' => '7200',
        );

$items = array(
           array(
               'title' => 'We journey with watermelon helmets',
               'link' => 'blog/journey-with-watermelon-helmets',
               'description' => 'Dawn breaks and the wind follows soon after. 
                                 We have found our supplies run low.',
           ),

            //-- and the other posts you want to include
         ); 
```

然后将该数据插入到生成 XML 的方法中：

```
$xml = Feed::create($info, $items); 
```

当您`echo`将其输出或将其传递给相关视图时，它将为您提供：

```
<?xml version="1.0" encoding="UTF-8"?>
 <rss version="2.0">
  <channel>
  <title>Dark into the Narwhal</title>
  <pubDate>Fri, 21 Dec 2012 13:32:42 EST</pubDate>
  <description>Eating bacon, taking names and leaving fortunes</description>
  <link>http://example.com/</link>
  <copyright>The Narwhal Peon</copyright>
  <language>en-us</language>
  <ttl>7200</ttl>
  <generator>KohanaPHP</generator>
  <item>
    <title>We journey with watermelon helmets</title>
    <link>http://example.com/blog/journey-with-watermelon-helmets</link>
    <description>Dawn breaks and the wind follows soon after. 
                 We have found our supplies run low.</description>
  </item>

  <!-- the other posts will be here -->

  </channel>
</rss> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T04:45:00.903

[http://docs.kohanaphp.com/helpers/feed#create](http://docs.kohanaphp.com/helpers/feed#create)

# c# - C# 编译器和 JIT 都做了哪些优化？

> ID：937922
> 
> 赞同：15
> 
> 时间：2009-06-02T04:43:22.637
> 
> 标签：c#, optimization, compiler-construction, jit

我正在为我的编译器类继续我的 C# 编译器的工作。目前，我几乎完成了教科书中关于编译器优化的章节。

在大多数情况下，我的教科书在编写时并没有考虑到即时编译，我很好奇 C# 编译器执行的静态预jit 优化与它在 JIT 过程中的作用?

当我与人们谈论针对 CLR 进行编译时，我通常会听到诸如“大多数优化都是由 JIT 完成的”之类的话。

循环展开、常量折叠/传播、指令交织等事情是由 C# 的编译器预先完成还是由抖动处理？如果它们没有被抖动处理，那么抖动做了什么样的优化，这是即时编译器所独有的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T04:49:34.720

我可以想象有许多 JIT 独有的优化；具体来说，任何取决于应用程序运行的环境/上下文的优化。（注意，以下所有内容都是假设的，我不确定，哪些或是否实际执行了其中的任何一个）

最无聊：JIT 可以根据 32 位/64 位底层操作系统进行优化，甚至可能取决于确切的处理器架构。

**不适用：** *更有趣的是：当应用程序不在调试上下文中运行时，JIT 可以优化仅在调试模式下运行的任何内容（例如某些条件代码）。*

最有趣的是：JIT 可以优化类中仅依赖于`readonly`字段的条件分支，因为至少理论上该值在类执行期间永远不会改变。

基本上，我认为将优化推迟到 JIT 通常是可行的方法，因为在 JIT 时间，关于代码实际运行的上下文的可用信息最多，这使得更有意义的优化成为可能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T06:03:39.577

David Notario 在他的博客上有一些帖子（你可以[从这里开始](http://blogs.msdn.com/davidnotario/archive/2004/10.aspx)，然后浏览历史），但它们相当粗略。

* * *

## 回答 #3

> 赞同：-5
> 
> 时间：2009-06-02T05:14:06.513

我不认为 C# 编译器做任何优化。JIT 完成所有工作。

# web-services - 使用 WCF 连接到 SharePoint 并对其进行身份验证

> ID：937926
> 
> 赞同：12
> 
> 时间：2009-06-02T04:44:38.093
> 
> 标签：web-services, sharepoint, wss, windows-authentication

我对这个疯了，在任何地方都找不到任何像样的信息..

有很多关于使用 WCF 和 Ntlm 模拟连接到 SharePoint 3.0 Web 服务的信息。但是，当访问 SharePoint 服务的客户端远离 SharePoint 网络并需要进行身份验证时，如何最好地配置凭据并将其传递给 SharePoint 服务。

我可以在 servicemodel.config 中的 SharePoint 框本地指定 Windows 用户名和密码吗？我们的 SharePoint 实例在访问它的域之外作为独立运行。因此，模拟是无关紧要的，因为共享点框上不存在域用户。

我尝试了许多组合，例如以下代码..但是我反复遇到异常，例如：

“HTTP 请求未经客户端身份验证方案‘匿名’未经授权。从服务器收到的身份验证标头是‘NTLM,Basic realm="wss.internaldev.local"’。

谁能提供一个使用 Windows 凭据连接到“远程”SharePoint Web 服务的示例？

```
ListsSoapClient proxy = new ListsSoapClient();

proxy.ClientCredentials.Windows.ClientCredential.UserName = "admin_user";
proxy.ClientCredentials.Windows.ClientCredential.Password = "admin_password";
proxy.ClientCredentials.Windows.AllowedImpersonationLevel = System.Security.Principal.TokenImpersonationLevel.Identification;

listItems = proxy.GetListItems(...);

proxy.Close(); 
```

绑定示例：

```
<security mode="TransportCredentialOnly">
  <transport clientCredentialType="Windows" proxyCredentialType="None" />
</security> 
```

或者..

```
<security mode="TransportCredentialOnly">
  <transport clientCredentialType="Ntlm" />
</security> 
```

行为：

```
<behavior name="behavior_WSS">
  <clientCredentials>
    <windows allowedImpersonationLevel="Impersonation" allowNtlm="true" />
  </clientCredentials>
</behavior> 
```

或者

```
 <windows allowedImpersonationLevel="Delegation" allowNtlm="true" /> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-04T02:07:29.447

你试过[这里建议的东西](http://social.msdn.microsoft.com/forums/en-US/sharepointdevelopment/thread/f493ebc5-88dc-40df-9813-5f9783fa6542)吗？

例如，在代码中：

```
proxy.ClientCredentials.Windows.AllowedImpersonationLevel = TokenImpersonation.Impersonate;
// AllowNtlm = false; 
```

# c# - 方法重载返回值

> ID：937928
> 
> 赞同：19
> 
> 时间：2009-06-02T04:46:37.297
> 
> 标签：c#, overloading

在 C# 中，我需要能够定义一个方法，但让它返回一个或两个返回类型。当我尝试这样做时，编译器给了我一个错误，但为什么它不够聪明，无法知道我需要调用哪个方法？

```
int x = FunctionReturnsIntOrString(); 
```

为什么编译器会阻止我拥有两个具有不同返回类型的函数？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-06-02T05:03:41.457

从[C# 3.0 语言规范](http://msdn.microsoft.com/en-us/vcsharp/aa336809.aspx)第 1.6.6 节的最后一段：

> 方法的签名在声明该方法的类中必须是唯一的。方法的签名由方法的名称、类型参数的数量及其参数的数量、修饰符和类型组成。方法的签名不包括返回类型。

在 IL 中，两个方法可以仅因返回类型而不同，但在反射之外，没有办法调用仅返回类型不同的方法。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-06-02T04:52:35.540

虽然在这种特定情况下可能很明显，但在许多情况下这实际上并不明显。让我们以下面的 API 为例

```
class Bar { 
  public static int Foo();
  public static string Foo();
} 
```

编译器根本不可能知道在以下情况下调用哪个 Foo

```
void Ambiguous() {
  Bar.Foo();
  object o = Bar.Foo();
  Dog d = (Dog)(Bar.Foo());
  var x = Bar.Foo();
  Console.WriteLine(Bar.Foo());
} 
```

这些只是一些快速示例。肯定存在更多人为和邪恶的问题。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-06-02T04:51:33.453

您是否考虑过使用泛型返回正确的类型。

```
public T SomeFunction<T>()
{
    return T
}

int x = SomeFunction<int>();
string y = SomeFunction<string>(); 
```

注意：此代码未经测试

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-06-02T04:53:22.547

仅与返回值不同的函数不符合重载条件。

```
int x = FunctionReturnsIntOrString();
double y = FunctionReturnsIntOrString(); 
```

在上述情况下，编译器可以识别正确的函数，但考虑到未指定返回值的情况，这是不明确的。

```
FunctionReturnsIntOrString();   //int version
FunctionReturnsIntOrString();   //double version 
```

编译器无法解析此处的重载方法。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-04-30T06:43:12.820

可以获得您在问题中显示的语法，但您必须非常聪明才能到达那里。

让我们更具体地设置问题。我认为这里的关键点是语法。我们想要这个：

```
int intValue = GetData();
string stringValue = GetData();
DateTime[] dateTimeArrayValue = GetData(); 
```

但是，我们不希望这样做：

```
double doubleValue = GetData();
DateTime? nullableDateTimeValue = GetData(); 
```

为了实现这一点，我们必须在 from 的返回值中使用一个中间对象`GetData()`，其定义如下所示：

```
public class Data
{
    public int IntData { get; set; }
    public string StringData { get; set; }
    public DateTime[] DataTimeArrayData { get; set; }

    public MultiReturnValueHelper<int, string, DateTime[]> GetData()
    {
        return new MultiReturnValueHelper<int, string, DateTime[]>(
            this.IntData, 
            this.StringData, 
            this.DataTimeArrayData);
    }
} 
```

当然，您的实现会完全不同，但这会发生。现在让我们定义`MultiReturnValueHelper`.

```
public class MultiReturnValueHelper<T1, T2, T3> : Tuple<T1, T2, T3>
{
    internal MultiReturnValueHelper(T1 item1, T2 item2, T3 item3)
        : base(item1, item2, item3)
    {
    }

    public static implicit operator T1(MultiReturnValueHelper<T1, T2, T3> source)
    {
        return source.Item1;
    }

    public static implicit operator T2(MultiReturnValueHelper<T1, T2, T3> source)
    {
        return source.Item2;
    }

    public static implicit operator T3(MultiReturnValueHelper<T1, T2, T3> source)
    {
        return source.Item3;
    }
} 
```

对一般情况重复此定义，对`T1`, `T2`,`T3`等。

您还可以将返回值帮助程序非常紧密地绑定到返回它的类或方法，使您能够为索引器创建同样的效果，您可以在其中获取和分配一组离散的类型。那是我发现它最有用的地方。

另一个应用程序是启用如下语法：

```
data["Hello"] = "World";
data["infamy"] = new DateTime(1941, 12, 7);
data[42] = "Life, the universe, and everything"; 
```

完成此语法的精确机制留给读者作为练习。

有关此问题的更通用解决方案（我认为，这与有区别的联合问题相同），请参阅[我对该问题的回答](https://stackoverflow.com/questions/3151702/discriminated-union-in-c/5841109#5841109)。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-06-02T05:03:03.000

我认为您想认真地重新考虑您在做什么以及如何做，但是您可以这样做：

```
int i = FunctionReturnsIntOrString<int>();
string j = FunctionReturnsIntOrString<string>(); 
```

通过像这样实现它：

```
private T FunctionReturnsIntOrString<T>()
{
    int val = 1;
    if (typeof(T) == typeof(string) || typeof(T) == typeof(int))
    {
        return (T)(object)val;
    }
    else
    {
        throw new ArgumentException("or some other exception type");
    }
} 
```

但有很多理由不这样做。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-02T04:51:10.940

返回类型不是方法签名的一部分，只有名称和参数类型。正因为如此，您不能有两个仅在返回类型上有所不同的方法。解决此问题的一种方法是让您的方法返回一个对象，然后调用代码必须将其转换为 int 或 string。

但是，最好创建两个不同的方法，或者创建一个类以从可以包含 int 或字符串的方法返回。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-02T04:51:51.597

因为有时它真的不能告诉它应该使用哪一个（你的例子可以，但并非所有情况都那么明确）：

```
void SomeMethod(int x) { ... }
void SomeMethod(string x) { ... } 
```

在这种情况下，如果调用`SomeMethod(FunctionReturnsIntOrString())`编译器应该怎么做？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-02T04:51:35.277

在 C# 中没有覆盖返回类型，IL 支持这种覆盖，但 C# 还没有。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-06-02T05:11:19.060

您也不需要为被调用的方法赋值。例如：

```
int FunctionReturnsIntOrString() {return 0;}
string FunctionReturnsIntOrString() {return "some string";}

//some code
//...

int integer = FunctionReturnsIntOrString(); //It probably could have figured this one out

FunctionReturnsIntOrString(); //this is valid, which method would it call? 
```

# java - 泛型类型存储在 java 类文件中的什么位置？

> ID：937933
> 
> 赞同：17
> 
> 时间：2009-06-02T04:48:20.977
> 
> 标签：java, generics, jvm

我很清楚泛型类型在编译时会从 Java 代码中删除。1.5+ JVM 使用什么信息（属性？）来实现`getGenericType`等？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-06-02T05:16:38.227

它们存储在`Signature`属性中；有关字段类型签名的格式，请参阅[更新的 Java 虚拟机规范](http://java.sun.com/docs/books/jvms/second_edition/jvms-clarify.html)的第 4.8.8节以及第 4.4.4 节。

这是一个使用示例`javap -verbose java.util.Map`：

```
public interface java.util.Map
  SourceFile: "Map.java"
  Signature: length = 0x2
   00 1E 
  [other attributes omitted] 
```

此处的`Signature`属性指定（如果您将其读取为大端，就像 JVM 类文件格式中的所有整数数量一样）常量池值 #30 (30 = 0x1E)。那么让我们看看那里：

```
const #30 = Asciz       <K:Ljava/lang/Object;V:Ljava/lang/Object;>Ljava/lang/Object;; 
```

在 4.4.4 中指定的语法的上下文中阅读此内容。所以，这使用了两个类型参数，`K extends java.lang.Object`和`V extends java.lang.Object`. 类型本身 ( `Map`) 也扩展了类`java.lang.Object`，并且没有接口。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-06-02T05:13:20.477

Java 泛型确实是通过[类型擦除](http://java.sun.com/docs/books/tutorial/java/generics/erasure.html)实现的，所以字节码中没有类型信息。

例如，让我们看一下声明一个`List`字段的两个类，一个是泛型​​的，另一个是非泛型的：

```
class NonGeneric {
    List list;
} 
```

和，

```
class Generic {
    List<String> list;
} 
```

在这两种情况下，生成的字节码如下：

```
 Code:
   Stack=3, Locals=1, Args_size=1
   0:   aload_0
   1:   invokespecial   #1; //Method java/lang/Object."<init>":()V
   4:   aload_0
   5:   new #2; //class java/util/ArrayList
   8:   dup
   9:   invokespecial   #3; //Method java/util/ArrayList."<init>":()V
   12:  putfield    #4; //Field list:Ljava/util/List;
   15:  return 
```

没有引用nor`String`中使用的类型。所以，我们可以看到泛型确实是通过类型擦除来实现的。`ArrayList``List`

但是，如果我们查看常量池，我们会发现不同之处。

非泛型常量池：

```
 Constant pool:
const #1 = Method   #6.#15; //  java/lang/Object."<init>":()V
const #2 = class    #16;    //  java/util/ArrayList
const #3 = Method   #2.#15; //  java/util/ArrayList."<init>":()V
const #4 = Field    #5.#17; //  NonGeneric.list:Ljava/util/List;
const #5 = class    #18;    //  NonGeneric
const #6 = class    #19;    //  java/lang/Object
const #7 = Asciz    list;
const #8 = Asciz    Ljava/util/List;;
const #9 = Asciz    <init>;
const #10 = Asciz   ()V;
// snip the rest // 
```

通用常量池：

```
 Constant pool:
const #1 = Method   #6.#17; //  java/lang/Object."<init>":()V
const #2 = class    #18;    //  java/util/ArrayList
const #3 = Method   #2.#17; //  java/util/ArrayList."<init>":()V
const #4 = Field    #5.#19; //  Generic.list:Ljava/util/List;
const #5 = class    #20;    //  Generic
const #6 = class    #21;    //  java/lang/Object
const #7 = Asciz    list;
const #8 = Asciz    Ljava/util/List;;
const #9 = Asciz    Signature;
const #10 = Asciz   Ljava/util/List<Ljava/lang/String;>;;
const #11 = Asciz   <init>;
const #12 = Asciz   ()V;
// snip the rest// 
```

可以看出，在`Generic`类中，我们可以看到有两个额外的常量，`#9`和`#10`，在常量池中，其中提到了`List`的泛型类型`String`。

（并结合我从[Chris Jester-Young 的回答](https://stackoverflow.com/questions/937933/where-are-generic-types-stored-in-java-class-files/937999#937999)中学到的新知识）

进一步查看类文件的反汇编，在类的前面有一个对常量 #10 的`Code: block`引用`Generic`：

```
java.util.List list;
  Signature: length = 0x2
   00 0A 
```

十六进制值`0A`是`10`十进制，指的是常量池`#10`：

```
const #10 = Asciz   Ljava/util/List<Ljava/lang/String;>;; 
```

因此，使用来自常量池的信息来指示字段是泛型类型。

# c++ - 将 PCRE 正则表达式中的任意数量的单词匹配为字符串

> ID：937948
> 
> 赞同：1
> 
> 时间：2009-06-02T04:54:32.373
> 
> 标签：c++, regex, pcre

我正在使用 PCRE 进行一些正则表达式解析，我需要在字符串中搜索特定模式中的单词（假设一串单词中的所有单词用逗号分隔）并将它们放入字符串向量中。

我该怎么做呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T05:18:37.367

对不起，粗略的代码，但我很着急......

```
 pcre* re;
  const char *error;
  int   erroffset;
  char* subject = txt;
  int   ovector[3];
  int   subject_length = strlen(subject);
  int rc = 0;

  re = pcre_compile(
  "\\w+",              /* the pattern */
  PCRE_CASELESS|PCRE_MULTILINE,                    /* default options */
  &error,               /* for error message */
  &erroffset,           /* for error offset */
  NULL);                /* use default character tables */

  char* pofs = subject;
  while (  rc >= 0  ) {
    rc = pcre_exec(
      re,                   /* the compiled pattern */
      NULL,                 /* no extra data - we didn't study the pattern */
      subject,              /* the subject string */
      subject_length,       /* the length of the subject */
      0,                    /* start at offset 0 in the subject */
      0,                    /* default options */
      ovector,              /* output vector for substring information */
      3);           /* number of elements in the output vector */

    /*
    if (rc < 0) {
      switch(rc) {
        case PCRE_ERROR_NOMATCH: printf("No match\n"); break;

        // Handle other special cases if you like

        default: printf("Matching error %d\n", rc); break;
      }
      pcre_free(re);     // Release memory used for the compiled pattern
      return;
    }
    */

    /* Match succeded */

    if (  rc >= 0  ) {
      pofs += ovector[1];

      char *substring_start = subject + ovector[0];

      // do something with the substring

      int substring_length = ovector[1] - ovector[0];

      subject = pofs;
      subject_length -= ovector[1];
    }
  } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-09T19:59:52.937

```
 std::string wordstring = "w1, w2, w3";
std::string word;
pcrecpp::StringPiece inp_w(wordstring);
pcrecpp::RE w_re("(\\S+),?\\s*");
std::vector outwords;

while (w_re.FindAndConsume(&inp_w, &word)) {
    outwords.push_back(word);
} 
```

# jquery - jQuery：设置div内表格单元格的值

> ID：937950
> 
> 赞同：6
> 
> 时间：2009-06-02T04:55:34.790
> 
> 标签：jquery

我有一个包含标题的浮动 div，我想更改该标题。我试过这个：

```
$("div#dragTitle3").text("New Title"); 
```

但标题实际上是在 div 内的一个表中。这是表格：

```
<table><tbody><tr><td>Announcements</td><td style="text-align:right"><img src="buttontop.png" class="divTitleButton" id="dragButton3" onmousedown="javascript:toggleContentWin(3)"></td></tr></tbody></table> 
```

我想知道在设置新表格时如何在不输入整个表格代码的情况下更改标题。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-06-02T05:09:07.503

这应该有效：

```
$("div#dragTitle3 td:first").text("New title") 
```

# javascript - Javascript/CSS 加载并附加到文档

> ID：937951
> 
> 赞同：1
> 
> 时间：2009-06-02T04:56:19.187
> 
> 标签：javascript, jquery

我写了一个 jQuery 插件，但我希望它检查 jQuery 是否已加载，如果没有则加载它，以及其他几个 javascript 文件，并检查 CSS 文件是否已加载，如果没有则加载它。

想知道该怎么做？

非常感谢您的宝贵时间。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-23T17:16:05.890

## 检测是否加载了 CSS

将此添加到您的 CSS 中：

```
._css_loaded_test {
  display: none;
} 
```

定义这个 JavaScript 函数：

```
function cssIsLoaded() {
  var test = document.createElement("div");
  test.className = "_css_loaded_test";
  return getComputedStyle(test, null).display === "none";
} 
```

## 检测是否加载了 jQuery

使用这个 JavaScript 来检测是否加载了 jQuery：

```
if (typeof jQuery !== "undefined") {
  // put your code here
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-22T09:19:01.493

您的插件，除非它在大小和复杂性上与 jQuery 相当，否则可能不应该加载 jQuery。我认为简单地检查 jQuery 是否存在，如果不存在则发出警告足以让任何开发人员了解正在发生的事情。

我想您可能正在开发一个插件，人们通常会在不“知道”他们是否有 jQuery 的情况下包含该插件。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-06-02T05:07:55.023

以下应该工作。不过，它可能没有完全优化。

```
if (typeof jQuery == "undefined") {
    var js = document.createElement("script");
    js.setAttribute("src",...path to jquery...);
    js.setAttribute("type","text/javascript");
    document.head.appendChild(js);
    //ditto for other files you mentioned 
}

function isCSSLoaded(uri) {
    var links = document.getElementsByTagName("link");
    for (var i =0, len = links.length; i<len;++i) {
        if (links[i].getAttribute("src") === uri) return true;
    }
    return false;
}

if (isCSSLoaded(...pathToYourCSSFile...) {
    var css = document.createElement("link");
    css.setAttribute("href",...path to css file...);
    css.setAttribute("media","screen");
    css.setAttribute("rel","stylesheet");
    css.setAttribute("type","text/css");
    document.head.appendChild(css);
    //ditto for other files you mentioned 
} 
```

编辑：请注意，以上内容仅适用于通过链接加载的 CSS，而不适用于使用 @import 的 CSS

# python - 如何为 Django ForeignKey Model 或 AdminModel 字段指定默认值？

> ID：937954
> 
> 赞同：33
> 
> 时间：2009-06-02T04:56:29.937
> 
> 标签：python, django-models, django-admin

如何在 django 模型或 AdminModel 中的 ForeignKey 字段上设置默认值？

像这样的东西（但当然这不起作用）......

```
created_by = models.ForeignKey(User, default=request.user) 
```

我知道我可以在视图中“欺骗”它，但就 AdminModel 而言，这似乎是不可能的。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2012-11-26T09:46:25.437

```
class Foo(models.Model):
    a = models.CharField(max_length=42)

class Bar(models.Model):
    b = models.CharField(max_length=42)
    a = models.ForeignKey(Foo, default=lambda: Foo.objects.get(id=1) ) 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2016-12-11T18:32:29.063

对于 django 1.7 或更高版本，

只需创建一个 ForeignKey 对象并保存它。“默认”值可以是默认链接的对象的 ID。

例如，

```
created_by = models.ForeignKey(User, default=1) 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2016-03-10T21:41:57.140

这是一个适用于 Django 1.7 的解决方案。与其在字段定义中提供默认值，不如将其设置为可空，但覆盖“保存”函数以在第一次填充它（当它为空时）：

```
class Foo(models.Model):
    a = models.CharField(max_length=42)

class Bar(models.Model):
    b = models.CharField(max_length=42)
    a = models.ForeignKey(Foo, null=True)

    def save(self, *args, **kwargs):
        if self.a is None:  # Set default reference
            self.a = Foo.objects.get(id=1)
        super(Bar, self).save(*args, **kwargs) 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2016-09-24T12:41:06.740

我的做法与@o_c 类似，但我宁愿使用`get_or_create`而不仅仅是 plain `pk`。

```
class UserSettings(models.Model):
    name = models.CharField(max_length=64, unique=True)
    # ... some other fields 

    @staticmethod
    def get_default_user_settings():
        user_settings, created = UserSettings.objects.get_or_create(
            name = 'Default settings'
        )
        return user_settings

class SiteUser(...):
    # ... some other fields

    user_settings = models.ForeignKey(
        to=UserSettings, 
        on_delete=models.SET_NULL, 
        null=True
    )

    def save(self, *args, **kwargs):
        if self.user_settings is None:
            self.user_settings = UserSettings.get_default_params()
        super(SiteUser, self).save(*args, **kwargs) 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-06-02T06:28:02.173

如果你使用的是 Django 的开发版本，你可以实现你的[`formfield_for_foreignkey()`](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#django.contrib.admin.ModelAdmin.formfield_for_foreignkey)方法`AdminModel`来设置一个默认值。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-03-23T04:26:23.920

至于我，对于 Django 1.7 它的工作，只是 pk：

`category = models.ForeignKey(Category, editable=False, default=1)`

但请记住，迁移看起来像

```
migrations.AlterField(
            model_name='item',
            name='category',
            field=models.ForeignKey(default=1, editable=False, to='item.Category'),
            preserve_default=True,
        ), 
```

所以，我不认为它与动态用户 pk 一起工作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-10-25T07:44:36.697

这是对[o_c](https://stackoverflow.com/users/2838311/o-c)答案的轻微修改。它应该可以为您节省一击数据库。请注意，在保存方法中，我使用 self.a_id = 1 而不是 self.a = Foo.objects.get(id=1)。不用查询 Foo 也有同样的效果。

```
class Foo(models.Model):
    a = models.CharField(max_length=42)

class Bar(models.Model):
    b = models.CharField(max_length=42)
    a = models.ForeignKey(Foo, null=True)

    def save(self, *args, **kwargs):
        if self.a is None:  # Set default reference
            self.a_id = 1
        super(Bar, self).save(*args, **kwargs) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-08-28T08:12:38.733

对于 Django >= 1.7，您可以通过两种不同的方式为 ForeignKey 字段设置默认值：

**1) 直接作为整数**

```
DEFAULT_CREATED_BY_USER = 42

class MyModel(Model):
    created_by = models.ForeignKey(User, default=DEFAULT_CREATED_BY_USER) 
```

**2) 作为返回整数的非 lambda 可调用对象**

您还可以使用可解析为完整模块路径的可调用对象。这意味着 lambdas 不起作用。但这将：

```
def default_created_by_user():
    return 42

class MyModel(Model):
    created_by = models.ForeignKey(User, default=default_created_by_user) 
```

参考：

*   [https://docs.djangoproject.com/en/dev/ref/models/fields/#django.db.models.ForeignKey（django](https://docs.djangoproject.com/en/dev/ref/models/fields/#django.db.models.ForeignKey)文档）
*   [https://code.djangoproject.com/ticket/6445](https://code.djangoproject.com/ticket/6445)（为什么 lambdas 失败）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-03-06T03:46:27.103

```
def get_user_default_id():
    return 1

created_by = models.ForeignKey(User, default=get_user_default_id) 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-08-28T19:08:45.473

在寻找更好解决方案的所有迭代中，我发现创建一个小函数将大大解决任务的复杂性。因为一些解决方案在较新的 Django 版本中已过时或不再受支持。

```
def get_request_user():
    # or any complex query result to set default value in ForeignKey
    return request.user.id 
```

然后您可以将上述函数作为参数传递给 ForeignKey。

```
created_by = models.ForeignKey(User, default=get_request_user) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-01-28T08:47:01.543

您应该在 settings.py 文件中有与 setting.AUTH_USER_MODEL 相关的设置。

您可以查看以下文档：

“ [https://docs.djangoproject.com/en/1.10/topics/auth/customizing/#substituting-a-custom-user-model](https://docs.djangoproject.com/en/1.10/topics/auth/customizing/#substituting-a-custom-user-model) ”

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-01-17T12:13:20.460

使用偏函数代替 lambda 函数。Lambda 函数不是序列化，因此会在迁移中出错。

```
class Foo(models.Model):
    a = models.CharField(max_length=42)

class Bar(models.Model):
    b = models.CharField(max_length=42)
    a = models.ForeignKey(Foo, default=partial(Foo.objects.get, id=1 )) 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-01-29T10:26:49.467

您可以覆盖模型管理员的[get_form](https://docs.djangoproject.com/en/2.1/ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_form)方法。

管理员.py

```
class YourModelAdmin(admin.ModelAdmin):
    def get_form(self, request, obj=None, **kwargs):
        form = super(YourModelAdmin, self).get_form(request, obj, **kwargs)
        form.base_fields['created_by'].initial = request.user
    return form

admin.site.register(YourModel, YourModelAdmin) 
```

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2015-09-30T14:09:23.987

```
class table1(models.Model):
    id = models.AutoField(primary_key=True)
    agentname = models.CharField(max_length=20)

class table1(models.Model):
    id = models.AutoField(primary_key=True)
    lastname = models.CharField(max_length=20)
    table1 = models.ForeignKey(Property) 
```

# css - 如何在样式表中定位这些 CSS 项目？

> ID：937956
> 
> 赞同：1
> 
> 时间：2009-06-02T04:59:09.230
> 
> 标签：css

我正在使用 DotNetNuke 菜单 - 这可能无关紧要，因为我的问题主要是关于 CSS 语法。

为如下所示的类构建样式的语法是什么？

```
<tr class="mi mi0-0 id58 first"> 
```

感谢您的帮助，非常感谢！

我正在尝试针对此底部的行。我尝试使用 . 而不是 CSS 中的空格，但由于某种原因，我想要更改的表格行中的文本没有改变？

```
<span id="dnn_dnnNAV_ctldnnNAV" class="main_dnnmenu_bar" tabindex="0" style="-moz-user-select: none;">
<div id="dnn_dnnNAV_ctldnnNAVctr55" class="main_dnnmenu_rootitem mi mi0 id55 root first">
</div>
<table id="dnn_dnnNAV_ctldnnNAVsub55" class="main_dnnmenu_submenu m m0 mid55" cellspacing="0" cellpadding="0" border="0" style="position: absolute; top: 243px; left: 642px; clip: rect(auto, auto, auto, auto); display: none;">
<tbody>
<tr id="dnn_dnnNAV_ctldnnNAVctr58" class="mi mi0-0 id58 first"> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-02T05:02:32.470

全部没有空格：

.mi.mi0-0.id58.first {

}

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-02T05:19:17.957

元素可以有多个类，sweet 给出了定位这个元素的正确方法。
但是，您可以仅使用其类的一个子集来定位它：我会尝试样式化`.mi`or `.mi.first`，如果可能的话忽略这些类`.mi0-0`和`.id58`- 它们看起来是动态的，如果它们发生变化会破坏设计。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-02T05:27:18.183

如果 IIRC，将它们连接在一起在 IE6 中不起作用

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-02T05:30:58.287

首先生成给你的是一些带有***内联*** ***CSS***的 html ，以及一些 CSS 类和 id，我相信你想从 CSS 中定位这些元素，

1.  您可以使用外部 CSS 文件定位它们，但内联样式表将覆盖您在内联中插入的属性。
2.  您也可以在同一个文件中插入 Css。

为了引用 Css 中的元素，您可以使用**类**或**id**

对于您使用的课​​程：

```
#main_dnnmenu_bar
{

    //enter Css properties here
} 
```

对于 id，您可以使用：

```
.dnn_dnnNAV_ctldnnNAV
{

    //enter Css properties here
} 
```

对于使用这个的类： mi mi0-0 id58 首先你可以这样做：

```
.mi{ enter code here  }
.first{ enter code here } 
```

如果您的元素具有这两个包含在它们中的两个类引用的属性，则将应用于它，如果只有一个，则仅应用这些属性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-02T06:23:38.250

有几种方法可以定位该行。

为了确保它不会被否决，您应该尽可能多地包含元素的路径，并确保（可能使用 JS）没有直接应用于元素的样式。

（还要考虑*您的*样式在运行时被 Javascript 删除）

甚至 ie6 也处理后代，所以：

```
span table tr{ /*your styles*/ } will get all tr's in that setup. 
```

所以

```
span#dnn_dnnNAV_ctldnnNAVan table#dnn_dnnNAV_ctldnnNAVsub55 tbody tr.first 
```

或者

```
span#dnn_dnnNAV_ctldnnNAV.main_dnnmenu_bar table#dnn_dnnNAV_ctldnnNAVsub55.main_dnnmenu_submenu.m.m0.mid55 tr#dnn_dnnNAV_ctldnnNAVctr58.mi.mi0-0.id58.first 
```

IE7+ 处理子 '>'，这更具体：

```
span#dnn_dnnNAV_ctldnnNAVan > table#dnn_dnnNAV_ctldnnNAVsub55 > tbody > tr.first 
```

如果需要，您还可以定位除类之外的其他内容：span[tabindex='0'].....

我认为 IE7 也处理第一个孩子：但你应该检查一下。

# iphone - 对尝试使用 UIImage 设置 cell.image 感到困惑：imageNamed：

> ID：937957
> 
> 赞同：1
> 
> 时间：2009-06-02T04:59:36.343
> 
> 标签：iphone, uiimage

我创建了一个包含 NSDictionary 结构的 plist。键是一个标签（我用来填充 tableview cell.text），值是我想用来“动态”填充 cell.image 的文件名。准确的 png 文件名被加载到项目中。

为了让事情变得更容易（我想），我将 plist 加载到一个 NSDictionary 中，然后将它分成两个数组（使用 allKeys 和 allValues）。

在尝试设置单元格图像时，我不明白为什么会这样：

```
cell.image = [UIImage imageNamed:@"bad.png"]; 
```

这不会（在模拟器中 - 我在调试器中遇到应用程序崩溃和呕吐）：

```
cell.image = [UIImage imageNamed:[rowImageList objectAtIndex:indexPath.row]]; 
```

我可以将下一行放在第二段代码之前，它工作得很好，所以看起来我从 objectAtIndex 获得了一个 NSString：

```
NSLog(@"Image name: %@", [rowImageList objectAtIndex:indexPath.row]); 
```

我还尝试创建一个临时 NSString 并将 [rowImageList objectAtIndex:] 分配给它，然后使用该 NSString 来提供 imageNamed:。

以下是来自调试器的一些信息：

> -[NSCFArray 长度]：无法识别的选择器发送到实例 0x262d910
> 
> 由于未捕获的异常“NSInvalidArgumentException”而终止应用程序，原因：“*** -[NSCFArray 长度]：无法识别的选择器发送到实例 0x262d910”

如果您需要更多信息/代码，请告诉我。

编辑：这是我填充rowImageList的方式：

```
NSArray *myRowImages = [[NSArray alloc] init]; 
myRowImages = [searchFilterList allValues]; 
self.rowImageList = [myRowImages copy]; 
[myRowImages release]; 
//where searchFilterList is an NSDictionary that I loaded from a plist 
```

这是我的 plist 的屏幕截图：[IMG][ ![http://i42.tinypic.com/14uwffa.jpg](https://i.stack.imgur.com/XlPcb.jpg)] [1](https://i.stack.imgur.com/XlPcb.jpg) [/IMG]

编辑：修改 rowImageList 人口：

```
 NSMutableArray *myRowImages = [[NSMutableArray alloc] init];
 NSEnumerator *enumerator = [searchFilterList objectEnumerator];
 id object;

 while ((object = [enumerator nextObject])) {
     [myRowImages addObject:[object objectAtIndex:0]];
 }
 self.rowImageList = myRowImages; //edit: added self. prefix
 [myRowImages release]; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T05:05:15.667

我会仔细检查 NSLog() 的输出，并确保它不是包含 NSString 的数组。这就是错误告诉你的；您正在传递一个 NSArray ，其中需要一个 NSString 。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T05:11:49.247

此错误意味着 [rowImageList objectAtIndex:indexPath.row] 正在返回一个数组而不是预期的字符串。

打印一个值的原因是因为要打印一个数组，还需要在 NSLog 语句中指定 %@ 。

尝试调试方法并检查 [rowImageList objectAtIndex:indexPath.row] 的类。它很可能会变成一个数组。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T05:57:11.647

您确定您的 plist 是键/字符串对，并且您没有以某种方式将名称包装在数组中吗？

# sql - 如何有效地查询数据集中的连续日期集？

> ID：937964
> 
> 赞同：5
> 
> 时间：2009-06-02T05:03:42.890
> 
> 标签：sql, oracle

```
site_id | start_date | end_date
      1 | oct  1, 08 | oct  2, 08
      1 | oct  2, 08 | oct  3, 08
 ...
      1 | oct 30, 08 | oct 31, 08
      2 | oct  1, 08 | oct  2, 08
      2 | oct  2, 08 | oct  3, 08
 ...
      2 | oct 30, 08 | oct 31, 08 
```

我有一个表，其中包含每个站点每个月的每一天（一年中的每个月）的 1 条记录。我需要能够确定给定月份的站点是否至少有 15 条连续记录，并且我需要知道这一系列连续日期的开始和结束日期。我可以在存储过程中执行此操作，但我希望这可以在单个查询中完成。我正在处理一个相当大的数据集，每月至少有 3000 万条记录。

示例结果：

```
site_id | contiguous_start_date | contiguous_end_date
      1 | oct 5, 2008           | oct 20, 2008
      2 | oct 10                | oct 30, 2008
      3 | oct 1                 | oct 31, 2008 
```

感谢您的帮助！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-02T13:51:51.810

以下是如何执行此类查询的示例：

```
SQL> create table t (site_id,start_date,end_date)
  2  as
  3  select 1, date '2008-10-01', date '2008-10-02' from dual union all
  4  select 1, date '2008-10-02', date '2008-10-03' from dual union all
  5  select 1, date '2008-10-03', date '2008-10-30' from dual union all
  6  select 1, date '2008-10-30', date '2008-10-31' from dual union all
  7  select 2, date '2008-10-01', date '2008-10-02' from dual union all
  8  select 2, date '2008-10-02', date '2008-10-03' from dual union all
  9  select 2, date '2008-10-03', date '2008-10-04' from dual union all
 10  select 2, date '2008-10-04', date '2008-10-05' from dual union all
 11  select 2, date '2008-10-05', date '2008-10-06' from dual union all
 12  select 2, date '2008-10-06', date '2008-10-07' from dual union all
 13  select 2, date '2008-10-07', date '2008-10-08' from dual union all
 14  select 2, date '2008-10-08', date '2008-10-09' from dual union all
 15  select 2, date '2008-10-09', date '2008-10-10' from dual union all
 16  select 2, date '2008-10-10', date '2008-10-11' from dual union all
 17  select 2, date '2008-10-11', date '2008-10-12' from dual union all
 18  select 2, date '2008-10-12', date '2008-10-13' from dual union all
 19  select 2, date '2008-10-13', date '2008-10-14' from dual union all
 20  select 2, date '2008-10-14', date '2008-10-15' from dual union all
 21  select 2, date '2008-10-15', date '2008-10-16' from dual union all
 22  select 2, date '2008-10-16', date '2008-10-17' from dual union all
 23  select 2, date '2008-10-17', date '2008-10-18' from dual union all
 24  select 2, date '2008-10-18', date '2008-10-19' from dual union all
 25  select 2, date '2008-10-19', date '2008-10-20' from dual union all
 26  select 3, date '2008-10-01', date '2008-10-02' from dual union all
 27  select 3, date '2008-10-02', date '2008-10-03' from dual union all
 28  select 3, date '2008-10-03', date '2008-10-04' from dual union all
 29  select 3, date '2008-10-04', date '2008-10-05' from dual union all
 30  select 3, date '2008-10-05', date '2008-10-06' from dual union all
 31  select 3, date '2008-10-06', date '2008-10-07' from dual union all
 32  select 3, date '2008-10-07', date '2008-10-08' from dual union all
 33  select 3, date '2008-10-08', date '2008-10-09' from dual union all
 34  select 3, date '2008-10-09', date '2008-10-10' from dual union all
 35  select 3, date '2008-10-30', date '2008-10-31' from dual
 36  /

Tabel is aangemaakt. 
```

然后是查询：

```
SQL> select site_id
  2       , min(start_date) contiguous_start_date
  3       , max(end_date) contiguous_end_date
  4       , count(*) number_of_contiguous_records
  5    from ( select site_id
  6                , start_date
  7                , end_date
  8                , max(rn) over (partition by site_id order by start_date) maxrn
  9             from ( select site_id
 10                         , start_date
 11                         , end_date
 12                         , case lag(end_date) over (partition by site_id order by start_date)
 13                             when start_date then null
 14                             else rownum
 15                           end rn
 16                      from t
 17                  )
 18          )
 19   group by site_id
 20       , maxrn
 21   order by site_id
 22       , contiguous_start_date
 23  / 
```

结果：

```
 SITE_ID CONTIGUOUS_START_DA CONTIGUOUS_END_DATE NUMBER_OF_CONTIGUOUS_RECORDS
---------- ------------------- ------------------- ----------------------------
         1 01-10-2008 00:00:00 31-10-2008 00:00:00                            4
         2 01-10-2008 00:00:00 20-10-2008 00:00:00                           19
         3 01-10-2008 00:00:00 10-10-2008 00:00:00                            9
         3 30-10-2008 00:00:00 31-10-2008 00:00:00                            1

4 rijen zijn geselecteerd. 
```

问候，罗布。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T05:15:21.537

这绝对是非常可能的。几个月前，我在 SQL Server 中解决了一个类似的问题。我对 Oracle 语法一无所知，所以恐怕我无法为你转换 if，但如果你对 Oracle 很熟悉，[这](http://thehobt.blogspot.com/2009/04/calculating-elapsed-time-based-upon.html)应该足以让你到达那里。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-06-02T06:38:35.117

您的数据库结构不适合您拥有的业务逻辑：

*   end_date 总是在 start_date 之后的第二天，那么为什么必须将它存储在数据库中？
*   我看到在您提供的数据示例中，单个站点的日期范围内没有空格。这意味着不必存储所有日期时间段，只需开始和停止日期即可。

*每月 3000 万条记录*确实是您必须编写的查询的表。 我的建议是**对这张表进行结构重构。**

# sql - 将评论标志存储在 sql 数据库中的最佳方法？

> ID：937972
> 
> 赞同：1
> 
> 时间：2009-06-02T05:07:47.317
> 
> 标签：sql, database-design

将评论标志存储在 sql 数据库中的最佳方法？评论发布在页面 (mediaId) 上，每条评论都可以有孩子，评论可以由拥有该页面的人或版主隐藏。任何人都可以标记评论，但只能标记一个类别和一次。

一旦评论有 X 数量的标志，它就会引起版主的注意。如果版主觉得没问题，他应该不能清除标记，而是做一些事情，所以需要 X 数量才能引起他的注意。

```
 enum FlagComment { none, offensive, spam, other, };

    command.CommandText =
         "CREATE TABLE if not media_comment( " +
         "id INTEGER PRIMARY KEY, " +
         "mediaId  INTEGER, " +
         "parentId INTEGER, " +
         "author   INTEGER, " +
         "date     DATE, " +
         "text     TEXT, " +
         "hidden   INTEGER);";
    command.ExecuteNonQuery();

    command.CommandText =
         "CREATE TABLE if not media_comment( " +
         "commentId INTEGER, " +
         "userId INTEGER, " +
         "flagType   INTEGER); ";
    command.ExecuteNonQuery();

    command.CommandText =
         "CREATE TABLE if not media_comment_mod_clear( " +
         "commentId INTEGER, " +
         "modId  INTEGER, " +
         "action INTEGER, " + //action is delete or ignore
         "flagAmount INTEGER); "; //amount of ppl who flagged before mod took action
    command.ExecuteNonQuery(); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-02T05:14:11.427

我不确定 flagAmount 是正确的方法。

最好有一个标志表，其中每一行都有一个标志 ID、评论 ID、标志类型等。然后，可以使用 SQL 计算一条评论有多少个标志，但您还需要维护每个标志的信息（例如类型）。

# python - Python Tkinter Tk/Tcl 使用问题

> ID：937979
> 
> 赞同：1
> 
> 时间：2009-06-02T05:10:06.783
> 
> 标签：python, tkinter, tcl, expect

我正在使用 Python Tkinter 模块中的 Tcl，如下所示

```
from Tkinter import *
Tcl = Tcl().eval
Tcl("info patchlevel") 
'8.3.5' 
```

可以看到python选择了Tcl 8.3版本。

但我的系统中也有 tcl8.4。现在，我如何让 python 在 Tkinter 模块中选择 tcl8.4。

Tcl8.3 没有 Expect 包，所以我不能在 Python Tcl/Tk 中使用 Expect 包。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T06:09:35.417

我认为python使用的Tcl/Tk版本是在编译时确定的。因此，您需要查看代码，针对您要使用的 Tcl/Tk 版本重新编译 python。也许重新编译 _tkinter.so 库也足够了，因为它是动态加载的。

# f# - F# 和 ExecuteScalar 强制转换

> ID：937988
> 
> 赞同：0
> 
> 时间：2009-06-02T05:13:28.277
> 
> 标签：f#, executescalar

如何使用 F# 中的 DbCommand.ExecuteScalar？它返回一个我需要转换为 int 的 obj。我对 F# 很陌生，我需要做的演员表还不清楚。

```
let (stockid:uint32) = command.ExecuteScalar()

Compile Error: 
Type constraint mismatch. The type   obj is not compatible with type  uint32 
```

使用 :?> 向上转换会引发运行时错误。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-02T05:27:13.517

如果你只是说

```
let o : obj = ...
printfn "%s" (o.GetType().ToString()) 
```

你得到了什么？它确实是一个int吗？（int32 或 uint32 还是什么？）

:?> 运算符是正确的向下转换运算符，但您需要匹配类型。转换为实际类型后，如果您需要从一种整数类型转换为另一种整数类型，则使用目标类型的相应函数，例如

```
let x : int = int myUnsignedInt  
// first 'int' is type, second is function to convert-to-int 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T05:28:46.667

如果 Downcast (:?>) 在运行时抛出，您不会从 Execute Scalar 获得 unit32 作为返回值。你应该可以转换...

```
let stockid : uint32 = unit32 command.ExecuteStalar() 
```

但是如果你得到的东西不能转换为 uint32，那也会失败。[更多关于铸造和转换在这里](http://msdn.microsoft.com/en-us/library/dd233220(VS.100).aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-02T05:29:36.480

尝试将其转换为 int32 而不是 uint32。ExecuteScalar 返回一个 int32 的对象。

# comet - 我应该选择什么样的客户方式进行 Comet 聊天？

> ID：937994
> 
> 赞同：2
> 
> 时间：2009-06-02T05:14:43.877
> 
> 标签：comet

我要实现一个彗星聊天。很容易为服务器端做出选择，但为客户端做出选择——我真的很困惑：长轮询、回调轮询、隐藏 iframe、http 流、持久 http 连接......

我对概念了解不多，谁能帮我说清楚？我只是想选择最好的方式来实现一个彗星聊天客户端~

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-11-28T23:44:52.507

一旦您选择了服务器端组件，您就会知道要使用哪个客户端组件。

例如，如果您使用[WebSync（用于 ASP.NET/IIS）](http://www.frozenmountain.com/websync)，您将使用 Bayeux 协议的实现作为客户端 - 内置一个或其他可用实现之一（dojo、jquery 等）根据根据您的需求。

如果您使用 StreamHub 之类的东西，他们也会为他们的包提供一个客户端。

您提到的各种项目——长轮询、回调轮询等——将在各种实现中对你隐藏起来。在 WebSync 中，我们支持长轮询和回调轮询，但是在使用客户端时您无需了解任何相关信息，因为它会根据所使用的浏览器来处理这些。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-02T05:28:43.967

我认为长轮询是大多数商业服务似乎使用的技术。这是适用于所有浏览器的唯一选项。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-22T20:59:17.950

我认为该技术并不重要，只要它适用于所有浏览器即可。StreamHub Comet 服务器现在有一个免费的社区版 - 它可以跨浏览器工作，因此您不必担心实现不同的技术，例如长轮询。为什么有人已经为您完成了所有工作...我建议阅读教程：[使用 StreamHub 构建 Comet 聊天应用程序](http://streamhub.blogspot.com/2009/07/tutorial-building-comet-chat.html)。

# asp.net-mvc - 添加对 ASP MVC 页面编译引擎的引用

> ID：937997
> 
> 赞同：1
> 
> 时间：2009-06-02T05:15:13.143
> 
> 标签：asp.net-mvc, plugins

我已经根据这个站点上的建议为 ASP MVC 应用程序编写了一个插件解决方案，但是，我遇到了一个障碍，希望能得到一些帮助。无需深入了解插件系统的工作原理，它确实成功加载了控制器并找到了合适的视图 - 问题是视图无法编译，因为它无法解析所有插件的引用（插件 DLL 引用了其他DLL 是宿主应用程序不知道的）。

我在 CurrentDomain 上使用 AssemblyResolve，但在默认 BuildManager 编译视图时不会调用它，而是从 web.config 部分获取程序集列表。如果我将所有插件文件添加到 GAC 并在该部分添加参考 - 它工作正常。但是，如果我必须为每个插件更改 web.config，这就违背了拥有插件系统的目的。

一个小插图来解释这个问题：Plugin.dll --references--> PluginServices.dll

URL [http://mysite.com/some/index](http://mysite.com/some/index) MVC Application --load--> Plugin.dll PASS

MVC 应用程序 --load--> Plugin.SomeController PASS

MVC 应用程序 --find--> Plugin\Views\Some\Index.aspx PASS

MVC 应用程序 --compile--> Index.aspx FAIL（视图使用了 PluginServices 中无法找到的类型）

有没有办法动态添加对 BuildManager 的引用，以便编译通过而不更改 web.config？

提前致谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-02T05:25:12.083

您需要考虑创建一些可以放入基础应用程序的接口或抽象类（最好是接口），这样当插件不存在时，基础应用程序仍然可以编译。然后，您在插件中编写接口或基类的实现。

[本文](http://www.divil.co.uk/net/articles/plugins/plugins.asp)将帮助您入门。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-02T08:07:00.900

我想你不想让你的宿主项目编译插件 dll。我认为您希望提前构建插件，并可能将视图嵌入到程序集 dll 中 - 这样，您可以创建适当的接口 [Robert Harvey et-al] 并让主机应用程序依赖于动态加载的事实组装的没问题。也许您还需要创建一个插件工具解决方案，在其中您（单元？）在开发/编译时测试插件 - 这似乎是必要的，因为视图中的一些编译错误不会立即出现（[这篇文章](http://webdevdotnet.blogspot.com/2009/02/aspnet-mvc-rc-compiler-post-build-step.html)还应该有助于解决视图中的编译器错误- 它对我有用）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-04T01:23:56.087

吉尔，

看看下面的文章。它解释了如何使用 Reflection 在运行时获取有关您的业务层组件的信息，然后使用 InvokeMember 调用您想要的方法。它不需要任何类型的注册即可工作；您只需要一条通往您的程序集的路径。

C# 反射和动态方法调用
[http://my.execpc.com/~gopalan/dotnet/reflection.html](http://my.execpc.com/~gopalan/dotnet/reflection.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-04T01:44:56.467

同样，直接加载逻辑的部分工作正常并且还可以定位视图，唯一不起作用的部分是我无法控制的部分 - 这是页面的实际呈现。

但是，我确实设法让它工作。我必须做的是以下几点：1）在GAC中注册插件DLL

2) 在“编译”部分下的主机的 web.config 中添加对 DLL 的引用

3) 确保插件中的所有视图不使用“继承”属性来强类型化视图，而是创建一个局部变量并将模型转换为适当的类型。

现在这一切似乎都正常，但我会继续考虑它，看看我是否能想出一个更好的解决方案。

同样，我不确定任何人如何声称他们有一个 MVC 插件系统，并且没有处理一个简单的 view.aspx，它有如下一行： <%= Model.Name %> 其中 Model 是主机执行的对象知道关于。

再次感谢您的所有回答！******`**********