# StackOverflow 问答 000449000-000449999

# asp.net-mvc - 将 Using Blocks 放入存储库有什么问题？

> ID：449002
> 
> 赞同：3
> 
> 时间：2009-01-15T23:43:25.967
> 
> 标签：asp.net-mvc, linq, repository-pattern, datacontext

我在存储库的每种方法中都使用了块。如果我想交叉引用方法，初始化另一个 Datacontext 似乎违反最佳实践我做错了什么？如果我在类中声明一个 Datacontext 而不是在方法中使用块，我不会失去处置的权力吗？

```
public IList<something> GetSomething()
{ 
   using (DB db=new DB())

   { ...GetListofSomethingElse(id)

   } 
}

public IList<somethingelse> GetListofSomethingElse(int id)
{ 
    using (DB db=new DB())
   {
     ... return IList 

   } 
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-17T11:53:58.030

实际上，我认为在您的存储库中创建和处置数据上下文是语义上的（或者我应该怎么说），这是不正确的。

我的意思是：如果您在存储库的每种方法中打开与数据库的新连接，恕我直言，您做错了。这太细了。存储库类不知道使用它的“上下文”。您的存储库不应负责打开/关闭连接或启动和提交事务。上下文为王，存储库不知道使用它的上下文。因此，恕我直言，应用层或服务层有责任打开新的 DataContext 对象，并关闭/处置它们。（同样适用于交易）。

所以，这就是我的做法：（注意我没有使用实体框架，但我使用 NHibernate。我假设 EF 中的 DataContext 类类似于 NHibernate 中的 ISession）：

```
using( ISession s = theSessionFactory.OpenSession() )
{
    ICustomerRepository cr = RepositoryFactory.GetCustomerRepository(s);

    Customer c1 = cr.GetCustomer(1);
    Customer c2 = cr.GetCustomer(2);

    // do some other stuff
    s.StartTransaction();

    cr.Save (c1);
    cr.Save (c2);

    s.Commit();

} 
```

*（这不是真实世界的代码；而且它甚至不会编译，因为 ISession 没有 Commit 方法。；）相反，StartTransaction 返回一个具有某种提交方法的 ITransaction，但我想你会抓住我的漂移。;) )*

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-15T23:50:09.293

using 语句是语法糖。它使用 finally 部分中的 Dispose() 调用编译为 try/finally 块。它确保即使发生异常也会调用 Dispose。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-15T23:53:38.613

如果您不使用 using 语句，您仍然可以显式处理。即使您不处理数据上下文，交叉引用这些方法仍然会创建一个新的数据上下文。这可能是也可能不是一件好事，这取决于您的使用情况。考虑数据上下文的状态管理方面，以及您是否希望将方法彼此隔离。如果您想避免一直创建新上下文，请使用将上下文作为参数的版本重载方法。

请注意，[您通常*不需要*处理数据上下文](https://stackoverflow.com/questions/389822/when-should-i-dispose-of-a-data-context)，尽管我倾向于处理任何实现 IDisposable 的东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-15T23:45:30.283

你可以在一个类上调用 .Dispose() 而不使用“using”语句——通常你会在你的存储库的 Dispose 方法中执行此操作，如果你有的话。

# api - 任何人都可以推荐一个具有良好编程 API 的图片库吗？

> ID：449007
> 
> 赞同：0
> 
> 时间：2009-01-15T23:46:18.990
> 
> 标签：api, image, web, gallery

什么是最好的解决方案/API？在我的网站上，用户上传图片，然后标记等等。我希望它转到下一个/上一个图像，而不是显示显示图像和信息（日期、描述、用户评论等）的普通页面。最好带预加载。此代码可以在 Flash 或 javascript 中完成，但我需要一种方法为用户提供链接，以便他们可以将其传递给其他人以在同一点继续。

我想支持的另一件事是“画廊”模式，它显示多个图像的缩略图并允许滚动浏览它们。

是否有我应该使用的 API，或者我应该手动滚动画廊和幻灯片代码？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T01:07:50.150

Flickr 似乎有一个[全面的 API](http://www.flickr.com/services/api/)。（但我没有这方面的经验。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-12T06:06:06.873

画廊-gallery.menalto.com 怎么样？版本 3 才刚刚发布，但版本 2.3 非常稳定并且具有广泛的 API。

做你想做的事看看

[http://gallery.menalto.com/apidoc/ItemAdd/UserInterface/ItemAddFromServer.html](http://gallery.menalto.com/apidoc/ItemAdd/UserInterface/ItemAddFromServer.html)

用于从服务器保存图像，并在

[http://gallery.menalto.com/node/66940](http://gallery.menalto.com/node/66940)

[http://codex.gallery2.org/Gallery2:GalleryEmbed:getImageBlock](http://codex.gallery2.org/Gallery2:GalleryEmbed:getImageBlock)

再次将其提取出来（尽管使用“getBlock”而不是“getImageBlock”）

# computer-science - 评估语言的“图灵完整性”的实用指南是什么？

> ID：449014
> 
> 赞同：48
> 
> 时间：2009-01-15T23:48:34.333
> 
> 标签：computer-science, language-design, turing-complete

我已经阅读[了“什么是图灵完备”](https://stackoverflow.com/questions/7284/what-is-turing-complete)和维基百科页面，但我对正式证明的兴趣不如对图灵完备的实际意义感兴趣。

我实际上想要决定的是我刚刚设计的玩具语言是否可以用作通用语言。我知道如果我可以用它编写图灵机，我可以证明它是。但在我相当确定成功之前，我不想进行那个练习。

是否有最小的功能集，没有图灵完备性是不可能的？是否有一组功能几乎可以保证完整性？

*（我的猜测是条件分支和可读/可写的内存存储将使我大部分时间到达那里）*

* * *

编辑：

我想我已经说“图灵完成”了。我试图以合理的信心猜测具有特定功能集的新发明语言（或者具有特定指令集的 VM）将能够计算任何值得计算的东西。我知道证明你可以用它构建图灵机是一种方法，但不是唯一的方法。

我希望的是一套指导方针，例如：“如果它可以做 X、Y 和 Z，它*可能*可以做任何事情”。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-01-16T01:13:25.787

您需要某种形式的动态分配构造（`malloc`或`new`或`cons`将做）以及递归函数或其他一些编写无限循环的方式。如果您拥有这些并且可以做任何有趣的事情，那么您几乎可以肯定是图灵完备的。

lambda 演算在功能上等同于图灵机，如果您实现 lambda 演算，编写 lambda 演算程序实际上非常有趣。 *比为图灵*机编写程序更有趣！

我知道的图灵完备性的唯一实际含义是您可以编写不会终止的程序。我使用了几种保证终止的专用语言，因此*不是*图灵完备的。有时放弃额外的表达能力以换取有保证的终止是有用的。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-01-16T01:08:10.993

[“图灵完备性”](http://en.wikipedia.org/wiki/Turing_complete)描述了能够表达任意[算法计算的属性，](http://en.wikipedia.org/wiki/Algorithm)这首先是[图灵机](http://en.wikipedia.org/wiki/Turing_machine)的重点。如果语言或逻辑系统具有此属性，则可以将其描述为“图灵完备”。从实用的角度来看，所有通用编程语言 - 以及数量惊人的专用编程语言 - 都可以为适当松散的定义做到这一点（见下文）。

然而，图灵完备性的严格定义意味着无限的存储容量，这在物理上当然是不可能的。鉴于此，没有物理机器可能是图灵完备的，但是当将图灵完备归因于编程语言时，这种约束通常会被放松（至少是非正式的）。一种语言的图灵完备性的一个简单测试是该语言是否可用于实现图灵机模拟器。

不是图灵完备的广泛系统的一个例子是关系代数，它是 Codd 的论文[大型共享数据库的关系模型中描述的 SQL 背后的理论基础。](http://www.eecs.harvard.edu/~margo/codd-1970.pdf) 关系代数具有[哥德尔完备](http://en.wikipedia.org/wiki/G%C3%B6del%27s_completeness_theorem)性的性质，这意味着它可以表达任何可以用[一阶谓词演算](http://en.wikipedia.org/wiki/First-order_logic)（即普通逻辑表达式）定义的计算。但是，它不是图灵完备的，因为它不能表达任意算法计算。

请注意，如果不是所有实用 SQL 方言，大多数（如果不是全部）实用 SQL 方言都使用过程构造扩展了纯关系模型，以至于它们按照通常应用于编程语言的定义是图灵完备的。但是，单个 SQL 查询大体上不是。

图灵完备领域特定语言的一些更令人震惊的例子是[TeX](http://www.ctan.org)和[sendmail.cf](http://www.sendmail.org/m4/readme.html)，. 在后一种情况下，实际上有一个著名的例子，有人使用 sendmail.cf 来[实现通用图灵机模拟器。](http://okmij.org/ftp/Computation/sendmail-as-turing-machine.txt)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-19T13:55:56.983

如果你可以用你的语言编写一个[Brainf$](http://en.wikipedia.org/wiki/Brainfuck) 解释器，它就是图灵完备的。 [LOLCODE](http://en.wikipedia.org/wiki/LOLCODE)正是以这种方式被证明是图灵完备的。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-01-16T18:53:17.577

不是图灵完备的语言的例子经常有有*界循环*，比如：

```
for i=1 to N {...}
```

但缺少检查更一般条件的*无界*循环，例如：

```
while *bool_expr* {...}
```

如果所有可能的循环结构都是有界的，那么您的程序肯定会终止。而且，尽管无条件终止保证可能有用，但这也表明该语言不是图灵完备的。

还要注意，确定*所有可能的*循环结构可能很困难。例如，我很确定 C++ 模板不是图灵完备的……

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-01-15T23:54:50.360

我不确定是否存在“最小功能集”，但要证明一种语言是图灵完备的，你只需要证明它可以模拟另一个图灵完备的系统（不一定是图灵机），只要其他系统已知是图灵完备的。[http://en.wikipedia.org/wiki/Turing_complete#Examples](http://en.wikipedia.org/wiki/Turing_complete#Examples)有一个完整的图灵完备系统列表。其中一些比图灵机更简单。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-16T18:19:09.237

我想对 Norman Ramsey 所说的添加一个警告：图灵机具有无限的内存，因此被认为是图灵完备的编程语言只是在内存也是无限的假设下如此。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-05-02T12:34:40.523

Brainfuck 是图灵完备的，只有循环结构和内存增量/减量，所以这就足够了。

另一方面，无法修改 lambda 演算中的任何值，但它是图灵完备的，因此显然可以在没有可变内存的情况下进行修改。

不过，您的程序很可能与 lambda 演算无关，因此对于实际答案，最小值必须是

1.  一种写入变量的方法
2.  一种读取变量的方法
3.  一种条件 goto 形式（if 语句、while 循环等）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-16T01:25:16.107

我不记得看到图灵完整性的*最低功能*。但是，如果您的语言支持循环和条件分支，那么它是图灵完备的可能性很大。但是，证明它的唯一方法仍然是模拟图灵机或另一种图灵完备语言。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-16T01:16:02.503

如果您可以实现图灵机（只要可以实现，因为它们是具有无限内存的数学结构[磁带大小是无限的]），那么您可以确定它是图灵完备的。

一些迹象：

*   您可以检查内存并根据当前值对其进行操作，也可以使用它来控制程序流程。
*   该内存可以分配内存，可以附加的字符串，可以通过递归等方式分配内存的堆栈。
*   程序流可以通过迭代或通过基于选择的递归。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-04-04T15:51:36.950

任何能够不终止的语言几乎都是图灵完备的。您可以通过为语言提供无界循环结构（如 While 循环或可以再次到达自身的 Goto）或通过为其提供一般递归（通过让函数不受限制地调用自身）来使语言无法终止。

一旦你*完成*了图灵完备，你就可以做一些事情，比如解释其他图灵完备语言，包括你自己的。

真正的问题是“它有什么好处？” 如果您的语言将用于特定领域来解决特定问题，那么最好找到一种方法来用不是图灵完备的语言来表达解决方案，从而保证给出答案。

您始终可以通过在任何其他图灵完备语言（其中 X 由非图灵完备语言提供）中编写“做这个、那个或任何事情；但用 X 提供的结果来做”来添加图灵完备性。

当然，如果你只想使用一种语言，最好是图灵完备......

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-04-24T22:01:48.337

您可以尝试模拟[OISC](http://en.wikipedia.org/wiki/One_instruction_set_computer)（一台指令集计算机）。如果您可以模拟其中的一条指令，那么由于这些单条指令可用于组成图灵完备机器，那么您已经证明您的语言也必须是图灵完备的。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-12-18T04:43:53.730

> 是否有最小的功能集，没有图灵完备性是不可能的？是否有一组功能几乎可以保证完整性？

是的，您需要有以数据为条件的控制流：通常表示为`if`. 例如，`+-*/`袖珍计算器不是图灵完备的，因为没有办法表达条件。

您还需要能够在程序中表达返回到较早点的跳转，在此之上您可以实现一个循环。例如，禁止向后跳转以保证程序将终止的 BPF 也不是图灵完备的。

您需要一些可读写且任意大的存储空间。例如，只有两个 32 位变量的语言的计算能力受到限制。对于存储的结构，您有很多选择：由指针、数组、堆栈、cons 单元、纯数据结构等寻址的内存。

在这些之上，您可以构建所有其他编程语言：它可能并不容易或快速，但已经足够了。

* * *

## 回答 #13

> 赞同：-5
> 
> 时间：2009-01-16T00:05:06.330

> ...而不是图灵完备的实际意义。

我怀疑图灵完备是否有任何实际意义。

如果您查看图灵完备机的一些示例，例如原始[图灵机](http://en.wikipedia.org/wiki/Turing_machine)，您会发现它们远不能用于实际计算，因此该概念必须仅具有理论意义。

# excel - 来自 ALBPM 的 COM 集成 - 找不到“{00020906-0000-0000-C000-000000000046}”的 IDispatch

> ID：449016
> 
> 赞同：0
> 
> 时间：2009-01-15T23:49:21.230
> 
> 标签：excel, com, ms-word, ms-office, albpm

我正在尝试使用 Office COM 组件来创建 Word 和 Excel 文档。不幸的是，我无法做到这一点，因为我遇到了一个错误。

> 在模块“{00020905-0000-0000-C000-000000000046}”中找不到“{00020906-0000-0000-C000-000000000046}”的 IDispatch，v8.3

我尝试重新安装 Office、我的应用程序 (ALBPM) 和我的界面 (combsvc)，但它无法正常工作。

我想知道如何安装 IDispatch，或者如何知道它是否安装在正确的模块中。有时错误会说：

> 找不到“{000209FF-0000-0000-C000-000000000046}”的 IDispatch ... 而不是 00020906-0000-0000-C000-000000000046

我正在使用生成这些错误的代码是：

```
wordAppl.visible = false
wordDocs = wordAppl.documents

contratoTemplate = "C:\\albpmFiles\\mandatory\\aTemplate.doc"
// .doc template
convenioTemplate = "C:\\albpmFiles\\mandatory\\ConvenioModificatorio.doc"
// .doc template
saveContrato = "C:\\albpmFiles\\temp\\"
// where to save.
saveConvenio = "C:\\albpmFiles\\temp\\"

contratoName = "NewContact.doc"
wordDoc = open(wordDocs, fileName : contratoTemplate)
bookmark = item(wordDoc.bookmarks, index : "atrDescripcion")

insertAfter bookmark.range
using text = instSolicitud.atrDescripcion
bookmark = item(wordDoc.bookmarks, index : "atrObjProveedor_atrNombre")
insertAfter bookmark.range
using text = instSolicitud.atrObjProveedor.atrNombre
bookmark = item(wordDoc.bookmarks, index : "atrObjProveedor_atrDireccion")
insertAfter bookmark.range
using text = instSolicitud.atrObjProveedor.atrDireccion
filename = saveContrato + contratoName

end

// Extras - Fin
saveAs wordDoc
using fileName = filename 
```

非常感谢您提供有关 IDispatch 或这些注册表项的任何信息，即使您可以告诉我在哪里可以找到有关此的更多信息。

非常感谢。丹尼尔。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T00:04:38.063

From the error you get I assume that you are using Word 2003\.

Have you made sure that the COM brigde service is correctly installed and running?

```
combsvc -install
combsvc -start 
```

will register combsvc as service and then start it.

Please also have a look at the example for Word at the bottom of page 150 in the [ALBPM Reference Guide](http://e-docs.bea.com/albsi/docs60/pdf/ALBPM60_Studio_ReferenceGuide.pdf).

The fact that it is sometimes working and sometimes could be an issue with ALBPM. Are you using the latest version and updates?

Another option - and quite frequent problem with Word automation - would be that the automated instance of Word is displaying a modal dialog box and is waiting for user interaction. You can switch of the display of modal dialogs by setting

```
Application.DisplayAlerts = 0 
```

However, this will unfortunately not prevent all popups from being displayed.

Is there actually an instance of Word started? If so, can you make the Window visible and see if documents can be opened or if there is a popup blocking the application?

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T00:36:06.813

丹尼尔，

我在这里在黑暗中刺伤。看起来您正在使用 BEA 系统 Aqualogic BPM，我感觉它是一个基于 Java 的工具。从挖掘来看，commsvc 实际上是一个 COM 桥接服务，允许 ALBPM 从 Java 与 COM 对话：

[http://edocs.bea.com/albsi/docs60/studio/index.html?t=studio/catalog/catalog_component/COM/c_COM_Bridge.html](http://edocs.bea.com/albsi/docs60/studio/index.html?t=studio/catalog/catalog_component/COM/c_COM_Bridge.html)

我想这是你的失败点。

关于您在 IDispatch 上的问题，您实际上并没有安装 IDispatch。IDispatch 是 COM 用来向后期绑定的 COM 自动化客户端（例如脚本语言（例如 ASP 或 VBScript））公开对象、方法和属性的接口。它是 COM 基础设施的一部分，如果它被破坏，你会看到你的机器出现更多问题。

我可能会建议在这里提出一个问题：

[http://forums.oracle.com/forums/forum.jspa?forumID=560](http://forums.oracle.com/forums/forum.jspa?forumID=560)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T00:27:20.030

要检查 PC 上安装的 COM 接口，我建议您下载 oleview.exe，它是[Windows 2003 资源工具包的一部分](http://www.microsoft.com/downloads/details.aspx?familyid=9d467a69-57ff-4ae7-96ee-b18c4790cffd&displaylang=en)

我实际上有 {00020906-0000-0000-C000-000000000046} 但也没有 IDispatch 接口，并且在尝试创建它的实例时出现“类未注册”错误。我的家用 PC 没有安装 Office，只安装了 Office 工具，这很可能是原因。

过去，在自动化 Office 应用程序时，我总是能够与版本无关的 ProgID 进行对话，例如“Excel.Application”。你确定你引用了正确的 COM 对象吗？在 oleview 中查看或给我们一些更多的代码来咀嚼:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T00:37:19.290

我正在使用的代码是这样的，但我什至看不到第一个日志，所以我认为连接有错误，而不是代码

```
wordAppl.visible = false
wordDocs = wordAppl.documents

contratoTemplate = "C:\\albpmFiles\\mandatory\\aTemplate.doc"

// .doc template
convenioTemplate = "C:\\albpmFiles\\mandatory\\ConvenioModificatorio.doc"

// .doc template
saveContrato = "C:\\albpmFiles\\temp\\"

// where to save.
saveConvenio = "C:\\albpmFiles\\temp\\"

contratoName = "NewContact.doc"

wordDoc = open(wordDocs, fileName : contratoTemplate)

bookmark = item(wordDoc.bookmarks, index : "atrDescripcion")

insertAfter bookmark.range
using text = instSolicitud.atrDescripcion

bookmark = item(wordDoc.bookmarks, index : "atrObjProveedor_atrNombre")

insertAfter bookmark.range
using text = instSolicitud.atrObjProveedor.atrNombre

bookmark = item(wordDoc.bookmarks, index : "atrObjProveedor_atrDireccion")

insertAfter bookmark.range
using text = instSolicitud.atrObjProveedor.atrDireccion

filename = saveContrato + contratoName

end

// Extras - Fin
saveAs wordDoc
using fileName = filename 
```

# c - 文件问题

> ID：449019
> 
> 赞同：1
> 
> 时间：2009-01-15T23:50:00.120
> 
> 标签：c, file, stdout, stdio

我收到以下代码的以下错误，“1506-221 (S) Initializer must be a valid constant expression”

```
FILE          *fp[] = {stdout, dump_f}; 
```

这是可以接受的吗？实现这一目标的正确方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T23:53:35.807

该错误表明在您的系统上，该`stdout`变量实际上是一个`#defined`扩展为函数调用的宏。

实际上，正如其他人所建议的那样，它可能只是`stdout`一个外部声明的变量，其值在编译时未知，因此不能在静态初始化程序中提供。

无论如何，解决方案应该是相同的 - 我会尝试类似的东西：

```
FILE *fp[2];

void init_fp()
{
    fp[0] = stdout;
    fp[1] = dump_f;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T23:56:01.637

如果那是全局的，那么 C 不支持使用函数调用对其进行初始化。如果`stdout`是函数调用的宏（如最初建议的那样），那么您将无法使用它来初始化全局。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T00:21:46.810

很可能，`stdout`和/或是`dump_f`宏或（更可能是问题）外部全局变量。

如果我有这个代码：

```
// external.c
int hello = 1234;

// external.h
extern int hello;

// main.c
#include "external.h"

int world = hello; // error! 
```

您将在指示的行收到错误，因为 的值`hello`未知。

`stdout`并且`dump_f`很可能被声明为`extern`全局变量，如下所示：

```
extern FILE *stdout, *stdin, *stderr, *dump_f; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-16T01:02:51.597

经典地，大多数 Unix 系统曾经定义`stdout`为类似的东西`(&_iob[1])`，它被简化为一个有效的常量表达式；例如，Solaris 仍然如此。

几年前，现在，GNU C 库将其定义更改为`stdout`非常量，因此用于将`FILE *`变量初始化为任何标准文件指针的旧代码停止编译。这是C标准认可的，所以抱怨没有任何美德。您只需要接受您无法初始化指向标准 I/O 通道之一的静态文件指针并重新编码以解决该问题。（但这仍然*是*一个麻烦。）

# xml - 列表应该如何用 XML 表示？

> ID：449020
> 
> 赞同：8
> 
> 时间：2009-01-15T23:50:03.847
> 
> 标签：xml, list

在 XML 中，列表应该如何表示？

使用封闭列表实体：

```
<person>
    <firstname>Joe</firstname>
    <lastname>Bloggs</lastname>

    <children>
        <child .../>
        <child .../>
        <child .../>
        <child .../>
        <child .../>
    </children>
</person> 
```

或没有：

```
<person>
    <firstname>Joe</firstname>
    <lastname>Bloggs</lastname>

    <child .../>
    <child .../>
    <child .../>
    <child .../>
    <child .../>
</person> 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-15T23:57:29.777

为了可扩展性，我将使用第一个解决方案（带有*子*节点的解决方案）。如果您希望存储有关所有孩子的任何数据，那么您有一个方便的节点来放置属性。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-15T23:52:16.997

我会将它封装在一个实体中以将其与其他元素区分开来。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-15T23:59:04.500

如果列表中元素的名称始终相同，这并没有太大的区别，因为如果您使用 XPath 或 Linq-to-XML 或其他任何方式处理它，那么查询将只有一个选择器如果有一个包装节点，否则将是相同的。

另一方面，如果列表中的元素名称可能不同，那么如果有包装元素，则可以更轻松地处理列表，因为您可以只使用“*”作为列表元素下方的选择器，而不必过滤所有元素到具有指定名称集的元素。

所以这可能并不重要，但我更喜欢有一个包装元素，因为它在视觉上将集合中的项目与不存在的项目区分开来。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-15T23:59:43.377

在您想针对它编写的代码中考虑它。：

对我来说...

```
spouse.children = person.children... 
```

在语义上比...好得多

```
for child in person:
    spouse.addChild(person.child) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-15T23:56:03.413

第一个对于简单列表非常有效，但是如果列表本身包含嵌套列表怎么办？！如果一个元素有几个不同的列表怎么办？为了保持一致，我更喜欢列表的元素，并`<item>`为子数据使用标签或其他东西。这将有助于使用通用函数来解析所有列表。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-16T14:46:21.913

**如果我们需要一个列表的*通用*XML 表示，我们将得出结论，必须使用以下一种表示**：

```
<_listSomeName>
  <_listItem>...</_listItem>
  <_listItem>...</_listItem>
  <_listItem>...</_listItem>
  <_listItem>...</_listItem>
  <_listItem>...</_listItem>
</_listSomeName> 
```

**让我们分析一下**：

1.  需要 wrapper 元素是因为我们可能有两个或多个列表作为元素的**`<_listSomeName>`**子元素，并且必须能够唯一且方便地标识每个列表。“SomeName”部分用于使列表的名称唯一。

2.  The **`<_listItem>`** element is needed to wrap each individual list item. It cannot be omitted because a list item can have a complex structure (such as being an xml fragment itself) and it would be challenging to identify it as one whole.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-15T15:02:18.400

I would use the first solution. The list has semantic relevance: it's the collection of like elements, and therefore should be identifiable as such. In the second solution the list doesn't exist as an element.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-15T23:55:53.853

恕我直言，这取决于域。

对于您给出的示例，我会使用实体来包围孩子，因为孩子本身不一定是人的属性，但孩子的列表是。

此外，如果您需要序列化/反序列化，使用附件将有所帮助。

# data-binding - 为什么我在打印到 XpsDocument 时丢失了数据绑定？

> ID：449036
> 
> 赞同：8
> 
> 时间：2009-01-15T23:54:10.453
> 
> 标签：data-binding, xps, fixedpage, fixeddocument, fixeddocumentsequence

**更新！**

装订工作。问题是 XpsDocumentWriter 没有正确写入 FixedDocumentSequence 的第一个文档的第一页。这似乎是很多人在做这种事情时遇到的问题（即全球有五个开发人员）。解决方案有点奇怪。我把它作为一个答案。

* * *

好的，它比问题所暗示的要微妙一些。

我有一系列 FixedPages，每个都有其 DataContext 单独设置。每个 FixedPage 还具有一个或多个绑定到上下文的控件。

如果我将这些 FixedPages 添加到单个 FixedDocument 并将此单个 FixedDocument 写入 XpsDocument，我的绑定将被取消引用（可以这么说）并且正确的值会显示在 XpsDocument 中。

如果我将这些 FixedPages 添加到各个 FixedDocuments（每个 FP 被添加到一个新的 FD），然后这些 FixedDocuments 被添加到一个 FixedDocumentSequence，然后这个序列被写入 XpsDocument，我的绑定不会被取消引用并且我的 FixedPages 显示为空白.

调试告诉我我没有丢失我的绑定或我的绑定上下文，所以这不是这个失败的原因。

下面是一些示例代码来说明发生了什么：

```
// This works
FixedPage fp = CreateFixedPageWithBinding();
fp.DataContext = CreateDataContext();
// Add my databound fixed page to a new fixed document
var fd = new FixedDocument();
var pc = new PageContent();
((IAddChild)pc).AddChild(fp);
fd.Pages.Add(pageContent);
// Create an xps document and write my fixed document to it
var p = Package.Open("c:\\output.xps", FileMode.CreateNew);
var doc = new XpsDocument(p);
var writer = XpsDocument.CreateXpsDocumentWriter(doc);
wri2.Write(fd);
p.Flush();
p.Close();

// This does NOT work
FixedPage fp = CreateFixedPageWithBinding();
fp.DataContext = CreateDataContext();
// Add my databound fixed page to a new fixed document
var fd = new FixedDocument();
var pc = new PageContent();
((IAddChild)pc).AddChild(fp);
fd.Pages.Add(pageContent);
// Create a fixed document sequence and add the fixed document to it
FixedDocumentSequence fds = CreateFixedDocumentSequence();
var dr = new DocumentReference();
dr.BeginInit();
dr.SetDocument(fd);
dr.EndInit();
(fds as IAddChild).AddChild(dr);
// Create an xps document and write the fixed document sequence to it
var p = Package.Open("c:\\output.xps", FileMode.CreateNew);
var doc = new XpsDocument(p);
var writer = XpsDocument.CreateXpsDocumentWriter(doc);
wri2.Write(fds);
p.Flush();
p.Close(); 
```

您可以看到两者之间的唯一区别是我将固定文档添加到固定文档序列中，然后将其写入。

显然，当我的固定文档未写入 Xps 文档时，不会发生任何导致评估数据绑定和插入绑定值的魔法。我需要能够编写多个固定文档，并且 Write 方法只能调用一次，因此需要我将 FixedDocuments 添加到我然后编写的 FixedDocumentSequence 中。但我*也*需要我该死的数据绑定才能工作！

在这种情况下的任何帮助将不胜感激。我知道它不完全是框架中最常见的部分。我只是希望这里有人对此有一些操作经验（我在看着你，潜伏着 MS 员工）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-16T16:51:34.220

这个错误的原因是 FixedPage 的布局在写入之前没有被更新。这会导致 FixedDocumentSequence 中第一个 FixedDocument 中的第一个 FixedPage 写入不正确。这会影响结果**文档中的任何其他页面**，这使得这个错误/边缘案例更难确定。

以下 WORKS（非工作示例的重写版本）：

```
FixedPage fp = CreateFixedPageWithBinding();
fp.DataContext = CreateDataContext();
var fd = new FixedDocument();

/* PAY ATTENTION HERE */
// set the page size on our fixed document 
fd.DocumentPaginator.PageSize =
   new System.Windows.Size()
   {
       Width = DotsPerInch * PageWidth,
       Height = DotsPerInch * PageHeight
   };
// Update the layout of our FixedPage
var size = fd.DocumentPaginator.PageSize;
page.Measure(size);
page.Arrange(new Rect(new Point(), size));
page.UpdateLayout();    
/* STOP PAYING ATTENTION HERE */

var pc = new PageContent();
((IAddChild)pc).AddChild(fp);
fd.Pages.Add(pageContent);
// Create a fixed document sequence and add the fixed document to it
FixedDocumentSequence fds = CreateFixedDocumentSequence();
var dr = new DocumentReference();
dr.BeginInit();
dr.SetDocument(fd);
dr.EndInit();
(fds as IAddChild).AddChild(dr);
// Create an xps document and write the fixed document sequence to it
var p = Package.Open("c:\\output.xps", FileMode.CreateNew);
var doc = new XpsDocument(p);
var writer = XpsDocument.CreateXpsDocumentWriter(doc);
wri2.Write(fds);
p.Flush();
p.Close(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2017-11-28T22:48:58.050

我在尝试使用`XpsDocumentWriter`写入`PrintQueue`. 以下代码正确打印第一页。

```
//Prints correctly
FixedDocumentSequence Documents = new FixedDocumentSequence();

//some code to add DocumentReferences to FixedDocumentSequence

PrintDialog printDialog = new PrintDialog
{
    PrintQueue = LocalPrintServer.GetDefaultPrintQueue() 
};
printDialog.PrintTicket = printDialog.PrintQueue.DefaultPrintTicket;
if (printDialog.ShowDialog() == true)
{
    Documents.PrintTicket = printDialog.PrintTicket;

    XpsDocumentWriter writer = PrintQueue.CreateXpsDocumentWriter(printDialog.PrintQueue);
    writer.Write(Documents, printDialog.PrintTicket);
    printerName = printDialog.PrintQueue.FullName;
} 
```

如果您删除`printDialog.ShowDialog()`并尝试静默打印到默认打印机，则第一页打印不正确。但是，在我的场景中，我不需要使用 a `FixedDocumentSequence`，所以我将它换成了一个单一的`FixedDocument`静默打印工作。`FixedPage`我尝试在没有成功的情况下更新布局。奇怪的是，如果我显示打印对话框，第一页的打印效果如何。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T03:05:42.207

丢失绑定的一个原因是您在某处抛出了异常 - 不幸的是，此异常被默默吞下，您的绑定只是“停止工作”。打开 First-chance exceptions，看看是否有什么被击中。

# python - 在 Windows/Apache 上设置 Python？

> ID：449055
> 
> 赞同：8
> 
> 时间：2009-01-16T00:02:42.513
> 
> 标签：python, wamp, mod-python

我想获得一个简单的 Python “hello world”网页脚本以在 Windows Vista/Apache 上运行但遇到不同的问题。我正在使用 WAMP。我已经安装`mod_python`并且模块显示了，但是我不太确定我应该在例如 http.conf 中做什么（像 AddHandler mod_python .py 这样的东西要么把我带到一个找不到的文件，要么被禁止，要么模块访问[http://localhost/myfolder/index.py](http://localhost/myfolder/index.py)时未发现错误）。我可以开始`mod_python.publisher`工作，但我“想要”这个/需要这个吗？

任何人都可以帮忙吗？

谢谢！

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-16T11:08:32.760

远离`mod_python`。一个常见的误导性想法是，`mod_python`就像`mod_php`, 但对于 python。那不是真的。[Wsgi](http://wsgi.org)是运行 Python Web 应用程序的标准，由[PEP 333](http://www.python.org/dev/peps/pep-0333/)定义。所以[`mod_wsgi`](http://code.google.com/p/modwsgi/)改用。

或者，使用一些具有服务器的 Web 框架。[Cherrypy](http://www.cherrypy.org/)的特别好。您将能够独立运行您的应用程序，也可以通过`mod_wsgi`.

使用cherrypy的Hello World应用程序示例：

```
import cherrypy

class HelloWorld(object):
    def index(self):
        return "Hello World!"
    index.exposed = True

application = HelloWorld()
if __name__ == '__main__':
    cherrypy.engine.start()
    cherrypy.engine.block() 
```

很容易吧？直接在 python 上运行这个应用程序将启动一个网络服务器。对其进行配置`mod_wsgi`将使其在 apache 中运行。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T00:38:14.157

你不需要 mod_python 在网络上运行 Python 代码，你可以使用简单的 CGI 编程来运行你的 python 代码，使用以下链接中的说明：[http ://www.imladris.com/Scripts/PythonForWindows.html](http://www.imladris.com/Scripts/PythonForWindows.html)

这应该会为您提供一些使用 CGI 启用 Python 所需的配置选项，并且谷歌搜索应该会为您提供有关如何在其中编程等的大量其他信息。

如果您想要一个更“友好”的界面，或者对请求本身进行更多控制，Mod_python 很有用。您可以使用它为 Apache 服务器创建请求过滤器和其他内容，并且使用发布者处理程序，您可以获得通过 python 处理网页请求的更简单方法。

发布者处理程序通过将 URL 映射到 Python 对象/函数来工作。这意味着您可以在 python 文件中定义一个名为 'foo' 的函数，并且对[http://localhost/foo](http://localhost/foo)的任何请求都会自动调用该函数。更多信息在这里：[http ://www.modpython.org/live/current/doc-html/hand-pub-alg-trav.html](http://www.modpython.org/live/current/doc-html/hand-pub-alg-trav.html)

至于使事情正常运行的 Apache 配置，这样的东西应该可以很好地为您服务

```
<Directory /var/www/html/python/>
  SetHandler mod_python
  PythonHandler mod_python.publisher
  PythonDebug On
</Directory> 
```

如果您将 /var/www/html/ 设置为 Web 服务器的根目录并在其中的 python/ 目录中有一个名为 index.py 的文件，那么对[http://localhost/python/foo](http://localhost/python/foo)的任何请求都应该调用 foo () 函数在 index.py 中，如果不存在则失败并返回 404。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T01:11:41.297

> AddHandler mod_python .py

你设置了'PythonHandler'吗？

这些天来，考虑使用 WSGI 代替原生 mod-python 接口以获得更广泛的部署选项。通过 mod-python 的 WSGI 支持，或者更好的是 mod-wsgi。（通过例如 wsgiref 的 CGI 也可以正常工作，并且很容易在您不关心其垃圾性能的开发环境中设置。）

# iphone - MIDI player/synthesizer library for the iPhone

> ID：449057
> 
> 赞同：4
> 
> 时间：2009-01-16T00:03:27.847
> 
> 标签：iphone, audio, midi, synthesizer

Does anyone know if there is a free/cheap MIDI player/synthesizer library that I can incorporate into my iPhone application?

As I understand it the iPhone doesn't have native support for MIDI playback.

To work around this limitation I've created a bank of .caf sound samples that I playback myself but I'd really like to improve the implementation and use MIDI if possible.

Any advice would be greatly appreciated.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-12-31T18:42:08.537

自 2011 年 10 月 10 日，也就是 iOS5 以来，Apple 开始提供基本的 MIDI 文件播放 API。该 API 与 MusicSequence 一起被称为 MusicPlayer 看看这个：

[https://developer.apple.com/library/ios/#documentation/AudioToolbox/Reference/MusicPlayerServices_Reference/Reference/reference.html#//apple_ref/doc/uid/TP40009301-CH1-SW1](https://developer.apple.com/library/ios/#documentation/AudioToolbox/Reference/MusicPlayerServices_Reference/Reference/reference.html#//apple_ref/doc/uid/TP40009301-CH1-SW1)

通过设置适当的音频单元处理图，您可以输出您喜欢的声音。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-18T13:36:40.610

看看[TiMidity++](http://timidity.sourceforge.net/#info)；它看起来应该可以移植到 iPhone 平台上。

> *TiMidity++ 是一个软件合成器。它可以通过将MIDI文件转换为PCM波形数据来播放它们；给它一个 MIDI 数据和数字乐器数据文件，然后实时合成它们并播放。它不仅可以播放声音，还可以将生成的波形以各种音频文件格式保存到硬盘中。TiMidity++ 是一个免费软件，根据 GNU 通用公共许可条款分发。*
> 
> *很多人已经将 TiMidity++ 移植到各种平台上；众所周知，FreeBSD、NetBSD、许多 Linux 发行版、Windows（和/或 Cygwin 环境）和 Mac OS 都有自己的版本。*

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-12-03T23:00:25.213

这是我在 Android 中用于 MIDI 合成的库： [https ://code.google.com/p/android-midi-lib/](https://code.google.com/p/android-midi-lib/)

虽然它不能用于 iOS，但我认为您（以及任何感兴趣的人）仍然可以查看 MIDI 文件格式的实现（即如何将字节写入 .mid 文件）并可能实现一个 MIDI 库你自己。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-08T22:06:32.847

Crimson Technology 提供了一个商业图书馆

[深红技术库](http://www.crimsontech.jp/eng/press/softsynth_iphone.html)

我从来没有使用过它，所以我不能保证它的质量。

# javascript - 使用 Javascript 或 CSS 从 Internet Explorer 打印时隐藏页眉和页脚

> ID：449064
> 
> 赞同：14
> 
> 时间：2009-01-16T00:06:08.950
> 
> 标签：javascript, css, internet-explorer, printing

当我从 Internet Explorer 打印网页时，它会自动添加页眉和页脚，包括网站标题、URL、日期和页码。

是否可以使用 Javascript 或 CSS 以编程方式隐藏页眉和页脚？

要求：

*   在 IE 6 中工作（对于 Intranet，不需要其他浏览器支持）
*   可以使用 ActiveX、Java Applet、Javascript、CSS
*   最好不是用户需要安装的东西（例如[http://www.meadroid.com/scriptx](http://www.meadroid.com/scriptx)）。随意列出其他第三方可用插件，但我认为这可能是唯一的选择
*   不需要用户手动更新他们的浏览器设置
*   不要将页面呈现为 PDF 或 Word 文档或任何其他格式
*   不要写入注册表（安全性阻止了这一点）

谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-16T00:10:39.360

在您的打印选项中，您可以禁用它。以编程方式执行此操作的唯一方法是使用写入注册表的 activeX 控件或用 VB 编写的脚本块。打印选项的设置存储在注册表中。用户必须允许您的脚本访问大多数人因为安全原因而不会访问的注册表。

如果要控制页面内容，可以使用 css 打印样式表。

编辑：有 3rd 方活动 x 控件可以以编程方式为您打印，但再一次，用户必须选择下载并安装它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-05-05T22:31:11.700

我认为你不能用javascript控制它。在我看来，只有在 IE 中使用 ActiveX 的选项。我仍在寻找答案。

祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-22T07:51:22.750

我做了一些谷歌搜索，每个人都说：“不能删除它们！” 除了使用 ActiveX 和 3rd 方插件。

我想知道为什么某些报告控件（Telerik Reporting、DevX、...）可以在不使用 ActiveX 或插件的情况下隐藏页眉和页脚！他们是否以其他方式打印页面？有什么办法？

* * *

## 回答 #4

> 赞同：-6
> 
> 时间：2009-01-16T14:57:14.900

您可以使用打印样式表在打印页面时更改页面的布局。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Untitled Document</title>
        <style type="text/css" media="screen">
            #screen {}
            #print {
                display: none;
            }
        </style>
        <style type="text/css" media="print">
            #screen {
                display: none;
            }
            #print {}           
        </style>
    </head>
    <body>

        <div id="screen">You'll see me in your browser!</div>
        <div id="print">But you will only see me when you print!</div>

    </body>
</html> 
```

# html - HTML 源代码中没有嵌套链接元素的嵌套超链接区域

> ID：449089
> 
> 赞同：15
> 
> 时间：2009-01-16T00:24:42.267
> 
> 标签：html, css

我想在更大的矩形（整页宽）内有一些看起来和行为像超链接的东西，这也是超链接。下面是它应该是什么样子的 ASCII 艺术表示：

```
|--------------------------------------------|
| 一些文字 [_link_] |
|--------------------------------------------|

```

整个外部矩形（块元素）是超链接。在这个矩形内应该有一些文本，在这个文本的末尾应该有另一个链接。

不幸的是，嵌套链接（A 元素）在 (X)HTML 中是非法的：

> **12.2.2 嵌套链接是非法的**
> 
> A 元素定义的链接和锚点不得嵌套；A 元素不得包含任何其他 A 元素。

（来自[http://www.w3.org/TR/html401/struct/links.html#h-12.2.2](http://www.w3.org/TR/html401/struct/links.html#h-12.2.2)），所以上面最自然的实现方式

```
<a href="xxx" style="display: block">
  Some text
  <a href="yyy">link</a>
</a> 
```

不是有效的 HTML。更糟糕的是，某些 Web 浏览器在某些情况下通过将内部链接元素移动到外部链接元素的关闭元素之外来*强制执行此要求。*这当然完全破坏了布局。

所以我想问的是如何使用 HTML 和 CSS（但没有 JavaScript）来实现上面呈现的**布局**，但在 HTML 源代码中**没有嵌套的链接元素。**如果行为尽可能接近具有嵌套链接元素的行为（对于在实现 HTML 标准方面不太严格的浏览器），那就太好了。

* * *

*编辑 (16-01-2009)*

**澄清：**使用两个以上链接元素的解决方案是完全可以接受的

```
<a href="xxx" ...>Some text</a>
<a href="yyy" ...>Link</a>
<a href="xxx" ...>& nbsp;</a>
... 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T00:40:42.997

你可以尝试这样的事情：

```
div.a {
  position: relative;
  background-color: #F88;
  z-index: 0;
}
a.b {
  position: relative;
  z-index: 2;
}
a.b:hover {
  background-color: #8F8;
}
a.c {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
}
a.c:hover {
  background-color: #88F;
}
a.c span {
  display: none;
}
```

```
<div class="a">
  foo
  <a href="bar" class="b">bar</a>
  <a href="foo" class="c"><span>baz</span></a>
</div>
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T00:32:07.773

也许这会奏效？

```
div.parentBox {
  position:relative;
  height:100px;
}
  a.someLink {
    position:absolute;
    top:0;
    left:0;
    height:100px;
  }

// Now just position the two spans

<div class="parentBox">
  <span class="someText">Some Text</span>
  <a href="#" class="someLink">
    <span class="linkText">Link Text</span>
  </a>
</div> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T00:27:07.160

我过去所做的是使用 Javascript 将适当的功能附加到 div（假设它是父元素），以便在单击它时运行 window.location 并打开子链接的 .href 属性。

可能是这样的。

```
// jQuery Code
$(".parentDivLink").click(function(){
  window.location = $(this).find("a.mainLink").attr("href");
});

<div class="parentDivLink">
  <a href="http://www.google.com" title="Google" class="mainLink">Click Me</a>
</div> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T00:34:18.563

只需将 onclick 事件处理程序放在外部元素上，单击时调用“window.location ='yourURLhere';”

您可以添加一个样式属性 - “cursor:pointer”以在鼠标悬停时获取手形光标。

您还可以有一个 CSS 悬停代码块来获取颜色变化。

编辑：刚刚意识到没有javascript，所以在这种情况下，保留'a'标签并简单地在css中为它定义一个样式，这样你就可以给它高度、宽度等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T15:14:30.670

具有负边距的浮点数也应该起作用。

测试（仅在 IE6 中）：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head><title>Link within link</title>
<style type="text/css">
.Parent {
width: 500px;
background-color: yellow;
}
.sub {
float: left;
margin-left: -300px;
}
.foo {
display:block;
float: left;
text-decoration: none;
}
</style>
</head>
<body>
<a href="foo" Class="foo"><div class="Parent">foo </div></a>
<div class="sub"><a href="bar">Link text</a></div>
</body>
</html> 
```

您确实意识到了用户混淆的巨大潜力。

# c# - 从 try catch finally 块中返回是不好的做法吗？

> ID：449099
> 
> 赞同：140
> 
> 时间：2009-01-16T00:31:20.427
> 
> 标签：c#, try-catch, try-catch-finally

所以今天早上我遇到了一些看起来像这样的代码：

```
try
{
    x = SomeThingDangerous();
    return x;
}
catch (Exception ex)
{
    throw new DangerousException(ex);
}
finally
{
    CleanUpDangerousStuff();
} 
```

现在这段代码编译得很好并且可以正常工作，但是从 try 块中返回感觉不正确，特别是如果有关联的 finally。

我的主要问题是如果 finally 抛出它自己的异常会发生什么？您有一个返回的变量，但也有一个要处理的异常......所以我很想知道其他人对从 try 块中返回的看法？

* * *

## 回答 #1

> 赞同：179
> 
> 时间：2009-01-16T00:38:42.847

不，这不是一个坏习惯。放在`return`有意义的地方可以提高可读性和可维护性，并使您的代码更易于理解。你不应该关心如果遇到语句，`finally`块将被执行。`return`

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-01-16T00:34:34.990

finally 无论如何都会被执行，所以没关系。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-01-16T04:14:28.417

就个人而言，我会避免这种编码，因为我不想在 finally 语句之前看到 return 语句。

我的头脑很简单，它处理事情的方式相当线性。因此，当我通过代码进行空运行时，我会倾向于认为一旦我可以到达 return 语句，接下来的一切都无关紧要，这在这种情况下显然是非常错误的（不是它会影响 return 语句，而是副作用可能是什么）。

因此，我会安排代码，使 return 语句始终出现在 finally 语句之后。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-01-16T00:33:27.520

这可能会回答你的问题

[在 try { return x; 中真正发生了什么？} 最后 { x = null; } 陈述？](https://stackoverflow.com/questions/421797/what-really-happens-in-a-try-return-x-finally-x-null-statement)

通过阅读该问题，如果您认为它可能会引发异常，听起来您可以在 finally 语句中使用另一个 try catch 结构。编译器将确定何时返回该值。

也就是说，无论如何重组代码可能会更好，这样以后就不会混淆您或其他可能不知道这一点的人。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-01-16T08:37:48.963

功能上没有区别。

然而，不这样做是有原因的。具有多个出口点的较长方法通常更难以阅读和分析。但这种反对更多地与 return 语句有关，而不是 catch 和 finally 块。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-16T01:08:07.373

在您的示例中，任何一种方式都是等效的，如果编译器生成相同的代码，我什至不会感到惊讶。如果在 finally 块中发生异常，无论将 return 语句放在块中还是在块之外，都会遇到相同的问题。

真正的问题是风格上哪个是最好的。我喜欢把我的方法写成只有一个return语句，这样更容易看到方法的流出，所以我也喜欢把return语句放在最后，这样很容易看出它是方法的结尾以及它返回的内容。

我认为由于 return 语句与最后一个语句一样整齐地放置，其他人不太可能来将多个 return 语句分散到方法的其他部分。

# java - 对泛型类的非泛型引用导致非泛型返回类型

> ID：449103
> 
> 赞同：8
> 
> 时间：2009-01-16T00:33:28.957
> 
> 标签：java, generics

我有一个遗留类，该类本身不是泛型，但其方法之一返回类型使用泛型：

```
public class Thing {
    public Collection<String> getStuff() { ... }
} 
```

`getStuff()`使用泛型返回字符串集合。因此我可以迭代`getStuff()`并且不需要将元素转换为 a `String`：

```
Thing t = new Thing();
for (String s: t.getStuff())  // valid
{ ... } 
```

但是，如果我将`Thing`自己更改为通用但保持其他所有内容相同：

```
public class Thing<T> {
    public Collection<String> getStuff() { ... }
} 
```

然后继续使用对 的非泛型引用`Thing`，`getStuff()`不再返回`Collection<String>`而是返回一个非类型化的`Collection`. 因此客户端代码无法编译：

```
Thing t = new Thing();
for (String s: t.getStuff())  // compiler complains that Object can't be cast to String
{ ... } 
```

为什么是这样？有哪些解决方法？

我的猜测是，通过使用对泛型类的非泛型引用，Java 会关闭整个类的所有泛型。这很痛苦，因为现在我通过将 Thing 设为通用来破坏我的客户端代码。

**编辑：**我正在为上面示例代码中未列出的另一种方法制作 Thing 通用。我的问题是关于为什么上述不能完成的教育问题。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-16T00:37:13.970

好吧，拿两个，我误解了你的问题。

当您 delcare `Thing`（这称为**原始类型**）而不是`Thing<?>`（**参数化类型**）时，Java 编译器会删除所有泛型参数，即使（如您的情况）该方法的泛型类型与泛型类型无关班级。

来自（优秀的）[Java 泛型常见问题解答](http://www.angelikalanger.com/GenericsFAQ/JavaGenericsFAQ.html)：

[我可以像使用任何其他类型一样使用原始类型吗？](http://www.angelikalanger.com/GenericsFAQ/FAQSections/ParameterizedTypes.html#Can%20I%20use%20a%20raw%20type%20like%20any%20other%20type?)

> 原始类型的方法或构造函数具有它们在类型擦除后将具有的签名。

这个看似无害且不引人注目的句子描述了所讨论的行为。您将`Thing`其用作原始类型，因此返回类型为`Collection`(not `Collection<String>`)，因为这是类型擦除后的类型。

使困惑？不奇怪。只要看看那个常见问题的大小。地球上大概有三个人了解 Java 泛型的全部含义。想想我最喜欢的 JDK 声明：

```
Enum<T extends Enum<T>> 
```

（FAQ 中也有对此的解释）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T01:11:37.803

由于擦除而失败。[您可以在这些Java 教程](http://java.sun.com/docs/books/tutorial/java/generics/erasure.html)中阅读有关它的更多信息

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-04T19:34:42.280

我认为这是完全正常的。在我看来，使用 Thing t = new Thing(); 对于泛型启用类是完全错误的。当编译器看到一个泛型类用作没有类型参数的类时，它认为它必须从该类中删除所有泛型类型。这就是如何在新的 Java 编译器中编译旧代码而不使用泛型的方法，并且编译器让旧代码使用启用泛型的类（例如 java.util.ArrayList）没有任何问题。（这就是 java 不需要像 C# 那样分离 System.Collection.Generic.List 和 System.Collection.List 的方式）。您可以在`Thing t = new Thing();`其上添加一个简单的类型参数来运行， `Thing<Object> t = new Thing<Object>();`Java 编译器只需要确保您有意识地使用 Java 泛型。我永远不能责怪 Java 的向后兼容性。

我知道我来晚了 :D

# crystal-reports - 为什么 Crystal Server 不选取用户的（新）活动目录组？

> ID：449118
> 
> 赞同：4
> 
> 时间：2009-01-16T00:37:25.390
> 
> 标签：crystal-reports, active-directory

我们正在运行 Crystal Reports Server 11.5。我们已经为 AD 身份验证设置了它，并且我在 CMC 的身份验证下映射了正确的组。

我们遇到的问题是，当用户被添加到 AD 中的组时，Crystal Server 不会接受此更改。

真正奇怪的是，如果你去 CMC 并查看组的成员，那么新添加的用户会显示在列表中（从组的角度来看他们在组中），但是当你去用户组时，组他们也被添加没有列出（从用户的角度来看，他们不在组中）。

用户在登录时没有获得应有的权限。

我找到了一种解决方法，当重新启动中央管理服务器 Windows 服务 Crystal 似乎与 AD 进行重新同步时。

任何人都可以对此有所了解吗？这是一个已知的问题？

# c# - 从 .NET SqlCommand 调用时，SQL Server 批量插入失败

> ID：449119
> 
> 赞同：3
> 
> 时间：2009-01-16T00:37:54.877
> 
> 标签：c#, sql, sql-server, insert, bulk

我有一个在 SQL Server 2005 数据库上进行批量插入的存储过程。当我从一些 SQL 调用这个存储过程（传入本地格式文件和数据文件的名称）时，它工作正常。每次。

但是，当使用 C# .NET 3.5 代码调用相同的存储过程时，`SqlCommand.ExecuteNonQuery`它会间歇性地工作。

当它失败时，`SqlException`会生成一个说明：

> 无法批量加载。格式文件“c:\bulkinsert\MyFile.fmt”中的列号无效

我认为此错误消息不正确。

有没有人在从代码中调用批量插入时遇到过类似的问题？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T07:30:46.180

你怎么做批量插入？通常，问题（在这种情况下）是“c:\”是服务器的“c:\”还是客户端的“c:\”。

然而。从 C# 代码中，最简单的方法是使用[`SqlBulkCopy`](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlbulkcopy.aspx). 此类提供从托管代码对批量插入功能的直接访问，包括映射（尽管我从不打扰它们）。

如果文件类似于 csv / tsv / 类似文件，则强烈推荐使用[CsvReader 。](http://www.codeproject.com/KB/database/CsvReader.aspx)这提供了最有效使用的`IDataReader`接口。[`WriteToServer`](http://msdn.microsoft.com/en-us/library/434atets.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-19T02:49:32.180

I think the problem was todo with the format file. I am no longer using the format file and it seems to work 100% of the time now. I specify field and row terminators in the SQL instead.

```
Declare @Sql Nvarchar(2000); 

SET @Sql = 
'Bulk Insert TestOutputPretest
From  ''c:\rawdata\bulkinsert\Segment1839204.dat''
 WITH 
      (
         FIELDTERMINATOR ='','',
         ROWTERMINATOR = ''\n''
      )'

Exec sp_ExecuteSql @Sql; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-18T17:42:40.467

利用

`Exec sp_ExecuteSql @Sql;`（100% 工作）

`exec(@sql)`不是很强大，因为它有一些限制

# c# - 是否可以将 ID 映射到 NHibernate 中的未知类型？

> ID：449125
> 
> 赞同：1
> 
> 时间：2009-01-16T00:40:16.710
> 
> 标签：c#, asp.net, nhibernate

我当前的项目连接到两个独立的数据库，除了主键外，其他方面几乎相同。使用 NHibernate 是否可以将 ID 映射到某种泛型类型？

我主要关心的是把 ID 映射到 Int64 或 Guid。

重新编译项目以进行切换不是问题，我知道映射文件需要知道正确的类型，我只是想尝试避免每个表都有两个单独的类。

谢谢，

保罗

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T18:25:28.570

如果有人感兴趣，我已经通过对所有 ID 使用对象类型来解决（破解）这个问题。NHibernate 实际上不允许您从 Int64 或 Guid 映射到对象，因此我通过不在映射文件中引用它（不使用 Id 标签上的 name 属性）来解决这个问题。然后在 DAO 中，我只需调用 session.GetIdentifier(...) 并设置它。这有点像 hack，但由于 NHibernate 使用对象来引用 Id，我很乐意与之共处。

如果有人有的话，我仍然对更漂亮的解决方案感兴趣。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T02:49:37.237

也许编写一个自定义类型来解析字符串来确定类型？它仍然不会直接是 Int64 和 Guid，但无论如何你都可以让它更正式。然后添加一些您可以调用的属性`if (theobject.Id.IsInt) { /* do stuff with */ theObject.Id.GetInt(); }`

（自定义类型在 Hibernate 文档中得到了很好的解释。）

# c# - C# AppSettingsReader：将值“重新读取” 到 AppSettingsReader（运行时）？

> ID：449131
> 
> 赞同：0
> 
> 时间：2009-01-16T00:47:12.687
> 
> 标签：c#, configuration, app-config

在我的应用程序中，我需要在运行时更改 app.config 的 appSetting 中的一些值（“环境”）。

我使用 AppSettingsReader

```
 private static AppSettingsReader _settingReader;

    public static AppSettingsReader SettingReader
    {
        get 
        {
            if (_settingReader == null)
            {
                _settingReader = new AppSettingsReader();
            }
            return _settingReader; 
        }
    } 
```

然后在某个阶段我这样做

```
 config.AppSettings.Settings[AppSettingString.Environment.ToString()].Value = newEnvironment.ToString();
        config.Save(ConfigurationSaveMode.Modified);
        ConfigurationManager.RefreshSection("appSettings"); 
```

但是，下次我尝试像这样阅读“环境”

```
 string environment = (string)SettingReader.GetValue(AppSettingString.Environment.ToString(), typeof(System.String)); 
```

我最终得到了环境的旧值。

我注意到我可以通过这样做来解决这个问题

```
_settingReader = new AppSettingsReader(); 
```

在我阅读“环境”之前。

但我认为创建一个新实例不是正确的方法。

也许有一种方法可以让我的 SettingReader 知道值已更改为使用它的相同实例，但具有刷新的值？

（显然不是一个破坏项目的问题，更像是一个教育问题）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T06:14:27.317

AppSettingsReader 似乎没有任何从磁盘重新加载的方法。它只是派生自对象。创建一个新实例似乎是唯一可行的方法......我可能错了，但 AppSettings 应该是您的应用程序的只读值。更像是应用程序的配置参数，可以在启动前进行调整。

对于读写应用程序设置，我认为具有 IDE 支持的设置机制（[System.Configuration.ApplicationSettingsBase](http://msdn.microsoft.com/en-us/library/system.configuration.applicationsettingsbase.aspx)）将是首选方法。这有 Save 和[Reload](http://msdn.microsoft.com/en-us/library/system.configuration.applicationsettingsbase.reload.aspx)方法。Designer-gen 类也使代码更具可读性。
*在解决方案资源管理器中双击项目下的属性节点。找到设置选项卡。*

代替

```
sEnvironment = (string)SettingReader.GetValue(AppSettingString.Environment.ToString(), typeof(System.String)); 
```

您可以键入属性，例如

```
sEnvironment = Properties.Settings.Default.Environment; 
```

设计器生成的类通过 Default 属性公开了一个同步的单例实例。这应该意味着您不需要重新加载。您将始终获得应用程序中的最新值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T01:43:16.303

```
System.Configuration.ApplicationSettingsBase.Reload 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T14:34:40.233

升级是您正在寻找的功能

```
System.Configuration.ApplicationSettingsBase.Upgrade 
```

# .net - 向控制器传递 FormCollection 和 IList

> ID：449138
> 
> 赞同：1
> 
> 时间：2009-01-16T00:51:53.660
> 
> 标签：.net, asp.net-mvc, asp.net-mvc-2

我有一个包含一大堆数据输入字段的表单，这些字段将由用户完成，包括一些元素，用户可以在这些元素中指示他们将输入多少相同的项目。这与 Phil Haack 的博客条目[Model Binding To A List](http://haacked.com/archive/2008/10/23/model-binding-to-a-list.aspx)中使用的一样。

我成功地使用 JQuery 来创建额外的表单元素、正确索引等。我的问题是在我的控制器中实际读取这些元素的最佳方式。文章中的 Controller 只需要一个对象，`IList<Product>`而我的 Controller 已经需要一个对象，`FormCollection form`现在我也尝试发送它`IList<Itmes>`。

我应该将其添加到控制器预期的参数中还是通过 form["items"] 或其他方式访问？

**看法**

```
<form action="/MyItems/Add" method="post">
   <input type="text" name="Title" value="" />

   <input type="hidden" name="myItem.Index" value="0" />
   <input id="item[0].Amount" name="item[0].Amount" type="text" value="" />
   <input id="item[0].Name" name="item[0].Name" type="text" value="" />

   <input type="hidden" name="myItem.Index" value="1" />
   <input id="item[1].Amount" name="item[1].Amount" type="text" value="" />
   <input id="item[1].Name" name="item[1].Name" type="text" value="" />
</form> 
```

**控制器**

```
public ActionResult Add(FormCollection form)
{
    string Title = form["Title"];
    List<Item> Items = form["items"].ToList();
} 
```

**DTO**

```
public class Item()
{
    int Amount {get; set; };
    string Name {get; set; };
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T01:25:56.337

您可以像这样添加 myItem 作为参数：

```
public ActionResult Add(FormCollection form, List<Item> myItem)
{
} 
```

然后它将自动从表单数据绑定并填充 myItem 参数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T04:15:18.447

我决定只使用`FormCollection`而不是混淆水域，其中一些数据通过使用传递`FormCollection`，其他数据由框架映射到列表。以下代码手动获取项目并水合 DTO。这很好用，并且允许我在我的代码中做一些其他无法直接映射到列表的事情。

```
List<Item> itemList = new List<Item>();
int i = 0;

while ( form["item[" + i + "].Amount"] != null)
{
    itemList.Add(new Item()
        {
            Amount = Convert.ToInt32(form[String.Format("item[{0}].Amount",i )]),
            Name = form[String.Format("item[{0}].Name",i )]
        });
} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-16T11:47:28.530

我还没有尝试过，所以你必须试一试，但为什么不使用 UpdateModel 或 TryUpdateModel 方法呢？这应该以与将 IList 传递给控制器​​的操作相同的方式进行绑定。

那是：

```
public ActionResult Add(FormCollection form)
{
    List<Item> items = new List<Item>();
    TryUpdateModel(items, form);
} 
```

我不在我的开发计算机上，所以我不确定它是否会工作，但我希望它会。让我知道它是否是您需要的。

编辑：值得注意的是，如果您使用的是实体框架，我在 UpdateModel 方法中遇到了许多问题，因此不得不自己编写。

# sql - 在 SQL 脚本中引用生成的主键

> ID：449140
> 
> 赞同：0
> 
> 时间：2009-01-16T00:53:21.583
> 
> 标签：sql, sql-server, primary-key

我正在尝试使用单个脚本在数据库中创建一堆条目，我遇到的问题是如何引用我创建的上一个条目的生成主键。

例如，如果我创建了一个客户，然后尝试为该客户创建一个订单，我如何获取为该客户生成的主键？

我正在使用 SQLServer。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T00:57:02.230

像这样：

```
DECLARE @customerid int;
INSERT INTO customers(name) VALUES('Spencer');
SET @customerid = @@IDENTITY; 
```

**编辑：**

显然，它需要 SCOPE_IDENTITY() 才能按预期使用触发器。

```
DECLARE @customerid int;
INSERT INTO customers(name) VALUES('Spencer');
SET @customerid = SCOPE_IDENTITY(); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T01:03:42.263

如果在您的版本中可用，请改用 SCOPE_IDENTITY()。比@@IDENTITY 更安全。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T01:40:09.633

如果您一次插入多行，您可以使用`OUTPUT INTO` [SQL Server 2005 或更高版本的功能](http://www.sqlteam.com/article/using-the-output-clause-to-capture-identity-values-on-multi-row-inserts)获取所有标识（例如，用于创建相关记录） 。

这可以避免你必须编写循环和游标等。

# c# - 这是工作流式系统的良好设计吗？

> ID：449142
> 
> 赞同：5
> 
> 时间：2009-01-16T00:54:25.263
> 
> 标签：c#, workflow

我正在设计一个系统，该系统允许我将广泛的任务表示为工作流，通过 IEnumerable 方法公开它们的工作项。此处的目的是使用 C# 的“yield”机制来允许我编写工作流执行系统可以按照它认为合适的方式执行的伪过程代码。

例如，假设我有一个工作流程，其中包括在数据库上运行查询并在查询返回特定结果时发送电子邮件警报。这可能是工作流程：

```
public override IEnumerable<WorkItem> Workflow() {
    // These would probably be injected from elsewhere
    var db = new DB();
    var emailServer = new EmailServer();

    // other workitems here

    var ci = new FindLowInventoryItems(db);
    yield return ci;

    if (ci.LowInventoryItems.Any()) {
        var email = new SendEmailToWarehouse("Inventory is low.", ci.LowInventoryItems);
        yield return email;
    }

    // other workitems here
} 
```

CheckInventory 和 EmailWarehouse 是派生自 WorkItem 的对象，它具有子类实现的抽象 Execute() 方法，封装了这些操作的行为。Execute() 方法在工作流框架中被调用 - 我有一个 WorkflowRunner 类，它枚举 Workflow()，围绕工作项包装前后事件，并在事件之间调用 Execute。这允许消费应用程序在工作项之前或之后执行它需要的任何操作，包括取消、更改工作项属性等。

我认为，这一切的好处是，我可以用负责完成工作的工作项来表达任务的核心逻辑，而且我可以用一种相当直接、几乎程序化的方式来完成它。另外，因为我使用的是 IEnumerable，以及支持它的 C# 语法糖，所以我可以组合这些工作流——比如使用和操作子工作流的更高级别的工作流。例如，我编写了一个简单的工作流程，它只是将两个子工作流程交错在一起。

我的问题是——这种架构看起来合理吗，尤其是从可维护性的角度来看？它似乎实现了我的几个目标 - 自我记录代码（工作流程按程序读取，所以我知道将在哪些步骤中执行什么），关注点分离（查找低库存项目不依赖于向仓库发送电子邮件），等等 - 这种架构是否存在我没​​有看到的任何潜在问题？最后，这之前有没有尝试过——我只是重新发现了这个吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T01:08:34.533

就我个人而言，这对我来说是一个“先买后建”的决定。我会先买东西再写。

我在一家相当大的公司工作，可能会因为钱而愚蠢，所以如果你是为自己写这篇文章并且买不到东西，我会收回评论。

以下是一些随机的想法：

我会将工作流程外部化为我可以在启动时读取的配置，可能来自文件或数据库。

它看起来像一个具有状态、转换、事件和动作的有限状态机。

我希望能够插入不同的操作，以便可以即时自定义不同的流程。

我希望能够注册希望在特定事件发生时得到通知的不同订阅者。

我不希望看到像电子邮件服务器那样硬编码的东西。我宁愿将它封装到一个可以插入到需要它的事件中的 EmailNotifier 中。蜂鸣器通知呢？还是手机？黑莓？相同的架构，不同的通知器。

你想包含一个处理程序来进行人机交互吗？我处理的所有工作流程都是人工和自动化处理的混合体。

您是否希望连接到其他系统，例如数据库、其他应用程序、Web 服务？

这是一个棘手的问题。祝你好运。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T05:10:36.820

@Erik：（针对我的答案的适用性发表评论。）如果您喜欢设计和构建自己的自定义工作流系统的技术挑战，那么我的回答没有帮助。但是，如果您尝试使用未来需要支持的代码来解决现实世界的 WF 问题，那么我建议使用内置的 WF 系统。

**工作流**支持现在是 .Net 框架的一部分，称为*“工作流基础 (WF)* ”。几乎可以肯定，学习如何使用内置库比编写自己的库更容易，正如 duffymo 在他的“构建前购买”评论中指出的那样。

工作流以 XAML 表示，并由 Visual Studio 中的设计器支持。工作流分为三种类型（来自维基百科，链接如下）

> *   *顺序工作流程*（通常基于流程图，从一个阶段进展到下一个阶段并且不会后退）
> *   *状态机工作流程*（从“状态”到“状态”的进展，这些工作流程更复杂，如果需要，可以返回到前一点）
> *   *规则驱动的工作流程*（基于 Sequential/StateMachine 工作流程实现。规则决定工作流程的进度）

维基百科：[Windows 工作流基金会](http://en.wikipedia.org/wiki/Windows_Workflow_Foundation)

MSDN：[Workflow Foundation (WF) 入门](http://tp://msdn.microsoft.com/en-us/netframework/aa663328.aspx)

# perl - 如何在 Perl 中编码 HTTP GET 查询字符串？

> ID：449158
> 
> 赞同：14
> 
> 时间：2009-01-16T01:08:45.717
> 
> 标签：perl, http, escaping, uri

这个问题与[在 Perl 中发出 HTTP GET 请求的最简单方法是什么有关？](https://stackoverflow.com/questions/134858/whats-the-simplest-way-to-make-a-http-get-request-in-perl).

在通过`LWP::Simple`我发出请求之前，我有一个查询字符串组件的哈希值，我需要对其进行序列化/转义。**编码查询字符串的最佳方法是什么？**它应该考虑空格和所有需要在有效 URI 中转义的字符。我想它可能在一个现有的包中，但**我不知道如何去寻找它。**

```
use LWP::Simple;
my $base_uri = 'http://example.com/rest_api/';
my %query_hash = (spam => 'eggs', foo => 'bar baz');
my $query_string = urlencode(query_hash); # Part in question.
my $query_uri = "$base_uri?$query_string";
# http://example.com/rest_api/?spam=eggs&foo=bar+baz
$contents = get($query_uri); 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-16T02:41:38.493

[URI::Escape](http://search.cpan.org/~gaas/URI-1.37/URI/Escape.pm)可能是最直接的答案，正如其他人给出的那样，但我建议对整个事情使用[URI对象。](http://search.cpan.org/~gaas/URI/)URI 会自动为您转义 GET 参数（使用 URI::Escape）。

```
my $uri = URI->new( 'http://example.com' );
$uri->query_form(foo => '1 2', bar => 2);
print $uri; ## http://example.com?foo=1+2&bar=2 
```

作为一个额外的好处，[LWP::Simple 的](http://search.cpan.org/search?query=lwp%3A%3Asimple&mode=all) *get*函数将把一个[URI](http://search.cpan.org/~gaas/URI/)对象作为它的参数，而不是一个字符串。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-01-16T01:29:43.537

[URI::Escape](http://search.cpan.org/perldoc?URI::Escape)做你想做的事。

```
use URI::Escape;

sub escape_hash {
    my %hash = @_;
    my @pairs;
    for my $key (keys %hash) {
        push @pairs, join "=", map { uri_escape($_) } $key, $hash{$key};
    }
    return join "&", @pairs;
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-04-03T16:48:58.873

[URI](https://metacpan.org/pod/URI)远比`URI::Escape`这简单得多。方法[query_form()](https://metacpan.org/pod/URI#uri-query_form)接受散列或散列引用：

```
use URI;
my $full_url = URI->new('http://example.com');
$full_url->query_form({"id" => 27, "order" => "my key"});
print "$full_url\n";     # http://example.com?id=27&order=my+key 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2015-01-16T11:10:24.297

使用模块[URI](https://metacpan.org/pod/URI)构建带有查询参数的 URL：

```
use LWP::Simple;
use URI;

my $uri_object = URI->new('http://example.com/rest_api/');
$uri_object->query_form(spam => 'eggs', foo => 'bar baz');

$contents = get("$uri_object"); 
```

我在[这里](http://lwp.interglacial.com/ch05_02.htm)找到了这个解决方案。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-16T01:36:03.870

请改用 LWP::UserAgent：

```
use strict;
use warnings;

use LWP::UserAgent;

my %query_hash = (spam => 'eggs', foo => 'bar baz');

my $ua = LWP::UserAgent->new();
my $resp = $ua->get("http://www.foobar.com", %query_hash);

print $resp->content; 
```

它会为您处理编码。

如果您想要更通用的编码解决方案，请参阅[HTML::Entities](http://search.cpan.org/~gaas/HTML-Parser-3.59/lib/HTML/Entities.pm)。

编辑：[URI::Escape](http://search.cpan.org/~gaas/URI-1.37/URI/Escape.pm)是一个更好的选择。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-16T01:32:31.770

[URI::Escape](https://metacpan.org/pod/URI::Escape)是您可能正在考虑的模块。

# delphi - 在 Delphi 中：如何在调试时跳过部分代码？

> ID：449159
> 
> 赞同：15
> 
> 时间：2009-01-16T01:08:49.570
> 
> 标签：delphi, debugging

在 Delphi 中调试时，我经常不小心进入我不感兴趣的代码。

先说我知道F8可以跨过去，f4可以跑到某一行。

例子：

```
function TMyClass.DoStuff():Integer;
begin
  // do some stuff
  bla();
end;

procedure TMyClass.Foo()
begin
  if DoStuff()=0 then // press F7 when entering this line
    beep;
end; 
```

示例：我想通过按 F7 进入方法 DoStuff()，但我没有去那里，而是首先进入 FastMM4.FastGetMem()，这是一大堆汇编代码，显然我对片刻。

有几种方法可以解决这个问题，我不喜欢其中任何一种：

*   *在“ bla* ”上添加一个断点（如果你只想在特殊情况下进入 DoStuff 几乎没用，比如迭代 23498938）；

*   不要按 F7，而是手动将光标移动到“ *bla* ”，然后按 F4（适用于这个简单的示例。实际上，它没有）；

*   在 FastMM 的情况下：暂时禁用 fastmm；

有什么方法可以提示 IDE 我**从来没有**兴趣进入某个代码块，还是我总是必须设置额外的断点或使用 F4 来避免这种情况？

我希望有一些神奇的编译器指令，如 {$NODEBUG BEGIN/END} 或类似的东西。

在大多数情况下，能够排除整个单元对我来说已经足够细粒度了，但是能够避免某些方法甚至代码行会更好。

更新：也许 codegear 应该引入类似*跳过点的*东西（而不是断点）:-)

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-16T03:18:35.910

有一个“神奇的 nodebug 开关”。{$D-} 将禁用调试代码的生成。把它放在你的 FastMM 单元的顶部，你最终不会追踪到它。如果你最终进入了一个你不想进入的功能，SHIFT-F8 会让你很快离开。（**警告：**不要在使用堆栈的汇编代码例程中使用 SHIFT-F8。可能会导致不可预测的行为。改为 F4 到它的底部。）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-16T03:52:12.657

如果您正在跳入 FastMM 代码，那么就会发生内存操作。您显示的代码没有任何内存操作，因此您的问题不完整。我会试着猜测你的意思。

当子例程具有编译器管理类型的局部变量（例如字符串、接口或动态数组）时，函数序言有非常重要的工作要做。序言也是调整输入参数的引用计数的地方。调试器代表`begin`函数行中的序言。如果当前执行点是该行，并且您“进入”它，您将被带到用于管理特殊类型的 RTL 代码。（我也不希望 FastMM 参与其中，但也许事情已经改变了我以前的习惯。）在这种情况下，一件容易做的事情是“越过”这`begin`条线而不是进入它。使用 F8。

如果您在*输入*突出显示的行时确实按 F7，那么您做错了。那是进入`begin`线路，*而不是*`DoStuff`被调用的线路。因此，您是否被 FastMM 代码所吸引与`DoStuff`. 要调试对 的调用`DoStuff`，当前执行点应该已经*是*调用所在的行。

如果您只想`DoStuff`在迭代 23498938 上进行调试，则可以在该函数中设置*条件断点。*在装订线中单击以创建一个正常的断点，然后右键单击它以显示其属性。在那里，您可以定义一个条件，每次执行到达该点时都会评估该条件。调试器只会在条件为真时停止。按 F8 以“跳过”`DoStuff`调用，如果条件为真，调试器将停在那里，就像您按 F7 一样。

您可以切换“使用调试 DCU”选项以避免进入大多数 RTL 和 VCL 单元。我不知道 FastMM 是否包含在该集合中。主要区别在于您链接到的 DCU 是否使用调试信息进行编译。该设置更改*库路径*以包含或排除调试 DCU 所在的子目录。我*认为*您可以配置包含或排除的调试目录集，以便根据“调试 DCU”设置添加或删除自定义目录集。

回到断点。您可以通过为断点分配名称来设置*断点组*。您可以使用高级断点在传递时启用或禁用一组命名的断点。（如果需要，断点组可以只有一个断点。）因此，例如，如果您只想在位置 X 中断，如果您还通过了程序中的某个其他位置 Y，则可以在 X 处设置禁用断点在 Y 处设置一个非中断断点。在 Y 处设置“启用组”设置以启用组 X。

您还可以在不自动启用和禁用的情况下利用禁用的断点。您的断点出现在“断点”调试器窗口中。如果您正在单步执行`DoStuff`并决定这次要检查`bla`，请转到断点窗口并在`bla`. 无需导航到`bla`'s implementation 以在此处设置断点。

有关高级断点的更多信息，请参阅[在 Delphi 中使用非中断断点](http://dn.codegear.com/article/31263)，以及 Cary Jensen 几年前的文章。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-16T14:53:03.647

我可能遗漏了您的帖子中的某些内容，但是使用 FastMM4，您可以编辑 FastMM4Options.Inc 包含文件并删除“。” 从以下定义：

* * *

来自 FastMM4Options.inc ****

{启用此选项以禁止为 FastMM4.pas 单元生成调试信息。这将阻止集成调试器进入内存管理器代码。}

{$.define NoDebugInfo}

* * *

重新编译（可能需要构建）时，调试器将（应该）不再调试 FastMM 代码。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-16T02:12:59.830

使用 FasmMM 的预编译非调试 DCU

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-10-13T13:27:08.837

在项目 dpr 文件中，我使用

```
uses
{$IFNDEF DEBUG} FastMM4, {$ENDIF}
  ... // other units 
```

在调试模式下排除 FastMM4。不需要在 FastMM4 中进行任何更改，因此当我更改为其他版本时，我不必记得在 FastMM 中添加 {$D-}。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-16T01:16:02.333

AFAIK，调试器只知道您可以在选项中修改的浏览路径中的文件。因此，如果您排除您对调试不感兴趣的模块的路径，这将产生您想要做的效果。

一个警告：代码完成还依赖于浏览路径，因此您可能会遇到代码完成在需要时不足的情况。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-16T02:25:43.347

虽然它不是您问题的直接答案，但您可以通过将断点置于 bla 来修改您的第一个建议解决方案，该断点仅在通过 Foo 处的断点时启用（或您选择的其他一些条件，例如迭代计数）。然后它只会在你想要的时候打破。

顺便说一句，我越来越发现我不是在断点处停止执行，而是将变量值或堆栈转储转储到消息日志中。这允许比动态检查变量等更仔细的分析。FWIW。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-16T01:38:10.883

不，我不相信有办法告诉调试器永远不要在代码的某个部分停止。没有魔法指令。

当你进入一个你不想进入的例程时，你能做的最好的事情就是使用 Shift+F8，它会一直运行到返回。然后按 F7 或 F8 退出程序。

* * *

嗯。现在我看到了梅森的回答。学到了一些东西。谢谢，梅森。+1

# javascript - jQuery：子元素为其父元素触发事件

> ID：449161
> 
> 赞同：1
> 
> 时间：2009-01-16T01:10:54.077
> 
> 标签：javascript, jquery, toggle

我有几个这样的嵌套 div 元素：

```
<div class="main">
    blah blah blah <div class="clickme">clickme</div>
</div>

<div class="main">
    bleh bleh bleh <div class="clickme">clickme</div>
</div>

<div class="main">
    blih blih blih <div class="clickme">clickme</div>
</div> 
```

我想触发一个切换事件，该事件将通过单击带有类的子标签内的相应文本来显示/隐藏`div`带有类的标记。抱歉，我不知道该怎么做。谢谢。`"main"``clickme``div``"clickme"`

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-16T01:13:51.823

```
$(".clickme").click(function() {
    $(this).parent("div.main").toggle();
}); 
```

关于您的第二个问题，您需要添加：

```
$(this).unbind('click'); 
```

在您的任一切换功能结束时，它将按您的意愿工作。祝你好运。

**编辑：**针对您的最新问题，应该这样做：

```
$(".abrefecha").click( function() {
    var that = this; // save this in that :)
    jQuery(this).parent().toggle(
        function () {
            var itemId = jQuery(this).attr("id");
            var itemIndex = $(".showhide").index(this);
            var currentItemHeight = b[itemIndex] + 30 + 'px'
            jQuery(this).css("overflow","auto");
            jQuery(this).animate( { height: currentItemHeight } , 500 );
            $(that).html('close'); // change html inside pink to 'close'
            $(this).unbind('click');
        },
        function () {
            jQuery(this).css("overflow","hidden")
            jQuery(this).animate( { height:"60px" } , 500 );
            $(that).html('abrefecha'); // change html back to 'abrefecha'
            $(this).unbind('click');
        }
    );
}); 
```

# sql-server - 能否将 SQL 文件导入 SQL 2005/8 脚本？

> ID：449164
> 
> 赞同：1
> 
> 时间：2009-01-16T01:11:29.300
> 
> 标签：sql-server, sql-server-2005, sql-server-2008

如果我在多个文件中有脚本，并且我想以已知顺序执行每个脚本，我可以简单地将它们导入 T-SQL 脚本并执行它们，还是必须对每个文件运行 sqlcmd 或类似的？我确定 Oracle 具有从另一个文件导入/包含脚本内容的功能（可能使用 @@ ？）。

我希望所有脚本都自动运行。即我不想手动加载和运行SQL 脚本的每个文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T14:13:41.243

您可以将脚本连接到一个文件中。在每个文件的末尾放置一个 GO 语句（如果还没有的话），作为一个文件而不是多个文件运行应该没问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T15:26:15.840

如果您想自动运行脚本，我会制作一个批处理文件，为每个文件调用 osql。

-Edoode

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T01:59:14.430

我认为您可以将它们导入 T-SQL 脚本并执行。更好的是，使用 SSMS 和维护计划。这样，您可以运行单个 SQL 并在执行下一条语句之前检查是否成功。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T15:57:35.970

我们有一个免费的简单工具，您也可以使用 - 它称为 Script Executor - 社区版 ( [http://www.xsqlsoftware.com/Product/Sql_Server_Script_Executor.aspx](http://www.xsqlsoftware.com/Product/Sql_Server_Script_Executor.aspx) ) 允许您添加单个脚本和包含脚本的文件夹，命令他们并执行。如果您需要安排执行以自动运行，还有一个命令行选项。

# python - 是否有任何适用于 Python 的优秀 3rd 方 GUI 产品？

> ID：449168
> 
> 赞同：6
> 
> 时间：2009-01-16T01:11:49.393
> 
> 标签：python, user-interface

在 .Net 中，您拥有像 DevEpxress 和 Infragistics 这样的公司，它们提供一系列 GUI 小部件。Python GUI 小部件有这样的市场吗？我正在特别考虑像 DevExpress xtraGrid Suite 这样的小部件。

编辑 01-16-09：例如：

[http://www.devexpress.com/Downloads/NET/OnlineDemos.xml](http://www.devexpress.com/Downloads/NET/OnlineDemos.xml) [http://demos.devexpress.com/ASPxGridViewDemos/](http://demos.devexpress.com/ASPxGridViewDemos/)

[http://www.infragistics.com/products/default.aspx](http://www.infragistics.com/products/default.aspx)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-16T01:49:55.917

There are a number of GUI Toolkits available for Python. Obviously, the toolkit you choose will determine your selection of 3rd party widgets.

**The Contenders**

Python comes with [Tkinter](http://wiki.python.org/moin/TkInter) which is easy to use, but not great looking.

There are some very popular cross platform GUI toolkits borrowed from C/C++ that have a lot of external widgets: [wxPython](http://www.wxpython.org/), [pyQt](http://wiki.python.org/moin/PyQt), [pyFLTK](http://pyfltk.sourceforge.net/), [pyGtk](http://www.pygtk.org/)

I also know of, but have not used some of the other toolkits that are out there: [PyGUI](http://www.cosc.canterbury.ac.nz/greg.ewing/python_gui/), [Easygui](http://easygui.sourceforge.net/), [PythonCard](http://pythoncard.sourceforge.net/)

**My Choice**

I'm a fan of [wxPython](http://www.wxpython.org/). They have a nice selection of widgets, some great examples that come with the [install](http://www.wxpython.org/download.php#binaries), good [documentation](http://www.wxpython.org/onlinedocs.php), a [book](https://rads.stackoverflow.com/amzn/click/com/1932394621), and an active community.

WxWidgets has additional components offered by the community called [wxCode](http://wxcode.sourceforge.net/).

Quote about wxPython from the creator of Python:

> wxPython is the best and most mature cross-platform GUI toolkit, given a number of constraints. The only reason wxPython isn't the standard Python GUI toolkit is that Tkinter was there first.
> 
> -- *Guido van Rossum*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T01:41:21.190

流行的 Python GUI 工具包通常是外部（通常是 C、C++）库的包装器。因此，无论这些外部库有什么 3rd 方产品，Python 代码都可以受益（即使在 3rd 方解决方案默认不提供 Python 包装器的情况下，也可以通过最少的手动包装）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T01:52:12.057

[wxPython](http://www.wxpython.org/) is a wrapper around [wxWidgets](http://wxwidgets.org/), LGPL (approximately) and very comprehensive
[pyQT](http://www.riverbankcomputing.co.uk/software/pyqt/intro) is a similair wrapper around [QT](http://qtsoftware.com/products), it's available as GPL or commercial

Although QT is now under the LGPL pyQT is a separate commercial product, it may be that they now release it under the LGPL or a community effort might now produce a LGPL alternative.

Both run on MS/Linux/Mac and are pretty comprehensive, there are excellent communities and books for both.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-05-05T02:26:36.970

所有 Python GUI 工具都无法与 DevExpress、Infragistic、Telerik、ComponentOne 等 C#.Net GUI 相提并论。这些 GUI 的质量永远无法与 .Net GUI 提供的功能相媲美。C# 编程拥有一套出色的 WSIWYG 编程工具来构建多平台应用程序，如 Visual Studio（用于 windows/mac）、Unity3D（用于游戏）、Blend（用于 Web）、Xamarin（移动应用程序）。然而，不利的一面是它没有用于计算的 Python 包或库那么多。因此，为了弥合差距，我通常会在 C#.Net 上完全构建接口，如果需要大量计算，我将使用 IronPython for .Net 来调用 Python 脚本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T01:36:06.833

大量的 GUI api 可用。PyQT、PtGTK、Tkinter...

-T

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T01:52:42.743

There's also [wxPython](http://wxpython.org/), which is a wrapper around [wxWidgets](http://www.wxwidgets.org/) which is quite popular, works on many platforms and liberally licensed.

QT would probably be the other one I would look at, especially now that the next release will be licensed under the LGPL.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-04-16T22:20:01.067

我没有在 Python 中看到任何用于 GUI 的商业包，但我知道 Kivy 是创建快速美观的 GUI [https://github.com/kivy/kivy的好选择](https://github.com/kivy/kivy)

# php - 这行代码有什么意义？

> ID：449172
> 
> 赞同：3
> 
> 时间：2009-01-16T01:14:54.410
> 
> 标签：php, virtuemart

我在管理员/组件/com_virtuemart/classes/ps_product.php 的第 2136 行的 Joomla 的 Virtuemart 插件中找到了这行代码

```
eval ("\$text_including_tax = \"$text_including_tax\";"); 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-16T02:10:58.277

废掉我之前的回答。

这个 eval() 在这里的原因显示在[php eval 文档中](http://www.php.net/eval)

这就是正在发生的事情：

```
$text_including_tax = '$tax <a href="...">...</a>';

...

$tax = 10;

...

eval ("\$text_including_tax = \"$text_including_tax\";"); 
```

最后`$text_including_tax`等于：

```
"10 <a href="...">...</a>" 
```

单引号防止`$tax`包含在字符串的原始定义中。通过使用`eval()`它强制它重新评估字符串并在字符串中包含 for 的值`$tax`。

我不喜欢这种特殊方法，但它是正确的。另一种方法是使用`sprintf()`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T01:52:00.060

这段代码似乎是强制`$text_including_tax`成为字符串的不好方法。

它不好的原因是因为*如果* `$text_including_tax`可以包含用户输入的数据，他们就有可能执行任意代码。

例如，如果`$text_include_tax`设置为等于：

```
"\"; readfile('/etc/passwd'); $_dummy = \""; 
```

评估将变为：

```
eval("$text_include_tax = \"\"; readfile('/etc/passwd'); $_dummy =\"\";"); 
```

向恶意用户提供 passwd 文件的转储。

一个更正确的方法是将变量转换为字符串：

```
$text_include_tax = (string) $text_include_tax; 
```

甚至只是：

```
$text_include_tax = "$text_include_tax"; 
```

如果数据`$text_include_tax`只是一个内部变量或包含已验证的内容，则不存在安全风险。但是将变量转换为字符串仍然是一种不好的方法，因为有更明显和更安全的方法可以做到这一点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T01:18:46.447

我猜这是强制 $text_including_tax 成为字符串而不是数字的一种时髦方式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T01:20:15.367

也许这是尝试将变量转换为字符串？只是一个猜测。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-01-19T18:09:17.873

您将需要评估才能将税率纳入输出。刚把它移到一个新的服务器上，由于某种原因，这条线导致了服务器错误。作为快速修复，我将其更改为：

```
//eval ("\$text_including_tax = \"$text_including_tax\";");
$text_including_tax = str_replace('$tax', $tax, $text_including_tax); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T01:18:29.787

它将字符串评估为 PHP 代码。

但它似乎使变量本身等于？奇怪的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-16T02:21:09.050

正如其他人所指出的，这是由不知道自己在做什么的人编写的代码。

我还快速浏览了代码，发现在放置 HTML/URIs/etc 时完全没有文本转义。一起。除了 eval 问题之外，这里可能还有许多注入漏洞，如果您不屑于对其进行正确审计的话。

我不希望这段代码在我的服务器上运行。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-12-14T14:30:53.337

我以前看过那个代码库。这是我见过的最糟糕的 PHP 之一。

我想你会做那种事情来掩盖你在其他地方犯的错误。

* * *

## 回答 #9

> 赞同：-4
> 
> 时间：2009-01-16T01:28:10.373

不，它正在这样做：

说`$text_including_tax`=“平”。此代码评估以下行：

$平=“平”；

这不一定很好，但我确实使用过一次这样的技术来吸收数组中的所有 MySQL 变量，如下所示：

```
 while ($row = mysql_fetch_assoc($result)) {
        $var = $row["Variable_name"];
        $$var = $row["Value"];
    } 
```

# javascript - Javascript对象之间的比较

> ID：449176
> 
> 赞同：1
> 
> 时间：2009-01-16T01:17:17.073
> 
> 标签：javascript, jquery

我使用 jQuery 为我的网站制作了一个简单的手风琴...效果很好，但我最近开始进行更改，如果您单击当前打开的段标题（可单击区域向上/向下滑动），它应该关闭当前部分。

```
var sideMenu = {
        activated: {},
        setup: function() {
        $('.menu-category-heading').bind('click', function() { 
                                                      sideMenu.slideMenu($('ul', $(this).parent()));
                                                      });

        }, 

        slideMenu: function(menuObj) {

            if (sideMenu.activated == menuObj) {

                $(sideMenu.activated).slideUp(400);
                sideMenu.activated = null;
                console.log('same');

            } else {

                $(sideMenu.activated).slideUp(400);
                menuObj.slideDown(500);
                sideMenu.activated = menuObj;
                console.log('new');
            }
        }

    } 
```

由于某种原因，比较永远不会起作用......如果我添加 $(menuObj).attr('id') 并且激活相同，它就会起作用。但这并不理想，因为并非所有项目都具有 id 属性。

关于使对象比较起作用的任何建议？或者有什么其他技巧吗？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T03:27:00.760

您可能正在保存一个 jQuery 对象（$ 调用的结果）而不是本机元素。每次执行 $(myEl) 时都会创建一个新对象，并且引用不会匹配，但本机元素会匹配。尝试：

```
if (slideMenu.activated[0] == menuObj[0]) {
    ...
} 
```

# sql - Sql Ansi 管理 DateTime 值

> ID：449182
> 
> 赞同：1
> 
> 时间：2009-01-16T01:18:48.613
> 
> 标签：sql, mysql, sql-server, database, ansi-sql

我正在开发一个多数据库系统。
我想要以秒为单位的两个日期之间的差异。

在**SQL Server**中，我得到：
`DATEDIFF(second,stardate,enddate)`
在**MySql**中：
`TIME_TO_SEC(TIMEDIFF(stardate,enddate))`

我的问题：
Sql Ansi 是否具有管理 DateTime 值的功能？
即：所有数据库都有通用的日期时间函数吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T01:40:14.670

根据 SQL:1999，date1-date0 应该给你一个 INTERVAL 类型的值，一个你应该能够从中提取 YEAR、MONTH、DAY 等的结构。

我从未使用过它，我认为它没有得到广泛支持（尽管我可能不是最新的）。如果您在数据库层进行时间算术，并且希望与跨 DBMS 兼容，通常的解决方案是简单地使用整数时间戳（无论分辨率如何，但 Unix 时间很常见）和普通的旧整数算术，这是完全可靠的交叉-平台。

# inversion-of-control - 转发类型如何应用于 IoC？

> ID：449194
> 
> 赞同：0
> 
> 时间：2009-01-16T01:24:58.167
> 
> 标签：inversion-of-control

我仍在学习 Castle Windsor，我发现它支持转发类型——我不熟悉的术语。

快速谷歌搜索，我发现[这篇](http://msdn.microsoft.com/en-us/library/ms404275.aspx)文章非常彻底地解释了它，但我仍然不明白这如何适用于 IoC 或我将如何从容器中使用它们以及出于什么原因。

谁能解释一下？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-16T01:59:57.470

类型转发是一种在不引入破坏性更改的情况下将类型从一个程序集移动到另一个程序集的方法，它与 IoC 无关。所以你不应该担心这个功能:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T03:11:16.250

哦，伙计，刚刚在 'Castle Windsor "Forwarded Types"' 上进行了谷歌搜索，并被重定向回 SO：

[使用 Castle Windsor 配置文件是否可以委托给另一个项目声明？](https://stackoverflow.com/questions/344019/using-castle-windsor-configuration-files-is-it-possible-to-delegate-to-another)

从那里：

[在 Castle Windsor 组件注册的上下文中，什么是“ForwardedTypes”？](https://stackoverflow.com/questions/197274/what-are-forwardedtypes-in-the-context-of-castle-windsor-component-registration)

也许 Jeff 和团队应该放弃尝试拥有自己的搜索并使用谷歌的。

# database - 您将如何在数据库模式中表示哈希表集合？

> ID：449202
> 
> 赞同：3
> 
> 时间：2009-01-16T01:27:55.210
> 
> 标签：database, database-design, list, hashtable

如果您尝试在数据库模式中创建域对象，并且在您的代码中说域对象具有哈希表/列表成员，如下所示：

```
public class SpaceQuadrant : PersistentObject
{

    public SpaceQuadrant()
    {
    }

    public virtual Dictionary<SpaceCoordinate, SpaceObject> Space
    {
        get;
        set;
    }
} 
```

字典只是一个将对象键映射到值键的哈希表/列表，我想出了多种方法来做到这一点，创建各种连接表或加载技术，但它们在获得 O(1) 方面都很糟糕您在哈希表中获得的访问时间。

您将如何在数据库模式中表示 SpaceQuadrant、SpaceCoordinate 和 Space Object？一个简单的模式代码描述会很好，即。

```
table SpaceQuadrant
{
    ID int not null primary key,
    EntryName varchar(255) not null,
    SpaceQuadrantJoinTableId int not null
                 foreign key references ...anothertable...
} 
```

但任何想法都会很好，谢谢阅读！

更多信息：

感谢您提供的出色答案，我只是略读了它们，我想在回复之前花一些时间思考每个问题。

如果你认为有更好的方法来定义这些类，那么一定要给我一个例子，你喜欢的任何语言都很酷

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T02:03:40.553

关系不是哈希表；它们是集合。

我不会使用坐标作为键来组织数据库。如果一个物体改变了位置怎么办？相反，我可能会将坐标视为对象的*属性*。

另外，我假设有固定数量的维度，例如三个。如果是这样，那么您可以将对象的这些属性存储在固定列中：

```
CREATE TABLE SpaceQuadrant (
  quadrant_id INT NOT NULL PRIMARY KEY,
  quadrant_name VARCHAR(20)
  -- other attributes
);

CREATE TABLE SpaceObject (
  object_id INT NOT NULL PRIMARY KEY,
  x NUMERIC(9,2) NOT NULL,
  y NUMERIC(9,2) NOT NULL
  z NUMERIC(9,2) NOT NULL,
  object_name VARCHAR(20) NOT NULL,
  -- other attributes
  quadrant_id INT NOT NULL,
  FOREIGN KEY (quadrant_id) REFERENCES SpaceQuadrant(quadrant_id)
); 
```

在您的面向对象类中，不清楚为什么您的对象在字典中。你提到在 O(1) 时间内访问它们，但你为什么要通过坐标来做到这一点？

如果您使用它来优化查找某个点附近的对象（例如玩家的飞船），您还可以在填充此 SpaceQuadrant 的 SQL 查询中构建每个对象与该给定点的距离的计算，并排序距离结果。

我对您的程序知之甚少，无法知道这些建议是否相关。但它们是否至少让你想到了组织数据的不同方式？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T02:56:07.000

在最简单的情况下，字典有一个键可以映射到表的主键 - 因此，当您指定键的值时，您可以通过简单的查找立即找到匹配的数据。

在这种情况下，您需要一个表 SpaceQuadrant，其中包含描述或表征空间象限的任何一般（单值）属性。SpaceQuadrant 表将有一个主键，可能是一个生成的 ID，也可能是一个自然值。然后哈希表将包含一个表，其中包含用于交叉引用 SpaceQuadrant 的主键值、位置（SpaceCoordinate）以及象限和坐标的属性。

现在，如果你有一个可扩展的 DBMS，你可以为 SpaceCoordinate 定义一个用户定义的类型；否则，您可以使用三列 - 例如 x、y、z 或 r、theta、rho - 来表示位置（空间坐标）。

一般而言，我所描述的结构与比尔·卡尔文的结构非常相似。关键（直到我重读消息之后才打算双关语）不同之处在于，如果您确定这是组织的最佳方式，那么在我的书中将位置作为从属表的主键的一部分是完全可以的它。您可能还有一个作为备选候选键的对象 ID 列。或者，如果对象的存在独立于它们恰好所在的空间象限（或者可以存在于多个位置 - 因为它们不是点而是空间站或其他东西），那么您可能将 SpaceObject 放在单独的表。什么是最好的取决于我们无法获得的信息。

您应该知道使用 SpaceCoordinate 作为主键的一部分的限制：

*   没有两个对象可以占据相同的位置（这在哈希表和 3D 空间中称为碰撞），
*   如果位置发生变化，那么您必须更新关键数据，这比更新非关键数据更昂贵，
*   邻近查找将很困难 - 精确查找很容易。

记忆中的字典也是如此；如果您更改坐标，则必须从旧位置删除记录并将其放在字典中的新位置（或者语言必须在幕后为您执行此操作）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T03:00:03.230

字典*是*一张表。哈希是使用哪种索引的问题。大多数 RDBMS 都假设表很大且密集，因此散列索引不合适。

```
table SpaceQuadrant { 
    ID Primary Key,
    -- whatever other attributes are relevant
}

table Space {
    SpaceCoordinate Primary Key,
    Quadrant Foreign Key SpaceQuadrant(ID),
    SpaceObject -- whatever the object is
} 
```

您的 Space 对象具有对其所在象限的 FK 引用。

根据您的 RDBMS，您可能能够找到一个基于散列的索引来获得您希望的性能。例如 MySQL，使用 HEAP 存储引擎支持 HASH 索引。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T04:39:06.947

首先，在许多数据库中都存在对地理定位数据的专门支持——可以使用不同的算法（例如，存在 B 树的空间版本），并且可能存在对邻近搜索的支持。

由于每个 SpaceQuadrant 都有不同的哈希表，因此您需要类似（从 S.Lott 的帖子编辑）：

```
table Space {
    SpaceCoordinate,
    Quadrant Foreign Key SpaceQuadrant(ID),
    SpaceObject -- whatever the object is (by ID)
    Primary Key(SpaceCoordinate, Quadrant)
} 
```

这是一`(SpaceCoordinate, Quadrant) -> SpaceObjectId`本字典。

=====

现在，关于您的 O(1) 性能问题，有很多原因导致它被错误地解决。

正如有人告诉您的，您可以在许多数据库中为基于内存的表使用哈希索引。但是，如果您需要持久存储，则需要更新两个表（一个内存表和一个持久表）而不是一个（如果没有对此的内置支持）。要发现这是否值得，您需要对实际数据（具有实际数据大小）进行基准测试。

此外，将表强制放入内存可能会产生更严重的影响。

如果有东西被交换了，你就死定了——如果你使用了 B-Tree（即普通的基于磁盘的索引），它的算法将最小化所需的 I/O。否则，所有 DBMS 都将使用哈希表并依赖交换，而不是 B-Tree。你可以试着预测你是否能适应记忆，但是......

此外，B-Trees 不是 O(1)，而是 O(log_512(N))，或者类似的东西（我知道它会崩溃到 O(log N)，但请耐心等待）。你需要 (2^9)^4 = 2^36 = 64GiB 才能达到 4，如果你有这么多的数据，你无论如何都需要一个大的铁服务器来适应内存。所以，它几乎是 O(1)，而常数因素才是真正重要的。
有没有听说过低渐近复杂度、大常数因子的算法，在不切实际的数据大小上，它会比简单的算法更快？

最后，我认为数据库作者比我和你更聪明。特别是考虑到 SQL 的声明性质，以这种方式手动优化它是不值得的。如果索引适合内存，我想如果值得的话，他们可以根据需要选择构建和使用磁盘索引的哈希表版本。为此调查您的文档。

但底线是，过早的优化是邪恶的，尤其是当它是这种类型时（我们自己考虑的奇怪优化，而不是标准 SQL 优化），并且使用声明性语言。

# vba - 如何使用 VBA 从 64 位 Windows Vista 调用 ActivateKeyboardLayout

> ID：449207
> 
> 赞同：5
> 
> 时间：2009-01-16T01:30:53.223
> 
> 标签：vba, internationalization, vista64, keyboard-layout

在 XP 下运行 VBA 我能够调用 ActivateKeyboardLayout 将我的输入语言从英语切换到另一种语言。但是，这不再适用于 Vista64。

有什么建议或解决方法吗？

以前在 XP 下工作的代码类似于以下内容：

```
Private Declare Function ActivateKeyboardLayout Lib "user32" ( _
    ByVal HKL As Long, ByVal flags As Integer) As Integer
Const aklPUNJABI As Long = &H4460446
ActivateKeyboardLayout aklPUNJABI, 0 
```

有人建议尝试

```
Public Declare Function ActivateKeyboardLayout Lib "user32" ( _
    ByVal nkl As IntPtr, ByVal Flags As uint) As Integer 
```

当我尝试这个时，我收到错误消息：

**变量使用 Visual Basic 不支持的自动化类型**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-16T18:21:11.813

您对 ActivateKeyboardLayout 的声明实际上是不正确的。对于 32 位系统，您的代码应该是这样的：

```
Private Declare Function ActivateKeyboardLayout Lib "user32" (ByVal HKL As Long, _
    ByVal flags As Long) As Long

Const aklPUNJABI As Long = &H4460446
Dim oldLayout as Long
oldLayout = ActivateKeyboardLayout(aklPUNJABI, 0)
If oldLayout = 0 Then
   'Oops an error'
Else
   'Save old layout for later restore?'
End If 
```

在这种情况下，操作系统的 64 位有点像红鲱鱼。由于您正在运行 VBA 应用程序，因此无论操作系统如何，它都必须作为 32 位应用程序运行。我怀疑您的问题可能是在您的 Vista 系统上未加载您想要的旁遮普语键盘布局。ActivateKeyboardLayout 仅用于激活已加载的键盘布局。出于某种原因，此 API 的设计者认为由于键盘布局不存在而导致的失败不是错误，因此未设置 LastDllError。对于这种情况，您可能需要考虑使用 LoadKeyboardLayout。

编辑：要仔细检查您尝试获取的键盘布局是否已实际加载，您可以使用以下命令：

```
Private Declare Function GetKeyboardLayoutList Lib "user32" (ByVal size As Long, _
    ByRef layouts As Long) As Long

Dim numLayouts As Long
Dim i As Long
Dim layouts() As Long

numLayouts = GetKeyboardLayoutList(0, ByVal 0&)
ReDim layouts(numLayouts - 1)
GetKeyboardLayoutList numLayouts, layouts(0)

Dim msg As String
msg = "Loaded keyboard layouts: " & vbCrLf & vbCrLf

For i = 0 To numLayouts - 1
   msg = msg & Hex(layouts(i)) & vbCrLf
Next

MsgBox msg 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T03:07:35.650

这只是一个盲目的猜测，但是您是否尝试过以提升的管理员身份运行您的应用程序以查看它是否有所作为？GetLastError 的错误代码/值是什么？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T08:01:53.960

您是否尝试过[.Net 行](http://social.msdn.microsoft.com/forums/en-US/winforms/thread/2e431600-462e-4f67-87f5-4698d558f731/)（如[VB.Net 脚本](http://www.astahost.com/info.php/vb-net-switch-regional-language-automatically_t6031.html)或[那些片段](http://blogs.msdn.com/snippets/archive/2008/12/31/how-to-change-input-language-programmatically.aspx)），例如：

```
InputLanguage.CurrentInputLanguage = 
    InputLanguage.FromCulture(New System.Globalization.CultureInfo("ar-EG")) 
```

[带有.Net3.5](http://msdn.microsoft.com/fr-fr/library/bb882520.aspx)的 Vista64 应该支持[InputLanguage](http://msdn.microsoft.com/fr-fr/library/system.windows.forms.inputlanguage.culture.aspx)

VB.Net 代码：

```
Public Sub ChangeInputLanguage(ByVal InputLang As InputLanguage)
   If InputLanguage.InstalledInputLanguages.IndexOf(InputLang) = -1 Then
        Throw New ArgumentOutOfRangeException()
   End If
    InputLanguage.CurrentInputLanguage = InputLang
End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-14T17:49:15.287

对于 64 位可移植性，您可能需要使用 IntPtr。你能试一试吗？

```
Public Declare Function ActivateKeyboardLayout Lib "user32" (ByVal nkl As IntPtr, ByVal Flags As uint) As Integer 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-12-03T00:33:09.257

在 64 位版本的 Office 应用程序中，VBA 确实是 64 位的。有关更改的详细信息，请参阅[Office 2010 文档](https://msdn.microsoft.com/en-us/library/office/ee691831(v=office.14).aspx)。对于[Stephen Martin 的回答](https://msdn.microsoft.com/en-us/library/office/ee691831(v=office.14).aspx)中给出的示例，您需要按如下方式更改代码以添加属性并修复在 Win32 API`PtrSafe`中具有类型的参数：`HKL`

```
Private Declare PtrSafe Function ActivateKeyboardLayout Lib "user32" (ByVal HKL As LongPtr, _
    ByVal flags As Long) As LongPtr

Const aklPUNJABI As LongPtr = &H4460446
Dim oldLayout as LongPtr
oldLayout = ActivateKeyboardLayout(aklPUNJABI, 0)
If oldLayout = 0 Then
   'Oops an error'
Else
   'Save old layout for later restore?'
End If 
```

和

```
Private Declare PtrSafe Function GetKeyboardLayoutList Lib "user32" (ByVal size As Long, _
    ByRef layouts As LongPtr) As Long

Dim numLayouts As Long
Dim i As Long
Dim layouts() As LongPtr

numLayouts = GetKeyboardLayoutList(0, ByVal 0&)
ReDim layouts(numLayouts - 1)
GetKeyboardLayoutList numLayouts, layouts(0)

Dim msg As String
msg = "Loaded keyboard layouts: " & vbCrLf & vbCrLf

For i = 0 To numLayouts - 1
   msg = msg & Hex(layouts(i)) & vbCrLf
Next

MsgBox msg 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-19T01:12:48.327

在这里每个人似乎都忽略了一件事情，那就是您是在 VBA 中工作，而不是在 .NET 中工作。IntPtr 是一种 .NET 类型，它表示平台原生的整数。在 32 位平台上是 32 位，在 64 位平台上是 64 位。

鉴于 HKL 是句柄的 typedef，它是 PVOID 的 typedef，它是 VOID * 的 typedef，如果您使用的是 .NET，这正是您所需要的。

VBA 没有针对 64 位数字的任何内容，因此您必须采用不同的方法。

在 64 位机器上，您必须执行以下操作：

```
Public Type HKL64
    High As Long
    Low As Long
End Type

Private Declare Function ActivateKeyboardLayout Lib "user32" ( _
    Byval HklHigh As Long, Byval HklLow As Long, _
    ByVal flags As Integer) As HKL64 
```

这*应该*允许您将堆栈上的 64 位值传递给 API 函数（跨两个变量）。但是，如果您要在 64 位和 32 位机器上使用此代码，您将不得不对 API 进行两次声明，然后确定调用哪一个。

此外，VBA 中调用处理指针或句柄的 API 的任何其他代码都必须适当更改以处理 64 位输入（不是 32 位）。

附带说明一下，ActivateKeyboardLayout 的原始声明是错误的，因为它的返回类型为 Integer，这是一个 16 位值，而 API 返回的类型是 HKL，它是 32 位或 64 位，具体取决于平台.

# asp.net - 无效的安全证书和域名

> ID：449212
> 
> 赞同：4
> 
> 时间：2009-01-16T01:34:01.003
> 
> 标签：asp.net, https, ssl-certificate, domain-name

我最近为一个对 www.example.com 有效但对 *.example.com 无效的网站购买了安全证书（通配符版本 - 更贵）我现在遇到的问题是，虽然用户可以输入[http://example.com](http://example.com)，安全版本（启用 ssl 的页面）[https://example.com](https://example.com)引发了无效证书异常 - 这是完全可以理解的。

如何在请求实际到达服务器**之前将 https 流量重定向到 www.example.com 版本？**我尝试了 url 重写和重定向，但没有任何运气。有任何想法吗 ？

该网站使用 ASP.NET 构建并托管在 IIS 7 服务器上。

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T01:45:26.750

再花几美元买一个（在 Godaddy 大约 30 美元），以获得较短的域 example.com 的廉价证书。

大量用户似乎不太可能在[https://example.com](https://example.com)中输入。如果他们正在输入地址，他们可能使用的是 http:// 或什么都不使用。您应该能够设置 2 个虚拟主机，一个用于[http://example.com/](http://example.com/)，另一个用于 http(s)://www.example.com。将所有内容从 example.com 重定向到 www.example.com

首先协商 SSL，因此如果[https://example.com](https://example.com)的证书无效，您实际上无法将连接从[https://example.com](https://example.com)重定向到[https://www.example.com 。](https://www.example.com)

# graphics - 如何将线条动态投影到 3D 地形上？

> ID：449220
> 
> 赞同：2
> 
> 时间：2009-01-16T01:38:17.313
> 
> 标签：graphics, xna, xbox360

我正在 XNA 中为 Xbox 360 开发游戏。该游戏具有 3D 地形，其中包含一组静态对象，这些对象通过链接图连接。我想将连接对象的链接绘制为投影到地形上的线。我还希望能够在玩家移动他们的选择时更改链接的颜色等，尽管我不需要移动链接。但是，我遇到了使这项工作正确有效的问题。

我的一些想法是：

1) 将四边形渲染到单独的渲染目标，并将纹理用作地形顶部的叠加层。我目前有这个工作，只为相机当前可见的区域生成纹理以最小化锯齿。但是，我仍然遇到混叠问题 - 线条看起来参差不齐，并且~~移动相机时~~游戏经常突突编辑：它一直突突，我只是在 Xbox 上没有帧速率计数器，所以我只注意到它当事情移动时。

2）提前将线条烘烤成纹理。这可以提高性能，但会使混叠问题变得更糟。此外，它不允许我在没有太多修改的情况下动态更改线条的属性。

3）通过在地形上镶嵌线四边形来制作与地形形状相匹配的几何图形。这个选项似乎有帮助，但我不确定是否应该花时间尝试一下，如果有更简单的方法。

有没有我没想到的神奇方法？如果正确完成，这些路径之一是最好的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T02:23:37.860

您的 1) 是一个相当不错的解决方案。您可以通过过滤来减少锯齿——首先，确保在使用叠加层时使用双线性采样。然后，在绘制后但在使用之前尝试模糊叠加层；如果您选择适当的过滤器，它将消除锯齿。

如果渲染叠加层花费了太多时间，请尝试降低其分辨率。如果没有抗锯齿过滤器，它只会让它变得更加锯齿，但如果有一个好的过滤器，它甚至可能看起来更好。

我不知道为什么游戏只有在移动相机时才会卡顿。请记住，您应该有一个单独的相机用于叠加 - 正交，并指向地形。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-01-16T02:40:28.357

XNA 有阴影库吗？如果是这样，你可以假装线条是阴影。

# django - 拥有更新字段或 COUNT 查询是否“更好”？

> ID：449230
> 
> 赞同：0
> 
> 时间：2009-01-16T01:40:46.887
> 
> 标签：django, database-design, django-models, django-signals, django-aggregation

在我正在开发的 Django 应用程序中，我进行了以下操作：

```
class Parent(models.Model):
    name = models.CharField(...)

    def num_children(self):
        return Children.objects.filter(parent=self).count()

    def avg_child_rating(self):
        return Child.objects.filter(parent=self).aggregate(Avg('rating'))

class Child(models.Model):
    name = models.CharField(...)
    parent = models.ForeignKey(Parent)
    rating = models.IntegerField(default=0) 
```

我计划经常访问**avg_child_rating** 。如果我执行以下操作会*优化：*

```
class Parent(models.Model):
    ...
    num_children = models.IntegerField(default=0)
    avg_child_rating = models.FloatField(default=0.0)

def update_parent_child_stats(sender, instance, **kwargs):
    num_children = Child.objects.filter(parent=instance.parent)
    if instance.parent.num_children != num_children:
        instance.parent.num_children = num_children
        instance.parent.avg_child_rating = Child.objects.filter(instance.parent=self).aggregate(Avg('rating'))

post_save.connect(update_parent_child_stats, sender=Child)
post_delete.connect(update_parent_child_stats, sender=Child) 
```

现在的不同之处在于，每次创建/评级/删除孩子时，都会更新 Parent 对象。我知道创建/评级会经常进行。

什么更*贵*？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T01:46:24.550

取决于问题的规模。如果您预计会有大量写入流量，这可能是个问题。扩展写入比读取（复制、缓存等）要困难得多。也就是说，如果没有这个额外的查询会给您带来任何问题，您可能会走很长一段路。

根据您的统计信息必须是最新的，您可以让其他一些流程（非网络会话）通过并每晚更新这些统计信息。

# c# - 从 Windows 移动应用程序获取文件的图标

> ID：449234
> 
> 赞同：2
> 
> 时间：2009-01-16T01:41:19.770
> 
> 标签：c#, windows-mobile, icons

我正在使用 C# 为 windows mobible 6 开发应用程序。我需要获取文件的图标，但我不知道该怎么做 =P。

有没有办法得到它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T07:22:24.997

是的，虽然它不是无痛的，并且需要使用 PInvoke。这是我的做法。（`WinApi`是一个辅助静态类，其中包含 PInvoke 外部函数定义以及一些必需的常量。其中还有更多内容，但我删除了与获取文件图标无关的内容。）

```
using System;
using System.IO;
using System.Collections.Generic;
using System.Text;
using System.Runtime.InteropServices;
using System.Drawing;

namespace ExtendedCF {
    public static class WinApi
    {
        #region Icons
        [DllImport("coredll.dll")]
        public static extern bool DestroyIcon(IntPtr hIcon);
        #endregion

        #region SHGetFileInfo
        [DllImport("coredll.dll", CharSet = CharSet.Auto)]
        public static extern int SHGetFileInfo(
          string pszPath,
          int dwFileAttributes,
          out SHFILEINFO psfi,
          uint cbfileInfo,
          SHGFI uFlags);

        [Flags]
        public enum SHGFI : int
        {
            /// <summary>get icon</summary>
            Icon = 0x000000100,
            /// <summary>get display name</summary>
            DisplayName = 0x000000200,
            /// <summary>get type name</summary>
            TypeName = 0x000000400,
            /// <summary>get attributes</summary>
            Attributes = 0x000000800,
            /// <summary>get icon location</summary>
            IconLocation = 0x000001000,
            /// <summary>return exe type</summary>
            ExeType = 0x000002000,
            /// <summary>get system icon index</summary>
            SysIconIndex = 0x000004000,
            /// <summary>put a link overlay on icon</summary>
            LinkOverlay = 0x000008000,
            /// <summary>show icon in selected state</summary>
            Selected = 0x000010000,
            /// <summary>get only specified attributes</summary>
            Attr_Specified = 0x000020000,
            /// <summary>get large icon</summary>
            LargeIcon = 0x000000000,
            /// <summary>get small icon</summary>
            SmallIcon = 0x000000001,
            /// <summary>get open icon</summary>
            OpenIcon = 0x000000002,
            /// <summary>get shell size icon</summary>
            ShellIconSize = 0x000000004,
            /// <summary>pszPath is a pidl</summary>
            PIDL = 0x000000008,
            /// <summary>use passed dwFileAttribute</summary>
            UseFileAttributes = 0x000000010,
            /// <summary>apply the appropriate overlays</summary>
            AddOverlays = 0x000000020,
            /// <summary>Get the index of the overlay in the upper 8 bits of the iIcon</summary>
            OverlayIndex = 0x000000040,
        }

        /// <summary>Maximal Length of unmanaged Windows-Path-strings</summary>
        private const int MAX_PATH = 260;
        /// <summary>Maximal Length of unmanaged Typename</summary>
        private const int MAX_TYPE = 80;

        [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Auto)]
        public struct SHFILEINFO
        {
            public SHFILEINFO(bool dummy)
            {
                hIcon = IntPtr.Zero;
                iIcon = 0;
                dwAttributes = 0;
                szDisplayName = "";
                szTypeName = "";
            }
            public IntPtr hIcon;
            public int iIcon;
            public uint dwAttributes;
            [MarshalAs(UnmanagedType.ByValTStr, SizeConst = MAX_PATH)]
            public string szDisplayName;
            [MarshalAs(UnmanagedType.ByValTStr, SizeConst = MAX_TYPE)]
            public string szTypeName;
        };

        #endregion
    }
    public static class Utils
    {
        #region GetFileIcon and GetFolderIcon
        /// <summary>
        /// Get the associated Icon for a file or application.  Always returns
        /// an icon.  If the filePath is invalid, the default icon for files of such type is returned.
        /// </summary>
        /// <param name="filePath">full path to the file</param>
        /// <param name="bSmall">if true, return the 16x16 icon; otherwise, the 32x32 icon</param>
        /// <returns></returns>
        private static Icon GetIcon(string filePath, bool bFolder, bool bSmall)
        {
            WinApi.SHFILEINFO info = new WinApi.SHFILEINFO(true);
            int cbFileInfo = Marshal.SizeOf(info);
            WinApi.SHGFI flags = WinApi.SHGFI.Icon | WinApi.SHGFI.UseFileAttributes;
            if (bSmall)
                flags |= WinApi.SHGFI.SmallIcon;
            else
                flags |= WinApi.SHGFI.LargeIcon;

            int fileAttributes = 0;
            if (bFolder)
            {
                fileAttributes = (int)FileAttributes.Directory;
            }

            WinApi.SHGetFileInfo(filePath, fileAttributes, out info, (uint)cbFileInfo, flags);
            Icon rv = (Icon)Icon.FromHandle(info.hIcon).Clone();
            WinApi.DestroyIcon(info.hIcon);
            return rv;
        }
        private static Icon GetIcon(string filePath, bool bFolder)
        {
            return GetIcon(filePath, bFolder, false);
        }
        public static Icon GetFileIcon(string filePath)
        {
            return GetIcon(filePath, false);
        }
        public static Icon GetFolderIcon(string folderPath)
        {
            return GetIcon(folderPath, true);
        }
        public static Icon GetFileIcon(string filePath, bool bSmall)
        {
            return GetIcon(filePath, false, bSmall);
        }
        public static Icon GetFolderIcon(string folderPath, bool bSmall)
        {
            return GetIcon(folderPath, true, bSmall);
        }
        #endregion
    }
} 
```

# c# - 使用 ASP.NET 动态设置 CSS 值

> ID：449237
> 
> 赞同：1
> 
> 时间：2009-01-16T01:42:19.863
> 
> 标签：c#, asp.net, css, configuration

我正在一个网站上工作，其中图像和其他资源将位于与网站主要内容不同的域中。我们将对主站点使用“www.example.com”之类的内容，然后将“images.example.com”用于样式等所有额外资源。

在开发网站时，我会将所有这些资源保留在本地开发人员中。机器。这里的挑战是保持生产服务器和开发环境之间的 CSS 引用一致。

我想做的是创建一个`web.config`存储图像服务器 URL 的密钥。然后，当从开发切换到生产时，我只需更改 web.config 的值，一切都会完成。

有没有办法从配置或 C# 类中的某个位置动态或以其他方式向 CSS 文件添加值？还是我以错误的方式解决这个问题？

此外，如果有什么不同，我仅限于使用 .NET 2.0。

**更新**
为了进一步扩展这一点，我知道我可以为服务器控件的 URL 使用 web.config 设置。这些已经动态生成。我更感兴趣的是我有哪些选项可以修改（或做“*某事*”）静态 CSS 文件，这将允许我更改诸如背景图像资源之类的内容的 URL，这些内容将在 CSS 中引用。除了使用我的 IDE 查找/替换值之外，我还能做些什么吗？也许可以使用部署脚本自动完成一些事情？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T02:03:39.040

将 CSS 文件保存在图像服务器上是一种选择吗？如果可能的话，您可以使所有图像引用相对，然后您只需要更新指向 css 文件的链接。

```
<link rel="stylesheet" href="<%= ConfigurationManager.AppSettings("css-server") %>style.css" /> 
```

如果您仍想动态发送或生成 css 文件：

css 文件不必以 css 结尾。aspx 没问题。你可以这样做：

```
<link rel="stylesheet" href="style.aspx" /> 
```

然后在你的 style.aspx 页面中：

```
protected void page_load(){
    Response.ContentType = "text/css";
    if (ConfigurationManager.AppSettings("css-server") == "local") {
        Server.Transfer("css/local.css");
    } else {
        Server.Transfer("css/production.css");
    }   
} 
```

如果您仍想动态生成 css 文件，我会使用 HttpHandler，将 contenttype 设置为“text/css”，然后使用 Response.Write 生成 css。如果您坚持让页面以 css 结尾，您总是可以在 IIS 中注册 css 以转到 asp.net，然后在 global.asax application_Begin 请求中传入请求，如果文件以 .css 结尾，则使用 httpcontext.current.rewritepath给你的处理程序。

这将产生 style.css 在运行时动态生成的净效果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T06:05:10.033

如何在网页上放置一个占位符，然后在运行时选择要使用的 CSS 文件（PROD、TEST 等）并将其添加到占位符中？

我认为更新的想法是正确的......

```
<link rel="stylesheet" href="<%= ConfigurationManager.AppSettings("css-server") %>style.css" /> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T15:31:06.580

对我来说，这听起来像是 NAnt [[链接](http://nant.sourceforge.net/)] 脚本的工作。它们很容易使用并且有据可查。

这样，您的代码不会更改您的 css 链接，它们会在部署时更新。这不是代码问题，而是部署问题，所以这样解决它对我来说感觉更“正确”。这样你就知道它是否在第一次加载时正确加载（使用正确的图像）每次加载。NAnt 脚本是您工具箱中的好东西。

其他解决方案将起作用，但每次页面加载时该代码将运行一次，该更改应该发生一次 - 在部署应用程序时。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T01:44:58.577

你欺骗了你自己的问题：

[https://stackoverflow.com/questions/449236/dynamically-setting-css-values-using-asp-net](https://stackoverflow.com/questions/449236/dynamically-setting-css-values-using-asp-net)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T01:53:13.600

这是一个常见的问题。我们所做的是为每个环境设置单独的 web.config 文件。web.config 中有一个 appSettings 键，任何配置值都像这样。

```
<appSettings>
<add key="ImagePath" value="d:\websites\www.site.com\www\images\" />
<appSettings> 
```

在后面的代码中设置图像控件时，使用如下：

```
myImage.ImageUrl = + _ 
```

System.Configuration.ConfigurationSettings.AppSettings("ImagePath") + "image1234567890.jpg"

只需更改您的 ImagePath 键以与生产或 qa 服务器上的路径相对应。此外，您可以使测试服务器具有相同的路径，但根据我的经验，此解决方案有效。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T02:19:04.250

我将为我的 CSS 创建一个服务器控件，在页面加载时注册 css 脚本块。您可以很容易地以编程方式更改此时的所有路径。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-17T04:14:07.977

也许您可以对开发服务器上的主机文件做些什么？这样您就不必实际更改任何代码。

不过，可以通过 asp.net 引擎发送扩展名为 .css 的文件。您还可以拥有返回有效 css 并在标签中引用这些处理程序的 .ashx 处理程序。不过，对于 90% 静态文本的内容，似乎有点浪费处理器。

# excel - 如何以编程方式设置 Interop 工作表中的所有其他列

> ID：449240
> 
> 赞同：1
> 
> 时间：2009-01-16T01:44:29.360
> 
> 标签：excel, interop, range, formula

使用 Excel Interop (.NET)，我们如何以编程方式为每隔一列设置两个不同的 Excel 公式。例如，

```
Range r = _sheet.get_Range(_sheet.Cells[1, 1], _sheet.Cells[I, J])  
r.Formula = "=something1" 
```

将为每个单元格执行此操作。

但在`J`列中，每隔一列都必须有公式`=something2`。

范围的大小仅在运行时才知道。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-11-04T21:00:37.330

首先，您创建一个函数来将范围定义为每隔一列，这[是此](http://excel.bigresource.com/Track-excel-J1w0Pbug/)(VBA) 的变体：

```
Sub EveryOtherColumn()

   Dim rangeString As String
   Dim columnLetter As String
   Dim i As Long

   Dim firstCol, lastCol As Long
   firstCol = Selection.Column
   lastCol = Selection.Columns.Count + firstCol - 1

   For i = firstCol To lastCol Step 2
     columnLetter = Chr(i + 64)
     rangeString = rangeString & "," & columnLetter & ":" & columnLetter
   Next i

   rangeString = Mid(rangeString, 2)

   Range(rangeString).Select

End Sub 
```

然后，您只需将公式分配给该范围。

# css - CSS中的水平滚动条

> ID：449241
> 
> 赞同：3
> 
> 时间：2009-01-16T01:44:32.917
> 
> 标签：css

我一直在尝试向我的上下文部分添加一个滚动条，它只允许框在查看器屏幕的可见范围内水平滚动，而不是垂直滚动。

有谁知道在流体 css 布局设计中在 div 中有可滚动内容的任何代码？

此外，这里是一个网站的链接，该网站具有我正在尝试重新创建的确切滚动效果：http: [//patrickhoelck.com/home.html](http://patrickhoelck.com/home.html)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-16T01:56:55.153

> 有谁知道在流体 css 布局设计中在 div 中有可滚动内容的任何代码？

'overflow: auto' 将在必要时添加滚动条。

诀窍是确保可滚动元素内的内容超过元素的正常宽度，而不是简单地回流到新行，在这种情况下它永远不会触发滚动条。一种方法是使用“空白：nowrap”。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-16T01:50:10.690

您可能想看看[overflow-x: scroll](http://www.blooberry.com/~bloo/indexdot/css/properties/position/overflowx.htm)，它与在父级上设置固定大小一起，如果内容太宽，将强制水平滚动条。

一些示例html：

```
<div style="width: 50px; overflow-x: scroll">
    <p>Hello world!</p>
    <p>Here is a div with a horizontal scrollbar!</p>
</div> 
```

# c# - What is the best practise for providing a method/class/component that supports cancellation?

> ID：449268
> 
> 赞同：1
> 
> 时间：2009-01-16T01:57:58.317
> 
> 标签：c#, design-patterns

How do you design a method/class that should support cancellation of the operation?

I realized that I never do that in a consistent manner and I want to change that.

Some of the things I have used:

*   a boolean property on the class IsCancelled that I synchronize internally. sometimes I have a CanCancel property if the operation cannot be canceled at any given time
*   pass a Func< bool > delegate that I repeatedly call to see if the operation has been canceled.
*   terminate the thread manually - although this is definitely bad practise

How do you normally do that?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-02-10T13:01:13.050

我会选择[`CancellationTokenSource`](http://msdn.microsoft.com/en-us/library/system.threading.cancellationtokensource.aspx)并使用它的关联[`CancellationToken`](http://msdn.microsoft.com/en-us/library/system.threading.cancellationtoken.aspx) 作为信号取消的手段。这是 .Net Framework v4 中的新功能。

这个概念是`CancellationTokenSource`简单地调用 Cancel 并且您的代码可以共享`CancellationToken`您定期检查其中的`IsCancellationRequested`属性的 s。在紧密循环或运行时间较长的操作中尤其如此，以便让您的代码及时停止。

`SemaphoreSlim`额外的好处是，即使由于等待 a而被阻塞的线程`ManualResetEventSlim`也可以发出信号以正常退出，因为这些类在 .Net Framework v4`CancellationToken`中的方法中接受 a`Wait`

例如看一下：[ManualResetEventSlim.Wait](http://msdn.microsoft.com/en-us/library/dd270618.aspx)，它有接受`CancellationToken`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T02:09:32.023

I'd prefer to use the `IsCancelled` property idea. Your background thread method can check it at the appropriate times, do any cleanup as needed, and terminate the operation. If you're using a callback method when the thread finishes, it's easy to check the property and see if it's valid or not. I've used framework worker thread classes that used this strategy in the past, and it's worked well.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T03:04:12.413

回到用例：你试图提供的行为是什么？如果您有要取消的异步操作，那么您可能最好实现一种方法，让您通过标志或信号量通知其他线程。发送信号是引起注意的好方法，尽管我没有研究过 C# 对信号的处理。如果您需要能够取消和撤消，命令模式就派上用场了。

# ruby - 如何在 Ruby 中将时间四舍五入到最接近的 15 分钟？

> ID：449271
> 
> 赞同：72
> 
> 时间：2009-01-16T01:59:33.993
> 
> 标签：ruby

有没有一种简单的方法可以将时间四舍五入到最接近的 15 分钟？

这就是我目前正在做的事情。有更简单的方法吗？

```
t = Time.new
rounded_t = Time.local(t.year, t.month, t.day, t.hour, t.min/15*15) 
```

* * *

## 回答 #1

> 赞同：137
> 
> 时间：2009-01-16T02:34:50.473

您说的是“向下取整”，所以我不确定您是否真的在寻找圆形或地板，但这是同时执行两者的代码。`round_off`如果你在 Time 类中添加和`floor`方法，我认为这样的内容非常好。额外的好处是您可以更轻松地按任何时间分区进行舍入。

```
require 'active_support/core_ext/numeric' # from gem 'activesupport'

class Time
  # Time#round already exists with different meaning in Ruby 1.9
  def round_off(seconds = 60)
    Time.at((self.to_f / seconds).round * seconds).utc
  end

  def floor(seconds = 60)
    Time.at((self.to_f / seconds).floor * seconds).utc
  end
end

t = Time.now                    # => Thu Jan 15 21:26:36 -0500 2009
t.round_off(15.minutes)         # => Thu Jan 15 21:30:00 -0500 2009
t.floor(15.minutes)             # => Thu Jan 15 21:15:00 -0500 2009 
```

**注意：** ActiveSupport 仅对 pretty`15.minutes`参数是必需的。如果您不想要这种依赖关系，请`15 * 60`改用。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-01-16T02:14:24.087

我对 ruby​​ 的语法不是很熟悉，但您可以使用模数向下舍*入*到最接近的 15 分钟。（即 x - (x 模 15)）。我猜语法会是这样的

```
t.min - ( t.min % 15) 
```

这将使您的可能值集为 0、15、30 和 45。假设 0 <= t.min <= 59。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2010-11-15T08:45:52.680

我想我会发布另一个解决方案，提供向上和向下舍入到给定的最接近的秒数。哦，这不会像其他一些解决方案那样改变时区。

```
class Time
  def round(sec=1)
    down = self - (self.to_i % sec)
    up = down + sec

    difference_down = self - down
    difference_up = up - self

    if (difference_down < difference_up)
      return down
    else
      return up
    end
  end
end

t = Time.now                             # => Mon Nov 15 10:18:29 +0200 2010
t.round(15.minutes)                      # => Mon Nov 15 10:15:00 +0200 2010
t.round(20.minutes)                      # => Mon Nov 15 10:20:00 +0200 2010
t.round(60.minutes)                      # => Mon Nov 15 10:00:00 +0200 2010 
```

在 x.minutes 功能的示例中使用了 ActiveSupport。您可以改用 15 * 60。

基于此解决方案可以轻松实现方法 floor 和 ceil。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2013-06-14T21:05:36.203

我找到了一个非常易读的解决方案；

这会将您的时间四舍五入到最后舍入的 15 分钟。您可以将 更改`15.minutes`为每个可能的时间刻度。

```
Time.at(Time.now.to_i - (Time.now.to_i % 15.minutes)) 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2015-05-07T16:54:32.630

我编写了[Rounding gem](https://github.com/brianhempel/rounding)来处理这些情况。

将时间四舍五入变得与调用时间一样简单`floor_to`。还支持四舍五入和四舍五入（`ceil_to`和`round_to`）。

```
require "rounding"

Time.current.floor_to(15.minutes) # => Thu, 07 May 2015 16:45:00 UTC +00:00
Time.current.ceil_to(15.minutes)  # => Thu, 07 May 2015 17:00:00 UTC +00:00
Time.current.round_to(15.minutes) # => Thu, 07 May 2015 16:45:00 UTC +00:00 
```

保留原始时间的时区（在这种情况下为 UTC）。您不需要加载 ActiveSupport——您可以编写`floor_to(15*60)`它，它会正常工作。gem 使用[有理数](http://ruby-doc.org/core-2.2.2/Rational.html)来避免舍入错误。您可以通过提供偏移量来四舍五入到最近的星期一`round_to(1.week, Time.parse("2015-5-4 00:00:00 UTC"))`。我们在生产中使用它。

我写了[一篇博文](http://collectiveidea.com/blog/archives/2015/05/01/better-ruby-rounding/)来解释更多。希望对您有所帮助。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-01-16T02:52:49.283

由于 Ruby 允许在 Times 上进行算术运算（以秒为单位），因此您可以这样做：

```
t = Time.new
rounded_t = t-t.sec-t.min%15*60 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2014-06-11T08:37:52.560

# 前言

这里有很多解决方案，我开始怀疑它们的效率（你的效率可能不是这个问题中最重要的方面）。我从这里拿了一些，扔了几个我自己的。（注意，尽管 OP 询问是否要四舍五入到最接近的 15 分钟，但为了更简单的样本，我只用 1 分钟/60 秒完成了比较和样本）。

# 设置

```
Benchmark.bmbm do |x|
  x.report("to_f, /, floor, * and Time.at") { 1_000_000.times { Time.at((Time.now.to_f / 60).floor * 60) } }
  x.report("to_i, /, * and Time.at") { 1_000_000.times { Time.at((Time.now.to_i / 60) * 60) } }
  x.report("to_i, %, - and Time.at") { 1_000_000.times { t = Time.now.to_i; Time.at(t - (t % 60)) } }
  x.report("to_i, %, seconds and -") { 1_000_000.times { t = Time.now; t - (t.to_i % 60).seconds } }
  x.report("to_i, % and -") { 1_000_000.times { t = Time.now; t - (t.to_i % 60) } }
end 
```

# 结果

```
Rehearsal -----------------------------------------------------------------
to_f, /, floor, * and Time.at   4.380000   0.010000   4.390000 (  4.393235)
to_i, /, * and Time.at          3.270000   0.010000   3.280000 (  3.277615)
to_i, %, - and Time.at          3.220000   0.020000   3.240000 (  3.233176)
to_i, %, seconds and -         10.860000   0.020000  10.880000 ( 10.893103)
to_i, % and -                   4.450000   0.010000   4.460000 (  4.460001)
------------------------------------------------------- total: 26.250000sec

                                    user     system      total        real
to_f, /, floor, * and Time.at   4.400000   0.020000   4.420000 (  4.419075)
to_i, /, * and Time.at          3.220000   0.000000   3.220000 (  3.226546)
to_i, %, - and Time.at          3.270000   0.020000   3.290000 (  3.275769)
to_i, %, seconds and -         10.910000   0.010000  10.920000 ( 10.924287)
to_i, % and -                   4.500000   0.010000   4.510000 (  4.513809) 
```

* * *

# 分析结果

该怎么做？好吧，事情可能在您的硬件上运行得更快或更慢，所以不要相信我的电脑。如您所见，另一件事是，除非我们以数百万次操作的规模进行这些操作，否则就处理能力而言，您使用哪种方法不会有太大的不同（不过，请注意，例如，大多数云计算解决方案提供非常少的处理能力，因此在这种环境中可能有数百或数万）。

## 最慢，但可能是最易读的解决方案

从这个意义上说，使用其中最慢的显然`t = Time.now; t - (t.to_i % 60).seconds`是合理的，因为 .seconds 在那里非常酷。

## 不是那么慢，几乎是可读的解决方案

但是，由于实际上根本不需要它，并且操作成本是没有它的两倍，所以我不得不说我的选择是`t = Time.now; t - (t.to_i % 60)`. 在我看来，它比这里介绍的任何其他解决方案都足够快，并且可读性高一百万倍。这就是为什么我认为它是满足您休闲地板需求的最佳解决方案的原因，尽管它比其他三个要慢得多。

## 尴尬，不是特别慢或特别快

此页面上投票最多的解决方案是此页面`Time.at((Time.now.to_f / 60).floor * 60)`上所有解决方案中最慢的（在此答案之前），并且明显慢于前 2 个解决方案。使用浮点数只是为了能够消除小数点似乎也很不合逻辑。对于四舍五入的部分可以，但对我来说，四舍五入听起来像是“地板”。如果有什么对应的可能是四舍五入或“天花板”，这将是类似的东西`t = Time.now; t - (60 - t.to_i % 60) % 60`or `Time.at((Time.now.to_f / 60).ceil * 60)`。to_i 解决方案在这里需要的双模看起来有点讨厌，所以即使它明显更快，在这里我更喜欢 ceil 方法。（基准附加在这篇文章的最后）

## 对于那些需要速度的人

并列（差异是如此微不足道，以至于您无法真正宣布获胜者）在测试中排名前两位，其中两个 to_i 变体使用略有不同的操作组合，然后将整数转换回 Time 对象。如果你赶时间，这些是你应该使用的：

```
Time.at((Time.now.to_i / 60) * 60) 
t = Time.now.to_i; Time.at(t - (t % 60)) 
```

* * *

### 四舍五入/ ceil 基准的设置

```
Benchmark.bmbm do |x|
  x.report("to_f, /, ceil, * and Time.at") { 1_000_000.times { Time.at((Time.now.to_f / 60).ceil * 60) } }
  x.report("to_i, %, -, %, + and Time.at") { 1_000_000.times { t = Time.now; t + (60 - t.to_i % 60) % 60 } }
end 
```

### 四舍五入/ ceil 基准的结果

```
Rehearsal ----------------------------------------------------------------
to_f, /, ceil, * and Time.at   4.410000   0.040000   4.450000 (  4.446320)
to_i, %, -, %, + and Time.at   3.910000   0.020000   3.930000 (  3.939048)
------------------------------------------------------- total: 8.380000sec

                                   user     system      total        real
to_f, /, ceil, * and Time.at   4.420000   0.030000   4.450000 (  4.454173)
to_i, %, -, %, + and Time.at   3.860000   0.010000   3.870000 (  3.884866) 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-01-16T02:12:42.843

你可以这样做：

```
Time.at(t.to_i/(15*60)*(15*60)) 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2010-04-13T22:36:06.543

```
# this is an extension of Ryan McGeary's solution, specifically for Rails.
# Note the use of utc, which is necessary to keep Rails time zone stuff happy.
# put this in config/initializers/time_extensions

require 'rubygems'
require 'active_support'

module TimeExtensions
  %w[ round floor ceil ].each do |_method|
    define_method _method do |*args|
      seconds = args.first || 60
      Time.at((self.to_f / seconds).send(_method) * seconds).utc
    end
  end
end

Time.send :include, TimeExtensions 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2011-01-31T21:25:57.933

Chuck 的回答虽然优雅，但如果您尝试比较以这种方式得出的值，则会给您带来麻烦；usecs 没有清零。

Shalmanese 的回答会解决这个问题，或者 Chuck 的回答可以修改为：

```
t = Time.new
truncated_t = Time.at(t.to_i - t.sec - t.min % 15 * 60) 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2014-09-30T01:39:13.643

Ryan McGeary 的解决方案不适用于半小时以外的时区。例如，加德满都是 +5:45，所以四舍五入到 30.minutes 得到了错误的结果。这应该有效：

```
class ActiveSupport::TimeWithZone
  def floor(seconds = 60)
    return self if seconds.zero?
    Time.at(((self - self.utc_offset).to_f / seconds).floor * seconds).in_time_zone + self.utc_offset
  end

  def ceil(seconds = 60)
    return self if seconds.zero?
    Time.at(((self - self.utc_offset).to_f / seconds).ceil * seconds).in_time_zone + self.utc_offset
  end

  # returns whichever (out of #floor and #ceil) is closer to the current time
  def closest(seconds = 60)
    down, up = floor(seconds), ceil(seconds)
    ((self - down).abs > (self - up).abs) ? up : down
  end
end 
```

和测试：

```
class TimeHelperTest < ActionDispatch::IntegrationTest
  test "floor" do
    t = Time.now.change(min: 14)
    assert_equal Time.now.change(min: 10), t.floor(5.minutes)
    assert_equal Time.now.change(min: 0), t.floor(30.minutes)
  end

  test "ceil" do
    t = Time.now.change(min: 16)
    assert_equal Time.now.change(min: 20), t.ceil(5.minutes)
    assert_equal Time.now.change(min: 30), t.ceil(30.minutes)
  end

  test "closest" do
    t = Time.now.change(min: 18)
    assert_equal Time.now.change(min: 20), t.closest(5.minutes)
    assert_equal Time.now.change(min: 30), t.closest(30.minutes)
    assert_equal Time.now.change(min: 0), t.closest(60.minutes)
  end

  test "works in time zones that are off the half hour" do
    Time.zone = "Kathmandu"
#2.1.0p0 :028 > Time.zone.now
# => Tue, 30 Sep 2014 06:46:12 NPT +05:45 # doing .round(30.minutes) here would give 06:45 under the old method

    t = Time.zone.now.change(min: 30)
    assert_equal Time.zone.now.change(min: 30), t.closest(30.minutes)

    t = Time.zone.now.change(min: 0)
    assert_equal Time.zone.now.change(min: 0), t.closest(30.minutes)
  end
end 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-16T02:24:33.147

您当前的评估使用

```
min / 15 * 15 
```

只是截断最小值，所以

```
15 => 15
16 => 15
..
29 => 15
30 => 30 
```

这不是“四舍五入”。

你可以用一种不好的方式近似舍入

```
(( min + 7.5 ) / 15).to_i * 15 
```

或者，使用内部：

```
( min.to_f / 15 ).round * 15 
```

# if-statement - 为什么是 switch 语句而不是 if-else？

> ID：449273
> 
> 赞同：62
> 
> 时间：2009-01-16T02:03:09.867
> 
> 标签：if-statement, language-agnostic, switch-statement

我一直在想这个有一段时间了。到目前为止，我还不是一个铁杆程序员，主要是小型 Python 脚本，并且我已经编写了几个分子动力学模拟。对于真正的问题：***switch 语句***的意义何在？为什么不能只使用***if-else 语句***？

感谢您的回答，如果之前有人问过这个问题，请指向链接。

**编辑**

[S.Lott](https://stackoverflow.com/users/10661/s-lott)指出这可能是[If/Else vs. Switch](https://stackoverflow.com/questions/395618/if-else-vs-switch)问题的重复。如果你想关闭，那么就这样做。我将保留它以供进一步讨论。

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-01-16T02:15:33.993

*switch*结构更容易转换为[跳转（或分支）表](http://en.wikipedia.org/wiki/Jump_table)。当 case 标签靠近时，这可以使 switch 语句比*if-else更有效。*这个想法是在内存中顺序放置一堆跳转指令，然后将值添加到程序计数器中。这用加法操作替换了一系列比较指令。

下面是一些极其简化的伪组装示例。首先，if-else 版本：

```
 // C version
    if (1 == value)
        function1();
    else if (2 == value)
        function2();
    else if (3 == value)
        function3();

    // assembly version
    compare value, 1
    jump if zero label1
    compare value, 2
    jump if zero label2
    compare value, 3
    jump if zero label3
label1:
    call function1
label2:
    call function2
label3:
    call function3 
```

接下来是switch版本：

```
 // C version
    switch (value) {
    case 1: function1(); break;
    case 2: function2(); break;
    case 3: function3(); break;
    }

    // assembly version
    add program_counter, value
    call function1
    call function2
    call function3 
```

您可以看到生成的汇编代码更加紧凑。请注意，需要以某种方式转换该值以处理 1、2 和 3 以外的其他值。但是，这应该说明这个概念。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-01-16T02:05:19.817

Switch 可以[通过编译](http://www.gccsummit.org/2006/view_abstract.php?content_key=18)r 来优化——你会得到更快的代码。
此外，我发现它在处理可枚举类型时更加优雅。

总而言之*switch*语句给你**性能**+**代码优雅**:)

以下是一些有用的链接：

*   [C#中switch与if/else的速度比较](http://www.blackwasp.co.uk/SpeedTestIfElseSwitch.aspx)
*   [反馈引导的 switch 语句优化](http://www.cs.ualberta.ca/~amaral/cascon/CDP04/slides/zhao.pdf.)（pdf 描述 switch 语句优化）

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-16T02:06:40.920

为了表现力，switch/case 语句允许您将多个案例组合在一起，例如：

```
case 1,2,3: do(this); break;
case 4,5,6: do(that); break; 
```

为了性能，编译器有时可以将 switch 语句优化为跳转表。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-16T02:45:58.987

我忽略了这种类型的低级优化通常不重要，并且可能因编译器而异。

我想说主要的区别是可读性。if/else 非常灵活，但是当您看到一个开关时，您会立即知道所有测试都针对同一个表达式。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-16T02:15:25.677

除了 .NET 中提到的其他代码可读性和优化之外，您还可以打开枚举等

```
enum Color { Red, Green, Blue }; 

Color c = Color.Red;

switch (c) // Switch on the enum

{

// no casting and no need to understand what int value it is

case Color.Red:    break;
case Color.Green:  break;
case Color.Blue:   break;

} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-16T02:15:59.717

处理几种情况的能力（故意省略 break 语句）可能很有用，而且正如一些人已经说过的那样，它也更快。不过，也许最重要和最不重要的考虑因素是，它只会使代码比 if/else 更漂亮。:)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-16T02:10:07.433

某些编译器可以“更好”地优化 Switch。在某些语言中使用 switch 语句存在缺陷。在 Java 中，switch 不能处理字符串，而在 VB2005 中，switch 语句不能与单选按钮一起使用。
Switch 可以更快更容易阅读，If-Then 更通用，可以在更多地方使用。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-03-29T22:15:11.743

唯一可以更快的时间切换是当您的案例值是常量，不是动态的或以其他方式派生的，并且当案例的数量明显大于将哈希计算到查找表中的时间时。

以 Javascript 为例，它编译为程序集以在大多数引擎（包括 Chrome 的 V8 引擎）上执行，在常见情况下 switch 语句的执行速度要慢 30%-60%：http: [//jsperf.com/switch-if -否则/20](http://jsperf.com/switch-if-else/20)

# css - CSS 复制粘贴问题

> ID：449280
> 
> 赞同：0
> 
> 时间：2009-01-16T02:05:45.523
> 
> 标签：css, email

我在我的应用程序中开发了一个系统，其中使用正则表达式接收电子邮件，然后在源中反转（以阻止机器人）。然后我添加跨度类“混淆电子邮件”。然后，我使用 CSS 将要显示的文本反转回来，并使用 Javascript 确保`mailto:`链接仍然有效。

我对我的解决方案非常满意，直到我意识到复制和粘贴电子邮件会将其向后放入剪贴板。我想知道是否有任何方法可以解决这个问题？我一直在 Firefox 3 for OS X 中进行测试。

相关页面可在此处找到：http: [//www.leaklocations.com.au/contact-us/](http://www.leaklocations.com.au/contact-us/)

要查看问题，只需将电子邮件复制并粘贴到该站点上即可。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T02:16:30.777

您可以使用相同的 Javascript 来反转文本以及 mailto 链接。如果用户没有 Javascript，那么您可以解决这个问题或使用图像。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T02:53:37.910

说真的，是否值得付出所有这些努力来混淆电子邮件地址？一旦电子邮件落入垃圾邮件发送者的手中，一切就结束了。最好有一个好的垃圾邮件过滤器。

如果您再次使用 JavaScript 将电子邮件地址反转回来，您将在页面加载时为浏览器添加额外的工作。如果 JavaScript 被关闭或用户使用不支持 JavaScript 的移动设备，他们也会被搞砸。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T04:34:07.957

我个人认为它有点过头了，但如果你真的想混淆地址，为什么不以人类可读的方式混淆它呢？不是反转地址，而是让服务器输出“泄漏位置的信息 dot com dot au”并让 javascript 修复它？

如果您想坚持使用 RTL CSS 方法，您可以尝试使用 unicode 字符来反转文本：\u202E 我不确定这是否会有所帮助，但值得一看

要查看它是如何工作的，请运行以下 javascript：

```
alert("one \u202E two \u202E three") 
```

它会输出“one owt 3”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T03:32:51.510

为什么不使用来自 reCaptcha 人员的 MailHide 之类的东西[来](http://mailhide.recaptcha.net/)隐藏电子邮件地址呢？

# visual-studio - 自动同步 Visual Studio 的类视图

> ID：449302
> 
> 赞同：16
> 
> 时间：2009-01-16T02:20:13.623
> 
> 标签：visual-studio, ide, vs-classview

是否可以让 Visual Studio 的类视图窗格（在视图 > 类视图下可用）自动同步到当前符号？基本上只要当前符号发生变化，就执行 View.SynchronizeClassView。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-16T18:21:12.233

见[这里](https://stackoverflow.com/questions/546113/visual-studio-automatically-refresh-class-view-when-changing-class/734204#734204)和[这里](https://stackoverflow.com/questions/546113/visual-studio-automatically-refresh-class-view-when-changing-class/1003074#1003074)。我发现你的措辞更符合我的要求。不知道为什么你没有得到任何答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-02-07T13:09:04.777

看起来，不会实现自动同步（没有热键）。

[https://visualstudio.uservoice.com/forums/121579-visual-studio-ide/suggestions/15963322-sync-class-view-with-code](https://visualstudio.uservoice.com/forums/121579-visual-studio-ide/suggestions/15963322-sync-class-view-with-code)

> 我要亲自感谢您抽出宝贵时间分享此建议。由于您提出的建议没有获得太多投票，Visual Studio IDE 团队正在优先考虑其他建议并在此时关闭它。
> 
> 如果您希望我们重新考虑这一点，请创建一个新建议。再次感谢您与我们分享！

# xml - 将 XML 转换为 X12 和 X12 转换为 XML 的最佳方法

> ID：449312
> 
> 赞同：25
> 
> 时间：2009-01-16T02:26:42.923
> 
> 标签：xml, edi, x12

寻找将 XML 转换为 X12（270 - 医疗资格请求）然后将 X12 响应（271 - 资格响应）转换回 XML 的工具/库。这将嵌入到服务器应用程序中（将考虑任何目标语言）。我曾想过编写自己的 X12 解析器和生成器，但这个项目很可能会扩展到其他 X12 事务，我想找到一个可扩展的解决方案。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2013-07-18T16:32:05.993

我遇到了这个：OopFactory X12 Parser - [https://x12parser.codeplex.com/releases/view/106524](https://x12parser.codeplex.com/releases/view/106524)

极好的。源代码结构良好，一切都建立在第一次打开的基础上，甚至还有单元测试。

拉入我的项目，它转换了我尝试过的所有文件。

它包括一个可以工作的命令行 exe - 但作为一个 .Net 人，这个库确实令人印象深刻。

-更新-

简短的简短版本归结为如下内容：

```
var fstream = new FileStream(fileName, FileMode.Open, FileAccess.Read);
var parser = new X12Parser();
var interchange = parser.ParseMultiple(fstream).First();
var x12Xml = interchange.Serialize(); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-08-25T22:36:46.680

我最终创建了自己的 XML <-> x12 转换工具。我遇到了一些商业产品（其中一个来自[EtaSoft](http://www.etasoft.com/)，值得一试，因为他们的文档很好），但最终本土解决方案的优势太大了。

我确实使用了[X12::Parser](http://search.cpan.org/~prasad/X12-0.08/Readme.pod)中的配置文件作为 X12 解析器的基础，本质上将配置文件转换为代码，并消除了管理配置文件的开销和错误处理，这些配置文件在理论上几乎永远不会改变。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-08-21T23:49:25.563

我可以说你应该不惜一切代价避免的一种产品是 EcMap。我现在在 EDI 部门工作了大约一年的经验，我可以说我很少看到一个应用程序的界面设计得更差（也许 Lotus Notes 除外）、更混乱的用户文档和绝对荒谬的许可计划。它本质上是按 CPU 授权的（CPU 是指核心，所以如果你有一个新的四核 CPU，你真的会很兴奋），根据我听到的最后一个报价，每个许可证超过 10K。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-16T02:45:12.467

看看[pyx12](http://pyx12.sourceforge.net/)。

它包括 X12 到 XML 和 XML 到 X12 的脚本。

为什么是 Python？因为您经常需要自定义 X12 文档来处理付款人和提供者之间允许的变化。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-09-19T01:14:27.530

下面是使用[pyx12](https://github.com/azoner/pyx12)写入 XML 文件的示例

```
import pyx12.x12n_document
fd_source = "/path/to/edi/file"
output_file = "result.xml"
with open(output_file, 'w') as fd_xml:
    result = pyx12.x12n_document.x12n_document(param=param, src_file=fd_source,
                                               fd_997=None, fd_html=None, fd_xmldoc=fd_xml, xslt_files=None) 
```

# ruby-on-rails - RESTful 方式在 Rails 的表单中执行可降解的多个模型

> ID：449317
> 
> 赞同：1
> 
> 时间：2009-01-16T02:32:34.567
> 
> 标签：ruby-on-rails, forms, rest

到目前为止，我还没有找到能够允许表单与具有一对多关系的两个模型交互的解决方案。例如，客户有很多物品。

目前，我已经使用 Javascript 实现了解决方案，使用户能够在项目列表中添加/删除行。让我们保持简单，我们在这里创建新记录。

为了将其改进为可降解，我创建了一个提交不同值的“添加项目”按钮，因此在我的创建操作中，我能够捕获新属性并将新项目添加到客户对象。

但是，由于 item 是新的并且没有 id，我无法删除特定的 item。我曾考虑过使用索引并添加要删除的发布按钮/链接，但这种做法会让一切变得混乱，我不能将我的部分用于收藏。所以我觉得这是一个黑客；有更好的选择吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-12T05:25:56.130

您想使用accepts_nested_attributes_for。Railscasts 剧集 henrikloevborg 提到涵盖了一种已被 Accepts_nested_attributes_for 淘汰的方法。

您可以在没有 Accepts_nested_attributes_for 的情况下执行此操作。如果您不想升级到 Rails 2.3，这可能是必要的。

在您的 javascript 中删除一个项目，您应该在名为 _delete 的表单中添加一个隐藏字段，其值为 true。然后在你的控制器中。使用 _delete 字段忽略任何新记录，并销毁任何现有记录。

所有这些都内置于 accept_nested_attributes_for

使用[complex-forms-example](http://github.com/alloy/complex-form-examples) github 存储库中的代码。它本质上是来自 Railscast #75 的代码更新为使用更新的功能，accepts_nested_attributes_for。

您会注意到它不使用 RJS 来完成记录的动态添加/删除。此外，与您所做的相比，它在提交时创建，而不是在远程调用期间。项目的自动添加/删除使用 content_for 标记来处理，以创建存储在 javascript 函数中的模板，并使用 Prototype 库来修改隐藏字段，该隐藏字段接受_nested_attributes_for 用于销毁要删除的对象。

# c# - Stylecop tells me to add this keyword, but it's redundant - any performance implications?

> ID：449324
> 
> 赞同：5
> 
> 时间：2009-01-16T02:37:12.607
> 
> 标签：c#, .net, this

I use Stylecop for Resharper and whenever I call something in my class, Stylecop tells me to use the **this** keyword. But the IDE says this is redundant code (which it sure is), so why should I use the **this** keyword?

Does redundant code mean its not needed (obviously) and the compiler won't even do anything with the this keyword? So I assume the this keyword is just for clarity.

Also, with the CLR, do things like this fall consistently across languages? So if the answer is that the compiler doesn't even touch the **this** keyword and it is just for presentation and clarity, then the same is true for VB.NET? I assume it is all for clarity as stylecop keeps an eye on this and Fxcop (which I will use later on) keeps an eye on my code's quality from a technical point of view.

Thanks

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-16T02:42:18.307

It's for clarity and to prevent any ambiguity between a class member and a local variable or parameter with the same name.

The IL it compiles to will not be any different.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T02:44:22.903

大多数时候只是为了清楚起见，但有时它是必需的。

```
using System;

class Foo
{
    String bar;

    public Foo(String bar)
    {
        this.bar = bar;
    }
} 
```

在这里，您需要消除字段和构造函数参数`this`之间的歧义。显然，更改参数或字段的名称可以完成同样的事情。`bar``bar`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-16T08:10:44.023

在所有情况下，无论有没有性能差异`this`- 编译器仍然隐式执行它，将 a[`ldarg.0`](http://msdn.microsoft.com/en-us/library/system.reflection.emit.opcodes.ldarg_0.aspx)注入 IL。

为了完整起见，还有另一种**强制**使用`this`（不包括消歧、`ctor`-链接和传递`this`给其他方法）：扩展方法。要在当前实例上调用扩展方法，您*必须*符合条件`this`（即使对于常规方法它是隐式的）。

当然，在大多数情况下，您只需将常规实例方法添加到类或基类中......

```
class Foo {
    void Test() {
        this.Bar(); // fine
        Bar(); // compiler error
    }
}
static class FooExt {
    public static void Bar(this Foo foo) { }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T02:45:01.483

在 C# 中，这是对当前类实例的引用（在 VB.NET 中是我）。它通常用于完全限定班级成员。例如，考虑这个 C# 类：

```
public class MyClass
{
    int rate;

    private void testMethod()
    {
        int x;

        x = this.rate;
    }
} 
```

这在上面的代码中不是必需的，但在阅读速率属于类而不是方法的代码时会增加即时清晰度（搜索 SO，你会发现很多关于使用 this 的意见）。它的语义行为在 VB 中是相同的——并且它的使用不会造成性能损失。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T03:10:51.277

除了提供的清晰示例之外，“this”关键字的唯一其他有效用法是将对象的当前实例作为参数传递。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T03:55:39.860

这只是为了清楚起见，人们可以争论什么更好。Python 根本不支持省略“self”标识符。

> 此外，对于 CLR，这样的事情是否会始终如一地跨越语言？因此，如果答案是编译器甚至没有触及 this 关键字而只是为了表示和清晰，那么 VB.NET 也是如此吗？

在 JVM 中肯定（也对于 CLR，我几乎可以肯定）总是生成“this”关键字的代码，即使从源代码中省略了 - 所以就像总是添加 this 关键字一样。所以，我认为任何 .NET 编译器都不会产生不同的输出，因此不会有性能损失。

然后，这取决于语言。例如 JScript（甚至 JScript.NET）不允许像 Python 一样省略“this”，因为有函数（所以“this.a()”是方法调用，“a()”是函数调用） ，并且因为编译器不知道任何类型的成员 - 它们仅在运行时才知道（嗯，这确实不是一个不可能解决的问题，另一个问题更相关）。

# java - 使用 Active Objects ORM for Java 的经验？

> ID：449336
> 
> 赞同：13
> 
> 时间：2009-01-16T02:43:22.080
> 
> 标签：java, orm, activerecord, persistence, active-objects

我正在研究 Java 的 ORM，而[Active Objects](http://java.net/projects/activeobjects/pages/Home)引起了我的注意。显然，它[受到了 Rails 的 ActiveRecord 的启发](http://www.javalobby.org/articles/activeobjects/)。根据我所读到的内容，这种方法似乎通过采用约定优于配置来解决现有 Java ORM 的许多问题。

你有什么经验？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-19T20:30:29.353

小心不要陷入“银弹综合症”......我只是听到开发人员说“约定优于配置”并认为这是一件很棒的事情......

[Daniel Spiewak](http://www.codecommit.com/blog/)是一位可靠的程序员，我从他的博客中学到了很多东西，但这是一个相当简单的 API。这意味着，不要期望在生产使用、在高负载环境中工作等方面拥有大量经验。但有时，您所需要的只是简单的，而且还有其他项目，例如与 Active Objects 集成的[Databinder](http://databinder.net/)。（Wicket + Databinder 是一个非常不错的轻量级 Java 网络框架。）

但是，例如，如果我进行大量批处理，我会远离这样的持久性框架。主要是因为我想要：

1.  默认情况下不可变对象，自然会流入多线程处理，因为你强迫人们使用“删除/创建新”而不是“更新”类型的范例，这在许多数据库中节省了大量的磁盘使用量。
2.  考虑通过使用专门的命令来简化 IO 的数据库访问，例如`COPY`

我通过直接编写 SQL 代码解决了很多数据库性能问题，而不是使用不适合该任务的 ORM。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-01-21T08:46:53.700

免责声明：我是一个名为**ActiveJDBC**的项目的主要开发人员，该项目与 ActiveRecord 共享一些设计目标，并且正在积极开发中：

[http://javalite.io](http://javalite.io)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-06-09T05:26:54.947

Active Objects 目前正在积极开发中，部分原因是 Atlassian 将其作为可能的插件数据持久性引擎与其企业软件套件一起使用。

Active Objects 项目现在位于 [http://java.net/projects/activeobjects/pages/Home](http://java.net/projects/activeobjects/pages/Home)

[在https://studio.atlassian.com/browse/AO](https://studio.atlassian.com/browse/AO)跟踪使用 Active Objects 的 Atlassian 插件

特别要注意的是，Atlassian 刚刚开始构建 Active Objects Library 的文档，位于[https://developer.atlassian.com/display/AO/Active+Objects](https://developer.atlassian.com/display/AO/Active+Objects)

代码托管正在迁移到 BitBucket，SCM 从 svn 迁移到 mercurial。观看 bitbucket.org/activeobjects/ 了解这方面的进展。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-04-21T07:44:35.580

这里引用了来自 ActiveObjects-core 中的 why-another-orm.txt 的一些引用：ActiveObjects 从一开始就被设计为尽可能易于使用，并且配置最少......行业走向“约定优于配置”。...事实上，ActiveObjects 努力成为一个简单易用的持久性框架，以至于一些功能（如分布式事务）被简单地省略了。这背后的原因是 99% 的用例不需要这种极端措施。如果您的项目在 ORM 中确实需要如此复杂的行为，那么您应该使用 Hibernate。就这么简单。 **ActiveObjects 并非旨在取代 Hibernate。** 相反，它的目标是为许多不需要 Hibernate 强大功能的常见场景提供更简单、更轻便的替代方案。简而言之，ActiveObjects 试图让数据库开发再次变得简单而有趣。

考虑像 Atlassian 这样的公司在 JIRA 中使用 ActiveObjects。

下面是一个使用 ActiveObjects 的例子：

存储库：

[https://maven2-repository.dev.java.net/](https://maven2-repository.dev.java.net/)

使用以下依赖项：

```
 <dependency>
      <groupId>net.java.dev.activeobjects</groupId>
      <artifactId>activeobjects</artifactId>
      <version>0.8.2</version>
  </dependency> 
```

创建以下文件：

实体.java

```
 import net.java.ao.RawEntity;
    import net.java.ao.schema.AutoIncrement;
    import net.java.ao.schema.NotNull;
    import net.java.ao.schema.PrimaryKey;

    public interface Entity extends RawEntity<Integer>{

        @AutoIncrement
        @NotNull
        @PrimaryKey("id")
        Integer getExportId();
    } 
```

TestAO.java

```
 import net.java.ao.Preload;
    import java.sql.Timestamp;

    @Preload
    public interface TestAO extends Entity {

        String getFirstName();
        void setFirstName(String firstName);

        String getLastName();
        void setLastName(String lastName);

        Timestamp getUpdateTimestamp();
        void setUpdateTimestamp(Timestamp updateTimestamp);
    } 
```

测试.java

```
 EntityManager entityManager = EntityManager("jdbc:mysql://localhost:3306/test","test","test");
    ao.migrate(TestAO.class);
    TestAO testAO = ao.create(TestAO.class);

    testAO.setFirstName("firstName");
    testAO.setLastName("lastName");
    testAO.save(); 
```

# postgresql - 如何使用从已知列表中随机选择的字符串更新表中的字段？

> ID：449337
> 
> 赞同：4
> 
> 时间：2009-01-16T02:43:32.873
> 
> 标签：postgresql, random, sql-update

我有一个名为“buildings”的表，其中包含一个名为“use”的 varchar(50) 字段。该表已经有几千条记录，但是“使用”值都是空的。我想用从字符串列表*（例如，仓库、办公室、市场、零售、车间）*中随机选择的值来更新这些表。我还想保留其中一些为空来模拟现实世界的使用。

如何使用从已知列表中随机选择的字符串更新表中的字段？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-16T06:00:01.137

这可能对您有用：

```
BEGIN;
UPDATE Buildings SET Use = (ARRAY['warehouse', 'office', 'market', 'retail', 'workshop', NULL])[floor(random() * 6.0) + 1];
COMMIT; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T02:52:54.353

这不是随机的，但这是一种很好且简单的方法，前提是您的 ID 分布非常均匀：

```
UPDATE Buildings SET Use = 'warehouse' WHERE ID % 6 = 0
UPDATE Buildings SET Use = 'office'    WHERE ID % 6 = 1
UPDATE Buildings SET Use = 'market'    WHERE ID % 6 = 2
UPDATE Buildings SET Use = 'retail'    WHERE ID % 6 = 3
UPDATE Buildings SET Use = 'workshop'  WHERE ID % 6 = 4
UPDATE Buildings SET Use = NULL        WHERE ID % 6 = 5 
```

这几乎肯定会比“随机”方法更容易和更快。再说一次，它可能不够随机。

# schema - 使用 ODBC 和 OleDB 访问模式的最有效方法

> ID：449340
> 
> 赞同：0
> 
> 时间：2009-01-16T02:44:32.513
> 
> 标签：schema, odbc, oledb

我正在使用 C# 制作 DAL 模板，我想知道使用 ODBC 和 OleDB 访问架构信息的最有效方法是什么。我需要列、列类型和主键信息。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T03:26:55.563

对于 OleDb，有一个 OleDbConnection.GetoleDbSchemaTable() 方法。我已经将它与 Access 一起使用。

我在 GitHub 上的代码中有一个示例： [SchemaValidator.cs](http://github.com/rally25rs/storm/blob/053947d25ab5d789bf3f33302cf3e4aaf4ea08bf/StormOleDbSupport/DataBinders/OleDb/Validation/SchemaValidator.cs)

在 OdbcConnection IIRC 上也应该有一个 .Schema() 方法。

我注意到实际返回的值可能因数据库而异，因此您需要进行大量检查和调试以查看他返回的值可能是什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T02:52:09.520

使用 SQL Server 管理对象：

[http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.management.smo.aspx](http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.management.smo.aspx)

例如：

```
Microsoft.SqlServer.Management.Smo.Server s = new 
        Microsoft.SqlServer.Management.Smo.Server( @"DUFF\SQLEXPRESS" );

foreach ( Database db in s.Databases )
{
    if ( ! db.IsSystemObject )
    {
        listboxDatabase.Items.Add( db.Name );
    }
} 
```

从这里，您可以获取数据库中的表（和其他对象）。

# asp.net - ASP.NET DataList - 在重复水平和使用流布局时定义“列/行”

> ID：449344
> 
> 赞同：1
> 
> 时间：2009-01-16T02:47:35.160
> 
> 标签：asp.net, html, css, datalist

这是我的数据列表：

```
<asp:DataList id="DataList" Visible="false" RepeatDirection="Horizontal" Width="100%" HorizontalAlign="Justify" RepeatLayout="Flow" runat="server">
        [Contents Removed]
</asp:DataList> 
```

这会生成将每个项目包装在跨度中的标记。从那里，我想将这些跨度中的每一个分成三列的行。理想情况下，我想要这样的东西：

```
<div>
 <span>Item 1</span>
 <span>Item 2</span>
 <span>Item 3</span>
</div>
<div>
 <span>Item 4</span>
 <span>Item 5</span>
 <span>Item 6</span>
</div>
[etc] 
```

我能做到的最接近的是将RepeatColumns设置为“3”，然后`<br>`在DataList中的每三个项目之后插入一个。

```
 <span>Item 1</span>
 <span>Item 2</span>
 <span>Item 3</span>
<br>
 <span>Item 4</span>
 <span>Item 5</span>
 <span>Item 6</span>
<br> 
```

这让我*有点*接近，但真的没有办法 - 我仍然无法按照我想要的方式控制布局。

任何人都可以建议一种方法来改善它吗？如果我可以实现上面的例子——那将是完美的，但是我也会接受一个不太优雅的解决方案——只要它比`<br>`（例如插入 a`<span class="clear"></span>`而不是`<br>`）更灵活。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T03:41:19.873

如果您出于某种原因确实需要使用数据列表而不是将其实现为中继器，则可以尝试执行以下操作：

```
<asp:DataList ID="dataList" runat="server" RepeatDirection="Horizontal" Width="100%" HorizontalAlign="Justify" RepeatLayout="Flow" OnItemDataBound="dataList_ItemDataBound">
    <HeaderTemplate>
        <div>
    </HeaderTemplate>
    <SeparatorTemplate>
        </div><div>
    </SeparatorTemplate>
    <ItemTemplate>
        <%# Container.DataItem %></ItemTemplate>
    <FooterTemplate>
        </div></FooterTemplate>
</asp:DataList> 
```

* * *

```
protected void dataList_ItemDataBound(object sender, DataListItemEventArgs e) {
    if (e.Item.ItemType == ListItemType.Separator) {
        if ((e.Item.ItemIndex + 1) % 3 != 0) {
            e.Item.Controls.Clear();
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T03:26:01.277

我可能会感到困惑，但为什么不直接使用中继器和自定义项目模板呢？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T05:23:27.980

您可以使用 CSS 实现所需的布局，而无需更改原始生成的标记。由于 span 标签默认显示为内联，切换到 inline-block 并在这些 span 上指定 33% 的宽度应该可以解决问题。

或者更具体地说，将 DataList 控件的 CssClass 属性设置为诸如“threecolumns”之类的值。

定义以下 css 样式：

```
<style type="text/css">
.threecolumns span 
{
    display: inline-block;
    width: 33%;
}
</style> 
```

VS2008 可能会告诉您 inline-block 不是 display 属性的有效设置。我不会太担心，因为[几乎每个浏览器都支持它](http://www.quirksmode.org/css/display.html)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-25T01:18:21.493

添加这个 `RepeatColumns="100000"`

# mysql - MySQL AUTO_INCREMENT 不回滚

> ID：449346
> 
> 赞同：79
> 
> 时间：2009-01-16T02:49:44.330
> 
> 标签：mysql, transactions, innodb, auto-increment

我正在使用 MySQL 的 AUTO_INCREMENT 字段和 InnoDB 来支持事务。我注意到当我回滚事务时，AUTO_INCREMENT 字段没有回滚？我发现它是这样设计的，但是有什么解决方法吗？

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2009-01-16T03:11:10.493

它不能那样工作。考虑：

*   程序一，您打开一个事务并插入到一个具有 autoinc 主键的表 FOO 中（任意地，我们说它的键值是 557）。
*   程序二启动，它打开一个事务并插入到 FOO 表中，得到 558。
*   将两个插入编程到表 BAR 中，该表具有一列，该列是 FOO 的外键。所以现在 558 位于 FOO 和 BAR 中。
*   程序二现在提交。
*   程序 3 启动并从表 FOO 生成报告。打印 558 条记录。
*   之后，程序一回滚。

数据库如何回收 557 值？它是否进入 FOO 并减少所有其他大于 557 的主键？它如何修复 BAR？报告程序三输出上打印的558怎么擦除？

出于同样的原因，Oracle 的序列号也独立于事务。

如果你能在不断的时间内解决这个问题，我相信你可以在数据库领域赚到很多钱。

现在，如果您要求您的自动增量字段永远不会有间隙（例如，出于审计目的）。然后你不能回滚你的交易。相反，您需要在您的记录上有一个状态标志。在第一次插入时，记录的状态为“未完成”，然后您开始事务，完成您的工作并将状态更新为“竞争”（或您需要的任何内容）。然后，当您提交时，记录就会生效。如果事务回滚，不完整的记录仍然存在以供审计。这会给您带来许多其他麻烦，但这是处理审计跟踪的一种方法。

* * *

## 回答 #2

> 赞同：76
> 
> 时间：2009-01-16T03:12:34.657

让我指出一件非常重要的事情：

## 您永远不应该依赖自动生成的键的数字特征。

也就是说，除了比较它们是否相等 (=) 或不相等 (<>) 之外，您不应该做任何其他事情。没有关系运算符（<，>），没有按索引排序等。如果您需要按“添加日期”排序，请有一个“添加日期”列。

把它们当作苹果和橘子：问苹果是否和橘子一样有意义吗？是的。问一个苹果是否比一个橙子大有意义吗？不。（实际上，确实如此，但你明白我的意思。）

如果你坚持这条规则，自动生成索引的连续性差距不会导致问题。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2011-06-09T15:07:12.163

我有一个客户需要该 ID 才能在发票表上回滚，其中订单必须是连续的

我在 MySQL 中的解决方案是删除 AUTO-INCREMENT 并从表中提取最新的 Id，添加一个 (+1)，然后手动插入。

如果表名为“TableA”且自动增量列为“Id”

```
INSERT INTO TableA (Id, Col2, Col3, Col4, ...)
VALUES (
(SELECT Id FROM TableA t ORDER BY t.Id DESC LIMIT 1)+1,
Col2_Val, Col3_Val, Col4_Val, ...) 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-01-16T02:55:29.760

你为什么关心它是否被回滚？AUTO_INCREMENT 关键字段不应该有任何意义，所以你真的不应该关心使用什么值。

如果您有要保留的信息，则可能需要另一个非关键列。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-01-16T02:58:21.473

我不知道有什么方法可以做到这一点。根据[MySQL 文档](http://dev.mysql.com/doc/refman/5.1/en/innodb-auto-increment-handling.html)，这是预期的行为，并且会在所有*innodb_autoinc_lock_mode*锁定模式下发生。具体文字为：

> 在所有锁定模式（0、1 和 2）中，如果生成自增值的事务回滚，则这些自增值将“丢失”。一旦为自增列生成了一个值，它就不能回滚，无论“INSERT-like”语句是否完成，以及包含的事务是否回滚。这种丢失的值不会被重用。因此，存储在表的 AUTO_INCREMENT 列中的值可能存在间隙。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2012-02-16T14:14:22.213

如果您在回滚或删除后设置`auto_increment`为`1`，则在下一次插入时，MySQL 将看到该`1`值已被使用，而是获取该`MAX()`值并将其加 1。

这将确保如果具有最后一个值的行被删除（或插入回滚），它将被重用。

要将 auto_increment 设置为 1，请执行以下操作：

```
ALTER TABLE tbl auto_increment = 1 
```

这不像简单地继续下一个数字那样有效，因为`MAX()`可能会很昂贵，但是如果您不经常删除/回滚并且痴迷于重用最高值，那么这是一种现实的方法。

请注意，这并不能防止中间删除记录的间隙，或者在将 auto_increment 设置回 1 之前是否应该发生另一个插入。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-11-10T23:29:00.037

```
INSERT INTO prueba(id) 
VALUES (
(SELECT IFNULL( MAX( id ) , 0 )+1 FROM prueba target)) 
```

如果表不包含值或零行

在 SELECT 上添加错误 mysql 类型更新 FROM 的目标

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-09-01T15:48:42.180

对这个特定困境（我也有）的具体答案如下：

1) 创建一个表格，为不同的文件（发票、收据、RMA 等）保存不同的计数器；为每个文档插入一条记录，并将初始计数器添加到 0。

2) 在创建新文档之前，请执行以下操作（例如发票）：

```
UPDATE document_counters SET counter = LAST_INSERT_ID(counter + 1) where type = 'invoice' 
```

3) 获取您刚刚更新到的最后一个值，如下所示：

```
SELECT LAST_INSERT_ID() 
```

或者只是使用您的 PHP（或其他） mysql_insert_id() 函数来获得相同的东西

4) 插入您的新记录以及您刚刚从数据库返回的主 ID。这将覆盖当前的自动增量索引，并确保您的记录之间没有 ID 间隙。

当然，整个事情都需要包装在事务中。这种方法的美妙之处在于，当您回滚事务时，您在第 2 步中的 UPDATE 语句将被回滚，并且计数器将不再更改。其他并发事务将阻塞，直到第一个事务被提交或回滚，因此它们将无法访问旧计数器或新计数器，直到所有其他事务首先完成。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-11-18T21:45:01.773

解决方案：

让我们以 'tbl_test' 作为示例表，并假设字段 'Id' 具有 AUTO_INCREMENT 属性

```
CREATE TABLE tbl_test (
Id int NOT NULL AUTO_INCREMENT ,
Name varchar(255) NULL ,
PRIMARY KEY (`Id`)
)
; 
```

假设该表已经插入了数百或数千行，并且您不想再使用 AUTO_INCREMENT；因为当您回滚事务时，“Id”字段总是将 +1 添加到 AUTO_INCREMENT 值。因此，为避免这种情况，您可能会这样做：

*   让我们从“Id”列中删除 AUTO_INCREMENT 值（这不会删除您插入的行）：

```
ALTER TABLE tbl_test MODIFY COLUMN Id int(11) NOT NULL FIRST;
```

*   最后，我们创建一个 BEFORE INSERT 触发器来自动生成一个“Id”值。但是即使您回滚任何事务，使用这种方式也不会影响您的 Id 值。

```
创建触发器 trg_tbl_test_1
在插入 tbl_test 之前
每一行
  开始
    SET NEW.Id= COALESCE((SELECT MAX(Id) FROM tbl_test),0) + 1;
  结尾;
```

就是这样！你完成了！

> 别客气。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-16T03:08:43.150

如果您需要按数字顺序分配没有间隙的 id，那么您不能使用自动增量列。您需要定义一个标准整数列并使用一个存储过程来计算插入序列中的下一个数字并将记录插入事务中。如果插入失败，则下次调用该过程时，它将重新计算下一个 id。

话虽如此，依赖 id 以某种特定顺序排列而没有间隙是一个坏主意。如果您需要保留顺序，您可能应该在插入时为该行添加时间戳（并且可能在更新时）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-07-06T09:16:18.570

```
$masterConn = mysql_connect("localhost", "root", '');
mysql_select_db("sample", $masterConn);

for($i=1; $i<=10; $i++) {
    mysql_query("START TRANSACTION",$masterConn);
    $qry_insert = "INSERT INTO `customer` (id, `a`, `b`) VALUES (NULL, '$i', 'a')";
    mysql_query($qry_insert,$masterConn);
    if($i%2==1) mysql_query("COMMIT",$masterConn);
    else mysql_query("ROLLBACK",$masterConn);

    mysql_query("ALTER TABLE customer auto_increment = 1",$masterConn);

}

echo "Done"; 
```

# social - 程序员应该做公益工作吗？代码公设辩护人在哪里？

> ID：449348
> 
> 赞同：10
> 
> 时间：2009-01-16T02:51:38.350
> 
> 标签：social

人们根据 Bro Bono publico 的理想做多少项目，而不是为最高工资或现金买断发薪日的潜力而工作？

多年来，律师因高额账单利率和巨额结算交易而过度积累财富，将他们的知识和技能出租给出价最高的人而受到呼吁。人们呼吁他们免费做更多的事情，利用法律和他们的时间来捍卫或推进一些符合公众最大利益的事业。

专业软件开发有那么不同吗？这么多聪明的人，这么多复杂系统的知识。您认为现在有足够的“公益”运动来解决行业的社会和公共问题吗？如果是这样，要指出的例子是什么？OLPC？

**注意：**说开源软件与公益相同，完全没有抓住重点。我一直在寻找具有社会背景的特定项目，而不仅仅是免费软件的团体采购。仅仅因为您不让任何人为您的软件付费并不意味着它对任何人有任何好处。

我并不是要为程序员手动强制执行无偿工作，我只是想要一些客观的意见和具有社会意识的软件/技术开发项目的具体例子，比如每个孩子一台笔记本电脑项目。我敢肯定，对于某些人来说，开源将是一种自然的搭配。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-16T02:55:13.210

当然还有 Pro Bono 软件运动。它被称为开源。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T02:55:49.013

我们有很多开源项目，很多都是免费贡献的，任何人都可以使用。没有“开源”律师事务所太糟糕了；）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-16T02:56:32.363

当然。还有会计师、铁匠、教师、水管工和博彩公司。

如果您想做一些无偿工作，请继续。我经常这样做。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-16T03:28:04.250

如果您有兴趣无偿贡献一些代码，请访问[www.codegreenlabs.com](http://www.codegreenlabs.com/)查看 Agile Philanthropy 。我参加了 Agile 2008 的 Live Aid 活动——很有趣，我也学到了一些东西。Mano a Mano 项目的链接（其中一部分是在 Live Aid 开发的）看起来已断开；你可以在[这里](http://mano.codegreenlabs.com/)找到它。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-02-02T19:27:52.210

几个具体的例子：

*   [Taproot Foundation](http://www.taprootfoundation.org/) - 一家规模相当大的知名公益公司，接受软件开发人员和[其他专业人士](http://www.taprootfoundation.org/volunteering/consultant_roles.php)的帮助。
*   [The Nerdery Overnight Website Challenge](http://www.overnightwebsitechallenge.com/) - Nerdery 将志愿者开发团队与非营利组织相匹配，并挑战他们在 24 小时内（一次）开发一个完整的网站。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T03:10:27.720

在有一个一致的管理机构（如 Bar）之前，不会有诱导性公益计划。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2013-07-31T19:09:03.187

开源项目不同于向非营利组织免费提供闭源项目的软件开发公司或个人。

您也可以通过现金以外的方式获得补偿。然而，这仍然被认为是无偿的吗？

# xml - 在 Flex 中执行 XML 转换

> ID：449367
> 
> 赞同：2
> 
> 时间：2009-01-16T03:00:34.713
> 
> 标签：xml, apache-flex, xslt, air

我希望能够在我的 AIR 项目中使用 xslt 文件运行 xml 转换。实现这一目标的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-24T12:59:13.537

在 AIR 1.5 中，包含了一个支持 XSLT 的 Webkit 版本。

`XSLTProcessor`就像在 Firefox 中一样使用 JavaScript 中的类。（注意：有一个烦人的错误。样式表不能包含不间断的空格，无论是字面意思还是作为字符引用。有人告诉我，最新版本的 Webkit 将解决这个问题。）

下面是一个完整的例子。

创建文件`test.html`

```
<html>
  <head>
    <title>XSLT test</title>
    <script type="text/javascript">
      // <!--
      function test() {

        // Step 1: Parse the stylesheet
        var stylesheet
          = "<xsl:transform xmlns:xsl='http://www.w3.org/1999/XSL/Transform'"
          + "               version='1.0'>"
          + "  <xsl:template match='/'>"
          + "    Hello World from XSLT!"
          + "  </xsl:template>"
          + "</xsl:transform>";
        var stylesheetDocument
          = new DOMParser().parseFromString(stylesheet, "application/xml");

        // Step 2: Parse the source document
        var source = "<dummy/>";
        var sourceDocument
          = new DOMParser().parseFromString(source, "application/xml");

        // Step 3: Perform the XSL transformation
        var xslt = new XSLTProcessor();
        xslt.importStylesheet(stylesheetDocument);
        var newFragment = xslt.transformToFragment(sourceDocument, document);

        // Step 4: Show the result
        document.body.appendChild(newFragment.firstChild);
      }
      // -->
    </script>
  </head>
  <body>
    <input type="submit" onclick="test()">
    Output:
  </body>
</html> 
```

和一个文件`test.xml`

```
<application xmlns="http://ns.adobe.com/air/application/1.0">
  <id>test</id>
  <filename>test</filename>
  <initialWindow>
    <content>test.html</content>
    <visible>true</visible>
  </initialWindow>
</application> 
```

您可以使用调试运行时进行尝试，例如：

```
adl test.xml 
```

点击按钮，它会说：

[![例子](https://i.stack.imgur.com/LPdmb.png)](https://i.stack.imgur.com/LPdmb.png)
[（来源：[lichteblau.com](http://www.lichteblau.com/tmp/stackoverflow-xslt.png)）]

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-22T05:29:25.957

XSLT 支持通常由浏览器提供。AIR 中嵌入的 Webkit 版本不支持 XSLT。所以，你必须自己做这一切。我发现[这个](http://code.google.com/p/xpath-as3/wiki/GettingStarted)项目可以让您在 AS3 中使用 XPath 查询。现在，您必须自己完成模板解析和节点创建。

# apache-flex - 使用 Adob e AIR 从本地文件播放视频

> ID：449369
> 
> 赞同：4
> 
> 时间：2009-01-16T03:02:05.567
> 
> 标签：apache-flex, flash, actionscript, air

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-16T06:03:26.793

我想到的用途需要在使用中是程序化的。我正在寻找一种直接使用 ActionScript 执行此操作的方法。

我终于偶然发现了我希望的解决方案......使用 NetStream 对象，但是（非直观地）您也可以使用它来访问本地文件：

```
private function playVideo():void {
  var nc:NetConnection = new NetConnection();
  nc.connect(null);

  var ns:NetStream = new NetStream(nc);

  # onMetaData listener is required otherwise you get a ReferenceError
  var client:Object = new Object();
  client.onMetaData = function(metadata:Object):void {
    trace(metadata.duration);
  }
  ns.client = client;

  var v:Video = new Video();
  v.attachNetStream(ns);
  stage.addChild(v);

  var f:File = new File("/tmp/test.flv");
  ns.play(f.url);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T04:57:20.030

# asp.net - 如何防止未经授权的爬虫

> ID：449376
> 
> 赞同：8
> 
> 时间：2009-01-16T03:06:04.030
> 
> 标签：asp.net, iis

我想防止从我们的网站之一自动抓取 html，同时不影响合法的爬虫（googlebot 等）。是否有已经存在的东西来实现这一点？我什至使用了正确的术语吗？

编辑：我主要是想阻止那些恶意这样做的人。即他们不会遵守 robots.txt

EDIT2：如果检测到自动化并且流量不是来自合法（谷歌，雅虎，msn等）IP，那么阻止“使用率”的使用怎么样......即验证码继续浏览。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-16T03:10:23.227

这即使不是不可能也很难实现。许多“流氓”蜘蛛/爬虫不通过用户代理字符串来识别自己，因此很难识别它们。您可以尝试通过他们的 IP 地址阻止他们，但很难跟上将新 IP 地址添加到您的阻止列表中。如果使用 IP 地址，也可以阻止合法用户，因为代理使许多不同的客户端显示为单个 IP 地址。

在这种情况下使用 robots.txt 的问题是蜘蛛只能选择忽略它。

**编辑：**速率限制是一种可能性，但它遇到了识别（和跟踪）“好”和“坏”用户代理/IP 的一些相同问题。在我们编写的用于进行一些内部页面查看/会话计数的系统中，我们根据页面查看率消除会话，但我们也不担心消除“好”蜘蛛，因为我们也不希望它们计入数据中。我们不会阻止任何客户实际查看页面。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-16T03:35:54.500

一种方法是设置一个 HTTP tar 坑；嵌入仅对自动爬虫可见的链接。该链接应该转到一个包含随机文本和自身链接的页面（但带有附加页面信息： /tarpit/foo.html 、 /tarpit/bar.html 、 /tarpit/baz.html - 但脚本位于 /tarpit / 处理结果为 200 的所有请求）。

如果用户代理是 google 或 yahoo，为了让好人远离坑，请生成一个 302 重定向到您的主页。

它并不完美，但至少会减慢幼稚的速度。

**编辑：**正如康斯坦丁所建议的，您可以在 robots.txt 中将焦油坑标记为禁区。使用遵守此协议的网络蜘蛛的好人将远离焦油坑。这可能会摆脱为已知的好人生成重定向的要求。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-19T17:35:24.107

如果您想保护自己免受通用爬虫的侵害，请使用蜜罐。

例如，参见[http://www.sqlite.org/cvstrac/honeypot](http://www.sqlite.org/cvstrac/honeypot)。好的蜘蛛不会打开这个页面，因为站点的[robots.txt](http://www.sqlite.org/robots.txt)明确禁止它。人类可以打开它，但不应该点击“我是蜘蛛”链接。坏蜘蛛肯定会跟随这两个链接，因此会背叛它的真实身份。

如果爬虫是专门为您的站点创建的，您可以（理论上）创建一个移动蜜罐。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-12-22T04:40:55.003

我一般同意蜜罐方法。但是，我将蜜罐页面/资源的唯一链接放在被“/robots.txt”阻止的页面上 - 以及被此类阻止的蜜罐。这样，恶意机器人必须两次违反“禁止”规则才能禁止自己。手动点击不可点击链接的典型用户可能只执行一次此操作，并且可能找不到包含蜜罐 URL 的页面。

蜜罐资源将恶意客户端的违规 IP 地址记录到一个文件中，该文件用作 Web 服务器配置中其他地方的 IP 禁止列表。这样，一旦列出，Web 服务器就会阻止该客户端 IP 地址的所有进一步访问，直到列表被清除。其他人可能会有某种自动过期，但我只相信从禁止列表中手动删除。

另外：我也对垃圾邮件和我的邮件服务器做同样的事情：在我清除日志文件之前，将垃圾邮件作为第一条消息发送给我的站点将被禁止发送任何进一步的消息。虽然我在应用程序级别实现了这些禁止列表，但我也有防火墙级别的动态禁止列表。我的邮件和网络服务器也在它们之间共享被禁止的 IP 信息。对于一个不成熟的垃圾邮件发送者，我认为同一个 IP 地址可能同时托管恶意蜘蛛和垃圾邮件发送者。当然，那是在 BotNet 之前，但我从未将其删除。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-16T03:11:57.700

robots.txt 仅在蜘蛛尊重它时才有效。您可以创建一个 HttpModule 来过滤掉您不想抓取您的网站的蜘蛛。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T03:18:23.850

当它们检测到恶意使用时，你应该做好的防火墙所做的事情——让它们继续运行，但不要给它们任何其他东西。如果您开始抛出 403 或 404，他们就会知道有问题。如果您返回随机数据，他们将继续他们的业务。

不过，为了检测恶意使用，请尝试在搜索结果页面（或他们用作站点地图的页面）上添加陷阱链接并使用 CSS 隐藏它。需要检查他们是否声称自己是有效的机器人并让他们通过。您可以存储他们的 IP 以供将来使用和快速[ARIN WHOIS](http://www.arin.net/whois/)搜索。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-03-02T11:52:11.723

1 安装 iptables 和 tcpdump（适用于 linux） 2 检测和自动化良好的流量，例如 perl 中的 googlebot

```
$auth="no";
 $host=`host $ip`;
 if ($host=~/.googlebot.com\.$/){$auth="si";}
 if ($host=~/.google.com\.$/){$auth="si";}
 if ($host=~/.yandex.com\.$/){$auth="si";}
 if ($host=~/.aspiegel.com\.$/){$auth="si";}
 if ($host=~/.msn.com\.$/){$auth="si";} 
```

注意：宿主googlebot是55.66.249.66.in-addr.arpa域名指针crawl-66-249-66-55.googlebot.com。

3 创建计划或服务捕获流量并按主机计数数据包并插入数据库或在您的站点中插入 sql 查询插入 ip 以计算 ip 流量，例如在 perl

```
$ip="$ENV{'REMOTE_ADDR'}";
    use DBI;
    if ($ip !~/^66\.249\./){
    my $dbh = DBI->connect('DBI:mysql:database:localhost','user','password') or die print "non connesso:";
    my $sth = $dbh->prepare("UPDATE `ip` SET totale=totale+1, oggi=oggi+1, dataUltimo=NOW() WHERE ip ='$ip'");
          $sth ->execute;
          $rv = $sth->rows;
          if ($rv < 1){
          my $sth = $dbh->prepare("INSERT INTO `ip` VALUES (NULL, '$ip', 'host', '1', '1', 'no', 'no', 'no', NOW(), 'inelenco.com', oggi+1)");
          $sth ->execute;
          }
    $dbh->disconnect();
    } 
```

或者通过服务嗅探流量，例如在 perl

```
$tout=10;
    $totpk=3000;
        $tr= `timeout $tout tcpdump port $porta -nn -c $totpk`;
        @trSplit=split(/\n/,$tr);
        undef %contaUltimo;
        foreach $trSplit (@trSplit){
        if ($trSplit=~/IP (.+?)\.(.+?)\.(.+?)\.(.+?)\.(.+?) > (.+?)\.(.*?)\.(.+?)\.(.+?)\.(.+?): Flags/){

        $ipA="$1.$2.$3.$4";
        $ipB="$6.$7.$8.$9";
        if ($ipA eq "<SERVER_IP>"){$ipA="127.0.0.1";}
        if ($ipB eq "<SERVER_IP>"){$ipB="127.0.0.1";}
        $conta{$ipA}++;
        $conta{$ipB}++;
        } 
```

4 如果流量 > $max_traffic 则阻止主机，例如在 perl 中

```
if ($conta->{$ip} > $maxxDay){block($conta->{$ip});}
sub block{
my $ipX=shift;
if ($ipX =~/\:/){
   $tr= `ip6tables -A INPUT -s $ipX -j DROP`;
   $tr= `ip6tables -A OUTPUT -s $ipX -j DROP`;
   print "Ipv6  $ipX blocked\n";
   print $tr."\n";
   }
   else{
   $tr= `iptables -A INPUT -s $ipX -j DROP`;
   $tr= `iptables -A OUTPUT -s $ipX -j DROP`;
   print "iptables -A INPUT -s $ipX -j DROP";
   print "Ipv4  $ipX blocked\n";
   print $tr."\n";
   }
} 
```

另一种方法是读取日志流量服务器。例如在 linux /var/log/apache2/*error.log 包含所有查询错误 /var/log/apache2/*access.log 包含所有网络流量创建一个 Bash 脚本读取日志并阻止坏蜘蛛。对于块攻击读取所有日志，例如对于块 ssh 攻击读取日志 ssh 错误和块 ip。iptables -A INPUT -s $ip -j DROP

# delphi - 是否可以为 Delphi 的调试器编写扩展？

> ID：449401
> 
> 赞同：40
> 
> 时间：2009-01-16T03:26:21.633
> 
> 标签：delphi, debugging

我知道有一个用于创建 Delphi 扩展的 API。我经常使用 GExperts 包和各种 JVCL 专家。但我从未见过调试器的任何扩展。例如，能够为各种对象注册查看器，而不必在 Inspector 中检查它们，这将是非常好的。（例如，带有显示 TImage 的图像控件或显示数据集内容的网格的表单。）

是否有任何 API 允许您以这种方式扩展 Delphi 的调试器？

编辑：当我写这个问题时，这不可用，但 Delphi 2010 提供了一种方法来做到这一点。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-17T14:37:41.897

在 ToolsAPI.pas 源代码中有一些用于调试的 API 接口。使用此 API 可以通知您何时发生调试事件、有关断点的信息、正在调试的进程等。但似乎不支持变量或它们的值。因此，没有丑陋的黑客，就没有简单的方法来实施您的申请。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-25T21:36:58.487

可以使用 OTA 公开的评估接口来实现基本的调试器可视化器。（可以在[此处](http://www.delphipraxis.net/post636158.html#636158)和[此处](http://www.dewresearch.com/DebuggerVisualizer.html)找到调试器可视化工具的示例。）

更深入地集成到调试器中也是可能的（例如，我为 C++Builder 编写了一个小扩展，使调试器能够评估接口背后的实际对象） - 但正如 Khan 指出的那样，要达到这样一个级别集成，你需要诉诸一些肮脏的技巧。

# asp.net-mvc - How many users is too much when using session variables?

> ID：449404
> 
> 赞同：3
> 
> 时间：2009-01-16T03:26:57.840
> 
> 标签：asp.net-mvc, iis, session-variables

I'm currently using session variables as a cache to cut down the calls to the database.

I'm wondering at about how many concurrent users does this stop working at? 1,000, 10,000 ....100,000??? Also will iis start flaking out at a certain load? And are there any alternatives?

I know it depends on how much data I'm storing per user, but I want to hear from other peoples experiences.

I do have it setup so that when the code tries to access a timed out session that it reloads from the database.

I'm currently using iis6 but I could easily use iis7 if it handles sessions better.

**Edit:** Yes I'm using application variables for non user specific data.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T03:44:05.640

If this is of any concern to you, use a [State Server or the SQL Storage](http://msdn.microsoft.com/en-us/library/ms178586.aspx) options for the session. For almost all applications it will not prove to be a problem though.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T03:38:42.577

If you have more than 124,889 users, your server will begin to be unresponsive.

Edit: if your data does not change and can be re-used, try caching it in an application scoped variable, i.e. reference data.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T03:54:35.977

You should probably be looking at [Memcached](http://www.danga.com/memcached/) if you're getting to this point.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T03:57:57.670

It's very unlikely that session variable capacity will ever be the limiting resource for your server. Any particular reason you're asking?

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T07:30:04.810

How about using the Cache instead, it allows automatic cache invalidation.

Cache invalidation can be done both based on a timeout and due to it being "kicked out" due to ressources.

You can use the Cache on a per-user-basis by giving each item a user specific key.

# java - 在 Java 中将对象分配给 null 会影响垃圾收集吗？

> ID：449409
> 
> 赞同：86
> 
> 时间：2009-01-16T03:30:02.797
> 
> 标签：java, null, garbage-collection

在 Java中分配一个未使用的对象引用是否`null`以任何可衡量的方式改进了垃圾收集过程？

我在 Java（和 C#）方面的经验告诉我，尝试超越虚拟机或 JIT 编译器通常是违反直觉的，但我看到同事使用这种方法，我很好奇这是否是一个好的选择向上或那些巫毒编程迷信之一？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-01-16T03:38:10.440

通常，没有。

但就像所有事情一样：这取决于。现在 Java 中的 GC 非常好，所有东西都应该在它不再可用后很快被清理掉。这只是在为局部变量留下方法之后，并且不再为字段引用类实例时。

如果您知道它会以其他方式被引用，您只需要显式地为 null。例如一个被保留的数组。当不再需要数组的各个元素时，您可能希望它们为空。

例如，来自 ArrayList 的这段代码：

```
public E remove(int index) {
    RangeCheck(index);

    modCount++;
    E oldValue = (E) elementData[index];

    int numMoved = size - index - 1;
    if (numMoved > 0)
         System.arraycopy(elementData, index+1, elementData, index,
             numMoved);
    elementData[--size] = null; // Let gc do its work

    return oldValue;
} 
```

此外，只要没有引用保留，显式地清空一个对象不会比它自然超出范围更早被收集。

两个都：

```
void foo() {
   Object o = new Object();
   /// do stuff with o
} 
```

和：

```
void foo() {
   Object o = new Object();
   /// do stuff with o
   o = null;
} 
```

在功能上是等效的。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-16T03:52:51.737

根据我的经验，人们常常出于偏执而不是出于必要而取消引用。这是一个快速指南：

1.  如果对象 A 引用对象 B**并且**您不再需要此引用**并且**对象 A 不符合垃圾回收条件，那么您应该显式地清空该字段。如果封闭对象正在被垃圾收集，则无需将字段清空。在 dispose() 方法中清除字段几乎总是无用的。

2.  无需将方法中创建的对象引用清空。一旦方法终止，它们将自动清除。此规则的例外情况是，如果您在一个非常长的方法或一些大型循环中运行，并且您需要确保在方法结束之前清除某些引用。同样，这些情况极为罕见。

我会说绝大多数时候你不需要取消引用。试图智取垃圾收集器是没有用的。你最终会得到低效、不可读的代码。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-16T03:42:07.407

好文章是今天的[编码恐怖](https://blog.codinghorror.com/die-you-gravy-sucking-pig-dog/)。

GC 的工作方式是寻找没有任何指向它们的指针的对象，它们的搜索区域是堆/堆栈以及它们拥有的任何其他空间。因此，如果您将变量设置为 null，则实际对象现在不会被任何人指向，因此可能会被 GC 处理。

但是由于 GC 可能不会在那个确切的时刻运行，你可能实际上并没有给自己买任何东西。但是，如果您的方法相当长（就执行时间而言），那么它可能是值得的，因为您将增加 GC 收集该对象的机会。

代码优化也可能使问题变得复杂，如果您在将变量设置为 null 后从不使用该变量，那么删除将值设置为 null 的行（少一条执行指令）将是一种安全的优化。所以你实际上可能没有得到任何改善。

总而言之，**是的，它可以提供帮助，但它不是确定性**的。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-16T03:36:49.087

至少在 java 中，它根本不是伏都教编程。当您使用类似的东西在java中创建对象时

```
Foo bar = new Foo(); 
```

你做了两件事：第一，你创建一个对象的引用，第二，你创建 Foo 对象本身。只要存在该引用或其他引用，就不能 gc'd 特定对象。但是，当您将 null 分配给该引用时...

```
bar = null ; 
```

并假设没有其他对象引用该对象，它会在下次垃圾收集器经过时被释放并可供 gc 使用。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-01-16T03:50:14.910

这取决于。

一般而言，您保留对对象的引用越短，收集它们的速度就越快。

如果您的方法需要 2 秒才能执行，并且在方法执行一秒后您不再需要对象，则清除对它的任何引用是有意义的。如果 GC 在一秒钟后发现你的对象仍然被引用，那么下次它可能会在一分钟左右检查它。

**无论如何，默认情况下将所有引用设置为 null 对我来说是过早的优化，除非在特定的极少数情况下可以显着减少内存消耗，否则没有人应该这样做。**

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-01-16T08:08:16.387

显式设置对 null 的引用而不是让变量超出范围，这对垃圾收集器没有帮助，除非持有的对象非常大，在完成后立即将其设置为 null 是个好主意。

通常将引用设置为null，意味着该对象已完全完成的代码的READER，不应再担心。

可以通过添加一组额外的大括号来引入更窄的范围来实现类似的效果

```
{
  int l;
  {  // <- here
    String bigThing = ....;
    l = bigThing.length();
  }  // <- and here
} 
```

这允许 bigThing 在离开嵌套大括号后立即被垃圾收集。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-06-02T05:58:50.690

```
public class JavaMemory {
    private final int dataSize = (int) (Runtime.getRuntime().maxMemory() * 0.6);

    public void f() {
        {
            byte[] data = new byte[dataSize];
            //data = null;
        }

        byte[] data2 = new byte[dataSize];
    }

    public static void main(String[] args) {

        JavaMemory jmp = new JavaMemory();
        jmp.f();

    }

} 
```

上面的程序抛出`OutOfMemoryError`. 如果您取消注释`data = null;`，`OutOfMemoryError`则解决。将未使用的变量设置为 null 始终是一个好习惯

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2012-12-09T17:33:28.813

有一次我正在开发一个视频会议应用程序，当我不再需要该对象时花时间将引用归零时，我注意到性能上的巨大差异。那是在 2003-2004 年，我只能想象 GC 从那以后变得更加智能。在我的例子中，我每秒有数百个对象进出范围，所以当它定期启动时我注意到了 GC。但是，在我指出空对象后，GC 停止暂停我的应用程序。

所以这取决于你在做什么......

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-16T03:35:51.707

是的。

来自“实用程序员”第 292 页：

通过设置对 NULL 的引用，您可以将指向对象的指针数量减少一......（这将允许垃圾收集器将其删除）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-16T03:44:18.853

我假设OP指的是这样的事情：

```
private void Blah()
{
    MyObj a;
    MyObj b;

    try {
        a = new MyObj();
        b = new MyObj;

        // do real work
    } finally {
        a = null;
        b = null;
    }
} 
```

在这种情况下，VM 不会在它们离开范围后立即将它们标记为 GC 吗？

或者，从另一个角度来看，如果项目超出范围，是否会显式地将项目设置为 null 导致它们先被 GC 处理？如果是这样，VM 可能会在不需要内存时花时间 GC'ing 对象，这实际上会导致更糟糕的性能 CPU 使用，因为它会更早地 GC'ing。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-11-18T18:33:09.237

即使取消引用效率稍微高一点，是否值得在代码中添加这些丑陋的无效值？它们只会使包含它们的意图代码变得混乱和模糊。

它是一个罕见的代码库，没有比试图超越垃圾收集器更好的优化候选者（更罕见的是成功超越它的开发人员）。您的努力很可能会更好地花在其他地方，放弃那个笨拙的 Xml 解析器或寻找一些缓存计算的机会。这些优化将更容易量化，并且不需要你用噪音弄脏你的代码库。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-16T03:42:18.997

“*这取决于*”

我不了解 Java，但在 .net（C#、VB.net...）中，当您不再需要对象时，通常不需要分配 null。

但是请注意，它“通常不是必需的”。

通过分析您的代码，.net 编译器可以很好地评估变量的生命周期......以准确判断何时不再使用该对象。因此，如果您编写 obj=null 它实际上可能看起来好像仍在使用 obj...在这种情况下，分配 null 会适得其反。

在某些情况下，它实际上可能有助于分配空值。一个例子是你有一个运行很长时间的巨大代码，或者一个在不同线程或某个循环中运行的方法。在这种情况下，分配 null 可能会有所帮助，以便 GC 很容易知道它不再被使用。

对此没有硬性规定。在您的代码中通过上述位置进行空分配并运行分析器以查看它是否有任何帮助。很可能您可能看不到任何好处。

如果您尝试优化的是 .net 代码，那么我的经验是，小心处理 Dispose 和 Finalize 方法实际上比担心 null 更有益。

关于该主题的一些参考资料：

[http://blogs.msdn.com/csharpfaq/archive/2004/03/26/97229.aspx](http://blogs.msdn.com/csharpfaq/archive/2004/03/26/97229.aspx)

[http://weblogs.asp.net/pwilson/archive/2004/02/20/77422.aspx](http://weblogs.asp.net/pwilson/archive/2004/02/20/77422.aspx)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-11-09T07:40:42.417

在您的程序的未来执行中，一些数据成员的值将用于计算程序外部可见的输出。其他的可能会或可能不会被使用，这取决于程序的未来（并且不可能预测）输入。可能保证不使用其他数据成员。分配给那些未使用数据的所有资源，包括内存，都被浪费了。垃圾收集器 (GC) 的工作是消除浪费的内存。GC 消除需要的东西将是灾难性的，因此使用的算法可能是保守的，保留超过严格的最小值。它可能会使用启发式优化来提高其速度，但代价是保留一些实际不需要的项目。GC 可能使用许多潜在的算法。因此，您对程序所做的更改是可能的，并且不会影响程序的正确性，但可能会影响 GC 的操作，或者使其运行更快地完成相同的工作，或者更快地识别未使用的项目。所以这种改变，设置一个unusdd对象引用`null`，*理论上*并不总是巫毒。

是巫毒吗？据报道，有部分 Java 库代码可以做到这一点。该代码的编写者比普通程序员要好得多，并且要么了解或与了解垃圾收集器实现细节的程序员合作。所以这表明*有时*会有好处。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-06-22T23:08:33.910

正如您所说，有一些优化，即 JVM 知道上次使用变量的位置，并且可以在最后一点之后立即对它引用的对象进行 GC（仍在当前范围内执行）。因此，在大多数情况下，将引用归零对 GC 没有帮助。

但避免“裙带关系”（或“浮动垃圾”）问题可能很有用（[在此处阅读更多信息](http://psy-lob-saw.blogspot.com/2016/03/gc-nepotism-and-linked-queues.html)或[观看视频](https://www.youtube.com/watch?v=M9o1LVfGp2A&feature=youtu.be&t=1391)）。问题的存在是因为堆被分为老年代和年轻代，并且应用了不同的 GC 机制：Minor GC（速度很快，并且经常发生在清理年轻代）和 Major Gc（导致清理老代的更长时间的暂停）。“裙带关系”不允许收集年轻代中的垃圾，如果它被已经被老代使用的垃圾所引用。

> 这是“病态的”，因为任何提升的节点都会导致所有后续节点的提升，直到 GC 解决问题。

为了避免裙带关系，最好从应该删除的对象中清除引用。您可以在 JDK 类中看到这种技术：[LinkedList](https://github.com/AdoptOpenJDK/openjdk-jdk11u/blob/c638b7fdff8cad2fed2f71a6d230684f8311602a/src/java.base/share/classes/java/util/LinkedList.java#L180)和[LinkedHashMap](https://github.com/AdoptOpenJDK/openjdk-jdk11u/blob/master/src/java.base/share/classes/java/util/LinkedHashMap.java#L286)

```
private E unlinkFirst(Node<E> f) {
    final E element = f.item;
    final Node<E> next = f.next;
    f.item = null;
    f.next = null; // help GC
    // ...
} 
```

# c# - 以编程方式将 List 绑定到 ListBox

> ID：449410
> 
> 赞同：22
> 
> 时间：2009-01-16T03:31:19.737
> 
> 标签：c#, wpf, data-binding

例如，假设我有以下非常简单的窗口：

```
<Window x:Class="CalendarGenerator.Window1"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Window1"
        Height="300"
        Width="447">
  <Grid>
    <ListBox Margin="12,40,0,12"
             Name="eventList"
             HorizontalAlignment="Left"
             Width="134" />
  </Grid>
</Window> 
```

一个简单的列表定义为：

```
List<String> ListOfNames = new List<String>(); 
```

让我们假设列表中有几个名字。我将如何使用尽可能多的代码隐藏将 List 绑定到 ListBox？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-01-16T03:35:54.343

首先，您需要为您的 ListBox 命名，以便可以从您的代码后面访问它（*编辑*我注意到您已经这样做了，所以我将更改我的示例 ListBox 的名称以反映您的名称）：

```
<ListBox x:Name="eventList" ... /> 
```

然后就像将 ListBox 的[ItemsSource](http://msdn.microsoft.com/en-us/library/system.windows.controls.itemscontrol.itemssource.aspx)属性设置为您的列表一样简单：

```
eventList.ItemsSource = ListOfNames; 
```

由于您已将“ListOfNames”对象定义为`List<String>`，因此 ListBox 不会自动反映对列表所做的更改。要让 WPF 的数据绑定对列表中的更改做出反应，请将其定义为[ObservableCollection](http://msdn.microsoft.com/en-us/library/ms668604.aspx)`<String>`。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-01-16T04:29:39.510

如果数据列表是在代码中创建的，那么您将不得不在代码中绑定它，如下所示：

```
eventList.ItemsSource = ListOfNames; 
```

现在绑定到字符串列表是一个非常简单的例子。让我们看一个更复杂的。

假设你有一个 person 类：

```
public class Person {
    public string FirstName { get; set; }
    public string Surname { get; set; }
} 
```

要显示人员列表，您可以将列表绑定到 ListBox，但您最终会得到一个为每个条目显示“Person”的列表框，因为您没有告诉 WPF 如何显示人员对象。

为了告诉 WPF 如何直观地显示数据对象，我们定义了一个 DataTemplate，如下所示：

```
<Window.Resources>
    <DataTemplate DataType="{x:Type l:Person}">
        <StackPanel Orientation="Horizontal">
            <TextBlock Text="{Binding FirstName}"/>
            <TextBlock Text=" "/>
            <TextBlock Text="{Binding Surname}"/>
        </StackPanel>
    </DataTemplate>
</Window.Resources>
<Grid>
    <ListBox Name="listBox" />
</Grid>

public Window1() {
    InitializeComponent();
    List<Person> people = new List<Person>();
    people.Add(new Person() { FirstName = "Cameron", Surname = "MacFarland" });
    people.Add(new Person() { FirstName = "Bea", Surname = "Stollnitz" });
    people.Add(new Person() { FirstName = "Jason", Surname = "Miesionczek" });
    listBox.ItemsSource = people;
} 
```

这将在列表中很好地显示“Firstname Surname”。

如果您想将外观更改为“**姓**，名”，您只需将 XAML 更改为：

```
<StackPanel Orientation="Horizontal">
    <TextBlock FontWeight="Bold" Text="{Binding Surname}"/>
    <TextBlock Text=", "/>
    <TextBlock Text="{Binding FirstName}"/>
</StackPanel> 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-01-16T03:37:49.800

如果要自定义绑定，请使用[Binding类：](http://msdn.microsoft.com/en-us/library/system.windows.data.binding.aspx)

```
List<String> listOfNames = new List<String>() {"a", "b"};
Binding myBinding = new Binding();
//set binding parameters if necessary
myBinding.Source = listOfNames;
eventList.SetBinding(ItemsControl.ItemsSourceProperty, myBinding); 
```

或者

直接将数据分配给 ItemsSource 属性：

```
eventList.ItemsSource = listOfNames; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-16T03:36:10.240

eventList.ItemsSource = ListOfNames;

# lucene - Lucene 索引更新和性能

> ID：449411
> 
> 赞同：2
> 
> 时间：2009-01-16T03:32:10.217
> 
> 标签：lucene

我正在一个工作门户网站上工作，并且一直在使用 Lucene 进行工作搜索功能。用户每天都会在我们的网站上发布一些职位。我们需要确保发布的新职位可以尽快在网站上搜索到。在这种情况下，当发布新工作或编辑现有工作时，如何更新 Lucene 索引？lucene 索引更新和搜索可以并行工作吗？

另外，我能知道关于 Lucene 索引、优化、性能等方面的任何提示/最佳实践吗？

感谢您的帮助！

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-17T01:22:10.240

是的，只要不超过 1 个 IndexWriter 写入，Lucene 就可以同时搜索和写入索引。如果您希望新记录尽快可见，请让 IndexWriter 经常调用 commit() 函数（有关详细信息，请参阅[IndexWriter 的 JavaDoc](http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/index/IndexWriter.html)）。

这些 Wiki 页面也可能有帮助：

[提高索引速度](http://wiki.apache.org/jakarta-lucene/ImproveIndexingSpeed)

[提高搜索速度](http://wiki.apache.org/jakarta-lucene/ImproveSearchingSpeed)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T03:54:46.023

我在与您所做的类似的网站上使用了 Lucene.Net。是的，您可以进行实时索引、更新以使所有内容保持最新？你在什么平台上使用 Lucene，.NET，Java？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-05T16:46:27.013

确保创建一个新的 IndexSearcher，因为在创建 IndexSearcher 之后添加的任何内容对该实例均不可见。

如果您想重新使用相同的索引搜索器，更好的方法可能是重新打开 IndexReader。

# language-agnostic - 任何人都可以用很好的例子向我解释可插拔适配器的概念吗？

> ID：449424
> 
> 赞同：7
> 
> 时间：2009-01-16T03:38:09.037
> 
> 标签：language-agnostic, design-patterns, adapter

任何人都可以用很好的例子向我解释可插拔适配器的概念吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-16T04:11:07.393

根据我对 Google 结果的快速阅读理解，可插拔适配器是一种没有针对特定适配器进行硬编码的适配器。表面上看（适配器自己的接口），都是一样的，但是可以适应不同的适配器，不同的接口。我发现[这个线程](http://www.coderanch.com/t/98662/OO-Patterns-UML-Refactoring/What-is-pluggable-adapter)非常解释：

> 基本上，它允许您通过使用反射在编译时不知道适配器（接收器）协议时放入适配器。当您创建适配器实例时，您将要调用的适配器方法的名称以及转换输入类型所需的任何元数据传递给它。当适配器接收到目标接口的方法调用时，它使用反射来调用适配器上指定的相应方法。

这：[_](http://wiki.eclipse.org/JFace_Viewer_-_Implementation_of_Pluggable_Adapter_Pattern)

> Viewer 的主要职责是从域模型中填充小部件，而不对域本身做任何假设。JFace viewer 使用 Pluggable Adapter Pattern 中的 Delegating Objects 机制来实现上述要求。

[![脸拥抱者在行动](https://i.stack.imgur.com/nt4jD.jpg)](https://i.stack.imgur.com/nt4jD.jpg)

把它想象成[外星人](http://en.wikipedia.org/wiki/Alien_(film))的脸拥抱者；当它拥抱一张脸时，你所看到的只是它粘糊糊的背。你可以用一根棍子戳它，然后试着撬开它的手臂（适配器接口）。但它基本上可以拥抱任何人（适应者）的脸，无论面部特征如何。也许我有点过分了，但是，嘿，我爱外星人。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T03:45:13.983

你可以阅读[这篇](http://www.guydavis.ca/seng/seng609.04/adapter.shtml)关于适配器/可插拔模式的文章：

本文目录：

```
* 1 Design Patterns
* 2 Intent of Adapter
* 3 Motivation
* 4 Structure
* 5 Applicability
* 6 Consequences
* 7 Implementation
      o 7.1 Known Uses and Sample Code
      o 7.2 Related Patterns
* 8 Conclusions
* 9 Appendix
      o 9.1 References
      o 9.2 Glossary 
```

引用：

> Smalltalk 引入了“可插拔适配器”的概念来描述具有内置接口适配的类。这个有趣的概念允许将类引入到现有系统中，这些系统可能期望与类有不同的接口。这种技术可以帮助促进跨模块甚至项目的类重用。

这是一个小例子：

我们有两个类 - Foo 和 Boo，它们将一些字符串输出到控制台。Adapter 类可以适配两个类的方法来提供客户端需要的接口（SaySomething）。请注意，接口名称不依赖于 - 我们可以轻松地调整 SayHey 和 Bark 方法。

```
class Foo 
{
    public static void SayHey() { Console.WriteLine("Hey!"); }
}

class Boo 
{
    public static void Bark() { Console.WriteLine("Woof!"); }
}

class Adapter 
{
    public Action SaySomething { get; private set;} // "pluggable" adapter

    public Adapter(Action saySomethingAction) 
    {
        SaySomething = saySomethingAction;
    }
}

class Program
{
    static void Main(string[] args)
    {
        (new Adapter(Foo.SayHey)).SaySomething();
        (new Adapter(Boo.Bark)).SaySomething();
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-11-19T00:24:54.903

Pluggable Adapter 的一个显着特点是客户端调用的方法和接口中存在的方法可以不同。

```
 interface Ilegacy
    {
        float calculate(int a, int b);
    }
    class Legacy : Ilegacy
    {
        public float calculate(int a, int b)
        {
            return a * b;
        }
    }
    class Adapter
    {
        public Func<int, int, float> legacyCalculator;
        public Adapter()
        {
            this.legacyCalculator = new Legacy().calculate;
        }
    }
    class Client
    {
        static void Main()
        {
            float result = new Adapter().legacyCalculator(5, 6);
        }
    } 
```

这通常可以通过在 C# 中使用委托、Func 或 Action 来实现

# c++ - 单例实例声明为 GetInstance 方法的静态变量，它是线程安全的吗？

> ID：449436
> 
> 赞同：33
> 
> 时间：2009-01-16T03:44:31.143
> 
> 标签：c++, design-patterns, singleton

我已经看到了单例模式的实现，其中实例变量在 GetInstance 方法中被声明为静态变量。像这样：

```
SomeBaseClass &SomeClass::GetInstance()
{
   static SomeClass instance;
   return instance;
} 
```

我看到了这种方法的以下积极方面：

*   代码更简单，因为只有在第一次调用 GetInstance 时，编译器才负责创建这个对象。
*   代码更安全，因为没有其他方法可以获取对实例的引用，而是使用 GetInstance 方法，并且没有其他方法可以更改实例，而是在 GetInstance 方法中。

这种方法有哪些负面影响（除了这不是非常面向 OOP 的）？这是线程安全的吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-01-16T08:20:33.037

在 C++11 中它是线程安全的：

> §6.7 [stmt.dcl] p4 如果在初始化变量时控制同时进入声明，则并发执行应等待初始化完成。

在 C++03 中：

*   在 g++ 下它是线程安全的。
    但这是因为 g++ 显式添加了代码来保证它。

一个问题是，如果您有两个单例，并且它们在构造和销毁过程中尝试相互使用。

阅读本文： [查找 C++ 静态初始化顺序问题](https://stackoverflow.com/questions/335369/finding-c-static-initialization-order-problems#335746)

这个问题的一个变种是如果从全局变量的析构函数访问单例。在这种情况下，单例肯定已被销毁，但 get 方法仍将返回对已销毁对象的引用。

有一些方法可以解决这个问题，但它们很混乱，不值得做。只是不要从全局变量的析构函数中访问单例。

更安全但丑陋的定义：
我相信您可以添加一些适当的宏来整理它

```
SomeBaseClass &SomeClass::GetInstance()
{
#ifdef _WIN32 
Start Critical Section Here
#elif  defined(__GNUC__) && (__GNUC__ > 3)
// You are OK
#else
#error Add Critical Section for your platform
#endif

    static SomeClass instance;

#ifdef _WIN32
END Critical Section Here
#endif 

    return instance;
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-16T06:32:39.213

如图所示，它不是线程安全的。C++ 语言对线程保持沉默，因此您无法从该语言获得内在保证。您将不得不使用平台同步原语，例如 Win32 ::EnterCriticalSection()，来保护访问。

您的特定方法将是有问题的 b/c 编译器将插入一些（非线程安全）代码以`instance`在第一次调用时初始化静态，很可能是在函数体开始执行之前（因此在可以调用任何同步之前）。 )

使用全局/静态成员指针`SomeClass`，然后在同步块中初始化将证明实现起来的问题较小。

```
#include <boost/shared_ptr.hpp>

namespace
{
  //Could be implemented as private member of SomeClass instead..
  boost::shared_ptr<SomeClass> g_instance;
}

SomeBaseClass &SomeClass::GetInstance()
{
   //Synchronize me e.g. ::EnterCriticalSection()
   if(g_instance == NULL)
     g_instance = boost::shared_ptr<SomeClass>(new SomeClass());
   //Unsynchronize me e.g. :::LeaveCriticalSection();
   return *g_instance;
} 
```

我没有编译这个，所以它只是为了说明目的。它还依赖于 boost 库来获得与原始示例相同的生命周期（或大约相同的生命周期）。您还可以使用 std::tr1 (C++0x)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-18T15:25:31.520

根据规范，这也应该在 VC++ 中工作。有谁知道有没有？

只需添加关键字 volatile。如果 msdn 上的文档正确，则 Visual c++ 编译器应生成互斥锁。

```
SomeBaseClass &SomeClass::GetInstance()
{
   static volatile SomeClass instance;
   return instance;
} 
```

* * *

## 回答 #4

> 赞同：-11
> 
> 时间：2009-01-16T04:07:43.720

它分享了 Singleton 实现的所有常见缺陷，即：

*   [这是无法测试的](http://googletesting.blogspot.com/2008/08/by-miko-hevery-so-you-decided-to.html)
*   它不是线程安全的（这很简单，看看你是否想象两个线程同时进入函数）
*   这是内存泄漏

我建议不要在任何生产代码中使用 Singleton。

# authentication - 登录：背景详情

> ID：449437
> 
> 赞同：9
> 
> 时间：2009-01-16T03:44:38.587
> 
> 标签：authentication, login

当您登录网站时会发生什么？

我知道 cookie 被存储并且一些信息（什么信息？）被发送到服务器......但也许还有更多细节？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-02-07T12:30:53.820

## 曾几何时，在互联网的某个地方......

*   浏览器：“嘿，我能看到这个网页吗？麻烦的是，我不记得以前和你说过话”
*   *网站：“当然，填写表格，我需要您的用户名和密码”*
*   浏览器：“给你”
*   *网站：“太好了！欢迎回来 koldfyre！这是页面。看，如果你想要更多页面，请拿走这个令牌并在你要求另一个页面时使用它”*
*   浏览器：酷。那个网站给了我一个令牌。我会记住的！

几分钟后

*   浏览器：“哦！我可以看到另一个网页吗？这是我的令牌”
*   *网站：“那个令牌看起来不错，你好，koldfyre，这是你的网页”*

本质上就是这样。为了记住用户已经登录，它会给用户一个令牌，它必须在下一次请求时出示该令牌。这通常是通过服务器告诉浏览器将此令牌存储在 cookie 中来实现的。

## 深入研究 - 传输层身份验证

凭据传递到服务器的方式以及它返回的令牌的性质取决于所采用的身份验证方法。

大多数 Web 服务器实现都提供了最简单的[HTTP 基本身份验证。](http://en.wikipedia.org/wiki/Basic_access_authentication)它会导致您的浏览器弹出熟悉的登录对话框。“令牌”只是您的明文用户名和密码 base64 编码。不是特别安全。

服务器也可能提供[Digest Authentication](http://en.wikipedia.org/wiki/Digest_access_authentication)，这避免了实际凭据的传输 - 客户端改为使用服务器生成的 salt 生成其凭据的哈希。它旨在防止密码嗅探和重放攻击。

## 更深层次——应用层认证

为了获得最大的灵活性和控制力，大多数站点选择在应用层而不是 HTTP 传输层实现授权。这提供了更广泛的安全选择。任何在网页（而不是浏览器的登录对话框）中要求提供凭据的站点都在使用自定义授权方法。

自定义方法在它们的初始交互中会有很大的不同，但它们几乎总是会导致给用户一个会话 cookie，其中包含一个随机生成的标识符。然后，浏览器会在每个后续请求中自动显示 cookie。Web 应用程序将检查 cookie 值以确保它仍然有效。

也可以将授权交给受信任的第三方，通常是为了提供某种单点登录服务。在这种情况下，当您发现用户未通过身份验证时，您会将其退回到身份验证提供程序。他们对它们进行身份验证，并将它们与您与提供者验证的某种令牌一起返回给您。[Shibboleth](http://en.wikipedia.org/wiki/Shibboleth_(Internet2))就是一个例子。[您还使用OpenID](http://en.wikipedia.org/wiki/Openid)采用的类似方法登录了这个站点

## 进一步阅读

[这是来自类似问题](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta/477578#477578)的一些不错的答案

*   [第一部分：如何登录](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta/477578#477578)
*   [第二部分：如何保持登录状态——臭名昭著的“记住我”复选框](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta/477579#477579)
*   [第三部分：使用秘密问题](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta/477580#477580)
*   [第 IV 部分：忘记密码功能](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta/477583#477583)
*   [第五部分：检查密码强度](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta/477584#477584)
*   [第 VI 部分：更多 - 或：防止快速登录尝试](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta/477585#477585)
*   [第七部分：分布式蛮力攻击](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta/477586#477586)

该问题中的其他答案提供了更多链接来完善您的教育！

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-16T03:54:09.237

这是一个很笼统的问题。总的来说，您所做的是与站点本身建立某种凭据。如果我们采用简单版，您输入用户名和密码；这意味着您向网站表明自己的身份，然后向其展示您和网站共享的其他人都不知道的秘密（我们希望如此）。这将您确定为具有该用户名的人，因此我们说您已经*验证*了自己。

完成此操作后，网站设计师必须做出一些设计决策。大多数人不想为每个页面都登录，因此该网站希望在您端存储一些信息，一个*凭证*。这意味着它可以告诉它仍然是你。通常，正如您所说，这是一个“cookie”，它只不过是一个以网站 URL 命名的小文本文件。该文件由浏览器存储。

在许多网站上，例如银行网站，您还希望保证正在交换的数据不会被第三方截获。如果是这样，您可以使用称为 SSL 或 TLS 的协议建立安全连接。这增加了基本连接的是建立*会话密钥*的信息交换。然后使用此会话密钥对通信进行加密。这通常发生*在*您交换用户名和密码之前，因此恶意第三方也永远不会看到您的密码。

在幕后，当您建立安全连接时，网站会向您的浏览器发送一个名为*x509 证书*的格式化数据块。这是另一种形式的身份验证；证书将由颁发者（*证书颁发机构*或“CA”）签署，浏览器可以使用存储的 CA 数据来确保证书是真实的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-16T03:51:34.547

这完全取决于网站的实施。甚至 cookie 的使用也不是强制性的，但非常普遍。

然而，在大多数情况下，会发生这样的事情：

*   您使用 HTML 表单发送您的用户名和密码。
*   服务器查找相关用户（使用数据库）
*   服务器检查密码是否与用户旁边存储在数据库中的密码匹配。
*   如果密码正确，服务器将存储当前在会话中处于活动状态的用户。此会话的标识符存储在 cookie 中，此会话的实际数据（当前用户）存储在此标识符下的服务器上。

现在您已登录。在剩余的会话期间，您将保持登录状态：

*   当您从服务器请求另一个页面时，您将发送带有 sesison 标识符的 cookie。
*   服务器使用此标识符加载会话。在这个会话中，当前用户被存储，所以服务器知道哪个用户登录了。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-08T00:22:38.050

当您登录网站时，首先要对您的凭据进行身份验证。如果您的凭据匹配，则将某些内容放入会话（在服务器上）以跟踪您的身份，以便您无需重新登录即可访问属于您的数据。这在 Web 服务器上显然是没有用的，除非客户端可以在每个请求中提供关于它是谁的信息。请注意，“会话”通常完全在 Web 服务器上维护，客户端只有一个允许访问会话的密钥。

请记住，HTTP 本身是一个无状态协议。HTTP 标准不包含 HTTP 请求在各个 HTTP 请求之间保持或保持任何状态的方法。因此，状态通常完全保存在服务器上，您只需要一种方法让客户端识别当前 HTTP 请求属于哪个会话。

两种常见的方法是：

*   使用 cookie（例如，Apache Tomcat 使用`JSESSIONID`cookie）来存储一些散列的身份验证令牌，该令牌将成功查找 Web 会话，或者
*   重写 URL，以便每个请求都将会话 ID 添加到请求的末尾。仍然以 Apache Tomcat 为例，如果禁用 cookie，则 URL 将被重写为以“ `;jsessionid=....`”之类的字符串结尾。因此，每个请求、每个 HTTP GET 和 POST（以及其他）都将以该字符串结尾。

因此，在客户端发出的每个请求中，都会将会话 ID 提供给 Web 服务器，从而允许快速查找该客户端的持久状态，从而使 HTTP 能够像有状态协议一样运行。

登录时会向服务器发送哪些信息？您在登录表单上提供的任何信息。一些 Web 服务器还跟踪请求来自的 TCP/IP 地址，以避免[会话劫持攻击](http://en.wikipedia.org/wiki/Session_hijacking)。这通常是服务器所需的所有信息。

如果您不允许浏览器保存 cookie，则每次打开浏览器并最初打开服务器的网页时，您都必须登录到 Web 服务器。但是，如果您允许浏览器保存 cookie，那么许多服务器允许您选择保存 cookie（即，不只是使用会话 cookie），这样每次您访问服务器的网页时，持久化的 cookie将识别您的身份，因此您无需重新登录。在这里，cookie 将保存足够的信息（通常以只有服务器可以理解的加密形式）来识别您的身份。在这种情况下，Cookie 不是一个简单的会话 ID。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-11T13:19:37.727

非常简单的解释，发生的事情如下所述：

## 进去什么？

*   用户名
*   密码

## 里面会发生什么？

1.  密码**转换**为其哈希
2.  哈希（密码）**与**数据库表或目录服务 进行比较*（除非有人非常愚蠢，否则该站点不会以明文形式保存您的密码）*
3.  **如果**已通过身份验证，则将状态令牌存储在 Session 和/或 cookie 中。
    *   此令牌只能包含状态、登录时间戳、您的用户 ID、用户类型（如果有）等。
    *   如果该页面要求您以某种类型的用户身份登录，则在您访问的每个页面上都会读取并验证此令牌。
4.  **如果身份验证失败**，您将被重定向到显示错误的页面，要求您重新登录。

## 什么出来

1.  您将被重定向到您的个人资料页面/您正在访问的页面，该页面在令牌的帮助下验证您。
2.  此外，如果您正在访问银行网站或其他极其安全的网站，则可能会出现数字证书

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-11T21:37:02.787

在网络上执行身份验证有两种主要方式，还有一些不太流行的方式也值得了解。

[第一个是RFC 2617](https://www.rfc-editor.org/rfc/rfc2617)定义的 HTTP 身份验证。当您请求受保护的页面时，服务器会以`401`状态代码响应，表示您无权访问该资源。除此之外，它还发送一个`WWW-Authenticate`标头，指示浏览器希望您如何授权自己。浏览器会看到此状态代码和标头，并提示您输入身份验证详细信息。当您输入它们时，您的浏览器会根据服务器指定的特定身份验证方案准备它们，并再次请求页面，包括`Authorization`带有准备详细信息的标题。服务器根据其用户数据库检查这些详细信息，并以另一个`401`（错误的详细信息）响应，或者带有随附的受保护页面`200`表示成功的状态码。

HTTP 身份验证是浏览器一开始就没有很好地实现并且从未真正改进过的那些古老的功能之一。正因为如此，Web 开发人员自己使用 cookie 来实现身份验证以保持状态变得越来越流行。在这种情况下，用户会看到一个标准的 HTML 表单。当用户在字段中输入他们的凭据并提交表单时，浏览器会对其进行编码并将其发送到服务器，就像它对任何普通 HTML 表单进行编码一样。服务器检查凭据，如果它们是合法的，则设置一个带有随机生成的 ID 号的 cookie，以及一个相应的数据库/文件系统条目，该条目将该 ID 号识别为属于特定用户。

从此时起，浏览器向服务器发出的每个请求都包含此 ID 号 cookie 作为 HTTP 标头。服务器识别 cookie，查找 ID 号，并知道您是哪个用户。当您选择注销时，服务器会发送一个响应，要求您的浏览器忘记 ID 号，此时您只是另一个匿名用户。

一个不太常用的选项是使用 SSL 客户端证书。许多人都熟悉使用 SSL 来识别服务器的想法。加密密钥对由受信任的权威机构生成、签名，并用于证明发送的数据源自密钥对的所有者。但是，许多人不知道的是，客户端可以使用相同的方法向服务器证明其身份。但是，这不太方便，因为如果您想在多台机器上使用证书，则需要随身携带证书。

当然，还有一些变体和鲜为人知的选项，但这些是最突出的选项。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-08T16:13:12.590

正如其他人所提到的，登录过程因实现而异，但基本情况（简单的 Web 应用程序身份验证）使用类似于以下伪代码的内容：

```
function login(username, password) {
    user = db->get_user(username)

    if (user == false) {
        report_error("Unknown username")
        exit
    }

    if (user->password != hash(password)) {
        report_error("Incorrect password")
        exit
    }

    // User authenticated, set session cookie
    session->set_data('current_user', user->username)
} 
```

当然，在大多数情况下，它比这更复杂一些，但是每个登录功能的开始看起来基本上都像上面那样。现在，如果我们添加自动登录（“记住我”），我们会得到这样的结果：

```
function login(username, password, remember_me) {
    user = db->get_user(username)

    if (user == false) {
        report_error("Unknown username")
        exit
    }

    if (user->password != hash(password)) {
        report_error("Incorrect password")
        exit
    }

    // User authenticated, set session cookie
    session->set_data('current_user', user->username)

    if (remember_me == true) {
        cookie_token = random_string(50)
        set_cookie('autologin_cookie', cookie_token, ONE_MONTH)
        // Finally, save a hash of the random token in the user table
        db->update_user(user, 'autologin_token', hash(cookie_token))
    }
} 
```

加上存在 cookie 时执行自动登录的功能：

```
function cookie_login() {
    cookie = get_cookie('autologin_cookie')

    if (cookie == false) {
        return false
    }

    // Only for demonstration; cookie should always include username as well
    user = db->get_user_by_cookie(cookie)

    if (user == false) {
        // Corrupt cookie data or deleted user
        return false
    }

    // User authenticated, set session cookie
    session->set_data('current_user', user->username)
    return true
} 
```

**注意：**以上不是“最佳实践”方法，也不是很安全。在生产代码中，您将始终在 cookie 数据中包含用户标识符，使用多个级别的限制，存储失败和成功登录的数据等。所有这些都已被剥离，以使身份验证的基本结构易于遵循。

不管怎样，我希望这就是你要找的，koldfyre。我不知道你的背景，但如果你不确定[会话](http://www.w3schools.com/PHP/php_sessions.asp)和[cookie](http://www.w3schools.com/PHP/php_cookies.asp)是如何工作的，你应该单独阅读它们，如果你需要更详细的细节，请问。

PS：您可能还想查看问题“[网站身份验证权威指南](https://stackoverflow.com/questions/549/477578#477578)”以获得最佳实践方法

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-11T21:08:57.940

看，要给你更多你在这里已经拥有的信息有点困难；我不确定你为什么要设置赏金。cookie 只是一点点命名信息，你可以在里面放任何你喜欢的东西。对于会话，您需要*某种*会话 ID。有一些约定，或者你可以自己做。无论您做什么，当您设置 cookie 时，您都会在该人的浏览器上留下一些数据，或多或少像这样：

```
mydomain.com:
    mystuff: this is my stuff, by golly. 
```

当您回来时，您检索 cookie 并将其取回。

如果您想查看该协议的所有详细信息，请查看[Wikipedia 文章](http://en.wikipedia.org/wiki/HTTP_cookie)。

# interface - 接口的有趣应用

> ID：449444
> 
> 赞同：1
> 
> 时间：2009-01-16T03:48:53.803
> 
> 标签：interface

为什么接口有用？

实际上，我对接口为什么有用/必要有一个 [小] 想法，但是......

接口的[有趣或现实]应用是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T03:55:16.677

接口很有趣，因为您可以允许 2 个类实现相同的方法。让我们看一个例子。

假设我有一个名为 Animal 的基类。所有的动物都会呼吸和交流。现在假设我有 3 个类，分别称为 Dolphin、Human 和 Tiger。所有这些动物都呼吸和交流。但我想为人类和老虎实现一个步行方法。海豚不会走路。所以我继承了后两者的IWalk方法，在编译类的时候，我必须实现接口中指定的方法，否则编译不出来。这是一个约定，“如果我想实现这个类，我必须实现这些方法。”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T03:54:57.643

我对接口的一种用途是帮助对难以模拟的框架类进行单元测试。我将创建一个与框架类工作基本相同的接口和一个实现该接口的包装类。包装类的构造函数将框架类的实例作为参数。包装器将它支持的接口功能委托给框架类，但我实现到我的接口而不是框架。使用该接口使我可以轻松地在我的单元测试中模拟包装类的功能——使用模拟框架或提供一个也实现该接口的假类，并通过依赖注入将其提供给通常依赖的任何类在框架类上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T03:57:51.413

它们允许多态性而没有继承的一些不好的方面。

**我所说的继承的坏方面是什么意思？**
代码和数据沿长链继承（使其不那么明显）。
在继承树中某处被覆盖的继承成员。

**如何使用多态性？**
以免自己重蹈覆辙。创建使用接口而不是实现接口的对象的函数、开关或条件。

**Java 特定**
在 Java 中，使用接口作为获得多重继承的一种方式通常是有意义的。
如果某些事物自然地分为两类并且您对它们都有不同的预期行为，那么这是有道理的。

**来自 Web 的一些 Java 示例**
[http://home.cogeco.ca/~ve3ll/jatutor5.htm](http://home.cogeco.ca/~ve3ll/jatutor5.htm)
[http://java.freehep.org/lib/freehep/doc/root/index.html](http://java.freehep.org/lib/freehep/doc/root/index.html)
[http://www.codeguru .com/java/tij/tij0080.shtml](http://www.codeguru.com/java/tij/tij0080.shtml)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T04:36:44.080

接口（或抽象类）是您与编译器传递的契约。这份合同说：

——好吧，编译器，确保**所有**实现这个的类**至少**提供这个接口中定义的所有东西！

有了这种保险，您就可以编写方法来操作实现此接口的任何类的对象：

```
 void myGenericMethod( IAnInterface genericObject ) 
```

myGenericMethod 方法可以使用接口 IAnInterface 的任何成员。它永远不会抛出运行时错误（任何丢失的成员都将被编译器捕获）。

实用程序：为不同的对象提供一些共同的行为。例如，您可能希望能够在您的任何对象上调用名为 GetID 的方法，无论是 BankAccount、ComputerCluster 还是 AirplaneTrip。

在大多数设计模式中，您会发现很多有用的接口用法。MSDN 提供了一些关于何时应在此处使用接口的提示：http: [//msdn.microsoft.com/en-us/library/27db6csx.aspx](http://msdn.microsoft.com/en-us/library/27db6csx.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T03:58:51.023

正如 tvanfosson 所提到的，这对于模拟非常有用，如果您编写一个依赖于外部配置的库，您可以创建一个 IFooProvider 并让调用程序实现它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T04:01:05.777

我假设您的意思是编程**语言**意义上的“界面”，而不是其他意义上的“界面”，例如“用户界面”。

Java 或 C# 等语言的接口有两个用途。首先是提供一个类型的契约来实现；该类型提供给使用它的其他类型的一组方法名称和签名。第二个是在该类型的接口上提供多态性。例如，如果我有一个实现 IFoo 接口的类型，我可以将该类型的实例传递给另一个类，而另一个类只需要知道 IFoo 接口，而不是我的实现 IFoo 的类的每个细节。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-16T04:18:44.697

当您希望允许不共享公共类层次结构的两个类之间进行互操作时，接口很有用。

一个很好的例子是**[java.lang.CharSequence](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/CharSequence.html)**。许多其他的东西可以抽象地被视为字符串，但是子类 String 这样做是不正确的。事实上 String 是最终的，所以无论如何它都无法完成。

JDK 1.4 前后的某个时间（我相信？）引入了 CharSequence 接口。现在，JDK 中的 String、StringBuffer、CharBuffer 和许多其他现有类都实现了它。这样，可以将新方法添加到接受 CharSequence 的其他 API 中，从而允许它们以统一的方式抽象地处理所有这些。

你也可以自己实现这个接口，并以同样的方式使用它。实现一个通用接口比尝试强制从特定的基类扩展（或者有时是不可能的）要灵活得多。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-16T04:44:45.750

我更喜欢将接口视为对实现类的每个实例所要履行的**角色的描述，独立于任何实现继承层次结构。**

打个比方，你可以用球队中某些位置如何互动来描述“屏幕传球”足球比赛。就位置（或角色或界面）而言，该描述与在给定时间哪个玩家碰巧扮演该位置无关。这也与球队是否碰巧有一些可以打多个位置的天才球员无关。

面向接口思维的优势在于，它关注对象在与其他对象的给定交互中所扮演的角色，而不关心对象在其他类型的交互中可能扮演的任何其他角色。它还允许测试专注于与角色相关的场景（以及在测试场景中模拟或假冒角色）。

# java - Java 静态

> ID：449445
> 
> 赞同：0
> 
> 时间：2009-01-16T03:50:14.067
> 
> 标签：java, static, methods, keyword

**重复**：[类中的“静态”关键字有什么作用？](https://stackoverflow.com/questions/413898/what-does-the-static-keyword-do-in-java)

* * *

我已经读过[这篇文章](https://stackoverflow.com/questions/335311/java-static-keyword)了。

方法中的“静态”关键字有什么作用？

我记得有人告诉我静态！= 紧贴...但这几乎就是我对这个关键字的全部了解。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T03:58:48.760

静态类变量可以被认为是一个全局类。不管你有多少类的实例，每个静态变量只有一个实例。

静态方法不使用任何非静态类变量，它们可以直接从类外部调用，而无需实例化类本身。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T04:02:53.917

静态变量和方法属于类而不是实例，尽管您可以从实例引用中引用它们。通常，您使用类名称来访问它们。

如果一个方法被声明为静态的，你就不需要定义它的对象的实例来调用它。现在，您可能想知道何时会出现这种情况？考虑java的main方法

公共静态无效主要（字符串 [] 参数）

为什么它被声明为静态的？这是因为为了启动你的程序，这个方法应该开始执行。而且，由于程序尚未初始化，因此您无法创建声明它的类的实例。因此，您需要将该类声明为公共的。而且，当类通过

java 你的类名

除此之外，静态方法用于修改静态变量。他们不能操纵非静态实例变量。

另外，请注意，静态在另一种语言（如 C）中具有不同的含义。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T03:57:42.490

静态方法属于定义它的类，而*不是*该类的对象的实例，就像非静态方法一样。作为不属于类实例的副作用，尝试访问静态方法中的非静态字段是编译错误。静态方法没有“this”来访问非静态字段。

Java Math 类就是一个很好的例子，因为它加载了静态方法。您永远不会创建 Math 类的实例，您只需直接从该类中调用方法。

```
Math.abs(3.14); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T03:59:33.220

方法中静态变量的值存储在对该方法的调用之间

```
 public void method() {
  static int callCount = 0;
  callCount++;
  System.out.println("Calls: " + callCount);
}

method(); // "Calls: 1"
method(); // "Calls: 2"
method(); // "Calls: 3" 
```

请注意，这与静态方法完全不同。在定义它的类而不是此类的实例上调用静态方法。

```
 class MyClass {
  public static void staticMethod() { ... }
  public void nonStaticMethod();
}

Myclass.staticMethod();

MyClass instance = new MyClass();
instance.nonStaticMethod(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-16T04:00:01.457

静态方法是为*类*建​​立的方法。它不需要（也没有）`this`指针，也不能访问实例数据。所以你可以写一些东西

```
public class Hello {

    void instanceHello() {
         System,out.println("Hello from the instance.");
    }

    public static void main(int argc, String[] argv){
         // The main method is defined even though there are no instances
         System.out.println("Hello from main.");
         instanceHello();  // but this is a syntax error;
         Hello h = new Hello();
         h.instanceHello();  // this isn't though 
    }
} 
```

# geometry - 相交两个整数二次贝塞尔曲线的快速方法？

> ID：449449
> 
> 赞同：3
> 
> 时间：2009-01-16T03:51:41.740
> 
> 标签：geometry, integer, bezier, curve, quadratic

给定两个具有整数坐标的二维二次贝塞尔曲线，找到它们的交点的最佳方法是什么？同样有趣的是，如果它们不相交，则提前拒绝。如果它更容易，可以假设它们在 x 和 y 中都是单调的。只有可以通过细分输入曲线的整数表示的交点才有效。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T04:10:39.283

[本文档](http://cagd.cs.byu.edu/~557/text/ch7.pdf)解释了查找曲线交点的各种方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-03-27T13:10:39.067

不，那行不通。这样，您只会找到 Q1 和 Q2 之间交点的一小部分（通常为空）子集，即相对于所涉及的两条曲线，交点位于相同曲线参数 t 处的那些。

# sql - 在 T-SQL 中确定“本周”

> ID：449475
> 
> 赞同：3
> 
> 时间：2009-01-16T04:00:01.190
> 
> 标签：sql, sql-server, tsql

这是美国特有的语言环境，它认为一周的开始是星期日；我希望能够让 SQL 给我相对于今天 [getDate()] 的下周日的日期。如果今天是 1 月 15 日，则应返回 1 月 18 日；如果今天是星期日，它应该返回下一个星期日，即 25 日。编写 UDF 将是微不足道的，但我很好奇是否有人有其他技巧/想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T04:10:33.603

```
DECLARE @d AS datetime
SET @d = '1/15/2009'
PRINT @d
PRINT DATEADD(day, 8 - DATEPART(weekday, @d), @d)
SET @d = '1/18/2009'
PRINT @d
PRINT DATEADD(day, 8 - DATEPART(weekday, @d), @d)

-- So it should be able to be used inline pretty efficiently:
DATEADD(day, 8 - DATEPART(weekday, datecolumn), datecolumn)

-- If you want to change the first day for a different convention, simply use SET DATEFIRST before performing the operation
-- e.g. for Monday: SET DATEFIRST 1
-- e.g. for Saturday: SET DATEFIRST 6

DECLARE @restore AS int
SET @restore = @@DATEFIRST
SET DATEFIRST 1

DECLARE @d AS datetime
SET @d = '1/15/2009'
PRINT @d
PRINT DATEADD(day, 8 - DATEPART(weekday, @d), @d)
SET @d = '1/19/2009'
PRINT @d

PRINT DATEADD(day, 8 - DATEPART(weekday, @d), @d)
SET DATEFIRST @restore 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T04:29:49.133

今天的星期几：
SELECT @dow = DATEPART(d, GETDATE()) 其中 1 = 星期日，7 = 星期六

您想添加足够的天数来获得下一个星期日。

如果今天是 1 = 星期日，加 7
如果今天是 2 = 星期一，加 6
如果今天是 3 = 星期二，加 5 等等。

所以你总是添加 8 - 今天的星期几值。

选择 DATEADD(d, GETDATE(), 8 - @dow(GETDATE))

编辑：但凯德赢了！

# vb.net - 可变按钮 vb.net

> ID：449480
> 
> 赞同：0
> 
> 时间：2009-01-16T04:01:34.263
> 
> 标签：vb.net, event-handling

我声明了一个全局变量按钮：

将按钮 1 变暗为新按钮（）

现在，我不知道如何在此按钮中添加单击事件，因为它是一个变量。你知道我该怎么做吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T04:07:37.027

`AddHandler button1.click, AddressOf MyClickEventHandler`（[MSDN 文档](http://msdn.microsoft.com/en-us/library/6yyk8z93(VS.71).aspx)）

您必须确保`MyClickEventHandler`使用与任何其他 Click 事件处理程序相同的签名定义（即`Sub MyClickEventHandler(ByVal sender as Object, ByVal e as EventArgs)`）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T04:14:00.040

如前所述，Addhandler 方式可能是要走的路。您的另一个选择是通过以下方式声明您的按钮：

```
Dim withEvents button1 As New Button()

Private Sub button1_ClickHandler(ByVal sender As Object, ByVal e As EventArgs) Handles button1.click

'Handle stuff

End Sub 
```

如果您要在设计器中拖动表单上的按钮，这种方式可以模拟 VS 为您所做的事情。

AddHandler 方式的优点是，如果需要，您也可以动态删除处理程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T04:08:00.490

```
AddHandler button1.Click, AddressOf MyEventHandler

Sub MyEventHandler(ByVal sender As Object, ByVal e As EventArgs)
      '
      ' Code to be executed when the event is raised.
      '
      MsgBox("I caught the event!") 
End Sub 
```

# function - 你把这个函数式语言特性叫做什么？

> ID：449482
> 
> 赞同：3
> 
> 时间：2009-01-16T04:04:27.000
> 
> 标签：function, j, tacit-programming

好吧，够尴尬的，我发布[了我需要解释的代码](https://stackoverflow.com/questions/445782/finding-closest-match-in-collection-of-numbers#449148)。具体来说，它首先将绝对值和减法链接在一起，然后进行排序，同时根本不必提及参数和参数，因为存在可以连接这些函数的“副词”“动词”

什么（非 APL 类型）语言支持这种无参数函数组合（我有一个模糊的想法，它与 monad/dyad 和 rank 的概念密切相关，但很难得到一个特别容易理解的图片只是来自阅读维基百科），我怎么称呼这个概念？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T04:17:27.787

这类似于[无点](http://www.haskell.org/haskellwiki/Pointfree)风格；这通过组合和柯里化有效。Haskell 和 ML 等函数式语言使用它。

Joy、Factor 和 Cat 等串联编程语言也有这些“副词”。

# android - Android：捕获活动的返回

> ID：449484
> 
> 赞同：82
> 
> 时间：2009-01-16T04:05:38.670
> 
> 标签：android, android-intent, android-activity, exit

我有一个关于启动新活动的问题。归结为这一点。我在一个视图上有 3 个选项卡

```
A) contains gMap activity
 B) camera activity
 C) some random text fields. 
```

要求是应用程序以纵向模式运行。

所有 3 个选项卡都按预期工作，但相机预览表面 (B) 除外。它旋转了 90 度。他们使其正确的唯一方法是将应用程序设置为横向，这会抛出我所有的标签，并且几乎不可行。

我的解决方案是：替换

我的相机活动与常规活动为空，但除外

```
Intent i = new Intent(this,CameraActivity.class);
    startActivity(i); 
```

这将启动我的 CameraActivity。这很好用。我必须做一个线性布局并包含 3 个看起来像真实标签的图像，所以我可以尝试模仿标签的操作，同时将屏幕旋转为横向并将视觉效果保持为纵向。用户可以单击其中一个图像（按钮）以显示下一个选项卡。这是我的问题。它应该退出我的“相机活动”，返回到选项卡中的“空白活动”，它应该被解释为从我的图像中单击所需的选项卡。

主要的是，当它返回时，它会返回到选项卡下的空白（黑色）页面（因为它是“空的”）。如何将返回事件捕获回调用该活动的页面，然后查看它们执行了哪些操作？

我可以设置一个 onclicklistener，我可以在其中响应被点击的假标签（图像）以退出相机活动。退出时，选项卡应更新，以便您返回。有什么建议么？

谢谢，

* * *

## 回答 #1

> 赞同：159
> 
> 时间：2009-01-16T08:20:47.997

我将专注于回答如何解决您的工作区，以便它按照您的意愿行事。

要在另一个活动中捕获对一个活动执行的操作，需要三个步骤。

`startActivityForResult`通过使用而不是启动辅助活动（您的“相机活动”）作为子活动`startActivity`。

```
Intent i = new Intent(this,CameraActivity.class);    
startActivityForResult(i, STATIC_INTEGER_VALUE); 
```

在子活动（相机活动）中，您需要创建一个新的 Intent 并包含选项卡的索引，以在您使用附加包返回父应用程序时显示，而不是仅在用户单击不同的选项卡图像时关闭活动. 在调用关闭相机 Activity`setResult`之前将其传递回父调用。`finish`

```
resultIntent = new Intent(null);
resultIntent.putExtra(PUBLIC_STATIC_STRING_IDENTIFIER, tabIndexValue);
setResult(Activity.RESULT_OK, resultIntent);
finish(); 
```

最后一步是在调用 Activity 中，重写`onActivityResult`以监听来自摄像头 Activity 的回调。从返回的 Intent 中获取额外信息以确定您应该显示的选项卡的索引。

```
@Override 
public void onActivityResult(int requestCode, int resultCode, Intent data) {     
  super.onActivityResult(requestCode, resultCode, data); 
  switch(requestCode) { 
    case (STATIC_INTEGER_VALUE) : { 
      if (resultCode == Activity.RESULT_OK) { 
      int tabIndex = data.getIntExtra(PUBLIC_STATIC_STRING_IDENTIFIER);
      // TODO Switch tabs using the index.
      } 
      break; 
    } 
  } 
} 
```

# c++ - C++ SQL 清理库或提供清理的查询生成器

> ID：449485
> 
> 赞同：1
> 
> 时间：2009-01-16T04:06:19.807
> 
> 标签：c++, sqlite

在我正在进行的一个项目中，我需要通过 C++ 将数据插入到 SQLite3 数据库中。为了避免“小 Bobby Tables”事件，我需要清理我的数据库输入。我想找到一个在 C++ 中执行此操作的库，而不是我自己的库，因为这通常会导致问题。由于应用程序会将 MP3 中的 ID3 数据插入到数据库中，因此这一需求至关重要，因为许多艺术家、专辑和歌曲标题都包含无效字符。

我之前发现了一篇 SO 帖子（现在似乎找不到...），其中详细介绍了 C++ 的不同查询构建器库，但这些库都没有直接说它们提供清理功能。我不想开始实施一个发现它没有这个功能。必须有一个图书馆可以做到这一点，但我的搜索失败了。

我的问题是，有哪些库可以清理 C++ 中的数据库输入？我不介意自己动手​​，但我想不惜一切代价避免它。谢谢大家！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T04:17:54.743

简短的回答：不要清理您的输入。请改用参数化查询。它们更安全、更快捷。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T16:56:14.943

我不确定，但[SOC](http://soci.sourceforge.net/)就类型转换安全而言，我可能会为您提供帮助。我个人使用过它，我可以说它绝对值得研究，即使您的目标只是使用一个健全的库来包装对不同后端的数据库访问。

# encryption - MMORPG协议加密

> ID：449497
> 
> 赞同：8
> 
> 时间：2009-01-16T04:15:11.067
> 
> 标签：encryption, client-server, bots

任何人都知道如今 MMORPG 开发人员加密他们的客户端/服务器协议的趋势是什么？

优缺点如下。

加密协议：

*   在一定程度上保护有关客户端/服务器协议的商业机密？
*   机器人并没有停止，它只是改变了，因为人们将创建读取屏幕状态并触发鼠标+键盘事件的机器人然后将被开发，只是缓解机器人的发展而不是无论如何阻止它们。尽管机器人开发的供应量有所减少，但需求仍然存在，他们只是在rentacoder.com上获得更高的出价

常规纯文本：

*   更高级的机器人，因为开发人员能够将自己的数据报注入客户端/服务器协议。（即：穿墙，传送......服务器端现在必须检查，这反过来又导致通过注入修补漏洞之间的开发竞赛（耗时）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-16T06:36:57.507

@Samuel & coxymla：

这并不完全正确。如果协议使用异步加密，其中客户端不知道服务器的私钥，则机器人无法解密客户端的出口。这意味着要修改传出数据，机器人实际上必须挂钩游戏进程并在数据加密之前拦截数据。

这在理论上很简单，但在技术上可能具有挑战性。至少你提高了攻击者的门槛。

@Zombies：除了初始密钥交换之外，大多数加密方案不需要额外的数据传输。此外，虽然使用加密时需要做额外的工作，但数据传输肯定会受到网络而不是处理器的限制。

简而言之，加密不会导致更慢/更多的数据传输。

注意事项：[此 Wikipedia 页面](http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation)包含有关 Phantasy Star Online 的开发人员所犯的常见加密错误的故事。值得一读。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T05:38:42.723

为您的数据包添加加密只会使编写机器人的人慢几秒钟。您的客户端需要知道如何加密以将数据发送到服务器以及如何解密来自服务器的数据，机器人也需要知道。

关于防止通过墙壁翘曲，您应该始终进行这些检查。永远不要相信用户的输入，即使您自己编写了客户端。

正如[fastcall](https://stackoverflow.com/questions/449497/mmorpg-protocol-encryption#449592)所提到的，您仍然应该对某些数据进行加密。特别是那些包含敏感数据的，比如登录和聊天。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T05:31:58.260

至少，MMO 的登录协议应该是加密的，这样玩家网络上的人就无法通过数据包嗅探他们的帐户信息。

这个原因可以很容易地扩展到播放器发送的其他数据。例如，与其他玩家的聊天可能包含敏感信息。如果游戏已经遇到了为登录过程设置加密协议的麻烦，那么完成后可能没有太多理由将其关闭。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T05:43:19.377

我的印象是，主要的 MMO 都没有使用加密数据传输。正如塞缪尔所说，您并没有真正从中获得任何安全性，因为客户端也必须能够加密和解密数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T06:57:14.470

这无关紧要。我想加密诸如登录信息和会话信息之类的元数据，然后以明文形式发送游戏机制数据。毕竟，服务器无论如何都不能信任客户端（没有被黑客入侵）。

大多数 hack bot 都会挂接到正在运行的游戏进程中，并且无论如何都会使用它的内存，这是完全无法检测到的——它们通常会进行一些签名识别，试图检测在内存中运行的已知 hackbot，但否则这基本上是无用的。

另一种发现黑客机器人的可能技术是从已知的游戏模式中发现游戏模式。

加密数据无济于事，因为黑客机器人在内存中攻击客户端。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-20T10:36:27.883

If you have the time, this [one+ hour video](http://vimeo.com/1808631) about netcode has a part about encryption (among other things such as client synchronization and packet compression).

The relevant quote from the video is this: CPU is cheap. Just encrypt it, you have enough CPU time to encypt and the benefit of encrypting is high (clients won't see your client's commands, increases the bar for hacking, etc).

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-01-16T04:23:19.040

开发人员应该在他们的协议中添加加密的主要原因是营销原因。他们只需要确保他们的服务器只是一个（例如，如果他们将（或已经）想要成为付费会员）并且没有人会在发现协议后编写自己的服务器模拟器并免费提供.

# .net - 如何在不等待响应且不占用资源的情况下在 asp.net 中发送 http 请求

> ID：449506
> 
> 赞同：10
> 
> 时间：2009-01-16T04:21:52.380
> 
> 标签：.net, httpwebrequest

在 ASP.Net 应用程序中，我需要通过 http POST 将一些数据（urlEncodedUserInput）发送到外部服务器以响应用户输入，而不会阻止页面响应。来自另一台服务器的响应是什么并不重要，我不在乎请求有时是否失败。这似乎运行良好（见下文），但我担心它会在后台占用资源，等待永远不会使用的响应。

这是代码：

```
httpRequest = WebRequest.Create(externalServerUrl);

httpRequest.Method = "POST";
httpRequest.ContentType = "application/x-www-form-urlencoded;charset=utf-8";

bytedata = Encoding.UTF8.GetBytes(urlEncodedUserInput);
httpRequest.ContentLength = bytedata.Length;

requestStream = httpRequest.GetRequestStream();
requestStream.Write(bytedata, 0, bytedata.Length);
requestStream.Close(); 
```

非常标准的东西，但是如果您想异步接收响应，通常此时您会调用 httpRequest.getResponse() 或 httpRequest.beginGetResponse() ，但这在我的场景中似乎没有必要。

我在做正确的事吗？我应该调用 httpRequest.Abort() 进行清理，还是可以防止请求在慢速连接上发送？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-16T04:37:33.223

我认为[Threadpool.QueueUserWorkItem](http://thevalerios.net/matt/2008/05/use-threadpoolqueueuserworkitem-with-anonymous-types/)是您正在寻找的。通过添加 lambda 和匿名类型，这可以非常简单：

```
var request = new { url = externalServerUrl, input = urlEncodedUserInput };
ThreadPool.QueueUserWorkItem(
    (data) =>
    {
         httpRequest = WebRequest.Create(data.url);

         httpRequest.Method = "POST";
         httpRequest.ContentType = "application/x-www-form-urlencoded;charset=utf-8";

         bytedata = Encoding.UTF8.GetBytes(data.input);
         httpRequest.ContentLength = bytedata.Length;

         requestStream = httpRequest.GetRequestStream();
         requestStream.Write(bytedata, 0, bytedata.Length);
         requestStream.Close();
         //and so on
     }, request); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-09T15:51:05.123

我能想到的唯一方法是让您发布的页面使用 ThreadPool.QueueUserWorkItem 打开一个线程，以便主线程在耗时的工作之前完成响应完全的。您应该知道，一旦主线程退出，您将无法访问 HttpContext，这意味着没有缓存、服务器变量等......共享驱动器也将无法工作，除非您在新线程中模拟具有权限的用户。线程很好，但有很多事情需要注意。

# sql-server - TSQL之谜，为什么我的更新不是随机的？

> ID：449512
> 
> 赞同：4
> 
> 时间：2009-01-16T04:26:41.933
> 
> 标签：sql-server, tsql

我正在查看 postgres 问题，它要求使用随机值更新表。

我在回答后才注意到它是针对 postgres 的，但在回答它时我遇到了一个谜。

这是我的示例代码：

```
create table #Buildings([Use] varchar(50), n int)

insert #Buildings
select null,null from sysobjects 

update #Buildings
set [Use] = 
        case (ABS(CAST(CAST(NEWID() AS VARBINARY) AS int)) % 6)
            when 0 then null
            when 1 then 'warehouse'
            when 2 then 'office'
            when 3 then 'market'
            when 4 then 'retail'
            when 5 then 'workshop'
            else 'HOW IS THIS POSSIBLE'
        end,
    n = ABS(CAST(CAST(NEWID() AS VARBINARY) AS int)) % 6

select [Use], count(*) from
#Buildings
group by [Use] 

select n, count(*) from
#Buildings
group by n 
```

它返回一个非常奇怪的结果集：

```
Use                                                
-------------------------------------------------- -----------
workshop                                           128
HOW IS THIS POSSIBLE                               633
NULL                                               287
retail                                             140
warehouse                                          258
market                                             177
office                                             209 
```

还有一个完全有意义的第二个结果集：

```
n           
----------- -----------
0           292
3           300
1           313
4           277
5           311
2           339 
```

两个结果集的数据是在同一个更新语句中生成的。

所以我的问题是为什么我的案例陈述中的数字超出了 0 - 5 的范围？那个号码是多少？为什么当我直接更新 int 时，东西会正确分布？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T04:57:12.433

我有个主意：

可能在每个 when 语句上都计算值，如果它到达第一个，计算一个非 0 的值，它进入第二个，然后计算一个非 1 的值，然后是下一个，依此类推，如果它使它是 5 的方式，然后计算一个 5 以外的数字，然后它会去其他地方。

这也可以解释为什么“这怎么可能”比其他的多得多，当当前位置和在该位置生成的随机数匹配时，其他的会增加。

你的意见？

编辑：我也在 sql server express 2008 中进行了测试，结果相同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T06:10:35.967

```
create table #Buildings([Use] varchar(50), n int)    
insert #Buildings
select null,null from sysobjects 

declare @i int

update #Buildings
set 
    @i = (ABS(CAST(CAST(NEWID() AS VARBINARY) AS int)) % 6),
    [Use] = 
        case @i -- if the expression is evaluated on-the-fly for each WHEN, MSSQL variable-in-SQL capability will alleviate this problem
                when 0 then null
                when 1 then 'warehouse'
                when 2 then 'office'
                when 3 then 'market'
                when 4 then 'retail'
                when 5 then 'workshop'
                else 'HOW IS THIS POSSIBLE'
        end,
    n = @i

select [Use], count(*) from
#Buildings
group by [Use] 

select n, count(*) from
#Buildings
group by n 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T05:53:27.640

约翰可能是对的……尽管它担心“何时”会如此低效。

另请注意，每次调用 NewId() 函数都会返回一个新值。您要调用它两次（不计算“何时”的怪异）。以下更稳定：drop table #Buildings go

创建表 #Buildings([Use] varchar(50), n int)

insert #Buildings select null,null from sysobjects

将@nid 声明为唯一标识符

update #Buildings set @nid = newid(), [Use] = case (ABS(CAST(CAST(NewId() AS VARBINARY) AS int)) % 6) 当 0 时为空，当 1 时为空，当 2 时为“仓库”，然后 ' office' 当 3 然后 'market' 当 4 然后 'retail' 当 5 然后 'workshop' 否则 '这怎么可能' 结束，n = ABS(CAST(CAST(NewId() AS VARBINARY) AS int)) % 6

选择 [使用], count(*) from

# 建筑物

按[使用]分组

选择 n, count(*) from

# 建筑物

按 n 分组

# c# - 使用 LINQ 从字符串中删除字符

> ID：449513
> 
> 赞同：14
> 
> 时间：2009-01-16T04:28:20.883
> 
> 标签：c#, linq

我试图通过编写一些简单的扩展方法来复习我的 LINQ。有没有更好的方法来编写如下这样的函数，从字符串中删除给定的字符列表（使用 LINQ）？

它有助于我想到 LINQ 首先依赖的扩展方法：

```
public static string Remove(this string s, IEnumerable<char> chars)
{
    string removeChars = string.Concat(chars);

    return new string(s.ToCharArray().Where(c => !removeChars.Contains(c)).ToArray());
} 
```

但这很丑陋。尔格 LINQ。

**我在 LINQ 语句中注意到的区别是我必须使用“选择”，而使用扩展方法，我不必这样做。**

```
/// <summary>Strip characters out of a string.</summary>
/// <param name="chars">The characters to remove.</param>
public static string Remove(this string s, IEnumerable<char> chars)
{
    string removeChars = string.Concat(chars);

    var stripped = from c in s.ToCharArray()
                   where !removeChars.Contains(c)
                   select c;

    return new string(stripped.ToArray());
} 
```

所以我想知道这（上面的最后一个片段）是否是完成字符删除的最简单的 LINQ 语句。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-16T05:36:04.337

我更喜欢带有扩展方法的第一种形式，尽管简化为

```
public static string Remove(this string s, IEnumerable<char> chars)
{
    return new string(s.Where(c => !chars.Contains(c)).ToArray());
} 
```

至于**选择**关键字，在第二种形式中是强制性的。[文档](http://msdn.microsoft.com/en-us/library/bb384087.aspx)说明了“查询表达式必须以 select 子句或 group 子句终止”。这就是为什么我会避免使用 LINQ 语法糖。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T05:19:51.513

试试这个简洁

```
public static string Remove(this string source, IEnumerable<char> chars) {
  return new String(source.Where(x => !chars.Contains(x)).ToArray());
} 
```

**编辑**

更新以更正它从源中删除重复项

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T13:21:53.767

就个人而言，我倾向于将第一种语法用于非关系情况。当我需要执行关系操作（连接）时，比如针对 SQL 的表达式树，我使用后者。但是，这只是因为它对我使用 SQL 一段时间后更具可读性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-13T16:08:31.400

使用 stringBuilder 而不是新字符串时，性能会有所提高。结果如下：

StringBuilder 00:00:13.9930633 新字符串 00:00:15.1495309

```
 string s = "ababababajjjaazsiajjsoajiojsioajlmmzaaokpdahgffaiojsia";
        var sw = new Stopwatch();
        sw.Start();
        var toRemove = new char[] { 'j', 'a', 'z' };
        for (int i = 0; i < 1000000; i++)
        {
            StringBuilder sb = new StringBuilder(s.Length, s.Length);
            foreach (var c in s) if (!toRemove.Contains(c)) sb.Append(c);
        }
        Console.WriteLine("StringBuilder " + sw.Elapsed);
        sw.Restart();
        for (int i = 0; i < 1000000; i++)
        {
            new string(s.Where(c => !toRemove.Contains(c)).ToArray());
        }
        Console.WriteLine("new String " + sw.Elapsed); 
```

# database - 讲解db标签存储方式

> ID：449517
> 
> 赞同：1
> 
> 时间：2009-01-16T04:30:02.393
> 
> 标签：database, database-design, tags

从这篇文章[什么是在数据库中存储标签的最有效方法？](https://stackoverflow.com/questions/334183/what-is-the-most-efficient-way-to-store-tags-in-a-database)

建议像这样存储标签表。

```
Table: Item
Columns: ItemID, Title, Content

Table: Tag
Columns: TagID, Title

Table: ItemTag
Columns: ItemID, TagID 
```

另一个 SO 帖子也说了同样的话。谁能解释为什么标签应该这样存储？我猜 ItemID 是一些内部 val，title 是标签名称（c++、sql、noob 等）内容是我想与我的项目一起存储的任何其他数据。为什么不喜欢

```
Table: Item
Columns: ItemID, Title, <more data i want>

Table: TagList
Columns: ItemID, Title 
```

项目中的标题为“项目名称”，标签标题为“c++”“sql”“noob”“etc”

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T05:43:09.860

您展示的第二种设计没有任何问题，即带有`TagList`桌子的设计，只是它占用了更多空间。

也就是说，如果您使用标签“database-design”标记 10,000 个项目，那么在两表设计中，您必须存储该字符串 10,000 次。如果空间效率更重要，您可以使用三表设计，它只会存储“database-design”10,000 次的 4 字节整数 ID。节省 10 * 10,000 字节。

`Tag`另一个区别是，在三表设计中，即使它们具有不同的整数 ID 值，表中也可以有多个具有相同字符串的行。所以在`ItemTag`表格中，它们看起来是不同的标签，你永远不会知道它们实际上被贴上了相似的标签。而在两表设计中，具有相同拼写的标签会隐式组合在一起。

还有一点：如果你需要更改标签的拼写，那么在两表设计中你必须更新很多行。在三表设计中，只需要更新一行。

`Tags`最后，如果您通常需要一个唯一标签列表，那么在三表设计中查询表格会更快，而不是`SELECT DISTINCT tag FROM TagList`每次需要唯一列表时都需要一个。后者只给你一个*正在使用*的标签列表，而不是所有符合条件的标签的列表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T04:37:49.727

为什么？已经正常化了。ItemID 将是主键（可能是代理项或身份），TagID 几乎可以肯定是代理项/身份，并且对于约束/性能，您将拥有唯一的约束和/或索引（甚至可能聚集在 tag.title 上）。

在您的示例中， TagList 将没有主键（除非两列都是主键），并且无法对其进行规范化以删除标签标题冗余（具有相同标签的两个项目将具有单独的条目）。此外，由于标签在第二个模型中本身并不是实体，因此它们不能通过另一个 ItemTag 表链接到不同类型的实体。

# c# - 在 SQL Server 中执行 sp_databases 时排除系统数据库

> ID：449523
> 
> 赞同：1
> 
> 时间：2009-01-16T04:37:35.983
> 
> 标签：c#, sql-server

我通过执行**sp_databases**存储过程来检索数据库列表。有什么办法可以从这个列表中排除系统数据库？我**不想**使用查询 SELECT name FROM dbo.sysdatabases where dbid > 6。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T05:21:58.607

sp_databases 没有参数。

您唯一能做的就是使用 INSERT EXEC 模式插入表 var，然后从表 var 中选择并排除要排除的 db。好像有点乱，能扩展一下这个问题的上下文吗？

这可行，但有点hacky：

```
create table #t (db_name varchar(255), db_size int, remarks text) 

insert #t 
exec sp_databases

select * from #t
where db_name not in ('master', 'model', 'tempdb', 'msdb') 
```

# php - PHP5：一些会话文件长度为 0？

> ID：449528
> 
> 赞同：1
> 
> 时间：2009-01-16T04:41:11.967
> 
> 标签：php, session

我看到一个奇怪的情况，我试图弄清楚它是 PHP 问题、文件问题还是正常操作。我有一些用户抱怨我们网站上的超时非常快（会话过期？），并检查 php tmp 目录，我看到这样的事情：

```
-rw------- 1 www-data www-data  377 2009-01-15 22:46 sess_fc789ce04a3d54ce929a401cd33ea868
-rw------- 1 www-data www-data 1167 2009-01-15 23:21 sess_fcb67b1f44a3669d8ffee69d5fa9a2e8
-rw------- 1 www-data www-data    0 2009-01-15 23:22 sess_fe0ab79c78c612d71ecca575753afdc4
-rw------- 1 www-data www-data    0 2009-01-15 23:07 sess_fedd46db2b023215cb060d67a01d3382
-rw------- 1 www-data www-data    0 2009-01-15 23:21 sess_feec900e144c011303a9f06eb428574e
-rw------- 1 www-data www-data    0 2009-01-15 23:00 sess_ffb2ed75ca311d08e41ec69c7d708d08
-rw------- 1 www-data www-data 1142 2009-01-15 22:49 sess_ffc2c882af3b3ad39b844dc5a530dc44
-rw------- 1 www-data www-data    0 2009-01-15 22:51 sess_fffbd6f7734ce3b4ef9d8009a324a459 
```

这是正常行为吗？

TIA 迈克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T02:50:47.283

有两种可能性浮现在脑海中，一种是您在共享主机环境中的磁盘空间不足，如果不是这种情况，那么您的网站可能会与其他会话超时的网站共享其会话目录。

gc_maxlifetime 设置默认为 1440 秒，但如果您与另一个设置低于此设置的网站共享相同的会话目录，那么它将过早删除您的会话，这来自 php 手册：

> 注意：如果不同的脚本具有不同的 session.gc_maxlifetime 值，但共享相同的存储会话数据的位置，则具有最小值的脚本将清理数据。在这种情况下，将此指令与 session.save_path 一起使用。

所以我建议将您的会话保存路径更改为 Web 服务器将具有写入权限的不同目录。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T04:58:48.140

我不确定你的意思，确切地说，但你可以尝试把：

```
<?php set_time_limit(100); ?> 
```

在每一页的顶部。也许？对不起 =/

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T04:59:21.040

```
<?php set_time_limit(100); ?> 
```

# xml - XML 阅读器是否应该忽略 XML 文件中的连续空格？

> ID：449532
> 
> 赞同：2
> 
> 时间：2009-01-16T04:44:49.667
> 
> 标签：xml, xmldom

在我的工作中，我们有自己的构建 DOM 的 XML 类，但我不确定应该如何处理连续的空白？

例如

```
<some-text>
Hello     World
</some-text> 
```

当它被读入 DOM 时，文本节点是否应该在 Hello 和 World 之间包含连续的空格，或者只是将其减少到一个空格？

或者 XML 源代码应该这样写：

```
<一些文本>
你好    世界
</some-text>

```

或者如果不是   比也许 ?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T11:09:07.830

听到人们甚至不看 XML 规范就实现 XML 处理器，这有点令人不安。

来自[XML 1.0 规范，第 2.10 节空白处理”](http://www.w3.org/TR/REC-xml/#sec-white-space)（强调我的）：

> 在编辑 XML 文档时，使用“空白”（空格、制表符和空行）来分隔标记以提高可读性通常很方便。这种空白通常不打算包含在文档的交付版本中。另一方面，应该在交付版本中保留的“重要”空白很常见，例如在诗歌和源代码中。
> 
> **XML 处理器必须始终将文档中未标记的所有字符传递给应用程序。**验证 XML 处理器还必须通知应用程序这些字符中的哪些构成出现在元素内容中的空白。
> 
> 一个名为 xml:space 的特殊属性可以附加到一个元素上，以表明在该元素中，应用程序应该保留空白。在有效文档中，如果使用此属性，则必须声明它，就像任何其他属性一样。声明时，它必须作为枚举类型给出，其值为“default”和“preserve”之一或两者。例如： ...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T05:02:38.507

`&nbsp;`是一个 HTML 实体，与 XML 本身无关。

不过，要回答您的问题，我认为这很重要。即使是 HTML DOM 也将连续的空格视为重要的，只是它仅在视觉上呈现一个空格。它在 DOM 中的显示方式和在屏幕上的显示方式是完全不同的两件事。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T04:47:52.547

编辑：标签中的空格被认为是重要的（我最初的想法是像 HTML 一样是错误的；先谷歌，稍后回答问题！）看[这个解释](http://www.usingxml.com/Basics/XmlSpace)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T04:50:50.903

IMO 在这种情况下将空格视为重要似乎很自然。我希望 DOM 节点的值等于我在标记中使用的值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-17T02:47:11.567

如果您“拥有我们自己的 XML 类”，而编写它们的人还不知道这个问题的答案，那么您可能还有很多很多很多的问题是您尚未发现的。

# css - CSS：带有文本的液体条不会展开

> ID：449533
> 
> 赞同：0
> 
> 时间：2009-01-16T04:46:03.127
> 
> 标签：css, width, scroll, elasticlayout

我有一个单杠，它被赋予`width`了`100%`. 在水平栏中，我有一个在`978px`容器内左对齐的文本。每当浏览器窗口缩小到小于`978px`宽度时，页面底部就会出现一个滚动条。每当我向右滚动时，栏不再跨越页面的宽度，而是留在后面。我明白为什么会发生这种情况，但我不知道该怎么做才能解决它。如果您有任何想法，请告诉我。谢谢！

[示例页面](http://www.efficientcode.com/p/help.html)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T05:25:31.987

好吧，您已将 #header 设置为 100% 的包含块（这将是主体）。当您缩小正文时，标题的宽度会缩小。如果主体的宽度小于容器的宽度，黑条将不会一直延伸。

你更希望它做什么？

- 没有滚动条：取出容器，使用#header 将文本居中

- 黑条扩大了整个距离：解决这个问题的最简单方法是给容器一个背景色。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T05:28:30.840

改变：

```
width: 978px; 
```

到：

```
max-width: 978px 
```

这似乎在 FF3、IE7 和 chrome 中起到了作用。

# git - 如何在 Git 中选择性地合并或选择来自另一个分支的更改？

> ID：449541
> 
> 赞同：1627
> 
> 时间：2009-01-16T04:55:08.973
> 
> 标签：git, git-merge, git-cherry-pick, git-patch

我在一个新项目上使用 Git，该项目有两个并行的——但目前是实验性的——开发分支：

*   `master`: 现有代码库的导入以及我通常确定的一些修改
*   `exp1`: 实验分支#1
*   `exp2`: 实验分支#2

`exp1`并`exp2`代表两种截然不同的架构方法。在我走得更远之前，我无法知道哪个（如果有的话）会起作用。当我在一个分支中取得进展时，我有时会进行一些对另一个分支有用的编辑，并且只想合并那些。

**将选择性更改从一个开发分支合并到另一个分支的最佳方法是什么？**

我考虑过的方法：

1.  `git merge --no-commit`然后手动取消暂存大量我不想在分支之间通用的编辑。

2.  手动将公共文件复制到临时目录中，然后`git checkout`移动到另一个分支，然后将更多手动文件从临时目录中复制到工作树中。

3.  上面的一个变种。暂时放弃`exp`分支并使用两个额外的本地存储库进行实验。这使得手动复制文件更加简单。

所有这三种方法似乎都很乏味且容易出错。我希望有更好的方法；类似于过滤器路径参数的东西，它会使`git-merge`选择性更强。

* * *

## 回答 #1

> 赞同：1077
> 
> 时间：2009-08-31T05:53:03.230

我遇到了与您上面提到的完全相同的问题。但我在解释答案时发现[这一点更清楚。](http://jasonrudolph.com/blog/2009/02/25/git-tip-how-to-merge-specific-files-from-another-branch/)

概括：

*   查看要合并的分支的路径，

    ```
     $ git checkout source_branch -- <paths>...

    Hint: It also works without `--` like seen in the linked post. 
    ```

*   或选择性地合并帅哥

    ```
     $ git checkout -p source_branch -- <paths>... 
    ```

或者，使用 reset 然后使用选项添加`-p`，

```
 $ git reset <paths>...
    $ git add -p <paths>... 
```

*   最后提交

    ```
     $ git commit -m "'Merge' these changes" 
    ```

* * *

## 回答 #2

> 赞同：532
> 
> 时间：2009-01-16T06:01:26.250

您可以使用[cherry-pick](http://schacon.github.com/git/git-cherry-pick.html)命令从一个分支获取单个提交。

如果您想要的更改不在单个提交中，则使用此处显示的方法[将提交拆分为单个提交](http://plasmasturm.org/log/530/)。粗略地说，您用于`git rebase -i`获取原始提交以进行编辑，然后`git reset HEAD^`选择性地还原更改，然后`git commit`将该位作为历史中的新提交提交。

[Red Hat Magazine 中还有另一种不错的方法](http://web.archive.org/web/20130727101330/http://magazine.redhat.com:80/2008/05/02/shipping-quality-code-with-git/)，如果您想将不同的更改拆分到单个文件（在该页面中搜索“拆分”），他们使用`git add --patch`或可能允许您仅添加部分数据。`git add --interactive`

拆分更改后，您现在可以只挑选您想要的。

* * *

## 回答 #3

> 赞同：405
> 
> 时间：2011-09-03T08:48:40.487

要有选择地将文件从一个分支合并到另一个分支，请运行

```
git merge --no-ff --no-commit branchX 
```

`branchX`您要合并到当前分支的分支在哪里。

该`--no-commit`选项将暂存已由 Git 合并的文件，而不实际提交它们。这将使您有机会根据需要修改合并的文件，然后自己提交它们。

根据您要合并文件的方式，有四种情况：

# 1）你想要一个真正的合并。

在这种情况下，您以 Git 自动合并文件的方式接受合并文件，然后提交它们。

# 2) 有些文件你不想合并。

例如，您希望保留当前分支中的版本并忽略要合并的分支中的版本。

要选择当前分支中的版本，请运行：

```
git checkout HEAD file1 
```

这将检索`file1`当前分支中的版本并覆盖`file1`Git 自动合并的版本。

# 3）如果您想要 branchX 中的版本（而不是真正的合并）。

跑：

```
git checkout branchX file1 
```

这将检索`file1`in的版本`branchX`并覆盖`file1`Git 自动合并的版本。

# 4）最后一种情况是，如果您只想选择特定的合并`file1`。

在这种情况下，您可以`file1`直接编辑修改后的内容，将其更新为您希望的任何版本`file1`，然后提交。

如果 Git 无法自动合并文件，它会将文件报告为“未*合并*”并生成一个副本，您需要在其中手动解决冲突。

* * *

为了进一步解释示例，假设您要合并`branchX`到当前分支：

```
git merge --no-ff --no-commit branchX 
```

然后运行该`git status`命令以查看已修改文件的状态。

例如：

```
git status

# On branch master
# Changes to be committed:
#
#       modified:   file1
#       modified:   file2
#       modified:   file3
# Unmerged paths:
#   (use "git add/rm <file>..." as appropriate to mark resolution)
#
#       both modified:      file4
# 
```

git 已成功自动合并的文件在哪里`file1`、`file2`和。`file3`

这意味着所有这三个文件的`master`和`branchX`的更改已组合在一起而没有任何冲突。

您可以通过运行`git diff --cached`;检查合并是如何完成的。

```
git diff --cached file1
git diff --cached file2
git diff --cached file3 
```

### 如果您发现某些合并不受欢迎，那么您可以

1.  直接编辑文件
2.  节省
3.  `git commit`

### 如果不想合并`file1`，想在当前分支中保留版本

跑

```
git checkout HEAD file1 
```

### 如果您不想合并`file2`并且只想要版本`branchX`

跑

```
git checkout branchX file2 
```

### 如果你想`file3`自动合并，不要做任何事情。

此时 Git 已经合并了它。

`file4`以上是 Git 的失败合并。这意味着在同一行上发生的两个分支中都有变化。这是您需要手动解决冲突的地方。您可以通过直接编辑文件或为要`file4`成为的分支中的版本运行 checkout 命令来放弃合并完成。

最后，别忘了`git commit`。

* * *

## 回答 #4

> 赞同：114
> 
> 时间：2009-05-21T03:00:21.950

我不喜欢上述方法。使用cherry-pick 非常适合选择单个更改，但是如果您想要引入所有更改（除了一些不好的更改），那就很痛苦了。这是我的方法。

没有`--interactive`参数可以传递给 git merge。

这是替代方案：

您在分支“功能”中有一些更改，并且您想以一种不马虎的方式将其中一些但不是全部带到“主控”（即您不想挑选并提交每个）

```
git checkout feature
git checkout -b temp
git rebase -i master

# Above will drop you in an editor and pick the changes you want ala:
pick 7266df7 First change
pick 1b3f7df Another change
pick 5bbf56f Last change

# Rebase b44c147..5bbf56f onto b44c147
#
# Commands:
# pick = use commit
# edit = use commit, but stop for amending
# squash = use commit, but meld into previous commit
#
# If you remove a line here THAT COMMIT WILL BE LOST.
# However, if you remove everything, the rebase will be aborted.
#

git checkout master
git pull . temp
git branch -d temp 
```

因此，只需将其包装在一个 shell 脚本中，将 master 更改为 $to 并将 feature 更改为 $from 就可以了：

```
#!/bin/bash
# git-interactive-merge
from=$1
to=$2
git checkout $from
git checkout -b ${from}_tmp
git rebase -i $to
# Above will drop you in an editor and pick the changes you want
git checkout $to
git pull . ${from}_tmp
git branch -d ${from}_tmp 
```

* * *

## 回答 #5

> 赞同：106
> 
> 时间：2012-08-28T18:47:17.393

还有另一种方法：

```
git checkout -p 
```

它是和之间的混合`git checkout`，`git add -p`并且可能正是您正在寻找的：

```
 -p, --patch
       Interactively select hunks in the difference between the <tree-ish>
       (or the index, if unspecified) and the working tree. The chosen
       hunks are then applied in reverse to the working tree (and if a
       <tree-ish> was specified, the index).

       This means that you can use git checkout -p to selectively discard
       edits from your current working tree. See the “Interactive Mode”
       section of git-add(1) to learn how to operate the --patch mode. 
```

* * *

## 回答 #6

> 赞同：65
> 
> 时间：2011-08-25T01:31:22.263

虽然其中一些答案非常好，但我觉得没有人真正回答了 OP 的原始约束：从特定分支中选择特定文件。这个解决方案可以做到这一点，但如果有很多文件，它可能会很乏味。

假设您有`master`、`exp1`和`exp2`分支。您想将每个实验分支中的一个文件合并到 master 中。我会做这样的事情：

```
git checkout master
git checkout exp1 path/to/file_a
git checkout exp2 path/to/file_b

# Save these files as a stash
git stash

# Merge stash with master
git merge stash 
```

这将为您提供所需的每个文件的文件内差异。而已。一点也不差。在版本之间进行完全不同的文件更改很有用——在我的例子中，将应用程序从[Ruby on Rails](https://en.wikipedia.org/wiki/Ruby_on_Rails) 2 更改为 Ruby on Rails 3。

这将合并文件，但它会进行智能合并。我无法弄清楚如何使用这种方法来获取文件内差异信息（也许它仍然会产生极端差异。除非你使用该`-s recursive -X ignore-all-space`选项，否则像空格这样烦人的小东西会被合并回来）

* * *

## 回答 #7

> 赞同：54
> 
> 时间：2009-05-07T11:38:51.973

[1800 INFORMATION的回答](https://stackoverflow.com/questions/449541/how-can-i-selectively-merge-or-pick-changes-from-another-branch-in-git/449632#449632)是完全正确的。但是，作为 Git 的新手，“使用 git cherry-pick”不足以让我在没有更多的互联网挖掘的情况下弄清楚这一点，所以我想我会发布一个更详细的指南，以防其他人在类似的船上。

我的用例是希望有选择地将其他人的 GitHub 分支中的更改提取到我自己的分支中。如果您已经有一个包含更改的本地分支，则只需执行步骤 2 和 5-7。

1.  使用您要引入的更改创建（如果未创建）本地分支。

    `$ git branch mybranch <base branch>`

2.  切换进去。

    `$ git checkout mybranch`

3.  从其他人的帐户中提取您想要的更改。如果您还没有，您需要将它们添加为遥控器。

    `$ git remote add repos-w-changes <git url>`

4.  从他们的树枝上拉下所有东西。

    `$ git pull repos-w-changes branch-i-want`

5.  查看提交日志以查看您想要的更改：

    `$ git log`

6.  切换回要将更改拉入的分支。

    `$ git checkout originalbranch`

7.  Cherry 用哈希值一一挑选你的提交。

    `$ git cherry-pick -x hash-of-commit`

* * *

## 回答 #8

> 赞同：44
> 
> 时间：2013-07-29T08:37:12.800

以下是如何将分支中的`Myclass.java`文件替换为`master`分支`Myclass.java`中的文件`feature1`。即使在`Myclass.java`上不存在它也会起作用`master`。

```
git checkout master
git checkout feature1 Myclass.java 
```

请注意，这将覆盖（而不是合并）并忽略主分支中的本地更改。

* * *

## 回答 #9

> 赞同：31
> 
> 时间：2012-02-27T22:42:08.593

简单的方法，实际*合并*来自两个分支的特定文件，而不仅仅是用来自另一个分支的文件替换特定文件。

## 第一步：区分分支

`git diff branch_b > my_patch_file.patch`

创建当前分支和branch_b之间差异的补丁文件

## 第二步：对匹配模式的文件应用补丁

`git apply -p1 --include=pattern/matching/the/path/to/file/or/folder my_patch_file.patch`

### 关于选项的有用说明

您可以`*`在包含模式中用作通配符。

不需要转义斜线。

此外，您可以改用 --exclude 并将其应用于除与模式匹配的文件之外的所有内容，或使用 -R 反转补丁

-p1 选项是 *Unix 补丁命令的保留，补丁文件的内容在每个文件名前面加上`a/`或`b/`（或更多取决于补丁文件的生成方式），您需要删除它，以便它可以计算将实际文件输出到需要应用补丁的文件的路径。

查看 git-apply 的手册页以获取更多选项。

## 第三步：没有第三步

显然你想提交你的更改，但谁说你在提交之前没有其他相关的调整。

* * *

## 回答 #10

> 赞同：25
> 
> 时间：2012-09-27T02:55:45.240

以下是如何让历史记录跟踪来自另一个分支的几个文件，而无需大惊小怪，即使更“简单”的合并会带来更多您不想要的更改。

首先，您将采取不同寻常的步骤，提前声明您将要提交的是一个合并，而 Git 对您工作目录中的文件根本不做任何事情：

```
git merge --no-ff --no-commit -s ours branchname1 
```

...其中“分支名称”是您声称要合并的任何内容。如果您要立即提交，它不会做任何更改，但它仍会显示来自另一个分支的祖先。如果需要，您也可以在命令行中添加更多分支、标签等。不过，此时没有要提交的更改，所以接下来从其他修订版中获取文件。

```
git checkout branchname1 -- file1 file2 etc. 
```

如果您从多个其他分支合并，请根据需要重复。

```
git checkout branchname2 -- file3 file4 etc. 
```

现在来自另一个分支的文件在索引中，准备好提交，并带有历史记录。

```
git commit 
```

您将在该提交消息中进行大量解释。

但请注意，如果不清楚，这是一件搞砸的事情。它不符合“分支”的精神，而cherry-pick是一种更诚实的方式来做你想做的事情，在这里。如果您想对上次未带入的同一分支上的其他文件进行另一次“合并”，它将以“已经是最新的”消息阻止您。这是我们应该有的时候没有分支的症状，因为“来自”分支应该不止一个不同的分支。

* * *

## 回答 #11

> 赞同：18
> 
> 时间：2010-02-18T04:28:19.650

这是我合并选择性文件的工作流程。

```
# Make a new branch (this will be temporary)
git checkout -b newbranch

# Grab the changes
git merge --no-commit  featurebranch

# Unstage those changes
git reset HEAD
(You can now see the files from the merge are unstaged)

# Now you can chose which files are to be merged.
git add -p

# Remember to "git add" any new files you wish to keep
git commit 
```

* * *

## 回答 #12

> 赞同：17
> 
> 时间：2013-10-29T20:54:31.263

最简单的方法是将存储库设置为要合并的分支，然后运行

```
git checkout [branch with file] [path to file you would like to merge] 
```

如果你跑

```
git status 
```

你会看到文件已经暂存...

然后运行

```
git commit -m "Merge changes on '[branch]' to [file]" 
```

简单的。

* * *

## 回答 #13

> 赞同：16
> 
> 时间：2014-07-03T04:29:55.433

奇怪的是，git 还没有“开箱即用”这么方便的工具。当仅通过当前版本分支中的**一些**错误修复来更新一些旧版本分支（仍然有很多软件用户）时，我会大量使用它。在这种情况下，通常需要从主干文件中快速获取**一些**代码行，忽略许多其他更改（不应该进入旧版本）......当然还有**交互式三向**合并在这种情况下需要，`git checkout --patch <branch> <file path>`不可用于此选择性合并目的。

**你可以轻松做到：**

只需将此行添加到`[alias]`全局`.gitconfig`或本地`.git/config`文件中的部分：

```
[alias]
    mergetool-file = "!sh -c 'git show $1:$2 > $2.theirs; git show $(git merge-base $1 $(git rev-parse HEAD)):$2 > $2.base; /C/BCompare3/BCompare.exe $2.theirs $2 $2.base $2; rm -f $2.theirs; rm -f $2.base;' -" 
```

这意味着您使用 Beyond Compare。如果需要，只需更改为您选择的软件。或者，如果您不需要交互式选择性合并，您可以将其更改为三向自动合并：

```
[alias]
    mergetool-file = "!sh -c 'git show $1:$2 > $2.theirs; git show $(git merge-base $1 $(git rev-parse HEAD)):$2 > $2.base; git merge-file $2 $2.base $2.theirs; rm -f $2.theirs; rm -f $2.base;' -" 
```

然后像这样使用：

```
git mergetool-file <source branch> <file path> 
```

这将为您提供其他分支中任何文件的真正选择性**树方式合并机会。**

* * *

## 回答 #14

> 赞同：14
> 
> 时间：2013-11-04T10:51:34.490

我发现[这篇文章](http://jasonrudolph.com/blog/2009/02/25/git-tip-how-to-merge-specific-files-from-another-branch/)包含最简单的答案。只需这样做：

```
git checkout <branch from which you want files> <file paths> 
```

### 例子

将 .gitignore 文件从 branchB 拉到当前分支：

```
git checkout branchB .gitignore 
```

有关更多信息，请参阅帖子。

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2012-06-19T10:15:42.790

我遇到了与您上面提到的完全相同的问题。但我发现[这个 Git 博客](http://jasonrudolph.com/blog/2009/02/25/git-tip-how-to-merge-specific-files-from-another-branch/)在解释答案时更加清晰。

来自上述链接的命令：

```
# You are in the branch you want to merge to
git checkout <branch_you_want_to_merge_from> <file_paths...> 
```

* * *

## 回答 #16

> 赞同：9
> 
> 时间：2016-02-09T01:02:52.680

它不完全是您想要的，但它对我很有用：

```
git checkout -p <branch> -- <paths> ... 
```

这是一些答案的混合。

* * *

## 回答 #17

> 赞同：8
> 
> 时间：2011-01-26T10:50:17.233

我会做一个

> git diff commit1..commit2 文件模式 | git-apply --index && git commit

通过这种方式，您可以限制来自分支的文件模式的提交范围。

它是从*[Re: 如何只将几个文件从一个分支拉到另一个分支的？](http://www.gelato.unsw.edu.au/archives/git/0701/37964.html)*

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2011-12-09T19:46:52.703

我喜欢[之前](https://stackoverflow.com/a/891222/1871)的“git-interactive-merge”答案，但有一个更简单的。让 Git 使用交互式和到的 rebase 组合为您执行此操作：

```
 A---C1---o---C2---o---o feature
     /
----o---o---o---o master 
```

所以情况是你想要'feature'分支（分支点'A'）中的C1和C2，但现在没有其他的。

```
# git branch temp feature
# git checkout master
# git rebase -i --onto HEAD A temp 
```

与前面的答案一样，它会将您带到交互式编辑器中，您可以在其中为 C1 和 C2 选择“选择”行（如上所述）。保存并退出，然后它将继续进行 rebase 并在 master + C1 + C2 处为您提供分支“temp”和 HEAD：

```
 A---C1---o---C2---o---o feature
     /
----o---o---o---o-master--C1---C2 [HEAD, temp] 
```

然后您可以将 master 更新为 HEAD 并删除 temp 分支，您就可以开始了：

```
# git branch -f master HEAD
# git branch -d temp 
```

* * *

## 回答 #19

> 赞同：7
> 
> 时间：2019-04-01T22:08:02.457

对我来说，`git reset --soft branch`这是从另一个分支中选择性地选择更改的最简单方法，因为此命令将所有差异更改放入我的工作树中，我可以轻松地选择或恢复我需要的那个。

通过这种方式，我可以完全控制提交的文件。

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2011-05-27T01:33:15.090

我编写了自己的脚本“pmerge”来部分合并目录。这是一项正在进行的工作，我仍在学习 Git 和 Bash 脚本。

此命令使用`git merge --no-commit`然后取消应用与提供的路径不匹配的更改。

用法：`git pmerge branch path`
示例：`git merge develop src/`

我没有对它进行广泛的测试。工作目录应该没有任何未提交的更改和未跟踪的文件。

```
#!/bin/bash

E_BADARGS=65

if [ $# -ne 2 ]
then
    echo "Usage: `basename $0` branch path"
    exit $E_BADARGS
fi

git merge $1 --no-commit
IFS=$'\n'

# List of changes due to merge | replace nulls with newlines | strip lines to just filenames | ensure lines are unique
for f in $(git status --porcelain -z -uno | tr '\000' '\n' | sed -e 's/^[[:graph:]][[:space:]]\{1,\}//' | uniq); do
    [[ $f == $2* ]] && continue
    if git reset $f >/dev/null 2>&1; then
        # Reset failed... file was previously unversioned
        echo Deleting $f
        rm $f
    else
        echo Reverting $f
        git checkout -- $f >/dev/null 2>&1
    fi
done
unset IFS 
```

* * *

## 回答 #21

> 赞同：6
> 
> 时间：2016-02-25T18:25:39.020

您可以使用`read-tree`将给定的远程树读取或合并到当前索引中，例如：

```
git remote add foo git@example.com/foo.git
git fetch foo
git read-tree --prefix=my-folder/ -u foo/master:trunk/their-folder 
```

要执行合并，请`-m`改用。

另请参阅：*[如何在 Git 中合并子目录？](https://stackoverflow.com/q/1214906/55075)*

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2017-11-22T17:25:26.540

按文件选择性合并/提交的简单方法：

```
git checkout dstBranch
git merge srcBranch

// Make changes, including resolving conflicts to single files
git add singleFile1 singleFile2
git commit -m "message specific to a few files"
git reset --hard # Blow away uncommitted changes 
```

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2017-10-07T19:49:36.253

当两个分支的当前提交之间只有几个文件发生更改时，我通过浏览不同的文件手动合并更改。

`git difftool <branch-1>..<branch-2>`

另请参阅 [https://sites.google.com/site/icusite/setup/git-difftool](https://sites.google.com/site/icusite/setup/git-difftool)

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2018-10-16T18:15:48.053

如果您没有太多已更改的文件，这将使您没有额外的提交。

**1\. 临时复制分支**
`$ git checkout -b temp_branch`

**2\. Reset to last Wanted commit**
`$ git reset --hard HEAD~n` ,`n`你需要返回的提交数在哪里

**3.从原始分支签出每个文件**
`$ git checkout origin/original_branch filename.ext`

现在，如果需要，您可以提交并强制推送（覆盖远程）。

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2018-11-06T16:35:35.917

如果您只需要合并一个特定的目录并保留其他所有内容并保留历史记录，您可以尝试这个...在实验之前创建一个新`target-branch`目录`master`。

下面的步骤假设你有两个分支`target-branch`和，你要合并`source-branch`的目录在. 还假设您在目标中有其他目录，您不想更改和保留历史记录。此外，假设.`dir-to-merge``source-branch``dir-to-retain``dir-to-merge`

```
git checkout target-branch
git merge --no-ff --no-commit -X theirs source-branch
# the option "-X theirs", will pick theirs when there is a conflict. 
# the options "--no--ff --no-commit" prevent a commit after a merge, and give you an opportunity to fix other directories you want to retain, before you commit this merge.

# the above, would have messed up the other directories that you want to retain.
# so you need to reset them for every directory that you want to retain.
git reset HEAD dir-to-retain
# verify everything and commit. 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2021-05-02T21:30:39.460

我将专注于我感兴趣的这个问题的子集：我有两个分支，我想将***一个文件*****从一个文件****伪合并到另一个文件中。**

 *（我说“伪合并”是因为我不需要或不想要合并提交；我只想以我认为合适的方式组合文件的两个版本的贡献。）

我的方法基于[https://stackoverflow.com/a/39916536/341994](https://stackoverflow.com/a/39916536/341994)中采用的方法。不幸的是，该问题已作为重复项关闭（错误地，在我看来：它不是该问题的重复项，并且回答者在那里所做的回答和关闭重复项是错误的）。但是这个答案有一些问题，所以我对方法进行了现代化和清理。而不是`checkout`and `reset`，我使用`restore`, 并且我不会费心去做任何我不需要做的事情。

好的，想象一下我有三个文件：

```
$ ls
a   b   f 
```

但我只想伪合并其中一个，`a`，来自`otherbranch`。让我们看看他们，看看情况会是什么样子。这是我的版本：

```
$ cat a
line one
line two
line three
line four
line five 
```

这是otherbranch的版本：

```
$ git show otherbranch:a
line one
line two edited
line three
line four
line five
line six 
```

现在这里的技巧是我们将使用索引作为便签本（毕竟，这就是它的用途）。因此，我们从确保将我们的版本复制到索引中开始（步骤 1）：

```
$ git add a 
```

现在（第 2 步）我们可以使用`restore`从以下位置获取版本`otherbranch`（现在，这`restore`比`checkout`它让我们说得更清楚）：

```
$ git restore --source otherbranch a 
```

乍一看，这看起来很糟糕。我们现在已经完全用来自的版本覆盖了我们的 a `otherbranch`，如您所见：

```
$ cat a
line one
line two edited
line three
line four
line five
line six 
```

但不用担心！之前版本的 a 仍在索引中，如您所见：

```
$ git diff a
diff --git a/a b/a
index abf51fa..333614b 100644
--- a/a
+++ b/a
@@ -1,6 +1,7 @@
 line one
-line two
+line two edited
 line three
 line four
 line five
+line six 
```

很好，现在我们已经为关键动作做好了准备（步骤 3）。我们对从工作树到索引的文件进行*交互式补丁。* `add`

我们可以说`git add -p a`开始交互式补丁过程，在这种情况下，我们一次只吃一大块。但在这种情况下，只有一个大块，我还是想编辑它，所以我说：

```
$ git add --e a 
```

结果是我们在编辑器中打开了一个差异补丁文件！它看起来像这样：

```
 line one
-line two
+line two edited
 line three
 line four
 line five
+line six 
```

通过仔细编辑，我们现在可以决定我们想要接受哪些部分以及我们不接受哪些部分。让我们接受“第六行”而不是“第二行已编辑”。所以我们编辑成这样：

```
 line one
 line two
 line three
 line four
 line five
+line six 
```

我们关闭编辑器并将补丁应用于 a 的索引版本。但我们还没有完成！a的`otherbranch`版本仍在工作树中：

```
$ cat a
line one
line two edited
line three
line four
line five
line six 
```

我们喜欢的版本在索引中，记得吗？为了得到它，（第 4 步）我们只需调用`git restore`简单明了的方法（同样，这是现代方式；比单个文件`restore`更好`reset`并且可以应用于单个文件）：

```
$ git restore a 
```

现在我们的 a 是正确的，我们都完成了：

```
$ cat a
line one
line two
line three
line four
line five
line six 
```

此时我们可以提交，但我们不必这样做；我们已经完成了我们打算完成的事情。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2021-10-05T13:25:53.860

我想要什么：交互式地从一个分支（有几个混乱的提交）中挑选大块到一个新分支中的一个干净的提交中。

`git diff`如果该差异中有任何二进制文件， +`git apply`将不起作用。

我的做法：

```
# New branch from a clean starting point, e.g. master
git checkout new-clean-branch origin/master

# Get all changes from the messy branch
# (quote the star so your shell doesn't expand it)
git checkout messy-branch -- '*'

# Unstage ("un-add") everything
git restore --staged .

# Interactively add hunks to be staged for commit
git add -p 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2021-11-20T16:40:17.383

如果你是**Gitkraken**用户[，这里有一个小指南](https://support.gitkraken.com/working-with-commits/cherrypick/)

总之：

1.  移动到要进行更改的分支。（例如开发）
2.  右键单击有新更改的分支并选择“ **cherrypick commit** ”选项（例如，功能-ABC）。
3.  最后接受并检查是否存在冲突。

# linq - 像 LINQ、WPF、WF 这样的技术只是库还是改变开发的方法？

> ID：449542
> 
> 赞同：-1
> 
> 时间：2009-01-16T04:55:59.520
> 
> 标签：linq

最近，Microsoft 不断推出新技术 Linq、WF、WPF 等……在我看来，它们就像技术创新一样完全改变了您的应用程序的设计和编码方式。

然而，它们基于相同的底层框架（2.0）如果我查看 Java，有很多提供关键功能的库（例如 Hibernate、Spring），但它们仍然被认为只是库。

所以我的问题是，**人们是否认为这些技术真的改变了我们编写 Windows 代码的方式？**是否值得学习 Microsoft 在 Visual Studio 版本中推出的每种开发方法。

**或者这只是炒作。**然而，作为图书馆，它们很重要，但对于完成工作并不重要。他们会产生如此大的影响吗？我学会了，这会极大地影响我作为开发人员的未来吗？

编辑：对于一些已实现的语言期货也是如此。一些正在改变我们的编程方式（泛型） 其他的则不那么重要（部分类） 这使得学习泛型成为学习 .NET 的关键部分，这与学习使用部分类不同

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T05:13:30.043

对我来说，技术创新改变了用户对计算机的感觉以及与计算机交互的方式。谷歌搜索和基于电话的应用程序就是每个人都经历过的很好的例子。在最新的 Microsoft 技术堆栈中，我认为只有 WPF 具有创新性。它实际上允许开发人员创建新的令人惊叹的 UI，而以前这些 UI 太昂贵或无法构建。然后，这会改变用户与我们软件的交互方式。其余的只是一堆工具（库），供开发人员放入他的工具包中，以便在需要时/如果需要时取出。没有它们，您当然可以编写出色的应用程序。

实际上，我开始发现不断涌现的新 MS 开发“改进”开始让开发人员变得更糟糕。现在没有时间专注于学习业务、创建出色的界面、与用户交谈、测试和设计可维护的应用程序；我们几乎没有时间跟上流行语和新图书馆。

不要误会我的意思。Linq 很棒（尤其是在 xml 上），但它不允许我完成以前使用 ADO.net（或之前的 ADO 或 DAO 或 OLEDB）无法完成的任何事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T05:18:03.360

鉴于许多新技术，我认为选择“获胜”技术比学习新东西要困难得多（因为一切都是很久以前发明的:)）例如，我对 WF 非常感兴趣——我是将这项技术视为软件开发中真正的巨大转变，但当我深入挖掘时发现我应该等到 vNext 才能利用广告中的奖金。LINQ/WPF 等其他技术确实提高了我的工作效率。开发人员在选择技术时应该谨慎。我教自己不要跳到每一个过马路的潮流，但学习一些新的“解决所有问题”技术仍然很诱人:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T05:17:55.980

新的库和技术一直在出现。以 GUI 开发为例，您可以通过多种方式开发 GUI 应用程序。有些跨平台有些不是。有些更“设计师友好”，有些则不是。这些事情一直在变化，我认为，至少在一段时间内，它们将继续变化。您可以随心所欲地调用这些不同的方法，但这确实是营销。它是一个 API 吗？一种新的方法？有关系吗？这是一种不同的方式来做一些在某些情况下可能对某些人来说很方便的事情。

归根结底，这些 API 或方法或任何你想称呼它们的东西都只是工具。您学习了一种新工具并将其应用到您的手艺中，当有更好的工具可用时，您将学习使用*它*或让您的技能褪色。那么新工具会改变我们编写代码的方式吗？当然。但他们改变了我们的工艺吗？绝对不。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T05:30:38.887

它针对哪个版本的 CLR 是否重要？您 PC 上的每个软件都针对 x86 架构，这是否意味着它们都是相同的技术？

此外，它们是库还是技术有关系吗？这有什么不同吗？

无论如何，您提到的产品彼此之间没有太大关系（除了由微软制造）。

LINQ 是一种语言功能，它内置于 C# 或 VB（或其他 .NET 语言）编译器中，并且语言语法已扩展以适应 LINQ。这意味着它当然不仅仅是一个图书馆。

另一方面，WPF 不是该语言的一部分。您可以将其称为库、框架或您喜欢的任何其他术语。

这些中的任何一个是否会改变您的编程方式？也许。LINQ 确实提供了以前没有的东西，至少对我来说，它从根本上改变了我编写 C# 的方式。这也让我的工作效率更高。

WPF 有点微妙，因为当然已经存在大量的 GUI 库。但是 WPF 仍然提供了很多便利，并且能够比我所知道的任何其他 Windows 兼容库更容易地完成一些非常漂亮的图形内容。在 WPF 之前，让您在 2d GUI 应用程序中使用 GPU 着色器并不容易，因此，至少在某些方面，WPF 有可能改变您的编程方式。

是的，Spring for Java 也是如此。

# javascript - 我可以使用 Javascript 检测 XHTML 解析错误吗？

> ID：449551
> 
> 赞同：1
> 
> 时间：2009-01-16T05:01:45.343
> 
> 标签：javascript, xhtml, error-logging, parsing-error

当我的 XHTML 页面中出现标记错误时，Mozilla Firefox 会显示“黄屏死机”，仅在黄色背景上显示一条大的红色错误消息。

虽然这些错误很少见，但它们对用户*非常*不友好。

有没有办法可以使用 Javascript 检测到这些，从而将消息发送回服务器？

到目前为止我发现了什么： - 在解析错误之前放置的脚本仍然运行。（当然。） - 在这些脚本中设置的超时和间隔在解析错误后仍将执行。- 在 Firefox 中，DOM 是一个里面`<parsererror>`有一个。`<sourcetext>`如果我查询，我可以检测到这一点`document.firstChild.tagName`。

剩下的问题： - 我可以监听哪些事件来检测这种情况的发生？（轮询很烂。） - 我如何在其他浏览器中检测到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T05:36:00.950

在客户端捕获解析错误可能是可能的，但它确实解决了错误的问题。

我知道这不是您所要求的，但除非您正在做一些真正特定于 XHTML 的事情，例如嵌入一些其他标记语言，否则您应该将您的页面作为 text/html 而不是 application/xhtml+xml。即使它是 XHTML。通过将其作为 text/html 提供，您将避免遇到的问题，并允许您的页面也可以在 IE 中工作。请注意，确定使用哪个解析器的是 MIME 类型而不是 doctype 声明——使用过渡 doctype 不会这样做。

也就是说，如果您真的确定您希望您的页面被解析为 XHTML，那么最好在服务器上处理这种错误。通过构建 DOM 生成页面，然后发送序列化结果。如果这不是一个选项，那么首先像现在一样生成页面，但不要将其传输给客户端。获取您生成的 XHTML，并使用验证 XHTML 解析器（或至少是通用 XML 解析器）在服务器端解析它。如果您遇到错误，请显示您想要的任何错误页面。否则，序列化解析的 DOM 并将其发送给客户端。

综上所述，使用application/xhtml+xml的基本规则是：

1.  不。
2.  （对于高级用户）不要，除非您已经证明如果页面以 text/html 形式提供，您正在做的事情将无法正常工作。这适用于 XHTMl 文档的一小部分。
3.  如果您必须将您的页面作为 application/xhtml+xml 提供，请使用某种保证有效性的方法生成它。
4.  除非您*真的*知道自己在做什么，否则*永远不要*将 application/xhtml+xml 用于包含用户输入的页面。

请记住，XHTML 只是 HTML 4 的重新表述加上嵌入其他语言的能力。如果您不使用嵌入，那么您所拥有的是具有不同但几乎完全兼容的语法的 HTML 4。绝大多数 XHTML 文档以 text/html 形式提供，因此被浏览器视为 HTML 4。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T05:07:10.697

这并不能回答您的问题，而是为什么不在您的服务器上验证您的 XHTML，在您生成它之后/当您将它发送到浏览器之前？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T05:40:42.923

我的第一个问题是：既然 Internet Explorer 不允许您将 application/xhtml+xml 指定为 mime 类型，也不能很好地支持它，为什么需要检测 XHTML 解析错误？

至于检测错误 - 看看[http://www.quirksmode.org](http://www.quirksmode.org)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T09:40:15.543

我建议在服务器端验证文档。但是，如果您真的想在客户端执行此操作，则如果正确完成轮询，则没有任何问题（这意味着轮询保证会终止）。

以下*应该*至少在 Firefox 和 Opera 中工作：

```
(function() {
    if(document.documentElement &&
        document.documentElement.getAttribute('xmlns') !==
        'http://www.w3.org/1999/xhtml') {
        alert('parsing errors');
    }
    else if(document.body && document.body.lastChild) {
        alert('no parsing errors');
    }
    else setTimeout(arguments.callee, 100);
})(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T05:04:55.210

我知道这可能不是最有帮助的答案，但是您是否考虑过切换到过渡文档类型？

无论如何，将您的文件通过解析器来检测错误，但要离线进行 - 向用户展示 YSOD 的风险是不值得的！

# visual-studio-2008 - Setup.exe 和 autorun.inf

> ID：449555
> 
> 赞同：2
> 
> 时间：2009-01-16T05:04:54.727
> 
> 标签：visual-studio-2008, installation, project, autorun

我有 Visual Studio 2008 项目，我在该项目上添加了一个安装项目。它会生成所有文件以正确安装应用程序。

现在我正在尝试向 cd 添加一个 autorun.inf，它应该启动 Setup.exe。经过大量尝试和所有可能的组合后，没有任何效果，安装无法开始。我什至尝试了一个启动 Setup.exe 但没有用的批处理文件。

有什么我错过的，因为双击它可以工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T05:20:08.923

这个[autorun.inf 页面](http://autorun.moonvalley.com/)可能会有所帮助，尤其是关于无需刻录 CD 进行测试的链接。还要检查是否在 PC 上[启用了自动运行。](http://autorun.moonvalley.com/enable.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T05:24:41.550

我的两分钱...

*   您是否使用 [autorun] 开始了 autorun.inf 文件？
*   autorun.inf 文件末尾是否有任何尾随空行？
*   您确定在该 CD 驱动器上激活了自动运行功能吗？
*   您是否尊重语法：open=filename.exe /param1
*   您的 CD 驱动器是否在网络上（Windows 可能不允许程序在 Intranet 上自行执行）。

您可能已经检查过这一切两次。好运。

# java - Scalaris：P2P 键值数据库——请发表您的意见

> ID：449557
> 
> 赞同：1
> 
> 时间：2009-01-16T05:05:41.090
> 
> 标签：java, database, erlang, key-value

你为什么不使用[Scalaris](http://www.onscale.eu/scalaris.html)？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T17:55:27.233

如果没有磁盘持久性/快照系统，我不会使用它。我的印象是，内存数据库不是很可靠。如果集群只有 2 个节点可以停机进行维护，则数据将丢失。同样，如果 rz 停电，USV 只能提供几个小时的电力。

Oracle/DB2 数据库有很多灾难恢复特性！没有灾难恢复策略的 scalaris 上的业务关键数据？绝不。因此，scalaris 失去了对实际业务的影响。也许它是我见过的最好的分布式数据库，但如果没有这些特性，我不会使用它。

有一个 Java 连接器！但它是用 Erlang 编写的。有一个用 Java 或 JRuby 编写的 scalaris 可能会很好（它可以适应 Java 生态系统，这对业务有如此大的影响）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-17T22:46:12.123

如果您想要持久性到磁盘，请查看[riak 。](http://riak.basho.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-22T23:00:17.193

Scalaris 是用 Erlang 编写的，不知道你从哪里知道它基于 Java 的 [http://code.google.com/p/scalaris/](http://code.google.com/p/scalaris/)

他们首先解决了难题，更新协议，扩展等...添加磁盘持久性非常简单，很快就会添加我计划经常使用它

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-17T22:10:07.797

我认为 scalaris 更像是 memcached 的替代品，而不是像 voldemort 或 cassandra 这样的东西

# java - 离线 Java 文档

> ID：449558
> 
> 赞同：21
> 
> 时间：2009-01-16T05:05:53.540
> 
> 标签：java, documentation, offline

我终于开始学习 Java 并且正在寻找一些我可以下载和离线阅读的 Java 文档。类似于[Sun 的东西](http://java.sun.com/docs/books/tutorial/)，但被压缩或作为 PDF 或 CHM。

我正在使用 Eclipse，所以与它集成的东西会很好。它似乎已经在某处有一些我想要的东西（javadoc 的东西），但我看不到如何搜索它，也没有看到语言参考。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-16T05:09:57.447

Windows 帮助格式的完整文档 [http://javadoc.allimant.org/](http://javadoc.allimant.org/)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-16T05:30:59.010

我不确定我是否完全理解你的问题。

如果您对学习 Java 的资料（而不是 API 参考资料）感兴趣，您可以[将其全部下载为 zip 文件](http://java.sun.com/docs/books/tutorial/information/download.html)。这将是多个 HTML 文件，但除非我想要打印输出，否则我从未见过浏览它们的真正问题。如果您需要教程的打印输出，只需获取书籍形式的教程。

如果您正在寻找特定 API 的 JavaDocs，并且您使用 Eclipse，那么最好的选择可能是使用特定于 Java 并与 JDK 源代码打包在一起的 Eclipse 版本（或者只需下载源代码）。然后，您可以通过不同的视图（如 Java 浏览视图）阅读方法文档。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-16T13:40:27.460

在 Preferences->Java->Installed JREs 中使用[Sun JDK](https://cds.sun.com/is-bin/INTERSHOP.enfinity/WFS/CDS-CDS_Developer-Site/en_US/-/USD/ViewProductDetail-Start?ProductRef=jdk-6u11-oth-JPR@CDS-CDS_Developer)设置 Eclipse 进行 Java 开发后，您可以将[Sun javadoc](https://cds.sun.com/is-bin/INTERSHOP.enfinity/WFS/CDS-CDS_Developer-Site/en_US/-/USD/ViewProductDetail-Start?ProductRef=jdk-6u10-docs-oth-JPR@CDS-CDS_Developer)归档文件附加到相关 JRE。只需确保选择 JDK 安装目录作为 JRE 的根目录。Eclipse 将自动附加到那里的 src 存档。然后，当您创建 Java 项目时，您可以使用包资源管理器浏览类并通过在新项目中展开 JRE 系统库条目来阅读 javadoc。大多数 api 都在 rt.jar 中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-04-23T10:04:36.513

您也可以尝试[Apatite](http://edelstein.pebbles.cs.cmu.edu/apatite/)，它有助于通过关联学习大量 API。但我认为它不能离线使用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-16T05:11:45.930

阅读 JavaDocs。尤其是 java.util.Collections 框架。核心 Java 库大部分都有很好的文档记录。

我也倾向于浏览源代码以更好地了解事物的工作原理。您应该 java src.zip 设置，以便您可以在 JDK 类中浏览。它还会教你好的设计；向高手学习！

在eclipse中记住一些非常有用的命令：

**Ctrl-Shift-T** Open Type：在键入类名时搜索，选择它可以直接跳转到它。您不需要知道包，它通过简单的名称搜索所有类。

**F4** 打开类型层次结构。将光标放在源代码中的任何类引用或包资源管理器中的类上，按 F4 将打开类型层次结构。

**Ctrl-T**快速类型层次结构。它类似于 F4，但会打开一个快速弹出式浏览器。很方便。我最喜欢的用途是将它放在一个接口上，Ctrl-T 将列出所有实现类。

# python - 如何确定 Python 中对象的大小？

> ID：449560
> 
> 赞同：889
> 
> 时间：2009-01-16T05:07:12.617
> 
> 标签：python, object, memory, memory-management, sizeof

我想知道如何在 Python 中获取字符串、整数等对象的大小。

相关问题：[Python 列表（元组）中每个元素有多少字节？](https://stackoverflow.com/questions/135664/how-many-bytes-per-element-are-there-in-a-python-list-tuple)

我正在使用一个 XML 文件，其中包含指定值大小的大小字段。我必须解析这个 XML 并进行编码。当我想更改特定字段的值时，我会检查该值的大小字段。这里我想比较一下我要输入的新值是否与XML中的大小相同。我需要检查新值的大小。如果是字符串，我可以说它的长度。但在 int、float 等情况下，我很困惑。

* * *

## 回答 #1

> 赞同：823
> 
> 时间：2009-01-16T10:42:37.743

只需使用模块[`sys.getsizeof`](http://docs.python.org/library/sys.html#sys.getsizeof)中定义的功能。`sys`

> `sys.getsizeof(object[, default])`：
> 
> 返回对象的大小（以字节为单位）。对象可以是任何类型的对象。所有内置对象都将返回正确的结果，但这对于第三方扩展不一定适用，因为它是特定于实现的。
> 
> 仅考虑直接归因于对象的内存消耗，而不考虑它所引用的对象的内存消耗。
> 
> 该`default`参数允许定义一个值，如果对象类型不提供检索大小的方法并会导致 `TypeError`.
> 
> `getsizeof`如果对象由垃圾收集器管理，则调用对象的 `__sizeof__`方法并增加额外的垃圾收集器开销。
> 
> 有关使用递归查找容器大小及其所有内容的示例，请参见[recursive sizeof recipe 。](https://code.activestate.com/recipes/577504)`getsizeof()`

使用示例，在 python 3.0 中：

```
>>> import sys
>>> x = 2
>>> sys.getsizeof(x)
24
>>> sys.getsizeof(sys.getsizeof)
32
>>> sys.getsizeof('this')
38
>>> sys.getsizeof('this also')
48 
```

如果你在 python < 2.6 并且没有`sys.getsizeof`你可以使用[这个扩展模块](http://code.activestate.com/recipes/546530/)。不过从来没用过。

* * *

## 回答 #2

> 赞同：516
> 
> 时间：2015-05-19T04:26:33.410

> ## 如何确定 Python 中对象的大小？

答案，“只是使用`sys.getsizeof`”，不是一个完整的答案。

该答案直接适用于内置对象，但它*不*考虑这些对象可能包含的内容，特别是自定义对象、元组、列表、字典和集合等包含的类型。它们可以包含彼此的实例，也可以包含数字、字符串和其他对象。

## 更完整的答案

使用 Anaconda 发行版中的 64 位 Python 3.6 和`sys.getsizeof`，我已经确定了以下对象的最小大小，并注意集合和字典预分配空间，因此空的空间不会再次增长，直到达到设定的数量（可能会有所不同语言的实现）：

蟒蛇 3：

```
Empty
Bytes  type        scaling notes
28     int         +4 bytes about every 30 powers of 2
37     bytes       +1 byte per additional byte
49     str         +1-4 per additional character (depending on max width)
48     tuple       +8 per additional item
64     list        +8 for each additional
224    set         5th increases to 736; 21nd, 2272; 85th, 8416; 341, 32992
240    dict        6th increases to 368; 22nd, 1184; 43rd, 2280; 86th, 4704; 171st, 9320
136    func def    does not include default args and other attrs
1056   class def   no slots 
56     class inst  has a __dict__ attr, same scaling as dict above
888    class def   with slots
16     __slots__   seems to store in mutable tuple-like structure
                   first slot grows to 48, and so on. 
```

你如何解释这个？好吧，假设您有一套包含 10 件物品的套装。如果每一项都是 100 字节，那么整个数据结构有多大？该集合本身是 736，因为它的大小已扩大到 736 字节。然后添加项目的大小，总共 1736 字节

函数和类定义的一些注意事项：

请注意，每个类定义都有一个`__dict__`用于类属性的代理（48 字节）结构。每个插槽`property`在类定义中都有一个描述符（如 a ）。

开槽实例的第一个元素从 48 个字节开始，每增加 8 个字节。只有空槽对象有 16 个字节，没有数据的实例没有什么意义。

此外，每个函数定义都有代码对象，可能是文档字符串，以及其他可能的属性，甚至是`__dict__`.

另请注意，我们使用文档`sys.getsizeof()`是因为我们关心边际空间使用情况，其中包括对象的垃圾收集开销，[来自文档](https://docs.python.org/3/library/sys.html#sys.getsizeof)：

> `getsizeof()`如果对象由垃圾收集器管理，则调用对象的`__sizeof__`方法并增加额外的垃圾收集器开销。

另请注意，调整列表的大小（例如重复附加到它们）会导致它们预先分配空间，类似于集合和字典。从[listobj.c 源代码](https://github.com/python/cpython/blob/master/Objects/listobject.c)：

```
 /* This over-allocates proportional to the list size, making room
     * for additional growth.  The over-allocation is mild, but is
     * enough to give linear-time amortized behavior over a long
     * sequence of appends() in the presence of a poorly-performing
     * system realloc().
     * The growth pattern is:  0, 4, 8, 16, 25, 35, 46, 58, 72, 88, ...
     * Note: new_allocated won't overflow because the largest possible value
     *       is PY_SSIZE_T_MAX * (9 / 8) + 6 which always fits in a size_t.
     */
    new_allocated = (size_t)newsize + (newsize >> 3) + (newsize < 9 ? 3 : 6); 
```

### 历史数据

Python 2.7 分析，用`guppy.hpy`and确认`sys.getsizeof`：

```
Bytes  type        empty + scaling notes
24     int         NA
28     long        NA
37     str         + 1 byte per additional character
52     unicode     + 4 bytes per additional character
56     tuple       + 8 bytes per additional item
72     list        + 32 for first, 8 for each additional
232    set         sixth item increases to 744; 22nd, 2280; 86th, 8424
280    dict        sixth item increases to 1048; 22nd, 3352; 86th, 12568 *
120    func def    does not include default args and other attrs
64     class inst  has a __dict__ attr, same scaling as dict above
16     __slots__   class with slots has no dict, seems to store in 
                    mutable tuple-like structure.
904    class def   has a proxy __dict__ structure for class attrs
104    old class   makes sense, less stuff, has real dict though. 
```

请注意，字典（[但不是集合](https://mail.python.org/pipermail/python-dev/2016-September/146472.html)）在 Python 3.6 中得到了[更紧凑的表示](https://docs.python.org/3.6/whatsnew/3.6.html#other-language-changes)

我认为在 64 位机器上，每个要引用的附加项目 8 个字节很有意义。这 8 个字节指向内存中包含的项目所在的位置。如果我没记错的话，这 4 个字节是 Python 2 中 unicode 的固定宽度，但在 Python 3 中，str 成为宽度等于字符最大宽度的 unicode。

有关插槽的更多信息，[请参阅此答案](https://stackoverflow.com/a/28059785/541136)。

## 更完善的功能

我们想要一个函数来搜索列表、元组、集合、字典、`obj.__dict__`'s 和中的元素`obj.__slots__`，以及我们可能还没有想到的其他东西。

我们希望依靠它`gc.get_referents`来执行此搜索，因为它在 C 级别工作（使其非常快）。缺点是 get_referents 可以返回多余的成员，所以我们需要确保我们不会重复计算。

类、模块和函数是单例的——它们在内存中存在一次。我们对它们的大小不太感兴趣，因为我们对它们无能为力——它们是项目的一部分。因此，如果它们碰巧被引用，我们将避免计算它们。

我们将使用类型的黑名单，因此我们不会将整个程序包括在我们的大小计数中。

```
import sys
from types import ModuleType, FunctionType
from gc import get_referents

# Custom objects know their class.
# Function objects seem to know way too much, including modules.
# Exclude modules as well.
BLACKLIST = type, ModuleType, FunctionType

def getsize(obj):
    """sum size of object & members."""
    if isinstance(obj, BLACKLIST):
        raise TypeError('getsize() does not take argument of type: '+ str(type(obj)))
    seen_ids = set()
    size = 0
    objects = [obj]
    while objects:
        need_referents = []
        for obj in objects:
            if not isinstance(obj, BLACKLIST) and id(obj) not in seen_ids:
                seen_ids.add(id(obj))
                size += sys.getsizeof(obj)
                need_referents.append(obj)
        objects = get_referents(*need_referents)
    return size 
```

为了与以下列入白名单的函数进行对比，大多数对象都知道如何遍历自身以进行垃圾收集（当我们想知道某些对象的内存成本时，这大约是我们正在寻找的东西。此功能由`gc.get_referents`.) 但是，如果我们不小心，这项措施的范围将比我们预期的要广泛得多。

例如，函数对创建它们的模块了解很多。

另一个对比点是字典中作为键的字符串通常被保留，因此它们不会重复。检查`id(key)`还可以让我们避免计算重复项，我们将在下一节中这样做。黑名单解决方案完全跳过了对字符串的计数。

## 白名单类型，递归访问者

为了我自己涵盖这些类型中的大多数，而不是依赖于`gc`模块，我编写了这个递归函数来尝试估计大多数 Python 对象的大小，包括大多数内置函数、集合模块中的类型和自定义类型（开槽和其他）。

这种函数对我们要计算内存使用的类型提供了更细粒度的控制，但有遗漏重要类型的危险：

```
import sys
from numbers import Number
from collections import deque
from collections.abc import Set, Mapping

ZERO_DEPTH_BASES = (str, bytes, Number, range, bytearray)

def getsize(obj_0):
    """Recursively iterate to sum size of object & members."""
    _seen_ids = set()
    def inner(obj):
        obj_id = id(obj)
        if obj_id in _seen_ids:
            return 0
        _seen_ids.add(obj_id)
        size = sys.getsizeof(obj)
        if isinstance(obj, ZERO_DEPTH_BASES):
            pass # bypass remaining control flow and return
        elif isinstance(obj, (tuple, list, Set, deque)):
            size += sum(inner(i) for i in obj)
        elif isinstance(obj, Mapping) or hasattr(obj, 'items'):
            size += sum(inner(k) + inner(v) for k, v in getattr(obj, 'items')())
        # Check for custom object instances - may subclass above too
        if hasattr(obj, '__dict__'):
            size += inner(vars(obj))
        if hasattr(obj, '__slots__'): # can have __slots__ with __dict__
            size += sum(inner(getattr(obj, s)) for s in obj.__slots__ if hasattr(obj, s))
        return size
    return inner(obj_0) 
```

我很随意地测试了它（我应该对它进行单元测试）：

```
>>> getsize(['a', tuple('bcd'), Foo()])
344
>>> getsize(Foo())
16
>>> getsize(tuple('bcd'))
194
>>> getsize(['a', tuple('bcd'), Foo(), {'foo': 'bar', 'baz': 'bar'}])
752
>>> getsize({'foo': 'bar', 'baz': 'bar'})
400
>>> getsize({})
280
>>> getsize({'foo':'bar'})
360
>>> getsize('foo')
40
>>> class Bar():
...     def baz():
...         pass
>>> getsize(Bar())
352
>>> getsize(Bar().__dict__)
280
>>> sys.getsizeof(Bar())
72
>>> getsize(Bar.__dict__)
872
>>> sys.getsizeof(Bar.__dict__)
280 
```

这个实现分解了类定义和函数定义，因为我们并不关注它们的所有属性，但是由于它们应该只在进程的内存中存在一次，它们的大小实际上并不重要。

* * *

## 回答 #3

> 赞同：141
> 
> 时间：2015-11-10T14:01:35.260

Pympler包的模块可以做到这一点[。](https://pypi.python.org/pypi/Pympler)`asizeof`

使用如下：

```
from pympler import asizeof
asizeof.asizeof(my_object) 
```

与 不同`sys.getsizeof`的是，它**适用于您自己创建的对象**。它甚至适用于 numpy。

```
>>> asizeof.asizeof(tuple('bcd'))
200
>>> asizeof.asizeof({'foo': 'bar', 'baz': 'bar'})
400
>>> asizeof.asizeof({})
280
>>> asizeof.asizeof({'foo':'bar'})
360
>>> asizeof.asizeof('foo')
40
>>> asizeof.asizeof(Bar())
352
>>> asizeof.asizeof(Bar().__dict__)
280
>>> A = rand(10)
>>> B = rand(10000)
>>> asizeof.asizeof(A)
176
>>> asizeof.asizeof(B)
80096 
```

如前所述，[_](https://stackoverflow.com/questions/449560/how-do-i-determine-the-size-of-an-object-in-python/33631772?noredirect=1#comment85591087_33631772)

> [类、函数、方法、模块等对象的（字节）代码大小可以通过设置选项来包含`code=True`。](https://pythonhosted.org/Pympler/asizeof.html#asizeof)

如果您需要其他关于实时数据的视图，Pymler 的

> 模块[`muppy`](https://pythonhosted.org/Pympler/muppy.html#muppy)用于在线监控 Python 应用程序，模块[`Class Tracker`](https://pythonhosted.org/Pympler/classtracker.html#classtracker)提供对选定 Python 对象生命周期的离线分析。

* * *

## 回答 #4

> 赞同：84
> 
> 时间：2010-07-30T16:33:00.823

对于 numpy 数组，`getsizeof`不起作用 - 对我来说，由于某种原因它总是返回 40：

```
from pylab import *
from sys import getsizeof
A = rand(10)
B = rand(10000) 
```

然后（在 ipython 中）：

```
In [64]: getsizeof(A)
Out[64]: 40

In [65]: getsizeof(B)
Out[65]: 40 
```

不过，令人高兴的是：

```
In [66]: A.nbytes
Out[66]: 80

In [67]: B.nbytes
Out[67]: 80000 
```

* * *

## 回答 #5

> 赞同：52
> 
> 时间：2019-12-07T16:25:26.833

您可以序列化对象以导出与对象大小密切相关的度量：

```
import pickle

## let o be the object whose size you want to measure
size_estimate = len(pickle.dumps(o)) 
```

如果您想测量无法腌制的对象（例如由于 lambda 表达式）， dill 或 cloudpickle 可以是一个解决方案。

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2019-02-19T17:04:22.720

Python 3.8（2019 年第一季度）将改变 的一些结果[`sys.getsizeof`](http://docs.python.org/library/sys.html#sys.getsizeof)，正如Raymond Hettinger[在此宣布的那样：](https://twitter.com/raymondh/status/1097731373471682560)

> Python 容器在 64 位版本上小 8 个字节。

```
tuple ()  48 -> 40       
list  []  64 ->56
set()    224 -> 216
dict  {} 240 -> 232 
```

这是在[issue 33597](https://bugs.python.org/issue33597)和[Inada Naoki ( `methane`)](https://github.com/methane)围绕 Compact PyGC_Head 和[PR 7043的工作之后发布的](https://github.com/python/cpython/pull/7043)

> **这个想法将 PyGC_Head 的大小减少到两个单词**。
> 
> 目前， PyGC_Head 需要**三个词**；`gc_prev`, `gc_next`, 和`gc_refcnt`.
> 
> *   `gc_refcnt`收集时使用，用于试删。
> *   `gc_prev`用于跟踪和取消跟踪。
> 
> 因此，如果我们在试用删除时可以避免跟踪/取消跟踪，`gc_prev`并且`gc_refcnt`可以共享相同的内存空间。

请参阅[提交 d5c875b](https://github.com/python/cpython/commit/d5c875bbf1ef9b24349d3243b1ffaab6a9d5a78e)：

> 从 中删除了一名`Py_ssize_t`成员`PyGC_Head`。
> 所有 GC 跟踪的对象（例如 tuple、list、dict）的大小都减少了 4 或 8 个字节。

* * *

## 回答 #7

> 赞同：25
> 
> 时间：2019-11-21T16:24:22.640

如果您不想包含链接（嵌套）对象的大小，请使用[sys.getsizeof() 。](https://docs.python.org/3/library/sys.html#sys.getsizeof)

然而，如果你想计算嵌套在列表、字典、集合、元组中的子对象——通常这就是你要找的——使用递归**深度 sizeof()**函数，如下所示：

```
import sys
def sizeof(obj):
    size = sys.getsizeof(obj)
    if isinstance(obj, dict): return size + sum(map(sizeof, obj.keys())) + sum(map(sizeof, obj.values()))
    if isinstance(obj, (list, tuple, set, frozenset)): return size + sum(map(sizeof, obj))
    return size 
```

您还可以在**漂亮**的工具箱中找到此功能，以及许多其他有用的单行代码：

[https://github.com/mwojnars/nifty/blob/master/util.py](https://github.com/mwojnars/nifty/blob/master/util.py)

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2009-01-16T13:00:14.293

这可能比看起来更复杂，具体取决于您要如何计算事物。例如，如果您有一个整数列表，您是否想要包含对整数的*引用*的列表的大小？（即仅列出，而不是其中包含的内容），或者您是否要包含指向的实际数据，在这种情况下您需要处理重复引用，以及当两个对象包含对的引用时如何防止重复计算同一个对象。

您可能想查看其中一个 python 内存分析器，例如[pysizer](http://pysizer.8325.org/)，看看它们是否满足您的需求。

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2016-07-21T22:21:07.613

我自己多次遇到这个问题后，我编写了一个小函数（受@aaron-hall 的回答启发）和测试，它完成了我期望 sys.getsizeof 做的事情：

[https://github.com/bosswissam/pysize](https://github.com/bosswissam/pysize)

如果你对背景故事感兴趣，[这里是](https://goshippo.com/blog/measure-real-size-any-python-object/)

编辑：附上下面的代码以便于参考。要查看最新代码，请查看 github 链接。

```
 import sys

    def get_size(obj, seen=None):
        """Recursively finds size of objects"""
        size = sys.getsizeof(obj)
        if seen is None:
            seen = set()
        obj_id = id(obj)
        if obj_id in seen:
            return 0
        # Important mark as seen *before* entering recursion to gracefully handle
        # self-referential objects
        seen.add(obj_id)
        if isinstance(obj, dict):
            size += sum([get_size(v, seen) for v in obj.values()])
            size += sum([get_size(k, seen) for k in obj.keys()])
        elif hasattr(obj, '__dict__'):
            size += get_size(obj.__dict__, seen)
        elif hasattr(obj, '__iter__') and not isinstance(obj, (str, bytes, bytearray)):
            size += sum([get_size(i, seen) for i in obj])
        return size 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2013-03-04T17:34:04.850

这是我根据之前对所有变量的列表大小的答案编写的快速脚本

```
for i in dir():
    print (i, sys.getsizeof(eval(i)) ) 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2021-07-31T09:45:08.500

使用以下函数获取 python 对象的实际大小：

```
import sys
import gc

def actualsize(input_obj):
    memory_size = 0
    ids = set()
    objects = [input_obj]
    while objects:
        new = []
        for obj in objects:
            if id(obj) not in ids:
                ids.add(id(obj))
                memory_size += sys.getsizeof(obj)
                new.append(obj)
        objects = gc.get_referents(*new)
    return memory_size

actualsize([1, 2, [3, 4, 5, 1]]) 
```

参考：[https ://towardsdatascience.com/the-strange-size-of-python-objects-in-memory-ce87bdfbb97f](https://towardsdatascience.com/the-strange-size-of-python-objects-in-memory-ce87bdfbb97f)

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2019-04-10T20:58:19.353

如果您不需要对象的确切大小但大致知道它有多大，一种快速（且肮脏）的方法是让程序运行，长时间休眠，并检查内存使用情况（例如: Mac 的活动监视器) 通过这个特定的 python 进程。当您试图在 python 进程中查找单个大对象的大小时，这将是有效的。例如，我最近想检查一个新数据结构的内存使用情况，并将其与 Python 的 set 数据结构的内存使用情况进行比较。首先，我将元素（来自大型公共领域书籍的单词）写入一个集合，然后检查进程的大小，然后对另一个数据结构做同样的事情。我发现带有集合的 Python 进程占用的内存是新数据结构的两倍。再说一次，你不会 不能准确地说进程使用的内存等于对象的大小。随着对象的大小变大，与您尝试监视的对象的大小相比，其余进程消耗的内存变得可以忽略不计，这将变得接近。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2020-04-21T05:11:50.113

我使用这个技巧......可能对小物体不准确，但我认为它对于复杂物体（如 pygame 表面）而不是 sys.getsizeof() 更准确

```
import pygame as pg
import os
import psutil
import time

process = psutil.Process(os.getpid())
pg.init()    
vocab = ['hello', 'me', 'you', 'she', 'he', 'they', 'we',
         'should', 'why?', 'necessarily', 'do', 'that']

font = pg.font.SysFont("monospace", 100, True)

dct = {}

newMem = process.memory_info().rss  # don't mind this line
Str = f'store ' + f'Nothing \tsurface use about '.expandtabs(15) + \
      f'0\t bytes'.expandtabs(9)  # don't mind this assignment too

usedMem = process.memory_info().rss

for word in vocab:
    dct[word] = font.render(word, True, pg.Color("#000000"))

    time.sleep(0.1)  # wait a moment

    # get total used memory of this script:
    newMem = process.memory_info().rss
    Str = f'store ' + f'{word}\tsurface use about '.expandtabs(15) + \
          f'{newMem - usedMem}\t bytes'.expandtabs(9)

    print(Str)
    usedMem = newMem 
```

在我的 Windows 10，python 3.7.3 上，输出是：

```
store hello          surface use about 225280    bytes
store me             surface use about 61440     bytes
store you            surface use about 94208     bytes
store she            surface use about 81920     bytes
store he             surface use about 53248     bytes
store they           surface use about 114688    bytes
store we             surface use about 57344     bytes
store should         surface use about 172032    bytes
store why?           surface use about 110592    bytes
store necessarily    surface use about 311296    bytes
store do             surface use about 57344     bytes
store that           surface use about 110592    bytes 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2021-12-24T13:51:35.723

如果性能不是问题，最简单的解决方案是腌制和测量：

```
import pickle

data = ...
len(pickle.dumps(data)) 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-11-17T12:52:04.663

您可以使用如下所述的 getSizeof() 来确定对象的大小

```
import sys
str1 = "one"
int_element=5
print("Memory size of '"+str1+"' = "+str(sys.getsizeof(str1))+ " bytes")
print("Memory size of '"+ str(int_element)+"' = "+str(sys.getsizeof(int_element))+ " bytes") 
```

# architecture - 如何实现“类版本控制”（使用同一类的不同版本）

> ID：449569
> 
> 赞同：1
> 
> 时间：2009-01-16T05:15:36.717
> 
> 标签：architecture, versioning

问题是：我们的主要课程（比如：合同）每年都在变化。添加了一些属性，删除了其他属性。我们不知道明年会是什么样子。它可能会发生很大变化或根本不会发生变化。

另一方面，我们现在（新要求......）必须保留每份合同的历史记录。每次用户更新合约时，整个对象都必须存储在备份中（例如 - 在表中序列化）。

当然，我们必须能够读回它......一个选择（残酷）是每年都有一个新的合同类（合同2008，合同2009，......）。

但这会非常麻烦（而且丑陋），因为很多类都依赖于 Contract - 事实上，我们每年都必须创建一堆新类。

有过这种问题吗？有什么建议吗？

提前致谢 ！

（我们使用的是 C# 2.0。）

补充：感谢您的回答。我们现在问自己如何使用字典/ XML 文件来实现版本控制而不破坏所有代码。在这种情况下，字典似乎很性感：o）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T05:31:17.060

停止序列化对象。以关系方式存储数据。序列化的目的是短时间，比如通过网络进行流式传输；不是永久存储。

而不是将字段编码到类中；听起来您可能需要更多的字典类型的结构，可以根据年份存储的数据库配置值动态提取字段。然后基于这些值构建动态 UI。每年都必须创建一个新类并测试代码，维护起来似乎非常昂贵。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T05:19:36.867

我能想到的第一件事。实现一种“能力”文档。详细说明联系人版本及其包含的属性的列表（或 XML 文档）。

在 Contract 上运行的每个函数都应检查是否支持特定属性（“功能”）。

例如：

```
Contract2008 Capabilities
-----
has Name
has Stipulations
can DoMagic
-----
>     
>     Contract2009 Capabilities
>     -----
>     has Name
>     has Stipulations
>     can DoMagic
>     ----- 
```

合同类将存储功能文档和一些通用的 getter 设置器。

```
Contract
  GetCapabilities()
  Set(field, value)  
  Get(field, value) 
```

set 和 get 将在设置或获取值之前检查功能中是否支持该字段。

（这一定是一种模式或什么，有人吗？）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T05:31:00.993

很可能您不必*将*属性实现为 C# 属性。您实际上可以将属性存储在某种字典中，并使用 Get 和 Set 方法来读取/枚举它们。在这种情况下，您可以每年使用相同的课程。

如果属性真的*必须*是属性，那么我建议每年使用该类构建一个新程序集，并动态加载程序集。然后，您可以使用反射来查看每个 Contract 对象支持哪些属性。为了让您的生活更轻松，我建议您为不更改的属性提供一个接口，并使其更容易识别程序集中的 Contract 类。

# mysql - 基于 Web 的 MySQL 界面比 phpMyAdmin 更好

> ID：449570
> 
> 赞同：14
> 
> 时间：2009-01-16T05:16:36.387
> 
> 标签：mysql, phpmyadmin

是否有任何基于 Web 的 MySQL 界面比 phpMyAdmin 更好？我经常使用 phpMyAdmin，但它变得很痛苦，尤其是有时它很慢。

我想拥有像 phpMyAdmin 这样的深度导出功能，但更多的设计功能

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T05:20:48.157

为什么不直接使用客户端？在我看来，它们要好得多。

我喜欢[SQLyog](http://www.webyog.com)，因为它支持很多 MySQL 功能（存储过程），但我曾经使用 HeidiSQL，它也很好。

至于基于网络的客户，不幸的是我没有任何建议。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-11-16T12:23:27.347

Try [DBlite](http://dblite.com). It's has got a nice intuitive interface and gets the work done faster and with fewer clicks than in phpmyadmin.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T06:00:45.300

尝试检查这些[http://www.webresourcesdepot.com/category/goodies/database/](http://www.webresourcesdepot.com/category/goodies/database/)

作为客户，我推荐 EMS Manager 以及 Posgtres

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-16T06:49:16.200

我知道[SqlBuddy](http://www.sqlbuddy.com/ "SQLBuddy")。它有一个比 phpMyAdmin 更简单的界面 - 但 pma 更强大。

还有[VFront](http://www.vfront.org/en/ "正面")应用程序。我还没有尝试过 - 所以我无法评论它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-16T08:14:43.440

作为客户端，MySQL Query 浏览器和 Administrator 相当不错。那有许多很酷的不同出口设施。如果它需要是网络的，那么你最好坚持使用缓慢的 phpmyadmin。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-16T08:21:49.027

在非 Web 客户端中，我使用[Navicat for MySQL](http://www.navicat.com/)。免费版可以做 phpMyAdmin 可以做的一切

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-08-22T09:47:31.133

[http://www.webdesigneronline.co.uk/10-great-alternatives-to-phpmyadmin](http://www.webdesigneronline.co.uk/10-great-alternatives-to-phpmyadmin)

它在这里列出了几个，但也列出了一些没有提到的

**管理员**

我开始使用 Adminer，因为它带有免费的皮肤、脚本和模组 - 最重要的是，它是一个位于服务器上的 PHP 文件，所以你甚至可以称它为“private_32492834234.php”

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-16T06:55:13.553

作为客户，我推荐[Toad For Mysql](http://www.toadsoft.com/toadmysql/Overview.htm)（它是免费的）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-08-15T22:21:00.047

我建议使用 phpadminer，因为它是轻量级的并且只有一个 php 文件，但您应该继续使用慢速 phpmyadmin。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-08T16:58:41.703

我想推荐[AeroSQL](http://www.burlaca.com/aerosql/)，它是一个使用 PHP 和 ExtJS 库构建的基于 Web 的开源 (GPL) MySql 管理器。

有一个演示、视频和屏幕截图可用。

项目主页：[http ://www.burlaca.com/aerosql/](http://www.burlaca.com/aerosql/)

该产品的主要特点是对数据库内容的直观管理。SELECT 的结果与传统桌面应用程序一样显示在网格中。网格是可编辑的：您可以更新单元格并将更改保存到后端数据库服务器。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-04-18T10:27:07.403

实际上我正在使用[mysql](http://mywebsql.net/)，我对此非常满意。你应该检查一下。

# asp.net - 为什么 Visual Studio 会默认为 WebForms 提供 Page_Load？

> ID：449593
> 
> 赞同：3
> 
> 时间：2009-01-16T05:33:42.313
> 
> 标签：asp.net, visual-studio, onload, pageload

创建新的 WebForm 时，Visual Studios 在后面的代码中默认创建一个 Page_Load 处理程序，这很酷。所以多年来，我总是将代码用于在 Page_Load 中设置控件的属性。最近，我使用 Reflector 查看了一些微软编写的程序集，发现他们将相同类型的逻辑放在了一个名为 OnLoad 的方法中（据说会引发加载事件）。所以我开始想，真正设置控件属性的最佳位置在哪里，在 OnLoad 或 Page_Load 中？还是完全不同的方法？如果不是 Page_Load，为什么 Studio 将其添加到后面的代码中？

**我最后的想法：** 虽然我知道将逻辑放在 OnLoad 中可以正常工作，但我现在可能会坚持使用 Page_Load，因为这是传统的。在我开始看到 OnLoad 出现在其他人的代码中之后，我真的问了这个问题，以确定我是否错过了一些新的东西。谢谢大家周到的回答！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T06:48:38.200

Page_Load 只是 OnLoad 的 autoeventwireup。你会认为使用哪个没有任何区别，但我同意[Ode to Code 的 K. Scott Allen 的](http://odetocode.com/Blogs/scott/archive/2005/10/05/2313.aspx)观点，即你通常应该只在你试图做一些意想不到的事情时才偏离规范。覆盖像 OnLoad 这样的虚拟方法表明您正在尝试做一些不同的事情，例如不调用 base.Onload，而大多数程序员通常不会这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T05:37:01.370

您不想使用 OnLoad，他们使用它的原因是因为它是引发 Page_Load 事件的包装器。他们把逻辑放在那里，因为他们没有处理 Page_Load 事件。

总之，继续使用 Page_Load。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T06:04:34.170

通常，OnX 方法是引发事件 X 的方法。它们有点像类的内部事件处理程序。这意味着，当您编写一个检测特定事件发生的类时，您通常会调用一个方法：1\. 执行您的类在这种情况下需要执行的操作，2\. 触发外部事件。

我相信这种情况流行的核心原因之一是，就目前而言，您不能只调用事件委托来触发事件，您必须始终检查该委托是否为空。所以你想把这个检查封装在一个方法中。

简而言之，除非您正在编写自己的具有 Load 事件的类，否则您不需要考虑 OnLoad 方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T08:44:29.230

到目前为止所有非常有效的观点。但不要让这些人吓到你。如果您想使用 OnLoad 方法，您不会受到任何伤害。只是不要忘记调用 base.OnLoad()。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-16T09:57:00.300

确实，如果您回到 ASP.Net 1.1 开发的糟糕过去，您实际上会看到正在发生的接线，在每个页面中为您创建：

```
 #region Web Form Designer generated code
    override protected void OnInit(EventArgs e)
    {
        InitializeComponent();
        base.OnInit(e);
    }

    /// <summary>
    /// Required method for Designer support - do not modify
    /// the contents of this method with the code editor.
    /// </summary>
    private void InitializeComponent()
    {    
        this.Load += new System.EventHandler(this.Page_Load);
    }
    #endregion 
```

时不时地，我会做一些事情导致 VS 删除 InitializeComponent 中的那条小行，并且无法弄清楚为什么我的页面停止做任何事情。

# jquery - 如何旋转 4 个（或更多）图像，在每个图像之间淡化？

> ID：449599
> 
> 赞同：14
> 
> 时间：2009-01-16T05:36:04.383
> 
> 标签：jquery, image, fade

我有 4 张图像，我想在一个循环中相互淡出。我有以下内容：

```
<img src="/images/image-1.jpg" id="featureImg1" />
<img src="/images/image-2.jpg" id="featureImg2" style="display:none;" />
<img src="/images/image-3.jpg" id="featureImg3" style="display:none;" />
<img src="/images/image-4.jpg" id="featureImg4" style="display:none;" /> 
```

我准备修改 HTML，尽管在这种情况下我不能使用绝对定位。我在网站上的其他地方使用 jQuery，所以它是可用的。由于图像较大，我还需要处理未立即加载的图像。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-16T06:16:12.353

I'd highly recommend the [jQuery Cycle](http://malsup.com/jquery/cycle/) plugin. It may do more than you're looking for in this case, but it's well structured and easy to setup. There's also a lightweight version called [jQuery Cycle Lite](http://malsup.com/jquery/cycle/lite/) which just supports fade transitions.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-16T06:05:42.717

您可以使用 a`div`和 an `img`，如下所示：

```
<div id="featureImgContainer">
    <img src="/images/image-1.jpg" id="featureImg" />
</div> 
```

在你的 Javascript 中做这样的事情（伪 jQuery）：

```
function rotateImage(newImage) {
    var oldImage = $("#featureImg").image();

    $("#featureImgContainer").css({backgroundImage: "url('" + oldImage + "')"}); // TODO Escape URL

    $("#featureImg").image(newImage).opacity(0).fadeIn();
} 
```

基本上，我们将`div`'s 背景设为“旧”图像，并将其`img`设为新图像。我们将`img`不透明度设置为 0，然后将其淡入，因此看起来旧图像正在淡入新图像。淡入后，`div`不再显示。

注意适当地设置 CSS 以在适当的`div`地方设置背景位置的宽度/高度。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T06:10:32.053

我还发现了 jQuery 的这个扩展：[http ://www.linein.org/blog/2008/01/10/roate-image-using-jquery-with-plugin/](http://www.linein.org/blog/2008/01/10/roate-image-using-jquery-with-plugin/)

它似乎做得很好，虽然很多代码并不多。

编辑：我还发现了我经常使用并且运行良好的[Nivo Slider 。](http://nivo.dev7studios.com/)它还具有“导航”和上一个/下一个按钮的能力。很方便。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-18T17:20:49.253

you can stay with the core of jQuery and have a loop bring up the z-index..

it can be done in a very simple way...

# sql-server-2005 - 仅使用 localhost 指向 localhost\sqlexpress

> ID：449607
> 
> 赞同：27
> 
> 时间：2009-01-16T05:40:24.077
> 
> 标签：sql-server-2005, connection-string, sql-server-express

在一个通用代码库上工作，一位开发人员正在运行 SQL Server Express 2005，另外 2 位正在运行 SQL Server 2005。一切正常，但连接字符串不同。为了维护通用配置和构建脚本，我们希望像其他 2 个开发人员一样将**“localhost\sqlexpress”**屏蔽为**“localhost” 。**

这可以做到吗？或者，也许有更好的方法让所有 3 个都在相同的连接字符串上运行......寻求的解决方案是让所有 3 个都能够在代码存储库中的相同文件版本上运行。

我可能不是 100% 清楚：基本上我想要这个：

```
Data Source=localhost;Initial Catalog=Sample;Integrated Security=True 
```

连接与此完全相同：

```
Data Source=localhost\sqlexpress;Initial Catalog=Sample;Integrated Security=True 
```

如果可能的话。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-01-16T06:16:26.580

只是测试了一些东西并让它工作。

sql express 默认不启用 tcp/ip，启用时不使用默认端口 1433。

要做到这一点，您需要打开“Sql server configuration manager”，然后在协议下启用 tcp/ip。之后双击“tcp/ip”，选择“IP 地址”选项卡并滚动到底部，然后空白“TCP 动态端口”并在 TCP 端口下输入 1433。

毕竟重新启动 sql server 服务，它应该可以使用正常的连接字符串。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T05:53:34.847

您可以将 SQL Server 实例命名为任何您想要的名称。我很确定您也可以在 SQL Express 中执行此操作，因此只需将每台机器上的实例命名为相同的名称，然后您就可以使用 localhost\<name>。

或者更好的是，不要对数据库名称进行硬编码。从某些机器或用户特定的设置（注册表，配置文件，任何适合您的 :) 加载它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-11-11T20:08:05.383

这个话题已经死了，我敢肯定......但这也有助于某人：

*“一个开发人员正在运行 SQL Server Express 2005，另外 2 个正在运行 SQL Server 2005”*

当他们安装时，实例很可能被命名为 MSSQLSERVER。当您安装时，该实例很可能被命名为 SQLEXPRESS。MSSQLSERVER 可作为 localhost 开箱即用，而 SQLEXPRESS 则不能。您可以通过在安装时将 SQLEXPRESS 重命名为 MSSQLSERVER 在 SQL Server Express 中解决此问题，以供将来参考。

约翰的解决方案显然更干净。

# database - 数据库和连接

> ID：449608
> 
> 赞同：5
> 
> 时间：2009-01-16T05:40:25.950
> 
> 标签：database, database-connection

我有兴趣了解数据库如何处理未由启动连接的实体明确关闭的连接。

1.  假设我有一个一次只能接受 2 个并发连接的数据库。我有一段代码可以打开一个连接并且从不关闭它。这段代码永远运行，但它在其生命周期中只使用一次连接，但连接对象永远不会超出范围，因此它不会被垃圾收集。假设我运行此代码的 2 个实例。这是否意味着在程序终止或连接超时（由于不活动）之前，数据库不能接受更多的连接？

2.  在上述场景中，如果连接对象被垃圾收集，那么连接是自动终止还是取决于我正在使用的数据库驱动程序，或者在我明确关闭它之前连接根本不会终止？

3.  如果我在一段代码中打开一个连接并且我没有显式关闭连接，但程序终止了，那么数据库如何回收该连接？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T05:50:20.580

数据库连接的底层协议通常是基于 TCP/IP 的。可以通过以下几种方式之一终止连接：

1.  服务器优雅地关闭它并收到来自客户端的确认；
2.  客户端优雅地关闭并收到来自服务器的确认；
3.  连接超时。客户端和服务器分别由各自的操作系统告知连接已关闭；
4.  连接被任一侧强制关闭。

在 (3) 的情况下，TCP 连接必须通过每隔一段时间发送虚拟消息来保持活动状态，以避免超时。您的连接可能会超时，因为双方都没有这样做（对于数据库连接，这不是您通常想要做的事情）。

有一段时间，完全有可能一方认为连接已关闭，而另一方仍然认为它是打开的。在这些情况下可能会发送消息（通常会被丢弃）。

**每个连接（“套接字”）都使用称为文件描述符**的操作系统资源（在 UNIX 术语中，您的操作系统可能会称其为其他名称），它是 I/O 资源的句柄，与打开文件的句柄相同（同样，操作系统可能会有所不同）。

数据库上的连接限制将是以下各项中的最低值：

*   操作系统的配置限制；
*   该进程允许的最大文件描述符（减去用于 I/O 活动的任何文件描述符）；和
*   （可能）有关连接限制的系统设置或策略。

如果连接不是基于 TCP 的（例如，通常在 UNIX 系统上与 MySQL 一起使用的文件系统套接字），则原理实际上非常相似。

无论如何，这个故事的寓意是数据库连接——无论其形式如何——都涉及某种操作系统资源。您的程序 hsa 直接或间接要求该资源。如果程序死了，操作系统会回收它（可能不是立即，而是最终）。如果连接被垃圾收集，那么资源将被释放，就像它被强制关闭一样。

Its that external resource (and not the code your client is using) that holds the connection open and drives any limits.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T05:49:10.627

按顺序回答您的问题：

1.  很可能是。除非“并发连接”实际上是指“并发查询”。如果你保持数据库连接打开，它是打开的。

2.  垃圾收集可能会也可能不会清理连接。取决于所使用的语言和数据库驱动程序。（垃圾收集可能仅限于回收内存，而不是 TCP 连接等资源。）

3.  当您的程序终止时，通常操作系统负责清理它使用的所有资源。这包括关闭 TCP 等连接。因此，对于大多数连接类型，数据库将被通知对方关闭了连接。

# wpf - WPF RichTextBox 性能

> ID：449616
> 
> 赞同：16
> 
> 时间：2009-01-16T05:48:31.723
> 
> 标签：wpf, performance, controls

加载 50KB 的文本文档时，WPF 的 RichTextBox 控件的性能确实很慢。滚动延迟并按 Ctrl-A 选择所有文本需要 10 多秒。（这在记事本上是即时的）。

我没有做任何花哨的位图效果。这是正常的吗？即使在空的 RichTextBox 上打字也似乎比平时有点迟钝。

有解决办法吗？备择方案？谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-11-11T01:03:50.403

您可能需要考虑使用不同的文本框控件。

Daniel Grunwald 完全从头开始为 SharpDevelop 编写了 Wpf 文本编辑器。它被称为 AvalonEdit，codeproject 上有一篇很好的文章：

[http://www.codeproject.com/KB/edit/AvalonEdit.aspx](http://www.codeproject.com/KB/edit/AvalonEdit.aspx)

看来他对大文件做了优化。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2019-11-05T17:22:27.877

我敢打赌[Scintilla](https://www.scintilla.org/)将胜过大多数（如果不是全部）免费替代品。对于`WPF`，使用`WPF`包装器。例如[ScintillaNET.WPF](https://github.com/Stumpii/ScintillaNET.WPF)（虽然没有尝试过）。

**优点**

*   完美的表现。
*   大量的语法高亮方案。

**缺点**

*   不要指望本机`WPF`功能可以工作。例如缩放、触摸...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-11-05T12:05:23.960

[AvalonEdit](http://avalonedit.net/)具有更好的性能并且适用于大输入字符串。这是一个最小的例子：

MainWindow.xaml：

```
<Window x:Class="TestProject.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TestProject"
        xmlns:avalonedit="http://icsharpcode.net/sharpdevelop/avalonedit"
        mc:Ignorable="d"
        d:DataContext="{d:DesignInstance local:MainWindow}">
    <avalonedit:TextEditor Document="{Binding Document}" />
</Window> 
```

MainWindow.xaml.cs：

```
using ICSharpCode.AvalonEdit.Document;

namespace TestProject
{
    public partial class MainWindow
    {
        public MainWindow()
        {
            InitializeComponent();
            DataContext = this;
            Document.Text = "My string";
        }

        public TextDocument Document { get; } = new TextDocument();
    }
} 
```

# sockets - 我应该如何关闭信号处理程序中的套接字？

> ID：449617
> 
> 赞同：9
> 
> 时间：2009-01-16T05:48:41.893
> 
> 标签：sockets, signals, interrupt

我正在编写一个非常简单的服务器，它会永远循环，直到按下 Ctrl-C。我想让 ctrl-c 的信号处理程序关闭打开的套接字并关闭服务器，但我不知道信号处理程序的范围是什么，我不喜欢声明套接字的想法(s) 我需要关闭才能成为全球性的。

有人可以提供建议吗？有没有一些标准的方法来做到这一点？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-16T06:04:10.037

好吧，既然您有信号处理程序，我将假设您使用的是 Unix 变体。如果是这样的话：

*   内核通过文件号来识别套接字，该文件号是一个 int。见`socket(2)`。
*   该 int 对您的流程有效
*   该 int 对创建它后分叉的任何进程都有效
*   如果不是 close-on-exec，它对您执行的任何进程都有效。

因此，它在您的信号处理程序中完全有效。如何让信号处理程序知道要使用哪个数字取决于您编写的语言，您没有指定。有两种方法几乎适用于任何语言

*   如果除了退出之外没有任何清理工作要做`close`，只需调用 exit。或者将信号动作设置为默认值，即退出。内核将关闭套接字。
*   设置一个标志（通常是某种全局的）来告诉您的选择/轮询循环清理并退出。优点在于您不必担心程序的各个部分是否可以安全地从信号处理程序调用。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-16T07:02:07.440

通常，建议不要在信号处理程序中做太多事情。除了设置一个标志。

然后当控制权返回到你的主循环时，你可以检查这个标志，退出循环，关闭套接字，在你的对象上运行析构函数等，然后干净地退出。

信号处理程序几乎可以在任何时候被调用，包括在 C 或 C++ 库调用的中间，这可能是一个问题。

# c# - 在 Mono 中使用 USB 设备

> ID：449626
> 
> 赞同：9
> 
> 时间：2009-01-16T05:56:34.013
> 
> 标签：c#, mono, usb

我有一个需要检测 USB 端口并从设备读取数据的要求。我可以看到很多用于检测 USB 端口的源代码，但是是否可以使用 C# 和 Mono 从通过 USB 端口连接的设备读取数据？我需要这个组件在 Mac 和 Windows 上运行。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-18T05:09:26.853

这个有可能。您应该查看一个名为[SharpUSBLib的项目。](http://www.icsharpcode.net/OpenSource/SharpUSBLib/default.aspx)这是一个用 C# 编写到用 C 编写的用于 Unix 和 Linux 的 USBLib 的包装库。还有一个 USBLib 到 Win32 的端口。

您可能需要注意的一件事是，您可能不需要 SharpUSBLib，具体取决于您尝试与之通信的 USB 设备类型。例如，大多数 USB HID（人机接口设备），如键盘和鼠标，都具备即插即用功能，不需要驱动程序或接口库。我有一个小型 USB Unitech 条形码扫描仪，当它插入 USB 端口时，它就像键盘一样工作，系统（Linux 和 Win32）将其视为 HID。

# xml - XML 属性值中是否允许换行？

> ID：449627
> 
> 赞同：100
> 
> 时间：2009-01-16T05:57:13.497
> 
> 标签：xml, xml-parsing

我意识到它并不优雅或不理想，但它是否允许（在格式良好的 XML 中）XML 元素中的属性值跨越多行？

例如

```
<some-xml-element value="this value goes over....
multiple lines!" /> 
```

是的，我意识到有更好的写法。我个人会这样写：

```
<some-xml-element>
<value>this value goes over...
multiple lines!</value>
</some-xml-element> 
```

或者：

```
<some-xml-element value="this value goes over....&#13;&#10;" /> 
```

但是我们有自己的 XML 解析器，我想知道第一个示例是否允许在格式良好的 XML 中使用。

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2009-01-16T06:12:16.853

[http://www.w3.org/TR/REC-xml/#NT-AttValue](http://www.w3.org/TR/REC-xml/#NT-AttValue)

似乎除了`<`,`&`和您的分隔符（`'`或`"`）之外的所有内容都可以。所以换行符也应该是。

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2011-11-18T19:51:17.570

这是允许的，但是根据 W3C 的建议，您的 XML 解析器应将所有空白字符规范化为空格 (0x20) - 因此示例的输出会有所不同（您应该在“ ;"，但在第一种情况下只有空格）。

[http://www.w3.org/TR/1998/REC-xml-19980210#AVNormalize](http://www.w3.org/TR/1998/REC-xml-19980210#AVNormalize)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-11-15T09:38:18.300

仅限 .NET：如果您不确定目标字符串是否是有效的 xml 属性（并通过代码提供此属性的值），您始终可以使用[SecurityElement.Escape](http://msdn.microsoft.com/en-us/library/system.security.securityelement.escape%28v=VS.100%29.aspx)函数来转义无效字符。

根据这个函数的描述，唯一的无效字符是：

`<`, `>`, `&`, `'`,`"`

这意味着（正如我的前任所写的），新行应该没问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-16T06:09:14.253

是的，第一个例子是一个有效的例子。

# version-control - 处理源控制系统中的多个变更集

> ID：449642
> 
> 赞同：10
> 
> 时间：2009-01-16T06:08:25.630
> 
> 标签：version-control, perforce

我在源代码管理中出现了一个相当罕见的问题。在此处的示例中，Perforce 出现了问题，但我怀疑许多 SCM 也会出现同样的问题，尤其是分布式 SCM。

Perforce 支持更改列表（或更改集，如果您愿意）。变更列表支持两种常见用法：

1.  当您提交更改列表时，提交是原子的，因此所有文件都已提交或没有。这是大多数人在提到变更列表时谈论的标题功能。

2.  Perforce 支持多个更改列表。基本上，当您签出一个文件时，您会告诉它它属于哪个更改列表。因此，如果您正在开发花哨的新电子邮件功能，这将需要数月的工作并赚取数百万美元，并且技术支持人员向您提出必须在昨天修复的错误，您不必从整个项目的一个新分支。您可以将有缺陷的文件签出到新的更改列表中，修复问题，签入新的更改列表，然后回到新电子邮件功能的实际工作中，就好像什么都没发生一样。

在大多数情况下，一切都很好。但是，当您实现电子邮件功能时，您会在所有地方进行无数次更改，尤其是在 main.h 中，而碰巧的是，当您开始修复错误时，您会发现必须进行的微小更改也在main.h中。新功能的更改列表已经签出了 main.h，因此您不能轻易将其放入更改列表中以进行错误修复。

现在你做什么？你有几个选择：

1.  创建一个新的客户端规范。Perforce 中的 clientspec 是 depot 中的文件/目录列表以及要复制所有内容的本地目的地。因此，您可以创建项目的第二个副本，而无需对电子邮件功能进行任何更改。

2.  做一个软糖。备份您修改后的 main.h 副本并恢复此文件。然后，您可以自由地将 main.h 检出到错误修复更改列表中。您修复错误，签入错误修复更改列表，然后将 main.h 签入电子邮件功能更改列表。最后，您从一开始所做的备份中合并所有更改。

3.  您确定您对 main.h 所做的所有更改都没有副作用或依赖性，因此您只需将 main.h 移到错误修复更改列表中，进行更改并将其签入。然后您再次将其签出到电子邮件功能中更改列表。显然，这种方法有两个问题：首先，实际上可能存在您没有考虑过的副作用，其次您已经破坏了您的版本历史。

选项 1 可能是最干净的，但并不总是实用的。我正在处理的一个项目有数百万行代码和一个非常复杂的构建过程。设置一个新环境需要一天的时间，所以 5 分钟的 bug 修复是不切实际的。

选项 3 是一个糟糕的选项，但它是最快的，所以它可能非常诱人。

这留下了选项 2，这是我通常会使用的选项。

有人有更好的解决方案吗？

对于这个冗长的问题，我深表歉意，但我在 StackOverflow 上发现，经过深思熟虑的问题可以得到更好的答案。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-16T06:14:59.717

这个确切的问题被称为“纠结的工作副本问题”。[Ryan Tomayko 有一篇名为The Thing About Git](http://tomayko.com/writings/the-thing-about-git)的博客文章详细讨论了这个问题以及 Git 如何解决它。

这是关于 Git 的最好的事情之一。我`git add -p`至少每天都使用，以帮助提交彼此独立的有意义的单独代码块。两个逻辑上不同的更改在同一个源文件中的事实已变得无关紧要。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-19T20:20:13.197

我通过从一开始就维护多个工作区来使用 Perforce 进行管理。我的主要开发在主线上（发生新开发的地方），而另一个则指向已发布代码的分支。如果我需要修复一个错误，我会去发布分支。

我不确定这是否适合您，但至少您不需要在每次修复错误时都创建新工作区（因为它已经存在）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T06:54:18.530

ClearCase 还支持变更列表（在其 UCM 风格中称为“活动”），并提出了类似的挑战。

仅当您确定“调试工作”与当前的开发工作（电子邮件功能）不兼容并且最好将其保存在单独的分支中时，选项 1（“分支类型”）才有意义。然后，您可以将“补丁”分支中所做的任何更正改进到主分支（因为并非您要修复的每个错误都必须存在于两者中：当前的开发可能已经使某些修复过时）。
另请参阅“[什么是分支](https://stackoverflow.com/questions/16142#114384)”，以及您的[合并工作流程](https://stackoverflow.com/questions/216212#216228)是什么。

选项 3 说明了变更集概念的限制：文件的单个修订（或“版本”）一次只能是*一个*变更集的一部分。

[Greg 提到](https://stackoverflow.com/questions/449642/handling-multiple-changesets-in-source-control-systems#449653)的`git add -p`（添加补丁）是选项 1 和 3 的替代，因为它利用了“索引”（暂存区）的暂存功能，您可以在该区域中决定实际提交的内容以及保留的内容在你的私人空间。 这很好，但根据我的经验，在很长一段时间内很难维持，特别是在一组常见的文件上，你应用了两种不同的演变。分支更干净，更易于单元测试。但是，对于您提到的小修复，这可能是一个不错的出路。

当您意识到您对两种不同的努力有两个更改时，选项 2 是实用的解决方案（它们仍然兼容，不会相互“破坏”）。
但可能是一个更简单的解决方案是：

*   在电子邮件中检查 main.h 的当前状态，
*   签出错误，修复它，签入错误
*   然后在电子邮件中结帐以恢复电子邮件功能开发。

同样，如果这两个开发工作（电子邮件和错误）是兼容的，您可以拥有包含混合活动的修订历史记录。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-16T12:11:14.127

我们使用作业，以便单个“任务”可以跨越多个提交的变更集。

所以：

1.  检查 main.h 更改是否独立于其他更改
2.  签入 main.h 的当前状态 - 在长期电子邮件工作中
3.  对 main.h 进行错误修复
4.  签入错误修复变更集
5.  如果需要，在电子邮件作业下编辑 main.h

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-10T22:48:02.863

您没有提到选项 4，即创建分支。

您可以拥有不进行任何单独更改的主代码行 - 只是来自其他分支的集成。

然后你就有了主要的开发线，你可以在其中创建你喜欢的新电子邮件功能。这是你做大部分工作的地方。

最后你有你的错误修复分支。这是您进行所有小修改和紧急错误修复的地方。一旦这些经过测试，它们就会被集成到 QA 和发布的主代码行中（应该在一个单独的分支上）。然后可以将这些编辑从主线集成到您的开发线中，以便您始终使用最新的代码。这种集成可以在您选择的时间发生 - 这样您就可以确信它不会在您的新代码中造成任何问题。

这是（IMO）最好的解决方案。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-19T20:10:40.797

对于 Perforce，您可以使用 p4 tar 之类的工具：

[http://public.perforce.com/wiki/P4tar](http://public.perforce.com/wiki/P4tar)

它使您可以保存和恢复当前的更改列表，进行修复，然后恢复您的工作。您仍然需要将您的更改集成到 main.h，但这会使任务变得更加容易。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-28T09:05:05.617

我同意[ChrisF](https://stackoverflow.com/questions/449642/handling-multiple-changesets-in-source-control-systems/632588#632588)的观点：分支将是最自然的解决方案。

我使用 Perforce 已经有一段时间了，确实它在分支方面不如其他 SCM 强大，但可以做到。

诀窍非常简单：为您正在处理的每个任务创建一个分支（[每个任务模式的上帝分支](http://www.cmcrossroads.com/bradapp/acme/branching/branch-creation.html#BranchPerTask)），然后切换到它。如果您需要修复其他问题怎么办？很简单，只需在签入所有内容后切换到不同的分支（使用一些您甚至不需要签入的 scms）修复它，然后稍后再返回到您原来的“电子邮件”分支。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-07-27T17:54:27.723

我认为 Perforce 中“纠结的工作副本”问题的解决方案正在[搁置](https://www.perforce.com/perforce/r16.1/manuals/cmdref/p4_shelve.html "搁置")

您可以按如下方式在命令行中使用它：

> p4搁置-c 123

我通常在 IDE 插件（Visual Studio 或 Eclipse）或 P4V 中使用它。当您搁置时，您可以选择是否要恢复您的文件，基本上是为您的紧急工作准备一个全新的状态。然后，您可以在完成后取消搁置文件以返回中断的工作。

如果您使用的是命令行，您可以为自己创建一个简单的脚本，该脚本既可以上架，也可以在您选择的更改列表中成功还原更改，从而为您提供一个干净的状态：

> p4 shelve -c $1 && p4 revert -c $1 //depot/your/branch/...

只需使用更改列表编号作为参数调用它。相反，当您完成其他工作后，您可以从架子上获取文件并按如下方式移除架子，这基本上会将您带到起点：

> p4 取消搁置 -c $1 -f -s $1 && p4 搁置 -c $1 -d

# sql - 根据 3 到 4 个条件对数据库表中的行进行计数和分组查询

> ID：449648
> 
> 赞同：0
> 
> 时间：2009-01-16T06:12:34.030
> 
> 标签：sql, tsql

我正在进行市场调查，所有调查数据都保存在数据库中。我需要一个查询来计算为问题“1”选择选项“1”的行数，为问题“1”选择选项“2”等等所有问题和选项……我需要在这里指定几个条件，我必须匹配 3 个表的不同 ID 并显示每个特定 ID 的结果。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T10:34:28.930

假设表

```
survey (question, answer) 
```

你可以简单地做

```
select 
    question, answer, count(*) as numberOrResponses
from
    survey
group by
    question, answer
order by
    question, answer 
```

这会给你这样的结果：

```
'question 1', 'answer 1', 10
'question 1', 'answer 2', 2 
... etc 
```

当然，如果您的表被规范化，只需在 from 部分使用正确的连接

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T07:29:52.390

查询的基础是这样的：

```
 SELECT q.question, a.answer, COUNT(a.answer)
  FROM questions q
  LEFT JOIN answers a ON (q.id = a.question_id)
 GROUP BY q.id, a.id
 ORDER BY q.id, a.id 
```

`WHERE`您可以在子句中添加必要条件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T15:41:21.567

```
SELECT 
    question,
    sum(CASE (answer1) WHEN "true" THEN 1 WHEN "false" THEN 0 END) as answer1,
    sum(CASE (answer2) WHEN "true" THEN 1 WHEN "false" THEN 0 END) as answer2
FROM 
    survey
group by 
    question 
```

我希望这是你想要的！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T07:26:41.697

我认为您将不得不以艰难的方式做到这一点：

```
SELECT COUNT(`keyfield`)
 WHERE `column` = '1' 
```

和，

```
SELECT COUNT(`keyfield`)
 WHERE `column` = '2' 
```

否则，您将需要一个脚本来运行数据/选项的所有迭代。你在哪个平台？

# apache - DoS 攻击和蛮力攻击有什么区别？

> ID：449650
> 
> 赞同：4
> 
> 时间：2009-01-16T06:13:26.943
> 
> 标签：apache, security

我正在阅读有关 Apache 服务器上的 DoS 攻击的信息，但有时会弹出“蛮力”一词我知道 DoS 攻击但“蛮力”似乎很相似，有区别还是只是 DoS 的另一个词？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-16T06:19:28.087

**蛮力**攻击使用一种尝试尝试密码/密钥的每种组合来访问特定系统的技术。黑客进入系统后会做什么取决于黑客的动机。

**DoS（拒绝服务）**攻击描述了黑客的动机是关闭系统的情况，从而给系统用户带来最大的不便。

它们不能真正相互比较，因为蛮力是一种进入的技术，而 DoS 是*一种**攻击*。攻击可能*既是*暴力破解，也可能是 DoS。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-16T06:18:22.207

DoS 或拒绝服务是试图使其目标用户无法使用计算机资源。它通常包括一个或多个人协同的恶意努力，以暂时或无限期地阻止 Internet 站点或服务有效或根本无法运行

蛮力攻击是一种通过系统地尝试大量可能性来击败密码方案的方法。例如，在密钥空间中尝试大量可能的密钥以解密消息。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-16T06:29:48.737

蛮力是指依赖计算机快速获得答案的问题的解决方案。通常，它通过尝试所有可能性来工作。例如，如果您想知道所有数字 1 到 100 的总和，您可以执行以下操作：

```
sum = 0
for i from 1 to 100
  sum = sum + i
end 
```

那将是蛮力。您还可以注意到 1 到 100 包含 50 对，总计 101，并像这样解决它：

```
sum = 50 * 101 
```

这是一种聪明的方法。请注意，蛮力通常更容易提出。

该概念以明显的方式扩展到安全性。例如，如果您想在一个需要 8 个字符的密码的系统上闯入某人的帐户，您可以开始尝试密码——aaaaaaaa、aaaaaaab……——最终它会奏效。那是蛮力。您可以尝试常用密码列表（不那么暴力）。或者您可能会注意到该站点将您登录的人存储在 cookie 中，然后编辑 cookie（不是蛮力）。

与破解加密类似。您可以尝试所有可能的密钥（蛮力，不会以合理的密码结束此生命周期）。或者您可以分析密码的弱点（如果它是一个好的密码，则非常困难，绝对不是蛮力）。

而且，为了把这一切联系起来，如果你想关闭一个网站，你可以只发送一堆流量/请求/不管它的大方向。那是蛮力。这就是 DoS 攻击。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-16T06:42:55.467

仅举**一个不涉及暴力破解的 DoS 攻击示例**，假设有一个网站在 3 次登录尝试失败后锁定了用户帐户。我知道您在该站点上有一个帐户，并且我知道您的用户名是 jdoe。我决定不希望您使用该站点，因此我尝试以您的身份登录 3 次，每次都失败。您的帐户被锁定，您必须致电管理员才能重新激活它。然后我下周再做一次，只是为了让自己讨厌。本质上，我使用该站点的锁定功能来拒绝为您提供服务，但不涉及蛮力。

**我怀疑两者之间的混淆源于以下几点。**最流行的 DoS 案例涉及使用网络请求使服务器不堪重负。听起来有人正在对服务器施加“蛮力”，并且用常见的日常语言可能是正确的。但真正的蛮力在计算中具有特殊的含义。它描述了详尽搜索解决方案空间以找到正确解决方案的算法，而不是使用启发式、智能猜测等更“精炼”的方法。因此，在安全方面，蛮力攻击涉及尝试所有可能的密钥、所有可能的密码等。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-16T06:18:35.810

“蛮力”攻击是指尝试所有可能的组合，通常是在加密上下文中。（例如，如果我猜你的密码，我可以从“a”开始，然后是“b”，然后是“c”等等；或者如果我想解决数独难题，我可以尝试所有可能的组合，直到我找到一个有效的。）

显然，这与拒绝服务攻击（通常是指发送如此多的虚假请求以致服务器不堪重负）无关。如果您在同一上下文中看到这两个短语，那么作者可能会感到困惑。

# vb.net - 如何创建长度超过 260 个字符的文件的副本

> ID：449652
> 
> 赞同：6
> 
> 时间：2009-01-16T06:14:53.713
> 
> 标签：vb.net, excel

如何使用 vb.net 创建长度超过 260 个字符的文件的副本，包括文件名

当我们尝试使用 File.Copy 方法创建副本时，它会抛出如下异常：

“指定的路径、文件名或两者都太长。完全限定文件名必须小于 260 个字符，目录名必须小于 248 个字符。”

有没有可能，请帮忙...

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-16T06:31:26.423

您遇到了 MAX_PATH 限制。作为一种解决方法，您应该能够直接 P/Invoke 到 kernel32.dll 的 CopyFile 函数，并在目标路径前使用“\\?\”前缀来防止遇到 MAX_PATH 问题。

请注意，虽然您能够以大多数应用程序无法打开它的方式复制文件，但它们也受到 MAX_PATH 的限制。

可以在这里找到对该问题的一个很好的概述：http: [//blogs.msdn.com/bclteam/archive/2007/02/13/long-paths-in-net-part-1-of-3-kim-hamilton .aspx](http://blogs.msdn.com/bclteam/archive/2007/03/26/long-paths-in-net-part-2-of-3-long-path-workarounds-kim-hamilton.aspx)

可以在第 2 部分中找到一些使用 C# 调用这些方法的示例代码：http: [//blogs.msdn.com/bclteam/archive/2007/03/26/long-paths-in-net-part -2-of-3-long-path-workarounds-kim-hamilton.aspx](http://blogs.msdn.com/bclteam/archive/2007/03/26/long-paths-in-net-part-2-of-3-long-path-workarounds-kim-hamilton.aspx)

schnaader[链接](http://www.delimon.be/Software.aspx)到的库看起来可以为您节省 P/Invoking 到 kernel32.dll 的问题，不确定您是否要依赖外部 dll。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T06:30:59.950

有一些缩短名称的技巧...请参阅[http://support.microsoft.com/?kbid=320081#上标题为“](http://support.microsoft.com/?kbid=320081#)**原因 4：文件存在于比 MAX_PATH 字符更深的路径中**”的部分

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-03-13T00:47:30.793

你会在这里找到一个支持长文件名的[完整库。](http://gallery.technet.microsoft.com/DelimonWin32IO-Library-17cc7893)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T06:21:57.620

我得到了关于这个问题的解决方案。

在研发中，我发现即使总长度超过 260 个字符，我们也可以重命名指定的路径目录，然后我们可以将文件从指定位置复制到新的（临时）位置以进行扫描。最后我们可以再次将文件路径名重命名为原始路径名。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-06-29T10:54:06.133

jdelimon 已经指向 Delimon.Win32.IO 库，但他们最后一次更新它是 2012 年（.Net 2.0）。这是另一个库：[AlphaFS](http://alphafs.alphaleonis.com/index.html)

他们升级到 .Net 4.5.2（2017 年 6 月 29 日）。我使用了一个非常短的#C 程序作为 Excel 的 COM 插件。请参阅[如何创建程序](http://www.geeksengine.com/article/create-dll.html)的链接和[复制程序的链接](https://msdn.microsoft.com/de-de/library/bb762914(v=vs.110).aspx)。您只需将程序分配给 .NET 4.5，添加对 4.5 的 AlphaFS.dll 的引用并替换`using System.IO`为`using Alphaleonis.Win32.Filesystem;`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T06:31:38.593

在这种情况下，我通常会做的是：

1）计算文件名`length`

2）如果`FileNameLength > 259`然后裁剪文件名足以处理新名称，然后复制具有裁剪目标名称的文件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-16T06:32:07.187

看看[这个库](http://www.delimon.be/Software.aspx)和[这个讨论](http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/2541a9b9-acd7-4338-89b1-dfc0408e41b5/)。

# db2 - 在 DB2 上同时运行多个查询时出现异常

> ID：449662
> 
> 赞同：2
> 
> 时间：2009-01-16T06:21:27.677
> 
> 标签：db2

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-25T15:12:40.673

缓冲池的页面大小必须与与之关联的表空间的页面大小相匹配。您的所有表空间都使用 32K 页吗？您应该检查是否有其他缓冲池用完页面。10,000 页应该足以避免您看到的错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T08:38:53.703

我们在每条记录被插入/更新后提交。所以，重做日志不是问题。（缓冲池永远不会被溢出）。

32K 是缓冲池的页面大小，缓冲池包含 10000 个页面。那么，这些配置适合缓冲池吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T08:13:05.860

最可能的原因是您的事务没有发出“提交”，因此在缓冲池中积累了未提交的数据。

此外，对于当前的硬件来说，32K 似乎非常小（因为 DB2 可以处理几兆字节的 CLOB 和 BLOB），32MB 或更多更适合缓冲池大小。

# http - 我可以通过 1 个 IP 地址在 LAN 上托管两个独立的 Web 服务器到外部世界吗？

> ID：449663
> 
> 赞同：6
> 
> 时间：2009-01-16T06:21:53.213
> 
> 标签：http, iis-7, http-headers

我是一名从事家庭网络开发业务的网络程序员。我家中有多个通过 FIOS 连接的 Web 服务器。我有自己的域通过 dyndns.org 的自定义域服务指向我的路由器。

我的 ISP 给了我一个静态 IP 地址，目前允许我将路由器配置为通过端口 80 引导来自一台服务器的出站 Web 流量，并通过端口 8080 引导另一台服务器的出站 Web 流量。这很糟糕，因为如今许多公司封锁了端口 8080，导致一些我的企业客户无法访问我的第二个 Web 服务器。

我有什么方法可以使用两个单独的主机名将常规的旧端口 80 网络流量定向到我网络内部的两个单独的网络服务器？

例如。我想`http://webserver1.mydomain.com`在我的网络上访问一个 Web 服务器，然后`http://webserver2.mydomain.com`访问另一个 Web 服务器并在端口 80 上提供两组流量。

这甚至可能吗？如果没有，我可以通过以编程方式将流量从一个 Web 服务器透明地路由到另一个来进行黑客攻击吗？

作为记录，我运行 MS Windows Server 2008 IIS 7.0 堆栈，一个 D-link DIR-655 路由器，并使用 DynDNS 来满足我的域需求。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-16T06:39:51.370

您寻找的解决方案的名称称为反向代理。
在[apache](http://httpd.apache.org/docs/2.2/mod/mod_proxy.html)、[squid](http://www.visolve.com/squid/whitepapers/reverseproxy.php)和[Mircosoft ISA Server](http://www.microsoft.com/forefront/edgesecurity/isaserver/en/us/default.aspx)中有实现。

如果你喜欢冒险，你总是可以自己动手？或修改类似[的内容](http://www.codeproject.com/KB/web-security/HTTPReverseProxy.aspx)以满足您的需求。

我有客户使用大量的 squid 反向代理，而且效果很好！

虽然它确实会破坏您在网络服务器上的网络日志，但流量似乎都来自您正在进行重定向/重写的内部代理主机。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T06:27:26.387

是的，使用 IIS7 的 Rewrite 模块来执行此操作

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T06:30:13.743

某种应用层路由可能是您的选择。本文指出如何在 ISA 服务器上进行操作（使用 web 规则）

[http://www.codinghorror.com/blog/archives/000984.html](http://www.codinghorror.com/blog/archives/000984.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T06:38:05.647

您也许可以使用 2 个虚拟主机设置 apache，然后在它们的每个块中放置本地网络上相应站点的代理：

在虚拟主机 1 中：

```
ProxyRequests Off

<Proxy *>
Order deny,allow
Allow from all
</Proxy>

ProxyPass / http://192.168.0.49/
ProxyPassReverse / http://192.168.0.49/ 
```

在虚拟主机 2 中：

```
ProxyRequests Off

<Proxy *>
Order deny,allow
Allow from all
</Proxy>

ProxyPass / http://192.168.0.50/
ProxyPassReverse / http://192.168.0.50/ 
```

你需要[mod_proxy](http://httpd.apache.org/docs/2.2/mod/mod_proxy.html)，我什至不确定这是否可行

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T07:31:18.380

为什么不保持简单，只需在您的帐户上订购或请求第二个 IP 地址？这似乎是一个比复杂的硬件和/或软件设置更容易的解决方案。只是不要告诉他们您正在托管网站，因为 ISP 通常不喜欢人们在住宅帐户上这样做（我实际上很惊讶他们没有阻止端口 80）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-12-20T23:14:21.133

这是一个旧帖子，但我有同样的问题。Verizon 只给你 1 个 ip。如果你想要更多，你必须使用他们的商业计划，每月大约 100 美元。我有一个 redhat 和 windows 2008r2 家庭服务器正在运行。我有 2 个godaddy 域名都指向我的verizon wan ip 地址。我的 windows 服务器为 mysite1.com 使用端口 80，为 mysite2.com 使用我的 linux 端口 8080。我不使用 DYN，因为我想使用自己的域名。我制作了一个 IIS 站点主机头来将 mysite2.com 指向我的 linux 机器。这两个域都可以在线工作，但在浏览器 url 窗口中输入 mysite2.com 会指向 mysite2.com:8080。我认为没有办法隐藏 8080。至少不正确。我在一家政府机构工作，他们阻止使用端口 8080 的站点。他们还阻止使用掩码/帧转发的域。所以屏蔽 8080 会导致你的网站被屏蔽。

# ruby-on-rails - 使用 ActiveRecord 和 Rails 将数据插入 postgresql 数据库出现此错误：RuntimeError: ERROR C22003 Minteger o

> ID：449665
> 
> 赞同：2
> 
> 时间：2009-01-16T06:22:41.230
> 
> 标签：ruby-on-rails, postgresql, activerecord

我正在使用 Ruby 1.8.6 和 rails 2.1.1（我也测试过 rails 2.2.2）。我一直在使用 Sqlite3，最近迁移到 Postgresql 8.2.6 以供生产使用。现在出现了这个错误。有趣的是，当我复制插入语句并使用 psql 将其直接插入 postgres 时，它工作正常。我想问题出在轨道级别的某个地方。但是，我不知道它是什么。因此，如果有人知道问题是什么或如何解决，请告诉我。

```
RuntimeError: ERROR C22003  Minteger out of range   Fint8.c L1008   Rint84: INSERT INTO     "resource_usages" ("measurement_type", "updated_at", "time", "max", "min", "average", "tst_data_id", "created_at") VALUES(E'jmxMemHeapMax', '2009-01-16 12:54:56.600105', 1, 5726666752, 5726666752, 5726666752, 2, '2009-01-16 12:54:56.600105') RETURNING "id"  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/connection_adapters/abstract_adapter.rb:147:in `log'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/connection_adapters/postgresql_adapter.rb:484:in `execute'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/connection_adapters/postgresql_adapter.rb:929:in `select_raw'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/connection_adapters/postgresql_adapter.rb:916:in `select'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/connection_adapters/abstract/database_statements.rb:7:in `select_all_without_query_cache'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/connection_adapters/abstract/query_cache.rb:61:in `select_all'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/connection_adapters/abstract    /database_statements.rb:13:in `select_one'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/connection_adapters/abstract  /database_statements.rb:19:in `select_value'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/connection_adapters  /postgresql_adapter.rb:433:in `insert'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/base.rb:2517:in `create_without_callbacks'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/callbacks.rb:220:in `create_without_timestamps'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/timestamp.rb:29:in `create'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/base.rb:2483:in `create_or_update_without_callbacks'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/callbacks.rb:207:in `create_or_update'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/base.rb:2211:in `save_without_validation'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/validations.rb:911:in `save_without_dirty'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/dirty.rb:75:in `save_without_transactions'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/transactions.rb:106:in `save'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/connection_adapters/abstract/database_statements.rb:66:in `transaction'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/transactions.rb:79:in `transaction'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/transactions.rb:98:in `transaction'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/transactions.rb:106:in `save'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/transactions.rb:118:in `rollback_active_record_state!'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/transactions.rb:106:in `save'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/associations/has_many_association.rb:62:in `insert_record'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/associations/association_collection.rb:102:in `<<'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/associations/association_collection.rb:339:in `add_record_to_target_with_callbacks'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/associations/association_collection.rb:101:in `<<'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/associations/association_collection.rb:99:in `each'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/associations/association_collection.rb:99:in `<<'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/connection_adapters/abstract  /database_statements.rb:66:in `transaction'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/transactions.rb:79:in `transaction'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/transactions.rb:98:in `transaction'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/associations/association_collection.rb:98:in `<<'  
/srv/www/vhosts/performanceTesting/app/models/tst_data.rb:80:in `add_resource_usage_data'  
/srv/www/vhosts/performanceTesting/app/models/tst_data.rb:68:in `each'  
/srv/www/vhosts/performanceTesting/app/models/tst_data.rb:68:in `add_resource_usage_data'  
/srv/www/vhosts/performanceTesting/app/models/tst_definition.rb:196:in `run'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/associations/association_proxy.rb:173:in `send'  
/usr/lib64/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/associations/association_proxy.rb:173:in `method_missing'  
/srv/www/vhosts/performanceTesting/app/models/job.rb:54:in `send'  
/srv/www/vhosts/performanceTesting/app/models/job.rb:54:in `start'  
/srv/www/vhosts/performanceTesting/lib/daemons/queue_runner.rb:34  
/srv/www/vhosts/performanceTesting/lib/daemons/queue_runner.rb:29:in `initialize'  
/srv/www/vhosts/performanceTesting/lib/daemons/queue_runner.rb:29:in `new'  
/srv/www/vhosts/performanceTesting/lib/daemons/queue_runner.rb:29  
/usr/lib64/ruby/gems/1.8/gems/activesupport-2.1.1/lib/active_support/dependencies.rb:503:in `load'  
/usr/lib64/ruby/gems/1.8/gems/activesupport-2.1.1/lib/active_support/dependencies.rb:503:in `load'  
/usr/lib64/ruby/gems/1.8/gems/activesupport-2.1.1/lib/active_support/dependencies.rb:355:in `new_constants_in'  
/usr/lib64/ruby/gems/1.8/gems/activesupport-2.1.1/lib/active_support/dependencies.rb:503:in `load'  
/usr/lib64/ruby/gems/1.8/gems/daemons-1.0.10/lib/daemons/application.rb:176:in `start_load'  
/usr/lib64/ruby/gems/1.8/gems/daemons-1.0.10/lib/daemons/application.rb:257:in `start'  
/usr/lib64/ruby/gems/1.8/gems/daemons-1.0.10/lib/daemons/controller.rb:69:in `run'  
/usr/lib64/ruby/gems/1.8/gems/daemons-1.0.10/lib/daemons.rb:139:in `run'  
/usr/lib64/ruby/gems/1.8/gems/daemons-1.0.10/lib/daemons/cmdline.rb:105:in `call'  
/usr/lib64/ruby/gems/1.8/gems/daemons-1.0.10/lib/daemons/cmdline.rb:105:in `catch_exceptions'  
/usr/lib64/ruby/gems/1.8/gems/daemons-1.0.10/lib/daemons.rb:138:in `run'  
./lib/daemons/queue_runner_ctl:26 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T08:17:38.177

错误在 PostgreSQL 级别。错误 22003 是 PostgreSQL 的“NUMERIC VALUE OUT OF RANGE”错误，如此[处所示](http://www.postgresql.org/docs/8.1/static/errcodes-appendix.html)。快速浏览一下您的插入语句会显示大于 32 位的整数，这些可能是罪魁祸首。

# internet-explorer - 绕过打印对话框的 IE 附加组件 - 从哪里开始？

> ID：449666
> 
> 赞同：0
> 
> 时间：2009-01-16T06:25:06.000
> 
> 标签：internet-explorer, dialog, printing, add-on

我需要为 IE 6/7 编写一个插件/插件，它将拦截任何 Javascript`print()`调用并自动在默认打印机上打印页面，绕过标准打印对话框。不幸的是，我对 Windows 或 IE 编程知之甚少（我来自 Cocoa 的土地），所以我不知道从哪里开始。我*想*我想写一个 BHO，但我不确定。任何帮助深表感谢。

我发现了一种在网页上的 VBScript 中实现这种效果的方法（覆盖 Print 函数），所以如果它像将代码包装在某种插件中一样简单，那将是理想的。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-16T13:15:13.423

试试[这个](http://justtalkaboutweb.com/2008/05/09/javascript-print-bypass-printer-dialog-in-ie-and-firefox/)。

```
if(navigator.appName == "Microsoft Internet Explorer"){
  var PrintCommand = '<object ID="PrintCommandObject" WIDTH=0 HEIGHT=0 CLASSID="CLSID:8856F961-340A-11D0-A96B-00C04FD705A2"></object>';
  document.body.insertAdjacentHTML('beforeEnd', PrintCommand);
  PrintCommandObject.ExecWB(6, 2);
  PrintCommandObject.outerHTML = "";
} else {
  window.print();
} 
```

但它不适用于 Windows XP SP2（和 Windows Server 2003 SP1 或更高版本）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-09T15:12:45.670

我在几年前编写了和 activex 控件。

而且是三二码。

```
SendKeys( cntrl + P )
SendKeys( enter ) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-07-30T19:52:34.293

我可以使用以下脚本实现抑制 IE11 中的多个打印对话框。

```
function callThisPrintFunction() {

  var isIE11 = !!navigator.userAgent.match(/Trident.*rv[ :]*11\./);
  if (navigator.appName == "Microsoft Internet Explorer" || isIE11== true) {

    var PrintCommand = '<OBJECT ID="PrintCommandObject" WIDTH=0 HEIGHT=0 ';
    PrintCommand += 'CLASSID="CLSID:8856F961-340A-11D0-A96B-00C04FD705A2"></OBJECT>';
    document.body.insertAdjacentHTML('beforeEnd', PrintCommand);
    PrintCommandObject.ExecWB(6, 2); PrintCommandObject.outerHTML = "";
    window.close();
  }
  else {
    window.print();
  }
} 
```

问题：有没有办法在 Chrome/Firefox 中实现这一点？

# iphone - 在 iPhone 应用程序中将视图另存为照片

> ID：449683
> 
> 赞同：2
> 
> 时间：2009-01-16T06:35:41.097
> 
> 标签：iphone

有没有一种简单的方法可以以编程方式将视图保存到 iPhone 应用程序中的照片库？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-16T06:35:51.283

我将这些方法添加到我的视图的控制器类中。他们保存照片，然后弹出一个警告框，告诉用户它是否成功。

```
- (void)savePhotoOfView:(UIView *)view
{
    UIGraphicsBeginImageContext(view.bounds.size);
    [view drawRect:view.bounds];
    UIImage *image = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    UIImageWriteToSavedPhotosAlbum(image,
                                   self,
                                   @selector(savedPhotoImage:didFinishSavingWithError:contextInfo:),
                                   NULL);
}

- (void)   savedPhotoImage:(UIImage *)image
  didFinishSavingWithError:(NSError *)error
               contextInfo:(void *)contextInfo
{    
    NSString *message = @"This image has been saved to your Photos album";
    if (error) {
        message = [error localizedDescription];
    }
    UIAlertView *alert = [[UIAlertView alloc] initWithTitle:nil
                                                    message:message
                                                   delegate:nil
                                          cancelButtonTitle:@"OK"
                                          otherButtonTitles:nil];
    [alert show];
    [alert release];
} 
```

# perl - 如何在 Perl 中对实例方法进行猴子修补？

> ID：449690
> 
> 赞同：22
> 
> 时间：2009-01-16T06:42:20.427
> 
> 标签：perl, monkeypatching

我正在尝试猴子补丁（鸭拳:-）一个`LWP::UserAgent`实例，如下所示：

```
sub _user_agent_get_basic_credentials_patch {
  return ($username, $password);
}

my $agent = LWP::UserAgent->new();
$agent->get_basic_credentials = _user_agent_get_basic_credentials_patch; 
```

这不是正确的语法——它产生：

> 无法修改 [module] 行 [lineno] 处的非左值子例程调用。

我记得（来自*Programming Perl*），调度查找是基于祝福包（`ref($agent)`我相信）动态执行的，所以我不确定实例猴子补丁如何在不影响祝福包的情况下工作。

我知道我可以子类化`UserAgent`，但我更喜欢更简洁的猴子补丁方法。同意的成年人和你有什么。;-)

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-16T07:50:04.970

正如[Fayland Lam](https://stackoverflow.com/users/55276/fayland-lam)所回答的，正确的语法是：

```
 local *LWP::UserAgent::get_basic_credentials = sub {
        return ( $username, $password );
    }; 
```

但这是修补（动态范围）整个类，而不仅仅是实例。在您的情况下，您可能可以摆脱这种情况。

如果您真的只想影响实例，请使用您描述的子类化。这可以像这样“即时”完成：

```
{
   package My::LWP::UserAgent;
   our @ISA = qw/LWP::UserAgent/;
   sub get_basic_credentials {
      return ( $username, $password );
   };

   # ... and rebless $agent into current package
   $agent = bless $agent;
} 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-01-16T17:25:45.477

如果动态范围（使用`local`）不令人满意，您可以自动化自定义包 reblessing 技术：

```
MONKEY_PATCH_INSTANCE:
{
  my $counter = 1; # could use a state var in perl 5.10

  sub monkey_patch_instance
  {
    my($instance, $method, $code) = @_;
    my $package = ref($instance) . '::MonkeyPatch' . $counter++;
    no strict 'refs';
    @{$package . '::ISA'} = (ref($instance));
    *{$package . '::' . $method} = $code;
    bless $_[0], $package; # sneaky re-bless of aliased argument
  }
} 
```

示例用法：

```
package Dog;
sub new { bless {}, shift }
sub speak { print "woof!\n" }

...

package main;

my $dog1 = Dog->new;
my $dog2 = Dog->new;

monkey_patch_instance($dog2, speak => sub { print "yap!\n" });

$dog1->speak; # woof!
$dog2->speak; # yap! 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-16T14:51:27.953

本着 Perl 的“让困难的事情成为可能”的精神，这里有一个示例，说明如何在不破坏继承的情况下进行单实例猴子修补。

我*不*建议您在任何其他人必须支持、调试或依赖的代码中实际执行此操作（就像您说的，同意成年人）：

```
#!/usr/bin/perl

use strict;
use warnings;
{

    package Monkey;

    sub new { return bless {}, shift }
    sub bar { return 'you called ' . __PACKAGE__ . '::bar' }
}

use Scalar::Util qw(refaddr);

my $f = Monkey->new;
my $g = Monkey->new;
my $h = Monkey->new;

print $f->bar, "\n";    # prints "you called Monkey::bar"

monkey_patch( $f, 'bar', sub { "you, sir, are an ape" } );
monkey_patch( $g, 'bar', sub { "you, also, are an ape" } );

print $f->bar, "\n";    # prints "you, sir, are an ape"
print $g->bar, "\n";    # prints "you, also, are an ape"
print $h->bar, "\n";    # prints "you called Monkey::bar"

my %originals;
my %monkeys;

sub monkey_patch {
    my ( $obj, $method, $new ) = @_;
    my $package = ref($obj);
    $originals{$method} ||= $obj->can($method) or die "no method $method in $package";
    no strict 'refs';
    no warnings 'redefine';
    $monkeys{ refaddr($obj) }->{$method} = $new;
    *{ $package . '::' . $method } = sub {
        if ( my $monkey_patch = $monkeys{ refaddr( $_[0] ) }->{$method} ) {
            return $monkey_patch->(@_);
        } else {
            return $originals{$method}->(@_);
        }
    };
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-16T07:35:49.040

```
sub _user_agent_get_basic_credentials_patch {
  return ($username, $password);
}

my $agent = LWP::UserAgent->new();
$agent->get_basic_credentials = _user_agent_get_basic_credentials_patch; 
```

您在这里没有 1 个，而是 2 个问题，因为这就是您正在做的事情：

```
( $agent->get_basic_credentials() ) = _user_agent_get_basic_credentials_patch(); 
```

在双方的情况下，您都在调用 subs 而不是简单地引用它们。

```
assign the result of 
              '_user_agent_get_basic_credentials_patch' 
to the value that was returned from
              'get_basic_credentials'; 
```

等价逻辑：

```
{
   package FooBar; 
   sub foo(){ 
         return 5; 
   }
   1;
}
my $x =  bless( {}, "FooBar" ); 
sub baz(){ 
      return 1; 
}
$x->foo() = baz(); 
#   5 = 1; 
```

所以难怪它抱怨。

出于同样的原因，您的答案中的“固定”代码也是错误的，还有另一个您可能没有意识到的问题：

```
 $agent->{get_basic_credentials} = _user_agent_get_basic_credentials_patch; 
```

这是相当有缺陷的逻辑，认为它的工作方式与您认为的一样。

它真正在做的是：

```
1\. Dereference $agent, which is a HashRef
2\. Set the hash-key 'get_basic_credentials' to the result from _user_agent_get_basic_credentials_patch 
```

您根本没有分配任何功能。

```
{
package FooBar; 
sub foo(){ 
     return 5; 
} 
1;
}
my $x =  bless( {}, "FooBar" ); 
sub baz(){ 
  return 1; 
}
$x->{foo} = baz(); 
#  $x is now  = ( bless{ foo => 1 }, "FooBar" ); 
#  $x->foo(); # still returns 5
#  $x->{foo}; # returns 1; 
```

猴子补丁当然是相当邪恶的，我自己还没有看到如何在类似的单一实例上覆盖方法。

但是，您可以这样做：

```
 {
     no strict 'refs'; 
     *{'LWP::UserAgent::get_basic_credentials'} = sub { 
         # code here 

     }; 
  } 
```

这将全局替换 get_basic_credentials 代码部分的行为（我可能有些错误，有人纠正我）

如果你*真的*需要在每个实例的基础上做，你可能会做一些类继承，只是构建一个派生类，和/或动态创建新包。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-16T06:45:36.363

Perl 认为您正在尝试调用赋值左侧的子例程，这就是它抱怨的原因。我认为您也许可以直接（使用`*LWP::UserAgent::get_basic_credentials`或其他方式）敲击 Perl 符号表，但我缺乏 Perl-fu 来正确制作该咒语。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-07-25T16:42:12.500

基于[John Siracusa 的回答](https://stackoverflow.com/a/451281/5257399)……我发现我仍然想要对原始函数的引用。所以我这样做了：

```
MONKEY_PATCH_INSTANCE:
{
  my $counter = 1; # could use a state var in perl 5.10

  sub monkey_patch_instance
  {
    my($instance, $method, $code) = @_;
    my $package = ref($instance) . '::MonkeyPatch' . $counter++;
    no strict 'refs';
    my $oldFunction = \&{ref($instance).'::'.$method};
    @{$package . '::ISA'} = (ref($instance));
    *{$package . '::' . $method} = sub {
        my ($self, @args) = @_;
        $code->($self, $oldFunction, @args);
    };
    bless $_[0], $package; # sneaky re-bless of aliased argument
  }
}

# let's say you have a database handle, $dbh
# but you want to add code before and after $dbh->prepare("SELECT 1");

monkey_patch_instance($dbh, prepare => sub {
    my ($self, $oldFunction, @args) = @_;

    print "Monkey patch (before)\n";
    my $output = $oldFunction->(($self, @args));
    print "Monkey patch (after)\n";

    return $output;
    }); 
```

它与原始答案中的相同，除了我传递了一些参数`$self`和`$oldFunction`.

这让我们像往常一样调用`$self`'s `$oldFunction`，但在它周围装饰额外的代码。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-16T07:02:20.310

[http://www.google.com/codesearch/p?hl=en#tgg5_3LXifM/Authen-Simple-HTTP-0.1/lib/Authen/Simple/HTTP.pm&q=get_basic_credentials](http://www.google.com/codesearch/p?hl=en#tgg5_3LXifM/Authen-Simple-HTTP-0.1/lib/Authen/Simple/HTTP.pm&q=get_basic_credentials)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-01-16T06:44:25.760

**编辑：**这是我为后代保留的解决方案的错误尝试。查看赞成/接受的答案。:-)

啊，我才意识到语法需要一点调整：

```
$agent->{get_basic_credentials} = _user_agent_get_basic_credentials_patch; 
```

没有`{}`分隔符，它看起来像一个方法调用（这不是一个有效的左值）。

我仍然想知道如何通过这种语法绑定/查找实例方法。蒂亚！

# windows - 在本地机器上建立网站

> ID：449704
> 
> 赞同：-1
> 
> 时间：2009-01-16T06:57:15.670
> 
> 标签：windows, iis, dns, host

我的办公室有一个快速的专用互联网连接和一个静态 IP 地址。我还有一个网站，我想在我的服务器机器上托管（win server 2003）。我知道如何通过 IIS 设置网站，但不知道如何将我的域指向我的站点并配置我的服务器以服务于该域。任何人都可以为我指出如何实现这一目标的分步指南吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T07:04:09.183

就 DNS 而言，最简单的做法是使用[EveryDNS](http://www.everydns.com)之类的服务来配置您的域以指向您的 IP。在您的域名注册商处，将域名服务器设置为 EveryDNS 的域名服务器：

```
ns1.everydns.net
ns2.everydns.net
ns3.everydns.net
ns4.everydns.net 
```

然后，您想为您的域创建一个“A”记录，其值是您托管网站的 IP 地址。我不使用 IIS，因此可能需要在服务器上进行一些额外的配置，但是对于我使用的 HTTP 服务器（Apache、lighttpd），这就是启动和运行站点所必需的。

祝你好运！

**ps**您提到您希望通过互联网连接为该网站提供服务。除非它是一个小型业余爱好网站，否则出于以下几个原因，我建议您选择托管服务提供商：

1.  通常带宽不是对称的——即下行速度超过上行速度。浏览互联网时，下行链路是限制因素，但在提供内容时，上行链路是瓶颈。

2.  那些与您在办公室共享连接的人可能会使连接饱和，或者如果您所服务的站点出现这种情况，您会感到沮丧。

3.  您可能没有 SLA，这意味着如果互联网出现故障，您的提供商没有及时恢复连接的合同义务。

如果这些警告不适用或让您担心，那么请继续。但是，以上任何一项都适用，那么我建议考虑寻找托管服务提供商。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T07:01:33.447

这不是一个真正的编程问题，但首先您需要配置您的 dns 服务器以指向您的静态 IP 地址。您可以在域名卖家的网站上执行此操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-24T09:45:24.110

我第二个 "User:Nobody" 。

但是，从您的 Qs 来看，我相信只有 AName 或 NameServers 的设置以及将主机名添加到 IIS 的一小部分留在了您的最后。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T07:15:13.980

如果您有一个静态 IP 地址，并且该 IP 是公开的，并且您的域名注册商正在托管您的 DNS，那么这很容易，只要注册商允许您访问以编辑您的 DNS 设置。只需登录您的注册商帐户，找到 DNS 管理工具，创建一个新的（或至少有一个）“A”记录指向您的静态 IP 地址，确保该记录是“www”或“*” ，然后您就完成了——假设您没有任何软件或硬件防火墙，并且您知道如何在 IIS 中设置站点，如您所说。

在不知道您的配置或您是否遇到任何具体问题的情况下，很难说更多，但是，是的，从概念上讲，听起来唯一缺少的部分是将 A 记录指向您的机器。祝你好运！

# design-patterns - 要避免的设计模式

> ID：449731
> 
> 赞同：110
> 
> 时间：2009-01-16T07:07:07.430
> 
> 标签：design-patterns, anti-patterns

很多人似乎都同意，单例模式有许多缺点，有些人甚至建议完全避免这种模式。这里有一个[很好的讨论](https://stackoverflow.com/questions/137975/what-is-so-bad-about-singletons)。请将有关单例模式的任何评论指向该问题。

**我的问题**：是否有其他设计模式应该避免或小心使用？

* * *

## 回答 #1

> 赞同：152
> 
> 时间：2009-01-16T07:22:53.810

## 模式很复杂

应谨慎使用所有设计模式。在我看来，当有正当理由时，[您应该重构模式，而不是立即实施模式。](http://www.industriallogic.com/xp/refactoring/catalog.html)使用模式的一般问题是它们增加了复杂性。过度使用模式会使给定的应用程序或系统难以进一步开发和维护。

大多数时候，有一个简单的解决方案，您不需要应用任何特定的模式。一个好的经验法则是在代码片段倾向于被替换或需要经常更改时使用模式，并准备在使用模式时承担复杂代码的警告。

请记住，如果您发现支持代码更改的实际需求，[您的目标应该是简单性并采用一种模式。](http://www.codinghorror.com/blog/archives/000380.html)

## 模式之上的原则

如果模式明显会导致过度设计和复杂的解决方案，那么使用模式似乎没有意义。然而，对于程序员来说，阅读为大多数模式奠定基础的*设计技术和原则*会更有趣。事实上，我[最喜欢的一本关于“设计模式”的书](http://oreilly.com/catalog/9780596007126)通过重申哪些原则适用于所讨论的模式来强​​调这一点。它们足够简单，在相关性方面比模式有用。只要您可以构建代码的模块，其中一些原则就足以涵盖面向对象编程 (OOP) 之外的更多内容，例如[Liskov 替换原则。](https://stackoverflow.com/questions/56860/what-is-the-liskov-substitution-principle)

有许多设计原则，但[GoF 书第一章中](http://en.wikipedia.org/wiki/Design_Patterns)描述的那些在开始时非常有用。

*   *编程到“接口”，而不是“实现”。*（四人帮 1995:18）
*   *偏爱“对象组合”而不是“类继承”。*（四人帮 1995:20）

让那些沉没在你身上一段时间。应该注意的是，在编写 GoF 时，[接口](http://en.wikipedia.org/wiki/Interface_(computer_science))意味着任何抽象（也意味着超类），不要与作为 Java 或 C# 中的类型的接口混淆。第二个原则来自观察到的过度使用继承，[遗憾的是今天仍然很普遍](https://stackoverflow.com/questions/1740706/object-oriented-programming-class-design-confusion/)。

从那里您可以阅读由罗伯特·塞西尔·马丁[（又名鲍勃叔叔）提出的](http://en.wikipedia.org/wiki/Robert_Cecil_Martin)[SOLID 原则](http://www.lostechies.com/blogs/chad_myers/archive/2008/03/07/pablo-s-topic-of-the-month-march-solid-principles.aspx)。[Scott Hanselman 在播客中就这些原则](http://www.hanselman.com/blog/HanselminutesPodcast145SOLIDPrinciplesWithUncleBobRobertCMartin.aspx)采访了 Bob 叔叔：

*   **单一**责任原则
*   **开**闭原则
*   **利斯科夫**替换原则
*   **接口**隔离原则
*   **依赖**倒置原则

这些原则是阅读和与同行讨论的良好开端。您可能会发现这些原则相互交织，并与其他过程（例如[关注点分离](http://en.wikipedia.org/wiki/Separation_of_concerns)和[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)）交织在一起。在进行了一段时间的[TDD](http://en.wikipedia.org/wiki/Test-driven_development)之后，您可能还会发现这些原则在实践中很自然，因为您需要在一定程度上遵循它们才能创建*独立*且*可重复*的单元测试。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-01-16T10:02:10.133

设计模式的作者们自己最担心的是“访问者”模式。

这是一个“必要的邪恶”——但经常被过度使用，并且对它的需求往往揭示了你设计中更根本的缺陷。

“Visitor”模式的另一个名称是“Multi-dispatch”，因为当您希望使用单一类型的调度 OO 语言根据两种类型选择要使用的代码时，您最终会使用访问者模式（或更多）不同的对象。

典型的例子是你有两个形状之间的交集，但还有一个更简单的情况经常被忽视：比较两个异构对象的相等性。

无论如何，通常你会得到这样的结果：

```
interface IShape
{
    double intersectWith(Triangle t);
    double intersectWith(Rectangle r);
    double intersectWith(Circle c);
} 
```

这样做的问题是您已经将“IShape”的所有实现耦合在一起。您已经暗示，每当您希望向层次结构添加新形状时，您也需要更改所有其他“形状”实现。

有时，这是正确的最小设计 - 但请仔细考虑。您的设计是否*真的*要求您需要分派两种类型？你愿意写出多方法的组合爆炸吗？

通常，通过引入另一个概念，您可以减少实际必须编写的组合数量：

```
interface IShape
{
    Area getArea();
}

class Area
{
    public double intersectWith(Area otherArea);
    ...
} 
```

当然，这取决于 - 有时您确实需要编写代码来处理所有这些不同的情况 - 但在尝试使用 Visitor 之前，值得暂停一下并考虑一下。它可能会在以后为您节省很多痛苦。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-01-16T08:16:11.953

单例 - 使用单例 X 的类对它有一个难以看到且难以隔离以进行测试的依赖。

它们经常使用，因为它们方便且易于理解，但它们确实会使测试复杂化。

请参阅[单身人士是病态的骗子](http://misko.hevery.com/2008/08/17/singletons-are-pathological-liars/)。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-01-16T07:19:44.393

我相信模板方法模式通常是一种非常危险的模式。

*   很多时候，它会因为“错误的原因”耗尽你的继承层次结构。
*   基类倾向于散布各种不相关的代码。
*   它迫使您锁定设计，通常是在开发过程的早期阶段。（在很多情况下过早锁定）
*   在以后的阶段改变这一点变得越来越难。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-01-16T09:52:56.860

我认为您不应该避免使用设计模式 (DP)，并且我认为您不应该在规划架构时强迫自己使用 DP。我们应该只在我们的计划中自然出现时才使用 DP。

如果我们从一开始就定义要使用给定的 DP，那么我们未来的许多设计决策都会受到该选择的影响，无法保证我们选择的 DP 适合我们的需求。

我们也不应该做的一件事是将 DP 视为不可变的实体，我们应该使模式适应我们的需求。

所以，总而言之，我认为我们不应该避免 DP，当它们已经在我们的架构中形成时，我们应该拥抱它们。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-01-16T07:20:15.513

我认为 Active Record 是一种过度使用的模式，它鼓励将业务逻辑与持久性代码混合在一起。它不能很好地从模型层隐藏存储实现并将模型与数据库联系起来。有很多替代方案（在 PoEAA 中描述），例如 Table Data Gateway、Row Data Gateway 和 Data Mapper，它们通常提供更好的解决方案，并且肯定有助于提供更好的存储抽象。此外，您的模型*不需要*存储在数据库中；将它们存储为 XML 或使用 Web 服务访问它们怎么样？更改模型的存储机制有多容易？

也就是说，Active Record 并不总是很糟糕，并且非常适合其他选项过于繁琐的简单应用程序。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2011-04-21T13:38:17.770

这很简单...避免使用您**不清楚**或**您觉得不舒服的**设计模式。

列举一些...

有一些**不切实际的模式**，例如：

*   **`Interpreter`**
*   **`Flyweight`**

还有一些**更难掌握**，例如：

*   **`Abstract Factory`**- 具有创建对象系列的完全抽象工厂模式并不像看起来那么容易
*   **`Bridge`**- 如果抽象和实现被划分为子树，可能会变得过于抽象，但在某些情况下是非常有用的模式
*   **`Visitor`**- 双重调度机制的理解真的是必须的

还有一些模式**看起来非常简单**，但由于与它们的原理或实现相关的各种原因，**并不是那么明确的选择：**

*   **`Singleton`**- 不是完全糟糕的模式，只是过度使用（经常在那里，不适合的地方）
*   **`Observer`**- 很棒的模式......只是让代码更难阅读和调试
*   **`Prototype`**- 交易编译器检查动态（这可能是好或坏......取决于）
*   **`Chain of responsibility`**- 经常被强行/人为地推入设计中

对于那些“不切实际的”，在使用它们之前应该真正考虑一下，因为通常在某个地方有更优雅的解决方案。

对于“较难掌握”的人......当它们在合适的地方使用并且实施良好时，它们真的是很大的帮助......但是当使用不当时，它们是噩梦。

现在，接下来是什么...

*   [Head First 设计模式](https://rads.stackoverflow.com/amzn/click/com/0596007124)是必须的
*   [采购](http://sourcemaking.com/)是“急救”

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-01-16T08:26:37.020

我希望我不会因此受到太多打击。Christer Ericsson在他[的实时碰撞检测博客](http://realtimecollisiondetection.net/blog)中写了两篇关于设计模式主题的文章（[一篇](http://realtimecollisiondetection.net/blog/?p=44)、[两篇](http://realtimecollisiondetection.net/blog/?p=81)） 。他的语气相当刺耳，也许还有点挑衅，但这个人知道他的本事，所以我不会认为这是疯子的胡言乱语。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2010-07-13T12:42:28.773

有人说[服务定位器](http://blog.ploeh.dk/2010/02/03/ServiceLocatorIsAnAntiPattern.aspx)是一种反模式。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-01-16T07:11:07.827

我相信观察者模式有很多要解决的问题，它适用于非常普遍的情况，但是随着系统变得越来越复杂，它变成了一场噩梦，需要 OnBefore()、OnAfter() 通知，并且经常发布异步任务以避免重新入口。一个更好的解决方案是开发一个自动依赖分析系统，在计算期间检测所有对象访问（带有读取障碍），并在依赖图中自动创建一条边。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-01-16T07:34:58.887

对 Spoike 的帖子的补充，[重构模式](https://rads.stackoverflow.com/amzn/click/com/0321213351)是一本很好的读物。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-06-01T21:50:29.320

迭代器是另一种要避免的 GoF 模式，或者至少只有在没有替代方案可用时才使用它。

替代方案是：

1.  每个循环。这种结构存在于大多数主流语言中，并且在大多数情况下可用于避免迭代器。

2.  选择器 à la LINQ 或 jQuery。当 for-each 不合适时应该使用它们，因为并非容器中的所有对象都应该被处理。与迭代器不同，选择器允许在一个地方显示要处理的对象类型。

# python - 是否有将 VB 转换为脚本语言的工具，例如 Python 或 Ruby？

> ID：449734
> 
> 赞同：2
> 
> 时间：2009-01-16T07:09:38.657
> 
> 标签：python, vb6

我发现了[VB2Py](http://vb2py.sourceforge.net/)，但它已经沉寂了将近 5 年。是否有任何其他工具可用于将 VB6 项目转换为 Python、Ruby、Tcl 等？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T07:47:53.820

我怀疑是否会有一个很好的解决方案，因为 VB6 过于依赖 Windows API 和 VBRun 库，尽管您可以翻译除 GUI 操作之外执行其他操作的代码

你需要对这段代码做些什么特别的事情吗？您可以编译您的 VB6 功能并将其作为 COM 对象公开，并使用[IronPython](http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython)或[IronRuby](http://www.ironruby.net/)将其连接到 python，这些是 .Net 中的 Python 和 Ruby 实现，因此允许您访问 .Net 功能，尽管我不太确定 COM 公开的对象是否是很容易插入那些解释器。

也许如果你多解释一下你想做什么，你会得到更明智的回应。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T07:56:30.667

将 VB 代码编译为普通 DLL 或 COM DLL。Windows 上的所有 Python，包括 vanilla ActivePython 发行版（不需要 IronPython）都可以连接到这两种类型的 DLL。

我认为这是你最好的选择。正如 Gustavo 所说，找到可以将任意 VB6 代码编译成 Python 的东西听起来像是一个无法实现的梦想。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T11:57:25.420

一般来说，Python 比 VB 更具表现力。在 VB 中需要多行代码的东西可以在 Python 中更简单地表示。

如果 VB 在规模上真的是史诗级的，那么手动重写可能会很困难。但是维护 VB6 可能同样困难。

如果 VB 与 Windows GUI 演示密切相关，那么任何重写都可能很困难。一些 VB 程序可能有一个神秘的组织，其中关键功能隐藏在附加到 GUI 控件的 VB 代码中。

如果 VB 不是很大并且不使用 GUI 控件的神秘功能，那么重写程序并很好地将遗留代码重构为更精简和更清洁的东西可能会简单得多。

# c++ - 为什么不能在 switch 语句中声明变量？

> ID：449736
> 
> 赞同：8
> 
> 时间：2009-01-16T07:11:25.360
> 
> 标签：c++, c

我想了解更多关于“[为什么不能在switch语句中声明变量？](https://stackoverflow.com/questions/92396/why-cant-variables-be-declared-in-a-switch-statement) ”

我读了这篇文章，但我没有完全理解。您可以只在 switch 内声明变量，但要贴花和初始化变量或声明类的对象，它会给出编译时间错误。

请给我解释一下......

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-16T07:21:57.430

本质上是因为如果未命中包含变量初始化的标签，则将跳过变量的初始化。这会很糟糕，因为当且仅当初始化代码已经运行时，编译器必须发出会破坏所述变量的代码。

例如：

```
class A
{
  // has some non-trivial constructor and destructor
};

switch (x)
{
  case 1:
    A a;
    break;
  default:
    // do something else
} 
```

如果代码命中`default`，则`a`不会被初始化。编译器必须能够提前解决这个问题。可能出于性能原因，这是不允许的。

简单的解决方法是引入一个新的范围层：

```
class A
{
  // has some non-trivial constructor and destructor
};

switch (x)
{
  case 1:
    {
      A a;
    }
    break;
  default:
    // do something else
} 
```

`a`这样就可以了，现在已经很好地定义了破坏。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-16T08:09:45.760

这里存在语言语法和常识之间的冲突。对于我们人类来说，这段代码（取自 1800 INFORMATION 的答案）看起来应该可以正常工作：

```
class A
{
  // has some non-trivial constructor and destructor
};

switch (x)
{
  case 1:
    A a;
    break;
  default:
    // do something else
} 
```

毕竟，花括号定义了*a*的范围。它仅在我们进入 case 1 时创建*，*在离开*case 1块后立即销毁，除非我们输入**case 1*，否则它永远不会被使用。实际上，*case*标签和*break*指令并没有分隔作用域，因此*a*存在于之后的所有块中，即使它在逻辑上是不可达的。当然，从句法的角度来看，没有*case 1块这样的东西。*

如果你把 switch 语句看成是一堆变相的（结构化的）*goto*指令，那么作用域问题就变得更加明显了：

```
{
  if (x == 1)
    goto 1;
  else
    goto default;

  1:
    A a;
    goto end;

  default:
    // do something else

  end:
} 
```

# c# - 错误：无法删除对象，因为它在 ObjectStateManager 中找不到

> ID：449740
> 
> 赞同：11
> 
> 时间：2009-01-16T07:18:02.290
> 
> 标签：c#, entity-framework, linq-to-entities

试图在这里处理实体框架，但我遇到了一些障碍......我有一个 Get() 方法可以正常工作并且已经过测试，但是我的 Delete 方法不起作用：

```
 public static void Delete(string name)
    {
        J1Entities db = new J1Entities();
        db.DeleteObject(Get(name));
        db.SaveChanges();
    } 
```

但是我收到以下错误： **错误：无法删除对象，因为在 ObjectStateManager 中找不到它。**

我运行了调试器，DeleteObject 中的对象是正确的……我错过了什么？谢谢你。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-16T07:25:16.643

每个 EF 对象都与创建它的管理器紧密关联（因为需要更好的词）。或与之相关的。由于您没有传递`db`给您的`Get`方法，我假设它`Get`已经使用了它自己的`J1Entities`，或者该对象是独立创建的（可能是反序列化的）。

为了删除它，它必须首先知道*它*。这可能意味着通过*将*对象附加到管理器 - 但在这种情况下，似乎更简单的选择只是传递`db`到`Get`，以便`Get`在相同的上下文中完成（因为`db`将自动附加它自己创建的对象）。

# c# - 在多个线程上划分工作负载

> ID：449760
> 
> 赞同：7
> 
> 时间：2009-01-16T07:30:20.363
> 
> 标签：c#, multithreading, multicore

我想知道是否有人知道一篇描述将工作负载划分为多个线程的好文章？最好它是为 C# 编写的，但它确实是我所追求的概念，所以如果它是为不同的、相似的语言编写的，这不是问题。

我有一个问题，我必须将大量计算分成几个线程，然后在一次迭代完成后对生成的数据求和（所以我需要知道所有线程都已完成），然后开始新的迭代，提供所有具有在最后一次迭代中生成的数据的线程（数据将在每次迭代结束之前被修改）。

我希望这是有道理的，并且是可能的。无论哪种方式，我都会很感激一些关于如何解决将大量数据划分为多个线程的问题的建议（这样我就可以使用多个处理器的内核）。

谢谢您的回答！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T07:37:34.577

你应该看看 Parallel FX (PFX)，你可以在这里找到博客[和](http://www.microsoft.com/downloads/details.aspx?FamilyId=348F73FD-593D-4B3C-B055-694C50D2B0F3)[下载](http://blogs.msdn.com/pfxteam/)链接（感谢 Marc）。

不幸的是，我不知道这是否会为 .NET 2.0/3.5 发布，因为它目前计划用于 .NET 4.0。

如果您正在考虑自己实现它，请查看[Work Stealing Algorithms](http://www.google.com/search?q=work+stealing+algorithms)。

还有一个名为[Power Threading](http://www.wintellect.com/PowerThreading.aspx)的库，由[Wintellect](http://www.wintellect.com/Resources.aspx)的 Jeffrey Richter 编写，它为您提供了一些相当不错的类。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T08:03:31.667

Lasse 和 Marc 已经谈到了并行扩展。我有几篇关于使用和基准测试的博客文章（带有代码）：

*   [康威的人生游戏](http://msmvps.com/blogs/jon_skeet/archive/2008/06/01/more-parallelisation-fun-conway-s-game-of-life.aspx)
*   [可视化 Mandelbrot 集](http://msmvps.com/blogs/jon_skeet/archive/2008/05/18/mandelbrot-revisited-benchmark-edition.aspx)

这些可能有助于展示可以分解工作的各种不同方式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-16T07:36:13.453

“并行扩展”就是为此而设计的，特别是`Parallel`类（它允许您非常轻松地在线程之间拆分工作）。结果的聚合比较棘手；一些快速搜索显示了一些[混合的结果](http://trycatchfail.com/blog/post/2008/11/24/Calculating-aggregates-with-Microsoft-Parallel-Extensions-for-NET.aspx) - 但我不知道最终版本会是什么（即它可能更容易）。

CTP [在此处可用](http://www.microsoft.com/downloads/details.aspx?FamilyId=348F73FD-593D-4B3C-B055-694C50D2B0F3&displaylang=en)，或等待 .NET 4.0。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T08:29:22.473

[Paint.NET](http://www.getpaint.net/)在这方面做得很好（用于图像处理），旧版本的源代码可能仍然可以在某处免费获得。

For more information, please move over to my question regarding [a white paper by the author](https://stackoverflow.com/questions/449883/where-can-i-find-the-paint-net-multithreading-white-paper-i-once-saw) I once saw about this subject. When I wanted to show that article it to a co-worker recently I (that is: Google) was not able to find this any more, hence the question.

# android - 在哪里可以在线找到 Android 源代码？

> ID：449763
> 
> 赞同：660
> 
> 时间：2009-01-16T07:31:18.333
> 
> 标签：android, android-source

特别是，我在哪里可以浏览任何 android 源应用程序（例如联系人应用程序）的源代码？唯一的方法是去下载所有的东西吗？

* * *

## 回答 #1

> 赞同：331
> 
> 时间：2009-01-16T07:58:46.747

一切都反映在[omapzoom.org](http://omapzoom.org/)上。部分代码也[镜像在 github 上](https://github.com/android)。

[例如，联系人在这里](https://github.com/android/platform_packages_apps_contacts)。

**自 2019 年 12 月起**，您可以使用 AOSP 新的官方公​​共代码搜索工具：[cs.android.com](https://cs.android.com/)。还有 [Android 官方源代码浏览器](https://android.googlesource.com/)（基于[Gitiles](https://code.google.com/p/gitiles/)）具有组成 android 的许多不同部分的 Web 视图。一些项目（例如内核）已被删除，现在它只指向可克隆的 git 存储库。

要在本地获取所有代码，您可以使用[repo](http://source.android.com/source/git-repo.html)帮助程序，或者您可以克隆单个存储库。

和别的：

*   [下载源代码树](http://source.android.com/source/downloading.html)

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2012-02-18T13:14:32.730

2020：AOSP官方代码搜索[https://cs.android.com/](https://cs.android.com/)

* * *

**您可以通过[http://developer.android.com](http://developer.android.com/reference/classes.html)**查看源代码，当您阅读 API 时，会在 GitHub 上找到匹配源代码的链接，您只需**在 Chrome 上****添加[Android SDK Reference Search Plugin](https://chrome.google.com/webstore/detail/hgcbffeicehlpmgmnhnkjbjoldkfhoin)** .

我在这里写了一篇博客：http:
[//blog.blundellapps.com/add-source-code-links-to-android-apis/](http://blog.blundellapps.com/add-source-code-links-to-android-apis/)

[![在此处输入图像描述](https://i.stack.imgur.com/INc7u.png)](http://blog.blundellapps.com/add-source-code-links-to-android-apis/)

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2012-04-04T06:13:21.657

前几天我偶然发现了[Android XRef](http://androidxref.com/source/)，发现它很有用，特别是因为它得到了 OpenGrok 的支持，OpenGrok 提供了非常棒和令人眼花缭乱的快速搜索。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-16T07:34:15.580

我找到了一种只获取联系人应用程序的方法：

```
git clone https://android.googlesource.com/platform/packages/apps/Contacts 
```

这对我来说已经足够好了，但没有回答在网络上浏览代码的问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-12-18T20:11:34.377

您可以使用“代码搜索”从智能手机浏览 Android SDK 示例： [https ://market.android.com/details?id=sqwady.codesearch](https://market.android.com/details?id=sqwady.codesearch)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-03-05T17:14:43.680

这个 Eclipse 插件允许内联源代码查看，甚至可以进入 Android 源代码：

[http://code.google.com/p/adt-addons/](http://code.google.com/p/adt-addons/)

（编辑：特别是“Android Sources”插件：[http](http://adt-addons.googlecode.com/svn/trunk/source/com.android.ide.eclipse.source.update/) ://adt-addons.googlecode.com/svn/trunk/source/com.android.ide.eclipse.source.update/ ）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-16T07:44:10.350

gitweb 将允许您通过浏览器浏览代码（和更改）。

[http://git.or.cz/gitwiki/Gitweb](http://git.or.cz/gitwiki/Gitweb)

（不知道是否有人已经为 Android 设置了一个公共 gitweb，但它可能不会太难。）

# mobile - 关于手游移植

> ID：449770
> 
> 赞同：1
> 
> 时间：2009-01-16T07:37:17.790
> 
> 标签：mobile

我想问一些关于移动游戏移植的问题...

假设我有一个简单的 2D C++ 游戏引擎，并且有一个基于该引擎的 PC 游戏，我想将它移植到不同的移动平台 BREW、J2ME、iPhone、Android、Symbian 等。

我需要为每个平台重新编码引擎和游戏吗？还是有更简单、更有效的方法？我确信这个过程很复杂，因为不同的手机有不同的图形/处理器/内存等。我只是对移动游戏移植过程的概述感到好奇。:)

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-20T22:57:19.637

有几种攻击手机游戏移植的方法。首先，直到最近它主要是 BREW 和 J2ME。iPhone、Android 和黑莓正在改变这一格局，让原本不可能完成的移动游戏移植任务变得更加不可能。直到最近，我一直在从事 3rd 方手机游戏开发工作多年。我看到 BREW 消失了，看到出版商完全专注于 J2ME，因为移植成本正在扼杀这个行业。对它的成本（时间和金钱）进行了估算，而且似乎每个游戏的总开发成本的 50-60% 左右只是移植。

在我们公司，我们通过两个相互并行的引擎来处理移植，一个在 BREW 中，一个在 J2ME 中。我们从不支持 Symbian，因为 Symbian 开发不赚钱。它主要用于可能在一两台设备上的高端技术演示，没有任何东西可以进入大众市场。另外，大多数 Symbian 手机都支持 J2ME。

发行商将要求我们在 BREW 和 J2ME 中提供针对许多不同设备的 7 到 23 个游戏参考版本。就在继续之前，出版商也开始要求 J2ME 触摸屏参考版本，而 iPhone SKU 则“待定”，具体取决于最终产品以及当时 iPhone 版本的成本效益。然后，参考版本将被传递给移植公司，以将不同的参考翻译成数千个其他所需的 SKU。

像 Gameloft 这样的公司仍然蛮力通过移植。这就是为什么 Gameloft 的游戏质量始终高于其他行业的原因。但是，由于成本原因，小公司不可能以这种方式解决问题。不是每个人都能负担得起在北京拥有 5000 名开发人员的办公室。

有许多公司正在开发引擎以降低移植成本。 [Mobile-Distillery](http://www.mobile-distillery.com/home.htm)是我经常接触的一家，但我们最终从未使用过它。所以，我不能为他们担保。这里的问题是您将受制于另一家公司的引擎。由于它是针对数千个 SKU 而构建的，因此性能可能会出现问题。另外，在这种情况下，您实际上对游戏的低级实现几乎没有控制权。最终结果似乎是一款针对手机最低公分母的游戏。

最后，很多开发者只是放弃了支持所有移动平台的想法。iPhone 上的游戏泛滥成灾，因为 1) 它只需要针对一个平台，2) 通过 AppStore 为开发者提供 70% 的利润份额。通过运营商发布，该百分比甚至无法比较。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T07:59:56.403

这当然取决于您的“简单引擎”是用哪种语言编写的。Java 应该更容易在平台之间移动，因为它实际上是一个自己的平台。如果你的引擎是用更底层的东西编写的，比如 C++，它可能依赖于特定于平台的图形和输入库，因为 C++ 不为你提供。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T08:31:18.520

我个人可以推荐 edgelib 作为移动游戏和应用程序开发的跨平台层。

它被广泛使用，提供卓越的性能并支持当今存在的大多数重要的智能手机平台：Symbian、Win Mobile、iPhone 等。最重要的是：它很便宜，并且在您决定用它制作商业内容之前提供免费的完整评估。

您可以在以下网址找到它：[http ://www.edgelib.com](http://www.edgelib.com)

您可以在网站上看到基于此平台的游戏和其他项目的展示。

不幸的是，虽然不支持 BREW。而且由于它不是一个真正的开放平台，与其他移动操作系统平台相比，它构成了相当大的挑战，因为它的开发社区大多是专业的，并且在在线方面不是很“健谈”......这可能会随着竞争的加剧而改变按分钟更开放。

我不隶属于 Edgelib ......这只是我的个人意见。:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T08:21:04.410

天下没有免费的午餐。您正在考虑的平台不兼容，大多数平台允许您运行 C/C++ 代码，因此理论上您可以将引擎移植到某些标准，例如 ANSI 或 C99，它可以在大多数平台 PC、BREW 中编译但是，这并没有考虑到您的引擎可能需要的库。例如，如果您的引擎使用 OpenGL，那么它可以在 PC 和某些控制台上工作，但在 Symbiam 设备上您需要 OpenGL-ES，这并不完全相同，因此您需要对您使用的所有库进行抽象。

关于 J2ME 和 Android，它们是 Java 平台，因此至少没有任何特殊的 VM 库就不能在那里运行 C/C++。在这种情况下，您需要将 C/C++ 代码移植到 Java 中，这可能会有些过火。

所以我对此的回答是，虽然您可以使用标准对您的库和代码进行抽象，但您可能可以在多个平台上使用相同的引擎，只要您可以为它们使用相同的编译器。

以这个引擎[CubicVR](http://www.cubicvr.org/)为例，它允许您为 PC/Linux/MAC/iPhone（也许）/Sony PlayStation Portable 编译相同的引擎

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-16T11:03:46.953

我用于多平台开发的是实现硬件抽象层。该引擎是用 C++ 编写的，但使用纯 C 接口来实现系统调用。这允许您为您的游戏和引擎使用成熟的 C++，并链​​接到以您的平台需要的任何语言编写的系统抽象。Symbian 不支持 100% 的 C++ 功能，并且仍然存在一些错误，并且 iPhone API 使用 Objective C。C 与您提到的大多数平台（嗯，不是 Java）兼容，并且链接 C 比 C++ 更容易，因为问题较少（ABI 和所有这些东西）。

在 C 中实现一个额外的接口会慢一些，但在将它移植到其他平台时会帮助你很多。此外，它还允许您拥有除了 Symbian、BREW 等之外的 Win32/Linux/Mac 版本。我主要使用 Symbian 和 N-Gage，这些平台的调试能力远远落后于 Visual Studio 或 GDB。另一方面，Iphone 有很多很酷的工具来调试和分析你的应用程序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T08:00:44.450

1.  如果您拥有的引擎不是用 JAVA 或 FLASH 编写的，我看不到一种方法可以让您开箱即用地使用您的引擎，而无需以可能在手机上运行的语言对其进行重新编码。
2.  如果它是用 JAVA 或 FLASH 编码的，我认为你的主要问题（除了手机和电脑之间的性能差异）是主内存。听说，主存是手机游戏开发中最大的问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-16T08:11:27.300

正如其他人指出的那样，如果您的引擎构建在诸如 Java 之类的“平台无关”框架之上，那么它应该比用较低级别的语言编写更容易。但是，例如，iPhone/iPod touch 不支持 Java 和 Flash，可能需要一段时间才能支持。另一方面，如果我没记错的话，可用于这些平台的唯一 SDK 是 Objective-C，你疯狂地猜测，你并没有使用它来实现你的引擎。

通常，这取决于您编写的应用程序/游戏引擎。很可能您必须更改某些内容，因为很少有所有功能都可以在所有平台上使用。J2ME 图形是“平台无关”依赖的经典场景，至少我听说过。您必须更改多少完全取决于您的代码的可移植性，即您将可能需要更改的部分分离的程度如何。

不幸的是，这是我能给你的最好答案。

# iphone - iPhone 开发 - 设置 UIWebView 字体

> ID：449773
> 
> 赞同：46
> 
> 时间：2009-01-16T07:42:32.193
> 
> 标签：iphone, uiwebview

我必须显示我从服务器中提取的富文本，所以我使用的是 UIWebView。现在的问题是我无法控制 UIWebView 中使用的字体。如何更改字体以使用系统字体（使其与应用程序的其余部分保持一致）？

我现在正在做这样的事情：

```
myRichTextView = [[UIWebView alloc] initWithFrame:CGRectMake(x, y, width, height)];
myRichTextView.backgroundColor = [UIColor clearColor];
[myRichTextView setScalesPageToFit:NO];
[myRichTextView loadHTMLString:myString baseURL:[NSURL URLWithString:myBaseURL]]; 
```

再次，需要控制显示字体。如果我无法控制字体，请告诉我 UIWebView 的其他替代方案。

谢谢

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2009-01-17T06:10:35.243

当我像这样修改字符串时它起作用了。你的权利克里斯，它不应该有任何区别。

```
NSString *myDescriptionHTML = [NSString stringWithFormat:@"<html> \n"
                                "<head> \n"
                                "<style type=\"text/css\"> \n"
                                "body {font-family: \"%@\"; font-size: %@;}\n"
                                "</style> \n"
                                "</head> \n"
                                "<body>%@</body> \n"
                                "</html>", @"helvetica", [NSNumber numberWithInt:kFieldFontSize], content]; 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-01-16T08:23:43.953

在 HTML 文档中引用 css 样式表或将样式信息放在 HTML 文档本身的顶部

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-16T14:44:46.067

我在 Web 视图中使用以下 CSS 来完全按照您所说的进行操作。

```
body
{
    font-family:helvetica;
} 
```

但是您的看起来也应该可以。奇怪的。我能看到的唯一区别是字体与字体系列，但这不*应该*有所作为。

克里斯。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2015-12-08T04:50:29.580

系统字体

**-iOS** 9 和 Safari OS X 10 上的苹果系统

```
font-family: -apple-system;
font-family: '-apple-system','HelveticaNeue'; // iOS 8 compatible 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2014-01-30T15:43:14.320

[我制作了一个方法](https://gist.github.com/rsaunders100/8711151)，它使用给定的正确样式将一些文本包装在 HTML 正文中`UIColor`和`UIFont`. 它基于[Mustafa 的回答](https://stackoverflow.com/a/452883/296446)。

它是这样使用的：

```
NSString * htmlString = [MyClass htmlFromBodyString:@"an <b>example</b>"
                                           textFont:[UIFont systemFontOfSize:10]
                                          textColor:[UIColor grayColor]];
[webView loadHTMLString:htmlString baseURL:nil]; 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2014-07-04T07:50:57.467

另一种对我有用的简单方法

```
 UIFont *font = [UIFont systemFontOfSize:15];

      NSString *htmlString = [NSString stringWithFormat:@"<span style=\"font-family:Helvetica; font-size: %i\">%@</span>",
                     (int) font.pointSize,
                     [bodyText stringWithNewLinesAsBRs]];
       [myWebView loadHTMLString:htmlString baseURL:nil]; 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-02-09T04:19:37.977

只是改变

`font:helvetica`

到

`font-family:helvetica`

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-02-05T13:17:38.003

我用

```
body {
        font-family: 'Noteworthy-Bold';
    } 
```

这适用于我的 about-page (WebView)，因为我的应用程序的其余部分也使用 Apple 的“Noteworthy-Bold”。

如果您想使用自己的字体，请使用 @font-face 并参考 TTF 或 EOT 文件。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-05-18T02:58:34.793

这是我易于使用且易于扩展的解决方案，具有更多字体设置：

```
 myHTMLLabel = [[UIWebView alloc] initWithFrame:CGRectMake(myX,myY,myWidth,myHeight)];

                myHTMLLabel.userInteractionEnabled=NO;
                myHTMLLabel.scalesPageToFit=NO;

                [myHTMLLabel setOpaque:NO];
                myHTMLLabel.backgroundColor = myBackColor;

                NSString *myHTMLText = [NSString stringWithFormat:@"<html>"
                                        "<head><style type='text/css'>"
                                        ".main_text {"
                                        "   display: block;"
                                        "   font-family:[fontName];"
                                        "   text-decoration:none;"
                                        "   font-size:[fontSize]px;"
                                        "   color:[fontColor];"
                                        "   line-height: [fontSize]px;"
                                        "   font-weight:normal;"
                                        "   text-align:[textAlign];"
                                        "}"
                                        "</style></head>"
                                        "<body> <SPAN class='main_text'>[text]</SPAN></body></html>"];

                myHTMLText = [myHTMLText stringByReplacingOccurrencesOfString: @"[text]" withString: myText];
                myHTMLText = [myHTMLText stringByReplacingOccurrencesOfString: @"[fontName]" withString: myFontName];
                myHTMLText = [myHTMLText stringByReplacingOccurrencesOfString: @"[fontSize]" withString: myFontSize];           
                myHTMLText = [myHTMLText stringByReplacingOccurrencesOfString: @"[fontColor]" withString: myFontColorHex];
                myHTMLText = [myHTMLText stringByReplacingOccurrencesOfString: @"[textAlign]" withString: myFontAlign];

                NSLog(@"*** renderHTMLText --> myHTMLText: %@",myHTMLText);

                [myHTMLLabel loadHTMLString:myHTMLText baseURL:nil]; 
```

# python - 如何在 Python 中将 url 字符串拆分为单独的部分？

> ID：449775
> 
> 赞同：19
> 
> 时间：2009-01-16T07:43:22.130
> 
> 标签：python, url, parsing

我决定今晚我要学习 python :) 我非常了解 C（在其中编写了一个操作系统）所以我不是编程的菜鸟，所以 python 中的一切似乎都很容易，但我不知道如何解决这个问题问题：假设我有这个地址：

[http://example.com/random/folder/path.html](http://example.com/random/folder/path.html) 现在我如何从中创建两个字符串，一个包含服务器的“基本”名称，所以在这个例子中它将是 [http://example.com /](http://example.com/) 和另一个包含没有最后一个文件名的东西，所以在这个例子中它是 [http://example.com/random/folder/](http://example.com/random/folder/) 。我当然也知道分别找到第三个和最后一个斜杠的可能性，但也许你知道更好的方法:]在这两种情况下都有斜杠会很酷，但我不在乎，因为它可以很容易地添加. 那么有人对此有一个好的、快速、有效的解决方案吗？还是只有“我的”解决方案，找到斜线？

谢谢！

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-01-16T08:14:36.653

python 2.x 中的 urlparse 模块（或 python 3.x 中的 urllib.parse ）将是这样做的方法。

```
>>> from urllib.parse import urlparse
>>> url = 'http://example.com/random/folder/path.html'
>>> parse_object = urlparse(url)
>>> parse_object.netloc
'example.com'
>>> parse_object.path
'/random/folder/path.html'
>>> parse_object.scheme
'http'
>>> 
```

如果你想在 url 下的文件路径上做更多的工作，你可以使用 posixpath 模块：

```
>>> from posixpath import basename, dirname
>>> basename(parse_object.path)
'path.html'
>>> dirname(parse_object.path)
'/random/folder' 
```

之后，您可以使用 posixpath.join 将这些部分粘合在一起。

编辑：我完全忘记了 Windows 用户会被 os.path 中的路径分隔符阻塞。我阅读了 posixpath 模块文档，它对 URL 操作有一个特殊的参考，所以一切都很好。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-16T08:11:11.357

如果这是您的 URL 解析的范围，Python 的内置 rpartition 将完成这项工作：

```
>>> URL = "http://example.com/random/folder/path.html"
>>> Segments = URL.rpartition('/')
>>> Segments[0]
'http://example.com/random/folder'
>>> Segments[2]
'path.html' 
```

从[Pydoc](http://www.python.org/doc/3.0/library/stdtypes.html?highlight=rpartition#str.rpartition "PyDoc")，str.rpartition：

`Splits the string at the last occurrence of sep, and returns a 3-tuple containing the part before the separator, the separator itself, and the part after the separator. If the separator is not found, return a 3-tuple containing two empty strings, followed by the string itself`

这意味着 rpartition 会为您进行搜索，并在您指定的字符（在本例中为 / ）的最后（最右边）出现处拆分字符串。它返回一个元组，其中包含：

```
(everything to the left of char , the character itself , everything to the right of char) 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-16T07:49:55.237

我没有使用 Python 的经验，但我找到了[urlparse 模块](https://docs.python.org/3/library/urllib.parse.html#urllib.parse.urlparse)，它应该可以完成这项工作。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-16T08:08:32.530

在 Python 中，很多操作都是使用列表完成的。Sebasian Dietz 提到的 urlparse 模块可能会很好地解决您的特定问题，但如果您通常对 Python 方法在字符串中查找斜杠感兴趣，请尝试以下操作：

```
url = 'http://example.com/random/folder/path.html'
# Create a list of each bit between slashes
slashparts = url.split('/')
# Now join back the first three sections 'http:', '' and 'example.com'
basename = '/'.join(slashparts[:3]) + '/'
# All except the last one
dirname = '/'.join(slashparts[:-1]) + '/'
print 'slashparts = %s' % slashparts
print 'basename = %s' % basename
print 'dirname = %s' % dirname 
```

这个程序的输出是这样的：

```
slashparts = ['http:', '', 'example.com', 'random', '文件夹', 'path.html']
基本名称 = http://example.com/
目录名 = http://example.com/random/folder/

```

有趣的位是`split`, `join`，切片符号数组 [A:B] （包括从末端偏移的负数）以及作为奖励的`%`字符串运算符以提供 printf 样式格式。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-02-06T05:35:32.867

非常感谢这里的其他回答者，他们通过他们给出的答案为我指明了正确的方向！

似乎`sykora`我的 Python 设置（python 2.7.3）中没有答案中提到的 posixpath 模块。

根据[这篇文章](http://www.doughellmann.com/PyMOTW/urllib/#paths-vs-urls)，执行此操作的“正确”方法似乎是使用...

*   `urlparse.urlparse`并可`urlparse.urlunparse`用于分离和重新附加 URL 的基础
*   的函数`os.path`可用于操作路径
*   `urllib.url2pathname`和`urllib.pathname2url`（使路径名操作可移植，因此它可以在 Windows 等上工作）

例如（不包括重新附加基本 URL）......

```
>>> import urlparse, urllib, os.path
>>> os.path.dirname(urllib.url2pathname(urlparse.urlparse("http://example.com/random/folder/path.html").path))
'/random/folder' 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-12-02T15:58:06.573

你可以使用 python 的库 furl：

```
f = furl.furl("http://example.com/random/folder/path.html")
print(str(f.path))  # '/random/folder/path.html'
print(str(f.path).split("/")) # ['', 'random', 'folder', 'path.html'] 
```

要在第一个“/”之后访问单词，请使用：

```
str(f.path).split("/") # random 
```

# c# - 在.net中的点阵打印机上打印

> ID：449777
> 
> 赞同：1
> 
> 时间：2009-01-16T07:46:16.447
> 
> 标签：c#, .net, printing

任何人都可以告诉我如何在 C# windows 应用程序中的点阵打印机上打印文档的代码。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-16T08:31:03.203

您可以“以图形方式”打印到 Windows 中内置的点阵，尽管速度较慢。

但如果您只想打印格式简单的纯文本，则需要向您的点阵打印机发送转义命令，这比图形打印要快。不同的打印机有不同的转义命令。

以下是典型的转义命令（对于 epson）： http: [//www.printfil.com/manualen/c5.htm](http://www.printfil.com/manualen/c5.htm)

这可能会有所帮助： [https ://web.archive.org/web/20051212193242/http://sacpcug.org:80/archives/0306/prc0603.html](https://web.archive.org/web/20051212193242/http://sacpcug.org:80/archives/0306/prc0603.html)

然后我在VB6中所做的是打印到**通用/纯文本**打印机，打开PRN或LPT1作为文件句柄，然后在文件句柄上打印转义命令，所有转义命令将被重定向到连接到LPT1的任何打印机或PRN。您可以用 C# 做同样的事情，只需将 PRN 或 LPT1 作为文件打开，然后打印到它。

要添加**通用/纯文本**打印机，控制面板 > 打印机 > 添加打印机。在制造商上，选择通用，然后在打印机上，选择通用/仅文本。

您可以为 Zebra 打印机执行相同的操作（在**Generic / Text Only**上打印），这些打印机具有自己的用于打印条形码的转义命令，这比让 Windows 以图形方式打印到它要快。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-03-19T20:21:38.517

当您打印到喷墨或激光打印机时，通常不使用打印机的内置字体。您使用 Windows 字体。发生的情况是，打印机驱动程序要么构建像素图像（包括文本）并将其发送到打印机，要么将设计用于绘制线条、样条曲线和其他形状的命令发送到打印机，字体表示为线条和样条（大纲）。

当您打印到较旧的点阵打印机时，您可以这样做，但速度很慢。每一行文本都必须从像素“构建”，并且通常文本行与打印头的通道不匹配（特别是对于远大于或小于 12 磅的字体）。

使用这些打印机的旧方法，即它们的预期方式，是将文本的实际 ASCII 代码发送到打印机。例如，发送数字 65（十进制），您会得到一个大写（大写）“A”。数字 49（十进制）将打印数字“1”，而数字 32 将是一个空格，33 将是一个感叹号（“！”），依此类推。一个字节 = 一个字符。点阵打印机有自己的内置字体，并会在其字体 ROM 中查找 ASCII 代码，并从那里确定打印线在打印这些字母时必须准确敲击页面的确切时间。

通过使用 ESCape 代码，您可以指定伪粗体（基本上敲击字母两次，第二个副本仅向右移动一个点宽度）、双倍宽度（连续敲击每列导线两次）等效果每次通常都会被敲击，从而使字母的宽度增加一倍），下划线（无论字母形状是否在该点上需要它，都在整个底部打印线敲击）等等。

打印机自己的 ROM 处理了所有关于打印线等的机械细节。您的程序必须提供的只是文本的实际 ASCII 代码（包括控制代码，例如数字 13 [Carriage Return aka CR] 以将打印头返回到左边距 [或者，对于双向打印机，准备打印下一行以与上一行相反的顺序]，通常后跟数字 10 [换行又名 LF] 将纸张卷起一行以准备打印下一行）。

如果您想以打印机没有的花哨字体打印，或打印图形，您必须使用 ESCape 代码将打印机设置为“图形模式”，在这种模式下，您基本上发送字节，其位将指定触发个人在直接程序控制下打印头的电线，而不是在打印机的字体 ROM 中查找字符形状。当您使用特定于打印机的驱动程序从 Windows 正常打印时，通常会发生这种情况。

对于菊花轮或其他固定字符打印机（*例如*IBM Selectric 类型球机构），ASCII 代码会将轮子或球旋转到适当的位置，然后撞击色带，从而在页面上打印字母，或发送右锤击打色带和页面（TeleType 或旧打字机机制）。除了通过打印重复的句号并将打印头和纸张微推进一个句点的宽度/高度而不是一个字符/一行文本之外，不可能用这些来制作像素图形（这通常会磨损句点字符菊花轮或球的速度非常快，因此其中许多人都有金属加固时期）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T07:50:12.803

这与在喷墨或激光打印机上打印有何不同？

[MSDN：打印概述](http://msdn.microsoft.com/en-us/library/ms742418.aspx)

[使用 .NET 打印命名空间从您的 Windows 窗体应用程序预览和打印](http://msdn.microsoft.com/en-us/magazine/cc188767.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-06T11:45:34.703

虽然它不在 C# 中，但我编写了使用 Epson 打印机的本机字体的 Access 报告。那是几年前的事了——使用 Windows XP——但是当打印机被选为默认值时，可以通过字体选择器选择打印机的“本机”字体。

它非常整洁——我可以使用我喜欢的任何字体作为标题，打印速度很慢。然后我可以为详细信息行选择本地打印机字体，这很快。这样做我必须小心，所有“本机”字体细节都具有完全相同的垂直对齐方式，否则它会再次变慢。

# c - 有没有办法在多线程应用程序中安全地使用 errno？

> ID：449778
> 
> 赞同：36
> 
> 时间：2009-01-16T07:46:50.470
> 
> 标签：c, errno

如果您正在编写一个使用系统/库调用的多线程应用程序，该调用利用 errno 来指示错误类型，是否有一种安全的方法来使用 errno？如果没有，是否有其他方法来指示发生的错误类型，而不仅仅是发生了错误？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-01-16T07:49:26.657

如果您的标准库支持多线程，那么它可能会`#define`更改`errno`为返回线程本地错误返回值的函数调用。但是，要使用它，您通常*必须*包含`<errno.h>`，而不是依赖于`extern`声明。

我发现一篇文章[Thread-safety and POSIX.1](http://www.unix.org/whitepapers/reentrant.html)解决了这个问题。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-01-16T08:54:40.253

`man errno`说：

> errno 由 ISO C 标准定义为 int 类型的可修改左值，不得显式声明；errno 可能是一个宏。errno 是线程本地的；在一个线程中设置它不会影响它在任何其他线程中的值。

# javascript - 推荐用于 JQuery 的 JavaScript HTML 模板库？

> ID：449780
> 
> 赞同：89
> 
> 时间：2009-01-16T07:48:09.610
> 
> 标签：javascript, jquery, templates

关于哪个 HTML 模板库适合 JQuery 的任何建议？谷歌搜索出现了相当多的图书馆，但我不确定是否有一个公认的图书馆经得起时间的考验。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2011-11-19T13:00:31.097

Well, to be frank, client-side templating is very hot nowadays, but quite a jungle.

the most popular are, I believe:

*   [pure](http://beebole.com/pure/): It use only js, not his own "syntax"
*   [mustache](http://mustache.github.com/): quite stable and nice I heard.
*   [jqote2](http://aefxx.com/jquery-plugins/jqote2/): extremely fast according to jsperfs
*   jquery templates (deprecated):

there are *plenty* others, but you have to test them to see what suits you, and your project style, best.

Personally, I have a hard time with adding a new syntax and set of logic (*mixing logic and template, hello??*), and went pure js. Every single one of my templates is stored in it's own html file (./usersTable.row.html). I use templates only when ajaxing content, and I have few "logic" js files, one for tables, one for div, one for lists. and not even one for select's options (where i use another method).

Each time I tried to do something more complex, I found out the code was less clear and taking me more time to stabilize than doing it the "old" way. Logic in the template is an utter non-sense in my opinion, and adding it's own syntax adds only very-hard-to-trace bugs.

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-16T07:55:38.783

[j模板](http://jtemplates.tpython.com/)

> ### JavaScript 的模板引擎。
> 
> ### [jQuery](http://jquery.com/)插件...
> 
> 特征：
> 
> *   100% 在 JavaScript 中
> *   预编译器
> *   支持 JSON
> *   使用 Ajax
> *   允许在模板中使用 JavaScript 代码
> *   允许构建级联模板
> *   允许在模板中定义参数
> *   现场刷新！- 从服务器自动更新内容...

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-16T07:54:13.387

[这里](http://ajaxpatterns.org/Browser-Side_Templating)有一个关于这个主题的合理讨论文档，其中涵盖了一系列模板工具。不过，并非特定于 jQuery。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-01-19T22:36:02.660

[jQuery Templates Plugin](http://weblogs.asp.net/scottgu/archive/2010/05/07/jquery-templates-and-data-linking-and-microsoft-contributing-to-jquery.aspx)由 Microsoft 创建并被接受为官方 jQuery 插件。

**但请注意**，它现在已被弃用。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-12-29T07:18:30.720

我会检查[json2html](http://www.json2html.com)，它不必编写 HTML 片段，而是依靠 JSON 转换将 JSON 对象数组转换为非结构化列表。非常快并且使用 DOM 创建。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-09-22T08:55:42.760

几年前我建立了 IBDOM：http: [//ibdom.sf.net/](http://ibdom.sf.net/) | 截至 2009 年 12 月，如果您直接从主干获取它，它支持 jQuery 绑定。

```
$("#foo").injectWith(collectionOfJavaScriptObjects); 
```

或者

```
$("#foo").injectWith(simpleJavaScriptObject); 
```

此外，您现在可以将所有“data:propName”标记放在 class="data:propName other classnames" 属性中，因此您不必在应用程序的内容中乱扔这些标记。

我还没有更新那里的一堆文档以反映我最近的改进，但自 2007 年以来，我已经在生产中使用了这个框架的各种版本。

对于这个问题的怀疑者：

当微软用 IE5 发明我们现在所知的 XmlHttpRequest 和“ajax”模式时，这背后的部分承诺是纯粹在 Web 浏览器和服务器之间交换数据。该数据将被封装在 XML 中，因为在 1999/2000 年，XML 简直就是太热了。除了使用回调机制通过网络检索 xml 文档之外，MS 的 MSXML ActiveX 组件还支持我们现在所知的 XSL-T 和 XPath 的预草案实现。

结合检索 HTTP/XML、XPath 和 XSL-T，为开发人员构建丰富的“文档”提供了巨大的创造力，这些“文档”充当“应用程序”，纯粹发送，更重要的是，从服务器检索数据。

为什么这是一个有用的模式？这取决于您的用户界面有多复杂，以及您对其可维护性的关心程度。

当使用高级 CSS 构建视觉上非常丰富的语义标记界面时，您要做的最后一件事是将标记片段分块到“迷你控制器/视图”中，这样​​您就可以将 .innerHTML 文档片段放入主文件，这就是原因。

保持高级 html/css 用户界面易于管理的一个关键原则是至少在其开发的活跃阶段保留其验证。如果您的标记通过验证，您可以专注于您的 CSS 错误。现在，如果标记片段最终在用户交互的各个阶段被注入，这一切都变得非常难以管理，整个事情变得脆弱。

想法是将所有标记 UI 结构放在一个文档中，*仅*通过网络检索数据，并使用一个可靠的框架，该框架至少可以将您的数据简单地注入您的标记结构，并且最多复制标记结构您标记为可重复的。

这在 IE5+ 中使用 XSL-T 和 XPath 是可能的，但几乎没有其他浏览器。一些 F/OSS 浏览器框架一直在涉足 XPath，但我们现在还不能完全依赖它。

那么实现这种模式的下一个最好的事情是什么？IBDOM。从您的服务器获取数据，将其注入您的文档中。毫不费力。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-03-25T22:37:15.453

你应该看看 Javascript-Templates，这是一个在著名的 jQuery File Upload 插件中使用的小型模板引擎，由同一作者 Sebastian Tschan (@blueimp) 开发

[https://github.com/blueimp/JavaScript-Templates](https://github.com/blueimp/JavaScript-Templates)

**按照**Sebastian 制作的使用指南，只需**删除此行**

```
document.getElementById("result").innerHTML = tmpl("tmpl-demo", data); 
```

**换成这个**

```
$('#result').html(tmpl('tmpl-demo', data)); 
```

**不要忘记**在 HTML 文件中添加 div 结果标签

```
<div id="result"></div> 
```

享受

# php - 通过 PHP 进行 HTTP 身份验证注销

> ID：449788
> 
> 赞同：152
> 
> 时间：2009-01-16T07:56:28.017
> 
> 标签：php, authentication, .htaccess, http-headers, password-protection

注销 HTTP 身份验证保护文件夹的**正确**方法是什么？

有一些解决方法可以实现这一点，但它们具有潜在的危险，因为它们可能有问题或在某些情况/浏览器中不起作用。这就是为什么我正在寻找正确和干净的解决方案。

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2009-01-16T09:06:46.440

亩。**不存在正确的方法**，甚至不存在跨浏览器一致的方法。

这是来自[HTTP 规范](http://www.w3.org/Protocols/rfc2616/rfc2616-sec15.html#sec15.6)（第 15.6 节）的问题：

> 现有的 HTTP 客户端和用户代理通常会无限期地保留身份验证信息。HTTP/1.1。没有为服务器提供一种方法来指导客户端丢弃这些缓存的凭据。

另一方面，第[10.4.2](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.4.2)节说：

> 如果请求已包含授权凭证，则 401 响应表示已拒绝对这些凭证的授权。如果 401 响应包含与先前响应相同的质询，并且用户代理已经尝试了至少一次身份验证，则应该向用户呈现响应中给出的实体，因为该实体可能包含相关的诊断信息。

换句话说，**您可能能够再次显示登录框**（正如[@Karsten](https://stackoverflow.com/questions/449788/htaccess-logout-through-php#449813)所说），**但浏览器不必满足您的请求**- 所以不要过于依赖这个（错误）功能。

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2009-01-21T21:17:50.693

在 Safari 中运行良好的方法。也适用于 Firefox 和 Opera，但有警告。

```
Location: http://logout@yourserver.example.com/ 
```

这告诉浏览器使用新用户名打开 URL，覆盖以前的用户名。

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2010-04-11T13:37:36.383

简单的答案是您无法可靠地退出 http 身份验证。

长答案：
Http-auth（与 HTTP 规范的其余部分一样）意味着是无状态的。因此，“登录”或“注销”并不是一个真正有意义的概念。更好的查看方法是询问每个 HTTP 请求（记住页面加载通常是多个请求），“你可以做你请求的事情吗？”。服务器将每个请求视为新请求，并且与任何先前的请求无关。

浏览器选择记住您在第一个 401 中告诉它们的凭据，并在没有用户对后续请求的明确许可的情况下重新发送它们。这是为用户提供他们期望的“登录/注销”模型的尝试，但这纯粹是一个杂物。模拟这种状态持久性的是**浏览器。**Web 服务器完全不知道它。

所以“注销”，在 http-auth 的上下文中纯粹是浏览器提供的模拟，因此超出了服务器的权限。

是的，有杂物。但是它们破坏了 RESTful-ness（如果这对你有价值的话）并且它们是不可靠的。

如果您绝对需要登录/注销模型来进行站点身份验证，那么最好的选择是跟踪 cookie，以某种方式（mysql、sqlite、flatfile 等）将状态持久性存储在服务器上。这将需要评估所有请求，例如使用 PHP。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2012-10-12T20:02:26.510

**解决方法**

您可以使用 Javascript 执行此操作：

```
<html><head>
<script type="text/javascript">
function logout() {
    var xmlhttp;
    if (window.XMLHttpRequest) {
          xmlhttp = new XMLHttpRequest();
    }
    // code for IE
    else if (window.ActiveXObject) {
      xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
    }
    if (window.ActiveXObject) {
      // IE clear HTTP Authentication
      document.execCommand("ClearAuthenticationCache");
      window.location.href='/where/to/redirect';
    } else {
        xmlhttp.open("GET", '/path/that/will/return/200/OK', true, "logout", "logout");
        xmlhttp.send("");
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4) {window.location.href='/where/to/redirect';}
        }

    }

    return false;
}
</script>
</head>
<body>
<a href="#" onclick="logout();">Log out</a>
</body>
</html> 
```

上面所做的是：

*   **对于 IE** - 只需清除身份验证缓存并重定向到某处

*   **对于其他浏览器**- 在后台发送带有“注销”登录名和密码的 XMLHttpRequest。我们需要将它发送到某个路径，该路径将对该请求返回 200 OK（即它不应该要求 HTTP 身份验证）。

替换`'/where/to/redirect'`为注销后重定向到的某个路径，并替换`'/path/that/will/return/200/OK'`为您站点上将返回 200 OK 的某个路径。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-01-16T08:15:19.193

**解决方法**（不是一个干净、漂亮（甚至工作！见评论）的解决方案）：

一次禁用他的凭据。

您可以通过发送适当的标头（如果未登录）将 HTTP 身份验证逻辑移至 PHP：

```
Header('WWW-Authenticate: Basic realm="protected area"');
Header('HTTP/1.0 401 Unauthorized'); 
```

并解析输入：

```
$_SERVER['PHP_AUTH_USER'] // httpauth-user
$_SERVER['PHP_AUTH_PW']   // httpauth-password 
```

因此，一次禁用他的凭据应该是微不足道的。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-02-13T16:56:09.900

我对这个问题的解决方案如下。您可以在此页面的第二个示例中`http_digest_parse`找到该函数：http: [//php.net/manual/en/features.http-auth.php](http://php.net/manual/en/features.http-auth.php)。`$realm``$users`

```
session_start();

function LogOut() {
  session_destroy();
  session_unset($_SESSION['session_id']);
  session_unset($_SESSION['logged']);

  header("Location: /", TRUE, 301);   
}

function Login(){

  global $realm;

  if (empty($_SESSION['session_id'])) {
    session_regenerate_id();
    $_SESSION['session_id'] = session_id();
  }

  if (!IsAuthenticated()) {  
    header('HTTP/1.1 401 Unauthorized');
    header('WWW-Authenticate: Digest realm="'.$realm.
   '",qop="auth",nonce="'.$_SESSION['session_id'].'",opaque="'.md5($realm).'"');
    $_SESSION['logged'] = False;
    die('Access denied.');
  }
  $_SESSION['logged'] = True;  
}

function IsAuthenticated(){
  global $realm;
  global $users;

  if  (empty($_SERVER['PHP_AUTH_DIGEST']))
      return False;

  // check PHP_AUTH_DIGEST
  if (!($data = http_digest_parse($_SERVER['PHP_AUTH_DIGEST'])) ||
     !isset($users[$data['username']]))
     return False;// invalid username

  $A1 = md5($data['username'] . ':' . $realm . ':' . $users[$data['username']]);
  $A2 = md5($_SERVER['REQUEST_METHOD'].':'.$data['uri']);

  // Give session id instead of data['nonce']
  $valid_response =   md5($A1.':'.$_SESSION['session_id'].':'.$data['nc'].':'.$data['cnonce'].':'.$data['qop'].':'.$A2);

  if ($data['response'] != $valid_response)
    return False;

  return True;
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2012-08-23T21:04:29.103

## 分两步从 HTTP Basic Auth 注销

假设我有一个名为“密码保护”的 HTTP 基本身份验证领域，并且 Bob 已登录。要注销，我发出 2 个 AJAX 请求：

1.  访问脚本 /logout_step1。它将一个随机临时用户添加到 .htusers 并使用其登录名和密码进行响应。
2.  访问脚本 /logout_step2[使用临时用户的登录名和密码](http://coderseye.com/2007/how-to-do-http-basic-auth-in-ajax.html)进行身份验证。该脚本删除临时用户并在响应中添加此标头：`WWW-Authenticate: Basic realm="Password protected"`

此时浏览器忘记了 Bob 的凭据。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-01-16T08:01:49.643

通常，一旦浏览器向用户询问凭据并将其提供给特定网站，它将继续这样做而无需进一步提示。与您可以在客户端清除 cookie 的各种方法不同，我不知道有一种类似的方法可以要求浏览器忘记其提供的身份验证凭据。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-06-07T15:59:04.393

我发现清除`PHP_AUTH_DIGEST`or `PHP_AUTH_USER`AND`PHP_AUTH_PW`凭据的唯一有效方法是调用 header `HTTP/1.1 401 Unauthorized`。

```
function clear_admin_access(){
    header('HTTP/1.1 401 Unauthorized');
    die('Admin access turned off');
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-08-06T18:05:28.723

Trac - 默认情况下 - 也使用 HTTP 身份验证。注销不起作用且无法修复：

> *   这是 HTTP 身份验证方案本身的问题，我们无法在 Trac 中正确修复它。
> *   目前没有适用于所有主要浏览器的解决方法（JavaScript 或其他）。

*来自：* [http ://trac.edgewall.org/ticket/791#comment:103](http://trac.edgewall.org/ticket/791#comment:103)

看起来这个问题没有有效的答案，这个问题已经在七年前报告过了，这很有意义：HTTP 是无状态的。请求是否使用身份验证凭据完成。但这是客户端发送请求的问题，而不是接收请求的服务器。服务器只能说明请求 URI 是否需要授权。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-12-07T07:00:52.460

我需要重置 .htaccess 授权，所以我使用了这个：

```
<?php
if (!isset($_SERVER['PHP_AUTH_USER'])) {
    header('WWW-Authenticate: Basic realm="My Realm"');
    header('HTTP/1.0 401 Unauthorized');
    echo 'Text to send if user hits Cancel button';
    exit;
}
?> 
```

在这里找到它：http: [//php.net/manual/en/features.http-auth.php](http://php.net/manual/en/features.http-auth.php)

去搞清楚。

该页面上有许多解决方案，它甚至在底部注明：Lynx，不像其他浏览器那样清除身份验证；）

我在我安装的浏览器上对其进行了测试，一旦关闭，每个浏览器似乎都需要重新进入时重新授权。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-03-02T19:16:22.377

这可能不是正在寻找的解决方案，但我是这样解决的。我有 2 个用于注销过程的脚本。

注销.php

```
<?php
header("Location: http://.@domain.com/log.php");
?> 
```

日志文件

```
<?php
header("location: https://google.com");
?> 
```

这样我就不会收到警告并且我的会话被终止

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-16T08:03:37.953

AFAIK，在使用 htaccess（即基于 HTTP）身份验证时，没有干净的方法来实现“注销”功能。

这是因为这种身份验证使用 HTTP 错误代码“401”来告诉浏览器需要凭据，此时浏览器会提示用户提供详细信息。从那时起，直到浏览器关闭，它将始终发送凭据而无需进一步提示。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-03-03T21:25:06.117

到目前为止我发现的最好的解决方案是（它是一种伪代码，`$isLoggedIn`是 http auth 的伪变量）：

在“注销”时，只需将一些信息存储到会话中，说明用户实际上已注销。

```
function logout()
{
  //$isLoggedIn = false; //This does not work (point of this question)
  $_SESSION['logout'] = true;
} 
```

在我检查身份验证的地方，我扩展了条件：

```
function isLoggedIn()
{
  return $isLoggedIn && !$_SESSION['logout'];
} 
```

会话在某种程度上与 http 身份验证的状态相关联，因此只要用户保持浏览器打开并且 http 身份验证在浏览器中持续存在，用户就会保持注销状态。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-08-23T23:24:36.213

也许我错过了重点。

我发现结束 HTTP 身份验证的最可靠方法是关闭浏览器和所有浏览器窗口。您可以使用 Javascript 关闭浏览器窗口，但我认为您不能关闭所有浏览器窗口。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-08-01T13:03:57.580

虽然其他人说它不可能从基本的 http 身份验证中注销是正确的，但有一些方法可以实现**类似**的身份验证。一个明显的方法是使用[auth_memcookie](http://authmemcookie.sourceforge.net/)。如果您真的想使用此实现基本 HTTP 身份验证（即使用浏览器对话框登录而不是 HTTP 表单） - 只需将身份验证设置为单独的 .htaccess 保护目录，其中包含一个 PHP 脚本，该脚本重定向回用户所在的位置创建内存缓存会话。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-10-18T08:26:36.887

这里有很多很棒的 - 复杂的 - 答案。在我的特殊情况下，我找到了一个干净简单的注销解决方法。我还没有在 Edge 中进行测试。在我登录的页面上，我放置了一个与此类似的注销链接：

```
<a href="https://MyDomainHere.net/logout.html">logout</a> 
```

在该 logout.html 页面的头部（也受 .htaccess 保护）我有一个类似于这样的页面刷新：

```
<meta http-equiv="Refresh" content="0; url=https://logout:logout@MyDomainHere.net/" /> 
```

您将在其中保留“注销”字样以清除为该站点缓存的用户名和密码。

我承认，如果从一开始就需要能够直接登录多个页面，那么每个入口点都需要各自对应的 logout.html 页面。否则，您可以通过在实际登录提示之前在流程中引入额外的网守步骤来集中注销，需要输入短语才能到达登录目的地。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-08-20T13:22:58.947

我在一篇文章（[https://www.hattonwebsolutions.co.uk/articles/how_to_logout_of_http_sessions](https://www.hattonwebsolutions.co.uk/articles/how_to_logout_of_http_sessions)）中总结了我的解决方案，但是我使用了 ajax 调用和 2x htaccess 文件（如这个问题中所建议的：[How to logout of an HTTP authentication （htaccess）在谷歌浏览器中工作？](https://stackoverflow.com/questions/7682063)）。

简而言之 - 你：

1.  在相同的 AuthName 上创建一个包含 htaccess 文件的子文件夹，但需要不同的用户
2.  向页面发送 ajax 请求（使用错误的用户名）（失败），然后触发超时重定向到已注销的页面。

这样可以避免在注销文件夹中出现请求另一个用户名的辅助弹出窗口（这会使用户感到困惑）。我的文章使用了 Jquery，但应该可以避免这种情况。

# wpf - 如何在内容模型控件上使用 FixedPage 标记？

> ID：449791
> 
> 赞同：0
> 
> 时间：2009-01-16T07:59:26.217
> 
> 标签：wpf, xaml, xps, fixedpage

在 WPF 中，我尝试将 XPS 文件的 FixedPage 的标记传递给具有该`Content`属性（例如`Button.Content = XamlReader.Load(<FixedPage markup>)`）的控件。

FixedPage 标记示例：

```
<FixedPage Width="816" Height="1056" xmlns="http://schemas.microsoft.com/xps/2005/06" xml:lang="und">
    <Path Data="M 115.52,132.48 L 704.64,132.48 704.64,908.96 115.52,908.96 z" Clip="M 0,132.32 L 0,908.8 816,908.8 816,132.32 z">
        <Path.Fill>
            <ImageBrush ImageSource="/Documents/1/Resources/Images/1.JPG" Viewbox="0,0,809.333,1066.67" TileMode="None" ViewboxUnits="Absolute" ViewportUnits="Absolute" Viewport="115.52,132.48,589.12,776.48" />
        </Path.Fill>
    </Path>
</FixedPage> 
```

控件无法获取 FixedPage 标记中引用的资源。

```
ImageSource="/Documents/1/Resources/Images/1.JPG" 
```

但是，如果我将其更改为*“c:\1.jpg”*`ImageSource`之类的本地路径文件并将资源文件放在同一位置，则控件将能够显示 FixedPage 标记。

 *我的问题是，有没有办法让控件在显示 FixedPage 的同时保留资源的相对 URI 以避免修改 FixedPage 标记？就像在内存中映射 XPS 文件的结构，然后在调用期间`BaseUri`通过类设置 FixedPage 标记？这可能吗？`ParserContext``XamlReader.Load()`

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-30T21:25:46.170

可能不是。即使 ImageBrush 可以与 PackageStore 一起使用，但 URI 格式不正确；它缺少包存储中 XPS 文档的根目录。

# unix - 使用“ls -l”获取目录列表时，如何使用逗号显示文件大小？

> ID：449803
> 
> 赞同：13
> 
> 时间：2009-01-16T08:10:14.773
> 
> 标签：unix, command-line, filesystems, sysadmin

您可以执行 ' `ls -l`' 来获取详细的目录列表，如下所示：

```
-rw-rw-rw-  1 alice themonkeys 1159995999 2008-08-20 07:01 foo.log
-rw-rw-rw-  1 bob   bob         244251992 2008-08-20 05:30 bar.txt 
```

但请注意，您必须如何在屏幕上滑动手指才能计算出这些文件大小的数量级。

将逗号添加到目录列表中的文件大小的好方法是什么，如下所示：

```
-rw-rw-rw-  1 alice themonkeys 1,159,995,999 2008-08-20 07:01 foo.log
-rw-rw-rw-  1 bob   bob          244,251,992 2008-08-20 05:30 bar.txt 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2016-03-24T13:30:31.287

我刚刚发现它内置在 GNU Core Utils 中并且适用于 ls 和 du！

```
ls -l --block-size="'1"
du --block-size="'1" 
```

它适用于 Ubuntu，但遗憾的是不适用于 OSX。更多关于块大小的变体在[这里](http://www.gnu.org/software/coreutils/manual/coreutils.html#Block-size)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-16T08:19:47.720

如果您只对数量级感兴趣，请`ls -lh`执行以下操作：

```
-rw-r----- 1 alice themonkeys 626M 2007-02-05 01:15 foo.log
-rw-rw-r-- 1 bob   bob        699M 2007-03-12 23:14 bar.txt 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-16T08:25:09.363

我不认为'ls'完全有这种能力。如果您正在寻找可读性，“ls -lh”将为您提供更易于人类解析的文件大小。

```
-rw-rw-rw-  1 alice themonkeys 1.2G 2008-08-20 07:01 foo.log
-rw-rw-rw-  1 bob   bob        244M 2008-08-20 05:30 bar.txt 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-10-01T00:55:11.143

这是对 commafy.pl 的改进，它允许您使用 ls 列出或不列出文件大小。`ls`使用`commafy.pl`它的别名。

```
#!/usr/bin/perl
# Does ls and adds commas to numbers if ls -l is used.

$largest_number_of_commas = 0;
$result = `ls -C @ARGV`;

# First line adds five spaces before file size
$result =~ s/(^[-lrwxds]{10,}\s*[^\s]+\s*[^\s]+\s*[^\s]+)/$1     /gm;
$result =~ s/(.{5} )(\d{4,}) /truncatePre($1,$2).commafy($2).' '/eg;

$remove_extra_spaces = 5 - $largest_number_of_commas;
$result =~ s/(^[-lrwxds]{10,}\s*[^\s]+\s*[^\s]+\s*[^\s]+) {$remove_extra_spaces}/$1/gm;
print $result;

# adds commas to an integer as appropriate
sub commafy
{
  my($num) = @_;
  my $len = length($num);
  if ($len <= 3) { return $num; }
  return commafy(substr($num, 0, $len - 3)) . ',' . substr($num, -3);
}

# removes as many chars from the end of str as there are commas to be added
# to num
sub truncatePre
{
  my($str, $num) = @_;
  $numCommas = int((length($num)-1) / 3);
  if ($numCommas > $largest_number_of_commas) {$largest_number_of_commas = $numCommas}
  return substr($str, 0, length($str) - $numCommas);
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-05-14T22:38:39.603

这个常见的 sed 脚本应该可以工作：

```
ls -l | sed -e :a -e 's/\(.*[0-9]\)\([0-9]\{3\}\)/\1,\2/;ta' 
```

但是，我同意较早的评论，建议`ls -lh`可能是达到预期效果的更好的通用解决方案。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-10-21T15:14:57.480

这是在 OS X 上，所以您可能需要根据您的 Unix 风格对其进行一些调整。为此，我在 ~/.bashrc 点文件中创建了这样一个函数。诀窍是在 awk printf 格式字符串中使用 ' 作为文件大小。一个警告：awk 在某种程度上破坏了“总”第一行，并且也失去了终端颜色。否则，它的优点之一是它试图尽可能地保持列对齐。对我来说，这立即给出了文件大小的视觉估计。-h 开关解决方案还可以，但是你的大脑需要转换那些 Ks、Bs、Gs。以下解决方案的最大优点是您可以通过管道对其进行排序，并且排序会理解它。例如在“lc | sort -k5,5nr”中。

```
lc() {
    /bin/ls -l -GPT | /usr/bin/awk "{
        printf \"%-11s \", \$1;
        printf \"%3s \",   \$2;
        printf \"%-6s \",  \$3;
        printf \"%-6s \",  \$4;
        printf \"%'12d \", \$5;
        printf \"%3s \",   \$6;
        printf \"%2s \",   \$7;
        for (i=8; i<=NF; i++) {
            printf \"%s \", \$i
        };
        printf \"\n\";
    }"
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-16T08:19:24.973

这是一个 perl 脚本，它将过滤 ' `ls -l`' 的输出以添加逗号。如果您调用脚本 commafy.pl，那么您可以将 'ls' 别名为 ' `ls -l | commafy.pl`'。

```
#!/usr/bin/perl -p
# pipe the output of ls -l through this to add commas to numbers.

s/(.{5} )(\d{4,}) /truncatePre($1,$2).commafy($2).' '/e;

# adds commas to an integer as appropriate  
sub commafy
{
  my($num) = @_;
  my $len = length($num);
  if ($len <= 3) { return $num; }
  return commafy(substr($num, 0, $len - 3)) . ',' . substr($num, -3);
}

# removes as many chars from the end of str as there are commas to be added
#   to num
sub truncatePre
{
  my($str, $num) = @_;

  $numCommas = int((length($num)-1) / 3);

  return substr($str, 0, length($str) - $numCommas);
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-16T08:42:03.383

实际上，我正在为一位年轻的实习生寻找测试，这似乎很理想。这是他想出的：

```
for i in $(ls -1)
do
    sz=$(expr $(ls -ld $i | awk '{print $5}' | wc -c) - 1)
    printf "%10d %s\n" $sz $i
done 
```

它以极其低效的方式给出了大小的数量级。我会制作这个社区 wiki，因为我们都对你如何评价他的代码感兴趣，但我不希望我的代表受苦。

随意发表评论（温柔点，他是个新手，虽然你不会通过他的 shell 脚本猜到它:-)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-09-10T22:06:46.680

我几年前写的，在标准输入上工作；

读取标准输入并在数字中插入逗号以提高可读性发射到标准输出。例子;

```
$ ls -l testdatafile.1000M
-rw-rw-r--+ 1 mkm 车轮  1048576000 Apr 24 12:45 testdatafile.1000M

$ ls -l testdatafile.1000M | 逗号
-rw-rw-r--+ 1 mkm 车轮  1,048,576,000 Apr 24 12:45 testdatafile.1000M

```

[https://github.com/mikemakuch/commas](https://github.com/mikemakuch/commas)

# .net - 最佳 WPF 开源项目

> ID：449806
> 
> 赞同：61
> 
> 时间：2009-01-16T08:11:11.980
> 
> 标签：.net, wpf, open-source

我已经用 WPF 编程了一年多。当我开始的时候没有太多的例子和指导方针可以遵循，现在情况要好得多。

我想请您帮忙列出您建议学习的最佳 WPF（开放）源代码示例或项目，以便了解有关项目结构、最佳实践等的更多信息。

谢谢你，马可

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-16T08:20:03.680

如果对你来说有可用的源就足够了（但关于许可证并没有真正*开放）我仍然认为非常有用的 FamilyShow（* [http://www.vertigo.com/FamilyShow.aspx](http://www.vertigo.com/FamilyShow.aspx)）和 Prism（[http://www. codeplex.com/CompositeWPF](http://www.codeplex.com/CompositeWPF) ) 用于不同“规模”的方法。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-16T08:20:05.677

[想到了Crack.NET](http://www.codeplex.com/cracknetproject)和[Prism](http://www.codeplex.com/CompositeWPF)。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-07-31T11:55:28.353

您可能对[**WPF 应用程序框架 (WAF)**](http://waf.codeplex.com)的示例应用程序感兴趣。他们展示：

*   查看作文

*   UI 工作流程（向导）

*   命令绑定/快捷键

*   MVVM 模式，单元测试

*   验证

*   实体框架

*   打开/保存文件对话框

*   打印预览/打印对话框

*   本土化

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-11-20T16:41:22.650

虽然我自己没有看太多，但我听说过[Caliburn](http://www.codeplex.com/caliburn)的好东西。它是一个开源框架，可帮助您使用最佳实践和模式（如 MVC 和 MVVM）在 SL 和 WPF 中构建应用程序。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-20T14:51:14.077

仍然不是真正“开放”，但非常有趣的
MSDN 阅读器[http://code.msdn.microsoft.com/msdnreader](http://code.msdn.microsoft.com/msdnreader)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-09-06T17:54:58.840

更多来自 codeplex：

*   [WPF 和 Silverlight 的时间线控制](http://timeline.codeplex.com/)
*   [WPF 和 Silverlight 的色轮控件](http://color.codeplex.com/)

# html - 如果 Adob e Flash 不可用，则提供替代图像

> ID：449808
> 
> 赞同：17
> 
> 时间：2009-01-16T08:13:04.473
> 
> 标签：html, flash

如果用户没有安装和/或停用 Adob​​e Flash，是否有任何方法提供备用 GIF/PNG 图像。我从 W3C 中找到了如下建议，这些建议通过 JavaScript 确定客户端上是否存在 Adob​​e Flash：[W3C 提供替代图像](http://www.w3.org/WAI/GL/WD-WCAG10-NONW3C-TECHS-20000705/#flash-alt-images)

老实说，我更喜欢**非 JS**技术。我正在考虑一些 XHTML 标记，相当于`<noscript>`. （例如`<noobject>`，如果对象（在我们的例子中为 Flash）无法显示/加载）。

需要这种分离的原因如下：我工作的银行最好以 Flash 格式显示他们的横幅。如果不可能显示一个简单的图像。在过去，它很可能以前面提到的方式解决。我们目前正在进行设计更新，这就是我偶然发现这段代码的地方，这让我想知道它是否真的是最优雅和最兼容的方式。

**另一个让我印象深刻的想法**：真的可以在禁用 JavaScript 的环境中加载 Flash 对象吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-16T08:40:10.457

实际上安装了 flash 但关闭了 javascript 是一个有效的方案。这应该适用于大多数浏览器：

```
<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="800" height="600" id="flashContent">
  <param name="movie" value="flash.swf" />
  <!--[if !IE]>-->
    <object type="application/x-shockwave-flash" data="flash.swf" width="800" height="600">
  <!--<![endif]-->
      <img src="(...)" alt="Put your alternate content here" />
  <!--[if !IE]>-->
    </object>
  <!--<![endif]-->
</object> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-16T16:55:12.590

我使用以下代码进行优雅降级。它运作良好。

```
<!--[if !IE]> -->
<object type="application/x-shockwave-flash" data="flash.swf" width="500" height="100">
<!-- <![endif]-->

<!--[if IE]>
<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" 
    codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0" 
    width="500" height="100">
  <param name="movie" value="flash.swf" />
<!--><!--dgx-->
  <param name="loop" value="false">
  <param name="menu" value="false">
  <param name="quality" value="high">
  <img src="flash_replacement.png" width="500" height="100" alt="No Flash">
</object>
<!-- <![endif]--> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-16T08:23:01.520

我不知道您为什么要避免使用 javascript，它是处理 Flash 时的最佳解决方案。

使用[SWFObjects 库](http://code.google.com/p/swfobject/)（迄今为止最著名的）你可以这样做：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
            "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"> 
<head> 
 <title> My Home Page </title> 
 <meta name="viewport" content="width=780"> 
 <script type="text/javascript" src="swfobject.js"></script> 
</head> 
<body> 
 <div id="splashintro"> 
   <a href="more.html"><img src="splash_noflash.png" /></a> 
 </div>
 <script type="text/javascript"> 
   var so = new SWFObject("csplash.swf", "my_intro", "300", "240", "8", "#338899"); 
   so.write("splashintro"); 
 </script> 
 </body> 
</html> 
```

脚本所做的是将**splashintro** div 替换为 flash 文件，如果浏览器不支持 Flash，则不执行任何操作并显示**splash_noflash.png**。

**PS**有了这种技术，你就可以使用 iPhone，而不是显示蓝色立方体，它会显示图像 :)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-09-07T00:00:52.117

我发现使用内联样式来解决问题。

例如：

```
<div style="background-image: url('...');">
    <object>
     /* Embedded Flash */
    </object>
</div> 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-09-13T06:50:27.767

如果用户没有安装和/或停用 Adob​​e Flash，我们可以提供备用 GIF/PNG 图像。

```
<object id="flashcontent classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="550px" height="400px">
<param name="movie" value="mymovie.swf" />

<!--[if !IE]>-->
<object type="application/x-shockwave-flash" data="mymovie.swf" width="550px" height="400px">
<!--<![endif]-->

<p>
Fallback or 'alternate' content goes here.
This content will only be visible if the SWF fails to load.
</p>

<!--[if !IE]>-->
</object>
<!--<![endif]-->

</object> 
```

并添加这个...

```
<script type="text/javascript">
swfobject.registerObject("flashcontent", "9", "/path/to/expressinstall.swf");   
</script> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-12-26T15:52:44.560

我已经用 CSS 编写了一个简单的方法来做到这一点——根本不需要额外的 JavaScript。

将您的 ID/类命名为您的 Flash 电影所在的位置并使用背景图像。将您的 Flash 电影包装在该 div 中。

例如：

```
<div ID="MyFlashMovie"><object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="800" height="600" id="flashContent">
  <param name="movie" value="flashMovie.swf" />... etc., etc.</object>
</div> etc. 
```

然后在你的 CSS 中：

```
#MyFlashMovie {
background: url("alternateGraphic.png");
background-repeat: no-repeat;
height: XXpx;
width: XXpx;
} 
```

当 Flash 不可用时，比如在 iphone/pad 上，将显示图形。我发现唯一的缺点是，如果您的 Flash 电影使用透明背景，您将通过过渡看到 alt 图形。只需在 Flash 电影中制作一个纯色作为您的最低层（确保它与网站的背景颜色相同），它看起来会很好。

〜GreaseJunkie

# c++ - 虚函数和性能 - C++

> ID：449827
> 
> 赞同：133
> 
> 时间：2009-01-16T08:22:36.310
> 
> 标签：c++, performance, optimization, virtual-functions

在我的类设计中，我广泛使用抽象类和虚函数。我有一种感觉，虚拟功能会影响性能。这是真的？但我认为这种性能差异并不明显，看起来我正在做过早的优化。对？

* * *

## 回答 #1

> 赞同：182
> 
> 时间：2009-01-17T08:43:01.067

你的问题让我很好奇，所以我继续在我们使用的 3GHz 有序 PowerPC CPU 上运行了一些时序。我运行的测试是用 get/set 函数制作一个简单的 4d 矢量类

```
class TestVec 
{
    float x,y,z,w; 
public:
    float GetX() { return x; }
    float SetX(float to) { return x=to; }  // and so on for the other three 
} 
```

然后我设置了三个数组，每个数组包含 1024 个这些向量（小到足以放入 L1）并运行一个循环，将它们彼此相加（Ax = Bx + Cx）1000 次。我使用定义为 、 和常规函数调用的函数来运行`inline`它`virtual`。结果如下：

*   内联：8ms（每次调用 0.65ns）
*   直接：68ms（每次调用 5.53ns）
*   虚拟：160ms（每次调用 13ns）

因此，在这种情况下（一切都适合缓存），虚函数调用比内联调用慢 20 倍左右。但这究竟意味着什么？循环中的每次行程都会导致`3 * 4 * 1024 = 12,288`函数调用（1024 个向量乘以四个分量乘以每次添加的三个调用），因此这些时间代表`1000 * 12,288 = 12,288,000`函数调用。虚拟循环比直接循环多花 92 毫秒，因此每次调用的额外开销是每个函数7*纳秒。*

由此我得出结论：**是**的，虚函数比直接函数慢得多，并且**不**，除非您计划每秒调用它们一千万次，否则没关系。

另请参阅：[生成的程序集的比较。](http://assemblyrequired.crashworks.org/code-for-testing-virtual-function-speed/)

* * *

## 回答 #2

> 赞同：95
> 
> 时间：2009-01-16T08:25:56.740

一个好的经验法则是：

> 在您能够证明之前，这不是性能问题。

使用虚函数对性能的影响很小，但不太可能影响应用程序的整体性能。寻找性能改进的更好地方是算法和 I/O。

一篇关于虚函数（以及更多）的优秀文章是[Member Function Pointers and the Fastest Possible C++ Delegates](http://www.codeproject.com/KB/cpp/FastDelegate.aspx)。

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2009-01-16T08:56:41.547

当 Objective-C（所有方法都是虚拟的）是 iPhone的主要语言而*Java*是 Android 的主要语言时，我认为在我们的 3 GHz 双核塔上使用 C++ 虚拟函数是非常安全的。

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2009-01-17T08:25:49.543

在性能非常关键的应用程序（如视频游戏）中，虚拟函数调用可能太慢。对于现代硬件，最大的性能问题是缓存未命中。如果数据不在缓存中，则可能需要数百个周期才能使用。

当 CPU 获取新函数的第一条指令并且它不在缓存中时，正常的函数调用会产生指令缓存未命中。

虚函数调用首先需要从对象加载 vtable 指针。这可能导致数据缓存未命中。然后它从 vtable 加载函数指针，这可能导致另一个数据缓存未命中。然后它调用可能导致指令缓存未命中的函数，就像非虚拟函数一样。

在许多情况下，两个额外的缓存未命中不是问题，但在性能关键代码的紧密循环中，它会显着降低性能。

* * *

## 回答 #5

> 赞同：31
> 
> 时间：2009-01-16T10:08:53.070

从[Agner Fog 的“Optimizing Software in C++”手册的](http://www.agner.org/optimize/)第 44 页：

> 调用一个虚成员函数所花费的时间比调用一个非虚成员函数所花费的时间要多几个时钟周期，前提是函数调用语句总是调用相同版本的虚函数。如果版本发生变化，那么您将获得 10 - 30 个时钟周期的误预测惩罚。虚函数调用的预测和错误预测规则与switch语句相同......

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-01-16T08:28:43.693

绝对地。当计算机以 100Mhz 运行时，这是一个问题，因为每个方法调用都需要在调用之前查找 vtable。但是今天.. 在一个 3Ghz CPU 上，它具有比我的第一台计算机更多的内存的一级缓存？一点也不。与所有功能都是虚拟的相比，从主 RAM 分配内存将花费更多时间。

就像过去人们说结构化编程很慢，因为所有代码都被拆分成函数，每个函数都需要堆栈分配和函数调用！

唯一一次我什至会考虑考虑虚拟函数对性能的影响，是它是否被大量使用并在模板代码中实例化，最终贯穿所有内容。即便如此，我也不会在这上面花太多力气！

PS 想想其他“易于使用”的语言——它们所有的方法都是虚拟的，而且它们现在不会爬行。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-01-16T14:01:12.563

除了执行时间之外，还有另一个性能标准。Vtable 也会占用内存空间，在某些情况下可以避免：ATL 使用[模板的编译时“](http://en.wikipedia.org/wiki/Curiously_Recurring_Template_Pattern)[模拟动态绑定](http://www.pnotepad.org/devlog/archives/000083.html)”获得“静态多态”的效果，这有点难以解释；您基本上将派生类作为参数传递给基类模板，因此在编译时基类“知道”每个实例中的派生类是什么。不会让您将多个不同的派生类存储在基本类型的集合中（即运行时多态性），但从静态意义上讲，如果您想创建一个与预先存在的模板类 X 相同的类 Y，它具有对于这种覆盖的钩子，你只需要覆盖你关心的方法，然后你就可以得到类 X 的基方法，而不必有一个 vtable。

在内存占用较大的类中，单个 vtable 指针的成本并不高，但 COM 中的一些 ATL 类非常小，如果永远不会发生运行时多态情况，那么节省 vtable 是值得的。

另请参阅[this other SO question](https://stackoverflow.com/questions/149336/practical-uses-for-the-curiously-recurring-template-pattern)。

顺便说一下，这[是我发现的一篇](http://codegem.org/2008/10/what-did-we-pay-for-c-runtime-polymorphism-part-ii)关于 CPU 时间性能方面的文章。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-01-16T08:31:53.793

是的，你是对的，如果你对虚函数调用的成本感到好奇，你可能会发现[这篇文章](http://hbfs.wordpress.com/2008/12/30/the-true-cost-of-calls/)很有趣。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-01-16T08:58:46.643

我可以看到虚拟函数成为性能问题的唯一方法是，如果在紧密循环中调用许多虚拟函数，并且**当且仅当**它们导致页面错误或其他“重”内存操作发生时。

尽管就像其他人所说的那样，在现实生活中这对你来说几乎永远不会成为问题。如果您认为是这样，请运行分析器，进行一些测试，并验证这是否真的是一个问题，然后再尝试“取消设计”您的代码以获得性能优势。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2012-02-06T19:10:45.800

当类方法不是虚拟的时，编译器通常会进行内联。相反，当您使用指向具有虚函数的某个类的指针时，只有在运行时才能知道真实地址。

测试很好地说明了这一点，时间差 ~700% (!)：

```
#include <time.h>

class Direct
{
public:
    int Perform(int &ia) { return ++ia; }
};

class AbstrBase
{
public:
    virtual int Perform(int &ia)=0;
};

class Derived: public AbstrBase
{
public:
    virtual int Perform(int &ia) { return ++ia; }
};

int main(int argc, char* argv[])
{
    Direct *pdir, dir;
    pdir = &dir;

    int ia=0;
    double start = clock();
    while( pdir->Perform(ia) );
    double end = clock();
    printf( "Direct %.3f, ia=%d\n", (end-start)/CLOCKS_PER_SEC, ia );

    Derived drv;
    AbstrBase *ab = &drv;

    ia=0;
    start = clock();
    while( ab->Perform(ia) );
    end = clock();
    printf( "Virtual: %.3f, ia=%d\n", (end-start)/CLOCKS_PER_SEC, ia );

    return 0;
} 
```

虚函数调用的影响很大程度上取决于情况。如果函数内部调用很少且工作量很大 - 它可以忽略不计。

或者，当它是一个多次重复使用的虚拟调用，同时做一些简单的操作时——它可能真的很大。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-07-30T23:01:59.967

在我的特定项目中，我至少来回讨论了 20 次。尽管在代码重用、清晰性、可维护性和可读性方面*可以获得*一些巨大的收益，但另一方面，虚拟函数仍然存在*性能损失。*

现代笔记本电脑/台式机/平板电脑上的性能影响是否会很明显……可能不会！但是，在嵌入式系统的某些情况下，性能下降可能是代码效率低下的驱动因素，尤其是在循环中一遍又一遍地调用虚函数时。

这是一篇过时的论文，分析了嵌入式系统上下文中 C/C++ 的最佳实践：[http ://www.open-std.org/jtc1/sc22/wg21/docs/ESC_Boston_01_304_paper.pdf](http://www.open-std.org/jtc1/sc22/wg21/docs/ESC_Boston_01_304_paper.pdf)

总结：由程序员来理解使用某种结构而不是另一个结构的利弊。除非你是超级性能驱动的，否则你可能不关心性能损失，应该使用 C++ 中所有整洁的 OO 东西来帮助你的代码尽可能地可用。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-07-10T21:58:08.863

以我的经验，主要相关的事情是内联函数的能力。如果您有性能/优化需求，需要内联函数，那么您不能将函数设为虚拟，因为它会阻止这种情况。否则，您可能不会注意到差异。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-12-16T00:22:16.867

需要注意的一点是：

```
boolean contains(A element) {
    for (A current : this)
        if (element.equals(current))
            return true;
    return false;
} 
```

可能比这更快：

```
boolean contains(A element) {
    for (A current : this)
        if (current.equals(element))
            return true;
    return false;
} 
```

这是因为第一种方法只调用一个函数，而第二种方法可能调用许多不同的函数。这适用于任何语言的任何虚函数。

我说“可能”，因为这取决于编译器、缓存等。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-16T08:41:05.773

使用虚函数的性能损失永远不会超过您在设计级别获得的优势。假设调用虚函数的效率比直接调用静态函数的效率低 25%。这是因为通过 VMT 存在一定程度的间接性。但是，与实际执行函数所花费的时间相比，进行调用所花费的时间通常非常小，因此总性能成本将是微不足道的，尤其是在当前硬件性能的情况下。此外，编译器有时可以优化并看到不需要虚拟调用并将其编译为静态调用。所以不用担心尽可能多地使用虚函数和抽象类。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2011-04-29T18:31:07.803

我总是这样质疑自己，特别是因为 - 好几年前 - 我也做过这样的测试，比较标准成员方法调用和虚拟方法调用的时间，当时对结果非常生气，空的虚拟调用是比非虚拟机慢 8 倍。

今天我不得不决定是否在我的缓冲区类中，在一个对性能非常关键的应用程序中使用虚函数来分配更多内存，所以我用谷歌搜索（并找到了你），最后，再次进行了测试。

```
// g++ -std=c++0x -o perf perf.cpp -lrt
#include <typeinfo>    // typeid
#include <cstdio>      // printf
#include <cstdlib>     // atoll
#include <ctime>       // clock_gettime

struct Virtual { virtual int call() { return 42; } }; 
struct Inline { inline int call() { return 42; } }; 
struct Normal { int call(); };
int Normal::call() { return 42; }

template<typename T>
void test(unsigned long long count) {
    std::printf("Timing function calls of '%s' %llu times ...\n", typeid(T).name(), count);

    timespec t0, t1;
    clock_gettime(CLOCK_REALTIME, &t0);

    T test;
    while (count--) test.call();

    clock_gettime(CLOCK_REALTIME, &t1);
    t1.tv_sec -= t0.tv_sec;
    t1.tv_nsec = t1.tv_nsec > t0.tv_nsec
        ? t1.tv_nsec - t0.tv_nsec
        : 1000000000lu - t0.tv_nsec;

    std::printf(" -- result: %d sec %ld nsec\n", t1.tv_sec, t1.tv_nsec);
}

template<typename T, typename Ua, typename... Un>
void test(unsigned long long count) {
    test<T>(count);
    test<Ua, Un...>(count);
}

int main(int argc, const char* argv[]) {
    test<Inline, Normal, Virtual>(argc == 2 ? atoll(argv[1]) : 10000000000llu);
    return 0;
} 
```

并且真的很惊讶它 - 事实上 - 真的不再重要了。虽然内联比非虚拟更快是有道理的，而且它们比虚拟更快，但它通常涉及到整个计算机的负载，无论你的缓存是否有必要的数据，虽然你可能能够优化在缓存级别，我认为这应该由编译器开发人员完成，而不是由应用程序开发人员完成。

# asp.net - ASP.NET：可以使用 GridView 创建层次结构吗？

> ID：449833
> 
> 赞同：1
> 
> 时间：2009-01-16T08:26:24.163
> 
> 标签：asp.net, gridview, web-controls

我们在项目的某些页面中使用了 GridView 控件，我们不想大幅更改，是否可以在 gridview 中创建层次结构？这可以通过在 Gridview 中使用 GridView 来获取父子关系来实现吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T10:42:59.647

是的，你可以，而且很容易......

最好的方法是拥有一些 ObjectDataSource，以便整个过程对您来说更容易，或者当然，您可以在 paraent gridview OnRowDataBound 事件中绑定嵌套的 gridview，这完全取决于您:)

例子：

```
<asp:GridView ID="gvGrandFather" runat="server" DataSourceID="odsGrandFather">
    <Columns>
        <asp:BoundField DataField="myField1" HeaderText="myText1" />
        <asp:BoundField DataField="myField2" HeaderText="myText2" />
        <asp:BoundField DataField="myField3" HeaderText="myText3" />
        <asp:TemplateField>
            <ItemTemplate>
                <asp:GridView ID="gvFather" runat="server" DataSourceID="odsFather">
                    <Columns>
                        <asp:BoundField DataField="myField1" HeaderText="myText1" />
                        <asp:BoundField DataField="myField2" HeaderText="myText2" />
                        <asp:BoundField DataField="myField3" HeaderText="myText3" />
                        <asp:TemplateField>
                            <ItemTemplate>
                                <asp:GridView ID="gvSon" runat="server" DataSourceID="odsSon">
                                    <Columns>
                                        <asp:BoundField DataField="myField1" HeaderText="myText1" />
                                        <asp:BoundField DataField="myField2" HeaderText="myText2" />
                                        <asp:BoundField DataField="myField3" HeaderText="myText3" />
                                    </Columns>
                                </asp:GridView>
                            </ItemTemplate>
                        </asp:TemplateField>
                    </Columns>
                </asp:GridView>
            </ItemTemplate>
        </asp:TemplateField>
    </Columns>
</asp:GridView>

<asp:ObjectDataSource ID="odsGrandFather" runat="server" DataObjectTypeName="Company" TypeName="CompanyDAO" SelectMethod="FindAll" />
<asp:ObjectDataSource ID="odsFather" runat="server" DataObjectTypeName="Employees" TypeName="EmployeesDAO" SelectMethod="FindByID">
    <SelectParameters>
        <asp:Parameter Name="myFieldInCompanyObject" Type="String" />
    </SelectParameters>
</asp:ObjectDataSource>
<asp:ObjectDataSource ID="odsSon" runat="server" DataObjectTypeName="Person"TypeName="PersonsDAO" SelectMethod="FindByID">
    <SelectParameters>
        <asp:Parameter Name="myFieldInEmployeesObject" Type="String" />
    </SelectParameters>
</asp:ObjectDataSource> 
```

假设你有你的 Company 对象，比如

```
Company
  Field1
  Field2
  Field3
  Employees witch is List<Person>
    Field1
    Field2
    Field3
    Person  witch is List<Person>
      Field1
      Field2
      Field3 
```

您需要做的就是每个的 DAO 并返回列表或对象本身，如

```
public class CompanyDAO
{
    private List<Company> Companies
    {
        get
        {
            List<Company> companies = HttpContext.Current.Session["Companies"] as List<Company>;
            if (companies == null)
                companies = new List<Company>();
            return companies;
        }
    }
    public CompanyDAO() { }

    [DataObjectMethod(DataObjectMethodType.Select)]
    public IEnumerable<Company> FindAll()
    {
        return this.Companies;
    }

    [DataObjectMethod(DataObjectMethodType.Select)]
    public IEnumerable<Company> FindByID(String CompanyID)
    {
        return (from c in this.Companies where c.ID == CompanyID select c).ToList();
    }
} 
```

希望它有助于看到隧道尽头的曙光；）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T08:29:14.253

是的，您可以将 GridView 相互嵌套。请参阅以下文章。

[嵌套 GridView](http://www.codeguru.com/columns/vb/article.php/c12647)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T10:19:05.637

看看 Telerik，他们的 RadGrid 有这种开箱即用的东西（NestedHierarchy 和 detailtables）

[http://demos.telerik.com/aspnet-ajax/Grid/Examples/Overview/DefaultCS.aspx](http://demos.telerik.com/aspnet-ajax/Grid/Examples/Overview/DefaultCS.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T21:37:00.633

[这里](http://mosesofegypt.net/post/2008/02/Building-a-grouping-Grid-with-GridView-and-ASPNET-AJAX-toolkit-CollapsiblePanel.aspx)有很好的文章， 它使用 ASP.NET AJAX 和 AJAX 控件工具包使其可折叠。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-16T08:30:08.713

GridView 是相当静态的。如果表将变得更复杂，我们会使用 XSLT，因此我们可以最终控制它。否则，Microsoft 会提供其他 ASP.NET 控件，例如 DataRepeater。

# django - 如何使用 django 在同一页面中组合列表和表单？

> ID：449840
> 
> 赞同：0
> 
> 时间：2009-01-16T08:29:45.843
> 
> 标签：django, templates

我正在建立一个问答页面，有点类似于 stackoverflow 的页面！尝试呈现表单时遇到了一些问题。将 3 个对象粘贴到呈现页面的模板，即问题对象、与问题相关的答案和答案表单对象。

在页面的第一部分我想显示问题，然后是答案列表，然后在底部我显示我的表单以输入新答案。

在我的模板上，当我使用 {{ extends "base_site.html" }} 标签时，只有表单被渲染，当我删除该标签时，只有问题部分会减去表单！

我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T08:50:41.137

没有看到一些代码就很难回答，但我怀疑这与您使用 {{ extends }} 和继承/覆盖 {{ block }} 部分的方式有关。

我会检查您所有 {{ block }} 部分的名称，并且您正在覆盖您认为自己是的块。可能是您在继承页面中有未在基本页面中定义的块？

# visual-studio - 如何在 Visual Studio C++ (Express) 中使用 GDB 来调试我的 GCC Makefile 项目？

> ID：449849
> 
> 赞同：7
> 
> 时间：2009-01-16T08:33:01.687
> 
> 标签：visual-studio, gdb

我的 Visual Studio (express) 2005/2008（现在没关系）上有几个 Makefile 项目，用于使用 MinGW GCC 编译器编译一些应用程序。我不想使用 MS 编译器，因为有些功能只在 GCC 上可用。

现在我想从 VS 内部进行调试，因为我正在使用它进行编码，但这需要我使用 GDB（它从命令行工作）但我更喜欢使用 IDE 工具。

有没有办法做到这一点？即使 Express 版本受到限制并且不支持它，是否可以使用完整版来完成？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-02-17T16:19:02.160

[如果您更喜欢在 Windows 下工作的 IDE，您可能会对Code Blocks](http://www.codeblocks.org/)或[Qt Creator](http://qt.nokia.com/products/developer-tools)感兴趣。他们是免费的。

Unix 也有商业开发工具：[MagicC++](http://www.magicunix.com/) (IDE)，调试器如[TotalView](http://www.roguewave.com/products/totalview.aspx)、[Allinea](http://www.allinea.com/)、[Zero-bugs](http://www.zero-bugs.com/)、[UndoDB](http://undo-software.com/) ...

如果您想继续使用 Visual Studio，请检查此[WinGDB](http://www.wingdb.com)。Express 版本不支持它（根本不支持扩展）。但是微软最近发布了**免费的** [Visual Studio Community](http://www.visualstudio.com/en-us/products/visual-studio-community-vs.aspx)（几乎拥有专业版的所有功能），它是免费的，*可以被学生/爱好者/初创公司合法使用*——个人开发商业应用免费，组织开发开源应用免费，对于开发商业应用程序的组织（最多 5 个个人用户）免费，前提是组织的计算机少于 250 台并且年收入少于 1000 万美元。有关详细信息，请参阅[VS 2013 社区许可证](http://www.visualstudio.com/support/legal/dn877550/)。

顺便说一句，[VirtualBox](http://www.virtualbox.org/)可能非常有用（我非常频繁地将（Open）Solaris 或 Linux 作为 VBox 机器调试）;-)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-22T19:42:20.287

通常您不能将它与 Visual Studio Express 一起使用，因为 VS Express 不支持第三方加载项，并且只能与 Microsoft 调试器一起使用（需要来自 Microsoft 编译器的符号信息）。

但是，您可以通过安装第三方插件（例如[VisualGDB](http://visualgdb.com/) ）使 Visual Studio Professional（或更高版本）与 GDB 一起使用。

请注意，有多种免费获取 Visual Studio Professional 的方法：

1.  如果您的软件公司是一家面向产品的初创公司，您可以通过[BizSpark获得免费的 Visual Studio](http://www.microsoft.com/bizspark/)
2.  如果您是学生，您还可以通过[DreamSpark获得免费的 Visual Studio 许可证](https://www.dreamspark.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T08:37:51.863

据我所知，如果您使用 Microsoft 编译器编译了代码，则只能在 IDE 中进行调试。否则，Visual Studio 调试器不知道如何处理 GDB 调试信息。

# c++ - 为什么我们需要在 C++ 中使用 `int main` 而不是 `void main`？

> ID：449851
> 
> 赞同：42
> 
> 时间：2009-01-16T08:35:56.500
> 
> 标签：c++, function, return-value, main

为什么我们需要使用`int main`而不是`void main`在 C++ 中？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-01-16T08:40:42.107

简短的回答是因为 C++ 标准要求`main()`return `int`。

您可能知道，`main()`函数的返回值被运行时库用作进程的退出代码。Unix 和 Win32 都支持进程完成后从进程返回的（小）整数的概念。从返回值为`main()`程序员提供了一种指定该值的方法。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-16T08:40:55.243

大多数操作系统会向用户或调用进程报告应用程序是否成功。这在脚本编写中特别有用，其中脚本可以根据程序的结果有条件地分支（if-then）。类似于以下内容：

```
// pseudo-code
screenscrape  http://mydatasource.com > results.txt
if errorlevel == 0 then
   processfile results.txt
else
   echo Screen Scraping Failed!
end if 
```

这个结果状态是通过 main 的返回值来完成的。

虽然一些编译器允许 void main，但为了一致性和简单性，ANSI 标准需要一个 main 原型：

```
int main(int argc, char *argv[]); 
```

因为在 C 中，参数由调用者清理，main 的作者可以忽略声明或处理参数 argc 和 argv。但是，如果调用 main 的设置例程需要一个 int 返回值，但没有找到，则行为可能未定义。

简短的回答：

*   main 的返回值对脚本很有用。
*   调用 main 的设置和清理例程需要使用一致的接口。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2015-07-09T12:15:09.797

改变的主要原因

> 无效的主要（）{}

到

> int main() { }

在以后的版本中，用于将程序在执行期间发生的**错误通知**给运行它的**操作系统**

```
return 0; 
```

如果返回任何数字而不是 0，则识别程序成功执行，这意味着发生了一些错误，***错误代码***是 main 返回的。如果您在**代码块 IDE**上运行，请在构建日志中查看如果 main 返回 0 它通常会显示

```
Process terminated with status 0 
```

否则它会以红色显示状态代码，这意味着发生了错误

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T08:42:00.060

来自维基百科：

> 从 main 函数返回的值成为进程的退出状态，尽管 C 标准仅将特定含义赋予两个值：（`EXIT_SUCCESS`传统上为零）和`EXIT_FAILURE`. 其他可能的返回值的含义是实现定义的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T08:41:50.653

就像在 C 中一样，因为该进程会给操作系统一个退出代码。

您可以使用

```
int main (int argc, char ** argv)
{
  return (0);
} 
```

或者

```
int main (int argc, char ** argv)
{
  exit (0);
} 
```

这至少在 C89 IIRC 中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T08:41:58.940

因为 int 是程序可以返回给操作系统的返回码。

您可以查询该值以检查操作是否成功。

这在使用命令行脚本时非常有用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-16T08:42:29.063

也许是因为使用方法中的状态代码干净地退出是有意义的`main()`。在 Java 中，我们必须模拟这种使用`System.exit()`，这并不是那么优雅。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-09-17T09:26:17.103

当我们执行我们的程序来检查它是否成功运行时。因此，当它返回 0 表示它为 true 并成功运行，如果它返回 1 则它没有成功运行&这个`int`值告诉操作系统程序是否成功运行

# unit-testing - 我的用于单元测试的 ReSharper Gutter 图标未显示

> ID：449853
> 
> 赞同：9
> 
> 时间：2009-01-16T08:36:57.730
> 
> 标签：unit-testing, resharper, mbunit

我已经安装了 ReSharper 4.1 和 Gallio 3.0.5，但我没有得到用于单元测试的装订线图标。测试似乎在测试资源管理器中运行良好，但我在代码中的测试旁边没有图标。这可能是什么原因造成的？我之前安装了 MbUnit 2.4 ReSharper 插件，但现在应该卸载它。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-16T08:49:00.033

我这样做是为了让他们再次出现。也许这是一个矫枉过正。

1.  卸载 ReSharper
2.  卸载加里奥
3.  删除 %appdata%\JetBrains 文件夹
4.  安装 ReSharper
5.  启动 Visual Studio
6.  关闭 Visual Studio
7.  安装 Gallio
8.  启动 Visual Studio

我认为关键是删除 %appdata%\JetBrains 文件夹，因为那里可能有一些旧的插件文件。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2017-06-07T13:56:29.813

这里的另一个非常晚的答案，但如果您没有启用 Resharper**代码分析**，那么装订线图标将不会显示。昨天不得不帮助队友解决这个问题。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2016-11-10T13:09:44.680

也许很久以前，但如果有人偶然发现这个问题......

我对 Resharper 2016.2 有同样的问题

**Resharper -> 选项 -> 代码检查 -> 设置**

在我的情况下，包含单元测试的项目列在“要跳过的元素”下的“文件和文件夹”列表中。删除项目后，图标再次出现。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2020-03-12T02:37:34.637

使用 Visual Studio 2017，使用代码窗口右上角的代码分析图标修复了我的缺失排水沟测试图标的问题。

由于测试文件过大，分析被暂停。不得不点击恢复两次，然后图标终于重新出现。

[![在此处输入图像描述](https://i.stack.imgur.com/E3Ohy.png)](https://i.stack.imgur.com/E3Ohy.png)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-07-09T08:09:10.067

在进行全新安装时，我已经多次遇到此问题。有时，gallio-resharper 插件安装得很好，有时却没有。我尝试了上述步骤无济于事。

我找到了这个链接：[http](http://confluence.jetbrains.net/display/ReSharper/Deploying+plugin) ://confluence.jetbrains.net/display/ReSharper/Deploying+plugin 并做了以下

1.  在“C:\Program Files (x86)\JetBrains\ReSharper\v5.1\Bin\”中创建了一个插件文件夹
2.  将 GallioBundle-3.3.458.0.zip\bin\ReSharper 中的 resharper 插件文件复制到此文件夹中
3.  使用 Tools|Options|Resharper 中的按钮在 Visual Studio 10 中暂停和恢复 resharper

在此之后，插件被启用。

我正在运行 W7x64 专业版。

希望这对其他人也有帮助。:-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-01-30T20:40:19.243

暂停和恢复 Resharper 可能会起作用。它对我有用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-09-05T06:01:12.053

尝试以下步骤，它们对我有用，

*   打开 Resharper 安装程序
*   检查是否有任何项目要求修复，如果是，则单击安装。
*   现在打开 Visual Studio 并转到 resharper 选项
*   如果第一个选项是“为什么禁用点覆盖”，请单击它。
*   并通过免费试用或使用您的 resharper id 登录来启用点覆盖。
*   刷新需要几秒钟
*   您将取回那些用于运行或调试单元测试的图标。

# php - 如何动态创建带有指定编号的图像？

> ID：449858
> 
> 赞同：5
> 
> 时间：2009-01-16T08:38:56.743
> 
> 标签：php, image, image-processing, image-manipulation, gd

我有一个占位符图片，上面写着：

```
Your rating is:
   [rating here] 
```

我的 PHP 代码应该在占位符图像上有一个空白区域的地方动态插入评级数字。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-16T10:08:36.017

这是一个如何做到这一点的示例 - 使用[gd 函数](http://uk.php.net/manual/en/ref.image.php)调用来制作您的图像，但播放得很好并缓存图像。这个示例通过确保如果浏览器已经有所需的图像，它会返回一个 304 *...*

```
#here's where we'll store the cached images
$cachedir=$_SERVER['DOCUMENT_ROOT'].'/imgcache/'

#get the score and sanitize it
$score=$_GET['score'];
if (preg_match('/^[0-9]\.[0-9]{1,2}$/', $score)
{
    #figure out filename of cached file
    $file=$cachedir.'score'.$score.'gif';   

    #regenerate cached image
    if (!file_exists($file))
    {
        #generate image - this is lifted straight from the php
        #manual, you'll need to work out how to make your
        #image, but this will get you started

        #load a background image
        $im     = imagecreatefrompng("images/button1.png");

        #allocate color for the text
        $orange = imagecolorallocate($im, 220, 210, 60);

        #attempt to centralise the text  
        $px     = (imagesx($im) - 7.5 * strlen($score)) / 2;
        imagestring($im, 3, $px, 9, $score, $orange);

        #save to cache
        imagegif($im, $file);
        imagedestroy($im);
    }

    #return image to browser, but return a 304 if they already have it
    $mtime=filemtime($file);

    $headers = apache_request_headers(); 
    if (isset($headers['If-Modified-Since']) && 
        (strtotime($headers['If-Modified-Since']) >= $mtime)) 
    {
        // Client's cache IS current, so we just respond '304 Not Modified'.
        header('Last-Modified: '.gmdate('D, d M Y H:i:s', $mtime).' GMT', true, 304);
        exit;
    }

    header('Content-Type:image/gif');
    header('Content-Length: '.filesize($file));
    header('Last-Modified: '.gmdate('D, d M Y H:i:s', $mtime).' GMT');
    readfile($file);

}
else
{
    header("HTTP/1.0 401 Invalid score requested");
} 
```

如果你把它放在 image.php 中，你会在一个图像标签中使用如下

```
<img src="image.php?score=5.5" alt="5.5" /> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T10:55:40.993

使用范围从 0 到 9 的静态图像，只需将它们组合在页面上即可构建大量数字：

`Your Rating: [image1.jpg][image2.jpg][image3.jpg]`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T08:50:52.913

我知道问题是“如何动态创建带有指定数字的图像？” 但我将解决根本问题。动态图像处理对 CPU 的负担很重。只是不要这样做。当然不要在网络请求的上下文中这样做。考虑使用静态图像，然后根据评分显示正确的图像。即使您的评分系统一直达到 100，拥有 100 张静态图像也比一遍又一遍地重绘同一张图像要好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T15:05:55.837

[另请参阅http://ca3.php.net/manual/en/function.imagecopymerge.php#73477](http://ca3.php.net/manual/en/function.imagecopymerge.php#73477)上的 alpha 混合示例

您可以使用 alpha 混合创建自己的 0-9 字符作为 24 位 PNG 图像，然后使用 imagecopymerge() 将它们合成，而不是使用 imagestring() 来编写内置或 TTF 字体。这需要更多的工作，但可以让您更好地控制字符集的外观。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T15:16:09.340

为什么不将数字设置为 div 中的文本，然后使用字体和背景选择对其进行样式设置？

# c++ - 文件的拖放是如何完成的？

> ID：449872
> 
> 赞同：5
> 
> 时间：2009-01-16T08:42:01.950
> 
> 标签：c++, windows, drag-and-drop

在 winamp 或 vlc 播放器中，如何进行文件拖放？我的意思是我想知道什么样的编码进入应用程序？我想知道 C++

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-16T09:53:19.933

在 Windows 上的纯 C/C++ 中，开始阅读有关[DragAcceptFiles](http://msdn.microsoft.com/en-us/library/bb776406(VS.85).aspx) 函数和[WM_DROPFILES](http://msdn.microsoft.com/en-us/library/bb774303(VS.85).aspx)消息的信息。如果您使用的是更强大的 C++ 库（Qt、Wx 等），请查看它们各自的文档。更具体地说，这将有助于了解您使用的内容。

此外，[此讨论](https://stackoverflow.com/questions/190596/drag-and-drop-in-winapi)可能会回答您的问题。如果这是您的意思，请关闭此问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-12T03:15:10.560

与 com:

创建一个公共扩展 IDropTarget 的类

注册您的课程以获取降级。在 WM_CREATE 中执行此操作

```
RegisterDragDrop(hwnd,static_cast<IDropTarget*>(pointer_to_your_class)); 
```

在您的课程中，您需要覆盖几个函数，因为它们是纯虚拟的：

```
virtual HRESULT STDMETHODCALLTYPE DragEnter( 
        /* [unique][in] */ __RPC__in_opt IDataObject *pDataObj,
        /* [in] */ DWORD grfKeyState,
        /* [in] */ POINTL pt,
        /* [out][in] */ __RPC__inout DWORD *pdwEffect) = 0;

virtual HRESULT STDMETHODCALLTYPE DragOver( 
    /* [in] */ DWORD grfKeyState,
    /* [in] */ POINTL pt,
    /* [out][in] */ __RPC__inout DWORD *pdwEffect) = 0;

virtual HRESULT STDMETHODCALLTYPE DragLeave( void) = 0;

virtual HRESULT STDMETHODCALLTYPE Drop( 
    /* [unique][in] */ __RPC__in_opt IDataObject *pDataObj,
    /* [in] */ DWORD grfKeyState,
    /* [in] */ POINTL pt,
    /* [out][in] */ __RPC__inout DWORD *pdwEffect) = 0; 
```

当这些事件发生时，这些函数中的每一个都会被调用，即当有人在你的窗口中传递鼠标时，你的类上的文件 DragEnter 将被调用。

您还需要实现 IDropTarget 扩展的更多功能，请查看 MSDN 中的 IUnknown。

然后你需要查询 IDataObject 参数来获取数据：

```
FORMATETC fdrop = {CF_HDROP, 0, DVASPECT_CONTENT, -1, TYMED_HGLOBAL};

if (SUCCEEDED(pDataObj->QueryGetData(&fdrop)) ){
    STGMEDIUM stgMedium = {0};
    stgMedium.tymed = TYMED_HGLOBAL;
    HRESULT hr = pDataObj->GetData(&fdrop, &stgMedium);
    if (SUCCEEDED(hr))
    {
        HGLOBAL gmem = stgMedium.hGlobal;
        HDROP hdrop = (HDROP)GlobalLock(gmem);
        UINT numOfFiles =  DragQueryFile( (HDROP) hdrop,
                            0xFFFFFFFF,
                           NULL,
                            0
                        );

        TCHAR buffer[MAX_PATH];
        for( int i=0;i<numOfFiles;i++ ){
            UINT charsCopied = DragQueryFile( (HDROP) hdrop,
                            i,
                           buffer,
                            MAX_PATH
                        );
            MessageBox(NULL,buffer,_T("Archivos a copiar: "),MB_OK);

        }
        // use str
        GlobalUnlock(gmem);

        /*TCHAR* str = (TCHAR*)GlobalLock(gmem);
        // use str
        GlobalUnlock(gmem);*/
        ::ReleaseStgMedium(&stgMedium);
    }

} 
```

干杯!

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T08:44:59.167

***在我发布这个之后进行***编辑**，这个问题被编辑为符合 C++ 的条件；我将把这个答案留在这里仅供参考。**

 *** * *

“什么样的编码进入应用程序”：

这在很大程度上取决于平台和语言。例如，这里是通过[C#/.NET](http://support.microsoft.com/kb/307966/)或[VB/.NET](http://support.microsoft.com/kb/306969)的 Windows 示例。对于 C++、Delphi 等 - 技巧会有所不同。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T15:36:14.980

您应该使用 COM 的 Ole 拖放界面。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-17T12:31:46.443

在 OLE/COM/ActiveX 出现之前，我们会做如下的事情：

*   如果我们收到鼠标按下事件，请记下光标位置。
*   如果我们收到鼠标移动并且它从原始点移动了一定距离，那么我们将开始拖动操作。构建一个代表您正在拖动的对象的光标（从原始光标位置确定）。
*   当我们收到鼠标按下时：如果拖动从未开始，那么它是单击，否则使用放置位置来确定如何处理对象。

注意：这些都不允许您在应用程序之间拖动对象，仅在单个应用程序内。

# database - 是否可以增加 Oracle 数据库的最大列来存储巨大的数组？

> ID：449882
> 
> 赞同：0
> 
> 时间：2009-01-16T08:49:29.000
> 
> 标签：database, oracle, arrays

由于我无法控制的原因，我需要在数据库行中存储巨大的数组（10000+ 个条目），并且必须易于单独访问数组的每个索引，这意味着我宁愿避免序列化/blob，如果在一切皆有可能。

所以我的第一个想法，以及这里的实际问题是，无论如何我可以增加 Oracle 的最大列数吗？

或者有没有一种简单的方法可以说将数组存储在几行中并将实现隐藏在表面之下（我在这里考虑存储过程）。

也欢迎任何其他建议！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T09:02:55.620

最大列数是数据库引擎的约束。所以那里没有运气。

我不知道您的数据库将包含多少行，但它可能是使用存储三个字段的表的解决方案：ArrayId、FieldIndex、Contents。每个数组字段都是数据库中的一行。如果您在 ArrayId 和 FieldIndex 上放置一个组合索引，访问应该非常快。

该解决方案还允许使用可变长度数组。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T09:00:40.790

不确定增加最大列数。但是，为什么不将其拆分为多个表，每个表共享相同的唯一 ID。此实现将比将其存储在多行中更容易。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T10:14:21.310

为什么不将数组存储为 Blob？

任何人都不太可能在 SQL 中编写“Where Acol999 = 42 or Acol1000 = 42 ...”，因此如果您只想存储和检索而不是将其存储为 Big Clob 或 Blob，具体取决于您的数据。

这将快得多 qnd 涉及更少的代码。

如果你真的想查询内容，那么你真的需要一个单独的表，每个数组单元格有 1 - ONE - 行。然后，您将能够明智地对此进行查询。

```
创建表 ARRAY_CELLS (
     PARENT_ID INT NOT NULL，
     INDEXNUM INT NOT NULL，
     VALUEOF LONG NOT NULL
    主键（PARENT_ID，INDEXNUM）
);

```

然后，您可以运行以下查询：-

```
从 TABLE_ARRAY_CELLS 中选择 PARENT_ID，其中 VALUEOF = 42 GROUP BY PARENT_ID；

```

这将为您提供包含值 42 的所有数组的列表。

# c# - 在哪里可以找到 Paint.NET 多线程白皮书？

> ID：449883
> 
> 赞同：2
> 
> 时间：2009-01-16T08:50:25.600
> 
> 标签：c#, multithreading, multicore, article

就像我在[其他地方](https://stackoverflow.com/questions/449760/dividing-workload-on-several-threads#449839)写的一样，我似乎确信 Rick Brewster 的一篇关于 [Paint.NET](http://www.getpaint.net/)中使用的多线程的白皮书曾经存在过。但是，我无法再次找到对本白皮书的任何参考。它（仍然）存在吗？如果是这样，在哪里？

**编辑：**在对一个无关问题的评论中发现 Paint.NET 仍然免费，但代码不再可用？这是否与我似乎再也找不到那份白皮书的事实有关？

**EDIT2：对此** [直奔马口](http://paintdotnet.forumer.com/viewtopic.php?f=27&t=28502)，并将返回我在这里得到的任何答案。与此同时，你们可能有的任何答案都非常受欢迎！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T09:41:03.140

您是否有可能在Rick Brewster 的博客上的[Coding Horror](http://www.codinghorror.com/blog/archives/000169.html)链接之后找到此白皮书？似乎他已经清理了他的博客，并且在 2006 年之前没有任何条目了。

我能找到的关于 Paint.Net 中线程的唯一“很少”解释是在[CodeProject](http://www.codeproject.com/KB/graphics/pdnnoiseeffect.aspx)上。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-11T19:36:31.143

检查单色（用于 linux 的paint.net 端口）。它的源代码可在谷歌代码上找到

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T18:05:08.377

[我刚刚在Paint.NET 论坛](http://paintdotnet.forumer.com)上收到了[Rick Brewster](http://paintdotnet.forumer.com/memberlist.php?mode=viewprofile&u=3)的私信回复：

> 从来没有这样的白皮书存在过。

这至少可以解释为什么在谷歌上似乎没有它的踪迹。毕竟我一定要疯了？

# design-patterns - 是否存在单例是最佳选择的情况？

> ID：449885
> 
> 赞同：2
> 
> 时间：2009-01-16T08:50:41.293
> 
> 标签：design-patterns, oop, singleton

这个网站上有很多关于为什么应该避免单例的讨论，但是在任何情况下单例是有意义的并且是最好的选择吗？

我认为单例是最佳选择的一个例子是在实现[身份映射](http://en.wikipedia.org/wiki/Identity_map)时，您需要跟踪已经从映射层中的数据库加载的所有模型。在这种情况下，重要的是映射实际上是全局的，以便所有客户端代码使用映射的相同实例并且它们都访问相同的加载模型列表。最简单的解决方案似乎是将类实现为单例（或静态方法）。这是最好的方法还是有其他方法？

是否还有其他情况可以使用单例，或者它们*总是*不好？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T09:02:23.420

看到[这个线程](https://stackoverflow.com/questions/11831/singletons-good-design-or-a-crutch)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T22:15:14.073

单例确实有它们的用途。我将它们的用处总结为：

“Singleton 应该用于表示对象，根据基本设计或要求，最多可以有一个实例；并且存在与该对象相关联的数据或资源，这会产生可衡量的成本。” 这就是我的意思。

1）你不应该在有很多东西的情况下使用单例，但我们只是碰巧对一个感兴趣。如果可以想象系统中有两个，则显式实例化一个。

2) Singleton 的许多用途可以被具有所有静态方法和数据的类替换。如果您可以在不影响性能的情况下执行此操作，请执行此操作。

3) 如果设置对象的成本很高，则应该考虑使用 Singleton：例如，如果它是需要初始化的物理资源，或者它依赖于需要初始化的某些查找表。如果是这种情况，使用 Singleton 您可以将初始化成本推迟到第一次使用该对象，而静态类通常会在应用程序启动时进行初始化。如果从未使用过该对象，则您永远不会支付初始化成本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T22:49:45.777

**当您只需要一个实例**并希望通过设计强制执行时，应该使用单例。**不应使用**它，因为它会导致全局副作用。

就您而言，我认为这是有道理的，因为您只想限制该类的一个实例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T08:54:03.250

在不允许静态接口成员的语言中使用单例（和类似的） - 例如在 .NET 中。通过提供单例，您就有了一个可以将接口作为实例提供的实例。因此，在 .NET 中，示例可能是：

*   `Comparer<T>.Default`- 提供`IComparer<T>`排序的实现`T`
*   `EqualityComparer<T>.Default`- 提供`IEqualityComparer<T>`哈希/相等测试的实现`T`

这是达到目的的手段；这不是我们想要做的，只是一个合理的“如何”。

就“身份映射”示例而言，我个人宁愿将其保留在一个实例上，并使该实例可用于我的所有代码。除此之外，如果您可以丢弃测试之间的映射，或者具有灵活性（稍后）同时拥有多个身份映射，它有助于可测试性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T08:55:48.817

考虑一下您希望将应用程序中的不同事件记录到单个文件的情况。在这种情况下，单例类 Log 将很有用。由于应用程序的不同部分将访问 Log 类的同一个实例。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T09:18:17.057

单例确实有其用途。他们也有自己的弊端，有很多理由不喜欢他们，或者为什么他们让测试变得困难。

这是对 Singleton 模式的一个小小的辩护。

有时，程序需要代表真正独特的事物或与之交互。一个例子是物理资源。例如，您不能拥有多个“标准输出”。以及 OS 进程的表示（例如 J2ME 的 Midlet）。

单例就像使用类/接口来提供封装和这样的好处，否则将是一个裸露的全局变量是值得的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-16T09:45:19.293

当您使用 Web 编程时，单例是有意义的：您通常只需要每个请求的页面输出类的一个实例，以及它的一个用户对象。但是，数据库是不同的——实现权限分离是想要多个 db 对象的一个​​很好的理由。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-16T10:13:11.890

我个人的指导方针是，如果您之后可以实例化一个类的一个对象，则永远不要将一个类硬编码为单例。这使得单例在应用程序代码中非常罕见并且通常是不必要的。在使用像 Spring 这样的 DI 框架时尤其如此。

单例在框架中确实可以用作“入口点”，但规则是将它们用作“根单例”（在依赖层次结构的开头），并让其余代码尽可能少地依赖该单例可能的。

# c# - 使用 C# 发送电子邮件

> ID：449887
> 
> 赞同：55
> 
> 时间：2009-01-16T08:52:09.090
> 
> 标签：c#, email

我需要通过我的 C# 应用程序发送电子邮件。

我来自 VB 6 背景，对 MAPI 控件有很多不好的体验。首先，MAPI 不支持 HTML 电子邮件，其次，所有电子邮件都发送到我的默认邮件发件箱。所以我仍然需要点击发送接收。

如果我需要发送批量 html 正文电子邮件（100 - 200），那么在 C# 中执行此操作的最佳方法是什么？

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2009-01-16T08:56:48.940

您可以使用 .NET 框架的**System.Net.Mail.MailMessage**类。

您可以在[此处找到 MSDN 文档](http://msdn.microsoft.com/en-us/library/system.net.mail.mailmessage(VS.80).aspx)。

这是一个简单的例子（代码片段）：

```
using System.Net;
using System.Net.Mail;
using System.Net.Mime;

...
try
{

   SmtpClient mySmtpClient = new SmtpClient("my.smtp.exampleserver.net");

    // set smtp-client with basicAuthentication
    mySmtpClient.UseDefaultCredentials = false;
   System.Net.NetworkCredential basicAuthenticationInfo = new
      System.Net.NetworkCredential("username", "password");
   mySmtpClient.Credentials = basicAuthenticationInfo;

   // add from,to mailaddresses
   MailAddress from = new MailAddress("test@example.com", "TestFromName");
   MailAddress to = new MailAddress("test2@example.com", "TestToName");
   MailMessage myMail = new System.Net.Mail.MailMessage(from, to);

   // add ReplyTo
   MailAddress replyTo = new MailAddress("reply@example.com");
   myMail.ReplyToList.Add(replyTo);

   // set subject and encoding
   myMail.Subject = "Test message";
   myMail.SubjectEncoding = System.Text.Encoding.UTF8;

   // set body-message and encoding
   myMail.Body = "<b>Test Mail</b><br>using <b>HTML</b>.";
   myMail.BodyEncoding = System.Text.Encoding.UTF8;
   // text or html
   myMail.IsBodyHtml = true;

   mySmtpClient.Send(myMail);
}

catch (SmtpException ex)
{
  throw new ApplicationException
    ("SmtpException has occured: " + ex.Message);
}
catch (Exception ex)
{
   throw ex;
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-11-06T12:08:02.540

为了更快地发送批量电子邮件，最好的方法是使用线程。我已经编写了这个用于发送批量电子邮件的控制台应用程序。我通过创建两个线程池将批量电子邮件 ID 分成两批。

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Threading;
using System.Net.Mail;

namespace ConsoleApplication1
{
    public class SendMail 
    {
        string[] NameArray = new string[10] { "Recipient 1", 
                                              "Recipient 2",
                                              "Recipient 3",
                                              "Recipient 4", 
                                              "Recipient 5", 
                                              "Recipient 6", 
                                              "Recipient 7", 
                                              "Recipient 8",
                                              "Recipient 9",
                                              "Recipient 10"
                                            };        

        public SendMail(int i, ManualResetEvent doneEvent)
        {
            Console.WriteLine("Started sending mail process for {0} - ", NameArray[i].ToString() + " at " + System.DateTime.Now.ToString());
            Console.WriteLine("");
            SmtpClient mailClient = new SmtpClient();
            mailClient.Host = Your host name;
            mailClient.UseDefaultCredentials = true;
            mailClient.Port = Your mail server port number; // try with default port no.25

            MailMessage mailMessage = new MailMessage(FromAddress,ToAddress);//replace the address value
            mailMessage.Subject = "Testing Bulk mail application";
            mailMessage.Body = NameArray[i].ToString();
            mailMessage.IsBodyHtml = true;
            mailClient.Send(mailMessage);
            Console.WriteLine("Mail Sent succesfully for {0} - ",NameArray[i].ToString() + " at " + System.DateTime.Now.ToString());
            Console.WriteLine("");

            _doneEvent = doneEvent;
        }

        public void ThreadPoolCallback(Object threadContext)
        {
            int threadIndex = (int)threadContext;
            Console.WriteLine("Thread process completed for {0} ...",threadIndex.ToString() + "at" +  System.DateTime.Now.ToString());
            _doneEvent.Set();
        }      

        private ManualResetEvent _doneEvent;
    }

    public class Program
    {
        static int TotalMailCount, Mailcount, AddCount, Counter, i, AssignI;  
        static void Main(string[] args)
        {
            TotalMailCount = 10;
            Mailcount = TotalMailCount / 2;
            AddCount = Mailcount;
            InitiateThreads();                     

            Thread.Sleep(100000);
        }

       static void InitiateThreads()
       {
            //One event is used for sending mails for each person email id as batch
           ManualResetEvent[] doneEvents = new ManualResetEvent[Mailcount];

            // Configure and launch threads using ThreadPool:
            Console.WriteLine("Launching thread Pool tasks...");

            for (i = AssignI; i < Mailcount; i++)            
            {
                doneEvents[i] = new ManualResetEvent(false);
                SendMail SRM_mail = new SendMail(i, doneEvents[i]);
                ThreadPool.QueueUserWorkItem(SRM_mail.ThreadPoolCallback, i);
            }

            Thread.Sleep(10000);

            // Wait for all threads in pool to calculation...
            //try
            //{
            // //   WaitHandle.WaitAll(doneEvents);
            //}
            //catch(Exception e)
            //{
            //    Console.WriteLine(e.ToString());   
            //}

            Console.WriteLine("All mails are sent in this thread pool.");
            Counter = Counter+1;
            Console.WriteLine("Please wait while we check for the next thread pool queue");
            Thread.Sleep(5000);
            CheckBatchMailProcess();            
        }

        static  void CheckBatchMailProcess()
        {

            if (Counter < 2)
            {
                Mailcount = Mailcount + AddCount;
                AssignI = Mailcount - AddCount;
                Console.WriteLine("Starting the Next thread Pool");

                Thread.Sleep(5000);
                InitiateThreads();
            }

            else
            {
                Console.WriteLine("No thread pools to start - exiting the batch mail application");
                Thread.Sleep(1000);
                Environment.Exit(0);
            }
        }
    }   
} 
```

我在一个示例的数组列表中定义了 10 个收件人。它将创建两批电子邮件以创建两个线程池来发送邮件。您也可以从数据库中选择详细信息。

您可以通过将其复制并粘贴到控制台应用程序中来使用此代码。（替换 program.cs 文件）。然后该应用程序就可以使用了。

我希望这可以帮助你 ：）。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-03-03T16:46:26.443

**代码：**

```
using System.Net.Mail

new SmtpClient("smtp.server.com", 25).send("from@email.com", 
                                           "to@email.com", 
                                           "subject", 
                                           "body"); 
```

**群发邮件：**

SMTP 服务器通常对一次可以处理的连接数有限制，如果您尝试发送数百封电子邮件，您的应用程序可能会出现无响应。

**解决方案：**

*   如果您正在构建 WinForm，则使用 BackgroundWorker 来处理队列。
*   如果您使用的是 IIS SMTP 服务器或具有发件箱文件夹的 SMTP 服务器，则可以使用 SmtpClient().PickupDirectoryLocation = "c:/smtp/outboxFolder"; 这将使您的系统保持响应。
*   如果您没有使用本地 SMTP 服务器，那么您可以构建一个系统服务来使用 Filewatcher 来监控一个转发器，然后处理您放入的任何电子邮件。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-16T08:56:02.030

.NET 框架有一些内置类，允许您通过应用程序发送电子邮件。

您应该查看 System.Net.Mail 命名空间，您将在其中找到 MailMessage 和 SmtpClient 类。您可以将 MailMessage 类的 BodyFormat 设置为 MailFormat.Html。

如果您使用 MailMessage 类的 AlternateViews 属性也可能会有所帮助，这样您就可以提供邮件的纯文本版本，以便不支持 HTML 的客户端可以读取它。

[http://msdn.microsoft.com/en-us/library/system.net.mail.mailmessage.alternateviews.aspx](http://msdn.microsoft.com/en-us/library/system.net.mail.mailmessage.alternateviews.aspx)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-01-20T07:25:21.693

您可以使用 SMTP 或 CDO 发送电子邮件

**使用 SMTP：**

```
mail.From = new MailAddress("your_email_address@gmail.com");
mail.To.Add("to_address");
mail.Subject = "Test Mail";
mail.Body = "This is for testing SMTP mail from GMAIL";

SmtpServer.Port = 587;
SmtpServer.Credentials = new System.Net.NetworkCredential("username", "password");
SmtpServer.EnableSsl = true; 
```

**使用 CDO**

```
CDO.Message oMsg = new CDO.Message();
CDO.IConfiguration iConfg;
iConfg = oMsg.Configuration;
ADODB.Fields oFields;
oFields = iConfg.Fields;
ADODB.Field oField = oFields["http://schemas.microsoft.com/cdo/configuration/sendusing"];
oFields.Update();
oMsg.Subject = "Test CDO";
oMsg.From = "from_address";
oMsg.To = "to_address";
oMsg.TextBody = "CDO Mail test";
oMsg.Send(); 
```

来源：[C# SMTP 电子邮件](http://csharp.net-informations.com/communications/csharp-smtp-mail.htm)

来源：[C# CDO 电子邮件](http://csharp.net-informations.com/communications/csharp-cdo-email.htm)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-10T12:43:45.127

我强烈推荐 aspNetEmail 库：[http ://www.aspnetemail.com/](http://www.aspnetemail.com/)

如果您的需求只是基本的`System.Net.Mail`，它将带您到某个地方，但如果您遇到麻烦，请查看 aspNetEmail。它为我节省了很多时间，而且我知道其他开发者也对它发誓！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-16T09:00:34.517

使用命名空间 System.Net.Mail。 [这是 MSDN 页面的链接](http://msdn.microsoft.com/en-us/library/system.net.mail.mailmessage(VS.80).aspx)

您可以使用 SmtpClient 类发送电子邮件。

我解释了代码示例，因此请查看 MSDN 了解详细信息。

```
MailMessage message = new MailMessage(
   "fromemail@contoso.com",
   "toemail@contoso.com",
   "Subject goes here",
   "Body goes here");

SmtpClient client = new SmtpClient(server);
client.Send(message); 
```

发送许多电子邮件的最佳方法是将这样的内容放入 forloop 并发送出去！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-02-23T20:32:48.750

查看 FluentEmail 库。我在[这里写过博客](http://dennis-nerush.blogspot.co.il/2013/09/sending-email-from-your-app.html)

你有一个很好的流利的 api 来满足你的需要：

```
Email.FromDefault()
 .To("you@domain.com")
 .Subject("New order has arrived!")
 .Body("The order details are…")  
 .Send(); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-07-19T12:15:16.573

让我们做一个完整的解决方案:)。也许它也可以提供帮助。它是一种将一个电子邮件内容和一个附件（或不带附件）发送到多个电子邮件地址的解决方案。当然也可以只发送一封电子邮件。结果是列表对象，其中包含数据什么是好的，什么不是。

```
namespace SmtpSendingEmialMessage
{ 
    public class EmailSetupData
    {
        public string EmailFrom { get; set; }
        public string EmailUserName { get; set; }
        public string EmailPassword { get; set; }
        public string EmailSmtpServerName { get; set; }
        public int EmailSmtpPortNumber { get; set; }
        public Boolean SSLActive { get; set; } = false;
    }

    public class SendingResultData
    {
        public string SendingEmailAddress { get; set; }
        public string SendingEmailSubject { get; set; }
        public DateTime SendingDateTime { get; set; }
        public Boolean SendingEmailSuccess { get; set; }
        public string SendingEmailMessage { get; set; }
    }
    public class OneRecData
    {
        public string RecEmailAddress { get; set; } = "";
        public string RecEmailSubject { get; set; } = "";
    }

    public class SendingProcess
    {
        public string EmailCommonSubjectOptional { get; set; } = "";
        private EmailSetupData EmailSetupParam { get; set; }
        private List<OneRecData> RecDataList { get; set; }
        private string EmailBodyContent { get; set; }
        private Boolean IsEmailBodyHtml { get; set; }
        private string EmailAttachFilePath { get; set; }

        public SendingProcess(List<OneRecData> MyRecDataList, String MyEmailTextContent, String MyEmailAttachFilePath, EmailSetupData MyEmailSetupParam, Boolean EmailBodyHtml)
        {
            RecDataList = MyRecDataList;
            EmailBodyContent = MyEmailTextContent;
            EmailAttachFilePath = MyEmailAttachFilePath;
            EmailSetupParam = MyEmailSetupParam;
            IsEmailBodyHtml = EmailBodyHtml;
        }

        public List<SendingResultData> SendAll()
        {
            List<SendingResultData> MyResList = new List<SendingResultData>();
            foreach (var js in RecDataList)
            {
                using (System.Net.Mail.MailMessage MyMes = new System.Net.Mail.MailMessage())
                {
                    DateTime SadaJe = DateTime.Now;
                    Boolean IsOK = true;
                    String MySendingResultMessage = "Sending OK";

                    String MessageSubject = EmailCommonSubjectOptional;
                    if (MessageSubject == "")
                    {
                        MessageSubject = js.RecEmailSubject;
                    }

                    try
                    {

                        System.Net.Mail.MailAddress MySenderAdd = new System.Net.Mail.MailAddress(js.RecEmailAddress);
                        MyMes.To.Add(MySenderAdd);
                        MyMes.Subject = MessageSubject;
                        MyMes.Body = EmailBodyContent;
                        MyMes.Sender = new System.Net.Mail.MailAddress(EmailSetupParam.EmailFrom);
                        MyMes.ReplyToList.Add(MySenderAdd);
                        MyMes.IsBodyHtml = IsEmailBodyHtml;

                    }
                    catch(Exception ex)
                    {
                        IsOK = false;
                        MySendingResultMessage ="Sender or receiver Email address error." +  ex.Message;
                    }

                    if (IsOK == true)
                    {
                        try
                        {
                            if (EmailAttachFilePath != null)
                            {
                                if (EmailAttachFilePath.Length > 5)
                                {
                                    MyMes.Attachments.Add(new System.Net.Mail.Attachment(EmailAttachFilePath));
                                }
                            }
                        }
                        catch (Exception ex)
                        {
                            IsOK = false;
                            MySendingResultMessage ="Emial attach error. " +  ex.Message;
                        }

                        if (IsOK == true)
                        {
                            using (System.Net.Mail.SmtpClient MyCl = new System.Net.Mail.SmtpClient())
                            {
                                MyCl.EnableSsl = EmailSetupParam.SSLActive;
                                MyCl.Host = EmailSetupParam.EmailSmtpServerName;
                                MyCl.Port = EmailSetupParam.EmailSmtpPortNumber;
                                try
                                {
                                    MyCl.Credentials = new System.Net.NetworkCredential(EmailSetupParam.EmailUserName, EmailSetupParam.EmailPassword);
                                }
                                catch (Exception ex)
                                {
                                    IsOK = false;
                                    MySendingResultMessage = "Emial credential error. " + ex.Message;
                                }

                                if (IsOK == true)
                                {
                                    try
                                    {
                                        MyCl.Send(MyMes);
                                    }
                                    catch (Exception ex)
                                    {
                                        IsOK = false;
                                        MySendingResultMessage = "Emial sending error. " + ex.Message;
                                    }
                                }
                            }
                        }
                    }

                    MyResList.Add(new SendingResultData
                    {
                            SendingDateTime = SadaJe,
                            SendingEmailAddress = js.RecEmailAddress,
                            SendingEmailMessage = MySendingResultMessage,
                            SendingEmailSubject = js.RecEmailSubject,
                            SendingEmailSuccess = IsOK
                    });
                }

            }
            return MyResList;
        }
    }

} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-08-04T10:59:51.340

您可以使用**Mailkit**。MailKit 是一个开源跨平台 .NET 邮件客户端库，它基于 MimeKit 并针对移动设备进行了优化。

它比*System.Net.Mail具有更多和更好的高级功能*

*   一个完全可取消的 Pop3Client，支持 STLS、UIDL、APOP、PIPELINING、UTF8 和 LANG。消息的客户端排序和线程（支持 Ordinal Subject 和 Jamie Zawinski 线程算法）。
*   访问网络的所有方法的异步版本。
*   通过 MimeKit 支持 S/MIME、OpenPGP 和 DKIM 签名。
*   通过 MimeKit 支持 Microsoft TNEF。

看到这个例子你可以发送邮件

```
 MimeMessage mailMessage = new MimeMessage();
            mailMessage.From.Add(new MailboxAddress(senderName, sender@address.com));
            mailMessage.Sender = new MailboxAddress(senderName, sender@address.com);
            mailMessage.To.Add(new MailboxAddress(emailid, emailid));
            mailMessage.Subject = subject;
            mailMessage.ReplyTo.Add(new MailboxAddress(replyToAddress));
            mailMessage.Subject = subject;
            var builder = new BodyBuilder();
            builder.TextBody = "Hello There";            
            try
            {
                using (var smtpClient = new SmtpClient())
                {
                    smtpClient.Connect("HostName", "Port", MailKit.Security.SecureSocketOptions.None);
                    smtpClient.Authenticate("user@name.com", "password");

                    smtpClient.Send(mailMessage);
                    Console.WriteLine("Success");
                }
            }
            catch (SmtpCommandException ex)
            {
                Console.WriteLine(ex.ToString());              
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.ToString());                
            } 
```

你可以从[这里](https://www.nuget.org/packages/MailKit/)下载。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-06-15T15:08:35.467

下面附加的解决方案在本地机器和服务器上工作。

```
 public static string SendMail(string bodyContent)
    {
        string sendMail = "";
        try
        {

            string fromEmail = "from@gmail.com";
            MailMessage mailMessage = new MailMessage(fromEmail, "to@gmail.com", "Subject", body);
            mailMessage.IsBodyHtml = true;
            SmtpClient smtpClient = new SmtpClient("smtp.gmail.com", 587);
            smtpClient.EnableSsl = true;
            smtpClient.UseDefaultCredentials = false;
            smtpClient.Credentials = new NetworkCredential(fromEmail, frompassword);
            smtpClient.Send(mailMessage);
        }
        catch (Exception ex)
        {
            sendMail = ex.Message.ToString();
            Console.WriteLine(ex.ToString());
        }
        return sendMail;
    } 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-08-05T08:46:21.290

```
 public string sendEmail(string mail,string subject, string body)
   {
       try
       {
           MailMessage message = new MailMessage();
           SmtpClient smtp = new SmtpClient();
           message.From = new MailAddress("example@gmail.com");
           message.To.Add(new MailAddress(mail));
           message.Subject = subject;
           message.IsBodyHtml = true; //to make message body as html  
           message.Body = body;
           smtp.Port = 587;
           smtp.Host = "smtp.gmail.com"; //for gmail host  
           smtp.EnableSsl = true;
           smtp.UseDefaultCredentials = false;
           smtp.Credentials = new NetworkCredential("example@gmail.com", "password");
           smtp.DeliveryMethod = SmtpDeliveryMethod.Network;
           smtp.Send(message);
           return "success";
       }
       catch (Exception e) {
           return e.Message;
       }
   }‏ 
```

# asp.net-mvc - MVC 视图问题

> ID：449894
> 
> 赞同：4
> 
> 时间：2009-01-16T08:56:03.357
> 
> 标签：asp.net-mvc, iis-7

我有一个 mvc 应用程序在 windows vista 上的 IIS 7.0 上运行。应用程序正在重定向到正确的控制器和操作。但是当视图存在于特定路径时，我收到一条错误消息，指出路径中未找到视图。

路线如下图。

routes.MapRoute("Default", // 路由名称

"home/{action}/{id}", // 带参数的 URL

new { controller = "Home", action = "Index", id = "" } // 参数约束 );

我收到错误，因为视图“索引”无法位于以下路径：~/Views/Home/Index.aspx、~/Views/Home/Index.ascx、~/Views/Shared/Index.aspx、~ /Views/Shared/Index.ascx 当我运行 mvc 应用程序[http://localhost/mvcsf/Home/](http://localhost/mvcsf/Home/)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-02T20:11:21.093

我不得不重新配置 IIS 来处理 MVC 应用程序。也检查一下：

[IIS v6.0 上的 MVC 配置](http://haacked.com/archive/2008/11/26/asp.net-mvc-on-iis-6-walkthrough.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T09:55:01.350

视图的选择由控制器定义。Home 控制器对 Index 操作做了什么？如果这是系统生成的原版站点，那么它期望通过控制器的操作（如下）找到“~/Views/Home/Index.aspx”。那么：这个索引页面存在吗？

```
 public ActionResult Index()
    {
        ViewData["Title"] = "Home Page";
        ViewData["Message"] = "Welcome to ASP.NET MVC!";

        return View();
    } 
```

（默认视图具有模式 {controller}/{action}；您可以通过重载 on 指定其他视图`View(...)`）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T15:58:34.887

尝试这样的事情，它似乎在于 IIS 7 附带的 Windows 功能：

[http://blogs.dovetailsoftware.com/blogs/kmiller/archive/2008/10/07/deploying-an-asp-net-mvc-web-application-to-iis7.aspx](http://blogs.dovetailsoftware.com/blogs/kmiller/archive/2008/10/07/deploying-an-asp-net-mvc-web-application-to-iis7.aspx)

# php - 我可以在不回复的情况下“放弃”一个 PHP 请求吗？

> ID：449895
> 
> 赞同：4
> 
> 时间：2009-01-16T08:56:17.507
> 
> 标签：php, http

我不完全确定这是否可以从 PHP 甚至是 HTTP 协议的深度中实现。是否可以在请求时接收 PHP 脚本以运行但脚本会断开连接？不回复？

希望我的问题是有道理的。

（我正在使用 Apache）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T11:55:29.963

当你通过 Apache 服务 php 时，总会有一个 http 响应。调用 exit 只会停止 php 的处理——而不是停止 Apache。在您的情况下，正确的做法可能是发送 200 以外的 http 响应代码（OK）。例如 404 或 500。检查[规格](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)以找到适用于您情况的规格。

你从 php 中发送一个 http 响应，使用：

```
<?php
  header("HTTP/1.0 404 Not Found");
  exit; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T09:01:48.540

您可以在脚本中使用[`exit()`](http://php.net/exit)或`die()`来停止脚本执行，那会做您想要的吗？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-16T09:54:54.487

如果您根本不想发送任何数据*，*请在循环中使用睡眠。最终客户端将超时并关闭连接。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T09:03:36.070

你为什么想做这个？当然，您应该发送某种 HTTP 错误代码吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-16T09:43:09.860

这取决于您使用的软件。例如，一旦连接关闭，Apache 就会终止任何脚本。

# c# - 通过 C# 应用程序与 Web 通信？

> ID：449910
> 
> 赞同：2
> 
> 时间：2009-01-16T09:03:37.880
> 
> 标签：c#, web-services

虽然我可以掌握 .Net 框架和 Windows 应用程序的概念，但我想创建一个应用程序，让我模拟网站点击并从该页面获取数据/响应时间。我还没有任何网络经验，因为我只是一个大三学生，有人可以向我解释（用英语！！）基本概念或示例，可以帮助我与网站交流的不同方式和课程吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-16T09:38:46.530

你想让我做什么？

发送请求并获取字符串中的响应以便处理？

[HttpWebRequest](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.aspx)和[HttpWebResponse](http://msdn.microsoft.com/en-us/library/system.net.httpwebresponse.aspx)将起作用

如果您需要通过 TCP/IP、FTP 或 HTTP 以外的方式进行连接，那么您需要使用更通用的方法

[WebRequest](http://msdn.microsoft.com/en-us/library/system.net.webrequest.aspx)和[WebResponse](http://msdn.microsoft.com/en-us/library/system.net.webresponse.aspx)

以上 4 种方法都在 System.Net 命名空间中

如果您想在 Web 端构建一个可以使用的服务，那么今天在 .NET 中请选择并使用[WCF（RESTfull 样式）](http://channel9.msdn.com/pdc2008/TL35/)。

希望它可以帮助您找到自己的方式:)

作为使用 HttpWebRequest 和 HttpWebResponse 的示例，也许一些代码会帮助您更好地理解。

**案例：**向 URL 发送响应并获取响应，这就像在 URL 中单击并获取单击后将出现的所有 HTML 代码：

```
private void btnSendRequest_Click(object sender, EventArgs e)
{
    textBox1.Text = "";
    try
    {
        String queryString = "user=myUser&pwd=myPassword&tel=+123456798&msg=My message";
        byte[] requestByte = Encoding.Default.GetBytes(queryString);

        // build our request
        WebRequest webRequest = WebRequest.Create("http://www.sendFreeSMS.com/");
        webRequest.Method = "POST";
        webRequest.ContentType = "application/xml";
        webRequest.ContentLength = requestByte.Length;

        // create our stram to send
        Stream webDataStream = webRequest.GetRequestStream();
        webDataStream.Write(requestByte, 0, requestByte.Length);

        // get the response from our stream
        WebResponse webResponse = webRequest.GetResponse();
        webDataStream = webResponse.GetResponseStream();

        // convert the result into a String
        StreamReader webResponseSReader = new StreamReader(webDataStream);
        String responseFromServer = webResponseSReader.ReadToEnd().Replace("\n", "").Replace("\t", "");

        // close everything
        webResponseSReader.Close();
        webResponse.Close();
        webDataStream.Close();

        // You now have the HTML in the responseFromServer variable, use it :)
        textBox1.Text = responseFromServer;
    }
    catch (Exception ex)
    {
        textBox1.Text = ex.Message;
    }
} 
```

该代码不起作用，因为 URL 是虚构的，但您明白了。:)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-16T09:09:13.580

您可以使用 .NET Framework 的**System.Net.WebClient 类**。请参阅[此处的 MSDN 文档](http://msdn.microsoft.com/en-us/library/system.net.webclient(VS.80).aspx)。

简单的例子：

```
using System;
using System.Net;
using System.IO;

public class Test
{
    public static void Main (string[] args)
    {
        if (args == null || args.Length == 0)
        {
            throw new ApplicationException ("Specify the URI of the resource to retrieve.");
        }

        WebClient client = new WebClient ();

        // Add a user agent header in case the 
        // requested URI contains a query.

        client.Headers.Add ("user-agent", "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.2; .NET CLR 1.0.3705;)");

        Stream data = client.OpenRead (args[0]);
        StreamReader reader = new StreamReader (data);
        string s = reader.ReadToEnd ();
        Console.WriteLine (s);
        data.Close ();
        reader.Close ();
    }
} 
```

WebClient 还有其他有用的方法，允许开发人员从指定的 URI **下载和保存资源。**

例如，该`DownloadFile()`方法将下载资源并将其保存到本地文件。该`UploadFile()`方法将资源上传并保存到指定的 URI。

**更新：**

WebClient 比 WebRequest 更易于使用。通常，除非您需要以高级方式操作请求/响应，否则您可以坚持只使用 WebClient。请参阅使用两者的文章：http: [//odetocode.com/Articles/162.aspx](http://odetocode.com/Articles/162.aspx)

# java - 如何判断我的 Java 组件是否在 Applet 中？

> ID：449915
> 
> 赞同：5
> 
> 时间：2009-01-16T09:07:07.360
> 
> 标签：java, applet

我有一个组件，我在独立的 Java 应用程序和 Java 小程序中都使用它。如何从组件中确定我的组件是否在小程序中？

另外，一旦我发现我在 Applet 中运行，我如何才能访问 Applet？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T10:53:01.280

您可以通过[SwingUtilities.getAncestorOfClass进行递归](http://java.sun.com/j2se/1.4.2/docs/api/javax/swing/SwingUtilities.html#getAncestorOfClass(java.lang.Class,%20java.awt.Component))

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T09:48:05.497

我认为您应该能够通过反复调用`Component.getParent()`直到到达容器树的顶部，然后检查该容器是否为`instanceof Applet`.

下面的代码完全未经测试：

```
boolean isInAnApplet(Component c)
{
    Component p = c.getParent();
    if (p != null) {
         return isInAnApplet(p);
    } else {
         return (c instanceof Applet);
    }
} 
```

# javascript - 单页显示，多页打印问题

> ID：449917
> 
> 赞同：6
> 
> 时间：2009-01-16T09:08:14.063
> 
> 标签：javascript, jquery, html, css, asp.net-mvc

网页显示以下内容：-

*   鲍勃
*   弗雷德
*   约翰

但是，当用户（那是我）打印网页时，我希望多次重复此输出，并在单独的页面上打印细微的变化：-

*   **鲍勃**
*   弗雷德
*   约翰

`>page break here<`

*   鲍勃
*   **弗雷德**
*   约翰

`>page break here<`

*   鲍勃
*   弗雷德
*   **约翰**

实际上，页面内容更大（尽管在标准 A4 页面的价值范围内）并且输出页面的数量约为 20。我更喜欢优雅的跨浏览器解决方案，但最终可以在 Internet Explorer 7 上运行的解决方案是可以接受的。

我正在使用带有 jQ​​uery 的 ASP.NET MVC（尽管直接的 JavaScript 解决方案很好）。

**编辑：** Page-Break-XXX css 样式将成为答案的一部分，但我对从屏幕版本动态创建打印版本 HTML 的方法特别感兴趣。注意我不想导航到“打印机友好”页面然后打印它。我只想点击浏览器的打印按钮，神奇的事情发生了。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-16T19:51:52.187

好的，所以考虑到我的帖子的评论等是这样的：

为了便于显示，我使用了页面样式，但您可以轻松地使用页面外引用。

声明以下样式：

```
<!-- media="print" means these styles will only be used by printing 
  devices -->
<style type="text/css" media="print">
    .printable{ 
      page-break-after: always;
    }
    .no_print{
      display: none;
    }
</style>
<!-- media="screen" means these styles will only be used by screen 
  devices (e.g. monitors) -->
<style type="text/css" media="screen">
    .printable{
      display: none;
    }
</style>
<!-- media types can be combined with commas to affect multiple devices -->
<style type="text/css" media="screen,print">
    h1{
      font-family: Arial, Helvetica, sans-serif;
      font-size: large;
      font-weight: bold;
    }
</style> 
```

然后，您将需要在视图中做一些繁重的工作以使 HTML 看起来**像**这样：

```
<!-- Intial display for screen -->
<div class="no_print">
    <!-- Loop through users here using preferred looping/display method -->
    <ul>
        <li>Bob</li>
        <li>Fred</li>
        <li>John</li>
    </ul>
</div>
<!-- Now loop through each user, highlighting as you go, but for printer* -->
<div class="printable">
    <ul>
        <li><b>Bob</b></li>
        <li>Fred</li>
        <li>John</li>
    </ul>
</div>
<div class="printable">
    <ul>
        <li>Bob</li>
        <li><b>Fred</b></li>
        <li>John</li>
    </ul>
</div>
<div class="printable">
    <ul>
        <li>Bob</li>
        <li>Fred</li>
        <li><b>John</b></li>
    </ul>
</div> 
```

现在为“适当的显示方法”。

我刚开始使用 MVC，所以你可能有更好的方法来做这件事，但现在我可能会使用这样的 RenderPartial 方法：

```
<%
  /* 
  Using RenderPartial to render a usercontrol,
  we're passing in the Model here as the Model for the control, 
  depends on where you've stored your objects really, then we
  create a new anonymous type containing the properties we want
  to set.
  */

  // Display the main list
  Html.RenderPartial("~/Views/Shared/Controls/UserList.ascx",
      ViewData.Model, 
      new {HighlightUser = null, IsPrintable = false});

  // Loop through highlighting each user
  foreach (var user in ViewData.Model)
  {
    Html.RenderPartial("~/Views/Shared/Controls/UserList.ascx",
      ViewData.Model, 
      new {HighlightUser = user, IsPrintable = true});
  }
%> 
```

然后，您的用户控件可以处理大部分显示，根据需要设置包含 div 的类（或您使用的任何元素），并根据传入的用户控件加粗 - 正如我所说，可能有更好的方法做部分的事情。

显然，您可能想要完全不同的用户呈现以进行显示和打印 - 我猜您可能会添加相当多的 jQuery 优点隐藏和显示内容等，您实际上将在打印版本上显示这些内容，所以您可能需要两个不同的用户控件，然后可以不传入 IsPrintable 属性而逃脱。

Also, as it stands, this will print a blank page at the end, due to the "page-break-after" style on all divs - you'd possibly want to note that you're on the last div, and have a different style on that, unless you have information that you'd like on that last page.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T09:47:29.603

我不确定您是否可以通过 CSS 完成所有操作，但这里有一些可以帮助您入门。

要在打印时在 CSS 中获得分页符，请使用以下之一：

*   [分页前](http://www.w3schools.com/Css/pr_print_pagebb.asp)
*   [分页后](http://www.w3schools.com/Css/pr_print_pageba.asp)

这些取值为：

```
auto   // Default. Insert a page break before/after the element if necessary
always // Insert a page break before/after the element
avoid  // Avoid inserting a page break before/after the element
left   // Insert page breaks before/after the element until it reaches a blank left page
right  // Insert page breaks before/after the element until it reaches a blank right page 
```

如果您准备好使用某种“打印”页面来列出您想要的信息，并在重复元素上使用这些样式，那么您应该很高兴。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T13:40:12.903

您需要通过 JavaScript 完成所有操作，创建一个打印链接，单击该链接会调用 window.print()。

然而，在此之前创建您想要的输出并将其放入单独的容器（div、span、任何支持您将放置在其中的标签的 html 元素）。使用主样式表隐藏容器并为打印媒体创建单独的样式表。在该新样式表中显示容器元素并隐藏旧元素以及您不想打印的任何其他内容。

如果您想在之后清理页面，请使用 SetInterval 设置间隔以清理不需要的容器。我不会在调用 window.print() 后立即执行此操作，因为我想打印机不会接收到 HTML 更改，但是快速测试会告诉您其他情况。

如果有一种方法可以使用 javascript 来监听您的页面打印，那么您也可以将其连接起来。

**编辑：** 当您使用 jQuery 时，我将通过使用克隆原始列表

```
$('#listID').clone().appendTo('#hiddencontainer') 
```

[克隆文档](http://docs.jquery.com/Manipulation/clone)

# oracle - 是否可以在 pl sql 中参数化查询？

> ID：449922
> 
> 赞同：1
> 
> 时间：2009-01-16T09:18:20.037
> 
> 标签：oracle, plsql, sql-injection

此处编写的存储过程当前将参数连接到查询：

```
 SELECT * 
     FROM Names 
    WHERE Name = ' || prmName || ' 
 ORDER BY ' || prmSortField 
```

是否可以在存储过程中参数化此查询？可能喜欢：

```
query = 'select * From Names Where Name = @name Order By ' || prmSortField
call(query, prmName) 
```

*注意：*
如果您想知道我们为什么这样做，我们的 sp 有两个常用参数：`sortFieldIndex`和`sortDirection`. 由于我们不能直接参数化这些，查询是动态生成的。但是其他参数使查询打开以进行注入。所以我正在寻找一种方法来参数化一些参数。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T09:45:59.823

绝对地。使用[游标](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14261/sqloperations.htm)。

```
DECLARE
  CURSOR c1 (job VARCHAR2, max_wage NUMBER) IS
    SELECT * FROM employees WHERE job_id = job AND salary > max_wage;
BEGIN
  FOR person IN c1('CLERK', 3000)
  LOOP
     -- process data record
    DBMS_OUTPUT.PUT_LINE('Name = ' || person.last_name || ', salary = ' ||
                         person.salary || ', Job Id = ' || person.job_id );
  END LOOP;
END; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T10:30:35.380

对于具有绑定值的动态查询，请执行以下操作：

```
procedure p (prmName varchar2, prmSortField varchar2)
is
    query varchar2(100);
    rc sys_refcursor;
    names_rec names%rowtype;
begin
    query = 'select * From Names Where Name = :name Order By ' || prmSortField
    open rc for query using prmName;
    loop
        fetch rc into names_rec;
        exit when rc%notfound;
        -- process this row
    end loop;
    close rc;
end; 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-16T12:30:35.727

有关支持可选参数值（但使用 sys 上下文）的更详细的过程，请查看 Asktom.com 上的以下帖子

[PRATTY——感谢关于“CURSOR”的问题......](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:1288401763279#4988761718663 "PRATTY——感谢关于“CURSOR”的问题......")

# iphone - 由于未捕获的异常“NSInternalInconsistencyException”而终止应用程序，原因：“错误：无法打开数据库并显示消息“不是错误”。

> ID：449933
> 
> 赞同：1
> 
> 时间：2009-01-16T09:44:06.723
> 
> 标签：iphone, cocoa-touch, sqlite

我正在制作一个包含许多数据库操作的应用程序。由于 SQLite 缓存数据，在我的 applicationDidReceiveMemoryWarning 方法中，我关闭数据库并再次打开它以删除缓存的数据。

执行此操作时，我收到此错误

> *** 由于未捕获的异常“NSInternalInconsistencyException”而终止应用程序，原因：“错误：无法打开数据库并显示消息“不是错误”。

这是我用来关闭数据库并再次打开的代码，其中数据库类型为 sqlite3* [MySQLInter finalizeStatements];

```
 if(sqlite3_close(database) == SQLITE_OK){

//open again
NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);

NSString *documentsDirectory = [paths objectAtIndex:0];

NSString *path = [documentsDirectory stringByAppendingPathComponent:@"mydb.sql"];

    if(sqlite3_open([path UTF8String], &database) != SQLITE_OK){

         NSAssert1(0, @"Error: failed to open database with message '%s'.", sqlite3_errmsg(database));

}

 }

 else{

NSAssert1(0, @"Error: failed to close database on memwarning with message '%s'.", sqlite3_errmsg(database));

 } 
```

如何避免这种情况？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T13:54:01.533

你确定你在 sqlite3_open 调用中不是指“！= SQLITE_OK”吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-17T20:28:20.270

sqlite3_open 返回错误代码。你只是在检查它的 SQLITE_OK - 看看它到底返回了什么会很有趣。如果它没有打开，那么在数据库上调用 sqlite3_errmsg 是无效的，因为它没有打开数据库，因此可能无法正确填充该对象。

在您的错误捕获条件中，打印出 sqlite3_open 的返回值，我们将能够提供更好的帮助。

# c++ - 是否已经有一些基于 std::vector 的 set/map 实现？

> ID：449940
> 
> 赞同：12
> 
> 时间：2009-01-16T09:51:48.453
> 
> 标签：c++, optimization

`set`对于小型集合或地图，仅使用排序向量而不是基于树的/通常要快得多`map`- 特别是对于 5-10 个元素之类的东西。LLVM 有一些具有[这种精神](http://llvm.org/docs/ProgrammersManual.html#ds_sequential)的类，但没有真正的适配器可以提供`std::map`类似的接口支持`std::vector`.

有任何（免费）实现吗？

**编辑**：感谢所有替代想法，但我对基于矢量的集合/地图非常感兴趣。我确实有一些特定情况，我倾向于创建大量包含通常少于 10 个元素的集合/映射，并且我确实希望减少内存压力。例如，考虑三角形网格中顶点的相邻边，您很容易得到 100k 组，每组 3-4 个元素。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-24T15:41:29.653

我只是偶然发现了你的问题，希望还为时不晚。

[我推荐一个名为Loki](http://loki-lib.sourceforge.net/)的优秀（开源）库。它有一个基于向量的关联容器实现，它是 std::map 的直接替代品，称为[AssocVector](https://github.com/snaewe/loki-lib/blob/master/include/loki/AssocVector.h)。

它为访问元素提供了更好的性能（并且为插入/删除提供了最差的性能）。

该库由[Modern C++ Design](http://en.wikipedia.org/wiki/Modern_C%2B%2B_Design)的作者[Andrei Alexandrescu](http://en.wikipedia.org/wiki/Andrei_Alexandrescu)编写。

它还包含一些其他非常漂亮的东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T20:27:16.437

如果你找不到任何合适的东西，我只会包装一个 std::vector 在插入时执行 sort()，并使用 lower_bound() 实现 find()。它应该是直截了当的，并且与自定义解决方案一样高效。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-11-28T13:27:46.433

旧帖子，我知道，但对于最近的访问者，Boost 的 flat_set 和 flat_map 看起来像你需要的。有关详细信息，请参阅[https://theboostcpplibraries.com/boost.container](https://theboostcpplibraries.com/boost.container)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-16T10:12:45.200

我不知道任何这样的实现，但是有一些函数可以帮助处理 STL 中已经存在的排序向量，例如[`lower_bound`](http://www.sgi.com/tech/stl/lower_bound.html)和[`upper_bound`](http://www.sgi.com/tech/stl/upper_bound.html).

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-16T16:35:06.670

如果集合或映射确实很小，那么通过对数据结构进行微优化所获得的性能将几乎没有明显的影响。在搜索小树与小向量时，您可能会节省一两个内存（读取：缓存）查找，这在大图中是微不足道的。

话虽如此，你可以试试 hash_map 。按键查找保证在恒定时间内运行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T16:53:18.567

也许您正在寻找无序地图和无序集。尝试查看依赖散列的 TR1 无序容器或[Boost.Unordered](http://www.boost.org/doc/libs/1_37_0/doc/html/unordered.html)容器库。在界面下方，我不确定他们是否真的使用 std::vector，但我敢打赌它值得一看。

# javascript - JavaScript 中构造函数指针行为背后的基本原理是什么？

> ID：449941
> 
> 赞同：1
> 
> 时间：2009-01-16T09:52:30.620
> 
> 标签：javascript, oop

考虑简单的场景：

```
函数基（）{}
函数子（）{}
Child.prototype = 新基础；

```

我想知道为什么 Child 的实例会将构造函数属性设置为 Base 而不是 Child？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T10:01:09.060

这一切都与继承在 JavaScript 中的工作方式有关。检查[此链接](http://joost.zeekat.nl/constructors-considered-mildly-confusing.html)以获取详细说明（基本上，`constructor`只是原型的另一个属性）。

**编辑：**另外，如果你想要“真正的”原型继承，你必须使用某种克隆功能，例如

```
function clone(obj) {
    if(typeof obj !== 'undefined') {
        arguments.callee.prototype = Object(obj);
        return new arguments.callee;
    }
} 
```

然后，你可以做这样的事情

```
function Base() {}
function Sub() {}
Sub.prototype = clone(Base.prototype);

var obj = new Sub; 
```

你仍然会得到`true`两次

```
document.writeln(obj instanceof Sub);
document.writeln(obj instanceof Base); 
```

您的解决方案的不同之处在于它`Base()`不会被调用，`Sub.prototype`只会继承`Base.prototype`- 而不是构造函数中设置的属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T10:09:55.610

```
function Base() {}
//Base.prototype.constructor === Base
function Child() {}
//Child.prototype.constructor === Child;
var b = new Base;
//b.constructor = Base;
Child.prototype = b;
//Child.prototype.constructor === Base 
```

基本上，原型的任何属性都成为实例的属性，包括“构造函数”

当您将整个原型属性重新分配给一个新对象时，您将用新的构造函数属性替换旧的构造函数属性。

如果您不希望发生这种情况，则必须将属性一一分配给原型对象，而不是一次将整个原型属性分配给新对象。或者之后替换旧的构造函数属性。

更好的主意：不要依赖构造函数属性来做任何重要的事情。

# c# - 有任何 BDD 成功案例吗？

> ID：449944
> 
> 赞同：5
> 
> 时间：2009-01-16T09:53:33.553
> 
> 标签：c#, .net, bdd, nbehave

写了一篇关于 BDD 的[小文章](http://www.codeproject.com/KB/testing/bddnbehave.aspx)后，有人问我是否存在大规模使用 BDD（特别是 NBehave）的案例。

所以我的问题是向社区提问：你们有成功使用 BDD 的项目吗？如果是这样，你得到了什么好处，还有什么可以更好的？你会再做一次BDD吗？你会推荐给其他人吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T09:31:06.773

我们在不同场景（开源和 ND 项目）的代码级别使用了一些 BDD。

1.  在 MVC 场景中告诉视图，从用户那里接受什么样的输入（[DDD 和 .NET 中的规则驱动 UI 验证](http://abdullin.com/journal/2009/1/29/ddd-and-rule-driven-ui-validation-in-net.html)）

    ```
    result = view.GetData(
      CustomerIs.Valid, 
      CustomerIs.From(AddressIs.Valid, AddressIs.In(Country.Russia))); 
    ```

2.  告诉服务层异常处理行为（[ActionPolicy](http://abdullin.com/journal/2008/12/1/net-exception-handling-action-policies-application-block.html)被注入到装饰器中）：

    ```
    var policy = ActionPolicy
      .Handle<WebException>()
      .Retry(3); 
    ```

使用这些方法极大地减少了代码重复，使代码库更加稳定和灵活。此外，由于对复杂细节的逻辑封装，它使一切变得更加简单。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-30T23:22:28.223

我在一个在网站上使用 BDD 的小团队中。

我们使用它的方式本质上是 TDD，但测试只是使用 DSL 编写为行为。我们没有进行大型行为的前期设计，但我们确实创建了大量的行为，并完全按照您的测试使用它们。

如您所料，它的工作原理与 TDD 差不多，总体上还不错。在与客户互动时将测试表述为行为很好，并制作了一个相当不错的文档，但我有点希望这些行为是用英语编写的，并且测试是经过编程的，而不是试图提出一些困难的中间语言完美契合任何一个目的。

它仍然是 BDD，只是没有这种试图将语言扭曲成由 random_looking.set of_Punctuation 而不是 simple.spaces 描绘的语言的可爱技巧，但这只是我脾气暴躁的老程序员的态度，其他人都是 100% 开心的用它。

该站点可用并且完全可以运行，所以我认为它是成功[的：看看](http://www.genetree.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T07:30:37.340

我最近在一个高级需求文档中使用了 GWT 的 BDD 样式。我没有从客户那里得到任何关于 GWT 的反馈，我的老板说他喜欢它，因为它非常清晰易懂。请注意，他不了解我所知道的 BDD。我没有加入用户故事，因为对于具有传统瀑布背景的人来说，这可能有点过于空灵。也许下次我会尝试加入用户故事。

顺便说一句，这不是一个眼球 UI 项目。这是一个将 Web 服务中的数据同步到数据库的集成项目。因此它表明 GWT 甚至适用于非“眼球”用户界面。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-23T05:00:22.853

我一直在几个项目（使用 MSpec）上使用 Context-Specification 风格并取得了巨大的成功。我仍在尝试了解 Scenario 风格的真正好处。我使用上下文规范样式的次数越多，我就越喜欢它，并且我的应用程序感觉越紧凑。

# c# - WinForms/WebForms 控件的默认案例思考

> ID：449945
> 
> 赞同：1
> 
> 时间：2009-01-16T09:54:18.887
> 
> 标签：c#, winforms, webforms, uppercase, lowercase

为什么控件的 WinForms 默认名称以小写开头，而 WebForms 则为大写？这可能的理由是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T10:24:32.570

可能迷失在时间的深处，以及不同团队与不同设计师合作的产物。

下一条注释不适用于最初的日子，但在当前 ASP.NET 的化身中，一个有趣的点是页面*继承自代码隐藏，因此**如果*它们被公开为受保护，则正确大小写的名称是有意义的特性。但它们不是：它们作为受保护的字段公开......所以这是一次打破了 2 个标准准则（非私有字段和字段的大小写）。

# jsp - 以 unicode 形式存储到 ms-access 中的问题

> ID：449951
> 
> 赞同：1
> 
> 时间：2009-01-16T09:57:23.967
> 
> 标签：jsp, unicode

我有一个具有一个文本字段的 JSP 页面。我正在输入一些卡纳达语字符。我能够以 UTF-8 格式对其进行编码，并将这个值传递给另一个 JSP。

在警告框中，我得到了正确的字符，但是当我使用 JDBC-ODBC 驱动程序存储到 MS-access 中时，这些值存储为问号 ( `?`)，并且在获取时，它还在 JSP 中显示问号。

我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T10:55:48.717

[Microsoft 的这篇文章](http://support.microsoft.com/kb/259477)让我相信 ODBC 驱动程序和 Unicode 存在问题。但我不是 100% 确定的。

如果文章属实，我会尝试切换数据库或 ODBC 驱动程序。访问是一项要求吗？

# tfs - Team Build，复制文件目标问题

> ID：449952
> 
> 赞同：2
> 
> 时间：2009-01-16T09:57:43.480
> 
> 标签：tfs, copy, tfsbuild, targets

我在编译后设置了这个团队构建目标

```
 <Target Name="AfterCompile">
    <Copy SourceFiles="$(SolutionRoot)\Development_VS2008\MyCompanyName.SharePoint.12" DestinationFolder="c:\testing"></Copy>
  </Target> 
```

我想要从源复制到目标的文件夹结构......

令人惊讶的是我收到了这个错误

> 无法将文件“C:\TFS\NightlyBuild\Sources\Development_VS2008\MyCompanyName.SharePoint.12\”复制到目标文件“c:\testing\”，因为目标是文件夹而不是文件。要将源文件复制到文件夹中，请考虑使用 DestinationFolder 参数而不是 DestinationFiles。

如您所见，我确实在使用destinationfolder 参数，有人知道我做错了什么吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T10:07:17.753

我认为这可能只是因为`SourceFiles`是目录而不是您要复制的文件。尝试这个：

```
<Target Name="AfterCompile">
    <ItemGroup>
        <FilesToCopy Include="$(SolutionRoot)\Development_VS2008\MyCompanyName.SharePoint.12\**\*.*"/>
    </ItemGroup>

    <Copy SourceFiles="@(FilesToCopy)" DestinationFolder="c:\testing\%(RecursiveDir)"/>
</Target> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2018-09-24T07:19:16.820

这个错误不是在 Team Foundation 项目下发生的，而是在独立项目下发生的，当我使用构建操作 ContentWithTargetPath 添加新的 .dll 文件时。我希望这个库包含在我的输出目录中。此操作的记录出现在 .csproj 文件的 ItemGroup 部分之一中，例如：

```
<ContentWithTargetPath Include="Resources\Libraries\libName.dll">
  <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
</ContentWithTargetPath> 
```

但是由于某种原因，这不足以让 ContentWithTargetPath 选项正常工作（我在 StackOverflow 的某处看到了关于它的解释，但不记得在哪里）。您应该像这样手动将 TargetPath 小节添加到 ContentWithTargetPath：

```
<ContentWithTargetPath Include="Resources\Libraries\libName.dll">
  <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
  <TargetPath>libName.dll</TargetPath>
</ContentWithTargetPath> 
```

在 Visual Studio 中编辑 .csproj 文件时，IntelliSense 不会出现 TargetPath 小节，并且它不会出现在 libName.dll 的属性窗口中，因此您应该手动添加此小节。这种情况甚至出现在我的 Visual Studio Community 2017 中。

PS。您可以在 Visual Studio 中编辑 .csproj 文件 - 卸载此项目并选择“Edit YourProjectName.csproj”选项（在卸载的项目上单击鼠标右键）。编辑并保存 .csproj 文件，然后重新加载项目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T11:05:44.360

你需要这样的东西：

```
<CreateItem Include="someFolder\**\*.*">

    <Output ItemName="files" TaskParameter="Include" />

</CreateItem>

<Copy SourceFiles="@(files)" DestinationFiles="@(files->'C:\folder\%(relativedir)%(Filename)%(Extension)')" SkipUnchangedFiles="true" /> 
```

或者，我发现最简单的方法（如果您想对包含/排除的内容更加严格）是使用我编写的一些自定义 MSBuild 任务：[http ://www.aaron-powell.com/blog .aspx?cat=AaronPowell.MSBuild.Tasks](http://www.aaron-powell.com/blog.aspx?cat=AaronPowell.MSBuild.Tasks)

您提供源目录、目标方向（提供对网络共享的支持）和要排除的文件名/扩展名。

这主要是因为 Team Build 在运行时会弄得一团糟（尤其是 Web 应用程序），并且实际上不可能使用标准的 MSBuild 复制任务。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T10:27:00.613

我们在使用 postbuild xcopy 命令时遇到了很多问题。我们决定避免使用 xcopy 命令。

我们现在将文件（我们要复制的）包含到项目中，并且我们将复制本地属性设置为“如果较新则复制”和目标目录（目录结构必须在项目中相同）

它有很大帮助。
也许它也适合你的情况。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-25T11:15:04.243

复制任务显然不支持复制目录（因为它基于“复制”），并且 xcopy 有时会由于源中的长文件名（> 256 个字符）而失败。

我这样做了（使用 robocopy）： `<Exec WorkingDirectory="$(MSBuildProjectDirectory)" Command='robocopy $(MSBuildProjectDirectory)\Main $(DropLocation) /S /COPY:DATS /NP /NFL /NDL /v' ContinueOnError="true" />`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-08-06T16:52:59.227

我收到了完全相同的信息：

错误 103 无法将文件“obj\Release\xxxx.dll”复制到目标文件“bin\Release\xxxx.dll”，因为目标是文件夹而不是文件。要将源文件复制到文件夹中，请考虑使用 DestinationFolder 参数而不是 DestinationFiles。xxxx

碰巧（我不知道为什么）我在发布文件夹中有另一个与程序集名称相同的文件夹（包括扩展名），因此 Visual Studio 无法在那里创建程序集。它不是项目或解决方案中的配置，所以我只是删除了文件夹（我不知道它是如何创建的）并且它起作用了。

# asp.net-mvc - Upgrading from MVC Preview 3 to Beta/RC

> ID：449962
> 
> 赞同：1
> 
> 时间：2009-01-16T10:04:01.317
> 
> 标签：asp.net-mvc

We have a web app that is using MVC Preview 3\. I'm new to the project and relatively new to ASP.NET MVC itself - soon we will be looking to upgrade to either the Beta or RC version.

1.  Are there any major difference between preview 3 and Beta version that would require extensive refactoring?

2.  Any "gotchas"?

3.  From my understanding the RC will be very close to the current Beta... does anyone have a view on this?

Any advice apprecited really.... thanks.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T10:14:10.967

ASP NET MVC - Beta Release Notes has all the details regarding the changes. It is available at the mvc download page.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T10:14:38.457

There were quite a few changes between preview 3 to the beta. IIRC the most pain came between preview 3 - preview 4.

One of the biggest gotchas is some of the functionality in the main dlls got placed into a separate dll because they were not going to be fully supported for the first release.

I suggest you brew a large pot of coffee and go and read everything Phil Haack and Scott Gu wrote around that time.

[http://haacked.com/archive/2008/07/16/aspnetmvc-codeplex-preview4.aspx](http://haacked.com/archive/2008/07/16/aspnetmvc-codeplex-preview4.aspx)

[http://weblogs.asp.net/scottgu/archive/2008/07/14/asp-net-mvc-preview-4-release-part-1.aspx](http://weblogs.asp.net/scottgu/archive/2008/07/14/asp-net-mvc-preview-4-release-part-1.aspx)

# ruby-on-rails - 在 Ruby gem 中获取参数

> ID：449963
> 
> 赞同：0
> 
> 时间：2009-01-16T10:04:26.387
> 
> 标签：ruby-on-rails

有一种方法可以读取我尝试过的宝石类中的参数需要“cgi”并需要“action_pack”但没有机会......有任何线索吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T10:17:20.807

更精确。什么参数？提交的表格？

如果是，您可以这样做：

```
require "cgi"

...

cgi = CGI.new
h = cgi.params

login = h['login'][0]
password = h['password'][0] 
```

等等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T12:23:33.323

似乎 CGI.new 创建了一个新对象并且不包含当前请求的参数

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-28T13:36:07.273

也许您可以为此使用[Rack](http://rack.rubyforge.org/)中间件。另请参阅[http://railscasts.com/episodes/151-rack-middleware](http://railscasts.com/episodes/151-rack-middleware)以获取教程。

# c - 您最欣赏的用于 C 应用程序开发的 IDE

> ID：449964
> 
> 赞同：4
> 
> 时间：2009-01-16T10:05:34.777
> 
> 标签：c, ide

我正在寻找一个良好的集成开发环境，用于在 C 语言中为 windows 和 linux 开发应用程序。

IDE 应该有：

*   界面不错，
*   轻松的文件管理，
*   自动填充和
*   任何高级选项。

告诉我你最欣赏这些任务的哪个 IDE

1.  用于一般 PC 应用程序开发
2.  用于 C 中的嵌入式应用程序开发

如果您认为这是更具体的问题，那么您也可以将其视为一般情况。提前致谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-16T10:12:06.870

用于一般 PC 开发 - Microsoft Visual Studio + [VisualAssist](http://www.wholetomato.com/)

对于大规模开发，你几乎找不到比[Source Insight更好的东西了](http://www.sourceinsight.com/)

如果您需要跨平台 IDE，请查看[Eclipse CDT](http://www.eclipse.org/cdt/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-19T18:39:44.680

好吧，当我使用 CI 使用[Vim](http://www.vim.org)时，使用正确的插件，我发现它是 C 的最佳 IDE。需要一些练习才能习惯它，但一旦你这样做了，你就会在你的文件中飞来飞去。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T10:18:14.377

出于这两个目的，我建议[Eclipse](http://www.eclipse.org/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T10:53:37.377

我将 Visual Studio 描述为编写和调试代码时功能最丰富和最舒适的地方，但它的目标受众很窄 - Windows 开发人员。

正如其他人所说，Eclipse 可能是您最好的选择，[大量可用的插件也派上用场](http://www.eclipse-plugins.info/eclipse/plugins.jsp)。例如，如果您想移动到一个新的源代码存储库，很可能已经为它编写了一个 Eclipse 插件。大多数其他 IDE 都没有这种奢侈。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T10:20:00.583

除了 OS X 上的[TextMate](http://macromates.com/)，它是一个功能非常齐全的文本编辑器，我会说 NetBeans 或 Eclipse。

编辑：是的，如果你有一台 mac，你可以像在“真正的”PC 中一样轻松地使用 VMWare/Paralles 进行 PC 开发，并且你可以获得 OS X 作为奖励。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T10:24:13.897

我会说 Eclipse 是最好的选择。 [日食页面](http://www.eclipse.org)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-16T10:41:03.487

查看[Code::Blocks](http://www.codeblocks.org/)，它非常好，使用 C 语言，并且可根据要求用于 Windows 和 Linux。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-19T18:46:55.913

这里也有一些关于 C IDE 的好建议：[C on Visual Studio](https://stackoverflow.com/questions/28605/c-on-visual-studio)

我问过在 Visual Studio 中使用 C，但答案包含对各种 IDE 的建议

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-17T03:14:20.157

[SlickEdit](http://slickedit.com)是一个不错的跨平台 IDE，具有自动编译、宏、各种文本编辑器仿真模式、重构功能等......虽然是商业的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-16T10:43:34.280

即使它最初是为 JAVA 开发的，我还是喜欢[NetBeans](http://www.netbeans.org/) IDE，因为它有一些不错的特性，而且它[也了解](http://www.netbeans.org/features/cpp/index.html)C。

CVS/SVN 插件可用。

# ado.net - 实现 ADO.NET 层

> ID：449969
> 
> 赞同：0
> 
> 时间：2009-01-16T10:09:06.937
> 
> 标签：ado.net

是否有任何教程或方法说明如何实现 ADO.NET 层？

这将包括实现一个 Connection 类等。

我需要这样做，因为我正在查询一个旧的专有系统，并且我想正确地包装旧的 API。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T10:19:27.603

[请参阅http://msdn.microsoft.com/en-us/magazine/cc301611.aspx](http://msdn.microsoft.com/en-us/magazine/cc301611.aspx)上的“构建用于 .NET 数据访问框架的自定义数据提供程序”

此外，谷歌搜索“自定义 ADO.NET 数据提供程序”应该会给您许多可能的答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T15:34:39.320

不久前我问了一个类似的问题。您可能想通读那里的答案。实际回答这个问题的人发布了一个代码项目文章的链接，该文章很好地解释了使用 MSAcess 时的麻烦。

[在哪里可以找到使用 ADO.NET 的开源 C# 项目？](https://stackoverflow.com/questions/167746/where-can-i-find-an-open-source-c-project-that-uses-ado-net)

# svn - 将 Cruise Control .NET 作为服务运行

> ID：449970
> 
> 赞同：4
> 
> 时间：2009-01-16T10:09:17.017
> 
> 标签：svn, configuration, cruisecontrol.net

我已经配置和测试 CCNet 有一段时间了，现在使用 Virtual PC 来托管它。一切都很顺利，决定将配置转移到服务器位置——这和预期的一样顺利。一些调整和踢腿，我让它像以前一样运行。

问题是我们现在需要将 CCNet 作为服务运行，这被证明是有问题的。

我已经配置了一个与我具有相同访问权限的域级用户（毕竟控制台应用程序已经像我一样运行了大约 3 个月）并将服务配置为在该用户下运行。

我启动了服务，它挂了！[我不会让你厌烦强制服务停止和关闭保持打开的套接字的细节]。当我最终能够再次运行控制台时，我执行了“运行方式”并输入了“cruisecontrol”用户详细信息，单击“确定”并看到通过 https 访问 SVN 时出现问题。我通过将 IE 作为“cruisecontrol”运行、导航到存储库并接受/安装证书来对其进行排序。接下来，当我将控制台应用程序作为“cruisecontrol”运行时，它会在以下几行之后挂起：

`2009-01-15 16:55:50,994 [Pepsi Webservices:DEBUG] Running Subversion with arguments : log --xml --limit 1 [https://ash-dev-005.[path](https://ash-dev-005.[path) to trunk]`

`2009-01-15 16:55:51,478 [Pepsi Webservices:DEBUG] Authentication realm: [https://ash-dev-005.[path](https://ash-dev-005.[path) to repository] Subversion Repositories`

超时后，我可以关闭控制台，正常运行（即像我一样）并且运行良好。我尝试以“cruisecontrol”用户身份登录服务器并尝试运行控制台，但结果相同。

现在，事情是这样的：今天早上，我以“cruisecontrol”用户身份登录服务器并打开了一个命令窗口。我导航到项目的主干并输入“svn update”并提示输入密码。

这并不奇怪，但该提示上方的行是上面的“身份验证领域：...”行！查看日志文件，果然在进程被 CCNet 杀死后，会提示输入密码。CCNet/SVN 是否在等待输入密码然后超时？如果是这样，为什么它不使用配置文件中的那个？

我输入了密码，更新继续进行，没有任何问题（因此 Cruisecontrol 用户确实有权从服务器访问存储库）。我再次输入命令，但没有第二次提示，所以我尝试打开一个新的命令窗口并重新运行命令 - 仍然没有提示输入密码，所以我注销并重新登录（作为巡航控制）并再次尝试，但仍然没有提示.

好消息是，当我以 Cruisecontrol 用户身份运行控制台应用程序时（无论是以 Cruisecontrol 身份登录还是仅使用 Run As），一切似乎都正常。

那么我的问题是什么？那么，为什么 CCNet 不使用配置文件中的密码呢？在命令提示符下输入密码是如何解决问题的（并且会持续存在）？

任何建议/见解表示赞赏。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T11:27:36.827

嗯 - 我可能已经在这里回答了我自己的问题（或者没有，只有时间会证明）。

出于某种原因，CCNet 似乎没有使用配置文件中的凭据（不知道为什么）。当它调用 SVN 时，它等待输入密码，即使用户看不到它，然后在没有得到密码时超时。

通过从命令行访问 SVN，密码提示是可见的并且可以输入，此外，密码缓存在该用户的加密文件中的 %app_data%\Subversion\auth\svn.simple 中。这就是为什么后续命令不提示输入密码以及控制台应用程序运行时不会出现任何问题的原因。

我现在要配置 CCService，因此希望它能够像控制台应用程序一样正常工作。

如果你有过类似的经历，请告诉我。与此同时，我可能会向 ThoughtWorks 提出这个问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T11:36:50.177

据我记得，当您将 cc.net 作为服务运行时，它使用另一个配置文件，然后当您将其作为控制台应用程序运行时。（ccservice.exe.config 而不是 cc.exe.config）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T20:24:17.900

与 Frederik 的响应相关 - 在我们的服务器上，我们在项目本身中指定了颠覆凭证。这些项目之一的源代码控制块看起来像这样：

```
<sourcecontrol type="svn">
    <trunkUrl>http://myserver/svn/myproject/trunk</trunkUrl>
    <workingDirectory>C:\source\MyProject</workingDirectory>
    <username>foo</username>
    <password>bar</password>
    <autoGetSource>true</autoGetSource>
</sourcecontrol> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T00:00:23.843

戴夫，很容易诊断 CruiseControl 是否使用配置文件中的密码，因为您将在日志中看到命令行以及实际密码参数和密码（如果正在使用），并传递给 svn。如果您在配置文件中有密码和用户并且它们没有被传递，我首先要检查的是您的配置文件是否有效并且文件系统中的配置文件是实际使用的。如果您对配置文件进行了无效更改，只要服务正在运行，CC.NET 就会忽略它，并继续使用它在内部缓存的版本，而不会发出任何警告或消息。所以再次验证的唯一方法是通过网络仪表板查看配置并确保它反映了您的期望，或者您可以退回服务，此时它将停止并指出您的错误。最后，尽管您可以通过使用颠覆缓存密码来解决此问题。

# design-patterns - 一段代码，如果可重用并适用于不同的上下文，是否可以归类为模式？

> ID：449978
> 
> 赞同：0
> 
> 时间：2009-01-16T10:13:24.807
> 
> 标签：design-patterns

什么构成模式？如果我有一个可重用并且可以应用于其他类似情况的模板/代码，它可以称为模式吗？

以下是我创建的。它是一种处理条件构造的二元方法。我在表中有一个复合字段，即它包含 3 个或更多其他子字段，每个子字段都有一个真值或假值。

现在，我有将真/假值表示为 0 和 1 的子字段。这些字段在基于 Web 的应用程序中以下拉菜单的形式呈现给用户。这些字段组合在一起形成一个包含 8 位的字节值，前 3 位的值是 0 或 1，用户选择为假或真。如果用户选择所有字段为真，则主字段的值为 7，如果他选择所有字段为假，则主字段的值为 0，类似情况。

主字段表示现有表中的一列。此代码的优点是，由于需要新的子字段，因此无需在表中添加新列。对于每个新的子字段，用户界面都会有一个额外的下拉菜单。

此代码是可重用的，可以应用于不同的上下文。这可以归类为模式吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T10:33:16.763

从*设计模式*：

“观点会影响一个人对什么是模式和不是模式的解释。一个人的模式可以是另一个人的原始构建块。”

它还说，一般来说，模式有四个基本要素：

*   姓名
*   问题
*   解决方案
*   结果

我认为可以合理地说，即使是非常有经验的程序员称之为原始构建块的一些技术也可以被视为初学者的模式。如果我正在教一个全新的程序员，我想我会立即开始讨论模式，将它们与循环（for...next、do...while 等）和错误处理（尝试... catch, on error goto 等），然后介绍您可以创建和使用自己的模式的想法（例如惰性初始化、保护子句）。

我在某处读到真正有用的模式最终会被整合到语言中，所以我总是想象 for...next 循环是作为汇编模式开始的。所以今天的设计模式是明天的原始构建块，是后天的语言特性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T10:18:34.000

有语言模式，但大多数模式是指一种设计，而不是任何特定于语言的东西。

你描述的东西我称之为组件。

顺便说一句，在一列中存储多个值可能违反规范化准则。从长远来看，如果您对每个值使用一列，它可能会更容易。

有关规范化的说明，请参阅[此问题](https://stackoverflow.com/questions/246701/what-is-normalisation-or-normalization-why-is-it-important)的第一个答案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T10:21:15.900

好吧，设计模式通常比这更抽象。毫无疑问，这里有一个潜在的模式。然而，你如何存储的细节变成了更多的实现细节，而不是模式的一部分。现在，您可能会深入思考并辨别您正在使用的潜在模式。不过，我现在深入思考它有点晚了。:) 但是，您正在采用一种元数据方法，这与实体属性值之类的东西有某种关系（不过，这不是 EAV 的情况）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-16T10:16:50.340

模式不是实际的代码，而是方法。猜测这可能是某种模式......我会说模式往往是逻辑/方法的一部分，它们被缩减为基本形式，并且在许多情况下对许多人都有用。

不确定您的方法是否是其中之一？！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T10:21:45.633

并不真地。模式是一种解决方案，[一种解决常见编程问题的方法](http://en.wikipedia.org/wiki/Design_pattern_(computer_science))，而不是一段代码。

您所描述的最好命名为执行某些操作的模块或库（甚至是函数/子例程）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T11:04:19.463

你所拥有的是一个组件。模式是一种构建组件的技术，并不特定于任何特定的问题领域。

# function - PowerShell 中对 $args 的混淆评估

> ID：449981
> 
> 赞同：3
> 
> 时间：2009-01-16T10:14:30.250
> 
> 标签：function, powershell, arguments

根据定义，$args 变量应该包含传递给脚本函数的所有参数。但是，如果我在函数内部构建管道，则 $args 变量的计算结果为 null。有谁知道为什么？

看这个例子：

```
function test { 1..3 | % { echo "args inside pipeline: $args" } ; echo "args outside pipeline: $args" } 
```

这是传递参数“hello”时的输出：

```
PS> test hello
args inside pipeline:
args inside pipeline:
args inside pipeline:
args outside pipeline: hello 
```

这有什么具体原因吗？我知道如何解决这个问题，但是我想知道那里的任何人是否可以解释这个原因。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T16:14:38.490

管道使用 $input。试试这个：

```
function test { 1..3 | % { echo "args inside pipeline: $input" } ; echo "args outside pipeline: $args" } 
```

# java - 在 Windows 下从 ANT 脚本创建 RPM 包

> ID：449983
> 
> 赞同：13
> 
> 时间：2009-01-16T10:15:07.907
> 
> 标签：java, ant, installation, rpm

我需要从在 Windows 计算机上运行的 ANT 脚本创建一个 RPM 包。这个包必须包含构建的结果类以及其他一些额外的资源。

我想应该有一些程序可以从命令行调用来创建这个包。

我想在 windows 下做这件事的原因是我们有一个脚本可以为几个不同的平台构建安装程序，而且一切都已经为 windows 配置好了，所以我想避免将所有东西迁移到 linux 的痛苦。

你知道如何做到这一点吗？

编辑：我使用了单独的 Linux 机器来执行此操作。我使用 scp 任务复制所有文件，然后使用 ssh 任务远程执行 rpm 命令。如果此任务返回成功代码，我会使用 scp 将生成的 rpm 复制回来。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-11-26T11:19:05.083

还要考虑 redline-rpm java 库和 ant 任务。[https://github.com/craigwblake/redline](https://github.com/craigwblake/redline)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T15:47:13.957

一种可能的解决方案是使用纯 java RPM Manipulation 工具，例如：

[http://jrpm.sourceforge.net/rpmspec/index.html](http://jrpm.sourceforge.net/rpmspec/index.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T10:16:06.313

查看 Ant 手册，我发现了以下可选任务：

[http://ant.apache.org/manual/Tasks/rpm.html](http://ant.apache.org/manual/Tasks/rpm.html)

但是，这只能在 linux 计算机上运行

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-16T11:33:30.607

我不知道有什么包可以做到这一点，但这可能只是我的无知。

两个建议：

设置 Linux 机器（单独的 PC 或虚拟机）并通过脚本远程安装 rpm（请参阅[ssh](http://sshwindows.sourceforge.net/) /scp/ [samba](http://en.wikipedia.org/wiki/Samba_(software))）。这让我觉得这是一种避免完全构建环境迁移的安全方法。

一种更冒险的方法是使用 Java 编写您自己的 RPM 文件。[RPM 文件格式](http://www.google.co.uk/search?hl=en&client=firefox-a&rls=org.mozilla:en-GB:official&hs=qg7&q=+site:rpm.org+rpm+file+format)似乎是一个标头，后跟许多标准存档格式之一。需要对存档内容进行一些分析，因此这种方法在短期内可能会非常耗时（尽管它可能会导致更快的构建）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-01-19T22:56:44.670

[疯狂的包管理](https://github.com/jordansissel/fpm)可以做到这一点。您应该能够使用 JRuby 和 MRI Ruby 运行它。

`fpm -s dir -t rpm mydir`-- 或您提供 rpm 关键字的其他咒语。见`fpm --help`。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T11:06:26.277

我认为这是不可能的，为 linux 构建的运行时包将无法在 windows 上运行（我们不希望 dll 和 exes 在 linux 上运行，对吧！）。Cygwin 面临着类似的挑战，他们明确表示他们通过为 Windows 编译源文件来做到这一点。

# .net - VB.NET FileSystemWatcher 多个更改事件

> ID：449993
> 
> 赞同：11
> 
> 时间：2009-01-16T10:19:10.507
> 
> 标签：.net, vb.net, filesystemwatcher

我有以下代码：

```
 Imports System.IO

Public Class Blah
    Public Sub New()
        InitializeComponent()

        Dim watcher As New FileSystemWatcher("C:\")
        watcher.EnableRaisingEvents = True

        AddHandler watcher.Changed, AddressOf watcher_Changed
    End Sub

    Private Sub watcher_Changed(ByVal sender As Object, ByVal e As FileSystemEventArgs)
        MsgBox(e.FullPath)
    End Sub
End Class 

```

当我运行它并将更改保存到我的 C 驱动器上的文件时，代码运行良好，除了它执行 watcher_Changed() 方法四次。知道为什么吗？changeType 每次都是“4”。

谢谢。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-16T10:37:47.380

从 VS.NET 文档的“故障排除 FileSystemWatcher 组件”部分...

> ### 为单个操作生成多个创建事件
> 
> 您可能会注意到在某些情况下，单个创建事件会生成多个由您的组件处理的 Created 事件。例如，如果您使用 FileSystemWatcher 组件监视目录中新文件的创建，然后使用记事本创建文件进行测试，即使只创建了一个文件，您也可能会看到生成了两个 Created 事件。这是因为记事本在写入过程中执行了多个文件系统操作。记事本分批写入磁盘，创建文件内容，然后创建文件属性。其他应用程序可以以相同的方式执行。因为 FileSystemWatcher 监视操作系统活动，所以这些应用程序触发的所有事件都将被拾取。
> 
> 注意：记事本也可能导致其他有趣的事件生成。例如，如果您使用 ChangeEventFilter 指定您只想监视属性更改，然后您使用记事本写入您正在监视的目录中的文件，您将引发一个事件。这是因为记事本会在此操作期间更新文件的存档属性。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-01-16T10:46:59.200

不久前，我遇到了同样的问题。

在网上搜索了一番后，看来我不是唯一一个遇到这个问题的人。:) 所以，也许这是 FileSystemWatcher 的一个缺陷......

我通过跟踪最后一次引发事件处理程序来解决它。如果它在 xxx 毫秒前被提升，我会从我的事件处理程序返回。如果有人知道更优雅的修复程序；请让我知道。:)

这就是我解决它的方法：

```
if( e.ChangeType == WatcherChangeTypes.Changed )
{

    // There is a nasty bug in the FileSystemWatch which causes the 
    // events of the FileSystemWatcher to be called twice.
    // There are a lot of resources about this to be found on the Internet,
    // but there are no real solutions.
    // Therefore, this workaround is necessary: 
    // If the last time that the event has been raised is only a few msec away, 
    // we ignore it.
    if( DateTime.Now.Subtract (_lastTimeFileWatcherEventRaised).TotalMilliseconds < 500 )
    {
        return;
    }

    _lastTimeFileWatcherEventRaised = DateTime.Now;

    .. handle event 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-10-20T11:53:56.443

我对这个问题的解决方案有点像 Erics，除了我使用 System.Windows.Forms.Timer 而不是启动新线程。这个想法是我只在 x 毫秒过去而没有任何文件更改事件的情况下处理更改事件。请注意，一切都发生在 GUI 线程上，因此不存在线程问题。我使用 x = 100。

```
 private Dictionary<String, FileSystemEventArgs> xmlFileChangedEvents = new Dictionary<string, FileSystemEventArgs>();
    private void debugXmlWatcher_Changed(object sender, FileSystemEventArgs e)
    {
        if (!xmlFileChangedEvents.ContainsKey(e.Name))
            xmlFileChangedEvents.Add(e.Name, e);
        xmlChangeTimer.Stop();//Reset the Forms.Timer so that it times out in 100 ms
        xmlChangeTimer.Start();
    }

    private void xmlChangeTimer_Tick(object sender, EventArgs e)
    {
        foreach (FileSystemEventArgs eventArg in xmlFileChangedEvents.Values)
        {
            //
            //Handle the file changed event here
            //
        }
        xmlFileChangedEvents.Clear();
    } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-12-08T21:28:34.827

观察者更改的事件处理程序将触发 3 个事件...创建、删除、更改。只有当您重命名文件时才会触发 onrenamed 事件。这可能就是您收到 4 个警报的原因。此外，大多数程序在关闭文件之前会对文件运行多项操作。每个事件都被视为一次更改，因此每次都会触发 on_changed 事件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-16T10:23:06.863

假设每次路径都相同，您用来保存文件的程序是否可能实际上是分段保存？或者你有多个`Blah`实例化？

* * *

编辑：您是否正在运行任何防病毒自动保护软件？那些可能会在此过程中触及文件。

从[MSDN 文档](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)：

> 常见的文件系统操作可能会引发多个事件。例如，当一个文件从一个目录移动到另一个目录时，可能会引发几个 OnChanged 以及一些 OnCreated 和 OnDeleted 事件。移动文件是一个复杂的操作，由多个简单的操作组成，因此会引发多个事件。同样，某些应用程序（例如，防病毒软件）可能会导致 FileSystemWatcher 检测到的其他文件系统事件。

* * *

编辑：或者也许与windows如何保存文件有关。您可能会从不同的更改中获得不止一个事件。（一个用于大小，一个用于最后写入时间戳，一个用于最后访问时间戳，还有一个用于...其他内容。）尝试将`FileSystemWatcher`'`NotifyFilter`属性设置为单一类型的更改，看看是否继续获取多个事件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-16T10:39:42.057

还有另一种可能性，您犯了错误:) 也许您在将“Blah”类用于文件监视之前实例化并终止它，而忘记通过 Dispose/或任何相关的拆卸方法实现 RemoveHandler。（？）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-13T21:58:54.657

我编写了一些代码来解决这个问题以及 FileSystemWatcher 的其他简洁功能。它发布在我的博客中： http: [//precisionsoftware.blogspot.com/2009/05/filesystemwatcher-done-right.html](http://precisionsoftware.blogspot.com/2009/05/filesystemwatcher-done-right.html)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-08-12T14:54:45.340

我发现这个页面有同样的问题。从它的样子来看，即使您添加逻辑来有条件地处理多个事件，任何应该处理的代码都将在发生后续（重复）事件时被中断/中止，从而导致不良行为。我认为解决这个问题的一种方法是以某种方式在不同的线程上实现一个事件处理程序......希望这是有道理的。

干杯，

尼科

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-09-09T19:12:54.533

这是我如何处理此问题的概念证明。

要进行测试，请创建一个新的 Windows 窗体应用程序。在表单上，​​添加一个名为“tbMonitor”的多行文本框。右键单击表单并转到查看代码。用我在下面包含的代码替换该代码。请注意，我将等待时间设置为一个非常高的数字，以便您可以尝试一下。在生产中，您可能希望使这个数字低得多，可能在 10 或 15 左右。

```
Imports System.IO
Imports System.Threading
Public Class Form1
Private Const MILLISECONDS_TO_WAIT As Integer = 1000
Private fw As FileSystemWatcher
Private Shared AccessEntries As List(Of String)
Private Delegate Sub UpdateBoxDelegate(ByVal msg As String)
Private Sub UpdateBox(ByVal msg As String)
    If tbMonitor.InvokeRequired Then
        Invoke(New UpdateBoxDelegate(AddressOf UpdateBox), New Object() {msg})
    Else
        tbMonitor.AppendText(msg + vbCrLf)
    End If
End Sub

Private Sub AccessEntryRemovalTimer(ByVal RawFileName As Object)
    UpdateBox("Sleeping to watch for " + RawFileName.ToString + " on thread ID " + Thread.CurrentThread.ManagedThreadId.ToString)
    Thread.Sleep(MILLISECONDS_TO_WAIT)
    AccessEntries.Remove(RawFileName.ToString)
    UpdateBox("Removed " + RawFileName.ToString + " in thread ID " + Thread.CurrentThread.ManagedThreadId.ToString)
End Sub

Private Sub Changed(ByVal source As Object, ByVal e As FileSystemEventArgs)
    If AccessEntries.Contains(e.Name) Then
        UpdateBox("Ignoring a " + e.ChangeType.ToString + " notification for " + e.Name + " in thread ID " + Thread.CurrentThread.ManagedThreadId.ToString)
        Return
    End If
    Dim AccessTimerThread As Thread

    AccessEntries.Add(e.Name)
    UpdateBox("Adding " + e.Name + " to the collection and starting the watch thread.")
    AccessTimerThread = New Thread(AddressOf AccessEntryRemovalTimer)
    AccessTimerThread.IsBackground = True
    AccessTimerThread.Start(e.Name)

End Sub

Private Sub Form1_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
    tbMonitor.ScrollBars = ScrollBars.Both
    AccessEntries = New List(Of String)
    fw = New FileSystemWatcher
    fw.Path = "C:\temp"
    fw.NotifyFilter = NotifyFilters.LastWrite Or NotifyFilters.LastAccess Or NotifyFilters.FileName
    AddHandler fw.Changed, AddressOf Changed
    AddHandler fw.Created, AddressOf Changed
    AddHandler fw.Renamed, AddressOf Changed
    fw.EnableRaisingEvents = True
End Sub

Private Sub Form1_FormClosed(ByVal sender As Object, ByVal e As System.Windows.Forms.FormClosedEventArgs) Handles Me.FormClosed
    fw.EnableRaisingEvents = False
    RemoveHandler fw.Changed, AddressOf Changed
    RemoveHandler fw.Created, AddressOf Changed
    RemoveHandler fw.Renamed, AddressOf Changed
    fw.Dispose()
End Sub
End Class 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-04-06T14:40:46.100

我做了一个简单的类，对我来说很好。它可能对其他人有用。

```
using System;
using System.IO;
using System.Timers;

namespace Demo
{
    class FileWatcher
    {
        private FileSystemWatcher watcher = new FileSystemWatcher();
        private Timer t = new Timer();

        public event EventHandler FileChanged;

        public FileWatcher()
        {
            t.Elapsed += new System.Timers.ElapsedEventHandler(t_Elapsed);
            t.Interval = 1000;
        }

        public void Start(String path)
        {
            watcher.Path = Path.GetDirectoryName(path);
            watcher.Filter = Path.GetFileName(path);
            watcher.NotifyFilter = NotifyFilters.LastWrite | NotifyFilters.CreationTime;
            watcher.EnableRaisingEvents = true;
            watcher.Changed += new FileSystemEventHandler(watcher_Changed);
        }

        void watcher_Changed(object sender, FileSystemEventArgs e)
        {
            if (!t.Enabled)
                t.Start();
        }

        void t_Elapsed(object sender, System.Timers.ElapsedEventArgs e)
        {
            t.Stop();
            if (FileChanged != null)
                FileChanged(this, null);
        }
    }
} 
```

可以这样使用：

```
FileWatcher FileWatcher1 = new FileWatcher();
FileWatcher1.FileChanged += new EventHandler(FileWatcher1_FileChanged);
FileWatcher1.Start("c:\test.txt"); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-05-25T17:38:44.627

这是 FindFirstChangeNotification() Win32 API 从第一天（从 Windows 3.x 开始）以来的一个令人抓狂的怪癖，看起来 FileSystemWatcher 只是简单地包装了该 API。计时器方法（如上所示）是常见的解决方法。

我通常创建一个包装 FileSystemWatcher 并进行多次更改调用过滤的类。编写一些额外的工作，但它在重用中得到了回报。

```
public class FileChangeMonitor
{
    private FileSystemWatcher _fsw;
    DateTime _lastEventTime;

    public event FileSystemEventHandler Changed;

    public FileChangeMonitor(string path, string filter)
    {
        _fsw = new FileSystemWatcher(path, filter);
        _fsw.Changed += new FileSystemEventHandler(_fsw_Changed);
        _fsw.EnableRaisingEvents = true;
        _fsw.NotifyFilter = NotifyFilters.LastWrite;
        _fsw.IncludeSubdirectories = false;
    }

    private void _fsw_Changed(object sender, FileSystemEventArgs e)
    {
        // Fix the FindFirstChangeNotification() double-call bug
        if (DateTime.Now.Subtract(_lastEventTime).TotalMilliseconds > 100)
        {
            _lastEventTime = DateTime.Now;
            if (this.Changed != null)
                this.Changed(sender, e);  // Bubble the event
        }
    }
} 
```

然后，您可以像使用 FileSystemWatcher 一样使用 FileChangeMonitor：

```
FileChangeMonitor fcm = new FileChangeMonitor(path, filter);
fsm.Changed += new FileSystemEventHandler(fsm_Changed);
... 
```

当然，上面的代码只处理 Changed 事件和 NotifyFilters.LastWrite，但你明白了。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-06-09T01:41:58.983

平台独立技巧：

```
// Class level variable
bool m_FileSystemWatcherIsMessy = true;

// inside call back
if (m_FileSystemWatcherIsMessy) {
    m_FileSystemWatcherIsMessy = false;
    return;
} else {
    m_FileSystemWatcherIsMessy = true;
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-04-30T20:00:17.607

如果您需要在表单上发生更改事件时显示它们，那么您需要使用线程。Eric 的解决方案在这方面是最好的，因为它可以很容易地使用或不使用使解决方案最灵活的形式。它还可以很好地处理多个重复事件，并确保仅当它用于相同的文件时才吃重复事件。在公认的解决方案中，如果两个文件几乎同时更改，其中一个事件可能会被错误地忽略。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-03-05T18:00:06.053

Frederik 的解决方案是迄今为止我遇到的最好的解决方案。但是我发现 500 毫秒太慢了。在我的应用程序中，用户可以在 0.5 秒内轻松对文件执行两个操作，因此我将其降低到 100，到目前为止一切正常。他的 C# 有点 fubar（它不会转换）所以这里是 VB 版本：

```
Public LastTimeFileWatcherEventRaised As DateTime 
```

* * *

```
If DateTime.Now.Subtract(LastTimeFileWatcherEventRaised).TotalMilliseconds < 100 Then Return

LastTimeFileWatcherEventRaised = DateTime.Now

.. handle event here 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-09-12T06:17:16.070

我用上面的 LAOS 示例启发了我的解决方案。我为文件夹实现了一个观察器，每次触发它时，我都会停止一个计时器并再次启动它来重置它。我仅在计时器结束时触发我的操作，这会阻止观察者触发两次操作以创建文件。根据要求，它在 VB.Net 中：)

```
 <PermissionSet(SecurityAction.Demand, Name:="FullTrust")> Public Sub StartWatcher()

    Dim watcher As FileSystemWatcher = New FileSystemWatcher()
    watcher.Path = _MWVM.TemplatesFolder

    'Watch for changes in LastWrite times, And the renaming of files Or directories. 
    watcher.NotifyFilter = NotifyFilters.LastWrite Or NotifyFilters.FileName Or NotifyFilters.DirectoryName

    ' Only watch text files.
    watcher.Filter = "*.txt"

    'Define timer to 100 ms
    WatcherTimer.Interval = New TimeSpan(0, 0, 0, 0, 100) '100 ms

    ' Add event handlers.
    AddHandler watcher.Changed, AddressOf WatcherHandler
    AddHandler watcher.Created, AddressOf WatcherHandler
    AddHandler watcher.Deleted, AddressOf WatcherHandler
    AddHandler watcher.Renamed, AddressOf WatcherHandler

    ' Begin watching
    watcher.EnableRaisingEvents = True

End Sub

'Instantiate a timer which will prevent the 
Private WithEvents WatcherTimer As New System.Windows.Threading.DispatcherTimer
Private xmlFileChangedEvents As New Dictionary(Of String, FileSystemEventArgs)

Private Sub WatcherHandler(ByVal Sender As Object, ByVal e As FileSystemEventArgs)
    WatcherTimer.Stop() 'Reset the timer
    WatcherTimer.Start()
End Sub

Private Sub WatcherTimer_Tick(ByVal Sender As Object, ByVal e As EventArgs) Handles WatcherTimer.Tick
    WatcherTimer.Stop()
    PopulateMailTemplateList()
End Sub 
```

# c# - 支持 7zip (LZMA) 的 C# 免费压缩库

> ID：449998
> 
> 赞同：19
> 
> 时间：2009-01-16T10:21:15.760
> 
> 标签：c#, compression, 7zip, lzma

我有一个程序（用 C# 编写）直接读取/写入其数据（无需服务器直接访问文件）到 firebird 数据库文件。为了更好的交换，我想在导入/导出时（解）压缩它们，以便在 Internet 上进行更好的交换，而不需要外部程序来（解）压缩它们。

我知道[#ziplib](http://www.sharpdevelop.com/OpenSource/SharpZipLib/Default.aspx)支持 Zip、GZip、Tar 和 BZip2。

您还知道哪些 C# 的免费压缩库？是否有支持 LZMA 的 .NET 库，以便我可以读/写“.7z”文件？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-16T10:26:33.830

7-zip 有一个免费的源代码，用于 LZMA 算法的公共域 C# SDK：

[http://www.7-zip.org/sdk.html](http://www.7-zip.org/sdk.html)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-01-16T10:27:18.523

Peter Bromberg 写了一篇很好的文章：

[使用 C# 进行 7Zip (LZMA) 内存压缩](https://web.archive.org/web/20081207080706/http://www.eggheadcafe.com:80/tutorials/aspnet/064b41e4-60bc-4d35-9136-368603bcc27a/7zip-lzma-inmemory-com.aspx)

> 展示了一个简单的 C# `SevenZip.Compression.Lzma.SevenZipHelper` 类，用于使用 C# 对内存中的对象进行高压缩。向先前发布的 CookieCompression 实用程序添加新的 7Zip 格式 LZMA Cookie 压缩类。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-23T00:08:27.563

你可以试试[SevenZipSharp](http://www.codeplex.com/sevenzipsharp)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-16T10:29:09.610

这似乎是一个鲜为人知的事实，但 .NET 库包含[打包/压缩 API](http://msdn.microsoft.com/en-us/library/system.io.packaging.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-16T10:29:13.637

如果您正在编写单个文件，那么您可以将其视为流并使用内置[`GZipStream`](http://msdn.microsoft.com/en-us/library/system.io.compression.gzipstream.aspx)/ [`DeflateStream`](http://msdn.microsoft.com/en-us/library/system.io.compression.deflatestream.aspx)（尽管在我所做的一些测试中，#ZipLib 在比率和速度方面都优于 MS 产品）。或者在框架的某处有内置的 zip 支持。不过，我不知道 LZMA。****