# StackOverflow 问答 000123000-000123999

# html - 在同一窗口或新（选项卡）中打开链接

> ID：123000
> 
> 赞同：0
> 
> 时间：2008-09-23T18:52:52.587
> 
> 标签：html, user-interface, usability

在同一窗口中打开链接一直是最佳做法。现在大多数常见的浏览器都使用标签，这仍然是规则吗？就个人而言，我更喜欢关闭标签/窗口而不是点击后退按钮。你觉得呢？你有没有什么想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T18:59:16.767

如果您更喜欢关闭选项卡/窗口而不是单击后退按钮，那么请务必使用鼠标中键单击链接。但请不要将您的冲浪偏好强加于他人。选项卡丝毫不会改变这一原则。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T18:57:13.153

我认为一致性是要记住的最重要的事情。浏览器开始提供在多个选项卡中打开链接的方法，而不管网站的设计决策如何，因此保持与其他网站相似的功能可能是最大的问题。

您确实希望您网站的核心功能表现得与您的用户访问的其他网站一样，这样他们才会感到舒适，并且不会浪费时间试图找出差异。

也就是说，有时您应该打开一个新窗口/选项卡而不是在当前窗口/选项卡中打开一个链接。例如，如果两个页面（当前页面和链接页面）确实需要同时查看）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T18:54:27.900

是的，应该是一样的。新选项卡或多或少是一个新窗口，它恰好与原始选项卡位于同一个父容器中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T18:58:43.787

我们是否在讨论离开您网站的链接？我们公司的福利提供商有一个网站，用于管理我们的灵活支出账户。从我登录到到达提交索赔的页面，它会打开 3 个单独的窗口。在网站内导航时，我从来都不喜欢打开新标签/窗口。

想法？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-11T04:01:18.893

一些浏览器在被要求打开一个新窗口（*gasp*）时实际上会打开一个新窗口，**即使它们支持 tabs**。我通常打开两个或三个不同的浏览器窗口，每个窗口都有许多按任务分组的选项卡。如果某个站点意外地强制我打开一个新窗口，如果我想保持任务分组，我现在必须将其作为选项卡重新集成到我打开的窗口之一中。**这是一个主要的烦恼。**

如果我想在新标签中打开某些东西，我可以自己做，非常感谢。不要试图为用户着想。我唯一可以接受/期待新窗口的情况是原始站点需要保持打开状态，例如因为我在表单中输入文本但需要打开“更多信息”窗口（请参阅 StackOverflow 回答帮助按钮）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T18:54:37.183

我会因为打开的标签数量而磨损我的滚轮按钮。有一个很棒的 Firefox 扩展，可以让你通过一个按键关闭当前标签，我已经分配给它，所以很容易快速关闭标签。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T18:56:20.097

我认为它仍然在个人喜好的范围内，但根据我正在浏览的内容，我发现越来越多的我在新标签中打开链接。当我阅读一个包含很多相关链接的页面时，我会经常这样做，但我想先读完主页。这样，当我完成后，我可以查看所有这些链接，而不是尝试使用后退按钮返回。

# inversion-of-control - 如果您使用控制反转，构造函数的大小是否重要？

> ID：123002
> 
> 赞同：4
> 
> 时间：2008-09-23T18:53:13.270
> 
> 标签：inversion-of-control

所以我可能有 10 个对象，每个对象都有 1-3 个依赖项（就松散耦合而言，我认为这是可以的），还有一些可用于定义行为的设置（超时、窗口大小等）。

现在，在我开始使用控制反转容器之前，我会为每个需要超过 1 个设置的对象创建一个工厂，甚至可能是一个简单的 ObjectSettings 对象，以将构造函数的大小保持在推荐的“小于 4”参数尺寸。我现在正在使用控制容器的反转，我只是看不到它的全部意义。当然我可能会得到一个有 7 个参数的构造函数，但谁在乎呢？无论如何，这一切都由国际奥委会填写。

我在这里遗漏了什么还是这基本上是正确的？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-26T21:47:50.647

在阅读这个问题之前，我没有想到类复杂性和 IoC 构造函数的大小之间的关系，但我在下面的分析表明，在 IoC 构造函数中有很多参数是使用 IoC 时需要注意的[代码味道。](https://stackoverflow.com/questions/114342/what-are-code-smells-what-is-the-best-way-to-correct-them)以坚持简短的构造函数参数列表为目标将帮助您保持类本身的简单。遵循[单一责任原则](https://stackoverflow.com/questions/15412/is-single-responsibility-principle-a-rule-of-oop)将引导您实现这一目标。

我在一个系统上工作，该系统目前有 122 个使用 Spring.NET 框架实例化的类。这些类之间的所有关系都在它们的构造函数中设置。诚然，在我违反了一些规则的情况下，该系统的代码并不完美。（但是，嘿，我们的失败是学习的机会！）

这些类的构造函数有不同数量的参数，我在下表中显示。

```
Number of constructor arguments    Number of classes
           0                             57
           1                             19
           2                             25
           3                              9
           4                              3
           5                              1
           6                              3
           7                              2
           8                              2 
```

具有零参数的类要么是具体的策略类，要么是通过向外部系统发送数据来响应事件的类。

带有 5 或 6 个参数的那些都有些不雅，可以使用一些重构来简化它们。

具有 7 或 8 个参数的四个类是[上帝对象](http://en.wikipedia.org/wiki/God_object)的极好例子。它们应该被分解，并且每个都已经在我系统内的故障点列表中。

其余的类（1 到 4 个参数）（大部分）设计简单，易于理解，并符合[单一职责原则](https://stackoverflow.com/questions/15412/is-single-responsibility-principle-a-rule-of-oop)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T19:10:17.410

对许多依赖项（可能超过 8 个）的需求可能表明存在设计缺陷，但总的来说，我认为只要设计具有凝聚力，就没有问题。

此外，考虑使用服务定位器或静态网关来解决基础设施问题，例如日志记录和授权，而不是弄乱构造函数参数。

编辑： 8 可能太多了，但我认为会有奇怪的情况。看了李的帖子后，我同意，1-4 通常是好的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T19:01:03.907

乔治，

首先，对象之间的依赖关系是什么？

很多“ISA”关系？很多“hasa”关系？

粉丝多吗？还是扇出？

乔治的回应：“一直以来，一直在尝试遵循组合而不是继承建议……但这有什么关系呢？”

因为它主要是“hasa”，所以你应该没事。

最好确保正确完成组件的构造（和销毁），以防止内存泄漏。

而且，如果这是在 C++ 中，请确保使用虚拟析构函数？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T19:10:31.217

这是一个艰难的方法，为什么我喜欢一种混合方法，其中适当的属性是可变的，只有不可变的属性和没有有用默认值的必需依赖项是构造函数的一部分。有些类是用基本要素构建的，然后在必要时通过设置器进行调整。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-31T21:16:46.850

这一切都取决于您用来执行 IOC 的容器类型以及容器采用什么方法，是否使用注释或配置文件来使要实例化的对象饱和。此外，如果您的构造函数参数只是简单的原始数据类型，那么这并不是什么大问题；但是，如果您有非原始类型，那么在我看来，您可以使用基于属性的 DI 而不是基于构造函数的 DI。

# java - 确定 JSF 容器表单的 ID

> ID：123003
> 
> 赞同：3
> 
> 时间：2008-09-23T18:53:20.557
> 
> 标签：java, jsf, seam, facelets

我需要从动作处理程序中确定表单字段的 ID。该字段是包含的 facelets 组件的一部分，因此形式会有所不同。

**包含的.xhtml**

```
<ui:component>
  <h:inputText id="contained_field"/>
  <h:commandButton actionListener="#{backingBean.update}" value="Submit"/>
</ui:component> 
```

**示例_包含.xhtml**

```
<h:form id="containing_form">
  <ui:include src="/included.xhtml"/>
</h:form> 
```

如何`update`在运行时确定方法中表单的 ID？或者更好的是，直接输入字段的 ID。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T19:25:15.643

将按钮绑定到您的支持 bean，然后使用 getParent() 直到找到最近的表单。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T13:12:18.503

以编程方式，我会使用 jsight 的方法。通过查看元素，您可以知道元素的 id（除非您让 JSF 创建它们，否则我不知道在 id 中编号的方法）。h:form 是一个命名容器，所以只要你没有将它包装在另一个命名容器中，它将包含Form:containedfield ':' 是命名分隔符，默认情况下是 JSF，id 是这样创建的，大致无论如何, (parentNamingContainerId:)*componentId

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T19:06:04.217

由于 update 方法是 actionListener 类型，您可以按如下方式访问您的 UI 组件

```
public void update(javax.faces.event.ActionEvent ac) {
      javax.faces.component.UIComponent myCommand = ac.getComponent( );
      String id = myCommand.getId(); // get the id of the firing component

      ..... your code .........

} 
```

# ms-access - Microsoft Access - 将多个字段加在一起的总计

> ID：123007
> 
> 赞同：1
> 
> 时间：2008-09-23T18:54:16.437
> 
> 标签：ms-access, builder

我无法完全弄清楚这一点。Microsoft Access 2000，在报告总计部分我有三列的总计，它们只是数字。这些`=Sum[(ThisColumn1)], 2, 3`，等等以及那些盛大的totls都可以正常工作。

我想有另一列说`=Sum([ThisColumn1])+Sum([ThisColumn2]) + Sum([ThisColumn3])`但无法弄清楚那些。只是得到一个空白，所以我确定有一个错误。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T18:56:14.527

给 3 个总计有意义的控件名称，然后为总计使用：

```
=[GrandTotal1] + [GrandTotal2] + [GrandTotal3] 
```

您的总计公式应类似于：

```
=Sum(Nz([ThisColumn1], 0)) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T15:13:52.930

NULL 值通过表达式传播，这意味着如果您的三个小计中的任何一个为空白，则最终总计也将为空白。例如：

空 + 10 = 空

Access 有一个内置函数，可用于将 NULL 值转换为零。

新西兰（字段名，ValueIfNull）

您可以在报告、查询、表单和 VBA 中使用 NZ。

所以上面的例子可以这样写：

=NZ([GrandTotal1],0) + NZ([GrandTotal2],0) + NZ([GrandTotal3],0)

[http://office.microsoft.com/en-us/access/HA012288901033.aspx](http://office.microsoft.com/en-us/access/HA012288901033.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T18:58:00.170

创建一个新的查询，sql应该是这样的：

```
SELECT SUM(Column1 + Column2 + Column3),
       SUM(Column1),
       SUM(Column2),
       SUM(Column3),
  FROM Your_Table; 
```

# c++ - 你使用 Qt，你为什么使用它？

> ID：123012
> 
> 赞同：29
> 
> 时间：2008-09-23T18:55:03.593
> 
> 标签：c++, qt, qt-jambi

优点。和缺点？你用了多久？詹比呢？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-09-24T13:35:48.783

几年来我一直在使用 Qt 进行商业开发，并且对它非常满意。

Qt 的优点之一是它提供了大量的库以及 GUI 东西（例如 XML 解析、线程、网络），所有这些都采用一致的风格和多平台。这意味着我们很少需要使用其他库，尽管我们确实在某些事情上使用了 boost。

对我们来说，另一个非常重要的因素是国际化。在以前的基于 MFC 的应用程序中，我们必须为我们支持的两种语言维护 2 个本地化版本。在我们基于 Qt 的应用程序中，我们只有一个版本。

*   Qt 翻译系统，使用 linguist 使用方便，支持多种语言也很容易（当然你还得翻译字符串，这工作量很大！）
*   小部件根据布局调整自身大小的 GUI 布局系统使一切变得更加容易。在不同的语言中，字符串的长度是不同的。对于固定大小的小部件（如 MFC），每个对话框都需要针对每种语言进行调整，否则部分标签会被截断。使用 Qt，他们调整自己的大小。当然，在某些情况下它不能完全正确地工作，但它仍然使一切变得容易得多。
*   QString 用 Unicode 做所有事情，并且很容易处理来自不同编解码器的转换。

非常有价值的一件事是对源代码的访问，尽管这肯定不是 Qt 独有的。在某些情况下，检查 Qt 源代码的能力解释了一些奇怪的行为或给出了如何实现某事的线索。

我们在 Qt 中发现了一些错误，其中一些已在向 Trolltech 报告后得到修复。在其他情况下，他们建议解决问题。这些都相当模糊，对我们的发展没有重大影响。

Qt 的主要缺点之一是缺少用于商业应用程序的 3rd 方库。但是，Qt 相当完整，所以对我们来说这不是一个大问题，尽管这取决于您正在开发的应用程序类型。

我也没有用过占碑。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-23T19:02:18.397

在七年的时间里，我在几个平台上用 C++ 完成的几个项目中使用了 Qt。我认为它工作得很好，而且我在 Mac 上开发一个像样的 GUI 应用程序肯定比通过一种我当时不知道的语言 (Objective-C) 来得更快。

我认为信号/槽机制有点时髦，但并不可怕。一旦你使用它一段时间，它就不是一个展示停止器。连接的东西很容易搞砸（或者至少是这样），检查这些东西的回报总是好的，因为你的应用程序会愉快地运行，而不是告诉你它没有工作。

我从来没有用过jambi。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-14T20:05:40.590

以下是我使用 Qt 的一些优点和缺点：

**优点：**
跨平台
我知道这个总是被使用，但是在使用 Qt 在 Windows 和 Linux 之间来回切换之后，令人惊讶的是，我只需要做很少的事情就可以启动和运行。我认为这得益于我只将 Vim 与 Qt Designer 一起使用。

[QMake](http://doc.trolltech.com/4.4/qmake-manual.html)
这是我最喜欢的 Qt 方面之一。在 wxWidgets、FLTK 等工作之后，我厌倦了使用不同的构建系统，我不想手动创建我的 makefile。我目前在 Qt 以外的任何东西上都使用 CMake，但我认为我什至正在慢慢地将 Qt 转移到 CMake。然而，使用 QMake 非常容易。

[QTestLib](http://doc.trolltech.com/4.4/qtestlib-manual.html)
我查看了其他几个 C++ 单元测试框架，当我使用 QTestLib 创建测试时，感觉它与 NUnit(C#) 非常相似，并且在几分钟内我就有了几个通过测试。我还注意到创建自己的[持续集成](http://en.wikipedia.org/wiki/Continuous_integration)环境非常容易。

最接近 Java 和 .Net 的生产力
我听到/读到的关于 C++ 的最重要的话是，“我可以使用 Java 或 .Net 提高生产力”。根据个人经验，在 Eclipse 或 Visual Studio 加载之前，我可以使用 Vim 和 Qt Designer 获得在 Qt 中运行的应用程序原型。我还在 Qt 中获得了一组与 .Net 或 Java 中非常相似的库，如果不存在，我可以利用现有的 C++ 代码。

**缺点**：
价格
这是我现在能想到的最大因素。然而，成本是值得的每一分钱，嗯，如果我知道在不打电话给销售代表的情况下我必须节省多少美分的话。我在他们有小企业折扣的那天买了一个许可证，那是值得的，我会支付三倍的钱，我认为这是目前的价格。

使用商业许可在任何地方开发
我希望能够在任何平台上进行开发，但可以为另一个平台构建和销售。例如，在 Linux 上开发，然后在 Windows 上构建和部署（如果您只有 Windows 商业许可证）。据我所知，您只能在您拥有许可的平台上开发和构建商业应用程序。

供应商锁定
好吧，这更像是个人的骗局。我不喜欢与特定的供应商联系，因为我会被公司方向和产品方向跟踪。奇趣科技被诺基亚收购了，这是好是坏我不知道，但是这么大的公司可以做坏事。

我想我现在已经完成了:)。哦，我没有使用过 Jambi，但我真的很想做几个原型项目，以了解使用 C++ 开发的插件和 Jambi 是多么容易。尤其是使用 Jambi 作为带有 C++ 插件的 Web 界面。

老实说，我没有阅读太多关于它的内容，所以这可能是不可能的或非常容易的。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-26T00:24:21.943

我在以前的工作中使用过 Qt。在那之前的几年里，我只与 Qt 有过最短暂的接触，所以我几乎是一个 Qt 新手。

当我开始时，我被告知要选择我的语言和环境，但跨平台支持是可取的。我尝试了 Qt 和 Java，甚至尝试了 C#。我给自己两天时间来评估每个选项。

也许我对我作为 C++ 开发人员的历史略有偏见，但在每个选项上花费了时间之后，Qt 是唯一一个在没有长时间学习曲线的情况下显示出有用的提示的唯一一个。

Qt 提供的文档和示例应用程序使经验丰富的开发人员非常容易，但 Qt 初学者可以非常轻松地快速启动和运行。在试用期结束时，我完成了最终应用程序的 UI 原型/模型。在使用 Java/Eclipse、Java/SunStudio 和 C#/VS.net 时，我很难在那个时候遇到任何不平凡的事情。

Signals/slots 需要一些时间来适应，但还不错，我编写了一些简单的包装器来断言连接无法阻止愚蠢的拼写错误停止应用程序。从工作。

我喜欢的另一件事是 Qt 几乎拥有我需要的一切。你可以命名它——存储、网络、GUI、线程、容器——Qt 有一个类来处理它。哪个恕我直言很重要，因为混合库有时会导致问题。

拥有 Qt 的源代码是一大优势，只是出于兴趣，它还允许我使用我选择的编译器和设置来编译 Qt，包括在开发期间使用的调试版本。

我还发现奇趣科技的支持相当不错。我在 Qt 上提出了几个错误，其中一个在我仍在从事该项目（仅 6 个月的工作）时已修复并发布。

我能记得的唯一负面因素是调试 Qt 对象（使用 VS）的困难 - 有一个用于 VS 的 Qt 插件可以检查 Qt 对象，但我使用的是 VS 的免费版本，插件不适用于它。但这不是 Qt 的错。

我没用过jambi，所以不能评论。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T00:16:10.653

在 C++ 上，您唯一的其他选择是 MFC 和 wxWidgets。QT/wxWidgets 很大程度上是个人喜好。我确实认为 QT 是一个干净的设计，具有良好的文档。
如果你不将 QT 用于 GPL，它会花费大约 1 个月的开发人员工资。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-25T21:50:56.947

我已经使用 Qt 两年多了。

我在 Qt 上喜欢的东西是：

*   简单的 GUI 编程（与 MFC 相比），Qt Designer
*   漂亮的容器类
*   不错的图形场景框架
*   带有有用示例的优秀文档
*   翻译支持
*   良好的技术支持

我强烈推荐[Qt Developer Days](http://trolltech.com/qtdevdays2008/ "Qt 开发者日")。如果你有机会参加，那就去做吧！那里有很多精彩而有趣的谈话。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T00:05:04.317

Qt 是一个非常好的库，但它具有昂贵的单机开发许可证，因此它并不总是对所有项目都有用。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-03-30T12:53:30.957

但是不要使用它...

优点：QT 有一个可选的 3 阶段布局，而 WX 目前只允许 2 个（我相信他们计划做 3 阶段，只是还没有工作）。

使用布局的最大问题之一是静态文本和换行。WX 询问您的最小宽度/高度和屏幕部分有多大，QT 可以选择说您想要多宽，如果您的 X 宽，您需要多高。这使您可以更好地表达页面的流程。

# ruby-on-rails - 回调是否会停止 Rails 中的操作

> ID：123021
> 
> 赞同：1
> 
> 时间：2008-09-23T18:56:04.200
> 
> 标签：ruby-on-rails, ruby, callback

如果回调处理程序返回 false，是否只导致*该*回调的处理程序不被调用，或者它是否导致该处理程序中的剩余回调以及所有后续回调也不被调用？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T19:34:38.430

如果 before_* 回调返回 false，则所有后面的回调和相关操作都将被取消。如果 after_* 回调返回 false，则后面的所有回调都将被取消。回调通常按照定义的顺序运行，但定义为模型上的方法的回调除外，这些方法最后调用。

cf [http://api.rubyonrails.org/classes/ActiveRecord/Callbacks.html](http://api.rubyonrails.org/classes/ActiveRecord/Callbacks.html)

# php - Oracle全局临时表/PHP交互题

> ID：123039
> 
> 赞同：0
> 
> 时间：2008-09-23T18:58:42.727
> 
> 标签：php, oracle, oci8

我从未使用过全局临时表，但是我有一些疑问，它们将如何在 php 环境中工作。

数据如何共享：假设使用 oci8 通过 php 持久连接到 oracle。数据是否与数据库 ID 相关联？它是基于 Apache httpd 恶魔完成的吗？还是每个单独的请求都是独一无二的？

会话的数据何时从全局临时表中清除？我假设（或者更确切地说希望）它在 php 脚本退出时完成。或者，如果不是，我假设我需要在脚本退出之前将其删除。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T19:15:18.133

全局临时表只是表结构（名称、列名、列数据类型等）的逻辑定义。当会话通过插入数据来引用它时，会在临时表空间中创建一个数据段以仅保存该会话的数据。因此，不同的会话可以引用相同的逻辑表定义，因为它们每个都有自己的专用数据段，可以在提交或会话断开连接时轻松清除这些数据段，而不会影响其他会话。

GTT 中数据的清除可以在提交时或在会话结束时进行，具体取决于创建时使用的选项。在任何一种情况下，您都不必在断开连接之前亲自进行清洗。

GTT 的一个有用替代方案是子查询分解子句（“WITH”），您可以在其中创建多个关系，这些关系可以引用之前在该 SQL 语句中声明的关系。这些可以在临时表空间中作为数据段实现，当它们超过一定的内存使用时由 Oracle 自动实现，或者通过使用 MATERIALIZE 优化器提示手动实现。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T19:10:48.080

如果我没记错的话，全局临时表中的数据只能从一个活动会话中获得，并且只能用于这个活动会话（我的意思是会话 = 连接）。因此，您只能看到之前在活动会话中插入的数据。因此我相信，这些数据在结束会话后被清除。无论您使用哪种语言。

至少我是这么认为的。:D

正如这里所写： [http ://www.oracle-base.com/articles/8i/TemporaryTables.php](http://www.oracle-base.com/articles/8i/TemporaryTables.php)

全局临时表中的数据是私有的，因此会话插入的数据只能由该会话访问。

临时表中的数据会在数据库会话结束时自动删除，即使它异常结束。

对不起，我的英语不好。

# sql-server - 如何修复 SQL Server 2008 中的跨语言安装问题？

> ID：123052
> 
> 赞同：12
> 
> 时间：2008-09-23T19:00:31.803
> 
> 标签：sql-server, sql-server-2008

我正在尝试进行 SQL Server 2008 设置，但遇到了跨语言安装失败。进一步来说：

规则“跨语言安装：失败。安装语言与现有 SQL Server 功能的语言不同。要继续，请使用与已安装的 SQL Server 功能相同语言的 SQL Server 安装程序安装介质。

我没有安装 SQL Server Express，我浏览了“添加或删除程序”，但找不到任何看起来像是以前版本的 SQL 的东西。

有小费吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-07-12T10:06:21.987

遇到同样的问题后我重新启动了设置，我意识到在设置过程完成之前，人不应该关闭安装中心。如果您将其打开，它将起作用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T19:54:58.893

确保您已卸载所有旧 SQL Server 版本。此外，如果您在开始安装时没有这样做，则*必须重新启动安装程序。*

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-09-23T21:30:57.180

我所要做的就是退出安装程序并重新开始该过程。由于某种原因，它第二次起作用了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T21:53:20.083

我今天在从未安装过 SQL Server 实例的计算机上安装 SQL Server 2008 Express 时遇到了同样的问题。

我发现安装了“Microsoft SQL Server 2005 向后兼容性”。我通过添加/删除程序删除了它，之后能够成功安装 SQL Server 2008 Express。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-04-30T04:57:09.977

将当前 Windows 语言界面更改为您要安装的所需语言。这将使安装程序可以启动本地化版本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T19:50:20.217

如果您以前在机器上安装过 SQL（或者显然是一些 RedGate 工具），您是否检查过注册表中的任何 SQL 碎屑？

如果没有，那么[MS 论坛](https://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3493955&SiteID=1)有一些需要注意的 reg 键的详细信息，并且一些链接值得关注，以获取有关从注册表中删除什么的建议。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-20T05:09:44.727

在我安装 Sql Server 2008 Express 时，这是因为在尝试安装 2008 时安装了 Sql Server 2005 Express Tools。卸载 2005 Tools 解决了这个问题。我能够保持 Sql Server 2005 Express，包括 Sql Server 2005 向后兼容；只需要核武器工具。

# database - 如何避免使用 LINQ-To-SQL 的内存泄漏？

> ID：123057
> 
> 赞同：22
> 
> 时间：2008-09-23T19:01:17.993
> 
> 标签：database, linq, linq-to-sql, memory-management, memory-leaks

我在使用 LINQ-To-SQL 时遇到了一些关于内存使用的问题。我在 Windows 服务中使用它来进行一些处理，并且我正在循环访问从上下文中拉回的大量数据。是的 - 我知道我可以使用存储过程来做到这一点，但有一些原因表明这不是一个理想的解决方案。

无论如何，我看到的基本上是即使在我调用之后内存也没有被释放`context.SubmitChanges()`。所以我最终不得不做各种奇怪的事情，比如一次只拉回 100 条记录，或者创建多个上下文并让它们都执行单独的任务。如果我保持相同`DataContext`并稍后将其用于其他调用，它只会占用越来越多的内存。即使我调用查询返回给我`Clear()`的 " " 数组，将其设置为 null，然后调用- 它仍然不会释放内存。`var tableRows``SYstem.GC.Collect()`

现在我已经阅读了一些关于如何快速使用`DataContexts`并快速处理它们的内容，但似乎它们应该是一种强制上下文转储其所有数据（或特定表的所有跟踪数据）的方法一定要保证内存是空闲的。

任何人都知道哪些步骤可以保证内存被释放？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-23T19:04:36.567

DataContext 跟踪它曾经获取的所有对象。在垃圾收集之前它不会释放它。此外，当它实现`IDisposable`时，您必须调用`Dispose`或使用该`using`语句。

这是正确的方法：

```
using(DataContext myDC = new DataContext)
{
  //  Do stuff
} //DataContext is disposed 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-23T19:11:20.263

如果您不需要对象跟踪，请将**DataContext.ObjectTrackingEnabled**设置为*false*。如果您确实需要它，您可以使用反射来调用内部**DataContext.ClearCache()**，尽管您必须知道，由于它是内部的，它可能会在框架的未来版本中消失。据我所知，框架本身并没有使用它，但它*确实*清除了对象缓存。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-23T19:25:09.123

正如 Amy 指出的那样，您应该使用 using 块处理 DataContext。

看来您主要关心的是创建和处理一堆 DataContext 对象。这就是 linq2sql 的设计方式。DataContext 的生命周期很短。由于您要从数据库中提取大量数据，因此会占用大量内存是有道理的。通过分块处理数据，您走在正确的轨道上。

不要害怕创建大量的 DataContexts。它们旨在以这种方式使用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T14:40:08.940

谢谢大家 - 我会检查 ClearCache 方法。只是为了澄清（对于未来的读者），我得到内存使用的情况是这样的：

```
using(DataContext context = new DataContext())
{
   while(true)
   {
      int skipAmount = 0;
      var rows = context.tables.Select(x => x.Dept == "Dept").Skip(skipAmount).Take(100);

      //break out of loop when out of rows

      foreach(table t in rows)
      {
         //make changes to t   
      }

      context.SubmitChanges();
      skipAmount += rows.Count();

      rows.Clear();
      rows = null;

      //at this point, even though the rows have been cleared and changes have been
      //submitted, the context is still holding onto a reference somewhere to the
      //removed rows.  So unless you create a new context, memory usuage keeps on growing
   }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-09-16T11:51:35.450

我刚刚遇到了类似的问题。**就我而言，帮助将DataContext.ObjectTrackingEnabled**的属性设置 为 false。但它仅适用于遍历行的情况，如下所示：

```
using (var db = new DataContext())
{
    db.ObjectTrackingEnabled = false;
    var documents = from d in db.GetTable<T>()
                     select d;
    foreach (var doc in documents)
    {
        ...
    }
} 
```

例如，如果在查询中使用 ToArray() 或 ToList() 方法 - 无效

# sql - Pervasive SQL 中的分页

> ID：123075
> 
> 赞同：0
> 
> 时间：2008-09-23T19:04:06.753
> 
> 标签：sql, pervasive

如何在 Pervasive SQL（9.1 版）中进行分页？我需要做类似的事情：

```
//MySQL
SELECT foo FROM table LIMIT 10, 10 
```

但我找不到定义偏移量的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-05-11T15:03:34.517

在 PSQL 中测试查询：

```
select top n * 
from tablename 
where id not in(
select top k id
from tablename 
) 
```

对于所有 n = no.of 记录，您需要一次获取。并且 k = n 的倍数（例如 n=5；k=0,5,10,15,....）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T03:20:02.867

我们的分页要求我们能够将当前页码和页面大小（以及一些额外的过滤器参数）作为变量传递。由于 select top @page_size 在 MS SQL 中不起作用，我们想出一个临时表或变量表来为每行主键分配一个标识，以后可以根据所需的页码和大小对其进行过滤。

** 请注意，如果您有 GUID 主键或复合键，则只需将临时表上的对象 id 更改为唯一标识符或将附加键列添加到表中。

这样做的缺点是它仍然必须将所有结果插入到临时表中，但至少它只是键。这适用于 MS SQL，但应该能够以最小的调整适用于任何数据库。

> 声明 @page_number int, @page_size int -- 在此处添加任何其他搜索参数
> 
> -- 创建带有标识列和 id 的临时表
> -- 您将选择的记录。这是一个内存中的
> --table，所以如果您要插入的行数大于
> 10,000，那么您应该使用 tempdb 中的临时表 -- 而
> 不是。为此，请使用
> --CREATE TABLE #temp_table (row_num int IDENTITY(1,1), objectid int)
> --并将所有对 @temp_table 的引用更改为 #temp_table
> DECLARE @temp_table TABLE (row_num int IDENTITY(1,1) , objectid int)
> 
> --插入带有记录ID的临时表--
> 我们要返回。确保通过
> --reflects 的顺序返回记录的顺序至关重要，以便 row_num
> --values 以正确的顺序设置，并且我们
> 根据页面
> INSERT INTO @temp_table (objectid )
> 
> /* 示例：选择将记录插入临时表
> SELECT personid
> FROM person WITH (NOLOCK)
> inner join degree WITH (NOLOCK) on degree.personid = person.personid
> WHERE person.lastname = @last_name
> ORDER BY person.lastname asc, person .firstname asc
> */
> 
> --获取我们匹配的总行数
> DECLARE @total_rows int
> SET @total_rows = @@ROWCOUNT --根据 匹配的--rows数和作为参数传入的页面大小
> 计算总页数DECLARE @total_pages int -- 将@page_size - 1 添加到总行数以 -- 计算总页数。这是因为 sql --alwasy 向下舍入以进行整数除法SET @total_pages = (@total_rows + @page_size - 1) / @page_size
> 
> --return 我们感兴趣的结果集，方法是加入
> --back 到 @temp_table 并按 row_num 过滤
> /* 示例：选择要返回的数据。如果插入操作
> 正确，那么您应该始终加入包含
> 要返回到 @temp_table 上的 objectid 列的行的表
> 
> SELECT person.*
> FROM person WITH (NOLOCK) INNER JOIN @temp_table tt
> ON person.personid = tt.objectid
> */
> --仅返回页面中我们感兴趣的行
> --并按@的row_num列排序temp_table 以确保
> -- 我们正在选择正确的记录
> WHERE tt.row_num < (@page_size * @page_number) + 1
> AND tt.row_num > (@page_size * @page_number) - @page_size
> ORDER BY tt.row_num

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T19:17:56.253

我在 MS Sql 中也遇到了这个问题……没有限制或行号函数。我所做的是将我的最终查询结果（或有时是整个字段列表）的键插入带有标识列的临时表中......然后我从临时表中删除我想要的范围之外的所有内容......然后使用对键和原始表进行连接，以带回我想要的项目。如果您有一个很好的唯一密钥，这将起作用 - 如果您没有，那么......这本身就是一个设计问题。

性能稍好一些的替代方法是跳过删除步骤，只在最终连接中使用行号。另一个性能改进是使用 TOP 运算符，这样至少，您不必抓取超出您想要的内容的内容。

所以......在伪代码中......抓取项目80-89......

```
create table #keys (rownum int identity(1,1), key varchar(10))

insert #keys (key)
select TOP 89 key from myTable ORDER BY whatever

delete #keys where rownumber < 80

select <columns> from #keys join myTable on #keys.key = myTable.key 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T08:56:20.863

我最终在代码中进行了分页。我只是跳过循环中的第一条记录。

我以为我为进行分页创造了一种简单的方法，但似乎普遍的 sql 不允许在子查询中使用 order 子句。但这应该适用于其他数据库（我在 firebird 上测试过）

```
select *
from (select top [rows] * from
(select top [rows * pagenumber] * from mytable order by id)
order by id desc)
order by id 
```

# ruby-on-rails - 我如何在 Rails 中“验证”销毁

> ID：123078
> 
> 赞同：85
> 
> 时间：2008-09-23T19:04:33.540
> 
> 标签：ruby-on-rails, ruby, callback

在销毁一个宁静的资源时，我想在允许销毁操作继续之前保证一些事情？基本上，如果我注意到这样做会使数据库处于无效状态，我希望能够停止销毁操作？销毁操作没有验证回调，那么如何“验证”是否应该接受销毁操作？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-09-23T19:22:37.723

您可以引发一个异常，然后捕获该异常。Rails 将删除包装在事务中，这有助于解决问题。

例如：

```
class Booking < ActiveRecord::Base
  has_many   :booking_payments
  ....
  def destroy
    raise "Cannot delete booking with payments" unless booking_payments.count == 0
    # ... ok, go ahead and destroy
    super
  end
end 
```

或者，您可以使用 before_destroy 回调。此回调通常用于销毁依赖记录，但您可以抛出异常或添加错误。

```
def before_destroy
  return true if booking_payments.count == 0
  errors.add :base, "Cannot delete booking with payments"
  # or errors.add_to_base in Rails 2
  false
  # Rails 5
  throw(:abort)
end 
```

`myBooking.destroy`现在将返回 false，并将`myBooking.errors`在返回时填充。

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2011-07-29T13:54:27.240

只是一个说明：

用于导轨 3

```
class Booking < ActiveRecord::Base

before_destroy :booking_with_payments?

private

def booking_with_payments?
        errors.add(:base, "Cannot delete booking with payments") unless booking_payments.count == 0

        errors.blank? #return false, to not destroy the element, otherwise, it will delete.
end 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2016-06-17T11:36:05.277

这就是我对 Rails 5 所做的：

```
before_destroy do
  cannot_delete_with_qrcodes
  throw(:abort) if errors.present?
end

def cannot_delete_with_qrcodes
  errors.add(:base, 'Cannot delete shop with qrcodes') if qrcodes.any?
end 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2019-11-25T14:38:50.570

Rails 6 的情况：

这有效：

```
before_destroy :ensure_something, prepend: true do
  throw(:abort) if errors.present?
end

private

def ensure_something
  errors.add(:field, "This isn't a good idea..") if something_bad
end 
```

`validate :validate_test, on: :destroy`不起作用：[https ://github.com/rails/rails/issues/32376](https://github.com/rails/rails/issues/32376)

Since Rails 5 `throw(:abort)` is required to cancel execution: [https://makandracards.com/makandra/20301-cancelling-the-activerecord-callback-chain](https://makandracards.com/makandra/20301-cancelling-the-activerecord-callback-chain)

`prepend: true` is required so that `dependent: :destroy` doesn't run before the validations are executed: [https://github.com/rails/rails/issues/3458](https://github.com/rails/rails/issues/3458)

You can fish this together from other answers and comments, but I found none of them to be complete.

*As a sidenote, many used a `has_many` relation as an example where they want to make sure not to delete any records if it would create orphaned records. This can be solved much more easily:*

`has_many :entities, dependent: :restrict_with_error`

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-23T22:16:49.957

ActiveRecord 关联 has_many 和 has_one 允许一个依赖选项，以确保在删除时删除相关的表行，但这通常是为了保持数据库清洁而不是防止它无效。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-24T05:11:09.743

您可以将销毁操作包装在控制器中的“if”语句中：

```
def destroy # in controller context
  if (model.valid_destroy?)
    model.destroy # if in model context, use `super`
  end
end 
```

在哪里*valid_destroy？*是模型类上的一个方法，如果满足销毁记录的条件，则返回 true。

拥有这样的方法还可以让您阻止向用户显示删除选项 - 这将改善用户体验，因为用户将无法执行非法操作。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-06-17T19:14:16.860

我最终使用此处的代码在 activerecord 上创建了一个 can_destroy 覆盖： [https ://gist.github.com/andhapp/1761098](https://gist.github.com/andhapp/1761098)

```
class ActiveRecord::Base
  def can_destroy?
    self.class.reflect_on_all_associations.all? do |assoc|
      assoc.options[:dependent] != :restrict || (assoc.macro == :has_one && self.send(assoc.name).nil?) || (assoc.macro == :has_many && self.send(assoc.name).empty?)
    end
  end
end 
```

这有一个额外的好处，那就是在 ui 上隐藏/显示删除按钮变得微不足道

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-23T19:26:17.043

您还可以使用 before_destroy 回调来引发异常。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-01-10T23:00:20.893

我有这些课程或模型

```
class Enterprise < AR::Base
   has_many :products
   before_destroy :enterprise_with_products?

   private

   def empresas_with_portafolios?
      self.portafolios.empty?  
   end
end

class Product < AR::Base
   belongs_to :enterprises
end 
```

现在，当您删除企业时，此过程会验证是否有与企业关联的产品 注意：您必须将其写在类的顶部才能首先验证它。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-12-25T12:52:15.037

在 Rails 5 中使用 ActiveRecord 上下文验证。

```
class ApplicationRecord < ActiveRecord::Base
  before_destroy do
    throw :abort if invalid?(:destroy)
  end
end 
```

```
class Ticket < ApplicationRecord
  validate :validate_expires_on, on: :destroy

  def validate_expires_on
    errors.add :expires_on if expires_on > Time.now
  end
end 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-03-29T16:23:56.220

我希望这会得到支持，所以我打开了一个 Rails 问题来添加它：

[https://github.com/rails/rails/issues/32376](https://github.com/rails/rails/issues/32376)

# .net - 命名“核心”程序集

> ID：123080
> 
> 赞同：23
> 
> 时间：2008-09-23T19:04:35.257
> 
> 标签：.net

我知道这有点主观，但我想知道是否有一个普遍接受的标准来命名包含一些“核心”功能的程序集。

假设您有一个更大的项目，其中包含类似的程序集

*   Company.Product.WebControls.dll
*   公司.产品.Net.dll
*   Company.Product.UserPages.dll

你有一堆“核心”类，比如全局错误处理程序、全局日志记录功能等。

这样的大会一般会怎么命名？以下是我想到的一些事情：

*   公司.产品.dll
*   公司.产品.Core.dll
*   公司.产品.Global.dll
*   公司.产品.管理.dll

现在，虽然“只选择一个并继续”不会导致世界末日，但我仍然想知道是否有一种“公认”的方式来命名这些程序集。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-28T19:46:15.307

所有这些“root”、“core”、“common”等等，**可能都不是最好的命名约定**。

常见的东西应该位于根命名空间中，就像在 .NET 中一样`string`，`int`而其他“核心”或“常见”的东西应该位于根命名空间中`System`。

**不要使用命名空间来更轻松地折叠 Visual Studio 中的文件夹**，而是根据**它包含的内容和用途来构建它**。

`System.Security`包含常见的安全性，例如`System.Xml`不需要知道的东西，除非您明确想要该功能。

`System.Security.Cryptography`是一个子命名空间。密码学是安全性，但**安全性不是明确的密码学**。

通过这种方式`System.Security.Cryptography`可以**全面了解其父命名空间**，并且可以**隐式使用其父命名空间内的所有类**。

我会说`System.Core.dll`这是**微软方面的失误**。他们一定是用完了想法或 DLL 名称。

**更新**：MSDN 有一篇更新的[文章试图解释微软在这个主题上的想法](http://msdn.microsoft.com/en-us/library/ms973231.aspx#assenamesp_topic5)。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-23T19:10:21.920

使用.Net，这相对容易更改，所以我会很方便。

更少、更大的程序集比许多小型程序集编译得更快，所以我将从您的“核心”内容作为 Company.Product.dll 中的命名空间开始，如果需要，稍后再将其拆分。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-23T19:10:30.437

我通常喜欢有描述每个程序集内部内容的名称。

您会看到，如果您将某个东西命名为 .Core，那么在一个大型团队中，它可以快速增长，因为人们会考虑将非常常见的东西放入该程序集中。

所以，我认为不应该真的只有一个核心组件。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-23T19:11:27.533

我使用过.Core、.Framework 和.Common。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-28T19:37:57.213

我们使用这个模型：

*   公司.Core.dll
*   公司.WinControls.dll
*   公司.WebControls.dll
*   公司.产品.Core.dll
*   Company.Product.WinControls.dll
*   Company.Product.WebControls.dll

等等

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-23T19:05:25.940

我总是做.Core.dll。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-23T19:14:38.990

我最常用并且似乎很喜欢的一种，因为我没有看到其他人使用它是`Root`

我一般会

```
CompanyName.Root 
```

或者

```
SomethingMeaningfulToMe.Root 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-05-11T05:17:54.833

这是取决于问题的问题之一。如果它是您的代码并且您在一个小团队中工作，我会使用任何对您有意义的命名约定。然而，我在大型代码库中看到命名空间允许下游开发人员在不需要文档或培训的情况下发现功能。我们使用模型。标准化命名空间使开发人员更容易将团队转移到团队。

业务名称.部门.层

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-05-08T19:24:41.823

我也使用了.Core，尤其是.dll

这完全取决于我的口味，如果根名称空间是公司名称，我觉得 .Core/framework/common 比公司名称更具描述性。

但是，如果您正在处理诸如 dll/命名空间的名称也是项目名称的开源项目，那么 .Core/../ 可能有点多余。

.net 框架和其他 Microsoft 库中有许多使用这两种约定的示例。例如有一个 System.dll 和一个 System.Core.dll :)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-05-12T06:29:53.970

Core 是非常有意义且易于理解的命名约定，并且它不与任何 .net 框架命名空间冲突，因此它是非常好的实践。

我强烈建议在每个程序集中封装它应该提供给使用它的应用程序的服务，而不是在一个程序集中混合不同的功能域。

我们正在使用

```
CSG.Core
CSG.Data
CSG.Services
... 
```

在核心中，我们包含了可能在我们所有产品中使用的类：日志记录、集合扩展、泛型、配置扩展、安全性、验证等。

尽管编译许多程序集比编译更少和更大的程序集要慢，但它优化了您的部署，因为您只部署系统使用的类，而不包含许多仅仅因为您想节省编译时间而没有使用的类。

当您命名您的命名空间时，我强烈建议您**避免在不同级别的命名空间中重复相同的词**。例如，避免以下情况：

```
YourCompany.Core
YourCompany.YourProduct.Core 
```

将核心放在 YourCompany 或 Myproduct 中，但不要同时放在两者中。例如，如果您的 using 看起来像： using YourCompany; 使用 YourCompany.YourProduct；

当您键入 Core.SomeClass 时，这个类的来源会非常混乱，如果您有 2 个同名的类，则会导致冲突。

# sql-server - 安装 SQL Server 2008 Express 时绕过 .Net v3.5 验证

> ID：123085
> 
> 赞同：1
> 
> 时间：2008-09-23T19:05:12.790
> 
> 标签：sql-server, sql-server-2008, installation

出于某种原因，当我尝试安装时`SQL Server 2008 Express`，我收到一条错误消息，说我需要先`.Net Framework 3.5`安装，但问题是：我已经安装了！那么有人可以告诉我是否可以通过更新注册表项或其他方式绕过此验证吗？我有 Visual Studio 或任何其他东西的 np ......就在我尝试安装 sql express 时。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T19:09:50.407

我以前遇到过一次。确保它已安装。必要时重新安装。我相信我所做的是安装 SP1。SQL Server 2008 倾向于尝试安装 Compact Framework 3.5 并基于 SQL 的构建或更新，Compact Framework 3.5 SP1。！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-20T22:08:34.170

安装 Windows Installer 4.5 对我有用。安装后，消息消失。

# c# - 使用这种（基于扩展方法的）速记的可能陷阱

> ID：123088
> 
> 赞同：15
> 
> 时间：2008-09-23T19:05:46.250
> 
> 标签：c#, .net, extension-methods

**C#6 更新**

在[C#6`?.`中，现在是一种语言特性](https://msdn.microsoft.com/en-us/magazine/dn802602.aspx)：

```
// C#1-5
propertyValue1 = myObject != null ? myObject.StringProperty : null; 

// C#6
propertyValue1 = myObject?.StringProperty; 
```

下面的问题仍然适用于旧版本，但如果使用 new 运算符开发新应用程序`?.`是更好的做法。

**原始问题：**

我经常想访问可能为空的对象的属性：

```
string propertyValue1 = null;
if( myObject1 != null )
    propertyValue1 = myObject1.StringProperty;

int propertyValue2 = 0;
if( myObject2 != null )
    propertyValue2 = myObject2.IntProperty; 
```

等等...

我经常使用它，所以我有一个片段。

在以下情况下，您可以使用内联在某种程度上缩短它：

```
propertyValue1 = myObject != null ? myObject.StringProperty : null; 
```

但是，这有点笨拙，尤其是在设置大量属性或多个级别可以为空的情况下，例如：

```
propertyValue1 = myObject != null ? 
    (myObject.ObjectProp != null ? myObject.ObjectProp.StringProperty) : null : null; 
```

我真正想要的是`??`样式语法，它适用于直接为空的类型：

```
int? i = SomeFunctionWhichMightReturnNull();
propertyValue2 = i ?? 0; 
```

所以我想出了以下内容：

```
public static TResult IfNotNull<T, TResult>( this T input, Func<T, TResult> action, TResult valueIfNull )
    where T : class
{
    if ( input != null ) return action( input );
    else return valueIfNull;
}

//lets us have a null default if the type is nullable
public static TResult IfNotNull<T, TResult>( this T input, Func<T, TResult> action )
    where T : class
    where TResult : class
{ return input.IfNotNull( action, null ); } 
```

这让我可以使用这种语法：

```
propertyValue1 = myObject1.IfNotNull( x => x.StringProperty );
propertyValue2 = myObject2.IfNotNull( x => x.IntProperty, 0);

//or one with multiple levels
propertyValue1 = myObject.IfNotNull( 
    o => o.ObjectProp.IfNotNull( p => p.StringProperty ) ); 
```

这简化了这些调用，但我不确定是否要检查这种扩展方法 - 它确实使代码更易于阅读，但以扩展对象为代价。这会出现在所有东西上，尽管我可以将它放在一个专门引用的命名空间中。

这个例子是一个相当简单的例子，一个稍微复杂一点的例子是比较两个可为空的对象属性：

```
if( ( obj1 == null && obj2 == null ) || 
    ( obj1 != null && obj2 != null && obj1.Property == obj2.Property ) )
    ...

//becomes
if( obj1.NullCompare( obj2, (x,y) => x.Property == y.Property ) 
    ... 
```

以这种方式使用扩展有什么陷阱？其他编码员可能会感到困惑吗？这只是滥用扩展名吗？

* * *

我想我在这里真正想要的是编译器/语言扩展：

```
propertyValue1 = myObject != null ? myObject.StringProperty : null;

//becomes
propertyValue1 = myObject?StringProperty; 
```

这将使复杂的情况变得容易得多：

```
propertyValue1 = myObject != null ? 
    (myObject.ObjectProp != null ? myObject.ObjectProp.StringProperty) : null

//becomes
propertyValue1 = myObject?ObjectProp?StringProperty; 
```

这仅适用于值类型，但您可以返回可为空的等价物：

```
int? propertyValue2 = myObject?ObjectProp?IntProperty;

//or

int propertyValue3 = myObject?ObjectProp?IntProperty ?? 0; 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-10T14:32:08.443

我们独立提出了完全相同的扩展方法名称和实现：[空传播扩展方法](http://code.logos.com/blog/2008/01/nullpropagating_extension_meth.html)。所以我们不认为这是混淆或滥用扩展方法。

我会用链接编写你的“多层次”示例，如下所示：

```
propertyValue1 = myObject.IfNotNull(o => o.ObjectProp).IfNotNull(p => p.StringProperty); 
```

Microsoft Connect 上有一个[现已关闭的错误，](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=192177)它提出了“？”。作为将执行此 null 传播的新 C# 运算符。Mads Torgersen（来自 C# 语言团队）简要解释了为什么他们不会实现它。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-28T02:00:46.100

这是链式成员的另一种解决方案，包括扩展方法：

```
public static U PropagateNulls<T,U> ( this T obj
                                     ,Expression<Func<T,U>> expr) 
{  if (obj==null) return default(U);

   //uses a stack to reverse Member1(Member2(obj)) to obj.Member1.Member2 
   var members = new Stack<MemberInfo>();

   bool       searchingForMembers = true;
   Expression currentExpression   = expr.Body;

   while (searchingForMembers) switch (currentExpression.NodeType)
    { case ExpressionType.Parameter: searchingForMembers = false; break;

           case ExpressionType.MemberAccess:    
           { var ma= (MemberExpression) currentExpression;
             members.Push(ma.Member);
             currentExpression = ma.Expression;         
           } break;     

          case ExpressionType.Call:
          { var mc = (MethodCallExpression) currentExpression;
            members.Push(mc.Method);

           //only supports 1-arg static methods and 0-arg instance methods
           if (   (mc.Method.IsStatic && mc.Arguments.Count == 1) 
               || (mc.Arguments.Count == 0))
            { currentExpression = mc.Method.IsStatic ? mc.Arguments[0]
                                                     : mc.Object; 
              break;
            }

           throw new NotSupportedException(mc.Method+" is not supported");
         } 

        default: throw new NotSupportedException
                        (currentExpression.GetType()+" not supported");
  }

   object currValue = obj;
   while(members.Count > 0)
    { var m = members.Pop();

      switch(m.MemberType)
       { case MemberTypes.Field:
           currValue = ((FieldInfo) m).GetValue(currValue); 
           break;

         case MemberTypes.Method:
           var method = (MethodBase) m;
           currValue = method.IsStatic
                              ? method.Invoke(null,new[]{currValue})
                              : method.Invoke(currValue,null); 
           break;

         case MemberTypes.Property:
           var method = ((PropertyInfo) m).GetGetMethod(true);
                currValue = method.Invoke(currValue,null);
           break;

       }     

      if (currValue==null) return default(U);   
    }

   return (U) currValue;    
} 
```

然后，您可以在 any 可以为 null 或 none 的情况下执行此操作：

```
foo.PropagateNulls(x => x.ExtensionMethod().Property.Field.Method()); 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-23T19:28:19.270

如果您发现自己必须经常检查对对象的引用是否为空，那么您可能应该使用[空对象模式](http://en.wikipedia.org/wiki/Null_Object_pattern)。在这种模式中，不是使用 null 来处理没有对象的情况，而是实现一个具有相同接口但具有返回足够默认值的方法和属性的新类。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-23T20:14:41.297

怎么

```
propertyValue1 = myObject.IfNotNull(o => o.ObjectProp.IfNotNull( p => p.StringProperty ) ); 
```

比阅读和写作更容易

```
if(myObject != null && myObject.ObjectProp != null)
    propertyValue1 = myObject.ObjectProp.StringProperty; 
```

Jafar Husain 发布了一个使用表达式树检查链中是否存在空值的示例，即[C# 3 中的运行时宏](http://themechanicalbride.blogspot.com/2007/03/runtime-macros-in-c-30.html)。

不过，这显然会对性能产生影响。现在，如果我们有办法在编译时做到这一点。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-23T20:15:40.763

我只想说我喜欢这个黑客！

我没有意识到扩展方法并不意味着空检查，但它完全有道理。正如 James 所指出的，扩展方法调用本身并不比普通方法贵，但是如果你做了很多这样的事情，那么遵循 ljorquera 建议的空对象模式确实是有意义的。或者使用空对象和 ?? 一起。

```
class Class1
{
    public static readonly Class1 Empty = new Class1();
.
.
x = (obj1 ?? Class1.Empty).X; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T20:04:34.487

> 它确实使代码更容易阅读，但以扩展对象为代价。这会出现在所有东西上，

请注意，您实际上并没有扩展任何东西（理论上除外）。

```
propertyValue2 = myObject2.IfNotNull( x => x.IntProperty, 0); 
```

将像编写一样生成 IL 代码：

```
ExtentionClass::IfNotNull(myObject2,  x => x.IntProperty, 0); 
```

没有为对象添加“开销”来支持这一点。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T20:24:45.140

对于不知情的读者来说，看起来您正在调用空引用的方法。如果你想要这个，我建议把它放在一个实用程序类中，而不是使用扩展方法：

```
 propertyValue1 = Util.IfNotNull(myObject1, x => x.StringProperty );
propertyValue2 = Util.IfNotNull(myObject2, x => x.IntProperty, 0); 
```

“实用程序”。篦，但IMO是较小的句法邪恶。

此外，如果您将其作为团队的一部分进行开发，请温和地询问其他人的想法和做法。代码库中常用模式的一致性很重要。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-23T23:39:36.170

虽然从空实例调用扩展方法通常会引起误解，但我认为在这种情况下意图*非常简单。*

```
string x = null;
int len = x.IfNotNull(y => y.Length, 0); 
```

我想确保这个静态方法适用于可以为 null 的值类型，例如 int?

编辑：编译器说这些都不是有效的：

```
 public void Test()
    {
        int? x = null;
        int a = x.IfNotNull(z => z.Value + 1, 3);
        int b = x.IfNotNull(z => z.Value + 1);
    } 
```

除此之外，去吧。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-01-07T15:17:18.560

不是对所提出的确切问题的答案，但[在 C# 6.0 中有](http://msdn.microsoft.com/en-us/magazine/dn802602.aspx)*Null-Conditional Operator* 。我可以争辩说，自 C# 6.0 起在 OP 中使用该选项将是一个糟糕的选择 :)

所以你的表达更简单，

```
string propertyValue = myObject?.StringProperty; 
```

如果`myObject`为 null，则返回 null。如果属性是值类型，则必须使用等效的可为空类型，例如，

```
int? propertyValue = myObject?.IntProperty; 
```

或者，您可以使用 null 合并运算符合并以在 null 的情况下提供默认值。例如，

```
int propertyValue = myObject?.IntProperty ?? 0; 
```

`?.`不是唯一可用的语法。对于索引属性，您可以使用`?[..]`. 例如，

```
string propertyValue = myObject?[index]; //returns null in case myObject is null 
```

运算符的一个令人惊讶的行为是，如果 object 恰好为 null `?.`，它可以智能地绕过后续调用。`.Member`链接中给出了一个这样的例子：

```
var result = value?.Substring(0, Math.Min(value.Length, length)).PadRight(length); 
```

在这种情况下`result`，如果`value`为 null 并且`value.Length`表达式不会导致`NullReferenceException`.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T19:13:18.870

就个人而言，即使经过您的所有解释，我也不记得这到底是如何工作的：

```
if( obj1.NullCompare( obj2, (x,y) => x.Property == y.Property ) 
```

这可能是因为我没有 C# 经验；但是，我可以阅读并理解您代码中的其他所有内容。我更喜欢保持代码语言不可知（尤其是琐碎的事情），以便明天，另一个开发人员可以将其更改为全新的语言，而无需太多关于现有语言的信息。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-28T15:21:38.650

这是另一个使用 myObject.NullSafe(x=>x.SomeProperty.NullSafe(x=>x.SomeMethod)) 的解决方案，在 [http://www.epitka.blogspot.com/进行了解释](http://www.epitka.blogspot.com/)

# agile - How do you avoid waiting for requirements when using iterative agile development methods like SCRUM?

> ID：123089
> 
> 赞同：7
> 
> 时间：2008-09-23T19:05:51.523
> 
> 标签：agile, scrum, requirements, user-stories

We attempt to do agile development at my current job and we succeed for the most part. The main problem seems to be that the developers on the project are always waiting for requirements at the beginning of the sprint and rushing to get get things down by the end. The business analysts who are delivering the requirements are always working non-stop to get the requirements done.

**EDIT: Additional Information:** We are customizing a COTS application for our internal use. Our 'user stories' just consist of what part of the application we will be customizing in the specific sprint and also what systems we will integrate with internally. The integration with different systems normally works pretty well because we can start working on that right away. The 'customize x screen' are the main problems areas because the developers can't do anything from that. We have to wait until we get the requirements from the BAs before we can really do anything.

**EDIT: More insight/confusion perhaps:** I wonder if part of the problem is that the screen that are being customized are already there as this is a COTS product that is being heavily customized. People suggest that the user stories should be along the lines of 'make a screen that does X'. That's already done. Maybe there isn't a good way to do user stories for these requirements... maybe this need to be a whole new question.

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-23T19:12:43.753

Don't wait. Build a prototype based on whatever minimal requirements you do have and get feedback ASAP from the product owner. More often than not they don't know what they want anyway - if you can show them something tangible as a starting point you're more likely to get useful feedback. Also, once you have a better idea of the real requirements you will probably have already gained a lot of insight from developing your prototype.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T19:14:29.430

如果我正确理解您的情况，那么 BA 就是落后的人。您可以尝试两件事。

1.  尝试小冲刺或更小的需求块。无论哪种方式，BA 的工作都应该更加简洁和易于管理。

2.  进行交互以返工或消除错误。这应该让 BA 有时间走在曲线的前面。

但是，如果问题在于 BA 在提出更多要求之前需要在“狂野”中看到先前的要求，那么您将面临更大的问题。:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T19:13:46.607

At a previous position we managed this by asking our business customers to be a week ahead or so. Sure this breaks from some of the strict interpretations of agile but it made things so much easier. We would have both testing and the business working a week or 2 off from development so when developers were working on iteration 2 testing is working on what came out of IT1 and the business is on IT3\. Priority was always given to active development so sometimes it broke down if a story was particularly flexible (i.e. the business had to spend lots of time revising things mid iteration) but overall it worked well.

**Update to respond to the questioneers Update**

It seems to me those don't really stand on their own as stories then and maybe the BA team needs to reevaluate how they are writing stories. I mean you can't reall "tell a tale" with customize X screen. In theory a story should be something like "When the user goes to screen X they should be able to modify (and save) the floozit"

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T19:14:28.743

Sounds like the BAs may not be handing you your user stories for the sprint in a timely manner.

I take it that there is no sprint planning sessions from what you say.

Given that one of the big tenets of Scrum is that the development team takes responsibility for what they will work on per sprint, it sounds like this ain't too agile to me! (-:

Apart from having short sprints that is.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T19:16:47.910

好吧，有几件事可能会有所帮助 - 在 SCRUM 过程中，有产品负责人的概念，它是猪角色，它代表客户。因此，您可以邀请 PLM 或客户的主要联系人参加您的 SCRUM 会议。这将使您的客户对您的流程有一定的认可，并使他们与您“一起”实现您的目标 - 每周为客户构建可能会有所帮助。因此，每周投放的基本思想是向客户展示“进步”。因此，如果几个星期没有进展，这应该提出“为什么？”的问题。然后您应该能够解释这是因为缺乏需求最终确定。

希望这可以帮助

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T19:40:26.013

“用户故事”是*未来对话的占位符*，因此请到客户面前询问他们；如果那是 BA 的工作，那就生火吧；-)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T19:48:52.497

您的用户故事不完整。“自定义 X 屏幕”是一项任务，它不描述任何要求或完成标准。用户故事应该类似于“允许 Nancy 查看库存中物品的相关采购订单”。然后将其分解为您可以在 sprint 期间处理的任务。

一旦 BA 开发了一个可行的用户故事*，然后*将其添加到您的产品 backlog 中，对其进行优先排序，并为最重要的 backlog 项目计划您的 sprint。BA 应该独立于您的 sprint 开发用户故事并添加到您的待办事项中，因此不会阻碍您。在冲刺期间，任务完成并且用户故事没有改变。发布后，客户提供反馈，这些反馈作为更多用户故事进入产品积压。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T21:34:51.947

我看到了几种处理方法：

选项 1，在 SCRUM 下，您应该有一个产品负责人来管理您的产品待办事项，该待办事项应该包含对软件功能的请求。如果该功能包含诸如“自定义屏幕 X”之类的模糊内容，并且您决定将其添加到您的 sprint 中，那么 sprint 任务应该是具体的分解任务，我想说其中一项任务必须是“定义屏幕要求X'。

在每日 SCRUM 中，当您向每个团队成员询问三个问题时，拥有该屏幕模块任务的开发人员会说“我被阻止等待 BA 的要求。”，您的 Scrum 主管会尽其所能让它继续前进。

在我看来，选项 2 是项目不会进入您的产品 backlog，直到它们被定义得足够好，至少可以进行一些生产性工作。我们都知道需求会发生变化，但关键是您应该有足够的资源开始。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T09:56:44.737

简单的。

让自己在 Scrum 的严格规则之外思考，回到你的精益根源： http: [//availagility.wordpress.com/2008/04/09/a-kanban-system-for-software-development/](http://availagility.wordpress.com/2008/04/09/a-kanban-system-for-software-development/) [http:// leansoftwareengineering.com/2007/10/31/spreadsheet-example-for-a-small-kanban-team/](http://leansoftwareengineering.com/2007/10/31/spreadsheet-example-for-a-small-kanban-team/) [http://www.infoq.com/articles/hiranabe-lean-agile-kanban](http://www.infoq.com/articles/hiranabe-lean-agile-kanban)

相信我，一旦你让这股潮流继续下去，你就永远不会回头。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-04-17T18:45:05.983

如上所述，通常在每个 sprint 开始时，您应该优先考虑现有的 backlog，并为当前的 sprint 挑选一些故事。如果没有足够的用户故事供开发人员使用，您应该将开发人员转移到另一个项目，并让产品负责人有时间为该项目创建一个体面的（=足以养活一些团队）积压工作。

# maintenance - What are the best practices to push site updates from dev/stage/testing environment to production?

> ID：123095
> 
> 赞同：9
> 
> 时间：2008-09-23T19:06:10.743
> 
> 标签：maintenance

Right now I have a development server running a basic LAMP configuration. The production server is a [slicehost](http://www.slicehost.com/). But I'm wondering what is the best way to push the instances of the code/db to the stages dev > stage > production. Does it have to do with how you create the stages?

How do you do it without bring the site down? Is it even possible if you don't do load balancing?

I know this is somewhat general, I'm just looking to be pointed in the right direction.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T19:12:09.467

I use .htaccess to create a "maintenance mode" jiffy where only my IP can see the main site while updating. Everybody else gets to view a short message so they know everything should be back online in a few ticks.

Then I:

1.  Make any DB edits
2.  SVN export/upload the files
3.  Run automated testing and give as much as possible a quick look over to make sure there's nothing hideously wrong
4.  Revert the .htaccess

It's a given but you should test things as much as you can locally before pushing to a live server. Some people use two live servers (like a cryptically name subdomain on the production server) to act as a test-area for live-time updates. This can reduce the main site's actual downtime.

I should stress that it's important not to push updates to a live server without shutting it down beforehand (especially if you're using binaries ala ASPNET) because users trying to use the site while you update will get hideous error messages and you might get locked files.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T19:11:00.390

I'd look into some sort of automated "build" style environment for lamp where you have scripts that package and prepare your releases for each environment.

I recognize there is no actual building for PHP but you could set up automation to change any configuration or setup issues and save everything off to a folder ready to be implemented.

I don't believe you can completely eliminate downtime without load balancing / web farm style environments. However the easiest way to reduce it in my book is by establishing a consistent code prep process and testing the process multiple times. Automation would help there.

As for the act of actually copying the files, well I don't know much more than using something like FTP or whatever is convenient. Maybe putting up a loading message. Again this could all be scripted out.

Finally keep in mind since PHP isn't built it might work well for you to track differences between what's there now and what you have changed and only move those files. Sometimes that can add unneeded complexity though.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T19:13:36.187

I don't know if this is a good idea, but what about automated checkouts from a source control system? Perhaps having a few branches of development - testing for bleeding-edge, development for maintenance/small improvements, and production for the production code. Whenever development is stable, merge it into the production branch and have it automatically checked out on a regular basis by the production machine.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T19:14:22.953

As far as pushing files out to all the web servers I find that good old robocopy does the trick. My dev/stage/prod environments are all identical of course. Just put up a temporary page that tells users the site will be right back.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T19:17:13.137

现在，我们使用一系列带有配置文件的 shell 脚本，这些脚本将我们更改的文件打包，将它们 scp 到集群中的每个服务器，然后在它们存在后解压缩它们。这种方法当然有其缺点，我们正在考虑一种方法，其中每个服务器成员都安装一个 svn 客户端，并且一旦我们标记一个新版本，我们就将生产服务器上的工作副本切换到该新标记。当然，我们现在在维护期间发布，所以我们不必为我们的用户做任何特别的事情（他们无论如何都会看到维护页面）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T19:19:03.863

我的核心配置中有一个选项可以允许访问站点或预设 URL 列表，我可以将所有用户重定向到（并使用适当的 http 代码停止任何 API 流量）。

这些 url 是指向静态 html 文件的链接，向用户解释正在发生的事情。

启用此功能后，不会对数据库或任何文件发出请求，因为在此之前所有请求都会发送到 HTML 文件，这为我提供了一个“清晰”的空间来部署任何更新。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T19:24:36.720

具有 svn 和 ftp 任务的 apache ant 为我买单。甚至有人用 ANT 做 db 的事情，但我倾向于亲自观看这些。一旦你有一个干净的和推送的 ftp 构建到你所有的位置，你会惊讶于它是多么容易。

# .net - Visual Studio window manager

> ID：123105
> 
> 赞同：3
> 
> 时间：2008-09-23T19:08:42.953
> 
> 标签：.net, visual-studio, add-in

Is there a window manager for [Visual Studio 2008](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_2008) like [this one](http://www.codeplex.com/VSWindowManager). I really liked it, and that's all I used in [Visual Studio 2005](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_2005) and saw somewhere it is supposed to work in Visual Studio 2008, but it doesn't. I have tried it on many installations of Visual Studio 2008, and it doesn't remember any settings. I really liked being able to easily change window layout quickly. Right now I just manually import and export settings, but it's not an instant process.

What do I have to do to make it work?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-09-09T02:22:48.723

您可以查看我的博文*[Save and Change Tool Layout in Visual Studio](http://www.brianschmitt.com/save-and-change-tool-layout-in-visual/)*，它提供了列出和切换窗口布局的功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T02:28:49.260

[您应该在CodePlex](http://en.wikipedia.org/wiki/CodePlex)上联系 RW 。他声称它可以在 Visual Studio 2008 中运行。查看[此项目](http://www.codeplex.com/VSWindowManager/WorkItem/View.aspx?WorkItemId=14859)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T17:32:42.407

以下宏可能会为您解决问题。我做了上面提到的 WindowManager，重新编译它以适用于 Visual Studio 2008，但我仍然发现它有点不稳定。此外，我不使用 WindowManager 中的“自动应用布局”功能，因此这些宏非常适合我从双显示器工作切换到仅笔记本电脑工作。

```
Sub DualMonitorConfiguration_Save()
    SaveWindowConfiguration("Dual Monitor Layout")
End Sub

Sub DualMonitorConfiguration_Load()
    LoadWindowConfiguration("Dual Monitor Layout")
End Sub

Sub LaptopOnlyConfiguration_Save()
    SaveWindowConfiguration("Laptop Only Layout")
End Sub

Sub LaptopOnlyConfiguration_Load()
    LoadWindowConfiguration("Laptop Only Layout")
End Sub

Private Sub SaveWindowConfiguration(ByVal configName As String)
    Dim selectedConfig As WindowConfiguration
    selectedConfig = FindWindowConfiguration(configName)
    If selectedConfig Is Nothing Then
        selectedConfig = DTE.WindowConfigurations.Add(configName)
    End If

    selectedConfig.Update()
    DTE.StatusBar.Text = "Window configuration saved: " & configName
End Sub

Sub LoadWindowConfiguration(ByVal configName As String)
    Dim selectedConfig As WindowConfiguration
    selectedConfig = FindWindowConfiguration(configName)
    If selectedConfig Is Nothing Then
        MsgBox("Window Configuration """ & configName & """ not found.")
    Else
        selectedConfig.Apply()
        DTE.StatusBar.Text = "Window configuration applied: " & configName
    End If
End Sub

Private Function FindWindowConfiguration(ByVal name As String) As WindowConfiguration
    Dim selectedLayout As WindowConfiguration

    For Each config As WindowConfiguration In DTE.WindowConfigurations
        If config.Name = name Then
            Return config
        End If
    Next

    Return Nothing
End Function 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-03T17:39:33.453

您的问题在您提出问题的[同一页面](http://www.codeplex.com/VSWindowManager)上得到了回答:-)

仅作记录：

> 要使其适用于 2008 年，请将新的 HostApplication 元素添加到 WindowManager2005.AddIn 文件。该文件通常位于“%APPDATA%\Microsoft\MSEnvShared\Addins”中。将新元素中的版本更改为 9.0 (VS 2008)，它应该可以在 2008 和 2005 中使用。

```
<HostApplication>
  <Name>Microsoft Visual Studio</Name>
  <Version>9.0</Version>
</HostApplication> 
```

# web - 我的共享主机的名称服务器如何将 http://servername.com/~username/ 解析为我的顶级域？

> ID：123111
> 
> 赞同：1
> 
> 时间：2008-09-23T19:09:44.230
> 
> 标签：web, dns, shared-hosting, nameservers

我最近将我的网站移至[asmallorange.com](http://asmallorange.com)上的共享托管解决方案，但我必须将我的域设置为使用他们提供的名称服务器，以便网站正确解析。我决心保持对域的 DNS 的控制，但我找不到让我的顶级域解析到格式为的共享位置的方法

```
server.asmallorange.com/~username 
```

所以我知道我在这里遗漏了一些东西，我的问题是：

**他们的名称服务器/DNS 条目中的哪些内容使*server.sharedhost.com/~username*可以用作顶级域？（即[http://topleveldomain.com](http://topleveldomain.com)）**

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T19:12:36.750

没有。DNS 只是将 topleveldomain.com 映射到 server.sharedhost.com。网络服务器查看`Host: topleveldomain.com`标头并知道它等同于 server.sharedhost.com/~username。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T19:13:12.443

没有。他们让您的域名解析到 server.asmallorange.com 解析到的相同 IP，但随后他们让他们的 Web 服务器知道域名 topleveldomain.com，并告诉 Web 服务器它与 server.asmallorange 相同.com/~用户名。

虚拟主机不是 DNS 技巧，它们是 HTTP 技巧 - 请求的主机名由浏览器在每个请求的 Host: 字段中发送。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T19:19:04.690

apache 有一个“mod_user”，您可以在 apache conf 文件中启用它。使用这个和虚拟主机是如何完成的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-24T23:26:02.553

Apache 中的虚拟主机就是这样做的。

However just because you set the DNS up to go "mydomain.com resolves to 1.2.3.4", which is their IP address, doesn't mean that you're giving up control of your domain name.

# .net - how do you organize your namespaces?

> ID：123114
> 
> 赞同：5
> 
> 时间：2008-09-23T19:10:04.087
> 
> 标签：.net, namespaces, project-organization

So I have logical entities (person, country, etc.), GUI elements / controls, data and navigation controllers / managers, then things like quad-trees and timers, and I always struggle with cleanly separating these things into logical namespaces.

I usually have something like this:

*   Leviathan.GUI.Controls
*   Leviathan.GUI.Views
*   Leviathan.Entities
*   Leviathan.Controllers (data and other stuff)
*   Leviathan.Helpers (trees and other stuff)

Are there any good guides on this? I need to stop this mess.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T19:13:08.293

For applications

```
Company.Product.Tier.Sub.Sub 
```

where I like to get Tier from Model, View, Controller or other established names (Data)

But for our controls, we end up with

```
Company.Product.LogicalFeatureGrouping 
```

or

```
Company.Product.Addon 
```

sometimes it's

```
Company.Product.LogicalFeatureGrouping.Addon 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T19:13:07.233

Try to avoid the "and other stuff" or "misc." categories, If you are putting things in these categories you are failing to really organize them at all.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T19:23:08.003

我通常为每一层创建一个命名空间，比如 UI、业务逻辑和数据库。它迫使我分开层级。我根据系统组件在其中创建其他命名空间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T19:19:45.640

我遵循命名空间应该遵循目录结构的 Java/python 理想。

# java - Ant Junit tests are running much slower via ant than via IDE - what to look at?

> ID：123127
> 
> 赞同：9
> 
> 时间：2008-09-23T19:11:14.303
> 
> 标签：java, performance, ant, junit

I am running my junit tests via ant and they are running substantially slower than via the IDE. My ant call is:

```
 <junit fork="yes" forkmode="once" printsummary="off">
        <classpath refid="test.classpath"/>
        <formatter type="brief" usefile="false"/>
        <batchtest todir="${test.results.dir}/xml">
            <formatter type="xml"/>
            <fileset dir="src" includes="**/*Test.java" />
        </batchtest>
    </junit> 
```

The same test that runs in near instantaneously in my IDE (0.067s) takes 4.632s when run through Ant. In the past, I've been able to speed up test problems like this by using the junit fork parameter but this doesn't seem to be helping in this case. What properties or parameters can I look at to speed up these tests?

More info:

I am using the reported time from the IDE vs. the time that the junit task outputs. This is not the sum total time reported at the end of the ant run.

So, bizarrely, this problem has resolved itself. What could have caused this problem? The system runs on a local disk so that is not the problem.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-26T17:56:07.693

这是一个盲目的猜测：尝试通过使用嵌套`<jvmarg>`标记设置`-Xmx`选项来增加分叉 VM 可用的最大堆大小。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-18T13:50:53.177

我猜这是因为您的 antscript 将结果输出到 XML 文件，而 IDE 将这些结果保存在内存中。写文件比不写文件需要更长的时间。

```
todir="${test.results.dir}/xml" 
```

这是 <batchtest> 调用的一部分，它告诉它将结果粘贴到该目录中。看起来将其关闭只是告诉它将结果粘贴在“当前目录”中，无论是什么。乍一看，我没有看到任何可以将其完全关闭的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T03:42:21.580

也许您看到了这一点，因为 Eclipse 进行增量编译而 Ant 没有。你能确认这段时间只浪费在测试目标上吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T19:18:05.863

很难用这些信息来判断。我要做的第一件事是查看测试结果，并确定是否所有单独的测试都运行得较慢，或者是否可以缩小到某个测试用例子集。

（我要做的第零件事是确保我的 ant 任务使用与 Eclipse 相同的 JVM，并且类路径依赖项和导入的 JAR 确实完全相同）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-27T16:26:05.077

作为记录，我发现了我的问题。我们一直在为这个项目使用代码混淆器，并且该混淆器的字符串加密部分设置为“最大”。这减慢了存在字符串的任何操作。

将字符串加密调低到更快的模式解决了这个问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-06-17T06:11:30.093

对我来说，`forkmode="once"`为`<junit>`元素添加和`usefile="false"`为元素添加`<formatter>`使测试运行得更快。还要删除您不需要的格式化程序。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-04-21T17:05:13.790

尝试将 fork、forkmode 和 threads 设置为这些值：

```
<junit fork="yes" forkmode="perTest" printsummary="off" threads="4">
    <classpath refid="test.classpath"/>
    <formatter type="brief" usefile="false"/>
    <batchtest todir="${test.results.dir}/xml">
        <formatter type="xml"/>
        <fileset dir="src" includes="**/*Test.java" />
    </batchtest>
</junit> 
```

另请参阅[https://ant.apache.org/manual/Tasks/junit.html](https://ant.apache.org/manual/Tasks/junit.html)

# controls - custom server control values lost in callback

> ID：123144
> 
> 赞同：1
> 
> 时间：2008-09-23T19:13:57.887
> 
> 标签：controls, devexpress

I have a custom server control that loads data from a web service into a GridView. Works fine on my page. I want to be able to click on a row and pop a popupcontrol with more detail on the clicked row. I am using the client side events of the DevExpress gridview to handle the onclick. And from JavaScript I am calling a callbackpanel to access my custom server control to get properties to use in the popupcontrol. In the callback, the properties on my server control (which were previously set in order to display the data) are not set, yet any of the other standard controls on the page still have their property settings. Am I missing a setting in my customer server control that will persist my property settings into a callback?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T19:22:44.370

有几种方法可以通过回发来持久化值。您选择的方法将取决于您的具体情况，您没有详细说明。就个人而言，我认为这听起来像是 AJAX 的好地方......

这是一篇很棒的文章，有一些选项：http: [//msdn.microsoft.com/en-us/magazine/cc300437.aspx](http://msdn.microsoft.com/en-us/magazine/cc300437.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T19:25:44.503

我有非常相似的问题。这个问题似乎通过调整数据绑定的时间来解决。

# debian - 向通过 exim4 发送的邮件添加标头

> ID：123153
> 
> 赞同：0
> 
> 时间：2008-09-23T19:14:58.273
> 
> 标签：debian, header, email-spam, procmail, exim4

我有一个运行 Exim4-daemon-heavy 的 Debian Etch 系统。

该系统对互联网开放，但其目的是只接收来自垃圾邮件过滤服务的合法邮件，该服务作为其前面的代理运行。（不过，我不能只限制对这些 IP 的访问，因为我确实有一些授权用户通过我的服务器在端口 25 上进行中继。我知道我应该使用 587 - 但目前我不是。）

这个工作的一般方式是：

[Internet] -> [SMTP 代理] -> [我的服务器]

不幸的是，我让垃圾邮件发送者直接向邮件服务器发送邮件，而忽略了 MX 记录。所以看起来我明显的解决方案是：

1.  在 SMTP 代理上为每条已处理的邮件添加一个标头。
2.  *除非*邮件来自授权的中继器，否则在我的服务器上为每条传入消息添加一个标头。（即完成 SMTP AUTH 的人。）

这样我就可以使用 procmail 来处理直接发送的垃圾邮件，这些邮件是通过忽略我的 MX 记录的发件人发送的。

我很确定 Exim4 可能会被强制添加诸如“X-Submitter: $ip”之类的标头 - 以记录提交消息的远程 IP，但我不确定应该如何完成。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T20:14:33.717

请注意，debian 以一种相当独特的方式重新打包 exim，这使得它们的打包和维护更容易，但使用通用规则有时无法顺利插入。

处理此问题的正确方法是拒绝未经授权且不是来自代理 IP 的邮件。在你的 rcpt ACL 中加入这样的内容：

```
deny message = quit trying to bypass DNS
     !hosts = PROXY_IP_ADDRESS
     !authenticated = * 
```

# printing - 将原始数据发送到 FedEx 标签打印机

> ID：123154
> 
> 赞同：4
> 
> 时间：2008-09-23T19:15:02.500
> 
> 标签：printing, zebra-printers, fedex

我正在开发一个需要打印 FEDEX 运输标签的 .NET WinForms 应用程序。作为 FedEx api 的一部分，我可以获得打印机的原始标签数据。

我只是不知道如何通过 .NET 将数据发送到打印机（我使用的是 C#）。需要明确的是，数据已经预先格式化为 ZPL（Zebra 打印机语言），我只需要将其发送到打印机，而不需要 Windows 将其弄乱。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-23T19:18:55.813

C# 不支持原始打印，您必须使用 win32 假脱机程序，如本知识库文章[How to send raw data to a printer by using Visual C# .NET](http://support.microsoft.com/?kbid=322091)中所述。

希望这可以帮助。

-亚当

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T19:24:10.560

我认为您只想将 ZPL（下面的作业）直接发送到您的打印机。

```
private void SendPrintJob(string job)
{
    TcpClient client = null;
    NetworkStream ns = null;
    byte[] bytes;
    int bytesRead;

    IPEndPoint remoteIP;
    Socket sock = null;

    try
    {
        remoteIP = new IPEndPoint( IPAddress.Parse(hostName), portNum );
        sock = new Socket(AddressFamily.InterNetwork,
            SocketType.Stream,
            ProtocolType.Tcp);
        sock.Connect(remoteIP);

        ns = new NetworkStream(sock);

        if (ns.DataAvailable)
        {
            bytes = new byte[client.ReceiveBufferSize];
            bytesRead = ns.Read(bytes, 0, bytes.Length);
        }

        byte[] toSend = Encoding.ASCII.GetBytes(job);
        ns.Write(toSend, 0, toSend.Length);

        if (ns.DataAvailable)
        {
            bytes = new byte[client.ReceiveBufferSize];
            bytesRead = ns.Read(bytes, 0, bytes.Length);
        }
    }
    finally
    {           
        if( ns != null )            
            ns.Close();

        if( sock != null && sock.Connected )
            sock.Close();

        if (client != null)
            client.Close();
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-21T19:13:21.050

我一直在使用打印机和 ZPL 一段时间，但使用的是 Ruby 应用程序。通过套接字将 ZPL 发送到打印机工作正常。

为了检查它是否有效，我经常远程登录到打印机并输入`^XA^PH^XZ`一个标签。希望有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-03T10:48:52.930

有点晚了，但您可以使用此 CodePlex 项目轻松进行 ZPL 打印 [http://sharpzebra.codeplex.com/](http://sharpzebra.codeplex.com/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-28T19:32:38.297

Zebra 打印机不使用后台打印程序，它不是原始打印。这是一个称为 ZPL 的标记。它是基于文本的，而不是二进制的。

# xss - 您如何使用 html 敏捷包进行 htmlencode？

> ID：123159
> 
> 赞同：0
> 
> 时间：2008-09-23T19:16:02.450
> 
> 标签：xss, html-agility-pack, html-encode

有人做过吗？基本上，我想通过保留 h1、h2、em 等基本标签来使用 html；清除 img 和 a 标签中的所有非 http 地址；和 HTMLEncode 每隔一个标签。

我被困在 HTML 编码部分。我知道要删除一个节点，您执行“node.ParentNode.RemoveChild(node);” 其中 node 是 HtmlNode 类的对象。我不想删除节点，而是想对它进行 HTMLEncode。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T20:08:30.283

您需要删除代表您不想要的元素的节点。然后需要将编码的 HTML 作为文本节点重新添加。

如果您不想处理要丢弃的元素的子元素，则应该可以使用 OuterHtml ......这样的事情可能会起作用：

```
node.AppendChild(new HtmlTextNode { Text = HttpUtility.HtmlEncode(nodeToDelete.OuterHtml) }); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T06:15:20.023

上面的答案几乎涵盖了它。不过，还有一件事要补充。

您不想更改特定节点，而是更改所有节点，因此上面的代码可能是一个方法，包装在 if 语句中（以确保它是您想要 HtmlEncode 的标记）。更重要的是，由于 Agility Pack 不按序数公开节点，因此您无法迭代整个文档。递归是最简单的方法。你可能已经知道这...

我解决了一个类似的问题，并且有一些 shell 代码（C#）非常欢迎您使用： [http ://dev.forrestcroce.com/normalizer-of-web-pages-qualifier-of-urls/2008-12 -09/](http://dev.forrestcroce.com/normalizer-of-web-pages-qualifier-of-urls/2008-12-09/)

# c# - 测试对象是否是 C# 中的字典

> ID：123181
> 
> 赞同：16
> 
> 时间：2008-09-23T19:19:53.130
> 
> 标签：c#, reflection, collections, dictionary

有没有办法测试一个对象是否是字典？

在一种方法中，我试图从列表框中的选定项目中获取值。在某些情况下，列表框可​​能绑定到字典，但这在编译时是未知的。

我想做类似的事情：

```
if (listBox.ItemsSource is Dictionary<??>)
{
    KeyValuePair<??> pair = (KeyValuePair<??>)listBox.SelectedItem;
    object value = pair.Value;
} 
```

有没有办法在运行时使用反射动态地做到这一点？我知道可以将反射与泛型类型一起使用并确定键/值参数，但我不确定在检索到这些值之后是否有办法完成其余的工作。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-23T19:22:40.127

检查它是否实现了 IDictionary。

请参阅 System.Collections.IDictionary 的定义，看看它给了你什么。

```
if (listBox.ItemsSource is IDictionary)
{
    DictionaryEntry pair = (DictionaryEntry)listBox.SelectedItem;
    object value = pair.Value;
} 
```

**编辑：** 当我意识到 KeyValuePair 不能转换为 DictionaryEntry 时的替代方案

```
if (listBox.DataSource is IDictionary)
{
     listBox.ValueMember = "Value";
     object value = listBox.SelectedValue;
     listBox.ValueMember = ""; //If you need it to generally be empty.
} 
```

此解决方案使用反射，但在这种情况下，您不必做繁重的工作，ListBox 会为您完成。此外，如果您通常将字典作为数据源，则可以避免一直重置 ValueMember。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-23T19:27:55.417

它应该类似于以下内容。我在答案框中写了这个，所以语法可能不完全正确，但我已经把它变成了 Wiki 可编辑的，所以任何人都可以修复。

```
if (listBox.ItemsSource.IsGenericType && 
    typeof(IDictionary<,>).IsAssignableFrom(listBox.ItemsSource.GetGenericTypeDefinition()))
{
    var method = typeof(KeyValuePair<,>).GetProperty("Value").GetGetMethod();
    var item = method.Invoke(listBox.SelectedItem, null);
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-04-15T11:52:07.320

我知道这个问题是多年前提出的，但它仍然公开可见。

在本主题和本主题中提出了几个示例：
[确定类型是否为字典 [重复]](https://stackoverflow.com/questions/16956903/determine-if-type-is-dictionary)

但是很少有不匹配的，所以我想分享我的解决方案

**简短的回答：**

```
var dictionaryInterfaces = new[]
{
    typeof(IDictionary<,>),
    typeof(IDictionary),
    typeof(IReadOnlyDictionary<,>),
};

var dictionaries = collectionOfAnyTypeObjects
    .Where(d => d.GetType().GetInterfaces()
        .Any(t=> dictionaryInterfaces
            .Any(i=> i == t || t.IsGenericType && i == t.GetGenericTypeDefinition()))) 
```

**更长的答案：**
我相信这就是人们犯错误的原因：

```
//notice the difference between IDictionary (interface) and Dictionary (class)
typeof(IDictionary<,>).IsAssignableFrom(typeof(IDictionary<,>)) // true 
typeof(IDictionary<int, int>).IsAssignableFrom(typeof(IDictionary<int, int>)); // true

typeof(IDictionary<int, int>).IsAssignableFrom(typeof(Dictionary<int, int>)); // true
typeof(IDictionary<,>).IsAssignableFrom(typeof(Dictionary<,>)); // false!! in contrast with above line this is little bit unintuitive 
```

所以假设我们有这些类型：

```
public class CustomReadOnlyDictionary : IReadOnlyDictionary<string, MyClass>
public class CustomGenericDictionary : IDictionary<string, MyClass>
public class CustomDictionary : IDictionary 
```

这些实例：

```
var dictionaries = new object[]
{
    new Dictionary<string, MyClass>(),
    new ReadOnlyDictionary<string, MyClass>(new Dictionary<string, MyClass>()),
    new CustomReadOnlyDictionary(),
    new CustomDictionary(),
    new CustomGenericDictionary()
}; 
```

所以如果我们使用 .IsAssignableFrom() 方法：

```
var dictionaries2 = dictionaries.Where(d =>
    {
        var type = d.GetType();
        return type.IsGenericType && typeof(IDictionary<,>).IsAssignableFrom(type.GetGenericTypeDefinition());
    }); // count == 0!! 
```

我们不会得到任何实例

所以最好的方法是获取所有接口并检查它们是否是字典接口：

```
var dictionaryInterfaces = new[]
{
    typeof(IDictionary<,>),
    typeof(IDictionary),
    typeof(IReadOnlyDictionary<,>),
};

var dictionaries2 = dictionaries
    .Where(d => d.GetType().GetInterfaces()
        .Any(t=> dictionaryInterfaces
            .Any(i=> i == t || t.IsGenericType && i == t.GetGenericTypeDefinition()))) // count == 5 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T19:23:03.590

您可以检查它是否实现了[IDictionary](http://msdn.microsoft.com/en-us/library/system.collections.idictionary.aspx)。您只需要使用[DictionaryEntry](http://msdn.microsoft.com/en-us/library/system.collections.dictionaryentry.aspx)类进行枚举。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T19:23:01.280

您可以更通用一点，而是询问它是否实现了`IDictionary`. 然后 KeyValue 集合将 contina plain `Objects`。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T20:21:00.407

我相信警告已经到位。

当您测试一个对象是否“是”某物时，您正在重新实现（部分）类型系统。第一个“is a”通常紧随其后的是第二个，很快你的代码就会充满类型检查，类型系统应该很好地处理这些检查——至少在面向对象的设计中是这样。

当然，我对这个问题的背景一无所知。我知道我们自己的代码库中有一个 2000 行的文件，它处理 50 个不同的对象到字符串的转换...... :(

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-05T23:59:24.273

```
if(typeof(IDictionary).IsAssignableFrom(listBox.ItemsSource.GetType()))
{

} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-06-22T04:24:23.067

我来自[确定类型是否为字典](https://stackoverflow.com/questions/16956903/determine-if-type-is-dictionary)，那里的答案都没有充分解决我的问题。

这里最接近的答案来自[Lukas Klusis](https://stackoverflow.com/users/2357702/lukas-klusis)，但没有给出`IsDictionary(Type type)`方法。这是从他的回答中汲取灵感的方法：

```
private static Type[] dictionaryInterfaces = 
{
  typeof(IDictionary<,>),
  typeof(System.Collections.IDictionary),
  typeof(IReadOnlyDictionary<,>),
};

public static bool IsDictionary(Type type) 
{
   return dictionaryInterfaces
    .Any(dictInterface =>
        dictInterface == type || // 1
        (type.IsGenericType && dictInterface == type.GetGenericTypeDefinition()) || // 2
        type.GetInterfaces().Any(typeInterface => // 3
                                 typeInterface == dictInterface ||
                                 (typeInterface.IsGenericType && dictInterface == typeInterface.GetGenericTypeDefinition())));
} 
```

`// 1`地址`public System.Collections.IDictionary MyProperty {get; set;}`

`// 2`地址`public IDictionary<SomeObj, SomeObj> MyProperty {get; set;}`

`// 3`（即第二个`.Any`）解决了`type`实现任何一种`dictionaryInterfaces`类型的任何场景。

其他答案的问题——假设他们解决了#3——是他们没有解决#1和#2。这是可以理解的，因为获取和检查属性的类型可能并不常见。但是，如果您像我一样，并且该场景*是*您用例的一部分，那就去吧！

# networking - WampServer 可以在生产中成功使用吗？

> ID：123187
> 
> 赞同：14
> 
> 时间：2008-09-23T19:21:18.007
> 
> 标签：networking, wamp, wampserver

WampServer 可以在生产中成功使用吗？这是一个坏主意吗？

所以每个人都知道，我不明白这有多重要，我们已经为 Windows 专用盒子付费，并且我们拥有现有的 IIS 应用程序。我们只是想使用一个基于 PHP 的 CMS，它在 apache 上安装更容易（因为它有一些依赖项）。因此，正如标题所示，windows、apache、php 和 mysql 是必需的。

此外，我正在专门谈论 WAMP 的 WampServer 风格。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-25T13:39:08.797

如果你不上网，没有任何理由不上网。当然，您必须查看所有正常的警告 - 备份等。

与其使用已经制作好的，为什么不尝试自己做呢？这将是一次很好的学习经历，而且他们真的并不难合作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-05-09T13:16:11.223

WAMP 适用于生产 Intranet。我们使用 FLEX (front END) /PHP/MYSQL (BACKEND) 开发了一个解决方案，它已经运行了一年了。您只需要保护运行 WAMP 的服务器。WAMP 只是一个在 Windows 平台上轻松配置 APACHE/PHP/MYSQL 的工具。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T19:37:29.903

WampServer 自己说它们不适合生产，只适合开发。安全问题、负载平衡等肯定是其中的一部分……另外，在 Windows 上部署 Apache 只是一场噩梦。

使用灯。或者，使用 IIS...如果您要部署 Windows 生产服务器（不要），请使用 IIS。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T19:36:11.607

LAMP 更稳定，但我在两个拥有 1000 多个用户的组织中成功运行了内部网站。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T19:41:43.373

我不明白为什么不这样做，但是当您可以很容易地在 IIS 上安装 PHP 时，为什么还要在 Windows 上使用 Apache？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T04:06:54.140

我喜欢唯一一个通过关注 OP 询问 WampServer 产品的一体化产品这一事实来回答实际问题的人的评分为 -1。重申他所说的话，是的，在生产环境中使用它是一个坏主意。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-10-25T12:21:57.747

我在 Windows Server 2003 上使用 WAMP 作为 Intranet 的生产服务器。同时访问 MySQL 和 SQL Server。我们的用户并不多，但到目前为止我没有任何问题。易于配置，易于维护，可以在 Apache 中对域用户进行身份验证......也许在重负载环境下它不是那么好，但对我来说是现在完美的解决方案。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-08-15T14:40:48.840

是的，它可以在您安装安全 WAMP 发行版的条件下用于生产。是的，它可以在 Internet 上运行，而不仅仅是 Intranet。

这是用于生产的安全 WAMP 的链接，您可以在其中自定义安全级别和其他设置以适应生产环境。

[http://securewamp.org/en/](http://securewamp.org/en/)

即使在高流量网站上，Windows 和 WAMP 也可以成功用于生产，但是您需要进行更改并从 mod_php 切换到 FCGID。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-09-23T19:30:05.880

为什么不直接使用 LAMP？PHP 代码是可移植的。我使用 WAMP 进行开发，使用 LAMP 进行生产。

WAMP 可能适用于生产，但为什么不直接使用 LAMP？

# .net - 我如何从片段中逃脱？(Vb.Net)

> ID：123188
> 
> 赞同：6
> 
> 时间：2008-09-23T19:22:02.920
> 
> 标签：.net, vb.net, code-snippets

在 C# 中，当我输入完一个片段的字段后，我可以按 Enter 进入下一行。VB中的等效键是什么？

编辑：我不喜欢使用鼠标。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T19:50:52.103

哇...我当然希望他们能尽快改善这一点。

同时，以防万一，我在自定义片段的末尾创建了一个额外的替换字段 ($Enter$)。这允许我通过字段 [tab]，然后在到达列表末尾时键入 [DownArrow] [Enter]。

就像是....

```
private _$PropertyName$ As $PropertyType$
Public WriteOnly Property $PropertyName$() As $PropertyType$
     Set(ByVal value as $PropertyType$)
          _$PropertyName$ = value
     End Set
End Property $Enter$ 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T19:23:03.387

不知道关键，但我使用*right-click -> Hide Snippet Highlighting*。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T19:30:10.420

事实证明没有一个 - VB.NET 片段支持落后于 c#

没有支持

*   片段中的 $end$
*   ClassName() 或其他函数
*   片段提示。

还有字段选项卡问题 - 在 c# 中，您只能通过*唯一*字段进行选项卡。在 vb.net 中，您可以浏览所有选项卡。

简而言之，使用片段 n vb.net 并不那么有趣。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T21:25:20.580

在编辑片段的任何时候，您都可以使用向上/向下箭头键退出它。还是我误解了您要做什么？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T00:33:08.773

你不能只使用向下箭头键吗？也许我误解了你的问题。

作为记录，VB 片段确实支持工具提示（提示）和帮助 URL。

# python - 如何复制文件？

> ID：123198
> 
> 赞同：3231
> 
> 时间：2008-09-23T19:23:48.643
> 
> 标签：python, file, copy, filesystems, file-copying

如何在 Python 中复制文件？

[`os`](https://docs.python.org/library/os.html) 我在模块下找不到任何东西。

* * *

## 回答 #1

> 赞同：3991
> 
> 时间：2008-09-23T19:25:35.393

[`shutil`](http://docs.python.org/3/library/shutil.html)有很多方法可以使用。其中之一是：

```
import shutil

shutil.copyfile(src, dst)

# 2nd option
shutil.copy(src, dst)  # dst can be a folder; use shutil.copy2() to preserve timestamp 
```

*   将命名文件的内容复制`src`到名为`dst`. 两者`src`和都`dst`需要是文件的完整文件名，包括路径。
*   目标位置必须是可写的；否则，`IOError`将引发异常。
*   如果`dst`已经存在，它将被替换。
*   无法使用此功能复制字符或块设备和管道等特殊文件。
*   `copy`和是路径名，以`src`s给出。`dst``str`

另`shutil`一种查看方法是[`shutil.copy2()`](https://docs.python.org/3/library/shutil.html#shutil.copy2). 它很相似，但保留了更多元数据（例如时间戳）。

如果您使用`os.path`操作，请使用`copy`而不是`copyfile`. `copyfile`只会接受字符串。

* * *

## 回答 #2

> 赞同：1824
> 
> 时间：2015-05-20T20:01:48.237

| 功能 | 复制 元数据 | 复制 权限 | 使用文件对象 | 目的地 可能是目录 |
| --- | --- | --- | --- | --- |
| [shutil.copy](https://docs.python.org/3/library/shutil.html#shutil.copy) | 不 | 是的 | 不 | 是的 |
| [shutil.copyfile](https://docs.python.org/3/library/shutil.html#shutil.copyfile) | 不 | 不 | 不 | 不 |
| [shutil.copy2](https://docs.python.org/3/library/shutil.html#shutil.copy2) | 是的 | 是的 | 不 | 是的 |
| [shutil.copyfileobj](https://docs.python.org/3/library/shutil.html#shutil.copyfileobj) | 不 | 不 | 是的 | 不 |

* * *

## 回答 #3

> 赞同：878
> 
> 时间：2008-09-23T19:29:41.810

[`copy2(src,dst)`](https://docs.python.org/2/library/shutil.html#shutil.copy2)通常比[`copyfile(src,dst)`](https://docs.python.org/2/library/shutil.html#shutil.copyfile)因为：

*   它允许`dst`是一个*目录*（而不是完整的目标文件名），在这种情况下，基本[名称](https://docs.python.org/2/library/os.path.html#os.path.basename)`src`用于创建新文件；
*   它在文件元数据中保留了原始修改和访问信息（mtime 和 atime）（但是，这会带来一些开销）。

这是一个简短的例子：

```
import shutil
shutil.copy2('/src/dir/file.ext', '/dst/dir/newname.ext') # complete target filename given
shutil.copy2('/src/file.ext', '/dst/dir') # target filename is /dst/dir/file.ext 
```

* * *

## 回答 #4

> 赞同：195
> 
> 时间：2018-01-22T03:05:32.227

在 Python 中，您可以使用复制文件

*   **[`shutil`](https://docs.python.org/3/library/shutil.html)**模块
*   **[`os`](https://docs.python.org/3/library/os.html)**模块
*   **[`subprocess`](https://docs.python.org/3/library/subprocess.html)**模块

* * *

```
import os
import shutil
import subprocess 
```

* * *

### [`shutil`](https://docs.python.org/3/library/shutil.html)1）使用模块复制文件

**[`shutil.copyfile`](https://docs.python.org/3/library/shutil.html#shutil.copyfile)** 签名

```
shutil.copyfile(src_file, dest_file, *, follow_symlinks=True)

# example    
shutil.copyfile('source.txt', 'destination.txt') 
```

* * *

**[`shutil.copy`](https://docs.python.org/3/library/shutil.html#shutil.copy)** 签名

```
shutil.copy(src_file, dest_file, *, follow_symlinks=True)

# example
shutil.copy('source.txt', 'destination.txt') 
```

* * *

**[`shutil.copy2`](https://docs.python.org/3/library/shutil.html#shutil.copy2)** 签名

```
shutil.copy2(src_file, dest_file, *, follow_symlinks=True)

# example
shutil.copy2('source.txt', 'destination.txt') 
```

* * *

**[`shutil.copyfileobj`](https://docs.python.org/3/library/shutil.html#shutil.copyfileobj)** 签名

```
shutil.copyfileobj(src_file_object, dest_file_object[, length])

# example
file_src = 'source.txt'  
f_src = open(file_src, 'rb')

file_dest = 'destination.txt'  
f_dest = open(file_dest, 'wb')

shutil.copyfileobj(f_src, f_dest) 
```

* * *

### [`os`](https://docs.python.org/3/library/os.html)2）使用模块复制文件

**[`os.popen`](https://docs.python.org/3/library/os.html#os.popen)** 签名

```
os.popen(cmd[, mode[, bufsize]])

# example
# In Unix/Linux
os.popen('cp source.txt destination.txt') 

# In Windows
os.popen('copy source.txt destination.txt') 
```

* * *

**[`os.system`](https://docs.python.org/3/library/os.html#os.system)** 签名

```
os.system(command)

# In Linux/Unix
os.system('cp source.txt destination.txt')  

# In Windows
os.system('copy source.txt destination.txt') 
```

* * *

### [`subprocess`](https://docs.python.org/3/library/subprocess.html)3）使用模块复制文件

**[`subprocess.call`](https://docs.python.org/3/library/subprocess.html#subprocess.call)** 签名

```
subprocess.call(args, *, stdin=None, stdout=None, stderr=None, shell=False)

# example (WARNING: setting `shell=True` might be a security-risk)
# In Linux/Unix
status = subprocess.call('cp source.txt destination.txt', shell=True) 

# In Windows
status = subprocess.call('copy source.txt destination.txt', shell=True) 
```

* * *

**[`subprocess.check_output`](https://docs.python.org/3/library/subprocess.html#subprocess.check_output)** 签名

```
subprocess.check_output(args, *, stdin=None, stderr=None, shell=False, universal_newlines=False)

# example (WARNING: setting `shell=True` might be a security-risk)
# In Linux/Unix
status = subprocess.check_output('cp source.txt destination.txt', shell=True)

# In Windows
status = subprocess.check_output('copy source.txt destination.txt', shell=True) 
```

* * *

* * *

## 回答 #5

> 赞同：171
> 
> 时间：2017-07-09T11:50:12.380

您可以使用[`shutil`](https://docs.python.org/3/library/shutil.html)包中的一种复制功能：

```
－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－- －－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－ >－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－一样
功能保存支持接受副本其他
                      权限目录 dest。文件 obj 元数据  
―――――――――――――――――――――――――――――――――――――――――――――――― ――――――――――――――――――――――――――――
shutil.copy               ✔ ✔ ☐ ☐
 shutil.copy2              ✔ ✔ ☐ ✔
 shutil.copyfile           ☐ ☐ ☐ ☐
 shutil.copyfileobj        ☐ ☐ ✔ ☐
－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－- －－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－ >－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－一样

```

例子：

```
import shutil
shutil.copy('/etc/hostname', '/var/tmp/testhostname') 
```

* * *

## 回答 #6

> 赞同：108
> 
> 时间：2008-09-24T07:21:12.083

复制文件是一个相对简单的操作，如下面的示例所示，但您应该改用[shutil stdlib 模块](https://docs.python.org/library/shutil.html)。

```
def copyfileobj_example(source, dest, buffer_size=1024*1024):
    """      
    Copy a file from source to dest. source and dest
    must be file-like objects, i.e. any object with a read or
    write method, like for example StringIO.
    """
    while True:
        copy_buffer = source.read(buffer_size)
        if not copy_buffer:
            break
        dest.write(copy_buffer) 
```

如果要按文件名复制，可以执行以下操作：

```
def copyfile_example(source, dest):
    # Beware, this example does not handle any edge cases!
    with open(source, 'rb') as src, open(dest, 'wb') as dst:
        copyfileobj_example(src, dst) 
```

* * *

## 回答 #7

> 赞同：81
> 
> 时间：2008-09-23T19:27:23.157

使用[shutil 模块](https://docs.python.org/3/library/shutil.html)。

```
copyfile(src, dst) 
```

将名为 src 的文件的内容复制到名为 dst 的文件中。目标位置必须是可写的；否则，将引发 IOError 异常。如果 dst 已经存在，它将被替换。无法使用此功能复制字符或块设备和管道等特殊文件。src 和 dst 是以字符串形式给出的路径名。

查看[filesys](https://docs.python.org/3/library/filesys.html)以了解标准 Python 模块中可用的所有文件和目录处理功能。

* * *

## 回答 #8

> 赞同：50
> 
> 时间：2011-03-15T10:11:21.953

目录和文件复制示例 - 来自 Tim Golden 的 Python Stuff：

[http://timgolden.me.uk/python/win32_how_do_i/copy-a-file.html](http://timgolden.me.uk/python/win32_how_do_i/copy-a-file.html)

```
import os
import shutil
import tempfile

filename1 = tempfile.mktemp (".txt")
open (filename1, "w").close ()
filename2 = filename1 + ".copy"
print filename1, "=>", filename2

shutil.copy (filename1, filename2)

if os.path.isfile (filename2): print "Success"

dirname1 = tempfile.mktemp (".dir")
os.mkdir (dirname1)
dirname2 = dirname1 + ".copy"
print dirname1, "=>", dirname2

shutil.copytree (dirname1, dirname2)

if os.path.isdir (dirname2): print "Success" 
```

* * *

## 回答 #9

> 赞同：34
> 
> 时间：2017-08-15T13:46:42.370

对于小文件并且仅使用 python 内置，您可以使用以下单行：

```
with open(source, 'rb') as src, open(dest, 'wb') as dst: dst.write(src.read()) 
```

对于文件太大或内存至关重要的应用程序，这不是最佳方式，因此应该首选[Swati 的答案。](https://stackoverflow.com/a/123212/6327658)

* * *

## 回答 #10

> 赞同：34
> 
> 时间：2018-01-16T03:25:13.807

首先，我制作了一份详尽的shutil方法备忘单供您参考。

```
shutil_methods =
{'copy':['shutil.copyfileobj',
          'shutil.copyfile',
          'shutil.copymode',
          'shutil.copystat',
          'shutil.copy',
          'shutil.copy2',
          'shutil.copytree',],
 'move':['shutil.rmtree',
         'shutil.move',],
 'exception': ['exception shutil.SameFileError',
                 'exception shutil.Error'],
 'others':['shutil.disk_usage',
             'shutil.chown',
             'shutil.which',
             'shutil.ignore_patterns',]
} 
```

其次，在例子中解释复制的方法：

> 1.  `shutil.copyfileobj(fsrc, fdst[, length])`操作打开的对象

```
In [3]: src = '~/Documents/Head+First+SQL.pdf'
In [4]: dst = '~/desktop'
In [5]: shutil.copyfileobj(src, dst)
AttributeError: 'str' object has no attribute 'read'
#copy the file object
In [7]: with open(src, 'rb') as f1,open(os.path.join(dst,'test.pdf'), 'wb') as f2:
    ...:      shutil.copyfileobj(f1, f2)
In [8]: os.stat(os.path.join(dst,'test.pdf'))
Out[8]: os.stat_result(st_mode=33188, st_ino=8598319475, st_dev=16777220, st_nlink=1, st_uid=501, st_gid=20, st_size=13507926, st_atime=1516067347, st_mtime=1516067335, st_ctime=1516067345) 
```

> 2.  `shutil.copyfile(src, dst, *, follow_symlinks=True)` 复制和重命名

```
In [9]: shutil.copyfile(src, dst)
IsADirectoryError: [Errno 21] Is a directory: ~/desktop'
#so dst should be a filename instead of a directory name 
```

> 3.  `shutil.copy()` 复制而不保留元数据

```
In [10]: shutil.copy(src, dst)
Out[10]: ~/desktop/Head+First+SQL.pdf'
#check their metadata
In [25]: os.stat(src)
Out[25]: os.stat_result(st_mode=33188, st_ino=597749, st_dev=16777220, st_nlink=1, st_uid=501, st_gid=20, st_size=13507926, st_atime=1516066425, st_mtime=1493698739, st_ctime=1514871215)
In [26]: os.stat(os.path.join(dst, 'Head+First+SQL.pdf'))
Out[26]: os.stat_result(st_mode=33188, st_ino=8598313736, st_dev=16777220, st_nlink=1, st_uid=501, st_gid=20, st_size=13507926, st_atime=1516066427, st_mtime=1516066425, st_ctime=1516066425)
# st_atime,st_mtime,st_ctime changed 
```

> 4.  `shutil.copy2()` 复制并保留元数据

```
In [30]: shutil.copy2(src, dst)
Out[30]: ~/desktop/Head+First+SQL.pdf'
In [31]: os.stat(src)
Out[31]: os.stat_result(st_mode=33188, st_ino=597749, st_dev=16777220, st_nlink=1, st_uid=501, st_gid=20, st_size=13507926, st_atime=1516067055, st_mtime=1493698739, st_ctime=1514871215)
In [32]: os.stat(os.path.join(dst, 'Head+First+SQL.pdf'))
Out[32]: os.stat_result(st_mode=33188, st_ino=8598313736, st_dev=16777220, st_nlink=1, st_uid=501, st_gid=20, st_size=13507926, st_atime=1516067063, st_mtime=1493698739, st_ctime=1516067055)
# Preseved st_mtime 
```

> 5.  `shutil.copytree()`

递归复制以 src 为根的整个目录树，返回目标目录

* * *

## 回答 #11

> 赞同：18
> 
> 时间：2014-12-19T23:18:02.150

你可以使用`os.system('cp nameoffilegeneratedbyprogram /otherdirectory/')`

或者就像我做的那样，

```
os.system('cp '+ rawfile + ' rawdata.dat') 
```

`rawfile`我在程序中生成的名称在哪里。

这是一个仅限 Linux 的解决方案

* * *

## 回答 #12

> 赞同：18
> 
> 时间：2019-04-25T14:09:14.553

从[Python 3.5](https://docs.python.org/3/library/pathlib.html#pathlib.Path.write_bytes)开始，您可以对小文件（即：文本文件、小 jpeg）执行以下操作：

```
from pathlib import Path

source = Path('../path/to/my/file.txt')
destination = Path('../path/where/i/want/to/store/it.txt')
destination.write_bytes(source.read_bytes()) 
```

`write_bytes`将覆盖目的地位置的任何内容

* * *

## 回答 #13

> 赞同：14
> 
> 时间：2015-05-25T05:11:47.297

对于大文件，我所做的是逐行读取文件并将每一行读入一个数组。然后，一旦数组达到一定大小，将其附加到新文件中。

```
for line in open("file.txt", "r"):
    list.append(line)
    if len(list) == 1000000: 
        output.writelines(list)
        del list[:] 
```

* * *

## 回答 #14

> 赞同：13
> 
> 时间：2019-03-23T00:46:19.783

```
open(destination, 'wb').write(open(source, 'rb').read()) 
```

以读模式打开源文件，以写模式写入目标文件。

* * *

## 回答 #15

> 赞同：13
> 
> 时间：2021-09-24T10:47:31.190

`shutil`模块提供了一些关于`files`. 它支持文件`copying`和`removal`.

请参阅下表了解您的使用案例。

| 功能 | 利用 文件对象 | 保留 元数据 | 保留 权限 | 支持 目录目标。 |
| --- | --- | --- | --- | --- |
| [shutil.copyfileobj](https://docs.python.org/3/library/shutil.html#shutil.copyfileobj) | ✔</td> | **ⅹ</strong>** | **ⅹ</strong>** | **ⅹ</strong>** |
| [shutil.copyfile](https://docs.python.org/3/library/shutil.html#shutil.copyfile) | **ⅹ</strong>** | **ⅹ</strong>** | **ⅹ</strong>** | **ⅹ</strong>** |
| [shutil.copy2](https://docs.python.org/3/library/shutil.html#shutil.copy2) | **ⅹ</strong>** | ✔</td> | ✔</td> | ✔</td> |
| [shutil.copy](https://docs.python.org/3/library/shutil.html#shutil.copy) | **ⅹ</strong>** | **ⅹ</strong>** | ✔</td> | ✔</td> |

* * *

## 回答 #16

> 赞同：12
> 
> 时间：2016-04-04T07:08:24.617

用于`subprocess.call`复制文件

```
from subprocess import call
call("cp -p <file> <file>", shell=True) 
```

* * *

## 回答 #17

> 赞同：9
> 
> 时间：2020-12-06T12:50:51.520

这是一种简单的方法，无需任何模块。它类似于[这个答案](https://stackoverflow.com/questions/123198/how-do-i-copy-a-file-in-python/45694203#45694203)，但如果它是一个不适合 RAM 的大文件，它也可以工作：

```
with open('sourcefile', 'rb') as f, open('destfile', 'wb') as g:
    while True:
        block = f.read(16*1024*1024)  # work by blocks of 16 MB
        if not block:  # end of file
            break
        g.write(block) 
```

由于我们正在编写一个新文件，它不会保留修改时间等。如果需要，
我们可以使用它。[`os.utime`](https://docs.python.org/3/library/os.html#os.utime)

* * *

## 回答 #18

> 赞同：9
> 
> 时间：2021-01-13T20:36:51.740

以防你跌到这么远。答案是你需要完整的路径和文件名

```
import os

shutil.copy(os.path.join(old_dir, file), os.path.join(new_dir, file)) 
```

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2021-01-02T00:56:35.793

与接受的答案类似，如果您还想确保在目标路径中创建任何（不存在的）文件夹，以下代码块可能会派上用场。

```
from os import path, makedirs
from shutil import copyfile
makedirs(path.dirname(path.abspath(destination_path)), exist_ok=True)
copyfile(source_path, destination_path) 
```

正如接受的答案所指出的那样，这些行将覆盖目标路径中存在的任何文件，因此有时`if not path.exists(destination_path):`在此代码块之前添加：也可能很有用。

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2021-11-06T23:43:54.090

shutil.copy(src, dst, *, follow_symlinks=True)

* * *

## 回答 #21

> 赞同：-2
> 
> 时间：2019-06-10T10:05:55.417

Python 提供了内置函数，可以使用操作系统 Shell 实用程序轻松复制文件。

以下命令用于复制文件

```
shutil.copy(src,dst) 
```

以下命令用于复制带有元数据信息的文件

```
shutil.copystat(src,dst) 
```

# html - 修复了 HTML 中的 TD 高度属性

> ID：123216
> 
> 赞同：3
> 
> 时间：2008-09-23T19:25:47.577
> 
> 标签：html, css

我不能让 td "Date" 具有固定的高度。如果 Body 部分的 td Date 元素比它应该的大 - 即使我将 Date height 设置为 10% 并将 Body height 设置为 90%。有什么建议么？

```
<tr>
  <td class="Author" rowspan="2">
    <a href="#">Claude</a><br />
    <a href="#"><img src="Users/4/Avatar.jpeg" style="border-width:0px;" /></a>        
  </td>
  <td class="Date">
    Sent:
    <span>18.08.2008 20:49:28</span>
  </td>
</tr>
<tr>
  <td class="Body">
    <span>Id lacinia lacus arcu non quis mollis sit. Ligula elit. Ultricies elit cursus. Quis ipsum nec rutrum id tellus aliquam. Tortor arcu fermentum nibh justo leo ante vitae fringilla. Pulvinar aliquam. Fringilla mollis facilisis.</span>
  </td>
</tr> 
```

我现在的CSS是：

```
table.ForumThreadViewer td.Date {
  text-align: left;
  vertical-align: top;
  font-size: xx-small;
  border-bottom: solid 1 black;
  height: 20px;
}

table.ForumThreadViewer td.Body {
  text-align: left;
  vertical-align: top;
  border-top: solid 1 black;
}

table.ForumThreadViewer td.Author {
  vertical-align: top;
  text-align: left;
} 
```

它适用于FF，但不适用于IE。:(

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T19:32:03.270

当您使用百分比时，它们相对于它们的容器，即使那样，它也只适用于某些类型的元素。我想要使​​它起作用，您需要将高度应用于`<tr>`s，并给出`<table>`高度。如果`<table>`高度也是相对的，你也需要给它的容器一个高度。

**但是看看你的数据，你*真的*确定你应该使用表格吗？！**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T03:34:53.453

奥利是对的！然后给出您发布的屏幕截图，您使用了错误的标记。你可以使用更像这样的东西：

```
<div class="post">
  <div class="author">
    <a href="#">Claude</a><br />
    <a href="#"><img src="Users/4/Avatar.jpeg" /></a>        
  </div>
  <div class="content">
    <div class="date">Sent: 18.08.2008 20:49:28</div>
    <div class="body">
      This is the content of the message.
    </div>
  </div>
  <div class="clear">&nbsp;</div>
</div> 
```

像这样的CSS：

```
div.post {
  border: 1px solid #999;
  margin-bottom: -1px; /* collapse the borders between posts */
}
div.author {
  float: left;
  width: 150px;
  border-right: 1px solid #999;
}
div.content {
  border-left: 1px solid #999;
  margin-left: 150px;
}
div.date {
  border-bottom: 1px solid #999;
}
div.clear {
  clear: both;
  height: 0;
  line-height: 0;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T19:30:58.500

CSS

```
.Date {
    height: 50px;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T19:31:19.793

我不完全理解你的问题，你是说如果你使用这个：

```
.Date {
 height: 10%
}
.Body {
 height: 90%;
} 
```

`.Date td`比它应该的大吗？如果不设置绝对高度，你怎么知道它应该有多大？您是否考虑了边框和填充？

您可以尝试添加或仅使用不间断空格 ( )`colspan="2"`的`.Body td`额外元素`<td>``&nbsp;`

# sql - 在 Common Lisp 中使用的最佳 SQL 库是什么？

> ID：123234
> 
> 赞同：16
> 
> 时间：2008-09-23T19:29:13.667
> 
> 标签：sql, database, postgresql, lisp, common-lisp

理想情况下，可以与 Oracle、MS SQL Server、MySQL 和 Posgress 一起使用。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-23T19:52:59.523

如果您的意思是 lisp 的 common lisp，那么就是**[cl-rdbms](http://common-lisp.net/project/cl-rdbms/)**。它在 postgres 上经过大量测试（使用[postmodern](http://common-lisp.net/project/postmodern/)作为后端库），它有一个玩具 sqlite 后端，它还有一个基于 OCI 的 oracle 后端。它支持抽象出不同的 sql 方言，具有可安装在例如 [] 字符上的 sql 准引号语法扩展。

我不确定它是否是最好的，而且我还是有偏见...... :) 但我们最终在使用[clsql](http://clsql.b9.com/)一段时间后推出了自己的 lib，这是我认为 cl 使用最广泛的 sql lib。

请参阅[有关 sql 的 cliki 页面](http://www.cliki.net/SQL)以获取更多参考。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-23T19:43:18.470

目前没有支持您提到的所有 SQL 后端的开源库。[CLSQL](http://clsql.b9.com/)非常接近（仅支持 MS SQL）。替代方案是：

*   [CL-RDBMS](http://common-lisp.net/project/cl-rdbms/)（通过 Postmodern 和 SQLite3 支持 Oracle、Postgres）
*   [后现代](http://common-lisp.net/project/postmodern/)（仅限 Postgres）。

如果你可以使用商业的 Lisp，你可以试试[Lispworks 自带](http://www.lispworks.com/documentation/sql-tutorial/index.html)的 CommonSQL，它支持你提到的所有数据库。

CLSQL 看起来是目前最流行的开源库。不幸的是，它似乎有点腐烂，开发人员不得不做出一些妥协来支持所有这些平台。

如果 RDB 后端不是约束，那么我推荐 Postmodern。它有很好的文档记录，并且有一个干净的 API（以及一种编译为 SQL 的漂亮小语言）。此外，它维护得很好并且足够小以保持可理解和可扩展。它只关注 Postgres，而不是试图为所有人服务。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-23T05:37:21.773

Allegro Common Lisp 有一个[ODBC](http://www.franz.com/support/documentation/8.1/doc/aodbc.htm)库和一个[MySQL 特定的](http://franz.com/support/documentation/8.1/doc/mysql.htm)库，两者都有详尽的文档记录。我用的是 MySQL 的；没有惊喜。

# linux - Bash 输出重定向的问题

> ID：123235
> 
> 赞同：10
> 
> 时间：2008-09-23T19:29:26.727
> 
> 标签：linux, bash

我试图删除文件中除最后一行以外的所有行，但以下命令不起作用，尽管 file.txt 不为空。

```
$cat file.txt |tail -1 > file.txt

$cat file.txt 
```

为什么会这样？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-23T19:33:25.203

通过管道从文件重定向回同一个文件是不安全的；如果在开始读取第一阶段`file.txt`之前设置管道的最后阶段时被 shell 覆盖，则最终输出为空。`tail`

请改为执行以下操作：

```
tail -1 file.txt >file.txt.new && mv file.txt.new file.txt 
```

...好吧，实际上，不要在生产代码中这样做；特别是如果您在安全敏感的环境中并以 root 身份运行，则以下内容更合适：

```
tempfile="$(mktemp file.txt.XXXXXX)"
chown --reference=file.txt -- "$tempfile"
chmod --reference=file.txt -- "$tempfile"
tail -1 file.txt >"$tempfile" && mv -- "$tempfile" file.txt 
```

另一种方法（避免临时文件，除非`<<<`在您的平台上隐式创建它们）如下：

```
lastline="$(tail -1 file.txt)"; cat >file.txt <<<"$lastline" 
```

（上面的实现是特定于 bash 的，但在 echo 没有的情况下有效——例如当最后一行包含“--version”时）。

最后，可以使用来自[moreutils](http://kitenet.net/~joey/code/moreutils/)的海绵：

```
tail -1 file.txt | sponge file.txt 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T14:56:43.597

您可以使用 sed 从文件中删除除最后一行之外的所有行：

```
sed -i '$!d' file 
```

*   **-i**告诉 sed 将文件替换到位；否则，结果将写入 STDOUT。
*   **$**是匹配文件最后一行的地址。
*   **d**是删除命令。在这种情况下，它被**!** *，因此所有与地址不*匹配的行都将被删除。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T19:39:29.430

在 'cat' 被执行之前，Bash 已经打开了 'file.txt' 进行写入，清除了它的内容。

通常，不要在同一语句中写入您正在读取的文件。这可以通过写入不同的文件来解决，如上所述：

```
$cat 文件.txt | 尾 -1 >另一个文件.txt
$mv anotherfile.txt file.txt
```

或使用[moreutils](http://kitenet.net/~joey/code/moreutils/)中的海绵之类的实用程序：

```
$cat 文件.txt | 尾-1 | 海绵文件.txt
```

这是有效的，因为海绵会等到其输入流结束后再打开其输出文件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T19:43:30.060

当您将命令字符串提交给 bash 时，它会执行以下操作：

1.  创建一个 I/O 管道。
2.  启动“/usr/bin/tail -1”，从管道读取，并写入 file.txt。
3.  启动“/usr/bin/cat file.txt”，写入管道。

当 'cat' 开始阅读时，'file.txt' 已经被 'tail' 截断了。

这都是 Unix 和 shell 环境设计的一部分，并且可以追溯到最初的 Bourne shell。'这是一个功能，而不是一个错误。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-23T19:44:42.493

tmp=$(tail -1 file.txt); 回声 $tmp > 文件.txt;

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-03-25T03:56:59.177

这在 Linux shell 中运行良好：

```
replace_with_filter() {
  local filename="$1"; shift
  local dd_output byte_count filter_status dd_status
  dd_output=$("$@" <"$filename" | dd conv=notrunc of="$filename" 2>&1; echo "${PIPESTATUS[@]}")
  { read; read; read -r byte_count _; read filter_status dd_status; } <<<"$dd_output"
  (( filter_status > 0 )) && return "$filter_status"
  (( dd_status > 0 )) && return "$dd_status"
  dd bs=1 seek="$byte_count" if=/dev/null of="$filename"
}

replace_with_filter file.txt tail -1 
```

`dd`的“notrunc”选项用于将过滤后的内容写回原位，而`dd`再次需要（使用字节数）来实际截断文件。如果新文件大小大于或等于旧文件大小，`dd`则不需要第二次调用。

与文件复制方法相比，它的优点是：1) 不需要额外的磁盘空间，2) 对大文件的性能更快，以及 3) 纯 shell（dd 除外）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T19:34:23.220

正如 Lewis Baumstark 所说，它不喜欢您写入相同的文件名。

这是因为 shell 打开“file.txt”并在“cat file.txt”运行之前截断它以进行重定向。所以，你必须

```
tail -1 file.txt > file2.txt; mv file2.txt file.txt 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-03-25T05:15:54.063

仅针对这种情况，可以使用

```
猫 <文件.txt | （rm file.txt；tail -1 > file.txt）
```

这将在连接“cat”与“（...）”中的子shell之前打开“file.txt”。“rm file.txt”将在子shell打开它以写入“tail”之前从磁盘中删除引用，但内容仍然可以通过传递给“cat”的打开的描述符获得，直到它关闭stdin。所以你最好确保这个命令会完成，否则“file.txt”的内容将会丢失

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-03-25T05:24:30.030

```
echo "$(tail -1 file.txt)" > file.txt 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T19:31:41.243

似乎不喜欢您将其写回相同文件名的事实。如果您执行以下操作，它将起作用：

```
$cat file.txt | tail -1 > anotherfile.txt 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T19:34:37.947

`tail -1 > file.txt`将覆盖您的文件，导致 cat 读取一个空文件，因为重写将在您的管道中的任何命令执行**之前发生。**

# sql-server - 如何从 MSSQL 或 Access 自动将表导出到适当的 XML 文件中？

> ID：123236
> 
> 赞同：1
> 
> 时间：2008-09-23T19:29:39.720
> 
> 标签：sql-server, ms-access

我们有一个客户请求 XML 格式的数据。通常这不是必需的，因为我们通常只是交出 Access 数据库或 csv 文件，这就足够了。但是在这种情况下，我需要自动从十几个表中导出正确的 XML。

如果我可以在 SQL Server 2005 之外完成，那将是首选。但是我无法为我的生活找到一种方法来做到这一点。我可以转储原始 xml 数据，但这只是每行带有属性值的标签。我们需要一些代表表结构的东西。Access 有一个满足我们需求的 xml 格式的导出。但是我不确定如何实现自动化。它似乎无法通过 SQL 以任何方式使用，因此我试图追踪必要的代码以通过宏或 vbscript 导出 XML。

有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T17:42:53.883

如果您想要一个文档而不是一个片段，您可能需要一个两部分的解决方案。但是，这两个部分都可以在 SQL Server 中完成。

从 Tom 条目的评论中看起来就像您找到了 ELEMENTS 参数，因此您将字段作为子元素而不是属性获取。但是，您仍然会得到一个片段，因为您不会获得根节点。

有不同的方法可以处理这个问题。SQL Server[提供了一种](http://blogs.msdn.com/mrorke/archive/2005/06/28/433471.aspx)使用 XSLT 转换 XML 文档的方法，因此您可以创建 XSL 样式表以将查询结果包装在根元素中。您还可以添加客户架构所需的任何其他内容（假设他们有一个）。

如果您想将某些字段保留为属性并制作其他元素，您还可以使用 XSLT 移动这些字段，因此您最终可能会得到如下内容：

```
<customer id="204">
    <firstname>John</firstname>
    <lastname>Public</lastname>
</customer> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T19:41:13.047

研究使用 FOR XML AUTO。根据您的要求，您可能需要使用 EXPLICIT。

举个简单的例子：

```
SELECT
    *
FROM
    Customers
INNER JOIN Orders ON Orders.CustID = Customers.CustID
FOR XML AUTO 
```

这将生成一个嵌套的 XML 文档，其中包含客户内部的订单。然后你可以使用 SSIS 很容易地将它导出到一个文件中，我想。不过我自己没试过。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T19:39:25.127

[这里](http://www.microsoft.com/technet/scriptcenter/resources/officetips/oct05/tips1020.mspx)有一个宏的大纲，用于将数据从访问数据库导出到 xml 文件，这可能对您有用。

```
Const acExportTable = 0

Set objAccess = CreateObject("Access.Application")
objAccess.OpenCurrentDatabase "C:\Scripts\Test.mdb"

'Export the table "Inventory" to test.xml
objAccess.ExportXML acExportTable,"Inventory","c:\scripts\test.xml" 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T19:39:49.447

我能想到的最简单的方法是创建一个小应用程序来为你做这件事。您可以将其作为基本的 WinForm，然后使用 LinqToSql dbml 类来表示您的数据库。大多数时候，您可以使用 XmlSerializer 命名空间序列化这些对象。有时它比这更困难，具体取决于数据库的复杂性。查看这篇文章，了解有关 LinqToSql 和 Xml 序列化的一些详细信息： [http ://www.west-wind.com/Weblog/posts/147218.aspx](http://www.west-wind.com/Weblog/posts/147218.aspx)

希望有帮助。

# .net - 如何使用 XPathNodeIterator 遍历 XML 文件中的项目列表？

> ID：123239
> 
> 赞同：0
> 
> 时间：2008-09-23T19:29:43.527
> 
> 标签：.net, xml

这是我的 XML 文件的示例（稍作编辑，但您明白了）：

```
<HostCollection>
  <ApplicationInfo />
  <Hosts>
    <Host>
      <Name>Test</Name>
      <IP>192.168.1.1</IP>
    </Host>
    <Host>
      <Name>Test</Name>
      <IP>192.168.1.2</IP>
    </Host>
  </Hosts>
</HostCollection> 
```

当我的应用程序（VB.NET 应用程序）加载时，我想遍历主机列表及其属性并将它们添加到集合中。我希望我可以为此使用 XPathNodeIterator。我在网上找到的例子似乎有点混乱，我希望这里有人能澄清一下。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T19:37:11.497

您可以将它们加载到 XmlDocument 中并使用 XPath 语句填充 NodeList ...

```
Dim doc As XmlDocument = New XmlDocument()
doc.Load("hosts.xml")
Dim nodeList as XmlNodeList
nodeList = doc.SelectNodes("/HostCollectionInfo/Hosts/Host") 
```

然后遍历节点

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T19:43:14.413

```
 XPathDocument xpathDoc;
        using (StreamReader input = ...)
        {                
            xpathDoc = new XPathDocument(input);
        }

        XPathNavigator nav = xpathDoc.CreateNavigator();
        XmlNamespaceManager nsmgr = new XmlNamespaceManager(nav.NameTable);

        XPathNodeIterator nodes = nav.Select("/HostCollection/Hosts/Host", nsmgr);

        while (nodes.MoveNext())
        {
           // access the current Host with nodes.Current
        } 
```

# plugins - 用于自定义 CRM 的 Outlook 插件

> ID：123261
> 
> 赞同：6
> 
> 时间：2008-09-23T19:33:45.233
> 
> 标签：plugins, outlook, crm

我想编写一个插件，允许自定义编写的 CRM 读取和写入其本地 Outlook 客户端。我知道这会带来安全问题。但是，我的客户要求他们的 CRM “连接”到 Outlook。他们希望能够做到以下几点：

A) 当联系人向他们发送电子邮件（回复或独立电子邮件）时，他们希望将此电子邮件的详细信息输入 CRM。是的。他们希望我保存正文、发送时间和日期等。
B) 他们希望能够从 CRM 内部发送新电子邮件（或对现有电子邮件的回复）。基本上，“一个看起来像 Outlook 的发送/回复电子邮件表单的表单”。
C) 希望能够通过搜索标签/关键字工具来搜索联系人和相关电子邮件。（即，如果产品名称或代码出现在电子邮件中，那么他们希望在搜索中返回电子邮件）。D）在搜索了许多联系人之后，他们会想要准备一个邮件并向他们合格的潜在客户发送某种电子邮件公告。这可能是 50、100 或更多人。所以它必须能够允许批量邮寄。E) 给定一个新的潜在客户列表，即当前不在 CRM 中的联系人，他们会想要做同样的事情，如果他们从这个邮件中收到对潜在客户的回复，他们会希望将回复保存在数据库中，并且联系人是插入数据库。F) 他们也希望能够从 CRM 中使用 Outlook 的日历和任务列表功能。

或多或少，他们想要我创建的这个非常基本的（就像今天一样）CRM 以与 Outlook 集成，并让它无缝地集成，就好像它是 CRM 的附加组件一样。插件是我的想法...

但是，我不知道从哪里开始。我的环境是 Windows XP/Vista，将是 ASP.NET，我将使用 VB.NET 语言来完成这个。我需要什么？是否有资源可以描述如何按照我的要求构建 Outlook 插件？这不是 Exchange，没有一个客户端使用 Exchange（到目前为止还没有）。他们都运行 Outlook。主要是 2003 年。大多数客户端现在是 XP，但有些正在升级到 Vista。

出于某种原因，我似乎无法解决这个问题。我认为整个安全问题阻碍了我看过去可能是一件简单的事情的能力。客户不希望收到任何询问他们是否确定要向其联系人发送 382 电子邮件的安全消息的提示。不是一次，当然也不是 382 次。

我从哪里开始？我在互联网上搜索过类似的东西，但主要是我发现的是已经写好的产品，我必须从头开始写。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T19:50:27.830

我是为 Frankley Covey 时间管理工具创建原始 Outlook 插件的团队的一员。这真是一次冒险！

我要做的第一件事是让您的客户选择一个 Outlook 版本，并坚持使用它。不要让客户添加对其他 Outlook 版本的支持，除非他们愿意为此付费，并且愿意将交付时间推迟到合理的日期。

我所在的团队对[Slipstick](http://slipstick.com/)网站发誓。那里有几种针对 Outlook 安全提示的解决方案。

如果可以，请与 Microsoft 联系，看看他们是否可以为您提供您将使用的特定 Outlook 版本的对象模型。我们在大型彩色打印机上打印了这个模型，然后把它贴在一面大墙上。IIRC，它类似于 7'x5' 对象图。这帮助了很多人。

您最终可能会为您的 Outlook 代码创建特定的分类/命名空间。已经有一段时间了，但我记得一些关于点符号的东西，比如 .Email、.Task 和其他几个。我必须为 Outlook 任务对象创建几个新的点命名空间。

正如 razorfish 所说，查找新的 Visual Studio For Office 工具。这让一些事情变得容易多了。

与您的客户交谈，了解他们是否需要连接到 Exchange 服务器。有两种不同的方式来构建插件。一种模式只适用于 Outlook 本身，而另一种模式则适用于 Exchange。这对您的开发工作非常重要。这些模型非常不同，如果您选错了，您会花费额外的时间。

编辑：有几本书对此有所帮助。这些书籍适用于 Outlook 2000，因此您可能想查看是否有更新版本。

[使用 Microsoft Outlook 2000 技术参考构建应用程序](https://rads.stackoverflow.com/amzn/click/com/0735605815)

[使用 Outlook 2000、CDO、Exchange 和 Visual Basic 构建应用程序](https://rads.stackoverflow.com/amzn/click/com/0201615754)

两者都有很多关于如何与 Outlook 进行深度集成的信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T19:35:11.470

你应该看看[Visual Studio for Office Tools](http://msdn.microsoft.com/en-us/office/aa905533.aspx)。您可以轻松地为 Outlook、Word、Excel ......几乎整个 Microsoft Office 系列产品创建加载项。

你也可以看看[Add-In Express](http://www.add-in-express.com/)，但我对他们的控件不太满意，而且 2008 的 VSTO 非常易于使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T22:10:10.397

查看[Kayxo 洞察力](http://www.kayxo.com/products/qi_all.php)。它是一个用于创建您所描述的解决方案的框架。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-31T05:41:06.643

查看 www.softomate.com，他们为各种项目提供插件和集成解决方案。

# c# - 在.net中将字符串转换为日期

> ID：123263
> 
> 赞同：9
> 
> 时间：2008-09-23T19:34:04.810
> 
> 标签：c#, .net

我正在从 c# 中的平面文件中读取文本，并且需要测试某些值是否是日期。它们可以是 YYYYMMDD 格式或 MM/DD/YY 格式。在 .Net 中执行此操作的最简单方法是什么？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-23T19:40:27.870

```
string[] formats = {"yyyyMMdd", "MM/dd/yy"};
var Result = DateTime.ParseExact(input, formats, CultureInfo.CurrentCulture, DateTimeStyles.None); 
```

或者

```
DateTime result;
string[] formats = {"yyyyMMdd", "MM/dd/yy"};
DateTime.TryParseExact(input, formats, CultureInfo.CurrentCulture, DateTimeStyles.None, out result); 
```

MSDN 文档中有关[ParseExact](https://docs.microsoft.com/en-us/dotnet/api/system.datetime.parseexact)和[TryParseExact](https://docs.microsoft.com/en-us/dotnet/api/system.datetime.tryparseexact)的更多信息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T19:35:47.677

[DateTime.TryParse](http://msdn.microsoft.com/en-us/library/ch92fbc1.aspx)方法

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T19:47:43.607

您也可以尝试 TryParseExact 来设置确切的格式。方法，这里的文档：http: [//msdn.microsoft.com/en-us/library/ms131044.aspx](http://msdn.microsoft.com/en-us/library/ms131044.aspx)

例如

```
DateTime outDt;
bool blnYYYMMDD = 
     DateTime.TryParseExact(yourString,"yyyyMMdd"
                            ,CultureInfo.CurrentCulture,DateTimeStyles.None
                            , out outDt); 
```

我希望我能帮助你。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T19:43:22.543

你也可以做 Convert.ToDateTime

不确定两者的优点

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T19:46:48.197

如果失败，使用 TryParse 不会引发异常。此外，TryParse 将返回 True/False，表示转换成功。

问候...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T19:49:32.137

您可以使用 TryParse 方法同时检查有效性和解析。

```
DateTime output;
string input = "09/23/2008";
if (DateTime.TryParseExact(input,"MM/dd/yy", DateTimeFormatInfo.InvariantInfo, DateTimeStyles.None, out output) || DateTime.TryParseExact(input,"yyyyMMdd", DateTimeFormatInfo.InvariantInfo, DateTimeStyles.None, out output))
{
    //handle valid date
}
else
{
    //handle invalid date
} 
```

# sql - 为什么我会通过此表关系获得“多个级联路径”？

> ID：123274
> 
> 赞同：0
> 
> 时间：2008-09-23T19:36:59.983
> 
> 标签：sql, sql-server

我的数据库中有以下表关系：

```
 Parent
          /    \
    Child1      Child2
        \        /
        GrandChild 
```

我正在尝试创建 FK 关系，以便删除父表级联到子表和孙表。对于任何一个特定的孙子，它将成为一个或另一个子表的父级，但绝不会同时成为两个子表。

当我尝试将 ON DELETE CASCADE 添加到 FK 关系时，一切都很好，将它们添加到两个孩子的“一侧”（Parent-Child1-GrandChild 适合 Cascade Delete）。但是，只要我在关系的 Child2“一侧”添加 Cascade Delete，SQL 就会告诉我 FK 会导致多个级联路径。我的印象是，仅当多个 FK 指示 SAME 表时才适用多个级联路径。在这种情况下，为什么我会收到多个级联路径错误？

PS 此时的表关系很难改变，所以简单地告诉我改变我的表结构不会有帮助，谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T19:42:22.827

该消息表示，如果您删除父记录，则有两条路径可通向所有可删除的 GrandChild 记录。

修复：删除 FK 中的 ON DELETE CASCADE 选项，并为 ChildX 表创建 INSTEAD OF DELETE 触发器，删除所有孙记录，然后删除 childX 记录本身。

# visual-studio-2005 - VS 2005 代码分析工具的警告解释在哪里？

> ID：123290
> 
> 赞同：0
> 
> 时间：2008-09-23T19:40:14.797
> 
> 标签：visual-studio-2005, code-analysis

有谁知道在哪里可以找到对 VS 2005 代码分析工具中警告的解释。我想要一些文档，解释它为什么会产生警告以及应该采取什么行动。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T19:43:00.903

您应该能够在错误列表中右键单击它给您的警告，并直接从 Visual Studio 中查看错误帮助。如果您愿意，还有[一段 MSDN 文章。](http://msdn.microsoft.com/en-us/library/ee1hzekz(VS.80).aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T19:46:50.177

我不确定您指的是哪个代码分析工具。

如果您的意思是 FxCop，请看这里：http: [//msdn.microsoft.com/en-us/library/bb429379 (VS.80).aspx](http://msdn.microsoft.com/en-us/library/bb429379(VS.80).aspx)

如果您指的是 StyleCop，请参阅此处的下载：[http ://code.msdn.microsoft.com/sourceanalysis/Release/ProjectReleases.aspx?ReleaseId=1425](http://code.msdn.microsoft.com/sourceanalysis/Release/ProjectReleases.aspx?ReleaseId=1425)

# ajax - AJAX 缩略图

> ID：123292
> 
> 赞同：1
> 
> 时间：2008-09-23T19:40:24.640
> 
> 标签：ajax, imaging, thumbnails

有谁知道任何免费框架可以帮助您为网页创建缩略​​图，单击时，原始图像会加载到页面顶部（类似模式），而不是打开单独的页面。谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T19:44:18.313

这实际上是 1 中的 2 个问题。模态框中原始、较大尺寸的图像的“灯箱”显示是在 JavaScript 中使用诸如[ThickBox 之](http://jquery.com/demo/thickbox/)类的库处理的。图像的大小调整可以手动完成，也可以通过服务器端的某种代码完成。Sitepoint 有一个关于如何[使用 PHP 调整服务器端大小](http://www.sitepoint.com/article/image-resizing-php/)的不错的指南。我希望这有助于为您指明正确的方向。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T19:41:19.677

灯箱。

[http://planetozh.com/projects/lightbox-clones/](http://planetozh.com/projects/lightbox-clones/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T19:47:41.423

我过去使用过[DhoniShow](http://lifedraft.de/projekte/dhonishow/)几次，客户非常喜欢它。它不是 AJAX，因为它会在页面加载时加载所有全尺寸的图像，但如果你有动力，我相信你可以很容易地做出改变。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-08-10T18:55:14.690

正如已经说过的，您可以使用 Lightbox 为用户获取效果，我会使用它的 ajax 模式，将缩略图作为其内容加载。

[现在对于缩略图，我会向您推荐http://megasnaps.com/](http://megasnaps.com/)之类的东西，您可以免费使用它。

祝你好运。

# svn - 你使用分支/标签/主干约定吗？

> ID：123295
> 
> 赞同：7
> 
> 时间：2008-09-23T19:40:34.030
> 
> 标签：svn

你是否总是遵循将分支、标签和主干目录放在 Subversion 存储库顶层的惯例？最近，我不再打扰了，（还）没有发生任何不好的事情！

如果需要创建目录树，应该可以移动它们。我是在为以后制造麻烦吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-23T19:43:21.107

您是否尝试过分支或标记？到那时，没有问题。然而，使用branchs,tags,trunk 约定的另一个好处是它就是这样——一个约定。人们期望看到这一点，因此他们知道在需要分叉时该怎么做。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T01:44:27.807

快速回答是“做任何最适合您的程序的事情”。

正如 Danimal 所说，branch/trunk/tag 的结构是一种约定。但是，我不同意重要的是 b/t/t 的位置，而仅仅是它们的存在。

您应该拥有的地方显然是为分支指定的，为您的主干指定的某个地方以及为您的标签指定的地方。它们的确切位置在很大程度上取决于您的存储库的结构和您保存的文件的性质。

例如，如果您将多个项目保存在一个存储库中，您可能会发现在项目下创建 b/t/t 目录更有意义。如果您的项目中有不同的模块，则应在模块目录下创建 b/t/t。

问问自己，你希望分支并以此为指导的最大逻辑块是什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T19:44:24.567

这取决于项目有多大。我们有一些相当大的东西（当然，在 git 中，但概念是相同的）。每个开发人员都使用他/她自己的分支，有一个测试和主线分支。我们还标记版本，如果有特定于版本的修复，则会创建一个分支，以便可以相当容易地集成修复。

这种设置有优点：在开发过程中我们不会互相纠缠。但缺点是我们需要一个集成器将来自开发者分支的提交放到测试分支中，然后再放到主线分支中。

如果项目很小，那么它只是开销，但你永远不知道一个项目会有多大。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T19:46:25.500

我刚刚开始实际使用约定，我同意[Danimal](https://stackoverflow.com/questions/123295/do-you-use-the-branchestagstrunk-convention#123312)。如果您在 QA 中构建了一个，在生产中构建了另一个，并且在疯狂的新实验功能开发中构建了另一个，那么在它们之间快速来回切换是很好的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T02:18:32.670

我过去曾编写工具来自动化某些 SVN。创建基本存储库就是其中之一。第 1 步：创建一个空存储库。第 2 步：创建主干、分支和标签文件夹 - 提交 第 3 步：将挂钩脚本复制到新存储库

我的钩子脚本之一是确保标签目录中的项目不能被修改。这使得标签具有与分支不同的含义。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T19:44:12.180

不，已经为当前排队的项目放弃了这种方法。虽然这个概念似乎非常有效，但它似乎浪费的时间多于实践中节省的时间。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T19:44:43.757

你至少有一个后备箱吗？如果没有，当您确实需要分支或标记时，您必须将它们放在您的根项目目录中，以及实际的代码/内容。哎呀！

编辑：我想你可以创建一个主干文件夹，然后将所有内容移入其中，然后创建你的分支等......

对于那些说“以后再做，不要浪费时间，等等……”的人，老实说，在项目开始时创建它们需要多少开销？2分钟，上衣？为什么不这样做呢？稍后移动所有内容将花费更长的时间 - 即使您最终只需要 5 次中的 1 个分支，我仍然认为您从分支、标签、主干结构开始会花费更少的时间。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T19:47:34.763

正如我[在 Subversion 存储库中的“分支”、“标记”和“主干”是什么意思中所说的那样？](https://stackoverflow.com/questions/16142/what-does-branch-tag-and-trunk-really-mean#114384)，因为分支和标签是相同的，你没有义务遵循任何约定，但你自己的。
特别是对于具有顺序开发的小型项目（即无需在当前开发、旧版本维护、替代框架探索等之间进行并行工作）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T19:48:41.547

我通常会将我的主干保存在存储库的根目录中，并且只有在我确实需要创建分支标签时才将其移动到主干文件夹中。我认为使用 SVN，只要您的结构合乎逻辑，以后如果您的需求发生变化，您应该可以轻松地重新安排它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T19:59:49.710

我在每个项目中都使用主干、标签和分支。说真的，在创建项目时创建 2 个额外的目录有多难。遵循约定只是为了保持一致性有一些好处。我发现我有很多标签（开发人员环境之外的应用程序的每次推送都会被版本化和标记）。我没有这么多分支，因为我通常不会与我不信任的人一起工作，因为在审查之前提交。因此，通常当我获得分支时，这是因为我对代码库进行了永久拆分——通常是针对不同的客户。一旦代码变得不可调和，我通常会停止一个分支并将其移动到它自己的主干。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T22:04:19.817

最近我正在使用一个更专注于敏捷的模型，你可以看看[这里](http://www.infoq.com/articles/agile-version-control)。

遵循版本控制中的一些策略非常重要，因为即使使用定义良好的模型，代码版本本质上也会导致您犯错误、混乱的合并以及所有坏事，所以要小心。

该模型为每个存储库指定了职责，并且不允许您在生产、可交付和正在构建的代码所在的位置重叠。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-24T00:56:18.593

我遵循惯例有很多原因

1.  使用 b/t/t 约定的参考资料和程序可以立即应用于您的 svn 回购结构。
2.  熟悉该约定的所有进入团队的开发人员都有一个最小的学习曲线来习惯您的 svn repo 结构。
3.  由于树干和分支具有直接而明显的好处，只有当您不得不翻阅历史和日志以涵盖您或您的公司的屁股时，您才会意识到保持一致的标记程序的好处。

简而言之，为什么公约是一件好事可能不是很明显，但是当你需要帮助、建议或一些管理疯狂时，它就会成为众所周知的天赐之物。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-24T01:15:29.483

我喜欢将分支用于“迷你项目”，以进行简单的概念证明。它快速、简单，通常有助于跟上您的主要项目。我将概念证明放在了分支目录中，因为它不是主项目的一部分，但它对项目很有价值。

就像其他人提到的那样，我使用标签来发布。我所做的大多数版本都是版本，所以我通常只有一个包的 zip 文件或版本的安装程序。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-24T02:01:08.857

不，不是最后 3 种工作情况。我与需要编写、修复和调用处理脚本的非程序员一起工作。编程大多是随意的，偶尔会有更深入或更大的工作。没有期望遵循大型软件开发人员的做法。标准存储库术语可能与我们工作领域中使用的行话发生冲突。因此，我们构建了自己的存储库目录。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-24T02:09:14.877

在一个非常简单的环境中，您可以省去 SVN 存储库顶部的分支、标签、主干。例如，如果您将 SVN 用于您的大学作业，您将不会非常担心在将代码发布给您的客户（标记作业的人）之后对代码的更改，因此您可以明智地省去分支，标签，主干，只有一个结构。（实际上，整个事情就是“树干”。）

另一方面，如果您一直在管理部署到 700 个不同站点并且分散在不同产品线中的代码，那么在结构顶部附近不使用“分支、标签、主干”将是疯狂的（在走 BTT 路线之前拆分您的产品是一个明智的案例），因为您将需要知道哪些代码去了哪里，并且能够将主要的重写活动（您在后备箱中所做的事情）与现场修复以帮助有直接问题的站点（您在分支中执行此操作，然后合并到主干中）。如果您希望能够回答“为什么在我们推出补丁 1.2.3 时 Foobar 停止工作？”这个问题？那么标签是必不可少的。

# c# - 将 Int32 转换为 ushort 并再次返回

> ID：123301
> 
> 赞同：1
> 
> 时间：2008-09-23T19:41:33.280
> 
> 标签：c#, overflow, int32, ushort

我正在尝试设计一个将大于 65535 的整数值打包到 ushort 中的系统。让我解释。

我们有一个系统，它使用 SQL Server 的 IDENTITY 列生成 Int32 值，并受到生产中客户端 API 的限制，该 API 将我们的 Int32 ID 溢出到 ushorts。幸运的是，客户端在任何给定时间只有大约 20 个具有这些 ID 的事物实例（我们称它们为包），并且它只需要使它们在本地兄弟姐妹中是唯一的。普遍接受的解决方案是将我们的 Int32 ID 转换为 ushorts（不，我不是指强制转换，我的意思是翻译），然后再将它们传输给客户端，但是这种方法存在一些问题：

1.  由于未过期，某些小于 65535 的 ID 可能随时在给定客户端上运行。
2.  我们不能有任何 ID 冲突 - 也就是说，如果包 ID 1 发送到客户端，则跟踪从 Int32 中删除 65535 多少次以在应用于 65536 时进行 ushort 的算法也会导致 1 从而导致冲突。
3.  我们必须能够在返回时将 ushort 重构为 Int32。

我们可以用来解决这个问题的是一个单一的有符号字节字段，它会回显给我们并给我们 127 个值来玩（实际上是 117，因为我们使用 0-9 来做其他事情）。从这里开始，我将其称为“字节字段”。

我们已经讨论了三种不同的翻译例程：

1.  乘法：在字节字段中存储我们从 Int32 中删除 65535 以制作 ushort 的次数。这具有如上所述的碰撞问题。
2.  序列化会话状态：对于每个客户端，根据有关该客户端的事实生成一个会话 ID。然后存储一个从 1 到交付的包裹数量的 1:1 转换表，这样当客户端再次访问我们的服务器时，可以将包裹清单转换回它们已知的数据库 ID。这存在开销问题，因为我们要将序列化会话状态备份到数据库，并且我们希望每秒支持数百到数千个事务。
3.  各种算法方法，其中字节字段是转换算法的 ID，该算法采用 Int32 并将其转换为 ushort。显然，其中许多将是简单的乘法（以增加我们可以转换的 ID 上限），但有些必须乘以较小的边界（如 32768），并加上/减去一个数字才能接近可以保证在兄弟姐妹中唯一的数字。这种方法是处理器密集型的，但应该允许我们在保持可扩展性的同时避免冲突（尽管使用这种方法，我们有一个有限的上限，在 ushort 问题由于升级而自行消失之前无法达到）。

所以我的问题是：有没有比我上面的方法更好的方法，如果没有，我应该在算法方面寻找什么（对于方法＃3），当给定数字大于0 并且不能是单向哈希？

澄清：最大的问题不是 ushort 上限，而是客户端 API 使用 ushort，所以我无法组合客户端上的字节字段以获得更大的值（客户端 API 不可升级，但最终会逐步淘汰）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T20:13:46.993

我可以想到其他一些选择：

数据库中的全球条目是否少于 65536 个？如果是这样，那么您可以维护一个与会话状态无关的映射表，但它是应用程序的持久部分。

索引中的大多数条目是否少于 50,000 个？如果是这种情况，您可以直接映射这些值，并将与会话关联的映射用于剩余的值。

如果持久化此类会话数据是一个问题并且客户端的数量相当少，您可以启用客户端/会话亲和性并维护服务器本地的映射。

如果它不是 Web 应用程序，您可以在客户端本身上维护地图。

我没有看到任何可以避免冲突的算法方式——我怀疑你总能想出一个会发生冲突的例子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T20:26:35.997

关于方法2：

您的第二种方法几乎是 NAT 的工作原理。本地网络上的每个 TCP/UDP 客户端都有多达 65535 个正在使用的端口（端口 0 除外）和一个私有 IP。路由器只知道一个公共 IP。由于两个客户端可能都有源端口 300，因此不能简单地将私有 IP 替换为公共 IP，否则会导致冲突出现。因此，它取代了 IP 并“翻译”了端口（NAT：网络地址**翻译**）。返回时，它会将端口转换回来并再次用私有 IP 替换公共 IP，然后再将包转发回去。你不会做任何其他事情。然而，路由器将这些信息保存在内存中——并且在进行 NAT 时它们不会太慢（拥有数百台计算机的公司有时会通过 NAT 连接到 Internet，在大多数情况下速度几乎不会明显下降）。您说您希望每秒进行上千笔交易——但是会有多少客户？因为这主要将定义备份映射所需的内存大小。如果没有太多的客户端，你可以在内存中保留一个排序表的映射，在这种情况下，速度将是最小的问题（表变大，服务器内存不足是最大的问题）。

我有点不清楚的是你曾经说过

> 幸运的是，客户端在任何给定时间只有大约 20 个具有这些 ID 的事物实例（我们称它们为包），并且它只需要使它们在本地兄弟姐妹中是唯一的。

但是你说

> 由于未过期，某些小于 65535 的 ID 可能随时在给定客户端上运行。

我想，您可能通过第二个语句的意思是，如果客户端请求 ID 65536，它可能仍然具有低于 65535 的 ID，并且这些 ID 可能低至（比方说）20。这并不是客户端在直接下单吧？所以你不能说，仅仅因为它现在请求 65536，它可能有一些较小的值，但肯定不在 1-1000 范围内，对吗？它实际上可能保留对 20、90、2005 和 41238 的引用，但仍然超过 65535，这就是你的意思？

我个人更喜欢您的第二种方法而不是第三种方法，因为在任何情况下都更容易避免碰撞，并且将数字翻译回来是一个简单而简单的操作。尽管我怀疑您的第三种方法从长远来看是否可行。好的，您可能有一个字节来存储您从数字中减去 2^16 的频率。但是，您只能减去 117 * 2^16 作为最大数。如果数字超过这个值，你会怎么做？使用不同的算法，它不会减去，而是做什么？划分？位移位？在这种情况下，您会失去粒度，这意味着该算法无法**命中**任何可能的数字（它会产生很大的跳跃）。如果在 32 位上应用魔术转换函数以从中生成 16 位（+ 一个额外字节）然后将其转换回来是如此容易，那么猜测这个世界上的每种压缩方法都会使用它，因为它可以，不无论 32 位数字是多少，始终将其压缩到 24 位（16 位 + 一个字节）。那将是魔术。不可能将 32 位打包成 24 位，也无法打包如何将其转换回它的所有逻辑。您将需要一些外部存储，这使我们回到您的第二种方法。这是唯一可行的方法，它适用于 32 位数字范围内的每个数字。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T19:49:28.610

您需要比 65535“多”多少？您总是可以从“字节字段”中添加几位作为 ID 的高位。只需 2 位即可获得 262,143，3 位将使您获得 524,287。

# winapi - Win32 消息队列有多深？

> ID：123323
> 
> 赞同：13
> 
> 时间：2008-09-23T19:44:20.510
> 
> 标签：winapi, message-queue

一个标准窗口的队列可以容纳多少条消息？当队列溢出时会发生什么？

and relatives的文档`GetMessage`对此没有任何说明，`PeekMessage`仅针对某些类别的消息为您提供是/否，而不是消息计数。

[该页面](http://msdn.microsoft.com/en-us/library/aa925082.aspx)说队列是使用内存映射文件实现的，并且没有消息计数限制，但该页面是关于 WinCE 的。这是否也适用于桌面 Win32？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-23T19:45:29.963

默认为 10000，但可以通过注册表进行调整。

如果队列溢出，则 PostMessage 失败。

此处的文档：

[`PostMessage`MSDN上的功能](http://msdn.microsoft.com/en-us/library/ms644944.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T03:37:25.943

如 MSDN 文章中所述，如果您需要担心消息队列的大小，最好重新设计您的应用程序。

# asp.net-mvc - 创建 ASP.NET MVC 控件或助手的最佳实践是什么？

> ID：123327
> 
> 赞同：5
> 
> 时间：2008-09-23T19:44:33.927
> 
> 标签：asp.net-mvc, controls

我正在为我的 MVC 项目构建一个可重用的控件或自定义助手。我确信有一个最佳实践。任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-23T19:50:11.730

当然，最佳实践封装在 MVC 源代码中的 HtmlHelpers 和其他帮助程序中。您可以在[http://www.codeplex.com/aspnet获取源代码](http://www.codeplex.com/aspnet)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T20:41:05.477

（讨厌不同意你的观点，Scott）使用 HtmlHelpers 不是最佳实践。这不是一种通过在实际项目中使用而得到强化的做法，而只是一种方法。我最近写了一篇[关于使用 SubControllers 的小文章](http://mhinze.com/subcontrollers-in-aspnet-mvc/)。我们使用 HtmlHelpers 处理一些小事情，但我们使用 SubControllers 进行更好的控制、组合和依赖倒置。

# php - 我可以使用 RegEx 和 VI（或类似的东西）为我自动填充一些文本吗？

> ID：123334
> 
> 赞同：6
> 
> 时间：2008-09-23T19:45:51.913
> 
> 标签：php, html, vi

注意：我不打算使用 VI，这只是我想到的第一件事，它可能能够满足我的需要。随意建议任何其他程序。

我有一个包含近 100 个字段的表单，我想用 PHP 自动填写。我知道如何进行自动填充，但我想避免手动将所需的文本添加到 100 个字段。

有没有一种自动化的方式可以获取文本：

```
<input name="riskRating" id="riskRating" type="text" /> 
```

并将其更改为：

```
<input name="riskRating" id="riskRating" type="text" value="<?php echo $data['riskRating']; ?>" /> 
```

请记住，我想对近 100 个字段执行此操作。我试图避免进入每个字段，粘贴 PHP 代码并手动更改变量名。

我希望那里的一些VI大师知道他/她的头脑。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T19:53:52.157

从 Zsolt Botykai 和 Mark Biek 那里得到一些想法：

```
:%s:<input\(.* id="\([^"]*\)".*\) />:<input \1 value="<?php echo $data['\2']; ?> />:g 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T19:49:20.063

`:%s:\(<input name="\([^"]\+\)" id="[^"]\+" type="text" \)/>:\1value="<?php echo $data ['\2']; ?>" />:gci`

那是一条线。HTH。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T19:58:14.377

我是这样做的。我不确定如何逃脱它以在 vim 中工作。如果我能弄清楚，我会编辑

这是正则表达式的搜索部分：

```
<input (.*) id="(.*?)" (.*) /> 
```

这是替换部分：

```
<input \1 id="\2" \3 value="<?php echo $data['\2']; ?>" /> 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-23T19:59:19.710

第 1 步：搜索 chaine type="text" ：

```
/type="text" 
```

验证是否捕获了您想要的所有字符串。第 2 步：用想要的字符串替换：

```
:%s//type="text" value="<?php echo $data riskrating]; ?>"/g 
```

第三步：开心！

# java - 是什么导致 java.lang.IllegalStateException: Post too large in tomcat / mod_jk

> ID：123335
> 
> 赞同：8
> 
> 时间：2008-09-23T19:45:55.517
> 
> 标签：java, tomcat, mod-jk

为了增加最大允许的帖子大小，需要调整什么配置，它在哪里？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-23T19:50:31.057

默认情况下，Apache Tomcat 对其接受的 HTTP POST 请求的最大大小设置了限制。在 Tomcat 5 中，此限制设置为 2 MB。当您尝试上传大于 2 MB 的文件时，可能会出现此错误。

解决方案是重新配置 Tomcat 以接受更大的 POST 请求，方法是增加限制或禁用它。这可以通过编辑 [TOMCAT_DIR]/conf/server.xml 来完成。将 HTTPConnector 的 Tomcat 配置参数 maxPostSize 设置为更大的值（以字节为单位）以增加限制。将其设置为 0 in 将禁用大小检查。有关详细信息，请参阅[Tomcat 配置参考](http://tomcat.apache.org/tomcat-5.5-doc/config/http.html)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-05-21T16:37:02.000

这将适用于其他人，我看到您正在耦合 Apache HTTP 和 Tomcat（tomcat / mod_jk），在这种情况下，编辑 Coyote/JK2 AJP 1.3 连接器的方式与您为标准连接器（Coyote HTTP/1.1）所做的相同，因为 AJP1.3 连接器是 Tomcat 接收数据的地方。

```
<!-- Define a Coyote/JK2 AJP 1.3 Connector on port 8009 -->
<Connector port="8009" 
           enableLookups="false" redirectPort="8443" debug="0"
           protocol="AJP/1.3" maxPostSize="0"/> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-07-29T18:27:12.077

IllegalStateException 异常的根本原因是 java servlet 在响应提交后试图写入输出流。

请注意在重定向/分派请求后不会将任何内容添加到响应中。

# c# - 如何从字符串中去除非 ASCII 字符？（在 C# 中）

> ID：123336
> 
> 赞同：261
> 
> 时间：2008-09-23T19:45:55.547
> 
> 标签：c#, ascii

如何从字符串中去除非 ASCII 字符？（在 C# 中）

* * *

## 回答 #1

> 赞同：451
> 
> 时间：2008-09-23T19:46:24.453

```
string s = "søme string";
s = Regex.Replace(s, @"[^\u0000-\u007F]+", string.Empty); 
```

* * *

## 回答 #2

> 赞同：149
> 
> 时间：2008-09-25T19:32:16.687

这是一个不使用正则表达式的纯 .NET 解决方案：

```
string inputString = "Räksmörgås";
string asAscii = Encoding.ASCII.GetString(
    Encoding.Convert(
        Encoding.UTF8,
        Encoding.GetEncoding(
            Encoding.ASCII.EncodingName,
            new EncoderReplacementFallback(string.Empty),
            new DecoderExceptionFallback()
            ),
        Encoding.UTF8.GetBytes(inputString)
    )
); 
```

它可能看起来很麻烦，但它应该是直观的。它使用 .NET ASCII 编码来转换字符串。在转换过程中使用 UTF8，因为它可以表示任何原始字符。它使用 EncoderReplacementFallback 将任何非 ASCII 字符转换为空字符串。

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2013-08-02T13:31:07.220

我相信 MonsCamus 的意思是：

```
parsememo = Regex.Replace(parsememo, @"[^\u0020-\u007E]", string.Empty); 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2012-04-05T22:30:39.243

如果您不想剥离，而是要将拉丁重音字符转换为非重音字符，请查看以下问题：[如何将 8 位字符转换为 7 位字符？（即 Ü 到 U）](https://stackoverflow.com/a/10036907/562906)

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2010-01-27T19:00:39.260

受[philcruz 的正则表达式解决方案的](https://stackoverflow.com/a/123340/7724)启发，我做了一个纯 LINQ 解决方案

```
public static string PureAscii(this string source, char nil = ' ')
{
    var min = '\u0000';
    var max = '\u007F';
    return source.Select(c => c < min ? nil : c > max ? nil : c).ToText();
}

public static string ToText(this IEnumerable<char> source)
{
    var buffer = new StringBuilder();
    foreach (var c in source)
        buffer.Append(c);
    return buffer.ToString();
} 
```

这是未经测试的代码。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2013-06-18T17:38:53.383

不需要正则表达式。只需使用编码...

```
sOutput = System.Text.Encoding.ASCII.GetString(System.Text.Encoding.ASCII.GetBytes(sInput)); 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2016-10-11T21:38:52.630

我来这里寻找扩展 ascii 字符的解决方案，但找不到。我找到的最接近的是[bzlm's solution](https://stackoverflow.com/a/135473/2196341)。但这仅适用于最高 127 的 ASCII 代码（显然您可以替换他代码中的编码类型，但我认为理解起来有点复杂。因此，分享这个版本）。这是适用于[扩展 ASCII 代码的解决方案，即高达 255](http://www.ascii-code.com/)，即[ISO 8859-1](http://www.htmlhelp.com/reference/charset/)

它发现并去除非ASCII字符（大于255）

```
Dim str1 as String= "â, ??î or ôu� n☁i✑++$-♓!‼⁉4⃣od;/⏬'®;☕:☝)///1!@#"

Dim extendedAscii As Encoding = Encoding.GetEncoding("ISO-8859-1", 
                                                New EncoderReplacementFallback(String.empty),
                                                New DecoderReplacementFallback())

Dim extendedAsciiBytes() As Byte = extendedAscii.GetBytes(str1)

Dim str2 As String = extendedAscii.GetString(extendedAsciiBytes)

console.WriteLine(str2)
'Output : â, ??î or ôu ni++$-!‼⁉4od;/';:)///1!@#$%^yz: 
```

这是[代码的工作小提琴](https://dotnetfiddle.net/JQMsCJ)

根据要求更换编码，其余保持不变。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2012-10-01T10:02:56.900

我发现以下稍微更改的范围对于从数据库中解析注释块很有用，这意味着您不必与制表符和转义符抗衡，这会导致 CSV 字段变得不安。

```
parsememo = Regex.Replace(parsememo, @"[^\u001F-\u007F]", string.Empty); 
```

如果您想避免其他特殊字符或特定标点符号，请检查[ascii 表](http://www.asciitable.com/)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-09-03T17:08:42.887

这不是最佳性能，而是一种非常直接的 Linq 方法：

```
string strippedString = new string(
    yourString.Where(c => c <= sbyte.MaxValue).ToArray()
    ); 
```

缺点是所有“幸存的”字符首先放入一个类型数组中，然后在构造函数不再使用它`char[]`之后将其丢弃。`string`

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-06-12T12:27:20.323

我使用了这个正则表达式：

```
 string s = "søme string";
    Regex regex = new Regex(@"[^a-zA-Z0-9\s]", (RegexOptions)0);
    return regex.Replace(s, ""); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-06-09T18:17:02.287

我使用这个正则表达式来过滤掉文件名中的坏字符。

```
Regex.Replace(directory, "[^a-zA-Z0-9\\:_\- ]", "") 
```

这应该是文件名允许的所有字符。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2021-01-07T00:19:48.353

死灵术。
此外，bzlm 的方法可用于删除不在任意字符集中的字符，而不仅仅是 ASCII：

```
// https://en.wikipedia.org/wiki/Code_page#EBCDIC-based_code_pages
// https://en.wikipedia.org/wiki/Windows_code_page#East_Asian_multi-byte_code_pages
// https://en.wikipedia.org/wiki/Chinese_character_encoding
System.Text.Encoding encRemoveAllBut = System.Text.Encoding.ASCII;
encRemoveAllBut = System.Text.Encoding.GetEncoding(System.Globalization.CultureInfo.InstalledUICulture.TextInfo.ANSICodePage); // System-encoding
encRemoveAllBut = System.Text.Encoding.GetEncoding(1252); // Western European (iso-8859-1)
encRemoveAllBut = System.Text.Encoding.GetEncoding(1251); // Windows-1251/KOI8-R
encRemoveAllBut = System.Text.Encoding.GetEncoding("ISO-8859-5"); // used by less than 0.1% of websites
encRemoveAllBut = System.Text.Encoding.GetEncoding(37); // IBM EBCDIC US-Canada
encRemoveAllBut = System.Text.Encoding.GetEncoding(500); // IBM EBCDIC Latin 1
encRemoveAllBut = System.Text.Encoding.GetEncoding(936); // Chinese Simplified
encRemoveAllBut = System.Text.Encoding.GetEncoding(950); // Chinese Traditional
encRemoveAllBut = System.Text.Encoding.ASCII; // putting ASCII again, as to answer the question 

// https://stackoverflow.com/questions/123336/how-can-you-strip-non-ascii-characters-from-a-string-in-c
string inputString = "RäksmörПривет, мирgås";
string asAscii = encRemoveAllBut.GetString(
    System.Text.Encoding.Convert(
        System.Text.Encoding.UTF8,
        System.Text.Encoding.GetEncoding(
            encRemoveAllBut.CodePage,
            new System.Text.EncoderReplacementFallback(string.Empty),
            new System.Text.DecoderExceptionFallback()
            ),
        System.Text.Encoding.UTF8.GetBytes(inputString)
    )
);

System.Console.WriteLine(asAscii); 
```

对于那些只想消除口音的人：（
注意，因为 Normalize ！= Latinize ！= Romanize）

```
// string str = Latinize("(æøå âôû?aè");
public static string Latinize(string stIn)
{
    // Special treatment for German Umlauts
    stIn = stIn.Replace("ä", "ae");
    stIn = stIn.Replace("ö", "oe");
    stIn = stIn.Replace("ü", "ue");

    stIn = stIn.Replace("Ä", "Ae");
    stIn = stIn.Replace("Ö", "Oe");
    stIn = stIn.Replace("Ü", "Ue");
    // End special treatment for German Umlauts

    string stFormD = stIn.Normalize(System.Text.NormalizationForm.FormD);
    System.Text.StringBuilder sb = new System.Text.StringBuilder();

    for (int ich = 0; ich < stFormD.Length; ich++)
    {
        System.Globalization.UnicodeCategory uc = System.Globalization.CharUnicodeInfo.GetUnicodeCategory(stFormD[ich]);

        if (uc != System.Globalization.UnicodeCategory.NonSpacingMark)
        {
            sb.Append(stFormD[ich]);
        } // End if (uc != System.Globalization.UnicodeCategory.NonSpacingMark)

    } // Next ich

    //return (sb.ToString().Normalize(System.Text.NormalizationForm.FormC));
    return (sb.ToString().Normalize(System.Text.NormalizationForm.FormKC));
} // End Function Latinize 
```

# iis - 如果新的 dll 掉入 bin 中，重新启动 IIS？

> ID：123337
> 
> 赞同：6
> 
> 时间：2008-09-23T19:46:07.903
> 
> 标签：iis

如果我在我的虚拟目录的 bin 中放置一个新的 DLL，我是否必须重新启动 IIS？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-23T19:47:12.690

不，您不必这样做，应用程序将回收，但不需要 IISReset

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T19:48:22.653

不，您不必重新启动 IIS。但是，您的工作进程将自动回收自身。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T19:52:34.750

如果您的应用程序是 ASP.NET 应用程序，我相信 AppDomain 会重新启动，但工作进程 (w3wp.exe) 不会。对于大多数目的，AppDomain 重置足以清除状态，但对于某些（通常与已在进程中加载​​的非托管 DLL 相关）这可能还不够。在这些情况下，IISRESET 将起作用。

# unix - 命令行 Unix 基于 ASCII 的图表/绘图工具

> ID：123378
> 
> 赞同：165
> 
> 时间：2008-09-23T19:49:37.817
> 
> 标签：unix, charts, graph, matplotlib

有没有好的命令行 UNIX 图表/绘图/绘图工具？我正在寻找可以在 ASCII 图上绘制 xy 点的东西。

澄清一下，我正在寻找能够以 ASCII 格式输出图形的东西（如 ascii-art 风格），因此我可以在不需要 X 的交互式 shell 会话中使用它。

* * *

## 回答 #1

> 赞同：145
> 
> 时间：2008-09-23T19:51:49.497

尝试[gnuplot](http://www.gnuplot.info/)。它具有非常强大的绘图功能。

它可以通过以下方式输出到您的终端：

```
gnuplot> set terminal dumb
Terminal type set to 'dumb'
Options are 'feed 79 24'
gnuplot> plot sin(x)

   1 ++----------------**---------------+----**-----------+--------**-----++
     +                *+ *              +   *  *          +  sin(x) ****** +
 0.8 ++              *    *                *    *                *    *   ++
     |               *    *                *    *                *    *    |
 0.6 ++              *     *              *      *              *      *  ++
     *              *       *             *       *             *      *   |
 0.4 +*             *       *             *       *             *      *  ++
     |*            *        *            *        *            *        *  |
 0.2 +*            *        *            *        *            *        * ++
     | *          *          *          *          *          *          * |
   0 ++*          *          *          *          *          *          *++
     |  *         *           *         *           *         *           *|
-0.2 ++ *         *           *         *           *         *           *+
     |   *       *            *        *            *        *            *|
-0.4 ++  *       *            *        *            *        *            *+
     |   *      *              *      *              *      *              *
-0.6 ++  *      *              *      *              *      *             ++
     |    *     *               *     *               *    *               |
-0.8 ++    *   *                 *   *                *    *              ++
     +     *  *        +         *  *   +              *  *                +
  -1 ++-----**---------+----------**----+---------------**+---------------++
    -10               -5                0                 5                10 
```

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2012-10-13T00:18:00.047

虽然`gnuplot`功能强大，但当您只想输入一堆点并获取图表时，它也很烦人。

值得庆幸的是，有人创建了[eplot](http://liris.cnrs.fr/christian.wolf/software/eplot/index.html)（简单的情节），它为您处理了所有的废话。

它似乎没有强制终端图的选项；我像这样修补它：

```
--- eplot.orig  2012-10-12 17:07:35.000000000 -0700
+++ eplot       2012-10-12 17:09:06.000000000 -0700
@@ -377,6 +377,7 @@
                # ---- print the options
                com="echo '\n"+getStyleString+@oc["MiscOptions"]
                com=com+"set multiplot;\n" if doMultiPlot
+               com=com+"set terminal dumb;\n"
                com=com+"plot "+@oc["Range"]+comString+"\n'| gnuplot -persist"
                printAndRun(com)
                # ---- convert to PDF 
```

使用示例：

```
[$]> git shortlog -s -n | awk '{print $1}' | eplot 2> /dev/null

  3500 ++-------+-------+--------+--------+-------+--------+-------+-------++
       +        +       +        "/tmp/eplot20121012-19078-fw3txm-0" ****** +       *                                                                    |  3000 +*                                                                  ++       |*                                                                   |       | *                                                                  |  2500 ++*                                                                 ++       | *                                                                  |
       |  *                                                                 |
  2000 ++ *                                                                ++
       |  **                                                                |
  1500 ++   ****                                                           ++
       |        *                                                           |
       |         **                                                         |
  1000 ++          *                                                       ++
       |            *                                                       |
       |            *                                                       |
   500 ++            ***                                                   ++
       |                **************                                      |
       +        +       +        +    **********  +        +       +        +
     0 ++-------+-------+--------+--------+-----***************************++
       0        5       10       15       20      25       30      35       40 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2014-01-23T21:32:48.810

我刚刚遇到的另一个选择是[bashplotlib](https://github.com/glamp/bashplotlib)。[这是一个在与我的 eplot 示例](https://stackoverflow.com/a/12868778/120999)（大致）相同的数据上运行的示例：

```
[$]> git shortlog -s -n | awk '{print $1}' | hist

 33|   o
 32|   o
 30|   o
 28|   o
 27|   o
 25|   o
 23|   o
 22|   o
 20|   o
 18|   o
 16|   o
 15|   o
 13|   o
 11|   o
 10|   o
  8|   o
  6|   o
  5|   o
  3|   o o     o
  1|   o o     o o       o
  0|   o o o o o o       o
    ----------------------

-----------------------
|       Summary       |
-----------------------
|   observations: 50  |
| min value: 1.000000 |
|  mean : 519.140000  |
|max value: 3207.000000|
----------------------- 
```

调整 bin 有助于提高分辨率：

```
[$]> git shortlog -s -n | awk '{print $1}' | hist --nosummary --bins=40

 18|   o
   |   o
 17|   o
 16|   o
 15|   o
 14|   o
 13|   o
 12|   o
 11|   o
 10|   o
  9|   o
  8|   o
  7|   o
  6|   o
  5|   o   o
  4|   o   o o
  3|   o o o o   o
  2|   o o o o   o
  1|   o o o o   o                     o       o
  0|   o o o o o o           o     o   o o   o o                                 o
   |   o o o o o o           o     o   o o   o o                                 o
    -------------------------------------------------------------------------------- 
```

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2018-07-28T06:01:42.367

另请参阅：[asciichart](https://github.com/kroitor/asciichart)（在 Node.js、Python、Java、Go 和 Haskell 中实现）

[![在此处输入图像描述](https://i.stack.imgur.com/jz9a0.png)](https://i.stack.imgur.com/jz9a0.png)

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2015-02-18T17:41:14.250

[feedgnuplot](http://manpages.ubuntu.com/manpages/raring/man1/feedgnuplot.1.html)是 gnuplot 的另一个前端，它处理数据管道。

```
 $ seq 5 | awk '{print 2*$1, $1*$1}' |
      feedgnuplot --lines --points --legend 0 "data 0" --title "Test plot" --y2 1 \
                  --terminal 'dumb 80,40' --exit

                                     Test plot

     10 ++------+--------+-------+-------+-------+--------+-------+------*A 25
        +       +        +       +       +       +        +       +    **#+
        |       :        :       :       :       :        : data 0+**A*** |
        |       :        :       :       :       :        :       :** #   |
      9 ++.......................................................**.##....|
        |       :        :       :       :       :        :    ** :#      |
        |       :        :       :       :       :        :  **   #       |
        |       :        :       :       :       :        :**   ##:      ++ 20
      8 ++................................................A....#..........|
        |       :        :       :       :       :      **:   #   :       |
        |       :        :       :       :       :    **  : ##    :       |
        |       :        :       :       :       :  **    :#      :       |
        |       :        :       :       :       :**      B       :       |
      7 ++......................................**......##................|
        |       :        :       :       :    ** :    ##  :       :      ++ 15
        |       :        :       :       :  **   :   #    :       :       |
        |       :        :       :       :**     : ##     :       :       |
      6 ++..............................*A.......##.......................|
        |       :        :       :    ** :     ##:        :       :       |
        |       :        :       :  **   :    #  :        :       :       |
        |       :        :       :**     :  ##   :        :       :      ++ 10
      5 ++......................**........##..............................|
        |       :        :    ** :      #B       :        :       :       |
        |       :        :  **   :    ## :       :        :       :       |
        |       :        :**     :  ##   :       :        :       :       |
      4 ++...............A.......###......................................|
        |       :      **:     ##:       :       :        :       :       |
        |       :    **  :   ##  :       :       :        :       :      ++ 5
        |       :  **    : ##    :       :       :        :       :       |
        |       :**    ##B#      :       :       :        :       :       |
      3 ++.....**..####...................................................|
        |    **####      :       :       :       :        :       :       |
        |  **## :        :       :       :       :        :       :       |
        B**     +        +       +       +       +        +       +       +
      2 A+------+--------+-------+-------+-------+--------+-------+------++ 0
        1      1.5       2      2.5      3      3.5       4      4.5      5 
```

你可以在 Debian 和 Ubuntu 上通过运行`sudo apt install feedgnuplot`.

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2015-01-01T16:43:43.590

单行图非常简单，可以帮助人们*看到*高点和低点的模式。
另请参阅[pysparklines](https://pypi.python.org/pypi/pysparklines)。
（有谁知道 unicode 斜线，可以组合在一起制作线条，而不是条形图？）

```
#!/usr/bin/env python
# -*- coding: utf-8 -*-

from __future__ import division
import numpy as np

__version__ = "2015-01-02 jan  denis"

#...............................................................................
def onelineplot( x, chars=u"▁▂▃▄▅▆▇█", sep=" " ):
    """ numbers -> v simple one-line plots like

f ▆ ▁ ▁ ▁ █ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁  osc 47  ▄ ▁ █ ▇ ▄ ▆ ▅ ▇ ▇ ▇ ▇ ▇ ▄ ▃ ▃ ▁ ▃ ▂  rosenbrock
f █ ▅ █ ▅ █ ▅ █ ▅ █ ▅ █ ▅ █ ▅ █ ▅ ▁ ▁ ▁ ▁  osc 58  ▂ ▁ ▃ ▂ ▄ ▃ ▅ ▄ ▆ ▅ ▇ ▆ █ ▇ ▇ ▃ ▃ ▇  rastrigin
f █ █ █ █ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁ ▁  osc 90  █ ▇ ▇ ▁ █ ▇ █ ▇ █ ▇ █ ▇ █ ▇ █ ▇ █ ▇  ackley

Usage:
    astring = onelineplot( numbers [optional chars= sep= ])
In:
    x: a list / tuple / numpy 1d array of numbers
    chars: plot characters, default the 8 Unicode bars above
    sep: "" or " " between plot chars

How it works:
    linscale x  ->  ints 0 1 2 3 ...  ->  chars ▁ ▂ ▃ ▄ ...

See also: https://github.com/RedKrieg/pysparklines
    """

    xlin = _linscale( x, to=[-.49, len(chars) - 1 + .49 ])
        # or quartiles 0 - 25 - 50 - 75 - 100
    xints = xlin.round().astype(int)
    assert xints.ndim == 1, xints.shape  # todo: 2d
    return sep.join([ chars[j] for j in xints ])

def _linscale( x, from_=None, to=[0,1] ):
    """ scale x from_ -> to, default min, max -> 0, 1 """
    x = np.asanyarray(x)
    m, M = from_ if from_ is not None \
        else [np.nanmin(x), np.nanmax(x)]
    if m == M:
        return np.ones_like(x) * np.mean( to )
    return (x - m) * (to[1] - to[0]) \
        / (M - m)  + to[0]

#...............................................................................
if __name__ == "__main__":  # standalone test --
    import sys

    if len(sys.argv) > 1:  # numbers on the command line, may be $(cat myfile)
        x = map( float, sys.argv[1:] )
    else:
        np.random.seed( 0 )
        x = np.random.exponential( size=20 )

    print onelineplot( x ) 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2020-05-03T22:14:41.817

检查允许直接在终端上绘制数据的包[**plotext 。**](https://pypi.org/project/plotext/)它非常直观，因为它的语法与**matplotlib**非常相似。

这是一个基本示例：

```
import plotext as plt
y = plt.sin() # sinusoidal signal 
plt.scatter(y)
plt.title("Scatter Plot")
plt.show() 
```

[![散点图](https://raw.githubusercontent.com/piccolomo/plotext/master/images/scatter.png)](https://raw.githubusercontent.com/piccolomo/plotext/master/images/scatter.png)

您可以使用以下命令安装它：

```
sudo -H pip install plotext 
```

至于 matplotlib，主要功能是*scatter*（用于单点）、*plot*（用于由线连接的点）和*show*（在终端上实际打印绘图）。很容易指定绘图尺寸、点和线样式以及显示轴、数字刻度和最终方程的任何内容，这些用于将绘图坐标转换为原始实际值。

这是生成上图所示的代码：

```
import plotext.plot as plx
import numpy as np

l=3000
x=np.arange(0, l)
y=np.sin(4*np.pi/l*np.array(x))*np.exp(-0.5*np.pi/l*x)

plx.scatter(x, y, rows = 17, cols = 70)
plx.show(clear = 0) 
```

您还可以绘制**条形图： [![条形图](https://raw.githubusercontent.com/piccolomo/plotext/master/images/multiple-bar.png)](https://raw.githubusercontent.com/piccolomo/plotext/master/images/multiple-bar.png) [![图片](https://raw.githubusercontent.com/piccolomo/plotext/master/images/image.png)](https://raw.githubusercontent.com/piccolomo/plotext/master/images/image.png)

此处显示了绘制**连续数据流**的示例：

[![数据流](https://raw.githubusercontent.com/piccolomo/plotext/master/images/stream.gif)](https://raw.githubusercontent.com/piccolomo/plotext/master/images/stream.gif)

它可以**安装**

```
pip install plotext 
```

或与：

```
pip install "plotext[image]" to use plotext with images. 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-09-23T19:54:28.413

[gnuplot](http://www.gnuplot.info/)是您问题的明确答案。

[我个人也是google chart API](http://code.google.com/apis/chart/)的忠实粉丝，可以在 wget（或 curl）的帮助下从命令行访问它以下载 png 文件（并使用 xview 或类似的东西查看）。我喜欢这个选项，因为我发现图表更漂亮（即更好的抗锯齿）。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2018-11-27T10:16:33.287

gnuplot 的另一个更简单/更轻的替代品是[ervy](https://www.chunqiuyiyu.com/ervy/#started)，一个基于 NodeJS 的终端图表工具。

支持的类型：散点图（XY 点）、条形图、饼图、子弹图、甜甜圈和量规。

可以在项目[GitHub 存储库中找到具有各种选项的使用示例](https://github.com/chunqiuyiyu/ervy/blob/master/demo/index.js)

[![在此处输入图像描述](https://i.stack.imgur.com/pNmtY.png)](https://i.stack.imgur.com/pNmtY.png)

[![在此处输入图像描述](https://i.stack.imgur.com/mnRWj.png)](https://i.stack.imgur.com/mnRWj.png)

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2019-04-18T04:31:14.113

此外，[spark](https://zachholman.com/spark/)在你的 shell 中是一个不错的小条形图。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-09-23T20:13:27.120

您应该使用 gnuplot 并确保在启动后发出命令“set term dumb”。您还可以提供行数和列数。这是 gnuplot 的输出，如果您发出“set term dumb 64 10”，然后发出“plot sin(x)”：

```

    1 ++-----------****------------+--***--------+-----* ***--++
  0.6 *+ **+ * +** * sin(x)*******++
  0.2 +* * * ** ** * **++
    0 ++* ** * ** * ** *++
 -0.4 ++** * ** ** * * *+
 -0.8 ++ ** * + * ** + * +** +*
   -1 ++---****------+-------***---+----------****----- ------++
     -10 -5 0 5 10

```

它在 79x24 时看起来更好（不要在 80x24 显示器上使用第 80 列：一些 curses 实现并不总是在最后一列周围表现良好）。

我正在使用 gnuplot v4，但这应该适用于稍旧或较新的版本。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2021-02-08T14:19:37.227

我发现了一个名为`ttyplot`homebrew 的工具。很好。[https://github.com/tenox7/ttyplot](https://github.com/tenox7/ttyplot)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-02-02T18:32:42.660

这是我的 eplot 补丁，它为终端输出添加了 -T 选项：

```
--- eplot       2008-07-09 16:50:04.000000000 -0400
+++ eplot+      2017-02-02 13:20:23.551353793 -0500
@@ -172,7 +172,10 @@
                                        com=com+"set terminal postscript color;\n"
                                        @o["DoPDF"]=true

-                               # ---- Specify a custom output file
+                               when /^-T$|^--terminal$/
+                                       com=com+"set terminal dumb;\n"
+
+                                # ---- Specify a custom output file
                                when /^-o$|^--output$/
                                        @o["OutputFileSpecified"]=checkOptArg(xargv,i)
                                        i=i+1

                                    i=i+1 
```

使用它，您可以运行它`eplot -T`以获得 ASCII 图形结果而不是 gnuplot 窗口。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2021-06-05T11:28:12.790

[termplotlib](https://github.com/nschloe/termplotlib)（我的一个项目）最近开始流行起来，所以也许这对某些人有帮助。

```
import termplotlib as tpl
import numpy

x = numpy.linspace(0, 2 * numpy.pi, 10)
y = numpy.sin(x)

fig = tpl.figure()
fig.plot(x, y, label="data", width=50, height=15)
fig.show() 
```

```
 1 +---------------------------------------+
  0.8 |    **     **                          |
  0.6 |   *         **           data ******* |
  0.4 | **                                    |
  0.2 |*              **                      |
    0 |                 **                    |
      |                                   *   |
 -0.2 |                   **            **    |
 -0.4 |                     **         *      |
 -0.6 |                              **       |
 -0.8 |                       **** **         |
   -1 +---------------------------------------+
      0     1    2     3     4     5    6     7 
```

# performance - 尝试实现类似 XMPP 的协议的 IIS 性能问题

> ID：123387
> 
> 赞同：3
> 
> 时间：2008-09-23T19:50:46.767
> 
> 标签：performance, iis, httphandler, xmpp

我们有一个客户端，它需要从服务器获取交互式消息，这些客户端分布在世界各地的各种防火墙后面，各种端口都关闭了。我们唯一可以依赖的是 HTTP 端口 80（和 HTTPS 443）。

该设计基本上以 XMPP（Jabber 协议）为蓝本，使用我们的客户端和 IIS。客户端向 .NET 处理程序发出 GET 请求；处理程序将请求保持打开一段时间以查找消息。如果有任何消息到达，它们会立即发送给客户端；如果不是，则在超时后，连接会以“无数据”响应关闭。客户端立即重新打开通信。

嗯，理论上。

实际发生的情况是，首先，IIS 不能同时处理超过 100 个请求——其他请求都在排队，并且在“已连接”和 IIS 识别到客户端调用之间可能会有几分钟的延迟。其次，大约一半的时间客户端超时，服务器没有任何响应（客户端超时比服务器长五分钟）。

POST 始终有效。在同一 Web 服务器上提供的其他数据可以正常工作。Web 服务在同一台服务器上工作。这是 Windows 2K3 Server 上的开箱即用安装。

是否有我们缺少的配置选项，或者我应该看看其他什么来解决这个问题？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T23:15:26.713

我认为您正在达到 ASP.NET 线程池限制，而不是 IIS 限制。研究创建异步 HTTP 处理程序 ( `IHttpAsyncHandler`)，因为当它们阻塞/等待时，它们不会占用线程池（它们使用完成端口代替）。

**更新**：最近遇到这个似乎与我的想法一致：[CodeProject: Scalable COMET Combined with ASP.NET](http://www.codeproject.com/KB/aspnet/CometAsync.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T01:47:31.637

如果 IIS 不符合您的要求，您应该选择另一个 Web 服务器，例如[Apache](http://www.apache.org/)（带有[Mod_mono](http://www.mono-project.com/Mod_mono)）或[LightTPD](http://www.lighttpd.net/)。

[顺便说一句，您可以使用XMPP Over BOSH](http://www.xmpp.org/extensions/xep-0206.html)通过 HTTP 隧道传输 XMPP 。无需发明自定义协议。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-28T23:57:46.153

开箱即用，Windows 需要一些调整。我不得不在 asp.net 中实现一个彗星服务器并遇到了一些愚蠢的默认设置。阅读这些链接后：

*   [IIS 7.0 503 错误与实现 IHttpAsyncHandler 的通用处理程序 (.ashx)](https://stackoverflow.com/questions/612242/iis-7-0-503-errors-with-generic-handler-ashx-implementing-ihttpasynchandler)
*   [http://blogs.technet.com/b/winserverperformance/archive/2008/07/25/tuning-windows-server-2008-for-php.aspx](http://blogs.technet.com/b/winserverperformance/archive/2008/07/25/tuning-windows-server-2008-for-php.aspx)
*   [http://smallvoid.com/article/winnt-tcpip-max-limit.html](http://smallvoid.com/article/winnt-tcpip-max-limit.html)
*   [http://publib.boulder.ibm.com/infocenter/wasinfo/v6r1/index.jsp?topic=/com.ibm.websphere.express.doc/info/exp/ae/rprf_plugin.html](http://publib.boulder.ibm.com/infocenter/wasinfo/v6r1/index.jsp?topic=/com.ibm.websphere.express.doc/info/exp/ae/rprf_plugin.html)
*   [http://support.microsoft.com/kb/820129](http://support.microsoft.com/kb/820129)
*   [http://msdn.microsoft.com/en-us/library/ee37705(BTS.10).aspx](http://msdn.microsoft.com/en-us/library/ee37705(BTS.10).aspx)
*   [http://blogs.msdn.com/b/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx](http://blogs.msdn.com/b/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx)

我想出了对我们的 Windows 2k8 服务器进行的以下更改。

*   reg add HKLM\System\CurrentControlSet\Services\HTTP\Parameters /v MaxConnections /t REG_DWORD /d 1000000 /f
*   reg add HKLM\System\CurrentControlSet\Services\TcpIp\Parameters /v TcpTimedWaitDelay /t REG_DWORD /d 30 /f
*   注册添加 HKLM\SOFTWARE\Microsoft\ASP.NET\2.0.50727.0 /v MaxConcurrentThreadsPerCPU /t REG_DWORD /d 0 /f
*   注册添加 HKLM\SOFTWARE\Microsoft\ASP.NET\2.0.50727.0 /v MaxConcurrentRequestsPerCPU /t REG_DWORD /d 30000 /f
*   appcmd.exe 设置 apppool "[应用程序池名称]" /queueLength:65535
*   appcmd.exe 设置配置 /section:serverRuntime /appConcurrentRequestLimit:100000
*   reg add HKLM\System\CurrentControlSet\Services\TcpIp\Parameters /v MaxUserPort /t REG_DWORD /d 65534 /f
*   reg add HKLM\System\CurrentControlSet\Services\TcpIp\Parameters /v MaxFreeTcbs /t REG_DWORD /d 2000 /f
*   reg add HKLM\System\CurrentControlSet\Services\TcpIp\Parameters /v MaxHashTableSize /t REG_DWORD /d 2048 /f reg add HKLM\System\CurrentControlSet\Services\InetInfo\Parameters /v MaxPoolThreads /t REG_DWORD /d 80 /f
*   appcmd 设置配置 /section:processModel /requestQueueLimit:100000 /commit:MACHINE

我不知道是否所有更改都是必需的或最佳的，但是通过对测试服务器的一些快速测试，我们实现了超过 30k 的执行连接和每秒 5k 的请求。无法更进一步，因为我用完了客户端机器来运行测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-24T21:19:42.977

XMPP 从来不是为高性能应用程序设计的。消息必须遍历整个堆栈到达应用层，并且有大量的 XML 解析。您是否考虑过使用 XMPP 之外的其他标准？

# c# - 如何从主 AppDomain 卸载程序集？

> ID：123391
> 
> 赞同：50
> 
> 时间：2008-09-23T19:50:57.627
> 
> 标签：c#, .net, appdomain

我想知道如何卸载加载到主 AppDomain 中的程序集。

我有以下代码：

```
var assembly = Assembly.LoadFrom( FilePathHere ); 
```

完成后，我需要/希望能够卸载此程序集。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-09-23T19:51:53.083

**对于 .net 版本的 core 3.0 及更高版本：**

您现在可以卸载程序集。请注意，应用程序域在 .net 核心中不再可用。相反，您可以创建一个或多个 AssemblyLoadContext，通过该上下文加载程序集，然后卸载该上下文。请参阅[AssemblyLoadContext](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.loader.assemblyloadcontext?view=netcore-3.0)或[模拟加载插件然后卸载它的本教程](https://github.com/dotnet/samples/tree/master/core/tutorials/Unloading)。

**对于 .net core 3 之前的 .net 版本，包括网络 4 及更低版本**

您不能从 appdomain 中卸载程序集。您可以销毁应用程序域，但是一旦程序集加载到应用程序域中，它就会在应用程序域的整个生命周期内一直存在。

请参阅 Jason Zander 对[为什么没有 Assembly.Unload 方法的解释？](https://docs.microsoft.com/en-us/archive/blogs/jasonz/why-isnt-there-an-assembly-unload-method)

如果您使用的是 3.5，则可以使用 AddIn Framework 来更轻松地管理/调用不同的 AppDomain（您*可以*卸载它们，卸载所有程序集）。如果您使用的是之前的版本，您需要自己创建一个新的 appdomain 来卸载它。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2015-12-03T22:03:17.130

我也知道这已经很老了，但可以帮助遇到这个问题的人！这是我发现的一种方法！而不是使用：

```
var assembly = Assembly.LoadFrom( FilePathHere ); 
```

用这个：

```
var assembly = Assembly.Load( File.ReadAllBytes(FilePathHere)); 
```

这实际上加载了程序集文件的“内容”，而不是文件本身。这意味着程序集文件上没有文件锁！所以现在它可以被复制、删除或升级，而无需关闭您的应用程序或尝试使用单独的 AppDomain 或编组！

**优点：**很容易用 1 行代码修复！ **缺点：**不能使用 AppDomain、Assembly.Location 或 Assembly.CodeBase。

现在您只需要销毁在程序集上创建的任何实例。例如：

```
assembly = null; 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-23T19:52:34.487

如果不卸载整个 AppDomain，就无法卸载程序集。[原因](http://blogs.msdn.com/jasonz/archive/2004/05/31/145105.aspx)如下：

> 1.  您正在应用程序域中运行该代码。这意味着潜在的调用站点和调用堆栈中的地址有望继续工作。
>     
>     
> 2.  假设您确实设法跟踪程序集对已运行代码的所有句柄和引用。假设你没有生成代码，一旦你成功释放了程序集，你只释放了元数据和 IL。JIT 代码仍然分配在应用程序域加载器堆中（JIT 方法按调用顺序在缓冲区中顺序分配）。
>     
>     
> 3.  最后一个问题与已加载共享的代码有关，否则更正式地称为“域中立”（在 ngen 工具上查看 /shared）。在这种模式下，生成的程序集代码可以从任何应用程序域执行（没有硬连线）。
>     
>     
> 
> 建议您围绕应用程序域边界自然地设计应用程序，完全支持卸载。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-03-20T14:12:22.283

您应该在另一个中加载您的临时程序集`AppDomain`，当不使用时，您可以卸载它`AppDomain`。它安全快捷。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-23T19:59:38.883

如果您想拥有可以在之后卸载的临时代码，则根据您的需要，`DynamicMethod`该类可能会执行您想要的操作。不过，这并没有给你上课。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-11-28T15:05:36.043

我知道它很旧，但可能会帮助某人。您可以从流中加载文件并释放它。它对我有用。我在[这里](http://blogs.msdn.com/b/raulperez/archive/2010/03/04/net-reflection-and-unloading-assemblies.aspx)找到了解决方案。

希望能帮助到你。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-24T14:45:53.100

这是一个很好的例子，如何在运行时编译和运行 dll，然后卸载所有资源： [http ://www.west-wind.com/presentations/dynamicCode/DynamicCode.htm](http://www.west-wind.com/presentations/dynamicCode/DynamicCode.htm)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-03-07T15:07:21.753

作为替代方案，如果程序集刚刚加载，要检查公共密钥等程序集的信息，更好的方法是不加载它，而是首先仅加载 AssemblyName 来检查信息：

```
AssemblyName an = AssemblyName.GetAssemblyName ("myfile.exe");
byte[] publicKey = an.GetPublicKey();
CultureInfo culture = an.CultureInfo;
Version version = an.Version; 
```

**编辑**

如果您需要在程序集中反映类型而不将程序集放入您的应用程序域，您可以使用该`Assembly.ReflectionOnlyLoadFrom`方法。这将允许您查看它们在程序集中的类型，但不允许您实例化它们，并且也不会将程序集加载到 AppDomain。

看这个例子作为解释

```
public void AssemblyLoadTest(string assemblyToLoad)
{
    var initialAppDomainAssemblyCount = AppDomain.CurrentDomain.GetAssemblies().Count(); //4

    Assembly.ReflectionOnlyLoad(assemblyToLoad);
    var reflectionOnlyAppDomainAssemblyCount = AppDomain.CurrentDomain.GetAssemblies().Count(); //4

    //Shows that assembly is NOT loaded in to AppDomain with Assembly.ReflectionOnlyLoad
    Assert.AreEqual(initialAppDomainAssemblyCount, reflectionOnlyAppDomainAssemblyCount); // 4 == 4

    Assembly.Load(assemblyToLoad);
    var loadAppDomainAssemblyCount = AppDomain.CurrentDomain.GetAssemblies().Count(); //5

    //Shows that assembly is loaded in to AppDomain with Assembly.Load
    Assert.AreNotEqual(initialAppDomainAssemblyCount, loadAppDomainAssemblyCount); // 4 != 5
} 
```

# .net - Rhino Mocks：为存根上的方法重新分配新结果

> ID：123394
> 
> 赞同：3
> 
> 时间：2008-09-23T19:51:39.433
> 
> 标签：.net, rhino-mocks

我知道我可以这样做：

```
IDateTimeFactory dtf = MockRepository.GenerateStub<IDateTimeFactory>();
dtf.Now = new DateTime();
DoStuff(dtf); // dtf.Now can be called arbitrary number of times, will always return the same value
dtf.Now = new DateTime()+new TimeSpan(0,1,0);  // 1 minute later
DoStuff(dtf); //ditto from above 
```

如果**IDateTimeFactory.Now**不是一个属性，而是一个方法**IDateTimeFactory.GetNow()**，我该怎么做呢？

根据下面 Judah 的建议，我重写了我的 SetDateTime 辅助方法，如下所示：

```
 private void SetDateTime(DateTime dt) {
        Expect.Call(_now_factory.GetNow()).Repeat.Any();
        LastCall.Do((Func<DateTime>)delegate() { return dt; });
    } 
```

但它仍然会抛出“ICurrentDateTimeFactory.GetNow() 的结果；已经设置。” 错误。

再加上它仍然不能与存根一起工作......

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-02-05T00:29:08.740

我知道这是一个老问题，但我想我会发布更新的 Rhino Mocks 版本。

根据之前使用 Do() 的答案，如果您[在 Rhino Mocks 中使用 AAA](http://www.ayende.com/wiki/Rhino+Mocks+3.5.ashx#Arrange,Act,Assert)（从 3.5+ 版本开始提供），则可以使用一种稍微清洁（IMO）的方式。

```
 [Test]
    public void TestDoStuff()
    {
        var now = DateTime.Now;
        var dtf = MockRepository.GenerateStub<IDateTimeFactory>();
        dtf
           .Stub(x => x.GetNow())
           .Return(default(DateTime)) //need to set a dummy return value
           .WhenCalled(x => x.ReturnValue = now); //close over the now variable

        DoStuff(dtf); // dtf.Now can be called arbitrary number of times, will always return the same value
        now = now + new TimeSpan(0, 1, 0); // 1 minute later
        DoStuff(dtf); //ditto from above
    }

    private void DoStuff(IDateTimeFactory dtf)
    {
        Console.WriteLine(dtf.GetNow());
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T21:54:55.517

乔治，

使用您更新的代码，我得到了这个工作：

```
MockRepository mocks = new MockRepository();

[Test]
public void Test()
{
    IDateTimeFactory dtf = mocks.DynamicMock<IDateTimeFactory>();

    DateTime desiredNowTime = DateTime.Now;
    using (mocks.Record())
    {
        SetupResult.For(dtf.GetNow()).Do((Func<DateTime>)delegate { return desiredNowTime; });
    }
    using (mocks.Playback())
    {
        DoStuff(dtf); // Prints the current time    
        desiredNowTime += TimeSpan.FromMinutes(1);  // 1 minute later    
        DoStuff(dtf); // Prints the time 1 minute from now
    }
}

void DoStuff(IDateTimeFactory factory)
{
    DateTime time = factory.GetNow();
    Console.WriteLine(time);
} 
```

FWIW，我不相信您可以使用存根来完成此操作；您需要改用模拟。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T20:07:19.927

您可以使用 Expect.Call 来完成此操作。这是使用记录/播放模型的示例：

```
using (mocks.Record())
{
   Expect.Call(s.GetSomething()).Return("ABC"); // 1st call will return ABC
   Expect.Call(s.GetSomething()).Return("XYZ"); // 2nd call will return XYZ
}
using (mocks.Playback())
{
   DoStuff(s);
   DoStuff(s);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T20:43:25.877

好的，所以我的第一个答案对您不起作用，因为 GetSomething 可能会被多次调用，而您不知道多少次。

您在这里遇到了一些复杂的场景——未知数量的方法调用，但在调用 DoSomething 后会产生不同的结果——我建议您分解单元测试以使其更简单，否则您必须为您的单元进行单元测试测试。:-)

如果做不到这一点，您可以通过以下方式完成您正在尝试做的事情：

```
bool shouldReturnABC = true;
using (mocks.Record())
{
   Expect.Call(s.GetSomething()).Repeat.Any();

   LastCall.Do((Func<string>)delegate()
   {
      return shouldReturnABC ? "ABC" : "XYZ";
   }
}
using (mocks.Playback())
{
   DoStuff(s);
   shouldReturnABC = false;
   DoStuff(s);
} 
```

# jquery - 使用 jQuery 查找下一个表格行

> ID：123401
> 
> 赞同：15
> 
> 时间：2008-09-23T19:52:09.667
> 
> 标签：jquery

使用 jQuery，您如何将单击事件绑定到`class="expand"`将更改`image src`（在单击的单元格中 - 原始将是 plus.gif，与 minus.gif 交替）的表格单元格（下面，）和`hide/show`它下面的行关于该行是否有一个类`hide`。（如果它有一个“隐藏”类则显示它，如果它没有一个“隐藏”类则隐藏）。我可以灵活地更改标记中的 id 和类。

谢谢

表格行

```
<tr>
  <td class="expand"><img src="plus.gif"/></td>
  <td>Data1</td><td>Data2</td><td>Data3</td>
</tr>
<tr class="show hide">
  <td> </td>
  <td>Data4</td><td>Data5</td><td>Data6</td>
</tr> 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-23T20:07:41.640

您不需要显示和隐藏标签：

```
$(document).ready(function(){   
    $('.expand').click(function() {
        if( $(this).hasClass('hidden') )
            $('img', this).attr("src", "plus.jpg");
        else 
            $('img', this).attr("src", "minus.jpg");

        $(this).toggleClass('hidden');
        $(this).parent().next().toggle();
    });
}); 
```

编辑：好的，我添加了更改图像的代码。这只是一种方法。当后面的行被隐藏时，我将一个类作为标签添加到 expand 属性中，并在显示该行时将其删除。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-23T21:00:36.210

没有人喜欢三元算子吗？:) 我了解可读性考虑因素，但由于某种原因，它点击让我将其写为：

```
$(document).ready( function () {
    $(".expand").click(function() {
            $("img",this).attr("src", 
                 $("img",this)
                    .attr("src")=="minus.gif" ? "plus.gif" : "minus.gif"
            );
            $(this).parent().next().toggle();
    });
}); 
```

...并且没有多余的类的好处。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-04-10T12:53:23.067

我最近不得不解决这个问题，但我的涉及一些嵌套表，所以我需要一个更具体、更安全的 javascript 版本。我的情况有点不同，因为我有一个 td 的内容并想切换下一个 TR，但概念保持不变。

```
$(document).ready(function() {
    $('.expandButton').click(function() {
        $(this).closest('tr').next('tr.expandable').fadeToggle();
    });
}); 
```

Closest 抓取最近的 TR，在这种情况下是第一个父级。如果你想变得非常具体，你可以在那里添加一个 CSS 类。然后我指定使用可扩展类获取下一个 TR，即此按钮的目标。然后我只是`fadeToggle()`切换它是否显示。指定选择器确实有助于缩小它将处理的范围。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T20:33:12.907

试试这个...

```
//this will bind the click event
//put this in a $(document).ready or something
$(".expand").click(expand_ClickEvent);

//this is your event handler
function expand_ClickEvent(){
   //get the TR that you want to show/hide
   var TR = $('.expand').parent().next();

   //check its class
   if (TR.hasClass('hide')){
      TR.removeClass('hide'); //remove the hide class
      TR.addClass('show');    //change it to the show class
      TR.show();              //show the TR (you can use any jquery animation)

      //change the image URL
      //select the expand class and the img in it, then change its src attribute
      $('.expand img').attr('src', 'minus.gif');
   } else {
      TR.removeClass('show'); //remove the show class
      TR.addClass('hide');    //change it to the hide class
      TR.hide();              //hide the TR (you can use any jquery animation)

      //change the image URL
     //select the expand class and the img in it, then change its src attribute
      $('.expand img').attr('src', 'plus.gif');
   }
} 
```

希望这可以帮助。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-09-23T20:08:42.060

这是在 html 中设置图像的方式

```
<tr>

<td colspan="2" align="center"
<input type="image" src="save.gif" id="saveButton" name="saveButton"
    style="visibility: collapse; display: none" 
     onclick="ToggleFunction(false)"/>

<input type="image" src="saveDisabled.jpg" id="saveButtonDisabled" 
      name="saveButton" style="visibility: collapse; display: inline"
      onclick="ToggleFunction(true)"/>
</td>
</tr> 
```

将事件更改`onClick`为您自己在 JS 中的函数以在它们之间切换。

在里面

```
ToggleFunction(seeSaveButton){    
    if(seeSaveButton){
        $("#saveButton").attr("disabled", true)
                        .attr("style", "visibility: collapse; display: none;");
        $("#saveButtonDisabled").attr("disabled", true)
                                .attr("style", "display: inline;");
    }    
    else {    
        $("#saveButton").attr("disabled", false)
                        .attr("style", "display: inline;");
        $("#saveButtonDisabled")
                        .attr("disabled", true)
                        .attr("style", "visibility: collapse; display: none;");
    }
} 
```

# java - 在 Oracle 中构建图像数据库 - 电子商务风格的界面是否可行？

> ID：123421
> 
> 赞同：0
> 
> 时间：2008-09-23T19:54:47.303
> 
> 标签：java, oracle

## 问题

我可以建立一个具有电子商务风格的结账系统和强大的 Oracle/Java 搜索功能的图像数据库/库吗？是否有我应该注意的现有元素？或者，这在 PHP/MySQL 等另一个开发环境中是否更好？

## 概述

我在 UI 方面的图像数据库/库开发团队工作，但我不禁感到团队在这方面的跟踪有点偏离了方向。

通常情况下，我希望在 PHP/MySQL/Apache 服务器环境等开源、免许可环境中完全看到这一点，但是严格的 IT 审批流程限制了 Oracle 作为 DB 组件的探索领域，然后使用 Java可能的编程环境。

注意到这一点，我从未使用过任何一个，也不知道将以下功能放在一起会有多复杂：

*   基于关键字和元数据的搜索
*   电子商务式结账系统（无需支付方式或基础设施）
*   图像画廊分组（由中央编辑器编辑）
*   标签云生成和搜索
*   将元数据从嵌入式元数据（在 XMP 中）解析到数据库的组件
*   用于数据库管理、受控关键字列表维护和内容管理的基于 Web 的后端

我已经上传了我为 Web 端开发的 UI 屏幕截图的 pdf。

[用户界面截图](http://www.chlorophylldesign.com/mambo/MMLPreviews%5bscreen%5d.pdf)

对于复杂的 Q 感到抱歉，我自己很难处理。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T20:02:21.653

看来您的问题确实是 Oracle/Java 和 PHP/MySQL 之间的斗争。您陈述的细节使用这些工具集或使用我能想到的其他十几个工具集都不太难实现。

如果我是正确的（只有你知道），那么这对你来说是一个极好的机会。您似乎有使用免费/开放工具的经验，但没有使用商业/封闭工具的经验。然后借此机会学习你的雇主的一角钱。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T20:00:14.873

我无法评论 Jave 是否合适，但您可以查看 Oracle Application Express 环境[http://apex.oracle.com](http://apex.oracle.com)。这看起来和听起来完全在他们的目标范围内。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T12:52:49.063

感谢**大卫**和**dacracot**的见解。

Upon further review and consultation (plus some leveraging) of our IT department, considering that this app and DB would run on their own server, and apparently other areas of the corporation have approved the use of open server technologies like PHP, SQL and Apache, this will likely move to a PHP/SQL build for a few reasons, not the least of them being licensing costs of putting Oracle on a new server and the overall larger availability of PHP/SQL developers in the local dev community.

I did adapt some of **dacracot's** advice however, and convinced admin to send me to some .NET training so I can better assist in managing our intranet. I will also keep the **Oracle Application Express** site in mind for further dev needs across our intranet.

Thanks for your help.

# sql-server - 在带有 SQL Server 2008 的 Windows Server 2003 上安装 TFS 2008 Workgroup Edition

> ID：123430
> 
> 赞同：1
> 
> 时间：2008-09-23T19:55:32.280
> 
> 标签：sql-server, windows, tfs

我在安装 Team Foundation Server 2008 Workgroup Edition 时遇到了问题。我有一台几乎是新的 Windows Server 2003 SP2 机器。我已经安装了几乎所有选项的 SQL Server 2008。当我运行 TFS 安装时，它允许我输入我的 SQL 实例名称，然后通过验证过程以确保我拥有所需的一切。但是，我收到一条错误消息，指出

> 未安装兼容版本的 SQL Server。

我验证了，并且我的 SQL Server 2008 运行得很好。它是标准版，并且安装了全文、报告和分析服务。我收到的其他错误是未安装、运行或启用全文。

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T05:39:33.950

要针对 SQL Server 2008 安装 Team Foundation Server 2008，您必须使用 TFS 2008 Service Pack 1。但是，目前 Microsoft 不提供“TFS with SP1”下载 - 您必须通过下载 TFS 2008 媒体创建自己的集成安装，然后在运行安装程序之前将服务包应用到媒体。

有关更多信息，请参阅我的博客文章here

[http://www.woodwardweb.com/vsts/creating_a_tfs.html](http://www.woodwardweb.com/vsts/creating_a_tfs.html)

另请注意，TFS 需要对其 SQL Server 进行某些设置。在为 TFS 安装 SQL 实例时，我通常非常严格地遵循 TFS 安装指南中的指导，以确保我已正确设置所有内容。您可以在此处下载 TFS 安装指南的最新副本

[http://www.microsoft.com/downloads/details.aspx?FamilyID=FF12844F-398C-4FE9-8B0D-9E84181D9923&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=FF12844F-398C-4FE9-8B0D-9E84181D9923&displaylang=en)

祝你好运，

马丁。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T20:05:16.500

您需要 Tfs 2008 Sp1 来支持 SQL Server 2008。请参阅这篇文章[http://geekswithblogs.net/etiennetremblay/archive/2008/08/11/sql-2008--tfs-2008-sp1-the-lowdownhellip.aspx](http://geekswithblogs.net/etiennetremblay/archive/2008/08/11/sql-2008--tfs-2008-sp1-the-lowdownhellip.aspx)

Hth.，/格特

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T19:57:19.927

马丁-谢谢你的帖子。我在[http://weblogs.asp.net/jgaylord/archive/2008/09/24/installing-team-foundation-server-2008-on-sql-server-2008找到了您的程序的更简洁版本并在博客中介绍了它.aspx](http://weblogs.asp.net/jgaylord/archive/2008/09/24/installing-team-foundation-server-2008-on-sql-server-2008.aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T09:43:56.743

在 TFS 安装指南中其实有一篇文章叫做“如何：集成 Team Foundation Server 和 Service Pack 1 的安装”

将 TFS DVD 提取到“TFS2008” 将 TFS SP1 提取到“SP1” 从它们所在的目录运行此命令 从 TFS2008WITHSP1 运行安装程序

注意：目标目录似乎需要完全限定

MSIEXEC /a TFS2008\AT\VS_SETUP.MSI /p SP1\TFS90sp1-KB949786.msp TARGETDIR=s:\software\msdn\servers\TFS2008WITHSP1

# performance - 进度报告

> ID：123453
> 
> 赞同：3
> 
> 时间：2008-09-23T19:57:53.257
> 
> 标签：performance, project-management, project-planning

我不是在谈论你在大学里得到的那种，而是在为开发人员实施工作进度报告。

我组织开发团队的想法是令人鼓舞的，并且在某种程度上，需要定期更新进度，因为开发人员会报告他们在过去一小时或几个小时内做了什么以及任务花费了多长时间。下面我列出了我想到的一些专业人士

*   让我回去看看我是否可能犯了一个错误，并在努力解决我创造的问题时让自己成为一个起点。
*   让团队很好地了解他们是否参与了项目并定期更新
*   对于未来的项目，能够回过头来查看某项任务花费了多长时间并创建准确的估计
*   鼓励团队之间进行更多的沟通

我不希望看到它成为让开发人员喘不过气来的一种方式，而且我认为如果有人感到压力每小时提交更新，它很容易分散注意力。

*   你有什么想法？
*   优点和缺点。
*   你有没有亲身经历过这种情况？它让你感觉如何？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-23T19:59:58.493

每小时都太频繁了。如此多的中断会降低生产力，并增加开发人员的挫败感。我建议研究一下 Scrum 方法，他们有一个“每日 Scrum”会议，每天早上你都会向团队更新你前一天的进度并计划当天的工作。它对我有用，它可能对你有用。

Scrum 还包括故事和任务卡的概念，您可以在其中估算时间，并最终回来看看您的估算距离有多远。这为您提供了一个“焦点因素”，您可以使用它来帮助提高未来估计的准确性。

查看[Trenches](http://www.crisp.se/henrik.kniberg/ScrumAndXpFromTheTrenches.pdf)中的这个 PDF Scrum 和 XP 以获得关于它的好读物。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T20:35:32.463

通常，要求状态报告的频率超过每天一次会让您获得大量 Office Space TPS 报告评论。您在更多项目数据中看到的任何好处都会很快被士气低落和团队普遍萎靡不振所抵消。

尝试定期（可能每天）要求更新。不要要求正式的书面报告，这是你作为 PM 的工作，为你的老板提供这些报告。开发人员有开发工作要做。尽量不要让他们承担管理任务的负担。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T20:17:42.740

这是项目经理无法理解他们的角色的又一个例子。Scrum 不是答案，也不是任何其他教义。在任何组织中，为了更好地支持或参与决策，您到底为什么需要每小时报告？你是工人鱼吗？他们是否有不超过 60 分钟的回忆，需要你通过“嘿，杰夫......它怎么样？”......完全令人筋疲力尽的思路杀手镊子驱动暂停“wazup patch22？.. . 我在 59 分钟前见过的那个人……”

如果你能非常详细地了解最后一次失误出了什么问题……你的下一个项目会发生完全相同的出轨吗？即使确实如此，您是否了解避免所有形式的滑动/错误/进展所需的机器人化？

成为人类……帮助人类，大声呼喊！没有奇迹般的数学结构方法可以实现高水平的生产力……只有启发式。阅读 The Mythical Man Month 和其他人......这不是关于糟糕的管理技术，而是关于事故，因为我们正在与人类打交道。

我做过的最好的和提高团队生产力的事情（当我“只是”一个 PM 时）：让我的员工吃得好、睡得好、有规律的作息，并向他们提供“问我你最愚蠢的问题，我”我只会回答 IFFFF 我 10000% 肯定答案”。保护他们免受上面的压力，为他们解决下面的问题，确保他们知道你在那里是为了出气筒的职责。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T20:19:21.393

我会避免一起使用状态报告，但如果您必须使用它们，请不要让它们比每周更频繁。优秀的开发者更像是艺术家而不是劳动者。他们以创造性的方式创作出伟大的作品，而不是像时钟一样规律地工作。如果您需要频繁的状态报告，他们会感到不必要的压力，这实际上会降低他们的快乐、缺乏创造力，并最终降低工作效率。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T20:24:49.953

我们使用[twitter.com](http://twitter.com)进行团队更新。我要求我的团队在开始一项任务、完成一项任务以及完成一项任务并开始一项新任务时发推文。这边走：

1.  我知道他们经常在做什么，我不需要闯入他们的办公室总是问，'你在做什么？
2.  如果开发人员沉默太久，我可以去提供帮助。
3.  开发人员可以轻松地寻求帮助，而无需打扰其他开发人员
4.  Twitter 中的字符限制确保更新很短，并且不需要大量时间来创建。

我们都将我们的帐户设置为私人帐户，以确保我们组之外的任何人都不会收到我们的推文。我们已经使用了两个月的大部分时间......它真的让我了解了我的人正在做的事情而不会打扰。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T20:14:11.283

每隔几个小时报告一次进度报告是多余的。如果您正在使用源代码控制工作，您可以在跟踪签入和为开发人员设置标准以评论他们所做的任何提交/签入方面获得大量里程。通过这种方式，您不会纠缠他们（并导致非常昂贵的上下文切换），但您允许他们留在他们的流程中，同时仍然能够监控进度。

根据您的源代码控制的复杂程度，您可以将任务与提交/签入相关联，这是跟踪估计的额外粒度。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-16T01:06:22.577

你想做两件事。

**每日会议**

你要做的就是问两个问题。

1.  你昨天做了什么？
2.  你今天打算做什么？

您很快就会确定开发人员是否正在取得进展，或者是否存在任何导致延迟的问题。试图更频繁地获取更新将被证明是矫枉过正，并且可能被视为微观管理。

**每周进度报告**

每周一次，花半小时整理一份简单的报告，涵盖以下内容

*   成就
*   假设
*   依赖项
*   问题
*   决议

这样做不需要太多努力，它会让您很好地了解项目的跟踪方式。它在提供管理或客户以及正在发生的事情和需要解决的问题的概述方面也非常有效。

如需更全面的概述，请访问以下链接

*   [每日会议](http://www.martinbauer.com/articles/open_project_management/daily_meetings)
*   [进度报告](http://www.martinbauer.com/articles/open_project_management/progress_reports)

干杯，马蒂

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T20:00:41.597

Scrum 方法很好地处理了这个问题。你每天都有简短的会议来报告进展和障碍。它可以让每个人都被赶上，而不会被细节所困扰。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T20:01:04.713

查看 Scrum，它是一种敏捷方法，它定义了您想做的所有事情，并且对我们的团队（以及我读过的许多其他人）非常有用。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T20:06:13.907

**敏捷 scrum**实际上执行了这一点。我们遵循 VSTS Scrum 方法和项目模板来跟踪所有任务/Bug 等，我们可以轻松地为时间报告设置一个字段（我们正在考虑尽快实施）这样最终的数据将对组织非常有用评估人们进行评估。如果他们缺乏一些专业知识，我们可以通过这种密切跟踪轻松发现这一点。但是这个实用性**大吗？**

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T20:50:12.460

如果可以的话，我会取消状态报告。虽然这听起来是个好主意，但它传达的信息是您正在尝试管理人员，而不是专注于完成工作的最佳方式。从我所见，当你描述一些需要完成的工作，然后给他们足够的空间，然后提供自己作为资源时，人们似乎工作得最好。我认为像每小时报告这样的事情对每个人来说都很难，包括你。

一个快速的早会（类似于 scrum）可能会有所帮助 - 如果有人挂断电话，很快就会变得很明显，因为他们每天都在说同样的话。它还让其他人有机会站出来提供帮助，如果您愿意，或者如果您有一个喜欢评论想法的老板，您可以随时私下记录。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-27T18:07:36.380

**领导团队的一切都是日程安排、动机、优先级和冲突管理。**

我每周一早上都会召集我的团队，然后我们开始工作，聊聊他们的工作。

我们谈论我们在前一周完成的工作，以及我们期待在下一周完成的工作。

最重要的是，我们每个人都会提出我们所做的事情（通常与代码相关），这些事情在某种程度上确实令人兴奋。一些刚刚起作用的代码；一个新应用程序创意的餐巾纸草图；一种可以丰富团队其他成员的新技术；

*总*有一些东西。

我发现，除了以令人欣喜的成就清单开始新的一周之外，思考未来会怎样，以及等待着哪些令人敬畏的项目/成就也是令人振奋的。

我们在会议之外制定后勤工作。时间表、优先级是根据个人情况处理的。

这样的会议实际上产生了像[Finisht.com](http://finisht.com/)和[Twenis.com](http://twenis.com/)这样的小事。这非常酷，与我一起工作的团队对编码感到非常兴奋，以至于我有时无法相信。

# java - 从 Eclipse 调试 JSP

> ID：123462
> 
> 赞同：51
> 
> 时间：2008-09-23T19:59:15.950
> 
> 标签：java, eclipse, jsp, servlets, debugging

有谁知道从 Eclipse 中调试 JSP 的好工具？我希望能够在应用程序运行时在 Eclipse 中设置和观察断点、单步执行 Java 代码/标签等（在我的情况下是在 JBoss 下）。

据推测，调试从 JSP 生成的 servlet 类相当简单，但它也相当不吸引人。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-23T20:49:36.110

如果您安装了[WTP](https://en.wikipedia.org/wiki/Eclipse_(software)#Web_Tools_Platform)，您可以在 JSP 中设置断点，它们在常规的“远程调试”会话中工作正常。但是，一旦您在断点处停止，单步执行代码几乎是不可能的，并且在“变量”视图中找到您想要检查的任何内容都需要大量挖掘。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T05:36:51.693

如果您必须在 JSP 中使用调试器，那么您很有可能在 JSP 中做一些您不应该做的事情。我建议您认真思考您当前的实现是否使用了良好的 MVC 设计实践。JSP 真的应该是关于表示的，它应该很少（如果有的话）需要调试。

如果您必须在 JSP 中实现某些逻辑结构，请考虑使用自定义标记（在 IDE 中易于调试）来实现它们，或者在控制器 servlet 中进行处理，以易于消化的形式呈现数据对于 JSP。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-06-06T20:30:51.020

在 Eclipse 中，您可以在 jsp 文件中设置断点，单步执行 Java 代码/标记等。
但是，在调试时您可以使用的唯一视图是“**变量**”视图来检查任何变量的值。

还有一件事，你看不到这个表达式的值：
<%= **response.encodeURL("ProcessLogin.jsp")** %>
只是变量**response**的值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-06-13T18:58:24.347

显然，Eclipse 对此有[一个故障排除页面](http://help.eclipse.org/indigo/index.jsp?topic=%2Forg.eclipse.wst.server.ui.doc.user%2Ftopics%2Ftdbgjsp.html)，但当我尝试它时，我确实得到了 404。希望这至少可以让你朝着一个好的方向开始。

# monitoring - Zabbix：是否可以监视任意字符串变量？

> ID：123480
> 
> 赞同：0
> 
> 时间：2008-09-23T20:01:11.313
> 
> 标签：monitoring, sysadmin, zabbix

我们使用 Zabbix 进行服务监控。

配置了一些基本的监控。我希望拥有我的服务版本字符串的时间表以及此监控。这将使我有机会看到升级到这个版本改变了整体错误计数。

可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-27T19:44:17.913

是的，这是可能的。

您可以使用 zabbix_server.conf 中的“UserParameter”字段，即代理配置文件，将任意数据从您的 Zabbix 代理传递到 Zabbix 服务器。

一般语法是：

> UserParameter=section[id]，命令

例如，假设您想监控有多少用户登录。您将使用：

> 用户参数=sys[num_users]，谁 | wc -l

（我假设您知道如何配置 Zabbix 服务器来接收这些数据，这非常简单——只需创建一个新项目，将其绑定到模板并将模板连接到服务器或服务器组）。

如果您想监视某个文件的特定字符串，只需使用 grep、sed、cut、tr 和其他标准 Unix 工具。如果您需要更复杂的东西，只需编写一个 shell 脚本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-27T19:51:51.953

更新伊戈尔的回答：

`zabbix_agentd.conf`UserParameter 在or中声明为客户端`zabbix_agent.conf`（取决于您使用的是守护程序还是 inetd 版本），而不是`zabbix_server.conf`.

# sql - SQL REPLACE 上的奇怪输出

> ID：123489
> 
> 赞同：0
> 
> 时间：2008-09-23T20:02:48.673
> 
> 标签：sql, ibm-midrange

我在 SQL 视图中使用 REPLACE 从属性编号中删除空格。该功能设置如下 REPLACE(pin, ' ', '')。在绿屏上，查询看起来不错。在其他任何情况下，我们都会获得字段中字符的十六进制值。我确定这是一个编码问题，但我该如何解决呢？

这是我用来创建视图的语句：

```
CREATE VIEW RLIC2GIS AS SELECT REPLACE(RCAPIN, ' ', '') AS 
RCAPIN13 , RLICNO, RONAME, ROADR1, ROADR2, ROCITY, ROSTAT, ROZIP1, 
ROZIP2, RGRID, RRADR1, RRADR2, RANAME, RAADR1, RAADR2, RACITY,     
RASTAT, RAZIP1, RAZIP2, REGRES, RPENDI, RBLDGT, ROWNOC, RRCODE,    
RROOMS, RUNITS, RTUNIT, RPAID, RAMTPD, RMDYPD, RRFUSE, RNUMCP,     
RDATCP, RINSP, RCAUKY, RCAPIN, RAMTYR, RYREXP, RDELET, RVARIA,     
RMDYIN, RDTLKI, ROPHN1, ROPHN2, ROCOM1, ROCOM2, RAPHN1, RAPHN2,    
RACOM1, RACOM2, RNOTES FROM RLIC2 
```

更新：我在下面发布了答案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T20:50:47.030

我们最终使用 concat 和 substring 来获得我们想要的结果。

```
CREATE VIEW RLIC2GIS AS                                  
SELECT CONCAT(SUBSTR(RCAPIN,1,3),CONCAT(SUBSTR(RCAPIN,5,2),      
CONCAT(SUBSTR(RCAPIN,8,2), CONCAT(SUBSTR(RCAPIN,11,3),           
SUBSTR(RCAPIN, 15,3))))) AS CAPIN13, RLICNO, RONAME, ROADR1,     
ROADR2, ROCITY, ROSTAT, ROZIP1, ROZIP2, RGRID, RRADR1, RRADR2,   
RANAME, RAADR1, RAADR2, RACITY, RASTAT, RAZIP1, RAZIP2, REGRES,  
RPENDI, RBLDGT, ROWNOC, RRCODE, RROOMS, RUNITS, RTUNIT, RPAID,   
RAMTPD, RMDYPD, RRFUSE, RNUMCP, RDATCP, RINSP, RCAUKY, RCAPIN,   
RAMTYR, RYREXP, RDELET, RVARIA, RMDYIN, RDTLKI, ROPHN1, ROPHN2,  
ROCOM1, ROCOM2, RAPHN1, RAPHN2, RACOM1, RACOM2, RNOTES FROM RLIC2 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T21:55:13.910

这里的问题可能是您认为该字段中的空白字符实际上是其他一些不可打印的字符。

您可以使用以下 SQL 来查看第 4 位的 ASCII 字符是什么：

```
SELECT ascii(substr(RCAPIN,4,1)) 
FROM YOUR-TABLE 
```

然后，您将能够使用替换该字符而不是空格：

```
SELECT replace(RCAPIN,chr(9))
FROM YOUR-TABLE 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T20:04:44.143

尝试使用 NULL 而不是空字符串。即替换（RCAPIN，''，NULL）

# python - 将 apache2 摘要身份验证信息传递给由 mod_wsgi 运行的 wsgi 脚本

> ID：123499
> 
> 赞同：8
> 
> 时间：2008-09-23T20:05:07.437
> 
> 标签：python, apache, authentication, mod-wsgi, wsgi

我有指令

```
<VirtualHost *>
    <Location />
        AuthType Digest
        AuthName "global"
        AuthDigestDomain /
        AuthUserFile /root/apache_users
        <Limit GET>
            Require valid-user
        </Limit>
    </Location>
    WSGIScriptAlias / /some/script.wsgi
    WSGIDaemonProcess mywsgi user=someuser group=somegroup processes=2 threads=25
    WSGIProcessGroup mywsgi
    ServerName some.example.org
</VirtualHost> 
```

我想知道 /some/script.wsgi

```
def application(environ, start_response):
    start_response('200 OK', [
        ('Content-Type', 'text/plain'),
    ])
    return ['Hello'] 
```

什么用户登录。

我怎么做？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-23T20:08:51.840

添加`WSGIPassAuthorization On`：

```
<VirtualHost *>
    <Location />
        AuthType Digest
        AuthName "global"
        AuthDigestDomain /
        AuthUserFile /root/apache_users
        <Limit GET>
            Require valid-user
        </Limit>
    </Location>
    WSGIPassAuthorization On
    WSGIScriptAlias / /some/script.wsgi
    WSGIDaemonProcess mywsgi user=someuser group=somegroup processes=2 threads=25
    WSGIProcessGroup mywsgi
    ServerName some.example.org
</VirtualHost> 
```

然后阅读`environ['REMOTE_USER']`：

```
def application(environ, start_response):
    start_response('200 OK', [
        ('Content-Type', 'text/plain'),
    ])
    return ['Hello %s' % environ['REMOTE_USER']] 
```

更多信息请[参见 mod_wsgi 文档](http://code.google.com/p/modwsgi/wiki/ConfigurationGuidelines#User_Authentication "WSGI 应用程序上的用户认证")。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-24T12:43:03.257

有关 Apache/mod_wsgi 和访问、身份验证和授权机制的其他信息，请参见：

[http://code.google.com/p/modwsgi/wiki/AccessControlMechanisms](http://code.google.com/p/modwsgi/wiki/AccessControlMechanisms)

默认情况下不会传递该信息，因为这样做可能会将密码信息泄漏给可能不应该获取它的应用程序。

# iphone - 如何使用我的 iPhone 应用程序拍照？

> ID：123503
> 
> 赞同：18
> 
> 时间：2008-09-23T20:05:35.030
> 
> 标签：iphone, cocoa-touch, camera

我正在用 xcode 中的 Cocoa 编写一个 iPhone 应用程序。我找不到任何教程或示例代码来展示如何使用内置相机拍照。我该怎么做呢？我在哪里可以找到好的信息？

谢谢！

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2012-09-12T05:41:57.547

只需将以下代码复制并粘贴到您的项目中即可获得完全实现的功能。

其中**takePhoto** 和**chooseFromLibrary** 是我自己的方法名称，将在按钮触摸时调用。

确保将相应按钮的插座引用到这些方法。

```
 -(IBAction)takePhoto :(id)sender

{
        UIImagePickerController *imagePickerController = [[UIImagePickerController alloc] init];

        if ([UIImagePickerController isSourceTypeAvailable:UIImagePickerControllerSourceTypeCamera])
        {
            [imagePickerController setSourceType:UIImagePickerControllerSourceTypeCamera];
        }

        // image picker needs a delegate,
        [imagePickerController setDelegate:self];

    // Place image picker on the screen
    [self presentModalViewController:imagePickerController animated:YES];
}

-(IBAction)chooseFromLibrary:(id)sender
{

    UIImagePickerController *imagePickerController= [[UIImagePickerController alloc] init]; 
    [imagePickerController setSourceType:UIImagePickerControllerSourceTypePhotoLibrary];

    // image picker needs a delegate so we can respond to its messages
    [imagePickerController setDelegate:self];

    // Place image picker on the screen
    [self presentModalViewController:imagePickerController animated:YES];

}

//delegate methode will be called after picking photo either from camera or library
- (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary *)info
{   
    [self dismissModalViewControllerAnimated:YES]; 
    UIImage *image = [info objectForKey:UIImagePickerControllerOriginalImage];

    [myImageView setImage:image];    // "myImageView" name of any UIImageView.
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-24T13:35:03.370

使用`UIImagePickerController`. 这里有一个很好的教程。

[http://www.zimbio.com/iPhone/articles/1109/Picking+Images+iPhone+SDK+UIImagePickerController](http://www.zimbio.com/iPhone/articles/1109/Picking+Images+iPhone+SDK+UIImagePickerController)

您应该将源类型设置为`UIImagePickerControllerSourceTypeCamera`或`UIImagePickerControllerSourceTypePhotoLibrary`。请注意，这两种类型会导致屏幕上的显示非常不同。您应该仔细测试两者。特别是，如果您`UIImagePickerController`在 a 内部嵌套`UINavigationController`，如果您不小心，最终可能会出现多个导航栏和其他奇怪的效果。

另请参阅[此线程](https://stackoverflow.com/questions/74113/access-the-camera-with-iphone-sdk)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T20:17:22.880

该`UIImagePickerController`课程可让您拍照或从照片库中选择它们。将源类型指定为`UIImagePickerControllerSourceTypeCamera`。

另请参阅之前提出的这个问题： [Access the camera with iPhone SDK](https://stackoverflow.com/questions/74113/access-the-camera-with-iphone-sdk)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-02-25T12:15:51.853

@WQS 发布的答案工作正常，但包含一些 iOS 6 已弃用的方法。以下是 iOS 6 及更高版本的更新答案：

```
-(void)takePhoto
{
    UIImagePickerController *imagePickerController = [[UIImagePickerController alloc] init];

    if ([UIImagePickerController isSourceTypeAvailable:UIImagePickerControllerSourceTypeCamera])
    {
        [imagePickerController setSourceType:UIImagePickerControllerSourceTypeCamera];
    }

    // image picker needs a delegate,
    [imagePickerController setDelegate:self];

    // Place image picker on the screen
    [self presentViewController:imagePickerController animated:YES completion:nil];
}

-(void)chooseFromLibrary
{

    UIImagePickerController *imagePickerController= [[UIImagePickerController alloc]init];
    [imagePickerController setSourceType:UIImagePickerControllerSourceTypePhotoLibrary];

    // image picker needs a delegate so we can respond to its messages
    [imagePickerController setDelegate:self];

    // Place image picker on the screen
    [self presentViewController:imagePickerController animated:YES completion:nil];

}

//delegate methode will be called after picking photo either from camera or library
- (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary *)info
{
    [self dismissViewControllerAnimated:YES completion:nil];
    UIImage *image = [info objectForKey:UIImagePickerControllerOriginalImage];

[myImageView setImage:image];    // "myImageView" name of any UImageView.
} 
```

不要忘记将其添加到您的`view controller.h`：

```
@interface myVC<UINavigationControllerDelegate, UIImagePickerControllerDelegate> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-10-07T20:03:16.883

这是我用来为我的应用拍照的代码

```
- (IBAction)takephoto:(id)sender {

    picker = [[UIImagePickerController alloc] init];
    picker.delegate = self;
    [picker setSourceType:UIImagePickerControllerSourceTypeCamera];
    [self presentViewController:picker animated:YES completion:NULL];

}
-(void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary *)info
{
    img = [info objectForKey:@"UIImagePickerControllerOriginalImage"];
    [imageview setImage:img];
    [self dismissViewControllerAnimated:YES completion:NULL];
} 
```

如果你想重拍只需简单的添加这个功能

```
-(void)imagePickerControllerDidCancel:(UIImagePickerController *)picker
{
    [self dismissViewControllerAnimated:YES completion:NULL];
} 
```

# wxwidgets - 在 wxDC 中查找每英寸的像素

> ID：123504
> 
> 赞同：0
> 
> 时间：2008-09-23T20:05:35.780
> 
> 标签：wxwidgets

在 wxWidgets 中，如何找到 wxDC 上每英寸的像素？我希望能够通过像英寸这样的真实世界数字来缩放事物。这通常可以更轻松地使用相同的代码打印到屏幕和打印机。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T20:24:30.477

这有帮助吗？（来自手册）

```
wxDC::GetPPI
wxSize GetPPI() const

Returns the resolution of the device in pixels per inch. 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T20:28:01.530

...或[wxDC::GetSizeMM](http://docs.wxwidgets.org/2.6/wx_wxdc.html#wxdcgetsizemm)返回以毫米为单位的水平和垂直分辨率。

# c# - C# 编译器错误地优化代码

> ID：123506
> 
> 赞同：3
> 
> 时间：2008-09-23T20:05:41.787
> 
> 标签：c#, asp.net, optimization, compiler-construction, ilmerge

我有一个在远程 Web 服务器上运行的 ASP.NET 应用程序，我刚开始收到此错误：

```
Method not found: 'Void System.Collections.Generic.ICollection`1..ctor()'. 
```

我反汇编了 DLL 中的代码，似乎编译器错误地优化了代码。（请注意，Set 是一个实现一组唯一对象的类。它继承自 IEnumerable。）这一行：

```
Set<int> set = new Set<int>(); 
```

编译成这一行：

```
Set<int> set = (Set<int>) new ICollection<CalendarModule>(); 
```

CalendarModule 类是一个完全不相关的类！！以前有没有人注意到 .NET 错误地编译了这样的代码？

**更新 #1：**这个问题似乎是由 Microsoft 的[ILMerge](http://research.microsoft.com/~mbarnett/ILMerge.aspx)工具引入的。我们目前正在研究如何克服它。

**更新 #2：**到目前为止，我们找到了两种解决此问题的方法。我们不太了解根本问题是什么，但是这两个都解决了它：

1.  关闭优化。

2.  在另一台机器上将程序集与 ILMerge 合并。

所以我们想知道构建机器是否以某种方式错误配置（考虑到我们已经使用该机器构建版本已经一年多了，这很奇怪）或者是否是其他问题。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T07:57:29.453

啊，ILMerge - 您问题中的额外信息确实有助于解决您的问题。虽然我从没想过.net 编译器会以这种方式失败，但我希望偶尔会在 ILMerge 中看到这种事情（考虑到它在做什么）。

我的猜测是您的两个程序集使用相同的优化“技巧”，一旦合并，您就会遇到冲突。

您是否向 Microsoft 提出了该错误？

同时，一种解决方法是将源程序集重新编译为单个程序集，从而节省对 ILMerge 的需求。由于 csproj 文件只是 XML 列表，因此它们基本上很容易合并，您可以将其自动化为额外的 MSBuild 步骤。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T20:10:50.963

您确定您正在查看的程序集实际上是从相关源代码生成的吗？你能用一个小测试用例重现这个问题吗？

**编辑：**如果您使用反射器，则 MSIL 到 C# 的转换可能不正确——反射器在反编译时并不总是 100% 准确。MSIL 是什么样的？

**编辑2：**嗯......我刚刚意识到它不可能是Reflector的错误，否则您在运行时不会收到该错误消息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T20:19:35.950

这更可能是反射工具的问题，而不是 .Net 编译的问题。您遇到的错误 - 在远程处理期间未找到构造函数很可能是序列化问题（所有可序列化类都需要无参数构造函数）。

从您的反射工具中找到的代码更有可能引发类型转换异常。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T20:20:05.590

我同意 Curt 和 Beds 的观点；这听起来像是严重错误。优化器对我们所有人都有效，并且没有报告过这样的错误（据我所知）——难道你实际上做错了什么？

旁注：我还想指出`System.Collections.Generic.HashSet<T>`.Net fx 3.5 中的哪个，并且完全符合一个`Set<>`类的要求。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T20:17:59.823

代码最近是否部署到该服务器？有人会在您不知情的情况下推动构建吗？你能去源代码控制，拉最新的，然后复制问题吗？

在这一点上，根据给定的信息，我怀疑它是编译器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T21:32:21.593

哎哟。如果这确实是 ILMerge 的错误，请根据您的发现及时更新本主题——我使用 ILMerge 作为构建 COM 互操作程序集的关键步骤。

# visual-studio-2008 - 如何在 Visual Studio 2005 中使用 .NET 3.0？

> ID：123524
> 
> 赞同：3
> 
> 时间：2008-09-23T20:08:36.537
> 
> 标签：visual-studio-2008, visual-studio-2005, interop, .net-3.0

我的 Google-fu 在这个问题上让我失望了。

我有一位同事在他的机器上安装了 Visual Studio 2005。我有 Visual Studio 2008。他想打开一个我用 C# 3.0 编写的项目，我们已经做到了这一点，但是 VS2005 对 3.0 代码有问题，比如`var`.

他安装了 3.0 和 3.5 框架，以及 Visual Studio 2005 Extensions for Windows Workflow。他还需要什么？还是我们在追求一个失败的事业，一场疯狂的追逐，因为我认为我听说有一次在某个地方这是可能的？

请不要建议他安装 VS2008 或 Express 版。这在这个时候根本是不可能的。:(

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T20:11:52.987

据我了解，这是不可能的。如果您没有使用新的 C# 3.0 代码功能，他应该能够使用在 VS2008 中创建的项目（并针对 2.0 框架进行编译），但我认为 2005 编译器永远不会能够以应对新的语法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T20:19:03.143

您可以在 vs2005 中重新创建项目文件，然后将文件上的标头更新为 vs2005，然后您就可以重新开始工作了。查看[Rick Strahls 博客](http://www.west-wind.com/Weblog/posts/122975.aspx)，了解有关其完成方式的更多详细信息。

还值得一看[Visual Studio 2005/2008 互操作性中的项目转换器](http://home.hot.rr.com/graye/Articles/ProjectConverter.htm)

您可能还需要安装 .Net 3.0 的 Visual Studio 2005 扩展。[世界自然基金会扩展](http://www.microsoft.com/downloads/details.aspx?FamilyId=5D61409E-1FA3-48CF-8023-E8F38E709BA6&displaylang=en)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T20:11:39.043

IDE 本身可能不支持 3.0 功能。如果您可以在没有 3.0 功能的情况下生活，您可以编译到 2.0，他应该能够正常运行。

# html - 如何将 HTML 内容置于 Flash 影片之上？

> ID：123529
> 
> 赞同：9
> 
> 时间：2008-09-23T20:09:19.687
> 
> 标签：html, css, flash

我正在处理的网站有 Flash 标头（使用[swfobject](http://code.google.com/p/swfobject/)嵌入它们）。现在，我需要编写一些应该与 Flash 电影重叠的 HTML 代码。

我尝试在 Flash 元素的容器和（绝对定位的）div 上设置 z-index，但它一直在 Flash 电影后面“消失”。

我希望有一个 CSS 解决方案，但如果有一点 JS 魔法可以解决问题，我会接受的。

**更新：**谢谢，将 wmode 设置为“透明”主要修复了它。只有 Safari/Mac 在第一次展示时仍将 div 隐藏在 flash 后面。当我切换到另一个应用程序并返回时，它会在前面。我可以通过将 div 的初始样式设置为`display: none;`并在页面加载半秒后通过 JS 使其可见来解决此问题。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-23T20:10:21.277

确保 FlashVar“wmode”设置为“透明”或“不透明”，但不是默认设置，“窗口化”...然后你应该能够使用 CSS z-index

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T09:00:07.243

后续说明：正如您在更新中发现的那样，让 HTML 显示在 Flash 之上目前是一个挑剔的命题，即使您发现了 JS 魔法，您也应该期望 Flash 会为某些使用 off 的查看者屏蔽您的 HTML - 浏览器、旧版本等。

如果覆盖任意大的浏览受众对您很重要（例如移动设备），那么从长远来看，重新设计您的内容以避免重叠可能会让您头疼。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-03T22:12:57.263

我想补充一点，您必须记住在`OBJECT`和`EMBED`标签中设置 WMODE 参数（“透明”）！

点击链接了解详情： http: [//kb2.adobe.com/cps/142/tn_14201.html](http://kb2.adobe.com/cps/142/tn_14201.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-06-15T09:04:48.493

使用以下样式的代码，它适用于 Firefox 和 chrome

```
<object id='myId'  width='700' height='500'>
            <param name='movie' value='images/ann/$imagename' />
            <param name='wmode' value='transparent' />
            <!--[if !IE]>-->
            <object type='application/x-shockwave-flash' data='images/ann/$imagename' width='700' height='500' wmode='transparent'>
            <!--<![endif]-->
            <div>
                <h1>Please download flash player</h1>
                <p><a href='http://www.adobe.com/go/getflashplayer'><img src='http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif' alt='Get Adobe Flash player' /></a></p>
            </div>
            <!--[if !IE]>-->
            </object>
            <!--<![endif]-->
        </object> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T08:53:52.640

像这样设置这个闪存变量

```
s1.addParam("wmode","transparent"); 
```

然后在 div 标签中使用这种风格

```
style="z-index:inherit; 
```

问题将得到解决。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-29T16:03:55.890

就像史蒂夫保罗说的那样，当你的 flash 上的 HTML 调用更多 flash 时，有趣的部分就来了……

哦，我们玩那个很有趣，其中涉及将 z-index 设置为实际上更低，以说明 flash 认为它是蜜蜂的膝盖，因此必须始终位于顶部。

# wpf - 洗掉的用户界面 - 有没有办法纠正它？

> ID：123537
> 
> 赞同：1
> 
> 时间：2008-09-23T20:10:46.250
> 
> 标签：wpf, user-interface, colors, lcd, calibration

这是一个有趣的难题。

我们有一个 WPF 应用程序，它有一个类似于 Vista 的主题，使用柔和的粉彩、Aero 控制模板等。我们注意到，这个 UI 在低质量的 LCD 上显得非常褪色。有没有办法提高整个应用程序的色彩饱和度，或者我们是否受到坏显示器的摆布？如果我们被显示在低质量的监视器上，我们甚至可以通过编程方式判断吗？

编辑：

基本上，这些答案是我希望有人确认的，而不是我带领人们说出来的！出现这种情况是比我更高的管理决策，我需要一些佐证。

谢谢大家！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T20:26:00.210

你选择了一个糟糕的调色板。

在 UI 上做一些工作；引入更自然的对比。

即使可以，您也不希望添加编程来解决错误的调色板选择。

只是改变颜色。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T20:22:11.823

我不确定 WPF 是否允许你做任何事情，但我的猜测是你不能直接控制用户的监视器。您可以获取有关用户计算机的信息，即位深度，但即时调整图形信息将非常昂贵（处理器方面）。您可以编写一个例程来完成它 - 更改图形的颜色或类似的东西，但为什么呢？它是客户端机器——你真的应该以你无法控制它的想法来编程。如果它在他们的屏幕上被洗掉，那么他们需要更好的硬件，或者他们需要正确调整显示器的亮度/收缩。它基本上超出了你的控制范围。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T20:46:32.827

离开前两个所说的，这里是对色彩理论的理解可以派上用场的地方。您无法控制人们显示器的饱和度或色调；据您所知，有些人可能会以灰度方式使用您的应用程序。因此，重要的是从精心挑选的、多功能的颜色和色调开始。包含尽可能多不同设置的通用方案是 UI 的良好起点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T21:09:55.127

去看看两个屏幕投射：
[马克米勒关于优秀用户体验的科学第 1 部分](http://www.dnrtv.com/default.aspx?showNum=112)
[马克米勒关于优秀用户体验的科学第 2 部分](http://www.dnrtv.com/default.aspx?showNum=123)

有一些关于 UI 的颜色和对比度的信息可能会有所帮助，此外还有许多其他有用的信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T08:41:58.357

一个疯狂的想法是实现一个饱和度着色器并将其设置在窗口上:) 这样用户就可以自己控制饱和度！

但是......就像我说的......一个疯狂的想法，可能不是一个好主意！

# .net - 修改现有的 .NET 程序集

> ID：123540
> 
> 赞同：16
> 
> 时间：2008-09-23T20:11:22.943
> 
> 标签：.net, reflection, assemblies, reflection.emit, cil

有没有办法修改现有的 .NET 程序集而不求助于 3rd 方工具？我知道[PostSharp](http://www.postsharp.org/)使这成为可能，但我发现 PostSharp 的开发人员基本上必须重写整个`System.Reflection`命名空间的功能才能使现有程序集可修改，这非常浪费。

`System.Reflection.Emit`只允许创建新的动态程序集。但是，这里使用的所有构建器类都继承自基本反射类（例如`TypeBuilder`，继承自`System.Type`）。不幸的是，似乎没有办法将现有的、动态加载的类型强制到类型构建器中。至少，没有官方支持的方式。

那么不支持怎么办？有谁知道允许将现有程序集或类型加载到此类构建器类中的后门？

请注意，我**不是**在寻找修改当前程序集的方法（这甚至*可能*是一个不合理的请求），而只是为了修改从光盘加载的现有程序集。我担心没有这样的事情，但我还是想问一下。

在最坏的情况下，人们不得不求助于`ildasm.exe`反汇编代码然后`ilasm.exe`重新组装，但是.NET 中没有包含工具链（阅读：IL 阅读器）来处理 IL 数据（或者是否存在？）。

/编辑：

我没有具体的用例。我只是对通用解决方案感兴趣，因为修补现有程序集是一项非常常见的任务。以混淆器、分析器或 AOP 库为例（是的，后者*可以*以不同的方式实现）。正如我所说，被迫在`System.Reflection`.

* * *

## @楔：

你是对的。但是，这里没有特定的用例。我已经修改了原始问题以反映这一点。另一个问题引发了我的兴趣，提问者想知道如何在每个方法的末尾注入指令`pop`，`ret`以防止 Lutz Roeder 的 Reflector 重新设计（VB 或 C#）源代码。

现在，这个场景可以通过许多工具来实现，例如上面提到的 PostSharp 和用于 Reflector 的[Reflexil](http://sebastien.lebreton.free.fr/reflexil/)插件，而后者又使用[Cecil](http://www.mono-project.com/Cecil)库。

总而言之，我只是对 .NET 框架不满意。

## @乔尔：

是的，我知道这个限制。无论如何，感谢您指出它，因为它很重要。

## @马克思达德：

这似乎是唯一可行的方法。但是，这意味着您仍然必须使用构建器类重新创建完整的程序集，对吗？即，您必须手动遍历整个组件。

嗯，我会调查的。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-18T07:14:24.100

Mono.Cecil 还允许您从给定程序集中删除强名称并将其保存为未签名程序集。从程序集中删除强名称后，您只需修改目标方法的 IL 并像使用任何其他程序集一样使用该程序集。这是使用 Cecil 删除强名称的链接：

[http://groups.google.com/group/mono-cecil/browse_thread/thread/3cc4ac0038c99380/b8ee62b03b56715d?lnk=gst&q=strong+named#b8ee62b03b56715d](http://groups.google.com/group/mono-cecil/browse_thread/thread/3cc4ac0038c99380/b8ee62b03b56715d?lnk=gst&q=strong+named#b8ee62b03b56715d)

删除强名称后，您几乎可以对程序集做任何您想做的事情。享受！

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-23T20:23:50.743

您可以使用**MethodInfo.GetMethodBody().GetILAsByteArray()**，对其进行修改，然后将其重新插入**MethodBuilder.CreateMethodBody()**。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T20:18:50.053

如果您可以提供更具体的用例，这将有所帮助，可能有比这更好的方法来解决您的问题。

在 .NET 3.5 中，可以将扩展方法添加到现有的框架类中，也许这就足够了？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-23T20:46:36.790

重要的一点：如果程序集已*签名*，任何更改都将失败，您最终会得到一个无效的结果。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T22:57:11.623

.NET Framework 程序集已签名，正如 Joel Coehoorn 所说，你会得到一个无用的。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2008-09-23T20:19:28.883

您可以使用 IronRuby 加载程序集，并混合您梦寐以求的所有功能

# sql - 插入临时表，并创建一个 IDENTITY 字段，而不先声明临时表？

> ID：123557
> 
> 赞同：44
> 
> 时间：2008-09-23T20:13:37.603
> 
> 标签：sql, sql-server

我需要选择一堆数据到一个临时表中，然后做一些二次计算；为了帮助它更有效地工作，我想在该表上有一个 IDENTITY 列。我知道我可以先用身份声明表，然后将其余数据插入其中，但是有没有办法一步完成？

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-09-23T20:26:09.350

哦，你们这些小信仰：

```
SELECT *, IDENTITY( int ) AS idcol
  INTO #newtable
  FROM oldtable 
```

[http://msdn.microsoft.com/en-us/library/aa933208(SQL.80).aspx](http://msdn.microsoft.com/en-us/library/aa933208(SQL.80).aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-23T21:04:32.597

您评论说：如果 oldtable 有标识列，则不起作用。

我想这就是你的答案。#newtable 自动从旧表中获取标识列。运行以下语句：

```
create table oldtable (id int not null identity(1,1), v varchar(10) )

select * into #newtable from oldtable

use tempdb
GO
sp_help #newtable 
```

它向您显示#newtable 确实具有标识列。

如果您不想要标识列，请在创建 #newtable 时尝试此操作：

```
select id + 1 - 1 as nid, v, IDENTITY( int ) as id into #newtable
     from oldtable 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-16T19:23:44.133

Good Question & Matt's 是一个很好的答案。如果旧表具有身份，则要稍微扩展语法，用户可以运行以下命令：

```
SELECT col1, col2, IDENTITY( int ) AS idcol
INTO #newtable
FROM oldtable 
```

如果 oldtable 的脚本是这样的：

```
CREATE TABLE [dbo].[oldtable]
(
    [oldtableID] [numeric](18, 0) IDENTITY(1,1) NOT NULL,
    [col1] [nvarchar](50) NULL,
    [col2] [numeric](18, 0) NULL,
) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-12-31T18:13:50.493

如果您想包含当前标识的列，您仍然可以这样做，但您必须显式列出列并将当前标识转换为 int（假设它现在是一个），如下所示：

```
select cast (CurrentID as int) as CurrentID, SomeOtherField, identity(int) as TempID 
into #temp
from myserver.dbo.mytable 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T20:42:53.570

为了使事情变得高效，您需要将其中一列声明为主键：

```
ALTER TABLE #mytable
ADD PRIMARY KEY(KeyColumn) 
```

这不会为列名使用变量。

相信我，你最好做 a: `CREATE #myTable TABLE`（或者可能是 a ） ，`DECLARE TABLE @myTable`它允许你直接设置。`IDENTITY``PRIMARY KEY`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-10-10T04:33:32.957

如果在 * 之后，您为第二次中断查询的 id 列设置别名……并给它一个新名称……它神奇地开始工作。

```
select IDENTITY( int ) as TempID, *, SectionID as Fix2IDs
into #TempSections
from Files_Sections 
```

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2008-09-23T20:25:35.297

IIRC，INSERT INTO 命令使用源表的模式来创建临时表。这就是您不能只尝试创建带有附加列的表的部分原因。标识列在内部与称为生成器的 SQL Server 构造相关联。

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2008-09-23T20:27:43.590

您可以执行 Select Into，它会根据您选择的字段动态创建表结构，但我认为它不会为您创建身份字段。

# sql-server - SQL Server 2005：T-SQL 临时禁用触发器

> ID：123558
> 
> 赞同：50
> 
> 时间：2008-09-23T20:13:41.610
> 
> 标签：sql-server, sql-server-2005, tsql

是否可以禁用一批命令的触发器，然后在批处理完成时启用它？

我确信我可以放下触发器并重新添加它，但我想知道是否还有其他方法。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-09-23T20:14:26.647

```
DISABLE TRIGGER { [ schema_name . ] trigger_name [ ,...n ] | ALL }
ON { object_name | DATABASE | ALL SERVER } [ ; ] 
```

[http://msdn.microsoft.com/en-us/library/ms189748(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms189748(SQL.90).aspx)

其次是逆：

```
ENABLE TRIGGER { [ schema_name . ] trigger_name [ ,...n ] | ALL }
ON { object_name | DATABASE | ALL SERVER } [ ; ] 
```

[http://msdn.microsoft.com/en-us/library/ms182706(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms182706(SQL.90).aspx)

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-09-23T21:20:24.463

有时要从外部数据源填充空数据库或调试数据库中的问题，我需要禁用所有触发器和约束。为此，我使用以下代码：

**要禁用所有约束和触发器：**

```
sp_msforeachtable "ALTER TABLE ? NOCHECK CONSTRAINT all"
sp_msforeachtable "ALTER TABLE ? DISABLE TRIGGER  all" 
```

**要启用所有约束和触发器：**

```
exec sp_msforeachtable @command1="print '?'", @command2="ALTER TABLE ? WITH CHECK CHECK CONSTRAINT all"
sp_msforeachtable @command1="print '?'", @command2="ALTER TABLE ? ENABLE TRIGGER  all" 
```

我前段时间在[SQLServerCentral](http://www.sqlservercentral.com/articles/Administering/enabledisable/177/)上找到了该解决方案，但需要修改启用约束部分，因为原来的部分不能完全工作

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-23T20:35:14.150

但是，这样做几乎总是一个坏主意。你会弄乱数据库的完整性。不要在没有考虑后果并与 dbas 核对是否有它们的情况下这样做。

如果您确实遵循马特的代码，请务必记住重新打开触发器。并且请记住，触发器在关闭时对每个插入、更新或删除表的人都禁用，而不仅仅是您的进程，所以如果必须这样做，那么在数据库最不活跃的时间进行（最好是在单用户模式下）。

如果您需要这样做来导入大量数据，请考虑批量插入不会触发触发器。但是，您在批量插入之后的过程将不得不修复您引入的任何数据完整性问题，也不能触发触发器。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2013-07-04T05:38:09.050

[为了扩展马特的答案，这里是MSDN](http://msdn.microsoft.com/en-us/library/ms182706%28SQL.90%29.aspx)上给出的一个例子。

```
USE AdventureWorks;
GO
DISABLE TRIGGER Person.uAddress ON Person.Address;
GO
ENABLE Trigger Person.uAddress ON Person.Address;
GO 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-10-02T23:53:43.213

另一种方法是在不实际禁用触发器的情况下*有效地禁用*触发器，使用一个包含在触发器中的附加状态变量。

```
create trigger [SomeSchema].[SomeTableIsEditableTrigger] ON [SomeSchema].[SomeTable]
for insert, update, delete 
as
declare
    @isTableTriggerEnabled bit;

exec usp_IsTableTriggerEnabled -- Have to use USP instead of UFN for access to #temp
    @pTriggerProcedureIdOpt  = @@procid,    
    @poIsTableTriggerEnabled = @isTableTriggerEnabled out;

if (@isTableTriggerEnabled = 0)
    return;

-- Rest of existing trigger
go 
```

对于状态变量，可以读取表中某种类型的锁定控制记录（最好仅限于当前会话的上下文），使用 CONTEXT_INFO()，或使用特定临时表名称的存在（这已经是会话范围有限的）：

```
create proc [usp_IsTableTriggerEnabled]
    @pTriggerProcedureIdOpt  bigint          = null, -- Either provide this
    @pTableNameOpt           varchar(300)    = null, -- or this
    @poIsTableTriggerEnabled bit             = null out
begin

    set @poIsTableTriggerEnabled = 1; -- default return value (ensure not null)

    -- Allow a particular session to disable all triggers (since local 
    -- temp tables are session scope limited).
    --
    if (object_id('tempdb..#Common_DisableTableTriggers') is not null)
    begin
        set @poIsTableTriggerEnabled = 0;
        return;
    end

    -- Resolve table name if given trigger procedure id instead of table name.
    -- Google: "How to get the table name in the trigger definition"
    --
    set @pTableNameOpt = coalesce(
         @pTableNameOpt, 
         (select object_schema_name(parent_id) + '.' + object_name(parent_id) as tablename 
           from sys.triggers 
           where object_id = @pTriggerProcedureIdOpt)
    );

    -- Else decide based on logic involving @pTableNameOpt and possibly current session
end 
```

然后禁用所有触发器：

```
select 1 as A into #Common_DisableTableTriggers;
-- do work 
drop table #Common_DisableTableTriggers; -- or close connection 
```

一个潜在的主要缺点是触发器会根据访问状态变量的复杂性而永久减慢。

[编辑：添加对Samuel Vanga 2008 年](http://www.mssqltips.com/sqlservertip/1591/disabling-a-trigger-for-a-specific-sql-statement-or-session/)这篇惊人相似的帖子的引用。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-08-19T09:30:14.507

```
ALTER TABLE table_name DISABLE TRIGGER TRIGGER_NAME
-- Here your SQL query
ALTER TABLE table_name ENABLE TRIGGER TRIGGER_NAME 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-09-09T18:00:06.283

不是批处理编程的最佳答案，但对于其他寻找此问题以寻找一种快速简便的方法来临时禁用触发器的人来说，这可以在 SQL Server Management Studio 中完成。

1.  展开桌子上的触发器文件夹
2.  右键单击触发器
3.  禁用

[![在此处输入图像描述](https://i.stack.imgur.com/7DetD.png)](https://i.stack.imgur.com/7DetD.png)

按照相同的过程重新启用。

# regex - 如何使用正则表达式验证电话号码

> ID：123559
> 
> 赞同：1004
> 
> 时间：2008-09-23T20:13:42.937
> 
> 标签：regex, validation, phone-number

我正在尝试组合一个全面的正则表达式来验证电话号码。理想情况下，它将处理国际格式，但它必须处理美国格式，包括以下内容：

*   `1-234-567-8901`
*   `1-234-567-8901 x1234`
*   `1-234-567-8901 ext1234`
*   `1 (234) 567-8901`
*   `1.234.567.8901`
*   `1/234/567/8901`
*   `12345678901`

我会用我目前的尝试来回答，但我希望有人有更好和/或更优雅的东西。

* * *

## 回答 #1

> 赞同：540
> 
> 时间：2008-09-23T20:35:51.260

`+44 (0) ...`更好的选择...只需在输入时去掉所有非数字字符（“x”和前导“+”号除外），请小心，因为英国在被要求使用国际前缀时倾向于以非标准形式书写数字（在那种特定情况下，您应该`(0)`完全丢弃）。

然后，您最终会得到如下值：

```
 12345678901
 12345678901x1234
 345678901x1234
 12344678901
 12345678901
 12345678901
 12345678901
 +4112345678
 +441234567890 
```

然后当你展示时，重新格式化你的内心。例如

```
 1 (234) 567-8901
  1 (234) 567-8901 x1234 
```

* * *

## 回答 #2

> 赞同：325
> 
> 时间：2008-09-23T20:32:39.630

事实证明，至少对于北美来说，这有一个规范，称为[NANP](http://en.wikipedia.org/wiki/North_American_Numbering_Plan)。

您需要准确指定您想要的内容。什么是法定分隔符？空格、破折号和句号？不允许分隔符？一个可以混合分隔符（例如，+0.111-222.3333）吗？如何处理扩展（例如，111-222-3333 x 44444）？像 911 这样的特殊号码呢？区号是可选的还是必需的？

这是 7 位或 10 位数字的正则表达式，允许扩展，分隔符是空格、破折号或句点：

```
^(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?$ 
```

* * *

## 回答 #3

> 赞同：322
> 
> 时间：2009-08-07T17:24:27.650

```
.* 
```

如果用户想给你他们的电话号码，那么相信他们会做对。如果他们不想给你，那么强迫他们输入一个有效的数字会将他们发送到竞争对手的网站，或者让他们输入一个适合你的正则表达式的随机字符串。我什至可能会想查找收费率占星热线的号码，然后输入。

我还将以下任何一项视为网站上的有效条目：

```
"123 456 7890 until 6pm, then 098 765 4321"  
"123 456 7890 or try my mobile on 098 765 4321"  
"ex-directory - mind your own business" 
```

* * *

## 回答 #4

> 赞同：190
> 
> 时间：2013-03-26T18:13:37.110

我还建议查看“ [libphonenumber](https://github.com/googlei18n/libphonenumber) ”谷歌图书馆。我知道它不是正则表达式，但它正是你想要的。

例如，它将认识到：

```
15555555555 
```

是一个可能的数字，但不是一个有效的数字。它还支持美国以外的国家。

**功能亮点：**

*   解析/格式化/验证世界所有国家/地区的电话号码。
*   `getNumberType`- 根据号码本身获取号码的类型；能够区分固定电话、移动电话、免费电话、收费费、分摊费用、VoIP 和个人号码（只要可行）。
*   `isNumberMatch`- 获得关于两个数字是否相同的置信度。
*   `getExampleNumber`/ `getExampleNumberByType`- 为所有国家/地区提供有效的示例号码，并可选择指定需要哪种类型的示例电话号码。
*   `isPossibleNumber`- 仅使用长度信息快速猜测一个号码是否是可能的电话号码，比完整验证快得多。
*   `isValidNumber`- 使用长度和前缀信息对区域的电话号码进行全面验证。
*   `AsYouTypeFormatter`- 当用户输入每个数字时，即时格式化电话号码。
*   `findNumbers`- 在文本输入中查找数字。
*   `PhoneNumberOfflineGeocoder`- 提供与电话号码相关的地理信息。

# 例子

电话号码验证的最大问题是它非常依赖于文化。

*   **美国**
    *   `(408) 974–2042`是一个**有效**的美国号码
    *   `(999) 974–2042`不是**有效的**美国号码
*   **澳大利亚**
    *   `0404 999 999`是**有效**的澳大利亚号码
    *   `(02) 9999 9999`也是一个**有效**的澳大利亚号码
    *   `(09) 9999 9999`不是**有效**的澳大利亚号码

正则表达式可以用来检查电话号码的格式，但它并不能真正检查电话号码的*有效性*。

我建议跳过一个简单的正则表达式来测试您的电话号码，并使用诸如 Google 的库[`libphonenumber`（链接到 GitHub 项目）](https://github.com/googlei18n/libphonenumber)。

# 介绍 libphonenumber！

使用您更复杂的示例之一，您可以从[（链接到在线演示）](https://libphonenumber.appspot.com/phonenumberparser?number=234-567-8901+x123&country=US&geocodingLocale=en-US)`1-234-567-8901 x1234`中获得[以下数据`libphonenumber`](https://libphonenumber.appspot.com/phonenumberparser?number=234-567-8901+x123&country=US&geocodingLocale=en-US)：

```
Validation Results

Result from isPossibleNumber()  true
Result from isValidNumber()     true

Formatting Results:

E164 format                    +12345678901
Original format                (234) 567-8901 ext. 123
National format                (234) 567-8901 ext. 123
International format           +1 234-567-8901 ext. 123
Out-of-country format from US  1 (234) 567-8901 ext. 123
Out-of-country format from CH  00 1 234-567-8901 ext. 123 
```

因此，您不仅可以了解电话号码是否有效（确实如此），而且您还可以在您的语言环境中获得一致的电话号码格式。

作为奖励，`libphonenumber`还有许多数据集可以检查电话号码的有效性，因此检查诸如`+61299999999`（国际版[`(02) 9999 9999`](https://libphonenumber.appspot.com/phonenumberparser?number=+61299999999&country=AU&geocodingLocale=en-US)）之类的数字会返回具有格式的有效数字：

```
Validation Results

Result from isPossibleNumber()  true
Result from isValidNumber()     true

Formatting Results

E164 format                    +61299999999
Original format                61 2 9999 9999
National format                (02) 9999 9999
International format           +61 2 9999 9999
Out-of-country format from US  011 61 2 9999 9999
Out-of-country format from CH  00 61 2 9999 9999 
```

libphonenumber 还为您提供了许多额外的好处，例如获取电话号码被检测到的位置，以及从电话号码中获取时区信息：

```
PhoneNumberOfflineGeocoder Results
Location        Australia

PhoneNumberToTimeZonesMapper Results
Time zone(s)    [Australia/Sydney] 
```

但是无效的澳大利亚电话号码 ( [`(09) 9999 9999`](https://libphonenumber.appspot.com/phonenumberparser?number=01161999999999&country=US&geocodingLocale=en-US)) 返回它不是有效的电话号码。

```
Validation Results

Result from isPossibleNumber()  true
Result from isValidNumber()     false 
```

Google 的版本有 Java 和 Javascript 的代码，但人们也为使用 Google i18n 电话号码数据集的其他语言实现了库：

*   **PHP**：[https ://github.com/giggsey/libphonenumber-for-php](https://github.com/giggsey/libphonenumber-for-php)
*   **蟒蛇**：[https ://github.com/daviddrysdale/python-phonenumbers](https://github.com/daviddrysdale/python-phonenumbers)
*   **红宝石**：[https ://github.com/sstephenson/global_phone](https://github.com/sstephenson/global_phone)
*   **C#**：[https ://github.com/twcclegg/libphonenumber-csharp](https://github.com/twcclegg/libphonenumber-csharp)
*   **目标-C**：[https ://github.com/iziz/libPhoneNumber-iOS](https://github.com/iziz/libPhoneNumber-iOS)
*   **JavaScript**：[https ://github.com/ruimarinho/google-libphonenumber](https://github.com/ruimarinho/google-libphonenumber)
*   **长生不老药**：[https ://github.com/socialpaymentsbv/ex_phone_number](https://github.com/socialpaymentsbv/ex_phone_number)

除非你确定你总是会接受来自一个语言环境的号码，并且它们总是采用一种格式，否则我强烈建议不要为此编写自己的代码，并使用 libphonenumber 来验证和显示电话号码。

* * *

## 回答 #5

> 赞同：85
> 
> 时间：2014-01-07T12:30:34.980

`/^(?:(?:\(?(?:00|\+)([1-4]\d\d|[1-9]\d+)\)?)[\-\.\ \\\/]?)?((?:\(?\d{1,}\)?[\-\.\ \\\/]?){0,})(?:[\-\.\ \\\/]?(?:#|ext\.?|extension|x)[\-\.\ \\\/]?(\d+))?$/i`

这匹配：

```
 - (+351) 282 43 50 50
 - 90191919908
 - 555-8909
 - 001 6867684
 - 001 6867684x1
 - 1 (234) 567-8901
 - 1-234-567-8901 x1234
 - 1-234-567-8901 ext1234
 - 1-234 567.89/01 ext.1234
 - 1(234)5678901x1234
 - (123)8575973
 - (0055)(123)8575973 
```

在 $n 上，它节省了：

1.  国家指标
2.  电话号码
3.  延期

您可以在[https://regex101.com/r/kFzb1s/1上对其进行测试](https://regex101.com/r/kFzb1s/1)

* * *

## 回答 #6

> 赞同：65
> 
> 时间：2008-09-23T21:58:26.647

尽管去除所有空格的答案很简洁，但它并没有真正解决提出的问题，即找到一个正则表达式。以我的测试脚本为例，它下载一个网页并使用正则表达式提取所有电话号码。由于无论如何您都需要一个正则表达式，所以您不妨让正则表达式完成所有工作。我想出了这个：

```
1?\W*([2-9][0-8][0-9])\W*([2-9][0-9]{2})\W*([0-9]{4})(\se?x?t?(\d*))? 
```

这是一个 perl 脚本来测试它。匹配时，$1 包含区号，$2 和 $3 包含电话号码，$5 包含分机号。我的测试脚本从 Internet 下载一个文件并打印其中的所有电话号码。

```
#!/usr/bin/perl

my $us_phone_regex =
        '1?\W*([2-9][0-8][0-9])\W*([2-9][0-9]{2})\W*([0-9]{4})(\se?x?t?(\d*))?';

my @tests =
(
"1-234-567-8901",
"1-234-567-8901 x1234",
"1-234-567-8901 ext1234",
"1 (234) 567-8901",
"1.234.567.8901",
"1/234/567/8901",
"12345678901",
"not a phone number"
);

foreach my $num (@tests)
{
        if( $num =~ m/$us_phone_regex/ )
        {
                print "match [$1-$2-$3]\n" if not defined $4;
                print "match [$1-$2-$3 $5]\n" if defined $4;
        }
        else
        {
                print "no match [$num]\n";
        }
}

#
# Extract all phone numbers from an arbitrary file.
#
my $external_filename =
        'http://web.textfiles.com/ezines/PHREAKSANDGEEKS/PnG-spring05.txt';
my @external_file = `curl $external_filename`;
foreach my $line (@external_file)
{
        if( $line =~ m/$us_phone_regex/ )
        {
                print "match $1 $2 $3\n";
        }
} 
```

**编辑：**

您可以在正则表达式中将 \W* 更改为 \s*\W?\s* 以将其收紧一点。当我编写它时，我并没有考虑到正则表达式，例如，验证用户在表单上的输入，但是这种变化使得可以将正则表达式用于该目的。

```
'1?\s*\W?\s*([2-9][0-8][0-9])\s*\W?\s*([2-9][0-9]{2})\s*\W?\s*([0-9]{4})(\se?x?t?(\d*))?'; 
```

* * *

## 回答 #7

> 赞同：54
> 
> 时间：2014-08-14T02:00:25.580

在决定将我的答案作为该线程的答案之前，我在另一个 SO 问题上回答了这个问题，因为没有人解决如何要求/不要求项目，只是分发正则表达式： [Regex working wrong, match unexpected things](https://stackoverflow.com/questions/25184823/regex-working-wrong-matching-unexpected-things/25298604#25298604)

从我在该网站上的帖子中，我创建了一个快速指南，以帮助任何人为自己想要的电话号码格式制作自己的正则表达式，我会警告（就像我在另一个网站上所做的那样），如果你限制太多，您可能不会得到想要的结果，并且没有“一刀切”的解决方案来接受世界上所有可能的电话号码 - 只有您决定接受的作为您选择的格式。使用风险自负。

## 快速备忘单

*   开始表达： `/^`
*   如果您需要空间，请使用： `[\s]`或`\s`
*   如果您需要括号，请使用: `[(]`和`[)]`. 使用`\(`and`\)`是丑陋的，并且会使事情变得混乱。
*   如果您希望任何内容是可选的，请在`?`其后添加
*   如果您想要连字符，只需键入`-`or `[-]`。但是，如果您没有将它放在一系列其他字符中的第一个或最后一个，则可能需要对其进行转义： `\-`
*   如果您想在插槽中接受不同的选择，请在选项周围加上括号：`[-.\s]`将需要连字符、句点或空格。最后一个括号后面的问号将使所有这些对于该插槽都是可选的。
*   `\d{3}`：需要 3 位数字：000-999。的简写 `[0-9][0-9][0-9]`。
*   `[2-9]`：该插槽需要一个数字 2-9。
*   `(\+|1\s)?`: 接受一个“加号”或一个 1 和一个空格（竖线字符，,`|`是“或”），并使其可选。“加号”必须被转义。
*   如果您希望特定数字与插槽匹配，请输入它们：`[246]`需要 2、4 或 6。 `(?:77|78)`或者`[77|78]`需要 77 或 78。
*   `$/`: 结束表达式

* * *

## 回答 #8

> 赞同：34
> 
> 时间：2010-02-04T09:52:21.650

我写得最简单（虽然我不需要点）。

```
^([0-9\(\)\/\+ \-]*)$
```

如下所述，它仅检查字符，而不检查其结构/顺序

* * *

## 回答 #9

> 赞同：23
> 
> 时间：2010-03-21T16:32:50.903

请注意，剥离`()`字符不适用于常见的英国号码书写方式：`+44 (0) 1234 567890`这意味着拨打国际号码：
`+441234567890`
或在英国拨打`01234567890`

* * *

## 回答 #10

> 赞同：22
> 
> 时间：2012-08-15T21:21:13.363

如果您只是想验证您在该字段中没有随机垃圾（即来自垃圾邮件发送者），则此正则表达式应该做得很好：

```
^[0-9+\(\)#\.\s\/ext-]+$ 
```

请注意，对于多少位数或这些数字中哪些数字有效，它没有任何特殊规则，它只是验证只有数字、括号、破折号、加号、空格、磅、星号、句点、逗号或字母`e`, `x`,`t`存在。

它应该与国际号码和本地化格式兼容。您是否预见到某些地区需要使用方括号、花括号或尖括号？（目前不包括在内）。

如果您想维护每个数字的规则（例如美国区号和前缀（交换代码）必须在 200-999 范围内），那么祝您好运。维护一套复杂的规则集，世界上任何国家都可能在未来的任何时候过时，这听起来并不有趣。

虽然剥离所有/大多数非数字字符可能在服务器端运行良好（特别是如果您计划将这些值传递给拨号器），但您可能不想在验证期间破坏用户的输入，特别是如果您希望他们这样做在另一个领域进行更正。

* * *

## 回答 #11

> 赞同：15
> 
> 时间：2008-09-23T20:19:52.610

你看过[RegExLib](http://regexlib.com/)吗？

输入美国电话号码带回了很多可能性。

* * *

## 回答 #12

> 赞同：15
> 
> 时间：2015-04-23T22:18:44.063

这是一个与我需要实现的验证最匹配的精彩模式。我不是原作者，但我认为这很值得分享，因为我发现这个问题非常复杂并且没有简明或广泛有用的答案。

以下正则表达式将捕获各种全球电话号码格式中广泛使用的数字和字符组合：

`/^\s*(?:\+?(\d{1,3}))?([-. (]*(\d{3})[-. )]*)?((\d{3})[-. ]*(\d{2,4})(?:[-.x ]*(\d+))?)\s*$/gm`

正：
42 555.123.4567
+ 1-（800）-123-4567
7 555 1234567
7（926）1234567
（926）1234567
79261234567
926 1234567
9261234567
1234567
123-4567
123-89-01
495 1234567
469 123 45 67
89261234567
8 (926) 1234567
926.123.4567
415-555-1234
650-555-2345
(416)555-3456
202 555 4567
4035555678
1 416 555 9292

负：
926 3 4
8 800 600-APPLE

原文来源：[http ://www.regexr.com/38pvb](http://www.regexr.com/38pvb)

* * *

## 回答 #13

> 赞同：14
> 
> 时间：2012-03-09T15:31:45.323

我对非限制性正则表达式的尝试：

```
/^[+#*\(\)\[\]]*([0-9][ ext+-pw#*\(\)\[\]]*){6,45}$/ 
```

接受：

```
+(01) 123 (456) 789 ext555
123456
*44 123-456-789 [321]
123456
123456789012345678901234567890123456789012345
*****++[](][((( 123456tteexxttppww 
```

拒绝：

```
mob 07777 777777
1234 567 890 after 5pm
john smith
(empty)
1234567890123456789012345678901234567890123456
911 
```

您可以对其进行消毒以进行展示。验证后它*可能*是一个数字。

* * *

## 回答 #14

> 赞同：12
> 
> 时间：2015-09-11T22:02:49.990

我发现这很好用：

```
^\(*\+*[1-9]{0,3}\)*-*[1-9]{0,3}[-. /]*\(*[2-9]\d{2}\)*[-. /]*\d{3}[-. /]*\d{4} *e*x*t*\.* *\d{0,4}$ 
```

它适用于以下数字格式：

```
1-234-567-8901
1-234-567-8901 x1234
1-234-567-8901 ext1234
1 (234) 567-8901
1.234.567.8901
1/234/567/8901
12345678901
1-234-567-8901 ext. 1234
(+351) 282 433 5050 
```

确保使用全局和多行标志来确保。

链接： [http ://www.regexr.com/3bp4b](http://www.regexr.com/3bp4b)

* * *

## 回答 #15

> 赞同：11
> 
> 时间：2008-09-23T20:14:20.080

这是我迄今为止最好的尝试。它处理上述格式，但我确定我错过了一些其他可能的格式。

```
^\d?(?:(?:[\+]?(?:[\d]{1,3}(?:[ ]+|[\-.])))?[(]?(?:[\d]{3})[\-/)]?(?:[ ]+)?)?(?:[a-zA-Z2-9][a-zA-Z0-9 \-.]{6,})(?:(?:[ ]+|[xX]|(i:ext[\.]?)){1,2}(?:[\d]{1,5}))?$ 
```

* * *

## 回答 #16

> 赞同：11
> 
> 时间：2009-04-10T12:21:10.007

如果您正在谈论表单验证，那么验证正确含义和正确数据的正则表达式将非常复杂，因为国家和提供商标准不同。也很难保持最新状态。

我将此问题解释为寻找一个广泛有效的模式，该模式可能在内部不一致 - 例如具有一组有效的数字，但未验证中继线、交换机等是否符合国家代码前缀的有效模式.

北美很简单，对于国际，我更喜欢使用“惯用”模式，它涵盖了人们指定和记住他们的数字的方式：

```
^((((\(\d{3}\))|(\d{3}-))\d{3}-\d{4})|(\+?\d{2}((-| )\d{1,8}){1,5}))(( x| ext)\d{1,5}){0,1}$ 
```

北美模式确保如果包含一个括号，则两者都是。国际帐户有一个可选的初始“+”和国家代码。在那之后，你在成语中。有效的匹配是：

*   `(xxx)xxx-xxxx`
*   `(xxx)-xxx-xxxx`
*   `(xxx)xxx-xxxx x123`
*   `12 1234 123 1 x1111`
*   `12 12 12 12 12`
*   `12 1 1234 123456 x12345`
*   `+12 1234 1234`
*   `+12 12 12 1234`
*   `+12 1234 5678`
*   `+12 12345678`

这可能是有偏见的，因为我的经验仅限于北美、欧洲和一小部分亚洲。

* * *

## 回答 #17

> 赞同：10
> 
> 时间：2011-04-14T20:56:45.190

对这个话题的大量回复强化了我的直觉——这个问题的解决方案几乎是无限的，但没有一个是优雅的。

老实说，我建议您不要尝试验证电话号码。即使你可以编写一个允许所有不同合法格式的大而多毛的验证器，它最终也会允许几乎任何东西，甚至首先是远程类似于电话号码的东西。

在我看来，最优雅的解决方案是验证最小长度，仅此而已。

* * *

## 回答 #18

> 赞同：10
> 
> 时间：2012-01-18T01:23:47.370

这是菲律宾手机号码的简单正则表达式模式：

```
((\+[0-9]{2})|0)[.\- ]?9[0-9]{2}[.\- ]?[0-9]{3}[.\- ]?[0-9]{4} 
```

或者

```
((\+63)|0)[.\- ]?9[0-9]{2}[.\- ]?[0-9]{3}[.\- ]?[0-9]{4} 
```

将匹配这些：

```
+63.917.123.4567  
+63-917-123-4567  
+63 917 123 4567  
+639171234567  
09171234567 
```

第一个将匹配任何两位数的国家代码，而第二个将专门匹配菲律宾国家代码。

在这里测试它：[http ://refiddle.com/1ox](http://refiddle.com/1ox)

* * *

## 回答 #19

> 赞同：9
> 
> 时间：2008-09-23T20:51:54.343

您将很难使用单个/简单的正则表达式处理国际号码，请参阅[这篇](https://stackoverflow.com/questions/41925/is-there-a-standard-for-storing-normalized-phone-numbers-in-a-database#41982)关于国际（甚至北美）电话号码困难的帖子。

您需要解析前几位数字以确定国家/地区代码，然后根据国家/地区采取不同的行动。

除此之外 - 您提供的列表不包括另一种常见的美国格式 - 省略最初的 1。美国的大多数手机不需要它，它会开始让年轻一代感到困惑，除非他们拨打了国际电话。

您已经正确地确定这是一个棘手的问题...

-亚当

* * *

## 回答 #20

> 赞同：8
> 
> 时间：2014-07-08T18:28:53.000

阅读完这些答案后，似乎没有一个简单的正则表达式可以解析一堆文本并提取任何格式的电话号码（包括带加号和不带加号的国际电话号码）。

这是我最近用于客户项目的内容，我们必须将任何格式的所有电话号码转换为电话：链接。

到目前为止，它一直在处理他们抛出的所有内容，但如果出现错误，我会更新这个答案。

正则表达式：

`/(\+*\d{1,})*([ |\(])*(\d{3})[^\d]*(\d{3})[^\d]*(\d{4})/`

用 tel: 链接替换所有电话号码的 PHP 函数（以防有人好奇）：

```
function phoneToTel($number) {
    $return = preg_replace('/(\+*\d{1,})*([ |\(])*(\d{3})[^\d]*(\d{3})[^\d]*(\d{4})/', '<a href="tel:$1$3$4$5">$1 ($3) $4-$5</a>', $number); // includes international
    return $return;
} 
```

* * *

## 回答 #21

> 赞同：6
> 
> 时间：2008-09-23T21:02:04.083

我相信[Number::Phone::US](http://search.cpan.org/~kennedyh/Number-Phone-US-1.5/)和[Regexp::Common](http://search.cpan.org/~abigail/Regexp-Common-2.122/) （尤其是[Regexp::Common::URI::RFC2806](http://search.cpan.org/~abigail/Regexp-Common-2.122/lib/Regexp/Common/URI/RFC2806.pm)的来源）Perl 模块可以提供帮助。

这个问题可能应该更详细地说明，以解释验证数字的目的。例如，911 在美国是一个有效的数字，但 911x 不适用于 x 的任何值。这样电话公司就可以在您完成拨号时进行计算。关于这个问题有几种变体。但是您的正则表达式不会检查区号部分，因此这似乎不是问题。

就像验证电子邮件地址一样，即使您有一个有效的结果，在您尝试之前您也无法知道它是否已分配给某人。

如果您正在尝试验证用户输入，为什么不规范化结果并完成它呢？如果用户输入了一个您无法识别为有效数字的数字，请将其保存为已输入的数字或去掉不可替换的字符。[Number::Phone::Normalize](http://search.cpan.org/~cfaerber/Number-Phone-Normalize-0.20/lib/Number/Phone/Normalize.pm) Perl 模块可能是灵感的来源。

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2008-09-23T20:41:56.927

我在一家市场研究公司工作，我们必须一直过滤这些类型的输入。你太复杂了。只需去掉非字母数字字符，看看是否有扩展名。

为了进一步分析，您可以订阅众多提供商之一，这些提供商可以让您访问有效号码的数据库，并告诉您它们是固定电话还是手机、断开连接等。这需要花钱。

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2009-07-21T12:03:56.513

对格式化字符进行替换，然后检查剩余的电话有效性。在 PHP 中，

```
 $replace = array( ' ', '-', '/', '(', ')', ',', '.' ); //etc; as needed
 preg_match( '/1?[0-9]{10}((ext|x)[0-9]{1,4})?/i', str_replace( $replace, '', $phone_num ); 
```

像这样打破复杂的正则表达式同样有效，但要简单得多。

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2009-07-21T11:47:37.793

我在同样的问题上苦苦挣扎，试图让我的应用程序面向未来，但这些人让我朝着正确的方向前进。我实际上并没有检查号码本身以查看它是否有效，我只是想确保输入了一系列可能有或没有扩展名的号码。

最坏的情况是，如果用户必须从 XML 文件中提取一个未格式化的号码，他们仍然只是将号码输入到手机的数字键盘`012345678x5`中，没有真正的理由让它保持美观。这种RegEx对我来说会是这样的：

```
\d+ ?\w{0,9} ?\d+ 
```

*   `01234467 extension 123456`
*   `01234567x123456`
*   `01234567890`

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2011-01-04T19:51:29.647

我发现这是一件很有趣的事情。我还没有测试它，但它看起来好像它会工作

```
<?php
/*
string validate_telephone_number (string $number, array $formats)
*/

function validate_telephone_number($number, $formats)
{
$format = trim(ereg_replace("[0-9]", "#", $number));

return (in_array($format, $formats)) ? true : false;
}

/* Usage Examples */

// List of possible formats: You can add new formats or modify the existing ones

$formats = array('###-###-####', '####-###-###',
                 '(###) ###-###', '####-####-####',
                 '##-###-####-####', '####-####', '###-###-###',
                 '#####-###-###', '##########');

$number = '08008-555-555';

if(validate_telephone_number($number, $formats))
{
echo $number.' is a valid phone number.';
}

echo "<br />";

$number = '123-555-555';

if(validate_telephone_number($number, $formats))
{
echo $number.' is a valid phone number.';
}

echo "<br />";

$number = '1800-1234-5678';

if(validate_telephone_number($number, $formats))
{
echo $number.' is a valid phone number.';
}

echo "<br />";

$number = '(800) 555-123';

if(validate_telephone_number($number, $formats))
{
echo $number.' is a valid phone number.';
}

echo "<br />";

$number = '1234567890';

if(validate_telephone_number($number, $formats))
{
echo $number.' is a valid phone number.';
}
?> 
```

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2011-08-11T05:10:29.657

为此，您可能会更好地使用 Masked Input。这样，用户只能输入数字，您可以按照您认为合适的方式进行格式化。我不确定这是否适用于 Web 应用程序，但如果是，则有一个非常点击的 jQuery 插件，它提供了一些选项来执行此操作。

[http://digitalbush.com/projects/masked-input-plugin/](http://digitalbush.com/projects/masked-input-plugin/)

他们甚至在他们的教程中讨论了如何屏蔽电话号码输入。

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2012-05-13T19:47:55.213

这是在 JavaScript 中运行良好的一个。它在一个字符串中，因为这是 Dojo 小部件所期望的。

它与可选扩展名的 10 位北美 NANP 号码匹配。空格、破折号和句点是可接受的分隔符。

```
"^(\\(?\\d\\d\\d\\)?)( |-|\\.)?\\d\\d\\d( |-|\\.)?\\d{4,4}(( |-|\\.)?[ext\\.]+ ?\\d+)?$" 
```

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2008-09-23T22:59:20.137

我倾向于同意剥离非数字并接受那里的东西是最好的。也许是为了确保至少有几个数字存在，尽管这确实禁止了诸如字母电话号码“ASK-JAKE”之类的东西。

几个简单的 perl 表达式可能是：

```
@f = /(\d+)/g;
tr/0-9//dc; 
```

使用第一个将数字组保持在一起，这可能会提供格式线索。使用第二个简单地折腾所有非数字。

是否担心可能需要暂停然后输入更多键？或者类似 555-1212（等待哔声）123 之类的东西？

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2011-02-28T23:16:18.930

```
 pattern="^[\d|\+|\(]+[\)|\d|\s|-]*[\d]$" 
    validateat="onsubmit" 
```

必须以数字结尾，可以以 ( 或 + 或数字开头，并且可以包含 + - ( 或 )

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2011-08-09T10:36:50.330

对于任何有兴趣使用爱尔兰手机号码做类似事情的人，这里有一个简单的方法来完成它：

[http://ilovenicii.com/?p=87](http://ilovenicii.com/?p=87)

PHP

* * *

```
<?php
$pattern = "/^(083|086|085|086|087)\d{7}$/";
$phone = "087343266";

if (preg_match($pattern,$phone)) echo "Match";
else echo "Not match"; 
```

该链接上还有一个 JQuery 解决方案。

编辑：

jQuery解决方案：

```
 $(function(){
    //original field values
    var field_values = {
            //id        :  value
            'url'       : 'url',
            'yourname'  : 'yourname',
            'email'     : 'email',
            'phone'     : 'phone'
    };

        var url =$("input#url").val();
        var yourname =$("input#yourname").val();
        var email =$("input#email").val();
        var phone =$("input#phone").val();

    //inputfocus
    $('input#url').inputfocus({ value: field_values['url'] });
    $('input#yourname').inputfocus({ value: field_values['yourname'] });
    $('input#email').inputfocus({ value: field_values['email'] }); 
    $('input#phone').inputfocus({ value: field_values['phone'] });

    //reset progress bar
    $('#progress').css('width','0');
    $('#progress_text').html('0% Complete');

    //first_step
    $('form').submit(function(){ return false; });
    $('#submit_first').click(function(){
        //remove classes
        $('#first_step input').removeClass('error').removeClass('valid');

        //ckeck if inputs aren't empty
        var fields = $('#first_step input[type=text]');
        var error = 0;
        fields.each(function(){
            var value = $(this).val();
            if( value.length<12 || value==field_values[$(this).attr('id')] ) {
                $(this).addClass('error');
                $(this).effect("shake", { times:3 }, 50);

                error++;
            } else {
                $(this).addClass('valid');
            }
        });        

        if(!error) {
            if( $('#password').val() != $('#cpassword').val() ) {
                    $('#first_step input[type=password]').each(function(){
                        $(this).removeClass('valid').addClass('error');
                        $(this).effect("shake", { times:3 }, 50);
                    });

                    return false;
            } else {   
                //update progress bar
                $('#progress_text').html('33% Complete');
                $('#progress').css('width','113px');

                //slide steps
                $('#first_step').slideUp();
                $('#second_step').slideDown();     
            }               
        } else return false;
    });

    //second section
    $('#submit_second').click(function(){
        //remove classes
        $('#second_step input').removeClass('error').removeClass('valid');

        var emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;  
        var fields = $('#second_step input[type=text]');
        var error = 0;
        fields.each(function(){
            var value = $(this).val();
            if( value.length<1 || value==field_values[$(this).attr('id')] || ( $(this).attr('id')=='email' && !emailPattern.test(value) ) ) {
                $(this).addClass('error');
                $(this).effect("shake", { times:3 }, 50);

                error++;
            } else {
                $(this).addClass('valid');
            }

        function validatePhone(phone) {
        var a = document.getElementById(phone).value;
        var filter = /^[0-9-+]+$/;
            if (filter.test(a)) {
                return true;
            }
            else {
                return false;
            }
        }

        $('#phone').blur(function(e) {
            if (validatePhone('txtPhone')) {
                $('#spnPhoneStatus').html('Valid');
                $('#spnPhoneStatus').css('color', 'green');
            }
            else {
                $('#spnPhoneStatus').html('Invalid');
            $('#spnPhoneStatus').css('color', 'red');
            }
        });

     });

        if(!error) {
                //update progress bar
                $('#progress_text').html('66% Complete');
                $('#progress').css('width','226px');

                //slide steps
                $('#second_step').slideUp();
                $('#fourth_step').slideDown();     
        } else return false;

    });

    $('#submit_second').click(function(){
        //update progress bar
        $('#progress_text').html('100% Complete');
        $('#progress').css('width','339px');

        //prepare the fourth step
        var fields = new Array(
            $('#url').val(),
            $('#yourname').val(),
            $('#email').val(),
            $('#phone').val()

        );
        var tr = $('#fourth_step tr');
        tr.each(function(){
            //alert( fields[$(this).index()] )
            $(this).children('td:nth-child(2)').html(fields[$(this).index()]);
        });

        //slide steps
        $('#third_step').slideUp();
        $('#fourth_step').slideDown();            
    });

    $('#submit_fourth').click(function(){

        url =$("input#url").val();
        yourname =$("input#yourname").val();
        email =$("input#email").val();
        phone =$("input#phone").val();

        //send information to server
        var dataString = 'url='+ url + '&yourname=' + yourname + '&email=' + email + '&phone=' + phone;  

        alert (dataString);//return false;  
            $.ajax({  
                type: "POST",  
                url: "http://clients.socialnetworkingsolutions.com/infobox/contact/",  
                data: "url="+url+"&yourname="+yourname+"&email="+email+'&phone=' + phone,
                cache: false,
                success: function(data) {  
                    console.log("form submitted");
                    alert("success");
                }
                });  
        return false;

   });

    //back button
    $('.back').click(function(){
        var container = $(this).parent('div'),
        previous  = container.prev();

        switch(previous.attr('id')) {
            case 'first_step' : $('#progress_text').html('0% Complete');
                  $('#progress').css('width','0px');
                       break;
            case 'second_step': $('#progress_text').html('33% Complete');
                  $('#progress').css('width','113px');
                       break;

            case 'third_step' : $('#progress_text').html('66% Complete');
                  $('#progress').css('width','226px');
                       break;

        default: break;
    }

    $(container).slideUp();
    $(previous).slideDown();
});

}); 
```

[来源](http://www.codeitive.com/0QNggPXPgW/international-and-irish-phone-number-form-validation-using-jquery.html)。

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2012-08-24T15:52:17.663

我不建议为此使用正则表达式。

像上面的答案一样，从电话号码中去掉所有丑陋的东西，这样你就剩下一串数字字符，`'x'`如果提供了扩展名，则带有 , 。

在 Python 中：

注意：`BAD_AREA_CODES`来自您可以从网络上获取的[文本文件。](http://pastebin.com/gaGuTefg)

```
BAD_AREA_CODES = open('badareacodes.txt', 'r').read().split('\n')

def is_valid_phone(phone_number, country_code='US'):
    """for now, only US codes are handled"""
    if country_code:
        country_code = country_code.upper()

    #drop everything except 0-9 and 'x'
    phone_number = filter(lambda n: n.isdigit() or n == 'x', phone_number)

    ext = None
    check_ext = phone_number.split('x')
    if len(check_ext) > 1:
        #there's an extension. Check for errors.
        if len(check_ext) > 2:
            return False
        phone_number, ext = check_ext

    #we only accept 10 digit phone numbers.
    if len(phone_number) == 11 and phone_number[0] == '1':
        #international code
        phone_number = phone_number[1:]
    if len(phone_number) != 10:
        return False

    #area_code: XXXxxxxxxx 
    #head:      xxxXXXxxxx
    #tail:      xxxxxxXXXX
    area_code = phone_number[ :3]
    head      = phone_number[3:6]
    tail      = phone_number[6: ]

    if area_code in BAD_AREA_CODES:
        return False
    if head[0] == '1':
        return False
    if head[1:] == '11':
        return False

    #any other ideas?
    return True 
```

这涵盖了相当多的内容。它不是正则表达式，但它确实很容易映射到其他语言。

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2014-04-19T21:14:19.583

土耳其的工作示例，只需更改

```
d{9} 
```

根据您的需要并开始使用它。

```
function validateMobile($phone)
{
    $pattern = "/^(05)\d{9}$/";
    if (!preg_match($pattern, $phone))
    {
        return false;
    }
    return true;
}

$phone = "0532486061";

if(!validateMobile($phone))
{
    echo 'Incorrect Mobile Number!';
}

$phone = "05324860614";
if(validateMobile($phone))
{
    echo 'Correct Mobile Number!';
} 
```

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2015-10-03T07:50:04.337

使用简单的正则表达式处理各种国际电话号码几乎是不可能的。

你最好使用像**[numverify.com](https://numverify.com)**这样的服务，他们提供免费的 JSON API 用于国际电话号码验证，而且你会在每个请求中获得一些关于国家、位置、运营商和线路类型的有用详细信息。

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2017-02-02T12:41:57.377

寻找`String regex = "^\\+(?:[0-9] ?){6,14}[0-9]$";`

对国际号码很有帮助。

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2018-04-17T21:08:10.993

由于这篇文章没有语言标签，我将给出一个`regex`在 python 中使用的解决方案。

表达式本身：

```
1[\s./-]?\(?[\d]+\)?[\s./-]?[\d]+[-/.]?[\d]+\s?[\d]+ 
```

在 python 中使用时：

```
import re

phonelist ="1-234-567-8901,1-234-567-8901 1234,1-234-567-8901 1234,1 (234) 567-8901,1.234.567.8901,1/234/567/8901,12345678901"

phonenumber = '\n'.join([phone for phone in re.findall(r'1[\s./-]?\(?[\d]+\)?[\s./-]?[\d]+[-/.]?[\d]+\s?[\d]+' ,phonelist)])
print(phonenumber) 
```

输出：

```
1-234-567-8901
1-234-567-8901 1234
1-234-567-8901 1234
1 (234) 567-8901
1.234.567.8901
1/234/567/8901
12345678901 
```

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2021-02-16T23:38:11.203

虽然它不是正则表达式，但您可以使用[`validate_phone()`](https://sfu-db.github.io/dataprep/user_guide/clean/clean_phone.html)Python 库[DataPrep](https://dataprep.ai/)中的函数来验证美国电话号码。安装它`pip install dataprep`。

```
>>> from dataprep.clean import validate_phone
>>> df = pd.DataFrame({'phone': ['1-234-567-8901', '1-234-567-8901 x1234', 
         '1-234-567-8901 ext1234', '1 (234) 567-8901', '1.234.567.8901',
         '1/234/567/8901', 12345678901, '12345678', '123-456-78987']})
>>> validate_phone(df['phone'])
0     True
1     True
2     True
3     True
4     True
5     True
6     True
7    False
8    False
Name: phone, dtype: bool 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2008-09-23T20:47:07.567

如果可能的话，我建议使用四个单独的字段——区号、3 位前缀、4 位部分、分机号——以便用户可以分别输入地址的每个部分，并且您可以单独验证每个部分。这样，您不仅可以更轻松地进行验证，还可以将电话号码以更一致的格式存储在数据库中。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2018-03-12T08:52:58.237

**注意**它将任何格式的美国手机号码作为输入，并且可以选择接受第二个参数 - 如果您希望输出手机号码的格式看起来很漂亮，请设置为 true。如果提供的号码不是手机号码，则简单返回 false。如果检测到手机号码，它会返回整个已清理的号码，而不是 true。

```
 function isValidMobile(num,format) {
        if (!format) format=false
        var m1 = /^(\W|^)[(]{0,1}\d{3}[)]{0,1}[.]{0,1}[\s-]{0,1}\d{3}[\s-]{0,1}[\s.]{0,1}\d{4}(\W|$)/
        if(!m1.test(num)) {
           return false
        }
        num = num.replace(/ /g,'').replace(/\./g,'').replace(/-/g,'').replace(/\(/g,'').replace(/\)/g,'').replace(/\[/g,'').replace(/\]/g,'').replace(/\+/g,'').replace(/\~/g,'').replace(/\{/g,'').replace(/\*/g,'').replace(/\}/g,'')
        if ((num.length < 10) || (num.length > 11) || (num.substring(0,1)=='0') || (num.substring(1,1)=='0') || ((num.length==10)&&(num.substring(0,1)=='1'))||((num.length==11)&&(num.substring(0,1)!='1'))) return false;
        num = (num.length == 11) ? num : ('1' + num);   
        if ((num.length == 11) && (num.substring(0,1) == "1")) {
            if (format===true) {
               return '(' + num.substr(1,3) + ') ' + num.substr(4,3) + '-' + num.substr(7,4)
            } else {
               return num
            }
        } else {
            return false;
        }
    } 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2018-03-20T06:46:26.620

试试这个（这是用于印度手机号码验证）：

```
if (!phoneNumber.matches("^[6-9]\\d{9}$")) {
  return false;
} else {
  return true;
} 
```

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2020-09-07T05:41:43.913

**Java 为有效的电话号码生成正则表达式**

另一种选择是让 Java 生成一个 REGEX，它可以对从列表中读取的电话号码的所有变体进行处理。这意味着在代码上下文中看到的名为 validPhoneNumbersFormat 的列表正在决定哪种电话号码格式是有效的。

**注意：这种类型的算法适用于任何处理正则表达式的语言。**

**生成正则表达式的代码片段：**

```
Set<String> regexSet = uniqueValidPhoneNumbersFormats.stream()
        .map(s -> s.replaceAll("\\+", "\\\\+"))
        .map(s -> s.replaceAll("\\d", "\\\\d"))
        .map(s -> s.replaceAll("\\.", "\\\\."))
        .map(s -> s.replaceAll("([\\(\\)])", "\\\\$1"))
        .collect(Collectors.toSet());

String regex = String.join("|", regexSet); 
```

**上下文中的代码片段：**

```
public class TestBench {

    public static void main(String[] args) {
        List<String> validPhoneNumbersFormat = Arrays.asList(
                "1-234-567-8901",
                "1-234-567-8901 x1234",
                "1-234-567-8901 ext1234",
                "1 (234) 567-8901",
                "1.234.567.8901",
                "1/234/567/8901",
                "12345678901",
                "+12345678901",
                "(234) 567-8901 ext. 123",
                "+1 234-567-8901 ext. 123",
                "1 (234) 567-8901 ext. 123",
                "00 1 234-567-8901 ext. 123",
                "+210-998-234-01234",
                "210-998-234-01234",
                "+21099823401234",
                "+210-(998)-(234)-(01234)",
                "(+351) 282 43 50 50",
                "90191919908",
                "555-8909",
                "001 6867684",
                "001 6867684x1",
                "1 (234) 567-8901",
                "1-234-567-8901 x1234",
                "1-234-567-8901 ext1234",
                "1-234 567.89/01 ext.1234",
                "1(234)5678901x1234",
                "(123)8575973",
                "(0055)(123)8575973"
        );

        Set<String> uniqueValidPhoneNumbersFormats = new LinkedHashSet<>(validPhoneNumbersFormat);

        List<String> invalidPhoneNumbers = Arrays.asList(
                "+210-99A-234-01234",       // FAIL
                "+210-999-234-0\"\"234",    // FAIL
                "+210-999-234-02;4",        // FAIL
                "-210+998-234-01234",       // FAIL
                "+210-998)-(234-(01234"     // FAIL
        );
        List<String> invalidAndValidPhoneNumbers = new ArrayList<>();
        invalidAndValidPhoneNumbers.addAll(invalidPhoneNumbers);
        invalidAndValidPhoneNumbers.addAll(uniqueValidPhoneNumbersFormats);

        Set<String> regexSet = uniqueValidPhoneNumbersFormats.stream()
                .map(s -> s.replaceAll("\\+", "\\\\+"))
                .map(s -> s.replaceAll("\\d", "\\\\d"))
                .map(s -> s.replaceAll("\\.", "\\\\."))
                .map(s -> s.replaceAll("([\\(\\)])", "\\\\$1"))
                .collect(Collectors.toSet());

        String regex = String.join("|", regexSet);

        List<String> result = new ArrayList<>();
        Pattern pattern = Pattern.compile(regex);
        for (String phoneNumber : invalidAndValidPhoneNumbers) {
            Matcher matcher = pattern.matcher(phoneNumber);
            if(matcher.matches()) {
                result.add(matcher.group());
            }
        }

        // Output:
        if(uniqueValidPhoneNumbersFormats.size() == result.size()) {
            System.out.println("All valid numbers was matched!\n");
        }    
        result.forEach(System.out::println); 
    }

} 
```

**输出：**

```
All valid numbers was matched!

1-234-567-8901
1-234-567-8901 x1234
1-234-567-8901 ext1234
...
...
... 
```

* * *

## 回答 #41

> 赞同：-1
> 
> 时间：2020-08-11T08:08:08.033

由于编写电话号码有很多选择，因此无论它们如何分开，都可以测试其中是否有足够的数字。我发现 9 到 14 位数字对我有用：

```
^\D*(\d\D*){9,14}$ 
```

真的：

*   123456789
*   1234567890123
*   +123 (456) 78.90-98.76

错误的：

*   123
*   (1234) 1234
*   9007199254740991
*   123不会照你说的做
*   +123 (456) 78.90-98.76 #543 分机 210>2>5>3
*   (123) 456-7890 上午 (987) 54-3210 18:00 后找雪莉

如果您**确实想**支持最后两个示例 - 只需删除上限：

```
(\d\D*){9,} 
```

（`^$`如果没有上限，则不需要）

* * *

## 回答 #42

> 赞同：-5
> 
> 时间：2015-06-30T05:31:25.953

```
/\b(\d{3}[^\d]{0,2}\d{3}[^\d]{0,2}\d{4})\b/ 
```

# java - 如何获取 PC 主板的温度（和其他硬件统计信息）？

> ID：123575
> 
> 赞同：5
> 
> 时间：2008-09-23T20:15:35.787
> 
> 标签：java, statistics, hardware, temperature

有谁知道如何获取当前主板、处理器或高清温度统计数据？
在 GNU/Linux 中，我知道我可以使用 hddtemp 或 sensord 之类的东西来获取信息，然后解析它……但在 Windows 中：我该怎么做？而且，可以使用 C# 或 Java 或任何其他高级编程语言来完成吗？
谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T20:21:21.857

我会争辩说，当正确的配置到位时，它可以优于 Windows 的配置。

[http://www.lm-sensors.org/](http://www.lm-sensors.org/)完成所有工作。我把它连接到 RRDgraph & Munin，我在将近一年的时间里监测我房间的温度，并得到了漂亮的图表。还显示我的 CPU 风扇正在慢慢磨损，我可以看到线长时间倾斜并知道它正在退出。

[http://www.lm-sensors.org/browser/lm-sensors/trunk/doc/developers/applications](http://www.lm-sensors.org/browser/lm-sensors/trunk/doc/developers/applications)是你想要的。

（哦，等等，我失败了。你在 *nix 上想在 Windows 上做，我的错 :( ..um.. 好吧。祝你好运。也许我会把这个留在这里，以防有人在搜索时找到你的帖子相反的）

回到我使用 windows 的时候，我记得的只有 Ye' Old [Motherboard Monitor (Discontinued)](http://en.wikipedia.org/wiki/Motherboard_Monitor)。维基文章说有[speedfan](http://en.wikipedia.org/wiki/SpeedFan)，这看起来是你最好的选择。以编程方式，我想您必须找到硬件规格并挖掘 Windows API 和任意总线地址偏移的堆栈加载。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T09:52:28.007

正如@AndrewJFord 建议的那样，这些方法因供应商而异，实际上因部分而异，但如果可以的话，我会做一些概括。

1.  据我所知，英特尔、AMD 和 IBM 目前的所有主流处理器都有板载热传感器，带有已知的暴露 API，用于读取这些数据。我不是这些 API 的专家，所以不知道它们有多相似，但如果 Intel 和 AMD 的 API 有那么大的不同，我会感到惊讶。如果我是你，我会搜索一个开源的“系统管理工具”（顺便说一下，有一些像这样写成 Apple Widgets）并看看他们是如何做到的。
2.  主板差异很大，有些具有广泛的热传感器，有些没有，并且所有的 API 都将具有相当不同的 API。我会首先联系公司的支持人员，他们让您选择主板。
3.  总的来说，我相信只有非常高端的 15krpm SAS 磁盘具有内置热传感器，我知道一些中档系统在集线器的外壳上安装了传感器并将其报告给主板。真的不知道如何获得这些信息，但我再次与上述问题相同的人交谈。

现在我是 HP 的大用户，他们的所有工具包都由称为*Insight Management Agents*的工具进行检测，其中有适用于 Windows 和大多数 Linux 的版本。他们所做的是从所有传感器（proc、内存、主板、风扇、磁盘等）收集所有系统信息，并通过基于 SNMP 的轮询 API 或基于警报的 SNMP/SMTP/MAPI 接口公开这些信息。我敢说 IBM/Dell 等将有自己的同样优秀且功能相似的版本，但我不知道他们很抱歉。如果您的机器是“非品牌”/套件制造或您无法控制，那么我不知道有任何单一方法可以轻松获取所有这些信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T20:10:58.960

温度和其他监控传感器的问题在于硬件级别没有通用协议，也没有允许使用通用 API 检索该信息的驱动程序。

像已经提到的 SpeedFan 和[HWMonitor](http://www.cpuid.com/hwmonitor.php)（来自 CPU-Z 实用程序的制造商）这样的软件通过煞费苦心地对各种传感器和总线控制器进行分类，并实施相应的协议来工作，通常使用内核模式驱动程序来访问 SMBus 设备。

要将此功能嵌入到您自己的软件中，您可以自己开发此功能（可能通过针对您的特定硬件进行定制来减少工作量，并使用来自 www.lm-sensors.org 的 linux 代码作为参考）或购买商业库实现它。一个由 HWMonitor 使用，可[在此处](http://www.cpuid-pro.com/products-system-monitoring-kit.php)获得。

祝你好运

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T20:27:11.720

根据您的硬件，这会有所不同。从硬件供应商处确定主板上是否有传感器后，您可能会考虑使用 SNMP 和 HOST-RESOURCE MIB。

使用管理和监控工具下的添加/删除 Windows 组件向导来安装 SNMP。然后，您应该能够使用标准系统管理软件（如 OpenView 或 Nagios）向您的 Windows 机器询问大量信息。

# windows - WebResource.axd 在使用 IIS7 的 ASP.Net 回传中给出 403 错误

> ID：123585
> 
> 赞同：3
> 
> 时间：2008-09-23T20:16:42.493
> 
> 标签：windows, iis-7, windows-server-2008, webresource.axd

我在 Windows 2008 服务器上安装了一个 ASP.Net 网站，默认情况下使用 IIS7。该网站似乎工作正常，但我的表格上的回帖不起作用。经过几个小时的调试，我意识到当我手动尝试在浏览器中点击 WebResource.axd 文件时（例如，我在地址栏中输入[http://www.domain.com/WebResource.axd](http://www.domain.com/WebResource.axd) ），我得到了一个HTTP 403 错误（拒绝访问）。

我不太确定下一步该往哪里看，而且我的 Windows 2008 安全知识有限。我该如何去访问该文件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2020-08-30T11:48:59.980

如果您正在使用 plesk 面板或 Web 应用程序防火墙 (ModSecurity) 处于活动状态，请禁用“OWASP_CRS / LEAKAGE / ERRORS_IIS”和“OWASP_CRS / POLICY / EXT_RESTRICTED”安全规则。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-01T19:01:36.770

导航到您的 iis 配置文件夹。通常：c:\windows\system32\inetsrv\config 并打开 applicationHost.config 文件。然后在文件中导航到该`<handlers>`部分并检查是否存在以下行：

```
<add name="AssemblyResourceLoader-Integrated" path="WebResource.axd" verb="GET,DEBUG" type="System.Web.Handlers.AssemblyResourceLoader" preCondition="integratedMode" /> 
```

也就是说，如果您在集成模式下运行。检查是否指定了动词 GET。

如果您在经典管道模式下运行，则该行应该存在

```
<add name="AXD-ISAPI-2.0" path="*.axd" verb="GET,HEAD,POST,DEBUG" modules="IsapiModule" scriptProcessor="%windir%\Microsoft.NET\Framework\v2.0.50727\aspnet_isapi.dll" preCondition="classicMode,runtimeVersionv2.0,bitness32" responseBufferLimit="0" /> 
```

如果一切似乎都还可以，请查看 Handlers and Modules 部分中的 web.config 并查看是否已`<clear />`在每个顶部添加。如果你这样做了，那么你在 web.config 文件中包含**add**部分，尊重 applicationHosting.config 文件中指定的处理程序/模块的顺序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T21:33:11.763

不确定那个，但它可能与 IIS 中的 http 压缩有关。还要检查 IIS 用户是否可以访问该文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T20:45:44.793

检查您的 IIS 日志 - 它们应该提供包含有关错误的更详细信息的状态代码。另外，回发错误的性质是什么？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T21:07:34.697

这是我在回发时遇到的错误：

WebForm_PostBackOptions 未定义。

据我所知，该函数包含在 WebResource.axd 文件中，这导致我在地址栏中尝试它，我如何知道 403 错误...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-03-06T16:47:14.180

防火墙设置有问题。请求在防火墙中被阻止。联系服务器管理员更改配置。我们得到了解决方案。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-11-02T07:09:44.777

对于拥有 Plesk 控制面板的托管公司，您可以关闭 Web 应用程序防火墙 (WAF)，但由于 WAF 的目的是帮助保护您的网站免受各种攻击，您应该只停用导致问题的特定规则 ID。就我而言，我需要在我的网站上允许 .axd 文件（例如，Scriptresource.axd 和 WebResource.axd）。

1.  通过打开 Plesk WAF 页面上的“ModSecurity 日志文件”来识别违反的特定规则 ID。

2.  在日志文件中搜索 403 Access Denied 消息，然后查找类似`[id "942440"]`. 这是被违反的规则 ID。

3.  通过在 Plesk WAF 页面的“关闭安全规则”部分中键入 ID 号，关闭适用于此问题的“安全规则”。在本例中，您只需在文本框中键入数字“920440”。

[![在此处输入图像描述](https://i.stack.imgur.com/ItGOE.png)](https://i.stack.imgur.com/ItGOE.png)

# java - 使用带有 JSTL 的 EL 访问枚举值

> ID：123598
> 
> 赞同：107
> 
> 时间：2008-09-23T20:18:25.687
> 
> 标签：java, jsp, jakarta-ee, jstl

我有一个名为 Status 的枚举，定义如下：

```
public enum Status { 

    VALID("valid"), OLD("old");

    private final String val;

    Status(String val) {
        this.val = val;
    }

    public String getStatus() {
        return val;
    }

} 
```

我想`VALID`从 JSTL 标记中访问 的值。特别是标签的`test`属性。`<c:when>`例如

```
<c:when test="${dp.status eq Status.VALID"> 
```

我不确定这是否可能。

* * *

## 回答 #1

> 赞同：115
> 
> 时间：2008-12-15T14:27:13.493

与字符串的简单比较有效：

```
<c:when test="${someModel.status == 'OLD'}"> 
```

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2011-05-02T09:57:08.953

如果使用 Spring MVC，Spring 表达式语言 (SpEL) 可能会有所帮助：

```
<spring:eval expression="dp.status == T(com.example.Status).VALID" var="isValid" />
<c:if test="${isValid}">
   isValid
</c:if> 
```

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2013-05-22T13:16:45.970

您在这里有 3 个选择，但没有一个是完美的：

1.  `test`您可以在属性中使用 scriptlet ：

    `<c:when test="<%= dp.getStatus() == Status.VALID %>">`

    这使用了枚举，但也使用了 scriptlet，这在 JSP 2.0 中不是“正确的方式”。`when`但最重要的是，当您想将另一个条件添加到相同的using时，这不起作用`${}`。这意味着您要测试的所有变量都必须在脚本中声明，或者保留在请求或会话中（`pageContext`变量在文件中不可用`.tag`）。

2.  您可以与字符串进行比较：

    `<c:when test="${dp.status == 'VALID'}">`

    这看起来很干净，但是您正在引入一个重复枚举值且无法由编译器验证的字符串。因此，如果您从枚举中删除该值或重命名它，您将不会看到这部分代码不再可访问。您基本上每次都必须通过代码进行搜索/替换。

3.  您可以将您使用的每个枚举值添加到页面上下文中：

    `<c:set var="VALID" value="<%=Status.VALID%>"/>`

    然后你可以这样做：

    `<c:when test="${dp.status == VALID}">`

我更喜欢最后一个选项 (3)，尽管它也使用了 scriptlet。这是因为它仅在您设置值时使用它。稍后您可以将它与其他 EL 条件一起用于更复杂的 EL 表达式。在选项 (1) 中，您不能在`test`单个`when`标记的属性中使用 scriptlet 和 EL 表达式。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2008-09-24T21:09:33.823

因此，要完全解决我的问题，我需要执行以下操作：

```
<% pageContext.setAttribute("old", Status.OLD); %> 
```

然后我能够做到：

```
<c:when test="${someModel.status == old}"/>...</c:when> 
```

按预期工作。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2017-07-07T08:46:05.970

这里还有两种可能性：

# JSP EL 3.0 常量

只要您至少使用 3.0 版的 EL，您就可以将常量导入您的页面，如下所示：

```
<%@ page import="org.example.Status" %>
<c:when test="${dp.status eq Status.VALID}"> 
```

但是，一些 IDE 还不理解这一点（例如[IntelliJ](https://youtrack.jetbrains.com/issue/IDEA-138230)），因此如果您打错字，直到运行时才会收到任何警告。

一旦获得适当的 IDE 支持，这将是我的首选方法。

# 辅助方法

您可以将吸气剂添加到您的枚举中。

```
public enum Status { 
  VALID("valid"), OLD("old");

  private final String val;

  Status(String val) {
    this.val = val;
  }

  public String getStatus() {
    return val;
  }

  public boolean isValid() {
    return this == VALID;
  }

  public boolean isOld() {
    return this == OLD;
  }
} 
```

然后在您的 JSP 中：

```
<c:when test="${dp.status.valid}"> 
```

这在所有 IDE 中都受支持，如果您还不能使用 EL 3.0，也可以使用。这就是我目前所做的，因为它将所有逻辑都包含在我的枚举中。

如果存储枚举的变量可能为空，也要小心。如果您的代码不能保证它不为空，您需要先检查它：

```
<c:when test="${not empty db.status and dp.status.valid}"> 
```

我认为这种方法优于在 JSP 中设置中间值的方法，因为您必须在需要使用枚举的每个页面上执行此操作。但是，使用此解决方案，您只需声明一次 getter。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-07-10T15:32:56.250

为此，我执行以下操作：

```
<c:set var="abc">
    <%=Status.OLD.getStatus()%>
</c:set>

<c:if test="${someVariable == abc}">
    ....
</c:if> 
```

它看起来很丑，但有效！

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-03-17T15:24:54.760

我对 Kornel 的问题没有答案，但我对其他脚本示例有意见。大多数表达式都隐含地信任`toString()`，但`Enum.valueOf()`期望来自/匹配该`Enum.name()`属性的值。所以应该使用例如：

```
<% pageContext.setAttribute("Status_OLD", Status.OLD.name()); %>
...
<c:when test="${someModel.status == Status_OLD}"/>...</c:when> 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-12-15T01:34:48.897

向枚举添加一个方法，例如：

```
public String getString() {
    return this.name();
} 
```

例如

```
public enum MyEnum {
    VALUE_1,
    VALUE_2;
    public String getString() {
        return this.name();
    }
} 
```

然后你可以使用：

```
<c:if test="${myObject.myEnumProperty.string eq 'VALUE_2'}">...</c:if> 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-07-10T16:21:41.293

使用 MVC 框架时，我将以下内容放入我的控制器中。

```
request.setAttribute(RequestParameterNamesEnum.INBOX_ACTION.name(), RequestParameterNamesEnum.INBOX_ACTION.name()); 
```

这允许我在我的 JSP 页面中使用以下内容。

```
<script> var url = 'http://www.nowhere.com/?${INBOX_ACTION}=' + someValue;</script> 
```

它也可以用于您的比较

```
<c:when test="${someModel.action == INBOX_ACTION}"> 
```

我更喜欢放入字符串文字。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-06-08T12:07:41.073

```
<%@ page import="com.example.Status" %>

1\. ${dp.status eq Title.VALID.getStatus()}
2\. ${dp.status eq Title.VALID}
3\. ${dp.status eq Title.VALID.toString()} 
```

*   将导入放在**顶部**，在 JSP 页面标题中
*   如果您想使用**getStatus 方法**，请使用**#1**
*   如果要使用**枚举元素**本身，请使用**#2 或 #3**
*   您可以使用**==**代替**eq**

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-11-24T02:17:58.367

我通常认为将 java 代码混合到 jsps/tag 文件中是不好的做法。使用 'eq' 应该可以解决问题：

```
<c:if test="${dp.Status eq 'OLD'}">
  ...
</c:if> 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2018-11-12T11:23:33.720

当有很多点可以使用时，我会这样做......

```
public enum Status { 

    VALID("valid"), OLD("old");

    private final String val;

    Status(String val) {
        this.val = val;
    }

    public String getStatus() {
        return val;
    }

    public static void setRequestAttributes(HttpServletRequest request) {
        Map<String,String> vals = new HashMap<String,String>();
        for (Status val : Status.values()) {
            vals.put(val.name(), val.value);
        }
        request.setAttribute("Status", vals);
    }

} 
```

JSP

```
<%@ page import="...Status" %>
<% Status.setRequestAttributes(request) %>

<c:when test="${dp.status eq Status.VALID}">
... 
```

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2016-06-15T19:51:27.440

**在 Java 类中：**

```
 public class EnumTest{
    //Other property link
    private String name;
    ....

        public enum Status {
                ACTIVE,NEWLINK, BROADCASTED, PENDING, CLICKED, VERIFIED, AWARDED, INACTIVE, EXPIRED, DELETED_BY_ADMIN;
            }

        private Status statusobj ;

    //Getter and Setters
} 
```

所以现在 POJO 和 enum obj 被创建了。现在**EnumTest**您将在 servlet 或控制器类 session.setAttribute("enumTest", EnumTest ); 中设置会话对象。

**在 JSP 页面中**

```
<c:if test="${enumTest.statusobj == 'ACTIVE'}">

//TRUE??? THEN PROCESS SOME LOGIC 
```

# asp.net - 如何使用集合属性构建 ASP.NET 自定义控件？

> ID：123616
> 
> 赞同：12
> 
> 时间：2008-09-23T20:22:06.163
> 
> 标签：asp.net, custom-server-controls

我想做类似的事情

```
<cstm:MyControl runat="server">
    <myItem attr="something" />
    <myItem attr="something" />
</cstm:MyControl> 
```

实现这一目标所需的基本代码是什么？

里克的例子显示了类似于

```
<cstm:MyControl runat="server">
    <myItems>
        <cstm:myItem attr="something" />
        <cstm:myItem attr="something" />
    </myItems>
</cstm:MyControl> 
```

如果可能的话，我更喜欢更简洁的语法。

*注意：请随意提出更好的标题或描述。即使您没有编辑权限，我也很高兴为社区着想编辑条目。*

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-23T21:03:06.547

这是一个非常简单的示例控件，它完全符合您的要求：

```
namespace TestControl
{
    [ParseChildren(true, DefaultProperty = "Names")]
    public class MyControl : Control
    {
        public MyControl()
        {
            this.Names = new List<PersonName>();
        }

        [PersistenceMode(PersistenceMode.InnerDefaultProperty)]
        public List<PersonName> Names { get; set; }
    }

    public class PersonName
    {
        public string Name { get; set; }
    }
} 
```

而且，这是一个示例用法：

```
<%@ Register Namespace="TestControl" TagPrefix="TestControl"  %>

<TestControl:MyControl runat="server" ID="MyControl1">
    <TestControl:PersonName Name="Chris"></TestControl:PersonName>
    <TestControl:PersonName Name="John"></TestControl:PersonName>
</TestControl:MyControl> 
```

# visual-studio - VSTS 代码覆盖错误？

> ID：123619
> 
> 赞同：3
> 
> 时间：2008-09-23T20:22:21.497
> 
> 标签：visual-studio, unit-testing, code-coverage

有没有人经历过[这个 VSTS 代码覆盖“错误](http://tinyurl.com/4pgxee)”？你有什么建议吗？

我正在使用 Visual Studio 进行代码覆盖率分析，现在使用包含的工具通常是一项简单的任务。但是，我有一个我无法克服的问题。假设我有程序集 A、B、C 和 D，并已将它们全部标记为覆盖分析。我运行测试并查看结果并找到包含 A、B 和 C 的报告 - 但不包含 D。我调查并发现没有测试实际上执行 D 中的任何代码（假设它是 asp.net 前端和我还没有利用 UI 测试）。因为没有针对 D 的测试导致报告中缺少 D，所以总代码覆盖率和“未覆盖的块”是不正确的。

有谁知道我该怎么做以下任何一项？

*   计算 D 中的总“块数”，以便我可以手动调整覆盖率报告以使其正确？
*   获取覆盖率报告以自动显示未覆盖的程序集的块数，这些程序集已针对覆盖率进行检测但根本未进行测试？

虽然我确实希望提高测试覆盖率，但我正在分析代码库中历史时间点保存的覆盖率报告。因此，我不想创建一个仅在每个程序集中执行至少 1 个代码块并通过运行测试重新计算测试覆盖率的测试。对于看似简单的问题，这将是一个非常耗时的解决方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T22:00:42.797

我遇到过一次，很烦人。在我的例子中，有许多 dll 没有被覆盖，所以我最终通过使用覆盖的 dll 信息除以它们的大小来估计我们的代码库的块/kb。然后当然要获得未覆盖的 dll 的块数，只需将平均值乘以 dll 的大小。这不是最准确的方法，但它可以让您快速了解情况，您可以通过计算已知 dll 并与实际值进行比较来确定错误。如果您有大量已计算的装配体，这将很有帮助。

当然，您可以只计算 LOC（忽略注释）并计算单个 LOC，大致相当于一个块。如果我没记错的话，那相当准确，所以应该让你更接近。

我所知道的强制报告未覆盖程序集的唯一方法是实际编写一个加载程序集的测试（测试甚至不需要做任何事情）。

# excel - 你可以从 Excel 连接到 sql server 吗？

> ID：123624
> 
> 赞同：9
> 
> 时间：2008-09-23T20:23:14.303
> 
> 标签：excel

我需要从 sql server 数据库创建一些报告供最终用户查看。

是否可以从excel连接到sql server？

**更新** 最终用户只会点击文件来查看报告，要求他们做更多的要求太多了！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-23T20:25:32.690

是的，绝对是，取决于您拥有的 excel 版本。在 2007 年，如果您进入“数据”选项卡，然后选择“获取外部数据”，您将看到许多连接各种数据源的选项，包括 SQL

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T20:25:02.597

当然——在 Excel 2007 中单击“数据”选项卡，然后单击“连接”，然后单击“浏览更多”并选择“+NewSqlServerConnection.odc”

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-03-05T15:16:19.187

这是我使用的解决方案：http: [//mikesknowledgebase.com/pages/SQLServer/RunStoredProcedureFromExcel.htm](http://mikesknowledgebase.com/pages/SQLServer/RunStoredProcedureFromExcel.htm)

基本上，它使用一点 VBA 来调用存储过程，然后在 Excel 文件中显示结果。

![带有存储过程的 Excel](https://i.stack.imgur.com/pK8OZ.jpg)

当我们想给我们的用户一个临时报告而不需要向我们的 ASP.Net 应用程序添加额外的屏幕或重新部署我们的应用程序的新版本时，我们经常使用它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T21:54:55.800

在 2007 年，您确实可以进入“数据”选项卡，然后“获取外部数据”。您可以从许多来源收集数据，包括 SQL Server、网页和 Access。

连接后有一个更新数据的选项：

*   每 x 分钟
*   打开 Excel 工作表时

您甚至可以选择在关闭 Excel 工作表时删除数据。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T20:32:18.447

如果您想确保对最终用户没有技术要求，导出过程是一种更好的方法，而不是直接从 Excel 文件链接到服务器。

您可以保存连接信息，但有一些方法可以将其弄乱，如果无法信任他们来配置它，那么提取数据并提供静态副本很可能是最好的选择。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T20:59:05.277

您可以使用 VBA 连接到数据库并导入数据。用户只需打开文件。您的 VBA 代码将执行数据的检索和格式化。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T20:24:20.213

最简单和最古老的方法是使用 ODBC，但使用 VBScript，一切皆有可能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T20:24:45.047

您最好创建一个视图（或只是一个查询）以您想要的方式呈现数据，然后使用 DTS (SQL 2000) 或 SSIS (SQL 2005) 使用 Microsoft Excel ODBC 驱动程序导出信息

# iis - UNC 共享上的 IIS 站点：有问题吗？

> ID：123628
> 
> 赞同：7
> 
> 时间：2008-09-23T20:24:15.703
> 
> 标签：iis, asp-classic, unc, netbios

我正在使用负载平衡的旧版 ASP 经典解决方案（通过外部硬件并有一个 IIS 站点，其主目录是 UNC 路径。我被告知此设置当前存在以下问题：

1.  当使用 UNC 路径作为主目录时，IIS 中某处有一个“索引”，它“缓存”了一定数量的某些类型的文件，当达到限制（默认为 50）时，后续请求不在缓存中的页面将返回 404。
2.  当使用 UNC 路径作为主目录时，在启动 IIS 站点时，上述“缓存”将开始填充，这将阻塞站点 IIS，直到缓存被填满，这意味着巨大的站点（15,000 个 .asp 文件）不可用IIS 站点启动后最多 30 分钟。
3.  当使用 UNC 路径作为主目录时，如果同时向站点发出超过一定数量的请求，Windows 将达到“每台服务器的网络 BIOS 命令限制”，所有超过限制的请求都必须等到 IIS“关闭会话”到服务器。我被告知限制是 100 个文件并且不可配置。

现在，这一切听起来有点奇怪。如果我使用默认设置设置一个新的 Windows 2003 服务器，并使用它来托管一个具有 15,000 个 .asp 文件的 ASP Classic 应用程序，使用服务器上的共享作为 IIS 站点的主目录，**我真的会遇到这些问题吗？ ? 如果是这样，有没有办法在不改变架构的情况下对抗它们？**

（澄清一下，“负载平衡”很重要的唯一原因是负载平衡是文件在服务器共享上的原因。如果不需要负载平衡，文件可以在本地磁盘上。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T22:48:30.520

是的，这是可能的，但是是的，它可能会导致问题。

当 ASP.NET 将 ASPX、ASCX 和其他内容页面编译成程序集时，它会创建大量 FileSystemWatcher 以监视它们之间的依赖关系，以便在文件更改时可以重新编译。这些会占用 NetBIOS 资源。

此外，每次您对站点的服务路径执行 File.Exists 或 Directory.Exists 调用或任何其他类型的 IO 时，都会增加对 NetBIOS 限制的要求。

可以通过注册表将 NetBIOS 限制设置为高于其默认值。

对于目录和文件相对较少的小型站点，您可以非常成功地运行 UNC 共享，因为 ASP.NET 将在其编译程序集启动后继续运行。但是，您添加的目录和文件越多，出现问题的可能性就越大。

我们尝试运行一个庞大的站点（数百个目录和 ASPX/ASCX 文件），它可以正常运行几分钟，直到访问足够多的 url 达到 NetBIOS 限制，然后每次后续页面查看都会导致异常。我们最终被迫使用 robocopy 发布解决方案。

最后，您必须测试您的站点是否足够小，并且您的 NetBIOS 设置是否足够高以有效运行。我建议在测试站点上使用蜘蛛，这样您就可以确定所有可以编译或访问的内容至少一次。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T20:36:36.767

我不确定您对 IIS 和 UNC 之间交互的直接问题，但我建议在繁忙的站点（任何繁忙到需要负载平衡的站点）上，您考虑文件共享以外的其他内容。

IIS 通过网络（即文件共享）加载的 asp 将遭受负面的性能影响（延迟）。

我建议使用 robocopy 之类的东西来保持所有负载平衡服务器与中央主机同步。换句话说，部署到单个主服务器（或单个主位置），然后将文件 robocopy 到负载均衡器池中的每个从属服务器。

这不仅会消除您描述的奇怪的 UNC 问题，而且还会给您带来不错的性能提升（通过消除加载 asp 页面时的网络命中）。如果你这样做，我会期待相当大的性能提升。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T20:34:02.483

对于答案 3，您可以更改网络 BIOS 命令限制。它是一个非常简单的注册表编辑修复：http: [//support.microsoft.com/kb/810886/en-us](http://support.microsoft.com/kb/810886/en-us)

我自己也遇到过这个特殊问题。

# visual-studio - 有什么方法可以从命令行构建 Visual Studio“仅项目”？

> ID：123632
> 
> 赞同：15
> 
> 时间：2008-09-23T20:24:34.347
> 
> 标签：visual-studio, visual-studio-2008, command-line

```
devenv mysolution.sln /build "Release|Win32" /project myproject 
```

从命令行构建时，似乎我可以选择执行`/build`or `/rebuild`，但没有办法说我想做“仅项目”（即也不构建或重建指定项目的依赖项）。有谁知道一种方法？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-23T20:30:17.313

根据您的构建系统的结构，这可能是您正在寻找的：

```
msbuild /p:BuildProjectReferences=false project.proj 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-23T20:27:49.940

[MSBuild](http://msdn.microsoft.com/en-us/library/ms164311.aspx)是你想要的

```
MSBuild.exe MyProject.proj /t:build 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T20:27:42.637

不要调用`devenv`，而是使用通用的构建工具：

```
vcbuild subproject.vcproj "release|win32" 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-09-28T13:37:09.307

根据 MSDN [How To: Build Specific Targets in Solutions with MSBuild.exe](http://msdn.microsoft.com/en-us/library/ms171486.aspx)：

```
msbuild foo.sln /t:proj1:Rebuild;folder_of_proj2\proj2:Clean 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-04-04T06:54:41.753

如何构建一个项目，而不是一个完整的解决方案 - [MSDN 文章](http://msdn.microsoft.com/en-us/library/a4sf02ac%28v=vs.80%29.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T21:28:01.637

感谢您的回答。我从一些研究中看到`msbuild`它可以处理`.sln`文件而不是`.vcproj`; 这可以通过这种方式完成，而不必知道 的位置`.vcproj`？

让我退后一步。我们有一个很大的解决方案文件，我想要一个脚本来执行此操作：

1.  做一个`/build`整体解决方案。
    （有时有些项目会失败，因为`devenv`没有按照自上次构建以来的更改量进行所需的构建。）
2.  对于每个失败的项目，做一个`/rebuild`。

当我进入第 2 步时，我只知道解决方案文件名和失败项目的名称（不是文件名）。我可以轻松地`grep`/ `awk`/无论`.sln`文件从一个映射到另一个，但我很好奇是否`msbuild`提供了一种直接执行此操作的方法。

（理想情况下，我可以在一个命令行中给出要重建的*所有*`msbuild`项目的`.sln`名称和名称，因为它是一个大文件并且需要一段时间才能加载。如果这不可能，那么手动查找所有项目文件名的选项可能会更好因为每次加载解决方案文件效率最低。）

 ** * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-22T22:10:00.757

以下适用于在 VS2010 中构建单个 C++ 项目：

```
call "%VS100COMNTOOLS%"\\vsvars32.bat
msbuild /detailedsummary /p:Configuration=Debug /p:Platform=x64 /t:build MY_ABSOLUTE_PATH.vcxproj 
```

遗憾的是，您不能简单地指定项目名称和解决方案文件来构建该项目（除非您可能会向项目文件添加特殊配置）。

# apache-flex - 版本控制如何与 Flex 远程对象和 AMF 一起使用？

> ID：123639
> 
> 赞同：1
> 
> 时间：2008-09-23T20:25:14.250
> 
> 标签：apache-flex, class, version, amf

假设我使用 [RemoteClass] 标签赋予自定义 Flex 类以序列化智能。

当我需要更改对象（添加新字段、删除字段、重命名字段等）时会发生什么？

是否有一种设计模式可以优雅地处理这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-29T07:17:59.220

最好的办法是针对后端类生成代码，为它们生成对应的 ActionScript。如果您生成具有所有对象属性的基类，然后为其创建一个从未修改过的子类，您仍然可以添加自定义代码，同时仅重新生成类中发生更改的部分。例子：

```
java:
public class User {
  public Long id;
  public String firstName;
  public String lastName;
}

as3:
public class UserBase {
  public var id : Number;
  public var firstName : String;
  public var lastName : String;
}

[Bindable] [RemoteClass(...)]
public class User extends UserBase {
  public function getFullName() : String {
    return firstName + " " + lastName;
  }
} 
```

查看 Java 的 Granite Data Services 项目 -> AS3 代码生成。

[http://www.graniteds.org](http://www.graniteds.org)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T14:28:27.657

添加或删除通常有效。

您将在跟踪中收到有关属性丢失或未找到的运行时警告，但任何已传输且有可去处的数据仍会到达那里。您需要在开发时牢记这一点，因为并非所有字段都可能包含有效数据。

更改类型并不能很好地工作，并且通常会导致运行时异常。

我喜欢使用显式的数据传输对象，而不是保留在整个应用程序中使用的实际数据模型。然后您从 DTO->Model 的翻译可以考虑版本差异。

# sql-server - 扩展 SQL Server 全文索引以搜索外键

> ID：123648
> 
> 赞同：3
> 
> 时间：2008-09-23T20:27:31.233
> 
> 标签：sql-server, database-design

我知道 SQL Server 全文索引不能索引多个表。但是，我想在表中实现全文索引的关系。

拿下面的3张桌子...

```
Vehicle
Veh_ID - int (Primary Key)
FK_Atr_VehicleColor - int
Veh_Make - nvarchar(20)
Veh_Model - nvarchar(50)
Veh_LicensePlate - nvarchar(10)

Attributes
Atr_ID - int (Primary Key)
FK_Aty_ID - int
Atr_Name - nvarchar(50)

AttributeTypes
Aty_ID - int (Primary key)
Aty_Name - nvarchar(50) 
```

Attributes 和 AttributeTypes 表包含的值可以在整个正在构建的应用程序的下拉列表中使用。例如，属性类型为“车辆颜色”，属性为“黑色”、“蓝色”、“红色”等...

好的，所以当用户尝试搜索“Blue Ford Mustang”时问题就来了。那么考虑到像 Vehicle 这样的表会变得相当大，最好的解决方案是什么？

我是否在“车辆”表中创建另一个字段，即“车辆颜色”，除了“FK Atr VehicleColor”之外，它还保存下拉列表中选择的文本值？

或者，我是否完全放弃“FK Atr VehicleColor”并添加“Veh Color”？当下拉列表填充到更新表单中时，我可以使用“Veh Color”的文本值来匹配“Atr Name”。使用这种方法，如果从数据库中删除属性，我将不得不处理。

- 注意：不能在代码视图之外使用下划线，因为两个下划线之间的所有内容都是*斜体*。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T20:56:42.273

我相信专门为全文索引创建单独的非规范化表是一种常见的做法。然后，该表由触发器更新，或者在我们的例子中，由 SQL Server 的计划任务更新。

这是 SQL Server 2000。在 SQL Server 中，您可以拥有一个带有全文索引的[索引视图：http:](http://www.microsoft.com/technet/prodtechnol/sql/2005/impprfiv.mspx) [//msdn.microsoft.com/en-us/library/ms187317.aspx](http://msdn.microsoft.com/en-us/library/ms187317.aspx)。但请注意，索引视图有很多限制；例如，*您不能索引使用 OUTER join 的视图*。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T21:06:23.077

您可以创建一个视图来提取您需要的任何数据，然后将全文索引应用于视图。视图需要使用“WITH SCHEMABINDING”选项创建，并且需要有一个唯一索引。

```
CREATE VIEW VehicleSearch
WITH SCHEMABINDING
AS
SELECT
  v.Veh_ID,
  v.Veh_Make,
  v.Veh_Model,
  v.Veh_LicensePlate,
  a.Atr_Name as Veh_Color
FROM
  Vehicle v
INNER JOIN
  Attributes a on a.Atr_ID = v.FK_Atr_VehicleColor
GO

CREATE UNIQUE CLUSTERED INDEX IX_VehicleSearch_Veh_ID ON VehicleSearch (
  Veh_ID  ASC
) ON [PRIMARY]
GO

CREATE FULLTEXT INDEX ON VehicleSearch (
  Veh_Make  LANGUAGE [English],
  Veh_Model LANGUAGE [English],
  Veh_Color LANGUAGE [English]
)
KEY INDEX IX_VehicleSearch_Veh_ID  ON [YourFullTextCatalog]
WITH CHANGE_TRACKING AUTO
GO 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T20:55:53.007

据我了解（我经常使用 SQL Server，但从未使用全文索引）SQL Server 2005 允许您针对视图创建全文索引。所以你可以创建一个视图

```
SELECT 
  Vehicle.VehID, ..., Color.Atr_Name AS ColorName 
FROM
  Vehicle 
LEFT OUTER JOIN Attributes AS Color ON (Vehicle.FK_Atr_VehicleColor = Attributes.Atr_Id) 
```

然后在此视图中创建全文索引，包括索引中的“ColorName”。

# java - 如何在两个或多个 Servlet 之间共享变量或对象？

> ID：123657
> 
> 赞同：42
> 
> 时间：2008-09-23T20:29:55.333
> 
> 标签：java, web-applications, servlets

我想知道是否有某种方法可以在两个或多个 Servlet 之间共享变量或对象，我的意思是一些“标准”方式。我想这不是一个好的做法，而是一种更简单的构建原型的方法。

我不知道这是否取决于所使用的技术，但我将使用 Tomcat 5.5

* * *

我想共享一个简单类的对象向量（只是公共属性、字符串、整数等）。我的意图是在数据库中拥有一个静态数据，显然它会在 Tomcat 停止时丢失。（仅用于测试）

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-09-23T20:51:01.723

我认为您在这里寻找的是请求、会话或应用程序数据。

在 servlet 中，您可以将对象作为属性添加到请求对象、会话对象或 servlet 上下文对象：

```
protected void doGet(HttpServletRequest request, HttpServletResponse response) {
    String shared = "shared";
    request.setAttribute("sharedId", shared); // add to request
    request.getSession().setAttribute("sharedId", shared); // add to session
    this.getServletConfig().getServletContext().setAttribute("sharedId", shared); // add to application context
    request.getRequestDispatcher("/URLofOtherServlet").forward(request, response);
} 
```

如果您将它放在请求对象中，它将可供被转发到的 servlet 使用，直到请求完成：

```
request.getAttribute("sharedId"); 
```

如果您将它放在会话中，它将可供所有 servlet 使用，但该值将与用户相关联：

```
request.getSession().getAttribute("sharedId"); 
```

直到会话基于用户的不活动而过期。

由您重置：

```
request.getSession().invalidate(); 
```

或者一个 servlet 将其从作用域中删除：

```
request.getSession().removeAttribute("sharedId"); 
```

如果将它放在 servlet 上下文中，它将在应用程序运行时可用：

```
this.getServletConfig().getServletContext().getAttribute("sharedId"); 
```

直到你删除它：

```
this.getServletConfig().getServletContext().removeAttribute("sharedId"); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-23T20:56:32.973

将其放在 3 个不同的范围之一中。

请求 - 持续请求的生命

session - 持续用户会话的生命周期

应用程序 - 持续到应用程序关闭

您可以通过传递给从[HttpServlet 类扩展的方法的 HttpServletRequest 变量访问所有这些范围](http://java.sun.com/j2ee/1.4/docs/api/javax/servlet/http/HttpServlet.html)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-23T20:39:11.597

取决于数据的预期用途范围。

如果数据仅用于每个用户，例如用户登录信息、页面点击计数等，请使用会话对象 (httpServletRequest.getSession().get/setAttribute(String [,Object]))

如果是跨多个用户的相同数据（总网页点击量、工作线程等），请使用 ServletContext 属性。servlet.getServletCongfig().getServletContext().get/setAttribute(String [,Object]))。这仅适用于相同的战争文件/网络应用程序。请注意，此数据也不会在重新启动后保留。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-04-17T10:53:21.640

另一种选择，在上下文之间共享数据......

[在 tomcat 上的 servlet 之间共享数据](http://web.archive.org/web/20110720023310/http://my.opera.com/wyi/blog/2007/08/22/share-data-between-servlets-on-tomcat)

```
 <Context path="/myApp1" docBase="myApp1" crossContext="true"/>
  <Context path="/myApp2" docBase="myApp2" crossContext="true"/> 
```

在 myApp1 上：

```
 ServletContext sc = getServletContext();
  sc.setAttribute("attribute", "value"); 
```

在 myApp2 上：

```
 ServletContext sc = getServletContext("/myApp1");
  String anwser = (String)sc.getAttribute("attribute"); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T20:38:02.253

您不能将对象放在 HttpSession 中，然后在每个 servlet 中通过其属性名称来引用它吗？

例如：

```
getSession().setAttribute("thing", object); 
```

...然后在另一个 servlet 中：

```
Object obj = getSession.getAttribute("thing"); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-10-27T17:27:49.303

这是我如何使用 Jetty 执行此操作的。

[https://stackoverflow.com/a/46968645/1287091](https://stackoverflow.com/a/46968645/1287091)

使用服务器上下文，在嵌入式 Jetty 服务器启动期间写入单例，并在服务器生命周期内在所有 webapps 之间共享。也可用于在 webapps 之间共享对象/数据，假设上下文只有一个编写者 - 否则您需要注意并发性。

# c# - 如何等待 BackgroundWorker 取消？

> ID：123661
> 
> 赞同：127
> 
> 时间：2008-09-23T20:30:50.430
> 
> 标签：c#, .net, multithreading, backgroundworker

考虑一个为您做事的对象的*假设*方法：

```
public class DoesStuff
{
    BackgroundWorker _worker = new BackgroundWorker();

    ...

    public void CancelDoingStuff()
    {
        _worker.CancelAsync();

        //todo: Figure out a way to wait for BackgroundWorker to be cancelled.
    }
} 
```

如何等待 BackgroundWorker 完成？

* * *

过去人们曾尝试过：

```
while (_worker.IsBusy)
{
    Sleep(100);
} 
```

但是[这个死锁](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=1819196&SiteID=1)，因为`IsBusy`直到`RunWorkerCompleted`事件被处理之后才会被清除，并且在应用程序空闲之前无法处理该事件。在工作人员完成之前，应用程序不会空闲。（另外，这是一个繁忙的循环 - 恶心。）

其他人建议将其添加到：

```
while (_worker.IsBusy)
{
    Application.DoEvents();
} 
```

这样做的问题是`Application.DoEvents()`导致当前在队列中的消息被处理，这会导致重入问题（.NET 不能重入）。

我希望使用一些涉及事件同步对象的解决方案，其中代码**等待**事件 - 工作人员的`RunWorkerCompleted`事件处理程序设置。就像是：

```
Event _workerDoneEvent = new WaitHandle();

public void CancelDoingStuff()
{
    _worker.CancelAsync();
    _workerDoneEvent.WaitOne();
}

private void RunWorkerCompletedEventHandler(sender object, RunWorkerCompletedEventArgs e)
{
    _workerDoneEvent.SetEvent();
} 
```

但是我又回到了死锁：事件处理程序在应用程序空闲之前无法运行，并且应用程序不会因为正在等待事件而空闲。

那么你怎么能等待 BackgroundWorker 完成呢？

* * *

**更新** 人们似乎对这个问题感到困惑。他们似乎认为我会将 BackgroundWorker 用作：

```
BackgroundWorker worker = new BackgroundWorker();
worker.DoWork += MyWork;
worker.RunWorkerAsync();
WaitForWorkerToFinish(worker); 
```

*不是*这样，这不是*我*正在做的，*也不*是这里要问的。如果是这样的话，使用后台工作人员就没有意义了。

* * *

## 回答 #1

> 赞同：131
> 
> 时间：2008-09-23T20:52:17.807

如果我正确理解您的要求，您可以执行以下操作（代码未经测试，但显示了总体思路）：

```
private BackgroundWorker worker = new BackgroundWorker();
private AutoResetEvent _resetEvent = new AutoResetEvent(false);

public Form1()
{
    InitializeComponent();

    worker.DoWork += worker_DoWork;
}

public void Cancel()
{
    worker.CancelAsync();
    _resetEvent.WaitOne(); // will block until _resetEvent.Set() call made
}

void worker_DoWork(object sender, DoWorkEventArgs e)
{
    while(!e.Cancel)
    {
        // do something
    }

    _resetEvent.Set(); // signal that worker is done
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-24T11:22:50.367

[此](https://stackoverflow.com/questions/123661/net-how-to-wait-for-a-backgroundworker-to-complete#123791)响应存在问题。UI需要在你等待的时候继续处理消息，否则它不会重绘，如果你的后台worker需要很长时间来响应取消请求，这将是一个问题。

第二个缺陷是，`_resetEvent.Set()`如果工作线程抛出异常，则永远不会调用它——让主线程无限期地等待——但是这个缺陷可以很容易地通过 try/finally 块来修复。

一种方法是显示一个模式对话框，该对话框有一个计时器，用于重复检查后台工作人员是否已完成工作（或在您的情况下已完成取消）。后台工作人员完成后，模式对话框会将控制权返回给您的应用程序。在这种情况发生之前，用户无法与 UI 交互。

另一种方法（假设您最多打开一个无模式窗口）是设置 ActiveForm.Enabled = false，然后循环 Application,DoEvents 直到后台工作人员完成取消，之后您可以再次设置 ActiveForm.Enabled = true。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-24T14:09:27.720

几乎所有人都对这个问题感到困惑，并且不了解如何使用工人。

考虑一个 RunWorkerComplete 事件处理程序：

```
private void OnRunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)
{
    if (!e.Cancelled)
    {
        rocketOnPad = false;
        label1.Text = "Rocket launch complete.";
    }
    else
    {
        rocketOnPad = true;
        label1.Text = "Rocket launch aborted.";
    }
    worker = null;
} 
```

一切都很好。

现在出现了调用者需要中止倒计时的情况，因为他们需要执行火箭的紧急自毁。

```
private void BlowUpRocket()
{
    if (worker != null)
    {
        worker.CancelAsync();
        WaitForWorkerToFinish(worker);
        worker = null;
    }

    StartClaxon();
    SelfDestruct();
} 
```

还有一种情况是我们需要打开火箭的通道门，但不是在倒计时的时候：

```
private void OpenAccessGates()
{
    if (worker != null)
    {
        worker.CancelAsync();
        WaitForWorkerToFinish(worker);
        worker = null;
    }

    if (!rocketOnPad)
        DisengageAllGateLatches();
} 
```

最后，我们需要给火箭加油，但在倒计时期间这是不允许的：

```
private void DrainRocket()
{
    if (worker != null)
    {
        worker.CancelAsync();
        WaitForWorkerToFinish(worker);
        worker = null;
    }

    if (rocketOnPad)
        OpenFuelValves();
} 
```

由于无法等待工作人员取消，我们必须将所有三个方法移至 RunWorkerCompletedEvent：

```
private void OnRunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)
{
    if (!e.Cancelled)
    {
        rocketOnPad = false;
        label1.Text = "Rocket launch complete.";
    }
    else
    {
        rocketOnPad = true;
        label1.Text = "Rocket launch aborted.";
    }
    worker = null;

    if (delayedBlowUpRocket)
        BlowUpRocket();
    else if (delayedOpenAccessGates)
        OpenAccessGates();
    else if (delayedDrainRocket)
        DrainRocket();
}

private void BlowUpRocket()
{
    if (worker != null)
    {
        delayedBlowUpRocket = true;
        worker.CancelAsync();
        return;
    }

    StartClaxon();
    SelfDestruct();
}

private void OpenAccessGates()
{
    if (worker != null)
    {
        delayedOpenAccessGates = true;
        worker.CancelAsync();
        return;
    }

    if (!rocketOnPad)
        DisengageAllGateLatches();
}

private void DrainRocket()
{
    if (worker != null)
    {
        delayedDrainRocket = true;
        worker.CancelAsync();
        return;
    }

    if (rocketOnPad)
        OpenFuelValves();
} 
```

现在我可以这样写我的代码，但我不会。我不在乎，我只是没有。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-23T20:36:31.353

您可以检查**RunWorkerCompletedEventHandler**中的**RunWorkerCompletedEventArgs**以查看状态。成功、取消或错误。

```
private void RunWorkerCompletedEventHandler(sender object, RunWorkerCompletedEventArgs e)
{
    if(e.Cancelled)
    {
        Console.WriteLine("The worker was cancelled.");
    }
} 
```

**更新**：要查看您的工作人员是否已使用以下方法调用 .CancelAsync()：

```
if (_worker.CancellationPending)
{
    Console.WriteLine("Cancellation is pending, no need to call CancelAsync again");
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-23T20:43:42.023

您*无需*等待后台工作人员完成。这几乎违背了启动单独线程的目的。相反，您应该让您的方法完成，并将依赖于完成的任何代码移动到不同的位置。您让工作人员告诉您何时完成，然后调用任何剩余的代码。

如果您想*等待*某事完成，请使用提供 WaitHandle 的不同线程构造。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-23T20:39:39.020

为什么你不能只绑定到 BackgroundWorker.RunWorkerCompleted 事件。这是一个回调，将“在后台操作完成、取消或引发异常时发生”。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T20:41:31.577

我不明白您为什么要等待 BackgroundWorker 完成；这似乎与上课的动机完全相反。

但是，您可以通过调用 worker.IsBusy 来启动每个方法，并让它们在运行时退出。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-06-18T16:30:01.293

只想说我来到这里是因为我需要一个后台工作人员在循环中运行异步进程时等待，我的修复比所有其他东西都容易^^

```
foreach(DataRow rw in dt.Rows)
{
     //loop code
     while(!backgroundWorker1.IsBusy)
     {
         backgroundWorker1.RunWorkerAsync();
     }
} 
```

只是想我会分享，因为这是我在寻找解决方案时最终的结果。此外，这是我关于堆栈溢出的第一篇文章，所以如果它不好或任何我喜欢批评者！:)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T20:42:53.007

嗯，也许我没有正确回答您的问题。

[一旦他的“workermethod”（处理backgroundworker.doWork-event](http://msdn.microsoft.com/de-de/library/system.componentmodel.backgroundworker.dowork(VS.80).aspx)的方法/函数/子 ）完成，后台工作者调用 WorkerCompleted 事件，因此无需检查 BW 是否仍在运行。如果您想停止您的工作人员，请检查您的“工作人员方法”中的[取消挂起属性。](http://msdn.microsoft.com/de-de/library/system.componentmodel.backgroundworker.cancellationpending(VS.80).aspx)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T21:02:45.207

对象的工作流`BackgroundWorker`基本上要求您处理`RunWorkerCompleted`正常执行和用户取消用例的事件。这就是属性*RunWorkerCompletedEventArgs.Cancelled*存在的原因。基本上，正确执行此操作要求您将 Cancel 方法本身视为异步方法。

这是一个例子：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using System.ComponentModel;

namespace WindowsFormsApplication1
{
    public class AsyncForm : Form
    {
        private Button _startButton;
        private Label _statusLabel;
        private Button _stopButton;
        private MyWorker _worker;

        public AsyncForm()
        {
            var layoutPanel = new TableLayoutPanel();
            layoutPanel.Dock = DockStyle.Fill;
            layoutPanel.ColumnStyles.Add(new ColumnStyle());
            layoutPanel.ColumnStyles.Add(new ColumnStyle());
            layoutPanel.RowStyles.Add(new RowStyle(SizeType.AutoSize));
            layoutPanel.RowStyles.Add(new RowStyle(SizeType.Percent, 100));

            _statusLabel = new Label();
            _statusLabel.Text = "Idle.";
            layoutPanel.Controls.Add(_statusLabel, 0, 0);

            _startButton = new Button();
            _startButton.Text = "Start";
            _startButton.Click += HandleStartButton;
            layoutPanel.Controls.Add(_startButton, 0, 1);

            _stopButton = new Button();
            _stopButton.Enabled = false;
            _stopButton.Text = "Stop";
            _stopButton.Click += HandleStopButton;
            layoutPanel.Controls.Add(_stopButton, 1, 1);

            this.Controls.Add(layoutPanel);
        }

        private void HandleStartButton(object sender, EventArgs e)
        {
            _stopButton.Enabled = true;
            _startButton.Enabled = false;

            _worker = new MyWorker() { WorkerSupportsCancellation = true };
            _worker.RunWorkerCompleted += HandleWorkerCompleted;
            _worker.RunWorkerAsync();

            _statusLabel.Text = "Running...";
        }

        private void HandleStopButton(object sender, EventArgs e)
        {
            _worker.CancelAsync();
            _statusLabel.Text = "Cancelling...";
        }

        private void HandleWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)
        {
            if (e.Cancelled)
            {
                _statusLabel.Text = "Cancelled!";
            }
            else
            {
                _statusLabel.Text = "Completed.";
            }

            _stopButton.Enabled = false;
            _startButton.Enabled = true;
        }

    }

    public class MyWorker : BackgroundWorker
    {
        protected override void OnDoWork(DoWorkEventArgs e)
        {
            base.OnDoWork(e);

            for (int i = 0; i < 10; i++)
            {
                System.Threading.Thread.Sleep(500);

                if (this.CancellationPending)
                {
                    e.Cancel = true;
                    e.Result = false;
                    return;
                }
            }

            e.Result = true;
        }
    }
} 
```

如果您*真的*不希望您的方法退出，我建议您`AutoResetEvent`在 derived 上放置一个类似 an 的标志`BackgroundWorker`，然后覆盖`OnRunWorkerCompleted`以设置该标志。不过，它仍然有点笨拙。我建议将取消事件视为异步方法，并执行它当前在`RunWorkerCompleted`处理程序中所做的任何事情。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-07-06T23:08:24.720

我在这里参加聚会有点晚了（大约 4 年），但是如何设置一个可以处理繁忙循环而不锁定 UI 的异步线程，然后让来自该线程的回调确认 BackgroundWorker 已完成取消?

像这样的东西：

```
class Test : Form
{
    private BackgroundWorker MyWorker = new BackgroundWorker();

    public Test() {
        MyWorker.DoWork += new DoWorkEventHandler(MyWorker_DoWork);
    }

    void MyWorker_DoWork(object sender, DoWorkEventArgs e) {
        for (int i = 0; i < 100; i++) {
            //Do stuff here
            System.Threading.Thread.Sleep((new Random()).Next(0, 1000));  //WARN: Artificial latency here
            if (MyWorker.CancellationPending) { return; } //Bail out if MyWorker is cancelled
        }
    }

    public void CancelWorker() {
        if (MyWorker != null && MyWorker.IsBusy) {
            MyWorker.CancelAsync();
            System.Threading.ThreadStart WaitThread = new System.Threading.ThreadStart(delegate() {
                while (MyWorker.IsBusy) {
                    System.Threading.Thread.Sleep(100);
                }
            });
            WaitThread.BeginInvoke(a => {
                Invoke((MethodInvoker)delegate() { //Invoke your StuffAfterCancellation call back onto the UI thread
                    StuffAfterCancellation();
                });
            }, null);
        } else {
            StuffAfterCancellation();
        }
    }

    private void StuffAfterCancellation() {
        //Things to do after MyWorker is cancelled
    }
} 
```

本质上，它的作用是触发另一个线程在后台运行，该线程只是在其繁忙的循环中等待以查看是否`MyWorker`已完成。一旦`MyWorker`完成取消线程将退出，我们可以使用它`AsyncCallback`来执行我们需要遵循成功取消的任何方法 - 它会像一个伪事件一样工作。`MyWorker`由于这与 UI 线程是分开的，因此在我们等待完成取消时它不会锁定 UI 。如果您的意图确实是锁定并等待取消，那么这对您来说毫无用处，但如果您只想等待以便可以启动另一个进程，那么这很好用。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-08-28T10:18:55.847

```
Imports System.Net
Imports System.IO
Imports System.Text

Public Class Form1
   Dim f As New Windows.Forms.Form
  Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
   BackgroundWorker1.WorkerReportsProgress = True
    BackgroundWorker1.RunWorkerAsync()
    Dim l As New Label
    l.Text = "Please Wait"
    f.Controls.Add(l)
    l.Dock = DockStyle.Fill
    f.StartPosition = FormStartPosition.CenterScreen
    f.FormBorderStyle = Windows.Forms.FormBorderStyle.None
    While BackgroundWorker1.IsBusy
        f.ShowDialog()
    End While
End Sub

Private Sub BackgroundWorker1_DoWork(ByVal sender As Object, ByVal e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker1.DoWork

    Dim i As Integer
    For i = 1 To 5
        Threading.Thread.Sleep(5000)
        BackgroundWorker1.ReportProgress((i / 5) * 100)
    Next
End Sub

Private Sub BackgroundWorker1_ProgressChanged(ByVal sender As Object, ByVal e As System.ComponentModel.ProgressChangedEventArgs) Handles BackgroundWorker1.ProgressChanged
    Me.Text = e.ProgressPercentage

End Sub

 Private Sub BackgroundWorker1_RunWorkerCompleted(ByVal sender As Object, ByVal e As System.ComponentModel.RunWorkerCompletedEventArgs) Handles BackgroundWorker1.RunWorkerCompleted

    f.Close()

End Sub

End Class 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-10-11T20:06:34.087

我知道这真的很晚（5 年），但您正在寻找的是使用 Thread 和[SynchronizationContext](http://msdn.microsoft.com/en-us/library/system.threading.synchronizationcontext.aspx)。您将不得不“手动”将 UI 调用编组回 UI 线程，而不是让框架自动执行此操作。

这允许您使用可以等待的线程（如果需要）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-06-27T17:54:46.327

Fredrik Kalseth 对这个问题的解决方案是我迄今为止找到的最好的解决方案。`Application.DoEvent()`使用可能导致问题或根本不起作用的其他解决方案。让我将他的解决方案转换为可重用的类。由于`BackgroundWorker`不是密封的，我们可以从中派生出我们的类：

```
public class BackgroundWorkerEx : BackgroundWorker
{
    private AutoResetEvent _resetEvent = new AutoResetEvent(false);
    private bool _resetting, _started;
    private object _lockObject = new object();

    public void CancelSync()
    {
        bool doReset = false;
        lock (_lockObject) {
            if (_started && !_resetting) {
                _resetting = true;
                doReset = true;
            }
        }
        if (doReset) {
            CancelAsync();
            _resetEvent.WaitOne();
            lock (_lockObject) {
                _started = false;
                _resetting = false;
            }
        }
    }

    protected override void OnDoWork(DoWorkEventArgs e)
    {
        lock (_lockObject) {
            _resetting = false;
            _started = true;
            _resetEvent.Reset();
        }
        try {
            base.OnDoWork(e);
        } finally {
            _resetEvent.Set();
        }
    }
} 
```

使用标志和适当的锁定，我们确保`_resetEvent.WaitOne()`只有在某些工作已经开始时才真正被调用，否则`_resetEvent.Set();`可能永远不会被调用！

try-finally 确保`_resetEvent.Set();`将被调用，即使在我们的 DoWork 处理程序中应该发生异常。否则应用程序可能会在调用时永远冻结`CancelSync`！

我们会这样使用它：

```
BackgroundWorkerEx _worker;

void StartWork()
{
    StopWork();
    _worker = new BackgroundWorkerEx { 
        WorkerSupportsCancellation = true,
        WorkerReportsProgress = true
    };
    _worker.DoWork += Worker_DoWork;
    _worker.ProgressChanged += Worker_ProgressChanged;
}

void StopWork()
{
    if (_worker != null) {
        _worker.CancelSync(); // Use our new method.
    }
}

private void Worker_DoWork(object sender, DoWorkEventArgs e)
{
    for (int i = 1; i <= 20; i++) {
        if (worker.CancellationPending) {
            e.Cancel = true;
            break;
        } else {
            // Simulate a time consuming operation.
            System.Threading.Thread.Sleep(500);
            worker.ReportProgress(5 * i);
        }
    }
}

private void Worker_ProgressChanged(object sender, ProgressChangedEventArgs e)
{
    progressLabel.Text = e.ProgressPercentage.ToString() + "%";
} 
```

您还可以向`RunWorkerCompleted`事件添加处理程序，如下所示：
     [BackgroundWorker 类](http://msdn.microsoft.com/en-us/library/System.ComponentModel.BackgroundWorker%28v=vs.110%29.aspx) *（Microsoft 文档）*。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-04-28T23:17:16.193

关闭表单会关闭我打开的日志文件。我的后台工作人员编写了该日志文件，因此在我的后台工作人员终止之前我不能让`MainWin_FormClosing()`完成。如果我不等待我的后台工作人员终止，就会发生异常。

为什么这么难？

一个简单的`Thread.Sleep(1500)`工作，但它延迟关闭（如果太长），或导致异常（如果太短）。

要在后台工作人员终止后立即关闭，只需使用一个变量。这对我有用：

```
private volatile bool bwRunning = false;

...

private void MainWin_FormClosing(Object sender, FormClosingEventArgs e)
{
    ... // Clean house as-needed.

    bwInstance.CancelAsync();  // Flag background worker to stop.
    while (bwRunning)
        Thread.Sleep(100);  // Wait for background worker to stop.
}  // (The form really gets closed now.)

...

private void bwBody(object sender, DoWorkEventArgs e)
{
    bwRunning = true;

    BackgroundWorker bw = sender as BackgroundWorker;

    ... // Set up (open logfile, etc.)

    for (; ; )  // infinite loop
    {
        ...
        if (bw.CancellationPending) break;
        ...
    } 

    ... // Tear down (close logfile, etc.)

    bwRunning = false;
}  // (bwInstance dies now.) 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-11-27T22:56:45.497

您可以背负 RunWorkerCompleted 事件。即使您已经为 _worker 添加了事件处理程序，您也可以添加另一个事件处理程序，它们将按照添加顺序执行。

```
public class DoesStuff
{
    BackgroundWorker _worker = new BackgroundWorker();

    ...

    public void CancelDoingStuff()
    {
        _worker.RunWorkerCompleted += new RunWorkerCompletedEventHandler((sender, e) => 
        {
            // do whatever you want to do when the cancel completes in here!
        });
        _worker.CancelAsync();
    }
} 
```

如果您有多种原因导致可能发生取消，这可能会很有用，这会使单个 RunWorkerCompleted 处理程序的逻辑比您想要的更复杂。例如，当用户尝试关闭表单时取消：

```
void Form1_FormClosing(object sender, FormClosingEventArgs e)
{
    if (_worker != null)
    {
        _worker.RunWorkerCompleted += new RunWorkerCompletedEventHandler((sender, e) => this.Close());
        _worker.CancelAsync();
        e.Cancel = true;
    }
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-03-29T22:11:19.743

我使用`async`方法并`await`等待工人完成工作：

```
 public async Task StopAsync()
    {
        _worker.CancelAsync();

        while (_isBusy)
            await Task.Delay(1);
    } 
```

并在`DoWork`方法中：

```
 public async Task DoWork()
    {
        _isBusy = true;
        while (!_worker.CancellationPending)
        {
            // Do something.
        }
        _isBusy = false;
    } 
```

您也可以将`while`循环封装在`DoWork`其中`try ... catch`以设置`_isBusy`异常`false`。`_worker.IsBusy`或者，只需检查`StopAsync`while 循环。

下面是一个完整实现的例子：

```
class MyBackgroundWorker
{
    private BackgroundWorker _worker;
    private bool _isBusy;

    public void Start()
    {
        if (_isBusy)
            throw new InvalidOperationException("Cannot start as a background worker is already running.");

        InitialiseWorker();
        _worker.RunWorkerAsync();
    }

    public async Task StopAsync()
    {
        if (!_isBusy)
            throw new InvalidOperationException("Cannot stop as there is no running background worker.");

        _worker.CancelAsync();

        while (_isBusy)
            await Task.Delay(1);

        _worker.Dispose();
    }

    private void InitialiseWorker()
    {
        _worker = new BackgroundWorker
        {
            WorkerSupportsCancellation = true
        };
        _worker.DoWork += WorkerDoWork;
    }

    private void WorkerDoWork(object sender, DoWorkEventArgs e)
    {
        _isBusy = true;
        try
        {
            while (!_worker.CancellationPending)
            {
                // Do something.
            }
        }
        catch
        {
            _isBusy = false;
            throw;
        }

        _isBusy = false;
    }
} 
```

要停止工作人员并等待它运行到最后：

```
await myBackgroundWorker.StopAsync(); 
```

这种方法的问题是：

1.  您必须一直使用异步方法。
2.  await Task.Delay 不准确。在我的 PC 上，Task.Delay(1) 实际上等待了大约 20 毫秒。

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2008-09-24T19:57:11.160

哦，伙计，其中一些变得非常复杂。您需要做的就是检查 DoWork 处理程序中的 BackgroundWorker.CancellationPending 属性。您可以随时查看。一旦挂起，设置 e.Cancel = True 并退出该方法。

// 这里的方法 private void Worker_DoWork(object sender, DoWorkEventArgs e) { BackgroundWorker bw = (sender as BackgroundWorker);

```
// do stuff

if(bw.CancellationPending)
{
    e.Cancel = True;
    return;
}

// do other stuff 
```

}

# openid - OpenID是如何实现的？

> ID：123671
> 
> 赞同：20
> 
> 时间：2008-09-23T20:33:39.830
> 
> 标签：openid, dotnetopenauth

**您将如何设计和实现 OpenID 组件？**

（是“OpenId 是如何工作的”）

我意识到这个问题有点[重复](https://stackoverflow.com/questions/69076/openid-login-workflow)，是的，我已经阅读[了规范](http://openid.net/specs/openid-authentication-2_0.html)和[维基百科文章](http://en.wikipedia.org/wiki/OpenID)。

在阅读了上面提到的材料之后，我仍然没有完整地了解流程中的每个步骤是如何处理的。也许缺少的是关于 OpenID 实现如何工作的良好工作流程图。

我正在考虑将 OpenID 合并到我的一个应用程序中以适应 B2B 单点登录场景，我可能会使用[DotNetOpenID](http://code.google.com/p/dotnetopenid/)而不是自己尝试实现它，但我仍然希望在我得到之前更好地掌握细节开始了。

任何人都可以推荐可以很好地解释这一切的书籍或网站吗？在本网站上找到涵盖基础知识的答案也不会有什么坏处。

[编辑]

我将标题更改为更具体的实现，因为显然有很多地方可以获得一万英尺的视图。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T21:21:37.377

[这个页面](http://enthusiasm.cozy.org/archives/2005/05/openid-part-iii-pingpong/)有一个很好的流程图。

[我在OpenID Wiki](http://wiki.openid.net/w/page/12995226/Run%20your%20own%20identity%20server)上找到了这个链接，您可能想在那里查看更多资源。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T21:50:56.853

我推荐 Joseph Smarr 的[OpenID 启用您的网站的食谱](http://www.plaxo.com/api/openid_recipe)。

我还没有阅读 DotNetOpenID 文档，但我希望您选择的任何实现也有一些概述文档和/或示例来说明 API 的使用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T20:39:19.427

查看 Security Now 播客，[第 95 集](http://www.grc.com/sn/notes-095.htm)。（[实际上是音频](http://www.grc.com/securitynow.htm#95)）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T20:45:17.760

Jeff 有一篇关于 OpenID 的精彩文章，他在其中分享了他的经验：

[OpenID：世界真的需要另一个用户名和密码吗？](http://www.codinghorror.com/blog/archives/001121.html)

OpenID 官方网站上有一些教程链接：

[http://openid.net/developers/](http://openid.net/developers/)

你可以在这里获得一个很好的 OpenID 登录控件（也用于 stackoverflow）：

[http://www.idselector.com/](http://www.idselector.com/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T20:53:59.377

还有相关的：

[迪克哈特关于身份 2.0](http://identity20.com/media/OSCON2005/)的超级著名演讲，我想几乎每个人都看过，但如果你没有看过，那它是必看的。

不过，这更多是关于诸如 Open ID 之类的需求的推理，而不一定是关于它们的实现。

# csv - 在 SSRS 2005 中导出制表符分隔的文件

> ID：123672
> 
> 赞同：2
> 
> 时间：2008-09-23T20:33:44.183
> 
> 标签：csv, reporting-services, reportingservices-2005

在[这篇 MSDN 文章中](http://msdn.microsoft.com/en-us/library/ms155365%28SQL.90%29.aspx)，MS 解释了如何为 SSRS 2005 的 csv 类型导出指定除逗号之外的其他分隔符，但是，配置文件解析器会去除文字制表符，而且 MS 似乎没有提供解决方法。
[Microsoft Connect 上的此条目](http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=357527)似乎证实了这一点。
有没有人开发了一种从 SSRS 2005 导出制表符分隔文件的方法？
或者也许开发了一个开源自定义渲染器来完成工作？

注意：我听说过`&rc:FieldDelimiter=%09`通过 URL 访问手动附加，但这对我的用户来说不是可接受的解决方法，而且似乎也不起作用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-20T19:57:26.787

如果有人需要它，这对我来说效果很好。

```
<Extension Name="Tabs" Type="Microsoft.ReportingServices.Rendering.DataRenderer.CsvReport,Microsoft.ReportingServices.DataRendering">
  <OverrideNames>
    <Name Language="en-US">Tab-delimited</Name>
  </OverrideNames>
  <Configuration>
    <DeviceInfo>
      <OutputFormat>TXT</OutputFormat>
      <Encoding>ASCII</Encoding>
      <FieldDelimiter>&#9;</FieldDelimiter>
      <!-- or as this -->
      <!-- <FieldDelimiter xml:space="preserve">[TAB]</FieldDelimiter> -->
      <FileExtension>txt</FileExtension>
    </DeviceInfo>
  </Configuration>
</Extension> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T23:21:27.027

我使用选择查询来格式化数据并使用 BCP 将数据提取到文件中。在我的例子中，我将它全部封装在一个存储过程中，并使用 SQL 代理安排它在特定时间删除文件。基本编码类似于：

```
use tempdb
go
create view vw_bcpMasterSysobjects
as
   select
      name = '"' + name + '"' ,
      crdate = '"' + convert(varchar(8), crdate, 112) + '"' ,
      crtime = '"' + convert(varchar(8), crdate, 108) + '"'
   from master..sysobjects
go
declare @sql varchar(8000)
select @sql = 'bcp "select * from tempdb..vw_bcpMasterSysobjects
                     order by crdate desc, crtime desc"
               queryout c:\bcp\sysobjects.txt -c -t, -T -S'
                                             + @@servername
exec master..xp_cmdshell @sql 
```

请查看出色的帖子[created-csv-files-using-bcp-and-stored-procedures](http://www.simple-talk.com/sql/database-administration/creating-csv-files-using-bcp-and-stored-procedures/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T16:27:35.940

我目前的**解决方法**是添加一个自定义 CSV 扩展，如下所示：

```
<Extension Name="Tabs" Type="Microsoft.ReportingServices.Rendering.CsvRenderer.CsvReport,Microsoft.ReportingServices.CsvRendering">
    <OverrideNames>
        <Name Language="en-US">Tab-delimited (requires patch)</Name>
    </OverrideNames>
    <Configuration>
        <DeviceInfo>
            <Encoding>ASCII</Encoding>
            <FieldDelimiter>REPLACE_WITH_TAB</FieldDelimiter>
            <Extension>txt</Extension>
        </DeviceInfo>
    </Configuration>
</Extension> 
```

...您可以看到我使用文本“REPLACE_WITH_TAB”作为我的字段分隔符，然后我使用一个简单**的独立于平台的**Perl 脚本来执行类似 sed 的修复：

```
# all .txt files in the working directory
@files = <*.txt>;

foreach $file (@files) {
    $old = $file;
    $new = "$file.temp";

    open OLD, "<", $old or die $!;
    open NEW, ">", $new or die $!;

    while (my $line = <OLD>) {

        # SSRS 2005 SP2 can't output tab-delimited files
        $line =~ s/REPLACE_WITH_TAB/\t/g;

        print NEW $line;
    }

    close OLD or die $!;
    close NEW or die $!;

    rename($old, "$old.orig");
    rename($new, $old);
} 
```

这绝对是一个 hack，但它以一种相当**非侵入性的**方式完成了工作。它只需要：

*   安装在用户机器上的 Perl
*   用户可以将 .pl 脚本拖到 .txt 文件的目录中
*   用户双击 .pl 脚本的能力

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T03:23:11.237

叫我傻先生，但从存储过程或 SQL 语句返回 XML 不是更简单吗？XSLT 到 CSV 的转换是微不足道的。

或者您可以编写一个同样简单的 ASP.NET 页面，该页面使用 ADO.NET 获取数据，清除输出流，将 mime 类型设置为 text/csv 并将 CSV 写入其中。

糟糕，我看到您想要逗号以外的分隔*符*。但是上述两种解决方案仍然可以应用。如果您采用 ASP 方式，您可以有一个参数页面，让他们选择他们选择的分隔符。

# oop - 我应该更关心包之间或分发单元之间的耦合吗？

> ID：123687
> 
> 赞同：2
> 
> 时间：2008-09-23T20:36:53.897
> 
> 标签：oop, coupling

我一直在研究[耦合](http://www.ibm.com/developerworks/java/library/j-cq04256/)指标，还研究了[DSM](http://en.wikipedia.org/wiki/Dependency_Structure_Matrix)。

我一直在使用的工具之一着眼于“模块”与作为分发单元的模块之间的耦合（在本例中为 .net 程序集）。

我觉得我应该对查看包（或命名空间）之间的耦合比关注分发单元更感兴趣。

我应该更关心包/命名空间之间的耦合（确保抽象只依赖于抽象，具体类型依赖于抽象并且它们在依赖关系中没有循环，因此重构和扩展很容易）还是应该关心我是否可以无需更新未更改的分发单元即可部署新版本？

别人衡量什么？

对于它的价值，我的直觉是，如果我专注于包/命名空间耦合，那么分发耦合单元将免费或至少更容易。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T21:04:17.183

首先，很容易过分关注依赖和耦合。确保你没有过度复杂化。

有了免责声明，这就是我的建议。

依赖/耦合管理实际上有 3 种不同的视图：1）物理结构（即程序集依赖） 2）逻辑结构（即命名空间依赖） 3）实现结构（即类依赖）

对于大型应用程序，您至少需要检查所有 3 个，但您通常可以优先考虑。

对于客户端部署的应用程序，数字 1 可能非常重要（即对于插件之类的东西）。对于部署在企业内部的应用程序（即 asp.net），第 1 项通常证明不是那么重要（不包括跨多个应用程序重用的框架）。您通常可以很容易地部署整个应用程序，而不必为 #1 承担复杂结构的开销。

第 2 项往往是一个可维护性问题。了解您的层边界及其与命名空间的关系（即，您是在每个命名空间做 1 层，还是在逻辑级别以不同方式打包）。有时，工具可以通过查看逻辑依赖结构来帮助您强制执行层边界。

Item #3 真的是关于做好类设计。每个优秀的开发人员都应该付出相当多的努力来确保他只在他的类中承担适当的依赖关系。这说起来容易做起来难，通常是一项必须随着时间的推移而获得的技能。

为了更接近您问题的核心，第 1 项实际上是关于项目在 VS 解决方案中的布局方式。所以这不是一个要衡量的项目。它更多的是您在开始时设置并运行的东西。第 2 项是您可以在构建期间使用工具检查的内容，以查看开发人员是否违反了任何规则。实际上，这更像是一种检查而不是一种措施。第 3 项确实是您想要仔细查看测量的项。在您的代码库中查找具有大量耦合的类将成为未来的痛点，确保这些人的质量。此外，在这个级别进行测量可以让您对代码库的质量（整体）有一些了解，因为它正在发展。此外，如果有人将一些非常粗俗的代码检查到您的代码库中，它会给您一个危险信号。

因此，如果您想确定优先级，请快速查看#1 和#2。知道他们应该是什么样子。但对于大多数应用程序来说，第 3 项应该花费的时间最多。

当然，这个答案不包括大型框架（如 .NET BCL）。那些婴儿需要非常小心地注意#1。:-)

否则，您最终会遇到这样的问题：“.NET Framework 的当前版本包括各种基于 GUI 的库，这些库在 Server Core 中无法正常工作” [http://www.winsupersite.com/showcase/win2008_ntk。 ASP](http://www.winsupersite.com/showcase/win2008_ntk.asp)

您无法在 Windows Server 2008 的无 GUI 安装上运行 .NET，因为该框架依赖于 GUI 库...

最后一件事。确保您熟悉良好的依赖/耦合管理背后的原则。你可以在这里找到一个不错的列表：

[http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod](http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T20:54:05.337

分发单元之间的耦合和依赖循环更加“致命”，因为它会使部署程序变得非常困难 - 有时它甚至会使编译程序变得非常困难。

你是对的，一个好的顶层设计将代码划分为逻辑包和清晰和预定义的依赖关系只会让你大部分时间，唯一缺少的是将包正确分离为分布单元。

# winforms - 当应用程序关闭时，无模式的 VB6 应用程序如何进行清理？

> ID：123688
> 
> 赞同：1
> 
> 时间：2008-09-23T20:36:55.173
> 
> 标签：winforms, vb6, interop, com-interop

一个 VB6 应用程序正在使用 Interop Forms Toolkit 来处理用 .NET 编写的表单。工具包的文档建议在 VB6 应用程序关闭时调用工具包上的方法来通知工具包。

VB6 应用程序使用加载初始屏幕的 Sub Main 过程，然后显示几个无模式窗体。当 Sub Main 完成时，应用程序仍在运行。应用程序如何检测到它正在关闭并调用 Toolkit 上的清理方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T20:42:50.840

在一个模块（可能与包含 Sub Main 的模块相同）中，创建一个公共 sub（例如 AppCleanUp）来保存您的清理代码。

为您的项目添加一个类（例如 clsAppCleanup）。在这个类中，在调用您在上一步中创建的 sub 的 Class_Terminate 事件处理程序中添加代码。

在一个模块中（可能与包含 Sub Main 的模块相同），定义一个 clsAppCleanup 变量。

在 Sub Main 中，实例化 clsAppCleanup。

当应用程序关闭时，类上的终止事件将导致清理代码运行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T20:42:23.633

自从我用 VB6 编写以来已经有一段时间了，但如果我没记错的话，您可以使用 Unload 事件来调用您的清理代码（它类似于 .net 中的关闭事件）。您还可以检查 VB6 应用程序中是否没有其他窗体仍在运行

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T21:11:48.487

创建一个包含 FormCount 变量的模块。此变量将由应用程序中的所有表单共享。在每个表单的 Form_Initialize 方法中增加 FormCount 变量。在每个表单的 Form_Terminate 方法中减少 FormCount。当 FormCount 回落到 0 时，您可以通知您的表单工具包表单已被卸载。

您不必担心多线程问题，因为 VB6 创建了单线程应用程序，因此一个表单的 Initialize（或 Terminate）方法将在任何其他表单开始执行之前运行完成。

# .net - 存在哪些 CLR/.NET 字节码工具？

> ID：123690
> 
> 赞同：8
> 
> 时间：2008-09-23T20:37:31.820
> 
> 标签：.net, clr, bytecode, il

我非常了解用于操作、生成、反编译 JVM 字节码（ASM、cglib、jad 等）的 Java 工具。CLR 字节码有哪些类似的工具？人们是否为 CLR 进行字节码操作？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-23T20:39:30.613

Reflector 总是很好，但 Mono.Cecil 是您可能要求的最好的工具。它对于以任何方式操纵 CIL 都是非常宝贵的。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-18T16:34:26.917

[Mono.Cecil](http://www.mono-project.com/Cecil)是像 ASM 一样的出色工具。它是 Mono 的一个子项目，并且完全开源。它甚至提供比 System.Reflection[更好的功能。](http://codebetter.com/blogs/patricksmacchia/archive/2008/03/18/mono-cecil-vs-system-reflection.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T20:38:19.057

我想到了[ILDASM](http://msdn.microsoft.com/en-us/library/f7dy01k1(VS.80).aspx)和[Reflector 。](http://www.red-gate.com/products/reflector/index.htm)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T20:43:42.897

字节码是一种二进制格式。.NET 程序集在存储执行指令的方式上大不相同。

.NET 语言不是编译成类似字节码的结构，而是编译成一种中间语言（实际上，它只是被称为--IL）。

这是一种人类可读的语言，看起来有点像面向对象的汇编程序版本。

因此，在检查或操作单个程序集的 IL 方面，Reflector 和 ILDASM 等工具允许您方便地查看任何程序集的 IL。

操作有点不同，我建议看看 .NET 空间中的一些 AOP 工具。我还建议看看 Phoenix，这是 MS 正在开发的一个编译器项目。它有一些非常酷的编译后操作功能。

如果您想了解更多关于 .NET AOP 工具的信息，我建议您提出另一个问题（那是完全不同的蠕虫罐头）。

还有几本书会教你 IL 的来龙去脉。这不是一门非常复杂的语言。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-06T10:27:57.867

[NDepend](http://ndepend.com/)允许您进行 .NET 程序集静态分析（代码指标、依赖性分析等）。[NDepend 对于使用依赖矩阵、依赖图和树状图度量可视化](http://ndepend.com/Screenshots.aspx)来了解 .NET 程序集的结构非常有用。

它还与 Reflector 集成：例如，您可以分别使用 Type/Method [Rank 度量](http://ndepend.com/Metrics.aspx#TypeRank)（类似于 Google Page Rank 的代码度量）检测程序集中的重要类型和方法，并直接从 NDepend 跳转到 Reflector 以获取反汇编C#、VB.NET 等中的代码

# wpf - 省略文本

> ID：123714
> 
> 赞同：1
> 
> 时间：2008-09-23T20:40:55.697
> 
> 标签：wpf

我有一个带有用户选择的目录路径的标签。当然，有些路径比其他路径更长。我在 Label 所在的控件上使用[Resizer](http://kentb.blogspot.com/2007/04/resizer-wpf-control.html)，如果我可以对路径进行可变省略，我会喜欢它。

*c:\very\long\path\to\a\filename.txt*折叠到*c:...\filename.txt*或*c:\very...\filename.txt。* 你得到了图片 - 更大的窗口提供更多信息，将其缩小，你仍然可以获得路径的重要部分。如果我不需要自定义控件，我会喜欢它，但我可以忍受它。

[WPF 中的自定义文本换行](https://stackoverflow.com/questions/108689/custom-text-wrapping-in-wpf)似乎可以完成这项工作，但我希望有更简单的东西。

编辑对不起，我的意思是我希望省略根据标签的宽度而变化。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T07:14:34.643

你给出的那个例子是针对非矩形容器的。如果不需要，可以使用值转换器。如果它比标签大，你把省略号：

未测试示例：

```
class EllipsisConverter : IValueConverter
{
    #region IValueConverter Members

    public object Convert(object value,
 Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
     string path = (string)value;

if (path.Length > 100)
{
return path.Substring(0, 100) + "...";   
}else{
   return path;
}
    }

    public object ConvertBack(object value, 
Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        throw new NotImplementedException();
    }

    #endregion
} 
```

# php - Php 检查是否声明了静态类

> ID：123718
> 
> 赞同：9
> 
> 时间：2008-09-23T20:41:15.210
> 
> 标签：php, object, static

如何检查是否已声明静态类？ex 给定班级

```
class bob {
    function yippie() {
        echo "skippie";
    }
} 
```

稍后在代码中我如何检查：

```
if(is_a_valid_static_object(bob)) {
    bob::yippie();
} 
```

所以我没有得到：致命错误：第 3 行的 file.php 中找不到类 'bob'

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-23T20:56:02.117

即使没有实例化类，您也可以检查特定方法的存在

```
echo method_exists( bob, 'yippie' ) ? 'yes' : 'no'; 
```

如果您想更进一步并验证“yippie”实际上是静态的，请使用[反射 API](http://us3.php.net/language.oop5.reflection)（仅限 PHP5）

```
try {
    $method = new ReflectionMethod( 'bob::yippie' );
    if ( $method->isStatic() )
    {
        // verified that bob::yippie is defined AND static, proceed
    }
}
catch ( ReflectionException $e )
{
    //  method does not exist
    echo $e->getMessage();
} 
```

或者，您可以结合这两种方法

```
if ( method_exists( bob, 'yippie' ) )
{
    $method = new ReflectionMethod( 'bob::yippie' );
    if ( $method->isStatic() )
    {
        // verified that bob::yippie is defined AND static, proceed
    }
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-23T20:42:44.740

[`bool class_exists( string $class_name [, bool $autoload ]`)](http://us2.php.net/class_exists)

> 这个函数检查给定的类是否已经定义。

# asp.net-mvc - 使用 ASP.NET MVC 的 json 请求的 401 响应代码

> ID：123726
> 
> 赞同：35
> 
> 时间：2008-09-23T20:42:19.343
> 
> 标签：asp.net-mvc

如何为 AJAX/JSON 请求禁用标准 ASP.NET 处理 401 响应代码（重定向到登录页面）？

对于网页，没关系，但对于 AJAX，我需要为登录页面获取正确的 401 错误代码，而不是好看的 302/200。

**更新**： ASP.NET MVC 的 PM Phil Haack 提供了几种解决方案 - [http://haacked.com/archive/2011/10/04/prevent-forms-authentication-login-page-redirect-when-you-donrsquot -want.aspx](http://haacked.com/archive/2011/10/04/prevent-forms-authentication-login-page-redirect-when-you-donrsquot-want.aspx)

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-07-02T07:37:45.530

在经典的 ASP.NET 中，使用 Ajax 调用 WebMethod 时会收到 401 http 响应代码。我希望他们会在 ASP.NET MVC 的未来版本中对其进行更改。现在我正在使用这个黑客：

```
protected void Application_EndRequest()
{
    if (Context.Response.StatusCode == 302 && Context.Request.Headers["X-Requested-With"] == "XMLHttpRequest")
    {
        Context.Response.Clear();
        Context.Response.StatusCode = 401;
    }
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-24T22:26:08.647

开发了 ASP.NET 运行时，如果设置为 401，它总是会重定向用户`HttpResponse.StatusCode`，但`<authentication />`前提是找到 Web.config 的部分。

删除身份验证部分将要求您在属性中实现到登录页面的重定向，但这应该没什么大不了的。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-06-18T06:01:09.147

我想要表单身份验证并为未经过身份验证的 Ajax 请求返回 401。

最后，我创建了一个自定义 AuthorizeAttribute 并修饰了控制器方法。（这是在.Net 4.5上）

//web.config

```
<authentication mode="Forms">
</authentication> 
```

//控制器

```
[Authorize(Roles = "Administrator,User"), Response302to401]
[AcceptVerbs("Get")]
public async Task<JsonResult> GetDocuments()
{
    string requestUri = User.Identity.Name.ToLower() + "/document";
    RequestKeyHttpClient<IEnumerable<DocumentModel>, string> client =
        new RequestKeyHttpClient<IEnumerable<DocumentModel>, string>(requestUri);

    var documents = await client.GetManyAsync<IEnumerable<DocumentModel>>();

    return Json(documents, JsonRequestBehavior.AllowGet);
} 
```

//授权属性

```
public class Response302to401 : AuthorizeAttribute
{
    protected override void HandleUnauthorizedRequest(AuthorizationContext filterContext)
    {
        if (!filterContext.HttpContext.User.Identity.IsAuthenticated)
        {
            if (filterContext.HttpContext.Request.IsAjaxRequest())
            {
                filterContext.Result = new JsonResult
                {
                    Data = new { Message = "Your session has died a terrible and gruesome death" },
                    JsonRequestBehavior = JsonRequestBehavior.AllowGet
                };
                filterContext.HttpContext.Response.StatusCode = 401;
                filterContext.HttpContext.Response.StatusDescription = "Humans and robots must authenticate";
                filterContext.HttpContext.Response.SuppressFormsAuthenticationRedirect = true;
            }
        }
        //base.HandleUnauthorizedRequest(filterContext);
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-22T20:36:38.827

你也可以使用 Global.asax 来中断这个过程，如下所示：

```
 protected void Application_PreSendRequestHeaders(object sender, EventArgs e) {
        if (Response.StatusCode == 401) {
            Response.Clear();
            Response.Redirect(Response.ApplyAppPathModifier("~/Login.aspx"));
            return;
        }
    } 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-12-19T21:33:40.470

我看不出我们必须像当前答案所说的那样修改身份验证模式或身份验证标签。

遵循@TimothyLeeRussell 的想法（顺便谢谢），我创建了一个自定义的 Authorize 属性（@TimothyLeeRussell 的问题是抛出异常，因为他试图更改生成 HttpException 的 filterContext.Result 和删除该部分，除了 filterContext.HttpContext.Response.StatusCode = 401，响应代码始终为 200 OK）。所以我最终通过在更改后结束响应来解决问题。

```
[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method)]
public class BetterAuthorize : AuthorizeAttribute
{
    protected override void HandleUnauthorizedRequest(AuthorizationContext filterContext)
    {
        if (filterContext.HttpContext.Request.IsAjaxRequest())
        {
            //Set the response status code to 500
            filterContext.HttpContext.Response.StatusCode = (int)HttpStatusCode.Unauthorized;
            filterContext.HttpContext.Response.StatusDescription = "Humans and robots must authenticate";
            filterContext.HttpContext.Response.SuppressFormsAuthenticationRedirect = true;

            filterContext.HttpContext.Response.End();
        }
        else
            base.HandleUnauthorizedRequest(filterContext);
    }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-03-31T09:31:50.123

您可以在您的操作中调用此方法，

```
 HttpContext.Response.End(); 
```

例子

```
public async Task<JsonResult> Return401()
{
    HttpContext.Response.StatusCode = (int)HttpStatusCode.Unauthorized;
    HttpContext.Response.End();
    return Json("Unauthorized", JsonRequestBehavior.AllowGet);
} 
```

来自[MSDN](https://msdn.microsoft.com/en-us/library/ms524629%28v=vs.90%29.aspx)：End 方法导致 Web 服务器停止处理脚本并返回当前结果。不处理文件的其余内容。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T13:02:28.410

您可以选择创建自定义`FilterAttribute`实现`IAuthorizationFilter`接口。

在此属性中，您添加逻辑以确定请求是否应该返回 JSON。如果是这样，您可以在用户未登录的情况下返回一个空的 JSON 结果（或做任何您喜欢的事情）。对于其他响应，您只需像往常一样重定向用户。

更好的是，你可以重写类的`OnAuthorization`，`AuthorizeAttribute`这样你就不必重新发明轮子了。`filterContext.Cancel`添加我上面提到的逻辑，如果为真则拦截（`filterContext.Result`将设置为`HttpUnauthorizedResult`类的实例。

在 Phil Haacks 博客上阅读有关[“ASP.NET MVC CodePlex Preview 4 中的过滤器”的更多信息。](http://haacked.com/archive/2008/08/14/aspnetmvc-filters.aspx)它也适用于最新的预览版。

# c++ - 如何删除类似的 const 和非常量成员函数之间的代码重复？

> ID：123758
> 
> 赞同：287
> 
> 时间：2008-09-23T20:47:11.110
> 
> 标签：c++, class, constants, code-duplication, c++-faq

假设我有以下`class X`要返回对内部成员的访问权限的地方：

```
class Z
{
    // details
};

class X
{
    std::vector<Z> vecZ;

public:
    Z& Z(size_t index)
    {
        // massive amounts of code for validating index

        Z& ret = vecZ[index];

        // even more code for determining that the Z instance
        // at index is *exactly* the right sort of Z (a process
        // which involves calculating leap years in which
        // religious holidays fall on Tuesdays for
        // the next thousand years or so)

        return ret;
    }
    const Z& Z(size_t index) const
    {
        // identical to non-const X::Z(), except printed in
        // a lighter shade of gray since
        // we're running low on toner by this point
    }
}; 
```

这两个成员函数在大括号`X::Z()`内`X::Z() const`具有相同的代码。这是重复的代码**，可能会导致逻辑复杂的长函数出现维护问题**。

有没有办法避免这种代码重复？

* * *

## 回答 #1

> 赞同：221
> 
> 时间：2008-09-23T21:24:13.750

有关详细说明，请参阅第 10 页的标题“避免重复`const`和非`const`成员函数”。23，在第 3 项“`const`尽可能使用”中，在[*Effective C++*](https://www.aristeia.com/books.html)中，由 Scott Meyers 编辑的第 3 版，ISBN-13：9780321334879 [。](https://www.aristeia.com/books.html)

![替代文字](https://images-na.ssl-images-amazon.com/images/I/71lC2NLUvuL._AC_UL115_.jpg)

这是迈耶斯的解决方案（简化）：

```
struct C {
  const char & get() const {
    return c;
  }
  char & get() {
    return const_cast<char &>(static_cast<const C &>(*this).get());
  }
  char c;
}; 
```

这两个强制转换和函数调用可能很难看，但在非`const`方法中是正确的，因为这意味着该对象不是`const`开始的。（迈耶斯对此进行了彻底的讨论。）

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2017-11-18T17:51:58.977

C++17 更新了这个问题的最佳答案：

```
T const & f() const {
    return something_complicated();
}
T & f() {
    return const_cast<T &>(std::as_const(*this).f());
} 
```

这样做的好处是：

*   很明显发生了什么
*   具有最小的代码开销——它适合一行
*   很难出错（只能`volatile`被意外抛弃，但是`volatile`是罕见的限定词）

如果你想走完整的扣除路线，那么可以通过一个辅助函数来完成

```
template<typename T>
constexpr T & as_mutable(T const & value) noexcept {
    return const_cast<T &>(value);
}
template<typename T>
constexpr T * as_mutable(T const * value) noexcept {
    return const_cast<T *>(value);
}
template<typename T>
constexpr T * as_mutable(T * value) noexcept {
    return value;
}
template<typename T>
void as_mutable(T const &&) = delete; 
```

现在你甚至不能搞砸了`volatile`，用法看起来像

```
decltype(auto) f() const {
    return something_complicated();
}
decltype(auto) f() {
    return as_mutable(std::as_const(*this).f());
} 
```

* * *

## 回答 #3

> 赞同：72
> 
> 时间：2008-09-23T20:48:04.197

是的，可以避免代码重复。您需要使用 const 成员函数来拥有逻辑并让非常量成员函数调用 const 成员函数并将返回值重新转换为非常量引用（如果函数返回指针，则为指针）：

```
class X
{
   std::vector<Z> vecZ;

public:
   const Z& z(size_t index) const
   {
      // same really-really-really long access 
      // and checking code as in OP
      // ...
      return vecZ[index];
   }

   Z& z(size_t index)
   {
      // One line. One ugly, ugly line - but just one line!
      return const_cast<Z&>( static_cast<const X&>(*this).z(index) );
   }

 #if 0 // A slightly less-ugly version
   Z& Z(size_t index)
   {
      // Two lines -- one cast. This is slightly less ugly but takes an extra line.
      const X& constMe = *this;
      return const_cast<Z&>( constMe.z(index) );
   }
 #endif
}; 
```

**注意：**重要的是**不要**将逻辑放在非常量函数中并且让常量函数调用非常量函数 - 这可能会导致未定义的行为。原因是常量类实例被强制转换为非常量实例。非常量成员函数可能会意外修改类，C++ 标准规定这将导致未定义的行为。

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2013-05-27T20:43:51.590

我认为 Scott Meyers 的解决方案可以通过使用 tempate 辅助函数在 C++11 中得到改进。这使得意图更加明显，并且可以被许多其他 getter 重用。

```
template <typename T>
struct NonConst {typedef T type;};
template <typename T>
struct NonConst<T const> {typedef T type;}; //by value
template <typename T>
struct NonConst<T const&> {typedef T& type;}; //by reference
template <typename T>
struct NonConst<T const*> {typedef T* type;}; //by pointer
template <typename T>
struct NonConst<T const&&> {typedef T&& type;}; //by rvalue-reference

template<typename TConstReturn, class TObj, typename... TArgs>
typename NonConst<TConstReturn>::type likeConstVersion(
   TObj const* obj,
   TConstReturn (TObj::* memFun)(TArgs...) const,
   TArgs&&... args) {
      return const_cast<typename NonConst<TConstReturn>::type>(
         (obj->*memFun)(std::forward<TArgs>(args)...));
} 
```

可以通过以下方式使用此辅助函数。

```
struct T {
   int arr[100];

   int const& getElement(size_t i) const{
      return arr[i];
   }

   int& getElement(size_t i) {
      return likeConstVersion(this, &T::getElement, i);
   }
}; 
```

第一个参数始终是 this 指针。第二个是指向要调用的成员函数的指针。之后，可以传递任意数量的附加参数，以便将它们转发给函数。由于可变参数模板，这需要 C++11。

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2013-12-08T11:16:32.523

很好的问题和很好的答案。我有另一个解决方案，它不使用强制转换：

```
class X {

private:

    std::vector<Z> v;

    template<typename InstanceType>
    static auto get(InstanceType& instance, std::size_t i) -> decltype(instance.get(i)) {
        // massive amounts of code for validating index
        // the instance variable has to be used to access class members
        return instance.v[i];
    }

public:

    const Z& get(std::size_t i) const {
        return get(*this, i);
    }

    Z& get(std::size_t i) {
        return get(*this, i);
    }

}; 
```

但是，它的丑陋之处在于需要一个静态成员，并且需要在其中使用`instance`变量。

我没有考虑此解决方案的所有可能（负面）影响。如果有请告诉我。

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2008-09-23T22:02:52.287

比迈耶斯更冗长，但我可能会这样做：

```
class X {

    private:

    // This method MUST NOT be called except from boilerplate accessors.
    Z &_getZ(size_t index) const {
        return something;
    }

    // boilerplate accessors
    public:
    Z &getZ(size_t index)             { return _getZ(index); }
    const Z &getZ(size_t index) const { return _getZ(index); }
}; 
```

私有方法有一个不受欢迎的属性，它为一个 const 实例返回一个非常量 Z&，这就是它是私有的原因。私有方法可能会破坏外部接口的不变量（在这种情况下，所需的不变量是“不能通过通过它获得的对它拥有的对象的引用来修改 const 对象”）。

请注意，注释是模式的一部分 - _getZ 的接口指定调用它永远无效（显然，除了访问器）：无论如何，这样做没有任何可以想象的好处，因为它需要多输入 1 个字符并且不会导致更小或更快的代码。调用该方法等同于使用 const_cast 调用其中一个访问器，您也不想这样做。如果您担心使错误变得明显（这是一个公平的目标），则将其称为 const_cast_getZ 而不是 _getZ。

顺便说一句，我很欣赏迈耶斯的解决方案。我对此没有哲学上的反对意见。不过，就个人而言，我更喜欢一点点受控的重复，以及只能在某些严格控制的情况下调用的私有方法，而不是看起来像线路噪音的方法。选择你的毒药并坚持下去。

[编辑：Kevin 正确地指出 _getZ 可能想要调用另一个方法（比如 generateZ），它与 getZ 一样是 const-specialized。在这种情况下，_getZ 会看到一个 const Z& 并且必须在返回之前对其进行 const_cast。这仍然是安全的，因为样板访问器会监控所有内容，但它的安全性并不是很明显。此外，如果您这样做，然后将 generateZ 更改为始终返回 const，那么您还需要将 getZ 更改为始终返回 const，但编译器不会告诉您这样做。

关于编译器的后一点也适用于 Meyers 推荐的模式，但关于非显而易见的 const_cast 的第一点不是。所以总的来说，我认为如果 _getZ 需要一个 const_cast 作为它的返回值，那么这种模式比 Meyers 的模式失去了很多价值。由于与迈耶斯相比，它也有劣势，我想在那种情况下我会改用他的。从一个重构到另一个很容易——它不会影响类中的任何其他有效代码，因为只有无效代码和样板调用_getZ。]

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-01-13T16:21:19.777

您也可以使用模板解决此问题。这个解决方案有点难看（但丑陋隐藏在 .cpp 文件中），但它确实提供了对 constness 的编译器检查，并且没有代码重复。

.h 文件：

```
#include <vector>

class Z
{
    // details
};

class X
{
    std::vector<Z> vecZ;

public:
    const std::vector<Z>& GetVector() const { return vecZ; }
    std::vector<Z>& GetVector() { return vecZ; }

    Z& GetZ( size_t index );
    const Z& GetZ( size_t index ) const;
}; 
```

.cpp 文件：

```
#include "constnonconst.h"

template< class ParentPtr, class Child >
Child& GetZImpl( ParentPtr parent, size_t index )
{
    // ... massive amounts of code ...

    // Note you may only use methods of X here that are
    // available in both const and non-const varieties.

    Child& ret = parent->GetVector()[index];

    // ... even more code ...

    return ret;
}

Z& X::GetZ( size_t index )
{
    return GetZImpl< X*, Z >( this, index );
}

const Z& X::GetZ( size_t index ) const
{
    return GetZImpl< const X*, const Z >( this, index );
} 
```

我可以看到的主要缺点是，因为该方法的所有复杂实现都在一个全局函数中，你要么需要使用上面的 GetVector() 等公共方法来获取 X 的成员（其中总是需要一个const 和非 const 版本），或者您可以将此函数设为朋友。但我不喜欢朋友。

[编辑：删除了测试期间添加的 cstdio 的不需要的包含。]

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2019-03-29T22:19:11.590

对于那些（像我一样）谁

*   使用**c++17**
*   想要添加**最少的样板**/重复和
*   不介意使用**宏**（在等待元类时......），

这是另一种看法：

```
#include <utility>
#include <type_traits>

template <typename T> struct NonConst;
template <typename T> struct NonConst<T const&> {using type = T&;};
template <typename T> struct NonConst<T const*> {using type = T*;};

#define NON_CONST(func)                                                     \
    template <typename... T> auto func(T&&... a)                            \
        -> typename NonConst<decltype(func(std::forward<T>(a)...))>::type   \
    {                                                                       \
        return const_cast<decltype(func(std::forward<T>(a)...))>(           \
            std::as_const(*this).func(std::forward<T>(a)...));              \
    } 
```

它基本上是来自@Pait、@DavidStone 和@sh1 的答案的混合（**编辑**：和@cdhowie 的改进）。它添加到表中的是，您只需多写一行代码即可轻松命名函数（但没有参数或返回类型重复）：

```
class X
{
    const Z& get(size_t index) const { ... }
    NON_CONST(get)
}; 
```

注意：gcc 在 8.1 之前无法编译，clang-5 及更高版本以及 MSVC-19 都很高兴（根据[编译器资源管理器](https://godbolt.org/z/PwGLN_)）。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2019-12-05T18:23:53.257

如果您不喜欢*const*强制转换，我使用[另一个答案](https://stackoverflow.com/a/20452784/1123898)建议的模板静态辅助函数的 C++17 版本，以及可选的 SFINAE 测试。

```
#include <type_traits>

#define REQUIRES(...)         class = std::enable_if_t<(__VA_ARGS__)>
#define REQUIRES_CV_OF(A,B)   REQUIRES( std::is_same_v< std::remove_cv_t< A >, B > )

class Foobar {
private:
    int something;

    template<class FOOBAR, REQUIRES_CV_OF(FOOBAR, Foobar)>
    static auto& _getSomething(FOOBAR& self, int index) {
        // big, non-trivial chunk of code...
        return self.something;
    }

public:
    auto& getSomething(int index)       { return _getSomething(*this, index); }
    auto& getSomething(int index) const { return _getSomething(*this, index); }
}; 
```

完整版：[https ://godbolt.org/z/mMK4r3](https://godbolt.org/z/mMK4r3)

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2021-06-23T12:42:15.923

虽然这里的大多数答案都建议使用 a `const_cast`，但 CppCoreGuidelines 有一个关于此的[部分](https://github.com/isocpp/CppCoreGuidelines/blob/bda7ff108fa5de35ec0a1411cc62ddbf2c1353b5/CppCoreGuidelines.md#es50-dont-cast-away-const)：

> 相反，更喜欢共享实现。通常，您可以让非常量函数调用 const 函数。但是，当存在复杂的逻辑时，这可能会导致以下仍然使用 const_cast 的模式：

```
class Foo {
public:
    // not great, non-const calls const version but resorts to const_cast
    Bar& get_bar()
    {
        return const_cast<Bar&>(static_cast<const Foo&>(*this).get_bar());
    }
    const Bar& get_bar() const
    {
        /* the complex logic around getting a const reference to my_bar */
    }
private:
    Bar my_bar;
}; 
```

> 尽管此模式在正确应用时是安全的，因为调用者必须以非常量对象开头，但它并不理想，因为安全性很难作为检查器规则自动执行。
> 
> 相反，更喜欢将通用代码放在通用辅助函数中——并将其作为模板，以便推导出 const。这根本不使用任何 const_cast ：

```
class Foo {
public:                         // good
          Bar& get_bar()       { return get_bar_impl(*this); }
    const Bar& get_bar() const { return get_bar_impl(*this); }
private:
    Bar my_bar;

    template<class T>           // good, deduces whether T is const or non-const
    static auto& get_bar_impl(T& t)
        { /* the complex logic around getting a possibly-const reference to my_bar */ }
}; 
```

> 注意：不要在模板内做大的非依赖工作，这会导致代码膨胀。例如，如果 get_bar_impl 的全部或部分可以是非依赖的并分解为一个通用的非模板函数，则进一步的改进可能会大大减少代码大小。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-23T22:05:02.873

将逻辑移动到私有方法中，并且只在 getter 中执行“获取引用并返回”内容怎么样？实际上，我会对简单 getter 函数中的静态和 const 强制转换感到相当困惑，除了极少数情况外，我认为这很丑陋！

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2017-01-14T02:33:05.173

使用预处理器是作弊吗？

```
struct A {

    #define GETTER_CORE_CODE       \
    /* line 1 of getter code */    \
    /* line 2 of getter code */    \
    /* .....etc............. */    \
    /* line n of getter code */       

    // ^ NOTE: line continuation char '\' on all lines but the last

   B& get() {
        GETTER_CORE_CODE
   }

   const B& get() const {
        GETTER_CORE_CODE
   }

   #undef GETTER_CORE_CODE

}; 
```

它不像模板或演员表那样花哨，但它确实使您的意图（“这两个函数要相同”）非常明确。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2019-06-20T22:09:31.970

令我惊讶的是，有这么多不同的答案，但几乎都依赖于沉重的模板魔法。模板很强大，但有时宏在简洁性方面胜过它们。通过将两者结合起来，通常可以实现最大的多功能性。

我写了一个宏`FROM_CONST_OVERLOAD()`，它可以放在非常量函数中来调用 const 函数。

## 示例用法：

```
class MyClass
{
private:
    std::vector<std::string> data = {"str", "x"};

public:
    // Works for references
    const std::string& GetRef(std::size_t index) const
    {
        return data[index];
    }

    std::string& GetRef(std::size_t index)
    {
        return FROM_CONST_OVERLOAD( GetRef(index) );
    }

    // Works for pointers
    const std::string* GetPtr(std::size_t index) const
    {
        return &data[index];
    }

    std::string* GetPtr(std::size_t index)
    {
        return FROM_CONST_OVERLOAD( GetPtr(index) );
    }
}; 
```

## 简单且可重用的实现：

```
template <typename T>
T& WithoutConst(const T& ref)
{
    return const_cast<T&>(ref);
}

template <typename T>
T* WithoutConst(const T* ptr)
{
    return const_cast<T*>(ptr);
}

template <typename T>
const T* WithConst(T* ptr)
{
    return ptr;
}

#define FROM_CONST_OVERLOAD(FunctionCall) \
  WithoutConst(WithConst(this)->FunctionCall) 
```

* * *

## 解释：

正如许多答案中所发布的，在非常量成员函数中避免代码重复的典型模式是：

```
return const_cast<Result&>( static_cast<const MyClass*>(this)->Method(args) ); 
```

使用类型推断可以避免很多这种样板。首先，`const_cast`可以封装在 中`WithoutConst()`，它推断其参数的类型并删除 const 限定符。其次，可以使用类似的方法来`WithConst()`对指针进行 const 限定`this`，从而可以调用 const 重载方法。

其余的是一个简单的宏，它在调用前加上正确限定的前缀，`this->`并从结果中删除 const。由于宏中使用的表达式几乎总是带有 1:1 转发参数的简单函数调用，因此不会出现诸如多重评估之类的宏的缺点。省略号和`__VA_ARGS__`也可以使用，但不应该需要，因为逗号（如参数分隔符）出现在括号内。

这种方法有几个好处：

*   最小且自然的语法——只需将调用包装在`FROM_CONST_OVERLOAD( )`
*   不需要额外的成员函数
*   兼容 C++98
*   简单的实现，没有模板元编程和零依赖
*   可扩展：可以添加其他 const 关系（如`const_iterator`、`std::shared_ptr<const T>`等）。为此，只需`WithoutConst()`对相应类型进行重载即可。

限制：此解决方案针对非常量重载与 const 重载完全相同的场景进行了优化，因此可以 1:1 转发参数。如果您的逻辑不同并且您没有通过调用 const 版本`this->Method(args)`，则可以考虑其他方法。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2021-10-07T18:44:17.557

由于[推断出](https://wg21.link/P0847R7)，C++23 更新了这个问题的最佳答案：

```
struct s {
    auto && f(this auto && self) {
        // all the common code goes here
    }
}; 
```

单个函数模板可作为普通成员函数调用，并为您推导出正确的引用类型。没有错误的转换，没有为概念上一件事的东西编写多个函数。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-10-07T14:25:20.647

我建议使用私有助手静态函数模板，如下所示：

```
class X
{
    std::vector<Z> vecZ;

    // ReturnType is explicitly 'Z&' or 'const Z&'
    // ThisType is deduced to be 'X' or 'const X'
    template <typename ReturnType, typename ThisType>
    static ReturnType Z_impl(ThisType& self, size_t index)
    {
        // massive amounts of code for validating index
        ReturnType ret = self.vecZ[index];
        // even more code for determining, blah, blah...
        return ret;
    }

public:
    Z& Z(size_t index)
    {
        return Z_impl<Z&>(*this, index);
    }
    const Z& Z(size_t index) const
    {
        return Z_impl<const Z&>(*this, index);
    }
}; 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-10-19T17:43:08.630

我想出了一个宏，它可以自动生成成对的 const/non-const 函数。

```
class A
{
    int x;    
  public:
    MAYBE_CONST(
        CV int &GetX() CV {return x;}
        CV int &GetY() CV {return y;}
    )

    //   Equivalent to:
    // int &GetX() {return x;}
    // int &GetY() {return y;}
    // const int &GetX() const {return x;}
    // const int &GetY() const {return y;}
}; 
```

请参阅答案的结尾以了解实施。

的参数`MAYBE_CONST`是重复的。在第一个副本中，`CV`被替换为空；在第二个副本中，它被替换为`const`.

`CV`宏参数中可以出现多少次没有限制。

不过有一点不便。如果`CV`出现在括号内，则这对括号必须以 为前缀`CV_IN`：

```
// Doesn't work
MAYBE_CONST( CV int &foo(CV int &); )

// Works, expands to
//         int &foo(      int &);
//   const int &foo(const int &);
MAYBE_CONST( CV int &foo CV_IN(CV int &); ) 
```

* * *

执行：

```
#define MAYBE_CONST(...) IMPL_CV_maybe_const( (IMPL_CV_null,__VA_ARGS__)() )
#define CV )(IMPL_CV_identity,
#define CV_IN(...) )(IMPL_CV_p_open,)(IMPL_CV_null,__VA_ARGS__)(IMPL_CV_p_close,)(IMPL_CV_null,

#define IMPL_CV_null(...)
#define IMPL_CV_identity(...) __VA_ARGS__
#define IMPL_CV_p_open(...) (
#define IMPL_CV_p_close(...) )

#define IMPL_CV_maybe_const(seq) IMPL_CV_a seq IMPL_CV_const_a seq

#define IMPL_CV_body(cv, m, ...) m(cv) __VA_ARGS__

#define IMPL_CV_a(...) __VA_OPT__(IMPL_CV_body(,__VA_ARGS__) IMPL_CV_b)
#define IMPL_CV_b(...) __VA_OPT__(IMPL_CV_body(,__VA_ARGS__) IMPL_CV_a)

#define IMPL_CV_const_a(...) __VA_OPT__(IMPL_CV_body(const,__VA_ARGS__) IMPL_CV_const_b)
#define IMPL_CV_const_b(...) __VA_OPT__(IMPL_CV_body(const,__VA_ARGS__) IMPL_CV_const_a) 
```

* * *

不支持的 Pre-C++20 实现`CV_IN`：

```
#define MAYBE_CONST(...) IMPL_MC( ((__VA_ARGS__)) )
#define CV ))((

#define IMPL_MC(seq) \
    IMPL_MC_end(IMPL_MC_a seq) \
    IMPL_MC_end(IMPL_MC_const_0 seq)

#define IMPL_MC_identity(...) __VA_ARGS__
#define IMPL_MC_end(...) IMPL_MC_end_(__VA_ARGS__)
#define IMPL_MC_end_(...) __VA_ARGS__##_end

#define IMPL_MC_a(elem) IMPL_MC_identity elem IMPL_MC_b
#define IMPL_MC_b(elem) IMPL_MC_identity elem IMPL_MC_a
#define IMPL_MC_a_end
#define IMPL_MC_b_end

#define IMPL_MC_const_0(elem)       IMPL_MC_identity elem IMPL_MC_const_a
#define IMPL_MC_const_a(elem) const IMPL_MC_identity elem IMPL_MC_const_b
#define IMPL_MC_const_b(elem) const IMPL_MC_identity elem IMPL_MC_const_a
#define IMPL_MC_const_a_end
#define IMPL_MC_const_b_end 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-23T21:11:44.763

通常，需要 const 和非 const 版本的成员函数是 getter 和 setter。大多数时候它们是单行的，所以代码重复不是问题。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-06-16T13:13:06.670

我这样做是为了一个有正当理由使用 ... 不知道的朋友做的`const_cast`，我可能会做这样的事情（不是很优雅）：

```
#include <iostream>

class MyClass
{

public:

    int getI()
    {
        std::cout << "non-const getter" << std::endl;
        return privateGetI<MyClass, int>(*this);
    }

    const int getI() const
    {
        std::cout << "const getter" << std::endl;
        return privateGetI<const MyClass, const int>(*this);
    }

private:

    template <class C, typename T>
    static T privateGetI(C c)
    {
        //do my stuff
        return c._i;
    }

    int _i;
};

int main()
{
    const MyClass myConstClass = MyClass();
    myConstClass.getI();

    MyClass myNonConstClass;
    myNonConstClass.getI();

    return 0;
} 
```

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2008-09-23T20:53:47.723

[这篇 DDJ 文章](http://www.ddj.com/cpp/184401331)展示了一种使用模板专业化的方法，该方法不需要您使用 const_cast。对于这样一个简单的功能，它确实是不需要的。

boost::any_cast （在某一时刻，它不再）使用来自 const 版本的 const_cast 调用非常量版本以避免重复。你不能在非常量版本上强加 const 语义，所以你必须*非常*小心。

最后，只要两个片段直接在彼此之上，一些代码重复*是可以的。*

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2014-11-20T14:06:10.343

要添加到 jwfearn 和 kevin 提供的解决方案，以下是函数返回 shared_ptr 时的相应解决方案：

```
struct C {
  shared_ptr<const char> get() const {
    return c;
  }
  shared_ptr<char> get() {
    return const_pointer_cast<char>(static_cast<const C &>(*this).get());
  }
  shared_ptr<char> c;
}; 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2016-12-15T04:15:17.383

没有找到我要找的东西，所以我自己滚动了几个......

这个有点罗嗦，但它的优点是可以同时处理许多同名（和返回类型）的重载方法：

```
struct C {
  int x[10];

  int const* getp() const { return x; }
  int const* getp(int i) const { return &x[i]; }
  int const* getp(int* p) const { return &x[*p]; }

  int const& getr() const { return x[0]; }
  int const& getr(int i) const { return x[i]; }
  int const& getr(int* p) const { return x[*p]; }

  template<typename... Ts>
  auto* getp(Ts... args) {
    auto const* p = this;
    return const_cast<int*>(p->getp(args...));
  }

  template<typename... Ts>
  auto& getr(Ts... args) {
    auto const* p = this;
    return const_cast<int&>(p->getr(args...));
  }
}; 
```

如果`const`每个名称只有一个方法，但仍有很多方法要复制，那么您可能更喜欢这个：

```
 template<typename T, typename... Ts>
  auto* pwrap(T const* (C::*f)(Ts...) const, Ts... args) {
    return const_cast<T*>((this->*f)(args...));
  }

  int* getp_i(int i) { return pwrap(&C::getp_i, i); }
  int* getp_p(int* p) { return pwrap(&C::getp_p, p); } 
```

不幸的是，一旦您开始重载名称，这就会崩溃（此时函数指针参数的参数列表似乎未解析，因此无法找到函数参数的匹配项）。尽管您也可以使用模板来摆脱这种情况：

```
 template<typename... Ts>
  auto* getp(Ts... args) { return pwrap<int, Ts...>(&C::getp, args...); } 
```

但是该方法的引用参数`const`无法与模板的明显按值参数匹配，并且它会中断。 ~~不知道为什么。~~[这就是为什么](https://stackoverflow.com/a/41160251/2417578)。

# project-management - 您如何远程管理 Web 开发人员？

> ID：123772
> 
> 赞同：4
> 
> 时间：2008-09-23T20:48:33.603
> 
> 标签：project-management

我是一个小型 Web 开发团队的负责人，我感觉我们很快就会有几个远程办公人员加入团队（新员工或将开始远程办公的现有员工）。知道如何有效地管理和与远程工作的开发人员协作吗？

我们所做的大部分工作都是以客户为导向的。我们正在做敏捷开发（或者我们的版本，无论如何），但由于它主要是客户工作，我们不能真正将功能分配给开发人员并让他们失去一两个星期，就像我们可能能够做到的那样桌面应用程序或类似的东西。当人们偶尔在家工作时，我们遇到的最大问题是协作——如果没有白板和挥手的好处，很难一起工作。

软件开发似乎非常适合远程办公，但我还没有找到很多关于在开发团队中远程工作的实际方面的好资源。有没有其他人有过这方面的经验？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-23T21:00:42.950

我经常做自由职业者，这样做的时候很多时候都是远程工作。这些是让我的生活尽可能轻松的事情（所以可能是你想要“建议”的事情）。我认为它们大多是常识，但你永远不知道...

1.  【大家】好好沟通。当您进行面对面的交谈时，您可以冗长并以回合的方式解释事情。当您仅限于电子邮件、IM 和电话时，各方都需要完整而简洁地解释自己。我发现将长电子邮件总结为请求/行动点对于把事情做好有很长的路要走。

2.  【大家】有一个在线项目跟踪空间。大多数人倾向于使用票证系统或一些描述，其中可以将行动点分配给成员。使用相同的空间来跟踪电子邮件和分享白板想法不会有什么坏处。大多数在线项目应用程序默认允许这样做。

3.  [管理] 不要纠缠开发人员。如果您急需某些东西，请设置工单的状态，给他们打个电话，然后在当天晚些时候追上他们。**每半小时发一封电子邮件询问“完成了吗？” 弊大于利！**

4.  [管理] 确保消息传递。如果开发人员说“有人需要做某事”，那么您的工作就是确保将信息传递给正确的人。没有什么比给项目经理发消息让他们不小心坐在上面更烦人的了。我不想追逐这样的事情，因为坦率地说，这不是我得到的报酬。

5.  [管理] 确保人们有事可做。如果你把他们送回家时，他们的任务清单上没有他们可以立即采取的行动，他们就不会付出努力。当您几乎无所事事或无事可做时，在家中保持工作效率比在办公室更难。如果有障碍物，您可能不得不兼顾任务。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T20:55:21.637

我全职在家工作。以下是对我的小型（6 人）团队有帮助的事情。

设置使用 IM 的规则。例如，允许远程工作人员阻止时间不被电子邮件或 IM 打断。要求工作人员在某个地方（IM、Yammer 等）保持最新状态，这有助于他们对任务负责。保持联系，不要分心。

如果可能，偶尔亲自见面。没有什么可以代替面对面的会议。Skype 可以用于小组会议，但如果涉及白板则不行。

使用 SharedView 或其他屏幕共享程序进行协作。屏幕截图/屏幕截图也有助于确保双方在同一页面上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T01:09:17.687

“知道如何有效地管理远程工作的开发人员并与他们协作吗？”

“有效”是什么意思？我可以否定并假设这意味着“与我一起，控制一切的项目负责人”。我可以是积极的，并假设您希望人们尽可能有效。

有时，“有效”是管理——“在我的控制之下”的代名词。或者它的意思是“不要乱来”。

那么问题是“有效地做什么？” 有效地“工作”是相当模糊的。因此，我跳到了项目管理的阴暗面。[我承认，这可能是错误的。但是如果没有特定的团队生产力问题，这个问题就没有答案。]

“没有白板和挥手的好处，很难一起工作”这只是有时是真的，有很多替代品。互联网上的“挥手”发生得更慢、更彻底。

围绕白板进行的集体思考很有趣——这是一种聚会。然而，对于我们中的一些人来说，这并不是很有成效。我需要几个小时来消化、考虑和制定替代方案；我实际上在小组白板环境中效率不高。

我发现使用替代的“慢动作”白板技术更有效。我喜欢看一个想法的草稿。评论它。细化它。很像 Wiki 或 Stackoverflow。我真的很喜欢互联网 RFC 模型——这是我的想法；评论它。当没有更多的改进时，这和它会得到的一样好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T01:13:31.327

我在密西西比州工作，我的家庭办公室在密歇根州。我每天花几个小时轻松地与我的团队结对编程。我使用的工具是：

*   共享视图
*   远程桌面协助
*   现场会议
*   呜呜
*   Skype

取决于谁和多少将取决于我使用的工具。

“使用正确的工具来完成这项工作，并投资购买一款该死的好耳机。” - 我。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T20:51:32.567

我通常使用一些基于社区的软件（例如 wiki、博客或论坛）来处理文档区域。我们还有一个 Cisco 电话系统并使用该系统的某些功能。我还建议使用实时会议或 webex 来进行频繁的团队会议。Skype 和 IM 客户端（例如 Live Messenger）也是不错的工具。对于简短的状态更新，推特可以做到这一点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T20:53:36.540

查看 VSTS 的**敏捷 Scrum**方法。Scrum 迫使我们每天有 15 分钟的会议和小里程碑，它确保了有效的团结和紧密的沟通。确保您通过 VSTS 使用任务、错误分配等

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T21:04:17.277

我同意约翰·希恩的回答。我是一名顾问并管理其他顾问 - 以项目为基础（作为 PM）和跨项目的客户基础。我曾在纯粹的远程基础以及远程办公（意味着我们大部分时间都在同一地点）与开发人员合作。远程工作是信任和沟通的问题。同地办公是最好的，但如果您远程工作，只需营造一种频繁沟通的文化。IM 和电话对此非常有用，电子邮件则不然。如果您的同事不善交流，则由您作为经理来联系。询问状态。经常强制检查代码以进行审查。

[编辑] - 是的，不要纠缠和设定期望！简洁明了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T21:16:03.210

首先使用 scrum（每日 scrum 电话、带有燃尽图的 scrum 板（wiki 在那里做得很好）、冲刺中的迭代等）。除此之外，还可以使用使远程协作更容易的工具，例如 Skype 和 VNC（可能是篝火？）和 wiki。我在一个项目中工作了 2 年，与 2 个大陆和不同时区的 3 个国家的人员一起工作，并且效果很好。关键是拥有使人们更难以“隐藏”的工具和方法，以便您和您的团队所做的一切都是可见的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T04:04:36.080

我发现虚拟团队具有清晰的沟通和坚持任务的挑战。我尝试使用带有书面议程的定期更新会议（通过电话或视频会议）来帮助应对这些挑战。

在议程的前面列出主要里程碑和近期里程碑。第一项总是“检查进度”，每个团队成员都会简单地告诉我们他们希望完成所涉及的特定任务的时间。我们尽量不在这里卷入长篇故事。它只是“你打算做什么，什么时候做”。

完成进度检查后，请处理上周提出的任何其他问题，以及团队遇到的任何可以在您参加会议时解决的问题。任何遗漏的事情（例如提出的新问题）都需要提出“谁需要解决这个问题以及何时解决”的问题。

一旦您为会议设置了通用格式，您就可以每周在 30-45 分钟内与 5-8 人的团队进行此操作。保持简短和甜蜜，这样它就不会被视为强加于人。让它专注于行动和时间表，这样它就有价值。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-19T08:47:14.317

我目前是一个较小项目的 PM，该项目有两个开发人员（我自己和另一个在办公室工作的开发人员）。我们目前每天举行 SCRUM 会议，持续约 15 分钟。我们讨论前一天做了什么，遇到了什么问题，我可以做些什么来帮助解决这些问题，以及明天要做什么。

他们很快，似乎很有帮助。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-07-06T07:24:37.470

为您的远程员工使用时间跟踪软件可以极大地帮助您管理团队。

在雇用远程员工时，您会担心，

1.  完成一项任务所花费的时间。
2.  所做工作的质量。
3.  根据项目进展进行合作。
4.  任务的实时进度。
5.  协作解决错误和逻辑错误。

不久前我遇到过你的情况，然后我尝试[了 StaffTimerApp](https://stafftimerapp.com/)，它通过以下方式帮助了我。

1.  时间跟踪软件提供关于完成任务所花费时间的清晰统计数据。StaffTimerApp 捕获屏幕截图并将其转换为计费和非计费时间。因此，您会知道在完成工作时是否浪费了任何时间。您还将知道完成工作所花费的确切时间。如果您按小时向承包商付款，此应用程序可以为您提供极大的帮助。

2.  如果您使用捕获屏幕截图的时间跟踪软件，您可以查看它们以分析正在交付的工作质量。我使用了这个功能，并且能够避免一些任务脱轨。

3.  时间跟踪软件让雇主知道员工完成任务的进度，因此时间跟踪提取的信息将使协作更容易。StaffTimerApp 被证明非常有用，因为我能够根据这些信息与其他员工协作。

4.  [屏幕共享](https://stafftimerapp.com/screen-sharing/)功能使我能够实时查看员工的笔记本电脑屏幕。这样我就可以了解任务的进度。

因此，您需要一款具有出色生产力分析和员工监控功能的优秀时间跟踪软件，才能轻松雇用远程开发人员。

# java - OOP & 完全避免实现继承是可能的吗？

> ID：123773
> 
> 赞同：21
> 
> 时间：2008-09-23T20:48:36.690
> 
> 标签：java, oop

我将选择 Java 作为示例，大多数人都知道，尽管其他所有 OO 语言也可以正常工作。

Java 与许多其他语言一样，具有接口继承和实现继承。例如，一个 Java 类可以从另一个类继承，并且每个在其中有实现的方法（假设父类不是抽象的）也被继承。这意味着接口是继承的，并且此方法的实现也是如此。我可以覆盖它，但我不必这样做。如果我不覆盖它，我已经继承了实现。

但是，我的类也可以“继承”（不是用 Java 术语）只是一个接口，而不需要实现。实际上接口在Java中确实是这样命名的，它们提供接口继承，但不继承任何实现，因为接口的所有方法都没有实现。

现在有这篇[文章，说继承接口比实现更好](http://www.javaworld.com/javaworld/jw-08-2003/jw-0801-toolbox.html)，您可能喜欢阅读它（至少第一页的前半部分），它很有趣。它避免了诸如[脆弱基类问题之类的问题](http://en.wikipedia.org/wiki/Fragile_base_class)。到目前为止，这一切都很有意义，文章中所说的许多其他事情对我来说也很有意义。

让我感到困惑的是，实现继承意味着**代码重用**，这是 OO 语言最重要的属性之一。现在如果 Java 没有类（就像本文所希望的 Java 教父 James Gosling），它解决了实现继承的所有问题，但是你如何使代码重用成为可能呢？

例如，如果我有一个类 Car 并且 Car 有一个方法 move()，它使 Car 移动。现在我可以为不同类型的汽车子类 Car，它们都是汽车，但都是 Car 的专用版本。有些可能以不同的方式移动，无论如何这些都需要覆盖 move()，但大多数会简单地保留继承的移动，因为它们的移动方式与抽象父 Car 一样。现在假设Java中只有接口，只有接口可以相互继承，一个类可以实现接口，但所有类总是最终的，所以没有一个类可以从任何其他类继承。

当您有一个 Interface Car 和数百个 Car 类时，您将如何避免需要为它们中的每一个实现相同的 move() 方法？OO 世界中除了实现继承之外还有哪些代码重用概念？

有些语言有 Mixin。Mixins 是我问题的答案吗？我读过它们，但我无法真正想象 Mixins 在 Java 世界中如何工作，以及它们是否真的能解决这里的问题。

另一个想法是，有一个类只实现 Car 接口，我们称之为 AbstractCar，并实现 move() 方法。现在其他汽车也实现了 Car 接口，它们在内部创建了一个 AbstractCar 的实例，并通过在其内部抽象 Car 上调用 move() 来实现自己的 move() 方法。但这不会白白浪费资源（一个方法只调用另一个方法——好吧，JIT 可以内联代码，但仍然如此）并且使用额外的内存来保存内部对象，你甚至不需要实现继承？（毕竟每个对象都需要更多的内存而不仅仅是封装数据的总和）对于程序员来说编写虚拟方法也不是很尴尬，比如

```
public void move() {
    abstractCarObject.move();
} 
```

?

任何人都可以想象一个更好的想法，即如何避免实现继承并且仍然能够以简单的方式重用代码？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-23T23:48:01.550

简短的回答：是的，这是可能的。但是你必须有目的地这样做，而不是偶然（使用最终，抽象和设计并考虑继承等）

长答案：

好吧，继承实际上并不是为了“代码重用”，而是为了类“专业化”，我认为这是一种误解。

例如，仅仅因为它们相似，就从向量创建堆栈是一个非常糟糕的主意。或者来自 HashTable 的属性只是因为它们存储值。参见[有效]。

“代码重用”更像是 OO 特性的“业务视图”，这意味着您的对象很容易在节点之间分布；并且是可移植的，并且没有以前的编程语言一代的问题。这已被证明是对的。我们现在有了可以轻松分发的库；例如，在 java 中，jar 文件可用于任何项目，从而节省数千小时的开发时间。OO 在可移植性等方面仍然存在一些问题，这就是现在 WebServices 如此受欢迎的原因（就像以前的 CORBA 一样），但这是另一个线程。

这是“代码重用”的一方面。另一个是有效的，与编程有关。但在这种情况下，不仅仅是“保存”代码行和创建脆弱的怪物，而是在设计时考虑到继承。这是前面提到的书中的第17条；**第 17 项：继承的设计和文件，否则禁止。**见【有效】

当然，你可能有一个 Car 类和大量的子类。是的，您提到的关于 Car 接口、AbstractCar 和 CarImplementation 的方法是正确的方法。

你定义了汽车应该遵守的“合同”，并说这些是我在谈论汽车时所期望的方法。抽象汽车，具有每辆汽车的基本功能，但留下并记录子类负责处理的方法。在 java 中，您可以通过将方法标记为抽象来做到这一点。

当您以这种方式进行时，“脆弱”类（或者至少设计者是有意识的或威胁的）没有问题，并且子类只完成了设计者允许它们的那些部分。

继承更多地是为了“专门化”这些类，就像 Truck 是 Car 的专门版本，MosterTruck 是 Truck 的专门版本一样。

从 Car 中创建“ComputerMouse”子类并不能仅仅因为它有一个像汽车一样的轮子（滚轮），它会移动，并且在下面有一个轮子只是为了节省代码行。它属于不同的域，并将用于其他目的。

防止“实现”继承的方法是从一开始就在编程语言中，你应该在类声明中使用 final 关键字，这样你就禁止子类。

如果是有意进行的，子类化并不是邪恶的。如果不小心完成，它可能会成为一场噩梦。我会说你应该尽可能从私有和“最终”开始，如果需要，让事情变得更加公开和可扩展。这在演示文稿“如何设计好的 API 及其重要性”中也得到了广泛解释，请参阅 [Good API]

继续阅读文章，随着时间和练习（以及很大的耐心），这件事会变得更加清晰。尽管有时您只需要完成工作并复制/粘贴一些代码：P。这没关系，只要你先努力做好。

这是来自 Joshua Bloch 的参考资料（以前在 Sun 工作，现在为 Google 工作的 Java 核心）

* * *

[有效] 有效的Java。绝对是非初学者应该学习、理解和实践的最佳 Java 书籍。必须的。

[有效的 Java](http://java.sun.com/docs/books/effective)

* * *

[Good API]介绍 API 的设计、可重用性和相关主题的演讲。它有点长，但每一分钟都值得。

[如何设计一个好的 API 及其重要性](http://www.youtube.com/watch?v=aAb7hSCtvGw)

问候。

* * *

更新：看看我发给你的视频链接的第 42 分钟。它谈到了这个话题：

“当你在公共 API 中有两个类并且你想把一个类作为另一个类的子类时，比如 Foo 是 Bar 的子类，问问你自己，每个 Foo 都是 Bar 吗？...”

在前一分钟，它在谈论 TimeTask 时谈到了“代码重用”。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-24T00:32:35.560

大多数反对继承的例子的问题是人们错误地使用继承的例子，而不是继承未能正确抽象的例子。

在您发布链接的文章中，作者展示了使用 Stack 和 ArrayList 继承的“破碎性”。该示例存在缺陷，因为**Stack 不是 ArrayList**，因此不应使用继承。该示例与 String 扩展 Character 或 PointXY 扩展 Number 一样有缺陷。

在扩展课程之前，您应该始终执行“is_a”测试。既然你不能说 Every Stack 是一个 ArrayList 在某种程度上是错误的，那么你不应该继承。

Stack 的合约与 ArrayList（或 List）的合约不同，并且 stack 不应继承不关心的方法（如 get(int i) 和 add()）。实际上 Stack 应该是一个带有以下方法的接口：

```
interface Stack<T> {
   public void push(T object);
   public T pop();
   public void clear();
   public int size();
} 
```

像 ArrayListStack 这样的类可能会实现 Stack 接口，在这种情况下使用组合（具有内部 ArrayList）而不是继承。

继承不是坏事，继承不好就是坏事。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T20:53:44.120

您还可以使用组合和策略模式。[链接文本](http://en.wikipedia.org/wiki/Strategy_pattern)

```
public class Car
{
  private ICar _car;

  public void Move() {
     _car.Move();
  }
} 
```

这比使用基于继承的行为灵活得多，因为它允许您在运行时通过根据需要替换新的 Car 类型来进行更改。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T21:00:14.137

您可以使用[组合](http://en.wikipedia.org/wiki/Object_composition)。在您的示例中， Car 对象可能包含另一个名为 Drivetrain 的对象。汽车的 move() 方法可以简单地调用它的传动系统的 drive() 方法。反过来，Drivetrain 类可以包含 Engine、Transmission、Wheels 等对象。如果您以这种方式构建类层次结构，您可以通过将更简单的部分（即重用代码）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-23T21:34:01.933

为了使 mixins/composition 更容易，看看我的 Annotations 和 Annotation Processor：

[http://code.google.com/p/javadude/wiki/Annotations](http://code.google.com/p/javadude/wiki/Annotations)

特别是 mixins 示例：

[http://code.google.com/p/javadude/wiki/AnnotationsMixinExample](http://code.google.com/p/javadude/wiki/AnnotationsMixinExample)

请注意，如果被委派的接口/类型具有参数化方法（或方法上的参数化类型），则它目前不起作用。我正在努力...

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-10T15:16:34.110

回答我自己的问题很有趣，但我发现这里很有趣：[Sather](http://www.icsi.berkeley.edu/~sather/)。

它是一种完全没有实现继承的编程语言！它知道接口（称为没有实现或封装数据的抽象类），并且接口可以相互继承（实际上它们甚至支持多重继承！），但是一个类只能实现接口（抽象类，尽可能多），它不能从另一个类继承。然而，它可以“包含”另一个类。这是一个委托概念。包含的类必须在类的构造函数中实例化，并在类被销毁时被销毁。除非您覆盖它们拥有的方法，否则您的类也会继承它们的接口，但不会继承它们的代码。相反，创建的方法只是将对您的方法的调用转发到包含对象的同名方法。

The language is not so beautiful, but I love the idea behind it :-)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T00:54:03.200

面向对象的语言不需要继承。

考虑一下 Javascript，可以说它比 Java 更面向对象。没有类，只有对象。通过将现有方法添加到对象来重用代码。Javascript 对象本质上是名称到函数（和数据）的映射，其中映射的初始内容由原型建立，并且可以动态地将新条目添加到给定实例中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T21:00:53.713

你应该阅读设计模式。您会发现接口对于许多有用的设计模式都至关重要。例如，抽象不同类型的网络协议将具有相同的接口（对于调用它的软件），但由于每种协议的不同行为，代码重用很少。

因为一些算法在展示如何将编程的无数元素组合在一起来完成一些有用的任务时令人大开眼界。设计模式对对象做同样的事情。向您展示如何以某种方式组合对象以执行有用的任务。

[四人组的设计模式](https://rads.stackoverflow.com/amzn/click/com/0201633612)

# asp.net - Parent.FindControl() 不工作？

> ID：123776
> 
> 赞同：1
> 
> 时间：2008-09-23T20:49:15.847
> 
> 标签：asp.net, javascript, findcontrol

我有一个包含 iframe 的页面

从 iframe 中的一个页面中，我想回顾一下并使默认页面上的面板不可见，因为它掩盖了弹出窗口

我尝试使用 Parent.FindControl 但它似乎不起作用。我很肯定我在 findcontrol 中有正确的 ID，因为我使用 Firebug 检查面板并从那里复制了 ID

有谁知道我错过了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T21:40:22.027

我没有完全理解你的问题，但我会尽力而为。

听起来您有一个 ASP.NET 页面，其中有一个 iframe 引用另一个 ASP.NET 页面，并且在 iframe 请求的那个页面中，您想要修改页面中包含的项目的可见性包含 iframe。

如果我对您的问题的理解是正确的，那么您在这里遇到了一些令人讨厌的问题。

1.  在浏览器级别实际发生的是第一个页面被加载，并且该页面中有一个 iframe，它正在向服务器发出第二个请求。
2.  第二个请求无法 FindControl 您的控件，因为它不在同一页面中，并且在该请求期间不活动。

所以你在这里有一些选择：

1.  摆脱 iframe 并使用面板。这会将它们放在同一个请求中，并且能够找到彼此。
2.  （另外）当你这样做时，你会想要使用 Page.FindControl() 而不是 Parent.FindControl() 作为 FindControl 方法只是搜索控件的子控件集合，我认为你的控件将在页面上的其他位置.
3.  在 iframe 的客户端，您可以使用一些 javascript 代码来访问外部页面的 DOM，并在那里设置它的可见性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T21:46:41.153

父文件：

```
<body>
    <input type="text" id="accessme" value="Not Accessed" />
    ...
</body> 
```

iframe 中的文档：

```
<head>
    ...
    <script type="text/javascript">
        function setValueOfAccessme()
        {
            window.parent.document.getElementById("accessme").value = "Accessed";
        }
    </script>
</head>
<body onload="setValueOfAccessme();">
</body> 
```

iframe 内的文档在加载时访问`document object`，`window object`并使用该`getElementId()`函数设置父文档正文内的输入值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T21:14:21.357

对于初学者来说，*FindControl*不是 Javascript 中的函数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T21:50:42.703

或者，这里有一个更有用的查找控制例程......

```
Public Shared Function MoreHelpfulFindControl(ByVal parent As UI.Control, ByVal id As String) As UI.Control
    If parent.ID = id Then Return parent
    For Each child As UI.Control In parent.Controls
        Dim recurse As UI.Control = MoreHelpfulFindControl(child, id)
        If recurse IsNot Nothing Then Return recurse
    Next
    Return Nothing
End Function 
```

# sql-server - 在 SQL Server 2008 Express 数据库上记录所有查询？

> ID：123781
> 
> 赞同：62
> 
> 时间：2008-09-23T20:50:25.440
> 
> 标签：sql-server

有没有办法告诉 SQL Server 2008 Express 将每个查询（包括每个 SELECT 查询！）记录到文件中？

它是一台开发机器，因此记录选择查询的负面影响不是问题。

在有人建议使用 SQL Profiler 之前：这在 Express 中不可用（有谁知道它在 Web 版中是否可用？）而且我正在寻找一种方法来记录查询，即使我不在。

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-09-23T20:58:09.633

SQL Server 探查器：

*   文件 → 新建跟踪
*   显示“常规”选项卡。
*   在这里您可以选择“保存到文件：”，以便将其记录到文件中。
*   查看“事件选择”选项卡
*   选择要记录的项目。
*   TSQL → SQL:BatchStarting 将为您提供 sql 选择
*   存储过程 → RPC:Completed 将为您提供存储过程。

来自 Microsoft 的更多信息：SQL Server 2008 联机丛书 -[使用 SQL Server Profiler](http://msdn.microsoft.com/en-us/library/ms187929.aspx)

*更新 - SQL Express 版：*

有人评论说 MS SQL Server Profiler 不适用于快速版。
似乎确实有一个免费的替代方案： [Profiler for Microsoft SQL Server 2005 Express Edition](http://sqlprofiler.googlepages.com/)

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2013-07-23T19:35:46.140

还有另一种方法可以获取有关已在[此处描述](http://blog.sqlauthority.com/2008/01/03/sql-server-2005-last-ran-query-recently-ran-query/)的 MS SQL Server Express 上执行的查询的信息。

简而言之，它对系统表运行智能查询并获取有关查询（或缓存的查询计划，如果需要）的信息（文本，执行时间）。因此，您可以在 MSSQL 2008 Express 版本中获得有关没有分析器的已执行查询的信息。

```
SELECT deqs.last_execution_time AS [Time], dest.TEXT AS [Query]
FROM sys.dm_exec_query_stats AS deqs
CROSS APPLY sys.dm_exec_sql_text(deqs.sql_handle) AS dest
ORDER BY deqs.last_execution_time DESC 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2013-05-20T09:30:07.573

…迟到的答案，但我希望它对这里的其他读者有用…</p>

将 SQL Server Express 与诸如此类的高级审计要求一起使用并不是真正的最佳选择，除非它仅在开发环境中使用。

您可以使用跟踪 (www.broes.nl/2011/10/profiling-on-sql-server-express/) 来获取所需的数据，但您必须自己解析这些数据。

有第三方工具可以做到这一点，但它们的成本会很高。ApexSQL的[日志浏览器可以记录除 select 之外的所有内容，](http://www.apexsql.com/sql_tools_log.aspx) [Idera 的](http://www.idera.com)合规管理器也会记录 select 语句，但成本要高得多。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-23T20:52:55.790

您可以记录更改。SQL Server 2008 将通过更改数据捕获使这变得特别容易。但是 SQL Server 不太擅长记录 SELECT。

从理论上讲，探查器是可行的，但它会影响您的性能。您可能会在桌面上“逍遥法外”，但我认为您会注意到您的机器运行缓慢，足以引起问题。在任何类型的部署之后，它肯定不会起作用。

其他几个人已经错过了重要的一点：除非他们在 2008 年改变了一些我没有听说过的东西，否则你不能触发 SELECT。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-06-28T13:36:46.113

只是为了记录，我包括使用[DataWizard 的 SQL Performance Profiler](http://www.datawizard.com/Home/tabid/55/Default.aspx)作为单独答案的提示，因为它实际上与[指向 SQL Server Profiler 的答案](https://stackoverflow.com/a/123828/177710)相反。

有 14 天的免费试用，但即使您需要购买，3 台服务器也只需 20 美元（撰写本文时，2012-06-28）。考虑到使用 SQL Server Express 版本的每个人已经保存了数千个，这对我来说似乎更公平。

到目前为止，我只使用了试用版，它提供了 OP 正在寻找的东西：一种跟踪进入特定数据库的所有查询的方法。它还提供将跟踪导出到 XML 文件的功能。付费版本提供了更多功能，但我还没有尝试过。

**免责声明：**我只是另一个不时搞乱数据库的开发人员，我绝不隶属于 DataWizard。我碰巧喜欢他们的工具，并想让人们知道它的存在，因为它帮助我分析了我的 SQL Server Express 安装。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T20:53:38.083

我会使用触发器或使用 Red Gate 等第三方软件来检查您的 SQL 日志文件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-18T20:45:07.933

似乎您可以使用 T-SQL 创建跟踪

[http://support.microsoft.com/kb/283790/](http://support.microsoft.com/kb/283790/)

这可能会有所帮助。

# messaging - 设计问题：您将如何设计消息/收件箱系统？

> ID：123783
> 
> 赞同：2
> 
> 时间：2008-09-23T20:50:39.010
> 
> 标签：messaging

许多网站都有从用户到用户发送消息的概念。当您向其他用户发送消息时，该消息将显示在他们的收件箱中。您可以回复该消息，它会在该消息线程中显示为一个新条目。

您应该能够查看您是否已经阅读了给定的消息，并且获得新响应的消息应该能够位于顶部。

您将如何设计类（或表或其他）来支持这样的系统？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T20:53:39.533

```
user
 id
 name

messages
 id
 to_user_id
 from_user_id
 title
 date

message_post
 id
 message_id
 user_id
 message
 date 
```

类将反映这种模式

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T21:02:15.800

您可能希望扩展 Owen 的模式以支持消息仅存储一次的批量消息。还进行了修改，因此只有一个发送者和许多接收者（在此方案中发送者永远不会超过一个）

```
用户
  ID
  姓名

信息
  ID
  收件人 ID
  content_id
  date_time_sent
  date_time_read
  response_to_message_id（指这封邮件回复的邮件——线程）
  过期
  重要性
  标志（阅读、阅读回复等）

内容
  ID
  message_id
  发件人ID
  标题
  信息

```

当然，还有很多很多其他功能可以添加，但是大多数人在想到“电子邮件”时会想到上述功能。

-亚当

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T20:55:00.030

这是一个相当简单的表结构。A to/from，主题，然后是消息。现在重要的是日期字段。DateSent 告诉它何时发送，DateRead 告诉消息已被阅读，DateDeletedTo 告诉 TO 用户删除了它，DateDeletedFROM 告诉 FROM 用户删除了它（这些是此示例的逻辑删除）。

```
tblMessage
ID  BIGINT 
ToUserID GUID/BIGINT
FromUserID GUID/BIGINT
Subject NVARCHAR(150)
Message NVARCHAR(Max)
DateDeletedFrom DATETIME
DateDeletedTo DATETIME
DateSent DATETIME
DateRead DATETIME 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T20:55:11.527

实际上，我这样做是作为工作中一些内部开发的一部分。制作一个名为 [Messages] 的表并为其指定以下列。

*   mID（消息 ID）
*   from_user
*   to_user
*   信息
*   时间
*   tID（线程 ID）
*   读取（布尔值）

类似的东西应该适用于桌子设计。这些类取决于您设计它的系统。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T20:55:13.697

```
Table Message:
id INTEGER
recipient_id INTEGER -- FK to users table
sender_id INTEGER -- ditto
subject VARCHAR
body TEXT

Table Thread
parent_id -- FK to message table
child_id -- FK to message table 
```

然后，您可以通过 Thread 表来获取消息线程。

# c# - 如何让我的代码在多核上运行？

> ID：123792
> 
> 赞同：18
> 
> 时间：2008-09-23T20:52:24.343
> 
> 标签：c#, multithreading, multicore

我已经用 C# 构建了一个应用程序，我希望针对多核进行优化。我有一些线程，我应该做更多吗？

**更新了更多细节**

*   C# 2.0
*   在 Windows Vista 和 Windows Server 2003 上运行

**再次更新**

*   此代码作为服务运行
*   我不想拥有完整的代码......我的目标是获得您的经验以及如何开始。就像我说的，我已经使用过线程。我还能做什么？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-09-23T21:06:30.470

我概括地说，编写一个高度优化的多线程进程比仅仅在混合中加入一些线程要困难得多。

我建议从以下步骤开始：

1.  将您的工作负载拆分为离散的并行可执行单元
2.  测量和表征工作负载类型——网络密集型、I/O 密集型、CPU 密集型等——这些成为您的工作池策略的基础。例如，对于网络密集型应用程序，您可以拥有相当大的工作人员池，但是对于 CPU 密集型任务来说，拥有比硬件线程更多的工作人员是没有意义的。
3.  考虑使用队列/数组或 ThreadWorkerPool 来管理线程池。前者比后者控制得更细。
4.  如果可以的话，学习更喜欢异步 I/O 模式而不是同步模式 - 释放更多 CPU 时间来执行其他任务。
5.  努力消除或至少减少围绕争用资源（如磁盘）的序列化。
6.  最小化 I/O，在尽可能短的时间内获取并保持最低级别的锁。（读/写锁是你的朋友）
    5.梳理代码以确保资源以一致的顺序锁定，以尽量减少致命的拥抱。
7.  疯狂地测试——多线程应用程序中的竞争条件和错误很难解决——通常你只能看到大屠杀的法医后果。

请记住，多线程版本的性能完全有可能比同一个应用程序的单线程版本更差。良好的工程测量没有任何借口。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-23T20:57:22.410

您可能想看看 .NET 的并行扩展

[http://msdn.com/concurrency](http://msdn.com/concurrency)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-23T21:06:28.647

您可能想阅读 Herb Sutter 的专栏 'Effective Concurrency'。您可以[在这里](http://herbsutter.wordpress.com/category/concurrency/)找到这些文章，以及其他文章。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-23T20:58:40.113

为了能够更有效地利用多个内核，您应该将您的工作分成可以并行执行的部分，并使用线程将工作分配给内核。您可以使用线程、后台工作者、线程池等

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-23T20:56:55.797

对于 C#，开始学习 LINQ 做事方式，然后使用[Parallel LINQ](http://msdn.microsoft.com/en-us/magazine/cc163329.aspx)库及其 .AsParallel() 扩展。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-23T21:09:58.090

了解您要解决的问题、应用程序及其算法中的并行性（或潜在的并行性）比线程同步、库等的任何细节都重要得多。

首先阅读[Patterns for Parallel Programming](https://rads.stackoverflow.com/amzn/click/com/0321228111)（侧重于“发现并发”和更高级别的设计问题），然后继续阅读[The Art of Multiprocessor Programming](https://rads.stackoverflow.com/amzn/click/com/0123705916)（从理论基础开始的实际细节）。

# calendar - 设计问题：你将如何设计一个循环事件系统？

> ID：123793
> 
> 赞同：48
> 
> 时间：2008-09-23T20:52:38.880
> 
> 标签：calendar

如果你的任务是构建一个支持重复事件的事件调度系统，你会怎么做？当一个重复的事件被删除时，你如何处理？你怎么能看到未来的事件何时发生？

即创建事件时，您可以选择“每天重复”（或每周、每年等）。

请每个响应一个设计。我习惯了 Ruby/Rails，但使用任何你想表达的设计。

我在一次采访中被问到这个问题，并且无法提出我喜欢的非常好的回答。

注意：[已在此处询问/回答。](https://stackoverflow.com/questions/85699/whats-the-best-way-to-model-recurring-events-in-a-calendar-application)但我希望能得到一些更实用的细节，如下所述：

*   如果需要能够评论或以其他方式将数据添加到重复事件的一个实例中，那将如何工作？
*   事件更改和删除如何工作？
*   您如何计算未来事件何时发生？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-15T18:31:14.583

我首先实现了[Martin Fowler 概述的](http://martinfowler.com/apsupp/recurring.pdf)一些时间表达式。这负责确定计划项目何时实际发生。这是一种非常优雅的方式。我最终得到的只是文章中的内容。

下一个问题是弄清楚如何在世界上存储表达式。另一个问题是，当您读出表达式时，它们如何适应不太动态的用户界面？有人谈论只是将表达式序列化为 BLOB，但很难遍历表达式树以了解它的含义。

解决方案（在我的情况下）是存储适合用户界面将支持的有限情况的参数，并从那里使用该信息动态生成时间表达式（在为优化而创建时可以序列化）。因此，Schedule 类最终具有多个参数，例如偏移量、开始日期、结束日期、星期几等等......您可以从中生成时间表达式来完成艰苦的工作。

至于任务的实例，有一个“服务”可以生成 N 天的任务。由于这是与现有系统的集成，并且需要所有实例，因此这是有道理的。然而，像这样的 API 可以很容易地用于预测重复，而无需存储所有实例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T21:55:11.727

*@Joe Van Dyk 问：“你能看看未来，看看即将举行的活动什么时候举行吗？”*

如果您想**查看/显示**事件的下*n 个*发生，则必须**a)**提前计算并存储在某处或**b)**动态计算并显示。这对于任何晚间框架都是一样的。

a) 的缺点是你必须在某个地方限制它，然后你必须使用 b)。更容易使用 b) 开始。

调度系统不需要这些信息，它只需要知道**下一个**事件是什么时候。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T21:11:17.043

我以前在管理项目的数据库端时必须这样做。我要求将每个事件存储为单独的事件。这允许您只删除一个事件，或者您可以移动一个跨度。删除多个比尝试修改单个出现并将其变为两个要容易得多。然后，我们能够创建另一个表，该表仅包含一个包含重复信息的recurrenceID。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T19:56:39.053

如果您有一个简单的重复事件，例如每天、每周或每周几天，那么在 scheduler/cron/at 功能中使用 buildt 有什么问题？创建可执行/控制台应用程序并设置何时运行它？没有复杂的日历、事件或时间管理。

:)

//W

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T21:01:59.903

保存事件时，我会将时间表保存到商店（我们称之为“**时间表**”，我会计算下一次触发事件的时间并将其保存，例如在“**事件**”中。然后我会查看“**事件**”并确定下一个事件何时发生并在此之前睡觉。

当应用程序“唤醒”时，它会计算事件应该何时再次发生，再次将其存储在“**事件**”中，然后执行该事件。

重复。

如果在睡眠时创建了一个事件，则睡眠会被中断并重新计算。

如果应用程序正在启动或从睡眠事件或类似事件中恢复，请检查“**事件**”以获取已通过的事件并采取相应措施（取决于您想对错过的事件执行什么操作）。

像这样的东西会很灵活，不会占用不必要的 CPU 周期。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T21:15:14.927

在我的脑海中（在打字/思考时修改了几件事之后）：

确定所需的最小重复分辨率；这就是应用程序运行的频率。也许是每天一次，也许是每五分钟一次。

对于每个重复事件，存储最近的运行时间、运行间隔和其他好东西，如到期时间（如果需要的话）。

每次应用程序运行时，它都会检查所有事件，将 (today/now +recurrenceResolution) 与 (recentRunTime + runInterval) 进行比较，如果它们一致，则触发事件。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T06:46:29.220

*几年*前，当我为自己编写一个日历应用程序时，我基本上只是从 cron 中窃取了调度机制并将其用于重复事件。例如，除一月之外的每个月的第二个星期六发生的事情将包括指令“repeat=* 2-12 8-14 6”（每年，第 2-12 个月，第 2 周从第 8 日到第 14 日，和 6 代表星期六，因为我使用从 0 开始的星期几编号）。

虽然这可以很容易地确定事件是否在任何给定日期发生，但它无法处理“每 N 天”的重复发生，而且对于不熟悉 unix 的用户来说也不太直观。

为了处理单个事件实例和删除/重新安排的唯一数据，我只是跟踪计算了多远的事件并将结果事件存储在数据库中，然后可以在其中修改、移动或删除它们而不影响原始重复事件信息。添加新的重复事件时，会立即计算出所有实例，直到现有的“最后计算”日期。

我没有声称这是最好的方法，但它是*一种*方法，并且在我之前提到的限制范围内效果很好。

# asp.net-mvc - 从控制器设置占位符属性？

> ID：123796
> 
> 赞同：1
> 
> 时间：2008-09-23T20:53:31.360
> 
> 标签：asp.net-mvc

我在控制器中有一个 if/else 语句，并根据结果显示 2 种不同类型的视图。

因此，我在 .aspx 页面中有两个视图，每个视图周围都有一个占位符。

如何从控制器设置属性 placeholder.Visible？或者根据 MVC 的理论，我什至应该在控制器中进行那种演示吗？听起来我会模糊前端输出的分离。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T20:58:12.580

不要那样做.. 只是有两个 aspx 页面/视图。不要担心占位符。

详细地说，是的，您可以在操作方法中执行这种逻辑。是的，您可以让操作方法有条件地呈现视图。这很正常！

如果操作中的逻辑太多以至于您难以维护单元测试，请重构

# visual-studio - Visual Studio 冻结/TFS 窗口可能不在屏幕上

> ID：123803
> 
> 赞同：6
> 
> 时间：2008-09-23T20:54:03.247
> 
> 标签：visual-studio, tfs, window, hidden, freeze

我将 Visual Studio 2005 与 Team Foundation Server 一起使用。

当我右键单击源代码控制下的文件并选择“比较”时，VS 似乎会冻结，直到我点击转义。我的猜测是应该弹出的窗口是我无法到达的地方。我尝试尽可能减少所有窗口，但无处可寻。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-23T21:11:05.233

尝试使用键盘快捷键进入窗口的主菜单 ()，然后按“M”进行移动，然后按箭头键将窗口附加到鼠标 - 然后在鼠标下一次移动时它应该跳转到它。

尝试首先看到的窗口。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-18T01:59:06.513

我在尝试签入 TFS 时遇到了同样的问题 - 没有对话框和 ESC 转义键解除了冻结。

在问题出现之前，我最近更改了我的笔记本电脑 + 显示器配置，如下所示：

从主屏幕是笔记本电脑和辅助屏幕是显示器

主屏幕是显示器，次要屏幕是笔记本电脑。

我摆脱了我的辅助屏幕并再次尝试。果然不可见的对话框不再是不可见的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-01T11:50:48.633

我也不得不禁用我的第二个屏幕。现在，您可以在其中添加评论的签入屏幕*可见*。

# java - JSF 中的空白页

> ID：123809
> 
> 赞同：2
> 
> 时间：2008-09-23T20:55:05.600
> 
> 标签：java, jsf, facelets

如果我的代码抛出异常，有时 - 不是每次 - jsf 会显示一个空白页面。我正在使用 facelets 进行布局。[在这个Sun 论坛的帖子](http://forums.sun.com/thread.jspa?messageID=10237827)中报告了一个类似的错误，但没有答案。其他人有同样的问题，或者有解决方案吗？;)

由于一些要求。以下是更多数据：

web.xml

```
 <error-page>
        <exception-type>com.company.ApplicationResourceException</exception-type>
        <location>/error.faces</location>
 </error-page> 
```

而jsf相关的栈是在真正的异常之后打印出来的：

```
####<Sep 23, 2008 5:42:55 PM GMT-03:00> <Error> <HTTP> <comp141> <AdminServer> <[ACTIVE] ExecuteThread: '3' for queue: 'weblogic.kernel.Default (self-tuning)'> <<WLS Kernel>> <> <> <1222202575662> <BEA-101107> <[weblogic.servlet.internal.WebAppServletContext@6d46b9 - appName: 'ControlPanelEAR', name: 'ControlPanelWeb', context-path: '/Web'] Problem occurred while serving the error page.
javax.servlet.ServletException: viewId:/error.xhtml - View /error.xhtml could not be restored.
    at javax.faces.webapp.FacesServlet.service(FacesServlet.java:249)
    at weblogic.servlet.internal.StubSecurityHelper$ServletServiceAction.run(StubSecurityHelper.java:226)
    at weblogic.servlet.internal.StubSecurityHelper.invokeServlet(StubSecurityHelper.java:124)
    at weblogic.servlet.internal.ServletStubImpl.execute(ServletStubImpl.java:283)
    at weblogic.servlet.internal.ServletStubImpl.execute(ServletStubImpl.java:175)
    at weblogic.servlet.internal.RequestDispatcherImpl.invokeServlet(RequestDispatcherImpl.java:525)
    at weblogic.servlet.internal.RequestDispatcherImpl.forward(RequestDispatcherImpl.java:261)
    at weblogic.servlet.internal.ForwardAction.run(ForwardAction.java:22)
    at weblogic.security.acl.internal.AuthenticatedSubject.doAs(AuthenticatedSubject.java:321)
    at weblogic.security.service.SecurityManager.runAs(Unknown Source)
    at weblogic.servlet.internal.ErrorManager.handleException(ErrorManager.java:144)
    at weblogic.servlet.internal.WebAppServletContext.handleThrowableFromInvocation(WebAppServletContext.java:2201)
    at weblogic.servlet.internal.WebAppServletContext.execute(WebAppServletContext.java:2053)
    at weblogic.servlet.internal.ServletRequestImpl.run(ServletRequestImpl.java:1366)
    at weblogic.work.ExecuteThread.execute(ExecuteThread.java:200)
    at weblogic.work.ExecuteThread.run(ExecuteThread.java:172)
javax.faces.application.ViewExpiredException: viewId:/error.xhtml - View /error.xhtml could not be restored.
    at com.sun.faces.lifecycle.RestoreViewPhase.execute(RestoreViewPhase.java:180)
    at com.sun.faces.lifecycle.LifecycleImpl.phase(LifecycleImpl.java:248)
    at com.sun.faces.lifecycle.LifecycleImpl.execute(LifecycleImpl.java:117)
    at javax.faces.webapp.FacesServlet.service(FacesServlet.java:244)
    at weblogic.servlet.internal.StubSecurityHelper$ServletServiceAction.run(StubSecurityHelper.java:226)
    at weblogic.servlet.internal.StubSecurityHelper.invokeServlet(StubSecurityHelper.java:124) 
```

我正在使用 jsf 版本`Mojarra 1.2_09`，`richfaces 3.2.1.GA`并且 `facelets 1.1.13`.

希望有所帮助:(

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T21:15:56.983

我认为这在很大程度上取决于您的 JSF 实现。我听说有些会呈现空白屏幕。

我们使用的那个会抛出带有堆栈跟踪的错误 500。其他超时按钮不会对用户没有任何错误。这都是在我们的开发阶段。

但是我能给你的最好的建议是捕获异常并将它们记录在错误日志中，这样你就有了堆栈跟踪以供以后调试。对于我们无法处理的消息，例如后端失败，我们只需向 FacesContext 添加一条致命消息，该消息将显示在屏幕上并记录堆栈跟踪。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-11T18:28:02.200

我今天在我的`error.jsp`页面中修复了一个类似的问题。这不会与您的完全相同，但如果某人遇到类似问题，它可能会为他们指明正确的方向。我的问题似乎来自两个不同的来源。

首先，`message`在一些抛出被错误页面捕获的异常的 servlet 中没有设置异常属性。[`ServletException(Throwable rootCause)`](http://download.oracle.com/javaee/5/api/javax/servlet/ServletException.html#ServletException%28java.lang.Throwable%29)servlet 使用构造函数捕获和重新抛出异常。

其次，在错误页面本身，原作者使用scriptlet代码解析消息，使用`String.split(message, ";");` Since the message is `null`this failed。我的错误日志中出现了一个`NullPointerException`错误消息，以及“提供错误页面时出现问题”的消息。

这两件事结合在一起，在引发原始异常的 servlet 的 URL 处为我提供了一个空白页面。当我使用构造函数在我的 servlet 中重新抛出异常时，我通过提供我自己的错误消息来解决我的问题[`ServletException(String message, Throwable rootCause)`](http://download.oracle.com/javaee/5/api/javax/servlet/ServletException.html#ServletException%28java.lang.String,%20java.lang.Throwable%29)，因此错误消息将不再是`null`. 我还使用 EL 而不是 scriptlet 代码重写了`error.jsp`页面，但这并不是绝对必要的。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2013-01-04T14:59:45.623

对于 JSF 2 上的空白页，放置一个断点`ExceptionHandlerWrapper.handle`或一个覆盖此方法的类。在我的情况下，这是由于自定义代码过于严格并且没有记录错误。

# java - 您使用哪种 JMS 实现？

> ID：123817
> 
> 赞同：47
> 
> 时间：2008-09-23T20:56:19.060
> 
> 标签：java, jms

我们使用[ActiveMQ 5.2](http://activemq.apache.org/)作为我们选择的实现，并且我们在不久前就选择了它。它的性能足以让我们现在使用。已经有一段时间了，我想知道还有哪些其他 Java 消息服务实现正在使用，为什么？肯定不止几个。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2012-04-17T10:11:13.597

在深入研究 JMS 之前，还要考虑 AMQP - 可能是一个新标准。我合作过的 JMS 提供商（在不同程度上）：

TIBCO EMS - 非常快速和健壮，良好的 API 支持，Java 友好，本地 C API 存在。我用过的最佳商业选择。

Websphere MQ（以及它的 JMS 实现）——如此，如此。Pub/sub 并不是很快，许多配置选项和选择从该产品的悠久历史来看是“奇怪的”并且过于复杂。看看文档的数量...

Solace JMS - 非常高的吞吐量（JMS 代理内置于硬件中！），连接协议的良好选择（MQTT、AMQP、http 上的 XML 作为管理协议）

Fiorano MQ - 过去在营销方面很激进，但失去了很多市场份额，成熟度问题

Sonic MQ - 可靠的产品，也支持 C API

Active MQ - 如果您想使用开源产品（便宜的支持、强大的社区、有限的附加产品、有限的企业功能），这可能是您的最佳选择。开箱即用，是 Apache Camel 等多种工具的支柱。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-23T21:18:51.050

我们通过 Camel 框架依赖 AMQ (5.1)，没有任何问题。AMQ 4 有点可疑。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-03-07T15:51:28.530

使用 WebLogic 时的 WebLogic JMS 提供程序。效果很好。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-23T21:53:49.327

Sun 的开源 OpenMQ ( [https://mq.dev.java.net/](https://mq.dev.java.net/) )。您可以获得相同的免费和付费支持。

请参阅此博客文章，了解与 ActiveMQ 等的一些比较——http: [//alexismp.wordpress.com/2008/06/06/openmq-the-untold-story/](http://alexismp.wordpress.com/2008/06/06/openmq-the-untold-story/)。

我听说 OpenMQ 更稳定。

ActiveMQ 更加灵活。如，您可以将其与更多语言一起使用。ActiveMQ 的邮件列表中的人可能比 OpenMQ 多。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-23T21:24:05.450

[TIBCO EMS](http://www.tibco.com/software/messaging/enterprise_messaging_service/default.jsp)。它是一个带有 Java/JMS、C、.net 和其他绑定的商业消息服务。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-23T21:03:00.103

在我最近参与的一个项目中，我们使用了[Sonic MQ](http://www.sonicsoftware.com/)。良好的整体实现与良好的 .NET 绑定。

我们遇到了一些可扩展性问题，但我不得不承认，可扩展性要求非常严格：如果我没记错的话，大约每秒 20,000 个混乱，200 个不同的客户端之间不允许有任何延迟（每个客户端都必须接收每条消息同时）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-23T21:06:59.503

我使用了 JBossMQ，它与最高版本 4 的 JBoss 应用程序服务器一起提供，并且可靠但有限。JBoss Messaging 是 JBossAS 5 的替代品，是一个巨大的改进。

我非常不喜欢 ActiveMQ。开发人员似乎已经追求性能和功能而损害了稳定性，而且它的问题非常严重。鉴于它是 Geronimo 的 JMS 结构，我担心。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-19T04:30:08.987

IBM WebSphere MQ 5 和 6 活动 MQ 5.2.0

[还可以在http://codingjunky.com/page5/page4/page4.html](http://codingjunky.com/Articles/uQManager.html)上查看 Micro QueueManager。 它体积小，易于安装和用于小型项目。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-01-07T08:18:19.280

我们正在使用 SonicMQ、JBossMQ 和 Lotus Expeditor Integrator 的“微代理”。我们将它们用于不同的目的：

-JBossMQ 在内部使用，并与我们在 JBoss 上运行的所有 Java EE 应用程序进行通信。-Lotus Expeditor 用于“远程站点”，我们只有有限的资源和 IT 人员。1000 个站点。

我们在所有这些方面都有很好的经验，但我们的经验也是，在更复杂的环境中，您必须对消息传递系统进行更积极的管理。在我们的站点上使用 SonicMQ 尤其如此 :-) 。从性能的角度来看，我们使用 SonicMQ 获得了最佳体验，尤其是在基于队列的持久消息传递方面。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-06-27T09:34:33.973

I have used ActiveMQ in production for a couple of years but I was never happy about its stability (specially with it clustered-enabled). Never looked back after switching to OpenMQ. You might want to look into RabbitMQ or ZeroMQ.

# mercurial - 使用 mercurial 的 mq 管理本地更改

> ID：123826
> 
> 赞同：1
> 
> 时间：2008-09-23T20:57:37.077
> 
> 标签：mercurial, mercurial-queue

我有一个本地 mercurial 存储库，其中包含一些特定于站点的更改。我想做的是将几个文件设置为不可提交的，这样当我在`hg commit`没有参数的情况下执行时它们不会自动提交。

现在，我正在用`mq`和守卫做复杂的事情来实现这一点，推送和弹出并选择守卫以防止我的更改（已检查到 mq 补丁中）被提交。

有没有更简单的方法来做到这一点？`mq`每次我想提交不包括我的站点特定更改的更改时，我都厌倦了阅读所有命令的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T21:17:31.503

我会将这些文件放入`.hgignore`并提交这些文件的“样本”形式，以便在有人签出您的代码时可以轻松地为新站点重新创建它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T01:39:13.887

我知道集市有搁置和取消搁置命令来推送和弹出您不希望包含在提交中的更改。我认为 Mercurial 很可能有类似的命令。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T01:33:00.063

我很好奇为什么你不能用这些特定的变化检查另一个 repo，然后在你需要更新东西时移植/拉/补丁到它。然后您将主要从原始存储库中工作，并且由于 hg 使用链接，您不会浪费空间。我通常会签出两个以上的版本，因此我可以进行一些更新，然后将它们合并在一起。

# architecture - 单个开发人员应该遵循多少流程？正式的流程是不是太多了？

> ID：123837
> 
> 赞同：6
> 
> 时间：2008-09-23T20:59:02.580
> 
> 标签：architecture

由于最后一个问题我写得不好，而且大部分答案都很好，但根本不是我打算提出问题的方向，所以我将其删除并重新制作为这个问题。

我是我自己项目的独立开发者，通常是非常小的东西，但我有一些想法可能会变成 FOSS 项目。我相信文档（在不同程度上，取决于具体的项目和最终用户）、源代码控制和项目管理（包括错误跟踪、时间管理等）。但是，我不确定我应该遵循多少[正式流程。](http://en.wikipedia.org/wiki/Software_development_process)

或许只需在源代码控制下保留自述文件、相关的设计/需求文档和代码内注释就足够了。或者也许有一个适合单个开发人员遵循的敏捷过程。或者，也许我应该为每个项目采用老式的瀑布模型。

如果我什至需要一个正式的流程，那么对于独立开发者来说，存在哪些流程或者可以采用哪些流程？

* * *

编辑：我意识到我正在做一些任务，比如文档和源代码控制。但是，我不确定问题的部分。作为一名独立开发人员，我应该采用更敏捷的方法（如果是，敏捷的哪个“分支” - XP？Scrum？RAD？）还是更传统的方法（瀑布式还是螺旋式？）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T21:06:16.087

即使您不需要流程来促进团队成员之间的良好沟通，流程也可以帮助您弥补您不像 18 岁时认为的那样超人的事实 :) “文书工作”的类型和数量你决定做什么取决于你自己的长处和短处。记性不好？每天写下你的设计和想法。好看到树而不是森林？确保您对您的要求和设计格外小心。看好森林但看不到树？详细的任务列表、时间估计和频繁的可交付成果是您的朋友。

它归结为：您可能会搞砸什么，以及哪些流程有助于您的特定工作方式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T21:14:02.200

请记住，虽然您现在可能独自一人，但这些项目可能会变得足够成功，以至于其他人也加入了您的行列。因此，虽然您现在可能不需要所有额外的东西，但最终您可能希望您有一些设计文档和说明，用于构建事物、管理源代码存储库等。

还要记住，那些“其他人”可能是几年后的你，那时你已经忘记了你现在所知道的一切。（你还年轻——你还不知道记忆消失的速度有多快。）所以想想你想为未来的自己记录什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T21:17:17.090

你肯定需要一个流程，有很多非代码数据用于管理和支持项目。如果没有流程，您将很快受苦，因为您忘记了不做某事或重新学习如何分支 svn b/c 的所有充分理由，您每月只做一次。

关于设计、设计决策、操作等的文档对于任何重要的项目都是至关重要的。

测试、源代码控制等都是良好的开发实践，无论项目规模如何，都应该进行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T21:19:49.753

这是一个非常广泛的问题，但也许我可以通过分享我的经验来提供帮助。我和几个朋友在一个爱好游戏编码项目上工作了将近 5 年。一个非常紧密结合的开发人员团队，我们通常把我们的机器拖到一个单独的公寓里，一个周末来开发这个项目。我的观点是，它可以比作一个人的努力，因为我们都在那里决定重要的设计决策，等等。'过程？' 不，我无法识别，即使回想起来。

保持源代码控制的一件事是遵循我们决定从一开始就实施的“敏捷开发”范式：**无情地重构**。我们做到了，而且天哪，它一直把整场比赛都打破了。但它**确实**保持了源代码的清洁，当我们决定时不时地进行“稳定版本”时，这一切似乎都走到了一起。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T21:48:04.443

参考您链接到的页面 - 我说遵循流程。我是一个单独的开发者，我遵循这些过程。如果不了解您的要求和先决条件，您就无法编写软件。正如其他人所说，了解您的工作方式以及您的优势和劣势。此外，有时您会遇到困难并寻求一些外部帮助。没有人知道一切。

The whole process takes time (often never ends) and I have killed far too many brain cells over the years to store every detail in my head. Mind maps, flow charts and things like OneNote are good for non-coding long-term memory. Try to keep the bulk of it in one place or at least linked together so you don't have to try to remember where to look for it.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T21:10:03.253

跟随你的心。

# .net - 使用 C# 和 .NET 环境获取 jpeg 图像的分辨率？

> ID：123838
> 
> 赞同：6
> 
> 时间：2008-09-23T20:59:04.013
> 
> 标签：.net, jpeg, resolution

我们的客户将上传要打印在他们文档上的图像，我们被要求想出一种方法来获取图像的分辨率，以便在图像分辨率太低并且在成品

如果涉及到它，如果有人知道如何获得这些尺寸，我们也可以使用尺寸，但分辨率将是首选

谢谢

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-23T21:01:12.747

[System.Drawing.Image](http://msdn.microsoft.com/en-us/library/system.drawing.image.aspx)

```
Image newImage = Image.FromFile("SampImag.jpg");
newImage.HorizontalResolution 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-23T21:20:53.820

这取决于您要查找的内容...如果您想要图像的 DPI，那么您正在寻找作为图像 DPI 的 Horizo​​ntalResolution。

```
Image i = Image.FromFile(@"fileName.jpg");
i.HorizontalResolution; 
```

如果要弄清楚图像有多大，则需要计算图像的测量值，即：

```
int docHeight = (i.Height / i.VerticalResolution);
int docWidth = (i.Width / i.HorizontalResolution); 
```

这将为您提供以英寸为单位的文档高度和宽度，然后您可以将其与所需的最小尺寸进行比较。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-05-04T14:21:43.613

DPI 仅在打印时才有意义。72dpi 是 Mac 标准，96dpi 是 Windows 标准。屏幕分辨率仅考虑像素，因此 72dpi 800x600 jpeg 与 96dpi 800x600 像素的屏幕分辨率相同。

回到 80 年代，Mac 使用 72dpi 屏幕/打印分辨率来适应屏幕/打印尺寸，因此当您在屏幕上以 1:1 显示图像时，它对应于打印机上的相同尺寸。Windows 将屏幕分辨率提高到 96dpi 以获得更好的字体显示。但结果，屏幕图像不再适合打印尺寸。

因此，对于 Web 项目，如果图像不用于打印，请不要使用 DPI；72dpi、96dpi，甚至 1200dpi 都应该显示相同。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T21:03:27.623

```
Image image = Image.FromFile( [file] );
GraphicsUnit unit = GraphicsUnit.Point;
RectangleF rect = image.GetBounds( ref unit );
float hres = image.HorizontalResolution;
float vres = image.VerticalResolution; 
```

# wcf - 是否有 SVCUTIL.EXE 的替代方案来生成 WCF Web 服务代理？

> ID：123842
> 
> 赞同：0
> 
> 时间：2008-09-23T21:00:12.297
> 
> 标签：wcf, proxy

我是否遗漏了某些东西，或者真的没有替代方案（但我希望）可以使用 SVCUTIL.EXE 来生成 WCF Web 服务代理？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T15:52:46.660

我强烈建议您在使用它们之前查看自动生成的配置，自动生成的东西充满了垃圾。尝试查看 Miquel Castro 的这篇文章：[WCF the Manual Way... the Right Way](http://www.code-magazine.com/Article.aspx?quickid=0809101)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-04T22:16:21.447

我通常只对给定的接口使用 ChannelFactory。如果接口具有足够的 WCF 属性，它应该可以很好地工作。这是双工通道的客户端示例：

```
DuplexChannelFactory<IServerWithCallback> cf = 
        new DuplexChannelFactory<IServerWithCallback>(
            new CallbackImpl(), 
            new NetTcpBinding(), 
            new EndpointAddress("net.tcp://localhost:9080/DataService")); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T21:12:25.417

如果您正在寻找命令行替代方案或独立 GUI，那么不 - 我不知道。

但是，如果您在 VS 中开发时对使用感到疑惑，VS2008 的添加服务引用是一种替代方案，可以让您省去一些麻烦。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T21:15:01.433

多哈。我正在阅读旧文档，并且刚刚意识到 Add Service Reference 为您完成了这些工作。谢谢你！

# windows - 如果您已经安装了 IIS/SQL Server，那么在 Windows 上针对 WordPress 进行开发的最佳方式是什么？

> ID：123848
> 
> 赞同：2
> 
> 时间：2008-09-23T21:00:49.890
> 
> 标签：windows, iis, wordpress

如果您想针对 WordPress 进行开发（即，在您的机器上运行一个本地实例，以便您可以开发主题、获取博客和网站布局等）并且您正在使用 IIS 和 SQL Server 在您的开发机器上运行 Windows已安装，最好的方法是什么？

我在网上找到了一种方法，它在运行 Apache 和 MySQL 的 Windows 实例上设置了一个小型“迷你”服务器，但他们不建议在已安装 IIS 的机器上使用它。显然，可以安装 Apache 和 MySQL 并这样做，但考虑到 Windows 为您提供的功能（即在 IIS 中运行 PHP 的方法——我认为 Windows Server 2008 甚至为此进行了优化），这是最好的方法吗？有没有办法以 SQL Server 作为后端来运行 WordPress？（我不这么认为，但我想我会把它扔在那里）。

Windows版本（即XP，Vista，Vista64）是否有不同的方法

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T21:04:12.583

我在拇指驱动器上运行[XAMPP](http://www.apachefriends.org/en/xampp.html)并在那里安装 WordPress（通常是它的多个实例）。然后，当我要进行 Wordpress 开发时，我启动了 XAMPP。

编辑：此设置确实需要在 XAMPP 服务器运行时停止 IIS（或者我从未费心弄清楚的一些拜占庭配置魔法。由于我对本地 IIS 开发的大部分个人需求都由内置的 Visual Studio 处理-在可以与 XAMPP 并行运行的 IIS 的实例中，我很少会为其他任何事情而烦恼，但这可能不适用于所有人。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T21:03:57.060

安装 PHP，在 IIS 中运行 Wordpress。安装可以与 MSSQL 并行运行的 MySQL。在 Apache 上使用 IIS 唯一会错过的是 mod_rewrite 用于更漂亮的 URL。

尽可能避免在同一台机器上运行 IIS 和 Apache。IIS 喜欢绑定到阻止 Apache 绑定到 IP 的所有可用 IP，如果需要，您可以绕过它，但目前尚不清楚发生了什么。

我多年来一直在运行此设置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T23:48:59.160

由于您对开发 Wordpress 感兴趣，我强烈建议您使用最常见的 WP 设置：Apache、PHP 和 MySQL。

您可以同时运行 Apache 和 IIS（我有 IIS 在端口 81 上侦听，Apache 在 80 上）或者您一次只能运行一个（创建 2 个 bat 文件以使用 net start/stop 命令启动/停止服务器）。

您可以使用 IIS、PHP、MySQL 来运行 Wordpress，但是当您在 Apache 上部署时，有一些细微的差异可能会让您发疯或导致问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T00:07:44.823

您当然可以在同一个机器上运行 IIS 和 Apache。我们目前在同一台服务器上使用 Documentum/Apache 和 IIS。只需为一个 Web 服务器选择一系列地址 - 例如 Apache 的 808x。

您还应该考虑使用来自 VMWare 的 Thinstall，您可以在其中虚拟化整个应用程序 - 注册表、.Net 和所有应用程序 - 作为单个 .EXE 分发。我们现在这样做是为了打包不能很好地协同工作的应用程序。您可能想要虚拟化 Wordpress/Appache/MySql 并为该配置设置 IP (808x)。通过这种方式，您可以将它移动到任何带有 IIS 的服务器上，并且它可以在不同的配置下运行良好。

# java - 延迟异常

> ID：123862
> 
> 赞同：1
> 
> 时间：2008-09-23T21:02:20.917
> 
> 标签：java, exception

我有一种方法可以定期（例如每 10 秒一次）尝试连接到服务器并从中读取一些数据。服务器可能并非始终可用。如果服务器不可用，该方法将引发异常。

除非服务器至少一分钟不可用，否则实现不会引发异常的包装器方法的最佳方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T21:05:52.750

跟踪您上次成功到达服务器的时间。如果服务器抛出异常，捕获它并与您上次访问服务器的时间进行比较。如果该时间超过一分钟，则重新抛出异常。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T21:08:54.350

在伪代码中。

```
//Create Timer
//Start Timer
bool connected = false;

while (!connected)

    try {
        //Connect To DB

        connected = true;
    }
    catch (Exception ex) {
       if (more than 1 minute has passed)
          throw new Exception(ex);
    }

} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T21:06:15.010

您必须记录最初尝试连接到服务器的时间，然后捕获异常。如果异常被捕获的时间大于原来的时间+1分钟，则重新抛出异常。如果没有，请重试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T21:07:06.973

理想情况下，您可以对服务器的调用设置超时。在 catch 块中执行 thread.sleep(600) 失败，然后再试一次，如果第二个没有返回，则失败。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T21:46:35.240

请记住，异常处理只是对通常的“返回”系统的一种*非常特殊的使用*。（有关更多技术细节，请阅读“monads”。）如果您要发出信号的异常情况不适合 Java 的异常处理系统，则可能不适合*使用*异常。

You can keep track of error conditions the usual way: Keep a state variable, update it as needed with success/failure info, and respond appropriately as the state changes.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T21:09:42.100

您可以有一个重试计数，如果满足了所需的计数（在您的情况下为 6），则抛出异常

```
int count = 0;

CheckServer(count);

public void CheckServer(count) {
try
{
  // connect to server
}
catch(Exception e)
{
 if(count < MAX_ATTEMPTS) {
    // wait 10 seconds
    CheckServer(count++)
  }
  else {
    throw e;
  }
}
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T21:40:03.557

您可以为服务器连接是否成功设置一个布尔变量，并在异常处理程序中检查它，如下所示：

```
class ServerTester : public Object
{
  private bool failing;
  private ServerConnection serverConnection;
  private Time firstFailure;

  public ServerTester(): failing(false)
  {
  }

  public void TestServer() throws ServerException
  {
    try
    {
       serverConnection.Connect();
       failing = false;
    }
    catch (ServerException e)
    {
      if (failing)
      {
        if (Time::GetTime() - firstFailure > 60)
        {
          failing = false;
          throw e;
        }
      }
      else
      {
        firstFailure = Time::GetTime();
        failing = true;
      }
    }
  }
} 
```

我不知道 API 的实际时间是多少，因为距离我上次使用 Java 已经有一段时间了。这将满足您的要求，但它的某些方面似乎不正确。轮询异常让我有点倒退，但是由于您正在处理服务器，所以我想不出任何其他方法。

# domain-driven-design - 我在哪里可以找到好的领域驱动设计资源？

> ID：123886
> 
> 赞同：24
> 
> 时间：2008-09-23T21:05:42.577
> 
> 标签：domain-driven-design

什么是最好的地方来了解有关领域驱动设计的所有信息，从初学者到高级。

*   图书
*   网站
*   邮件列表
*   用户组
*   会议
*   ETC

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-25T15:20:09.240

以下是一些有趣的来源：

*   埃里克·埃文斯 (Eric Evans)的[DDD](http://dddcommunity.org/books/index.html#DDD)书
*   免费[DDD 快速](http://dddcommunity.org/books/index.html#DDD_quickly)预订
*   [DDD 新闻](http://groups.yahoo.com/group/domaindrivendesign/)组

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-23T21:26:54.930

维基百科有一些有用的信息，尤其是它对 DDD 与其他方法的关系的总结。

[http://en.wikipedia.org/wiki/Domain-driven_design](http://en.wikipedia.org/wiki/Domain-driven_design)

它还链接到 Eric Evans 的两个演讲

*   [http://www.infoq.com/presentations/model-to-work-evans](http://www.infoq.com/presentations/model-to-work-evans)
*   [http://www.infoq.com/presentations/strategic-design-evans](http://www.infoq.com/presentations/strategic-design-evans)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-23T21:28:06.987

这篇[文章](http://www.infoq.com/articles/ddd-in-practice)很好地介绍了如何在实践中做 DDD。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T21:07:48.673

也许阅读《[领域驱动设计](http://books.google.com/books?id=7dlaMs0SECsC&dq=domain+driven+design&pg=PP1&ots=ulAQZXV5q7&sig=rMvPNRKLH79CBuNOSH9wu4WzfiA&hl=en&sa=X&oi=book_result&resnum=5&ct=result)》一书？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T21:10:37.027

我推荐Eric Evans 的[领域驱动设计](https://rads.stackoverflow.com/amzn/click/com/0321125215)，这是一本关于该主题的好书。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-19T02:22:23.080

以下是一些信息来源：

*   软件工程电台对 Eric Evans的[采访](http://www.se-radio.net/podcast/2006-03/episode-8-interview-eric-evans)
*   一[本](https://rads.stackoverflow.com/amzn/click/com/0470147563)使用 C# 中的示例应用 DDD 原理的书
*   Rob Conery 关于领域驱动设计入门的[播客](http://blog.wekeroad.com/mvc-storefront/mvcstore-part-25/)
*   Scott Hanselman 和 Rob Conery 之间关于学习 DDD的[对话。](http://www.hanselman.com/blog/HanselminutesPodcast140RobConeryLearnsAboutDomainDrivenDesign.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-03-14T09:52:06.613

迟到的答案，也许:) 但是，如果有人仍然感兴趣，我在[Epic.NET 项目站点](http://epic.tesio.it/doc/manual/a_shared_modeling_grammar.html)上找到了一些关于 DDD 的非常有用的信息和注意事项。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T21:26:33.933

[Applying Domain-Driven Design and Patterns](https://rads.stackoverflow.com/amzn/click/com/0321268202)是一本关于该主题的非常好的书。很多很好的例子以及对相关主题的讨论，如测试驱动开发及其应用方式。

另请查看[domaindrivendesign.org](http://domaindrivendesign.org/)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-26T16:44:30.733

Casey Charlton 在[http://dddstepbystep.com/](http://dddstepbystep.com/)创建了一个新的 DDD 资源站点。这是一个很棒的参考网站，为 DDD 新手和专家提供了很多信息。

# search - 执行“相关搜索”功能的方法

> ID：123900
> 
> 赞同：3
> 
> 时间：2008-09-23T21:08:12.353
> 
> 标签：search, information-retrieval

我见过一些在您执行搜索时列出相关搜索的网站，即它们会建议您可能感兴趣的其他搜索查询。

我想知道在中型站点中建模的最佳方法（没有足够的流量来依赖访问者统计数据来推断关系）。我最初的想法是存储每个唯一查询的前 10 个结果，然后当执行新搜索以查找与前 10 个结果中的一些匹配但理想情况下不匹配所有结果的所有历史搜索（匹配所有这些结果可能建议等效搜索，因此作为建议没有那么有用）。

我想有些人之前已经完成了这个功能，并且可能能够提供一些不同方法的想法。我不一定要寻找一个成功的想法，因为解决方案无疑会根据网站的大小和性质而有很大差异。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T22:00:19.483

为此，我尝试了许多不同的方法，并取得了不同程度的成功。最后，我认为最好的方法高度依赖于被搜索的域/主题，以及用户如何形成查询。

您对存储以前的搜索的想法对我来说似乎是合理的。我很想知道它在实践中是如何工作的（我的意思是，以最真诚的方式——有许多细微差别会导致这些技术在“现实世界”中失败，尤其是在数据稀疏的情况下）。

以下是我过去使用过的一些技术，并在文献中看到过：

1.  基于词库的方法：为用户使用过的每个术语编制一个词库索引，然后使用一些启发式方法过滤同义词以向用户显示可能的搜索词。
2.  词干和搜索：词干搜索词（例如：使用[Porter Stemming Algorithm](http://tartarus.org/~martin/PorterStemmer/)，然后使用词干词代替最初提供的查询，并让用户可以选择*准确*搜索他们指定的词（或执行相反的操作） , 首先搜索确切的词条，然后使用词干来查找词根相同的词条。第二种方法显然需要对已知字典进行一些预处理，或者您可以在索引词找到它们时收集词条。）
3.  链接：解析用户查询找到的结果并从前 N 个结果中提取关键术语（[KEA](http://www.nzdl.org/Kea/)是您可以查看关键字提取技术的一种库/算法。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T22:08:21.820

您是否考虑过一个轴上的关键字与另一个轴上的文档的矩阵。一旦找到代表关键字的向量集，找到在初始结果集中找到的关键字集，然后找到一种方法来根据其他关键字引用的文档数量或它们与初始结果集相交的次数对其他关键字进行排名.

# java - 如何使用我的 Mac 钥匙串中的证书签署 Java 小程序？

> ID：123902
> 
> 赞同：16
> 
> 时间：2008-09-23T21:09:07.797
> 
> 标签：java, macos, certificate, signing, keychain

我的 Mac 钥匙串中只有代码签名扩展（没有其他扩展）的自签名根证书；我用它来签署所有来自∞实验室的代码，使用 Apple 的代码设计工具，它工作得很好。

我正在寻求扩展自己并进行一些 Java 开发。我知道Apple提供了一个从钥匙串中读取的KeyStore实现，我可以列出我在'链中拥有的所有证书：

```
keytool -list -provider com.apple.crypto.provider.Apple -storetype KeychainStore -keystore NONE -v 
```

但是，每当我尝试使用 jarsigner 来签署一个简单的测试 JAR 文件时，我都会得到：

```
$ jarsigner -keystore NONE -storetype KeychainStore -providerName Apple a.jar infinitelabs_codesigning_2
Enter Passphrase for keystore: <omitted>
jarsigner: Certificate chain not found for: infinitelabs_codesigning_2\.  infinitelabs_codesigning_2 must reference a valid KeyStore key entry containing a private key and corresponding public key certificate chain. 
```

我究竟做错了什么？

（证书是按照[Apple 获取签名身份的说明](http://developer.apple.com/documentation/Security/Conceptual/CodeSigningGuide/Procedures/chapter_3_section_2.html#//apple_ref/doc/uid/TP40005929-CH4-SW1)创建的。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-26T03:13:44.970

我认为您的密钥库条目别名一定是错误的。您是否使用条目类型为“keyEntry”的密钥库对象的别名？相同的命令对我来说非常有效。

从 jarsigner 手册页：

> 使用 jarsigner 对 JAR 文件进行签名时，您必须为包含生成签名所需的私钥的密钥库条目指定别名。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-07-26T00:34:03.060

我也一直在尝试这样做。我经历了一些扭曲，使用密钥库资源管理器，[我丢失了我的公钥。我可以从私钥中恢复它吗？](https://stackoverflow.com/questions/16847081/i-lost-my-public-key-can-i-recover-it-from-a-private-key)，我能够从 .keystore 文件中提取证书、私钥和公钥，并将它们移动到 OSX 钥匙串中。请注意，在这种情况下，我可能不需要公钥。

如果我给 jarsigner 私钥的名称（而不是我基于该密钥的自签名证书的名称），那么我会收到您提到的错误。

我的猜测是您的问题是以下问题之一

*   您的钥匙串包含证书但不包含私钥
*   您的钥匙串包含私钥但不包含证书
*   “infinitelabs_codesigning_2”指的是私钥而不是证书

我可以使用您的 jarsigner 命令行（谢谢！）并获得正确的结果，我使用 jarsigner -verify 进行了检查。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-28T18:59:08.690

您是否尝试过从苹果钥匙串中导出密钥并通过 keytool 导入？也许 Apple 没有将 keytool 与他们的钥匙串正确集成（不像他们在支持 Java 方面有着出色的记录）。

编辑：

嗯...我刚刚尝试从我导入到苹果钥匙串（具有私钥/公钥）的java商店中获取一个有效的密钥，但它不起作用。所以我的导入是错误的，你不能以这种方式访问​​苹果钥匙串，或者其他事情出错了:-)

# c# - C#下载HTTP目录下的所有文件

> ID：123911
> 
> 赞同：1
> 
> 时间：2008-09-23T21:11:34.780
> 
> 标签：c#, http, download

如何下载 HTTP 服务器上一个目录和所有子目录中的所有文件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T21:14:15.023

通过使用像 wget 这样的命令行工具，而不是重新发明轮子。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T21:20:45.817

如果在服务器上启用了目录浏览，那么您可以爬取目录列表，即使用 HttpWebRequest 获取列表页面，解析响应以找到文件链接，下载每个文件（也使用 HttpWebRequest），导航到每个子文件夹，冲洗并重复。

如果未启用目录浏览，则您无法真正下载所有子目录中的所有文件，因为您不知道它们存在。

但是，您仍然可以使用 HttpWebRequest 来抓取暴露的网页并下载任何感兴趣的链接文件。

# c# - 如何从 BinaryReader 简化网络字节顺序转换？

> ID：123918
> 
> 赞同：8
> 
> 时间：2008-09-23T21:13:55.663
> 
> 标签：c#, .net, networking

System.IO.BinaryReader 以 little-endian 格式读取值。

我有一个 C# 应用程序连接到服务器端的专有网络库。正如人们所期望的那样，服务器端以网络字节顺序发送所有内容，但我发现在客户端处理这个很尴尬，特别是对于无符号值。

```
UInt32 length = (UInt32)IPAddress.NetworkToHostOrder(reader.ReadInt32()); 
```

是我想出的从流中获取正确的无符号值的唯一方法，但这看起来既尴尬又丑陋，我还没有测试这是否会剪掉高阶值，以便我有做有趣的 BitConverter 的东西。

是否有某种方法我缺少围绕整个事物编写一个包装器以避免每次读取时出现这些丑陋的转换？似乎读者应该有一个字节序选项来使这样的事情变得更简单，但我没有遇到任何事情。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T22:00:25.857

没有内置转换器。这是我的包装器（如您所见，我只实现了我需要的功能，但结构很容易根据您的喜好更改）：

```
/// <summary>
/// Utilities for reading big-endian files
/// </summary>
public class BigEndianReader
{
    public BigEndianReader(BinaryReader baseReader)
    {
        mBaseReader = baseReader;
    }

    public short ReadInt16()
    {
        return BitConverter.ToInt16(ReadBigEndianBytes(2), 0);
    }

    public ushort ReadUInt16()
    {
        return BitConverter.ToUInt16(ReadBigEndianBytes(2), 0);
    }

    public uint ReadUInt32()
    {
        return BitConverter.ToUInt32(ReadBigEndianBytes(4), 0);
    }

    public byte[] ReadBigEndianBytes(int count)
    {
        byte[] bytes = new byte[count];
        for (int i = count - 1; i >= 0; i--)
            bytes[i] = mBaseReader.ReadByte();

        return bytes;
    }

    public byte[] ReadBytes(int count)
    {
        return mBaseReader.ReadBytes(count);
    }

    public void Close()
    {
        mBaseReader.Close();
    }

    public Stream BaseStream
    {
        get { return mBaseReader.BaseStream;  }
    }

    private BinaryReader mBaseReader;
} 
```

基本上，ReadBigEndianBytes 完成了繁重的工作，并将其传递给 BitConverter。如果您读取大量字节，肯定会出现问题，因为这会导致大量内存分配。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T21:17:30.490

我构建了一个自定义 BinaryReader 来处理所有这些。它作为[我 Nextem 库](http://www.assembla.com/wiki/show/nextem)的一部分提供。它还有一种定义二进制结构的非常简单的方法，我认为这会对您有所帮助——查看示例。

注意：目前仅在 SVN 中，但非常稳定。如果您有任何问题，请发送电子邮件至 cody_dot_brocious_at_gmail_dot_com。

# php - 博客软件的自动换行符和格式化

> ID：123920
> 
> 赞同：1
> 
> 时间：2008-09-23T21:14:10.310
> 
> 标签：php, newline, blogs

我正在用自己的 PHP 博客引擎和 MYSQL 后端数据库编写。我的问题是：您将如何让用户评论和博客文章在适当的地方包含换行符？

例如，如果用户在消息/评论框中点击返回键，这将如何转换为在查看评论时显示在浏览器中的新行？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T21:17:02.223

PHP 有一个函数：nl2br 将新行转换为`<br />`

[www.php.net/nl2br](http://us2.php.net/nl2br)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T21:17:38.027

替换`\n\n`为`</p><p>`，然后替换`\n`为`<br>`。

PS：海盗日是上周:)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T13:16:54.710

nl2br() (http://php.net/nl2br) 非常好，但是 Wordpress Guy (Matt Mullenweg) 有一个非常好的功能，它更高级一些，因为它将双换行符转换为段落（在语义上更好）。您可以在 Wordpress 源代码或此处找到它：http: [//ma.tt/scripts/autop/](http://ma.tt/scripts/autop/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T21:34:25.677

评论编辑器的用途也很重要。如果您使用标准文本框，那么可以，nl2br 就是您要找的。如果您要更高级一些，例如使用像 tinyMCE 这样的所见即所得编辑器，那么它的配置可以为您处理。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T13:22:22.467

如果您碰巧需要更多格式选项（段落之外），请使用[Text_Wiki](http://pear.php.net/package/Text_Wiki)或[PHP Markdown](http://michelf.com/projects/php-markdown/)之类的东西。

优点是：

*   无需允许 HTML 并处理所有过滤（这很好:-)）
*   清晰/熟悉的数据格式化指南
*   生成 HTML 时有很大的灵活性（最终用于显示）

缺点：

*   没有 HTML（祝福和诅咒 ;-)）
*   人们可能不熟悉语法

# .net - 如何查找 USB 盘符？

> ID：123927
> 
> 赞同：14
> 
> 时间：2008-09-23T21:15:13.927
> 
> 标签：.net, usb

我正在编写一个安装程序来将应用程序安装到 USB 驱动器。该应用程序只能从 USB 驱动器使用，因此它会通过自动选择要安装的 USB 驱动器为用户节省一个额外的步骤。

我可能会探索使用 Nullsoft 或 MSI 进行安装，但由于我最熟悉 .NET，我最初计划在 .NET 上尝试自定义 .NET 安装程序或设置组件。

是否可以使用 .NET 在 Windows 上确定 USB 闪存驱动器的驱动器号？如何？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-23T21:18:01.847

你可以使用：

```
from driveInfo in DriveInfo.GetDrives()
where driveInfo.DriveType == DriveType.Removable && driveInfo.IsReady
select driveInfo.RootDirectory.FullName 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-23T21:29:35.627

这将枚举系统上没有 LINQ 但仍使用 WMI 的所有驱动器：

```
// browse all USB WMI physical disks

foreach(ManagementObject drive in new ManagementObjectSearcher(
    "select * from Win32_DiskDrive where InterfaceType='USB'").Get())
{
    // associate physical disks with partitions

    foreach(ManagementObject partition in new ManagementObjectSearcher(
        "ASSOCIATORS OF {Win32_DiskDrive.DeviceID='" + drive["DeviceID"]
          + "'} WHERE AssocClass = 
                Win32_DiskDriveToDiskPartition").Get())
    {
        Console.WriteLine("Partition=" + partition["Name"]);

        // associate partitions with logical disks (drive letter volumes)

        foreach(ManagementObject disk in new ManagementObjectSearcher(
            "ASSOCIATORS OF {Win32_DiskPartition.DeviceID='"
              + partition["DeviceID"]
              + "'} WHERE AssocClass =
                Win32_LogicalDiskToPartition").Get())
        {
            Console.WriteLine("Disk=" + disk["Name"]);
        }
    }

    // this may display nothing if the physical disk

    // does not have a hardware serial number

    Console.WriteLine("Serial="
     + new ManagementObject("Win32_PhysicalMedia.Tag='"
     + drive["DeviceID"] + "'")["SerialNumber"]);
} 
```

[来源](http://www.codeproject.com/KB/system/usbeject.aspx)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-09-23T21:30:44.390

C# 2.0 版本的 Kent 代码（从我的头顶，未测试）：

```
IList<String> fullNames = new List<String>();
foreach (DriveInfo driveInfo in DriveInfo.GetDrives()) {
    if (driveInfo.DriveType == DriveType.Removable) {
        fullNames.Add(driveInfo.RootDirectory.FullName);
    }
} 
```

# comments - 您是否对代码中的错误修复使用特殊注释？

> ID：123936
> 
> 赞同：17
> 
> 时间：2008-09-23T21:16:54.143
> 
> 标签：comments

我的一些同事对他们的错误修复使用了特殊的评论，例如：

```
// 2008-09-23 John Doe - bug 12345
// <short description> 
```

这有意义吗？
您是否以特殊方式评论错误修复？

请告诉我。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-23T21:18:51.453

我没有发表这样的评论，源代码控制系统已经维护了该历史记录，并且我已经能够记录文件的历史记录。

我确实发表了评论，描述了为什么正在做一些不明显的事情。因此，如果错误修复使代码的可预测性和清晰度降低，那么我将解释原因。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-23T21:19:17.867

随着时间的推移，这些会累积并增加混乱。最好使代码清晰，为可能不明显的相关问题添加任何注释，并将错误详细信息保留在跟踪系统和存储库中。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-23T21:20:07.380

我倾向于不对实际来源发表评论，因为可能很难保持最新状态。但是，我确实将链接评论放在我的源代码控制日志和问题跟踪器中。例如，我可能会在 Perforce 中做这样的事情：

> [Bug-Id] xyz 对话框有问题。将尺寸调整代码移至 abc，现在稍后进行初始化。

然后在我的问题跟踪器中，我将执行以下操作：

> 已在更改列表 1234 中修复。
> 
> 将尺寸调整代码移至 abc，现在稍后进行初始化。

因为这样就留下了一个很好的历史标记。如果您想知道为什么特定的代码行是某种方式，这也很容易，您只需查看文件历史记录即可。找到代码行后，您可以阅读我的提交评论并清楚地看到它是针对哪个错误以及我如何修复它的。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-23T21:18:04.310

只有当解决方案特别聪明或难以理解时。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-23T21:20:24.087

我通常会添加我的姓名、电子邮件地址和日期以及我所做更改的简短描述，这是因为作为顾问，我经常修复其他人的代码。

```
// Glenn F. Henriksen (<email@company.no) - 2008-09-23
// <Short description> 
```

这样，代码所有者或追随我的人就可以弄清楚发生了什么，并且在必要时可以与我联系。

（是的，不幸的是，他们往往没有源代码控制......对于内部的东西我使用 TFS 跟踪）

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-23T21:21:35.973

虽然这在当时看起来是个好主意，但很快就会失控。使用源代码控制系统和错误跟踪器的良好组合可以更好地捕获此类信息。当然，如果发生了一些棘手的事情，描述情况的注释无论如何都会有帮助，但不是日期、名称或错误编号。

我目前正在工作的代码库已经有 20 年的历史了，他们似乎在几年前添加了很多评论。幸运的是，他们在 90 年代后期将所有东西都转换为 CVS 后几年就停止了。然而，这样的评论仍然散布在整个代码中，现在的政策是“如果你直接处理该代码，则删除它们，否则留下它们”。它们通常很难遵循，特别是如果多次添加和删除相同的代码（是的，它会发生）。它们也不包含日期，但包含你必须在一个古老的系统中查找才能找到日期的错误编号，所以没有人这样做。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-23T21:18:47.897

像这样的评论就是为什么 Subversion 允许你在每次提交时输入一个日志条目。那是你应该把这些东西放在哪里，而不是在代码中。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-23T21:20:00.827

虽然我确实倾向于在工作代码中看到一些关于错误的评论，但我个人的偏好是将代码提交链接到一个错误。当我说一个时，我的意思是一个错误。之后，您可以随时查看所做的更改并知道这些更改应用于哪个错误。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-23T21:22:04.067

如果错误修复涉及不简单的事情，我会这样做，但如果错误修复需要很长的解释，我通常会认为它是修复设计不佳的标志。有时我必须解决一个无法更改的公共接口，因此这往往是这些评论的来源，例如：

```
// <date> [my name] - Bug xxxxx happens when the foo parameter is null, but
// some customers want the behavior.  Jump through some hoops to find a default value. 
```

在其他情况下，源代码控制提交消息是我用来注释更改的。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-23T21:22:39.417

这种评论风格在多开发人员环境中非常有价值，在该环境中，开发人员拥有一系列技能和/或业务知识（例如，无处不在）。

对于经验丰富、知识渊博的开发人员来说，更改的原因可能很明显，但对于新开发人员来说，这些评论会让他们三思而后行，在搞砸之前做更多的调查。它还可以帮助他们更多地了解系统的工作原理。

哦，还有一个关于“我只是把它放在源代码控制系统中”的经验注释：

**如果它不在源头中，它就不会发生。**

由于缺乏源代码控制软件经验、不正确的分支模型等，我无法计算项目源历史记录丢失的次数。只有一个地方**不能丢失**更改历史记录——那就是在源文件中。

我通常先把它放在那里，然后在我签入时剪切并粘贴相同的评论。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-23T21:21:24.740

不，我没有，我讨厌这样的涂鸦乱扔代码。可以在版本控制系统的提交消息中跟踪错误号，并通过脚本将相关的提交消息推送到错误跟踪系统中。我不相信它们属于源代码，未来的编辑只会让事情变得混乱。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-23T21:22:37.110

通常，这样的评论更令人困惑，因为您并没有真正了解原始代码的外观或原始不良行为的上下文。

一般来说，如果您的错误修复现在使代码正确运行，只需简单地保留它而不加注释。无需注释正确的代码。

有时错误修复会让事情看起来很奇怪，或者错误修复正在测试不寻常的东西。那么有一个评论可能是合适的——通常评论应该引用你的错误数据库中的“错误编号”。例如，您可能有一条评论说“错误 123 - 用户在 640 x 480 屏幕分辨率下的奇怪行为”。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-23T21:24:04.920

如果您在维护代码几年后添加这样的注释，您将拥有如此多的错误修复注释，您将无法阅读代码。

但是如果你把一些看起来正确的东西（但有一个微妙的错误）改成了更复杂的东西，最好添加一个简短的注释来解释你做了什么，这样下一个维护这段代码的程序员就不会因为他把它改回来了（或她）认为你无缘无故地把事情复杂化了。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-23T21:31:57.727

不，我使用颠覆，并且总是输入我提交更改的动机的描述。我通常不会用英语重述解决方案，而是总结所做的更改。

我参与过许多项目，他们在修复错误时在代码中添加注释。有趣且可能并非巧合的是，这些项目要么不使用任何类型的源代码控制工具，要么被管理层授权遵循这种约定。

老实说，在大多数情况下，我并没有真正看到这样做的价值。如果我想知道发生了什么变化，我会查看颠覆日志和差异。

只是我的两分钱。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-02-28T06:09:42.673

如果代码被更正了，评论就毫无用处，任何人都不会感兴趣——只是噪音。

如果错误未解决，则注释错误。那么它是有道理的。:) 所以如果你没有真正解决这个错误，就留下这样的评论。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-23T21:20:03.853

为了找到特定的评论，我们使用**DKBUGBUG** - 这意味着 David Kelley 的修复和审阅者可以轻松识别，当然我们将添加日期和其他 VSTS 错误跟踪号等。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-23T21:21:53.757

不要复制 VCS 将为您保留的元数据。日期和名称应由 VCS 自动添加。请求更改的票号、经理/用户名等应在 VCS 注释中，而不是代码中。

而不是这样：

//$DATE $NAME $TICKET //对下一个可怜的灵魂有用的评论

我会这样做：

//对下一个可怜的灵魂有用的评论

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-23T21:27:19.140

如果代码位于实时平台上，而不是直接访问源代码控制存储库，那么我将添加注释以突出显示作为修复实时系统错误的一部分所做的更改。

否则，您在签入时输入的消息不应包含您需要的所有信息。

干杯，

抢

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-23T23:26:35.890

当我在第三方库/组件中进行错误修复/增强时，我经常会发表一些评论。如果我需要使用更新版本的库/组件，这使查找和移动更改变得更容易。

在我自己的代码中，我很少评论错误修正。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2010-02-01T05:55:15.973

我不从事多人项目，但有时我会在单元测试中添加有关某个错误的评论。

请记住，没有错误之类的东西，只是测试不足。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2010-07-14T17:09:29.210

由于我尽可能多地进行 TDD（其他一切都是社交自杀，因为其他所有方法都会迫使您无休止地工作），我很少修复错误。

大多数时候，我会在代码中添加类似这样的特殊注释：

```
// I KNOW this may look strange to you, but I have to use
// this special implementation here - if you don't understand that,
// maybe you are the wrong person for the job. 
```

听起来很刺耳，但大多数自称“开发人员”的人不值得其他评论。

# excel - 是什么导致 Excel VBA 中出现“无效的建议标志”运行时错误？

> ID：123945
> 
> 赞同：0
> 
> 时间：2008-09-23T21:17:43.297
> 
> 标签：excel, runtime-error, vba

我有一个 Excel 宏，每当它获得特定格式的输入时就会生成此错误。有谁知道什么是*建议标志，或者我***在**哪里可以找到有关此类错误的信息？谢谢

 *> 运行时错误 -2147221503 (80040001)：自动化错误，无效的建议标志

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T21:51:52.747

它是 Microsoft 的 OLE 组件的一部分。见[msdn](http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.ole.interop._olecadvf.aspx)

这并不能解决您的问题，但也许您可以在那里找到更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-06-04T03:16:27.210

对于任何拔头发的人；这也可能是自定义错误，与“无效的建议标志”无关：

```
Err.Raise (vbObjectError + 1) 
```

注意：vbObjectError = **-** 2147221504

# wpf - WPF转PDF

> ID：123947
> 
> 赞同：12
> 
> 时间：2008-09-23T21:17:59.523
> 
> 标签：wpf, pdf, pdf-generation

我有一个 WPF 应用程序，我希望能够将应用程序的输出保存到 PDF 文档，我要保存的项目可以是 Visual a Drawing 或 FixedDocument（我可以将其创建为这些选项中的任何一个，并且它们之间的转换很容易）。

是否有任何库可以直接从 WPF 转换为 PDF（无需编写代码来遍历可视化树并使用 PDF 原语重新创建它）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T21:27:10.157

如果您将 WPF 可视化树渲染到 XPS 中，请尝试使用此 XPS 到 PDF 转换器[NIXPS](http://nixps.blogspot.com/2008/04/convert-xps-to-pdf.html)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-03-31T17:56:54.383

对于这个场景，我建议使用[XpsDocumentWriter](http://msdn.microsoft.com/en-us/library/system.windows.xps.xpsdocumentwriter.aspx)类获取 XPS 文档，然后使用[Amyuni PDF Creator将其转换为 PDF](http://www.amyuni.com/en/developer/pdfcreator)
*免责声明：我为 Amyuni Technologies 工作*

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-09-23T14:08:30.957

我们刚刚发布了一个新的库来促进这一点：[NiPDF v1.0](http://nixps.com/nipdf/index.html)

[这是](http://nixps.com/nipdf/example0001.html)我们网站上将 WPF 转换为 PDF 的示例的链接。

它是一个 100% 托管的 .NET 程序集，您无需学习神秘的 API 即可使用它。

# python - 如何在python中获取/设置逻辑目录路径

> ID：123958
> 
> 赞同：10
> 
> 时间：2008-09-23T21:19:37.100
> 
> 标签：python, path, symlink

在 python 中是否可以获取或设置一个逻辑目录（而不是一个绝对目录）。

例如，如果我有：

```
/real/path/to/dir 
```

我有

```
/linked/path/to/dir 
```

链接到同一个目录。

使用 os.getcwd 和 os.chdir 将始终使用绝对路径

```
>>> import os
>>> os.chdir('/linked/path/to/dir')
>>> print os.getcwd()
/real/path/to/dir 
```

我发现解决这个问题的唯一方法是在另一个进程中启动“pwd”并读取输出。但是，这仅在您第一次调用 os.chdir 之前有效。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-23T21:22:43.443

底层操作系统/shell 报告 python 的真实路径。

所以，真的没有办法绕过它，因为它是对 C 库函数`os.getcwd()`的包装调用。`getcwd()`

本着您已经知道正在启动的那个精神，有一些变通方法`pwd`。

另一个将涉及使用`os.environ['PWD']`. 如果设置了该环境变量，您可以创建一些`getcwd`尊重它的功能。

下面的解决方案结合了两者：

```
import os
from subprocess import Popen, PIPE

class CwdKeeper(object):
    def __init__(self):
        self._cwd = os.environ.get("PWD")
        if self._cwd is None: # no environment. fall back to calling pwd on shell
           self._cwd = Popen('pwd', stdout=PIPE).communicate()[0].strip()
        self._os_getcwd = os.getcwd
        self._os_chdir = os.chdir

    def chdir(self, path):
        if not self._cwd:
            return self._os_chdir(path)
        p = os.path.normpath(os.path.join(self._cwd, path))
        result = self._os_chdir(p)
        self._cwd = p
        os.environ["PWD"] = p
        return result

    def getcwd(self):
        if not self._cwd:
            return self._os_getcwd()
        return self._cwd

cwd = CwdKeeper()
print cwd.getcwd()
# use only cwd.chdir and cwd.getcwd from now on.    
# monkeypatch os if you want:
os.chdir = cwd.chdir
os.getcwd = cwd.getcwd
# now you can use os.chdir and os.getcwd as normal. 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-01-14T20:09:30.537

这也对我有用：

```
import os
os.popen('pwd').read().strip('\n') 
```

这是python shell中的演示：

```
>>> import os
>>> os.popen('pwd').read()
'/home/projteam/staging/site/proj\n'
>>> os.popen('pwd').read().strip('\n')
'/home/projteam/staging/site/proj'
>>> # Also works if PWD env var is set
>>> os.getenv('PWD')
'/home/projteam/staging/site/proj'
>>> # This gets actual path, not symlinked path
>>> import subprocess
>>> p = subprocess.Popen('pwd', stdout=subprocess.PIPE)
>>> p.communicate()[0]  # returns non-symlink path
'/home/projteam/staging/deploys/20150114-141114/site/proj\n' 
```

获取环境变量 PWD 并不总是对我有用，所以我使用 popen 方法。干杯!

# url - Java中的URL加密

> ID：123976
> 
> 赞同：7
> 
> 时间：2008-09-23T21:22:00.963
> 
> 标签：url, encryption

在 Java 中使用参数加密 URL 的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T21:58:01.377

这样做的唯一方法是使用 SSL/TLS (https)。如果您使用普通的旧 HTTP，则 URL 肯定会以明文形式发送。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-09T15:42:45.427

不幸的是，Java 中几乎注意到很简单 :-)，对于这个简单而常见的任务，我无法找到准备好的库，我最终写了这个（[这是源代码](http://www.jguru.com/faq/view.jsp?EID=50208)）：

```
 import java.net.URLDecoder;
import java.net.URLEncoder;

import javax.crypto.Cipher;
import javax.crypto.SecretKey;
import javax.crypto.SecretKeyFactory;
import javax.crypto.spec.PBEParameterSpec;

/**
 * An easy to use class to encrypt and decrypt a string. Just call the simplest
 * constructor and the needed methods.
 * 
 */

public class StringEncryptor {
private Cipher encryptCipher;
private Cipher decryptCipher;
private sun.misc.BASE64Encoder encoder = new sun.misc.BASE64Encoder();
private sun.misc.BASE64Decoder decoder = new sun.misc.BASE64Decoder();

final private String charset = "UTF-8";
final private String defaultEncryptionPassword = "PAOSIDUFHQWER98234QWE378AHASDF93HASDF9238HAJSDF923";
final private byte[] defaultSalt = {

(byte) 0xa3, (byte) 0x21, (byte) 0x24, (byte) 0x2c,

(byte) 0xf2, (byte) 0xd2, (byte) 0x3e, (byte) 0x19 };

/**
 * The simplest constructor which will use a default password and salt to
 * encode the string.
 * 
 * @throws SecurityException
 */
public StringEncryptor() throws SecurityException {
    setupEncryptor(defaultEncryptionPassword, defaultSalt);
}

/**
 * Dynamic constructor to give own key and salt to it which going to be used
 * to encrypt and then decrypt the given string.
 * 
 * @param encryptionPassword
 * @param salt
 */
public StringEncryptor(String encryptionPassword, byte[] salt) {
    setupEncryptor(encryptionPassword, salt);
}

public void init(char[] pass, byte[] salt, int iterations) throws SecurityException {
    try {
        PBEParameterSpec ps = new javax.crypto.spec.PBEParameterSpec(salt, 20);

        SecretKeyFactory kf = SecretKeyFactory.getInstance("PBEWithMD5AndDES");

        SecretKey k = kf.generateSecret(new javax.crypto.spec.PBEKeySpec(pass));

        encryptCipher = Cipher.getInstance("PBEWithMD5AndDES/CBC/PKCS5Padding");

        encryptCipher.init(Cipher.ENCRYPT_MODE, k, ps);

        decryptCipher = Cipher.getInstance("PBEWithMD5AndDES/CBC/PKCS5Padding");

        decryptCipher.init(Cipher.DECRYPT_MODE, k, ps);
    } catch (Exception e) {
        throw new SecurityException("Could not initialize CryptoLibrary: " + e.getMessage());
    }
}

/**
 * 
 * method to decrypt a string.
 * 
 * @param str
 *            Description of the Parameter
 * 
 * @return String the encrypted string.
 * 
 * @exception SecurityException
 *                Description of the Exception
 */

public synchronized String encrypt(String str) throws SecurityException {
    try {

        byte[] utf8 = str.getBytes(charset);

        byte[] enc = encryptCipher.doFinal(utf8);

        return URLEncoder.encode(encoder.encode(enc),charset);
    }

    catch (Exception e)

    {
        throw new SecurityException("Could not encrypt: " + e.getMessage());
    }
}

/**
 * 
 * method to encrypting a string.
 * 
 * @param str
 *            Description of the Parameter
 * 
 * @return String the encrypted string.
 * 
 * @exception SecurityException
 *                Description of the Exception
 */

public synchronized String decrypt(String str) throws SecurityException {
    try {

        byte[] dec = decoder.decodeBuffer(URLDecoder.decode(str,charset));
        byte[] utf8 = decryptCipher.doFinal(dec);

        return new String(utf8, charset);

    } catch (Exception e) {
        throw new SecurityException("Could not decrypt: " + e.getMessage());
    }
}

private void setupEncryptor(String defaultEncryptionPassword, byte[] salt) {

    java.security.Security.addProvider(new com.sun.crypto.provider.SunJCE());

    char[] pass = defaultEncryptionPassword.toCharArray();

    int iterations = 3;

    init(pass, salt, iterations);
} 
```

}

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T21:34:53.273

java安全api( [http://java.sun.com/javase/technologies/security/](http://java.sun.com/javase/technologies/security/) )+url编码

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T21:58:53.200

这取决于您的威胁模型。例如，如果您想保护 Java 应用程序发送到服务器的参数免受有权访问通信通道的攻击者的攻击，您应该考虑通过 TLS/SSL（即，在您的情况下为 HTTPS）与服务器通信，并且喜欢。如果您想保护参数免受有权访问运行您的 Java 客户端应用程序的机器的攻击者的攻击，那么您将陷入更深的麻烦。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T15:09:31.990

如果您真的不能使用**SSL**，我建议您使用预共享密钥方法并添加随机 iv。

您可以使用任何体面的对称加密方法，例如。AES 使用您在带外通信（电子邮件、电话等）的预共享密钥。

然后你生成一个随机初始化向量并用这个 iv 和密钥加密你的字符串。最后，您将密文和 iv 连接起来并将其作为参数发送。iv 可以明文进行交流，没有任何风险。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T21:31:30.677

你确定你不是指 URL **encode**吗？

编码可通过`java.net.URLEncoder.encode`.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-09T15:50:18.393

加密 HTTP 流量的标准方法是使用 SSL。~~然而，即使通过 HTTPS，URL 和其中的任何参数（即 GET 请求）也会以明文形式发送。您需要使用 SSL 并执行 POST 请求来正确加密您的数据。~~

正如评论中指出的，无论您使用什么 HTTP 方法，只要您使用 SSL 连接，参数都会被加密。

# actionscript - 有没有更好的方法来使用没有 eval 的字符串来获取对动作脚本中影片剪辑的引用

> ID：123979
> 
> 赞同：1
> 
> 时间：2008-09-23T21:22:22.647
> 
> 标签：actionscript

我创建了一堆电影剪辑，它们都具有相似的名称，然后在其他一些事件之后，我建立了一个字符串，例如：

```
var clipName = "barLeft42" 
```

它被保存在另一个名为“事物”的电影剪辑中。

我已经能够使用以下方法获得参考：

```
var movieClip = Eval( "_root.thing." + clipName ) 
```

但这感觉很糟糕——有更好的方法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T21:27:17.830

电影剪辑是 actionscript 中的集合（与大多数类似并且类似于 javascript，所有内容基本上都是键值对）。您可以使用方括号和键名的字符串对集合进行索引，例如：

```
_root.thing[ "barLeft42" ] 
```

那应该对你有用...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T03:38:54.990

避免使用 deprecated 的更好方法`eval`是使用方括号进行索引：

```
var movieClip = _root.thing[ "barLeft42" ] 
```

但最好的方法是保留对您制作的剪辑的引用，并通过引用而不是名称来访问它们：

```
var movieClipArray = new Array();
for (var i=0; i<45; i++) {
    var mc = _root.thing.createEmptyMovieClip( "barLeft"+i, i );
    // ...
    movieClipArray.push( mc );
}

// ...

var movieClip = movieClipArray[ 42 ]; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T14:09:47.740

您可以使用括号并在其中包含变量...因此，如果您想遍历它们，您可以这样做：

```
for (var i=0; i<99; i++) {
  var clipName = _root.thing["barLeft"+i];
} 
```

# .net - 如何确定 USB 闪存驱动器制造商？

> ID：123986
> 
> 赞同：7
> 
> 时间：2008-09-23T21:22:47.950
> 
> 标签：.net, usb

我需要我的程序仅适用于某些 USB 闪存驱动器（来自单个制造商）并忽略所有其他 USB 闪存驱动器（来自任何其他制造商）。

是否可以使用 .NET 2.0 检查是否在 Windows 上插入了特定的 USB 卡？如何？

如果我通过 WMI 找到它，我能以某种方式确定 USB 驱动器在哪个驱动器号上吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-23T21:53:27.767

**编辑：**添加代码以打印驱动器号。

* * *

检查此示例是否适合您。它使用 WMI。

```
Console.WriteLine("Manufacturer: {0}", queryObj["Manufacturer"]);
...
Console.WriteLine("    Name: {0}", c["Name"]); // here it will print drive letter 
```

完整的代码示例：

```
namespace WMISample
{
    using System;
    using System.Management;

    public class MyWMIQuery
    {
        public static void Main()
        {
            try
            {
                ManagementObjectSearcher searcher =
                    new ManagementObjectSearcher("root\\CIMV2",
                    "SELECT * FROM Win32_DiskDrive");

                foreach (ManagementObject queryObj in searcher.Get())
                {
                    Console.WriteLine("DeviceID: {0}", queryObj["DeviceID"]);
                    Console.WriteLine("PNPDeviceID: {0}", queryObj["PNPDeviceID"]);
                    Console.WriteLine("Manufacturer: {0}", queryObj["Manufacturer"]);
                    Console.WriteLine("Model: {0}", queryObj["Model"]);
                    foreach (ManagementObject b in queryObj.GetRelated("Win32_DiskPartition"))
                    {
                        Console.WriteLine("  Name: {0}", b["Name"]);
                        foreach (ManagementBaseObject c in b.GetRelated("Win32_LogicalDisk"))
                        {
                            Console.WriteLine("    Name: {0}", c["Name"]); // here it will print drive letter
                        }
                    }
                    // ...
                    Console.WriteLine("--------------------------------------------");
                }      
            }
            catch (ManagementException e)
            {
                Console.WriteLine(e.StackTrace);
            }

            Console.ReadLine();
        }
    }
} 
```

我认为这些属性应该可以帮助您将真正的 USB 驱动器与其他驱动器区分开来。使用多个笔式驱动器进行测试以检查值是否相同。在此处查看**Win32_DiskDrive**属性的完整参考：

[http://msdn.microsoft.com/en-us/library/aa394132(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa394132(VS.85).aspx)

检查这篇文章是否对您也有帮助：

[http://social.msdn.microsoft.com/Forums/en-US/csharpgeneral/thread/48a9758c-d4db-4144-bad1-e87f2e9fc979](http://social.msdn.microsoft.com/Forums/en-US/csharpgeneral/thread/48a9758c-d4db-4144-bad1-e87f2e9fc979)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T21:50:53.390

您可以使用非托管 Win32 API 调用来处理此问题。

[http://www.codeproject.com/KB/system/EnumDeviceProperties.aspx](http://www.codeproject.com/KB/system/EnumDeviceProperties.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T21:54:30.387

通过 Win32 CM_（设备管理）或 WMI 并获取 PNP ID。查找 VID（供应商 ID）。

`Win32_USBControllerDevice`我在和下看到了我刚刚插入的设备的信息`Win32_DiskDrive`。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T21:55:25.797

您可以通过 WMI 获取此信息。下面是一个 vbs 脚本（复制到带有 .vbs 的文本文件以运行），它使用 WMI 来获取有关[Win32_DiskDrive](http://msdn.microsoft.com/en-us/library/aa394132(VS.85).aspx "MSDN Win32_DiskDrive")对象的一些信息。制造商信息可能只是说标准磁盘驱动器，但型号可能包含您要查找的内容。

```
Set Drives = GetObject("winmgmts:{impersonationLevel=impersonate,(Backup)}").ExecQuery("select * from Win32_DiskDrive")
for each drive in drives
Wscript.echo "Drive Information:" & vbnewline & _
       "Availability: " & drive.Availability & vbnewline & _
       "BytesPerSector: " & drive.BytesPerSector & vbnewline & _
       "Caption: " & drive.Caption & vbnewline & _
       "CompressionMethod: " & drive.CompressionMethod & vbnewline & _
       "ConfigManagerErrorCode: " & drive.ConfigManagerErrorCode & vbnewline & _
       "ConfigManagerUserConfig: " & drive.ConfigManagerUserConfig & vbnewline & _
       "CreationClassName: " & drive.CreationClassName & vbnewline & _
       "DefaultBlockSize: " & drive.DefaultBlockSize & vbnewline & _
       "Description: " & drive.Description & vbnewline & _
       "DeviceID: " & drive.DeviceID & vbnewline & _
       "ErrorCleared: " & drive.ErrorCleared & vbnewline & _
       "ErrorDescription: " & drive.ErrorDescription & vbnewline & _
       "ErrorMethodology: " & drive.ErrorMethodology & vbnewline & _
       "Index: " & drive.Index & vbnewline & _
       "InterfaceType: " & drive.InterfaceType & vbnewline & _
       "LastErrorCode: " & drive.LastErrorCode & vbnewline & _
       "Manufacturer: " & drive.Manufacturer & vbnewline & _
       "MaxBlockSize: " & drive.MaxBlockSize & vbnewline & _
       "MaxMediaSize: " & drive.MaxMediaSize & vbnewline & _
       "MediaLoaded: " & drive.MediaLoaded & vbnewline & _
       "MediaType: " & drive.MediaType & vbnewline & _
       "MinBlockSize: " & drive.MinBlockSize & vbnewline & _
       "Model: " & drive.Model & vbnewline & _
       "Name: " & drive.Name & vbnewline & _
       "NeedsCleaning: " & drive.NeedsCleaning & vbnewline & _
       "NumberOfMediaSupported: " & drive.NumberOfMediaSupported & vbnewline & _
       "Partitions: " & drive.Partitions & vbnewline & _
       "PNPDeviceID: " & drive.PNPDeviceID & vbnewline & _
       "PowerManagementSupported: " & drive.PowerManagementSupported & vbnewline & _
       "SCSIBus: " & drive.SCSIBus & vbnewline & _
       "SCSILogicalUnit: " & drive.SCSILogicalUnit & vbnewline & _
       "SCSIPort: " & drive.SCSIPort & vbnewline & _
       "SCSITargetId: " & drive.SCSITargetId & vbnewline & _
       "SectorsPerTrack: " & drive.SectorsPerTrack & vbnewline & _
       "Signature: " & drive.Signature & vbnewline & _
       "Size: " & drive.Size & vbnewline & _
       "Status: " & drive.Status & vbnewline & _
       "StatusInfo: " & drive.StatusInfo & vbnewline & _
       "SystemCreationClassName: " & drive.SystemCreationClassName & vbnewline & _
       "SystemName: " & drive.SystemName & vbnewline & _         
       "TotalCylinders: " & drive.TotalCylinders & vbnewline & _         
       "TotalHeads: " & drive.TotalHeads & vbnewline & _        
       "TotalSectors: " & drive.TotalSectors & vbnewline & _        
       "TotalTracks: " & drive.TotalTracks & vbnewline & _         
       "TracksPerCylinder: " & drive.TracksPerCylinder & vbnewline
next 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T22:15:46.403

如果`Win32_DiskDrive`对象没有产生您正在寻找的信息，您还可以查看 WMI 对象的[Win32_PhysicalMedia](http://msdn.microsoft.com/en-us/library/aa394346(VS.85).aspx)类。它们具有可能被证明有用的制造商、型号、零件编号和描述属性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T21:43:08.370

也许#usblib：

[http://www.icsharpcode.net/OpenSource/SharpUSBLib/](http://www.icsharpcode.net/OpenSource/SharpUSBLib/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T21:58:49.893

嗨，在使用 WMI 时试试这个

```
Option Explicit
Dim objWMIService, objItem, colItems, strComputer

' On Error Resume Next
strComputer = "."

Set objWMIService = GetObject("winmgmts:\\" _
& strComputer & "\root\cimv2")
Set colItems = objWMIService.ExecQuery(_
"Select Manufacturer from Win32_DiskDrive")

For Each objItem in colItems
Wscript.Echo "Computer: " & objItem.SystemName & VbCr & _
   "Manufacturer: " & objItem.Manufacturer & VbCr & _
   "Model: " & objItem.Model
Next 
```

模型可能比制造商更有帮助。如果您现在只想将您的应用程序锁定到一个制造商和一个（某些）固件版本，您可以查看 FirmwareRevision。

希望能帮助到你。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-08-04T09:40:23.063

以防万一其他人足够疯狂地在 C++-CLI 中执行此操作，这里是 smink 答案的一个端口：

```
using namespace System;
using namespace System::Management;

void GetUSBDeviceList()
{
    try
    {
        ManagementObjectSearcher^ searcher =
            gcnew ManagementObjectSearcher("root\\CIMV2",
            "SELECT * FROM Win32_DiskDrive");

        for each (ManagementObject^ queryObj in searcher->Get())
        {
            Console::WriteLine("DeviceID: {0}", queryObj["DeviceID"]);
            Console::WriteLine("PNPDeviceID: {0}", queryObj["PNPDeviceID"]);
            Console::WriteLine("Manufacturer: {0}", queryObj["Manufacturer"]);
            Console::WriteLine("Model: {0}", queryObj["Model"]);
            for each (ManagementObject^ b in queryObj->GetRelated("Win32_DiskPartition"))
            {
                Console::WriteLine("  Name: {0}", b["Name"]);
                for each (ManagementBaseObject^ c in b->GetRelated("Win32_LogicalDisk"))
                {
                    Console::WriteLine("    Name: {0}", c["Name"]); // here it will print drive letter
                }
            }
            // ...
            Console::WriteLine("--------------------------------------------");
        }      
    }
    catch (ManagementException^ e)
    {
        Console::WriteLine(e->StackTrace);
    }

    Console::ReadLine();
} 
```

`System.Management`注意：我必须在我的项目属性中手动添加对库的引用。

# c# - URLDecode 后 QueryString 格式错误

> ID：123994
> 
> 赞同：15
> 
> 时间：2008-09-23T21:24:08.697
> 
> 标签：c#, asp.net, url

我正在尝试通过 QueryString 将 Base64 字符串传递给 C#.Net Web 应用程序。当字符串到达​​时，“+”（加号）符号被替换为空格。似乎自动 URLDecode 过程正在执行此操作。我无法控制通过 QueryString 传递的内容。有没有办法处理这个服务器端？

例子：

```
http://localhost:3399/Base64.aspx?VLTrap=VkxUcmFwIHNldCB0byAiRkRTQT8+PE0iIHBsdXMgb3IgbWludXMgNSBwZXJjZW50Lg== 
```

产生：

```
VkxUcmFwIHNldCB0byAiRkRTQT8 PE0iIHBsdXMgb3IgbWludXMgNSBwZXJjZW50Lg== 
```

人们建议对查询字符串进行 URLEncoding：

```
System.Web.HttpUtility.UrlEncode(yourString) 
```

我不能这样做，因为我无法控制调用例程（它可以与其他语言一起正常工作）。

还有用加号替换空格的建议：

```
Request.QueryString["VLTrap"].Replace(" ", "+"); 
```

我有这个想法，但我对此感到担忧，我应该首先提到这一点，我不知道除了加号之外还有哪些*其他*字符可能格式不正确。

***我的主要目标是在 QueryString 通过解码器之前拦截它。***

为此，我尝试查看 Request.QueryString.toString() 但这包含相同的格式错误的信息。有什么方法可以在URLDecoded*之前查看原始 QueryString 吗？*

经过进一步测试，.Net 似乎希望从 QuerString 进来的所有内容都经过 URL 编码，但浏览器不会自动对 GET 请求进行 URL 编码。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-16T08:09:35.840

建议的解决方案：

```
Request.QueryString["VLTrap"].Replace(" ", "+"); 
```

应该工作得很好。至于你的担心：

> 我有这个想法，但我对此感到担忧，我应该首先提到这一点，我不知道除了加号之外还有哪些其他字符可能格式不正确。

这很容易通过[阅读 base64](http://en.wikipedia.org/wiki/Base64)来缓解。现代 base64 中唯一合法的非字母数字字符是“/”、“+”和“=”（仅用于填充）。

其中，“+”是唯一一个在 URL 中作为转义表示具有特殊含义的符号。虽然其他两个在 URL 中具有特殊含义（路径分隔符和查询字符串分隔符），但它们不应该造成问题。

所以我觉得你应该没问题。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-23T21:29:48.013

您可以手动替换值 ( `argument.Replace(' ', '+')`) 或查阅`HttpRequest.ServerVariables["QUERY_STRING"]`（更好的是 HttpRequest.Url.Query）并自己解析它。

但是，您应该尝试解决给出 URL 的问题；加号需要在 URL 中编码为“%2B”，因为加号表示空格。

如果您不控制入站 URL，则首选第一个选项，因为这样可以避免大多数错误。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-01-26T10:52:35.607

除了我可以控制我的网址外，我遇到了完全相同的问题。即使使用`Server.URLDecode`并且`Server.URLEncode`它不会将其转换回`+`符号，即使我的查询字符串如下所示：

```
http://localhost/childapp/default.aspx?TokenID=0XU%2fKUTLau%2bnSWR7%2b5Z7DbZrhKZMyeqStyTPonw1OdI%3d

```

当我执行以下操作时。

```
string tokenID = Server.UrlDecode(Request.QueryString["TokenID"]); 
```

它仍然没有将`%2b`背面转换为`+`标志。相反，我必须执行以下操作：

```
string tokenID = Server.UrlDecode(Request.QueryString["TokenID"]);
tokenID = tokenID.Replace(" ", "+"); 
```

然后它可以正常工作。真的很奇怪。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-01-20T11:01:08.163

我对包含 Base64 值的参数以及带有“+”的参数有类似的问题。只有 Request.QueryString["VLTrap"].Replace(" ", "+"); 对我来说工作得很好；没有 UrlEncode 或其他编码帮助，因为即使您自己在页面上显示编码链接，使用 '+' 编码为 '%2b'，然后浏览器会在显示时将其更改为 '+'，然后单击它时浏览器会更改它到空的空间。因此，即使您自己显示链接，也无法像原始海报所说的那样控制它。即使在 html 电子邮件中，此类链接也是如此。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-04-01T17:35:12.280

如果您使用`System.Uri.UnescapeDataString(yourString)`它将忽略`+`. 此方法应仅在像您这样的情况下使用，即在客户端或服务器上使用某种遗留方法对字符串进行编码。

请参阅此博客文章：http: [//blogs.msdn.com/b/yangxind/archive/2006/11/09/don-t-use-net-system-uri-unescapedatastring-in-url-decoding.aspx](http://blogs.msdn.com/b/yangxind/archive/2006/11/09/don-t-use-net-system-uri-unescapedatastring-in-url-decoding.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T21:26:21.750

如果您在将字符串添加到 URL 之前对字符串进行 URLEncode，您将不会遇到任何这些问题（自动 URLDecode 会将其返回到原始状态）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T21:29:00.090

好吧，显然你应该在将它发送到服务器之前有 Base64 字符串 URLEncoded。
如果你不能做到这一点，我建议简单地将任何嵌入的空格替换回 +；因为 b64 字符串不应该有空格，所以它是一种合法的策略......

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-23T21:31:35.200

`System.Web.HttpUtility.UrlEncode(yourString)`会成功的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-23T21:34:21.823

作为一种快速破解，您可以在 base64 解码之前用加号替换空格。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T21:27:34.117

我绝不是 C# 开发人员，但看起来您需要先对您的 Base64 字符串进行 url 编码，然后再将其作为 url 发送。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T21:27:34.913

你不能假设一个空格是一个 + 并替换它吗？

```
Request.QueryString["VLTrap"].Replace(" ", "+"); 
```

;)

# javascript - 如何判断 DOM 元素在当前视口中是否可见？

> ID：123999
> 
> 赞同：1147
> 
> 时间：2008-09-23T21:24:56.057
> 
> 标签：javascript, html, firefox, dom, browser

有没有一种有效的方法来判断 DOM 元素（在 HTML 文档中）当前是否可见（出现在**视口中**）？

（问题指的是 Firefox。）

* * *

## 回答 #1

> 赞同：1590
> 
> 时间：2011-09-26T15:27:32.377

现在[大多数浏览器都](http://www.quirksmode.org/dom/w3c_cssom.html)支持[getBoundingClientRect](https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect)方法，这已成为最佳实践。使用旧答案非常慢，[不准确](http://weblogs.asp.net/bleroy/archive/2008/01/29/getting-absolute-coordinates-from-a-dom-element.aspx)并且[有几个错误](http://javascript.info/tutorial/coordinates)。

选择为正确的解决方案[几乎从不精确](http://www.quirksmode.org/js/findpos.html)。

* * *

此解决方案已在 Internet Explorer 7（及更高版本）、iOS 5（及更高版本）Safari、[Android 2.0](https://en.wikipedia.org/wiki/Android_Eclair) (Eclair) 及更高版本、BlackBerry、Opera Mobile 和 Internet Explorer Mobile ^([9](http://ejohn.org/blog/getboundingclientrect-is-awesome/))上进行了测试。

* * *

```
function isElementInViewport (el) {

    // Special bonus for those using jQuery
    if (typeof jQuery === "function" && el instanceof jQuery) {
        el = el[0];
    }

    var rect = el.getBoundingClientRect();

    return (
        rect.top >= 0 &&
        rect.left >= 0 &&
        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) && /* or $(window).height() */
        rect.right <= (window.innerWidth || document.documentElement.clientWidth) /* or $(window).width() */
    );
} 
```

* * *

## 如何使用：

您可以确定上面给出的函数在调用它时会返回正确的答案，但是跟踪元素作为事件的可见性呢？

将以下代码放在`<body>`标签底部：

```
function onVisibilityChange(el, callback) {
    var old_visible;
    return function () {
        var visible = isElementInViewport(el);
        if (visible != old_visible) {
            old_visible = visible;
            if (typeof callback == 'function') {
                callback();
            }
        }
    }
}

var handler = onVisibilityChange(el, function() {
    /* Your code go here */
});

// jQuery
$(window).on('DOMContentLoaded load resize scroll', handler);

/* // Non-jQuery
if (window.addEventListener) {
    addEventListener('DOMContentLoaded', handler, false);
    addEventListener('load', handler, false);
    addEventListener('scroll', handler, false);
    addEventListener('resize', handler, false);
} else if (window.attachEvent)  {
    attachEvent('onDOMContentLoaded', handler); // Internet Explorer 9+ :(
    attachEvent('onload', handler);
    attachEvent('onscroll', handler);
    attachEvent('onresize', handler);
}
*/ 
```

* * *

如果您进行任何 DOM 修改，它们当然可以改变您元素的可见性。

**指导方针和常见陷阱：**

**也许您需要跟踪页面缩放/移动设备夹点？**jQuery 应该处理[缩放/捏](http://api.jquery.com/resize/)跨浏览器，否则[第一个](https://stackoverflow.com/questions/995914/catch-browsers-zoom-event-in-javascript)或[第二个](https://stackoverflow.com/questions/11183174/simplest-way-to-detect-a-pinch)链接应该可以帮助你。

如果您**修改 DOM**，它可能会影响元素的可见性。您应该控制它并`handler()`手动调用。不幸的是，我们没有任何跨浏览器`onrepaint`事件。另一方面，这允许我们进行优化并仅对可能改变元素可见性的 DOM 修改执行重新检查。

**永远不要**只在 jQuery [$(document).ready()](http://api.jquery.com/ready/)中使用它，因为此时[没有保证 CSS 已应用](https://stackoverflow.com/questions/1324568/is-document-ready-also-css-ready)。您的代码可以在本地与硬盘上的 CSS 一起工作，但一旦放在远程服务器上，它就会失败。

`DOMContentLoaded`触发后，[应用样式](https://stackoverflow.com/questions/3520780/when-is-window-onload-fired)，但[尚未加载图像](https://stackoverflow.com/questions/8835413/difference-between-load-vs-domcontentloaded)。所以，我们应该添加`window.onload`事件监听器。

我们还不能捕捉缩放/捏合事件。

最后的手段可能是以下代码：

```
/* TODO: this looks like a very bad code */
setInterval(handler, 600); 
```

如果您关心您的网页的选项卡是否处于活动状态且可见，您可以使用 HTML5 API 的超棒功能[pageVisibiliy 。](https://developer.mozilla.org/en-US/docs/DOM/Using_the_Page_Visibility_API)

TODO：此方法不处理两种情况：

*   重叠使用`z-index`.
*   `overflow-scroll`在元素的容器中使用。
*   尝试一些新*[的东西 - Intersection Observer API 解释](https://pawelgrzybek.com/the-intersection-observer-api-explained/)*。

* * *

## 回答 #2

> 赞同：400
> 
> 时间：2008-09-24T02:40:09.047

**更新：**时间在进步，我们的浏览器也在进步。**不再推荐这种技术**，如果您不需要支持 7 之前的 Internet Explorer 版本，您应该使用[Dan 的解决方案。](https://stackoverflow.com/questions/123999/how-can-i-tell-if-a-dom-element-is-visible-in-the-current-viewport/7557433#7557433)

**原始解决方案（现已过时）：**

这将检查元素是否在当前视口中完全可见：

```
function elementInViewport(el) {
  var top = el.offsetTop;
  var left = el.offsetLeft;
  var width = el.offsetWidth;
  var height = el.offsetHeight;

  while(el.offsetParent) {
    el = el.offsetParent;
    top += el.offsetTop;
    left += el.offsetLeft;
  }

  return (
    top >= window.pageYOffset &&
    left >= window.pageXOffset &&
    (top + height) <= (window.pageYOffset + window.innerHeight) &&
    (left + width) <= (window.pageXOffset + window.innerWidth)
  );
} 
```

您可以简单地修改它以确定元素的任何部分是否在视口中可见：

```
function elementInViewport2(el) {
  var top = el.offsetTop;
  var left = el.offsetLeft;
  var width = el.offsetWidth;
  var height = el.offsetHeight;

  while(el.offsetParent) {
    el = el.offsetParent;
    top += el.offsetTop;
    left += el.offsetLeft;
  }

  return (
    top < (window.pageYOffset + window.innerHeight) &&
    left < (window.pageXOffset + window.innerWidth) &&
    (top + height) > window.pageYOffset &&
    (left + width) > window.pageXOffset
  );
} 
```

* * *

## 回答 #3

> 赞同：221
> 
> 时间：2013-03-04T14:18:08.580

## 更新

在现代浏览器中，您可能需要查看[Intersection Observer API](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API)，它提供以下好处：

*   比监听滚动事件更好的性能
*   适用于跨域 iframe
*   可以判断一个元素是否阻碍/与另一个元素相交

Intersection Observer 正在成为一个成熟的标准，并且已经在 Chrome 51+、Edge 15+ 和 Firefox 55+ 中得到支持，并且正在为 Safari 开发。还有一个[polyfill](https://github.com/w3c/IntersectionObserver/tree/master/polyfill)可用。

* * *

## 上一个答案

[Dan 提供](https://stackoverflow.com/a/7557433/94197)的答案存在一些问题，这可能使其不适用于某些情况。他在底部附近的回答中指出了其中一些问题，他的代码将对以下元素给出误报：

*   被正在测试的元素前面的另一个元素隐藏
*   在父元素或祖先元素的可见区域之外
*   `clip`使用 CSS属性隐藏的元素或其子元素

这些限制在以下[简单测试](http://jsfiddle.net/AndyE/d48Cv/1)的结果中得到了证明：

![测试失败，使用 isElementInViewport](https://i.stack.imgur.com/xdo9l.png)

## 解决方案：`isElementVisible()`

这是解决这些问题的方法，下面是测试结果以及对代码某些部分的解释。

```
function isElementVisible(el) {
    var rect     = el.getBoundingClientRect(),
        vWidth   = window.innerWidth || document.documentElement.clientWidth,
        vHeight  = window.innerHeight || document.documentElement.clientHeight,
        efp      = function (x, y) { return document.elementFromPoint(x, y) };     

    // Return false if it's not in the viewport
    if (rect.right < 0 || rect.bottom < 0 
            || rect.left > vWidth || rect.top > vHeight)
        return false;

    // Return true if any of its four corners are visible
    return (
          el.contains(efp(rect.left,  rect.top))
      ||  el.contains(efp(rect.right, rect.top))
      ||  el.contains(efp(rect.right, rect.bottom))
      ||  el.contains(efp(rect.left,  rect.bottom))
    );
} 
```

> **通过测试：http:** [//jsfiddle.net/AndyE/cAY8c/](http://jsfiddle.net/AndyE/cAY8c/)

结果：

![通过测试，使用 isElementVisible](https://i.stack.imgur.com/Yg3u7.png)

## 补充笔记

然而，这种方法并非没有其自身的局限性。例如，一个被测试的元素的 z-index 低于同一位置的另一个元素，即使前面的元素实际上并没有隐藏它的任何部分，它也会被标识为隐藏。尽管如此，这种方法在 Dan 的解决方案未涵盖的某些情况下仍有其用途。

两者都是 CSSOM 工作草案规范的一部分，并且至少在 IE 6 及更高版本以及`element.getBoundingClientRect()`大多数*桌面*浏览器中得到了很长时间的支持（尽管并不完美）。有关更多信息，请参阅[有关这些功能的 Quirksmode](http://www.quirksmode.org/dom/w3c_cssom.html#documentview)。`document.elementFromPoint()`

 *`contains()`用于查看返回的`document.elementFromPoint()`元素是否是我们正在测试可见性的元素的子节点。如果返回的元素是相同的元素，它也会返回 true。这只会使检查更加健壮。所有主流浏览器都支持它，Firefox 9.0 是最后一个添加它的浏览器。对于较旧的 Firefox 支持，请查看此答案的历史记录。

如果您想在元素周围测试更多点的可见性——即确保元素不被超过 50% 覆盖——调整答案的最后部分并不需要太多。但是，请注意，如果您检查每个像素以确保其 100% 可见，它可能会非常慢。

* * *

## 回答 #4

> 赞同：88
> 
> 时间：2013-04-29T02:36:20.560

我尝试了[Dan 的回答](/a/7557433/315024)，但是，用于确定边界的代数意味着元素必须既 ≤ 视口大小又完全在视口内才能获取`true`，很容易导致误报。如果你想确定一个元素是否在视口中，[ryanve 的答案](/a/12418814/315024)很接近，但被测试的元素应该与视口重叠，所以试试这个：

```
function isElementInViewport(el) {
    var rect = el.getBoundingClientRect();

    return rect.bottom > 0 &&
        rect.right > 0 &&
        rect.left < (window.innerWidth || document.documentElement.clientWidth) /* or $(window).width() */ &&
        rect.top < (window.innerHeight || document.documentElement.clientHeight) /* or $(window).height() */;
} 
```

* * *

## 回答 #5

> 赞同：41
> 
> 时间：2014-09-25T12:54:30.237

作为一项公共服务：
Dan 的正确计算（元素可以是 > 窗口，尤其是在手机屏幕上）和正确的 jQuery 测试以及添加 isElementPartiallyInViewport 的答案：

顺便说一句， window.innerWidth 和 document.documentElement.clientWidth 之间[的区别](http://www.quirksmode.org/mobile/viewports.html)在于 clientWidth/clientHeight 不包括滚动条，而 window.innerWidth/Height 则包括。

```
function isElementPartiallyInViewport(el)
{
    // Special bonus for those using jQuery
    if (typeof jQuery !== 'undefined' && el instanceof jQuery) 
        el = el[0];

    var rect = el.getBoundingClientRect();
    // DOMRect { x: 8, y: 8, width: 100, height: 100, top: 8, right: 108, bottom: 108, left: 8 }
    var windowHeight = (window.innerHeight || document.documentElement.clientHeight);
    var windowWidth = (window.innerWidth || document.documentElement.clientWidth);

    // http://stackoverflow.com/questions/325933/determine-whether-two-date-ranges-overlap
    var vertInView = (rect.top <= windowHeight) && ((rect.top + rect.height) >= 0);
    var horInView = (rect.left <= windowWidth) && ((rect.left + rect.width) >= 0);

    return (vertInView && horInView);
}

// http://stackoverflow.com/questions/123999/how-to-tell-if-a-dom-element-is-visible-in-the-current-viewport
function isElementInViewport (el)
{
    // Special bonus for those using jQuery
    if (typeof jQuery !== 'undefined' && el instanceof jQuery) 
        el = el[0];

    var rect = el.getBoundingClientRect();
    var windowHeight = (window.innerHeight || document.documentElement.clientHeight);
    var windowWidth = (window.innerWidth || document.documentElement.clientWidth);

    return (
           (rect.left >= 0)
        && (rect.top >= 0)
        && ((rect.left + rect.width) <= windowWidth)
        && ((rect.top + rect.height) <= windowHeight)
    );
}

function fnIsVis(ele)
{
    var inVpFull = isElementInViewport(ele);
    var inVpPartial = isElementPartiallyInViewport(ele);
    console.clear();
    console.log("Fully in viewport: " + inVpFull);
    console.log("Partially in viewport: " + inVpPartial);
} 
```

### 测试用例

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Test</title>
    <!--
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="scrollMonitor.js"></script>
    -->

    <script type="text/javascript">

        function isElementPartiallyInViewport(el)
        {
            // Special bonus for those using jQuery
            if (typeof jQuery !== 'undefined' && el instanceof jQuery) 
                el = el[0];

            var rect = el.getBoundingClientRect();
            // DOMRect { x: 8, y: 8, width: 100, height: 100, top: 8, right: 108, bottom: 108, left: 8 }
            var windowHeight = (window.innerHeight || document.documentElement.clientHeight);
            var windowWidth = (window.innerWidth || document.documentElement.clientWidth);

            // http://stackoverflow.com/questions/325933/determine-whether-two-date-ranges-overlap
            var vertInView = (rect.top <= windowHeight) && ((rect.top + rect.height) >= 0);
            var horInView = (rect.left <= windowWidth) && ((rect.left + rect.width) >= 0);

            return (vertInView && horInView);
        }

        // http://stackoverflow.com/questions/123999/how-to-tell-if-a-dom-element-is-visible-in-the-current-viewport
        function isElementInViewport (el)
        {
            // Special bonus for those using jQuery
            if (typeof jQuery !== 'undefined' && el instanceof jQuery) 
                el = el[0];

            var rect = el.getBoundingClientRect();
            var windowHeight = (window.innerHeight || document.documentElement.clientHeight);
            var windowWidth = (window.innerWidth || document.documentElement.clientWidth);

            return (
                   (rect.left >= 0)
                && (rect.top >= 0)
                && ((rect.left + rect.width) <= windowWidth)
                && ((rect.top + rect.height) <= windowHeight)
            );
        }

        function fnIsVis(ele)
        {
            var inVpFull = isElementInViewport(ele);
            var inVpPartial = isElementPartiallyInViewport(ele);
            console.clear();
            console.log("Fully in viewport: " + inVpFull);
            console.log("Partially in viewport: " + inVpPartial);
        }

        // var scrollLeft = (window.pageXOffset !== undefined) ? window.pageXOffset : (document.documentElement || document.body.parentNode || document.body).scrollLeft,
        // var scrollTop = (window.pageYOffset !== undefined) ? window.pageYOffset : (document.documentElement || document.body.parentNode || document.body).scrollTop;
    </script>
</head>

<body>
    <div style="display: block; width: 2000px; height: 10000px; background-color: green;">

        <br /><br /><br /><br /><br /><br />
        <br /><br /><br /><br /><br /><br />
        <br /><br /><br /><br /><br /><br />

        <input type="button" onclick="fnIsVis(document.getElementById('myele'));" value="det" />

        <br /><br /><br /><br /><br /><br />
        <br /><br /><br /><br /><br /><br />
        <br /><br /><br /><br /><br /><br />

        <div style="background-color: crimson; display: inline-block; width: 800px; height: 500px;" ></div>
        <div id="myele" onclick="fnIsVis(this);" style="display: inline-block; width: 100px; height: 100px; background-color: hotpink;">
        t
        </div>

        <br /><br /><br /><br /><br /><br />
        <br /><br /><br /><br /><br /><br />
        <br /><br /><br /><br /><br /><br />

        <input type="button" onclick="fnIsVis(document.getElementById('myele'));" value="det" />
    </div>

    <!--
    <script type="text/javascript">

        var element = document.getElementById("myele");
        var watcher = scrollMonitor.create(element);

        watcher.lock();

        watcher.stateChange(function() {
            console.log("state changed");
            // $(element).toggleClass('fixed', this.isAboveViewport)
        });
    </script>
    -->
</body>
</html> 
```

* * *

## 回答 #6

> 赞同：37
> 
> 时间：2012-09-14T05:49:34.013

请参阅使用[getBoundingClientRect的](https://developer.mozilla.org/en-US/docs/DOM/element.getBoundingClientRect)[verge](https://github.com/ryanve/verge#verge)的来源。就像是：

```
function inViewport (element) {
  if (!element) return false;
  if (1 !== element.nodeType) return false;

  var html = document.documentElement;
  var rect = element.getBoundingClientRect();

  return !!rect &&
    rect.bottom >= 0 &&
    rect.right >= 0 && 
    rect.left <= html.clientWidth &&
    rect.top <= html.clientHeight;
} 
```

`true`如果元素的**任何**部分在视口中，它就会返回。

* * *

## 回答 #7

> 赞同：33
> 
> 时间：2014-04-23T03:04:03.753

我更短更快的版本：

```
function isElementOutViewport(el){
    var rect = el.getBoundingClientRect();
    return rect.bottom < 0 || rect.right < 0 || rect.left > window.innerWidth || rect.top > window.innerHeight;
} 
```

和一个需要的 jsFiddle：[https ://jsfiddle.net/on1g619L/1/](https://jsfiddle.net/on1g619L/1/)

* * *

## 回答 #8

> 赞同：26
> 
> 时间：2015-08-02T13:40:44.717

我发现没有可用的功能的以[jQuery](https://en.wikipedia.org/wiki/JQuery)为中心的版本令人不安。当我遇到[Dan 的解决方案](https://stackoverflow.com/a/7557433/2401804)时，我发现有机会为喜欢以 jQuery OO 风格编程的人们提供一些东西。它既漂亮又活泼，对我来说就像一种魅力。

**巴达兵巴达热潮**

```
$.fn.inView = function(){
    if(!this.length) 
        return false;
    var rect = this.get(0).getBoundingClientRect();

    return (
        rect.top >= 0 &&
        rect.left >= 0 &&
        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
        rect.right <= (window.innerWidth || document.documentElement.clientWidth)
    );

};

// Additional examples for other use cases
// Is true false whether an array of elements are all in view
$.fn.allInView = function(){
    var all = [];
    this.forEach(function(){
        all.push( $(this).inView() );
    });
    return all.indexOf(false) === -1;
};

// Only the class elements in view
$('.some-class').filter(function(){
    return $(this).inView();
});

// Only the class elements not in view
$('.some-class').filter(function(){
    return !$(this).inView();
}); 
```

**用法**

```
$(window).on('scroll',function(){

    if( $('footer').inView() ) {
        // Do cool stuff
    }
}); 
```

* * *

## 回答 #9

> 赞同：25
> 
> 时间：2019-03-15T11:32:46.247

新的[Intersection Observer API](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API)非常直接地解决了这个问题。

这个解决方案需要一个 polyfill，因为 Safari、Opera 和 Internet Explorer 还不支持这个（polyfill 包含在解决方案中）。

在这个解决方案中，有一个看不见的盒子是目标（观察到的）。当它进入视图时，标题顶部的按钮是隐藏的。一旦盒子离开视图，它就会显示出来。

```
const buttonToHide = document.querySelector('button');

const hideWhenBoxInView = new IntersectionObserver((entries) => {
  if (entries[0].intersectionRatio <= 0) { // If not in view
    buttonToHide.style.display = "inherit";
  } else {
    buttonToHide.style.display = "none";
  }
});

hideWhenBoxInView.observe(document.getElementById('box'));
```

```
header {
  position: fixed;
  top: 0;
  width: 100vw;
  height: 30px;
  background-color: lightgreen;
}

.wrapper {
  position: relative;
  margin-top: 600px;
}

#box {
  position: relative;
  left: 175px;
  width: 150px;
  height: 135px;
  background-color: lightblue;
  border: 2px solid;
}
```

```
<script src="https://polyfill.io/v2/polyfill.min.js?features=IntersectionObserver"></script>
<header>
  <button>NAVIGATION BUTTON TO HIDE</button>
</header>
  <div class="wrapper">
    <div id="box">
    </div>
  </div>
```

* * *

## 回答 #10

> 赞同：25
> 
> 时间：2021-07-05T21:49:32.393

我们现在有一个原生的 javascript [Intersection Observer API](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API) ，我们可以从中检测元素是否在视口中。

这是示例

```
const el = document.querySelector('#el')
const observer = new window.IntersectionObserver(([entry]) => {
  if (entry.isIntersecting) {
    console.log('ENTER')
    return
  }
  console.log('LEAVE')
}, {
  root: null,
  threshold: 0.1, // set offset 0.1 means trigger if atleast 10% of element in viewport
})

observer.observe(el);
```

```
body {
  height: 300vh;
}

#el {
  margin-top: 100vh;
}
```

```
<div id="el">this is element</div>
```

* * *

## 回答 #11

> 赞同：17
> 
> 时间：2019-07-30T19:54:40.400

**作为支持[Element.getBoundingClientRect()](https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect)**的最简单的解决方案**已经[变得完美](https://caniuse.com/#search=getBoundingClientRect)了：**

 **```
function isInView(el) {
  const box = el.getBoundingClientRect();
  return box.top < window.innerHeight && box.bottom >= 0;
} 
```

* * *

## 回答 #12

> 赞同：16
> 
> 时间：2016-06-23T17:47:56.950

我在这里遇到的所有答案只检查元素是否**位于当前视口内**。但这**并不意味着它是可见的**。
如果给定元素位于内容溢出的 div 中，并且它被滚动到视图之外怎么办？

为了解决这个问题，您必须检查该元素是否被所有父母所包含。
我的解决方案正是这样做的：

它还允许您指定元素的可见程度。

```
Element.prototype.isVisible = function(percentX, percentY){
    var tolerance = 0.01;   //needed because the rects returned by getBoundingClientRect provide the position up to 10 decimals
    if(percentX == null){
        percentX = 100;
    }
    if(percentY == null){
        percentY = 100;
    }

    var elementRect = this.getBoundingClientRect();
    var parentRects = [];
    var element = this;

    while(element.parentElement != null){
        parentRects.push(element.parentElement.getBoundingClientRect());
        element = element.parentElement;
    }

    var visibleInAllParents = parentRects.every(function(parentRect){
        var visiblePixelX = Math.min(elementRect.right, parentRect.right) - Math.max(elementRect.left, parentRect.left);
        var visiblePixelY = Math.min(elementRect.bottom, parentRect.bottom) - Math.max(elementRect.top, parentRect.top);
        var visiblePercentageX = visiblePixelX / elementRect.width * 100;
        var visiblePercentageY = visiblePixelY / elementRect.height * 100;
        return visiblePercentageX + tolerance > percentX && visiblePercentageY + tolerance > percentY;
    });
    return visibleInAllParents;
}; 
```

该解决方案忽略了由于其他事实（例如`opacity: 0`.

我已经在 Chrome 和 Internet Explorer 11 中测试了这个解决方案。

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2015-01-30T14:49:11.457

我发现对于大多数用例来说，这里接受的答案过于复杂。这段代码很好地完成了这项工作（使用 jQuery）并区分了完全可见和部分可见的元素：

```
var element         = $("#element");
var topOfElement    = element.offset().top;
var bottomOfElement = element.offset().top + element.outerHeight(true);
var $window         = $(window);

$window.bind('scroll', function() {

    var scrollTopPosition   = $window.scrollTop()+$window.height();
    var windowScrollTop     = $window.scrollTop()

    if (windowScrollTop > topOfElement && windowScrollTop < bottomOfElement) {
        // Element is partially visible (above viewable area)
        console.log("Element is partially visible (above viewable area)");

    } else if (windowScrollTop > bottomOfElement && windowScrollTop > topOfElement) {
        // Element is hidden (above viewable area)
        console.log("Element is hidden (above viewable area)");

    } else if (scrollTopPosition < topOfElement && scrollTopPosition < bottomOfElement) {
        // Element is hidden (below viewable area)
        console.log("Element is hidden (below viewable area)");

    } else if (scrollTopPosition < bottomOfElement && scrollTopPosition > topOfElement) {
        // Element is partially visible (below viewable area)
        console.log("Element is partially visible (below viewable area)");

    } else {
        // Element is completely visible
        console.log("Element is completely visible");
    }
}); 
```

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2015-04-24T15:12:46.937

我认为这是一种更实用的方法。 [丹的答案](https://stackoverflow.com/questions/123999/how-can-i-tell-if-a-dom-element-is-visible-in-the-current-viewport/7557433#7557433)在递归上下文中不起作用。

当您的元素在其他可滚动的 div 中时，此函数通过递归测试任何级别直到 HTML 标记来解决问题，并在第一个 false 处停止。

```
/**
 * fullVisible=true only returns true if the all object rect is visible
 */
function isReallyVisible(el, fullVisible) {
    if ( el.tagName == "HTML" )
            return true;
    var parentRect=el.parentNode.getBoundingClientRect();
    var rect = arguments[2] || el.getBoundingClientRect();
    return (
            ( fullVisible ? rect.top    >= parentRect.top    : rect.bottom > parentRect.top ) &&
            ( fullVisible ? rect.left   >= parentRect.left   : rect.right  > parentRect.left ) &&
            ( fullVisible ? rect.bottom <= parentRect.bottom : rect.top    < parentRect.bottom ) &&
            ( fullVisible ? rect.right  <= parentRect.right  : rect.left   < parentRect.right ) &&
            isReallyVisible(el.parentNode, fullVisible, rect)
    );
}; 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2014-02-07T11:39:43.453

这是我的解决方案。如果元素隐藏在可滚动容器中，它将起作用。

[这是一个演示](http://jsfiddle.net/W33YR/3/)（尝试重新调整窗口大小）

```
var visibleY = function(el){
    var top = el.getBoundingClientRect().top, rect, el = el.parentNode;
    do {
        rect = el.getBoundingClientRect();
        if (top <= rect.bottom === false)
            return false;
        el = el.parentNode;
    } while (el != document.body);
    // Check it's within the document viewport
    return top <= document.documentElement.clientHeight;
}; 
```

我只需要检查它是否在 Y 轴上可见（对于滚动 Ajax 加载更多记录功能）。

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2019-11-17T09:37:42.817

在 Android 上放大 Google Chrome 时，最接受的答案不起作用。结合[Dan 的回答](https://stackoverflow.com/questions/123999/how-to-tell-if-a-dom-element-is-visible-in-the-current-viewport/7557433#7557433)，为了说明 Android 上的 Chrome，必须使用[visualViewport 。](https://developers.google.com/web/updates/2017/09/visual-viewport-api)以下示例仅考虑垂直检查并使用 jQuery 作为窗口高度：

```
var Rect = YOUR_ELEMENT.getBoundingClientRect();
var ElTop = Rect.top, ElBottom = Rect.bottom;
var WindowHeight = $(window).height();
if(window.visualViewport) {
    ElTop -= window.visualViewport.offsetTop;
    ElBottom -= window.visualViewport.offsetTop;
    WindowHeight = window.visualViewport.height;
}
var WithinScreen = (ElTop >= 0 && ElBottom <= WindowHeight); 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2014-12-26T21:00:32.680

基于[dan 的解决方案](https://stackoverflow.com/questions/123999/how-can-i-tell-if-a-dom-element-is-visible-in-the-current-viewport/7557433#7557433)，我尝试清理实现，以便在同一页面上多次使用它更容易：

```
$(function() {

  $(window).on('load resize scroll', function() {
    addClassToElementInViewport($('.bug-icon'), 'animate-bug-icon');
    addClassToElementInViewport($('.another-thing'), 'animate-thing');
    //  repeat as needed ...
  });

  function addClassToElementInViewport(element, newClass) {
    if (inViewport(element)) {
      element.addClass(newClass);
    }
  }

  function inViewport(element) {
    if (typeof jQuery === "function" && element instanceof jQuery) {
      element = element[0];
    }
    var elementBounds = element.getBoundingClientRect();
    return (
      elementBounds.top >= 0 &&
      elementBounds.left >= 0 &&
      elementBounds.bottom <= $(window).height() &&
      elementBounds.right <= $(window).width()
    );
  }

}); 
```

我使用它的方式是，当元素滚动到视图中时，我添加了一个触发 CSS 关键帧动画的类。当您在页面上有 10 多个有条件的动画时，它非常简单，并且效果特别好。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2019-09-12T10:31:00.987

以前答案中的大多数用法在这些方面都失败了：

> -当元素的任何像素可见，但不是“**角落**”时，
> 
> - 当一个元素**大于视口并且居中**时，
> 
> - 他们中的大多数只检查**文档或窗口**中的单个元素。

好吧，对于所有这些问题，我都有一个解决方案，而且好处是：

> `visible`-当任何边只出现一个像素并且不是角落时，您可以返回，
> 
> `visible`-当元素大于视口时，您仍然可以返回，
> 
> - 你可以选择你的`parent element`或者你可以自动让它选择，
> 
> - 也适用于**动态添加的元素**。

如果您检查下面的代码片段，您将看到`overflow-scroll`在元素容器中使用的差异不会造成任何问题，并且即使像素从***任何一侧***出现或当元素大于视口并且我们看到***内部时，也会看到******与此处的其他答案不同***它仍然有效***的元素的像素。***

 ****用法很简单：**

```
// For checking element visibility from any sides
isVisible(element)

// For checking elements visibility in a parent you would like to check
var parent = document; // Assuming you check if 'element' inside 'document'
isVisible(element, parent)

// For checking elements visibility even if it's bigger than viewport
isVisible(element, null, true) // Without parent choice
isVisible(element, parent, true) // With parent choice 
```

**没有它的演示`crossSearchAlgorithm`对于大于视口检查 element3 内部像素的元素很有用：**

```
function isVisible(element, parent, crossSearchAlgorithm) {
    var rect = element.getBoundingClientRect(),
            prect = (parent != undefined) ? parent.getBoundingClientRect() : element.parentNode.getBoundingClientRect(),
        csa = (crossSearchAlgorithm != undefined) ? crossSearchAlgorithm : false,
        efp = function (x, y) { return document.elementFromPoint(x, y) };
    // Return false if it's not in the viewport
    if (rect.right < prect.left || rect.bottom < prect.top || rect.left > prect.right || rect.top > prect.bottom) {
        return false;
    }
    var flag = false;
    // Return true if left to right any border pixel reached
    for (var x = rect.left; x < rect.right; x++) {
        if (element.contains(efp(rect.top, x)) || element.contains(efp(rect.bottom, x))) {
        flag = true;
        break;
      }
    }
    // Return true if top to bottom any border pixel reached
    if (flag == false) {
      for (var y = rect.top; y < rect.bottom; y++) {
        if (element.contains(efp(rect.left, y)) || element.contains(efp(rect.right, y))) {
          flag = true;
          break;
        }
      }
    }
    if(csa) {
      // Another algorithm to check if element is centered and bigger than viewport
      if (flag == false) {
        var x = rect.left;
        var y = rect.top;
        // From top left to bottom right
        while(x < rect.right || y < rect.bottom) {
          if (element.contains(efp(x,y))) {
            flag = true;
            break;
          }
          if(x < rect.right) { x++; }
          if(y < rect.bottom) { y++; }
        }
        if (flag == false) {
          x = rect.right;
          y = rect.top;
          // From top right to bottom left
          while(x > rect.left || y < rect.bottom) {
            if (element.contains(efp(x,y))) {
              flag = true;
              break;
            }
            if(x > rect.left) { x--; }
            if(y < rect.bottom) { y++; }
          }
        }
      }
    }
    return flag;
}

// Check multiple elements visibility
document.getElementById('container').addEventListener("scroll", function() {
    var elementList = document.getElementsByClassName("element");
  var console = document.getElementById('console');
    for (var i=0; i < elementList.length; i++) {
      // I did not define parent, so it will be element's parent
    if (isVisible(elementList[i])) {
          console.innerHTML = "Element with id[" + elementList[i].id + "] is visible!";
      break;
    } else {
        console.innerHTML = "Element with id[" + elementList[i].id + "] is hidden!";
    }
  }
});

// Dynamically added elements
for(var i=4; i <= 6; i++) {
  var newElement = document.createElement("div");
  newElement.id = "element" + i;
  newElement.classList.add("element");
  document.getElementById('container').appendChild(newElement);
}
```

```
#console { background-color: yellow; }
#container {
  width: 300px;
  height: 100px;
  background-color: lightblue;
  overflow-y: auto;
  padding-top: 150px;
  margin: 45px;
}
.element {
  margin: 400px;
  width: 400px;
  height: 320px;
  background-color: green;
}
#element3 {
  position: relative;
  margin: 40px;
  width: 720px;
  height: 520px;
  background-color: green;
}
#element3::before {
  content: "";
  position: absolute;
  top: -10px;
  left: -10px;
  margin: 0px;
  width: 740px;
  height: 540px;
  border: 5px dotted green;
  background: transparent;
}
```

```
<div id="console"></div>
<div id="container">
    <div id="element1" class="element"></div>
    <div id="element2" class="element"></div>
    <div id="element3" class="element"></div>
</div>
```

你看，当你**在 element3 里面**时，它无法判断它是否可见，因为我们只检查元素是否从**边**或**角**可见。

**这包括`crossSearchAlgorithm`允许您`visible`在元素大于视口时仍然返回：**

```
function isVisible(element, parent, crossSearchAlgorithm) {
    var rect = element.getBoundingClientRect(),
            prect = (parent != undefined) ? parent.getBoundingClientRect() : element.parentNode.getBoundingClientRect(),
        csa = (crossSearchAlgorithm != undefined) ? crossSearchAlgorithm : false,
        efp = function (x, y) { return document.elementFromPoint(x, y) };
    // Return false if it's not in the viewport
    if (rect.right < prect.left || rect.bottom < prect.top || rect.left > prect.right || rect.top > prect.bottom) {
        return false;
    }
    var flag = false;
    // Return true if left to right any border pixel reached
    for (var x = rect.left; x < rect.right; x++) {
        if (element.contains(efp(rect.top, x)) || element.contains(efp(rect.bottom, x))) {
        flag = true;
        break;
      }
    }
    // Return true if top to bottom any border pixel reached
    if (flag == false) {
      for (var y = rect.top; y < rect.bottom; y++) {
        if (element.contains(efp(rect.left, y)) || element.contains(efp(rect.right, y))) {
          flag = true;
          break;
        }
      }
    }
    if(csa) {
      // Another algorithm to check if element is centered and bigger than viewport
      if (flag == false) {
        var x = rect.left;
        var y = rect.top;
        // From top left to bottom right
        while(x < rect.right || y < rect.bottom) {
          if (element.contains(efp(x,y))) {
            flag = true;
            break;
          }
          if(x < rect.right) { x++; }
          if(y < rect.bottom) { y++; }
        }
        if (flag == false) {
          x = rect.right;
          y = rect.top;
          // From top right to bottom left
          while(x > rect.left || y < rect.bottom) {
            if (element.contains(efp(x,y))) {
              flag = true;
              break;
            }
            if(x > rect.left) { x--; }
            if(y < rect.bottom) { y++; }
          }
        }
      }
    }
    return flag;
}

// Check multiple elements visibility
document.getElementById('container').addEventListener("scroll", function() {
    var elementList = document.getElementsByClassName("element");
  var console = document.getElementById('console');
    for (var i=0; i < elementList.length; i++) {
      // I did not define parent so it will be element's parent
    // and it will do crossSearchAlgorithm
    if (isVisible(elementList[i],null,true)) {
          console.innerHTML = "Element with id[" + elementList[i].id + "] is visible!";
      break;
    } else {
        console.innerHTML = "Element with id[" + elementList[i].id + "] is hidden!";
    }
  }
});
// Dynamically added elements
for(var i=4; i <= 6; i++) {
  var newElement = document.createElement("div");
  newElement.id = "element" + i;
  newElement.classList.add("element");
  document.getElementById('container').appendChild(newElement);
}
```

```
#console { background-color: yellow; }
#container {
  width: 300px;
  height: 100px;
  background-color: lightblue;
  overflow-y: auto;
  padding-top: 150px;
  margin: 45px;
}
.element {
  margin: 400px;
  width: 400px;
  height: 320px;
  background-color: green;
}
#element3 {
  position: relative;
  margin: 40px;
  width: 720px;
  height: 520px;
  background-color: green;
}
#element3::before {
  content: "";
  position: absolute;
  top: -10px;
  left: -10px;
  margin: 0px;
  width: 740px;
  height: 540px;
  border: 5px dotted green;
  background: transparent;
}
```

```
<div id="console"></div>
<div id="container">
    <div id="element1" class="element"></div>
    <div id="element2" class="element"></div>
    <div id="element3" class="element"></div>
</div>
```

JSFiddle 玩：http: [//jsfiddle.net/BerkerYuceer/grk5az2c/](http://jsfiddle.net/BerkerYuceer/grk5az2c/)

如果元素的任何部分是否显示在视图中，则此代码用于提供更精确的信息。对于性能选项或仅垂直幻灯片，请勿使用此选项！此代码在绘制案例时更有效。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2021-12-24T21:04:37.860

[![视口信息](https://i.stack.imgur.com/E8ETh.png)](https://i.stack.imgur.com/E8ETh.png)

```
/**
 * Returns Element placement information in Viewport
 * @link https://stackoverflow.com/a/70476497/2453148
 *
 * @typedef {object} ViewportInfo - Whether the element is…
 * @property {boolean} isInViewport - fully or partially in the viewport
 * @property {boolean} isPartiallyInViewport - partially in the viewport
 * @property {boolean} isInsideViewport - fully inside viewport
 * @property {boolean} isAroundViewport - completely covers the viewport
 * @property {boolean} isOnEdge - intersects the edge of viewport
 * @property {boolean} isOnTopEdge - intersects the top edge
 * @property {boolean} isOnRightEdge - intersects the right edge
 * @property {boolean} isOnBottomEdge - is intersects the bottom edge
 * @property {boolean} isOnLeftEdge - is intersects the left edge
 *
 * @param el Element
 * @return {Object} ViewportInfo
 */
function getElementViewportInfo(el) {

    let result = {};

    let rect = el.getBoundingClientRect();
    let windowHeight = window.innerHeight || document.documentElement.clientHeight;
    let windowWidth  = window.innerWidth || document.documentElement.clientWidth;

    let insideX = rect.left >= 0 && rect.left + rect.width <= windowWidth;
    let insideY = rect.top >= 0 && rect.top + rect.height <= windowHeight;

    result.isInsideViewport = insideX && insideY;

    let aroundX = rect.left < 0 && rect.left + rect.width > windowWidth;
    let aroundY = rect.top < 0 && rect.top + rect.height > windowHeight;

    result.isAroundViewport = aroundX && aroundY;

    let onTop    = rect.top < 0 && rect.top + rect.height > 0;
    let onRight  = rect.left < windowWidth && rect.left + rect.width > windowWidth;
    let onLeft   = rect.left < 0 && rect.left + rect.width > 0;
    let onBottom = rect.top < windowHeight && rect.top + rect.height > windowHeight;

    let onY = insideY || aroundY || onTop || onBottom;
    let onX = insideX || aroundX || onLeft || onRight;

    result.isOnTopEdge    = onTop && onX;
    result.isOnRightEdge  = onRight && onY;
    result.isOnBottomEdge = onBottom && onX;
    result.isOnLeftEdge   = onLeft && onY;

    result.isOnEdge = result.isOnLeftEdge || result.isOnRightEdge ||
        result.isOnTopEdge || result.isOnBottomEdge;

    let isInX =
        insideX || aroundX || result.isOnLeftEdge || result.isOnRightEdge;
    let isInY =
        insideY || aroundY || result.isOnTopEdge || result.isOnBottomEdge;

    result.isInViewport = isInX && isInY;

    result.isPartiallyInViewport =
        result.isInViewport && result.isOnEdge;

    return result;
} 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2013-02-08T08:57:41.570

更好的解决方案：

```
function getViewportSize(w) {
    var w = w || window;
    if(w.innerWidth != null)
        return {w:w.innerWidth, h:w.innerHeight};
    var d = w.document;
    if (document.compatMode == "CSS1Compat") {
        return {
            w: d.documentElement.clientWidth,
            h: d.documentElement.clientHeight
        };
    }
    return { w: d.body.clientWidth, h: d.body.clientWidth };
}

function isViewportVisible(e) {
    var box = e.getBoundingClientRect();
    var height = box.height || (box.bottom - box.top);
    var width = box.width || (box.right - box.left);
    var viewport = getViewportSize();
    if(!height || !width)
        return false;
    if(box.top > viewport.h || box.bottom < 0)
        return false;
    if(box.right < 0 || box.left > viewport.w)
        return false;
    return true;
} 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2015-09-13T13:59:36.807

我有同样的问题，并通过使用 getBoundingClientRect() 解决了这个问题。

这段代码是完全“通用的”，只需编写一次就可以工作（您不必为您想知道的每个元素都写出它在视口中）。

此代码仅检查它是否在视口中垂直，**而不是水平**。在这种情况下，变量（数组）'elements' 包含您正在检查的所有元素，以便在视口中垂直放置，因此在任何地方抓取您想要的任何元素并将它们存储在那里。

“for循环”循环遍历每个元素并检查它是否在视口中垂直。**每次**用户滚动时都会执行此代码！如果 getBoudingClientRect().top 小于视口的 3/4（元素在视口中的四分之一），它会注册为“在视口中”。

由于代码是通用的，您将想知道“哪个”元素在视口中。要找出它，您可以通过自定义属性、节点名称、id、类名称等来确定它。

这是我的代码（告诉我它是否不起作用；它已经在 Internet Explorer 11、Firefox 40.0.3、Chrome 版本 45.0.2454.85 m、Opera 31.0.1889.174 和 Windows 10 的 Edge 中进行了测试，[还没有 Safari ])...

```
// Scrolling handlers...
window.onscroll = function(){
  var elements = document.getElementById('whatever').getElementsByClassName('whatever');
  for(var i = 0; i != elements.length; i++)
  {
   if(elements[i].getBoundingClientRect().top <= window.innerHeight*0.75 &&
      elements[i].getBoundingClientRect().top > 0)
   {
      console.log(elements[i].nodeName + ' ' +
                  elements[i].className + ' ' +
                  elements[i].id +
                  ' is in the viewport; proceed with whatever code you want to do here.');
   }
}; 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2018-09-28T10:01:57.137

这是一个函数，它告诉元素是否在**父**元素的当前视口中可见：

```
function inParentViewport(el, pa) {
    if (typeof jQuery === "function"){
        if (el instanceof jQuery)
            el = el[0];
        if (pa instanceof jQuery)
            pa = pa[0];
    }

    var e = el.getBoundingClientRect();
    var p = pa.getBoundingClientRect();

    return (
        e.bottom >= p.top &&
        e.right >= p.left &&
        e.top <= p.bottom &&
        e.left <= p.right
    );
} 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2019-03-15T14:06:44.017

尽可能简单，IMO：

```
function isVisible(elem) {
  var coords = elem.getBoundingClientRect();
  return Math.abs(coords.top) <= coords.height;
} 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2015-01-02T12:17:33.793

这将检查元素是否至少部分在视图中（垂直尺寸）：

```
function inView(element) {
    var box = element.getBoundingClientRect();
    return inViewBox(box);
}

function inViewBox(box) {
    return ((box.bottom < 0) || (box.top > getWindowSize().h)) ? false : true;
}

function getWindowSize() {
    return { w: document.body.offsetWidth || document.documentElement.offsetWidth || window.innerWidth, h: document.body.offsetHeight || document.documentElement.offsetHeight || window.innerHeight}
} 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2017-06-19T10:49:18.090

这是对我有用的简单而小型的解决方案。

**示例**：您想查看该元素是否在具有溢出滚动的父元素中可见。

```
$(window).on('scroll', function () {

     var container = $('#sidebar');
     var containerHeight = container.height();
     var scrollPosition = $('#row1').offset().top - container.offset().top;

     if (containerHeight < scrollPosition) {
         console.log('not visible');
     } else {
         console.log('visible');
     }
}) 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2020-03-12T03:19:33.813

这里的所有答案都是确定元素是否完全包含在视口中，而不仅仅是以某种方式可见。例如，如果在视图底部只能看到一半图像，则考虑到“外部”，此处的解决方案将失败。

我有一个用例，我正在通过 进行延迟加载`IntersectionObserver`，但由于在弹出期间发生动画，我不想观察在页面加载时*已经相交的任何图像。*为此，我使用了以下代码：

```
const bounding = el.getBoundingClientRect();
const isVisible = (0 < bounding.top && bounding.top < (window.innerHeight || document.documentElement.clientHeight)) ||
        (0 < bounding.bottom && bounding.bottom < (window.innerHeight || document.documentElement.clientHeight)); 
```

这基本上是检查顶部或底部边界是否在视口中独立。另一端可能在外面，但只要一端在里面，它至少部分是“可见的”。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2017-01-13T06:57:09.597

我使用这个函数（它只检查 y 是否在屏幕内，因为大多数时候不需要 x）

```
function elementInViewport(el) {
    var elinfo = {
        "top":el.offsetTop,
        "height":el.offsetHeight,
    };

    if (elinfo.top + elinfo.height < window.pageYOffset || elinfo.top > window.pageYOffset + window.innerHeight) {
        return false;
    } else {
        return true;
    }

} 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2021-04-16T11:24:37.353

这是一个检查给定元素是否在其父元素中完全可见的片段：

```
export const visibleInParentViewport = (el) => {
  const elementRect = el.getBoundingClientRect();
  const parentRect = el.parentNode.getBoundingClientRect();

  return (
    elementRect.top >= parentRect.top &&
    elementRect.right >= parentRect.left &&
    elementRect.top + elementRect.height <= parentRect.bottom &&
    elementRect.left + elementRect.width <= parentRect.right
  );
} 
```

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2021-10-04T03:25:06.513

Domysee 的回答[https://stackoverflow.com/a/37998526](https://stackoverflow.com/a/37998526)接近正确。

许多示例使用“完全包含在视口中”，他的代码使用百分比来允许部分可见。他的代码还解决了大多数示例忽略的“是父剪辑视图”的问题。

一个缺失的元素是父级滚动条的影响——`getBoundingClientRect`返回父级的外部矩形，其中包括滚动条，而不是内部矩形，后者不包含。子级可以隐藏在父级滚动条后面，并且在不可见时被视为可见。

推荐的观察者模式不适合我的用例：使用箭头键更改表中当前选定的行，并确保新选择可见。为此使用观察者将过于复杂。

这是一些代码 -

它包括一个额外的 hack ( `fudgeY`)，因为我的表格有一个粘性标题，无法通过直接的方式检测到（并且自动处理这个会非常乏味）。此外，对于所需的可见分数，它使用小数（0 到 1）而不是百分比。（对于我的情况，我需要完整的 y，而 x 不相关）。

```
function intersectRect(r1, r2) {
    var r = {};
    r.left = r1.left < r2.left ? r2.left : r1.left;
    r.top = r1.top < r2.top ? r2.top : r1.top;
    r.right = r1.right < r2.right ? r1.right : r2.right;
    r.bottom = r1.bottom < r2.bottom ? r1.bottom : r2.bottom;
    if (r.left < r.right && r.top < r.bottom)
        return r;
    return null;
}

function innerRect(e) {
    var b,r;
    b = e.getBoundingClientRect();
    r = {};
    r.left = b.left;
    r.top = b.top;
    r.right = b.left + e.clientWidth;
    r.bottom = b.top + e.clientHeight;
    return r;
}

function isViewable(e, fracX, fracY, fudgeY) {
    // ref https://stackoverflow.com/a/37998526
    // intersect all the rects and then check the result once
    // innerRect: mind the scroll bars
    // fudgeY: handle "sticky" thead in parent table.  Ugh.
    var r, pr, er;

    er = e.getBoundingClientRect();
    r = er;
    for (;;) {
        e = e.parentElement;
        if (!e)
            break;
        pr = innerRect(e);
        if (fudgeY)
            pr.top += fudgeY;
        r = intersectRect(r, pr);
        if (!r)
            return false;
    }

    if (fracX && ((r.right-r.left) / (er.right-er.left)) < (fracX-0.001))
        return false;
    if (fracY && ((r.bottom-r.top) / (er.bottom-er.top)) < (fracY-0.001))
        return false;
    return true;
} 
```

* * *

## 回答 #30

> 赞同：-2
> 
> 时间：2016-03-14T13:14:21.917

对于类似的挑战，我真的很喜欢[这个](https://gist.github.com/hsablonniere/2581101)为[scrollIntoViewIfNeeded()](https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoViewIfNeeded)公开 polyfill 的要点。

回答所需的所有必要功夫都在此块内：

```
var parent = this.parentNode,
    parentComputedStyle = window.getComputedStyle(parent, null),
    parentBorderTopWidth = parseInt(parentComputedStyle.getPropertyValue('border-top-width')),
    parentBorderLeftWidth = parseInt(parentComputedStyle.getPropertyValue('border-left-width')),
    overTop = this.offsetTop - parent.offsetTop < parent.scrollTop,
    overBottom = (this.offsetTop - parent.offsetTop + this.clientHeight - parentBorderTopWidth) > (parent.scrollTop + parent.clientHeight),
    overLeft = this.offsetLeft - parent.offsetLeft < parent.scrollLeft,
    overRight = (this.offsetLeft - parent.offsetLeft + this.clientWidth - parentBorderLeftWidth) > (parent.scrollLeft + parent.clientWidth),
    alignWithTop = overTop && !overBottom; 
```

`this`指的是您想知道的元素，例如，`overTop`或者`overBottom`-您应该得到漂移...*******