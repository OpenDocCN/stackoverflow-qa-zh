# StackOverflow 问答 000310000-000310999

# c++ - 用于 C++ 的 cfront

> ID：310000
> 
> 赞同：3
> 
> 时间：2008-11-21T20:01:56.137
> 
> 标签：c++, c, cfront

cfront 工具是否可用于新的 C++？对于任何其他现代语言？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-25T12:45:13.317

[Comeau C/C++](http://comeaucomputing.com/)是一个 C 生成 C++ 编译器，如 cfront。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T20:14:38.247

“cfront 工具”是什么意思？Cfront 是第一个 C++ 编译器。但由于未能添加异常支持，[因此已停产](http://en.wikipedia.org/wiki/Cfront)。现代 C++ 远远超出了 Cfront 的范围。

> 对于任何其他现代语言？

你是什​​么意思？如果您的意思是是否存在将高级语言编译为 C 代码的其他编译器，那么答案是肯定的，有很多。[Glasgow Haskell 编译器](http://en.wikipedia.org/wiki/Glasgow_Haskell_Compiler)只是其中之一。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T04:20:15.787

[比格卢](http://www-sop.inria.fr/mimosa/fp/Bigloo/)

> Bigloo 实现了 Scheme 和 C 程序之间、Scheme 和 Java 程序之间以及 Scheme 和 C# 程序之间的完全连接。

[策略-C](http://dynamo.iro.umontreal.ca/~gambit/wiki/index.php/Main_Page)

[策略基准](http://dynamo.iro.umontreal.ca/~gambit/wiki/index.php/Gambit_benchmarks)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-21T21:04:26.960

我相信许多语言，至少在它们的起步阶段，只是“编译”成 C 代码，让一个好的编译器（通常是 gcc ......）生成优化的本机代码。我认为[GHC](http://haskell.org/ghc/ "GHC")是（对于某些实现？）这样的语言，还有一些我不记得了。

我也知道 lua2c，将 Lua 代码转换为 C。

# asp.net - ASP.NET UserControl 上的事件每隔一次点击就会引发一次？

> ID：310002
> 
> 赞同：1
> 
> 时间：2008-11-21T20:02:11.953
> 
> 标签：asp.net, events, user-controls

是的，这里有一个类似的[问题](https://stackoverflow.com/questions/42554/cant-get-my-event-to-fire)。但是，该问题似乎没有附加代码（尽管它可能在某些时候有；我看到暗示代码的答案），并且接受的答案（和其他建议）并没有让我到达我需要的地方成为。

我有一个相当复杂的，坦率地说设计得不好的 VB.NET Web 应用程序，我正在扩展一个新功能。该功能的简短形式是它允许管理用户重新定位主页上的某些元素。在此阶段，重新设计 Web 部件不是一种选择。

允许调整大小的管理页面使用简单的用户控件来表示主页上可以移动的每个“框”（请原谅我的 ascii 艺术）：

```
+------------+
| Box Title  |
+------------+
|     /\     |
|   < X  >   |
|     \/     |
+------------+ 
```

四个箭头（和中心 X 或眼睛，取决于框的可见性）是`ImageButton`s。每个`ImageButton`的`Click`事件都连接到类似于以下的代码：

```
RaiseEvent WidgetMoved(Me, New WidgetMovedEventArgs(WidgetMoveDirection.Up, widgetIDField.Value)) 
```

托管页面（本身位于 a 上`MasterPage`）在绑定到确定它们位置的数据后启动这些用户控件：

```
For i as Integer = 0 To count
    Dim widget As MyWidget = widgets(i) '' widgets is a collection
    Dim box as controls_CustomizeWidget = BindWidget(WidgetColumns.Left, i, count, widget) '' This simply uses LoadControl and places the control in one of two placeholders
    AddHandler box.WidgetMoved, AddressOf widget_WidgetMoved
    AddHandler box.WidgetVisibleChanged, AddressOf widget_WidgetVisibleChanged 
Next 
```

每次页面加载时都会调用带有此代码的方法，无论我是否处于回发状态。（我“实时保存”数据；您进行更改，它会在该回发时保存到数据库中，然后重新加载。）

每隔一个*回*发，用户控件按钮事件不会触发。他们启动了一个新的回发，并且在这第二个回发中他们开火了。所以，基本上，我的控件需要两次点击才能完成任何事情。

具体来说，再次在`Page.Load`事件处理程序中初始化控件。我试过了`PreInit`，但这没有用，因为页面结构的其余部分尚未构建，因此尝试将它们放在适当`PlaceHolder`的 s 中失败并带有`NullReferenceException`. 我在网上搜索过，没有看到类似的东西，我不得不承认，在我从用户控件引发事件的所有其他场景中（例如本网站的*每个*页面），都没有问题。另一方面，这是站点上唯一一个在运行时动态加载带有事件的用户控件的页面......

我现在感觉很愚蠢。每次都能可靠地引发事件有什么帮助吗？我究竟做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T20:52:44.317

我有一个类似的问题，最终成为事件处理程序中的一些代码，这些代码搞砸了重新连接到按钮的事件。我认为这是在单击事件导致更改后我正在重新加载控件，但正在重新创建控件的容器，而不仅仅是重新绑定。

希望有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T22:13:18.087

弄清楚了。bdukes在他的[回答中说：](https://stackoverflow.com/questions/310002/events-on-aspnet-usercontrol-raise-every-other-click#310156)

> 我认为这是在单击事件导致更改后我正在重新加载控件，但正在重新创建控件的容器，而不仅仅是重新绑定。

这基本上就是这里的情况。我从事件处理程序为所述控件调用的方法中调用了第二次创建控件的方法。这是重新创建控件，这似乎导致回发混乱。我用老式的 Trace 验证了这一点。

我把它清理掉了，现在我还有一些其他的错误要解决——但我可以自己解决这些问题。谢谢各位大佬！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-30T18:59:07.223

出现此问题的原因是用户控件在第一次回发后更改名称。

如果您覆盖“ClientID”和“UniqueID”，强制两者都返回预定义的值，则可以解决此问题（请参阅[链接文本](http://www.west-wind.com/WebLog/posts/4605.aspx)）

# ssl - 您可以将 SSL 放在 IP 地址上还是仅放在 Web 服务器的域名上？

> ID：310003
> 
> 赞同：27
> 
> 时间：2008-11-21T20:03:19.877
> 
> 标签：ssl

在 Web 应用程序中，如果它没有域名（例如 Web 服务），您还可以将 SSL 证书添加到 IP 地址吗？

如果是，如何？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-11-21T20:50:11.593

您可以通过与普通主机名相同的过程轻松地将 IP 地址放入 ssl 证书的 CN（通用名称）中（ssl 证书包含主机名，而不是域名）。

由于您没有说明您的情况是什么，因此无法回答在您的情况下如何准确地完成此操作。

浏览器应将证书的 CN 与用户在 URL 栏中输入的内容进行匹配。如果是ip地址，那就是ip地址。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-11-05T01:18:06.230

[该站点](https://www.ssl247.com/ssl-certificates/type/ip)提供 IP 地址证书。但是，您将无法（正确）将证书用于 IP 地址的域名。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-06-05T14:24:26.680

是的，你可以，但它并不常见，可能不便携，而且通常不是一个好主意......

**公共 IP 地址**

SSL 证书通常颁发给*完全限定域名*(FQDN)，但颁发者仍然可以为公共 IP 地址提供 SSL 证书，通常在证书的 CN 和 SAN 值中声明，因为从历史上看，这些证书被不同的风格引用/浏览器版本。然而，该设施可能仅提供优质产品，例如覆盖整个组织的“*组织验证*”（OV）证书，或在获得时需要严格审查的“*扩展验证”（EV）证书。*

**私有 IP 地址空间**（192.168.0.0/16、172.16.0.0/12、10.0.0.0/8）

2015 年 11 月，*CA/浏览器论坛*禁止在公开信任的 SSL 证书中使用内部服务器名称和保留 IP 地址。然而，一些发行者仍然提供“*内网证书*”服务，允许企业继续向内部服务器名称和保留 IP 地址颁发 SSL，而无需运行自己的 CA 或使用自签名证书，而是使用发行者自己的非公开CA。

在这种情况下，可以将内部服务器名称和保留的 IP 地址存储在证书的 CN 和 SAN 值中。这些还可能允许在公共层次结构下不允许使用的选项，包括使用 SHA-1 和 4-5 年证书等，此外，您可以在一个非公共根下的单个证书。

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2008-11-21T20:13:53.350

这里有一些很好的信息： [https ://www.thawte.com/ssl-digital-certificates/technical-support/browserfaqs.html](https://www.thawte.com/ssl-digital-certificates/technical-support/browserfaqs.html)

我几乎可以肯定您需要一个域才能使用 SSL。

# technical-debt - 是否存在不值得承担的特定“技术债务”？

> ID：310010
> 
> 赞同：6
> 
> 时间：2008-11-21T20:05:00.950
> 
> 标签：technical-debt

技术债务有（至少）两种方式进入项目。首先是有意识的决定。有些问题不值得预先解决，因此有意识地允许它们累积为技术债务。二是无知。从事该项目的人不知道或没有意识到他们正在承担技术债务。这个问题涉及第二个问题。是否有一些技术债务被您引入到您的项目中，这些债务本来是微不足道的（“如果我只知道......”），但一旦它们被嵌入到项目中，它们的成本就会大大增加？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-21T20:25:47.193

完全忽略安全问题。

跨站点脚本就是这样一个例子。`alert('hello there!')`在您弹出管理界面之前，它被认为是无害的（如果您幸运的话 - 脚本也可以静默复制管理员有权访问的所有数据，或向您的客户提供恶意软件）。

然后你需要*昨天*修复的 500 个模板。仓促修复会导致数据双重转义，并且不会堵塞所有漏洞。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-21T20:37:26.360

将日期存储在本地时区的数据库中。在某个时候，您的应用程序将迁移到另一个时区，您将遇到麻烦。如果你最终得到混合日期，你将永远无法解开它们。只需将它们存储在 UTC 中。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-21T20:10:40.860

其中一个示例是以不支持 Unicode 的模式运行数据库。它一直有效，直到您被迫在数据库中支持 Unicode 字符串。迁移路径很重要，具体取决于您的数据库。

例如，SQL Server 有一个固定的最大行长度（以字节为单位），因此当您将列转换为 Unicode 字符串（NCHAR、NVARCHAR 等）时，表中可能没有足够的空间来保存您已有的数据。现在，您的迁移代码必须做出关于截断的决定，否则您必须完全更改表布局。无论哪种方式，它都比从所有 Unicode 字符串开始工作要多得多。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-21T20:53:04.970

单元测试——我认为在你去的时候没有写测试会招致难以弥补的巨额债务。尽管我是 TDD 的粉丝，但我并不关心您是在实现代码之前还是之后编写测试……只要您使测试与代码保持同步即可。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-21T20:09:07.197

不要使用 javascript 框架和手动实现已经可用的东西来启动 Web 项目。维护手写的 javascript 变得很痛苦，我最终把它全部撕掉并用框架重做。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-21T20:34:48.860

我真的在这个问题上挣扎，试图平衡[YAGNI](http://en.wikipedia.org/wiki/YAGNI)和“我经常被这件事烧伤”

我在每个应用程序上审查的事项清单：

1.  本土化：
    2.  时区*会*变得重要吗？如果是，请在 UTC 中保留日期/时间。
    3.  消息/文本是否会本地化？如果是，则将消息外化。
2.  平台独立？选择一个易于移植的实现。

可能产生技术债务的其他领域包括：

*   黑洞数据收集：一切都进去了，什么都没有出去。（没有归档/删除旧数据的长期计划）
*   未能在应用程序生命周期内保持 MVC 或层的清晰分离 - 例如，允许过多的逻辑潜入视图，使得为移动设备或 Web 服务添加接口的成本更高。

我相信还会有其他人...

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-21T20:41:10.067

可扩展性——特别是数据驱动的业务应用程序。我不止一次地看到一切似乎都运行良好，但是当 UAT 环境最终与接近生产的数据库表大小一起站起来时，事情开始左右下降。当数据库基本上将所有行都保存在内存中时，在线屏幕或批处理程序很容易运行。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-21T20:12:36.660

在以前的一家公司，他们使用并强制 COM 用于不需要的东西。

另一家拥有 C++ 代码库的公司不允许 STL。（WTF？！）

我参与的另一个项目仅将 MFC 用于集合 - 不涉及 UI。那很糟糕。

当然，这些决定的影响并不大。在两种情况下，我们无缘无故地依赖可怜的 MS 技术，另一种情况迫使人们使用更糟糕的泛型和集合实现。

我将这些归类为“债务”，因为由于前期的愚蠢决定，我们不得不在项目后期做出决定和权衡。大多数时候，我们不得不解决这些缺点。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-21T20:22:15.923

虽然不是每个人都同意，但我认为技术债务的最大贡献者是从任何类型的应用程序的接口开始，并在堆栈中向下工作。我开始了解到，通过实现 TDD 和 DDD 的组合，偏离项目目标的可能性更小，因为您仍然可以开发和测试核心功能，接口成为糖衣。

诚然，它本身并不是技术债务，但我发现自上而下的开发更像是一扇敞开的大门，它会邀请那些没有经过深思熟虑的决策——所有这些都是为了做一些“看起来很酷”的事情”。另外，我知道并非每个人都会同意或对此有相同的看法，因此您的里程可能会有所不同。团队动力和技能也是这个等式的一部分。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-22T03:47:57.363

陈词滥调是过早的优化是万恶之源，这对于***微***优化来说当然是正确的。但是，在一个显然很重要的领域完全忽略设计级别的性能可能是一个坏主意。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-21T20:11:18.923

没有预先有凝聚力的设计往往会导致它。如果你花时间经常重构，你可以在一定程度上克服它，但大多数人总是对不符合他们不断变化的需求的整体设计感到不满。这可能是您正在寻找的更普遍的答案，但确实往往是技术债务的更普遍原因之一。

# rest - REST PUT 方法的推荐/有效请求负载是什么？

> ID：310017
> 
> 赞同：5
> 
> 时间：2008-11-21T20:09:55.387
> 
> 标签：rest

我在不同的地方看到了两种类型的例子。一个使用表单字段，例如

> curl -X PUT -d "电话=123.456.7890" " [http://127.0.0.1/services/rest/user/123](http://127.0.0.1/services/rest/user/123) "

另一个使用类似（的一些变体）这样的 XML 内容

> echo "<user><id>123</id><phone>123.456.7890</phone></user>" | curl -X PUT -d @- " [http://127.0.0.1/services/rest/user/](http://127.0.0.1/services/rest/user/) "

似乎使用表单字段具有简洁的优点，并且通过仅针对修改后的字段来清楚地识别客户的意图，但它使得处理“更深”的元数据变得尴尬。

使用 XML 内容的优点是更完整，但缺点是需要确定客户端实际修改的是哪个字段（假设它们发送回整个资源并进行少量修改）。

是否有最佳做法，甚至更常见的做法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-23T23:43:00.150

可能是 JSON(P) 之类的东西？（我不确定确切的语法）：

```
$ echo '{user: {id: 123, phone: 123.456.7890}}' |\
> curl -X PUT -d @- 'http://127.0.0.1/services/rest/user/' 
```

或者

```
$ echo '{phone: 123.456.7890}' |\
> curl -X PUT -d @- 'http://127.0.0.1/services/rest/user/123.json' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-23T23:30:32.220

好问题！我不知道具体的最佳做法或常见做法。但我确实想指出，问题不在于表单字段或 XML，而在于部分表示与完整表示。您已经简洁地描述了它们之间的实际差异。问题的一个方面是谁有责任确定发生了什么变化：客户端还是服务器。

混合选项将是某种格式，其中客户端可以指定*确切*更改的内容，使用某些语法指向“更深”的元数据，例如 XPath 或 JSONpath，以及新值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T20:57:15.197

在第二个示例中，URL 没有引用特定资源，因此恕我直言，它不是 RESTful。

如果你解决了这个问题，那么选择就归结为表单和 XML 编码。

如果您需要结构化和可扩展的数据，那么 XML 可能会很有用：

```
<phone type="work, mobile"><num>555-555</num><ext>123</ext></phone> 
```

但不是必需的：

```
phone=555-555&phone-ext=123&phone-type=work&phone-type=mobile 
```

许多 API 用户可能会弄​​错 XML 编码，难以掌握命名空间间接性，因此表单编码可能更适合广大受众。

# nhibernate - NHibernate - 有没有什么好的工具可以帮助你配置文件？

> ID：310018
> 
> 赞同：1
> 
> 时间：2008-11-21T20:10:23.373
> 
> 标签：nhibernate, code-generation, nhibernate-mapping

是否有任何基于 GUI 的工具可以帮助您编写和维护配置文件？任何代码工具来生成配置文件？让这件事变得更容易的最好方法是什么？大多数人现在只是在使用 Castle ActiveRecord 吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T21:17:34.797

对于代码/映射生成，有许多用于[MyGeneration](http://www.mygenerationsoftware.com)的模板，用于从数据库创建配置文件和/或类。[CodeSmith](http://www.codesmithtools.com/)也有 NHibernate 模板，但 CodeSmith 不是免费的，所以 MyGeneration 在那里有优势。

MyGeneration 有一个 GUI，可让您下载模板、管理数据库连接、设置模板属性、生成代码等。它不是最好的用户体验，但它确实有效。

如前所述，如果您不想编写 XML 映射文件， [Fluent-NHibernate绝对值得一试。](http://code.google.com/p/fluent-nhibernate/)文档有点不存在，但很容易上手。如果你发现自己做了很多重构，它可以真正节省时间。

以下是 Fluent-NHibernate 映射的示例：

```
public CustomerMap : ClassMap<Customer>
{
  public CustomerMap()
  {
    Id(x => x.ID);
    Map(x => x.Name);
    Map(x => x.Credit);
    HasMany<Product>(x => x.Products)
      .AsBag();
    Component<Address>(x => x.Address, m =>  
    {  
        m.Map(x => x.AddressLine1);  
        m.Map(x => x.AddressLine2);  
        m.Map(x => x.CityName);  
        m.Map(x => x.CountryName);  
    });
  }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T20:17:30.083

我自己只是在学习 NHibernate（来自[出色的 NHibernate 之夏](http://www.summerofnhibernate.com/)系列）。我不知道任何 GUI 工具，但我想我会指出，如果您将 NHibernate schmema 文件（在安装的根文件夹中找到）安装到 C:\Program Files\Microsoft Visual Studio 9.0\Xml \Schemas，然后您将获得有关通用配置文件和映射配置文件的智能感知帮助。我发现这是一个很大的帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T20:25:20.317

您可能想查看 fluent hibernate 以获得类型安全的配置

# c++ - 从 GUI 中打开 Excel 中的指定文件 - Borland C++

> ID：310031
> 
> 赞同：4
> 
> 时间：2008-11-21T20:13:28.873
> 
> 标签：c++, excel, c++builder

我正在使用 Borland Builder C++ 2009。我想在表单中添加一个按钮，允许用户在 Excel 中打开我指定的文件。我想不出该怎么做。我知道如何与其他代码和可执行文件链接——是否有我可以使用的 Microsoft Excel 可执行文件？那我怎么能指定文件呢？对此的任何提示，或者至少是在线查看的地方，将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T20:18:36.540

假设文件类型已在 Excel 中注册，您可以使用“打开”动词对该文件调用 ShellExecute()。这将导致文件被打开，就像用户在资源管理器中双击一样，并将调用 Excel。

如果不是这种情况，并且您可以假设已安装 Excel，则可以将“excel”作为应用程序传递给 ShellExecute()，并将文件的路径作为参数。（请注意，我没有对此进行测试，但它在“运行”对话框中工作，所以我认为它也应该在 ShellExecute() 中工作）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-22T00:06:50.323

谢谢，安迪。我按照您的建议使用 ShellExecute()，将 Excel 作为应用程序，将文件路径作为参数。它可以打开 Excel，但是，它似乎无法找到该文件。我试过移动文件，输入整个路径，部分路径没有变化。这是我使用的代码：

```
ShellExecute(NULL, "open" ,"Excel.exe", "C:\\Documents and Settings\\Lab1\\My Documents\\Waypoint Tool.xls", NULL, SW_SHOWNORMAL); 
```

所以，我需要弄清楚为什么它无法找到这个文件。

感谢您提出使用 ShellExecute 的建议。我认为我在正确的轨道上！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-03T21:46:32.567

尝试：

```
print("ShellExecute(NULL, "open" ,"Waypoint Tool.xls", "C:\\Documents and Settings\\Lab1\\My Documents\\", NULL, SW_SHOWNORMAL);"); 
```

看这个页面： http: [//msdn.microsoft.com/en-us/library/bb762153 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb762153(VS.85).aspx)

似乎它想要您想要执行打开的文件作为第三个参数和第四个参数的目录。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-10-29T12:16:30.620

`System()`我认为命令应该足够了。对于任何 Windows 应用程序，我们可以使用 .exe 文件的位置和文件路径打开任何文件。

例如。，

```
system("PATH C:\\Program\ Files\\Microsoft\ Office\\OFFICE11;%PATH% & excel \"C:\\Documents and Settings\\User\\Desktop\\ExcelFile.xls\""); 
```

# c - 在C中输出单个字符

> ID：310032
> 
> 赞同：50
> 
> 时间：2008-11-21T20:13:41.150
> 
> 标签：c, character, string-formatting

在 C 程序中打印单个字符时，我必须在格式字符串中使用“%1s”吗？我可以使用“%c”之类的东西吗？

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2008-11-21T20:15:13.003

是的，`%c`将打印一个字符：

```
printf("%c", 'h'); 
```

另外，`putchar`/`putc`也可以。来自“man putchar”：

```
#include <stdio.h>

int fputc(int c, FILE *stream);
int putc(int c, FILE *stream);
int putchar(int c);

* fputc() writes the character c, cast to an unsigned char, to stream.
* putc() is equivalent to fputc() except that it may be implemented as a macro which evaluates stream more than once.
* putchar(c); is equivalent to putc(c,stdout). 
```

编辑：

另请注意，如果您有一个字符串，要输出单个字符，您需要获取要输出的字符串中的字符。例如：

```
const char *h = "hello world";
printf("%c\n", h[4]); /* outputs an 'o' character */ 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-11-21T20:32:59.753

注意和之间的`'c'`区别`"c"`

`'c'`是一个适合用 %c 格式化的字符

`"c"`是一个 char* 指向长度为 2 的内存块（带有空终止符）。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-11-21T20:28:42.820

如其他答案之一所述，您可以为此目的使用**putc** (int c, FILE *stream)、**putchar** (int c) 或**fputc** (int c, FILE *stream)。

需要注意的重要一点是，使用上述任何函数都比使用任何格式解析函数（如 printf）要快得多。

使用 printf 就像使用机关枪发射一颗子弹。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2018-12-09T23:24:26.577

输出单个字符的最简单方法是简单地使用该`putchar`函数。毕竟，这是它的唯一目的，它不能做任何其他事情。不能比这更简单了。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-21T22:05:26.370

```
char variable = 'x';  // the variable is a char whose value is lowercase x

printf("<%c>", variable); // print it with angle brackets around the character 
```

# soap - XML 中的波浪号

> ID：310035
> 
> 赞同：1
> 
> 时间：2008-11-21T20:14:08.747
> 
> 标签：soap, xml-serialization

波浪号是 XML SOAP 消息中的合法字符吗？我得到一个 SAXParseException:Content not allowed in prolog。我包含了大部分 SOAP 消息，以防万一我找错了树。

```
POST /... HTTP/1.0
Content-Type: text/xml; charset=utf-8
Accept: application/soap+xml, application/dime, multipart/related, text/*
User-Agent: Axis/1.4
Host: 127.0.0.1:1234
Cache-Control: no-cache
Pragma: no-cache
SOAPAction: ""
Content-Length: 1497
Authorization: Basic b3BlbnBkbTpvdHRvMTIz

<?xml version="1.0" encoding="UTF-8"?>
   <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <soapenv:Body>
         <ns1:query soapenv:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/" xmlns:ns1="http://localhost">
            <where xsi:type="soapenc:string" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/">type ~~ 'command'</where>

         </ns1:query>
      </soapenv:Body>
   </soapenv:Envelope> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T20:44:57.907

我不确定 SOAP 消息，但在处理 XML 文件时，此错误消息的另一个可能原因是文件开头是否有[BOM（字节顺序标记）](http://en.wikipedia.org/wiki/Byte_Order_Mark) - 如果某些 XML 解析器无法处理未正确配置或调用。检查（使用十六进制编辑器）并尝试删除它会发生什么。

例如，在 Python 中，有必要打开一个 UTF-8 编码的 XML 文件，`codecs.open(filename, "UTF-8")`而不仅仅是`open(filename)`确保 BOM（如果存在）得到正确处理。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T20:18:16.633

> 波浪号是 XML SOAP 消息中的合法字符吗？

是的。错误消息指向另一个错误源（“序言”）。HTTP 标头是否可能是发送到 SAX 解析器的代码的一部分，就像在您的代码示例中一样？

# perl - 如何使哈希键查找不区分大小写？

> ID：310036
> 
> 赞同：10
> 
> 时间：2008-11-21T20:14:21.960
> 
> 标签：perl, hash

显然，哈希键是以区分大小写的方式进行比较的。

```
$ perl -e '%hash = ( FOO => 1 ); printf "%s\n", ( exists $hash{foo} ) ? "Yes" : "No";'
No

$ perl -e '%hash = ( FOO => 1 ); printf "%s\n", ( exists $hash{FOO} ) ? "Yes" : "No";'
Yes 
```

是否有设置可以更改当前脚本的设置？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-21T20:21:45.503

您将不得不使用绑定哈希。例如[Hash::Case::Preserve](http://search.cpan.org/~markov/Hash-Case/lib/Hash/Case/Preserve.pod)。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-21T20:17:58.757

一个字符串的哈希值和大小写改变的同一个字符串是不相等的。所以你不能做你想做的事，除了在创建之前和使用它之前在每个哈希键上调用“uc”。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-05-22T04:51:56.403

```
my %hash = (FOO => 1);
my $key = 'fOo'; # or 'foo' for that matter

my %lookup = map {(lc $_, $hash{$_})} keys %hash;
printf "%s\n", ( exists $hash{(lc $key)} ) ? "Yes" : "No"; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-10-31T12:28:41.747

`grep`如果您使模式匹配不区分大小写，应该可以解决问题：

`perl -e '%hash = ( FOO => 1 ); printf "%s\n", ( scalar(grep (/^foo$/i, keys %hash)) > 0) ? "Yes" : "No";'`

如果您有多个不同拼写的键，您可能需要检查匹配是否也大于 1。

# .net - VS 2008 问题->>无法启动程序

> ID：310045
> 
> 赞同：2
> 
> 时间：2008-11-21T20:15:50.973
> 
> 标签：.net, visual-studio, visual-studio-2008

好的，我在 2005 年有一个 Web 应用程序。net 2.0 ，我将其转换为 2008 .net 3.5。当我尝试在 VS 2008 中运行它时，无论是调试还是发布，我都会收到上述错误：

> 无法启动程序 http:\localhost\MyWebApp

没有其他消息。我可以通过 iis 直接访问我的程序并运行它。它在另一台开发机器上正确运行。

有任何想法吗？我已经卸载并重新安装了几次 v2 无济于事。我还写了一个简单的网络应用程序，一个带有标签的页面，也无法运行

在这个新的开发周期上需要帮助即将开始。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-11-17T23:55:12.353

疯狂，但可能会解决问题。试试这个：在不调试的情况下启动（ctrl+F5），当 IE 打开时，在调试模式下重新启动（F5）。不要退出 IE，只需在 VS2008 中停止调试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T10:04:27.043

您的 Visual Stuido IDE 无法链接到 IIS 虚拟目录。检查您的项目/解决方案设置，并确保在创建项目时 asp.net 网站托管在本地 IIS 上。由于您可以在 IIS 之外访问它，这意味着 IDE 无法将网站与本地 IIS 链接。创建新的解决方案或修改解决方案/项目设置应该可以解决问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-16T14:42:37.177

这是我所做的：

转到 IE 菜单工具 > 管理补充 > 禁用所有你从未使用过的。

这对我有用！现在 IE 工作得比以往任何时候都好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T20:19:27.020

您是否检查了项目设置以确保 Web 应用程序仍在使用您的本地 IIS 副本？它可能会尝试启动 VS Web 开发服务器，这会导致您出现问题。

这也可以翻转，当它应该是 IIS 时，项目是否被配置为指向开发服务器？

# windows - 将许可证信息添加到 NSIS 安装程序

> ID：310048
> 
> 赞同：0
> 
> 时间：2008-11-21T20:16:42.080
> 
> 标签：windows, installation, windows-installer, nsis

我们通过 NSIS 生成的 Windows 安装程序分发我的小组创建的软件。我们从不再与我们合作的开发人员编写的 python 脚本生成 NSIS 配置文件，因此我们目前没有任何员工知道如何编写 NSIS 配置文件。我的任务是修改这个脚本，在安装程序中添加一个部分，在执行实际安装之前显示我们的许可信息。

NSIS 配置文件中的这样一个部分会是什么样子？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-22T09:34:08.757

取决于安装程序的结构以及它使用的 NSIS 功能。

例如，如果它使用 MUI（“现代用户界面”）宏，那么它可以像添加

```
!insertmacro MUI_PAGE_LICENSE "License.txt" 
```

文中某处。很可能在其他一些页面之间`MUI_PAGE`。例如，我目前正在处理的一个安装程序是这样的：

```
!insertmacro MUI_PAGE_WELCOME
!insertmacro MUI_PAGE_LICENSE "..\..\Licenses\License.txt"
!insertmacro MUI_PAGE_DIRECTORY 
```

这导致欢迎页面，然后是许可证页面，然后是“选择目录”页面。

有关更多选项，请阅读 NSIS MUI 文档。

# c# - 使用 Amazon AWS 创建离线数据库

> ID：310058
> 
> 赞同：2
> 
> 时间：2008-11-21T20:20:02.153
> 
> 标签：c#, .net, ruby, amazon-web-services

**问题陈述：** 我想创建一个离线数据库来查找在美国销售的最有用的 n 本书的价格/信息（其中 n 可能是 300 万左右）。

**问题：** 所以，我的问题是（我也对这里的其他方法持开放态度），我试图弄清楚如何使用亚马逊 AWS 下载正在销售的最高销量书籍的列表以及一些关于书（即标题、价格等）。

**到目前为止我所做的：** 首先，类似的东西已经存在（asellertool.com），但是，我认为这将是一个有趣的项目，坦率地说，我们还不够认真，需要支付 30 美元/月订阅。

现在，如果您有一些想要查找的项目，AWS 很棒（而且很容易），但我似乎无法弄清楚销售排名是如何枚举的。最初，我希望通过 ISBN 列举亚马逊拥有的所有图书项目。但这也不可用。然后我想我可以在那里找到所有 ISBN 号码的列表，但这也是一个死胡同。最后我想我可以创建自己的 ISBN 号码列表，但是当我做了一些粗略的计算时，我想得更好，因为我的解决方案需要大约一年的时间才能通过 100/ 的 10 位数字空间的三分之一第二个（无论如何这都是矫枉过正）。

所以，我又回到了销售排名，目前这似乎也是一个死胡同。因此，如果您有任何想法，我将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-12T22:14:47.487

查看[AWS Zone](http://www.awszone.com/index.aws)部分`Amazon E-Commerce Service`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-30T01:55:44.417

亚马逊有一个数据馈送服务，您可以使用它包含基于顶级类别的所有产品的 GZipped xml 文件。它每天更新一次，总计大约 20GB/110GB 的压缩/未压缩数据。由于您只需要书籍，因此更多的是 4GB/31GB。唯一的问题是我不确定谁可以使用它以及获得帐户涉及什么。据我所知，他们没有在他们的网站上列出任何关于此的内容，因此您很可能必须联系那里的人以了解更多信息。我们在工作中使用它来处理我们对它们所做的事情，这是我不得不做的一些最疯狂的 xml 处理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T10:11:14.133

我想知道您想使用哪一项 Amazon AWS 服务？还是你不知道？

为什么需要离线数据库？为什么不对你需要的所有东西发出请求并做一些临时缓存呢？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-19T14:43:40.533

我也不是程序员，但好奇又便宜。Asellerstool 可能很棒，但如果不是亚马逊的免费数据库，它们就不会存在。好吧，我想没有人关心二手书的价格吗？

# wcf - WCF Web 服务：上传文件、处理该文件、下载该处理后的文件

> ID：310062
> 
> 赞同：3
> 
> 时间：2008-11-21T20:21:59.543
> 
> 标签：wcf, c#-3.0

我可以处理该文件部分的过程，但在我发疯之前，是否有人构建了一个简单的 wcf 服务和客户端（在 Windows 服务或 IIS 下运行），我可以使用它来上传文件并下载该文件？用最少的代码行？（C# 或 VB）

压缩和加密会很酷，但我会在以后分层！

谢谢！！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-08-11T08:10:13.523

根据处理所需的时间，您最好使用两种方法以避免遇到超时问题。

另外，我同意 Igor 的观点，你应该使用流而不是字节 []。否则你可能会遇到 OutOfMemory 异常。

```
[ServiceContract]
public interface IFileService
{
  // returns a Guid which you can use later to request the processed files
  [OperationContract]
  Guid SendFileToProcess(stream streamedFile);

  [OperationContract]
  Stream GetProcessedFile(Guid fileId);

  // use this to poll whether the service has finished processing
  [OperationContract]
  bool IsFileProcessed(Guid fileId);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-22T06:27:35.060

你应该能够很容易地做到这一点。服务合同可能如下所示：

```
[ServiceContract]
public interface IFileService
{
  [OperationContract]
  byte[] ProcessFile(byte[] FileData);
} 
```

加密部分可以由 WCF 使用传输级别安全性本地处理。我不相信 WCF 直接支持压缩，但您可以使用 GZipStream 类添加它。

我没有像您描述的那样构建文件处理服务，但我已经构建了一个服务来处理在 WCF 客户端和服务之间来回传递的字节数组数据。它工作得很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-04T16:05:47.207

以流模式或/和长时间运行的活动对象模式使用 WCF 传输。请关注[本文](http://www.koolzers.net/en/us/articles/long-running-active-object-part1.aspx)了解更多详情或联系我。

# django - 在 Django 中，{{ block.super }} 的问题，如何避免在多个模板文件中复制“块”？

> ID：310090
> 
> 赞同：1
> 
> 时间：2008-11-21T20:29:49.777
> 
> 标签：django, include, django-templates

对于继承一个块的 2 个子模板文件，`{{ block.super }}`不解析

Python 2.5.2、Django 1.0、Windows XP SP3

所涉及文件的示例框架代码：

1.  `base.html`
2.  `item_base.html`
3.  `show_info_for_all_items.html`
4.  `show_info_for_single_item.html`

文件 ：`base.html`

```
{% block content %}
{% endblock %} 
```

文件 ：`item_base.html`

```
{% extends "base.html" %}
{% block item_info %}   
    Item : {{ item.name }}<br/>
    Price : {{ item.price }}<br/>   
{% endblock %} 
```

文件 ：`show_info_for_all_items.html`

```
{% extends "item_base.html" %}
{% block content %}
    <h1>info on all items</h1>
    <hr/>
    {% for item in items %}
        {% block item_info %}
            {{ block.super }}
        {% endblock %}
        <hr/>
    {% endfor %}
{% endblock %} 
```

文件 ：`show_info_for_single_item.html`

```
{% extends "item_base.html" %}
{% block content %}
    <h1>info on single item</h1>    
    {% block item_info %}
        {{ block.super }}
    {% endblock %}  
{% endblock %} 
```

`show_info_for_all_items.html`显示项目列表以及每个项目的信息。

`show_info_for_single_item.html`显示带有项目信息的单个项目。

`show_info_for_all_items.html`并`show_info_for_single_item.html`共享相同的代码来显示项目信息，所以我把它`item_base.html`移到`block item_info`

但是`{{ block.super }}`in`show_info_for_all_items.html`并`show_info_for_single_item.html`不起作用。`{{ block.super }}`解析为空白。

如果我将代码从其中移回`block item_info`并且`item_base.html`它`show_info_for_all_items.html`可以`show_info_for_single_item.html` 工作，但是我必须`block item_info`在 2 个文件中复制相同的代码。

如果 block.super 问题无法解决，Django 是否提供类似 INCLUDE =>`{% INCLUDE "item_base.html" %}`的功能，因此可以包含来自模板文件的块（而不是`extends`）

如何避免`block item_info`在两个 html 文件中重复？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-21T20:40:23.373

> Django 是否提供类似 INCLUDE (...)

是的！，只需看看文档：[包括](http://docs.djangoproject.com/en/dev/ref/templates/builtins/#include)

将通用代码块放在*foo.html*中，然后在每个模板中：

```
{% include 'foo.html' %} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-22T03:40:09.797

除了`include`DZPM 提到的标签之外，您可能还需要考虑编写[自定义包含标签](http://docs.djangoproject.com/en/dev/howto/custom-template-tags/#inclusion-tags)。

这种情况下的主要优点是调用模板不必使用与包含模板相同的变量名。您可以显示从名为“item”的变量以外的其他地方访问的项目：

```
{% show_item user.favorite_item %} 
```

# java - 如何解析 DWR 返回的对象数组？

> ID：310093
> 
> 赞同：1
> 
> 时间：2008-11-21T20:30:32.317
> 
> 标签：java, ajax, dwr

DWR 非常直接地处理原语列表。我找不到 DWR 方法调用返回的对象数组是否代表 JSON 对象。有什么线索吗？或者我是否必须将表示对象数组的 JSON 字符串返回给浏​​览器？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-19T22:07:31.887

这个答案有点晚了，但这里有:)

好消息：DWR 还以非常直接的方式处理 Java 数组和集合。只需返回它们，在客户端您将获得 JavaScript Array 对象。（在典型情况下，例如数组或集合中的原语或字符串。如果内容更奇特，您可能需要定义转换器；更多内容见下文。）

[这是来自DWR 文档](http://directwebremoting.org/dwr/server/dwrxml)的引用（重点是我的）：

> 默认情况下，以下所有内容都会为您转换，无需进一步声明：
> 
> *   所有原始类型，boolean、int、double 等。
> *   这些布尔值、整数等的基于类的版本。
> *   java.lang.String
> *   java.util.Date 和 3 个 SQL 派生词
> *   **上面的数组**
> *   以上的集合（列表、集合、映射、迭代器等）
> *   来自 DOM、XOM、JDOM 和 DOM4J 的 DOM 对象（如元素和文档）

因此，您绝对不需要这些 JSON 字符串（尽管这对于更复杂的数据结构可能是一个不错的选择）。

您实际上可以返回更多种类的对象而无需进行大量手动工作，因为 DWR 带有用于许多典型用途的“[转换器”。](http://directwebremoting.org/dwr/server/dwrxml/converters)例如，要使您的自定义“bean”样式 Java 对象在客户端 JS 中工作，您只需要说`dwr.xml`您想要使用[bean 转换器](http://directwebremoting.org/dwr/server/dwrxml/converters/bean)：

```
<convert converter="bean" match="com.company.YourBean" /> 
```

即使您的方法返回这些 bean 对象的列表（或数组）......

```
public static List<YourBean> getData(){ ... } 
```

... 上面的配置就够了，挺好的。

# sql - 如何确定从 varchar 到 datetime 的转换？

> ID：310094
> 
> 赞同：7
> 
> 时间：2008-11-21T20:31:00.617
> 
> 标签：sql, sql-server, sql-server-2005, user-defined-functions, deterministic

[根据这个问题](https://stackoverflow.com/questions/309492/user-defined-functions-sql-server-2005-flagged-incorrectly-as-non-deterministic)的传统和[文档](http://msdn.microsoft.com/en-us/library/ms178091(SQL.90).aspx)，如何使这个函数具有确定性：

```
ALTER FUNCTION [udf_DateTimeFromDataDtID]
(
    @DATA_DT_ID int -- In form YYYYMMDD
)
RETURNS datetime
WITH SCHEMABINDING
AS
BEGIN
    RETURN CONVERT(datetime, CONVERT(varchar, @DATA_DT_ID))
END 
```

或者这个（因为字符串/日期文字 - 是的，我也试过'1900-01-01'）：

```
ALTER FUNCTION udf_CappedDate
(
    @DateTimeIn datetime
)
RETURNS datetime
WITH SCHEMABINDING
AS
BEGIN
    IF @DateTimeIn < '1/1/1900'
        RETURN '1/1/1900'
    ELSE IF @DateTimeIn > '1/1/2100'
        RETURN '1/1/2100'

    RETURN @DateTimeIn
END 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-21T20:50:02.543

BOL 表示，如果指定了*样式*参数，则日期`CONVERT` *时间是*确定性的。因此，如果您将第一个 UDF 更改为：

 *```
RETURN CONVERT(datetime, CONVERT(varchar, @DATA_DT_ID), 112) 
```

如果我正确理解文档，那么它*应该是确定性的。*

据推测，可以在您的第二个 UDF 中使用相同的技巧：

```
IF @DateTimeIn < CONVERT(datetime, '1/1/1900', 101)
    RETURN CONVERT(datetime, '1/1/1900', 101) 
```

我***真的***希望有一种方法可以在 T-SQL 中指定日期时间文字。

**编辑**：

正如 Arvo 在评论中指出的那样（**谢谢**，Arvo），可以使用 ODBC 时间戳文字格式（即使在使用 OLE DB 时），因此上面的第二个函数可以更好地写为：

```
IF @DateTimeIn < {d '1900-01-01'}
    RETURN {d '1900-01-01'}
...etc. 
```

并且转换为日期时间是在编译时而不是执行时完成的。请注意，日期的格式必须非常具体（请参阅[Arvo 到 datetime 数据类型的链接](http://msdn.microsoft.com/en-us/library/ms187819.aspx)）：

> d yyyy-mm-dd
>  t hh:mm:ss[.fff]
> ts yyyy-mm-dd hh:mm:ss[.fff]

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-21T20:35:20.013

从您链接的文章中：

> 为了具有确定性，样式参数必须是常数。此外，小于或等于 100 的样式是不确定的，除了样式 20 和 21。大于 100 的样式是确定的，除了样式 106、107、109 和 113。

您需要在转换为日期时间时使用样式参数。

例如：

```
CONVERT(datetime, '2008-01-01', 121) 
```

除了不要使用 121...

# perl - 指示一个类是否在 Perl 中实现了一个接口有多重要？

> ID：310105
> 
> 赞同：5
> 
> 时间：2008-11-21T20:34:28.190
> 
> 标签：perl, oop, coding-style

我一直在和朋友讨论代码风格问题。我们有一系列通过命名子例程返回特定类型的值来实现接口的包。例如：

```
package Foo::Type::Bar;
sub generate_foo {
    # about 5-100 lines of code
    return stuff here;
} 
```

所以你可以去：

```
my $bar_foo = Foo::Type::Bar->generate_foo;
my $baz_foo = Foo::Type::Baz->generate_foo; 
```

我们有很多这些，都在同一个`Foo::Type::*`层次结构下。

我认为包应该清楚地表明它们实现了`foo_generate`接口，例如：

```
package Foo::Type::Bar;
use base 'Foo::Type';
sub generate_foo {
    ...
    return stuff here;
} 
```

我认为这是很好的代码风格，对于其他探索代码的编码人员来说更加清晰和干净。它还可以让您检查`Foo::Type::Bar->isa('Foo::Type')`它是否实现了接口（子系统的其他部分完全是 OO）。

我朋友不同意。他提出的一些论点是：

*   `Foo::Type::*`包被明确命名，并且只在内部项目中使用，因此没有疑问给定包是否实现了接口
*   这些包通常很小并且是独立子系统的一部分，在他看来它们就像批处理文件或 conf 文件，而不是繁重的 Perl OO 代码
*   Perl 通过继承表达实现，这可能很复杂或有问题，特别是当一个人获得多重继承时
*   添加`Foo::Type`超类不会增加任何价值，因为它实际上是一个空包，仅用于启用`->isa`查找
*   以编程方式指示接口实现是个人代码风格的问题

我们中的一个或另一个“正确”吗？你会怎么办？

*编辑：在示例中，将 Foo::Generator 重命名为 Foo::Type*

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T22:49:51.413

好吧，还有其他动态语言使用的“鸭子打字”。`UNIVERSAL::can`达到了其他语言倾向于使用它的程度。

```
$unknown->doodle() if $unknown->can( 'doodle' ); 
```

“鸭子”打字的名称来自“如果它像鸭子一样走路，像鸭子一样说话......它就是鸭子”的想法。然而，我们并没有看到它是否“像鸭子一样”走路，我们只是在看它是否会做一些有人称之为“走路”的事情，因为这也是我们所说的鸭子所做的事情。例如，Tree Walker 对象不会像鸭子一样“*行走”！*

您不想传递错误的对象某些东西。

```
$path_or_OS_I_dont_know_which->format( "c:", 'y' ); 
```

所以鸭式打字的效果取决于你对另一边的期望。另外，如果合同更复杂，它往往会变得混乱。你只是增加了不确定性——尽管通过绝对不可能的引擎盖来缩小对象，两个类会*意外地*有 23 个类似命名的方法。

```
if ( $duck->can( 'talk' ) && $duck->can( 'walk' )) { 
    $duck->walk();
    $duck->talk();
} 
```

没关系，但是

```
if ( $cand->can( 'walk' ) && $cand->can( 'talk' ) && ... && $cand->can( 'gargle' )) {
    ...
} 
```

有点傻。另外，其中一些方法可能真的是*可选*的，所以你必须穿插它：

```
$cand->snicker() if $cand->can( 'snicker' ); 
```

（当然，路口会稍微清理一下。）

而且它可能会变得非常复杂，因为您必须将方法的中间产品传递给也可能存在的其他方法。

## 兼容的

我有一个轻量级的模式，我称之为“兼容”。没有实际的包叫做这个，但是如果一个类实现了`Date`它的功能，那么它就会把它放进去`@ISA`；

```
our @ISA = qw<... Date::Compatible ...>; 
```

因此，只有两个`isa`s 需要被调用——`is_one`无论如何我将它封装在一个 sub 中：

```
sub UNIVERSAL::is_one { 
    my ( $self, @args ) = @_;
    foreach my $pkg ( @args ) { 
        return 1 if $self->isa( $pkg );
    }
    return 0;
}

sub UNIVERSAL::is_compatible_with {
    my ( $self, $class ) = @_;
    return $self->is_one( $class, "${class}::Compatible" );
} 
```

它至少为事物提供了一个要履行的*合同*，并为查询代码提供了测试依据。如果不挑剔，实现仍然可以决定履行合同的特定方法的重要性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T20:41:58.487

在我看来，这取决于规模并且非常主观。系统越大，围绕它建立元数据就越有利。如果您期望它会增长，那么这些使用场景可能会发生变化，并且值得花时间去实施。但是，perl 通常面向实用编程，只编写需要的代码，仅此而已。在你的情况下，知道我知道的很少，我会说保持原样。如果这是java，我会倾向于另一个方向，因为java从一开始就从接口使用中受益更多。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T03:08:32.297

我真正想知道的是为什么你在谈论

```
my $bar_foo = Foo::Type::Bar->generate_foo 
```

而不是

```
my $bar_foo = Foo::Type::Bar::generate_foo 
```

在第一种情况下，有一层薄薄的 OO，这表明可能存在某种 OO / 继承；但是看看你的同事反对从空类添加显式继承，很明显 generate_foo 是以非 OO 方式调用的，并且不需要继承。

考虑到这一点，没有人会打字

```
if (Foo::Type::Bar->isa('Foo::Type')) { ... } 
```

就在之前

```
my $bar_foo = Foo::Type::Bar::generate_foo; 
```

因为他们可以很快判断 Foo::Type::Bar 是否具有 generate_foo 函数，并且他们会在编写代码时确定这一点。看起来您正在寻找某种“我们正在做正确的事情”的断言，而实际上，如果有一些代码错误地断言该断言，它将在第一次运行时崩溃。

看起来您正在处理非 OO 代码，在这种情况下，我不会将标准 OO 方法应用于该问题。或许可以看看[Joel Spolsky 的文章，为什么 Hungarian Notation can be OK, done proper](http://www.joelonsoftware.com/articles/Wrong.html)。如果您清楚地表明代码的正确与否，您就不必担心手持或强制执行不需要的标准。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-24T20:26:13.387

如果您提出这些问题，我认为您应该升级到 Moose。在那里，您将能够通过使用适当的抽象方法创建角色或类来定义您的接口。

我同意你的观点，这样做可以增加有价值的信息。在 Java 中有一个“标记接口”的概念，它是一个没有方法的空接口，它的存在只是将一组类标记为对特定目的有用。最常见的例子是 Serializable 接口。

当然，仅仅因为它有用并不意味着它会在您的特定情况下使用。:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T20:57:29.783

为了与 Perl 的务实精神保持一致，我只会在基类本身有价值的情况下添加它。添加空函数的集合并不是很有趣。

另一方面，基类可以用作存放 POD 的地方。并定义一些常量...你有 Foo::Type.pm 吗？如果你这样做了，并在那里讨论 generate_foo，那么就不需要 Generator.pm ...

是的，这是一个判断电话。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-21T22:30:24.433

一般而言，如果您的继承层次结构中有一个“空”级别，则其中应该有一些您尚未分解的内容，或者，如果确实没有任何内容可放入，那么它不应该在那里全部。我认为这是你的朋友对`Foo::Type`课程感到不适的根源——没有理由*必须*在那里；就像您*当前*描述的代码一样。

在您的类层次结构中的第一个级别之外的级别应该用于区分该级别的多个事物。否则，即使没有，人们也会寻找存在该级别的原因：我可能会建议实际上完全消除中间级别。它有一个语义上为 null ( ) 的名称这一事实`Type`表明它并不是真正需要的。也许您对对象是什么以及它们应该做什么的想法与您的命名约定存在差异。

我可能会争辩说

```
Foo::Bar->generate
Foo::Baz->generate 
```

如果返回的对象更多地依赖于它们的`Bar`-ness 或`Baz`-ness 来描述它们而不是它们的`Type`-ness，则更有意义。

评估此类内容的一个非常好的方法是对自己说：“我会以这种方式将它放在 CPAN 上吗？我希望（可能）世界上任何 Perl 程序员都能看到这个吗？” 如果您对此有任何不适（一个完全空的课程？嗯。）那么您应该退后一步并重新考虑。

# c++ - 我可以让 GCC 在将过宽的类型传递给函数时发出警告吗？

> ID：310108
> 
> 赞同：12
> 
> 时间：2008-11-21T20:34:39.923
> 
> 标签：c++, c, gcc, g++, compiler-warnings

以下是一些明显有缺陷的代码，我认为编译器应该对其进行诊断。但是，即使有我能想到的所有警告选项，`gcc`也没有：`g++``-pedantic -Wall -Wextra`

```
#include <stdio.h>

short f(short x)
{
    return x;
}

int main()
{
    long x = 0x10000007;   /* bigger than short */
    printf("%d\n", f(x));  /* hoping for a warning here */
    return 0;
} 
```

有没有办法对此提出`gcc`警告`g++`？附带说明一下，您是否有另一个编译器在默认情况下或在相当常见的额外警告配置中对此发出警告？

注意：我使用的是 GCC（C 和 C++ 编译器）版本 4.2.4。

编辑：我刚刚发现它`gcc -Wconversion`可以解决问题，但相同的选项`g++`不会，而且我真的在这里使用 C++，所以我需要一个解决方案`g++`（现在我想知道为什么`-Wconversion`似乎不是这样）。

编辑：[http](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=34389) ://gcc.gnu.org/bugzilla/show_bug.cgi?id=34389建议这可能会在`g++ 4.4`......也许？我还不清楚它是否是同一个问题和/或修复是否真的出现在那个版本中。也许有 4.3 或 4.4 的人可以试试我的测试用例。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-21T20:55:30.130

使用 -Wconversion - 问题是当函数 f(short x) 被调用 [not printf] 时从 long x 到 short 的隐式转换（转换），并且 -Wconversion 会说“从 long 转换为 short 可能会改变值” ”。

..

编辑：刚刚看到你的笔记。-Wconversion 在 Linux 上使用 g++ 4.3.2 对我产生警告...（在 Debian 上使用 4.3.2-1）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T20:55:00.367

我强烈建议投资[Gimpel](http://gimpel.com/)的 PC-lint/FlexeLint 。该软件旨在捕获编译器无法捕获的此类内容。它相对便宜，而且物有所值。网站上有一个在线演示，您可以使用它来评估它，这是它为您的示例中的相关行报告的内容：

```
diy.cpp  14  Info 734: Loss of precision (arg. no. 1) (31 bits to 15 bits) 
```

# perl - 如何更改哈希键的大小写？

> ID：310115
> 
> 赞同：8
> 
> 时间：2008-11-21T20:37:07.127
> 
> 标签：perl, hash

我正在编写一个可能被用户修改的脚本。目前我将配置设置存储在脚本中。它以散列哈希的形式存在。

我想防止人们在哈希键中意外使用小写字符，因为这会破坏我的脚本。

检查哈希键很简单，只需对任何带有小写字符的键发出警告，但我宁愿自动修复区分大小写的问题。

换句话说，我想将顶级哈希中的所有哈希键都转换为大写。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-21T21:49:51.113

安迪的答案是一个很好的答案，除了他`uc`是每一个关键，`uc`如果它不匹配，然后再s它。

这`uc`是一次：

```
%hash = map { uc $_ => $hash{$_} } keys %hash; 
```

但是，由于您谈到了用户*存储密钥*，因此平局是一种更可靠的方式，即使速度较慢。

```
package UCaseHash;
require Tie::Hash;

our @ISA = qw<Tie::StdHash>;

sub FETCH { 
    my ( $self, $key ) = @_;
    return $self->{ uc $key };
}

sub STORE { 
    my ( $self, $key, $value ) = @_;
    $self->{ uc $key } = $value;
}

1; 
```

然后主要是：

```
tie my %hash, 'UCaseHash'; 
```

那是一个节目。“`tie`魔法”将它封装起来，让用户不会在不知不觉中乱用它。

当然，只要你使用“类”，你可以传入配置文件名并从那里初始化它：

```
package UCaseHash;
use Tie::Hash;
use Carp qw<croak>;

...

sub TIEHASH { 
    my ( $class_name, $config_file_path ) = @_;
    my $self = $class_name->SUPER::TIEHASH;
    open my $fh, '<', $config_file_path 
        or croak "Could not open config file $config_file_path!"
        ;
    my %phash = _process_config_lines( <$fh> );
    close $fh;
    $self->STORE( $_, $phash{$_} ) foreach keys %phash;
    return $self;
} 
```

你必须这样称呼它：

```
tie my %hash, 'UCaseHash', CONFIG_FILE_PATH; 
```

...假设一些常数`CONFIG_FILE_PATH`。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-21T20:43:54.600

遍历散列并用大写等效项替换任何小写键，并删除旧键。大致：

```
for my $key ( grep { uc($_) ne $_ } keys %hash ) {
    my $newkey = uc $key;
    $hash{$newkey} = delete $hash{$key};
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-03-31T21:10:23.590

这会将多级哈希转换为小写

```
my $lowercaseghash = convertmaptolowercase(\%hash);

sub convertmaptolowercase(){
    my $output=$_[0];
    while(my($key,$value) = each(%$output)){
        my $ref;
        if(ref($value) eq "HASH"){
            $ref=convertmaptolowercase($value);
        } else {
           $ref=$value;
        }
        delete $output->{$key}; #Removing the existing key
        $key = lc $key;
        $output->{$key}=$ref; #Adding new key
    }
    return $output;
} 
```

# regex - 忽略mercurial中的文件夹

> ID：310117
> 
> 赞同：32
> 
> 时间：2008-11-21T20:37:35.080
> 
> 标签：regex, mercurial, hgignore

**警告：** 我尝试了此处列出的所有可能性：[如何忽略 Mercurial 文件夹下的所有内容](https://stackoverflow.com/questions/254002/how-can-i-ignore-everything-under-a-folder-in-mercurial)。
没有一个像我希望的那样工作。

我想忽略文件夹下的所有内容`test`。但不可忽视`srcProject\test\TestManager`

我试试

```
syntax: glob
test/** 
```

它忽略`test`和`srcProject\test\TestManager`

和：

```
syntax: regexp
^/test/ 
```

这是同一件事。

还有：

```
syntax: regexp
test\\* 
```

我在 Windows 中安装了 TortoiseHG 0.4rc2 和 Mercurial-626cb86a6523+tortoisehg、Python-2.5.1、PyGTK-2.10.6、GTK-2.10.11

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-11-24T04:10:38.317

尝试在正则表达式版本中插入符号后不带斜线。

```
^test/ 
```

这是一个测试：

```
~$ mkdir hg-folder-ignore
~$ cd hg-folder-ignore
~/hg-folder-ignore$ echo '^test/' > .hgignore
~/hg-folder-ignore$ hg init
~/hg-folder-ignore$ mkdir test
~/hg-folder-ignore$ touch test/ignoreme
~/hg-folder-ignore$ mkdir -p srcProject/test/TestManager
~/hg-folder-ignore$ touch srcProject/test/TestManager/dont-ignore
~/hg-folder-ignore$ hg stat
? .hgignore
? srcProject/test/TestManager/dont-ignore 
```

请注意，ignoreme 没有出现，而 dont-ignore 出现了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T22:23:36.100

您可以使用零宽度的负前瞻和后视断言来指定`test`仅当它前面`srcProject`没有和后面没有时才要忽略`TestManager`：

```
syntax: regexp
(?<!srcProject\\)test\\(?!TestManager) 
```

Mercurial 使用 Python 正则表达式，因此您可以在 Python 文档中找到有关零宽度断言的更多信息：[https ://docs.python.org/library/re.html#regular-expression-syntax](https://docs.python.org/library/re.html#regular-expression-syntax)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-06-07T10:27:17.380

这两种情况都对我有用（在 linux 和 windows 上）：

```
syntax: regexp
^backup/     #root folder
nbproject/   #any folder 
```

或者

```
syntax: glob
./backup/*   #root folder
nbproject/*  #any folder 
```

但是，在我将 .hgignore 文件的链接添加到我的 repo 中的 .hgrc 文件之前：

```
[ui]
ignore = .hg/.hgignore 
```

另外值得一提的是，mercurial 会忽略**当前未跟踪**的文件，这些文件是在您将其配置为忽略它们之前添加的。所以，不要被 hg status 推迟，说一些文件是 M（修改）或！（缺失）在您刚刚添加到忽略列表的文件夹中！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-11-25T03:27:08.083

在存储库的根目录下创建 .hgignore 文件

现在在文件中添加以下内容。

> 语法：glob
> 
> 斌/**
> 
> *.DS_Store

这将从存储库中删除 bin 目录和所有 *.DS_Store 文件

# python - Python - 设置/获取环境变量和地址

> ID：310118
> 
> 赞同：1
> 
> 时间：2008-11-21T20:37:47.937
> 
> 标签：python, linux, environment-variables

我需要在 Python 中设置一个环境变量，并在内存中找到它所在的地址。因为它在 Linux 上，所以我不介意使用只能在 Linux 上始终如一地工作的库（如果这是唯一的方法）。你会怎么做？

编辑：问题的范围如下：我正在尝试破解类程序，基本上我将我的 shellcode 放入环境变量中，然后用我的环境变量的地址覆盖受害者代码上的一个字节. 我需要找到一种在 Python 中实现自动化的方法，所以我的问题有两个：

*   有没有办法在环境变量的内存中获取地址？

*   这只能在 bash/C 中完成，还是我可以纯粹在 Python 中完成？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T21:42:13.547

要访问和设置环境变量，请阅读 os.environ 字典。您还可以使用 os.putenv 设置环境变量。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T20:50:52.980

内置函数 id() 为任何对象返回一个唯一的 id，它恰好是它的内存地址。

[http://docs.python.org/library/functions.html#id](http://docs.python.org/library/functions.html#id)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T01:50:44.263

将地址本身传递到环境变量中，然后使用 os.getenv() 读取它。

# c# - 如何打破 BoundField 的 HeaderText

> ID：310121
> 
> 赞同：20
> 
> 时间：2008-11-21T20:38:57.793
> 
> 标签：c#, gridview, boundfield, headertext

在表格的 td 中的 HTML 中，您可以通过`<BR>`在单词之间使用来中断文本。这也适用于 TemplateItem 的 HeaderText，但不适用于 BoundField 的 HeaderText。如何分解 BoundField 的标题文本。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-11-21T20:48:56.040

设置`HtmlEncode = false`在里面`BoundField`

```
 <asp:BoundField DataField="SomeDataField" 
        HeaderText="SomeHeader<br />(OtherData)" 
        HtmlEncode="false" /> 
```

`BoundField.HtmlEncode`默认情况下为 true，这意味着如果在文本中添加 HTML，它将被编码。
如果 HtmlEncode 设置为 false，则文本不会被编码，并且 br 将按预期工作。不幸的是，不能只为标题文本指定这个，它也会影响单元格的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-12-18T19:18:08.473

对于那些试图在不禁用 HtmlEncode 的情况下执行此操作的人来说，这很简单，虽然看起来有点傻。只需使用真正的换行符。像这样...

```
<asp:BoundField DataField="ProposedExtractionStartDate" HeaderText="Proposed
                        Extraction Start Date" SortExpression="ProposedExtractionStartDate"  DataFormatString="{0:MM/dd/yyyy}" /> 
```

当 HTML 呈现时，这实际上会显示为多行。

如果有一个字符组合可以表示这一点，我很想知道。

# visual-studio-2008 - Post Build 以代码 1 退出

> ID：310126
> 
> 赞同：113
> 
> 时间：2008-11-21T20:41:53.713
> 
> 标签：visual-studio-2008, post-build

我有一个带有后期构建事件的项目：

```
copy $(ProjectDir)DbVerse\Lunaverse.DbVerse.*.exe  $(TargetDir) 
```

每次在我的机器上都能正常工作。我有一个新开发人员，他总是收到“以代码 1 退出”错误。我让她在 DOS 提示符下运行相同的命令，它运行良好。这可能是什么原因造成的？有没有办法解决真正的错误？

我们都使用 Visual Studio 2008。

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2008-11-21T21:52:13.697

她在路径中的一个文件夹名称中有一个空格，并且没有引号。

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2010-02-18T19:51:26.973

带有“Pings”的那个帮助了我......但可能会更好地解释......

对我来说，解决方案是改变：

```
copy $(TargetDir)$(TargetName).* $(SolutionDir)bin 
```

对此：

```
copy "$(TargetDir)$(TargetName).*" "$(SolutionDir)bin" 
```

希望对你有效。:-)

* * *

## 回答 #3

> 赞同：56
> 
> 时间：2012-05-04T01:52:45.500

*我已经为未来的访客添加了这个，因为这是一个非常活跃的问题。*

ROBOCOPY 以低于 8 的“成功代码”退出。请参阅：http: [//support.microsoft.com/kb/954404](http://support.microsoft.com/kb/954404)

这意味着：

```
robocopy exit code 0 = no files copied
robocopy exit code 1 = files copied
When the result is 1, this becomes an error exit code in visual studio. 
```

**所以我**通过将它添加到批处理文件的底部轻松解决了这个问题

```
exit 0 
```

建议以这种方式处理 ROBOCOPY 错误

```
rem each robocopy statement and then underneath have the error check.
if %ERRORLEVEL% GEQ 8 goto failed

rem end of batch file
GOTO success

:failed
rem do not pause as it will pause msbuild.
exit 1

:success
exit 0 
```

*当没有文件被复制时会出现混乱= VS 中没有错误。然后，当发生更改时，文件确实会被复制，VS 错误，但开发人员想要的一切都已完成。*

*附加提示：不要在脚本中使用暂停，因为这将成为 VS 构建中的无限暂停。在开发脚本时，使用类似`timeout 10`. 您会注意到这一点并将其注释掉，而不是挂起构建。*

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2010-12-27T22:01:36.353

我选择代码 1 的原因是目标文件夹是只读的。希望这对某人有帮助！我有一个构建后事件来从一个目录复制到另一个目录，并且目标是只读的。所以我只是去取消选中目录及其所有子目录的只读属性！只要确保它是一个安全的目录！

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-11-21T20:50:34.803

从 SysInternals获取[进程监视器](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx) 设置它来监视 Lunaverse.DbVerse（在 Path 字段上）查看操作结果。从那里应该很明显出了什么问题

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2012-04-30T21:31:42.240

我必须以管理员身份运行 VS 才能让我的构建后副本到受操作系统保护的“..\Common7\IDE\PrivateAssemblies”才能工作

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2016-10-31T15:04:19.227

我有一个类似的问题，但特别是在 Jenkins 构建环境中。为了解决这个问题，我从在构建后事件中使用复制命令切换到使用复制目标。

我改变了这个：

```
 <PropertyGroup>
      <PostBuildEvent>copy $(ProjectDir)bin\BLAH.Common.xml $(ProjectDir)App_Data\BLAH.Common.xml</PostBuildEvent>
   </PropertyGroup> 
```

对此：

```
 <Target Name="AfterBuild">
    <Copy SourceFiles="$(ProjectDir)bin\BLAH.Common.xml" DestinationFolder="$(ProjectDir)App_Data\" />
  </Target> 
```

现在工作正常。

我得到的具体错误是：

```
(PostBuildEvent target) -> 
  C:\Windows\Microsoft.NET\Framework\v4.0.30319\Microsoft.Common.targets(4291,5): error MSB3073: The command "copy <http://1.2.3.4/job/BLAHv2/ws/Api/bin/BLAH.Common.xml> <http://1.2.3.4/job/BLAHv2/ws/Api/App_Data/BLAH.Common.xml"> exited with code 1\. [<http://1.2.3.4/job/BLAHv2/ws/Api/Api.csproj]> 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-12-27T14:13:12.717

对于那些在**项目->属性**中的**构建事件**（**预构建事件命令行**或/和**构建后事件命令行**）中使用“**复制**”命令的人：您的“**复制**”命令参数应如下所示：。请记住使用引号（以避免地址字符串中的空格出现问题）。**********`copy "source of files" "destination for files"`**********

 ******* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-08-19T17:45:48.947

我能够通过以管理员身份运行 Visual Studio 来修复我的代码 1。显然它没有权限在没有管理员的情况下执行 shell 命令。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2014-08-28T13:59:29.547

好的，这是一个有很多解决方案的问题，所以我只是发布我的问题来给人们更多的提示。我的情况是仔细检查路径中的文件夹并确保它们都存在于您的机器中。例如：“$(SolutionDir)\partBin\Bin\$(ProjectName).pdb”，但“Bin”不在 partBin 文件夹中。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-11-21T21:58:28.443

[作为一个好的做法，我建议您用MS Build File Copy 任务](http://msdn.microsoft.com/en-us/library/3e54c37h.aspx)替换 post build 事件。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-07-18T14:18:04.733

对我来说，我必须确保我正在处理文件的程序当时没有运行。语法没有任何错误。希望这可以帮助某人。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2012-12-01T18:26:12.777

我刚刚收到同样的错误。我在目标路径中有一个 % 需要转义

```
c:\projects\%NotAnEnvironmentVariable% 
```

需要是

```
c:\projects\%%NotAnEnvironmentVariable%% 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-03-21T14:51:01.103

对于那些在项目 - > 属性中的构建事件（构建前事件命令行或/和构建后事件命令行）中使用“复制”命令的人：目标文件夹应该存在

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-02-14T02:24:35.323

这么多解决方案...

就我而言，我必须使用非 unicode（西方，Windows）编码保存 bat 文件。默认情况下，当我将文件添加到 Visual Studio 时（可能我应该在 VS 之外完成），它添加了 UTF-8 编码。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-07-06T15:43:11.637

我遇到了同样的问题，原来是因为我重命名了项目。我进入项目属性并将程序集名称和根命名空间更改为项目名称，之后效果很好！

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-06-19T04:11:50.623

还有一个答案...

就我而言，我有一个针对 .Net Standard 1.3 和 .Net Framework 2.0 的 Visual Studio 2017 项目。这是在 .csproj 文件中指定的，如下所示：

```
<TargetFrameworks>netstandard1.3;net20</TargetFrameworks> 
```

我还有一个像这样的构建后事件命令行：

```
copy "E:\Yacks\YacksCore\YacksCore\bin\net20\Merlinia.YacksCore.dll" "E:\Merlinia\Trunk-Debug\Shared Bin\" 
```

换句话说，我试图将构建生成的 .Net Framework .dll 复制到另一个位置。

当我进行重建时，此错误失败：

```
MSB3073 The command "copy "E:\Yacks\YacksCore\YacksCore\bin\net20\Merlinia.YacksCore.dll" "E:\Merlinia\Trunk-Debug\Shared Bin\"" exited with code 1. 
```

经过一番挫折后，我终于确定发生的事情是 Rebuild 删除了所有输出文件，然后为 .Net Standard 1.3 进行了构建，然后尝试运行构建后事件命令行，但由于要复制文件而失败还没有建成。

所以解决办法是改变构建顺序，即先构建.Net Framework 2.0，然后构建.Net Standard 1.3。

```
<TargetFrameworks>net20;netstandard1.3</TargetFrameworks> 
```

这现在可以工作了，构建后事件命令行运行两次的小故障，因此文件被复制了两次。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-08-07T06:07:55.933

在我的情况下，我必须`cd`在调用 bat 文件之前（更改目录），因为 bat 文件内部是一个指定相对路径的复制操作。

```
:: Copy file
cd "$(ProjectDir)files\build_scripts\"
call "copy.bat" 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-03-08T15:48:42.483

对我来说，原因是构建在构建输出文件夹（x86）上创建了一个平台文件夹，修复是在 VS 中将解决方案平台从“混合平台”更改为“任何 CPU”

[![VS 2019](https://i.stack.imgur.com/IKdxF.png)](https://i.stack.imgur.com/IKdxF.png)

# c# - 在 WCF 服务中传递接口？

> ID：310160
> 
> 赞同：19
> 
> 时间：2008-11-21T20:54:24.797
> 
> 标签：c#, .net, wcf

我正在尝试使用 WCF 服务，并且遇到了传递接口的问题。

这有效：

```
[ServiceContract]
public interface IHomeService
{
    [OperationContract]
    string GetString();
} 
```

但这不是：

```
[ServiceContract]
public interface IHomeService
{
    [OperationContract]
    IDevice GetInterface();
} 
```

当我尝试编译客户端时，它在 GetInterface 方法上失败。我收到一个异常，说它无法将 Object 转换为 IDevice。

在客户端，IHomeService 类正确地使用字符串实现 GetString 作为它的返回类型，但 GetInterface 具有对象的返回类型。为什么不是 IDevice？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-21T20:58:56.113

您需要告诉 WCF 序列化程序使用哪个类来序列化接口

```
[ServiceKnownType(typeof(ConcreteDeviceType)] 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-21T21:41:27.010

谢谢，当我像这样更改它时它可以工作：

```
[ServiceContract]
[ServiceKnownType(typeof(PhotoCamera))]
[ServiceKnownType(typeof(TemperatureSensor))]
[ServiceKnownType(typeof(DeviceBase))]
public interface IHomeService
{
    [OperationContract]
    IDevice GetInterface();
} 
```

我也从这个网站得到了帮助：[http ://www.thoughtshapes.com/WCF/UsingInterfacesAsParameters.htm](http://www.thoughtshapes.com/WCF/UsingInterfacesAsParameters.htm)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-04-03T11:48:18.207

我最初尝试将接口传递给 WCF 方法，但无法使用此线程上提供的答案使代码正常工作。最后我重构了我的代码并将一个抽象类传递给方法而不是接口。我通过使用基类上的 KnownType 属性使其工作，例如

```
[DataContract]
[KnownType(typeof(LoadTypeData))]
[KnownType(typeof(PlanReviewStatusData))]
public abstract class RefEntityData : EntityData, IRefEntityData 
```

# .net - 确定当前用户是域用户还是本地用户？

> ID：310161
> 
> 赞同：6
> 
> 时间：2008-11-21T20:54:32.863
> 
> 标签：.net

有没有办法确定（最好是.NET）当前用户是域用户帐户还是本地用户帐户？

提前 - 我不知道正在运行的域名，所以我不能只查找 DOMAIN\Username v COMPUTER\Username。

部分答案可能是从代码中确定 DOMAIN 或 COMPUTER 名称。

[编辑] 扩展 Asher 的答案，代码片段将是

```
private bool isCurrentUserLocalUser()
{
    return Environment.MachineName == Environment.UserDomainName;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T20:58:27.940

查看该帖子并检查它是否在回答您的问题

[我如何检测如果我的程序在活动目录环境中运行](https://stackoverflow.com/questions/140579/how-do-i-detect-if-my-program-runs-in-an-active-directory-environment)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T21:04:27.960

您可以使用[Environment.UserDomainName](http://msdn.microsoft.com/en-us/library/system.environment.userdomainname.aspx) MSDN 文档解释了此属性在每种情况下的确切行为（域/本地帐户）

您可以将此属性与 Environment.MachineName 等其他属性结合使用，以确定正在使用的用户帐户的类型。

请注意，域帐户不一定是 Active Directory（可以是 Novell Netware 的东西）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T20:56:53.403

您可以查看完整的用户名，分别是域和本地帐户的 <domain name>\<username> 或 <machine name>\<username>。如果第一部分与域名匹配，则显然是域帐户，反之亦然。

# c# - C# 极限编程冒险中的勘误表？

> ID：310164
> 
> 赞同：0
> 
> 时间：2008-11-21T20:55:02.113
> 
> 标签：c#, textbox, extreme-programming

我正在尝试通过 Ron Jeffries 的 C# 极限编程冒险。然而，我被困在第 3 章中，因为代码没有**也不能**按照作者所说的那样做。

基本上，文本说我应该能够在启用自动换行的文本框中写一些文本。如果我然后将光标移动到中间行并按 Enter，则代码应重新显示光标之前的行，添加几行和一组 HTML 段落标签，然后附加其余行。该代码与文本不匹配，因为它使用了 textbox.lines 属性。好吧，无论文本框中有多少自动换行，Lines 属性中只有一行，直到您按回车键。因此，代码应该“将其余行复制到缓冲区中”的语句对我来说似乎是错误的。

我会很感激任何有这本书经验的人告诉我我在读什么，或者在做什么，错了！

谢谢。

猛禽

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T22:02:56.203

尝试直接给 Ron Jeffries 发送电子邮件。我有这本书——在某个地方，但我不记得它没有用。他的电子邮件地址是 acm dot org 的 ronjeffries，并将 [Ron] 放在主题行中。

（对于那些想知道的人 - 他的电子邮件信息来自他的网站[欢迎页面](http://www.xprogramming.com/welcome.htm)）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-30T12:38:03.760

我也刚刚开始阅读这本书并且遇到了完全相同的问题，尽管您包含的代码看起来比我现在的位置更远。“下标超出范围”的发生有两个原因，首先是 Ron 解释说他只是在测试，因此在他编写 CursorLine() 函数之前返回了一个硬编码值 3，这意味着你我认为至少是 4？正如您所说的需要粘贴的文本行，或者可能在运行之前将文本设置为此值，也正如您所说，它们需要回车以使 txtbox.Lines 返回一个字符串数组。第二个原因即使在实施 CursorLine() 之后也会发生，但仅在文本框为空时发生，因为 txtbox.Lines 返回 string[0] 但我认为 Ron 正在实施一个“用户故事”，它表示当输入文本时用户按下回车，

作者确实声明他们正在学习 C#，并将展示开发疣的全部内容，这是我选择学习这本书的原因之一，因为我认为它鼓励我开发项目。我也尝试先编写代码，然后再查看他的解决方案，看看我是否有同样的想法，但也许我对 C# 的了解比我自己认为的要好一些，或者我完全是废话，但我已经注意到一些事情，首先他说覆盖 OnKeyDown() 不起作用，但我认为他一定很困惑并试图在 Form 中做，而不是从 TextBox 派生并在那里覆盖。这是我阅读“用户故事”时的代码：

```
int curPos = txtbox.SelectionStart;
string Wrd = Environment.NewLine + "<P></P>" + Environment.NewLine;              
txtbox.SelectedText = Wrd;
int pl = Environment.NewLine.Length + 3; // "<P>" length is 3
// Put text cursor inbetween <P> tags
txtbox.SelectionStart = curPos + pl; 
```

它的工作方式与 Ron 的代码不同，但这只是我对“用户故事”的解释，不确定如果选择了文本应该如何操作，或者如果文本光标在中间等是否分割行。

同样在 C# 中的极限编程冒险中的“我的冒险”中

```
txtbox.GetLineFromCharIndex(txtbox.SelectionStart) 
```

获取光标行位置，如果没有回车或调整大小无关紧要，据我所知，我做了很少的测试：

```
txtbox.GetLineFromCharIndex(txtbox.TextLength) 
```

它返回总行数，如果您调整文本框的大小，总行数会有所不同。

使用 C# 我总是在寻找已经存在的解决方案，人们可​​能会为此而选择我，但我认为 MS 已经创建了一种很棒的语言，其中包含很棒的组件，可以做你期望他们做的事情，所以不必重新创建轮子时间。尽管就像我说的那样，这本书还处于早期阶段，也许这些简单的解决方案还不够可扩展，也许 Ron 考虑到了这一点，尽管他确实提到让它工作，然后担心以后更多的是 XP 方式。

沃伦。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T22:05:11.643

```
print("using System; 
```

使用 System.Collections；使用 System.Collections.Generic；使用 System.Text；

命名空间 NotepadOne {

公共类文本模型 {

```
private String[] lines;
private int selectionStart;
private int cursorPosition;

public TextModel() {

}

public String[] Lines {
  get {
    return lines;
  }
  set {
    lines = value;
  }
}

public int SelectionStart {
  get {
    return selectionStart;
  }
  set {
    selectionStart = value;
  }
}

public int CursorPosition {
  get {
    return cursorPosition;
  }
  set {
    cursorPosition = value;
  }
}

public void InsertControlPText() {
  lines[lines.Length - 1] += "ControlP";
}

public void InsertParagraphTags() {
  int cursorLine = CursorLine();
  String[] newlines = new String[lines.Length + 2];
  for (int i = 0; i <= cursorLine; i++) {
    newlines[i] = lines[i];
  }
  newlines[cursorLine + 1] = "";
  newlines[cursorLine + 2] = "<P></P>";
  for (int i = cursorLine + 1; i < lines.Length; i++) {
    newlines[i + 2] = lines[i];
  }
  lines = newlines;
  selectionStart = NewSelectionStart(cursorLine + 2);
}

private int CursorLine() {
  int length = 0;
  int lineNr = 0;
  foreach (String s in lines) {
    if (length <= SelectionStart && SelectionStart <= length + s.Length + 2) {
      break;
      length += s.Length + Environment.NewLine.Length;
      lineNr++;
    }
    lineNr++;
  }
  return lineNr;
}

private int NewSelectionStart(int cursorLine) {
  int length = 0;
  for (int i = 0; i < cursorLine; i++) {
    length += lines[i].Length + Environment.NewLine.Length;
  }
  return length + 3;
} 
```

} } ");

通过在文本框中按回车键调用 InsertParagraphTags 方法。

顺便说一句，这里的中断是如果您尝试在文本末尾按 Enter 键，则会出现下标超出范围错误。我确信我可以弄清楚如何解决这个问题，但是我的代码看起来不像他的代码；这就是我想要学习的。

兰迪

# c# - 在 C# 中，如何序列化 Queue<>？(.Net 2.0)

> ID：310167
> 
> 赞同：8
> 
> 时间：2008-11-21T20:55:49.990
> 
> 标签：c#, .net, generics, serialization, .net-2.0

在 XmlSerializer 构造函数行，下面会导致 InvalidOperationException，它还抱怨没有为泛型类型实现默认访问器。

```
Queue<MyData> myDataQueue = new Queue<MyData>();

// Populate the queue here

XmlSerializer mySerializer =
  new XmlSerializer(myDataQueue.GetType());    

StreamWriter myWriter = new StreamWriter("myData.xml");
mySerializer.Serialize(myWriter, myDataQueue);
myWriter.Close(); 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-21T20:57:01.437

*序列化队列中的数据*会更容易（也更合适 IMO）- 也许在平面数组或`List<T>`. 由于`Queue<T>`implements `IEnumerable<T>`，您应该能够使用：

```
List<T> list = new List<T>(queue); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T21:12:24.853

并非框架的所有部分都是为 XML 序列化而设计的。你会发现连载部门也缺少字典。

队列很容易实现。您可以轻松创建自己的也实现 IList 的，以便它可以序列化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T21:07:27.297

如果你想使用内置的序列化，你需要遵守它的规则，这意味着默认 ctor，以及你想要序列化的成员的公共 get/set 属性（并且可能是反序列化）你想要序列化的数据类型（MyData )

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-02-04T16:14:42.873

就我而言，我有一个动态队列，我必须保存并加载这个队列的状态。

使用 Newtonsoft.Json：

```
List<dynamic> sampleListOfRecords = new List<dynamic>();
Queue<dynamic> recordQueue = new Queue<dynamic>();
//I add data to queue from a sample list
foreach(dynamic r in sampleListOfRecords)
{
     recordQueue.Enqueue(r);
}

//Serialize
File.WriteAllText("queue.json",
     JsonConvert.SerializeObject(recordQueue.ToList(), Formatting.Indented));
//Deserialize
List<dynamic> data = 
     JsonConvert.DeserializeObject<List<dynamic>>(File.ReadAllText("queue.json")); 
```

# c++ - 像Kate这样的程序中使用的Kde栏的小部件名称是什么？（内图）

> ID：310175
> 
> 赞同：2
> 
> 时间：2008-11-21T20:57:32.810
> 
> 标签：c++, reference, toolbar, kde

提供隐藏/取消隐藏小部件按钮的 Kde 栏的对象名称是什么？我在 kde 官方 API 参考资料上找不到。它用于像Kate，Kdevelop这样的程序中。这里是凯特底部栏的截图：http: [//emilio.plugs.it/bar.png](http://emilio.plugs.it/bar.png) [alt text http://emilio.plugs.it/bar.png](http://emilio.plugs.it/bar.png)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T19:54:19.690

那不是 KMultiTabBar 吗？

# web-services - SOAP Webservice 错误——设计实践

> ID：310178
> 
> 赞同：4
> 
> 时间：2008-11-21T20:58:37.457
> 
> 标签：web-services, design-patterns, soap

我需要设计一个 SOAP api（我的第一个！）。关于返回给调用者的错误的最佳实践是什么。

假设一个api如下

```
[WebMethod]
public List<someClass> GetList(String param1)
{
} 
```

我是不是该

*   抛出异常。让 SOAP 基础结构生成 SOAP 错误——调用者必须尝试/捕获。这对调用者来说不是很清楚
    2.  让返回参数是某种 XMLDOcument，第一个元素是返回值，然后是列表。
    3.  查看返回的 SOAP 数据包，我看到生成的响应如下所示

```
 <GetListResponse>
   <GetListResult>
     ...
     ...   
 </GetListResult>
</GetListResponse> 
```

我们能否以某种方式更改返回数据包，以便在发生错误时将“GetListResult”元素更改为“GetListError”

*   还有什么办法吗？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T22:02:03.023

Probably the most appropriate SOA pattern to follow would be a Fault Contract, which is essentially a Data Contract that is wrapped in the SOAPException.

I am posting examples in .NET, since it looks like that is what you are using (and that is what I know :) )

In WCF, you can define a DataContract, then decorate your OperationContract interface with a a "FaultContract" attribute that specifies it as the return value:

```
public partial interface MyServiceContract
{
    [System.ServiceModel.FaultContract(typeof(MyService.FaultContracts.ErrorMessageFaultContract))]
    [System.ServiceModel.OperationContract(...)]
    ResponseMessage SOAMethod(RequestMessage request) {...}
} 
```

For ASMX web services, (as it appears you are using from your code snippet), you can't use this attribute or setup. So to implement the pattern, you would need to:

*   Define a serializable class to hold your exception information (i.e. ErrorData)
*   When an exception is thrown in your service, catch it and in your error handling code, add the info to the ErrorData class
*   Append the serialized ErrorData class to a SoapException class:

    ```
    SoapException mySoapException = new SoapException(message, SoapException.ServerFaultCode, "", serialzedErrorDataClass); 
    ```

*   Throw the SoapException in your code

*   On your client side, you will need to deserialize the message to interpret it.

Kind of seems like a lot of work, but this way you have total control of what data gets returned. Incidentally, this is the pattern that is used by the [ServiceFactory](http://msdn.microsoft.com/en-us/library/cc487895.aspx) from Microsoft patterns & practices for ASMX web services.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-22T20:30:50.763

There is [some good information on Coding Horror](http://www.codinghorror.com/blog/archives/000054.html).

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-23T00:58:00.163

您可以从旧的 ASMX 服务中返回正确的错误，但这并不容易。首先，您必须手动编写 WSDL 代码，因为 ASMX 基础架构永远不会在 WSDL 中创建故障元素。然后，您必须将所需的故障数据序列化到一个 XmlElement 中，然后将其作为您将抛出的 SoapException 的 Detail 属性提供。

使用 WCF 更容易。您可以为每个操作声明多个 FaultContract，WCF 将生成正确的 WSDL 来引用它们。然后，您只需抛出一个 FaultException，其中类型 T 是 FaultContract 的类型。将 T 实例传递给构造函数，一切就绪。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-22T20:37:10.563

I can't give you specifies for .net (which seems to be what you're asking), but SOAP provides a mechanism for expressing strongly-typed exceptions. The SOAP fault element can have an optional FaultDetail sub-element, and this can contain arbitrary XML documents, such as your GetListError. These document types should be defined in the WSDL as a wsdl:fault inside the wsdl:operation

The trick is persuading the web service stack to turn an exception (which is the "correct" way of writing your business logic) into a properly marshalled fault detail. And I can't help you with that bit.

# c# - 过滤 GridView 的下拉列表

> ID：310185
> 
> 赞同：0
> 
> 时间：2008-11-21T21:02:50.990
> 
> 标签：c#, gridview, drop-down-menu

我尝试了不同的示例来通过下拉列表过滤网格视图，但是在按钮 on_click 事件中是否有可能？我是否在每个下拉列表中创建了类似于 SelectedItem 的内容并将它们添加到按钮事件中？抱歉含糊不清....我希望下拉列表带有选定的值，然后将它们加在一起以根据返回的结果执行过滤器。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-21T21:12:06.010

您的问题似乎有点含糊，但如果我解释正确，您需要几个下拉列表和一个按钮。在按下按钮之前，不应进行过滤。

是的，您应该能够将代码放入引用下拉列表的 SelectedItem(s) 或 SelectedValue(s) 的 button_click 事件中，然后构建可用于设置 GridView 的 RowFilter 的表达式。

# linux - 在 sed 或 awk 中，如何处理 * 可能 * 跨越多行的记录分隔符？

> ID：310191
> 
> 赞同：3
> 
> 时间：2008-11-21T21:04:33.683
> 
> 标签：linux, sed, awk, gawk

我的日志文件是：

```
 Wed Nov 12 blah blah blah blah cat1
 Wed Nov 12 blah blah blah blah
 Wed Nov 12 blah blah blah blah 
 Wed Nov 12 blah blah blah blah cat2
     more blah blah
     even more blah blah
 Wed Nov 12 blah blah blah blah cat3
 Wed Nov 12 blah blah blah blah cat4 
```

我想解析在第一行找到 cat 的完整多行条目。`sed`在和/或中执行此操作的最佳方法是什么`awk`？

即我希望我的解析产生：

```
 Wed Nov 12 blah blah blah blah cat1
 Wed Nov 12 blah blah blah blah cat2
     more blah blah
     even more blah blah
 Wed Nov 12 blah blah blah blah cat3
 Wed Nov 12 blah blah blah blah cat4 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T21:32:40.837

假设您的日志文件不包含控制字符`'\01'`和`'\02'`，并且连续行以四个空格开头，则以下可能有效：

```
c1=`echo -en '\01'`
c2=`echo -en '\02'`
cat logfile | tr '\n' $c1 | sed "s/$c1    /$c2/g" | sed "s/$c1/\n/g" | grep cat | sed "s/$c2/\n    /g" 
```

说明：这会将每个换行符替换为 ASCII 1（一个永远不应出现在日志文件中的控制字符），并将每个序列“newline-space-space-space-space”替换为 ASCII 2（另一个控制字符）。然后它用换行符重新替换 ASCII 1，因此现在将多行的每个序列放入一行，用 ASCII 2 替换旧的换行符。这是 cat 的 grepped，然后 ASCII 2 被重新替换为换行-空格-空格-空格-空格组合。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T21:41:45.577

如果您说以空格开头的每一行都是使用 (g)awk 轻松完成的后续操作（这是我的记忆，所以它可能包含一些小错别字，并且为了提高可读性，添加了一些额外的换行符）：

```
awk " BEGIN { multiline = 0;} 
      ! /^ / { if (whatever) 
                 { print; multiline = 1;} 
               else 
                 multiline = 0; 
             } 
        /^ / {if (multiline == 1) 
                 print;
             } 
     " 
      yourfile 
```

你在哪里`whatever`检查你的输出是否应该发生（例如对于猫）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T21:43:12.843

像这样的东西？

```
awk 'function print_part() { if(cat) print part }  /^  / { part = part "\n" $0; next } /cat[0-9]$/ { print_part(); part = $0; cat = 1; next;  } { print_part(); cat=0} END { print_part() }' inputfile 
```

正`/^ /`则表达式标识续行。

正`/cat[0-9]$/`则表达式标识您要保留的起始行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-04-18T07:45:37.990

另一种方法是设置`RS`为不同于 normal 的东西`\n`。例如：

```
$ awk -v Pre=Wed 'BEGIN {RS = "\\n?\\s*" Pre} /cat.\n?/ {print Pre $0}' file.log
Wed Nov 12 blah blah blah blah cat1
Wed Nov 12 blah blah blah blah cat2
     more blah blah
     even more blah blah
Wed Nov 12 blah blah blah blah cat3
Wed Nov 12 blah blah blah blah cat4 
```

# c++ - Visual Studio C++ 项目管理。如何处理项目中的非代码文件？

> ID：310192
> 
> 赞同：0
> 
> 时间：2008-11-21T21:04:36.587
> 
> 标签：c++, configuration, visual-studio-project

我在 C++ 解决方案中有一个项目。对于那个项目，我有一些我想在项目中管理的配置文件，当我构建项目时，将这些配置文件添加到正确目录结构中的可执行构建路径中。

例子：

test.exe 引用 config/myconfig.txt

有没有办法设置 myconfig.txt 和我的项目，所以当我构建 test.exe 时，我得到

/

也

//config/config.txt

所以当我运行测试时，所有路径都保持正确的顺序，而我不必进入并手动创建这些目录。

我不确定我在这里是否有意义，但也许你们中的一个人会明白我要去哪里。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-21T21:06:23.260

您可以使用预构建事件来创建目录并复制文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T21:34:49.740

在 Visual Studio 的解决方案资源管理器中，您可以右键单击非代码文件，选择“属性”并设置“复制到输出目录”属性。

这会在构建文件中创建一个规则，以 (1) 包含该文件，以及 (2) 将该文件作为构建过程的一部分进行复制。换句话说，可以在没有 Visual Studio 的情况下获得此行为，但需要做更多工作。

# python - 如何将以下文件名转换为 Python 中的正则表达式？

> ID：310199
> 
> 赞同：3
> 
> 时间：2008-11-21T21:08:07.687
> 
> 标签：python, regex

我现在打字时正在与正则表达式作斗争。

我想确定以下示例文件的模式：`b410cv11_test.ext`. 我希望能够搜索与上述示例文件的模式匹配的文件。我从哪里开始（如此迷茫和困惑）以及获得与文件模式最匹配的解决方案的最佳方法是什么？提前致谢。

***进一步澄清问题：***

我希望模式如下：必须以'b'开头，后跟三位数字，然后是'cv'，后跟两位数字，然后是下划线，然后是'release'，然后是.'ext'

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-22T11:09:25.397

既然您对文件名有了人类可读的描述，那么将其转换为正则表达式非常简单（至少在这种情况下；）

> 必须从

插入符号 ( `^`) 将正则表达式锚定到您要匹配的内容的开头，因此您的 re 必须以该符号开头。

> 'b',

re 中的任何非特殊字符都会按字面意思匹配，因此您只需在这部分使用“b” `^b`：.

> 后跟 [...] 数字，

这在一定程度上取决于您使用的 re：

最一般的表达方式是使用方括号 ( `[]`)。那些意思是“匹配其中列出的任何一个字符。`[ASDF]`例如将匹配`A`or`S`或`D`or `F`，`[0-9]`将匹配 0 到 9 之间的任何字符。

您的 re 库可能有“任何数字”的快捷方式。在你可以使用[原文如此！]，在 python 和许多其他你可以使用的语言`sed`中。`awk``[[:digit:]]``\d`

所以现在你的重新阅读`^b\d`。

> 随后是三个 [...]

表达这一点的最简单方法是像这样重复原子三遍`\d\d\d`：

同样，您的语言可能会提供一种快捷方式：大括号 ( `{}`)。有时您必须用反斜杠转义它们（如果您使用 sed 或 awk，请阅读“扩展正则表达式”）。它们还为您提供了一种方式来表示“前一个原子的出现至少 x，但不超过 y” `{x,y}`：。

现在你有：`^b\d{3}`

> 其次是“简历”，

再次进行文字匹配，现在我们有了`^b\d{3}cv`

> 后跟两位数，

我们已经介绍过这个：`^b\d{3}cv\d{2}`.

> 然后是一个下划线，然后是'release'，然后是.'ext'

同样，这应该完全匹配，但点 ( `.`) 是一个特殊字符。这意味着您必须使用反斜杠对其进行转义：`^\d{3}cv\d{2}_release\.ext`

省略反斜杠意味着像“b410cv11_test_ext”这样的文件名也会匹配，这对您来说可能是也可能不是问题。

最后，如果要保证“.ext”后面没有其他内容，请将 re 锚定到要匹配的内容的末尾，使用美元符号 ( `$`)。

因此，针对您的特定问题的完整正则表达式将是：

```
^b\d{3}cv\d{2}_release\.ext$ 
```

简单的。

无论您使用哪种语言或库，文档中的某处都必须有一个参考资料，该参考资料将向您展示您的案例中的确切语法应该是什么。一旦您学会了将问题分解为合适的描述，您就会逐步理解更高级的构造。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T21:14:03.430

为避免混淆，请按顺序阅读以下内容。

首先，您有[glob](http://www.python.org/doc/2.5.2/lib/module-glob.html)模块，它处理文件名正则表达式，就像 Windows 和 unix shell 一样。

其次，你有[fnmatch](http://www.python.org/doc/2.5.2/lib/module-fnmatch.html)模块，它只是使用 unix shell 规则进行模式匹配。

第三，你有[re](http://www.python.org/doc/2.5.2/lib/module-re.html)模块，它是一套完整的正则表达式。

然后问另一个更具体的问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-22T07:47:13.683

> 我希望模式如下：必须以'b'开头，后跟三位数字，然后是'cv'，后跟两位数字，然后是下划线，然后是'release'，然后是.'ext'

```
^b\d{3}cv\d{2}_release\.ext$ 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T21:33:58.023

你的问题有点不清楚。您说您想要一个正则表达式，但您是否想要一个可以与 ls 等命令一起使用的全局样式模式？glob 表达式和正则表达式在概念上相似，但在实践中有所不同（正则表达式更强大，glob 样式模式在查找文件时最常见的情况下更容易。

另外，你认为什么是模式？当然， * (glob) 或 .* (regex) 将匹配该模式。此外，*_test.ext (glob) 或 .* _test.ext (regexp) 模式将匹配，许多其他变体也是如此。

你能更具体地说明模式吗？例如，您可以将其描述为“b，后接数字，后接 cv，后接数字……”

一旦您可以用您的母语准确解释该模式（这必须是您的第一步），将其翻译成 glob 或正则表达式模式通常是一项相当简单的任务。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T23:07:05.607

如果字母不重要，您可以尝试匹配字母/数字模式的 \w\d\d\d\w\w\d\d_test.ext 或 b\d\d\dcv\d\d_test.ext或两者的混合。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-22T05:37:30.793

在使用正则表达式时，我发现[Mochikit 正则表达式示例很有帮助](http://mochikit.com/examples/mochiregexp/index.html)。

```
/^b\d\d\dcv\d\d_test\.ext$/ 
```

然后使用 python re (regex) 模块进行匹配。这当然是假设正则表达式确实是您需要的，而不是像其他人提到的那样 glob。

# apache-flex - FlexBuilder 如何编译我的应用程序？

> ID：310220
> 
> 赞同：4
> 
> 时间：2008-11-21T21:17:28.027
> 
> 标签：apache-flex, ant, flexbuilder

我想看看 FlexBuilder 用来编译我的应用程序的命令行参数。这样我就可以将它们构建到我正在处理的 ANT 脚本中。有没有办法查看命令行编译步骤？

我要求这样做的原因是，当我使用 Ant/Flex SDK 和 FlexBuilder 编译我的应用程序时，我的应用程序的行为会有所不同。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-02T19:09:31.183

所以我想出了答案。

首先，您可以通过在 FlexBuilder 的编译参数中添加 -dump-config=C:\myConfig.xml 来更好地了解 FlexBuilder 如何编译您的应用程序。这将输出一个 xml 文件，其中包含编译步骤中使用的配置设置。如果您愿意，也可以将此文件用作 compc 或 mxmlc 的参数。[在这里](http://kb.adobe.com/selfservice/viewContent.do?externalId=kb404341)阅读更多关于它 的信息......

但是，这实际上解决了我的问题。我使用安装在集成服务器上的常规旧 Flex SDK 来使用 Ant 编译我的应用程序。这是您可以从 Adob​​e 网站下载的免费 SDK。然后，我从本地机器中取出 FlexBuilder 目录并将其复制到集成服务器，并让我的构建脚本使用该版本的 SDK（并更改了我的路径 env 变量）。

当我使用 SDK 的 FlexBuilder 版本进行编译时，一切都很好，我在应用程序中看到的奇怪错误消失了。

故事的寓意是，确保您使用与本地构建相同的 SDK 版本进行自动化构建。

# python - cygwin下如何编译wxPython？

> ID：310224
> 
> 赞同：4
> 
> 时间：2008-11-21T21:18:01.630
> 
> 标签：python, installation, wxpython, cygwin, compilation

我正在使用 CYGWIN 作为平台并想使用 wxPython。有没有办法让源代码在 cygwin 中编译和工作？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-12-23T15:21:18.900

我找到了这个[在 Cygwin 下构建 wxPython 的](http://gnuradio.org/redmine/projects/gnuradio/wiki/WxPythonCygwin)链接。对我来说，这比安装所有 X11 的东西要好得多。我使用 wxPython-src-2.8.12.1 进行了尝试，并按照 tee 的说明进行操作，效果很好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T22:04:01.317

你需要一个完整的工作 X 环境才能让它工作。在普通 Windows 下使用 Python 和 wxPython 会容易得多。你有特殊情况吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-12-17T03:42:13.787

使用 wxPython 的重点不就是使用 WxWidgets 吗？使用 THAT 的重点不就是拥有一个跨平台的 GUI 库吗？

换句话说，忘掉 X11，只在 windows 上使用原生的 wxPython。

如果您想避免要求用户安装 wxPython 及其依赖项，请考虑编写安装程序。或者，研究 py2exe 以将 python“编译”为 .exe 文件（加上支持的 .zip 和 .dll 文件），这对于“仅通过复制文件进行安装”更为可修改。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-06-28T04:05:39.497

我尝试了另一种在 cygwin 中使用 wxPython 的解决方案：

1.  我在 Windows7 中安装了 python27 和 wxPython
2.  “echo 'export PATH=/cygdrive/c/Python27/:$PATH'>>~/.bashrc”
3.  重启cygwin

有用。欢呼！

我不知道是否应该添加任何其他路径，但我的程序是在 Fedora 上执行的，并且可以在那里运行。  

# .net - .NET 程序集名称是否应该包含版本号？

> ID：310226
> 
> 赞同：10
> 
> 时间：2008-11-21T21:18:24.373
> 
> 标签：.net, naming

我们目前在内部就实际的.NET 程序集名称是否应该包含代码的版本号（例如CodeName02.exe 或CompanyName.CodeName02.dll）进行了激烈的内部辩论。有没有人知道像微软这样的权威来源可以提供关于这个问题的指导？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-21T21:25:24.780

这就是 Properties/AssemblyInfo.cs 文件的用途。

该文件中有两个版本，文件版本和程序集版本：

```
[assembly: AssemblyVersion("1.1.0.256"]
[assembly: AssemblyFileVersion("1.1.0.256")] 
```

一旦设置好这些，您就可以使用它们来跟踪您的二进制文件的版本。可以在资源管理器中通过右键单击-> 属性轻松查看。

Microsoft 的应用程序（和操作系统）中包含的任何 dll 或 exe 名称都没有使用该约定。

其他系统将使用这些数字来解决依赖关系并验证版本。例如，MSI 系统将根据版本属性更新二进制文件。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-21T21:25:52.393

微软的[Krzysztof Cwalina](http://blogs.msdn.com/kcwalina/)和[Brad Abrams的](http://blogs.msdn.com/brada/)[框架设计指南](https://rads.stackoverflow.com/amzn/click/com/0321246756)建议将程序集命名为

```
<Company>.<Component>.dll 
```

我进一步支持这一点（不使用版本号），因为 GAC 和 dll 文件属性将显示版本。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-11T13:53:11.047

我知道 DevExpress[网站](http://devexpress.com)使用版本指示符作为其程序集名称的一部分，例如 XtraEditors8.2.dll。我猜原因是您希望能够在同一目录中拥有多个版本的程序集。例如，我们有大约 15 个智能客户端，它们作为同一外壳/客户端的一部分分布。每个 smartclient 可以有不同版本的 DevExpress 控件，因此我们需要能够让 XtraEditors7.1.dll 和 XtraEditors8.2 存在于同一目录中。

我会说，如果您有公共库是可重用模块的依赖项并且可以存在于多个版本 1.0、1.1、1.2 等中，那么版本号可以包含在名称中以避免冲突将是一个有效的论点。鉴于通用库不在 GAC 中。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-21T21:23:26.487

我不知道有任何权威性，但在我看来，使用一致的名称可以简化从安装脚本到文档的所有过程。鉴于可以将版本作为元数据存储在文件中，我不知道为什么在文件名中需要它。为什么要为不得不考虑不同名称的文件而烦恼呢？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-21T21:24:12.647

只需查看 .NET 框架或任何其他 Microsoft 产品即可。将版本号作为程序集名称的一部分听起来是个坏主意。

在程序集的元数据部分中有此（和其他信息）的位置。(AssemblyInfo.cs)

此信息可以在 Windows 资源管理器中查看（属性对话框、状态栏、工具提示 - 它们都显示此信息）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-24T15:38:00.473

我认为将版本号放在 DLL 的文件名中的主要思想是从*DLL Hell*带来的，其中有多个版本的 DLL，所有版本都具有相同的名称会导致问题（即你有哪个 DLL 的实际版本和它是否具有所需的功能等）。

与更传统的 C/C++ DLL 文件相比，.NET 框架处理的依赖关系完全不同，GAC 中可能有多个版本的库，主要是因为 GAC 是链接到其他文件的“假”文件夹在文件系统上，除了能够将程序集包含在可执行安装中（相同的文件夹部署等）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-21T21:23:33.863

版本信息可以包含在 assemblyInfo 文件中，然后可以通过反射等方式进行查询。

一些供应商在名称中包含版本号，以便一目了然。Microsoft dll 名称在框架目录中不包含版本号。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-21T21:24:54.750

由于版本可以设置为属性，这不是半多余的吗？

我也会冒险并建议 MS 没有标准，因为快速查看它们的 DLL 名称：user32.dll、tcpmon.dll、winsock.dll 等。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-04-26T02:03:11.550

Microsoft used a suffix of 32 to denote 32 bit DLL versions so that those DLL's could coexist with the existing 16 bit DLL files.

# architecture - 说服公司将新技术和技术添加到他们的标准体系中？

> ID：310243
> 
> 赞同：6
> 
> 时间：2008-11-21T21:25:25.390
> 
> 标签：architecture, standards

我在一个严重依赖技术标准的组织工作。在过去，这很好，有助于为开发人员提供指导，并帮助他们真正轻松地跨团队移动。

然而，在过去的一年里，我发现了使用新技术做事的更有效方法，我正在努力将这些策略添加到技术路线图中。

有没有人有过这种经历，如果有，他们做了什么来改变组织？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-21T21:29:55.270

经许可，提出使用新技术做一个小项目。证明它的价值和它的作用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-22T04:05:43.100

我在一个我认为是相当落后和古老的商店。我们仍在使用 CVS（！），Perl 本周才从 5.6 升级到 5.8，而我们今年才从 4 开始使用 PHP 5。如果你取得任何成功，请告诉我:) 但根据经验，我可以告诉你，有时阻碍采用新技术的一个重要因素并不是技术的好处和优势不为人所知或不被承认，而是而是管理层想要解决的更紧迫的优先事项。

如果团队、部门或公司正在使用当前使用的技术，或者甚至在它们方面做得相对较好，那么改变甚至试驾新东西可能还没有足够的理由。

我正在做的你可能会考虑的事情是记录你认为劣质的技术遇到的实际的、有形的问题。例如，在我的情况下，我会记录 CVS 给团队任何成员带来问题或挫折的时间，尤其是当我的首选解决方案 (git) 可以节省团队时间，或者使 CVS 的快速解决方案成为可能时不允许。在某些时候，积累的证据可能足以支持改变新技术的决定。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T22:35:04.750

我在一家小型机构工作，我很幸运能够直接接触到我的老板。当我找到更好的工作方式时，我只是确保让他知道在工作周期的早期有一些选择。随着时间的推移，我们建立了一定程度的信任，每次我提出一种新方法时，阻力都会越来越少。

我还确保准确记录使用新技术节省了多少时间/金钱。这很容易成为发展公司流程的最引人注目的方式。Bean 计数器喜欢指标！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T01:25:59.040

如果您所做的事情最终得到了您以外的一群人的支持，那么您需要遵守标准。你能想象没有标准的开源开发吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-01-06T02:19:12.867

如果您向适当的决策者清楚合理地提出您的意见，您的建议很有可能被接受。

一些技巧：

*   阐明标准变化的*价值*。*确保您根据商业价值*来表达这一点，而不仅仅是您自己的个人偏好或便利。
*   确保您可以证明与收益相比，变更的*成本和风险*很小。如果你能量化这些，它会大有帮助。

例子：

*   对最新版本的 Java 进行标准化将意味着我们不必以每年 YYm 英镑的成本继续维护 XX 个旧代码分支。
*   采用云基础设施技术 YY 将提供新服务器的时间从 7 天减少到 1 天，这将使我们能够向客户收取 6 天的额外收入。风险很低，因为我们已经在 A 团队成功地试用了这项技术。

# sql-server-2005 - 在 SQL Server 2005 中将值转换为 FLOAT 时出错

> ID：310245
> 
> 赞同：1
> 
> 时间：2008-11-21T21:26:06.340
> 
> 标签：sql-server-2005, casting, floating-point, fixed-point

我正在尝试让一个存储过程为生病的同事工作（因此不能要求指导）。

我有一个具有此确切过程的 SQL Server 2005 数据库，并且我正在尝试制作脚本来转换测试数据库以匹配此开发数据库。我的脚本有几行，如：

```
CAST(RELATIVE_ERROR_RATIO AS FLOAT),
CAST(REPORTING_LIMIT AS FLOAT), 
```

该过程本质上是“从另一个表中插入表（所有字段），其中字段 = @input”

当我运行脚本时，我收到错误：

```
CAST or CONVERT: invalid attributes specified for type 'float' 
```

并且没有创建该过程。但是，我比较了开发和测试环境中的源表，它们完全匹配。并且该过程完全按照开发环境中的脚本存在。

我不能问我的同事是否必须做任何特殊的杂技来创作这个剧本，所以我问你。我进行了一些搜索，发现 float 应该是 FLOAT(6,1) （或类似的）形式，但这不是他所拥有的，而且我不愿意更改测试环境以使其获胜与开发人员不符。

**添加**

评论者是正确的。我被告知错误与以下演员有关：

```
CAST(TRACER_YIELD AS FLOAT(10,3)), 
```

我可以发布整个查询，但它很长！所以，相反，我将只包括强制转换的字段，以及第一个和最后一个字段。我想问一下我的同事，那一个领域是否有误，只需要直接转换即可。他下周一就会回来，所以可能需要等那么久。

```
CREATE PROCEDURE [dbo].[our_LOAD_INPUT]
    @ourNUMBER INT
AS

INSERT INTO our_FILE (our_NUMBER,
DILUTION_FACTOR,
DISTILLATION_VOLUME,
MAXIMUM_CONTROL_LIMIT,
MDA,
MINIMUM_CONTROL_LIMIT,
NUMBER_OF_TICS_FOUND,
PERCENT_MOISTURE,
PERCENT_RECOVERY,
PERCENT_SOLIDS,
RELATIVE_ERROR_RATIO,
REPORTING_LIMIT,
REQUIRED_DETECTION_LIMIT,
RER_MAX,
RESULT,
RETENTION_TIME,
RPD,
RPD_MAXIMUM,
SAMPLE_ALIQUOT_SIZE,
SPIKE_CONCENTRATION,
TOTAL_PROPAGATED_UNCERTAINTY,
TRACER_YIELD,
TWO_SIGMA_COUNTING_ERROR,
VERSION)
SELECT FILE_NUMBER,
CAST(DILUTION_FACTOR AS FLOAT),
CAST(DISTILLATION_VOLUME AS FLOAT),
CAST(MAXIMUM_CONTROL_LIMIT AS FLOAT),
CAST(MDA AS FLOAT),
CAST(MINIMUM_CONTROL_LIMIT AS FLOAT),
CAST(NUMBER_OF_TICS_FOUND AS FLOAT),
CAST(PERCENT_MOISTURE AS FLOAT),
CAST(PERCENT_RECOVERY AS FLOAT),
CAST(PERCENT_SOLIDS AS FLOAT),
CAST(RELATIVE_ERROR_RATIO AS FLOAT),
CAST(REPORTING_LIMIT AS FLOAT),
CAST(REQUIRED_DETECTION_LIMIT AS FLOAT),
CAST(RER_MAX AS FLOAT),
CAST(RESULT AS FLOAT),
CAST(RETENTION_TIME AS FLOAT),
CAST(RPD AS FLOAT),
CAST(RPD_MAXIMUM AS FLOAT),
CAST(SAMPLE_ALIQUOT_SIZE AS FLOAT),
CAST(SPIKE_CONCENTRATION AS FLOAT),
CAST(TOTAL_PROPAGATED_UNCERTAINTY AS FLOAT),
CAST(TRACER_YIELD AS FLOAT(10,3)),
CAST(TWO_SIGMA_COUNTING_ERROR AS FLOAT),
VERSION
FROM   our_FILE_CHAR 
WHERE  our_NUMBER = @ourNUMBER

GO 
```

our_File_CHAR 定义为

```
CREATE TABLE [dbo].[our_FILE_CHAR]
(
[our_NUMBER] [int] NOT NULL,
[DILUTION_FACTOR] [varchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[DISTILLATION_VOLUME] [varchar] (5) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[MAXIMUM_CONTROL_LIMIT] [varchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[MDA] [varchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[MINIMUM_CONTROL_LIMIT] [varchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[NUMBER_OF_TICS_FOUND] [varchar] (2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[PERCENT_MOISTURE] [varchar] (5) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[PERCENT_RECOVERY] [varchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[PERCENT_SOLIDS] [varchar] (5) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[RELATIVE_ERROR_RATIO] [varchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[REPORTING_LIMIT] [varchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[REQUIRED_DETECTION_LIMIT] [varchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[RER_MAX] [varchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[RESULT] [varchar] (13) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[RETENTION_TIME] [varchar] (6) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[RPD] [varchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[RPD_MAXIMUM] [varchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[SAMPLE_ALIQUOT_SIZE] [varchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[SPIKE_CONCENTRATION] [varchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[TOTAL_PROPAGATED_UNCERTAINTY] [varchar] (13) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[TRACER_YIELD] [varchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[TWO_SIGMA_COUNTING_ERROR] [varchar] (10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
[VERSION] [varchar] (2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
) 
```

our_File 定义为

```
CREATE TABLE [dbo].[our_FILE]
(
[our_NUMBER] [int] NOT NULL,
[DILUTION_FACTOR] [numeric] (10, 3) NULL,
[DISTILLATION_VOLUME] [numeric] (5, 1) NULL,
[MAXIMUM_CONTROL_LIMIT] [numeric] (10, 3) NULL,
[MDA] [numeric] (10, 3) NULL,
[MINIMUM_CONTROL_LIMIT] [numeric] (10, 3) NULL,
[NUMBER_OF_TICS_FOUND] [numeric] (2, 0) NULL,
[PERCENT_MOISTURE] [numeric] (5, 1) NULL,
[PERCENT_RECOVERY] [numeric] (10, 3) NULL,
[PERCENT_SOLIDS] [numeric] (5, 1) NULL,
[RELATIVE_ERROR_RATIO] [numeric] (10, 3) NULL,
[REPORTING_LIMIT] [numeric] (10, 2) NULL,
[REQUIRED_DETECTION_LIMIT] [numeric] (10, 2) NULL,
[RER_MAX] [numeric] (10, 3) NULL,
[RESULT] [numeric] (13, 3) NULL,
[RETENTION_TIME] [numeric] (6, 2) NULL,
[RPD] [numeric] (10, 3) NULL,
[RPD_MAXIMUM] [numeric] (10, 3) NULL,
[SAMPLE_ALIQUOT_SIZE] [numeric] (10, 3) NULL,
[SPIKE_CONCENTRATION] [numeric] (10, 3) NULL,
[TOTAL_PROPAGATED_UNCERTAINTY] [numeric] (13, 3) NULL,
[TRACER_YIELD] [numeric] (10, 3) NULL,
[TWO_SIGMA_COUNTING_ERROR] [numeric] (10, 3) NULL,
[VERSION] [varchar] (2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-24T20:28:58.717

我相信您正在寻找的是十进制（10,3）。浮点数具有特定定义的大小和精度。Decimal 允许您指定精度，并且您似乎希望使用小数，而不是浮点数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-24T20:25:20.610

（我不能接受自己的答案，但这是对我有用的解决方案。）

如果我将一个违规行从

```
CAST(TRACER_YIELD AS FLOAT(10,3)), 
```

到

```
CAST(TRACER_YIELD AS FLOAT), 
```

有用。

它会正常工作吗？

*更新：*这是原始程序员的错误。因此，不指定小数位（如上所示）的更改是他的意图，并且应该可以正常工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T21:34:40.487

嗯，为什么要转换，只要数据正确，varchar 到 numeric 就会进行隐式转换（我假设您正在检查清理过程以确保数据在尝试将其插入生产之前是数字的，即使转换也会如果有人将字符数据放在字段中，则失败）。

# .net - 适用于 Windows 98 的 .NET 2.0 应用程序安装程序

> ID：310246
> 
> 赞同：2
> 
> 时间：2008-11-21T21:26:14.873
> 
> 标签：.net, windows, visual-studio-2008, .net-2.0, setup-project

如何为 Windows 98 创建 .NET 2.0 应用程序的自动安装程序？

我的意思是应用程序以及 .NET 2.0（如果缺少）。

我试图通过为 Visual Studio 2008 创建一个安装项目来做到这一点，但我没有成功。我手动安装了 IE6 SP1，但安装程序仍然崩溃。已安装 Windows Installer 2.0。在那里安装 Installer 3.0 是不可能的。我在安装项目先决条件中取消选中安装程序，但仍然无法安装应用程序 - 错误消息说它需要更新版本的 Windows。

如何解决？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T06:24:36.957

如果您打算部署到 Windows 9x 或 ME，请不要*使用Visual Studio 2008。*VS2008 不再支持这些操作系统，如果你被他们困住了，你应该使用 VS2005 或更早的版本。另请参阅此问题：[Visual Studio 2008 是否支持 Windows 98？](https://stackoverflow.com/questions/213711)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T21:42:35.450

根据 MS [here](http://support.microsoft.com/kb/907749)的说法，Windows Installer 3.0+ 不适用于 Windows 98。

在 Windows 98 上手动运行 Installer 3.1 安装程序失败并显示消息

> NtOpenProcessToken 函数缺少入口点

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T05:19:18.583

根据这篇文章 Win98 is supported for 2.0

[http://msdn.microsoft.com/en-us/library/aa480241.aspx](http://msdn.microsoft.com/en-us/library/aa480241.aspx)为什么不直接从 Microsoft 获得可再发行组件？

[http://www.microsoft.com/downloads/details.aspx?FamilyID=0856EACB-4362-4B0D-8EDD-AAB15C5E04F5&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=0856EACB-4362-4B0D-8EDD-AAB15C5E04F5&displaylang=en)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T21:29:04.040

您需要先手动将机器更新到 windows installer 3.x。然后它应该去。

# c# - 如何在 C# 中键入右大括号后自动将光标定位在方法大括号之间？

> ID：310247
> 
> 赞同：4
> 
> 时间：2008-11-21T21:26:30.693
> 
> 标签：c#, visual-studio

每当我在 VS 2008 (C#) 中创建方法签名时，我都会输入两个大括号：

公共无效的东西（）{}

这会将光标留在右大括号的右侧。然后我必须使用箭头键将光标重新定位在大括号之间。有没有更好的方法可以在不使用箭头键的情况下做到这一点？

我希望它在我输入右括号时将光标放在大括号之间，这样我就可以开始输入代码了。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-22T00:18:32.543

我目前没有vs2008。假设 VS2008 仍然支持这一点，您可以使用代码片段。在下面弄乱，直到你得到你需要的。（见工具|代码片段管理器）

```
<?xml version="1.0" encoding="utf-8" ?>
<CodeSnippets  xmlns="http://schemas.microsoft.com/VisualStudio/2005/CodeSnippet">
    <CodeSnippet Format="1.0.0">
        <Header>
            <Title>b</Title>
            <Shortcut>b</Shortcut>
            <Description>Braces with cursor inside</Description>
            <Author>CrashCodes</Author>
        </Header>
        <Snippet>
            <Code Language="csharp"><![CDATA[{
                     $end$
            }]]>
            </Code>
        </Snippet>
    </CodeSnippet>
</CodeSnippets> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T21:29:35.787

我相信 Resharper 会这样做。不确定是否有免费选项。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-04-01T18:56:26.650

这是一个宏，用于在光标后插入大括号并将光标放在它们之间的行上

```
 Sub InsertCurlyBraces()
    DTE.ActiveDocument.Selection.NewLine()
    DTE.ActiveDocument.Selection.Text = "{"
    DTE.ActiveDocument.Selection.NewLine(2)
    DTE.ActiveDocument.Selection.Text = "}"
    DTE.ActiveDocument.Selection.LineUp()
End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T21:38:30.357

您可以录制一个插入 } 的宏，然后移动光标，然后将宏分配给 shift+] 键组合，以便您的右花括号始终执行您的宏。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T21:41:19.647

CodeRush 也这样做。

# iphone - 从 CGBitmapContextGetData 返回的 void* 是什么？

> ID：310255
> 
> 赞同：4
> 
> 时间：2008-11-21T21:27:39.193
> 
> 标签：iphone, cocoa-touch, core-graphics

我正在尝试从图像中获取像素信息，并且已经达到了我的`void*`数据对象的地步，该对象是指向图像数据的指针。

这个对象到底是什么？我试过迭代它，希望它是一个像素信息数组，但它似乎不起作用。

我想获取每个像素的 rgb 值。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T21:32:15.797

它是指向位图数据的指针。如果您在解释它时遇到问题，那么位图可能不是您认为的格式（CoreGraphics 在加载外部位图时会自动进行一些转换）。

使用 .检查位图格式信息`CGBitmapContextGetBitmapInfo()`。

# aspnet-compiler - aspnet_compiler ASPParse 无法加载类型

> ID：310269
> 
> 赞同：17
> 
> 时间：2008-11-21T21:34:45.807
> 
> 标签：aspnet-compiler

我无法在我们的构建环境中构建我的 Web 应用程序（不是网站）。我们在构建环境中使用 DMAKE（不幸的是，这是不可协商的，因此不允许使用 MSBUILD）以及通过调用 asp.net 预编译器时

C:\Windows\Microsoft.NET\Framework\v2.0.50727\aspnet_compiler -d -nologo -p 站点 -f -fixednames -errorstack -v / 调试

我们得到以下错误

错误 ASPPARSE：无法加载类型 'XYAdmin.Site.Global

如果我从 ide 编译它是成功的。如果我然后用 aspnet_compilier 编译它是成功的。因此，当我尝试编译的目标 dll 位于我正在编译的 Web 应用程序的 bin 中时，我只能使用 aspnet_compiler 成功编译。

我不断遇到有关使用 MSBUILD 的解决方案的帖子，不幸的是我无法尝试。

任何帮助，将不胜感激

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-12-17T11:53:48.363

我们的 Web 应用程序遇到了同样的问题： **错误 ASPPARSE: 无法加载类型“...”**

问题是我们在磁盘上有文件（在项目文件夹中），但它没有包含在我们的应用程序项目中（在 .csproj 文件中）。我们通过在项目中包含文件解决了这个问题:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-07-23T21:17:51.790

我在使用 NANT 时遇到了类似的问题。诀窍是将 Web 应用程序代码文件编译成 dll，然后在使用 aspnet_compiler 时将其包含在内。

使用命令行编译器，csc.exe (c#) 或 vbc.exe (visual basic)，使用类型库的输出编译您的 Web 应用程序。这将创建一个您可以在 aspnet_compiler 任务中使用的 dll

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-13T19:20:55.353

您是否尝试过使用 -p 指定路径？在我看来，它找不到那种类型/组件。

[http://msdn.microsoft.com/en-us/library/ms229863(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms229863(VS.80).aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-22T18:58:36.667

对于 Web 应用程序，您必须在运行 aspnet 编译器之前将 .vb 文件构建为 dll 并将其放入 bin 文件夹中。检查 Visual Studio 中的输出窗口，您将看到 VB 编译器的命令行。在运行 aspnet 编译器之前先运行它，asp 页面应该能够找到丢失的类型。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-05-31T14:59:37.940

`bin`通过简单地删除所有和文件夹为我解决了这个问题`obj`。似乎他们不知何故处于糟糕的状态。我也删除了`.sou`文件，但我认为这不是问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-10-22T08:21:36.850

solution :

-p Site path must have the directory path of .csproj file location.

ex :-

```
aspnet_compiler -p D:\Projects\MGM\mgm\mgm -v / D:\Projects\MGM-deploy\mgm_compiled 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-25T16:33:50.583

我刚刚遇到此错误并找到了两种修复方法：

*   将 global.asax 文件中的 Codebehind 属性更改为 CodeFile 并在类声明中添加“部分”
*   在部署项目的属性页中，设置“版本输出程序集”并提供版本号

我真的不知道为什么两者都有效，但确实有效。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-11-12T01:34:16.830

我收到了同样的问题。

我通过将我的 webapp 的 DLL 从 OBJ/DEBUG 文件夹复制到 BIN 文件夹来修复它。

# java - 将 bean 注入到 Spring 托管上下文之外的类中

> ID：310271
> 
> 赞同：63
> 
> 时间：2008-11-21T21:35:17.647
> 
> 标签：java, spring

我是我公司的一种产品的最终用户。它不太适合集成到 Spring 中，但是我能够处理上下文并按名称检索所需的 bean。但是，我仍然想知道是否可以将 bean 注入到这个类中，即使这个类不是由 Spring 本身管理的。

澄清：管理某些类 MyClass 的生命周期的同一应用程序也在管理 Spring 上下文的生命周期。Spring对MyClass的实例一无所知，我想知道如何将实例提供给上下文，但不能在上下文本身中创建实例。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-09-04T07:36:28.380

你可以这样做：

```
ApplicationContext ctx = ...
YourClass someBeanNotCreatedBySpring = ...
ctx.getAutowireCapableBeanFactory().autowireBeanProperties(
    someBeanNotCreatedBySpring,
    AutowireCapableBeanFactory.AUTOWIRE_AUTODETECT, true); 
```

您可以使用`@Autowired`等`YourClass`来指定要注入的字段等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-23T10:32:15.613

假设你有以下依赖链：

A --> B --> C --> x --> y --> Z

A、B、C 是 spring 管理的 bean（由 spring 框架构建和管理）x、y 是由您的应用程序构建的非常简单的 POJO，无需 spring 辅助

现在，如果您希望 y 使用 spring 获得对 Z 的引用，那么您需要对 spring ApplicationContext 有一个“句柄”

一种方法是实现[ApplicationContextAware](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/context/ApplicationContextAware.html)接口。在这种情况下，我建议 A、B 或 C 实现此接口并将 applicationContext 引用存储在静态成员中。

所以让我们以 C 类为例：

```
class C implmenets ApplicationContextAware{
    public static ApplicationContex ac;
     void setApplicationContext(ApplicationContext applicationContext)  {
               ac = applicationContext;
     }
 .............
} 
```

现在，在 y 类你应该有：

```
(Z)(C.ac.getBean("classZ")).doSomething() 
```

HTH——约纳坦

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-08-13T19:13:22.417

尽管制造是外部的，但将 bean 带入 Spring 的一种方法是使用一个标记为 bean 的辅助类，该类具有`@Configuration`一个方法（用`@Bean`那时的一代）。

我不太确定您需要什么范围；，`prototype`你会在每个地方得到一个新鲜的豆子。

```
@Configuration
public class FooBarMaker {
    @Bean(autowire = Autowire.BY_TYPE)
    @Scope("prototype")
    public FooBar makeAFooBar() {
        // You probably need to do some more work in here, I imagine
        return new FooBar();
    }
} 
```

您可以将制造所需的属性注入`@Configuration`bean。（我使用它来创建接口的实例，其中要实例化的类的名称是在运行时定义的。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-08-13T17:31:22.467

另一种方法是让我们使用 AspectJ。这是将 Spring bean 注入使用`new`操作符创建的非托管对象的推荐方法。有关详细信息，请参阅此：

[http://www.javacodegeeks.com/2011/02/domain-driven-design-spring-aspectj.html](http://www.javacodegeeks.com/2011/02/domain-driven-design-spring-aspectj.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-02-17T02:09:54.713

搜索无尽的 autowire injection spring bean into pojo applicationcontextaware beanaware 等组合让我回到了这里，但这并没有为我提供足够完整的解决方案。

这是这个 IMO 的一个更好的实现/教程：我希望它可以帮助每个喜欢它的人最终帮助我。

[从 Spring 上下文外部访问 Spring Bean](http://sujitpal.blogspot.com/2007/03/accessing-spring-beans-from-legacy-code.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-23T11:19:32.100

请注意，在最旧版本的 Spring 中，bean 工厂存在线程安全问题[http://jira.springframework.org/browse/SPR-4672](http://jira.springframework.org/browse/SPR-4672)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-03-07T00:45:21.093

如果您想在 Spring 上下文*之外*创建一个对象，并使该对象可用于注入 Spring 上下文中的其他 bean ，*您*可以按照[本文](http://java.dzone.com/articles/spring-make-externally-created)中的步骤进行操作。

基本上，您创建一个父应用程序上下文并将您的外部对象作为单例推送到该父上下文中。然后创建主应用程序上下文（例如，从 xml 文件），将父应用程序上下文作为其父项。

```
Object externalObject = ...
GenericApplicationContext parent = new StaticApplicationContext();
parent.getBeanFactory().registerSingleton( "externalObject", externalObject );
parent.refresh();
ApplicationContext appContext = new ClassPathXmlApplicationContext( ... , parent); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2022-02-20T05:20:44.000

从 Spring 配置类中，在需要 bean 的非 Spring 类上设置一个静态字段。

我在回答 Liquibase 问题时有一个示例：[https ://stackoverflow.com/a/71191546/5499391](https://stackoverflow.com/a/71191546/5499391)

# c++ - 如何处理任意大的整数

> ID：310276
> 
> 赞同：13
> 
> 时间：2008-11-21T21:36:45.320
> 
> 标签：c++, integer, overflow, long-integer, integer-overflow

我正在研究一种编程语言，今天我可以编译阶乘函数（递归），但是由于整数的最大大小，我可以获得的最大整数是阶乘（12）。有哪些技术可以处理任意最大大小的整数。该语言目前通过将代码翻译成 C++ 来工作。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-21T21:41:18.900

如果您需要大于 32 位，您可以考虑使用 64 位整数（long long），或者使用或编写任意精度的数学库，例如[GNU MP](http://gmplib.org/)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-21T23:03:11.137

如果您想推出自己的任意精度库，请参阅 Knuth 的半数字算法，他的巨著第 2 卷。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-21T22:46:14.180

如果你将它构建成一种语言（我猜是为了学习目的），我想我可能会写一个小的 BCD 库。只需将您的 BCD 数字存储在字节数组中。

事实上，凭​​借当今巨大的存储能力，您可能只使用一个字节数组，其中每个字节仅包含一个数字 (0-9)。然后，您编写自己的例程来加、减乘和除字节数组。

（除法是最难的，但我打赌你可以在某处找到一些代码。）

我可以给你一些类似 Java 的伪代码，但目前还不能真正从头开始做 C++：

```
class BigAssNumber {
    private byte[] value;

    // This constructor can handle numbers where overflows have occurred.
    public BigAssNumber(byte[] value) {
        this.value=normalize(value);
    }

    // Adds two numbers and returns the sum.  Originals not changed.
    public BigAssNumber add(BigAssNumber other) {
        // This needs to be a byte by byte copy in newly allocated space, not pointer copy!
        byte[] dest = value.length > other.length ? value : other.value;         

        // Just add each pair of numbers, like in a pencil and paper addition problem.
        for(int i=0; i<min(value.length, other.value.length); i++)
            dest[i]=value[i]+other.value[i];

        // constructor will fix overflows.
        return new BigAssNumber(dest);
    }

    // Fix things that might have overflowed  0,17,22 will turn into 1,9,2        
    private byte[] normalize(byte [] value) {
        if (most significant digit of value is not zero)
            extend the byte array by a few zero bytes in the front (MSB) position.

        // Simple cheap adjust.  Could lose inner loop easily if It mattered.
        for(int i=0;i<value.length;i++)
            while(value[i] > 9) {
                value[i] -=10;
                value[i+1] +=1;
            }
        }
    }
} 
```

我利用我们在一个字节中有很多额外空间的事实来帮助以通用方式处理加法溢出。也可以用于减法，并有助于一些乘法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T21:42:31.597

There's no easy way to do it in C++. You'll have to use an external library such as [GNU Multiprecision](http://gmplib.org/), or use a different language which natively supports arbitrarily large integers such as Python.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T23:46:04.653

如果我正在实现自己的语言并希望支持任意长度的数字，我将使用带有进位/借位概念的目标语言。但是由于没有 HLL 可以在没有严重性能影响（如异常）的情况下实现这一点，我肯定会在汇编中实现它。可能需要一条指令（如 x86 中的 JC 中）来检查溢出并处理它（如 x86 中的 ADC 中），这对于实现任意精度的语言来说是可接受的折衷方案。然后我将使用一些用汇编语言编写的函数而不是常规运算符，如果您可以利用重载来获得更优雅的输出，那就更好了。但我不希望生成的 C++ 作为目标语言可维护（或打算维护）。

或者，只需使用比您需要的更多花里胡哨的库，并将其用于您的所有数字。

作为一种混合方法，检测汇编中的溢出并在溢出时调用库函数，而不是滚动您自己的迷你库。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-21T21:53:35.253

Other posters have given links to libraries that will do this for you, but it seem like you're trying to build this into your language. My first thought is: are you sure you need to do that? Most languages would use an add-on library as others have suggested.

Assuming you're writing a compiler and you do need this feature, you could implement integer arithmetic functions for arbitrarily large values in assembly.

For example, a simple (but non-optimal) implementation would represent the numbers as Binary Coded Decimal. The arithmetic functions could use the same algorithms as you'd use if you were doing the math with pencil and paper.

Also, consider using a specialized data type for these large integers. That way "normal" integers can use the standard 32 bit arithmetic.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-21T22:11:21.413

My prefered approach would be to use my current int type for 32-bit ints(or maybe change it to internally to be a long long or some such, so long as it can continue to use the same algorithms), then when it overflows, have it change to storing as a bignum, whether of my own creation, or using an external library. However, I feel like I'd need to be checking for overflow on every single arithmetic operation, roughly 2x overhead on arithmetic ops. How could I solve that?

# concurrency - 向非技术人员解释比赛条件

> ID：310282
> 
> 赞同：21
> 
> 时间：2008-11-21T21:39:25.580
> 
> 标签：concurrency, communication

最近，我发现自己不得不写下我对正在开发的应用程序中的竞争条件的一些担忧（不是我自己写的）。这可能会引起非技术利益相关者的注意，并且与我没有直接的沟通渠道，因此我的解释需要以书面形式。

我已经尝试过写这篇文章。我尽我所能掩盖技术细节，举例说明竞争条件如何在应用程序中发生，并描述其影响。我觉得我做得很好，但远非完美。

问题是，尽管我试图让读者远离计算机科学，但我仍然发现很难在不失去正确性和实质的情况下消除“执行线程”和“互斥”等短语。风险在于，如果挥手过多，这些担忧可能会被认为是虚构的恶作剧。

无论如何，我对你的问题是： **你将如何*向*非技术观众解释比赛条件？** 你敢解释 CPU 调度吗？你会请[吃饭的哲学家](http://en.wikipedia.org/wiki/Dining_philosophers_problem)吗？

*你不必在我的情况下工作（但如果你这样做会非常有帮助）。*

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-21T21:56:17.340

X 公司在银行有 1,000 美元。X 支付了 2,000 美元的租金，并因向 Y 公司提供服务而收到了 10,000 美元的付款。但是，由于竞争条件，X 亏损 1,000 美元，现在正在申请破产。=(

您可能想解释银行如何以这种方式处理公司 X 的账户：银行员工 A 取当前价值 1,000 美元并在其中添加 10,000 美元。银行职员 B 取当前价值 1,000 美元并从中减去 2,000 美元。银行工作人员 A 将值更新为 11,000 美元。银行工作人员 B 将值更新为 -$1,000。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-21T22:12:55.857

我认为银行交易可能是一个很好的例子，因为很容易看出不正确的结果是*不好的*，而且因为在这样的环境中很容易创建竞争条件。

我的账户上有 500 美元。在我提取 50 美元的同时，有人将 200 美元转给我。

现在，如果银行没有正确处理竞争条件，他们将执行以下操作（当然，假设交易是手动处理的） 店员 A 将看到向我的余额添加 200 美元的请求，并注意我的余额目前是 500 美元. 职员 B 将看到从我的余额中减去 50 美元的请求，并注意到我的余额目前为 500 美元（职员 A 尚未转帐）。

职员 A 完成了文书工作并将我的帐户余额设置为 700 美元（500 + 他应该添加的 200）。然后，一分钟后（因为店员 B 只需要喝杯咖啡），店员 B 完成了另一笔交易并将我的余额设置为 450 美元（他检查时我的 500 减去他要减去的 50 ）。

我的余额现在是 450 美元，本来应该是 650 美元，因为比赛条件。结果取决于执行两个事务的不同部分的顺序。

这是对比赛条件如何糟糕的一般描述。现在说，我们让我们的应用程序同时处理两个单独的任务（那是你的“执行线程”）而不是文员，就像上面一样，他们都读取一个值，修改*他们*读取的值，然后写入回来了。如果按照上面显示的顺序发生这种情况，其中一项修改可能会丢失。这应该与您的应用程序中的特定问题相关联。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T21:51:44.837

我会采用餐饮哲学家式的方法，但根据我的观众，我会尝试将其类比为我的观众的背景。您是在与企业高管交谈吗？然后将其类比为分配会议室或公司用车或预订酒店房间等。你是在和普通人说话吗？那么餐饮哲学家的例子很好，或者你可以想出一个类似的情况，包括照顾农场动物或坐在椅子上等等。

无论你是劫持餐饮哲学家的例子，还是自己编造，一定要用比喻。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-21T21:57:59.740

如果您正在写信给非技术人员，您将希望简化您的解释并将其与他们可以理解的内容联系起来。一种解释取自《向没有经验的程序员教授并行计算的类比》一文 ( [http://portal.acm.org/citation.cfm?doid=1189136.1189172](http://portal.acm.org/citation.cfm?doid=1189136.1189172) ) 用笔游戏来解释它：

> 我们要玩一个叫做笔游戏的游戏。规则很简单：我手里拿着一支笔，然后我会说“一，二，三，走。” 当我说“去”时，把笔从我手里拿走。谁拿到笔就赢了。准备好？一，二，三，走。

然后你问这个游戏的结果是否可以提前预测。如果无法预测，我们能保证正确的结果吗？这应该导致意识到同时写入同一块内存可能会得到不正确的结果。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-21T22:05:44.107

我本来打算推荐餐饮哲学家，但我看你已经找到了。那么，作为替代方案，如何使用僵局作为类比呢？

想象一下沿着单个城市街区（北大街、南大街、东大街和西大街）旁边的四条街道行驶的正常交通。当路上只有一两辆车时，一切都顺利进行。当交通稳定时，一些汽车将不得不停下来等待其他汽车驶过，但这是一个可以控制的问题。一辆车停下来等另一辆车经过，然后继续行驶。

现在，想象一下同一地点的高峰时段交通情况。假设一辆在西街向南行驶的汽车无法一路穿过我们街区西北角的十字路口。那辆车现在挡住了北大街上所有的西行交叉交通。没过多久，一辆西行车试图通过东北角的十字路口并被卡住，阻塞了东街的所有北行交通。这种情况，绕到四个路口，车子都不能动！每个人都在等待前面的汽车向前行驶，但如果不将汽车向后拉出，就无法解除僵局。

与计算的比较应该是直截了当的。汽车是线程或进程，街道和大道是处理器、缓冲区或内核。阻塞的概念可以用交通信号灯或停车标志来描述，整个事情开始变得直观起来，即使对非程序员来说也是如此。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-21T22:51:25.187

编写一个程序：

1.  等发工资。
2.  去商店。
3.  买食物。
4.  打开盘子。
5.  把食物放在盘子里。
6.  保持盘子20分钟。
7.  吃。
8.  睡觉。

现在尝试让两个线程（你，妻子）在不同步的情况下执行它。

*   你：等工资吧。
*   老婆：没钱去店里，撞车

*   你：开盘。

*   你：保持盘子20分钟。
*   你去睡觉。

*   妻子：在别人家吃饭。

*   妻子：去睡觉吧。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-21T21:56:36.560

显而易见的呢？

比赛条件实际上是两个人之间的比赛。

一家公司正在投标一个项目。两名独立工作的员工将投标提交给客户，但其中一名员工的信息已过时。两名员工都不知道对方正在提交投标，因此根据谁的速度更快，第一个投标可能会被速度较慢的员工取代。这将导致混淆，因为出价可能会随着时间而改变。

两名员工之间需要进行沟通，以共同工作或阻止其中一名员工。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-21T23:00:39.050

彼得想离开他的车道。他检查了他的车上没有任何东西，然后上车。他的儿子弗兰克然后躲在车后面。彼得看不见他，把他撞了过去。

这里重要的是，对于一台计算机，“检查”和“修改”往往是两个独立的操作，所以一个当你修改它时不能检查的例子是一个很好的例子。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-22T00:07:09.387

解释一般概念的一个困难是竞争条件在各种各样的情况下表现出来。如果您的目标是让您的非技术受众感觉到这是一种通用问题类型，那么您应该尝试提供多个示例。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-22T01:27:06.213

一张图片值一千字。这是真的。如果您绘制时间线并在其上放置一些实体，并显示其状态随着时间的推移而变化，您可以在一张图中很容易地演示竞争条件。可能需要重做几次才能使图片恰到好处，但我总是发现画出来比描述它更能传达我的观点。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-21T22:27:08.697

[操作系统应用程序](https://rads.stackoverflow.com/amzn/click/com/0201029375)的结构化并发编程中有一个很好的例子（我记得）

在贫穷的贝泽克斯坦，两条线路在一条隧道中汇合到一条轨道上。发生了冲突，执政的军政府需要一个解决方案。

问题是它多山，工程师是盲目的。几乎没有两列火车即将在隧道内相撞的预警。

这是计划。

1.  把一个大碗放在接合处。

2.  给每个工程师一只黄铜小猴子。

当你即将进入隧道时，你停下了你的火车。你在碗里拍拍，看看碗里是否有一只黄铜猴子。

如果有猴子，其他人正在使用隧道，所以你必须等到他们的火车完全在隧道中，然后列车员从车尾出来，从碗里抓住猴子。

如果没有猴子，就没有其他人在使用隧道。因此，您可以从发动机舱中抓起您的猴子，将其放入碗中，然后开车穿过隧道，因为您已经获得了对赛道的独家访问权。当然，你短暂停留让售票员取回黄铜猴子。

你猜怎么了？

他们**仍然**有碰撞！

为什么？导致此失败的情况或操作顺序是什么？

* * *

这是一个竞赛条件。

在书面文件中，您可以解释比赛条件如何导致事故。

在演示文稿中，您可以通过推理并发和锁定来指导听众。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-21T22:33:02.133

我认为很难用简单的方式来解释这一点，因为考虑并发性本来就很难。金融交易的基本概念可能是一个很好的起点，因为人们会从现实生活中对它们有所了解。

在任何类型的交易中，您都需要在两个地方同时输入 - 借方和贷方。如果交易在中间被其他人试图执行另一笔交易而中断，他们将在一个或另一个账户中看到错误的余额。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-21T23:31:39.363

我将使用数据竞争条件的共享内存银行帐户示例。

解释计算机执行以下操作：负载平衡；加1；存储余额；。考虑两个正在修改您的银行帐户余额的线程（您和您的妻子同时存入一美元）。

如果两个线程在以下之后中断：负载平衡；然后恢复，你可以损失一美元。

见：[http ://wasp.cs.washington.edu/atomeclipse/handouts.pdf](http://wasp.cs.washington.edu/atomeclipse/handouts.pdf)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-22T00:08:50.270

正如您所提到的，您经常需要引入其他概念（互斥、执行线程）来准确描述竞争条件，即使是在隐喻中也是如此。因此，首先尝试使用隐喻来定义这些术语（或至少让想法得到理解）。

举个简单的例子，让我们使用一个 4 路交叉口（设置在您在右侧行驶的国家/地区）。将交叉口分为 4 个象限：西北、东北、东南和西南。现在将每个象限称为资源，并将每辆车称为执行线程。这些汽车只尊重交通系统，由于这个十字路口没有停车标志或交通信号灯，汽车直接通过而不会减速或考虑交通。

你可以很容易地证明，不止一辆汽车同时使用这些象限之一是不好的，并导致车祸。一个明显的解决方案是安装交通系统。该系统确保不超过一辆车同时通过一个象限。它可以错综复杂地做到这一点，而不会占用所有资源。例如，让来自南方的汽车左转向西（使用东南和西北象限），而让来自西方的汽车右转向南（使用西南象限） . 交通系统提供互斥，或防止（多辆汽车）同时使用公共资源（交叉路口的道路象限）。

这至少提供了这些定义背后的想法，即同时访问共享资源*可能*是不好的想法，而互斥可以解决这个问题。确定后，您需要将这些映射到更合适的隐喻，以显示竞争条件是什么以及它是如何因缺乏对公共资源的互斥而导致的坏事之一。

这需要更长的时间，但在深入研究更复杂的隐喻之前，它可以让您熟悉术语和大局。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-04-15T13:16:16.020

与您的利益相关者谈论金钱可能会使他们陷入恐慌状态，特别是如果他们认为他们因此而损失了实际金钱，如果问题没有特别导致利润净损失，这并不完全理想，所以这里有一个不太注重财务的关于如何向任何人解释比赛条件的故事。

这个故事**没有解决死锁的概念**，而是更传统的竞争条件场景和后果。

**故事从这里开始：**

**那个设定：**有3个城市通过铁路网相连。火车上没有任何标志表明他们来自哪个城市以及他们要去哪个城市，因为它们在所有 3 个城市之间使用，而且铁路网络不想处理所有更换标志的麻烦时间。由于网络很小，没有关于火车何时到达和离开的具体时间表。站长只是在火车开出时接到其他城市站长的电话，站长会记下它离开的时间，并且由于所有火车都是相同的型号，因此它们以相同的速度行驶，因此当站长收到来自其他城市的电话，他们向车站里的人宣布：“下一班火车将开往 C 市”。所以想去C市的人等着火车，

**问题：**但有一天，一列火车正在规划从A到B到C的路线，它在A和B之间的中途抛锚了。幸好技术人员非常熟练，很快就能把火车修好。然而就在同一天，另一列火车也在计划从C到B再到A的不同路线。B站的监督接到A的电话，说有火车来了，不久又接到C的电话，说另一列火车也来了。站长随即对在车站等候的乘客宣布：“第一班到站的列车将开往C站，之后的列车将开往A站。” 随着乘客们收拾行李，前往各自的站台。监工看到一列火车来了，把铁轨改到人们计划前往C市的站台上。他们几乎不知道火车实际上是开往A市的。修好机械故障的另一列火车也到了车站，监工兴高采烈地把它引到站台上，站台上有想去A市的乘客。不用说，没有一个乘客到达他们计划去的地方，这一切都是因为监督认为他们会像往常一样按顺序到达。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-03-09T17:33:39.137

竞争条件和许多计算机科学结构的问题在于人不是计算机。每次我向我的学生解释一种算法时，他们都会说“但那样做没有意义”，我回答说“计算机没有常识，它们只有指令”。除此之外，您应该将比赛条件解释为比赛，如果可以的话，让人们实际尝试比赛是最有意义的。这样他们就可以看到事情是如何出错的。但是……他们不被允许使用常识。

所以让我们假设我们有一个游戏，其中 2 个人按照红色、橙色、黄色的顺序填充一堆彩色块。它们有许多红色、橙色和黄色块。所有的堆栈都需要正好是三个方块高。

在第一场比赛中，双方都试图尽可能快地做到这一点，但他们只在自己的堆栈上工作。

在第二场比赛中，他们尝试通过允许自己也将积木堆叠在彼此的堆叠上来一起工作。但是他们不允许改变他们手中的块，他们必须放置一个计划好的块。

你可以想象这样的情况发生在堆栈 1 中：

```
player 1 grabs a red block
player 1 places red block         - player 2 grabs an orange block
player 1 grabs an orange block    - player 2 places an orange block
player 1 places an orange block 
```

所以现在我们有一个带有两个橙色块的堆栈。很明显，在人类游戏中，这永远不会发生，因为人们有常识：他们看到橙色块已经放置，并恢复他们也放置橙色块的决定。

你也可以给他们看这个视频：[https ://www.youtube.com/watch?v=TcGwNdbsAbc](https://www.youtube.com/watch?v=TcGwNdbsAbc)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-05-03T22:51:44.563

让我们使用白板来完成一项琐碎的会计任务。我们手头有 100 美元——把它写在白板上。

爱丽丝有几十张发票，加起来是 100 美元，所以她要记下 100 美元，去把她的清单加起来，然后在 5 分钟后回来，在黑板上写下 200 美元。

鲍勃一直在购物。他会从白板上取出那个数字，然后减去价值 50 美元的购买，然后他会在白板上写下 50 美元。

如果 Bob 先回来，我们将在 Alice 写出结果后看到 200 美元。如果爱丽丝先回来，我们将看到 50 美元，也是错误的。我们*希望*看到的是 150 美元，我们需要在某处添加一些预防措施以实现这一目标。

这应该足以用合理的直觉来讨论技术解决方案。

例如，互斥锁意味着你锁住房间的门，里面有白板，让他们在那里做他们的工作。一个乐观的解决方案意味着你让他们都检查并重新开始，如果他们离开时数字发生了变化。如果你想谈论死锁，你可以嘲笑 Bob 从锁着的房间里打电话给 Alice 让她快点。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2008-11-22T00:30:11.117

将它们发送到Wikipedia 上的[Race Condition](http://en.wikipedia.org/wiki/Race_condition)。

第一部分会有些意义，其余部分（下面未显示）会让你看起来很聪明，因为他们会假设你理解它。

“竞态条件或竞态危害是系统或过程中的缺陷，其中过程的输出和/或结果出乎意料地严重依赖于其他事件的顺序或时间。该术语起源于两个信号各自竞争的概念其他先影响输出。”

我认为要理解的关键点是，它最常见的时间问题可能是不可预测的，因为时间有时会有所不同。

# .net - 如何使用 Castle ActiveRecord / NHibernate 防止将对象更改写入 Flush 上的数据库

> ID：310286
> 
> 赞同：2
> 
> 时间：2008-11-21T21:40:25.203
> 
> 标签：.net, nhibernate, castle-activerecord

NHibernate 的默认行为是在调用 Session.Flush() 时将对对象的所有更改写入数据库。无论您是否愿意，它都会这样做。

当我们需要做诸如验证业务规则或输入之类的事情时，我们如何防止将不良数据写入数据库？

例如 ..

*   客户名称不为空。
*   用户打开 Web 浏览器（没有 javascript）并删除客户名称。
*   点击更新。
*   `Customer.Name`属性已更新，并且..
*   `Customer.IsValid()`叫做。
*   即使`IsValid()`是 false 并且我们显示错误消息 NHibernate 仍然会更新数据库。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T00:50:12.777

使用 ISession.Evict(objectToEvict) 方法驱逐无效对象。

请参阅：[http](http://www.tobinharris.com/2007/2/3/nhibernate-faq) ://www.tobinharris.com/2007/2/3/nhibernate-faq 和 [http://www.surcombe.com/nhibernate-1.2/api/html/M_NHibernate_ISession_Evict.htm](http://www.surcombe.com/nhibernate-1.2/api/html/M_NHibernate_ISession_Evict.htm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-24T01:40:46.277

专门针对 ActiveRecord：如果您不自己更改 SessionScope，则 AR 默认为 session-per-call 的会话管理模式，其中为 ActiveRecordMediator 的每个操作创建一个新会话。因此，一旦您检索到它们，您检索的所有对象都已与其父会话断开连接。除非您调用 Save（或 SaveAndUpdate，甚至是 Update），否则更改将不会持续存在然后处理会话（导致刷新并因此写入更改）。

当您以这种方式使用 AR 时，它会完全按照您的意愿行事（即，除非您明确调用 Save，否则不会写回任何更改）。但这明显违背了预期的 NHibernate 行为，您不能进行延迟加载或充分利用缓存。我已经在一些 Web 应用程序中使用了这种模式，但是它们是为预先加载而设计的，并且相当多的持久对象实际上是不可变的和静态的，并且可以在启动时整体加载并缓存而无需连接到任何会议。如果您的应用程序不适合此模型，那么每次通话会话可能不是一个好主意。

由于您似乎使用的是 UOW 模式，因此您无法利用此行为。因此，您必须要么从 NHibernate 会话中逐出对象（并且访问真实的 ISession 实例实际上并不像在 AR 中看起来那么容易），要么更改应用程序的工作方式，以便不会实际修改持久对象的属性直到您的业务规则得到验证。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T05:15:21.323

> NHibernate 的默认行为是在调用 Session.Flush() 时将对对象的所有更改写入数据库。无论您是否愿意，它都会这样做。

如果您不希望 NHibernate 刷新会话，那么为什么要告诉它刷新会话？`Flush()`是 的简写`WriteAllChangesToObjectsToTheDatabase()`。

> 当我们需要做诸如验证业务规则或输入之类的事情时，我们如何防止将不良数据写入数据库？

*   在修改模型对象*之前*验证更改。不允许无效的模型对象存在于内存中（从模型公开的公共 API 的角度来看，不包括多线程场景）。
*   将您的更改包装在事务中，如果您的模型对象验证失败，该事务将失败（为什么首先允许无效的模型对象？）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-24T05:15:54.130

所以，我知道这完全是矫枉过正，但这是我修复它的方法。

转换为 NHibernate 2.0 并使用 NHibernate Validator 项目来运行我的输入验证规则。我还没有处理业务规则，但我认为我可以使用自定义验证器规则来完成它们，如果这不起作用，我可以使用 nhibernate 事件。

由于我已经在使用存储库模式，因此转换非常简单。只花了大约 4-5 个小时，我们的模型非常广泛。能够从 AR 属性生成 .xml 文件可以节省大量时间。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-22T05:02:03.847

您还可以将 Session 与 FlushAction.Never 一起使用。IE：

```
SessionScope session = new SessionScope(FlushAction.Never); 
```

这会将默认行为从自动保存所有内容切换为您明确需要在实体上调用 .Save() 。所以你可以做任何你需要做的验证，然后才保存你想要的……

# c# - Why does Regex.Match return only 1 result?

> ID：310294
> 
> 赞同：3
> 
> 时间：2008-11-21T21:41:51.283
> 
> 标签：c#, html, regex

I'm using a regex that [strips the href tags out of an html doc](http://regexlib.com/REDetails.aspx?regexp_id=646) saved to a string. The following code is how I'm using it in my C# console app.

```
Match m = Regex.Match(htmlSourceString, "href=[\\\"\\\'](http:\\/\\/|\\.\\/|\\/)?\\w+(\\.\\w+)*(\\/\\w+(\\.\\w+)?)*(\\/|\\?\\w*=\\w*(&\\w*=\\w*)*)?[\\\"\\\']");

        if (m.Success)
        {
            Console.WriteLine("values = " + m);
        } 
```

However, it only returns one result, instead of a list of all the href tags on the html page. I know it works, because when I trying `RegexOptions.RightToLeft`, it returns the last href tag in the string.

Is there something with my if statement that doesn't allow me to return all the results?

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-21T21:47:06.627

**Match** method searches for the first occurence of the string, **Matches** method searches for all occurences.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-24T13:09:56.900

If you use Match instead of Match**es** you need to use a loop to get all the matches calling m.NextMatch() at the end of each loop. For example:

```
 Match m = Regex.Match(htmlSourceString, "href=[\\\"\\\'](http:\\/\\/|\\.\\/|\\/)?\\w+(\\.\\w+)*(\\/\\w+(\\.\\w+)?)*(\\/|\\?\\w*=\\w*(&\\w*=\\w*)*)?[\\\"\\\']");
    Console.Write("values = ");
    while (m.Success) 
    { 
        Console.Write(m.Value);
        Console.Write(", "); // Delimiter
        m = m.NextMatch();
    }
    Console.WriteLine(); 
```

# asp.net - 如何通过将文件复制到其中来停止 IIS 网站

> ID：310301
> 
> 赞同：3
> 
> 时间：2008-11-21T21:42:29.990
> 
> 标签：asp.net, iis, app-offline.htm

我记得可以在 IIS 中停止网站，只需在站点目录中创建一个具有特殊名称的文件。但是我不记得名字了，在谷歌上也找不到。你能帮助我吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-21T21:47:08.293

App_Offline.htm，至少适用于 Asp.Net 应用程序。

[http://weblogs.asp.net/scottgu/archive/2005/10/06/426755.aspx](http://weblogs.asp.net/scottgu/archive/2005/10/06/426755.aspx)

[文森特 P](https://stackoverflow.com/users/598476/vincent-p)总结：

> 当您将名为 app_offline.htm 的文件放在站点的根目录中时，IIS 会停止该站点。然后，当您删除文件时，IIS 会启动并在收到第一个请求时开始运行。

# unit-testing - 模拟与测试数据库？

> ID：310307
> 
> 赞同：31
> 
> 时间：2008-11-21T21:42:48.850
> 
> 标签：unit-testing, mocking, data-access-layer

早些时候我问过这个问题[如何正确地对我的 DAL 进行单元测试？](https://stackoverflow.com/questions/309708/how-to-correctly-unit-test-my-dal)，我没有回答的一件事是，如果要真正测试我的 DAL 是拥有一个测试数据库，那么模拟与测试数据库的作用是什么？

为了补充这一点，另一个人建议“在单元测试结束时使用事务和回滚，所以数据库是干净的”，即测试数据库。你们如何看待这种测试 DAL 的测试 + 测试 DB + 事务回滚（所以 db 不是真正编写的）方法？

完整地说，我的 DAL 是使用实体框架构建的，数据库中没有存储过程。由于 EF 太新了，我真的需要测试 DAL 以确保它们正常工作。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-21T21:50:51.937

我认为您可能需要进行一些集成测试来检查由数据库结构强制执行的逻辑，例如约束、触发器、自动增量列等。但是，对于单元测试，您应该模拟 DAL 的任何框架组件根据需要（在您的单元测试中）依赖于仅测试您已编码的那些组件。您实际上并不需要在 SqlCommand 或 SqlConnection 上测试方法（例如）。您应该假设您使用的框架组件工作并为它们创建存根或模拟，它们将已知数据（好的、坏的、异常）返回给您的方法，以确保您的方法正常工作。在没有模拟的情况下，您有责任在数据库中生成数据并确保它是正确的。您还保留了对网络、数据库本身的开放依赖，

此外，单元测试并不能消除对其他类型测试的需求。集成测试和验收测试仍然有效，需要进行。它们可能不需要以与单元测试相同的频率完成，并且可能不需要像单元测试提高代码质量那样广泛，但单元测试并不是灵丹妙药。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-21T21:54:17.157

在测试数据访问代码时，我发现模拟并不是很有用。单元测试的目的是验证与数据库相关的代码是否正常工作，模拟数据库会阻碍测试。

在测试业务代码时，模拟确实变得有用。您可以模拟您的数据库调用以返回测试数据并在这些情况下验证业务逻辑的行为。

关于事务的使用——这当然是可能的，只要您的架构有空间在测试开始时启动事务，然后在该事务中执行单元测试的所有与数据库相关的调用。不过，从未尝试过。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-06T22:06:18.620

将单元测试放入回滚的事务中听起来很老套。取而代之的是，我有代码在测试运行之前（即在我的测试类的构造函数中）清除任何 crud 的数据库（即任何非静态/参考数据）。当您的测试失败时，将数据保留在数据库中以检查失败的原因是有帮助的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-22T00:14:22.583

我们已经使用了事务性单元测试，并且多次阻止了 Hibernate 映射问题。否则 - 什么是单元测试？微不足道的东西`List<Item> getAllItems()`？:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T21:44:26.273

通过使用测试数据库，您打开了在数据库本身或沿 DAL 和数据库之间的通信路径（网络等）引起问题的可能性。模拟消除了这些可能性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-06T22:09:51.763

您必须考虑的不仅是数据库的状态，还有可用性。如果您的数据库处于脱机状态，为什么您的所有 DAL 测试都会失败？

您需要测试的是您的 DAL 发出正确的命令以便创建/检索/更新/删除。您不需要为此执行 SQL，您只需使用对象持久性框架并检查您是否给出了正确的指令。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-09-20T16:48:38.013

不过，您不只是测试您的应用程序。您还在测试您的配置以及您的存储过程和视图。这些都记录在您的单元测试中。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2012-09-06T15:03:49.477

问题很可能出在原始问题中。一些更流行的 MVC 示例通过返回 a 来使用快捷方式，`DbSet`例如：

```
public class MusicStoreEntities : DbContext
    {
        public DbSet<Album> Albums { get; set; }
        public DbSet<Genre> Genres { get; set; }
        public DbSet<Artist> Artists { get; set; }
        public DbSet<Cart> Carts { get; set; }
        public DbSet<Order> Orders { get; set; }
        public DbSet<OrderDetail> OrderDetails { get; set; }
    } 
```

对我来说，这与持久性的实现紧密结合，我认为这是一件坏事。最好返回`List<t>`容易被嘲笑的东西。

# dreamweaver - Building Nav Bars with rollovers in DreamWeaver CS3

> ID：310321
> 
> 赞同：2
> 
> 时间：2008-11-21T21:48:08.137
> 
> 标签：dreamweaver, rollovers

I'm working with Dreamweaver CS3\. The question here is what part of the code (listed below) do I need to replicate to have my secondary nav bar utilize the on-click action?

FYI...DW has two menu options or auto insert items...one for roll over images and one for "navbar". DW will only allow you to use the 'navbar' item once per page

*   the nav bar option builds all the rollover actions for you (listed below)

*   the "rollover" option ONLY builds normal and over, but no click

I guess I really have two questions...the first is what part of the code do I need to insert manually, the second is what does the "MM_nbGroup" code mean?

```
"../photogallery.html" target="_top" onClick="MM_nbGroup('down','group1','photoMainNav','../images/buttons/photography_down.gif',1)" 
onMouseOver="MM_nbGroup('over','photoMainNav','../images/buttons/photography_over.gif','../images/buttons/photography_over.gif',1)" onMouseOut="MM_nbGroup('out')"><img src="../images/buttons/photography.gif" 
```

Thanks for any help on this in advance!

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-26T08:48:25.930

对于任何想知道同样事情的人，这就是我到目前为止发现的......

DWCS3 中提供的“插入”栏不允许在一页上有两个“插入”菜单栏。但是，“行为”面板将允许您使用“设置导航栏图像”选项添加有效的翻转。不幸的是（据我所知）DWCS3 不如 Adob​​e 的 GoLive 智能，因为如果您正确命名文件，它不会自动填写适当的项目。即使如此，您也应该相应地命名您的图像（xxx_over、xxx_down 等），以使其保持在您自己的脑海中。

至于 MM_nbGroup 问题，我可以说这是 DWCS3 附带的 WYSIWYG 代码（这种东西真的让你们中的一些开发人员感到困惑，对不起，伙计们），因为它按组命名项目 # 并且似乎没有任何html 词典中的真正相关性。但是，我可能会误会，如果有人可以提供，我愿意就该主题提供启发。

# c++ - tr1::mem_fn 和 tr1::bind：关于 const 正确性和重载

> ID：310333
> 
> 赞同：5
> 
> 时间：2008-11-21T21:52:48.313
> 
> 标签：c++, c++11, functional-programming, tr1

以下代码段有什么问题？

```
#include <tr1/functional>
#include <functional>
#include <iostream>

using namespace std::tr1::placeholders;

struct abc
{
    typedef void result_type;

    void hello(int)
    { std::cout << __PRETTY_FUNCTION__ << std::endl; }

    void hello(int) const
    { std::cout << __PRETTY_FUNCTION__ << std::endl; }

    abc()
    {}
};

int
main(int argc, char *argv[])
{
    const abc x;
    int a = 1;

    std::tr1::bind(&abc::hello, x , _1)(a);
    return 0;
} 
```

尝试用 g++-4.3 编译它，似乎*cv* -qualifier 重载函数混淆了两者`tr1::mem_fn<>`，`tr1::bind<>`并出现以下错误：

```
no matching function for call to ‘bind(<unresolved overloaded function type>,... 
```

相反，以下代码段编译但似乎破坏了**const-correctness**：

```
struct abc
{
    typedef void result_type;

    void operator()(int)
    { std::cout << __PRETTY_FUNCTION__ << std::endl; }

    void operator()(int) const
    { std::cout << __PRETTY_FUNCTION__ << std::endl; }

    abc()
    {}
};

...

    const abc x;
    int a = 1;
    std::tr1::bind( x , _1)(a); 
```

有什么线索吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T22:03:50.523

`this`查找是在不知道constness 的时候完成的。你只需要通过铸造给它一个提示。试试这个：

```
typedef void (abc::*fptr)(int) const; // or remove const
std::tr1::bind((fptr)&abc::hello, x , _1)(a); 
```

您可能还注意到这里删除`const`仍然有效。这是因为您应该通过指针传递 x（因为 C++ 成员函数的第一个参数隐式`this`参数始终是指针）。试试这个：

```
typedef void (abc::*fptr)(int) const; // won't compile without const (good!)
std::tr1::bind((fptr)&abc::hello, &x , _1)(a); 
```

正如我在下面的评论中发现的那样，如果您`&`像原来一样省略了，您将*通过 value*传递 x ，这通常不是您想要的（尽管在您的特定示例中几乎没有实际差异）。这实际上似乎是一个不幸的陷阱`bind`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T10:07:03.323

正如约翰建议的那样，这些片段中出现的问题如下：

1.  传递*成员函数指针*时，必须指定其签名（如果重载）
2.  `bind()`按值传递参数。

第一个问题是通过将提供的成员函数指针转换为绑定来解决的：

```
 std::tr1::bind(static_cast< void(abc::*)(int) const >(&abc::hello), x, _1)(a); 
```

第二个可以通过按地址传递可调用对象（如约翰建议）或通过 TR1 来解决`reference_wrapper<>`- 否则它将按值传递，从而使*const-correctness 打破幻觉*。

给定 xa 可调用对象：

```
std::tr1::bind( std::tr1::ref(x) , _1)(a); 
```

`bind()`将根据 x **constness**转发`a`到适当的位置。`operator()`

 *** * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T07:32:36.317

这个问题已经回答了，但我发现用 bind 指定重载的最好方法是在模板上指定它：

```
std::tr1::bind<void(foo::*)(int)>(&foo::bar); 
```

这种方法同样明确，但比强制转换短（`static_cast`无论如何。但它比 C-cast 更干净，它的长度相同。

# database - Parrot 有数据库接口或 API 吗？

> ID：310342
> 
> 赞同：0
> 
> 时间：2008-11-21T21:55:07.547
> 
> 标签：database, dbi, parrot

通过快速搜索，我得到了2004 年 1 月[的 Parrot DBDI 公告](http://www.mail-archive.com/dbdi-dev@perl.org/msg00002.html)和一个似乎早已死去的[dbdi-dev 邮件列表。](http://www.mail-archive.com/dbdi-dev@perl.org/)Parrot DBDI 还在开发中吗？有人在为 Parrot 开发不同的数据库 API 或接口吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T22:53:03.387

来自[DBI::Roadmap 1.607](http://search.cpan.org/~timb/DBI-1.607/Roadmap.pod)手册，日期为 2004 年 11 月：

> 大部分工作将把 DBI C 和 Perl 基类代码翻译成 Parrot PIR，或生成 PIR 的合适语言。由于 Parrot 当时没有关键功能，该项目停滞不前。问题已解决，但项目尚未重新启动。

达伦·邓肯在 2005 年 5 月发表的这篇[文章](http://www.nntp.perl.org/group/perl.dbdi.dev/2005/05/msg44.html)：

> 我相信它现在很快就会重新开始。看，一些主要缺失的先决条件现在都上线了，所以有了这些，我们就可以开始工作了。

我找不到比这更近的东西了。Parrot 本身的进展有点缓慢，所以也许为了与 Parrot 平台保持兼容，DBDI 也是如此。:-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-10T14:13:59.993

DBDI 致力于创建一个数据库驱动程序接口，就像当前的 DBI 和 DBD 模块一样。它死了，所以开发人员现在改用现有的接口——Java JDBI。两个这样的开发者是 Tim Bunce（他曾参与 DBI 1，但没有太多时间参与其续集）和 Simon Cozens：

[http://perlbuzz.com/2008/12/database-access-in-perl-6-is-coming-along-nicely.html](http://perlbuzz.com/2008/12/database-access-in-perl-6-is-coming-along-nicely.html)

```
use DBDI;
my $conn = DBDI::DriverManager.getConnection(
    "dbdi:SQLite3:test.db", "", "");
my $stm = $conn.createStatement();
my $rs = $stm.executeUpdate("CREATE TABLE foo (bar, baz)");
my $stm = $conn.prepareStatement(
    "    INSERT INTO foo (bar, baz) VALUES (?, ?)");
$stm.setColumn(1, 123);
$stm.setColumn(2, "Thingy");
$stm.executeUpdate(); 
```

这个模块应该适用于所有 Parrot 语言，而不仅仅是 Perl 6。

* * *

实际上，对于 Perl 6，我们可能会看到一个 SQL 引用运算符，因此您可以执行以下操作：

```
$conn.prepareStatement( Q:sql<INSERT INTO foo (bar, baz) VALUES($bar, $baz)> ); 
```

当然，在 Perl 6 中，像 Q:sql 这样的引号修饰符可以缩写，例如 qs<> 或 sql<>

# java - 如何从 Java 访问 Windows 事件查看器日志数据

> ID：310355
> 
> 赞同：14
> 
> 时间：2008-11-21T22:01:36.113
> 
> 标签：java, windows, logging

有什么方法可以从 java 类访问 Windows 事件日志。有没有人为此编写过任何 API，是否有任何方法可以从远程机器访问数据？

场景是：

我从控制 Java 进程在远程机器上运行一个进程。这个远程进程将内容记录到事件日志中，我希望能够在控制进程中看到这些内容。

提前致谢。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-24T14:43:39.767

[http://www.j-interop.org/](http://www.j-interop.org/ "J-互操作") 是一个开源 Java 库，它在***不使用任何本机代码***的情况下实现 DCOM 协议规范。（即，您可以使用它从运行在非 Windows 客户端上的 Java 代码访问远程 Windows 主机上的 DCOM 对象）。

[Microsoft 通过Windows Management Instrumentation](http://msdn.microsoft.com/en-us/library/aa393258(VS.85).aspx "Windows 管理规范") (WMI)公开了大量系统信息。WMI 可以通过 DCOM 远程访问，并且在 Microsoft 的站点上有大量关于该主题的文档。碰巧的是，您可以通过这个可远程访问的界面访问[Windows 事件日志。](http://msdn.microsoft.com/en-us/library/aa394226(VS.85).aspx "Windows 事件日志")

通过使用 j-interop，您可以远程创建[WbemScripting.SWbemLocator](http://msdn.microsoft.com/en-us/library/aa393719(VS.85).aspx "WbemScripting.SWbemLocator") WMI 对象的实例，然后连接到远程 Windows 主机上的 Windows Management Instrumentation (WMI) 服务。从那里您可以提交一个[查询](http://msdn.microsoft.com/en-us/library/aa393864(VS.85).aspx "询问")，该查询将在写入新的事件日志条目时通知您。

请注意，这确实需要您在远程 Windows 主机上正确启用和配置 DCOM，并且在任何防火墙中都设置了适当的例外。这方面的详细信息可以在线搜索，也可以从上面的 j-interop 站点中引用。

下面的示例使用其 NT 域、主机名、用户名和密码连接到远程主机，并处于一个循环中，将 Windows 记录的每个事件日志条目转储。用户必须已被授予适当的远程 DCOM 访问权限，但不必是管理员。

```
import java.io.IOException;
import java.util.logging.Level;

import org.jinterop.dcom.common.JIException;
import org.jinterop.dcom.common.JISystem;
import org.jinterop.dcom.core.JIComServer;
import org.jinterop.dcom.core.JIProgId;
import org.jinterop.dcom.core.JISession;
import org.jinterop.dcom.core.JIString;
import org.jinterop.dcom.core.JIVariant;
import org.jinterop.dcom.impls.JIObjectFactory;
import org.jinterop.dcom.impls.automation.IJIDispatch;

public class EventLogListener
{

    private static final String WMI_DEFAULT_NAMESPACE = "ROOT\\CIMV2";

    private static JISession configAndConnectDCom( String domain, String user, String pass ) throws Exception
    {
        JISystem.getLogger().setLevel( Level.OFF );

        try
        {
            JISystem.setInBuiltLogHandler( false );
        }
        catch ( IOException ignored )
        {
            ;
        }

        JISystem.setAutoRegisteration( true );

        JISession dcomSession = JISession.createSession( domain, user, pass );
        dcomSession.useSessionSecurity( true );
        return dcomSession;
    }

    private static IJIDispatch getWmiLocator( String host, JISession dcomSession ) throws Exception
    {
        JIComServer wbemLocatorComObj = new JIComServer( JIProgId.valueOf( "WbemScripting.SWbemLocator" ), host, dcomSession );
        return (IJIDispatch) JIObjectFactory.narrowObject( wbemLocatorComObj.createInstance().queryInterface( IJIDispatch.IID ) );
    }

    private static IJIDispatch toIDispatch( JIVariant comObjectAsVariant ) throws JIException
    {
        return (IJIDispatch) JIObjectFactory.narrowObject( comObjectAsVariant.getObjectAsComObject() );
    }

    public static void main( String[] args )
    {

        if ( args.length != 4 )
        {
            System.out.println( "Usage: " + EventLogListener.class.getSimpleName() + " domain host username password" );
            return;
        }

        String domain = args[ 0 ];
        String host = args[ 1 ];
        String user = args[ 2 ];
        String pass = args[ 3 ];

        JISession dcomSession = null;

        try
        {
            // Connect to DCOM on the remote system, and create an instance of the WbemScripting.SWbemLocator object to talk to WMI.
            dcomSession = configAndConnectDCom( domain, user, pass );
            IJIDispatch wbemLocator = getWmiLocator( host, dcomSession );

            // Invoke the "ConnectServer" method on the SWbemLocator object via it's IDispatch COM pointer. We will connect to
            // the default ROOT\CIMV2 namespace. This will result in us having a reference to a "SWbemServices" object.
            JIVariant results[] =
                    wbemLocator.callMethodA( "ConnectServer", new Object[] { new JIString( host ), new JIString( WMI_DEFAULT_NAMESPACE ),
                            JIVariant.OPTIONAL_PARAM(), JIVariant.OPTIONAL_PARAM(), JIVariant.OPTIONAL_PARAM(), JIVariant.OPTIONAL_PARAM(), new Integer( 0 ),
                            JIVariant.OPTIONAL_PARAM() } );

            IJIDispatch wbemServices = toIDispatch( results[ 0 ] );

            // Now that we have a SWbemServices DCOM object reference, we prepare a WMI Query Language (WQL) request to be informed whenever a
            // new instance of the "Win32_NTLogEvent" WMI class is created on the remote host. This is submitted to the remote host via the
            // "ExecNotificationQuery" method on SWbemServices. This gives us all events as they come in. Refer to WQL documentation to
            // learn how to restrict the query if you want a narrower focus.
            final String QUERY_FOR_ALL_LOG_EVENTS = "SELECT * FROM __InstanceCreationEvent WHERE TargetInstance ISA 'Win32_NTLogEvent'";
            final int RETURN_IMMEDIATE = 16;
            final int FORWARD_ONLY = 32;

            JIVariant[] eventSourceSet =
                    wbemServices.callMethodA( "ExecNotificationQuery", new Object[] { new JIString( QUERY_FOR_ALL_LOG_EVENTS ), new JIString( "WQL" ),
                            new JIVariant( new Integer( RETURN_IMMEDIATE + FORWARD_ONLY ) ) } );
            IJIDispatch wbemEventSource = (IJIDispatch) JIObjectFactory.narrowObject( ( eventSourceSet[ 0 ] ).getObjectAsComObject() );

            // The result of the query is a SWbemEventSource object. This object exposes a method that we can call in a loop to retrieve the
            // next Windows Event Log entry whenever it is created. This "NextEvent" operation will block until we are given an event.
            // Note that you can specify timeouts, see the Microsoft documentation for more details.
            while ( true )
            {
                // this blocks until an event log entry appears.
                JIVariant eventAsVariant = (JIVariant) ( wbemEventSource.callMethodA( "NextEvent", new Object[] { JIVariant.OPTIONAL_PARAM() } ) )[ 0 ];
                IJIDispatch wbemEvent = toIDispatch( eventAsVariant );

                // WMI gives us events as SWbemObject instances (a base class of any WMI object). We know in our case we asked for a specific object
                // type, so we will go ahead and invoke methods supported by that Win32_NTLogEvent class via the wbemEvent IDispatch pointer.
                // In this case, we simply call the "GetObjectText_" method that returns us the entire object as a CIM formatted string. We could,
                // however, ask the object for its property values via wbemEvent.get("PropertyName"). See the j-interop documentation and examples
                // for how to query COM properties.
                JIVariant objTextAsVariant = (JIVariant) ( wbemEvent.callMethodA( "GetObjectText_", new Object[] { new Integer( 1 ) } ) )[ 0 ];
                String asText = objTextAsVariant.getObjectAsString().getString();
                System.out.println( asText );
            }
        }
        catch ( Exception e )
        {
            e.printStackTrace();
        }
        finally
        {
            if ( null != dcomSession )
            {
                try
                {
                    JISession.destroySession( dcomSession );
                }
                catch ( Exception ex )
                {
                    ex.printStackTrace();
                }
            }
        }
    }

} 
```

~

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-22T04:13:30.200

在 Java 方面，您需要一个允许您进行本机调用的库。Sun 提供[JNI](http://java.sun.com/javase/6/docs/technotes/guides/jni/index.html)，但听起来有点痛苦。还要考虑：

*   [https://github.com/twall/jna/](https://github.com/twall/jna/)
*   [http://johannburkard.de/software/nativecall/](http://johannburkard.de/software/nativecall/)
*   [http://www.jinvoke.com/](http://www.jinvoke.com/)

在 Windows 方面，您所追求的功能是[OpenEventLog](http://msdn.microsoft.com/en-us/library/aa363672(VS.85).aspx)。这应该允许您访问远程事件日志。另请参阅[查询事件信息](http://msdn.microsoft.com/en-us/library/bb427356(VS.85).aspx)。

如果这听起来不正确，我还发现它可以直接解析日志文件（这不是我推荐的方法，但仍然很有趣）：

*   [http://msdn.microsoft.com/en-us/library/bb309026.aspx](http://msdn.microsoft.com/en-us/library/bb309026.aspx)
*   [http://objectmix.com/java/75154-regarding-windows-event-log-file-parser-java.html](http://objectmix.com/java/75154-regarding-windows-event-log-file-parser-java.html)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-10-01T12:03:24.467

阅读[这篇文章](http://code.dblock.org/ShowPost.aspx?id=125)。

JNA 3.2.8 具有从 Windows 事件日志读取和写入的两种方法。

您可以在[log4jna](https://github.com/dblock/log4jna)中看到一个写入示例。

下面是一个读取示例：

```
EventLogIterator iter = new EventLogIterator("Application");         
while(iter.hasNext()) { 
    EventLogRecord record = iter.next(); 
    System.out.println(record.getRecordNumber() 
            + ": Event ID: " + record.getEventId() 
            + ", Event Type: " + record.getType() 
            + ", Event Source: " + record.getSource()); 
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T09:30:30.430

如果你想从远程机器上访问真正的事件日志，你必须找到一个实现[EventLog Remoting Protocol Specification](http://msdn.microsoft.com/en-us/library/cc231215.aspx)的库。不幸的是，我还没有在 Java 中找到任何这样的库。然而，JCIFS 和 JARAPAC 项目已经为实施该协议奠定了许多基础。协议本身（如果我没记错的话）在 DCE/RPC 协议（由 JARAPAC 实现）之上运行，该协议本身在 SMB 协议（由 JCIFS 实现）之上运行。

我已经在使用 JCIFS 和 JARAPAC 来实现一些 EventLog 的表亲协议，例如远程注册表访问。我可能是盲人，但关于 JARAPAC 的文档似乎有点稀缺。如果你有兴趣实现这个，我可以在有空的时候与你分享我学到的东西！

之后！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-14T12:20:19.413

这里有一百万个（和一个）选项；）

你可以看看 sigar

[http://cpansearch.perl.org/src/DOUGM/hyperic-sigar-1.6.3-src/docs/javadoc/org/hyperic/sigar/win32/EventLog.html](http://cpansearch.perl.org/src/DOUGM/hyperic-sigar-1.6.3-src/docs/javadoc/org/hyperic/sigar/win32/EventLog.html)

不过请注意许可....

或者您可能又快又脏，只是定期执行（并捕获输出） D:>cscript.exe c:\WINDOWS\system32\eventquery.vbs /v

然后使用事件过滤参数来优化结果等... [http://technet.microsoft.com/en-us/library/cc772995(WS.10).aspx](http://technet.microsoft.com/en-us/library/cc772995(WS.10).aspx)

# c++ - 在包含 500,000 个文件的目录中快速访问文件

> ID：310358
> 
> 赞同：5
> 
> 时间：2008-11-21T22:02:15.847
> 
> 标签：c++, linux, file-io, filesystems, inode

我有一个目录，里面有 500,000 个文件。我想尽快访问它们。该算法要求我反复打开和关闭它们（不能同时打开 500,000 个文件）。

我怎样才能有效地做到这一点？我原本以为我可以缓存 inode 并以这种方式打开文件，但 *nix 没有提供通过 inode （安全或类似的）打开文件的方法。

另一种选择是不要担心它，并希望 FS 在目录中查找文件时做得很好。如果这是最好的选择，那么哪个 FS 效果最好。某些文件名模式是否比其他文件名模式查找得更快？例如 01234.txt 与 foo.txt

顺便说一句，这一切都在 Linux 上。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-21T22:41:28.793

假设您的文件系统是[ext3](http://en.wikipedia.org/wiki/Ext3)，如果启用了 dir_index，您的目录将使用散列 B-Tree 进行索引。这将为您提供尽可能多的提升，就像您可以在应用程序中编码的任何内容一样。

如果目录被索引，您的文件命名方案应该无关紧要。

[http://lonesysadmin.net/2007/08/17/use-dir_index-for-your-new-ext3-filesystems/](http://lonesysadmin.net/2007/08/17/use-dir_index-for-your-new-ext3-filesystems/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-21T22:09:20.997

几个想法：

a）如果您可以控制目录布局，则将文件放入子目录中。

b）如果你不能移动文件，那么你可能会尝试不同的文件系统，我认为 xfs 可能对有很多条目的目录有好处？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T22:28:46.277

如果您有足够的内存，您可以使用 ulimit 来增加您的进程一次可以打开的最大文件数，我已经成功处理了 100,000 个文件，500,000 个应该也可以。

如果这不是您的选择，请尝试确保您的 dentry 缓存有足够的空间来存储所有条目。dentry 缓存是文件名->inode 映射，内核用来根据文件名来加速文件访问，访问大量不同的文件可以有效地消除dentry 缓存的好处并引入额外的性能损失。Stock 2.6 内核的哈希值一次最多可包含 256 * MB RAM 条目，如果您有 2GB 内存，则最多可以容纳 500,000 个多一点的文件。

当然，请确保执行适当的分析以确定这是否真的会导致瓶颈。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-21T23:44:02.117

执行此操作的传统方法是使用散列子目录。假设您的文件名都是均匀分布的哈希，以十六进制编码。然后，您可以根据文件名的前两个字符创建 256 个目录（例如，文件 012345678 将被命名为 01/2345678）。如果一个级别不够，您可以使用两个甚至更多级别。

只要文件名是均匀分布的，这将使目录大小保持可控，从而使对它们的任何操作都更快。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T22:38:52.170

另一个问题是文件中有多少数据？SQL 后端是一种选择吗？

# c++ - 如何将一天添加到从 time() 获得的时间

> ID：310363
> 
> 赞同：20
> 
> 时间：2008-11-21T22:03:31.820
> 
> 标签：c++, c, date, dst

我有一个时间表示为自 UTC 1970 年 1 月 1 日午夜以来经过的秒数（早期调用 time() 的结果）。我如何在这个时间上增加一天？

添加 24 * 60 * 60 在大多数情况下有效，但如果夏令时在两者之间打开或关闭，则会失败。换句话说，我主要想增加 24 小时，但有时是 23 或 25 小时。

为了说明 - 程序：

```
#include <time.h>
#include <iostream>

int main()
{
  time_t base = 1142085600;
  for(int i = 0; i < 4; ++i) {
    time_t time = base + i * 24 * 60 * 60;
    std::cout << ctime(&time);
  }
  return 0; 
```

}

产生：

```
Sat Mar 11 08:00:00 2006
Sun Mar 12 09:00:00 2006
Mon Mar 13 09:00:00 2006
Tue Mar 14 09:00:00 2006 
```

我希望 13 年 3 月 12 日……的时间也是上午 8 点。

* * *

FigBug 提供的答案为我指明了正确的方向。但我不得不使用本地时间而不是 gmtime。

```
int main()
{
  time_t base = 1142085600;
  for(int i = 0; i < 4; ++i) {
    struct tm* tm = localtime(&base);
    tm->tm_mday += i;
    std::cout << asctime(tm);
 }
 return 0;
} 
```

给我吗：

```
Sat Mar 11 08:00:00 2006
Sat Mar 12 08:00:00 2006
Sat Mar 13 08:00:00 2006
Sat Mar 14 08:00:00 2006 
```

这就是我想要的。使用 gmtime 给我 14:00:00 的时间

但是，请注意，所有日子都是星期六。此外，它会到 3 月 32 日、33 日等。如果我加入 mktime 函数，我就会回到我开始的地方：

```
#include <time.h>
#include <iostream>

int main()
{
  time_t base = 1142085600;
  for(int i = 0; i < 4; ++i) {
    struct tm* tm = localtime(&base);
    tm->tm_mday += i;
    time_t time = mktime(tm);
    std::cout << asctime(tm);
 }
 return 0;
} 
```

给我：

```
Sat Mar 11 08:00:00 2006
Sun Mar 12 09:00:00 2006
Mon Mar 13 09:00:00 2006
Tue Mar 14 09:00:00 2006 
```

我错过了什么？？？

* * *

好的，我已经尝试了 FigBug 的最新建议，即使用：

```
 std::cout << ctime(&time); 
```

而不是 asctime，但我得到了相同的结果。所以我猜我的库和/或编译器搞砸了。我在 cygwin 上使用 g++ 3.4.4。我将文件复制到 Solaris 5.8 并在那里使用 g++ 3.3 进行编译。我在那里得到正确的结果！事实上，无论我使用 ctime 还是 asctime 输出，我都能得到正确的结果：

```
Sat Mar 11 08:00:00 2006
Sun Mar 12 08:00:00 2006
Mon Mar 13 08:00:00 2006
Tue Mar 14 08:00:00 2006 
```

我还在使用 g++ 3.4.6 的 Red Hut Linux 上获得了正确的结果（具有两个输出函数）。

所以我想我遇到了一个 Cygwin 错误。

谢谢大家的帮助和建议......

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-21T22:07:46.880

使用*gmtime()*将*time_t*转换为*struct tm*

一天加一 ( *tm_mday* )

使用*mktime()*将*struct tm*转换回*time_t*

有关更多信息，请参见[time.h](http://www.cplusplus.com/reference/clibrary/ctime/)

编辑：

我刚试过，这行得通：

```
int main()
{
  time_t base = 1142085600;
  for(int i = 0; i < 4; ++i) {
    struct tm* tm = localtime(&base);
    tm->tm_mday += i;
    time_t next = mktime(tm);
    std::cout << ctime(&next);
 }
 return 0;
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-13T15:31:45.230

FigBug 的解决方案**几乎**每次都能正常工作，但它需要 DST 修复：**tm->tm_isdst = -1**

> tm_isdst 的正值或 0 值会导致 mktime() 最初分别假定夏令时在指定时间内有效或无效。tm_isdst 的负值导致 mktime() 尝试确定夏令时是否在指定时间内有效。

（引自[mktime 规范](http://www.opengroup.org/onlinepubs/009695399/functions/mktime.html)）

```
int main()
{
  time_t base = 1142085600;
  for(int i = 0; i < 4; ++i) {
    struct tm* tm = localtime(&base);
    tm->tm_mday += i;
    tm->tm_isdst = -1;        // don't know if DST is in effect, please determine
                              // this for me
    time_t next = mktime(tm);
    std::cout << ctime(&next);
 }
 return 0;
} 
```

否则会出现错误（以 2009 年 3 月 29 日 01:59:59 开始的莫斯科夏令时为例）：

```
int main()
{
    // 28 March 2009 05:00:00 GMT ( local - 08:00 (MSK) )
    time_t base = 1238216400;

    std::time_t start_date_t = base;
    std::time_t end_date_t = base;

    std::tm start_date = *std::localtime(&start_date_t);
    std::tm end_date = *std::localtime(&end_date_t);

    end_date.tm_mday += 1;
//    end_date.tm_isdst = -1;

    std::time_t b = mktime(&start_date);
    std::time_t e = mktime(&end_date);

    std::string start_date_str(ctime(&b));
    std::string stop_date_str(ctime(&e));

    cout << " begin (MSK) (DST is not active): " << start_date_str;
    cout << " end   (MSD) (DST is active):     " << stop_date_str;
} 
```

输出：

```
begin (MSK) (DST is not active): Sat Mar 28 08:00:00 2009
end   (MSD) (DST is active):     Sun Mar 29 09:00:00 2009 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-21T22:13:38.023

只需添加 24*60*60。它不应该在 DST 期间失败，因为 UTC 永远不会使用 DST。

如果它失败了，那么您没有在代码中的某处使用 UTC。删除时区依赖。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-21T22:06:28.177

当您想要显示值时，保持时间戳 UTC 并将它们转换为指定的时区（包括夏令时），我总是得到最好的结果。

这样可以节省很多麻烦（并使您的程序独立于时区。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-05-30T16:30:50.470

一个非常古老的问题的新答案。

新答案的基本原理：现在有更好的工具来解决这个问题，通过最小化串行 <-> 字段转换，使结果更不容易出错，更易于阅读，并且实际上更有效。

新答案需要 C++11/14`<chrono>`和这个[免费的开源时区库](http://howardhinnant.github.io/date/tz.html)。

这是代码：

```
#include "tz.h"
#include <iostream>

int
main()
{
    using namespace std::chrono;
    using namespace date;
    auto base = make_zoned("Pacific/Easter", sys_seconds{1142085600s});
    for (int i = 0; i < 4; ++i)
    {
        std::cout << format("%a %b %d %T %Y %Z", base) << '\n';
        base = base.get_local_time() + days{1};
    }
} 
```

`zoned_time`首先通过将所需时区与 Unix 时间时间戳配对来创建一个。

以任何所需的格式格式化。

并且 1 天的添加是在时区的本地时间系统中完成的，这将考虑夏令时。输出是：

```
Sat Mar 11 09:00:00 2006 -05
Sun Mar 12 09:00:00 2006 -06
Mon Mar 13 09:00:00 2006 -06
Tue Mar 14 09:00:00 2006 -06 
```

事实证明，这个输出并不是 OP 所说的他想要的（请求的输出是每天 08:00:00）。然而，我使用这个库来全面调查这一天整个星球的时间转换。在这一天只有一个时区发生了转换：太平洋/复活节。而那个过渡是*向后*移动一个小时，而不是*向前*移动。这是南半球智利使用的时区，其中一个时区倒退到 3 月的时间范围内*。*

这可以通过在 UTC 而不是本地时间进行算术来证明。这是对上述程序的一个微小调整：

```
 base = base.get_sys_time() + days{1}; 
```

使用`base.get_sys_time()`，而不是`base.get_local_time()`，会导致算术在“系统时间”中完成，即 UTC 忽略闰秒。现在输出变为：

```
Sat Mar 11 09:00:00 2006 -05
Sun Mar 12 08:00:00 2006 -06
Mon Mar 13 08:00:00 2006 -06
Tue Mar 14 08:00:00 2006 -06 
```

# linq - 使用 LINQ to SQL 存储图像：将字节数组或流转换为二进制

> ID：310375
> 
> 赞同：7
> 
> 时间：2008-11-21T22:08:02.730
> 
> 标签：linq, linq-to-sql, bytearray

我正在使用 LINQ to SQL，并且我的图像字段被视为二进制。当我需要渲染图像时，将 Binary 类型转换为 byte[] （您可以只使用 Binary 对象的 ToArray() 方法）并不是什么大问题，但是有人可以告诉我如何转换 byte[] 或将对象流式传输到 Binary 对象中，以便我可以将其保存回数据库。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-21T22:25:48.980

您可以使用[构造函数](http://msdn.microsoft.com/en-us/library/bb351422.aspx)：

```
public Binary(byte[] value) 
```

像这样：

```
yourObj.BinaryProperty = new Binary(bytes); 
```

# html - 无序列表和可访问性

> ID：310376
> 
> 赞同：6
> 
> 时间：2008-11-21T22:08:40.810
> 
> 标签：html, css, accessibility, web-standards

许多（大多数？）以可访问性和标准合规性为目标的网站使用无序列表进行导航。这是否使网站更易于访问，还是只是为样式提供有用的元素？

我不介意它们，我一直以这种方式使用无序列表。只是，当我从页面中删除样式以尝试评估其可访问性时，令我震惊的是，它也可以是普通链接。这是从哪里来的？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-21T22:38:12.530

网站导航的最佳标记是最能代表您的导航内容的 HTML 标记。这就是橡胶与 HTML 语义的交汇之处。

您的导航是没有任何逻辑顺序的列表吗？如果是这样，那`<UL>`将是一个不错的选择。您的导航更像是一个需要步骤的向导，还是按字母或数字顺序？如果是这样，那么`<OL>`可能是一个更好的选择。

正如您所提到的，将您的导航呈现为*纯链接*不会提供任何语义含义；它会建议您的导航是要阅读的句子。通过在列表中提供您的链接，您提供了关于我们将如何解释这一系列超文本链接词的提示。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-22T03:04:06.983

正如其他发帖者所指出的，从语义上讲，<ul> 非常适合菜单，因为它们通常只是一个链接列表。但我真正喜欢将列表用于菜单的是它们提供的语义和视觉子级嵌套逻辑。例如：

```
<ul id="mainMenu">
    <li>Home</li>
    <li>Something</li>
    <li>Something Else</li>
    <li>Current section
        <ul>
            <li>A Subsection</li>
            <li>Another subsection</li>
            <li>More!
                <ul>
                    <li>We go deeper</li>
                    <li>Who knows where it ends</li>
                </ul>
            </li>
            <li>Back up one step</li>
        </ul>
    </li>
    <li>And another step</li>
    <li>All done!</li>
</ul> 
```

把它放在你的浏览器中并抽它，你会注意到每个级别不仅进一步向右缩进，而且还使用不同样式的项目符号进行渲染。即使没有添加任何 CSS。一定要喜欢那些清单！

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-21T22:13:38.770

删除样式后，项目符号使导航部分更加明显。如果您使用`<div>`s 和`<span>`s 进行导航，删除样式将导致链接彼此相邻。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-21T22:12:25.763

导航基本上是一个链接列表，因此将其标记为列表对我来说似乎是正确的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-21T22:28:45.760

我认为这至少也与 seo 部分有关，因为 html （还）不支持任何类型的导航列表元素。

使用 UL（或 OL）为您的导航提供语义分组，特别是当您有嵌套的导航部分时，并说这组链接具有某种逻辑连贯性和层次结构，至少这是我读过的理论之一。

Jeremy 提到的另一个好处是，当样式关闭时，开箱即用的渲染是有意义的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-21T22:11:41.460

我认为这是为文档结构完成的。我使用过 UL 或 div 标签；虽然我总是发现 UL 更成功。

问候，
弗兰克

# java - 你如何让 jconsole 图表显示小数？

> ID：310383
> 
> 赞同：3
> 
> 时间：2008-11-21T22:11:48.323
> 
> 标签：java, jmx, jconsole

如果您从 MBean 返回 double 或 float，jconsole 似乎会将其向下舍入到最接近的整数。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T22:12:46.713

诀窍是返回一个 Double 或 Float 。Jconsole 正在寻找包装类以确定何时显示小数位。

# c++ - VBScript 中的 Char ^= 0xB3 等效项

> ID：310392
> 
> 赞同：0
> 
> 时间：2008-11-21T22:13:49.100
> 
> 标签：c++, asp-classic, vbscript, xor

我有以下 C++ 代码：

字符^= 0xB3；

Char 是字符串中的单个字符。VBScript 中是否有等价物？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T22:19:19.243

Char = chr(asc(Char) xor &HB3)

# sql-server - sql server 设置implicit_transactions off 和其他选项

> ID：310394
> 
> 赞同：0
> 
> 时间：2008-11-21T22:14:00.143
> 
> 标签：sql-server

我仍在学习 sql server，最近在存储过程中遇到了一个选择查询，这导致在 c# 中填充数据集的速度非常慢。起初我以为这与 .NET 有关，但后来发现了一个建议放入存储过程：

设置implicit_transactions 关闭

这似乎可以治愈它，但我想知道为什么我还看到了其他选择，例如：

*   取消计数
*   设置 arithabort
*   将 concat_null_yields_null 设置为
*   设置 ansi_nulls
*   设置 cursor_close_on_commit 关闭
*   设置 ansi_null_dflt_on on
*   设置 ansi_padding
*   设置 ansi_warnings on
*   设置quoted_identifier on

有谁知道在哪里可以找到关于这些功能的有用信息，以及当我设置存储过程只是为了查询数据以供查看时使用什么是安全的。

我应该注意只是为了停止通常使用/不使用存储过程辩论这些查询是用于多种语言的多个程序的复杂选择语句，这是它们的最佳位置。

**编辑：得到我的答案并没有完全审查所有选项，但确实找到了**

**设置事务隔离级别读取未提交**

**大大加快了复杂查询的速度，我不担心这种情况下的脏读。**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-23T13:21:21.623

这是您想要的 SQL Server 联机丛书 (BOL) 中的页面。它解释了可以在会话中使用的所有 SET 语句。 [http://msdn.microsoft.com/en-us/library/ms190356.aspx](http://msdn.microsoft.com/en-us/library/ms190356.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-04T04:13:45.343

哎呀，某人，某处正在大玩火。

我从未遇到过必须启用隐式事务的生产场景。我总是在需要时打开事务，并在完成后提交它们。隐式交易的问题在于它很容易“泄露”一个开放的交易，这可能导致可怕的问题。这个设置的意思是“如果没有事务打开，请在我第一次运行语句时为我打开一个事务，不要担心提交它”。

例如看看下面的例子：

```
set implicit_transactions on 
go
select top 10 * from sysobjects 
```

和

```
set implicit_transactions off 
go
begin tran
select top 10 * from sysobjects 
```

他们都做同样的事情，但是在第二个声明中很明显有人忘记了提交事务。如果您将这个集合放在一个不起眼的地方，这可能会变得非常复杂。

获取所有 set 语句的文档的最佳位置是旧的可信赖的[sql server 在线书籍](http://msdn.microsoft.com/en-us/library/ms187807.aspx)。它与查询分析器中的一些实验一起通常是掌握大多数设置所需要的。

我强烈建议您找出谁在设置隐式事务，找出他们这样做的原因，并在不需要时删除该设置。此外，您必须确认使用此设置的任何人都提交了他们隐式打开的事务。

可能发生的情况是，您有一个打开的事务阻塞了您的存储过程的一部分，并且在某个地方发生了超时，引发错误并在代码中进行处理，当超时发生时，您的存储过程继续跑步。我的猜测是延迟通常是 30 秒。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T14:16:30.467

我认为您需要更深入地研究您的存储过程。我不认为 SET IMPLICIT_TRANSACTIONS 真的会加快你的程序，我认为这可能是一个巧合。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T22:25:00.230

值得一看的一件事是使用分析器从客户端传递到服务器的内容。

我们遇到了一个奇怪的情况，ADO 连接的默认 SET 参数导致 SP 需要很长时间才能从客户端运行，我们通过查看服务器从客户端接收到的确切内容来解决这个问题，与默认 SET 参数相比从 SSMS 执行时发送。然后，我们让客户端传递与 SSMS 发送的相同的 SET 语句。

这可能有点偏离轨道，但当 SP 在服务器上及时执行而不是从客户端执行时，这是一种有用的方法。

# sql-server - 如何使在 Virtual PC 中运行的 SQL Server 可以访问主机操作系统？

> ID：310407
> 
> 赞同：8
> 
> 时间：2008-11-21T22:19:57.230
> 
> 标签：sql-server, virtual-pc

我在 Windows XP 主机内的 VirtualPC 实例上在 Windows XP 上运行 SQL Server 2008 Express。我希望能够使用主机上的 SSMS 连接到来宾实例上的数据库。当我从主机上的 SSMS 连接并浏览服务器时，我会在来宾上看到 SQL Server 实例。然而，当我尝试使用 SQL 身份验证登录进行连接时，出现以下连接错误：

*建立与 SQL Server 的连接时发生与网络相关或特定于实例的错误。服务器未找到或无法访问。验证实例名称是否正确以及 SQL Server 是否配置为允许远程连接。（提供者：SQL 网络接口，错误：28 - 服务器不支持请求的协议）（Microsoft SQL Server，错误：-1）*

我有：
* 尝试使用名称管道和 TCP/IP 进行连接
* 确保 SQL 浏览器服务已启动
* 确保来宾上的防火墙已打开
* 服务器配置为允许远程连接（根据内部的数据库引擎属性来宾上的 SSMS）

我错过了什么？

编辑：我想通了。我的分辨率如下。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-22T04:12:31.807

**自我接受的答案**

感谢您的想法。经过大量的摆弄，我得到了工作。原来我没有进入 Sql Server 配置管理器并启用 TCP/IP 和命名管道作为网络协议。因此，即使 SSMS 表示启用了远程连接，除了共享内存之外，没有其他协议允许它们使用。完成此操作后，我重新启动了 SQL Server 服务，但事情似乎仍然无法正常工作。然而，一旦我重新启动了来宾和主机，一切都按预期工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T22:27:55.590

你的IP设置如何？您是否在两台机器之间共享相同的 IP 地址？如果是这样，那么当您的客户端尝试连接到 10.1.1.10 时，它可能会访问托管 VPC 实例的机器的 IP，并且该机器没有运行 SQL Server 实例。如果可能，让 VPC 获得自己的 IP 并尝试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T22:33:15.237

通常仔细检查您已经说过
的话，关闭访客防火墙以确保不是那样。
确保您的虚拟机网络设置为桥接而不是 NAT。
尝试连接到访客的 IP 地址而不是其名称。
确保 SQL 服务器允许远程连接，并且客户端和服务器都使用 tcp/ip（或命名管道，如果您愿意）。
我不知道启用远程连接是否需要重新启动 SQL Server。
尝试使用 SQL 身份验证来消除身份验证问题。你在域上运行吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-24T06:32:53.830

要添加一些上面没有明确指出的步骤，根据我的经验，将虚拟 PC 的网络设置到我的物理网络适配器。

然后禁用公共配置文件的 Windows 防火墙。

希望实际上可以将其锁定到端口 1433。

此外，在来宾操作系统上，如果 SQL Server 仅安装了 Windows 身份验证，您稍后会添加 SQL 身份验证，请注意默认情况下禁用“sa”以进行登录访问。为“sa”“启用”登录或（更好的主意）根据需要创建具有适当权限的登录。

# c++ - 从具体类派生抽象类

> ID：310408
> 
> 赞同：13
> 
> 时间：2008-11-21T22:20:35.153
> 
> 标签：c++, inheritance, abstract-class, pure-virtual

假设我们有一个具体的`class Apple`. （Apple 对象可以被实例化。）现在，有人来了，并`class Peach`从 Apple 派生了一个抽象。它是抽象的，因为它引入了一个新的纯虚函数。Peach 的用户现在被迫从中派生并定义这个新功能。这是一种常见的模式吗？这是正确的做法吗？

样本：

```
 class Apple
{
public:
    virtual void MakePie();
    // more stuff here
};`class Peach : public Apple
{
public:
    virtual void MakeDeliciousDesserts() = 0;
    // more stuff here
};`
```

现在假设我们有一个具体的`class Berry`. `class Tomato`有人从贝瑞那里得到了一个摘要。它是抽象的，因为它覆盖了 Berry 的一个虚函数，并使其成为纯虚函数。Tomato 的用户必须重新实现之前在 Berry 中定义的功能。这是一种常见的模式吗？这是正确的做法吗？

样本：

```
 class Berry
{
public:
    virtual void EatYummyPie();
    // more stuff here
};`class Tomato : public Berry
{
public:
    virtual void EatYummyPie() = 0;
    // more stuff here
};`
```

注意：名称是人为的，不反映任何实际代码（希望如此）。写这个问题没有损害任何成果。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-21T23:01:50.297

来自 Apple 的 Re Peach：

*   如果 Apple 是一个值类（即具有复制 ctor、不相同的实例可以相等等），请不要这样做。请参阅 Meyers 更有效的 C++ 第 33 条了解原因。
*   如果 Apple 有一个公共的非虚拟析构函数，请不要这样做，否则当您的用户通过指向 Peach 的指针删除 Apple 时，您会引发未定义的行为。
*   否则，您可能是安全的，因为您没有违反[Liskov substitutability](http://www.objectmentor.com/resources/articles/lsp.pdf)。桃子就是苹果。
*   如果您拥有 Apple 代码，则更愿意分解出一个通用的抽象基类（也许是 Fruit）并从中派生 Apple 和 Peach。

来自浆果的番茄：

*   同上，加上：
*   避免，因为它不寻常
*   如果必须，请记录 Tomato 的派生类必须做什么，以免违反 Liskov 可替换性。您在 Berry 中覆盖的功能 - 我们称之为`Juice()`- 强加某些要求并做出某些承诺。派生类的实现`Juice()`必须不要求更多，承诺也不少。那么 DerivedTomato IS-A Berry 和只知道 Berry 的代码是安全的。

通过记录 DerivedTomatoes 必须调用 ，您可能会满足最后一个要求`Berry::Juice()`。如果是这样，请考虑改用模板方法：

```
class Tomato : public Berry
{
public:
    void Juice() 
    {
        PrepareJuice();
        Berry::Juice();
    }
    virtual void PrepareJuice() = 0;
}; 
```

现在有一个极好的机会是番茄是浆果，这与植物学的预期相反。（例外情况是，如果派生类的实现`PrepareJuice`强加了超出 所强加的额外先决条件`Berry::Juice`）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-21T22:23:54.180

在我看来，这似乎是一个糟糕设计的迹象。如果你想从一个封闭的库中获取一个具体的定义并扩展它并从中分支出一堆东西，可能会被迫，但那时我会认真考虑关于封装而不是继承的指导方针。如果你可以封装，你可能应该。

是的，我想得越多，这是一个非常糟糕的主意。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-21T22:53:38.240

如果您使用具有继承模型“is-a”的推荐做法，那么这种模式几乎不会出现。

一旦你有了一个具体的类，你就是在说它是你可以实际创建一个实例的东西。如果你然后从它派生一个抽象类，那么作为基类属性的东西对于派生类来说是不正确的，它应该设置一些不正确的喇叭。

看你的例子，桃子不是苹果，所以不应该从中派生出来。源自浆果的番茄也是如此。

这是我通常建议收容的地方，但这似乎不是一个好的模型，因为苹果不包含桃子。

在这种情况下，我将排除通用接口—— PieFilling 或 DessertItem。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-21T22:26:39.977

不一定是*错*的，但肯定是臭的。特别是如果你把水果放在阳光下太久。（而且我认为我的牙医不希望我吃混凝土苹果。）

不过，我在这里看到的主要臭味并不是从具体类派生的抽象类，而是真正深的继承层次结构。

编辑：重新阅读我发现这是两个层次结构。所有水果的东西都让我搞混了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T23:18:54.803

有点不寻常，但是如果您有基类的其他子类，并且抽象类的子类有足够的共同点来证明抽象类的存在是合理的，例如：

```
class Concrete
{
public:
    virtual void eat() {}
};
class Sub::public Concrete { // some concrete subclass
    virtual void eat() {}
};
class Abstract:public Concrete // abstract subclass
{
public:
    virtual void eat()=0;
    // and some stuff common to Sub1 and Sub2
};
class Sub1:public Abstract {
    void eat() {}
};
class Sub2:public Abstract {
    void eat() {}
};
int main() {
    Concrete *sub1=new Sub1(),*sub2=new Sub2();
    sub1->eat();
    sub2->eat();
    return 0;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-21T22:31:30.653

嗯……通过思考“什么……”几秒钟，我得出一个结论，这并不常见……而且，我不会从苹果中提取桃子，从浆果中提取番茄……做你有更好的例子吗？:)

你可以在 C++ 中做很多奇怪的事情......我什至想不出其中的 1%......

关于用纯虚拟覆盖虚拟，你可能只是隐藏它，它会很奇怪......

如果你能找到一个愚蠢的 C++ 编译器，将这个函数链接为一个虚函数，那么你将获得运行时纯虚函数调用......

我认为这只能用于黑客攻击，我不知道真正的黑客攻击是什么......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-21T22:33:26.237

要回答您的第一个问题，您可以这样做，因为 Apple 的用户，如果给定一个从 Peach 派生的具体实例不会知道任何不同。并且该实例不会知道它不是 Apple（除非 Apple 提供了一些您没有告诉我们的被覆盖的虚拟功能）。

我还无法想象用纯虚函数覆盖虚函数会有多大用处——这甚至合法吗？

一般来说，您希望符合 Scott Meyers 书中的“使所有非叶类抽象”项。

无论如何，除此之外，您所描述的似乎是合法的-只是我看不到您经常需要它。

# java - 在 JSF+Facelets 中迭代 HashMap.values()

> ID：310410
> 
> 赞同：5
> 
> 时间：2008-11-21T22:20:49.177
> 
> 标签：java, jsf, datatable

我正在使用 JSF/Facelets，我正在尝试迭代一些我保存在 HashMap 中的 Document 对象（自定义对象）。加载页面时，我收到错误“在 java.util.HashMap$Values 类型上找不到属性‘名称’”。这是我的支持 bean 中的内容：

```
private Map<String, Document> documents = new HashMap<String, Document>();

public Collection<Document> getDocuments(){
    return documents.values();
} 
```

在我的 xhtml 页面中：

```
<h:dataTable id="documentTable"
    value="#{DocumentManager.allDocuments}"
    var="doc" rowClasses="list-row-odd, list-row-even"
    headerClass="table-header" styleClass="bordered">

    <h:column id="col_name">
         <f:facet name="header">Name</f:facet>
         ${doc.name}
    </h:column>
</h:dataTable> 
```

如果我将 getDocuments 函数更改为以下内容，它可以工作（意味着表格显示没有错误），但我不确定为什么需要将值放在 JSF/Facelets 页面的列表中才能正确显示。

```
public List<Document> getDocuments(){
    List<Document> rtrn = new ArrayList<Document>();
    for(Document doc : documents.values())
        rtrn.add(doc);
    return rtrn;
} 
```

我不应该能够迭代集合吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-21T23:09:20.500

好吧，事实证明，您不能只对 dataTable 使用任何类型的集合类型，这是有充分理由的。从[MyFaces 1.2 Spec](http://myfaces.apache.org/core12/myfaces-impl/tlddoc/h/dataTable.html)中， value 属性必须是：

> 一个 EL 表达式，它指定支持此表的数据模型。
> 
> EL 表达式引用的值可以是任何类型。
> 
> *   直接使用 DataModel 类型的值。
> *   `Object[]`类型为 ,或的类数组参数包装在相应的 DataModel 中`java.util.List`，该 DataModel 知道如何迭代元素。`java.sql.ResultSet``javax.servlet.jsp.jstl.sql.Result`
> *   其他值作为单行包装在 DataModel 中。
> 
> 请特别注意，`Set`不支持无序集合，例如。因此，如果值表达式引用了这样一个对象，那么该表将被认为只包含一个元素 - 集合本身。

从 HashSet.values() 返回的 Collection 没有排序，因此不受支持。如果是这样，您将不知道表中的行将以什么顺序输出，并且页面的刷新可能会随机重新排序它们。不好。

您得到的错误是，从最后一段开始，它说数据表将您的 Collection 视为行对象，而 Collection 没有“名称”属性。

# wix - 学习如何从 WiX 创建 MSI 安装程序的好资源

> ID：310418
> 
> 赞同：87
> 
> 时间：2008-11-21T22:24:34.973
> 
> 标签：wix, windows-installer

我已经放弃尝试将口红应用到从[Visual Studio](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio)出来的安装程序的猪身上，并决定看看[WiX](http://en.wikipedia.org/wiki/WiX)。

您会推荐哪些资源来学习和参考？

*（注意——这不是你使用哪个安装技术的问题——它特定于 WiX。）*

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-11-21T22:30:16.367

*   [WiX 教程](https://www.firegiant.com/wix/tutorial/)是排名第一的资源
*   [邮件列表](http://wixtoolset.org/documentation/mailinglist/)中的人非常乐于助人
*   有一篇 The Code Project 文章，*[使用 Wix v3.0、Votive 和 Visual Studio 2005/2008 创建安装程序 - 第 2 部分](http://www.codeproject.com/KB/install/WixTutorial2.aspx)*，可能有帮助的 GUI
*   有一堆博客，我一直在碰到[Rob Mensching 的（旧）](http://blogs.msdn.com/robmen/default.aspx)。
*   [Rob Mensching 的新博客](http://robmensching.com/blog/)。
*   我没读过~~*[WiX - Windows 安装程序 XML](http://www.dalun.com/wix/)*~~（断开的链接），但我在书签中找到了它
*   此[代码项目教程](http://www.codeproject.com/Tips/105638/A-quick-introduction-Create-an-MSI-installer-with)概述了最低限度并从那里建立

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-12-28T08:17:06.910

我发现学习 WiX 的最佳方法之一是采用现有的 MSI 来完成我想做的事情，并使用[Dark](http://wixtoolset.org/documentation/manual/v3/overview/alltools.html)反编译器从中生成 WiX 脚本，然后我阅读了它。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2014-02-27T07:55:55.967

除了上面人们提供的链接之外，还可以看看我用来向人们解释这一点的方法：

![从 wix 创建 msi 的 Wix 命令：](https://i.stack.imgur.com/o4Wc8.png)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-21T22:25:20.963

乍一看*[，从 MSI 到 WiX](http://blogs.technet.com/alexshev/pages/from-msi-to-wix.aspx)*似乎相当全面。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-22T02:26:40.150

我必须添加`wix-users@lists.wixtoolset.org`. 那是每个人都闲逛并在他们出现时提出/回答问题的地方。只是潜伏在该邮件列表中，就可以提供大量有关 WiX 工具集的实时教育。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-11-24T15:33:10.200

尽管它不仅与 WiX 有关，但来自[Apress](http://en.wikipedia.org/wiki/Apress)的书：

Phil Wilson 的 Windows Installer 权威指南 [链接](http://www.apress.com/book/view/9781590592977)

它帮助我了解了安装过程。在编写安装程序时，这是一本好书。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2010-10-19T12:18:48.173

这是我最近通过 Packt 出版的书的一个无耻插件：

[WiX：Windows Installer XML 开发人员指南](https://www.packtpub.com/wix-a-developers-guide-to-windows-installer-xml/book)

它涵盖了使用 WiX 3.0 所需了解的许多内容。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-15T22:06:39.947

如果您懂德语，请阅读[Entwickler Magazin](http://entwickler-magazin.de/)中的文章，版本：2008-05、2008-06 和 2009-01。

后续将在 2009 年 2 月发布，其中包含更多开发内容（MSI API）。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-07-21T23:19:53.117

您可以使用链接作为参考[https://www.firegiant.com/wix/tutorial/](https://www.firegiant.com/wix/tutorial/) 它对初学者没有帮助，因为它没有提供任何实际示例。

对于初学者，如果您订阅了复数视力，则有一门课程将教您基础知识。

Nick-Ramirez的“WIX-Cookbook” [https://www.packtpub.com/web-development/wix-cookbook](https://www.packtpub.com/web-development/wix-cookbook)（涵盖 Wix-3.8）。如果有人希望快速完成工作，这就是这本书。

如果您想深入了解一切工作的原理和原因，您最好阅读同一作者的 Wix-3.6 A Developers Guide。 [https://www.packtpub.com/application-development/wix-developers-guide-windows-installer-xml](https://www.packtpub.com/application-development/wix-developers-guide-windows-installer-xml)

要为网站创建安装程序，请参阅 Bart De Meyer 的以下系列 [http://blog.bartdemeyer.be/2013/10/create-an-installer-for-website-with-wix-part-1/](http://blog.bartdemeyer.be/2013/10/create-an-installer-for-website-with-wix-part-1/) 本文将显示你如何使用蜡烛和光之类的蜡工具。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-04-28T16:30:08.010

如果您想要一个实际示例，我已经编写了一个教程，向您展示如何在[此处为控制台应用程序创建 WIX 安装程序。](https://www.bayological.io/Post/How-To-Create-a-Wix-Installer-For-a-Console-Application)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-11-05T11:12:16.487

用另一个无耻的插头插话；我最近写了一篇文章，我有点拼命地试图以一种比其他方式更容易理解的方式来解释 WiX 的一些概念。没有恶意。

[http://www.optimalbpm.se/wiki/index.php/WiX](http://www.optimalbpm.se/wiki/index.php/WiX)

它是在阅读任何教程*之前*阅读的，因为它专门试图解决人们似乎总是因为阅读这些教程而误解的一些事情。尤其是文档。至少我做到了。

此外，还有另一篇更高级的文章，它与那些基于脚本（如 Python 等）的分发系统有一个角度，以及为什么不仅在这些系统中，而且在所有情况下都应该使用石蜡而不是热。

[http://www.optimalbpm.se/wiki/index.php/Wix_and_scripting_languages](http://www.optimalbpm.se/wiki/index.php/Wix_and_scripting_languages)

# sql-server - SQL Server 加权全文搜索

> ID：310425
> 
> 赞同：7
> 
> 时间：2008-11-21T22:27:41.630
> 
> 标签：sql-server, full-text-search

目前我有一个表，我搜索 4 个字段，FirstName、LastName、MiddleName 和 AKA。我目前对行进行了**CONTAINSTABLE**搜索，并且可以正常工作。不太好，但它有效。现在**我想让名字的权重更高，中间名的权重更低。**

我找到了命令**ISABOUT**但如果我必须按单词而不是列来执行它似乎毫无价值（希望我理解错了）。如果它是逐字的，这不是一个选项，因为我不知道用户将输入多少字。

我在[这里](https://stackoverflow.com/questions/198152/how-do-i-assign-weights-to-different-columns-in-a-full-text-search)找到了讨论相同解决方案的线程，但是我无法使公认的解决方案起作用。也许我做错了什么，但无论如何我都无法让它工作，它的逻辑似乎真的……很奇怪。必须有一个更简单的方法。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-26T21:15:30.837

操纵排名的关键是使用联合。对于每一列，您使用单独的选择语句。在该语句中，添加一个标识符，该标识符显示每行是从哪一列中提取的。将结果插入到表变量中，然后您可以通过对标识符进行排序或将排名乘以基于标识符的某个值来操纵排名。

关键是给出修改排名的表象，而不是实际改变sql server的排名。

使用表变量的示例：

```
DECLARE @Results TABLE (PersonId Int, Rank Int, Source Int) 
```

对于表 People with Columns `PersonId Int PK Identity, FirstName VarChar(100), MiddleName VarChar(100), LastName VarChar(100), AlsoKnown VarChar(100)`，每列都添加到全文目录中，您可以使用以下查询：

```
INSERT INTO @Results (PersonId, Rank, Source)

SELECT PersonId, Rank, 1
FROM ContainsTable(People, FirstName, @SearchValue) CT INNER JOIN People P ON CT.Key = P.PersonId

UNION
SELECT PersonId, Rank, 2
FROM ContainsTable(People, MiddleName, @SearchValue) CT INNER JOIN People P ON CT.Key = P.PersonId

UNION
SELECT PersonId, Rank, 3
FROM ContainsTable(People, LastName, @SearchValue) CT INNER JOIN People P ON CT.Key = P.PersonId

UNION
SELECT PersonId, Rank, 4
FROM ContainsTable(People, AlsoKnown, @SearchValue) CT INNER JOIN People P ON CT.Key = P.PersonId

/*
Now that the results from above are in the @Results table, you can manipulate the
rankings in one of several ways, the simplest is to pull the results ordered first by Source then by Rank.  Of course you would probably join to the People table to pull the name fields.
*/

SELECT PersonId
FROM @Results
ORDER BY Source, Rank DESC

/*
A more complex manipulation would use a statement to multiply the ranking by a value above 1 (to increase rank) or less than 1 (to lower rank), then return results based on the new rank.  This provides more fine tuning, since I could make first name 10% higher and middle name 15% lower and leave last name and also known the original value.
*/

SELECT PersonId, CASE Source WHEN 1 THEN Rank * 1.1 WHEN 2 THEN Rank * .9 ELSE Rank END AS NewRank FROM @Results
ORDER BY NewRank DESC 
```

一个缺点是你会注意到我没有使用`UNION ALL`，所以如果一个词出现在多个列中，排名将不会反映这一点。如果这是一个问题，您可以使用`UNION ALL`然后通过将重复记录的全部或部分排名添加到具有相同人员 ID 的另一条记录的排名来删除重复的人员 ID。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T05:32:36.793

排名在索引中是无用的，您不能合并它们并期望结果意味着任何东西。每个指标的排名数字是苹果/橙/葡萄/西瓜/对的比较，没有*相对*意义WRT其他指标的内容。

当然，您可以尝试在索引之间链接/权重/顺序排名，以尝试捏造有意义的结果，但最终结果仍然是胡言乱语，但可能仍然足够好，可以根据您的具体情况提供可行的解决方案。

在我看来，最好的解决方案是将您打算可搜索的所有数据放在单个 FTS 索引/列中，并使用该列排名来对您的输出进行排序。即使您必须复制字段内容来完成结果。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-11-08T14:59:29.697

就在几周前，我正在解决非常相似的问题，并且解决方案非常简单（尽管丑陋且占用空间）。`FirstName + FirstName + LastName + MiddleName`按此顺序创建包含 的组合值的另一列。Duplicate FirstName 列**不是拼写错误**，它是一种在搜索过程中强制 FT 将 FirstName 中的值权重更高的技巧。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-06-05T08:45:43.213

这种方式怎么样：

```
 SELECT p.* from Person p
left join ContainsTable(Person, FirstName, @SearchValue) firstnamefilter on firstnamefiler.key = p.id
left join ContainsTable(Person, MiddleName, @SearchValue) middlenamefilter on middlenamefilter.key = p.id
where (firstnamefilter.rank is not null or middlenamefilter.rank is not null)
order by firstnamefilter.rank desc, middlenamefilter.rank desc 
```

这将为每个`Person`记录生成一个记录，其中名字或中间名（或两者）在搜索词上匹配，并按与名字的所有匹配项排序（按降序排列），然后是与中间名的所有匹配项（再次按降序排列）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-04T09:52:09.093

我假设返回的数据已连接到您的架构中的其他表？我会根据从关联数据到全文索引的列开发自己的 RANK。这也保证了 RANK 值的准确度。

# ruby - Ruby 中的列表理解

> ID：310426
> 
> 赞同：99
> 
> 时间：2008-11-21T22:27:45.203
> 
> 标签：ruby, list-comprehension

为了做相当于 Python 列表推导，我正在做以下事情：

```
some_array.select{|x| x % 2 == 0 }.collect{|x| x * 3} 
```

有没有更好的方法来做到这一点......也许用一个方法调用？

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2008-11-22T01:39:59.730

怎么样：

```
some_array.map {|x| x % 2 == 0 ? x * 3 : nil}.compact 
```

稍微干净一点，至少在我看来，根据快速基准测试，比你的版本快 15%...

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2008-11-21T22:47:16.003

如果你真的想要，你可以像这样创建一个 Array#comprehend 方法：

```
class Array
  def comprehend(&block)
    return self if block.nil?
    self.collect(&block).compact
  end
end

some_array = [1, 2, 3, 4, 5, 6]
new_array = some_array.comprehend {|x| x * 3 if x % 2 == 0}
puts new_array 
```

印刷：

```
6
12
18 
```

我可能会按照你的方式去做。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2011-02-18T20:13:35.490

我做了一个快速的基准测试，比较了这三种选择，**map-compact**似乎确实是最好的选择。

### 性能测试（导轨）

```
require 'test_helper'
require 'performance_test_help'

class ListComprehensionTest < ActionController::PerformanceTest

  TEST_ARRAY = (1..100).to_a

  def test_map_compact
    1000.times do
      TEST_ARRAY.map{|x| x % 2 == 0 ? x * 3 : nil}.compact
    end
  end

  def test_select_map
    1000.times do
      TEST_ARRAY.select{|x| x % 2 == 0 }.map{|x| x * 3}
    end
  end

  def test_inject
    1000.times do
      TEST_ARRAY.inject([]) {|all, x| all << x*3 if x % 2 == 0; all }
    end
  end

end 
```

### 结果

```
/usr/bin/ruby1.8 -I"lib:test" "/usr/lib/ruby/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb" "test/performance/list_comprehension_test.rb" -- --benchmark
Loaded suite /usr/lib/ruby/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader
Started
ListComprehensionTest#test_inject (1230 ms warmup)
           wall_time: 1221 ms
              memory: 0.00 KB
             objects: 0
             gc_runs: 0
             gc_time: 0 ms
.ListComprehensionTest#test_map_compact (860 ms warmup)
           wall_time: 855 ms
              memory: 0.00 KB
             objects: 0
             gc_runs: 0
             gc_time: 0 ms
.ListComprehensionTest#test_select_map (961 ms warmup)
           wall_time: 955 ms
              memory: 0.00 KB
             objects: 0
             gc_runs: 0
             gc_time: 0 ms
.
Finished in 66.683039 seconds.

15 tests, 0 assertions, 0 failures, 0 errors 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2012-03-26T23:26:47.297

在这个线程中，Ruby 程序员似乎对列表理解是什么感到有些困惑。每个响应都假定一些预先存在的数组进行转换。但是列表推导的强大之处在于使用以下语法动态创建的数组：

```
squares = [x**2 for x in range(10)] 
```

以下将是 Ruby 中的模拟（此线程中唯一合适的答案，AFAIC）：

```
a = Array.new(4).map{rand(2**49..2**50)} 
```

在上述情况下，我正在创建一个随机整数数组，但该块可以包含任何内容。但这将是一个 Ruby 列表理解。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2010-05-04T01:51:24.893

我与 Rein Henrichs 讨论了这个话题，他告诉我性能最好的解决方案是

```
map { ... }.compact 
```

这很有意义，因为它避免了构建中间数组，就像不可变的用法一样`Enumerable#inject`，它避免了增长数组，这会导致分配。除非您的集合可以包含 nil 元素，否则它与其他任何一个一样通用。

我没有和这个比较过

```
select {...}.map{...} 
```

可能 Ruby 的 C 实现`Enumerable#select`也非常好。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2010-05-02T16:49:30.427

可以在每个实现中运行并在 O(n) 而不是 O(2n) 时间内运行的替代解决方案是：

```
some_array.inject([]){|res,x| x % 2 == 0 ? res << 3*x : res} 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2013-02-15T19:23:01.337

我刚刚将[comprehend gem](https://github.com/mdsol-share/comprehend)发布到 RubyGems，它可以让你这样做：

```
require 'comprehend'

some_array.comprehend{ |x| x * 3 if x % 2 == 0 } 
```

它是用 C 语言编写的；数组只遍历一次。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2013-10-02T02:10:37.050

Enumerable 有一个`grep`方法，其第一个参数可以是谓词 proc，其可选的第二个参数是映射函数；所以以下工作：

```
some_array.grep(proc {|x| x % 2 == 0}) {|x| x*3} 
```

这不像其他几个建议那样可读（我喜欢 anoiaque 的 simple`select.map`或 histocrat 的 comprehend gem），但它的优点是它已经是标准库的一部分，并且是单通道的，不涉及创建临时中间数组，并且不需要像`nil`在`compact`-using 建议中使用的越界值。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2010-05-03T16:37:45.280

```
[1, 2, 3, 4, 5, 6].collect{|x| x * 3 if x % 2 == 0}.compact
=> [6, 12, 18] 
```

这对我行得通。它也很干净。是的，它与 相同`map`，但我认为`collect`使代码更易于理解。

* * *

```
select(&:even?).map() 
```

实际上看起来更好，在下面看到它之后。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2010-05-03T22:09:20.260

这更简洁：

```
[1,2,3,4,5,6].select(&:even?).map{|x| x*3} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-05-03T18:32:39.933

就像 Pedro 提到的那样，您可以将链式调用`Enumerable#select`和融合在一起`Enumerable#map`，避免遍历选定的元素。这是真的，因为`Enumerable#select`它是 fold 或 的特化`inject`。我在 Ruby subreddit 上发布了对该主题的[仓促介绍。](http://www.reddit.com/r/ruby/comments/a13fm/a_60_second_fusion_tutorial_for_ruby/)

手动融合数组转换可能很乏味，所以也许有人可以使用 Robert Gamble 的`comprehend`实现来使这个`select`/`map`模式更漂亮。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2013-04-17T04:41:43.563

像这样的东西：

```
def lazy(collection, &blk)
   collection.map{|x| blk.call(x)}.compact
end 
```

称它为：

```
lazy (1..6){|x| x * 3 if x.even?} 
```

返回：

```
=> [6, 12, 18] 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2020-07-07T16:13:08.430

Ruby 2.7 引入了`filter_map`它几乎可以实现您想要的（地图 + 紧凑）：

```
some_array.filter_map { |x| x * 3 if x % 2 == 0 } 
```

[你可以在这里](https://blog.saeloun.com/2019/05/25/ruby-2-7-enumerable-filter-map.html)阅读更多关于它的信息。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2018-10-30T16:27:42.980

另一种解决方案，但可能不是最好的

```
some_array.flat_map {|x| x % 2 == 0 ? [x * 3] : [] } 
```

或者

```
some_array.each_with_object([]) {|x, list| x % 2 == 0 ? list.push(x * 3) : nil } 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-09-06T09:26:58.707

这是解决此问题的一种方法：

```
c = -> x do $*.clear             
  if x['if'] && x[0] != 'f' .  
    y = x[0...x.index('for')]    
    x = x[x.index('for')..-1]
    (x.insert(x.index(x.split[3]) + x.split[3].length, " do $* << #{y}")
    x.insert(x.length, "end; $*")
    eval(x)
    $*)
  elsif x['if'] && x[0] == 'f'
    (x.insert(x.index(x.split[3]) + x.split[3].length, " do $* << x")
    x.insert(x.length, "end; $*")
    eval(x)
    $*)
  elsif !x['if'] && x[0] != 'f'
    y = x[0...x.index('for')]
    x = x[x.index('for')..-1]
    (x.insert(x.index(x.split[3]) + x.split[3].length, " do $* << #{y}")
    x.insert(x.length, "end; $*")
    eval(x)
    $*)
  else
    eval(x.split[3]).to_a
  end
end 
```

所以基本上我们将字符串转换为正确的 ruby​​ 语法 for loop 然后我们可以在字符串中使用 python 语法来执行：

```
c['for x in 1..10']
c['for x in 1..10 if x.even?']
c['x**2 for x in 1..10 if x.even?']
c['x**2 for x in 1..10']

# [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
# [2, 4, 6, 8, 10]
# [4, 16, 36, 64, 100]
# [1, 4, 9, 16, 25, 36, 49, 64, 81, 100] 
```

或者，如果您不喜欢字符串的外观或必须使用 lambda，我们可以放弃尝试镜像 python 语法并执行以下操作：

```
S = [for x in 0...9 do $* << x*2 if x.even? end, $*][1]
# [0, 4, 8, 12, 16] 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2019-12-24T16:35:23.950

[https://rubygems.org/gems/ruby_list_comprehension](https://rubygems.org/gems/ruby_list_comprehension)

我的 Ruby List Comprehension gem 的无耻插件，允许惯用的 Ruby 列表理解

```
$l[for x in 1..10 do x + 2 end] #=> [3, 4, 5 ...] 
```

* * *

## 回答 #17

> 赞同：-3
> 
> 时间：2009-10-24T01:51:18.387

我认为最能理解列表的方式如下：

```
some_array.select{ |x| x * 3 if x % 2 == 0 } 
```

由于 Ruby 允许我们将条件放在表达式之后，我们得到的语法类似于 Python 版本的列表推导。此外，由于该`select`方法不包含任何等同于 的内容`false`，所有 nil 值都将从结果列表中删除，并且不需要调用 compact ，如果我们使用`map`or`collect`代替。

# silverlight - Silverlight TreeView - 节点展开时加载数据

> ID：310436
> 
> 赞同：5
> 
> 时间：2008-11-21T22:32:26.177
> 
> 标签：silverlight, silverlight-toolkit

有没有办法在父节点展开时只加载子节点？我遇到的问题是，如果节点没有任何子节点，则不会显示“展开”图标。由于在单击图标之前我不想加载孩子，所以我留下了一些问题 22。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-10-08T06:09:29.570

首先，阅读这篇文章： [http ://bea.stollnitz.com/blog/?p=55](http://bea.stollnitz.com/blog/?p=55)

二、继承TreeViewItem和TreeView：

```
public class TreeViewItemEx : TreeViewItem {
    protected override DependencyObject GetContainerForItemOverride() {
        TreeViewItemEx tvi = new TreeViewItemEx();
        Binding expandedBinding = new Binding("IsExpanded");
        expandedBinding.Mode = BindingMode.TwoWay;
        tvi.SetBinding(TreeViewItemEx.IsExpandedProperty, expandedBinding);
        return tvi;
    }
}

public class TreeViewEx : TreeView {
    protected override DependencyObject GetContainerForItemOverride() {
        TreeViewItemEx tvi = new TreeViewItemEx();
        Binding expandedBinding = new Binding("IsExpanded");
        expandedBinding.Mode = BindingMode.TwoWay;
        tvi.SetBinding(TreeViewItemEx.IsExpandedProperty, expandedBinding);

        return tvi;
    }
} 
```

第三，将模型的属性绑定到“IsExpanded”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T08:11:06.973

使用树视图，您通常必须加载每个显示节点的子节点。

因此，如果您只显示根目录，您也需要加载根子目录。展开根目录后，如果要为这些孩子扩展内容，则需要加载每个孩子的孩子。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T16:54:47.713

完全可以让树控件按需加载子节点，您可以使用 Silverlight TreeView 执行此操作。例如，当您填充根节点时，如果此数据来自数据库，那么对于每个节点也返回它是否有子节点，如果有，则添加一个虚拟子节点，这将使控件在旁边放一个 +它。处理扩展事件并在此查看子节点是否为虚拟节点，如果将其删除，则从数据库中获取子节点并添加它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T09:28:25.213

我也在看这个。我认为您需要编写自己的 TreeNode 子类来按需加载子节点。
我在 windows 窗体 TreeView 中使用的一种方法是向每个节点添加一个空子节点，然后在节点展开并且需要真正的子节点时将其删除。这种方法的问题是你会得到错误的可扩展节点，但如果你能接受它，那么它就是一个简单的解决方案。

# pdf - 从一个 .ps 文件创建两个 pdf？

> ID：310441
> 
> 赞同：3
> 
> 时间：2008-11-21T22:34:16.937
> 
> 标签：pdf, postscript

我需要将文本文件重新格式化为 PDF。使用 Perl，我正在根据文本文件中的内容修改现有的 PostScript 模板文件。有时这个文本文件足够长，需要一个两页的 PDF。

我可以使用 GhostScript 从一个 .ps 文件创建一个两页的 PDF 文件吗？如果是这样，是什么告诉 GhostScript 应该在哪里发生分页符？

也许我需要使用两个模板文件。一个用于一页pdf，另一个用于两页PDF。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T22:47:25.490

PostScript 没有直接包含文本流或分页符的概念。showpage[操作](http://www.tailrecursive.org/postscript/operators.html)员将页面呈现给设备，清除页面并启动新页面。PS 到 PDF 的转换将在 PDF 上创建一个新页面。如果您想将 PostScript 文件分割成页面，[psutils](http://gershwin.ens.fr/vdaniel/Doc-Locale/Outils-Gnu-Linux/PsUtils/)是一系列用于处理 PostScript 文件的程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T22:43:53.233

我猜这取决于您的 PostScript 模板中的内容。PostScript 文件是一个计算机程序，分页符由 PostScript 中的逻辑决定。如果两页格式与一页格式基本相同，您可以让 Perl 脚本拆分数据，然后创建两个连接在一起的单页文件。GhostScript 应该正确呈现该文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T22:46:01.343

这取决于将文本文件转换为创建适当的 PostScript 命令来处理分页符的任何内容。

当（且仅当）您的 PostScript 模板调用`showpage`.

# java - Best way to configure a Java enterprise application

> ID：310448
> 
> 赞同：3
> 
> 时间：2008-11-21T22:38:26.427
> 
> 标签：java, configuration, ejb

I have a set of EJBs and other Java classes which need to be configured differently based on the system environment in which they are deployed: production, test, or lab. The configuration information includes stuff like URLs and database connection information.

We'd like to deploy the same exact product (EAR file) in each environment, and have the code then figure out where it is and what its configuration should be, without having to reach out to each deployment server in each environment to make changes.

What is the best way to configure all these components in a centralized, reliable, easy-to-maintain fashion?

Thanks for your thoughts.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T23:00:06.400

最好的，恕我直言，是使用 JNDI 条目。

您可能必须重新编码应用程序的某些部分才能使用这些条目而不是普通变量，但使用此设置：

*   配置与服务器无关：每个供应商都提供自己的实现，但规范是一个标准。
*   在集群环境中，配置可以保存在集群范围的 JNDI 树中（参见 JBoss）
*   可以通过 webadmin 更改配置，而无需重新启动服务器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T00:03:10.813

如果您将完全相同的 EAR 部署到某个容器的三个不同实例，那么您将不得不编辑部署设置，因为部署过程无法知道您想使用三个版本中的哪一个在特定的部署中。

正如上述 Piere-Yves 所说，部署设置应该进入 JNDI 条目。

如果我是你，我会让我的部署脚本（Ant？）根据你部署到的环境正确填充 JNDI 条目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T22:46:37.287

数据库连接池信息的存储/配置方式取决于应用服务器供应商。将其他变量内容放在类路径上的属性文件中。

# c++ - Should I use static_cast or reinterpret_cast when casting a void* to whatever

> ID：310451
> 
> 赞同：231
> 
> 时间：2008-11-21T22:39:37.457
> 
> 标签：c++, pointers, static-cast, reinterpret-cast

Both `static_cast` and `reinterpret_cast` seem to work fine for casting `void*` to another pointer type. Is there a good reason to favor one over the other?

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2008-11-21T22:58:16.670

**使用`static_cast`**：它是准确描述此处进行的转换的最窄类型。

有一种误解认为 using`reinterpret_cast`会更好，因为它意味着“完全忽略类型安全，只是从 A 转换为 B”。

但是，这实际上并没有描述`reinterpret_cast`. 相反，`reinterpret_cast`它具有多种含义，因为所有含义都认为“执行的映射`reinterpret_cast`是实现定义的”。[5.2.10.3]

`void*`但是在从映射到映射的特殊情况下，`T*`标准完全定义了它；即，将类型分配给无类型指针而不更改其地址。

这是一个偏爱的理由`static_cast`。

此外，可以说更重要的是，每次使用都`reinterpret_cast`非常危险，因为它将任何东西都转换为其他任何东西（对于指针），同时`static_cast`限制性更强，从而提供了更好的保护级别。这已经使我免于意外尝试将一种指针类型强制转换为另一种的错误。

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2011-02-16T07:28:25.123

`static_cast`更适合将 a 转换为其他`void*`类型的指针。

`static_cast`当两种类型之间存在自然、直观的转换且不一定保证在运行时工作时，它是首选。例如，您可以使用`static_cast`将基类指针转换为派生类指针，这种转换在某些情况下是有意义的，但直到运行时才能验证。同样，您可以使用将 a`static_cast`转换`int`为 a `char`，这是定义明确的，但在执行时可能会导致精度损失。

`reinterpret_cast`另一方面，它是一个铸造操作员，旨在进行根本不安全或不可移植的转换。例如，您可以使用`reinterpret_cast`将 a 转换为`void *`，如果您的系统恰好有≤ `int`，它将正常工作。您还可以使用将 a 转换为 a或反之亦然，这是特定于平台的，因为不保证s 和s 的特定表示彼此有任何共同之处。`sizeof (void*)``sizeof (int)``reinterpret_cast``float*``int*``float``int`

简而言之，如果您发现自己在进行转换，其中强制转换在逻辑上是有意义的，但在运行时不一定会成功，请避免`reinterpret_cast`. `static_cast`如果您预先知道强制转换将在运行时工作，并且与编译器通信，这是一个不错的选择“我知道这可能不起作用，但至少它是有道理的，我有理由相信它会正确在运行时做正确的事。” 然后编译器可以检查转换是否在相关类型之间，如果不是这种情况，则报告编译时错误。使用`reinterpret_cast`指针转换完全绕过编译时安全检查。

在某些情况下，您可能希望使用 a`dynamic_cast`而不是 a `static_cast`，但这些主要涉及类层次结构中的强制转换，并且（很少）直接关注`void*`。

至于规范首选哪一个，两者都没有被过度提及为“正确的使用”（或者至少，我不记得其中一个是这样提到的。）但是，我认为规范希望你使用`static_cast`结束`reinterpret_cast`。例如，当使用 C 风格转换时，如

```
A* ptr = (A*) myVoidPointer; 
```

尝试的强制转换运算符的顺序总是尝试在 a`static_cast`之前使用 a `reinterpret_cast`，这是您想要的行为，因为`reinterpret_cast`不能保证是可移植的。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-21T23:46:24.280

这是一个棘手的问题。一方面，Konrad 对**reinterpret_cast**的规范定义提出了一个很好的观点，尽管在实践中它可能会做同样的事情。另一方面，如果您在指针类型之间进行转换（例如，在通过 char* 在内存中进行索引时相当常见），**static_cast**将产生编译器错误，并且无论如何您都将被迫使用**reinterpret_cast 。**

在实践中，我使用**reinterpret_cast**因为它更能描述转换操作的意图。您当然可以为不同的运算符指定仅重新解释指针的情况（保证返回相同的地址），但标准中没有。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-02-16T07:27:46.543

您可能通过`void*`隐式转换获得了它，因此您应该使用`static_cast`它，因为它最接近隐式转换。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-02-16T07:24:08.643

用于`static_cast`此。只有在极少数情况下没有其他方法时才使用`reinterpret_cast`。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-06-26T06:31:37.557

使用和使用`void*`的转换是相同的。[请参阅链接](https://stackoverflow.com/a/68137312/5447906)中的答案。但通常是首选，因为它更窄并且通常（但不是在这种特定情况下）更安全的转换。`static_cast``reinterpret_cast``static_cast`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-14T09:30:45.847

我建议始终使用最弱的演员阵容。

`reinterpret_cast`可用于将指针强制转换为`float`. 铸件的结构破坏越多，使用它需要的注意力就越多。

在 的情况下`char*`，我会使用 c 风格的演员表，直到我们有一些`reinterpret_pointer_cast`，因为它更弱，没有其他东西是足够的。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2011-02-16T07:28:10.920

`reinterpret_cast`将强制转换`void*`为目标数据类型。它不能保证任何安全性，并且您的程序可能会崩溃，因为底层对象可能是任何东西。

例如，您可以对一个`myclass*`to 进行类型转换`void*`，然后使用`reinterpret_cast`将其转换为`yourclass*`可能具有完全不同的布局。

所以它更好，推荐使用`static_cast`

# c# - C# - 获取打开任务列表

> ID：310456
> 
> 赞同：10
> 
> 时间：2008-11-21T22:43:32.423
> 
> 标签：c#, .net, taskbar, task

我正在尝试找到一种在 C# 中获取打开任务的方法。我一直在谷歌上搜索，只能找到如何获取**进程**列表。我想要唯一会显示在任务栏上的任务。

此外，除此之外，如果我能获得与任务相关联的流程，那就太酷了。如果可能的话，获取 Vista 用于 ALT-TAB 菜单的缩略图，如下图所示：

[![alt-tab](https://i.stack.imgur.com/CcPQP.png)](https://i.stack.imgur.com/CcPQP.png)

我假设我将不得不使用 pinvokes，因为看起来确实没有任何库可以做到这一点。有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-21T22:51:07.697

从 API (Win32) 的角度来看，没有任务之类的东西（至少不是 Windows 任务管理器/Alt-Tab 显示的那个）。

这些“任务”实际上是顶级窗口。

因此，为了获得这些列表，您需要[枚举窗口](http://msdn.microsoft.com/en-us/library/ms682615(VS.85).aspx)（这里是它的[PInvoke](http://www.pinvoke.net/default.aspx/user32/EnumDesktopWindows.html)）。

然后查看窗口的样式以确定它们是否实际上是顶级窗口。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-24T19:44:32.643

这篇文章应该会告诉你具体该怎么做，它展示了如何构建你自己的任务开关，并包含枚举所有窗口并确定它们是否是“任务”所需的代码，它展示了如何使用 PrintWindow api 来获取XP上的预览。

[http://msdn.microsoft.com/en-us/library/ms997649.aspx](http://msdn.microsoft.com/en-us/library/ms997649.aspx)

此外，还有[一篇博客文章](http://blogs.msdn.com/oldnewthing/archive/2007/10/08/5351207.aspx)讨论了用于确定 Alt+Tab 视图中显示内容的算法。基本上你需要检查 WS_EX_APPWINDOW 和 WS_EX_TOOLWINDOW 以及窗口是否有所有者。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T22:55:03.867

我没有尝试过，但我怀疑是这样的：

```
using System.Diagnostics;
static void MyFunc()
{
    Process[] processes = Process.GetProcesses();
    foreach(Process p in processes)
    {
       if (p.MainWindowHandle != 0)
       { // This is a GUI process
       }
       else
       { // this is a non-GUI / invisible process
       }
    }
} 
```

重点是检查每个进程是否有 WindowHandle。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T23:03:39.780

@abelenky17

我怀疑这不会涵盖所有情况，例如有些进程有几个顶级窗口（都出现在任务管理器中）。例如：FireFox、Windows Explorer、IE 等……这些应用程序可以在桌面上有多个窗口。此外，它不会正确处理终端会话场景（因为您枚举了系统中运行的所有进程）。

@丹·C。

做这样的事情：

```
p.ProcessName != "explorer" 
```

你觉得还可以吗？真难闻。

# asp.net - 在 ASP.NET 中使用无序列表设置导航样式的最佳方法

> ID：310458
> 
> 赞同：2
> 
> 时间：2008-11-21T22:44:30.347
> 
> 标签：asp.net, css

在 ASP.NET（不是 MVC）中，以编程方式在用于导航的无序列表上设置样式的最佳方法是什么，以便在查看该页面时将适当的菜单项设置为活动项？

这很可能与 MasterPage 结合使用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T22:52:18.820

您的问题的答案在很大程度上取决于您如何实现列表{用户控制与否等}。我会怎么做，是实现由用户控件生成的列表。

我会为每个元素添加 UserControl 标记，例如：

```
<{...} class="GeneratedMenuItem"> {...} 
```

我会在样式表中有适当的样式；当然，如果它在用户控件中，那么您也许可以使用主题（但这取决于您使用的 ASP.net 版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T23:16:31.500

好问题，自从 asp 的糟糕日子以来，我一直在尝试各种方法来做到这一点，但还没有找到完美的锤子。

通常，我使用 Request.Url.AbsoluteUri （或类似的）作为渲染函数的参数，并且通常在适当的节点上设置“当前”或类似的 css 类，以及根据需要渲染子节点.

我最常使用 xml/xsl 组合，它通常可以在大多数 cms 平台上工作，尽管我从未对启动 xsl 转换以输出导航列表的开销感到满意，但如果你知道 xsl，是一个非常好的生成 html 的工具，并且你总是可以缓存输出 - 对于偶尔出现的小静态 html 站点，我经常在构建过程中使用这种方法来呈现静态菜单标记。

还使用过几次 aspnet 站点地图功能，如果您使用 css 友好的适配器，这非常好 - 默认渲染会产生非常难看的标记。

我在本周早些时候发现了这篇文章：[http](http://blog.devarchive.net/2008/01/auto-generate-strong-typed-navigation.html) ://blog.devarchive.net/2008/01/auto-generate-strong-typed-navigation.html它使用 t4 模板制作强类型导航类，我肯定会进一步调查。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T23:23:54.060

我采用这种方法的方式是为母版页中的每个导航项创建 ASP.NET 超链接控件。

然后，在母版页中，我创建了一个公共方法，它将适当的“选定”CSS 样式分配给我指定的控件：

```
Public Sub SetNavigationPage(ByVal MenuName As String)

   DirectCast(Me.FindControl(MenuName), HyperLink).CssClass = "MenuCurrent"

End Sub 
```

然后在我的内容页面中，我只需要相应地引用母版页。

```
Dim myMaster As EAF = DirectCast(Me.Master, EAF)
myMaster.SetNavigationPage("hypSearchRequest") 
```

这使我可以灵活地在各个页面上添加/删除导航项，并且还能够在必要时将多个页面分配给管理员导航选项。

值得注意的是，引用超链接控件和设置 Visibility 属性（用于隐藏管理页面）不起作用。这是由于主页面和内容页面的加载顺序。相反，我创建了另一个 CSS 类，它简单地设置了可见性属性并使用了与上面相同的方法。

# python - 为 numpy.array 的每个元素添加维度

> ID：310459
> 
> 赞同：5
> 
> 时间：2008-11-21T22:44:41.737
> 
> 标签：python, arrays, numpy

我正在尝试将 numpy 数组的每个元素转换为数组本身（例如，将灰度图像解释为彩色图像）。换句话说：

```
>>> my_ar = numpy.array((0,5,10))
[0, 5, 10]
>>> transformed = my_fun(my_ar)  # In reality, my_fun() would do something more useful
array([
      [ 0,  0, 0], 
      [ 5, 10, 15], 
      [10, 20, 30]])
>>> transformed.shape
(3, 3) 
```

我试过了：

```
def my_fun_e(val):
    return numpy.array((val, val*2, val*3))

my_fun = numpy.frompyfunc(my_fun_e, 1, 3) 
```

但得到：

```
my_fun(my_ar)
(array([[0 0 0], [ 5 10 15], [10 20 30]], dtype=object), array([None, None, None], dtype=object), array([None, None, None], dtype=object)) 
```

我试过了：

```
my_fun = numpy.frompyfunc(my_fun_e, 1, 1) 
```

但得到：

```
>>> my_fun(my_ar)
array([[0 0 0], [ 5 10 15], [10 20 30]], dtype=object) 
```

这很接近，但并不完全正确——我得到了一个对象数组，而不是一个整数数组。

**更新3！**好的。我事先已经意识到我的示例太简单了——我不只是想在三维中复制我的数据，我还想同时对其进行转换。也许这更清楚？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-24T04:45:11.210

numpy.dstack 做你想做的事吗？前两个索引与原始数组相同，新的第三个索引是“深度”。

```
>>> import numpy as N
>>> a = N.array([[1,2,3],[4,5,6],[7,8,9]])
>>> a
array([[1, 2, 3],
       [4, 5, 6],
       [7, 8, 9]])
>>> b = N.dstack((a,a,a))
>>> b
array([[[1, 1, 1],
        [2, 2, 2],
        [3, 3, 3]],

       [[4, 4, 4],
        [5, 5, 5],
        [6, 6, 6]],

       [[7, 7, 7],
        [8, 8, 8],
        [9, 9, 9]]])
>>> b[1,1]
array([5, 5, 5]) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-25T21:06:54.410

使用 map 将转换函数应用于 my_ar 中的每个元素：

```
import numpy

my_ar = numpy.array((0,5,10))
print my_ar

transformed = numpy.array(map(lambda x:numpy.array((x,x*2,x*3)), my_ar))
print transformed

print transformed.shape 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T22:59:33.327

我提议：

```
 numpy.resize(my_ar, (3,3)).transpose() 
```

您当然可以调整形状`(my_ar.shape[0],)*2`或其他任何东西

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-22T05:03:33.077

这是否符合您的要求：

```
tile(my_ar, (1,1,3)) 
```

# workflow - 单个工作流可以生成多个列表项吗？

> ID：310469
> 
> 赞同：1
> 
> 时间：2008-11-21T22:48:27.983
> 
> 标签：workflow, sharepoint-designer

我想要一个工作流，当在列表 A 中创建条目时，将为列表 C 中的每个条目在列表 B 中生成一个条目。这可能吗？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T12:24:50.393

创建一个工作流并与列表 A 关联。每当将新条目添加到列表 a 时，此工作流被踢出
On this event from the **Context** find list C and get all list.Items 然后在每个列表项上运行 foreach 并在其中插入一个条目清单 B

告诉我这是否适合你

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-24T01:37:36.653

您不能在使用 Sharepoint Designer 构建的工作流中使用 foreach（据我所知）。要执行您需要的操作，需要在 Visual Studio 中开发自定义工作流。我最近不得不自己走这条路，并没有我预期的那么糟糕。

[Robert Shelton 的博客](http://rshelton.com)上有一些很棒的演练视频，这些视频帮助我入门。

如果您的 MOSS 2007 开发环境是 64 位的（就像我的一样），那么您可能会在尝试使用 Visual Studio 2008 创建和调试工作流时遇到问题。在这种情况下，我建议您使用 WSPBuilder 来帮助您轻松打包工作流部署到 Sharepoint。这里有一篇关于使用[WSP Builder的好帖子](http://www.zimmergren.net/archive/2009/04/08/wspbuilder-walkthrough-of-the-visual-studio-add-in.aspx)

希望这可以帮助。

# firewall - 您是否需要在仅限服务器的防火墙上进行深度数据包检查？

> ID：310476
> 
> 赞同：1
> 
> 时间：2008-11-21T22:52:10.130
> 
> 标签：firewall, security, packet, inspection

我在防火墙后面有一台服务器。它运行一个 Web 应用程序（Apache Tomcat 下的 Java servlet）并且只响应端口 443 (HTTPS)。提供的页面中没有脚本代码 - 表单使用 HTTP POST 接收表单，处理数据（使用适当的输入过滤），然后输出 HTTP 结果页面。

我目前正在使用设备防火墙，但它是“硬件-flakey”。我一直在考虑升级到更“工业实力”的解决方案，但供应商非常坚持要我购买他们的“深度数据包检测”软件的订阅。他声称即使是网络服务器也需要这种保护。

我不相信，但没有安全背景可以确定。防火墙将位于“世界”和我的服务器之间，并使用“端口转发”仅允许端口 443 和 22（用于维护）到达服务器。

那么 - 我真的需要这种深度数据包检查吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T11:55:53.447

鉴于您感兴趣的唯一协议（ssh 和 https）是“在连接时协商加密”，此后标准防火墙几乎无法检查。一旦建立 SSL/SSH 会话，防火墙将只看到加密的数据包。询问您的供应商他们的产品在这种情况下检查了什么。

或者，该设备可能更像一个代理——它在中继到你的真实服务器之前充当连接的服务器端端点——在这种情况下，产品可能会做一些更深层次的事情，尽管如果防火墙真的像您所说的那样是“端口转发”，则情况并非如此。同样，您的供应商应该能够解释他们的设备是如何运行的。

此外，您可能想询问检查系统旨在防止哪些漏洞/风险。例如：它会注意 SQL 注入吗？它是否针对特定平台？（例如，如果您的 Web 服务器在 SPARC CPU 上运行，那么检查 x86 shellcode 的 URL 就没有什么意义了）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T04:38:13.957

作为一名网络安全专家，这对我来说听起来有点矫枉过正。

Martin Carpenter 的回答是 100% 达标。每当您考虑安全性时，您都需要了解

*   你要保护的东西，
*   你要保护它*的*东西，
*   攻击的可能性，以及
*   如果攻击成功，您的风险。

对于您的应用程序，它只允许在 2 个端口上进行加密、经过身份验证的通信，我只能看到几个漏洞：

*   除非您的防火墙阻止这些攻击，否则拒绝服务 (DOS) 始终是一种威​​胁。
*   您可能有其他应用程序正在侦听其他端口，但您可以使用任何简单的端口扫描程序来检测它们。
*   您可能希望限制*出站*通信以防止用户或恶意应用程序向未经授权的服务器*发起通信。*

我也同意向供应商询问“深度数据包检查”对他意味着什么以及为什么您的特定情况需要它是一个好主意。除非你得到一个具体的、知识渊博的答案，用*外行的话来说*，这*对你来说是有意义*的，否则我会去其他地方。网络安全没有什么是不能简单解释的，没有流行语。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-04T22:10:59.397

在几个方面更新...

首先 - 我现在有理由相信 OTS 硬件产品的部分缺陷是 CPU 低功耗和缓冲内存不足的组合。在数周的日志记录和几次崩溃中，崩溃前的日志中没有任何条目，但我正在根据日志控制记录所有内容。与另一家防火墙供应商交谈时，有人指出，在大量使用期间，缓冲区的填充速度可能比清空速度快。这与调查结果相符 - 最常用的 IP 是最常崩溃的 IP。

所以我检查了一下，防火墙确实打开了一些深度数据包检查功能。我已将其关闭以查看情况是否有所改善。

在我的网络场景中，防火墙的主要用途是“看门人”。也就是说，我希望防火墙阻止除 http、https 和某些 ssh 之外的所有流量超出 WAN 端口。由于防火墙内没有用户，因此从内部生成的任何流量都来自我的应用程序并且可以被允许出去。

与一个供应商的进一步会谈表明，他们不再需要深度数据包检查 - 另一个人只是想在有问题的设备上向我“追加销售”。我还发现，如果不花很多钱，他们的硬件并不能真正满足我的所有需求。

我现在正在认真探索使用 OpenBSD 和 PF 防火墙以经济高效的方式完成我所要求的工作。

# objective-c - 可可开发的良好数据库库/ORM

> ID：310479
> 
> 赞同：5
> 
> 时间：2008-11-21T22:53:24.057
> 
> 标签：objective-c, database, cocoa

我正在开发一个可可应用程序，它将大量使用 Web 服务和标准 dbms（很可能是 MySQL），我想知道是否有人对他们使用的数据库库或 ORM 解决方案有一个好的选择。由于需要支持标准 DBMS 并能够在正常应用程序操作之外修改数据，因此不能选择 CoreData。

我从新的开源库中找到了许多可能的选项：http: [//github.com/aptiva/activerecord/tree/master](http://github.com/aptiva/activerecord/tree/master)

为 C MySQL api 编写我自己的包装器。

欢迎任何建议，

谢谢！

保罗

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-22T08:54:40.707

当我们第一次开始使用[Checkout](http://checkoutapp.com)时，我们遇到了类似的问题，我们的解决方案是使用 PyObjC 用 Python 编写整个应用程序。Checkout 1 有一个 sqlite 后端，Checkout 2 有一个 postgres 后端。

Pyton 方面有几个非常成熟和强大的 ORM，例如[SQLObject](http://www.sqlobject.org/)，它使用起来非常简单（我们在 Checkout 1.0 中使用它）和[SQLAlchemy](http://www.sqlalchemy.org/)，它更强大但更难绕开你的大脑（我们将其用于 Checkout 2.0）。

您可以评估的一种方法是在 Objective-C 中构建应用程序，但在 Python 中编写数据模型和数据库连接/管理代码。您可以使用 PyObjC 从此代码创建一个插件包，然后将其加载到您的应用程序中，这个 CLI 工具依次加载到一个 Python 插件包中，其中包含所有实际的数据库代码。最终用户大多通过 System Preferences 窗格与数据库交互，该窗格不知道数据库的外观，而是使用命令行工具与其交互。

加载插件很简单：

```
NSBundle *pluginBundle = [NSBundle bundleWithPath:pluginPath];
[pluginBundle load]; 
```

You will probably need to create .h files for the classes in your bundle that you want to have access to from your Obj-C code.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-22T23:37:43.623

您可能还想查看[BaseTen 框架](http://basetenframework.org/)。它是一个类似 Core Data 的框架（实际上，它可以导入 Core Data 模型），但可以与 PostgreSQL 一起使用（据我所知，虽然不是 MySQL）。它包括一些非常好的功能，例如运行时的模式发现。它还包括一个 NSArrayController 子类，可以自动处理多个用户之间的锁定和同步，因此您可以继续在您的 UI 中使用 Apple 的键值绑定。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T00:24:33.377

我对这个特殊问题有个人经验。我什至开始为 C MySQL API 编写自己的包装器。

最终的结论是：不要！

对我来说有效的解决方案是通过 PHP 与 MySQL 服务器通信。如果您熟悉 Web 服务，那么您很可能了解 PHP，因此我不会对此进行详细介绍。

从数据库中读取：

1.  可可应用程序在服务器上发送一个 URL 请求：http://theserver.com/app/get_values.php
2.  get_values.php 脚本处理数据库查询，并以 xml 格式返回数据
3.  可可应用程序加载并解析 xml

要写入数据库：

1.  可可应用程序向服务器发送更复杂的请求：http://theserver.com/app/put_values.php?name="john doe"&age=21&address=...
2.  put_values.php 脚本解析输入并写入数据库

这个解决方案的美妙之处在于 PHP 非常适合与 MySQL 一起工作，而 cocoa 有一些方便的内置类来处理 XML 数据。

**编辑：**还有一件事：

使用这种方法您必须弄清楚的关键事情之一是应该在服务器上完成多少处理，以及应该在应用程序本身中完成多少。让可可做可可擅长的事情，让PHP和MySQL做自己擅长的事情。

您可以编写一个通用的 PHP 脚本来处理*所有*查询：perform_query.php?querystring="SELECT * FROM ....."，但这并不是最佳解决方案。您最好的选择是几个较小的 PHP 脚本，它们可以为您处理单个数据集。在我的例子中，有一个获取用户列表，一个获取交易列表，等等。同样，这完全取决于你的应用程序要做什么。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-22T00:17:55.587

[GDL2](http://www.gnustep.org/resources/documentation/Developer/GDL2/GDL2.html)是一个很好的例子，它基于 EOF。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-22T04:17:44.853

[您可以尝试使用SMySQL](http://mysql-cocoa.sourceforge.net/)框架（又名 MCPKit），而不是通过编写自己的通信包装器来处理来自 Cocoa 的 MySQL 来重新发明轮子，它是演变成[Sequel Pro](http://code.google.com/p/sequel-pro/)项目的 CocoaMySQL 应用程序的一部分。它适用于不同版本的 MySQL，并且看起来非常健壮。

如果您需要了解如何将其合并到您的应用程序中，没有太多的文档，但它有一个易于理解的界面，您可以通过查看 Sequel Pro 的源代码来了解它的工作原理，该源代码可从 Google 代码下载。

还有 CocoaMySQL 项目的[CocoaMySQL-SBG](http://bitbucket.org/glennsb/cocoamysql-sbg/)分支，但这似乎已经过时，我无法正确构建它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-22T17:49:03.767

我还实现了一个基于 sqlite 的简单对象持久化框架，但这当然不是一件容易的事。我同意 eJames 的结论——如果你不需要，不要自己实现。

如果您不致力于使用 Objective-C 进行编程，您可能想看看 PyObjC，它允许您使用 Python 对数据库部分进行编程。您可以使用 MySQLdb 模块进行数据库访问，并且有大量在线教程供您使用。将数据填充回 Cocoa/CF 类并将它们传递回您的应用程序并不难。

PyObjC 的主要警告是目前它不适用于 Tiger。

# jms - JMS/DDS 集成

> ID：310490
> 
> 赞同：4
> 
> 时间：2008-11-21T22:58:43.313
> 
> 标签：jms, data-distribution-service

我有一个使用[DDS](http://portals.omg.org/dds)进行异步通信/消息传递的遗留 C++ 应用程序。我需要将此应用程序集成到使用 JMS 进行消息传递的 JavaEE 环境中。除了构建独立的 JMS/DDS 桥接模块之外，我还有其他选择吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-11T16:17:53.770

如果您想继续使用您现有的 DDS 产品，那么您最好的选择几乎肯定是定制桥接器。当前的 DDS 实现通常在消息级别上无法互操作，甚至在 QoS 级别上也无法实现。

要使用 RTI Message Service 之类的东西，您必须使用 RTI DDS。如果您碰巧已经在使用该特定产品，这可能是您的一个选择。否则，我建议编写一个明确发布和订阅您感兴趣的主题的桥梁。

请记住，JMS 没有 DDS 所具有的丰富的 QoS 集。除了最简单的情况外，所有情况下都需要弄清楚您对主题的真正期望，并明确确定如何使用 JMS 来实现它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T01:30:58.593

好吧，谷歌第一次点击“DDS 到 JMS 桥”带来了一篇论文，其中提到了一个商业产品：[RTI 消息服务](http://www.rti.com/products/jms/)

根据论文和产品页面，这似乎可以满足您的需求。有免费评估（当然，以销售电话为模。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-24T16:15:31.520

您可以尝试创建一个 DDS 实现，它只委托给 JMS 提供者的 C++ API，例如使用与[Apache ActiveMQ](http://activemq.apache.org/)配合得很好的[Apache CMS API](http://activemq.apache.org/cms/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-01-03T19:53:13.457

RTI 还提供了一个单独的 DDS 到 JMS 的双向桥接器。该产品称为 Connext Integrator

# ruby-on-rails - 在 Rails 中，使用基于 cookie 的会话存储，会话和 cookie 是一回事

> ID：310505
> 
> 赞同：2
> 
> 时间：2008-11-21T23:04:39.917
> 
> 标签：ruby-on-rails, http

我一直在使用基于 cookie 的会话存储，直到现在才知道[Cookie 。](http://api.rubyonrails.com/classes/ActionController/Cookies.html)那么在任何情况下我都需要 cookie 散列吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-23T15:42:45.347

cookie 哈希在 Rails 应用程序中绝对有价值。 **您应该使用 cookie 在客户端存储您希望在会话之间记住的值。**

“记住我”令牌就是一个很好的例子。如果您想允许用户在访问您的网站时自动登录，只需存储一个具有一些用户防篡改值的持久 cookie（例如映射到该用户在您的数据库中的行的唯一哈希或 guid（好），但是不像只使用普通的旧整数用户 ID（坏）那样可破解。然后，当用户访问您的站点时，您可以检查 cookie 哈希以获取记住我的令牌，如果找到，则在您的数据库中查找并在找到匹配项时登录用户。这是一种非常普遍的做法。

如果您需要/想要在客户端 cookie 中存储纯文本值，但不希望用户能够使用这些值，只需将该值的散列存储在伴随 cookie 中，并用一些未知值对散列加盐给用户。然后，您只需要计算从客户端 cookie 接收到的明文值的加盐哈希值，并将其与也从客户端 cookie 传递的哈希值进行比较。如果它们匹配，您可以信任它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-31T02:12:11.293

any situation that might use a cookie seems to be equally well served by the cookie session store. the rails cookie session store is secure in the sense that the end-user can read the session data but cannot modify it.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-25T23:28:17.137

是的，在考虑如何实现 OpenID 登录时记住我时，我对会话与 cookie 的关系感到非常困惑……这实际上与基于密码的登录没有什么不同。但这不是我的代码，它来自 restful-authentication 插件，没有什么比你自己思考整个过程更好的了。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-21T23:20:23.503

您不应该在 cookie 中存储您不希望用户看到或更改的任何内容。如果您存储成员 ID，则用户可以轻松更改值并假装是其他人。Cookie 也会随每个请求发送到您的 Web 服务器，包括图像、JS 和 CSS 请求。如果您在 cookie 中存储大量信息，这可能会影响速度。

基于 Cookie 的会话（在一般情况下，我不能说我知道 Rails 做了什么）意味着您的会话变量与随机生成的会话 ID 相关联。此 ID（并且只有 ID）作为 cookie 返回给用户。这允许您将用户请求（因为您有会话 ID cookie）与用户的会话相关联。这更安全，因为某人很难猜出另一个用户会话的 ID。

# objective-c - 如果不是最前面的窗口，NSBorderlessWindowMask 窗口将不会显示 NSPanels

> ID：310511
> 
> 赞同：1
> 
> 时间：2008-11-21T23:07:02.173
> 
> 标签：objective-c, cocoa

我有一个用 NSBorderlessWindowMask 和 kCGDesktopWindowLevel 设置的窗口。当一个 NSPanel 应该从 Dock 图标菜单或状态栏项目菜单的选择中出现时，如果应用程序不是最前面的窗口，则 NSPanel 将不会显示。

所以这个程序此时只有一个状态菜单项（想想 QuickSilver 是如何实现的），当我从我的菜单中选择首选项时，它被设置为使用 Makekeyandorderfront 显示首选项面板，但是除非你刚刚启动应用程序并且什么也没做否则，当您选择首选项时，没有任何反应。

我发现当我为 Sparkle 的 Check for Updates 选择菜单项时，会出现检查更新面板，然后会出现我告诉打开的首选项面板。

所以看起来 makekeyandorderfront 并没有真正把它带到前面，也许。

有谁知道如何解决这一问题？我应该调用 makekeyandorderfront 之外的其他东西，或者与它一起调用的东西吗？

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T23:14:22.987

默认情况下，面板设计为以这种方式工作。它们被设计为您的应用程序的辅助窗口，并且在应用程序停用时始终消失。您可能还会遇到面板成为关键的问题......但要解决您消失的面板问题，请将此消息发送到您的面板：

```
[panelObject setHidesOnDeactivate:NO]; 
```

您可能应该在这里使用实际的 NSWindow 对象而不是 NSPanel 对象，但由于我不太了解您的应用程序是如何工作的，因此您必须自己研究一下。有关面板和窗口之间区别的更多信息，请查看此处的文档：[窗口编程指南](http://developer.apple.com/documentation/Cocoa/Conceptual/WinPanel/Concepts/UsingPanels.html#//apple_ref/doc/uid/20000224)

# vb.net - PropertyInfo.GetValue() "对象与目标类型不匹配。"

> ID：310518
> 
> 赞同：7
> 
> 时间：2008-11-21T23:10:55.940
> 
> 标签：vb.net, reflection, propertyinfo

我第一次深入研究反射，我真的被困住了。我用谷歌搜索了我能想到的一切。我现在想去的地方有 90%。

我正在尝试通过反射返回自定义类中的属性值。

这是我的班级声明：

```
Public Class Class2
    Private newPropertyValue2 As String

    Public Property NewProperty2() As String
        Get
            Return newPropertyValue2
        End Get
        Set(ByVal value As String)
            newPropertyValue2 = value
        End Set
    End Property   
End Class 
```

我编写的通过反射查看类的类如下所示：

```
Public Class ObjectCompare
    Private _OriginalObject As PropertyInfo()

    Public Property OriginalObject() As PropertyInfo()
        Get
            Return _OriginalObject
        End Get
        Set(ByVal value As PropertyInfo())
            _OriginalObject = value
        End Set
    End Property

    Public Sub CompareObjects()
        Dim property_value As Object

        For i As Integer = 0 To OriginalObject.Length - 1
            If OriginalObject(i).GetIndexParameters().Length = 0 Then
                Dim propInfo As PropertyInfo = OriginalObject(i)

                Try
                    property_value = propInfo.GetValue(Me, Nothing)
                Catch ex As TargetException
                End Try   
            End If
        Next
    End Sub
End Class 
```

我在 property_value = propInfo.GetValue(Me, Nothing) 行上放了一个断点，看看结果是什么。

这是我如何调用我的代码：

```
Dim test As New Class2
test.NewProperty2 = "2"

Dim go As New ObjectCompare
Dim propInf As PropertyInfo()
propInf = test.GetType.GetProperties()

go.OriginalObject = propInf

go.CompareObjects() 
```

通过反射我可以看到PropertyName和Type，我需要的只是Property的值！现在，当我到达断点时，我得到一个 TargetException 并且错误消息显示“对象与目标类型不匹配”。现在是凌晨 1 点，我很伤心，现在有任何帮助将不胜感激。我已经搜索了 MSDN 和 Google 到死，然后最后一次寻找乐趣；）

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-22T00:41:45.477

`Me`指的是`ObjectCompare`对象，它不同于`PropertyInfo`派生对象的类 ( `Class2`)。您还需要传入您从中检索对象的类型的`PropertyInfo`对象。

```
Public Sub CompareObjects(ByVal It as Object)
    Dim property_value As Object

    For i As Integer = 0 To OriginalObject.Length - 1
        If OriginalObject(i).GetIndexParameters().Length = 0 Then
            Dim propInfo As PropertyInfo = OriginalObject(i)

            Try
                property_value = propInfo.GetValue(It, Nothing)
            Catch ex As TargetException
            End Try   
        End If
    Next
End Sub

go.CompareObjects(test) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T00:49:35.633

我不太确定我知道你想在这里做什么，但我会试一试。

这是我提出的代码：

**来电**：

```
 Dim test As New Class2
        test.NewProperty2 = "2"

        Dim go As New ObjectCompare
        go.CompareObjects(test) 
```

**类**：

```
Public Class Class2
    Private newPropertyValue2 As String

    Public Property NewProperty2() As String
        Get
            Return newPropertyValue2
        End Get
        Set(ByVal value As String)
            newPropertyValue2 = value
        End Set
    End Property
End Class 
```

**比较**：

```
 Public Class ObjectCompare

    Public Sub CompareObjects(ByVal MyType As Object)

        For Each Prop In MyType.GetType().GetProperties()
            Dim value = Prop.GetValue(MyType, Nothing)
            Console.WriteLine(value)
        Next
        Console.ReadLine()
    End Sub
End Class 
```

# java - Java 混淆器

> ID：310533
> 
> 赞同：16
> 
> 时间：2008-11-21T23:21:50.070
> 
> 标签：java, obfuscation

我正在寻找一个好的 Java 混淆器。

我对以下 Java 混淆器进行了初步研究：proguard、yguard、retroguard、dasho、allatori、jshrink、smokescreen、jobfuscate、marvin、jbco、jode、javaguard、jarg、joga、cafebabe、donquixote、mwobfu、bbmug、zelix klassmaster 、sandmark、jcloak、thicket、blufuscator 和 java 代码保护器。

我尝试了 proguard，它有一个非常好的 GUI，看起来非常稳定，并且似乎是最受欢迎的，但它似乎不像引用的 jar 文件（不在我试图混淆的代码中）的一些枚举，这很奇怪. Yguard 似乎需要与 ant 进行一些交互，我对此不太了解。

什么是好的 java 混淆器？它不需要是免费的，它只需要运行良好并且易于使用。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-22T00:13:19.000

我在所有发布版本中大量使用[ProGuard](http://proguard.sourceforge.net)，我发现它非常棒。我不能推荐它！

我*曾多次*遇到由它的优化引起的模糊错误，现在我全面禁用优化 - 从那以后就没有出现过由 ProGuard 引起的问题。不过，公平地说，这些都是以前的版本——YMMV。

*我以前只*使用 GUI来启动一个配置，然后我求助于自己编辑文本配置，这真的很简单。这些天我手动进行配置。

我有相当复杂的项目，所有这些项目都涉及动态加载和反射。我还大量使用反射来实现回调。ProGuard 很好地应对了这些问题。

编辑：我们还将 DashO Pro 用于我们的一种产品——我研究了它来包装我负责的产品，并得出结论认为它的配置过于复杂和复杂；也将它集成到构建脚本中似乎有点痛苦。但同样，公平地说，这是大约 2001 年......所以在当前版本中可能会更好。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-11-12T22:56:46.050

这篇文章中提供了大量免费和商业工具的链接

[“保护您的 Java 代码 - 通过混淆器及其他方式”](http://www.excelsior-usa.com/articles/java-obfuscators.html)

作者还讨论了字节码混淆的优缺点

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-21T23:28:50.243

ProGuard 有什么问题？[（这个问题](https://stackoverflow.com/questions/150653)和[这个](https://stackoverflow.com/questions/93290/best-java-obfuscation-application-for-size-reduction)问题都推荐）。

有一段关于枚举器的[故障排除](http://proguard.sourceforge.net/manual/troubleshooting.html)，但它们似乎被考虑[得很好](http://proguard.sourceforge.net/manual/examples.html#enumerations)。

然而，混淆破坏了一些反射尝试，即使现代混淆器可以检测并在某种程度上调整它们混淆的代码中的反射用法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-22T02:13:33.250

我在商业应用程序中使用了 Zelix Klassmaster 几年，发现它非常出色。我在混淆代码中投入了很多资源，但无法“破解”它。它很贵，但很好。

当我的版本足够老以至于升级成本很高时，我才停止使用它。我的需求发生了变化，我真的不需要再混淆这些类了。但是，如果再次出现需要，我会付钱并立即使用它。

干杯，

-理查德

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-27T20:33:37.643

我们使用 Zelix Klassmaster 已有几年了，我可以推荐它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-08-06T23:55:12.963

我使用并建议[Zelix](http://www.zelix.com) - 100% - 非常坚固和强大的保护

# database - 在数据库 (RDBMS) 中存储邮政地址的最佳实践？

> ID：310540
> 
> 赞同：121
> 
> 时间：2008-11-21T23:28:30.883
> 
> 标签：database, database-design, types, street-address, postal-code

对于在 RDBMS 中存储邮政地址的最佳实践，是否有任何好的参考？似乎有很多权衡可以做出，并且每个都需要评估很多优点和缺点 - 当然这已经一次又一次地完成了？也许有人至少在某处写过一些经验教训？

我正在谈论的权衡示例是将邮政编码存储为整数与字符字段，应将门牌号存储为单独的字段或地址行 1 的一部分，应将套房/公寓/等编号标准化还是仅存储为地址第 2 行中的一大段文本，你如何处理 zip +4（单独的字段或一个大字段，整数与文本）？等等

在这一点上，我主要关心的是美国地址，但我想有一些最佳实践可以让自己为走向全球的可能性做好准备（例如，适当地命名字段，如地区而不是州或邮政编码而不是邮政编码，等等

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2015-01-17T02:08:06.033

对于更国际化的使用，要考虑的一种模式是[Drupal Address Field](https://www.drupal.org/project/addressfield)使用的模式。它基于[xNAL 标准](http://xml.coverpages.org/xnal.html)，似乎涵盖了大多数国际案例。对该模块进行一些深入研究将揭示一些用于解释和验证国际地址的好方法。它还有一组带有 ISO 代码的漂亮行政区域（省、州、州等）。

这是从模块页面复制的架构的要点：

```
country => Country (always required, 2 character ISO code)
name_line => Full name (default name entry)
first_name => First name
last_name => Last name
organisation_name => Company
administrative_area => State / Province / Region (ISO code when available)
sub_administrative_area => County / District (unused)
locality => City / Town
dependent_locality => Dependent locality (unused)
postal_code => Postal code / ZIP Code
thoroughfare => Street address
premise => Apartment, Suite, Box number, etc.
sub_premise => Sub premise (unused) 
```

我学到的一个教训：

*   不要以数字形式存储任何内容。
*   尽可能将国家和行政区域存储为 ISO 代码。
*   如果您不知道，请在要求字段方面松懈。某些国家/地区可能不会使用您认为理所当然的字段，甚至是`locality`&之类的基本内容`thoroughfare`。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-11-22T01:28:19.517

作为“国际”用户，没有什么比处理一个仅针对美国格式地址的网站更令人沮丧的了。起初这有点粗鲁，但当验证也过于热心时，它就变成了一个严重的问题。

如果你关心走向全球，我唯一的建议就是保持自由形式。不同的国家有不同的约定——在某些情况下，门牌号在​​街道名称之前，在某些情况下在之后。有些有州，一些地区，一些县，还有这些的一些组合。在英国，邮政编码不是邮政编码，而是包含字母和数字的邮政编码。

我建议只使用大约 10 行可变长度字符串，以及一个单独的邮政编码字段（并注意如何描述它以应对国家敏感性）。让用户/客户决定如何写他们的地址。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2010-09-13T07:33:22.887

如果您需要有关其他国家/地区如何使用邮政地址的全面信息，这里有一个非常好的参考链接（哥伦比亚大学）：

[**弗兰克的邮政地址强制性指南**](http://www.columbia.edu/kermit/postal.html)
*国际邮件的有效寻址*

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-11-21T23:53:27.867

您绝对应该考虑将门牌号存储为字符字段而不是数字，因为特殊情况，例如“半数”或我当前的地址，例如“129A”——但 A 不被视为公寓送货服务号码。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-06-09T00:31:54.173

我已经这样做了（在数据库中严格建模地址结构），我再也不会这样做了。您无法想象作为规则必须考虑的例外情况有多疯狂。

我隐约记得挪威邮政编码的一些问题（我认为），它们都是 4 个位置，除了奥斯陆，它有 18 个左右。

我敢肯定，从我们开始为我们自己的所有国家地址使用地理上正确的邮政编码的那一刻起，相当多的人开始抱怨他们的邮件来得太晚了。原来这些人住在邮政区之间的边界附近，尽管有人真的住在邮政区，比如 1600，但实际上他的邮件应该寄往 1610 邮政区，因为实际上是相邻的邮政区这实际上为他服务，因此将他的邮件发送到他正确的邮政区域将需要几天的时间才能到达，因为正确的邮政局需要不必要的干预才能将其转发到不正确的邮政区域......

（我们最终用 ISO 代码“ZZ”注册了这些人在国外的地址。）

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-11-21T23:46:24.263

您当然应该咨询“[这是在关系数据库中对地址信息建模的好方法吗](https://stackoverflow.com/questions/307027)”，但您的问题不是直接重复。

肯定有很多预先存在的答案（例如，查看[DatabaseAnswers](http://www.databaseanswers.com/)上的示例数据模型）。许多预先存在的答案在某些情况下是有缺陷的（根本没有选择 DB Answers）。

要考虑的一个主要问题是地址的范围。如果您的数据库必须处理国际地址，那么您必须比只处理一个国家的地址更灵活。

在我看来，记录地址的“地址标签图像”并单独分析内容*通常*（并不意味着*总是）是明智的。*这使您可以处理邮政编码位置之间的差异，例如不同国家之间的差异。当然，您可以编写一个分析器和一个格式化程序来处理不同国家的怪癖（例如，美国地址有 2 或 3 行；相比之下，英国地址可以有更多；我定期写信的一个地址有 9 行）。但是让人类进行分析和格式化并让 DBMS 只存储数据会更容易。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-11-22T00:07:07.873

除非您要对街道号码或邮政编码进行数学运算，否则您只会通过将它们存储为数字来招致未来的痛苦。

您可能会在这里和那里节省一些字节，并且可能会获得更快的索引，但是当美国邮政或您正在处理的任何其他国家/地区决定在代码中引入字母时，您会怎么做？

磁盘空间的成本将比稍后修复它的成本便宜很多...... y2k有人吗？

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-11-22T00:09:12.737

补充@Jonathan [Leffler](https://stackoverflow.com/users/15168/jonathan-leffler)和@Paul [Fisher](https://stackoverflow.com/users/39808/paul-fisher)所说的

如果您预计将加拿大或墨西哥的邮政地址添加到您的要求中，`postal-code`则必须将其存储为字符串。加拿大有字母数字邮政编码，我不记得墨西哥在我脑海中的样子。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2013-02-19T09:41:38.397

我发现列出从最小离散单元到最大的所有可能字段是最简单的方法。用户将填写他们认为合适的字段。我的地址表如下所示：

```
*********************************
  Field              Type
*********************************
  address_id (PK)    int
  unit               string
  building           string        
  street             string
  city               string
  region             string
  country            string
  address_code       string
********************************* 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-11-21T23:54:24.933

将 ZIP 存储为 NUMBER 或 VARCHAR 的“权衡”在哪里？这只是一个选择——这不是一种权衡，除非对双方都有好处，而你必须放弃一些好处才能获得其他好处。

除非 zips 的总和根本没有任何意义，否则 Zips 作为数字是没有用的。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-06-22T10:40:44.280

这可能有点矫枉过正，但如果您需要一个适用于多个国家/地区的解决方案，并且您需要以编程方式处理地址的某些部分：

您可以使用两个表来处理特定国家/地区的地址：一个具有 10 个 VARCHAR2 列、10 个数字列的通用表，另一个表将这些字段映射到提示，并具有将地址结构与国家/地区联系起来的国家/地区列。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-08-23T21:51:47.900

如果您必须验证地址或使用它来处理信用卡付款，您至少需要一些结构。自由格式的文本块不能很好地解决这个问题。

邮政编码是一个常见的可选字段，用于在不使用整个地址的情况下验证支付卡交易。所以有一个单独的、大尺寸的字段（至少 10 个字符）。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-01-15T12:37:18.153

受[数据库答案的启发](http://www.databaseanswers.org/data_models/customers_and_addresses/index.htm)

```
Line1
Line2
Line3
City
Country_Province
PostalCode
CountryId
OtherDetails 
```

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2010-09-13T07:43:57.683

我只是将所有字段放在一个大的 NVARCHAR(1000) 字段中，并带有一个 textarea 元素供用户输入值（除非您想对例如邮政编码进行分析）。如果您的地址不适合该格式（并且，您知道，还有美国以外的其他国家/地区），那么所有这些地址行 1、地址行 2 等输入都会非常烦人。

# windows - Windows：在什么情况下 SetEvent() 可能不会立即返回？

> ID：310548
> 
> 赞同：2
> 
> 时间：2008-11-21T23:32:45.803
> 
> 标签：windows

我有一个线程，当它的函数退出它的循环（退出由事件触发）时，它会进行一些清理，然后设置一个不同的事件让主线程知道它已经完成。

但是，在某些情况下，SetEvent() 在设置线程的“我完成”事件后似乎不会返回。

此线程是 DLL 的一部分，问题似乎发生在 DLL 已加载/附加、线程启动、线程结束以及 DLL 分离/卸载多次而应用程序在其间关闭后。在此问题发生之前必须重复此序列的次数是可变的。

如果您怀疑我知道我在说什么，我已经通过将 SetEvent() 调用与对 OutputDebugString() 的调用括起来来确定发生了什么。出现 SetEvent() 之前的输出。然后，等待线程产生指示事件已设置的输出。

但是，退出线程中对 OutputDebugString() 的第二次调用（在 SetEvent() 之后的那个）永远不会发生，或者至少它的字符串永远不会出现。如果发生这种情况，应用程序会在片刻后崩溃。

（请注意，对 OutputDebugString() 的调用是在问题开始发生后添加的，因此它不太可能挂在那里，而不是在 SetEvent() 中。）

我不完全确定导致崩溃的原因，但它发生在 SetEvent() 没有立即返回的同一个线程中（我一直在跟踪/输出线程 ID）。我想 SetEvent() 有可能最终返回，此时它返回的上下文已经消失/无效，但是什么会导致这样的延迟？

原来我看这段代码已经蒙了这么久，甚至没有想到去检查返回码。我今天已经看完了，所以我会在周一知道它返回了什么（*如果*它返回了），然后我将使用该信息编辑这个问题。

更新：我更改了（主）代码以等待线程退出而不是设置事件，并从从线程中删除了 SetEvent() 调用。这改变了 bug 的性质：现在，它没有从 SetEvent() 返回，而是根本不退出线程，整个事情都挂起。

这表明问题不在于 SetEvent()，而在于更深层次的问题。还不知道是什么，但最好不要追着那条死胡同。

更新（2009 年 2 月 13 日）：
事实证明，当我问这个问题时，问题比我想象的要深。jdigital（可能还有其他人）几乎解决了根本问题：我们试图卸载线程作为分离 DLL 过程的一部分。

正如我当时没有意识到的那样，但后来通过这里和其他地方的研究（例如 Raymond Chen 的博客）发现，这是一件非常糟糕的事情。

问题是，由于它的编码方式和行为方式，这并不明显是潜在的问题——它被伪装成我必须经历的各种其他不良行为。

这里的一些建议帮助我做到了这一点，所以我感谢所有做出贡献的人。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T23:56:49.640

谁在卸载 DLL，卸载在什么时间完成？我想知道这里是否存在时间问题，即在线程运行完成之前卸载 DLL。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T23:57:31.933

您是否取消引用 a`HANDLE *`传递给`SetEvent`？事件句柄引用更可能是无效的并且崩溃是访问冲突（即访问垃圾）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T04:08:08.727

您可能希望使用 WinDbg 来捕获崩溃并检查堆栈。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T04:30:48.493

为什么需要在从线程中设置一个事件来触发主线程线程完成？只需退出线程，调用主线程应该等待工作线程退出，例如伪代码 -

```
Master
{
   TerminateEvent = CreateEvent ( ... ) ;
   ThreadHandle = BeginThread ( Slave, (LPVOID) TerminateEvent ) ;
   ...
   Do some work
   ...
   SetEvent ( TerminateEvent ) ;
   WaitForSingleObject ( ThreadHandle, SOME_TIME_OUT ) ;
   CloseHandle ( TerminateEvent ) ;
   CloseHandle ( ThreadHandle ) ; 
}

Slave ( LPVOID ThreadParam )
{
   TerminateEvent = (HANDLE) ThreadParam ;
   while ( WaitForSingleObject ( TerminateEvent, SOME__SHORT_TIME_OUT ) == WAIT_TIMEOUT )
   { 
      ... 
      Do some work 
      ...
   }
} 
```

有很多错误条件和状态需要检查，但这是我通常如何做的本质。

如果你能掌握它，就得到这本书，当我很多很多年前第一次阅读它时，它改变了我在 Windows 开发方面的生活。

[高级 Windows：适用于 Windows Nt 3.5 和 Windows 95 的 Win32 Api 开发人员指南（平装本），作者：Jeffrey Richter（作者）](https://rads.stackoverflow.com/amzn/click/com/1556156774)

# vim - 有没有办法改变 vim 全功能菜单的行为？

> ID：310551
> 
> 赞同：15
> 
> 时间：2008-11-21T23:34:15.753
> 
> 标签：vim, menu, omnicomplete

Omnicompletion 正在工作，但它会自动插入第一个结果。

我想做的是打开全能菜单，然后能够键入以缩小结果范围，然后按 Enter 或制表符或空格或其他东西来插入选定的菜单项。

这可能吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-22T18:22:12.467

您正在寻找的命令是：

```
:set completeopt+=longest 
```

它将插入所有建议中最长的公共前缀，然后您可以键入和删除以缩小或扩大结果。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-29T10:40:35.597

```
set wildmenu
set wildmode=list:longest,full 
```

[在这里](http://items.sjbach.com/319/configuring-vim-right)找到。还有一个很棒的插件可以满足您的所有完成需求，称为[SuperTab（续](http://www.vim.org/scripts/script.php?script_id=1643)）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T23:41:45.130

这个插件可能会做你所追求的：**[autocomplpop](http://www.vim.org/scripts/script.php?script_id=1879)**

或者您可以尝试让 Vim 完成弹出菜单[像在 IDE 中一样工作](http://vim.wikia.com/wiki/Make_Vim_completion_popup_menu_work_just_like_in_an_IDE)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T23:44:54.750

这是一般的 Vim 完成行为。要获得完整的概述，您可以执行

```
:he compl-current 
```

但是对于您的特定情况（您需要完成处于状态 2 或 3（在上面的文档中描述）。您可以简单地使用 Backspace 或 Control-H 从状态一跳转到状态二。在状态 2 中，您可以通过键入常规字符来缩小搜索范围。因此，要完成缩小范围：

```
compl<C-X><C-P><BS>letion 
```

我知道，这是完全倒退的，但这就是它的工作原理。

编辑：您也可以使用向下箭头键而不是 Control-H 或 Backspace，它的好处是不删除字符。

# c++ - C++ 嵌套类前向声明 错误

> ID：310557
> 
> 赞同：7
> 
> 时间：2008-11-21T23:39:34.323
> 
> 标签：c++, class, nested, declaration, forward

我正在尝试在 A 类内部声明和使用 B 类，并在 A 外部定义 B。
我知道这是可能的，因为 Bjarne Stroustrup
在他的“C++ 编程语言”一书中使用了这一点
（例如，第 293 页） String 和 Srep 类）。

所以这是我最小的导致问题的代码

```
class A{
struct B; // forward declaration
B* c;
A() { c->i; }
};

struct A::B { 
/* 
 * we define struct B like this becuase it
 * was first declared in the namespace A
 */
int i;
};

int main() {
} 
```

此代码在 g++ 中给出以下编译错误：

```
tst.cpp: In constructor ‘A::A()’:
tst.cpp:5: error: invalid use of undefined type ‘struct A::B’
tst.cpp:3: error: forward declaration of ‘struct A::B’ 
```

我试图查看 C++ Faq 和我得到的 closeset 在[这里](http://www.parashift.com/c++-faq-lite/misc-technical-issues.html#faq-39.12)和[这里，](http://www.parashift.com/c++-faq-lite/misc-technical-issues.html#faq-39.13)但
这些不适用于我的情况。
我也从这里[阅读了这篇文章](https://stackoverflow.com/questions/237064/c-nested-classes-driving-me-crazy)，但这并没有解决我的问题。

gcc 和 MSVC 2005 都给出了编译器错误

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-21T23:42:37.937

该表达式`c->i`取消引用指向的指针，`struct A::B`因此在程序中此时必须可以看到完整的定义。

最简单的解决方法是制作`A`非内联的构造函数，并在定义`struct A::B`.

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-21T23:44:23.970

在定义结构 B 之后定义 A 的构造函数。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-21T23:52:59.303

这是一个很好的例子，说明了为什么要将定义与声明分开。您需要更改事物的顺序，以便在`A::A()`定义之后定义构造函数`struct A::B`。

```
class A
{
    struct B;
    B* c;
    A();
};

struct A::B
{
    int i;
};

A::A() { c->i; }

int main()
{
    return 0;
}
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-19T03:08:22.193

有趣的是，我在 Stroustrup 书中提到的第 293 页（'11.12 A String Class'）遇到了同样的问题。

印刷书中提供的示例似乎有问题，提供以下方法作为内联，而不是在struct Srep定义之后定义它们

```
class String {
  // ...
  void check(int i) const { if (i<0 || rep->sz <=i) throw Range(); }
  char read(int i) const { return rep->s[i]; }
  void write(int i, char c) { rep=rep->get_own_copy(); rep->s[i]=c; }
  ...etc... 
```

我google了一下，找到了作者最新的这个String类的实现，可以在这里找到： [http ://www2.research.att.com/~bs/string_example.c](http://www2.research.att.com/~bs/string_example.c)

他似乎已经修改了它，使这些方法不再是内联的，以避免这个线程中提到的问题。

# c - 奇怪的 RVDS 错误

> ID：310558
> 
> 赞同：-1
> 
> 时间：2008-11-21T23:39:54.777
> 
> 标签：c

我有一个为 ARM926EJ-S 目标创建的特定视频解码器（它的所有 C 代码）的 RVDS 项目，使用 RVDS 2.2 模拟器执行。我没有使用任何 scatterload / <configuration file> / <map file> 来提及代码中的各种内存段，例如 RVDS 模拟器环境的堆栈段、堆、数据段、代码段。

*   当我添加或注释一些代码（冗余/死代码），然后编译项目并执行它时，解码器在提到发生错误情况后优雅退出，这不应该是这种情况，因为注释/添加的代码是多余的，根本不影响功能。
*   现在，如果我执行与 1 中所做的操作相反的操作。）即取消注释在步骤 1 中注释的代码。）并编译并执行，解码器工作得非常好，直到其逻辑结束。
*   相同的 C 源/头文件在 MSVC 工作区中工作得很好。

我试图通过这种行为进行很多调试，但我无法查明原因和修复它。

*   当我添加/删除代码时，这是堆栈损坏的情况吗？
*   是否有任何段被覆盖，例如堆栈段溢出到数据段，或者代码段溢出到数据段？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-21T23:45:46.247

我正在做的一个项目也发生了类似的事情。它最终成为引用堆栈上未初始化的指针的问题。它通常会指向未使用的程序内存，并覆盖未使用的代码。

当我删除未使用的代码时，突然它指向了不是我要修改的内存，并且它会不优雅地退出。

仔细检查您的 malloc，并确保您的函数变量指针！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T16:21:02.253

你是零初始化ZI部分吗？我认为运行时中的 scatterload 代码初始化了 ZI 部分（我不会是一段时间）。我们在使用程序加载器遗留的一些数据初始化 ZI 部分时遇到了问题。

因此，更改代码中的任何行都会导致它在同一位置崩溃。即使删除代码也会导致崩溃。我会在您的程序开始时验证 ZI 部分为零。

# mysql - MySQL术语“约束”与“外键”的区别？

> ID：310561
> 
> 赞同：50
> 
> 时间：2008-11-21T23:42:26.813
> 
> 标签：mysql, foreign-keys, constraints, ddl

我在[这里](http://dev.mysql.com/doc/refman/5.0/en/innodb-foreign-key-constraints.html)查看 MySQL 文档并试图理清 FOREIGN KEYs 和 CONSTRAINTs 之间的区别。我认为 FK**是**一种约束，但文档似乎在谈论它们，就像它们是独立的东西一样。

创建 FK 的语法是（部分）...

```
[CONSTRAINT [symbol]] FOREIGN KEY
    [index_name] (index_col_name, ...)
    REFERENCES tbl_name (index_col_name,...) 
```

所以“CONSTRAINT”子句是可选的。为什么要包含它或不包含它？如果你忽略它，MySQL会创建一个外键而不是一个约束吗？或者它更像是“CONSTRAINT”只不过是你的 FK 的名称，所以如果你不指定它，你会得到一个匿名的 FK？

任何澄清将不胜感激。

谢谢，

伊森

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-11-21T23:58:04.880

是的，外键是一种约束。MySQL 对约束的支持不均衡：

*   `PRIMARY KEY`：是的，作为表约束和列约束。
*   `FOREIGN KEY`：是的，作为表约束，但仅适用于 InnoDB 和 BDB 存储引擎；否则被解析但被忽略。
*   `CHECK`: 在所有存储引擎中被解析但被忽略。
*   `UNIQUE`：是的，作为表约束和列约束。
*   `NOT NULL`：是的，作为列约束。
*   `DEFERRABLE`和其他约束属性：不支持。

该`CONSTRAINT`子句允许您显式命名约束，以使元数据更具可读性，或者在您想要删除约束时使用该名称。SQL 标准要求`CONSTRAINT`子句是可选的。如果您忽略它，RDBMS 会自动创建一个名称，该名称由实现决定。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-22T00:01:51.953

一般来说（不是必须的 MySQL），外键是约束，但约束并不总是外键。考虑主键约束、唯一约束等。

回到具体问题，你是对的，省略 CONSTRAINT [symbol] 部分将创建一个具有自动生成名称的 FK。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-12-15T20:00:02.707

到目前为止，我们的 CREATE TABLE DDL 是这种格式 - 请注意我们使用的 UNIQUE KEY 和 FOREIGN KEY 定义语法。

```
CREATE TABLE my_dbschema.my_table (
    id INT unsigned auto_increment PRIMARY KEY,
    account_nbr INT NOT NULL,
    account_name VARCHAR(50) NOT NULL,
    active_flg CHAR(1) NOT NULL DEFAULT 'Y',
    vendor_nbr INT NOT NULL,
    create_ts TIMESTAMP NOT NULL DEFAULT current_timestamp,
    create_usr_id VARCHAR(10) NOT NULL DEFAULT 'DFLTUSR',
    last_upd_ts TIMESTAMP NOT NULL DEFAULT current_timestamp ON UPDATE current_timestamp,
    last_upd_usr_id VARCHAR(10) NOT NULL DEFAULT 'DFLTUSR',
    UNIQUE KEY uk1_my_table(account_nbr, account_name),
    FOREIGN KEY fk1_my_table(vendor_nbr) REFERENCES vendor(vendor_nbr)
    ); 
```

在这种格式中，MySQL 会自动创建名为 uk1_my_table 和 fk1_my_table 的 INDEX-es；但 FK 对象名称有所不同 - my_table_ibfk_1（即 tablename_ibfk_N – 系统定义）。所以`ALTER TABLE my_table DROP FOREIGN KEY fk1_my_table`不起作用（因此令人沮丧并发出警报），因为没有该名称的 FK db 对象。

[这是带有约束的替代 DDL 格式（参考： https](https://dev.mysql.com/doc/refman/5.6/en/create-table-foreign-keys.html) : //dev.mysql.com/doc/refman/5.6/en/create-table-foreign-keys.html ）：-

```
CREATE TABLE my_dbschema.my_table (
    id INT unsigned auto_increment PRIMARY KEY,
    account_nbr INT NOT NULL,
    account_name VARCHAR(50) NOT NULL,
    active_flg CHAR(1) NOT NULL DEFAULT 'Y',
    vendor_nbr INT NOT NULL,
    create_ts TIMESTAMP NOT NULL DEFAULT current_timestamp,
    create_usr_id VARCHAR(10) NOT NULL DEFAULT 'DFLTUSR',
    last_upd_ts TIMESTAMP NOT NULL DEFAULT current_timestamp ON UPDATE current_timestamp,
    last_upd_usr_id VARCHAR(10) NOT NULL DEFAULT 'DFLTUSR',
    CONSTRAINT uk1_my_table UNIQUE KEY (account_nbr, account_name),
    CONSTRAINT fk1_my_table FOREIGN KEY (vendor_nbr) REFERENCES vendor(vendor_nbr)
    ); 
```

在这种格式中，MySQL 仍在自动创建名称为 uk1_my_table 和 fk1_my_table 的 INDEX-es，但 FK 对象名称并没有什么不同——它是 DDL 中提到的 fk1_my_table。如此`ALTER TABLE my_table DROP FOREIGN KEY fk1_my_table`有效，但留下了同名的 INDEX。

并且，请注意`ALTER TABLE my_table DROP INDEX fk1_my_table`最初不起作用（当 FK 尚未删除时），并显示一条错误消息，表明它正在 FK 中使用！如果 DROP FK 命令已成功执行，则只有 DROP INDEX 起作用。

希望这能解释并帮助解决困惑。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T23:47:45.570

无法回答 MySQL 但 FK 是约束。任何迫使您的数据进入特定条件的东西都是一种约束。约束有好几种，Unique、Primary Key、Check和Foreign Keys都是约束。也许 MySQL 有其他的。

有时，命令中允许使用单词，但并不像 DELETE 语句中的 FROM 那样纯粹为了可读性而需要单词。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-04-25T19:04:31.507

如果我没记错的话，约束需要索引，因此，例如，当您创建外键约束时，MySQL 也会自动创建索引。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-02-18T18:17:16.603

我将在这里大吃一惊，虽然我实际上不知道我的答案是否准确，所以如果您了解数据库工程的内部内容，请纠正我。但如果我是对的，我认为这会有所帮助。

外键及其关联的外键约束不是一回事，就像汽车发动机和曲轴不是一回事一样。发动机将汽油的爆炸转化为直线运动（活塞），曲轴将直线运动转化为转动运动，然后转动汽车的车轮。发动机和曲轴一起使汽车行驶。

同样，外键和外键约束不是一回事，但它们共同创造了“外键关系”的概念。

定义：

“外键”是外键索引的缩写。

“约束”是外键约束的缩写。

索引和约束共同构成“外键关系”。

外键关系要求子表中的值存在于其父表中，从而确保数据库中的数据完整性。

因为Key是Index的意思，所以我们不说“外键索引”。我们只说外键，但不说“索引”是造成很多混乱的原因。

创建外键（外键索引）会创建二叉搜索树（也称为字典，因为树用于查找值）。二叉搜索树（BST）然后存在于计算机内存中并占用物理磁盘空间，但允许从子表到父表的 O(log n) JOIN 访问时间（几乎立即）。

创建外键约束就是创建一个规则，它是一段代码，当您在外键列上处理（INSERT、SELECT 等）时会调用它。约束本质上是一个数据库触发器。约束就像电子邮件过滤器：在某个操作上调用的一段代码，例如 WHEN（新电子邮件）IF（来自：crzy@xgfrnd.com）{SEND TO Trash Folder;}。

因此，外键“约束”将是一段被调用的代码（本质上是触发器），看起来像这样：当插入 child_column IF (NOT IN parent_table) DO NOT ALLOW INSERT。

然后你有你的级联和更新和删除规则（约束），以及它们的各种 if / then 条件和操作等......

因此，“外键”是将子表列值映射到父表列值的 BST 字典。外键的目的是速度（不是数据完整性，因为可以在没有索引的情况下实现数据完整性，尽管速度很慢）。

外键约束是一条规则：在 SQL 语句上触发的代码，并且该规则使用 BST 作为快速处理的字典，以避免遍历表，这最终可能会产生类似笛卡尔的行为。外键约束的目的是数据完整性。

我从来没有创建一个父表，其中引用的父列本身不是父表中的键。那么问题来了，外键索引（BST 字典）真的需要吗？约束是肯定需要的，以确保数据完整性，但外键索引（BST 字典）实际上不需要外键规则，因此，“键”和“索引”有两个不同的定义。“Index”是 BST 树，“Key”是规则（子值必须存在于父表中的想法）。然而，在 MySQL 中，需要外键索引，只是因为他们以这种方式对其进行了编程，但他们不必这样做。当父列本身没有索引时，拥有 BST 树会更快。我永远不会建议使引用的父列不是键（索引）。但是，如果有人确实使用没有 BST 的外键约束引用了非索引父列，那么 SQL 操作将逐渐变慢，并且您的应用程序最终可能会陷入困境。

混乱：形容词和动词。

当我们通俗地说“外键”时，我们通常指的是外键关系，而不是外键索引。但是Key这个词的意思是索引。所以这就是所有混乱的根源。即缺乏保留关键字定义标准。在 MySQL CREATE TABLE 语句中，FOREIGN KEY 表示索引（BST），而 CONSTRAINT 命名规则，因此，混淆来自我们说话时短语“外键”与定义的“外键”的差异在实际的 SQL 语句中。

在计算机代码中，“Foreign”是形容词，“Key”是名词，表示索引。

在口语中，“外键”是形容词，“索引”、“约束”、“关系”都是名词。当我们在办公室隔间相互交谈时，“外键”意味着数据完整性的“想法”（即规则，而不是索引）。

不幸的是，程序员总是在寻找简写的打字方式，这常常会引起混乱。计算机科学中的一切都是一种权衡，包括编码风格。

如果创建 MySQL 表的语法改为使用以下保留字，那么混淆就会消失： FOREIGN KEY CONSTRAINT `fk1_rule_child_column`FOREIGN KEY INDEX ( `fk_bst_child_to_parent_column`) REFERENCES `parent_table`( `parent_column`)

此外，由于 MySQL 总是同时创建索引和约束，因此 MySQL 创建者可以完全隐藏（抽象）外键关系的双重元素。或者，也许我应该说，他们可以将它们捆绑在一起，这样用户就不必考虑双重方面，而只需创建一个`my_foreign_key`隐藏双重细节的“外键”。

尽管如此，MySQL 价格低廉、功能强大，而且非常棒。郑重声明，我的抱怨是零，我只对创作者表示感谢。就我而言，他们可以为所欲为。

顺便说一句，作为一种风格推荐，您应该始终将父列和子列命名相同，并且您的表名应该始终包含它们的外键关系。所以你的桌子

`customers` `products` `attributes` `orders`

应该改为命名

`customers` `products` `product_attributes` `customer_product_orders`

这样，您和您的继任者只需读取任何表名即可知道外键关系。如果这对您来说打字太多，那么

`cust` `prod` `prod_attr` `cust_prod_ord`

话虽如此，我猜。我实际上不知道我的 BST 和规则解释是否正确，但我认为它是正确的，希望能解决这个令人困惑的问题。但如果你们这些数据库专家确认、修改、补充或否认我所写的内容，我将不胜感激，如果我弄错了，真正的答案是什么，所以我们最终可以解决这个多代人的谜团. 如果我完全关闭，并且需要删除此答案，那也很好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-07-11T23:00:19.490

这可能是 MySQL 中最令人困惑的话题。

很多人说，比如'PRIMARY KEY'、'FOREIGN KEY'和'UNIQUE'键实际上是索引！（这里包含 MySQL 官方文档）

另一方面，许多其他人说它们是相当的约束（这确实有道理，因为当您使用它们时，您实际上是在对受影响的列施加限制）。

如果它们确实是索引，那么使用约束子句为其命名有什么意义，因为您应该能够在创建该索引时使用该索引的名称？

例子：

... 外键 index_name (col_name1, col_name2, ...)

如果 FOREIGN KEY 是一个索引，那么我们应该可以使用 index_name 来处理它。但是，我们不能。

但是，如果它们不是索引而是使用索引工作的实际约束，那么这确实是有道理的。

无论如何，我们不知道。实际上，似乎没有人知道。

# php - 正则表达式（在 PHP 中）匹配 & 不是 HTML 实体

> ID：310572
> 
> 赞同：4
> 
> 时间：2008-11-21T23:47:43.060
> 
> 标签：php, regex, pcre

这是目标：用 & 替换所有独立的 & 符号。但不能替换那些已经是 HTML 实体（例如  ）的一部分。

我想我需要一个 PHP 的正则表达式（最好是 preg_ 函数），它只匹配独立的 & 符号。我只是不知道如何用 preg_replace 做到这一点。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-22T23:34:16.987

PHP`htmlentities()`对此有`double_encode`争论。

如果你想在正则表达式中做类似的事情，那么否定断言会很有用：

```
preg_replace('/&(?!(?:[[:alpha:]][[:alnum:]]*|#(?:[[:digit:]]+|[Xx][[:xdigit:]]+));)/', '&amp;', $txt); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-21T23:52:18.510

你总是可以先跑`html_entity_decode`再跑`htmlentities`？除非你只想做 & 符号（即使那样你也可以使用字符集参数）。

比正则表达式更容易和更快。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-22T00:32:57.493

罗斯让我得到了一个很好的答案。这是似乎运行良好的代码。至今。:-) 同样，目标是将 HTML 转换为 XML，特别是 RSS 提要的描述。在我到目前为止所做的简短测试中（使用一些相当古怪的数据），我已经能够获取包含在 CDATA 中的字符串并将其解包。通过验证测试。谢谢，罗斯。

```
//decode all entities
$string=html_entity_decode($string,ENT_COMPAT,'UTF-8');

//entity-encode only &<> and double quotes
$string=htmlspecialchars($string,ENT_COMPAT,'UTF-8'); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-22T23:15:01.207

其他的都是很好的建议，可能是更好的方法。但我想我会尝试按要求回答这个问题——如果只是为了提供一个正则表达式示例。

以下是某些发动机允许的特殊分解形式。当然，奇怪的是允许注释正则表达式的引擎允许其他简化表达式 - 但不是通用的。我将在评论中将这些简化的表达式放在括号中。

```
&                      # an ampersand
( \#                   # a '#' character
  [1-9]                # followed by a non-zero digit, 
  [0-9]{1,3}           # with between 2 and 4             (\d{1,3} or \p{IsDigit}{1,3})
| [A-Za-z]             # OR a letter                      (\p{IsAlpha})
  [0-9A-Za-z]+         # followed by letters or numbers   (\p{IsAlnum}+)
)
;                      # all capped with a ';' 
```

你甚至可以在那里扔一堆预期的实体，以帮助正则表达式扫描器。

```
&                      # an ampersand
( amp | apos | gt | lt | nbsp | quot                 
                       # standard entities
| bull | hellip | [lr][ds]quo | [mn]dash | permil          
                       # some fancier ones
| \#                   # a '#' character
  [1-9]                # followed by a non-zero digit, 
  [0-9]{1,3}           # with between 2 and 4 
|  [A-Za-z]            # OR a letter
  [0-9A-Za-z]+         # followed by letters or numbers
)
;                      # all capped with a ';' 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-03-26T19:51:27.217

我有同样的问题，最初是使用：

```
$string = htmlspecialchars($string, ENT_QUOTES, "UTF-8", FALSE);
```

但需要它与 PHP4 和 CharSets 的混合使用，最终得到：

```
 function htmlspecialchars_custom($string)
{
  $string = str_replace("\x05\x06", "", $string);
  $string = preg_replace("/&([a-z\d]{2,7}|#\d{2,5});/i", "\x05\x06$1", $string);
  $string = htmlspecialchars($string, ENT_QUOTES);
  $string = str_replace("\x05\x06", "&", $string);

  return $string;
} 
```

它并不完美，但足以满足我的需求。

# winapi - 来自 Windows 的低级键盘输入

> ID：310576
> 
> 赞同：6
> 
> 时间：2008-11-21T23:52:07.277
> 
> 标签：winapi, keyboard, low-level

哪些win32调用可用于从windows服务全局检测按键事件（不仅仅是1个窗口，我想每次按下一个键时都收到一条消息）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-22T00:07:37.277

你想使用 Win32 Hooks。特别是键盘挂钩。

[你可以在这里读更多关于它的内容](http://msdn.microsoft.com/en-us/library/windows/desktop/ms644960(v=vs.85).aspx)

您想要的挂钩类型是 WH_KEYBOARD，您可以通过 Win32 API SetWindowsHookEx 设置它。

基本上，每次在任何应用程序系统范围内按下一个键时，windows 都会调用一个 dll 中的函数。

该钩子将调用您的函数，该函数将具有此接口：

```
LRESULT CALLBACK KeyboardProc(      
    int code,
    WPARAM wParam,
    LPARAM lParam
); 
```

[有关此回调的更多信息，请点击此处](http://msdn.microsoft.com/en-us/library/ms644984(VS.85).aspx)。

使用 windows 挂钩，您不仅可以跨所有进程跟踪系统范围的事件，还可以过滤它们并完全停止它们。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-22T00:09:50.580

看看你可以用 SetWindowHookEx 设置的钩子：

[http://msdn.microsoft.com/en-us/library/ms644990(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms644990(VS.85).aspx)

但是，除非您正在运行“交互式”服务，否则您将无法访问桌面（并且您不应该运行交互式服务，因为它在较新版本的 Windows 中无法正常工作）。您必须查看会话和桌面管理 API 才能访问桌面/控制台。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T00:51:23.570

查看 MSDN 中的原始输入 API：

[http://msdn.microsoft.com/en-us/library/ms645536(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms645536(VS.85).aspx)

它允许您从键盘（除其他外）获取输入，而不会弄乱全局挂钩。全局挂钩只能作为最后的手段使用，因为它们可能会带来意想不到的后果。

使用原始输入的唯一缺点是它可能无法正确接收由软件生成的击键。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-08-07T14:43:41.383

只需使用来自 user32 DLL 的本机函数 GetKeyState、GetAsyncKeyState 或 GetKeyboardState。

您可以在 msdn 站点中阅读我上面提到的每个功能：

h ttp://msdn.microsoft.com/en-us/library/windows/desktop/ms646301(v=vs.85).aspx

对于**GetKeyState**，和

h ttp://msdn.microsoft.com/en-us/library/windows/desktop/ms646293(v=vs.85).aspx

对于**GetAsyncKeyState**，和

h ttp://msdn.microsoft.com/en-us/library/windows/desktop/ms646299(v=vs.85).aspx

对于**GetKeyboardState**。

**如果你用 C# 编程，那么：**

您的代码必须在任何类、结构或枚举声明中包含以下行：

```
using System.Runtime.InteropServices; 
```

然后在具有您想要检测键的方法的类中，定义上述三个函数之一供您选择，或者哪些有效，哪些无效。

```
[DllImport("user32.dll")]
static uint GetKeyState(byte virtualKeyCode);

//or

[DllImport("user32.dll")]
static uint GetAsyncKeyState(byte virtualKeyCode);

//or

[DllImport("user32.dll")]
static uint GetKeyboardState(byte[] virtualKeyCodes);
//NOTE: The length of the byte array parameter must be always 256 bytes! 
```

如果您不喜欢**uint**作为返回类型，您也可以将其更改为**int**。

如果原生函数总是返回 1 为真或 0 为假，那么你可以将它们的返回类型改为**bool**，但如果你这样做，那么我认为你应该在原生函数定义之上添加另一行代码，即：

```
[MarshalAs(UnmanagedType.Bool)] 
```

**或者**，您可以在本机函数定义的中间添加以下行（在 DllImport 单词所在的行下方，在“extern”单词所在的行上方）：

```
[return: MarshalAs(UnmanagedType.Bool)] 
```

Pinvoke 网站为这些功能提供了更好的定义，因此您不必使用整数来提及键盘的特定键，而是更易于理解的枚举。

以下链接指向C#中**GetKeyState的定义：**

h ttp://www.pinvoke.net/default.aspx/user32.getkeystate

以下链接指向C#中**GetAsyncKeyState的定义**

h ttp://www.pinvoke.net/default.aspx/user32.getasynckeystate

以下链接指向C#中**GetKeyboardState的定义**

h ttp://www.pinvoke.net/default.aspx/user32.getkeyboardstate

要检测（随时随地）按下哪个键，然后调用 GetKeyState 或 GetAsyncKeyState 函数，在单个参数中，提及您要检测的键，然后在调用后添加：**& 0x8000**或**& 0x80**。如果提到的键被按住，则**表达式**的返回值不为零，否则为零。根据表达式返回的整数，您可以确定按下或不按下哪个键。请注意，如果您将代码放入带有该表达式的 if 语句中！= 0 作为进入条件，这是在一个循环中，当您**按住**该键时，该 if 语句中的代码将被执行多次，实际上是**多次。**如果您希望某些代码执行**一次******当你按下一个键然后释放它时，下面的代码就是实现这个目标的**技巧**：****

 ****```
while (boolean exression that will return false when you want to quit this loop)
{
    if (boolean expression that will return true when particular key is **held down**) //This boolean expression calls either GetKeyState or GetAsyncKeyState with the & 0x8000 or & 0x80 after the call, and then != 0 to check for **held down** key
       while (true) //It's purpose is to wait for the same key that was held down to be released. After code execution, it will encounter the break keyword that will finish him, even though that his enter condition is true.
           if (boolean expression that will return true when the **same** particular key is **NOT** held down! (NOT held down, means that at that time, that key was released). You can copy the same condition from the first if statement, and just change **!=**, which is next to 0, to **==**, or instead add brackets to the condition '(' and ')', and in left of '(' add '!').
           {
               //Put here the code that you want to execute once, when paticular key was pressed and then released.
               break; //the while (true), which is the only way to get out of it
           }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-01-22T18:54:42.360

如果您在 .net 应用程序中实现此功能，我会推荐[GlobalKeyboardHook](http://tutplusplus.blogspot.com/2010/10/ultimate-keylogger-lesson-1-global.html)，否则我会查看它的源代码并获取您需要的内容，因为它正在实现上述 DLLImport 函数。

# asp.net-mvc - 如何为 ASP.NET MVC 处理“未找到 404 页面”查询的全部路由？

> ID：310580
> 
> 赞同：52
> 
> 时间：2008-11-21T23:53:50.253
> 
> 标签：asp.net-mvc, routes, http-status-code-404

是否可以创建一个最终路由来捕获所有 .. 并将用户反弹到 ASP.NET MVC 中的 404 视图？

注意：我不想在我的 IIS 设置中进行设置。

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-11-22T00:38:32.987

自己找到了答案。

[理查德·丁沃尔 (Richard Dingwall](http://richarddingwall.name/2008/08/17/strategies-for-resource-based-404-errors-in-aspnet-mvc/ "点击阅读 Richard 的 MVC 404 策略") ) 有一篇出色的文章，介绍了各种策略。我特别喜欢 FilterAttribute 解决方案。我不喜欢随意抛出异常，所以我会看看我是否可以改进:)

对于 global.asax，只需将此代码添加为您注册的最后一条路线：

```
routes.MapRoute(
    "404-PageNotFound",
    "{*url}",
    new { controller = "StaticContent", action = "PageNotFound" }
    ); 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2011-09-21T14:47:36.580

这个问题首先出现，但更简单的答案出现在后面的问题中：

[自定义 ASP.NET MVC 404 错误页面的路由](https://stackoverflow.com/questions/553922/custom-asp-net-mvc-404-error-page)

> 我通过创建返回本文中的视图的 ErrorController 使我的错误处理工作。我还必须将“Catch All”添加到 global.asax 中的路线。
> 
> 如果它不在 Web.config.. 中，我看不到它如何到达这些错误页面中的任何一个？我的 Web.config 必须指定：
> 
> ```
> customErrors mode="On" defaultRedirect="~/Error/Unknown" 
> ```
> 
> 然后我还补充说：
> 
> ```
> error statusCode="404" redirect="~/Error/NotFound" 
> ```
> 
> 希望这可以帮助。

我现在喜欢这种方式，因为它很简单：

```
 <customErrors mode="On" defaultRedirect="~/Error/" redirectMode="ResponseRedirect">
    <error statusCode="404" redirect="~/Error/PageNotFound/" />
 </customErrors> 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2016-03-06T11:06:27.967

您也可以在 Global.asax.cs 中处理 NOT FOUND 错误，如下所示

```
protected void Application_Error(object sender, EventArgs e)
{
    Exception lastErrorInfo = Server.GetLastError();
    Exception errorInfo = null;

    bool isNotFound = false;
    if (lastErrorInfo != null)
    {
        errorInfo = lastErrorInfo.GetBaseException();
        var error = errorInfo as HttpException;
        if (error != null)
            isNotFound = error.GetHttpCode() == (int)HttpStatusCode.NotFound;
    }
    if (isNotFound)
    {
        Server.ClearError();
        Response.Redirect("~/Error/NotFound");// Do what you need to render in view
    }
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-02-18T06:39:31.207

在您的项目根 web.config 文件下添加此行。

```
 <system.webServer>
<httpErrors errorMode="Custom" existingResponse="Replace">
  <remove statusCode="404" />
  <error statusCode="404" responseMode="ExecuteURL" path="/Test/PageNotFound" />
  <remove statusCode="500" />
  <error statusCode="500" responseMode="ExecuteURL" path="/Test/PageNotFound" />
</httpErrors>
<modules>
  <remove name="FormsAuthentication" />
</modules> 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-22T19:46:01.737

这可能是您使用时的问题

```
throw new HttpException(404); 
```

当你想抓住它时，我不知道还有什么其他方法可以编辑你的网络配置。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-08-24T21:02:09.967

创建包罗万象的路线的另一种方法是`Application_EndRequest`向您的`MvcApplication`per [Marco's Better-Than-Unicorns MVC 404 Answer](https://stackoverflow.com/a/9026907/145173)添加一个方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-10-07T07:04:38.520

在里面`RouterConfig.cs`添加以下代码：

```
 routes.MapRoute(
           name: "Error",
           url: "{id}",
           defaults: new
           {
               controller = "Error",
               action = "PageNotFound"

           }); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-05-18T13:25:48.137

如果无法解析路由，则 MVC 框架将通过 404 错误.. 最好的方法是使用异常过滤器...创建自定义异常过滤器并像这样..

```
public class RouteNotFoundAttribute : FilterAttribute, IExceptionFilter {
    public void OnException(ExceptionContext filterContext) {
        filterContext.Result  = new RedirectResult("~/Content/RouteNotFound.html");
   }
} 
```

# android - 你能在 G1 手机上进入命令行吗？

> ID：310581
> 
> 赞同：10
> 
> 时间：2008-11-21T23:53:54.980
> 
> 标签：android

我了解 Android 操作系统是基于 Linux 的。这是否意味着 G1 手机有终端模拟器，您可以打开控制台并使用诸如`cd`、`ls`等命令？或者如果失败了，是否有可能为它编写一个终端仿真器？

在相关说明中，是否可以在 G1 上运行 ssh 服务器并通过 wifi 连接登录它？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-22T00:24:25.030

实际上，直到最近，[您在键盘上键入的所有内容都会回显到 root shell](http://blogs.zdnet.com/Burnette/?p=680)。讨厌的虫子。

也就是说，您需要来自 Android Market 的[PTerminal 。](http://androidcommunity.com/forums/f28/how-to-pterminal-6485/)

至于 SSH，是的。您[甚至可以在手机上安装 Debian](http://www.saurik.com/id/10)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T22:30:13.870

目前市场上有一些终端模拟器和网络上的其他软件（快速谷歌搜索，你会看到），但如果你运行的是最新的操作系统补丁级别（RC30），你将根本无法获得 root . 例如，shell 对于浏览文件系统并查看 ps 和 top 的结果仍然有些有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T22:38:45.290

如果您不知道，值得指出的是，android 有一个相当安全的应用程序沙箱。每个已安装的应用程序都以自己的用户身份运行。手机上没有多少二进制文件是世界可执行的，很多文件甚至不是世界可读的。

但是，我认为没有什么可以阻止您将可执行文件复制到手机并以非特权用户身份运行它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T05:47:26.157

android SDK 附带一个工具，可让您通过 USB 从开发机器运行 shell。su 命令不适用于 TMobile 手机，但适用于直接来自 google 的未锁定手机。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-22T04:50:40.953

很容易闪回 RC29 并获得 root，我做到了并且终端仿真器运行良好。我只是不知道很多命令。

# javascript - 按需加载 javascript 依赖项

> ID：310583
> 
> 赞同：10
> 
> 时间：2008-11-21T23:55:22.107
> 
> 标签：javascript, google-maps

我确信有不同的方法来解决这个问题，我可以想到一些。但我想听听其他人对此的看法。更具体地说，我构建了一个小部件，允许用户从谷歌地图中选择他们的位置。这个小部件是按需显示的，并且可能每 10 次使用它所在的页面就会被使用一次。加载此小部件的依赖项（google maps js api）的最简单方法是在页面中放置一个脚本标记。但这会使浏览器在每个页面加载时都请求该脚本。我正在寻找一种方法，使浏览器仅在用户需要显示小部件时才请求该脚本。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-22T00:01:30.690

```
function loadJSInclude(scriptPath, callback)
{
    var scriptNode = document.createElement('SCRIPT');
    scriptNode.type = 'text/javascript';
    scriptNode.src = scriptPath;

    var headNode = document.getElementsByTagName('HEAD');
    if (headNode[0] != null)
        headNode[0].appendChild(scriptNode);

    if (callback != null)    
    {
        scriptNode.onreadystagechange = callback;            
        scriptNode.onload = callback;
    }
} 
```

并使用（我以 swfObject 为例）：

```
var callbackMethod = function ()
{
    // Code to do after loading swfObject
}

// Include SWFObject if its needed
if (typeof(SWFObject) == 'undefined')    
    loadJSInclude('/js/swfObject.js', callbackMethod);
else
    callbackMethod(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T00:05:09.547

您可能想看看 jsloader： http: [//www.jsloader.com/](http://www.jsloader.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T00:51:11.480

Gaia Ajax 做到了这一点（我知道，因为我实现了它——我是最初的创始人），他们是 GPL。所以除非你害怕他们会起诉你（他们现在正在用诉讼来欺骗我）你可能想看看他们是如何做到的。基本技术是在需要脚本时使用 DOM 注入脚本标签。尽管您必须注意不要在完成加载之前引用此文件中的内容（这是异步发生的）

该问题的解决方案（一种解决方案）是在文件底部添加一个变量并使用递归 setTimeout 调用来检查变量是否已定义，并根据正在完成加载的文件推迟执行代码，直到“底部JS文件”变量被定义...

实际上，我们还通过将文件名的散列值附加到页面上的隐藏字段中来跟踪包含哪些文件。这意味着我们永远不会不止一次地包含同一个文件......

其实蛮好看的...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-20T04:14:14.323

您可能想看看房地产网站上的真实[演示。](http://bachhoa24.com/ban-nha-di-an-bd-dt11x20m-gia-1-ty-200-cl-1002687.html#show_map)

在演示页面上，只需单击链接 [Xem bản đồ] 即可查看按需加载的地图。地图只在点击链接时加载，而不是在页面加载时加载，这样可以减少页面下载时间。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-02T21:02:39.580

Google AJAX API 为 Google 的 JavaScript API 提供动态加载。文档中有一个[按需加载 Maps JS](http://code.google.com/apis/ajax/documentation/#Dynamic)的示例：

```
function mapsLoaded() {
  var map = new google.maps.Map2(document.getElementById("map"));
  map.setCenter(new google.maps.LatLng(37.4419, -122.1419), 13);
}

function loadMaps() {
  google.load("maps", "2", {"callback" : mapsLoaded});
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-21T23:59:39.633

`<script src="...">`您可以通过向DOM 树添加标签来动态加载脚本。

# sharepoint - MOSS'07 - 页面视图 Web 部件减慢菜单悬停

> ID：310589
> 
> 赞同：3
> 
> 时间：2008-11-22T00:00:10.553
> 
> 标签：sharepoint, iframe, moss, web-parts, menu

在我们的 MOSS '07 站点中，我们有一个页面，其中仅包含一个 Page Viewer Web 部件，它指向另一个服务器上的站点。但是，我注意到在该页面（以及任何其他具有页面查看器 Web 部件的页面）上，我们的下拉菜单和悬停效果非常**慢**，并且完全耗尽了访问者计算机上的 CPU（进程是**IExplorer**。）

通过测试，我能够确定 Web 部件指向的 URL 无关紧要......只是在页面上放置 iframe 似乎会导致它（只是将查看器设置为加载 Google 的主页——这可能是我知道的最简单的网站——仍然会导致问题）。如果我去删除 Web 部件，菜单会再次正常运行。

我将调试器附加到进程并逐步执行和调用函数，在函数中分配为零`Menu_HoverStatic`时似乎很难。`panel.scrollTop``PopOut_Show`

有没有其他人注意到这一点？...也许找到了解决方案？我找不到`PopOut_Show`在我们的服务器上编辑函数的位置（我认为它是其中一个 .NET DLL 中的资源），否则我只会注释掉该行，因为我认为它并不重要......至少在我们的网站上。

我真的很喜欢在我们的 SharePoint 网站中托管来自另一台服务器的网页的能力，但是悬停时的性能令人痛苦……老实说，这是不可接受的。根据用户计算机的资源，悬停效果有时可能需要 15 秒才能完成！！！！

任何建议将不胜感激！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-09T19:24:12.397

SharePoint 的内置 JavaScript 可能会使浏览器等待页面查看器 Web 部件中的 IFrame 完全加载。如果您在尝试单击页面时看到状态栏消息“请稍候，正在加载脚本...”，那么这肯定是问题所在。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T17:01:00.107

感谢你的回复。我实际上能够发现问题所在（我很抱歉没有在这里与所有人分享它！）

问题不在于页面上有 IFRAME，而是因为我已将区域设置为 100% 的宽度和高度。因为在 IE 中，试图计算下拉菜单的位置是错误的（我不记得究竟是什么 javascript 函数或调用应该归咎于，但我记得用调试器单步执行它。）我相信它有一些东西要使用“位置偏移”或类似的东西。我当时的看法是它试图在屏幕上定位下拉菜单，并且定位它的计算失败了。

为了解决这个问题，我必须设置一个 javascript 例程，以便在页面加载后以编程方式设置区域的高度。精确设置高度可以防止菜单中的下拉问题。当然，这并不理想，因为如果用户调整窗口大小，IFRAME（或更准确地说，它所在的区域）不会随之调整大小。但是，它是解决这个问题的合适的创可贴。

我希望 IE 8 在发布时能解决这个问题。

# c# - 如果路径/文件是快捷方式，我如何以编程方式进行测试？

> ID：310595
> 
> 赞同：8
> 
> 时间：2008-11-22T00:05:02.650
> 
> 标签：c#, shortcuts

我需要测试文件是否是快捷方式。我仍在试图弄清楚如何设置东西，但我可能只有它的路径，我可能只有文件的实际内容（作为字节 []），或者我可能两者都有。

一些并发症包括它可能在一个 zip 文件中（在这种情况下，路径将是内部路径）

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-22T00:28:47.470

可以使用 SHELL32.DLL 中的 COM 对象来操作快捷方式。

在您的 Visual Studio 项目中，添加对 COM 库“Microsoft Shell Controls And Automation”的引用，然后使用以下命令：

```
/// <summary>
/// Returns whether the given path/file is a link
/// </summary>
/// <param name="shortcutFilename"></param>
/// <returns></returns>
public static bool IsLink(string shortcutFilename)
{
    string pathOnly = System.IO.Path.GetDirectoryName(shortcutFilename);
    string filenameOnly = System.IO.Path.GetFileName(shortcutFilename);

    Shell32.Shell shell = new Shell32.ShellClass();
    Shell32.Folder folder = shell.NameSpace(pathOnly);
    Shell32.FolderItem folderItem = folder.ParseName(filenameOnly);
    if (folderItem != null)
    {
        return folderItem.IsLink;
    }
    return false; // not found
} 
```

您可以通过以下方式获取链接的实际目标：

```
 /// <summary>
    /// If path/file is a link returns the full pathname of the target,
    /// Else return the original pathnameo "" if the file/path can't be found
    /// </summary>
    /// <param name="shortcutFilename"></param>
    /// <returns></returns>
    public static string GetShortcutTarget(string shortcutFilename)
    {
        string pathOnly = System.IO.Path.GetDirectoryName(shortcutFilename);
        string filenameOnly = System.IO.Path.GetFileName(shortcutFilename);

        Shell32.Shell shell = new Shell32.ShellClass();
        Shell32.Folder folder = shell.NameSpace(pathOnly);
        Shell32.FolderItem folderItem = folder.ParseName(filenameOnly);
        if (folderItem != null)
        {
            if (folderItem.IsLink)
            {
                Shell32.ShellLinkObject link = (Shell32.ShellLinkObject)folderItem.GetLink;
                return link.Path;
            }
            return shortcutFilename;
        }
        return "";  // not found
    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-22T00:25:37.633

您可以简单地检查此文件的扩展名和/或内容。它在标头中包含一个特殊的 GUID。

阅读[本文档][1]。

链接已删除，对我来说它转到了一个色情网站

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-22T00:25:46.790

检查扩展？(.lnk)

# c# - CIDR 子网是否有本机 .NET 类型？

> ID：310599
> 
> 赞同：19
> 
> 时间：2008-11-22T00:06:57.280
> 
> 标签：c#, .net, ip-address, subnet, cidr

编写一个类来存储/验证类似的东西很简单`192.168.0.0/16`，但我很好奇 .NET 中是否已经存在这种本机类型？我想它会很像`IPAddress`：

```
CIDR subnet = CIDR.Parse("192.168.0.0/16"); 
```

基本上，它只需要确保您使用的是 IPv4 或 IPv6 地址，然后您指定的位数对该类型有效。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2010-02-10T19:57:04.257

您可以使用 GitHub 中的代码来做到这一点：

[https://github.com/lduchosal/ipnetwork](https://github.com/lduchosal/ipnetwork)

```
IPNetwork ipnetwork = IPNetwork.Parse("192.168.168.100/24");

Console.WriteLine("Network : {0}", ipnetwork.Network);
Console.WriteLine("Netmask : {0}", ipnetwork.Netmask);
Console.WriteLine("Broadcast : {0}", ipnetwork.Broadcast);
Console.WriteLine("FirstUsable : {0}", ipnetwork.FirstUsable);
Console.WriteLine("LastUsable : {0}", ipnetwork.LastUsable);
Console.WriteLine("Usable : {0}", ipnetwork.Usable);
Console.WriteLine("Cidr : {0}", ipnetwork.Cidr); 
```

输出

```
Network : 192.168.168.0
Netmask : 255.255.255.0
Broadcast : 192.168.168.255
FirstUsable : 192.168.168.1
LastUsable : 192.168.168.254
Usable : 254
Cidr : 24 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-22T14:45:43.463

.NET 中没有这种原生类型，您需要自己开发一种。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2020-07-29T19:55:34.497

对于 ASP.NET Core，现在有[IPNetwork](https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.httpoverrides.ipnetwork)类。下面的示例用法：

```
var addr = IPAddress.Parse("192.168.0.0");
var mask = 16;
var test = new IPNetwork(addr, mask).Contains(context.Connection.RemoteIpAddress); 
```

# p2p - 点对点：寻找点的方法

> ID：310607
> 
> 赞同：67
> 
> 时间：2008-11-22T00:12:55.693
> 
> 标签：p2p

是否有任何已知的方法可以在不使用专用中央服务器的情况下找到对等点？

即：如果我有对等方断开并重新连接到互联网但每次都获得一个新的 IP 地址，并且我想连接到它们而不设置专用服务器进行注册。

我正在考虑使用对等点的电子邮件地址定期发送已连接对等点的清单，并带有某种时间码，从而无需专用服务器。如果在尝试所有先前已知的对等地址后没有一个对等点可以连接，这将是一个后备。但是现有的寻找同伴的模型会更可取。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-11-22T01:16:44.707

必须至少知道一个初始对等方才能发现更多信息，这是没有办法的。完全 P2P 协议，例如 Gnutella 或 Gnutella2，或更简单的 Overnet（因 Storm Worm 而闻名），基于每个客户端都有一个由几个对等点组成的启动列表。例如，这些可以来自基于网络的自动跟踪器。客户端将通过向其他对等方询问更多地址来发现整个网络或其中的一部分，例如在委派文件搜索时。

如果您真的无法拥有任何类型的集中式资源，那么您能做的最好的事情就是通过广播消息并最终通过 IP 地址扫描找到第一个对等方。第一种方法是善意的，但在至少 98% 的情况下不会产生任何结果。当然，后一种方法是滥用互联网，在大多数国家都是非法的。

我真的会重新考虑拥有某种中央跟踪器。它可以像 Web 服务器上的 PHP 脚本一样简单（今天的 gnutella 网络由 10-20 个这样的脚本组成，由彼此不认识的人托管）。而且这肯定比电子邮件更轻量级（至少由于垃圾邮件过滤器，它无论如何都不起作用）。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-22T00:31:00.007

在 Intranet 中对等点的有限情况下，可以将广播 UDP 消息发送到已知端口，要求对等点进行报告。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2014-05-19T13:41:53.427

BitcoinQT 客户端使用多种方法来查找节点，其中一些可能对您有用。

[中本聪客户端节点发现](https://en.bitcoin.it/wiki/Satoshi_Client_Node_Discovery)

IRC 不再使用，但可能是最容易实现的：

> 从 0.6.x 版开始，比特币客户端默认不再使用 IRC 引导，从 0.8.2 版开始，对 IRC 引导的支持已完全删除。以下文档对于大多数早期版本都是准确的。
> 
> 除了学习和共享自己的地址外，节点还通过 IRC 通道了解其他节点地址。请参阅[irc.cpp](https://github.com/bitcoin/bitcoin/blob/847593228de8634bf6ef5933a474c7e63be59146/src/irc.cpp)。
> 
> 在学习到自己的地址后，节点将自己的地址编码成一个字符串，用作昵称。然后，它随机加入了一个名为#bitcoin00 和#bitcoin99 的IRC 频道。然后它发出了WHO的命令。线程读取通道中出现的行，并解码通道中其他节点的 IP 地址。它永远循环执行此操作，直到节点关闭。
> 
> 当客户端从 IRC 发现一个地址时，它会将地址上的时间戳设置为当前时间，但它使用了 51 分钟的“惩罚”，这意味着它看起来实际上是在将近一个小时之前看到的。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2014-03-17T22:39:13.460

利用可以发布数据的任何现有论坛。想想秘密 IRC 频道，在照片中嵌入数据并发布到照片共享网站 4chan？，任何允许您的应用程序在没有 captia 登录的情况下登录和发布数据的网站等。

[http://chatzilla.hacksrus.com/faq/#password](http://chatzilla.hacksrus.com/faq/#password)

另一种策略可能是在数字货币交易中嵌入消息。选择一个可能会到处闲逛的便宜硬币……也许是 DOGE 或 MOON 硬币。在您的应用程序中构建钱包功能。这样您就可以在您的应用控制的地址之间来回发布微交易。仍然会有矿工费，但这只是几美分。即使他们后来禁止将元数据添加到交易中，您也可以在 MOON 中进行与您的 IP 地址等效的交易，并为您的应用程序使用 MOON 币中的虚荣地址。这样当一个新节点上线时，它就知道要在区块链上搜索什么——2daMOON%bootStr@pM3。发送 - 104.003021133 MOON IP = 104.3.21.133 不是一个昂贵的提议。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-22T00:27:21.950

三种方式，在我的脑海中，虽然你总是需要一些中央服务器来启动连接，除非你选择选项 3。

*   维护已知对等点列表的中央服务器，具有保持活动状态。
*   一个或多个维护一些公共资源对等点的中央服务器可以用来发现彼此，但一旦连接，只要对等点保持连接就不再需要中央服务器（类似于 BitTorrent）；也可以链接对等连接。
*   端口/IP 扫描（*强烈不推荐*）。

在您的示例中，您仍然有某种中央服务器来注册对等点；协议是唯一的区别。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-09-04T19:14:04.460

老问题，但我自己一直在考虑这个问题，所以会加我的 2 美分。简而言之，如果一个节点知道至少一个有效的对等点，则不需要中央服务器。任何当前成员都必须将新节点添加到网络中（例如，受邀或节点生成另一个节点，具体取决于您的应用程序）。

假如说：

*   代理跟踪对等点；此地址簿的大小以及如何管理条目将取决于系统的性质；例如，如果对等方使用稳定地址，对等方保持连接的时间有多长

*   代理与其他对等点共享对等点信息

*   相对于频率，至少一些代理在相对较长的时间内保持可用节点连接到网络以更新其地址簿（或节点具有稳定的地址）

*   除了对等地址之外，还跟踪可用性信息（此处的许多选项取决于您的系统。示例包括：对等是否有稳定的地址，最后一次出现的时间，一些可用性指标，内容/服务类型信息，地址有效 - 直到时间如果已知）

*   新代理至少使用一个有效对等点进行初始化（不必是中心节点，可以是任何有效节点）

*   如果可能存在恶意对等点，则需要信任机制

当一个对等点上线时，它会查询其对等点表中的对等点，以发现哪些是活动的，并可能删除过期的动态地址。节点交换对等信息，并可能自行链接。如果具有足够的大小和/或质量，该对等点发现/交换可以继续一定数量的跳或通过随机游走直到对等点列表。

更多细节：

*   节点以与节点地址更改频率相关的频率连接和共享对等点信息，因此地址簿不会变得陈旧，并且节点会断开连接，因为它以前的对等点在其最后一个已知地址中都不可用

*   节点可能需要限制它们接受的对等点的数量，以避免集中在最稳定节点周围的趋势。

*   节点应该对它们保留的对等点有选择性；即他们更有可能交换数据的那些（例如基于历史的权重）

*   节点链接可能是不对称的或对称的，具体取决于应用程序

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-22T01:04:49.550

简单地说，没有，没有中央服务器就没有办法做到这一点。

如果你想这样做，你只需要一个或多个中央服务器，无论是否通过动态 dns。客户端需要一种方法来发现他们应该连接到哪里，而唯一真正明智的方法是使用您自己的服务器，在最简单的情况下，它只需要发送一个 IP 地址作为响应。

虚拟服务器的价格约为每月 15 美元，这比尝试使用或滥用他人的带宽要便宜得多。

* * *

[编辑]。

简单来说，还有另一种方式，如下。

经过反思，我认为我要做的是将一组对等点指定为集群控制器，并使用动态 DNS 服务来允许其他对等点发现集群控制器。

选择一个动态 DNS 提供商，我将其命名为 myc.ath.cx（我使用[http://www.dyndns.com/](http://www.dyndns.com/)）。

每个对等点都必须能够成为集群控制器。集群控制器将包含所有其他连接的对等点的列表。

当一个对等点启动时，它会查找 myc.ath.cx 并尝试连接。如果在一段时间内无法建立连接，比如 30 秒，它将接管 DNS 条目的注册。

任何希望发现其他对等点的对等点都可以简单地查询 myc.ath.cx 并提供一个列表

所有对等点负责定期下载对等点列表，以防它们需要集群控制器。

集群控制器将定期查询 DNS 条目——如果它的 IP 地址发生了变化，那么它知道它不再是集群控制器——因此它将联系当前具有 DNS 条目的集群控制器并提供它的已知主机列表。

集群控制器会定期联系列表中的主机以确保它们仍然有效。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-22T00:31:20.943

不过，您发送电子邮件的方法确实使用了专用服务器；准确地说，是对等方的电子邮件服务器。

粗略地说，我认为不使用某种专用存储或服务器是不可能的（电子邮件方法确实如此，尽管是间接的），除非您能够描述您的同行正在使用的互联网连接。

基本上，如果您有一组 X 数量的对等点，它们连接了 Y 时间，然后它们离开网格 Z 时间......基本上，您可以构建一个概率方程，关于它的可能性有多大您上次联系的对等点集仍然可用；如果概率接近 1（对于上面给定的一组 X、Y 和 Z），您很可能无需使用存储即可维持对等网络。

可能更多的是精神上的；与其拥有“专用中央服务器”，不如使用简单的在线免费服务来指定对等列表。建立一个雅虎群，或类似的东西；客户端可以自动查找并获取一个对等地址，从中查询一组对等点；客户端可以使用身份验证进行编码以发布到组，并且可以定期发布其 IP 地址，以便其他人可以请求一组已知的活动对等点。

如果你想变得非常棘手，你可以开始使用基本的隐写方法来隐藏对等位置信息。即在谷歌上搜索“blah”；找到结果中列出的第一个具有未受保护（无验证码）留言板的站点；找到以“Indubitably”（或其他）开头的第三个（或其他）帖子，并在那里找到第一条消息的标头，以及对等方的 IP 地址。如果这不起作用，请从搜索词列表中转到下一个。

但这是偷偷摸摸的。:-)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-22T00:38:59.010

您能否为此目的重新使用*现有的*专用服务器？

我特别考虑使用动态 DNS 注册每个对等点，但如果您愿意变得更丑陋，可以共享对已知 Hotmail 帐户或 Google Doc 等的访问权限。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-22T01:29:55.910

您可以使用中央目录或某种广播协议进行服务发现。假设你可以让它们被谷歌索引，你可以设想一个系统，每个对等点运行一个网站，在特定页面上包含一些独特的、罕见的词。然后，您可以使用基于这些词的 Google 搜索结果来识别潜在的同行。这本质上是一个（嘈杂而缓慢的）互联网广播。

如果页面结构是众所周知的模式或包含该对等方的可识别连接信息，则很容易在搜索结果中区分它们。使用这样的公共目录会使您对所形成的网络中的受感染节点敞开大门，但这对于任何缺少某些安全机制的 P2P 网络来说都是如此。

让谷歌（或其他搜索引擎）为您的特定神秘搜索词组抓取网站并对其进行高度排名将是诀窍。我可以想到几种方法，但它们不是我会使用的方法。对于合法的服务，我宁愿花钱或找一个可以充当目录的免费网站。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-02-19T18:10:23.323

另一个专门为跟踪其他 P2P 系统的在线对等点而构建的 P2P 系统呢？

然后，我们将寻找任何新 P2P 系统的对等点的问题简化为简单地为“主要”P2P 系统寻找对等点，这将为您提供您有兴趣使用的系统的在线对等点的地址......

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-29T17:50:01.673

这是分布式哈希表算法的典型使用。我建议看看糕点之类的东西。它在其他层之上使用覆盖网络（应用层网络）。

每个节点都有一个 GUID，用于跨对等网络路由请求。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-16T23:22:02.320

如果您正在寻找已经建立的中央服务器，请在此处查看页面上的元服务器条目：
[http](http://martindevans.appspot.com/)
://martindevans.appspot.com/ 您可以在那里注册对等点，然后其他对等点可以找到它们。显然这是一个中央服务器，但它不需要您进行维护。

# svn - 有人用过 OSX 的版本吗？

> ID：310613
> 
> 赞同：3
> 
> 时间：2008-11-22T00:16:22.877
> 
> 标签：svn, macos, tortoisesvn

有人用过OSX 的[版本吗？](http://versionsapp.com/)我主要想知道它是否可以完成[TortoiseSVN](http://tortoisesvn.tigris.org/)所做的所有事情，以及您是否可以将两者与同一个结帐 repo 一起使用？

**编辑：**我发现的一个问题是差异查看器。OSX 开发人员 FileMerger 并不是那么出色。TortoiseSVN 做到了这一点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T00:27:25.367

Versions 是一个非常好的 OSX SVN 客户端，它具有 TortoiseSVN 的所有功能，具有更好、更愉快的图形界面 :)

我特别喜欢时间轴视图，它非常有用。

你可以在 Tortoise 中使用它，但我不知道你为什么需要这样做，Tortoise 仅适用于 Windows。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-22T00:32:37.260

我在 5-6 周前试用了它，它看起来很可靠，但没有 TortoiseSVN 的所有功能，而且界面有些不一致。它有一个时间表，这是对历史非常有用的组织。

我看到他们在上周达到了 1.0 版，并且这些更改似乎涵盖了我认为缺少的所有内容。值得一试。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-22T00:45:05.783

正如 Paul 所说，v1.0 现已发布，感觉更加完整。它甚至看起来也有点光滑！

它具有我以前从 TortoiseSVN 使用的所有功能——除了我还没有弄清楚你是否可以从 GUI 设置 svn -ignore。至少，如果它已被设置，它确实尊重它。

您可以在 30 天试用期获得已发布的版本，那么为什么不自己检查一下（双关语）？就个人而言，我认为这是非常值得的少量费用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-22T01:35:37.443

是的，在过去的两周里我一直在使用 Versions，这已经足够让我不需要 Tortoise for Mac，我觉得它在覆盖 Niche 方面做得很好，特别是如果你认为 Versions 的存在时间不长的话给乌龟。

但是，除了版本之外，我还强烈建议您使用[SCPlugin](http://scplugin.tigris.org/)，它会为您提供像 Tortoise 一样的右键单击上下文菜单，这对于快速处理您的源代码很有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-22T01:41:34.607

osx 的另一个图形 svn 客户端是[Cornerstone](http://www.zennaware.com/cornerstone/)。

我还没有尝试过，但从屏幕截图和功能看起来很有希望。

# f# - 如何在 F# 中实现抽象类？

> ID：310619
> 
> 赞同：10
> 
> 时间：2008-11-22T00:24:26.667
> 
> 标签：f#, abstract-class

在我看过[这个](http://channel9.msdn.com/pdc2008/TL11/)PDC 会议之后，我想尝试学习一点 F#。所以我认为最好的方法是用 F# 重写我已经在 C# 中完成的东西，但我的大脑只是拒绝在功能模式下思考。我有这个抽象类，它有一些抽象方法和一些虚拟方法。我也想覆盖一些虚拟方法。这个类是用 C# 编写并编译的，我不打算用 F# 重写它。所以我的问题是：

1.  有没有人有一个关于如何实现抽象类、抽象方法和虚拟方法的简短示例
2.  我可以重载构造函数吗？
3.  如果我想在 dll 中编译它并使其可用于我的基于 C# 的程序，是否有任何限制。

任何帮助，将不胜感激。

* * *

更新：我真的很感谢布赖恩的回答，但我仍然不清楚，所以我想澄清一下。假设这是我用 C# 编写并用 dll 编译的抽象类。如何在 F# 中实现它？

```
public abstract class MyAbstractClass
{
    public abstract Person GetFullName(string firstName, string lastName);

    public abstract bool TryParse(string fullName, out Person person);

    public virtual IEnumerable<Person> GetChildren(Person parent)
    {
        List<Person> kids = new List<Person>();
        foreach(Child person in GroupOfPeople)
        {
            if(person.Parent == parent)
               kids.Add(child as Person);
        }
        return kids;
    }

    public virtual IEnumerable<Child> GroupOfPeople { get; set; }
} 
```

* * *

对于正在寻找一些 F# 资源的人的一些文档： - 如果任何其他 F# 有兴趣获得一些文档，我在 Don Syme（F# 的创建者）[他的书 F# Expert 的博客免费章节中](http://blogs.msdn.com/dsyme/archive/2006/12/18/DraftChaptersUpdateDec2006.aspx)找到了一些文档。您可以下载 doc 格式的文件。

*   Tomas Petricek 的真实世界函数式编程[在这里有免费章节](http://www.manning.com/petricek/petricek_meapch1.pdf)

其他一些可能感兴趣的资源：

*   [斯科特·汉塞尔曼的博客](http://www.hanselman.com/blog/TheWeeklySourceCode34TheRiseOfF.aspx)文章
*   [达斯汀坎贝尔的博客](http://diditwith.net/default.aspx)
*   [Tomas Petricek 的博客](http://tomasp.net/blog/)
*   F#的地方 - [hubFS](http://cs.hubfs.net/)
*   [F# 维基](http://www.strangelights.com/fsharp/wiki/default.aspx/FSharpWiki/HomePage.html)
*   [微软研究院](http://research.microsoft.com/fsharp/community.aspx)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-22T00:57:21.297

这是一些示例代码

```
type IBaz =
    abstract member Baz : int -> int

[<AbstractClass>]
type MyAbsClass() =
    // abstract
    abstract member Foo : int -> int
    // virtual (abstract with default value)
    abstract member Bar : string -> int
    default this.Bar s = s.Length 
    // concrete
    member this.Qux x = x + 1

    // a way to implement an interface
    abstract member Baz: int -> int
    interface IBaz with
        member this.Baz x = this.Baz x

type MySubClass(z : int) =
    inherit MyAbsClass()
    override this.Foo x = x + 2
    override this.Bar s = (base.Bar s) - 1
    override this.Baz x = x + 100
    member this.Z = z
    new () = MySubClass(0)

let c = new MySubClass(42)    
printfn "%d %d %d %d %d" c.Z (c.Foo 40) (c.Bar "two") (c.Qux 41) (c.Baz 42000) 
```

# python - Python 输入/输出，文件

> ID：310629
> 
> 赞同：4
> 
> 时间：2008-11-22T00:31:32.270
> 
> 标签：python

我需要编写一些方法来在二进制文件中加载/保存一些类。但是我也希望能够接受来自其他地方的二进制数据，例如二进制字符串。

在 c++ 中，我可以通过简单地让我的类方法使用 std::istream 和 std::ostream 来做到这一点，它们可以是文件、字符串流、控制台等。

python 是否有类似的输入/输出类，可以用来表示几乎任何形式的 i/o，或者至少是文件和内存？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-22T00:38:24.360

执行此操作的 Python 方法是接受一个实现 read() 或 write() 的对象。如果你有一个字符串，你可以用[StringIO](http://docs.python.org/library/stringio.html)做到这一点：

```
from cStringIO import StringIO

s = "My very long string I want to read like a file"
file_like_string = StringIO(s)
data = file_like_string.read(10) 
```

请记住，Python 使用鸭子类型：您不必涉及公共基类。只要你的对象实现了 read()，它就可以像文件一样被读取。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T19:01:04.120

[Pickle 和 cPickle](http://www.python.org/doc/2.5.2/lib/module-pickle.html)模块也可能对您有所帮助。

# ruby - 在 Ruby 中遍历数组的“正确”方法是什么？

> ID：310634
> 
> 赞同：379
> 
> 时间：2008-11-22T00:38:19.963
> 
> 标签：ruby, arrays, loops

PHP，尽管它的所有缺点，在这方面还是相当不错的。数组和哈希之间没有区别（也许我很天真，但这对我来说显然是正确的），并且迭代你只是做

```
foreach (array/hash as $key => $value) 
```

在 Ruby 中有很多方法可以做这种事情：

```
array.length.times do |i|
end

array.each

array.each_index

for i in array 
```

哈希更有意义，因为我总是使用

```
hash.each do |key, value| 
```

为什么我不能对数组执行此操作？如果我只想记住一种方法，我想我可以使用`each_index`（因为它使索引和值都可用），但是不得不这样做`array[index]`而不是仅仅`value`.

* * *

哦对了，我忘了`array.each_with_index`。然而，这个很糟糕，因为它去去去`|value, key|`去！这不是疯了吗？`hash.each``|key, value|`

* * *

## 回答 #1

> 赞同：606
> 
> 时间：2008-11-22T00:40:50.550

这将遍历所有元素：

```
array = [1, 2, 3, 4, 5, 6]
array.each { |x| puts x }

# Output:

1
2
3
4
5
6 
```

这将遍历所有元素，为您提供值和索引：

```
array = ["A", "B", "C"]
array.each_with_index {|val, index| puts "#{val} => #{index}" }

# Output:

A => 0
B => 1
C => 2 
```

从你的问题中我不太确定你在找哪一个。

* * *

## 回答 #2

> 赞同：101
> 
> 时间：2008-11-22T00:58:50.530

我认为没有一种*正确的*方法。有很多不同的迭代方式，每一种都有自己的利基。

*   `each`对于许多用途来说已经足够了，因为我不经常关心索引。
*   `each_ with _index`像 Hash#each 一样 - 你得到值和索引。
*   `each_index`- 只是索引。我不经常使用这个。相当于“长度.times”。
*   `map`是另一种迭代方式，当您想将一个数组转换为另一个数组时很有用。
*   `select`是要选择子集时使用的迭代器。
*   `inject`对于生成总和或产品，或收集单个结果很有用。

似乎要记住很多东西，但别担心，你可以在不知道所有这些的情况下度过难关。但是当你开始学习和使用不同的方法时，你的代码会变得更加清晰和清晰，并且你将走上掌握 Ruby 的道路。

* * *

## 回答 #3

> 赞同：61
> 
> 时间：2009-03-27T23:25:21.510

我并不是说`Array`->`|value,index|`和`Hash`->`|key,value|`并不疯狂（请参阅 Horace Loeb 的评论），但我是说有一种理智的方式可以期待这种安排。

当我处理数组时，我专注于数组中的元素（不是索引，因为索引是暂时的）。方法是each 带索引，即each+index，或|each,index|，或`|value,index|`。这也与被视为可选参数的索引一致，例如 |value| 等价于 |value,index=nil| 这与 |value,index| 一致。

当我处理哈希时，我通常更关注键而不是值，并且我通常按顺序处理键和值，要么`key => value`要么`hash[key] = value`。

如果您想要鸭式打字，那么要么显式使用 Brent Longborough 所示的定义方法，要么使用 maxhawkins 所示的隐式方法。

Ruby 就是让语言适应程序员，而不是程序员适应语言。这就是为什么有这么多方法。有很多方法可以思考某事。在 Ruby 中，您选择最接近的代码，其余代码通常非常简洁明了。

至于最初的问题，“在 Ruby 中迭代数组的“正确”方式是什么？”，好吧，我认为核心方式（即没有强大的语法糖或面向对象的能力）是：

```
for index in 0 ... array.size
  puts "array[#{index}] = #{array[index].inspect}"
end 
```

但是 Ruby 是关于强大的语法糖和面向对象的能力，但无论如何这里是哈希的等价物，键可以排序或不排序：

```
for key in hash.keys.sort
  puts "hash[#{key.inspect}] = #{hash[key].inspect}"
end 
```

所以，我的回答是，“在 Ruby 中迭代数组的“正确”方法取决于您（即程序员或编程团队）和项目。”。更好的 Ruby 程序员会做出更好的选择（选择哪种语法能力和/或哪种面向对象的方法）。更好的 Ruby 程序员继续寻找更多的方法。

* * *

现在，我想问另一个问题，“在 Ruby 中反向迭代 Range 的“正确”方法是什么？”！（这个问题是我如何来到这个页面的。）

这样做很好（对于前锋）：

```
(1..10).each{|i| puts "i=#{i}" } 
```

但我不喜欢这样做（向后）：

```
(1..10).to_a.reverse.each{|i| puts "i=#{i}" } 
```

好吧，我实际上并不介意这样做太多，但是当我在倒退教学时，我想向我的学生展示一个很好的对称性（即差异最小，例如只添加反向或步骤 -1，但没有修改其他任何东西）。你可以做（​​对称）：

```
(a=*1..10).each{|i| puts "i=#{i}" } 
```

和

```
(a=*1..10).reverse.each{|i| puts "i=#{i}" } 
```

我不太喜欢，但你做不到

```
(*1..10).each{|i| puts "i=#{i}" }
(*1..10).reverse.each{|i| puts "i=#{i}" }
#
(1..10).step(1){|i| puts "i=#{i}" }
(1..10).step(-1){|i| puts "i=#{i}" }
#
(1..10).each{|i| puts "i=#{i}" }
(10..1).each{|i| puts "i=#{i}" }   # I don't want this though.  It's dangerous 
```

你最终可以做到

```
class Range

  def each_reverse(&block)
    self.to_a.reverse.each(&block)
  end

end 
```

但我想教授纯 Ruby 而不是面向对象的方法（目前还没有）。我想向后迭代：

*   不创建数组（考虑 0..1000000000）
*   适用于任何范围（例如字符串，而不仅仅是整数）
*   不使用任何额外的面向对象的能力（即没有类修改）

我相信如果不定义方法这是不可能的`pred`，这意味着修改 Range 类以使用它。如果你能做到这一点，请告诉我，否则将不胜感激确认不可能，尽管它会令人失望。也许 Ruby 1.9 解决了这个问题。

（感谢您花时间阅读本文。）

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-11-22T00:44:06.767

两者都需要时使用 each_with_index。

```
ary.each_with_index { |val, idx| # ... 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-11-23T16:19:33.430

其他答案很好，但我想指出另一件外围的事情：数组是有序的，而哈希不在 1.8 中。（在 Ruby 1.9 中，哈希是按键的插入顺序排序的。）所以在 1.9 之前以与数组相同的方式/序列迭代哈希是没有意义的，数组总是有一个明确的顺序。我不知道 PHP 关联数组的默认顺序是什么（显然我的 google fu 也不够强大，无法弄清楚），但我不知道如何考虑常规 PHP 数组和 PHP 关联数组在这种情况下是“相同的”，因为关联数组的顺序似乎未定义。

因此，Ruby 的方式对我来说似乎更加清晰和直观。:)

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2015-08-21T17:07:08.447

以下是您的问题中列出的四个选项，按控制自由排列。您可能希望根据需要使用不同的。

1.  只需通过值：

    ```
    array.each 
    ```

2.  只需通过索引：

    ```
    array.each_index 
    ```

3.  遍历索引 + 索引变量：

    ```
    for i in array 
    ```

4.  控制循环计数 + 索引变量：

    ```
    array.length.times do | i | 
    ```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-11-22T13:57:01.770

尝试用数组和哈希一致地做同样的事情*可能*只是一种代码味道，但是，如果你正在寻找一致的行为，那么我可能会被贴上色彩斑斓的半猴子修补程序的烙印，这是否可以解决问题?:

```
class Hash
    def each_pairwise
        self.each { | x, y |
            yield [x, y]
        }
    end
end

class Array
    def each_pairwise
        self.each_with_index { | x, y |
            yield [y, x]
        }
    end
end

["a","b","c"].each_pairwise { |x,y|
    puts "#{x} => #{y}"
}

{"a" => "Aardvark","b" => "Bogle","c" => "Catastrophe"}.each_pairwise { |x,y|
    puts "#{x} => #{y}"
} 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-06-15T10:41:44.437

我一直在尝试使用哈希构建一个菜单（在*Camping*和*Markaby中）。*

每个项目有 2 个元素：一个**菜单标签**和一个**URL**，所以哈希看起来是正确的，但是 'Home' 的 '/' URL 总是出现在最后（正如你对哈希的期望一样），所以菜单项出现在错误的命令。

使用数组来`each_slice`完成这项工作：

```
['Home', '/', 'Page two', 'two', 'Test', 'test'].each_slice(2) do|label,link|
   li {a label, :href => link}
end 
```

为每个菜单项添加额外的值（例如 CSS *ID*名称）只是意味着增加切片值。因此，就像散列一样，但包含由任意数量的项目组成的组。完美的。

所以这只是为了感谢你无意中暗示了一个解决方案！

显而易见，但值得说明：我建议检查数组的长度是否可以被切片值整除。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-01-13T05:16:25.440

如果您使用[可枚举](http://www.ruby-doc.org/core/classes/Enumerable.html)的mixin（就像 Rails 一样），您可以执行与列出的 php 片段类似的操作。只需使用 each_slice 方法并展平哈希即可。

```
require 'enumerator' 

['a',1,'b',2].to_a.flatten.each_slice(2) {|x,y| puts "#{x} => #{y}" }

# is equivalent to...

{'a'=>1,'b'=>2}.to_a.flatten.each_slice(2) {|x,y| puts "#{x} => #{y}" } 
```

需要更少的猴子补丁。

但是，当您有一个递归数组或带有数组值的散列时，这确实会导致问题。在 ruby​​ 1.9 中，这个问题通过 flatten 方法的一个参数来解决，该参数指定递归的深度。

```
# Ruby 1.8
[1,2,[1,2,3]].flatten
=> [1,2,1,2,3]

# Ruby 1.9
[1,2,[1,2,3]].flatten(0)
=> [1,2,[1,2,3]] 
```

至于这是否是代码异味的问题，我不确定。通常，当我不得不向后弯腰迭代某些东西时，我会后退一步，并意识到我在解决问题上是错误的。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2014-09-29T12:11:09.117

在 Ruby 2.1 中，删除了 each_with_index 方法。相反，您可以使用[each_index](http://www.ruby-doc.org/core-2.1.3/Array.html#method-i-each_index)

例子：

```
a = [ "a", "b", "c" ]
a.each_index {|x| print x, " -- " } 
```

产生：

```
0 -- 1 -- 2 -- 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-01-09T16:52:14.603

正确的方式是您觉得最舒服的方式，并且按照您的意愿行事。在编程中，很少有一种“正确”的方式来做事，更多的是有多种方式可供选择。

如果您对某些做事方式感到满意，那就去做吧，除非它不起作用——那么是时候寻找更好的方式了。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2020-04-25T17:38:18.437

使用相同的方法迭代数组和哈希是有意义的，例如处理嵌套的哈希和数组结构，这些结构通常由解析器、读取 JSON 文件等产生。

尚未提及的一种巧妙方法是它是如何在标准库扩展的[Ruby Facets库中完成的。](http://rubyworks.github.io/facets/)从[这里](https://github.com/rubyworks/facets/blob/master/lib/core/facets/array/each_pair.rb)：

```
class Array

  # Iterate over index and value. The intention of this
  # method is to provide polymorphism with Hash.
  #
  def each_pair #:yield:
    each_with_index {|e, i| yield(i,e) }
  end

end 
```

已经有了[`Hash#each_pair`](https://ruby-doc.org/core-2.7.1/Hash.html#method-i-each)的别名`Hash#each`。所以在这个补丁之后，我们也有`Array#each_pair`并且可以互换地使用它来迭代哈希和数组。这修复了 OP 观察到的精神错乱，`Array#each_with_index`与`Hash#each`. 示例用法：

```
my_array = ['Hello', 'World', '!']
my_array.each_pair { |key, value| pp "#{key}, #{value}" }

# result: 
"0, Hello"
"1, World"
"2, !"

my_hash = { '0' => 'Hello', '1' => 'World', '2' => '!' }
my_hash.each_pair { |key, value| pp "#{key}, #{value}" }

# result: 
"0, Hello"
"1, World"
"2, !" 
```

# nhibernate - Fluent NHibernate：如何创建一对多的双向映射？

> ID：310641
> 
> 赞同：44
> 
> 时间：2008-11-22T00:42:30.937
> 
> 标签：nhibernate, fluent-nhibernate, nhibernate-mapping

**基本问题**：如何在 Fluent NHibernate 中创建双向一对多映射？

**细节：**

我有一个有很多孩子的父对象。在我的情况下，孩子没有父母是没有意义的，所以在数据库中，我希望父母的外键有 NOT NULL 约束。我正在从 Fluent NHibernate 映射自动生成我的数据库。

我有一个父母有很多像这样的子对象：

```
public class Summary
{
   public int id {get; protected set;}

   public IList<Detail> Details {get; protected set;}
}

public  class Detail
{
   public int id {get; protected set;}

   public string ItemName {get; set;}

  /* public Summary Owner {get; protected set;} */ //I think this might be needed for bidirectional mapping?
} 
```

这是我开始的映射：

```
public class SummaryMap : ClassMap<Summary>
{
    public SummaryMap()
    {
        Id(x => x.ID);

        HasMany<Detail>(x => x.Details);
    }
}

public class DetailMap : ClassMap<Detail>
{
    public DetailMap()
    {
        Id(x => x.ID);

        Map(x => x.ItemName).CanNotBeNull();
    }
} 
```

在 Detail 表中，Summary_id 应该为 Not Null，因为在我的情况下，没有附加到摘要对象的 Detail 对象是没有意义的。但是，仅使用 HasMany() 映射会使 Summary_id 外键为空。

我在 NHibernate 文档（[http://www.hibernate.org/hib_docs/nhibernate/html/collections.html](http://www.hibernate.org/hib_docs/nhibernate/html/collections.html)）中发现“如果需要父级，请使用双向一对多关联”。

那么如何在 Fluent NHibernate 中创建双向一对多映射呢？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-11-22T09:36:47.347

要获得与 Details 表中非空外键列的双向关联，您可以在 DetailsMap 类中添加建议的 Owner 属性、References(...).CanNotBeNull() 映射，并使 Summary 结束反转。

为避免两个关联方向有两个不同的外键列，您可以手动指定列名或以为两个方向提供相同列名的方式命名属性。在这种情况下，我建议您将 Details.Owner 属性重命名为 Details.Summary。

我制作了增量生成的摘要 ID，以避免插入表时出现问题，因为摘要当前除了 ID 之外没有其他列。

**领域：**

```
public class Detail
{
    public int id { get; protected set; }
    public string ItemName { get; set; }

    // Renamed to use same column name as specified in the mapping of Summary.Details
    public Summary Summary {get; set;} 
}

public class Summary
{
    public Summary()
    {
        Details = new List<Detail>();
    }

    public int id { get; protected set; }
    public IList<Detail> Details { get; protected set; }
} 
```

**映射：**

```
public class DetailMap : ClassMap<Detail>
{
    public DetailMap()
    {
        Id(x => x.id)
            .GeneratedBy.Native();

        Map(x => x.ItemName)
            .CanNotBeNull();

        References<Summary>(x => x.Summary)
            // If you don't want to rename the property in Summary,
            // you can do this instead:
            // .TheColumnNameIs("Summary_id")
            .CanNotBeNull();
    }
}

public class SummaryMap : ClassMap<Summary>
{
    public SummaryMap()
    {
        Id(x => x.id)
            .GeneratedBy.Increment();

        HasMany<Detail>(x => x.Details)
            .IsInverse()
            .AsBag(); // Use bag instead of list to avoid index updating issues
    }
} 
```

# dependencies - 列出 Merb::Slices 依赖项的最佳方法？

> ID：310642
> 
> 赞同：1
> 
> 时间：2008-11-22T00:42:58.843
> 
> 标签：dependencies, slice, merb

我正在我的 Merb 应用程序中创建切片列表，如下所示：

> Merb::Slices.each_slice 做 |slice|

我想获取每个切片的依赖项列表，知道如何访问它吗？

我仍在阅读 merb 代码，解决方案可能很快就会出现；）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T01:58:37.180

似乎不可能获得特定切片的依赖项列表。

下一个解决方案是解析切片 init.rb

在任务中发现了一些有趣的东西，全局依赖列表：

> Merb::BootLoader::Dependencies.dependencies

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-27T06:24:43.623

从理论上讲，您的切片应该捆绑为宝石。因此，您可以直接从 gem 本身中提取依赖项

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T01:05:45.460

我还没有使用切片，但据我了解，它们本身就像一个迷你 merb 应用程序，因此每个切片不会有一个`/config/dependencies.rb`? 也许这会被解析到程序中并且在某处可用。

[文档中](http://merbivore.com/documentation/1.1.0/doc/rdoc/stack/index.html?a=M000823&name=dependencies)可能有一些内容。

此外，这里是 Merb 常量上可用的方法（您可以从中获取环境之类的东西）。有一个称为依赖项，它返回一个数组（当我`merb -i`在应用程序中运行时它是空的）。

```
>> Merb.methods.sort
=> ["<", "<=", "<=>", "==", "===", "=~", ">", ">=", "JSON", "__caller_info__", "__caller_lines__", "__id__", "__profile__", "__send__", "abstract_method", "adapter", "adapter=", "add_generators", "add_mime_type", "add_rakefiles", "ancestors", "args_and_options", "assigns", "at_exit", "at_exit_procs", "autoload", "autoload?", "available_accepts", "available_mime_types", "b64encode", "blank?", "bundled?", "class", "class_eval", "class_variable_defined?", "class_variables", "clone", "config", "const_defined?", "const_get", "const_missing", "const_set", "constants", "context", "debugger", "decode64", "decode_b", "deep_clone", "deferred_actions", "dependencies", "dependency", "describe", "dir_for", "disable", "disabled?", "disabled_components", "disabled_components=", "display", "dup", "encode64", "encoded_hash", "enforce!", "enum_for", "env", "env?", "environment", "environment=", "environment_info", "environment_info=", "eql?", "equal?", "exception", "exiting", "exiting=", "extend", "extract_options_from_args!", "fatal!", "find_const", "forking_environment?", "framework_root", "freeze", "frozen?", "full_const_get", "full_const_set", "generators", "given", "glob_for", "hash", "id", "in?", "include?", "included_modules", "inline", "inspect", "instance_eval", "instance_method", "instance_methods", "instance_of?", "instance_variable_defined?", "instance_variable_get", "instance_variable_set", "instance_variables", "is_a?", "is_haml?", "j", "jj", "kind_of?", "klass_hashes", "klass_hashes=", "load_config", "load_dependencies", "load_dependency", "load_paths", "load_paths=", "log_path", "log_stream", "logger", "make_module", "merb", "merge_env", "meta_class", "method", "method_defined?", "methods", "mime_transform_method", "module_eval", "modules", "name", "nil?", "object_id", "on_jruby?", "on_windows?", "options", "orm", "orm=", "orm_generator_scope", "present?", "print_colorized_backtrace", "private_class_method", "private_instance_methods", "private_method_defined?", "private_methods", "protected_instance_methods", "protected_method_defined?", "protected_methods", "public_class_method", "public_instance_methods", "public_method_defined?", "public_methods", "push_path", "quacks_like?", "rakefiles", "reload", "remove_mime_type", "remove_paths", "rescue_require", "reset_logger!", "respond_to?", "restart_environment", "root", "root=", "root_path", "send", "share_as", "share_examples_for", "shared_examples_for", "should", "should_not", "singleton_methods", "start", "start_environment", "started", "started=", "started?", "taguri", "taguri=", "taint", "tainted?", "template_engine", "template_engine=", "test_framework", "test_framework=", "test_framework_generator_scope", "testing?", "to_a", "to_enum", "to_json", "to_s", "to_yaml", "to_yaml_properties", "to_yaml_style", "track_dependency", "trap", "try_dup", "type", "untaint", "use_orm", "use_template_engine", "use_test", "use_testing_framework", "yaml_as", "yaml_tag_class_name", "yaml_tag_read_class"] 
```

# eclipse - Eclipse 的 FindBugs 插件是否可以报告为错误而不是警告？

> ID：310645
> 
> 赞同：2
> 
> 时间：2008-11-22T00:44:58.047
> 
> 标签：eclipse, eclipse-plugin, code-analysis, findbugs

我正在处理一个非常大的遗留代码库。我们希望将 FindBugs 引入开发实践中。

每当代码由 Eclipse 构建时，我打算让 FindBugs 运行。

我希望能够使 findbugs 警告在代码中显示为错误，这样您就可以在 eclipse 中更改严重性级别

eclipse 是否可以将它产生的警告报告为错误？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-04-16T21:26:16.333

接受的答案现在已经过时了。我不知道它更改的版本，但 FindBugs Eclipse 插件首选项对话框的 Reporter Configuration 选项卡现在允许您将错误的每个严重性（Scariest、Scary、Troubling 和 Of Concern）配置为 Info、Warning 或 Error . 标记为错误的错误将导致构建失败。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T05:06:16.220

不，不可能让 FindBugs Eclipse 插件将潜在错误标记为代码中的错误。

我做了一些检查，[FindBugs Maven 插件](http://maven-plugins.sourceforge.net/maven-findbugs-plugin/index.html)也没有提供执行此操作的选项（所以那里也没有运气）。

我建议向 FindBugs Eclipse 插件开发人员记录 RFE（增强请求）。他们的错误跟踪数据库可[在此处](http://sourceforge.net/tracker/?atid=614693&group_id=96405&func=browse)获得。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-26T05:34:48.690

我不这么认为。Eclipse 中的错误由 Eclipse 的 JDT 编译器报告，而 FindBugs 插件只是通过插入 Eclipse 系统来报告警告。我不确定编译器是否可以知道 FindBugs 的存在并获取其警告列表以报告为错误。

但是，如果您因为 FindBugs 警告而试图让构建失败，您可以尝试他们的 ANT 任务，并在出现任何警告时导致构建失败。

# php - 解码通过 PHP 中的 cURL 检索到的 gzipped 网页

> ID：310650
> 
> 赞同：58
> 
> 时间：2008-11-22T00:50:29.580
> 
> 标签：php, encoding, gzip, decoding

我正在通过 curl 检索一个 gzipped 网页，但是当我将检索到的内容输出到浏览器时，我只得到原始 gzipped 数据。如何解码 PHP 中的数据？

我发现的一种方法是将内容写入 tmp 文件，然后...

```
$f = gzopen($filename,"r");
$content = gzread($filename,250000);
gzclose($f); 
```

....但是伙计，必须有更好的方法。

编辑：这不是一个文件，而是一个由网络服务器返回的压缩 html 页面。

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2010-05-17T13:21:55.533

我使用 curl 并且：

```
curl_setopt($ch, CURLOPT_ENCODING , "gzip"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-01-30T07:27:44.583

多功能 GUNZIP 功能：

```
   函数 gunzip($zipped) {
      $偏移量 = 0;
      if (substr($zipped,0,2) == "\x1f\x8b")
         $偏移量 = 2;
      if (substr($zipped,$offset,1) == "\x08") {
         # file_put_contents("tmp.gz", substr($zipped, $offset - 2));
         返回 gzinflate(substr($zipped, $offset + 8));
      }
      返回“未知格式”；
   }  

```

将函数与 CURL 集成的示例：

```
      $headers_enabled = 1;
      curl_setopt($c, CURLOPT_HEADER, $headers_enabled)
      $ret = curl_exec($c);

      如果（$headers_enabled）{
         # file_put_contents("preungzip.html", $ret);

         $sections = explode("\x0d\x0a\x0d\x0a", $ret, 2);
         while (!strncmp($sections[1], 'HTTP/', 5)) {
            $sections = explode("\x0d\x0a\x0d\x0a", $sections[1], 2);
         }
         $headers = $sections[0];
         $data = $sections[1];

         if (preg_match('/^Content-Encoding: gzip/mi', $headers)) {
            printf("找到 gzip 头\n");
            返回 gunzip($data);
         }
      }

      返回 $ret;

```

# javascript - strpos 没有在 Chrome 中定义？

> ID：310652
> 
> 赞同：4
> 
> 时间：2008-11-22T00:50:49.907
> 
> 标签：javascript, google-chrome

我在 javascript 中使用函数 strpos(string, string)。在 Firefox、Opera 和 IE 中，页面加载正常，但在 Chrome 中我收到错误：未捕获的 ReferenceError：strpos 未定义。我正在处理的页面是[http://seniorproject.korykirk.com/0xpi2.php](http://seniorproject.korykirk.com/0xpi2.php)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-22T01:02:36.030

使用[`haystack.indexOf(needle)`](http://www.w3schools.com/jsref/jsref_IndexOf.asp).

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-22T03:51:24.987

*strpos*不是[ECMAScript 语言规范 ECMA-262 第 3 版](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf)（通常称为 javascript）的一部分

就像 Artelius 写的那样，使用 [haystack.indexOf(needle,start)](http://www.w3schools.com/jsref/jsref_indexOf.asp)或[haystack.lastIndexOf(needle,start)](http://www.w3schools.com/jsref/jsref_lastIndexOf.asp)（其中*start*是可选的）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-10-01T13:29:55.117

如果要在 javascript 中使用 PHP 函数，请使用 php.js

这是`strpos()` [http://phpjs.org/functions/strpos:545](http://phpjs.org/functions/strpos:545)

# c# - ASP.NET MVC Beta 路由、控制器操作、参数和 ActionsLinks...把它们放在一起

> ID：310664
> 
> 赞同：1
> 
> 时间：2008-11-22T00:59:54.630
> 
> 标签：c#, asp.net-mvc

我在使用 ASP.NET MVC Beta 时遇到了一些问题，并且使路由、控制器操作、这些控制器操作上的参数和 Html.ActionLinks 一起工作的想法。我有一个正在开发的应用程序，其中有一个名为 Plot 的模型对象和一个相应的 PlotController。当用户创建一个新的 Plot 对象时，会生成一个 URL 友好名称（[即](https://stackoverflow.com/questions/37809/how-do-i-generate-a-friendly-url-in-c)）。然后，我想生成属于用户的绘图的“列表”，每个绘图都是一个链接，可以将用户导航到该绘图详细信息的视图。我希望该链接的 URL 看起来像这样： http: [//myapp.com/plot/my-plot-name](http://myapp.com/plot/my-plot-name). 我试图用下面的代码实现这一点，但它似乎不起作用，而且我似乎找不到任何好的示例来展示如何使所有这些一起工作。

我的路线定义：

```
routes.MapRoute( "PlotByName", "plot/{name}", new { controller = "Plot", action = "ViewDetails" } ); 
```

我的控制器动作：

```
[Authorize]
public ActionResult ViewDetails( string plotName )
{
    ViewData["SelectedPlot"] = from p in CurrentUser.Plots where p.UrlFriendlyName == plotName select p;
    return View();
} 
```

至于 ActionLink，我不确定生成适当的 URL 会是什么样子。

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T01:46:10.527

答案很简单：您必须在“ActionLink”中提供足够的值来满足您的路线。例子：

```
<%= Html.ActionLink("Click Here", "ViewDetails", "Plot", new { name="my-plot-name" }, null)%> 
```

如果您省略 ActionLink 方法的“name=”部分，那么 RouteEngine 将不会将此链接视为“匹配”的足够好......所以它会转到默认路由。

上面的代码将使 URL 看起来像您想要的那样。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T03:39:13.497

这个代码修复怎么样？（注意*name = null*，附加到第 4 行的末尾......）

```
routes.MapRoute( 
    "PlotByName", 
    "plot/{name}", 
    new { controller = "Plot", action = "ViewDetails", name = null }
); 
```

这应该重命名..（注意*plotName*重命名为*name*）

```
public ActionResult ViewDetails(string name ) { ... } 
```

这有帮助吗？

# wpf - 递归分层数据模板 (WPF)

> ID：310666
> 
> 赞同：5
> 
> 时间：2008-11-22T01:04:00.970
> 
> 标签：wpf, hierarchicaldatatemplate

我不知道如何解决这个问题：我想要一个 TreeView 来显示来自分层数据结构的一些简单数据。作为一个基本示例（在 XML 中，因为它很容易输入）：

```
<Node text="Root">
    <Node text="Item 1">
        <Node text="Item 1.1" />
    </Node>
    <Node text="Item 2"/>
</Node> 
```

问题在于，理论上这可以无限深地嵌套，因此您不能静态定义 x 个级别并完成它。有没有办法定义一个可以解释这种结构的 HierarchicalDataTemplate ？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-22T01:52:42.947

HeirarchicalDataTemplate 正是用来解决这类问题的。您可以使用像下面这样的简单模板来实现这一点。

```
 <HierarchicalDataTemplate DataType="Node" ItemsSource ="{Binding XPath=*}">
        <TextBlock Text="{Binding XPath=@text}" />
    </HierarchicalDataTemplate> 
```

# c# - 为什么包含 XML 标头时 C# XmlDocument.LoadXml(string) 会失败？

> ID：310669
> 
> 赞同：64
> 
> 时间：2008-11-22T01:04:34.993
> 
> 标签：c#, .net, xml

有谁知道为什么以下代码示例失败并出现 XmlException “根级别的数据无效。第 1 行，位置 1。”

```
var body = "<?xml version="1.0" encoding="utf-16"?><Report> ......"
XmlDocument bodyDoc = new XmlDocument();            
bodyDoc.LoadXml(body); 
```

* * *

## 回答 #1

> 赞同：120
> 
> 时间：2009-06-23T16:48:20.973

## 背景

尽管您的问题确实将编码设置为 UTF-16，但您没有正确转义字符串，所以我不确定您是否确实将字符串准确地转义到您的问题中。

我遇到了同样的例外：

> System.Xml.XmlException：根级别的数据无效。第 1 行，位置 1。

但是，我的代码如下所示：

```
string xml = "<?xml version=\"1.0\" encoding=\"utf-8\" ?>\n<event>This is a Test</event>";
XmlDocument xmlDoc = new XmlDocument();
xmlDoc.LoadXml(xml); 
```

## 问题

问题是字符串在 .NET 中内部存储为 UTF-16，但是 XML 文档标头中指定的编码可能不同。例如：

```
<?xml version="1.0" encoding="utf-8"?> 
```

从[这里](http://msdn.microsoft.com/en-us/library/system.string.aspx)的字符串的 MSDN 文档：

> 字符串中的每个 Unicode 字符由 Unicode 标量值定义，也称为 Unicode 代码点或 Unicode 字符的序数（数字）值。每个代码点都使用 UTF-16 编码进行编码，编码的每个元素的数值由一个 Char 对象表示。

这意味着当您通过 XmlDocument.LoadXml() 传递带有 XML 标头的字符串时，它必须说编码是 UTF-16。否则，实际的底层编码将与标头中报告的编码不匹配，并将导致引发 XmlException。

## 解决方案

此问题的解决方案是确保在您传递 Load 或 LoadXml 方法的任何内容中使用的编码与您在 XML 标头中所说的相匹配。在我上面的示例中，要么将您的 XML 标头更改为 UTF-16 状态，要么将输入编码为 UTF-8 并使用[XmlDocument.Load 方法](http://msdn.microsoft.com/en-us/library/system.xml.xmldocument.load.aspx)之一。

下面是演示如何使用 MemoryStream 使用定义 UTF-8 编码 XML 文档的字符串构建 XmlDocument 的示例代码（当然，存储的是 UTF-16 .NET 字符串）。

```
string xml = "<?xml version=\"1.0\" encoding=\"utf-8\" ?>\n<event>This is a Test</event>";

// Encode the XML string in a UTF-8 byte array
byte[] encodedString = Encoding.UTF8.GetBytes(xml);

// Put the byte array into a stream and rewind it to the beginning
MemoryStream ms = new MemoryStream(encodedString);
ms.Flush();
ms.Position = 0;

// Build the XmlDocument from the MemorySteam of UTF-8 encoded bytes
XmlDocument xmlDoc = new XmlDocument();
xmlDoc.Load(ms); 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2011-10-27T11:12:01.267

`LoadXml()`简单有效的解决方法：用方法代替`Load()`方法

例如：

```
XmlDocument xmlDoc = new XmlDocument();
xmlDoc.Load("sample.xml"); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-22T01:45:49.013

我想到了。阅读 MSDN 文档，它说从字符串读取时使用 .Load 而不是 LoadXml。发现这 100% 的时间有效。奇怪的是，使用 StringReader 会导致问题。我认为主要原因是这是一个 Unicode 编码的字符串，这可能会导致问题，因为 StringReader 只是 UTF-8。

```
MemoryStream stream = new MemoryStream();
            byte[] data = body.PayloadEncoding.GetBytes(body.Payload);
            stream.Write(data, 0, data.Length);
            stream.Seek(0, SeekOrigin.Begin);

            XmlTextReader reader = new XmlTextReader(stream);

            // MSDN reccomends we use Load instead of LoadXml when using in memory XML payloads
            bodyDoc.Load(reader); 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-09-18T09:38:32.723

尝试这个：

```
XmlDocument bodyDoc = new XmlDocument();
bodyDoc.XMLResolver = null;
bodyDoc.Load(body); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-12-01T18:02:33.910

这对我有用：

```
var xdoc = new XmlDocument { XmlResolver = null };  
xdoc.LoadXml(xmlFragment); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-05-17T09:17:05.500

这真的拯救了我的一天。

我已经根据 Zach 的回答编写了一个扩展方法，我还扩展了它以使用编码作为参数，允许使用除 UTF-8 之外的不同编码，并且我将 MemoryStream 包装在一个“使用”语句中。

```
public static class XmlHelperExtentions
{
    /// <summary>
    /// Loads a string through .Load() instead of .LoadXml()
    /// This prevents character encoding problems.
    /// </summary>
    /// <param name="xmlDocument"></param>
    /// <param name="xmlString"></param>
    public static void LoadString(this XmlDocument xmlDocument, string xmlString, Encoding encoding = null) {

        if (encoding == null) {
            encoding = Encoding.UTF8;
        }

        // Encode the XML string in a byte array
        byte[] encodedString = encoding.GetBytes(xmlString);

        // Put the byte array into a stream and rewind it to the beginning
        using (var ms = new MemoryStream(encodedString)) {
            ms.Flush();
            ms.Position = 0;

            // Build the XmlDocument from the MemorySteam of UTF-8 encoded bytes
            xmlDocument.Load(ms);
        }
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-11-05T17:50:40.787

当我的 xml 文件从绝对路径切换到相对路径时，我遇到了同样的问题。以下解决了加载和使用相对源路径问题。使用在 xaml 中定义的 XmlDataProvider（也应该在代码中）：

```
 <Window.Resources>
    <XmlDataProvider 
        x:Name="myDP"
        x:Key="MyData"
        Source=""
        XPath="/RootElement/Element"
        IsAsynchronous="False"
        IsInitialLoadEnabled="True"                         
        debug:PresentationTraceSources.TraceLevel="High"  /> </Window.Resources> 
```

设置源后，数据提供者会自动加载文档。这是代码：

```
 m_DataProvider = this.FindResource("MyData") as XmlDataProvider;
        FileInfo file = new FileInfo("MyXmlFile.xml");

        m_DataProvider.Document = new XmlDocument();
        m_DataProvider.Source = new Uri(file.FullName); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-06-14T11:12:05.590

我遇到了同样的问题，因为我上传的 XML 文件是使用 UTF-8-BOM（UTF-8 字节顺序标记）编码的。

在 Notepad++ 中将编码切换为 UTF-8，并能够在代码中加载 XML 文件。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-06-06T19:14:05.843

简单线：

`bodyDoc.LoadXml(new MemoryStream(Encoding.Unicode.GetBytes(body)));`

# apache-flex - 除了 ValidateNow() 之外，还有哪些方法可以重新格式化/重新验证 Flex 中的控件树

> ID：310672
> 
> 赞同：0
> 
> 时间：2008-11-22T01:08:15.550
> 
> 标签：apache-flex, formatting

我在调用时遇到多行文本无法正确重新格式化的问题`loadStyleDeclarations`。但是，如果我两次加载相同的样式表，那么它会正确刷新并重新格式化文本。

所以我想做的是刷新我的控件，让它重新格式化文本。我已经尝试过`ValidateNow()`，`ValidateDisplayList()`但似乎都没有引起正确的布局请求。

我猜想`loadStyleDeclarations()`调用其他一些重新验证功能，但我找不到它是什么。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T04:54:31.443

尝试在您的组件上调用 invalidateProperties() 和/或 invalidateDisplayList()。这应该会导致组件在下一次屏幕更新时重新呈现。

# c# - 使用 DataAdapter 批量更新

> ID：310680
> 
> 赞同：0
> 
> 时间：2008-11-22T01:17:25.827
> 
> 标签：c#, .net, ado.net, dataset, dataadapter

我有一种情况，我有一堆都需要执行的 SQL 更新命令。我知道 DataSets 可以进行批量更新，但我能够完成它的唯一方法是首先将整个表加载到数据集中。如果我只想更新表中记录的子集怎么办？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T07:25:03.907

这里最简单的方法是加载具有所需行（您要更新的行）的表。仔细检查 RowState 是否为“已插入”。使用执行“更新”的存储过程（包装在 SqlCommand 中）分配适配器的 InsertCommand 属性，此调整将确保表中存在的所有行都得到更新。

这里的基础是：DataAdapter 对状态为已更新的行运行 UpdateCommand，为状态为已插入的行运行 InsertCommand，最后为状态为已删除的行运行 DeleteCommand。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T04:38:09.150

EDITED: Based on your comment, I'd recommend using the Bulk Copy method to go to a staging table first. Then you can do a single update on your real table based on the staging table.

=========

One way is to build the SQL Command yourself; however, I'd recommend reading about the SQL Injection possibilities to protect yourself. Depending on your situation and your platform there are other options.

For example if you are dealing with a lot of data, then you could do a bulk import into a holding table, which you would then issue a single update command off of. I've also had good success passing records in as XML (I found in my environment that I needed at least 50 rows to offset the cost of loading the DOM, and I knew that the scalability issues were not a factor in my case).

Some other things I've seen was people package the updates into a binary field, for example one binary field for each column, then they have a function which unpacks the binary field. Again you will want to test with your environment.

With that said, have you verified that simply calling a single update command or stored procedure for each update you need is not sufficent? You might not even need to batch the commands up.

*   Josh

Watch out for Premature Optimization it can be killer!

# c# - 弱参考优势

> ID：310685
> 
> 赞同：74
> 
> 时间：2008-11-22T01:20:56.257
> 
> 标签：c#, winforms, memory, reference, weak-references

有人可以解释 C# 中不同类型引用的主要好处吗？

*   弱引用
*   软参考
*   幻影参考
*   强引用。

我们有一个消耗大量内存的应用程序，我们正在尝试确定这是否是一个需要关注的领域。

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-11-22T02:00:52.620

我相信软引用和幻像引用来自 Java。长弱引用（将 true 传递给 C# 的 WeakReference 构造函数）可能被认为类似于 Java 的 PhantomReference。如果在 C# 中有类似 SoftReference 的东西，我不知道它是什么。

弱引用不会延长对象的生命周期，因此一旦所有强引用都超出范围，就可以对其进行垃圾回收。它们对于保持初始化成本很高的大型对象很有用，但如果它们没有被积极使用，它们应该可用于垃圾收集。

这是否有助于减少应用程序的内存消耗将完全取决于应用程序的具体情况。例如，如果您周围有适量的缓存对象，这些对象将来可能会或可能不会被重用，弱引用可以帮助改善缓存的内存消耗。但是，如果应用程序正在处理大量小对象，弱引用会使问题变得更糟，因为引用对象将占用更多或更多的内存。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-11-22T02:31:20.297

[MSDN 对弱引用](http://msdn.microsoft.com/en-us/library/ms404247.aspx)有很好的解释。关键引用在底部，它说：

> **避免使用弱引用作为内存** **管理问题的****自动解决方案** 。相反，开发一个有效的缓存策略来处理您的应用程序的对象。

 **每次我在野外看到 WeakReference 时，它​​都被用作内存管理问题的自动解决方案。对于您的应用程序问题，可能有更好的解决方案。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2014-01-29T20:18:20.527

[在Android 开发教程](http://developer.android.com/training/displaying-bitmaps/process-bitmap.html)中解释了 WeakReference 的精彩真实示例。

视图（ImageView）上有一个图像（Bitmap）和图像容器。如果图像不是从内存加载（而是从磁盘、网络），那么它可以锁定 UI 线程和屏幕。为了避免这种情况，可以使用异步任务。

异步任务完成时会出现问题。图像容器在那个时候可能根本没有用（屏幕改变或Android在滚动后卸载不可见的视图部分）。WeakReference 可以在这里提供帮助，ImageView 将被垃圾收集。

```
class BitmapWorkerTask extends AsyncTask<Integer, Void, Bitmap> {
    private final WeakReference<ImageView> imageViewReference;

    public BitmapWorkerTask(ImageView imageView) {
        imageViewReference = new WeakReference<ImageView>(imageView);
    }
    // Method for getting bitmap is removed for code clearness

    // Once complete, see if ImageView is still around and set bitmap.
    @Override
    protected void onPostExecute(Bitmap bitmap) {
        if (imageViewReference != null && bitmap != null) {
            final ImageView imageView = imageViewReference.get();
            if (imageView != null) {
                imageView.setImageBitmap(bitmap);
            }
        }
    }
} 
```

PS 示例是用 Java 编写的，但 C# 开发人员可以理解。
来源：http: [//developersdev.blogspot.ru/2014/01/weakreference-example.html](http://developersdev.blogspot.ru/2014/01/weakreference-example.html)

# nhibernate - NHibernate - 用于管理 SessionFactory/Session 的完整工作助手类

> ID：310691
> 
> 赞同：21
> 
> 时间：2008-11-22T01:27:06.493
> 
> 标签：nhibernate

任何人都可以提供/引用适当的 OO 类型帮助器类来管理 SessionFactory 的单例，然后还用于管理 Sessions？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-22T05:06:58.750

Check out [Billy McCafferty's work](http://www.codeproject.com/KB/architecture/NHibernateBestPractices.aspx). His earlier version had some limitations, you'll need to correct the error handling around closing and flushing, and I'm not sure i have it right but I will post how I modified his stuff.

Billy is also working on a new framework that uses MVC & nHibernate called S[#arp Architechure](http://code.google.com/p/sharp-architecture/) which I'm currently using, and so far so good.

Anyways here's my modified version of his code. I make no guanrtees on accuracy or completness and you are using this on your own risk. If you use this make sure you close the session out. If you have any questions drop me an email [joshua][dot][berke] at [gmail...you know the rest].

```
/// <summary>
/// Handles creation and management of sessions and transactions.  It is a singleton because 
/// building the initial session factory is very expensive. Inspiration for this class came 
/// from Chapter 8 of Hibernate in Action by Bauer and King.  Although it is a sealed singleton
/// you can use TypeMock (http://www.typemock.com) for more flexible testing.
/// </summary>
public sealed class NHibernateSessionManager
{
    private const string DefaultConfigFile = "DefaultAppWeb.Config";
    private static readonly object _syncRoot = new object();
    #region Thread-safe, lazy Singleton

/// <summary>
/// This is a thread-safe, lazy singleton.  See http://www.yoda.arachsys.com/csharp/singleton.html
/// for more details about its implementation.
/// </summary>
public static NHibernateSessionManager Instance
{
    get
    {
        return Nested.NHibernateSessionManager;
    }
}

/// <summary>
/// Private constructor to enforce singleton
/// </summary>
private NHibernateSessionManager() { }

/// <summary>
/// Assists with ensuring thread-safe, lazy singleton
/// </summary>
private class Nested
{
    static Nested() { }
    internal static readonly NHibernateSessionManager NHibernateSessionManager =
        new NHibernateSessionManager();
}

#endregion

/// <summary>
/// This method attempts to find a session factory stored in <see cref="sessionFactories" />
/// via its name; if it can't be found it creates a new one and adds it the hashtable.
/// </summary>
/// <param name="sessionFactoryConfigPath">Path location of the factory config</param>
private ISessionFactory GetSessionFactoryFor(string sessionFactoryConfigPath)
{
    Check.Require(!string.IsNullOrEmpty(sessionFactoryConfigPath),
        "sessionFactoryConfigPath may not be null nor empty");

    //  Attempt to retrieve a stored SessionFactory from the hashtable.
    ISessionFactory sessionFactory;// = (ISessionFactory)sessionFactories[sessionFactoryConfigPath];

    //  try and get a session factory if we don't find one create it
    lock (_syncRoot)
    {
        if (!sessionFactories.TryGetValue(sessionFactoryConfigPath, out sessionFactory))
        {
            Configuration cfg = new Configuration();
            if (sessionFactoryConfigPath != DefaultConfigFile)
            {
                Check.Require(File.Exists(sessionFactoryConfigPath),
                    "The config file at '" + sessionFactoryConfigPath + "' could not be found");
                cfg.Configure(sessionFactoryConfigPath);

            }
            else
            {
                cfg.Configure();
            }

            //  Now that we have our Configuration object, create a new SessionFactory
            sessionFactory = cfg.BuildSessionFactory();

            Check.Ensure(sessionFactory != null, "sessionFactory is null and was not built");
            sessionFactories.Add(sessionFactoryConfigPath, sessionFactory);
        }
    }

    return sessionFactory;
}

/// <summary>
/// Allows you to register an interceptor on a new session.  This may not be called if there is already
/// an open session attached to the HttpContext.  If you have an interceptor to be used, modify
/// the HttpModule to call this before calling BeginTransaction().
/// </summary>
public void RegisterInterceptorOn(string sessionFactoryConfigPath, IInterceptor interceptor)
{
    ISession session = (ISession)ContextSessions[sessionFactoryConfigPath];

    if (session != null && session.IsOpen)
    {
        throw new CacheException("You cannot register an interceptor once a session has already been opened");
    }

    GetSessionFrom(sessionFactoryConfigPath, interceptor);
}

public ISession GetSessionFrom(string sessionFactoryConfigPath)
{
    return GetSessionFrom(sessionFactoryConfigPath, null);
}
/// <summary>
/// Gets or creates an ISession using the web / app config file.
/// </summary>
/// <returns></returns>
public ISession GetSessionFrom()
{
    return GetSessionFrom(DefaultConfigFile, null);
}
/// <summary>
/// Gets a session with or without an interceptor.  This method is not called directly; instead,
/// it gets invoked from other public methods.
/// </summary>
private ISession GetSessionFrom(string sessionFactoryConfigPath, IInterceptor interceptor)
{
    var allSessions = ContextSessions;
    ISession session = null;
    if (!allSessions.TryGetValue(sessionFactoryConfigPath, out session))
    {
        if (interceptor != null)
        {
            session = GetSessionFactoryFor(sessionFactoryConfigPath).OpenSession(interceptor);
        }
        else
        {
            session = GetSessionFactoryFor(sessionFactoryConfigPath).OpenSession();
        }

        allSessions[sessionFactoryConfigPath] = session;
    }

    //session.FlushMode = FlushMode.Always;

    Check.Ensure(session != null, "session was null");

    return session;
}

/// <summary>
/// Flushes anything left in the session and closes the connection.
/// </summary>
public void CloseSessionOn(string sessionFactoryConfigPath)
{
    ISession session;
    if (ContextSessions.TryGetValue(sessionFactoryConfigPath, out session))
    {
        if (session.IsOpen)
        {
            session.Flush();
            session.Close();
        }
        ContextSessions.Remove(sessionFactoryConfigPath);

    }

}

public ITransaction BeginTransactionOn(string sessionFactoryConfigPath)
{
    ITransaction transaction;

    if (!ContextTransactions.TryGetValue(sessionFactoryConfigPath, out transaction))
    {
        transaction = GetSessionFrom(sessionFactoryConfigPath).BeginTransaction();
        ContextTransactions.Add(sessionFactoryConfigPath, transaction);
    }

    return transaction;
}

public void CommitTransactionOn(string sessionFactoryConfigPath)
{

    try
    {
        if (HasOpenTransactionOn(sessionFactoryConfigPath))
        {
            ITransaction transaction = (ITransaction)ContextTransactions[sessionFactoryConfigPath];

            transaction.Commit();
            ContextTransactions.Remove(sessionFactoryConfigPath);
        }
    }
    catch (HibernateException he)
    {
        try
        {
            RollbackTransactionOn(sessionFactoryConfigPath);
        }
        finally
        {
            throw he;
        }
    }
}

public bool HasOpenTransactionOn(string sessionFactoryConfigPath)
{
    ITransaction transaction;
    if (ContextTransactions.TryGetValue(sessionFactoryConfigPath, out transaction))
    {

        return !transaction.WasCommitted && !transaction.WasRolledBack;
    }
    return false;
}

public void RollbackTransactionOn(string sessionFactoryConfigPath)
{

    try
    {
        if (HasOpenTransactionOn(sessionFactoryConfigPath))
        {
            ITransaction transaction = (ITransaction)ContextTransactions[sessionFactoryConfigPath];

            transaction.Rollback();
        }

        ContextTransactions.Remove(sessionFactoryConfigPath);
    }
    finally
    {

        ForceCloseSessionOn(sessionFactoryConfigPath);
    }
}

/// <summary>
/// Since multiple databases may be in use, there may be one transaction per database 
/// persisted at any one time.  The easiest way to store them is via a hashtable
/// with the key being tied to session factory.  If within a web context, this uses
/// <see cref="HttpContext" /> instead of the WinForms specific <see cref="CallContext" />.  
/// Discussion concerning this found at http://forum.springframework.net/showthread.php?t=572
/// </summary>
private Dictionary<string, ITransaction> ContextTransactions
{
    get
    {
        if (IsInWebContext())
        {
            if (HttpContext.Current.Items[TRANSACTION_KEY] == null)
                HttpContext.Current.Items[TRANSACTION_KEY] = new Dictionary<string, ITransaction>();

            return (Dictionary<string, ITransaction>)HttpContext.Current.Items[TRANSACTION_KEY];
        }
        else
        {
            if (CallContext.GetData(TRANSACTION_KEY) == null)
                CallContext.SetData(TRANSACTION_KEY, new Dictionary<string, ITransaction>());

            return (Dictionary<string, ITransaction>)CallContext.GetData(TRANSACTION_KEY);
        }
    }
}

/// <summary>
/// Since multiple databases may be in use, there may be one session per database 
/// persisted at any one time.  The easiest way to store them is via a hashtable
/// with the key being tied to session factory.  If within a web context, this uses
/// <see cref="HttpContext" /> instead of the WinForms specific <see cref="CallContext" />.  
/// Discussion concerning this found at http://forum.springframework.net/showthread.php?t=572
/// </summary>
private Dictionary<string, ISession> ContextSessions
{
    get
    {
        if (IsInWebContext())
        {
            if (HttpContext.Current.Items[SESSION_KEY] == null)
                HttpContext.Current.Items[SESSION_KEY] = new Dictionary<string, ISession>();

            return (Dictionary<string, ISession>)HttpContext.Current.Items[SESSION_KEY];
        }
        else
        {
            if (CallContext.GetData(SESSION_KEY) == null)
                CallContext.SetData(SESSION_KEY, new Dictionary<string, ISession>());

            return (Dictionary<string, ISession>)CallContext.GetData(SESSION_KEY);
        }
    }
}

private bool IsInWebContext()
{
    return HttpContext.Current != null;
}

private Dictionary<string, ISessionFactory> sessionFactories = new Dictionary<string, ISessionFactory>();
private const string TRANSACTION_KEY = "CONTEXT_TRANSACTIONS";
private const string SESSION_KEY = "CONTEXT_SESSIONS";

public bool HasOpenTransactionOn()
{
    return HasOpenTransactionOn(DefaultConfigFile);
}

public void CommitTransactionOn()
{
    CommitTransactionOn(DefaultConfigFile);
}

public void CloseSessionOn()
{
    CloseSessionOn(DefaultConfigFile);
}

public void ForceCloseSessionOn()
{
    ForceCloseSessionOn(DefaultConfigFile);

}

public void ForceCloseSessionOn(string sessionFactoryConfigPath)
{
    ISession session;
    if (ContextSessions.TryGetValue(sessionFactoryConfigPath, out session))
    {
        if (session.IsOpen)
        {

            session.Close();
        }
        ContextSessions.Remove(sessionFactoryConfigPath);

    }
}

public void BeginTransactionOn()
{
    this.BeginTransactionOn(DefaultConfigFile);
}

public void RollbackTransactionOn()
{
    this.RollbackTransactionOn(DefaultConfigFile);
} 
```

}

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-23T02:45:11.267

过去，我使用 Spring.NET 的 NHibernate 支持模块取得了巨大的成功。请参阅[http://www.springframework.net/downloads/Spring.Data.NHibernate/](http://www.springframework.net/downloads/Spring.Data.NHibernate/)。您应该能够使用 OpenSessionInView 模块并从 NHibernateSupport DAO 扩展您的 DAO 以获得对[视图模式中打开会话的](http://www.hibernate.org/43.html)全面管理支持。

此外，虽然我从未尝试过，但即使您选择退出 Spring.NET 产品（即 IoC 和 AOP）的重置，您也应该能够使用上述框架。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T03:46:56.663

当然，这是我开始使用 NHibernate 时使用的：

**会话工厂**

```
public class BaseDataAccess
{

  protected ISession m_session;

  public BaseDataAccess()
  {
    m_session = NHibernateHttpModule.CurrentSession;
  }

  public static ISession OpenSession()
  {
    Configuration config;
    ISessionFactory factory;
    ISession session;
    config = new Configuration();

    if (config == null)
    {
      throw new ArgumentNullException(nameof(config));
    }
    if (factory == null)
    {
      throw new ArgumentNullException(nameof(factory);
    }
    if (session == null)
    {
      throw new ArgumentNullException(nameof(session));
    }

    config.AddAssembly("My.Assembly.Here");
    factory = config.BuildSessionFactory();
    session = factory.OpenSession();

    return session;
  }
} 
```

让我知道这是否有帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-28T22:28:09.223

两个建议：

*   Jeffrey Palermo 的 HybridSessionBuilder (jeffreypalermo.com/blog/use-this-nhibernate-wrapper-to-keep-your-repository-classes-simple)
*   请参阅 NHibernate 之夏 (www.summerofnhibernate.com) 中的代码示例（具体参见第 13 节）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-21T18:33:45.623

您可能想考虑通过利用 NHibernate.Burrow（或您自己实现类似的模式）来减少 DAL 对管理 NHibernate 会话的关注。

“NHibernate.Burrow 是一个轻量级的中间件，通过提供先进和智能的会话/事务管理和其他便利来支持使用 NHibernate 的 .Net 应用程序。”

如果您决定自己推出，则此页面底部有一些有用的链接：

一个有用的谷歌搜索词是“NHibernate Session Management”和“Contextual Sessions”......

不乏创意——你可以说有太多的选择，希望意见会开始围绕着洞穴或类似的东西......

# ant - 使用 Emma 和 Ant 设置覆盖阈值

> ID：310699
> 
> 赞同：3
> 
> 时间：2008-11-22T01:34:23.827
> 
> 标签：ant, code-coverage, emma

我在我的 ant 构建中使用 Emma 来执行覆盖率报告。对于那些使用 Emma 的人，如果线路覆盖率（或任何类型的覆盖率统计）不满足特定阈值，是否有办法让构建失败？例如，如果线路覆盖率不是 100%

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T01:46:43.880

不是开箱即用。

但是，可以为、 和设置 的[`report.metrics`](http://emma.sourceforge.net/reference/ch03s02.html#prop-ref.report.metrics)属性或属性。请参阅Emma 参考中的[覆盖率指标](http://emma.sourceforge.net/reference/ch02s04.html)。`<report></report>``name, class, method, block``line`

使用纯文本报告，然后使用正则表达式过滤器来设置失败条件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-08-20T20:02:42.753

我写了一个蚂蚁任务来做到这一点。

您应该能够在我的[EmmaCheck 网站](http://mchr3k.github.com/emmacheck/)上找到您需要的所有信息。

# c# - C# 应用程序中异常的含义：“不是合法的 OleAut 日期”？

> ID：310700
> 
> 赞同：19
> 
> 时间：2008-11-22T01:35:24.370
> 
> 标签：c#, winforms, datetime

有谁知道这是什么意思。在 C# winforms 应用程序中获取此信息：

> 不是合法的 OleAut 日期

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-22T15:49:18.313

这意味着程序中的某处正试图在有效范围 1-January-4713 BC 到 31-December-9999 AD 之外的 OLE 自动化日期转换。它可能已通过，因为 OLE 自动化日期表示为**double**。

首先寻找这些方法的任何用途：

[日期时间.FromOADate](http://msdn.microsoft.com/en-us/library/system.datetime.fromoadate.aspx)

[日期时间.ToOADate](http://msdn.microsoft.com/en-us/library/system.datetime.tooadate.aspx)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-22T15:50:30.650

OADate 表示为双精度值，其值为从 1899 年 12 月 30 日午夜开始的天数（负值表示较早的日期）。

尝试将 Ole 自动化日期有效范围之外的值与 .NET DateTime 值（方法 DateTime.FromOADate 和 DateTime.ToOADate - 也隐式用于 COM 互操作）转换时，将引发此异常。

我认为对于转换为 OADate 有效，.NET DateTime 值必须严格大于 01/01/0100。

要将 OADate 转换为 .NET DateTime 值，双精度值需要严格大于 -657435 (= 01/01/0100) 并且严格小于 2958466.0 (01/01/10000)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T01:47:07.857

这意味着您在某处提供了无效的日期，试图转换为有效范围之外的 OLE 自动化日期或从 1-January-4713 BC 到 31-December-9999 AD。一个可能的原因是它可能已通过，因为 OLE 自动化日期表示为双精度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T14:57:39.913

其他人一直在为此苦苦挣扎。我建议在[DotNetNuke](http://www.dotnetnuke.com/Community/ForumsDotNetNuke/tabid/795/forumid/8/threadid/64010/scope/posts/Default.aspx)和[DevShed](http://forums.devshed.com/net-development-87/not-a-legal-oleaut-date-error-337459.html)上查看这些线程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-12T14:29:33.883

我用过：

```
try
{
    if (folderItem.ModifyDate.Year != 1899)
    {
        this.FileModifiedDate = folderItem.ModifyDate.ToShortDateString() + 
            " " +
            folderItem.ModifyDate.ToLongTimeString();
    }
}
//we need this because it throws an exception if it's an invalid date...
catch (ArgumentException) { } 
```

处理我遇到的同样的问题。当我们检查我的年份时，它会抛出异常。在无效日期什么都不做正是我想要的行为，所以这个 hack 有效。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-11-05T20:54:31.150

我发现，具有较大 row_id '257381195' 的列正试图被 Excel 作为日期读取。我最终做的是通过在 row_id 前面加上一个单引号将该列的数据更改为字符串。这解决了我的问题。希望这可以帮助。

# svn - Subversion 提交问题：XML 数据格式不正确

> ID：310703
> 
> 赞同：3
> 
> 时间：2008-11-22T01:37:45.537
> 
> 标签：svn, apache, commit, webdav

我遇到了 SVN 的奇怪行为。我在 Apache 2.2.9 上使用 mod_dav、mod_dav_svn 和 SVN 1.5.2 运行了 SVN 存储库。当我尝试签出（从远程 1.5.4 客户端或服务器本地 1.5.2 客户端 - 两个“默认”svn 二进制文件）时，我得到类似：

mx-mac:Test mx$ svn ci -m "" 添加 test.txt svn: Commit failed (详情如下): svn: XML data was not well-formed

我通过嗅探 HTTP 连接发现的是，对远程 SVN 存储库 (Apache) 的一个请求以“由对等方重置”结束，并且不返回响应（使用 HTTP Scoop 嗅探）。

至于Apache的配置，所有的模块都是加载的。为 repo 设置了适当的权限，并且 repo 是由 svnadmin create 创建的，然后被 chowned 给 apache 用户（无论如何，即使我有 chmod -R 777 repo 目录，它也不起作用）。

Apache 配置包含 DAV 和 SVNPath 指令以及身份验证。

经过几个小时的尝试，我非常绝望，所以如果有人遇到过这样的问题，请告诉我。非常感谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T01:48:49.773

最后，我发现在 .htaccess 文件中为与 SVN 相同的 VirtualHost 重新定义 ErrorDocument 会导致在某些情况下将无效数据发送到 SVN 客户端，并且由于某种原因在提交过程中被拦截。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T02:05:30.097

虽然理论上解决这样的问题是有教育意义的，但生命太短了，我已经精通其他事情了，为此我得到报酬来成为专家，所以我对任何 svn 问题的后备解决方案是这个：离开工作副本，在其他地方创建一个新目录，从存储库中重新签出任何分支，然后通过从混乱的签出处复制来手动更新您知道已更改的文件。

至于apache，我敢打赌它不会有任何麻烦。提交失败几乎总是由于与存储库的连接以外的其他原因。（假设没有人在修补 apache 或 svn 服务器。）不能保证，但尝试新签出和手动复制文件可能会起作用，或者至少会显示新的诊断信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T11:41:44.303

达人，你现在不完全正确。我已经尝试了所有可能的工作副本、新存储库等组合。我几乎什么都试过了。最后，我在 NEON 调试消息中发现了一条奇怪的消息，在主页上显示了我的 404 页面，我几乎忘记了。然后，我意识到 - 正如很久以前创建的那样 - 我从 404 页面（200 而不是 404）发送了不正确的 HTTP 状态代码，因此 NEON 认为它是正确的输出和处理，使其处于某种不正确的状态。

所以，现在是 apache 问题，由愚蠢的 Web 开发人员 - 我在 2003 年引起的...... :)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-06T02:13:29.797

我发现这是由于没有使用正确的 URL 来检查内容造成的。当我输入结帐命令时，我正在使用 Web 服务器提供的 url，例如“svn co [http://blah.com/stuff_in_here/contents](http://blah.com/stuff_in_here/contents) ”，然后我使用该 url 直到找到我可以使用的真实 svn 位置在命令行中，例如**“** [http://blah.com/svn/contents](http://blah.com/) ”

 *** * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-26T13:42:11.040

这也让我很困扰。我通过删除我的工作区并再次检查它来解决它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-01-09T11:53:35.023

我得到了同样的错误信息：

> svn：提交失败（详情如下）：svn：XML数据格式不正确

原因是：SVN-Repository 上的驱动器已满。更多的磁盘空间，问题就解决了。

# eclipse-plugin - 从eclipse插件访问项目目录

> ID：310704
> 
> 赞同：1
> 
> 时间：2008-11-22T01:38:34.193
> 
> 标签：eclipse-plugin, eclipse-pde

这是一个已经有人问过的问题：

[Eclipse 插件如何访问项目目录？](https://stackoverflow.com/questions/242032/eclipse-project-directory)

答案很好：使用`ResourcesPlugin`.

但由于某种原因，我的 Ganymede eclipse 在任何情况下都不会识别`org.eclipse.core.resources`包含`ResourcesPlugin`.

这是为什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-25T14:04:53.763

这通常与清单有关：

*   是导入的包 ( `Import-Package`)，还是`Require-Bundle`插件中需要的包 ( )。
*   (sanity check) 是源包 ( `Export-Bundle`) 导出的包。

如果这两个都检查出来，那么我会看看目标平台。仅适用于 RCP 的典型基本安装不包括该`resources`捆绑包。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-10T04:19:54.007

(*) 您可能在 Manifest.MF 中为依赖项指定了版本约束。可用版本不同。如果是这样，请删除约束或只需单击依赖项属性中的匹配

(*) 检查你的目标平台并验证这个 org.eclipse.core.resources 插件是否存在

(*) 如果错误仍然存​​在，请转到 RCP 启动配置中的插件选项卡。检查是否添加了oecresources。验证插件按钮应该有助于确定任何问题

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-09T10:49:56.857

**`org.eclipse.core.resources`**在插件依赖项中添加捆绑包。那应该工作得很好。

# php - 如何在 PHP 中检查上传文件的文件类型？

> ID：310714
> 
> 赞同：49
> 
> 时间：2008-11-22T01:49:57.900
> 
> 标签：php, validation, file-upload, mime-types

在 PHP 网站上，他们建议的唯一真正的检查是在[此处](http://ca.php.net/manual/en/features.file-upload.php)`is_uploaded_file()`使用or 。当然，出于各种原因，您通常不希望用户上传任何类型的文件。`move_uploaded_file()`

正因为如此，我经常使用一些“严格”的 mime 类型检查。当然这是非常有缺陷的，因为通常 mime 类型是错误的，用户无法上传他们的文件。它也很容易伪造和/或更改。除此之外，每个浏览器和操作系统都以不同的方式处理它们。

另一种方法是检查扩展名，这当然比 mime 类型更容易更改。

如果你只想要图像，使用类似的东西`getimagesize()`就可以了。

其他类型的文件呢？PDF、Word 文档或 Excel 文件？甚至是纯文本文件？

**编辑：**如果您没有[mime_content_type](http://php.net/manual/en/function.mime-content-type.php)或[Fileinfo](http://php.net/manual/en/function.finfo-file.php)并且 system("file -bi $uploadedfile") 给您错误的文件类型，还有哪些其他选项？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-11-22T02:13:09.677

看看[mime_content_type](http://php.net/manual/en/function.mime-content-type.php)或[Fileinfo](http://php.net/manual/en/function.finfo-file.php)。这些是内置的 PHP 命令，用于通过查看文件的内容来确定文件的类型。另外查看上面两页的评论，还有其他一些不错的建议。

就个人而言，我很幸运地使用了本质上是 . 的东西`system("file -bi $uploadedfile")`，但我不确定这是否是最好的方法。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-16T07:54:04.160

恕我直言，所有 MIME 类型的检查方法都是无用的。

假设你有哪个应该有 MIME-type `application/pdf`。标准方法试图找到看起来像 PDF 标题（`%PDF-`或类似的东西）的东西，他们将在成功时返回“好的，看起来这是一个 PDF 文件”。但实际上这并不意味着什么。您可以上传仅包含的文件`%PDF-1.4`，它将通过 MIME 检查。

我的意思是，如果文件具有预期的 MIME 类型——它将始终通过 MIME 类型检查，否则结果未定义。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T02:03:37.637

我假设您将拥有一个您将接受的文件类型的固定白名单。

对于这些类型中的每一种，您将不得不使用不同的技术来验证它们是否是该格式的有效示例。

有两个相关的问题：

*   它看起来大概是正确的类型吗？（对于 JPEG，您可以检查标题，正如您所提到的。对于许多基于 Unix 的格式，您可以检查“魔术 cookie”。）

*   它实际上是该类型的有效示例吗（例如，对于任何类似 XML 的格式，您可以针对 DTD 进行验证。）

我认为，对于每种格式，您应该针对每种格式提出单独的问题，因为与 ZIP 文件相比，PDF 的答案会大不相同。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-03-18T23:47:51.610

我使用了与 PHP 5.2 兼容的 mime_content_type，因为我既不能使用`Fileinfo`（它需要 PHP 5.3）也不能使用`system()`，我的提供商禁用了它。例如，我检查一个文件是否是一个文本文件，所以：

```
if (strcmp(substr(mime_content_type($f),0,4),"text")==0) { ... } 
```

你可以在我的“PHP Directory and Subdirectory Listener & File Viewer and Downloader”中看到一个完整的例子： [http ://www.galgani.it/software_repository/index.php](http://www.galgani.it/software_repository/index.php)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-06-20T13:10:04.570

```
if(isset($_FILES['uploaded'])) {
    $temp = explode(".", $_FILES["uploaded"]["name"]);

    $allowedExts = array("txt","htm","html","php","css","js","json","xml","swf","flv","pdf","psd","ai","eps","eps","ps","doc","rtf","ppt","odt","ods");

    $extension = end($temp);
    if( in_array($extension, $allowedExts)) {
       //code....

    } else {
        echo "Error,not Documentum type...";
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-06-27T17:17:54.333

这是`file_mime_type`来自 iZend 的函数：

```
function file_mime_type($file, $encoding=true) {
    $mime=false;

    if (function_exists('finfo_file')) {
        $finfo = finfo_open(FILEINFO_MIME);
        $mime = finfo_file($finfo, $file);
        finfo_close($finfo);
    }
    else if (substr(PHP_OS, 0, 3) == 'WIN') {
        $mime = mime_content_type($file);
    }
    else {
        $file = escapeshellarg($file);
        $cmd = "file -iL $file";

        exec($cmd, $output, $r);

        if ($r == 0) {
            $mime = substr($output[0], strpos($output[0], ': ')+2);
        }
    }

    if (!$mime) {
        return false;
    }

    if ($encoding) {
        return $mime;
    }

    return substr($mime, 0, strpos($mime, '; '));
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-08-10T06:16:47.633

对于 PHP>=5.3.0，您可以使用 php 的`finfo_file`( [finfo_file](https://www.php.net/manual/en/function.finfo-file.php) ) 函数来获取有关文件的文件信息。

对于 PHP<5.3.0，您可以使用您的系统`file`命令来获取文件信息。

所以只需在一个函数中实现，

```
var_dump(mime_type("wiki templete.txt"));   // print string(10) "text/plain"

function mime_type($file_path)
{
    if (function_exists('finfo_open')) {
        $finfo = new finfo(FILEINFO_MIME_TYPE, null);
        $mime_type = $finfo->file($file_path);
    }
    if (!$mime_type && function_exists('passthru') && function_exists('escapeshellarg')) {
        ob_start();
        passthru(sprintf('file -b --mime %s 2>/dev/null', escapeshellarg($file_path)), $return);
        if ($return > 0) {
            ob_end_clean();
            $mime_type = null;
        }
        $type = trim(ob_get_clean());
        if (!preg_match('#^([a-z0-9\-]+/[a-z0-9\-\.]+)#i', $type, $match)) {
            $mime_type = null;
        }
        $mime_type = $match[1];
    }
    return $mime_type;
} 
```

[哑剧类型](https://svn.apache.org/repos/asf/httpd/httpd/trunk/docs/conf/mime.types)

# eclipse - 获取附加到 Eclipse 的源 jar 文件以获取 Maven 管理的依赖项

> ID：310720
> 
> 赞同：182
> 
> 时间：2008-11-22T01:53:32.743
> 
> 标签：eclipse, maven-2, javadoc

我正在使用 Maven（和 Maven Eclipse 集成）来管理我在 Eclipse 中的 Java 项目的依赖关系。从 Maven 存储库自动下载 JAR 文件的功能可以节省实时时间。不幸的是，它不包括 API 文档和源代码。

如何设置 Maven 以自动获取源和 javadoc 附件并使用 Eclipse 正确注册它们？

* * *

## 回答 #1

> 赞同：228
> 
> 时间：2009-05-31T19:31:15.467

我确信 Eclipse 的 m2eclipse Maven 插件 - 反过来 - 可以做到这一点。您可以将其配置为自动为您下载源文件和 javadoc。

这是通过进入`Window > Preferences > Maven and checking the "Download Artifact Sources" and "Download Artifact JavaDoc"`选项来实现的。

![Maven 首选项的屏幕截图](https://i.stack.imgur.com/CNUBh.png "Maven 偏好")

* * *

## 回答 #2

> 赞同：130
> 
> 时间：2008-11-22T11:18:46.470

```
mvn eclipse:eclipse -DdownloadSources=true 
```

或者

```
mvn eclipse:eclipse -DdownloadJavadocs=true 
```

或者您可以添加两个标志，正如 Spencer K 指出的那样。

此外，该`=true`部分不是必需的，因此您可以使用

```
mvn eclipse:eclipse -DdownloadSources -DdownloadJavadocs 
```

* * *

## 回答 #3

> 赞同：72
> 
> 时间：2010-01-22T14:53:03.653

关于这项工作的其他答案，但如果你想避免记住命令行参数，你也可以添加到 downloadSources 和 downloadJavadocs 配置到你的 pom.xml 的 maven-eclipse-plugin 部分：

```
<project>
    ...
    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-eclipse-plugin</artifactId>
                <configuration>
                    <downloadSources>true</downloadSources>
                    <downloadJavadocs>true</downloadJavadocs>
                    ... other stuff ...
                </configuration>
            </plugin>
        </plugins>
    </build>
    ...
</project> 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2012-08-19T17:55:15.407

我不喜欢将源/Javadoc 下载设置放入项目`pom.xml`文件中，因为我觉得这些是用户偏好，而不是项目属性。相反，我将它们放在我的文件中的配置`settings.xml`文件中：

```
<?xml version="1.0" encoding="UTF-8"?>
<settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd">

  <profiles>
    <profile>
      <id>sources-and-javadocs</id>
      <properties>
        <downloadSources>true</downloadSources>
        <downloadJavadocs>true</downloadJavadocs>
      </properties>
    </profile>
  </profiles>

  <activeProfiles>
    <activeProfile>sources-and-javadocs</activeProfile>
  </activeProfiles>
</settings> 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2014-05-07T08:04:42.267

右键单击`project -> maven -> download sources`

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2010-07-01T07:30:11.450

如果源 jar 在本地存储库中并且您使用的是 Eclipses maven 支持，则源会自动附加。您可以运行`mvn dependency:sources`以下载给定项目的所有源 jar。不知道如何对文档做同样的事情。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-10-16T16:10:49.357

如果你使用 meclipse 做

```
window --> maven --> Download Artifact Sources (select check) 
```

（如果您仍然获得附加源窗口，则单击附加文件按钮并关闭附加源窗口。下次您尝试查看源时，它将打开正确的源）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-04T13:38:47.087

还有一个[类似的问题](https://stackoverflow.com/questions/44396/how-to-reference-javadocs-to-dependencies-in-mavens-eclipse-plugin-when-javadoc)可以回答这个问题并包括示例 pom 设置。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-05-11T02:04:04.750

我试过`windows->pref..->Maven`了，但没有成功。因此，我使用命令 mvn eclipse:eclipse -DdownloadSources=true 创建了一个新的类路径，并刷新了一次工作区。瞧……附上来源。

源 jar 的条目在类路径中可用。因此，新版本解决了问题...

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-12-07T17:00:29.577

在我的带有 m2Eclipse 的 Eclipse helios 版本中，没有

```
window --> maven --> Download Artifact Sources (select check) 
```

窗口下只有“新窗口”、“新编辑器”、“打开透视图”等。

如果您右键单击您的项目，然后选择`maven--> download sources`

没发生什么事。没有下载源，没有更新 pom 文件，没有弹出窗口询问哪些源。

在 eclipse 之外执行 mvn xxx 是危险的 - 某些命令不适用于 m2ecilpse - 我这样做了一次并且丢失了整个项目，不得不重新安装 eclipse 并从头开始。

我仍在寻找一种方法来让 ecilpse 和 maven 找到和使用像 servlet-api 这样的外部 jar 的来源。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-02-12T15:51:57.263

将 maven-eclipse-plugin 的 pom 更改为包含 source/javadoc 只需申请添加到 pom 的新依赖项。如果我们需要申请现有的依赖，我们必须运行 mvn dependency:sources。我检查了这个。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-10-27T11:07:58.160

在 Eclipse-Maven 首选项中检查下载源/javadoc，有时是不够的。如果 maven 由于某种原因（网络中断？）无法下载它们，maven 会创建一些 *.lastUpdated 文件，然后永远不会再次下载。我的经验解决方案是从 .m2/repository 中删除工件目录，然后重新启动 eclipse 工作区，检查下载源/javadoc 并检查启动时更新项目。重新启动工作区后，可能有些项目会被标记为错误，而 eclipse 进度正在下载，那么任何错误都会被清除。也许这个程序不是那么“科学”，但对我来说确实成功了。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-01-17T06:28:05.477

我已将 pom 配置添加到 maven-eclipse 插件以下载源代码和 javadocs，但我认为/希望这会发生在新的依赖项上，而不是现有的依赖项。

对于现有依赖项，我在包资源管理器中浏览到“Maven Dependencies”并右键单击 commons-lang-2.5.jar，选择 Maven | 下载源和......似乎没有发生任何事情（没有进度条或指示它正在做任何事情）。但是，它确实下载了，因为我现在可以跳转到 commons-lang 中的源代码。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-01-19T20:38:27.917

*overthink*建议使用 pom 中的设置：

```
<project>
...
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-eclipse-plugin</artifactId>
            <configuration>
                <downloadSources>true</downloadSources>
                <downloadJavadocs>true</downloadJavadocs>
                ... other stuff ...
            </configuration>
        </plugin>
    </plgins>
</build>
... 
```

首先，我认为这仍然不会附加 javadoc 和源（因为我之前尝试使用 -DdownloadSources 选项失败）。

但令人惊讶的是 - 使用 POM 变体时，.classpath 文件正在获取其源代码和 javadoc！

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-09-29T19:56:28.740

对于 Indigo（可能还有 Helios），上面提到的复选框位于此处：

```
Window -> Preferences -> Maven 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-02-10T15:06:50.540

我遇到了类似的问题，最适合我的解决方案是将源代码包含在与编译代码相同的 jar 中（因此 jar 中的给定目录将同时包含`Foo.java`and `Foo.class`）。Eclipse 自动将源代码与编译后的代码相关联，并自动从源代码中提供 JavaDoc。显然，这只有在您控制工件时才有用。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-06-05T08:55:13.863

在项目级别或用户属性级别设置属性后，请执行 Maven -> 更新项目（强制更新）。它下载源

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-03-11T15:15:37.257

对答案的一个小补充，如果您的项目不是 maven 项目，您仍然可以通过使用 eclipse [Java Source Attacher中提供的这个插件来获取 jar 的源代码](https://marketplace.eclipse.org/content/java-source-attacher)

# apache-flex - 更改运行时 css 时，Flex 中的多行文本不会重新计算

> ID：310729
> 
> 赞同：0
> 
> 时间：2008-11-22T02:03:44.813
> 
> 标签：apache-flex, runtime, stylesheet

出于加载时间的考虑，我在我的 Flex 应用程序中使用了运行时 css 文件。

我在使用多行文本控件时遇到问题：

```
<mx:Text id="txtDescription" selectable="false"
styleName="imageRolloverButtonTextDark" width="100%" textAlign="center"
text="{_rolloverText}"/> 
```

当我的 CSS 样式表已正确加载文本样式时，会发生更改，但不会重新计算高度。它似乎只是一个单行字段。

仅供参考：控件实际上是不可见的，并且由翻转触发。所以我真的不在乎样式表是否没有加载并且他们得到标准的系统文本。我只是希望它在加载时是正确的高度。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-11T01:17:54.557

根据 Adob​​e 文本文档

> 调整文本控件的大小
> 
> Flex 调整 Text 控件的大小如下：
> 
> 如果同时为 height 和 width 属性指定像素值，则任何超出控件大小的文本都会在边框处被剪裁。
> 
> 如果您指定明确的像素宽度，但没有指定高度，Flex 会将文本换行以适合宽度并计算高度以适合所需的行数。
> 
> 如果您指定基于百分比的宽度且不指定高度，则 Flex 不会换行文本，并且高度等于由 Return 字符数确定的行数。
> 
> 如果只指定高度而不指定宽度，则高度值不会影响宽度计算，并且 Flex 会调整控件的大小以适合最大线条的宽度。
> 
> 作为一般规则，如果您有长文本，则应指定基于像素的宽度属性。如果文本可能会更改，并且您希望确保 Text 控件始终占用应用程序中的相同空间，请设置适合最大预期文本的显式高度和宽度属性。

所以我用来处理这个问题的技巧是让 Text 通过绑定表达式从任何限制它的宽度的容器中获取它的宽度，通常是直接父级。

例如

```
<mx:Canvas id="box" width="100%" backgroundColor="Red">
    <mx:Text width="{box.width}" text="{someReallyLongString}" />
</mx:Canvas> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-17T12:33:56.353

对于遇到此问题的任何其他人，我找到的解决方案是创建一个自定义组件扩展 mx.controls.Text

然后覆盖 styleChange() 方法，并在应用样式后显式调用文本字段的 invalidateDisplayList() 方法。

它应该在样式更改时自动调用，但没有......由于某种原因，在 flex 3.5 中它不是。

public class TextObject extends Text { //... 覆盖 public function styleChanged(styleProp:String):void { invalidateDisplayList(); } }

希望能拯救一些我一直迷路的人。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T17:11:13.420

您可以使用固定像素宽度而不是 100% 吗？我以前在动态文本控件上错误地计算了 100% 的问题。

# error-handling - IHttpModule 实现的错误处理在 IIS6 中不起作用，在 IIS5.1 中起作用

> ID：310731
> 
> 赞同：0
> 
> 时间：2008-11-22T02:05:33.687
> 
> 标签：error-handling, iis-6, ihttpmodule

我通过使用 IHttpModule 来实现常见的错误处理。在我的机器上本地使用 WinXP，它就像一个魅力。一旦我在我们的测试服务器（即 W2003）上上传解决方案，它就不起作用了。一旦发生错误，它就会直接显示在 asp.net 错误页面中。它不使用我的错误模块进行处理。

欢迎任何建议....X。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-30T22:38:34.953

请务必检查您的自定义错误设置是否正确。我猜测您在本地进行的测试并获得与远程不同的行为。

```
<customErrors mode="On" defaultRedirect="error" /> 
```

# python - 在 Django 中，如何使用动态字段查找过滤 QuerySet？

> ID：310732
> 
> 赞同：181
> 
> 时间：2008-11-22T02:06:06.243
> 
> 标签：python, django, django-models

给定一个类：

```
from django.db import models

class Person(models.Model):
    name = models.CharField(max_length=20) 
```

是否有可能，如果有的话，如何拥有一个基于动态参数进行过滤的 QuerySet？例如：

```
 # Instead of:
 Person.objects.filter(name__startswith='B')
 # ... and:
 Person.objects.filter(name__endswith='B')

 # ... is there some way, given:
 filter_by = '{0}__{1}'.format('name', 'startswith')
 filter_value = 'B'

 # ... that you can run the equivalent of this?
 Person.objects.filter(filter_by=filter_value)
 # ... which will throw an exception, since `filter_by` is not
 # an attribute of `Person`. 
```

* * *

## 回答 #1

> 赞同：348
> 
> 时间：2008-11-22T02:48:30.277

Python的参数扩展可以用来解决这个问题：

```
kwargs = {
    '{0}__{1}'.format('name', 'startswith'): 'A',
    '{0}__{1}'.format('name', 'endswith'): 'Z'
}

Person.objects.filter(**kwargs) 
```

这是一个非常常见和有用的 Python 习惯用法。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-18T17:52:22.203

一个简化的例子：

在 Django 调查应用程序中，我想要一个显示注册用户的 HTML 选择列表。但是因为我们有 5000 个注册用户，所以我需要一种方法来根据查询条件（例如完成某个研讨会的人）过滤该列表。为了使调查元素可重复使用，我需要创建调查问题的人能够将这些标准附加到该问题（不想将查询硬编码到应用程序中）。

我想出的解决方案不是 100% 用户友好（需要技术人员的帮助来创建查询），但它确实解决了问题。创建问题时，编辑器可以在自定义字段中输入字典，例如：

```
{'is_staff':True,'last_name__startswith':'A',} 
```

该字符串存储在数据库中。在视图代码中，它以`self.question.custom_query`. 它的值是一个*看起来*像字典的字符串。我们用 eval() 把它变成一个*真正的*字典，然后用 **kwargs 把它塞进查询集中：

```
kwargs = eval(self.question.custom_query)
user_list = User.objects.filter(**kwargs).order_by("last_name") 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-05-23T15:55:36.437

[Django.db.models.Q](https://docs.djangoproject.com/en/dev/topics/db/queries/#complex-lookups-with-q-objects)正是你想要的 Django 方式。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2021-08-31T07:37:23.093

此外，为了扩展先前对进一步代码元素提出一些请求的答案，我正在添加一些我在 Q 代码中使用的工作代码。假设我在我的请求中可以有或不过滤以下字段：

```
publisher_id
date_from
date_until 
```

这些字段可以出现在查询中，但也可能会丢失。

这就是我基于聚合查询上的那些字段构建过滤器的方式，这些字段在初始查询集执行后无法进一步过滤：

```
# prepare filters to apply to queryset
filters = {}
if publisher_id:
    filters['publisher_id'] = publisher_id
if date_from:
    filters['metric_date__gte'] = date_from
if date_until:
    filters['metric_date__lte'] = date_until

filter_q = Q(**filters)

queryset = Something.objects.filter(filter_q)... 
```

希望这会有所帮助，因为我花了很多时间来挖掘这个。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-11-22T02:36:56.447

一个非常复杂的搜索表单通常表明一个更简单的模型正在试图挖掘它的出路。

确切地说，您希望如何获得列名和操作的值？你从哪里得到 a 的`'name'`值`'startswith'`？

```
 filter_by = '%s__%s' % ('name', 'startswith') 
```

1.  “搜索”表格？你要——什么？-- 从名字列表中选择名字？从操作列表中选择操作？虽然是开放式的，但大多数人发现这令人困惑且难以使用。

    有多少列有这样的过滤器？6？12？18？

    *   一些？复杂的选择列表没有意义。一些字段和一些 if 语句是有意义的。
    *   大量的？你的模型听起来不对。听起来“字段”实际上是另一个表中行的键，而不是列。
2.  特定的过滤器按钮。等等……这就是 Django 管理员的工作方式。特定的过滤器变成了按钮。并且适用与上述相同的分析。一些过滤器是有意义的。大量的过滤器通常意味着一种第一范式违例。

许多类似的字段通常意味着应该有更多的行和更少的字段。

# .net - 什么是 Visual Studio 的最佳替代 IDE

> ID：310735
> 
> 赞同：111
> 
> 时间：2008-11-22T02:10:33.363
> 
> 标签：.net, visual-studio, ide

因为我只使用过 Visual Studio 进行 .NET 开发，所以我想扩大我的视野，看看还有什么可以替代它的。那么在您看来，Visual Studio 的最佳替代品是什么？有可行的替代方案吗？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-11-22T02:13:19.753

如果您喜欢 C# 和 VB.Net 并且不介意开源，那么您可以使用[SharpDevelop](http://www.icsharpcode.net/OpenSource/SD/)。它做得很好！

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-11-22T02:13:11.580

有很多替代方案，请查看此列表：[Visual Studio.NET 的替代 IDE](http://web.archive.org/web/20071217202115/http://www.dotnetcoders.com/web/Articles/ShowArticle.aspx?article=49)，镜像在 Web 存档上，因为[原始链接](http://www.dotnetcoders.com/web/Articles/ShowArticle.aspx?article=49)已关闭。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-22T02:14:43.683

[vim](http://www.vim.org/)

它还可以帮助您[停止使用鼠标](http://www.codinghorror.com/blog/archives/000825.html)！

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-12-11T23:55:30.133

[宙斯](http://www.zeusedit.com)。

这是一个显示代码完成的示例，取自 Zeus 主页。

![在 Zeus 中打开 example.cs，显示代码完成](https://i.stack.imgur.com/rkyON.png)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-22T02:35:28.197

有[MonoDevelop](http://monodevelop.com/Main_Page)，当我想在 Linux 中进行一些轻量级的 C# 编码时，我偶尔会使用它。它与 VS.Net 没有什么关系，但它适用于小型项目。我真的不认为人们列出的大多数替代方案都接近 VS.Net。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-22T02:21:51.407

[SharpDevelop](http://www.icsharpcode.net/OpenSource/SD/)的另一个优点是能够在两种大型托管 .NET 语言 VB.NET 和 C# 之间转换解决方案。我相信它不适用于“网站”，但它适用于 Web 应用程序项目。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-22T02:17:21.167

就 .net 语言而言，VS 很难被击败。

我以前在.net 上使用过SharpDevelop，总体来说还不错。

对于像 Java 这样的其他语言，Eclipse 非常好，还有一些 Eclipse 变体，比如用于 Web 工作的 Aptana。

然后总是有记事本...

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-12-21T16:42:51.873

试试这个：http://pao-ide.info 上的“Pao [”](http://pao-ide.info)。它仍处于开发阶段，无法用于生产，但它的功能非常独特。基本上，所有的语言结构，例如程序集、类型、成员、语句、表达式，都被视为对象，并与丰富的操作选项相关联。您可以享受图形编辑器中常见的功能，例如多选、多复制粘贴、标记、批量操作和非常强大的搜索能力。这需要一些时间来适应，但最终可能会提高生产力。目前，它只支持表单应用程序。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-12T22:57:29.523

我仍然非常喜欢[Source Insight](http://www.sourceinsight.com/)，但我不愿再推荐它，因为我不确定是否还有人在维护它。他们在三月份发布了一个非常小的更新，但多年来没有发布过重大版本。而且似乎没有网络社区存在。很遗憾，因为我仍然喜欢它的自动完成友好的文件打开和符号浏览面板（以及语法格式），这比我用过的任何其他东西都要好。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-06-20T04:08:44.070

WebMatrix 怎么样：http: [//www.microsoft.com/web/webmatrix/](http://www.microsoft.com/web/webmatrix/)？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-06-27T09:53:58.080

**Eclipse**有几个 C# 插件，迄今为止我发现的最好的是**[Emonic](http://emonic.sourceforge.net/)**。您可以借助它来定位 .NET 或 Mono。Eclipse 和 Emonic 都是开源的。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-11-22T02:16:04.680

对于 .NET 开发，VS2008 是最好的，但是如果您想检查另一个最好的 IDE，如果您在 IDE 中对其进行评级，**[Eclipse](http://www.eclipse.org/downloads/)**可能是 VS 之后最好的，当然您不能在 Eclipse 中进行 .NET 开发

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-11-22T02:25:07.937

如果您想尝试 Java，我相信 NetBeans 是一个非常非常好的 IDE。但是，对于 .NET，肯定有替代 IDE，但我认为使用它们没有多大意义，除非您在开源平台上进行开发，在这种情况下，SharpDevelop 是一个不错的选择并且相当成熟。

# operating-system - 全局键盘挂钩的合法用途是什么？

> ID：310745
> 
> 赞同：5
> 
> 时间：2008-11-22T02:14:34.900
> 
> 标签：operating-system, hook

除了只能由操作系统提供的应用程序启动快捷方式之外，Windows 键盘挂钩之类的东西的合法用途是什么？在我看来，我们只遇到键盘记录器之类的问题，因为操作系统提供了挂钩来执行除 O/S 内核本身之外的任何情况下任何人都不应允许的事情。

编辑：好的，所以考虑到一些可能需要它们的合法地方，操作系统不应该提供高级别的能力来全局关闭它们，并且只允许逐个程序的异常吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-04T22:53:46.130

我目前正在为企业客户端开发移动应用程序平台/硬件抽象层，其中一个要求是在一段时间不活动后会启动屏幕保护程序。由于移动设备没有鼠标可以移动，因此“活动”包括按键或屏幕点击。我们的一个设备没有触摸屏，长话短说，移动硬件供应商没有正确实现 Win32 API 调用，这将使我能够获得自上次用户输入以来的时间。

由于硬件供应商不愿意正确实现 Win32 API，我知道确保我的控制台应用程序可以捕获系统上任何应用程序中的按键按下的下一个最佳方法是安装一个全局键盘挂钩。

也就是说，我同意普通消费者场景与我的非常不同，操作系统应该允许用户将这样的活动列入白名单。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-22T02:19:26.980

并非如此，在某些环境中，计算机的所有者可能想要停止诸如`Ctrl`++ `Alt`...`Delete`示例、Kiosk 或 .... Best Buy 之类的东西？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T02:29:04.653

例如我安装了两个应用程序；

*   一个将 Windows-V 映射为[粘贴](http://stevemiller.net/puretext/)无格式文本
*   另一个[修改](http://lifehacker.com/373177/neuter-the-caps-lock-key-with-handicapslock)了大写锁定的工作方式

我认为他们都需要一个钩子。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-22T02:58:52.347

我写了一个应用程序，让我可以在我的显示器上放置虚拟便签。我使用操作系统键盘挂钩将热键绑定到它。

我在设置中有一个选项可以禁用钩子。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-22T02:25:03.070

可能没有很多合法用途。但是，我认为您不应该故意限制系统的功能，而只是为了使其更安全。

此外，如果您知道它在那里并且您自己安装了它，那么键盘记录器也不是一件坏事。

# .net - WPF 选项卡视图、自定义模板和辅助功能

> ID：310749
> 
> 赞同：0
> 
> 时间：2008-11-22T02:17:04.193
> 
> 标签：.net, wpf, xaml, accessibility

我遇到了 WPF 选项卡视图控件的问题，我希望这里的人可以帮助我。

我希望我的选项卡视图控件为选项卡标题使用圆角，因为我认为圆形选项卡看起来更好。

为此，我使用 Expression Blend 中的“编辑副本”命令修改了选项卡的默认控件模板。然后，我只需为选项卡标题的“边框”设置圆角半径。

然而，这种方法的问题在于“编辑副本”命令最终会为用于显示“活动”和“鼠标悬停”选项卡背景的渐变画笔生成文字颜色值。

当启用“高对比度”模式时，这会导致问题。不像其他控件那样切换到高对比度配色方案，带有修改模板的选项卡将使用渐变画笔中为活动选项卡和鼠标悬停选项卡指定的文字颜色值。这最终使这些选项卡不可读，因为当操作系统切换到高对比度模式时，选项卡标题上的文本变为“白色”（灰色背景上的白色文本不可读）。

我想当启用高对比度模式时我可能能够切换回方形标签，这将解决这个特殊问题。但是，我想安装了自定义 Windows 主题的用户也会遇到类似的问题。

所以，我想知道的是：

1.  有什么办法可以将渐变更改为指向系统资源而不是文字值，以便在启用高对比度模式时正确更新颜色
2.  或者，有没有办法让我在选项卡标题的边框上设置圆角半径而不创建新的控件模板？

**编辑：**

我认为我应该更明确地说明我在寻找什么。我想要一个与默认选项卡控件完全一样的选项卡控件，除了选项卡标题角是圆角的。默认情况下，选项卡控件将使用渐变作为选项卡背景，并在用户将鼠标悬停在非活动选项卡上时“突出显示”非活动选项卡。当操作系统切换到高对比度模式时，它还将正确响应并更改其颜色和鼠标悬停行为。我仍然需要这种行为。

在 Blend 中创建默认控制模板的副本会创建一个在高对比度模式下无法正常工作的控制模板。我想知道我需要对控件模板或窗口中的代码做什么，以使生成的控件模板在高对比度模式下正常工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T16:25:53.293

如果不为 TabItem 创建自定义模板，则无法制作圆角标签。在混合中执行“编辑副本”我相信会根据您拥有的当前窗口主题创建默认模板（但是我可能是错的。我相信您执行 controltemplate 转储它得到的是由系统确定的当前控制模板主题。就像在presentation.aero或类似的东西中）。但是，如果您想提供系统在更改时将使用的颜色，请在您的模板中像这样对它们进行 sepcify：

```
Color="{DynamicResource {x:Static SystemColors.XXXX}" 
```

这将使用系统颜色来设置控件的样式，并将更新以反映系统主题的变化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T02:30:51.403

在 Blend 中向您的窗口添加一个简单的样式控件。这将添加 SimpleStyles.xaml，包括一个用于选项卡控件的。

看看 Family.Show 以及他们如何制作黑色和银色主题。

在这两者之间，您应该有一个很好的例子来说明如何自定义选项卡控件和处理不同的主题。

# macos - 在 Mac OS X 的命令行上编辑资源分叉

> ID：310753
> 
> 赞同：11
> 
> 时间：2008-11-22T02:19:59.367
> 
> 标签：macos, macos-carbon, rsrc, file-forks

Mac OS X 使用资源叉存储一些文件。我需要创建一个带有资源叉的文件。麻烦的是，我需要在命令行上创建这个文件。有谁知道如何在 Mac OS X 的命令行上使用资源叉创建文件？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-22T12:45:05.440

您可以使用 path/to/file/..namedfork/rsrc 直接访问文件的资源分支。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-22T02:36:14.967

首先，OS X 并没有真正使用资源分叉……它支持命名分叉，HFS+ 支持资源分叉，但这主要是为了向后兼容 OS 9 和老式 Carbon 东西……但是，有命令行工具与开发者工具一起安装（所以你必须安装这些......如果你没有它们，你可以从 developer.apple.com 获得它们）。

有关以下工具，请参见手册页：

ResMerger Rez RezDet RezWack

手册页是随开发者工具一起安装的，所以

```
man Rez 
```

在终端将工作。手册页也可以在线获得：

[雷兹(1)](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man1/Rez.1.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T05:08:04.567

As an alternative, you can make a copy of an existing file, fork and all, using ditto:

ditto -rsrc srcFile dstFile

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-01-09T15:07:29.190

如果您尝试添加富文本资源分支（例如，在安装 .dmg 时显示软件许可证），请查看 Rainer Brockerhoff 的免费[AddLicense](http://brockerhoff.net/blog/2010/02/10/addlicense-tool/)源代码。

# python - 有谁知道用于 snmp 监控的基于 python 的 web ui？

> ID：310759
> 
> 赞同：1
> 
> 时间：2008-11-22T02:26:06.937
> 
> 标签：python, django, pylons, snmp, turbogears

类似于仙人掌或mrtg。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T02:29:27.070

[http://www.zenoss.com/](http://www.zenoss.com/)

这不仅仅是 SNMP，而是基于 Python。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T14:34:56.550

or you can start building your own solution (like me), you will be surprised how much can you do with few lines of code using for instance cherryp for web server, pysnmp, and python rrd module.

# python - 无需转码即可修改 MP3 音频的 Python 库

> ID：310765
> 
> 赞同：19
> 
> 时间：2008-11-22T02:30:54.273
> 
> 标签：python, mp3, codec

在我开始一个小项目之前，我正在寻找一些关于 mp3 格式的一般性建议，以确保我不是在疯狂追逐。

我对 mp3 格式内部结构的了解很少。理想情况下，我正在寻找一个可以将这些细节抽象出来的库。我更喜欢使用 Python（但否则可能会被说服）。

我想以一种相当简单的方式修改一组 mp3 文件。我对 ID3 标签不是很感兴趣，而是对音频本身很感兴趣。我希望能够删除部分（例如从第 3 分钟开始下降 10 秒），并插入部分（例如在末尾添加学分。）

我的理解是 mp3 格式是有损的，因此将其解码为（例如）PCM 格式，进行修改，然后再次将其编码为 MP3 会降低音频质量。（我很想听到我错了。）

我*猜想*，如果我保持 mp3 格式，将会有某种最小帧或数据包大小需要处理，因此操作的粒度可能会更粗略。只要我能在几秒钟内获得准确度，我就可以忍受。

我看过[PyMedia](http://pymedia.org/)，但它需要我迁移到 PCM 来处理数据。同样，[LAME](http://lame.sourceforge.net)想帮助我编码，但不想就地访问数据。我见过其他几个只处理 ID3 标签的库。

谁能推荐一个 Python MP3 库？或者，你能不相信我的假设，即往返 PCM 是不好的和可以避免的吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-22T03:35:23.317

如果您想做低级的事情，请使用[pymad](http://spacepants.org/src/pymad/)。它将 MP3 转换为样本数据的缓冲区。

如果您想要更高级别的东西，请使用 Echo Nest [Remix API](http://code.google.com/p/echo-nest-remix/)（披露：我为日常工作编写了其中的一部分）。它包括几个例子。如果您查看[牛铃](http://code.google.com/p/echo-nest-remix/source/browse/#svn/trunk/examples/cowbell)示例（即[MoreCowbell.dj](http://morecowbell.dj)），您会看到 pymad 的一个分支，它为您提供[NumPy](http://numpy.scipy.org/)数组而不是缓冲区。该数据类型可以更轻松地切出部分并对它们进行数学运算。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-24T00:42:43.557

我得到了三个高质量的答案，我感谢你们所有人（并为你们所有人投票）。我没有选择任何作为接受的答案，因为每个都针对一个方面，所以我想写一个总结。

**你需要在 MP3 中工作吗？**

*   转码为 PCM 再转回 MP3 不太可能导致质量下降。

*   不要过早地优化音频质量；用一个简单的原型测试它并听它。

**在 MP3 中工作**

*   维基百科有一个[MP3 文件格式](http://en.wikipedia.org/wiki/MP3)的摘要。

*   MP3 帧很短（1152 个样本，或仅几毫秒），允许在该级别上实现中等精度。

*   然而，[维基百科](http://en.wikipedia.org/wiki/MP3)警告说“帧不是独立的项目（“字节库”），因此不能在任意帧边界上提取。

*   如果我真的想避免解码，现有的库不太可能有帮助。

**在 PCM 工作**

这个级别有几个库：

*   [LAME](http://lame.sourceforge.net/)（最新版本：2017 年 10 月）
*   [PyMedia](http://pymedia.org/)（最新版本：2006 年 2 月）
*   [PyMad](http://spacepants.org/src/pymad/)（仅限 Linux？仅限解码器？最新版本：2007 年 1 月）

**在更高层次上工作**

*   [Echo Nest Remix API](https://echonest.github.io/remix/) （目前仅适用于 Mac 或 Linux）是 Web 服务的 API，支持相当复杂的操作（例如，查找音乐节拍和速度的位置等）

*   [mp3DirectCut](http://mpesch3.de1.cc/mp3dc.html#dwn)（仅限 Windows）是一个 GUI，显然可以执行我想要的操作，但作为一个应用程序。它不是开源的。（我尝试运行它，遇到拒绝访问安装程序错误，但没有跟进。GUI 不适合我，因为我想在不断变化的文件库上重复运行这些操作。）

我现在的计划是从 PyMedia 开始，使用 PCM。谢谢大家的帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-22T03:01:08.537

Mp3 是有损的，但它以一种非常特殊的方式是有损的。用于丢弃您的耳朵无法听到（或很难听到）的某些音频部分的算法。一遍又一遍地以相同的压缩级别重新执行压缩过程可能会为给定的一段音频产生*几乎相同的结果。*但是，一些额外的损失可能会慢慢累积。如果您要大量修改文件，这可能是个坏主意。如果您关心质量，这也是一个坏主意，但如果您关心质量，则使用 MP3 是一个坏主意。

您可以使用编码器和解码器构建测试，对几个不同的 mp3 文件重新编码几次并观察它们的变化，这可以帮助您确定恶化速度并确定它是否可以接受。听起来您已经有了可以用来运行这个简单测试的库。

MP3 文件由音频“帧”组成，因此应该可以通过一些努力以最少的处理删除整个帧（删除帧，更新文件头中的一些小细节）。我相信帧很短（每个几毫秒），这将提供您正在寻找的精度。[因此，对MP3 文件格式](http://en.wikipedia.org/wiki/Image:Mp3filestructure.svg)进行一些阅读应该可以为您提供足够的信息来编写自己的 python 库来执行此操作。这与传统的“音频处理”有点不同（因为您不关心精度），因此您不太可能找到执行此操作的现有库。正如您所发现的，大多数会首先解压缩音频，以便您可以进行完全细粒度的控制。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-22T03:16:23.433

不能直接满足您的需求，但请检查[mp3DirectCut](http://mpesch3.de1.cc/mp3dc.html#dwn)软件，它可以满足您的需求（作为 GUI 应用程序）。我认为源代码是可用的，因此即使您没有找到库，您也可以构建自己的库，或者使用 mp3DirectCut 中的代码构建 python 扩展。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-26T13:13:34.583

至于从 mp3 文件中删除或提取 mp3 片段，同时停留在 MP3 域中（即不转换为 PCM 格式并返回），还有开源包[PyMp3Cut](http://sourceforge.net/projects/pymp3cut/)。

至于将 MP3 文件拼接在一起（例如在 mp3 文件的末尾或开头添加“Credits”），我发现您可以简单地连接 MP3 文件，前提是文件具有相同的采样率（例如 44.1khz）并且相同通道数（例如，两者都是立体声或都是单声道）。

# iphone - 算法：Cocoa Touch 中的数组数组（可能使用 NSCountedSet）

> ID：310770
> 
> 赞同：3
> 
> 时间：2008-11-22T02:34:43.957
> 
> 标签：iphone, objective-c, cocoa, cocoa-touch, algorithm

就解释而言，这有点乏味，所以就到这里吧。我实际上是在 iPhone 上用多个部分填充一个 tableView，每个部分可能有多个行。据我了解，最好有一个数组数组，这样您就可以通过向计数的顶级数组发送消息来简单地确定一个有多少个部分，然后对于每个部分的行，对内部数组执行相同的操作（s ）。我的数据是字典的形式。字典中的键/值对之一决定了它在 tableView 上的显示位置。一个例子如下：

```
{
  name: "bob",
  location: 3
}
{ 
  name: "jane",
  location: 50
}
{
  name: "chris",
  location: 3
} 
```

在这种情况下，我将有一个包含两个子数组的数组。第一个子数组将有两个包含 bob 和 chris 的字典，因为它们都是位置 3 的一部分。第二个子数组将包含 jane，因为她在位置 50。我在 Cocoa 中填充这个数据结构的最佳选择是什么？C 中的哈希表可能会解决问题，但我宁愿使用 Cocoa 中可用的类。

谢谢，如果我需要进一步澄清，请告诉我。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-22T06:46:56.083

以下代码有效：（**编辑：**添加了我的初始化代码）

```
NSArray * arrayOfRecords = [NSArray arrayWithObjects:

    [NSDictionary dictionaryWithObjectsAndKeys:
     @"bob", @"name",
      [NSNumber numberWithInt:3], @"location",  nil],

    [NSDictionary dictionaryWithObjectsAndKeys:
     @"jane", @"name",
      [NSNumber numberWithInt:50], @"location",  nil],

    [NSDictionary dictionaryWithObjectsAndKeys:
     @"chris", @"name",
      [NSNumber numberWithInt:3], @"location",  nil],

    nil];

NSMutableDictionary * sections = [NSMutableDictionary dictionary];

for (NSDictionary * record in arrayOfRecords)
{
    id key = [record valueForKey:@"location"];
    NSMutableArray * rows = [sections objectForKey:key];

    if (rows == nil)
    {
        [sections setObject:[NSMutableArray arrayWithObject:record] forKey:key];
    }
    else
    {
        [rows addObject:record];
    }
}

NSArray * sortedKeys = [[sections allKeys] sortedArrayUsingSelector:@selector(compare:)];
NSArray * sortedSections = [sections objectsForKeys:sortedKeys notFoundMarker:@""];

NSLog(@"%@", sortedSections);
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-22T04:29:14.550

NSDictionary*是*一个哈希表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T07:08:46.023

在 Cocoa 中，最好使用模型对象而不是原始集合，尤其是在使用绑定时。字典当然应该是模型对象，您可能也希望将内部数组转换为模型对象。（外部数组应该是一个数组。）

Cocoa Touch 没有绑定，但我发现（在 Cocoa 中，因为我没有对我的 iPhone 进行编程）模型对象使事情更容易思考和使用。无论如何，我建议您制作模型对象。

（“模型”指的是 Cocoa 的“模型-视图-控制器”模式，其中 Cocoa 提供视图和控制器对象，而您提供模型。）

# c# - Namespace URI Constant.NamespaceSpecNS 代表什么？

> ID：310777
> 
> 赞同：0
> 
> 时间：2008-11-22T02:38:42.573
> 
> 标签：c#, java, xml

我将 Java 项目的一部分移植到 C# 并遇到了这个常量`Constant.NamespaceSpecNS.`

它的用途之一是在以下 Java 上下文中：

```
_xmlElement.setAttributeNS(Constants.NamespaceSpecNS,"a_qualified_name", "some_value"); 
```

在哪里`seAttributesNS`声明`org.w3c.dom Interface Element`。

所以，从这个调用中，我知道它是某种命名空间 uri，但这就是我所知道的。任何人都可以指出这`Constant.NamespaceSpecNS`是在哪里定义的吗？它的实际价值是多少？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-22T04:30:42.380

它在 org.apache.xml.security.utils.Constants 中定义为“ [http://www.w3.org/2000/xmlns/ ”。](http://www.w3.org/2000/xmlns/)

# iphone - UIPickerView 行颜色

> ID：310786
> 
> 赞同：8
> 
> 时间：2008-11-22T02:48:52.460
> 
> 标签：iphone, cocoa-touch

有谁知道如何从 iPhone SDK 更改 UIPickerView 控件中的行（或行背景）的颜色？类似于下面的行标题，但是我也想更改行的颜色：

```
- (NSString *)pickerView:(UIPickerView *)pickerView titleForRow:(NSInteger)row forComponent:(NSInteger)component; 
```

谢谢你。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-22T04:33:13.483

谢谢诺亚，这正是我所需要的。我想在这里添加代码以防万一其他人需要（或想评论:)

```
- (UIView *)pickerView:(UIPickerView *)pickerView viewForRow:(NSInteger)row forComponent:(NSInteger)component reusingView:(UIView *)view {

    CGRect imageFrame = CGRectMake(0.0, 0.0, 15, 15);
    UIImageView *label = [[[UIImageView alloc] initWithFrame:imageFrame] **autorelease**];

    if (row == 0)
    {
        label.backgroundColor = [UIColor redColor];
    }
    if (row == 1)
    {
        label.backgroundColor = [UIColor blueColor];
    }
    if (row == 2)
    {
        label.backgroundColor = [UIColor blackColor];
    }   
    return label;
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-22T03:18:44.257

您可以在委托的 -pickerView:viewForRow:forComponent:reusingView: 方法中返回任意视图，在[此处](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UIPickerViewDelegate_Protocol/Reference/UIPickerViewDelegate.html#//apple_ref/occ/intfm/UIPickerViewDelegate/pickerView:viewForRow:forComponent:reusingView:)记录。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-08-23T22:27:02.927

我根据肖恩的回答实现了以下内容：

```
- (UIView *)pickerView:(UIPickerView *)pickerView viewForRow:(NSInteger)row forComponent:(NSInteger)component reusingView:(UIView *)view
{
    CGRect rowFrame = CGRectMake(00.0f, 0.0f, [pickerView viewForRow:row forComponent:component].frame.size.width, [pickerView viewForRow:row forComponent:component].frame.size.height);
    UILabel *label = [[UILabel alloc] initWithFrame:rowFrame];
    label.font = [UIFont boldSystemFontOfSize:18.0f];

    // This is an array I pass to the picker in prepareForSegue:sender:
    label.text = [self.values objectAtIndex:row];
    label.textAlignment = UITextAlignmentCenter;

    // This is an array I pass to the picker in prepareForSegue:sender:
    if ([self.backgroundColors count]) {
        label.backgroundColor = [self.backgroundColors objectAtIndex:row];

        // self.lightColors is an array I instantiate in viewDidLoad: self.lightColors = @[ [UIColor yellowColor], [UIColor greenColor], [UIColor whiteColor] ];
        label.textColor = [self.lightColors containsObject:label.backgroundColor] ? [UIColor blackColor] : [UIColor whiteColor];
    } else {
        label.textColor = [UIColor blackColor];
    }

    return label;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-11-02T05:36:03.580

```
-(void)pickerView:(UIPickerView *)pickerView didSelectRow:(NSInteger)row inComponent:(NSInteger)component{

    UILabel *labelSelected = (UILabel*)[pickerView viewForRow:row forComponent:component];
    [labelSelected setTextColor:[UIColor redColor]];

} 
```

和

```
- (UIView *)pickerView:(UIPickerView *)pickerView viewForRow:(NSInteger)row forComponent:(NSInteger)component reusingView:(UIView *)view{

    UILabel *label = (id)view;

    if (!label){

      label=[[UILabel alloc]init];
      label.textAlignment = NSTextAlignmentCenter;
      pickerView.backgroundColor=[UIColor whiteColor];
      label.text=[self pickerView:pickerView titleForRow:row forComponent:component];
      label.textColor=[UIColor grayColor];

    }
    return label;
} 
```

* * *

## 回答 #5

> 赞同：-7
> 
> 时间：2009-03-29T00:07:43.007

做这个：

```
label.backgroundColor = [UIColor yourcolorColor]; 
```

# arrays - 最小化数组相邻项中的函数

> ID：310787
> 
> 赞同：3
> 
> 时间：2008-11-22T02:51:06.823
> 
> 标签：arrays, algorithm, language-agnostic, permutation, mathematical-optimization

我有一个元素数组 ( `arr`) 和一个函数 ( `f`)，它接受 2 个元素并返回一个数字。

我需要数组的排列，这样对于每个in`f(arr[i], arr[i+1])`尽可能少。（它应该循环，即它也应该最小化）`i``arr``f(arr[arr.length - 1], arr[0])`

此外，`f`工作有点像距离，所以`f(a,b) == f(b,a)`

如果效率太低，我不需要最佳解决方案，但是一个运行合理且速度快的解决方案，因为我需要实时计算它们（我不知道长度`arr`是多少，但我认为它可能是大约30）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-22T03:24:20.720

“这样 f(arr[i], arr[i+1]) 对于 arr 中的每个 i 尽可能少”是什么意思？你想最小化*总和*吗？你想最小化其中最大的吗？你想首先最小化 f(arr[0],arr[1])，然后在所有最小化这个的解决方案中，选择一个最小化 f(arr[1],arr[2]) 等的解决方案，等等在？

如果你想最小化*总和*，这*正是*旅行商问题的全部普遍性（好吧，“度量 TSP”，也许，如果你的 f 确实形成一个度量）。对幼稚的解决方案进行了巧妙的优化，可以为您提供确切的优化并在合理的时间内运行大约 n=30；您可以使用其中之一，或者可以使用一种启发式方法来为您提供近似值。

如果你想最小化*最大值*，这是一个更简单的问题，尽管仍然是 NP-hard：你可以对答案进行二分搜索；对于特定值 d，为具有 f(x,y) 的对绘制边

如果*要按字典顺序*最小化它，这很简单：选择距离最短的对并将其作为 arr[0],arr[1]，然后选择最接近 arr[1] 的 arr[2]，依此类推.

根据你的 f(,)s 来自哪里，这可能比 TSP 容易得多；你也可以提一下。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-22T03:25:00.983

您并不完全清楚您正在优化什么 - f(a[i],a[i+1]) 值的总和，它们的最大值，还是其他什么？

无论如何，由于您的速度限制，贪婪可能是您最好的选择 - 选择一个元素来制作 a[0] （由于环绕而无关紧要），然后选择每个连续的元素 a[i+1]是最小化 f(a[i],a[i+1]) 的那个。

这将是 O(n^2)，但有 30 个项目，除非这是在一个内部循环中或其他什么都可以的。如果你的 f() 真的是关联的和可交换的，那么你也许可以在 O(n log n) 中做到这一点。减少到排序显然不会更快。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T03:26:19.983

我认为问题在这种形式中没有得到很好的定义：

让我们定义 n fcns g_i ： Perms -> Reals

```
g_i(p) = f(a^p[i], a^p[i+1]), and wrap around when i+1 > n 
```

说你想在所有排列上最小化*f*实际上意味着你可以选择*i*的值并在所有排列上最小化*g_i* ，但是对于最小化*g_i*的任何*p*，相关但*不同*的排列最小化*g_j*（只是共轭排列）。因此，在每个*i*的排列上最小化 f 是没有意义的。

 **** * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-13T00:53:18.290

除非我们对 f(x,y) 的结构有更多了解，否则这是一个 NP-hard 问题。给定一个图 G 和任何顶点 x,y 如果没有边，则 f(x,y) 为 1，如果有边，则为 0。问题要求对顶点进行排序，以使最大 f(arr[i],arr[i+1]) 值最小化。因为对于这个函数，它只能是 0 或 1，返回 0 相当于在 G 中找到一条哈密顿路径，而 1 表示不存在这样的路径。

该函数必须具有某种不允许此示例的结构，才能使其易于处理。

# c# - 为什么 Microsoft Visual C# 2008 Express Edition 调试器随机退出？

> ID：310788
> 
> 赞同：3
> 
> 时间：2008-11-22T02:56:24.737
> 
> 标签：c#, visual-studio, visual-studio-2008, multithreading, debugging

我正在 Microsoft Visual C# 2008 Express Edition 中编写多线程 Windows 应用程序。最近，调试器一直表现得很奇怪。

当我使用 F10 跳过代码行时，有时它会像继续命令 (F5) 一样解释我的跳过 (F10) 命令，然后程序将恢复运行并完成调试会话。

有谁知道为什么会这样？在什么情况下 Step Over 命令会导致调试器停止？

被调试的代码不是问题：它不仅仅发生在特定的代码行上。它发生在每次运行调试器时都不同的随机行上。

这不是我的键盘的问题：当我单击“调试”工具栏中的“跳过”时也会发生同样的事情。

这可能是我程序中其他线程的问题。也许其中一个正在随机做一些具有中断调试器副作用的事情。那可能吗？

提前致谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-22T03:07:31.550

我已经看过几次了。它通常发生在上下文切换到另一个线程时。因此，您可能正在单步执行 ID 为 11 的线程，按下 F10，并且有一个先发制人的上下文切换，所以现在您在线程 ID 12 上运行，因此 Visual Studio 很高兴地允许代码继续运行。

[这里](http://www.eggheadcafe.com/articles/20050511.asp)有一些很好的调试技巧：

> 提示：仅在特定线程调用方法时中断：要设置每个线程的断点，您需要使用其 Name 属性唯一标识您已指定名称的特定线程。您可以通过创建诸如 "ThreadToStopOn" == Thread.CurrentThread.Name 之类的条件表达式来为线程设置条件断点。
> 
> 您可以通过观察变量“myThread”并在值窗口中为其输入名称值来手动更改 Watch 窗口中的线程名称。如果您没有要使用的当前线程变量，您可以使用 Thread.CurrentThread.Name 来设置当前线程的名称。Thread 类中还有一个私有整数变量，DONT_USE_InternalThread，这是每个线程唯一的。您可以使用 Threads 窗口找到要停止的线程，然后在 Watch 窗口中输入 Thread.CurrentThread.DONT_USE_InternalThread 以查看它的值，以便创建正确的条件断点表达式。

[编辑：这里](http://www.learn2debug.com/articles/visual-studio-net/debugging-managed-thread-applications-using-visual-studio-net.aspx)也有一些很好的提示。我通过谷歌搜索“Visual Studio 防止在调试时切换线程”发现了这一点。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-10T20:24:57.290

您应该查看这篇[知识库文章](http://support.microsoft.com/default.aspx/kb/957912)并考虑其匹配的修补程序。

编辑：该修补程序确实解决了这些调试问题。不幸的是，修补程序的源代码更改并没有回到主分支，VS2010 也出现了完全相同的问题。它的 Service Pack 1 再次纠正了这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T22:47:12.910

我发现在处理多个线程时使用日志文件非常方便。

调试线程就像 Huysenberg 原则 - 观察得太仔细，你会改变结果！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-23T21:36:50.397

试试这个[http://support.microsoft.com/kb/957912](http://support.microsoft.com/kb/957912)。为我工作。

# ruby-on-rails - Ruby on Rails 2.1 子域 Cookie 问题

> ID：310801
> 
> 赞同：2
> 
> 时间：2008-11-22T03:20:14.817
> 
> 标签：ruby-on-rails, ruby

使用子域并尝试查看与 current_user 相关的任何内容时。用户被发送到一个新的会话页面，该页面显示会话已创建并提供注销选项。我不能使用任何子域，它工作正常。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T03:56:17.533

将其设置在您的 environment.rb 中（或 environment/*.rb，如果您将为每个环境使用不同的域）：

```
ActionController::CgiRequest::DEFAULT_SESSION_OPTIONS.update( :session_domain => '.domain.com') 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-21T10:39:32.707

仅供参考...从 Rails 2.3 开始，此设置已更改。rails 2.3+ 版本看起来像：

```
ActionController::Base.session_options[:domain] = '.domain.com' 
```

以防万一其他人从谷歌登陆这里并像我一样感到困惑。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-04-25T21:29:33.237

@jkrall - 除此之外，整个选项哈希移动到：key、：secret 和：domain vs ：session_key、：session_domain 等。

# .net - WPF 将集合绑定到 ComboBox 并选择一个项目

> ID：310805
> 
> 赞同：8
> 
> 时间：2008-11-22T03:22:31.113
> 
> 标签：.net, wpf, data-binding, combobox

一段时间以来，我一直在反对这一点。我不确定为什么它不起作用。我对整个 WPF 业务还是很陌生。

这是我的组合框的 XAML

```
<ComboBox 
    SelectedValuePath="Type.FullName"
    SelectedItem="{Binding Path=Type}"
    Name="cmoBox" /> 
```

这是填充 ComboBox 的内容（myAssembly 是我使用可能类型列表创建的一个类）

```
cmoBox.ItemsSource = myAssembly.PossibleTypes; 
```

我在后面的代码中将 DataContext 设置在 ComboBox 的父元素中，如下所示：

```
groupBox.DataContext = listBox.SelectedItem; 
```

我希望绑定从组合框中选择正确的“可能类型”。它不选择任何东西。我已经尝试过 SelectedValue 和 SelectedItem。当我将 ComboBox 的 DisplayMemberPath 更改为不同的属性时，它改变了显示的内容，所以我知道它并没有完全损坏。

有任何想法吗？？？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-12-08T11:15:24.333

您还可以在 xaml 中而不是在代码隐藏中设置绑定（我们尽可能避免在 xaml 页面中隐藏代码）。我假设 myAssembly 是您的控件代码隐藏的属性，并且是您的 MyAssembly 类的实例...

```
<UserControl 
  x:Class="MyNamespace.MyControl"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  DataContext="{Binding}">

  <ComboBox 
    Width="200" 
    ItemsSource="{Binding Path=myAssembly.PossibleTypes}"
    SelectedValuePath="Type.FullName"  
    SelectedItem="{Binding Path=Type}" 
    Name="cmoBox" />
</UserControl> 
```

这可能只是个人喜好，但我认为在 xaml 中进行数据绑定是更好的做法，因为这样可以更轻松地查看每个控件绑定的内容，而无需浏览代码隐藏。此外，如果您想在代码中引用您的 ComboBox，您应该在 xaml 中为其分配一个 x:Name 属性，而不仅仅是 Name。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-22T03:29:06.543

在 XAML 中，设置`ItemsSource="{Binding}"`和（在后面的代码中）`DataContext`将`myAssembly.PossibleTypes`.

* * *

## 回答 #3

> 赞同：-5
> 
> 时间：2010-04-01T18:00:04.247

我同意：绑定应该在 XAML 中。我在后面的代码中放了...检查..什么都没有。数据源都是可重复使用的“资源”。

（好吧，代码隐藏构造函数调用 InitializeComponent()）。

# actionscript - 如何在 Actionscript 中检查两个对象是否属于同一类型？

> ID：310820
> 
> 赞同：22
> 
> 时间：2008-11-22T03:40:27.113
> 
> 标签：actionscript, typeof

我想在 Actionscript 中执行此操作：

```
typeof(control1) != typeof(control2) 
```

测试两个对象是否属于同一类型。这在 C# 中可以正常工作，但在 Actionscript 中却不行。事实上，这`'object'`两个`typeof()`表达式都会返回，因为这就是 Actionscript 的工作方式。

`typeof()`通过查看调试器或在 Actionscript中描述的页面，我似乎无法找到替代方案。

有没有办法获得实际的运行时类型？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-24T18:42:39.727

最好的方法是使用`flash.utils.getQualifiedClassName()`. 此外，您可以使用`flash.utils.describeType()`获取有关该类的更多描述的 XML 文档。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-10T22:06:06.387

Actionscript 3 有一个**is**运算符，可用于比较对象。考虑以下代码：

```
var mySprite:Sprite = new Sprite();
var myMovie:MovieClip = new MovieClip();

trace(mySprite is Sprite);
trace(myMovie is MovieClip);
trace(mySprite is MovieClip);
trace(myMovie is Sprite); 
```

这将产生以下输出：

```
true
true
false
false 
```

这适用于内置类和您自己创建的类。**is**运算符的 actionscript 2 等效项是**instanceof**。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-22T04:45:22.397

你会想要使用 Object.prototype.constructor。

从[文档](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/Object.html#constructor)中：

```
 dynamic class A {}
  trace(A.prototype.constructor);      // [class A]
  trace(A.prototype.constructor == A); // true
  var myA:A = new A();
  trace(myA.constructor == A);         // true 
```

（方便的是，这也是如何检查 javascript 中的类型，这也是最初导致我在文档中这样做的原因）

因此，为了在我在这里发布之前对此进行测试，我在一个名为 Player 的类中尝试了它。由于原型属性是静态的，你不能使用“this”来调用它，但你可以跳过范围标识符并且它可以工作：

```
public function checkType():void {
    trace(prototype.constructor, prototype.constructor == Player);
    // shows [class Player] true
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-02-14T21:46:47.970

> 有没有办法获得实际的运行时类型？

是的。

```
var actualRuntimeType:Class = Object(yourInstance).constructor; 
```

其他一些答案已经提到`.constructor`，但您不能总是直接`.constructor`在 ActionScript 3 中访问。它只能在`dynamic`类上访问，而大多数类不是。尝试在常规类上使用它会在默认设置下导致编译时错误。

但是，因为每个类都继承自`Object`，也就是说，我们可以通过将实例强制转换为`dynamic`来查找它们的属性。`.constructor``Object`

因此，如果我们对子类不感兴趣，我们可以通过简单地评估来确认两个实例是完全相同的类：

```
Object(instanceA).constructor === Object(instanceB).constructor; 
```

我从Josh Tynjala的文章“[获取用于在 AS3 中创建对象实例的类”中了解到这一点。](http://joshblog.net/2009/05/11/retrieve-the-class-used-to-instantiate-an-object-in-as3/)

* * *

一个更简单的替代方案也适用于我：

```
var actualRuntimeType:Class = yourInstance["constructor"]; 
```

运行时完全能够为您提供`.constructor`，只是如果您使用该语法，编译器会抱怨。使用`["constructor"]`应该产生相同的字节码，但编译器不够聪明，无法阻止你。

我之所以包含第二个，是因为除了我当前的 Flash 环境之外，它没有在任何地方进行过测试，而一些用户表示上述方法适用于他们。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-19T13:26:46.713

如果你想考虑继承，那么你可能想尝试这样的事情：

```
if (objectA is objectB.constructor || objectB is objectA.constructor)
{
    // ObjectA inherits from ObjectB or vice versa
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-15T07:03:43.160

```
Object obj = new Object();
Object o = new Object();

if(o.getClass().getName().endsWith(obj.getClass().getName())){
    return true;    
}else{
        return false;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-26T01:13:08.597

更一般地说，如果你想测试 objectA 是否是 objectB 的子类型

```
import flash.utils.getDefinitionByName;
import flash.utils.getQualifiedClassName;

...

if (objectA is getDefinitionByName(getQualifiedClassName(objectB)))
{
    ...
} 
```

# php - 如何从 PHP 脚本调用 ASP.NET .dll 文件？

> ID：310821
> 
> 赞同：3
> 
> 时间：2008-11-22T03:43:33.287
> 
> 标签：php, asp.net

您知道如何从 PHP 脚本调用 ASP.NET .dll 文件吗？
谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T04:41:32.497

您使用 DOTNET 扩展。

首先，您需要在 Windows 上运行它。如果您使用的是 linux，那么我会考虑使用 Facebooks Thrift 之类的东西。

如果您在 Windows 上，并且根据您使用的 Windows 版本，您可能需要取消注释 php.ini 中的 com 扩展名

```
<?php
 $stack = new DOTNET("mscorlib", "System.Collections.Stack");
 $stack->Push(".Net");
 $stack->Push("Hello ");
 echo $stack->Pop() . $stack->Pop();
?> 
```

以下是[Windows 特定功能的列表](http://us2.php.net/manual/en/book.com.php)

# embedded - 用于在嵌入式 CPU 和 PC 之间进行通信的协议

> ID：310826
> 
> 赞同：18
> 
> 时间：2008-11-22T03:49:34.490
> 
> 标签：embedded, avr, communication-protocol

我正在构建一个带有自己的 CPU (AVR Mega8) 的小型设备，它应该连接到 PC。假设已经完成了物理连接和字节传递，那么在这些字节之上使用的最佳协议是什么？计算机需要能够在设备上设置某些电压，并回读某些其他电压。

目前，我正在考虑一个完全由主机驱动的同步协议：计算机发送请求，嵌入式 CPU 应答。还有其他想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-22T04:17:35.650

对于客户端-服务器架构和同步协议，有很多话要说。简单和健壮，开始。如果速度不是问题，您可以考虑使用紧凑的、人类可读的协议来帮助调试。我正在考虑调制解调器 AT 命令的思路：“唤醒”序列后跟 set/get 命令，然后是终止符。

```
Host -->  [V02?]      // Request voltage #2
AVR  -->  [V02=2.34]  // Reply with voltage #2
Host -->  [V06=3.12]  // Set voltage #6
AVR  -->  [V06=3.15]  // Reply with voltage #6 
```

如果看不到右括号，每一方都可能会超时，并且它们会在下一个左括号上重新同步，而后者不能出现在消息本身中。

根据速度和可靠性要求，您可以将命令编码为一或两个字节并添加校验和。

*回复实际*电压总是一个好主意，而不是简单地回显命令，因为它保存了后续的读取操作。

也有助于定义错误消息，以防您需要调试。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-26T08:07:36.747

[Modbus](http://en.wikipedia.org/wiki/Modbus)可能是您正在寻找的。它专为您遇到的问题类型而设计。那里有很多代码/工具，遵守标准可能意味着以后可以轻松重用。它还支持人类可读的 ASCII，因此仍然很容易理解/测试。

有关 windows 和嵌入式源代码，请参阅[FreeModBus](http://www.freemodbus.org/)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-25T13:43:03.603

我的投票是为了人类可读的。

但是如果你是二进制的，试着在开头放一个头字节来标记一个数据包的开始。我总是运气不好，串行协议不同步。标头字节允许嵌入式系统与 PC 重新同步。另外，在最后添加一个校验和。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-25T19:41:58.140

我用简单的二进制格式做了这样的事情

```
struct PacketHdr
{
  char syncByte1;
  char syncByte2;
  char packetType;
  char bytesToFollow;  //-or- totalPacketSize
};

struct VoltageSet
{ 
   struct PacketHdr;
   int16 channelId;
   int16 voltageLevel; 
   uint16 crc;
};

struct VoltageResponse
{
   struct PacketHdr;
   int16 data[N];  //Num channels are fixed
   uint16 crc;
} 
```

同步字节在同步协议中不如在异步协议中重要，但它们仍然有帮助，尤其是当嵌入式系统第一次上电时，您不知道它获得的第一个字节是消息的中间还是消息的中间不是。

类型应该是一个枚举，告诉如何解释数据包。大小可以从类型推断出来，但如果你明确地发送它，那么接收者可以处理未知类型而不会窒息。您可以使用“总数据包大小”或“要遵循的字节数”；后者可以使接收方代码更简洁。

最后的 CRC 增加了您拥有有效数据的更多保证。有时我会在标头中看到 CRC，这使得声明结构更容易，但将其放在最后可以避免在发送消息时额外传递数据。

发送方和接收方都应该在收到数据包的第一个字节后开始超时，以防丢失一个字节。PC端也需要超时来处理嵌入式系统没有连接完全没有响应的情况。

如果您确定两个平台都使用 IEEE-754 浮点数（PC 使用）并且具有相同的字节序，那么您可以使用浮点数作为数据类型。否则，使用整数会更安全，无论是原始 A/D 位还是预设比例（即 1 位 = .001V 给出 +/-32.267 V 范围）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-23T18:10:44.017

亚当·利斯提出了很多重要的观点。简单性和鲁棒性应该是重点。人类可读的 ASCII 传输在调试时有很大帮助。很棒的建议。

它们可能对您的需求来说太过分了，但 HDLC 和/或 PPP 增加了数据链路层的概念，以及数据链路层带来的所有好处（和成本）。链路管理、成帧、校验和、序列号、重传等...都有助于确保可靠的通信，但会增加复杂性、处理和代码大小，并且对于您的特定应用程序可能不是必需的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-22T12:09:55.150

[USB 总线](http://en.wikipedia.org/wiki/USB)将满足您的所有要求。它可能是非常简单的 USB 设备，只有控制管道向您的设备发送请求，或者您可以添加一个中断管道，以便通知主机您的设备发生变化。可以使用许多简单的 USB 控制器，例如[Cypress](http://www.cypress.com/products/?gid=9&fid=13&GoGatewayCategoryID=All&)或[Microchip](http://www.microchip.com/stellent/idcplg?IdcService=SS_GET_PAGE&nodeId=2124&param=en022613&page=wwwFullSpeedUSB)。

传输之上的协议确实与您的要求有关。从您的描述看来，简单的同步协议似乎就足够了。是什么让你徘徊并寻找其他方法？分享您的疑问，我们将尽力提供帮助:)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-23T19:17:55.193

如果我不希望需要进行有效的二进制传输，我会选择已经建议的终端样式界面。

如果我确实想做二进制数据包格式，我倾向于使用基于 PPP byte-asnc HDLC 格式的松散格式，它非常简单且易于发送接收，基本上：

数据包以 0x7e 开头和结尾您通过在字符前面加上 0x7d 并切换位 5（即与 0x20 进行异或）来转义字符，因此 0x7e 变为 0x7d 0x5e 并且 0x7d 变为 0x7d 0x5d

每次看到 0x7e 时，如果您存储了任何数据，您就可以对其进行处理。

我通常会做主机驱动的同步工作，除非我有很好的理由不这样做。这是一种从简单的点点 RS232 扩展到多点 RS422/485 的技术，没有任何麻烦——通常是一种奖励。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-26T01:49:27.040

正如您可能已经从所有不直接将您定向到协议的响应中确定的那样，滚动您自己的方法是您的最佳选择。

所以，这让我开始思考，好吧，这是我的一些想法——

鉴于该芯片有 6 个 ADC 通道，很可能您正在使用 Rs-232 串行通信（您的问题的猜测），当然，有限的代码空间，定义一个简单的命令结构将有所帮助，正如 Adam 指出的那样——您可能希望在芯片上将输入处理保持在最低限度，因此二进制听起来很有吸引力，但权衡是易于开发和服务（您可能需要在 6 个月后解决死输入问题）——超级终端功能强大调试工具——所以，这让我想到了如何实现一个具有良好可靠性的简单命令结构。

一些一般性的考虑——

保持命令大小相同——使解码更容易。

正如亚当指出的那样，构建命令和可选的校验和可以很容易地围绕您的命令进行包装。（使用小命令，简单的 XOR/ADD 校验和快速而轻松）

我会向主机推荐一个带有重置时固件版本的启动公告——例如，“你好；固件版本 1.00z”——会告诉主机目标刚刚启动以及正在运行的内容。

如果您主要是监控，您可能希望考虑“自由运行”模式，其中目标将简单地循环通过模拟和数字读数 - 当然，这不必是连续的，它可以间隔为 1， 5、10 秒，或者只是根据命令。您的 micro 一直在监听，因此发送更新的值是一项独立的任务。

用 CR（或其他字符）终止每个输出行可以直接在主机上进行同步。

例如，您的 micro 可以简单地输出字符串；

```
 V0=3.20
  V1=3.21
  V2= ...
  D1=0
  D2=1
  D3=...
  and then start over -- 
```

此外，命令可能非常简单——

? - 阅读所有值——它们的数量不多，所以全部获取。

X=12.34 - 要设置一个值，第一个字节是端口，然后是电压，我建议保留“=”和“。” 如果您放弃校验和，作为框架以确保有效数据包。

另一种可能性是，如果您的输出在设定范围内，您可以预先调整它们。例如，如果输出不必精确，您可以发送类似

```
5=0 
6=9
2=5 
```

这会将端口 5 设置为关闭，端口 6 设置为完全打开，将端口 2 设置为半值——使用这种方法，ascii 和二进制数据在微型计算机的计算/解码资源方面几乎处于相同的基础上。或者为了更精确，使输出 2 个字节，例如 2=54 - 或者，添加一个外部参照表，并且值甚至不必是线性的，其中数据字节是查找表的索引。 .

正如我喜欢说的；简单通常更好，除非它不是。

希望这个对你有帮助。

* * *

重读时有了另一个想法；添加“*”命令可以请求使用 html 标签包装的数据，现在您的主机应用程序可以简单地将输出从您的 micro 重定向到浏览器和 wala，浏览器准备就绪 --

:)

# python - 在 Django 中对 form.cleaned_data[i] 使用 rstrip

> ID：310833
> 
> 赞同：1
> 
> 时间：2008-11-22T04:02:49.050
> 
> 标签：python, django

在我的views.py中，我有一个这样的代码片段：

```
def clean_post_data(form):
    for i in form.cleaned_data:
        form.cleaned_data[i] = form.cleaned_data[i].rstrip()

def add_product(request):   
    form = ProductForm(request.POST, request.FILES or None)
    image = Image.objects.all()
    action = "Add"

    if request.POST:
        if form.is_valid():
            clean_post_data(form)
            form.save()
            action = "Added new product"
            return render_to_response('cms/admin/action.html', {'action' : action},context_instance=RequestContext(request))
        else:
            action = "There was an error. Please go back and try again"
            return render_to_response('cms/admin/action.html', {'action' : action}, context_instance=RequestContext(request))

    return render_to_response('cms/admin/editproduct.html', {'form' : form, 'action' : action, 'image' : image}, context_instance=RequestContext(request)) 
```

但是当我运行它时，我收到以下错误`'list' object has no attribute 'rstrip'`。我究竟做错了什么。

我最初`for i in form.cleaned_data:`在视图中直接有循环（而不是在另一个函数中）并且它工作正常，但现在当我尝试它时，我得到与上面相同的错误。[http://dpaste.com/92836/](http://dpaste.com/92836/)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T12:46:33.020

`clean_post_data`不应该是一个独立的功能。

它应该是一个名为 的方法`clean`。请参阅[表单和字段验证](http://docs.djangoproject.com/en/dev/ref/forms/validation/#ref-forms-validation)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T05:07:47.233

很可能您的表单上有多个具有相同名称的元素。提交时，cleaned_data 返回的元素之一是列表

如果你想跳过（或做一些特别的事情）这样的情况，你需要检查它：

```
def clean_post_data（表格）：
    对于我在 form.cleaned_data 中：
        if('__iter__' in dir(form.cleaned_data[i])):
            print "跳过这个元素：" + str(form.cleaned_data[i])
        别的：
            form.cleaned_data[i] = form.cleaned_data[i].rstrip()

```

# networking - 应用程序挂起 DNS 查找是否有技术原因？

> ID：310839
> 
> 赞同：2
> 
> 时间：2008-11-22T04:11:11.700
> 
> 标签：networking, network-programming, dns

如果我在“正在查找 domain.com ...”时尝试退出 Firefox，它会弹跳（挂起），进入“无响应”状态，然后最终退出。它没有失败地做到这一点。

这是在带有最新 FF 的 Mac 上，但对我来说一直都是这样，即使在带有 FF 的 Windows 上，我已经注意到它与其他应用程序。

有什么技术原因不能更好地处理吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T04:28:28.483

不，您可以使用线程甚至单独的进程来异步执行此操作（非阻塞）。这只是写得不好的软件。

除此之外，我对FF没有这个特殊的问题......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-25T07:08:43.027

您应该检查 bugzilla.mozilla.org 以查看最近是否有任何有关 DNS 服务的错​​误。从历史上看，这种类型的问题在 Firefox 和其他基于 Mozilla 的产品中非常罕见，但有时特定问题会导致 DNS 服务停止运行或等待超时。

另一个重要的问题是：你确定是 DNS 吗？数据包跟踪或ecko 调试日志可能很有用。状态栏的工作方式，所说的不一定是阻止它退出的原因。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-30T13:07:51.517

有针对此问题的[错误报告。](https://bugzilla.mozilla.org/show_bug.cgi?id=235853 "Mozilla 错误 235853")它至少从 2004 年就已经存在。

# python - Python GTK MVC

> ID：310856
> 
> 赞同：3
> 
> 时间：2008-11-22T04:26:23.277
> 
> 标签：python, model-view-controller, gtk

我一直在寻找一个好的 Python 使用 PyGTK 的 MVC 框架。我看过[Kiwi](http://www.async.com.br/projects/kiwi/)，但发现它有点欠缺，尤其是在使用 Gazpacho Glade 替代品时。

还有其他不错的桌面 Python MVC 框架吗？我是少数（似乎）不想要网络应用程序的人之一。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-22T12:25:32.657

为猕猴桃辩护：

*   Kiwi 与 Glade3 而不是 Gazpacho 一起工作得很好。（谁强迫你使用西班牙凉菜汤？）
*   Kiwi 是我对*任何*PyGTK 商业或开源应用程序的第一个依赖项。
*   猕猴桃的维护非常积极。

我通常已经到了一个阶段，我认为不在 PyGTK 应用程序中使用 Kiwi 是不负责任的。也许您可以告诉我们您发现“缺少”什么，以便我们改进框架。#kiwi 在 irc.gimp.net（或 Kiwi 邮件列表）上。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-22T05:36:47.847

[Dabo](https://stackoverflow.com/questions/310856/python-gtk-mvc)是一些从 FoxPro 搬来的人制作的。如果您正在编写数据驱动的业务应用程序，它可能对您有用。

除此之外，我还没有找到任何你没有的东西。

> GUI的东西*应该*很难。它塑造性格。

（[归功于](http://quotations.amk.ca/python-quotes/#q28)早期 Python 研讨会之一的 Jim Ahlstrom。不幸的是，从那时起事情并没有太大变化。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-22T06:19:22.520

名为“mvc”的应用程序：

[http://sourceforge.net/projects/pygtkmvc/](http://sourceforge.net/projects/pygtkmvc/)

“avc”标题应用程序：

[http://avc.inrim.it/html/](http://avc.inrim.it/html/)

更多信息：

[http://www.pygtk.org/applications.html](http://www.pygtk.org/applications.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T17:58:56.417

纯MVC

[http://trac.puremvc.org/PureMVC_Python](http://trac.puremvc.org/PureMVC_Python)

# javascript - Use of 'prototype' vs. 'this' in JavaScript?

> ID：310870
> 
> 赞同：814
> 
> 时间：2008-11-22T04:39:49.693
> 
> 标签：javascript, prototype, this

What's the difference between

```
var A = function () {
    this.x = function () {
        //do something
    };
}; 
```

and

```
var A = function () { };
A.prototype.x = function () {
    //do something
}; 
```

* * *

## 回答 #1

> 赞同：476
> 
> 时间：2008-11-22T05:26:52.203

The examples have very different outcomes.

Before looking at the differences, the following should be noted:

*   A constructor's *prototype* provides a way to share methods and values among instances via the instance's private `[[Prototype]]` property.
*   A function's *this* is set by how the function is called or by the use of *bind* (not discussed here). Where a function is called on an object (e.g. `myObj.method()`) then *this* within the method references the object. Where *this* is not set by the call or by the use of *bind*, it defaults to the global object (window in a browser) or in strict mode, remains undefined.
*   JavaScript is an object-oriented language, i.e. most values are objects, including functions. (Strings, numbers, and booleans are *not* objects.)

So here are the snippets in question:

```
var A = function () {
    this.x = function () {
        //do something
    };
}; 
```

In this case, variable `A` is assigned a value that is a reference to a function. When that function is called using `A()`, the function's *this* isn't set by the call so it defaults to the global object and the expression `this.x` is effective `window.x`. The result is that a reference to the function expression on the right-hand side is assigned to `window.x`.

In the case of:

```
var A = function () { };
A.prototype.x = function () {
    //do something
}; 
```

something very different occurs. In the first line, variable `A` is assigned a reference to a function. In JavaScript, all functions objects have a *prototype* property by default so there is no separate code to create an *A.prototype* object.

In the second line, *A.prototype.x* is assigned a reference to a function. This will create an *x* property if it doesn't exist, or assign a new value if it does. So the difference with the first example in which object's *x* property is involved in the expression.

Another example is below. It's similar to the first one (and maybe what you meant to ask about):

```
var A = new function () {
    this.x = function () {
        //do something
    };
}; 
```

In this example, the `new` operator has been added before the function expression so that the function is called as a constructor. When called with `new`, the function's *this* is set to reference a new Object whose private `[[Prototype]]` property is set to reference the constructor's public *prototype*. So in the assignment statement, the `x` property will be created on this new object. When called as a constructor, a function returns its *this* object by default, so there is no need for a separate `return this;` statement.

To check that *A* has an *x* property:

```
console.log(A.x) // function () {
                 //   //do something
                 // }; 
```

This is an uncommon use of *new* since the only way to reference the constructor is via *A.constructor*. It would be much more common to do:

```
var A = function () {
    this.x = function () {
        //do something
    };
};
var a = new A(); 
```

Another way of achieving a similar result is to use an immediately invoked function expression:

```
var A = (function () {
    this.x = function () {
        //do something
    };
}()); 
```

In this case, `A` assigned the return value of calling the function on the right-hand side. Here again, since *this* is not set in the call, it will reference the global object and `this.x` is effective `window.x`. Since the function doesn't return anything, `A` will have a value of `undefined`.

These differences between the two approaches also manifest if you're serializing and de-serializing your Javascript objects to/from JSON. Methods defined on an object's prototype are not serialized when you serialize the object, which can be convenient when for example you want to serialize just the data portions of an object, but not it's methods:

```
var A = function () { 
    this.objectsOwnProperties = "are serialized";
};
A.prototype.prototypeProperties = "are NOT serialized";
var instance = new A();
console.log(instance.prototypeProperties); // "are NOT serialized"
console.log(JSON.stringify(instance)); 
// {"objectsOwnProperties":"are serialized"} 
```

**Related questions**:

*   [**What does it mean that JavaScript is a prototypal language?**](https://stackoverflow.com/questions/186244/what-does-it-mean-that-javascript-is-a-prototype-based-language)
*   [**What is the scope of a function in JavaScript?**](https://stackoverflow.com/questions/235360/what-is-the-scope-of-a-function-in-javascriptecmascript)
*   **[How does the "this" keyword work?](https://stackoverflow.com/questions/3127429/javascript-this-keyword)**

**Sidenote:** There may not be any significant memory savings between the two approaches, however using the prototype to share methods and properties will likely use less memory than each instance having its own copy.

JavaScript isn't a low-level language. It may not be very valuable to think of prototyping or other inheritance patterns as a way to explicitly change the way memory is allocated.

* * *

## 回答 #2

> 赞同：242
> 
> 时间：2008-11-22T05:41:49.443

As others have said the first version, using "this" results in every instance of the class A having its own independent copy of function method "x". Whereas using "prototype" will mean that each instance of class A will use the same copy of method "x".

Here is some code to show this subtle difference:

```
// x is a method assigned to the object using "this"
var A = function () {
    this.x = function () { alert('A'); };
};
A.prototype.updateX = function( value ) {
    this.x = function() { alert( value ); }
};

var a1 = new A();
var a2 = new A();
a1.x();  // Displays 'A'
a2.x();  // Also displays 'A'
a1.updateX('Z');
a1.x();  // Displays 'Z'
a2.x();  // Still displays 'A'

// Here x is a method assigned to the object using "prototype"
var B = function () { };
B.prototype.x = function () { alert('B'); };

B.prototype.updateX = function( value ) {
    B.prototype.x = function() { alert( value ); }
}

var b1 = new B();
var b2 = new B();
b1.x();  // Displays 'B'
b2.x();  // Also displays 'B'
b1.updateX('Y');
b1.x();  // Displays 'Y'
b2.x();  // Also displays 'Y' because by using prototype we have changed it for all instances 
```

As others have mentioned, there are various reasons to choose one method or the other. My sample is just meant to clearly demonstrate the difference.

* * *

## 回答 #3

> 赞同：168
> 
> 时间：2016-01-22T13:47:10.783

举这两个例子：

```
var A = function() { this.hey = function() { alert('from A') } }; 
```

对比

```
var A = function() {}
A.prototype.hey = function() { alert('from prototype') }; 
```

这里的大多数人（尤其是评价最高的答案）都试图解释它们的不同之处而不解释为什么。我认为这是错误的，如果您先了解基本原理，差异就会变得明显。让我们先尝试解释基本原理...

a) 函数是 JavaScript 中的对象。JavaScript 中的每个对象都有一个内部属性（意思是，你不能像其他属性一样访问它，除了可能在 Chrome 等浏览器中），通常被称为`__proto__`（你实际上可以`anyObject.__proto__`在 Chrome 中输入以查看它引用的内容。就是这样, 一个属性，仅此而已。JavaScript 中的属性 = 对象内部的变量，仅此而已。变量有什么作用？它们指向事物。

那么这个`__proto__`属性指向什么？好吧，通常是另一个对象（我们稍后会解释原因）。强制`__proto__`属性的 JavaScript 不指向另一个对象的唯一方法是使用`var newObj = Object.create(null)`. 即使你这样做，`__proto__`属性仍然作为对象的属性存在，只是它不指向另一个对象，它指向`null`.

这是大多数人感到困惑的地方：

当您在 JavaScript 中创建一个新函数（它也是一个对象，还记得吗？）时，在定义它的那一刻，JavaScript 会自动在该函数上创建一个名为`prototype`. 试试看：

```
var A = [];
A.prototype // undefined
A = function() {}
A.prototype // {} // got created when function() {} was defined 
```

`A.prototype`与`__proto__`物业完全不同。在我们的示例中，“A”现在有两个属性，称为“原型”和`__proto__`. 这对人们来说是一个很大的困惑。`prototype`和`__proto__`属性没有任何关系，它们是指向不同值的独立事物。

您可能想知道：为什么 JavaScript 会`__proto__`在每个对象上创建属性？好吧，一个词：**代表团**。当你调用一个对象的属性并且对象没有它时，JavaScript 会查找被引用的对象`__proto__`，看看它是否有它。如果它没有它，那么它会查看该对象的`__proto__`属性等等......直到链结束。因此得名**原型链**。当然，如果`__proto__`不是指向一个对象而是指向一个对象，那么`null`运气不好，JavaScript 会意识到这一点，并会为您返回`undefined`该属性。

您可能还想知道，为什么 JavaScript 会`prototype`在定义函数时创建一个为函数调用的属性？因为它试图欺骗你，所以**欺骗你**它就像基于类的语言一样工作。

让我们继续我们的示例并从以下内容创建一个“对象” `A`：

```
var a1 = new A(); 
```

当这件事发生时，后台发生了一些事情。`a1`是一个普通变量，它被分配了一个新的空对象。

`new`在函数调用之前使用运算符的事实`A()`在后台做了一些额外的事情。该`new`关键字创建了一个新对象，该对象现在引用`a1`并且该对象为空。这是另外发生的事情：

我们说过，在每个函数定义上，都会创建一个名为`prototype`（您可以访问它，与`__proto__`属性不同）的新属性？好吧，现在正在使用该属性。

所以我们现在有了一个新鲜出炉的空`a1`物体。我们说过，JavaScript 中的所有对象都有一个内部`__proto__`属性，它指向某个东西（`a1`也有它），无论它是 null 还是另一个对象。运算符所做的`new`是将`__proto__`属性设置为指向函数的`prototype`属性。再读一遍。基本上是这样的：

```
a1.__proto__ = A.prototype; 
```

我们说它`A.prototype`只不过是一个空对象（除非我们在定义之前将其更改为其他东西`a1`）。所以现在基本上`a1.__proto__`指向同一个东西`A.prototype`指向，也就是那个空对象。它们都指向发生此行时创建的同一个对象：

```
A = function() {} // JS: cool. let's also create A.prototype pointing to empty {} 
```

`var a1 = new A()`现在，在处理语句时发生了另一件事。基本上`A()`被执行，如果 A 是这样的：

```
var A = function() { this.hey = function() { alert('from A') } }; 
```

里面的所有东西`function() { }`都会执行。当您到达该`this.hey..`行时，`this`将更改为`a1`，您会得到以下信息：

```
a1.hey = function() { alert('from A') } 
```

我不会介绍为什么要`this`更改，`a1`但这是了解更多信息[的好答案。](https://stackoverflow.com/a/80478/1085998)

总而言之，当你这样做时`var a1 = new A()`，后台会发生 3 件事：

1.  一个全新的空对象被创建并分配给`a1`.`a1 = {}`
2.  `a1.__proto__`属性被分配为指向与指向相同的事物`A.prototype`（另一个空对象 {} ）

3.  该函数`A()`正在执行，并`this`设置为在步骤 1 中创建的新的空对象（阅读我上面引用的关于为什么`this`更改为的答案`a1`）

现在，让我们尝试创建另一个对象：

```
var a2 = new A(); 
```

步骤 1、2、3 将重复。你注意到什么了吗？关键词是**重复。**第 1 步：`a2`将是一个新的空对象，第 2 步：它的`__proto__`属性将指向同一个对象，`A.prototype`最重要的是，第 3 步：`A()`再次执行函数，这意味着`a2`将获得`hey`包含函数的属性。`a1`并`a2`有两个单独的属性命名`hey`，它们指向 2 个单独的函数！我们现在在相同的两个不同对象中有重复的函数做同样的事情，哎呀......如果我们创建了 1000 个对象，您可以想象这对内存的影响`new A`，毕竟所有函数声明都比数字 2 占用更多的内存。所以我们如何防止这种情况发生？

还记得为什么`__proto__`属性存在于每个对象上吗？因此，如果您检索`yoMan`on 上的属性`a1`（不存在），`__proto__`将查询其属性，如果它是一个对象（并且大多数情况下是），它将检查它是否包含`yoMan`，如果不包含，它将咨询该对象的`__proto__`等。如果这样做，它将获取该属性值并将其显示给您。

所以有人决定使用这个事实 + 当你创建时`a1`，它的`__proto__`属性指向同一个（空）对象`A.prototype`指向并这样做：

```
var A = function() {}
A.prototype.hey = function() { alert('from prototype') }; 
```

凉爽的！现在，当您创建时`a1`，它会再次执行上述所有 3 个步骤，并且在第 3 步中，它什么也不做，因为没有任何`function A()`东西要执行。如果我们这样做：

```
a1.hey 
```

它将看到`a1`不包含`hey`，它将检查其`__proto__`属性对象以查看它是否具有它，就是这种情况。

通过这种方法，我们消除了第 3 步中函数在每个新对象创建时重复的部分。现在没有一个人拥有它，`a1`而不是`a2`拥有一个单独的财产。`hey`哪个，我猜，你现在自己想通了。那是好事……如果您理解`__proto__`和`Function.prototype`，这样的问题将非常明显。

注意：有些人倾向于不将内部 Prototype 属性称为`__proto__`，我在帖子中使用此名称来清楚地将其区`Functional.prototype`分为两个不同的属性。

* * *

## 回答 #4

> 赞同：60
> 
> 时间：2008-11-22T05:03:58.570

In most cases they are essentially the same, but the second version saves memory because there is only one instance of the function instead of a separate function for each object.

A reason to use the first form is to access "private members". For example:

```
var A = function () {
    var private_var = ...;

    this.x = function () {
        return private_var;
    };

    this.setX = function (new_x) {
        private_var = new_x;
    };
}; 
```

Because of javascript's scoping rules, private_var is available to the function assigned to this.x, but not outside the object.

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2008-11-22T04:43:28.000

The first example changes the interface for that object only. The second example changes the interface for all object of that class.

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2012-09-21T11:15:27.407

使用`this`instead of的最终问题`prototype`是，当重写一个方法时，基类的构造函数仍然会引用被重写的方法。考虑一下：

```
BaseClass = function() {
    var text = null;

    this.setText = function(value) {
        text = value + " BaseClass!";
    };

    this.getText = function() {
        return text;
    };

    this.setText("Hello"); // This always calls BaseClass.setText()
};

SubClass = function() {
    // setText is not overridden yet,
    // so the constructor calls the superclass' method
    BaseClass.call(this);

    // Keeping a reference to the superclass' method
    var super_setText = this.setText;
    // Overriding
    this.setText = function(value) {
        super_setText.call(this, "SubClass says: " + value);
    };
};
SubClass.prototype = new BaseClass();

var subClass = new SubClass();
console.log(subClass.getText()); // Hello BaseClass!

subClass.setText("Hello"); // setText is already overridden
console.log(subClass.getText()); // SubClass says: Hello BaseClass! 
```

相对：

```
BaseClass = function() {
    this.setText("Hello"); // This calls the overridden method
};

BaseClass.prototype.setText = function(value) {
    this.text = value + " BaseClass!";
};

BaseClass.prototype.getText = function() {
    return this.text;
};

SubClass = function() {
    // setText is already overridden, so this works as expected
    BaseClass.call(this);
};
SubClass.prototype = new BaseClass();

SubClass.prototype.setText = function(value) {
    BaseClass.prototype.setText.call(this, "SubClass says: " + value);
};

var subClass = new SubClass();
console.log(subClass.getText()); // SubClass says: Hello BaseClass! 
```

如果您认为这不是问题，那么这取决于您是否可以在没有私有变量的情况下生活，以及您是否有足够的经验在看到泄漏时知道泄漏。此外，必须将构造函数逻辑放在方法定义之后是不方便的。

```
var A = function (param1) {
    var privateVar = null; // Private variable

    // Calling this.setPrivateVar(param1) here would be an error

    this.setPrivateVar = function (value) {
        privateVar = value;
        console.log("setPrivateVar value set to: " + value);

        // param1 is still here, possible memory leak
        console.log("setPrivateVar has param1: " + param1);
    };

    // The constructor logic starts here possibly after
    // many lines of code that define methods

    this.setPrivateVar(param1); // This is valid
};

var a = new A(0);
// setPrivateVar value set to: 0
// setPrivateVar has param1: 0

a.setPrivateVar(1);
//setPrivateVar value set to: 1
//setPrivateVar has param1: 0 
```

相对：

```
var A = function (param1) {
    this.setPublicVar(param1); // This is valid
};
A.prototype.setPublicVar = function (value) {
    this.publicVar = value; // No private variable
};

var a = new A(0);
a.setPublicVar(1);
console.log(a.publicVar); // 1 
```

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2016-02-11T15:30:41.917

每个对象都链接到一个原型对象。当试图访问一个不存在的属性时，JavaScript 将在对象的原型对象中查找该属性，如果存在则返回它。

函数构造函数的`prototype`属性是指使用该函数创建的所有实例的原型对象`new`。

* * *

在您的第一个示例中，您正在向使用该函数`x`创建的每个实例添加一个属性。`A`

```
var A = function () {
    this.x = function () {
        //do something
    };
};

var a = new A();    // constructor function gets executed
                    // newly created object gets an 'x' property
                    // which is a function
a.x();              // and can be called like this 
```

在第二个示例中，您正在向原型对象添加一个属性，所有创建的实例都`A`指向该对象。

```
var A = function () { };
A.prototype.x = function () {
    //do something
};

var a = new A();    // constructor function gets executed
                    // which does nothing in this example

a.x();              // you are trying to access the 'x' property of an instance of 'A'
                    // which does not exist
                    // so JavaScript looks for that property in the prototype object
                    // that was defined using the 'prototype' property of the constructor 
```

* * *

总之，在第一个示例**中，将函数的副本分配给每个实例**。在第二个示例**中，所有实例共享该函数的单个副本**。

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2014-01-06T06:13:34.873

有什么不同？=> 很多。

我认为，该`this`版本用于启用封装，即数据隐藏。它有助于操纵私有变量。

让我们看下面的例子：

```
var AdultPerson = function() {

  var age;

  this.setAge = function(val) {
    // some housekeeping
    age = val >= 18 && val;
  };

  this.getAge = function() {
    return age;
  };

  this.isValid = function() {
    return !!age;
  };
}; 
```

现在，该`prototype`结构可以应用如下：

不同的成年人有不同的年龄，但所有的成年人都享有相同的权利。
所以，我们使用原型添加它，而不是这个。

```
AdultPerson.prototype.getRights = function() {
  // Should be valid
  return this.isValid() && ['Booze', 'Drive'];
}; 
```

现在让我们看看实现。

```
var p1 = new AdultPerson;
p1.setAge(12); // ( age = false )
console.log(p1.getRights()); // false ( Kid alert! )
p1.setAge(19); // ( age = 19 )
console.log(p1.getRights()); // ['Booze', 'Drive'] ( Welcome AdultPerson )

var p2 = new AdultPerson;
p2.setAge(45);    
console.log(p2.getRights()); // The same getRights() method, *** not a new copy of it *** 
```

希望这可以帮助。

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2017-07-28T20:56:22.830

我知道这已经被回答死了，但我想展示一个速度差异的实际例子。

直接作用于对象：

```
function ExampleFn() {
    this.print = function() {
        console.log("Calling print! ");
    }
}

var objects = [];
console.time('x');
for (let i = 0; i < 2000000; i++) {
    objects.push(new ExampleFn());
}
console.timeEnd('x');

//x: 1151.960693359375ms
```

原型上的功能：

```
function ExampleFn() {
}
ExampleFn.prototype.print = function() {
    console.log("Calling print!");
}

var objects = [];
console.time('y');
for (let i = 0; i < 2000000; i++) {
    objects.push(new ExampleFn());
}
console.timeEnd('y');

//x: 617.866943359375ms
```

在这里，我们使用`print`Chrome 中的方法创建了 2,000,000 个新对象。我们将每个对象存储在一个数组中。穿上`print`原型大约需要 1/2 的时间。

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2008-11-22T06:16:02.543

原型是类的模板；这适用于它的所有未来实例。而这是对象的特定实例。

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2015-05-10T07:42:58.787

让我给你一个我在 JavaScript 培训课程中学到的更全面的答案。

大多数答案已经提到了差异，即在原型化功能时与所有（未来）实例共享。而在类中声明函数将为每个实例创建一个副本。

一般来说，没有对错之分，更多的是品味或设计决定，具体取决于您的要求。然而，原型是用于以面向对象的方式进行开发的技术，我希望你会在这个答案的末尾看到。

您在问题中显示了两种模式。我将尝试再解释两个，并尝试解释相关的差异。随意编辑/扩展。在所有示例中，它都是关于具有位置并且可以移动的汽车对象。

# 对象装饰器模式

不确定这种模式现在是否仍然适用，但它确实存在。很高兴知道它。您只需将一个对象和一个属性传递给装饰器函数。装饰器返回带有属性和方法的对象。

```
var carlike = function(obj, loc) {
    obj.loc = loc;
    obj.move = function() {
        obj.loc++;
    };
    return obj;
};

var amy = carlike({}, 1);
amy.move();
var ben = carlike({}, 9);
ben.move(); 
```

# 功能类

JavaScript 中的函数是一个专门的对象。除了被调用之外，函数还可以像任何其他对象一样存储属性。

在这种情况下`Car`，是一个**函数**（**也可以**认为是**object**），可以按照您习惯的方式调用。它有一个属性`methods`（它是一个具有`move`函数的对象）。当`Car`被调用时，`extend`函数会被调用，这会产生一些魔力，并`Car`使用定义在`methods`.

这个例子虽然不同，但最接近问题中的第一个例子。

```
var Car = function(loc) {
    var obj = {loc: loc};
    extend(obj, Car.methods);
    return obj;
};

Car.methods = {
    move : function() {
        this.loc++;
    }
};

var amy = Car(1);
amy.move();
var ben = Car(9);
ben.move(); 
```

# 原型类

前两种模式允许讨论使用技术来定义共享方法或使用在构造函数主体中内联定义的方法。在这两种情况下，每个实例都有自己的`move`功能。

原型模式不适合同样的检查，因为通过原型委托共享功能正是原型模式的目标。正如其他人指出的那样，预计它会有更好的内存占用。

然而有一点很有趣：每个`prototype`对象都有一个便利属性`constructor`，它指向它所附加的函数（想想对象）。

关于最后三行：

在本例中，`Car`链接到`prototype`对象，该对象链接`constructor`到`Car`自身，即自身。这使您可以确定哪个构造函数构建了某个对象。`Car.prototype.constructor``Car`

`amy.constructor`的查找失败，因此被委托给`Car.prototype`具有构造函数属性的 。`amy.constructor`也是如此`Car`。

此外，`amy`是一个`instanceof` `Car`. 该`instanceof`运算符通过查看右操作数的原型对象 ( `Car`) 是否可以在左操作数的原型 ( `amy`) 链中的任何位置找到。

```
var Car = function(loc) {
    var obj = Object.create(Car.prototype);
    obj.loc = loc;
    return obj;
};

Car.prototype.move = function() {
        this.loc++;
};

var amy = Car(1);
amy.move();
var ben = Car(9);
ben.move();

console.log(Car.prototype.constructor);
console.log(amy.constructor);
console.log(amy instanceof Car); 
```

一些开发人员一开始可能会感到困惑。请参见下面的示例：

```
var Dog = function() {
  return {legs: 4, bark: alert};
};

var fido = Dog();
console.log(fido instanceof Dog); 
```

`instanceof`运算符返回`false`，因为在 '的原型链中的`Dog`任何地方都找不到' 的原型。是一个使用对象字面量创建的简单对象，即它只是委托给.`fido``fido``Object.prototype`

# 伪经典模式

这实际上只是简化形式的原型模式的另一种形式，并且对于使用 Java 编程的人来说更熟悉，因为它使用`new`构造函数。

它实际上与原型模式中的相同，它只是原型模式之上的语法糖。

但是，主要区别在于 JavaScript 引擎中实现了仅在使用伪经典模式时才适用的优化。认为伪经典模式可能是原型模式的更快版本；两个例子中的对象关系是相同的。

```
var Car = function(loc) {
    this.loc = loc;
};

Car.prototype.move = function() {
        this.loc++;
};

var amy = new Car(1);
amy.move();
var ben = new Car(9);
ben.move(); 
```

* * *

最后，实现面向对象编程的方式应该不会太难。有两个部分。

定义原型（链）中通用属性/方法的部分。

在另一部分中，您放置了将对象彼此区分开的定义（`loc`示例中的变量）。

这就是允许我们在 JavaScript 中应用超类或子类等概念的原因。

随意添加或编辑。再完整一次，我也许可以把它变成一个社区维基。

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2008-11-22T05:11:46.680

I believe that @Matthew Crumley is right. They are *functionally*, if not structurally, equivalent. If you use Firebug to look at the objects that are created using `new`, you can see that they are the same. However, my preference would be the following. I'm guessing that it just seems more like what I'm used to in C#/Java. That is, define the class, define the fields, constructor, and methods.

```
var A = function() {};
A.prototype = {
    _instance_var: 0,

    initialize: function(v) { this._instance_var = v; },

    x: function() {  alert(this._instance_var); }
}; 
```

**EDIT** Didn't mean to imply that the scope of the variable was private, I was just trying to illustrate how I define my classes in javascript. Variable name has been changed to reflect this.

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2014-08-14T18:18:30.073

正如在其他答案中所讨论的，这实际上是一个性能考虑，因为原型中的函数与所有实例化共享 - 而不是为每个实例化创建函数。

我整理了一个 jsperf 来展示这一点。实例化类所需的时间有显着差异，尽管它只有在您创建许多实例时才真正相关。

[http://jsperf.com/functions-in-constructor-vs-prototype](http://jsperf.com/functions-in-constructor-vs-prototype)

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2017-12-19T01:13:04.063

想想静态类型的语言，事物`prototype`是静态的，事物`this`是与实例相关的。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2020-07-22T15:30:59.697

当您使用原型时，该函数只会加载一次到内存中（与您创建的对象数量无关），您可以随时覆盖该函数。

# c# - 在 Nunit 中使用 XtUnit 的 DataRollBack

> ID：310888
> 
> 赞同：0
> 
> 时间：2008-11-22T05:00:47.063
> 
> 标签：c#, .net, unit-testing, nunit

今天，我在单元测试框架的一部分中运行 XtUnit，以回滚在运行测试用例时创建的数据库更改。这是我如何使用它的骨架。测试用例成功运行，但数据库状态因此发生了变化。

```
using NUnit.Framework;
using TeamAgile.ApplicationBlocks.Interception;
using TeamAgile.ApplicationBlocks.Interception.UnitTestExtensions;

namespace NameSpace.UnitTest
{
  [TestFixture]
  public class Test : InterceptableObject
  {
    [Test]
    [DataRollBack]
    public void CreateTest()
    { 
```

我将 Nhibernate 与 Mysql 一起使用。我错过了什么吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T21:05:59.960

我认为您的测试夹具需要扩展`ExtensibleFixture`，而不是`InterceptableObject`。在 XtUnit 源代码中，`ExtensibleFixture`它本身继承自`InterceptableObject`. ExtensibleFixture.cs 中的注释说明：

> 这是
> 项目中所有测试装置的基类。您必须从这里继承才能
> 使自定义属性起作用。无需其他特殊操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T10:24:56.300

数据库和您的程序必须在 WindowsXP SP2 或 Server 2003 下运行。

# php - 使用 PHP 和 Visual Studio 进行本地开发的最佳方式是什么？

> ID：310889
> 
> 赞同：0
> 
> 时间：2008-11-22T05:01:34.750
> 
> 标签：php, asp.net-mvc, visual-studio

我第一次涉足 PHP 编程，需要第一次配置环境。我可以将 PHP 与内置的 VS Web 服务器一起使用，还是我需要（我希望不需要）在本地使用 IIS？

此外，任何关于要避免的陷阱的指针都会很棒。

非常感谢。

**更新：**我应该更明确地提出这个问题。我正在开发一个 ASP.Net MVC 应用程序。

**更新 2：**很明显，我没有像我希望的那样干净利落地问这个问题。这就是我正在做的事情。我有一个现有的 ASP.net MVC 应用程序，我正在向其中添加电子邮件表单。在研究过程中，我看到了这个页面：[Ajax Forms with jQuery](http://trevordavis.net/blog/tutorial/ajax-forms-with-jquery/)，我喜欢他提供的界面，并认为我会尝试调整它。调用 PHP 函数，因此我的问题。

同样清楚的是，这种混淆也可能来自于完全有更好的方法这一事实。那么，走出迷宫的方法是什么，爱丽丝？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T16:32:26.650

对于您正在做的事情，您真的不应该使用该示例中的 PHP 脚本。

相反，您应该在自己的自制页面上从发布到服务器的表单变量中提取数据。我不知道使用 MVC 框架执行此操作的“正确”方法。使用 ASP 表单框架，您可以执行类似的操作来处理 POST 数据（sendmail.php 文件的示例）

```
string mailTo = Request.Form["emailTo"];
string mailFrom = Request.Form["emailFrom"];
string subject = Request.Form["subject"];
string message = Request.Form["message"];

// Send mail here using variables above
// You'll need an SMTP server and some mail 
// sending code which I'm drawing a blank as
//  to what the name of the classes are at the moment 
```

在 MVC 框架中可能有更好的方法来处理此代码，但我没有使用它来告诉您它是什么。

基本上，您根本不能将 PHP 代码用于 ASP.NET 应用程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T05:17:20.100

IIS 上的 PHP 本身就是一个陷阱，您可以在此处找到一些参考：[在 IIS 上运行 PHP 应用程序需要什么？](https://stackoverflow.com/questions/10515/php-on-iis)

我建议从这里使用 WAMP：http: [//www.apachefriends.org/en/xampp-windows.html](http://www.apachefriends.org/en/xampp-windows.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T06:10:50.227

我在 Windows 上使用[XAMPP 。](http://www.apachefriends.org)效果很好。

# python - Any DAL/ORM on GAE?

> ID：310890
> 
> 赞同：3
> 
> 时间：2008-11-22T05:01:53.097
> 
> 标签：python, google-app-engine, orm, rdbms, data-access-layer

Is there any Database Abstraction Layer (DAL) or Object Relational Mapper (ORM) that works on Google App Engine (GAE), and on normal relational databases (RDBS), other than [web2py](http://www.web2py.com)'s?

If not, is anybody working on porting one of the existing DAL/ORM to GAE?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-05T00:59:21.533

Google App Engine 有一个 ORM。它和 SQLAlchemy 之间存在一些差异，但看起来它可以工作。检查此页面：[http ://code.google.com/appengine/docs/python/datastore/entitiesandmodels.html](http://code.google.com/appengine/docs/python/datastore/entitiesandmodels.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T15:47:54.533

Web2Py 有一个与 GAE 兼容的 DAL。其实整个框架可以部署到GAE： http: [//mdp.cti.depaul.edu/examples/default/index](http://mdp.cti.depaul.edu/examples/default/index)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-27T23:07:53.837

目前，看起来 SQLAlchemy 正在研究它，但它不完整/未完成。祝你好运！

# javascript - jQuery 的 html 方法中的奇怪行为

> ID：310911
> 
> 赞同：3
> 
> 时间：2008-11-22T05:20:44.977
> 
> 标签：javascript, jquery

$("p").html(0) 让所有段落为空而不是包含字符'0'的任何充分理由？

与其假设我在 jQuery 中发现了一个错误，不如说这可能是我的一个误解。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-22T05:35:50.097

jQuery 只接受一个字符串作为方法参数的`val`参数`html()`。如果你像你一样传递一个数字，它将调用`html()`设置元素内容的方法覆盖，但参数的值最终将为 null 或空字符串。

试试这个：

```
$("p").html((0).toString()) 
```

[相关文件](http://docs.jquery.com/Attributes/html#val)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T05:33:18.213

我想在某些时候，它会检查`if (newContent == false)`，并且不会继续添加任何内容？我试图查看源代码，但有点迷失了......

我还猜想这不会算作一个错误，因为该函数需要一个字符串，并且如果传递“0”（作为字符串），它会按预期工作。

一种解决方法是这样做：

```
var myNum = 0;
$('p').html('' + myNum); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-23T16:40:32.187

尝试`text()`改用`html()`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-24T12:05:58.280

执行 html 调用的代码在其他人的插件中，而不是对其进行修改，这使得升级变得乏味，我只是编写了以下小插件，该插件修改了该`html`方法以按照spoon16 的建议进行操作。

```
(function($) {
  var oldHtml = $.fn.html;
  $.fn.html = function (content) {
    oldHtml.apply(this, [content.toString()]);
  }
})(jQuery); 
```

这有点小技巧，但它对我有用，不需要我修改我正在使用的插件。

我只是觉得其他人可能喜欢看这个。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-22T10:02:27.873

我猜你错过了 jQuery 工作原理的一部分，

```
$('p') 
```

返回所有段落和 html( val ) 函数：

```
设置每个匹配元素的 html 内容。此属性在 XML 文档上不可用（尽管它适用于 XHTML 文档）。

```

[http://docs.jquery.com/Attributes/html#val](http://docs.jquery.com/Attributes/html#val)
所以如果你只想为第一个 p 设置内容

```
$("P").eq(0).html( 'something' ); 
```

或获取 html：

```
$("P").eq(0).html(); 
```

[http://docs.jquery.com/Core/eq#position](http://docs.jquery.com/Core/eq#position)
更多关于 jQuery 选择器的信息：http:
[//docs.jquery.com/Selectors](http://docs.jquery.com/Selectors)

# visual-c++ - How do I add an ActiveX component to my project in Visual C++ 2008

> ID：310912
> 
> 赞同：2
> 
> 时间：2008-11-22T05:21:34.710
> 
> 标签：visual-c++, activex, visual-c++-2008-express

I am just learning Visual C++ and I am used to Visual Basic where I just select the ActiveX component from a list of references. I can seem to add it anywhere. If I go to the Project | References, it is all blank. It only allows me to specify a path and when I specify the path of the AcitveX component, nothing new happens.

I dragged the ActiveX component into Visual C++ and it now shows up in the Object Browser but I cant seem to do anything with it.

I am using Visual C++ 2008 Express Edition.

Thanks

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-22T07:14:07.043

如果它是基于对话框的应用程序，则：

> 右键单击-> 添加 Active X 组件

它显示组件列表。选择所需的一个。

# php - Is filter_var sufficient to sanitise integer input for PHP-based MySQL queries?

> ID：310919
> 
> 赞同：1
> 
> 时间：2008-11-22T05:35:16.400
> 
> 标签：php, mysql, validation

I've never liked wrapping the

```
mysql_real_escape_string 
```

function around input I expect to be integer for inclusion in a MySQL query. Recently I came across the

```
filter_var 
```

function. Nice!

I'm currently using the code:

```
if (isset($idUserIN) 
    && filter_var($idUserIN, FILTER_VALIDATE_INT) 
    && 0 < filter_var($idUserIN, FILTER_SANITIZE_NUMBER_INT)
    ) {
      $idUser = filter_var($idUserIN, FILTER_SANITIZE_NUMBER_INT);
      $sql = 'SELECT * FROM TABLE_NAME WHERE idUser = '.$idUser;
} else {
  // handle invalid data
} 
```

Does this leave any holes open?

('> 0' chosen rather than '>= 0' as its a table auto_increment field, so 0 would not be a normal value)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T06:32:28.983

我自己会为该任务创建一个函数，可能在某个静态类中，

```
public static function escape_int($i) {
    $sanitised = intval($i); 
    if( '_' . $sanitised . '_' === '_' . $i . '_'  && $sanitised > 0 ) {
        return $sanitised;
    }
    throw new IntegerEscapeException( $i, $sanitised );
    return "ENOINT"; # Wont Run This, but I prepare for the impossible. 
}

try { 
    $sql = 'SELECT * FROM TABLE_NAME WHERE idUser = ' . DB::escape_int( $userid ); 
    DB::query($sql); 
    ...etc...
} catch( IntegerEscapeException $e ) { 
    die ( "You shot the sherif!" ); # bad example.
} 
```

这很好，因为如果我发现我的卫生方法很臭，我可以稍后修复它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T05:43:38.940

A much simpler and easier-to-read method that I use is this:

```
$sql = 'SELECT * FROM TABLE_NAME WHERE idUser = ' . intval($idUser); 
```

It attempts to convert $idUser to an integer and on failure returns 0 which none of my tables have as real id's. (So I know the input was invalid if it evaluates to 0.)

To answer your actual question, no that won't leave any holes open. I suggest getting rid of the repetitive code though:

```
$idUserIN_filtered = filter_var($idUserIN, FILTER_VALIDATE_INT);

if (isset($idUserIN) 
    && $idUserIN_filtered 
    && 0 < $idUserIN_filtered
    ) {
      $sql = 'SELECT * FROM TABLE_NAME WHERE idUser = '.$idUser_filtered;
} else {
  // handle invalid data
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T15:21:49.867

这就是你所需要的

```
if ($idUser = filter_var($idUserIN, FILTER_VALIDATE_INT)) {
      $sql = 'SELECT * FROM TABLE_NAME WHERE idUser = '.$idUser;
} else {
  // handle invalid data
} 
```

或者

```
if ($idUser = filter_input(INPUT_POST, 'userId', FILTER_VALIDATE_INT)) { 
```

或者，您可以检查它是否在 MVC 中无效。

```
if (!$idUser = filter_var($idUserIN, FILTER_VALIDATE_INT)) {
      throw new InputParameterException('UserId');
}
//else its valid 
```

# internet-explorer - Why cant I find my cookies in Temporary Internet Files?

> ID：310925
> 
> 赞同：1
> 
> 时间：2008-11-22T05:39:49.697
> 
> 标签：internet-explorer, cookies

I'm trying to convert a cookie from `www.example.com` to `.example.com`.

So I thought I'd go to C:\Users\SWEAVER\AppData\Local\Microsoft\Windows\Temporary Internet Files and just delete the cookie there.

To my surprise there were not only no temporary internet files (images/html...) but also very few cookies. And of course the cookie for my site was nowhere to be seen. However it is DEFINITELY working becasue I'm storing a GUID in there and that GUID was recoverable across different `iexplore.exe` processes.

I just went ahead and cleared cookies + temp files and now theres not a single file in my temp internet files directory - yet cookies ARE working for both my site and among others stackoverflow!

i did have a couple wierd bluescreens the other day - and in fact my event system log was corrupted. but i'm not sure if thats anythin to do with it?

I've run out of ideas but id really lke to be able to clear my application's cookies easily without screwing up my everyday cookies. Anybody got any idea about this or seen the problem before?

System : 2008 Server with IE7

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T06:41:07.903

Cookie 存储在多个位置。Vista有3个地方。看这里：

[http://www.dutchduck.com/help/Cookies%20Explorer/FAQ/Where%20are%20cookies%20stored.htm](http://www.dutchduck.com/help/Cookies%20Explorer/FAQ/Where%20are%20cookies%20stored.htm) – BobbyShaftoe

# security - Where do you record your authentication information (urls/ips/usernames/passwords)?

> ID：310929
> 
> 赞同：1
> 
> 时间：2008-11-22T05:42:05.077
> 
> 标签：security, authentication, credentials

I'm wondering what people use for storing their username, passwords, urls, IPs, domains, and any other login information they need to both do their job and in general life. It might also store serial numbers or similar data.

I find that I'm registering for probably 5 sites a month, paying some piece of software, just setting up a new hosting account or ssh access to something. By the end of the month, I've both forgot what those sites were and what my username and/or password is--not that I use a completely different password every time. Next month when I go back, I end up using the forgot password and then changing the password to something that I'll forget.

I'm also thinking it needs to be mobile, probably browser based (not a USB key or other protable media) and very secure.

I'm thinking there are maybe 2 different solutions: one for a company where everyone in the company can access it and one where it's only you.

What does everyone else **use** to store their authentication information?

**Edit:** I'm looking for something to store more than just a username and password. It needs to store IPs or domains for example for SSH access. It also needs to have the ability to put some kind of comment in or other information because, for example, the site maybe limited to 1 IP.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T07:00:01.080

我使用 KeePass。它有适用于各种平台的版本（例如，Linux 的 KeePassX），并且对我来说非常稳定。还没有丢失数据，所以我不必求助于我的备份:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-22T07:05:55.327

我使用[PasswordMaker](http://www.passwordmaker.org/)，[它是很棒的 Mozilla Firefox 插件](https://addons.mozilla.org/en-US/firefox/addon/469 "PasswordMaker Firefox 插件")。所有密码均由网站 URL 和您的用户名生成。您输入一个主密码，然后基本上“解锁”您的所有密码，因此您实际上只需要记住一个密码，但可以为您拥有帐户的每个网站设置一个唯一密码。

在[Stack Overflow Podcast #9中](https://blog.stackoverflow.com/2008/06/podcast-9/)**Jim McKeeth**也推荐了 PasswordMaker 。

另请注意，除了 Firefox 插件之外，还有许多其他方法可以与 PasswordMaker 集成。例如，他们有一个[在线版本](http://passwordmaker.sourceforge.net/passwordmaker.html)，基本上可以在任何地方使用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T21:09:29.227

我有两种不同的解决方案： 对于与工作相关的密码（登录到我们的 webbservers 和 mysql 用户和登录名），我们使用共享的谷歌文档。这并不理想，但总比只有一个密码好（我们刚开始时就这样做了），而且如果一个人被公共汽车碾过，总比被锁在门外好。

我的私人解决方案是 Jeremy Rutens 解决方案的变体，该算法根据 url/主机名提供几个字符，另一个算法用于密码的后半部分（当我忘记密码时，通常会给我两个或三个选择通过 - 但这只需要额外的几分钟）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-23T01:44:24.587

这是一个我认为符合您要求的简单解决方案。

1.  将您的所有用户名、密码、URL、IP 等内容存储在纯文本文件中。对真的。您甚至可能想要一个用于用户名和密码的文本文件，另一个用于 URL，另一个用于 IP……任何适合您的文本文件。
    或者，如果您在每个站点上都有 MS Office、Open Office、Star Office 或其他兼容的办公程序，那么电子表格非常适合这类事情。
2.  压缩这个（这些）文件并应用一个**好的**密码。
3.  将此 zip 文件附加到您保存在您最喜欢的基于 Web 的电子邮件信箱中的电子邮件中。为了便于查找，您可能需要创建一个单独的文件夹，或者只是为此目的创建一个单独的电子邮件帐户。

而已。假设您可以依靠一个可以访问您的 Web 邮件的 Web 浏览器、一个解压缩实用程序和一个文本文件阅读器（或者更好的是电子表格阅读器），那么您可以从任何地方安全地访问您的信息。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-23T02:12:12.860

我使用密码保险箱。您可以快速存储、组织和检索所有必需品。它还有一个方便的“生成随机密码”，我越来越多地使用它，特别是对于那些偶尔一次永远不值得记住密码的网站。

[http://passwordsafe.sourceforge.net/](http://passwordsafe.sourceforge.net/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-22T05:47:48.463

I use a certain string of characters in all my passwords, then for each new site I register on I append another string of characters which can be determined by looking at the site's name or URL. All I have to remember is the base password and the algorithm for determining the rest of the password.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-22T06:28:53.560

试试[Password Gorilla](http://www.fpx.de/fp/Software/Gorilla/)并使用[GetDropBox.com](http://GetDropBox.com)让它在机器之间保持同步。我认为它是由该网站的开发人员推荐的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-22T20:43:58.500

[我使用SplashId](http://www.splashdata.com/splashid/index.asp)将所有东西都放在我的 Treo 上。（也处理自定义字段）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-22T21:25:28.260

我将密码存储在加密分区上的文本文件中。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-23T00:56:46.883

像[克劳迪乌](https://stackoverflow.com/questions/310929/where-do-you-record-your-authentication-information-urlsipsusernamespasswords#310995)一样，我使用多层系统和我的记忆，我有很多我从记忆中知道的密码，并且取决于我使用的东西类型取决于我使用的密码。实际上，我的每个“层”类别都有两个或三个密码。有时我必须尝试其中的几个，如果它是一个我不经常使用的网站，直到我进入。虽然通常我很擅长记住我在哪些网站上使用了哪个。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-23T02:27:30.490

[Clipperz](http://www.clipperz.com/)看起来是一个很好的解决方案。它允许你存储几乎任何你想要的东西，并用你的密码加密你的所有数据。它还包括导出功能和离线只读版本。而且它是免费的！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-07-11T21:07:30.187

Keepassc ( [https://github.com/raymontag/keepassc](https://github.com/raymontag/keepassc) ) 在我的 Linux 机器上，数据库文件存储在 Dropbox 中，因此可以与我的 Android 手机 (KeepassDroid) 和 Windows 机器 (Keepass) 同步。效果很好！

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-22T07:14:53.423

对所有内容使用相同的密码。送给陌生人。

只是在开玩笑。我使用三层密码 - 最低的一层非常容易记住，适用于我不关心安全性的所有帐户。我只是将它用于大多数这样的事情。

对于其他内容，我不认为它是那么敏感的信息，所以我会将它们存储在一个大的“info.txt”文本文件中。我会在它旁边放一个密码提示，例如“坏密码”或“双 z”，例如，如果我有一个密码，我会经常使用其中包含两个 z 的密码。我只是使用标准`CTRL`+`F`搜索来查找信息。

# python - 在 Django 中清理表单数据

> ID：310931
> 
> 赞同：7
> 
> 时间：2008-11-22T05:44:09.597
> 
> 标签：python, django, forms, slug

如何在 django 中清理和修改表单中的数据。我想为每个模型在每个字段的基础上定义它，就像使用 ModelForms 一样。

我想要实现的是自动从定义的字段中删除前导和尾随空格，或者将标题（从一个字段）转换为 slug（这将是另一个字段）。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-22T06:42:22.363

您可以定义可以验证和更改数据的 clean_FIELD_NAME() 方法，如此处所述：http: [//docs.djangoproject.com/en/dev/ref/forms/validation/#ref-forms-validation](http://docs.djangoproject.com/en/dev/ref/forms/validation/#ref-forms-validation)

# sharepoint - 从 SPS 2003 升级到 MOSS 2007

> ID：310936
> 
> 赞同：0
> 
> 时间：2008-11-22T05:49:41.643
> 
> 标签：sharepoint, sharepoint-2007

如果在 SPS 2003 中对 search.aspx 进行了大量修改，升级到 MOSS 2007 时它们会丢失吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T10:06:35.493

令人惊讶的是，它们不会丢失。

> **搜索.aspx**
> 
> 在 Office SharePoint Server 2007 升级过程中不会更改或覆盖 Search.aspx 文件。您对此页面所做的自定义应在升级后继续有效。

[http://msdn.microsoft.com/en-us/library/ms564715.aspx](http://msdn.microsoft.com/en-us/library/ms564715.aspx)

# ios - How can I send mail from an iPhone application

> ID：310946
> 
> 赞同：243
> 
> 时间：2008-11-22T06:08:49.483
> 
> 标签：ios, iphone, email, cocoa-touch

I want to send an email from my iPhone application. I have heard that the iOS SDK doesn't have an email API. I don't want to use the following code because it will exit my application:

```
NSString *url = [NSString stringWithString: @"mailto:foo@example.com?cc=bar@example.com&subject=Greetings%20from%20Cupertino!&body=Wish%20you%20were%20here!"];
[[UIApplication sharedApplication] openURL: [NSURL URLWithString: url]]; 
```

So how can I send an email from my app?

* * *

## 回答 #1

> 赞同：429
> 
> 时间：2009-10-03T10:32:34.790

在 iOS 3.0 及更高版本上，您应该使用隐藏在 MessageUI 框架中的`MFMailComposeViewController`类和协议。`MFMailComposeViewControllerDelegate`

首先添加[框架](https://developer.apple.com/documentation/messageui)并导入：

```
#import <MessageUI/MFMailComposeViewController.h> 
```

然后，发送消息：

```
MFMailComposeViewController* controller = [[MFMailComposeViewController alloc] init];
controller.mailComposeDelegate = self;
[controller setSubject:@"My Subject"];
[controller setMessageBody:@"Hello there." isHTML:NO]; 
if (controller) [self presentModalViewController:controller animated:YES];
[controller release]; 
```

然后用户完成工作，您及时获得委托回调：

```
- (void)mailComposeController:(MFMailComposeViewController*)controller  
          didFinishWithResult:(MFMailComposeResult)result 
                        error:(NSError*)error;
{
  if (result == MFMailComposeResultSent) {
    NSLog(@"It's away!");
  }
  [self dismissModalViewControllerAnimated:YES];
} 
```

记得检查设备是否配置为发送电子邮件：

```
if ([MFMailComposeViewController canSendMail]) {
  // Show the composer
} else {
  // Handle the error
} 
```

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2009-08-11T02:57:42.940

[MFMailComposeViewController](http://developer.apple.com/iphone/library/documentation/MessageUI/Reference/MFMailComposeViewController_class/Reference/Reference.html)是 iPhone OS 3.0 软件发布之后的发展方向。您可以查看[示例代码](https://developer.apple.com/iphone/library/samplecode/MailComposer/index.html)或[我编写的教程](http://blog.mugunthkumar.com/coding/iphone-tutorial-in-app-email)。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-07-26T20:57:42.460

我想在这里补充几点：

1.  由于 mail.app 未安装在模拟器上，因此无法在模拟器中使用 mailto URL。它确实适用于设备。

2.  mailto URL 的长度有限制。如果 URL 大于 4096 个字符，mail.app 将不会启动。

3.  OS 3.0 中有一个新类，可让您在不离开应用程序的情况下发送电子邮件。请参阅 MFMailComposeViewController 类。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-12-23T09:46:35.517

如果您想从您的应用程序发送电子邮件，除非您在应用程序中编写自己的邮件客户端 (SMTP)，或者让服务器为您发送邮件，否则上述代码是唯一的方法。

例如，您可以编写应用程序以调用服务器上的 URL，该 URL 将为您发送邮件。然后，您只需从代码中调用 URL。

请注意，使用上面的代码，您无法将任何内容附加到电子邮件中，SMTP 客户端方法以及服务器端方法都允许您这样做。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2012-09-21T07:06:04.873

下面的代码在我的应用程序中用于发送带有附件的电子邮件，附件是图像。您可以发送任何类型的文件，唯一要记住的是您必须指定正确**的“mimeType”**

将此添加到您的 .h 文件中

```
#import <MessageUI/MFMailComposeViewController.h> 
```

将 **MessageUI.framework**添加到您的项目文件中

```
NSArray *paths = SSearchPathForDirectoriesInDomains(NSDocumentDirectory,NSUserDomainMask, YES);

NSString *documentsDirectory = [paths objectAtIndex:0];

NSString *getImagePath = [documentsDirectory stringByAppendingPathComponent:@"myGreenCard.png"];

MFMailComposeViewController* controller = [[MFMailComposeViewController alloc] init];
controller.mailComposeDelegate = self;
[controller setSubject:@"Green card application"];
[controller setMessageBody:@"Hi , <br/>  This is my new latest designed green card." isHTML:YES]; 
[controller addAttachmentData:[NSData dataWithContentsOfFile:getImagePath] mimeType:@"png" fileName:@"My Green Card"];
if (controller)
    [self presentModalViewController:controller animated:YES];
[controller release]; 
```

委托方式如下图

```
 -(void)mailComposeController:(MFMailComposeViewController*)controller didFinishWithResult:(MFMailComposeResult)result error:(NSError*)error;
{
    if (result == MFMailComposeResultSent) {
        NSLog(@"It's away!");
    }
    [self dismissModalViewControllerAnimated:YES];
} 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2013-09-09T11:22:53.060

这是可以帮助您但不要忘记包含消息 ui 框架并包含委托方法 MFMailComposeViewControllerDelegate 的代码

```
-(void)EmailButtonACtion{

        if ([MFMailComposeViewController canSendMail])
        {
            MFMailComposeViewController *controller = [[MFMailComposeViewController alloc] init];
            controller.mailComposeDelegate = self;
            [controller.navigationBar setBackgroundImage:[UIImage imageNamed:@"navigation_bg_iPhone.png"] forBarMetrics:UIBarMetricsDefault];
            controller.navigationBar.tintColor = [UIColor colorWithRed:51.0/255.0 green:51.0/255.0 blue:51.0/255.0 alpha:1.0];
            [controller setSubject:@""];
            [controller setMessageBody:@" " isHTML:YES];
            [controller setToRecipients:[NSArray arrayWithObjects:@"",nil]];
            UIPasteboard *pasteboard = [UIPasteboard generalPasteboard];
            UIImage *ui = resultimg.image;
            pasteboard.image = ui;
            NSData *imageData = [NSData dataWithData:UIImagePNGRepresentation(ui)];
            [controller addAttachmentData:imageData mimeType:@"image/png" fileName:@" "];
            [self presentViewController:controller animated:YES completion:NULL];
        }
        else{
            UIAlertView *alert=[[UIAlertView alloc] initWithTitle:@"alrt" message:nil delegate:self cancelButtonTitle:@"ok" otherButtonTitles: nil] ;
            [alert show];
        }

    }
    -(void)mailComposeController:(MFMailComposeViewController*)controller didFinishWithResult:(MFMailComposeResult)result error:(NSError*)error
    {

        [MailAlert show];
        switch (result)
        {
            case MFMailComposeResultCancelled:
                MailAlert.message = @"Email Cancelled";
                break;
            case MFMailComposeResultSaved:
                MailAlert.message = @"Email Saved";
                break;
            case MFMailComposeResultSent:
                MailAlert.message = @"Email Sent";
                break;
            case MFMailComposeResultFailed:
                MailAlert.message = @"Email Failed";
                break;
            default:
                MailAlert.message = @"Email Not Sent";
                break;
        }
        [self dismissViewControllerAnimated:YES completion:NULL];
        [MailAlert show];
    } 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2016-04-16T23:59:02.530

斯威夫特 2.2。改编自[Esq 的回答](https://stackoverflow.com/questions/310946/how-can-i-send-mail-from-an-iphone-application/32678731#32678731)

```
import Foundation
import MessageUI

class MailSender: NSObject, MFMailComposeViewControllerDelegate {

    let parentVC: UIViewController

    init(parentVC: UIViewController) {
        self.parentVC = parentVC
        super.init()
    }

    func send(title: String, messageBody: String, toRecipients: [String]) {
        if MFMailComposeViewController.canSendMail() {
            let mc: MFMailComposeViewController = MFMailComposeViewController()
            mc.mailComposeDelegate = self
            mc.setSubject(title)
            mc.setMessageBody(messageBody, isHTML: false)
            mc.setToRecipients(toRecipients)
            parentVC.presentViewController(mc, animated: true, completion: nil)
        } else {
            print("No email account found.")
        }
    }

    func mailComposeController(controller: MFMailComposeViewController,
        didFinishWithResult result: MFMailComposeResult, error: NSError?) {

            switch result.rawValue {
            case MFMailComposeResultCancelled.rawValue: print("Mail Cancelled")
            case MFMailComposeResultSaved.rawValue: print("Mail Saved")
            case MFMailComposeResultSent.rawValue: print("Mail Sent")
            case MFMailComposeResultFailed.rawValue: print("Mail Failed")
            default: break
            }

            parentVC.dismissViewControllerAnimated(false, completion: nil)
    }
} 
```

客户端代码：

```
var ms: MailSender?

@IBAction func onSendPressed(sender: AnyObject) {
    ms = MailSender(parentVC: self)
    let title = "Title"
    let messageBody = "https://stackoverflow.com/questions/310946/how-can-i-send-mail-from-an-iphone-application this question."
    let toRecipents = ["foo@bar.com"]
    ms?.send(title, messageBody: messageBody, toRecipents: toRecipents)
} 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2016-08-05T13:40:06.107

要从 iPhone 应用程序发送电子邮件，您需要执行以下任务列表。

第 1 步：**导入`#import <MessageUI/MessageUI.h>`**在您要发送电子邮件的控制器类中。

第 2 步：将委托添加到您的控制器，如下所示

```
 @interface <yourControllerName> : UIViewController <MFMessageComposeViewControllerDelegate, MFMailComposeViewControllerDelegate> 
```

第 3 步：添加以下发送电子邮件的方法。

```
 - (void) sendEmail {
 // Check if your app support the email.
 if ([MFMailComposeViewController canSendMail]) {
    // Create an object of mail composer.
    MFMailComposeViewController *mailComposer =      [[MFMailComposeViewController alloc] init];
    // Add delegate to your self.
    mailComposer.mailComposeDelegate = self;
    // Add recipients to mail if you do not want to add default recipient then remove below line.
    [mailComposer setToRecipients:@[<add here your recipient objects>]];
    // Write email subject.
    [mailComposer setSubject:@“&lt;Your Subject Here>”];
    // Set your email body and if body contains HTML then Pass “YES” in isHTML.
    [mailComposer setMessageBody:@“&lt;Your Message Body>” isHTML:NO];
    // Show your mail composer.
    [self presentViewController:mailComposer animated:YES completion:NULL];
 }
 else {
 // Here you can show toast to user about not support to sending email.
}
} 
```

第 4 步：实现 MFMailComposeViewController 委托

```
- (void)mailComposeController:(MFMailComposeViewController *)controller didFinishWithResult:(MFMailComposeResult)result error:(nullable NSError *)error {
[controller dismissViewControllerAnimated:TRUE completion:nil];

switch (result) {
   case MFMailComposeResultSaved: {
    // Add code on save mail to draft.
    break;
}
case MFMailComposeResultSent: {
    // Add code on sent a mail.
    break;
}
case MFMailComposeResultCancelled: {
    // Add code on cancel a mail.
    break;
}
case MFMailComposeResultFailed: {
    // Add code on failed to send a mail.
    break;
}
default:
    break;
}
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-09-22T14:12:46.970

斯威夫特 2.0

```
func mailComposeController(controller: MFMailComposeViewController, didFinishWithResult result: MFMailComposeResult, error: NSError?){
    if let error = error{
        print("Error: \(error)")
    }else{
        //NO Error
        //------------------------------------------------
        var feedbackMsg = ""

        switch result.rawValue {
        case MFMailComposeResultCancelled.rawValue:
            feedbackMsg = "Mail Cancelled"
        case MFMailComposeResultSaved.rawValue:
            feedbackMsg = "Mail Saved"
        case MFMailComposeResultSent.rawValue:
            feedbackMsg = "Mail Sent"
        case MFMailComposeResultFailed.rawValue:
            feedbackMsg = "Mail Failed"
        default:
            feedbackMsg = ""
        }

        print("Mail: \(feedbackMsg)")

        //------------------------------------------------
    }
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-09-20T11:14:09.443

这是一个 Swift 版本：

```
import MessageUI

class YourVC: UIViewController {
    override func viewDidLoad() {
        super.viewDidLoad()
        if MFMailComposeViewController.canSendMail() {
            var emailTitle = "Vea Software Feedback"
            var messageBody = "Vea Software! :) "
            var toRecipents = ["pj@veasoftware.com"]
            var mc:MFMailComposeViewController = MFMailComposeViewController()
            mc.mailComposeDelegate = self
            mc.setSubject(emailTitle)
            mc.setMessageBody(messageBody, isHTML: false)
            mc.setToRecipients(toRecipents)
            self.presentViewController(mc, animated: true, completion: nil)
        } else {
            println("No email account found")
        }
    }
}

extension YourVC: MFMailComposeViewControllerDelegate {
    func mailComposeController(controller: MFMailComposeViewController!, didFinishWithResult result: MFMailComposeResult, error: NSError!) {
        switch result.value {
        case MFMailComposeResultCancelled.value:
            println("Mail Cancelled")
        case MFMailComposeResultSaved.value:
            println("Mail Saved")
        case MFMailComposeResultSent.value:
            println("Mail Sent")
        case MFMailComposeResultFailed.value:
            println("Mail Failed")
        default:
            break
        }
        self.dismissViewControllerAnimated(false, completion: nil)
    }
} 
```

[资源](https://www.veasoftware.com/tutorials/2015/2/3/in-app-email-in-swift-xcode-6-ios-8-tutorial)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-03-24T20:42:06.133

我编写了一个名为 KRNSendEmail 的简单包装器，它简化了将电子邮件发送到一个方法调用的过程。

KRNSendEmail 有很好的文档记录并添加到 CocoaPods。

[https://github.com/ulian-onua/KRNSendEmail](https://github.com/ulian-onua/KRNSendEmail)

# linux - 适用于 linux 的 solaris filemerge 和 pstack 等效项

> ID：310947
> 
> 赞同：1
> 
> 时间：2008-11-22T06:08:50.967
> 
> 标签：linux, merge, solaris, filemerge

接受极端嘲笑的可能，我必须承认我真的很想念sun Teamware的文件合并工具。我已经从 solaris 切换到 red hat linux，发现自己经常丢失 filemerge（不要与同名的 Apple 工具混淆），以及 pstack 的 solaris 版本（与 pids 一样适用于核心文件）。

有没有专家有什么安慰的建议？合并祖先的更好的合并工具？查看核心文件的调用堆栈的单行方式？

请帮忙！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-23T11:13:47.730

gdb -ex bt program_file core_file 应该打印出核心文件的堆栈跟踪。

至于 filemrege，有一堆开源的东西：

tkdiff 融合 mgdiff kdiff3

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T10:22:21.680

融合很棒

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-05T23:55:50.733

我使用 kdiff3 而不是 filemerge。kdiff3 可以比 filemerge 更好地解决冲突。

用法：

```
kdiff3 x.A.cpp x.C.cpp x.P.cpp -o x.M.cpp 
```

在哪里：

```
x.A.cpp - ancestor version of x.cpp
x.C.cpp - child verion of x.cpp
x.P.cpp - parent version of x.cpp
x.M.cpp - merged file 
```

这些文件是在您运行 resolve 命令后生成的。

# asp.net - 无法解析远程名称

> ID：310950
> 
> 赞同：1
> 
> 时间：2008-11-22T06:19:13.253
> 
> 标签：asp.net, service

在访问[http://recpushdata.cyndigo.com/jobs.asmx](http://recpushdata.cyndigo.com/jobs.asmx)上可用的网络服务时，我收到了这个异常。“无法解析远程名称”

任何建议..做什么..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T08:17:40.673

您在上一条评论中得到的服务器错误是好的 - 这意味着您的原始问题，无法解析远程主机，已经解决。

至于您的 HTTP 500 错误，请检查远程主机上当时的事件日志。如果您无权访问它，请联系其管理员。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T06:31:16.067

尝试使用网址：

[http://216.10.246.91/jobs.asmx](http://216.10.246.91/jobs.asmx)

如果这可行，那么无论您从何处调用 Web 服务，DNS 都会出现问题。如果这不起作用，请返回报告。

# sql - Fowler 时间表达式的关系模式

> ID：310963
> 
> 赞同：16
> 
> 时间：2008-11-22T06:40:29.777
> 
> 标签：sql, orm, scheduling, recurrence

[Martin Fowler在这里](http://www.martinfowler.com/apsupp/recurring.pdf)定义了一个优雅的对象模型来调度重复任务，它很好地映射到 OO 代码。然而，将其映射到关系数据库模式以实现持久性是很棘手的。

任何人都可以建议一个模式 + SQL 组合来封装他描述的所有功能，特别是在第 11 页的图像中。相交和联合相当明显 - 复杂性在于表示“时间表达式”，它采用可变参数并且必须被解释不同，然后将它们组合成一个“时间集”。

需要明确的是，有很多方法可以表示关系数据库中重复事件的概念。我希望每个人的意见是如何映射这个特定的模型。

一些可能的选择：

*   定义参数数量和使用的“元”表。丑陋，但可能有效。但是，“时间表达”形式的数量可能有限，因此它提供的极端灵活性可能太多了。
*   Postgres（可能还有其他）RBMS 支持的某种形式的表继承。

序列化参数列表并将结果存储在 varchar() 中不是解决方案，因为该方法可以防止基于集合的查询:)

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-23T13:42:53.280

恐怕这个答案会有很多参考资料和很少的实用代码，自从我上次搞砸这个问题以来已经有一段时间了，但是......

我认为您要在这里混合使用的两种技术是['active databases'](http://en.wikipedia.org/wiki/Active_database)和['temporal databases'](http://en.wikipedia.org/wiki/Temporal_database)。

第一个对于评估规则等很有用，第二个对于存储时间数据并在某个记录有效时进行评估很有用。这两个都是相当大的研究领域，但是你可以用普通的 SQL 来做大部分的时间工作（只要你的数据库有很好的时间支持）。SQL 中的活动部分更难，但[PostgreSQL](http://www.postgresql.org/)至少有一些规则来帮助解决这个问题。我不了解其他数据库，但它们中的大多数都具有规则/触发器/约束支持，可以转换为您正在寻找的内容。

**活动数据库**是可以对使用规则存储的事实的变化做出反应的数据库。这些规则是用特定于实现的语言指定的，但对于日常讨论[事件-条件-动作规则](http://en.wikipedia.org/wiki/Event_Condition_Action)（ECA 规则）是常见的。有关活动数据库系统的介绍，请阅读文章[活动数据库管理系统宣言](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.48.7020&rep=rep1&type=pdf)和[活动数据库系统](http://cs.ulb.ac.be/public/_media/teaching/infoh415/p63-paton.pdf)。有关 ECA 规则的更多信息，请查看[逻辑事件和 ECA 规则](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.54.3287&rep=rep1&type=pdf)（页面顺序为 o_0）和[活动面向对象数据库系统中的事件](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.47.4152&rep=rep1&type=pdf)。

**事件处理**是规则处理的一个特例，处理如何处理复合事件并适当地触发它们的动作。关于这方面的一个有趣的读物是[Active Databases 的复合事件：复合事件检测器的语义、上下文和检测](http://www.vldb.org/conf/1994/P606.PDF)和[剖析](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.48.5246&rep=rep1&type=pdf)。另请参阅[复杂事件处理](http://complexevents.com/)站点和[事件流处理](http://en.wikipedia.org/wiki/Event_Stream_Processing)和[复杂事件处理](http://en.wikipedia.org/wiki/Complex_event_processing)维基百科文章。

**时态数据库**可以看作是一个可以理解时间的数据库，特别是两种特定的时间；有效时间和交易时间。记录的有效时间是该记录有效的时间段，记录的事务时间是它存在于数据库中的时间。作为一个很好的实用介绍，我推荐Richard T. Snodgrass撰写的关于如何在 SQL 中创建时态数据库*的书：* [Developing Time-Oriented Database Applications in SQL](http://www.cs.arizona.edu/people/rts/tdbbook.pdf)。

另外，您可能想了解的有关时态数据库的所有信息都可以在[Springer 数据库系统百科全书的时态数据库条目中](http://timecenter.cs.aau.dk/TimeCenterPublications/TR-90.pdf)阅读，这是一个非常全面的文档（我将从“时态数据库”条目开始），但要开始快一点，查看更易于浏览和阅读的[Temporal Database Glossary ，以及网站](http://www.cs.aau.dk/%7Ecsj/Glossary/index.html)[Time Center](http://timecenter.cs.aau.dk/index.htm)，其出版物部分具有（或确实具有...）该地区最著名的出版物的链接。

因此，既然您已经了解了这一切，您很快就会看到第 11 页上的图像可以表示为复合事件，并且可以这样检测/评估，前提是您已经实现了复合事件检测器的正确所需子集，并且rest 可以表示为具有时间方面的表中的条目:)

[Martin Fowler 在他的“随时间变化的事物的模式”中](http://martinfowler.com/eaaDev/timeNarrative.html)解决了大部分问题，总结了许多与时间打交道的模式。

最后，我可能会为时间信息创建一个数据库模式，并为活动部分使用数据库规则或在应用程序中实现该部分（尽管有龙）。如果您使用 PostgreSQL，规则机制在文档[的规则系统](http://www.postgresql.org/docs/8.3/interactive/rules.html)部分中进行了描述。

有很多要读的，但如果你彻底理解了这一切，你的职业净资产会上升很多:)

此外，谷歌的好词是“时间数据库”、“活动数据库”、“ECA 规则”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-22T08:06:01.650

SQL 是一种用于查询数据集的语言。它不容易支持域特定逻辑操作的编码。换句话说，“要评估的规则”不是 SQL 中的数据类型。这是一个面向对象的概念，数据和逻辑都是对象实例的组件。

所以我想说你*在 SQL 范式*中最多可以做的就是存储 365 行，对应于一年中的日子，以及相应日期是否满足循环计划标准的真/假值。因此，您必须使用实现 Fowler 模型的 OO 逻辑来进行计算，并存储生成的 365 行。

那么什么时候你需要知道“今天（或任何给定日期）是否是日程的一部分？” 查找适当的行并检查真/假列非常容易。对于任何数据库来说，每年存储 365 行都是微不足道的。

这看起来像是作弊，但就像我说的，SQL 是关于数据集，而不是逻辑。

# functional-programming - 嵌套函数：不当使用副作用？

> ID：310964
> 
> 赞同：7
> 
> 时间：2008-11-22T06:40:57.297
> 
> 标签：functional-programming, nested, side-effects

我正在学习函数式编程，并试图以函数式风格解决几个问题。在将问题分解为函数时，我经历过的一件事是，我似乎有两个选择：使用具有相似参数列表的几个不同的函数，或者使用嵌套函数，作为闭包，可以简单地引用父函数中的绑定。

虽然我最终选择了第二种方法，因为它使函数调用更小并且似乎“感觉”更好，但从我的阅读来看，我似乎可能错过了函数式编程的要点之一，因为这似乎是“一面-有效”？现在，这些嵌套函数不能修改外部绑定，因为我使用的语言阻止了这一点，但是如果你查看每个单独的内部函数，你不能说“给定相同的参数，这个函数将返回相同的结果”因为他们确实使用了父作用域中的变量......我是对的吗？

什么是理想的进行方式？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-22T06:48:29.793

函数式编程不是全有或全无。如果嵌套函数更有意义，我会采用这种方法。但是，如果您真的希望内部函数是纯函数式的，请将所有需要的参数显式传递给它们。

这是Scheme中的一个小例子：

```
(define (foo a)
  (define (bar b)
    (+ a b))      ; getting a from outer scope, not purely functional
  (bar 3))

(define (foo a)
  (define (bar a b)
    (+ a b))      ; getting a from function parameters, purely functional
  (bar a 3))

(define (bar a b) ; since this is purely functional, we can remove it from its
  (+ a b))        ; environment and it still works

(define (foo a)
  (bar a 3)) 
```

就个人而言，我会采用第一种方法，但任何一种方法都同样有效。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-22T07:25:06.117

嵌套函数是在许多函数中分工的绝佳方式。这并不是真正的“副作用”；如果有帮助，请将捕获的变量视为隐式参数。

嵌套函数有用的一个例子是替换循环。嵌套函数的参数可以充当累加值的归纳变量。一个简单的例子：

```
let factorial n =
    let rec facHelper p n =
        if n = 1 then p else facHelper (p*n) (n-1)
    in
    facHelper 1 n 
```

在这种情况下，声明一个像`facHelper`全局这样的函数是没有意义的，因为用户不必担心`p`参数。

但是请注意，单独测试嵌套函数可能很困难，因为它们不能在其父函数之外引用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T12:17:04.717

考虑以下（人为的）Haskell 片段：

```
putLines :: [String] -> IO ()
putLines lines = putStr string
    where string = concat lines 
```

`string`是一个局部绑定的命名常量。但它不也是一个不带参数的函数，它关闭`lines`并因此在引用上不透明吗？（在 Haskell 中，常量和空函数确实无法区分！）您会因此认为上面的代码“有副作用”还是没有功能？

# algorithm - 什么是尾调用优化？

> ID：310974
> 
> 赞同：966
> 
> 时间：2008-11-22T06:56:32.053
> 
> 标签：algorithm, recursion, language-agnostic, tail-recursion, tail-call-optimization

很简单，什么是尾调用优化？

更具体地说，有哪些小代码片段可以应用，哪些不可以，并解释原因？

* * *

## 回答 #1

> 赞同：859
> 
> 时间：2008-11-22T07:07:50.910

尾调用优化是您能够避免为函数分配新堆栈帧的地方，因为调用函数将简单地返回它从被调用函数获得的值。最常见的用途是尾递归，其中为利用尾调用优化而编写的递归函数可以使用常量堆栈空间。

Scheme 是少数在规范中保证任何实现都必须提供这种优化的编程语言之一，所以这里有两个 Scheme 中的阶乘函数示例：

```
(define (fact x)
  (if (= x 0) 1
      (* x (fact (- x 1)))))

(define (fact x)
  (define (fact-tail x accum)
    (if (= x 0) accum
        (fact-tail (- x 1) (* x accum))))
  (fact-tail x 1)) 
```

第一个函数不是尾递归的，因为当进行递归调用时，函数需要跟踪调用返回后它需要对结果进行的乘法运算。因此，堆栈如下所示：

```
(fact 3)
(* 3 (fact 2))
(* 3 (* 2 (fact 1)))
(* 3 (* 2 (* 1 (fact 0))))
(* 3 (* 2 (* 1 1)))
(* 3 (* 2 1))
(* 3 2)
6 
```

相比之下，尾递归阶乘的堆栈跟踪如下所示：

```
(fact 3)
(fact-tail 3 1)
(fact-tail 2 3)
(fact-tail 1 6)
(fact-tail 0 6)
6 
```

如您所见，我们只需要为每次调用 fact-tail 跟踪相同数量的数据，因为我们只是将获得的值返回到顶部。这意味着即使我要调用 (fact 1000000)，我也只需要与 (fact 3) 相同的空间。非尾递归事实并非如此，因此大值可能会导致堆栈溢出。

* * *

## 回答 #2

> 赞同：638
> 
> 时间：2012-03-22T00:04:08.367

让我们来看一个简单的例子：用 C 实现的阶乘函数。

我们从明显的递归定义开始

```
unsigned fac(unsigned n)
{
    if (n < 2) return 1;
    return n * fac(n - 1);
} 
```

如果函数返回之前的最后一个操作是另一个函数调用，则函数以尾调用结束。如果此调用调用相同的函数，则它是尾递归的。

尽管`fac()`乍一看看起来是尾递归的，但实际情况并非如此

```
unsigned fac(unsigned n)
{
    if (n < 2) return 1;
    unsigned acc = fac(n - 1);
    return n * acc;
} 
```

即最后一个操作是乘法而不是函数调用。

但是，可以`fac()`通过将累积值作为附加参数向下传递调用链并仅将最终结果作为返回值再次向上传递来重写为尾递归：

```
unsigned fac(unsigned n)
{
    return fac_tailrec(1, n);
}

unsigned fac_tailrec(unsigned acc, unsigned n)
{
    if (n < 2) return acc;
    return fac_tailrec(n * acc, n - 1);
} 
```

现在，为什么这很有用？因为我们在尾部调用后立即返回，所以我们可以在调用尾部位置的函数之前丢弃先前的堆栈帧，或者，在递归函数的情况下，按原样重用堆栈帧。

尾调用优化将我们的递归代码转换为

```
unsigned fac_tailrec(unsigned acc, unsigned n)
{
TOP:
    if (n < 2) return acc;
    acc = n * acc;
    n = n - 1;
    goto TOP;
} 
```

这可以内联到`fac()`我们到达

```
unsigned fac(unsigned n)
{
    unsigned acc = 1;

TOP:
    if (n < 2) return acc;
    acc = n * acc;
    n = n - 1;
    goto TOP;
} 
```

这相当于

```
unsigned fac(unsigned n)
{
    unsigned acc = 1;

    for (; n > 1; --n)
        acc *= n;

    return acc;
} 
```

正如我们在这里所看到的，一个足够先进的优化器可以用迭代代替尾递归，因为您避免了函数调用开销并且只使用恒定数量的堆栈空间，所以效率更高。

* * *

## 回答 #3

> 赞同：235
> 
> 时间：2008-11-22T07:12:47.467

TCO（尾调用优化）是智能编译器可以调用函数并且不占用额外堆栈空间的过程。发生这种情况的*唯一情况是函数**f**中执行的最后一条指令是对函数 g 的调用*（注意：**g**可以是**f**）。这里的关键是**f**不再需要堆栈空间 - 它只是调用**g**然后返回**g**将返回的任何内容。在这种情况下，可以进行优化，使 g 只运行并将它所具有的任何值返回给调用 f 的东西。

这种优化可以使递归调用占用恒定的堆栈空间，而不是爆炸。

示例：此阶乘函数不是 TCOptimizable：

```
from dis import dis

def fact(n):
    if n == 0:
        return 1
    return n * fact(n-1)

dis(fact)
  2           0 LOAD_FAST                0 (n)
              2 LOAD_CONST               1 (0)
              4 COMPARE_OP               2 (==)
              6 POP_JUMP_IF_FALSE       12

  3           8 LOAD_CONST               2 (1)
             10 RETURN_VALUE

  4     >>   12 LOAD_FAST                0 (n)
             14 LOAD_GLOBAL              0 (fact)
             16 LOAD_FAST                0 (n)
             18 LOAD_CONST               2 (1)
             20 BINARY_SUBTRACT
             22 CALL_FUNCTION            1
             24 BINARY_MULTIPLY
             26 RETURN_VALUE 
```

这个函数除了在它的 return 语句中调用另一个函数之外，还做一些事情。

下面这个函数是 TCOptimizable：

```
def fact_h(n, acc):
    if n == 0:
        return acc
    return fact_h(n-1, acc*n)

def fact(n):
    return fact_h(n, 1)

dis(fact)
  2           0 LOAD_GLOBAL              0 (fact_h)
              2 LOAD_FAST                0 (n)
              4 LOAD_CONST               1 (1)
              6 CALL_FUNCTION            2
              8 RETURN_VALUE 
```

这是因为在任何这些函数中发生的最后一件事就是调用另一个函数。

* * *

## 回答 #4

> 赞同：72
> 
> 时间：2012-08-26T01:27:05.630

对于尾调用、递归尾调用和尾调用优化，我发现的最好的高级描述可能是博客文章

[“到底是什么：尾声”](http://web.archive.org/web/20111030134120/http://www.sidhe.org/~dan/blog/archives/000211.html)

丹苏加尔斯基。关于尾调用优化，他写道：

> 考虑一下，这个简单的函数：
> 
> ```
> sub foo (int a) {
>   a += 15;
>   return bar(a);
> } 
> ```
> 
> 那么，你，或者更确切地说是你的语言编译器，能做什么呢？嗯，它可以做的就是把表单`return somefunc();`的代码变成低级序列`pop stack frame; goto somefunc();`。在我们的例子中，这意味着在我们调用`bar`,之前`foo`清理自己，然后，而不是`bar`作为子例程调用，我们`goto`对`bar`. `Foo`已经从堆栈中清除了自己，所以当`bar`开始时，它看起来就像被调用`foo`的人真的已经调用了`bar`，并且当`bar`返回它的值时，它直接将它返回给被调用的人`foo`，而不是返回它`foo`然后将它返回给它的调用者。

在尾递归上：

> 如果函数作为其最后一个操作**返回调用自身的结果**，则会发生尾递归。尾递归更容易处理，因为您不必跳转到某个随机函数的开头，只需执行 goto 回到您自己的开头，这是一件非常简单的事情。

这样：

> ```
> sub foo (int a, int b) {
>   if (b == 1) {
>     return a;
>   } else {
>     return foo(a*a + a, b - 1);
>   } 
> ```

悄悄地变成：

> ```
> sub foo (int a, int b) {
>   label:
>     if (b == 1) {
>       return a;
>     } else {
>       a = a*a + a;
>       b = b - 1;
>       goto label;
>    } 
> ```

我喜欢这个描述的地方在于，对于那些来自命令式语言背景（C、C++、Java）的人来说，它是多么简洁和容易掌握

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2019-03-18T21:39:18.560

**带有 x86 反汇编分析的 GCC C 最小可运行示例**

让我们通过查看生成的程序集来看看 GCC 如何为我们自动进行尾调用优化。

这将作为其他答案中提到的一个非常具体的例子，例如[https://stackoverflow.com/a/9814654/895245](https://stackoverflow.com/a/9814654/895245)，优化可以将递归函数调用转换为循环。

这反过来又节省了内存并提高了性能，因为[现在内存访问通常是使程序变慢的主要原因](https://stackoverflow.com/questions/868568/what-do-the-terms-cpu-bound-and-i-o-bound-mean/33510470#33510470)。

作为输入，我们给 GCC 一个未优化的基于栈的阶乘：

tail_call.c

```
#include <stdio.h>
#include <stdlib.h>

unsigned factorial(unsigned n) {
    if (n == 1) {
        return 1;
    }
    return n * factorial(n - 1);
}

int main(int argc, char **argv) {
    int input;
    if (argc > 1) {
        input = strtoul(argv[1], NULL, 0);
    } else {
        input = 5;
    }
    printf("%u\n", factorial(input));
    return EXIT_SUCCESS;
} 
```

[GitHub 上游](https://github.com/cirosantilli/x86-assembly-cheat/blob/26b8bf25299a1e84aeef8836287c24d75c3d84ab/compiler-generated/tail_call.c).

编译和反汇编：

```
gcc -O1 -foptimize-sibling-calls -ggdb3 -std=c99 -Wall -Wextra -Wpedantic \
  -o tail_call.out tail_call.c
objdump -d tail_call.out 
```

哪里`-foptimize-sibling-calls`是尾调用的泛化名称，根据`man gcc`：

```
 -foptimize-sibling-calls
       Optimize sibling and tail recursive calls.

       Enabled at levels -O2, -O3, -Os. 
```

如前所述：[如何检查 gcc 是否正在执行尾递归优化？](https://stackoverflow.com/questions/490324/how-do-i-check-if-gcc-is-performing-tail-recursion-optimization/490385#490385)

我选择`-O1`是因为：

*   优化没有完成`-O0`。我怀疑这是因为缺少所需的中间转换。
*   `-O3`生成效率不高的代码，虽然它也经过尾调用优化，但不会很有教育意义。

拆卸`-fno-optimize-sibling-calls`：

```
0000000000001145 <factorial>:
    1145:       89 f8                   mov    %edi,%eax
    1147:       83 ff 01                cmp    $0x1,%edi
    114a:       74 10                   je     115c <factorial+0x17>
    114c:       53                      push   %rbx
    114d:       89 fb                   mov    %edi,%ebx
    114f:       8d 7f ff                lea    -0x1(%rdi),%edi
    1152:       e8 ee ff ff ff          callq  1145 <factorial>
    1157:       0f af c3                imul   %ebx,%eax
    115a:       5b                      pop    %rbx
    115b:       c3                      retq
    115c:       c3                      retq 
```

与`-foptimize-sibling-calls`：

```
0000000000001145 <factorial>:
    1145:       b8 01 00 00 00          mov    $0x1,%eax
    114a:       83 ff 01                cmp    $0x1,%edi
    114d:       74 0e                   je     115d <factorial+0x18>
    114f:       8d 57 ff                lea    -0x1(%rdi),%edx
    1152:       0f af c7                imul   %edi,%eax
    1155:       89 d7                   mov    %edx,%edi
    1157:       83 fa 01                cmp    $0x1,%edx
    115a:       75 f3                   jne    114f <factorial+0xa>
    115c:       c3                      retq
    115d:       89 f8                   mov    %edi,%eax
    115f:       c3                      retq 
```

两者的主要区别在于：

*   `-fno-optimize-sibling-calls`uses ，这是典型的`callq`非优化函数调用。

    该指令将返回地址推入堆栈，从而增加它。

    此外，这个版本也有`push %rbx`，它会[推`%rbx`送到堆栈](https://stackoverflow.com/questions/4584089/what-is-the-function-of-the-push-pop-instructions-used-on-registers-in-x86-ass/33583134#33583134)中。

    GCC 这样做是因为它存储`edi`，这是第一个函数参数 ( `n`) 到`ebx`，然后调用`factorial`。

    GCC 需要这样做，因为它正在为另一个调用做准备`factorial`，它将使用新的`edi == n-1`.

    它之所以选择`ebx`是因为该寄存器是被调用者保存的：[哪些寄存器是通过 linux x86-64 函数调用保存的，](https://stackoverflow.com/questions/18024672/what-registers-are-preserved-through-a-linux-x86-64-function-call/55207335#55207335)因此子调用`factorial`不会更改它并丢失`n`。

*   `-foptimize-sibling-calls`不使用任何推入堆栈的指令：它只`goto`使用`factorial`指令`je`和`jne`.

    因此，这个版本相当于一个while循环，没有任何函数调用。堆栈使用是恒定的。

在 Ubuntu 18.10、GCC 8.2 中测试。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2008-11-22T07:09:41.467

首先请注意，并非所有语言都支持它。

TCO 适用于递归的特殊情况。它的要点是，如果您在函数中做的最后一件事是调用自身（例如，它从“尾部”位置调用自身），编译器可以对其进行优化，使其表现得像迭代而不是标准递归。

您会看到，通常在递归期间，运行时需要跟踪所有递归调用，以便在返回时可以在前一个调用处恢复，依此类推。（尝试手动写出递归调用的结果，以直观地了解其工作原理。）跟踪所有调用会占用空间，当函数大量调用自身时，这会变得很重要。但是对于 TCO，它只能说“回到开始，只是这次将参数值更改为这些新的值”。它可以这样做，因为递归调用之后没有任何内容引用这些值。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-11-22T07:05:02.850

看这里：

[http://tratt.net/laurie/tech_articles/articles/tail_call_optimization](http://tratt.net/laurie/tech_articles/articles/tail_call_optimization)

您可能知道，递归函数调用会对堆栈造成严重破坏。很容易快速耗尽堆栈空间。尾调用优化是您可以创建使用恒定堆栈空间的递归样式算法的方式，因此它不会增长和增长并且您会遇到堆栈错误。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2018-07-30T01:34:59.840

递归函数方法有问题。它建立了一个大小为 O(n) 的调用堆栈，这使得我们的总内存成本为 O(n)。这使得它容易受到堆栈溢出错误的影响，即调用堆栈变得太大并且空间不足。

尾调用优化 (TCO) 方案。它可以优化递归函数以避免建立高调用堆栈，从而节省内存成本。

有许多语言在做 TCO，比如（JavaScript、[Ruby](https://en.wikipedia.org/wiki/Ruby_%28programming_language%29)和少数 C），而 Python 和 Java 不做 TCO。

JavaScript 语言已确认使用:) [http://2ality.com/2015/06/tail-call-optimization.html](http://2ality.com/2015/06/tail-call-optimization.html)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-08-20T10:12:21.903

1.  我们应该确保函数本身没有 goto 语句。函数调用是被调用函数中的最后一件事。

2.  大规模递归可以使用它进行优化，但在小规模下，使函数调用尾调用的指令开销降低了实际目的。

3.  TCO 可能会导致函数永远运行：

    ```
    void eternity()
    {
        eternity();
    } 
    ```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-03-21T05:46:54.480

在函数式语言中，尾调用优化就像函数调用可以返回部分计算的表达式作为结果，然后由调用者计算。

```
f x = g x 
```

f 6 减少到 g 6。因此，如果实现可以返回 g 6 作为结果，然后调用该表达式，它将保存一个堆栈帧。

还

```
f x = if c x then g x else h x. 
```

减少到 f 6 到 g 6 或 h 6。因此，如果实现评估 c 6 并发现它是真的，那么它可以减少，

```
if true then g x else h x ---> g x

f x ---> h x 
```

一个简单的非尾调用优化解释器可能看起来像这样，

```
class simple_expresion
{
    ...
public:
    virtual ximple_value *DoEvaluate() const = 0;
};

class simple_value
{
    ...
};

class simple_function : public simple_expresion
{
    ...
private:
    simple_expresion *m_Function;
    simple_expresion *m_Parameter;

public:
    virtual simple_value *DoEvaluate() const
    {
        vector<simple_expresion *> parameterList;
        parameterList->push_back(m_Parameter);
        return m_Function->Call(parameterList);
    }
};

class simple_if : public simple_function
{
private:
    simple_expresion *m_Condition;
    simple_expresion *m_Positive;
    simple_expresion *m_Negative;

public:
    simple_value *DoEvaluate() const
    {
        if (m_Condition.DoEvaluate()->IsTrue())
        {
            return m_Positive.DoEvaluate();
        }
        else
        {
            return m_Negative.DoEvaluate();
        }
    }
} 
```

尾调用优化解释器可能如下所示，

```
class tco_expresion
{
    ...
public:
    virtual tco_expresion *DoEvaluate() const = 0;
    virtual bool IsValue()
    {
        return false;
    }
};

class tco_value
{
    ...
public:
    virtual bool IsValue()
    {
        return true;
    }
};

class tco_function : public tco_expresion
{
    ...
private:
    tco_expresion *m_Function;
    tco_expresion *m_Parameter;

public:
    virtual tco_expression *DoEvaluate() const
    {
        vector< tco_expression *> parameterList;
        tco_expression *function = const_cast<SNI_Function *>(this);
        while (!function->IsValue())
        {
            function = function->DoCall(parameterList);
        }
        return function;
    }

    tco_expresion *DoCall(vector<tco_expresion *> &p_ParameterList)
    {
        p_ParameterList.push_back(m_Parameter);
        return m_Function;
    }
};

class tco_if : public tco_function
{
private:
    tco_expresion *m_Condition;
    tco_expresion *m_Positive;
    tco_expresion *m_Negative;

    tco_expresion *DoEvaluate() const
    {
        if (m_Condition.DoEvaluate()->IsTrue())
        {
            return m_Positive;
        }
        else
        {
            return m_Negative;
        }
    }
} 
```

# optimization - 任何用于零件优化的宏或技术？

> ID：310981
> 
> 赞同：0
> 
> 时间：2008-11-22T07:07:52.047
> 
> 标签：optimization, gcc, compilation

我正在使用 g++ 编译器研究无锁结构。似乎使用 -o1 开关，g++ 会改变我的代码的执行顺序。如何禁止 g++ 对代码的某些部分进行优化，同时保持对其他部分的优化？我知道我可以将它拆分为两个文件并将它们链接起来，但它看起来很难看。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-22T08:01:56.523

您可以使用函数属性“__attribute__ ((optimize 0))”来设置单个函数的优化，或者使用“#pragma GCC optimize”来设置代码块。不过，我认为这些仅适用于 GCC 4.4 - 请查看您的 GCC 手册。如果它们不受支持，那么分离源是您唯一的选择。

不过，我还要说，如果您的代码在启用优化的情况下失败，那么您的代码很可能是错误的，尤其是当您尝试做一些从根本上非常困难的事情时。处理器可能会对您的代码执行重新排序（在顺序一致性的限制内），因此您使用 GCC 获得的任何重新排序都可能发生。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-22T19:03:59.730

如果你发现 gcc 改变了代码中的执行顺序，你应该考虑使用内存屏障。只是不要假设 volatile 变量会保护您免受该问题的影响。他们只会确保在单个线程中，行为是语言所保证的，并且将始终从其内存位置读取变量以解释对执行代码“不可见”的更改。（例如，信号处理程序对变量所做的更改）。

GCC 从 4.2 版开始支持 OpenMP。您可以使用它来创建带有特殊`#pragma`指令的内存屏障。

Herb Sutter 和 Andrei Alexandrescu 编写的 PDF 是关于锁定免费代码的一个很好的见解：[C++ 和双重检查锁定的风险](http://erdani.org/publications/DDJ_Jul_Aug_2004_revised.pdf)

# javascript - 从 Javascript/XPCOM 调用的批处理文件不显示命令提示符窗口

> ID：310996
> 
> 赞同：4
> 
> 时间：2008-11-22T07:16:21.907
> 
> 标签：javascript, batch-file, xpcom

我以这种方式从 Javascript 调用批处理文件：

```
function runBatch(){
    var exe = Components.classes['@mozilla.org/file/local;1'].createInstance(Components.interfaces.nsILocalFile);
    exe.initWithPath("C:\\test.bat");
    var run = Components.classes['@mozilla.org/process/util;1'].createInstance(Components.interfaces.nsIProcess);
    run.init(exe);
    var parameters = ["hi"];
    run.run(false, parameters,parameters.length);
} 
```

我的测试批处理文件是：

```
echo on
echo %1 
pause
exit 
```

但是，每次我调用批处理文件时，都不会显示命令提示符，就像我只是从桌面运行批处理文件一样。我该如何解决这个问题并显示批处理文件的命令提示符？

**编辑** 要清楚，启动 cmd.exe 进程 - 我可以在任务栏中看到它。但是没有显示任何窗口。此代码段的行为类似：

```
function runCmd(){  
var exe = Components.classes['@mozilla.org/file/local;1'].createInstance(Components.interfaces.nsILocalFile);
exe.initWithPath("C:\\WINDOWS\\system32\\cmd.exe");
var run = Components.classes['@mozilla.org/process/util;1'].createInstance(Components.interfaces.nsIProcess);
run.init(exe);
run.run(false, null,0);
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-23T02:10:52.583

到目前为止，我听到的唯一解决方案（应该可以，虽然我还没有这样做，但它来自 Mozilla xulrunner IRC 频道中的 Mook：

*创建*一个临时批处理文件，写入要调用的批处理文件和传递它的参数。然后执行临时批处理文件。

例如伪代码：

```
f = fopen("temp.bat"); 
fprintf(f, "other.bat 1 2 3 4 5"); 
fclose(f); 
exec("temp.bat"); 
```

不是很优雅，但它应该可以工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-23T00:15:10.850

您是否尝试过使用 nsiLocalFile 的启动方法？

```
function runBatch(){
    var exe = Components.classes['@mozilla.org/file/local;1'].createInstance(Components.interfaces.nsILocalFile);
    exe.initWithPath("C:\\test.bat");
    exe.launch();
} 
```

这应该具有“[与双击文件相同的效果](https://developer.mozilla.org/en/Code_snippets/Running_applications#Using_nsILocalFile.launch())”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-15T17:07:25.187

此代码段似乎工作正常。当然，您必须在您的操作系统中将 D:\Windows\system32\ 更改为 cmd.exe 的路径。

```
const FileFactory = new Components.Constructor("@mozilla.org/file/local;1","nsILocalFile","initWithPath");
var str_LocalProgram = "D:\\Windows\\system32\\cmd.exe";
var obj_Program = new FileFactory(str_LocalProgram); 
var process = Components.classes["@mozilla.org/process/util;1"].createInstance(Components.interfaces.nsIProcess);
process.init(obj_Program);
var args = ["/C", "regedit.exe"];
process.run(true, args, args.length); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-02-10T16:23:09.687

你做对了，但要修复这个：

```
function runBatch(){
    var exe = Components.classes['@mozilla.org/file/local;1'].createInstance(Components.interfaces.nsILocalFile);
    exe.initWithPath("***C:\&nbsp;\test.bat***");
    var run = Components.classes['@mozilla.org/process/util;1'].createInstance(Components.interfaces.nsIProcess);
    run.init(exe);
    var parameters = ["hi"];
    run.run(false, parameters,parameters.length);
} 
```

如果你这样做？？？

```
function runBatch(){
    var exe = Components.classes['@mozilla.org/file/local;1'].createInstance(Components.interfaces.nsILocalFile);
    exe.initWithPath("***C:\test.bat***");
    var run = Components.classes['@mozilla.org/process/util;1'].createInstance(Components.interfaces.nsIProcess);
    run.init(exe);
    var parameters = ["hi"];
    run.run(false, parameters,parameters.length);
} 
```

在初始化时将@echo 关闭？？？

谢谢

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-03-25T17:25:36.007

我必须启动一个批处理文件并传入一个参数。我是这样做的：

```
 let file = uri.QueryInterface(Components.interfaces.nsIFileURL).file;

    let run = Components.classes['@mozilla.org/process/util;1']
                        .createInstance(Components.interfaces.nsIProcess);

    let path = file.path;

    if(file.exists())
    {
        // quick security check
        if(file.isExecutable())
        {
            // show error message
            return;
        }

        let localfile = file.QueryInterface(Components.interfaces.nsILocalFile);

        if(localfile != null)
        {
            if (app == "app1")
            {
               localfile.initWithPath("C:\\app1.bat");            
            }
            else
            {
               localfile.initWithPath("C:\\app2.bat");
            }
            run.init(localfile);
            var parameters = [path];
            run.run(false, parameters, parameters.length);
        }
        else
        {
           // show error message
        }
    }
    else
    {
        // show error message
    } 
```

在我的 Window 批处理文件中，我做了：

```
@ECHO OFF
START "application.exe" %1 
```

使用 START，允许我启动应用程序并关闭命令行窗口

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2011-07-18T12:23:20.887

对于 Linux：

```
<script>

    function callLight2()
    {

        netscape.security.PrivilegeManager.enablePrivilege(
        'UniversalXPConnect'
    );
        var exe = Components.classes['@mozilla.org/file/local;1'].createInstance(Components.interfaces.nsILocalFile);
    // exe.initWithPath(C:\\Windows\\system32\\cmd.exe"");
        exe.initWithPath("/usr/bin/gnome-terminal");

        var run = Components.classes['@mozilla.org/process/util;1'].createInstance(Components.interfaces.nsIProcess);
        run.init(exe);        

        var parameters = ["-e", "/usr/bin/ip_connect_up.sh 2 2 3 4 5 6"];
    // var parameters = ["/C", "regedit.exe"];
    // var parameters = ["hi"];
        run.run(true, parameters,parameters.length);

    }

</script>

<a href="#" onClick ="callLight2()">start</a> 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-17T23:15:51.077

Pfft，非常丑陋的代码。一个更好的技巧是使用 Win.com 生成命令提示符的 16 位子系统。Win.com 会将控制台发送到正确的虚拟终端，向您显示输出。

```
var lPath = getWorkingDir.path + "\\..\\..\\WINDOWS\\system32\\win.com";
lFile.initWithPath(lPath);
var process = Components.classes["@mozilla.org/process/util;1"].createInstance(Components.interfaces.nsIProcess);
process.init(lFile);
 var args = ["cmd.exe"];
process.run(false, args, args.length); 
```

更好，并且有效:)********************