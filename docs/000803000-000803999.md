# StackOverflow 问答 000803000-000803999

# c# - 检索 asp:TextBox 的值

> ID：803003
> 
> 赞同：4
> 
> 时间：2009-04-29T15:49:11.907
> 
> 标签：c#, .net, javascript

我有一个禁用的文本框，我正在使用 JavaScript 在客户端编辑它的值。当我尝试在服务器端检索值时，它不会反映在客户端所做的更改。如果我将 TextBox 的 enabled 属性设置为 true，我可以检索该值，但用户可以将焦点放在并编辑 TextBox。

有没有一种理智的方法可以防止用户将注意力集中在 TextBox 上并对其进行编辑？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T15:51:40.217

使用文本框的 ReadOnly 属性。

**编辑**：根据 OP 的评论，这可能不会成功。

**编辑 2**：来自 DotNetSlackers：

> 那么这两个属性有什么区别，为什么两者都存在呢？这两个属性之间有两个区别，一个微不足道的区别和一个微妙而深刻的区别：
> 
> 1.  这两个属性发出不同的标记。当您将 Enabled 设置为 False 时，TextBox 将属性 disabled="disabled" 注入其呈现的 HTML。当您将 ReadOnly 属性设置为 True 时，将注入属性 readonly="readonly"。
> 2.  根据关于 HTML 表单的 W3C 规范，禁用的控件不是“成功的”，而只读控件可能是“成功的”。“成功的”控件是通过 POST 标头或查询字符串将名称/值对发送回浏览器的控件。因此，禁用的控件不会发送回 ASP.NET 页面，而只读控件可能会发送回，具体取决于用户代理。（在我的测试中，IE 6 和 FireFox 1.5 都发送只读的 TextBox 输入。）
> 
> ……
> 
> 如果您在 ASP.NET 版本 1.x 中遇到此问题，您可能已经找到了 TextBox 的 ReadOnly 属性并使用了该属性，而不是将 Enabled 设置为 False。您仍然可以禁用页面的 ViewState 并以编程方式设置只读 TextBox Web 控件的 Text 属性，因为 TextBox 值是通过只读控件的表单提交发回的。然而，在 ASP.NET 2.0 版中，事情发生了一些变化，正如 Rick Strahlin 所指出的，他的博客文章 ASP.NET 2.0 ReadOnly 行为在 EnableViewState 为 false 时发生了变化。在 2.0 中，TextBox 控件的ReadOnly 属性的行为略有改变。来自技术文档：

*发生回发时，将 ReadOnly 属性设置为 true 的 TextBox 控件的 Text 值发送到服务器，但服务器不处理只读文本框。这可以防止恶意用户更改只读文本值。Text 属性的值在回发之间保留在视图状态中，除非被服务器端代码修改。*

> 发生的情况是客户端通过表单值发送只读 TextBox 的值，但 ASP.NET 2.0 引擎不采用该值并将其分配给回发时 TextBox 的 Text 属性，以帮助防止恶意用户自己更改只读 TextBox 值。但这让我们回到了之前的问题——如果回发中没有指定该值（或者在这种情况下被忽略）并且 ViewState 被禁用，则该值将丢失。呃。
> 
> Rick 的解决方法是手动从请求标头中读取值（this .TextBox1.Text = Request[this.TextBox1.UniqueID];），这会带来安全风险并引入 2.0 解决的问题。最佳方法是重新查询数据库中的值（或者您最初获得只读文本框的编程设置值的任何地方）。
> 
> 这篇博文的寓意是，如果你有只读数据，你可以使用禁用或只读的表单域，你是否收到表单提交中表单域的值并不重要。没关系，因为您一开始就不应该信任/使用该数据！如果您有只读数据，请不要从最终用户可以修改的数据流中重新读取它！

[来源](http://dotnetslackers.com/ADO_NET/re-19131_ReadOnly_vs_Enabled_in_Version_1_x_and_Version_2_0_for_ViewState_Disabled_Forms.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-29T15:52:11.760

正如您所发现的，浏览器不会将值返回到禁用的输入控件中。解决此问题的最简单方法可能是挂钩表单提交，并在提交表单时重新启用输入；用户将没有机会编辑该值，它应该与请求的其余部分一起发布。

另一种方法可能是将隐藏元素注入表单；这可以由您的脚本维护，镜像显示的值，或者以与上述类似的方式在最后添加。

# java - 为什么选择 XSL 转换？

> ID：803007
> 
> 赞同：23
> 
> 时间：2009-04-29T15:49:28.507
> 
> 标签：java, xslt, template-engine

对于当前项目，必须决定是使用 XML 和 XSL 转换来生成 HTML 还是直接使用 HTML 模板。

我会对支持或反对 XSL 方法的论点感兴趣。我知道在您必须支持许多不同的布局的情况下，XSL 解决方案有很多优势，但是在您只需要支持一种目标布局的情况下，您为什么要选择它呢？

**编辑：**我们在这里谈论Java。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-08T06:05:20.970

XSLT 是一种函数式编程语言，您可以使用它来创建与任何模板系统一样丰富的前端。然而，你不应该——你和你的团队会发疯。

这两个选项都提供了以逻辑方式将对象转换为表示形式的机会。XSLT 最适合创建更多的 XML，这可能会让您相信它是用于创建 XHTML 的完美候选者。但是，创建 XHTML 不应该是主要目标——创建*用户体验*才是。不要担心*媒体*。

XSLT 的两个显着缺点与语法有关：您的模板和它们包含的模板，以及这些模板包含的模板都非常庞大和冗长。其次，您必须进行大量函数式编程，经验不足的工程师在遇到具有累积函数参数而不是简单的 for 循环的递归模板时可能会感到困惑和恐惧。

如果您被转换逻辑构造的有效 XML 实体的美所吸引，请考虑使用类型安全的模板系统来转换 bean。查看[Google XML Pages](http://code.google.com/p/gxp/)，并创建逻辑组织、类型安全的模板，以便未来的工程师轻松掌握和扩展。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-05-11T09:20:39.037

大约 5 年前，我为一个企业产品创建了一个 XML/XSLT 驱动的 UI。我们仍在使用它，现在我可以回顾我的经验，并看到许多优点和缺点：

优点：

*   XSL 是一种功能强大的声明性语言，对有经验的开发人员有用且有趣，并且转换可以在几行代码中完成非常惊人的事情
*   XSL 是为与 XML 一起使用而设计的，因此如果您的数据已经是 XML，那么它就很有意义
*   关注点分离（渲染与数据）优于许多模板语言
*   基于 XSL 的渲染可以很容易地被“子类化”。我的意思是：假设您有数据类 A 和关联的模板 A.xslt。对于从 A 派生的类 B，您可以轻松地创建只有微小差异的 B.xslt，并包含 A.xslt 以用于继承的行为。由于 A.xslt 中的更改，这使得它不太容易中断。
*   上述要点还使您能够进行覆盖。对于有关联A.xslt的类A，我们可以很方便的将关联模板切换到A-custom.xslt，这是一些小的改动加上A.xslt的继承。我们可以在现场即时执行此操作，其好处是 A-custom.xslt 只有几行，而不是原始 A.xslt 的完整修改副本。占用空间小意味着它更有可能与 A.xslt 的多个版本一起工作。
*   在 .NET 2.0 中，XSLT 被编译并且变得非常快。Java 可能有类似的技术。（大多数模板语言现在也这样做。）
*   在 .NET 中，可以创建“Object XPath Navigator”，它允许您转换数据对象，而无需将它们转换为 XML 对象。Java中可能也有类似的技术
*   XSLT 在 HTML 方面很聪明，可以很好地处理转义、空白问题等

缺点：

*   XSL 是一种功能强大的声明性语言，让新手程序员感到困惑——而且了解 XSLT 的人越来越少
*   XSL 很冗长。XML 通常也很冗长。
*   XSL 转换可能比“本机”模板慢。即使在编译时，XSL 的状态开销仍然比大多数模板语言多
*   将参数传递给 XSL 很困难，您必须将它们与数据一起发送（迫使您创建额外的 XML）或通过系统特定的方法（这也可能涉及构建 XML 数据）
*   如果您没有 ObjectXPathNavigator 或等效项，则在将数据对象转换为 XML 以进行转换时会产生大量开销
*   根据转换器的功能，当您转换为字符串缓冲区然后将该字符串发送到输出设备时，您还可能会产生缓冲开销
*   您的 XSLT 使用越高级，您的工具就越不可能支持您（特别是当您开始使用包含或更快的方法来传递 XML 数据时）

当我想到更多问题时，我会尝试更新。我认为现在回首往事，我的判断是坚持使用通用模板语言。当我选择 XML/XSLT 时曾经是个大问题，现在已经被主要模板引擎的更新和更成熟的修订版解决了。我们仍然从继承 .xslt 文件的能力中受益匪浅，这是大多数模板引擎做得不好的地方。但最终让大量开发人员提供示例的价值要大得多（例如，比较 ASP.NET 答案与 StackOverflow 上的 XSLT 答案。）

希望有帮助！

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-05-11T15:18:13.377

我使用 XSLT 进行了重要的开发，它在两个不同的站点都取得了巨大的成功和彻底的失败。

结论前的一些想法：

*   我认为没有人会争辩说 XSLT 比模板解析引擎强大得多，它是一种函数式语言。

*   尽管它不像大多数过程语言那样被广泛采用，但它仍然是一种用于实际项目的真正语言，已经可以雇用具有 XSLT 知识的人员，并且对于您当前的员工来说，它是一种可转移的技能。

*   XSLT 也已经存在了一段时间，其实现已经成熟，我相信长时间运行的模板引擎（如 Velocity）就是这种情况，但较新的引擎可能不太健壮。

*   无论您决定使用哪种模板语言，它都不太可能像 XSLT 那样有良好的文档记录。查看 Michael Kay Programmer 的任何参考系列，以获取有关如何编写出色参考书的示例。

*   工具支持通常非常好......如果你有预算的话。XMLSpy 和 Stylus Studio 过去对我都非常有用。

*   XSLT 不仅难，更重要的是，它与众不同。大多数人不是受过函数式编程正式培训的计算机科学专业的毕业生。大多数程序员将以过程式风格编写 XSLT，这种风格不会利用该语言的任何功能，并且会给您带来维护上的麻烦。

*   XSLT 转换可能很慢并且会占用大量内存。如果您有一个包含大量 XML 输入的样式表，您可能会遇到问题。

我喜欢 XSLT，但你是否应该使用它归结为几点：

您致力于 XSLT 吗？您在 XSLT 方面是否拥有严格的内部专业知识？你准备好拿一些了吗？

您的数据是 XML 格式的吗？它在 XML 中有意义吗？您是否有内部人员足够爱您的数据以确保其结构良好且始终存在适当的架构？

除非这些问题的答案是肯定的并且您拥有需要复杂渲染过程的复杂数据，否则我不会考虑使用 XSLT ......尤其是如果团队中没有经验。糟糕的 XSLT 比糟糕的模板糟糕得多。

但是，它可以以可维护的方式呈现复杂的数据，这在使用当今的许多模板引擎是不可能的。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-29T15:56:42.513

采用 XSL 方式将使您的应用程序面向未来。这意味着，如果您决定将来添加更多具有不同布局的模板，您将能够利用这些优势。在我当前的项目中，我们保存了使用的 XML（在 XMLType 或 CLOB 中）并允许其他应用程序访问数据和 XSL 模板以通过 Web 服务生成文档。由于我们决定使用 XML/XSL，这是对原始设计非常容易实现的事后的想法。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-05-02T08:52:56.627

请不要将 XML/XSLT 用于 Web 前端。我参与过这样的项目，这太可怕了。通常，您必须首先从对象或类似的东西中生成 XML，这是没有意义的。第二点是，那里有很多好的 HTML 编辑器是免费的，但我没有找到 XSLT 的。所以编辑复杂的 XSLT 并不好玩。我建议使用 HTML 模板和通用模板引擎。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-05-06T12:31:04.697

XSLT 的优势在于还可以生成其他文档类型（即 pdf）的输出，并且现在很可能会输出 pdf。XML/XSLT 也确实将数据与视图分开。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-05-08T12:31:31.363

过去我们做 XSLT 时，是为了让我们能够扩展我们的产品。输出保持不变，只需要更改表示层。当我们有客户想要“定制”他们的 UI 时，这给了我们很大的灵活性，因为我们需要做的就是替换 XSLT 文件。如果您预见需要进行大量此类更改，XSLT 可能是您的答案。

但是，如上所述，XSLT 语法和函数式编程思维可能会导致难以有效地生成模板。我们发现我们喜欢坚持我们学到的技巧，当我们的客户请求超出我们已经知道的范围时，没有人愿意自愿为票。通常有人最终想出了如何完成这项任务，我们的“技巧包”变得越来越大，但想出新事物往往非常麻烦。

如果您没有预见到 UI 永远不会改变，或者至少不会改变太多，那么 XSLT 可能不值得付出额外的努力。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-06T12:47:40.803

我看到如果您的数据已经是 XML，那么 XSL 方法会很方便。
但通常情况并非如此。它位于数据库中的某个位置，需要在现场生成或来自某些服务。
在我看来，从此源创建 XML 然后能够从该 X​​ML 创建 HTML 是没有用的。我会坚持使用 (X)Html 模板。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-06T15:18:55.307

根据您的应用程序，拥有一个然后通过 XSLT 转换为 XHTML 的 XML 层也意味着您可以将简单的 WebServices 编写到 XML 层 - 允许您的客户使用您的站点数据......

使用转换链接将 XML 发送到浏览器（忘记确切的语法......）也意味着需要更少的带宽，因为 XSLT 文件将保持不变，您只需要传递它构建的原始 XML - 有点就像使用外部 CSS 样式表而不是将样式属性添加到您的标记中；）

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-05-08T12:41:25.097

我认为您需要检查数据的来源。正如之前 boris callens 所提到的，如果您从数据库中提取，则必须先转换为 XML，然后再应用您的转换。如果数据源是 RSS 等，那么 XSLT 是一个自然的选择。

XPATH 和 XSLT 具有很高的学习曲线，而函数式编程可能会让您望而生畏。在时间紧迫的情况下，这可能不是正确的选择。

对于前端工作，JSON 具有更轻的负载，并且很容易被 jQuery 和其他 Javascript 库支持。您可能希望将 JSON 视为数据协议，因为 jQuery 库对开发人员来说更易于访问，并且使用该框架的生产力时间远远少于 XSLT、标签中嵌入的 Javascript、糟糕的语法和所有其他细节。前端的 XML/XPATH/XSLT。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-05-09T11:41:04.937

把事情简单化。这是一个人们越来越欣赏的原则。

Velocity 或 Freemarker 非常灵活且用途广泛。您的代码库将清晰、易于理解，并且运行速度将比 X 怪物快得多（很多）。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-05-13T07:27:51.460

[http://fishbowl.pastiche.org/2002/02/12/xslt_is_the_spawn_of_satan/](http://fishbowl.pastiche.org/2002/02/12/xslt_is_the_spawn_of_satan/)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-04-29T16:09:41.173

与 HTML 相比，如果您需要以任何方式解析和处理模板，有很多 XML 工具可用。因此，您应该选择 XML 以获得使用 XML 工具和库的好处。

然而，话虽如此，它可能只是 XHTML 适合您的需要，因为它为您提供了对 XML 工具和库的全面支持，同时仍然是现代 Web 浏览器正确处理的普通 HTML。如果您以后需要对这些进行后处理，您仍然可以将 XSLT 应用于 XHTML 数据。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-05-08T16:43:53.050

我在以前的项目、金融网站中使用过 XML 和 XSLT，它对我们很有效，但是：

1.  我们有多个客户，这改变了我们拥有的输出数量。我们可以替换 XSLT 样式表，这使得对网站的更改更易于开发人员管理
2.  我们的团队中有一名专业的网络编辑。我们给了他们示例 XML，他们可以直接编辑样式表
3.  如果昨天需要在网站上进行任何措辞更改（它是一家银行，这种情况经常发生得令人惊讶），我们可以直接部署新的 XSLT 而无需重新部署整个网站。
4.  需要多种不同的输出格式。我们使用[FOP](http://xmlgraphics.apache.org/fop/)转换为基于相同技术的 PDF，因此对我们来说并不难理解 :-)

我看到使用 XSLT 的主要原因是，如果您有多个站点都基于相同的 XML，但需要不同的 HTML 输出。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-05-11T10:26:49.193

XML + XSLT 真的很酷。您将来可以输出多种类型的目标格式。但不知道 XML 中嵌入的 HTML。Firefox XSLT 不支持“禁用输出转义”。请参阅[Bugzilla](https://bugzilla.mozilla.org/show_bug.cgi?id=98168)。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-05-08T12:35:38.090

我们使用 XSLT 在我们的内容管理系统中生成 html，它工作得很好。

一些提示：不要试图从一个大的毛茸茸的 XML 一次生成所有页面，你会发疯的。使用带有嵌入标记（如 <!--MENU-->、<!--CONTENT-->）的 HTML 模板（带有样式、装饰和基本标记的纯文本/html 文件），并用 xslt-transformation 替换标记的适当数据。

话虽如此，如果您永远只拥有一种布局，我怀疑您是否真的需要 xslt。

# php - 显示将用户带到网站的 Google 关键字

> ID：803009
> 
> 赞同：3
> 
> 时间：2009-04-29T15:49:37.867
> 
> 标签：php, javascript, search, seo

我希望显示如下内容：

您好，您已通过查找 [google 关键字] 访问此站点

我很确定我以前见过这样做，但我在弄清楚如何获取用于引导用户访问我的网站的关键字时遇到了麻烦。有人知道答案吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-29T15:50:25.883

您需要获取引用 URL，然后删除“q”查询字符串的所有内容。这将为您提供用于将您带到您的页面的查询。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T15:55:46.103

使用推荐人 ( [http://www.netmechanic.com/news/vol4/javascript_no14.htm](http://www.netmechanic.com/news/vol4/javascript_no14.htm) ) 您可以找到用户来自哪里。那么这只是正确解析它的问题。

* * *

我看到了这个脚本：

```
function getkeywords() {
    var x = document.referrer;
    var lastparturl = 0;
    if (x.search(/google/) != -1) {
        lastparturl = x.indexOf("&btnG=Google+Search"); 
        x = x.slice(38,lastparturl); 
        x = x.concat("via google");
    }
    else if (x.search(/yahoo/) != -1) {
        lastparturl = x.indexOf("&ei=UTF-8&iscqry=&fr=sfp"); 
        x = x.slice(63,lastparturl); 
        x = x.concat("via yahoo");
    }
    else if (x.search(/ask.com/) != -1) {
        lastparturl = x.indexOf("&search=search&qsrc=0&o=0&l=dir"); 
        x = x.slice(25,lastparturl); 
        x = x.concat("via ask");
    }
    else if (x.search(/dogpile/) != -1) {
        lastparturl = x.indexOf("/1/417/TopNavigation/Relevance/iq=true/zoom=off/_iceUrlFlag=7?_IceUrl=true"); 
        x = x.slice(46,lastparturl); 
        x = x.concat("via dogpile");
    }
    else if (x.search(/altavista/) != -1) {
        lastparturl = x.indexOf("&kgs=1&kls=0"); 
        x = x.slice(48,lastparturl); 
        x = x.concat("via altavista");
    }
    else { 
        x = "no keywords available";
    } 
    x = x.replace(/+/, " ");
    return x; 
} 
```

这里[http://www.webmonkey.com/codelibrary/Get_Referrer_Keywords](http://www.webmonkey.com/codelibrary/Get_Referrer_Keywords)

我不确定它是否完美运行，但是当我通过谷歌访问他们的网站时它运行良好。

我还看到您可以下载的一些脚本可以做到这一点，例如：[http ://webscripts.softpedia.com/script/Search-Engines/Keyword-Grabber-45299.html](http://webscripts.softpedia.com/script/Search-Engines/Keyword-Grabber-45299.html)

同样，这需要进行测试。

# sockets - 如何获得免费的套接字端口？C++

> ID：803012
> 
> 赞同：4
> 
> 时间：2009-04-29T15:50:13.527
> 
> 标签：sockets, udp, port

我正在编写一个 UDP 测试客户端/服务器，我想通过防火墙获取它。据说我需要做的就是让双方都发送到正确的 IP 和服务器。获取 IP 不是问题，但我如何让客户端随机选择一个空闲端口并将其报告给用户？我最终希望它连接到媒人服务器，但现在我需要一个简单的工作原型，我想计算端口号，以便我的朋友/测试人员可以通过 IM 向我发送 #，以便我们进行测试。

我如何获得端口号？对不起，很长的描述。我注意到人们告诉我当我不提供 desc 时不要做我要求的事情:(

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T16:38:36.673

用专业术语来说，这实际上是一个非常棘手的问题，甚至是一对令人讨厌的问题。根据防火墙的配置，当请求来自时，它通常会允许来自 IP 端点上的另一个端点的响应。所以...如果您的朋友使用`recvfrom()`系统调用之类的方式接收 UDP 数据报，则地址参数将接收 IP 端点信息以进行响应。因此，另一端应该能够`sendto()`使用相同的寻址信息进行响应。就像是：

```
/* initiator */
struct sockaddr_in hisaddr;
memset(&hisaddr, 0, sizeof(hisaddr));
hisaddr.sin_addr.s_addr = htonl(target_ip);
hisaddr.sin_port = htons(target_port);
sendto(sd, msg_ptr, msg_sz, 0, (struct sockaddr*)&hisaddr, sizeof(hisaddr));

/* receiver */
struct sockaddr_in peeraddr;
socklen_t peer_sz = sizeof(peeraddr);
recvfrom(sd, buf_ptr, buf_sz, 0, (struct sockaddr*)&peeraddr, &peer_sz);
/* build response */
sendto(sd, msg_ptr, msg_sz, 0, (struct sockaddr*)&peeraddr, peer_sz); 
```

另`peeraddr`一边将是您的*外部*地址，或者更准确地说，是您的防火墙的 IP 地址和它选择使用的端口号。您在代码中指定的端口号可能与您的朋友必须向其发送数据的端口完全不同。最终，您选择使用哪个端口可能并不重要，因为防火墙可能在完全不同的端口上发送和接收 - 这就是[网络地址转换](http://en.wikipedia.org/wiki/Network_address_translation)的全部内容。我建议阅读[RFC3235](https://www.rfc-editor.org/rfc/rfc3235)，了解如何克服这一障碍的一些技巧。

恕我直言，最好的方法是：

1.  让操作系统通过使用[`bind()`](http://opengroup.org/onlinepubs/007908799/xns/bind.html)零端口号调用或完全跳过绑定来选择端口
2.  让客户端从套接字层接收地址信息（例如， 的第五个和第六个参数[`recvfrom()`](http://opengroup.org/onlinepubs/007908799/xns/recvfrom.html)）
3.  客户端向上一步中检索到的端点发送响应
4.  调整防火墙配置，直到前面的步骤有效

当然，所有的魔法都在最后一步。如果您可以禁用 NAT 或确保防火墙永远不会切换端口，那么确定一个端口号并`bind`对其进行 -ing 也将起作用。您可能需要查看`%WINDIR%\system32\drivers\etc\services`（或`/etc/services`取决于您的操作系统倾向）以了解保留或通常使用的端口号。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-10T01:13:21.557

在发送数据之前绑定（）套接字。为 bind() 指定端口 0，操作系统将为您选择一个未使用的端口。然后，您可以使用 getsockname() 来找出 wsa 选择的端口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T16:04:20.263

一般来说——你——作为开发者——选择端口。您可以将您的应用程序设置为从配置文件或用户输入读取端口 - 但没有魔法防火墙会告诉您使用哪个端口......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T16:05:03.663

如果我正确理解了您的问题，我不确定是否有办法以编程方式执行您想要的操作（即使有，我认为这不是正确的方法）。我认为您需要找到服务器计算机上未使用的端口（如果通信是双向的，则可能是客户端计算机上的不同或相同端口）并且该端口必须能够通过您的防火墙. 我假设既然您说“获取 IP 不是问题”，您已经将防火墙配置为将部分或所有端口转发到防火墙内的特定计算机？如果是这样，您寻求的端口就是您转发的端口之一。只要该端口上没有运行其他服务，您就可以选择任意一个。低于 1024 的端口是保留的，因此您可能想要选择一个更高的数字。[nmap](http://insecure.org)以查看哪些服务在您的计算机上的哪些端口上运行并选择不同的。请注意，创建套接字时`nmap`可能会被防火墙和各种规则所欺骗。`bind`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T16:05:24.443

我认为你最好选择一个固定端口，而不是依赖操作系统选择的随机端口号。

如果您使用随机端口，则每次运行程序时都必须更改防火墙设置。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-29T16:06:19.573

如果您使用的是 WINSOCK，请检查此链接： http: [//msdn.microsoft.com/en-us/library/aa280717](http://msdn.microsoft.com/en-us/library/aa280717(VS.60).aspx) (VS.60).aspx 基本上您有 2 个选择，将端口设置为 0 并让系统为您分配一个或随机选择一个尝试打开套接字，如果它不起作用尝试另一个（一定要避开保留的端口）

# c# - C# /windows 窗体：使用因子链接轨迹栏和文本字段

> ID：803013
> 
> 赞同：5
> 
> 时间：2009-04-29T15:50:20.080
> 
> 标签：c#, winforms, textbox, trackbar

在 Windows 窗体中链接轨迹栏和文本字段非常容易。它是这样的： textBox.DataBindings.Add("Text", trackBar, "Value");

问题是，轨迹栏只允许整数值，但我想要浮点值。所以我通常只是将该值除以 100，因为在轨迹栏上，用户无法直接看到该值。但在文本框中它是。

那么是否可以将这两者与 100 的因子联系起来？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T21:26:11.940

您拥有的代码行将一个`Binding`对象添加到文本框的`DataBindings`集合中。

该类`Binding`具有称为`Format`and的事件`Parse`，您可以使用它来执行除法（该`Format`事件从轨迹栏中获取一个值并将其格式化为文本框）和乘法（该`Parse`事件从文本框中获取一个值并将其缩放为轨迹栏）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-17T14:50:21.820

您可以使用如下中间变量：

```
 public double v{set;get;}
    public int v100
    {
        set { v = value / 100D; }
        get { return (int)(v* 100D); }
    } 
```

并用控件使他们失明。

```
 trackBar.DataBindings.Add(new Binding("Value", PtParams, "v100"));
    textBox.DataBindings.Add(new Binding("Text", PtParams, "v")); 
```

# c# - 如何让 TAPI 使用 C# 在 Vista 中工作？

> ID：803015
> 
> 赞同：4
> 
> 时间：2009-04-29T15:50:26.833
> 
> 标签：c#, windows-vista, tapi

如何让 TAPI 在 Vista 上工作？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T20:52:45.563

如果你使用 C#，直接使用 TAPI 可能行不通。有关详细信息，请参阅此[知识库文章](http://support.microsoft.com/kb/841712)。基本上，Visual Studio 为 TAPI 3.x COM 接口创建的托管包装器不起作用。您可以使用非托管代码（C++、VB6）来处理 TAPI 3.x，或者您可以使用 TAPI OCX（又名 ActiveX）控件之一从 .Net 访问 TAPI。谷歌搜索“TAPI OCX”将为您提供一个充满免费和共享软件 TAPI 控件的页面，您可以查看这些控件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T16:00:10.633

[Sax CommStudio](http://www.commstudio.com/commstudio/modems)支持 TAPI。它不是免费的，但会节省大量时间。

还有一些示例项目漂浮在那里，包括[这个](http://www.codeproject.com/KB/IP/devangpro.aspx)。

# mysql - 具有 20,000,000 条记录的 MySQL 表在并发访问时会很快吗？

> ID：803018
> 
> 赞同：2
> 
> 时间：2009-04-29T15:51:19.920
> 
> 标签：mysql, database

我对一个包含 20,000,000 条记录的索引 MySQL 表进行了查找测试，根据我的结果，检索给定 id 的记录需要 0.004 秒——即使在加入另一个包含 4,000 条记录的表时也是如此。这是在一台 3GHz 双核机器上，只有一个用户（我）访问数据库。写入速度也很快，因为该表在十分钟内创建了所有 20,000,000 条记录。

假设我的测试是准确的，我是否可以期望生产服务器上的性能会像 200 个用户同时读取和写入该表？

我认为 InnoDB 会是最好的？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T15:53:37.653

这取决于您要使用的存储引擎以及读/写比率。

**如果有很多写入， InnoDB**会更好。如果它是偶尔写入的读取，**MyISAM**可能会更快。**MyISAM**使用**表级锁定**，因此它会在您需要更新时**锁定整个表。****InnoDB**使用**行级锁定**，因此您可以对不同的行进行**并发更新。**

**InnoDB**绝对更安全，所以无论如何我都会坚持下去。

顺便提一句。请记住，现在 RAM 非常便宜，所以要买很多。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T15:54:59.053

取决于许多因素：

*   服务器硬件（尤其是 RAM）
*   服务器配置
*   数据大小
*   索引数和索引大小
*   存储引擎
*   作家/读者比例

我不希望它能够很好地扩展。更重要的是，这种事情值得推测。对其进行基准测试并亲自查看。

关于存储引擎，除了 InnoDB 之外，我不敢使用任何东西来读取和写入那种大小的表。如果您运行任何不是原始插入或单行更新的写入查询，您最终将使用 MyISAM 锁定表，从而产生糟糕的性能。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T16:13:06.407

MySql 没有任何理由不能在没有任何重大问题的情况下处理这种负载。但是，还涉及许多其他变量（否则，这是一个“一段字符串有多长”的问题）。就个人而言，我在各种数据库中都有许多表，远远超出了这个范围。

*   每条记录有多大（平均）
*   数据库服务器有多少 RAM - 以及为 Mysql/InnoDB 的各种配置分配了多少。

默认配置可能只允许磁盘和客户端之间的默认 8MB 缓冲区（这对于单个用户可能工作正常） - 但试图通过它来适应 6GB+ 的数据库注定要失败。顺便说一句，这个问题确实存在 - 并且每天都会导致数据库/网站发生几次崩溃，直到我被带进来对其进行故障排除。

如果您可能对该数据库做更多的事情，我建议您找一个有更多经验的人，或者至少尽您所能对其进行一些优化。阅读“[高性能 MySQL，第 2 版](https://rads.stackoverflow.com/amzn/click/com/0596101716)”是一个好的开始，就像查看[Maatkit](http://www.maatkit.org/)等工具一样。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T15:53:52.473

只要您的架构设计和 DAL 构建得足够好，您就完全了解查询优化，可以在专业水平上调整所有服务器配置设置，并且正确配置“足够”的硬件，是的（除了足够的病态情况）。

两个引擎的答案相同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T16:06:38.637

您可能应该执行负载测试来验证，但只要正确创建索引（意味着索引已针对您的查询语句进行了优化），SELECT 查询应该以可接受的速度执行（INSERTS 和/或 UPDATES 可能更多速度问题取决于你有多少索引，以及索引有多大）。

# ruby - 使用 lambda 在单个实例上重新定义单个 ruby 方法

> ID：803020
> 
> 赞同：35
> 
> 时间：2009-04-29T15:51:40.700
> 
> 标签：ruby, oop

在 Ruby 中，有没有办法使用 proc 重新定义类的特定实例的方法？例如：

```
class Foo
  def bar()
    return "hello"
  end
end

x = Foo.new
y = Foo.new 
```

（就像是）：

```
y.method(:bar) = lambda { return "goodbye" }

x.bar
y.bar 
```

生产：

```
hello
goodbye 
```

谢谢。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-04-29T15:54:27.527

```
def define_singleton_method_by_proc(obj, name, block)
  metaclass = class << obj; self; end
  metaclass.send(:define_method, name, block)
end
p = proc { "foobar!" }
define_singleton_method_by_proc(y, :bar, p) 
```

或者，如果您想对对象进行猴子补丁以使其变得容易

```
class Object
  # note that this method is already defined in Ruby 1.9
  def define_singleton_method(name, callable = nil, &block)
    block ||= callable
    metaclass = class << self; self; end
    metaclass.send(:define_method, name, block)
  end
end

p = proc { "foobar!" }
y.define_singleton_method(:bar, p)
#or
y.define_singleton_method(:bar) do
   "foobar!"
end 
```

或者，如果您想定义您的 proc 内联，这可能更具可读性

```
class << y
  define_method(:bar, proc { "foobar!" })
end 
```

或者，

```
class << y
  define_method(:bar) { "foobar!" }
end 
```

这是最易读的，但可能不符合您的需求

```
def y.bar
  "goodbye"
end 
```

[这个问题高度相关](https://stackoverflow.com/questions/135995/is-it-possible-to-define-a-ruby-singleton-method-using-a-block)

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2013-05-19T05:39:42.167

我不确定这是在哪个版本的 Ruby 中添加的（至少 1.8.7），但似乎有一种更简单的方法：

```
str1 = "Hello"
str2 = "Goodbye"
def str1.to_spanish
  "Hola"
end
puts str1 # => Hello
puts str1.to_spanish # => Hola
puts str2 # => Goodbye
puts str2.to_spanish # => Throws a NoMethodError 
```

在阅读[Ruby Koans](http://rubykoans.com/)（about_class_methods.rb 课程）时了解了这一点。我仍然不完全确定这样做的目的是什么，因为这对我来说似乎有点危险。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-04-29T20:09:55.323

您可以使用语法`class <<object`来获取对象的“单例类”（这是仅属于该对象的特殊父类）并仅为该实例定义方法。例如：

```
str1 = "Hello"
str2 = "Foo"

class <<str1
  def to_spanish
    'Hola'
  end
end 
```

现在，如果您这样做`str1.to_spanish`，它将返回“Hola”，但`str2.to_spanish`会给您一个 NoMethodFound 异常。

# c# - 更改 EntityFramework 中的实体

> ID：803022
> 
> 赞同：3
> 
> 时间：2009-04-29T15:52:28.750
> 
> 标签：c#, .net, wpf, entity-framework

我有以下情况：

1.  实体是从数据库中加载的。
2.  其中一个以表单（WPF UserControl）的形式呈现给用户，用户可以在其中编辑该实体的属性。
3.  用户可以决定将更改应用到实体或取消编辑。

我将如何使用 EntityFramework 实现类似的东西？

我的问题是，当我将 UI 直接绑定到实体的属性时，每个更改都会立即应用于实体。我想将其延迟到用户按下“确定”并成功**验证**实体的那一刻。

我考虑过在分离的实体被验证后加载实体`NoTracking`并调用`ApplyPropertyChanges`，但我不完全确定正确的方法。MSDN 上 EntityFramework 的文档非常稀少。

我能想到的另一种方法是使用`Refresh`的实体`StoreWins`，但我不喜欢在 Cancel 处重置更改，而不是在 Ok 处应用更改。

有没有好的教程或示例？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-02T01:22:02.310

一种选择是您所说的进行无跟踪查询。

```
ctx.Customers.MergeOption = MergeOption.NoTracking;
var customer = ctx.Customers.First(c => c.ID == 232); 
```

然后客户可以`'customer'`根据需要在内存中进行修改，而上下文中实际上并没有发生任何事情。

现在，当您想要实际进行更改时，您可以这样做：

```
// get the value from the database
var original = ctx.Customers.First(c => c.ID == customer.ID);
// copy values from the changed entity onto the original.
ctx.ApplyPropertyChanges(customer); .
ctx.SaveChanges(); 
```

现在，如果您出于性能或并发原因对查询感到不舒服，您可以向 ObjectContext 添加一个新的扩展方法 AttachAsModified(...)。

看起来像这样：

```
public static void AttachAsModified<T>(
    this ObjectContext ctx, 
    string entitySet, 
    T entity)
{
    ctx.AttachTo(entitySet, entity);

    ObjectStateEntry entry = 
            ctx.ObjectStateManager.GetObjectStateEntry(entity);

    // get all the property names
    var propertyNames = 
            from s in entry.CurrentValues.DataRecordInfo.FieldMetadata
            select s.FieldType.Name;

    // mark every property as modified    
    foreach(var propertyName in propertyNames)
    {
        entry.SetModifiedProperty(propertyName);
    }
} 
```

现在您可以编写如下代码：

```
ctx.Customers.MergeOption = MergeOption.NoTracking;
var customer = ctx.Customers.First();
// make changes to the customer in the form
ctx.AttachAsModified("Customers", customer);
ctx.SaveChanges(); 
```

现在您没有并发或多余的查询。

现在唯一的问题是处理 FK 属性。您可能应该在这里查看我的帮助提示索引：http: [//blogs.msdn.com/alexj/archive/2009/03/26/index-of-tips.aspx](http://blogs.msdn.com/alexj/archive/2009/03/26/index-of-tips.aspx)

希望这可以帮助

亚历克斯

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T16:28:20.753

执行此操作的正常方法是绑定到实现[`IEditableObject`](http://msdn.microsoft.com/en-us/library/system.componentmodel.ieditableobject.aspx). 我不确定它是否以及如何适合实体框架。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T18:55:17.357

我也建议使用 IEditableObject，另外还建议使用 IDataErrorInfo。

我这样做的方式是，我基本上有一个实体的视图模型，该实体将实体作为构造函数参数（基本上是一个包装器对象）。

在 BeginEdit 中，我将实体属性复制到我的视图模型中，因此如果我执行 CancelEdit，则数据仅在 ViewModel 中更改，而原始实体没有更改。在 EndEdit 中，我只是再次将 ViewModel 属性应用于实体，或者当然只有在验证成功时。

对于验证，我使用 IDataErrorInfo 的方法。我只是实现 IDataErrorInfo.Error 以便它通过 IDataErrorInfo[string columnName] 检查每个属性名称并连接最终的错误消息。如果它是空的，则一切正常。（不确定是否要以这种方式使用错误，但我这样做了）

如果我有其他实体附加到我的原始实体，例如 Customer.Orders，我将它们创建为原始实体的 ViewModel 中的嵌套 ViewModel。原来的 ViewModel 在它自己的这些方法的实现中调用它的子模型的 Begin-、Cancel-、EndEdit / Error 方法。

这需要更多的工作，但我认为这是值得的，因为在 BeginEdit 和 EndEdit 之间，您可以确定没有任何变化而您不会注意到它。为启用 INotifyPropertyChanged 的​​属性提供代码片段也有很大帮助。

# asp.net - 在数据绑定事件期间分配数据源

> ID：803025
> 
> 赞同：2
> 
> 时间：2009-04-29T15:52:38.640
> 
> 标签：asp.net, data-binding, events

在处理其 DataBinding 事件时，我一直在分配 ASP.NET WebControl 的 DataSource。对于我页面中的一般数据绑定逻辑，它似乎在组织事物方面效果很好。

不这样做有什么论据？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T18:38:21.940

就在我的脑海中，我反对这样做有两个原因：

1) 设计有异味 2) 它掩盖了真正发生的事情

对于#1，我这样说是因为为了处理它的数据绑定事件，它必须已经开始绑定到某个东西。在中游改变它绑定的东西并不是我所说的理想设计。

这导致 #2，如果有人创建了您的一个控件，并在其上调用 .DataBind() ，并且它在内部开始绑定到其他东西，那么调用者完全不清楚发生了什么。

虽然我没有从技术角度看待它，但在我看来，您也会提高递归数据绑定无限循环的可能性。我想我真的需要看一些代码来判断你所做的是否可以接受，或者是否有更好的方法来做。

# c# - 查找将用户带到我的网站的引荐网址

> ID：803027
> 
> 赞同：0
> 
> 时间：2009-04-29T15:52:47.517
> 
> 标签：c#, asp.net

### 复制：

> [查找上一页网址](https://stackoverflow.com/questions/772780/finding-previous-page-url)

* * *

如何在 ASP.NET 中找到将用户带到我的站点的引荐 URL？

* * *

### 也可以看看：

> [如何找到哪些搜索词（如果有）将用户带到我的网站？](https://stackoverflow.com/questions/57004/how-can-i-find-what-search-terms-if-any-brought-a-user-to-my-site)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T15:56:02.517

```
Request.UrlReferrer 
```

但这不能保证是正确的，甚至不存在。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-29T10:28:34.473

Request.UrlReferrer 可用于检索当前页面已重定向的上一页 url。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T15:56:03.217

```
HttpContext.Current.Request.UrlReferrer 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T15:56:12.157

引用 URL 应位于请求的 HTTP 标头中。

例如`Uri MyUrl = Request.UrlReferrer`

请参阅：http: [//msdn.microsoft.com/en-us/library/system.web.httprequest.urlreferrer.aspx](http://msdn.microsoft.com/en-us/library/system.web.httprequest.urlreferrer.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T15:56:29.940

Request.UrlReferrer

[http://msdn.microsoft.com/en-us/library/system.web.httprequest.urlreferrer.aspx](http://msdn.microsoft.com/en-us/library/system.web.httprequest.urlreferrer.aspx)

# jquery - 无法在 drupal 中启用 jquery UI 模块？

> ID：803030
> 
> 赞同：1
> 
> 时间：2009-04-29T15:53:27.263
> 
> 标签：jquery, jquery-ui, drupal

我一直在尝试启用 jquery UI 模块，但一直无法做到。我意识到文档很糟糕，但即使从 [http://drupal.org/node/434424](http://drupal.org/node/434424)关注社区 似乎也不起作用。任何指针？？？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T16:11:37.813

我曾尝试先启用依赖项..这是错误..现在可以正常工作了:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-02-03T08:19:46.763

我遇到了同样的问题，但后来意识到除了提取站点/所有/模块文件夹中的文件外，还需要从谷歌代码站点提取 jquery.ui zip 文件并将文件夹提取到站点/所有/库并重命名它到 jquery.ui

更多在 readme.txt

# php - 良好的 PHP 文本分页

> ID：803036
> 
> 赞同：3
> 
> 时间：2009-04-29T15:54:25.640
> 
> 标签：php, javascript, ajax, content-management-system, pagination

我正在开发一个预防艾滋病毒的信息仓库网站。许多合作者将通过 tinyMCE GUI 发布文章。

当然，平面设计师想要控制页面长度。他们希望根据页面中内容的高度进行自动分页。

有人看过 AJAX 代码来管理这个吗？

除非有人看到可以进行字符计数和后视正则表达式以避免拆分单词或标签的 PHP 代码？

非常感谢任何链接！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T22:34:45.490

如果不需要精确，那么您没有理由不能使用简单的字数统计功能来确定打破页面的适当位置（我想在最近的段落）。你甚至可以根据帖子中是否有图片来减少每页的字数，甚至考虑到图片的大小。

不过，这可能会很快变得丑陋，我认为最好的方法是让他们手动设置页面分隔符，并在文章中使用您可以解析的标签。[pagebreak] 之类的东西非常简单，您将获得比任何自动化解决方案都更具逻辑性和可读性的分页符。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T16:00:46.543

您不仅需要担心字符数，还必须担心图像高度（如果页面中有图像或任何其他类型的嵌入对象会占用高度）。字符数也不会让您了解段落结构（具有更多字符的单个长段落比具有许多段落的页面可能更短）。

如果您愿意使用 JavaScript，那可能是理想的解决方案，请将整篇文章发布到客户端并让 JavaScript 处理分页。从客户端，您可以检测图像和对象的高度。您可以使用 PHP 来标记您认为页面应该在哪里，然后使用 JavaScript 来实现。除非页面很长，否则我认为您不需要执行多个 xmlHttpRequests (AJAX)。

对于一个直接的 PHP 解决方案也很简单，但可能并不理想，因为您不需要处理管理行数的问题。您可以使用 GET 变量来确定您在页面中的位置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T17:20:49.347

虽然这可能不是您正在寻找的确切答案，但您确实应该确保您的网站没有固定的高度。灵活的宽度非常好，但不如高度那么重要。

特别是对于这样的原因，以及内容繁重的网站；要求灵活的高度是公平的。

正如 apphacker 所提到的，您无法从 PHP 中真正检测到高度，并且您有点被 javascript 所困。如果您完全被分页所困扰，最好让您的内容作者决定何时断开页面，因此您可以在实际部分中断开它，而不是中间词、句子等。

编辑：可用性应该决定设计，而不是相反。你这样做是错的 ;）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-12-11T11:47:52.700

一个好的分页不是一项简单的任务。这不是简单的编码问题。Plass (1981) 的科学研究证明，最佳分页通常是 NP-hard。您应该担心浮动数字、换行符、不同的字体样式等。

HTML 引擎唯一可以帮助您的是将页面解析为 DOM 树。尺寸呢？是的，你可以有字体宽度和字体高度、边距和填充、图片大小。但仅此而已。所有的布局都在你的肩上。并用javascript做......嗯......

因此，自动固定高度分页的唯一可行解决方案是服务器端。PrinceXML 是目前最好的 HTML2PDF 转换器。但它的成本很高。

如果你擅长不同的页面高度，你可以使用 epalla 的建议。但这也不像看起来那么简单。

分页的一些参考：

*   [最佳分页技术，Plass，1981](http://docs.google.com/viewer?url=https://www.tug.org/docs/plass/plass-thesis.pdf)
*   [论复杂文件的分页，1998](http://docs.google.com/viewer?url=http://www.pi6.fernuni-hagen.de/publ/tr234.pdf)
*   [重新考虑分页](http://www.pi6.fernuni-hagen.de/publ/tr205.pdf)
*   [Knuth 的数字印刷术](https://rads.stackoverflow.com/amzn/click/com/1575860104)

# c# - 简单计算，c#和delphi结果不同

> ID：803042
> 
> 赞同：8
> 
> 时间：2009-04-29T15:55:43.170
> 
> 标签：c#, delphi

问题是，为什么这些代码片段会给出不同的结果？

```
private void InitializeOther()
{
  double d1, d2, d3;
  int i1;

  d1 = 4.271343859532459e+18;
  d2 = 4621333065.0;
  i1 = 5;

  d3 = (i1 * d1) - Utils.Sqr(d2);
  MessageBox.Show(d3.ToString());
} 
```

和

```
procedure TForm1.InitializeOther;
var d1, d2, d3 : Double;
    i1 : Integer;
begin
    d1:=4.271343859532459e+18;
    d2:=4621333065.0;
    i1:=5;

    d3:=i1*d1-Sqr(d2);
    ShowMessage(FloatToStr(d3));
end; 
```

Delphi代码给我816，而c#代码给我0。使用计算器，我得到775。谁能给我一个详细的解释？

非常感谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-29T16:18:43.850

Delphi 将中间值存储为 Extended（一种 80 位浮点类型）。这个表达式是扩展的：

```
i1*d1-Sqr(d2); 
```

C# 可能并非如此（我不知道）。额外的精度可能会有所作为。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-29T16:03:44.883

请注意，您在此处处于 Double 数据类型的精度限制，这意味着此处的计算将不准确。

例子：

```
d1 = 4.271343859532459e+18 
```

可以说是一样的：

```
d1 = 4271343859532459000 
```

所以：

```
d1 * i1 = 21356719297662295000 
```

实际上，.NET 中的值会更像这样：

```
2.1356719297662296E+19 
```

注意那里的四舍五入。因此，在这个级别上，您没有得到正确的答案。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-29T16:00:07.403

这当然不是对这种确切情况的解释，但它有助于解释问题。

[每个计算机科学家都应该知道的关于浮点运算的知识](http://docs.sun.com/source/806-3568/ncg_goldberg.html)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-29T16:17:00.297

AC# double 最多有 16 位精度。取 4.271343859532459e+18 并乘以 5 将得到 19 位数。结果，您希望得到一个只有 3 位数字的数字。Double 无法做到这一点。

在 C# 中，Decimal 类型可以处理此示例——如果您知道使用 123M 格式来初始化 Decimal 值。

```
 Decimal d1, d2, d3; 
    int i1; 
    d1 = 4.271343859532459e+18M;
    d2 = 4621333065.0M;
    i1 = 5; 
    d3 = (i1 * d1) - (d2*d2); 

    MessageBox.Show(d3.ToString()); 
```

这给出了正确答案 775.00。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-29T16:04:46.143

像这样的任何计算都会导致典型的浮点运算发生戏剧性的变化。数字缩放的差异越大，出现准确性问题的可能性就越大。

[http://en.wikipedia.org/wiki/Floating_point#Accuracy_problems](http://en.wikipedia.org/wiki/Floating_point#Accuracy_problems)给出了很好的概述。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-29T16:04:29.313

我认为这是由有限的精度引起的错误（最重要的是，因为使用双精度而不是整数）。也许 d1 在分配后不一样了。d2*d2 肯定会不同于正确的值，因为它大于 2^32。

由于 5*d1 甚至大于 2^64，因此即使使用 64 位整数也无济于事。您必须使用 bignums 或 128 位整数类来获得正确的结果。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-29T16:46:55.217

基本上，正如其他人所指出的那样，双精度对于您尝试进行的计算规模来说不够精确。Delphi 默认使用“扩展精度”，它在 Double 上增加了另外 16 位以允许更精确的计算。.NET 框架没有扩展精度数据类型。

不确定您的计算器使用的是什么类型，但显然它所做的事情与 Delphi 和 C# 不同。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-29T17:08:36.757

正如其他人所评论的那样，双精度对于您的计算来说不够精确。小数是一个很好的选择，尽管有人指出它会被四舍五入，但事实并非如此。

> 在 C# 中，Decimal 类型也无法轻松处理此示例，因为 4.271343859532459e+18 将四舍五入为 4271343859532460000。

不是这种情况。如果您使用小数，答案将是正确的。但正如他所说，范围不同。

# f# - 如何在 F# 中进行卷积？

> ID：803055
> 
> 赞同：4
> 
> 时间：2009-04-29T15:57:07.303
> 
> 标签：f#, signal-processing, convolution

我想将离散信号与离散滤波器进行[卷积。](http://en.wikipedia.org/wiki/Convolution)信号和滤波器是 F# 中的浮点序列。

我能弄清楚如何做到这一点的唯一方法是使用两个嵌套的 for 循环和一个可变数组来存储结果，但感觉不是很实用。

以下是我将如何做到这一点：

```
conv = double[len(signal) + len(filter) - 1]
for i = 1 to len(signal)
  for j = 1 to len(filter)
    conv[i + j] = conv[i + j] + signal(i) * filter(len(filter) - j) 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-30T14:32:39.697

我不知道 F#，但我会发布一些 Haskell，希望它足够接近使用。（我只有 VS 2005 和一个古老版本的 F#，所以我认为在我的机器上发布一些可以工作的东西会更加混乱）

让我首先发布你的伪代码的 Python 实现，以确保我得到正确的答案：

```
def convolve(signal, filter):
    conv = [0 for _ in range(len(signal) + len(filter) - 1)]
    for i in range(len(signal)):
        for j in range(len(filter)):
            conv[i + j] += signal[i] * filter[-j-1]
    return conv 
```

现在`convolve([1,1,1], [1,2,3])`给`[3, 5, 6, 3, 1]`. 如果这是错误的，请告诉我。

我们可以做的第一件事就是把内循环变成一个 zipWith；在上面的示例中，我们本质上是以一种特殊的方式添加了一系列行：`[[3,2,1], [3,2,1], [3,2,1]]`. 为了生成每一行，我们将使用反向过滤器压缩每一`i`行`signal`：

```
makeRow filter i = zipWith (*) (repeat i) (reverse filter) 
```

（注意：根据快速谷歌，`zipWith`在`map2`F# 中。您可能必须使用列表推导而不是`repeat`）现在：

```
makeRow [1,2,3] 1
=> [3,2,1]
makeRow [1,2,3] 2
=> [6,4,2] 
```

为了得到这个`i`，我们需要映射信号：

```
map (makeRow filter) signal
=> [[3,2,1], [3,2,1], [3,2,1]] 
```

好的。现在我们只需要一种正确组合行的方法。我们可以通过注意到组合将新行添加到现有数组中来做到这一点，除了第一个元素，它卡在前面。例如：

```
[[3,2,1], [6,4,2]] = 3 : [2 + 6, 1 + 4] ++ [2]
// or in F#
[[3; 2; 1]; [6; 4; 2]] = 3 :: [2 + 6; 1 + 4] @ [2] 
```

所以我们只需要编写一些在一般情况下执行此操作的代码：

```
combine (front:combinable) rest =
    let (combinable',previous) = splitAt (length combinable) rest in
    front : zipWith (+) combinable combinable' ++ previous 
```

现在我们有了一种生成所有行的方法以及一种将新行与现有数组组合的方法，我们所要做的就是将两者结合在一起并折叠：

```
convolve signal filter = foldr1 combine (map (makeRow filter) signal)

convolve [1,1,1] [1,2,3]
=> [3,5,6,3,1] 
```

所以这是一个功能版本。我认为这是相当清楚的，只要你理解`foldr`和`zipWith`. 但它至少与命令式版本一样长，就像其他评论者所说的那样，在 F# 中可能效率较低。这是一个地方的全部内容。

```
makeRow filter i = zipWith (*) (repeat i) (reverse filter)
combine (front:combinable) rest =
    front : zipWith (+) combinable combinable' ++ previous
    where (combinable',previous) = splitAt (length combinable) rest
convolve signal filter = foldr1 combine (map (makeRow filter) signal) 
```

编辑：

正如所承诺的，这是一个 F# 版本。这是在 VS2005 上使用非常古老的版本（1.9.2.9）编写的，所以要小心。我在标准库中也找不到`splitAt`，但是我不太了解 F#。

```
open List
let gen value = map (fun _ -> value)
let splitAt n l = 
  let rec splitter n l acc =
    match n,l with
    | 0,_ -> rev acc,l
    | _,[] -> rev acc,[]
    | n,x::xs -> splitter (n - 1) xs (x :: acc)
  splitter n l [] 
let makeRow filter i = map2 ( * ) (gen i filter) (rev filter)
let combine (front::combinable) rest =
  let combinable',previous = splitAt (length combinable) rest
  front :: map2 (+) combinable combinable' @ previous
let convolve signal filter = 
  fold1_right combine (map (makeRow filter) signal) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T19:41:41.600

试试这个功能：

```
let convolute signal filter =
    [|0 .. Array.length signal + Array.length filter - 1|] |> Array.map (fun i ->
        [|0 .. i|] |> Array.sum_by (fun j -> signal.[i] * filter.[Array.length filter - (i - j) - 1])) 
```

它可能不是最好的功能解决方案，但它应该可以完成这项工作。但是，我怀疑是否存在一种纯粹的功能解决方案，可以与速度的必要解决方案相匹配。

希望有帮助。

注意：该功能目前未经测试（尽管我已经确认它可以编译）。让我知道它是否没有完全做它应该做的事情。另外，请注意`i`和`j`变量与您的原始帖子所指的内容不同。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T16:12:18.607

实际上，您通常希望避免循环（普通、嵌套等）和函数式编程中任何可变的东西。

F#（可能几乎所有其他函数式语言）中恰好有一个非常简单的解决方案：

```
let convolution = Seq.zip seq1 seq2 
```

该`zip`函数只是将两个序列组合成一对，其中包含元素 from`seq1`和元素 from `seq2`。`List`需要注意的是， and模块也存在类似的 zip 函数`Array`，以及将三个列表组合成三元组 ( `zip3`) 的变体。如果您希望将 tom ore 通常将 n 个列表压缩（或“卷积”）到一个 n 元组列表中，那么您需要编写自己的函数，但这非常简单。

（顺便说一下，我一直在按照卷积的[描述](http://en.wikipedia.org/wiki/Convolution_(computer_science))进行说明——告诉我你是否还有别的意思。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-29T17:16:29.170

原则上，应该可以使用（快速）傅里叶变换或相关的（离散）余弦变换来合理有效地计算两个函数的卷积。您计算这两个函数的 FFT，将它们相乘，然后对结果应用逆 FFT。

[数学背景](http://www.cs.cf.ac.uk/Dave/Vision_lecture/node19.html)

这就是理论。在实践中，您可能最好找到一个为您实现它的数学库。

# c# - 将值数组传递到对象数组时遇到问题

> ID：803059
> 
> 赞同：0
> 
> 时间：2009-04-29T15:58:45.393
> 
> 标签：c#, winforms, arrays, oop

我正在尝试将一组值传递到一个表对象的数组中，以便我可以将它们写入数据库。

我的数据库看起来像这样 ->
**tblCaseNotes**
CaseNoteID | 个人身份 | 等等等等

**tblCaseNotesContactType**
rowguid | 案例备注ID | 联系人类型ID

**tblMaintItems**
itemID | 类别ID

Maint 表中的 itemID 是与当前 CaseNoteID 一起写入 tblCaseNotesContactType 的内容。每个 CaseNote 可以有多个 ContactType。

到目前为止，我所拥有的是在我的 btnNew_Click 事件中创建的 CheckListBox ContactType 的值数组：

```
// Contact Type check list box
int cTypeCount = chkContactType.CheckedItems.Count;
int [] contactTypes = new int[cTypeCount];

// reusable generic counter for looping thru the check lists
int cMaintCounter = 0;

foreach (int checkedItem in chkContactType.CheckedIndices)
{
    contactTypes[cMaintCounter] = (int)chkContactType.GetItemValue(checkedItem);
    cMaintCounter++;
}
CurrentCaseNote.AddCNote(Program._CurrentPerson.PersonID, Convert.ToDecimal(tbxTimeSpentUnits.Text), chkIsCaseLog.Checked, Convert.ToDateTime(datContactDate.Text), memContactDetails.Text, contactTypes); 
```

然后我将其传递给我的 CurrentCaseNote 对象 AddCNote 方法。

```
public static void AddCNote(int personID, decimal tsUnits, bool isCaseLog, DateTime cDate, string cDetails, int[] cTypes)
{
    var caseNoteToAdd = new tblCaseNote
                            {
                                CaseNoteID = Guid.NewGuid(),
                                PersonID = personID,
                                TimeSpentUnits =tsUnits,
                                IsCaseLog =isCaseLog,
                                ContactDate =cDate,
                                ContactDetails =cDetails,
                                InsertDate = DateTime.Now,
                                InsertUser = Environment.UserName
                            };

    tblCaseNotesContactType[] cTypeToAdd = new tblCaseNotesContactType[cTypes.Length];
    cTypeToAdd[0].CaseNoteID = caseNoteToAdd.CaseNoteID;
    cTypeToAdd[0].ContactTypeID =cTypes[0];
    cTypeToAdd[0].rowguid = Guid.NewGuid();

    CaseNoteDAL.addCNote(caseNoteToAdd,cTypeToAdd); 
```

然后将其传递给 DAL 以写入本地数据库：

```
public static void addCNote(tblCaseNote caseNote, tblCaseNotesContactType[] cType)
{
    foreach (var type in cType)
    {
        caseNote.tblCaseNotesContactTypes.Add(type);               
    }
    dcCaseNotes.tblCaseNotes.InsertOnSubmit(caseNote);

    //dcCaseNotes.tblCaseNotes.InsertOnSubmit(caseNoteToAdd);
    dcCaseNotes.SubmitChanges();
} 
```

它给了我一个***NUllReferenceException is*** unhandled error on this line -->`cTypeToAdd[0].CaseNoteID = caseNoteToAdd.CaseNoteID;`
是因为我只使用 [0] 吗？我这样做是为了简化对此的测试。当我单步执行代码时，我的值数组是正确的，并且有一个 Guid`caseNoteToAdd.CasNoteID`

有人可以给我一些关于我在这里出错的地方以及可能导致错误的原因吗？正如您从我的代码中可以看出的那样，我对此很陌生，而且我正在快速学习。

谢谢，

~P

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T16:03:13.310

问题是您创建了一个引用类型数组，但没有填充它。

换句话说，在这一行之后：

```
tblCaseNotesContactType[] cTypeToAdd = new tblCaseNotesContactType[cTypes.Length]; 
```

你有一个空引用数组——每个元素的值都是空的。

然后你需要写：

```
cTypeToAdd[0] = new tblCaseNotesContactType(); 
```

（或类似的声明），然后才能开始更改其属性。

另一种方法是使用对象初始化器并在一个语句中执行（在创建数组之后）：

```
cTypeToAdd[0] = new tblCaseNotesContactType
{
    CaseNoteID = caseNoteToAdd.CaseNoteID,
    ContactTypeID =cTypes[0],
    rowguid = Guid.NewGuid()
}: 
```

# iphone - 更改标签栏元素的语言

> ID：803060
> 
> 赞同：2
> 
> 时间：2009-04-29T15:59:05.783
> 
> 标签：iphone

我们正在开发要在西班牙分发的 iphone 应用程序。它包含一个标签栏，但我们不太确定如何将更多和编辑更改为西班牙语。我敢肯定有一个简单的解决方案......有人知道怎么做吗？

==== 编辑 1 ====

这就是我们添加标签栏的方式。如您所见，我们为每个按钮创建了一个 tabBarItem，但是当按钮超过 5 个时会自动出现更多按钮（正如预期的那样）。

```
for (int i = 0; i < [buttonNames count]; i++) {
   switch (i) {
      case 1:
         viewController = [[fotos alloc] init];
         break;
      case 2:
         viewController =[[videos alloc] init];
         break;
      case 3:
         viewController =[[deportes alloc] init];
         break;
      default:
         viewController = [[MyAppViewController alloc] initWithCategory:i strCategory:[tempNames objectAtIndex:i]];
         break;
   }

   UINavigationController *nav = [[UINavigationController alloc] initWithRootViewController:viewController];
   UITabBarItem *tabBarItem = [[UITabBarItem alloc] initWithTitle:[buttonNames objectAtIndex:i] image:[UIImage imageNamed:[imgNames objectAtIndex:i]] tag:i];
   nav.tabBarItem = tabBarItem;
   [controllers addObject:nav];
   [viewController release];
   [nav release];
   [tabBarItem release];
}

// Create the toolbar and add the view controllers
tabBarController = [[UITabBarController alloc] init];
[tabBarController setViewControllers:controllers animated:YES];
tabBarController.customizableViewControllers = controllers;
tabBarController.delegate = self;

// Set up the window
[window addSubview:tabBarController.view];
[window makeKeyAndVisible]; 
```

==== 已解决 ====

我所需要的只是项目中的 es.lproj 目录。我在 XCode 中创建了一个新文件（文件 > 新文件... > Mac OS X / 其他 > 字符串文件），我将其命名为 Localizable.strings 并将其保存在 es.lproj 中。任何需要本地化的字符串都需要在此文件中定义，但操作系统生成的所有其他字符串（tabBar 中的更多、编辑和完成按钮、视频控件等）将自动翻译。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T20:30:19.010

如果您使用的是内置定义的类型，它应该会自动工作。如果它们是您自己的文本，您需要从代码中使用 NSLocalizedString，从终端运行 genstrings，然后在您的包中提供西班牙语 lproj。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-12T04:13:46.560

将本地化字符串添加到您的项目并在 NSLOCalizedString() 中给出文本；

还更改本地化文本。

# sql-server - 我可以在 SQL Server 2000 MSDE 中安排作业吗？

> ID：803084
> 
> 赞同：0
> 
> 时间：2009-04-29T16:04:34.990
> 
> 标签：sql-server

我们目前正在评估我们的托管选项，我们发现最便宜的合适选项只有 SQL Server 2000 MSDE 作为数据库服务器。这是否具有使用 SQL 代理计划作业的能力？

如果没有，我可以使用 Windows 计划作业为我运行脚本吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T16:24:01.997

是的，与 SQL2005 Express 不同，SQL 代理是 SQL 2000 MSDE 的一部分...

[http://msdn.microsoft.com/en-us/library/ms165672(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms165672(SQL.90).aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T16:26:43.393

刚刚在您的其他问题上回答了这个问题，但我建议使用 Lazy Coding 的[SQLScheduler](http://www.lazycoding.com/products.aspx)产品。当您手头没有完整版本的 SQL Server 时，它是一款不错的软件，可以让您更轻松地设置和管理这些内容

编辑：我忘了提到它也是免费软件，所以值得一试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T16:11:49.467

您可以在 SQL Server 2000 的 MSDE 版本上使用 SQL Agent 来安排作业。您必须使用 SQL Server 的许可副本，无论是 MSDN 附带的副本还是零售副本，并从中安装工具，然后远程连接到 SQL Server 的 MSDE 安装。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T16:24:52.383

MSDE 处于或超过其支持生命周期：

[http://blogs.msdn.com/sqlexpress/archive/2006/08/09/693650.aspx](http://blogs.msdn.com/sqlexpress/archive/2006/08/09/693650.aspx)

所以希望这台主机使用 SQL Server Express（即 SQL Server 2005 或更高版本的免费版本）而不是 MSDE。

否则，Express 不附带作业调度程序。但是您始终可以将 SQL 命令捆绑在 .bat 文件中或存储在 .sql 文件中，然后使用 oSQL (SQL Server 2000) 或 sqlcmd (SQL Server 2005) 在命令提示符处运行它们。这将让您使用 Windows 调度程序。

# c++ - 我的 qhttp get() 调用在 Windows 上不起作用，但在 Linux 上起作用

> ID：803088
> 
> 赞同：1
> 
> 时间：2009-04-29T16:05:03.227
> 
> 标签：c++, qt, get

我编写了一个使用 qhttp 获取网页的程序。这在 Linux 上运行良好，但不适用于我的 Windows 机器（Vista）。似乎从未收到过 qhttp done 信号。

相关代码为：

```
 Window::Window()
{
    http = new QHttp(this);
    connect(http, SIGNAL(done(bool)), this, SLOT(httpDone(bool)));
url = new QUrl("http://something.com/status.xml");
http->setHost(url->host(), url->port() != -1 ? url->port() : 80);
    if (!url->userName().isEmpty()) http->setUser(url->userName(), url->password());
}

void Window::retrievePage()
{ 
byteArray = new QByteArray;
result = new QBuffer(byteArray);
result->open(QIODevice::WriteOnly);

    httpRequestAborted = false;
    httpGetId = http->get(url->path(), result);
 }

 void Window::httpDone(bool error)
 {
     //Never gets here!
 } 
```

任何帮助将不胜感激。

马特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-28T20:06:48.933

这根本不应该发生，即 QHttp 在 Windows 和 Unix 上都可以可靠地工作。

我的建议是检查发球是否给出适当的响应。这可以通过例如验证数据传输是否正常来完成。您可以从 QHttp 的信号中跟踪状态，例如[dataReadProgress](http://doc.trolltech.com/4.5/qhttp.html#dataReadProgress)、[requestStarted](http://doc.trolltech.com/4.5/qhttp.html#requestStarted)、[requestFinished](http://doc.trolltech.com/4.5/qhttp.html#requestFinished)和其他相关信号。

另一方面，不要使用旧的 QHttp，为什么不使用推荐的[QNetworkAccessManager](http://doc.trolltech.com/4.5/qnetworkaccessmanager.html)呢？要快速了解一下，请查看我前段时间在 Qt Labs 上发布的一个示例：[支持远程 URL 拖放的图像查看器](http://labs.trolltech.com/blogs/2008/11/08/image-viewer-with-remote-url-drag-and-drop-support/)。它使用上述[QNetworkAccessManager](http://doc.trolltech.com/4.5/qnetworkaccessmanager.html)从丢弃的 URL 中获取图像。检查[源代码](http://qt.gitorious.org/qt-labs/graphics-dojo/blobs/master/dragremote/dragremote.cpp)，它只有 150 行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-23T13:08:52.743

按照 Ariya 的建议重写以使用 QNetworkAccessManager 并查看[此示例](http://wiki.forum.nokia.com/index.php/CS001431_-_Creating_an_HTTP_network_request_in_Qt)

这现在适用于 Windows 和 Linux。

```
Window::Window()
{
   connect(&manager, SIGNAL(finished(QNetworkReply*)),
        this, SLOT(retrieveData(QNetworkReply*)));
}

void Window::retrieveMessage()
{
    manager.get(QNetworkRequest(QUrl("http://...")));
}

void Window::retrieveData(QNetworkReply *reply)
{
    QVariant statusCodeV = 
    reply->attribute(QNetworkRequest::HttpStatusCodeAttribute);

    // "200 OK" received?
    if (statusCodeV.toInt()==200)
    {
        QByteArray bytes = reply->readAll();  // bytes
    }

    reply->deleteLater();
} 
```

# sql-server - SQL Server 2000 MSDE 有 DTS 吗？

> ID：803092
> 
> 赞同：2
> 
> 时间：2009-04-29T16:05:46.860
> 
> 标签：sql-server

我们目前正在评估我们的托管选项，我们发现最便宜的合适选项只有 SQL Server 2000 MSDE 作为数据库服务器。

这个版本有DTS吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T16:17:36.193

SQL Server 2000 MSDE 确实有它。但是，SQL Server 2005 Express 没有 SSIS，它可以替代 DTS。

[MSDN 文章](http://msdn.microsoft.com/en-us/library/ms165636(SQL.90).aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T16:11:54.363

它支持运行它们，但不支持开发它们。这是 Microsoft 的一篇文章，讨论了它。

[MSDN 文章](http://msdn.microsoft.com/en-us/library/aa175272(SQL.80).aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T16:14:46.760

您可以在 SQL Server 2000 MSDE 上运行 DTS 包，但您需要在 SQL Server 的完整副本上创建它们并复制它们。使用 DTSrun.exe 运行它们

在类似的情况下，我曾多次使用过 MSDE。对于中小型网站来说已经足够了，但是如果您有任何复杂的东西，那么建议您使用完整版的 SQL Server。您很可能还需要一个额外的工具来设置计划作业[Lazy Coding 的 SQLScheduler](http://www.lazycoding.com/products.aspx)是一个很好的解决方案。

# svn - 关于网页设计的版本控制最佳实践

> ID：803098
> 
> 赞同：3
> 
> 时间：2009-04-29T16:06:47.293
> 
> 标签：svn, web-applications, version-control

我们正在一个具有核心和模块的项目上使用 SVN。我们希望模块开发与核心分开，但模块将位于核心文件中。

我的问题是：你将如何设置存储库来管理这样的事情？您是否会将所有模块都放入自己的存储库中，这样如果您想处理特定模块，您需要检查核心版本和您想要处理的模块，或者您会在一个不同的方式。

想想像WordPress这样的东西。

示例：root/
  index.php
  file1.php
  file2.html
  something.php
  FolderA
  FolderB
  **ModulesFolder/**
    Module1Folder/
    Module2Folder/

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T16:59:24.080

我们有一个核心存储库，然后是我们的子模块的存储库，然后使用 subversion “externals” 属性让核心引用模块，它会根据您的设置自动签出/更新引用项目。因此，例如可以将模块保持在给定的版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T20:33:26.013

我们有一个非常相似的系统，我们使用单个存储库并为核心和模块分解主干和每个分支。我们发现使用这种结构更容易维护版本、标签、分支等。它还使我们能够通过单个 Trac 安装跟踪所有内容。( [http://trac.edgewall.org/](http://trac.edgewall.org/) )

# asp.net-mvc - 默认路由和包罗万象的路由问题

> ID：803101
> 
> 赞同：0
> 
> 时间：2009-04-29T16:07:31.490
> 
> 标签：asp.net-mvc, routing

我定义了很多明确的路线。其中之一是：

```
routes.MapRoute("default", "",
  new { controller = "Home", action = "Index" }); 
```

最后，我定义了一个包罗万象的路线：

```
routes.MapRoute("PageNotFound", "{*url}",
  new { controller = "Error", action = "Http404" }); 
```

如果我转到主页[http://localhost](http://localhost)，则会显示 http404 页面。奇怪的是，如果我删除包罗万象的路线，那么欢迎页面会正确显示。另请注意，我有一个菜单，我在其中调用 Url.RouteUrl("default") 并且正确生成了指向主页的链接。

那么，当包罗万象的路线存在时，为什么我的默认路线没有被激活？

**更新**：我正在使用 routes.RouteExistingFiles=true。如果我删除它，那么它会按预期工作。但我需要将其设置为 true。这里有什么问题？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T12:51:11.907

如果您使用“routes.RouteExistingFiles=true”，则意味着它将现有（物理存在的）文件作为自己的文件进行路由 - 因此将跳过这些文件的路由。我认为在您的根网站中可能有一个“default.aspx”或“index.htm”或类似的东西。

打开 RouteExistingFiles 将允许这些文件正常执行（而不是通过路由）。

现在我认为发生的事情是你的包罗万象的路由覆盖了你的 RouteExistingFiles - 所以它会自动将 default.aspx 路由到你的 404 包罗万象中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-14T01:32:14.780

如果在 RegisterRoutes() 中仍有默认路由***（IE {controller}/{action}/{id}）***，它将捕获与普通 MVC 请求格式匹配的所有 URL。

换句话说，如果它不符合正常格式（***blah/blah/blah/blah***），包罗万象的路由只能拦截错误的 URL。

在控制器不存在的情况下，必须通过常规的 ASP.NET 处理来处理异常。

有一个很好的描述来处理这个[here](https://stackoverflow.com/questions/619895/how-can-i-properly-handle-404s-in-asp-net-mvc/620559#620559)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-12T11:26:53.333

您是否尝试对“全部捕获”路线施加限制？约束应该告诉它包罗万象的段不应该有 0 个字符。

# sql - 在 T-SQL (SQL server 2008) 中连接到远程服务器

> ID：803103
> 
> 赞同：10
> 
> 时间：2009-04-29T16:08:02.393
> 
> 标签：sql, sql-server, tsql

有没有人有一个连接到远程服务器的存储过程的例子？

我一直在网上搜索，到目前为止发现可以使用它来完成`sp_addlinkedserver`，`sp_addlinkedsrvlogin`但我还没有找到一个很好的例子，我也不太了解文档。

### 更新：

两个第一个回复都没有帮助我，我能得到的最接近的是使用这个：

```
EXEC sp_addlinkedserver 
    @server = 'SiminnSrv', 
    @provider = 'SQLNCLI',
    @catalog = 'devel',
    @srvproduct = '',
    @provstr = 'DRIVER={SQL Server};SERVER=my.serveradr.com;UID=my_user_name;PWD=my_pass_word;' 
```

这实际上让我连接了，但是当我查询一个表时，我收到了这条消息：

> 用户“（空）”登录失败。原因：未与受信任的 SQL Server >连接关联。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-29T16:19:02.647

本质上，您创建一个链接服务器到另一个服务器，然后提供登录凭据以用于对该链接服务器的 SQL 调用。例如，这将使用该服务器的 DomainAccount 连接到“MyOtherServer”，用户名和密码为“DomainUserName”、“DomainPassword”

```
EXEC sp_addlinkedserver 'MyOtherServer', N'SQL Server'

EXEC sp_addlinkedsrvlogin 
   'MyOtherServer', 
   'false', 
   'OtherServerDomain\DomainUser', 
   'DomainUserName', 
   'DomainPassword' 
```

更多信息[在这里](http://msdn.microsoft.com/en-us/library/ms190479.aspx)和[这里](http://msdn.microsoft.com/en-us/library/ms189811.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2015-10-20T18:52:53.380

我设法使用“SQL Server Native Client 10”（`SQLNCLI10`）通过链接服务器连接到 MSSQL Server 2008，但我不得不使用`sp_addlinkedsrvlogin`而不是`@provstr`提供连接详细信息。这是基于[本文](http://www.codeproject.com/Articles/35943/How-to-Config-Linked-Servers-in-a-Minute)中的示例：

```
EXEC master.dbo.sp_addlinkedserver 
    @server = 'MyServerConnection',
    @srvproduct = '', 
    @datasrc = 'SERVERNAME\INSTANCENAME',
    @provider = 'SQLNCLI10', 
    @provstr = ''

EXEC sp_addlinkedsrvlogin
    @rmtsrvname = 'MyServerConnection',
    @useself = 'false',
    --@locallogin = 'someLocalUser' -- Use to restrict the connection to specific login
    @rmtuser = 'remoteUser',
    @rmtpassword = 'secret' 
```

查询此链接服务器：

```
SELECT *
FROM [MyServerConnection].[SomeDatabase].[dbo].[TableName] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-02-04T09:33:16.393

我可能迟到了，但我发现以下链接对我有用：

为了执行初始链接，我使用了

```
EXEC sp_addlinkedserver @server='serverLinkPseudonym',@srvproduct='',@provider='SQLOLEDB', @datasrc='192.168.1.1'; 
```

然后，当我使用 Windows 身份验证登录时，我添加了 Windows 用户（这解决了我的“未与受信任的 SQL Server 关联”错误）

```
EXEC sp_addlinkedsrvlogin 'serverLinkPseudonym', 'false', 'MACHINENAME\windowsLogin', 'lnkSrvLogin', 'lnkSrvPswd'; 
```

我还发现，如果我要运行调用 LinkedServer 的 SQL Server 代理作业，我必须添加以下内容：

```
EXEC sp_addlinkedsrvlogin 'serverLinkPseudonym', 'false', 'NT AUTHORITY\SYSTEM', 'lnkSrvLogin', 'lnkSrvPswd'; 
```

为了清楚起见：“192.168.1.1”是要链接到的服务器的 IP。“lnkSrvLogin”是要链接到的服务器上的登录名，可以访问您需要访问的数据库。“lnkSrvPswd”是该帐户的密码。

如果您使用现有服务器中的帐户连接到链接服务器，则只需在 sp_addlinkedsrvlogin 命令中使用该帐户名。例如：

```
EXEC sp_addlinkedsrvlogin 'serverLinkPseudonym', 'false', 'thisServerLogin', 'lnkSrvLogin', 'lnkSrvPswd'; 
```

然后测试它：

```
SELECT * FROM [serverLinkPseudonym].[DBName].[dbo].[TableName] 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T16:23:15.960

如果您希望能够查询另一台服务器，则需要创建一个链接服务器。

此页面对 sp 的工作原理进行了非常彻底的解释。 [http://doc.ddart.net/mssql/sql70/sp_adda_17.htm](http://doc.ddart.net/mssql/sql70/sp_adda_17.htm)

如果要链接到另一个 sql server，只需执行以下命令：

```
sp_addlinkedserver @server='ServerName', @srvproduct='SQL Server' 
```

@server 是您要添加的服务器的名称。@srcproduct 是它的服务器类型。您可能还需要做一些其他事情才能将 2008 年连接到 2005 年，但 2008 年应该像这样工作。

# iphone - UISlider 有音效和振动

> ID：803105
> 
> 赞同：0
> 
> 时间：2009-04-29T16:08:34.403
> 
> 标签：iphone

我需要用 UISlider 做很多事情。首先，我想知道什么是可能的，什么是不可能的。请给我一些可行的想法。

我需要在我的 iPhone 应用程序中添加一个滑块控件（它应该类似于手机充电时在 iphone 中显示的那个）。

1.  UISlider 的圆形按钮是否可以更改为任何其他形状。可以在那个圆形按钮上添加任何图像吗？

2.  当 UISlider 被移动时，我们需要添加声音效果（例如汽车提示声音），当滑动结束时声音应该停止。这可能吗？如果是，请给我一些想法来做到这一点。3.滑动时也应该发生振动（可能吗？）

提前致谢！！！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T17:12:16.637

所有这些都可以通过公共 API 完成。阅读文档:-)

1.  该按钮称为“拇指图像”；有一个属性来替换图像。
2.  分配一个委托并在滑块上设置“连续”属性。

有关委托的更多信息，请参阅应用程序编程指南。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-26T17:50:12.950

至于问题2，只需写出完成播放声音和振动的方法，然后在滑块上的值发生变化时让它们触发。

# delphi - 使用作为资源嵌入的 dll 启动程序时出现问题

> ID：803106
> 
> 赞同：4
> 
> 时间：2009-04-29T16:09:08.647
> 
> 标签：delphi, dll, embedded-resource

我已经完成了[关于在 Delphi EXE 中嵌入 dll 的 About.com 指南，](http://delphi.about.com/od/windowsshellapi/l/aa012103c.htm)这似乎可以工作，只要我实际上不使用 DLL 作为外部函数。有没有办法让我链接到的代码比使用子句中引用的单元更早地工作。
我试过了：

*   完全按照这段代码所说的去做。
*   将此代码放置在使用使用外部函数的单元的表单的初始化部分中。
*   将此代码放在使用外部函数的单元的初始化部分。

通过外部函数，我指的是一个看起来像这样的函数：

```
function MyFunction: Integer; stdcall; external 'fundll.dll'; 
```

我遇到的问题是无法加载通常的“fundll.dll”（因为它不在目录中）。当代码达到那一步时，Zarko 的代码就可以工作（非常棒，它在那个文件夹中创建了 dll）。但是当我使用我需要的外部功能时，它甚至在项目开始之前就崩溃了。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T16:19:39.837

您不能使用外部函数执行此操作 - 在提取 DLL 后使用*LoadLibrary()*和*GetProcAddress()*，一切都应该正常工作。

原因是任何代码只有在操作系统加载器解析了所有入口点之后才会执行。有点鸡和蛋的问题，如果你愿意的话。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-02T00:53:04.813

如果您打算使用 LoadLibrary() 和 GetProcAddress()，您可能更喜欢使用 BTMemoryModule，它允许您使用作为资源嵌入的 DLL 而无需将其保存到文件系统（用户可能无法这样做，取决于机器的安全性）。

[http://www.jasontpenny.com/blog/2009/05/01/using-dlls-stored-as-resources-in-delphi-programs/](http://www.jasontpenny.com/blog/2009/05/01/using-dlls-stored-as-resources-in-delphi-programs/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-29T16:21:20.457

如果你想在其中调用一个函数，你有两个选择......

1) 使用 exe/dll 捆绑器而不是资源方法。2) 不要使用外部样式声明链接到库。而是使用 LoadLibrary、GetProcAddress 等来引用您需要调用的函数。

资源方法和函数作为外部的声明不会混在一起。windows希望在您的代码运行以提取dll*之前将您的exe链接到内存中的dll。*

# java - 基于内容估计文本宽度的算法

> ID：803109
> 
> 赞同：11
> 
> 时间：2009-04-29T16:09:43.043
> 
> 标签：java, algorithm, text

这是一个很长的镜头，但有谁知道基于其内容估计和分类文本宽度（对于可变宽度字体）的算法？

例如，我想知道*iiiiiiiii*没有 abcdefgh 宽，而*abcdefgh*又没有*WWWWWWW*宽，尽管所有三个字符串的长度都是八个字符。

这实际上是在尝试将一些智能构建到字符串截断方法中，该方法目前正在正确截断视觉上较宽的字符串，但也不必要地截断视觉上较窄的字符串，因为两个字符串包含相同数量的字符。算法将输入字符串分类为*窄*、*正常*或*宽*然后酌情截断可能就足够了。

这个问题实际上并不是特定于语言的，但是如果有算法，那么我将在 Java 中实现它。这是针对 Web 应用程序的。我知道 SO 上有一些答案可以使用 JavaScript 来处理这个问题来获取包含`div`元素的宽度，但我想知道服务器端解决方案是否可行。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-29T16:15:20.270

大多数 GUI 框架都提供了一些方法来计算给定输出设备上字体的文本度量。

使用`java.awt.FontMetrics`，例如，我相信你可以做到这一点：

```
import java.awt.Font;
import java.awt.FontMetrics;
import java.awt.Graphics; 

public int measureText(Graphics g, String text) {
   g.setFont(new Font("TimesRoman", Font.PLAIN, 12));
   FontMetrics metrics = g.getFontMetrics();

   return metrics.stringWidth(text);
} 
```

未经测试，但你明白了。

* * *

在 .Net 下，您可以使用该[`Graphics.MeasureString`](http://msdn.microsoft.com/en-us/library/6xe5hazb(VS.80).aspx)方法。在 C# 中：

```
private void MeasureStringMin(PaintEventArgs e)
{

    // Set up string.
    string measureString = "Measure String";
    Font stringFont = new Font("Arial", 16);

    // Measure string.
    SizeF stringSize = new SizeF();
    stringSize = e.Graphics.MeasureString(measureString, stringFont);

    // Draw rectangle representing size of string.
    e.Graphics.DrawRectangle(new Pen(Color.Red, 1), 0.0F, 0.0F, stringSize.Width, stringSize.Height);

    // Draw string to screen.
    e.Graphics.DrawString(measureString, stringFont, Brushes.Black, new PointF(0, 0));
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-07-07T01:04:26.390

这对我有用：

```
AffineTransform af = new AffineTransform();     
FontRenderContext fr = new FontRenderContext(af,true,true);     
Font f = new Font("Arial", 0, 10); // use exact font
double width= f.getStringBounds("my string", fr).getWidth(); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T16:19:27.827

对于 Web 应用程序，您无法（真的）得到正确的估计。不同的字体具有不同的宽度，因此这不仅取决于客户端（浏览器）及其缩放和 DPI 设置，还取决于该机器（和操作系统）上存在的字体或其替代品。

如果您需要精确测量，请创建一个图形（位图、SVG，甚至一些 PDF 或其他），它将在服务器上而不是客户端上进行布局和呈现。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-29T16:29:03.793

**没有可靠的服务器端解决方案来计算文本的宽度。**（除了创建文本图像和可能的 SVG 之外）

如果您尝试使用[浏览器截图](http://browsershots.org/)之类的工具并针对相对基本的页面运行它，您会立即明白原因。很难预测即使是最平凡的例子会产生多宽，更不用说如果用户决定放大浏览器等......

没有明确说明您可能想要截断字符串（这可能有助于提供潜在的解决方案），但一个常见的原因是您想在某个点截断文本并提供一个椭圆。

[这可以通过使用 css 属性在许多浏览器平台上可靠地完成，并且**没有**javascript：](http://www.jide.fr/emulate-text-overflowellipsis-in-firefox-with-css)

[http://www.jide.fr/emulate-text-overflowellipsis-in-firefox-with-css](http://www.jide.fr/emulate-text-overflowellipsis-in-firefox-with-css)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-29T17:22:31.263

你真的无法知道客户端使用的是什么浏览器、字体设置、屏幕大小等。（好吧，有时请求标头提供了一个指示，但实际上没有一致或可靠的。）

所以，我会：

*   在 Internet Explorer 中显示一些示例文本，默认设置为 1024x768 的屏幕/窗口大小（这通常是最常见的大小）
*   使用此配置获取平均字符/行并将其用于您的估计。

我通常发现这“足够好”，例如，用于估计某些文本将在浏览器上占用的行数，以估计在文本旁边显示多少广告。

如果这对您来说真的很重要，那么我可以想象一个复杂的方案，您首先将一些 Javascript 发送到客户端，然后进行测量并将其发送回您的服务器，然后您将这些信息用于以后的页面客户。不过，我无法想象这通常是值得的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-29T16:16:49.003

我认为您应该选择以下解决方案之一：

*   确切的解决方案：总结字符串中每个字符的宽度（大多数 API 都会为您提供此信息）
*   快速估计：取最大或最小宽度并将其乘以字符数。

当然，一些混合估计是可能的，但我认为这在错误的方向上付出了太多努力。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-29T16:16:51.700

> 这实际上是尝试将一些智能构建到字符串截断方法中 [...]

真的值得努力吗？我们遇到了这个确切的问题。这是跨语言的。解决方法是保持原样。随着您添加支持的每种语言，保持这种智能的复杂性迅速增加（并且可能成倍增加）。因此我们的决定。

> [...] 一种基于其内容估计和分类文本宽度（对于可变宽度字体）的算法？

大多数字体库都会为您提供这些信息。但这是相当低级的东西。基本思想是传入一个字符串并以点为单位取回宽度。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-29T16:18:17.860

对于一个不错的*客户端解决方案，您可以尝试[RichieHindle 对我的问题的回答](https://stackoverflow.com/questions/802175/truncating-long-strings-with-css-feasible-yet/802195#802195)所建议的混合 CSS 和 Javascript 方法。

鉴于您不知道用户将看到页面的字体（他们总是可以覆盖您的选择、Ctrl-+ 页面等），执行此操作的“正确”位置是在浏览器上......尽管浏览器不要让它变得容易！

`*`当我说“不错”时，我的意思是“可能不错，但我还没有真正尝试过”。

# javascript - 在一组预定义的文本选项中查找

> ID：803110
> 
> 赞同：3
> 
> 时间：2009-04-29T16:09:49.410
> 
> 标签：javascript

比如说，我想看看一个 DOM 元素是否是一个块。我可以用三种方式写它，这取决于我的心情：

```
// first way
if (el.currentStyle.display == "block" || el.currentStyle.display == "inline-block" || el.currentStyle.display == "table-cell")       

// second way
var blocks = {"block": 1, "inline-block": 1, "table-cell": 1};
if (el.currentStyle.display in blocks)// 

// third way
if (el.currentStyle.display.match(/block|inline-block|table-cell/)) 
```

我对他们所有人都有复杂的感觉。一旦我有多个选项，第一个就太冗长了。第二个包含对象中的那些任意值（这次我放了 1）。第三个看起来有点矫枉过正。（过度杀戮到底有什么不好？）

你知道另一种更好的方法吗？如果没有，我对这三种方式有什么遗漏吗？

请仅使用 Javascript。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T17:28:46.270

我喜欢第三种方式；我不认为它看起来像矫枉过正。如果您需要更短的方法，那么这也可以：

```
el.currentStyle.display.match(/(e-)?(block|cell)/) 
```

但这不是很可读...

通过扩展 String 原型可能值得将其全部抽象出来：

```
String.prototype.matches = function(what) {
    return (',' + what + ',').indexOf(',' + this + ',') > -1;
};

// Using it:
el.currentStyle.display.matches('block,inline-block,table-cell'); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-01T21:11:34.970

如果我们的主要目标是可读性，并且如果这种情况不止一次发生——即使它*只是*一次——我会将测试转移到一个函数中。然后以您喜欢的方式定义该函数——可能是选项 1，以实现最大的简单性。

矫枉过正？可能。但是对于想要在 6 个月后扫描并理解代码的程序员来说，这是一份礼物。可能你:-)

```
function isBlock(el) {
  return (el.currentStyle.display == "block" || 
          el.currentStyle.display == "inline-block" || 
          el.currentStyle.display == "table-cell");
}

// ...

if (isBlock(el)) {
  // do something
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T16:12:10.527

你不能使用第二种方式，但检查它是否未定义，然后跳过“ `: 1`”部分。虽然我没有测试过。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T17:42:45.473

看起来您需要一个 inArray 函数，这是顶部搜索结果中的一个：

```
Array.prototype.inArray = function (value) {
  var i;
  for (i=0; i < this.length; i++) {
    if (this[i] === value) {
      return true;
    }
  }
  return false;
}; 
```

那么第四种方式看起来像这样：

```
if (['block','inline-block','table-cell'].inArray(el.currentStyle.display)) 
```

或者以更易读的方式：

```
var isBlock = ['block','inline-block','table-cell'].inArray(el.currentStyle.display); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T07:36:34.377

我首选的解决方案是：

```
'block||inline-block||table-cell'.indexOf( el.currentStyle.display ) >= 0 
```

我认为这将使用字符串的本机代码，并且比数组和迭代方法更有效。

# asp.net - 选择具有任意端点的可变时间跨度

> ID：803111
> 
> 赞同：0
> 
> 时间：2009-04-29T16:09:50.547
> 
> 标签：asp.net, vb.net, sql-server-2005

我一直在研究一个检查时间的存储过程，然后检索在上午 8 点和前一个 8 点之间的最后一个完整的 24 小时期间返回的记录。例如，假设现在是上午 10 点。存储过程查看当前时间，指出它已超过上午 8 点，并将查询设置为从今天上午 8 点到昨天上午 8 点 24 小时向后运行。如果是早上 7 点，查询将设置为从昨天早上 8 点到前一天早上 8 点进行检查。这实际上相对简单。SP 旨在用于检索在给定时间跨度内完成的报告跟踪作业的记录。

但是，他们回过头来要求我更改存储过程，以便报告结束的时间和检查的时间跨度可以从站点的前端进行配置。我的 TimeSpan 工作时间大于或等于 24 小时，但在此范围内遇到了问题。到目前为止，这是我在存储过程中的逻辑 -

```
-- Retrieves data on jobs that completed/completed with errors during a given time span.
DECLARE @Hour NVARCHAR(2)
DECLARE @TimeFrame NVARCHAR(2)
DECLARE @TimeSpan INTEGER

SET @TimeSpan = 24
SET @TimeFrame = 'AM'
SET @Hour = '08'

DECLARE @dateStart DateTime
DECLARE @dateEnd DateTime

IF @TimeSpan < 24 -- Our TimeSpan is under one full day.
    BEGIN
            IF GETDATE() > DATEADD(hh, 0, DATEDIFF(hh, 0, GETDATE())) + (@Hour + ':00:00 ' + @TimeFrame)
            BEGIN
                SET @dateStart = DATEADD(hh, 0, DATEDIFF(hh, 0, GETDATE() - (1 + @TimeSpan))) + (@Hour + ':00:00 ' + @TimeFrame)
                SET @dateEnd =  DATEADD(hh, 0, DATEDIFF(hh, 0, GETDATE())) + (@Hour + ':00:00 ' + @TimeFrame)
            END
        ELSE
            BEGIN
                SET @dateStart = DATEADD(hh, 0, DATEDIFF(hh, 0, GETDATE() - (2 + @TimeSpan))) + (@Hour + ':00:00 ' + @TimeFrame)
                SET @dateEnd =  DATEADD(hh, 0, DATEDIFF(hh, 0, GETDATE() - 1)) + (@Hour + ':00:00 ' + @TimeFrame)
            END
    END
ELSE -- Our TimeSpan is at least one full day.
    BEGIN
        IF GETDATE() > DATEADD(D, 0, DATEDIFF(D, 0, GETDATE())) + (@Hour + ':00:00 ' + @TimeFrame)
            BEGIN
                SET @dateStart = DATEADD(D, 0, DATEDIFF(D, 0, GETDATE() - (1 + (@TimeSpan/24)))) + (@Hour + ':00:00 ' + @TimeFrame)
                SET @dateEnd =  DATEADD(D, 0, DATEDIFF(D, 0, GETDATE())) + (@Hour + ':00:00 ' + @TimeFrame)
            END
        ELSE
            BEGIN
                SET @dateStart = DATEADD(D, 0, DATEDIFF(D, 0, GETDATE() - (2 + (@TimeSpan/24)))) + (@Hour + ':00:00 ' + @TimeFrame)
                SET @dateEnd =  DATEADD(D, 0, DATEDIFF(D, 0, GETDATE() - 1)) + (@Hour + ':00:00 ' + @TimeFrame)
            END
    END 
```

@Hour、@TimeFrame 和@TimeSpan 都是报表前端可以设置的参数，分别默认为'08'、'AM'和24。我知道在顶层 if 的 ELSE 部分中设置日期范围可以正常工作。我有理由确定设置小时偏移量的问题在于我在这里如何使用 DATEADD 和 DATEDIFF 函数，但我无法弄清楚我在哪里错过了一步。在这里的任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T17:36:12.663

为什么不只使用如下查询：

```
SELECT something
FROM aTable
WHERE timeCompleted BETWEEN @StartDate AND @EndDate 
```

如果您担心时间是否正确（即日期必须是 '01/01/1900 13:00:00' 或类似的东西），只需单独传入日期并将时间作为函数添加到 SQL 中。

如果这不是您想要的，请包含更多 SQL，以便我们更好地了解您要完成的工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T23:21:54.883

```
-- convert the required end hour to 24 hour format
DECLARE @EndHour INT
SET @EndHour = CASE WHEN @TimeFrame = 'AM' THEN @Hour ELSE @Hour + 12 END

-- set @DateEnd to the date-only portion of the current datetime
-- ie, the time portion will be set to 00:00:00
SET @DateEnd = DATEADD(day, 0, DATEDIFF(day, 0, GETDATE()))

-- add the required end hour
SET @DateEnd = DATEADD(hour, @EndHour, @DateEnd)

-- if @DateEnd is in the future then subtract 24 hours from it
IF @DateEnd > GETDATE()
   SET @DateEnd = DATEADD(hour, -24, @DateEnd)

-- set @DateStart by subtracting the required timespan from @DateEnd
SET @DateStart = DATEADD(hour, -@TimeSpan, @DateEnd) 
```

# sql-server - SQL Server 2000 MSDE 中的最大数据库大小

> ID：803112
> 
> 赞同：1
> 
> 时间：2009-04-29T16:10:25.773
> 
> 标签：sql-server

我们目前正在评估我们的托管选项，我们发现最便宜的合适选项只有 SQL Server 2000 MSDE 作为数据库服务器。

服务器上数据库的最大大小是多少？dbs 组合是否有最大总大小？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T16:12:01.027

2GB：

[http://msdn.microsoft.com/en-us/library/ms165672(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms165672(SQL.90).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T16:13:29.493

2Gb。

在此页面上搜索 MSDE：

[http://msdn.microsoft.com/en-us/library/aa933149.aspx](http://msdn.microsoft.com/en-us/library/aa933149.aspx)

# c# - C# Thread.Sleep 立即唤醒

> ID：803127
> 
> 赞同：6
> 
> 时间：2009-04-29T16:13:05.593
> 
> 标签：c#, multithreading

我正在使用下面的代码

```
Thread.Sleep(5); 
```

在while循环结束时。尝试在迭代之间获得 5ms 的延迟。

有时它会休眠 16 毫秒。我理解并接受这一点，因为这取决于 CPU 何时开始为线程提供服务。然而，一旦它唤醒了下一次迭代，它似乎在睡眠调用之后立即唤醒（我正在使用时间戳记录）。使用如此短的睡眠间隔是否存在问题，以至于它被视为零？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-29T16:15:31.050

您的问题就像在大多数现代机器上一样，[DateTime.UtcNow](http://msdn.microsoft.com/en-us/library/system.datetime.utcnow.aspx)的分辨率约为 10-15 毫秒（尽管我看到文档说自 NT 3.5 以来约为 10 毫秒）。如果您想要更高分辨率的计时，请参阅[Stopwatch](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx)类，特别是[Stopwatch.GetTimestamp()](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.gettimestamp.aspx)。

另请注意，如果高分辨率计时器可用， Stopwatch 只会使用高分辨率计时器（[Stopwatch.IsHighResolution](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.ishighresolution.aspx)会在运行时告诉您）。如果不是，它会退回到 DateTime.UtcNow.Ticks。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-29T16:15:12.173

最有可能的问题是您的计时器的分辨率有限。如果它只更新，比如说，每 10 毫秒，您将在某些迭代中看到相同的时间戳，即使 5 毫秒已经过去。

您使用哪个计时器来生成时间戳？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T16:27:46.917

如果我没记错的话，NT 时间片是在 NT 内核中引入的，并且仍然以与 XP 相同的方式处于活动状态，它在 5 毫秒左右运行。我们正在构建一个实时应用程序并遇到了这个问题。您将无法始终获得 5 毫秒的睡眠时间。我们发现您有时会得到 10 到 16 毫秒，有时没有毫秒，偶尔但很少会得到 5 毫秒。

大约 5 年前我在做这些测试，但从那时起事情可能发生了变化。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T16:16:22.497

你在什么样的系统上运行这个？小间隔可能取决于处理器及其支持的分辨率。我曾经在手持设备上运行过一个应用程序，计时器本身的分辨率为 16 毫秒。所以它可能与硬件有关。尝试将时间段增加到 30 毫秒，然后看看它是否有效。

# visual-studio-2008 - Visual Studio 2008 开发 Web 服务器问题

> ID：803135
> 
> 赞同：2
> 
> 时间：2009-04-29T16:14:59.163
> 
> 标签：visual-studio-2008, cassini

我有一个带有 asp.net 2.0/C# 网站的 Visual Studio 2008 解决方案。当我按 F5 进行调试时，cassini - 开发网络服务器正常启动并将其自身挂接到系统托盘中。但是这之后就有问题了。如果 cassini 从端口 4004 开始，浏览器会查找端口 4002。然后我必须手动将浏览器地址栏中的端口更改为 4004 才能启动网站。

我在 VS2005 SP1 中也遇到过这个问题。这真的让我很生气，因为我花了很多时间在浏览器地址栏中手动更改端口。MSDN 上没有关于此问题的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-14T16:11:29.573

您是否正在运行 ESET NOD32 Antivirus？它的防火墙可能会导致问题：

[ESET NOD32 和 Visual Studio 端口号](https://stackoverflow.com/questions/607562/visual-studio-development-server-using-wrong-port)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T16:21:24.217

URL 上的端口是始终`4002`还是随机的？您可以在 Visual Studio 中为项目指定特定端口，但这始终使用与服务器启动相同的端口启动我的浏览器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T16:22:08.210

您是否尝试过通过 Web 应用程序设置设置特定端口？使用固定端口，而不是自动分配应该清理它。

如果没有，您可以尝试以下解决方法：

右键单击您的入口页面并选择“在浏览器中查看”以在 Cassini/Web 开发服务器中启动您的 Web 应用程序。

转到工具->附加到进程并找到“WebDev.WebServer.EXE”文件或类似的文件。标题应为“ASP.NET 开发服务器”。

这应该将调试器连接到您的本地开发服务器，并允许您根据需要进行调试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T16:25:14.707

我建议查看您的 Web 应用程序的 Web 调试属性。

*   在 Visual Studio 中打开项目后，
*   选择 Web 应用程序的根目录（.csproj 文件），
*   右键单击并从上下文菜单中选择“**属性”。**
*   选择属性页集的“ **Web ”选项卡。**

在“**服务器**”下，有 3 个选项：

1.  使用 Visual Studio 开发
2.  服务器，使用本地 IIS Web 服务器
3.  使用自定义 Web 服务器

检查“使用虚拟工作室开发服务器”下是否选择了“**自动分配端口**”，并且**虚拟路径**是“/”。

更改设置、保存、构建、运行，然后将它们更改回我上次遇到它时修复的“合理”值。

或者，如果您愿意，您可以手动修改 .csproj 文件的 XML 以达到相同的效果。

希望这能解决它。

乔尔

# windows - 适用于 Windows 的 Web 开发文本/代码编辑器

> ID：803149
> 
> 赞同：1
> 
> 时间：2009-04-29T16:18:21.353
> 
> 标签：windows, editor, ftp

我目前正在使用[E-TextEditor](http://e-texteditor.com/)。这个应用程序正在努力成为*Windows 的 TextMate*，但不幸的是它不是很稳定。此外，它在打开缩小文件（例如 70 kB JavaScript 文件）时存在一些严重问题，恕我直言，这是不可接受的。

Notepad2打开这些文件完全没有问题，而且看起来也很稳定。不幸的是，它不允许通过选项卡创建多个文件实例，并且缺少远程编辑功能。

对我来说，完美的文本编辑器应该是像 Notepad2 一样快速和轻量级的东西，但增加了一些功能，例如在选项卡中打开文档和通过 FTP 进行远程编辑。

那么，有什么建议吗？您使用哪个编辑器通过 FTP 直接编辑文件？

PS：我不是在寻找像 Zend Studio 或 Dreamweaver 这样的繁重应用程序。一个不需要 30 秒即可启动的具有上述功能的简单程序将是完美的，ithankyou。

PPS：是的，我阅读了[文本编辑器](https://stackoverflow.com/questions/14155/text-editors)主题，但我的问题显然更具体一些。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-29T16:24:22.323

作为一名开发人员，我非常习惯于使用 Notepad++，我只想说 N++ 中提供了选项卡和 FTP 访问功能。但是，我不知道它如何处理缩小的 JS，因为我从未尝试过，但可能也有一些插件。这是一个非常方便的工具，也非常轻量级:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-29T16:26:52.333

你考虑过[记事本++](http://notepad-plus.sourceforge.net/uk/site.htm)吗？我不太明白您所说的“缩小文件”是什么意思，但它确实支持通过插件通过 ftp 进行编辑。它也是标签式的，可以处理大文件，并让您在字符编码之间非常轻松地切换。看看这个。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T16:24:40.777

[Vim](http://www.vim.org/)符合这些分类，但如果您是大量基于鼠标的环境的粉丝，那么学习曲线可能会很陡峭。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-17T09:52:34.087

我强烈建议您查看[Notepad++](http://notepad-plus.sourceforge.net/)。它完全能够完成您提到的所有事情。用户界面可以使用一些改进 IMO，但根据您的规范，这个应用程序应该是要走的路。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-29T16:27:22.923

我相信 Notepadd++ 有一个 FTP[插件](http://www.rarst.net/software/notepadpp-ftp-plugin/)并且它有标签。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-29T16:33:58.367

[带有](http://textpad.com)相关[附加组件的文本板](http://textpad.com/add-ons/index.html)将为您分类

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-29T16:39:14.487

我建议你试试[Intype](http://intype.info/home/index.php)和[Komodo Edit](http://www.activestate.com/komodo_edit/)。

前者是另一个“TextMate for Windows”，也是我真正喜欢的一个。目前它非常准系统，有时不稳定，但为了快速编辑，我更喜欢它而不是记事本。

后者是 ActiveState 基于 Komodo IDE 的开源编辑器。重量稍重，但功能更丰富。如果你最终进入 IDE，Komodo 本身就非常好。

我是家里的 Mac 用户，所以在这两个编辑器中，我个人很欣赏没有重载的工具栏和通常非常干净的 GUI。Komodo 背后也有一个极好的社区，你可能很在意也可能不太在意。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-29T16:51:45.110

jEdit 使用它的 FTP 插件。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-01T07:19:24.847

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-01T07:28:42.827

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-29T16:25:04.363

我喜欢[VEdit](http://www.vedit.com/)。我不知道它是否允许您通过 FTP 进行编辑，但我不会感到惊讶。它有多个选项卡和几个开箱即用的宏，以及您也可以添加的宏。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-29T16:27:38.307

[记事本++](http://notepad-plus.sourceforge.net/uk/site.htm)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-29T16:30:23.743

[Ultraedit](http://en.wikipedia.org/wiki/Ultraedit)相当不错，它没有应有的轻量级，但它非常通用，非常稳定，有标签，可以通过 FTP 进行编辑。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-01-19T21:42:28.717

我知道有人已经提到过 TextPad，但我想进一步详细说明这个选择。有这么多最好的，我似乎无法选择一个，所以这里是一个列表：

块选择 - 在几何上选择一个矩形区域进行复制/粘贴操作 查找/替换选项中的正则表达式 - 您可以使用 def.*leppard.*hysteria 来查找匹配项，例如 def_leppard_-_hysteria 在文件中查找 - 非常棒，使用正则表达式并指定基本文件夹，在子文件夹中指定，指定文件名匹配，即 *.txt 和 viola！生成的报告会告诉您哪些文件以及带有可选文本的行。

其余的功能是标准的东西。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-06-05T21:51:39.740

如果 TextPad 4.7 兼容 Unicode，我永远不会放弃它，但现在它无法打开 30% 的文件而不损坏它们。

我终于找到了 Notepad++，它的速度和灵活性与 TextPad 相当（或超过），语法高亮也超过了它。

The only reason I've left Npp is that I'm working on a project that moves me between Mac and Windows, and I stumbled upon **Sublime Text 2** when looking for a Mac editor. ST2 is cross-platform — OS X, Win & Linux — and uses TextMate bundles, so the syntax highlighting (which has grown in significance to me over the years) is even better than Npp's.

I guess Sublime Text came out of the Mac ecosystem, which may be why it's not better-known on Windows. For my money, it's without question the best Windows text editor, hands down.

Of course, maybe in April 2009 when you asked your question, it wasn't. But since it is now, that's why I'm bothering to respond to a three-year-old query that lots of people have already answered.

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-02-24T20:46:06.743

I am using **Visual Studio Code (VSCode)** for directly **open, edit and save** files on server. you can install [Simple-ftp](https://marketplace.visualstudio.com/items?itemName=humy2833.ftp-simple) extension according [this](https://stackoverflow.com/questions/48217994/how-to-use-ftp-simple-in-vscode/49843578#49843578) then enjoy developing.

# image - 有人可以验证这是 IE8 内存泄漏吗？

> ID：803150
> 
> 赞同：4
> 
> 时间：2009-04-29T16:18:29.217
> 
> 标签：image, memory, internet-explorer-8, resize, memory-leaks

泄漏很容易产生。将下面的 HTML 放在名为“TestImage0.jpg”、“TestImage1.jpg”、...“TestImage9.jpg”的大图像列表旁边。每次单击页面时，页面都会泄漏内存（我使用 sIEve 进行测试）。如果resize css被移除，页面不会泄漏。谁能确认这是一个 IE8 问题，或者我的实验有缺陷？

**测试代码**

```
<html>
<head>
  <title>Memory Leak Testing</title>

  <script type="text/javascript">

    var count = 0;

    window.onload =
        function() {
          AppendImage();
          window.document.body.onclick = ReplaceImage;
        }

    var ReplaceImage = function() {
      window.document.body.removeChild(document.getElementById('MemTestObject' + count));
      count++;
      if (count > 9) {
        alert('No more images to load.');
      } else {    
        AppendImage();
      }
    }

    var AppendImage = function() {
      var imageObject = document.createElement('img');
      imageObject.id = 'MemTestObject' + count;
      imageObject.className = 'MemTestObject';
      imageObject.src = 'TestImage' + count + '.jpg';
      window.document.body.appendChild(imageObject);
    }

  </script>

  <style type="text/css">
    .MemTestObject {
      width: 140px;
      height: 178px;
    }
  </style>
</head>
<body>
  <h1>Memory Leak Testing</h1>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-03-07T10:31:42.423

问题是“有人可以验证这是 IE8 内存泄漏吗？” 答案只能是，是的，有人可以验证这一点。

如果你真的认为它是 IE 中的有效内存泄漏，首先确保它只是 IE。然后继续制定细节。一旦您可以准确描述如何重新创建此泄漏，您可以考虑向 MS 报告，但他们可能不会很快修复它。但无论如何都要传播消息，以便其他人可以避免陷阱

# sql-server - SQL Server 2008 中的 Lilian 日期函数

> ID：803153
> 
> 赞同：0
> 
> 时间：2009-04-29T16:19:02.193
> 
> 标签：sql-server, datetime, ibm-midrange

我正在使用 AS400 数据库和 SQLServer 2008。我想要一种将日期转换为 MM-DD-YYYY 格式并返回 T-SQL 的方法。有人知道吗？即使我将 AS400 中的数据转换为 SQLServer 2008，我相信我仍然需要相同的功能。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T16:27:03.987

我认为没有内置功能。您可以使用 datediff 函数转换为 lilian 日期格式吗？像这样的东西：

```
declare @testDate DateTime;
set @testDate = '2009-01-01';
declare @lilianDate int;
-- the datediff statement will do the conversion
set @lilianDate = DATEDIFF(day, '1582-10-14', @testDate);
print @lilianDate 
```

并且要回来，您可以以我认为的类似方式使用 dateadd() 函数。

如果您将在多个地方需要它，您可以制作 UDF 来包装此功能。

# c++ - 使用 IImageEncoder 将图像保存到文件

> ID：803161
> 
> 赞同：0
> 
> 时间：2009-04-29T16:19:47.997
> 
> 标签：c++, windows-mobile, image-processing

你有工作代码要分享吗？

我试图弄清楚如何将 IBitmapImage 图像保存到文件中。

我需要调整现有 .jpg 文件的大小，这似乎是 Windows Mobile 的唯一 API。我设法加载它，将其转换为 IImage -> IBitmapImage -> IBasicBitmapOps 并最终调整其大小，但我不知道如何将其正确保存到新文件中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T09:41:38.803

用于通过其参数`IBitmapImage::LockBits`访问图像数据。`BitmapData* lockedBitmapData`使用`BitmapData`准备位图文件信息标题，然后`BitmapData::Scan0`使用常规文件写入`::WriteFile`或更高级别的文件写入该文件和图像数据（如果使用）。

# hibernate - JPA EntityManger 在合并时执行数据库插入？

> ID：803166
> 
> 赞同：2
> 
> 时间：2009-04-29T16:21:28.210
> 
> 标签：hibernate, jpa, merge, persistence, entitymanager

我在下面使用带有 Hibernate 的 JPA，我无法让合并工作，但在我描述我在使用 JPA 时遇到的问题之前，让我列出我想要完成的工作，以防万一我的问题源于我的方法.

我有来自系统的数据，需要放入另一个系统。为此，我正在读取数据，然后基于该数据构造新的 ORM 对象，然后我想将 ORM 对象持久保存到数据库中。现在，当数据库为空时，程序可以正常运行，只需调用 em.persist(object) 即可。但是，我希望能够在数据库中有数据时运行此过程，添加新数据并根据需要更新旧数据，这就是我遇到问题的地方。

我做一个简单的检查，看看该项目是否已经存在于数据库中，如果没有找到，我坚持，如果记录存在，我尝试合并。失败并出现重复记录错误；

```
ERROR JDBCExceptionReporter - Violation of UNIQUE KEY constraint 'UK-SubStuff-StuffId-SubStuffNumber'. Cannot insert duplicate key in object 'SubStuff'. 
```

让我感到奇怪的是 em.merge() 调用正在尝试插入而不是更新（我通过 SQL 日志记录确认了这一点）。

```
Hibernate: insert into SubStuff (SubStuffNumber, StuffId, Name, TypeId) values (?, ?, ?, ?) 
```

我应该注意我正在使用级联成子对象的对象。失败发生在子对象上，这对我来说很有意义，因为我希望它首先尝试合并子对象。

以下是我的代码，请原谅粗略的状态，我已尝试在此处记录一些解决方法。

```
private void storeData(Collection<Stuff> Stuffs) {

    for (Stuff stuff : Stuffs) {
        //I think this first block can be safely ignored, as I am having no issues with it
        //  Left it in just in case someone more experianced then I sees the root of the issue here.
        Collection<SubStuff> subStuffs = stuff.getSubStuffCollection();
        for (SubStuff s : subStuffs) {
            //Persist SubStuff Type, which DOES NOT cascade,
            //  due to it not having an internal SubStuff collection
            Query q = em.createNamedQuery("SubStuffType.findByType");
            q.setParameter("type", f.getTypeId().getType());
            try {
                SubStuffType sst = (SubStuffType) q.getSingleResult();
                s.setTypeId(sst);
            } catch (NoResultException ex) {
                if (logger.isDebugEnabled()) logger.debug("SubStuff Type not found, persisting");
                em.persist(s.getTypeId());
            }
        }

        if (em.find(Stuff.class, stuff.getId()) == null) {
            //Persist on Stuffs will cascade to SubStuffs
            em.persist(stuff);
        } else {
            //  Failing to merge SubStuff, tries to insert duplicate
            //  Merge SubStuff first
            // The block below is my attempt to merge the SubStuff Collection before merging Stuff,
            //  it creates the same isuse as a straight merge of Stuff.
            Collection<SubStuff> mergedSubStuffs = new ArrayList<SubStuff>(SubStuffs.size());
            for (SubStuff s : SubStuffs) {
                Query q = em.createNamedQuery("SubStuff.findBySubStuffNumberStuffId");
                q.setParameter("SubStuffNumber", s.getSubStuffNumber());
                q.setParameter("StuffId", stuff.getId());
                try {
                    SubStuff subStuff = (SubStuff) q.getSingleResult();
        // -----> Merge fails, with an duplicate insert error
                    SubStuff mergedSubStuff = em.merge(s);
                    mergedSubStuffs.add(mergedSubStuff);
                } catch (NoResultException ex) {
                    throw ex;
                }
            }
            stuff.setSubStuffCollection(mergedSubStuffs);

        // -----> This will fails with same error as above, if I remove the attempt
            //  to merge the sub objects
            em.merge(stuff);
        }
    }
} 
```

如果有 JPA 经验的人可以帮助我，我将不胜感激。Hibernate 的 saveOrUpdate() 和 JPA 的 merge() 之间的差异显然让我感到困惑，但是尽管阅读了几篇关于 EnityManger 合并的文章，我仍然无法理解这里发生的事情。

谢谢你的时间。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T18:20:07.613

StackOverflow 的诅咒再次袭来。在解决这个问题大约一天后，我决定发布这个问题，在 20 分钟内我有一个灵光乍现的时刻并解决了它。部分原因是我已经澄清了我的想法，足以发布这个问题。在考虑哪些信息可能与该问题相关时，我意识到应该归咎于我的自动生成的密钥（或者我的正确，我在合并时愚蠢地不处理它们）。

我的问题是 SubStuff（最差的替代命名方案，对此感到抱歉）有一个自动生成的人工主键。所以在合并时我需要做；

```
SubStuff subStuff = (SubStuff) q.getSingleResult();
//++++++++
s.setId(subStuff.getId());
//++++++++

//The following code can be removed.
//--- SubStuff mergedSubStuff = em.merge(f);
//--- mergedSubStuffs.add(mergedSubStuff); 
```

这会将主键设置为数据库中已经存在的行，并且在初始测试时似乎工作正常。

对 merge 的调用可以简化为仅对 em.merge(stuff) 的调用，因为这将级联 substuff 对象，并且由于我们不再在该循环内进行合并，因此可以一起删除 mergesubstuff 集合。

感谢阅读我冗长的问题的任何人，希望我的问题将来对某人有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T16:31:16.737

您的问题在于以下几行：

```
Collection<SubStuff> mergedSubStuffs = new ArrayList<SubStuff>(SubStuffs.size());
...
stuff.setSubStuffCollection(mergedSubStuffs); 
```

JPA 会将新集合视为完整的新子实体集，并将始终照此插入它们。继续使用 Stuff 实体中的原始 SubStuff 集合，你会没事的。

# programming-languages - 我应该如何管理新语言设计中的副作用？

> ID：803167
> 
> 赞同：6
> 
> 时间：2009-04-29T16:21:45.870
> 
> 标签：programming-languages, haskell, side-effects

所以我目前正在研究一种新的编程语言。受并发编程和 Haskell 思想的启发，该语言的主要目标之一是管理副作用。或多或少，每个模块都需要指定它允许的副作用。所以，如果我在做游戏，图形模块就没有能力做 IO。输入模块将无法绘制到屏幕上。人工智能模块需要完全纯净。游戏的脚本和插件可以访问非常有限的 IO 子集来读取配置文件。等等。

然而，什么构成副作用并不明确。我正在寻找关于我可能想用我的语言考虑的主题的任何想法或建议。以下是我目前的想法。

一些副作用是明显的。无论是打印到用户控制台还是发射导弹，任何读取或写入用户拥有的文件或与外部硬件交互的操作都是副作用。

其他更微妙，这些是我真正感兴趣的。这些可能是获取随机数、获取系统时间、休眠线程、实现软件事务内存，甚至是非常基本的事情，例如分配内存。

与其他用于控制副作用的语言不同（看看你的 Haskell），我想将我的语言设计为务实和实用的。对副作用的限制应该有两个目的：

*   帮助分离关注点。（没有一个模块可以做所有事情）。
*   对应用程序中的每个模块进行沙箱处理。（任何模块都可以用作插件）

考虑到这一点，我应该如何处理“伪”副作用，如我上面提到的随机数和睡眠？还有什么我可能错过的？我可以通过哪些方式将内存使用和时间作为资源进行管理？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T23:15:05.143

如何描述和控制效果的问题目前正占据着一些编程语言最优秀的科学头脑，包括像哈佛大学的[Greg Morrisett这样的人。](http://www.eecs.harvard.edu/~greg/)据我所知，这一领域最雄心勃勃的开创性工作是 David Gifford 和 Pierre Jouvelot 在 1987 年开始使用 FX 编程语言完成的。[语言定义是在线的，但您可以通过阅读他们](http://en.scientificcommons.org/40908367)[1991 年的 POPL 论文](http://portal.acm.org/citation.cfm?id=99623&dl=GUIDE&coll=GUIDE&CFID=32592969&CFTOKEN=44122418)来更深入地了解这些想法.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-05T18:44:47.783

这是一个非常有趣的问题，它代表了我所经历的阶段之一，坦率地说，已经超越了。

我记得卡尔·休伊特在讨论他的演员形式主义时讨论过这个问题。他将其定义为一种给出响应的方法，该响应仅是其参数的函数，或者可以在不同时间给出不同的答案。

我说我超越了这一点，因为它使语言本身（或计算模型）成为主要主题，而不是它应该解决的问题。它基于这样一种思想，即语言应该有一个正式的底层模型，以便其属性易于验证。这很好，但仍然是一个遥远的目标，因为（据我所知）仍然没有一种语言可以*很容易*地证明像冒泡排序这样简单的事情的正确性，更不用说更复杂的系统了。

*以上是一个很好的目标，但我的方向是从信息论*的角度来看待信息系统。具体来说，假设一个系统从一个需求语料库开始（在纸上或在某人的脑海中），这些需求可以传输到程序编写机器（无论是自动的还是人工的）以生成用于工作实现的源代码。然后，随着需求发生变化，这些变化将作为实现源代码的增量变化进行处理。

那么问题是：源代码（以及编码它的语言）的哪些属性有助于这个过程？显然，这取决于要解决的问题的类型、输入和输出的信息类型（以及*何时*）、信息需要保留多长时间以及需要对其进行哪些处理。从这个可以确定该问题所需的语言的正式级别。

我意识到随着代码的格式越来越*类似于*需求，通过对源代码的需求的增量更改进行启动的过程变得更加容易，并且有一种很好的定量方法来衡量这种相似性，不是从表面上的相似性，而是在编辑操作方面。最能表达这一点的著名技术是领域特定语言 (DSL)。所以我开始意识到，我在通用语言中最看重的是创建专用语言的能力。

根据应用程序的不同，这种专用语言可能需要也可能不需要特定的形式特征，如函数符号、副作用控制、并行性等。实际上，制作专用语言有很多方法，从解析、解释, 编译，到现有语言中的宏，再到在现有语言中简单地定义类、变量和方法。一旦您声明了一个变量或子例程，您就会创建新的词汇表，从而创建一种新的语言来解决您的问题。事实上，从广义上讲，我认为如果在某种程度上不是语言设计师，你就无法解决*任何编程问题。*

祝你好运，我希望它为你开辟了新的视野。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T17:47:10.237

副作用是对世界上的任何事物产生任何影响，而不是返回一个值，即改变可能以某种方式在函数之外可见的事物。

纯函数既不依赖也不影响函数调用范围之外的任何可变状态，这意味着函数的输出仅取决于常量及其输入。这意味着如果您使用相同的参数调用一个函数两次，那么无论函数是如何编写的，都可以保证两次获得相同的结果。

如果您有一个函数修改已传递的变量，则该修改是副作用，因为它是函数的可见输出而不是返回值。一个非空操作的 void 函数必须有副作用，因为它没有其他影响世界的方式。

该函数可以有一个私有变量，该变量只对它读取和修改的函数可见，并且调用它仍然会产生改变函数未来行为方式的副作用。纯粹意味着对于任何类型的输出都只有一个通道：返回值。

可以纯粹生成随机数，但您必须手动传递随机种子。大多数随机函数都会保留一个私有种子值，该值在每次调用时都会更新，以便每次获得不同的随机数。这是使用[System.Random](http://haskell.org/ghc/docs/latest/html/libraries/random/System-Random.html)的 Haskell 代码段：

```
randomColor              :: StdGen -> (Color, Int, StdGen)
randomColor gen1         = (color, intensity, gen2)
 where (color, gen2)     = random gen1
       (intensity, gen3) = randomR (1, 100) gen2 
```

每个随机函数都返回随机值和一个带有新种子的新生成器（基于前一个）。为了每次都获得一个新值，必须传递新生成器链（gen1、gen2、gen3）。隐式生成器仅使用内部变量在后台存储 gen1.. 值。

手动执行此操作很痛苦，在 Haskell 中，您可以使用 state monad 使其更容易。你会想要实现一些不那么纯粹的东西，或者使用像 monads、箭头或唯一性值这样的工具来抽象它。

获取系统时间是不纯的，因为您每次询问的时间都可能不同。

睡眠更加模糊，因为睡眠不会影响函数的结果，并且您总是可以通过繁忙的循环延迟执行，这不会影响纯度。问题是睡觉是为了别的事情，这是一个副作用。

纯语言中的内存分配必须隐式发生，因为如果您可以进行任何类型的指针比较，显式分配和释放内存是副作用。否则，创建两个具有相同参数的新对象仍会产生不同的值，因为它们将具有不同的身份（例如，Java 的 == 运算符不相等）。

我知道我有点啰嗦，但希望这能解释什么是副作用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T16:24:47.843

认真看看[Clojure](http://clojure.org/)以及它们使用[软件事务内存、代理和原子](http://clojure.org/concurrent_programming)来控制副作用。

# winforms - 如何确保 winform 在 X 秒内关闭

> ID：803170
> 
> 赞同：0
> 
> 时间：2009-04-29T16:23:11.593
> 
> 标签：winforms, multithreading, timer

在我的 WinForms 应用程序中，我需要弹出一个小自定义对话框，该对话框会在屏幕上停留 X 秒，然后消失。因此，一旦经过适当的时间，我就使用 System.Threading.Timer 调用 _dialog.Close() 方法。这当然意味着我必须完成整个*“if InvokeRequired BeginInvoke”舞蹈*，这并不是一个真正的问题。

然而，问题是我的主线程可能已经关闭，天知道在调用 BeginInvoke 时会发生什么。它可能会在很长一段时间内无法关闭窗口。我不需要在几毫秒的通知中关闭窗口，但在一秒钟左右的时间内确实是必要的。

所以我的问题是 BeginInvoke 实际上是如何在主线程中工作的，我怎样才能绕过这个奇怪的限制？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T16:34:12.127

如果您的 UI 线程一次忙很多秒，那么：

*   您将无法关闭与该 UI 线程关联的窗口，而无需在代码中添加`Application.DoEvents`调用（一个坏主意）
*   在此期间，您的整个 UI 将无响应。用户将无法移动应用程序的任何窗口，并且如果用户将其他窗口拖到其顶部并再次关闭，则在 UI 等待重新绘制自身时，您最终会遇到丑陋的混乱。

为了简单起见，当然使用 a`System.Windows.Forms.Timer`而不是 a `System.Threading.Timer`，但更紧迫的是，考虑修复您的代码以避免拥有如此繁忙的 UI 线程。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-29T16:30:53.570

**更新：**结论似乎是利用`['BackgroundWorker]`( [http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx) ) 以及 a[`System.Windows.Forms.Timer`](http://msdn.microsoft.com/en-us/library/system.windows.forms.timer.aspx)将是最好的方法。

最好[`System.Windows.Forms.Timer`](http://msdn.microsoft.com/en-us/library/system.windows.forms.timer.aspx)用于此目的 - 这正是它设计的那种应用程序。在弹出表单中添加一个并在显示表单后立即启动它，然后在`Tick`事件中隐藏表单。此解决方案不会给您任何线程问题，因为计时器纯粹在 UI 线程上运行。

**编辑：**如果您想将逻辑移到弹出表单之外，那么我建议您只`Show`在表单代码中为该方法创建一个重载，该方法为其参数采用时间跨度并完成设置`Timers`间隔并启动它的工作.

**编辑 2：**如果您的主（UI）线程正在做太多工作，因此阻塞了消息泵并且不允许计时器触发，那么恐怕就是设计问题。您的 UI 线程不应*阻塞*超过几分之一秒。如果您需要做一些严肃的工作，请使用工作线程在后台进行。在这种情况下，因为您使用的是 WinForms，[`BackgroundWorker`](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)所以可能是最好的选择。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-29T16:32:49.150

创建一个专用线程并使用[Application.Run](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.run.aspx)创建和显示您的表单。这将在独立于主线程的第二个线程上启动消息泵。然后，即使主线程因任何原因被阻塞，它也可以在您想要的时候准确关闭。

Invoke 和 BeginInvoke 确实通过使用发布到该线程的窗口消息进入主线程，等待它被处理。因此，如果主线程的消息泵没有处理消息（例如忙），它就必须等待。在主线程中执行耗时的操作时，您可以通过调用 Application.DoEvents() 来缓解这个因素，但这并不是问题的真正解决方案。

**编辑：**来自一些初始屏幕代码的示例（表单不需要特殊代码或逻辑）：

```
 private void ShowSplashInSeparateMessageQueue() {
        Thread splash = new Thread(ShowSplashForm);
        splash.IsBackground = true;
        splash.Start();
    }

    private void ShowSplashForm() { // runs in a separate thread and message queue
        using (SplashForm splashForm = new SplashForm()) {
            splashForm.Load += AddDestroyTimer;
            Application.Run(splashForm);
        }
    }

    private void AddDestroyTimer(object sender, EventArgs e) {
        Form form = (Form)sender;
        System.Windows.Forms.Timer timer = new System.Windows.Forms.Timer(form.Container);
        timer.Tick += delegate { form.Close(); };
        timer.Interval = 5000;
        timer.Start();
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T16:32:04.050

Invoke 只是将委托放入要调用它的线程的消息队列中。您可以使用[Dispatcher](http://msdn.microsoft.com/de-de/library/system.windows.threading.dispatcher.aspx)类插入具有高优先级的委托，但如果线程正在做大量工作，则无法保证这将满足您的时间限制。

但这可能表明您在用户界面线程上做了很多工作。一秒钟不响应对用户来说是一种痛苦。因此，您可能会考虑将一些工作移出用户界面线程。

# testing - 如何为我们的 QA 部门制定测试计划？

> ID：803197
> 
> 赞同：14
> 
> 时间：2009-04-29T16:29:55.990
> 
> 标签：testing, qa, software-quality

我们目前正在为我们的测试部门准备最新项目的新版本。我们显然希望他们遵循一个彻底的计划来测试我们的软件，并确保在发布之前将错误传回给我们（开发团队）。

在创建此测试计划时，是否有任何好的工具或方法可以遵循？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-30T17:21:14.190

我在这个主题上找到的最好的书是[管理测试过程](https://rads.stackoverflow.com/amzn/click/com/0471223980)。作者介绍了如何创建测试计划。

根据我的经验，测试计划的基本内容如下：

*   功能描述
*   假设
*   相关文档
*   测试矩阵
*   有效测试
*   无效/错误条件测试
*   状态测试（行为基于对象/系统的各种状态）
*   压力测试
*   性能测试
*   性能指标
*   所需工具
*   环境问题（特定硬件、浏览器、操作系统等）

如果你能填写，团队应该能够很好地进行测试。

您需要做出的一个决定是测试团队的能力如何？我更喜欢将测试计划作为派生所有测试用例的算法。描述案例的种类，但不一定要详细描述每个案例。如果团队能力较差，您可能需要具体说明每个案例。

最后的警告。避免警笛声过于详细。无法保留在某人脑海中的计划不太可能被遵循。如果你的测试计划有 25 页长，你可能写的太多了。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-01T14:07:25.597

让我们不要忘记，永远没有足够的时间来做所有你想做的测试。因此，您的计划中的测试需要优先考虑。我经常发现按风险排序是最好的方法。

但是，通常测试计划将由 QA 小组与 dev 和 PM 协调制定。如果 QA 不是自己创建计划，听起来您的 QA 团队可以使用升级。至少，即使开发人员正在制定初始计划，QA 也应该提供一些输入，因为他们会有不同的 POV。对测试计划的关注越多，它就会越完整。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-08T08:46:09.773

嘿 pavliks，我不知道你想要它有多基本，但如果你想要一些简单且易于上手和运行的东西，请查看这篇文章：[编写系统测试计划](http://pm4web.blogspot.com/2008/07/writing-system-test-plan.html)

如果你很了解你的软件，安装了 MS Word，并且有良好的文档技能，那么你很高兴

就一个非常基本的通用错误记录协议而言，您可以看看：[像专业人士一样记录错误](http://pm4web.blogspot.com/2008/07/logging-bugs-like-pro.html)<- 这一切都是关于以最小的努力记录错误并捕获调查错误所需的基本信息

-- LM

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T16:33:54.110

尝试：[工件：测试计划](http://venus.imp.mx/hilario/personal/RUP2001.03.00.01/process/artifact/ar_tstpl.htm)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-31T15:05:08.420

正如 Tom E 所指出的，QA 绝对应该编写测试计划。他们应该与客户接触以了解需求，并与开发团队接触以了解实施，但归根结底，具有测试思维的团队需要拥有测试计划。

我能想到的唯一需要*为*QA 团队编写测试计划的情况是，当您有一个尚未熟悉您的产品的外包团队进行 QA 时。在这种情况下，我建议在设计和开发期间让团队中的一两个高级成员与你同处一室；它可以帮助他们更快地加快速度，并且可以将这些知识传递给团队的其他成员。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-07-31T14:49:21.707

单元和集成测试应该在代码级别发现很多问题，但它们对于从用户的角度测试系统的行为方式并不是很好。

一旦你知道一个特性应该做什么以及如何知道它是否有效，就可以使用[TestComplete](http://www.automatedqa.com/products/testcomplete/)、[SmarteScript 之](http://www.smartesoft.com/products_smartescript.php)类的东西自动化该测试（显然是有意义的） 。这些测试易于运行和自动化，因此它们将始终始终如一地运行，而不必担心任何东西会从裂缝中溜走。

# java - 我正在面试一个使用 Spring Framework 的 j2EE 职位；帮我刷

> ID：803201
> 
> 赞同：1
> 
> 时间：2009-04-29T16:30:54.397
> 
> 标签：java, spring, jakarta-ee

下周我将面试一份使用 Spring Framework 的 J2EE 工作。我在最近的几个职位上使用了 Spring，但我可能想复习一下。

我应该记住什么，以及应该查看哪些网站来复习？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T17:39:46.090

我不会询问框架本身，但在哪些情况下可以方便地应用其功能，例如何时使用 LoadTimeWeaving 方面或是否使用 DI 域对象。

我将 spring 视为解决问题的工具，我希望其他人告诉我他将如何应用它，何时以及最重要的是在哪种情况下他*不会*使用它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T18:15:39.683

我认为复习 Spring 框架技能的好方法是涵盖 DZone 的 RefCards 中给出的概念。它们是简明的 PDF 格式文档。

*   [弹簧配置参考卡片](http://refcardz.dzone.com/refcardz/spring-configuration)
*   [Spring 注释参考卡](http://refcardz.dzone.com/refcardz/spring-annotations)
*   [弹簧和弹性配置](http://refcardz.dzone.com/refcardz/flex-spring-integration)

希望这可以帮助！！

和平之火

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T17:32:18.227

您可能想查看 SpringSource 正在处理的一些较新的项目和更新。

*   Spring 3.0（关键的新特性是基于 MVC 的 RESTful 支持和新的表达式语言）
*   Spring dm 服务器（基于 OSGi 的服务器）
*   Spring tc Server（预配置的tomcat）
*   Spring AMS（资产集中管理和监控）
*   Spring Security（现在支持表达式语言，这使得声明性安全界限更加丰富）
*   Spring 集成（实现了企业集成模式中的一些模式：网关、拆分器、聚合器、转换器等。）
*   圣杯

刚刚在 SpringOne 上宣布：

*   Roo - 具有类似于 grails 的命令行选项的构建助手，用于创建域类、控制器和视图，但用于 vanilla java 而不是 groovy。
*   SpringSource 工具套件现已免费！

# syntax - 在 Scala 中使用类变量作为常量

> ID：803206
> 
> 赞同：22
> 
> 时间：2009-04-29T16:32:17.873
> 
> 标签：syntax, scala

我正在努力学习 Scala——来自 C++ 背景。我正在尝试为我正在一起破解的任务跟踪应用程序编写一个小班，以帮助我学习如何编写 Scala 代码。

这似乎应该很简单，但由于某种原因它让我无法理解：

```
package com.catenacci.tts

class Task(val ID:Int, val Description:String) {
 val EmptyID = 0
 val EmptyDescription = "No Description"

 def this() = this(EmptyID,EmptyDescription)
 def this(ID:Int)={
   this(ID,EmptyDescription)
 }
 def this(Description:String)={
   this(EmptyID,Description)
 }
} 
```

我试图提供三个构造函数：任务（ID，描述），任务（ID），任务（描述）。在后两种情况下，如果调用者未提供其中一个值，我想将这些值初始化为常量值。我希望能够在课堂之外检查这一点以进行单元测试。所以我想加入两个公共 vals 可以让我在课外进行检查，以确保我的状态符合我的预期。

但是，由于某种原因，此代码将无法编译。我收到以下错误：

```
error: not found: value EmptyID 
```

和

```
error: not found: value EmptyDescription 
```

那么我错过了什么？我正在研究“Scala 编程”，所以如果这个问题有一个简单的答案，请给我页码。我不介意阅读第 60 页和第 62 页上的代码，但我不明白为什么此代码会失败。

我猜这与这些是构造函数方法有关，并且可能两个 val 直到构造函数结束时才被初始化。如果是这种情况，有什么方法可以达到我想要的效果吗？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-04-29T17:26:08.307

您可以在伴随对象中定义常量：

```
object Task { 
 val EmptyID = 0
 val EmptyDescription = "No Description"
} 
```

然后将它们引用为 Task.EmptyID 和 Task.EmptyDescription。

我认为 Scala 2.8 支持默认值。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-29T22:35:16.707

答案见德语。发生这种情况是因为构造函数在*技术上*是静态范围的一部分。换句话说，构造函数无法访问任何实例成员，因为该实例尚未创建。任何“类成员”实际上都是实例成员，这就是问题中的代码不起作用的原因。Germán 的回答通过将两个相关值移动到伴随对象中来解决这个问题，这有效地使它们成为`Task`类的静态成员（不是真的，但你可以这样想）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-03T16:40:40.283

在“Scala 编程”中，请参阅第 6.7 节，其中解释了构造函数调用的链接。主构造函数被描述为“类的单一入口点”。

# tsql - 如何将 sp_executesql 结果转换为变量？

> ID：803211
> 
> 赞同：191
> 
> 时间：2009-04-29T16:33:17.997
> 
> 标签：tsql, dynamic-sql

我有一条需要执行的动态 SQL，然后我需要将结果存储到一个变量中。

我知道我可以使用`sp_executesql`，但找不到有关如何执行此操作的明确示例。

* * *

## 回答 #1

> 赞同：281
> 
> 时间：2009-04-29T16:40:10.320

如果你有 OUTPUT 参数，你可以做

```
DECLARE @retval int   
DECLARE @sSQL nvarchar(500);
DECLARE @ParmDefinition nvarchar(500);

DECLARE @tablename nvarchar(50)  
SELECT @tablename = N'products'  

SELECT @sSQL = N'SELECT @retvalOUT = MAX(ID) FROM ' + @tablename;  
SET @ParmDefinition = N'@retvalOUT int OUTPUT';

EXEC sp_executesql @sSQL, @ParmDefinition, @retvalOUT=@retval OUTPUT;

SELECT @retval; 
```

但是如果你不这样做，并且不能修改 SP：

```
-- Assuming that your SP return 1 value
create table #temptable (ID int null)
insert into #temptable exec mysp 'Value1', 'Value2'
select * from #temptable 
```

不漂亮，但有效。

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2009-10-20T13:35:03.660

```
DECLARE @vi INT
DECLARE @vQuery NVARCHAR(1000)

SET @vQuery = N'SELECT @vi= COUNT(*) FROM <TableName>'

EXEC SP_EXECUTESQL 
        @Query  = @vQuery
      , @Params = N'@vi INT OUTPUT'
      , @vi = @vi OUTPUT

SELECT @vi 
```

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2011-04-07T08:23:23.657

```
DECLARE @tab AS TABLE (col1 VARCHAR(10), col2 varchar(10)) 
INSERT into @tab EXECUTE  sp_executesql N'
SELECT 1 AS col1, 2 AS col2
UNION ALL
SELECT 1 AS col1, 2 AS col2
UNION ALL
SELECT 1 AS col1, 2 AS col2'

SELECT * FROM @tab 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-06-19T20:35:51.797

返回值通常不用于“返回”结果，而是返回成功 (0) 或错误号 (1-65K)。以上似乎都表明 sp_executesql 没有返回值，这是不正确的。sp_executesql 将返回 0 表示成功，任何其他数字表示失败。

在下面，@i 将返回 2727

```
DECLARE @s NVARCHAR(500)
DECLARE @i INT;
SET @s = 'USE [Blah]; UPDATE STATISTICS [dbo].[TableName] [NonExistantStatisticsName];';
EXEC @i = sys.sp_executesql @s
SELECT @i AS 'Blah' 
```

SSMS 将显示此消息 2727，级别 11，状态 1，第 1 行找不到索引“NonExistantStaticsName”。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-05-24T14:47:23.323

```
Declare @variable int
Exec @variable = proc_name 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-06-09T10:41:31.780

如果要返回超过 1 个值，请使用：

```
DECLARE @sqlstatement2      NVARCHAR(MAX);
DECLARE @retText            NVARCHAR(MAX);  
DECLARE @ParmDefinition     NVARCHAR(MAX);
DECLARE @retIndex           INT = 0;

SELECT @sqlstatement = 'SELECT @retIndexOUT=column1 @retTextOUT=column2 FROM XXX WHERE bla bla';

SET @ParmDefinition = N'@retIndexOUT INT OUTPUT, @retTextOUT NVARCHAR(MAX) OUTPUT';

exec sp_executesql @sqlstatement, @ParmDefinition, @retIndexOUT=@retIndex OUTPUT, @retTextOUT=@retText OUTPUT; 
```

返回值在@retIndex 和@retText

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-11-21T11:06:49.477

```
DECLARE @ValueTable TABLE
    (
    Value VARCHAR (100)
    )

SELECT @sql = N'SELECT SRS_SizeSetDetails.'+@COLUMN_NAME+' FROM SRS_SizeSetDetails WHERE FSizeID = '''+@FSizeID+''' AND SRS_SizeSetID = '''+@SRS_SizeSetID+'''';

INSERT INTO @ValueTable
EXEC sp_executesql @sql;

SET @Value='';

SET @Value = (SELECT TOP 1  Value FROM @ValueTable)

DELETE FROM @ValueTable 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-12-18T18:35:46.690

这是你可以尝试的东西

```
DECLARE  @SqlStatement  NVARCHAR(MAX) = ''
       ,@result     XML
       ,@DatabaseName  VARCHAR(100)
       ,@SchemaName    VARCHAR(10)
       ,@ObjectName    VARCHAR(200);

SELECT   @DatabaseName = 'some database'
       ,@SchemaName   = 'some schema'
       ,@ObjectName   = 'some object (Table/View)'

SET @SqlStatement = '
                    SELECT @result = CONVERT(XML,
                                            STUFF( ( SELECT *
                                                     FROM 
                                                       (
                                                          SELECT TOP(100) 
                                                          * 
                                                          FROM ' + QUOTENAME(@DatabaseName) +'.'+ QUOTENAME(@SchemaName) +'.' + QUOTENAME(@ObjectName) + '
                                                       ) AS A1 
                                                    FOR XML PATH(''row''), ELEMENTS, ROOT(''recordset'')
                                                 ), 1, 0, '''')
                                       )
                ';

EXEC sp_executesql @SqlStatement,N'@result XML OUTPUT', @result = @result OUTPUT;

SELECT DISTINCT
    QUOTENAME(r.value('fn:local-name(.)', 'VARCHAR(200)')) AS ColumnName
FROM @result.nodes('//recordset/*/*') AS records(r)
ORDER BY ColumnName 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-08-29T08:01:55.933

这是很久以前的事了，所以不确定是否仍然需要，但是您可以使用@@ROWCOUNT 变量来查看有多少行受到之前的 sql 语句的影响。

例如，当您构建动态更新语句并使用 exec 运行它时，这很有帮助。@@ROWCOUNT 将显示更新了多少行。

[这是定义](http://technet.microsoft.com/en-us/library/ms187316(v=sql.105).aspx)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-10-25T21:30:38.273

这对我有用：

```
DECLARE @SQL NVARCHAR(4000)

DECLARE @tbl Table (
    Id int,
    Account varchar(50),
    Amount int
) 

-- Lots of code to Create my dynamic sql statement

insert into @tbl EXEC sp_executesql @SQL

select * from @tbl 
```

# c# - 使用 MVVM 管理多个选择

> ID：803216
> 
> 赞同：60
> 
> 时间：2009-04-29T16:35:10.660
> 
> 标签：c#, .net, data-binding, mvvm

在我学习 MVVM 的过程中，我对 WPF 和 ViewModel 模式有了一些基本的了解。在提供列表并且对单个选定项目感兴趣时，我正在使用以下抽象。

```
public ObservableCollection<OrderViewModel> Orders { get; private set; }
public ICollectionView OrdersView
{
    get
    {
        if( _ordersView == null )
            _ordersView = CollectionViewSource.GetDefaultView( Orders );
        return _ordersView;
    }
}
private ICollectionView _ordersView;

public OrderViewModel CurrentOrder 
{ 
    get { return OrdersView.CurrentItem as OrderViewModel; } 
    set { OrdersView.MoveCurrentTo( value ); } 
} 
```

然后我可以将 OrdersView 与支持排序和过滤一起绑定到 WPF 中的列表：

```
<ListView ItemsSource="{Binding Path=OrdersView}" 
          IsSynchronizedWithCurrentItem="True"> 
```

这对于单选视图非常有效。但我还想在视图中支持多项选择，并将模型绑定到选定项目列表。

如何将 ListView.SelectedItems 绑定到 ViewModel 上的支持者属性？

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2009-04-29T16:44:25.893

`IsSelected`向您的子 ViewModel添加一个属性（`OrderViewModel`在您的情况下）：

```
public bool IsSelected { get; set; } 
```

将容器上的选定属性绑定到此（在本例中为 ListBox）：

```
<ListBox.ItemContainerStyle>
    <Style TargetType="{x:Type ListBoxItem}">
        <Setter Property="IsSelected" Value="{Binding Mode=TwoWay, Path=IsSelected}"/>
    </Style>
</ListBox.ItemContainerStyle> 
```

`IsSelected`更新以匹配容器上的相应字段。

您可以通过执行以下操作在视图模型中获取选定的子项：

```
public IEnumerable<OrderViewModel> SelectedOrders
{
    get { return Orders.Where(o => o.IsSelected); }
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2014-09-22T02:34:11.007

我可以向你保证：`SelectedItems`确实可以作为 XAML 绑定`CommandParameter`

这个常见问题有一个简单的解决方案；要使其工作，您必须遵循以下**所有**规则：

1.  按照[Ed Ball 的建议](https://stackoverflow.com/a/336258/378115)，在您的 XAML 命令数据绑定中，在属性`CommandParameter`之前**定义**`Command`属性。*这是一个非常耗时的错误*。

    ![在此处输入图像描述](https://i.stack.imgur.com/Ik0eJ.png)

2.  确保您`ICommand`的 's`CanExecute`和`Execute`方法具有类型参数`object`。这样，您可以防止在数据绑定的类型与您的方法的参数类型不匹配时发生的*静默强制转换*异常：`CommandParameter``Command`

    ```
    private bool OnDeleteSelectedItemsCanExecute(object SelectedItems)  
    {
         // Your code goes here
    }

    private bool OnDeleteSelectedItemsExecute(object SelectedItems)  
    {
        // Your code goes here
    } 
    ```

例如，您可以将`ListView`/`ListBox`的`SelectedItems`属性发送到您的`ICommand`方法或`ListView`/`ListBox`本身。太好了，不是吗？

我希望这可以防止有人花费我所做的大量时间来弄清楚如何将`SelectedItems`其作为`CanExecute`参数接收。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-05-02T18:02:21.023

可以尝试创建附加属性。

这样做可以避免`IsSelected`为您绑定的每个列表添加属性。我已经完成了它`ListBox`，但可以修改它以在列表视图中使用。

```
<ListBox SelectionMode="Multiple"
         local:ListBoxMultipleSelection.SelectedItems="{Binding SelectedItems}" > 
```

* * *

更多信息：[WPF – 绑定 ListBox SelectedItems – 附加属性 VS 样式](http://blogs.microsoft.co.il/miziel/2014/05/02/wpf-binding-listbox-selecteditems-attached-property-vs-style/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-22T23:26:41.440

如果您使用的是 MVVM-LIGHT，则可以使用此模式：

[https://galasoft.ch/posts/2010/05/handling-datagrid-selecteditems-in-an-mvvm-friendly-manner](https://galasoft.ch/posts/2010/05/handling-datagrid-selecteditems-in-an-mvvm-friendly-manner)

不是特别优雅，但看起来至少应该是可靠的

# svn - Visual Source Safe 2005 中源存储库的限制是什么

> ID：803217
> 
> 赞同：0
> 
> 时间：2009-04-29T16:35:11.283
> 
> 标签：svn, visual-sourcesafe, perforce

我们正在考虑将 VSS 用于模拟开发项目，因此我们将拥有代码和相当数量的二进制文件（可能数 GB 或更大）。我在网上看到了大约 4-5 GB 的 VSS 限制的参考资料，但我找不到任何明确的规格。

我的第一选择是 SVN 或 Perforce，但团队中有一些人非常喜欢 VSS -

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T16:46:19.087

这里的问题是团队中有些人喜欢 VSS。请将他们引导至此帖子：

[.Net 项目的 VSS 或 SVN？](https://stackoverflow.com/questions/690766/vss-or-svn-for-a-net-project/690847#690847)

如果这不破坏他们的精神，最简单的做法是：

1.  通过 VPN 连接在远程计算机上检查您的项目
2.  编辑一堆文件。
3.  开始提交
4.  在提交过程中断开您的 VPN 连接

即时 VSS 数据库损坏！然后让喜欢VSS的人修复它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T16:52:36.093

鉴于 Microsoft 对 VSS 的更新历史（即对实际工具的最小更新），我将继续遵循[Microsoft VSS 最佳实践](http://msdn.microsoft.com/en-us/library/bb509342(VS.80).aspx)，即最大 DB 为 3-5GB。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-01T09:43:38.003

在我们将团队迁移到 ClearCase 之前，我对 VSS 的体验是 6 GB 肯定会破坏该工具。

我认为微软推荐的限制是 2 GB，据说它可以支持的最大值是 4 左右（参见 Malachi 的答案中的链接）。

我绝对知道其中一个 VSS DB 在这里增长到 6 GB，并且由于其庞大的大小而损坏得无法修复。

# c - 为什么我的实例变量表现得如此奇怪？我做对了吗？

> ID：803218
> 
> 赞同：0
> 
> 时间：2009-04-29T16:35:13.047
> 
> 标签：c, objective-c, pointers

为了尝试一些指针的东西，我在现有项目中创建了一个实例变量。它只是这样声明的：

```
@interface PointerFun : NSObject {
    NSString* test;
} 
```

我没有@property 编译器指令，没有@synthesize，所以没有getter 和setter。只是为了测试。

然后我有一个方法，我用指针和这个实例变量来尝试一些事情。我真正想检查的是，当我为该实例变量分配一个 NSString 对象（或任何对象）时会发生什么，并且在分配对象之后，将另一个对象分配给我分配给实例 var 的那个指针。我认为它也会改变实例变量中的对象。

所以这是我的代码：

```
NSString *str1 = [NSString stringWithCString:"one"];
NSString *str2 = [NSString stringWithCString:"two"];

test = str2; // assign directly to instance variable (bad thing, just for testing!)
str2 = str1; // now lets be really mean and change the object from that pointer!!

NSLog(@"test: %x, %@", test, test); // test: 52cb10, two
NSLog(@"str1: %x, %@", str1, str1); // str1: 52ca60, one 
NSLog(@"str2: %x, %@", str2, str2); // str2: 52ca60, one 
```

如您所见，实例变量一直指向早在 str2 后面的 NSString 对象。所以当我把str1赋值给str2的时候，我把str1的值赋值给了str2，也就是一个内存地址。所以我让两个指针具有相同的值，对吧？

但是当我将 str2 的值分配给 test 时，test 接管了 str2 的值，当时它是“两个”对象的内存地址。因此，即使我在赋值后更改了指针 str2 的值，它也不会影响实例变量的值。因为这是一个指向 NSString 对象的指针，所以它的行为与 str1 或 str2 相同。没有区别，因为它是一个实例变量。它只是一个变量，或者更好：它只是一个指针。我做对了吗？唷 ;) ...希望如此！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T16:42:03.060

这三个变量实际上是指针（test、str1 和 str2），并且您创建了 2 个对象：“one”和“two”。

当你这样做时：

```
test = str2; 
```

您正在为对象“二”制作测试点，当您这样做时：

```
str2 = str1; 
```

您正在使 str2 指向对象“one”，这根本不影响测试。

# flash - FLV 播放 - 缩放和平滑与高分辨率？

> ID：803219
> 
> 赞同：1
> 
> 时间：2009-04-29T16:35:15.307
> 
> 标签：flash, actionscript, video, flv, playback

我正在构建一个带有大型视频的 Flash 站点 (as3)，这些视频充当从一个部分到另一个部分的过渡。视频无法缩放；为了适应使用大型显示器的用户，我们计划播放高清视频并仅向用户显示画面的中心（取决于他们的屏幕尺寸）。也就是说，将有一个大约 1024x768 的中心区域，我们假设所有用户都可以查看大部分信息，但我们希望大屏幕的用户能够查看所有信息和它周围的整个场景。

我的问题是：从性能的角度来看，将视频编码为高清 FLV 并在不修改的情况下播放，或者以合理的分辨率对其进行编码，然后将其缩放为高清（平滑）是否更有意义？在飞行中？加载时间不是问题，因为所有剪辑都只有几秒钟长，并且会在播放之前完全预加载，因此瓶颈很可能在播放方面。

非常感谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T17:37:56.997

我认为这取决于您的客户想要什么 - 他们的目标受众是拥有更多现代计算机的人吗？然后去高清。如果网站尽可能扩大到最广泛的市场对客户来说很重要，那么就扩大规模，但要明白你会失去质量。我还建议实施带宽检测：[http](http://www.adobe.com/livedocs/flashmediaserver/3.0/hpdocs/help.html?content=00000072.html) ://www.adobe.com/livedocs/flashmediaserver/3.0/hpdocs/help.html?content=00000072.html ，尽管我猜这不是在播放方面。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-16T10:59:02.963

从我所经历的情况来看，使用平滑缩放较小尺寸的视频（因此它仍然会保持一定的质量）比仅播放高清质量的电影对 cpu 的负担要重得多。

另外，如果我没记错的话，我认为缩放 50% > 100% 或 25% > 100% 比缩放 52% -> 100% 更“容易”（即，如果它被 2 或 4 等分）但是播放原始尺寸仍然比缩放更少（而且看起来也更好）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-16T22:26:49.383

为什么不为不同的屏幕尺寸加载不同的视频？

设置您的 Flash 电影以拉伸到窗口尺寸（使用），然后使用和`stage.scaleMode = StageScaleMode.NO_SCALE`获取舞台尺寸。`stage.stageWidth``stage.stageHeight`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-31T15:40:21.603

最终，我们需要以 1680 x 1050 的分辨率播放视频，这对于大多数观众的计算机来说太高分辨率了，无法进行原生播放。我们最终做的是使用 On2 的 VP6-S 编解码器的 720p 预设对高清视频进行编码，并缩放到所需的分辨率。即使整个视频可见（对于屏幕较小的用户，视频是居中的，而不是缩放到他们的屏幕尺寸，所以他们只能看到视频的一小部分） ）。

无论如何，我们的情况是相当不寻常的，但希望这些信息对以后的其他人有所帮助。

# c# - C# 反射：在成员字段上查找属性

> ID：803221
> 
> 赞同：17
> 
> 时间：2009-04-29T16:36:24.680
> 
> 标签：c#, reflection, attributes, field

我可能会错误地问这个问题，但是您可以/如何在其自身的类中找到字段...例如...

```
public class HtmlPart {
  public void Render() {
    //this.GetType().GetCustomAttributes(typeof(OptionalAttribute), false);
  }
}

public class HtmlForm {
  private HtmlPart _FirstPart = new HtmlPart();      
  [Optional] //<-- how do I find that?
  private HtmlPart _SecondPart = new HtmlPart();
} 
```

或者也许我只是做错了......我怎样才能调用一个方法，然后检查应用于自身的属性？

**另外，为了这个问题**- 我只是好奇是否可以在*不知道/访问父类的情况下找到属性信息！*

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-29T17:08:58.783

如果我正确理解你的问题，我认为你试图做的事情是不可能的......

在该`Render`方法中，您希望获得应用于对象的可能属性。属性属于领域，`_SecondPart`女巫属于类`HtmlForm`。

为此，您必须将调用对象传递给`Render`方法：

```
 public class HtmlPart {
        public void Render(object obj) {
            FieldInfo[] infos = obj.GetType().GetFields(BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance);

            foreach (var fi in infos)
            {
                if (fi.GetValue(obj) == this && fi.IsDefined(typeof(OptionalAttribute), true))
                    Console.WriteLine("Optional is Defined");
            }
        }
    } 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-29T16:46:13.970

这是给定单个对象的示例，如何查找该对象上的任何公共或私有字段是否具有特定属性：

```
var type = typeof(MyObject);
foreach (var field in type.GetFields(BindingFlags.Public |
             BindingFlags.NonPublic | BindingFlags.Instance))
{
    if (field.IsDefined(typeof(ObsoleteAttribute), true))
    {
        Console.WriteLine(field.Name);
    }

} 
```

对于您问题的第二部分，您可以使用以下方法检查属性是否在当前方法上被定义：

```
MethodInfo.GetCurrentMethod().IsDefined(typeof(ObsoleteAttribute)); 
```

**编辑**

要回答您的编辑，可以在不知道实际类型的情况下进行。以下函数采用类型参数并返回具有给定属性的所有字段。某个地方的某个人要么知道您要搜索的类型，要么将拥有您要搜索的类型的实例。

没有那个，你必须按照 Jon Skeet 所说的那样枚举程序集中的所有对象。

```
 public List<FieldInfo> FindFields(Type type, Type attribute)
    {
        var fields = new List<FieldInfo>();
        foreach (var field in type.GetFields(BindingFlags.Public |
                           BindingFlags.NonPublic |
                           BindingFlags.Instance))
        {
            if (field.IsDefined(attribute, true))
            {
                fields.Add(field);
            }

        }
        return fields;
    } 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-29T16:43:31.793

您可以使用 查找类中的字段，并且可以使用或`Type.GetFields`查找应用于字段的属性- 但如果您需要查找特定类型的所有字段，则必须：`MemberInfo.GetCustomAttributes``IsDefined`

*   遍历您要搜索的所有程序集
*   迭代每个程序集中的所有类型
*   遍历每种类型中的所有字段
*   检查每个字段的属性是否存在

现在，如果您真的想找出“是否将特定属性应用于其值是对 'this' 对象的引用的字段”，那就更难了——因为您必须了解系统中的每个对象. 您还应该记住，可能有*两个*字段都具有相同的值，即引用相同的对象。在这种情况下，该对象是否算作“可选”？

基本上，如果对象应该有一个属性（例如是否可选），那么它必须是对象本身的属性，而不是包含该属性的字段。

可能是我误解了你想要做的事情，但我*怀疑*这要么不可行，要么至少不是一个好主意。你能在这里解释一下大局吗？你真正想用这个属性实现什么？

# iis - 导出 IIS 配置

> ID：803224
> 
> 赞同：2
> 
> 时间：2009-04-29T16:38:02.727
> 
> 标签：iis

视窗 2003/IIS 6...

我在网站上有一个虚拟目录，该目录与同一站点上另一个虚拟目录所需的配置密切相关。由于我们有多个 dev/staging/test/prod 环境，我希望能够导出一个虚拟目录的值并在同一台机器（具有不同的名称/源目录）或另一台机器上快速启动一个机器（可能具有相同的名称/源目录）。

可以这样做吗？我看到您可以通过 IIS 管理器导出配置，但它似乎嵌入了很多密钥，我不确定是否可以直接将其导入到同一/不同机器上的单独实体中，或者它是否是仅用于备份，以防原始文件损坏并需要恢复。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-01T00:27:22.463

您可能想查看随 IIS 6 安装的示例 VBScript 文件。在我的系统上，它们位于 C:\Windows\System32

两个似乎与您的问题特别相关：

iisvdir.vbs - 允许在本地或远程列出、创建和删除虚拟目录。iiscnfg.vbs - 允许导出配置以复制到另一台机器。

这些都不是你想要的，但在我看来它们可以用作示例代码来帮助你到达你想要的地方。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T16:40:46.293

您看过[IIS6 迁移工具](http://www.microsoft.com/downloads/details.aspx?familyid=2aefc3e4-ce97-4f25-ace6-127f933a6cd2&displaylang=en)了吗？它可能会满足您的需求。

# c# - 我什么时候应该使用双精度而不是十进制？

> ID：803225
> 
> 赞同：285
> 
> 时间：2009-04-29T16:38:21.710
> 
> 标签：c#, types, floating-point, double, decimal

我可以说出使用`double`(or `float`) 而不是 的三个优点`decimal`：

1.  使用更少的内存。
2.  更快，因为处理器本身支持浮点数学运算。
3.  可以表示更大范围的数字。

但这些优势似乎只适用于计算密集型操作，例如建模软件中的那些。当然，当需要精度时，不应该使用双精度数，例如财务计算。那么有任何实际的理由选择`double`（或`float`）而不是`decimal`“正常”应用程序吗？

编辑补充：感谢所有伟大的回应，我从他们那里学到了。

还有一个问题：一些人指出双精度数可以更准确地表示实数。当声明时，我认为它们通常也更准确地代表它们。但是，当执行浮点运算时，准确度可能会降低（有时会显着降低），这是一个真实的说法吗？

* * *

## 回答 #1

> 赞同：316
> 
> 时间：2009-04-29T16:46:19.633

我认为您已经很好地总结了这些优势。但是，您错过了一点。该[`decimal`](http://msdn.microsoft.com/en-us/library/system.decimal.aspx)类型仅在表示以*10 为基数*的数字（例如，用于货币/金融计算的数字）时更准确。一般来说，该 [`double`](http://msdn.microsoft.com/en-us/library/system.double.aspx)类型将提供至少一样高的精度（如果我错了，请有人纠正我），并且对于任意实数来说绝对是更快的速度。`double`简单的结论是：在考虑使用哪个时，除非您需要提供的`base 10`准确性，否则请始终使用`decimal`。

**编辑：**

关于您关于运算后浮点数准确性降低的附加问题，这是一个稍微微妙的问题。事实上，每次操作执行后，精度（我在这里可以互换地使用该术语来表示精度）会稳步下降。这是由于两个原因：

1.  某些数字（最明显的是小数）不能真正以浮点形式表示的事实
2.  出现舍入错误，就像您手动进行计算一样。然而，这些错误是否严重到足以值得深思熟虑，很大程度上取决于上下文（您正在执行多少操作）。

在所有情况下，如果要比较理论上应该相等的两个浮点数（但使用不同的计算得出），则需要允许一定程度的容差（变化多少，但通常很小） .

有关可能引入准确性错误的特定情况的更详细概述，请参阅[Wikipedia 文章](http://en.wikipedia.org/wiki/Floating_point#Accuracy_problems)的准确性部分。最后，如果您想在机器级别对浮点数/运算进行认真深入（和数学）的讨论，请尝试阅读经常被引用的文章[*What Every Computer Scientist Should Know About Floating-Point Arithmetic*](https://docs.oracle.com/cd/E19957-01/800-7895/800-7895.pdf)。

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2009-04-29T16:44:37.437

您似乎很了解使用浮点类型的好处。我倾向于在所有情况下都设计小数，并依靠分析器让我知道小数操作是否会导致瓶颈或减速。在这些情况下，我将“向下转换”为 double 或 float，但仅在内部进行，并通过限制正在执行的数学运算中的有效数字的数量来仔细尝试管理精度损失。

通常，如果您的值是瞬态的（未重用），则可以安全地使用浮点类型。浮点类型的真正问题是以下三种情况。

1.  您正在聚合浮点值（在这种情况下，精度误差复合）
2.  您基于浮点值构建值（例如在递归算法中）
3.  您正在使用大量有效数字进行数学运算（例如，`123456789.1 * .000000000000000987654321`）

**编辑**

根据[C# decimals 的参考文档](http://msdn.microsoft.com/en-us/library/364x0z75(VS.80).aspx)：

> **decimal**关键字表示 128 位数据类型。与浮点类型相比，十进制类型的精度更高，范围更小，适用于金融和货币计算。

因此，为了澄清我的上述陈述：

> 我倾向于在所有情况下都设计小数，并依靠分析器让我知道小数操作是否会导致瓶颈或减速。

我只在小数有利的行业工作过。如果您正在研究物理或图形引擎，那么设计浮点类型（float 或 double）可能更有益。

Decimal 不是无限精确的（不可能在原始数据类型中表示非整数的无限精度），但它比 double 精确得多：

*   十进制 = 28-29 位有效数字
*   双 = 15-16 位有效数字
*   float = 7 位有效数字

**编辑 2**

针对[Konrad Rudolph](https://stackoverflow.com/users/1968/konrad-rudolph)的评论，第 1 项（上）绝对正确。不精确的聚合确实是复合的。有关示例，请参见以下代码：

```
private const float THREE_FIFTHS = 3f / 5f;
private const int ONE_MILLION = 1000000;

public static void Main(string[] args)
{
    Console.WriteLine("Three Fifths: {0}", THREE_FIFTHS.ToString("F10"));
    float asSingle = 0f;
    double asDouble = 0d;
    decimal asDecimal = 0M;

    for (int i = 0; i < ONE_MILLION; i++)
    {
        asSingle += THREE_FIFTHS;
        asDouble += THREE_FIFTHS;
        asDecimal += (decimal) THREE_FIFTHS;
    }
    Console.WriteLine("Six Hundred Thousand: {0:F10}", THREE_FIFTHS * ONE_MILLION);
    Console.WriteLine("Single: {0}", asSingle.ToString("F10"));
    Console.WriteLine("Double: {0}", asDouble.ToString("F10"));
    Console.WriteLine("Decimal: {0}", asDecimal.ToString("F10"));
    Console.ReadLine();
} 
```

这将输出以下内容：

```
Three Fifths: 0.6000000000
Six Hundred Thousand: 600000.0000000000
Single: 599093.4000000000
Double: 599999.9999886850
Decimal: 600000.0000000000 
```

正如你所看到的，即使我们从同一个源常量添加，double 的结果也不太精确（尽管可能会正确舍入），float 的精确度要低得多，以至于它已经减少到只有两位有效数字。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-04-29T17:26:43.390

正如其他人所建议的那样，对以 10 为底的值使用十进制，例如财务计算。

但是对于任意计算值，双精度通常更准确。

例如，如果您想计算投资组合中每一行的权重，请使用 double，因为结果加起来更接近 100%。

在以下示例中，doubleResult 比 decimalResult 更接近 1：

```
// Add one third + one third + one third with decimal
decimal decimalValue = 1M / 3M;
decimal decimalResult = decimalValue + decimalValue + decimalValue;
// Add one third + one third + one third with double
double doubleValue = 1D / 3D;
double doubleResult = doubleValue + doubleValue + doubleValue; 
```

所以再次以投资组合为例：

*   投资组合中每一行的市场价值都是货币价值，最好用十进制表示。

*   投资组合中每条线的权重（= 市场价值 / SUM（市场价值））通常更好地表示为双倍。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-29T16:42:46.617

当您不需要精度时，请使用双精度或浮点数，例如，在我编写的平台游戏中，我使用浮点数来存储玩家速度。显然我在这里不需要超精度，因为我最终会舍入到 Int 以在屏幕上绘图。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-01-30T23:26:40.140

在某些会计中，考虑使用整数类型代替或结合使用的可能性。例如，假设您操作的规则要求每个计算结果至少保留 6 位小数，最终结果将四舍五入到最接近的一分钱。

100 美元的 1/6 的计算得出 16.66666666666666 美元...，因此工作表中的值将是 16.666667 美元。double 和 decimal 都应该将结果精确到小数点后 6 位。但是，我们可以通过将结果作为整数 16666667 向前推进来避免任何累积误差。每个后续计算都可以以相同的精度进行并类似地向前推进。继续这个例子，我计算得克萨斯州的销售税（16666667 * .0825 = 1375000）。将两者相加（这是一个简短的工作表）1666667 + 1375000 = 18041667。将小数点移回给我们 18.041667，即 18.04 美元。

虽然这个简短的示例不会产生使用双精度或小数的累积误差，但很容易展示简单计算双精度或小数并结转会累积显着误差的情况。如果您操作的规则要求小数位数有限，则将每个值存储为整数，乘以 10^（所需的小数位数），然后除以 10^（所需的小数位数）以获得实际值值将避免任何累积误差。

在不出现小数便士的情况下（例如，自动售货机），根本没有理由使用非整数类型。只需将其视为数便士，而不是美元。我看过代码，其中每个计算只涉及整便士，但使用 double 会导致错误！仅整数数学消除了该问题。所以我非常规的答案是，如果可能的话，放弃双精度和小数。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-29T16:47:34.920

如果您需要与其他语言或平台进行二进制互操作，那么您可能需要使用标准化的 float 或 double。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-11-07T12:14:08.550

# 取决于你需要它做什么。

因为 float 和 double 是二进制数据类型，所以在轮数中存在***一些***困难和错误，例如 double 会将 0.1 舍入到 0.100000001490116，double 也会将 1 / 3 舍入到 0.33333334326441。简而言之，并非所有实数都具有双精度类型的准确表示

幸运的是，C# 还支持所谓的十进制浮点运算，其中数字通过十进制数字系统而不是二进制系统表示。因此，十进制浮点算术在存储和处理浮点数时**不会失去准确性。**这使得它非常适合需要高精度的计算。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-03-22T16:33:15.683

注意：这篇文章基于来自[http://csharpindepth.com/Articles/General/Decimal.aspx](http://csharpindepth.com/Articles/General/Decimal.aspx)的十进制类型功能的信息以及我自己对这意味着什么的解释。我将假设 Double 是正常的 IEEE 双精度。

注2：本帖中最小和最大指的是数字的大小。

“十进制”的优点。

*   “十进制”可以精确地表示可以写为（足够短的）十进制分数的数字，而双精度不能。这在财务分类账中很重要，在类似的情况下，结果与人类进行计算所给出的结果完全匹配很重要。
*   "decimal" 的尾数比 "double" 大得多。这意味着对于其归一化范围内的值，“十进制”将具有比双精度高得多的精度。

小数的缺点

*   它会慢得多（我没有基准，但我猜至少一个数量级可能更多），十进制不会从任何硬件加速中受益，并且它的算术将需要相对昂贵的 10 次方乘法/除法（这比乘法和除以 2) 的幂要昂贵得多，以在加法/减法之前匹配指数并在乘法/除法之后将指数带回范围内。
*   十进制将比双倍更早溢出。十进制只能表示最大为 ±2 ^(96) -1 的数字。通过比较 double 可以表示高达接近 ±2 ^(1024的数字)
*   小数会提前下溢。以十进制表示的最小数字是 ±10 ^(-28)。通过比较 double 可以表示低至 2 ^(-149)（大约 10 ^(-45)）的值，如果支持 subnromal 数字，如果不支持，则可以表示 2 ^(-126)（大约 10 ^(-38)）。
*   decimal 占用的内存是 double 的两倍。

我的观点是，你应该默认使用“十进制”来进行金钱工作和其他精确匹配人工计算很重要的情况，并且在其余时间你应该使用 double 作为默认选择。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-29T16:56:59.187

如果您重视性能而不是正确性，请使用浮点数。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-29T17:16:30.480

选择应用程序的功能类型。如果您需要财务分析中的精确度，那么您已经回答了您的问题。但是，如果您的应用程序可以通过估计来解决，那么您可以加倍。

您的申请是否需要快速计算，还是他会一直在世界范围内为您提供答案？这实际上取决于应用程序的类型。

图形饿了吗？float 或 double 就足够了。金融数据分析，流星撞击行星的精度？那些需要一点精度:)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-03-17T21:38:30.983

Decimal 具有更宽的字节，CPU 原生支持 double。十进制是以 10 为底的，因此在计算小数时会发生十进制到双精度的转换。

```
For accounting - decimal
For finance - double
For heavy computation - double 
```

请记住 .NET CLR 仅支持 Math.Pow(double,double)。不支持小数。

.NET 框架 4

```
[SecuritySafeCritical]
public static extern double Pow(double x, double y); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-08-17T21:55:09.793

如果该符号比十进制显示短，则默认情况下双精度值将序列化为科学记数法。（例如 .00000003 将是 3e-8）十进制值永远不会序列化为科学计数法。在序列化以供外部方使用时，这可能是一个考虑因素。

# c# - C# NetworkAvailabilitychangedEvent

> ID：803227
> 
> 赞同：0
> 
> 时间：2009-04-29T16:38:47.607
> 
> 标签：c#, networking

对比 2008

我正在开发一个必须检测客户端是否有网络连接的应用程序。即 LAN 电缆已插入或无线已打开。我一直在使用下面的代码。

我正在使用 NetworkAvailabilitychangedEvent 在他们的无线关闭或电缆被拔出时触发一个事件。但是，这仅在用户只有 3 个连接（LAN、无线和环回）时才有效。

Microsoft：“当至少一个网络接口被标记为“启动”并且不是隧道或环回接口时，该网络可用”。

但是，某些客户端的连接数超过 3 个。一个客户端有蓝牙连接，而另一个客户端有一些 VMWare 连接。在这些客户端上，它未能触发事件。

无论如何我可以忽略所有这些我不感兴趣的连接，而只是在 LAN 和无线上收听？

非常感谢您的任何建议，

```
private void Form1_Load(object sender, EventArgs e)
    {
        NetworkChange.NetworkAvailabilityChanged += new NetworkAvailabilityChangedEventHandler(OnNetworkChangedEvent);  
    }

    private void OnNetworkChangedEvent(object sender, NetworkAvailabilityEventArgs e)
    {
        bool available = e.IsAvailable;

        NetworkInterface[] networkConnections = NetworkInterface.GetAllNetworkInterfaces();

        foreach (NetworkInterface ni in networkConnections)
        {
            if (ni.Name == "Local Area Connection")
            {
                if (ni.OperationalStatus == OperationalStatus.Down)
                {
                    Console.WriteLine("LAN disconnected: " + ni.Description);
                }
            }
            else if (ni.Name == "Wireless Network Connection")
            {
                if (ni.OperationalStatus == OperationalStatus.Down)
                {
                    Console.WriteLine("Wireless disconnected: " + ni.Description);
                }
            }
        }
    } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T18:45:47.240

也许您需要实现某种轮询代理，该代理在单独的线程上运行并定期尝试联系在远程服务器（或服务器？）上监听的东西。

当它失败时（或者可能是当预设数量的连接尝试失败时）然后触发一个事件。当它从失败成功状态进入时也是如此。

您的应用程序将订阅这些事件并采取相应的行动。

当然，这可能不适合您的场景..

# sql - 无法访问 SQL Server 2005 表中的单行

> ID：803228
> 
> 赞同：4
> 
> 时间：2009-04-29T16:38:55.923
> 
> 标签：sql, sql-server-2005

我有一个小（200 行/400kb）表，有 4 列 - nvarchar(MAX)、nvarchar(50) 和两个整数。我有一个特定行的问题，我可以在其中选择和更新 int 字段，但是当我尝试选择或更新 nvarchar 字段时，查询会无限期地运行（至少在我取消前 45 分钟）。我也无法删除这一行，甚至无法截断表（同样，查询无限期运行）。

有任何想法吗？其中一个 int 字段有一个主键，但没有外键。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T16:52:13.770

你确定那行没有被锁定？打开一个新连接，运行您的选择查询，记下窗口顶部 2000 / 2005 和底部 2008 管理工作室的 SPID。在另一个窗口运行`sp_who2`。从运行记录的查询中查找 spid。

如果您不关心未提交的数据，或者只想测试该行，请执行以下操作：

```
select * from table with (nolock) where key = 'mykey' 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T17:10:48.233

看起来你有一个未提交的事务锁定了一些东西。

您可以通过活动监视器释放它们。它位于您正在查看的数据库的管理文件夹中。

展开它，右键单击活动监视器，然后选择查看进程。您可以右键单击进程并在那里杀死它们。

这并不总是最好的解决方案，尤其是对于生产数据库。您通常想弄清楚事务未提交的原因，然后手动回滚或提交它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T17:13:45.090

如果 DBCC CHECKDB 没有像 Thirster42 所说的那样有帮助

我只会将问题行以外的数据复制到newTable中并删除oldTable ...

我也会检查你的 TempDB 的大小。

检查 Profiler，也许触发了触发器？

请参阅执行计划以了解任何异常情况。

# windows - 目前最流行的Windows版本是什么

> ID：803232
> 
> 赞同：4
> 
> 时间：2009-04-29T16:39:27.153
> 
> 标签：windows, windows-vista, windows-xp

有没有人有目前正在使用的 Windows 版本的大致百分比细分？

例如，60% 使用 Vista，30% 使用 XP 等。

我们目前正在构建一个安装程序，我们需要知道什么会给我们最大的覆盖范围。我们特别感兴趣的是 .NET 版本的普遍性，因为我们的应用程序依赖于 .NET 3.5 SP1。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-29T16:42:40.517

查看[w3schools 浏览器统计信息](http://www.w3schools.com/browsers/browsers_os.asp)。

编辑：

由于很多人似乎对此感兴趣，我将统计数据绘制为图表：

[替代文字 http://lanfear.c0la.se/~emil/osmarketshare.jpg](http://lanfear.c0la.se/~emil/osmarketshare.jpg)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T16:46:33.377

以下是我网站的一些统计信息

```
XP                  71.81%
Vista               21.67%
Server 2003         5.28%    
NT                  0.97%
2000                0.28% 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T16:40:49.037

我不知道确切的数字，但我很确定 XP 是最常用的。

这篇维基百科文章给出了一些数字，并声称 Windows XP 占据了 63.53% 的市场份额。

[http://en.wikipedia.org/wiki/Comparison_of_Windows_versions](http://en.wikipedia.org/wiki/Comparison_of_Windows_versions)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T16:41:20.440

XP**绝对**是最常用的，因为 Vista 出现了一些人们不喜欢的问题，但很快就会出现 Windows 7，它是 Vista 的改进版本。因此，这可能会产生巨大的变化。

[Windows 市场份额](http://www.computerworld.com/action/article.do?command=viewArticleBasic&articleId=9121938)详细介绍了您可以查看的一些数字。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-29T18:04:03.800

Valve 发布了他们的调查统计数据。有助于操作系统版本，但不是您的 .NET 3.5 问题。

[http://store.steampowered.com/hwsurvey](http://store.steampowered.com/hwsurvey)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-29T17:39:22.393

我自己的经验，我在 1000 多人的公司工作 2 年换了 3 份工作。他们都使用XP。从来没有听说过升级到 Vista 计划。

# asp.net-mvc - asp.net mvc 路由的 path_prefix

> ID：803237
> 
> 赞同：0
> 
> 时间：2009-04-29T16:40:45.077
> 
> 标签：asp.net-mvc, routing

我阅读[了这篇](http://guides.rubyonrails.org/routing.html)关于如何在 ruby​​ on rails 中为路由添加前缀的文章。我希望能够用 asp.net mvc 做同样的事情

所以我希望能够定义如下路线：

```
/photographers/1/photos/2   //photo 2 of photographer with id 1
/photographers/1/photos     //all of photographer with id 1 
```

有小费吗 ？

**编辑：**

*“photographers/{id}/photos/{photoID}”* - 似乎做得很好，但我怎么能支持

```
RedirectToAction<PhotosController>(x => x.Add()); 
```

我想重定向到：/photographers/1/photos/add

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T17:06:48.070

像这样定义您的路线：

```
routes.MapRoute(
    "Photographers",
    "photographers/{id}/photos/{photoID}",
    new { controller = "Photographers", action = "Photo", photoID = null }); 
```

然后像这样定义你的控制器动作：

```
public ActionResult Photo(int id, int? photoID)
{
    // If photoID is not null, show just that photo.
    // Otherwise, show all photographs.
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T16:47:44.327

您可以在路由表中使用[正则表达式路由](http://iridescence.no/post/Defining-Routes-using-Regular-Expressions-in-ASPNET-MVC.aspx)或使用[通配符，](http://weblogs.asp.net/scottgu/archive/2008/05/27/asp-net-mvc-preview-3-release.aspx)以便 {id*} 与`/1/photos/2`摄影师默认控制器匹配，解析字符串并重定向到适当的操作。

另请查看有关嵌套资源的[这篇文章。](http://blog.enginefour.com/blog/post/Nested-Resources-In-ASPNET-MVC.aspx)

```
RouteTable.Routes.Add(
        new Route { Url = "events/[eventId]/tickets/[action]/[id]", 
                    Defaults = new { controller = "Tickets", 
                                     action = "List", id = (string)null }, 
                    RouteHandler = typeof(MvcRouteHandler) }); 
```

# c# - 了解 C# 中的事件和事件处理程序

> ID：803242
> 
> 赞同：356
> 
> 时间：2009-04-29T16:41:23.607
> 
> 标签：c#, .net, events, event-handling

我了解事件的目的，尤其是在创建用户界面的上下文中。我认为这是创建事件的原型：

```
public void EventName(object sender, EventArgs e); 
```

事件处理程序做什么，为什么需要它们，以及如何创建一个？

* * *

## 回答 #1

> 赞同：707
> 
> 时间：2009-04-29T16:59:49.913

要了解事件处理程序，您需要了解[委托](https://msdn.microsoft.com/en-us/library/ms173171.aspx)。在[C#](http://en.wikipedia.org/wiki/C_Sharp_%28programming_language%29)中，您可以将委托视为方法的指针（或引用）。这很有用，因为指针可以作为值传递。

委托的核心概念是它的签名或形状。即 (1) 返回类型和 (2) 输入参数。例如，如果我们创建一个委托`void MyDelegate(object sender, EventArgs e)`，它只能指向返回的方法`void`，并接受一个`object`和`EventArgs`。有点像方孔和方钉。所以我们说这些方法与委托具有相同的签名或形状。

所以知道如何创建对方法的引用，让我们考虑事件的目的：我们希望在系统其他地方发生某些事情时执行一些代码 - 或“处理事件”。为此，我们为要执行的代码创建特定的方法。事件和要执行的方法之间的粘合剂是委托。事件必须在内部存储一个指针“列表”，指向事件引发时要调用的方法。* 当然，为了能够调用方法，我们需要知道要传递给它的参数！我们使用委托作为事件和所有将被调用的特定方法之间的“契约”。

因此，默认值`EventHandler`（以及许多类似的）表示*方法的特定形状*（同样，void/object-EventArgs）。当您声明一个事件时，您通过指定一个委托来说明该事件将调用*哪种形式的方法*(EventHandler)：

```
//This delegate can be used to point to methods
//which return void and take a string.
public delegate void MyEventHandler(string foo);

//This event can cause any method which conforms
//to MyEventHandler to be called.
public event MyEventHandler SomethingHappened;

//Here is some code I want to be executed
//when SomethingHappened fires.
void HandleSomethingHappened(string foo)
{
    //Do some stuff
}

//I am creating a delegate (pointer) to HandleSomethingHappened
//and adding it to SomethingHappened's list of "Event Handlers".
myObj.SomethingHappened += new MyEventHandler(HandleSomethingHappened);

//To raise the event within a method.
SomethingHappened("bar"); 
```

（*这是 .NET 中事件的关键，它揭开了“魔法”的面纱——在幕后，事件实际上只是一个具有相同“形状”的方法的列表。该列表存储在事件所在的位置。当事件被“引发”，它实际上只是“通过这个方法列表并调用每个方法，使用这些值作为参数”。分配一个事件处理程序只是将您的方法添加到这个方法列表中的一种更漂亮、更简单的方法被称为）。

* * *

## 回答 #2

> 赞同：111
> 
> 时间：2009-04-29T17:45:36.853

C# 知道两个术语，`delegate`和`event`. 让我们从第一个开始。

## 代表

A`delegate`是对方法的引用。就像您可以创建对实例的引用一样：

```
MyClass instance = myFactory.GetInstance(); 
```

您可以使用委托来创建对方法的引用：

```
Action myMethod = myFactory.GetInstance; 
```

现在您有了对方法的引用，您可以通过引用调用该方法：

```
MyClass instance = myMethod(); 
```

但你为什么要？你也可以`myFactory.GetInstance()`直接打电话。在这种情况下，您可以。但是，有很多情况需要考虑您不希望应用程序的其余部分了解`myFactory`或直接调用的位置`myFactory.GetInstance()`。

一个明显的问题是，如果您希望能够从一个中心位置替换`myFactory.GetInstance()`成`myOfflineFakeFactory.GetInstance()`（又名**工厂方法模式**）。

### 工厂方法模式

所以，如果你有一个`TheOtherClass`类并且它需要使用`myFactory.GetInstance()`，这就是没有委托的代码的样子（你需要让`TheOtherClass`知道你的类型`myFactory`）：

```
TheOtherClass toc;
//...
toc.SetFactory(myFactory);

class TheOtherClass
{
   public void SetFactory(MyFactory factory)
   {
      // set here
   }

} 
```

如果您使用委托，则不必公开我的工厂的类型：

```
TheOtherClass toc;
//...
Action factoryMethod = myFactory.GetInstance;
toc.SetFactoryMethod(factoryMethod);

class TheOtherClass
{
   public void SetFactoryMethod(Action factoryMethod)
   {
      // set here
   }

} 
```

因此，您可以将委托给某个其他类以供使用，而无需将您的类型暴露给它们。你唯一暴露的是你的方法的签名（你有多少参数等等）。

“我的方法的签名”，我以前在哪里听过？哦，是的，接口！！！接口描述了整个类的签名。将委托视为仅描述一种方法的签名！

接口和委托之间的另一个大区别是，当您编写类时，您不必对 C# 说“此方法实现了该类型的委托”。对于接口，您确实需要说“此类实现了该类型的接口”。

此外，委托引用可以（有一些限制，见下文）引用多个方法（称为`MulticastDelegate`）。这意味着当您调用委托时，将执行多个显式附加的方法。一个对象引用总是只能引用一个对象。

a 的限制`MulticastDelegate`是（方法/委托）签名不应有任何返回值 ( `void`) 和关键字`out`，并且`ref`不用于签名中。显然，您不能调用两个返回数字的方法并期望它们返回相同的数字。一旦签名符合要求，委托人将自动成为`MulticastDelegate`.

## 事件

事件只是属性（如 get;set; 实例字段的属性），它们公开对来自其他对象的委托的订阅。但是，这些属性不支持 get;set;。相反，它们支持添加；消除;

所以你可以拥有：

```
 Action myField;

    public event Action MyProperty
    {
        add { myField += value; }
        remove { myField -= value; }
    } 
```

## UI 中的使用（WinForms、WPF、UWP 等）

所以，现在我们知道委托是对方法的引用，我们可以有一个事件让世界知道他们可以给我们他们的方法来从我们的委托中引用，我们是一个 UI 按钮，那么：我们可以询问任何对我是否被点击感兴趣的人向我们注册他们的方法（通过我们公开的事件）。我们可以使用所有提供给我们的方法，并由我们的委托引用它们。然后，我们将等待并等待......直到用户来并单击该按钮，然后我们将有足够的理由调用委托。因为委托引用了所有提供给我们的方法，所以所有这些方法都将被调用。我们不知道这些方法做了什么，也不知道哪个类实现了这些方法。我们所关心的是有人对我们被点击感兴趣，

## 爪哇

像 Java 这样的语言没有委托。他们使用接口代替。他们这样做的方式是让任何对“我们被点击”感兴趣的人实现某个接口（使用我们可以调用的某个方法），然后给我们实现该接口的整个实例。我们保留了实现此接口的所有对象的列表，并且可以在单击时调用它们的“我们可以调用的特定方法”。

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2009-04-29T16:46:57.823

这实际上是一个事件处理程序的声明——一个在事件被触发时将被调用的方法。要创建一个事件，您可以编写如下内容：

```
public class Foo
{
    public event EventHandler MyEvent;
} 
```

然后你可以像这样订阅事件：

```
Foo foo = new Foo();
foo.MyEvent += new EventHandler(this.OnMyEvent); 
```

OnMyEvent() 定义如下：

```
private void OnMyEvent(object sender, EventArgs e)
{
    MessageBox.Show("MyEvent fired!");
} 
```

每当`Foo`触发时，都会调用`MyEvent`您的处理程序。`OnMyEvent`

您不必总是使用的实例`EventArgs`作为第二个参数。如果要包含其他信息，可以使用派生自`EventArgs`（`EventArgs`按约定是基类）的类。例如，如果您查看在`Control`WinForms 或`FrameworkElement`WPF 中定义的一些事件，您可以看到将附加信息传递给事件处理程序的事件示例。

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2009-04-29T17:58:11.707

这是一个可能有帮助的代码示例：

```
using System;
using System.Collections.Generic;
using System.Text;

namespace Event_Example
{
  // First we have to define a delegate that acts as a signature for the
  // function that is ultimately called when the event is triggered.
  // You will notice that the second parameter is of MyEventArgs type.
  // This object will contain information about the triggered event.

  public delegate void MyEventHandler(object source, MyEventArgs e);

  // This is a class which describes the event to the class that receives it.
  // An EventArgs class must always derive from System.EventArgs.

  public class MyEventArgs : EventArgs
  {
    private string EventInfo;

    public MyEventArgs(string Text) {
      EventInfo = Text;
    }

    public string GetInfo() {
      return EventInfo;
    }
  }

  // This next class is the one which contains an event and triggers it
  // once an action is performed. For example, lets trigger this event
  // once a variable is incremented over a particular value. Notice the
  // event uses the MyEventHandler delegate to create a signature
  // for the called function.

  public class MyClass
  {
    public event MyEventHandler OnMaximum;

    private int i;
    private int Maximum = 10;

    public int MyValue
    {
      get { return i; }
      set
      {
        if(value <= Maximum) {
          i = value;
        }
        else 
        {
          // To make sure we only trigger the event if a handler is present
          // we check the event to make sure it's not null.
          if(OnMaximum != null) {
            OnMaximum(this, new MyEventArgs("You've entered " +
              value.ToString() +
              ", but the maximum is " +
              Maximum.ToString()));
          }
        }
      }
    }
  }

  class Program
  {
    // This is the actual method that will be assigned to the event handler
    // within the above class. This is where we perform an action once the
    // event has been triggered.

    static void MaximumReached(object source, MyEventArgs e) {
      Console.WriteLine(e.GetInfo());
    }

    static void Main(string[] args) {
      // Now lets test the event contained in the above class.
      MyClass MyObject = new MyClass();
      MyObject.OnMaximum += new MyEventHandler(MaximumReached);
      for(int x = 0; x <= 15; x++) {
        MyObject.MyValue = x;
      }
      Console.ReadLine();
    }
  }
} 
```

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2013-08-27T01:32:07.943

只是为了在此处添加现有的出色答案-以已接受的代码为基础，该代码使用`delegate void MyEventHandler(string foo)`...

因为编译器知道*SomethingHappened*事件的委托类型，所以：

```
myObj.SomethingHappened += HandleSomethingHappened; 
```

完全等同于：

```
myObj.SomethingHappened += new MyEventHandler(HandleSomethingHappened); 
```

处理程序也可以像这样*注销*`-=`：

```
// -= removes the handler from the event's list of "listeners":
myObj.SomethingHappened -= HandleSomethingHappened; 
```

为了完整起见，可以像这样引发事件，仅在拥有该事件的类中：

```
//Firing the event is done by simply providing the arguments to the event:
var handler = SomethingHappened; // thread-local copy of the event
if (handler != null) // the event is null if there are no listeners!
{
    handler("Hi there!");
} 
```

需要处理程序的线程本地副本以确保调用是线程安全的 - 否则线程可以在我们检查是否为事件后立即取消注册事件的最后一个处理程序，我们将在那里`null`获得“乐趣” `NullReferenceException`.

* * *

C# 6 为这种模式引入了一个很好的简写。它使用空传播运算符。

```
SomethingHappened?.Invoke("Hi there!"); 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2014-08-06T07:09:17.113

我对事件的理解是；

**代表：**

保存对要执行的方法/方法的引用的变量。这使得传递变量之类的方法成为可能。

**创建和调用事件的步骤：**

1.  该事件是委托的一个实例

2.  由于事件是委托的实例，那么我们必须首先定义委托。

3.  分配触发事件时要执行的方法（*调用委托*）

4.  触发事件（*调用委托*）

**例子：**

```
using System;

namespace test{
    class MyTestApp{
        //The Event Handler declaration
        public delegate void EventHandler();

        //The Event declaration
        public event EventHandler MyHandler;

        //The method to call
        public void Hello(){
            Console.WriteLine("Hello World of events!");
        }

        public static void Main(){
            MyTestApp TestApp = new MyTestApp();

            //Assign the method to be called when the event is fired
            TestApp.MyHandler = new EventHandler(TestApp.Hello);

            //Firing the event
            if (TestApp.MyHandler != null){
                TestApp.MyHandler();
            }
        }

    }   

} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-07-29T14:43:21.553

```
//This delegate can be used to point to methods
//which return void and take a string.
public delegate void MyDelegate(string foo);

//This event can cause any method which conforms
//to MyEventHandler to be called.
public event MyDelegate MyEvent;

//Here is some code I want to be executed
//when SomethingHappened fires.
void MyEventHandler(string foo)
{
    //Do some stuff
}

//I am creating a delegate (pointer) to HandleSomethingHappened
//and adding it to SomethingHappened's list of "Event Handlers".
myObj.MyEvent += new MyDelegate (MyEventHandler); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-09-30T00:47:45.603

发布者：事件发生的地方。发布者应指定该类正在使用哪个委托并生成必要的参数，将这些参数及其自身传递给委托。

订阅者：响应发生的位置。订阅者应指定响应事件的方法。这些方法应该采用与委托相同类型的参数。然后订阅者将此方法添加到发布者的委托中。

因此，当事件在发布者中发生时，委托会收到一些事件参数（数据等），但发布者不知道所有这些数据会发生什么。订阅者可以在自己的类中创建方法来响应发布者类中的事件，以便订阅者可以响应发布者的事件。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-02-16T14:28:23.953

我最近做了一个如何在 c# 中使用事件的示例，并将其发布在我的博客上。我试图用一个非常简单的例子来尽可能地清楚。如果它可以帮助任何人，这里是：[http ://www.konsfik.com/using-events-in-csharp/](http://www.konsfik.com/using-events-in-csharp/)

它包括描述和源代码（有很多注释），它主要关注事件和事件处理程序的正确（类似模板）使用。

一些关键点是：

*   事件就像“代表的子类型”，只是受到更多限制（以一种好的方式）。事实上，事件的声明总是包含一个委托（EventHandlers 是委托的一种）。

*   事件处理程序是特定类型的委托（您可以将它们视为模板），它强制用户创建具有特定“签名”的事件。签名的格式为：(object sender, EventArgs eventarguments)。

*   您可以创建自己的 EventArgs 子类，以包含事件需要传达的任何类型的信息。使用事件时不必使用 EventHandlers。您可以完全跳过它们并使用您自己的委托代替它们。

*   使用事件和委托之间的一个关键区别是，事件只能从声明它们的类中调用，即使它们可能被声明为公共。这是一个非常重要的区别，因为它允许您的事件被公开，以便它们“连接”到外部方法，同时保护它们免受“外部滥用”。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-04-09T15:50:46.723

**另一件事要知道，在某些情况下，当您需要****低级别的耦合**时，您必须使用委托/事件！

如果你想**在应用程序的多个地方使用一个组件**，你需要制作一个低耦合的组件，并且特定的**不关心的逻辑**必须委托**在**你的组件之外！这可确保您拥有一个解耦的系统和更简洁的代码。

在**SOLID**原则中，这是“ **D** ”，（**依赖**倒置原则）。

也称为“ **IoC** ”，**控制反转**。

您可以使用**事件、委托和 DI**（依赖注入）来制作“ **IoC** ” 。

 **访问子类中的方法很容易。但更难从子类访问父类中的方法。您必须将父引用传递给子代！（或使用带接口的 DI）

**代表/事件允许我们在没有参考的情况下从孩子与父母交流！**

[![在此处输入图像描述](https://i.stack.imgur.com/jE9IQ.png)](https://i.stack.imgur.com/jE9IQ.png)

在上图中，**我没有使用 Delegate/Event**并且父组件 B**必须有**父组件 A 的引用才能执行 A 方法中不关心的业务逻辑。（高度耦合）

使用这种方法，我将不得不放置使用组件 B 的所有组件的所有引用！:(

[![在此处输入图像描述](https://i.stack.imgur.com/i5KGP.png)](https://i.stack.imgur.com/i5KGP.png)

在上图中，**我使用了委托/事件**，组件 B 不必知道 A。（低耦合度）

您可以**在应用程序的任何地方**使用组件 B ！

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-10-16T21:03:57.633

我同意 KE50，除了我将“事件”关键字视为“ActionCollection”的别名，因为事件包含要执行的操作集合（即委托）。

```
using System;

namespace test{

class MyTestApp{
    //The Event Handler declaration
    public delegate void EventAction();

    //The Event Action Collection 
    //Equivalent to 
    //  public List<EventAction> EventActions=new List<EventAction>();
    //        
    public event EventAction EventActions;

    //An Action
    public void Hello(){
        Console.WriteLine("Hello World of events!");
    }
    //Another Action
    public void Goodbye(){
        Console.WriteLine("Goodbye Cruel World of events!");
    }

    public static void Main(){
        MyTestApp TestApp = new MyTestApp();

        //Add actions to the collection
        TestApp.EventActions += TestApp.Hello;
        TestApp.EventActions += TestApp.Goodbye;

        //Invoke all event actions
        if (TestApp.EventActions!= null){
            //this peculiar syntax hides the invoke 
            TestApp.EventActions();
            //using the 'ActionCollection' idea:
            // foreach(EventAction action in TestApp.EventActions)
            //     action.Invoke();
        }
    }

}   

} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-01-04T10:32:22.877

帖子中有很棒的技术答案！**从技术上讲**，我没有什么要补充的。

新功能出现在语言和软件中的主要原因之一是营销或公司政治！:-) 这不能低估！

我认为这也适用于代表和事件的某些扩展！我发现它们很有用并为 C# 语言增加了价值，但另一方面，Java 语言决定不使用它们！他们决定无论你用委托解决什么，你都可以用语言的现有特性来解决，即接口，例如

现在大约在 2001 年左右，Microsoft 发布了 .NET 框架和 C# 语言作为 Java 的竞争对手解决方案，因此拥有 Java 没有的新功能是件好事。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-10-16T09:50:41.960

# 代表、事件（事件处理程序/事件监听器）、概念（多播/广播）、动作和功能

这将是一个很长但它最简单的解释，这个话题如此令人讨厌的问题是因为人们只是用不同的词来解释同一件事

首先，你应该知道一些事情

## 代表：这不过是一个方法列表，为什么要创建一个列表？因为当你的代码被执行时，这个列表会被一个一个地执行，只是不要听教科书的定义，你会没事的

也被称为 ：

*   指向函数的指针
*   可以像变量一样发送和接收方法的方法的包装器

创建一个代表你去

```
[[access modifier] delegate [return type] [delegate name]([parameters])]

example: public delegate int demo(int a); 
```

现在要执行存储在一个名为委托的列表中的所有这些方法，你去

```
1\. demo.invoke(a);
2\. demo(a);   ..... both are valid 
```

在使用 beginInvoke 的异步编程中使用点并明确表示调用会大放异彩，但这超出了本主题的范围

还有一件事叫做“创建委托/实例化委托的对象”，这听起来很像，但只是为了避免混淆（对于上面的例子）

```
example : demo del = new demo(); (or) Public demo del = null; 
```

要将任何方法添加到称为委托的列表中，您可以使用 += 并且一旦满足“方法的要求”，您还需要将其删除 -=

（满足方法的要求意味着您不再需要该方法处于活动状态或也称为“监听”）如果您不删除它，它可能会导致“内存泄漏”，这意味着您的计算机内存将被活吃掉，技术上分配内存不会被释放

例子：说有一个方法

```
public int calculate (int c)

to add this method to delegate you go

1\.  del = calculate;
2\.  del += calculate; .... all are valid

to remove 

del -= calculate 
```

首先注意委托和方法之间的相似之处，返回类型（输出）和输入/参数是相同的，这是一条规则，你不能在委托中添加任何随机或一堆方法，它需要遵循输入输出规则

现在为什么有两种不同的方式来做一件事，唯一不同的是赋值运算符（+，=），这引入了一个名为的新主题

## 活动

这只不过是一个受约束的委托版本，它仍然是一个方法列表，当人们解释这些术语时不要混淆，他们改变了名字，所以坚持这个来理解

什么是约束？你不能这样做`del = calculate;` 有什么害处，比如说一堆方法被添加到委托（列表）中，你这样做所有的都被消灭了，只剩下一个方法“计算”，所以为了防止使用事件，事件句法

公共事件演示 del = null;

你不能对事件做的另一件事是直接调用委托，`demo.invoke`因为它是公共的，它可以被访问和调用，但是对于事件，它不能

现在您只需将方法添加到事件中（一种特殊类型的委托）

何时使用事件与委托，取决于您的情况，但实际上事件很受欢迎

还有几个关键词

多播：向委托添加多个方法 广播：向事件添加多个方法

PUBLISHER：执行方法的那个（广播中使用的术语），只有一个实体 SUBSCRIBER：正在执行的方法，可以是多个

LISTENER：与订阅者相同，但该术语用于多播

事件处理程序：与订阅者/事件侦听器相同，那么有什么区别？基本上是一样的，有人说事件监听器检测到事件的发生，事件处理程序“处理”或执行代码，实际上是一样的！

action 和 func 只是已创建和实例化的委托，因此一句话就两行代码，区别仅在于返回类型

操作：在接受 0 或多于 1 个输入时不返回任何内容

FUNC：返回一件事并接受参数

如果你不擅长阅读这里是关于这个主题的最佳视频

[https://www.youtube.com/playlist?list=PLFt_AvWsXl0dliMtpZC8Qd_ru26785Ih_](https://www.youtube.com/playlist?list=PLFt_AvWsXl0dliMtpZC8Qd_ru26785Ih_)

# regex - sed 中的正则表达式中的通配符和分组问题

> ID：803243
> 
> 赞同：1
> 
> 时间：2009-04-29T16:42:01.873
> 
> 标签：regex, sed, glob

我运行以下[代码](http://www.ocf.berkeley.edu/sysadmin-class/2008-fall/intermediate/week05_slides)

```
sed 's/\([^ ]+\) your \([^ ]+\)/ \2\1er/' < fail 
```

文件失败是

```
fail your test 
```

上面的命令给了我

```
fail your test 
```

虽然它应该给出“testfailer”。

第二个和第一个 glob`\2\1`应该在单词“er”的开头。这表明我的问题可能出在搜索部分的正则表达式中。但是，它们对我来说似乎是正确的。

**您在代码中看到任何错误吗？**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T16:46:39.413

普通或花园品种`sed`正则表达式不理解 +。是的，我知道，这有多愚蠢。因此，这是您的命令行的等效工作版本：

```
sed 's/\([^ ][^ ]*\) your \([^ ][^ ]*\)/ \2\1er/' < fail 
```

也适用于请求扩展的正则表达式，在这种情况下，您放弃括号上的反斜杠：

```
sed -r 's/([^ ]+) your ([^ ]+)/ \2\1er/' < fail 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-29T16:49:19.937

当您转义加号时，您的代码确实有效：

```
sed 's/\([^ ]\+\) your \([^ ]\+\)/\2\1er/' < fail 
```

# c# - Windows 窗体应用程序的用户特定设置文件：本地 xml 文件或数据库

> ID：803245
> 
> 赞同：3
> 
> 时间：2009-04-29T16:42:06.883
> 
> 标签：c#, winforms

我和我的同事似乎无法就以下问题的解决方案达成一致：

我们正在努力将我们的应用程序迁移到 .net 框架。它将是一个独立的应用程序（不是 Web 应用程序），其中包含许多用于对我们广泛的数据库进行更改的自定义表单。因此，总而言之，如果没有数据库连接，应用程序几乎毫无用处。哦——而且没有必要建议把它做成一个 Web 应用程序，因为在这件事上真的别无选择。

我负责构建“主菜单”——我已经决定了一个树结构，它将列出所有自定义表单（按团队分类）。它还将包括一个“我的表格”部分和一个“最近的表格”部分，用户（我的表格）和系统（最近的表格）将定期更改这些部分。

我的问题是：存储这些自定义用户特定设置的最佳位置是什么？位于本地或位于数据库表中的 XML 文件？也许是因为我以前是 Web 应用程序开发人员，但我完全支持将其存储在数据库中。大家觉得呢？

感谢您的意见

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T16:47:54.840

如果用户可以在没有数据库的情况下运行，则它们应该是本地 xml 文件。如果应用程序需要数据库正常运行，我会将它们添加到数据库中。为什么要向应用程序添加一些新概念，只需将数据存储在一个地方。您的应用程序也将能够以较低的权限运行。如果您使用的是 asp.net 会员模型（是的，对于桌面应用程序），那么您将能够利用分析。

我投票数据库！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T16:50:36.377

将它们保存在数据库中的另一个好处是，当用户从另一台计算机登录到您的应用程序时，他们的所有设置都将被保留。如果它们存储在本地机器上，移动到另一台机器会导致它们丢失设置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T17:12:34.267

在同一个存储位置混合用户设置和用户数据可能很麻烦。

*   这种方法基本上会使数据库结构必须更改的次数增加一倍。
*   如果设置代码中存在错误，则有可能损坏/丢失用户数据，这比损坏/丢失用户设置要严重得多。
*   如果用户想要移动或备份他们的数据，这些设置也会随身携带。

我建议不要将设置保留在数据库中。

# c# - 在 C# 中将 Byte 数组转换为 Int-likes

> ID：803246
> 
> 赞同：0
> 
> 时间：2009-04-29T16:42:08.397
> 
> 标签：c#, integer, bytearray

BitConverter.ToUInt16() 期望字节被反转，我猜这就是它们在内存中的存储方式。但是，当它没有被反转时，我如何转换它，而无需修改数组？

```
Byte[] ba = { 0, 0, 0, 6, 0, 0 };
BitConverter.ToUInt16(ba, 2); // is 1536/0x0600, but I want 6/0x0006 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T16:46:06.483

听起来你想要 my `EndianBitConverter`in [`MiscUtil`](http://pobox.com/~skeet/csharp/miscutil)，它可以让你指定是要使用大端还是小端。

`BitConverter`基本上，它提供与实例方法相同的功能。然后你得到合适的类型`EndianBitConverter`并用它做你想做的事。

（它为高效处理数组提供了更多功能，这可能对您有用，也可能没用。）

该库是在相当宽松的许可证下开源的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T16:48:14.760

您也可以使用 IPAddress.HostToNetworkOrder。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-29T16:45:39.493

我认为你最好的电话是用 Array.Reverse 方法反转数组。

[http://msdn.microsoft.com/en-us/library/system.array.reverse(VS.71).aspx](http://msdn.microsoft.com/en-us/library/system.array.reverse(VS.71).aspx)

# ajax - 延迟加载部分接缝页？

> ID：803249
> 
> 赞同：1
> 
> 时间：2009-04-29T16:42:39.737
> 
> 标签：ajax, seam, richfaces

我正在开发一个接缝应用程序（JBoss AS 4.2.2 下的 2.1.1.GA），其中一个特定的部分（有时很大）在用户与该特定部分交互之前不需要呈现，认为沿着文章标题的行，用户单击标题并展开以显示包含文本的框。

我可以使用 Seam 和 Richfaces 毫无问题地实现这一点，但是当用户第一次加载页面时，所有部分的内容都会下载到浏览器中。无论如何，这些部分（可能包含也可能不包含richfaces控件本身）是否可以使用ajax按需下载？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T17:31:20.843

很多方法。

只需在框上设置 render="false" ，然后在单击标题时重新渲染它的父容器。

例如。在您的支持 Bean 中有一个名为 showContent 的布尔值，由 toggleContent() 方法切换：

```
<a4j:commandLink 
   value="This is a title" 
   ajaxSingle="true" 
   reRender="contentDiv" 
   action="#{someBackingBean.toggleContent}"/>

<a4j:outputPanel id="contentDiv">
   <a4j:outputPanel rendered="#{someBackingBean.showContent}">
      This is some text that is not rendered when the page loads
   </a4j:outputPanel>
</a4j:outputPanel> 
```

编辑：回应评论。另一种方法是使用 a4j:jsFunction （非常方便）和一些 javascript。

```
<h1 onclick="toggleContent(this);">This is a title</h1>
<a4j:outputPanel id="contentDiv">
   <a4j:outputPanel rendered="#{someBackingBean.showContent}">
      This is some text that is not rendered when the page loads
   </a4j:outputPanel>
</a4j:outputPanel>

<script>
function toggleContent(element) {
   //check if the contentDiv has any contents (maybe check if element has a child under contentDiv)

   //if it doesn't then call a4j:jsFunction to load the contentDiv eg. loadContent();

   //hide or show div depending on the current state of it
}
</script>

<a4j:jsFunction name="loadContent" action="#{someBackingBean.toggleContent}" reRender="contentDiv"/> 
```

反正是这样的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-01T11:08:34.823

如果您使用可滚动表格怎么办。如何实现分块获取数据？

拉加兹·马尔科

# asp.net - ASP.NET 请求 - 我可以从客户端上创建的动态控件中获取发布的文件吗？

> ID：803255
> 
> 赞同：2
> 
> 时间：2009-04-29T16:44:17.890
> 
> 标签：asp.net, javascript, file, httpwebrequest, request

我有一个带有一些自定义 javascript 的 web 控件。javascript 使用类似于以下的代码在客户端上动态创建新的文件上传控件：

```
var newFileUpload = document.createElement('input');
newFileUpload.type = 'file';
container.appendChild(newFileUpload); // where container is a div 
```

这存在于 ASP.NET 表单中，其中 encType 设置为 multipart/form-data。我将在页面上有 1 - n 个控件（当然，仅限于合理的数量）。

我现在想在我的 ASP.NET 应用程序中捕获上传的文件。由于上面采用的方法，我知道我无法像从 FileUpload 控件（不幸的是我无法使用）那样捕获它们。还有其他方法可以捕获上传的文件吗？

我浏览了许多领域，包括：

*   请求文件
*   申请表
*   Request.Form.Keys
*   请求输入流

但是我一直找不到内容。我相信客户端正确地提交了这些数据，但无法确定服务器对原始请求信息做了什么（如果这甚至暴露了）。

有人对我可能进一步探索的领域有什么建议吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T17:28:51.870

您应该为您的上传元素添加一个**唯一名称**，以便从 Request.Form 集合中获取它。

```
var newFileUpload = document.createElement('input');
newFileUpload.type = 'file';
//newFileUpload.id = 'file01';
newFileUpload.name = 'file01';
container.appendChild(newFileUpload); 
```

**编辑：**我尝试了 id 和 name attibutes，with name，你可以通过

```
Request.Form["file01"] 
```

此外，如果您应该将以下属性添加到您的表单元素。这允许您通过 Request.Files["file01"] 获取文件内容：

```
enctype="multipart/form-data" 
```

# c# - 如何以编程方式格式化未分配的空间？

> ID：803257
> 
> 赞同：0
> 
> 时间：2009-04-29T16:44:27.423
> 
> 标签：c#, .net, c++, format, hard-drive

我正在寻找可以以编程方式格式化给定驱动器上未分配空间的代码片段。

理想情况下，我正在寻找 .net 代码（VB.NET C#）或 C++。

非常感谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T16:52:39.807

最好的选择似乎是使用 WMI。特别是，您需要查看该类的[`Format`](http://msdn.microsoft.com/en-us/library/aa390432(VS.85).aspx)方法[`Win32_Volume`](http://msdn.microsoft.com/en-us/library/aa394515(VS.85).aspx)。

您可以改为使用[`SHFormatDrive`](http://msdn.microsoft.com/en-us/library/bb762169(VS.85).aspx)Win32 API 的功能。这可能是更简单的选项（尤其是在 C++ 中），尽管我不确定该功能与 WMI 方法相比如何。**编辑：**正如 M. Jahdbozorgan 指出的那样，这似乎打开了 Explorer shell 对话框来格式化驱动器。

第三种选择是`format.exe`从代码运行命令行（然后从标准输出流中读取），但这显然不是一个很好的解决方案。

其他建议在 MSDN 论坛上的[这个线程中给出。](http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/65ba9afb-a296-450a-be8e-1593656ebf79/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T18:23:00.133

创建一个填满整个驱动器的文件，然后将随机数据写入其中，然后刷新它，然后关闭它。

第一步可能是跨多个配置（例如，NTFS 压缩卷或每用户配额）可靠地完成的最困难的步骤。

或者从命令行使用“cipher /w”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T17:24:28.933

看起来 Windows 只提供了一种格式化整个卷的方法，而不仅仅是未分配的空间。

因此，如果我正确理解您的问题，您可以在驱动器的剩余空间中创建一个分区，然后格式化该新分区。

您将需要使用 PInvoke 和 WMI 的 Win32_Volume。

# ruby-on-rails - 如何告诉 Rails 如何正确大写首字母缩写词？

> ID：803262
> 
> 赞同：5
> 
> 时间：2009-04-29T16:45:05.190
> 
> 标签：ruby-on-rails, ruby

我的一个模型中有一个字段`sui`。它代表“标准用户标识符”。当字段出现验证错误时，Rails 会打印“Sui 是必需的”或“Sui 已被占用”。

我如何告诉 Rails 那`'sui'.titleize`是“SUI”？我看了看`Inflector.human`，但这不太对。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-29T16:58:15.127

在这种情况下，我使用[custom_err_msg](http://rubyforge.org/projects/custom-err-msg/)插件。安装后，您可以提供如下自定义错误消息：

```
validates_presence_of :sui, :message => '^SUI is required' 
```

当您在开头放置 ^ 时，Rails 不会放置字段名称。

编辑：还有另一个插件[i18n_label](http://github.com/iain/i18n_label/tree/master)用于翻译，但使用它，您可以以非常简单的方式将您的字段名称替换为更好的名称（在插件页面上有一个示例）。它将替换名称：

```
<%= f.label :sui %>
YourModel.human_attribute_name "sui" 
```

并在错误消息中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2014-03-25T14:44:42.780

您可以通过配置[ActiveSupport::Inflector](http://api.rubyonrails.org/classes/ActiveSupport/Inflector.html)来做到这一点，它提供了[titleize](http://api.rubyonrails.org/classes/ActiveSupport/Inflector.html#method-i-titleize)方法。只需在初始化程序中定义您自己的[变形。](http://api.rubyonrails.org/classes/ActiveSupport/Inflector/Inflections.html)

```
# config/initializers/inflections.rb
ActiveSupport::Inflector.inflections do |inflect|
  inflect.acronym 'SUI'
end 
```

重新启动您的应用程序以获取更改。现在`titleize`知道如何处理“SUI”了。启动 Rails 控制台来检查它：

```
> "sui".titleize
=> "SUI" 
```

请参阅链接的文档，了解更多可以用变形做的很酷的东西。

# python - 使用子进程获取实时输出

> ID：803265
> 
> 赞同：156
> 
> 时间：2009-04-29T16:45:48.013
> 
> 标签：python, subprocess

我正在尝试为命令行程序（svnadmin verify）编写一个包装脚本，它将显示一个很好的操作进度指示器。这要求我能够在输出后立即看到包装程序的每一行输出。

我想我只需使用`subprocess.Popen`, use来执行程序`stdout=PIPE`，然后读取每一行，并据此采取行动。但是，当我运行以下代码时，输​​出似乎被缓冲在某处，导致它出现在两个块中，第 1 行到第 332 行，然后是第 333 到 439 行（输出的最后一行）

```
from subprocess import Popen, PIPE, STDOUT

p = Popen('svnadmin verify /var/svn/repos/config', stdout = PIPE, 
        stderr = STDOUT, shell = True)
for line in p.stdout:
    print line.replace('\n', '') 
```

在看了一些关于 subprocess 的文档之后，我发现了`bufsize`to 的参数`Popen`，所以我尝试将 bufsize 设置为 1（每行缓冲）和 0（无缓冲），但是这两个值似乎都没有改变传递行的方式。

在这一点上，我开始抓住稻草，所以我编写了以下输出循环：

```
while True:
    try:
        print p.stdout.next().replace('\n', '')
    except StopIteration:
        break 
```

但得到了相同的结果。

是否可以获得使用子进程执行的程序的“实时”程序输出？Python 中是否还有其他向前兼容的选项（不是`exec*`）？

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2009-04-29T17:26:53.640

我试过这个，由于某种原因，代码

```
for line in p.stdout:
  ... 
```

积极缓冲，变体

```
while True:
  line = p.stdout.readline()
  if not line: break
  ... 
```

才不是。显然这是一个已知的错误：[http](http://bugs.python.org/issue3907) ://bugs.python.org/issue3907 （截至 2018 年 8 月 29 日，该问题现已“关闭”）

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2011-06-20T16:13:51.240

通过将缓冲区大小设置为 1，您实际上强制进程不缓冲输出。

```
p = subprocess.Popen(cmd, stdout=subprocess.PIPE, bufsize=1)
for line in iter(p.stdout.readline, b''):
    print line,
p.stdout.close()
p.wait() 
```

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2018-02-21T08:17:06.397

您可以将子流程输出直接定向到流。简化示例：

```
subprocess.run(['ls'], stderr=sys.stderr, stdout=sys.stdout) 
```

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2009-04-29T17:21:10.203

你可以试试这个：

```
import subprocess
import sys

process = subprocess.Popen(
    cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE
)

while True:
    out = process.stdout.read(1)
    if out == '' and process.poll() != None:
        break
    if out != '':
        sys.stdout.write(out)
        sys.stdout.flush() 
```

如果使用 readline 而不是 read，会出现输入信息不打印的情况。尝试使用需要内联输入的命令并亲自查看。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2019-09-17T08:49:38.963

在 Python 3.x 中，该进程可能会挂起，因为输出是字节数组而不是字符串。确保将其解码为字符串。

从 Python 3.6 开始，您可以使用[Popen Constructor](https://docs.python.org/3/library/subprocess.html#popen-constructor)`encoding`中的参数来完成。完整的例子：

```
process = subprocess.Popen(
    'my_command',
    stdout=subprocess.PIPE,
    stderr=subprocess.STDOUT,
    shell=True,
    encoding='utf-8',
    errors='replace'
)

while True:
    realtime_output = process.stdout.readline()

    if realtime_output == '' and process.poll() is not None:
        break

    if realtime_output:
        print(realtime_output.strip(), flush=True) 
```

请注意，此代码[重定向](https://docs.python.org/3/library/subprocess.html#subprocess.STDOUT) `stderr`到`stdout`并[处理输出错误](https://docs.python.org/3/library/codecs.html#error-handlers)。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2015-05-13T12:26:10.653

实时输出问题已解决：我在 Python 中遇到了类似的问题，同时捕获了 C 程序的实时输出。我`fflush(stdout);`在我的 C 代码中添加了。它对我有用。这是代码。

C程序：

```
#include <stdio.h>
void main()
{
    int count = 1;
    while (1)
    {
        printf(" Count  %d\n", count++);
        fflush(stdout);
        sleep(1);
    }
} 
```

蟒蛇程序：

```
#!/usr/bin/python

import os, sys
import subprocess

procExe = subprocess.Popen(".//count", shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, universal_newlines=True)

while procExe.poll() is None:
    line = procExe.stdout.readline()
    print("Print:" + line) 
```

输出：

```
Print: Count  1
Print: Count  2
Print: Count  3 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2018-11-15T16:21:29.623

[Kevin McCarthy](https://kevinmccarthy.org/author/kevin/)在 Python博客文章中使用 asyncio的[Streaming subprocess stdin 和 stdout](https://kevinmccarthy.org/2016/07/25/streaming-subprocess-stdin-and-stdout-with-asyncio-in-python/)展示了如何使用 asyncio：

```
import asyncio
from asyncio.subprocess import PIPE
from asyncio import create_subprocess_exec

async def _read_stream(stream, callback):
    while True:
        line = await stream.readline()
        if line:
            callback(line)
        else:
            break

async def run(command):
    process = await create_subprocess_exec(
        *command, stdout=PIPE, stderr=PIPE
    )

    await asyncio.wait(
        [
            _read_stream(
                process.stdout,
                lambda x: print(
                    "STDOUT: {}".format(x.decode("UTF8"))
                ),
            ),
            _read_stream(
                process.stderr,
                lambda x: print(
                    "STDERR: {}".format(x.decode("UTF8"))
                ),
            ),
        ]
    )

    await process.wait()

async def main():
    await run("docker build -t my-docker-image:latest .")

if __name__ == "__main__":
    loop = asyncio.get_event_loop()
    loop.run_until_complete(main()) 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2018-10-17T09:14:11.973

根据用例，您可能还希望禁用子进程本身的缓冲。

如果子进程是 Python 进程，您可以在调用之前执行此操作：

```
os.environ["PYTHONUNBUFFERED"] = "1" 
```

或者在`env`参数中将它传递给`Popen`.

否则，如果您使用的是 Linux/Unix，则可以使用该`stdbuf`工具。例如：

```
cmd = ["stdbuf", "-oL"] + cmd 
```

另请参阅[此处](https://unix.stackexchange.com/questions/25372/turn-off-buffering-in-pipe/)关于`stdbuf`或其他选项。

（有关相同的答案，请参见[此处](https://stackoverflow.com/a/52851238/133374)。）

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-04-29T17:24:09.200

不久前我遇到了同样的问题。我的解决方案是放弃该方法的迭代，`read`即使您的子进程未完成执行等，该方法也会立即返回。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-01-23T19:14:21.943

我使用这个解决方案来获得子进程的实时输出。此循环将在进程完成后立即停止，无需使用 break 语句或可能的无限循环。

```
sub_process = subprocess.Popen(my_command, close_fds=True, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)

while sub_process.poll() is None:
    out = sub_process.stdout.read(1)
    sys.stdout.write(out)
    sys.stdout.flush() 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-08-03T13:28:47.707

[在这里](http://www.saltycrane.com/blog/2009/10/how-capture-stdout-in-real-time-python/)找到了这个“即插即用”功能。像魅力一样工作！

```
import subprocess

def myrun(cmd):
    """from
    http://blog.kagesenshi.org/2008/02/teeing-python-subprocesspopen-output.html
    """
    p = subprocess.Popen(cmd, shell=True, stdout=subprocess.PIPE,
                         stderr=subprocess.STDOUT)
    stdout = []
    while True:
        line = p.stdout.readline()
        stdout.append(line)
        print line,
        if line == '' and p.poll() != None:
            break
    return ''.join(stdout) 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2017-06-22T06:14:41.037

您可以对子进程输出中的每个字节使用迭代器。这允许来自子进程的内联更新（以 '\r' 结尾的行覆盖先前的输出行）：

```
from subprocess import PIPE, Popen

command = ["my_command", "-my_arg"]

# Open pipe to subprocess
subprocess = Popen(command, stdout=PIPE, stderr=PIPE)

# read each byte of subprocess
while subprocess.poll() is None:
    for c in iter(lambda: subprocess.stdout.read(1) if subprocess.poll() is None else {}, b''):
        c = c.decode('ascii')
        sys.stdout.write(c)
sys.stdout.flush()

if subprocess.returncode != 0:
    raise Exception("The subprocess did not terminate correctly.") 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-12-27T14:11:04.513

这是我一直使用的基本骨架。它使实现超时变得容易，并且能够处理不可避免的挂起过程。

```
import subprocess
import threading
import Queue

def t_read_stdout(process, queue):
    """Read from stdout"""

    for output in iter(process.stdout.readline, b''):
        queue.put(output)

    return

process = subprocess.Popen(['dir'],
                           stdout=subprocess.PIPE,
                           stderr=subprocess.STDOUT,
                           bufsize=1,
                           cwd='C:\\',
                           shell=True)

queue = Queue.Queue()
t_stdout = threading.Thread(target=t_read_stdout, args=(process, queue))
t_stdout.daemon = True
t_stdout.start()

while process.poll() is None or not queue.empty():
    try:
        output = queue.get(timeout=.5)

    except Queue.Empty:
        continue

    if not output:
        continue

    print(output),

t_stdout.join() 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-07-06T14:09:22.727

将[pexpect](http://www.noah.org/wiki/Pexpect)与非阻塞 readlines 一起使用将解决此问题。它源于管道被缓冲的事实，因此您的应用程序的输出被管道缓冲，因此在缓冲区填满或进程终止之前您无法获得该输出。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-03-08T07:33:30.493

完整的解决方案：

```
import contextlib
import subprocess

# Unix, Windows and old Macintosh end-of-line
newlines = ['\n', '\r\n', '\r']
def unbuffered(proc, stream='stdout'):
    stream = getattr(proc, stream)
    with contextlib.closing(stream):
        while True:
            out = []
            last = stream.read(1)
            # Don't loop forever
            if last == '' and proc.poll() is not None:
                break
            while last not in newlines:
                # Don't loop forever
                if last == '' and proc.poll() is not None:
                    break
                out.append(last)
                last = stream.read(1)
            out = ''.join(out)
            yield out

def example():
    cmd = ['ls', '-l', '/']
    proc = subprocess.Popen(
        cmd,
        stdout=subprocess.PIPE,
        stderr=subprocess.STDOUT,
        # Make all end-of-lines '\n'
        universal_newlines=True,
    )
    for line in unbuffered(proc):
        print line

example() 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-08-09T04:21:35.467

如果您只想将日志实时转发到控制台

下面的代码适用于两者

```
 p = subprocess.Popen(cmd,
                         shell=True,
                         cwd=work_dir,
                         bufsize=1,
                         stdin=subprocess.PIPE,
                         stderr=sys.stderr,
                         stdout=sys.stdout) 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-05-26T20:46:08.547

（这个解决方案已经用 Python 2.7.15 测试过）
你只需要在每行读/写之后 sys.stdout.flush() ：

```
while proc.poll() is None:
    line = proc.stdout.readline()
    sys.stdout.write(line)
    # or print(line.strip()), you still need to force the flush.
    sys.stdout.flush() 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-03-29T06:23:13.663

很少有答案建议 python 3.x 或 pthon 2.x ，下面的代码对两者都适用。

```
 p = subprocess.Popen(cmd, shell=True, stdout=subprocess.PIPE, stderr=subprocess.STDOUT,)
    stdout = []
    while True:
        line = p.stdout.readline()
        if not isinstance(line, (str)):
            line = line.decode('utf-8')
        stdout.append(line)
        print (line)
        if (line == '' and p.poll() != None):
            break 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-07-17T07:40:28.373

```
def run_command(command):
process = subprocess.Popen(shlex.split(command), stdout=subprocess.PIPE)
while True:
    output = process.stdout.readline()
    if output == '' and process.poll() is not None:
        break
    if output:
        print(output.strip())
rc = process.poll()
return rc 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2022-03-04T19:56:55.170

这对我有用：

```
import subprocess
import sys

def run_cmd_print_output_to_console_and_log_to_file(cmd, log_file_path):
    make_file_if_not_exist(log_file_path)
    logfile = open(log_file_path, 'w')

    proc=subprocess.Popen(cmd, stdout=subprocess.PIPE, stderr=subprocess.STDOUT, shell = True)
    for line in proc.stdout:
        sys.stdout.write(line.decode("utf-8") )
        print(line.decode("utf-8").strip(), file=logfile, flush=True)
    proc.wait()

    logfile.close() 
```

# asp.net - 使用 TreeView 最小化 ViewState

> ID：803277
> 
> 赞同：2
> 
> 时间：2009-04-29T16:47:24.653
> 
> 标签：asp.net, treeview, viewstate

关于如何做到这一点的任何实用提示/技巧？

似乎没有很多关于如何做到这一点的信息。我正在将数据库中的数据加载到 TreeView 中，最大节点数约为 100。我仍然对最小化 ViewState 感兴趣。

我还将动态添加和删除节点（通过用户交互）。

谢谢！

PS：我正在使用 asp.net 2.0、c#、webforms（所以不要给我只与 ASP MVC 相关的提示）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T17:09:07.753

这是一种很好的方法，可以摆脱每次回发时通过电线发送的视图状态。基本上，它将完整的视图状态作为会话变量存储在服务器上，并且只传输视图状态字段中的标识符。

压缩会在带宽方面为您节省一点点，而将视图状态从页面中取出将有相当显着的性能提升

以下文章解释了几种具有性能测量指标的技术以及 [eggheadcafe](http://www.eggheadcafe.com/articles/20040613.asp)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T16:54:35.853

可以压缩一下。。

[http://www.hanselman.com/blog/ZippingCompressingViewStateInASPNET.aspx](http://www.hanselman.com/blog/ZippingCompressingViewStateInASPNET.aspx)

[http://www.codeproject.com/KB/viewstate/ViewStateCompression.aspx](http://www.codeproject.com/KB/viewstate/ViewStateCompression.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T16:55:32.933

好吧，您可以将 ViewState 存储在 Session 中，并完全防止它进入客户端。然后它只是上下发送的控制状态，它应该会显着减少页面大小......

```
protected override PageStatePersister PageStatePersister
{
    get
    {
        return new SessionPageStatePersister(this);
    }
} 
```

更多信息@这个问题

[在 SessionPageStatePersister 中保持 ViewState](https://stackoverflow.com/questions/386131/keeping-viewstate-in-sessionpagestatepersister)

# .net - 使用单个 exe 部署 Windows 窗体应用程序

> ID：803293
> 
> 赞同：3
> 
> 时间：2009-04-29T16:52:50.583
> 
> 标签：.net, windows, winforms, deployment, installation

我已经构建了一个用于部署我的 Windows 窗体应用程序的安装项目。我想获取部署所需的所有文件（setup.exe、whatever.msi 和先决条件）并将它们打包在一个自解压存档中。

理想情况下，用户将运行此 exe，它将文件提取到临时目录，运行 setup.exe，然后删除文件。

我以为我用 WinRar 有这个，但安装程序开始后它抱怨 msi 文件丢失。Winrar 在我想要之前删除临时目录。

我可以在删除临时文件之前让 winrar 等待吗？我可以使用其他实用程序吗？VS会为我做些什么吗？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T16:58:45.733

我为此使用了 Zip 2 Secure Exe，效果很好。这是免费的

[http://www.chilkatsoft.com/ChilkatSfx.asp](http://www.chilkatsoft.com/ChilkatSfx.asp)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T17:16:41.790

您可以简单地自己编写exe。只需使用 zip lib 解压缩包含所有压缩文件的嵌入式资源，然后启动设置。等到它完成，然后删除提取的文件并完成。

# wcf - 如何将大文件从 MS Word 加载项 (VBA) 传输到 Web 服务器？

> ID：803294
> 
> 赞同：2
> 
> 时间：2009-04-29T16:53:51.533
> 
> 标签：wcf, vba, asmx, large-files, data-transfer

# 概述

我有一个用 VBA（Visual Basic for Applications）编写的 Microsoft Word 加载项，它将文档及其所有相关内容（嵌入式媒体）压缩到一个 zip 存档中。创建 zip 存档后，它将文件转换为字节数组并将其发布到 ASMX Web 服务。这主要是有效的。

# 问题

我遇到的主要问题是将大文件传输到网站。我可以成功上传大约 40MB 的文件，但不能上传 140MB 的文件（超时/一般故障）。

第二个问题是，如果 zip 存档太大，在 VBScript Word 加载项中构建字节数组可能会因客户端计算机上的内存不足而失败。

# 潜在的解决方案

我正在考虑以下选项，并正在寻找有关任一选项或任何其他建议的反馈。

## 选项一

在客户端（MS Word VBA）上打开一个文件流并一次读取一个“块”并传输到 ASMX Web 服务，该服务将“块”组装成服务器上的文件。

这样做的好处是不会向应用程序添加任何额外的依赖项或组件，我只会修改现有功能。（更少的依赖更好，因为这个解决方案应该在各种服务器环境中工作并且相对容易设置。）

### 问题：

*   是否有这样做的示例或任何推荐的技术（在 VBA 的客户端或 C#/VB.NET 的 Web 服务中）？

## 选项二

我了解 WCF 可能会为通过“分块”或流数据传输大文件的问题提供解决方案。但是，我对 WCF 不是很熟悉，并且不确定它到底能做什么，或者我是否可以与 VBA 的 WCF 服务进行通信。这具有添加另一个依赖项（.NET 3.0）的缺点。但是，如果使用 WCF 绝对是一个更好的解决方案，我可能不介意接受这种依赖。

### 问题：

*   WCF 是否可靠地支持这种性质的大文件传输？如果是这样，这涉及什么？任何资源或例子？
*   您可以从 VBA 调用 WCF 服务吗？有什么例子吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-12-05T22:56:19.257

我最终实施了原始问题中引用的选项一。

我在 VBA 中“分块”文件并将每个“块”传输到 Web 服务。我将解决方案的 VBA 部分基于此处找到的代码：[Copy Large File by Chunk with Progress Notification](http://www.vbforums.com/showthread.php?t=539008)。但是，我没有将其复制到文件系统，而是将其发送到服务器。

## 代码：VBA 土地

这是创建文件块的（丑陋的）VBA代码：

```
Function CopyFileByChunk(fileName As String, sSource As String) As Boolean

   Dim FileSize As Long, OddSize As Long, SoFar As Long
   Dim Buffer() As Byte, f1 As Integer, ChunkSize As Long

   On Error GoTo CopyFileByChunk_Error

   f1 = FreeFile: Open sSource For Binary Access Read As #f1
   FileSize = LOF(f1)
   If FileSize = 0 Then GoTo Exit_CopyFileByChunk ' -- done!

   ChunkSize = 5505024 '5.25MB
   OddSize = FileSize Mod ChunkSize

   Dim index As Integer
   index = 0

   If OddSize Then
      ReDim Buffer(1 To OddSize)
      Get #f1, , Buffer

      index = index + 1
      SoFar = OddSize

      If UploadFileViaWebService(Buffer, fileName, index, SoFar = FileSize) Then
            g_frmProgress.lblProgress = "Percent uploaded: " & Format(SoFar / FileSize, "0.0%")
            Debug.Print SoFar, Format(SoFar / FileSize, "0.0%")
            DoEvents
         Else
            GoTo CopyFileByChunk_Error
         End If
   End If

   If ChunkSize Then
      ReDim Buffer(1 To ChunkSize)
      Do While SoFar < FileSize
         Get #f1, , Buffer

         index = index + 1
         SoFar = SoFar + ChunkSize

         If UploadFileViaWebService(Buffer, fileName, index, SoFar = FileSize) Then
            g_frmProgress.lblProgress = "Percent uploaded: " & Format(SoFar / FileSize, "0.0%")
            Debug.Print SoFar, Format(SoFar / FileSize, "0.0%")
            DoEvents
         Else
            GoTo CopyFileByChunk_Error
         End If
      Loop
   End If

   CopyFileByChunk = True

Exit_CopyFileByChunk:
   Close #f1
   Exit Function

CopyFileByChunk_Error:
   CopyFileByChunk = False
   Resume Exit_CopyFileByChunk
End Function 
```

这是将块上传到服务器的引用 VBA 方法：

```
Public Function UploadFileViaWebService(dataChunk() As Byte, fileName As String, index As Integer, lastChunk As Boolean) As Boolean

    On Error GoTo ErrHand
    Dim blnResult As Boolean
    blnResult = False

        'mdlConvert.SetProgressInfo "Connecting to the web server:" & vbNewLine & _
            DQUOT & server_title() & DQUOT
        If InternetAttemptConnect(0) = 0 Then
            On Error Resume Next

            Dim strSoapAction As String
            Dim strXml As String
            strXml = "<?xml version=""1.0"" encoding=""utf-8""?>" & _
            "<soap:Envelope xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xmlns:xsd=""http://www.w3.org/2001/XMLSchema"" xmlns:soap=""http://schemas.xmlsoap.org/soap/envelope/"">" & _
            "<soap:Body>" & _
            "<UploadZipFile xmlns=""http://something.com/"">" & _
            "<zipBytes></zipBytes>" & _
            "<index>" & index & "</index>" & _
            "<isLastChunk>" & IIf(lastChunk, 1, 0) & "</isLastChunk>" & _
            "</UploadZipFile>" & _
            "</soap:Body>" & _
            "</soap:Envelope>"

            Dim objXmlhttp As Object
            Dim objDom As Object
            Set objXmlhttp = New MSXML2.xmlhttp

            ' Load XML
            Set objDom = CreateObject("MSXML2.DOMDocument")
            objDom.LoadXML strXml

            'insert data chunk into XML doc
            objDom.SelectSingleNode("//zipBytes").dataType = "bin.base64"
            objDom.SelectSingleNode("//zipBytes").nodeTypedValue = dataChunk

            ' Open the webservice
            objXmlhttp.Open "POST", webServiceUrl, False

            ' Create headings
            strSoapAction = "http://something.com/UploadZipFile"
            objXmlhttp.setRequestHeader "Content-Type", "text/xml; charset=utf-8"
            objXmlhttp.setRequestHeader "SOAPAction", strSoapAction

            ' Send XML command
            objXmlhttp.send objDom.XML

            ' Get all response text from webservice
            Dim strRet
            strRet = objXmlhttp.responseText

            ' Close object
            Set objXmlhttp = Nothing
            Set objDom = Nothing

            'get the error if any
            Set objDom = CreateObject("MSXML2.DOMDocument")
            objDom.LoadXML strRet
            Dim isSoapResponse As Boolean
            isSoapResponse = Not (objDom.SelectSingleNode("//soap:Envelope") Is Nothing)
            Dim error As String
            If Not isSoapResponse Then
                error = "Woops"
            Else
                error = objDom.SelectSingleNode("//soap:Envelope/soap:Body/soap:Fault/faultstring").text
            End If
            If error <> "" Then
                ShowServerError error, True
                blnResult = False
            Else
                Err.Clear 'clear the error caused in the XPath query above
                blnResult = True
            End If
            'close dom object
            Set objDom = Nothing

         Else
             GetErrorInfo "UploadFileViaWebService:InternetCheckConnection"
        End If

ErrHand:
    If Err.Number <> 0 Then
        ShowError Err, "UploadFileViaWebService"
        blnResult = False
    End If

    UploadFileViaWebService = blnResult
End Function 
```

## 代码：C# ASMX Web 服务

现在，在服务器端，Web 服务方法接受一些重要参数。

1.  string fileName：文件名（每个chunk文件名相同）
2.  byte[] zipBytes：每个块的内容
3.  int index：索引（与 fileName 结合使用以提供文件系统上唯一的有序部分文件）
4.  bool isLastChunk：这是“我完成了 - 继续合并所有“块”并自己清理”标志。

int 索引和 bool isLastChunk。借助 VBA 世界提供的上下文，我知道如何保存这些文件块中的每一个，然后在 isLastChunk 标志为真时将它们组合起来。

```
 /// <summary>
    /// Accepts a chunk of a zip file.  Once all chunks have been received,  combines the chunks into a zip file that is processed.
    /// </summary>
    /// <param name="fileName">Name of the file.</param>
    /// <param name="zipBytes">The collection of bytes in this chunk.</param>
    /// <param name="index">The index of this chunk.</param>
    /// <param name="isLastChunk">if set to <c>true</c> this is the last chunk.</param>
    /// <returns>Whether the file was successfully read and parsed</returns>
    /// <exception cref="ParserException">An error occurred while trying to upload your file. The details have been written to the system log.</exception>
    [WebMethod]
    public bool UploadZipFile(string fileName, byte[] zipBytes, int index, bool isLastChunk)
    {
        try
        {
            const string ModuleRootUrl = "/Somewhere/";
            string folderName = HostingEnvironment.MapPath("~" + ModuleRootUrl);
            string fullDirectoryName = Path.Combine(folderName, Path.GetFileNameWithoutExtension(fileName));

            try
            {
                if (!Directory.Exists(fullDirectoryName))
                {
                    Directory.CreateDirectory(fullDirectoryName);
                }

                string pathAndFileName = Path.Combine(fullDirectoryName, AddIndexToFileName(fileName, index));
                using (var stream = new MemoryStream(zipBytes))
                {
                    WriteStreamToFile(stream, pathAndFileName);
                }

                if (isLastChunk)
                {
                    try
                    {
                        MergeFiles(fullDirectoryName, fileName, index);

                        // file transfer is done.
                        // extract the zip file
                        // and do whatever you need to do with its contents
                        // we'll assume that it works - but your "parsing" should return true or false
                        return true;
                    }
                    finally
                    {
                        DeleteDirectoryAndAllContents(fullDirectoryName);
                    }
                }
            }
            catch
            {
                DeleteDirectoryAndAllContents(fullDirectoryName);
                throw;
            }
        }
        return false;
    } 
```

这是将每个传入块写入文件系统的 C# 代码：

```
/// <summary>
/// Writes the contents of the given <paramref name="stream"/> into a file at <paramref name="newFilePath"/>.
/// </summary>
/// <param name="stream">The stream to write to the given file</param>
/// <param name="newFilePath">The full path to the new file which should contain the contents of the <paramref name="stream"/></param>
public static void WriteStreamToFile(Stream stream, string newFilePath)
{
    using (FileStream fs = File.OpenWrite(newFilePath))
    {
        const int BlockSize = 1024;
        var buffer = new byte[BlockSize];
        int numBytes;
        while ((numBytes = stream.Read(buffer, 0, BlockSize)) > 0)
        {
            fs.Write(buffer, 0, numBytes);
        }
    }
} 
```

这是合并所有 zip 文件“块”的 C# 代码：

```
/// <summary>
/// Merges each file chunk into one complete zip archive.
/// </summary>
/// <param name="directoryPath">The full path to the directory.</param>
/// <param name="fileName">Name of the file.</param>
/// <param name="finalChunkIndex">The index of the last file chunk.</param>
private static void MergeFiles(string directoryPath, string fileName, int finalChunkIndex)
{
    var fullNewFilePath = Path.Combine(directoryPath, fileName);

    using (var newFileStream = File.Create(fullNewFilePath))
    {
        for (int i = 1; i <= finalChunkIndex; i++)
        {
            using (var chunkFileStream = new FileStream(AddIndexToFileName(fullNewFilePath, i), FileMode.Open))
            {
                var buffer = new byte[chunkFileStream.Length];
                chunkFileStream.Read(buffer, 0, (int)chunkFileStream.Length);
                newFileStream.Write(buffer, 0, (int)chunkFileStream.Length);
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-04T22:02:12.093

我已经使用 MTOM 编码传输了这样的大文件。

此处有关 MTOM 的更多信息：http: [//msdn.microsoft.com/en-us/library/aa395209.aspx](http://msdn.microsoft.com/en-us/library/aa395209.aspx)

您可以在此处下载 MTOM 示例：http: [//msdn.microsoft.com/en-us/library/ms751514.aspx](http://msdn.microsoft.com/en-us/library/ms751514.aspx)

如果您想了解更多关于 MTOM 的信息，请查看 Bustamante 关于 WCF 的书。

至于 VBA 调用，我不是该领域的专家，因此我没有任何相关信息。

# oracle - SubSonic 2.2 中的 Oracle 存储过程

> ID：803298
> 
> 赞同：0
> 
> 时间：2009-04-29T16:54:31.563
> 
> 标签：oracle, stored-procedures, subsonic

我仍然没有在 SubSonic 2.2 中针对 Oracle 10g DB 生成我的 SP。表格和视图完美生成。此外，该产品是多平台的，因此我们正在针对 SQL 2K5 生成 SubSonic 库，并且非常适用于表/视图*和*SP。

我记得在旧论坛上，早期版本的 Provider 有一个错误，所以我不确定这是否仍然是同一个问题，或者我做错了什么？在 Oracle 上调用提供程序时，SubStage（UI）也会阻塞（SQL 没有问题）。所以我认为 SP 中有一些东西正在扼杀它[？]

谢谢！真正接近从我们目前的本土 DAL 迁移到 SS。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T14:05:14.240

我能够在 2.1 版本中修复 SubSonic 中的 Oracle Provider 的许多问题，并且我的大部分修复都进入了 2.2。我没有修复 Oracle Provider 的 SP 生成部分，因为我只有一两个 SP。即使 SP 生成不起作用，您仍然可以将 SP 与 Oracle 提供程序一起使用。我只是手动将 SP（见下文）作为部分类添加到更改后的文件夹中，用于向 SubSonic 生成的类添加功能。

例子

```
 public partial class SPs
{
    public static decimal CreateSp(string username, string labelNote)
    {
        Decimal returnId = 0;
        SubSonic.StoredProcedure sp = new StoredProcedure("User.MySP");
        sp.Command.Parameters.Add("username", username, DbType.String);
        sp.Command.Parameters.Add("labelnote", labelNote, DbType.String);
        sp.Command.Parameters.Add("returnId", returnId, DbType.Decimal, ParameterDirection.Output);
        sp.Execute();
        return Convert.ToDecimal(sp.Command.Parameters.Find(delegate(QueryParameter qp) { return qp.ParameterName == "returnId"; }).ParameterValue);
    } 
```

}

# c# - 定义 IList 时遇到问题 其中 T 是通用接口

> ID：803302
> 
> 赞同：1
> 
> 时间：2009-04-29T16:55:58.690
> 
> 标签：c#, generics

我正在尝试声明和使用这样的接口：

```
public interface IItem<T>
{
  string Name { get; set; }
  T Value { get; set; }
} 
```

这工作正常，直到我尝试创建这些项目的列表。这无法编译：

```
public interface IThing
{
    string Name { get; }
    IList<IItem<T>> ThingItems { get; }
} 
```

所以我不确定问题出在哪里。items 值直到运行时才定义，我需要收集这些项目。我认为这是一个相当标准的模式，但我看不到我跌倒的地方。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T16:58:23.833

您的类也需要是通用`Thing<T>`的（），否则列表不知道要使用什么类型。

```
public interface Thing<T>
{
    string Name { get; }
    IList<IItem<T>> thingItems { get; }
} 
```

**编辑** 它现在编译。

**编辑** 看起来你希望你`IItem<T>`是任何类型的。这在 C# 中不起作用。您可以在此处创建 IList>，但这并不理想，因为当您想要取出项目时，您会失去输入。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T16:59:01.007

*   接口不能包含字段（数据成员）
*   包含泛型类型的类型也是泛型类型

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T16:59:48.133

两个问题：

1.  您不能在`interface`. （基本原理：一个字段被认为是一个实现细节，这是接口被设计为抽象出来的东西）
2.  如果不指定类型参数，则不能拥有通用字段（除非您在声明类型上也有类型参数）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-29T17:01:49.363

您正在跌倒，因为编译器想知道您的列表中有哪些类型的项目。因此，如果您还不知道，只需创建一个非泛型基接口，并派生一个更具体的泛型接口：

也许这可以帮助你：

```
public interface IItem
{
  string Name { get; set; }
}

public interface IItem<T>: IItem
{
  T Value { get; set; }
}

public interface IThing
{
    string Name { get; }
    IList<IItem> Items { get; }
}

public interface IThing<T>: IThing
{
    string Name { get; }
    IList<IItem<T>> Items { get; }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T17:10:54.037

当你创建一个实例时，`Thing`你必须知道它的类型`Thing.thingItems`是什么。所以以下是正确的方法。

```
public interface Thing<T>
{
    String Name { get; }
    IList<IItem<T>> thingItems { get; }
} 
```

如果您在实例化时不知道具体类型，`Thing`则只能对该类型使用公共基类或公共接口。

```
public interface Thing<T>
{
    String Name { get; }
    IList<IItem<ThingParameterBase>> thingItems { get; }
} 
```

或具有通用接口。

```
public interface Thing<T>
{
    String Name { get; }
    IList<IItem<IThingParameter>> thingItems { get; }
} 
```

# svn - 用于 Windows 的 Web SVN？

> ID：803307
> 
> 赞同：0
> 
> 时间：2009-04-29T16:57:49.153
> 
> 标签：svn

是否有适用于 Windows 的等价物？[http://www.websvn.info/features/](http://www.websvn.info/features/)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T16:59:48.120

您可以将 PHP 集成到 IIS 中并在那里运行 WebSVN。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T17:04:06.517

你可以看看我们已经使用了 2 年多的[VisualSVN ，它真是太棒了。](http://www.visualsvn.com/)服务器是完全免费的。您可以在服务器上使用普通的龟SVN客户端[再次免费]，没有任何问题。

如果您打算使用他们的 Visual Studio.Net 插件，那么您可能需要为每个用户许可支付 50 美元。这绝对是可选的，我们已经获得了许可证，我必须说，在 .Net IDE 中进行 SVN 操作真的很方便。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-07T00:16:07.173

websvn 可以在 windows 上使用 apache 和 php 安装

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T17:05:27.170

[VisualSVN Server](http://www.visualsvn.com/server/)，类似。您可以通过浏览器浏览您的存储库。

![替代文字](https://www.visualsvn.com/server/manager-small.png)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T17:12:21.473

试试[Trac](http://trac.edgewall.org/)。它是用 python 编写的，这意味着它的跨平台，并且可能是 SVN 中集成度最高的 wiki/issue 跟踪系统。如果你使用 VisualSVN 服务器（你应该），它[很容易安装](http://www.visualsvn.com/server/trac/)。

Trac 有一个非常好的网络浏览器，以及其他功能（如果需要，所有这些都可以关闭）

否则，假设您通过 Apache 运行 subversion，您可以安装任何基于 Web 的查看器。有些更难上手（例如 Insurrection，它在很大程度上依赖于 mod_rewrite，最终我无法在 Windows 上安装它），但大多数都很简单。

# database-design - 关于餐桌设计的问题

> ID：803310
> 
> 赞同：7
> 
> 时间：2009-04-29T16:58:32.333
> 
> 标签：database-design, full-text-search

我正在为我的用户提供搜索选项。他们可以搜索城市名称。问题是我存储的城市名称是“圣路易斯”之类的东西。但即使用户输入“St. Louis”或“St Louis”，我也想找到 Saint Louis。关于如何创建查找表以某种方式考虑到这一点的任何建议？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T17:11:08.077

创建*两个*表。

一个包含关于一个城市的一切。

一个包含一堆城市名称，以及与第一个表的 id 对应的外键关联。所以你在 city 和 city_names 之间有一对多的关系。

现在唯一的问题是为每个城市区分一个名称，即首选名称。我们可以通过以下几种方式做到这一点：1）第一个表可以有一个指向第二个表的 fk，它保存首选名称的 id。但是，这会产生循环依赖。更好的是，2) 只需在第二个表 is_preffered 中添加一个布尔/位列。

```
create table city (id not null primary key, other columns ) ;

create table city_name (
 id not null primary key, 
 city_id int references city(id), 
 name varchar(80),
 is_preferred bool  
) ; 
```

然后获取所有名称，首先使用首选名称：

```
 select name from city_names where city_id = ? 
   order by is_preffered desc, name; 
```

这还有一个额外的好处：如果您不覆盖每个城市和城镇，您可以使用第二个表格将您不覆盖的城镇/村庄/县映射到您所覆盖的主要城市：

```
 insert into city_name(city_id, name) values
 ( $id-for-New-York-City, 'New York'),
 ( $id-for-New-York-City, 'Manhattan'),
 ( $id-for-New-York-City, 'Big Apple'),
 ( $id-for-New-York-City, 'Brooklyn'); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T17:12:25.797

我要做的是，构建一个简写到普通表，它将任何模棱两可的单词映射到您将在主表中使用的单个一致拼写。您可以在其中包含常见的拼写错误和拼写错误。

在查找用户请求之前，使用此表将所有单词转换为正常形式。

所以在你的情况下，`shorthand-to-normal`我们将有

```
 ______________
| short|normal |
|______|_______|
|St    |Saint  |
|St.   |Saint  | 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T17:05:48.387

您可能想要查看功能更全的全文搜索引擎，例如[Apache Lucene/Solr](http://lucene.apache.org/solr/)或[Sphinx](http://www.sphinxsearch.com/) - 它可以原生支持这种字符串映射。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T17:08:43.183

我看到了许多可能的方法来处理这个问题。一种是匹配英语字符串相似度的[soundex](http://en.wikipedia.org/wiki/Soundex)查找算法。[此外，在某些数据库（如PostgreSQL](http://www.postgresql.org/docs/8.3/static/fuzzystrmatch.html)）中本机支持这一点。

另一种方法可能只是为您的用户提供一个自动完成功能，当他们输入一些建议时会出现。这样，用户将直观地选择所需的查找城市名称。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-29T17:13:34.140

作为一般方法，您可以在插入和搜索项目时对其进行规范化。

规范化规则可以是：

```
Saint => St
St. => St 
```

等等

然后，规范化的名称应该匹配。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-29T17:15:57.550

恕我直言，我将不理会数据库，而是在您的应用程序中列出城市的向下列表。更简单，更清洁，并且不需要太多额外的东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-29T17:42:59.340

我喜欢第一个答案中的选项。

另一个想法是有一个用户可以更新的那个城市的标签列。

IE

纽约市是正式名称。

这个城市的标签会很多（Manhattan, NY, NYC, the city, big apple..）等等，但你不希望你的主 Cities 表中的所有垃圾或创建关联的子表并且必须进行连接。因此，只需将其放入列中并根据搜索词进行搜索，但如果找到则返回正确的名称。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-29T17:48:06.943

您可以为同义词条目使用内置的 SQL FTS 属性。这允许您在全文搜索中构建自定义词图。这样，您可以将所有内容保留在 FTS 中，而不是将 FTS 和其他查询混合在一起。

不确定您使用的是哪个版本的 SQL，因为它在 2005/8 之间有所不同，所以这里有一个很好的 2005/8 演练[http://arcanecode.com/2008/05/28/creating-custom-thesaurus-entries-in -sql-server-2005-and-2008-full-text-search/](http://arcanecode.com/2008/05/28/creating-custom-thesaurus-entries-in-sql-server-2005-and-2008-full-text-search/)

# javascript - 与 YUI 2.7 同步 GET 请求？

> ID：803315
> 
> 赞同：0
> 
> 时间：2009-04-29T16:59:00.897
> 
> 标签：javascript, yui, callback, request, synchronous

我对 YUI 比较陌生 - 浏览他们很棒的文档，我没有找到**同步**加载外部资源的方法或标志。

或者反过来的问题；对于每个匹配的节点，我需要调用一个方法，该方法在节点上插入一些东西；对于异步调用，*记住的* *标识符*似乎搞砸了。

因此回调需要坚持

```
pid 
```

调用函数时，而不是执行回调时 - 我做对了吗？

```
var platform_ids = YAHOO.util.Selector.query('.platform_id'); 

for (var i = 0; i < platform_ids.length; i++) {
    var pid = platform_ids[i].getAttribute("id");
    var sUrl = "/platform/" + pid + "/description/";
    var callback = { success: function(o) { 
        document.getElementById(pid).innerHTML =  o.responseText; }}
    var transaction = YAHOO.util.Connect.asyncRequest(
        'GET', sUrl, callback, null
    );
} 
```

谢谢。MYYN

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T17:07:27.930

您不想要同步请求。用户体验可能很糟糕。你真的只是想将一个值传递给你的回调，这样它就不会依赖`pid`（正如你所注意到的，当你的回调被调用时，它通常会有一个不同的值）：

```
var callback = { success: function(o) 
  { 
    document.getElementById(o.argument).innerHTML =  o.responseText; 
  }, 
  argument: pid
}; 
```

在这里，我使用`argument`回调成员来保存 ID，并在回调函数本身中引用它，确保每个回调使用正确的 ID。

# c# - C#：如何从动作中获取分配的值？

> ID：803331
> 
> 赞同：1
> 
> 时间：2009-04-29T17:04:37.670
> 
> 标签：c#, action

我使用以下代码从不同的线程调用和访问我的属性。

```
 public static void PFA(Action<frmain> action)
    {
        var form = Form.ActiveForm as frmain;
        if (form != null)
        {
            form.PerformAction(action);
        }
    }

    public void PerformAction(Action<frmain> action)
    {
        if (InvokeRequired)
            Invoke(action, this);
        else
            action(this);
    } 
```

我的问题：

如果我打电话`PFA(form => form.Richbox1.Text = "Test")`- 我希望 PFA() 检查操作是否为 (Richbox1.Text)，如果是，则在文本中添加“\n”(“Test”)。

想法是打电话

```
PFA(form => form.Richbox1.Text = "Test"); 
```

代替

```
PFA(form => form.Richbox1.Text = "Test\n"); 
```

换句话说，如果操作是“Richbox1.Text =”，我想自动添加一个新行

我该怎么做？我以前从未使用过动作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T17:08:18.270

您可以添加一个扩展方法来解决这个问题。试试下面的。

```
public static void AddNewLineIfMatch(this RichTextBox rtb, string toMatch) {
  if ( rtb.Text == toMatch ) {
    rtb.AppendText("\n");
  }
}

PFDA(() => form.Richbox1.AddNewLineIfMatch("Test")); 
```

**编辑**使用 AppendText 方法而不是 Text+=

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T17:14:15.870

你不能以你想要的方式做到这一点。PFA 功能无法检查您的委托中的内容。想想如何以另一种方式解决您的任务。

[题外话]
PS。此外，您的命名约定不是很好。“PFA”没有解释函数的作用，对于“frmain” - 通常类名以大写字母开头。
[/题外话]

更新：我会做得比乔希提供的更好一点：

```
PFA(form => SetControlText(form.Richbox1, "Test"));

public void SetControlText(Control control, string text)
{ 
  control.Text = text;  
  // choose control type for which you want to add new line
  if(control is RichTextbox || control is TextBox || control is ... )
    control.Text += Environment.NewLine;
}
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T17:19:29.523

如果你这样做了：

```
PFA(form => UpdateTextBox(form.Richbox1,"Test"));

public void UpdateTextBox(RichTextBox box,string text)
{

   if (box.Name=="Richbox1")
   {
       text+="\n";
   }

   box.AppendText(text);
} 
```

您将无法查看动作内部并确定它正在使用来自动作外部的特定控制。因此，您需要在调用 PFA 之前添加 \n，或者让 PFA 调用一个函数来执行您想要的操作，或者让 PFA 实现逻辑。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T17:26:16.933

您可以通过从 Action 转到 Expression> 来完成此操作。然后你可以像这样查看方法中发生了什么

```
public static void PFA(Expression<Action<frmain>> expression) {
    // this will give you form.RichTextBox1
    var targetFormProperty = (MemberAccessExpression)expression.Body;
    // this only works for your example given. this gives you RichTextBox1.Text
    var textProperty = (MemberAccessExpression)targetFormProperty.Expression;

    // this is how you would run your action like normal
    var action = expression.Compile();
    action(); // invoke action (you would want to wrap this in the invoke check)
} 
```

这为您提供了找出属性所需的信息，但不提供如何附加 \n。我会把这留给你找出来。我认为这在这里有点矫枉过正，但谁知道呢，也许这可以帮助您或其他人，甚至激发一个很好的解决方案。

我可能会想到一个很好的解决方案，你可以在哪里重用这个功能，就像一个规则引擎，你可以比较正在访问的属性是什么，并在它之后立即运行一个动作，等等。

# ruby-on-rails - 我应该如何向用户呈现成本字段，并将其存储在数据库中？

> ID：803342
> 
> 赞同：1
> 
> 时间：2009-04-29T17:08:08.957
> 
> 标签：ruby-on-rails, ruby, database

现在我有两个成本字段。一种用于美元，一种用于美分。这可行，但有点难看。如果他们愿意，它也不允许用户输入术语“免费”或“免费”。但如果我只有一个字段，我可能不得不让我的解析器更智能一些。你怎么看？

在服务器端，我结合美元和美分将它们作为小数存储在我的数据库中。主要是为了让我可以快速收集统计数据（平均成本等）。

您认为将成本存储为字符串更好吗？然后，每当我实际将成本用于统计或其他目的时，我都会将其转换为小数。还是我走在正确的轨道上？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-29T17:19:57.523

数据库设计中有一条规则指出不应拆分“原子数据”。根据这条规则，价格或成本是原子数据的一个例子，因此它不应该被拆分到多个列中，就像您不应该在多个列中拆分电话号码一样（除非您真的有充分的理由 -很稀少）

使用 DECIMAL 数据类型。像 DECIMAL(8,3) 这样的东西应该可以工作，并且所有符合 ANSI SQL 的数据库产品都支持它！

你可以参考 Joe Celko 的[“Thinking In Sets”](https://rads.stackoverflow.com/amzn/click/com/0123741378)一书来讨论这个话题。请参阅[第 1.6.2 节，第 21-22 页](http://www.google.com/url?sa=t&source=web&ct=res&cd=5&url=http%3A%2F%2Fbooks.google.com%2Fbooks%3Fid%3DW2Yi4TQaAjwC%26pg%3DPA21%26lpg%3DPA21%26dq%3Dsql%2Batomic%2Bdata%2Bcelko%26source%3Dbl%26ots%3DsG4GlhVJAf%26sig%3DCY-zn-tJpPnWM0N8L4FObL5cP2M%26hl%3Den%26ei%3Dp4z4Sem6PJu8M7LrsbkP%26sa%3DX%26oi%3Dbook_result%26ct%3Dresult%26resnum%3D5&ei=p4z4Sem6PJu8M7LrsbkP&usg=AFQjCNGc4LOV5bgF38g1htwwPOev3GBeGw)。

**编辑**-从您的问题看来，您还关心如何以类似于价格（xxxx.xx）的形式接受用户的输入-因此有两个输入框，用于整个美元和便士。

我建议使用单个输入框，然后使用正则表达式进行输入验证以匹配您的格式（例如***[0-9]+(.[0-9]{1,3})?***可能会起作用，但可以改进）。然后，您可以将经过验证的字符串解析为您的语言中的 Decimal 类型，或者将其作为字符串传递到您的数据库中 - SQL 将知道如何将其转换为 DECIMAL 类型。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-29T17:17:19.370

将整个成本保留为小数。如果它是免费的，则将成本保持为 0。在演示中，如果成本为零 - 写“免费”而不是 0。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T17:15:49.233

我通常将成本存储为最低单位（便士），然后将其转换为整美元。

因此，4.50 美元的成本存储为 450。免费物品将是 -1 美分。您也可以将免费的东西存储为 0 便士，这使您可以灵活地使用 0 和 -1 来表示两个稍微不同的东西（免费与不销售？）。

如果您选择走这条路线，它还可以更轻松地支持不使用美分的国家/地区。

* * *

至于呈现数据输入字段，我个人不喜欢当我必须为微小的事情不断切换字段时（比如当他们将电话号码分成 3 个字段，或将 IP 地址分成 4 个字段时）。我会提供一个字段，让用户自己输入小数点。这样，您的用户就不必使用标签（或单击，如果他们不熟悉标签）到下一个字段。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-29T23:09:45.577

使用美分，以 4.50 美元的价格使用 450，这将为您避免因浮点运算不安全而经常出现的问题。只需在 irb 中尝试以下表达式：0.4 - 0.3 == 0.1 将返回 false。都是因为浮点表示不准确。

在我的模型中，我一直在使用：

```
attr_accessor :price_with_cents
def price_with_cents
  self.price/100.00
end

def price\_with\_cents==(num)
  self.price = (num.to_f * 100.00).to_i
end 
```

并且列的名称只是*价格* 和*整数*类型。

我对小数列及其在 ruby​​ 中的表示没有太多经验（这可能是浮动的，正如我在开头所展示的那样是有问题的）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T17:17:52.647

不要让垃圾进入您的数据库。如果您期望某个字段上的金额为美元，那么在它进入之前确保它是有效的。这将使您能够更好地报告数据并允许更简单的输出格式。

我建议将此字段设置为在更新或插入时进行验证的单个字段。

```
if field != SpecialFreeTag then

  try to convert to decimal
    if fail then report to user
    otherwise accept value 
```

使用 try parse 或正则表达式来帮助验证。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-29T17:21:44.960

我会将成本存储为十进制，比例不小于 2，甚至可能是 3-5。如果某样东西是批量购买的，那么单位成本很容易包括几分之一美分。免费项目的成本为 0。如果成本未知，则也允许空值。

# wpf - WPF Canvas：Children.Add() 挂在后台线程上？

> ID：803343
> 
> 赞同：3
> 
> 时间：2009-04-29T17:08:11.563
> 
> 标签：wpf, multithreading, canvas

...或者...

***“我唤醒了 WPF 深处的什么邪恶？”***

我正在后台线程上创建一个 Canvas 并将其渲染为位图。我已经在生产代码中工作了一年多了，没有问题。我执行以下操作：

*   创建一个画布对象
*   创建一个新的 NameScope 对象
*   将该 NameScope 分配给 Canvas
*   在画布上画出我想要的任何东西
*   使用 Canvas 的大小调用 canvas.Measure()
*   使用 Canvas 的可用矩形调用 canvas.Arrage()
*   调用 canvas.UpdateLayout()
*   渲染画布

在绘制步骤中，我总是调用 canvas.Children.Add() 将 UIElements 放到 Canvas 上。这一直有效。

现在，由于某种莫名其妙的原因，在我正在处理的应用程序的一个特定情况下，对 canvas.Children.Add() 的调用无限期地挂起，阻塞了我的后台线程。我想不出我在已经工作了一年多的代码和这个特定案例之间做的任何不同。

任何人都可以提出对 canvas.Children.Add() 的调用会这样挂起的可能原因吗？

**编辑**：后台线程是一个 STA 线程（后台线程处理模型已经到位，因为我无法在 MTA 线程上使用 WPF 处理图像），所以线程单元模型不应该是罪魁祸首。

**编辑#2**：虽然我理解人们为什么建议我从我的后台线程中尝试 Dispatcher.BeginInvoke()，但我不喜欢这个选项有两个原因：

1.  我希望我的后台线程处理在该线程上是同步的。我的后台线程有一个队列，其他线程将图像作业提交到该队列，并且我的后台线程在每个作业到达它们时对其进行处理。使用 Dispatcher.BeginInvoke() 增加了我宁愿避免的另一层复杂性。
2.  直到现在我才***需要。***在我的后台线程上同步执行此后台处理**工作**很简单。我正在尝试确定导致此代码无法工作的这种奇怪的边缘情况可能有什么不同。如果我不能让它工作，我最终会在没有 WPF 的情况下重写这个处理代码，我也宁愿避免这种情况。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T17:15:46.583

您的后台线程使用什么公寓模型？

我相信 WPF 需要在 STA 线程上运行。当您生成后台线程时，请尝试将其设置为 STA 的公寓。

**更新：**

如果 STA 线程不是问题，那么我会尝试将您的画布绘制成块。基本上，如果您执行以下操作：

Dispatcher.BeginInvoke(...)

从您的线程中，提供的委托被推到调度程序队列的后面，从而允许执行其他排队的任务。

**更新 2：**

您还可以尝试使用 .NET 框架参考源调试 Canvas 对象的源代码。您可以通过在工具->选项下的调试选项中打开“启用 .net 框架源步进”来启用此功能。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-29T17:42:10.623

尝试在后台线程中调用 Dispatcher.Run()。

# wpf - WPF 中的自定义依赖属性和双向绑定

> ID：803361
> 
> 赞同：7
> 
> 时间：2009-04-29T17:13:06.853
> 
> 标签：wpf, data-binding, dependency-properties

我们有一个派生自 DependencyObject 的对象，并实现了一些 DependencyProperties。

基本上是这样的：

```
class Context : DependencyObject {
   public static readonly DependencyProperty NameProperty =
   DependencyProperty.Register ("Name", typeof (string), typeof (Context), new PropertyMetadata (""));
    public string Name {
        get {
            return (string)this.GetValue (NameProperty);
        }
        set {
            this.SetValue (NameProperty, value);
        }
    }
} 
```

这有效，属性已设置，可以绑定等。当我使用 TwoWay 绑定从 WPF 绑定到属性时，问题就出现了。TwoWay 部分从未真正发生过，WPF 从未调用此属性的集合。我已经像这样设置了我的绑定：

```
<TextBox Text="{Binding Path=Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" /> 
```

在这种情况下，在文本框中键入应该会立即更新 Name 属性，但事实并非如此。如果我将 Name 属性更改为常规 POCO 属性，它会起作用（尽管 TwoWay 的另一端显然不会，除非我实现 INotifyPropertyChanged）。

我在这里做错了什么？这应该是一件非常简单的事情，但它让我头疼不已。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-29T17:29:38.687

这是预期的行为。CLR 属性只是底层`DependencyProperty`. WPF 通常通过调用`GetValue`和`SetValue`直接进行优化。如果您需要执行自定义逻辑，请使用`DependencyProperty`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-06-29T08:00:55.840

在这个问题花费了我一些时间之后：

对于那些有同样问题的人，但是 - 像我一样 - 在上面的答案中看不到解决方案：

*为了支持 DataContext 的继承，必须从FrameworkElement*而不是*DependencyObject*派生自定义类（在本例中为 Context）。就这样。

马克

# sql-server - SQL Server 中的内存使用情况

> ID：803373
> 
> 赞同：0
> 
> 时间：2009-04-29T17:16:26.720
> 
> 标签：sql-server

SQL SERVER 2005 中最消耗内存的原因是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T17:31:51.787

[SQL Rocks](http://sqlnerd.blogspot.com/)文章[Memory Use in SQL Server](http://sqlnerd.blogspot.com/2006/07/memory-use-in-sql-server.html)可能会回答您的问题。

我认为这是重要的部分之一：

> SQL Server 的缓存行为是大量内存使用的原因。这是设计使然，不是错误、内存泄漏或不正确的配置。每次 SQL Server 需要从磁盘读取页面时，它都会将该页面缓存在内存中，这样如果 SQL Server 再次需要该页面，就不需要缓慢的磁盘操作。每次 SQL Server 需要从磁盘读取页面时，它都会将该页面缓存在内存中，这样就不需要缓慢的磁盘操作，SQL Server 应该再次需要该页面。

SQL Server 只是内存不足。你给它的内存越多，它就会用得越多。如果 SQL Server 正在做任何重要的事情，它可能应该始终在自己的服务器上运行。换句话说，不要在您的域控制器、文件服务器或源代码控制存储库上安装 SQL Server（除非您的源代码控制存储库使用 SQL Server）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T17:26:11.130

主要用于数据、计划、锁的[缓冲池](http://blogs.msdn.com/boduff/archive/2008/03/31/sql-server-memory-architecture-myth-busting-and-how-sad-is-awe-32-bit.aspx)

请问可以加点背景吗？

# c# - 会为匿名变量调用 dispose 吗？

> ID：803381
> 
> 赞同：2
> 
> 时间：2009-04-29T17:17:50.087
> 
> 标签：c#, idisposable, anonymous-class

例如，

```
int myResult= (new UnmanagedResourceUsingMemorySuckingPig()).GetThingsDone(id); 
```

没有 using 块，没有明显的方法来使用 using 块，没有明显的方法来调用 Dispose()。当然，UnmanagedResourceUsingMemorySuckingPig 确实实现了 IDisposable。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-29T17:21:31.920

如果该类的终结器调用`Dispose()`，是的。如果没有，不。

**（编辑）**只是一些[附加信息](http://msdn.microsoft.com/en-us/library/b1yfkh5e(VS.71).aspx)：

> 不要假设 Dispose 会被调用。如果未调用 Dispose，则还应在 Finalize 方法中释放类型拥有的非托管资源。

**编辑**

为了澄清上述编辑，我看到很多人（在这个线程、SO 和其他地方）声称“`Dispose()`当对象被删除时，GC 将调用”。根本不是这种情况。是的，编写组件的优秀的防御性编码人员会假设`Dispose()`不会显式调用该组件，并在终结器中这样做。但是，使用组件的优秀防御性编码器必须假定终结器不会调用`Dispose()`. **垃圾收集器****中没有自动调用`Dispose()`**。此功能仅在终结器调用`Dispose()`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T17:22:03.340

我不相信。你必须写：

```
 using (UnmanagedResourceUsingMemorySuckingPig urumsp = new UnmanagedResourceUsingMemorySuckingPig()) 
{
  myResult= urumsp.GetThingsDone(id);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T18:23:10.913

您只能确定如果它有一个终结器（析构函数），那么它将被调用。终结器可能会调用`Dispose()`，但通常的实现是终结器和`Dispose()`调用`protected Dispose(bool)`。

换句话说，它取决于 的实现`UnmanagedResourceUsingMemorySuckingPig`，如果它遵循指南，那么匿名对象将被清理，但不如使用`using`块那么有效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T17:22:24.617

不会。但是，GC 最终会收集对象并注意到它是可终结的（它是可终结的，对吗？）并会为您终结它。Dispose 用于确定性地清理资源。

# ruby - Ruby：如何将数组的元素与前缀连接在一起？

> ID：803384
> 
> 赞同：20
> 
> 时间：2009-04-29T17:18:25.157
> 
> 标签：ruby, arrays, string

我有一个像这样的数组：

```
["marblecake", "also", "the", 1337] 
```

我想取回一个字符串，该字符串包含数组的每个元素，前缀为某个指定的字符串，然后由另一个指定的字符串连接在一起。例如，

```
["marblecake", "also", "the", 1337].join_with_prefix("%", "__") 
```

应该导致

```
# => %marblecake__%also__%the__%1337 
```

我该怎么做？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-29T17:20:33.170

如果你的数组在里面，`a`那么这个单行就可以了

```
a.map { |k| "%#{k}" }.join("_") 
```

您可以轻松地将其放入您自己的函数中 - 甚至将其添加到`Array`类中，以便您可以在数组上调用它，就像在您的示例中一样。

请注意“！” map ( `map!`) 的版本将就地修改数组 - 可能不是您的意图。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2015-05-21T19:24:23.160

虽然这是一个非常古老的问题，但我想补充一下：

```
a.any? && "%".+(a.join("__%")) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T18:27:58.750

按照上面的建议：

```
class Array
  def join_with_prefix(prefix,separator)
    self.collect {|e| prefix.to_s + e }.join(separator)
  end
end

p ['ab','cd','ef'].join_with_prefix('%','__') 
```

```
=> "%ab__%cd__​​%ef"
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2012-08-16T13:15:57.233

我今天正在寻找解决方案。我发现了这个问题。这是我的解决方案。

```
array = ["marblecake", "also", "the", 1337];
arrayString = ''

array.each{|x| arrayString += "%" + x + "__"} 
```

# sql - 跨实例导入/导出 Sql Server 2005 用户/权限的简便方法？

> ID：803386
> 
> 赞同：3
> 
> 时间：2009-04-29T17:18:40.023
> 
> 标签：sql, sql-server, sql-server-2005

有没有一种简单的方法可以将用户/权限从一个 Sql Server 2005 实例导出然后导入另一个实例？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T17:30:48.607

之后可能需要执行“sp_change_users_login AUTO_FIX，'my_user'”以将安全登录重新链接到各自的数据。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T17:24:27.700

使用管理控制台为您的用户及其相关权限生成脚本。对安全文件夹中的服务器登录也可以这样做。

选择您的用户：选择 DB 并展开 security\users 文件夹右键单击 --> 将用户设置为 --> 创建到 --> 新查询

对于登录

选择您的登录名：展开 security\logins 文件夹右键单击 --> 脚本登录为 --> 创建到 --> 新查询

现在只需在您的新实例上运行查询。只需选择要在其中运行脚本的数据库。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-12T13:50:21.390

sqlcmd -E -d master -S suksql01 -Q "sp_help_revlogin" -o \suksql03\login\LOGIN.txt go exec sp_help_revlogin go

执行 sp_help_login

# c++ - 有哪些学习半条命 2 SDK 的好方法？

> ID：803391
> 
> 赞同：4
> 
> 时间：2009-04-29T17:20:18.913
> 
> 标签：c++, sdk

多年来，我一直是半条命的爱好者。我拥有计算机科学学士学位，并且从高中开始就一直在进行非正式编程。当我还在上大学的时候，我试图成为一名有趣的模组程序员……使用第一个半条命引擎……效果不太好。所以我想在我所有伟大的大学学习之后:-) 我会对如何解决这个问题有更多的了解，并且最终可以做到。所以我在这里......终于在商业世界编程java......所以我下载了HL2 SDk并开始查看类结构。我觉得我上次尝试这个时就是这样做的……茫然和困惑。对不起所有的背景。

那么系统学习代码结构的最佳方法是什么？我知道java，我知道c++ ..我只是不知道任何类的作用......评论很少而且相距甚远，文档似乎很微薄。有什么好的方法吗？我**不想开始我自己的模组……我只是想有一天成为一个业余模组程序员，在一些很酷的模组上……保持学习编程和商业方面的乐趣。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T17:30:39.433

> 评论很少，而且文档似乎很少。有什么好的方法吗？

欢迎来到 Source SDK 的奇迹。不，它没有记录在案。实验、破解、放置断点，看看如果你改变了一些代码会发生什么。

有一个[wiki](http://developer.valvesoftware.com/wiki/Main%5FPage)在某些情况下您可能会觉得很有帮助，但它是由社区而非 Valve 填写的，这意味着您不会在那里找到任何实际文档，只是解释了以前的改装者如何破解引擎。

老实说，这很糟糕。解决它的唯一方法是潜入。尝试对游戏进行各种更改，不要害怕将现有代码撕裂。它不会很漂亮，但如果它有效，谁会抱怨？他们的代码非常糟糕，而且很可能你的代码也会如此。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T17:23:58.280

您可以从[Valve Developer Wiki](http://developer.valvesoftware.com/wiki/Main_Page)开始。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T17:29:58.700

我认为最好的方法是查看*为数不多*的开源模组之一的源代码，即[Open Source Jail Break](http://www.moddb.com/mods/open-source-jailbreak)。它将帮助您至少熟悉代码。

除此之外，它只是[开发人员资源](http://developer.valvesoftware.com/wiki/Main_Page)和论坛。

编辑：[进攻计划](http://www.planofattackgame.com/source-code.php)似乎也很棒。

另外：[这](http://developer.valvesoftware.com/wiki/Modding_Sites)是一个很棒的列表，包括一般和特定主题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T17:24:36.890

我会做我对任何其他模糊系统所做的事情......设置很多断点并通过观察它的功能来感受结构。随时添加您自己的评论/文档。通过做一些小的改变来测试你的理解，看看你是否得到了预期的结果。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-24T03:24:39.930

我已经使用 Source SDK 做了一些修改。真的，你必须对 C 和 C++ 有很好的理解。Source SDK 不是现代 C++，它更类似于带有类的 C，而不是任何真正的 OOP。

SDK 很简单，主要代码由实体组成，其中许多可以忽略。

还知道 SDK 大量使用继承，因此请查看基类以获得您可能需要的功能。

我会说列出可能与您希望使用 SDK 执行的操作相关的重要文件和类。然后开始使用 VS 中的虚拟文件夹（或文件系统上的真实文件夹）对这些文件进行排序，并使用 find in files 选项（或 grep）来查找您的方式。

一些示例文件： eiface.h - 引擎接口 gameinterface.cpp/.h - 来自服务器外部 dll 的大量接口 cdll_client_int.cpp/.h - 来自客户端外部 dll 的大量接口 *_gamerules.cpp/.h - 游戏规则（确定游戏逻辑） world.cpp - 确定地图属性并加载游戏规则和其他实体的实体

还可以尝试使用 Source SDK Base 而不是 HL2MP Base 作为 mod。前者更清洁，更容易构建。

# c++ - 网上对变量、指针、引用和内存地址的最佳解释在哪里？

> ID：803412
> 
> 赞同：4
> 
> 时间：2009-04-29T17:24:34.627
> 
> 标签：c++, c, objective-c, pointers

虽然我认为我现在已经掌握了（灯泡现在很亮但仍然有点闪烁），但我想阅读更多关于指针、变量、引用、内存地址等的内容。只是整件事，即在听到“参考”一词时我必须理解的内容（认为它只是一个指针，不确定）。

所以让我们知道你的消息来源！很棒的文章、书籍、PDF、视频等等。任何事情都值得赞赏。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T18:52:04.510

[C++ 中的指针、引用和数组](http://www.gnomesane.net/code/doc/ptrarray/)对基础知识进行了精彩的解释。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T17:29:13.680

用一本书帮助自己。一个很好的是来自 Apple的[“The Objective-C Programming Language” 。](http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/ObjC.pdf)它写得很好而且免费：

另见：

*   Stephen Kochan 的“Objective-C 编程”
*   James Duncan 的“用 Objective-C 学习 Cocoa”

至于 C 和 C++ 资源：这些资源之前已在 SO 上讨论过——尝试搜索该站点。

*   [目标 C 资源](https://stackoverflow.com/questions/7571/cocoa-and-objective-c-resources)
*   [The Definitive C++ Book Guide and List](https://stackoverflow.com/questions/388242/the-definitive-c-book-guide-and-list)
*   [权威的 C 书籍指南和清单](https://stackoverflow.com/questions/562303/the-definitive-c-book-guide-and-list)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T17:30:56.470

我发现最令人困惑的是 C 中数组和指针之间的区别。这是最终向我解释的[C 常见问题解答。](http://www.it.usyd.edu.au/~dasymond/mirror/c-faq/aryptr/aryptrequiv.html)

在此处阅读有关指针和数组的[整个常见问题解答。](http://www.it.usyd.edu.au/~dasymond/mirror/c-faq/aryptr/index.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-29T18:59:06.430

我一直很喜欢这个：

[http://cplusplus.com/doc/tutorial/](http://cplusplus.com/doc/tutorial/)

当然还有这个常见问题

[http://www.parashift.com/c++-faq-lite/](http://www.parashift.com/c++-faq-lite/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-01T16:21:28.287

关于指针：

> Kenneth Reek 在 C 上的指针

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-01T16:35:37.253

我正在学习工程学，我们在 C 语言中进行了这个小速成课程，并阅读了 Deitel 的这本书，名为“如何编程 C”。它涵盖了所有基础知识，并包含一些代码示例。

然而; 指针可能很难获得，尤其是仅阅读它们时。我强烈推荐[Richard Buckland 的这个关于指针的讲座](http://www.youtube.com/watch?v=Rxvv9krECNw)。

然后，当然，只需开始实验。这是学习这门学科的最佳方式。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-04-16T01:22:03.850

这必须是我遇到过的最清晰、最棒的指针教程和参考。

[http://cslibrary.stanford.edu/](http://cslibrary.stanford.edu/)

它不假设任何先决条件，它从基础慢慢构建到最高级的主题，并且也有很多代码和示例问题。

感谢 Nick Parlante 提供了这个很棒的资源。

许多其他有用的资源可在 [http://www-cs-faculty.stanford.edu/~nick/](http://www-cs-faculty.stanford.edu/~nick/)

# iphone - 更新 UIAlertView 标题

> ID：803414
> 
> 赞同：0
> 
> 时间：2009-04-29T17:24:42.317
> 
> 标签：iphone, synchronous

我正在将一堆文件从 iPhone 上传到网络服务。我想在屏幕上有一个 UIAlertView，里面有一个 UIActivityIndi​​catorView。我让它工作正常。但是，我想在每个文件上传时更新 UIAlertView 的标题。（“正在上传文件 1...”、“正在上传文件 2...”等）

我知道您不能只在具有同步 Web 请求的循环中设置标题，因为 UI 运行循环永远不会被调用。我尝试使用 NSTimer 来触发 Web 请求，但由于每个请求的持续时间都是不可预测的，所以这是行不通的。（该消息可能会在请求实际完成之前更新。）

我真的很想同步上传每个文件，一次一个，因为 iPhone 的带宽非常有限。我只是想不出一种机制来说“一旦这个同步操作完成，让 UI 更新一下，然后再做另一个同步操作。”

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T18:06:41.517

好的，这是我解决这个问题的方法：

1.  创建 UIAlertView
2.  启动异步 Web 请求以发布项目，将委托设置为 self
3.  在 connectionDidFinishLoading: 方法中，检查是否还有更多要发布的项目。如果有，请更新标题并启动另一个异步请求。如果没有，请关闭警报。

这意味着您必须维护一些类变量来跟踪正在上传的请求，但它可以完美地工作并且不涉及任何复杂的线程或其他任何东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-03-14T21:49:23.197

你试过这个吗？

```
alertView.title = @"new title";
[alertView setNeedsDisplay]; 
```

# xml - 在 XML 文档中使用特殊字符

> ID：803420
> 
> 赞同：1
> 
> 时间：2009-04-29T17:26:45.823
> 
> 标签：xml

我想知道如何使用字符`"&#xA;"`（LINE FEED）来分隔属性中的一些信息。看下面的例子：

```
<element attrinfo="info1=109&#xA;info2=108&#xA;info3=107" /> 
```

我`SetAttribute()`用来设置属性的文本，但是当我保存 XML 时，其中的信息`attrinfo`如下所示：

```
<element attrinfo="info1=109&amp;#xA;info2=108&amp;#xA;info3=107" /> 
```

是一个特殊字符，因此 XML将`"&"`其替换为`"&amp;"`

我该如何解决这个问题？我看到了一些关于使用实体引用的东西，但我不明白如何使用它。

这是我使用 \n 的代码：

```
ls_DadosAdicionais = "volume=1800;peso=78;altura=157"
ll_pos = POS( ls_DadosAdicionais, ";" ) 
DO
    ls_DadosAdicionais = REPLACE( ls_DadosAdicionais, ll_pos, 1, '~n' )
    ll_pos = POS( ls_DadosAdicionais, ";", ll_pos + 1 )
LOOP WHILE ll_pos > 0
lo_exm = io_xml.createElement( "exame")
lo_exm.SetAttribute( "dados_adicionais", ls_DadosAdicionais ) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T17:33:45.090

您应该将实际的换行符保存到属性中。转义由 API 处理。

换句话说：如果您保存字符串`"&#xA;"`，API 会正确地将其转义为，以便您在再次读取数据时`"&amp;#xA;"`取回字符串。`"&#xA;"`始终存储您要存储的*数据，切勿进行任何手动转义。*

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T17:34:46.863

SetAttributes 自动进行实体翻译。不要手动替换换行符。只需在传递给 SetAttribute 的字符串中包含 \n。保存时它应该被翻译成正确的实体。

# sql-server - Microsoft Sql Management Studio、SQL Server 代理、使用动态参数构建插入批量

> ID：803423
> 
> 赞同：2
> 
> 时间：2009-04-29T17:27:08.613
> 
> 标签：sql-server, dynamic, insert, bulk

这是开头的语法（省略了分类数据）

```
BULK INSERT 
[dbName].[dbo].[data_200801] FROM '\\servername\wwwroot\path\Files\data_200904.csv' WITH 
      (
         FIELDTERMINATOR = ';',
         ROWTERMINATOR =  '\n'
      ); 
```

作为工作的步骤之一，这可以正常工作。我碰壁的地方是我需要使用 SQL 函数动态文件名，例如

文件名 = data_ & 年(GetDate()) & 月(GetDate()) & .csv

我似乎无法在我的工作中连接动态功能。

喜欢挑战的人可以帮助我吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T17:34:46.350

创建一个存储过程，将其作为动态 sql 执行，使用您的文件名方法在字符串中构建命令。从作业中运行这个新的存储过程。

```
CREATE PROCEDURE MyBulkInsert
AS
DECLARE @Query   varchar(500)
SET @Query='BULK INSERT [dbName].[dbo].[data_200801] FROM ''\servername\wwwroot\path\Files\data_'+CONVERT(varchar(4),Year(GetDate()))+RIGHT('0'+CONVERT(varchar(2),Month(GetDate())),2)+'.csv'' WITH ( FIELDTERMINATOR = '';'', ROWTERMINATOR = ''\n'' );'
EXECUTE (@Query)
Go 
```

从作业而不是批量插入命令运行该过程

# javascript - 在线 Javascript 代码评估工具

> ID：803424
> 
> 赞同：18
> 
> 时间：2009-04-29T17:27:54.760
> 
> 标签：javascript, debugging

在开发 Javascript 期间，您的工具箱中是否有最喜欢的网站或本地页面来帮助您？

可以帮助你的东西：

*   证实
*   跑
*   调试，检查
*   单元测试

寻找将我的 JS 粘贴到的地方，单击“运行”按钮，然后让它评估语句。这可能是用于操作数字、字符串、自定义对象等的简单片段。

**回答**（因为在关闭问题之前没有答案实际上满足了要求：

*   [turb0js](http://www.turb0js.com/) - 让您可以单步执行代码，而无需打开浏览器的控制台并寻找正确的 JavaScript 文件。还允许向代码片段添加 HTML 描述，以及来自其他用户的评论。DOM 和 Console 方法不起作用。
*   jsbin[`// noprotect`](http://jsbin.com/blog/protection#comment-1590869196)在代码开头加上，在浏览器控制台中启用调试

未回答：Codepen（无法调试，因为它在编辑创建新脚本时自动运行）；JSFiddle（不直接支持浏览器控制台）

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-29T17:33:51.047

看看[JsBin](http://jsbin.com)，它是一个很棒的在线协作式 JavaScript 调试工具……

您可以轻松合并最流行的 JavaScript 库，甚至可以将其用于 Ajax 请求调试...

查看[介绍视频](http://jsbin.com/videos)...

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-08-16T19:04:08.510

[jsfiddle.net](http://jsfiddle.net/)是你需要的

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-29T17:29:41.743

[JSLint](http://www.jslint.com/)对验证 JS 有很大帮助。

在运行/调试方面，我在 Firefox 上使用[Firebug](http://getfirebug.com/)，而 Opera/Safari/IE8 内置的 JS 调试器。（这些都不是在线的，但都非常强大。）我认为[Firebug Lite](http://getfirebug.com/lite.html)会成为一个不错的在线 JS 调试器（因为它是一个书签，而不是插件或特定的浏览器功能）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-29T17:31:02.333

它是 Firefox 扩展，不是在线服务，但如果您需要执行任意 JavaScript 进行调试，您应该查看[Firebug 。](http://getfirebug.com/)如果您需要对其他浏览器的支持，或者[Firebug Lite 。](http://getfirebug.com/lite.html)

如果您使用的是基于 WebKit 的浏览器（Safari 或 Chrome），那么您可以使用[Web Inspector](http://webkit.org/blog/197/web-inspector-redesign/)。我认为 IE 8 和 Opera 也有相当的功能。

如果需要从命令行运行 JavaScript，可以直接使用[SpiderMonkey](http://www.mozilla.org/js/spidermonkey/)；它有一个可以运行的 JavaScript REPL。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-05-11T21:27:22.800

[您可以使用Overbyte](http://www.3site.eu/jstests/jhp/)在线运行/调试 javascript

# .htaccess - 将 .com 重定向到 .htaccess 中的 .org

> ID：803432
> 
> 赞同：7
> 
> 时间：2009-04-29T17:30:14.130
> 
> 标签：.htaccess, redirect

我有 domain.com 和 domain.org 作为指向同一个虚拟主机的别名。如何使用 .htaccess 将所有 domain.com 请求重定向到 domain.org？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-29T17:33:38.537

您可以使用[mod_rewrite](http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html)来执行此操作。

```
RewriteEngine on
RewriteCond %{HTTP_HOST} !^example\.org$
RewriteRule ^ http://example.org%{REQUEST_URI} [L,R=301] 
```

此规则将每个未发送到`example.org`相同的请求重定向。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2016-06-21T09:59:27.497

将所有 www/non-www 重定向`domain.com`到`domain.org`：

```
RewriteEngine On
RewriteBase /

RewriteCond %{HTTP_HOST} ^(www\.)?domain\.com$ [NC]
RewriteRule ^(.*)$ http://www.domain.org/$1 [R=301,L] 
```

# c - 在 C 中使用 socket_stream 传输 jpg 文件

> ID：803435
> 
> 赞同：0
> 
> 时间：2009-04-29T17:30:29.247
> 
> 标签：c, sockets, jpeg

我想知道是否通过 socket_stream 发送带有 jpg 扩展名的文件，这会自动将字节转换为 jpg ？或者需要实现一些算法来将大量字节转换为图像......请有人解释一下我的方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T17:40:29.707

JPEG 图像只不过是根据 JPEG 格式组织的一堆字节。网络套接字不会将随机字节组织成 JPEG 格式。您可以通过套接字将构成 JPEG 格式图像的字节作为二进制 blob 发送，在另一端接收它，然后将其写入具有`.jpg`扩展名的文件。应用程序可以根据扩展名将此文件解释为 JPEG 图像并尝试显示它。但是您仍然有责任提供一组被组织为 JPEG 图像的字节。

# sql-server - 更改作为 SQL SVR 2005 中合并复制源的表的 PK 列的正确步骤是什么？

> ID：803437
> 
> 赞同：0
> 
> 时间：2009-04-29T17:30:40.713
> 
> 标签：sql-server

我有一个表，其中有一个标识列作为主键。此时表中的所有数据都不重要，因此我可以将其全部删除，但我想将列从 int 更改为 bigint 并可能将其重新设置为 bigint.minvalue 以便在用完之前提供最大可能的范围价值观。我想这样做而不必重建复制或修改订阅者。

如果我执行

```
alter table MyTable
    alter column MyTableId bigint not null 
```

我得到错误：

```
Msg 5074, Level 16, State 1, Line 5
The object 'repl_identity_range_CEEB13F5_11D2_435C_BE5D_EBF91EBF8DE7' is dependent on column 'MyTableId'.
Msg 5074, Level 16, State 1, Line 5
The object 'PK_MyTable' is dependent on column 'MyTableId'.
Msg 4922, Level 16, State 9, Line 5
ALTER TABLE ALTER COLUMN MyTableId failed because one or more objects access this column. 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T17:51:35.110

您不能更改已发布表上的主键，因为它是用于推送数据的系统的一部分；所以从出版物中删除表格；进行更改并重新发布。

您可以使用 sp_droparticle [http://msdn.microsoft.com/en-us/library/ms173832.aspx删除表](http://msdn.microsoft.com/en-us/library/ms173832.aspx)

然后让你的桌子/你的钥匙改变

最后使用 sp_addmergearticle 将其添加回[http://msdn.microsoft.com/en-us/library/ms174329.aspx](http://msdn.microsoft.com/en-us/library/ms174329.aspx)

# php - 如何在 CakePHP 中使用命名参数查询模型？

> ID：803447
> 
> 赞同：0
> 
> 时间：2009-04-29T17:33:40.550
> 
> 标签：php, model-view-controller, cakephp

```
url: /contents/view/chapter:models/section:associations

class ContentsController extends AppController {
     function view() {
          $this->params['named'];
     }
} 
```

例如，我有上面的 url 和控制器，目标是使用 url 中的键/值信息来查询数据库。我将如何创建一个模型来做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T19:27:19.637

您需要使用传递的Args 数组：

网址：/contents/view/chapter:models/section:associations

```
class ContentsController extends AppController {
         function view() {
              $foo = $this->Foo->find(
                  array('chapter'=>$this->passedArgs['chapter'],
                        'section'=>$this->passedArgs['section']));
         }
    } 
```

这可以作为 Cake 1.2 的一部分提供，或者添加以下内容：

[Cake PHP - 传递命名参数](http://bakery.cakephp.org/articles/view/passing-named-parameters)

# sql-server - 如何在生产服务器上复制数据库布局更改？

> ID：803455
> 
> 赞同：1
> 
> 时间：2009-04-29T17:36:19.933
> 
> 标签：sql-server

假设我想向运行 SQL Server 2008 作为数据源的 ASP.NET MVC 应用程序添加一个新功能。为了实现这个新特性，我需要在现有数据库表中添加一些新列。

在我的开发服务器上执行这些更改并实现新功能之后，在部署我的应用程序的新版本时，在生产服务器上执行相同的数据库更改的最简单方法是什么？有什么办法可以自动化吗？

**编辑：**正如我刚刚发现的，Visual Studio 2008 的服务器资源管理器似乎能够通过比较两种不同的数据库布局（右键单击数据库，单击“比较架构”）为我提取必要的更改。这通常能满足我的要求吗？或者在使用这个功能时有什么大问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T17:40:55.587

如果您的需求相对简单，Red Gate 的[SQL 比较实用程序可能会帮您完成。](http://www.red-gate.com/products/SQL_Compare/index.htm)如果没有，像 ER-Win 或 ER-Studio 这样的工具可以处理核心架构和迁移。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T17:46:02.780

我相信使用类似于[K Scott Allen 描述](http://odetocode.com/Blogs/scott/archive/2008/01/31/11710.aspx)的方法的手动生成的脚本对数据库进行版本控制非常值得花时间投资。但不是您要求的自动化解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T18:00:29.597

你应该有数据库和应用层版本控制。时期。如果您在生产中使用版本 db 1.0 和应用程序层 1.0，那么之后为版本 1.1 和 1.1.5 执行的所有更改都应该可以通过脚本“升级”。所有“alter table”和“alter proc”语句都可以通过脚本运行。

或者：将 1.0 db 恢复到 db_old 数据库。从脚本创建生产数据库并复制数据（如果您没有非常复杂的数据库应该不难）applayer 1:0 的自动部署。

再一次，对于整个过程，您必须在 DEV 中对其进行训练，在 TEST 中进行测试，在 qa 中验证它，然后在最近在 PROD 环境中执行它。

编辑：我个人认为，如果团队不能在 DEV 上同时从 1.0 版顺利升级到 1.1 版 - 闻起来像是糟糕的设计，并且混合了应用层上应该是什么以及数据库服务器上应该是什么的责任

# active-directory - 我在哪里可以获得企业目录结构？

> ID：803457
> 
> 赞同：3
> 
> 时间：2009-04-29T17:37:17.343
> 
> 标签：active-directory, ldap, enterprise, directory-structure

我希望能够加载具有实际大中型企业目录结构（组、用户）的 Active Directory 服务器，以便我可以在使用该数据的应用程序上运行性能测试。在我的幻想世界中，一些大公司会以我可以直接导入的方式导出他们的（匿名的）广告结构。由于这似乎不太可能发生，有没有人知道测试数据的来源可以提供对 10 到 10 万员工组织结构的合理模拟？我可以自己生成数据，但我不想对组嵌套级别、给定用户是多少组的直接成员等做出太多假设。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-12T18:35:18.567

我的公司适合你的范围。这里有一些统计数据可以帮助您模拟环境：我们每个部门都有一个顶级 OU。所有用户、计算机和组帐户都位于其中一个帐户下。每个部门都有自己的管理团队，并授权他们控制自己的 OU 结构。一些团队具有广泛的结构，每个部门都有 OU，他们下有用户，组 OU 和计算机的其他 OU。其他人的结构很深，OU 中的 OU 中的 OU 中的 OU 中 - 我认为当前的最大值为 12。其他的有胖（为了更好的词）结构：单独的用户、计算机和组 OU，但没有进一步细分用户或计算机（因此每个帐户中可能有数千个帐户）。分支机构往往有自己的 OU，下面是用户、计算机和组，在一个部门 OU 下。

我们达到了组成员身份的令牌大小限制。一些管理团队拥有庞大、复杂的委派管理结构，用户可能位于数百个组中。其他人有简单的，但组策略组、分发组和普通安全组仍然可以为用户带来 50 或 60 个组。我们还将组用于计算机组策略和软件分发，因此大多数计算机将是 5-30 个组。有几个应用程序使用 AzMan（CN 中的数据=程序数据）。

组的嵌套深度通常不会超过 3 或 4 层，因为它会变得非常混乱。

我们有大约 35,000 个用户和 20,000 个组。

希望有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T20:33:48.120

TechNet ScriptCenter Repository 有一堆用于生成用户、组和 OU 的示例脚本。
[http://www.microsoft.com/technet/scriptcenter/scripts/default.mspx?mfr=true](http://www.microsoft.com/technet/scriptcenter/scripts/default.mspx?mfr=true)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T08:27:44.653

我知道 OpenDS 包括在安装时安装示例数据的选项，但不包括您正在谈论的条目数。鉴于 LDAP 目录通常包含敏感信息，如果您能够从真实公司获取数据，即使是匿名的，我也会感到惊讶。

是否值得四处寻找一些公开可用的 LDAP 服务器并联系管理员？你可能会走运。

或者，我怀疑最好的选择是构建自己的数据。以我的经验，无论如何，公司目录结构往往是相当扁平的，因此除非您有特定要求，否则您不需要复杂的 DIT 结构。

我会用这样的东西：

dc=example,dc=com
-->ou=people
-->-->uid=user1
-->-->uid=user2
-->-->uid=...
-->ou=groups
-- >-->ou=group1
-->-->ou=group2
-->-->ou=...

我知道您提到您知道如何创建自己的 LDAP 条目，但我可以推荐 MakeLDIF 工具吗？MakeLDIF 附带[SLAAMD](http://www.slamd.com)，这是一个出色的免费工具，用于性能测试和基准测试 LDAP 服务器。MakeLDIF 非常有用，因为它允许您定义目录结构，以及模板文件中的条目结构。您将没有“真实”数据，但您应该能够生成它的合理近似值。

也许有一种可能性是[从 ApacheDS 之类的东西中获取示例目录数据](http://directory.apache.org/apacheds/1.0/15-about-the-sample-configurations-and-sample-directory-data.html "ApacheDS")来构建一个基本模板以馈入 MakeLDIF。

我希望这会有所帮助。

R

# latex - 表外的标题？

> ID：803463
> 
> 赞同：26
> 
> 时间：2009-04-29T17:38:52.783
> 
> 标签：latex

我正在尝试向乳胶中的表格添加标题，但是它会引发此错误“！LaTeX 错误：\caption outside float。” 从错误中我猜 ti 意味着它在桌子外面，但我已经清楚地把它放在里面。

```
\begin{tabular}{|c|c|c|c|c|c|}
\caption{Table1}
Potentiometer & Resistance  & \multicolumn{2}{c}{Calculated V\textsubscript{32}} & \multicolumn{2}{c|}{Measured V\textsubscript{32}}\\ \cline{3-6}
Position & R\textsubscript{34} & Amplitude & Phase & Amplitude & Phase\\ \hline \hline
1 & 303.8 & & 2.73 & 28.2 & 2.51\\
2 & 1.141k & & 1.81 & 28.2 & 1.63\\
3 & 3.453k & & 0.79 & 28.2 & 0.5\\
4 & 5.33k & & 0.53 & 28.2 & 0.38\\
5 & 7.45k & & 0.38 & 28.2 & 0.25\\
6 & 9.54k & & 0.30 & 28.2 & 0.13\\
7 & 10.84k & & 0.27 & 28.2 & 0.13\\
\hline
\end{tabular} 
```

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-04-29T17:46:53.233

表格环境不会带标题。你需要做这样的事情：

```
\begin{table}
\begin{tabular}{|c|c|c|c|c|c|}
Potentiometer & Resistance  & \multicolumn{2}{c}{Calculated V\textsubscript{32}} & \multicolumn{2}{c|}{Measured V\textsubscript{32}}\\ \cline{3-6}
Position & R\textsubscript{34} & Amplitude & Phase & Amplitude & Phase\\ \hline \hline
1 & 303.8 & & 2.73 & 28.2 & 2.51\\
2 & 1.141k & & 1.81 & 28.2 & 1.63\\
3 & 3.453k & & 0.79 & 28.2 & 0.5\\
4 & 5.33k & & 0.53 & 28.2 & 0.38\\
5 & 7.45k & & 0.38 & 28.2 & 0.25\\
6 & 9.54k & & 0.30 & 28.2 & 0.13\\
7 & 10.84k & & 0.27 & 28.2 & 0.13\\
\hline
\end{tabular}
\caption{Table1}
\label{tab:xyz}
\end{table} 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-04-29T18:05:41.783

如果您不想使用“浮动”（例如表格或图形）将“浮动”远离您定义它的位置，您可以添加：

```
\usepackage{capt-of} 
```

在序言中，然后执行以下操作：

```
\begin{center}
  \captionof{table}{Caption text goes here}
  \label{table1} % for use in \ref{table1} if you want to refer to the table number
  \begin{tabular}{|c|c|c|c|c|c|}
  % etc.
  \end{tabular}
\end{center} 
```

将自动编号的标题添加到非浮点数。

# plugins - 如何在我的 .vimrc 文件中“获取”某些内容？

> ID：803464
> 
> 赞同：106
> 
> 时间：2009-04-29T17:39:14.937
> 
> 标签：plugins, vi, vim

我最近一直在扩展我的 vim-foo 并且我遇到了几个插件（例如[autotag.vim](http://www.vim.org/scripts/script.php?script_id=1343)），这些插件需要在我的 .vimrc 文件中“获取”它们。这到底是什么意思，我该怎么做？

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2009-04-30T03:25:19.690

采购文件就是“执行”它。本质上，文件的每一行都被视为一个命令。采购它与按顺序键入每个命令相同。您使用命令`:source`（通常缩写为`:so`）进行源代码。

所以如果你来源`myStuff.vim`

```
:so myStuff.vim 
```

如果`myStuff.vim`包含这些行

```
set xx iI just intersted this<C-]>
set yy bbbb4dw 
```

就像你在 Vim 中输入这些命令一样

```
:set xx iI just intersted this<C-]>
:set yy bbbb4dw 
```

默认情况下唯一获取的文件是`.vimrc`( `_vimrc`on windows)，因此您可以在此处保存每次设置 Vim 时使用的所有命令。

有趣的是，由于源文件只是一系列命令，而源文件是一个命令，因此您可以从源文件中获取文件。因此，您每次使用的插件都可以在您启动 Vim 时通过在您的`.vimrc`like this中添加一行来获取

```
 so myPlugin.vim 
```

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2009-04-29T17:42:01.527

.vim/plugin 目录中的文件是自动获取（加载）的。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-29T17:47:13.840

总是有[:source file](http://vimdoc.sourceforge.net/htmldoc/repeat.html#:source)命令。我通常编写`.vimrc`包含自定义命令和不用于控制台应用程序的内容，然后编写包含`.gvimrc`适用于窗口版本的其他好东西。我`.gvimrc`首先`source $HOME/.vimrc`从控制台版本中获取所有内容，然后再添加新内容。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-29T18:06:16.197

通常有两个 vimrc 文件，一个是 _vimrc，另一个是 _gvimrc（第一个是 vim 的东西，第二个是 gvim - 图形的东西）——尽管我认识的大多数人只是把所有东西都放在 _vimrc 中。

一个好的做法是将所有额外的文件（插件、颜色方案、片段......）保存在单独的（您自己的）vimfiles 目录中（您可以随身携带）。

如果你这样做

```
:help vimfiles 
```

vim 会告诉你的 vimfiles 目录应该在哪里。这在一定程度上取决于平台（win、unix）。在 Windows 上，通常位于您的用户文件夹中（文档和设置，然后是用户...）。在 vimfiles 目录中有几个子目录。其中包括“插件”子目录。放入该目录的插件将自动加载（也将插件放入“插件”的子目录中）。如果您不想自动加载它，只需将其放在“vimfiles”或其他目录中，然后

```
:so plugin_name.vim (with the appropriate path)
(you can use the $vim, $vimfiles, and $home as shortcuts when defining path to plugin) 
```

# java - Java中的隐式超级接口？

> ID：803466
> 
> 赞同：4
> 
> 时间：2009-04-29T17:39:35.060
> 
> 标签：java, interface

所以我们都知道所有的类都隐式地扩展了Object。接口呢？有隐式的超级接口吗？我说有。以下代码编译：

```
java.io.Serializable s1 = null;
java.io.Serializable s2 = null;

s1.equals(s2); 
```

该`equals`方法不是在 Serializable 中声明的，而是在 Object 中声明的。由于接口只能扩展其他接口，而 Object 是一个类，而不是接口，因此必须有一些隐式接口正在被扩展。然后`Object`该类必须隐式实现这个隐式接口（哇，写起来很奇怪）。

所以，问题是，这有多正确？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-29T17:47:50.733

> 由于接口只能扩展其他接口，而 Object 是一个类，而不是接口，因此必须有一些隐式接口正在被扩展。

没有。引用[Java 语言规范](http://java.sun.com/docs/books/jls/third_edition/html/names.html#6.4.4)：

> 如果接口没有直接的超接口，则**接口隐式声明一个公共抽象成员方法**m，其签名为 s，返回类型为 r，并且 throws 子句 t **对应于每个签名为 s、返回类型为 r 和 throws 子句的公共实例方法**m**在 Object 中声明**，除非接口显式声明了具有相同签名、相同返回类型和兼容 throws 子句的方法。如果在 Object 中将 m 声明为 final 的情况下，接口显式声明了这样的方法 m，则会出现编译时错误。

这与您的“隐式超级接口”之间的区别在于它`Object`具有许多最终方法和受保护方法，并且您不能在接口中使用这些修饰符。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-29T17:42:55.970

这里的 s1 和 s2 是对象引用，指的是实现 Serializable 的对象的实例。Java 中没有接口引用之类的东西。

所以Java 知道无论这些对象是什么，它们都是java.lang.Object 的后代。因此上面的代码是有效的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T17:44:12.613

当您声明如下内容时：

```
java.io.Serializable s1 = null; 
```

不要忘记 Java 中的所有内容都源自`Object`. 所以在这里，你只是说那`s1`是**某种东西**（或者是`Object`某个类扩展`Object`）`implements Serializable`。没有魔法。Java 中的一切都是从`Object`它是否显式派生而来的。因此，该`equals`方法始终可用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T17:46:40.893

我不认为有任何超级界面。

当您声明这样的变量时：

```
java.io.Serializable s1 = null; 
```

你还没有创建任何`Object`.

编译器知道这一点`s1`并将`s2`实现`Serializable`并将继承自，`Object`因此它允许`equals`.

# client-server - 如何在具有许多客户端的服务器上同步列表？

> ID：803468
> 
> 赞同：1
> 
> 时间：2009-04-29T17:40:06.290
> 
> 标签：client-server

考虑一个托管许多桌子的扑克游戏服务器。当玩家在大厅时，他有一个所有活动桌及其统计数据的列表。当玩家加入、玩和离开牌桌时，这些统计数据会不断变化。可以添加和关闭表格。不知何故，这些更改必须通知客户。

您将如何实现此功能？你会为大厅使用 TCP/UDP（也就是说，用户应该连接到服务器来观察大厅，还是你会使用请求-响应机制）？服务器会通知客户端每个事件，还是客户端轮询服务器？

请记住这一点：也许这样一个系统最重要的目标是可扩展性。添加更多服务器应该很容易以应对日益增长的用户需求，而所有用户都应该看到一个包含多个服务器的大列表。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T17:50:15.737

这个特定问题是应用程序设计中一个非常基本的问题的表现——客户端应该如何连接到服务器。

当可伸缩性成为一个问题时，总是求助于可伸缩的解决方案，使用非阻塞 I/O 模式，例如[Reactor 设计模式](http://en.wikipedia.org/wiki/Reactor_pattern)。更可取的是使用已经具有此类模式的工作和测试实现的标准解决方案。

特别是在您的情况下，它涉及一个不断更新的快速动作游戏，使用可扩展服务器（同样，非阻塞 I/O）听起来很合理，它通过 TCP 与每个客户端保持连接，并更新他他需要知道的信息。

请求-响应周期听起来不太适合您的情况，但这应该根据您的应用程序的确切规范进行验证。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T17:50:24.520

这是我的基本建议：

服务器通过一个接口更新列表（添加、删除和更改现有项目），该接口保留已应用于列表的固定长度操作队列。每个操作都有一个时间戳。当队列已满时，最旧的操作将逐渐被丢弃。

当用户第一次需要检索列表时，它会要求服务器向他发送完整的列表。服务器发送带有当前时间戳的列表。

每个任意时间段（10-30 秒？）客户端要求服务器向他发送自他获得时间戳以来已应用于列表的所有操作。然后服务器检查时间戳是否仍然出现在列表中（也就是说，它大于第一项的时间戳），如果是，则向客户端发送从那时到现在发生的操作列表，加上当前时间戳。如果它太旧，服务器会再次发送完整列表。

UDP 似乎适合这种方法，因为如果偶尔丢失“更新周期”也没什么大不了的。

# php - 使用 PHP Soap Server 捕获类型不匹配

> ID：803472
> 
> 赞同：2
> 
> 时间：2009-04-29T17:41:30.170
> 
> 标签：php, soap

我有一个 PHP5 Soap 服务器正在运行，我想捕捉类型不匹配，但我认为它们甚至没有进入我的代码。

发生的事情是这样的，在我的 WSDL 中我有（简化的）：

```
<complexType name="Publishing">
 <all>
  <element name="EmailBlast" type="xsd:boolean"/>
  <element name="PublishRadius" type="xsd:int"/>
 </all>
</complexType> 
```

这很好，只要 Publish Radius 字段中有一个整数（或空值）就可以正确通过。但是，如果我尝试通过非整数发送，除此之外，我在响应中什么也得不到：

```
<SOAP-ENV:Fault>
  <faultcode>SOAP-ENV:Server</faultcode>
  <faultstring>SOAP-ERROR: Encoding: Violation of encoding rules</faultstring>
</SOAP-ENV:Fault> 
```

我想抓住这个并返回一些更有用的东西，但它似乎甚至没有进入我的逻辑。有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T23:06:38.080

我相信您看到的错误（SOAP 错误）是由 Soap 客户端生成的，而不是发送到 SOAP 服务器。

# asp.net - 是否可以在编译时捕获丢失的事件处理程序？

> ID：803476
> 
> 赞同：1
> 
> 时间：2009-04-29T17:42:29.793
> 
> 标签：asp.net

如果 ASP.NET 控件声明了未实现的事件处理程序，是否有任何方法会导致编译错误？例如，我声明了一个 TextBox

```
<asp:TextBox ID="uxFeeQty" runat="server" MaxLength="2" Columns="2" 
    AutoPostBack="true" 
    OnTextChanged="ReCalculateFees" 
    style="text-align:right;" /> 
```

但忽略了实现 ReCalculateFees 事件处理程序。在我浏览到该页面并引发运行时异常之前，此错误并不明显。有没有办法在编译时捕获这个错误？我可以用代码而不是声明方式订阅我的处理程序，但这需要大量的清理工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T17:46:59.253

不是建议花更多的钱，但[ReSharper](http://www.jetbrains.com/resharper)的解决方案范围分析会为您标记所有这些内容。它经常拯救我，足以证明该工具的价格是合理的。

# sharepoint - SharePoint 中的 LayoutsPageBase 和 CAS 策略

> ID：803477
> 
> 赞同：3
> 
> 时间：2009-04-29T17:42:31.993
> 
> 标签：sharepoint

我在 SharePoint 中创建了一个应用程序页面，以托管在 LAYOUTS 目录中。该页面继承自 LayoutsPageBase，目前没有其他代码。ASPX 文件设置为从此类/程序集继承。很简单。

我的问题是我想将我的程序集部署到应用程序 BIN 目录（不是 GAC）并使用 CAS 权限策略允许它在 SharePoint 中执行。但是，此时，每当我部署页面时，都会出现此异常：

> 请求失败。在 System.Reflection.Assembly._GetType(String name, Boolean throwOnError, Boolean ignoreCase) 在 System.Web.UI.TemplateParser.GetType(String typeName, Boolean ignoreCase, Boolean throwOnError) 在 System.Web.UI.TemplateParser.ProcessInheritsAttribute(String baseTypeName、String codeFileBaseTypeName、String src、Assembly 程序集）在 System.Web.UI.TemplateParser.PostProcessMainDirectiveAttributes（IDictionary parseData）

在我得到权限错误的所有其他情况下，异常表明我缺少哪个特定权限（例如 SqlClientPermission 或 FileIOPermission）。

我知道这个问题与 CAS 相关，因为当我部署到 GAC 时它工作正常。

我当前的 CAS 权限如下所示：

```
      <PermissionSet class="NamedPermissionSet" version="1" Name="MyPermissionSet">
        <IPermission class="AspNetHostingPermission" version="1" Level="Minimal" />
        <IPermission class="SecurityPermission" version="1" Flags="Execution, SkipVerification, UnmanagedCode, ControlEvidence" />
        <IPermission class="Microsoft.SharePoint.Security.SharePointPermission, Microsoft.SharePoint.Security, Version=12.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" version="1" Unrestricted="True" ObjectModel="true" />
        <IPermission class="System.Data.SqlClient.SqlClientPermission, System.Data, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" version="1" Unrestricted="true" />
        <IPermission class="System.Security.Permissions.ReflectionPermission, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" version="1" Unrestricted="true" />
        <IPermission class="System.Data.OracleClient.OraclePermission, System.Data.OracleClient, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" version="1" Unrestricted="true" />
      </权限集>
```

我目前的想法是它与 LayoutsPageBase 类有关，因为当我将其更改为从基本 System.Web.UI.Page 继承时，该页面在我的 CAS 策略下运行良好。

我在我的程序集上使用了 Microsoft 提供的 permcalc 工具，并添加了它发现的权限，但问题没有解决。

所以我的长篇大论的问题是：有没有人部署过使用 CAS 策略从 SharePoint 的 LayoutsPageBase 继承的应用程序页面，您需要在 CAS 策略中指定哪些权限才能使其正常工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T20:23:44.323

好的，想通了。Microsoft.SharePoint.WebControls 命名空间的 LayoutsPageBase 类修饰如下：

> [PermissionSet(SecurityAction.InheritanceDemand, Name="FullTrust"), PermissionSet(SecurityAction.LinkDemand, Name="FullTrust")]
> 公共类 LayoutsPageBase : UnsecuredLayoutsPageBase

所以结果是您必须完全信任（通过 GAC 或权限集成员）才能运行从 LayoutsPageBase 继承的应用程序页面。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T22:03:11.337

您是否尝试将程序集部署到 _app_bin 而不是 bin 文件夹？

# javascript - Internet Explorer 6 的 jQuery height() 问题

> ID：803481
> 
> 赞同：4
> 
> 时间：2009-04-29T17:43:44.847
> 
> 标签：javascript, jquery, internet-explorer, height, containers

我正在使用 jQuery 1.3.2。

我无法在 Internet Explorer 6 中获得正确的“高度”。高度值在所有其他浏览器中都是正确的。

我也在使用[wresize jQuery 插件](http://noteslog.com/post/how-to-fix-the-resize-event-in-ie/)。

每次浏览器加载时，我都会触发一个根据浏览器尺寸调整 div、iframe 大小的方法。（这是有充分理由的。）

在 IE 6 中，$('body').height() 的返回值似乎在每次调整浏览器大小后增加了 10 个像素。

其他人遇到过这样的事情吗？

```
var iframeH = 0, h = 0, groupH = 0, adjust = 0;

var tableH = $("#" + gridId + "_DXHeaderTable").parent().height();
var pagerH = $(".dxgvPagerBottomPanel").height();
var groupHeight = $(".dxgvGroupPanel").height();

if (pagerH == null)
    pagerH = 0;

if (groupHeight != null)
    groupH = groupHeight + pagerH;

iframeH = $('body').height();
h = (iframeH - (tableH + pagerH + groupH));

$('#' + gridId + "Panel").css("height", (h + "px"));
$("#" + gridId + "_DXMainTable").parent().css("height", (h + "px")); 
```

此代码用于设置 DevExpress 网格在其父容器中的高度。忽略代码可能更好的事实。:)

除了“身体”之外，还有什么东西可以用来让我得到正确的尺寸吗？我已经尝试过窗口对象 ($(window).height())，但这似乎没有多大帮助。

任何想法表示赞赏！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-11T11:58:11.763

您面临的问题更有可能是 css 渲染差异。由于浮动问题，不同浏览器之间的填充和边距渲染差异。

尝试获取**$("body").innerHeight()**和**$("body").outerHeight()**并在不同的浏览器中进行比较，您会得到一些共同的结果。在最坏的情况下，您可能需要运行某些`if`情况

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T18:52:26.523

当然，这里有几个想法：

使用 IE，尤其是。较旧的 IE，我喜欢在我的高度渲染函数周围添加一个 1-10 毫秒的 setTimeout 语句——它让 dom 和 IE 有机会“放松”

此外，请确保您的内容在页面上可见——为此，您可能需要使用绝对位置暂时将内容从屏幕上扔掉，然后再次在屏幕上显示它们。

另一件事是 height() 有时很不稳定。尝试 .css('height') 检索高度 [它也更快] 并删除 'px' 以获得*有时*更真实的测量值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T12:04:31.340

或者使用 jQuery 的[Dimensions 插件，](http://plugins.jquery.com/project/dimensions)它可以让您使用更多，并且它是跨浏览器。

我使用这个插件来绘制从可拖动到可放置的线条，就像我[在这里展示的那样](https://stackoverflow.com/questions/536676)

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2011-11-09T08:48:04.243

```
$('body').height(); // call this first

iframeH = $('body').height(); //then try this 
```

# .net - NameValueCollection 上的属性 Keys 和 AllKeys 有什么区别？

> ID：803484
> 
> 赞同：45
> 
> 时间：2009-04-29T17:44:23.643
> 
> 标签：.net, collections

System.Collections.Specialized.NameObjectCollectionBase 有两个相似的属性：

```
 string[] AllKeys
  NameObjectCollectionBase.KeyCollection Keys 
```

他们提供不同的数据集吗？我什么时候想使用其中一个？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-04-29T17:53:23.670

`AllKeys`是一个`O(n)`操作，`Keys`而是`O(1)`。这是因为`AllKeys`将密钥复制到一个新数组中，而`Keys`只返回对`NameValueCollection`的私钥集合的引用。因此，除了性能差异之外，返回的集合`Keys`将随着基本集合的变化而变化，因为它只是对原始集合的引用，而`AllKeys`由于它是副本而将与变化隔离。

这个小测试程序显示了行为上的差异：

```
using System;
using System.Collections.Specialized;

static class Program
{
    static void Main()
    {
        var collection = new NameValueCollection();

        var keys = collection.Keys;
        var allKeys = collection.AllKeys;

        collection.Add("Name", "Value");

        Console.WriteLine("Keys: " + keys.Count);
        Console.WriteLine("AllKeys: " + allKeys.Length);
        Console.ReadLine();
    }
} 
```

输出是：

```
Keys: 1
AllKeys: 0 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-29T17:54:11.983

根据 MSDN 的文档，使用 AllKeys 时，检索所有值是 O(n)，而使用 Keys 时是 O(1)。

[钥匙](http://msdn.microsoft.com/en-us/library/system.collections.specialized.nameobjectcollectionbase.keys.aspx)

> 检索此属性的值是 O(1) 操作

[全键](http://msdn.microsoft.com/en-us/library/system.collections.specialized.namevaluecollection.allkeys.aspx)

> 此方法是一个 O(n) 操作，其中 n 是 Count。

所以基本上，Keys 似乎有更好的性能。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-29T18:25:54.650

然而，还有一个额外的好处是，您可以在返回 AllKeys() 时使用 foreach 或 LINQ 语句对您的集合进行操作。由于它是一个副本，因此您在修改当前正在枚举的列表时不会出错。

# c# - 将 C dll 代码编组为 C#

> ID：803488
> 
> 赞同：2
> 
> 时间：2009-04-29T17:46:07.947
> 
> 标签：c#, c, char, unmanaged, marshalling

我在 dll 中有以下 C 代码签名：

```
extern __declspec(dllexport) unsigned char *
funct_name (int *w, int *h, char **enc, int len, unsigned char *text, int *lp, int *mp, int *ep) 
```

C 函数可以修改 w、h、enc、lp、mp 和 ep（尽管后三个可以为 null，它不会做任何事情。

我在 C# 中使用以下内容

```
[DllImport("iec16022ecc200.dll", EntryPoint = "iec16022ecc200", ExactSpelling = false, CharSet = CharSet.Ansi, SetLastError = true, CallingConvention=CallingConvention.Cdecl)]
            static extern IntPtr CallEncode(
            [In,Out,MarshalAs(UnmanagedType.LPArray)] Int32[] width,
            [In,Out,MarshalAs(UnmanagedType.LPArray)] Int32[] height,
            [In,Out,MarshalAs(UnmanagedType.LPStr)] ref StringBuilder encoding,
            int barcodeLen,
            [MarshalAs(UnmanagedType.LPStr)] StringBuilder barcode,
            IntPtr lenp,
            IntPtr maxp,
            IntPtr eccp
            );

public void Foo (string textToEncode,out int width, out int height) {
            StringBuilder text = new StringBuilder(textToEncode);
            StringBuilder encoding = new StringBuilder(new string('a', text.Length));

            Int32[] w = new Int32[1];
            Int32[] h = new Int32[1];

            string encodedStr = Marshal.PtrToStringAnsi(CallEncode(w, h, ref encoding, text.Length, text, (IntPtr)0, (IntPtr)0, (IntPtr)0));
            width = w[0];
            height = h[0];
} 
```

我收到了 SystemAccessViolation，但我不完全确定我的问题是什么时候出现的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T18:46:43.277

不要将 StringBuilder 引用传递给采用 char* 的非托管方法。StringBuilder 内容是 unicode (wchar)。

相反，将 StringBuilder 参数替换为 IntPtr 参数，并使用 Marshal.AllocHGlobal 分配适当大小的缓冲区。

另外我不认为.Net marshaller支持使用“ref”将StringBuilder传递给非托管代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T18:54:55.550

你提到'char **enc'参数可能被被调用者修改，这可能导致'SystemAccessViolation'错误。被调用方可以取消引用和修改 StringBuilder，前提是它不超过 StringBuilders 的容量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-11-04T16:41:11.667

[`StringBuilder`不应使用`out`or`ref`](http://msdn.microsoft.com/en-us/magazine/cc164193.aspx#S4)以引用方式传递。

```
 //...
    [In,Out,MarshalAs(UnmanagedType.LPStr)] ref StringBuilder encoding,
    //... 
```

从类型为 的参数中删除`ref`关键字。这可能是导致您的.`encoding``StringBuilder``SystemAccessViolation`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-08-02T23:28:09.487

我试图在 Unity 中将字符串从 C++ 传递到 C#。我得到的只是胡言乱语。最后，在我看到您的评论@popcatalin 之后，我发现了使用 C# 中的 AllocHGlobal 为字符串分配内存的解决方案。

这是我的 C++ 函数：

```
extern "C" void UNITY_INTERFACE_EXPORT UNITY_INTERFACE_API TestString(char* str, int len)
{
    strcpy_s(str, len, "C++ String!!! UniversalCpp");
    return;
} 
```

这是 Unity 中 C# 脚本的顶部：

```
#if WRCCPP
    [DllImport("UniversalWRCCpp", CallingConvention = CallingConvention.Cdecl)]
#else
    [DllImport("UniversalCpp", CallingConvention=CallingConvention.Cdecl)]
#endif
    private static extern void TestString(IntPtr str, int len);

private IntPtr myPtr = IntPtr.Zero; // Pointer to allocated memory 
```

这是我在 Unity 中调用该函数的 C# 脚本：

```
int sizeInBytes = 100;
myPtr = Marshal.AllocHGlobal(new IntPtr(sizeInBytes));
TestString(myPtr, sizeInBytes);
Debug.Log("ANSI " + Marshal.PtrToStringAnsi(myPtr)); // This prints the correct format 
```

# java - Spring MVC 中的注解

> ID：803495
> 
> 赞同：5
> 
> 时间：2009-04-29T17:47:52.560
> 
> 标签：java, spring, spring-mvc, annotations

我想将此 SimpleFormController 转换为使用 Spring MVC 2.5 中引入的注释支持

**爪哇**

```
public class PriceIncreaseFormController extends SimpleFormController {

    ProductManager productManager = new ProductManager();

    @Override
    public ModelAndView onSubmit(Object command)
            throws ServletException {

        int increase = ((PriceIncrease) command).getPercentage();
        productManager.increasePrice(increase);

        return new ModelAndView(new RedirectView(getSuccessView()));
    }

    @Override
    protected Object formBackingObject(HttpServletRequest request)
            throws ServletException {
        PriceIncrease priceIncrease = new PriceIncrease();
        priceIncrease.setPercentage(20);
        return priceIncrease;
    }

} 
```

**弹簧配置**

```
<!-- Include basic annotation support -->
<context:annotation-config/>        

<!-- Comma-separated list of packages to search for annotated controllers. Append '.*' to search all sub-packages -->
<context:component-scan base-package="springapp.web"/>  

<!-- Enables use of annotations on controller methods to map URLs to methods and request params to method arguments  -->
<bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter"/>

<bean name="/priceincrease.htm" class="springapp.web.PriceIncreaseFormController">
    <property name="sessionForm" value="true"/>
    <property name="commandName" value="priceIncrease"/>
    <property name="commandClass" value="springapp.service.PriceIncrease"/>
    <property name="validator">
        <bean class="springapp.service.PriceIncreaseValidator"/>
    </property>
    <property name="formView" value="priceincrease"/>
    <property name="successView" value="hello.htm"/>
    <property name="productManager" ref="productManager"/>
</bean> 
```

基本上，我想`/priceincrease.htm`用 Java 类中的注释替换 bean 的所有 XML 配置。这是否可能，如果可以，我应该使用哪些相应的注释？

谢谢，唐

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T20:55:17.257

它看起来像下面这样，尽管它是否按原样工作取决于您的配置（查看解析器等）。我还应该注意到，大约有 80 亿种有效的方法来编写这个东西。请参阅 Spring 文档[13.11.4 “支持的处理程序方法参数和返回类型”](http://static.springframework.org/spring/docs/2.5.x/reference/mvc.html#mvc-ann-requestmapping-arguments)，以了解这种精神错乱的概述。另请注意，您可以自动装配验证器

```
@Controller
@RequestMapping("/priceincrease.htm")
public class PriceIncreaseFormController {

    ProductManager productManager;

    @Autowired
    public PriceIncreaseFormController(ProductManager productManager) {
        this.productManager = productManager;
    }

    // note: this method does not have to be called onSubmit
    @RequestMapping(method = RequestMethod.POST)
    public String onSubmit(@ModelAttribute("priceIncrease") PriceIncrease priceIncrease, BindingResult result, SessionStatus status {

        new PriceIncreaseValidator().validate(priceIncrease, result);
        if (result.hasErrors()) {
            return "priceincrease";
        }
        else {
            int increase = priceIncrease.getPercentage();
            productManager.increasePrice(increase);
            status.setComplete();
            return "redirect:hello.htm";
        }
    }

    // note: this method does not have to be called setupForm
    @RequestMapping(method = RequestMethod.GET)    
    public String setupForm(Model model) {
        PriceIncrease priceIncrease = new PriceIncrease();
        priceIncrease.setPercentage(20);
        model.addAttribute("priceIncrease", priceIncrease);
        return "priceincrease";
    }

} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-07-28T11:55:53.383

有人用最近的 MVC 完成了这个项目，它在 github 上，所以你可以看到所有的类与 Spring 的教程相比是如何变化的。

链接：[PriceIncreaseFormController](https://github.com/bogus/Java-Spring-Examples/blob/master/spring-mvc-jpa/src/main/java/com/medratech/spring/mvc/web/PriceIncreaseFormController.java)

# class - 帮助我了解当前项目的 OOD

> ID：803504
> 
> 赞同：1
> 
> 时间：2009-04-29T17:50:46.483
> 
> 标签：class, oop

我很难弄清楚班级需要如何相互交流。在我正在做的一个当前项目中，许多类已经变得如此根深蒂固，以至于我已经开始制作单例和静态字段来解决问题（据我所知，这是一个坏主意）。

很难表达我的问题，就像其他程序员没有这个问题一样。这是程序的一部分的图像： [类图](http://img131.imageshack.us/img131/4520/classdiagram02.jpg)

*   例 1。当我创建一个 Destination 对象时，它需要来自 Infopanel 的信息。如何在 InfoPanel 中不使用静态吸气剂来做到这一点？

*   例 2。DestinationRouting 用于每个分支。我真的必须在启动器中制作它，然后在所有分支中传递它吗？

不确定这对任何人是否有意义 :) 这是每个项目中反复出现的问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T18:13:09.300

在查看您的类图之后，我认为您正在将程序性思维应用于 OO 问题。您的单例似乎包含对域模型中的记录进行操作的所有行为，并且记录的行为很少。

为了更好地理解您的对象模型，我会尝试将您的类图中的关系（线）分类为“is-a”、“has-a”等之一，以便您可以更好地看到你有什么。

目的地需要来自 InfoPanel 的一些信息，但可能不是所有信息。是否可以仅将所需信息传递给 Destination 而不是 InfoPanel？

在 DestinationRouting 类中捕获了什么状态，迫使它成为单例？这些信息是否属于其他地方？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T18:11:39.943

这里的信息太少了。例如，我什至不确定它们是否`MapPanel`以及`InfoPanel`应该是这样的。我很想尝试一下装饰器模式的价值。我也不知道为什么 Listener 是 Panel 的子项。我们需要知道这些对象是什么以及这是什么系统。

# c++ - 如何从嵌套命名空间中引用外部 C++ 命名空间？

> ID：803506
> 
> 赞同：6
> 
> 时间：2009-04-29T17:50:56.263
> 
> 标签：c++, gcc, namespaces

我在默认/“根”命名空间中定义了两个命名空间，**nsA**和**nsB**。 **nsA**有一个子命名空间**nsA::subA**。当我尝试从**nsA::subA**内部引用属于**nsB**的函数时，出现错误：

 **```
undefined reference to `nsA::subA::nsB::theFunctionInNsB(...)' 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-29T17:57:45.610

使用全局范围解析：

```
::nsB::TheFunctionInNsB() 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-29T18:00:07.273

```
#include <stdio.h>

namespace nsB {
    void foo() {
        printf( "nsB::foo()\n");
    }
}

namespace nsA {
    void foo() {
        printf( "nsA::foo()\n");
    }

    namespace subA {
        void foo() {
            printf( "nsA::subA::foo()\n");
            printf( "calling nsB::foo()\n");

            ::nsB::foo();      // <---  calling foo() in namespace 'nsB'
        }
    }
}

int main()
{
    nsA::subA::foo();

    return 0;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T12:05:54.807

需要更多信息来解释该错误。下面的代码很好：

```
#include <iostream>

namespace nsB {
    void foo() { std::cout << "nsB\n";}
}

namespace nsA {
    void foo() { std::cout << "nsA\n";}
    namespace subA {
        void foo() { std::cout << "nsA::subA\n";}
        void bar() {
            nsB::foo();
        }
    }
}

int main() {
    nsA::subA::bar();
} 
```

因此，虽然指定全局命名空间可以解决您当前的问题，但通常可以在没有它的情况下引用 nsB 中的符号。否则，每当您在另一个命名空间范围内时，您都必须编写 ::std::cout、::std::string 等。而你没有。QED。

指定全局命名空间适用于在当前范围内有另一个 nsB 可见的情况 - 例如，如果 nsA::subA 包含自己的命名空间或名为 nsB 的类，并且您想调用 ::nsbB:foo 而不是 nsA::subA： :nsB::foo。因此，如果您已经声明（但未定义）nsA::subA::nsB::theFunctionInNsB(...)，您会得到引用的错误。您是否可能从命名空间 subA 中 #include nsB 的标头？

# iis - 你能改变 IIS6 虚拟目录出现的顺序吗？

> ID：803510
> 
> 赞同：2
> 
> 时间：2009-04-29T17:51:48.807
> 
> 标签：iis, iis-6

我有一个共享开发服务器，其中一个网站上有许多虚拟目录。是否可以重新排序这些虚拟目录在 IIS 中的显示方式？

我尝试使用元数据库资源管理器查看元数据，但似乎没有任何东西可以驱动显示顺序。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-12T14:18:32.300

IIS 管理器按站点的输入顺序显示站点...

我发现的唯一方法是单击网站文件夹，然后按主窗口中的描述/主机标题重新排序，以按字母顺序获取它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T18:02:46.313

当您在 IIS 中说“显示”时，您是指 Internet 服务管理管理单元吗？如果是这样，我相信它总是按字母顺序显示虚拟目录，而不管它们在元数据库中的存储顺序如何。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-19T05:23:48.180

根据这篇文章： http: [//windowsitpro.com/web/article/articleid/25937/iis-informant-using-metaedit-22-to-resequence-virtual-directories.html](http://windowsitpro.com/web/article/articleid/25937/iis-informant-using-metaedit-22-to-resequence-virtual-directories.html) vdirs 以创建日期顺序显示（但它可以取决于 IIS 和 Win 版本）。

该文章建议了一种通过将元数据库导出到文本文件、编辑文件以重新排序 vdir 并重新导入来重新排序它们的方法。

# java - 设置默认的 SocketFactory

> ID：803511
> 
> 赞同：6
> 
> 时间：2009-04-29T17:52:21.207
> 
> 标签：java, web-services, sockets, ssl, cxf

我最近将我的 Web 服务从 Axis 迁移到 CXF (2.1)。看起来，虽然 Axis 需要“axis.socketSecureFactory”集，但 CXF 使用了默认值。如何将 Java 中的默认 SocketFactory 设置为我自己的实现（例如属性）？

我**不想**做的是设置默认的 SocketFactory 属性，例如为我的信任库、密钥库和密码设置属性。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-29T22:43:55.797

如果我们谈论的是标准套接字，则`Socket.setSocketImplFactory(SocketImplFactory)`用于将工厂更改为普通套接字和`ServerSocket.setSocketFactory(SocketImplFactory)`服务器套接字。

如果您正在使用这些，请注意您只能设置这些工厂一次。

请注意，Java 套接字实现默认使用 SocksSocketImpl（java.net 中的一个包可见类），如果它发现工厂是`null`在您想要一个可以将包切换到标准 java 实现的工厂的情况下。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-29T18:11:43.640

根据 OpenJDK7 源代码 for [`javax.net.SocketFactory`](http://www.docjar.com/html/api/javax/net/SocketFactory.java.html)，Sun JVM 被硬编码为返回一个[`javax.net.DefaultSocketFactory`](http://www.docjar.com/docs/api/javax/net/DefaultSocketFactory.html)for`getDefault();`

编辑：但是，默认 SSLSocketFactory 可以由安全属性设置`ssl.SocketFactory.provider`

# regex - 为什么在线解析器似乎停止在正则表达式？

> ID：803515
> 
> 赞同：6
> 
> 时间：2009-04-29T17:53:10.410
> 
> 标签：regex, parsing, context-free-grammar

我一直想知道为什么似乎没有任何解析器，比如[BNF](http://en.wikipedia.org/wiki/Backus%E2%80%93Naur_Form)，它们的行为就像各种库中的正则表达式。

当然，有像[ANTLR](http://www.antlr.org/)、[Yacc](http://en.wikipedia.org/wiki/Yacc)和许多其他*生成代码*的东西，这些代码反过来可以解析[CFG](http://en.wikipedia.org/wiki/Context-free_grammar)，但似乎没有一个库可以在没有中间步骤的情况下做到这一点。

我有兴趣编写一个[Packrat 解析器](http://en.wikipedia.org/wiki/Packrat_parser#Implementing_parsers_from_parsing_expression_grammars)，以启动所有与正则表达式相关的嵌套括号怪癖（也许更重要的是，为了它的运动），但不知何故，我有一种感觉，我只是走进另一个停止问题 - 类似沼泽的一类。

这些解析器是否存在技术/理论限制，或者我只是遗漏了什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T18:08:20.560

我认为这更像是一种文化。上下文无关文法的使用主要限于编译器，它们通常具有与每个生产规则相关联的代码。在某些语言中，输出代码比模拟回调更容易。在其他地方，您会看到解析器库：例如 Haskell 中的解析器组合器。另一方面，正则表达式在 grep 等工具中得到广泛使用，每次用户提供新的正则表达式时运行 C 编译器很不方便。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T18:27:57.143

[Boost.Spirit](http://spirit.sourceforge.net/)看起来像你所追求的。

如果你想自己做，我在我最新的编译器项目中使用[了 BNFC](http://www.cs.chalmers.se/Cs/Research/Language-technology/BNFC/)，它提供[了在它自己的实现中使用的语法](http://www.cs.chalmers.se/Cs/Research/Language-technology/BNFC/doc/examples/LBNF.cf)。这可能是一个很好的起点...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T07:13:51.997

没有潜伏在阴影中的技术/理论限制。我不能说为什么它们没有更受欢迎，但我知道至少有一个库可以提供您所寻求的这种“在线”解析。

[SimpleParse](http://simpleparse.sourceforge.net/)是一个 python 库，可以让您简单地将毛茸茸的 EBNF 语法粘贴到您的程序中，并使用它立即解析事物，无需中间步骤。我已经将它用于几个我想要自定义输入语言但真的不想提交任何正式构建过程的项目。

这是我脑海中的一个小例子：

```
decl = r"""
    root := expr
    expr := term, ("|", term)*
    term := factor+
    factor := ("(" expr ")") / [a-z]
"""
parser = Parser(decl) 
success, trees, next = parser.parse("(a(b|def)|c)def") 
```

Haskell 和 Scala 的解析器组合库还可以让您在使用它的同一块代码中表达您的解析器的语法。但是，您不能让用户在运行时输入语法（这可能只对制作软件以帮助人们理解语法的人感兴趣）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-11T03:00:31.780

Pyparsing ( [http://pyparsing.wikispaces.com](http://pyparsing.wikispaces.com) ) 内置了对 Packrat 解析的支持，它是纯 Python，所以你可以看到实际的实现。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T18:08:11.900

因为成熟的上下文无关语法已经足够令人困惑了，因为它们没有一些神秘的密集和难以理解的语法使它们更加混乱？

很难知道你在问什么。您是否正在尝试创建类似于正则表达式的东西，但用于上下文无关的语法？就像，使用`$var =~ /expr = expr + expr/`（在 Perl 中）并进行匹配`"1 + 1"`or `"1 + 1 + 1"`or `"1 + 1 + 1 + 1 + 1 + ..."`？我认为其中一个限制将是语法：拥有超过三个规则将使您的“语法表达式”比任何现代正则表达式都更难以阅读。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-29T18:12:30.377

副作用是我看到的唯一能让你受益的东西。大多数解析器生成器都包含用于处理的嵌入式代码，您需要一个 eval 才能使其工作。

解决此问题的一种方法是命名动作，然后创建一个“动作”函数，该函数采用要执行的动作的名称和要使用的参数。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-29T18:17:46.683

理论上，您可以在 C++ 中使用[Boost Spirit](http://spirit.sourceforge.net/)来实现，但它主要用于静态语法。我认为这不常见的原因是 CFG 不像正则表达式那样常用。除了编译器构造之外，我从未使用过语法，但我已经多次使用正则表达式。CFG 通常比正则表达式复杂得多，因此使用 YACC 或 ANTLR 等工具静态生成代码是有意义的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-29T18:26:22.077

[tcllib](http://tcllib.sourceforge.net/doc/peg.html)有类似的东西，如果你能忍受[Parse Expression Grammars](http://en.wikipedia.org/wiki/Parsing_expression_grammar)和 TCL。如果你喜欢 Perl，CPAN 就有[Parse::Earley](http://search.cpan.org/~lpalmer/Parse-Earley-0.15/Earley.pm)。 [这](http://www.perlmonks.org/?node_id=308707)是一个看起来很有希望的纯 Perl 变体。 [PLY](http://www.dabeaz.com/ply/)似乎是 Python 的一个合理的解决方案

# python - 在 Google App Engine 上使用单个 db.put() 插入多个模型实例

> ID：803517
> 
> 赞同：3
> 
> 时间：2009-04-29T17:53:25.727
> 
> 标签：python, google-app-engine

**编辑：**对不起，我没有澄清这一点，这是一个与 Google App Engine 相关的问题。

据此，我可以给[db.put](http://code.google.com/appengine/docs/python/datastore/functions.html) () 一个模型实例列表，并要求它将它们全部输入数据存储区。但是，我无法成功地做到这一点。我对 Python 还是有点陌生​​，所以请放轻松

```
list_of_models = []
for i in range(0, len(items) - 1):
    point = ModelName()

    ... put the model info here ...

    list_of_models.append(point)

db.put(list_of_models) 
```

谁能指出我哪里出错了？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T21:12:22.160

请定义你所说的“出错”是什么意思——你展示的一小段代码很可能是一个非常“正确”的应用程序的一部分。考虑例如：

```
class Hello(db.Model):
  name = db.StringProperty()
  when = db.DateTimeProperty()

class MainHandler(webapp.RequestHandler):

  def get(self):
    self.response.out.write('Hello world!')
    one = Hello(name='Uno', when=datetime.datetime.now())
    two = Hello(name='Due', when=datetime.datetime.now())
    both = [one, two]
    db.put(both) 
```

这确实会在每次调用 get 方法时正确插入两个实体，例如，如果示例应用程序继续：

```
def main():
  application = webapp.WSGIApplication([('/', MainHandler)],
                                       debug=True)
  wsgiref.handlers.CGIHandler().run(application)

if __name__ == '__main__':
  main() 
```

就像在典型的“hello world”应用引擎应用中一样。您可以使用 sdk 控制台的数据存储查看器验证两个实体的正确添加，当然也可以通过添加另一个处理程序来获取实体并显示它们等等。

所以请澄清！

# powershell - Powershell 的陷阱

> ID：803521
> 
> 赞同：25
> 
> 时间：2009-04-29T17:54:51.700
> 
> 标签：powershell

您陷入了哪些 Powershell 陷阱？:-)

我的是：

```
# -----------------------------------
function foo()
{
    @("text")
}

# Expected 1, actually 4.
(foo).length

# -----------------------------------
if(@($null, $null))
{
    Write-Host "Expected to be here, and I am here."
}

if(@($null))
{
    Write-Host "Expected to be here, BUT NEVER EVER."
}

# -----------------------------------

function foo($a)
{
    # I thought this is right.
    #if($a -eq $null)
    #{
    #    throw "You can't pass $null as argument."
    #}

    # But actually it should be:
    if($null -eq $a)
    {
        throw "You can't pass $null as argument."
    }
}

foo @($null, $null)

# -----------------------------------

# There is try/catch, but no callstack reported.
function foo() 
{
   bar
}

function bar() 
{
  throw "test"
}

# Expected:
#  At bar() line:XX
#  At foo() line:XX
#  
# Actually some like this:
#  At bar() line:XX
foo 
```

想知道你的带他们四处走走:-)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-29T18:08:53.227

我个人最喜欢的是

```
function foo() {
  param ( $param1, $param2 = $(throw "Need a second parameter"))
  ...
}

foo (1,2) 
```

对于那些不熟悉 powershell 的人，该行会抛出该行，因为它实际上不是传递 2 个参数，而是创建一个数组并传递一个参数。您必须按如下方式调用它

```
foo 1 2 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-01T18:16:44.423

```
$files = Get-ChildItem . -inc *.extdoesntexist
foreach ($file in $files) {
    "$($file.Fullname.substring(2))"
} 
```

失败：

```
You cannot call a method on a null-valued expression.
At line:3 char:25
+ $file.Fullname.substring <<<< (2) 
```

像这样修复它：

```
$files = @(Get-ChildItem . -inc *.extdoesntexist)
foreach ($file in $files) {
    "$($file.Fullname.substring(2))"
} 
```

底线是 foreach 语句将在一个标量值上循环，即使该标量值为 $null。当第一个示例中的 Get-ChildItem 不返回任何内容时，$files 将被分配为 $null。如果您希望命令返回一组项目，但它有可能只返回 1 个项目或零个项目，请将 @() 放在命令周围。然后你总是会得到一个数组 - 无论是 0、1 还是 N 个项目。注意：如果该项目已经是一个数组，则放置`@()`无效 - 它仍然是相同的数组（即没有额外的数组包装器）。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-29T18:13:56.537

另一个有趣的。默认情况下不处理表达式会将其写入管道。当您没有意识到特定函数返回值时，这真的很烦人。

```
function example() {
  param ( $p1 ) {
  if ( $p1 ) {
    42
  }
  "done"
}

PS> example $true 
42
"done" 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-05-07T21:34:16.923

```
# The pipeline doesn't enumerate hashtables.
$ht = @{"foo" = 1; "bar" = 2}
$ht | measure

# Workaround: call GetEnumerator
$ht.GetEnumerator() | measure 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-29T18:51:45.993

这是[我的前 5 个 PowerShell 陷阱](http://www.johndcook.com/blog/2008/05/02/top-five-gotchas-when-learning-powershell/)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-29T18:24:01.223

这是我最近偶然发现的东西（PowerShell 2.0 CTP）：

```
$items = "item0", "item1", "item2"

$part = ($items | select-string "item0")

$items = ($items | where {$part -notcontains $_}) 
```

你认为 $items 在脚本末尾是什么？

我期待“item1”，“item2”，但 $items 的值是：“item0”，“item1”，“item2”。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-08-11T15:14:02.567

为未使用 Powershell 构建的实用程序构建命令行有一些技巧：

*   要运行名称以数字开头的可执行文件，请在其前面加上与号 (&)。

`& 7zip.exe`

*   要在路径中的任何位置运行带有空格的可执行文件，请在其前面加上一个与号 (&) 并将其括在引号中，就像任何字符串一样。这意味着变量中的字符串也可以执行。

`# Executing a string with a space. & 'c:\path with spaces\command with spaces.exe'`

`# Executing a string with a space, after first saving it in a variable. $a = 'c:\path with spaces\command with spaces.exe' & $a`

*   参数和参数按位置传递给遗留实用程序。因此，以实用程序期望看到它们的方式引用它们很重要。通常，当它包含空格或不以字母、数字或破折号 (-) 开头时，会引用。

`C:\Path\utility.exe '/parameter1' 'Value #1' 1234567890`

*   变量可用于传递包含空格或特殊字符的字符串值。

`$b = 'string with spaces and special characters (-/&)' utility.exe $b`

*   或者，数组扩展也可以用于传递值。

`$c = @('Value #1', $Value2) utility.exe $c`

*   如果您希望 Powershell 等待应用程序完成，则必须使用输出，方法是通过管道将输出传送到某些东西或使用 Start-Process。

`# Saving output as a string to a variable. $output = ping.exe example.com | Out-String`

`# Piping the output. ping stackoverflow.com | where { $_ -match '^reply' }`

`# Using Start-Process affords the most control. Start-Process -Wait SomeExecutable.com`

*   由于它们显示输出的方式，某些命令行实用程序在 Powershell_ISE.exe 内运行时会出现挂起，尤其是在等待用户输入时。这些实用程序在 Powershell.exe 控制台中运行时通常可以正常工作。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-10-01T17:55:20.833

## 关于函数...

*   在函数中处理流水线输入的微妙之处在于使用 `$_`or`$input`以及相对于`begin`、`process`和`end`块。
*   如何处理传递给函数的输入的六个主要等价类（无输入、null、空字符串、标量、列表、带有 null 和/或空的列表）——对于**直接**输入和**管道**输入——*并得到你想要的期待*。
*   向函数发送多个参数的正确调用语法。

[我在我的Simple-Talk.com文章](http://www.simple-talk.com/content/file.ashx?file=5771)[Down the Rabbit Hole-A Study in PowerShell Pipelines, Functions, and Parameters](http://www.simple-talk.com/dotnet/.net-tools/down-the-rabbit-hole--a-study-in-powershell-pipelines,-functions,-and-parameters/)中详细讨论了这些要点，并提供了随附的挂图——这里是展示各种调用语法陷阱的一瞥一个接受 3 个参数的函数： ![函数语法陷阱](https://i.stack.imgur.com/mxLfW.png)

* * *

## 在模块上...

这些观点在我的 Simple-Talk.com 文章[进一步深入兔子洞：PowerShell 模块和封装](http://www.simple-talk.com/dotnet/.net-tools/further-down-the-rabbit-hole-powershell-modules-and-encapsulation/)中进行了阐述。

*   使用相对路径在脚本中点源文件是相对于您当前目录的——**而不是**脚本所在的目录！要相对于脚本，请使用此函数来定位您的脚本目录：*[PowerShell V3+ 的更新：只需使用内置`$PSScriptRoot`变量！]*

    ```
    function Get-ScriptDirectory
    { Split-Path $script:MyInvocation.MyCommand.Path } 
    ```

*   模块必须存储为`...Modules\name\name.psm1`或`...\Modules\any_subpath\name\name.psm1`。也就是说，您不能只使用`...Modules\name.psm1`-- 模块的直接父级的名称必须与模块的基本名称匹配。此图表显示了违反此规则时的各种故障模式：

![模块命名要求](https://i.stack.imgur.com/vZYYu.png)

* * *

## 2015.06.25 陷阱参考图

Simple-Talk.com 刚刚发布了我关于 PowerShell 陷阱的三篇深入文章中的最后一篇。前两部分采用测验的形式，帮助您了解一组精选的陷阱；最后一部分是一个挂图（尽管它需要一个天花板相当高的房间），其中包含 36 个最常见的陷阱（一些改编自本页上的答案），为大多数人提供了具体的示例和解决方法。[在这里](http://www.simple-talk.com/sysadmin/powershell/the-poster-of-the-plethora-of-powershell-pitfalls/)阅读更多。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-05-28T23:38:59.223

假设您有以下 XML 文件：

```
<Root>
    <Child />
    <Child />
</Root> 
```

运行这个：

```
PS > $myDoc = [xml](Get-Content $pathToMyDoc)
PS > @($myDoc.SelectNodes("/Root/Child")).Count
2
PS > @($myDoc.Root.Child).Count
2 
```

现在编辑 XML 文件，使其没有子节点，只有根节点，然后再次运行这些语句：

```
PS > $myDoc = [xml](Get-Content $pathToMyDoc)
PS > @($myDoc.SelectNodes("/Root/Child")).Count
0
PS > @($myDoc.Root.Child).Count
1 
```

当您想使用 foreach 迭代节点集合时，当且仅当实际上有节点时，该 1 很烦人。这就是我了解到不能将 XML 处理程序的属性（点）表示法用作简单快捷方式的原因。我相信发生的事情是 SelectNodes 返回一个 0 的集合。当 @'ed 时，它从 XPathNodeList 转换为 Object[]（检查 GetType()），但长度被保留。动态生成的 $myDoc.Root.Child 属性（本质上不存在）返回 $null。当 $null 被 @'ed 时，它变成一个长度为 1 的数组。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-29T21:37:29.963

函数 'foo' 和 'bar' 看起来是等价的。

```
function foo() { $null  }
function bar() { } 
```

例如

```
(foo) -eq $null
# True

(bar) -eq $null
# True 
```

但：

```
foo | %{ "foo" }
# Prints: foo

bar | %{ "bar" }
# PRINTS NOTHING 
```

返回 $null 并且不返回任何内容并不等同于处理管道。

* * *

这个灵感来自**Keith Hill**的例子......

```
function bar() {}

$list = @(foo)
$list.length
# Prints: 0

# Now let's try the same but with a temporal variable.
$tmp = foo
$list = @($tmp)
$list.length
# Prints: 1 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-04-29T18:51:15.747

alex2k8，我认为你的这个例子很适合谈论：

```
# -----------------------------------
function foo($a){
    # I thought this is right.
    #if($a -eq $null)
    #{
    #    throw "You can't pass $null as argument."
    #}
    # But actually it should be:
    if($null -eq $a)
    {
        throw "You can't pass $null as argument." 
    }
}
foo @($null, $null) 
```

PowerShell 可以对数组使用一些比较器，如下所示：

```
$array -eq $value
## Returns all values in $array that equal $value 
```

考虑到这一点，原始示例返回两个项目（数组中的两个 $null 值），其评估结果为 $true，因为您最终会得到一个以上项目的集合。颠倒参数的顺序会停止数组比较。

此功能在某些情况下非常方便，但您需要注意这一点（就像 PowerShell 中的数组处理一样）。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-01-12T21:13:04.930

逻辑和位运算符不遵循标准优先规则。运算符 -and 应该具有比 - 更高的优先级，否则它们是严格从左到右进行评估的。

例如，比较 PowerShell 和 Python（或几乎任何其他现代语言）之间的逻辑运算符：

```
# PowerShell
PS> $true -or $false -and $false
False

# Python
>>> True or False and False
True 
```

...和按位运算符：

```
# PowerShell
PS> 1 -bor 0 -band 0
0

# Python
>>> 1 | 0 & 0
1 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-10-22T20:24:51.723

另一个：

```
$x = 2
$y = 3
$a,$b = $x,$y*5 
```

由于运算符优先级，$b 中没有 25；该命令与 ($x,$y)*5 相同，正确的版本是

```
$a,$b = $x,($y*5) 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-30T07:04:27.370

```
# $x is not defined
[70]: $x -lt 0
True
[71]: [int]$x -eq 0
True 
```

So, what's $x..?

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-29T18:25:57.943

这行得通。但几乎可以肯定不是你认为它的工作方式。

```
PS> $a = 42;
PS> [scriptblock]$b = { $a }
PS> & $b
42 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-04-29T19:26:23.133

这个之前让我绊倒了，在应该是 $($o.SomeProperty) 的地方使用了 $o.SomeProperty。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-12-25T11:56:52.077

我的都与文件复制有关...

**文件名中的方括号**
我曾经不得不使用`Move-Item -Path C:\Source -Destination C:\Dest`. 在该过程结束时，源目录中仍有许多文件。我注意到每个剩余文件的名称中都有方括号。

问题是该`-Path`参数将方括号视为通配符。
例如。如果要将 Log001 复制到 Log200，可以使用方括号，如下所示： `Move-Item -Path C:\Source\Log[001-200].log`.

就我而言，为了避免方括号被解释为通配符，我应该使用该`-LiteralPath`参数。

**ErrorActionPreference**使用参数时忽略
该变量。`$ErrorActionPreference``Move-Item``Copy-Item``-Verbose`

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-05-07T21:52:23.887

我最近遇到的另一个问题：接受管道输入的 [string] 参数在实践中不是强类型的。您可以通过管道传输任何内容，PS 将通过 ToString() 强制执行。

```
function Foo 
{
    [CmdletBinding()]
    param (
        [parameter(Mandatory=$True, ValueFromPipeline=$True)]
        [string] $param
    )

    process { $param }
}

get-process svchost | Foo 
```

不幸的是，没有办法关闭它。我能想到的最佳解决方法：

```
function Bar
{
    [CmdletBinding()]
    param (
        [parameter(Mandatory=$True, ValueFromPipeline=$True)]
        [object] $param
    )

    process 
    { 
        if ($param -isnot [string]) {
            throw "Pass a string you fool!"
        }
        # rest of function goes here
    }
} 
```

编辑-我已经开始使用的更好的解决方法...

将此添加到您的自定义类型 XML -

```
<?xml version="1.0" encoding="utf-8" ?>
<Types>
  <Type>
    <Name>System.String</Name>
    <Members>
      <ScriptProperty>
        <Name>StringValue</Name>
        <GetScriptBlock>
          $this
        </GetScriptBlock>
      </ScriptProperty>
    </Members>
  </Type>
</Types> 
```

然后编写如下函数：

```
function Bar
{
    [CmdletBinding()]
    param (
        [parameter(Mandatory=$True, ValueFromPipelineByPropertyName=$True)]
        [Alias("StringValue")]
        [string] $param
    )

    process 
    { 
        # rest of function goes here
    }
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2012-11-28T22:10:50.787

记住将导入的数据表中的 pscustom 对象显式键入为数字，以便它们可以正确排序：

```
$CVAP_WA=foreach ($i in $C){[PSCustomObject]@{ `
                County=$i.county; `
                TotalVote=[INT]$i.TotalBallots; `
                RegVoters=[INT]$i.regvoters; `
                Turnout_PCT=($i.TotalBallots/$i.regvoters)*100; `
                CVAP=[INT]($B | ? {$_.GeoName -match $i.county}).CVAP_EST }} 
```

PS C:\政治> $CVAP_WA | sort -desc TotalVote |ft -auto -wrap

```
County       TotalVote RegVoters Turnout_PCT    CVAP CVAP_TV_PCT CVAP_RV_PCT
------       --------- --------- -----------    ---- ----------- -----------
King            973088   1170638      83.189 1299290      74.893      90.099
Pierce          349377    442985       78.86  554975      62.959      79.837
Snohomish       334354    415504      80.461  478440      69.832       86.81
Spokane         227007    282442      80.346  342060      66.398      82.555
Clark           193102    243155      79.453  284190      67.911       85.52 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2011-11-19T21:30:44.560

忘记 $_ 在块中被覆盖让我几次困惑地挠头，对于多个 reg-ex 匹配和 $matches 数组也是如此。>.<

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-10-20T11:02:25.197

## PowerShell 陷阱

StackOverflow 上反复出现了一些陷阱。如果您不熟悉这些 PowerShell 陷阱，建议您在[提出](https://stackoverflow.com/help/how-to-ask)新问题之前进行一些研究。[在回答](https://stackoverflow.com/help/how-to-answer)PowerShell 问题之前调查这些 PowerShell 陷阱甚至可能是一个好主意，以确保您教提问者正确的事情。

*TLDR：*在**PowerShell**中：

1.  比较相等运算符是：`-eq`
    ^(（Stackoverflow 示例：[**Powershell simple syntax if condition not working**](https://stackoverflow.com/q/42250254/1701026)）)
2.  括号和逗号**不**与参数一起使用
    ^(（Stackoverflow 示例：[**如何将多个参数传递给 PowerShell 中的函数？**](https://stackoverflow.com/q/4988226/1701026)）)
3.  输出属性基于管道中的第一个对象
    ^(（Stackoverflow 示例：[**未显示所有属性**](https://stackoverflow.com/q/44428189/1701026)）)
4.  管道展开
    ^(（Stackoverflow 示例：[**管道完成数组对象而不是一次一个数组项**](https://stackoverflow.com/q/29973212/1701026))
    ？^）单个项目集合
    ^(（Stackoverflow 示例：[**Powershell ArrayList 将单个数组项目转换回字符串**](https://stackoverflow.com/q/47341167/1701026)）)
    b。嵌入式数组
    ^(（Stackoverflow 示例：[**从函数返回多维数组**](https://stackoverflow.com/q/40220590/1701026)）)
    c。输出集合
    ^(（Stackoverflow 示例：[**为什么 PowerShell 会自动展平数组？**](https://stackoverflow.com/q/57023626/1701026)）)
5.  `$Null`应该在等式比较运算符的左侧
    ^(（Stackoverflow 示例：[**应该 $null 在等式比较的左侧**](https://stackoverflow.com/q/58217913/1701026)）)
6.  括号和赋值阻塞了管道
    ^(（Stackoverflow 示例：[**Importing 16MB CSV Into Variable Creates >600MB's Memory Usage**](https://stackoverflow.com/q/60353691/1701026)）)
7.  增加赋值运算符 ( `+=`) 可能会变得昂贵
    ^(Stackoverflow 示例：[**提高我的 PowerShell 脚本的效率**](https://stackoverflow.com/q/53110553/1701026))
8.  该`Get-Content`cmdlet 返回单独的行
    ^(Stackoverflow 示例：[**Multiline regex to match config block**](https://stackoverflow.com/q/12572164/17010266))

# 例子和解释

一些陷阱可能真的让人觉得反直觉，但通常可以通过一些非常好的 PowerShell 特性以及[管道](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_pipelines)、[表达式](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_parsing#expression-mode)/[参数模式](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_parsing#argument-mode)和[类型转换](https://en.wikipedia.org/wiki/Type_conversion)来解释。

## 1.比较相等运算符为：`-eq`

与 Microsoft 脚本语言[VBScript](https://en.wikipedia.org/wiki/VBScript)和其他一些编程语言不同，[比较相等运算符](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_comparison_operators?view=powershell-7.1#equality-operators)不同于[赋值运算符](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_assignment_operators)( **`=`**)，它是： **`-eq`**.

*注意：*如果需要，为变量赋值可能会传递该值：

```
$a = $b = 3   # The value 3 is assigned to both variables $a and $b. 
```

这意味着以下陈述可能出乎意料地[真实或虚假](https://stackoverflow.com/q/39983695/1701026)：

```
If ($a = $b) {
    # (assigns $b to $a and) returns a truthy if $b is e.g. 3
} else {
    # (assigns $b to $a and) returns a falsy if $b is e.g. 0
} 
```

## 2\. 括号和逗号**不**与参数一起使用

与许多其他编程语言以及原始 PowerShell 函数的定义方式不同，调用函数不需要括号或逗号作为其相关参数。使用**空格**分隔参数参数：

```
MyFunction($Param1, $Param2 $Param3) {
    # ...
}

MyFunction 'one' 'two' 'three' # assigns 'one' to $Param1, 'two' to $Param2, 'three' to $Param3 
```

*   括号和逗号用于调用 ( [.Net](https://dotnet.microsoft.com/learn/dotnet/what-is-dotnet) ) 方法。
*   逗号用于定义数组。`MyFunction 'one', 'two', 'three'`（或`MyFunction('one', 'two', 'three')`）会将数组加载`@('one', 'two', 'three')`到第一个参数（`$Param1`）中。
*   括号会将包含的内容解释为单个集合到内存中（并阻塞 PowerShell 管道），并且只能这样使用，例如调用嵌入式函数，例如：

```
MyFunction (MyOtherFunction) # passes the results MyOtherFunction to the first positional parameter of MyFunction ($Param1)
MyFunction One $Two (getThree) # assigns 'One' to $Param1, $Two to $Param2, the results of getThree to $Param3 
```

*注意：*引用文本参数（如`one`后面示例中的单词）仅在包含空格或特殊字符时才需要。

## 3.输出属性基于管道中的第一个对象

在 PowerShell 管道中，每个对象都由[cmdlet](https://docs.microsoft.com//powershell/scripting/developer/cmdlet/cmdlet-overview) （[为管道中间实现](https://docs.microsoft.com/powershell/scripting/developer/cmdlet/strongly-encouraged-development-guidelines#support-well-defined-pipeline-input-sc02)）处理和传递，类似于装配线中的工作站处理和传递对象的方式。这意味着每个 cmdlet 一次处理一项，而前一个 cmdlet（工作站）同时处理即将到来的一项。这样，对象不会立即加载到内存中（更少的内存使用），并且可以在提供下一个对象（甚至存在）之前已经处理。此功能的缺点是没有监督预期会跟随什么（[或多少](https://stackoverflow.com/a/67534378/1701026)）对象。
因此，大多数 PowerShell cmdlet 假定管道中的所有对象都对应于第一个对象并且具有相同的属性，这通常是这种情况，*但并非总是如此……*

```
$List =
    [pscustomobject]@{ one = 'a1'; two = 'a2' },
    [pscustomobject]@{ one = 'b1'; two = 'b2'; three = 'b3' }

$List |Select-Object *
one two
--- ---
a1  a2
b1  b2 
```

如您所见，结果中缺少第三列`three`，因为它在第一个对象中不存在，并且 PowerShell 在知道第二个对象的存在之前已经在输出结果。
解决此问题的方法是在正手显式定义（以下所有对象的）属性：

```
$List |Select-Object one, two, three

one two three
--- --- -----
a1  a2
b1  b2  b3 
```

另见建议：[`#13906`将 -UnifyProperties 参数添加到 Select-Object](https://github.com/PowerShell/PowerShell/issues/13906)

## 4\. 管道展开

如果它符合直接的期望，则此功能可能会派上用场：

```
$Array = 'one', 'two', 'three'
$Array.Length
3 
```

### 一个。单品收藏

但它可能会让人感到困惑：

```
$Selection = $Array |Select-Object -First 2
$Selection.Length
2
$Selection[0]
one 
```

当集合减少到单个项目时：

```
$Selection = $Array |Select-Object -First 1
$Selection.Length
3
$Selection[0]
o 
```

**解释** 当管道输出分配给变量的单个项目时，它*不是*作为集合（有 1 个项目，如：）分配，~~`@('one')`~~而是作为标量项目（项目本身，如：）`'one'`。
这意味着该属性`.Length`（实际上是`.Count`数组属性的别名）不再应用于数组，而是应用于字符串：`'one'.length`等于`3`。如果是索引`$Selection[0]`，则返回字符串的第一个字符`'one'[0]`（等于字符`o`）。

**解决方法要解决此问题，您可以使用**[Array 子表达式运算符 `@( )`](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_operators#array-subexpression-operator--) 将标量项强制为数组：

```
$Selection = $Array |Select-Object -First 1
@($Selection).Length
1
@($Selection)[0]
one 
```

知道在`$Selection`已经是一个数组的情况下，它不会进一步增加深度（~~@(@('one', 'two'))~~，参见下一节**4b。嵌入式集合是扁平化的**）。

### 湾。嵌入式阵列

当数组（或集合）包含嵌入式数组时，例如：

```
$Array = @(@('a', 'b'), @('c', 'd'))
$Array.Count
2 
```

所有嵌入的项目都将在管道中处理，并因此在*显示*或分配给新变量时返回一个平面数组：

```
$Processed = $Array |ForEach-Object { $_ }
$Processed.Count
4
$Processed
a
b
c
d 
```

要迭代嵌入式数组，您可以使用以下[`foreach`语句](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_foreach)：

```
foreach ($Item in $Array) { $Item.Count }
2
2 
```

或者一个简单的[`for` 循环](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_for)：

```
for ($i = 0; $i -lt $Array.Count; $i++) { $Array[$i].Count }
2
2 
```

### C。输出集合

集合通常在放置在管道上时展开：

```
function GetList {
   [Collections.Generic.List[String]]@('a', 'b')
}
(GetList).GetType().Name
Object[] 
```

要将集合作为单个项目输出，请使用[逗号运算符 `,`](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_operators#comma-operator-)：

```
function GetList {
   ,[Collections.Generic.List[String]]@('a', 'b')
}
(GetList).GetType().Name
List`1 
```

## 5.`$Null`应该在等式比较运算符的左边

此问题与此[比较运算符](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_comparison_operators)功能有关：

> [当运算符的输入是标量值时，运算符返回**布尔**值。当输入是一个集合时，运算符返回集合中与表达式右侧值匹配的元素。如果集合中没有匹配项，则比较运算符返回一个空数组。](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_comparison_operators?view=powershell-7.1#common-features)

这意味着对于标量：

```
'a'   -eq 'a'   # returns $True
'a'   -eq 'b'   # returns $False
'a'   -eq $Null # returns $False
$Null -eq $Null # returns $True 
```

对于集合，返回匹配的元素，其计算结果为[真或假](https://stackoverflow.com/q/39983695/1701026)：

```
'a',   'b',   'c'   -eq 'a'   # returns 'a' (truthy)
'a',   'b',   'c'   -eq 'd'   # returns an empty array (falsy)
'a',   'b',   'c'   -eq $Null # returns an empty array (falsy)
'a',   $Null, 'c'   -eq $Null # returns $Null (falsy)
'a',   $Null, $Null -eq $Null # returns @($Null, $Null) (truthy!!!)
$Null, $Null, $Null -eq $Null # returns @($Null, $Null, $Null) (truthy!!!) 
```

换句话说，要检查一个变量是否是`$Null`（并排除包含多个`$Null`s 的集合），**请将其放在`$Null`相等比较运算符的 LHS（左侧）**：

```
if ($Null -eq $MyVariable) { ... 
```

## 6.括号和赋值阻塞了管道

[PowerShell 管道](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_pipelines)不仅仅是由管道运算符 ( ) (ASCII 124)连接的一系列命令*。*通过一系列[cmdlet](https://docs.microsoft.com/en-us/powershell/scripting/developer/cmdlet/cmdlet-overview)`|`同时*流式传输*单个对象是一个概念。如果 cmdlet（或函数）是根据[强烈鼓励的开发指南](https://docs.microsoft.com/powershell/scripting/developer/cmdlet/strongly-encouraged-development-guidelines)编写并[在管道中间实现的](https://docs.microsoft.com/powershell/scripting/developer/cmdlet/strongly-encouraged-development-guidelines#implement-for-the-middle-of-a-pipeline)，它会从管道中获取每个对象，对其进行处理，并将结果传递给下一个 cmdlet，然后再进行处理管道中的下一个对象。这意味着对于一个简单的管道：

```
Import-Csv .\Input.csv |Select-Object -Property Column1, Column2 |Export-Csv .\Output.csv 
```

当最后一个 cmdlet 将对象写入`.\Output.csv`文件时，`Select-Object`cmdlet 会选择下一个对象的属性并`Import-Csv`从文件中读取下一个对象`.\input.csv`（另请参见：[Powershell 中的管道](https://stackoverflow.com/a/68254012/1701026)）。这将使内存使用率保持在较低水平（尤其是在需要处理大量对象/记录的情况下），因此可能会导致更快的吞吐量。为了方便管道，PowerShell 对象非常胖，因为每个单独的对象都包含所有属性信息（以及例如属性名称）。
因此，无缘无故地阻塞管道不是一个好习惯。有两种情况会阻塞管道：

1.  **括号**，例如：

```
(Import-Csv .\Input.csv) |Select-Object -Property Column1, Column2 |Export-Csv .\Output.csv 
```

在将所有记录传递给cmdlet`.\Input.csv`之前，所有记录都作为 PowerShell 对象数组加载到内存中。`Select-Object`

2.  **作业**，例如：

```
$Objects = Import-Csv .\Input.csv
$Objects |Select-Object -Property Column1, Column2 |Export-Csv .\Output.csv 
```

在将所有记录传递给cmdlet之前，所有`.\Input.csv`记录都作为 PowerShell 对象数组加载到（内存）中。`$Objects``Select-Object`

## 7\. 增加赋值运算符 ( `+=`) 可能会变得昂贵

[增加赋值运算符 ( `+=`)](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_assignment_operators#the-assignment-by-addition-operator)是增加和分配[原语](https://en.wikipedia.org/wiki/Language_primitive)的[语法糖](https://en.wikipedia.org/wiki/Syntactic_sugar)。例如where is assigned 。增加赋值运算符也可用于向集合（或类型和）添加新项目，但随着每次迭代（集合的大小）成本增加，可能会变得相当[昂贵。](https://stackoverflow.com/a/9888431/1701026)这样做的原因是，作为数组集合的对象是不可变的，并且右侧变量不仅附加，而且 **附加***并重新分配**给左侧变量。有关详细信息，另请参阅：[避免使用递增赋值运算符 (](https://stackoverflow.com/q/60708578/1701026) [) 创建集合](https://stackoverflow.com/q/60708578/1701026)`$a += $b``$a``$b + 1``String``hash tables`*[`+=`](https://stackoverflow.com/q/60708578/1701026)*

 *## 8\. `Get-Content`cmdlet 返回单独的行

知道存在很多（内部和外部）cmdlet可能还有更多的*cmdlet陷阱。*与引擎相关的陷阱相比，这些陷阱通常更容易突出显示（例如警告），就像发生的那样[`ConvertTo-Json`](https://docs.microsoft.com/epowershell/module/microsoft.powershell.utility/convertto-json)（请参阅：[意外的 ConvertTo-Json 结果？答案：它的默认 -Depth 为 2](https://stackoverflow.com/q/53583677/1701026)）或“修复”。但是有一个非常经典的陷阱，[`Get-Content`](https://docs.microsoft.com/powershell/module/microsoft.powershell.management/get-content)其中紧紧抓住 PowerShell 流对象的一般概念（在本例中为行），而不是一次传递所有内容（文件的全部内容）：

```
Get-Content .\Input.txt -Match '\r?\n.*Test.*\r?\n' 
```

永远不会工作，因为默认情况下，`Get-Contents`返回一个对象流，其中每个对象都包含一个字符串（没有任何换行符的行）。

```
(Get-Content .\Input.txt).GetType().Name
Object[]
(Get-Content .\Input.txt)[0].GetType().Name
String 
```

实际上：

```
Get-Content .\Input.txt -Match 'Test' 
```

返回包含单词`Test`的所有行，`Get-Contents`将每一行放在管道上，[当输入是集合时，运算符返回集合中与表达式右侧值匹配的元素](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_comparison_operators#common-features)。

*注意：*由于 PowerShell 版本 3，`Get-Contents`有一个`-Raw`参数可以一次读取相关文件的所有内容，这意味着 this:`Get-Content -Raw .\Input.txt -Match '\r?\n.*Test.*\r?\n'`将在将整个文件加载到内存时工作。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-01-03T16:19:38.963

**将进程的 ExitCode 视为布尔值。**

例如，使用此代码：

```
$p = Start-Process foo.exe -NoNewWindow -Wait -PassThru
if ($p.ExitCode) {
  # handle error
} 
```

一切都很好，除非说 foo.exe 不存在或无法启动。在那种情况下`$p`将是`$null`，并且`[bool]($null.ExitCode)`是假的。

一个简单的解决方法是将逻辑替换为`if ($p.ExitCode -ne 0) {}`，但是为了清晰起见，imo 使用以下代码更好：`if (($p -eq $null) -or ($p.ExitCode -ne 0)) {}`

# c - 在 K&R 之后使用什么书来学习纯 C 编程？

> ID：803522
> 
> 赞同：15
> 
> 时间：2009-04-29T17:55:39.763
> 
> 标签：c

在Brian Kernighan 和 Dennis Ritchie[的 The C Programming Language](http://en.wikipedia.org/wiki/The_C_Programming_Language_(book))之后，一些最受初学者青睐的书籍最终成为最好避免的书籍，例如[Herb Schildt 的任何](https://stackoverflow.com/questions/391091/should-i-not-use-a-herb-schildt-book-to-learn-from)书籍，甚至 O'Reilly [Practical C Programming](http://accu.org/index.php?module=bookreviews&func=search&rid=1225)，似乎没有可以替代这些。否则，大多数可用的材料都是关于 C++ 的。

除了 K&R 和我已经拥有的优秀的[C: A Reference Manual](https://rads.stackoverflow.com/amzn/click/com/013089592X)之外，还有哪些其他书籍最适合用于学习 C 编码（纯[C89](http://en.wikipedia.org/wiki/C89_(C_version)#ANSI_C_and_ISO_C)而不是 C++），而不需要学习不好的做法？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-29T18:00:11.000

Peter van der Linden 的[专家 C 编程：深度 C 的秘密](https://rads.stackoverflow.com/amzn/click/com/0131774298)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-29T18:14:55.410

[C：Harbison 和 Steele 的参考手册](https://rads.stackoverflow.com/amzn/click/com/013089592X)

这不是一本教程书，但它无疑是 C 方面最好的书（在我看来，甚至超过了 K&R）。与 K&R（或任何其他教程）一起使用，您将获得 C 的良好基础。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-29T18:06:09.957

[这就](http://www.lysator.liu.se/c/schildt.html)解释了为什么 Schildt 不好。[这里](http://www.seebs.net/c/c_tcr.html)还有一些批评。

在 SO 中搜索 C 资源。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-29T18:38:43.780

我很想阅读[《编程实践》](http://www.amazon.co.uk/Practice-Programming-Addison-Wesley-Professional-Computing/dp/020161586X/ref=sr_1_1?ie=UTF8&s=books&qid=1241030211&sr=8-1)和[《编程珍珠》](http://www.amazon.co.uk/Programming-Pearls-ACM-Press-Bentley/dp/0201657880/ref=sr_1_1?ie=UTF8&s=books&qid=1241030262&sr=1-1)。两者都是非常简洁的书，并且都是面向 C 的

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-04-30T15:48:21.900

K&R 基本上涵盖了您需要了解的有关 C 的所有内容，甚至还实现了一些常用的数据结构。如果您使用 *nix 并想学习如何利用操作系统，[UNIX 环境中的高级编程，第三版](https://rads.stackoverflow.com/amzn/click/com/0321637739)是阅读文件、创建线程等常见用途的一个很好的参考/指南。示例代码在 C 中。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-04-29T18:01:38.470

我会说完全避开这些书。选择一个项目，任何项目（虽然不是太大），然后用 C 来实现它。没有什么可以替代简单地跳进去做的。K&R 提供了足够的知识，您可以开始跌跌撞撞地学习并获得真正的良好学习经验。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-29T18:33:03.013

我喜欢Kenneth A. Reek[的 C 指针。](https://rads.stackoverflow.com/amzn/click/com/0673999866)我不会说它比 K&R 更好，但我确实发现它更友好，更容易学习。我从 K&R 开始，但直到拿起这本书才真正掌握 C。

**编辑**：我也刚刚发现这本书的价格自从我买了它就飞涨了。因此，虽然我的推荐仍然如此，但我不能以目前的要价真正推荐它。因此，如果您可以在图书馆找到二手或副本，那么它是值得的，但以目前的价格，还有其他书籍基本上一样好，而且花更少的钱。

专家 C 编程是我认为至少值得一读的书，一旦你掌握了 C 的窍门，尽管我不愿直接推荐它。从好的方面来说，它包含许多好的提示和技巧以及一些非常有用的建议。不利的一面是，这些技巧和建议的组织很糟糕，被埋在不太有用的建议中，而且书的一半似乎充满了蹩脚的笑话、旁白和不相关（但偶尔有趣）的故事。所以我会从图书馆借它，但不付钱。

但正如您无疑意识到的那样，在您编写 C 之前，您永远不会真正学习 C。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-30T21:40:19.900

再次拿起你的 K&R 书，这次做练习。然后将您的代码与 K&R 中的代码进行比较，看看它在函数接口和数据结构上是否具有类似的优雅。这不是一本可以快速阅读并转到下一本书的书。它包含许多有价值的信息，练习将帮助您了解其中一些您可能在第一次阅读时错过的信息。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-04-30T21:56:17.773

[C 释放](http://users.powernet.co.uk/eton/unleashed/)。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-29T18:45:25.430

APress 的 Ivor Horton 的《Beginning C》（第 3 版）是一本很棒的 C 编程入门书籍。这本书非常透彻，不是一本参考书，而是一本很好的教程，从头到尾介绍了 C 语言的所有内容。

[Ivor Horton 的《Beginning C》（第 3 版）](https://rads.stackoverflow.com/amzn/click/com/1590592530)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-30T21:33:40.057

一本学习 C 的好书是： [**C BY DISSECTION** The Essentials of C Programming by Al Kelley 和 Ira Pohl](https://rads.stackoverflow.com/amzn/click/com/0201713748)

非常容易阅读，有很多很棒的编程示例。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-02T17:37:46.787

最好的 CI 教科书是Peter A. Darnell 和 Philip E. Margolis 的[C: A Software Engineering Approach](https://rads.stackoverflow.com/amzn/click/com/0387946756)。虽然它（不应该）没有其他书籍那么有名，但我发现它非常易读，它处理了 K&R 跳过的所有细节。

但它有两个缺点：

1.  它是 1996 年的，因此不包括 C99。（这对你来说应该没问题，因为你对 C89 感兴趣。）
2.  这是相当昂贵的。

**编辑：** 另一本有趣的书是Steve Summit 的[C Programming FAQs](https://rads.stackoverflow.com/amzn/click/com/0201845199)。虽然我没有出版这本书，但随附[的网站](http://www.eskimo.com/~scs/c-faq.com/index.html)帮助我理解了 C 中不太明显的特性。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-29T18:23:44.657

我可能还建议阅读 C 程序。可悲的是，我自己做的还不够多，无法推荐特定的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-30T09:05:43.633

[ACCU](http://accu.org/)（俄罗斯镜像）有一些简短但有用的评论，适用于[初学者的 C](http://www.accu.informika.ru/accu/bookreviews/public/reviews/0sb/beginner_s_c.htm)和[高级](http://www.accu.informika.ru/accu/bookreviews/public/reviews/0sb/advanced_c.htm)C。

# python - 合并两个列表列表 - Python

> ID：803526
> 
> 赞同：1
> 
> 时间：2009-04-29T17:57:29.133
> 
> 标签：python, django, list

这是一本很棒的入门书，但不能回答我需要的内容： [Combining two sorted lists in Python](https://stackoverflow.com/questions/464342/combining-two-sorted-lists-in-python)

我有两个 Python 列表，每个列表都是日期时间、值对的列表：

```
list_a = [['1241000884000', 3], ['1241004212000', 4], ['1241006473000', 11]] 
```

和：

```
list_x = [['1241000884000', 16], ['1241000992000', 16], ['1241001121000', 17], ['1241001545000', 19], ['1241004212000', 20], ['1241006473000', 22]] 
```

1.  实际上有许多 list_a 具有不同键/值的列表。
2.  所有 list_a 日期时间都在 list_x 中。
3.  我想创建一个列表，list_c，对应于每个 list_a，每个 list_a 都有来自 list_x 和 value_a/value_x 的每个日期时间。

奖金：

在我的真实程序中， list_a 实际上是字典中的一个列表，就像这样。将答案带到字典级别将是：

```
dict = {object_a: [['1241000884000', 3], ['1241004212000', 4], ['1241006473000', 11]], object_b: [['1241004212000', 2]]} 
```

我可以弄清楚那部分。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T18:08:34.600

这是一些可以满足您要求的代码。您可以直接将配对列表转换为字典。然后可以通过与密钥集相交来找到共享的密钥。最后，给定一组共享键，构建结果字典很容易。

```
dict_a = dict(list_a)
dict_x = dict(list_x)

shared_keys = set(dict_a).intersection(set(dict_x))

result = dict((k, (dict_a[k], dict_x[k])) for k in shared_keys) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T18:35:51.010

“我想创建一个列表，list_c，对应于每个 list_a，其中每个日期时间都来自 list_x 和 value_a/value_x。”

```
def merge_lists( list_a, list_x ):
    dict_x= dict(list_x)
    for k,v in list_a:
        if k in dict_x:
            yield k, (v, dict_x[k]) 
```

类似的东西也可能起作用。

```
merged= list( merge_lists( someDict['object_a'], someDict['object_b'] ) 
```

这可能会稍微快一些，因为它只创建一个字典用于查找，而单独留下另一个列表。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-11-25T02:08:39.480

没有什么能比得上一个很好的功能性单线：

```
reduce(lambda l1,l2: l1 + l2, list) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-26T12:40:41.063

可以尝试扩展：

```
list_a.extend(list_b) 
```

# objective-c - 发布后是否需要在 Objective-C 中将指针设置为零？

> ID：803531
> 
> 赞同：22
> 
> 时间：2009-04-29T17:59:07.743
> 
> 标签：objective-c, null

做类似的事情有什么问题吗

> `NSString * string = [ [ NSString alloc ] init ];`
> `...`
> `[ string release ];`

或者还有什么价值（除了最佳实践）还添加

> `string = nil;`

?

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-29T18:00:19.767

没有必要，但很好的做法。如果你在发布后无意中引用了它，可能会发生不好的事情，但在 Objective C 中引用 nil 并没有任何害处。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-03T20:29:57.517

在多线程应用程序中将实例变量设置为 nil 比在单线程应用程序中更有用，因为对于多个线程，您不能总是保证实例变量只会在它被释放*之前被读取。*

我通常不会在单线程应用程序中打扰，除非有其他令人信服的理由。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-19T17:39:56.953

Objective-C 实际上与带有花哨预处理器的 C 相同。

在 Objective-C 中将指针设置为 nil 不会影响该指针曾经指向的内容。

# activerecord - 实现一个 ActiveRecord before_find

> ID：803532
> 
> 赞同：3
> 
> 时间：2009-04-29T17:59:53.403
> 
> 标签：activerecord, callback

我正在使用缓存在表中的关键字进行搜索。在表格中查找用户输入的关键字之前，对其进行规范化。例如，一些标点符号（如“-”）被删除，大小写标准化。然后使用规范化的关键字来查找获取搜索结果。

我目前正在使用 before_filter 处理控制器中的规范化。我想知道是否有办法在模型中做到这一点。概念上类似于“before_find”回调的东西会起作用，尽管这对于实例级别没有意义。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-06-10T13:42:37.623

您应该使用命名范围：

```
class Whatever < ActiveRecord::Base

  named_scope :search, lambda {|*keywords|
    {:conditions => {:keyword => normalize_keywords(keywords)}}}

  def self.normalize_keywords(keywords)
    # Work your magic here
  end

end 
```

使用命名范围将允许您与其他范围链接，这确实是使用 Rails 3 的方式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-09T13:14:24.413

与上面非常相似，您也可以使用`alias_method_chain`.

```
class YourModel < ActiveRecord::Base

  class << self
    def find_with_condition_cleansing(*args)
      #modify your args
      find_without_condition_cleansing(*args)
    end
    alias_method_chain :find, :condition_cleansing
  end

end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T18:13:52.060

您可能不想通过覆盖 find 来实现这一点。覆盖诸如 find 之类的东西可能会让人头疼。

您可以创建一个类方法来满足您的需要，例如：

```
class MyTable < ActiveRecord::Base
  def self.find_using_dirty_keywords(*args)
    #Cleanup input
    #Call to actual find
  end
end 
```

如果你*真的*想超载 find 你可以这样做：

举个例子：

```
class MyTable < ActiveRecord::Base
  def self.find(*args)
    #work your magic here
    super(args,you,want,to,pass)
  end
end 
```

有关子类化结帐的更多信息，请查看此链接：[Ruby Tips](http://www.fincher.org/tips/Languages/Ruby/)

# c# - 是否可以以编程方式填写 Ajax 表单？

> ID：803538
> 
> 赞同：1
> 
> 时间：2009-04-29T18:01:16.473
> 
> 标签：c#, post, ajax-forms

我正在做一些自动化工作，可以绕过网站并发布到 HTML 表单，但现在我面临一个新的挑战，**Ajax**表单。

由于没有可阅读的资源，我想知道是否可以在 C# 中以编程方式填写 Ajax 表单。我目前正在使用不可见的 axWebBrowser。

在此先感谢您的帮助！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T18:14:47.050

是的，但我建议使用不同的方法来请求/响应服务器页面，包括常规页面和 AJAX 处理程序页面。

在 c# 中，尝试使用[WebRequest](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fsystem.net.webrequest.aspx&ei=L5n4SZP4MILEM_3UoKoP&usg=AFQjCNGPSWOKUXSjjRtDEA2kHOLz9NWCtw) / [WebResponse](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fsystem.net.webresponse.aspx&ei=Qpn4SamePJrKMru2hbUP&usg=AFQjCNEEXwP9m_2hmw-gHEmTsXBN2Y-khA)或更专业的 HttpWebRequest/HttpWebResponse 类。

Ajax 只不过是一种允许 Javascript 向服务器发出 HTTP 请求的技术的“花哨”名称，该服务器通常实现一些处理程序，为 Javascript 调用者生成专门的、轻量级的内容（通常编码为 JSON）。

因此，为了模拟 AJAX 调用，您所要做的就是检查您的目标应用程序（您想要“发布”到的网页）并查看用于 AJAX 通信的格式 - 然后从 C# 复制页面的 Javascript 行为使用 WebREquest/WebResponse 类。

请参阅[Firebug](http://getfirebug.com/) - 一个很棒的工具，它允许您检查网页以确定它发出什么调用、对哪些页面以及这些页面响应什么。它在检查 AJAX 调用方面也做得很好。

这是一个非常简单的示例，说明如何执行 Web 请求：

```
HttpWebRequest wReq = (HttpWebRequest)WebRequest.Create("http://www.mysite.com");

using (HttpWebResponse resp = (HttpWebResponse)wReq.GetResponse())
{
   // NOTE: A better approach would be to use the encoding returned by the server in
   // the Response headers (I'm using UTF 8 for brevity)
   using (StreamReader sr = new StreamReader(resp.GetResponseStream(), Encoding.UTF8))
   {
       string content = sr.ReadToEnd();
       // Do something with the content
   }
} 
```

POST 也是一个请求，但使用不同的方法。有关如何做一个非常简单的帖子的示例，请参阅[此页面。](http://msdn.microsoft.com/en-us/library/d4cek6cc.aspx)

**编辑**- 有关使用 Firebug 检查页面行为的详细信息

我通过检查您尝试复制的页面的意思是使用一种工具（我在 Firefox 上使用 Firebug）来确定页面和服务器之间的信息流。

使用 Firebug，您可以使用“Net”和“Console”面板来完成此操作。Net 面板列出了加载页面时浏览器执行的所有请求。而“控制台”将列出页面加载后页面与服务器之间发生的通信。在页面加载后发生的那些通信本质上是您想要复制的 AJAX 调用（注意：必须在 Firebug 中启用网络监控才能使其工作）

查看[Michael Sync 的教程](http://michaelsync.net/category/firebug)以了解有关 Firebug 的更多信息，并使用控制台面板进行试验以了解有关 AJAX 请求的更多信息。

关于“使用 WebRequest/WebResponse 从 C# 复制页面的行为”——您必须意识到，就像我之前所说的，Javascript AJAX 调用只不过是一个 HTTP 请求。这是 Javacript 在“幕后”或带外向 Web 服务器发出的 HTTP 请求。要复制这一点，它实际上与复制一个普通的 GET 或一个普通的 POST 就像我上面展示的一样。这就是 Firebug 发挥作用的地方。使用它，您可以查看请求，因为 Javascript 使请求 - 查看控制台面板，并查看请求消息的样子。

然后您可以使用与上述相同的技术，使用 HttpWebRequest/HttpWebResponse 发出与 Javascript 相同类型的请求，而只能从 C# 中进行。

Gregg，我希望这能澄清我的答案，但除此之外，我建议使用 Firebug，并可能了解更多关于 HTTP 协议如何工作以及 AJAX 作为一项技术如何工作的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T18:09:38.217

你有没有看过使用 Selenium。AFAIK，您可以用 C# 编写测试用例，我知道我们的测试人员之前已经成功使用它来测试启用 Ajax 的 ASP.NET 站点的 UI 测试

[http://seleniumhq.org/](http://seleniumhq.org/)

# c# - 自定义 TabControl 以关闭单个选项卡

> ID：803540
> 
> 赞同：19
> 
> 时间：2009-04-29T18:02:40.650
> 
> 标签：c#, winforms, user-interface, controls, tabcontrol

## 我的情况如下：

我正在使用 C# 开发一个 winforms 应用程序，该应用程序在 tabcontrol 的主页内有一个按钮，每次单击它都会生成另一个 tabpage。每个新标签页都将包含由用户控件定义的布局。

## 我的问题是：

1.  如何允许用户关闭在运行时动态创建的选项卡之一？

2.  我该如何修改 tabcontrol 本身，使其在每个选项卡中都有一个小“X”，用户可以单击它以关闭该特定选项卡？（就像 Firefox 一样）

3.  如果我想用用户控件内的按钮关闭选项卡，如何将选项卡控件的 SelectedIndex 属性公开给用户控件？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2010-11-25T18:05:21.960

我找到了这段代码，对我很有帮助：

```
private void tabControl_MouseUp(object sender, MouseEventArgs e)
{
    // check if the right mouse button was pressed
    if(e.Button == MouseButtons.Right)
    {
        // iterate through all the tab pages
        for(int i = 0; i < tabControl1.TabCount; i++)
        {
            // get their rectangle area and check if it contains the mouse cursor
            Rectangle r = tabControl1.GetTabRect(i);
            if (r.Contains(e.Location))
            {
                // show the context menu here
                System.Diagnostics.Debug.WriteLine("TabPressed: " + i);
             }
        }
    }
} 
```

[TabControl：如何捕获鼠标右键单击选项卡](http://social.msdn.microsoft.com/forums/en-US/winforms/thread/e09d081d-a7f5-479d-bd29-44b6d163ebc8)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-29T18:38:00.130

大约一年前，我创建了一个派生的选项卡控件。我不打算在这里发布源代码，因为它大约有 700 行长并且编码非常混乱。也许我会找时间清理一下代码，然后在这里发布。现在我将简要概述它的构建方式。

*每个标签页的标题左侧*都有一个“X”图标，标签页支持通过拖放重新排序并在多个标签控件之间移动它们。

我选择了在标签页上获取图标的简单方法。标签控件有[`TabControl.ImageList`](http://msdn.microsoft.com/en-us/library/system.windows.forms.tabcontrol.imagelist.aspx)属性，标签页有[`TabPage.ImageIndex`](http://msdn.microsoft.com/en-us/library/system.windows.forms.tabpage.imageindex.aspx)属性。所以我只是在图像列表中添加了三个图标——正常、悬停、按下——并处理鼠标事件。

您可以测试鼠标是否在[`TabControl.GetTabRect()`](http://msdn.microsoft.com/en-us/library/system.windows.forms.tabcontrol.gettabrect.aspx)特定的标签页上，并通过一些数学运算发现它是否在图标上。然后你只需要根据鼠标按钮的状态改变图标，如果按钮被按下，最终删除鼠标下的标签页。

这个解决方案的主要问题是，计算鼠标是否在图标上需要知道图标相对于标签页的绘制位置，这可能会随着新的 Windows 版本而改变。图标位于标题的左侧，但看起来还不错。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-05-24T22:07:47.140

我做了以下事情：在创建（添加）`TabPage`阶段，我添加了一个`toolStrip`

```
ToolStrip ts = new ToolStrip();
ts.Dock = DockStyle.Top;
ts.RightToLeft = System.Windows.Forms.RightToLeft.Yes; 
```

然后，创建`X`按钮并将其添加到`toolstrip`

```
ToolStripButton ToolStripButton = new ToolStripButton("X");
ts.Items.Add(ToolStripButton); 
```

`X`在单击按钮时创建事件

```
ToolStripButton.Click += new EventHandler(ToolStripButton_Click); 
```

添加`toolstrip`到`tabpage`

```
tabControl1.TabPages[curenttabpage].Controls.Add(ts); 
```

**现在** 的`ToolStripButton_Click`情况如下：

```
void ToolStripButton_Click(object sender, EventArgs e)
{ 
 ToolStripButton t = (ToolStripButton)(sender);
 ToolStrip ts = t.Owner;
 TabPage tb = (TabPage)
 (ts.Parent);tabControl1.TabPages.Remove(tb);
} 
```

也许它不是你想要的，但它会很好地工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-29T19:53:29.980

我创建了一个类似的设置。

在运行时添加到选项卡页的每个控件都派生自我创建的特殊基本控件。此基本控件有一个关闭按钮（以及一些其他功能，例如安全关闭标志）。

我在基本控件上使用的关闭选项卡代码：

```
 TabPage tabpage = (TabPage)this.Parent;
TabControl tabControl = (TabControl)tabpage.Parent;

tabControl.TabPages.Remove(parent); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-09-22T00:00:24.263

我知道这是一个旧线程，但我确实找到了这个[链接](http://www.syncfusion.com/FAQ/windowsforms/faq_c93c.aspx#q642q)，它允许您“隐藏”数组中的选项卡，然后您可以在运行时重新加载所需的选项卡。我添加了这个更多的地方，我可以很容易地再次找到它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-08-07T08:04:26.317

此代码可能有助于通过单击鼠标中键关闭选项卡控件：

```
 private void tabControl1_MouseDown(object sender, MouseEventArgs e)
            {
                if (e.Button != System.Windows.Forms.MouseButtons.Middle)
                    return;

                for (int i = 0; i < MainTabControl.TabPages.Count; i++)
                {
                    if (this.MainTabControl.GetTabRect(i).Contains(e.Location))
                    {
                        this.MainTabControl.TabPages.RemoveAt(i);
                        return;
                    }
                }
            } 
```

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2015-04-24T21:06:25.273

其作品！

```
TabPage tabpage = (TabPage)this.Parent;
TabControl tabControl = (TabControl)tabpage.Parent;
tabControl.TabPages.Remove(tabpage); 
```

# java - Java 泛型和无穷大（可比较）

> ID：803543
> 
> 赞同：6
> 
> 时间：2009-04-29T18:03:46.640
> 
> 标签：java, generics, comparable, infinity

使用 Integer 类型，您可以执行以下操作：

```
int lowest = Integer.MIN_VALUE; 
```

如果我使用泛型，我该怎么办？

```
K lowest = <...>; 
```

我需要这个来实现类似于 PriorityQueue 的东西。我可以访问要从队列中删除的节点，但这不是最小值。

```
1\. I need to make it the min by decreasing the key of that node,
2\. And then remove the min. 
```

我被困在第一步。我唯一能做的就是将节点的键设置为当前最小值。不确定是否足够。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T18:15:50.683

所有 Comparable 类型都没有通用`MIN_VALUE`形式`MAX_VALUE`。

考虑一个`Time`实现可比较的类。没有`MAX_VALUE`时间，即使它是可比的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-29T18:33:32.013

我试图想象什么样的场景需要这种行为。这是我能想到的最好的...

**警告：**此代码很危险。请原谅我发布如此可憎的内容。这只是一个概念证明。

```
public class Lowest<K> implements Comparable<K> {
    public int compareTo(K other) {
        return -1;
    }
} 
```

接着...

```
public class Test {
    public <K extends Comparable<K>> K findMaximum(List<K> values) throws Exception {
        K lowest = (K) new Lowest<K>(); /// XXX DANGER! Losing compile-time safety!!!

        K maximum = lowest;
        for (K value : values) {
            if (maximum.compareTo(value) < 0) {
                maximum = value;
            }
        }

        if (maximum == lowest) {
            throw new Exception("Could not find a maximum value");
        } else {
            return maximum;
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-29T21:41:43.107

您可以创建一个包装类，为所有类型“添加”最小值和最大值。它只有两个静态实例，代表最小值和最大值，然后其他实例包装某种类型的其他值。当我们进行比较时，我们检查其中一项是最小值还是最大值，并返回正确的结果；否则我们只做与底层类型相同的比较。像这样的东西：

```
class Extended<T extends Comparable<? super T>> implements Comparable<Extended<T>> {
    private Extended() { }

    private static Extended min = new Extended();
    private static Extended max = new Extended();

    @SuppressWarnings("unchecked")
    public static <T extends Comparable<? super T>> Extended<T> getMin() {
        return (Extended<T>)min;
    }
    @SuppressWarnings("unchecked")
    public static <T extends Comparable<? super T>> Extended<T> getMax() {
        return (Extended<T>)max;
    }

    public T value;

    public Extended(T x) { value = x; }

    public int compareTo(Extended<T> other) {
        if (this == other) return 0;
        else if (this == min || other == max) return -1;
        else if (this == max || other == min) return 1;
        else return this.value.compareTo(other.value);
    }
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-29T18:15:41.557

这没有任何意义...

鉴于您当时不知道 K 是什么，（即您正在通用地实现它......呃！）您不能为它指定最小/最大界限。

在 K 可能是 int、long、string OR 对象的情况下，您无法明智地猜测使用

整数.MIN_VALUE，“”或 NULL。

我猜您正在寻找的是 K.MIN_VALUE_OF_EVENTUAL_TYPE 但它不存在。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-29T20:08:28.790

考虑不要制作`K`泛型，而是使用包装原始包装器的接口（双重包装器！）。

```
import java.util.HashMap;

public class NodeWrapper<K extends Comparable<K>> implements Comparable<NodeWrapper<K>> {

    private static HashMap<Class, NodeWrapper> minVals = new HashMap<Class, NodeWrapper>();

    private K value;

    private NodeWrapper() {
        super();
    }

    public NodeWrapper(K value, Class<K> clazz) {
        super();
        this.value = value;

        if (minVals.get(clazz)==null) {
            minVals.put(clazz, new NodeWrapper<K>());
        }
    }

    public K getValue() {
        return value;
    }

    public static NodeWrapper getMinValue(Class clazz){
        return minVals.get(clazz);
    }

    public void setValue(K value) {
        this.value = value;
    }

    @Override
    public int compareTo(NodeWrapper<K> o) {
        NodeWrapper min = minVals.get(this.getClass());
        if (this==min && o==min)  {
            return 0;
        } else if (this==min){
            return -1;
        } else if (o==min){
            return 1;
        } else {
            return this.value.compareTo(o.value);
        }
    }

} 
```

简而言之，这个想法是每当实例化一个新类时，都会创建一个最小值并将其放入存储每个类的最小值的静态哈希图中。（事实上​​，这些值根本不是什么，只是一个标记对象，但由于我们将使用对象相等性来确定某个东西是否是最小值，所以这根本没有问题。）所需要的是被包装的对象是可比较的到一般自身的其他实例。

一个缺点是，当您调用时，`getMinValue`您会收到编译器警告，因为返回类型将没有通用信息。可能有一个更优雅的方法来解决这个问题，但我现在想不出。

总体而言，这个总体思路可能相当不错。但是，我真的应该强调：如果您尝试使用任何多态性或任何相互可比的类的混合，这绝对会失败。 `Long`s 和`Integer`s 在同一棵树上会彻底摧毁你。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-29T20:47:29.460

呃……又是什么问题？

[PriorityQueue](http://java.sun.com/javase/6/docs/api/java/util/PriorityQueue.html)与所有[Collections](http://java.sun.com/javase/6/docs/api/java/util/Collection.html#remove(java.lang.Object))一样，允许您使用对象的实例将其从集合中[删除。](http://java.sun.com/javase/6/docs/api/java/util/PriorityQueue.html#remove(java.lang.Object))

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-29T18:05:33.857

呃，这不取决于K是什么类型吗？

泛型的要点是 K 可以是任何类型（或某种类型的任何子类）；为了能够调用 K 上的方法或访问它的属性，您需要使用通配符限制它的类型边界。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-29T18:16:24.767

仅仅因为一个对象是可比较的并不意味着它必须具有最小值。int 的最小值为 -(2^(31)) 的原因是因为您需要 1 位作为符号，因此 2^31 是可以存储的最大（或最小）整数。对于字符串之类的东西，它没有任何意义，因为没有可能的最大/最小字符串，它是内存绑定的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-29T18:16:32.957

您可能必须创建一个接口“IInfinity”，并让 K 扩展 IInfinity，并让 IInfinity 拥有一个方法“getInfinityValue()”，然后在实现 IInfinity 的类中包装/扩展 Integer、Double、BigDecimal 等...啊！

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-29T18:17:07.107

基本上你希望任何类型的 K 实现一些静态函数，比如最低和最高，它们遵守标准的数学属性。

我假设要使这种最低（或最高）的感觉可用，您会希望任何 Comparable 对象都具有这些方法。（或静态字段）。如果您只对自己的自定义对象感兴趣，那么这样做的方法是让所有内容都继承自一个抽象数据类型，该数据类型为 MINVALUE 和 MAX_VALUE 声明了静态字段，然后您的类型变量将是 . 如果您需要其他类的此功能，您将需要创建某种外部哈希图来跟踪不同类的这些属性（但这会变得非常难看）

# windows - 将 Numpad 与修改键一起使用会表现出奇怪的行为

> ID：803548
> 
> 赞同：2
> 
> 时间：2009-04-29T18:04:21.800
> 
> 标签：windows, flash, keyboard, modifier-key

我有一个键盘事件侦听器，我正在侦听[数字键盘键码](http://livedocs.adobe.com/flash/9.0/main/00001136.html#wp71525)（1 到 9），以便激活数字锁定；这很好用。但是，在我的应用程序中，我还希望允许使用修饰键 (CTRL) 和数字键盘键。奇怪的是，当按住 CTRL 时，按 1 或 3 不会产生任何键盘事件，而 2 和 4 - 9 会产生预期的事件。 ~~经过一些谷歌搜索后，我看到了有关此问题的其他参考资料，因此我认为这不一定是特定于 Flash 的，但我还没有找到任何答案。~~

我尝试使用 SHIFT 作为修饰符，但这只会导致从数字键盘生成键码，就好像数字锁定已关闭（例如，SHIFT+Numpad1 返回 End 键码，无论数字锁定状态如何） - 显然这是故意的 Windows行为。由于[altcodes](http://en.wikipedia.org/wiki/Alt_code) ， ALT 不是小键盘的选项。

关于如何让 CTRL+Numpad1 和 CTRL+Numpad3 生成键盘事件的任何想法？或者对他们为什么不这样做的任何解释？

**编辑：**我尝试在 Firefox 中使用这些组合键，如下 enriquein 建议的那样，所有组合键都可以正常工作，这让我相信这可能是 Flash 特定的问题，或者至少不是硬件问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-02T15:15:38.513

我几乎可以肯定它与 Flash 无关，因为我在本地化键盘上遇到了类似的问题，并且根本无法让它为某些键或组合键生成事件。

尝试枚举所有关键事件并搜索它们映射到的内容，或者谷歌 evtest.c，编译并运行它，看看它要说什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T10:12:14.563

过去我在特定键盘上遇到过小键盘键的问题。各种组合键无法在特定键盘上注册，在这种情况下，您使用的键盘可能不会生成任何事件。不能保证可以正常工作，但我建议尝试使用不同的键盘（不同的供应商等），看看是否可行。如果您使用的是非英文键盘，本地化键盘也可能存在问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T16:10:51.320

实际上，它看起来像是特定于键盘的。我在 Firefox 中阅读此问题时尝试了组合键，它们触发了与按 Ctrl+Number 相同的事件（即切换到选项卡#Number）。

这是使用标准的美国/101 键英文键盘（没有额外的媒体按钮或任何东西）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T07:39:41.300

某些键盘不注册某些组合键。我认为这取决于它们的组合方式。例如，有些人可能会注册左手 Ctrl + 组合键，但不会注册右 Ctrl + 同一个键！

一种解决方法是检测 Ctrl 键的按键按下和按键向上事件。

然后，您可以为 Ctrl + 数字键盘键引发自定义事件，或者使用 volatile 标志来显示 Ctrl 键状态。

# perl - 是否有将 c99 十六进制浮点表示法转换为常规表示法的 Perl 模块？

> ID：803557
> 
> 赞同：3
> 
> 时间：2009-04-29T18:07:51.980
> 
> 标签：perl, floating-point, hex, string-parsing

是否有一个内置库可用于将 c99 样式的浮点表示法（例如：0x1.0p23f）转换为使用 Perl 的常规浮点数（反之亦然）？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T18:30:40.023

没有任何内置功能，但 CPAN 是您的朋友。[Data::Float](http://search.cpan.org/perldoc?Data::Float)模块具有`hex_float`执行此操作的`float_hex`功能。

# python - Python 嵌入线程——避免死锁？

> ID：803566
> 
> 赞同：7
> 
> 时间：2009-04-29T18:09:33.333
> 
> 标签：python, multithreading, deadlock, embedding

有没有办法嵌入 python，允许从 python 到 C++ 的回调，允许 Pythhon 代码产生线程，并避免死锁？

问题是这样的：

*   要调用 Python，我需要持有 GIL。通常，我首先创建解释器时获取主线程状态，然后使用 PyEval_RestoreThread() 获取 GIL 并在调用 Python 之前交换线程状态。

*   从 Python 调用时，我可能需要访问一些受主机中单独的临界区保护的受保护资源。这意味着 Python 将持有 GIL（可能来自我最初调用的其他线程），然后尝试获取我的保护锁。

*   当调用 Python 时，我可能需要持有相同的锁，因为我可能正在迭代某些对象集合。

问题是，即使我在调用 Python 时持有 GIL，Python 也可能会放弃它，将其交给另一个线程，然后让该线程调用我的主机，期望获取主机锁。同时，主机可以获取主机锁和 GIL 锁，并调用 Python。出现僵局。

这里的问题是，当我调用 GIL 时，Python 将 GIL 放弃给另一个线程。这就是它所期望的，但是它使得顺序锁定成为不可能——即使我首先使用 GIL，然后使用我自己的锁，然后调用 Python，Python 将从另一个线程调用我的系统，期望使用我自己的锁（因为它通过释放 GIL 来取消对 GIL 的排序）。

我不能真正让我的系统的其余部分使用 GIL 来处理系统中所有可能的锁——这甚至不能正常工作，因为 Python 可能仍会将它释放到另一个线程。

我也不能真正保证我的主机在进入 Python 时不会持有任何锁，因为我无法控制主机中的所有代码。

那么，难道就只有这样就做不到了吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T18:44:19.803

“当调用 Python 时，我可能需要持有相同的锁，因为我可能正在迭代某些对象集合。”

这通常表明具有多个线程的单个进程是不合适的。也许在这种情况下，多个进程——每个进程都有一个来自集合的特定对象——更有意义。

独立的进程——每个都有自己的线程池——可能更容易管理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T21:49:50.637

python 调用的代码应该在获取任何锁之前释放 GIL。这样我相信它不会陷入僵局。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-30T18:53:15.793

There was recently some discussion of a similar issue on the pyopenssl list. I'm afraid if I try to explain this I'm going to get it wrong, so instead I'll refer you to [the problem in question](https://bugs.launchpad.net/pyopenssl/+bug/344815).

# apache-flex - Adobe Flex/AIR 的开发工具？

> ID：803581
> 
> 赞同：6
> 
> 时间：2009-04-29T18:14:54.087
> 
> 标签：apache-flex

我在一家公司开始了一个新的开发职位，该公司在 Adob​​e Flex 中实现了许多产品。我应该为 Flex 开发安装哪些工具（首选 Ubuntu Linux 选项）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T18:48:07.157

正如 dirkgently 所说，在 Linux 中安装 Flex Builder 3 是一个很好的开始方式。它启动和运行起来既快速又容易，而且由于它基于 Eclipse，所以整体环境还不错。

也就是说，我能够使用[Emacs](http://www.gnu.org/software/emacs/)和一些第三方软件包构建一个体面的 Flex 构建环境，让所有东西都在 Linux 下运行。

这是我使用的快速概述（这并不全面——只是我能记住的）：

*   适用于 Linux 的[Flex 3 SDK](http://www.adobe.com/products/flex/flexdownloads/)
*   用于 AS 代码高亮的[actionscript-mode.el](http://blog.pettomato.com/?p=12)
*   用于 MXML 代码突出显示的[nxml 包](http://www.thaiopensource.com/nxml-mode/)
*   [ani-fcsh.el](http://anirudhs.chaosnet.org/code/ani-fcsh.el.html)用于从 Emacs 运行 fcsh
*   [ECB](http://ecb.sourceforge.net/)用于 Emacs 中的代码浏览
*   [snippet.el](http://www.kazmier.com/computer/snippet.el)用于在 Emacs 中创建代码模板

[此链接](http://flexman.info/2008/09/22/setup-flash-flex-development-evironment-under-unix-linux/)也有助于入门。它链接到[这篇文章](http://ntt.cc/2008/05/19/using-actionscript-3-to-develop-adobe-flash-content-on-linux.html)，该文章讨论了在 Linux 中整合 Flex 开发环境。我能够整理一些用于编译和运行应用程序的 shell 脚本。

注意：我没有进行任何调试，尽管 Adob​​e 有一些关于它的[信息](http://livedocs.adobe.com/flex/3/html/help.html?content=debugging_01.html)。

注意#2：如果您决定使用 Flex Builder，它将在您的浏览器中安装 Flash Player 9 调试器版本（您可以告诉它不要这样做）。我建议安装[版本 10 的调试器](http://www.adobe.com/support/flashplayer/downloads.html)。构建器将输出有关不支持该版本的警告，但其他一切似乎都可以正常工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T18:18:40.660

如果可以，请尝试[适用于 Linux 的 Flex Builder 3 alpha](http://labs.adobe.com/downloads/flexbuilder_linux.html)。这就是你能得到的（虽然不是没有它的一套宠物烦恼！）。然而，它缺少以下内容：

```
* Design view
* States view
* Refactoring
* Data Wizards
* Cold Fusion - Data Services Wizard
* Web Services introspection
* Profiler 
```

由于 AIR/Flex 是跨平台技术，我不明白您为什么要将自己限制在 Linux 上。至少就目前而言，我认为您最好在 Windows 上使用适当的 Flex Builder 3 进行开发。然后，您可以在 Linux 上测试您的产品。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-08-23T09:55:06.543

关于调试 - 有一个名为 MonsterDebugger 的外部 AIR 调试器非常好

# actionscript-3 - E4X：表达式没有返回我所期望的

> ID：803585
> 
> 赞同：1
> 
> 时间：2009-04-29T18:15:21.510
> 
> 标签：actionscript-3, e4x

我有一个 XMLList，我试图从列表中抓取一个带有石头属性 == Opal 但它不起作用，我不明白为什么？

这是代码：

```
var xml:XML = <bs><variation price="999999999.99" month="OCT" stone="Magic Pet Rock" image="https://www.sussexjewelers.com/birthstone_images/20_PE105-BT.png" style="PE105" gold_color="White" gold_carat="14"/>
<variation price="999999999.99" month="OCT" stone="Opal" image="https://www.sussexjewelers.com/birthstone_images/17_PE105-OP.png" style="PE105-OP" gold_color="Yellow" gold_carat="14"/>
<variation price="33212221.00" month="OCT" stone="Pink Tourmaline" image="https://www.sussexjewelers.com/birthstone_images/16_PE105-PT.png" style="PE105-PT" gold_color="Yellow" gold_carat="14"/></bs>;

var list:XMLList = xml.children();

trace(list) // returns all three variations

list = list.(@stone == 'Opal');

trace(list); // expecting to return the 2nd variation but actually returns nothing. 
```

谁能明白为什么这不能按预期工作？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T18:18:29.553

我在弄清楚之前就发布了这个问题......我需要在跟踪它时添加 toXMLString() 。

```
trace(list.toXMLString()); 
```

# mysql - MySQL 高级查询脑筋急转弯

> ID：803597
> 
> 赞同：3
> 
> 时间：2009-04-29T18:18:25.170
> 
> 标签：mysql, sql

我被要求创建一份财务报告，该报告需要为几个“推荐人”提供两个日期之间的总佣金率。那是容易的部分。

困难的部分是佣金率不仅取决于推荐人**，还****取决于**推荐的类型以及给定推荐人已进行的该类型推荐的数量。

 **推荐数量的跟踪需要考虑所有推荐，而不是给定日期范围内的推荐 - 换句话说，每个推荐人的佣金率是浮动的，随着他们总推荐量的增加而变化。幸运的是，每种推荐类型最多只有 3 个佣金级别。

引荐都存储在同一个表中，每个引荐 1 行，其中一个字段表示引荐来源和引荐类型。一个例子来说明：

```
ID   Type    Referrer    Date
1    A       X           01/12/08
2    A       X           15/01/09
3    A       X           23/02/09
4    B       X           01/12/08
5    B       X           15/01/09
6    A       Y           01/12/08
7    A       Y           15/01/09
8    B       Y           15/01/09
9    B       Y           23/02/09 
```

佣金率不存储在推荐表中——实际上可能会改变——而是存储在推荐者表中，如下所示：

```
Referrer    Comm_A1    Comm_A2    Comm_A3    Comm_B1    Comm_B2    Comm_B3
X           30         20         10         55         45         35
Y           45         35         25         60         40         30 
```

以上面的推荐表为例，假设佣金率水平在推荐 1 和 2 之后增加（然后保持不变），运行 2008 年 12 月至 2009 年 2 月的佣金报告将返回以下内容：

**[编辑]** - 澄清上述，佣金率对于每种类型和每个推荐人都有三个级别，第一个推荐佣金的初始费率为 Comm_A1，第二个推荐佣金为 Comm_A2，所有后续推荐为 Comm_A3。

```
Referrer    Type_A_Comm    Type_A_Ref    Type_B_Comm    Type_B_Ref
X           60             3             100            2
Y           80             2             100            2 
```

运行 2009 年 2 月的佣金报告将返回：

```
Referrer    Type_A_Comm    Type_A_Ref    Type_B_Comm    Type_B_Ref
X           10             1             0              0
Y           0              0             40             1 
```

**就列/行分组而言，编辑**上述结果已根据我的原始问题进行了调整。

我很确定任何解决方案都将涉及子查询（可能针对每种推荐类型）以及某种聚合/ Sum If - 但我正在努力提出一个有效的查询。

**[编辑]**我不确定是否要编写我的要求等式，但我会尝试列出我看到的步骤：

确定每种类型和每个推荐人的先前推荐的数量 - 也就是说，无论任何日期范围。

根据之前推荐的数量，选择合适的佣金等级 - 0 之前 = 1 级，1 之前 = 2 级，2 或更多之前 = 3 级

（注意：之前没有推荐人但有 3 个新推荐人的推荐人预计佣金为 1 x 级别 1、1 x 级别 2、1 x 级别 3 = 总佣金）

根据日期范围过滤结果 - 以便确定活动期间的应付佣金。

返回包含推荐人列的数据，以及每个推荐类型的总佣金列（理想情况下，还有一个包含每种推荐类型计数的列）。

这有助于澄清我的要求吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T18:37:50.987

假设您有一个名为的表`type`，其中列出了您的特定推荐类型，这应该可以工作（如果没有，您可以替换另一个子选择来为此目的从推荐中获取不同的类型）。

```
select
    r.referrer,
    t.type,
    (case 
        when isnull(ref_prior.referrals, 0) < @max1 then 
            (case 
                when isnull(ref_prior.referrals, 0) + isnull(ref_period.referrals, 0) < @max1 then isnull(ref_period.referrals, 0) 
                else @max1 - isnull(ref_prior.referrals, 0) 
            end) 
        else 0 
    end) * (case t.type when 'A' then r.Comm_A1 when 'B' then r.Comm_B1 else null end) +
    (case when isnull(ref_prior.referrals, 0) + isnull(ref_period.referrals, 0) > @max1 then
        (case 
            when isnull(ref_prior.referrals, 0) < @max2 then 
                (case 
                    when isnull(ref_prior.referrals, 0) + isnull(ref_period.referrals, 0) < @max2 then isnull(ref_period.referrals, 0) 
                    else @max2 - isnull(ref_prior.referrals, 0) 
                end) 
            else 0 
        end) -
        (case 
            when isnull(ref_prior.referrals, 0) < @max1 then 
                (case 
                    when isnull(ref_prior.referrals, 0) + isnull(ref_period.referrals, 0) < @max1 then isnull(ref_period.referrals, 0) 
                    else @max1 - isnull(ref_prior.referrals, 0) 
                end) 
            else 0 
        end)
    else 0 end) * (case t.type when 'A' then r.Comm_A2 when 'B' then r.Comm_B2 else null end) +
    (case when isnull(ref_prior.referrals, 0) + isnull(ref_period.referrals, 0) > @max2 then
        (isnull(ref_period.referrals, 0)) -
            (
                (case when isnull(ref_prior.referrals, 0) + isnull(ref_period.referrals, 0) > @max1 then
                    (case 
                        when isnull(ref_prior.referrals, 0) < @max2 then 
                            (case 
                                when isnull(ref_prior.referrals, 0) + isnull(ref_period.referrals, 0) < @max2 then isnull(ref_period.referrals, 0) 
                                else @max2 - isnull(ref_prior.referrals, 0) 
                            end) 
                        else 0 
                    end) -
                    (case 
                        when isnull(ref_prior.referrals, 0) < @max1 then 
                            (case 
                                when isnull(ref_prior.referrals, 0) + isnull(ref_period.referrals, 0) < @max1 then isnull(ref_period.referrals, 0) 
                                else @max1 - isnull(ref_prior.referrals, 0) 
                            end) 
                        else 0 
                    end)
                else 0 end) +
                (case 
                    when isnull(ref_prior.referrals, 0) < @max1 then 
                        (case 
                            when isnull(ref_prior.referrals, 0) + isnull(ref_period.referrals, 0) < @max1 then isnull(ref_period.referrals, 0) 
                            else @max1 - isnull(ref_prior.referrals, 0) 
                        end) 
                    else 0 
                end)
            )                   
    else 0 end) * (case t.type when 'A' then r.Comm_A3 when 'B' then r.Comm_B3 else null end) as Total_Commission

from referrer r

join type t on 1 = 1 --intentional cartesian product
left join (select referrer, type, count(1) as referrals from referral where date < @start_date group by referrer, type) ref_prior on ref_prior.referrer = r.referrer and ref_prior.type = t.type
left join (select referrer, type, count(1) as referrals from referral where date between @start_date and @end_date group by referrer, type) ref_period on ref_period.referrer = r.referrer and ref_period.type = t.type 
```

这假设您有一个`@start_date`和`@end_date`变量，并且您显然必须提供 case 语句中缺少的逻辑，以根据来自 ref_total 的推荐的类型和数量来正确选择费率。

**编辑**

回顾问题后，我看到了关于滑动比例的评论。这大大增加了查询的复杂性，但它仍然是可行的。修改后的查询现在还取决于两个变量`@max1`和的存在`@max2`，表示可以属于类别“1”和类别“2”的最大销售数量（出于测试目的，我分别使用了 1 和 2，这些产生了预期的结果）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T22:27:55.147

亚当的回答比我要详细得多，但我认为尝试将其编写为单个查询可能不是正确的方法。

您是否考虑过创建一个存储过程，该过程会逐步创建并填充一个临时表。

临时表将具有您正在寻找的结果集的形状。初始插入创建您的基本数据集（本质上是您希望使用键标识符返回的行数，然后是您希望返回的任何其他内容，可以轻松地将其组装为同一查询的一部分）。

然后，您将对临时表进行一系列更新，以组装更复杂数据的每个部分。

最后选择它并删除临时表。

这样做的好处是它可以让你在脑海中分解它并一次组装它，这样你就可以更容易地找到你出错的地方。这也意味着更复杂的钻头可以分几个阶段组装。

In addition if some poor sod comes along and has to debug the whole thing afterwards it's going to be far easier for him to trace through what's happening where.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T20:41:13.687

编辑：这个答案没有考虑到以下要求，但似乎有很多新的解释，所以我想我会把它留在这里......

> 推荐数量的跟踪需要考虑所有推荐，而不是给定日期范围内的推荐

好的，假设报告期是每月一次，并且使用一个 CASE，其中 IF 实际上也可以区分两个有效比率（对于 count = 1 和 count > 1），那么：

```
select
  ref.month, 
  ref.referrer, 
  ref.type,
  ( ref.count * 
      case ref.type
        when 'A' then
          case ref.count
            -- not useful: when 0 then com.Comm_A1
            when 1 then com.Comm_A2
            else com.Comm_A3
          end case
        when 'B' then
          case ref.count
            -- not useful: when 0 then com.Comm_B1
            when 1 then com.Comm_B2
            else com.Comm_B3
          end case
      end case 
  ) as total_commission
from
  ( select
      date_format(date, '%Y-%m') as month,
      referrer,
      type,
      count(*) as count
    from referrals
    group by month, referrer, type
  ) as ref,
join commissions com on com.referrer = ref.referrer 
```

（我猜想上面选择的名称，例如“ref”和“count”不太好。）

# c# - 如何序列化到现有文件？

> ID：803600
> 
> 赞同：11
> 
> 时间：2009-04-29T18:19:19.333
> 
> 标签：c#, .net, serialization

假设我有一个文件，其中包含 BinaryFomatter 的序列化对象。现在我希望能够序列化另一个对象并将其附加到该现有文件上。

我该怎么做？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-08-05T11:34:53.883

这确实是可能的。下面的代码附加了对象。

```
using (var fileStream = new FileStream("C:\file.dat", FileMode.Append))
{
    var bFormatter = new BinaryFormatter();
    bFormatter.Serialize(fileStream, objectToSerialize);
} 
```

以下代码对对象进行反序列化。

```
var list = new List<ObjectToSerialize>();    

using (var fileStream = new FileStream("C:\file.dat", FileMode.Open))
{
    var bFormatter = new BinaryFormatter();
    while (fileStream.Position != fileStream.Length)
    {
         list.Add((ObjectToSerialize)bFormatter.Deserialize(fileStream));
    }
} 
```

请注意，要使其正常工作，文件必须仅包含相同的对象。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-29T18:28:00.230

将您的对象放入一个集合对象中并像这样进行序列化。如果您设法在现有文件的末尾附加一个对象的二进制表示，您将在读取它时遇到问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-29T18:30:31.740

实际上，如果您只是打开流进行写入，并将指针定位在流的末尾，您可以序列化另一个对象并将其附加到现有流中。

反序列化也将读取对象，但不会进一步。

显然，如果您想随机访问您的对象（反序列化对象 nr. 17，但不是之前的所有内容），那么您需要每个对象开始位置的索引，但如果您只想从头开始读取所有对象，你可以把它们一个接一个地序列化出来。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-29T18:26:08.253

这个怎么样

将第一个文件的内容反序列化为内存中的对象，将第一个对象添加到集合（例如 List `<YourObjectType`>），将新对象添加到该集合，然后在现有文件的顶部序列化集合（现在包含两个对象） .

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-29T18:33:33.353

首先，如果您真正需要的是存储对象数组 - 将它们放入容器中并序列化容器，如前所述。

现在，如果您真的想将两个序列化对象存储在一个文件中：

我不确定这是否可能“开箱即用”，但您可以做两件事。

1.  使用或发明您自己的半 tar 文件格式，您将在文件的开头（或结尾）写一个小标题，描述文件的内容（#'objects 和 size）。

2.  编写 C# 代码，自己检测每个序列化对象的开头和结尾。我不完全确定这是可能的。[这](http://primates.ximian.com/~lluis/dist/binary_serialization_format.htm)是序列化格式的非官方文档。它包含标题，但不能保证此标题不会出现在文件中。

# emacs - xmonad 和 Emacs：'mod' 键的问题

> ID：803606
> 
> 赞同：15
> 
> 时间：2009-04-29T18:21:38.577
> 
> 标签：emacs, xmonad

几周前我开始使用 xmonad 作为我的窗口管理器。我喜欢它。这很棒。但是从那以后，当我在 emacs 中并想按“ALT”键时，我不得不经常使用“ESC”键。这是因为 xmonad 使用 'ALT' 键作为 'mod' 键。

有没有办法将emacs mod键分配给“ALT”键以外的任何东西，例如将它分配给“windows”键。

任何帮助将不胜感激。

谢谢， 维马尔

PS 这是我正在使用的键盘 [http://tinyurl.com/c4955o](http://tinyurl.com/c4955o)

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-29T18:28:31.510

实际上，将 Xmonad 的 mod 键指定为“Windows”（超级）键会容易得多。这就是我所做的！

就是这样：

[Xmonad 常见问题](http://haskell.org/haskellwiki/Xmonad/Frequently_asked_questions#Rebinding_the_mod_key_.28Alt_conflicts_with_other_apps.3B_I_want_the_____key.21.29)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-09-01T20:47:29.653

以 Alt 修饰符开头的绑定经常与应用程序冲突，所以我对 XMonad 配置所做的第一个修改总是将修饰符更改为 Super (Windows) 键。

```
modMask = mod4Mask 
```

我喜欢这样的想法，即与窗口管理相关的所有内容都分配给仅用于此目的的修饰符，这使得它在概念上是孤立的并且更容易记住。

更多详细信息可以在配置 XMonad的精彩[教程中找到。](http://haskell.org/haskellwiki/Xmonad/Config_archive/John_Goerzen's_Configuration)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-10-18T16:58:07.970

您可以将 xmonad 配置为使用 Emacsey 键序列，而不是默认的 Mod-X 或 Mod-Shift-X。详情在[这里](http://versia.com/2009/10/18/xmonad-metacity-gnome/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T20:18:41.017

emacs 命令通常显示 M-/ 表示按住 Meta 键，然后按正斜杠。您需要使用[xkeycaps](http://www.jwz.org/xkeycaps/)来确定键盘上的哪个键被分配了 META 修饰符，这就是您要用于 META 键和弦的键。

此外，xkeycaps 允许您将 META 修饰符分配给您喜欢的任何键，因此如果您不喜欢它的设置方式，您可以修复它。

您可能想彻底阅读 xkeycaps 手册页，或者在此处发布更多问题，如果您将 META 设置为某些地方，GNOME 将无法正确获取 META 密钥，但我已经忘记了我到底遇到了什么问题。

# xml - .net XmlDocument.load() 的根元素丢失错误

> ID：803608
> 
> 赞同：0
> 
> 时间：2009-04-29T18:21:41.980
> 
> 标签：xml, xmldocument, xmltextreader

大家好。

当我将 REST 请求的结果加载到 XmlDocument 中时，出现 asp.net 错误“缺少根元素”。当我使用 Firefox 插件“RESTTEST”执行相同的 REST 请求时，它看起来很好并返回有效结果。但是错误出现在 C#.net 代码隐藏中。有谁知道这可能是什么原因？以下是相关代码：

```
HttpWebResponse response = null;
response = (HttpWebResponse)request.GetResponse();
HttpStatusCode statusCode = response.StatusCode;
Stream responseData = response.GetResponseStream();
StreamReader sr = new StreamReader(responseData);
XmlTextReader reader = new XmlTextReader(sr);
XmlDocument doc = new XmlDocument();
doc.Load(sr); // here is where the error occurs. 
```

我的目标是将 REST 请求的结果加载到可遍历的 XML 数据模型中，然后我可以从中获取元素及其值。

当我使用这段代码时，我得到了预期的结果。有什么不同？

```
while (reader.Read())
{
  switch (reader.NodeType)
  {
    case XmlNodeType.Element: // The node is an Element.
      Response.Write("Element Name: " + reader.Name);
      while (reader.MoveToNextAttribute()) // Read attributes.
      Response.Write(" " + reader.Name + "='" + reader.Value + "'");
      Response.Write("<br />");
      break;
    case XmlNodeType.Text: //Display the text in each element.
      Response.Write("Element value: " + reader.Value);
      Response.Write("Read key=" + reader.Name + ", value=" + reader.Value + "<br/>");
      break;
    case XmlNodeType.EndElement: //Display end of element.
      Response.Write("<br />");
      break;
    }
  } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-06T18:16:33.023

看起来 XML 是一个片段，而不是一个完整的 XML 文档——这就是它没有根的原因。要使其工作，您必须配置 XMLDocument 对象以接受片段...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T18:26:14.510

尝试使用`sr.ReadToEnd()`以查看返回给您的内容。它可能是一个空字符串。

`XmlReader.Create`此外，如果您使用的是 .NET 2.0 或更高版本，则应该使用；`XmlTextReader`已弃用。

有关使用 XML 序列化的示例，请参阅[A REST Client Library for .NET，第 1 部分。](http://johnwsaundersiii.spaces.live.com/blog/cns!600A2BE4A82EA0A6!657.entry)（对不起，没有第 2 部分）。

# opengl - OpenGL：ShadowMapping：阴影仅在 y=0 时可见

> ID：803609
> 
> 赞同：3
> 
> 时间：2009-04-29T18:22:26.860
> 
> 标签：opengl

我已经使用 FBO 和 GLSL 实现了阴影映射。它用于高度场。那是一些物体（树木，植物，......）在高度场上投射阴影。

我遇到的问题是阴影仅在高度场的地面上可见。也就是说，高度场的高度 = 0。一旦涉及到一些高度，阴影就会消失。如果我查看阴影贴图本身，一切看起来都很好......靠近光线的物体更暗。

这是我的 GLSL 顶点着色器：

```
uniform mat4 lightView, lightProjection;

const mat4 biasMatrix = mat4(   0.5, 0.0, 0.0, 0.0,
                            0.0, 0.5, 0.0, 0.0,
                            0.0, 0.0, 0.5, 0.0,
                            0.5, 0.5, 0.5, 1.0);        //bias from [-1, 1] to [0, 1]

void main()
{   
gl_Position = ftransform(); 

mat4 shadowMatrix = biasMatrix * lightProjection * lightView;
shadowTexCoord = shadowMatrix * gl_Vertex;    
} 
```

碎片着色器：

```
uniform sampler2DShadow shadowmap;
varying vec4 shadowTexCoord;

void main() 
{    
vec4 shadow = shadow2DProj(shadowmap, shadowTexCoord, 0.0);
float colorshadow = shadow.r < 0.1 ? 0.5 : 1.0;

vec4 color = vec4(1,1,1,1); 

gl_FragColor = vec4( color*colorshadow, color.w ); 
```

}

非常感谢您对此的任何帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T00:53:09.223

我认为这里的不同空间之间可能存在一些混淆。如所写，看起来您的代码仅`gl_ModelViewMatrix`在地面仅包含相机转换时才有效。这是因为`ftransform`基本上去

```
gl_Position = gl_ProjectionMatrix * (gl_ModelViewMatrix * gl_Vertex) 
```

这意味着`gl_Vertex`是在对象坐标中指定的。然而通常情况下，光照的视图矩阵从世界坐标映射到光照的视图空间，因此此代码仅在对象空间 = 世界空间时才有效。所以基本上，假设你缩放地形，那么对象空间不再等于世界空间。因此，您需要将其`gl_ModelViewMatrix`分成两部分：相机视图矩阵和建模变换（例如对象 -> 世界空间）

我还没有测试过这段代码，但我会尝试这样的事情：

```
uniform mat4 lightView, lightProjection;
uniform mat4 camView, camProj, modelTrans;
const mat4 biasMatrix = mat4(   0.5, 0.0, 0.0, 0.0,
                                                        0.0, 0.5, 0.0, 0.0,
                                                        0.0, 0.0, 0.5, 0.0,
                                                        0.5, 0.5, 0.5, 1.0);        //bias from [-1, 1] to [0, 1]

void main()
{
mat4 modelViewProjMatrix =  camProj * camView * modelTrans;  
gl_Position =  modelViewProjMatrix * gl_Vertex;   

mat4 shadowMatrix = biasMatrix * lightProjection * lightView * modelTrans;
shadowTexCoord = shadowMatrix * gl_Vertex;    
} 
```

从技术上讲，在 CPU 上乘以矩阵并只传递您需要的确切矩阵会更快，但是为了让东西正常工作，有时这样做更容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T18:04:43.520

也许您只是错过了复制粘贴，但我认为 shadowTexCoord 在顶点着色器中没有变化。不过，这应该会导致编译错误。

# python - FCKEditor 的图片上传和浏览器如何配合 mod-wsgi 使用？

> ID：803613
> 
> 赞同：1
> 
> 时间：2009-04-29T18:23:30.493
> 
> 标签：python, django, fckeditor, mod-wsgi

我在 Apache/mod-wsgi 提供的 Django 应用程序中使用 FCKEditor。我不想只为 FCKEditor 安装 php，而且我看到 FCKEditor 通过 Python 提供图像上传和图像浏览。我只是没有找到关于如何设置这一切的好的说明。

因此，目前 Django 正在使用以下设置通过 wsgi 界面运行：

```
import os, sys

DIRNAME = os.sep.join(os.path.abspath(__file__).split(os.sep)[:-3])
sys.path.append(DIRNAME)
os.environ['DJANGO_SETTINGS_MODULE'] = 'myapp.settings'
import django.core.handlers.wsgi
application = django.core.handlers.wsgi.WSGIHandler() 
```

在 editor->filemanager->connectors->py 目录下的 fckeditor 中有一个名为 wsgi.py 的文件：

```
from connector import FCKeditorConnector
from upload import FCKeditorQuickUpload

import cgitb
from cStringIO import StringIO

# Running from WSGI capable server (recomended)
def App(environ, start_response):
    "WSGI entry point. Run the connector"
    if environ['SCRIPT_NAME'].endswith("connector.py"):
        conn = FCKeditorConnector(environ)
    elif environ['SCRIPT_NAME'].endswith("upload.py"):
        conn = FCKeditorQuickUpload(environ)
    else:
        start_response ("200 Ok", [('Content-Type','text/html')])
        yield "Unknown page requested: "
        yield environ['SCRIPT_NAME']
        return
    try:
        # run the connector
        data = conn.doResponse()
        # Start WSGI response:
        start_response ("200 Ok", conn.headers)
        # Send response text
        yield data
    except:
        start_response("500 Internal Server Error",[("Content-type","text/html")])
        file = StringIO()
        cgitb.Hook(file = file).handle()
    yield file.getvalue() 
```

我需要通过修改我的 django wsgi 文件以正确地为 fckeditor 部分提供服务，或者使 apache 在单个域上同时为 django 和 fckeditor 提供正确的服务，我需要这两件事一起工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-04T16:48:09.260

这描述了如何嵌入 FCK 编辑器并启用图像上传。

首先，您需要编辑 fckconfig.js 以将图像上传 URL 更改为指向服务器内的某个 URL。

```
FCKConfig.ImageUploadURL = "/myapp/root/imageUploader"; 
```

这将指向服务器相对 URL 以接收上传。FCK 将使用使用 multipart/form-data 编码的 CGI 变量名称“NewFile”将上传的文件发送到该处理程序。不幸的是，您将不得不实现 /myapp/root/imageUploader，因为我认为 FCK 分发的东西不能轻易地适应其他框架。

imageUploader 应该提取 NewFile 并将其存储在服务器上的某个位置。/myapp/root/imageUploader 生成的响应应该模拟 /editor/.../fckoutput.py 中构造的 HTML。像这样的东西（气味模板格式）

```
{{env
    whiff.content_type: "text/html",
    whiff.headers: [
        ["Expires","Mon, 26 Jul 1997 05:00:00 GMT"],
        ["Cache-Control","no-store, no-cache, must-revalidate"],
        ["Cache-Control","post-check=0, pre-check=0"],
        ["Pragma","no-cache"]
        ]
/}}

<script>
//alert("!! RESPONSE RECIEVED");
errorNumber = 0;
fileUrl = "fileurl.png";
fileName = "filename.png";
customMsg = "";
window.parent.OnUploadCompleted(errorNumber, fileUrl, fileName, customMsg);
</script> 
```

顶部的 {{env ...}} 表示内容类型和建议发送的 HTTP 标头。fileUrl 应该是用于在服务器上查找图像的 Url。

以下是获取生成 FCK 编辑器小部件的 html 片段的基本步骤。唯一棘手的部分是您必须将正确的客户端标识放入 os.environ - 这很丑陋，但这是 FCK 库现在的工作方式（我提交了错误报告）。

```
import fckeditor # you must have the fck editor python support installed to use this module
import os

inputName = "myInputName" # the name to use for the input element in the form
basePath = "/server/relative/path/to/fck/installation/" # the location of FCK static files
if basePath[-1:]!="/":
        basePath+="/" # basepath must end in slash
oFCKeditor = fckeditor.FCKeditor(inputName)
oFCKeditor.BasePath = basePath
oFCKeditor.Height = 300 # the height in pixels of the editor
oFCKeditor.Value = "<h1>initial html to be editted</h1>"
os.environ["HTTP_USER_AGENT"] = "Mozilla/5.0 (Macintosh; U;..." # or whatever
# there must be some way to figure out the user agent in Django right?
htmlOut = oFCKeditor.Create()
# insert htmlOut into your page where you want the editor to appear
return htmlOut 
```

以上未经测试，但它基于以下经过测试。

以下是使用 mod-wsgi 使用 FCK 编辑器的方法： 从技术上讲，它使用了 WHIFF 的几个功能（请参阅 [WHIFF.sourceforge.net](http://whiff.sourceforge.net)）——实际上它是 WHIFF 发行版的一部分——但 WHIFF 功能很容易被删除。

我不知道如何在 Django 中安装它，但如果 Django 允许轻松安装 wsgi 应用程序，你应该可以做到。

注意：FCK 允许客户端向 HTML 页面注入几乎任何东西——您需要过滤返回值以防止恶意攻击。（例如：有关如何执行此操作的示例，请参见 whiff.middleware.TestSafeHTML 中间件）。

```

"""
引入 FCK 编辑器输入元素。（需要 FCKeditor http://www.fckeditor.net/）。

注意：这个实现可以生成包含代码注入攻击的值，如果你
  不要过滤为邪恶标签和值生成的输出。
"""

import fckeditor # 你必须安装 fck 编辑器 python 支持才能使用这个模块
从 whiff.middleware 导入杂项
导入操作系统

FCKInput 类（misc.utility）：
    def __init__(self,
                 inputName, # 输入元素的名称
                 basePath, # 用于 FCK HTTP 安装的服务器相对 URL 根
                 value = ""): # 输入的初始值
        self.inputName = 输入名称
        self.basePath = basePath
        自我价值=价值
    def __call__(self, env, start_response):
        inputName = self.param_value(self.inputName, env).strip()
        basePath = self.param_value(self.basePath, env).strip()
        如果 basePath[-1:]!="/":
            基本路径+="/"
        value = self.param_value(self.value, env)
        oFCKeditor = fckeditor.FCKeditor(inputName)
        oFCKeditor.BasePath = basePath
        oFCKeditor.Height = 300 # 这应该是必需的！
        oFCKeditor.Value = 值
        # 破解 fck python 库中的一个错误：需要将用户代理放入 os.environ
        # XXX 这个 hack 对于多线程服务器是不安全的（理论上）...需要锁定 os.env
        os_environ = os.environ
        new_os_env = os_environ.copy()
        new_os_env.update(env)
        尝试：
            os.environ = new_os_env
            htmlOut = oFCKeditor.Create()
        最后：
            # 恢复旧的 os.environ
            os.environ = os_environ
        start_response("200 OK", [('Content-Type', 'text/html')])
        返回 [htmlOut]

__middleware__ = FCKInput

定义测试（）：
    环境 = {
        “HTTP_USER_AGENT”：
        “Mozilla/5.0（Macintosh；U；Intel Mac OS X；en-US；rv:1.8.1.14）Gecko/20080404 Firefox/2.0.0.14”
        }
    f = FCKInput("INPUTNAME", "/MY/BASE/PATH", "开始的*HTML*值")
    r = f(env, misc.ignore)
    打印“测试结果”
    打印“”。加入（列表（r））

如果 __name__=="__main__":
    测试（）

```

例如，在 [http://aaron.oirt.rutgers.edu/myapp/docs/W1500.whyIsWhiffCool](http://aaron.oirt.rutgers.edu/myapp/docs/W1500.whyIsWhiffCool)看到这个工作。[](http://aaron.oirt.rutgers.edu/myapp/docs/W1500.whyIsWhiffCool)

顺便说一句：谢谢。无论如何，我需要调查一下。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-04T17:18:57.950

编辑：最终我对这个解决方案也不满意，所以我制作了一个[Django 应用程序](http://bitbucket.org/megaman821/django-fckconnector/)来处理文件上传和浏览。

这是我在阅读 fckeditor 代码后最终破解的解决方案：

```
import os, sys

def fck_handler(environ, start_response):
    path = environ['PATH_INFO']
    if path.endswith(('upload.py', 'connector.py')):
        sys.path.append('/#correct_path_to#/fckeditor/editor/filemanager/connectors/py/')
        if path.endswith('upload.py'):
            from upload import FCKeditorQuickUpload
            conn = FCKeditorQuickUpload(environ)
        else:
            from connector import FCKeditorConnector
            conn = FCKeditorConnector(environ)
        try:
            data = conn.doResponse()
            start_response('200 Ok', conn.headers)
            return data
        except:
            start_response("500 Internal Server Error",[("Content-type","text/html")])
            return "There was an error"
    else:
        sys.path.append('/path_to_your_django_site/')
        os.environ['DJANGO_SETTINGS_MODULE'] = 'your_django_site.settings'
        import django.core.handlers.wsgi
        handler = django.core.handlers.wsgi.WSGIHandler()
        return handler(environ, start_response)

application = fck_handler 
```

# python - 将带参数的函数传递给Python中的另一个函数？

> ID：803616
> 
> 赞同：249
> 
> 时间：2009-04-29T18:24:26.263
> 
> 标签：python, function

是否可以将带参数的函数传递给 Python 中的另一个函数？

说类似的东西：

```
def perform(function):
    return function() 
```

但是要传递的函数将具有如下参数：

```
action1()
action2(p)
action3(p,r) 
```

* * *

## 回答 #1

> 赞同：337
> 
> 时间：2009-04-29T18:28:24.350

你是这个意思吗？

```
def perform(fun, *args):
    fun(*args)

def action1(args):
    # something

def action2(args):
    # something

perform(action1)
perform(action2, p)
perform(action3, p, r) 
```

* * *

## 回答 #2

> 赞同：165
> 
> 时间：2009-04-29T18:27:44.040

这就是 lambda 的用途：

```
def perform(f):
    f()

perform(lambda: action1())
perform(lambda: action2(p))
perform(lambda: action3(p, r)) 
```

* * *

## 回答 #3

> 赞同：49
> 
> 时间：2009-04-29T21:23:23.023

您可以像这样使用 functools 中的部分函数。

```
from functools import partial

def perform(f):
    f()

perform(Action1)
perform(partial(Action2, p))
perform(partial(Action3, p, r)) 
```

也适用于关键字

```
perform(partial(Action4, param1=p)) 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-04-29T18:36:14.987

使用 functools.partial，而不是 lambdas！而ofc Perform是个没用的函数，可以直接传函数。

```
for func in [Action1, partial(Action2, p), partial(Action3, p, r)]:
  func() 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2018-09-19T04:28:17.073

这称为部分函数，​​至少有 3 种方法可以做到这一点。我最喜欢的方法是使用 lambda，因为它避免了对额外包的依赖并且最不冗长。假设您有一个函数`add(x, y)`，并且您想将`add(3, y)`其他函数作为参数传递给其他函数，以便其他函数决定`y`.

**使用 lambda**

```
# generic function takes op and its argument
def runOp(op, val):
    return op(val)

# declare full function
def add(x, y):
    return x+y

# run example
def main():
    f = lambda y: add(3, y)
    result = runOp(f, 1) # is 4 
```

**创建自己的包装器**

在这里，您需要创建一个返回偏函数的函数。这显然要冗长得多。

```
# generic function takes op and its argument
def runOp(op, val):
    return op(val)

# declare full function
def add(x, y):
    return x+y

# declare partial function
def addPartial(x):
    def _wrapper(y):
        return add(x, y)
    return _wrapper

# run example
def main():
    f = addPartial(3)
    result = runOp(f, 1) # is 4 
```

**使用来自 functools 的部分**

这几乎与`lambda`上面显示的相同。那我们为什么需要这个？有[几个原因](https://stackoverflow.com/questions/3252228/python-why-is-functools-partial-necessary/)。简而言之，`partial`在某些情况下可能会更快一些（参见它的[实现](https://docs.python.org/3/library/functools.html#functools.partial)），并且您可以将它用于早期绑定与 lambda 的后期绑定。

```
from functools import partial

# generic function takes op and its argument
def runOp(op, val):
    return op(val)

# declare full function
def add(x, y):
    return x+y

# run example
def main():
    f = partial(add, 3)
    result = runOp(f, 1) # is 4 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-06-27T15:12:20.223

（几个月后）一个很小的真实示例，其中 lambda 有用，部分没有：
假设您想要通过二维函数获得各种 1 维横截面，例如穿过一排山丘的切片。
`quadf( x, f )`接受一维`f`并将其称为各种`x`.
将其称为 y = -1 0 1 处的垂直切割和 x = -1 0 1 处的水平切割，

```
fx1 = quadf( x, lambda x: f( x, 1 ))
fx0 = quadf( x, lambda x: f( x, 0 ))
fx_1 = quadf( x, lambda x: f( x, -1 ))
fxy = parabola( y, fx_1, fx0, fx1 )

f_1y = quadf( y, lambda y: f( -1, y ))
f0y = quadf( y, lambda y: f( 0, y ))
f1y = quadf( y, lambda y: f( 1, y ))
fyx = parabola( x, f_1y, f0y, f1y ) 
```

据我所知，`partial`不能这样做——

```
quadf( y, partial( f, x=1 ))
TypeError: f() got multiple values for keyword argument 'x' 
```

（如何在其中添加标签 numpy、partial、lambda ？）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-06-11T18:02:35.553

这是一种使用闭包的方法：

```
 def generate_add_mult_func(func):
        def function_generator(x):
            return reduce(func,range(1,x))
        return function_generator

    def add(x,y):
        return x+y

    def mult(x,y):
        return x*y

    adding=generate_add_mult_func(add)
    multiplying=generate_add_mult_func(mult)

    print adding(10)
    print multiplying(10) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-04-15T13:59:00.187

我想这就是你要找的...

```
def action1(action):
    print(f'doing {action} here!')

def perform(function):
    return function()

perform(lambda : action1('business action')) 
```

`lambda`将 func 和 args 封装在闭包中并传递给`perform()`

感谢大卫比斯利。

# sql - 无法从存储过程 (PL/SQL) 中的 dba_tab_cols 中进行选择

> ID：803618
> 
> 赞同：6
> 
> 时间：2009-04-29T18:25:05.950
> 
> 标签：sql, oracle, stored-procedures, oracle9i, ora-00942

我正在尝试从存储过程中的 dba_tab_cols 视图中选择。它不工作，我不知道为什么。

如果我执行以下 SQL 作为查询：

```
SELECT t.data_type FROM dba_tab_cols t
WHERE 
    t.table_name = 'ACCOUNTTYPE' AND 
    t.column_name = 'ACCESSEDBY'; 
```

它工作正常。但是，如果我将它复制到这样的存储过程中：

```
SELECT t.data_type INTO dataType FROM dba_tab_cols t
WHERE
    t.table_name = 'ACCOUNTTYPE' AND 
    t.column_name = 'ACCESSEDBY'; 
```

我收到错误消息“PL/SQL：ORA-00942：表或视图不存在”，并且编辑器在尝试编译时突出显示 dba_tab_cols。在这两种情况下都使用相同的数据库用户。

dataType 声明为：dataType varchar2(128);

PL/SQL (甲骨文 9)

有人知道这个问题吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-29T18:34:59.887

这很可能是特权问题。是通过角色访问权限`dba_tab_columns` 还是直接选择授予您的用户？通过角色授予的权限在 SPROCS 中不可用。

快速浏览一下谷歌建议使用`all_tab_cols`并查看该表是否具有您需要的所需信息。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-29T18:44:36.743

要添加到 Eoin 的答案：

> 对于大多数人来说，如果没有直接授予用户选择权限（而不是通过角色），用户无法从过程中选择表，这让大多数人感到惊讶
> 
> 如果表用户试图编译这个过程，他会得到一个 ORA-00942，尽管这个表确实存在并且他被授予选择这个表的权利。问题是程序不尊重角色；只有直接授予的权利才会受到尊重。因此，这意味着表所有者必须重新授予选择权：

[http://www.adp-gmbh.ch/ora/err/ora_00942.html](http://www.adp-gmbh.ch/ora/err/ora_00942.html)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-29T18:30:10.100

我没有安装 oracle，但也许 dataType 是保留字。我会尝试别的。

# c++ - 如何在 CodeWarrior 调试器中检查 STL 列表？

> ID：803623
> 
> 赞同：1
> 
> 时间：2009-04-29T18:26:15.290
> 
> 标签：c++, debugging, stl, codewarrior

有没有什么简单的方法可以`std::list<T>`在 Metrowerks CodeWarrior 调试器中查看 STL 中的数据？我可以通过查看表达式来查看列表开头或结尾附近的数据，例如

```
instances->__list_imp.__list_deleter.end_.compressed_pair_imp.second_.prev_->data_ 
```

我可以展开结构成员旁边的小“+”号来一次遍历列表一个元素，但这很乏味，并且在大约 20-30 个元素之后，树对于调试器窗口来说太宽了。我正在检查的列表有 2000 多个元素。

CodeWarrior 调试器不支持在表达式中调用函数，所以我无法检查`(++(++instances.begin()))`或类似的值。我只能查看结构成员，它们的名称非常长且不方便。

调试器窗口也被限制为大约 245 个字符，因此我无法编写脚本来生成一个可笑的长表达式，该表达式将扩展到第 N 个节点。

我正在尝试调试一个需要数小时浸泡才能重现的问题，因此任何需要增量添加代码、重新编译和重新调试的问题都不会很有帮助。但是，如果没有其他选择，那么我可能不得不这样做。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T19:32:51.527

这绝对不是一个“简单的方法”（它可能并不比你用“+”做的更容易），但我确实发现在某些情况下它比处理监视视图更有帮助。它还可能允许您在非常糟糕的情况下进行调试（无论出于何种原因，监视视图几乎无法正常工作，或者您只有一个二进制内存转储文件）。

使用 std::list，您通常会在内存中拥有类似这样的实现（如有必要，请参阅 <list> 了解详情）：

```
结构列表
{
  节点 * 下一个；
  节点 * 上一个；
  size_t 大小；
}

模板
结构节点
{
  节点 * 下一个；// 最后一个节点将指向列表而不是另一个节点
  节点 * 上一个；// 第一个节点将指向列表而不是另一个节点
  有效载荷；// 例如在 std::list 中，这将是一个 Foo * 有效载荷
}

```

请注意，在您的实现中，next 和 prev 的顺序可能相反。

&myList 在大多数实现中基本上等同于“end()”。

如果你使用内存视图，你可以在 &myList 附近闲逛。这将让您找到 myList.prev 或 myList.next 指针的值，然后更改内存视图以查看它。然后，您已分别到达列表中的最后一个或第一个节点。

到达节点后，可以查看 prev、next 或 payload，然后转到 prev 或 next；起泡，冲洗，重复。如果你最终回到 &myList，你就知道你已经遍历了整个事情。

痛苦和无聊？可能。但是您确实对您的 stl 实现非常熟悉，在某些情况下您可以轻松“看到”可能的踩踏，并且当所有其他可能性都飞出窗外时，这是一项有用的技能。

（记下你去过的地方，很容易混淆。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-01T18:15:00.417

调试器当然可以对 STL 更加友好。我对 CodeWarrior 并不特别熟悉，但是您是否根本无法从调试窗口调用*任何函数？*还是更像我使用的其他调试器，如果程序已经终止（ABORT，segfault，...），您（1）不能调用函数，并且（2）不能调用涉及模板扩展的函数（可能需要向图像添加代码），但是（3）如果代码在断点处停止，可以调用静态链接函数吗？

在后一种情况下，对于您感兴趣的特定类型，您可能希望将一个或多个非模板函数添加到代码中，将 a 复制`list<T>`到 T 的 C 样式数组中。如果您可以从您的调试窗口，执行此操作，然后检查数组元素以找出列表中的内容。如果您无法从调试窗口调用该函数，您可能需要在代码中靠近错误点的地方对该函数进行一些调用，然后查看结果。如果可能，请保护这些调用，以便仅在设置了一些调试标志时才调用它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-02T01:49:10.123

事实证明，我遇到的问题是由于列表有几千个元素——它应该只有几十个元素，最多。

在这个特定的 STL 实现中，`prev`指针存储在每个节点的偏移量 0 处，因此我可以通过重复取消引用来跟踪反向链接。以下怪物向后看 20 个链接：

```
********************((Metrowerks::node_base**********************)instances->__list_imp.__list_deleter.end_.compressed_pair_imp.second_) 
```

跟随前向链接更难看，因为每次取消引用后必须偏移 4 个字节。

# authorization - OAuth 替代方案？

> ID：803625
> 
> 赞同：5
> 
> 时间：2009-04-29T18:27:03.510
> 
> 标签：authorization, oauth

我一直在研究 OAuth 以将我站点中的资源共享给其他站点。但是，前几天报告了OAuth规范的漏洞。 [http://oauth.net/advisories/2009-1](http://oauth.net/advisories/2009-1)

许多站点决定停止 OAuth，直到发布固定版本。

目前，我们可以有任何替代 OAuth 的方法吗？我想要一个开放标准且安全的授权协议。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T03:41:45.860

建立 OAuth 是因为没有任何现有的标准可以解决同样的问题。一个固定的 OAuth 规范即将推出。这将是对现有协议的一个很小的改变。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T03:56:40.210

在短期内，您最好的选择是依靠基本的身份验证机制（要求用户将他们的凭据输入到您的站点以获取外部站点）。

就像乔纳森说的，这个漏洞很快就会在规范中修复。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-07-18T12:04:56.640

`Oz`是`web authorization protocol`基于行业最佳实践的。`Oz`与`Hawk authentication protocol`_ `Iron encryption protocol`_ [OZ github链接](https://github.com/hueniverse/oz)

`Oz`建立在`OAuth protocol`. 虽然术语已更新以反映当今构建具有第三方访问权限的应用程序时使用的常用术语，但总体架构是相同的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-29T18:59:49.250

OAuth 1.0 规范有一个修订版，但是自从提出这个问题后，OAuth 2.0 版正在变得稳定，并且通常是推荐的协议。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-20T11:09:06.183

OAuth 版本 2.O 与其前身相比有点复杂，但更安全。它专为解决企业的安全问题而量身定制。目前[Facebook](https://developers.facebook.com/docs/reference/dialogs/oauth/)和[Google](https://developers.google.com/accounts/docs/OAuth2)身份验证流程基于 OAuth 2.0

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-01-04T09:59:34.863

Oauth 提出了新的 OAuth 2.0 标准，它比 OAuth 1.0 和 1.0a 安全得多。它对访问令牌和访问秘密进行了处理，并引入了访问令牌和刷新令牌。Oauth 2.0 中的访问令牌在一定的时间范围内得到验证，之后它使用刷新令牌重新生成或刷新。

# html - 没有父标签？

> ID：803630
> 
> 赞同：5
> 
> 时间：2009-04-29T18:28:11.260
> 
> 标签：html

可以使用`<li>`没有父标签的标签吗？

IE

```
<li> some copy 
```

或者必须是..

```
<ul> (substitute your favorite list type)
    <li> some copy
</ul> 
```

关于主题的链接：

*   [规格](http://www.w3.org/TR/html401/struct/lists.html#h-10.2)
*   [XHTML](http://www.w3schools.com/XHTML/xhtml_html.asp)
*   [验证器](http://validator.w3.org/)

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-29T18:30:10.977

如果 OK 你的意思是“正确，遵循标准并将验证”，那么**没有**。[根据规范](http://www.w3.org/TR/html401/struct/lists.html#h-10.2)，只有 OL 和 UL 可以包含 LI。（不推荐使用 MENU 和 DIR）

如果 OK 你的意思是“将渲染”，那么是的。

此外，要按照第一个定义“OK”，您还必须关闭您的 LI 标签。每个标签必须要么是自闭合的 ( `/>`) 要么有一个相应的闭合标签。[这是正确 XHTML 的快速简单的解释](http://www.w3schools.com/XHTML/xhtml_html.asp)（老实说，好的 HTML 也应该符合这些。没有理由不这样做。）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-29T18:30:40.413

正确的 HTML（更不用说严格的 XHTML）应该是：

```
<ul>
    <li>whatever</li>
</ul> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-29T18:30:39.930

不，使用`li`没有父元素`ul`或`ol`元素的元素是无效的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-29T18:31:35.230

不，那肯定是无效的 (X)HTML。我的意思是，你*可以*，如果幸运的话，浏览器*可能会*正确呈现它（尤其是 IE，因为它往往特别宽松），但远不能保证。`<li>`您应该始终使用`<ul>`(unordered list) 或`<ol>`(ordered list)括起来标签。你为什么不想呢？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-29T18:32:02.327

不，虽然它可能在某些浏览器中工作，但它是无效的 HTML。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-29T18:35:31.820

我在[W3C 的标记验证服务中](http://validator.w3.org/)检查了以下代码的验证：

```
<li>item 1</li>
<li>item 2</li> 
```

结果是：

> 文档类型在此处不允许元素“LI”；缺少“UL”、“OL”、“DIR”、“MENU”开始标签之一

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-29T18:32:01.360

li = 列表项，如果没有父母，列表在哪里？

[http://www.w3schools.com/TAGS/tag_li.asp](http://www.w3schools.com/TAGS/tag_li.asp)

[http://www.w3.org/TR/html401/struct/lists.html](http://www.w3.org/TR/html401/struct/lists.html)

# c# - linq to xml - 摆脱空白 xmlns

> ID：803636
> 
> 赞同：4
> 
> 时间：2009-04-29T18:30:18.290
> 
> 标签：c#, xml, linq

我试图摆脱我的 xml 文件中的空命名空间标签。我见过的所有解决方案都是基于从头开始创建 xml。我有从以前的 xml 构造的各种 xelements。我所做的只是

```
XElement InputNodes = XElement.Parse(InputXML);
m_Command = InputNodes.Element("Command"); 
```

并在各处添加 xmlns = ""。这真是令人气愤。谢谢你的帮助。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-29T18:39:48.830

MSDN 博客上有一篇[文章](http://blogs.msdn.com/wriju/archive/2008/03/26/linq-to-xml-adding-namespace-quickly.aspx)展示了如何轻松（合理地）解决这个问题。在输出 XML 之前，您需要执行以下代码：

```
foreach (XElement e in root.DescendantsAndSelf())
{
    if (e.Name.Namespace == string.Empty)
    {
        e.Name = ns + e.Name.LocalName;
    }
} 
```

正如海报所提到的，另一种方法是在添加时为每个元素名称添加名称空间，但这似乎是一个更好的解决方案，因为它更加自动化并且节省了一些输入。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T18:37:35.090

可能是这样的：[Empty namespace using Linq Xml](https://stackoverflow.com/questions/61084/empty-namespace-using-linq-xml)

这将表明您的文档与您添加的元素位于不同的默认命名空间中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-07-21T23:38:58.487

我认为这篇文章的第二个答案是：

[XElement Add 函数将 xmlns="" 添加到 XElement](https://stackoverflow.com/questions/2295523/xelement-add-function-adds-xmlns-to-the-xelement)

非常有用。基本上，如果你只是这样做

```
XNamespace rootNamespace = doc.Root.Name.NamespaceName;
XElement referenceElement = new XElement(rootNamespace + "Reference"); 
```

那应该解决它。所以我想你必须告诉它在创建元素时不要担心特殊的命名空间。奇怪的。

# jquery - 在没有 Rails 的内置助手的情况下使用 AJAX 的最佳实践？

> ID：803642
> 
> 赞同：3
> 
> 时间：2009-04-29T18:30:47.743
> 
> 标签：jquery, ruby-on-rails, ajax, unobtrusive-javascript

在我的博客应用程序中，一些帖子显示为摘录——即，用户看到前 500 个字符，并且可以单击链接来查看整个帖子。这是相关的部分：

```
<% href = url_for post_path(:id => post) %>

<h1 class="title"><%= post.title %></h1>
<h2 class="published_on"><%= post.author %> wrote this <%= time_ago_in_words(post.published_on)%> ago</h2>
<div class="body">
  <% if defined?(length) %>
    <%= truncate_html(post.body, :length => length, :omission => "&hellip;<h1><a class='more' href=\"#{href}\">Click here for more!</a></h1>") %>
  <% else %>
    <%= post.body %>
  <% end %>
</div> 
```

但是，而不是“单击此处了解更多！” 将用户带到一个单独的页面，我希望它可以内联填充帖子的其余部分。目前，我一直在通过将上面的代码片段放在以下 div 中来实现这一点：

```
<div class="post" id="post_<%= post.id %>">
  <%= render :partial => 'post_content', :locals => { :post => post, :length => 500 } %>
</div> 
```

然后我在 application.js 中使用这个 div 的 id 来执行 AJAX：

```
$(document).ready(function() {

  $("a.more").click(function() {
    var url = $(this).attr('href');
    var id = url.split("/")[2]
    $.get(url, null, function(data) {
      $("#post_" + id).html(data);     
    });
    return false;
  });

}); 
```

This is obviously disgusting -- I don't want my javascript to depend on the location of the post's id in the link's href, but I don't know any other way for the javascript to know which post it is getting and therefore into which div the content should be inserted.

**What's the best way to accomplish this? Should I just go back to using rails' AJAX helpers?**

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-02T16:50:03.297

Horace, you are correct. You don't need the Rails helpers at all. To achieve unobtrusive JavaScript Nirvana, you will do well to avoid them (sorry Marc!)

Unobstrusive JS means avoiding embedded JS where possible. Indeed, try to keep things loosely coupled, but not entirely decoupled. In the example you gave us, it is easy, because we have a URL from the HREF to work with. Your JS does not need to "know" anything about how to request.

Here is how to send through the link from the HREF's blindly, and get Rails to respond with an ajax response (i.e. no layout).

**SOLUTION:**

```
<!------- Your HTML ------>
<h1 class="title">Schwein Flu Strikes Again</h1>
<h2 class="published_on">B.Obama wrote this 2 seconds ago</h2>
<div class="body">
    SUMMARY SUMMARY
    <h1><a class='more' href="/post/1234">Click here for more!</a></h1>
</div>
```

```
/********* Your JavaScript ***********/
$(document).ready(function() {

$("a.more").click(function() {
    $containing_div = $(e).parents('div.body');
    var url = $(this).attr('href');
    $.ajax({
        beforeSend  : function(request) { request.setRequestHeader("Accept", "text/javascript"); },
                        /* Included so Rails responds via "format.js" */
        success     : function(response) { $(containing_div).empty.append(response); },
        type        : 'get',
        url         : url
    });
    return false;
  }); `});`
```

```
########### Your Controller ###########
def show
  @article = Post.find(param[:id])
  respond_to do |format|
    format.html { render :action => "show" and return  }
    format.js { render :partial => "post_content", :layout => false and return }
  end
end
```

This also assumes you have RESTful routes or similar to handle /post/:id

And we're done! I believe there is something in that for all of us. :D

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-06-18T06:54:22.173

In this case, I don't think you should have the AJAX call at all. You already have the original post's entire content in post.body (you didn't fetch just the 500 characters from the db) Instead of using JQuery to make an ajax call, use it to hide the content past 500 characters and then when the user clicks the 'more' link it shows the rest of the div. You can do this entirely on the client side and save yourself the ajax.

In your partial:

```
<div class="body">
  <%= post.body %>
</div> 
```

Your JQuery:

```
var fullText = $('div.body').html();
$('div.body').html(fullText.slice(0,499) + '<a class="more" href=\"#\">Click here for more!</a>');
$('a.more').live('click', function(event) {
  this.parent().html(fullText);
  return false;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T18:48:40.057

In my opinion for this kind of problems you should use rails' helpers.

HTML would go like :

```
My post bla bla bla <span id="more_of<%=post.id%>">more</span> 
```

The more link would be :

```
<%= link_to_remote( "more",:update => "more_of_#{your_post.id}",:url =>{:controller => "myposts", :action=>"show_more", :id => your_post.id}, %> 
```

And the controller would do something like :

```
post = Post.find_by_id(params[:id])
render :text => post.content.slice(100..post.content.size) 
```

The other way that could be just as good is to load everything and then hide it :

```
bla bla bla this is my post blah <div style="display:none" onclick="this.style.display='block';">and this is the rest of the article</div> 
```

(the onclick on a div tag might break in IE but this is to give you the idea)

To me that would be the best way to go unless you have a good reason of avoiding rails' helpers.

Hope that helps

# cocoa - Cocoa 开发：malloc:free_garbage:garbage ptr = 0x18a15e0, has non-zero refcount = 1 error

> ID：803643
> 
> 赞同：1
> 
> 时间：2009-04-29T18:31:07.090
> 
> 标签：cocoa, xcode, memory-leaks, garbage-collection

我正在开发一个 Cocoa 应用程序，在 Xcode 中运行我的应用程序时，我经常在调试控制台中收到以下类型的消息：

> `<`我的应用程序名称`>`(952,0xb0103000) malloc: free_garbage:garbage ptr = 0x107b2f0, has non-zero refcount = 1

我打开了 MallocStackLogging 和 NSZombieEnabled 并在其中几个地址上做了 malloc_history 并沿着底部引用的行获得了跟踪。

公共线程似乎是所有有错误的块中对 NSPopupButtonCell 的引用。

我的猜测是，它对某处被 CFRetained 但未释放或使垃圾可收集的东西起作用。

A）这更有可能是我的编程错误还是框架中尚未为 GC 正确更新的某些东西？

B) 引发此消息的问题的后果是什么（如果有的话）？即我需要注意这条消息还是可以忽略它？

> 调用 [2] [arg=48]：thread_a003d720 |start | 主要 | NSApplicationMain | -[NSApplication 运行] | -[NSApplication nextEventMatchingMask:untilDate:inMode:dequeue:] | _DPSNextEvent | BlockUntilNextEventMatchingListInMode | ReceiveNextEventCommon | RunCurrentEventLoopInMode | CFRunLoopRunInMode | CFRunLoopRun 特定 | __CFRunLoopDoObservers | _handleWindowNeedsDisplay | -[NSWindow displayIfNeeded] | -[NSView displayIfNeeded] | -[NSView _displayRectIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:] | -[NSThemeFrame _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:] | -[NSView _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:] | -[NSView _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView: ] | -[NSView _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:] | -[NSView _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:] | -[NSView _recursiveDisplayRectIfNeededIgnoringOpacity:isVisibleRect:rectIsVisibleRectForView:topView:] | -[NSView _recursiveDisplayAllDirtyWithLockFocus:visRect:] | -[NSView _drawRect:clip:] | -[NSControl drawRect:] | -[NSMenuItemCell drawWithFrame:inView:] | -[NSPopUpButtonCell _drawIndicatorWithFrame:inView:] | -[NSPopUpButtonCell _indicatorFrameForCellFrame:inView:] | -[NSPopUpButtonCell _indicatorFrameForCellFrame:isFlipped:] | -[NSPopUpButtonCell _defaultIndicatorImage] | -[NSPopUpButtonCell _coreUIDefaultIndicatorImage] | +[NSImage imageNamed:] | +[NSImage _coreUIImageWithName: ] | +[NSImage _coreUIImageWithBaseName:state:backgroundStyle:] | -[NSCoreUIImageRep imageWithoutEffectsRect] | SizeForImageOptions | CUI复制测量 | CUIRenderer::CopyMeasurements(CGRect, CGContext*, __CFDictionary const*, __CFArray const*) | CUIRenderer::CopyImageMeasurements(long, CUIContext const*, __CFArray const*, __CFDictionary*) | CreateImageSourceFromDisk(long, CUIContext const*, long*, unsigned char*) | CUISharedArtReader::CreateImageSource(long) | CGImageSourceCreateWithDataProvider | CGImageReadCreateWithProvider | CGImageReadCreateWithData | _CGImageReadCreate | _CFRuntimeCreateInstance | CFAllocatorAllocate | auto_zone_allocate_object 调用 [4] [arg=0]：thread_b0103000 |thread_start | _pthread_start | auto_collection_thread(void*) | auto_collect_with_mode(Auto::Zone*, 无符号整数) | auto_collect_internal(Auto::Zone*, int)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T00:56:02.840

它实际上位于 Xcode 使用的较低级别的框架中，任何使用 NSImage 的垃圾收集应用程序也会生成同样的（无害但烦人的）消息。

一种使这些静音的方法是：http: [//0xced.blogspot.com/2008/09/quietxcode.html](http://0xced.blogspot.com/2008/09/quietxcode.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T19:04:33.530

我一直在使用 Xcode 看到这一点。这是 Xcode 本身的内存管理问题，与您的程序完全无关。

如果错误与您的程序有关，它们将显示在调试窗口（按 shift-command-r 时显示的窗口）以及系统控制台中。

那些 Xcode malloc 消息只出现在系统控制台中，所以它们不是你的问题。

现在，本期 Apple 发布了将大量内存错误日志转储到系统控制台的 IDE？*这*可能是需要担心的事情:)

# cvs - 仅在工作目录中的 CVS 文件列表

> ID：803644
> 
> 赞同：1
> 
> 时间：2009-04-29T18:31:11.520
> 
> 标签：cvs

是否可以获得工作目录树中但不在当前分支/标签中的文件列表？我目前将工作副本与另一个更新到相同模块和标签/分支但没有本地非 repo 文件的目录进行比较。它有效，但不尊重 .cvsignore 文件。我认为*必须*有一个使用“cvs diff”变体的选项。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T18:51:24.527

如果您的项目有：

```
dir/a.txt       <--- In CVS
    b.txt       <--- In CVS
    c.txt       <--- In CVS
    newfile.txt <---- ***NOT IN CVS*** 
```

然后以下命令将为您识别 newfile.txt：

```
cvs -n update | egrep '^?' 
```

# javascript - 使 DIV 接受并通过 JavaScript 处理 drop 可能吗？

> ID：803645
> 
> 赞同：2
> 
> 时间：2009-04-29T18:31:18.663
> 
> 标签：javascript, drag-and-drop

我已经在谷歌上搜索并尝试了一段时间，但无济于事。所以这里是：

我想做的是将文本放在 DIV 标记上并使用 JavaScript 处理。这些方面的东西：

```
<script type="text/javascript">

function handleDrop(sender, args)
{
  $('#theDiv').html(args.textfromdrop);
}

</script>

<div id="theDiv" ondrop="handleDrop()" />

<br/>
<p>
This is some simple text. Draggable?
</p> 
```

所以，在这个页面上，我希望能够将段落中的内容例如拖到 div 中，它会处理拖放并相应地更改它的外观（或者可能只是显示该文本，只要它能够处理它！）。我一直在尝试使用 jQuery，但它似乎是一个完全不同的模型，我无法设置所有潜在的可拖动对象，因为它们应该能够来自任何地方。这甚至可能吗？

编辑：如果我错了，请纠正我，但是这些 droppables 都需要一个可拖动的，对吧？我想要的是您可以从您无法控制的页面中删除纯文本。这可能听起来很奇怪，但它适用于 Firefox 扩展，您可以在其中将内容从页面拖到位于侧栏中的另一个页面。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T23:02:45.237

或者，如果您像我一样喜欢原型：[http ://wiki.github.com/madrobby/scriptaculous/droppables](http://wiki.github.com/madrobby/scriptaculous/droppables)

编辑：根据您修改后的问题：不，没有办法允许用户将文本从一页拖放到另一页。除非你决定像你说的那样构建一个 FireFox 扩展。即使您可以找到解决安全问题的方法，即您无法为不在同一域下的页面编写脚本，您也只能将 DOM 元素拖放到它们所在的窗口/iFrame 中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T18:38:12.563

我建议使用已建立的 Javascript 库，例如 jQuery 或 YUI。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-03T21:02:19.093

您是否考虑过创建一个隐藏的文本区域（即具有 css 样式`visibility:hidden`）与相关 div 重叠？然后使用 onchange JavaScript 事件检查 drop，或者如果这不起作用，则定期检查 textarea 的非空字符串值。我猜你的里程会因浏览器和操作系统而异。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-24T19:32:01.367

我以前做过这个，它可以在没有任何库的情况下通过一些努力来完成。

我已经构建了以下方法：

1.  跟踪鼠标移动的方法。
2.  下降时读取和传递内容的方法。
3.  拖放方法使用 onmousemove 和 onclick 事件。
4.  OnMouseOver 用于您想要放置文本的 div 区域 - 检测指针是否在容器 (div) 上方。
5.  最后，在删除文本后，我使用 innerHTML 删除了原始内容（如果需要），因此看起来它已被移动。

您几乎可以使用此功能实现类似 Windows 的拖放功能。我用它来拖放图像、图标等。

如果您在编码方面需要帮助，我可以为您提供一些指导，但如果您在 Google 上搜索一下，您会发现其中的大部分内容，那么您需要做的就是让它们一起工作。

# mysql - MySQL 双主

> ID：803649
> 
> 赞同：9
> 
> 时间：2009-04-29T18:32:02.000
> 
> 标签：mysql, replication

对于我当前的项目，我们正在考虑为地理上分离的设置设置双主复制拓扑；一个分贝在美国东海岸，另一个分贝在日本。我很好奇是否有人尝试过这个以及有什么经验。

另外，我很好奇解决此问题的其他选择是什么；我们正在考虑消息队列。

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-29T18:59:30.017

只是关于您计划的技术方面的说明：您必须知道 MySQL[不正式支持](http://dev.mysql.com/doc/refman/5.0/en/replication.html)多主复制（只有 MySQL Cluster 提供对同步复制的支持）。

但是，即使使用正常的 MySQL 复制设置，至少有一个“hack”可以使多主复制成为可能。请参阅 Patrick Galbraith 的[“MySQL Multi-Master Replication”](http://capttofu.livejournal.com/1752.html)以获得可能的解决方案。我对这种设置没有任何经验，所以我不敢判断这种方法的可行性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T18:41:51.197

在地理上复制数据库时需要考虑几件事。如果您出于性能原因这样做，请确保您的复制模型支持您的数据“最终一致”，因为在两个或多个位置使复制成为最新可能需要时间。如果您的吞吐量或位置之间的响应时间不好，则主动复制可能不是最佳选择。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T19:33:25.807

将 mysql 设置为双主服务器在正确完成的情况下确实可以正常工作。但我不确定它是否非常适合您的场景。

首先，mysql中的dual master setup实际上是一个ring-setup。服务器 A 定义为 B 的主服务器，而 B 同时定义为 A 的主服务器，因此两个服务器都充当主服务器和从服务器。复制通过发送一个二进制日志来工作，该日志包含从属设备在认为合适时插入的 sql 语句，这通常是立即的。但是，如果您使用本地插入来锤击它，则需要一段时间才能赶上。顺便说一下，从属插入是顺序的，因此您不会从多核等中获得任何好处。

双主 mysql 的主要用途是通过自动故障转移在服务器级别具有冗余（通常在 linux 上使用 heartbeat）。不包括 mysql-cluster（出于各种原因），这是 mysql 唯一可用的自动故障转移。基本双主的设置很容易在[谷歌](http://www.google.com/search?q=mysql+dual+master)上找到。心跳的东西需要更多的工作。但这并不是您真正要问的，因为这确实表现为单个数据库服务器。

If you want the dual master setup because you always want to write to a local database (write to both of them at the same time), you'll need to write your application with this in mind. You can never have auto-incrementing values in the database, and when you have unique values, you must make sure that the two locations never write the same value. For example location A could write odd unique numbers and location B could write even unique numbers. The reason is that you're not guaranteed that the servers are in sync at any given time, so if you've inserted a unique row in A, and then an overlapping unique row in B before the second server catches up, you'll have a broken system. And if something first breaks, the entire system stops.

To sum it up: it's possible, but you'll need to tip-toe very carefully if you're building business software on top of this.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T23:15:13.863

由于 MySQL 复制的一对多架构，您必须有一个具有多个 master 的复制环：也就是说，每个 master 在一个循环中从下一个复制。对于两个，它们相互复制。早在 v3.23 就已支持此功能。

在我以前工作的地方，我们使用 v3.23 与相当多的客户一起做，作为提供您所要求的确切内容的一种方式。我们使用 Internet 上的 SSH 隧道进行复制。我们花了一些时间让它变得可靠，有几次我们不得不将一个数据库的二进制副本复制到另一个数据库（幸运的是，它们都没有超过 2Gb，也不需要 24 小时访问）。此外，v3 中的复制不如 v4 稳定，但即使在 v5 中，如果检测到任何类型的错误，它也会停止。

为了适应不可避免的复制滞后，我们重新构建了应用程序，使其不依赖于`AUTOINCREMENT`字段（并从表中删除了该属性）。由于我们开发了数据访问层，这相当简单；它不是`mysql_insert_id()`用于新对象，而是首先创建新 ID 并将其与行的其余部分一起插入。我们还实现了存储在 ID 上半部分的站点 ID，因为它们是`BIGINT`s. 这也意味着当我们的客户需要三个位置的数据库时，我们不必更改应用程序。:-)

它不是 100% 健壮的。InnoDB 刚刚获得了一些可见性，因此我们不能轻易使用事务，尽管我们考虑过。因此，当尝试使用相同 ID 创建两个对象时，偶尔会出现竞争条件。这意味着一个失败，我们试图在应用程序中报告。但是，监视复制并在它崩溃时修复它仍然是某人工作的重要组成部分。重要的是，在我们太不同步之前修复它，因为在少数情况下，*两个*站点都在使用数据库，如果我们不得不重建一个，很快就会变得难以重新集成。

这是一个很好的练习，但我不会再这样做了。不在 MySQL 中。

# bash - 特殊目录中某些类型文件的 bash 补全

> ID：803653
> 
> 赞同：12
> 
> 时间：2009-04-29T18:32:58.847
> 
> 标签：bash, autocomplete

我有一个存在于`~/.unison/*.prf`.

我想要 bash 完成，这样当我键入`unison`或`unison-gtk`点击选项卡时，它会列出该`.prf`文件夹中的文件而不包含该`.prf`部分。

也许一个例子会更清楚：

```
$ ls ~/.unison/*.prf
default.prf dot-mozilla.prf to-desktop.prf

$ cd  ~  # just to show you don't have to be in the ~/.unison folder
$ unison to<tab>
$ unison to-desktop 
```

我预见到另一个工具也需要这个，所以如果有可以重复使用的部件会很方便。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-29T18:46:26.897

如果您正在运行 debian/ubuntu 或其他可能的 GNU/Linux 发行版，那么 /etc/bash_completion.d/ 目录中应该有此类补全的示例。下面是一个示例，说明如何为 unison 设置完成脚本：

```
have unison &&
_unison_show()
{
        local cur

        COMPREPLY=()
        cur=${COMP_WORDS[COMP_CWORD]}
        COMPREPLY=($( compgen -W "$(for x in ~/.unison/*.prf; do echo $(basename ${x%.prf}); done)" -- $cur ) )
}
complete -F _unison_show unison 
```

# svn - Cron 使用动态 ip 记录存储库的 ip

> ID：803670
> 
> 赞同：0
> 
> 时间：2009-04-29T18:37:21.207
> 
> 标签：svn, shell, cron

我正在使用带有动态 ip 的 mac mini 来存储 SVN 存储库。由于 ip 的意外更改使得难以始终如一地使用存储库，我有兴趣创建一个 cron 以在每次更改时将 ip 记录在另一台服务器上。最好的方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T22:58:51.733

对于 Subversion 的使用，您的方法没有意义并且不起作用：每个工作副本都将其存储库 URL 存储在 .svn 文件夹中，因此如果您的 IP 更改，您必须通过重新定位您的工作副本

```
 `svn switch --relocate` 
```

所以它不会保护你的任何工作。你真的应该使用动态 DNS 服务

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T18:53:24.587

如果您想将 IP 地址推送到另一台服务器，请运行 ifconfig，解析结果，并将数据写入服务器上的文件（不知何故 - 挂载为 nfs 共享、ftp 等）。

如果要检测更改的 IP 地址，假设 DNS 名称保持不变，ping 服务器名称并解析 ping 结果。

通常，如果您有 DNS 名称常量，请使用它来访问存储库。如果您不这样做，请[尝试使用动态 dns 提供商提供的服务](http://www.dyndns.com/services/dns/dyndns/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T19:22:53.610

稍微偏离主题：

某些路由器内置了动态 DNS 支持。如果您的路由器正在获取新 IP，并且您希望通过它访问 Internet-> 局域网，则可以将其配置为使用动态 DNS 提供程序记录其配置。在这种情况下，您还应该将端口转发配置到正确的内部服务器，并确保该服务器的 IP 不会动态更改。为此，许多路由器能够将 DHCP 地址静态分配给 MAC 地址。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T19:29:59.647

我可以推荐 DNSAlias.com 来提供这样的服务。在我的 linux 机器上，一个名为“ddclient”的程序会定期检查它挂起的 IP 地址（一个 ADSL 帐户，通过 ping 外部网站）。如果更改，它将向 DnsAlias.com 发送新信息，并且 *.dnsalias.com（或备用名称）DNS 记录将在几分钟内更新。无论发生什么，它都会每 15 天更新一次，只是为了确定，但不会更频繁。

# c - 如何在 C 中创建单例？

> ID：803673
> 
> 赞同：26
> 
> 时间：2009-04-29T18:37:43.937
> 
> 标签：c, design-patterns, singleton

在 C 中创建单例的最佳方法是什么？并发解决方案会很好。

我知道 C 不是您用于单例的第一种语言。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-04-29T18:40:40.263

首先，C 不适合 OO 编程。如果你这样做，你会一直在战斗。其次，单例只是带有一些封装的静态变量。因此，您可以使用静态全局变量。然而，全局变量通常有太多与之相关的弊病。否则，您可以使用函数局部静态变量，如下所示：

```
 int *SingletonInt() {
     static int instance = 42;
     return &instance;
 } 
```

或更智能的宏：

```
#define SINGLETON(t, inst, init) t* Singleton_##t() { \
                 static t inst = init;               \
                 return &inst;                       \
                }

#include <stdio.h>  

/* actual definition */
SINGLETON(float, finst, 4.2);

int main() {
    printf("%f\n", *(Singleton_float()));
    return 0;
} 
```

最后，请记住，单身人士大多被滥用。很难让它们正确，尤其是在多线程环境下......

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-29T18:42:12.333

你不需要。C 已经有全局变量，所以你不需要变通方法来模拟它们。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-29T18:42:28.730

它与 C++ 版本几乎相同。只要有一个返回实例指针的函数。它可以是函数内部的静态变量。根据平台，用临界区或 pthread 互斥体包装函数体。

```
#include <stdlib.h>

struct A
{
    int a;
    int b;
};

struct A* getObject()
{
    static struct A *instance = NULL;

    // do lock here
    if(instance == NULL)
    {
        instance = malloc(sizeof(*instance));
        instance->a = 1;
        instance->b = 2;
    }
    // do unlock

    return instance;
}; 
```

请注意，您也需要一个函数来释放单例。特别是如果它抓取了进程退出时未自动释放的任何系统资源。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-29T18:42:07.000

编辑：我的回答假定您正在创建的单例有点复杂，并且有一个多步骤的创建过程。如果它只是静态数据，请像其他人建议的那样使用全局数据。

C 中的单例会很奇怪。. . 我从未见过看起来特别优雅的“面向对象C”示例。如果可能，请考虑使用 C++。C++ 允许您选择要使用的功能，许多人只是将其用作“更好的 C”。

下面是一种非常典型的无锁一次性初始化模式。如果前一个值为空，则 InterlockCompareExchangePtr 自动换入新值。这可以保护如果多个线程同时尝试创建单例，只有一个会获胜。其他人将删除他们新创建的对象。

```
MyObj* g_singleton; // MyObj is some struct.

MyObj* GetMyObj()
{
    MyObj* singleton;
    if (g_singleton == NULL)
    {
        singleton = CreateNewObj();

        // Only swap if the existing value is null.  If not on Windows,
        // use whatever compare and swap your platform provides.
        if (InterlockCompareExchangePtr(&g_singleton, singleton, NULL) != NULL)
        {
              DeleteObj(singleton);
        }
    }

    return g_singleton;
}

DoSomethingWithSingleton(GetMyObj()); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-03-29T15:08:07.823

这是另一个观点：C 程序中的每个文件实际上都是一个单例类，它在运行时自动实例化并且不能被子类化。

*   全局静态变量是您的私有类成员。
*   全局非静态是公共的（只需`extern`在某些头文件中声明它们）。
*   静态函数是私有方法
*   非静态函数是公共函数。

给所有东西一个适当的前缀，现在你可以用`my_singleton_method()`它来代替`my_singleton.method()`.

如果你的单例很复杂，你可以在使用前编写一个`generate_singleton()`方法来初始化它，但是你需要确保所有其他公共方法检查它是否被调用，如果没有则出错。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-06-12T09:05:29.943

我认为这个解决方案对于大多数用例来说可能是最简单和最好的......

在这个例子中，我正在创建一个单实例全局调度队列，如果你正在跟踪来自多个对象的调度源事件，你肯定会这样做；在这种情况下，当新任务添加到队列中时，可以通知每个监听队列事件的对象。一旦设置了全局队列（通过`queue_ref()`），就可以`queue`在包含头文件的任何文件中使用变量来引用它（示例如下）。

在我的一个实现中，我调用`queue_ref()`了 AppDelegate.m（main.c 也可以）。这样，`queue`将在任何其他调用对象尝试访问它之前进行初始化。在剩余的对象中，我简单地调用了`queue`. 从变量返回值比调用函数，然后在返回之前检查变量的值要快得多。

在 GlobalQueue.h 中：

```
#ifndef GlobalQueue_h
#define GlobalQueue_h

#include <stdio.h>
#include <dispatch/dispatch.h>

extern dispatch_queue_t queue;

extern dispatch_queue_t queue_ref(void);

#endif /* GlobalQueue_h */ 
```

在 GlobalQueue.c 中：

```
#include "GlobalQueue.h"

dispatch_queue_t queue;

dispatch_queue_t queue_ref(void) {
    if (!queue) {
        queue = dispatch_queue_create_with_target("GlobalDispatchQueue", DISPATCH_QUEUE_SERIAL, dispatch_get_main_queue());
    }

    return queue;
} 
```

要使用：

1.  `#include "GlobalQueue.h"`在任何 Objective-C 或 C 实现源文件中。
2.  调用`queue_ref()`以使用调度队列。一旦`queue_ref()`被调用，队列可以通过`queue`所有源文件中的变量使用

例子：

调用 queue_ref()：

```
dispatch_queue_t serial_queue_with_queue_target = dispatch_queue_create_with_target("serial_queue_with_queue_target", DISPATCH_QUEUE_SERIAL, **queue_ref()**); 
```

呼叫队列：

```
dispatch_queue_t serial_queue_with_queue_target = dispatch_queue_create_with_target("serial_queue_with_queue_target", DISPATCH_QUEUE_SERIAL, **queue**));] 
```

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2012-04-30T07:16:02.330

做就是了

```
void * getSingleTon() {
    static Class object = (Class *)malloc( sizeof( Class ) );
    return &object;
} 
```

它也适用于并发环境。

# ios - 为 XML/HTML 编码 NSString

> ID：803676
> 
> 赞同：27
> 
> 时间：2009-04-29T18:38:09.647
> 
> 标签：ios, objective-c, encoding

有没有办法在 Objective-C 中对字符串 (NSString) 进行 HTML 编码，类似于 .NET 中的 Server.HtmlEncode？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-04-29T19:06:51.107

没有一个 NSString 方法可以做到这一点。您必须编写自己的函数来进行字符串替换。进行以下替换就足够了：

*   '&' => "&"
*   '"' => """
*   '\'' => "'"
*   '>' => ">"
*   '<' => "<"

这样的事情应该做（没有尝试过）：

```
[[[[[myStr stringByReplacingOccurrencesOfString: @"&" withString: @"&amp;"]
 stringByReplacingOccurrencesOfString: @"\"" withString: @"&quot;"]
 stringByReplacingOccurrencesOfString: @"'" withString: @"&#39;"]
 stringByReplacingOccurrencesOfString: @">" withString: @"&gt;"]
 stringByReplacingOccurrencesOfString: @"<" withString: @"&lt;"]; 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2010-05-27T01:49:39.050

我把 Mike 的工作变成了 NSMutableString 和 NSString 的类别

**为 NSMutableString 创建一个类别：**

```
- (NSMutableString *)xmlSimpleUnescape
{
    [self replaceOccurrencesOfString:@"&amp;"  withString:@"&"  options:NSLiteralSearch range:NSMakeRange(0, [self length])];
    [self replaceOccurrencesOfString:@"&quot;" withString:@"\"" options:NSLiteralSearch range:NSMakeRange(0, [self length])];
    [self replaceOccurrencesOfString:@"&#x27;" withString:@"'"  options:NSLiteralSearch range:NSMakeRange(0, [self length])];
    [self replaceOccurrencesOfString:@"&#39;"  withString:@"'"  options:NSLiteralSearch range:NSMakeRange(0, [self length])];
    [self replaceOccurrencesOfString:@"&#x92;" withString:@"'"  options:NSLiteralSearch range:NSMakeRange(0, [self length])];
    [self replaceOccurrencesOfString:@"&#x96;" withString:@"-"  options:NSLiteralSearch range:NSMakeRange(0, [self length])];
    [self replaceOccurrencesOfString:@"&gt;"   withString:@">"  options:NSLiteralSearch range:NSMakeRange(0, [self length])];
    [self replaceOccurrencesOfString:@"&lt;"   withString:@"<"  options:NSLiteralSearch range:NSMakeRange(0, [self length])];

    return self;
}

- (NSMutableString *)xmlSimpleEscape
{
    [self replaceOccurrencesOfString:@"&"  withString:@"&amp;"  options:NSLiteralSearch range:NSMakeRange(0, [self length])];
    [self replaceOccurrencesOfString:@"\"" withString:@"&quot;" options:NSLiteralSearch range:NSMakeRange(0, [self length])];
    [self replaceOccurrencesOfString:@"'"  withString:@"&#x27;" options:NSLiteralSearch range:NSMakeRange(0, [self length])];
    [self replaceOccurrencesOfString:@">"  withString:@"&gt;"   options:NSLiteralSearch range:NSMakeRange(0, [self length])];
    [self replaceOccurrencesOfString:@"<"  withString:@"&lt;"   options:NSLiteralSearch range:NSMakeRange(0, [self length])];

    return self;
} 
```

**为 NSString 创建一个类别：**

```
- (NSString *)xmlSimpleUnescapeString
{
    NSMutableString *unescapeStr = [NSMutableString stringWithString:self];

    return [unescapeStr xmlSimpleUnescape];
}

- (NSString *)xmlSimpleEscapeString
{
    NSMutableString *escapeStr = [NSMutableString stringWithString:self];

    return [escapeStr xmlSimpleEscape];
} 
```

*** 一个 Swift 2.0 版本 ***

Objective-C 版本的效率更高一些，因为它对字符串执行可变操作。但是，这是进行简单转义的快速方法：

```
extension String
{
    typealias SimpleToFromRepalceList = [(fromSubString:String,toSubString:String)]

    // See http://stackoverflow.com/questions/24200888/any-way-to-replace-characters-on-swift-string
    //
    func simpleReplace( mapList:SimpleToFromRepalceList ) -> String
    {
        var string = self

        for (fromStr, toStr) in mapList {
            let separatedList = string.componentsSeparatedByString(fromStr)
            if separatedList.count > 1 {
                string = separatedList.joinWithSeparator(toStr)
            }
        }

        return string
    }

    func xmlSimpleUnescape() -> String
    {
        let mapList : SimpleToFromRepalceList = [
            ("&amp;",  "&"),
            ("&quot;", "\""),
            ("&#x27;", "'"),
            ("&#39;",  "'"),
            ("&#x92;", "'"),
            ("&#x96;", "-"),
            ("&gt;",   ">"),
            ("&lt;",   "<")]

        return self.simpleReplace(mapList)
    }

    func xmlSimpleEscape() -> String
    {
        let mapList : SimpleToFromRepalceList = [
            ("&",  "&amp;"),
            ("\"", "&quot;"),
            ("'",  "&#x27;"),
            (">",  "&gt;"),
            ("<",  "&lt;")]

        return self.simpleReplace(mapList)
    }
} 
```

我本可以使用 NSString 桥接功能来编写与 NSString 版本非常相似的东西，但我决定做得更迅速。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-04-29T19:34:24.940

我使用[Google Toolbox for Mac](https://github.com/google/google-toolbox-for-mac)（适用于 iPhone）。特别是，请参阅[GTMNSString+HTML.h](https://github.com/google/google-toolbox-for-mac/blob/master/Foundation/GTMNSString%2BHTML.h)和[GTMNSString+XML.h](https://github.com/google/google-toolbox-for-mac/blob/master/Foundation/GTMNSString%2BXML.h)中对 NSString 的补充。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-04-29T19:10:36.277

**对于 URL 编码**：

```
NSString * encodedString = [originalString
      stringByAddingPercentEscapesUsingEncoding:NSASCIIStringEncoding]; 
```

有关详细信息，请参阅[Apple 的 NSString 文档](https://developer.apple.com/documentation/foundation/nsstring/1415058-stringbyaddingpercentescapesusin)。

**对于 HTML 编码**：

查看[CFXMLCreateStringByEscapingEntities](https://developer.apple.com/documentation/corefoundation/1542736-cfxmlcreatestringbyescapingentit)，它是 Core Foundation XML 库的一部分，但仍然可以解决问题。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-12-19T15:46:04.470

samets 的例程忘记了十六进制数字。这是我想出的可行的例程：

```
- (NSString*)convertEntities:(NSString*)string
{

NSString    *returnStr = nil;

    if( string )
    {
        returnStr = [ string stringByReplacingOccurrencesOfString:@"&amp;" withString: @"&"  ];

        returnStr = [ returnStr stringByReplacingOccurrencesOfString:@"&quot;" withString:@"\""  ];

        returnStr = [ returnStr stringByReplacingOccurrencesOfString:@"&#x27;" withString:@"'"  ];

        returnStr = [ returnStr stringByReplacingOccurrencesOfString:@"&#x39;" withString:@"'"  ];

        returnStr = [ returnStr stringByReplacingOccurrencesOfString:@"&#x92;" withString:@"'"  ];

        returnStr = [ returnStr stringByReplacingOccurrencesOfString:@"&#x96;" withString:@"'"  ];

        returnStr = [ returnStr stringByReplacingOccurrencesOfString:@"&gt;" withString:@">"  ];

        returnStr = [ returnStr stringByReplacingOccurrencesOfString:@"&lt;" withString:@"<"  ];

        returnStr = [ [ NSString alloc ] initWithString:returnStr ];
    }

    return returnStr;
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-10-29T08:51:19.423

如果你可以使用 NSXMLNode（在 OS X 上）这是诀窍：

```
NSString *string = @"test<me>"
NSXMLNode *textNode = [NSXMLNode textWithStringValue:string];
NSString *escapedString = [textNode.XMLString]; 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2018-10-02T21:21:29.297

**斯威夫特 4**

```
extension String {
    var xmlEscaped: String {
        return replacingOccurrences(of: "&", with: "&amp;")
            .replacingOccurrences(of: "\"", with: "&quot;")
            .replacingOccurrences(of: "'", with: "&#39;")
            .replacingOccurrences(of: ">", with: "&gt;")
            .replacingOccurrences(of: "<", with: "&lt;")
    }
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-08-18T23:50:12.080

这是此 xml 转义逻辑的更有效实现。

```
+ (NSString*) xmlSimpleEscape:(NSString*)unescapedStr
{
  if (unescapedStr == nil || [unescapedStr length] == 0) {
    return unescapedStr;
  }

  const int len = [unescapedStr length];
  int longer = ((int) (len * 0.10));
  if (longer < 5) {
    longer = 5;
  }
  longer = len + longer;
  NSMutableString *mStr = [NSMutableString stringWithCapacity:longer];

  NSRange subrange;
  subrange.location = 0;
  subrange.length = 0;

  for (int i = 0; i < len; i++) {
    char c = [unescapedStr characterAtIndex:i];
    NSString *replaceWithStr = nil;

    if (c == '\"')
    {
      replaceWithStr = @"&quot;";
    }
    else if (c == '\'')
    {
      replaceWithStr = @"&#x27;";
    }
    else if (c == '<')
    {
      replaceWithStr = @"&lt;";
    }
    else if (c == '>')
    {
      replaceWithStr = @"&gt;";
    }
    else if (c == '&')
    {
      replaceWithStr = @"&amp;";
    }

    if (replaceWithStr == nil) {
      // The current character is not an XML escape character, increase subrange length

      subrange.length += 1;
    } else {
      // The current character will be replaced, but append any pending substring first

      if (subrange.length > 0) {
        NSString *substring = [unescapedStr substringWithRange:subrange];
        [mStr appendString:substring];
      }

      [mStr appendString:replaceWithStr];

      subrange.location = i + 1;
      subrange.length = 0;
    }
  }

  // Got to end of unescapedStr so append any pending substring, in the
  // case of no escape characters this will append the whole string.

  if (subrange.length > 0) {
    if (subrange.location == 0) {
      [mStr appendString:unescapedStr];      
    } else {
      NSString *substring = [unescapedStr substringWithRange:subrange];
      [mStr appendString:substring];
    }
  }

  return [NSString stringWithString:mStr];
}

+ (NSString*) formatSimpleNode:(NSString*)tagname value:(NSString*)value
{
  NSAssert(tagname != nil, @"tagname is nil");
  NSAssert([tagname length] > 0, @"tagname is the empty string");

  if (value == nil || [value length] == 0) {
    // Certain XML parsers don't like empty nodes like "<foo/>", use "<foo />" instead
    return [NSString stringWithFormat:@"<%@ />", tagname];
  } else {
    NSString *escapedValue = [self xmlSimpleEscape:value];
    return [NSString stringWithFormat:@"<%@>%@</%@>", tagname, escapedValue, tagname];    
  }
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-02-17T22:02:51.967

[我在这里](https://github.com/mgrider/NSString-XMLEncoding)使用 Mike 和 Tod 的答案整理了一个快速示例项目。

使编码/解编码变得简单：

```
NSString *html = @"<p>This \"paragraph\" contains quoted & 'single' quoted stuff.</p>";
NSLog(@"Original String: %@", html);

NSString *escapedHTML = [html xmlSimpleEscapeString];
NSLog(@"Escaped String: %@", escapedHTML);

NSString *unescapedHTML = [escapedHTML xmlSimpleUnescapeString];
NSLog(@"Unescaped String: %@", unescapedHTML); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-06-15T11:31:37.947

这是我用于 html 编码/解码的 swift 类别：

```
extension String
{
    static let htmlEscapedDictionary = [
        "&amp;": "&",
        "&quot;" : "\"",
        "&#x27;" : "'",
        "&#x39;" : "'",
        "&#x92;" : "'",
        "&#x96;" : "'",
        "&gt;" : ">",
        "&lt;" : "<"]

    var escapedHtmlString : String {
        var newString = "\(self)"

        for (key, value) in String.htmlEscapedDictionary {
            newString.replace(value, withString: key)
        }
        return newString
    }

    var unescapedHtmlString : String {
        let encodedData = self.dataUsingEncoding(NSUTF8StringEncoding)!
        let attributedOptions : [String: AnyObject] = [
            NSDocumentTypeDocumentAttribute: NSHTMLTextDocumentType,
            NSCharacterEncodingDocumentAttribute: NSUTF8StringEncoding
        ]
        let attributedString = NSAttributedString(data: encodedData, options: attributedOptions, documentAttributes: nil, error: nil)!
        return attributedString.string
    }

    mutating func replace(originalString:String, withString newString:String)
    {
        let replacedString = self.stringByReplacingOccurrencesOfString(originalString, withString: newString, options: nil, range: nil)
        self = replacedString
    }
} 
```

我猜想在 unescapedHtmlString 中也可以使用 htmlEscapedDictionary 的反向

**注意：**正如 MarkBau 在下面的评论中指出的那样：由于 Swift 不保证字典的顺序，所以一定`&`要先替换。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-02-11T16:20:52.473

这个最简单的解决方案是创建一个类别，如下所示：

这是该类别的头文件：

```
#import <Foundation/Foundation.h>
@interface NSString (URLEncoding)
-(NSString *)urlEncodeUsingEncoding:(NSStringEncoding)encoding;
@end 
```

这是实现：

```
#import "NSString+URLEncoding.h"
@implementation NSString (URLEncoding)
-(NSString *)urlEncodeUsingEncoding:(NSStringEncoding)encoding {
    return (NSString *)CFURLCreateStringByAddingPercentEscapes(NULL,
               (CFStringRef)self,
               NULL,
               (CFStringRef)@"!*'\"();:@&=+$,/?%#[]% ",
               CFStringConvertNSStringEncodingToEncoding(encoding));
}
@end 
```

现在我们可以简单地做到这一点：

```
NSString *raw = @"hell & brimstone + earthly/delight";
NSString *url = [NSString stringWithFormat:@"http://example.com/example?param=%@",
            [raw urlEncodeUsingEncoding:NSUTF8StringEncoding]];
NSLog(url); 
```

此答案的学分转到以下网站：-

```
http://madebymany.com/blog/url-encoding-an-nsstring-on-ios 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-09-09T11:01:45.180

参考以下答案：

```
NSString *content = global.strPrivacyPolicy;
content =  [[[[[content stringByReplacingOccurrencesOfString: @"&amp;" withString: @"&"]
stringByReplacingOccurrencesOfString:@"&quot;"  withString:@"\" "]
stringByReplacingOccurrencesOfString: @"&#39;"  withString:@"'"]
stringByReplacingOccurrencesOfString: @"&gt;" withString: @">"]
stringByReplacingOccurrencesOfString:  @"&lt;" withString:@"<"];
[_webViewPrivacy loadHTMLString:content baseURL:nil]; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-07-19T12:17:32.927

使用以下示例中的消息：

```
anyStringConverted = [anyString stringByReplacingOccurrencesOfString:@"\n" withString:@"<br>"]; 
```

这会将“换行”命令转换为相应的 html 代码。但是要转换符号，你必须写对应的html数字。您可以在此处查看完整的 html 编号列表

[http://www.ascii.cl/htmlcodes.htm](http://www.ascii.cl/htmlcodes.htm)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-08-28T20:11:42.243

我找到了仅使用内置函数（而不是手动解析）并涵盖所有情况的唯一方法。除了 Foundation 之外，还需要 AppKit/UIKit。这是 Swift 但很容易成为 Objective-C：

```
func encodedForHTML() -> String {

    // make a plain attributed string and then use its HTML write functionality
    let attrStr = NSAttributedString(string: self)

    // by default, the document outputs a whole HTML element
    // warning: if default apple implementation changes, this may need to be tweaked
    let options: [NSAttributedString.DocumentAttributeKey: Any] = [
            .documentType: NSAttributedString.DocumentType.html,
            .excludedElements: [
                "html",
                "head",
                "meta",
                "title",
                "style",
                "p",
                "body",
                "font",
                "span"
            ]
    ]

    // generate data and turn into string
    let data = try! attrStr.data(from: NSRange(location: 0, length: attrStr.length), documentAttributes: options)
    let str = String(data: data, encoding: .utf8)!

    // remove <?xml line
    return str.components(separatedBy: .newlines).dropFirst().first!
} 
```

# iphone - 如何为 iTunes 商店构建一个 xcode 项目？

> ID：803683
> 
> 赞同：14
> 
> 时间：2009-04-29T18:38:56.477
> 
> 标签：iphone, xcode, binary, itunes, executable

我的应用程序可以在我的 iphone 上运行，很好，但是要在 iTunes 商店中列出我需要“通用二进制”的东西。

我试过寻找答案，但我似乎找不到在 xcode 中执行此操作的简明可用解释。当我尝试构建二进制文件时，我总是会出错。谁能指出我可以遵循的基本分步过程来创建可以上传到 iTunes 商店的通用可执行二进制文件？

还有一件事，是否有某种类型的应用程序，例如重命名项目应用程序或 applescript 的东西，只需点击几下就可以为我做到这一点？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-09-28T21:02:03.170

尝试这个：

**为 App Store 准备新的配置文件**

1.  确保您的 Ad Hoc 分发工作正常。
2.  进入程序门户 > 供应 > 分发
3.  新建个人资料按钮
4.  分发方式：App Store
5.  个人资料名称：MyApp App Store（或其他）
6.  App ID：MyApp（你已经创建了一个吧？）
7.  提交按钮

**在 XCode 中设置新的配置文件/配置**

8.  下载证书（您可以单击分发选项卡以在生成该选项卡时重新加载该选项卡）并将其加载到 XCode
9.  在 XCode 中，打开您的项目并转到 Project > Edit Project Settings（或双击 Groups & Files 面板下的第一项）
10.  配置选项卡，单击您现有的 Ad Hoc 分发配置，该配置已经有效，然后单击复制按钮。将新的称为“App Store”
11.  单击 Build 选项卡，然后在弹出窗口中的 Code Signing > Code Signing Entity 下选择“MyApp App Store”下的“iPhone Distribution - MyCompanyName”

**构建并上传到 iTunes Connect**

12.  清理一切以求好运，然后将 Active Configuration 设置为“App Store”，构建并运行。在你的 iPhone 上测试它。
13.  在 Finder 中找到您构建的应用程序，在您的项目目录 > build > App Store-iphoneos > MyApp.app ... 右键单击​​并“压缩 MyApp.app”
14.  将生成的 MyApp.zip 上传到 iTunes Connect。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-29T19:01:44.783

通用二进制与它无关。要通过 App Store 分发，您需要创建分发配置文件。iPhone 开发人员门户对此有分步说明。在“分发”选项卡下查看。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-20T07:25:58.890

我按照*sbwoodside*列出的说明进行操作，但最后一部分（构建并上传到 iTunes Connect）有问题。我意识到构建的版本没有在设备上运行。这对我有用：

**构建并上传到 iTunes Connect**

*   清洁一切以求好运。
*   转到“编辑方案”并在存档菜单中，选择 App Store 构建配置。
*   在下拉菜单中选择 iOS 设备或特定设备，然后转到产品->存档。
*   一旦 Xcode 完成归档，它将打开管理器窗口并显示归档部分。选择最后一个存档并单击“提交”。
*   您将被要求输入您的分发证书。选择为 App Store 创建的那个。
*   XCode 无需使用 Application Loader 即可将应用程序上传到 iTunes Connect。为此，该应用程序必须在 iTunes Connect 中处于“准备上传”状态。

您将无法使用该设备测试最新版本。因此，最好在能够测试所有功能之前制作一个临时版本，一旦一切正常，复制应用商店的临时配置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-03T14:43:26.650

下载并安装配置文件后，您需要在 XCode 中进行一些更改，以使该应用程序在您的 iPhone 上运行并最终提交到 iTunes 商店。您还需要将 Entitlemests.plist 对象添加到您的项目中。您还需要调整构建配置文件和 info.plist 以指向您的应用程序名称。

但正如 Mark B 已经说过的，刚刚通过开发者门户并按照这些说明进行操作。只需确保您为此目的定义了正确的配置文件。

# jquery - 如何使用 jQuery 使多个 DIV 保持相同的高度？

> ID：803688
> 
> 赞同：5
> 
> 时间：2009-04-29T18:39:40.250
> 
> 标签：jquery, html, css, layout

我有几个不同数量的文本内容的 DIV 标签。

HTML：

```
<div id="boxes">
    <div id="boxone">
        <p>...</p>
    </div>
    <div id="boxtwo">
        <p>...</p>
    </div>
    <div id="boxthree">
        <p>...</p>
    </div>
    <div id="boxfour">
        <p>...</p>
    </div>
</div> 
```

它们采用 2×2 的布局，并且它们的宽度是可变的：

CSS：

```
div#boxes {
    width: 100%;
}

div#boxes div {
    width: 49.9%;
    float: left;
} 
```

我希望它们都一样高。

所以，我遍历它们并找到最高的高度。然后我再次循环并将它们全部设置为该高度。

jQuery：

```
$(function() {
    var maxHeight = 0;
    $('div#boxes div').each(function(){
        if (maxHeight < $(this).height()) {maxHeight = $(this).height()}
    });
    $('div#boxes div').each(function(){
        $(this).height(maxHeight);
    });
}); 
```

如果 div 的高度不需要再次更改，这很有效。

但是，如果我调整浏览器窗口的大小，它会失败：

1.  如果我 (a) 使浏览器更宽，那么 (b) 我的 DIV 变得更宽，然后 (c) 他们的文本内容换行次数更少，然后 (d) 我的 DIV 太高了。

2.  如果我 (b) 使浏览器更窄，那么 (b) 我的 DIV 变得更窄，然后 (c) 他们的文本内容换行更多，然后 (d) 我的 DIV 太短。

我如何（1）像正常一样自动将 DIV 调整到其内容的高度，但又如何（2）使多个 DIV 保持相同的高度？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-07-11T12:45:54.737

对于像我一样通过在 Google 上搜索解决方案来这里的其他人：接受答案的第一部分仅在第一个 div 最高时才有效。我对其进行了一些更改，现在它似乎适用于所有情况。

```
var highest = 0;
function sortNumber(a,b)    {
    return a - b;
}

function maxHeight() {
    var heights = new Array();
    $('#wrapper2>div').each(function(){
        $(this).css('height', 'auto');
        heights.push($(this).height());
        heights = heights.sort(sortNumber).reverse();
    });        
        highest = heights[0]; 
    $('#wrapper2>div').each(function(){
        $(this).css('height', highest);
    });

}

$(document).ready(function() {
    maxHeight();
})

$(window).resize(maxHeight); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-29T20:19:52.770

**更新**...在尝试并找到另一种显然可行的方法后完全重写此答案：

```
function sortNumber(a,b)    {
    return a - b;
}

function maxHeight() {
    var heights = new Array();
    $('div#boxes div').each(function(){
        $(this).css('height', 'auto');
        heights.push($(this).height());
        heights = heights.sort(sortNumber).reverse();
        $(this).css('height', heights[0]);
    });        
}

$(document).ready(function() {
    maxHeight();
})

$(window).resize(maxHeight); 
```

我注意到的一件事是 IE 确实存在 50% 宽浮动 div 的舍入问题……如果我将其更改为 49%，渲染效果会好得多。

这个 jQuery 工作...

```
// global variables

doAdjust = true;
previousWidth = 0;

// raise doAdjust flag every time the window width changes

$(window).resize(function() {
    var currentWidth = $(window).width();
    if (previousWidth != currentWidth) {
        doAdjust = true;
    }
    previousWidth = currentWidth;
})

// every half second

$(function() {
    setInterval('maybeAdjust()', 500);
});

// check the doAdjust flag

function maybeAdjust() {
    if (doAdjust) {
        adjustBoxHeights();
        doAdjust = false;
    }
}

// loop through the DIVs and find the height of the tallest one
// then loop again and set them all to that height

function adjustBoxHeights() {
    var maxHeight = 0;
    $('div#boxes div').each(function(){
        $(this).height('auto');
        if (maxHeight < $(this).height()) {maxHeight = $(this).height()}
    });
    $('div#boxes div').each(function(){
        $(this).height(maxHeight);
    });
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T19:46:20.653

查看这个[jQuery 插件](http://www.west-wind.com/weblog/posts/478985.aspx)，它允许您监控 CSS 属性，例如高度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-14T11:41:58.987

如果你希望它在调整大小等时工作......这样做：

```
function sortNumber(a,b) {
    return a - b;
}

var highest = 0;

function maxHeight() {
    var heights = new Array();
    $('.equalheight div').css('height', 'auto');
    $('.equalheight div').each(function(){
        heights.push($(this).height());
    });        
    heights = heights.sort(sortNumber).reverse();
    highest = heights[0]; 
    $('.equalheight div').css('height', highest);
}

$(document).ready(maxHeight);
$(window).resize(maxHeight); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-02-23T06:39:33.217

我发现这个解决方案更适合我的情况。无论哪个 div 最高，它都有效。基于这篇旧的 Chris Coyier[在 CSS Tricks 上的帖子](https://css-tricks.com/snippets/jquery/equalize-heights-of-divs/)。

```
function maxHeight() {
    var maxHeight = 0;
    $(".container > .post-box").each(function(){
       if ($(this).height() > maxHeight) { maxHeight = $(this).height(); }
    });
    $(".container > .post-box").height(maxHeight);
}

$(document).ready(function() {
    maxHeight();
}

$(window).bind('resize', function () {
    $(".container > .post-box").css('height', 'auto');
    maxHeight();
}).trigger('resize'); 
```

但是，在再次运行该功能之前，我确实需要将高度设置为自动调整大小。我不需要在原始函数中设置它，因为它是在 css 中设置的。

# bug-tracking - 如何像 JIRA 一样使用 Trac

> ID：803691
> 
> 赞同：1
> 
> 时间：2009-04-29T18:40:54.757
> 
> 标签：bug-tracking

在过去的 15 个月里，我一直在使用 JIRA，现在我发现自己在一个使用 Trac 的项目中。如何仅通过 Trac 中的票号查找票？我习惯于在 JIRA 的右上角输入票值，然后它会找到一张票。我在 Trac 中尝试过同样的事情，但没有那么幸运。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T18:45:26.540

你不能把它放在网址上吗？

或者，搜索车票 - 在车票号码前加上 # 即可。其他[选项也可用](http://trac.edgewall.org/wiki/TracSearch)：

> 为了快速访问各种项目资源，可以使用每个页面顶部的快速搜索字段输入一个 wiki 链接，这将直接将您带到该链接所标识的资源。
> 
> 例如：
> 
> ```
> * [42] -- Opens change set 42
> * #42 -- Opens ticket number 42
> * {1} -- Opens report 1
> * /trunk -- Opens the browser for the trunk directory 
> ```

例如。[http://trac.edgewall.org/ticket/8199](http://trac.edgewall.org/ticket/8199)

# apache-flex - Flex：有没有办法将 ComboBox 的 selectedItem 绑定到变量？

> ID：803692
> 
> 赞同：7
> 
> 时间：2009-04-29T18:41:04.380
> 
> 标签：apache-flex

好的，我有一个 ComboBox，dataProvider 是一个具有标签属性的对象数组，这些属性为 ComboBox 提供选项列表。

有没有办法我可以拥有一个像 mySelectedItem 这样的变量，并将 ComboBox 的 selectedItem 绑定到它，这样如果它发生变化，ComboBox 的 selectedItem 就会改变它的样子？

我希望这是有道理的。

谢谢！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-29T19:05:03.933

是的，ComboBox 的 selectedItem 属性是可绑定的。

它会是这样的：

```
<mx:ComboBox selectedItem="{mySelectedItem}">
</mx:ComboBox> 
```

在您的 AS 中：

```
[Bindable]
var mySelectedItem:Object; 
```

对 mySelectedItem 的更改应显示在 ComboBox 中。如果 mySelectedItem 引用的项目在 ComboBox 的 dataProvider 中不存在，您可能会收到错误消息。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-29T19:12:28.050

从表面上看，它很简单：

```
<mx:ComboBox id="myComboBox"
   dataProvider="{myDataProvider}"
   selectedItem="{defaultItem}"/> 
```

当您将 defaultItem（确保它是 [Bindable]）设置为数据提供者中的一项时，它将更新控件。

但是这种方法存在问题。除非 currentDefaultItem 总是在 myDataProvider 之后更改，否则绑定到 dataProvider 可能会撤消选择，恢复为默认值（列表中的第一项）。

解决此问题的一种方法是通过在提供 selectedItem 的调用中包含 dataProvider 来强制在 dataProvider 之后重新绑定 selectedItem。

```
<mx:ComboBox id="myComboBox"
   dataProvider="{myDataProvider}"
   selectedItem="{getSelectedItem(myComboBox.dataProvider, defaultItem)}"/> 
```

这样做是为了确保 selectedItem 在 currentDefaultItem 更改或 dataProvider 更改后将被重新绑定。我自己会对其他解决方案感兴趣。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T19:03:25.437

为事件使用事件侦听器`Change`并在那里进行处理。

```
// update a label item's text with that of the Combobox's selectedItem
private function changeEvt(event:Event):void {
    label.text =event.currentTarget.selectedItem.label + " " + 
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-27T15:22:13.030

我知道这就是它在文档中的描述。如对 selectedItem 的更改将触发更改侦听器。然而对我来说，这不会发生。其他人遇到同样的行为吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-02-12T10:44:35.740

或者，如果您不介意扩展 ComboBox，您可以这样做；这是伪代码（抱歉，匹配项的识别取决于对象类型） - 但你明白了......

```
public class IndexRetainingComboBox extends ComboBox 
{
    public function IndexRetainingComboBox()
    {
        super();
    }

    override public function set dataProvider(value:Object):void
    {
        var originalSelection:Object = this.selectedItem;
        super.dataProvider = value;
        var newIdx:uint = [find originalSelection idx in combobox or return 0 ]
        this.selectedIndex = newIdx;
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-22T18:03:38.603

这看起来是一个很好的方法：使 value 属性可写： http: [//flex.sys-con.com/node/312098](http://flex.sys-con.com/node/312098)

# subquery - 子查询拉 - 所有行

> ID：803693
> 
> 赞同：0
> 
> 时间：2009-04-29T18:41:11.947
> 
> 标签：subquery

我正在从一张表格中提取信息，表格中包含多行，这些信息都与一张票对应。如果票上的任何地方我看到 MIlk 的费用，我想查看与该票相关的所有行#。我试图写一个子查询，但这对我不起作用。有任何想法吗？？

例子：

# 项目成本

1.  山药 1.0
2.  豆子2.0
3.  牛奶5.0
4.  山药 1.0
5.  豆子2.0
6.  糖果 1.0
7.  豆子2.0
8.  山药 1.0
9.  豆子2.0
10.  牛奶5.0
11.  豆子2.0
12.  牛奶5.0

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T19:04:34.277

就像是

```
select *
from Items
where TicketId in
  (
    select distinct TicketId
    from Items
    where ItemName = 'Milk'
  ) 
```

?

# linux - 如何在 Perl 中对需要 JavaScript 的页面进行 Web 测试？

> ID：803701
> 
> 赞同：6
> 
> 时间：2009-04-29T18:42:50.460
> 
> 标签：linux, perl, automated-tests

我发现这两个模块声称能够操纵字符串浏览器，但我没有使用它们的经验，但我当前的测试套件使用[WWW::Mechanize](http://search.cpan.org/dist/WWW-Mechanize/lib/WWW/Mechanize.pm)。有没有人有关于这些模块的任何信息，或者需要 JavaScript 的 Perl 测试页面的其他方法？

为了澄清，我在 Linux (Ubuntu 7.10) 下运行我的测试。

*   [Mozilla::机械化](http://search.cpan.org/dist/Mozilla-Mechanize/lib/Mozilla/Mechanize.pm)
*   [GTK2::WebKit::机械化](http://search.cpan.org/dist/Gtk2-WebKit-Mechanize/lib/Gtk2/WebKit/Mechanize.pm)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-29T18:46:05.507

试试[WWW::Selenium](http://release.seleniumhq.org/selenium-remote-control/1.0-beta-2/doc/perl/)，它使用您的浏览器（通过 Perl）来处理 JavaScript。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T16:55:50.850

您也许可以使用[JavaScript::SpiderMonkey](http://search.cpan.org/perldoc?JavaScript::SpiderMonkey)。

# asp.net-mvc - LINQ to SQL - 将临时用户转换为真实用户

> ID：803706
> 
> 赞同：1
> 
> 时间：2009-04-29T18:44:38.460
> 
> 标签：asp.net-mvc, linq-to-sql, model-view-controller

在创建一个新的 ASP.NET MVC 应用程序时，我为尚未创建帐户的临时用户存储用户创建的数据的方法存在问题，然后我尝试将其转换为真实用户。这可能没有多大意义，所以让我解释一下：

*   该网站的访问者可以在使用用户名、密码等进行注册之前输入个人资料设置。
*   在这种情况下，我通过 LINQ to SQL 为新用户创建数据库条目，使用 Request.AnonymousID 值作为临时用户名。
*   当用户选择注册时，我需要“切换”相关数据库记录以使用新输入的用户名而不是临时用户名。

问题是当我尝试更新记录时我不能因为用户名是主键，所以我被迫删除记录并添加一个新记录......

我可能会坚持下去，但我想我可能只是以完全错误的方式解决这个问题，并想知道是否有人可以提出更好的方法来允许访问者在注册之前存储信息并在他们这样做时结转.

我知道个人资料，但希望其他访问者可以使用个人资料信息。我也知道我可以创建一个匿名配置文件，但似乎我应该能够将数据模型保留在 web.config 文件之外。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T20:39:18.747

我建议使用您的自定义用户数据为表设置一个独立的主键。然后有类似的字段，`RefAnonymousId`并将`RefUserId`该用户数据分别与匿名用户和注册用户相关联。

例如：

```
表用户数据
(
    UserDataID int IDENTITY(1,1) 主键，
    RefAnonymousId 唯一标识符，
    RefUserId 唯一标识符，
    ...（数据字段），
    （也可能是 RefUserId 和 RefAnonymousId 上的唯一键）
)

```

这样，您还可以在用户注销时识别用户，并可能自动登录用户...

# javascript - 为什么 this.selectedIndex 在 IE7 上不起作用标签？这一点 HTML 和 Javascript 可以在 IE6、FF2 和 FF3 中使用。我找不到任何理由为什么它也不应该在 IE7 中工作，但是 this.selectedIndex 总是返回 0。** 在 javascript 文件函数 onTypeChange() { alert($('type_id').selectedIndex); if ($('type_id').selectedIndex != 0) {

> ID：803707
> 
> 赞同：1
> 
> 时间：2009-04-29T18:44:51.940
> 
> 标签：javascript, html, internet-explorer-7

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T18:49:00.930

您正在尝试`selectedIndex`从选项列表中获取。

使用`this.selectedIndex`而不是`this.options.selectedIndex`.

另请参阅此示例以了解更清洁的用法：[http ://www.mredkj.com/tutorials/tutorial002.html](http://www.mredkj.com/tutorials/tutorial002.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-25T19:43:45.160

I know this is old, but I can't help seeing it here unaswered. I think the problem here is that you're using $('type_id'), which returns an Element in jquery (I believe). To access the actual HTML element you have to use $('type_id')[0] or something like that. I think if you use document.getElementById('type_id') it should work.

**Edit:** Changed answer to reflect Benxamin's comment about how to access the dom element $('type_id')[0]

# asp.net - 使用实体框架在 GridView 中按外键值排序？

> ID：803713
> 
> 赞同：0
> 
> 时间：2009-04-29T18:46:08.083
> 
> 标签：asp.net, entity-framework, gridview, sorting, foreign-keys

当使用 GridView 的内置排序与实体框架时，我可以显示外键值。例如...

```
<asp:boundfield HeaderText="Category" DataField="Category.Name" SortExpression="Category.Name" /> 
```

...但是当单击标题以对网格中的项目进行排序时，如何按 Category.Name 对列表列表进行排序？

我只有字符串“Category.Name”，所以我不能这样做：

```
.OrderBy( e => e.Category.Name ) 
```

所以我尝试了反射......

```
private static object GetPropertyValue( object obj, string propertyName )
{
    PropertyInfo propertyInfo = obj.GetType().GetProperty( propertyName );
    return propertyInfo.GetValue( obj, null );
}

// list is List<Widget>
// with a breakpoint here, ((Widget)list[i]).Companies.Name exists in all Widgets
list.OrderBy( e => GetPropertyValue( e, "Category.Name" ) ) 
```

...这是行不通的。没有抛出异常，但不按 Category.Name 排序。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-11-06T15:00:30.870

过去几天我一直在尝试解决这个问题，因为我正在将现有的 ASP.NET 应用程序从使用 SqlDataSources 移动到 EntityDataSources。我发现你必须放置一个“它”。在声明的前面。

因此，以上面的示例为例，您需要像这样形成它：

```
<asp:boundfield HeaderText="Category" DataField="Category.Name" SortExpression="it.Category.Name" /> 
```

我有一个如下所示的实体数据源：

```
<asp:EntityDataSource runat="server" ID="edsResourceRoles"  ConnectionString="name=SkillsEntities"
    DefaultContainerName="SkillsEntities" EnableUpdate="true" EnableDelete="true"
    EnableInsert="true" EntitySetName="ResourceRoles" Where="it.resource_id = @resource_id"
    Include="Roles,Competency_Level" OrderBy="it.Roles.roles_nm"> 
```

然后我可以使用 SortExpression="it.Roles.roles_nm" 控制角色名称列的排序。

希望这可以帮助其他正在寻找答案的人。

# matlab - Matlab中的恒纬线

> ID：803718
> 
> 赞同：1
> 
> 时间：2009-04-29T18:48:01.727
> 
> 标签：matlab, mapping

我是地图新手，想在-68 处绘制一条恒定纬度线，经度从-80 延伸到-65。如果我将 linem 或 plotm 与四个坐标一起使用，我只会得到一个点。我可以创建一个假纬线的唯一方法是使用 track2 大圆圈。但这条线并不像真正的纬度线那样圆润。有没有人有办法解决吗？

这是我正在使用的：映射工具箱版本 2.6 (R2007b) 2007 年 8 月 2 日

此代码片段正在工作，但线没有弯曲，我必须以奇数格式在 plotm 中写入数字。

```
LATMIN = -70; LATMAX = -65 ; LONMIN = -80; LONMAX = -65;

[map,maplegend] = tbase(1,[LATMIN LATMAX],[LONMIN LONMAX]);

figure(1); 
clf
ham = axesm('MapProjection','eqdconic','MapParallels',[],'MapLatLimit',...
            [LATMIN LATMAX],'MapLonLimit',[LONMIN LONMAX]); 
setm(ham,'MLineLocation',LONMIN:5:LONMAX,... 
     'MLabelLocation',(ceil(LONMIN/10)10+10):10:(floor(LONMAX/10)10),...
     'MeridianLabel','on',...
     'PLineLocation',LATMIN:1:LATMAX,...
     'PLabelLocation',LATMIN:5:(LATMAX-5),...
     'ParallelLabel','on',...
     'LabelFormat','signed',...
     'flinewidth',0.1);

hold on;

plotm([-68.58455; -68.58455],[-80.0; 360-65.0],'mo-');

hf = framem; 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T14:01:35.263

使用 track2（双关语），你走在正确的轨道上。你只需要沿着大圆线使用许多航点，然后使用 plotm 绘制这个航点数组。

# asp.net - asp.net HyperLinkField 没有 ToolTip 属性（替代文本）

> ID：803725
> 
> 赞同：9
> 
> 时间：2009-04-29T18:50:01.677
> 
> 标签：asp.net, hyperlink, tooltip

我希望 HyperLinkField 中有一个 ToolTip 字段，因为 HyperLink 中有一个。在绑定到我的数据源之前，我正在通过代码创建一个 HyperLinkField：

```
HyperLinkField hl = new HyperLinkField(); 
hl.DataNavigateUrlFields = new string[] { "col" };
hl.DataNavigateUrlFormatString = "{0}";
hl.DataTextField = "Foo"; 
```

有什么方法可以为将呈现为工具提示（或替代文本）的内容设置值？任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-29T18:56:29.553

没错，**[HyperlinkField](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.hyperlinkfield_properties.aspx)**中没有工具提示/替代文本属性。要克服这个缺点，您需要使用模板字段并添加常规超链接控件。

```
<asp:TemplateField HeaderText="Href">
    <ItemTemplate>
       <asp:HyperLink ID="HyperLink1" runat="server" NavigateUrl='<%#
          Eval("Href") %>' Text='<%# Eval("Href") %>' ToolTip='<%# Eval("Text")         %>'> 
       </asp:HyperLink>
    </ItemTemplate>
</asp:TemplateField> 
```

但是，在程序中执行此操作需要大量工作。您需要创建自己的实现**[ITemplate](http://msdn.microsoft.com/en-us/library/system.web.ui.itemplate.aspx)**接口的类。这是一个**[教程](http://www.developer.com/net/asp/article.php/3609991)**。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-08-31T10:33:32.830

您的要求可以通过`<asp:HyperlinkField>`在. 将 GridView 绑定到 DataSource 后，您可以在事件中执行此操作，如下所示：`RowDataBound``GridView``RowDataBound`

```
if (e.Row.RowType == DataControlRowType.DataRow)
{
    e.Row.Cells[0].ToolTip = "Your tooltip text";
} 
```

虽然您已经接受了另一个答案，但我的回答可能对其他一些用户有帮助！

# ms-word - VSTO Word 2007: How can a control be programmatically moved above/below the range of an existing control?

> ID：803743
> 
> 赞同：3
> 
> 时间：2009-04-29T18:56:20.553
> 
> 标签：ms-word, vsto

I am developing a Word 2007 document template with VSTO. The document has several RichTextContentControls and there is a visible ActionsPane with a treeview control where the nodes of the treeview are the names of the RichTextContentControls.

Users can re-order nodes by dragging/dropping nodes to new locations in the treeview. As nodes are dropped, the corresponding RichTextContentControls should be re-ordered according the new node locations.

I am able to find the Range of the control that the new control is supposed to be moved above of. Now I only need to find a way to simply...move the control to this new location.

How can I move a control above/below a range?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-10-03T16:38:47.640

I did this with a bookmark inside of a RichTextControl to just move it above/below another one from two buttons in the actions pane. Like this for moving up where "bm" below equals the selected bookmark:

```
Dim pageBookmark As Microsoft.Office.Tools.Word.Bookmark
pageBookmark = Globals.ThisDocument.Controls.Item(bm)
pageBookmark.Range.Relocate(Direction:=Word.WdRelocate.wdRelocateUp) 
```

For a tree view, it would be more complex, but I could see that you would want all your richtext controls to be indexed (maybe use the "tag" property) and then as you move them in your tree view, use the index to add/subtract from other indexes and then use the "Relocate" method in a loop that many times to get it to it's new location. Then you can loop and recreate the index. `Application.ScreenUpdating = False` at the start of the loops and set it back to `= True` at the end of the loop would stop the flicker as well.

# asp.net-mvc - ASP.NET MVC 为什么我的路由在发布后不起作用？

> ID：803744
> 
> 赞同：1
> 
> 时间：2009-04-29T18:56:21.147
> 
> 标签：asp.net-mvc, url-routing, publishing

我为我的网站设置了以下路线图。在本地运行和调试完美。我可以将网站发布到我的服务器（www），但只有根页面有效（[http://www.domain.com](http://www.domain.com)）。一旦我指定了一个控制器（[http://www.domain.com/Project](http://www.domain.com/Project)），它就会停止工作......

我究竟做错了什么？

**全球.asax.vb**

```
' Note: For instructions on enabling IIS6 or IIS7 classic mode, 
' visit http://go.microsoft.com/?LinkId=9394802

Public Class MvcApplication
Inherits System.Web.HttpApplication

Shared Sub RegisterRoutes(ByVal routes As RouteCollection)
    routes.IgnoreRoute("{resource}.axd/{*pathInfo}")

    ' MapRoute takes the following parameters, in order:
    ' (1) Route name
    ' (2) URL with parameters
    ' (3) Parameter defaults

    routes.MapRoute("ProjectsByCategory", "Project/Category/{id}", _
                    New With {.controller = "Project", .action = "ListByCategory", .id = ""}, _
                    New With {.id = "^[0-9]+"})

    routes.MapRoute( _
        "Default", _
        "{controller}/{action}/{id}", _
        New With {.controller = "Project", .action = "Index", .id = ""} _
    )

End Sub

Sub Application_Start()
    Common.LoadEntitySpacesFactory()
    RegisterRoutes(RouteTable.Routes)
End Sub
End Class 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T18:59:50.217

您要部署到 IIS6 服务器吗？如果是这样，您需要在[此处详细](http://haacked.com/archive/2008/11/26/asp.net-mvc-on-iis-6-walkthrough.aspx)执行一些步骤。如果不是，您能否再解释一下该错误 - “它停止工作......”究竟是什么意思？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T19:00:33.570

您要部署到 IIS5 吗？如果是这样，请遵循[此](http://itscommonsensestupid.blogspot.com/2008/11/deploy-aspnet-mvc-app-on-windows-xp-iis.html)。

# c++ - 一个函数需要一个抽象类型 A 的 C++ 对象。如何将 A 子类的 Lua 对象传递给它？

> ID：803748
> 
> 赞同：4
> 
> 时间：2009-04-29T18:57:14.733
> 
> 标签：c++, lua, binding

我想将一个派生自纯虚拟 C++ 类的类的 Lua 对象传递给一个期望纯虚拟类的 C++ 对象的函数。我怎样才能做到这一点？

我是 lua 和 luabind 的新手，所以请耐心等待。

在 C++ 中：

```
struct A {
  virtual void foo() = 0;
};

void do_something(A* a) {
  a->foo();
} 
```

在 Lua 中：

```
class 'MyA' (A)
....
function MyA:foo()
  print('hi')
end 
```

再次在 C++ 中：

```
... // somehow create an instance of MyA class and named myA
    // How? 
    // Maybe the result of a call to "MyA()"?

do_something(myA); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T05:57:39.950

抱歉，我不会直接回答您提出的问题，而是会根据个人经验提供一些建议：

如果您是Lua*新手*，您应该认真考虑在**原始 Lua API**中编写您的第一个绑定，并且不要使用这种面向对象的布局。至少你会明白到底发生了*什么*。

Lua API 本身使用起来很舒服。它不会产生任何额外的开销，您可以完全控制正在发生的事情。Luabind 库开发目前有点陈旧（但看起来它恢复了活力）。

您应该考虑是否*真的*需要在 Lua 端，尤其是在 C++ 端模仿从 C++ 类派生。这样的事情对于 Lua 来说并不那么自然，并且需要显着的开销来实现。此外，在 C++ 中，您隐藏了您正在对另一种语言进行非本地调用的事实。除非有充分的记录，否则这是性能问题的潜在来源。

几年前我开始使用 Lua 时，我曾经使用与您相同的方式编写绑定，使用 Luabind，并模仿从 C++ 对象派生。现在我使用纯 Lua API 和简单的过程（相对于面向对象）跨语言接口。我对结果很满意。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T21:39:21.863

请参阅LuaBind 文档中的第[10.1节。](http://www.rasterbar.com/products/luabind/docs.html#defining-classes-in-lua)您基本上为 LuaBind 类提供了一个简单的 C++ 包装器，它充当底层 Lua 实现的传递。请注意此文档中的以下内容：

```
virtual void f(int a) 
{ 
    call<void>("f", a); 
} 
```

call("f", a) 将调用 Lua 'f' 函数，传入参数 a。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T21:14:01.893

您必须创建一个实现纯虚函数的 C++ 类，然后调用 Lua 代码。实现太复杂了，不能在这里扔。

基本伪代码：

```
// C++
struct LuaA : public A
{
  LuaA(const std::string &luacode)
    : myLuaHandler(luacode)
  {
  }

  virtual void foo()
  {
    myLuaHandler.call("MyA:foo()");
  }
} 
```

该示例非常高级，但它旨在表明您想要做的事情并非微不足道。它是你想要真正暴露给你的 Lua 代码的新的“LuaA”。

一般来说，在包装我的 C++ 以接触 Lua 和其他脚本语言时，我更喜欢使用[SWIG 。](http://www.swig.org)SWIG 确实支持您感兴趣的虚拟方法的这种重载（在 SWIG 用语中称为“导演”），但是应该注意 Lua/SWIG 不支持导演。Java、C#、Ruby、Perl 和 Python 在 SWIG 中都支持导向器。我不确定为什么 Lua 不支持它。

有可能，由于 Lua 不支持继承，因此您想要完成的确切语义根本不可能以您建议的方式实现。

也许其他人对 Lua 方面有更好的答案？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T16:08:54.863

我将在 C++ 中对纯虚拟类进行子类化，然后可能从 luabind 开始（根据 Aaron 和 lefticus 的解决方案）。如果这个开销太大，我将直接使用 Lua C stack-twiddling API（根据 Alexander）。

因此，这里没有一个答案。稍后我将发布带有结果的评论。

感谢大家！

# javascript - 谷歌地图 - 数以千计的标记 - JSON

> ID：803750
> 
> 赞同：9
> 
> 时间：2009-04-29T18:57:41.143
> 
> 标签：javascript, json, google-maps, google-maps-markers

在以下示例中，标记是从 JSON 加载的。

如果有 20,000 个标记，那么 JSON 将会非常大。

有没有办法根据缩放级别发送不同的 JSON 文件而不是发送一个巨大的数组？

[http://gmaps-utility-library.googlecode.com/svn/trunk/markermanager/release/examples/weather_map.html](http://gmaps-utility-library.googlecode.com/svn/trunk/markermanager/release/examples/weather_map.html)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-29T19:04:16.400

地图视图有“边界矩形”的概念。地图 api 将其作为两个纬度/经度坐标对提供给您 - 一个用于 SW 角，一个用于 NE 角。

因此，如果您有一个返回 JSON 点的自定义数据服务，则需要接受这些坐标作为输入，并相应地调整返回的数据集（很可能作为 SELECT 语句中的 WHERE 子句）。

我没有记住这个边界矩形的详细信息，但这就是[API 文档](http://code.google.com/apis/maps/documentation/)的用途。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-29T21:14:06.137

有一个名为[MarketClustered](http://googlegeodevelopers.blogspot.com/2009/04/markerclusterer-solution-to-too-many.html)的新库可以帮助您

[![替代文字](https://i.stack.imgur.com/Dq4yR.jpg)](https://i.stack.imgur.com/Dq4yR.jpg)
[（来源：[googlecode.com](http://gmaps-samples.googlecode.com/svn/trunk/images/screenshot_clusterereffect.jpg)）]

即使数据太大，我认为将所有数据都提供给地图会更好，让它做它的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T19:09:06.623

是的，我在一个地方当局的申请中做了类似的事情，我们展示了 6,000 多个家庭中每栋房屋的回收量。由于数据总量（包括每个家庭的地址和统计信息）相当大，一口气拉回整个数据文件导致浏览器出现死机。

因此，在对数据库的 AJAX 调用中，我们发送了地图区域的边界矩形坐标（纬度、经度），然后只返回我们可见的那些点。由于应用程序的性质，用户驱动的“获取数据”按钮是完全可以接受的，但显然您可以在主题上玩很多其他变体 - 一旦您将边界坐标传递到服务器端，您就可以决定什么在那里做 - 例如，如果缩放级别太高，只返回一个子集。您也应该能够捕获地图绘制事件并自动执行此操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T20:58:59.323

当缩放变化时，将新的缩放级别发送到您的 JSON 服务并返回应该在该级别可见的标记。使用[addMarkers()](http://gmaps-utility-library.googlecode.com/svn/trunk/markermanager/release/docs/reference.html)将结果添加到 MarkerManager 并使其仅在当前缩放级别可见。

此处的其他响应建议仅返回当前视图中的标记，但您也可以仅返回该缩放级别的所有标记。这取决于您对要在每个级别显示哪些标记的了解程度。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T19:03:18.510

解决此问题的可能方法：

*   根据缩放级别构建`JSON`服务器端（con：缩放后需要重新加载，pro：只需要加载少量数据）
*   包括有关如何在`JSON`数据中访问标记的信息（亲：只需要加载一次数据，con：使用 遍历数据`JavaScript`）
*   计算可见标记`JavaScript`（赞成：非常动态，反对：繁重的计算负载）

# apache - 魔术 Apache 重定向 /~username

> ID：803758
> 
> 赞同：0
> 
> 时间：2009-04-29T18:59:03.637
> 
> 标签：apache, redirect, httpd.conf

我继承了一个已经为一些网站提供服务的网络服务器。我正在尝试将其中一些站点迁移到新的网络服务器。

其中一个网站的页面名为： [http://mydomain/ABCDepartment/](http://mydomain/ABCDepartment/)

此 URL 也有效： [http://mydomain/~joesmith](http://mydomain/~joesmith)

joesmith 的索引页实际上位于 /var/www.../ABCDepartment/people/joesmith/

现在我正在检查 httpd.conf 并看到以下内容：

```
UseCanonicalName Off
UserDir public_html
UserDir disabled root 
```

joesmith 或 ~ 没有特殊的 mod_rewrite 规则

这个魔法是怎么发生的？UseCanonicalName 已关闭，如果不是 UserDir public_html 应查看 /home/joesmith/public_html

我错过了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T19:01:49.230

这是一个名为 userdir 的 Apache 扩展：[http ://httpd.apache.org/docs/1.3/mod/mod_userdir.html](http://httpd.apache.org/docs/1.3/mod/mod_userdir.html)

它会自动重写请求以指向用户主目录中名为 public_html 的文件夹（Web 服务器必须具有对该文件夹的树的读取访问权限）。

# php - 以表格形式将参数传递给php？

> ID：803766
> 
> 赞同：1
> 
> 时间：2009-04-29T19:00:27.127
> 
> 标签：php, forms

我有通过 php 回显的基本 html 表单：

```
<html>
<body>
<?php 
if (isset($_GET["pk"]))
 { $pk = $_GET["pk"];}
echo '<form action="up.php" method="post"
enctype="multipart/form-data">
<label for="file">Filename:</label>
<input type="file" name="file" id="file" /> 
<br />
<input type="submit" name="submit" value="Submit" />
</form>';
?>
</body>
</html> 
```

我想将 pk 的值传递给 up.php

修改 action="up.php?pk=$pk" 不起作用。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-29T19:03:13.797

使用隐藏字段：

```
<input type="hidden" name="pk" value="<?php echo $pk; ?>"> 
```

顺便说一句，像你那样打印大量的 HTML 是*丑陋*的。考虑使用 HEREDOC、模板引擎或框架退出 PHP 来执行此操作。

**编辑**：

如下所述，您不应在未先对其进行清理的情况下将 GET 和 POST 数据打印回页面。假设 pk 是主键，您至少应该*使用*`$pk`intval 函数将其[包裹](http://www.php.net/intval)起来。

 ** * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T19:41:08.450

我同意所有关于 $_GET['pk'] 变量的某种输入控制的评论。我会推荐 php 中的过滤器模块，我相信这几乎是默认安装的模块。

```
<html>
<body>
<?php 
 $param = filter_input(INPUT_GET, 'pk', FILTER_SANITIZE_ENCODED);
?>
<form action="up.php<?php echo (isset($param) && $param != false) ? '?pk=' . $params : ''); ?>" method="post"enctype="multipart/form-data">
<label for="file">Filename:</label>
<input type="file" name="file" id="file" /> 
<br />
<input type="submit" name="submit" value="Submit" />
</form>
</body>
</html> 
```

您可以在此处找到有关过滤器模块的更多信息：[链接文本](http://uk3.php.net/manual/en/ref.filter.php)

我也同意 Paolo Bergantino，这不是最漂亮的方法，模板引擎、heredocs 或 regexp 可能是提高系统可读性和可维护性的更好方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T19:04:23.140

您不能在单引号字符串中使用变量：

```
$pk = 123;
echo 'Hello $pk'; // echos Hello $pk
echo "Hello $pk"; // echos Hello 123
echo 'Hello ' . $pk; // echos Hello 123 
```

传递它的最佳方法是作为表单内的隐藏字段

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T19:07:43.740

像这样尝试：

```
<html>
<body>
<?php 
$params = "";
if (isset($_GET["pk"]))
  { $params = "?pk=" . $_GET["pk"];}
echo '<form action="up.php' . $params . '" method="post"
enctype="multipart/form-data">
<label for="file">Filename:</label>
<input type="file" name="file" id="file" /> 
<br />
<input type="submit" name="submit" value="Submit" />
</form>';
?>
</body>
</html> 
```

当然，您应该知道 $_GET["pk"] 可能包含几乎任何内容，因此请考虑某种输入清理。

# telerik - Telerik RadChart 和 Ektron CMS 7.6 dll 冲突

> ID：803771
> 
> 赞同：0
> 
> 时间：2009-04-29T19:01:04.647
> 
> 标签：telerik, conflict, ektron, radchart

我有 Ektron CMS 7.6，其中包含大量内置功能。其中一项功能是用于 ASP.NET Ajax 控件的 Telerik。

我还单独订阅了 Telerik Controls。

问题是 Telerik 被迫打破涉及 Telerik.Charting.dll 和 RadChart.Net2.dll 的 Radchart 的一些向后兼容性。基本上这两个dll引用相同的类，不能共存。我的工具包使用较新的 RadChart。

有没有其他人遇到过这个？你怎么修好它的？

确切的错误：

```
 The type 'Telerik.Charting.ChartSeries' exists in both
    'c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET
     Files\internetcms\84aae664\ef33a0e2\assembly\dl3\79307436\
    00e4973e_e51cc901\
    RadChart.Net2.DLL' 

    and 

    'c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET
 Files\internetcms\84aae664\ef33a0e2\assembly\dl3\f477bd61\e6a2b770_714ec901\
    Telerik.Charting.DLL' 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T20:03:53.183

从项目中删除 RadChart.Net2.dll 可以消除构建错误。

不是 100% 确定 Ektron 中的其他东西不需要旧的 dll。

现在我已将处理程序添加到 web.config，但 Ektron 将其作为未知文件捕获并重定向到我的错误页面。

添加到 web.config

```
 <add path="ChartImage.axd" verb="*" type="Telerik.Web.UI.ChartHttpHandler,
 Telerik.Web.UI, Version=2008.2.826.20, Culture=neutral, 
PublicKeyToken=121fae78165ba3d4" validate="false" /> 
```

任何其他建议都会有所帮助

另外：是的，我知道 Telerik 到 2009.1 为止。*.* 但我不想再增加我的问题的复杂性，直到我首先得到这个工作

最终更新已修复！

上面的处理程序只需移动到处理程序部分的顶部。来自 Ektron 的 @dsbarka 能够向我推荐这个。Ektron 中的某些东西可能已经捕获了图表图像的处理程序。

现在工作

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T19:09:24.750

根据我对 Ektron CMS400 的经验，如果它们包含一些开箱即用的东西，你会一直坚持使用那个版本，直到他们想要升级......否则你会破坏 CMS400 的更多功能，而不是新功能的价值。

不幸的是，我会说您最好重新设计您的 RadChart 工具包以使用 Ektron 包含在 CMS400 中的 Telerik 工具版本。

# internet-explorer - Microsoft VPC IE 映像过期

> ID：803774
> 
> 赞同：7
> 
> 时间：2009-04-29T19:02:03.613
> 
> 标签：internet-explorer, virtual-pc, vpc

[http://www.microsoft.com/downloads/details.aspx?FamilyId=21EABB90-958F-4B64-B5F1-73D0A413C8EF&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=21EABB90-958F-4B64-B5F1-73D0A413C8EF&displaylang=en)

Microsoft 提供的用于测试的 IE6/7/8 XP SP3 映像将于明天（！） 4 月 30 日到期。我有点担心 Microsoft 尚未发布新映像，因为我经常将这些映像用作简单的测试出现的 IE6/7 兼容性问题的方法。

这里有没有其他人在更长的时间范围内对这些 VPC 图像有经验，知道他们明天实际上会发布新图像，所以不会有失误？或者有没有人知道一种让微软合适的人注意到这一点并确保图像刷新发生的好方法？

否则，是否有人对如何在不涉及这些免费图像的同一台机器上测试 IE6/7 有很好的建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T19:16:52.313

我正在使用不久前过期的相当旧的图像。它往往会运行一段时间，然后给出关于过期的消息，然后在大约一个小时内再次重置。如果您的版本也一样，我会说这真的不是问题，只需重新启动即可。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T22:19:22.180

据我所知，所有 VPC 映像都有某种到期日期。因此，当它们到期时，它们每 2 小时开始重新启动一次，但除此之外它们工作正常。一个小时或工作后会弹出一条消息，这意味着您还有一个小时。要工作更长时间，您可以在每次不需要时暂停 VPC（操作 -> 暂停）。

当我使用一段时间的 MOSS 2007 VHD 过期时，我认为他们花了一个月左右的时间才推出新的。

至于 IE 6/7/8 的测试，请查看[Expression Web SuperPreview](http://www.microsoft.com/expression/features/Default.aspx?key=webpreview) - 它非常酷。更详细的描述[在这里](http://www.webdesignerdepot.com/2009/03/microsoft-announces-superpreview-for-ie-browser-testing/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T19:19:35.413

如果您订阅了 Technet / MSDN，则可以从 4 月 30 日开始下载 Windows 7 的公共 RC1，据我所知，其中包含许可用于虚拟机的 Windows XP（带有 IE6）的副本。它是一个非常简洁的功能，但基本上它可以让您运行 IE 6 和 IE 7 SxS，而无需费心下载更新的 VPC 映像。您可以[在此处](http://www.winsupersite.com/win7/xp_mode_preview.asp)阅读所有相关信息并观看[视频](http://www.withinwindows.com/2009/04/28/windows-xp-mode-internals-part-2-application-publishing-magic/)。

或者再等几天（5 月 5 日）并下载具有相同功能的 Windows 7 的公共 RC。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-08T16:43:06.967

看起来 MS 在 5 月 5 日更新了 VPC 映像。

请参阅：[http ://www.microsoft.com/downloads/details.aspx?FamilyId=21EABB90-958F-4B64-B5F1-73D0A413C8EF&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=21EABB90-958F-4B64-B5F1-73D0A413C8EF&displaylang=en)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T19:12:37.287

我认为，这在 VS.NET 2010 CTP 之前已经发生过。我相信有一种方法可以设置映像，以便来宾操作系统的系统时钟与主机操作系统的时钟分开。您可以编辑 VPC 配置文件，然后将客户机操作系统的系统时钟设置回几个月。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-08-22T08:12:51.547

现在可以从[http://www.modern.ie/en-us/virtualization-tools#downloads下载 VHD 映像](http://www.modern.ie/en-us/virtualization-tools#downloads)

现代.ie 归微软所有，所以它是官方的东西。

# c - 帮助比较一个 argv 字符串

> ID：803776
> 
> 赞同：4
> 
> 时间：2009-04-29T19:02:59.930
> 
> 标签：c, argv

我有：

```
int main(int argc, char **argv) {
   if (argc != 2) {
      printf("Mode of Use: ./copy ex1\n");
      return -1;
   }

   formatDisk(argv);
}

void formatDisk(char **argv) {
   if (argv[1].equals("ex1")) {
       printf("I will format now \n");
   }
} 
```

如何检查C中`argv`是否等于`"ex1"`？是否已经有一个功能？谢谢

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-29T19:04:32.483

```
#include <string.h>
if(!strcmp(argv[1], "ex1")) {
    ...
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-08-12T06:56:58.600

Just to give and example of using strings and dynamically allocating new strings. Probably useful when you don't know the size of argv[?]

```
// Make the string with the value you want compared
char testString[] = "-command";

// Make a char pointer, use new to allocate the memory 
//  the size is determined by string length of argv[1]
char * strToTest = new char[ strlen( argv[1] ) ];

// Now we can copy the contents of argv[1] into strToTest as they are equal size
strcpy( strToTest, argv[1] );

// Now strcmp returns True if the two strings match
if (strcmp( testString, strToTest ) {
//do somthing here ...
} 
```

# c# - 通过 SOCKS5 代理连接到 .NET Web 服务

> ID：803777
> 
> 赞同：4
> 
> 时间：2009-04-29T19:03:11.113
> 
> 标签：c#, .net, web-services, proxy, socks

我正在尝试通过 SOCKS5 代理连接到 Web 服务。目前，我的 app.config 如下：

```
<system.net>
 <defaultProxy enabled="true"  >
  <proxy proxyaddress="http://xxx.xxx.xxx.xxx:yyyy" bypassonlocal="True" />
 </defaultProxy>
</system.net> 
```

这适用于 http 代理，但它只是不连接到 SOCKS5 代理。我已经在谷歌上广泛搜索了答案，但找不到任何人解决了这个问题，即使我已经找到了几次这个问题。有人知道我该怎么做吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-15T16:08:14.433

显然微软没有在他们的 web 类中构建 SOCKS 代理支持（参见[http://windows-tech.info/13/f17246e7dd4a8a2b.php](http://windows-tech.info/13/f17246e7dd4a8a2b.php)）

我也处于想使用带有 SOCKS5 代理的内置 .NET Web 功能的情况，但还没有找到任何令人满意的解决方案。我想我的下一步是通过 Reflector 或 Mono 代码库获取 .NET 类的源代码，并将其重构为使用上述链接中提到的 ProxySocket 类。

这比我想要的要多，但似乎是唯一的方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2017-11-18T18:31:29.943

如果您能够使用[HttpClient](https://msdn.microsoft.com/en-us/library/system.net.http.httpclient(v=vs.118).aspx)，则可以使用[SocksSharp](https://github.com/extremecodetv/SocksSharp)。

我只是按照这个例子，它对我有用。

```
var settings = new ProxySettings()
{
    Host = "xxx.xxx.xxx.xxx",
    Port = yyyy
};

using (var proxyClientHandler = new ProxyClientHandler<Socks5>(settings))
{
    using (var httpClient = new HttpClient(proxyClientHandler))
    {
        var response = await httpClient.GetAsync("http://example.com/");
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-06-25T11:30:29.750

理论上你可以继承webservice类并覆盖GetWebRequest和GetWebResponse。然后你可以使用这个 c# socks 类[http://www.codeproject.com/Articles/5954/C-class-for-connecting-via-a-SOCKS-Proxy-Server](http://www.codeproject.com/Articles/5954/C-class-for-connecting-via-a-SOCKS-Proxy-Server)并将 webrequest 转换为套接字并返回再次。

我能找到的最快解决方案是使用[WideCap](http://widecap.ru/)设置系统范围的 socks 代理。这会通过 socks 代理服务器路由机器上的所有流量。

# events - 放大/缩小手势 UIView

> ID：803781
> 
> 赞同：2
> 
> 时间：2009-04-29T19:03:41.083
> 
> 标签：events, uiview, zooming, multi-touch

我一直在尝试在 UIView 中捕捉手势放大/缩小。

代码：

```
NSSet *allTouches = [event allTouches];
NSArray *twoTouches = [allTouches allObjects];
UITouch *first = [twoTouches objectAtIndex:0]; 
UITouch *second = [twoTouches objectAtIndex:1]; 
CGPoint firstPoint = [first locationInView:self];
CGPoint secondPoint = [second locationInView:self];
CGFloat initialDistance = [distanceBetweenPoints(firstPoint, secondPoint)]; 
```

我正在使用函数 distanceBetweenPoints，问题是 firstPoint 或 secondPoint 始终为 0.00、0.00，因此结果是其中一个的值。

我需要将展位值设为零才能获得真实距离。

视图的框架为：(0, 0, 320, 417)。

我正在开发的功能类似于放大/缩小谷歌地图。

谢谢，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-11-15T12:13:44.197

问题是 uiview 需要它的属性 self.multipleTouchEnabled = YES; 出于这个原因，多点触控工作但不是那么好。

# silverlight - 是否有“浏览器控件”来在 Flash/Silverlight 中托管网站？

> ID：803782
> 
> 赞同：0
> 
> 时间：2009-04-29T19:03:52.533
> 
> 标签：silverlight, flash, browser, iframe

我正在寻找类似于 VB6 / .Net Winforms“浏览器控件”的东西，它可以让您在应用程序中显示浏览器。我不想只渲染一个页面，我希望它是一个功能齐全的浏览器，人们可以在其中点击链接、运行 Javascript 等。

本质上，我想要的是一个 IFrame，只是它在 Flash 应用程序或 Silverlight 应用程序中运行。

这样做的最终原因是我想击败 IFrame 破坏者。我正在制作一个网络应用程序，让您可以查看其中的其他网站，并且我遇到了一堆具有此代码的网站：

var t=top.location,w=window.location;if(t!=w) t.replace(w);

（这是来自 eBay 顺便说一句）

这基本上将用户从我的网站弹出并进入他们的网站。我希望通过在插件沙箱中使用某种“浏览器控件”，“顶部”将成为该浏览器控件的顶部，而不是我的网站。

当然，如果您有任何其他想法来实现相同的目标，他们将非常受欢迎。

* * *

编辑：我尝试了 Bill 建议的 Component One 控件，但它不适用于这些目的，因为它在 SilverLight 控件*之外*创建了一个 IFrame ，因此它在与托管 Silverlight 的页面相同的上下文中执行，即我试图避免的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T06:28:56.020

Northcode [SWF Studio](http://www.northcode.com)允许您在 Flash 的舞台上添加浏览器窗口。我个人使用 SWF Studio 作为第三方 SWF2EXE 工具来扩展 Flash 投影仪的功能。它相当稳定和强大。就浏览器控制而言[，这里是](http://www.northcode.com/v3/exampleitem.php?link=1)您可以下载并测试它是否符合您的目的的示例。在此处检查浏览器 APT [。](http://www.northcode.com/v3/help/index.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T19:50:09.987

我使用[由 Component One 创建的 HTML 控件](http://www.componentone.com/SuperProducts/HtmlHostSilverlight/)。它的限制是页面中的 Silverlight 对象应设置为无窗口，否则效果很好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-02T03:47:23.147

我们还没有构建一个组件来使人们能够做到这一点，但我们愿意接受这里的建议。话虽如此，最简单的解决方案是 iFrame，但请注意，当您将 iFrame 覆盖在 Silverlight 的顶部时，我们会看到客户因此遇到性能问题（主要是由于 iframe 的 alpha 透明度等）。

这不是孤立于 Silverlight 的，Flash 遇到与浏览器和在给定操作系统中呈现相同的问题。

HTH。

**Scott Barnes / Rich Platforms 产品经理 / Microsoft。**

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-09T09:43:06.057

这是一篇旧帖子，但我会添加我的 tupence 答案。[我对 Silverlight链接文本](http://www.divelements.co.uk/silverlight/tools.aspx)使用了 DivElements 免费控件，它工作得非常好。它只是准确定位 div，使其看起来像在顶部。

至于其他此类控件，您必须`windowless`将 Silverlight 容器的属性设置为 true。

它对我来说非常好用，我可以无缝地将 Google 地图和 Acrobat 插件与我的 Silverlight 应用程序并排显示。

PS：因为组件只是`<div>`在页面中添加了一个，所以你不能像在`<header>`标签中那样让它动态加载 Javascript 文件。

PPS：当“手动”设置 HTML 代码时，一定要在使用 HTML DOM 之前连接上`DocumentReady`or事件。`Loaded`

希望对某人有所帮助。

# sql - SQL Server 索引 - LIKE 查询有什么改进吗？

> ID：803783
> 
> 赞同：27
> 
> 时间：2009-04-29T19:03:52.877
> 
> 标签：sql, sql-server, select

我们有一个查询运行在一个相当大的表上，不幸的是需要在几个 varchar 字段上使用 LIKE '%ABC%' 以便用户可以搜索部分名称等。 SQL Server 2005

在使用 LIKE 时，在这些 varchar 字段上添加索引是否有助于选择查询性能，或者它是否基本上忽略索引并在这些情况下进行全面扫描？

使用 LIKE 时还有其他可能提高性能的方法吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-29T19:07:00.310

仅当您向这些列添加全文搜索并使用 SQL Server 的全文查询功能时。

否则，不，索引将无济于事。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-30T17:00:37.033

您可以通过添加索引来潜在地看到性能改进，这在很大程度上取决于具体情况:)

您的谓词列占行总大小的多少？您希望匹配多少行？您需要返回与谓词匹配的所有行，还是只返回前 1 行或前 n 行？

如果您正在搜索具有高选择性/唯一性的值（返回的行数很少），并且谓词列是整个行大小的一小部分，那么索引可能非常有用。它仍将是一次扫描，但您的索引每页将容纳比源表更多的行。

这是一个总行大小远大于要搜索的列大小的示例：

```
create table t1 (v1 varchar(100), b1 varbinary(8000))
go
--add 10k rows of filler
insert t1 values ('abc123def', cast(replicate('a', 8000) as varbinary(8000)))
go 10000
--add 1 row to find
insert t1 values ('abc456def', cast(replicate('a', 8000) as varbinary(8000)))
go

set statistics io on 
go
select * from t1 where v1 like '%456%'
--shows 10001 logical reads

--create index that only contains the column(s) to search across
create index t1i1 on t1(v1)
go
select * from t1 where v1 like '%456%'
--or can force to 
--shows 37 logical reads 
```

如果您查看实际的执行计划，您可以看到引擎扫描了索引并在匹配行上进行了书签查找。或者你可以直接告诉优化器使用索引，如果它没有决定自己使用这个计划：select * from t1 with (index(t1i1)) where v1 like '%456%'

如果您有一堆列要搜索只有几个高度选择性的列，您可以创建多个索引并使用缩减方法。例如，首先从您的高选择性索引中确定一组 ID（或任何您的 PK），然后使用针对该小组 PK 的过滤器搜索选择性较低的列。

如果您总是需要返回大量行，那么几乎可以肯定使用表扫描会更好。

因此，可能的优化很大程度上取决于表定义的细节和数据的选择性。

！-阿德里安

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-29T20:23:22.920

唯一可以提高性能的其他方法（除了使用全文索引）是使用“LIKE ABC%”——不要在搜索词的两端添加通配符——在这种情况下，索引可以工作。

如果您的要求是您必须在搜索词的两端都有通配符，那么您就不走运了...

马克

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-29T19:25:19.657

像 '%ABC%' 将始终执行全表扫描。没有办法解决这个问题。

您确实有几种替代方法。首先是全文搜索，它真的是为这类问题设计的，所以我先看看。

或者，在某些情况下，可能适合对数据进行非规范化并将目标字段预处理为适当的标记，然后将这些可能的搜索项添加到单独的一对多搜索表中。例如，如果我的数据总是包含一个包含模式“AAA/BBB/CCC”的字段，并且我的用户在 BBB 上搜索，那么我会在插入/更新时将其标记化（并在删除时删除）。这也是使用触发器而不是应用程序代码*更*受欢迎的情况之一。

我必须强调，这并不是一个真正的最佳技术，只有在数据与该方法非常匹配并且由于某种原因您不想使用全文搜索时才应该使用（并且类似扫描的数据库性能确实是不可接受）。这也可能会进一步导致维护问题。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-04-29T21:48:45.880

在该列上创建统计信息。sql srever 2005 优化了字符串搜索，因此您可能会从中受益。

# icalendar - 日历提醒不起作用

> ID：803801
> 
> 赞同：0
> 
> 时间：2009-04-29T19:07:39.123
> 
> 标签：icalendar

我正在创建一个`.ics`文件

```
BEGIN:VCALENDAR
VERSION:2.0
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
UID:
SUMMARY:IEP DUE ALERT
ORGANIZER:
LOCATION:
DTSTART:20090429T060000Z
DTEND:20090429T070000Z
DTSTAMP:20090429T185030
DESCRIPTION:An IEP is due for Test, Tyler on 4/29/2009.
BEGIN:VALARM
TRIGGER:P0DT1H0M
ACTION:DISPLAY
DESCRIPTION:Reminder
END:VALARM
END:VEVENT
END:VCALENDAR 
```

我可以创建约会，但提醒仍设置为“无”。

请帮忙谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T19:37:21.547

没关系，我使用`Response.ContentType = "text/x-vcalendar"`的是 which is for`vCalendar`
而不是 `Response.ContentType = "text/calendar"`which is for `iCalendar`。

谢谢

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-02-15T10:59:24.470

您可以将 P0DT1H0M 更新为 -P0DT1H0M ，它适用于谷歌日历

# ms-access - 用于恢复和修复损坏的 *.MDB 数据库的工具 (Access)

> ID：803804
> 
> 赞同：1
> 
> 时间：2009-04-29T19:07:46.050
> 
> 标签：ms-access, corruption

多年来，我在损坏的 Access *.MDB 文件中看到了许多错误。
我不使用 Access 作为前端，只是作为存储数据表的后端。
我已经使用了最佳实践：规范化、尽快关闭数据库连接等。

我想知道是否有人知道从损坏的 MDB 文件中恢复数据的最佳商业工具是哪个。（我需要一个工具，而不是服务）。

我见过AccessFix、Access Recovery、Advanced Access Repair。
你用过这些工具吗？有赢家吗？有什么推荐吗？有什么建议吗？

谢谢，
贾格

PS 我知道我不应该在并发用户和网络环境中使用 Access 后端，但我现在无能为力。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T20:20:09.167

自从我在 1996 年开始专业的 Access 开发以来，我只有一次损坏的 MDB 需要内置压缩/修复工具以外的任何东西。在那种情况下，我使用了[Peter Miller 的 PKSolutions](http://pksolutions.com/t4.htm)。在那种情况下，损坏是我的错——我在 Access 进程运行大更新时杀死了它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-23T11:51:11.120

您可以使用 stellar access 数据库修复软件，它为您提供免费的软件评估，以检查软件的可靠性。

# awk - 无法通过 Zsh/AWK 组合文件中的单词

> ID：803805
> 
> 赞同：0
> 
> 时间：2009-04-29T19:08:08.997
> 
> 标签：awk, zsh

我有文件 1

```
A,B,C 
```

和文件2

```
D,E,F 
```

我想拥有

```
AD, AE, AF, BD, BE, BF, CD, CE, CF 
```

不成功

```
echo {`cat File1`}{`cat File2`} 
```

给予

```
{A,B,C}{D,E,F} 
```

**您如何通过 Zsh/AWK 解决问题？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T01:55:03.747

我不知道 zsh，这是我对 bash 和 sed 所做的：

```
echo "A,B,C" >a
echo "D,E,F" >b
for i in `cat a | sed -e "s@,@\n@g"`; 
      do for j in `cat b | sed -e "s@,@\n@g"`; 
      do echo -n "$i$j, "; 
      done ; 
      done | sed -e "s@,\s\$@@" 
```

那么输出是：

```
AD, AE, AF, BD, BE, BF, CD, CE, CF 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T15:17:31.367

```
awk -F, '
    NR==FNR {
        # read lines from File1 into the array f1
        f1[NR]=$0
        next
    }
    {
        # foreach line in File2
        split(f1[FNR], words);    # get words from corresponding line in File1
        sep = ""
        for (i in words) {
            for (j=1; j<=NF; j++) {
                printf("%s%s%s", sep, words[i], $j)
                sep = ", "
            }
        }
        print ""
    }
' File1 File2 
```

如果 File1 包含

```
A,B,C
1,2,3 
```

和 File2 包含

```
D,E,F
4,5,6 
```

然后 awk 脚本输出

```
AD, AE, AF, BD, BE, BF, CD, CE, CF
14, 15, 16, 24, 25, 26, 34, 35, 36 
```

# perl - 如何将哈希传递给 Perl 中的函数？

> ID：803808
> 
> 赞同：39
> 
> 时间：2009-04-29T19:08:34.020
> 
> 标签：perl, function, parameter-passing, declaration

我有一个函数需要一个变量和一个关联数组，但我似乎无法让它们正确传递。我认为这与函数声明有关，但是我无法弄清楚它们在 Perl 中是如何工作的。有没有一个很好的参考，我该如何完成我需要的？

我应该补充一点，它需要通过引用传递。

```
sub PrintAA
{
    my $test = shift;
    my %aa   = shift;
    print $test . "\n";
    foreach (keys %aa)
    {
        print $_ . " : " . $aa{$_} . "\n";
        $aa{$_} = $aa{$_} . "+";
    }
} 
```

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-04-29T19:20:45.830

传递引用而不是散列本身。如在

```
PrintAA("abc", \%fooHash);

sub PrintAA
{
  my $test = shift;
  my $aaRef = shift;

  print $test, "\n";
  foreach (keys %{$aaRef})
  {
    print $_, " : ", $aaRef->{$_}, "\n";
  }
} 
```

另请参阅 perlfaq7：[如何传递/返回 {Function、FileHandle、Array、Hash、Method、Regex}？](http://perldoc.perl.org/perlfaq7.html#How-can-I-pass%2freturn-a-%7bFunction%2c-FileHandle%2c-Array%2c-Hash%2c-Method%2c-Regex%7d%3f)

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-29T19:26:47.297

此代码有效：

```
#!/bin/perl -w

use strict;

sub PrintAA
{
    my($test, %aa) = @_;
    print $test . "\n";
    foreach (keys %aa)
    {
        print $_ . " : " . $aa{$_} . "\n";
    }
}

my(%hash) = ( 'aaa' => 1, 'bbb' => 'balls', 'ccc' => \&PrintAA );

PrintAA("test", %hash); 
```

关键是在函数的 my() '语句' 中使用数组上下文。

* * *

> 数组上下文业务实际上是做什么的？

简而言之，它使它正常工作。

这意味着`@_`参数数组中的第一个值分配给`$test`，其余项分配给散列`%aa`。鉴于我所说的方式， 中有奇数个项目`@_`，所以一旦第一个项目被分配给`$test`，就有偶数个项目可分配给`%aa`，每对的第一个项目是键（' aaa', 'bbb', 'ccc' 在我的例子中），第二个是相应的值。

可以用 替换`%aa`，`@aa`在这种情况下，数组中将包含 6 个项目。也可以用 替换`%aa`，`$aa`在这种情况下，变量`$aa`将包含值“aaa”，而其余的值`@_`将被赋值忽略。

如果你省略了变量列表的括号，Perl 拒绝编译代码。替代答案之一显示了符号：

```
my $test = shift;
my(%aa) = @_; 
```

这和我写的差不多；不同的是，在这两个`my`语句之后，`@_`这个变体中只包含了6个元素，而在单一`my`版本中，它仍然包含了7个元素。

[SO](https://stackoverflow.com/questions/376921/what-is-the-difference-between-the-scalar-and-list-contexts-in-perl)中肯定还有其他关于数组上下文的问题。

* * *

> 实际上，我并没有问`my($test, %aa) = @_;`我问的是`my(%hash) = ( 'aaa' => 1, 'bbb' => 'balls', 'ccc' => \&PrintAA );`vs`my %hash = { 'aaa' => 1, ... };`

不同之处在于 { ... } 表示法生成一个哈希引用，而 ( ... ) 表示法生成一个列表，该列表映射到一个哈希（与哈希引用相反）。同样， [ ... ] 生成数组 ref 而不是数组。

实际上，更改“主”代码，使其显示为： my(%hash) = { ... }; 并且您会收到运行时（但不是编译时）错误 - 谨慎对待行号，因为我已在我的文件中添加了替代编码：

```
Reference found where even-sized list expected at xx.pl line 18.
...
Use of uninitialized value in concatenation (.) or string at xx.pl line 13. 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-29T19:22:45.980

或者：

```
sub PrintAA
{
    my $test       = shift;
    my %aa         = @_;
        print $test . "\n";
        foreach (keys %aa)
        {
                print $_ . " : " . $aa{$_} . "\n";
                $aa{$_} = $aa{$_} . "+";
        }
} 
```

您从根本上缺少的是关联数组不是单个参数（尽管关联数组引用是，如 Paul Tomblin 的回答）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-29T19:22:17.137

看起来您应该传入对哈希的引用。

```
sub PrintAA
{
   my $test = shift;
   my $aa = shift;
   if (ref($aa) != "HASH") { die "bad arg!" }
   ....
}

PrintAA($foo, \%bar); 
```

你不能做的原因

```
my %aa = shift; 
```

是因为 Perl 将子例程的所有参数扁平化为一个列表，@_。每个元素都被复制，因此通过引用传递也可以避免这些副本。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-29T19:24:42.717

像往常一样，有几种方法。以下是最受推崇的样式指针*[Perl Best Practices](http://shop.oreilly.com/product/9780596001735.do)*关于将参数传递给函数的内容：

*对具有三个以上参数的任何子例程使用命名参数的散列*

但是因为你只有两个，你可以逃脱;）像这样直接传递它们：

```
my $scalar = 5;
my %hash = (a => 1, b => 2, c => 3);

func($scalar, %hash) 
```

函数定义如下：

```
sub func {
    my $scalar_var = shift;
    my %hash_var = @_;

    ... Do something ...
} 
```

如果您可以显示一些代码，它可能会更有用。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-29T19:47:16.577

以前答案中的所有方法都有效，但这始终是我喜欢做这样的事情的方式：

```
sub PrintAA ($\%)
{
    my $test       = shift;
    my %aa         = ${shift()};
    print "$test\n";
    foreach (keys %aa)
    {
        print "$_ : $aa{$_}\n";
        $aa{$_} = "$aa{$_}+";
    }
} 
```

注意：我还稍微更改了您的代码。Perl 的双引号字符串将解释`"$test"`为的值`$test`而不是实际的 string `'$test'`，因此您不需要那么多`.`s。

另外，我对原型的工作方式是错误的。要传递哈希，请使用以下命令：

```
PrintAA("test", %hash); 
```

要打印哈希引用，请使用：

```
PrintAA("test", %$ref_to_hash); 
```

当然，现在您不能修改引用的哈希，`$ref_to_hash`因为您正在发送副本，但您可以修改原始数据`%hash`，因为您将它作为引用传递。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-29T19:51:04.290

函数的参数被扁平化为单个数组 ( `@_`)。因此，通过引用将哈希传递给函数通常是最简单的。

要创建*哈希*：

```
my %myhash = ( key1 => "val1", key2 => "val2" ); 
```

要创建对该*哈希*的引用：

```
my $href = \%myhash 
```

通过引用访问该哈希；

```
%$href 
```

所以在你的潜艇：

```
my $myhref = shift;

keys %$myhref; 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-02-11T15:25:05.707

到目前为止，这里的所有其他回复对我来说似乎都相当复杂。当我编写 Perl 函数时，我通常在函数的第一行“展开”所有传递的参数。

```
sub someFunction {
    my ( $arg1, $arg2, $arg3 ) = @_; 
```

这类似于其他语言，您将函数声明为

```
... someFunction ( arg1, arg2, arg3 ) 
```

如果你这样做并将散列作为最后一个参数传递，那么没有任何技巧或特殊魔法就可以了。例如：

```
sub testFunc {
    my ( $string, %hash ) = @_;
    print "$string $hash{'abc'} $hash{'efg'} $string\n";
}

my %testHash = (
    'abc' => "Hello,",
    'efg' => "World!"
);
testFunc('!!!', %testHash); 
```

输出如预期：

```
!!! Hello, World! !!! 
```

这是有效的，因为在 Perl 中，参数总是作为标量值数组传递，如果你传递一个散列，它的键值/对被添加到该数组中。在上面的示例中，作为数组 ( ) 传递给函数的参数`@_`实际上是：

```
'!!!', 'abc', 'Hello,', 'efg', 'World!' 
```

和 '！！！' 被简单地分配给`%string`，而`%hash`“吞下”所有其他参数，总是将一个解释为键，下一个解释为值（直到所有元素都用完）。

您不能以这种方式传递多个散列，并且散列不能作为第一个参数，否则它会吞下所有内容并保留所有其他参数未分配。

当然，数组与最后一个参数完全相同。这里唯一的区别是数组不区分键和值。对他们来说，剩下的所有参数都是值，只是被推送到数组中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-29T19:49:29.710

使用以下 sub 获取哈希或 hashref - 传递的任何内容:)

```
sub get_args { ref( $_[0] ) ? shift() : ( @_ % 2 ) ? {} : {@_}; }
sub PrintAA
{
  my $test = shift;
  my $aa = get_args(@_);;

  # Then
  $aa->{somearg} # Do something
  $aa->{anotherearg} # Do something

} 
```

像这样调用你的函数：

```
printAA($firstarg,somearg=>1, anotherarg=>2) 
```

或者像这样（不管）：

```
printAA($firstarg, {somearg=>1, anotherarg=>2}) 
```

甚至像这样（无论如何）：

```
my(%hash) = ( 'aaa' => 1, 'bbb' => 'balls', 'ccc' => \PrintAA );

PrintAA("test", %hash); 
```

# emacs - Emacs：在启动时重新打开上次会话的缓冲区？

> ID：803812
> 
> 赞同：97
> 
> 时间：2009-04-29T19:09:26.530
> 
> 标签：emacs

每天我启动 emacs 并打开前一天打开的完全相同的文件。有什么我可以添加到 init.el 文件中的东西，以便它重新打开我上次退出 emacs 时使用的所有缓冲区吗？

* * *

## 回答 #1

> 赞同：127
> 
> 时间：2009-04-29T19:13:21.463

您可以使用[Emacs 桌面库](http://www.gnu.org/software/emacs/manual/html_node/emacs/Saving-Emacs-Sessions.html)：

> 您可以使用命令 Mx desktop-save 手动保存桌面。您还可以在退出 Emacs 时启用自动保存桌面，并在 Emacs 启动时自动恢复上次保存的桌面：使用自定义缓冲区（请参阅简易自定义）将 desktop-save-mode 设置为 t 以供将来的会话使用，或添加~/.emacs 文件中的这一行：
> 
> ```
>  (desktop-save-mode 1) 
> ```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-06-05T20:28:55.030

虽然我怀疑这个问题是在寻找 emacs“桌面”功能（见上面的答案），但如果一个人使用的文件集确实是完全相同的文件集，Lewap 的方法可能会很有用。事实上，如果一个人有不同的常用文件集，则可以更进一步定义“配置文件”......快速示例：

```
(let ((profile 
       (read-from-minibuffer "Choose a profile (acad,dist,lisp,comp,rpg): ")
       ))
  (cond
   ((string-match "acad" profile) 
    (dired "/home/thomp/acad")
    (dired "/home/thomp/acad/papers")
    )
   ((string-match "lisp" profile)
    (setup-slime)
    (lisp-miscellany)
    (open-lisp-dirs)
    )
   ((string-match "rpg" profile)
    (find-file "/home/thomp/comp/lisp/rp-geneval/README")
    (dired "/home/thomp/comp/lisp/rp-geneval/rp-geneval")
... etc. 
```

如果您发现您在工作时经常在不同的常用文件集之间来回切换，请考虑使用[透视图](https://github.com/nex3/perspective-el)并用所需的常用文件集填充每个透视图。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-12-04T20:29:20.383

**用于存储/恢​​复缓冲区/选项卡（特别是 elscreen 选项卡）：**我使用 elscreen，管理存储/恢复桌面会话的方式和 elscreen 选项卡配置是我的 .emacs 文件中的以下代码（使用的名称是不言自明的如果每次 emacs 启动时不应该执行存储/恢复功能，只需注释掉带有“（push #'elscreen-store kill-emacs-hook）”和“（elscreen-restore）”的行）：

```
(defvar emacs-configuration-directory
    "~/.emacs.d/"
    "The directory where the emacs configuration files are stored.")

(defvar elscreen-tab-configuration-store-filename
    (concat emacs-configuration-directory ".elscreen")
    "The file where the elscreen tab configuration is stored.")

(defun elscreen-store ()
    "Store the elscreen tab configuration."
    (interactive)
    (if (desktop-save emacs-configuration-directory)
        (with-temp-file elscreen-tab-configuration-store-filename
            (insert (prin1-to-string (elscreen-get-screen-to-name-alist))))))
(push #'elscreen-store kill-emacs-hook)
(defun elscreen-restore ()
    "Restore the elscreen tab configuration."
    (interactive)
    (if (desktop-read)
        (let ((screens (reverse
                        (read
                         (with-temp-buffer
                          (insert-file-contents elscreen-tab-configuration-store-filename)
                          (buffer-string))))))
            (while screens
                (setq screen (car (car screens)))
                (setq buffers (split-string (cdr (car screens)) ":"))
                (if (eq screen 0)
                    (switch-to-buffer (car buffers))
                    (elscreen-find-and-goto-by-buffer (car buffers) t t))
                (while (cdr buffers)
                    (switch-to-buffer-other-window (car (cdr buffers)))
                    (setq buffers (cdr buffers)))
                (setq screens (cdr screens))))))
(elscreen-restore) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-07-15T22:15:42.753

您可以对基本桌面功能进行一些有用的增强。特别方便（IMO）是在会话期间自动保存桌面的方法，否则如果您的系统崩溃，您将被困在您开始该会话的桌面文件中 - 如果您倾向于让 Emacs 运行很多次，这很烦人几天一次。

[http://www.emacswiki.org/emacs/DeskTop](http://www.emacswiki.org/emacs/DeskTop)

wiki 还提供了有关在会话之间保存数据的有用信息：

[http://www.emacswiki.org/emacs/SessionManagement](http://www.emacswiki.org/emacs/SessionManagement)

特别是对于台式机，我认为[Desktop Recover](http://www.emacswiki.org/emacs/DesktopRecover)看起来特别有前途，但是我还没有尝试过。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2011-12-03T02:27:21.910

`(find-file-noselect "/my/file")`将以静默方式打开它，即不增加缓冲区。只是说。

编辑此命令***不是****交互式*的；要对其进行测试，您必须评估表达式，例如将光标定位在最后一个括号之后并点击 Cx Ce

否决这个*并不酷*；这个命令肯定有效，并且在问题的范围内。

# ruby-on-rails - 当我需要模型关系时，如何防止错误？

> ID：803820
> 
> 赞同：1
> 
> 时间：2009-04-29T19:12:02.327
> 
> 标签：ruby-on-rails, ruby, model

我有一个应用程序，它有很多相互依赖的数据库关系才能成功操作应用程序。应用程序中的铰链是一个名为 Schedule 的模型，但该计划将拉取 Blocks、一个 Employee、一个 JobTitle 和一个 Assignment（除此之外，每个 Block 也会从数据库中拉取一个 assignment）到制定全天的员工时间表。

当我构建应用程序时，我非常重视验证，以确保在将所有内容保存到数据库之前，所有部分都必须到位。到目前为止效果非常好，该应用程序已经上线并运行了近 6 个月，每月处理大约 150,000 个请求，没有出现任何问题或错误。直到上周。

上周，当有人在更改日程安排时，看起来数据库出错了，并且日程安排已保存到数据库中，但缺少其分配。因为在每个视图中都会调用关联，所以无论何时从数据库调用此调度，应用程序都会抛出 NoMethod 错误以调用 nil。

当以我所说的方式设计应用程序时，您是否防止数据库/验证部分可能出现故障？如果是这样，您如何以编程方式防御它？在将其发送到视图之前，您是否检查了每个关系以确保它不为零？

我知道这个问题泛泛而谈，如果我能更具体地表达我的意思，请在评论中告诉我。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T19:19:02.730

我建议添加[数据库强制外键约束](http://dev.mysql.com/doc/refman/5.1/en/innodb-foreign-key-constraints.html)并将[重要的操作组包装到 transactions](http://api.rubyonrails.org/classes/ActiveRecord/Transactions/ClassMethods.html)中。

如果在某处 Schedule 和 Assignment 之间存在外键，则数据库强制外键约束将阻止错误插入。此外，如果您将特定操作包装在事务中，则可以确保插入/更新/删除的整个流发生或失败，恢复到干净状态。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-29T21:22:18.660

除了您的验证以及添加其他答案中提到的一些数据库约束之外，您还可以运行一个后台作业，该作业会定期扫描数据库以查找孤儿。

当它找到一个时，它会清理它（如果可能的话），或者删除它，或者只是将它标记为非活动状态并向你发送电子邮件，以便你以后查看。根据数据的数量和性质，每分钟一次、每小时一次、每天一次……

这样，即使您采取了任何保护措施，如果不良数据确实进入，您将早日知道它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T21:31:25.393

我将就此争论非传统的智慧。您描述的约束不属于数据库，它们属于您的 OO 代码。“数据库出错”这不是真的，毫无疑问，应用程序是插入不正确验证数据的东西。

当您开始期望数据库承担这些检查的负担时，您就是将业务规则放入模式中。至少，这使得编写单元测试变得更加困难（这可能是你一开始就应该抓住它的地方；但现在是你添加另一个测试的机会。）

理想情况下，您应该能够将 RDBMS 替换为其他一些通用数据存储，并且在适当的其他位置仍然使所有功能逻辑正确激活且未更改。UI 不应该与 DAL 对话，更不用说直接处理数据库异常了。

如果需要，您可以添加额外的数据库约束，但它应该严格作为备份。如您所见，优雅地处理数据库结构错误（尤其是涉及 UI 时）要困难得多。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-29T19:19:19.437

如果它必须是真实的才能使应用程序运行，那真的就是`assert()`s 的用途。我几乎没有使用过 Ruby，但我想它一定有这个概念。使用它们在整个代码的各个位置强制执行先决条件。结合清理和验证您的外部（用户）输入应该足以保护您。我认为，如果经过这么多检查后出现问题，您的应用程序理所当然地允许崩溃（当然，以受控方式）。

我怀疑您遇到的问题是您的数据库中的错误。更有可能在您忽略的验证中存在一些边缘情况。

# flash - 如何重新编译 Flash 项目？

> ID：803824
> 
> 赞同：0
> 
> 时间：2009-04-29T19:12:29.203
> 
> 标签：flash, actionscript-2

首先，感谢您的帮助。这是我的情况：我正在尝试编辑 Flash mp3 播放器的代码，特别是位于[http://musicplayer.sourceforge.net/](http://musicplayer.sourceforge.net/)的 xspf 音乐播放器 （我使用的是 slim 版本）。我下载了最新版本，得到了一个压缩文件，其中包含一个 .as 文件、一个 .fla 文件和一个 .swf 文件。我已经让播放器在我的网站上正常工作，我想做的是在播放器加载歌曲时插入代码以进行外部 javascript 函数调用（如此处所述： [actionscript + javascript ）。](https://stackoverflow.com/questions/757390/actionscript-javascript)我已经编辑了 .as 文件，但这并没有改变任何东西，所以我假设我需要以某种方式重新编译。我该怎么做呢？另外，我相信actionscript是2.0。

再次感谢。所有评论都很有帮助，因为我对 flash 上可用的信息量、许多不同的版本（flex、flex sdk、cs 等）和格式（.as、.fla、.swf）感到迷茫

担

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T19:18:36.710

好吧，如果您使用 Flash 打开和编辑文件，那么您需要做的是转到 File->Publish（类似的东西）。

* * *

**您的其他问题：**

Flex 用于构建富 Internet 应用程序。它有你基本的 GUI 控件和所有这些。它使用 Actionscript MXML 作为其基础语言。

Flash 更多地用于创建动画和游戏。它确实有一些预制的 GUI 组件，但它们看起来不像 Flex 那样传统。

Flash之后的“CS”是“Creative Suite”，它是Adobe产品线的一部分（包括photoshop、dreamweaver等）。“CS”是在 Adob​​e 从 Macromedia 购买 Flash 之后添加到其中的。如果您看到后面没有 CS 的任何版本的 Flash（如 flash MX），那是一个非常旧的版本。

* * *

**关于文件格式的问题：**

.as 是一个包含 Actionscript 的文件。这是 Flex 和 Flash 中使用的编程语言。

.fla 是原始电影项目文件。这包含您的所有图形资产，以及 .as 文件和其他文件。

.swf 是经过编译的电影。当您执行我告诉您的步骤时，这就是 .fla 变成的内容。这是您在线观看 Flash 视频时下载的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T19:18:20.767

在 Flash 中打开 fla 文件，然后从“文件”菜单中选择“发布”。这会将 fla 和 as 文件编译为包含您所做更改的 swf 文件。

# ruby-on-rails - ThinkingSphinx 不接受条件

> ID：803827
> 
> 赞同：0
> 
> 时间：2009-04-29T19:12:39.000
> 
> 标签：ruby-on-rails, ruby, sphinx, thinking-sphinx

我无法让 ThinkingSphinx 识别我的状况。

我的讨论模型包括以下代码：

```
define_index do
  indexes [subject, body], :as => :text
  indexes replies.body, :as => :reply_text
  set_property :delta => true
end 
```

正如预期的那样，这个搜索

```
Discussion.search "handy" 
```

返回在其主题、正文或其中一个回复的正文中包含“方便”一词的任何讨论。

现在我正在实现一个“删除帖子”功能，我只想显示字段名为 :disabled == false 的讨论。

不幸的是，这个搜索：

```
Discussion.search "handy", :conditions => { :disabled => false } 
```

无论如何，总是返回一个空数组。

为什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T02:36:44.737

您需要`disabled`在块中定义一个属性`define_index`：

```
define_index do
  indexes [subject, body], :as => :text
  indexes replies.body, :as => :reply_text

  has disabled

  set_property :delta => true
end 
```

完成此操作后，停止 Sphinx，重新索引并重新启动，希望它应该可以工作。

# configuration - 如何设置 m2eclipse 以查看 repo1.maven.org 中的原型？

> ID：803829
> 
> 赞同：1
> 
> 时间：2009-04-29T19:13:50.917
> 
> 标签：configuration, maven-2, repository, archetypes

如标题所示。我找不到 repo1.maven.org 的任何原型目录

例如，我想使用 spring-ws-archetype。我该如何设置，以便我可以在设置新 Maven 项目的选项中看到它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-03T12:12:00.620

该插件的最新版本默认安装了“Nexus Indexer”，它提供对来自 repo1.maven.org 的原型的访问。

[首选项页面 http://img134.imageshack.us/img134/1186/archetypepreferences.png](http://img134.imageshack.us/img134/1186/archetypepreferences.png) [原型选择 http://img134.imageshack.us/img134/4508/archetypeselection.png](http://img134.imageshack.us/img134/4508/archetypeselection.png)

# java - Selenium typeKeys 从正在输入的字符串中去除点

> ID：803830
> 
> 赞同：4
> 
> 时间：2009-04-29T19:13:54.100
> 
> 标签：java, eclipse, junit, selenium

以下指令

```
Selenium.typeKeys("location", "gmail.com"); 
```

键入字符串`gmailcom`而不是`gmail.com`.

那里发生了什么？

来自评论：
我正在尝试模拟自动填充，目前在 selenium 上执行此操作的唯一方法是结合 type 和 typeKeys。例如：

```
selenium.type("assigned_to", split[0]+"@");
selenium.typeKeys("assigned_to", "gmail.com"); 
```

现在我的问题是为什么 typeKeys 不在 gmail.com 之间输入“点”？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T20:24:14.133

您是否尝试过使用本机键功能和[javascript 字符代码](http://www.cambiaresearch.com/c4/702b8cd1-e5b0-42e6-83ac-25f0306e3e25/Javascript-Char-Codes-Key-Codes.aspx)？我无法使用“句点”字符（char 190）来使用它们，但我得到的小数（char 110）可以正常工作，并且文本框也不应该有问题。

```
selenium.Focus("assigned_to");
selenium.Type("assigned_to", split[0]+"@");
selenium.TypeKeys("assigned_to", "gmail");
selenium.KeyPressNative("110");
selenium.TypeKeys("assigned_to", "com"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T19:21:31.523

使用`type`方法。

来自[typekeys 的 javadoc](http://release.seleniumhq.org/selenium-remote-control/1.0-beta-2/doc/java/com/thoughtworks/selenium/Selenium.html#typeKeys(java.lang.String,%20java.lang.String))：

> 此命令可能有也可能没有任何可见效果，即使在键入键通常会产生可见效果的情况下也是如此
> 
> ...
> 
> 在某些情况下，您可能需要使用简单的“type”命令来设置字段的值，然后使用“typeKeys”命令发送与您刚刚键入的内容相对应的击键事件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-30T12:26:57.540

我们在 selenium python 中使用 typekeys 时遇到了类似的问题。

我们认为解决此问题的一种解决方法是使用“type”和“type_keys”的组合。您可能知道，type 没有这样的问题。

我们在我们的 selenium python 脚本中做到了这一点，它工作得很好。

例如：如果要在文本框中输入电子邮件地址：test.me@test.me.uk

然后做

```
type(locator,’test.me@test.me.’)
type_keys(locator,’uk’) 
```

也许是一种非常粗糙的方法，但它确实完成了工作。

希望这可以帮助其他有类似问题的人。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-07-01T06:15:23.307

假设要键入的字符串`typeKeys`是“abc.xyz.efg”。然后，我们可以使用`type`和`typeKeys`命令来写入给定的字符串。

```
type(locator,"abc.xyz.")
typeKeys(locator,"efg") 
```

当你想在下拉框中选择一个元素时，上面的两个步骤很有用，只有当我们使用 typeKeys 命令时下拉才会弹出。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-11-21T14:40:58.510

还尝试在写入元素之前将焦点放在元素上。

```
selenium.focus(locator);
selenium.typeKeys(locator, value); 
```

它在我的情况下确实起作用，处理输入类型=密码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-02T14:42:17.903

我在使用 Selenium RC (C#) 时也看到了这种行为，并且使用了不同的字符（例如，'y' 似乎也从打字动作中删除了跟随它的字符..）

在某些情况下，完全可以通过使用 TypeKeys 或 KeyPress 功能键入键来解决该问题，但是当您想在字段中键入文本时，我还没有找到一种有效的解决方案，输入控制字符（ [Enter] 或换行符），然后输入更多文本..（在这种情况下使用 'Type' 功能只会覆盖字段内容...）。

如果有人设法找到这个问题的合理解决方案，请将其添加到这个问题中，因为它现在开始出现在谷歌中，并且可能会帮助很多人......（如果可以的话，我会开始赏金......）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-09-23T15:24:30.017

这是 Selenium 中的一个开放错误（错误[SEL-519](http://jira.openqa.org/browse/SEL-519)）。

经过一番摆弄，我终于设法输入了“。” 使用 JavaScript 进入文本区域。执行类似`window.document.getElementById('assigned_to').value += '.'`via`storeEval`之类的东西。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-03-05T17:23:05.370

我得到了相同的行为，但通过将变量而不是字符串传递给 Type 命令来修复它。

```
string email = @"name@gmail.com";
selenium.Type(inputfield, email); 
```

它就像一个魅力！

# perl - 如何使用 Perl 登录 YouTube？

> ID：803832
> 
> 赞同：3
> 
> 时间：2009-04-29T19:14:58.263
> 
> 标签：perl, screen-scraping, youtube

我正在尝试编写一个 Perl 脚本来连接我的 YouTube 帐户，但它似乎不起作用。基本上我只想连接到我的帐户，但显然它不起作用。我什至不知道如何调试它！也许它与https协议有关？

请赐教！提前致谢。

```
use HTTP::Request::Common;
use LWP::UserAgent;
use strict;

my $login="test";
my $pass = "test";
my $res = "";
my $ua = "";

# Create user agent, make it look like FireFox and store cookies
$ua = LWP::UserAgent->new;
$ua->agent("Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.7.12) Gecko/20051213 Firefox/1.0.7");
$ua->cookie_jar ( {} );

# Request login page 
$res = $ua->request(GET "https://www.google.com/accounts/ServiceLogin?service=youtube&hl=en_US&passive=true&ltmpl=sso&uilel=3&continue=http%3A//www.youtube.com/signup%3Fhl%3Den_US%26warned%3D%26nomobiletemp%3D1%26next%3D/index");
die("ERROR1: GET http://www.youtube.com/login\n") unless ($res->is_success);

# Now we login with our user/pass
$res = $ua->request(
        POST "https://www.google.com/accounts/ServiceLoginAuth?service=youtube",
        Referer => "http://www.youtube.com/login",
        Content_Type => "application/x-www-form-urlencoded",
        Content => [
                currentform     => "login",
                next            => "/index",
                username        => $login,
                password        => $pass,
                action_login    => "Log+In"
        ]
        );

# YouTube redirects (302) to a new page when login is success
# and returns OK (200) if the login failed.
#die("ERROR: Login Failed\n") unless ($res->is_redirect());

print $res->content; 
```

* * *

我正在做的是学习 perl 的网络功能，所以我不想使用除 wwwlib 或 mechanize 之外的任何库来完成工作。如何使用 perl 脚本连接到我的帐户？这是我现在的目标，希望有人可以发布脚本或纠正我的。谢谢你们的帮助。我现在正在测试 Webscarab..

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-29T19:46:39.637

你想获取什么数据？为什么不只使用现有的实现，例如[`WebService::YouTube`](http://search.cpan.org/perldoc/WebService::YouTube)

对您的代码的一些评论：我总是避免使用快捷`$ua->request(GET/POST)`方法，因为我总是需要更多的灵活性，而只有使用[`HTTP::Request`](http://search.cpan.org/perldoc/HTTP::Request)和[`HTTP::Response`](http://search.cpan.org/perldoc/HTTP::Response)允许。我一直觉得这样的代码也更干净。

为什么你的代码不起作用？谁知道。确保您的 cookiejar 将您的 cookie 添加到传出的[`HTTP::Request`](http://search.cpan.org/perldoc/HTTP::Request). 我建议您在浏览器中转储所有标头并与[`libwww`](http://search.cpan.org/dist/libwww-perl/)正在发送的标头和数据进行比较。他们可能会检查一些额外的字段，这些字段因每次点击而异。他们可能正在检查您的`UserAgent`字符串。如果您只是想学习[`libwww`](http://search.cpan.org/dist/libwww-perl/)，我建议您使用不同的网站作为目标，因为我确信 YouTube 具有各种反脚本强化功能。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-29T19:56:58.833

你在使用[YouTube 的稳定文档 API](http://code.google.com/apis/youtube/2.0/reference.html)吗？

[使用WebScarab](http://www.owasp.org/index.php/Category:OWASP_WebScarab_Project)等 HTTP 代理来观察数据流。

Trey 建议使用其他人的 CPAN 包作为机制也是一个好主意。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T06:25:16.763

总的来说，您要做的是为大多数具有重定向登录的网站定义一个 cookiejar。这就是包所做的。该软件包还根据 youtube 规范调整了许多查找和抓取。

例如，Ajax 内容会很粗糙，因为在您抓取时它不存在

您刚刚选择了一个有点粗糙的页面作为开始。

享受

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-28T19:18:18.670

我自己实际上正在研究这个问题。在此之前，我建议您阅读 Google 的[API 指南](http://code.google.com/apis/youtube/2.0/developers_guide_protocol.html#Direct_uploading)作为一个很好的入门参考。如果我没看错的话，首先是通过 REST 接口传递用户凭据以获取身份验证令牌。为了解决这个问题，我正在使用以下内容：

```
sub getToken {
  my %parms = @_;
  my $response    = LWP::UserAgent->new->post(
                   'https://www.google.com/youtube/accounts/ClientLogin',
                   [
                         Email   => $parms{'username'},
                         Passwd  => $parms{'password'},
                         service => "youtube",
                         source  => "<<Your Value Here>>",                            
                   ]
    );

    my $content = $response->content;

    my ($auth) = $content =~ /^Auth=(.*)YouTubeUser(.*)$/msg
           or die "Unable to authenticate?\n";
    my ($user) = $content =~ /YouTubeUser=(.*)$/msg
            or die "Could not extract user name from response string. ";

    return ($auth, $user);
} 
```

我从我的程序的主要部分这样称呼它：

```
## Get $AuthToken
my ($AuthToken, $GoogleUserName) = getToken((
                          username => $email, password => $password
                          )); 
```

一旦我有了这两个东西——$AuthToken 和 $GoogleUserName，我仍在测试 LWP Post。我还在写这个单元：

```
sub test {

my %parms = @_;

## Copy file contents. Use, foy's three param open method. 
my $fileSize = -s $parms{'File'};
open(VideoFile, '<', "$parms{'File'}") or die "Can't open $parms{'File'}.";
binmode VideoFile;
read(VideoFile, my $fileContents, $fileSize) or die "Can't read $parms{'File'}";
close VideoFile;

my $r = LWP::UserAgent->new->post(
    "http://uploads.gdata.youtube.com/feeds/api/users/$parms{'user'}/uploads",
    [
        Host              => "uploads.gdata.youtube.com",
        'Authorization'     => "AuthSub token=\"$parms{'auth'}\"",
        'GData-Version'     => "2",
        'X-GData-Key'       => "key=$YouTubeDeveloperKey",
        'Slug'              => "$parms{'File'}",
        'Content-Type'      => "multipart/related; boundary=\"<boundary_string>\"",
        'Content-Length'    => "<content_length>",
        'video_content_type'=> "video/wmv",
        'Connection'        => "close",
        'Content'           => $fileContents
    ]

);

print Dumper(\$r->content)
} 
```

这被称为

```
&test((auth=>$Auth, user=>$user, File=>'test.wmv')); 
```

# sql-server - 在表 't_name' 上引入 FOREIGN KEY 约束 'c_name' 可能会导致循环或多个级联路径

> ID：803836
> 
> 赞同：0
> 
> 时间：2009-04-29T19:15:49.103
> 
> 标签：sql-server, foreign-keys, cascade

我有一个名为`Lesson`：
**列：** `[LessonID, LessonNumber, Description]` ...加上其他一些列的数据库表

我有另一个表名为`Lesson_ScoreBasedSelection`：
**列：** `[LessonID,NextLessonID_1,NextLessonID_2,NextLessonID_3]`

完成一堂课后，将在表中查找其 LessonID`Lesson_ScoreBasedSelection`以获得三个可能的下一课，每节课都与特定范围的分数相关联。如果分数是 0-33，将使用存储在 NextLessonID_1 中的 LessonID。如果分数是 34-66，将使用存储在 NextLessonID_2 中的 LessonID，依此类推。

我想`Lesson_ScoreBasedSelection`用引用课程表中的 LessonID 列的外键来约束表中的所有列，因为表中的每个值都`Lesson_ScoreBasedSelection`必须在课程表的 LessonID 列中有一个条目。我还希望打开级联更新，以便如果课程表中的课程 ID 发生更改，则表中对它的所有引用`Lesson_ScoreBasedSelection`都会更新。

这个特定的级联更新似乎是一个非常简单的单向更新，但是当我尝试将外键约束应用于`Lesson_ScoreBasedSelection`引用课程表中的 LessonID 字段的表中的每个字段时，我收到错误：

***在表“”上引入 FOREIGN KEY 约束“c_name”`Lesson_ScoreBasedSelection`可能会导致循环或多个级联路径。***

谁能解释我为什么会收到此错误或如何实现我描述的约束和级联更新？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T19:22:03.330

在任何给定的链接表中，您不能有多个级联 RI 链接到单个表。 [微软](http://support.microsoft.com/kb/321843)对此进行了解释：

> 您会收到此错误消息，因为在 SQL Server 中，一个表不能多次出现在由 DELETE 或 UPDATE 语句启动的所有级联引用操作的列表中。例如，级联引用操作树必须只有一个路径到级联引用操作树上的特定表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T20:07:09.620

Given the SQL Server constraint on this, why don't you solve this problem by creating a table with SelectionID (PK), LessonID, Next_LessonID, QualifyingScore as the columns. Use a constraint to ensure LessonID and QualifyingScore are unique.

In the QualifyingScore column, I'd use a tinyint, and make it 0, 1, or 2\. That, or you could do a QualifyingMinScore and QualifyingMaxScore column so you could say,

```
SELECT * FROM NextLesson 
WHERE LessonID = @MyLesson 
AND QualifyingMinScore <= @MyScore 
AND @MyScore <= QualifyingMaxScore 
```

Cheers,
Eric

# qt - 初学者 Qt 信号和插槽问题

> ID：803850
> 
> 赞同：2
> 
> 时间：2009-04-29T19:18:25.430
> 
> 标签：qt, signals-slots

我刚刚开始学习 Qt，这是我对 GUI 的第一次体验。到目前为止，它只是控制台应用程序和一些 SDL。

我对整个信号和插槽的事情感到非常困惑。我刚刚完成[教程 11](http://doc.trolltech.com/4.3/tutorial-t11.html)。当您按下射击时，射击按钮会发送一个信号，该信号连接到炮台中的插槽，用于“射击”功能。拍摄功能启动一个计时器，它每 5 毫秒发出一个信号，告诉拍摄向前移动一帧。我明白了。

我尝试放置一个 0 到 999 的 for 循环，将 i 发送到应用程序输出，这样我就可以看到发生了什么。这就是我开始感到困惑的地方。有时，它会开始打印 0、1、2、3 等，然后输入一些（比如 10）然后发射镜头，然后当镜头离开屏幕时，它会打印剩余的 999。其他时候它什么也不打印, 开枪，然后打印 0 到 999。其他时候它会打印所有内容，然后开枪。我只是在程序运行的同时观看 Qt Creator 中的输出而让自己感到困惑吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T19:56:31.283

这是基于消息循环的框架的问题，其中所有事情都在单个主线程中完成。[请在此处](https://stackoverflow.com/questions/715920/qt-qgraphicsscene-not-updating-when-i-would-expect-it-to/716119#716119)查看我对类似问题的回答。

# c# - 通用类工厂问题

> ID：803853
> 
> 赞同：5
> 
> 时间：2009-04-29T19:19:17.317
> 
> 标签：c#, oop

贝娄是我拥有的代码的简化版本：

```
public interface IControl<T>
{
    T Value { get; }
}

public class BoolControl : IControl<bool>
{
    public bool Value
    {
        get { return true; }
    }
}

public class StringControl : IControl<string>
{
    public string Value
    {
        get { return ""; }
    }
}
public class ControlFactory
{
    public IControl GetControl(string controlType)
    {
        switch (controlType)
        {
            case "Bool":
                return new BoolControl();
            case "String":
                return new StringControl();
        }
        return null;
    }
} 
```

问题出在 ControlFactory 类的 GetControl 方法中。因为它返回 IControl 而我只有 IControl<T> 是一个通用接口。我不能提供 T 因为在 Bool 情况下它将是 bool 而在 String 情况下它将是字符串。

知道我需要做什么才能使其工作吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T19:22:55.217

只是`IControl<T>`从`IControl`.

```
public interface IControl<T> : IControl
{
    T Value { get; }
} 
```

**更新**

如果我误解了您，并且您不想要非泛型接口，那么您也必须使该方法成为`GetControl()`泛型。

```
public IControl<T> GetControl<T>()
{
    if (typeof(T) == typeof(Boolean))
    {
        return new BoolControl(); // Will not compile.
    }
    else if (typeof(T) == typeof(String))
    {
        return new StringControl(); // Will not compile.
    }
    else
    {
        return null;
    }
} 
```

现在你遇到了新控件不能被隐式转换的问题，`IControl<T>`你必须明确这一点。

```
public IControl<T> GetControl<T>()
{
    if (typeof(T) == typeof(Boolean))
    {
        return new (IControl<T>)BoolControl();
    }
    else if (typeof(T) == typeof(String))
    {
        return (IControl<T>)new StringControl();
    }
    else
    {
        return null;
    }
} 
```

**更新**

将演员阵容从 更改`as IControl<T>`为`(IControl<T>)`。`as IControl<T>`这是首选，因为如果在静默返回时出现错误，它将导致异常`null`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-29T19:23:40.817

```
public IControl<T> GetControl<T>()
{
    switch (typeof(T).Name)
    {
        case "Bool":
            return (IControl<T>) new BoolControl();
        case "String":
            return (IControl<T>) new StringControl();
    }
    return null;
} 
```

更新; 更正了代码中的几个错误。这是一个获取课程的电话：

```
IControl<bool> boolControl = GetControl<bool>(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T19:28:09.150

返回类型必须是通用的，因为它是通用的。想想你将如何使用它。返回强类型对象就不需要泛型工厂方法。

就算能做到，又有什么收获

```
IControl<bool> boolControl = controlFactory.GetControl("bool"); 
```

或者，可以工作的那个，

```
IControl<bool> boolControl = controlFactory.GetControl<bool>("bool"); 
```

在特定的

```
IControl<bool> boolControl = controlFactory.GetBoolControl("bool"); 
```

无论哪种方式，您在客户端都有 switch ()。要么返回一个对象，要么有一个非类型化的 IControl 接口。

# sql - 有什么方法可以创建与 SQL Server 2005 中的视图具有相同布局的表？

> ID：803867
> 
> 赞同：1
> 
> 时间：2009-04-29T19:23:25.370
> 
> 标签：sql, sql-server-2005, view

我真的想不出最好的方式来表达这个问题，所以我只举一个例子。假设我有一个这样创建的表：

```
CREATE VIEW People
AS
    SELECT
        id, --int
        name, --varchar(20)
        birthdate --datetime
    FROM SomeTable 
```

如果我想将其从视图更改为物理表，有没有办法创建具有相同布局的表？

换句话说，我想采用该视图并创建一个像这样的表：

```
CREATE TABLE People(
    id int,
    name varchar(20),
    birtdate datetime
) 
```

...但无需手动写出该查询。

这当然是一个人为的例子。视图有很多字段，有很多不同的数据类型，所以很难手动完成。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-29T19:28:23.580

怎么样

```
SELECT * INTO MyNewTable FROM MyView 
```

如果你不想要内容，只需要结构

```
SELECT * INTO MyNewTable FROM MyView WHERE 1 = 2 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T19:26:51.243

```
SELECT *
INTO People_Table
FROM People_View 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-29T19:26:28.593

选择 * INTO PeopleTable FROM People

# identity - HiLo 还是身份？

> ID：803872
> 
> 赞同：3
> 
> 时间：2009-04-29T19:25:01.780
> 
> 标签：identity, sequence, hilo

只是想就主键获得一些意见 - 使用身份/序列号或使用 HiLo 策略（查询高值并增加应用程序本身的低值）会更好吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T19:42:17.760

如果您使用带有大型表（> 100 万行）的 SQL Server 2005/2008，您可能需要考虑[this](http://ayende.com/Blog/archive/2009/03/20/nhibernate-avoid-identity-generator-when-possible.aspx)，它链接到[this](https://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=328811)。在某些情况下，scope_identity() 和 @@identity 存在问题。

当然，围绕当前实施问题进行设计并不总是最明智的决定。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T19:31:19.377

如果您的应用程序只使用一个数据库，我会使用身份/序列。

我所看到的使用 HiLo 的唯一真正令人信服的理由是，当您可以有两个断开连接的应用程序实例，人们可以同时处理这些实例时，您需要在某个时候调和这些差异

**例如**。您正在开发一个内容管理系统，人们可以在不同位置的两台不同服务器上工作，但两者需要在某个时候同步

# c++ - 如何使用 msxml 读取 xsd:dateTime？

> ID：803874
> 
> 赞同：2
> 
> 时间：2009-04-29T19:25:23.370
> 
> 标签：c++, xml, datetime, msxml

我正在使用 msxml 来解析 xml 文件。语言是 C++。xml 文件包含一些使用 xsd:dateTime 格式的日期和时间（类似于：2009-04-29T12:00:00Z）

有没有一种简单的方法可以将 xsd:dateTime 转换为 SYSTEMTIME、FILETIME 或 VariantTime 之类的东西？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T20:32:54.033

也许这对您有帮助：[使用 strptime 在 ioncannon.net 上解析 ISO 8601 格式](http://www.ioncannon.net/cc/33/using-strptime-to-parse-iso-8601-formated-timestamps/)的时间戳。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-17T13:42:41.313

您可以使用 JavaScript：

```
<xsl:transform
id="integra-transformer"
version="1.0"
xmlns:msxsl="urn:schemas-microsoft-com:xslt"
xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
xmlns:date="urn:date-scripts">

<xsl:output method="xml" indent="yes" />

<msxsl:script 
    implements-prefix="date" 
    language="javascript">
    <![CDATA[
    Date.prototype.toISO8601ShortString = function () {
        var zeropad = function (num) { return ((num < 10) ? '0' : '') + num;  }
        var str = "";
        var date = new Date();
        str += date.getUTCFullYear();
        str += "-" + zeropad(date.getUTCMonth() + 1);
        str += "-" + zeropad(date.getUTCDate());
        str += "T" + zeropad(date.getUTCHours()) +
        ":" + zeropad(date.getUTCMinutes());
        return str;
    }

    function getToday()
    {
        var d;
        d = new Date();
        return(d.toISO8601ShortString());
    }
    ]]>
</msxsl:script>

<xsl:template match="/">
         <date>
             <xsl:value-of select="date:getToday()"/>
         </date>
     </xsl:template>
 </xsl:transform> 
```

在进行转换之前不要忘记启用脚本：

```
xslDom.setProperty("AllowXsltScript", true) 
```

# apache - 为系统密码配置apache？

> ID：803876
> 
> 赞同：0
> 
> 时间：2009-04-29T19:25:25.867
> 
> 标签：apache, configuration, authorization

我知道我可以使用 htpasswd 为 apache 创建密码文件，但是如何配置它以使用系统中的有效用户或组？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T19:30:47.820

您需要使用适当的身份验证模块。这是一个示例`mod_authnz_external`：[http ://blog.innerewut.de/2007/6/26/apache-2-2-authentication-with-mod_authnz_external](http://blog.innerewut.de/2007/6/26/apache-2-2-authentication-with-mod_authnz_external)

# c# - C# IEnumerator/yield 结构可能不好？

> ID：803878
> 
> 赞同：33
> 
> 时间：2009-04-29T19:25:51.387
> 
> 标签：c#, .net, database, resources, yield

背景：我有一堆从数据库中获取的字符串，我想返回它们。传统上，它会是这样的：

```
public List<string> GetStuff(string connectionString)
{
    List<string> categoryList = new List<string>();
    using (SqlConnection sqlConnection = new SqlConnection(connectionString))
    {
        string commandText = "GetStuff";
        using (SqlCommand sqlCommand = new SqlCommand(commandText, sqlConnection))
        {
            sqlCommand.CommandType = CommandType.StoredProcedure;

            sqlConnection.Open();
            SqlDataReader sqlDataReader = sqlCommand.ExecuteReader();
            while (sqlDataReader.Read())
            {
                categoryList.Add(sqlDataReader["myImportantColumn"].ToString());
            }
        }
    }
    return categoryList;
} 
```

但是后来我认为消费者会想要遍历这些项目并且不关心其他太多，而且我不想将自己装进一个列表本身，所以如果我返回一个 IEnumerable 一切都很好/灵活的。所以我在想我可以使用“收益回报”类型的设计来处理这个......就像这样：

```
public IEnumerable<string> GetStuff(string connectionString)
{
    using (SqlConnection sqlConnection = new SqlConnection(connectionString))
    {
        string commandText = "GetStuff";
        using (SqlCommand sqlCommand = new SqlCommand(commandText, sqlConnection))
        {
            sqlCommand.CommandType = CommandType.StoredProcedure;

            sqlConnection.Open();
            SqlDataReader sqlDataReader = sqlCommand.ExecuteReader();
            while (sqlDataReader.Read())
            {
                yield return sqlDataReader["myImportantColumn"].ToString();
            }
        }
    }
} 
```

但是现在我正在阅读更多关于产量的内容（在这样的网站上......msdn 似乎没有提到这一点），它显然是一个懒惰的评估器，它保持填充器的状态，期待有人问下一个值，然后只运行它直到它返回下一个值。

在大多数情况下这似乎很好，但是使用数据库调用，这听起来有点冒险。作为一个有点人为的例子，如果有人从我从数据库调用中填充的 IEnumerable 中请求一个 IEnumerable，通过它的一半，然后陷入循环......据我所知，我的数据库连接正在进行永远保持开放。

如果迭代器没有完成，在某些情况下听起来像是自找麻烦……我错过了什么吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-04-29T19:36:29.850

这是一种平衡行为：您是想立即强制所有数据进入内存以便释放连接，还是想从流式传输数据中受益，但代价是一直占用连接？

在我看来，这个决定应该取决于调用者，他们更了解他们想要做什么。如果您使用迭代器块编写代码，调用者可以*非常*轻松地将流形式转换为完全缓冲的形式：

```
List<string> stuff = new List<string>(GetStuff(connectionString)); 
```

另一方面，如果您自己进行缓冲，则调用者无法返回到流模型。

所以我可能会使用流模型并在文档中*明确*说明它的作用，并建议调用者做出适当的决定。您甚至可能想提供一个辅助方法来基本上调用流版本并将其转换为列表。

当然，如果您不相信您的调用者会做出适当的决定，并且您有充分的理由相信他们永远不会真正想要流式传输数据（例如，无论如何它永远不会返回太多），那么请选择列表方法。无论哪种方式，记录它 - 它很可能会影响返回值的使用方式。

处理大量数据的另一种选择当然是使用批处理——这与最初的问题有些不同，但在流式传输通常很有吸引力的情况下，这是一种不同的考虑方法。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-29T19:48:33.143

IEnumerable 并不总是不安全的。如果你离开框架调用`GetEnumerator`（这是大多数人会做的），那么你是安全的。基本上，你和使用你的方法的代码一样安全：

```
class Program
{
    static void Main(string[] args)
    {
        // safe
        var firstOnly = GetList().First();

        // safe
        foreach (var item in GetList())
        {
            if(item == "2")
                break;
        }

        // safe
        using (var enumerator = GetList().GetEnumerator())
        {
            for (int i = 0; i < 2; i++)
            {
                enumerator.MoveNext();
            }
        }

        // unsafe
        var enumerator2 = GetList().GetEnumerator();

        for (int i = 0; i < 2; i++)
        {
            enumerator2.MoveNext();
        }
    }

    static IEnumerable<string> GetList()
    {
        using (new Test())
        {
            yield return "1";
            yield return "2";
            yield return "3";
        }
    }

}

class Test : IDisposable
{
    public void Dispose()
    {
        Console.WriteLine("dispose called");
    }
} 
```

您是否可以将数据库连接保持打开状态也取决于您的体系结构。如果调用者参与事务（并且您的连接是自动登记的），那么框架无论如何都会保持连接打开。

另一个优点`yield`是（使用服务器端游标时），如果您的消费者想要更早地退出循环（例如：在第 10 项）。这可以加快查询数据的速度。尤其是在 Oracle 环境中，服务器端游标是检索数据的常用方法。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-29T19:28:20.540

你没有错过任何东西。您的示例显示了如何不使用收益回报。将项目添加到列表中，关闭连接并返回列表。您的方法签名仍然可以返回 IEnumerable。

**编辑：**也就是说，Jon 有一个观点（太惊讶了！）：从性能的角度来看，流媒体实际上是最好的事情。毕竟，如果我们在这里讨论的是 100,000 行（1,000,000？10,000,000？）行，您不希望先将它们全部加载到内存中。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-30T04:17:08.367

顺便说一句- 请注意，该`IEnumerable<T>`方法*本质上*是 LINQ 提供程序（LINQ-to-SQL、LINQ-to-Entities）的谋生手段。正如乔恩所说，这种方法具有优势。然而，也存在一定的问题——尤其是（对我而言）在（组合）分离方面 | 抽象。

我的意思是：

*   在 MVC 场景中（例如），您希望您的“获取数据”步骤*实际获取数据*，以便您可以测试它在*控制器*上的工作，而不是*视图*（无需记住调用`.ToList()`等）
*   您不能保证另一个 DAL 实现将*能够*流式传输数据（例如，POX/WSE/SOAP 调用通常不能流式传输记录）；并且您不一定要使行为令人困惑地不同（即在迭代期间连接仍然打开一个实现，而关闭另一个实现）

这与我在这里的想法有点联系：[Pragmatic LINQ](http://marcgravell.blogspot.com/2009/02/pragmatic-linq.html)。

但我应该强调——在某些时候流媒体是非常受欢迎的。这不是一个简单的“总是与从不”的事情......

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-09-23T22:19:09.303

强制评估迭代器的更简洁的方法：

```
using System.Linq;

//...

var stuff = GetStuff(connectionString).ToList(); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-29T21:19:31.350

这会导致问题的唯一方法是调用者滥用`IEnumerable<T>`. 使用它的正确方法是`Dispose`在不再需要它时调用它。

生成的实现`yield return`将`Dispose`调用作为执行任何打开`finally`块的信号，在您的示例中，它将调用`Dispose`您在`using`语句中创建的对象。

有许多语言特性（特别是`foreach`）使其非常容易`IEnumerable<T>`正确使用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-29T19:29:00.913

不，你走在正确的道路上......产量将锁定读者......你可以在调用 IEnumerable 时测试它做另一个数据库调用

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-21T20:21:14.747

您总是可以使用单独的线程来缓冲数据（可能是队列），同时也可以使用 yield 来返回数据。当用户请求数据（通过 yield 返回）时，从队列中删除一个项目。数据也通过单独的线程不断地添加到队列中。这样，如果用户请求数据的速度足够快，队列永远不会很满，您不必担心内存问题。如果他们不这样做，那么队列将填满，这可能还不错。如果您想对内存施加某种限制，则可以强制执行最大队列大小（此时另一个线程将等待项目被删除，然后再将更多项目添加到队列中）。自然，您会希望确保在两个线程之间正确处理资源（即队列）。

作为替代方案，您可以强制用户传入一个布尔值以指示是否应缓冲数据。如果为真，则缓冲数据并尽快关闭连接。如果为 false，则不会缓冲数据，并且只要用户需要，数据库连接就会保持打开状态。拥有一个布尔参数会强制用户做出选择，从而确保他们了解问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-29T19:37:14.543

我曾几次撞到这堵墙。SQL 数据库查询不像文件那样容易流式传输。相反，只查询您认为需要的数量，并将其作为您想要的任何容器（`IList<>`、`DataTable`等）返回。 `IEnumerable`在这里帮不了你。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-04-29T19:39:20.357

您可以做的是改用 SqlDataAdapter 并填充 DataTable。像这样的东西：

```
public IEnumerable<string> GetStuff(string connectionString)
{
    DataTable table = new DataTable();
    using (SqlConnection sqlConnection = new SqlConnection(connectionString))
    {
        string commandText = "GetStuff";
        using (SqlCommand sqlCommand = new SqlCommand(commandText, sqlConnection))
        {
            sqlCommand.CommandType = CommandType.StoredProcedure;
            SqlDataAdapter dataAdapter = new SqlDataAdapter(sqlCommand);
            dataAdapter.Fill(table);
        }

    }
    foreach(DataRow row in table.Rows)
    {
        yield return row["myImportantColumn"].ToString();
    }
} 
```

这样，您可以一次性查询所有内容，并立即关闭连接，但您仍然在懒惰地迭代结果。此外，此方法的调用者不能将结果转换为 List 并做他们不应该做的事情。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2009-04-29T19:29:26.840

不要在这里使用产量。你的样品很好。

# c# - 丢失数据上下文的附加集合项

> ID：803886
> 
> 赞同：3
> 
> 时间：2009-04-29T19:26:51.837
> 
> 标签：c#, wpf, data-binding, xaml, attached-properties

我创建了一个附加属性 AttachedBehaviorsManager.Behaviors，它将用作将事件与命令联系起来的 MVVM 帮助器类。该属性属于 BehaviorCollection 类型（ObservableCollection 的包装器）。我的问题是行为命令的绑定总是最终为空。当在按钮上使用时，它工作得很好。

我的问题是为什么我在集合内的项目上丢失了我的 DataContext，我该如何解决？

```
<UserControl x:Class="SimpleMVVM.View.MyControlWithButtons"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:behaviors="clr-namespace:SimpleMVVM.Behaviors"
             xmlns:con="clr-namespace:SimpleMVVM.Converters"
Height="300" Width="300">
<StackPanel>
        <Button Height="20" Command="{Binding Path=SetTextCommand}" CommandParameter="A" Content="Button A" />
     <Button Height="20" Command="{Binding Path=SetTextCommand}" CommandParameter="B" Content="Button B"/>
    <TextBox x:Name="tb" Text="{Binding Path=LabelText}">
        <behaviors:AttachedBehaviorsManager.Behaviors>
            <behaviors:BehaviorCollection>
                <behaviors:Behavior Command="{Binding Path=SetTextCommand}" CommandParameter="A" EventName="GotFocus"/>
            </behaviors:BehaviorCollection>
        </behaviors:AttachedBehaviorsManager.Behaviors>
    </TextBox>
</StackPanel> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-05T18:30:16.680

为什么要绑定命令？命令旨在以这种方式设置：

```
<Button Command="ApplicationCommands.Open"/> 
```

假设您像这样定义一个命令类：

```
namespace SimpleMVVM.Behaviors {
    public static class SimpleMvvmCommands {
        public static RoutedUICommand SetTextCommand { get; }
    }
} 
```

你会像这样使用它：

```
<Button Command="behaviors:SimpleMvvmCommands.SetTextCommand"/> 
```

MVVM 模式不适用于您使用它的方式。您将命令处理程序放在 VM 上，但命令本身应该位于静态上下文中。有关详细信息，请参阅[MSDN 上的文档](http://msdn.microsoft.com/en-us/library/ms752308.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T20:18:35.133

您绑定到命令，因为它使用 MVVM ( [Model-View-ViewModel](http://msdn.microsoft.com/en-us/magazine/dd419663.aspx) ) 模式。此用户控件的数据上下文是一个 ViewModel 对象，其中包含一个公开命令的属性。命令不需要是公共静态对象。

所示代码中的按钮执行没有问题。它们绑定到视图模型中的 SetTextCommand：

```
class MyControlViewModel : ViewModelBase
{
    ICommand setTextCommand;
    string labelText;

    public ICommand SetTextCommand
    {
        get
        {
            if (setTextCommand == null)
                setTextCommand = new RelayCommand(x => setText((string)x));
            return setTextCommand;
        }
    }
    //LabelText Property Code...

    void setText(string text)
    {
        LabelText = "You clicked: " + text;
    }
} 
```

问题是在行为中无法识别与按钮中工作的相同 SetTextCommand 的绑定：行为。

# safari - 当用户在 Safari/Chrome 中关闭窗口时，我可以弹出一个确认对话框吗？

> ID：803887
> 
> 赞同：6
> 
> 时间：2009-04-29T19:27:12.803
> 
> 标签：safari, google-chrome, onbeforeunload, onunload

在 IE 和 FF 中，我可以将事件处理程序附加到 onBeforeUnload，并通过将字符串传递给事件的属性，用户将看到一个对话框，询问他是否要继续“卸载”（关闭窗口或导航离开）。

Safari 和 Chrome 不支持 onBeforeUnload，onUnload 似乎为时已晚。有没有办法在 Safari/Chrome 中复制相同的功能？

注意：我不是想把用户当作人质。我知道这是唠叨和不酷。事实上，我的网站竭尽全力让用户自由活动，并在他们回来时将所有东西都放在原处。但是，我在 IFrame 中托管其他网站，有时这些网站决定摆脱我并接管浏览器，这是我试图避免的。

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-29T20:00:40.413

这在 Chrome 和 Safari 中都非常适合我：

```
<html><body><p>Test</p>
<script>window.onbeforeunload = function() { return "Sure?"; }</script>
</body></html> 
```

当我尝试关闭窗口时，我得到了提示。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T20:23:20.610

StackOverflow 本身使用`onbeforeunload`，它在 Safari 中对我来说很好用：

```
function setConfirmUnload(a){window.onbeforeunload=a?function(){return a}:null} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-12-09T14:02:20.333

我在 chrome 中检查了它，使用它似乎工作正常：

```
<body onunload="alert('x');" onbeforeunload="test1();"> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-10-18T18:18:42.147

这个问题在另一个较新的 StackOverFlow 问题中有更详细的介绍： [Setting onbeforeunload on body element in Chrome and IE using jQuery](https://stackoverflow.com/questions/1802930/setting-onbeforeunload-on-body-element-in-chrome-and-ie-using-jquery)

# .net - 使用带有 ByRef 参数的 NMock

> ID：803890
> 
> 赞同：0
> 
> 时间：2009-04-29T19:28:18.013
> 
> 标签：.net, vb.net, nmock

我必须使用使用大量引用参数的 API。我刚刚开始使用 NMock，但我无法看到如何让 NMock 实际将这些 by-ref 参数之一修改为特定值。我错过了什么，还是只是没有这样做？有没有更好的方法，没有包装这个 API？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T19:30:34.450

[诚然，从 C# 的角度来看，这篇博文](http://blog.somecreativity.com/2008/11/17/nmock-expectations-for-functions-accepting-ref-and-out-arguments/)似乎涵盖了一些内容。

基本上你想`Will()`用`SetNamedParameterAction`.

# project-management - PivotalTracker 最佳实践

> ID：803895
> 
> 赞同：4
> 
> 时间：2009-04-29T19:29:01.537
> 
> 标签：project-management, agile, pivotaltracker

（对于那些没有听说过的人，[Pivotal Tracker](http://www.pivotaltracker.com/help/gettingstarted) “是一个简单的、基于故事的项目规划工具，它允许团队协作并立即对现实世界的变化做出反应。它基于敏捷软件开发方法，但它可以用于各种类型的项目。”）

我们将围绕[Rein Henrichs 的这个大纲](http://reinh.com/blog/2009/03/02/a-git-workflow-for-agile-teams.html)构建一个工作流，并且对如何将产品组件分解为项目感到好奇。

我们已经尝试了一些标签，但似乎如果系统中有很多组件（照片查看器、视频查看器、新闻提要、通知服务），单个项目可能会变得非常拥挤。

同时，对于版本控制等，似乎将所有这些都放在一个项目中可能更有意义，而不管杂乱无章。

有什么想法吗？意见？注释？谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T22:36:16.910

请记住，Tracker 是基于故事的计划工具，而不是基于任务的计划工具。从客户的角度来看，故事是否影响照片查看器、通知服务或两者都无关紧要。客户有一些他们想要实施的故事（高级需求），他们对故事的成本有估计，并且他们有能力确定故事的优先级。将事物分解成组件是一个任务级别的问题。

更重要的是，将同一产品的故事分解为多个跟踪器项目会使客户难以沟通他们如何优先考虑故事，或者很难准确估计故事何时可能完成。

我们使用 Tracker 来跟踪我们的故事，并且我们有自己的板来跟踪任务。我个人认为在 Tracker 中同时跟踪故事和任务会很有用，但该工具不支持它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-03T05:07:26.813

最好有一个项目来包含您的所有故事。这样，整个团队就可以在一个地方查看项目的进展情况以及当前的优先事项是什么。如果你的故事足够分解，它们可以成为 Rein 过程中的特征，那么你的状态就很好！归根结底，任何开发团队真正需要的只是一个优先的功能列表。使用 Tracker 中的标签进行过滤。他们工作得很好。在我看来，将单个产品分解为多个相互依赖的项目实际上会掩盖信息，并使了解项目的真实状态变得更加困难。

# ssl - SMTP 客户端如何确定是使用显式 SSL 还是隐式 SSL

> ID：803899
> 
> 赞同：5
> 
> 时间：2009-04-29T19:29:40.833
> 
> 标签：ssl, smtp, imap, pop3

大多数支持 SSL/TLS 的邮件客户端只需要用户说明是否应该启用 SSL。用户不必知道任何关于显式和隐式 SSL 以及它们之间的区别。

那么，邮件客户端如何确定使用哪种类型的 SSL？它是否基于默认端口号？它只是尝试一个然后另一个？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T19:36:46.040

邮件客户端在连接时必须知道是否使用了隐式 SSL，因为它负责使用`ClientHello`消息启动 SSL 握手。如何确定这取决于客户。端口号是一个很好的提示，但在某些 UI 中也可能有一个复选框，即使使用标准（未受保护的）端口号也会强制使用它。

有用于安全邮件的 IANA 注册端口号，但一些 ISP 可能使用其他端口。

*   IMAP/SSL：993
*   POP3/SSL：995

SMTP/SSL 通常在端口 465 上提供，但这没有注册，并且不太常见，因为 SMTP 代理广泛支持显式 SSL。

服务器可以使用特定于协议的协商来通告对显式 SSL 的支持。例如，当客户端连接到 SMTP 服务器并发出 EHLO 命令时，服务器将列出其功能，其中可能包括对 STARTTLS 命令的支持。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-03-23T22:12:18.903

端口 465 在商业邮件服务器中非常常见，并且经常使用。大多数情况下，它用于隐式 SSL。当您远程登录到此端口时，您将获得超时，因为您必须先设置 SSL 连接，然后才能与邮件服务器通信。因此，超时可能是您拥有隐式 SSL 连接的第一个线索。您不能使用 EHLO 来返回结果，因为除了 SSL 连接之外不允许任何连接。并且不，您不只是连接到运行隐式 SSL 的 SMTP 服务器，它不会响应并且只会断开连接。这就是它应该做的。显式 SSL 将首先允许连接，然后设置 SSL。是的，经常使用隐式 SSL。缺点是 RFC 标准并没有具体说明它是如何实现的，因此不同的开发人员以不同的方式设置它，

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T19:32:56.317

我相信大多数支持 SMTP over SSL 的客户端都是从未加密的连接开始的，然后发出 EHLO 而不是 HELO。前者有额外的标志响应，其中一个指示服务器是否支持 STARTTLS 命令。如果他们这样做，那么客户端可以使用 STARTTLS，然后从那时起使用 SSL。

例子：

```
% telnet quack.kfu.com 25
220 quack.kfu.com ESMTP ready NO UCE
EHLO client
250-quack.kfu.com Hello client [xx.xx.xx.xx] (may be forged), pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE 25000000
250-ETRN
250-AUTH PLAIN LOGIN
250-STARTTLS
250-DELIVERBY
250 HELP
starttls
220 2.0.0 Ready to start TLS 
```

# linux - 如何在 Linux 中从 TestTrack 测试用例管理器运行测试脚本？

> ID：803900
> 
> 赞同：2
> 
> 时间：2009-04-29T19:29:58.570
> 
> 标签：linux, perl, testtrack

我在 Linux 下使用 Seapine 的 TestTrack 测试用例管理器 (TCM)，到目前为止，我一直无法弄清楚如何使用它来启动我们的 Perl 测试脚本并将结果数据保存到测试运行中。有人可以为我提供配置或示例吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-07T12:34:14.647

肖恩，

看看我们[实验室网站](http://labs.seapine.com/TCMScriptAgent.php)上的脚本代理机制。这将允许您启动 Perl 脚本。

如果您对此有任何疑问，或者需要帮助，请给我发电子邮件 (mharp@)，我们可以谈谈。

# database - DB / Entity Design：与多个表中的任何一个相关的表

> ID：803905
> 
> 赞同：3
> 
> 时间：2009-04-29T19:31:17.850
> 
> 标签：database, entity-framework, database-design, orm, domain-driven-design

一个**报告**可以有多个图表。**图表**表如下所示：

*   **图表**- *Id* , *ChartId* , *ReportId* , ...

上面的*ChartId*可以映射到*ChartId*到以下任**一**图表类型：

*   **线**：*ChartId*，*厚度*，*YAxis*，*XAxis*，*颜色*，...
*   **饼图**：*ChartId*，*半径*，*颜色*，...
*   **Bar** : *ChartId* , *Width* , *Color* , *Border* , ...

我正在使用 SQL Server，不幸的是，使用 CouchDB 等替代解决方案不是可行的选择。我还打算使用实体框架将这些表映射到实体。

这个设计是我的第一次尝试，我发现这个设计存在多个问题：

1.  **图表**。*ReportId*不能是多个表上的外键，因此强制执行 FK 是一个问题。
2.  运行 SQL（或 Linq）查询时，我必须运行两个查询以获取图表类型，然后查询该表。或者，我必须对所有表运行**连接**以获取图表数据。
3.  在对图表类型进行连接时，这些表中的*ChartId*需要是唯一的，因此**Chart**。*ChartId*仅映射到**Line**之一。*ChartId*或**Bar**。*ChartId*或**Pie**。*图表 ID*。
4.  用 EF 映射它会很棘手。

我想这是一个足够普遍的问题，有规定的解决方案和既定的方法来处理它。

我在设计的正确道路上吗？如果是这样，如何克服上述问题（FK、连接、跨多个表的唯一 ID 和映射）。

## 解决方案

这个[答案](https://stackoverflow.com/questions/695752/product-table-many-kinds-of-product-each-product-has-many-parameters/695860#695860)对策略非常全面。SQL Team关​​于[在 SQL Server 中实现表继承](http://www.sqlteam.com/article/implementing-table-inheritance-in-sql-server)的文章让我得到了想要的结果。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T19:36:22.330

您是否考虑过将图表放在同一个表中并使用[每个层次结构继承](http://msdn.microsoft.com/en-us/library/bb738443.aspx)模式的表？那里的链接显示了如何在实体框架中实现这一点。它是否可行取决于所有这些图表类型的差异以及每种图表类型需要多少字段。

[每个类型](http://msdn.microsoft.com/en-us/library/bb738685.aspx)继承还有一个表，它与您已经描述的更相似。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T19:46:12.370

我会用一个表继承方案来解决这个问题：

```
Chart (ChartId, ChartTypeId)
   PK (ChartId, ChartTypeId)
   CHECK ChartTypeId IN ('Line', 'Bar', 'Pie')

LineChart (ChartId, ChartTypeId)
   PK (ChartId, ChartTypeId)
   FK (ChartId, ChartTypeId) -> Chart
   CHECK ChartTypeId IN ('Line') 
```

要添加图表，首先添加到“基本”图表表，然后添加到相应的“子类型”图表表。检查约束使一切保持一致。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-01T03:25:18.323

折线图。饼图和条形图是图表的特殊形式。

查找“泛化专业化关系建模”以获取有关此模式的好文章。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T19:34:47.810

> 或者，我必须对所有表运行连接以获取图表数据。

是的，这很好。

# apache - 无法开始使用 mod_rewrite

> ID：803915
> 
> 赞同：3
> 
> 时间：2009-04-29T19:34:27.997
> 
> 标签：apache, mod-rewrite

我过去曾成功地在我控制有限的 apache 服务器上复制/编辑/粘贴重写规则。

然而，现在我正在试验一个 Apache 服务器，我可以重新启动它并根据我的内心进行配置，但我什至无法让一个基本的重写示例工作，而且那是在我阅读了至少两个教程之后。我玩过 LogLevel 和 RewriteLog 但我找不到真正的证据表明我的基本重写规则正在被使用。我的重写日志文件已创建但它是空的。我还尝试从 httpd.conf 中注释掉所有东西，但重写的东西。

让我们看看我可以添加哪些其他信息：

```
chilcott:/etc/apache2/conf.d# uname -a
Linux chilcott 2.6.26-1-486 #1 Sat Jan 10 17:46:23 UTC 2009 i686 GNU/Linux

chilcott:/etc/apache2/conf.d# apache2ctl -V
服务器版本：Apache/2.2.9 (Debian)
服务器搭建：2009年1月20日17:29:25
服务器模块幻数：20051115:15
服务器加载：APR 1.2.12，APR-Util 1.2.12
编译使用：APR 1.2.12、APR-Util 1.2.12
架构：32 位
服务器 MPM：Prefork
  螺纹：没有
    分叉：是（可变进程计数）
服务器编译...
 -D APACHE_MPM_DIR="服务器/mpm/prefork"
 -D APR_HAS_SENDFILE
 -D APR_HAS_MMAP
 -D APR_HAVE_IPV6（启用 IPv4 映射地址）
 -D APR_USE_SYSVSEM_SERIALIZE
 -D APR_USE_PTHREAD_SERIALIZE
 -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
 -D APR_HAS_OTHER_CHILD
 -D AP_HAVE_RELIABLE_PIPED_LOGS
 -D DYNAMIC_MODULE_LIMIT=128
 -D HTTPD_ROOT=""
 -D SUEXEC_BIN="/usr/lib/apache2/suexec"
 -D DEFAULT_PIDLOG="/var/run/apache2.pid"
 -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
 -D DEFAULT_LOCKFILE="/var/run/apache2/accept.lock"
 -D DEFAULT_ERRORLOG="日志/错误日志"
 -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
 -D SERVER_CONFIG_FILE="/etc/apache2/apache2.conf"

```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T19:42:09.210

在 httpd.conf 的右侧部分下是否有重写规则？他们可能应该在虚拟主机部分。

发布您的 httpd.conf（或至少其中一些）可能会有所帮助。

它应该看起来像这样：

```
LoadModule rewrite_module modules/mod_rewrite.so

RewriteLogLevel 9
RewriteLog ".....rewrite.log"

<VirtualHost *:80>
    DocumentRoot "..."

    RewriteEngine On
    RewriteRule ^/foo /bar
</VirtualHost> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T19:48:39.057

您需要加载模块才能使用它。`#`查看您的 httpd.conf 文件中的以下行，如果有，请删除前导注释字符：

```
#LoadModule rewrite_module modules/mod_rewrite.so 
```

然后你只需要重启你的 Apache 服务器。

# git - git：突然不能push，或者clone，什么的

> ID：803917
> 
> 赞同：3
> 
> 时间：2009-04-29T19:34:54.830
> 
> 标签：git, github

出乎意料的是，我无法使用 git 推送、克隆或拉取。

我以前一直推送成功。我不记得做过什么不寻常的事情，但今天它停止了工作。（我在 XP 上使用 git-gui。）每当我尝试推送时，程序都会等待 4 分钟，然后给我这个：

```
FATAL ERROR: Server unexpectedly closed network connection
Pushing to git@github.com:cool-RR/physicsthing.git
fatal: The remote end hung up unexpectedly 
```

我尝试重新安装 git-gui，没有帮助。我试图从 github 将我的 repo 克隆到一个单独的文件夹中，得到了类似的消息。选美比赛已经装满了我的钥匙。我试过换个新钥匙，没用。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T19:36:26.930

前几天这件事发生在我身上。这是因为 GitHub 短暂地宕机了。几分钟后我又推了一次，没问题。

# iphone - 是否可以在 iPhone 设置包中添加信息或帮助文本？

> ID：803918
> 
> 赞同：27
> 
> 时间：2009-04-29T19:34:58.463
> 
> 标签：iphone, settings, plist, settings.bundle

一些 Apple 提供的应用程序在其设置中包含信息/帮助文本。例如，键盘设置屏幕的*“.”下方包括 快捷方式*切换，帮助文本“双击空格键将...”。

我知道我可以通过添加组页脚在我的应用程序中执行此操作，但是是否可以通过在我的 Settings.bundle 中的 plist 文件中添加一个字段来在设置应用程序中执行此操作？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2010-07-07T03:58:40.847

根据最近更改的 Apple 文档，在 PSGroupSpecifier 字典中提供了 FooterText 键，该键仅在 iOS 4.0 或更高版本中可用。

参考： [https ://developer.apple.com/library/content/documentation/PreferenceSettings/Conceptual/SettingsApplicationSchemaReference/Articles/PSGroupSpecifier.html](https://developer.apple.com/library/content/documentation/PreferenceSettings/Conceptual/SettingsApplicationSchemaReference/Articles/PSGroupSpecifier.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-08T10:39:32.107

我这样做的方式，以及我看到其他第三方应用程序这样做的方式只是使用信息标题作为 PSGroupSpecifier

我只看到本地 Apple 应用程序以另一种稍微好一点的方式做到这一点。我希望这种能力深埋在 SDK 的未记录区域中。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-12-18T11:28:19.563

在 PSGroupSpecifier 中使用 FooterText 键是您需要使用的。它被记录为*xesique*已经说过的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-02-20T10:35:38.357

请注意，“FooterText”键未内置在作为 Xcode 一部分的 Settings Scheme / plist 编辑器的弹出菜单中。当您选择“组”并键入键盘返回或按加号图标时，您将看到“新项目”、“类型”或“标题”的选择。您需要手动编辑此键值。然后您作为关联字符串输入的文本将显示为灰色文本（而不是用于组成员的黑色文本），并保持其大写/小写。

# wpf - 使用按钮导航到 NavigationWindow 中的另一个页面

> ID：803921
> 
> 赞同：6
> 
> 时间：2009-04-29T19:36:05.217
> 
> 标签：wpf, button, navigationwindow

我正在尝试使用 WPF 中的导航命令框架在 WPF 应用程序（桌面；不是 XBAP 或 Silverlight）中的页面之间导航。

我相信我已经正确配置了所有内容，但它无法正常工作。我构建并运行没有错误，我在输出窗口中没有收到任何绑定错误，但我的导航按钮被禁用。

这是示例应用程序的 app.xaml：

```
<Application x:Class="Navigation.App"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    StartupUri="First.xaml">
</Application> 
```

请注意 StartupUri 指向 First.xaml。First.xaml 是一个页面。WPF 会自动在 NavigationWindow 中托管我的页面。这是 First.xaml：

```
<Page x:Class="Navigation.First"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="First">
    <Grid>
        <Button 
            CommandParameter="/Second.xaml" 
            CommandTarget="{Binding RelativeSource=
                {RelativeSource 
                    FindAncestor, 
                    AncestorType={x:Type NavigationWindow}}}" 
            Command="NavigationCommands.GoToPage" 
            Content="Go!"/>
    </Grid>
</Page> 
```

按钮的 CommandTarget 设置为 NavigationWindow。命令是 GoToPage，页面是 /Second.xaml。我尝试将 CommandTarget 设置为包含页面，将 CommandParameter 设置为“Second.xaml”（First.xaml 和 Second.xaml 都在解决方案的根目录中），并且我尝试将 CommandTarget 留空。我还尝试将绑定路径设置为 NavigationWindow 上与导航相关的各种公共属性。到目前为止没有任何效果。

我在这里想念什么？我*真的*不想在代码中进行导航。

* * *

澄清。

如果我不使用按钮，而是使用超链接：

```
<Grid>
    <TextBlock>
       <Hyperlink 
           NavigateUri="Second.xaml">Go!
       </Hyperlink>
    </TextBlock>
</Grid> 
```

一切都按预期工作。但是，我的 UI 要求意味着使用超链接是正确的。我需要一个胖乎乎的大按钮供人们按下。这就是我想使用按钮导航的原因。我只想知道如何让 Button 提供与 Hyperlink 在这种情况下相同的功能。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T19:44:19.020

根据[文档](http://msdn.microsoft.com/en-us/library/system.windows.input.navigationcommands.gotopage.aspx)`DocumentViewer`，仅`FlowDocumentViewer`具体执行此命令。您需要找到一个用于实现的导航命令，或者为此命令`NavigationWindow`设置一个并自行处理。`CommandBinding`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-05-07T19:32:42.603

在 XAML 中：

```
<Button Command="{x:Static Views:Commands.NavigateHelp}" Content="Help"/> 
```

在视图中（我们有一个`Commands.cs`包含所有这些的文件）：

```
public static RoutedCommand NavigateHelp = new RoutedCommand(); 
```

在 Page 构造函数中，您可以将两者连接起来：

```
CommandBindings.Add(new CommandBinding(Commands.NavigateHelp, NavigateHelpExecute)); 
```

NavigateHelpExecute 可以在后面的代码中（这就是我们所做的），挂钩到 ViewModel 事件处理程序，或其他任何东西。这样做的好处是您可以像这样禁用其他导航：

```
CommandBindings.Add(new CommandBinding(NavigationCommands.Refresh, null)); 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-28T22:16:32.927

您将希望按如下方式使用`NavigationService`您的：`NavigationWindow`

XAML：

```
 <Button HorizontalAlignment="Right" Name="continueButton" Width="75" Margin="0,0,8,11" Height="23" VerticalAlignment="Bottom" Click="continueButton_Click">
        Continue
    </Button> 
```

C＃：

```
 private void continueButton_Click(object sender, RoutedEventArgs e)
    {
        this.NavigationService.GoForward();
        //or
        this.NavigationService.Navigate("Second.xaml")
    } 
```

使用其中任何一个都可以使用 use ，为了清楚起见`this`，我只在`NavigationService`此处显示

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-03-16T13:55:41.737

```
public class NavigateButton : Button
{
    public Uri NavigateUri { get; set; }

    public NavigateButton()
    {
        Click += NavigateButton_Click;
    }

    void NavigateButton_Click(object sender, System.Windows.RoutedEventArgs e)
    {
        var navigationService = NavigationService.GetNavigationService(this);
        if (navigationService != null)
            navigationService.Navigate(NavigateUri);
    }
} 
```

然后您可以将以下内容放入您的 xaml 中：

`<local:NavigateButton Content="NavigateButton" NavigateUri="Page2.xaml"/>`

然后你仍然不需要页面后面的代码，也不需要向视图模型添加命令。

# c# - 开发和调试占用大量内存的 C# 应用程序

> ID：803923
> 
> 赞同：12
> 
> 时间：2009-04-29T19:36:10.240
> 
> 标签：c#, visual-studio, wow64

我有一个 C# 应用程序，它必须与 32 位库链接，并且还需要使用可能的最大内存量（成像应用程序）；我们在 XP64 桌面上运行应用程序，因此我们使用 WOW64，针对 x86 的 Visual Studio 中的构建（并进行`editbin /largeaddressaware`后期构建）。我们遇到了几个问题：

*   在 Visual Studio 内置调试​​器中，我们只能使用 2gb 内存（大约 1.5gb 到应用程序，加上开销）

*   从命令行运行，应用程序可以看到 3gb 的内存，但微软文档似乎说我们应该看到 4gb。

谁能告诉我如何让 WOW64 C# 应用程序查看平台应该能够提供的完整 4gb？

另外，谁能告诉我如何让 Visual Studio（VS 2008，也称为 VS90）调试器遵守该`/largeaddressaware`位并停止将应用程序内存限制为 2gb？

我在 VS80 和 VS90 中看到了相同的行为；.NET Framework 3.5、3.0 和 2.0 之间也没有区别。这是一个说明问题的简单 C# 程序；为 x86 构建`editbin /largeaddressaware`，然后在内置调试器中运行与从命令行运行以查看 C# 可用内存的差异。

```
namespace MemoryAllocTest
{
class Program
{
    static void Main(string[] args)
    {
        const int allocSize = 1024 * 1024;
        List<byte[]> myMem = new List<byte[]>();
        UInt64 totalAlloc = 0;

        while (true)
        {
            myMem.Add(new byte[allocSize]);
            totalAlloc += allocSize;
            Console.WriteLine("{0} allocs: {1}MB total", 
             myMem.Count, totalAlloc / (1024 * 1024));
        }
    }
}
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-29T22:44:45.683

> > 谁能告诉我如何让 Visual Studio（VS 2008，也称为 VS90）调试器遵守 /largeaddressaware 位并停止将应用程序内存限制为 2gb？

这需要两个步骤——都在项目属性中：

*   在构建事件选项卡上，设置构建后步骤以运行 editbin /largeaware $(TargetPath)
*   在调试选项卡上，取消选中启用 Visual Studio 托管进程

通过这两个步骤，您的示例程序运行到 3045MB

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T17:23:06.667

感谢大家的回应; 这个网站真的很震撼！

似乎我们确实在 WOW64 中达到了 4gb 用户空间，但在我看来（有根据的猜测）垃圾收集器开销（或者可能是安全裕度）随着托管代码分配的内存的增长而变得相当大。在 WOW64（命令行，使用 LARGEADDRESSAWARE）上运行我的测试应用程序，我得到了 3175MB 的总分配；在具有 4GT 参数集的 WIN32 XP 机器上运行，我得到了 2857MB 的总分配：因此，额外的用户模式内存的完整演出在 C# 应用程序级别仅增加了约 318MB！

（我已经修改了我的测试程序，以便在分配失败时将分配单元大小减半，并且还添加了策略性地强制垃圾收集的调用，以稍微超出“正常”应用程序可能能够抓取的限制 - - 如果您希望我发布修改后的代码，请在此处添加注释。）

无论如何，再次感谢大家；看起来系统工作正常，但托管环境从额外的内存中得到的改进比预期的要小。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-29T21:50:53.833

我从帖子中构建了您的简单示例应用程序，将其崩溃并将 WinDbg 附加到它。

[!address -summary](http://blogs.msdn.com/dougste/archive/2008/05/16/how-to-determine-largeaddressaware-from-a-dump-file.aspx) 将显示进程的有效用户模式地址空间。

```
0:003> !address -summary
 TEB fffdd000 in range fffdb000 fffde000
 TEB fffda000 in range fffd8000 fffdb000
 TEB fffd7000 in range fffd5000 fffd8000
 TEB fffaf000 in range fffad000 fffb0000
 ProcessParametrs 004c2b40 in range 004c0000 00535000
 Environment 004c1978 in range 004c0000 00535000

-------------------- Usage SUMMARY --------------------------
    TotSize (      KB)   Pct(Tots) Pct(Busy)   Usage
   e7d2e000 ( 3798200) : 90.56%    98.77%    : RegionUsageIsVAD
   1547b000 (  348652) : 08.31%    00.00%    : RegionUsageFree
    2887000 (   41500) : 00.99%    01.08%    : RegionUsageImage
     3ff000 (    4092) : 00.10%    00.11%    : RegionUsageStack
          0 (       0) : 00.00%    00.00%    : RegionUsageTeb
     1c0000 (    1792) : 00.04%    00.05%    : RegionUsageHeap
          0 (       0) : 00.00%    00.00%    : RegionUsagePageHeap
       1000 (       4) : 00.00%    00.00%    : RegionUsagePeb
          0 (       0) : 00.00%    00.00%    : RegionUsageProcessParametrs
          0 (       0) : 00.00%    00.00%    : RegionUsageEnvironmentBlock
       **Tot: ffff0000 (4194240 KB)** Busy: eab75000 (3845588 KB)

-------------------- Type SUMMARY --------------------------
    TotSize (      KB)   Pct(Tots)  Usage
   1547b000 (  348652) : 08.31%   : <free>
    2aa3000 (   43660) : 01.04%   : MEM_IMAGE
    1f6a000 (   32168) : 00.77%   : MEM_MAPPED
   e6168000 ( 3769760) : 89.88%   : MEM_PRIVATE

-------------------- State SUMMARY --------------------------
    TotSize (      KB)   Pct(Tots)  Usage
   db838000 ( 3596512) : 85.75%   : MEM_COMMIT
   1547b000 (  348652) : 08.31%   : MEM_FREE
    f33d000 (  249076) : 05.94%   : MEM_RESERVE

Largest free region: Base fbfc0000 - Size 03fed000 (65460 KB) 
```

基于 Tot: ffff0000 (4194240 KB) 我们确实有 4GB 的有效用户模式空间。

此外，我们最大的空闲块是 65,460KB，这确实意味着我们应该能够分配更多的内存。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-29T19:42:24.733

来自[微软](http://www.microsoft.com/whdc/system/platform/server/PAE/PAEmem.mspx)：

> 除非在 Boot.ini 文件中使用 /3GB 开关，否则进程和应用程序的虚拟地址空间仍被限制为 2 GB。当系统中的物理 RAM 超过 16 GB 并使用 /3GB 开关时，操作系统将忽略额外的 RAM，直到 /3GB 开关被移除。这是因为支持更多页表条目所需的内核大小增加了。假设管理员宁愿不默默地自动丢失 /3GB 功能；因此，这需要管理员明确更改此设置。/3GB 开关将 3 GB 的虚拟地址空间分配给使用 `IMAGE_FILE_LARGE_ADDRESS_AWARE`在进程头中。此开关允许应用程序寻址超过 2 GB 的 1 GB 额外虚拟地址空间。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-29T19:43:12.720

您使用的是什么确切版本的 .NET？[这个 Connect 报告](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=389429&wa=wsignin1.0)是关于相同的问题（据我所知），在 .NET 2.0 上可以看到，但在 .NET 2.0SP1 中已修复。

如果您的 x64 机器没有 2.0SP1（或更高版本），那么值得一试...

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-29T19:43:38.333

你能在暗示你可以看到所有 4 GB 的地方发帖吗？哦，也许在这里：[此链接上的有趣信息](http://msdn.microsoft.com/en-us/library/bb147385.aspx)

> 可寻址内存的差异
> 
> 大多数开发人员首先注意到的是 64 位处理器在可寻址的物理和虚拟内存量方面提供了巨大的飞跃。
> 
> ```
> * 32-bit applications on 32-bit platforms can address up to 2 GB
> * 32-bit applications built with the /LARGEADDRESSAWARE:YES linker flag 
> ```
> 
> 在具有特殊 /3gb 引导选项的 32 位 Windows XP 或 Windows Server 2003 上，最多可以寻址 3 GB。这将内核限制为仅 1 GB，这可能会导致某些驱动程序和/或服务失败。
> 
> ```
> * 32-bit applications built with the /LARGEADDRESSAWARE:YES linker flag 
> ```
> 
> 在 32 位版本的 Windows Vista 和 32 位版本的 Windows Server 代码名称“Longhorn”操作系统上，最多可以寻址由引导配置数据 (BCD) 元素增加用户Va 指定的数量的内存。increaseUserVa 的值可以从默认值 2048 到 3072（与 Windows XP 上的 /3gb 引导选项配置的内存量相匹配）。剩余的 4 GB 分配给内核，可能导致驱动程序和服务配置失败。
> 
> 有关 BCD 的详细信息，请参阅 MSDN 上的引导配置数据。
> 
> ```
> * 32-bit applications on 64-bit platforms can address up to 2 GB, or up 
> ```
> 
> 使用 /LARGEADDRESSAWARE:YES 链接器标志到 4 GB。* 64 位应用程序使用 43 位寻址，为应用程序提供 8 TB 的虚拟地址，为内核保留 8 TB。

所以是的，看来您应该（在 XP64 目标上）能够看到 4 GB。

# list - SandCastle 帮助文件生成器和 MAML，如何获得具有不同起始索引的有序列表？

> ID：803931
> 
> 赞同：0
> 
> 时间：2009-04-29T19:37:45.150
> 
> 标签：list, sandcastle, maml, shfb

我正在使用 SandCastle Help File Builder 1.8.0.1 及其 MAML 内容编辑器。

我想要一个从默认值 1 以外的值开始的有序列表。

> `10\. Some data`
> 
> `11\. Other data`

我什至尝试了以下方法，但它不起作用，因为它来自 OL 元素的 HTML：

```
<list class="ordered">
     <listItem value="10">some data</listItem>
</list> 
```

我怎样才能做到这一点？

有人知道我应该在沙堡样式中修改哪些文件吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-11-14T00:53:03.783

当前版本的 SandCastle 支持

```
<list class="ordered" start="9">
  <listItem>Item 9</listItem>
</list> 
```

# javascript - 如何清除/删除 JavaScript 事件处理程序？

> ID：803936
> 
> 赞同：61
> 
> 时间：2009-04-29T19:38:32.730
> 
> 标签：javascript, html, dom-events

给定以下 HTML 片段：

```
<form id="aspnetForm" onsubmit="alert('On Submit Run!'); return true;"> 
```

我需要删除/清除 onsubmit 事件的处理程序，并使用 jQuery 或任何其他类型的 JavaScript 使用注册我自己的处理程序。

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2009-04-29T19:51:12.903

要在没有任何库的情况下执行此操作：

```
document.getElementById("aspnetForm").onsubmit = null; 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-04-29T19:41:24.470

使用 jQuery

```
$('#aspnetForm').unbind('submit'); 
```

然后继续添加你自己的。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-06-09T22:47:48.187

试试这个，这对我有用：

```
$('#aspnetForm').removeAttr('onsubmit').submit(function() {   
    alert("My new submit function justexecuted!"); 
}); 
```

有关更多详细信息，请参阅[此](http://joshuaclayton.github.com/code/2009/06/08/handling-jquery-and-onsubmit.html)内容。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2017-12-12T07:27:36.663

这是一个古老的问题，但鉴于主要浏览器都已放弃`EventTarget.getEventListeners()`，这里有一种方法可以删除元素及其子元素上的**所有事件处理程序并仅保留 HTML 结构。**我们只需克隆元素并替换它：

```
let e = document.querySelector('selector');
let clone = e.cloneNode(true);
e.replaceWith(clone); 
```

这与使用跟踪每个处理函数的方法抢占原型一样多`addEventListener()`，但至少可以在 DOM 已经与另一个脚本的事件连接后使用。

这也与上面使用 jQuery[`clone()`](https://api.jquery.com/clone/)而不是`cloneNode()`：

```
let original = $('#my-div');
let clone = original.clone();
original.replaceWith(clone); 
```

这种模式将有效地在元素或其子节点上不留下任何事件处理程序，除非它们是使用[“on”属性](https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Event_handlers)定义的，例如`onclick="foo()"`.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2018-06-08T03:54:55.317

对于 jQuery，[`off()`](http://api.jquery.com/off/#off)从其中删除 jQuery 添加的所有事件处理程序。

```
$('#aspnetForm').off(); 
```

> 不带参数调用 .off() 会删除所有附加到元素的处理程序。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-03-29T12:40:07.020

对于 jQuery，如果您使用 .live 绑定事件处理程序，您可以使用 .die 取消绑定所有与 .live 绑定的实例。

# javascript - 在棘手的情况下使用 jQuery 在列表中隐藏额外项目（标记并不理想）

> ID：803940
> 
> 赞同：1
> 
> 时间：2009-04-29T19:40:09.870
> 
> 标签：javascript, jquery

我想通过在长子列表中隐藏一些元素而不在服务器端添加额外处理来缩短长列表。问题是来自服务器的标记不是由我控制的，也不是为了让我的工作变得轻松而设计的。这是代码

```
<ul id="long-list">
  <li class="item"></li>
  <li class="item"></li>
  <li class="item"></li>
  <li class="header"></li>
  <li class="item"></li>
  <li class="item"></li>
  <li class="item"></li>
  <li class="item"></li>
  <li class="item"></li>
  <li class="header"></li>
  <li class="item"></li>
  .
  .
  .
</ul> 
```

正如您所注意到的，标题与项目是同级的。现在，我想要一个 jQuery 代码，在每个标题后仅显示 3 个项目，并隐藏其余项目以使列表更短且更可用。

这是我的尝试，**但**不起作用：

```
 $('#long-list li.header ~ li.item:gt(3)').hide();
  $('#long-list li.header ~ li.item:lt(3)').show();
  $('#long-list li.header').show(); 
```

额外的功能是在每个部分的底部添加一个隐藏项目的节点，说明隐藏了多少项目，比如“5 更多......”

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-29T19:52:44.130

可能可以做得更好，但这应该有效：

```
var i = 0;
$("#long-list li.header:first").nextAll("li").each(function(){
  i = $(this).hasClass("header") ? 0 : i+1;
  $(this).toggle(i<=3);
}); 
```

（更新为不隐藏第一个标题之前的项目。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-02T22:08:07.040

这就是我实现它的方式。请注意，它还有一些其他功能，例如在具有隐藏项的子列表的末尾添加一个节点，说 x 项是隐藏的，并绑定一个 onclick 事件来切换隐藏项。

```
 if ($('#list li.header')[0]) {      
      var i = -1000;
      $("#list > li").each(function(){
        if ($(this).hasClass("header")) {
          (i>3) && ($(this).before( "<li  class='more'>" + (i-3) + " more...</li>").bind("click", toggle_more() )  );
          i = 0;
        } 
        else {
          i = i+1; 
        }
        $(this).toggle(i<=3);
      });
  } 
```

它基本上基于svinto上面所说的。我仍然在寻找更好的表现。无论如何，现在我对结果很满意。

用 -1000 初始化 i 确保我们不会隐藏列表顶部没有任何标题的项目。一旦我们到达标题，我们就会将 i 设置为零并开始计数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T22:29:53.177

如果没有 jquery 中的循环，您将无法做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T15:54:37.720

这似乎对我有用，并且似乎在逻辑上遵循了您最初尝试使用兄弟姐妹选择器的意图。

```
 $("li.header:first").prevAll("li.item").hide();
  $("li.header").each(function() {
    $(this).nextAll("li.item:lt(3)").show();
    $(this).nextAll("li.item:gt(3)").hide();
  }); 
```

# java - 春季可以对aspectj-autoproxy进行细粒度控制吗？

> ID：803942
> 
> 赞同：4
> 
> 时间：2009-04-29T19:41:06.170
> 
> 标签：java, spring

如果我只是将 <aop:aspectj-autoproxy proxy-target-class="false"/> 添加到我的 spring 上下文的开头，那么每个实现接口的 bean 都会获得一个 JDK 代理。我真的很想将代理 A）限制为实际需要代理的类或 B）我指定为需要代理的类。

我尝试在需要代理的 bean 的 xml bean 定义中使用 aop:scoped-proxy 节，但事实证明这似乎没有给我 aop-advice。

我还尝试在我的 spring xml 文件末尾添加 <aop:aspectj-autoproxy ....> ，但在添加所有需要代理的 bean 之前，它似乎无法正常工作。

我有*很多*带有接口的 bean，但只有少数（定义明确的）需要 AoP 建议，而这些代理正在严重破坏我的堆栈跟踪。（我看过 spring 3.0 并怀疑它在那里是可能的，但似乎还有一段时间）。

这在 2.5.X 中可行吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T18:01:14.313

从 AbstractAdvisorAutoProxyCreator.java 第 67 行（Spring 2.5.6）中可以看出，自动代理创建者实际上只做我要求它做的事情。它不会自动代理超过它认为必要的次数。

事实证明，你使用的切入点表达式极大地影响了这个类的代理程度；我使用的注释是

```
@Around(value="@target(myannotation)") 
```

这基本上意味着 spring 生成一个代理，该代理根据实际调用目标的类型决定拦截。这样做的缺点是 spring 尝试使用 applicationcontext 中的*所有*可用 bean 来执行此操作。如果我一直使用@within 之类的东西，spring 将使用接口来决定是否应该进行自动代理，这可以在构建 applicationcontext 时静态确定。

所以现在我只有两个被代理的类；）

# c# - 动态构建的正则表达式运行速度非常慢！

> ID：803945
> 
> 赞同：5
> 
> 时间：2009-04-29T19:41:19.260
> 
> 标签：c#, .net, xml, regex, performance

我通过运行一些 xml 结构并在遍历其节点类型时构建语句来动态生成正则表达式。我将此正则表达式用作我定义的布局类型的一部分。然后我解析一个文本文件，该文件在每行的开头都有一个 Id。这个 id 指向一个特定的布局。然后我尝试将该行中的数据与其正则表达式进行匹配。

听起来不错，花花公子，对吧？唯一的问题是匹配字符串非常慢。我将它们设置为已编译以尝试加快速度，但无济于事。令人费解的是，这些表达方式并没有那么复杂。我绝不是 RegEx 专家，但我*对*它们了解很多，可以让事情顺利进行。

这是生成表达式的代码...

```
StringBuilder sb = new StringBuilder();
//get layout id and memberkey in there...
sb.Append(@"^([0-9]+)[ \t]{1,2}([0-9]+)"); 
foreach (ColumnDef c in columns)
{
    sb.Append(@"[ \t]{1,2}");
    switch (c.Variable.PrimType)
    {
        case PrimitiveType.BIT:
            sb.Append("(0|1)");
            break;
        case PrimitiveType.DATE:
            sb.Append(@"([0-9]{2}/[0-9]{2}/[0-9]{4})");
            break;
        case PrimitiveType.FLOAT:
            sb.Append(@"([-+]?[0-9]*\.?[0-9]+)");
            break;
        case PrimitiveType.INTEGER:
            sb.Append(@"([0-9]+)");
            break;
        case PrimitiveType.STRING:
            sb.Append(@"([a-zA-Z0-9]*)");
            break;
    }
}
sb.Append("$");
_pattern = new Regex(sb.ToString(), RegexOptions.Compiled); 
```

实际缓慢的部分...

```
public System.Text.RegularExpressions.Match Match(string input)
{
    if (input == null)
       throw new ArgumentNullException("input");

    return _pattern.Match(input);
} 
```

一个典型的“_pattern”可能有大约 40-50 列。我将从粘贴整个模式中保存。我尝试对每个案例进行分组，以便稍后在 Match 对象中枚举每个案例。

任何可以极大帮助的提示或修改？或者这是可以预期的缓慢运行？

编辑澄清：对不起，我认为我第一次不够清楚。

我使用 xml 文件为特定布局生成正则表达式。然后我运行一个文件进行数据导入。我需要确保文件中的每一行都与它所说的模式匹配。因此，可以多次检查模式，可能是数千次。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-29T20:06:19.607

您正在使用正则表达式解析一个 50 列的 CSV 文件（使用制表符）？

您应该只删除重复的选项卡，然后在 \t 上拆分文本。现在，您将所有列都放在了一个数组中。您可以使用 ColumnDef 对象集合来告诉您每列是什么。

**编辑：** 一旦你把事情分开，你可以选择使用正则表达式来验证每个值，这应该比使用巨大的单一正则表达式快得多。

**Edit2：** 您还可以获得额外的好处，即确切地知道哪些列格式错误，并且您可能会产生类似“第 12 行第 30 列中的语法错误，预期日期格式”之类的错误。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-29T19:52:46.127

一些性能思考：

*   使用`[01]`而不是`(0|1)`
*   使用非捕获组而不是捕获组（如果您确实需要分组）`(?:`*`expr`*`)`

* * *

**编辑**   看起来你的值是用空格分隔的，你为什么不把它分开呢？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-29T19:52:07.487

创建正则表达式的成本很高，如果编译它们，成本会更高。所以问题是您正在创建许多正则表达式，但只使用一次。

您应该缓存它们以供重用，如果您不想经常使用它们，请不要编译它们。我从未测量过这一点，但我可以想象你将不得不使用一个简单的正则表达式超过 100 次才能超过编译成本。

**性能测试**

*   正则表达式：`"^(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+(?:[a-z]{2}|com|org|net|gov|mil|biz|info|mobi|name|aero|jobs|museum)$"`

*   输入：“www.stackoverflow.com”

*   每次迭代以毫秒为单位的结果

    *   一个正则表达式，编译，10,000 次迭代：**0.0018 毫秒**
    *   一个正则表达式，未编译，10,000 次迭代：**0.0021 毫秒**
    *   每次迭代一个正则表达式，未编译，10,000 次迭代：**0.0287 ms**
    *   每次迭代一个正则表达式，编译，10,000 次迭代：**4.8144 ms**

请注意，即使经过 10,000 次迭代，已编译和未编译的正则表达式在比较它们的性能时仍然非常接近。随着迭代次数的增加，编译的正则表达式表现更好。

*   一个正则表达式，编译，1,000,000 次迭代：**0.00137 ms**
*   一个正则表达式，未编译，1,000,000 次迭代：**0.00225 毫秒**

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-29T19:51:11.170

好。与连接它们相比，使用 StringBuilder 构建模式将节省一些周期。

对此进行彻底的优化（可以明显测量）很可能会通过其他方法来实现。

正则表达式很慢......强大但很慢。解析文本文件，然后使用正则表达式进行比较以检索正确的数据位不会很快（取决于主机和文本文件的大小）。

也许将数据存储在其他方法而不是大文本文件中会更有效地解析（也使用 XML？），或者可能是逗号分隔的列表。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-29T19:49:34.483

默认情况下，单个表达式中可能有 50 个匹配组会有点慢。我会做一些事情来看看你是否可以确定性能挫折。

1.  首先尝试硬编码与动态比较，看看您是否有任何性能优势。
2.  查看您的要求，看看是否有任何方法可以减少您需要评估的分组数量
3.  如果需要，请使用分析器工具（例如 Ants Profiler）来查看减速的位置。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-29T20:12:13.977

我会手动构建一个词法分析器。

在这种情况下，看起来您有一堆由制表符分隔的字段，记录由新行终止。XML 文件似乎描述了列的顺序及其类型。

编写代码以手动识别每个案例在最坏的情况下可能需要 5-10 行代码。

然后，您可能只想从 xml 文件中生成一组 PrimitiveType[] 值，然后调用下面的“GetValues”函数。

这应该允许您通过输入流进行单次传递，这应该比使用正则表达式有很大的提升。

您需要自己提供“ScanXYZ”方法。它们应该很容易编写。最好使用正则表达式来实现它们。

```
public IEnumerable<object[]> GetValues(TextReader reader, PrimitiveType[] schema)
{
   while (reader.Peek() > 0)
   {
       var values = new object[schema.Length];
       for (int i = 0; i < schema.Length; ++i)
       {
           switch (schema[i])
           {
               case PrimitiveType.BIT:
                   values[i] = ScanBit(reader);
                   break;
               case PrimitiveType.DATE:
                   values[i] = ScanDate(reader);
                   break;
               case PrimitiveType.FLOAT:
                   values[i] = ScanFloat(reader);
                   break;
               case PrimitiveType.INTEGER:
                   values[i] = ScanInt(reader);
                   break;
               case PrimitiveType.STRING:
                   values[i] = ScanString(reader);
                   break;
           }
       }

       EatTabs(reader);

       if (reader.Peek() == '\n')
       {
            break;
       }

   if (reader.Peek() == '\n')
   {
       reader.Read();
   }
   else if (reader.Peek() >= 0)
   {
       throw new Exception("Extra junk detected!");
   }

   yield return values;

   }

   reader.Read();
} 
```

# networking - LAN/流量拥塞是什么意思？

> ID：803957
> 
> 赞同：3
> 
> 时间：2009-04-29T19:43:41.813
> 
> 标签：networking, udp, ip-protocol, congestion-control

在谈论 UDP 时，我看到/听到过几次拥塞。这意味着什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-29T19:46:28.827

拥塞是当您试图在有限的带宽上发送太多数据时，它无法以比传入数量更快的速度发送数据，因此会丢弃额外的数据包。

当发生拥塞时，您可以看到以下效果：

1.  由于连接一端的队列太大而导致延迟，因此传输数据包需要时间。

2.  简单丢弃新数据包时的数据包丢失，迫使连接重置（并且通常会导致更多拥塞）。

3.  较低的服务质量，诸如 TCP 之类的协议会降低传输速率，因此您的吞吐量会降低。

4.  阻塞，某些网络具有协议优先级，因此您的 UDP 数据包可能会被丢弃，以允许 TCP 流量通过。

就像一场交通堵塞，想象一下在一场体育比赛之后，一个停满汽车的停车场正试图空出一条小街。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T19:47:02.803

这意味着网络连接的设备正试图通过网络发送比它能够处理的更多的数据，例如通过 10 Mbps 链路的 20 Mbps 数据。

在 UDP 的上下文中，它是您在一般情况下丢失数据报的主要来源。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T19:49:51.110

大多数 LAN 使用某种碰撞检测/避免系统。拥塞通常意味着在介质上传输的数据量会导致足够多的冲突，从而降低为该介质定义的服务质量。您可能想在 wikipedia 上阅读 CSMA/CD。由于 UDP 数据包经常可以广播，因此拥塞可能会更频繁地发生。

亲切的问候，

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-29T19:54:41.647

例如，以太网是一种宽带协议。一旦发送了消息，每个节点都会收到它，但如果数据包没有发送给它们，则忽略它。当两个节点同时发送一个数据包时会发生什么？这将导致碰撞和数据丢失。

因此，两个节点都必须重新发送消息。为了避免更多的冲突，节点被设计为**等待随机数毫秒**。否则，它们会继续同时发送消息，并且包将永远碰撞。

# javascript - 如何测试从实时网站提取数据的 AJAX 应用程序？

> ID：803964
> 
> 赞同：1
> 
> 时间：2009-04-29T19:46:36.347
> 
> 标签：javascript, ajax, firefox, testing, cross-domain

我正在开发一个从实时网站提取数据的 AJAX 应用程序，目前我无法在本地环境中复制完整的应用程序，因此为了测试 JavaScript 代码是否按预期工作，我需要能够绕过浏览器上的相同域限制（无需在网络服务器上进行更改）任何建议将不胜感激。

到目前为止，我已经尝试修改`prefs.js`Firefox 2 和 Camino，包括此链接中建议的行：[http ://www.zachleat.com/web/2007/08/30/cross-domain-xhr-with-firefox/](http://www.zachleat.com/web/2007/08/30/cross-domain-xhr-with-firefox/)

提前致谢。

*编辑 2009 年 4 月 29 日下午 3:18：*

我同意代理选项绝对是一种方法。但是是否有可能只使用 Firefox 来提供解决方案？（也许是一个附加组件？）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-29T19:51:17.317

如果您可以更改端点 URL，则可以使用 mod_rewrite 或简单脚本通过本地服务器反弹请求。

这样做的好处是您可以轻松记录请求和响应，并更改它们（例如发回超时错误、错误数据等）。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-29T19:53:17.407

好吧，要查看请求/单步执行 js，请尝试使用[Firebug](http://getfirebug.com/)。

# visual-studio-2008 - 在 Visual Studio WiX 项目中使用 WXI 文件

> ID：803965
> 
> 赞同：4
> 
> 时间：2009-04-29T19:46:36.907
> 
> 标签：visual-studio-2008, wix

我遇到了几个来源，声明使用包含文件 (.wxi) 将 WiX 安装文件拆分为单独的部分（变量、组件等）。对我来说非常有意义，所以我将 <components> 节点从 .wxs 文件中取出并将它们放在单独的文件中，但是当我尝试在 Visual Studio 2008 中编译项目时，每个 <ComponentRef> 都出现错误说明这是“产品：{...}”部分中对符号“...”的未解决引用”。

我尝试在我的 Product.wxs 文件中使用 <?include "Filename"?> 标记，但这似乎破坏了架构验证。如果这是包含它的方式，它需要去***哪里***？

我拥有的文件如下。

*产品.wxs*

```
<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product ...>
    <Package .../>
    <Media .../>
    <Directory Id="TARGETDIR" Name="SourceDir">
    </Directory>
    <Feature Id="MainProgram" Level="1">
      <ComponentRef Id="ProductComponent" />
      <Feature Id="ContextMenu" Level="2">
        <ComponentRef Id="ContextMenuComponent" />
      </Feature>
    </Feature>
  </Product>
</Wix> 
```

*组件.wxi*

```
<?xml version="1.0" encoding="utf-8"?>
<Include>
  <Fragment>
    <Component Id="ProductComponent" ...>
      <File .../>
    </Component>
    <Component Id="ContextMenuComponent" ...>
      <RegistryKey .../>
    </Component>
  </Fragment>
</Include> 
```

如何让它在 Visual Studio 中构建？编写构建脚本似乎更简单，但还不是我的问题。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-29T22:50:45.793

包含文件应该被认为是头文件，你真的只想用它们来声明你需要在多个`.wxs`文件之间共享的公共变量等。

我的项目使用了大约 10 个 .wxs 文件和一个 .wxi，我在其中定义了产品代码、升级代码等。

为了更好地了解我在说什么，请查看 SO 问题[Wix Tricks & Best Practices](https://stackoverflow.com/questions/471424/wix-tricks-and-best-practices)和[WiX Includes vs. Fragments](https://stackoverflow.com/questions/581857/wix-includes-vs-fragments)以及一如既往，**Wix.chm中的文档**

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-29T20:06:11.820

尝试使用 WXS 扩展而不是 WXI。我已经分解了我的并使用 WXS 作为扩展，它只是工作。项目中的所有 WXS 文件都由 wixproj 传入 wix 编译器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-02-12T19:17:58.210

发现这个问题正在搜索我的问题，我想我会添加我的修复以防有人来自我所做的地方。

如果您使用 wixproj 文件从 Visual Studio 编译，似乎此项目类型不支持文件链接（添加现有项目...添加为链接）。您最终会得到项目中的链接，但是当您编译它时会抱怨存在未解析的符号。

# asp.net-mvc - 如何在 ASP.NET MVC 视图中显示 Linq to Entity 查询结果

> ID：803969
> 
> 赞同：1
> 
> 时间：2009-04-29T19:47:05.160
> 
> 标签：asp.net-mvc, entity-framework, linq-to-entities

我的 ASP.NET MVC 应用程序中有一个 Link 2 Entity 查询表达式：

```
Dim var = From c In context.Evaluation_Template _
          来自 ae 在 context.Assigned_Evaluation _
          加入 ua 在 context.User_Assignment 上 ae.Assignment_ID 等于 ua.Assignment_ID _
          选择 c.Evaluation_Name、ae.Due_Date、ua.Is_Started、ua.Is_Completed、ua.Is_Approved

```

我想将它传递给视图并显示结果。

我努力了

```
返回视图(var)

```

但我不确定如何迭代结果。

一般来说，我是 .NET 的新手，因此我们将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T16:23:24.000

如果您希望在您的视图中使用强类型对象，您需要进入您的视图并将顶部从...更改为

```
<%@ Page Language="VB" MasterPageFile="~/Views/Shared/Site.Master" Inherits="System.Web.Mvc.ViewPage" %> 
```

至

```
<%@ Page Language="VB" MasterPageFile="~/Views/Shared/Site.Master" Inherits="System.Web.Mvc.ViewPage(Of IEnumerable(Of String))" %> 
```

当然，用您要传入的模型类型替换 Of String。要传入您的集合，您将使用...

```
Return View(query.ToList()) 
```

...假设查询是来自 ADO.NET EF 的某种 IQueryable 查询。

然后在您看来，您可以遍历传入的结果。

```
 <%  For Each s As String In Model
        %><%=s%><%
    Next%> 
```

这将输出集合中传递给视图数据模型的每个字符串。

尽管我确实建议最佳实践来创建专门用于传递到您的视图的类型，即 ViewData。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-29T19:54:18.650

首先，您的查询看起来有点混乱。我不确定 VB.NET 但在这种情况下您需要一个单独的类，因为您选择的东西不是您的实体框架模型。

```
Dim var = From c In context.Evaluation_Template
          .Include("Assigned_Evaluation")
          .Include("User_Assignment")
          Select c 
```

这是第三个 eidt，我一直在发布它 :) 您的视图页面需要采取的是：

```
IEnumerable<Evaluation_Template> 
```

您可以通过生成强类型视图或在视图页面的页面指令中设置它来完成此操作。你也可以做你正在尝试的事情（更少的开销），但是你需要一个单独的类来发送到视图页面。

# java - 使用泛型克隆

> ID：803971
> 
> 赞同：12
> 
> 时间：2009-04-29T19:48:06.077
> 
> 标签：java, clone

从前有一堂课：

```
public class Scope<C extends Cloneable & Comparable<C>> implements Comparable<Scope<C>>, Cloneable, Serializable {

   private C starts;
   private C ends;
   ...

   @SuppressWarnings("unchecked")
   @Override
   public Object clone() {
       Scope<C> scope;
       try {
           scope = (Scope<C>) super.clone();
           scope.setStarts((C) starts.clone()); // The method clone() from the type Object is not visible
           scope.setEnds((C) ends.clone()); // The method clone() from the type Object is not visible
       } catch (CloneNotSupportedException e) {
           throw new RuntimeException("Clone not supported");
       }
       return scope;
   }
} 
```

在对象中，我们有：

```
protected native Object clone() throws CloneNotSupportedException; 
```

而Cloneable接口是：

```
public interface Cloneable { 
} 
```

我应该如何克隆这个？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-08-07T06:02:03.083

# 解决方案

使用[Java 深度克隆](https://github.com/kostaskougios/cloning)库。

*克隆库*是一个小型的开源（apache 许可证）java 库，它可以深度克隆对象。对象不必实现 Cloneable 接口。实际上，这个库可以克隆任何 java 对象。如果您不希望修改缓存的对象或想要创建对象的深层副本，则可以在缓存实现中使用它。

```
Cloner cloner=new Cloner();
XX clone = cloner.deepClone(someObjectOfTypeXX); 
```

# 附录

以前的答案有以下缺点：

*   它添加了很多代码
*   它要求您列出要复制的所有字段并执行此操作
*   使用时，这不适用于列表`clone()`；`clone()`for`HashMap`注释：返回此实例的*浅表副本`HashMap`：键和值本身未克隆*，因此您最终手动执行。

序列化也很糟糕，因为它可能需要`Serializable`在任何地方添加。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-29T19:51:48.470

[这也是没人喜欢`Cloneable`](https://stackoverflow.com/questions/709380/java-rationale-of-the-cloneable-interface)的原因之一。`Cloneable`它应该是一个标记接口，但它基本上是无用的，因为你不能在没有反射的情况下克隆任意对象。

几乎唯一的方法是使用*公共* `clone()`方法创建您自己的接口（不必将其称为“ `clone()`”）。[这是另一个 StackOverflow 问题的示例](https://stackoverflow.com/questions/240774/mandatory-cloneable-interface-in-java/240895#240895)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-02-11T08:27:50.107

希望我已经解决了Java中的*泛型克隆问题：*

```
public class Generic<T> {
  private T data;

  public Generic() {
    // ...
  }

  @SuppressWarnings("unchecked")
  @Override
  public Object clone() {
    Generic<T> cloned = new Generic<T>();
    try {
      cloned.data = (T) data.getClass().getMethod("clone").invoke(data);
    } catch (Exception e) {
      // ...
    }
    return cloned;
  }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-29T20:31:40.933

有点 OT，但你可以用这个来为自己节省很多未来的悲伤：

```
 catch (CloneNotSupportedException e) {
       throw new RuntimeException("Clone not supported", e);
   } 
```

这样，当您获得堆栈跟踪时，您就知道是哪个对象导致了问题。

为了回答核心问题，您自己的接口实现了mmyers 编写的**公共**clone() 并要求 C 也扩展它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-29T20:44:31.340

作为一般评论，尽可能避免使用 Object.clone() 。如果您可以控制相关代码，请改为实现复制构造函数。有关信息，请参见[此处](https://stackoverflow.com/questions/270369/what-have-you-used-object-clone-for/270467#270467)。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-29T19:57:59.780

如您所见，如果一个类试图实现`Cloneable`并且您想要一个*深度*克隆，那么您的所有组成对象都需要是不可变的、原始的，或者也需要是可克隆的。

通常，更好和更简单的方法是创建一个复制构造函数。

```
public class Scope<C extends Comparable<C>> implements Comparable<Scope<C>>, Serializable {
    private C starts;
    private C ends;
    public Scope(final Scope original) {
       starts = new C(original.starts);
       ends = new C(original.ends);
       // initialize all my other fields from "original"
    }
} 
```

当然，您需要一个`C`能够处理多态性的复制构造函数。

如果您无法访问或无法将源代码修改为`C`，那么任何复制方法，无论采用何种方法，都将非常困难并且可能是不可能的。例如，无法复制`enum`实例。

# html - 将 HTML 选择/选择组转换为 Flex

> ID：803977
> 
> 赞同：0
> 
> 时间：2009-04-29T19:49:48.523
> 
> 标签：html, flex3

Flex 的新手，最接近 Flex 中以下 HTML 标记的等价物是什么？

```
<select size="9">
    <optgroup label="Group 1">
        <option>Value 1</option>
        <option>Value 2</option>
    </optgroup>
    <optgroup label="Group 2">
        <option>Value 5</option>
        <option>Value 6</option>
    </optgroup>
    <optgroup label="Group 3">
        <option>Value 8</option>
        <option>Value 9</option>
    </optgroup>
</select>
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T19:52:01.870

没有直接映射的。你可以试试这个——[一个示例实现](http://www.phusor.com/flex/optgroup_demo/srcview/index.html)（使用）或使用或`Combobox`滚动你自己的。`Combobox`[`RadioButtonGroup`](http://livedocs.adobe.com/flex/3/langref/mx/controls/RadioButtonGroup.html)

# wcf - 实体框架、WCF 和更新

> ID：803980
> 
> 赞同：10
> 
> 时间：2009-04-29T19:50:39.097
> 
> 标签：wcf, entity-framework, n-tier-architecture

我创建了一个 n 层解决方案，我从 WCF 服务检索相关数据，在 Windows 窗体应用程序中更新它，然后通过 WCF 返回更新的数据以持久保存到数据库。应用程序、WCF 服务和数据库都在不同的机器上。

正在检索的数据由一个对象和子对象组成...

```
public Product Select(string catalogueNumber) {

  return (from p in this.ProductEntities.Products.Include(@"Tracks")
            where p.vcCatalogueNumber == catalogueNumber
            select p).FirstOrDefault() ?? new Product();
} 
```

客户端应用程序应用的更新除了更新现有内容外，还可以插入额外的“跟踪”对象。

当我从客户端应用程序接收到 Product 对象时，我可以正确看到所有更新，但是为了正确保存所有更改，我必须跳过几个环节......

```
public void Save(Product product) {

    Product original = this.Select(product.vcCatalogueNumber);
    if (original.EntityKey != null) {

        this.ProductEntities.ApplyPropertyChanges(product.EntityKey.EntitySetName, product);

        // There must be a better way to sort out the child objects...
        foreach (Track track in product.Tracks.ToList()) {

            if (track.EntityKey == null) {
                original.Tracks.Add(track);
            }
            else {
                this.ProductEntities.ApplyPropertyChanges(track.EntityKey.EntitySetName, track);
            }

        }

    }
    else {

        this.ProductEntities.AddToProducts(product);

    }

    this.ProductEntities.SaveChanges();

} 
```

当然，必须有一种更简单的方法来做到这一点？

注意：我花了下午的大部分时间调查 EntityBag 项目，但发现它尚未更新为与 EF RTM 一起使用。特别是，虽然它会成功更新现有数据，但在混合新对象时会引发异常。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-02T13:57:02.277

对于您的特定场景，我没有现成的答案 - 但只是一个问题：您检查过 ADO.NET 数据服务（fka“Astoria”）吗？

它们构建在 Entity Framework、WCF 的 RESTful 接口之上，它们提供了客户端体验，此外，它们似乎还有一个不错的故事，不仅可以查询，还可以更新、将记录插入数据库。

这可能是一种选择吗？

在[MSDN](http://msdn.microsoft.com/en-us/data/bb931106.aspx)、[David Hayden 的博客](http://codebetter.com/blogs/david.hayden/archive/2008/01/08/getting-started-with-ado-net-data-services.aspx)、[Channel9上查看它们，或者在](http://channel9.msdn.com/tags/ADO.NET+Data+Services/)[MIX08 和 MIX 09](http://videos.visitmix.com/Search?term=ado.net+data+services)上查看一些出色的会议

马克

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-03T05:58:38.813

您可能应该看看 Danny Simmons 的 EntityBag 示例。

它旨在简化这类问题： [http ://code.msdn.microsoft.com/entitybag/](http://code.msdn.microsoft.com/entitybag/)

正如 CatZ 所说，在 .NET 4.0 中事情会容易得多。

我们计划帮助您做的一件事是为您创建一个 T4 模板，该模板为您生成能够自我跟踪的类，以及一些额外的表面，以使这些自我跟踪实体可以轻松地 ApplyChanges()当他们回到服务器层时的上下文。

希望这可以帮助

干杯 Alex（Microsoft 实体框架团队的 PM）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-27T15:15:41.360

我看到这个线程很安静，所以我允许自己做一些更新......

呜呜呜！自我跟踪实体已在 EF 4 中推出！

**看一下这个：**

[http://blogs.msdn.com/efdesign/archive/2009/03/24/self-tracking-entities-in-the-entity-framework.aspx](http://blogs.msdn.com/efdesign/archive/2009/03/24/self-tracking-entities-in-the-entity-framework.aspx)
*实体框架团队对自我追踪机制的解释。*

[http://aleembawany.com/2009/05/17/new-features-in-entity-framework-40-v2/](http://aleembawany.com/2009/05/17/new-features-in-entity-framework-40-v2/)
*宣布 EF 4 中的新功能。*

[http://msdn.microsoft.com/en-us/magazine/ee321569.aspx](http://msdn.microsoft.com/en-us/magazine/ee321569.aspx)
*断开实体的几种 N 层模式的比较。*

享受 ！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-09T09:49:53.603

在 Entity Framewrok 4 中，您可以使用方法“ApplyCurrentValues”来更新分离的实体。

在您的场景中将是这样的：

```
this.ProductEntities.Product.ApplyCurrentValues(product);
foreach (Track track in product.Tracks.ToList()) {
if (track.EntityKey != null)
{
//Update Entity
  this.ProductEntities.Track.ApplyCurrentValues(track);
}
else
{   
  //New Entity
  this.ProductEntities.Track.Attach(track);
} 
```

}

我希望它会有用

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-29T20:06:30.243

Entity Framework v1.0 的限制之一是更新实体。不幸的是，我认为在第 2 版到来之前你很不走运。

# c# - 图像大小调整 - 有时质量很差？

> ID：803987
> 
> 赞同：7
> 
> 时间：2009-04-29T19:52:00.590
> 
> 标签：c#, image, resize, image-scaling

我正在根据用户的屏幕分辨率调整一些图像的大小；如果纵横比错误，则应剪切图像。我的代码如下所示：

```
protected void ConvertToBitmap(string filename)
    {
        var origImg = System.Drawing.Image.FromFile(filename);
        var widthDivisor = (double)origImg.Width / (double)System.Windows.Forms.Screen.PrimaryScreen.Bounds.Width;
        var heightDivisor = (double)origImg.Height / (double)System.Windows.Forms.Screen.PrimaryScreen.Bounds.Height;
        int newWidth, newHeight;

        if (widthDivisor < heightDivisor)
        {
            newWidth = (int)((double)origImg.Width / widthDivisor);
            newHeight = (int)((double)origImg.Height / widthDivisor);
        }
        else
        {
            newWidth = (int)((double)origImg.Width / heightDivisor);
            newHeight = (int)((double)origImg.Height / heightDivisor);
        }

         var newImg = origImg.GetThumbnailImage(newWidth, newHeight, null, IntPtr.Zero);
        newImg.Save(this.GetBitmapPath(filename), System.Drawing.Imaging.ImageFormat.Bmp);
    } 
```

在大多数情况下，这可以正常工作。但是对于某些图像，结果的质量*极差*。看起来会被调整为非常小的东西（缩略图大小）并再次放大。但图像的分辨率是正确的。我能做些什么？

原始图像示例： [替代文字 http://img523.imageshack.us/img523/1430/naturaerowoods.jpg](http://img523.imageshack.us/img523/1430/naturaerowoods.jpg)

调整大小的图像示例： [![替代文字](https://i.stack.imgur.com/pW0AO.png)](https://i.stack.imgur.com/pW0AO.png)

注意：我有一个 WPF 应用程序，但我使用 WinForms 函数来调整大小，因为它更容易，而且我已经需要对 System.Windows.Forms 的引用来获取托盘图标。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-29T20:02:50.940

将方法的最后两行更改为：

```
var newImg = new Bitmap(newWidth, newHeight);
Graphics g = Graphics.FromImage(newImg);
g.DrawImage(origImg, new Rectangle(0,0,newWidth,newHeight));
newImg.Save(this.GetBitmapPath(filename), System.Drawing.Imaging.ImageFormat.Bmp);
g.Dispose(); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-29T19:57:02.607

我目前无法查看 .NET 源代码，但很可能问题出在`Image.GetThumbnailImage`方法上。甚至 MSDN 都说“当请求的缩略图图像的大小约为 120 x 120 像素时，它工作得很好，但是如果您从具有嵌入式缩略图的图像请求大的缩略图图像（例如，300 x 300），则可能是缩略图质量的明显损失”。对于真正的调整大小（即不是缩略图），您应该使用该`Graphics.DrawImage`方法。如果需要，您可能还需要使用`Graphics.InterpolationMode`以获得更好的质量。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-29T19:57:35.990

如果您不创建缩略图，则使用一种称为`GetThumbnailImage`可能的方法可能不是一个好主意...

有关其他选项，请查看[此 CodeProject 文章](http://www.codeproject.com/KB/GDI-plus/imageresize.aspx)。具体来说，它会创建一个新图像，为其创建一个图像，`Graphics`并将插值模式设置为`HighQualityBicubic`并将原始图像绘制到图形上。至少值得一试。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-29T19:57:08.177

如[MSDN](http://msdn.microsoft.com/en-us/library/system.drawing.image.getthumbnailimage.aspx)所示，`GetThumbnailImage()`并非旨在进行任意图像缩放。任何超过 120x120 的东西都应该手动缩放。试试这个：

```
using(var newImg = new Bitmap(origImg, newWidth, newHeight))
{
    newImg.Save(this.GetBitmapPath(filename), System.Drawing.Imaging.ImageFormat.Bmp);
} 
```

**编辑**

作为澄清点，`Bitmap`构造函数的这种重载调用`Graphics.DrawImage`，尽管您对插值没有任何控制权。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-02T06:20:53.993

而不是这段代码：

```
newImg.Save(this.GetBitmapPath(filename), System.Drawing.Imaging.ImageFormat.Bmp); 
```

使用这个：

```
System.Drawing.Imaging.ImageCodecInfo[] info = System.Drawing.Imaging.ImageCodecInfo.GetImageEncoders();
System.Drawing.Imaging.EncoderParameters param = new System.Drawing.Imaging.EncoderParameters(1);
param.Param[0] = new System.Drawing.Imaging.EncoderParameter(System.Drawing.Imaging.Encoder.Quality, 100L);
newImg.Save(dest_img, info[1], param); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-20T21:52:08.773

一些相机将调整大小的缩略图放入文件本身，大概是为了在设备本身上进行预览。

GetThumbnail 方法实际上是获取嵌入在图像文件中的缩略图图像，而不是获取更高分辨率的方法。

简单的解决方案是欺骗 .Net 在进行调整大小或其他操作之前丢弃该缩略图信息。像这样……

```
img.RotateFlip(System.Drawing.RotateFlipType.Rotate180FlipX); 
//removes thumbnails from digital camera shots
img.RotateFlip(System.Drawing.RotateFlipType.Rotate180FlipX); 
```

如果您尝试调整约束比例，我在 System.Drawing.Image 上编写了一个扩展方法，您可能会发现它很方便。

```
/// <summary>
/// 
/// </summary>
/// <param name="img"></param>
/// <param name="size">Size of the constraining proportion</param>
/// <param name="constrainOnWidth"></param>
/// <returns></returns>
public static System.Drawing.Image ResizeConstrainProportions(this System.Drawing.Image img,
    int size, bool constrainOnWidth, bool dontResizeIfSmaller)
{
    if (dontResizeIfSmaller && (img.Width < size))
        return img;
    img.RotateFlip(System.Drawing.RotateFlipType.Rotate180FlipX); 
    img.RotateFlip(System.Drawing.RotateFlipType.Rotate180FlipX);
    float ratio = 0;
    ratio = (float)img.Width / (float)img.Height;

    int height, width = 0;
    if (constrainOnWidth)
    {
        height = (int)(size / ratio);
        width = size;
    }
    else
    {
        width = (int)(size * ratio);
        height = size;
    }
    return img.GetThumbnailImage(width, height, null, (new System.IntPtr(0)));
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-29T19:57:11.717

例如，原始图像为 JPG，调整大小后的图像为 PNG。您是否有意在格式之间进行转换？在不同的有损压缩方案之间切换会导致质量损失。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-29T20:13:40.493

调整大小时是增加还是减小图像的大小？如果您从较小的图像创建较大的图像，则可以预料到这种退化。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-07-18T12:16:47.700

如果放大它们，图像肯定会降级。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-04-29T19:58:32.917

根据以下因素，这将有很大差异：

1.  目标分辨率与原始分辨率的“自然”比例的匹配程度
2.  源图像颜色深度
3.  图像类型 - 有些比其他有损

# csla - 谁能指出我在网络上实时运行的 CSLA 应用程序？

> ID：803993
> 
> 赞同：2
> 
> 时间：2009-04-29T19:52:55.723
> 
> 标签：csla

谁能指出我在网络上实时运行的 CSLA.Net 应用程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-05-18T11:52:47.007

[http://www.hiringbox.com/](http://www.hiringbox.com/)使用 CSLA.Net 3.8 开发

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-24T20:54:10.000

[http://www.programmersheaven.com/mb/](http://www.programmersheaven.com/mb/)上的论坛软件是使用 CSLA 开发的。

# iphone - 流式传输“代理”转换视频格式

> ID：803994
> 
> 赞同：1
> 
> 时间：2009-04-29T19:53:06.173
> 
> 标签：iphone, video, streaming, ffmpeg

这与我的[另一个问题有关](https://stackoverflow.com/questions/796872/flv-stream-decoding-3gp-encoding)

在这里我想问一下理论上（根据视频文件格式和编解码器等）是否可能出现这种情况：

1) iPhone客户端有flv格式的视频参考。只需在 Safari 中单击此类链接，它就会发送 http 请求以转换像[http://convproxy.com?source=url_of_original_video.flv这样的“代理”](http://convproxy.com?source=url_of_original_video.flv)

2）转换代理开始下载该flv文件并将其即时转换为mp4（iphone可以理解），将转换后的部分作为http响应返回，因此iPhone可以在整个flv下载和转换之前立即开始播放。

我在玩 ffmpeg 试图做这样的事情，它确实转换 flv 并生成 mp4 文件，但是在转换完成或 ffmpeg 停止之前无法播放 mp4 文件。如果我只是杀死 ffmpeg 进程，则无法播放 mp4 文件。如果我让它完成或按 ctrl-c 停止它，则可以播放下载和转换的部分。似乎 ffmpeg 在收到停止信号后做了一些工作。这是 mp4 格式的必要部分还是可以以不同的方式完成？我看到 iPhone 可以通过在整个文件下载到它之前开始播放来流式传输视频，所以总的来说这对我来说似乎是可能的情况。

我简短地说，我可以将flv文件转换为mp4文件，问题是我是否可以将flv流转换为mp4流。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-29T20:47:21.193

根据[维基百科](http://en.wikipedia.org/wiki/MPEG-4_Part_14)，MP4 容器格式需要一个单独的“提示轨道”来启用流式传输。我假设 ffmpeg 在转换结束时写这个。如果 iPhone 操作系统需要此轨道进行流式传输，我看不到除了使用不同格式并在 iPhone 端具有自定义解码器（类似于用于 iPhone 的 Orb 客户端的方式）之外流式传输实时视频的方法。********