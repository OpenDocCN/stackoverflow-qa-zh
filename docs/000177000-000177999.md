# StackOverflow 问答 000177000-000177999

# delphi - tserversocket 数组

> ID：177011
> 
> 赞同：0
> 
> 时间：2008-10-07T02:22:42.033
> 
> 标签：delphi

好的，我有一个 tserversocket 数组，并且正在使用 tag 属性来跟踪它的索引。当一个事件被触发时，例如 _clientconnect 我正在使用 Index := (Sender as TServerSocket).Tag; 但我收到一个错误，突出显示该行并告诉我它的类型转换无效。如果我只想获取标签属性字段，我做错了什么？它适用于其他对象。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T04:55:59.117

您确定 Sender 是 TServerSocket 吗？事件是不是定义如下：

```
procedure TfrmServer.sskServerClientConnect(Sender: TObject; Socket: TCustomWinSocket); 
```

在这种情况下，您的代码可能应该是：

```
Index := (Socket as TServerSocket).Tag; 
```

看看`Sender.ClassName`Sender 到底是什么。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T18:50:17.343

使用这种方法，恐怕您将无法找到 TServerSocket 标记属性。原因是 Sender 是 TServerWinSocket 的一个实例，而 Socket 是 TCustomWinSocket 的一个实例——它们都不能转换为 TServerSocket。查看 ScktComp.pas（在 Source\Vcl 中）。TServerSocket 只是 TServerWinSocket 内部实例的包装器。

你可以这样做：

```
TMyServerWinSocket = class(TServerWinSocket)
private
  FServerSocket : TServerSocket;
public
  destructor Destroy; override;
  property Server : TServerSocket read FServerSocket write FServerSocket;
end;

TMyServerSocket = class(TServerSocket)
public
  constructor Create(AOwner : TComponent);
end; 
```

实现如下所示：

```
destructor TMyServerWinSocket.Destroy;
begin
  Server := nil;
end;

constructor TMyServerSocket.Create(AOwner : TComponent);
begin
  FServerSocket := TMyServerWinSocket.Create(INVALID_SOCKET);
  TMyServerWinSocket(FServerSocket).Server := Self;
  InitSocket(FServerSocket);
  FServerSocket.ThreadCacheSize := 10;
end; 
```

然后（哇，几乎就在那里）在您的事件处理程序中，您可以这样做：

```
procedure TfrmServer.sskServerClientConnect(Sender: TObject; Socket: TCustomWinSocket);
begin
  Index := (Sender as TMyServerWinSocket).Server.Tag;
end; 
```

这意味着您需要创建 TMyServerSocket 实例，而不是在数组中创建 TServerSocket 对象。

希望有帮助。

# c++ - C++ 将 SQLVARCHAR 转换为字符串

> ID：177037
> 
> 赞同：1
> 
> 时间：2008-10-07T02:35:03.660
> 
> 标签：c++, string, varchar

我需要从 SQLVARCHAR 转换为字符串数据类型

变量定义如下：

```
string strFirstName;

SQLVARCHAR rtnFirstName[50]; 
```

希望能够做到以下几点：

```
if (strFirstName.empty()) strFirstName = rtnFirstName; 
```

给出一个错误，即`binary '=': no operator found which takes a right-hand operand of type 'SQLVARCHAR[50]' (or there is no acceptable conversion)`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T02:40:00.203

您使用的是什么数据库 API？我能找到的所有谷歌点击`SQLVARCHAR`都说它是一个无符号字符，所以你可以这样做：

```
strFirstName = reinterpret_cast<char*>(rtnFirstName); 
```

# c# - C#拳击题

> ID：177039
> 
> 赞同：2
> 
> 时间：2008-10-07T02:36:39.320
> 
> 标签：c#, icomparable, unboxing

首先，举两个例子：

```
// This works
int foo = 43;
long lFoo = foo;

// This doesn't
object foo = (int)43;
long? nullFoo = foo as long?; // returns null
long lFoo = (long)foo; // throws InvalidCastException
if (foo.GetType() == typeof(int))
    Console.WriteLine("But foo is an int..."); // This gets written out 
```

现在，我猜测为什么第二个不起作用是因为拳击。此代码背后的目的是实现`IComparable`. 我需要一些方法来将一个对象强制转换为 long 或 ulong ，或者如果两者都不是，而不是抛出错误。我不想对每种基本数字类型（字节、整数、长整数、ubyte 等）实施检查，我宁愿只以最大的数字类型捕获它们并以这种方式处理。这里所有聪明人的想法？我怎样才能拆箱对象，最好避免反射，但我想如果这是唯一的方法......或者我应该不实现的非泛型版本`IComparable`？

**编辑：**

这似乎可行，但似乎是解决问题的可怕技巧。只有我吗？

```
long lFoo = long.Parse(foo.ToString()); 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-07T03:08:19.553

```
object foo  = (int) 43;
long   lFoo = ((IConvertible) foo).ToInt64(null); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-07T02:45:38.570

当您转换为值类型时，您实际上是在强制进行取消装箱 IL 操作，这要求您要转换的类型与装箱值*完全匹配；*没有可以同时发生的转换、隐式或显式转换。

这通常意味着您需要使用类型代码（或者如果使用类型，则使用 if/else）进行切换，或者在您的情况下，检查 null 后跟 Convert.ToInt64()，它应该处理它正确。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T02:56:37.330

它不只是你，但是 tryparse 不会引发异常。

```
object foo = (int)43;
long outVal;
if(long.TryParse(foo.ToString(),out outVal))
{
//take action with correct value of long
}
else
{
//maybe passed you another type of object
} 
```

# php - php cURL iis 6.0 windows server 2003

> ID：177042
> 
> 赞同：1
> 
> 时间：2008-10-07T02:38:17.850
> 
> 标签：php, iis, curl

我在使用 IIS 6.0、Windows Server 2003、PHP 5.2.6 设置 cURL 时遇到问题

我已经安装到`C:\PHP`

```
set PHPRC = C:\PHP\php.ini 
```

复制到`ssleay32.dll`_`libeay32.dll``C:\PHP`

在 php.ini 中，取消注释该行

```
extension=php_curl.dll

extension_dir="C:\PHP\ext" 
```

`c:\php\ext`有dll`php_curl.dll`

`C:\PHP`在`PATH`

仍然得到

> 致命错误：调用未定义的函数 curl_init()

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T03:14:29.353

确保 php_curl.dll 位于 php.ini 的“extension_dir”下列出的目录中。如果已经存在，请尝试重新启动 IIS（在进行 php.ini 更改时，Apache 总是需要我重新启动）。

编辑1：

尝试打开命令提示符到 c:\php 并运行：

```
php -c . -i | find /i "curl" 
```

它会返回任何输出吗？如果是这样，则 IIS 使用了错误的 php.ini 文件。

编辑2：

c:\php 在你的 PATH 中吗？您可以在命令提示符下使用“echo %PATH%”进行检查。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T11:52:55.953

也许它正在加载 c:\windows\php.ini？我认为你已经重新启动了 IIS，因为你改变了配置...... :)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-23T06:48:51.007

我最终重新安装了 php，然后卸载了 php。然后我将线程安全的 php 包复制并提取到 c:\php 中，而不是使用非线程安全包

# geolocation - 有没有更好的地理定位数据库/技术/服务，或者有没有人在提高现有系统的准确性方面做过任何工作？

> ID：177052
> 
> 赞同：1
> 
> 时间：2008-10-07T02:43:32.880
> 
> 标签：geolocation

我正在努力将地理定位服务集成到网站中，到目前为止，我发现的最佳数据源是 MaxMind 的 GeoIP API 和 GeoLite City 数据。不过，即使是这些数据似乎也经常有问题。例如，我位于帕洛阿尔托市中心，但我的 IP 位于 7 英里外的波托拉谷。Palo Alto 的人口超过 60,000 人，而 Portola Valley 的人口不到 5,000 人。我认为，如果您看到某个 IP 起源于那里的某个地方，那么假设它来自人口稠密的城市而不是小城市会更有意义。我还让它在肯塔基州等全国范围内完全定位帕洛阿尔托 IP。

有谁知道任何更好的数据来源，或任何工具/技术/努力提高地理定位工作的准确性？商业解决方案很好。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T17:11:09.977

如果某个 IP 出现在该国的错误一端，您可能在其他地方找不到更好的匹配，因为它可能是一个为广大区域的客户使用一组 IP 的 ISP。我最喜欢的例子是英国的火车，其中车载 wifi 被识别为在瑞典，因为它们使用卫星连接到瑞典的 ISP。

商业供应商可能有能力花更多时间追踪疑难案件，但在许多情况下，不会给您一个好的答案。然而，他们可能会给你一个信心因素，让你在他们猜测时告诉你。我听说过有关[Quova](http://www.quova.com)的好消息，尽管我从未使用过它们。

假设您已经获得（或负担得起）最好的纬度和经度，那么您将不得不处理他们选择最近的城市而不是附近更有可能的大城市的情况。不幸的是，我手头没有代码，但我使用来自[地名](http://www.geonames.org/export/)的数据在某个点附近选择了一个“明智的”城市时取得了一些成功。他们列出了纬度/经度和人口，所以你可以做类似的事情

```
ORDER BY ( Distance / LOG( Population ) ) 
```

您需要对此进行试验，以获得对大城市具有正确偏见的东西，但我让它在谷歌地图视图的中心工作得很好，并显示了一个标题，比如“显示伦敦附近的结果......”随着您移动地图，这种情况发生了变化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T17:15:19.000

我最近看到的几个免费 GeoIP 服务的网站是

[WIP狂热](http://www.wipmania.com/en/base/)

[主机信息](http://www.hostip.info/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T04:58:28.927

我不确定这是否会有所帮助，但这是一个在 IP 映射方面做得很好的网站。也许你可以向他们寻求帮助:) [seomoz.org](http://www.seomoz.org/ip2loc)

# sql - 位掩码的大小是否有实际限制？

> ID：177054
> 
> 赞同：5
> 
> 时间：2008-10-07T02:44:48.430
> 
> 标签：sql, bit-manipulation, bitmask

有一种常见的方法是使用位掩码将多个值存储在一个变量中。例如，如果用户对某项具有读、写和执行权限，则可以通过说将其转换为单个数字`read = 4 (2^2), write = 2 (2^1), execute = 1 (2^0)`，然后将它们相加得到 7。

我在几个 Web 应用程序中使用了这种技术，我通常将变量存储到一个字段中，并根据不同值的数量给它一种 MEDIUMINT 或其他类型。

我感兴趣的是，您可以像这样存储的值的数量是否有实际限制？例如，如果数字超过 64，则不能再使用（64 位）整数。如果是这样的话，你会用什么？它将如何影响您的程序逻辑（即：您仍然可以使用按位比较）吗？

*我知道，一旦您开始获得非常大的值集，另一种方法将是最佳解决方案，但我对**这种**方法的边界感兴趣。*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T03:03:48.797

在我的脑海中，我会编写一个`set_bit`and`get_bit`函数，它可以获取一个字节数组和数组中的一个位偏移，并使用一些位旋转来设置/获取数组中的适当位。像这样的东西（在 C 中，但希望你明白）：

```
// sets the n-th bit in |bytes|. num_bytes is the number of bytes in the array
// result is 0 on success, non-zero on failure (offset out-of-bounds)
int set_bit(char* bytes, unsigned long num_bytes, unsigned long offset)
{
  // make sure offset is valid
  if(offset < 0 || offset > (num_bytes<<3)-1) { return -1; }

  //set the right bit
  bytes[offset >> 3] |= (1 << (offset & 0x7));

  return 0; //success 
}

//gets the n-th bit in |bytes|. num_bytes is the number of bytes in the array
// returns (-1) on error, 0 if bit is "off", positive number if "on"
int get_bit(char* bytes, unsigned long num_bytes, unsigned long offset)
{
  // make sure offset is valid
  if(offset < 0 || offset > (num_bytes<<3)-1) { return -1; }

  //get the right bit
  return (bytes[offset >> 3] & (1 << (offset & 0x7));
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T02:50:53.597

我在文件系统代码中使用了位掩码，其中位掩码比机器字大很多倍。把它想象成一个“布尔数组”；

（如果你想知道，闪存中的日志掩码）

许多编译器知道如何*为您*执行此操作。添加一点 OO 代码以使类型能够合理地运行，然后您的代码开始看起来像它的意图，而不是一些位敲打。

我的 2 美分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T02:50:53.783

使用 64 位整数，您最多可以存储 2^64-1 的值，64 仅为 2^6。所以是的，有一个限制，但如果你需要超过 64 个标志，我很想知道他们都在做什么 :)

你需要考虑多少个州？如果您有 64 个潜在状态，则它们可以存在的组合数是 64 位整数的完整大小。

如果您需要担心 128 个标志，那么一对位向量就足够了 (2^64 * 2)。

**另外**：在 Programming Pearls 中，有一个关于使用长度为 10^7 的位数组的扩展讨论，以整数实现（用于保存使用过的 800 个数字）——它非常快，非常适合该章中描述的任务。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T03:04:15.113

某些语言（我相信 perl 确实如此，不确定）允许对字符串进行按位算术。为您提供更大的有效范围。( (strlen * 8bit chars) 组合)

但是，我不会使用单个值来叠加多个 /type/ 数据。3 位整数的基本 r/w/x 三元组可能是“实际”上限，不是出于空间效率原因，而是出于实际开发原因。

（ PHP 使用这个系统来控制它的错误消息，我已经发现当你必须定义 php 的常量不驻留的值并且你必须手动生成整数时，它有点过头了，并且老实说，如果 chmod 不支持 'ugo+rwx' 风格的语法，我永远不想使用它，因为我永远记不起幻数）

当你必须打开一个常量表来调试代码时，你就知道你已经走得太远了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-09-22T03:53:34.227

旧线程，但值得一提的是，有些情况需要膨胀的位掩码，例如分子指纹，它们通常生成为 1024 位数组，我们将其打包在 32 个 bigint 字段中（SQL Server 不支持 UInt32）。位操作工作正常 - 直到您的表开始增长并且您意识到单独的函数调用的缓慢性。如果不是因为 T-SQL 禁止具有两个二进制操作数的位运算符，二进制数据类型将起作用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T02:57:47.827

例如，.NET 使用整数数组作为其 BitArray 类的内部存储。几乎没有其他办法。

话虽如此，在 SQL 中，您将需要不止一列（或使用 BLOBS）来存储所有状态。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-07T03:06:38.807

您将此问题标记为 SQL，因此我认为您需要查阅数据库的文档以查找整数的大小。然后为符号减去一位，以防万一。

**编辑：**您的评论说您正在使用 MySQL。[MySQL 5.0 Numeric Types](http://dev.mysql.com/doc/refman/5.0/en/numeric-types.html)的文档指出 NUMERIC 的最大大小为 64 或 65 位。那是 64 位的 212 位。

请记住，您选择的语言必须能够处理这些数字，因此无论如何您都可能被限制为 64 位整数。

# c++builder - TCustomDataSet C++ 生成器

> ID：177060
> 
> 赞同：2
> 
> 时间：2008-10-07T02:48:07.487
> 
> 标签：c++builder, vcl

除了作为 C++ Builder 中的示例项目提供的 TTextDataset 示例之外，我正在寻找 C++ 中的 TCustomDataSet 实现示例。

TTextDataset 很难学习，因为代码没有很好地记录，它只显示了一个字段示例。

我创建了自己的类，它继承了 TDataSet 并且它大部分都可以工作，但是 GUI 控件（主要是网格）对于某些用例不能 100% 工作。

任何人都有关于这个主题的一些很好的链接......

这是我用来学习的示例代码的链接：http: [//195.19.138.139 :3000/p/SOFTWARE/temp/CBuilder5/Examples/DBTasks/TextData/textdataset.cpp](http://195.19.138.139:3000/p/SOFTWARE/temp/CBuilder5/Examples/DBTasks/TextData/textdataset.cpp)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T03:06:26.827

我有几个例子。但不幸的是，它们在 Delphi 中，但您应该明白： [示例 1](http://dn.codegear.com/article/20587) [示例 2](http://www.carterconsulting.org.uk/Articles/cdspt3.PDF)

第二个进行了更多解释，它是我用来基于绑定到 UI（在 delphi 中）的自定义数据集的一个。

# ruby-on-rails - 如何更改 rails 的索引页？

> ID：177062
> 
> 赞同：4
> 
> 时间：2008-10-07T02:48:32.387
> 
> 标签：ruby-on-rails

我知道要更改 rails 的索引页面，我需要做三件事：删除 index.html，对 routes.rb 做一些事情，并且可能会执行路由将指向的操作。这是我有点模糊的细节:-)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-07T03:00:54.450

好的，我想通了。基本上你

1.  删除 public.html
2.  将 'map.root :controller => "foo"' 添加到 routes.rb
3.  然后当然创建带有动作索引的控制器 foo。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-07T10:44:35.763

按照 Frew 的步骤，作为第 4 步，在 /views/foo 文件夹中的索引视图文件中放入一些 html 代码来测试它。

例子：

```
<h1>My New Index Page</h1>
<p>Some text here.</p> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-07T08:25:50.067

不要忘记重新启动服务器。

您还可以运行 rake 路线以显示所有已知路线并确保一切看起来都正常。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-02-09T01:21:45.330

请注意，从 RoR 版本 4.0 + 开始，此更改 - 按照[入门指南](http://guides.rubyonrails.org/getting_started.html)中的简单步骤操作！

几分钟之内就会清楚它是如何工作的。

只是认为可能值得更新此威胁，因为使用较新版本的人可能会感到困惑和沮丧:)

# sharepoint - 如何将下拉列表绑定到 Sharepoint 2007 中的网格视图？

> ID：177076
> 
> 赞同：1
> 
> 时间：2008-10-07T02:53:23.280
> 
> 标签：sharepoint, sharepoint-designer

这应该是一件非常简单的事情，但由于某种原因，它只是在逃避我。

我想要一个 Sharepoint 页面，该页面将有一个与数据库查找表相关联的下拉列表。

当一个项目被选中并且他们点击一个 GO 按钮时，我希望它更新一个也在页面上的 gridview。

我正在寻找一个简单的方法 - 同时假设我是一个共享点白痴。顺便说一句，我正在使用 Microsoft Office Sharepoint Designer。

谢谢，

编辑：我的需求其实很简单。我想使用下拉列表过滤查询结果。这曾经被称为主从关系。

例如，我的常规数据有学校名称、应用程序名称以及应用程序运行的时间。因为每所学校可能有一百个申请，并且有 60 多所学校，我只想一次显示一所学校的信息。

所以，我想在屏幕顶部放置一个下拉列表，其中包含学校列表。选择一个时，应更新网格视图以反映新的学校信息。

克里斯。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T17:01:54.033

我目前使用绑定到一个共享点列表的下拉列表来过滤另一个共享点列表的数据视图。

说明在这里：http: [//blogs.msdn.com/sharepointdesigner/archive/2007/03/05/asp-net-controls-filter-the-data-view.aspx](http://blogs.msdn.com/sharepointdesigner/archive/2007/03/05/asp-net-controls-filter-the-data-view.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T11:11:11.637

我不完全确定这里的具体需求，但似乎您正在尝试超出 Sharepoint Designer 非常适合的范围。要查找数据，您可以通过 dataview Web 部件进行访问，该部件位于此处：

[http://office.microsoft.com/en-us/sharepointdesigner/HA100948041033.aspx](http://office.microsoft.com/en-us/sharepointdesigner/HA100948041033.aspx)

但是，您的过滤需求可能会阻止您使用它。如果您想在不了解 MOSS 的情况下使用 .net，您可以使用“smartpart 之子”（google it），它允许您在 webparts 中托管标准 .net 用户控件。

希望这可以帮助！

# java - 红宝石和鸭子打字：合同设计不可能？

> ID：177080
> 
> 赞同：19
> 
> 时间：2008-10-07T02:56:09.920
> 
> 标签：java, ruby, oop, interface, design-by-contract

Java中的方法签名：

```
public List<String> getFilesIn(List<File> directories) 
```

红宝石中的类似

```
def get_files_in(directories) 
```

在 Java 的情况下，类型系统为我提供了有关该方法期望和交付什么的信息。就 Ruby 而言，我**不**知道我应该传递什么，或者我期望收到什么。

在 Java 中，对象必须正式实现接口。在 Ruby 中，传入的对象必须响应此处定义的方法中调用的任何方法。

这似乎很有问题：

1.  即使有 100% 准确的最新文档，Ruby 代码也必须从本质上公开其实现，从而破坏封装。撇开“OO 纯度”不谈，这似乎是一场维护噩梦。
2.  Ruby 代码让我**不**知道返回了什么；我必须进行实验，或阅读代码以找出返回的对象会响应哪些方法。

不是要讨论静态类型与鸭子类型，而是要了解如何维护一个几乎没有合同设计能力的生产系统。

### 更新

没有人真正通过这种方法所需的文档来解决方法内部实现的暴露问题。由于没有接口，如果我不期待特定类型，我是否不必逐项列出我可能调用的每个方法，以便调用者知道可以传入什么？或者这只是一个没有真正出现的边缘案例？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-07T03:26:12.373

归根结底，这*在 Ruby*`get_files_in`中是个坏名字——让我解释一下。

 *在 java/C#/C++ 中，尤其是在目标 C 中，函数参数*是 name 的一部分*。在红宝石中它们不是。
对此的花哨术语是[Method Overloading](http://en.wikipedia.org/wiki/Method_overloading)，它由编译器强制执行。

以这些术语考虑它，您只是定义了一个调用的方法`get_files_in`，而实际上并没有说明它应该获取文件的内容。参数*不是*名称的一部分，因此您不能依赖它们来识别它。
它应该在目录中获取文件吗？驱动器？网络共享？这为它在上述所有情况下工作提供了可能性。

如果您想将其限制在一个目录中，那么要考虑到这些信息，您应该调用该方法`get_files_in_directory`。或者，您可以将其作为`Directory`类上的方法，[Ruby 已经为您做了](http://www.ruby-doc.org/core/)。

至于返回类型，暗示`get_files`您正在返回一个文件数组。您不必担心它是 a`List<File>`或`ArrayList<File`>，等等，因为每个人都只使用数组（如果他们编写了自定义数组，他们将编写它以从内置数组继承）。

如果您只想获取一个文件，则可以调用它`get_file`或`get_first_file`以此类推。如果您正在做一些更复杂的事情，例如返回`FileWrapper`对象而不仅仅是字符串，那么有一个非常好的解决方案：

```
# returns a list of FileWrapper objects
def get_files_in_directory( dir )
end 
```

好歹。您不能像在 java 中那样在 ruby​​ 中强制执行合同，但这是更广泛观点的一个子集，即您不能像在 java 中那样在 ruby​​ 中强制执行*任何东西。*由于 ruby​​ 更具表现力的语法，您可以更清楚地编写类似英语的代码，告诉其他人您的合同是什么（从而为您节省数千个尖括号）。

我个人认为这是一场净胜。您可以利用新获得的空闲时间编写一些[规范和测试](http://rspec.info)，并在一天结束时推出更好的产品。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-07T09:08:25.147

我会争辩说，尽管 Java 方法为您提供了*更多*信息，但它并没有为您提供*足够的*信息来轻松地进行编程。
例如，字符串列表只是文件名还是完全限定的路径？

鉴于此，您关于 Ruby 没有为您提供足够信息的论点也适用于 Java。
您仍然依赖于阅读文档、查看源代码或调用方法并查看其输出（当然还有体面的测试）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-07T03:16:35.107

虽然我在编写 Java 代码时喜欢静态类型，但没有理由不坚持在 Ruby 代码（或任何类型的代码）中考虑周到的先决条件。当我真的需要坚持方法参数的先决条件（在 Ruby 中）时，我很乐意编写一个可以引发运行时异常以警告程序员错误的条件。我什至写给自己一个静态类型的表象：

```
def get_files_in(directories)
   unless File.directory? directories
      raise ArgumentError, "directories should be a file directory, you bozo :)"
   end
   # rest of my block
end 
```

在我看来，该语言并没有阻止您按合同进行设计。相反，在我看来，这取决于开发人员。

（顺便说一句，“bozo”真正指的是你的:)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-07T03:13:10.043

通过鸭子类型进行方法验证：

```
i = {}
=> {}
i.methods.sort
=> ["==", "===", "=~", "[]", "[]=", "__id__", "__send__", "all?", "any?", "class", "clear", "clone", "collect", "default", "default=", "default_proc", "delete", "delete_if", "detect", "display", "dup", "each", "each_key", "each_pair", "each_value", "each_with_index", "empty?", "entries", "eql?", "equal?", "extend", "fetch", "find", "find_all", "freeze", "frozen?", "gem", "grep", "has_key?", "has_value?", "hash", "id", "include?", "index", "indexes", "indices", "inject", "inspect", "instance_eval", "instance_of?", "instance_variable_defined?", "instance_variable_get", "instance_variable_set", "instance_variables", "invert", "is_a?", "key?", "keys", "kind_of?", "length", "map", "max", "member?", "merge", "merge!", "method", "methods", "min", "nil?", "object_id", "partition", "private_methods", "protected_methods", "public_methods", "rehash", "reject", "reject!", "replace", "require", "respond_to?", "select", "send", "shift", "singleton_methods", "size", "sort", "sort_by", "store", "taint", "tainted?", "to_a", "to_hash", "to_s", "type", "untaint", "update", "value?", "values", "values_at", "zip"]
i.respond_to?('keys')
=> true
i.respond_to?('get_files_in')  
=> false 
```

一旦你理解了这个推理，方法签名就没有意义了，因为你可以在函数中动态地测试它们。（这部分是由于无法进行基于签名匹配的功能调度，但这更灵活，因为您可以定义无限的签名组合）

```
 def get_files_in(directories)
    fail "Not a List" unless directories.instance_of?('List')
 end

 def example2( *params ) 
    lists = params.map{|x| (x.instance_of?(List))?x:nil }.compact 
    fail "No list" unless lists.length > 0
    p lists[0] 
 end

x = List.new
get_files_in(x)
example2( 'this', 'should', 'still' , 1,2,3,4,5,'work' , x ) 
```

如果你想要一个更可靠的测试，你可以试试[RSpec](http://rspec.info/) for Behaviordriven development。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-07T03:42:18.347

**简短回答：**自动化单元测试和良好的命名实践。

方法的正确命名是必不可少的。通过为`get_files_in(directory)`方法命名，您还可以向用户提示该方法期望获得什么以及它将返回什么。例如，我不希望有一个`Potato`物体从里面出来`get_files_in()`——它只是没有意义。仅从该方法获取文件名列表或更合适的 File 实例列表才有意义。至于列表的具体类型，取决于你想要做什么，返回的 List 的实际类型并不重要。重要的是您可以以某种方式枚举该列表中的项目。

最后，您可以通过针对该方法编写单元测试来明确这一点——展示它应该如何工作的示例。因此，如果`get_files_in`突然返回一个 Potato，测试将引发错误，您就会知道最初的假设现在是错误的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-08-10T12:48:09.590

契约式设计是一个比仅仅指定参数类型和返回类型更微妙的原则。这里的其他答案主要集中在良好的命名上，这很重要。我可以继续讨论这个名字`get_files_in`模棱两可的许多方面。但是好的命名只是拥有良好合同并由他们设计的更深层次原则的外在结果。名字总是有点模棱两可，好的语用语言学是好的思考的产物。

您可以将合同视为设计原则，而以抽象的形式表述它们通常既困难又乏味。无类型语言要求程序员真正考虑合同，她对合同的理解比类型约束更深。如果有一个团队，团队成员必须都意味着并遵守相同的合同。他们必须是专注的思考者，并且必须花时间一起讨论具体的例子，以建立对合同的共同理解。

同样的要求也适用于 API 用户：用户必须首先记住文档，然后她才能逐渐理解合约，如果合约精心制作，她就会开始喜欢 API（否则会讨厌它）。

这与鸭子打字有关。无论方法输入的类型如何，合同都必须提供有关发生什么的线索。因此，必须以更深入、更概括的方式来理解合同。这个答案本身可能看起来有点不具体，甚至有点傲慢，对此我深表歉意。我只是想说鸭子[不是谎言](http://css.dzone.com/articles/duck-lie)，鸭子意味着人们在更高的抽象层次上思考自己的问题。设计师、程序员、数学家都是[同一种能力的不同名称](https://softwareengineering.stackexchange.com/questions/136987/what-does-mathematics-have-to-do-with-programming)，而且数学家知道数学有很多层次的能力，在这些层次上，更高层次的数学家很容易解决那些在较低层次上很难解决的问题。鸭子意味着你的编程必须是好的数学，它限制了成功的开发人员和用户只有那些[能够这样做的人](http://blog.codinghorror.com/separating-programming-sheep-from-non-programming-goats/)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-07T03:09:24.573

这绝不是维护的噩梦，只是另一种工作方式，需要 API 的一致性和良好的文档。

您的担忧似乎与任何动态语言都是危险工具有关，它不能强制执行 API 输入/输出合同。事实是，虽然选择 static 可能看起来更安全，但在这两种情况下你可以做的更好的事情是保留一组好的测试，这些测试不仅可以验证返回的数据的类型（这是 Java 编译器唯一可以验证和强制执行），而且它的正确性和内部工作原理（黑盒/白盒测试）。

附带说明一下，我不了解 Ruby，但在 PHP 中，您可以使用 @phpdoc 标签来提示 IDE（Eclipse PDT）关于某个方法返回的数据类型。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-03-22T00:11:05.363

几年前，我对 dbc for Ruby 进行了半生不熟的尝试，可能会给人们一些关于如何推进更全面的解决方案的想法：

[https://github.com/justinwiley/higher-expectations](https://github.com/justinwiley/higher-expectations)

# ruby-on-rails - Ruby on Rails 的对象数据库

> ID：177094
> 
> 赞同：14
> 
> 时间：2008-10-07T03:03:57.393
> 
> 标签：ruby-on-rails, ruby, database, object-oriented-database

是否有使用某种对象存储的 ActiveRecord 的替代品？

我认为像 Erlang 的 MNesia 这样的东西会是理想的。

**更新**

我一直在研究 CouchDB，我认为这是我要选择的选项。这是使用 CouchRest 和 ActiveCouch 之间的折腾。CouchRest 相当成熟，在 CouchDB peepcode 情节中使用，但它不是 ActiveRecord 的直接替代品，这有点缺点。

可以说 CouchDB 非常出色。

**更新（2009 年 11 月 10 日）**

CouchDB 并没有真正为我工作。CouchDB 并不真正支持任意查询（查询需要提前编写和编译）。它也会在非常大的数据集上中断。

我一直在玩[MongoDB](http://www.mongodb.org/)，这真是令人难以置信。带有查询和索引的无模式 JSON 数据存储。

我什至已经开始为它构建一个名为[Ming](http://github.com/tobyhede/ming/)的管理工具。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-12T11:47:42.997

试试[磁悬浮](http://ruby.gemstone.com/)！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T03:32:57.570

[AciveCouch](http://code.google.com/p/activecouch/)声称就是这样一个[CouchDB](http://incubator.apache.org/couchdb/)库，实际上它是用 Erlang 编写的。我不会说它和 ActiveRecord 一样成熟。

这是我所知道的最接近你所要求的东西。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T11:38:03.410

**Madeleine**是 Java **Prevayler**对象存储的实现

见[http://madeleine.rubyforge.org/](http://madeleine.rubyforge.org/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T17:32:43.520

我目前正在开发一个 ruby​​ 对象数据库，它使用 mysql 作为您可能感兴趣的后备存储（因此称为**hybriddb ）。**

它不使用 SQL 或迁移，您只需将对象保存到数据库中，它还尝试透明地解决对象数据库的常规问题（速度、快速查找对象、大型对象图）。

它仍然是一个早期版本，所以要小心。代码在这里 [http://github.com/pauliephonic/hybriddb/tree/master](http://github.com/pauliephonic/hybriddb/tree/master)开发分支支持事务，我目前正在添加基本验证。

我有一个包含一些教程等的网站。[http://www.hybriddb.org/pages/tutorial_starter](http://www.hybriddb.org/pages/tutorial_starter)

欢迎任何意见。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T14:59:41.613

除了玛德琳，您还可以看到：

[http://purple.rubyforge.org/](http://purple.rubyforge.org/)

但这也取决于规模。众所周知，Mnesia 支持大量数据，并且是集群的，而这些解决方案在处理大量数据时效果不佳。

如果数据量不大，另一种选择是：

[http://copiousfreetime.rubyforge.org/amalgalite/files/README.html](http://copiousfreetime.rubyforge.org/amalgalite/files/README.html)

# c++ - 使用 ICU 库的 UTF-8 到 ASCII

> ID：177113
> 
> 赞同：5
> 
> 时间：2008-10-07T03:14:45.267
> 
> 标签：c++, unicode, utf-8, transliteration

我有一个带有 UTF-8 字符的 std::string 。
我想用 ASCII 字符将字符串转换为最接近的等价物。

例如：

Łódź => Lodz
Assunção => Assuncao
Schloß => Schloss

不幸的是 ICU 库真的很不直观，我还没有找到关于它的使用的好的文档，所以我要花太多时间来学习使用它。我没有的时间。

有人可以举一个关于如何做到这一点的小例子吗？
谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T08:32:38.780

试试这个，ucnv_convert("US-ASCII", "UTF-8", targer, targetsize, source, sourcesize, pError)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T04:21:57.953

我不了解 ICU，但 ICONV 可以做到这一点，而且它很容易学习。它只有大约 3-4 次调用，您需要的是`ICONV_SET_TRANSLITERATE`使用`iconvctl()`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-07T17:48:18.653

我写了一个分解然后做一些替换的回调。它可能可以作为音译来实现。代码在这里[decompcb.c](http://source.icu-project.org/repos/icu/icuapps/trunk/locexp/util/decompcb.c "解压cb.c")并且标题在附近。在 Unicode 到 ASCII 转换器上按如下方式安装它：

```
ucnv_setFromUCallBack(gConverter, &UCNV_FROM_U_CALLBACK_DECOMPOSE, &status); 
```

然后使用 gConverter 将 unicode 转换为 ASCII

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T11:56:18.847

ß->ss 分解告诉我您想要兼容性分解。在 ICU 中，您需要 Normalizer 类。之后，你会得到像 L'odz' 这样的东西。从此字符串中，您可以简单地删除非 ASCII 字符。不需要ICU，普通的STL就可以了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T04:25:24.657

这不是我擅长的领域，但是如果您没有方便的库来轻松为您完成它，那么您最好创建一个包含 UTF-8 的查找表/映射 -> ASCII 值。IE。键是 UTF-8 字符，值是字符的 ASCII 序列。

# arrays - 确定数组是否包含n ... n + m的算法？

> ID：177118
> 
> 赞同：47
> 
> 时间：2008-10-07T03:19:01.933
> 
> 标签：arrays, algorithm, big-o, puzzle

我在 Reddit 上看到了这个问题，并没有提出积极的解决方案，我认为在这里问这个问题是一个完美的问题。这是关于面试问题的线程：

> 编写一个方法，该方法接受一个大小为 m 的 int 数组，如果该数组由数字 n...n+m-1、该范围内的所有数字和该范围内的数字组成，则返回 (True/False)。不保证对数组进行排序。（例如，{2,3,4} 将返回 true。{1,3,1} 将返回 false，{1,2,4} 将返回 false。
> 
> 我遇到的问题是我的面试官一直要求我进行优化（更快的 O(n)、更少的内存等），以至于他声称你可以使用恒定数量的数组在一次遍历中做到这一点记忆。从来没想过那个。

连同您的解决方案，请说明他们是否假定数组包含唯一项目。还要指出您的解决方案是否假定序列从 1 开始。（我稍微修改了问题以允许出现 2、3、4 的情况......）

**编辑：**我现在认为不存在处理重复的时间线性和空间常数算法。任何人都可以验证这一点吗？

重复问题归结为测试数组是否在 O(n) 时间、O(1) 空间中包含重复项。如果可以做到这一点，您可以先简单地测试，如果没有重复，则运行发布的算法。那么你能在 O(n) 时间 O(1) 空间中测试欺骗吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-07T03:25:38.347

在不允许小于 1 的数字且没有重复的假设下，有一个简单的求和恒等式 - 从`1`到 以`m`为增量的数字`1`之和`(m * (m + 1)) / 2`。然后，您可以对数组求和并使用此标识。

上面的保证下可以查到有没有被骗，加上保证没有数字大于m或者小于n（可以打卡`O(N)`）

伪代码中的想法：
0) 从 N = 0 开始
1) 取列表中的第 N 个元素。
2）如果列表已排序，但它不在正确的位置，请检查它应该在哪里。
3）如果它应该在的地方已经有相同的数字，你有一个骗子 - 返回 TRUE
4）否则，交换数字（将第一个数字放在正确的位置）。
5) 用你刚刚交换的号码，它在正确的地方吗？
6）如果不是，返回第二步。
7) 否则，从第一步开始，N = N + 1。如果这超出了列表的末尾，那么你就没有欺骗了。

而且，是的，`O(N)`虽然它看起来像`O(N ^ 2)`

## 给大家的注意（从评论中收集的东西）

此解决方案在您可以修改数组的假设下工作，然后使用就地基数排序（实现`O(N)`速度）。

已经提出了其他数学解决方案，但我不确定它们中的任何一个是否已被证明。有一堆总和可能有用，但其中大多数会在表示总和所需的位数方面出现爆炸，这将违反恒定的额外空间保证。我也不知道他们中的任何一个是否能够为给定的一组数字产生一个不同的数字。我认为平方和可能有效，它有一个已知的计算公式（参见[Wolfram's](http://mathworld.wolfram.com/PowerSum.html)）

## 新见解（嗯，更多的沉思无助于解决它，但很有趣，我要睡觉了）：

因此，有人提到可能使用 sum + sum of squares。没有人知道这是否有效，我意识到它只有在 (x + y) = (n + m) 时才会成为问题，例如事实 2 + 2 = 1 + 3。正方形也有这个问题，这要归功于[毕达哥拉斯三元组](http://en.wikipedia.org/wiki/Pythagorean_triple)（所以 3^2 + 4^2 + 25^2 == 5^2 + 7^2 + 24^2，平方和不起作用）。如果我们使用[费马大定理](http://en.wikipedia.org/wiki/Fermat%27s_Last_Theorem)，我们知道这对于 n^3 是不会发生的。但是我们也不知道是否没有 x + y + z = n （除非我们知道但我不知道）。所以不能保证这也不会中断——如果我们继续沿着这条路走下去，我们很快就会用完比特。

然而，在我的喜悦中，我忘记指出你可以打破平方和，但这样做你会创建一个无效的正常和。我不认为你可以两者都做，但是，正如已经指出的那样，我们都没有任何证据。

* * *

我必须说，找到反例有时比证明事情容易得多！考虑以下序列，它们的总和为 28，平方和为 140：

```
[1, 2, 3, 4, 5, 6, 7]
[1, 1, 4, 5, 5, 6, 6] 
[2, 2, 3, 3, 4, 7, 7] 
```

我找不到长度为 6 或更短的任何此类示例。如果您也想要一个具有正确最小值和最大值的示例，请尝试长度为 8 的示例：

```
[1, 3, 3, 4, 4, 5, 8, 8] 
```

* * *

## 更简单的方法（修改 hazzen 的想法）：

长度为 m 的整数数组包含从 n 到 n+m-1 的所有数字恰好一次当且仅当

*   每个数组元素都在 n 和 n+m-1 之间
*   没有重复

（原因：在给定的整数范围内只有 m 个值，所以如果数组在这个范围内包含 m 个唯一值，则它必须每个都包含一次）

如果您被允许修改数组，您可以使用 hazzen 算法思想的修改版本一次性检查列表（无需进行任何求和）：

*   对于从 0 到 m-1 的所有数组索引 i
    1.  如果 array[i] < n 或 array[i] >= n+m => RETURN FALSE（“发现值超出范围”）
    2.  计算 j = array[i] - n（这是从 n 到 n+m-1的*排序数组中 array[i] 从 0 开始的位置）*
    3.  虽然 j 不等于 i
        1.  如果 list[i] 等于 list[j] => RETURN FALSE ("duplicate found")
        2.  将 list[i] 与 list[j] 交换
        3.  重新计算 j = array[i] - n
*   返回真

我不确定原始数组的修改是否计入 O(1) 的最大允许额外空间，但如果不是，这应该是原始发布者想要的解决方案。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-08T12:02:36.243

通过与您合作`a[i] % a.length`而不是您将问题减少到`a[i]`需要确定您已获得数字。`0``a.length - 1`

我们认为这个观察是理所当然的，并尝试检查数组是否包含 [0,m)。

找到第一个不在正确位置的节点，例如

```
0 1 2 3 7 5 6 8 4 ;     the original dataset (after the renaming we discussed)
        ^
        `---this is position 4 and the 7 shouldn't be here 
```

将该号码交换到*应有*的位置。即交换`7`与`8`：

```
0 1 2 3 8 5 6 7 4 ; 
        |     `--------- 7 is in the right place.
        `--------------- this is now the 'current' position 
```

现在我们重复这一点。再看看我们当前的位置，我们问：

“这里的号码是正确的吗？”

*   如果不是，我们将其交换到正确的位置。
*   如果它在正确的位置，我们向右移动并再次执行此操作。

再次遵循这个规则，我们得到：

```
0 1 2 3 4 5 6 7 8 ;     4 and 8 were just swapped 
```

这将逐渐正确地从左到右建立列表，每个数字最多移动一次，因此这是 O(n)。

如果有骗子，我们会在尝试交换`backwards`列表中的数字时立即注意到它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T04:36:53.557

为什么其他解决方案使用每个值的总和？我认为这是有风险的，因为当您将 O(n) 个项目加在一起成为一个数字时，从技术上讲，您使用的空间超过了 O(1) 个。

更简单的方法：

第1步，找出是否有任何重复。我不确定这在 O(1) 空间中是否可行。无论如何，如果有重复，则返回 false。

第 2 步，遍历列表，跟踪**最低**和**最高**项目。

第 3 步，（最高 - 最低）是否等于 m ？如果是，则返回 true。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-14T05:44:49.300

任何一次性算法都需要 Omega(n) 位的存储空间。

相反，假设存在使用 o(n) 位的一次性算法。因为它只通过一次，它必须汇总 o(n) 空间中的前 n/2 个值。由于有 C(n,n/2) = 2^Theta(n) 从 S = {1,...,n} 中抽取的 n/2 个可能的集合，因此存在两个不同的集合 A 和 B 的 n/ 2个值，使得两者之后的内存状态相同。如果 A' = S \ A 是补充 A 的“正确”值集，则算法可能无法正确回答输入

A A' - 是的

B A' - 没有

因为它无法区分第一种情况和第二种情况。

量子点

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-07T08:51:46.427

## 这是 O(n) 中的工作解决方案

这是使用 Hazzen 建议的伪代码加上我自己的一些想法。它也适用于负数，不需要任何平方和的东西。

```
function testArray($nums, $n, $m) {
    // check the sum. PHP offers this array_sum() method, but it's
    // trivial to write your own. O(n) here.
    if (array_sum($nums) != ($m * ($m + 2 * $n - 1) / 2)) {
        return false;    // checksum failed.
    }
    for ($i = 0; $i < $m; ++$i) {
        // check if the number is in the proper range
        if ($nums[$i] < $n || $nums[$i] >= $n + $m) {
            return false;  // value out of range.
        }

        while (($shouldBe = $nums[$i] - $n) != $i) {
            if ($nums[$shouldBe] == $nums[$i]) {
                return false;    // duplicate
            }
            $temp = $nums[$i];
            $nums[$i] = $nums[$shouldBe];
            $nums[$shouldBe] = $temp;
        }
    }
    return true;    // huzzah!
}

var_dump(testArray(array(1, 2, 3, 4, 5), 1, 5));  // true
var_dump(testArray(array(5, 4, 3, 2, 1), 1, 5));  // true
var_dump(testArray(array(6, 4, 3, 2, 0), 1, 5));  // false - out of range
var_dump(testArray(array(5, 5, 3, 2, 1), 1, 5));  // false - checksum fail
var_dump(testArray(array(5, 4, 3, 2, 5), 1, 5));  // false - dupe
var_dump(testArray(array(-2, -1, 0, 1, 2), -2, 5)); // true 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-07T04:52:50.387

不久前，我从一个为电话公司工作的人那里听说了一个非常聪明的排序算法。他们必须对大量电话号码进行分类。在经历了一堆不同的排序策略之后，他们终于找到了一个非常优雅的解决方案：他们只是创建了一个位数组，并将位数组中的偏移量视为电话号码。然后，他们单次扫描他们的数据库，将每个数字的位更改为 1。之后，他们扫描了一次位数组，吐出电话号码以查找该位设置为高的条目。

按照这些思路，我相信您可以将数组本身中的数据用作元数据结构来查找重复项。最坏的情况，你可以有一个单独的数组，但我很确定如果你不介意交换一点，你可以使用输入数组。

我将暂时省略 n 参数，b/c 只会混淆事物 - 添加索引偏移量很容易做到。

考虑：

```
for i = 0 to m
  if (a[a[i]]==a[i]) return false; // we have a duplicate
  while (a[a[i]] > a[i]) swapArrayIndexes(a[i], i)
  sum = sum + a[i]
next

if sum = (n+m-1)*m return true else return false 
```

这不是 O(n) - 可能更接近 O(n Log n) - 但它确实提供了恒定空间，并且可能为问题提供不同的攻击向量。

如果我们想要 O(n)，那么使用字节数组和一些位操作将为重复检查提供额外的 n/32 字节内存使用（当然，假设是 32 位整数）。

编辑：上述算法可以通过将总和检查添加到循环内部来进一步改进，并检查：

```
if sum > (n+m-1)*m return false 
```

这样它会很快失败。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-07T05:33:14.080

如果我错了，请投票给我，但我认为我们可以确定是否存在重复或不使用方差。因为我们事先知道平均值（n + (m-1)/2 或类似的东西），所以我们可以将数字和差的平方相加来表示总和是否与方程匹配（mn + m(m-1 )/2)，方差为 (0 + 1 + 4 + ... + (m-1)^2)/m。如果方差不匹配，很可能我们有重复。

**编辑：**方差应该是 (0 + 1 + 4 + ... + [(m-1)/2]^2)*2/m，因为一半的元素小于平均值，另一半是大于平均值。

如果存在重复项，则上述方程中的一项将与正确序列不同，即使另一个重复项完全抵消了均值的变化。因此，仅当总和和方差都与我们可以预先计算的所需值匹配时，该函数才返回 true。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-10T02:16:05.663

假设您只知道数组的长度并且您可以修改数组，它可以在 O(1) 空间和 O(n) 时间内完成。

该过程有两个简单的步骤。1.“模排序”数组。[5,3,2,4] => [4,5,2,3] (O(2n)) 2\. 检查每个值的邻居是否比自身高一个（模）（O(n)）

总而言之，您最多需要 3 次通过数组。

模排序是“棘手”的部分，但目标很简单。获取数组中的每个值并将其存储在其自己的地址（模长度）。这需要遍历数组，循环遍历每个位置，通过将其交换到正确位置并在其目的地移动值来“驱逐”其值。如果您移动的值与您刚刚驱逐的值一致，则您有一个副本并且可以提前退出。最坏的情况是 O(2n)。

检查是一次通过数组检查每个值及其下一个最高邻居。总是 O(n)。

组合算法为 O(n)+O(2n) = O(3n) = O(n)

我的解决方案中的伪代码：

```
foreach(值[])
  而（值[i] 与 i 不一致）
    被驱逐=值[i]
    evict(values[i]) // 交换到它的“正确”位置
    if(values[i]%length == 被驱逐%length)
      返回假；// 当我们驱逐那个数字时，一个“重复”到达
  结束时
结束 foreach
foreach(值[])
  if((值[i]+1)%length != 值[i+1]%length)
    返回假
结束 foreach

```

我在下面包含了 Java 代码概念证明，它并不漂亮，但它通过了我为它所做的所有单元测试。我称它们为“StraightArray”，因为它们对应于顺子的扑克手（忽略花色的连续序列）。

```
public class StraightArray {    
    static int evict(int[] a, int i) {
        int t = a[i];
        a[i] = a[t%a.length];
        a[t%a.length] = t;
        return t;
    }
    static boolean isStraight(int[] values) {
        for(int i = 0; i < values.length; i++) {
            while(values[i]%values.length != i) {
                int evicted = evict(values, i);
                if(evicted%values.length == values[i]%values.length) {
                    return false;
                }
            }
        }
        for(int i = 0; i < values.length-1; i++) {
            int n = (values[i]%values.length)+1;
            int m = values[(i+1)]%values.length;
            if(n != m) {
                return false;
            }
        }
        return true;
    }
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-07-26T15:48:57.563

## Hazzen 在 C 中的算法实现

```
#include<stdio.h>

#define swapxor(a,i,j) a[i]^=a[j];a[j]^=a[i];a[i]^=a[j];

int check_ntom(int a[], int n, int m) {
    int i = 0, j = 0;
    for(i = 0; i < m; i++) {
        if(a[i] < n || a[i] >= n+m) return 0;   //invalid entry
        j = a[i] - n;
        while(j != i) {
            if(a[i]==a[j]) return -1;           //bucket already occupied. Dupe.
            swapxor(a, i, j);                   //faster bitwise swap
            j = a[i] - n;
            if(a[i]>=n+m) return 0;             //[NEW] invalid entry
        }
    }
    return 200;                                 //OK
}

int main() {
    int n=5, m=5;
    int a[] = {6, 5, 7, 9, 8};
    int r = check_ntom(a, n, m);
    printf("%d", r);
    return 0;
} 
```

**编辑：对代码进行更改以消除非法内存访问。**

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-01-17T02:14:06.023

```
boolean determineContinuousArray(int *arr, int len)
{
    // Suppose the array is like below:
    //int arr[10] = {7,11,14,9,8,100,12,5,13,6};
    //int len = sizeof(arr)/sizeof(int);

    int n = arr[0];

    int *result = new int[len];
    for(int i=0; i< len; i++)
            result[i] = -1;
    for (int i=0; i < len; i++)
    {
            int cur = arr[i];
            int hold ;
            if ( arr[i] < n){
                    n = arr[i];
            }
            while(true){
                    if ( cur - n >= len){
                            cout << "array index out of range: meaning this is not a valid array" << endl;
                            return false;
                    }
                    else if ( result[cur - n] != cur){
                            hold = result[cur - n];
                            result[cur - n] = cur;
                            if (hold == -1) break;
                            cur = hold;

                    }else{
                            cout << "found duplicate number " << cur << endl;
                            return false;
                    }

            }
    }
    cout << "this is a valid array" << endl;
    for(int j=0 ; j< len; j++)
            cout << result[j] << "," ;
    cout << endl;
    return true;
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-07T09:52:57.303

ciphwn 是对的。这一切都与统计有关。从统计学的角度来看，问题是数字序列是否形成离散的均匀分布。离散均匀分布是指一组有限的可能值中的所有值均等概率。幸运的是，有一些有用的公式可以确定离散集是否一致。首先，确定集合 (a..b) 的平均值为 (a+b)/2，方差为 (nn-1)/12。接下来，确定给定集合的方差：

```
variance = sum [i=1..n] (f(i)-mean).(f(i)-mean)/n 
```

然后与预期方差进行比较。这将需要对数据进行两次传递，一次是确定平均值，一次是计算方差。

参考：

*   [均匀离散分布](http://mathworld.wolfram.com/UniformDistribution.html)
*   [方差](http://mathworld.wolfram.com/Variance.html)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-05-20T21:46:34.980

哎呀！我陷入了一个重复的问题，在这里没有看到已经相同的解决方案。我以为我终于做了一些原创的事情！这是我稍微高兴一点的历史档案：

* * *

好吧，我不确定这个算法是否满足所有条件。事实上，我什至还没有验证它是否适用于我尝试过的几个测试用例。即使我的算法确实有问题，希望我的方法能激发一些解决方案。

据我所知，该算法在恒定内存中工作并扫描数组三次。也许一个额外的好处是它适用于整个整数范围，如果这不是原始问题的一部分的话。

我不是一个伪代码人，我真的认为代码可能比文字更有意义。这是我用 PHP 编写的一个实现。注意评论。

```
function is_permutation($ints) {

  /* Gather some meta-data. These scans can
     be done simultaneously */
  $lowest = min($ints);
  $length = count($ints);

  $max_index = $length - 1;

  $sort_run_count = 0;

  /* I do not have any proof that running this sort twice
     will always completely sort the array (of course only
     intentionally happening if the array is a permutation) */

  while ($sort_run_count < 2) {

    for ($i = 0; $i < $length; ++$i) {

      $dest_index = $ints[$i] - $lowest;

      if ($i == $dest_index) {
        continue;
      }

      if ($dest_index > $max_index) {
        return false;
      }

      if ($ints[$i] == $ints[$dest_index]) {
        return false;
      }

      $temp = $ints[$dest_index];
      $ints[$dest_index] = $ints[$i];
      $ints[$i] = $temp;

    }

    ++$sort_run_count;

  }

  return true;

} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-15T10:28:27.023

任何连续数组 [ n, n+1, ..., n+m-1 ] 都可以使用模运算符映射到“基本”区间 [ 0, 1, ..., m ]。对于区间中的每个 i，基本区间中恰好有一个 i%m，反之亦然。

任何连续数组也有一个“跨度”m（最大值 - 最小值 + 1）等于它的大小。

使用这些事实，您可以创建一个大小相同的“遇到”布尔数组，最初包含所有错误，并在访问输入数组时，将其相关的“遇到”元素设置为真。

该算法在空间上为 O(n)，在时间上为 O(n)，并检查重复项。

```
def contiguous( values )
    #initialization
    encountered = Array.new( values.size, false )
    min, max = nil, nil
    visited = 0

    values.each do |v|

        index = v % encountered.size

        if( encountered[ index ] )
            return "duplicates"; 
        end

        encountered[ index ] = true
        min = v if min == nil or v < min
        max = v if max == nil or v > max 
        visited += 1
    end

    if ( max - min + 1 != values.size ) or visited != values.size
        return "hole"
    else
        return "contiguous"
    end

end

tests = [ 
[ false, [ 2,4,5,6 ] ], 
[ false, [ 10,11,13,14 ] ] , 
[ true , [ 20,21,22,23 ] ] , 
[ true , [ 19,20,21,22,23 ] ] ,
[ true , [ 20,21,22,23,24 ] ] ,
[ false, [ 20,21,22,23,24+5 ] ] ,
[ false, [ 2,2,3,4,5 ] ]
]

tests.each do |t|
    result = contiguous( t[1] )
    if( t[0] != ( result == "contiguous" ) )
        puts "Failed Test : " + t[1].to_s + " returned " + result
    end
end 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-06-17T21:35:03.843

我喜欢 Greg Hewgill 的基数排序思想。要查找重复项，您可以在给定此数组中值的约束的情况下在 O(N) 时间内进行排序。

对于恢复列表原始顺序的就地 O(1) 空间 O(N) 时间，您不必对该数字进行实际交换；你可以用一个标志来标记它：

```
//Java: assumes all numbers in arr > 1
boolean checkArrayConsecutiveRange(int[] arr) {

// find min/max
int min = arr[0]; int max = arr[0]
for (int i=1; i<arr.length; i++) {
    min = (arr[i] < min ? arr[i] : min);
    max = (arr[i] > max ? arr[i] : max);
}
if (max-min != arr.length) return false;

// flag and check
boolean ret = true;
for (int i=0; i<arr.length; i++) {
    int targetI = Math.abs(arr[i])-min;
    if (arr[targetI] < 0) {
        ret = false; 
        break;
    }
    arr[targetI] = -arr[targetI];
}
for (int i=0; i<arr.length; i++) {
    arr[i] = Math.abs(arr[i]);
}

return ret;
} 
```

将标志存储在给定的数组中是一种欺骗，并且不能很好地与并行化配合使用。我仍在尝试想办法做到这一点，而无需在 O(N) 时间和 O(log N) 空间中接触数组。检查总和和最小二乘之和 (arr[i] - arr.length/2.0)^2 感觉它可能有效。我们所知道的关于没有重复的 0...m 数组的一个定义特征是它是均匀分布的。我们应该检查一下。

现在，只要我能证明这一点。

我想指出，上面涉及阶乘的解决方案需要 O(N) 空间来存储阶乘本身。N！> 2^N，需要 N 个字节来存储。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-31T20:52:01.943

一个数组包含 N 个数字，您想确定其中两个数字之和是否等于给定数字 K。例如，如果输入是 8,4、1,6，K 是 10，则答案是肯定的（4 和 6 ）。一个数字可以使用两次。请执行下列操作。一个。给出一个 O(N2) 算法来解决这个问题。湾。给出一个 O(N log N) 算法来解决这个问题。（提示：首先对项目进行排序。这样做后，您可以在线性时间内解决问题。） c．对两种解决方案进行编码并比较算法的运行时间。4.

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-09T17:29:52.340

# [Kent Fredric 的 Ruby 解决方案的](https://stackoverflow.com/questions/177118/algorithm-to-determine-if-array-contains-nnm#177145)AC 版本

（方便测试）

反例（针对 C 版本）：{8, 33, 27, 30, 9, 2, 35, 7, 26, 32, 2, 23, 0, 13, 1, 6, 31, 3, 28, 4, 5、18、12、2、9、14、17、21、19、22、15、20、24、11、10、16、25}。这里n=0，m=35。此序列未命中`34`并有两个`2`.

它在时间上是 O(m)，在空间上是 O(1)。

在时间 O(n) 和空间 O(1) 中很容易检测到超出范围的值，因此测试集中在范围内（意味着所有值都在有效范围内`[n, n+m)`）序列。否则*`{1, 34}`是一个反例*（对于 C 版本，sizeof(int)==4，数字的标准二进制表示）。

C 和 Ruby 版本之间的主要区别： `<<`由于 sizeof(int) 有限，​​运算符将旋转 C 中的值，但在 Ruby 中，数字会增长以适应结果，例如，

红宝石：`1 << 100 # -> 1267650600228229401496703205376`

C：`int n = 100; 1 << n // -> 16`

在 Ruby 中：`check_index ^= 1 << i;`相当于`check_index.setbit(i)`. 在 C++ 中可以实现相同的效果：`vector<bool> v(m); v[i] = true;`

```
bool isperm_fredric(int m; int a[m], int m, int n)
{
  /**
     O(m) in time (single pass), O(1) in space,
     no restriction on n,
     ?overflow?
     a[] may be readonly
   */
  int check_index = 0;
  int check_value = 0;

  int min = a[0];
  for (int i = 0; i < m; ++i) {

    check_index ^= 1 << i;
    check_value ^= 1 << (a[i] - n); //

    if (a[i] < min)
      min = a[i];
  }
  check_index <<= min - n; // min and n may differ e.g., 
                           //  {1, 1}: min=1, but n may be 0.
  return check_index == check_value;
} 
```

上述函数的值已针对以下代码进行了测试：

```
bool *seen_isperm_trusted  = NULL;
bool isperm_trusted(int m; int a[m], int m, int n)
{
  /** O(m) in time, O(m) in space */

  for (int i = 0; i < m; ++i) // could be memset(s_i_t, 0, m*sizeof(*s_i_t));
    seen_isperm_trusted[i] = false;

  for (int i = 0; i < m; ++i) {

    if (a[i] < n or a[i] >= n + m)
      return false; // out of range

    if (seen_isperm_trusted[a[i]-n])
      return false; // duplicates
    else
      seen_isperm_trusted[a[i]-n] = true;
  }

  return true; // a[] is a permutation of the range: [n, n+m)
} 
```

输入数组通过以下方式生成：

```
void backtrack(int m; int a[m], int m, int nitems)
{
  /** generate all permutations with repetition for the range [0, m) */
  if (nitems == m) {
    (void)test_array(a, nitems, 0); // {0, 0}, {0, 1}, {1, 0}, {1, 1}
  }
  else for (int i = 0; i < m; ++i) {
      a[nitems] = i;
      backtrack(a, m, nitems + 1);
    }
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-09T19:22:53.187

# [b3的伪代码](https://stackoverflow.com/questions/177118/algorithm-to-determine-if-array-contains-nnm#177566)AC版

（避免对伪代码的误解）

反例：`{1, 1, 2, 4, 6, 7, 7}`.

```
int pow_minus_one(int power)
{
  return (power % 2 == 0) ? 1 : -1;
}

int ceil_half(int n)
{
  return n / 2 + (n % 2);
}

bool isperm_b3_3(int m; int a[m], int m, int n)
{
  /**
     O(m) in time (single pass), O(1) in space,
     doesn't use n
     possible overflow in sum
     a[] may be readonly
   */
  int altsum = 0;
  int mina = INT_MAX;
  int maxa = INT_MIN;

  for (int i = 0; i < m; ++i)
    {
      const int v = a[i] - n + 1; // [n, n+m-1] -> [1, m] to deal with n=0
      if (mina > v)
        mina = v;
      if (maxa < v)
        maxa = v;

      altsum += pow_minus_one(v) * v;
    }
  return ((maxa-mina == m-1)
          and ((pow_minus_one(mina + m-1) * ceil_half(mina + m-1)
                - pow_minus_one(mina-1) * ceil_half(mina-1)) == altsum));
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-07T03:26:18.253

```
def test(a, n, m):
    seen = [False] * m
    for x in a:
        if x < n or x >= n+m:
            return False
        if seen[x-n]:
            return False
        seen[x-n] = True
    return False not in seen

print test([2, 3, 1], 1, 3)
print test([1, 3, 1], 1, 3)
print test([1, 2, 4], 1, 3) 
```

请注意，这只会通过第一个数组，而不考虑`not in`. :)

我也可以使用 python `set`，但我选择了`set`无需考虑性能特征的直接解决方案。

更新：Smashery 指出我错误地解析了“恒定的内存量”，而这个解决方案实际上并没有解决问题。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-07T03:36:14.473

我目前的最佳选择

```
def uniqueSet( array )
  check_index = 0; 
  check_value = 0; 
  min = array[0];
  array.each_with_index{ |value,index|
         check_index = check_index ^ ( 1 << index );
         check_value = check_value ^ ( 1 << value );
         min = value if value < min
  } 
  check_index =  check_index  << min;
  return check_index == check_value; 
end 
```

O(n) 和空间 O(1)

我写了一个脚本来蛮力组合，这可能会失败，但它没有找到任何东西。如果您有一个违反此功能的数组，请告知。:)

* * *

@JF塞巴斯蒂安

它不是真正的哈希算法。从技术上讲，它是一个高效的“已见”值的打包布尔数组。

```
ci = 0, cv = 0
[5,4,3]{ 
  i = 0 
  v = 5 
  1 << 0 == 000001
  1 << 5 == 100000
  0 ^ 000001  = 000001
  0 ^ 100000  = 100000

  i = 1
  v = 4 
  1 << 1 == 000010
  1 << 4 == 010000
  000001 ^ 000010  = 000011
  100000 ^ 010000  = 110000 

  i = 2
  v = 3 
  1 << 2 == 000100
  1 << 3 == 001000
  000011 ^ 000100  = 000111
  110000 ^ 001000  = 111000 
}
min = 3 
000111 << 3 == 111000
111000 === 111000 
```

这主要是为了“伪造”大多数问题案例，人们使用重复项来做到这一点。在这个系统中，异或会惩罚你两次使用相同的值，并假设你做了 0 次。

这里的警告当然是：

1.  `$x`输入数组长度和最大数组值都受in的最大值限制`( 1 << $x > 0 )`
2.  最终效果取决于您的底层系统如何实现以下能力：

    1.  右移 1 位 n 位。
    2.  异或 2 个寄存器。（根据实现，“寄存器”可能跨越多个寄存器）

    **编辑** 注意，上述陈述似乎令人困惑。假设一台完美的机器，其中“整数”是具有无限精度的寄存器，它仍然可以在 O(1) 时间内执行 a ^ b。

但是如果没有这些假设，就必须开始询问简单数学的算法复杂性。

*   1 == 1 有多复杂？肯定每次都应该是 O(1) 吧？
*   2^32 == 2^32 怎么样。
*   奥（1）？2^33 == 2^33？现在您遇到了寄存器大小和底层实现的问题。
*   幸运的是 XOR 和 == 可以并行完成，所以如果一个假设有无限精度并且机器设计为处理无限精度，则可以安全地假设 XOR 和 == 不管它们的值如何都花费恒定的时间（因为它的无限宽度，它将有无限的 0 填充。显然这不存在。而且，将 000000 更改为 000100 并不会增加内存使用量。
*   然而在某些机器上， ( 1 << 32 ) << 1*会*消耗更多的内存，但有多少是不确定的。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-10-07T04:00:48.650

**注意**：此评论基于问题的原始文本（此后已更正）

如果问题的提出与上面写的*完全*一样（而且它不仅仅是一个错字）并且对于大小为 n 的数组，如果数组由数字 1...n+1 组成，则函数应该返回（真/假），

...那么答案总是错误的，因为所有数字为 1...n+1 的数组的大小为 n+1 而不是 n。因此这个问题可以在 O(1) 中得到回答。:)

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-10-07T04:55:13.377

> 为什么其他解决方案使用每个值的总和？我认为这是有风险的，因为当您将 O(n) 个项目加在一起成为一个数字时，从技术上讲，您使用的空间超过了 O(1) 个。

O(1) 表示不变的空间，不会因 n 的数量而变化。只要它是一个常数，它是1个还是2个变量都没有关系。你为什么说它不仅仅是 O(1) 空间？如果您通过将 n 个数字的总和累积在一个临时变量中来计算它，那么无论如何您都将使用 1 个变量。

在答案中发表评论是因为系统还不允许我写评论。

更新（回复评论）：在这个答案中，我的意思是 O(1) 空间，其中省略了“空间”或“时间”。引用的文本是早期答案的一部分，这是对它的回复。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-10-07T04:55:31.880

如果你想知道数字的总和，`[n ... n + m - 1]`只需使用这个等式。

```
var sum = m * (m + 2 * n - 1) / 2; 
```

这适用于任何数字，无论是正数还是负数，即使 n 是小数。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-10-07T08:30:05.393

鉴于这种 -

> 编写一个采用大小为 m的**int 数组的方法...**

我想可以公平地得出结论，m 有一个上限，等于最大**int**的值（典型值为 2^32）。*换句话说，即使 m 未指定为 int，但数组不能有重复项这一事实意味着不能超过 32 位可以形成的值的数量，这反过来意味着 m 是也仅限于 int。*

如果这样的结论可以接受，那么我建议使用 (2^33 + 2) * 4 bytes = 34,359,738,376 bytes = 34.4GB 的固定空间来处理所有可能的情况。（不计算输入数组及其循环所需的空间）。

当然，为了优化，我会首先考虑 m，并且只分配实际需要的数量，(2m+2) * 4 字节。

如果这对于 O(1) 空间约束是可以接受的 -*对于所述问题*- 那么让我继续提出算法建议...... :)

**假设**： m 个整数的数组，正数或负数，不大于 4 个字节可以容纳的值。重复处理。第一个值可以是任何有效的 int。如上所述限制 m。

*首先*，创建一个长度为 2m-1 的 int 数组**ary**，并提供三个 int 变量：**left**、**diff**和**right**。请注意，使 2m+2...

*其次*，从输入数组中取出第一个值并将其复制到新数组中的 m-1 位置。初始化三个变量。

*   设置**ary** [m-1] - nthVal // n=0
*   设置**左**=**差异**=**右**= **0**

*第三*，遍历输入数组中的剩余值，并为每次迭代执行以下操作：

*   设置**差异**= nthVal - **ary** [m-1]
*   if ( **diff** > m-1 + **right** || **diff** < 1-m + **left** ) return false // 越界
*   if ( **ary** [m-1+ **diff** ] != null) return false // 重复
*   设置**ary** [m-1+ **diff** ] = nthVal
*   if ( **diff** > **left** ) **left** = **diff** // 进一步限制左边界
*   if ( **diff** < **right** ) **right** = **diff** // 将右边界进一步向左约束

我决定把它放在代码中，它起作用了。

这是使用 C# 的工作示例：

```
public class Program
{
    static bool puzzle(int[] inAry)
    {
        var m = inAry.Count();
        var outAry = new int?[2 * m - 1];
        int diff = 0;
        int left = 0;
        int right = 0;
        outAry[m - 1] = inAry[0];
        for (var i = 1; i < m; i += 1)
        {
            diff = inAry[i] - inAry[0];
            if (diff > m - 1 + right || diff < 1 - m + left) return false;
            if (outAry[m - 1 + diff] != null) return false;
            outAry[m - 1 + diff] = inAry[i];
            if (diff > left) left = diff;
            if (diff < right) right = diff;
        }
        return true;
    }

    static void Main(string[] args)
    {
        var inAry = new int[3]{ 2, 3, 4 };
        Console.WriteLine(puzzle(inAry));
        inAry = new int[13] { -3, 5, -1, -2, 9, 8, 2, 3, 0, 6, 4, 7, 1 };
        Console.WriteLine(puzzle(inAry));
        inAry = new int[3] { 21, 31, 41 };
        Console.WriteLine(puzzle(inAry));
        Console.ReadLine();
    }

} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-10-08T23:33:34.307

# [XOR 算法](https://stackoverflow.com/questions/177118/algorithm-to-determine-if-array-contains-nnm#177659)的反例。

（不能作为评论发表）

@popopome

因为`a = {0, 2, 7, 5,}`它返回`true`（意味着这`a`是范围的排列`[0, 4)`），但`false`在这种情况下它必须返回（`a`显然不是 的排列`[0, 4)`）。

另一个反例：`{0, 0, 1, 3, 5, 6, 6}`-- 所有值都在范围内，但有重复项。

我可能会错误地实现 popopome 的想法（或测试），因此这里是代码：

```
bool isperm_popopome(int m; int a[m], int m, int  n)
{
  /** O(m) in time (single pass), O(1) in space,
      no restrictions on n,
      no overflow,
      a[] may be readonly
  */
  int even_xor = 0;
  int odd_xor  = 0;

  for (int i = 0; i < m; ++i)
    {
      if (a[i] % 2 == 0) // is even
        even_xor ^= a[i];
      else
        odd_xor ^= a[i];

      const int b = i + n;
      if (b % 2 == 0)    // is even
        even_xor ^= b;
      else
        odd_xor ^= b;
    }

  return (even_xor == 0) && (odd_xor == 0);
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-10-10T01:26:16.183

在 Python 中：

```
def ispermutation(iterable, m, n):
    """Whether iterable and the range [n, n+m) have the same elements.

       pre-condition: there are no duplicates in the iterable
    """ 
    for i, elem in enumerate(iterable):
        if not n <= elem < n+m:
            return False

    return i == m-1

print(ispermutation([1, 42], 2, 1)    == False)
print(ispermutation(range(10), 10, 0) == True)
print(ispermutation((2, 1, 3), 3, 1)  == True)
print(ispermutation((2, 1, 3), 3, 0)  == False)
print(ispermutation((2, 1, 3), 4, 1)  == False)
print(ispermutation((2, 1, 3), 2, 1)  == False) 
```

它在时间上是 O(m)，在空间上是 O(1)。它不**考虑**重复。

替代解决方案：

```
def ispermutation(iterable, m, n): 
    """Same as above.

    pre-condition: assert(len(list(iterable)) == m)
    """
    return all(n <= elem < n+m for elem in iterable) 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2010-05-21T22:07:30.503

所以有一种算法采用 O(n^2)，不需要修改输入数组并占用恒定空间。

首先，假设您知道`n`和`m`。这是一个线性操作，因此不会增加任何额外的复杂性。接下来，假设存在一个元素等于`n`和一个元素等于，`n+m-1`其余的都在 中`[n, n+m)`。鉴于此，我们可以将问题简化为包含元素的数组`[0, m)`。

现在，由于我们知道元素受数组大小的限制，我们可以将每个元素视为一个节点，它具有指向另一个元素的单个链接；换句话说，数组描述了一个有向图。在这个有向图中，如果没有重复元素，则每个节点都属于一个循环，即一个节点可以从自身到达，`m`或者更少的步长。如果存在重复元素，则存在一个根本无法从其自身到达的节点。

因此，要检测到这一点，您需要从头到尾遍历整个数组，并确定每个元素是否`<=m`逐步返回自身。如果在步骤中无法访问任何元素`<=m`，则您有重复并且可以返回 false。否则，当您访问完所有元素时，您可以返回 true：

```
for (int start_index= 0; start_index<m; ++start_index)
{
    int steps= 1;
    int current_element_index= arr[start_index];
    while (steps<m+1 && current_element_index!=start_index)
    {
        current_element_index= arr[current_element_index];
        ++steps;
    }

    if (steps>m)
    {
        return false;
    }
}

return true; 
```

您可以通过存储其他信息来优化它：

1.  记录每个元素的循环长度之和，除非循环访问该元素之前的元素，否则调用它`sum_of_steps`。
2.  对于每个元素，仅`m-sum_of_steps`将节点移出。如果不返回起始元素，也没有访问起始元素之前的元素，则发现循环包含重复元素，可以返回`false`。

这仍然是 O(n^2)，例如`{1, 2, 3, 0, 5, 6, 7, 4}`，但它有点快。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-11-21T04:30:14.860

如果数组未排序，则来自“nickf”的答案不起作用 var_dump(testArray(array(5, 3, 1, 2, 4), 1, 5)); //给出“重复”！！！！

此外，您计算 sum([n...n+m-1]) 的公式看起来不正确....正确的公式是 (m(m+1)/2 - n(n-1)/2)

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2014-02-11T09:36:30.120

这是在 O(N) 时间和 O(1) 额外空间中查找重复项的解决方案：-

```
public static boolean check_range(int arr[],int n,int m) {

        for(int i=0;i<m;i++) {
            arr[i] = arr[i] - n;
            if(arr[i]>=m)
                return(false);
        }

        System.out.println("In range");

        int j=0;
        while(j<m) {
            System.out.println(j);
            if(arr[j]<m) {

                if(arr[arr[j]]<m) {

                    int t = arr[arr[j]];
                    arr[arr[j]] = arr[j] + m;
                    arr[j] = t;
                    if(j==arr[j]) {

                        arr[j] = arr[j] + m;
                        j++;
                    }

                }

                else return(false);

            }

            else j++;

        } 
```

**解释：-**

> 1.  通过 arr[i] = arr[i] - n 将数字带入范围 (0,m-1) 如果超出范围返回 false。
> 2.  对于每个 i 检查 arr[arr[i]] 是否未被占用，即它的值小于 m
> 3.  如果是这样，交换(arr[i],arr[arr[i]]) 和 arr[arr[i]] = arr[arr[i]] + m 表示它已被占用
> 4.  如果 arr[j] = j 并简单地添加 m 并增加 j
> 5.  如果 arr[arr[j]] >=m 表示它被占用，因此当前值是重复的，因此返回 false。
> 6.  如果 arr[j] >= m 然后跳过

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2009-05-14T00:45:00.283

## m个连续数的乘积能被m整除！[m 阶乘]

* * *

因此，您可以一次性计算 m 个数字的乘积，也可以计算 m！看看乘积是否以 m 为模！在通行证结束时为零

我可能会遗漏一些东西，但这就是我想到的......

**在 python 中是这样的**

my_list1 = [9,5,8,7,6]

my_list2 = [3,5,4,7]

def 连续（my_list）：

```
count = 0
prod = fact = 1
for num in my_list:
    prod *= num
    count +=1 
    fact *= count
if not prod % fact: 
    return 1   
else:   
    return 0 
```

连续打印（my_list1）

连续打印（my_list2）

* * *

HotPotato ~$ python m_consecutive.py

1

0

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2009-05-14T14:28:57.780

我提出以下建议：

选择一组*有限*的素数 P_1,P_2,...,P_K，并以每个 P_i 为模计算输入序列中元素的出现次数（减去最小值）。有效序列的模式是已知的。

例如，对于 17 个元素的序列，模 2 我们必须具有轮廓：[9 8]，模 3：[6 6 5]，模 5：[4 4 3 3 3]，等等。

结合使用多个基础的测试，我们获得了越来越精确的概率测试。由于条目受整数大小的限制，因此存在提供精确测试的有限基。这类似于概率伪素性测试。

```
S_i is an int array of size P_i, initially filled with 0, i=1..K
M is the length of the input sequence
Mn = INT_MAX
Mx = INT_MIN

for x in the input sequence:
  for i in 1..K: S_i[x % P_i]++  // count occurrences mod Pi
  Mn = min(Mn,x)  // update min
  Mx = max(Mx,x)  // and max

if Mx-Mn != M-1: return False  // Check bounds

for i in 1..K:
  // Check profile mod P_i
  Q = M / P_i
  R = M % P_i
  Check S_i[(Mn+j) % P_i] is Q+1 for j=0..R-1 and Q for j=R..P_i-1
  if this test fails, return False

return True 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2021-08-09T19:00:58.647

如果数字是正数，有一个简单的解决方案可以一次性使用 O(1) 空间：

```
int max = arr[0];
int min = arr[0];
for (int i = 0; i < n; i++) {
    int x = abs(arr[i]);
    int y = x % n;
    if (arr[y] < 0)
        return false;
    arr[y] = -arr[y];
    if (x > max)
        max = x;
    else if (x < min)
        min = x;
}
return max - min == n - 1; 
```

* * *

## 回答 #32

> 赞同：-1
> 
> 时间：2011-10-22T14:08:01.787

我想问题归结为确保

```
(maximum - minimum + 1) == array_size 
```

这显然可以在 O(N) 时间和 O(1) 空间中完成，如下所示：

```
int check_range(int input[], int N){
    int max = -INFINITY, min = INFINITY, i;
    for(i=0; i<N; i++){
        if(input[i] < min) min=input[i];
        if(input[i] > max) max=input[i];
    }
    return (max - min + 1) == N;
} 
```

请注意，此方法考虑了重复的可能性。请报告解决方案中的任何差异。

* * *

## 回答 #33

> 赞同：-1
> 
> 时间：2008-10-07T08:50:47.660

如何分别对偶数和奇数使用 XOR。考虑位级别而不是整数值本身。

```
bool is_same(const int* a, const int* b, int len)
{
    int even_xor = 0; 
    int odd_xor = 0;

    for(int i=0;i<len;++i)
    {
        if(a[i] & 0x01) odd_xor ^= a[i];
        else even_xor ^= a[i];

        if(b[i] & 0x01) odd_xor ^= b[i];
        else even_xor ^= b[i];
    }

    return (even_xor == 0) && (odd_xor == 0);
} 
```

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2008-11-22T16:39:52.300

# 时间线性，空间常数解`int m`

恒定空间是通过利用符号位来实现的。如果小于ie，则可以对任何可变`int`范围执行此操作，即当输入范围可以转移到范围（如果不是正数）时。在实践中，如果输入是可变的，前提条件几乎总是正确的。`m``INT_MAX``[n, n+m)``[1, m+1)``n`

```
/** gcc -std=c99 ... */
#include <assert.h>
#include <iso646.h>  // and, or
#include <limits.h>  // INT_MIN
#include <stdbool.h> // bool
#include <stdlib.h>  // abs()

bool inrange(int m; int a[m], int m, int n)
{
  /** Whether min(a[]) == n and max(a[]) == n+(m-1)
  */
  if (m == 0) return true; // empty range is a valid range

  // check out-of-range values
  int max = INT_MIN, min = INT_MAX;
  for (int i = 0; i < m; ++i) {
    if (min > a[i]) min = a[i];
    if (max < a[i]) max = a[i];
  }
  return (min == n and max == n+(m-1));
}

bool isperm_minus2(int m; int a[m], int m, int n)
{
  /** O(m) in time, O(1) in space (for 'typeof(m) == typeof(*a) == int')

      Whether a[] is a permutation of the range [n, n+m).

      feature: It marks visited items using a sign bit.
  */
  if (not inrange(a, m, n))
    return false; // out of range

  assert((INT_MIN - (INT_MIN - 1)) == 1); // check n == INT_MIN
  for (int *p = a; p != &a[m]; ++p) {
    *p -= (n - 1); // [n, n+m) -> [1, m+1)
    assert(*p > 0);
  }

  // determine: are there duplicates
  bool has_duplicates = false;
  for (int i = 0; i < m; ++i) {
    const int j = abs(a[i]) - 1;
    assert(j >= 0);
    assert(j < m);
    if (a[j] > 0)
      a[j] *= -1; // mark
    else { // already seen
      has_duplicates = true;
      break;
    }
  }

  // restore the array
  for (int *p = a; p != &a[m]; ++p) {
    if (*p < 0) 
      *p *= -1; // unmark
    // [1, m+1) -> [n, n+m)
    *p += (n - 1);        
  }

  return not has_duplicates; // no duplicates? (+ inrange)
} 
```

* * *

## 回答 #35

> 赞同：-1
> 
> 时间：2008-10-07T04:12:04.027

似乎我们可以通过将所有数字 n...n+m 相乘来检查重复项，然后将该值与没有重复项**m!/(n-1)! 的序列的预期乘积进行比较！**（请注意，这假定序列不可能同时通过预期总和测试**和**预期乘积测试）。

因此，添加到[hazzen 的伪代码](https://stackoverflow.com/revisions/viewmarkup/224981)中，我们有：

```
is_range(int[] nums, int n, int m) {
  sum_to_m := (m * (m + 1)) / 2
  expected_sum := sum_to_m - (n * (n - 1)) / 2
  real_sum := sum(nums)
  expected_product := m! / (n - 1)!
  real_product := product(nums)
  return ((real_sum == expected_sum) && (expected_product == real_product)) 
```

**编辑：**这是我在 Java 中使用平方和检查重复项的解决方案。它还通过将序列从 1 开始来处理任何范围（包括负数）。

```
// low must be less than high
public boolean isSequence(int[] nums, int low, int high) {
    int shift = 1 - low;
    low += shift;
    high += shift;

    int sum = 0;
    int sumSquares = 0;
    for (int i = 0; i < nums.length; i++) {
        int num = nums[i] + shift;

        if (num < low)
            return false;
        else if (num > high)
            return false;

        sum += num;
        sumSquares += num * num;
    }

    int expectedSum = (high * (high + 1)) / 2;

    if (sum != expectedSum)
        return false;

    int expectedSumSquares = high * (high + 1) * (2 * high + 1) / 6;

    if (sumSquares != expectedSumSquares)
        return false;

    return true;
} 
```

* * *

## 回答 #36

> 赞同：-1
> 
> 时间：2008-10-07T04:20:32.667

如果这是一个错字，并且问题是所有数字都在 1...n 范围内，那么：

```
def try_arr(arr):
    n = len(arr)
    return (not any(x<1 or x>n for x in arr)) and sum(arr)==n*(n+1)/2

$ print try_arr([1,2,3])
True

$ print try_arr([1,3,1])
False

$ print try_arr([1,2,4])
False 
```

笔记：

*   我使用的是数字从 1 开始的原始版本的定义。当然可以修改代码以说明从另一个数字开始。

*   如果数组 (n) 的大小已知，您可以修改它以从例如输入文件流式传输数据，并且几乎不使用内存（sum() 中的 1 个临时变量和从流中获取的当前项目的 1 个变量）

*   any() 在 python 2.5 中是新的（但在早期版本的 python 中你有其他方法来表达同样的事情）

*   它使用 O(n) 时间 O(1) 空间。（更新：我写它确实考虑了重复，但显然这不是真的，正如对此处另一个答案的评论所证明的那样）。

* * *

## 回答 #37

> 赞同：-1
> 
> 时间：2008-10-07T04:46:24.753

```
Fail := False;
Sum1 := 0;
Sum2 := 0;
TSum1 := 0;
TSum2 := 0;

For i := 1 to m do
  Begin
    TSum1 := TSum1 + i;
    TSum2 := TSum2 + i * i;
    Item := Array[i] - n;
    If (Item < 0) or (Item >= m) then 
      Fail := True
    Else 
      Begin
        Sum1 := Sum1 + Item;
        Sum2 := Sum2 + Item * Item;
      End;
  End;
Fail := Fail Or (Sum1 <> TSum1) or (Sum2 <> TSum2); 
```

累了，没有编译器，但我认为这给了 O(m) 运行时间并且不能被愚弄。

* * *

## 回答 #38

> 赞同：-1
> 
> 时间：2008-10-07T08:17:24.203

*我认为我在原始帖子中没有很好地解释自己（在实线下方）。例如，对于 [1 2 3 4 5] 的输入，算法计算总和：*

```
-1 + 2 - 3 + 4 - 5 
```

*这应该等于*

```
-1^5 * ceil(5/2) 
```

*下面的伪代码显示了如何检查不从 1 开始的向量。* **该算法处理输入向量未排序和/或包含重复项的情况。**

* * *

以下算法通过计算向量元素的交替和来解决该问题：

```
-1 + 2 - 3 + 4 - 5 + .... + m = (-1)^m * ceil(m/2) 
```

其中**ceil**向上舍入到最接近的整数。换句话说，奇数从运行总数中减去，偶数被添加到它。

```
function test(data, m)
    altSum = 0
    n = Inf
    mCheck = -Inf
    for ii = 1:m
    {
        if data(ii) < n
            n = data(ii)
        if data(ii) > mCheck
            mCheck = data(ii)
        altSum = altSum + (-1)^data(ii) * data(ii)
    }
    if ((mCheck-n+1!=m) || (-1)^(n+m-1) * ceil((n+m-1)/2) - ((-1)^(n-1) * ceil((n-1)/2)) != altSum
        return false
    else
        return true 
```

* * *

## 回答 #39

> 赞同：-2
> 
> 时间：2008-10-09T09:29:12.857

我认为您根本不需要使用总和。只需检查最小值和最大值并检查是否有欺骗性。检查欺骗是较难的部分，因为您事先不知道 n，因此您无法一次性排序。要解决这个问题，请放宽 (edit:destination) 数组的条件。不需要对其进行排序，而是对已排序的序列进行循环移位，以便数组变为 [k,k+1,..., n+m-2, n+m-1,n,n+ 1, ... ,k-2,k-1] 对于一些 k。

使用上述条件，您可以假设 a[0] 已经在正确的位置，那么元素的正确位置`d`是`(d-a[0]) mod m`，假设从零开始的数组索引。例如，使用 [4,?,?,?] 您可以预期 [4,5,6,7] 或 [4,1,2,3] 或 [4,5,6,3] 或 [4,5, 2,3]。

然后只需扫描一次数组，将每个元素放在其计算的位置，更新最小值和最大值并检查冲突。如果没有冲突且max-min=m，则条件成立，否则为假。

# .net - 有人可以提供有关 WWF 的好教程吗？

> ID：177121
> 
> 赞同：2
> 
> 时间：2008-10-07T03:22:16.653
> 
> 标签：.net, workflow-foundation

特别是，我感兴趣的是：1）建立一个*免费*的环境设置来完成工作流程。2）如何使用现有的工作流程项目/状态以及其中涉及的内容。

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-04-17T16:28:06.063

其他答案很好，但我认为让人们了解为什么要使用工作流很重要。许多人在不需要 WF 时使用它，还有一些人在他们的用例最适合 WF 使用时拒绝使用。

我读过的关于何时以及是否使用 WF 的最佳解释是 Dave Green 的[博客文章](http://blogs.msdn.com/b/davegreen/archive/2005/09/17/470704.aspx)。他是第一个版本的 Windows Workflow Foundation 的架构师。

我将它粘贴在这里以供后代使用：

* * *

# 什么是工作流，为什么要麻烦？

当然，工作流是那些严重超载的术语之一，它经常阻碍沟通，所以我最好说出我的意思。

工作流归结为两个想法：有工作要做，工作流将其视为不透明的行为单位；和流程，它描述了什么时候完成的工作。

那么这是一个工作流程吗？

```
public void HandleLoanRequest (string customerID, Application app)
{
    if (CheckCredit(customerId, app.Amount))
    {
        MakeOffer (customerId, app);
    }
} 
```

是的，我相信是的。这项工作是检查客户的信用并提出报价——HandleLoanRequest 定义是否以及何时执行这项工作。

但是，工作流供应商传统上认为在他们宣布胜利之前需要的不仅仅是这种代码，这表明我们仍然缺少一个关键概念。

我相信，这就是我们不仅需要描述流程，还需要以我们可以检查、推理和操作的方式来描述它。简而言之，工作流需要一个模型。

C# 是执行此操作的一种方法 - 例如，我们可以定义允许我们扫描工作流代码并绘制流程图的编码标准。或者我们可以为开发人员定义属性，以调用他的代码中形成模型的部分。这不是我们为 Windows Workflow Foundation 做出的选择——我将在后面的文章中讨论我们为什么选择我们所做的事情——但它会起作用。

但回到为什么我们可能需要一个模型。我们将不得不努力创造它，那何必呢？回报在哪里？（或者牛肉，这个在国外的英国人正在学习如何称呼它）。

好吧，我认为回报来自模型所支持的 -

**可视化** 对开发人员有用，在开发和维护期间，也适用于想知道为什么他们应该做他们被要求做的事情的工作流用户，或者想知道一些行为不端的 IT 运维人员app 达到或应该达到。

**表现** 力 工作流模型是一种领域特定语言，专门用于支持特征问题。一个例子是一个审查过程，其中五个审查中的三个正面投票意味着该文件是好的 - 并且任何未完成的审查都可以被取消。这对代码来说有点乏味，但 Windows Workflow Foundation 包含解决此类问题的开箱即用构造。

**执行** 运行时可以利用模型来消除一遍又一遍地解决相同问题的需要。在 Windows Workflow Foundation 中，我们内置了对长期运行工作流的棘手问题的支持，例如状态管理和补偿——由简单、富有表现力的模型元素控制。

**监控** 模型的存在使得生成具有有意义语义的事件流成为可能，而无需任何额外的开发人员工作。然后可以使用它来监视工作流或聚合的实例。Windows Workflow Foundation 还允许使用从工作流状态中提取的应用程序数据对事件进行声明性修饰 - 这样您就可以知道订单 14532 的信用检查已开始。

**转换** 模型产生模型。一个例子是将工作流模型转换为与之通信所需的消息交换模式——正如 Dharma 和 Don 在 PDC 上所展示的那样。另一个是定制。ISV 提供了一个工作流程，该工作流程由 VAR 定制，然后由客户再次定制。然后 ISV 发布了一个新的基础版本。为工作流使用共享的、易于理解的模型使得后续的 3 路合并更加容易处理。

**组合** 如果将应用程序分解为流程和工作，则工作的原子元素及其易于理解的界面可以被其他工作流程重用。工作流本身是工作的有效定义，也可以被其他工作流使用。

**定制**和转换共同实现了生态系统，其中工作和流程的定义成为共享或交易的工件。

**操纵** 通常需要即时发明或修改工作流程。如果这意味着更改代码，那么安全人员就会出现问题——即使用户知道如何破解它。使用模型使得可以控制和理解的动态操作成为可能。Windows Workflow Foundation 支持工作流类型和工作流实例的动态修改。

就是这样（或者至少，这个星期六下午我想到的所有东西）。这就是为什么我们认为模型是一个好主意，以及为什么我们认为它具有很高的投资回报率。但是，如果这些好处都不适用于您的场景，那么实际上，编码仍然非常酷。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T03:52:56.217

[您是否正在从MSDN](http://blogs.msdn.com/pandrew/archive/2007/04/16/new-msdn-virtual-lab-for-windows-workflow-foundation.aspx)寻找像这样的虚拟实验室？

对于一些操作方法，请尝试下载[适用于 Windows Workflow Foundation 的动手实验室](http://www.microsoft.com/downloadS/details.aspx?familyid=2E575633-E357-4EE7-AAFF-34138F00E830&displaylang=en)

# perl - 如何加快我的 Perl 程序？

> ID：177122
> 
> 赞同：31
> 
> 时间：2008-10-07T03:23:24.687
> 
> 标签：perl, optimization, performance

这确实是两个问题，但它们非常相似，为了简单起见，我想我会把它们放在一起：

*   **首先**：给定一个已建立的 Perl 项目，除了简单的代码内优化之外，还有哪些不错的方法可以加速它？

*   **其次**：在Perl中从头开始编写程序时，有哪些可以大大提高性能的好方法？

对于第一个问题，假设您收到了一个写得很体面的项目，并且您需要提高性能，但您似乎无法通过重构/优化获得太多收益。在这种情况下，除了用 C 语言重写它之外，你会怎么做才能加快它的速度？

**请远离一般的优化技术，除非它们是*Perl 特定*的。**

我之前问过关于[Python](https://stackoverflow.com/questions/172720/speeding-up-python)的问题，我认为对其他语言这样做可能会很好（我特别好奇Perl是否有[Psycho](http://psyco.sourceforge.net/)和[pyrex的推论）。](http://www.cosc.canterbury.ac.nz/greg.ewing/python/Pyrex/)

* * *

## 回答 #1

> 赞同：156
> 
> 时间：2008-10-07T03:29:22.427

请记住优化俱乐部的规则：

1.  优化俱乐部的第一条规则是，你不要优化。
2.  优化俱乐部的第二条规则是，没有衡量就不要优化。
3.  如果您的应用程序运行速度比底层传输协议快，那么优化就结束了。
4.  一次一个因素。
5.  没有市场机器人，没有市场机器人时间表。
6.  只要需要，测试就会继续进行。
7.  如果这是您在优化俱乐部的第一个晚上，您必须编写一个测试用例。

因此，假设您实际上有工作代码，请在[Devel::NYTProf](https://metacpan.org/pod/Devel::NYTProf)下运行您的程序。

找到瓶颈。然后回到这里告诉我们它们是什么。

如果您**没有**工作代码，请先使其工作。您将做的最大的优化就是从不工作到工作。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-10-07T04:43:17.880

Andy 已经提到了[Devel::NYTProf](https://metacpan.org/pod/Devel::NYTProf)。这很棒。真的，真的很棒。用它。

如果由于某种原因你不能使用`Devel::NYTProf`，那么你可以回退到好的旧的[Devel::DProf](https://metacpan.org/pod/Devel::DProf)，它已经成为 Perl 很长一段时间的标准。如果您有*真正*的函数（在数学意义上）需要很长时间来计算（例如，斐波那契数），那么您可能会发现[Memoize](https://metacpan.org/pod/Memoize)提供了一些速度改进。

许多糟糕的性能来自不适当的数据结构和算法。一门好的计算机科学课程可以在这里提供巨大的帮助。如果您有两种做事方式，并且想比较它们的性能，[基准](http://metacpan.org/pod/Benchmark)模块也可以证明是有用的。

以下[Perl 技巧](http://perltraining.com.au/tips/)在这里也可能有用：

*   [使用昂贵的比较进行排序](http://perltraining.com.au/tips/2004-12-17.html)
*   [使用 Devel::DProf 进行分析](http://perltraining.com.au/tips/2005-07-04.html)
*   [Big-O 符号和算法复杂度](http://perltraining.com.au/tips/2007-03-13.html)
*   [在大列表中搜索项目](http://perltraining.com.au/tips/2007-06-18.html)
*   [基准测试基础](http://perltraining.com.au/tips/2007-07-04.html)
*   [记忆](http://perltraining.com.au/tips/2007-07-30.html)

免责声明：我写了上面的一些资源，所以我可能对它们有偏见。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2008-10-07T08:44:49.373

有很多事情你可以改进，所以你首先必须弄清楚什么是慢的。其他人已经回答了这个问题。[我也在Mastering Perl](http://www.masteringperl.org/)中谈到了这一点。

编写新代码时要考虑的事项的不完整列表：

*   使用诸如[Devel::NYTProf 之](http://www.metacpan.org/module/Devel::NYTProf)类的配置文件来查看您在代码中花费的大部分时间。有时这令人惊讶且易于修复。[Mastering Perl](http://www.masteringperl.org/)对此有很多建议。

*   Perl 每次都必须编译源代码，编译速度可能很慢。它必须找到所有文件等等。例如，参见Jean-Louis Leroy 的[“A Timely Start”](http://www.perl.com/pub/2005/12/21/a_timely_start.html)，他仅通过优化`@INC`. 如果您的启动成本昂贵且不可避免，您还可以查看持久性 perls，例如 pperl、mod_perl 等。

*   查看您使用的一些模块。他们是否有很长的依赖链只是为了做简单的事情？当然，我们不喜欢重新发明，但如果你想装在你的车上的轮子也有三艘船、五只山羊和一个芝士汉堡，也许你想建造自己的轮子（或者找一个不同的轮子） .

*   方法调用可能很昂贵。例如，在 Perl::Critic 测试套件中，它的调用会`isa`减慢速度。这并不是在所有情况下都可以真正避免的事情，但要牢记这一点。有人说过一句很棒的名言，比如“没有人介意放弃 2 倍；只有当你有 10 个人在做这件事时，这才是糟糕的。” :) Perl v5.22 对此进行了一些性能改进。

*   如果您一遍又一遍地调用相同的昂贵方法但得到相同的答案，那么像[Memoize](https://metacpan.org/pod/Memoize)这样的东西可能适合您。它是方法调用的代理。如果它真的是一个函数（意思是，相同的输入给出相同的输出而没有副作用），你真的不需要重复调​​用它。

*   [Apache::DBI](https://metacpan.org/pod/Apache::DBI)等模块可以为您重用数据库句柄，以避免昂贵的数据库连接打开。这是非常简单的代码，因此即使您不使用 Apache，也可以向您展示如何做到这一点。

*   Perl 不会为你做尾递归优化，所以不要从 Lisp 过来，以为你会制作这些超级快速的递归算法。[您可以轻松地将它们转换为迭代解决方案（我们在Intermediate Perl](http://www.intermediateperl.com)中讨论了这一点。

*   看看你的正则表达式。大量开放式量词（例如`.*`）会导致大量回溯。查看 Jeffrey Freidl 的[Mastering Regular Expressions](http://oreilly.com/catalog/9780596528126/)了解所有血腥细节（以及多种语言）。另请查看[他的正则表达式网站](http://regex.info/)。

*   知道你的 perl 是如何编译的。你真的需要线程和`DDEBUGGING`吗？那些会让你慢一点。查看 perlbench 实用程序以比较不同的 perl 二进制文件。

*   针对不同的 Perls 对您的应用程序进行基准测试。一些较新的版本有加速，但一些较旧的版本对于有限的操作集可能更快。我没有特别的建议，因为我不知道你在做什么。

*   展开工作。你能在其他进程或远程计算机上做一些异步工作吗？让您的程序在其他人解决一些子问题时处理其他事情。Perl 有几个异步和负载转移模块。但请注意，做好这些事情的脚手架可能会失去任何好处。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-10-07T07:59:42.413

无需重写大块，您可以使用[Inline::C](https://metacpan.org/pod/Inline)将任何单个、缓慢的子例程转换为 C。或者直接使用 XS。也可以使用 XS 增量转换 subs。[例如， PPI/PPI::XS](https://metacpan.org/pod/PPI::XS)就是这样做的。

但转向另一种语言始终是最后的手段。也许你应该找一个专业的 Perl 程序员来看看你的代码？更有可能的是，他会发现一些严重影响你表现的特殊性。除此之外，请分析您的代码。请记住，没有灵丹妙药。

关于 psyco 和 pyrex：不，Perl 没有等价物。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-07T03:30:37.793

这只有一半与您的问题有关-但为了文档的利益，我将在此处发布。

最近的[CentOS/Perl 错误修复](https://bugzilla.redhat.com/show_bug.cgi?id=379791)将我们的应用程序的速度提高了两倍以上。对于任何运行 CentOS Perl 并使用 bless/overload 功能的人来说，这是必须的。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-10-08T06:12:31.367

分析您的应用程序 - 使用例如上面提到的分析器。然后你会看到时间在哪里

如果时间花在 CPU 使用率以外的事情上，则需要先减少这些事情 - CPU 易于扩展，而其他事情则不然。

我发现有一些操作特别慢：

*   `keys()`在大哈希上非常糟糕
*   用于`Data::Dumper`调试。在大型结构上使用此功能非常慢。如果可以的话，避免它。我们已经看到了以下代码：

    ```
    use Data::Dumper; 
    $debugstr = Dumper(\%bighash); 
    if ($debugflag_mostlyoff) { log($debugstr); } 
    ```

*   大多数模块都有具有不同性能特征的替代品 - 有些确实非常糟糕。

*   一些正则表达式可能非常慢（很多 .* 等），并且可以用更快的等效表达式替换。正则表达式很容易进行单元测试和性能测试（只需编写一个程序，针对大型模拟数据集在循环中运行它）。最好的正则表达式从可以快速测试的东西开始，例如文字字符串。有时最好不要先寻找你要找的东西，然后“向后看”以检查它是否真的是你要找的东西。优化正则表达式确实有点像我不太擅长的黑魔法。

除非万不得已，否则不要考虑用 C 重写某些东西。从 Perl 调用 C（反之亦然）具有相对较大的开销。如果你能得到一个快速的 Perl 实现，那就更好了。

如果您确实在 C 中重写了某些内容，请尝试以最小化调用开销的方式进行，并调用 perl 运行时（例如，SV* 函数主要复制字符串）。实现这一点的一种方法是创建一个 C 函数，它可以做更多的事情并减少调用它的次数。在内存中复制字符串并不酷。

另一方面，用 C 重写某些东西会带来很大的风险，因为您可能会引入新的故障模式，例如内存泄漏、崩溃、安全问题。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-10-08T07:36:05.470

关于该主题的一篇非常值得一读的文章是 Nicholas Clark 的演讲[当 perl 不够快时](http://www.perlworkshop.dk/2003/presentations/nwclark/slides.pdf)(PDF)。有些观点有些过时，例如对 Devel::DProf 的引用，但请记住它是在 2002 年编写的。

尽管如此，所涵盖的大部分材料仍然具有相关性。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-10-08T08:16:55.607

Perl 中的方法和子例程调用不是免费的。它们相对昂贵。因此，如果您的分析结果表明您在小型访问器方法中花费了相当大的运行时间，那么这可能是一个值得关注的微优化。

但是，您不应该*在*此处替换诸如 get_color() 之类的访问器：

```
package Car;
# sub new {...}

sub get_color {
   my $self = shift;
   return $self->{color};
}

package main;
#...
my $color = $car->get_color(); 
```

使用破坏封装的直接访问：

```
my $color = $car->{color}; 
```

人们会认为这是不言而喻的，但人们也看到到处都是这样做的。这是您可以使用[Class::XSAccessor 执行的操作](https://metacpan.org/pod/Class::XSAccessor)

```
package Car;
# sub new {...}
use Class::XSAccessor
  getters => {
    get_color => 'color',
  },
  setters => {
    set_color => 'color',
  }; 
```

这会创建在 XS 中实现的新方法 get- 和 set_color()，因此速度大约是手卷版本的两倍。变异器（即“$car->color('red')”）也可用，链式方法也可用。

根据您的应用程序，这可能会给您带来非常小的（但基本上是免费的）提升。除非您正在做一些特殊的事情，否则不要期望超过 1-2%。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-01-12T12:39:11.443

让你的程序运行得更快的最好方法是让你的程序做更少的工作。为工作选择正确的算法。我见过很多缓慢的应用程序，因为它们在代码的某些区域选择了一种愚蠢的算法，被调用了数百万次。当您执行一百万*一百万次操作而不是一百万次操作时，您的程序运行速度将慢一百万倍。字面上地。

例如，这是我看到的一些将元素插入排序列表的代码：

```
while(my $new_item = <>){
    push @list, $new_item;
    @list = sort @list;
    ... use sorted list
} 
```

排序是 O(n log n)。插入排序列表是 O(log n)。

修正算法。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-27T09:22:20.237

最具成本效益的方法可能是考虑更快的硬件（=> 适当的硬件架构）。我说的不是更快的 CPU，而是更快的磁盘、更快的网络……更快的任何东西，真的，加速 I/O。

我在很多年前就经历过这种情况，当时我们将基于 XML 解析的应用程序（当时的前沿技术<g>）从（快速且可靠！）Windows Server 转移到专用的、虽然有些过时的 SUN 平台，但速度更快。 /O 到处都是。

与往常一样，考虑

*   开发人员绩效（编码需要多长时间，问题有多复杂，结果是否可维护），
*   硬件性能，
*   软件性能

并改进对手头问题最有效的地方（成本！）......

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-10T12:46:16.877

如果您的代码需要加速，那么您的测试套件很可能也需要加速。本次演讲主要涉及以下几点：

[涡轮增压测试套件](http://www.slideshare.net/Ovid/turbo-charged-test-suites-presentation)

# c# - 覆盖 DataGridViewTextBoxCell 绘制方法

> ID：177133
> 
> 赞同：3
> 
> 时间：2008-10-07T03:29:38.263
> 
> 标签：c#, winforms

我试图在派生类中覆盖 DataGridViewTextBoxCell 的绘制方法，以便我可以将前景文本缩进一些可变数量的像素。如果列的宽度可以调整，我希望它的总宽度是我的单元格文本的长度加上“缓冲区”缩进。有谁知道实现这一目标的方法？下面列出了我的蹩脚实现：

```
public class MyTextBoxCell : DataGridViewTextBoxCell{ ....
        protected override void Paint(Graphics graphics, Rectangle clipBounds, Rectangle cellBounds, int rowIndex, DataGridViewElementStates cellState, object value, object formattedValue, string errorText, DataGridViewCellStyle cellStyle, DataGridViewAdvancedBorderStyle advancedBorderStyle, DataGridViewPaintParts paintParts) {
           clipBounds.Inflate(100, 0);

            DataGridViewPaintParts pp = DataGridViewPaintParts.Background | DataGridViewPaintParts.Border | DataGridViewPaintParts.ContentBackground
                | DataGridViewPaintParts.ErrorIcon;
            base.Paint(graphics, clipBounds, cellBounds, rowIndex, cellState, value, formattedValue, errorText, cellStyle, advancedBorderStyle, pp);            

                string text = formattedValue as string;

//My lame attempt to indent 20 pixels??
                TextRenderer.DrawText(graphics, text, cellStyle.Font, new Point(cellBounds.Location.X + 20, cellBounds.Location.Y), cellStyle.SelectionForeColor ,TextFormatFlags.EndEllipsis);

} 
```

}

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T03:53:19.510

您可以连接到 datagridview 中的 CellFormattingEvent 并在那里进行格式化。或者，如果您从 DataGridView 继承，您可以重写 OnCellFormatting 方法。代码看起来像这样：

```
 if (e.ColumnIndex == 1)
            {
                string val = (string)e.Value;
                e.Value = String.Format("   {0}", val);
                e.FormattingApplied = true;
            } 
```

只是一些粗略的代码，但你明白了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T20:35:09.377

好吧，我想我有它。如果有人对此感兴趣，请查看以下代码：

```
public class MyTextBoxCell : DataGridViewTextBoxCell{ ....
        private static readonly int INDENTCOEFFICIENT = 5;
        protected override Size GetPreferredSize(Graphics graphics, DataGridViewCellStyle cellStyle, int rowIndex, Size constraintSize) {
            int indent = ((MyRow)OwningRow).Indent * INDENTCOEFFICIENT;
            Size s =  base.GetPreferredSize(graphics, cellStyle, rowIndex, constraintSize);
            int textWidth = 2;  //arbitrary amount
            if (Value != null) {
                string text = Value as string;
                textWidth = TextRenderer.MeasureText(text, cellStyle.Font).Width;
            }

            s.Width += textWidth + indent;
            return s;
        }

        private static readonly StringFormat strFmt = new StringFormat(StringFormatFlags.NoWrap);

        protected override void Paint(Graphics graphics, Rectangle clipBounds, Rectangle cellBounds, int rowIndex, DataGridViewElementStates cellState, object value, object formattedValue, string errorText, DataGridViewCellStyle cellStyle, DataGridViewAdvancedBorderStyle advancedBorderStyle, DataGridViewPaintParts paintParts) {

            DataGridViewPaintParts pp = DataGridViewPaintParts.Background | DataGridViewPaintParts.Border | DataGridViewPaintParts.ContentBackground
                | DataGridViewPaintParts.ErrorIcon;

            base.Paint(graphics, clipBounds, cellBounds, rowIndex, cellState, value, formattedValue, errorText, cellStyle, advancedBorderStyle, pp);

            string text = formattedValue as string;

            int indent = ((MyRow)OwningRow).Indent * INDENTCOEFFICIENT;
            strFmt.Trimming = StringTrimming.EllipsisCharacter;
            Rectangle r = cellBounds;
            r.Offset(indent, 0);
            r.Inflate(-indent, 0);
            graphics.DrawString(text, cellStyle.Font, Brushes.Black, r, strFmt);
        }

} 
```

如果有人有更好的方法，我很乐意看到您的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T21:14:52.730

如果您尝试自动调整列的大小（取决于单元格内容的大小），那么您应该查看`Column.AutoSizeMode`属性和`Column.DefaultCellStyle`属性。

```
static const int INDENTCOEFF = 5;
DataGridViewCellStyle cellStyle = new DataGridViewCellStyle();

cellStyle.Padding = 
         new Padding(INDENTCOEFF , 5, INDENTCOEFF , 5); //left,top,right,bottom
MyColumn.DefaultCellStyle = cellStyle;
MyColumn.AutoSizeMode = DataGridViewAutoSizeColumnMode.AllCells; 
```

# crystal-reports - 将 Crystal Reports 存储在 XML 文件中？

> ID：177135
> 
> 赞同：5
> 
> 时间：2008-10-07T03:32:09.240
> 
> 标签：crystal-reports

我最近与某人交谈，他提到可以将使用 Crystal Reports 创建的报表存储为 XML 文件。

谷歌搜索后，我找不到任何暗示这种情况的信息（使用存储在报告中的 XML 数据，是的，但实际上存储报告，默认情况下存储为 .rpt 文件的部分，不*。*

我是否正确地假设我们之间实际上存在某种误解并且实际上不可能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-12T15:56:12.927

不能以 XML 格式存储报告模板。仅支持 XML 作为“渲染”报告的导出格式。
出于什么目的您需要 XML 格式的报告模板。有一个名为[Crystal-Clear](http://www.inetsoftware.de/products/crystalclear/)的 Java 报告解决方案可以读取 Crytsal Reports 报告模板并将其保存为 XML 报告模板。反过来，这不起作用。创建 XML 文件后，您无法再次使用 Crystal Reports 打开报表。但是您可以使用带有 GUI 设计器的[Crystal-Clear来处理报告。](http://www.inetsoftware.de/products/crystalclear/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-24T02:16:27.573

[使用 Crystal Reports SDK 将 RPT 文件格式转换为 XML](http://code.google.com/p/rpttoxml/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-01-26T19:32:39.513

有一个 GitHub 项目可以将[RPT 转换为 XML](https://github.com/ajryan/RptToXml)。该工具的目的是用于差异，所以我不知道是否有 XML 到 RPT 转换器。Crystal Reports 肯定不能将 XML 文件像 .RPT 文件一样打开。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T18:51:21.490

至少在 8.5 版中，XML 文件是支持的导出目标之一，就像 PDF、Excel 或 Word。他们似乎不太可能在以后的版本中删除支持。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T13:57:50.757

我刚刚在 Crystal Reports 10 中进行了测试。

打开要导出的报告，在文件菜单中点击导出，至少在 CR 10 中，XML 位于最底部。

接下来会出现一个屏幕，询问要保存到的目录和基本文件名。根据 Window，它使用“Crystal Markup Language”XML 格式

# .net - 在您的应用程序中实现插件的设计模式？

> ID：177140
> 
> 赞同：21
> 
> 时间：2008-10-07T03:35:15.020
> 
> 标签：.net, design-patterns, plugins

为您的应用程序允许和实现插件系统的标准方法是什么？

在我的上一个应用程序中，我为它们必须实现的所有插件创建了一个简单的接口。然后，我将所有程序集加载到应用程序目录中，并丢弃任何未实现该接口的程序集。

接口中的方法之一是 DoWork() 方法，该方法会定期在所有加载的程序集上调用，以执行插件可能具有的任何操作。

做插件系统的“正确”方法是什么？你只是为插件创建一个接口吗？您是否应该定期在所有插件中调用特定方法？有没有更高级的方法？

* * *

编辑：

感谢 Matt Hamilton 对 System.Addin 命名空间的引用。这很可能是我实现插件的方式。但是，总的来说，我仍然对插件架构感到好奇，并且不介意关于它们应该设计、实现的最佳方式的一些背景知识……一旦加载，你应该如何调用它们等等。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-07T03:37:59.320

根据对类似问题的[回复](https://stackoverflow.com/questions/14278/how-to-load-plugins-in-net#14305)，查看 System.AddIn 命名空间。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-07T04:16:37.747

Microsoft 的 Glenn Block 和 Brad Abrams 最近发布了托管可扩展性框架，它提供了一个框架来处理您正在谈论的内容。

文档和下载可[在此处](http://www.codeplex.com/MEF)获得。

[Glenn](http://codebetter.com/blogs/glenn.block/archive/2008/09/25/what-is-the-managed-extensibility-framework.aspx)和[Brad 的](http://blogs.msdn.com/brada/archive/2008/09/29/simple-introduction-to-composite-applications-with-the-managed-extensions-framework.aspx)博客也是 MEF 的重要资源。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-07T04:30:36.953

从严格的设计模式角度来看，您可能想看看[OSGi](http://www.osgi.org)（这是高度面向 Java 的，但被认为是一个非常非常好的插件/模块系统）。对于您要实现的目标可能有点过头了，但是那里有*很多*关于如何在运行过程中动态处理加载和卸载模块等非常好的东西......

# c# - 如何在 C# 中按进程获取打开文件句柄的列表？

> ID：177146
> 
> 赞同：42
> 
> 时间：2008-10-07T03:37:24.127
> 
> 标签：c#, .net

如何在 C# 中按进程 ID 获取打开的文件句柄列表？

我也有兴趣深入挖掘并获取文件名。

寻找流程资源管理器所做的程序化等价物。

这很可能需要互操作。

考虑在这方面增加赏金，实现起来非常复杂。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-07T06:23:16.290

哎呀，这将很难从托管代码中完成。

[codeproject 上](http://www.codeproject.com/KB/shell/OpenedFileFinder.aspx?fid=422864&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=26&select=2277170)有一个示例

大多数事情都可以在互操作中完成，但是您需要一个驱动程序来获取文件名，因为它位于内核的地址空间中。Process Explorer 将驱动程序嵌入到其资源中。让这一切都从 C# 连接起来并支持 64 位和 32 位，这将是一个令人头疼的问题。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-07T06:51:17.590

您还可以运行Mark Rusinovich的命令行应用程序[Handle并解析输出。](http://technet.microsoft.com/en-us/sysinternals/bb896655.aspx)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2011-03-21T00:05:27.843

看看这个文件：http: [//vmccontroller.codeplex.com/SourceControl/changeset/view/47386#195318](http://vmccontroller.codeplex.com/SourceControl/changeset/view/47386#195318)

并使用：

```
DetectOpenFiles.GetOpenFilesEnumerator(processID); 
```

演示：

```
using System;
using System.Diagnostics;

namespace OpenFiles
{
    class Program
    {
        static void Main(string[] args)
        {
            using (var openFiles = VmcController.Services.DetectOpenFiles.GetOpenFilesEnumerator(Process.GetCurrentProcess().Id))
            {
                while (openFiles.MoveNext())
                {
                    Console.WriteLine(openFiles.Current);
                }
            }
            Console.WriteLine();
            Console.ReadKey();
        }
    }
} 
```

它依赖于汇编`System.EnterpriseServices`

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-07T06:04:26.763

您可以 P/INVOKE 进入[`NtQuerySystemInformation`](http://msdn.microsoft.com/en-us/library/ms724509(VS.85).aspx)函数以查询所有句柄，然后从那里开始。此[Google 群组讨论](http://groups.google.com/group/microsoft.public.win32.programmer.kernel/browse_thread/thread/228ecaeec5b17957/93759f6c1a02c971?lnk=raot)有详细信息。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-06-29T13:27:15.260

Handle 是一个很棒的程序，codeproject 的链接也很好。

@Brian 代码的原因是 handle.exe 不可再发行。他们也没有公布他们的来源。

看起来 .Net 似乎不会轻易做到这一点，因为似乎需要嵌入式设备驱动器才能访问信息。如果没有未管理的 DLL，这无法在 .net 中完成。与典型的 .net 编码相比，它是相对较深的内核代码。我很惊讶 WMI 没有公开这一点。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-03-21T00:09:39.557

看看 wj32 的[Process Hacker version 1](http://sourceforge.net/projects/processhacker/files/processhacker/)，它可以做你所要求的，等等。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-02-20T21:30:21.893

也许使用命令行工具：

OpenedFilesView v1.50 - 查看系统中打开/锁定的文件（共享违规问题）

[http://www.nirsoft.net/utils/opened_files_view.html](http://www.nirsoft.net/utils/opened_files_view.html)

# c# - 从类名创建实例

> ID：177154
> 
> 赞同：2
> 
> 时间：2008-10-07T03:40:55.680
> 
> 标签：c#, reflection

我正在尝试在运行时创建一个类的实例。我尝试创建的类都继承自基类 ConfigMgrObj，并命名为`ConfigMgr_xxxxxx`eg `ConfigMgr_Collection`。它们都采用我称为 oController 的特殊对象和一个字符串作为参数。

这是我用来执行此操作的行，其中 ClassToGet 是一个包含类名称的字符串，例如`ConfigMgr_Collection`.

```
object oNewObject = System.Activator.CreateInstance(null, "StackOverflowNamespace." + ClassToGet, new object[] { oController, ClassToGet }); 
```

这会引发 TypeLoadException 异常。怎么了？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-07T03:44:00.057

您尝试实例化的类型是否实际上是在同一个程序集中声明的？传递 null 作为第一个参数是告诉 Activator 类型存在于当前程序集中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T03:46:53.140

看起来它没有找到`"StackOverflowNamespace."+ClassToGet`在当前程序集中命名的类。

# iphone - 跳过 Xcode iPhone 应用程序的“CompressResources”构建步骤

> ID：177160
> 
> 赞同：11
> 
> 时间：2008-10-07T03:45:37.137
> 
> 标签：iphone, xcode, image, resources

是否可以将 iPhone Xcode 项目设置为跳过“CompressResources”构建步骤？

具体来说，我想跳过它在我的所有 .png 文件上运行 pngcrush 的阶段，其中许多文件无法以我的应用程序可以读取的形式存在。

**编辑：**使用的 pngcrush 版本创建的 png 文件包含一个明确阻止解码的非标准“强制、私有”块。我已经修改了我的 png 阅读器来处理这些文件，但我仍然想要跳过这一步的每个项目的方法。pngcrush 的其他副作用之一是它不保存透明像素的颜色值，因此 alpha-ed 纹理在较小的 mip 级别显示边缘。

iphone png 格式在此处描述：[https](https://web.archive.org/web/20110519164905/http://modmyi.com/wiki/index.php/Iphone_PNG_images) ://web.archive.org/web/20110519164905/http://modmyi.com/wiki/index.php/Iphone_PNG_images 。简而言之，

*   跳过 CgBI 块
*   跳过 zlib 标头
*   交换 BGR 到 RGB 通道顺序

**编辑：**它似乎也预乘了 alpha，所以：

*   除以阿尔法

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-23T08:31:20.223

您可以将“IPHONE_OPTIMIZE_OPTIONS=-skip-PNGs”添加到您的项目设置中以防止 png 损坏，但要小心，您可能需要分别优化图标和 Default.png。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-07T19:45:12.473

iphoneos-optimize 脚本将 PNG 文件转换为针对 iPhone 上的显示进行了优化的非标准格式。该脚本将转换在您的应用程序包中找到的任何具有 png 扩展名的文件。

我有一个类似的问题，并通过为我的文件提供扩展名 _png（即，前缀下划线）来解决它。iphoneos-optimize 忽略了它，并留下了一个常规的 PNG 文件。如果你能以这种方式处理它，它可能比使用构建脚本更安全。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-10-21T04:40:52.700

*   打开构建设置
*   在“打包”下选择压缩PNG文件
*   选择“否”

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-07T14:04:13.270

如果您查看构建输出，您会看到 CompressResources 步骤运行脚本`/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/iphoneos-optimize`。这似乎只是一个运行 pngcrush 并将 plist 编译为二进制格式的 shell 脚本。您可能会修改此脚本以不运行 pngcrush。

请注意，[此线程](http://discussions.apple.com/thread.jspa?threadID=1671056&tstart=0)中的某个人注意到，如果他们没有通过 pngcrush 运行他们的图标文件，它就不会出现在手机上。

有趣的是，脚本目录中的 pngcrush 版本有一个 -iphone 参数。有谁知道这是标准的还是苹果公司随其构建的产品？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-22T15:16:26.857

这可能是另一个问题。在许多情况下，问题与命名有关，可以很容易地解决。

阅读： [http ://cocoapi.wordpress.com/2009/03/22/iphone-images-not-appearing-in-real-iphone-this-is-why/](http://cocoapi.wordpress.com/2009/03/22/iphone-images-not-appearing-in-real-iphone-this-is-why/)

# javascript - 从 JavaScript 中的关联数组中获取第一项的最有效方法是什么？

> ID：177161
> 
> 赞同：45
> 
> 时间：2008-10-07T03:45:44.313
> 
> 标签：javascript, jquery, arrays, associative

我只需要从 JavaScript 中一个相当大的关联数组中获取第一项（实际上只是第一个键）。这是我目前的做法（使用 jQuery）：

```
getKey = function (data) {
    var firstKey;
    $.each(data, function (key, val) {
        firstKey = key;
        return false;
    });
    return firstKey;
}; 
```

只是猜测，但我想说必须有一种更好（阅读：更有效）的方式来做到这一点。有什么建议么？

更新：感谢您富有洞察力的答案和评论！我忘记了我的 JavaScript 101，其中规范说你不能保证关联数组中的特定顺序。不过，有趣的是，大多数浏览器都以这种方式实现它。我不希望在获得第一个键之前对数组进行排序，但考虑到我的用例，这可能是不可避免的。

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2014-10-28T20:34:01.663

您可以通过引用从返回的第一个条目来避免创建函数`Object.keys()`：

```
var firstKey = Object.keys(data)[0]; 
```

对于排序键列表中的第一个条目，只需添加对`.sort()`方法的调用：

```
var firstKey = Object.keys(data).sort()[0]; 
```

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-10-07T03:55:51.627

关联数组（即对象）中实际上没有**第一个**或**最后一个**元素。您希望获得的唯一顺序是解析器保存元素的顺序——并且不保证与此一致。

但是，如果你想***第一个出现***，经典的方式实际上可能更容易一些：

```
function getKey(data) {
  for (var prop in data)
    return prop;
} 
```

想要避免继承属性？

```
function getKey(data) {
  for (var prop in data)
    if (data.propertyIsEnumerable(prop))
      return prop;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-11-01T14:36:32.020

除了 Jonathan 的解决方案，我们还可以扩展默认的数组功能：

```
Array.prototype.getKey = function() {
  for (var prop in this)
    if (this.propertyIsEnumerable(prop))
      return prop;
} 
```

# entity-framework - Entity Framework 目前适合什么类型的项目？

> ID：177177
> 
> 赞同：3
> 
> 时间：2008-10-07T03:49:22.950
> 
> 标签：entity-framework

我最近在收听一个播客，该播客详细讨论了实体框架 (EF) 的缺点。

但是，他们的意见可能需要（我）持保留态度，据我所知：

*   这些人都是 ORM 专家。
*   他们要么靠 ORM 工具谋生，要么靠自己的爱好
*   他们将 ORM 工具用于大规模应用程序
*   他们也非常关心我不一定关心的 ALT.NET 的超级策略（YET）

我的总体问题是：

*   Entity Framework 目前适合什么类型的项目？

但是这里有一些子问题可能会帮助您了解我对这个问题的看法：

1.  EF总比没有好？我厌倦了手工做所有事情。
2.  它是否接近于与 LINQ to SQL “解决相同的问题”？2a. 如果是的话，什么时候比另一个更适合？*[在我用这个标签检查问题时发现了一个关于这个问题的线程](https://stackoverflow.com/questions/8676/entity-framework-vs-linq-to-sql)，所以没关系*
3.  它是否适合简单的“快速而肮脏”的应用程序，例如当您的大部分管理 CRUD 表单时？

*编辑*：对于那些可能好奇的人，我主要从事中小型应用程序。这可以指导你的反应，或者不是。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T04:00:50.897

实体框架适用于所有将受益于 ORM 层的应用程序。Daniel Simmons 的帖子对此进行了详细介绍。 [http://blogs.msdn.com/dsimmons/archive/2008/05/17/why-use-the-entity-framework.aspx](http://blogs.msdn.com/dsimmons/archive/2008/05/17/why-use-the-entity-framework.aspx)

实体框架在许多方面与 Linq for SQL 相似，但与 Linq for SQL 所依赖的 MS SQL Server 无关。此外，EF 支持您的业务/域对象和数据表之间更灵活的映射。Linq for SQL 支持更多的一对一映射，而 EF 支持将单个对象映射到多个表或将单个表映射到多个对象的能力。你在这两个方面都有不错的设计师支持。

在开源世界中，NHibernate 可能是最先进的，并且在许多方面是更成熟的产品（它在某些方面肯定支持更广泛的特性）。但是使用 EF，您可以获得对 MS 的全面支持以及与 Visual Studio 工具集和 .net 框架堆栈的紧密集成。在撰写本文时，EF 也是比 NH 更好的 Linq 提供者。

对于快速而肮脏的应用程序，老实说，如果您可以使用 MS SQL Server 和映射限制，我会倾向于 Linq for SQL。

对于更复杂的应用程序，我会使用 EF 或 NHibernate。

您可能对我在 EF 上发表的信任投票感兴趣 [http://blog.keithpatton.com/2008/06/24/A+Vote+Of+Confidence+For+The+Entity+Framework.aspx](http://blog.keithpatton.com/2008/06/24/A+Vote+Of+Confidence+For+The+Entity+Framework.aspx)

# visual-studio-2008 - 在 Visual Studio 2008 中构建解决方案后，有没有办法运行外部可执行文件？

> ID：177188
> 
> 赞同：18
> 
> 时间：2008-10-07T03:54:48.553
> 
> 标签：visual-studio-2008, build-process

我不是在谈论项目的后期构建事件。相反，我想在构建整个解决方案后自动运行可执行文件。有没有办法为解决方案做一个后期构建事件？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-07T04:35:46.787

## Visual Studio 2010 及之前版本

您可以通过处理 OnBuildDone 在宏编辑器中执行此操作。该事件为您提供了几个方便的属性，您可以检查：范围（项目/解决方案/批处理）和操作（构建/重建/清理/部署）。做你想做的事情是这样的（未经测试，请注意）：

```
Public Sub AfterBuild(scope As vsBuildScope, action As vsBuildAction) _
        Handles BuildEvents.OnBuildDone
    If scope = vsBuildScope.vsBuildScopeSolution Then
        System.Diagnostics.Process.Start("some file I want to run")
    End If
End Sub 
```

## 视觉工作室 2012

上述解决方案在 Visual Studio 2012 中不起作用，因为 Microsoft 已删除该版本中的宏。但是，您仍然可以使用加载项执行基本相同的操作。要了解如何操作，请转到此处：

[Visual Studio 2012 中宏的替代方案](https://stackoverflow.com/questions/12027485/alternative-to-macros-in-visual-studio-2012/12394986#12394986)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-07T03:57:57.377

不直接。
您可以创建一个在所有其他项目中都具有依赖关系的项目，并为其添加构建后步骤。实际上，这将导致它在其他所有内容之后运行。

# java - 如何实现单实例 Java 应用程序？

> ID：177189
> 
> 赞同：90
> 
> 时间：2008-10-07T03:54:57.133
> 
> 标签：java, single-instance

有时我看到许多应用程序，例如 msn、windows media player 等都是单实例应用程序（当用户在应用程序运行时执行时，不会创建新的应用程序实例）。

在 C# 中，我`Mutex`为此使用类，但我不知道如何在 Java 中执行此操作。

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2010-01-04T23:07:16.353

我在主要方法中使用以下方法。这是我见过的最简单、最健壮、侵入性最小的方法，所以我想我会分享它。

```
private static boolean lockInstance(final String lockFile) {
    try {
        final File file = new File(lockFile);
        final RandomAccessFile randomAccessFile = new RandomAccessFile(file, "rw");
        final FileLock fileLock = randomAccessFile.getChannel().tryLock();
        if (fileLock != null) {
            Runtime.getRuntime().addShutdownHook(new Thread() {
                public void run() {
                    try {
                        fileLock.release();
                        randomAccessFile.close();
                        file.delete();
                    } catch (Exception e) {
                        log.error("Unable to remove lock file: " + lockFile, e);
                    }
                }
            });
            return true;
        }
    } catch (Exception e) {
        log.error("Unable to create and/or lock file: " + lockFile, e);
    }
    return false;
} 
```

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2008-10-07T04:01:38.400

如果我相信这篇[文章](http://www.rbgrn.net/blog/2008/05/java-single-application-instance.html)，作者：

> 让第一个实例尝试在 localhost 接口上打开一个侦听套接字。如果它能够打开套接字，则假定这是要启动的应用程序的第一个实例。如果不是，则假设此应用程序的一个实例已经在运行。新实例必须通知现有实例已尝试启动，然后退出。现有实例在收到通知后接管并向处理该操作的侦听器触发事件​​。

注意：[阿赫](https://stackoverflow.com/users/4427/ahe)在评论中提到使用`InetAddress.getLocalHost()`可能很棘手：

> *   它在 DHCP 环境中无法按预期工作，因为返回的地址取决于计算机是否具有网络访问权限。
>     解决方案是打开连接**`InetAddress.getByAddress(new byte[] {127, 0, 0, 1})`**；
>     可能与[错误 4435662](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4435662)有关。

*   我还发现[错误 4665037](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4665037)报告的结果比预期的结果`getLocalHost`：返回机器的 IP 地址与实际结果：返回`127.0.0.1`。

> 令人惊讶的是在 Linux 上有`getLocalHost`回报`127.0.0.1`，但在 Windows 上没有回报。

* * *

或者你可以使用[`ManagementFactory`](http://web.archive.org/web/20090529082521/http://www.trap17.com/index.php/how-implement-single-instance-application-java_t59760.html)对象。[如此处](http://web.archive.org/web/20081203154345/http://www.trap17.com/forums/how-implement-single-instance-application-java-t59760.html)所述：

> 该`getMonitoredVMs(int processPid)`方法接收当前应用程序的PID作为参数，并捕获从命令行调用的应用程序名称，例如应用程序是从`c:\java\app\test.jar`路径启动的，则值变量为“ `c:\\java\\app\\test.jar`”。这样，我们将在下面代码的第 17 行捕获应用程序名称。
> 之后，我们在JVM中搜索另一个同名的进程，如果我们找到了它并且应用程序PID不同，则表示这是第二个应用程序实例。

JNLP 还提供了一个[`SingleInstanceListener`](http://forums.sun.com/thread.jspa?messageID=9509621)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-08-24T14:04:53.303

如果应用程序。有一个 GUI，使用 JWS 启动它并使用`SingleInstanceService`.

## 更新

Java 插件（applet 和 JWS 应用程序都需要）已被 Oracle 弃用并从 JDK 中删除。浏览器制造商已经从他们的浏览器中删除了它。

**所以这个答案已经失效。仅将其留在这里以警告查看旧文档的人。**

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-11-23T13:39:14.130

是的，对于 eclipse RCP 来说，这是一个非常不错的答案 下面是我的代码 eclipse 单实例应用程序

在 application.java

```
if(!isFileshipAlreadyRunning()){
        MessageDialog.openError(display.getActiveShell(), "Fileship already running", "Another instance of this application is already running.  Exiting.");
        return IApplication.EXIT_OK;
    } 

private static boolean isFileshipAlreadyRunning() {
    // socket concept is shown at http://www.rbgrn.net/content/43-java-single-application-instance
    // but this one is really great
    try {
        final File file = new File("FileshipReserved.txt");
        final RandomAccessFile randomAccessFile = new RandomAccessFile(file, "rw");
        final FileLock fileLock = randomAccessFile.getChannel().tryLock();
        if (fileLock != null) {
            Runtime.getRuntime().addShutdownHook(new Thread() {
                public void run() {
                    try {
                        fileLock.release();
                        randomAccessFile.close();
                        file.delete();
                    } catch (Exception e) {
                        //log.error("Unable to remove lock file: " + lockFile, e);
                    }
                }
            });
            return true;
        }
    } catch (Exception e) {
       // log.error("Unable to create and/or lock file: " + lockFile, e);
    }
    return false;
} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-07T04:26:34.543

我们为此使用文件锁定（在用户的应用程序数据目录中的魔术文件上获取排他锁），但我们主要感兴趣的是防止多个实例运行。

如果您试图让第二个实例将命令行参数等传递给第一个实例，那么在 localhost 上使用套接字连接将用一块石头杀死两只鸟。通用算法：

*   启动时，尝试在本地主机上的端口 XXXX 上打开侦听器
*   如果失败，则在 localhost 上打开该端口的写入器并发送命令行参数，然后关闭
*   否则，在 localhost 上监听端口 XXXX。当收到命令行参数时，处理它们就像应用程序是使用该命令行启动的一样。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-05-16T12:53:35.857

我找到了一个解决方案，有点卡通化的解释，但在大多数情况下仍然有效。它使用普通的旧锁文件创建东西，但视图完全不同：

[http://javalandscape.blogspot.com/2008/07/single-instance-from-your-application.html](http://javalandscape.blogspot.com/2008/07/single-instance-from-your-application.html)

我认为这将有助于那些有严格防火墙设置的人。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2016-11-23T11:31:29.557

您可以使用 JUnique 库。它提供对运行单实例 java 应用程序的支持，并且是开源的。

[http://www.sauronsoftware.it/projects/junique/](http://www.sauronsoftware.it/projects/junique/)

> JUnique 库可用于防止用户同时运行同一 Java 应用程序的多个实例。
> 
> JUnique 实现了在同一用户启动的所有 JVM 实例之间共享的锁和通信通道。

```
public static void main(String[] args) {
    String appId = "myapplicationid";
    boolean alreadyRunning;
    try {
        JUnique.acquireLock(appId, new MessageHandler() {
            public String handle(String message) {
                // A brand new argument received! Handle it!
                return null;
            }
        });
        alreadyRunning = false;
    } catch (AlreadyLockedException e) {
        alreadyRunning = true;
    }
    if (!alreadyRunning) {
        // Start sequence here
    } else {
        for (int i = 0; i < args.length; i++) {
            JUnique.sendMessage(appId, args[0]));
        }
    }
} 
```

在后台，它在 %USER_DATA%/.junique 文件夹中创建文件锁，并在随机端口为每个唯一的 appId 创建一个服务器套接字，允许在 java 应用程序之间发送/接收消息。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-07T09:01:11.323

在 Windows 上，您可以使用[launch4j](http://launch4j.sourceforge.net/)。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-07T06:02:04.053

J2SE 5.0 或更高版本中支持的 ManagementFactory 类[详细信息](http://sdnshare.sun.com/view.jsp?id=882)

但现在我使用 J2SE 1.4，我发现了这个[http://audiprimadhanty.wordpress.com/2008/06/30/ensuring-one-instance-of-application-running-at-one-time/](http://audiprimadhanty.wordpress.com/2008/06/30/ensuring-one-instance-of-application-running-at-one-time/)但我从不测试。你怎么看待这件事？

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-07T04:33:40.723

您可以打开一个内存映射文件，然后查看该文件是否已经打开。如果它已经打开，您可以从 main 返回。

其他方法是使用锁定文件（标准 unix 实践）。另一种方法是在检查剪贴板中是否已经存在某些内容后，在 main 启动时将某些内容放入剪贴板。

否则，您可以以侦听模式（ServerSocket）打开套接字。首先尝试连接到hte socket；如果无法连接，则打开一个 serversocket。如果您连接，那么您知道另一个实例已经在运行。

因此，几乎任何系统资源都可用于了解应用程序正在运行。

BR，~A

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-07T08:58:06.803

您可以尝试使用 Preferences API。它独立于平台。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-05-16T19:49:55.573

我为此使用了套接字，并且根据应用程序是在客户端还是服务器端，行为会有所不同：

*   客户端：如果实例已经存在（我无法监听特定端口），我将传递应用程序参数并退出（您可能希望在前一个实例中执行一些操作）如果不存在，我将启动应用程序。
*   服务器端：如果实例已经存在，我将打印一条消息并退出，否则我将启动应用程序。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2016-04-22T08:53:30.490

限制单台机器甚至整个网络上的实例数量的更通用方法是使用多播套接字。

使用多播套接字，您可以将消息广播到应用程序的任意数量的实例，其中一些实例可以位于公司网络上的物理远程计算机上。

通过这种方式，您可以启用多种类型的配置，以控制诸如

*   每台机器一个或多个实例
*   每个网络一个或多个实例（例如控制客户端站点上的安装）

Java 的多播支持是通过**java.net 包实现**的，其中**MulticastSocket**和**DatagramSocket**是主要工具。

**注意**：MulticastSocket 不保证数据包的传送，因此您应该使用构建在多播套接字之上的工具，例如[JGroups](https://en.wikipedia.org/wiki/JGroups)。JGroups**确实**保证所有数据的交付。它是一个 jar 文件，具有非常简单的 API。

JGroups 已经存在了一段时间，并且在工业中有一些令人印象深刻的用途，例如它支持 JBoss 的集群机制，将数据广播到集群的所有实例。

要使用 JGroups，限制应用程序实例的数量（在机器或网络上，比如说：客户购买的许可证数量）在概念上非常简单：

*   在您的应用程序启动时，每个实例都会尝试加入一个命名组，例如“My Great App Group”。您将已将此组配置为允许 0、1 或 N 个成员
*   当组成员数量大于您为其配置的数量时..您的应用程序应该拒绝启动。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2019-11-17T18:40:56.340

Unique4j 库可用于运行 Java 应用程序的单个实例并传递消息。你可以在[https://github.com/prat-m​​an/unique4j](https://github.com/prat-man/unique4j)看到它。它支持 Java 1.6+。

它使用文件锁和动态端口锁的组合来检测实例之间并进行通信，其主要目标是只允许一个实例运行。

下面是一个简单的例子：

```
import tk.pratanumandal.unique4j.Unique4j;
import tk.pratanumandal.unique4j.exception.Unique4jException;

public class Unique4jDemo {

    // unique application ID
    public static String APP_ID = "tk.pratanumandal.unique4j-mlsdvo-20191511-#j.6";

    public static void main(String[] args) throws Unique4jException, InterruptedException {

        // create unique instance
        Unique4j unique = new Unique4j(APP_ID) {
            @Override
            public void receiveMessage(String message) {
                // display received message from subsequent instance
                System.out.println(message);
            }

            @Override
            public String sendMessage() {
                // send message to first instance
                return "Hello World!";
            }
        };

        // try to obtain lock
        boolean lockFlag = unique.acquireLock();

        // sleep the main thread for 30 seconds to simulate long running tasks
        Thread.sleep(30000);

        // try to free the lock before exiting program
        boolean lockFreeFlag = unique.freeLock();

    }

} 
```

免责声明：我创建并维护了 Unique4j 库。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-05-12T16:13:01.607

```
公共类 SingleInstance {
    public static final String LOCK = System.getProperty("user.home") + File.separator + "test.lock";
    public static final String PIPE = System.getProperty("user.home") + File.separator + "test.pipe";
    私有静态 JFrame 框架 = null;

    公共静态无效主要（字符串[]参数）{
        尝试 {
            FileChannel lockChannel = new RandomAccessFile(LOCK, "rw").getChannel();
            文件锁 flk = null;
            尝试 {
                flk = lockChannel.tryLock();
            } 捕捉（可投掷的 t）{
                t.printStackTrace();
            }
            if (flk == null || !flk.isValid()) {
                System.out.println("已经运行，给管道留言并退出...");
                FileChannel pipeChannel = null;
                尝试 {
                    pipeChannel = new RandomAccessFile(PIPE, "rw").getChannel();
                    MappedByteBuffer bb = pipeChannel.map(FileChannel.MapMode.READ_WRITE, 0, 1);
                    bb.put(0, (byte)1);
                    bb.force();
                } 捕捉（可投掷的 t）{
                    t.printStackTrace();
                } 最后 {
                    如果（管道通道！= null）{
                        尝试 {
                            pipeChannel.close();
                        } 捕捉（可投掷的 t）{
                            t.printStackTrace();
                        }
                    }
                }
                System.exit(0);
            }
            //这里我们不释放锁关闭通道，
            // 这将在应用程序崩溃或正常关闭后完成。
            SwingUtilities.invokeLater(
                新的可运行（）{
                    公共无效运行（）{
                        createAndShowGUI();
                    }
                }
            );

            FileChannel pipeChannel = null;
            尝试 {
                pipeChannel = new RandomAccessFile(PIPE, "rw").getChannel();
                MappedByteBuffer bb = pipeChannel.map(FileChannel.MapMode.READ_WRITE, 0, 1);
                而（真）{
                    字节 b = bb.get(0);
                    如果 (b > 0) {
                        bb.put(0, (byte)0);
                        bb.force();
                        SwingUtilities.invokeLater(
                            新的可运行（）{
                                公共无效运行（）{
                                    frame.setExtendedState(JFrame.NORMAL);
                                    frame.setAlwaysOnTop(true);
                                    frame.toFront();
                                    frame.setAlwaysOnTop(false);
                                }
                            }
                        );
                    }
                    线程.sleep(1000);
                }
            } 捕捉（可投掷的 t）{
                t.printStackTrace();
            } 最后 {
                如果（管道通道！= null）{
                    尝试 {
                        pipeChannel.close();
                    } 捕捉（可投掷的 t）{
                        t.printStackTrace();
                    }
                }
            }
        } 捕捉（可投掷的 t）{
            t.printStackTrace();
        }
    }

    公共静态无效createAndShowGUI（）{

        框架 = 新的 JFrame();
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setSize(800, 650);
        frame.getContentPane().add(new JLabel("主窗口",
                    SwingConstants.CENTER), BorderLayout.CENTER);
        frame.setLocationRelativeTo(null);
        frame.setVisible(true);
    }
}

```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2016-04-21T14:19:21.383

**编辑**：可以使用一个简单的 1 秒计时器线程来检查 indicatorFile.exists()，而不是使用这种 WatchService 方法。删除它，然后将应用程序带到Front()。

**编辑**：我想知道为什么这被否决了。这是迄今为止我见过的最好的解决方案。例如，如果另一个应用程序碰巧已经在监听该端口，那么服务器套接字方法就会失败。

只需下载 Microsoft Windows Sysinternals [TCPView](https://technet.microsoft.com/en-us/sysinternals/tcpview.aspx)（或使用 netstat），启动它，按“状态”排序，查找显示“LISTENING”的行块，选择远程地址为您的计算机名称的行块，将该端口放入您的新套接字（）-解决方案。在我的实现中，我每次都会产生失败。这是*合乎逻辑*的，因为它是该方法的基础。或者我没有得到关于如何实现这一点的信息？

*请告诉我是否以及我对此有何错误！*

我的观点——如果可能的话，我要求你反驳——建议开发人员在生产代码中使用一种方法，这种方法在大约 60000 个案例中至少有 1 个会失败。如果这种观点恰好是正确的，那么绝对*不会*因为所提出的解决方案没有这个问题而被否决并因其代码量而受到批评。

比较套接字方法的缺点：

*   如果选择了错误的彩票（端口号），则失败。
*   多用户环境下失败：只有一个用户可以同时运行应用程序。（我的方法必须稍微改变才能在用户树中创建文件，但这很简单。）
*   如果防火墙规则过于严格，则会失败。
*   让可疑的用户（我在野外遇到过）想知道当您的文本编辑器声明服务器套接字时您在做什么恶作剧。

* * *

我刚刚对如何以适用于每个系统的方式解决新实例到现有实例的 Java 通信问题有了一个好主意。所以，我在大约两个小时内完成了这门课。像魅力一样工作：D

它基于[Robert](https://stackoverflow.com/a/2002948/3500521)的文件锁定方法（也在此页面上），从那时起我就一直在使用它。告诉已经运行的实例另一个实例试图启动（但没有）...创建一个文件并立即删除，第一个实例使用 WatchService 检测此文件夹内容更改。考虑到问题的根本性，我不敢相信这显然是一个新想法。

这可以很容易地更改为只*创建*而不是删除文件，然后可以将信息放入其中，以便适当的实例可以评估，例如命令行参数 - 然后适当的实例可以执行删除。就个人而言，我只需要知道何时恢复我的应用程序的窗口并将其发送到前面。

示例使用：

```
public static void main(final String[] args) {

    // ENSURE SINGLE INSTANCE
    if (!SingleInstanceChecker.INSTANCE.isOnlyInstance(Main::otherInstanceTriedToLaunch, false)) {
        System.exit(0);
    }

    // launch rest of application here
    System.out.println("Application starts properly because it's the only instance.");
}

private static void otherInstanceTriedToLaunch() {
    // Restore your application window and bring it to front.
    // But make sure your situation is apt: This method could be called at *any* time.
    System.err.println("Deiconified because other instance tried to start.");
} 
```

这是课程：

```
package yourpackagehere;

import javax.swing.*;
import java.io.File;
import java.io.IOException;
import java.io.RandomAccessFile;
import java.nio.channels.FileLock;
import java.nio.file.*;

/**
 * SingleInstanceChecker v[(2), 2016-04-22 08:00 UTC] by dreamspace-president.com
 * <p>
 * (file lock single instance solution by Robert https://stackoverflow.com/a/2002948/3500521)
 */
public enum SingleInstanceChecker {

    INSTANCE; // HAHA! The CONFUSION!

    final public static int POLLINTERVAL = 1000;
    final public static File LOCKFILE = new File("SINGLE_INSTANCE_LOCKFILE");
    final public static File DETECTFILE = new File("EXTRA_INSTANCE_DETECTFILE");

    private boolean hasBeenUsedAlready = false;

    private WatchService watchService = null;
    private RandomAccessFile randomAccessFileForLock = null;
    private FileLock fileLock = null;

    /**
     * CAN ONLY BE CALLED ONCE.
     * <p>
     * Assumes that the program will close if FALSE is returned: The other-instance-tries-to-launch listener is not
     * installed in that case.
     * <p>
     * Checks if another instance is already running (temp file lock / shutdownhook). Depending on the accessibility of
     * the temp file the return value will be true or false. This approach even works even if the virtual machine
     * process gets killed. On the next run, the program can even detect if it has shut down irregularly, because then
     * the file will still exist. (Thanks to Robert https://stackoverflow.com/a/2002948/3500521 for that solution!)
     * <p>
     * Additionally, the method checks if another instance tries to start. In a crappy way, because as awesome as Java
     * is, it lacks some fundamental features. Don't worry, it has only been 25 years, it'll sure come eventually.
     *
     * @param codeToRunIfOtherInstanceTriesToStart Can be null. If not null and another instance tries to start (which
     *                                             changes the detect-file), the code will be executed. Could be used to
     *                                             bring the current (=old=only) instance to front. If null, then the
     *                                             watcher will not be installed at all, nor will the trigger file be
     *                                             created. (Null means that you just don't want to make use of this
     *                                             half of the class' purpose, but then you would be better advised to
     *                                             just use the 24 line method by Robert.)
     *                                             <p>
     *                                             BE CAREFUL with the code: It will potentially be called until the
     *                                             very last moment of the program's existence, so if you e.g. have a
     *                                             shutdown procedure or a window that would be brought to front, check
     *                                             if the procedure has not been triggered yet or if the window still
     *                                             exists / hasn't been disposed of yet. Or edit this class to be more
     *                                             comfortable. This would e.g. allow you to remove some crappy
     *                                             comments. Attribution would be nice, though.
     * @param executeOnAWTEventDispatchThread      Convenience function. If false, the code will just be executed. If
     *                                             true, it will be detected if we're currently on that thread. If so,
     *                                             the code will just be executed. If not so, the code will be run via
     *                                             SwingUtilities.invokeLater().
     * @return if this is the only instance
     */
    public boolean isOnlyInstance(final Runnable codeToRunIfOtherInstanceTriesToStart, final boolean executeOnAWTEventDispatchThread) {

        if (hasBeenUsedAlready) {
            throw new IllegalStateException("This class/method can only be used once, which kinda makes sense if you think about it.");
        }
        hasBeenUsedAlready = true;

        final boolean ret = canLockFileBeCreatedAndLocked();

        if (codeToRunIfOtherInstanceTriesToStart != null) {
            if (ret) {
                // Only if this is the only instance, it makes sense to install a watcher for additional instances.
                installOtherInstanceLaunchAttemptWatcher(codeToRunIfOtherInstanceTriesToStart, executeOnAWTEventDispatchThread);
            } else {
                // Only if this is NOT the only instance, it makes sense to create&delete the trigger file that will effect notification of the other instance.
                //
                // Regarding "codeToRunIfOtherInstanceTriesToStart != null":
                // While creation/deletion of the file concerns THE OTHER instance of the program,
                // making it dependent on the call made in THIS instance makes sense
                // because the code executed is probably the same.
                createAndDeleteOtherInstanceWatcherTriggerFile();
            }
        }

        optionallyInstallShutdownHookThatCleansEverythingUp();

        return ret;
    }

    private void createAndDeleteOtherInstanceWatcherTriggerFile() {

        try {
            final RandomAccessFile randomAccessFileForDetection = new RandomAccessFile(DETECTFILE, "rw");
            randomAccessFileForDetection.close();
            Files.deleteIfExists(DETECTFILE.toPath()); // File is created and then instantly deleted. Not a problem for the WatchService :)
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    private boolean canLockFileBeCreatedAndLocked() {

        try {
            randomAccessFileForLock = new RandomAccessFile(LOCKFILE, "rw");
            fileLock = randomAccessFileForLock.getChannel().tryLock();
            return fileLock != null;
        } catch (Exception e) {
            return false;
        }
    }

    private void installOtherInstanceLaunchAttemptWatcher(final Runnable codeToRunIfOtherInstanceTriesToStart, final boolean executeOnAWTEventDispatchThread) {

        // PREPARE WATCHSERVICE AND STUFF
        try {
            watchService = FileSystems.getDefault().newWatchService();
        } catch (IOException e) {
            e.printStackTrace();
            return;
        }
        final File appFolder = new File("").getAbsoluteFile(); // points to current folder
        final Path appFolderWatchable = appFolder.toPath();

        // REGISTER CURRENT FOLDER FOR WATCHING FOR FILE DELETIONS
        try {
            appFolderWatchable.register(watchService, StandardWatchEventKinds.ENTRY_DELETE);
        } catch (IOException e) {
            e.printStackTrace();
            return;
        }

        // INSTALL WATCHER THAT LOOKS IF OUR detectFile SHOWS UP IN THE DIRECTORY CHANGES. IF THERE'S A CHANGE, ANOTHER INSTANCE TRIED TO START, SO NOTIFY THE CURRENT ONE OF THAT.
        final Thread t = new Thread(() -> watchForDirectoryChangesOnExtraThread(codeToRunIfOtherInstanceTriesToStart, executeOnAWTEventDispatchThread));
        t.setDaemon(true);
        t.setName("directory content change watcher");
        t.start();
    }

    private void optionallyInstallShutdownHookThatCleansEverythingUp() {

        if (fileLock == null && randomAccessFileForLock == null && watchService == null) {
            return;
        }

        final Thread shutdownHookThread = new Thread(() -> {
            try {
                if (fileLock != null) {
                    fileLock.release();
                }
                if (randomAccessFileForLock != null) {
                    randomAccessFileForLock.close();
                }
                Files.deleteIfExists(LOCKFILE.toPath());
            } catch (Exception ignore) {
            }
            if (watchService != null) {
                try {
                    watchService.close();
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        });
        Runtime.getRuntime().addShutdownHook(shutdownHookThread);
    }

    private void watchForDirectoryChangesOnExtraThread(final Runnable codeToRunIfOtherInstanceTriesToStart, final boolean executeOnAWTEventDispatchThread) {

        while (true) { // To eternity and beyond! Until the universe shuts down. (Should be a volatile boolean, but this class only has absolutely required features.)

            try {
                Thread.sleep(POLLINTERVAL);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }

            final WatchKey wk;
            try {
                wk = watchService.poll();
            } catch (ClosedWatchServiceException e) {
                // This situation would be normal if the watcher has been closed, but our application never does that.
                e.printStackTrace();
                return;
            }

            if (wk == null || !wk.isValid()) {
                continue;
            }

            for (WatchEvent<?> we : wk.pollEvents()) {

                final WatchEvent.Kind<?> kind = we.kind();
                if (kind == StandardWatchEventKinds.OVERFLOW) {
                    System.err.println("OVERFLOW of directory change events!");
                    continue;
                }

                final WatchEvent<Path> watchEvent = (WatchEvent<Path>) we;
                final File file = watchEvent.context().toFile();

                if (file.equals(DETECTFILE)) {

                    if (!executeOnAWTEventDispatchThread || SwingUtilities.isEventDispatchThread()) {
                        codeToRunIfOtherInstanceTriesToStart.run();
                    } else {
                        SwingUtilities.invokeLater(codeToRunIfOtherInstanceTriesToStart);
                    }

                    break;

                } else {
                    System.err.println("THIS IS THE FILE THAT WAS DELETED: " + file);
                }

            }

            wk.reset();
        }
    }

} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-11-06T22:06:05.903

我为此编写了一个专用库[https://sanyarnd.github.io/applocker](https://sanyarnd.github.io/applocker)

它基于文件通道锁定，因此它不会阻塞端口号，或者在断电的情况下死锁应用程序（一旦进程终止，通道就会被释放）。

库本身是轻量级的，并且具有流畅的 API。

它的灵感来自[http://www.sauronsoftware.it/projects/junique/](http://www.sauronsoftware.it/projects/junique/)，但它是基于文件通道的。还有其他额外的新功能。

# c++ - 关于套接字编程和多线程的面试问题

> ID：177197
> 
> 赞同：23
> 
> 时间：2008-10-07T03:59:22.320
> 
> 标签：c++, multithreading, sockets

请任何人都可以告诉我问题，可以在以下主题的采访中提出

*   套接字编程
*   多线程

提前感谢所有提供时间的人

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-10-13T20:04:34.603

作为招聘经理，我最喜欢问的网络问题是：

> 想象一个用户坐在连接以太网的 PC 前。他打开了一个浏览器。他在地址栏中输入“www.google.com”并按回车键。
> 
> 现在告诉我以太网上出现的第一个数据包是什么。

可能的答案（不同的正确性）包括：

*   我不知道。
*   HTTP 请求数据包。
*   TCP 同步数据包。
*   DNS 请求数据包。
*   一个 ARP 数据包。
*   这取决于。

每个答案都揭示了人们对一般网络的理解，特别是 IP 和 TCP。随后的讨论可以揭示他们的理解。（当然，假设提问者在这方面有一定的专业知识）。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-10-07T04:11:58.927

**套接字编程**

*   UDP和TCP的区别。
*   异步和同步套接字之间的区别。
*   什么是包。
*   您如何确定数据包是否没有格式错误。
*   您如何确定一个数据包的结束位置和另一个数据包的开始位置。
*   什么是端口。

**多线程**

*   您知道哪些同步原语，区分它们。
*   什么是死锁，什么是活锁。
*   什么是竞态条件。
*   “无锁”一词是什么意思。
*   终止线程的最佳方法是什么。
*   为什么你不应该使用 TerminateThread-esque 函数。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-07T04:31:06.670

几个示例问题：

*   异步 I/O，一种方法是询问不同客户端可能查询服务器的问题，如果通过多个线程实现可能会导致竞争条件（例如结果缓存）。如果受访者使用多个线程，请提出竞争条件并查看他们是否提到异步 I/O 作为选项。
*   死锁和活锁有什么区别
*   原型 Web 服务器
*   原型 Web 客户端
*   什么是临时端口；或者描述一个负载压力应用程序，该应用程序以每秒 1000 次请求访问服务器，但几秒钟后停止向服务器发出请求；2-4 分钟后，应用程序再次开始向服务器发送 1000 次请求。
*   编写一个线程安全的生产者/消费者缓冲区，可供一个或多个生产者/消费者访问
*   客户端/服务器和p2p有什么区别
*   这是更多的网络，但了解套接字调用下面发生的事情会很有帮助：描述 TCP 3 次握手
*   nagle的算法是什么？什么时候需要？你会如何关闭它？
*   Linux 变体：在编写守护进程时，基本构建块是什么（即分叉子进程并杀死父进程，关闭 stdin/stdout/stderr 等）
*   Windows 变体：在编写 Windows 服务时，基本构建块是什么。
*   设计一个用于在客户端和服务器之间进行通信以发送音频/视频的协议。您如何将其扩展为下一个最新/最强大的功能。
*   TCP 窗口是如何工作的，我可以做些什么来优化跨大陆执行大量大型读取的应用程序的性能。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-07T04:02:11.440

什么是死锁以及如何避免它？

[一些套接字编程问题](http://dev.fyicenter.com/Interview-Questions/Networking-Programming/index.html)。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-13T20:10:39.553

你问是因为你被拉去面试将加入你团队的人吗？提出基于您在日常运营中必须面对的现实问题的问题。想想你遇到的与套接字编程有关的最后一个错误，并将其变成一个面试问题。

理论很好，但你想知道加入团队的人有在战壕中的经验。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-07T04:22:45.877

*   为什么一个典型的socket程序需要多线程
*   你如何从同一个进程/线程一次与一堆不同的网络连接交谈？提示：*异步套接字*
*   解释互联网数据传输的工作原理？或解释网络服务器的工作原理？根据套接字编程概念、Hint *TCP Http 等回答它。*

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-03T23:24:00.713

**套接字问题**

*   什么是插座？
*   `accept`和 和有什么区别`connect`？
*   `close`和 和有什么区别`shutdown`？
*   你会如何`connect`异步`www.google.com`？

**多线程问题**

*   什么是线程，它与进程有何不同？
*   什么时候可以选择在单 CPU 系统上使用线程？
*   您将如何测量线程之间的上下文切换开销？
*   您将如何制作一个 MT 安全的哈希表，同时允许最大并发性？

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2012-08-08T12:11:38.710

*   说出 Java 套接字的一些优点和缺点。
*   URL 实例和 URLConnection 实例有什么区别？
*   如何建立与 URL 的连接？
*   Java 网络和 RMI 中的套接字是什么？
*   创建 TCP Socket 需要哪些信息？
*   两个重要的 TCP Socket 类是什么？
*   MalformedURLException 和 UnknownHostException 何时抛出？
*   RMI 代表什么？
*   什么是 RMI？
*   File 和 RandomAccessFile 类有什么区别？
*   对象在作为对象写入流之前必须实现什么接口？
*   解释寻找本地端口
*   两个重要的 TCP Socket 类是什么？

# c++ - 进程和线程

> ID：177205
> 
> 赞同：2
> 
> 时间：2008-10-07T04:03:17.353
> 
> 标签：c++, multithreading

Process 和 Thread 不会共享哪些数据？

提前感谢所有提供时间的人

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T04:05:25.740

单独的进程不会相互共享任何数据。

如果线程在同一个进程中运行，它们可以共享任何堆分配的或静态数据。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T04:33:40.223

这取决于上下文。在大多数情况下，完全独立的进程不会共享任何相同的内存，但在某些情况下，子进程将与父进程共享相同的内存空间，例如在 Unix 中使用 fork 时。在旧版本的 Windows (95,98,ME) 中，有一个在所有进程之间共享的共享内存区域，但主要它只是系统 DLL 而非数据的空间。

通常线程共享堆数据，但是您需要小心地在一个线程中释放分配给另一个线程的内存，因为某些内存管理器依赖于堆栈。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T18:09:49.873

在操作系统理论中（AFAIK 这适用于 Windows、Linux、*BSD 等操作系统），**进程被定义为具有自己的页表的线程**，即自己的虚拟内存空间。

其他任何东西都取决于操作系统（文件描述符、套接字等）。以我的经验，此类**线程属性通常通过**复制进程的标准系统调用来复制。想想看，它更容易实现，也更足智多谋（更少的家务，保持非虚拟内存而不接触它）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T04:37:53.007

默认情况下，进程之间不共享数据，但是使用进程间通信技术，如 Socket ，管道，RPC 等。您可以共享数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T05:55:04.490

`FD_CLOEXEC`在 UNIX 上，如果文件描述符未设置为在 exec ( )上关闭，则进程可以与其子进程共享文件描述符。同样，Windows 支持与子进程共享句柄，方法是在调用时设置`lpSecurityAttributes->bInheritHandle`为，然后在调用时设置为。更不用说 Microsoft C 运行时函数接受一个标志。`TRUE``CreateFile()``bInheritHandles``TRUE``CreateProcess``_open()``_O_NOINHERIT`

在 Linux 上，[`clone()`](http://linux.die.net/man/2/clone)系统调用可以让您对子进程与其父进程共享的内容进行大量控制：从地址空间 ( `CLONE_VM`) 到文件描述符表 ( `CLONE_FILES`) 到父进程 ID ( `CLONE_PARENT`) 的所有内容都可以共享或不共享。当然，添加此功能是为了支持内核线程。

对于进程中的每个线程，[线程本地存储 (TLS)的索引不同，但实际内存在线程之间共享。](http://msdn.microsoft.com/en-us/library/ms686749.aspx)

# c - 什么是嵌入式系统的好 C 内存分配器？

> ID：177209
> 
> 赞同：21
> 
> 时间：2008-10-07T04:05:15.773
> 
> 标签：c, embedded, lua, malloc, allocation

我有一个单线程的嵌入式应用程序，它分配和释放大量的小块（32-64b）。基于缓存的分配器的完美场景。虽然我可以尝试编写一个，但它可能会浪费时间，并且没有像已经在前线的一些解决方案那样经过测试和调整。

那么我可以在这种情况下使用的最佳分配器是什么？

注意：我在系统中使用 Lua 虚拟机（这是 80% 以上分配的罪魁祸首），所以我不能轻易地重构我的代码以使用堆栈分配来提高分配性能。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-07T04:30:34.643

在过去的 CI 项目中，我们为在包括嵌入式系统在内的各种平台上运行的库实现了自己的内存管理例程。该库还分配和释放了大量的小缓冲区。它运行得比较好，并且不需要大量的代码来实现。如果你想自己开发一些东西，我可以给你一些关于该实现的背景知识。

基本实现包括一组管理一定大小的缓冲区的例程。这些例程被用作 malloc() 和 free() 的包装器。我们使用这些例程来管理我们经常使用的结构的分配，并管理集合大小的通用缓冲区。使用一种结构来描述所管理的每种类型的缓冲区。当分配特定类型的缓冲区时，我们会 malloc() 块中的内存（如果空闲缓冲区列表为空）。IE，如果我们管理 10 字节的缓冲区，我们可能会创建一个 malloc()，其中包含 100 个这些缓冲区的空间，以减少碎片和所需的底层 malloc 数量。

在每个缓冲区的前面是一个指针，用于链接空闲列表中的缓冲区。当分配了 100 个缓冲区时，每个缓冲区将在空闲列表中链接在一起。当缓冲区正在使用时，指针将设置为空。我们还维护了缓冲区“块”的列表，以便我们可以通过在每个实际的 malloc'd 缓冲区上调用 free() 来进行简单的清理。

为了管理动态缓冲区大小，我们还在每个缓冲区的开头添加了一个 size_t 变量，告诉缓冲区的大小。然后使用它来识别释放缓冲区时将其放回哪个缓冲区块。我们有 malloc() 和 free() 的替换例程，它们执行指针运算以获取缓冲区大小，然后将缓冲区放入空闲列表中。我们还限制了我们管理的缓冲区大小。大于此限制的缓冲区只需 malloc'd 并传递给用户。对于我们管理的结构，我们创建了用于分配和释放特定结构的包装程序。

最终，当用户请求清理未使用的内存时，我们还将系统改进为包括垃圾收集。由于我们可以控制整个系统，因此我们能够随着时间的推移进行各种优化以提高系统的性能。正如我所提到的，它确实工作得很好。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2014-04-03T11:01:37.053

我参加聚会有点晚了，但我只想分享我最近发现并测试过的嵌入式系统的非常有效的内存分配器：[https ://github.com/dimonomid/umm_malloc](http://goo.gl/XAiNHy)

这是一个专门设计用于 ARM7 的内存管理库，我个人在 PIC32 设备上使用它，但它应该适用于任何 16 位和 8 位设备（我计划在 16 位 PIC24 上进行测试，但我还没有测试过）

我被默认分配器的碎片严重击败：我的项目经常分配各种大小的块，从几个字节到几百个字节，有时我遇到“内存不足”错误。我的 PIC32 设备共有 32K 的 RAM，其中 8192 字节用于堆。在特定时刻有超过 5K 的可用内存，但由于碎片，默认分配器的最大非碎片内存块只有大约 700 字节。这太糟糕了，所以我决定寻找更有效的解决方案。

我已经知道一些分配器，但是它们都有一些限制（例如块大小应该是幂或 2，并且不是从 2 开始，而是从 128 字节开始），或者只是有问题。每次之前，我都必须切换回默认分配器。

但这一次，我很幸运：我找到了这个：[http ://hempeldesigngroup.com/embedded/stories/memorymanager/](http://hempeldesigngroup.com/embedded/stories/memorymanager/)

当我尝试这个内存分配器时，在完全相同的情况下，有 5K 的空闲内存，它有超过 3800 字节的块！这对我来说太不可思议了（与 700 字节相比），我进行了艰苦的测试：设备工作了 30 多个小时。没有内存泄漏，一切正常。我还在 FreeRTOS 存储库中找到了这个分配器：[http](http://svnmios.midibox.org/listing.php?repname=svn.mios32&path=%2Ftrunk%2FFreeRTOS%2FSource%2Fportable%2FMemMang%2F&rev=1041&peg=1041#) ://svnmios.midibox.org/listing.php?repname=svn.mios32&path=%2Ftrunk%2FFreeRTOS%2FSource%2Fportable%2FMemMang%2F&rev=1041&peg=1041# ，还有这个事实是 umm_malloc 稳定性的另一个证据。所以我完全切换到 umm_malloc，我对此非常满意。

我只需要稍微改变一下：当宏 UMM_TEST_MAIN 未定义时，配置有点错误，所以，我创建了 github 存储库（链接在这篇文章的顶部）。现在，用户相关配置存储在单独的文件 umm_malloc_cfg.h

在这个分配器中应用的算法我还没有深入了解，但是它对算法的解释非常详细，所以有兴趣的人可以看一下文件的顶部 umm_malloc.c 。至少，“分箱”方法应该在减少碎片方面带来巨大的好处：http: [//g.oswego.edu/dl/html/malloc.html](http://g.oswego.edu/dl/html/malloc.html)

我相信任何需要高效微控制器内存分配器的人，至少应该尝试这个。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-07T05:55:21.727

我最近对这个主题进行了一些研究，因为我们遇到了内存碎片问题。最后，我们决定继续使用 GNU libc 的实现，并在必要时添加一些应用程序级内存池。还有其他分配器具有更好的碎片行为，但我们对它们在全局范围内替换 malloc 感到不够满意。GNU 的优势在于其背后的悠久历史。

就您而言，这似乎是合理的；假设您无法修复 VM，那么这些微小的分配非常浪费。我不知道您的整个环境是什么，但您可能会考虑仅在 VM 上包装对 malloc/realloc/free 的调用，以便您可以将其传递给为小型池设计的处理程序。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-21T01:21:44.243

虽然我问这个已经有一段时间了，但我的最终解决方案是使用 LoKi 的 SmallObjectAllocator，它工作得很好。摆脱了所有操作系统调用并提高了我的 Lua 引擎在嵌入式设备上的性能。非常好和简单，只需大约 5 分钟的工作！

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-16T15:21:38.970

从[5.1 版](http://www.lua.org/versions.html#5.1)开始，[Lua](http://www.lua.org/)允许在[创建新状态](http://www.lua.org/manual/5.1/manual.html#lua_newstate)时设置[自定义分配器](http://www.lua.org/manual/5.1/manual.html#lua_Alloc)。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-07-04T00:39:10.477

即使它是一个旧线程，我也想补充一下。在嵌入式应用程序中，如果您可以分析应用程序的内存使用情况并得出不同大小的最大内存分配数量，通常最快的分配器类型是使用内存池的分配器。在我们的嵌入式应用程序中，我们可以确定运行时所需的所有分配大小。如果你能做到这一点，你就可以完全消除堆碎片并获得非常快的分配。大多数这些实现都有一个溢出池，它将为特殊情况做一个常规的 malloc，如果你的分析正确的话，希望它们之间的差距很小。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-07-04T01:03:20.773

我在vxworks下使用'binary buddy'系统效果很好。基本上，您通过将块切成两半来分配堆，以获得两个大小块的最小功率来容纳您的请求，当块被释放时，您可以向上传递树以将块合并在一起以减少碎片。谷歌搜索应该会找到您需要的所有信息。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2015-04-26T19:20:19.807

我正在编写一个名为 tinymem 的 C 内存分配器，旨在能够对堆进行碎片整理并重新使用内存。看看这个：

[https://github.com/vitiral/tinymem](https://github.com/vitiral/tinymem)

注意：该项目已停止进行 rust 实施：

[https://github.com/vitiral/defrag-rs](https://github.com/vitiral/defrag-rs)

另外，我以前没有听说过 umm_malloc。不幸的是，它似乎无法处理碎片，但它确实看起来很有用。我得去看看。

# sql-server - 身份和主键

> ID：177215
> 
> 赞同：1
> 
> 时间：2008-10-07T04:10:04.310
> 
> 标签：sql-server, migration

c# + sql server：我必须将一些表从 Access 导入到 sql server。新的 sql server 表已经定义和创建。Access 表具有必须维护的主键-外键关系。我想让新的 sql 表使用主键的标识值，但如果这样做，我将无法轻松加载旧行并维护关系。我可以使用 identity_insert 加载数据，但我必须退出我的 ORM 软件（亚音速）才能做到这一点。也许我可以使我的新主键成为非标识类型，但是为我以后添加的所有行生成唯一 ID 会很麻烦。我确信这在某处有一个不错的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T04:21:59.373

创建 PK 为“int”（无标识）的表，加载您的数据，然后将 PK 字段更改为 int 标识...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T04:24:30.647

您能否将主键作为非标识类型导入，然后在导入所有表中的所有数据后将它们更改为标识类型？

# ios - 找出已安装的 iPhone SDK 版本的最佳方法是什么？

> ID：177228
> 
> 赞同：3
> 
> 时间：2008-10-07T04:23:59.540
> 
> 标签：ios, macos

找出我的 OS X 上安装的 iPhone SDK 版本的最简单方法是什么？

当您登录 Apple 的 iPhone 开发者中心时，您可以看到当前可用版本的 SDK 的内部版本号，但您必须记住您是否已经下载了该版本。

保持最新状态最简单的方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-10-26T20:55:00.800

这是[这个问题](https://stackoverflow.com/questions/1480184/how-do-i-determine-which-iphone-sdk-i-have/)的交叉帖子。

> 检查您安装的 iPhone SDK 版本的最佳位置是使用 System Profiler。
> 
> Apple 菜单 > 关于本机 > 更多信息... > 软件 > 开发人员
> 
> 在那里，您将看到开发人员工具的所有主要组件的版本号和内部版本号。顶级版本和内部版本号对应于您从 Apple 下载的磁盘映像的名称。
> 
> 这适用于雪豹，但显然不适用于豹。我不知道 Leopard 中有一个非常有用的等价物。考虑升级:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T02:59:47.900

通常，您可以从 CoreServices/SystemVersion plist 文件中获取任何 SDK 的版本号：

*$Developer* /Platforms/ *$Platform* .platform/Developer/SDKs/ *$SDK* .sdk/System/Library/CoreServices/SystemVersion.plist。

您应该会看到 ProductBuildVersion 的条目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T04:51:19.127

您可以随时查看 /Developer 下名为“About iPhone SDK.pdf”的文件...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-10-27T15:46:08.303

使用 xcrun。

例子：

```
$ xcrun --sdk iphoneos --show-sdk-path
/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS11.0.sdk

$  xcrun --sdk iphoneos --show-sdk-platform-version
11.0

$ xcrun --sdk iphoneos --show-sdk-build-version
15A372 
```

检查`xcrun --help`您可能感兴趣的其他选项。

# sql - 如何在 Oracle 10+ 中包含 NULL 的列上使用基于函数的索引？

> ID：177240
> 
> 赞同：5
> 
> 时间：2008-10-07T04:33:41.953
> 
> 标签：sql, oracle

假设您在 Oracle 中有一个表：

```
CREATE TABLE person (
  id NUMBER PRIMARY KEY,
  given_names VARCHAR2(50),
  surname VARCHAR2(50)
); 
```

使用这些基于函数的索引：

```
CREATE INDEX idx_person_upper_given_names ON person (UPPER(given_names));
CREATE INDEX idx_person_upper_last_name ON person (UPPER(last_name)); 
```

现在， given_names 没有 NULL 值，但为了参数的缘故 last_name 有。如果我这样做：

```
SELECT * FROM person WHERE UPPER(given_names) LIKE 'P%' 
```

解释计划告诉我它使用索引，但将其更改为：

```
SELECT * FROM person WHERE UPPER(last_name) LIKE 'P%' 
```

它没有。Oracle 文档说，只有在满足几个条件时才会使用基于函数的索引，其中一个条件是确保没有 NULL 值，因为它们没有被索引。

我试过这些查询：

```
SELECT * FROM person WHERE UPPER(last_name) LIKE 'P%' AND UPPER(last_name) IS NOT NULL 
```

和

```
SELECT * FROM person WHERE UPPER(last_name) LIKE 'P%' AND last_name IS NOT NULL 
```

在后一种情况下，我什至在 last_name 上添加了一个索引，但无论我尝试什么，它都使用全表扫描。假设我无法摆脱 NULL 值，我如何让这个查询使用 UPPER(last_name) 上的索引？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-07T09:36:25.323

可以使用索引，尽管优化器可能选择不将它用于您的特定示例：

```
SQL> create table my_objects
  2  as select object_id, object_name
  3  from all_objects;

Table created.

SQL> select count(*) from my_objects;
  2  /

  COUNT(*)
----------
     83783

SQL> alter table my_objects modify object_name null;

Table altered.

SQL> update my_objects
  2  set object_name=null
  3  where object_name like 'T%';

1305 rows updated.

SQL> create index my_objects_name on my_objects (lower(object_name));

Index created.

SQL> set autotrace traceonly

SQL> select * from my_objects
  2  where lower(object_name) like 'emp%';

29 rows selected.

Execution Plan
----------------------------------------------------------

------------------------------------------------------------------------------------
| Id  | Operation                   | Name            | Rows  | Bytes | Cost (%CPU)|
------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT            |                 |    17 |   510 |   355   (1)|
|   1 |  TABLE ACCESS BY INDEX ROWID| MY_OBJECTS      |    17 |   510 |   355   (1)|
|*  2 |   INDEX RANGE SCAN          | MY_OBJECTS_NAME |   671 |       |     6   (0)|
------------------------------------------------------------------------------------ 
```

您阅读的文档可能指出，就像任何其他索引一样，全空键不存储在索引中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T05:23:23.383

在您的示例中，您创建了两次相同的索引 - 这会产生错误，所以我假设这是粘贴错误，而不是您尝试的实际代码。

我试过了

```
CREATE INDEX idx_person_upper_surname ON person (UPPER(surname));

SELECT * FROM person WHERE UPPER(surname) LIKE 'P%'; 
```

它产生了预期的查询计划：

```
Execution Plan
----------------------------------------------------------
   0      SELECT STATEMENT Optimizer=ALL_ROWS (Cost=1 Card=1 Bytes=67)
   1    0   TABLE ACCESS (BY INDEX ROWID) OF 'PERSON' (TABLE) (Cost=1
          Card=1 Bytes=67)

   2    1     INDEX (RANGE SCAN) OF 'IDX_PERSON_UPPER_SURNAME' (INDEX)
           (Cost=1 Card=1) 
```

要回答您的问题，是的，它应该可以工作。尝试仔细检查您是否正确创建了第二个索引。

也尝试一个明确的提示：

```
SELECT /*+INDEX(PERSON IDX_PERSON_UPPER_SURNAME)*/ * 
FROM person 
WHERE UPPER(surname) LIKE 'P%'; 
```

如果这有效，但只有提示，那么它可能与 CBO 统计信息出错或与 CBO 相关的 init 参数有关。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T05:31:15.363

您确定要使用索引吗？全表扫描还不错。根据表的大小，执行表扫描可能比使用索引更有效。它还取决于数据的密度和分布，这就是收集统计数据的原因。通常可以信任基于成本的优化器做出正确的选择。除非您有特定的性能问题，否则我不会太担心。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T11:02:33.760

您可以通过基于文字值的索引来规避空值在这种或其他情况下未索引的问题：

```
CREATE INDEX idx_person_upper_surname ON person (UPPER(surname),0); 
```

这允许您将索引用于以下查询：

```
Select *
From   person
Where  UPPER(surname) is null; 
```

此查询通常不使用索引，但位图索引或包含除 surname 之外的不可为空的实列的索引除外。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T12:16:09.150

Oracle 仍将使用基于函数的索引，其列包含 null - 我认为您误解了文档。

如果你想检查这个，你需要在函数索引中放一个 nvl。

就像是...

```
create index idx_person_upper_surname on person (nvl(upper(surname),'N/A')); 
```

然后，您可以使用索引查询

```
select * from person where nvl(upper(surname),'N/A') = 'PIERPOINT' 
```

虽然，都有点难看。由于大多数人都有姓氏，也许“不为空”是合适的:-)。

# asp.net - 您如何将主题存储在数据库中？

> ID：177241
> 
> 赞同：1
> 
> 时间：2008-10-07T04:34:06.650
> 
> 标签：asp.net

我知道如何在本地存储主题时动态加载主题。是否可以将这些主题存储在数据库中，但仍然按照参考 MSDN 文章中的描述以编程方式应用它们？

另外 - 如果您确实将它们存储在文件系统中，是否可以将 App_Themes 目录的路径更改为不同的位置？喜欢亚马逊 S3？

[以编程方式应用主题](http://msdn.microsoft.com/en-us/library/tx35bd89.aspx)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-07T10:20:16.467

主题需要在本地文件中（App_Themes/ThemeName 需要存在）。没有像 ThemeProvider 这样的概念（会很好，但没有）。您的样式表和皮肤文件需要在那里，图像等可以在任何地方。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-06-18T04:18:39.697

您可以使用您的自定义开发技巧，我可以建议您查看从 db 加载[果园主题。](http://www.orchardproject.net/)

# java - Java 运行时不支持编码“UTF-8”

> ID：177242
> 
> 赞同：11
> 
> 时间：2008-10-07T04:34:15.870
> 
> 标签：java, linux, unicode

每当我在 SUN Java（构建 1.6.0_10-rc2-b32 和其他 1.6.x 构建）下启动基于 Apache Felix (OSGi) 的应用程序时，我会在控制台上看到以下消息输出（通常在 Ubuntu 8.4 下）：

> 警告：Java 运行时不支持编码“UTF-8”。

在同时运行 Tomcat 和 Resin 时，我偶尔也会看到此消息。如果 java 支持 unicode 和 UTF-8，是什么导致了这个消息？我还没有找到任何参考，或者在其他任何地方回答这个问题。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-07T10:29:58.460

根据[文档](http://java.sun.com/javase/6/docs/api/java/nio/charset/Charset.html)“Java 平台的每个实现都需要支持以下标准字符集……US-ASCII、ISO-8859-1、UTF-8、UTF-16BE、UTF-16LE、UTF-16。” 所以我怀疑 Sun 是否发布了不支持 UTF-8 的版本。

实际的错误消息似乎来自[这里](http://www.jdocs.com/page/AjaxSourceCode?oid=10701)，它是 Xerces XML 解析器的一部分。我想这是发生问题的 XML 解析器。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-07T10:55:31.887

试试下面的程序：

```
import java.nio.charset.Charset;

public class TestCharset {
    public static void main(String[] args) {
        System.out.println(Charset.forName("UTF-8"));
    }
} 
```

如果这引发异常，那么您的 JDK 有问题。如果它打印“UTF-8”，那么你的 JDK 是好的，你的应用程序正在做一些奇怪的事情。

如果是这种情况，请在调试器下运行您的应用程序，并在[http://www.java2s.com/Open-Source/Java-Document/XML/xalan/org/apache/xml/serializer/ToStream.java中设置断点.htm](http://www.java2s.com/Open-Source/Java-Document/XML/xalan/org/apache/xml/serializer/ToStream.java.htm) -- 这就是产生此警告的地方，并逐步了解为什么 Xalan 找不到编码。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T10:56:45.737

很可能有人放了一个 catch() 期望只有不受支持的编码异常，所以他使用了适当的消息。但是他使用了太宽泛的异常规范（例如 catch( Exception ex ) ），所以当他在运行时得到其他东西（无效的 XML、NPE、...）时，该消息变得具有误导性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-28T10:30:51.530

尝试不同的（稳定版本）JVM。我曾经遇到过这个问题，结果发现机器运行的是测试版 JVM，它确实不支持 UTF-8，这与 API 文档中的要求相反。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-02-25T16:07:07.990

它应该是“UTF8”，没有破折号。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-08-30T16:12:27.780

如果您在使用 Transformer 时收到此消息，请尝试指定 TransformerFactory：

[关联](https://stackoverflow.com/a/3389479/1092788)

# java - Sun Java System 门户服务器

> ID：177244
> 
> 赞同：1
> 
> 时间：2008-10-07T04:36:43.523
> 
> 标签：java, system, portal, sun

我们如何为 Access Manager 定制制作 web-src 和为门户服务器定制制作 par-src？有具体的步骤吗？

谢谢和问候， 维韦克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-08T11:15:06.653

这似乎在 sun docs [here](http://docs.sun.com/app/docs/doc/819-5025/gdxcg?a=view)或[sun docs中有所描述](http://www.sun.com/bigadmin/sundocs/articles/sjspsacsds.jsp)

# c# - Asp.Net MVC：是否支持控制器级别的过滤器属性？

> ID：177246
> 
> 赞同：3
> 
> 时间：2008-10-07T04:37:14.740
> 
> 标签：c#, asp.net-mvc

我有一个过滤器属性，我想将其应用于控制器上的每个操作。是否有内置机制来支持这一点？现在，我正在手动将过滤器添加到每个操作，但这容易出错且乏味。如果不支持控制器级别的过滤器属性，是否有更好的方法来执行逻辑？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-07T04:38:40.930

将过滤器属性应用于控制器类。

# c - C 的单元测试框架

> ID：177251
> 
> 赞同：7
> 
> 时间：2008-10-07T04:39:20.227
> 
> 标签：c, unit-testing

> **可能重复：**
> [单元测试 C 代码](https://stackoverflow.com/questions/65820/unit-testing-c-code)

我已经看到了一些特定于 C++ 的问题，但我对 C 真的很好奇。我正在尝试将标准单元测试框架添加到我们的构建环境中。我的主要目标是鼓励我们的开发人员编写单元测试，并将这些测试标准化，以便其他人可以运行它们。理想情况下，我希望将单元测试作为我们每晚构建的一部分来运行。

我们开始使用 CUnit 进行一些工作，除了所有内容都在一个线程中运行并且任何内存错误都会导致单元测试停止运行，这很烦人。我还发现编写测试非常困难，但这对你来说可能只是单元测试。

有人知道好的替代品吗？有没有人有过使用纯 C 代码的 C++ 单元测试器的经验？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T21:52:58.667

我使用 C 编写嵌入式软件，并决定编写自己的框架。它非常简单，是为 MS Visual Studio 编写的。它很容易移植到其他平台。

[http://code.google.com/p/cunitwin32/](http://code.google.com/p/cunitwin32/)

如果您的目标是 linux，我认为 Check 可能适合您的需求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-11T16:18:08.807

如果你的目标是 Win32 平台或 NT 内核模式，你应该看看[cfix](http://cfix.sf.net/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T07:00:05.030

> 我们开始使用 CUnit 进行一些工作，除了所有内容都在一个线程中运行并且任何内存错误都会导致单元测试停止运行，这很烦人。

有一个 C 单元测试框架，它在一个单独的进程中分叉和执行每个测试用例，以便即使存在核心转储的测试，也可以执行所有测试： [检查](http://sourceforge.net/projects/check/)

但是，我担心所有这些分叉带来的性能损失（老实说，我没有尝试过）。但是我不会忍受任何单一的测试核心转储：我通常会立即修复它。

防止单元测试进入核心的一个技巧是**[断言保护](http://xunitpatterns.com/Guard%20Assertion.html)**，例如：使用断言来防止使用 NULL 指针（例如[minunit](http://www.jera.com/techinfo/jtns/jtn002.html)）。

```
void test_function_returning_a_pointer(void)
{
    struct_t *theStruct = function_returning_a_pointer();
    MU_ASSERT(theStruct != NULL);

    //--- now you can use the pointer 
    MU_ASSERT(theStruct->field1 == 0);

    return MU_PASSED;
} 
```

顺便说一句，我不知道有任何 C++ 单元测试框架在违反分段的情况下不会崩溃。

> 我还发现编写测试非常困难，但这对你来说可能只是单元测试。

你能详细说明你的困难吗？您是否正在尝试对遗留代码进行测试？

# axapta - 如何从类 ID 中识别 Axapta 类名称？

> ID：177258
> 
> 赞同：5
> 
> 时间：2008-10-07T04:47:55.937
> 
> 标签：axapta, microsoft-dynamics

请问有人可以帮我理解批处理的疯狂吗？

我正在尝试调试具有大约 50 个批处理作业的 Axapta 3.0 实现。大多数批处理类不实现该**`description()`**方法，因此当您查看*批处理列表*表单（基本>>查询>>批处理列表）时，描述字段为空白。您可以看到**Batch Group**和**Start Time**等，但您无法判断实际调用的是哪个类。

*Batch*表包含一个名为*ClassNum*的隐藏字段，用于标识类的*ID*属性。谁能告诉我如何从ID中找到相应的班级？一旦我确定了罪魁祸首，我就可以添加描述。

我尝试在 AOT 上使用标准的*Find*功能，但它没有找到它们。

任何建议都将受到欢迎！

非常感谢，迈克

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-07T06:09:10.920

Jay 的回答提供了两个综合解决方案。

我刚刚发现全局类**ClassId2Name**做同样的事情，所以你可以简单地拥有：

```
display str Classname()
{
   return ClassId2Name(this.ClassNum);    
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T16:44:01.607

至少有两种方法可以做到这一点，您可以使用`DictClass`该类：

```
display ClassName className()
{
    DictClass dictClass = new DictClass(this.ClassNum);
    ;
    if(dictClass!=null)
        return dictClass.name();
    return '';
} 
```

或使用`UtilIdElements`表格：

```
display ClassName className()
{
    UtilIdElements utilIdElements;
    ;
    select utilIdElements where utilIdElements.id==this.ClassNum && utilIdElements.recordType==UtilElementType::Class;
    if(utilIdElements)
        return utilIdElements.name;
    return '';
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-03-09T09:32:36.047

如果 ClassNum 不可用，则获取 ClassName 的替代方法。

```
display str Classname()
{
   return classId2Name(ClassIdGet(this));  
} 
```

# .net - 为什么 Array.Sort() 和 Array.IndexOf() 方法是静态的？

> ID：177259
> 
> 赞同：6
> 
> 时间：2008-10-07T04:48:13.627
> 
> 标签：.net, collections, framework-design

总是很感兴趣，为什么[Array.Sort()](http://msdn.microsoft.com/en-us/library/system.array.sort.aspx)和[Array.IndexOf()](http://msdn.microsoft.com/en-us/library/system.array.indexof.aspx)方法是静态的，类似的[ArrayList.Sort()](http://msdn.microsoft.com/en-us/library/system.collections.arraylist.sort.aspx)和[ArrayList.IndexOf()](http://msdn.microsoft.com/en-us/library/system.collections.arraylist.indexof.aspx)被设计为成员方法。谢谢你的任何想法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T05:03:59.023

在我看来，Array 类基本上是我们在程序中使用 [] 声明的固定大小数组的类表示（您可以像 int 一样将其类（结构）表示为 System.Int32 进行类比）。

此外，Array 类不包含任何实例变量中的实际数组数据，但它仅提供静态实用程序函数，可用于在声明的固定大小数组中进行排序和搜索。

另一方面，ArrayList 是一个集合类，它提供动态大小的数组实现，并且它有自己的数据结构来包含数据。因此，所述方法是实例方法，因此它们可以处理该特定实例的数据。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-05T18:47:07.013

像这样的集合类`ArrayList`封装了某种内部存储（可能是一个根据需要调整大小的数组，但它也可以是一个链表或其他一些实现）。方法喜欢`IndexOf`并且`Sort`需要访问底层私有存储以提高效率，因此它们必须是实例方法。

`Array`另一方面，没有封装，可以直接访问存储。`Array.IndexOf`and`Array.Sort`方法不需要对数组数据进行任何特殊访问，因此它们也可以是静态方法。

# jsp - JSP-Servlet 应用程序的任何视图状态实现？

> ID：177260
> 
> 赞同：3
> 
> 时间：2008-10-07T04:50:16.227
> 
> 标签：jsp, viewstate

您是否知道任何可以提供与 Viewstate 在 ASP.NET 中提供的类似行为的实现/技术。（将数据序列化到 HTML 表单中的隐藏字段中）。

我只使用 JSP、Servlet 和 Spring MVC。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T06:53:57.600

我认为[Stripes](http://www.stripesframework.org/)框架提供了这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T07:27:22.337

Spring Webflow 提供了类似的工具，范围仅限于个人对话。 [手册的持久化部分](http://static.springframework.org/spring-webflow/docs/2.0.x/reference/html/ch06.html)应该能够解释这些概念。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T10:05:08.510

你可以很容易地做到 JSP 。使用 base64 Hareesh 获取对象蒸汽并覆盖到 ASCII 数据

# genetic-algorithm - 遗传算法中的轮盘赌选择

> ID：177271
> 
> 赞同：38
> 
> 时间：2008-10-07T04:56:18.493
> 
> 标签：genetic-algorithm, evolutionary-algorithm, roulette-wheel-selection

任何人都可以为轮盘赌选择功能提供一些伪代码吗？我将如何实现这一点：

![替代文字](https://upload.wikimedia.org/math/0/d/2/0d24a82d8e813380f670bf80ae74486b.png)

我真的不明白如何阅读这个数学符号。我从不接受任何概率或统计数据。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-10-07T05:03:08.400

我自己做这个已经有几年了，但是在谷歌上很容易找到以下伪代码。

```
对于所有人口
    sum += 这个人的适应度
结束

对于所有人口
    概率=概率之和+（适应度/总和）
    概率之和 += 概率
结束

循环直到新的人口已满
    这样做两次
        number = 0 到 1 之间的随机数
        对于所有人口
            如果数字 > 概率但小于下一个概率
                那么你已被选中
        结束
    结尾
    创造后代
结束循环

```

如果您需要更多详细信息，可以在[此处找到此来源的网站。](http://geneticalgorithms.ai-depot.com/Tutorial/Overview.html)

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2011-12-11T11:38:22.350

已经有很多正确的解决方案，但我认为这段代码更清晰。

```
def select(fs):
    p = random.uniform(0, sum(fs))
    for i, f in enumerate(fs):
        if p <= 0:
            break
        p -= f
    return i 
```

此外，如果你积累 fs，你可以产生一个更有效的解决方案。

```
cfs = [sum(fs[:i+1]) for i in xrange(len(fs))]

def select(cfs):
    return bisect.bisect_left(cfs, random.uniform(0, cfs[-1])) 
```

这既更快又非常简洁的代码。C++ 中的 STL 有一个类似的二等分算法，如果这是您使用的语言。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2011-03-15T17:37:25.090

发布的伪代码包含一些不清楚的元素，它增加了生成*后代*而不是执行纯选择的复杂性。这是该伪代码的简单python实现：

```
def roulette_select(population, fitnesses, num):
    """ Roulette selection, implemented according to:
        <http://stackoverflow.com/questions/177271/roulette
        -selection-in-genetic-algorithms/177278#177278>
    """
    total_fitness = float(sum(fitnesses))
    rel_fitness = [f/total_fitness for f in fitnesses]
    # Generate probability intervals for each individual
    probs = [sum(rel_fitness[:i+1]) for i in range(len(rel_fitness))]
    # Draw new population
    new_population = []
    for n in xrange(num):
        r = rand()
        for (i, individual) in enumerate(population):
            if r <= probs[i]:
                new_population.append(individual)
                break
    return new_population 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2014-04-24T08:56:03.923

这称为通过随机接受的轮盘赌选择：

```
/// \param[in] f_max maximum fitness of the population
///
/// \return index of the selected individual
///
/// \note Assuming positive fitness. Greater is better.

unsigned rw_selection(double f_max)
{
  for (;;)
  {
    // Select randomly one of the individuals
    unsigned i(random_individual());

    // The selection is accepted with probability fitness(i) / f_max
    if (uniform_random_01() < fitness(i) / f_max)
      return i;
  }   
} 
```

单次选择所需的平均尝试次数为：

τ = f [max] / avg(f)

*   f [max]是种群的最大适应度
*   avg(f) 是平均适应度

τ 不明确取决于群体中的个体数量 (N)，但该比率可以随 N 变化。

然而，在许多应用中（适应度保持有界并且平均适应度不会随着 N 的增加而减小到 0）τ 不会随 N​​ 无限增加，因此**该算法的典型复杂度是 O(1)**（轮盘赌选择使用搜索算法具有 O(N) 或 O(log N) 复杂度）。

这个过程的概率分布确实与经典的轮盘赌选择相同。

有关详细信息，请参阅：

*   *通过随机接受选择轮盘赌*(Adam Liposki, Dorota Lipowska - 2011)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-24T15:52:34.983

这是 C 中的一些代码：

```
// Find the sum of fitnesses. The function fitness(i) should 
//return the fitness value   for member i**

float sumFitness = 0.0f;
for (int i=0; i < nmembers; i++)
    sumFitness += fitness(i);

// Get a floating point number in the interval 0.0 ... sumFitness**
float randomNumber = (float(rand() % 10000) / 9999.0f) * sumFitness;

// Translate this number to the corresponding member**
int memberID=0;
float partialSum=0.0f;

while (randomNumber > partialSum)
{
   partialSum += fitness(memberID);
   memberID++;
} 

**// We have just found the member of the population using the roulette algorithm**
**// It is stored in the "memberID" variable**
**// Repeat this procedure as many times to find random members of the population** 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-10-22T08:22:13.667

从上面的答案中，我得到了以下内容，这对我来说比答案本身更清楚。

举个例子：

Random(sum) :: Random(12) 遍历总体，我们检查以下内容： random < sum

让我们选择 7 作为随机数。

```
Index   |   Fitness |   Sum |   7 < Sum
0       |   2   |   2       |   false
1       |   3   |   5       |   false
2       |   1   |   6       |   false
3       |   4   |   10      |   true
4       |   2   |   12      |   ... 
```

通过这个例子，最适合的（索引 3）被选中的百分比最高（33%）；因为随机数只需要落在 6->10 内，就会被选中。

```
 for (unsigned int i=0;i<sets.size();i++) {
        sum += sets[i].eval();
    }       
    double rand = (((double)rand() / (double)RAND_MAX) * sum);
    sum = 0;
    for (unsigned int i=0;i<sets.size();i++) {
        sum += sets[i].eval();
        if (rand < sum) {
            //breed i
            break;
        }
    } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-05-28T14:51:10.237

斯坦福 AI 实验室的 Thrun 教授还在 Udacity 的 CS373 期间展示了一个用 python 进行快速（呃？）重新采样的代码。谷歌搜索结果导致以下链接：

[http://www.udacity-forums.com/cs373/questions/20194/fast-resampling-algorithm](http://www.udacity-forums.com/cs373/questions/20194/fast-resampling-algorithm)

希望这可以帮助

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-06-08T13:29:42.730

这是我最近为轮盘选择编写的一个紧凑的 java 实现，希望可以使用。

```
public static gene rouletteSelection()
{
    float totalScore = 0;
    float runningScore = 0;
    for (gene g : genes)
    {
        totalScore += g.score;
    }

    float rnd = (float) (Math.random() * totalScore);

    for (gene g : genes)
    {   
        if (    rnd>=runningScore &&
                rnd<=runningScore+g.score)
        {
            return g;
        }
        runningScore+=g.score;
    }

    return null;
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-01-26T12:22:19.243

**MatLab 中的轮盘选择：**

```
TotalFitness=sum(Fitness);
    ProbSelection=zeros(PopLength,1);
    CumProb=zeros(PopLength,1);

    for i=1:PopLength
        ProbSelection(i)=Fitness(i)/TotalFitness;
        if i==1
            CumProb(i)=ProbSelection(i);
        else
            CumProb(i)=CumProb(i-1)+ProbSelection(i);
        end
    end

    SelectInd=rand(PopLength,1);

    for i=1:PopLength
        flag=0;
        for j=1:PopLength
            if(CumProb(j)<SelectInd(i) && CumProb(j+1)>=SelectInd(i))
                SelectedPop(i,1:IndLength)=CurrentPop(j+1,1:IndLength);
                flag=1;
                break;
            end
        end
        if(flag==0)
            SelectedPop(i,1:IndLength)=CurrentPop(1,1:IndLength);
        end
    end 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-02-27T18:12:43.883

**好的，轮盘选择**实现有两种方法：**通常**和**随机接受**一种。

**常用**算法：

```
# there will be some amount of repeating organisms here.
mating_pool = []

all_organisms_in_population.each do |organism|
  organism.fitness.times { mating_pool.push(organism) }
end

# [very_fit_organism, very_fit_organism, very_fit_organism, not_so_fit_organism]
return mating_pool.sample #=> random, likely fit, parent! 
```

**随机接受**算法：

```
max_fitness_in_population = all_organisms_in_population.sort_by(:fitness)[0]
loop do
  random_parent = all_organisms_in_population.sample
  probability = random_parent.fitness/max_fitness_in_population * 100
  # if random_parent's fitness is 90%,
  # it's very likely that rand(100) is smaller than it.
  if rand(100) < probability
    return random_parent #=> random, likely fit, parent!
  else
    next #=> or let's keep on searching for one.
  end
end 
```

您可以选择其中任何一个，它们将返回相同的结果。

* * *

### 有用的资源：

[http://natureofcode.com/book/chapter-9-the-evolution-of-code](http://natureofcode.com/book/chapter-9-the-evolution-of-code) - 对初学者友好且清晰的遗传算法章节。**将轮盘选择**解释为一桶木制字母（您输入的越多 - 选择 A，**通常**算法的机会就越大）。

[https://en.wikipedia.org/wiki/Fitness_proportionate_selection](https://en.wikipedia.org/wiki/Fitness_proportionate_selection) - 描述**随机接受**算法。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-03-18T12:15:54.713

```
Based on my research ,Here is another implementation in C# if there is a need for it:

//those with higher fitness get selected wit a large probability 
//return-->individuals with highest fitness
        private int RouletteSelection()
        {
            double randomFitness = m_random.NextDouble() * m_totalFitness;
            int idx = -1;
            int mid;
            int first = 0;
            int last = m_populationSize -1;
            mid = (last - first)/2;

            //  ArrayList's BinarySearch is for exact values only
            //  so do this by hand.
            while (idx == -1 && first <= last)
            {
                if (randomFitness < (double)m_fitnessTable[mid])
                {
                    last = mid;
                }
                else if (randomFitness > (double)m_fitnessTable[mid])
                {
                    first = mid;
                }
                mid = (first + last)/2;
                //  lies between i and i+1
                if ((last - first) == 1)
                    idx = last;
            }
            return idx;
        } 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-11-20T22:36:12.800

这个**Swift 4**数组扩展实现了加权随机选择，也就是从其元素中选择轮盘赌：

```
public extension Array where Element == Double {

    /// Consider the elements as weight values and return a weighted random selection by index.
    /// a.k.a Roulette wheel selection.
    func weightedRandomIndex() -> Int {
        var selected: Int = 0
        var total: Double = self[0]

        for i in 1..<self.count { // start at 1
            total += self[i]
            if( Double.random(in: 0...1) <= (self[i] / total)) { selected = i }
        }

        return selected
    }
} 
```

例如给定两个元素数组：

```
[0.9, 0.1] 
```

`weightedRandomIndex()`将在 90% 的时间和 10% 的时间返回零。

这是一个更完整的测试：

```
let weights = [0.1, 0.7, 0.1, 0.1]
var results = [Int:Int]()
let n = 100000
for _ in 0..<n {
    let index = weights.weightedRandomIndex()
    results[index] = results[index, default:0] + 1
}
for (key,val) in results.sorted(by: { a,b in weights[a.key] < weights[b.key] }) {
    print(weights[key], Double(val)/Double(n))
} 
```

输出：

```
0.1 0.09906
0.1 0.10126
0.1 0.09876
0.7 0.70092 
```

这个答案与Andrew Mao在这里的答案基本相同： [https ://stackoverflow.com/a/15582983/74975](https://stackoverflow.com/a/15582983/74975)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-05-22T12:43:45.307

这是python中的代码。此代码还可以处理适应度的负值。

```
from numpy import min, sum, ptp, array 
from numpy.random import uniform 

list_fitness1 = array([-12, -45, 0, 72.1, -32.3])
list_fitness2 = array([0.5, 6.32, 988.2, 1.23])

def get_index_roulette_wheel_selection(list_fitness=None):
    """ It can handle negative also. Make sure your list fitness is 1D-numpy array"""
    scaled_fitness = (list_fitness - min(list_fitness)) / ptp(list_fitness)
    minimized_fitness = 1.0 - scaled_fitness
    total_sum = sum(minimized_fitness)
    r = uniform(low=0, high=total_sum)
    for idx, f in enumerate(minimized_fitness):
        r = r + f
        if r > total_sum:
            return idx

get_index_roulette_wheel_selection(list_fitness1)
get_index_roulette_wheel_selection(list_fitness2) 
```

1.  确保您的健身列表是 1D-numpy 数组
2.  将适应度列表缩放到范围 [0, 1]
3.  将最大问题转换为最小问题 1.0 - scaled_fitness_list
4.  随机一个介于 0 和 sum(minimizzed_fitness_list) 之间的数字
5.  继续在最小化适应度列表中添加元素，直到我们得到大于总和的值
6.  你可以看到适应度是否小 --> 它在最小化的适应度中具有更大的价值 --> 它有更大的机会相加并使值大于总和。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2011-05-04T19:28:09.467

我用 C# 编写了一个版本，并且真的在寻找它确实正确的确认：

（roulette_selector 是一个随机数，范围为 0.0 到 1.0）

```
private Individual Select_Roulette(double sum_fitness)
    {
        Individual ret = new Individual();
        bool loop = true;

        while (loop)
        {
            //this will give us a double within the range 0.0 to total fitness
            double slice = roulette_selector.NextDouble() * sum_fitness;

            double curFitness = 0.0;

            foreach (Individual ind in _generation)
            {
                curFitness += ind.Fitness;
                if (curFitness >= slice)
                {
                    loop = false;
                    ret = ind;
                    break;
                }
            }
        }
        return ret;

    } 
```

# jquery - ASP.NET MVC 的网格控件？

> ID：177275
> 
> 赞同：279
> 
> 时间：2008-10-07T05:00:58.063
> 
> 标签：jquery, asp.net-mvc, grid

如果您使用的是 ASP.NET MVC，您是如何进行网格显示的？自己滚？从某个地方得到一个图书馆？

这些是我为 ASP.NET MVC 找到的一些已知的网格显示解决方案

*   [ASP.NET MVC Flexgrid](http://www.codeproject.com/KB/aspnet/MVCFlexigrid.aspx) - 有很好的列布局方法
*   [基于代码的 ASP.NET MVC GridView](https://blog.maartenballiauw.be/post/2008/06/04/code-based-aspnet-mvc-gridview.html) - 简单、小巧、干净
*   [MVC Contrib](http://weblogs.asp.net/shijuvarghese/archive/2008/07/23/asp-net-mvc-grid-view-using-mvccontrib.aspx) - 来自 codePlex 的网格
*   [jQueryGrid](http://www.trirand.com/blog/?page%5Fid=6) - jQuery 网格
*   [Datatables](http://www.datatables.net/) - jQuery 插件 - 被认为符合第 508 节（[.NET 绑定](https://github.com/mcintyre321/mvc.jquery.datatables)）
*   [extJS](http://extjs.com/deploy/dev/examples/samples.html) - 跨浏览器 RIA 框架 - 具有网格支持
*   [Ingrid](http://www.reconstrukt.com/ingrid/) - jQuery 数据网格
*   [jqxGrid](http://jqwidgets.com/) - jQuery 数据网格
*   [Telerik MVC](http://demos.telerik.com/aspnet-mvc/) - GPL v2 许可的基于 jQuery 的网格，也提供商业版本
*   [MVC 控件工具包](http://mvccontrolstoolkit.codeplex.com/)- 基于客户端站点的网格
*   [Infragistics igGrid](http://www.infragistics.com/dotnet/netadvantage/jquery-controls/grid.aspx) - 基于 jQuery 的 MVC 网格
*   [dhtmlxGrid](http://www.dhtmlx.com/blog/?p=1349) - 支持 Ajax 的 JavaScript 网格控件
*   [ASP.net MVC Awesome Ajax List](http://demo.aspnetawesome.com/Dinners) - 一种不同的、非常灵活的方法，可以用作网格
*   [Syncfusion MVC 网格](http://mvc.syncfusion.com/sfmvcsamplebrowser/10.2.0.56/Grid_MVC/Samples/4.0/Razor)- 商业网格
*   [ASP.net MVC Awesome Grid](http://demo.aspnetawesome.com/GridDemo) - Awesome 库的一部分（基于 jQuery）
*   [为 ASP.NET MVC 屏蔽 UI 网格](http://demos.shieldui.com/mvc/grid-general/basic-usage)
*   [ASP.NET MVC 5 项目的网格控件](http://mvc-grid.azurewebsites.net/)

如果您知道其他您正在使用或知道的好东西，请告诉我。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-10-11T12:46:27.093

我们一直在一个项目中使用[jqGrid](http://www.trirand.com/blog/?page_id=6)，并且运气不错。有很多用于内联编辑等的选项。如果不需要这些东西，那么我们只需使用像@Hrvoje 这样的普通 foreach 循环。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2010-08-19T10:45:42.183

我们在 Stack Exchange Data Explorer 中使用[Slick Grid （](https://github.com/mleibman/SlickGrid)[包含 2000 行的示例](https://data.stackexchange.com/stackoverflow/query/9548/select-top-2000-from-posts)）。

我发现它优于[jqGrid](http://www.trirand.com/blog/)和[flexigrid](https://github.com/paulopmx/Flexigrid)。它有一个非常完整的功能集，我不能推荐它。

它的使用示例[在这里](https://wiki.github.com/mleibman/SlickGrid/examples)。

您可以在此处查看有关如何将其集成到 ASP.NET MVC 应用程序的源示例：[https ://code.google.com/p/stack-exchange-data-explorer/](https://code.google.com/p/stack-exchange-data-explorer/)

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-10-09T10:02:08.517

由于我们网格的功能要求有限，我们刚刚推出了自己的产品。我们在这里和那里使用一些 JQuery 来实现一些细节，比如分页，这就是我们真正需要的。

如果您需要更全面的功能，您可以[在此处](http://extjs.com/deploy/dev/examples/samples.html)查看 ExtJs 网格。

此外，MvcContrib 有一个网格实现，您可以[在这里](http://code.google.com/p/mvccontrib/)查看 - 试试看。或者更具体地说[，这里](http://code.google.com/p/mvccontrib/source/browse/#svn/trunk/src/MVCContrib/UI/Grid/UI/Html/Grid)。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-11-30T17:38:42.290

我刚刚发现 Telerik 有一些很棒的组件，包括 Grid，它们也是开源的。 [http://demos.telerik.com/aspnet-mvc/](http://demos.telerik.com/aspnet-mvc/)

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-10-07T09:04:27.417

如果只是为了查看数据，我使用简单的 foreach 甚至 aspRepeater。对于编辑，我构建了专门的视图和操作。无论如何都不喜欢 webforms GridView 内联编辑功能，这更清晰更好 - 一个视图用于查看，另一个用于编辑/新建。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-05-30T17:15:59.383

我们使用 MVCContrib 网格。

[http://weblogs.asp.net/rajbk/archive/2010/05/08/asp-net-mvc-paging-sorting-filtering-using-the-mvccontrib-grid-and-pager.aspx](http://weblogs.asp.net/rajbk/archive/2010/05/08/asp-net-mvc-paging-sorting-filtering-using-the-mvccontrib-grid-and-pager.aspx)

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2010-08-19T01:20:15.790

如果您使用具有服务器端集成的特殊版本，jqGrid 是 299 美元，但是使用带有 ASP.NET MVC 的开源免费版本确实并不难，一旦您直接获得了 jquery 配置，它几乎就像任何使用一样简单其他许可网格：

[http://haacked.com/archive/2009/04/14/using-jquery-grid-with-asp.net-mvc.aspx](http://haacked.com/archive/2009/04/14/using-jquery-grid-with-asp.net-mvc.aspx)

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2010-10-12T07:07:31.693

您还可以在 codeplex 上使用我的 MVC 控件工具包的插入/更新/删除数据网格：http: [//mvccontrolstoolkit.codeplex.com/](http://mvccontrolstoolkit.codeplex.com/)。[在这里](http://mvccontrolstoolkit.codeplex.com/releases)你可以下载一个完整的例子，[这里](http://mvccontrolstoolkit.codeplex.com/wikipage?title=DataGrid%20and%20Pager%20Complete%20Example)的数据网格工作和[这里](http://www.dotnet-programming.com/post/2010/10/30/Defining-MVC-Controls-2-Using-the-DataGrid.aspx)和[这里](http://www.dotnet-programming.com/post/2010/11/15/Defining-MVC-Controls-3-Datagrid-Sorting-and-Master-Detail-Views.aspx)的教程。DataGrid 完全在客户端工作，并维护帖子之间的更改集。是的，它维护变更集，这意味着，您可以访问每条记录的旧版本和修改版本，以查看要传递给数据库的更改（需要修改删除或插入的内容）。在您确认或取消服务器端的修改之前，此变更集会在多次发布后得到维护。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2010-06-25T04:56:20.460

如果它是只读的，一个好主意是创建一个表，然后对其应用一些非常简单但功能强大的 JQuery。

对于简单的替代颜色，[试试这个](http://www.packtpub.com/article/jquery-table-manipulation-part2)简单的 JQuery。

如果您需要排序，[这个 JQuery 插件](http://tablesorter.com/docs/)简直就是摇滚。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2010-10-31T10:01:09.583

[我在这里](http://mvccontrolstoolkit.codeplex.com/wikipage?title=DataGrid%20and%20Pager%20Complete%20Example)尝试了Mvc Controls Toolkit 网格的示例。它看起来是一个非常强大且易于使用的网格。本教程不仅解释了如何使用网格，还解释了如何进行分页、组织视图模型和数据注释。值得一读。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-07-20T12:08:45.917

试试： http: [//mvcjqgridcontrol.codeplex.com/](http://mvcjqgridcontrol.codeplex.com/) 它基本上是一个符合 MVC 的 jQuery Grid 包装器，具有完整的 .Net 支持

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-05-23T08:20:15.977

[从Infragistics jQuery 控件](http://www.infragistics.com/dotnet/netadvantage/jquery-controls.aspx#Overview)中查看网格

这是一个带有代码的 ASP.NET MVC 示例：

[http://labs.infragistics.com/aspnet-mvc/Grid/AllFeatures](http://labs.infragistics.com/aspnet-mvc/Grid/AllFeatures)

# qtp - 将 XML 文件加载到 QTP

> ID：177276
> 
> 赞同：0
> 
> 时间：2008-10-07T05:01:38.840
> 
> 标签：qtp

我可以请你帮我澄清一个查询..

我收到一条错误消息“80004005- 无法打开文件”

场景是我试图在运行时加载使用 VB 脚本创建的 XML 文件。即 XML 的创建和将其加载到 QTP 是在同一个脚本中一个接一个地处理的。我能够加载之前创建的文件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T05:44:31.673

我解决了。原因是对象在创建后没有关闭。

谢谢

# .net - 如何在 .NET 中获取 TreeView 中所有子节点的列表

> ID：177277
> 
> 赞同：16
> 
> 时间：2008-10-07T05:02:51.943
> 
> 标签：.net, vb.net, treeview, tree-nodes

我的 WinForms .NET 应用程序中有一个 TreeView 控件，该控件具有多个级别的子节点，这些子节点的子节点具有更多的子节点，没有定义的深度。当用户选择任何父节点（不一定在根级别）时，如何获取该父节点下所有节点的列表？

例如，我从这个开始：

```
Dim nodes As List(Of String)

For Each childNodeLevel1 As TreeNode In parentNode.Nodes
    For Each childNodeLevel2 As TreeNode In childNodeLevel1.Nodes
        For Each childNodeLevel3 As TreeNode In childNodeLevel2.Nodes
            nodes.Add(childNodeLevel3.Text)
        Next
    Next
Next 
```

问题是这个循环深度是定义的，我只是让节点埋在三个层次上。如果下次用户选择父节点时，有七个级别怎么办？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-07T05:10:35.767

使用递归

```
Function GetChildren(parentNode as TreeNode) as List(Of String)
  Dim nodes as List(Of String) = New List(Of String)
  GetAllChildren(parentNode, nodes)
  return nodes
End Function

Sub GetAllChildren(parentNode as TreeNode, nodes as List(Of String))
  For Each childNode as TreeNode in parentNode.Nodes
    nodes.Add(childNode.Text)
    GetAllChildren(childNode, nodes)
  Next
End Sub 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-07T05:05:25.213

您需要一个递归函数来执行此操作[或等效的循环，但递归版本更简单] - 伪代码：

```
function outputNodes(Node root)
    writeln(root.Text)
    foreach(Node n in root.ChildNodes)
        outputNodes(n)
    end
end 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-26T13:01:08.053

这是我用来从我的核心库中执行此任务的代码片段。
它允许您在不使用递归的情况下列出深度优先或呼吸优先的节点，这具有在 JIT 引擎中构造堆栈帧的开销。它非常快。

要使用它，只需：

```
List< TreeNode > nodes = TreeViewUtils.FlattenDepth(tree); 
```

抱歉，您有一个 VB.Net 标签；我不能举个例子，但我相信你会解决的。

```
public class TreeViewUtils
{
    /// <summary>
    /// This static utiltiy method flattens all the nodes in a tree view using
    /// a queue based breath first search rather than the overhead
    /// of recursive method calls.
    /// </summary>
    /// <param name="tree"></param>
    /// <returns></returns>
    public static List<TreeNode> FlattenBreath(TreeView tree) {
        List<TreeNode> nodes = new List<TreeNode>();

        Queue<TreeNode> queue = new Queue<TreeNode>();

        //
        // Bang all the top nodes into the queue.
        //
        foreach(TreeNode top in tree.Nodes) {
            queue.Enqueue(top);
        }

        while(queue.Count > 0) {
            TreeNode node = queue.Dequeue();
            if(node != null) {
                //
                // Add the node to the list of nodes.
                //
                nodes.Add(node);

                if(node.Nodes != null && node.Nodes.Count > 0) {
                    //
                    // Enqueue the child nodes.
                    //
                    foreach(TreeNode child in node.Nodes) {
                        queue.Enqueue(child);
                    }
                }
            }
        }
        return nodes;
    }

    /// <summary>
    /// This static utiltiy method flattens all the nodes in a tree view using
    /// a stack based depth first search rather than the overhead
    /// of recursive method calls.
    /// </summary>
    /// <param name="tree"></param>
    /// <returns></returns>
    public static List<TreeNode> FlattenDepth(TreeView tree) {
        List<TreeNode> nodes = new List<TreeNode>();

        Stack<TreeNode> stack = new Stack<TreeNode>();

        //
        // Bang all the top nodes into the queue.
        //
        foreach(TreeNode top in tree.Nodes) {
            stack.Push(top);
        }

        while(stack.Count > 0) {
            TreeNode node = stack.Pop();
            if(node != null) {

                //
                // Add the node to the list of nodes.
                //
                nodes.Add(node);

                if(node.Nodes != null && node.Nodes.Count > 0) {
                    //
                    // Enqueue the child nodes.
                    //
                    foreach(TreeNode child in node.Nodes) {
                        stack.Push(child);
                    }
                }
            }
        }
        return nodes;
    }
} 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-06-09T09:33:11.583

我有一个用于此的扩展方法：

```
public static IEnumerable<TreeNode> DescendantNodes( this TreeNode input ) {
    foreach ( TreeNode node in input.Nodes ) {
        yield return node;
        foreach ( var subnode in node.DescendantNodes() )
            yield return subnode;
        }
} 
```

它是 C#，但可以从 VB 引用或转换为它。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-06-19T12:07:11.630

```
nodParent As TreeNode
'nodParent = your parent Node
tvwOpt.Nodes.Find(nodParent.Name, True) 
```

就是这样

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-10-06T04:59:53.233

阿德里安的方法太棒了。工作得非常快并且比递归方法工作得更好。我已经完成了对 VB 的翻译。我从中学到了很多。希望有人仍然需要它。

简单地使用它：

```
Dim FlattenedNodes As List(Of TreeNode) = clTreeUtil.FlattenDepth(Me.TreeView1) 
```

这是代码，干杯！：

```
Public Class clTreeUtil
''' <summary>
''' This static utiltiy method flattens all the nodes in a tree view using
''' a queue based breath first search rather than the overhead
''' of recursive method calls.
''' </summary>
''' <param name="tree"></param>
''' <returns></returns>
Public Shared Function FlattenBreath(Tree As TreeView) As List(Of TreeNode)
    Dim nodes As List(Of TreeNode) = New List(Of TreeNode)
    Dim queue As Queue(Of TreeNode) = New Queue(Of TreeNode)

    ''
    '' Bang all the top nodes into the queue.
    ''
    For Each top As TreeNode In Tree.Nodes
        queue.Enqueue(top)
    Next

    While (queue.Count > 0)
        Dim node As TreeNode = queue.Dequeue()
        If node IsNot Nothing Then
            ''
            '' Add the node to the list of nodes.
            ''
            nodes.Add(node)

            If node.Nodes IsNot Nothing And node.Nodes.Count > 0 Then
                ''
                '' Enqueue the child nodes.
                ''
                For Each child As TreeNode In node.Nodes
                    queue.Enqueue(child)
                Next
            End If
        End If
    End While

    Return nodes
End Function

''' <summary>
''' This static utiltiy method flattens all the nodes in a tree view using
''' a stack based depth first search rather than the overhead
''' of recursive method calls.
''' </summary>
''' <param name="tree"></param>
''' <returns></returns>
Public Shared Function FlattenDepth(tree As TreeView) As List(Of TreeNode)
    Dim nodes As List(Of TreeNode) = New List(Of TreeNode)

    Dim stack As Stack(Of TreeNode) = New Stack(Of TreeNode)

    ''
    '' Bang all the top nodes into the queue.
    ''
    For Each top As TreeNode In tree.Nodes
        stack.Push(top)
    Next

    While (stack.Count > 0)
        Dim node As TreeNode = stack.Pop()

        If node IsNot Nothing Then

            ''
            '' Add the node to the list of nodes.
            ''
            nodes.Add(node)

            If node.Nodes IsNot Nothing And node.Nodes.Count > 0 Then
                ''
                '' Enqueue the child nodes.
                ''
                For Each child As TreeNode In node.Nodes
                    stack.Push(child)
                Next
            End If
        End If

    End While

    Return nodes
End Function

End Class 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-06-09T09:22:23.943

结果，我已将代码转换`VB.Net`为：

```
Public Function FlattenBreadth(ByVal tree As TreeView) As List(Of TreeNode)
    Dim nodes As New List(Of TreeNode)
    Dim queue As New Queue(Of TreeNode)
    Dim top As TreeNode
    Dim nod As TreeNode
    For Each top In tree.Nodes
        queue.Enqueue(top)
    Next
    While (queue.Count > 0)
        top = queue.Dequeue
        nodes.Add(top)
        For Each nod In top.Nodes
            queue.Enqueue(nod)
        Next
    End While
    FlattenBreadth = nodes
End Function 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-10-06T05:19:18.643

如果有人仍然想做递归方法，使用 Jop 的代码，并保留 TreeNodes（所以你可以使用他们的 .tag、.name、.checked 或 .text 属性）这里是我的版本

```
Public Shared Function GetChildren(objTree As TreeView) As List(Of TreeNode)
    Dim nodes As List(Of TreeNode) = New List(Of TreeNode)
    For Each parentNode As TreeNode In objTree.Nodes
        nodes.Add(parentNode)
        GetAllChildren(parentNode, nodes)
    Next

    Return nodes
End Function

Public Shared Sub GetAllChildren(parentNode As TreeNode, nodes As List(Of TreeNode))
    For Each childNode As TreeNode In parentNode.Nodes
        nodes.Add(childNode)
        GetAllChildren(childNode, nodes)
    Next
End Sub 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-12-14T03:50:42.860

通常在指定节点获取值是程序员感兴趣的。这可以通过以下方式获得。假设您有一个名为 texbox1 的 TextBox 控件和一个名为 treeview1 的 TreeView 控件。以下将返回节点级别 0 的文本值。

```
textbox1.Text = treeview1.nodes(0).Text.ToString() 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-06-26T06:19:48.190

在 .Net WindowsForm TreeView 中有`Find()`带有可选标志的方法`'searchAllChildren'`。

在 asp.net 中却没有。为了得到相同的结果，我使用它（类似于 Keith 的答案，但在输入中我使用 TreeView）

```
public static IEnumerable<TreeNode> DescendantNodes2(this TreeView input)
{
    foreach (TreeNode node in input.Nodes)
    {
        yield return node;
        foreach (var subnode in node.DescendantNodes())
            yield return subnode;
    }
}
private static IEnumerable<TreeNode> DescendantNodes(this TreeNode input)
{
    foreach (TreeNode node in input.ChildNodes)
    {
        yield return node;
        foreach (var subnode in node.DescendantNodes())
            yield return subnode;
    }
} 
```

# python - SQL 跨列的绝对值

> ID：177284
> 
> 赞同：1
> 
> 时间：2008-10-07T05:06:31.000
> 
> 标签：python, mysql, sql, oracle, postgresql

我有一个看起来像这样的表：

```
字大贵聪明快

狗 9 -10 -20 4
教授 2 4 40 -7
法拉利 7 50 0 48
阿拉斯加 10 0 1 0
蚋 -3 0 0 0

```

+ 和 - 值与单词相关联，因此教授很聪明，狗不聪明。阿拉斯加很大，占与其条目相关的总价值的比例，而 gnat 则相反。

有没有一种好方法可以获得离零最远的数字的绝对值，以及绝对值是否 =/= 值？相关地，我如何计算给定值的结果相对于其他值是否成比例地大？我会写一些东西来格式化输出：“狗：不聪明，可能不贵；教授聪明；法拉利：快，贵；阿拉斯加：大；蚊子：可能很小。” （格式不是问题，只是一个说明，我被困在基础查询上。）

此外，程序的其余部分是 python，所以如果有任何带有普通 dbapi 模块或更抽象模块的 python 解决方案，任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T05:25:12.553

按大绝对值列出的单词：

```
select word, big from myTable order by abs(big) 
```

每个类别的总数：

```
select sum(abs(big)) as sumbig, 
       sum(abs(expensive)) as sumexpensive,   
       sum(abs(smart)) as sumsmart,
       sum(abs(fast)) as sumfast
  from MyTable; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T05:28:46.633

离零最远的 abs 值：

```
select max(abs(mycol)) from mytbl 
```

如果值为负，则为零：

```
select n+abs(mycol)
  from zzz
 where abs(mycol)=(select max(abs(mycol)) from mytbl); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T10:39:37.363

问题似乎是您主要想在一行内工作，而这些类型的问题在 SQL 中很难回答。

我会尝试将您提到的结构变成更“原子”的事实表，例如

```
word property value 
```

通过重新设计基础表（如果可能，并且如果这对应用程序的其余部分有意义），或者通过定义为您执行此操作的视图，例如

```
select word, 'big' as property, big as value from soquestion
UNION ALLL
select word, 'expensive', expensive from soquestion
UNION ALL
... 
```

这允许您询问每个单词的最大值：

```
select word, max(value), 
    (select property from soquestion t2 
     where t1.word = t2.word and t2.value = max(t1.value))
from soquestion t1
group by word 
```

仍然有点尴尬，但大多数逻辑将在 SQL 中，而不是在您选择的编程语言中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T05:22:33.650

你可以使用内置的数据库聚合函数，比如 MAX(column) 吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T08:41:06.353

提出问题有助于澄清问题；这是一个功能，可以更多地了解我正在尝试做的事情。有没有办法表示上面¶2中的一些东西，或者在SQL或python中做我想要完成的更有效的方法`show_distinct`？

```
#!/usr/bin/env python

import sqlite3

conn = sqlite3.connect('so_question.sqlite')
cur = conn.cursor()

cur.execute('create table soquestion (word, big, expensive, smart, fast)')
cur.execute("insert into soquestion values ('dog', 9, -10, -20, 4)")
cur.execute("insert into soquestion values ('professor', 2, 4, 40, -7)")
cur.execute("insert into soquestion values ('ferrari', 7, 50, 0, 48)")
cur.execute("insert into soquestion values ('alaska', 10, 0, 1, 0)")
cur.execute("insert into soquestion values ('gnat', -3, 0, 0, 0)")

cur.execute("select * from soquestion")
all = cur.fetchall()

definition_list = ['word', 'big', 'expensive', 'smart', 'fast']

def show_distinct(db_tuple, def_list=definition_list):
    minimum = min(db_tuple[1:])
    maximum = max(db_tuple[1:])
    if abs(minimum) > maximum:
        print db_tuple[0], 'is not', def_list[list(db_tuple).index(minimum)]
    elif maximum > abs(minimum):
        print db_tuple[0], 'is', def_list[list(db_tuple).index(maximum)]
    else:
        print 'no distinct value'

for item in all:
    show_distinct(item) 
```

运行这个给出：

```
    狗不聪明
    教授很聪明
    法拉利很贵
    阿拉斯加很大
    蚊子不大
    >>>

```

# python - Python中的警报框？

> ID：177287
> 
> 赞同：39
> 
> 时间：2008-10-07T05:08:36.410
> 
> 标签：python, alerts

是否可以在 python 中产生类似于 JavaScript 的 alert("message") 的警报，应用程序作为守护进程运行。

这将在 Windows 中运行，很可能是 XP，但 2000 和 Vista 也是非常现实的可能性。

更新：
这旨在在后台运行并在满足某些条件时提醒用户，我认为提醒用户的最简单方法是产生一个弹出窗口，因为它需要立即处理，以及其他选项例如仅记录或发送电子邮件是不够有效的。

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-10-07T05:29:15.430

那这个呢：

```
import win32api

win32api.MessageBox(0, 'hello', 'title') 
```

此外：

```
win32api.MessageBox(0, 'hello', 'title', 0x00001000) 
```

将使该框出现在其他窗口的顶部，用于紧急消息。有关其他选项，请参阅[MessageBox 函数](http://msdn.microsoft.com/en-us/library/windows/desktop/ms645505(v=vs.85).aspx)。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2019-09-10T12:59:08.680

对于我们这些寻找不与 Windows 交互且独立于平台的纯 Python 选项的人来说，我选择了以下网站上列出的选项：

[https://pythonspot.com/tk-message-box/](https://pythonspot.com/tk-message-box/) （存档链接：[https](https://archive.ph/JNuvx) ://archive.ph/JNuvx ）

```
# Python 3.x code
# Imports
import tkinter
from tkinter import messagebox

# This code is to hide the main tkinter window
root = tkinter.Tk()
root.withdraw()

# Message Box
messagebox.showinfo("Title", "Message") 
```

您可以选择针对不同场景显示各种类型的消息框选项：

*   显示信息（）
*   显示警告（）
*   显示错误（）
*   问问题（）
*   询问取消（）
*   阿斯基耶斯诺 ()
*   问重试取消()

*根据我下面的评论编辑代码*

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-12-09T01:14:00.823

GTK 可能是一个更好的选择，因为它是跨平台的。它在 Ubuntu 上运行良好，并且在安装了 GTK 和 Python 绑定后应该在 Windows 上运行良好。

```
from gi.repository import Gtk

dialog = Gtk.MessageDialog(None, 0, Gtk.MessageType.INFO,
            Gtk.ButtonsType.OK, "This is an INFO MessageDialog")
dialog.format_secondary_text(
    "And this is the secondary text that explains things.")
dialog.run()
print "INFO dialog closed" 
```

[您可以在此处](http://python-gtk-3-tutorial.readthedocs.org/en/latest/dialogs.html)查看其他示例。（[PDF](https://media.readthedocs.org/pdf/python-gtk-3-tutorial/latest/python-gtk-3-tutorial.pdf)）

传递的参数应该是 gtk.window 父级（或无）、DestroyWithParent、消息类型、消息按钮、标题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2020-11-16T13:25:28.113

您可以使用[**PyAutoGui**](https://pypi.org/project/PyAutoGUI/)制作警报框 首先使用 pip 安装 pyautogui：

```
pip install pyautogui 
```

然后在python中输入：

```
import pyautogui as pag
pag.alert(text="Hello World", title="The Hello World Box") 
```

这里有更多的消息框，从 Javascript 中偷来的：

*   `confirm()`
    带有确定和取消按钮
*   `prompt()`
    带文本输入
*   `password()` 使用文本输入，但键入的字符将显示为*****

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-08-06T15:23:17.377

您可以在 Python 中使用 win32 库，这是 OK 或 Cancel 的经典示例。

```
import win32api
import win32com.client
import pythoncom

result = win32api.MessageBox(None,"Do you want to open a file?", "title",1)

if result == 1:
 print 'Ok'
elif result == 2:
 print 'cancel' 
```

收藏：

```
win32api.MessageBox(0,"msgbox", "title")
win32api.MessageBox(0,"ok cancel?", "title",1)
win32api.MessageBox(0,"abort retry ignore?", "title",2)
win32api.MessageBox(0,"yes no cancel?", "title",3) 
```

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2008-10-07T05:30:52.933

将应用程序作为后台进程启动，该进程要么具有绑定到 localhost 的 TCP 端口，要么通过文件进行通信——你的守护进程打开文件，然后你`echo "foo" > c:\your\file`. 例如，在 1 秒没有活动之后，您会显示消息并截断文件。

# sql - 如何使用 SQL Server 读取最后一行

> ID：177323
> 
> 赞同：101
> 
> 时间：2008-10-07T05:34:39.790
> 
> 标签：sql, sql-server

使用 SQL Server 读取最后一行的最有效方法是什么？

该表在唯一键上建立索引——“底部”键值代表最后一行。

* * *

## 回答 #1

> 赞同：194
> 
> 时间：2008-10-07T05:37:56.367

如果您使用的是 MS SQL，您可以尝试：

```
SELECT TOP 1 * FROM table_Name ORDER BY unique_column DESC 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-10-07T05:37:44.010

```
select whatever,columns,you,want from mytable
 where mykey=(select max(mykey) from mytable); 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-10-07T05:36:35.353

您需要在表中使用某种唯一标识列，例如自动填充主键或日期时间列（最好是主键）。然后你可以这样做：

```
SELECT * FROM table_name ORDER BY unique_column DESC LIMIT 1
```

`ORDER BY column`告诉它根据该列的数据重新排列结果，并告诉`DESC`它反转结果（因此将最后一个放在第一位）。之后，`LIMIT 1`告诉它只传回一行。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2012-12-22T07:00:27.513

如果你的一些身份证是有序的，我假设你的数据库中会有一些订单

`SELECT * FROM TABLE WHERE ID = (SELECT MAX(ID) FROM TABLE)`

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-02-10T07:06:15.290

我认为下面的查询将适用于 SQL Server，在没有任何可排序列的情况下具有最高性能

```
SELECT * FROM table 
WHERE ID not in (SELECT TOP (SELECT COUNT(1)-1 
                             FROM table) 
                        ID 
                 FROM table) 
```

希望你已经理解了... :)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-09-11T22:50:54.693

我尝试在 SQl server 2008 的 sql 查询中使用 last，但它给出了这个错误：“'last' 不是一个公认的内置函数名。”

所以我最终使用：

```
select max(WorkflowStateStatusId) from WorkflowStateStatus 
```

获取最后一行的 ID。也可以使用

```
Declare @i int
set @i=1
select WorkflowStateStatusId from Workflow.WorkflowStateStatus
 where WorkflowStateStatusId not in (select top (
   (select count(*) from Workflow.WorkflowStateStatus) - @i ) WorkflowStateStatusId from .WorkflowStateStatus) 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-04-29T13:00:26.537

您可以使用 last_value：`SELECT LAST_VALUE(column) OVER (PARTITION BY column ORDER BY column)...`

我在我的一个数据库中对其进行了测试，它按预期工作。

您还可以在此处查看文档：[https ://msdn.microsoft.com/en-us/library/hh231517.aspx](https://msdn.microsoft.com/en-us/library/hh231517.aspx)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-06-25T13:55:25.503

`OFFSET`并且`FETCH NEXT`是 SQL Server 2012 的一个功能，用于在显示结果的同时实现 SQL 分页。

`OFFSET`参数用于决定从结果中返回行的起始行，参数`FETCH`用于返回一组行数。

```
SELECT *
FROM table_name
ORDER BY unique_column desc
OFFSET 0 Row
FETCH NEXT 1 ROW ONLY 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-27T04:39:46.533

为了检索 MS SQL 数据库 2005 表的最后一行，您可以使用以下查询：

```
select top 1 column_name from table_name order by column_name desc; 
```

**注意：**要获取 MS SQL 数据库 2005 表的第一行，您可以使用以下查询：

```
select top 1 column_name from table_name; 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-10-16T12:44:50.540

如果您没有任何有序列，则可以使用每行的物理 id：

```
SELECT top 1 sys.fn_PhysLocFormatter(%%physloc%%) AS [File:Page:Slot], 
              T.*
FROM MyTable As T
order by sys.fn_PhysLocFormatter(%%physloc%%) DESC 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-03-31T09:58:37.357

**试试这个**

```
SELECT id from comission_fees ORDER BY id DESC LIMIT 1 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-07-01T18:07:46.767

```
SELECT * from Employees where [Employee ID] = ALL (SELECT MAX([Employee ID]) from Employees) 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-10-30T09:10:28.107

这是获取最后一条记录并更新 Access DB 中的字段的方式。

**更新** `compalints` `SET tkt = addzone &'-'& customer_code &'-'& sn where sn in (select max(sn) from compalints )`

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-01-10T16:37:38.910

如果您有一个 Replicated 表，则可以在 localDatabase 中拥有 Identity=1000，在 clientDatabase 中拥有 Identity=2000，因此如果您捕获最后一个 ID，您可能会找到来自客户端的最后一个 ID，而不是来自当前连接数据库的最后一个 ID。所以返回最后连接的数据库的最佳方法是：

```
SELECT IDENT_CURRENT('tablename') 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-08-03T09:54:07.303

好吧，我没有得到表格中的“最后一个值”，我得到的是每个金融工具的最后一个值。它不一样，但我想这与一些正在寻找“现在如何完成”的人相关。我还使用了 RowNumber() 和 CTE，在此之前只取 1 并按 [column] desc 排序。但是我们不再需要...

我正在使用 SQL Server 2017，我们正在记录全球所有交易所的所有报价，我们每天有大约 120 亿个报价，我们存储每个买价、卖价和交易，包括交易量和报价属性（买价、卖价、交易) 任何给定的交易所。

对于该表中的任何给定合约（主要是统计数据），我们有 253 种类型的分时数据，最后交易价格为分时类型 = 4，因此，当我们需要获取“最后”价格时，我们使用：

```
select distinct T.contractId,
LAST_VALUE(t.Price)over(partition by t.ContractId order by created ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING)
from [dbo].[Tick] as T
where T.TickType=4 
```

您可以在我的开发系统上看到执行计划，它执行得非常高效，在 4 秒内执行，而交换导入 ETL 将数据泵入表中，会有一些锁定减慢我的速度……这就是实时系统的工作方式。 [![针对 85,697,659 行的执行计划](https://i.stack.imgur.com/HMiJ8.png)](https://i.stack.imgur.com/HMiJ8.png)

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2014-07-19T14:17:40.217

```
SELECT * FROM TABLE WHERE ID = (SELECT MAX(ID) FROM TABLE) 
```

* * *

## 回答 #17

> 赞同：-6
> 
> 时间：2011-03-21T19:48:00.087

我很确定它是：

```
SELECT last(column_name) FROM table 
```

因为我使用类似的东西：

```
SELECT last(id) FROM Status 
```

# java - 要成为一名优秀的富 Internet 应用程序 (RIA) 开发人员，需要在思维上发生哪些重大转变？

> ID：177324
> 
> 赞同：1
> 
> 时间：2008-10-07T05:35:51.877
> 
> 标签：java, .net, desktop, ria

我最近一直在尝试使用[Adob​​e Flex](http://www.adobe.com/products/flex/)。作为一名长期的服务器端 Web 应用程序开发人员，我面临着很久以前涉足 Java Swing 开发时遇到的困难。它主要围绕**我的代码和框架代码之间的控制流**。大多数事情都是异步的，不会冻结 UI。

因此，我正在寻找所有经验丰富的开发人员，他们已经看到了从传统 Web 应用程序过渡到[RIA所需](http://en.wikipedia.org/wiki/Rich_Internet_application)**的思维**转变。

*更新：*将分散注意力的部分移至[另一个问题](https://stackoverflow.com/questions/178663/are-server-assisted-mvc-frameworks-peaking)。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T05:57:28.870

我现在在市场上看到的有两种型号：

*   混合用户界面。服务器仍参与 UI 构建工作，但其中很多工作已卸载到 javascript。这就是许多 javascript 工具包的工作方式（dojo、extjs 除外）。
*   分离的担忧。服务器仅被视为一种数据存储和同步方法。该应用程序完全在客户端运行，甚至可能使用本地存储。这就是 flex 的工作原理。

我认为我们将迁移到第二种模型，因为这意味着您不必跟踪服务器上的 UI 状态，这极大地简化了架构。我一直在玩 ExtJS 和 Flex，开发体验很像构建桌面应用程序，只是没有花哨的拖放 IDE。很难以这种方式想象三层桌面应用程序和 Web 应用程序之间的巨大差异。

所以我的建议是：不要再想你正在构建 Web 应用程序，总是怀疑某些东西是否属于服务器，因为在新模型中它通常不会。此外，有效地使用齿轮或浏览器缓存，因为如果您的应用程序是客户端的，那么每次下载所有代码都会太慢。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-10-07T09:16:35.130

两条忠告：

*   你的服务器永远不应该信任客户端给它的任何东西。与任何 Web 应用程序一样，源自客户端的数据可能会受到损害。
*   可视化。这就是 RIA 真正的（也许是唯一的）好处：能够提供丰富的交互式数据可视化，可以以有趣的方式混合。充分利用它。

# sql - 如何通过 SQL 查询显示 SQL Server 2000 服务器角色

> ID：177331
> 
> 赞同：1
> 
> 时间：2008-10-07T05:42:46.933
> 
> 标签：sql, sql-server, security

我需要什么 sql 查询来显示特定用户中激活的服务器角色？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T06:32:59.670

EXEC sp_helpuser 'username' 应该这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T06:40:11.670

这应该这样做：

```
select 'ServerRole' = spv.name, 'MemberName' = lgn.name, 'MemberSID' = lgn.sid
from master.dbo.spt_values spv, master.dbo.sysxlogins lgn
where spv.low = 0 and
      spv.type = 'SRV' and
      lgn.srvid IS NULL and
      spv.number & lgn.xstatus = spv.number 
```

# visual-studio - 在 Visual Studio 中卸载项目时如何处理引用？

> ID：177338
> 
> 赞同：6
> 
> 时间：2008-10-07T05:55:28.717
> 
> 标签：visual-studio, reference, projects-and-solutions

在 Visual Studio 中卸载项目时，任何引用项目都会在其对已卸载项目的引用上获得警告三角形。我为自己编写了一个宏来做一些聪明的事情（检测项目的添加/删除并将任何引用从文件/项目依赖项转换为文件），但我不敢相信我没有错过更简单的东西。如果我必须手动更改引用（并且它打破了“个人解决方案/共享项目”团队开发范式），卸载功能怎么能有用。

（这个问题与[这个](https://stackoverflow.com/questions/152053/structuring-projects-dependencies-of-large-winforms-applications-in-c)关于在 Visual Studio 中构建大型解决方案的问题的答案有关——一些答案提到了有很多项目的解决方案，但是“卸载”未使用的项目以提高性能。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T06:23:06.930

对于我的项目，我创建了一个`assemblies`文件夹，项目会自动从设置的位置复制到该文件夹​​中，其他项目复制构建到该文件夹​​中。

*引用程序集项目的后期构建：*

> ```
> if not exist "C:\builds\Project1" md "C:\builds\Project1\"
> copy "$(TargetDir)$(TargetName).*" "C:\builds\Project1\" 
> ```

*用于引用项目的预构建：*

> 如果存在 "c:\builds\Project1\" 复制 "c:\builds\Project1*.*" "$(ProjectDir)assemblies"

项目文件指向其`assemblies`子文件夹以供参考，因此即使从解决方案中卸载源项目，也将使用最后构建的程序集，而不会在开发时将整个项目放在内存中的性能问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-21T20:19:56.550

> 如果您使用文件引用，那么在同一个解决方案中拥有项目有什么好处？

如果您`app.exe`使用`utils.dll`并且更改了代码`utils.dll`，那么如果它在同一个解决方案中，VS 会注意到依赖关系并重新编译两者。如果它不在解决方案中，您将不得不跳出，`utils.dll`单独重新编译，然后跳回并重新编译`app.exe`。

这或多或少变得重要，具体取决于您的 exe 引用了多少其他 dll，以及它们更改的频率（在团队环境中，根据我的经验，共享 dll 的更改经常发生）。
还有一个副作用是，如果您在 VS 中有 100 个项目，则需要很长时间来处理它们，以便确定它们是否需要重新编译。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T20:30:13.597

卸载项目是一项临时操作，因此您可以将实际项目文件编辑为 XML（文本）。如果您想从解决方案中完全删除一个项目，您应该使用“删除”菜单选项，该选项将负责删除对该项目的任何引用。

使用项目引用的一个优点是它允许您轻松地通过代码进行调试。它还自动确保您使用的是正确的配置构建（即，如果您在“调试”模式下构建，它将使用程序集的调试版本）。话虽如此，您对于将选择哪个版本/构建的依赖项目失去了一些确定性 - 项目引用意味着您始终使用最新的。

是的，为了让 Visual Studio 确定构建依赖项，它必须能够查看和构建所有项目，这意味着项目引用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T08:11:33.700

我刚刚通过 MSDN 文档阅读了有关构建解决方案和项目的灵感。

我没有注意到的是，在多项目解决方案中，解决方案资源管理器中的上下文菜单提出了一个项目依赖项弹出窗口。如果您还没有通过项目之间的项目引用定义它们，您可以在这里手动定义项目依赖关系。

见[这里](http://msdn.microsoft.com/en-us/library/et61xzb3(VS.80).aspx)（MSDN 链接，几周后会自毁）

# navigation - Map-Navigation Project，道路数据通常如何存储/表示？

> ID：177343
> 
> 赞同：16
> 
> 时间：2008-10-07T05:58:03.657
> 
> 标签：navigation, maps, graph-theory, path-finding, file-format

Garmin 和 TomTom 等导航系统一直让我着迷。我想实现小型地图/导航应用程序来尝试各种路径算法并扩展我对它们的了解。

这是一个两部分的问题：

**1.) 地图数据如何存储？** - 当您拥有道路网络时，这些数据通常如何存储？保留哪些部分数据以便以后重现地图？每条道路是否存储为一系列改变方向的点？这些数据以何种文件格式存储？是否有公开可用的库来轻松解析这些文件？有没有人有关于如何存储/表示地图/道路数据的细节，这将非常有帮助。

**2.）导航/**路径 - 在此地图数据（la Garmin）上进行基本路径时，我的假设是否正确，即它被转换为有向图？每个道路交叉点是否是一个顶点，边缘加权顶点之间的距离？这就是我正在考虑做的，所以我可以尝试一些基本的众所周知的路径算法，看看我得到了什么。

我已经在美国看到[了这个](http://www.bts.gov/publications/north_american_transportation_atlas_data/)公开可用的地图数据，但我不确定它是如何表示的，以及它是否足够详细，让我能够从中构建我的有向图。

如果有人有任何信息，我将不胜感激。掌握的知识越详细越好。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-09T14:56:33.030

前面的回复都是指 GIS 系统。这不是 PND（便携式导航设备）的工作方式。它们太简单了，无法运行桌面/工作站级别的 GIS 软件。

相反，PND 存储信息的方式与 Simucal 推测的差不多。道路被分成几段。这使模型更加简单。在一个段内，诸如最大速度之类的属性不会改变。

出于规划目的，路段充当图中的边。对于每个节点，传入和传出节点都被存储。然后使用修改后的 A* 算法进行规划。边缘权重通常不是距离，而是估计的行程时间（或者在[TomTom](http://www.tomtom.com/page/iq-routes)的情况下，是实际的测量时间）。

但是，道路网络通常是分层的，正常的 A* 启动速度较慢。当从一个城镇到另一个城镇时，A* 将花费过多的时间在起始城镇爬行。然而，我们人类知道在长途旅行时最好使用高速公路。这就是他们的目的。PND同样更喜欢高速公路。而且由于高速公路很少见，这可以节省大量内存。

另一个优化是前向和后向搜索；你从两边计划到某个中间点。这样做的一大好处是，如果你走错了路，你可以从新的起点重新搜索。向后搜索树没有改变，因为您的目的地没有移动。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-07T06:05:12.003

我不知道导航系统单位的细节，但在标准 GIS 世界中，地图数据基本上存储为多边形、线和点的集合，每个都由其坐标（以及使用的投影和一些其他参数）描述。例如，[这里](http://www.esri.com/library/whitepapers/pdfs/shapefile.pdf)描述了最常见的格式之一 shapefile，基于数据库的格式标准在[这里](http://www.opengeospatial.org/standards/sfs)。

我已经成功地将这个存储模型用于道路显示和路线计算，使用[PostgreSQL](http://postgresql.org)、[PostGIS](http://postgis.refractions.net)和[PGRouting](http://pgrouting.postlbs.org/)。使用通常的图形算法进行计算，并且以通用格式存储的数据也存储为图形以允许其应用。我无法将这种体验外推到嵌入式设备，因为考虑到它们有限的计算能力，它们可能会以非常不同的方式进行操作。他们很可能预先计算了很多东西。

对于稍微不同的存储方法，请查看[OpenStreetMap](http://www.openstreetmap.org)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-08T02:55:15.193

存储的确切方式取决于格式；有很多不同的 GIS 格式。GDAL 是一个优秀的免费图书馆，可以阅读（几乎）所有这些。

通常，道路将作为“线层”存储在文件中，即一组带有附加元数据的折线。因此，每条道路都会有一系列顶点，并且根据您的数据质量，它有望获得诸如它们是否是单向的、速度估计和某种连接 ID 等信息。

是的，它们通常被转换为有向图来求解。边权重可以是距离，或者更有用的是，通过该边所花费的时间。

快速求解是预计算和存储空间之间的权衡（嵌入式设备可能需要与 PC 不同的选择）。有一些非常有趣的算法可以做到这一点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-23T01:25:46.043

Mohammed：好的，我没有详细说明，因为最初的问题在这方面看起来很舒服。如果您不熟悉图论，那么现在阅读一下它可能是个好主意 -[维基百科](http://en.wikipedia.org/wiki/Graph_theory)很适合作为介绍。

通常发生的情况是，在 GIS 数据中，道路被存储为带有附加元数据的折线。这对于在屏幕上显示它们等很好，但是为了能够导航它们，您需要知道哪些是相互连接的。因此，在元数据中，道路的每一端通常都有一个节点 ID，因此您可以说“这是路段 457，它从节点 332 到节点 667”。因此，当您读取 GIS 数据时，您会将其构建为一组由弧线连接的节点（即图形）。

如果该元数据不可用，您可以从中推断出哪些道路具有相同的开始/结束坐标（这是一些不太好的 GIS 数据的情况）。“有向”位仅表示道路有方向-其中一些可以沿任一方向行驶，而另一些只能单向行驶。

通过有向图寻找路径的典型算法是 Dijkstra 算法；在实践中使用了各种衍生物。基本上这涉及沿着图形的弧从一个节点移动到另一个节点，因此您需要适当的数据结构来支持它。

希望有帮助...

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-18T14:25:34.700

如果您想查看一些代码以了解路由应用程序的工作原理，请尝试查看从[openstreetmap.org wiki](http://wiki.openstreetmap.org/wiki/Routing)链接的一些路由应用程序。Navit 和 Gosmore 都是开源的，尤其是相当容易设置。

Gosmore 应用程序的开发人员 Nic Roets 写了一篇[有趣的文章](http://www.mail-archive.com/routing@openstreetmap.org/msg00112.html)，介绍了他对表示您可能感兴趣的道路矢量数据的选择。

如果你想看看 Gosmore 的实际应用，它是 yournavigation.org 基于 openstreetmap 数据的路由网站的[后端](http://www.yournavigation.org/)。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-07T06:43:04.220

为了以更多存储和有限分辨率为代价提高绘图速度，许多应用程序将使用地理参考光栅格式，例如[GeoTiff](http://www.remotesensing.org/geotiff/geotiff.html)。

鉴于 Zich 在下面的相当坚持的评论

> “所有导航系统中的数据都以矢量形式存在，无一例外！”

我想我会在上面添加一点。首先，我将导航系统定义为一个系统，它可以根据您当前的位置帮助您如何到达您想去的地方，通常是通过计算一些可能的替代路线并推荐成本最低的路线。可能的路线可能由交通方式决定，例如汽车留在道路上，而登山者则不会。路线的成本计算也可能因运输方式以及用户要求而异。汽车可能希望根据道路速度采取最快的路线，卡车可能想要最省油的路线，爬山者可能想要最安全的直达路线，船只或飞机可能想要一条避开危险天气系统的路线，同时尽量减少燃料成本和花费的时间.

在最简单的层面上，地图和指南针是一个导航系统。将地图替换为小屏幕、可扩展的栅格地图和 GPS，您仍然拥有导航系统。大多数中低端海上导航系统仍然以这种方式工作，图表代表海岸线和海床，GPS 为您提供位置，回声探测深度。

在更先进的一端，自主机器人导航系统（如[火星漫游者导航系统](http://mars.nasa.gov/mer/home/posters/OpportunityPosterBack.pdf)）动态生成 DTM 模型作为短程导航的基础，而卫星收集的 DEM 则用于远程导航。

建议所有导航系统都像消费者 Garmin 或 Tom Tom 设备一样工作是一个相当幼稚的假设。FWIW，许多现代 Garmin 设备还包括[基于光栅的 DEM 数据](http://pinns.co.uk/osm/dem.html)，其中低成本 GPS 高度可能非常不准确。

# vb.net - .NET - 查找属性分配的所有引用

> ID：177353
> 
> 赞同：6
> 
> 时间：2008-10-07T06:06:16.603
> 
> 标签：vb.net, search, ide, properties

我正在使用 VB.NET。在 Visual Studio 中，如果我右键单击属性名称并单击“查找所有引用”，它会搜索正在使用的属性的所有实例。

但是，属性始终用于赋值（Set 方法）或检索（Get 方法）。有什么方法可以只搜索其中一种用途吗？例如，在代码中搜索该属性的所有用途，其中它被分配了一个值，而不是在检索该值时。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-07T06:14:28.023

使用编译器将您想要查找的内容转换为错误。删除 setter 以查找将要使用它的所有位置。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-12-04T20:02:46.573

使用 Resharper，如果您只是使用“查找结果”工具，然后在结果窗口中有一个过滤器图标。然后，您可以将结果限制为仅“显示写入用法”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T06:34:36.237

您还可以使用[Reflector](http://reflector.red-gate.com/)浏览您的程序集。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T06:57:26.597

**Resharper**（MSVS 插件）具有您正在寻找的确切功能。查看：

`ReSharper.FindUsages`

或者

`ReSharper.FindUsagesAdvanced`

在键盘快捷键映射（工具 -> 选项 -> 键盘）中找出使用的快捷键。

# sql-server - varchar 列的大小

> ID：177354
> 
> 赞同：14
> 
> 时间：2008-10-07T06:06:24.920
> 
> 标签：sql-server, optimization, varchar

如果我将 varchar 列定义为长度为 32 或 128，在 sql server 中会有所不同吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-07T06:48:06.193

[varchar](http://msdn.microsoft.com/en-us/library/aa258242(SQL.80).aspx)是一个可变字符字段。这意味着它可以将文本数据保存到一定长度。varchar(32) 只能容纳 32 个字符，而 varchar(128) 可以容纳 128 个字符。如果我尝试在 varchar(3) 字段中输入“12345”；这是将要存储的数据：

“123”

“45”将被“截断”（丢失）。

在您知道某个字段最多只能是（或*应该*是）某个长度的情况下，它们非常有用。例如：邮政编码或州缩写。事实上，它们通常用于几乎所有类型的文本数据（例如姓名/地址/等等） - 但在这些情况下，您必须注意您提供的数字是要填充的数据类型的合理最大值那一栏。

但是，您在使用它们时也必须小心，只允许用户输入该字段将支持的最大字符数。否则，当它截断用户的输入时可能会造成混乱。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-07T06:08:33.340

应该没有明显的区别，因为后端只会存储您插入该列的数据量。它不会像 char 列那样填充到字段的完整大小。

编辑：有关更多信息，此[链接](http://msdn.microsoft.com/en-us/library/aa258242(SQL.80).aspx)应该很有用。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-07T06:12:18.323

它不应该。它只是定义了它可以容纳的最大长度，实际使用的长度取决于插入的数据。

# c++ - 字符串的散列具有特定长度

> ID：177363
> 
> 赞同：6
> 
> 时间：2008-10-07T06:13:35.013
> 
> 标签：c++, algorithm, hash

有没有办法生成一个字符串的散列，以便散列本身具有特定的长度？我有一个生成 41 字节哈希 (SHA-1) 的函数，但我需要它最大为 33 字节（由于某些硬件限制）。如果我将 41 字节的散列截断为 33，我可能（当然！）会失去唯一性。

或者实际上，如果我能在您的帮助下找到一些 C 代码，我认为 MD5 算法会很合适。

编辑：谢谢大家的快速和知识渊博的回应。我选择使用 MD5 哈希，它非常适合我的目的。唯一性是一个重要问题，但我不希望这些哈希的数量在任何给定时间都很大 - 这些哈希代表家庭 LAN 上的软件服务器，因此最多会有 5 个，也许 10 个正在运行。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-07T06:27:33.737

> 如果我将 41 字节的散列截断为 33，我可能（当然！）会失去唯一性。

是什么让你认为你现在拥有独特性？是的，当你只玩 33 个字节而不是 41 个字节时，显然冲突的可能性更高，但你需要充分意识到，对于任何使用散列有意义的情况，冲突都是不可能的，而不是不可能的首先。如果您要散列超过 41 个字节的数据，那么可能的组合显然比可用的散列更多。

现在，我不知道是截断 SHA-1 散列还是使用更短的散列（如 MD5）更好。我认为在保留整个哈希时我会更有信心，但是 MD5 有[已知的漏洞](http://en.wikipedia.org/wiki/MD5#Vulnerability)，这些漏洞对于您的特定应用程序可能是也可能不是问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-07T06:17:55.020

不幸的是，计算哈希的方式是不可能的。要将哈希长度限制为 33 个字节，您必须将其剪掉。您可以对第一个和最后 33 个字节进行异或运算，因为这样可能会保留更多信息。但即使有 33 个字节，您也没有那么大的冲突机会。

md5：[http ://www.md5hashing.com/c++/](http://www.md5hashing.com/c++/)

顺便提一句。md5 是 16 字节，sha1 是 20 字节，sha256 是 32 字节，但是作为十六进制字符串，它们的大小都加倍。如果你可以存储字节，你甚至可以使用 sha256。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-07T06:25:14.600

由于散列算法的设计方式（熵在结果字符串中均匀分布），与任何其他 33 字节长的散列相比，与 substring(sha_hash, 0, 33) 发生冲突的可能性不大。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-07T06:20:31.397

您可以使用[Elf 哈希](http://codesnippets.joyent.com/user/wastepixel/tag/hashing)（包括<- C 代码）或其他类似的简单哈希函数，而不是 MD5 或 SHA-X。它们不安全，但可以调整到您需要的任何长度

```
/*****Please include following header files*****/
// string
/***********************************************/

/*****Please use following namespaces*****/
// std
/*****************************************/

static unsigned int ELFHash(string str) {
    unsigned int hash = 0;
    unsigned int x = 0;
    unsigned int i = 0;
    unsigned int len = str.length();

    for (i = 0; i < len; i++)
    {
        hash = (hash << 4) + (str[i]);
        if ((x = hash & 0xF0000000) != 0)
        {
            hash ^= (x >> 24);
        }
        hash &= ~x;
    }

    return hash;
} 
```

**例子**

```
string data = "jdfgsdhfsdfsd 6445dsfsd7fg/*/+bfjsdgf%$^";
unsigned int value = ELFHash(data); 
```

**输出**

```
248446350 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-07T06:23:20.300

根据定义，散列仅对少量数据是唯一的（即使这样仍然不能保证）。不可能将大量信息唯一地映射到少量信息，因为您无法神奇地摆脱信息并在以后将其取回。请记住，这不是压缩。

就个人而言，在这种情况下，我会使用 MD5（如果您需要以文本形式存储）或 256b (32B) 哈希，例如 SHA256（如果您可以以二进制形式存储）。将另一种哈希算法截断为 33B 也可以，并且可能会增加产生哈希冲突的可能性。这很大程度上取决于算法。

[此外，MD5 的另一个 C 实现，由设计它的人完成。](http://www.ietf.org/rfc/rfc1321.txt)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-07T06:17:15.100

我相信 MD5 散列算法会产生一个 32 位的数字，所以也许那个更合适。

编辑：要访问 MD5 功能，应该可以挂钩到 openssl 库。但是，您提到了硬件限制，因此在您的情况下这可能是不可能的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-07T06:21:54.123

33 字节冲突的机会是 1/2^132（由生日悖论）

所以不要担心失去独特性。

更新：我没有检查 SHA1 的实际字节长度。以下是相关计算：仅当散列的字符串数量约为 sqrt(2^(32*4)) = 2^64 时，才会发生 32 个半字节的冲突（33 个字节的十六进制 - 1 个终止字符）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-07T06:21:56.620

[这](http://www.koders.com/c/fidFE71B5C4E52D1672D9B35E9C9BB676C0E04D7CF5.aspx?s=md5#L2)是 C 中的 MD5 实现。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-07T06:36:24.750

使用 Apache 的 DigestUtils：

[http://commons.apache.org/codec/api-release/org/apache/commons/codec/digest/DigestUtils.html#md5Hex(java.lang.String)](http://commons.apache.org/codec/api-release/org/apache/commons/codec/digest/DigestUtils.html#md5Hex(java.lang.String))

将哈希转换为 32 个字符的十六进制字符串。

# c# - 如何对通用列表进行排序？

> ID：177373
> 
> 赞同：3
> 
> 时间：2008-10-07T06:22:42.267
> 
> 标签：c#, generics

我有一个通用列表...

公共列表<ApprovalEventDto> ApprovalEvents

ApprovalEventDto 有

```
public class ApprovalEventDto  
{
    public string Event { get; set; }
    public DateTime EventDate { get; set; }
} 
```

如何按活动日期对列表进行排序？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-07T06:31:06.320

您可以使用 List.Sort() 如下：

```
ApprovalEvents.Sort((lhs, rhs) => (lhs.EventDate.CompareTo(rhs.EventDate))); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-07T06:25:45.707

```
using System.Linq;

void List<ApprovalEventDto> sort(List<ApprovalEventDto> list)
 { return list.OrderBy(x => x.EventDate).ToList();
 } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-07T06:32:38.063

```
ApprovalEvents.Sort((x, y) => { return x.EventDate.CompareTo(y.EventDate); }); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T06:36:24.330

如果您不需要就地排序，并且您使用的是 .NET 3.5，我会按照 marxidad 的建议使用 OrderBy。如果您需要对现有列表进行排序，请使用 List.Sort。

List.Sort 可以接受一个比较委托或一个 IComparer - 两者都可以，这只是一个更简单的解决方案。

在我的[MiscUtil](http://pobox.com/~skeet/csharp/miscutil)项目中，我有一个 ProjectionComparer，它允许您指定排序键（就像您为 OrderBy 所做的那样），而不必采用两个参数并自己调用 CompareTo。我个人觉得这更容易阅读，但这当然取决于你。（在 MiscUtil 中也有一些简单的反转和组合比较的方法。有关示例，请参见单元测试。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-03T07:47:34.623

像暗黑血统的解决方案，但我更喜欢保持它不神秘：

```
ApprovalEvents.Sort((a, b) => (a.EventDate.CompareTo(b.EventDate))); 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-07T06:24:26.193

合并排序非常适合列表。有关更多详细信息，请参阅[WikiPedia 条目](http://en.wikipedia.org/wiki/Merge_sort)，基本上它是一种不需要随机访问的递归 n-Log n 排序。

对于某些数据类型，您还可以使用[鸽巢](http://en.wikipedia.org/wiki/Pigeonhole_sort)法来获取订单 n，但会消耗更多内存。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-07T06:27:20.150

您可以将 List.Sort() 方法与匿名方法或 lambda 表达式一起使用。更多在 [MSDN](http://msdn.microsoft.com/en-us/library/3da4abas.aspx)

# c++ - 用于在给定轴上旋转点的 C++ 库？

> ID：177383
> 
> 赞同：0
> 
> 时间：2008-10-07T06:26:08.280
> 
> 标签：c++, geometry, graph, point

有谁知道一个图形库，用于将一个点从一个坐标系简单变换到另一个坐标系，该坐标系旋转一个角度和一些点变换，仅用于 2d？以及任何用于在视觉上绘制和验证相同的绘图工具？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T07:57:54.553

双[3][3]

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T06:33:45.363

[GDAL](http://www.gdal.org/)几乎包含了您可能要求的所有图形转换，虽然它很大，因此需要一些时间来适应，但它是一个很好的框架，可以继续前进。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T07:41:27.303

这不是一个图书馆，而是一个做这种事情的人的博客：

[http://polymathprogrammer.com/](http://polymathprogrammer.com/)

如果您想了解“幕后”，它有一些很好的理论。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T11:02:44.993

[Angtigrain Geometry](http://www.antigrain.com/)库包含可以执行此操作的代码，您还可以更进一步并将其用于绘图，但您不必这样做。您应该查看 agg_trans_affine.h 文件中的 agg::trans_affine 类。

戴夫

# python - 在 Python 中测试套接字连接

> ID：177389
> 
> 赞同：29
> 
> 时间：2008-10-07T06:30:19.863
> 
> 标签：python, sockets

这个问题将扩展：[在 Python 中打开套接字的最佳方法打开套接字](https://stackoverflow.com/questions/68774/best-way-to-open-a-socket-in-python)
时，我如何测试它是否已建立，并且它没有超时，或者通常失败。

编辑：我试过这个：

```
try:
    s.connect((address, '80'))
except:
    alert('failed' + address, 'down') 
```

但是即使该连接应该有效，也会调用警报功能。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-10-07T06:46:53.403

似乎你没有抓住你想在那里抓住的例外:)

如果`s`是一个`socket.socket()`对象，那么正确的调用`.connect`方式是：

```
import socket
s = socket.socket()
address = '127.0.0.1'
port = 80  # port number is a number, not string
try:
    s.connect((address, port)) 
    # originally, it was 
    # except Exception, e: 
    # but this syntax is not supported anymore. 
except Exception as e: 
    print("something's wrong with %s:%d. Exception is %s" % (address, port, e))
finally:
    s.close() 
```

始终尝试查看您在 try-except 循环中捕获的异常类型。

您可以检查套接字模块中的哪些类型的异常表示哪种错误（超时、无法解析地址等），并`except`为它们中的每一个单独声明 - 这样您就可以对不同类型的错误做出不同的反应问题。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2013-12-12T11:12:04.887

您可以使用函数[connect_ex](http://docs.python.org/2/library/socket.html#socket.socket.connect_ex)。它不会抛出异常。取而代之的是，返回一个 C 风格的整数值（在 C 中称为[errno](http://linux.die.net/man/3/errno)）：

```
s =  socket.socket(socket.AF_INET, socket.SOCK_STREAM)
result = s.connect_ex((host, port))
s.close()
if result:
    print "problem with socket!"
else:
    print "everything it's ok!" 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-07T08:48:00.850

你真的应该发布：

1.  您的示例的完整源代码
2.  它的**实际**结果，而不是总结

这是我的代码，它有效：

```
import socket, sys

def alert(msg):
    print >>sys.stderr, msg
    sys.exit(1)

(family, socktype, proto, garbage, address) = \
         socket.getaddrinfo("::1", "http")[0] # Use only the first tuple
s = socket.socket(family, socktype, proto)

try:
    s.connect(address) 
except Exception, e:
    alert("Something's wrong with %s. Exception type is %s" % (address, e)) 
```

当服务器监听时，我什么也得不到（这是正常的），当它没有时，我得到预期的消息：

```
Something's wrong with ('::1', 80, 0, 0). Exception type is (111, 'Connection refused') 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-04-01T14:06:01.647

对于任何有类似问题的人来说，12 年后。

```
try:
    s.connect((address, '80'))
except:
    alert('failed' + address, 'down') 
```

不起作用，因为端口 '80' 是一个字符串。您的端口需要是 int。

```
try:
    s.connect((address, 80)) 
```

这应该有效。不知道为什么即使是最好的答案也没有看到这一点。

# c - 初始化一个非常大的结构的正确方法是什么？

> ID：177393
> 
> 赞同：23
> 
> 时间：2008-10-07T06:32:01.140
> 
> 标签：c, struct

在我们的代码中，我们曾经有这样的东西：

```
 *(controller->bigstruct) = ( struct bigstruct ){ 0 }; 
```

这曾经很好用，然后我们升级了 GCC 版本，突然开始看到堆栈溢出。查看程序集，旧的 GCC 代码（2.x）基本上是这样做的：

```
memset(controller->bigstruct, 0, sizeof(struct bigstruct)); 
```

新的 GCC (3.4.x) 正在这样做

```
 struct bigstruct temp = { 0 };
   controller->bigstruct = temp; 
```

在查看了 C99 规范后，我明白了原因；C99 基本上要求堆栈上存在匿名结构。这是一个很好的概念，但这个结构有 4 MB 大，而且只打算存在于堆上！

我们已经使用了我们自己的“初始化”函数来显式设置成员，但这很丑陋并且令人头疼。我不认为 memset 是一个合适的解决方案，因为我不知道 0 的位值是该类型的适当零值（挑剔，我知道，但你在那里；我不介意编译器会这样做，因为它*可以*知道）

初始化这样的大型结构的“正确”或至少最好的方法是什么？

进一步澄清为什么我认为 memset 不是解决方案： 未显式初始化的成员的初始化规则与静态初始化相同，如下所示： - 如果它具有指针类型，则将其初始化为空指针；- 如果它具有算术类型，则将其初始化为（正或无符号）零；...

'memset' 会将内存设置为位模式零，这不一定是同一件事。想象一个不使用 IEEE 浮点数的系统。不寻常，但由 C 支持。 0.0 的表示不一定意味着“所有位为零”，它可以是处理器方便的任何东西。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-07T06:38:52.607

memset 是要走的路。你没有很多选择。

执行以下操作：

```
#define InitStruct(var, type) type var; memset(&var, 0, sizeof(type)) 
```

这样您只需：

```
InitStruct(st, BigStruct); 
```

然后像往常一样使用 st ......

我不明白“0”如何不是结构的有效“0”类型。“大规模初始化”结构的唯一方法是将其所有内存设置为一个值；否则，您将不得不制定额外的逻辑来告诉它为每个成员使用特定的位模式。要使用的最佳“通用”位模式是 0。

此外 - 这与您在执行时使用的逻辑相同

```
*(controller->bigstruct) = *( struct bigstruct ){ 0 }; 
```

因此，我不明白您不愿意使用它:)

这篇文章的第一条评论让我在打电话给他和白痴​​之前做了一些研究，我发现了这个：

[http://www.lysator.liu.se/c/c-faq/c-1.html](http://www.lysator.liu.se/c/c-faq/c-1.html)

很有意思; 如果我可以投票评论我会:)

话虽如此 - 如果您想针对具有非 0 空值的古老架构，您唯一的选择仍然是对某些成员进行手动初始化。

感谢托马斯·帕德伦-麦卡锡！我今天学了些新东西 ：）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-07T06:38:39.753

如果您不想使用 memset，您始终可以声明结构的静态副本并使用 memcpy，这将提供类似的性能。这将为您的程序增加 4 兆，但可能比设置单个元素更好。

也就是说，如果 GCC 使用 memset，并且之前已经足够好，我建议它现在已经足够好了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-07T07:08:42.733

私有初始化函数并不丑陋，而是一种初始化对象（结构）的好 OO 方式。我假设您的结构不是 4MB 的指针，所以我假设解决方案应该是这样的：

```
void init_big_struct(struct bigstruct *s)  
{  
    memset(s, 0, sizeof(struct bigstruct));  
    s->some_pointer = NULL; // Multiply this as needed  
} 
```

另一方面，我们的代码运行在 20 多个嵌入式操作系统和大量不同的硬件上，仅使用结构的 memset 就不会遇到任何问题。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-07T10:54:57.880

正如其他人所说，memset 是要走的路。但是，*不要*在 C++ 对象上使用 memset，尤其是那些具有虚拟方法的对象。这`sizeof( foo )`将包括虚函数指针表，并且对其进行 memset 将导致严重的悲痛。

如果 memset 本身不能解决问题，只需执行一个 memset，*然后*初始化任何应该为非零的成员（即您的非 IEEE 浮点值）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-04-24T16:44:09.880

许多人谈论 memset 而没有谈论[calloc](https://linux.die.net/man/3/calloc)。我宁愿使用为这个用例设计的 calloc （如果我错了请评论）：

> calloc() 函数为每个大小为字节的 nmemb 元素数组分配内存，并返回一个指向已分配内存的指针。内存设置为零。如果 nmemb 或 size 为 0，则 calloc() 返回 NULL 或稍后可以成功传递给 free() 的唯一指针值。

例子：

```
#include <stdlib.h> // calloc header
#include <stdio.h> // printf header

void    *init_heap_array(int elem_nb, int elem_size) {
    void *ptr;

    if (!(ptr = calloc(elem_nb, elem_size)))
        return NULL;

    return ptr;
}

void    set_int_value_at_index(int *ptr, int value, int i) {
    ptr[i] = value;
}

void    print_int_array_until(int *ptr, const int until) {
    for (int i = 0; i < until; i++)
        printf("%02d ", ptr[i]);
    putchar('\n');
}

int     main(void) {
    const int array_len = 300000;
    int *n;

    if (!(n = init_heap_array(array_len, sizeof(int))))
        return 1;    

    print_int_array_until(n, 5);
    set_int_value_at_index(n, 42, 1);
    print_int_array_until(n, 5);

    return 0;
} 
```

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-10-07T06:57:21.073

嗯 - 首先创建一个 init 函数并明确设置每个成员是正确的 - 它是 OO 语言中构造函数的工作方式。

第二 - 有人知道实现非 IEEE 浮点数的硬件吗？- 也许 Commodore 64 或类似的东西 ;-)

# java - 为什么记录集最初只转发

> ID：177412
> 
> 赞同：1
> 
> 时间：2008-10-07T06:47:27.223
> 
> 标签：java, sql, database, dataset

我已经看到最近更新的记录集正在更新，以便我们可以在它指向的数据中来回滚动。

为什么它们最初是为仅向前遍历而设计的。使用新版本有影响吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T07:05:37.903

“新版本”大约有 5 年的历史。

仅转发：这是最简单的实现方式。实现队列（FIFO）而不是双端队列或链表是最容易的。由于 JDBC 驱动程序必须从 DB 中读取记录，因此它可以让 ResultSet 读取器轻松使用它们，先来先服务。

后来，他们意识到一些桌面应用程序和一些基于富 Web 的应用程序可能希望在不必存储中间表示的情况下向前和向后滚动，他们决定实现它。

然后是可更新的结果集，您可以在其中更新结果集的列/行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T07:10:36.333

我已经很久没有看过这些东西了，但我很确定最初数据是流式传输的，并且对于许多 JDBC 驱动程序，Recordset 与数据库中的低级游标操作相关联。

使用的唯一影响可能是内存使用——但在几乎所有业务案例中，您都不会注意到，我也不会担心。在处理大型数据集时，您可能需要查看如何获取数据，但我的意思是“企业”这个词的意义——数百万甚至数十亿条记录。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T07:23:07.637

将太多特性打包到 JDBC 的第一个版本中会减慢 JDBC 的采用速度，因为供应商会花费更长的时间来实现它。

可滚动结果集是 JDBC 中相对很少使用的功能，因此从一开始就没有必要拥有它。这同样适用于 JDBC 2 和 3 中的其他奇特特性。

# web-services - 获取我的 WAN IP 地址

> ID：177414
> 
> 赞同：3
> 
> 时间：2008-10-07T06:48:53.727
> 
> 标签：web-services, ip, wan

我怎样才能以编程方式获取从 Internet 看到的我的网络的 IP 地址？它显然是我的路由器在连接到 ISP 时可以访问的属性。有没有办法使用标准协议从路由器获取此信息。我唯一的其他选择是找到一个返回我的 IP 地址的 WS（非常难以做到），或者只是去[whatismyip.com](http://www.whatismyip.com)之类的东西并删除所有 HTML（非常脏且容易更改）。有没有别的办法？？？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-07T06:53:12.063

不要抓取 whatismyip.com，请参阅[此处](http://whatismyip.com/automation.asp)了解如何调用他们的 API，该 API 只返回您的地址。

如果你不使用它，你必须自己写一些类似的东西，即你的路由器之外的主机，它可以报告你的明显地址。

请注意，网络服务器可能看不到您的真实 WAN IP 地址，因为：

*   您的 ISP 可能正在透明地代理 HTTP 流量，并且服务器会看到代理的 IP。在这种情况下，您通常需要查找并解析 [X-Forwarded-For](http://en.wikipedia.org/wiki/X-Forwarded-For)标头。

*   或者，正如 Olaf 所指出的，您和广泛开放的 Internet 之间可能存在另一个 NAT 路由器，换句话说，*您的*路由器的 WAN 地址位于专用网络上。您从 whatismyip.com 之类的服务中获得的最佳结果是最外层 NAT 路由器的 IP。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T07:18:47.923

我投票赞成 Paul Dixons 的回答，因为它看起来很完整，但还有一个方面：

*   您的 ISP 可能会为您提供私有地址 -某些 ISP*确实会发生这种情况。*根据您的期望，您可能需要一个您没有的可路由地址
*   如果您自己有代理，Paul 提到的代理信息（HTTP-Header X-Forwarded-For）可能是不可路由的地址
*   基于混合所有这些方面（从您的 ISP 获取不可路由的地址并自己拥有代理），您可能会得到奇怪的结果。

这些方面不是典型的日常情况，但根据您的需要，您可能需要考虑这些方面。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T06:59:29.993

如果您的路由器支持 snmp，您可以使用它来询问它的外部 ip。在这里可以找到一个小例子：

[http://www.rohitab.com/discuss/index.php?showtopic=31901](http://www.rohitab.com/discuss/index.php?showtopic=31901)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T06:52:25.060

我没有看到语言规范，但我在 python 中做到了：在 Python 中[查找面向公众的 IP 地址？](https://stackoverflow.com/questions/166545/finding-a-public-facing-ip-address-in-python)
如果不依赖外部服务器，基本上没有办法做到这一点，在这种情况下，我使用[http://www.whatismyip.com/automation/n09230945.asp](http://www.whatismyip.com/automation/n09230945.asp)，它只提供 IP 地址。或者，您可以使用自己的脚本，在 PHP 中如下所示：

```
<?php
echo $_SERVER['REMOTE_ADDR'];
?> 
```

# c# - NHibernate 映射到不在 ID 上的另一个对象

> ID：177422
> 
> 赞同：2
> 
> 时间：2008-10-07T06:54:20.547
> 
> 标签：c#, .net, xml, nhibernate

好的，NHibernate 问题在这里。我有两个要相互映射的对象。我有“供应商”和“乡镇”……现在这两者应该通过邮政编码链接，而不是 ID。我已经多次使用 id 对对象执行此操作，但从来没有这样的事情。

我遇到的问题是 ZipCodes 在存储为字符串时会以某种方式变成整数（前导零被丢弃）？或者它正在使用其中一个对象的 ID。

这是我的错误：

“/HQWebsite”应用程序中的服务器错误。不存在具有给定标识符的行[HQData.Objects.Township#7922]

我在那里查看的数据库中的数据也不是准确的。

这是我映射供应商 xml 文件的方式：

```
<many-to-one name="_Township" column="ZipCode" foreign-key="ZipCode" class="HQData.Objects.Township, HQData" /> 
```

这是乡镇的财产：

```
 <set name="_Vendors" cascade="all">
      <key  column="ZipCode" foreign-key="ZipCode"/>
      <one-to-many 
         class="HQData.Objects.Vendor, HQData"/>
    </set> 
```

有没有人熟悉 NHibernate 并且以前做过这个？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T08:18:13.843

这已修复！对于多对一关系，我需要 Vendor .xml 文件中的 property-ref 属性。

谢谢！

# c++ - 'const static' 在 C 和 C++ 中是什么意思？

> ID：177437
> 
> 赞同：135
> 
> 时间：2008-10-07T06:59:39.837
> 
> 标签：c++, c

```
const static int foo = 42; 
```

我在 StackOverflow 上的一些代码中看到了这一点，但我无法弄清楚它的作用。然后我在其他论坛上看到了一些困惑的答案。我最好的猜测是它在 C 中用于隐藏`foo`其他模块的常量。它是否正确？如果是这样，为什么有人会在可以制作它的 C++ 上下文中使用它`private`？

* * *

## 回答 #1

> 赞同：231
> 
> 时间：2008-10-07T12:44:21.607

很多人给出了基本答案，但没有人指出在 C++ 中`const`默认为`static`级别`namespace`（有些人给出了错误的信息）。请参阅 C++98 标准第 3.5.3 节。

首先是一些背景：

*翻译单元：*预处理器（递归地）包含其所有包含文件之后的源文件。

*静态链接：*符号仅在其翻译单元内可用。

*外部链接：*符号可从其他翻译单元获得。

### 在`namespace`水平

*这包括全局命名空间又名全局变量*。

```
static const int sci = 0; // sci is explicitly static
const int ci = 1;         // ci is implicitly static
extern const int eci = 2; // eci is explicitly extern
extern int ei = 3;        // ei is explicitly extern
int i = 4;                // i is implicitly extern
static int si = 5;        // si is explicitly static 
```

### 在功能层面

`static`表示该值在函数调用之间保持不变。
函数变量的语义`static`类似于全局变量，因为它们驻留在[程序的数据段](https://stackoverflow.com/questions/93039/where-are-static-variables-stored-in-cc)（而不是堆栈或堆）中，有关变量生命周期的更多详细信息，请参阅[此问题。](https://stackoverflow.com/questions/246564)`static`

### 在`class`水平

`static`意味着该值在类的所有实例之间共享，并且`const`意味着它不会改变。

* * *

## 回答 #2

> 赞同：129
> 
> 时间：2008-10-07T07:05:40.870

它在 C 和 C++ 中都有使用。

如您所料，该`static`部分将其范围限制为该[编译单元](https://stackoverflow.com/questions/1106149/what-is-a-translation-unit-in-c)。它还提供静态初始化。`const`只是告诉编译器不要让任何人修改它。根据架构，此变量要么放在数据段中，要么放在 bss 段中，并且可能在内存中标记为只读。

这就是 C 处理这些变量的方式（或 C++ 处理命名空间变量的方式）。在 C++ 中，标记的成员`static`由给定类的所有实例共享。它是否是私有的并不影响一个变量被多个实例共享的事实。如果有`const`任何代码试图修改它，那里会警告你。

如果它是严格私有的，那么类的每个实例都会有自己的版本（尽管有优化器）。

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2008-10-07T09:42:28.243

那行代码实际上可以出现在几个不同的上下文中，尽管它的行为大致相同，但还是有细微的差别。

# 命名空间范围

```
// foo.h
static const int i = 0; 
```

' `i`' 将在包含标题的每个翻译单元中可见。但是，除非您实际使用对象的地址（例如 ' `&i`'），否则我很确定编译器会将 ' `i`' 简单地视为类型安全`0`。如果再有两个翻译单元使用“ `&i`”，则每个翻译单元的地址将不同。

```
// foo.cc
static const int i = 0; 
```

' `i`' 具有内部链接，因此不能从该翻译单元外部引用。但是，除非您再次使用它的地址，否则它很可能会被视为类型安全的`0`。

值得指出的一件事是以下声明：

```
const int i1 = 0; 
```

与**完全相同**`static const int i = 0`。_ `const`使用声明但未显式声明的命名空间中的变量`extern`是隐式静态的。如果您考虑这一点，C++ 委员会的意图是允许`const`在头文件中声明变量，而不总是需要`static`关键字以避免破坏 ODR。

# 类范围

```
class A {
public:
  static const int i = 0;
}; 
```

在上面的示例中，标准明确规定`i`如果不需要其地址，则不需要定义 ' '。换句话说，如果您只使用 ' `i`' 作为类型安全的 0，那么编译器将不会定义它。类和命名空间版本之间的一个区别是类`i`成员的“”地址（如果在两个或更多翻译单元中使用）将是相同的。在使用地址的地方，您必须对其进行定义：

```
// a.h
class A {
public:
  static const int i = 0;
};

// a.cc
#include "a.h"
const int A::i;            // Definition so that we can take the address 
```

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2008-10-07T10:37:42.580

这是一个小空间优化。

当你说

```
const int foo = 42; 
```

您不是在定义一个常量，而是创建一个只读变量。编译器足够聪明，可以在看到 foo 时使用 42，但它也会在初始化的数据区域中为其分配空间。这样做是因为按照定义， foo 具有外部链接。另一个编译单元可以说：

extern const int foo;

获得它的价值。这不是一个好习惯，因为编译单元不知道 foo 的值是什么。它只知道它是一个 const int 并且在使用它时必须从内存中重新加载该值。

现在，通过声明它是静态的：

```
static const int foo = 42; 
```

编译器可以做它通常的优化，但它也可以说“嘿，这个编译单元之外没有人可以看到 foo，我知道它总是 42，所以没有必要为它分配任何空间。”

我还应该注意，在 C++ 中，防止名称转义当前编译单元的首选方法是使用匿名命名空间：

```
namespace {
    const int foo = 42; // same as static definition above
} 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-07T07:02:14.293

它缺少一个“int”。它应该是：

```
const static int foo = 42; 
```

在 C 和 C++ 中，它声明了一个整数常量，本地文件范围的值为 42。

为什么是42？如果你还不知道（很难相信你不知道），这是[**对生命、宇宙和一切的答案**](http://en.wikipedia.org/wiki/Answer_to_Life,_the_Universe,_and_Everything)的引用。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2018-12-21T11:06:28.673

**C++17`inline`变量**

如果您在 Google 上搜索“C++ const static”，那么您真正想要使用的很可能是[C++17 内联变量](https://en.cppreference.com/w/cpp/language/inline)。

这个很棒的 C++17 特性使我们能够：

*   方便地为每个常量只使用一个内存地址
*   将其存储为`constexpr`：[如何声明 constexpr extern？](https://stackoverflow.com/questions/30208685/how-to-declare-constexpr-extern)
*   从一个标题在一行中执行

主文件

```
#include <cassert>

#include "notmain.hpp"

int main() {
    // Both files see the same memory address.
    assert(&notmain_i == notmain_func());
    assert(notmain_i == 42);
} 
```

不是main.hpp

```
#ifndef NOTMAIN_HPP
#define NOTMAIN_HPP

inline constexpr int notmain_i = 42;

const int* notmain_func();

#endif 
```

非main.cpp

```
#include "notmain.hpp"

const int* notmain_func() {
    return &notmain_i;
} 
```

编译并运行：

```
g++ -c -o notmain.o -std=c++17 -Wall -Wextra -pedantic notmain.cpp
g++ -c -o main.o -std=c++17 -Wall -Wextra -pedantic main.cpp
g++ -o main -std=c++17 -Wall -Wextra -pedantic main.o notmain.o
./main 
```

[GitHub 上游](https://github.com/cirosantilli/cpp-cheat/tree/085c4b22b1b290a6d033a44958d05054e7e303c7/cpp/inline_variable).

另请参阅：[内联变量如何工作？](https://stackoverflow.com/questions/38043442/how-do-inline-variables-work)

**内联变量的 C++ 标准**

C++ 标准保证地址是相同的。[C++17 N4659 标准草案](https://github.com/cplusplus/draft/blob/master/papers/n4659.pdf) 10.1.6“内联说明符”：

> 6 具有外部链接的内联函数或变量在所有翻译单元中应具有相同的地址。

cppreference [https://en.cppreference.com/w/cpp/language/inline](https://en.cppreference.com/w/cpp/language/inline)解释说如果`static`没有给出，那么它有外部链接。

**GCC内联变量实现**

我们可以观察它是如何实现的：

```
nm main.o notmain.o 
```

其中包含：

```
main.o:
                 U _GLOBAL_OFFSET_TABLE_
                 U _Z12notmain_funcv
0000000000000028 r _ZZ4mainE19__PRETTY_FUNCTION__
                 U __assert_fail
0000000000000000 T main
0000000000000000 u notmain_i

notmain.o:
0000000000000000 T _Z12notmain_funcv
0000000000000000 u notmain_i 
```

并`man nm`说`u`：

> "u" 该符号是唯一的全局符号。这是标准 ELF 符号绑定集的 GNU 扩展。对于这样的符号，动态链接器将确保在整个过程中只有一个具有此名称和类型的符号在使用中。

所以我们看到有一个专门的 ELF 扩展。

**C++ 17 之前的版本：`extern const`**

在 C++ 17 之前，在 C 中，我们可以使用 实现非常相似的效果`extern const`，这将导致使用单个内存位置。

缺点`inline`是：

*   不可能`constexpr`用这种技术制作变量，只`inline`允许：[如何声明 constexpr extern？](https://stackoverflow.com/questions/30208685/how-to-declare-constexpr-extern)
*   它不太优雅，因为您必须在头文件和 cpp 文件中分别声明和定义变量

主文件

```
#include <cassert>

#include "notmain.hpp"

int main() {
    // Both files see the same memory address.
    assert(&notmain_i == notmain_func());
    assert(notmain_i == 42);
} 
```

非main.cpp

```
#include "notmain.hpp"

const int notmain_i = 42;

const int* notmain_func() {
    return &notmain_i;
} 
```

不是main.hpp

```
#ifndef NOTMAIN_HPP
#define NOTMAIN_HPP

extern const int notmain_i;

const int* notmain_func();

#endif 
```

[GitHub 上游](https://github.com/cirosantilli/cpp-cheat/tree/085c4b22b1b290a6d033a44958d05054e7e303c7/cpp/extern_const).

**仅 C++17 之前的标头替代品**

这些不如`extern`解决方案好，但它们可以工作并且只占用一个内存位置：

一个`constexpr`函数，因为[`constexpr`暗示`inline`](https://stackoverflow.com/questions/14391272/does-constexpr-imply-inline)并`inline` [允许（强制）定义出现在每个翻译单元上](https://stackoverflow.com/questions/14517546/how-can-a-c-header-file-include-implementation)：

```
constexpr int shared_inline_constexpr() { return 42; } 
```

我敢打赌，任何体面的编译器都会内联调用。

您还可以使用一个`const`或`constexpr`静态变量，如：

```
#include <iostream>

struct MyClass {
    static constexpr int i = 42;
};

int main() {
    std::cout << MyClass::i << std::endl;
    // undefined reference to `MyClass::i'
    //std::cout << &MyClass::i << std::endl;
} 
```

但是您不能做诸如获取其地址之类的事情，否则它会被 odr-used，另请参见：[Defining constexpr static data members](https://stackoverflow.com/questions/50109036/defining-constexpr-static-data-members/50111847#50111847)

**C**

在 C 中，情况与 C++ pre C++ 17 相同，我在以下位置上传了一个示例：[“静态”在 C 中是什么意思？](https://stackoverflow.com/questions/572547/what-does-static-mean-in-c/14339047#14339047)

唯一的区别是，在 C++ 中，`const`意味着`static`全局变量，但在 C 中却没有：[`static const` 与 `const` 的 C++ 语义](https://stackoverflow.com/questions/3709207/c-semantics-of-static-const-vs-const/54377560#54377560)

**有什么方法可以完全内联吗？**

TODO：有没有办法完全内联变量，而不使用任何内存？

就像预处理器所做的一样。

这将需要以某种方式：

*   禁止或检测变量的地址是否被占用
*   add that information to the ELF object files, and let LTO optimize it up

Related:

*   [C++11 enum with class members and constexpr link-time optimization](https://stackoverflow.com/questions/14090583/c11-enum-with-class-members-and-constexpr-link-time-optimization)

Tested in Ubuntu 18.10, GCC 8.2.0.

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2016-05-11T17:13:17.210

根据 C99/GNU99 规范：

*   `static`

    *   是存储类说明符

    *   默认情况下文件级范围的对象具有**外部**链接

    *   具有静态说明符的文件级范围的对象具有**内部**链接
*   `const`

    *   是类型限定符（是类型的一部分）

    *   应用于直接左侧实例的关键字 - 即

        *   `MyObj const * myVar;`- 指向 const 限定对象类型的非限定指针

        *   `MyObj * const myVar;`- 指向非限定对象类型的 const 限定指针

    *   最左边的用法 - 应用于对象类型，而不是变量

        *   `const MyObj * myVar;`- 指向 const 限定对象类型的非限定指针

**因此：**

`static NSString * const myVar;`- 指向具有内部链接的不可变字符串的常量指针。

缺少`static`关键字将使变量名全局化，并可能导致应用程序内的名称冲突。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-07T07:49:08.410

在 C++ 中，

```
static const int foo = 42; 
```

是定义和使用常量的首选方式。即使用这个而不是

```
#define foo 42 
```

因为它不会颠覆类型安全系统。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-08T07:57:49.063

对于所有出色的答案，我想添加一个小细节：

如果您编写插件（例如，要由 CAD 系统加载的 DLL 或 .so 库），那么*static*可以避免像这样的名称冲突：

1.  CAD系统加载一个插件A，它有一个“const int foo = 42;” 在里面。
2.  系统加载一个插件B，它有“const int foo = 23;” 在里面。
3.  结果，插件 B 将为 foo 使用值 42，因为插件加载器将意识到，已经有一个带有外部链接的“foo”。

更糟糕的是：步骤 3 的行为可能会因编译器优化、插件加载机制等而有所不同。

我曾经在两个插件中使用两个辅助函数（同名，不同的行为）遇到这个问题。将它们声明为静态解决了这个问题。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-07T07:06:10.040

是的，它从其他模块中隐藏了模块中的变量。在 C++ 中，当我不想/不需要更改将触发对其他文件进行不必要的重建的 .h 文件时，我会使用它。另外，我把静态放在第一位：

```
static const int foo = 42; 
```

此外，根据它的用途，编译器甚至不会为它分配存储空间，而是简单地“内联”它使用的值。没有静态，编译器不能假设它没有在其他地方使用并且不能内联。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-07T07:06:51.210

这是仅在编译模块（.cpp 文件）中可见/可访问的全局常量。顺便说一句，为此目的使用 static 已被弃用。最好使用匿名命名空间和枚举：

```
namespace
{
  enum
  {
     foo = 42
  };
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-07T07:07:16.373

将其设为私有仍然意味着它会出现在标题中。我倾向于使用“最弱”的方法。请参阅 Scott Meyers 的这篇经典文章：[http](http://www.ddj.com/cpp/184401197) ://www.ddj.com/cpp/184401197 （它是关于函数的，但也可以在这里应用）。

# windows-vista - 在 Vista 中删除清单权限

> ID：177442
> 
> 赞同：0
> 
> 时间：2008-10-07T07:01:14.857
> 
> 标签：windows-vista, manifest, permissions, administrator

我一直在 XP 中开发一个 C# windows 窗体应用程序。这一切都很好。但在 Vista 中，它无法将日志或记分牌文件写入硬盘。我发现我需要一个清单文件来允许弹出窗口要求它以管理员身份运行。

这一切都很好，我很高兴。我的问题是我不知道如何删除此权限，以便我可以重复测试并稍微改变情况。

有谁知道我如何删除清单文件给 EXE 的权限，因为我现在没有得到你希望它作为管理员弹出窗口运行的权限。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T07:20:15.067

清单没有给模块任何特定的权限。清单作为资源插入到模块中，然后插入。如果您需要重复测试 - 只需使用资源编辑器打开文件并删除和 MANIFEST 您可以看到的资源。

# .net - usercontrol的物理路径（asp.net）

> ID：177446
> 
> 赞同：0
> 
> 时间：2008-10-07T07:03:44.460
> 
> 标签：.net, asp.net, path

我在获取用户控件的路径方面遇到问题。场景如下：

在 aspx 中，我有多个用户控件。在其中一个用户控件中，我需要遍历其他用户控件并获取它们的物理路径。有什么简单的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T07:18:52.153

```
List<string> GetUserControlPathsForPage { 
     var list = new List<string>();
     return getUserControlPathsRecursive(Page.Controls, list);
 } 

void getPathsRecursive(ControlCollection controls, List<string> list) {  
     foreach (var c in controls) {  
        var uc = c as UserControl;
        if (uc != null) { 
            list.Add(Server.MapPath(uc.AppRelativeVirtualPath));
        }
        getPathsRecursive(c.Controls,list);
     }
 } 
```

# design-patterns - 将一种类型的树结构转换为另一种的设计模式？

> ID：177459
> 
> 赞同：0
> 
> 时间：2008-10-07T07:08:39.757
> 
> 标签：design-patterns, treeview, tree

我有一种树结构，表示地图中的层层次结构，按层和类别的类型划分。每个节点可以是不同类型的层的不同类（但所有节点都实现一个公共接口）。

我需要将该类转换为 ASP.NET TreeView 控件。输入树中的每个节点都是输出树中的一个节点，其属性集取决于节点的类型。我不希望输入树类知道 UI 类，所以我不能在其中编写“ToTreeViewNode()”方法。目前有 4 种具体节点类，其中 2 种是复合的（包含子节点），其中 2 种是叶子。这在未来可能会改变。

感觉这里有一种设计模式很想用，你能帮我看看它是什么吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T07:34:58.797

或许是一个[访问者](http://en.wikipedia.org/wiki/Visitor_pattern)，来遍历输入树并构建相应的 UI 树？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T10:30:57.227

我的 .NET 有点生疏，但您可以做的是创建一个单独的 TreeNodeCollection 子类和可能的 TreeNode，让他们访问您的结构并将**您的**TreeNodeCollection 分配给 TreeViewControl 的 Nodes 属性。

TreeNodeCollection 包装器会将您的结构转换为 TreeViewControl 结构。TreeNode 类可能包含对您自己的节点的引用，但会将您的节点转换为 TreeNode。

换句话说，通过实现这两个接口，您可以使模型的接口适应 TreeViewControl 使用的接口，

如果您使用访问者模式来创建并行结构，则每次发生更改时都必须运行它。或者您仍然必须使用 TreeNode 接口包装您的节点。

请参阅[适配器模式](http://en.wikipedia.org/wiki/Adapter_pattern)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-11T10:02:09.173

我不确定您要达到什么目标，但是（据我了解）我认为，如果您要同时使用两者：

1.  Composite - 用于节点（树）
2.  策略 - 用于执行绘图“算法”

所以你将拥有：

```
public class Node
{
   public IDraw genericDrawing;
   public Node[] Childs;
   public Node() { //init you genericDrawinf }
   public void Draw() 
   {
      genericDrawing.Draw(this);
      foreach (Node child in Childs)
      {
         child.Draw();
      }
   }
}

public interface IDraw
{
    void Draw(Node node);
}
public class SimpleDraw : IDraw
{
    public void Draw(Node node)
    {
       // code your stuf in here.
    }
} 
```

最棒的是：

1.  你不需要递归绘制每一幅画本身
2.  您的绘图策略可以在运行时或对象实例期间更改
3.  您可以在不依赖其他结构的情况下扩展每个类层次结构。
4.  把它想象成 Web 表单中的控件
5.  此外，每个对象都是（SRP）单一职责原则

享受。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T07:14:06.873

在我看来，您确实想在这里使用 Model-View-Controller。您的树图结构可能是模型，视图是 TreeView 控件 - 您可能需要添加某种控制器类来管理两者之间的交互。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T10:51:15.903

希望你的问题是正确的：

来自“O'Reilly - Designing Interfaces Patterns for Effective Iteration Design”

你得到了这两种通常与树相关的模式：

*   “级联列表”
*   “树状图”

本书的第 6 章作为用于显示复杂数据的大约 12 种设计模式模式。

我没有找到这些模式的任何链接，所以我想你需要在当地图书馆查看这本书。我发现这个网页可能有一些模式可以帮助你，但我已经检查过了，它不包括这两个，或者第 6 章中的那些。 [http://www.welie.com/patterns/](http://www.welie.com/patterns/)

# c# - 如何将 MVC 模式应用于 GUI 开发

> ID：177464
> 
> 赞同：8
> 
> 时间：2008-10-07T07:11:43.413
> 
> 标签：c#, c++, model-view-controller, user-interface, design-patterns

我是一名主要的 Web 开发人员，但我对 C++ 和 C# 有很好的理解。但是，最近我编写了一个 GUI 应用程序，并且开始迷失如何处理控制器和视图逻辑之间的关系。在 PHP 中这很容易——我可以闭着眼睛写我自己的 MVC 模式——主要是因为 PHP 是无状态的，你可以根据请求重新生成整个表单。但是在应用程序编程语言中，我很快就会迷失方向。

我的问题是：如何将控制器与视图分开？视图应该附加到来自控制器的事件 - 还是视图应该实现控制器与之交互的接口？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-07T07:31:05.047

如果我是你，我会从你的视图界面公开事件。这将允许您使控制器成为整个交互的中心。

控制器将首先加载并实例化视图，我将使用依赖注入，这样您就不会创建对视图本身的依赖，而只会在界面上创建依赖。控制器将访问模型并将数据加载到视图中。控制器将绑定到视图界面上定义的事件。然后控制器将通过事件处理将数据保存回模型。

如果您愿意，您还可以使用事件代理，这样就不需要为每个视图声明一个接口。这样您就可以通过属性绑定到事件。

这将使您的控制器依赖于模型和视图接口，视图仅依赖于数据，而模型没有依赖关系。

上述设计思想的一些例子可以在 CAB 和 Smart Client Software Factory [Link To Smart Client](http://www.codeplex.com/smartclient)中找到。他们使用 MVP 模式，但同样可以轻松地应用于 MVC 模式。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-10T04:10:41.483

大多数 GUI 框架（从 MFC 到 SWT 再到其他）都已经基于 MVC。事实上，MVC 模式最早是由 Smalltalk-80 创建的，后来才真正用于 GUI 开发。

仔细检查并查看您选择的 GUI 工具包的标准和建议的做法。有时，在解决某个问题或使用特定工具包时，MVC 并不是一个很好的模式。

记住：MVC 是一个很好的模式，但不是万能的解决方案，当基于事件或函数式编程会让你的生活更轻松时，不要试图将问题强加到 MVC 中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T07:14:59.460

想象一下这个 GUI：

Zergling 单位作为外星人图标呈现给用户。您可以看到它处于空闲动画中。称之为视图。

玩家通过点击单位和目标位置来移动单位。如果需要，您可以将播放器替换为 AI。称其为控制器。

单位在战斗中时，每游戏帧都会计算单位的生命值和攻击范围。您可以更改此数据以使 Zergling 成为一个范围单位。将此称为模型。

请记住这个类比并将其扩展到您的 MVC 设计。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T08:24:53.110

您要记住的重要一点是，在您的 MVC 设置中，Controller 必须知道要调用哪个 View，但 View 必须对 Controller 一无所知。

因此，您的 View 必须为 Controller 提供一种与之交互的通用方式，以便您可以让多个不同的 Controller 调用同一个 View（例如，作为参数提供的某些数据的标准化图形输出）。

这为您提供了灵活性：

1.  如果您的客户想要您仅提供 HTML 输出的内容的 PDF 输出，您可以编写一个新的 PDF 视图，以便从控制器调用，其参数与 HTML 视图相同。
2.  如果您的客户想要不同数据源的类似 HTML 输出（例如），您可以编写一个新控制器，该控制器为相同的旧 HTML 视图提供不同的数据集，从而仅提供与其他数据相同的 HTML 报告。

如果你保持你的视图与特定的控制器分离，并把关于从你的控制器调用哪个视图的知识，你就在你的路上。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T08:37:22.913

您的控制器应该明确地绑定到视图实现的接口上定义的事件。

你如何去做这件事可能是棘手的部分。依赖注入？观景厂？视图是否实例化了它想要的控制器？这实际上取决于应用程序的复杂程度。

对于真正快速和简单的事情，我将从让每个视图构造它的控制器开始，然后如果它需要变得更大，则查看其他选项。就我个人而言，我认为一个完整的依赖注入框架对于六种形式来说太过分了：]

# c++ - Qt 并且没有 moc_*.cpp 文件

> ID：177468
> 
> 赞同：17
> 
> 时间：2008-10-07T07:16:10.833
> 
> 标签：c++, qt, qt4

我正在开发一个简单的 Qt 4 应用程序并制作自己的对话框。我子类化，在类声明块中`QDialog`插入`Q_OBJECT`宏，然后......我得到了

> [链接器错误] 未定义对 `vtable for MyDialog' 的引用，并且 moc 编译器没有生成 moc_MyDialog.cpp。

我在 Windows XP 和 mingw 上使用 Qt 4.1.3。我遵循了 Qt 提供的构建 shell 的构建过程。我使用 qmake 创建 make 文件并使用 make 命令编译所有内容。

我有其他类分别是子类`QPushButton`和子类`QObject`，但它们编译正常。我找不到他们和坏人之间的任何区别。

破课中一定有什么遗漏，但我无法发现。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-10-07T08:13:15.287

未定义对“vtable for MyDialog”的引用是因为没有 moc 文件。大多数 c++ 编译器在包含第一个虚函数的目标文件中创建 vtable 定义。当子类化一个 qt 对象并使用 Q_OBJECT 宏时，这将在 moc*.cpp 文件中。因此，此错误意味着 moc 文件丢失。

我能想到的可能问题是：

1.  MyDialog.h 类的头文件没有添加到 qmake 文件的 HEADERS 中。

2.  在添加 Q_OBJECT 宏*之前*，您运行了 qmake 来生成 make 文件。这创建了一个没有 moc 规则的 make 文件。只需再次运行 qmake 即可轻松解决此问题。

3.  您的对话框派生自多个类，而 QDialog 不是它派生的第一个类。为了让 qmake 正常工作，QObject 派生的基类需要是第一个继承自的类。

4.  如果您使用的是 Qt Creator，如果您之前的部署由于某种原因（例如应用程序已经运行）而失败，您可能会收到此错误。在这种情况下，只需执行“清理项目”，然后“重建项目”，然后“运行”即可部署。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-05-17T00:59:08.877

如果您包含头文件，请按照以下步骤操作：

1.  右键单击添加此项目的项目。
2.  点击“运行 qmake”。

这将清除旧的引用并使用 Q_OBJECT 宏进行构建。QT 在重建时不会这样做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-06-06T21:00:41.097

我已经看到只有在添加一个没有扩展名的类然后手动添加扩展名时才会出现问题。

为了解决这个问题，我将 Q_OBJECT 放在类的 .h 中，然后右键单击“源”->“添加现有文件...”，选择我修改后的类的 .ccp。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T07:38:05.530

你在用qmake吗？也许你没有将它添加到你的 .cpp 文件到你的 SOURCES 和 .h 文件到你的 qmake 文件中的 HEADERS 变量？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T08:33:33.140

我谦虚地建议您使用[CMake](http://cmake.org)在 Windows 上构建 Qt 程序。它会让您记住将适当的文件添加到其构建文件中。

附加值是您可以从中生成 make/nmake 构建文件，即 Visual Studio 解决方案文件。如果您从 Visual Studio 的源代码编译 Qt，您将能够使用 MS IDE/编译器进行编码和构建。

这当然是在您使用 Visual Studio 的情况下。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-03-11T04:20:20.790

消息 undefined reference to `vtable for MyDialog' 也可能是 MyDialog 派生的类中的纯虚函数缺少实现（在 MyDialog 中）的结果。

# java - Java中的可嵌入分布式版本控制系统？

> ID：177469
> 
> 赞同：7
> 
> 时间：2008-10-07T07:16:59.800
> 
> 标签：java, dvcs

是否有一个分布式版本控制系统（如 git 或 Mercurial）可以用作 Java 应用程序中的嵌入式库（实现应用程序数据的版本化和可同步存储），理想情况下是用纯 Java 编写并在许可许可下编写？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T07:53:06.733

@Josh Moore 的回复让我想到了[JGit](http://www.jgit.org/)，它似乎是 JavaGit 的竞争对手。JGit 是纯 Java 并在 BSD 下获得许可。

一些进一步挖掘出土[的 HgKit](http://hgkit.berlios.de/)，旨在用 Java 实现 Mercurial。它仍然是 pre-alpha 和 GPLed。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T07:21:44.127

我不知道任何纯 Java 解决方案。但是，请查看[http://javagit.sourceforge.net/](http://javagit.sourceforge.net/)，您可以使用它通过 Java 连接到 git 存储库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T18:35:08.823

有一个纯 Java 库，[SVN Kit](http://svnkit.com/)用于与**Subversion交互**

# eclipse - 哪个是最好的RCP平台

> ID：177475
> 
> 赞同：5
> 
> 时间：2008-10-07T07:21:50.727
> 
> 标签：eclipse, netbeans, rcp

我正在构建一个桌面应用程序。我们的分析表明，使用 RCP 构建会更好。我应该使用 eclipse 还是 netbeans 平台来构建我的应用程序。一些需要考虑的因素是

*   表现
*   外观和感觉
*   在目标用户（开发人员/测试人员）中的受欢迎程度
*   许可证（必须是一些 FOSS）

该应用程序将具有文本编辑器、网格视图、框图和图形可视化等功能。

我已经有 netbeans 开发的经验，但是学习 eclipse 不会有什么坏处。任何其他选择也将受到欢迎。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T13:30:12.357

我使用 Eclipse 构建了 RCP 文本编辑器、多个视图和图表（仅缺少您提到的框图）。环境非常好，社区支持获得帮助（这是我的第一次 Eclipse RCP 体验 - 几乎我所有的问题都在 eclipse 论坛中的某个时间点或另一个点得到了回答。如果没有 - 我得到了很好的反馈。 )

该平台非常轻巧，并且总体上可以很好地处理内存。您可能会遇到的一些问题，您可能会在您选择的任何平台上遇到。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-23T03:44:19.773

我会看看Netbeans。Netbeans 基于 Swing，而 Eclipse 使用 SWT。Sun 在过去几年中在 Netbeans 上投入了大量精力，而且效果非常好。

Netbeans 站点上有一些关于插件和平台的教程。

```
http://www.netbeans.org/kb/trails/platform.html 
```

这当然是一个宗教问题。你会发现它在网上反复辩论。这里有几个有趣的话题。

```
http://www.nabble.com/Choosing-Netbeans-platform-or-Eclipse-RCP-td16012394.html
http://www.javalobby.org/java/forums/t103146.html 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T15:11:43.040

我投票给 Netbeans。它的许多缺点已在 5 和 6 版本中得到纠正。社区较小，但肯定同样有帮助。

另一种选择是 Swing 应用程序框架 (JSR-296)，它为构建 Swing 应用程序提供了一个非常轻量级的框架。它提供了一些基本的管道，例如共享数据和基本状态和工作组件的应用程序上下文。它不提供任何复杂的组件，因此对于您的需要来说它可能太轻量级了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-06T13:37:25.327

我建议使用 Eclipse RCP，据我所知，它有很多有用的方面，如动作和命令机制、Eclipse 表单、数据绑定等。您可以使用 GEF 和 Zest 进行基于图形的可视化和可视化编辑器。Window builder 也是拖放 ui 创建的便捷选择。还有很多学习 Eclipse4 RCP 的资源，vogella.de 是一个很好的起点。干杯...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-20T14:18:35.793

Eclipse RCP 功能强大。我已经将它用于我的一个项目。是的，它有一些错误，但它有很多文档，而且我认为它比 Netbeans RCP 更快。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T08:28:23.963

您是否必须仅在 Eclipse 和 Netbeans 之间进行选择？

听说春天不错 [![替代文字](https://i.stack.imgur.com/WmeB3.png)](http://www.springframework.net/)

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-07T07:33:16.133

Eclipse 有错误，尤其是文本编辑器。另一方面，Netbeans 比孤岛危机更糟

# web-crawler - 防止网站数据被抓取和翻录

> ID：177479
> 
> 赞同：20
> 
> 时间：2008-10-07T07:23:10.147
> 
> 标签：web-crawler, spam-prevention

我正在考虑建立一个内容站点，其中可能包含数千个不同的条目，可通过索引和搜索访问。

我可以采取哪些措施来防止**恶意爬虫**窃取我网站上的所有数据？我不太担心 SEO，尽管我不想一起阻止合法的爬虫。

例如，我想过随机更改用于显示我的数据的 HTML 结构的一小部分，但我想这不会真正有效。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-07T07:25:49.457

从理论上讲，人眼可见的任何站点都可能被撕裂。如果您甚至要尝试访问，那么根据定义，**必须**是这种情况（如果它不是机器可读的，那么说话的浏览器将如何传递您的内容）。

您最好的办法是研究为您的内容添加水印，这样至少如果它被撕掉，您可以指向水印并声明所有权。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-07T07:41:31.950

这之间：

> 我可以采取哪些措施来防止恶意爬虫翻录

还有这个：

> 我不想一起阻止合法的爬虫。

你要求很多。事实是，如果您要尝试阻止恶意抓取工具，您最终也会阻止所有“好的”爬虫。

您必须记住，如果人们想要抓取您的内容，他们将投入比搜索引擎机器人更多的手动工作......所以请正确处理您的优先事项。你有两个选择：

1.  让互联网的农民窃取您的内容。留意它（在 Google 上搜索您的一些更独特的短语）并向 ISP 发送删除请求。除了时间，这个选择对你几乎没有任何影响。
2.  使用 AJAX 和滚动加密从服务器请求您的所有内容。您需要保持方法不断变化，甚至是随机的，这样每个页面加载都带有不同的加密方案。但是，如果有人想破解它，即使它***也会被破解。***您还将丢掉搜索引擎的面子，从而减少真实用户的流量。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-07T07:40:18.320

好的爬虫会遵循你在 robots.txt 中指定的规则，恶意爬虫不会。您可以为坏机器人设置“陷阱”，如下所述：http: [//www.fleiner.com/bots/](http://www.fleiner.com/bots/)。
但话又说回来，如果你把你的内容放到互联网上，我认为如果它尽可能轻松地找到对每个人来说都会更好（事实上，你在这里发帖，而不是在*专家交流*意见的蹩脚论坛上发帖）

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-07T11:38:21.350

实际上，您无法阻止恶意爬虫 - 并且您为防止它们而采取的任何措施都可能损害您的合法用户（除了可能向 robots.txt 添加条目以允许检测之外）

因此，您必须对被盗的内容进行计划——它很可能以一种或另一种形式发生——并了解你将如何处理未经授权的复制。

预防是不可能的 - 这样做会浪费你的时间。

确保网站内容不易被复制的唯一可靠方法是拔下网线...

[要检测它，请使用http://www.copyscape.com/](http://www.copyscape.com/)之类的东西可能会有所帮助。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-07T08:59:25.600

甚至不要试图在网络上设置限制！

真的就这么简单。

阻止翻录的每一项潜在措施（除了非常严格的 robots.txt 之外）都会伤害您的用户。验证码比收获更痛苦。检查用户代理会关闭意外的浏览器。使用 javascript 的“聪明”技巧也是如此。

请保持网络畅通。如果您不希望从您的网站中获取任何内容，请不要在此处发布。水印可以帮助您声明所有权，但这仅在您想在损害完成后提起诉讼时才有帮助。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-07T07:37:12.973

阻止网站被机器翻录的唯一方法是让用户证明他们是人类。

您可以让用户执行一项对人类来说容易而对机器来说很难的任务，例如：CAPTCHA。当用户第一次访问您的站点时，请出示验证码，并且仅在完成后才允许他们继续。如果用户开始从一个页面移动到另一个页面太快，请重新验证。

这不是 100% 有效的，黑客总是试图破坏它们。

或者，您可以做出缓慢的反应。您不需要让它们爬行，而是选择一个对人类来说合理的速度（这对于机器来说会非常慢）。这只会使他们花费更长的时间来抓取您的网站，但并非不可能。

好的。没有想法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-07T07:39:50.957

简而言之：您无法阻止翻录。恶意机器人通常使用 IE 用户代理，并且现在相当聪明。如果您想让您的站点访问的最大数量（即屏幕阅读器等），您不能仅仅因为它们会阻止合法用户的访问而使用 javascript 或流行的插件之一（flash）。

也许你可以有一个 cron 作业，从你的数据库中挑选一个随机片段并用谷歌搜索它以检查匹配项。然后，您可以尝试获取违规网站并要求他们删除内容。

您还可以监控来自给定 IP 的请求数量，并在超过阈值时阻止它，尽管您可能必须将合法机器人列入白名单，并且对僵尸网络没有用处（但如果您遇到僵尸网络，也许翻录是不是你最大的问题）。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-07T07:39:57.367

如果您正在制作一个公共网站，那么这将非常困难。有些方法涉及到服务器端脚本来生成内容或使用非文本（Flash 等）来最大限度地减少翻录的可能性。

但老实说，如果您认为您的内容非常好，只需对其进行密码保护并将其从公共领域删除即可。

我的观点是，网络的全部意义在于向尽可能多的人传播有用的内容。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-07T07:41:08.583

如果内容是公开的并且可以免费获得，即使有页面浏览限制或其他什么，你也无能为力。如果您需要注册和/或付款才能访问数据，您可能会对其进行一些限制，至少您可以看到谁在阅读什么内容并识别出似乎正在抓取您的整个数据库的用户。

但是，我认为您应该面对这样一个事实，即网络就是这样工作的，没有太多方法可以阻止机器读取人类所能读取的内容。将您的所有内容输出为图像当然会阻止大多数人，但随后该网站将无法访问，更不用说即使是非残疾用户也无法复制粘贴任何内容的事实 - 这真的很烦人。

总而言之，这听起来像是 DRM/游戏保护系统——惹恼你的合法用户只是为了防止一些你无论如何都无法真正防止的不良行为。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-07T07:35:26.330

您可以尝试使用 Flash / Silverlight / Java 来显示所有页面内容。这可能会阻止大多数爬虫。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-07T07:43:39.730

我曾经有一个基于 User-Agent 标头阻止或允许的系统。它依赖于爬虫设置他们的用户代理，但似乎大多数人都这样做。

当然，如果他们使用假标头来模拟流行的浏览器，那将无法正常工作。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-10-07T07:30:46.810

尽可能使用人工验证器并尝试使用一些框架（MVC）。网站翻录软件有时无法翻录此类页面。还要检测用户代理，至少它会减少可能的撕裂者的数量

# c# - GridViewColumn 内容和 VerticalAlignment

> ID：177485
> 
> 赞同：18
> 
> 时间：2008-10-07T07:28:14.427
> 
> 标签：c#, wpf, xaml, gridviewcolumn

我想使用 GridView 在列表视图中显示一些信息。我有几个 GridViewColumns，一切正常。

但是，希望 GridViewColumns 内容具有 VerticalAlignment（在本例中为 Top），但 gridvewcolumn 自身不提供 VerticalContentAlignment 依赖属性。使用 DisplayMemberBinding 时也无法提供 VerticalAlignment 信息。

当使用自定义 DataTemplate 作为 Celltemplate 时，我可以添加一个 VerticalAlignment="top" dp 到例如一些文本块。但是这不起作用。是否有任何“漂亮的特殊魔术”来完成这项任务？(

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-07T08:43:24.167

您可以将此样式应用于您的`ListView`：

```
<Style TargetType="{x:Type ListView}">
    <Setter Property="ItemContainerStyle">
        <Setter.Value>
            <Style TargetType="ListViewItem">
                <Setter Property="VerticalContentAlignment" Value="Top"/>
            </Style>
        </Setter.Value>
    </Setter>
</Style> 
```

# python - 在 Django Admin 中保留过滤器

> ID：177492
> 
> 赞同：6
> 
> 时间：2008-10-07T07:33:58.813
> 
> 标签：python, django, django-admin

我想要达到的是：

*   我去管理站点，对对象列表应用一些过滤器
*   我点击对象编辑，编辑，编辑，点击“保存”
*   站点将我带到对象列表...未过滤。我希望记住并应用第 1 步中的过滤器。

有没有简单的方法来做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T23:41:28.567

不幸的是，没有简单的方法可以做到这一点。过滤似乎没有保存在任何会话变量中。

单击两次返回是正常的方法，但如果您刚刚更改了一个对象以使其不再使用您的过滤器显示，那么它可能会很笨拙和烦人。

如果只是一次性的，点击返回两次或再次过滤，这是最简单的方法。

如果您要更频繁地进行过滤，或者您只是想了解如何破解管理员（这非常开放且容易），您将需要编写一个[FilterSpec](http://code.djangoproject.com/browser/django/trunk/django/contrib/admin/filterspecs.py)。

[在这里](http://www.djangosnippets.org/snippets/1051/)和[这里](http://www.djangosnippets.org/snippets/587/)看看人们自己写的例子。

一个非常非常糟糕的方法是编辑管理界面，以便在您单击“保存”后，您将被重定向到您过滤的 URL。我根本不会推荐这个，但这是一个选择。

另一种相当简单的方法是编写一个通用视图来显示您过滤的对象，然后使用 Django 表单从那里编辑项目。我会看看这个，你会惊讶于你必须编写多少代码来获得一个简单的查看/编辑页面。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T08:15:56.843

单击 2 次“返回”？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-15T12:25:45.100

有一个简单的技巧可以做到这一点，但这不是一个通用的解决方案，需要修改`ModelAdmin`你想要支持的每一个。也许有一种通用的方法可以做到这一点，但我还没有花时间在一般层面上解决它。

第一步是`FilterSpec`为过滤器编写一个自定义（请参阅 Harley 的帖子以获取有用的链接），它将所选过滤器值保存在会话中（并在不再需要时将其删除）。

```
# in cust_admin/filterspecs.py
from django.contrib.admin.filterspecs import FilterSpec, ChoicesFilterSpec

class MyFilterSpec(ChoicesFilterSpec):

    def __init__(self, f, request, params, model, model_admin):
        super(MyFilterSpec, self).__init__(f, request, params, model,
                                           model_admin)
        if self.lookup_val is not None:
            request.session[self.lookup_kwarg] = self.lookup_val
        elif self.lookup_kwarg in request.session:
            del(request.session[self.lookup_kwarg])

# Register the filter with a test function which will apply it to any field
# with a my_filter attribute equal to True
FilterSpec.filter_specs.insert(0, (lambda f: getattr(f, 'my_filter', False),
                               MyFilterSpec)) 
```

您必须导入位于某处的模块，例如您的`urls.py`：

```
# in urls.py
from cust_admin import filterspecs 
```

在要应用过滤器的字段上设置属性：

```
# in models.py
class MyModel(models.Model):
    my_field = Models.IntegerField(choices=MY_CHOICES)
    my_field.my_filter = True 
```

在自定义`ModelAdmin`类中，覆盖该`change_view`方法，以便在用户单击**save**后，他们将返回到列表视图，并将其过滤字段值添加到 URL。

```
class MyModelAdmin(admin.ModelAdmin):
    def change_view(self, request, object_id, extra_context=None):
        result = super(MyModelAdmin, self).change_view(request, object_id,
                                                       extra_context)
        if '_save' in request.POST:
            if 'my_field__exact' in request.session:
                result['Location'] = '/admin/myapp/mymodel/?my_field__exact=%s' \
                                     % request.session['my_field__exact']
        return result 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-03T16:20:20.083

另一种方法是将过滤器嵌入到查询集中。

您可以使用按您想要的方式过滤的管理器动态创建代理模型，然后调用 admin.site.register() 来创建新的模型管理员。然后所有链接都将与此视图相关。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-02T12:32:47.197

在我看来，最好覆盖 ModelAdmin 的方法`changelist_view`和`change_view`：

像这样：

```
class FakturaAdmin(admin.ModelAdmin):

[...]

def changelist_view(self, request, extra_context=None):
    result = super(FakturaAdmin, self).changelist_view(request, extra_context=None)
    request.session['qdict'] = request.GET
    return result

def change_view(self, request, object_id, extra_context=None):
    result = super(FakturaAdmin, self).change_view(request, object_id, extra_context)
    try:
        result['location'] = result['location']+"?"+request.session['qdict'].urlencode()
    except:
        pass
    return result 
```

如您所愿，保存对象后，您将返回到具有活动过滤器的对象列表。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-02-28T20:36:46.693

Django 项目中有一个更改请求，要求正是这个功能。

等待签入的只是一些测试和文档。您可以编写这些内容并帮助整个项目，或者您可以直接获取建议的补丁（靠近页面底部）并尝试一下。

[https://code.djangoproject.com/ticket/6903](https://code.djangoproject.com/ticket/6903)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-04-23T06:12:00.673

此功能已作为 1.6 版本的一部分添加到 Django，现在默认启用。[发行说明](https://docs.djangoproject.com/en/1.6/releases/1.6/#minor-features)中对此进行了描述：

> ModelAdmin 现在在创建、编辑或删除对象后保留列表视图中的过滤器。可以通过将 preserve_filters 属性设置为 False 来恢复之前清除过滤器的行为。

# jquery - 参考 Jquery 中的 Javascript 文件

> ID：177496
> 
> 赞同：3
> 
> 时间：2008-10-07T07:35:59.543
> 
> 标签：jquery

我有一个简单的 HTML。我将 JQuery 用于 AJAX 目的。现在，我想将我的 javascript 函数放在一个单独的 javascript 文件中。这个的语法是什么？例如，目前我在 HTML 中的脚本部分是这样的：

```
<script>
<script type="text/javascript" src="scripts/scripts.js"></script>
<script type="text/javascript" src="scripts/jquery.js"></script>
<script type = "text/javascript" language="javascript">
 $(document).ready(function() {
   $("#SubmitForm").click(Submit());
 });
</script> 
```

但我想把这个功能

```
function() {
   $("#SubmitForm").click(Submit());
 }) 
```

在文件 scripts.js 中。我可以使用为该函数分配一个名称并引用它吗？

编辑：我这里还有一点问题：我将代码更改为

```
<script type = "text/javascript" language="javascript">
$(document).ready(function() {
    $("#SubmitForm").click(submitMe);
});
</script> 
```

在一个单独的 js 文件中，我有以下代码：

```
var submitMe = function(){
alert('clicked23!');
//$('#Testing').html('news');
}; 
```

下面是正文部分：

```
<body>
welcome
<form id="SubmitForm" action="/showcontent" method="POST">
<input type="file" name="vsprojFiles" />
<br/>
<input type="submit" id="SubmitButton"/>
</form>

<div id="Testing">
hi
</div>

</body> 
```

但是，它仍然无法正常工作，我想念什么吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T07:45:05.720

将 scripts.js`script`标记向下移动到 jQuery 标记下方`script`，然后将整个内联脚本块移动到 scripts.js 中。由于 jQuery 在 scripts.js 加载时已经被实例化，因此 Javascript 将像现在一样内联执行。

同样在单独的说明中，您需要更改

```
$("#SubmitForm").click(Submit()); 
```

到

```
$("#SubmitForm").click(Submit); 
```

您不需要括号，因为此时您没有执行该函数，只是告诉 click 事件处理程序这是您要在事件触发时执行的函数的名称。

作为另一个提示，您可以替换`$(document).ready(`为`$(`ie：

```
 $(function() {
   $("#SubmitForm").click(Submit);
 }); 
```

两者`$`和`document.ready`都可以包含在页面上的任何位置（或外部文件中），只要 jQuery.js 在范围内，它们就会同时触发（一旦 DOM 加载） - 你不必担心它作为最后一段代码被触发。这就是为什么您可以将整个内容移至 scripts.js 而无需为函数指定名称并从内联脚本中引用它。

作为记录，如果您确实希望通过名称引用函数，只需将其定义为变量：

```
var func = function() {
  $("#SubmitForm").click(Submit);
};

$(func); 
```

就像我说的那样，在您的情况下这可能有点矫枉过正，您不妨将整个内容移至 scripts.js（当然，除非您在问题中提到的内容更多。

**编辑（处理对问题的编辑）**：看起来您正在处理错误的事件处理程序。您正在尝试将函数分配给表单的单击事件处理程序，而您确实希望将其分配给提交按钮的处理程序。因此，您应该使用选择器“#SubmitButton”，即：

```
$("#SubmitButton").click(Submit); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T07:44:58.917

是的，这不是问题，只需将函数存储为变量，就像其他任何函数一样。

```
var myfunc = function(){
    // Do some stuff
} 
```

然后，您可以使用以下语法在 jQuery init 函数中运行它：

```
$(document).ready(myfunc); 
```

对于在准备好的文档上运行的代码，还有一个快捷语法，它只是将一个函数传递给 jQuery：

```
$(myfunc); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T07:47:02.797

为什么不转储

```
$(document).ready(function() {
    $("#SubmitForm").click(Submit);
}); 
```

在外部文件中？它将按目前的方式工作，因为您可以堆叠 onDomReady 事件。

你的 html 应该是这样的（注意第一个`<script>`是不好的）：

```
<script type="text/javascript" src="scripts/scripts.js"></script>
<script type="text/javascript" src="scripts/jquery.js"></script>
<script type="text/javascript" src="scripts/scripts.js"></script> 
```

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2008-10-07T07:37:46.217

```
$('head').append('&lt;script type="text/javascript" src="scripts/scripts.js"/&gt;') 
```

# floating-point - 为什么我看到一个双变量初始化为 21.4 之类的某个值作为 21.399999618530273？

> ID：177506
> 
> 赞同：46
> 
> 时间：2008-10-07T07:40:17.490
> 
> 标签：floating-point, precision

```
double r = 11.631;
double theta = 21.4; 
```

在调试器中，这些显示为`11.631000000000000`和`21.399999618530273`。

我怎样才能避免这种情况？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-10-07T07:42:32.183

这些[准确性问题](http://en.wikipedia.org/wiki/Floating_point_number#Accuracy_problems)是由于浮点数的[内部表示造成的，您无法避免。](http://en.wikipedia.org/wiki/Floating_point_number#Internal_representation)

顺便说一句，在运行时打印这些值通常仍然会产生正确的结果，至少使用现代 C++ 编译器是这样。对于大多数操作来说，这不是什么大问题。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-10-07T08:01:40.227

我喜欢[Joel 的解释](http://www.joelonsoftware.com/items/2007/09/26b.html)，它处理 Excel 2007 中类似的二进制浮点精度问题：

> 看看最后有很多 0110 0110 0110 吗？那是因为**0.1**在二进制中*没有精确的表示*……它是一个重复的二进制数。这有点像 1/3 没有十进制表示。1/3 是 0.33333333，你必须永远写 3。如果你失去耐心，你会得到一些不准确的东西。
> 
> 所以你可以想象，如果你想用十进制计算 3*1/3，而你没有时间永远写 3，你得到的结果将是 0.99999999，而不是 1，人们会生气你错了。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-07T07:51:26.237

如果您有如下值：

```
double theta = 21.4; 
```

你想做：

```
if (theta == 21.4)
{
} 
```

你必须有点聪明，你需要检查 theta 的值是否**真的**接近 21.4，但不一定是那个值。

```
if (fabs(theta - 21.4) <= 1e-6)
{
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-07T09:35:14.747

这部分是特定于平台的 - 我们不知道您使用的是什么平台。

这也是知道你真正*想*看到什么的部分情况。调试器正在向您展示 - 在某种程度上，无论如何 - 存储在变量中的精确值。在我[关于 .NET 中的二进制浮点数的文章中](http://pobox.com/~skeet/csharp/floatingpoint.html)，有一个[C# 类](http://pobox.com/~skeet/csharp/DoubleConverter.cs)可以让您查看存储在双精度数中的绝对*精确数字。*在线版本目前无法使用 - 我会尝试将其放在另一个站点上。

鉴于调试器看到“实际”值，它必须对要显示的内容做出判断——它可以显示四舍五入到小数点后的值，或更精确的值。一些调试器在阅读开发人员的想法方面比其他调试器做得更好，但这是二进制浮点数的一个基本问题。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-07T09:25:49.433

`decimal`如果您希望在精度范围内保持稳定性，请使用定点类型。有开销，如果您希望转换为浮点数，则必须显式转换。如果您确实转换为浮点数，您将重新引入似乎困扰您的不稳定性。

或者，您可以克服它并学习*使用*浮点运算的有限精度。例如，您可以使用舍入来使值收敛，或者您可以使用 epsilon 比较来描述容差。“Epsilon”是您设置的定义容差的常数。例如，如果两个值在 0.0001 范围内，您可以选择将它们视为相等。

我突然想到，您可以使用运算符重载来使 epsilon 比较透明。那会很酷。

* * *

对于尾数指数表示，必须计算 EPSILON 以保持在可表示的精度范围内。对于数字 N，Epsilon = N / 10E+14

`System.Double.Epsilon`是该类型的最小可表示正值`Double`。它对于我们的目的来说太小了*。*阅读[微软关于平等测试的建议](https://msdn.microsoft.com/en-us/library/system.double(v=vs.110).aspx#Equality)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-07T12:22:22.447

我以前（[在我的博客上](http://bizvprog.blogspot.com/2008/05/floating-point-numbers-more-inaccurate.html)）遇到过这个问题——我认为令人惊讶的往往是“非理性”数字是不同的。

这里的“非理性”是指无法以这种格式准确表示的事实。真正的无理数（如 π - pi）根本无法准确表示。

大多数人都熟悉 1/3 不能以十进制表示：0.3333333333333...

奇怪的是 1.1 在浮点数中不起作用。人们期望十进制值可以在浮点数中工作，因为他们对它们的看法：

> 1.1 是 11 x 10^-1

当他们实际上在base-2时

> 1.1 是 154811237190861 x 2^-47

你无法避免它，你只需要习惯一些浮动是“非理性的”这一事实，就像 1/3 一样。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-07T07:52:18.480

避免这种情况的一种方法是使用一个库，该库使用另一种表示十进制数的方法，例如[BCD](http://en.wikipedia.org/wiki/Binary_coded_decimal)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-07T09:41:06.030

在我看来，21.399999618530273 是 21.4 的*单精度*（浮点）表示。看起来调试器正在从 double 向下转换为 float 某处。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-07T07:57:29.720

如果您使用 Java 并且需要准确性，请使用 BigDecimal 类进行浮点计算。它更慢但更安全。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-07T10:50:27.217

您无法避免这种情况，因为您使用的是具有固定字节数的浮点数。实数与其有限符号之间根本不可能存在同构。

但大多数时候你可以简单地忽略它。21.4==21.4 仍然是正确的，因为它仍然是具有相同错误的相同数字。但是 21.4f==21.4 可能不是真的，因为 float 和 double 的错误是不同的。

如果您需要固定精度，也许您应该尝试定点数。甚至整数。例如，我经常使用 int(1000*x) 传递给调试寻呼机。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-11-02T14:21:30.640

[计算机算术的危险](http://spiff.rit.edu/classes/phys317/lectures/dangers.html)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-07T09:47:43.960

如果它困扰您，您可以自定义调试期间某些值的显示方式。小心使用它:-)

[使用调试器显示属性增强调试](http://msdn.microsoft.com/en-us/library/ms228992.aspx)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-13T10:01:09.233

请参阅[通用十进制算术](http://speleotrove.com/decimal/#summary)

在比较浮点数时还要注意，有关更多信息，请参阅[此答案](https://stackoverflow.com/questions/17333/most-effective-way-for-float-and-double-comparison#17467)。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-05-30T15:25:39.977

根据javadoc

“如果数值运算符的至少一个操作数是 double 类型，则
使用 64 位浮点算术执行运算，
数值运算符的结果是 double 类型的值。如果另一个操作数不是双精度数，它
首先被扩展（第 5.1.5 节）以通过数字提升（第 5.6 节）键入双精度。”

[这里是源](http://docs.oracle.com/javase/specs/jls/se7/html/jls-4.html#jls-4.2.3)

# java - RMI 或 Web 服务示例应用程序

> ID：177513
> 
> 赞同：0
> 
> 时间：2008-10-07T07:43:00.467
> 
> 标签：java, .net, web-services

有谁知道使用 RMI 或 Web 服务的示例分布式应用程序（.NET 或 J2EE）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T07:52:16.720

通常，Sun 有一个关于 RMI 的优秀教程：http: [//java.sun.com/docs/books/tutorial/rmi/index.html](http://java.sun.com/docs/books/tutorial/rmi/index.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T07:53:12.363

RMI 示例：[链接](http://yama-linux.cc.kagoshima-u.ac.jp/~yamanoue/researches/java/rmi-ex2/)

Web 服务示例：[链接](http://www.artima.com/lejava/articles/threeminutes.html)

希望能帮助到你

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T17:03:35.937

**这是一个简单的解决方案：**

[BEA Weblogic](http://www.bea.com/framework.jsp?CNT=index.htm&FP=/content/products/weblogic/server)有一个名为**MedRec**的示例 Web 应用程序，我已经使用了一段时间。该示例带有一个内置的名为**CSharpClient**的 .NET 客户端，该客户端通过 Web 服务连接到 MedRec。我很高兴我不需要安装任何其他东西。

在 Weblogic 10 中，客户端可以在文件夹“bea\wlserver_10.0\samples\server\medrec\src\clients\CSharpClient”中找到。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-04T01:20:58.630

另一个功能强大的裸机 RMI 示例，它将动态对象从客户端加载到服务器并在那里执行，然后返回结果。这可以很容易地扩展为功能齐全的分布式计算环境。

[http://www.ningzhang.info/example.java.rmi.ComputeEngine](http://www.ningzhang.info/example.java.rmi.ComputeEngine)

# java - 服务器端的好 XMPP Java 库？

> ID：177514
> 
> 赞同：63
> 
> 时间：2008-10-07T07:43:22.010
> 
> 标签：java, xmpp

我希望用 Java 实现一个简单的 XMPP 服务器。

我需要的是一个可以解析和理解来自客户端的 xmpp 请求的库。我看过 Smack（下面提到）和 JSO。Smack 似乎只是客户端，因此虽然它可能有助于解析数据包，但它不知道如何响应客户端。JSO 是否维护它看起来很旧。唯一有希望的途径是拆开作为完整商业 (OSS) XMPP 服务器的 Openfire。

我只是希望在 Netty 或 Mina 之上有几行代码，这样我就可以开始处理一些在线消息。

* * *

乔——

那么我想要做的事情的答案有点长 - 我会尽量保持简短。

有两件事只是松散相关：

1）我想写一个 XMPP 服务器，因为我想为两个客户端编写一个自定义协议进行通信。基本上我正在考虑一个联网的 iPhone 应用程序 - 但我不想依赖低级二进制协议，因为使用 XMPP 之类的东西意味着应用程序可以从基于本地 wifi 的应用程序快速“成长”到基于互联网的应用程序...

交换的 msgs 应该是相对较低的延迟，所以严格来说二进制协议是最好的，但我觉得如果 XMPP 没有引入太多开销以便我可以使用它，然后从它的可扩展性中获益，那么它可能值得探索和以后的灵活性。

2) 我为 Terracotta 工作——所以我有一种疯狂的倾向，想把所有东西都聚集在一起。当我开始考虑编写一些自定义服务器代码时，我想我想对它进行集群。Terracotta 使扩展 Java POJO 变得微不足道，所以我的想法是构建一个超级简单的 XMPP 服务器作为 Terracotta 的演示应用程序。基本上每个用户都会通过 TCP 连接连接到服务器，这会将用户注册到哈希图中。每个用户都有一个 LinkedBlockingQueue，其中有一个侦听器线程从队列中获取消息。然后，任何想要向任何其他用户（例如任何旧的聊天应用程序）发送消息的连接用户只需通过连接向该用户发出 XMPP 消息（像往常一样）。服务器拾取它，在地图中查找相应的用户对象并将消息放入队列中。由于队列是聚集的，

所以 - 恐怕不是太短的总结。但这就是我想做的。我想我可以为 Openfire 编写一个插件来完成＃1，但我认为它需要处理很多管道，所以很难做到＃2（特别是因为我希望有非常少量的代码可以适合简单的 10-20kb Maven 项目）。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-10-07T08:23:40.900

[http://xmpp.org/xmpp-software/libraries/](http://xmpp.org/xmpp-software/libraries/)有一个 XMPP 的软件库列表。这是它的*过时*快照：

### 动作脚本

*   [as3xmpp](http://code.google.com/p/as3xmpp/)

### C

*   [伊克塞梅尔](http://code.google.com/p/iksemel/)
*   [图书馆](http://www.onlinegamegroup.com/projects/libstrophe)
*   [大嘴巴](http://www.loudmouth-project.org/)

### C++

*   [格劳克斯](http://camaya.net/gloox)
*   [鸢尾花](http://delta.affinix.com/iris/)
*   [瓦哈贝尔](http://www.openaether.org/oajabber.html)

### C#/.NET/单声道

*   [agsXMPP SDK](http://www.ag-software.de/index.php?page=agsxmpp-sdk)
*   [贾伯网](http://code.google.com/p/jabber-net/)

### 二郎

*   [贾伯朗](http://support.process-one.net/doc/display/CONTRIBS/Jabberlang)

### 闪光

*   [国际电影节](http://www.igniterealtime.org/projects/xiff/)

### 哈斯克尔

*   [hsxmpp](http://www.dtek.chalmers.se/~henoch/text/hsxmpp.html)

### 爪哇

*   [Echomine Feridian](http://freecode.com/projects/feridian)
*   [Jabber 流对象 (JSO)](http://java.net/projects/jso/)
*   [咂嘴](http://www.igniterealtime.org/projects/smack/index.jsp)

### JavaScript

*   [strophe.js](http://strophe.im/strophejs/)
*   [xmpp4js](http://xmpp4js.sourceforge.net/)

### 语言

*   [cl-xmpp](http://common-lisp.net/project/cl-xmpp/)

### Objective-C

*   [xmpp框架](http://code.google.com/p/xmppframework/)

### Perl

*   [任何事件::XMPP](http://www.ta-sa.org/projects/net_xmpp2.html)

### PHP

*   [打火机](https://area51.myyearbook.com/trac.cgi/wiki/Lightr)
*   [xmpphp](http://code.google.com/p/xmpphp/)

### Python

*   [jabber.py](http://jabberpy.sourceforge.net/)
*   [pyxmpp](http://pyxmpp.jajcus.net/)
*   [时尚XMPP](http://code.google.com/p/sleekxmpp/)
*   [扭曲的词](http://twistedmatrix.com/trac/)
*   [xmpp-psn](http://code.google.com/p/xmpp-psn/)
*   [xmpppy](http://xmpppy.sourceforge.net/)

### 红宝石

*   [XMPP4R](http://xmpp4r.github.io/)

### Tcl

*   [JabberLib](http://coccinella.im/jabberlib)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-03-11T17:52:17.913

我进行了同样的搜索。我首先尝试了 Smack，然后意识到它针对的是 c2s（客户端到服务器）并且没有我需要的东西。我查看了 Tinder，但不喜欢许可模型（当我看起来它更原始时）。我终于看着 Whack 并意识到这是我需要的——但它缺少很多（我认为这就是 Tinder 出现的原因）。

所以..我的解决方案？Forked Whack，添加了一些代码来抽象出东西，并尝试使其更易于使用：http: [//github.com/Communitivity/Adirondack](http://github.com/Communitivity/Adirondack)

我在此基础上编写了一个 Scala 库来帮助创建基于外部组件的代理，请参阅 [http://github.com/Communivity/Shellack](http://github.com/Communitivity/Shellack) 和[http://github.com/Communivity/MinimalScalaXMPPComponent](http://github.com/Communitivity/MinimalScalaXMPPComponent)

我的主要目标之一是让快速编写组件变得容易。此类组件的示例如下：

```
object Main {

/**
* @param args the command line arguments
*/
  def main(args: Array[String]) :Unit = {
      new XMPPComponent(
        new ComponentConfig() {
            def secret() : String = { "secret.goes.here" }
            def server() : String = { "communitivity.com" }
            def subdomain() : String = { "weather" }
            def name() : String = { "US Weather" }
            def description() : String = { "Weather component that also supported SPARQL/XMPP" }
        },
       actor {
        loop {
            react {
                case (pkt:Packet, out : Actor) =>
                    Console.println("Received packet...\n"+pkt.toXML)
                    pkt match {
                        case message:Message =>
                            val reply = new Message()
                            reply.setTo(message.getFrom())
                            reply.setFrom(message.getTo())
                            reply.setType(message.getType())
                            reply.setThread(message.getThread())
                            reply.setBody("Received '"+message.getBody()+"', tyvm")
                            out ! reply
                        case _ =>
                            Console.println("Received something other than Message")
                    }
                 case _ =>
                    Console.println("Received something other than (Packet, actor)")
            }
        }
       }
    ).start
  }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-07-16T13:05:20.763

Ignite Realtime 共享其[Tinder API](http://www.igniterealtime.org/projects/tinder/)，这是从 OpenFire 提取的基本构建块，仅用于创建服务器端组件和可能的其他服务器。它实现了基本的 XMPP 构建块，您可以从那里自由地开始。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-11-18T05:59:25.430

同样来自 Ignite Realtime 的是专门用于构建 XMPP 组件的[Whack API](http://www.igniterealtime.org/projects/whack/index.jsp)

> Whack 是一个用于 XMPP 组件的开源 XMPP (Jabber) 组件库。一个纯 Java 库，它可以嵌入到您的应用程序中，以创建从完整的 XMPP 组件到简单的 XMPP 集成（例如发送拦截和处理某些消息）的任何内容。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-07T23:01:52.140

您最好的选择是使用现有的服务器，并将您的功能添加到其中。从头开始编写整个服务器，即使使用库，也将比您预期的*要*困难得多。

你能告诉我们更多关于你试图解决的问题吗？然后，我们可以将您指向合适的服务器，并帮助您找到正确的插入位置。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-04-29T07:16:00.010

看一下这个：

这是一个较低级别的库。它处于孵化状态，似乎没有人在推动它。但它是一个很棒的 api，我希望它会进步。

[http://java.net/project/jso-jabber-stream-objects](http://java.net/project/jso-jabber-stream-objects)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-04-28T09:46:42.640

我认为您已经找到了正确的解决方案：**Openfire**

这不是商业解决方案。*它是一个基于 Mina 和 Jetty*的 XMPP 服务器，用 Java 编写，在 Apache 许可下发布。非常接近您的要求。虽然我知道您要求一个库，但为什么不使用一些稳定开发的开源软件，可以像 openfire 一样轻松扩展？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-11-29T15:37:07.990

我找到了一个很好的基于 Java 的 xmpp 服务器：[http ://www.tigase.org/](http://www.tigase.org/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-04-07T10:19:33.960

看看[Vorpal](https://oneminutedistraction.wordpress.com/2012/10/08/new-beginnings-again/)。它是一个实现 XEP-0114 协议的 Java EE 6 框架。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-11-12T16:22:17.357

我知道目的是在 OP 中构建一个小技巧。但是，如果有人对扩展它、端到端安全等感兴趣。我建议看看 Coversant 的 Soapbox。他们是我们的合作伙伴。我们在硬实时虚拟机环境 JamaicaVM 上使用 SMACK 与 Soapbox 进行通信。

此外，如果目的是与服务器应用程序通信，而不是重新实现 XMPP 服务器（例如 Soapbox），则可以使用 SMACK 客户端。它是 XMPP 服务器的客户端，但实际通信的实例可以通过 XMPP 服务器从客户端到客户端。

# winapi - 如何确定最佳线程堆栈大小？

> ID：177516
> 
> 赞同：5
> 
> 时间：2008-10-07T07:44:40.523
> 
> 标签：winapi, optimization, visual-c++, memory, stack

实际上，有两种大小：最初提交的和总保留的。

您使用静态分析还是动态分析？哪些工具？有哪些技巧？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T18:53:50.577

一种技术是使用已知值在 main 或线程 main 中绘制堆栈，然后在清理时从堆栈限制进行扫描，直到不再找到您的已知值。

您的堆栈端将被定义为一个符号，生成一个 .map 文件以确定堆栈限制及其符号名称。

此处讨论：[如何确定最大堆栈使用量？](https://stackoverflow.com/questions/389219)

# sql-server - SQL Server 2005 - 行大小对查询性能的影响？

> ID：177519
> 
> 赞同：4
> 
> 时间：2008-10-07T07:45:13.863
> 
> 标签：sql-server, performance

我试图通过搜索具有多行的表来获得一些额外的性能。我目前的推理是，如果我可以从搜索的表中丢弃一些很少使用的成员，从而减少行大小，那么当数据开始从内存溢出时，IO 应该会下降，从而带来好处。

有没有详细说明这种效果的好资源？有什么经验吗？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T08:06:21.247

如果 RDBMS 正在对行执行全表扫描，则调整行的大小只是一个主要问题，如果您的查询可以仅使用索引来选择行，那么行大小就不那么重要了（除非您返回一个非常大的数字返回实际结果的 IO 显着的行数）。

如果您正在对大量行进行全表扫描或部分扫描，因为您有不使用索引的谓词，那么行大小可能是一个主要因素。我记得的一个例子是，在一个大约 100,000,000 行的表上，将较大的“数据”列拆分为与用于查询的列不同的表，这导致某些查询的性能提高了一个数量级。

我只希望这在相对少数情况下是一个主要因素。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T08:05:16.647

我现在不知道您还试图提高性能，这对我来说似乎是在抓住稻草。这并不意味着它不是一种有效的方法。根据我的经验，好处可能很大。只是它通常与其他类型的优化相形见绌。

但是，您正在寻找的是 iostatistics。有几种方法可以收集它们。可以找到一个很好的介绍[-> 这里](http://www.novicksoftware.com/Articles/sql-server-io-statistics.htm)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T12:26:26.057

我要做的第一件事是确保您的索引已经重建；如果您正在处理大量数据并且无法重建索引（如果 SQL Server 2005 及更高版本，您可以执行在线重建而无需锁定所有人），请确保您的统计信息是最新的（稍后会详细介绍）。

如果您的数据库包含有代表性的数据，那么您可以通过执行以下操作对查询使用的读取次数（逻辑和物理）进行简单测量：

```
SET STATISTICS IO ON
GO

-- Execute your query here

SET STATISTICS IO OFF
GO 
```

在设置良好的数据库服务器上，应该很少或没有物理读取（高物理读取通常表明您的服务器需要更多 RAM）。你做了多少逻辑读？如果这个数字很高，那么您将需要考虑创建索引。下一步是运行查询并打开估计的执行计划，然后重新运行（先清除缓存）显示实际的执行计划。如果这些不同，则您的统计信息已过时。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T12:06:36.283

如果您对最小化读取数据时的 IO 感兴趣，则需要检查索引是否覆盖了查询。要最小化 IO，您应该选择包含在索引中的列或覆盖查询中使用的所有列的索引，这样优化器将从索引中读取数据，而永远不会从实际表行中读取数据。
如果您正在研究此类详细信息，您可能应该考虑升级硬件、更改控制器或添加更多磁盘以便为查询处理器提供更多磁盘主轴，从而允许 SQL 同时读取更多数据

SQL Server 磁盘 I/ O 经常是大多数系统中瓶颈的原因。I/O 子系统包括磁盘、磁盘控制器卡和系统总线。如果磁盘 I/O 一直很高，请考虑：

将一些数据库文件移动到其他磁盘或服务器。
使用速度更快的磁盘驱动器或廉价磁盘冗余阵列 (RAID) 设备。
向 RAID 阵列添加其他磁盘（如果已在使用）。
调整您的应用程序或数据库以减少磁盘访问操作。
考虑索引覆盖率、更好的索引和/或规范化。

Microsoft SQL Server 使用 Microsoft Windows I/O 调用来执行磁盘读取和写入。SQL Server 管理执行磁盘 I/O 的时间和方式，但 Windows 操作系统执行底层 I/O 操作。受 I/O 限制的应用程序和系统可能会保持磁盘始终处于活动状态。

不同的磁盘控制器和驱动程序使用不同的 CPU 时间来执行磁盘 I/O。高效的控制器和驱动程序使用更少的时间，为用户应用程序留出更多的处理时间并提高整体吞吐量。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-07T08:19:01.453

sql server 查询计划优化器是一个非常复杂的算法，决定使用什么索引或什么类型的扫描取决于许多因素，如查询输出列、可用索引、可用统计信息、列中数据值的统计分布、行数、和行大小。

因此，对您的问题的唯一有效答案是：这取决于:)

提供更多信息，例如您已经完成了什么样的优化，查询计划是什么样的，等等。

当然，当 sql server 决定做一个表 scna（如果可用的话，聚集索引扫描），你可以通过缩小行大小来降低 io 性能。但在这种情况下，您可以通过创建足够的索引（实际上是具有较小行大小的单独表）来显着提高性能。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-07T08:30:57.077

如果应用程序是事务性的，则查看表上正在使用的索引。在这种情况下，表分区不太可能有太大帮助。

如果您有数据仓库之类的东西，并且正在对大量数据进行聚合查询，那么您可能会从分区中获得一些好处。

如果您在两个不属于 1:M 关系的大表之间进行连接，则查询优化器可能必须分别解析每个表上的谓词，然后组合相对较大的中间结果集或运行慢速运算符，例如匹配一个的嵌套循环连接的一侧。在这种情况下，您可能会受益于触发器维护的非规范化表来执行搜索。我已经看到从几个大型应用程序的复杂屏幕的非规范化搜索表中获得了很好的结果。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-30T15:55:10.060

我认为你会先使用标准优化技术走得更远——检查你的执行计划、分析器跟踪等，看看你是否需要调整索引、创建统计数据等——在查看物理结构之前你的桌子。

# linq - 在 LINQ to ADO.net 数据服务查询中使用 Expand 的替代方法是什么？

> ID：177520
> 
> 赞同：5
> 
> 时间：2008-10-07T07:45:28.713
> 
> 标签：linq, entity-framework, lazy-loading, wcf-data-services

我想知道在执行 LINQ to ADO.net 数据服务查询时是否有任何替代方法可以使用 Expand 关键字。expand 方法确实为我提供了我感兴趣的数据，但它要求我提前了解我将要使用的所有子对象。我的绝对偏好是，当我访问这些子对象时，它们会为我延迟加载，但这看起来不是一个选项（我可以将此延迟加载添加到该子对象属性的 get 中，但它当我更新数据服务引用时被清除）。

有没有人对这种情况有任何建议/最佳实践/替代方案？谢谢。

===== 使用具有 MailingAddress 的成员的示例代码 =====

作品：

```
var me = (from m in ctx.Member.Expand("MailingAddress")
          where m.MemberID == 10000
          select m).First();
MessageBox.Show(me.MailingAddress.Street); 
```

会更喜欢（如果这然后加载MailingAddress，真的很喜欢）

```
var me = (from m in ctx.Member
          where m.MemberID == 10000
          select m).First();
MessageBox.Show(me.MailingAddress.Street); 
```

或者至少（注意：如果我在服务操作中作为 LINQ to Entities 这样做，则与 MailingAddressReference 类似的东西在服务器端工作）

```
var me = (from m in ctx.Member
          where m.MemberID == 10000
          select m).First();
if (!(me.MailingAddress.IsLoaded())) me.MailingAddress.Load()
MessageBox.Show(me.MailingAddress.Street); 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-10T03:27:33.630

通过 ADO.net Data Services 加载子对象似乎有两种选择：

## 急切加载

由 .Expand("[MemberVariableName]") 在 LINQ to Data Services 示例中完成

```
var me = (from m in ctx.Member.Expand("MailingAddress")          
         where m.MemberID == 10000          
         select m).First();
MessageBox.Show(me.MailingAddress.Street); 
```

## 延迟加载

通过在上下文上调用 .LoadProperty 并将其传递给应该延迟加载的变量和属性来完成。

```
var me = (from m in ctx.Member          
          where m.MemberID == 10000          
          select m).First();
ctx.LoadProperty(myMember, "MailingAddresses");
MessageBox.Show(me.MailingAddress.Street); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T13:18:10.413

借助 LINQ to Entities，您还可以使用[Include 方法](http://msdn.microsoft.com/en-us/library/bb896272.aspx)。您可以在声明之后但在执行之前将其应用于我，例如：

```
me = me.Include("MailingAddress"); 
```

# embedded - 我应该从哪里开始使用 HDL？

> ID：177532
> 
> 赞同：4
> 
> 时间：2008-10-07T07:57:46.987
> 
> 标签：embedded, verilog, vhdl, hdl

我是一名自学成才的嵌入式开发人员。我主要使用用 C 和 ASM 编写的 AVR，但我也涉足过其他系统。我希望转向更复杂的设备，如 CPLD 和 FPGA，但我不知道从哪里开始。所以我的一个半问题是：

1.  您更喜欢 VHDL 还是 Verilog，为什么？
2.  对于没有 HDL 经验的人开始学习这样的野兽，有什么好方法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-07T08:16:41.257

从 Xilinx 或 Altera（两大 FPGA 厂商）购买便宜的入门套件。Xilinx Spartan3 入门套件售价 200 美元。

我个人更喜欢VHDL。它是强类型的，并且具有比 Verilog 更高级的功能。VHDL 在欧洲更流行，而 Verilog 在美国占主导地位。

购买一本书（例如 Peter Ashendens The Designers Guide to VHDL）并开始在免费模拟器中模拟您的设计。Mentor Graphis 的 ModelSim 是一款不错的产品，并且有免费版本可用（仿真速度较慢）。

制作一些有趣的项目（迷你 cpu、vga 图形、合成器）并开始设计。在将您的设计放入硬件之前，请始终模拟并确保您的设计工作......

如果您没有数字电子学背景，也可以购买该主题的书籍。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-07T13:44:18.957

早在我从事 ASIC 设计工作的时候，它就在 verilog 中。在许多情况下，作为设计人员，您无法选择：用于 HDL 的 ASIC 综合工具要花费大量资金，而且公司只为一种“有福的”语言购买完整的工具链。我的雇主已经标准化了 verilog，所以这就是我们使用的。

FPGA 综合工具要便宜得多，因此作为 FPGA 设计人员，您可以更自由地选择您喜欢的语言和工具。

[verilog.net](http://www.verilog.net/free.html)上也有免费的 verilog 模拟器。

正如@kris 提到的，FPGA 入门板也是一个不错的选择。让您的 verilog 代码点亮板上的 LED 比屏幕上的模拟器波形更令人满意。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T10:10:50.887

另请查看[opencores.org](http://www.opencores.org/) - 有一些文章和大量的 Verilog 和 VHDL 开源代码可供您学习。

据我所知，VHDL vs Verilog 就像 Ruby vs Python 或 Java vs C# 一样虔诚。不同的人有自己的喜好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-10T08:36:57.390

看看这个网站： [http ://www.fpga4fun.com/](http://www.fpga4fun.com/)

使用简单工具的漂亮简单项目。几年前，我使用其中一个板构建了一个小型 VGA 显示系统，用作布告板。

再次查看该站点，我正在考虑购买 Xylo-LM 板，因为它具有 ARM 处理器以及 SDRAM 和 Xilinx Spartan 3e。

我之前使用的另一块板是 Charmed Labs 的 XPort 2。这插入了一个受到开源开发工具良好支持的 Gameboy Advance。

查看： [http ://www.charmedlabs.com/index.php?option=com_virtuemart&page=shop.browse&category_id=6&Itemid=43](http://www.charmedlabs.com/index.php?option=com_virtuemart&page=shop.browse&category_id=6&Itemid=43)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-07T13:54:49.810

要考虑的另一件事是，您是应该从学习 HDL 开始，还是从学习布尔逻辑、卡诺图、德摩根定理、门、在门中实现算术等开始。如果不这样做，编写不可综合的 HDL 很容易对底层硬件的外观有一个准确的心理模型。

[这本书](https://rads.stackoverflow.com/amzn/click/com/0077211642 "亚马逊")是我在本科时使用的那本书的 Verilog 版本，在我看来它做得很好。它从上面提到的材料开始，以及关于门的晶体管级实现的一些基本信息，然后向您介绍 HDL，并让您逐步构建更复杂的结构和行为硬件块。是的，我知道它非常昂贵，就像大多数大学教科书一样，但这是我能够在网上找到的信息之一，至少，严重不足。

一旦您准备好选择 HDL，我衷心推荐 Verilog（首先学习了 VHDL）。是的，VHDL 曾经比 Verilog 功能丰富得多，但是该语言的后续版本（Verilog 2001、Verilog 2005、SystemVerilog 等）已经精心挑选了大多数有趣的功能，并且有更强大的工具链支持如今，对于 Verilog 及其变体，除了它是美国使用的主要语言之外（根据我的经验，VHDL 仅在处理极端遗留块时在这里使用，并且在学术环境中，部分原因是提到的工具支持之前）。最后，一旦您学习了 HDL，您就可以在 SystemVerilog 中使用具有严格超集语法的硬件验证语言 (HVL)，为您节省大量的学习曲线。据我所知，VHDL 并非如此。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-07T18:45:16.447

Altera 和 Xilinx 在他们的免费工具集中内置了模拟器。它们是非常流行的 Mentor ModelSim 工具的有限版本。他们将处理您可能适合在 < 500 美元（美国）板上的设计尺寸。

对于 HDL 选择 V​​erilog 对于 C 就像 VHDL 对于 ADA 一样。所以 Verilog 更容易上手，但你也更容易犯错。检查您的模拟和编译警告以避免这些问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-25T12:12:35.877

1.  Verilog 2\. [http://www.opensparc.net/](http://www.opensparc.net/)

高温高压

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-07-04T06:58:01.950

Verilog 更容易学习和更简单的语法。它也是一种较新的语言。其次，大多数人使用verilog。VHDL 有许多数据类型，这给它一个学习曲线。一旦您了解了verilog，就可以更轻松地弥合与VHDL的差距。哦，verilog 中也有非常简洁的宏。我用它发明了一种语言。最后，您最终将能够进行混合语言硬件设计。我从 VHDL 开始，然后学习了 verilog，现在我是 pro verilog。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-10-21T16:38:09.637

一个学期前，我和你现在在同一条船上。我最喜欢的书是[这](https://rads.stackoverflow.com/amzn/click/com/0123704979)本书，因为它通过回顾数字逻辑来讨论 FPGA。它还显示了 VHDL 和 Verilog 代码的并排比较，因此，您无需选择人们可能会推动您使用的一种，而是可以从风格上学习您喜欢的一种。

至于 FPGA 本身，请使用 Xilinx 的[ISE webpack](http://www.xilinx.com/products/design-tools/ise-design-suite/ise-webpack.htm)进行编程（它是免费的），并从像[Basys2 FPGA board](http://www.digilentinc.com/Products/Detail.cfm?Prod=BASYS2)这样的 FPGA 开始。它是一个非常小的 FPGA，应该可以让您以较低的价格开始使用，但它还有一个额外的优势，即您可以很早地学习资源和内存管理。您可以使用 Digilent 的[Adept](http://www.digilentinc.com/Products/Detail.cfm?Prod=ADEPT2)（也是免费的）让您轻松地将“编译”代码上传到板上。

祝你好运！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-07-23T03:48:14.667

在深入研究 Verilog/VHDL 或购买 FPGA 开发套件之前，我建议参加数字设计入门课程。有很好的在线[OpenCourseWare MIT](http://ocw.mit.edu/OcwWeb/web/home/home/index.htm)课程。

祝你好运。

# javascript - 一种防止移动浏览器下载和显示图像的方法

> ID：177536
> 
> 赞同：0
> 
> 时间：2008-10-07T07:59:46.657
> 
> 标签：javascript, http-headers, mobile-website

有没有一种简单的方法可以防止浏览器下载和显示图像，最好是通过一些魔术样式标签或 javasctipe。

问题是，我想稍微调整一下公司的网站，使其更易于通过移动设备使用。该公司是一家游戏公司，它的主页上有大约 5MB 的图像（而且这些图像是无法触摸的）。他们已经在我的 dsl 上显示出非常慢的速度，对于按 MB 支付 GPRS 费用的人来说，他们可能是杀手；）

页面的代码不是我的，也不应该动（其实应该是从零开始写的，但现在不是我的姿态）：）

我在考虑两种解决方案：

1）如果有某种样式标签（或者可能是javascript？可以在移动浏览器上运行的标签）会阻止浏览器下载图像并强制显示alt参数，如果我可以简单地附加这种样式发现用户代理是一些已知的移动设备。或 2) 我可以稍微调整网络服务器以检查用户代理标头，如果客户端请求图像（.png、.gif 和 .jpg），则改为发送 404。这有一个缺点 - 如果他真的想要，我想允许用户查看图像。

似乎第一个解决方案是最好的——你们怎么看？有没有一种javascript方法可以做到这一点？

我可以尝试构建文档 DOM，然后获取所有`<img>`元素，并`src`用一些占位符替换它们，但这是否适用于大多数移动浏览器（我想是 Opera Mini，Windows Mobile 的东西，诺基亚的基本 Symbian 浏览器）？并且在移动设备上使用文档 DOM 会是一个很好的解决方案（老实说，我不确定它的内存和 cpu 要求）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T12:17:32.410

您可以使用 htaccess 重定向来自移动浏览器用户的图像请求。我没有对此进行测试，但它应该可以工作：

```
RewriteCond %{HTTP_USER_AGENT} (nokia¦symbian¦iphone¦blackberry) [NC] 
RewriteCond %{REQUEST_URI} !^/images/$
RewriteRule (.*) /blank.jpg [L] 
```

此代码将诺基亚、塞班、iphone 和黑莓对图像文件夹中文件的所有请求重定向到空白图像文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T08:09:41.520

我不会在移动浏览器中依赖 javascript 或任何其他客户端方法。大多数移动浏览器对 javascript 的支持不够好。

一些服务器端“分支”可能是要走的路。并且不要忘记在使用时禁用 css 背景图像。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T08:48:39.973

为什么不使用[替代样式表](http://www.howtocreate.co.uk/tutorials/css/mediatypes)？我只是不知道移动浏览器对它们的支持程度。

您可以为移动设备指定单独的 css：

```
<link rel="stylesheet" media="screen,projection,tv" href="main.css" type="text/css">
<link rel="stylesheet" media="handheld" href="smallscreen.css" type="text/css"> 
```

在那个 css 中，您覆盖`<img>`所有背景图片的显示。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-23T13:44:48.183

这就像欺骗您的用户代理。如果他们真的想要完整版，就给他们。也许向黑莓用户添加一个建议，向制造商抱怨缺少这样的选项。

# c# - 有机会在 C# 中模仿 times() Ruby 方法吗？

> ID：177538
> 
> 赞同：29
> 
> 时间：2008-10-07T08:01:17.997
> 
> 标签：c#, ruby, language-features, cycle

每次我需要在使用 C# 的算法中执行*N次操作时，我都会编写这段代码*

```
for (int i = 0; i < N; i++)
{
    ...
} 
```

学习 Ruby 我了解了方法*times()*可以与这样的相同语义一起使用

```
N.times do
    ...
end 
```

C# 中的代码片段看起来更复杂，我们应该声明无用的变量*i*。

我尝试编写返回*IEnumerable*的扩展方法，但我对结果不满意，因为我必须再次声明一个循环变量*i*。

```
public static class IntExtender
{
    public static IEnumerable Times(this int times)
    {
        for (int i = 0; i < times; i++)
            yield return true;
    }
}

...

foreach (var i in 5.Times())
{
    ...
} 
```

是否可以使用一些新的 C# 3.0 语言特性让*N*次循环更优雅？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-10-07T08:15:04.240

[cvk 回答](https://stackoverflow.com/questions/177538/any-chances-to-imitate-times-ruby-method-in-c#177551)的稍微简短的版本：

```
public static class Extensions
{
    public static void Times(this int count, Action action)
    {
        for (int i=0; i < count; i++)
        {
             action();
        }
    }

    public static void Times(this int count, Action<int> action)
    {
        for (int i=0; i < count; i++)
        {
             action(i);
        }
    }
} 
```

采用：

```
5.Times(() => Console.WriteLine("Hi"));
5.Times(i => Console.WriteLine("Index: {0}", i)); 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-07T08:09:51.923

C# 3.0 确实有可能：

```
public interface ILoopIterator
{
    void Do(Action action);
    void Do(Action<int> action);
}

private class LoopIterator : ILoopIterator
{
    private readonly int _start, _end;

    public LoopIterator(int count)
    {
        _start = 0;
        _end = count - 1;
    }

    public LoopIterator(int start, int end)
    {
        _start = start;
        _end = end;
    }  

    public void Do(Action action)
    {
        for (int i = _start; i <= _end; i++)
        {
            action();
        }
    }

    public void Do(Action<int> action)
    {
        for (int i = _start; i <= _end; i++)
        {
            action(i);
        }
    }
}

public static ILoopIterator Times(this int count)
{
    return new LoopIterator(count);
} 
```

用法：

```
int sum = 0;
5.Times().Do( i => 
    sum += i
); 
```

无耻地从[http://grabbagoft.blogspot.com/2007/10/ruby-style-loops-in-c-30.html窃取](http://grabbagoft.blogspot.com/2007/10/ruby-style-loops-in-c-30.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T08:12:18.753

如果您使用的是 .NET 3.5，那么您可以使用本文中提出的每个扩展方法，并使用它来避免经典循环。

```
public static class IEnumerableExtensions
  {
      public static void Each<T>(
        this IEnumerable<T> source,
        Action<T> action)
      {
          foreach(T item in source)
          {
              action(item);
          }
      }
  } 
```

> 这种特殊的扩展方法在任何实现 IEnumerable 的东西上点焊了 Each 方法。您知道这一点，因为此方法的第一个参数定义了 this 在方法主体中的内容。Action 是一个预定义的类，它基本上代表一个不返回值的函数（委托）。在方法内部，是从列表中提取元素的位置。这种方法使我能够在一行代码中干净地应用一个函数。

（[http://www.codeproject.com/KB/linq/linq-to-life.aspx](http://www.codeproject.com/KB/linq/linq-to-life.aspx)）

希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-12T15:59:44.407

我编写了自己的扩展，将 Times 添加到 Integer（以及其他一些内容）。您可以在此处获取代码：[https ://github.com/Razorclaw/Ext.NET](https://github.com/Razorclaw/Ext.NET)

该代码与 Jon Skeet 的答案非常相似：

```
public static class IntegerExtension
{
    public static void Times(this int n, Action<int> action)
    {
        if (action == null) throw new ArgumentNullException("action");

        for (int i = 0; i < n; ++i)
        {
            action(i);
        }
    }
} 
```

# sql-server - 如何估计 SQL Server 索引大小

> ID：177550
> 
> 赞同：4
> 
> 时间：2008-10-07T08:09:41.613
> 
> 标签：sql-server, indexing, capacity-planning

虽然估计直线行和表大小是相当简单的数学运算，但我们发现猜测每个索引将占用多少空间（对于给定的表大小）具有挑战性。我们可以学习哪些领域来计算指数的更好估计和增长率？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-07T08:24:59.460

索引叶有一个前导码，用于标识数据页（7 个字节加上一些用于可变长度列的目录信息，如果有的话）加上一个键值的副本，该副本与这些列的表数据大小相同。表中的每一行都有一个。索引的较高级别要小得多，通常不到叶子的 1%，除非您正在索引一个非常宽的键。

填充因子留出一些空间，以便更新和插入不会产生过多的叶子分裂流量。

编辑：[这个 MSDN 链接](http://msdn.microsoft.com/en-us/library/ms189051.aspx)描述了页面级结构，尽管它对单个索引行的格式有点轻。 [该演示](https://www.blackhat.com/presentations/bh-usa-07/Fowler/Presentation/bh-usa-07-fowler.pdf)在某种程度上涉及磁盘日志条目和数据页的物理格式。 [这是一个](http://www.valdosta.edu/~sfares/cs499/cs499.d.chapter11.a.wi8.html)更详细的信息，包括索引数据结构。数字列和固定长度列的大小与盒子上说的一样；您将不得不估计 varchar 列的平均大小。

作为参考，可以在[此处](http://www.orafaq.com/papers/dissassembling_the_data_block.pdf)和[此处](http://download.oracle.com/docs/cd/B10501_01/server.920/a96524/c03block.htm#2595)找到有关 Oracle 块格式的一些文档。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-05-23T13:08:36.660

如果可能的话，我通常会从原始表中取出 1000 条记录，将它们插入到我自己的表中，并使用下面的脚本来制作一个示例。

好的，这不准确，但可以给我一个起点。

```
--Find out the disk size of an index:
--USE [DB NAME HERE]
go
SELECT
OBJECT_NAME(I.OBJECT_ID) AS TableName,
I.name AS IndexName,   
8 * SUM(AU.used_pages) AS 'Index size (KB)',
CAST(8 * SUM(AU.used_pages) / 1024.0 AS DECIMAL(18,2)) AS 'Index size (MB)'
FROM
sys.indexes I
JOIN sys.partitions P ON P.OBJECT_ID = I.OBJECT_ID AND P.index_id = I.index_id
JOIN sys.allocation_units AU ON AU.container_id = P.partition_id
--WHERE 
--    OBJECT_NAME(I.OBJECT_ID) = '<TableName>'    
GROUP BY
I.OBJECT_ID,    
I.name
ORDER BY
TableName

--========================================================================================

--http://msdn.microsoft.com/en-us/library/fooec9de780-68fd-4551-b70b-2d3ab3709b3e.aspx

--I believe that keeping the GROUP BY 
--is the best option in this case
--because of sys.allocation_units
--can have 4 types of data inside
--as below:

--type tinyint
--Type of allocation unit.
--0 = Dropped
--1 = In-row data (all data types, except LOB data types)
--2 = Large object (LOB) data (text, ntext, image, xml, large value types, and CLR     user-defined types)
--3 = Row-overflow data

--marcelo miorelli 8-NOV-2013
--======================================================================================== 
```

# visual-studio-2008 - 如何卸载带有 .Net 3.5 SP1 的 Visual Studio 2008 SP1？

> ID：177553
> 
> 赞同：5
> 
> 时间：2008-10-07T08:10:51.407
> 
> 标签：visual-studio-2008, .net-3.5

卸载 SP1 并使用 Visual Studio 2008 返回普通 .Net 3.5 的最佳方法是什么？它破坏了我的一些程序:(

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-07T14:21:38.930

如果您选中“显示更新”框，它应该在添加/删除程序中可见。

[此链接](http://download.microsoft.com/download/8/F/D/8FD2A9F0-C3D4-4B0A-80AF-88D738DCDDF4/VSReadme.htm#Uninstalling)列出了需要为 SP1 Beta 卸载的一系列更新。最终 RTM 版本的卸载可能与此类似。（我现在没有VS2008在我面前，所以直到今晚我才能确认）。

# regex - 获取正则表达式的算法

> ID：177558
> 
> 赞同：3
> 
> 时间：2008-10-07T08:13:31.917
> 
> 标签：regex

我想到了这样的事情：我输入了一个或几个字符串，算法向我显示了一个匹配的正则表达式。

有没有一种“*简单*”的方法可以做到这一点，或者这样的事情已经存在？

***编辑1***：是的，我正在尝试找到一种生成正则表达式的方法。

***编辑 2***：Regulazy 不是我想要的。我想要的代码的常见用途是找到正确的正则表达式；例如，货号：

*   我输入*123456*，正则表达式应该是`\d{6}`
*   我输入*nb-123456*，正则表达式应该是`\w{2}-\d{6}`

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T08:26:16.760

如果你有 Emacs，你可以使用`regexp-opt`. 例如，评估：

```
(regexp-opt (list "my" "list" "of" "some" "strings" "to" "search")) 
```

返回

```
"list\\|my\\|of\\|s\\(?:earch\\|ome\\|trings\\)\\|to" 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T08:19:41.187

听起来您想要一种算法来根据一些样本生成常规语法。在很多情况下，对于给定的一组示例，有许多可能的语法——甚至可能有无限种可能的语法。当然，可能性可以通过第二组所需的**不**匹配来限制，如果不匹配的字符串太包含，这可以将其限制为零可能性。

**[txt2re](http://txt2re.com/)**做这样的事情。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T08:30:20.823

Perl 可以做到：[http ://www.hakank.org/makeregex/](http://www.hakank.org/makeregex/)

红宝石也是如此：[http ://www.toolbox-mag.de/data/makeregex.html](http://www.toolbox-mag.de/data/makeregex.html)

注意：不是那么完美的解决方案。

还有一个 CLI 工具：[txt2regex](http://txt2regex.sourceforge.net/)。

有[txt2re，从前](http://209.85.135.104/search?q=cache:0govuS1Vj8EJ:txt2re.com/+txt2re&hl=hu&ct=clnk&cd=1&gl=hu)...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T08:22:01.103

以下怎么样（匹配每个字符串）？

.*

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-07T08:26:22.890

我认为 Roy Osherove 的 Regulazy 在一定程度上做到了这一点，或者它可能是 Regulator。两者都在此页面上：

[http://weblogs.asp.net/rosherove/pages/tools-and-frameworks-by-roy-osherove.aspx](http://weblogs.asp.net/rosherove/pages/tools-and-frameworks-by-roy-osherove.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T08:31:16.657

如果您的输入字符串不是随机字符串并且它们基于某些规则，则通过使用解析器（即 jflex），您可以创建一个正则表达式生成器，它将生成一个正则表达式 wrt 给定的字符串。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-24T09:54:03.190

看看[txt2re](http://txt2re.com)。

该站点包含一个表单，该表单采用示例字符串并生成可以匹配给定字符串的正则表达式模式。

然后它为以下语言生成相应的脚本：Perl、PHP、Python、Java、Javascript、ColdFusion、C、C++ Ruby、VB、VBScript、J#.net、C#.net、C++.net、VB.net

# c++ - 摆脱 ShellExecute 造成的邪恶延迟

> ID：177559
> 
> 赞同：5
> 
> 时间：2008-10-07T08:13:55.007
> 
> 标签：c++, winapi, shellexecute

这是困扰我一段时间的事情，必须有一个解决方案。每次我调用 ShellExecute 打开一个外部文件（无论是文档、可执行文件还是 URL）时，都会在 ShellExecute 生成新进程并返回之前在我的程序中造成很长时间的锁定。有谁知道如何解决或解决这个问题？

编辑：正如标签所示，这是在使用 C++ 的 Win32 上。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-07T08:19:36.070

我不知道是什么原因造成的，但 Mark Russinovich（以 sysinternal 闻名）有一个非常棒的博客，他解释了如何调试这些东西。[The Case of the Delayed Windows Vista File Open Dialogs](http://blogs.technet.com/markrussinovich/archive/2006/11/27/532465.aspx)对您来说是一个不错的选择，他仅使用进程资源管理器调试了一个类似的问题（事实证明这是访问域的问题）。您当然可以使用常规的 Windows 调试器来做类似的事情。

你的问题可能和他的不一样，但是使用这些技术可以帮助你更接近问题的根源。我建议调用该`CreateProcess`调用，然后捕获一些堆栈跟踪并查看它似乎挂起的位置。

[流程启动延迟的案例](http://blogs.technet.com/markrussinovich/archive/2006/08/31/453100.aspx)可能与您更相关。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T22:39:29.597

你是多线程的吗？

我已经看到使用 ShellExecute 打开文件的问题。不是可执行文件，而是与应用程序相关的文件 - 通常是 MS Office。使用 DDE 打开其文件的应用程序向所有线程（好吧，我不知道是否*全部*...）程序进行了一些消息广播。因为我没有在我的应用程序的工作线程中发送消息，所以我会挂起 shell（以及文件的打开）一段时间。它最终超时等待我处理消息，应用程序将启动并打开文件。

我记得在循环中使用 PeekMessage 来删除该工作线程队列中的消息。我一直认为有办法以另一种方式避免这种情况，也许以不同的方式创建线程，以免成为消息的目标？

* * *

**更新** 它一定不仅仅是任何线程在做这件事，而是一个服务窗口的线程。***Raymond [（链接 1）](http://blogs.msdn.com/oldnewthing/archive/2006/02/10/529525.aspx)无所不知[（链接 2）](http://blogs.msdn.com/oldnewthing/archive/2005/06/27/432303.aspx)***。我打赌 CoInitialize（单线程单元）或 MFC 中的某些东西为线程创建了一个隐藏窗口。

# .net - 应用程序从远程文件夹启动时引发 SecurityException

> ID：177560
> 
> 赞同：3
> 
> 时间：2008-10-07T08:15:03.473
> 
> 标签：.net, security

我有一个用 C# 编写的应用程序，它位于网络共享上。当我从本地驱动器运行它时，一切正常。当我从远程共享启动它时，调用如下

```
try
{
    System.Reflection.Assembly.GetExecutingAssembly();
    System.IO.Directory.GetCurrentDirectory();
} 
```

抛出 SecurityException '请求失败'。

是什么原因造成的，在本地启动的应用程序和从远程位置启动的应用程序有什么区别？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T08:22:39.043

这是由于[CAS](http://msdn.microsoft.com/en-us/library/930b76w0.aspx) ; 从本地机器开始的代码比 Intranet 中的代码更受信任，而 Intranet 反过来更信任来自 Internet 的代码。

*IIRC，如果您已经映射*了受信任的共享（即作为 F:），则使用最新的 SP（3.5SP1？） ；否则，您将需要：

a: 对所有客户端应用[caspol](http://msdn.microsoft.com/en-us/library/cb6t8dtz(VS.80).aspx)更改 (yeuck)

b：使用[ClickOnce](http://msdn.microsoft.com/en-us/library/t71a733d(VS.80).aspx)部署应用程序，然后运行 ​​.application（耶！）

关键是 ClickOnce 允许您签署应用程序并声明您的安全策略（即使您要求完全信任）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T08:36:14.617

由于您的应用程序是在共享驱动器上启动的，因此适用不同的执行安全策略。

这意味着要了解 .NET 代码访问安全性是如何工作的。

[http://msdn.microsoft.com/en-us/library/aa302422.aspx](http://msdn.microsoft.com/en-us/library/aa302422.aspx)

一个快速而肮脏的解决方案包括转到 .NET Framework Configuration，展开 RunTime Security Policy，展开 Machine，然后是 Code Groups，然后是 LocalIntranet Zone，右键单击它，选择 Properties，然后将 Permission Set 更改为 FullTrust。

这将允许 Intranet 区域中的应用程序（包括从共享网络运行的应用程序）以完全受信任的方式运行。

**这绝对不是推荐的做法**。最好的办法是了解 .NET 代码访问安全性是如何工作的，并根据您的应用程序需求应用特定的安全策略。

例如，您可以通过签名为您的应用程序提供一个强名称，使用公钥定义一个新的代码组，并对该代码组应用完全受信任的权限。然后，您可以使用相同的公钥签署所有“已批准”的应用程序，因此适用相同的代码访问安全策略。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T20:49:01.813

他们在 .Net Framework 3.5 SP1 中对此进行了一定程度的更改。请参阅[.NET 3.5 SP1 从网络共享运行托管应用程序](http://www.infoq.com/news/2008/08/.NET-3.5-SP1-Runs-Managed-Code)

# php - 为什么 Eclipse 代码完成在某些项目上不起 作用？

> ID：177569
> 
> 赞同：24
> 
> 时间：2008-10-07T08:18:52.360
> 
> 标签：php, eclipse, eclipse-pdt, eclipse-3.3

我有带有 PDT 的 Eclipse 3.3.2 进行 PHP 开发。我创建的所有项目，甚至 SVN 项目都有代码完成。现在我刚刚打开了另一个 SVN 项目，它没有代码完成或 PHP 模板（CTRL-space 在该项目中没有任何作用）。但是，我可以打开其他项目和代码完成所有工作。

为什么代码完成和模板仅在一个项目中“关闭”，我该如何重新打开它？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-10-07T08:29:17.033

也许 Eclipse 不理解该项目具有“PHP 特性”。尝试比较两个项目的 .project 文件以查找差异。它应该包含以下内容：

```
 <natures>
  <nature>org.eclipse.php.core.PHPNature</nature>
 </natures> 
```

.project 文件将位于项目目录下的工作区中。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-22T11:05:27.790

在你的项目中寻找文件 .buildpath ......把这一行放在标签之间：

`<buildpathentry kind="con" path="org.eclipse.php.core.LANGUAGE"/>`

保存并重新启动eclipse。现在一切都应该没问题...这对我有用。:)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-16T16:00:37.777

谢谢！我花了一整天的时间来弄清楚为什么我没有代码完成......

问题是，如果您创建一个 SVN 项目，.project 是一个没有代码完成参考的基本文件。您必须创建一个基本的 PHP 项目并比较两个文件并替换 SVN 项目中缺少的部分之一。

现在我对项目中的每个文件都有代码完成，即使是 Zend Framework 库

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-01-20T09:15:56.107

只需在 .project 文件中添加一行，然后重新启动 eclipse 即可获得代码完成：它说的位置

```
---
 <natures>
 </natures>
--- 
```

改变后必须是

```
---
 <natures>
  <nature>org.eclipse.php.core.PHPNature</nature>
 </natures>
--- 
```

应该这样做。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-03-18T09:17:03.917

@Guido PHPNature 没有解决这个问题。

@Edward Tanguay 是的，那是因为当您创建新的 PHP 项目时，eclipse 添加了 .buildpath 文件

```
<?xml version="1.0" encoding="UTF-8"?><buildpath>
<buildpathentry kind="src" path=""/>
<buildpathentry kind="con" path="org.eclipse.php.core.LANGUAGE"/></buildpath> 
```

当您导入现有项目时，eclipse 不会生成 .buildpath 文件，但您可以手动添加它或使用现有源创建新的 PHP 项目（您可以在向导中选择）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-07T11:12:49.607

我有时也有同样的问题。对我来说，它可以使用“Project”->“Clean”重建 PHP 项目。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-11-07T17:27:56.950

如果您遇到此问题，请按照以下步骤操作：

*   在项目树中选择“PHP 包含路径”
*   右键单击它，然后单击“构建路径>配置构建路径”
*   在打开的窗口中，添加您要构建的文件夹，以便它可以进行代码辅助。

就是这样:)我希望它能解决你的问题，我解决了我的问题:)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-07T08:54:12.460

确保文件使用“PHP 编辑器”打开。右键单击该文件，然后选择*打开方式*以选择正确的编辑器。

如果事实证明您一直在使用错误的编辑器，您可以在*Preferences » General » Content Types下更改关联*

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-11T19:35:42.567

右键单击编辑屏幕，转到 Java -> Editor -> Content Assist -> Advanced ...选择相应的提案

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-08-16T13:21:42.957

注意力

除了已经提到的使整个自动完成帮助工作的解决方案之外，还有另一个怪癖：它可能未启用。

转到 Window > Properties，然后转到 PHP > Editor > Code Assist（JAVA 有类似的选项）并设置“启用自动激活”，最好有一个您认为合适的延迟（0 毫秒）。如果您对程序突然决定在没有提示的情况下为您做事（并且做错了）感到困扰，请取消选择“自动插入单个提案”，您应该会没事的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-07T14:36:10.337

我有时注意到，当您在 Eclipse 中从 svn 签出项目时（颠覆或 subscipe“签出项目为”），即使您将其签出为 php 项目，它也会删除 .project 文件，或者它将是一个通用文件项目。我发现只需进入该目录并删除 .project .settings/ 和 .cach/

然后创建一个新的 php 项目并指向您签出文件的目录。你应该有代码完成和 svn 应该链接到你的 repo。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-28T22:13:56.710

我遇到了构建路径为空的问题，因此我尝试编辑的任何文件都没有代码完成。确保正确设置构建路径，尤其是在从工作区以外的其他位置链接源代码时。

例如 apache htdocs 文件夹。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-12-11T18:07:32.120

我通过启用完整的 C/C++ 索引器（Windows-> 属性 -> C/C++ -> 索引器）解决了这个问题，还点击了单选按钮“使用活动按钮配置”。之后清理并构建所有内容。

这适用于 Eclipse CDT 3.4

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-03-03T19:21:43.180

如果您来这里是在 php eclipse 中寻找代码补全不起作用，请确保您的项目作为 php 项目被支持。右键单击项目，然后转到配置 -> 添加 php 支持。如果您有正确的代码辅助设置，它应该可以立即工作。有时像我这样的新手会调整项目或启动项目时干净而不是 php，所以 eclipse 不知道如何处理项目。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-02-22T10:33:02.480

我必须在 PHP Explorer 中右键单击该项目，转到“PHP Build Path”。这是空的。我单击“添加文件夹”，选中项目根文件夹旁边的复选框，然后单击“确定”，然后再次单击“确定”。

在那之后，代码完成似乎工作了。如果你问我，应该开箱即用，但无论如何。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-04-27T11:52:23.227

检查项目的库。可能是您包含了两个这样的 jar 文件，其中相同的类可用，或者说代码中的一个类可以在两个 jar 文件中引用。在这种情况下，eclipse 也会停止辅助代码，因为它完全被混淆了。

更好的检查方法是转到辅助不起作用的文件并在其中注释所有导入，而不是逐个添加导入并在每次导入时检查代码辅助是否正常工作。您可以轻松找到具有重复引用的类.

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-10-07T11:50:34.337

一种解决方案可能是包含一个需要所有 PHP 类的虚拟 php 文件。这样 PHP 解析器也能识别这些类。示例虚拟文件：

```
if(false) {
     require_once 'class/one.php';
     require_once 'class/two.php';
     require_once 'class/three.php';
} 
```

# kvm - 如何配置协同以使用多个 X11 屏幕（：0、：1、...）？

> ID：177582
> 
> 赞同：1
> 
> 时间：2008-10-07T08:23:42.770
> 
> 标签：kvm

为多台计算机配置协同，每台计算机都有一个屏幕，相当容易。但是如何配置多个 X11 屏幕就不是那么明显了。例如 sys1，minimac 就在右边。sys1 是服务器，有一个监视器（屏幕）。sys1 的左侧是一个 Fedora 9 系统 sys2，有两个 X11 显示器：sys2:0.0 和 sys2:0.1 我猜有人发明了名称并使用指定端口的别名（在我的例子中为 5900 和 5901），即我将调查的途径。但肯定有人曾经穿过这座桥。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T09:35:54.950

[我在这里](http://www.gentoo.org/news/en/gwn/20070910-newsletter.xml)找到了基本答案。这是此示例的配置文件：

```
section: screens
  sys1
  sys2
  sys21
end

section: links
  sys1:
    left = sys21
  sys2:
    left = sys2
    right = sys1
  sys21:
    right = sys21
end 
```

基本上是你所需要的。然后，按如下方式启动协同程序：

在服务器 (sys1) 上：

```
$ synergys -f --config synergy.conf --name sys1 
```

在客户端，显示 :0.0

```
$ synergyc -f -n sys2 sys1 
```

在客户端，显示：0.1

```
$ synergyc -f -n sys21 sys1 
```

你走开...

# windows-services - 从与用户桌面交互的 Windows 服务运行 exe

> ID：177588
> 
> 赞同：0
> 
> 时间：2008-10-07T08:25:35.623
> 
> 标签：windows-services

我在 C# 和 Windows Server 2003 中创建了一个 Windows 服务。我希望我的服务能够运行一个 Windows 窗体应用程序的 exe 文件。当我启动服务时 - 它运行另一个应用程序，但我看不到它。当我打开任务管理器时 - 我可以看到应用程序正在运行，但我只是看不到它。我检查了“允许服务与桌面交互”，但没有任何反应。请帮忙。是否可以从 Windows 服务中运行和 exe 并查看在 widnows server 2003 中运行的 exe？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T09:14:06.337

从 Windows 服务显示 UI 是非常有问题的，因为该服务可能运行在与用户不同的桌面上（并且在 Vista/Server 2008 上实际上总是运行在不同的桌面上）。

最简单的解决方案是不直接从服务运行 UI，而是从运行在用户桌面上的应用程序（可能设置为在登录时运行）以某种方式与服务通信。

只要记住：

1.  可能没有登录用户
2.  可能有多个登录用户使用快速用户切换或远程桌面
3.  用户桌面上的应用程序在用户的安全上下文中运行，而不是在服务的

# sql - Web 应用程序应该使用显式 SQL 事务吗？

> ID：177597
> 
> 赞同：7
> 
> 时间：2008-10-07T08:28:25.507
> 
> 标签：sql, web-applications, transactions

考虑一个常规的 Web 应用程序，主要通过 SQL 数据库执行基于表单的 CRUD 操作。在这样的 Web 应用程序中是否应该有明确的事务管理？还是应该简单地使用自动提交模式？如果进行交易，“每个请求的交易”是否足够？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-07T08:48:00.477

**我只会在你做的事情实际上是事务性的时候使用显式事务**，例如，发出几个高度相关的 SQL 命令。我想这方面的经典例子是银行应用程序——从一个账户取款并将其存入另一个账户必须始终成批成功或失败，否则有人会被敲诈！

我们在 SO 上使用事务，但只是很少使用。我们的大多数数据库更新都是独立的和原子的。很少有人具有上述银行示例的属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T08:48:30.397

我*强烈*建议使用事务模式来保护数据完整性，因为自动提交模式会导致部分数据保存。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T15:26:57.707

这通常在数据库接口层为我处理 - Web 应用程序很少在事务中调用多个存储过程。它通常调用一个存储过程来管理整个事务，因此 Web 应用程序只需要担心它是否会失败。

通常，Web 应用程序不允许访问其他事物（表、视图、内部存储过程），如果在尝试之前未将它们包装在客户端在连接级别启动的事务中，这可能会使数据库处于无效状态到他们的电话。

在 Web 应用程序启动事务的情况下也有例外，但它们通常很少而且相差甚远。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T08:38:23.100

这取决于如何完成 CRUD 处理，**当且仅当**模型实例的所有创建和修改都在单个更新或插入查询中进行时，您才能使用自动提交。

如果您在多个查询模式下处理 CRUD（一个坏主意，IMO），那么您当然应该明确定义事务，因为这些查询肯定是“事务相关的”，您不希望在数据库中以半模型结束. 这是相关的，因为一些 Web 框架出于各种原因倾向于以“多重查询”的方式做事。

至于使用哪种事务模式，这取决于您在数据视图方面可以支持什么（即，当客户看到数据时需要多最新的数据）以及在性能方面您必须支持什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T08:30:41.290

您应该使用事务，因为不同的用户将同时访问数据库。我建议您不要*使用*自动提交。使用显式事务括号。至于每笔交易的解决方案，您应该将特定的工作单元括起来（无论这在您的上下文中意味着什么）。

您可能还想查看 SQL 数据库支持的不同事务隔离级别。他们将根据阅读用户看到的部分更新记录提供一系列行为。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-06-13T21:39:44.550

最好在单个存储过程中插入/更新到多个表中。这样，就无需从 Web 应用程序管理事务。

# cross-platform - 跨平台构建环境

> ID：177604
> 
> 赞同：7
> 
> 时间：2008-10-07T08:29:52.167
> 
> 标签：cross-platform, build-automation, build-environment

作为优秀的开发人员，我们尽可能保持代码符合标准，以帮助在平台之间进行移植。但是有哪些工具可以帮助我们以统一的方式跨多个平台构建代码。

*nix 家族有`make`但 Windows 需要`nmake`。

我读过关于[SCons](http://www.scons.org)的文章，但从未在愤怒中使用它。你最喜欢的构建工具是什么，为什么你觉得它有效，是否有任何限制（**即**支持不良的平台等）。

跨平台 IDE 也是如此。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T08:34:10.410

我个人使用 ant、rake 和 maven2。我最常使用 ant 并发现它很棒有几个原因：

*   因为它是 java 它适用于许多平台（无需更改任何脚本）

*   构建文件是用 XML 编写的，并且相当容易编写

*   有很多可用的 3rd 方扩展，并且很容易为它编写插件

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-07T08:39:14.737

c/c++ 环境的 cmake 很好。[http://www.cmake.org/](http://www.cmake.org/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-08T13:11:00.913

我们做极端交叉开发，我们的代码运行在 linux、windows ce、windows 2K、nucleus 和 uCOS-II 上。因为每个环境都使用不同的“make”方法（例如，外核客户要求我们通过 code-warrior GUI 进行编译）。

我将 ANT 与 perl 结合使用了大约 2 年，但这导致构建脚本完全不可维护。

现在我们开始使用 python，这增加了脚本的可维护性。

归根结底，我没有找到现成的工具，不得不自己构建。也许，当我有时间（2017 年？）时，我会打包我的脚本并分发它们....

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T08:36:23.150

如果您在 Java 世界中，那么有很多工具是跨平台的。Apache Ant 和 Maven 都是构建工具，可以在任何支持 Java 的平台上运行。

Cruise Control（持续集成工具）也适用于 Windows 和 Linux（它也是用 Java 编写的）。

我对核心工具没有任何真正的问题，我有时遇到的唯一问题来自构建过程之外的东西，即发布工件 - 这会因系统而异，所以我发现没有单一的方法设置它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-05T18:21:40.047

对于 C/C++ 开发，我发现[bakefile](http://www.bakefile.org)运行良好。相当大的[wxWidgets](http://www.wxwidgets.org/)项目，一个跨平台的跨平台实用程序和 UI 库，使用它来生成构建文件。

> Bakefile 是跨平台、跨编译器的原生 makefile 生成器。它将编译任务的独立于编译器的描述作为输入并生成本机 makefile（autoconf 的 Makefile.in、Visual C++ 项目、bcc makefile 等）。
> 
> Bakefile 的任务是生成本机 makefile，以便人们可以继续使用他们喜欢的工具。还有其他跨平台的 make 解决方案，但它们不是原生的，需要用户使用不熟悉的工具（Boost.Build），或者它们太有限（qmake）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-19T08:06:26.397

你可以在 Windows 上使用 gmake 以及 cygwin/minGW 或在 Linux 上构建你的 windows 东西。 [http://cdtdoug.blogspot.com/2009/05/mingw-cross-for-linux.html](http://cdtdoug.blogspot.com/2009/05/mingw-cross-for-linux.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-19T08:28:15.010

有像 Opus Make 或 MKS Toolkit 这样的工具提供多平台和支持。如果您有一个现有的 make 脚本代码库，则可以更容易地迁移到其中之一。我怀疑你可能会在 DDJ 杂志的广告中寻找类似的工具。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-19T08:36:00.080

在过去的 18 个月里，我们一直在为 Linux、Windows 和 Mac 运行 Java 环境。

*   Maven 2 驱动我们的构建，在这里很容易使事情保持一致。M2插件不敢涉足的地方，我们使用小Ant脚本。
*   IDE 方面，我们使用的是 Eclipse 和 IDEA——当然，两者都是多平台的。
*   测试——JUnit、Fitnesse、Fest——都是多平台的。
*   发布脚本是用 Ruby 编写的。这里的 Windows 有点麻烦，但是根据需要转换路径的功能通常可以解决问题。
*   TeamCity 执行 CI。我们实际上已经将它从 Windows 迁移到 Linux 并且完全没有遇到任何错误，非常好的包。

我们确实使用了 GWT 一段时间，这确实给我们带来了很大的痛苦。如果你那样摆动，要小心。

# ruby - Windows上的Ruby网络问题

> ID：177606
> 
> 赞同：0
> 
> 时间：2008-10-07T08:30:06.737
> 
> 标签：ruby

我正在运行带有 ruby​​ 1.8.6 补丁级别 111 的 Windows XP。我正在使用 HTTP 连接到远程服务器并且它运行良好。突然之间，它开始出现下面列出的异常（自上次成功运行以来，我没有更改任何代码）。有人知道发生了什么吗？

```
c:/ruby/lib/ruby/1.8/timeout.rb:54:in `rbuf_fill': 执行过期（Timeout::E
错误）  
        来自 c:/ruby/lib/ruby/1.8/timeout.rb:56:in `timeout'  
        来自 c:/ruby/lib/ruby/1.8/timeout.rb:76:in `timeout'  
        来自 c:/ruby/lib/ruby/1.8/net/protocol.rb:132:in `rbuf_fill'  
        来自 c:/ruby/lib/ruby/1.8/net/protocol.rb:116:in `readuntil'  
        来自 c:/ruby/lib/ruby/1.8/net/protocol.rb:126:in `readline'  
        来自 c:/ruby/lib/ruby/1.8/net/http.rb:2029:in `read_status_line'  
        来自 c:/ruby/lib/ruby/1.8/net/http.rb:2018:in `read_new'  
        来自 c:/ruby/lib/ruby/1.8/net/http.rb:1059:in `request'  
         ... 19 级...  
        来自 c:/ruby/lib/ruby/1.8/test/unit/autorunner.rb:216:in `run'  
        来自 c:/ruby/lib/ruby/1.8/test/unit/autorunner.rb:12:in `run'  
        来自 c:/ruby/lib/ruby/1.8/test/unit.rb:278  
        来自 c:/ruby/lib/ruby/gems/1.8/gems/rake-0.8.3/lib/rake/rake_test_loader
.rb:5  
耙中止！  
命令失败，状态 (3)：[c:/ruby/bin/ruby -Ilib;test "c:/ruby/lib/r...]

```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T08:48:56.933

也许远程主机已关闭？还是在您的机器和远程主机之间放置了新的防火墙？

“Timeout::Error”通常指向那个方向。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T17:21:39.097

除了明显的（防火墙，您因不良用户代理或忽略 robots.txt 而被列入黑名单），您可以尝试 curl

[http://curl.haxx.se/libcurl/ruby/](http://curl.haxx.se/libcurl/ruby/)

或者增加 net/http 超时时间，30+ 秒

[http://groups.google.com/group/rubyonrails-talk/msg/cc89e8ae6703d6fb](http://groups.google.com/group/rubyonrails-talk/msg/cc89e8ae6703d6fb)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-19T23:03:36.780

它可能与这个已知的 Ruby 错误有关，其中 Timeout::Error 不是 Exception 的子类。（我相信在 1.9.2 中已修复）

[http://lindsaar.net/2007/12/9/rbuf_filltimeout-error](http://lindsaar.net/2007/12/9/rbuf_filltimeout-error)

它可以通过从 Timeout::Error 中抢救来修复，例如`rescue Timeout::Error => e`

# java - 是否可以使用 ant 自动创建 inno 安装包？

> ID：177611
> 
> 赞同：4
> 
> 时间：2008-10-07T08:30:48.467
> 
> 标签：java, eclipse, inno-setup, rcp

我正在创建一个 Eclipse RCP 应用程序。

我在以下文章“每日构建是你的朋友”中遵循 Joel 的建议：

[http://www.joelonsoftware.com/articles/fog0000000023.html](http://www.joelonsoftware.com/articles/fog0000000023.html)

因此，我编写了一个很好的构建脚本，它创建了一个 Eclipse RCP 产品并在代码上运行单元测试。然后将所有结果分发到开发人员的列表中（经过一些抱怨）。现在我的下一步，我希望它创建我通常使用 inno setup 编译器手动创建的安装包。

问题是，我将如何绕过自动创建这个包？我想我可以从ant自动生成inno setup文件，然后从命令行调用编译器，但我不知道这是否可能。

这个任务有什么提示吗？也许任何其他可以从 ant 使用的设置应用程序？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-14T13:55:48.967

自动化安装程序构建时的另一个好技巧是使用`GetFileVersion`预处理器 (ISPP) 宏。这样，您就不必以硬编码形式（如 Tom's `settings.txt`）复制（二进制）文件的版本号 - 安装程序编译器将以这种方式简单地从文件的版本资源中读取它。例如：

```
#define AppName "My App"
#define SrcApp "MyApp.exe"
#define FileVerStr GetFileVersion(SrcApp)
#define StripBuild(str VerStr) Copy(VerStr, 1, RPos(".", VerStr)-1)
#define AppVerStr StripBuild(FileVerStr)

[Setup]
AppName={#AppName}
AppVersion={#AppVerStr}
AppVerName={#AppName} {#AppVerStr}
UninstallDisplayName={#AppName} {#AppVerStr}
VersionInfoVersion={#FileVerStr}
VersionInfoTextVersion={#AppVerStr}
OutputBaseFilename=MyApp-{#FileVerStr}-setup 
```

此外，您可以通过命令行开关将符号转发给编译器`/d`，例如：

```
iscc.exe /dSpecialEdition ... 
```

然后在`ifdef`s 中使用这些来创建不同类型的安装程序（下面是愚蠢的示例）：

```
[Registry]
#ifdef SpecialEdition
Root: HKLM; Subkey: Software\MyCompany\MyApp; ValueName: SpecialEdition; ValueType: dword; ValueData: 1 ...
#endif 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-07T12:36:38.190

确保它很容易，Inno 项目是一个纯文本文件，因此您甚至可以通过 ant 轻松编辑 setupper 脚本，但是我建议您通过脚本创建一个单独的小型包含文件。您可以在那里存储“变量”，例如您在设置开始时显示的版本+内部版本号。

将此行放入您的安装程序：

```
#include "settings.txt" 
```

并使 settings.txt 有这样的东西

```
#define myver=xxx.xxx
#define tags 
```

现在您不需要从构建脚本中接触实际的安装程序代码。

下面是我的构建脚本中用于编译安装程序的片段。你需要像这样从ant执行批处理文件：

```
<exec dir="." executable="cmd" os="Windows NT">
  <arg line="/c build.bat"/>
</exec> 
```

示例批处理 build.bat：

```
set isxpath="c:\program files\inno setup 5"
set isx=%isxpath%\iscc.exe
set iwz=myproj.iss
if not exist %isx% set errormsg=%isx% not found && goto errorhandler
%isx% "%iwz%" /O"%buildpath%" /F"MySetupper.exe" >>%logfile%
goto :eof 
```

# ruby-on-rails - ActiveRecord 关联缓存条件子句中的日期值

> ID：177613
> 
> 赞同：2
> 
> 时间：2008-10-07T08:30:58.653
> 
> 标签：ruby-on-rails

我的`Account`模型有以下两个关联：

```
has_many  :expenses, 
          :order => 'expenses.dated_on DESC', 
          :dependent => :destroy

has_many  :recent_expenses, 
          :class_name => 'Expense', 
          :conditions => "expenses.dated_on <= '#{Date.today}'",
          :order => 'dated_on DESC', 
          :limit => 5 
```

在我的一个观点中，我正在渲染最近的开支，如下所示：

```
<% @account.recent_expenses.each do |expense| %>
...
<% end %> 
```

在我的开发机器上、登台服务器（在生产模式下运行）以及生产控制台上，`@account.recent_expenses`返回正确的列表。但是，在我们的实时生产服务器上，不会返回最近的费用。

如果我在视图中替换`@account.recent_expenses`为，*则会*`@account.expenses`显示最近的费用，所以我的猜测是条件子句的一部分在第一次执行时以某种方式被缓存。如果我重新启动生产 Mongrel 集群，所有最新的费用都会正确返回。*`#{Date.today}`*

 *谁能想到为什么会发生这种情况以及我如何更改`:recent_expenses`查询以防止这种情况发生？

我正在使用 Rails 2.1.0。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-07T09:48:46.187

Rails 在加载时构建查询，然后在您每次调用 @account.recent_expenses 时重新使用该查询，这正是您所遇到的。

如果您使用的是 Rails 2.1，您可以使用 named_scope 来实现您想要的。

在您的**费用**模型中，输入以下内容：

```
named_scope :recent, lambda { {:conditions => ["expenses.dated_on <= ?", Date.today], :order => 'dated_on DESC', :limit => 5 } } 
```

lambda 用于确保 rails 每次都重建查询。

从您的**帐户**中删除：

```
has_many :recent_expenses ... 
```

然后调用：

```
<% @account.expenses.recent.each do |expense| %>
...
<% end %> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T09:52:32.670

就像 Andrew 说的，关联宏是在应用程序启动时读取的，因此任何动态位（如 Date.today）都会在此时被解析。如果您使用的是 Rails 2.1 或更高版本，他的解决方案可以工作；对于早期版本，您可以使用[has_finder gem](http://www.railslodge.com/ruby_gems/11-has_finder)，或者在 Expense 模型上创建以下方法：

```
def self.recent
  find(:all, :conditions => ['dated_on <= ?', Date.today], :limit => 5, :order => 'dated_on DESC')
end 
```

像这样的类方法暴露给关联，并且具有适当的范围 - 它们与 named_scopes 之间的区别在于您不能将它们链接起来。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-14T16:00:24.017

这是在 Rails 3 中的样子：

```
scope :recent, lambda { where("expenses.dated_on <= ?", Date.today).order('dated_on DESC').limit(5) } 
```

***警告：***注意未包含在 lambda 中的链式作用域。您可能认为链的一部分是在运行时评估的，但它可能是在应用服务器启动时评估的。确保您 lambda 包装将使用这些其他范围的任何范围。此处说明： [http ://www.slashdotdash.net/2010/09/25/rails-3-scopes-with-chaining/](http://www.slashdotdash.net/2010/09/25/rails-3-scopes-with-chaining/)

# c# - 领域特定语言 (DSL) 和领域驱动设计 (DDD)

> ID：177628
> 
> 赞同：10
> 
> 时间：2008-10-07T08:37:33.383
> 
> 标签：c#, .net, domain-driven-design, dsl

领域特定语言 (DSL) 和领域驱动设计 (DDD) 之间有什么区别和相似之处？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-07T08:50:54.977

领域驱动设计（DDD）是一种思考和交流问题及其解决方案的方式。

领域特定语言 (DSL) 是一种编写代码的方式。

它们很相似，因为它们都以“域”一词开头。就是这样，我猜。:-)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-07T12:38:37.017

领域驱动设计强调问题领域的作用，因为您为正在设计的系统创建基本词汇、概念和对象模型。

领域特定语言是一种用于指定或实现系统特定部分的符号，面向该领域从业者的需求（即最小化大多数编程或规范语言的“程序化”方面）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-07T09:31:26.707

我认为它们在某种程度上是相关的，而不仅仅是“域”这个词。一旦你有了一个好的（领域驱动的）设计，它肯定会有助于创建一个可靠的 DSL。

“DDD 并不特别要求使用 DSL，尽管它可以用来帮助定义 DSL。” - 维基百科

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-10-06T00:40:24.647

我想两者都主要关注减少编程中的噪音，DDD 作用于语义噪音和 DSL 的句法噪音。

这些可能有助于理解我的观点：

[http://fragmental.tw/2009/03/12/expessive-design-slides/](http://fragmental.tw/2009/03/12/expessive-design-slides/)

[http://fragmental.tw/2008/04/20/domain-specific-languages-and-video-games/](http://fragmental.tw/2008/04/20/domain-specific-languages-and-video-games/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-09T20:14:03.277

DDD 的一个要素可以看作是开发通用语言以与利益相关者讨论领域的能力。对于那些既明确又可能可执行的 UL 子集，您可以选择使用内部或外部 DSL 来实现它们。

这是我在 DomainDriven 网站上讨论这个问题的视频：

[http://domaindrivendesign.org/library/bell_gitlevich_2009](http://domaindrivendesign.org/library/bell_gitlevich_2009)

最好的祝愿，彼得

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T09:36:35.713

[Wikipedia 对DSL](http://en.wikipedia.org/wiki/Domain_Specific_Language)有一个非常明确的定义：

> 近年来，领域特定语言 (DSL) 一词在软件开发中变得流行，以表示专用于特定问题域、特定问题表示技术和/或特定解决方案技术的编程语言或规范语言。

这可以实现为一组遵循某种一致模式的类、一些花哨的 C++ 模板魔术，或者解释自由文本输入以执行您想要的操作的编译器/解析器。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-07T10:43:21.693

我认为它们在某种程度上是相关的（正如克里斯托夫所说），但是两个完全不同的方面。我什至不会驳回乔普的说法。

有关 DSL 的非常好的书面信息，请参阅[Martin Fowler 的关于 DSL 的页面集](http://martinfowler.com/dslwip/)（正在进行中），您可以从[示例](http://martinfowler.com/dslwip/Intro.html#TheExample "例子")或[定义](http://martinfowler.com/dslwip/UsingDsls.html#DefiningDomainSpecificLanguages)开始。另一个好读物是他的[QandA](http://martinfowler.com/bliki/DslQandA.html "澳达")。

DDD 基于领域模型，通常至少比 DSL 高一个抽象级别。两者都可以在没有另一个的情况下存在，正如 Christophe 已经说过的，它们都可以在同一个项目中使用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-07T01:16:34.777

不同之处在于，一种是使用领域特定语言 (DSL) 而不是通用语言来构建系统的方法，另一种是用于设计和构建系统的架构方法 (DDD)。

相似之处在于它们都专注于特定领域。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-05-30T07:40:00.313

维基百科（[https://en.wikipedia.org/wiki/Domain-driven_design](https://en.wikipedia.org/wiki/Domain-driven_design)）有一个很好的答案：

> DDD 并不特别要求使用 DSL，尽管它可用于帮助定义 DSL 并支持特定领域的多模型等方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-01-07T04:34:10.727

Markus Voelter 在他的[DSL 工程书籍](http://voelter.de/dslbook/markusvoelter-dslengineering-1.0.pdf)第*2.5.2 段 A Thinking and Communication Tool*中提供了很好的答案：

> 实际上，DSL 是 Eric Evans 的领域驱动设计意义上的通用语言的形式化。

# c# - 参数/返回值（集合）的代码约定是什么

> ID：177638
> 
> 赞同：1
> 
> 时间：2008-10-07T08:41:18.163
> 
> 标签：c#

我与一位朋友讨论了在方法的返回/输入值中使用集合。他告诉我，我们必须使用 - 派生最多的类型作为返回值。- 输入参数的最小派生类型。

因此，这意味着，例如，一个方法必须获取一个 ReadOnlyCollection 作为参数，并作为返回一个 List。

而且，他说publics API中不能使用List或Dictionary，而必须使用Collection、ReadOnlyCollection，...所以，在一个方法是public的情况下，它的参数和返回值必须是集合，ReadOnlyCollection，...

这样对吗 ？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-07T08:46:43.380

关于输入参数，使用最不具体的类型通常更灵活。例如，如果您的所有方法都要做的是枚举作为参数传递的集合中的项目，那么接受 IEnumerable<T> 会更加灵活。

例如，考虑一个方法“ProcessCustomers”，它接受一个客户集合的参数：

```
public void ProcessCustomers(IEnumerable<Customer> customers)
{
   ... implementation ...
} 
```

如果将参数声明为 IEnumerable<Customer>，则调用者可以使用如下代码轻松传入集合的子集（NET 3.5 之前：使用 .NET 3.5，您可以使用 lambda 表达式）：

```
private IEnumerable<Customer> GetCustomersByCountryCode(IEnumerable<Customer> customers, int countryCode)
{
    foreach(Customer c in customers)
    {
        if (c.CountryCode == countryCode) yield return c;
    }
}

... 
ProcessCustomers(GetCustomersByCountryCode(myCustomers, myCountryCode);
... 
```

一般来说，MS 指南建议不要公开 List<T>。有关为什么会这样的讨论，请参阅代码分析 (FxCop) 团队的[此博客条目](http://blogs.msdn.com/fxcop/archive/2006/04/27/faq-why-does-donotexposegenericlists-recommend-that-i-expose-collection-lt-t-gt-instead-of-list-lt-t-gt-david-kean.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T08:48:42.517

我倾向于不返回或使用 List 或 Dictionary 作为 API 中的参数，因为它确实限制了开发人员针对 API。相反，返回或传递 IEnumerable<> 效果很好。

粗略地说，所有这些都取决于应用程序。只是我的观点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T19:09:10.377

也许您的朋友阅读了： [框架设计指南：可重用 .NET 库的约定、惯用语和模式](https://rads.stackoverflow.com/amzn/click/com/0321246756)

这是一本很棒的书，它详细涵盖了这样的问题。

# c++ - 使用 C++ 在 Linux 上锁定/防止编辑源文件

> ID：177640
> 
> 赞同：1
> 
> 时间：2008-10-07T08:43:14.057
> 
> 标签：c++, linux, file-locking

如何在 Linux 上使用 C++ 以编程方式锁定/解锁或阻止/启用编辑源文件。

我希望能够锁定源文件，这样如果我在编辑器中打开它，它就不允许我保存回同一个源文件。

我正在考虑可能将权限更改为只读（稍后将其更改回读写）：我如何从 C++ 中做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T08:45:50.870

试试 man fchmod：

```
姓名
       chmod, fchmod - 更改文件的权限

概要
       #include <sys/types.h>
       #include <sys/stat.h>

       int chmod(const char *path, mode_t 模式);
       int fchmod(int fildes, mode_t 模式);

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T10:07:25.883

为什么不使用 CVS 或 Subversion 等源代码管理工具？CVS 可以很好地锁定（Subversion 也是如此）。更重要的是，你有变化的历史。更好的是（无论如何使用 CVS），您必须执行“签出”步骤以使文件可写。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T10:58:38.900

是的，很难说出你在找什么

*   防止其他用户编辑您的文件 -> 使用“chmod, fchmod”

*   防止你自己不小心弄乱你的源文件 -> 你应该真正改变你的想法并使用源代码控制工具。像[Subversion (SVN)](http://subversion.tigris.org)甚至更好的[Mercurial](http://www.selenic.com/mercurial/)。

# mouse - 交换握着鼠标的手：你有更好的主意吗？

> ID：177644
> 
> 赞同：1
> 
> 时间：2008-10-07T08:44:50.950
> 
> 标签：mouse, ergonomics

在我的电脑前花费数千小时，人体工程学很快成为一个主要问题。

对于显示器或键盘，存在技术解决方案。但是对于鼠标，我从来不习惯轨迹球，在手腕下放一个小枕头让我感到不舒服。

所以我开始交换握鼠标的手。太好了，一个人可以一边工作一边休息。一开始很难，但现在我真的看不出有什么区别，除非我尝试在 Quake III 上大打出手 ;-)

无论如何，很多人不会对这个想法感到满意，没有时间，最重要的是，无法承受使用另一只手带来的心理转换。事实上，使用另一只手会让你使用大脑的另一侧（逻辑 <=> 创意），第一次很难集中注意力。

我对此感到高兴，但可以理解很多人不会。你有更好的主意吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T08:46:48.997

定期休息一下鼠标，学习键盘快捷键！

有一个名为[Workrave](http://www.workrave.org/welcome/)的工具，它可以让你每隔几分钟休息一下，我使用它，它似乎有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T08:52:21.933

是的，我也有一段时间有这个问题。我做的第一件事是修改我的椅子，这样我就有了一个平坦的区域，我可以放一只鼠标并将我的手臂放在带衬垫的扶手上。现在我有一张 L 形的桌子，可以把我的整个手臂放在桌子上（无论如何从手肘到手）。我发现它比仅仅扭动我的手腕有很大的不同。不过，我仍然使用改装过的椅子来握住飞行杆进行游戏；）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T09:07:11.153

这是经典的RSI，你需要为了你的身体而改变你的心态。

就我个人而言，我不明白为什么人们在切换到 Logitech [Trackman](http://www.logitech.com/index.cfm/mice_pointers/trackballs/devices/166&cl=US,EN)时遇到麻烦，你的手不动，只是你的拇指。

对我来说，传统的轨迹球失败了，因为你必须让你的手悬停在它们上面或者你的手向上弯曲。然而，使用 trackman 时，您的手会自然弯曲，因此感觉很舒服。我曾经用一个玩过美国陆军，而且速度没有问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T08:50:39.080

我尝试了[垂直鼠标](http://www.google.com/search?q=vertical+mouse)，但发现它更不舒服，因为你失去了将手*放在*鼠标上所提供的手腕支撑。

这对我来说是浪费钱，但你的里程可能会有所不同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T09:11:35.967

感谢主动回手切换。我几年前就学会了，大约花了两个星期才习惯。从那时起，我就可以愉快地用双手操作鼠标了。

面向运动的有趣家庭作业：学习用双手打羽毛球。:P

这种运动通常对我们的大脑有益。以一种方式拉伸它也使它在其他方面表现更好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T09:21:20.360

IBM 曾经用他们著名的定点杆在中间制造键盘。很可能，联想在接手后继续使用该产品。

如果您能习惯这样的设备，它会非常有用，尤其是因为在工作时无需将手从键盘上移开。

# asp.net-mvc - 带有 ASP.NET MVC Preview 5 的 Html.TextBox 条件属性

> ID：177673
> 
> 赞同：30
> 
> 时间：2008-10-07T08:54:24.800
> 
> 标签：asp.net-mvc, attributes, html-helper, readonly

我有一个强类型的 MVC 视图控件，它负责用户可以在其中创建和编辑客户端项目的 UI。我希望他们能够定义`ClientId`创建时，但不能编辑，这将反映在 UI 中。

为此，我有以下行：

```
<%= Html.TextBox("Client.ClientId", ViewData.Model.ClientId, new 
 { @readonly = 
   (ViewData.Model.ClientId != null && ViewData.Model.ClientId.Length > 0 
      ? "readonly" : "false") 
 } )
%> 
```

似乎无论我给 readonly 属性赋予什么值（甚至是“false”和“”），Firefox 和 IE7 都会将输入设为只读，这非常违反直觉。如果不需要，是否有一种很好的、​​基于三元运算符的方法可以完全删除该属性？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-10-07T11:29:53.753

棘手的问题...但是，如果您只想定义`readonly`属性，则可以这样做：

```
<%= Html.TextBox("Client.ClientId", ViewData.Model.ClientId, 
  ViewData.Model.ClientId != null && ViewData.Model.ClientId.Length > 0 
    ? new { @readonly =  "readonly" } 
    : null) 
%> 
```

如果要定义更多属性，则必须定义两个匿名类型并拥有多个属性副本。例如，像这样的东西（无论如何我都不喜欢）：

```
ClientId.Length > 0 
  ? (object)new { @readonly = "readonly", @class = "myCSS" } 
  : (object)new { @class = "myCSS" } 
```

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2012-12-11T09:44:29.230

如果要定义多个属性，并且条件只读**而不重复其他属性**，则可以使用 Dictionary 而不是匿名类型的属性。

例如

```
Dictionary<string, object> htmlAttributes = new Dictionary<string, object>();
htmlAttributes.Add("class", "myCSS");
htmlAttributes.Add("data-attr1", "val1");
htmlAttributes.Add("data-attr2", "val2");
if (Model.LoggedInData.IsAdmin == false)
{
    htmlAttributes.Add("readonly", "readonly");
}

@:User: @Html.TextBoxFor(
    m => m.User,
    htmlAttributes) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-11-23T06:44:20.693

提示：仅存在 readonly/disabled 属性会使元素在浏览器中只读或禁用。

```
@Html.TextBoxFor(x => x.Name, isReadonly ?(object) new { @readonly = true } : new { /*Some other attributes*/ }) 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-07T11:37:32.583

另一种方法是将其作为普通的旧 HTML 发出。是的，编辑器会让你认为你错了，但这种情况在 VS2008SP1 中似乎经常发生。此示例专门针对在 CTP5 中似乎完全被浪费的复选框，但它让您了解如何发出条件属性。

```
<input type="checkbox" name="roles" value='<%# Eval("Name") %>' 
  <%# ((bool) Eval("InRole")) ? "checked" : "" %> 
  <%# ViewData.Model.IsInRole("Admin") ? "" : "disabled" %> /> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-04T10:38:49.933

我认为应该是

```
<%= ((bool) Eval("InRole")) ? "checked" : "" %> 
```

而不是这个 leppies 答案。

```
<%# ((bool) Eval("InRole")) ? "checked" : "" %> 
```

至少它不适用于我，但它适用于 =。我做错什么了吗？无论如何感谢您的提示:)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-05-09T23:38:57.180

我用这个：

```
 @Html.TextAreaFor(model => model.ComentarioGestor, comentarioGestor? new { @class = "form-control" } : new { @class = "form-control", @readonly = "readonly" } as object) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-08-09T19:31:36.450

$(function() { $("[readonly='false']").removeAttr("readonly"); });

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2014-06-05T09:13:00.103

我尝试了上面的大部分建议，现在我已经用一条线得出了最简单的建议。通过将其中一个声明为“对象”类型来组合 2 个匿名 html 属性对象。

```
@Html.TextBoxFor(m => m.Email, !isEdit ? new { id = "email_box" } : new { id = "email_box", @readonly = isEdit ? "readonly" : "false" } as object) 
```

# search - 你能推荐一个非结构化数据索引软件吗？

> ID：177675
> 
> 赞同：3
> 
> 时间：2008-10-07T08:54:31.570
> 
> 标签：search, indexing

我正在从几个定制的应用程序中收集日志。每个应用程序都有自己的日志格式。我正在寻找的是一个中心工具，它可以让我搜索我的所有日​​志。这意味着该工具必须能够为每个日志文件定义不同的正则表达式（或类似的）（标记记录的开始位置、结束位置以及字段是什么）。我一直在尝试 Splunk，但我对此并不满意，因为性能很慢，我每天的索引数据量有限（免费版），而且它不像我想要的那样灵活. 你能为这项任务推荐一个软件（最好是免费的或便宜的）吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T09:00:50.823

你可以试试[Lucene](http://lucene.apache.org/java/docs/)。这是免费的。它是用 Java 编写的，它允许对大量数据进行全文搜索。它不是一个完整的应用程序，而是一个库，因此您必须编写代码来使用它来索引和搜索您的日志。您可能必须为您的日志定义不同的文档类型或至少不同的索引功能，但是搜索工作得很好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T09:18:15.563

如果您可以使用 Windows，请尝试使用 Microsoft 有史以来最好的工具[Logparser](http://www.microsoft.com/technet/scriptcenter/tools/logparser/default.mspx)。我希望 Unix 有这么简单的工具。但是没有。尽管我一直想制作一个 Unix 版本的 Logparser，但我只是没有时间。

**注意：**对于有时间的人或某个地方的研究生来说，这将是一个很棒的项目！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-23T17:35:02.740

[http://www.splunk.com/](http://www.splunk.com/)

没用过，但听说过。

# c# - 通过 COM 使用 .NET 的 UserControl 作为嵌入式控件

> ID：177676
> 
> 赞同：1
> 
> 时间：2008-10-07T08:54:33.753
> 
> 标签：c#, com, eclipse-plugin, ganymede

我正在将现有的 .NET 3.5 应用程序移植到 Eclipse 插件中。

我想让我的自定义用户控件，用 C# 编写，嵌入到 Eclipse 中；我已经成功地将它导出为 COM 控件，并且在 Eclipse Europa 中运行良好。

在 Ganymede 中，OLE 加载代码似乎发生了变化，而最初在 Europa 中运行的代码失败了。

具体错误是当 Ganymede 加载我的控件时，它查询 IOleObject，接收正确的接口，然后在其上调用 SetClientSite，这导致我的对象丢失了它的两个引用，并被解除分配（Ganymede 将崩溃）。完全相同的控件在 Visual C++ 设计器和 Europa 中都能完美运行。

除了明显的 .NET 属性和 UserControl，我还需要继承什么特定的类吗？我需要实现的特定接口，或者 Europa/VC 和 Ganymede 之间的特定行为变化？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-04T14:09:31.413

如果有人仍然遇到此问题，请在[Connect](http://connect.microsoft.com/visualstudio/)上报告。完成报告后，请在此处发布错误报告的 URL，以便阅读此帖子的人对其进行投票。

如果这仍然是一个错误，最好通过 .NET 4.0 或至少 SP1 的 RTM 修复它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-19T05:21:45.747

在非 .NET 环境中托管 .NET 控件时，我遇到了类似的问题。我的一些用户控件如何暴露给 COM 存在问题。

按照本网站上的示例解决了我的问题，也许它也会对您有所帮助！

[关联](http://blogs.msdn.com/calvin_hsia/archive/2006/07/14/665830.aspx)

# c++ - 如何以位字节序将数字转换为字节数组

> ID：177677
> 
> 赞同：5
> 
> 时间：2008-10-07T08:55:02.940
> 
> 标签：c++, qt, vb6, compression, endianness

我正在尝试使用 zlib API 解压缩在 VB6 中创建的一些数据。

我已经阅读了 qUncompress 函数可以做到这一点：http: [//doc.trolltech.com/4.4/qbytearray.html#qUncompress](http://doc.trolltech.com/4.4/qbytearray.html#qUncompress)

我已经通过 readRawBytes 将 QDataStream 中的数据读入一个 char 数组，然后我将其转换为 QByteArray 进行解压缩。我有压缩长度和预期的解压缩长度，但没有从 qUncompress 得到任何东西。

但是，我需要以大端格式添加预期的解压缩长度。有没有人这样做并有一个例子？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T09:48:37.700

*我已经很久*没有使用过 VB6 了，所以我希望这是大致正确的。我*认为*vb6 使用 () 进行数组索引。如果我有任何问题，请告诉我。

查看 qUncompress 文档，您应该从字节 5 开始将数据放入 QByteArray 中（我将假设您在本示例中将数组索引基数设置为 1）。

假设数组名为 qArr，预期的未压缩大小为 Size。在“大端”表示中，第一个字节位于第一个地址。

```
qArr(1) = int(Size/(256*256*256))
qArr(2) = 255 And int(Size/256*256)
qArr(3) = 255 And int(Size/256)
qArr(4) = 255 And int(Size) 
```

那有意义吗？

如果您需要小端序，您可以颠倒索引的顺序 (qArr(4) - qArr(1)) 并保持计算不变。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T12:52:54.850

这就是我如何将任意数据从一种格式转换为另一种格式的方法。

```
Private Type LongByte
    H1 As Byte
    H2 As Byte
    L1 As Byte
    L2 As Byte
End Type

Private Type LongType
    L As Long
End Type

Function SwapEndian(ByVal LongData as Long) as Long
  Dim TempL As LongType
  Dim TempLB As LongByte
  Dim TempVar As Long

  TempL.L = LongData
  LSet TempLB = TempL
'Swap is a subroutine I wrote to swap two variables
  Swap TempLB.H1, TempLB.L2
  Swap TempLB.H2, TempLB.L1
  LSet TempL = TempLB
  TempVar = TempL.L

  SwapEndian = TempVar
End Function 
```

如果您正在处理 FileIO，那么您可以使用 TempLB 的字节字段

诀窍是使用 LSET 一个不起眼的 VB6 命令

如果您使用的是 .NET，那么执行此过程要容易得多。这里的技巧是使用 MemoryStream 来检索和设置各个字节。现在你可以计算 int16/int32/int64。但是，如果您正在处理浮点数据，则使用 LSET 或 MemoryStream 会更清晰且更易于调试。

如果您使用的是 Framework 1.1 或更高版本，那么您将拥有使用字节数组的 BitConvertor 类。

```
Private Structure Int32Byte
    Public H1 As Byte
    Public H2 As Byte
    Public L1 As Byte
    Public L2 As Byte
    Public Function Convert() As Integer
        Dim M As New MemoryStream()
        Dim bR As IO.BinaryReader
        Dim bW As New IO.BinaryWriter(M)
        Swap(H1, L2)
        Swap(H2, L1)
        bW.Write(H1)
        bW.Write(H2)
        bW.Write(L1)
        bW.Write(L2)
        M.Seek(0, SeekOrigin.Begin)
        bR = New IO.BinaryReader(M)
        Convert = bR.ReadInt32()
    End Function
End Structure 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T10:04:21.727

看起来您需要一段 C 代码来解压缩一些 zlib 压缩数据。在这种情况下，您是否可以实际使用 zlib 并将 zlib 数据提供给它。zlib 主页：[http](http://www.zlib.net/) ://www.zlib.net/ 。

如果我弄错了，您能否具体说明解压缩数据应该使用什么语言以及为什么不选择 zlib？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T10:27:35.843

```
//int length;
byte[] bigEndianBytes = BitConverter.GetBytes(IPAddress.HostToNetworkOrder(length)) 
```

反过来：

```
//byte[] bigEndianBytes;
int length = IPAddress.NetworkToHostOrder(BitConverter.ToInt32(bigEndianBytes)) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T13:00:55.300

从您的问题中我不清楚您是否想在 VB 中添加长度以便它适合 qUncompress 直接使用，或者您是否想像现在一样使用 VB 生成的数据并在 C++ 中添加长度之前调用 qUncompress。

Mike G[发布](https://stackoverflow.com/questions/177677/how-to-convert-a-number-to-a-bytearray-in-bit-endian-order#177793)了一个 VB 解决方案。如果你想用 C++ 来做，那么你有两个选择，要么在 QByteArray 的开头添加长度，要么直接调用 zlib 的 uncompress。在这两种情况下，qCompress 和 qUncompress 的 Qt 源代码（corelib/tools/qbytearray.cpp）都是很好的参考。

这就是 qCompress 如何将长度（nbytes）添加到 bazip，压缩数据：

```
bazip[0] = (nbytes & 0xff000000) >> 24;
bazip[1] = (nbytes & 0x00ff0000) >> 16;
bazip[2] = (nbytes & 0x0000ff00) >> 8;
bazip[3] = (nbytes & 0x000000ff); 
```

其中 bazip 是结果 QByteArray

或者，如果您想直接调用 uncompress，而不是使用 qUncompress 包装器，它使用的调用是

```
baunzip.resize(len);
res = ::uncompress((uchar*)baunzip.data(), &len,
                        (uchar*)data+4, nbytes-4); 
```

其中 baunzip 是一个 QByteArray。在您的情况下，您将删除 +4 和 -4，因为您的数据没有附加长度。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T15:20:57.047

感谢您的所有帮助，它很有用。

我得到了使用的代码：

```
 char slideStr[currentCompressedLen];
        int slideByteRead = in.readRawData(slideStr, currentCompressedLen);
        QByteArray aInCompBytes = QByteArray(slideStr, slideByteRead);
        aInCompBytesPlusLen = aInCompBytes;
        aInCompBytesPlusLen.prepend(QByteArray::number(currentUnCompressedLen));
        aInUnCompBytes.resize(currentUnCompressedLen);
        aInUnCompBytes = qUncompress(aInCompBytesPlusLen); 
```

# sql-server - SQL Server 2005 连接错误：无法生成 SSPI 上下文

> ID：177678
> 
> 赞同：3
> 
> 时间：2008-10-07T08:55:04.643
> 
> 标签：sql-server

提供使用：Microsoft OLE DB Provider for SQL Server。任何人都可以帮我解决这个问题。我试图与 LLBLgen 联系

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-12-09T15:17:08.783

这个 MSDN 博客页面对此有一些有用的...

[http://blogs.msdn.com/sql_protocols/archive/2006/12/02/understanding-kerberos-and-ntlm-authentication-in-sql-server-connections.aspx](http://blogs.msdn.com/sql_protocols/archive/2006/12/02/understanding-kerberos-and-ntlm-authentication-in-sql-server-connections.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-01-26T10:13:56.497

就我而言，我发现该帐户已被锁定。原因是我之前在另一台机器上尝试登录超过 3 次。它没有认出我——最后它锁定了我的帐户。

重新开户使一切正常。

br 简

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T14:46:38.520

您收到的错误几乎总是由使用 Windows 身份验证的问题引起的。请尝试切换到 SQL 服务器登录名（用户名/密码），或确保您当前的 Windows 登录名可以访问您尝试连接的 SQL 服务器和数据库。

-Edoode

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-12-11T10:20:39.880

我通过将驱动器映射到运行 MSSQL 的服务器来解决此问题。这似乎产生了某种信任，即使在重新启动后，MSSQL 也可以在没有此错误的情况下进行连接。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T09:03:04.347

在使用 Windows 身份验证连接到本地 SQL Server 时，我有时会遇到此错误。不幸的是，我从未修复它 - 当我重新安装 Windows 时它就消失了。

我认为重新启动可以修复它-您尝试过吗？我知道，这不是最好的解决方案：P

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-17T17:28:31.177

尝试将您的日期和时间与您的域同步。SSPI 问题可能与 Active Directory 身份验证问题有关，其中一些与日期和时间更改有关。这很容易检查和修复。试试看！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-07T21:19:06.380

有一篇 Microsoft 知识库文章解决了该领域的许多原因 (KB811889)，网址为：http: [//support.microsoft.com/kb/811889](http://support.microsoft.com/kb/811889)。

许多谷歌搜索表明，其中一个诊断步骤帮助了大多数遇到问题的人。

我最近遇到了这个确切的问题，只有在使用某些帐户进行身份验证时才会出现此错误，而其他帐户则不会。最终导致我的问题的原因在我在网上找到的任何知识库或文章中都没有提到，但通过反复试验我发现当通过 SSPI 身份验证到 SQL Server (2k8) 使用的帐户恰好在大量组中时（在我的情况下超过 250 个）您会收到“无法生成 SSPI 上下文”错误。我怀疑它与溢出 Kerberos 使用的安全令牌有关，并且已经看到大量组中的用户帐户出现类似的奇怪身份验证问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-20T19:33:42.870

当我在客户端机器上设置的时间不同于服务器或 AD 机器（我试图测试未来）时，我会遇到问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-09-03T13:59:40.253

简短回答：您最近是否更改了运行该服务的用户？有没有系统崩溃？

长答案：我知道这是旧的，但我想发布我刚刚拥有的经验。我们花了几个小时谷歌搜索并没有发现任何有用的东西。最终，我们遇到了一组可能导致此问题的操作：

如果您更改运行 Sql Server 的用户（例如，从本地系统到域 usr）并进行某些更新并且服务器没有安全地重新启动 - 您会得到这个。

因此，我们将其设置回本地系统并*成功*了。将其交换给域用户，没有工作。行。将其交换到本地系统，重新启动，将其交换到域用户，重新启动，*bam* - worky worky。我们的世界一切都很好。那天早上晚些时候，它再次崩溃了......现在仍在努力，但优先级正在改变，我不确定我们是否会继续解决这个问题，所以我想发布一些东西以防其他人发生这种情况。

造成我们的原因是我们进行了更新，显然，我们了解到让 Sql Server 作为本地系统运行是不好的做法，因此我们将其更改为域用户。我们从未重新启动，而是重新启动服务。一个月后，我们进行更新。我们不重启。一个月过去了，电源板出现故障，导致服务器意外关闭。又过了一个月，我们发现了问题，因为我们很少连接到这个特定的数据库（有趣的是，Sql Server 2008 运行良好......它只是 2005 年）。或者……至少这是我们遇到的最好的。

我们的管理员不喜欢 Vista，喜欢把所有事情都归咎于 Vista（拒绝让我们测试 Windows 7）......所以他用谷歌搜索了“sspi vista”或类似的东西（我知道它有 sspi 和 vista，但它可能有还有一个……如果你需要谷歌的话，那很好），然后在我们开会后看到一篇文章很好地解释了我们的场景，我们都记得这些片段并将这张照片放在一起。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-01-31T09:28:24.297

就我而言，Windows 2003 域环境中的时间同步问题实际上是问题所在。

这很容易被忽视，因为两人在两个不同的时区，同时在他们的时钟上显示相同的时间；实际上相隔大约 1 小时。

所以除了手表上的时间，还要检查时区。

# java - 饼干 getMaxAge

> ID：177708
> 
> 赞同：12
> 
> 时间：2008-10-07T09:07:02.357
> 
> 标签：java, servlets

我无法检索 cookie maxage 它总是返回 -1

创建cookie：

```
Cookie securityCookie = new Cookie("sec", "somevalue");
securityCookie.setMaxAge(EXPIRATION_TIME); 
```

检索 cookie：

```
Cookie[] cookies = request.getCookies();
if (cookies != null) {
    for(int i=0; i<cookies.length; i++) {
        Cookie cookie = cookies[i];
        if ("sec".equals(cookie.getName())){
            int age = cookie.getMaxAge();
        }
    }
} 
```

我总是变老= -1

当我检查 Firefox cookie 过期时，我也看到奇怪的日期。

谢谢

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-09T12:32:53.593

当浏览器将 cookie 发送回源服务器时，它不包含任何年龄。因此，您上面的“检索”代码没有收到最大年龄是合乎逻辑的：它不包含在请求中。

当从服务器接收到 cookie 时，浏览器使用 max age 参数来确定 cookie 应该保留多长时间；年龄永远不会传回服务器，过期的 cookie 会被简单地丢弃。处理请求时，如果要更新 cookie 的年龄，请在响应中重新包含 cookie。

[另请参阅RFC](http://www.w3.org/Protocols/rfc2109/rfc2109)中的“向源服务器发送 Cookie”部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T09:47:21.807

API 说 -1 意味着直到浏览器运行：

> 返回 cookie 的最大年龄，以秒为单位，默认 -1 表示 cookie 将持续存在，直到浏览器关闭

EXPIRATION_TIME 常量的值是多少？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T11:00:03.017

该值可以由浏览器修改。

您创建了一个 cookie 并希望设置一个最大年龄。cookie 被发送到浏览器。浏览器可能会拒绝 cookie 或忽略对其策略而言过长的最大年龄。此修改后的 cookie 将发送回您的应用程序。

检查您的浏览器设置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T15:03:05.070

只是为了笑，您可以使用 javascript 从浏览器中检索 cookie 的值吗？

另外，你可以在你的 servlet/jsp 之前放置一个过滤器，以便在 servlet/jsp 设置它之后检查 cookie 的值吗？

# wpf - 如何在 Windows Presentation Foundation (WPF) 中实现本地化？

> ID：177717
> 
> 赞同：2
> 
> 时间：2008-10-07T09:12:23.530
> 
> 标签：wpf, localization

请分享您有关如何本地化 WPF 应用程序以支持多种语言的经验以及对您有帮助的任何资源？

感谢您的反馈。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-12T20:11:03.273

对于我们的 WPF 应用程序，我们所有的字符串都本地化为资源`ResourceDictionary`，我们将其放入以语言命名的 .xaml 文件中（如 en-US.xaml、ja-JP.xaml 等）。

例如，应用程序中的某个按钮可能如下所示：

```
<Button Content="{StaticResource Strings.FooDialog.BarButtonText}"/> 
```

不同语言的每个`ResourceDictionary`都包含一个版本：

```
<sys:String x:Key="Strings.FooDialog.BarButtonText">Bar!</sys:String> 
```

像这样`ResourceDictionary`动态连接到`Application.Resources`运行时：

```
private static void LoadLocalizedStrings(CultureInfo uiCulture)
{
   ResourceDictionary stringsResourceDictionary = new ResourceDictionary();
   stringsResourceDictionary.Source = new Uri(@"pack://application:,,,/Resources/Strings/" + uiCulture.Name + ".xaml");
   Application.Current.Resources.MergedDictionaries.Add(stringsResourceDictionary);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T05:25:18.637

抱歉，如果它含糊不清（以上问题），基本上是关于您如何在应用程序中实现它以及您认为最好的方法。基本上是为了理解场景。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-04-11T18:49:54.870

我刚刚使用 ResourceDictionary 成功本地化了我的 WPF 应用程序。我使用的方法允许动态更改语言、轻松翻译、设计时支持，甚至允许部分翻译。我的工作基于[http://www.geektieguy.com/2006/12/12/localizing-an-xbap-application-without-using-locbaml/](http://www.geektieguy.com/2006/12/12/localizing-an-xbap-application-without-using-locbaml/)

您可以在以下位置看到我的部分努力：[ResourceDictionary Source Binding to Module (for Localization)](https://stackoverflow.com/questions/5623008/resourcedictionary-source-binding-to-module-for-localization)

# javascript - 不区分大小写的搜索

> ID：177719
> 
> 赞同：288
> 
> 时间：2008-10-07T09:14:07.787
> 
> 标签：javascript, search, string-comparison, case-insensitive

我正在尝试在 JavaScript 中使用两个字符串进行不区分大小写的搜索。

通常它会是这样的：

```
var string="Stackoverflow is the BEST";
var result= string.search(/best/i);
alert(result); 
```

该`/i`标志将用于不区分大小写。

但我需要搜索第二个字符串；没有标志，它可以完美运行：

```
var string="Stackoverflow is the BEST";
var searchstring="best";
var result= string.search(searchstring);
alert(result); 
```

如果我将`/i`标志添加到上面的示例中，它将搜索 searchstring 而不是变量“searchstring”中的内容（下一个示例不起作用）：

```
var string="Stackoverflow is the BEST";
var searchstring="best";
var result= string.search(/searchstring/i);
alert(result); 
```

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：387
> 
> 时间：2008-10-07T09:16:21.230

是的，使用`.match`，而不是`.search`。调用的结果`.match`将返回与其自身匹配的实际字符串，但它仍可用作布尔值。

```
var string = "Stackoverflow is the BEST";
var result = string.match(/best/i);
// result == 'BEST';

if (result){
    alert('Matched');
} 
```

使用这样的正则表达式可能是 JavaScript 中最简洁和最明显的方法，但请记住它*是*一个正则表达式，因此可以包含正则表达式元字符。如果你想从其他地方获取字符串（例如，用户输入），或者如果你想避免转义很多元字符，那么你最好`indexOf`这样使用：

```
matchString = 'best';
// If the match string is coming from user input you could do
// matchString = userInput.toLowerCase() here.

if (string.toLowerCase().indexOf(matchString) != -1){
    alert('Matched');
} 
```

* * *

## 回答 #2

> 赞同：192
> 
> 时间：2008-10-07T09:41:00.790

代替

```
var result= string.search(/searchstring/i); 
```

和

```
var result= string.search(new RegExp(searchstring, "i")); 
```

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2008-10-07T13:16:05.223

如果您只是搜索字符串而不是更复杂的正则表达式，则可以使用`indexOf()`- 但请记住首先将两个字符串都小写，因为`indexOf()`区分大小写：

```
var string="Stackoverflow is the BEST"; 
var searchstring="best";

// lowercase both strings
var lcString=string.toLowerCase();
var lcSearchString=searchstring.toLowerCase();

var result = lcString.indexOf(lcSearchString)>=0;
alert(result); 
```

或者在一行中：

```
var result = string.toLowerCase().indexOf(searchstring.toLowerCase())>=0; 
```

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2016-07-01T17:56:09.523

假设我们要在字符串变量`needle`中找到字符串变量`haystack`。有三个陷阱：

1.  国际化应用程序应避免`string.toUpperCase`和`string.toLowerCase`. 改用忽略大小写的正则表达式。例如，`var needleRegExp = new RegExp(needle, "i");`后跟`needleRegExp.test(haystack)`.
2.  通常，您可能不知道 的值`needle`。注意`needle`不包含任何正则表达式的[特殊字符](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions?redirectlocale=en-US&redirectslug=JavaScript%2FGuide%2FRegular_Expressions)。使用`needle.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&");`.
3.  在其他情况下，如果您想精确匹配`needle`and `haystack`，只需忽略大小写，请确保在正则表达式构造函数`"^"`的开头和结尾添加。`"$"`

考虑到第 (1) 和 (2) 点，一个例子是：

```
var haystack = "A. BAIL. Of. Hay.";
var needle = "bail.";
var needleRegExp = new RegExp(needle.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&"), "i");
var result = needleRegExp.test(haystack);
alert(result); 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2018-04-28T19:51:32.583

ES6+：

```
let string="Stackoverflow is the BEST";
let searchstring="best";

let found = string.toLowerCase()
                  .includes(searchstring.toLowerCase()); 
```

`includes()``true`如果`searchString`出现在一个或多个位置或其他位置，则返回`false`。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-08-24T19:11:57.910

如果您担心“未终止字符类”的情况，删除所有非字母数字字符会有所帮助：

```
searchstring = searchstring.replace(/[^a-zA-Z 0-9]+/g,'');
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-07-12T00:51:22.353

我喜欢@CHR15TO 的答案，与我在其他类似问题上看到的其他答案不同，该答案实际上显示了如何正确转义用户提供的搜索字符串（而不是说有必要而不显示如何）。

但是，它仍然很笨重，并且可能相对较慢。那么，为什么不针对可能对编码人员的常见要求制定具体的解决方案呢？（为什么不将它包含在 ES6 API BTW 中？）

我对类似问题的回答 [ [https://stackoverflow.com/a/38290557/887092]](https://stackoverflow.com/a/38290557/887092])启用了以下功能：

```
var haystack = 'A. BAIL. Of. Hay.';
var needle = 'bail.';
var index = haystack.naturalIndexOf(needle); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-06-23T11:16:03.067

不区分大小写的比较有两种方式：

1.  将字符串转换为大写，然后使用严格运算符 ( `===`) 进行比较。严格的运算符如何处理操作数在以下位置阅读内容： [http ://www.thesstech.com/javascript/relational-logical-operators](http://www.thesstech.com/javascript/relational-logical-operators)

2.  使用字符串方法进行模式匹配：

    使用“搜索”字符串方法进行不区分大小写的搜索。阅读有关搜索和其他字符串方法的信息： [http ://www.thesstech.com/pattern-matching-using-string-methods](http://www.thesstech.com/pattern-matching-using-string-methods)

    ```
    <!doctype html>
      <html>
        <head>
          <script>

            // 1st way

            var a = "apple";
            var b = "APPLE";  
            if (a.toUpperCase() === b.toUpperCase()) {
              alert("equal");
            }

            //2nd way

            var a = " Null and void";
            document.write(a.search(/null/i)); 

          </script>
        </head>
    </html> 
    ```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-08-11T13:05:28.813

我**经常**这样做，并使用一个简单的接受可变参数的 5 行原型。它**速度很快**，可以**在任何地方**使用。

```
myString.containsIgnoreCase('red','orange','yellow') 
```

```
/**
 * @param {...string} var_strings Strings to search for
 * @return {boolean} true if ANY of the arguments is contained in the string
 */
String.prototype.containsIgnoreCase = function(var_strings) {
  const thisLowerCase = this.toLowerCase()
  for (let i = 0; i < arguments.length; i++) {
    let needle = arguments[i]
    if (thisLowerCase.indexOf(needle.toLowerCase()) >= 0) {
      return true
    }
  }
  return false
}

/**
 * @param {...string} var_strings Strings to search for
 * @return {boolean} true if ALL of the arguments are contained in the string
 */
String.prototype.containsAllIgnoreCase = function(var_strings) {
  const thisLowerCase = this.toLowerCase()
  for (let i = 0; i < arguments.length; i++) {
    let needle = arguments[i]
    if (thisLowerCase.indexOf(needle.toLowerCase()) === -1) {
      return false
    }
  }
  return true
}

// Unit test

let content = `
FIRST SECOND
"At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat."
"At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat."
"At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat."
"At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat."
"At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat."
"At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat."
FOO BAR
`

let data = [
  'foo',
  'Foo',
  'foobar',
  'barfoo',
  'first',
  'second'
]

let result
data.forEach(item => {
  console.log('Searching for', item)
  result = content.containsIgnoreCase(item)
  console.log(result ? 'Found' : 'Not Found')
})

console.log('Searching for', 'x, y, foo')
result = content.containsIgnoreCase('x', 'y', 'foo');
console.log(result ? 'Found' : 'Not Found')

console.log('Searching for all', 'foo, bar, foobar')
result = content.containsAllIgnoreCase('foo', 'bar', 'foobar');
console.log(result ? 'Found' : 'Not Found')

console.log('Searching for all', 'foo, bar')
result = content.containsAllIgnoreCase('foo', 'bar');
console.log(result ? 'Found' : 'Not Found')
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-01-29T07:46:13.780

您可以将所有内容设为小写：

```
var string="Stackoverflow is the BEST";
var searchstring="best";
var result= (string.toLowerCase()).search((searchstring.toLowerCase()));
alert(result); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-04-21T12:08:35.710

我正在尝试区分大小写的字符串搜索，我尝试了

```
 var result = string.toLowerCase().match(searchstring) 
```

并且

```
var result= string.search(new RegExp(searchstring, "i")); 
```

但我做了一些小修改，这对我有用

```
var result = string.match(new RegExp(searchstring, "i")); 
```

这将是小写，大写或组合

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2014-12-03T12:48:07.810

我注意到，如果用户输入一串文本但没有选择任何自动完成选项就离开了输入，即使该字符串与数组中的一个一致，也不会在隐藏的输入中设置任何值。所以，在其他答案的帮助下，我做了这个：

```
var $local_source = [{
        value: 1,
        label: "c++"
    }, {
        value: 2,
        label: "java"
    }, {
        value: 3,
        label: "php"
    }, {
        value: 4,
        label: "coldfusion"
    }, {
        value: 5,
        label: "javascript"
    }, {
        value: 6,
        label: "asp"
    }, {
        value: 7,
        label: "ruby"
    }];
    $('#search-fld').autocomplete({
        source: $local_source,
        select: function (event, ui) {
            $("#search-fld").val(ui.item.label); // display the selected text
            $("#search-fldID").val(ui.item.value); // save selected id to hidden input
            return false;
        },
        change: function( event, ui ) {

            var isInArray = false;

            $local_source.forEach(function(element, index){

                if ($("#search-fld").val().toUpperCase() == element.label.toUpperCase()) {
                    isInArray = true;
                    $("#search-fld").val(element.label); // display the selected text
                    $("#search-fldID").val(element.value); // save selected id to hidden input
                    console.log('inarray: '+isInArray+' label: '+element.label+' value: '+element.value);
                };

            });

            if(!isInArray){

                $("#search-fld").val(''); // display the selected text
                $( "#search-fldID" ).val( ui.item? ui.item.value : 0 );

            }
        } 
```

# windows - 如何在 Windows 上的 Perl 中获取用户和组信息？

> ID：177722
> 
> 赞同：4
> 
> 时间：2008-10-07T09:15:07.473
> 
> 标签：windows, perl, etcpasswd, getpwuid

Perl 有几个内置函数用于访问 Unix 系统（以及其他支持时）上的 /etc/passwd 以获取用户和组信息。例如，

```
my $name = getpwuid($uid); 
```

将返回给定用户 ID 的用户名，如果没有这样的用户，则返回 undef。

如果 Perl 脚本需要可移植并在 Unices 和 Windows 上运行，应该如何访问用户和组信息？ActivePerl 似乎支持 User::grent 和 User::pwent 模块，它们提供对 /etc/passwd 的按字段访问——即使在 Windows 中也是如此。奇怪的是，它们不支持内置函数 getpw* 和 getgr*。还有哪些其他选择？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T10:21:51.877

你可以使用[`Win32::NetAdmin`模块](http://aspn.activestate.com/ASPN/CodeDoc/libwin32/NetAdmin/NetAdmin.html)。

`UserGetAttributes``GroupIsMember`看起来他们做你需要的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-22T08:11:21.550

奇怪的是，微软的 Unix 服务附带的 Interix 构建的 Perl 确实支持 getpw* 和朋友。

# c++ - 使用 std::string 时出现 bad_alloc 错误

> ID：177723
> 
> 赞同：3
> 
> 时间：2008-10-07T09:15:34.023
> 
> 标签：c++, exception, stl, stdstring

我目前正在开发一个依赖于我提供文件路径的项目（例如。`C:\Path.pth`）。现在，我昨天打电话给我`std::string`，一切正常：

```
std::string path(`"C:\\Path.pth`"); 
```

但现在它不起作用。它抛出一个`bad_alloc`. 似乎 ' `\`' 字符是问题所在。我什至尝试将`\x5C`其用作它的 ascii 值，但结果相同。

现在，我的问题是，是否有可能我搞砸了一些`#define`、一些编译器选项或其他可能导致这种情况的“非代码”？我正在使用 VS 2005。

任何帮助将非常感激

* * *

皮埃尔BdR

.. 这听起来很有可能。或者至少，它必须：P

由于没有人提到某种 /SetStringCharSize:2bit-compiler 选项，我认为可以安全地假设我的代码必须在某处搞砸一些东西，而且它不仅仅是一个愚蠢的编译器选项（或类似的）是错误的。 .

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-07T10:19:38.090

正如你的错误所暗示的，问题是由于**内存分配**（即 bad_alloc 异常）。

所以要么你没有更多的内存（不太可能），要么你之前的某个地方有缓冲区溢出（在我看来很可能）或者其他一些内存问题，比如双重释放。

简而言之，您所做的事情会打乱内存管理布局（即所有这些信息都在分配的块之间）。检查此呼叫**之前**发生的情况。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T12:17:19.693

该错误已被发现并修复。

似乎 TinyXML 在与`TIXML_USE_STL`定义一起使用时存在错误。因此，由于某种原因，构造函数`TiDocument`严重损坏了我的内存布局，以至于`std::string`我定义的下一个必须抛出`bad_alloc`异常 - 幸运的是，正好在字符串的第 4 个字符上，在我的情况下是 '\'，结果在一个相当微妙的错误中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T14:05:59.693

不要忘记，您应该在路径中使用正斜杠，即使在 Windows 上也是如此：

> [15.16] 为什么我不能打开不同目录中的文件，例如“..\test.dat”？
> 
> 因为“\t”是一个制表符。
> 
> 您应该在文件名中使用正斜杠，即使在使用反斜杠的操作系统（DOS、Windows、OS/2 等）上也是如此。例如：

```
#include <iostream>
#include <fstream>

int main()
{
  #if 1
    std::ifstream file("../test.dat");  // RIGHT!
  #else
    std::ifstream file("..\test.dat");  // WRONG!
  #endif

  ...
} 
```

> 请记住，反斜杠（“\”）在字符串文字中用于创建特殊字符：“\n”是换行符，“\b”是退格，“\t”是制表符，“\a”是“alert”、“\v”是一个垂直制表符等。因此文件名“\version\next\alpha\beta\test.dat”被解释为一堆非常有趣的字符。为了安全起见，请改用“/version/next/alpha/beta/test.dat”，即使在使用“\”作为目录分隔符的系统上也是如此。这是因为这些操作系统上的库例程可以互换地处理“/”和“\”。
> 
> 当然，您可以使用“\\version\\next\\alpha\\beta\\test.dat”，但这可能会伤害您（您会忘记其中一个“\”的可能性非零，a相当微妙的错误，因为大多数人没有注意到它）并且它无法帮助您（使用“\”而不是“/”没有任何好处）。此外，“/”更便于移植，因为它适用于所有风格的 Unix、Plan 9、Inferno、所有 Windows、OS/2 等，但“\”仅适用于该列表的一个子集。所以“\”会让你付出一些代价，却什么也得不到：改用“/”。

（来自[C++ FAQ Lite](http://www.parashift.com/c++-faq-lite/input-output.html#faq-15.16 "C++ 常见问题解答精简版")）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T09:18:37.713

将字符串定义为：“C:\\Path.pth”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T09:19:26.807

不，你昨天也没有让它“工作”。'\' 需要像这样转义：

```
std::string path("c:\\path.pth"); 
```

你昨天可能做了一个正斜杠，它也可以在这种情况下工作。

```
std::string path("c:/path.pth"); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-10-14T14:30:38.023

这可能仅仅是因为需要一个干净的构建；当我遇到这种情况时，情况确实如此。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-07T10:09:01.827

假设你的双反斜杠是正确的，我猜你是在 Vista 上运行的？

Vista默认不会让你写入C盘根目录。尝试以下方法之一：

*   关闭 UAC，或
*   以“管理员”身份运行您的应用程序，或
*   写入子目录。

# asp.net - 在 ASP.NET 中读取 HtmlInputHidden 的动态更改值

> ID：177725
> 
> 赞同：0
> 
> 时间：2008-10-07T09:16:31.510
> 
> 标签：asp.net, javascript, controls

我有一个带有 HtmlInputHidden 字段的简单页面。我使用 javascript 来更新该值，并且在回发页面时我想读取该 HtmlInputHidden 字段的值。

该 HtmlInputHidden 字段的 Value 属性在回发时是默认值（它在创建页面时具有的值，而不是通过 javascript 反映的值）。

我还尝试使用 ScriptManager.RegisterHiddenField(Page, "MyHtmlImputHiddenField", "initialvalue") 注册 HtmlInputHidden 字段，但它仍然只能让我读取“初始值”，即使我（通过 javascript）可以检查该值已更改。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T11:50:47.003

输入字段需要在表单中。还要确保 ViewState 已启用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T11:48:51.547

理想情况下，您希望使用 asp.net HiddenField 控件

```
<asp:HiddenField id="myHiddenField" runat="server" /> 
```

然后，您将能够在页面处理时从后面的代码中读取值。

```
string value = myHiddenField.Value; // retrieve the value in hidden field 
```

参考；[HiddenField Web 服务器控件概述](http://msdn.microsoft.com/en-us/library/ms227988(VS.85).aspx)

*   `control.ClientID`请注意客户端（即当您从 javascript 访问时）的控件 ( ) 的 DOM 名称，因为它可能会根据您在页面上声明控件的位置而改变。

# asp.net - 不要在下拉列表中显示 HTML 代码和实体

> ID：177727
> 
> 赞同：1
> 
> 时间：2008-10-07T09:17:03.927
> 
> 标签：asp.net

当我添加   或é 对于列表项的文本值，它显示 HTML 实体的代码而不是结果（空格或 é）。

我可以添加“物理”不间断空格或特殊字符，但如果可能的话，我想避免这种情况。有时存储在数据库中的数据是经过编码的，我不想总是在显示数据之前对其进行处理。

有什么解决办法吗？

谢谢

编辑说明：先前的描述指出它是关于模拟树视图的下拉列表，但这只是一个示例；我不能也不想用其他任何东西替换下拉列表。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-07T10:12:01.273

ListItems 会自动进行 HtmlEncoded。

您可以事先对列表项进行 HtmlDecode，因此当它们被 HtmlEncoded 时，您会得到正确的字符：

```
DropDownList1.DataSource = new List<string> { Server.HtmlDecode("A&hellip;"), Server.HtmlDecode("B&nbsp;C") };
DropDownList1.DataBind(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T09:22:43.807

您可以将[`<optgroup>`](http://www.w3schools.com/tags/tag_optgroup.asp "W3Schools OPTGROUP 标签")标签用于分层（即树状）下拉菜单。

```
<select>
    <optgroup label="Parent 1">
        <option>Child 1.1</option>
        <option>Child 1.2</option>
    </optgroup>
    <optgroup label="Parent 2">
        <option>Child 2.1</option>
        <option>Child 2.2</option>
    </optgroup>
</select> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T09:21:39.317

标准下拉列表在表示树视图方面非常差。

如果顶层不可选择（请参阅[optgroup](http://www.w3.org/TR/html4/interact/forms.html#edef-OPTGROUP)元素 [1]），它们可以处理更深一层（请参阅 optgroup元素 [1]），但除此之外，我建议您使用常规列表（有序或无序），并根据需要进行尽可能多的嵌套（记住子列表进入内部列出其父列表中的项目），并在每个可选列表项中包含一个复选框或单选按钮。

如果需要，可以添加一些 JavaScript 来操作类以创建下拉效果。

[1] Optgroup 应该能够更深入，但是 IIRC，浏览器支持很糟糕。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T09:23:26.270

尝试使用 ul(ol) 并使用 css。如果满足某些要求，您可以使用 jquery 更改样式（li 具有 value 属性）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-03-04T21:27:38.287

问题中描述的问题不是我使用当前版本的 ASP.NET 看到的问题——当我尝试它时，以下两个`&ndash;`都正确呈现：

```
 <asp:RadioButtonList ID="Visibility" runat="server">
        <asp:ListItem Value="public" Text="Public &ndash; All users"></asp:ListItem>
        <asp:ListItem Value="private">Private &ndash; Only you</asp:ListItem>
    </asp:RadioButtonList> 
```

# sql-server - 从文本文件更新客户端 SQL Server 数据库结构

> ID：177747
> 
> 赞同：0
> 
> 时间：2008-10-07T09:24:41.993
> 
> 标签：sql-server, database, compare

我们有一个“主数据库结构”，需要一个例程来保持客户端站点上的数据库结构是最新的。

已[针对相关问题](https://stackoverflow.com/questions/115389/update-sql-sever-database-schema-with-software-update "这里")提出了许多建议，但我正在寻找更具体的解决方案，如下所示：

1.  我想生成一个描述整个数据库结构的文本文件（XML 或其他可读格式）（这可以进入版本控制）。该例程将在内部运行，以提供与我们产品的下一个版本一起分发的数据库模式文件。
2.  然后我需要一种方法来更新客户端站点上的数据库结构，使其与主数据库结构相对应。（换句话说，我不想跟踪不同版本的数据库结构的大量更改脚本，而是一个更通用的例程，可以将客户端数据库结构更新为当前的主数据库结构。）

所以我正在寻找的主要功能可以描述为“数据库结构到文本”和“文本到数据库结构”。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T09:40:47.670

有**[很多](http://www.adeptsql.com/) [差异工具可以为您](http://www.sqlmanager.net/) [提供](http://www.sqleffects.com/)**模式和存储过程以及两个数据库之间的约束差异。你可以自己动手，但我认为如果你有一个复杂的模式，它会比这些工具中的一个更贵，许多人会免费试用，这样你就可以测试了。

问题是您必须让主数据库联机才能这样做，并且可以从客户端数据库安装（或将其安装在那里）访问，这可能可行，也可能不可行。

如果您不这样做，我能想到的唯一其他明智的选择是使用迁移的想法，保留 SQL 脚本 + 版本对的列表，以及每个数据库的当前版本。这可以通过不同的工具进行整合，该工具可以从客户端的数据库版本号和更改列表生成单个脚本。如果您没有更改列表，您可以从运行差异工具开始，并从那里跟踪它们。

您似乎更喜欢的比较文本路由（比较两种模式的文本 SQL 转储）在我看来很难正确且自动地完成，看起来不像是正确的路径。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T12:45:16.237

几种流行的策略是这种情况的变体：

*   向数据库中添加表：
    CREATE TABLE Release
    (release_number int not null,
    applied datetime not null
    )
*   作为其发布脚本的一部分，每个发布都会在此表中插入一行。
*   现在，您可以通过单个查询找出每个客户端正在运行的版本，并运行该版本和他们想要运行的版本之间的所有版本。
*   此外，您*可以*通过执行以下操作来检查每个版本的架构是否正确（正确的表名、列等）：
    SELECT so.name,
    sc.name
    FROM sysobjects so,
    syscolumns sc
    WHERE type = 'U'
    按 1、2 订购
*   然后计算结果的哈希并将其与预先计算的哈希（通过在您的参考安装上运行查询生成）进行比较，以查看安装现在是否正确。

# xml - LINQ to XML 没有获取带有模式集的数据

> ID：177750
> 
> 赞同：4
> 
> 时间：2008-10-07T09:28:00.427
> 
> 标签：xml, linq, linq-to-xml

我正在尝试使用 LINQ 获取一些 XML 数据，但遇到了问题。

我正在使用一个模式，它设置在属性 xmlns ...

```
<CarsForSale xmlns="http://schemas.sharplogic.net/CarSales.xsd">
  <CarForSale> 
```

有许多 CarForSale 元素。

当设置架构并且我这样做时......

```
XElement doc = XElement.Load(HttpContext.Current.Server.MapPath("App_Data/XML/CarsForSale.xml"));

var cars2 = from d in doc.Descendants("CarForSale")
            select d; 
```

然后我得到结果我得到枚举没有结果

从 XML 文件中去除 xmlns，数据按预期返回？

有任何想法吗？

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-07T09:30:07.380

您需要添加命名空间：

```
var ns    = "http://schemas.sharplogic.net/CarSales.xsd";
var cars2 = from d in doc.Descendants(ns + "CarForSale")            
            select d; 
```

否则按本地名称搜索：

```
var cars2 = from d in doc.Descendants()
            where d.Name.LocalName == "CarForSale"            
            select d; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-14T09:50:29.360

为避免对命名空间进行硬编码，您可以使用以下命令：

```
XNamespace ns = doc.Root.Name.Namespace; 
```

# oracle - Oracle 10g PL/SQL 中的“CONTINUE”关键字

> ID：177752
> 
> 赞同：40
> 
> 时间：2008-10-07T09:28:43.047
> 
> 标签：oracle, continue

我正在将 TSQL 存储过程迁移到 PL/SQL 并且遇到了一个问题 - Oracle 10g 中缺少 CONTINUE 关键字。

我读到Oracle 11g 有这个作为一个新特性，但不幸的是升级不是一个选项。

10g 中的 CONTINUE 有什么替代品吗？我认为将 SP 的逻辑重构为一种变通方法是不切实际的，因为我有一个外部循环、一个 IF，然后是一个嵌套的 IF，然后是该 IF 中语句块末尾的 CONTINUE。

任何帮助将不胜感激，干杯。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-10-07T09:44:26.477

[您可以使用goto 和 labels](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14261/controlstructures.htm#BCGFGDAA)模拟继续。

```
DECLARE
   done  BOOLEAN;
BEGIN
   FOR i IN 1..50 LOOP
      IF done THEN
         GOTO end_loop;
      END IF;
   <<end_loop>>  -- not allowed unless an executable statement follows
   NULL; -- add NULL statement to avoid error
   END LOOP;  -- raises an error without the previous NULL
END; 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-12T05:11:08.503

虽然它有点复杂而且只是假的，但您可以通过这种方式使用异常：

```
DECLARE
  i NUMBER :=0;
  my_ex exception;
BEGIN
  FOR i IN 1..10
  LOOP
      BEGIN
         IF i = 5 THEN
            raise my_ex;
         END IF;
         DBMS_OUTPUT.PUT_LINE (i);
      EXCEPTION WHEN my_ex THEN
         NULL;
      END;
  END LOOP;

END; 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-08-22T15:12:55.623

事实上，PL SQL 确实有一些东西可以代替 CONTINUE。您所要做的就是在循环中添加一个标签（名称）：

```
declare
   i integer;
begin
   i := 0;

   <<My_Small_Loop>>loop

      i := i + 1;
      if i <= 3 then goto My_Small_Loop; end if; -- => means continue

      exit;

   end loop;
end; 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-07-11T08:25:30.317

对于未来的搜索，他们在 oracle 11g 中添加了一条`continue`语句，可以这样使用：

```
 SQL> BEGIN
  2     FOR i IN 1 .. 5 LOOP
  3        IF i IN (2,4) THEN
  4           CONTINUE;
  5        END IF;
  6        DBMS_OUTPUT.PUT_LINE('Reached on line ' || TO_CHAR(i));
  7     END LOOP;
  8  END;
  9  /
Reached on line 1
Reached on line 3
Reached on line 5

PL/SQL procedure successfully completed. 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-28T08:51:26.553

它在 10g 中不可用，但它是11G 中的[新功能](http://www.oracle-base.com/articles/11g/PlsqlNewFeaturesAndEnhancements_11gR1.php#continue_statement)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-07T09:37:43.433

您能否将 IF 重构为一个函数，并在适当的位置返回（必要时提前）。然后控制流将在正确的位置进入循环。

那有意义吗？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-09-04T16:37:36.407

不完全优雅，但简单：

```
DECLARE
   done  BOOLEAN;
BEGIN
   FOR i IN 1..50 LOOP
      IF done THEN
         NULL;
      ELSE
         <do loop stuff>;
      END IF;
   END LOOP; 
END; 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-07T10:23:55.070

在 Oracle 中，有一个类似的语句称为 EXIT，它要么退出循环，要么退出函数/过程（如果没有要退出的循环）。您可以添加一个 WHEN 来检查某些条件。

您可以将上面的示例重写如下：

```
DECLARE
   done  BOOLEAN;
BEGIN
    FOR i IN 1..50 LOOP
     EXIT WHEN done;
   END LOOP;
END; 
```

如果您想从一些嵌套循环和逻辑的深处退出，这可能还不够，但比几个 GOTO 和 NULL 更清晰。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-09-26T12:36:51.537

这并不完全是问题的答案，但值得注意的是：

`continue`PL/SQL 和所有其他以相同方式使用它的编程语言中的语句很容易被误解。

如果编程语言开发人员`skip`改为调用关键字，会更明智、更清晰、更简洁。

对我来说，有 C、C++、Python 的背景……一直很清楚“继续”是什么意思。

但是如果没有那个历史背景，你可能会结束对这段代码的解释

```
for i in .. tab_xy.count loop
    CONTINUE WHEN some_condition(tab_xy(i));
    do_process(tab_xy(i));
end loop; 
```

像这样：

循环遍历表 tab_xy 的记录。

*如果记录满足 some_condition 则继续，否则忽略此记录。*

Do_process 记录。

**这种解释是完全错误**的，但是如果您将 PL/SQL 代码想象成一种烹饪收据并大声朗读，就会发生这种情况。

事实上，就在昨天，它发生在一位经验丰富的开发同事身上。

# algorithm - 搜索排名/相关性算法

> ID：177753
> 
> 赞同：23
> 
> 时间：2008-10-07T09:29:37.303
> 
> 标签：algorithm, search, ranking, relevance

在知识库中开发文章数据库时（例如） - 对用户问题最相关的答案进行排序和显示的最佳方法是什么？

您会根据以前的用户是否找到帮助文章来使用关键字权重等附加数据，还是认为简单的关键字匹配算法就足够了？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2012-10-20T18:29:29.257

也许最简单和最天真的方法会立即产生有用的结果，那就是实现[***tf-idf**](http://en.wikipedia.org/wiki/Tf%E2%80%93idf)：

> tf-idf 加权方案的变体经常被搜索引擎用作在给定用户查询的情况下对文档的相关性进行评分和排名的中心工具。tf–idf 可以成功地用于包括文本摘要和分类在内的各种主题领域的停用词过滤。

在我最近的一个相关问题中，我了解到一本关于这个主题的优秀免费书籍，您可以下载或在线阅读：

> [信息检索导论](http://nlp.stanford.edu/IR-book/pdf/irbookonlinereading.pdf)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T09:42:41.333

这是一个难题，像谷歌这样的公司正在努力解决这个问题。查看[Google Enterprise Search Appliance](http://www.google.com/enterprise/gsa/)或[Exalead Enterprise Search](http://www.exalead.com/software/solutions/enterprise-search/)。

然后，作为个人意见，我不认为任何“幼稚”的方法与幼稚的关键字搜索和按文档查看次数排序相比，都不会改善结果。

如果您有可能将您的知识库公开到网络上，那就去做吧，让您最喜欢的搜索引擎为您处理搜索。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-02-26T05:22:09.650

我认为这里的角度不是检索本身......它是关于对检索到的信息的相关性进行评分（一种更被动和被动的方法），以后可以用来改进搜索引擎。

我想你可以试试——

1.  tfidf 上的 knn 用于检索信息

2.  手动标记这些检索到的信息相关性分数

3.  然后对该分数进行回归以预测未知搜索结果的分数并对其进行排序。

只是一个想法...

第三点其实是基于Rocchio算法的。你可以[在这里看到](https://en.wikipedia.org/wiki/Rocchio_algorithm)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-19T22:11:41.850

对您的确切问题再具体一点会很好。您可以使用许多不同的技术。其中许多是由其他数据驱动的。您当然可以使用[Lucene](http://lucene.apache.org/)并构建自己的索引。许多语言都有与 lucene 的绑定。向上移动还有[Solr](http://lucene.apache.org/solr/)项目，它是 Lucene，它周围有很多工具和额外的功能。这可能更符合您正在寻找的内容。

意图很棘手，大多数现代搜索引擎都依赖统计意图来帮助对结果进行排序。您始终可以拥有一个本文是否有用的按钮，并存储指向有用文档的查询文本。然后，您可以在索引中添加一层信息，以提升特定的单词或短语，并帮助它们指向特定的文档。

需要考虑的一些事情...有多少文件？平均长度是多少？他们经常更新吗？用户如何处理这些文档？独特词在文档中的传播是什么样的？（更简单地说，很容易根据共同的独特特征将查询与特定文档匹配。）

如果它在网络上，您总是可以创建一个只搜索您的网站的谷歌自定义搜索引擎，尽管您可能会发现由于各种原因这不是最佳选择。

您总是可以从一个简单的索引开始，然后通过与用户交谈和捕获数据逐渐使其变得更加复杂。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T10:36:12.050

处理问题时关键字匹配是不够的，您需要了解意图，正如 joannes 所说，搜索中非常热门的话题

# visual-studio - 从 Visual Studio 迁移到 Eclipse 的指南

> ID：177761
> 
> 赞同：4
> 
> 时间：2008-10-07T09:35:19.537
> 
> 标签：visual-studio, eclipse

是否有指南可以帮助我，一个使用 Visual Studio 一段时间的 .Net 开发人员掌握 Eclipse？

甚至只是日食的快速指南。

是否有其他人进行了过渡，如果是，您是如何应对的。有小费吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-07T09:45:55.303

不确定它是否会对您有所帮助，但 Eric Sink 前段时间在从 VS 迁移到 Eclipse 时运行了一个不错的四部分系列：

[从 C# 到 Java - 第 1 部分](http://www.ericsink.com/entries/java_eclipse_1.html)

[从 C# 到 Java - 第 2 部分](http://www.ericsink.com/entries/java_eclipse_2.html)

[从 C# 到 Java - 第 3 部分](http://www.ericsink.com/entries/java_eclipse_3.html)

[从 C# 到 Java - 第 4 部分](http://www.ericsink.com/entries/java_eclipse_4.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T09:54:46.970

你用的是Vista还是XP？如果是 Vista，我会给你的一个提示是在 XP 兼容模式下运行 Eclipse。如果您使用的是 XP，则可以忽略此提示，因为它不会影响您。

如果您确实使用 Vista，请阅读[我写的这篇博文中的第 2 项 - 自动滚动](http://www.davidarno.org/2008/07/14/five-vista-annoyances-and-how-to-work-around-them/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T11:22:46.137

有一个 DZone Refcardz [Getting Started with Eclipse](http://refcardz.dzone.com/refcardz/getting-started-eclipse)（需要免费注册）

# sql - T-SQL 中的布尔“NOT”不能处理“位”数据类型？

> ID：177762
> 
> 赞同：84
> 
> 时间：2008-10-07T09:35:24.827
> 
> 标签：sql, sql-server, tsql, boolean-operations

尝试执行单个布尔 NOT 操作，似乎在 MS SQL Server 2005 下，以下块不起作用

```
DECLARE @MyBoolean bit;
SET @MyBoolean = 0;
SET @MyBoolean = NOT @MyBoolean;
SELECT @MyBoolean; 
```

相反，我越来越成功

```
DECLARE @MyBoolean bit;
SET @MyBoolean = 0;
SET @MyBoolean = 1 - @MyBoolean;
SELECT @MyBoolean; 
```

然而，这看起来有点扭曲了表达否定之类的简单事物的方式。

我错过了什么吗？

* * *

## 回答 #1

> 赞同：155
> 
> 时间：2008-10-07T10:37:58.663

使用 ~ 运算符：

```
DECLARE @MyBoolean bit
SET @MyBoolean = 0
SET @MyBoolean = ~@MyBoolean
SELECT @MyBoolean 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-10-07T09:39:38.453

您的解决方案很好...您还可以使用此语法在 SQL 中进行一些切换...

```
DECLARE @MyBoolean bit;
SET @MyBoolean = 0;
SET @MyBoolean = @MyBoolean ^ 1; 
SELECT @MyBoolean; 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-10-07T09:42:36.887

从 1 中减去该值似乎可以解决问题，但就表达意图而言，我认为我更愿意使用：

```
SET @MyBoolean = CASE @MyBoolean WHEN 0 THEN 1 ELSE 0 END 
```

它更冗长，但我认为它更容易理解。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2012-04-24T14:24:00.157

要分配反转位，您需要使用按位 NOT 运算符。使用按位非运算符“~”时，您必须确保将列或变量声明为位。

这不会给你零：

```
Select ~1 
```

这会：

```
select ~convert(bit, 1) 
```

这也会：

```
declare @t bit
set @t=1
select ~@t 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-10-07T10:54:15.930

在 SQL 2005 中没有真正的布尔值，位值实际上是别的东西。

一个位可以具有三种状态，1、0 和空（因为它是数据）。SQL 不会自动将这些转换为 true 或 false（尽管 SQL 企业管理器会混淆）

在逻辑中考虑位域的最佳方式是将其视为 1 或 0 的整数。

如果您直接在位字段上使用逻辑，它的行为将与任何其他值变量一样 - 即，如果它具有值（任何值），则逻辑将为真，否则为假。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-07T09:42:24.593

BIT 是数字数据类型，而不是布尔值。这就是为什么您不能对其应用布尔运算符的原因。
SQL Server 没有 BOOLEAN 数据类型（不确定 SQL SERVER 2008），因此您必须坚持使用 @Matt Hamilton 的解决方案。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-08-24T16:46:05.560

用于`ABS`获取绝对值（-1 变为 1）...

```
DECLARE @Trend AS BIT
SET @Trend = 0
SELECT @Trend, ABS(@Trend-1) 
```

# architecture - 软件架构师是否在敏捷中发挥作用，尤其是。Scrum？

> ID：177764
> 
> 赞同：23
> 
> 时间：2008-10-07T09:36:10.020
> 
> 标签：architecture, agile, scrum

我正在阅读 Marc 和 Laura Sewell （[亚马逊链接](https://rads.stackoverflow.com/amzn/click/com/0130607967)）的《软件架构师的职业》一书，它让我想知道软件架构师是否是旧的非敏捷 BDUF 方法的一部分。

软件架构师在敏捷方法中是否有一席之地？我对 Scrum 特别感兴趣。

顺便说一句，我目前是一家大公司的 Unix 应用程序架构师。

干杯，

抢

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-10-07T10:02:41.400

我在 Scrum 中作为架构师的角色包括以下内容。

1.  技术尖峰——概念证明——我们将如何做到这一点。（“如果你直接使用 SMTP 库会更简单，它已经包装了现有的 SMTP 库；围绕我们的包装器编写你自己的包装器并没有多大帮助。我们可以添加你想要的方法。”）

2.  开发人员之间的协调以适应预期的架构。（“嗯……你为什么要使用自己的属性文件？”

3.  与用户合作以适当地确定积压工作的优先级。（“这三个是相关的，如果我们做一个，我们会以几乎零额外成本获得另外两个。”）

4.  与管理人员合作以解决积压的问题。（不，项目经理不能这样做；他们没有技术深度。不，程序员不能这样做，他们没有概述。）

5.  阐明为什么包名称是这样的，以及为什么数据模型具有这些功能。

6.  找到我们遗漏的东西并根据技术理由重新确定积压工作的优先级（“我们将需要这个额外的冲刺来整合 [X]、升级 [Y] 并替换 [Z]，否则我们将永远无法完成这些冲刺。 ")

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-07T09:52:03.623

当然。

请记住 - 敏捷不是“给我带来摇滚乐”的方法。仍然有要求，仍然是设计，仍然需要可靠的架构。

当您正在构建产品或产品线并采用 Scrum 或其他敏捷方法来管理您的项目时，其中一个关键思想是开发一个较短的迭代周期，优先考虑要完成的任务，确定迭代中的内容A、B、C 等等。建筑师真正有价值的地方。让某人对 X、Y 和 Z 如何组合在一起有一个清晰的概念，可以使您的 Scrum 迭代更有效率。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-07T09:55:09.310

敏捷开发并不意味着无政府主义开发，它仍然需要协调才能随着时间的推移保持可维护性。

但是......也许瀑布方法和敏捷方法之间的最大区别在于，您会在瀑布中找到软件架构师PERSON，您可能会在敏捷开发中找到软件架构师技能。我的意思是，随着人们一起工作的节奏越来越快，随着时间的推移，球洞团队的技能很有可能变得更加共享，这很好。

当然，软件架构师“领导者”将是保持全局并确保所有构建块一致的人，但随着时间的推移，他不会是唯一需要参考的人，因为他的知识将被传授给其他人。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-07T09:50:58.057

绝对是的，尤其是在大中型项目上。架构师通过鸟瞰项目来提供技术指导，并负责评估和降低技术风险。开发人员的关注点往往较窄，较少受到高级别的关注。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-02-01T18:41:37.700

绝对 - 在 Scrum 团队中需要并需要架构师。也许你不会从 scrum/agile 布道者、培训师等那里听到这一点，但任何有经验的产品负责人都会告诉你。[架构师在 scrum 中的角色](http://www.1095daystofreedom.com/role-of-architect-in-scrum-team/)非常重要。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-07T09:49:59.103

完全。

您提到的开发/项目过程是用于构建架构师所设计的东西。

所以经常使用的类比，建筑师设计和规划 - 城市，道路，建筑物。

开发商建造城市、道路和建筑物。

开发人员可以使用他们需要的任何项目管理系统来完成建筑、道路上的汽车和城市的运转。

正如建筑架构师随时与工程师一起监督建筑一样，软件架构师也应该随时监督开发过程。

建筑师和开发人员这两个角色是相关的 - 但可以遵循不同的流程来实现自己的工作计划。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-07T09:41:33.567

我会说肯定有。尽管敏捷的重点是开发人员可以自由设计自己的代码，但仍然需要比单个开发人员工作的更高级别的整体程序设计。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-07T10:00:22.687

然而......敏捷最适合小型项目，专业架构师通常在大型项目中更有用。

我认为可行的方式是架构师制定总体路线图并以 Scrum 方式与团队领导一起定义必要的模块。然而，随后团队领导和他们的 Scrum 团队进行实际开发。

一种两阶段的 Scrum。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-07T09:39:52.400

我认为这更多的是技能问题而不是方法问题。所以是的，即使他有这个头衔，他也可能有一个角色。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-07T10:04:01.087

即使在可能没有严格层次结构的敏捷方法中，程序员也不会是平等的。您将拥有经验丰富的活动家、初学者、了解代码库和问题域的人以及上述内容的组合。

我认为，虽然在真正的敏捷项目中可能没有“正式的”架构，但总是存在需要解决的架构问题，通常是更有经验的团队成员具备解决其中一些问题的知识。

还要记住，内部项目方法可能与薪酬等级是分开的——因此可以说“在职”在很大程度上可能会忽略头衔。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-24T07:39:22.073

我们已经成功地实践了 1 年的 Scrum，我们的经验是有两件事必须平衡： - 系统架构是纯功能驱动开发环境中的重要“平衡点”。必须明确地进行技术层面的战略和中期规划，因为产品负责人专注于他们想要实现的下一个功能（这对他们来说当然可以）-另一方面，真正的敏捷意味着-系统架构师不应坐在象牙塔中（如前几篇文章所述）并设计仅在理论上可行的东西 - 应分发知识，以便每个团队都有足够的架构技能

我们的解决方案如下（我们在多团队环境中工作）：我们创建了一个由首席架构师（不属于 Scrum 团队的成员）的虚拟团队领导。每个团队就必须讨论的每个问题决定哪些成员希望参与讨论。团队做出共同决定。如果需要额外的工作，这可以通过一个新的用户故事来完成，或者如果它在 Scrum 之外很小。致力于决策的团队成员负责传达决策并控制其在团队内的执行。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-07T15:46:34.280

绝对地。无论如何，没有理由必须预先完成架构。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-10-09T15:30:31.240

是的，非常如此

“建筑师”是从建筑行业偷来的软件术语，旨在描述监督整个项目的人。建筑行业的建筑师是向结构工程师咨询项目外观和“人机界面”的人。可以在软件项目的构建“架构师”和“UX 设计师”之间建立更紧密的平行关系。我认为更贴切地描述软件架构师所做工作的术语是系统工程师。

那么软件架构在敏捷开发中的作用是什么？要理解这一点，了解敏捷软件开发的原则很重要。这些原则可以在此处的敏捷软件开发宣言中找到[http://agilemanifesto.org](http://agilemanifesto.org)

*   个人和交互超过流程和工具

*   工作软件优于综合文档

*   合同谈判中的客户协作

*   响应变化而不是遵循计划

更多信息在这里：[http ://carlospliego.com/2016/10/08/agileSoftwareDevelopmentAndArchitecture/](http://carlospliego.com/2016/10/08/agileSoftwareDevelopmentAndArchitecture/)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-02-21T11:46:39.810

首先：Scrum 团队是自组织的。这意味着技术管理角色没有得到太多表达。是的，团队可以选举/邀请成员担任角色。但在这个招聘角色中也应该委派给团队。是的..不是真的。除了团队的活动在会议和冲刺部分方面最强。技术架构提供史诗级别的解决方案，至少需要构建路线图、批准技术、反馈给利益相关者和其他特定的操作是我们的主题范围。此外，技术架构师的行为符合公司的企业发展利益，特别是为了保持 DRY 和其他解决方案重用、质量等原则。粗冲刺可以而且必须在多团队公司中相互关联，这也需要领导层的安排。在这些方面，架构师代表利益相关者，此外，作为实施主题的技术元素，约束，模式，技术是用户故事中的正确部分。基本上，在必要时，如果符合业务利益，架构师可以在 sprint 框架中编写代码（这在很大程度上取决于具体公司的领导代码，我认为这里没有什么超出范围的）。但是，架构师的定义角色是代表利益相关者进行业务到技术定义翻译和技术指南控制的技术解决方案 如果符合业务利益，架构师可以在 sprint 框架中编写代码（这在很大程度上取决于具体公司的领导代码，我认为这里没有什么超出范围的）。但是，架构师的定义角色是代表利益相关者进行业务到技术定义翻译和技术指南控制的技术解决方案 如果符合业务利益，架构师可以在 sprint 框架中编写代码（这在很大程度上取决于具体公司的领导代码，我认为这里没有什么超出范围的）。但是，架构师的定义角色是代表利益相关者进行业务到技术定义翻译和技术指南控制的技术解决方案

* * *

## 回答 #15

> 赞同：-3
> 
> 时间：2013-01-11T10:29:16.443

我认为没有必要，因为由 SCRUM 的原始共振峰 Jeff Sutherland 博士和 Ken Schwaber 撰写的 SCRUM 指南没有提到需要。

# qt - 如何设置组合框或双旋转框等小部件的背景颜色？

> ID：177778
> 
> 赞同：37
> 
> 时间：2008-10-07T09:41:28.293
> 
> 标签：qt, qcombobox, qspinbox

我正在尝试为双旋转框设置背景颜色，但我不确定应该使用什么功能。

我看到了一些`SetBackgroundRole`接受 a 的函数`Qt::ColorRole`，但我也不确定如何使用这个函数。

请让我知道，改变背景颜色的简单方法是`QComboBox`什么`QDoubleSpinBox`？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-10-07T13:49:00.603

fhe 通常是正确的，但没有考虑在调色板中使用不同背景角色的小部件（如旋转框和按钮/组合框）。一个更通用的解决方案是这样的：

```
QPalette pal = widget.palette();
pal.setColor(widget.backgroundRole(), Qt::blue);
widget.setPalette(pal); 
```

或者，您可以查看各种调色板角色的描述并找出您想要的角色，然后将其应用于包含您想要更改的其他角色的小部件。调色板更改应传播到子小部件。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-10-07T12:16:46.577

使用 a`QPalette`并不能保证适用于所有样式，因为样式作者受到不同平台指南和本机主题引擎的限制。

为了确保您的背景颜色正确，我建议使用[Qt Style Sheet](http://doc.qt.io/qt-4.8/stylesheet.html)。这是我为更改 a 的背景颜色所做的`QComboBox`：

`myComboBox->setStyleSheet("QComboBox { background-color: blue; }");`

我没有专门尝试过 a `QSpinBox`，但我想它会一样的！

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2010-06-02T16:57:59.577

实际上，如果您在 QComboBox 的情况下查看 QPalette 的 Qt 文档，那么后台角色可能不是您想要的。你想要的是：

> **QPalette::Base** 主要用作文本输入小部件的背景颜色，但也可用于其他绘画 - 例如组合框下拉列表和工具栏句柄的背景。它通常是白色或其他浅色。

所以这是我用来设置组合框的背景颜色的代码，我用它来匹配它所在的小部件的颜色：

```
QPalette pal = myComboBox->palette();
pal.setColor(QPalette::Base, pal.color(QPalette::Window));
myComboBox->setPalette(pal); 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-10-15T13:26:32.343

显然在 Qt 4.1 及更高版本中，您需要设置`this->setAutoFillBackground( true );`调色板以应用背景颜色。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2014-01-22T18:54:02.627

虽然以前的答案可能会为不可编辑的设置背景颜色`QComboBox`，但它们不适用于可编辑的`QComboBox`。对于这种情况，您需要派生`QLineEdit`用于编辑的小部件并重置其背景。

这是我如何让它工作的：

```
 QComboBox *myComboBox = new QComboBox();
    myComboBox->setEditable(true);
    QColor backColor = QColor(246, 230, 230);
    QLineEdit *lineEditor = myComboBox->lineEdit();
    QPalette pal = lineEditor->palette();
    pal.setColor(QPalette::Base, backColor);
    lineEditor->setPalette(pal); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-07-26T11:04:46.973

无论实际的小部件是什么，都构建一个蓝色的调色板：

```
comboBox->setPalette( QPalette( Qt::blue ) ); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-05-16T13:35:08.723

以前没有答案对我有用，但我混合了所有回复，最后在**Qt 5.12**上工作：

```
QPalette pal = ui.widget->palette();
pal.setColor(QPalette::Base, Qt::red);
ui.widget->setPalette(pal); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-07T09:51:02.797

我会尝试类似的东西

```
QPalette pal = widget.palette();
pal.setColor(QPalette::Window, Qt::blue);
widget.setPalette(pal); 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2011-01-15T17:17:35.913

```
comboBox->setPalette( QPalette( Qt::blue ) ); 
```

对我来说很好！

# windows - NT 内核编程

> ID：177804
> 
> 赞同：0
> 
> 时间：2008-10-07T09:51:43.857
> 
> 标签：windows, security, kernel, nt, code-patching

我想知道从哪里开始，或者如何连接或修补 Windows 内核（XP 及以上）。我对 McAfee Entercept 之类的软件或某些修补内核的防病毒扫描程序特别感兴趣。我想知道初创公司创建向内核添加功能的软件的可行性（我知道 KPP，并且它可能被绕过），以及这样做的任何修改。我找不到简单的描述，对 Win32 的经验有限。任何帮助深表感谢，

Ĵ

进一步澄清：我并不追求这样的驱动程序，并且会感兴趣是否在技术上可以将诸如 PaX 之类的东西移植到 Windows 上。这是一个不好的例子，因为 windows 已经有一个实现，但我很感兴趣是否可以在没有访问 NT 源代码的情况下移植类似的技术。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T09:55:56.330

是的，很可能挂接到内核中。我强烈推荐这本书[Windows Internals](https://rads.stackoverflow.com/amzn/click/com/0735619174)和[Rootkits](https://rads.stackoverflow.com/amzn/click/com/0321294319)。

这些应该为您提供所需的所有信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T09:56:41.227

Microsoft [Detours](http://research.microsoft.com/sn/detours/)库允许您拦截来自进程的 API 调用，并插入或替换您自己的代码。

请注意，成功完成这类事情可能需要的不仅仅是有限的 Win32 经验。可以想象，这可能是一个非常复杂的话题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T10:19:05.627

驱动程序开发根本不是一件容易的事。杀毒软件需要处理文件系统（文件系统过滤驱动程序），使生活变得更加复杂。如果您尝试更详细地描述您想要实现的目标，这将很有用。

最推荐的驱动程序开发资源是[OSR](http://www.osronline.com)。有 2 个相关的邮件列表：

1.  [ntdev](http://www.osronline.com/cf.cfm?PageURL=showlists.CFM?list=NTDEV)用于一般驱动程序开发
2.  [ntfsd](http://www.osronline.com/cf.cfm?PageURL=showlists.CFM?list=NTFSD)用于文件系统驱动开发

书单可以在[这里](http://www.amazon.com/Windows-Kernel-Programming-Collection/lm/R1UMVPGFE45T4U)找到。

除非驱动程序是您的核心忙碌（在这种情况下找到具有内核经验的人），否则我强烈建议将这项工作外包。在上面的列表中，您可以找到很多顾问。

不幸的是，基本上无法访问 Windows 源代码 :)。要使用虚拟内存管理器，您必须处于内核模式（如果可能的话）。

试着在 ntdev 上问这个问题，你会问世界上大多数内核开发者。您需要提出更具体的问题才能获得合理的答案（我会关注主题，有趣的话题）。
如果正确理解你想要做什么，这在 Windows 上是不可能的。至少不是没有主要的逆向工程工作，但我主要使用标准类型的驱动程序，所以我认为我知道的不够多，无法得出最终结论。

回复评论：

我不确定 Entercept 到底在做什么（在产品描述中没有发现任何暗示他们播放内存或处理权限的内容）。因此，定义最终目标而不是具体的技术如何实现这一目标可能是更有成效的方式。

对评论 2 的回应：

1.1。什么是盖子？

LIDS 是 Xie Huagang 和 Philippe Biondi 编写的 Linux 内核增强版。它实现了一些 Linux 内核本机没有的安全特性。其中一些包括：
1\. 强制访问控制 (MAC) - 不知道真正的含义。[2\. 端口扫描检测器——这在这个](http://www.pcausa.com/)网站
上绝对是可行的。 3\. 桩保护 - 文件系统过滤器驱动程序如前所述。 4\. 进程保护 - 你可以在你的驱动程序中[挂钩进程创建](http://msdn.microsoft.com/en-us/library/ms802952.aspx)，查看 ntdev 档案有很多关于此的[讨论](http://www.osronline.com/custom.cfm?pr=ntdev&searchString=PsSetCreateProcessNotifyRoutine&pageURL=http%3A%2F%2Fwww.osronline.com%2Fscripts%2Ftexis.exe%2Fwebinator%2Fsearch%2F&name=index_fullframeset.cfm)。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-11T15:19:26.287

您谈论修补内核时没有提供合理的解释来说明您为什么要这样做以及为什么您认为官方 API 不会让您到达您想要的位置。因此，我们必须假设您正计划编写某种恶意软件——不要指望 stackoverflow 上的任何人会帮助您！

# php - .Net 是否像 PHP 一样进行巧妙的连接管理？

> ID：177814
> 
> 赞同：0
> 
> 时间：2008-10-07T09:57:21.833
> 
> 标签：php, asp.net, sqlconnection

在 ASP.NET 页面加载期间，我在页面中包含的多个控件内打开和关闭多个 System.Data.SqlClient.SqlConnections。我认为创建一个连接“池”并在打开连接时检查连接字符串是否与池中打开的连接的字符串匹配并返回该连接是一个好主意。我期待看到页面加载时间有所不同，但我没有看到任何变化。我知道，使用 PHP，如果您尝试使用已在该页面请求中使用的连接字符串打开新连接，它不会尝试打开新连接，而是返回现有的打开连接。.NET 是这样吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T10:01:05.897

连接池是 ADO.NET 的一个基本特性。

阅读此[MSDN 文章](http://msdn.microsoft.com/en-us/library/8xx3tyca.aspx)或网络上可用的其他一些资源，例如此[博客文章](http://weblogs.asp.net/sjoseph/archive/2005/03/23/395601.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T10:01:50.590

是的，这基本上就是连接池在 ADO.NET 中的工作方式。

当您调用`Open()`连接实例时，它不一定会打开连接。它从池中获取一个打开的连接，匹配连接字符串。`Close()`将连接释放回池中。

# html - POST 多个参数

> ID：177815
> 
> 赞同：13
> 
> 时间：2008-10-07T09:57:42.130
> 
> 标签：html, http, jsp, post

我正在将 GET 更改为 POST。目前我有 .jsp?id=a,b,c,d。将其更改为帖子时，我仍然使用 id 参数 a,b,c,d 。这对我不起作用。我可以将逗号分隔的列表提交给 post 参数吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-07T10:00:49.907

您可以像选择表单输入一样进行操作：

url?param=value1¶m=value2¶m=value3

根据您的语言和库，您应该能够获得参数值的数组。

* * *

例如，使用 asp.net mvc 我这样做是为了获取一个字符串数组：

```
string[] values = Request.Form.GetValues("param"); 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-07T10:19:00.540

芬恩是对的。采用

```
url?param=value1&param=value2&param=value3 
```

为单个参数设置多个值。要读取 Servlet/JSP 中的值，您可以使用

```
String[] values = request.getParameterValues("param"); 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-10-07T12:46:55.407

我错了还是大多数答案都是题外话？

要准确回答您的问题，是的，您可以将逗号分隔的列表提交给 POST 参数。老实说，我只是快速尝试了一个 PHP 脚本，但我不明白为什么 Java 会有不同的行为。POST 请求的一点恰恰是您对语法的限制要少得多（无需转义 = & 等）。

因此，如果您更详细地解释什么“不起作用”，也许我们可以为您提供更多帮助。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-07T10:22:41.097

设置为通过将参数命名为数组来传递多个值。不要将输入称为“id”，而是将其称为“id[]”

```
<form method="post">
<select multiple name="id[]">
<option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
</select>
<input type="submit" value="send">
</form> 
```

处理时，记得提取命名参数发送的值数组。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-01-20T08:27:25.267

您可以使用传递多个参数

```
 xmlhttp
                .send("files=" + files.value + "&tagcount="
                        + tagcount.value); 
```

这里的**files** 和**tagcount**是要传递的参数的 id。这适用于我的 Ajax 脚本。在正常情况下，您可以通过 **&**添加参数。所以参数看起来像

```
"parameter1=" + parameter1.value + "&parameter2=" + parameter2.value 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T11:23:23.720

在发布请求中，参数列表中应该有至少 1 个参数。如果您将参数附加到请求，那么它将不起作用。为此，您需要将参数作为表单的隐藏字段发送。或尝试使用以下代码

函数 makePOSTRequest(url, 参数) {

```
 http_request = false;
  if (window.XMLHttpRequest) { // Mozilla, Safari,...
     http_request = new XMLHttpRequest();
     if (http_request.overrideMimeType) {
        // set type accordingly to anticipated content type
        //http_request.overrideMimeType('text/xml');
        http_request.overrideMimeType('text/html');
     }
  } else if (window.ActiveXObject) { // IE
     try {
        http_request = new ActiveXObject("Msxml2.XMLHTTP");
     } catch (e) {
        try {
           http_request = new ActiveXObject("Microsoft.XMLHTTP");
        } catch (e) {}
     }
  }
  if (!http_request) {
     alert('Cannot create XMLHTTP instance');
     return false;
  }

  http_request.onreadystatechange = alertContents;
  http_request.open('POST', url, true);
  http_request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  http_request.setRequestHeader("Content-length", parameters.length);
  http_request.setRequestHeader("Connection", "close");
  http_request.send(parameters); 
```

}

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-29T02:19:30.007

GET 和 POST 有两个不同的目的。来自维基百科 HTTP 条目：

> 得到
> 
> 请求指定资源的表示。请注意，GET 不应用于会导致副作用的操作，例如在 Web 应用程序中使用它来执行操作。这样做的一个原因是 GET 可能被机器人或爬虫任意使用，它们不需要考虑请求应该引起的副作用。请参阅下面的安全方法。
> 
> 邮政
> 
> 将要处理的数据（例如，从 HTML 表单）提交给已识别的资源。数据包含在请求的正文中。这可能导致创建新资源或更新现有资源或两者兼而有之。

基本上，您应该使用 GET 来获取信息，并使用 POST 来执行任何更改服务器状态的操作，例如添加新记录。

# html - 用于 Web 应用程序的廉价/免费“外观”框架

> ID：177818
> 
> 赞同：8
> 
> 时间：2008-10-07T09:59:07.570
> 
> 标签：html, templates, user-interface, usability

通常我很幸运能与真正优秀的设计师合作。他们负责我构建的所有 Web 应用程序/网站的外观和感觉。

过去，当我为我感兴趣的项目的人们完成廉价或免费的工作时，我使用了来自 templatemonster 或类似的模板。

我想参与一个相当大的内部应用程序来支持朋友的业务，通常可用的小册子模板不适合，因为这个应用程序都是关于数据访问的。

显然可用性是最重要的，我没有能力制作一个好的可用界面，我们也没有钱支付定制工作。是否有任何项目希望提供更多为大型表单、数据网格页面、图表等设计的可用 Web 模板。我不需要图形前沿的东西，我只需要一致、可用、易于应用的模板。

我查看了具有主题组件的 Ext.js，但是，即使有一堆漂亮的房子砖，我也无法设计出好看的房子 :)

谢谢

安德鲁

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-07T11:29:03.973

[开源网页设计](http://www.oswd.org/designs/browse/)是一个合理的检查场所。

如果你在 Rails 上，[Baseapp](http://www.opensourcerails.com/projects/15194-BaseApp)值得一看，如果你喜欢 37 Signals 的样子。

您还可以尝试[SproutCore](http://www.sproutcore.com/)或[Cappuccino](http://cappuccino.org/) JS 框架。

但是，您将很难找到开箱即用的“可用性”。知道在哪里以及如何放置各种元素以形成一个有凝聚力的整体是一种技能，而不是模板形式的东西。正如您所说，您可以拥有一堆漂亮的砖块，但您仍然需要一个好的砖块来使用它们。但是，上述链接可能会有所帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-10-30T17:29:52.183

[Twitter Bootstrap](http://twitter.github.com/bootstrap/)应该是这个问题的最新答案

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-07T10:03:20.620

你可以使用[YUI](http://developer.yahoo.com/yui/)，它有相当合理的 API 并且非常完整。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-08-05T15:40:25.550

[在这里](http://responsive.vermilion.com/compare.php)你可以找到关于响应式框架的一个很好的比较。以我个人的经验，我曾在多个项目上使用 Twitter Bootstrap 并喜欢它。由于我已经如此广泛地使用了其他框架，我不能（或不应该）说它是最好的，但至少它符合我的要求并且我觉得使用它很愉快。

通过简单的网络搜索，您会发现很多主题（免费和付费主题），选择最适合您需求的主题。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-07T11:58:30.963

你为什么不试试[DotNetNuke](http://www.dotnetnuke.com/)？

# asp.net - 使用 Visual Studio 开发网站时，如何缩短构建时间？

> ID：177826
> 
> 赞同：2
> 
> 时间：2008-10-07T10:02:09.670
> 
> 标签：asp.net, visual-studio, build

我在 App_Code 目录中有很多类，这可能是个问题吗？如果它在一个单独的库中，它会构建得更快吗？

还有其他提示吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T10:05:50.757

[这里](http://weblogs.asp.net/bradleyb/archive/2005/12/06/432441.aspx)有一篇不错的文章。列出的项目有：

*   不要禁用批处理编译
*   利用服务器端编译
*   将 App_Code 文件移动到单独的类库项目中
*   检查冲突的依赖项
*   在 Windows 窗体设计器选项中关闭 AutoToolboxPopulate。
*   禁用对 HTML 编辑的验证

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T10:07:16.370

我会推荐第二个项目，比如说“MyLibrary”，而不是拥有一个臃肿的 App_Code 文件夹。

# c# - 使用泛型获取随机数据

> ID：177835
> 
> 赞同：2
> 
> 时间：2008-10-07T10:06:54.187
> 
> 标签：c#, unit-testing, generics

我们的单元测试之一是使用随机数据填充业务对象中的属性。

这些属性具有不同的内在类型，因此我们希望使用泛型的力量来返回您传入的类型的数据。大致如下：

```
public static T GetData<T>() 
```

你将如何处理这个问题？低级接口可以工作吗？(IConvertible)

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-07T10:12:59.493

您可以保留已有的“易于使用”的 GetData 接口，但在内部有一个 Dictionary<Type, object> ，其中每个值都是相关类型的 Func<T> 。GetData 然后会有一个实现，例如：

```
public static T GetData<T>()
{
    object factory;
    if (!factories.TryGet(typeof(T), out factory))
    {
         throw new ArgumentException("No factory for type " + typeof(T).Name);
    }
    Func<T> factoryFunc = (Func<T>) factory;
    return factoryFunc();
} 
```

然后，您将在静态初始化程序中设置工厂字典，为您想要创建的每种随机数据类型设置一个委托。在某些情况下，您可以使用一个简单的 lambda 表达式（例如，对于整数），而在某些情况下，委托可以指向一个做更多工作的方法（例如，对于字符串）。

顺便说一下，您可能希望将我的[StaticRandom](http://pobox.com/~skeet/csharp/miscutil/usage/staticrandom.html)类用于线程安全的 RNG。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T11:12:27.267

一般来说，我会避免编写随机单元测试，因为这不是单元测试的目的。在编写单元测试时，您确实希望手动生成数据以确保覆盖类/程序中的所有路径，并且通常您在测试中对这些数据进行硬编码，以便重新运行测试。

所以我猜你真的在写冒烟测试，看看你的软件对大数据集的表现如何。在这里，我认为您应该为每个业务对象类型实现一个特定的生成器，正如其他人已经建议的那样 - 以确保数据与您在生产中的期望相当相似（例如，如果 ID 是顺序的，则生成它们顺序和不是随机的）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T10:18:10.607

这取决于您要随机化的数据，因为您要使用的*方式*或*算法*因类型而异。

例如：

```
// Random int
Random r = new Random();
return r.Next();

// Random Guid
return Guid.NewGuid();

... 
```

因此，这显然使泛型的使用成为用户端的一个很好的简化，但它没有为您编写类的方式增加任何价值。您可以使用 switch 子句或字典（如 Jon Skeet 建议的那样）：

```
switch(typeof(T))
{
    case System.Int32:
        Random r = new Random();
        return (T)r.Next();
    case System.Guid:
        return (T)Guid.NewGuid();
    ... 
```

然后您将按预期使用该类：

```
RandomGenerator.GetData<Guid>();
... 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-05-11T07:13:52.060

我会使用[AutoPoco](http://autopoco.codeplex.com/)生成测试所需的数据。

# c# - 对 petshop 4.0 中的 ICloneable 界面有疑问？

> ID：177836
> 
> 赞同：1
> 
> 时间：2008-10-07T10:07:00.817
> 
> 标签：c#, icloneable

在 Petshop 4.0 的“DBUtility”项目中，抽象类 SqlHelper 有一个方法“GetCachedParameters”：

```
 public static SqlParameter[] GetCachedParameters(string cacheKey) {
        SqlParameter[] cachedParms = (SqlParameter[])parmCache[cacheKey];

        if (cachedParms == null)
            return null;

        SqlParameter[] clonedParms = new SqlParameter[cachedParms.Length];

        for (int i = 0, j = cachedParms.Length; i < j; i++)
            clonedParms[i] = (SqlParameter)((ICloneable)cachedParms[i]).Clone();

        return clonedParms;
    } 
```

为什么不直接返回“cachedParms”？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T10:08:18.643

如果直接返回 cachedParms，则调用者可以更改数组的元素。然后缓存的内容将被有效地破坏——下一个使用相同缓存键从缓存中获取参数的调用者会得到意想不到的结果。

编辑：克隆数组本身可以防止元素被不同的参数替换。克隆元素也可以防止参数*对象*发生变异。基本上都是防御性编码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T10:20:17.717

补充一下 Jon Skeet 所说的，如果返回的缓存值在内部使用，那么您不希望用户使用可能在他们不知道的情况下更改的值。

# c# - 如何在 C# 控制台应用程序中捕获 ctrl-c (SIGINT)

> ID：177856
> 
> 赞同：255
> 
> 时间：2008-10-07T10:19:37.327
> 
> 标签：c#, .net, console

我希望能够在 C# 控制台应用程序中捕获`CTRL`+ `C`，以便在退出之前进行一些清理。这样做的最佳方法是什么？

* * *

## 回答 #1

> 赞同：263
> 
> 时间：2009-05-30T13:15:39.833

[Console.CancelKeyPress](http://msdn.microsoft.com/en-us/library/system.console.cancelkeypress.aspx)事件用于此目的。这是它的使用方式：

```
public static void Main(string[] args)
{
    Console.CancelKeyPress += delegate {
        // call methods to clean up
    };

    while (true) {}
} 
```

当用户按下 Ctrl + C 时，委托中的代码运行并且程序退出。这允许您通过调用必要的方法来执行清理。请注意，委托执行后没有代码。

在其他情况下，这不会削减它。例如，如果程序当前正在执行无法立即停止的重要计算。在这种情况下，正确的策略可能是在计算完成后告诉程序退出。以下代码给出了如何实现的示例：

```
class MainClass
{
    private static bool keepRunning = true;

    public static void Main(string[] args)
    {
        Console.CancelKeyPress += delegate(object sender, ConsoleCancelEventArgs e) {
            e.Cancel = true;
            MainClass.keepRunning = false;
        };

        while (MainClass.keepRunning) {
            // Do your work in here, in small chunks.
            // If you literally just want to wait until ctrl-c,
            // not doing anything, see the answer using set-reset events.
        }
        Console.WriteLine("exited gracefully");
    }
} 
```

此代码与第一个示例之间的区别在于`e.Cancel`设置为 true，这意味着在委托之后继续执行。如果运行，程序会等待用户按下 Ctrl + C。当发生这种情况时，`keepRunning`变量会更改值，从而导致 while 循环退出。这是一种让程序优雅退出的方法。

* * *

## 回答 #2

> 赞同：138
> 
> 时间：2008-10-07T10:24:16.460

见 MSDN：

[Console.CancelKeyPress 事件](http://msdn.microsoft.com/en-us/library/system.console.cancelkeypress.aspx)

带有代码示例的文章：

[Ctrl-C 和 .NET 控制台应用程序](http://geekswithblogs.net/mrnat/archive/2004/09/23/11594.aspx)

* * *

## 回答 #3

> 赞同：118
> 
> 时间：2012-12-16T07:28:40.717

我想补充一下[乔纳斯的回答](https://stackoverflow.com/a/929717/119527)。在 a 上旋转会导致 100% 的 CPU 使用率，并在等待+`bool`时浪费大量精力无所事事。`CTRL``C`

更好的解决方案是使用 a`ManualResetEvent`来实际“等待” `CTRL`+ `C`：

```
static void Main(string[] args) {
    var exitEvent = new ManualResetEvent(false);

    Console.CancelKeyPress += (sender, eventArgs) => {
                                  eventArgs.Cancel = true;
                                  exitEvent.Set();
                              };

    var server = new MyServer();     // example
    server.Run();

    exitEvent.WaitOne();
    server.Stop();
} 
```

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2014-04-10T18:50:34.073

这是一个完整的工作示例。粘贴到空的 C# 控制台项目中：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading;

namespace TestTrapCtrlC {
    public class Program {
        static bool exitSystem = false;

        #region Trap application termination
        [DllImport("Kernel32")]
        private static extern bool SetConsoleCtrlHandler(EventHandler handler, bool add);

        private delegate bool EventHandler(CtrlType sig);
        static EventHandler _handler;

        enum CtrlType {
            CTRL_C_EVENT = 0,
            CTRL_BREAK_EVENT = 1,
            CTRL_CLOSE_EVENT = 2,
            CTRL_LOGOFF_EVENT = 5,
            CTRL_SHUTDOWN_EVENT = 6
        }

        private static bool Handler(CtrlType sig) {
            Console.WriteLine("Exiting system due to external CTRL-C, or process kill, or shutdown");

            //do your cleanup here
            Thread.Sleep(5000); //simulate some cleanup delay

            Console.WriteLine("Cleanup complete");

            //allow main to run off
            exitSystem = true;

            //shutdown right away so there are no lingering threads
            Environment.Exit(-1);

            return true;
        }
        #endregion

        static void Main(string[] args) {
            // Some biolerplate to react to close window event, CTRL-C, kill, etc
            _handler += new EventHandler(Handler);
            SetConsoleCtrlHandler(_handler, true);

            //start your multi threaded program here
            Program p = new Program();
            p.Start();

            //hold the console so it doesn’t run off the end
            while (!exitSystem) {
                Thread.Sleep(500);
            }
        }

        public void Start() {
            // start a thread and start doing some processing
            Console.WriteLine("Thread started, processing..");
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2015-01-22T04:23:02.507

这个问题非常类似于：

[捕获控制台退出 C#](https://stackoverflow.com/questions/474679/capture-console-exit-c-sharp)

这是我解决这个问题的方法，并处理了用户按 X 和 Ctrl-C 的问题。注意 ManualResetEvents 的使用。这些将导致主线程休眠，从而释放 CPU 以在等待退出或清理时处理其他线程。注意：有必要在 main 结束时设置 TerminationCompletedEvent。不这样做会导致由于操作系统在终止应用程序时超时而导致不必要的终止延迟。

```
namespace CancelSample
{
    using System;
    using System.Threading;
    using System.Runtime.InteropServices;

    internal class Program
    {
        /// <summary>
        /// Adds or removes an application-defined HandlerRoutine function from the list of handler functions for the calling process
        /// </summary>
        /// <param name="handler">A pointer to the application-defined HandlerRoutine function to be added or removed. This parameter can be NULL.</param>
        /// <param name="add">If this parameter is TRUE, the handler is added; if it is FALSE, the handler is removed.</param>
        /// <returns>If the function succeeds, the return value is true.</returns>
        [DllImport("Kernel32")]
        private static extern bool SetConsoleCtrlHandler(ConsoleCloseHandler handler, bool add);

        /// <summary>
        /// The console close handler delegate.
        /// </summary>
        /// <param name="closeReason">
        /// The close reason.
        /// </param>
        /// <returns>
        /// True if cleanup is complete, false to run other registered close handlers.
        /// </returns>
        private delegate bool ConsoleCloseHandler(int closeReason);

        /// <summary>
        ///  Event set when the process is terminated.
        /// </summary>
        private static readonly ManualResetEvent TerminationRequestedEvent;

        /// <summary>
        /// Event set when the process terminates.
        /// </summary>
        private static readonly ManualResetEvent TerminationCompletedEvent;

        /// <summary>
        /// Static constructor
        /// </summary>
        static Program()
        {
            // Do this initialization here to avoid polluting Main() with it
            // also this is a great place to initialize multiple static
            // variables.
            TerminationRequestedEvent = new ManualResetEvent(false);
            TerminationCompletedEvent = new ManualResetEvent(false);
            SetConsoleCtrlHandler(OnConsoleCloseEvent, true);
        }

        /// <summary>
        /// The main console entry point.
        /// </summary>
        /// <param name="args">The commandline arguments.</param>
        private static void Main(string[] args)
        {
            // Wait for the termination event
            while (!TerminationRequestedEvent.WaitOne(0))
            {
                // Something to do while waiting
                Console.WriteLine("Work");
            }

            // Sleep until termination
            TerminationRequestedEvent.WaitOne();

            // Print a message which represents the operation
            Console.WriteLine("Cleanup");

            // Set this to terminate immediately (if not set, the OS will
            // eventually kill the process)
            TerminationCompletedEvent.Set();
        }

        /// <summary>
        /// Method called when the user presses Ctrl-C
        /// </summary>
        /// <param name="reason">The close reason</param>
        private static bool OnConsoleCloseEvent(int reason)
        {
            // Signal termination
            TerminationRequestedEvent.Set();

            // Wait for cleanup
            TerminationCompletedEvent.WaitOne();

            // Don't run other handlers, just exit.
            return true;
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-08-04T11:52:02.753

`Console.TreatControlCAsInput = true;`对我有用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2020-05-06T19:18:06.743

> 我可以在退出之前进行一些清理工作。这样做的最佳方法是什么这才是真正的目标：陷阱退出，制作自己的东西。上面的答案都没有正确。因为，Ctrl+C 只是退出应用程序的众多方法之一。

它需要 dotnet c# 中的什么 - 所谓的*取消令牌*传递给`Host.RunAsync(ct)`然后，在退出信号陷阱中，对于 Windows，它将是

```
 private static readonly CancellationTokenSource cts = new CancellationTokenSource();
    public static int Main(string[] args)
    {
        // For gracefull shutdown, trap unload event
        AppDomain.CurrentDomain.ProcessExit += (sender, e) =>
        {
            cts.Cancel();
            exitEvent.Wait();
        };

        Console.CancelKeyPress += (sender, e) =>
        {
            cts.Cancel();
            exitEvent.Wait();
        };

        host.RunAsync(cts);
        Console.WriteLine("Shutting down");
        exitEvent.Set();
        return 0;
     } 
```

...

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2021-11-14T21:31:39.547

检测 SIGTERM 和 ctrl+c：

```
CancellationTokenSource ctSource = new();
CancellationToken ct = ctSource.Token;

void ExitHandler()
{
    // You can add any arbitrary global clean up
    Console.WriteLine("Exiting...");
    ctSource.Cancel();
}

// Assign exit handler to be called when the process is terminated
// or the user hits CTRL+C
AppDomain.CurrentDomain.ProcessExit += (sender, args) => ExitHandler();
Console.CancelKeyPress += (sender, args) => ExitHandler();

// Then you can use the cancellation token to check for exit:
Console.WriteLine("Ready to gracefully shut down!");
while (!ct.IsCancellationRequested)
{
    Console.WriteLine($"Exit not detected, waiting another 10s.");
    Task.Delay(10000, ct).Wait(ct);
} 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2021-02-25T16:58:58.043

就我而言，我将异步 lambda 传递给`Console.CancelKeyPress`，但它不起作用。

# sql-server - 关于在 SQL Server 2005 中导出和导入平面文件（txt、csv）的问题

> ID：177860
> 
> 赞同：3
> 
> 时间：2008-10-07T10:20:01.383
> 
> 标签：sql-server

1.  导出数据时使用的最佳分隔符是什么？
2.  如果表中有 INT 字段，使用 NULL 数据的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T11:53:45.077

我不确定提问者（好名字，:JPnoui38f）想做什么。Sql Server management Studio 能够以多种不同的方式转储您的数据。您不必担心如何处理空值或使用什么分隔符。这些工具可以解决这个问题。

这是[一篇关于导入/导出向导](http://www.databasejournal.com/features/mssql/article.php/3580216)的文章。另一个选项是[数据库发布向导](http://www.microsoft.com/downloads/details.aspx?familyid=56E5B1C5-BF17-42E0-A410-371A838E570A)，它将您的数据转储到 sql 脚本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T10:27:31.133

默认情况下，我会使用 -c 选项（字符而不是二进制）执行[bcp](http://msdn.microsoft.com/en-us/library/aa196743(SQL.80).aspx)的任何操作，仅当您发现数据存在特定问题时才覆盖它。如果可能的话，我什至会尝试使用 bcp。

要从 MSSQL 本身执行此操作，您需要启用 xp_cmdshell 支持，由于安全问题，这可能是不可能的。但是如果你想在外部工具中进行，应该没有问题。

直接回答你的问题：

1.  最好的分隔符是你的数据中没有出现的字符
2.  在这些列中使用空格，任何整数都会有一个字符甚至是一个空字符

所有这一切以及更多是您应该使用现成工具的原因，所有艰难的选择都已为您考虑并做出。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T14:05:49.397

1.  如果您有嵌入控制字符的数据，您可能希望使用 bcp 而不是分隔文本进行基于前缀的导出。前缀在列前面加上长度指示符，导入读取它而不是寻找分隔符。

2.  由于某种我无法理解且找不到文档的原因，bcp 不会将空值导入数字列，即使它们可以为空。您需要制作一个包含所有 varchar 列的临时表，然后对数据进行后处理。

# java - Firefox 在 Struts 应用程序中剪切名称包含空格的文件

> ID：177863
> 
> 赞同：17
> 
> 时间：2008-10-07T10:21:26.073
> 
> 标签：java, firefox, struts

我正在使用下一个类（为了便于理解而进行了简化）在 struts Web 应用程序中下载图像。它在每个浏览器中都可以正常工作，但 Firefox 会删除包含空格的名称。也就是说：**带有 spaces.pdf**的文件在 Firefox 中被下载为：**文件**，而在 chrome 中，IE7 IE6 被下载为**带有 spaces.pdf 的文件**。

```
public class Download extends Action {
    private static final int BUFFER_SIZE = 4096;    

    public ActionForward execute(ActionMapping mapping,
        ActionForm     form,
        HttpServletRequest request,
        HttpServletResponse response) throws Exception {
        String filename = "file with spaces.pdf";
        File file =  ... // variable containing the file;
        response.setStatus(HttpServletResponse.SC_OK);
        response.setContentType(getMimeType(request, file));
        response.setHeader("Content-Type", getMimeType(request, file));
        response.setHeader("Content-Disposition","attachment; filename="+ filename);
        InputStream is = new FileInputStream(file); 
        sendFile(is, response);
        return null;
   }  

   protected String getMimeType(HttpServletRequest request, File file) {
        ServletContext application = super.servlet.getServletContext();
        return application.getMimeType(file.getName());
   }

   protected void sendFile(InputStream is, HttpServletResponse response) throws IOException {
       BufferedInputStream in = null;
       try {
            int count;
            byte[] buffer = new byte[BUFFER_SIZE];
            in = new BufferedInputStream(is);
            ServletOutputStream out = response.getOutputStream();
            while(-1 != (count = in.read(buffer)))
                out.write(buffer, 0, count);
            out.flush();            
       } catch (IOException ioe) { 
            System.err.println("IOException in Download::sendFile"); 
            ioe.printStackTrace();
       } finally {
            if (in != null) {
                try { 
                   in.close(); 
                } catch (IOException ioe) { ioe.printStackTrace(); }
            }   
       }
    }
} 
```

有谁知道这里发生了什么？注意我在 Windows Vista 下使用 firefox 3.0.3。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-10-07T10:32:29.093

文件名应该是带**引号**的字符串。（根据[RFC 2616 的第 19.5.1 节](http://www.w3.org/Protocols/rfc2616/rfc2616-sec19.html#sec19.5.1)）

```
response.setHeader("Content-Disposition","attachment; filename=\"" + filename + "\""); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T10:26:22.413

URLEncode 文件名？

或者至少用 %20 替换空格字符。

（我不知道这是否可行，但请尝试一下）

您是否也尝试过在文件名周围加上引号？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T10:25:47.610

我相信这是 Firefox 3 的一个安全功能。

开始了

[http://support.mozilla.com/tiki-view_forum_thread.php?locale=no&forumId=1&comments_parentId=91513](http://support.mozilla.com/tiki-view_forum_thread.php?locale=no&forumId=1&comments_parentId=91513)

这是不同的，但它可能会有所帮助:)

享受

# jquery - 如何使用 jQuery 复制元素的数据？

> ID：177867
> 
> 赞同：23
> 
> 时间：2008-10-07T10:23:40.017
> 
> 标签：jquery

我需要将数据值从一个元素复制到另一个元素，但 jQuery 的 clone() 方法不会克隆数据。而且我也无法遍历数据：

```
element.data().each 
```

因为`data()`是一个函数而不是一个 jQuery 对象。看来我必须保留一个单独的属性名称列表并引用它们，但这似乎太老套了。那么我该怎么做：

a) 遍历数据项
或
b)`clone()`元素及其数据。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2013-11-19T14:26:07.137

要真正只复制数据-*，这非常简单：

```
$(destination).data( $(source).data() ); 
```

这是因为使用 .data() 没有参数将返回所有数据的键值对象，反之亦然，您也可以使用键值对象一次更新多个数据。

* * *

**^(2017 年 5 月 25 日)更新**

在没有 jQuery 的 JavaScript 中，一个聪明的替代方法似乎是：

```
Object.assign(destination.dataset, source.dataset); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-06-10T09:38:25.513

回答：

> a) 迭代数据项

```
$.each(element.data(), function (name, value) {
    // ... do something
}) 
```

如果 element 是 DOM 元素，请使用：

```
$.each($.data(element), function (name, value) {
    // ... do something
}) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-18T09:43:31.143

为了提供另一种选择，即您可以将数据对象复制到包含名称/值对的新数组中，而不是克隆整个对象：

```
 function getOriginalElementData(domElementJQueryObject){
    var originalElementData = new Array();
    $.each(domElementJQueryObject.data(),function(name,value) {
       originalElementData.push({"name":name,"value":value});
    });

    return originalElementData;
} 
```

要将数据恢复到另一个对象：

```
 function restoreOriginalElementData(domElementJQueryObject,originalElementData){
    for(var i=0;i<originalElementData.length;i++){
        domElementJQueryObject.data(originalElementData[i].name,originalElementData[i].value);
    }
} 
```

遍历数据项的部分是从这个答案复制的：[jQuery loop through data() object](https://stackoverflow.com/questions/772608/jquery-loop-through-data-object#2952962)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-10-12T18:52:15.440

作为这个问题的一部分，最初没有回答的是您是否希望数据属性成为 DOM 的一部分。使用提供的许多答案将使 jQuery 的 data() API 可以访问它，但是在 DOM 中不可见（例如，使调试等事情变得更容易）。

一种方法是：

```
$.each(original.data(), function (name, value) {
    new.attr('data-' + name, JSON.stringify(value));
}); 
```

请注意，字符串化不是明确要求的。我在我的原始数据标签中嵌入了一些 JSON，如果我不这样做，我会得到 '[Object object]' 作为字符串而不是实际的 JSON。

# ibm-mq - 对 IBM MQ 系列队列中每个优先级的项目进行计数

> ID：177874
> 
> 赞同：1
> 
> 时间：2008-10-07T10:27:16.843
> 
> 标签：ibm-mq, priority-queue

我有一个 IBM WebSphere MQ 队列（在 Windows 上运行），其中包含许多不同优先级的项目。

我目前使用总深度计数，`mqQueue.CurrentDepth`但我想计算队列中每个优先级的项目数。

知道如何实现这一目标吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T11:08:21.410

您可以使用 JMS QueueBrowser 浏览队列中的消息并为每个优先级建立总计。

```
QueueBrowser browser = session.createBrowser(someQueue);
for (Enumeration iter = browser.getEnumeration(); iter.hasMoreElements()) {
  Message message = (Message) iter.nextElement();
  int priority = message.getJMSPriority();
  // update counters...
} 
```

# jsp - 如何在 jsp 页面中包含 servlet？

> ID：177883
> 
> 赞同：2
> 
> 时间：2008-10-07T10:33:52.697
> 
> 标签：jsp, servlets, include

是否可以在 jsp 页面中包含 servlet？如果是这样怎么办？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-07T10:37:22.330

您不能包含它（通过 JSP 指令之一），但您可以链接到它。JGuru 有一个很好的例子。见[这篇文章](http://www.jguru.com/faq/view.jsp?EID=740)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T10:44:09.710

您还可以使用[Jakarta IO 标记库](http://jakarta.apache.org/taglibs/doc/io-doc/intro.html)在 JSP 页面中包含一个 URL（可以是任何 URL）的内容。

# c++ - 为非 POD 类型寻找类似于 offsetof() 的东西

> ID：177885
> 
> 赞同：10
> 
> 时间：2008-10-07T10:33:54.177
> 
> 标签：c++, hdf5, offsetof

我正在寻找一种方法来获取具有非 POD 性质的 C++ 类的数据成员的偏移量。

原因如下：

我想以[HDF5](http://www.hdfgroup.org/HDF5/whatishdf5.html)格式存储数据，这似乎最适合我的材料（数值模拟输出），但它可能是一个相当面向 C 的库。我想通过 C++ 接口使用它，这需要我像这样声明存储类型（遵循[此处](http://www.hdfgroup.org/HDF5/doc1.6/cpplus_RM/classH5_1_1CompType.html#a16)和[此处](http://www.hdfgroup.org/HDF5/doc1.6/UG/11_Datatypes.html)的文档（第 4.3.2.1.1 节））：

```
class example { 
public:
    double member_a;
    int member_b;
} //class example

H5::CompType func_that_creates_example_CompType() {
    H5::CompType ct;
    ct.insertMember("a", HOFFSET(example, member_a), H5::PredType::NATIVE_DOUBLE);
    ct.insertMember("b", HOFFSET(example, member_b), H5::PredType::NATIVE_INT);
    return ct;
} //func_that_creates_example_CompType 
```

其中 HOFFSET 是一个使用 offsetof 的特定于 HDF 的宏。

问题当然是，一旦示例类变得更有特色，它就不再是 POD 类型的，因此使用 offsetof 将给出未定义的结果。

我能想到的唯一解决方法是首先将要存储的数据导出到更简单的结构，然后将其传递给 HDF。然而，这确实涉及数据复制，这正是 HDF 试图避免的（以及为什么他们有这个 CompType 使库能够访问您的对象以将其数据保存到文件）。

所以我希望你有更好的想法。理想情况下，我会为这个问题寻找一种可移植的解决方法，但如果没有的话，你可以给我一个可以在 x86 和 x86_64 上使用 GCC 的想法，我已经非常感激了。

----- 稍后附加： -----

Greg Hewgill 在下面建议将数据存储在一个简单的结构中，然后通过继承来构建实际的类。特别是对于 HDF，我认为这实际上可能行不通。比上面更复杂的使用场景：

```
class base_pod {
public:
    double member_a;
    int member_b;
}; //class base_pod

class derived_non_pod : private base_pod {
public:
    //the following method is only virtual to illustrate the problem
    virtual double get_member_a() {return member_a; }
}; //class derived_non_pod

class that_uses_derived_non_pod {
public:
    void whatever();
private:
    derived_non_pod member_c;
}; //class that_uses_derived_non_pod 
```

现在，当我们存储 that_uses_derived_non_pod 类的实例时，我们无法描述它的内存布局，就好像它有一个 base_pod 作为 member_c。这会使偏移量出错，因为 derived_non_pod 添加了一些时髦的东西（我猜是虚拟函数表？）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T11:11:29.733

Greg Hewgill 的解决方案可能比这更可取（也许使用组合而不是继承）。

但是，我认为使用 x86 和 x86_64 上的 GCC，offsetof 甚至对非 POD 类型的成员也有效，只要它“有意义”。因此，例如，它不适用于从虚拟基类继承的成员，因为在 GCC 中，它是通过额外的间接实现的。但是只要你坚持普通的公共单继承，GCC 恰好以一种方式布局你的对象，这意味着每个成员都可以在对象指针的偏移处访问，因此 offsetof 实现将给出正确的答案。

当然，问题在于您必须忽略警告，这意味着如果您做了一些不起作用的事情，您将取消对接近空指针的引用。从好的方面来说，问题的原因在运行时可能很明显。在不利的一面，eeew。

[编辑：我刚刚在 gcc 3.4.4 上对此进行了测试，实际上，当获取从虚拟基类继承的成员的偏移量时，警告升级为错误。这很好。我仍然有点担心 gcc 的未来版本（甚至是 4，我不必手头）会更加严格，并且如果您采用这种方法，您的代码将来可能会停止编译。]

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-07T11:15:28.743

根据您想要的可移植性，您甚至可以在非 POD 类型上使用 offsetof()。它不是严格一致的，但在 gcc 和 MSVC 上实现 offsetof() 的方式中，它将适用于当前版本和最近的非 POD 类型。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-07T10:36:23.190

您可以在基类中声明 POD 类型，然后扩展该类（可能通过`private`继承）以添加您的附加功能。

更新您的更新：因为 的实例`derived_non_pod`也可以被视为`base_pod`，因此数据成员的偏移量必须相同。关于实现，您的编译器将在布局结构时的字段*之后分配 vtable 指针。*`base_pod``derived_non_pod`

我突然想到，如果您使用私有继承，编译器*也许*可以选择重新排序数据字段。但是，不太可能这样做，并且将继承设置为受保护或公开将避免这种可能的陷阱。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-05T18:02:28.567

我很确定 Roel 的[回答](https://stackoverflow.com/questions/177885/looking-for-something-similar-to-offsetof-for-non-pod-types/177994#177994)以及对 onebyone 的[回答](https://stackoverflow.com/questions/177885/looking-for-something-similar-to-offsetof-for-non-pod-types/177986#177986)的考虑涵盖了您所问的大部分内容。

```
struct A
{
  int i;
};

class B: public A
{
public:
  virtual void foo ()
  {
  }
};

int main ()
{
  std::cout << offsetof (B, A::i) << std::endl;
} 
```

使用 g++，上面的输出为 4，如果 B 在基类成员“i”之前有一个 vtable，这就是您所期望的。

应该可以手动计算偏移量，即使在有虚拟基础的情况下：

```
struct A1 {
  int i;
};

struct A2 {
  int j;
};

struct A3 : public virtual A2 {
};

class B: public A1, public A3 {
public:
  virtual void foo () {
  }
};

template <typename MostDerived, typename C, typename M>
ptrdiff_t calcOffset (M C::* member)
{
  MostDerived d;
  return reinterpret_cast<char*> (&(d.*member)) - reinterpret_cast<char*> (&d);
}

int main ()
{
  B b;
  std::cout << calcOffset<B> (&A2::j) << ", " 
            << calcOffset<B> (&A1::i) << std::endl;
} 
```

使用 g++，该程序输出 4 和 8。这再次与作为 B 的第一个成员的 vtable 一致，随后是虚拟基 A2 及其成员“j”。最后是非虚拟基础 A1 及其成员“i”。

关键是你总是根据最衍生的对象计算偏移量，即。B. 如果成员是私有的，那么您可能需要为每个成员添加一个“getMyOffset”调用。此调用将执行名称可访问的计算。

您可能会发现以下内容也很有用。我认为将所有这些与您正在为其构建 HDF 类型的对象相关联很好：

```
struct H5MemberDef
{
  const char * member_name;
  ptrdiff_t offset;
  H5PredType h5_type;
};

class B  // ....
{
public:

  // ...

  static H5memberDef memberDef[];
};

H5MemberDef B::memberDef[] = {
  { "i", calcOffset<B> (&A1::i), H5::PredType::NATIVE_INT }
  , { "j", calcOffset<B> (&A2::j), H5::PredType::NATIVE_INT }
  , { 0, 0, H5::PredType::NATIVE_INT }
}; 
```

然后您可以通过循环构建 H5type：

```
H5::CompType func_that_creates_example_CompType(H5MemberDef * pDef) {
  H5::CompType ct;
  while (*pDef->member_name != 0)
  {
    ct.insertMember(pDef->member_name, pDef->offset, pDef->h5_type);
    ++pDef;
  }
  return ct;
} 
```

现在，如果您将成员添加到 B 或其基础之一，那么对该表的简单添加将导致生成正确的 HDF 类型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T11:05:12.460

问题是只要你的结构/类不是外部“C”，C++ 编译器就可以自由地重新排列和优化你的结构/类的布局，所以你最终可能会得到一个重新排序的结构，具体取决于你的编译器。

有类似 C 的行为的预处理器（例如#pragma pack）标志，但在大多数情况下它们不可移植。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T17:34:23.393

会使用指向成员的指针而不是 offsetof() 吗？我知道您可能必须进行各种强制转换才能实际使用指针，因为我猜测 InsertMember 在运行时作用于最后一个参数中指定的类型。

但是使用您当前的解决方案，您已经在使用类型系统，所以我不确定您会在那里丢失任何东西。除了指向成员的指针的语法是可怕的。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2013-04-29T02:19:04.813

这对我来说很好，我不明白为什么它不会：

```
#define myOffset(Class,Member) ({Class o; (size_t)&(o.Member) - (size_t)&o;}) 
```

# terminology - WISC（堆栈）是什么意思？

> ID：177901
> 
> 赞同：115
> 
> 时间：2008-10-07T10:40:27.003
> 
> 标签：terminology

[LAMP是代表](http://en.wikipedia.org/wiki/LAMP_(software_bundle))[Linux](http://en.wikipedia.org/wiki/Linux)、[Apache](http://www.apache.org/)、[MySQL](http://www.mysql.com/)、[PHP](http://www.php.net/)的软件/技术包/堆栈的著名首字母缩写词。与 LAMP 相比，Web 上有一些使用首字母缩略词*WISC*来表示*其他（据称以 Microsoft 为中心的）软件/技术包/堆栈的参考资料。*然而，目前在 WISC 上没有维基百科条目，也没有[来自谷歌搜索的任何相关结果](http://www.google.com/search?q=wisc+stack)。以下看起来像是 WISC 首字母缩写词的正确分解吗？

*   W =[窗户](http://www.microsoft.com/windows)
*   I = [Internet 信息服务 (IIS)](http://www.microsoft.com/iis)
*   S = [SQL 服务器](http://www.microsoft.com/sqlserver)
*   C = [C#](http://www.microsoft.com/vcsharp)

如果是，是否有一个 Web 参考使用了 WISC 的首字母缩写词？如果没有，在与 LAMP 进行比较时，是否有另一个首字母缩略词用于表示以 Microsoft 为中心的堆栈？

PS 第一次看到 WISC 在“<a href="http://www.25hoursaday.com/weblog/2007/07/05/ASPNETCachingVsMemcachedSeekingEfficientDataPartitioningLookupAndRetrieval.aspx" rel="noreferrer">ASP.NET 缓存与 memcached：寻求高效数据分区、查找和检索”。

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-10-07T10:48:07.550

或 WISA：Windows、IIS、SQL Server、ASP.net

我不知道为什么有人愿意称它为 WISC，因为这些人本质上是在说“我们永远不会使用 VB.NET、IronPython、IronRuby、F# 或任何其他 .NET 语言”。也称它为 .NET (WISN) 听起来也有点奇怪，因为 ASP.NET 是 .NET 的 Web 技术。但是，这就是首字母缩略词和标准的好处。每个人都有自己的。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-07T10:43:09.010

这看起来是正确的，尽管我会在结尾使用 .NET 而不是 .NET 生态圈中的特定语言将其称为 WISN (Wizzen)。

最好的是：

FreeBSD Apache PostgreSQL Ruby (FAPpeR) / Perl/PHP (FAPP!) ...

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-07-19T19:21:15.983

如果您要求或多或少像 LAMP 的东西，除了它在 Windows 上运行，我通常会看到

*   WAMP（Windows、Apache、MySQL 和 PHP）
*   WIMP（MS Windows；MS IIS（Internet 信息服务）；MySQL、MS SQL Server 或 MS Access；PHP、Perl 或 Python）。

在一个完全不相关的话题上，

当我使用术语“WISC”时，我总是在谈论一些 WISC（[可写指令集计算机](http://en.wikipedia.org/wiki/Microcode#Writable_control_stores)）设计，例如 Intel Xeon。其中许多是“堆栈计算机”（堆栈机器）。最著名的也许是[Philip Koopman 设计的 WISC CPU/16 和 WISC CPU/32；每个设计都是“堆栈计算机”](http://www.ece.cmu.edu/~koopman/stack.html)（与“内存到内存机器”或“RISC”或“累加器机器”相对）。

# domain-driven-design - 如何避免贫乏的领域层仍然有丰富的验证和业务规则

> ID：177905
> 
> 赞同：13
> 
> 时间：2008-10-07T10:41:56.517
> 
> 标签：domain-driven-design

如果你有一个域对象，并且你想做一些有用的和对该域对象的核心责任的事情，比如确保它是有效的，你有时需要访问相关对象的状态来执行这个验证。

如何避免需要调用存储库或数据访问层的域对象？由于性能原因，您不能总是遍历集合关系，即使使用延迟加载也是如此，并且您经常希望在域对象中执行查询。您可以将存储库实现依赖注入到域中，但不是真正纯粹的并且使测试复杂化。

我总是放松一些事情，并允许使用 DI 从域访问存储库。我没有看到如何在一个复杂的应用程序中拥有一个“纯”域层的明确示例，它也不是贫血的，并且有一个服务/应用程序层来做所有的工作，并弄乱应该是域对象的内部结构。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-07T11:12:49.747

*   如果对象是一个值对象，它应该是不可变的并且在构造过程中被验证。

*   如果对象是根聚合，并且它自己的状态足以告诉您它是否有效，您可以在其上添加一个验证方法，该方法通过聚合级联。

*   最后，我认为这是您主要关心的问题，如果您需要访问多个相关对象（不在同一个聚合中）以确保其中一个有效，您肯定需要在特定的验证服务中删除此逻辑。

我真的认为将服务和存储库注入实体不是最佳选择。创建专用服务似乎更合适，我不明白为什么它会导致您拥有贫乏的域对象。

简而言之，如果您可以在不依赖服务或存储库的情况下验证对象状态，则让对象在聚合根级别处理它。当您需要查询服务或存储库时，或者当您需要其他实体时，强烈考虑将此逻辑移到对象之外。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-09-06T09:54:36.970

几个小时前我回答了一个类似的问题。答案包含我在尝试用逻辑和行为丰富我的模型时使用的一些指导，而不会使它因依赖于基础设施技术相关的东西而变得肮脏。 [将现实世界的逻辑放入 DDD 领域层时遇到问题](https://stackoverflow.com/questions/7306109/having-trouble-putting-real-world-logic-into-the-ddd-domain-layer/7316621#7316621)

答案还链接到其他有用的资源。

祝你好运，随时给我发邮件或询问我有关 DDD 和避免贫血模型的信息。这是一个有趣的话题，人们倾向于以不同的方式解决这个问题。

# c++ - 来自 QObject::connect 的详细信息

> ID：177906
> 
> 赞同：1
> 
> 时间：2008-10-07T10:42:26.093
> 
> 标签：c++, qt, qobject

如果发生故障，有没有办法从中获取详细的故障信息`QObjet::connect`？

返回的布尔值不提供有关失败原因的任何信息。

我希望异常在 C++ 中能像在 Java 中一样被广泛使用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T13:44:07.053

除了其他答案之外，您还可以安装自己的函数，用于 Qt 调试、警告或致命消息。我们的程序有这个，对于调试版本，如果它是警告或致命消息，我们会弹出一个详细说明问题的对话框。我相信大多数丢失的插槽连接都显示为警告消息，其中详细说明了它试图连接的内容。很多时候，我看着它显示的内容，它与我认为我正在连接的内容有点不同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T12:05:10.513

正如 OregonGhost 所说，您必须在运行时检查输出以查看有关连接失败的更多信息。

为确保 Qt 在运行时显示的信息有用，请确保给 QObjects 一个不同的名称（QObject::setObjectName()）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T10:57:43.707

如果我没记错的话，调试版本会向调试器输出更详细的错误消息。不止一次帮助我修复了一个错误。

# python - 访问 python egg 自己的元数据

> ID：177910
> 
> 赞同：6
> 
> 时间：2008-10-07T10:43:22.847
> 
> 标签：python, setuptools, pkg-resources

我使用 setuptools 制作了一个 python egg，并希望在运行时访问它的元数据。我目前正在工作：

```
import pkg_resources
dist = pkg_resources.get_distribution("my_project")
print(dist.version) 
```

但如果我安装了同一个鸡蛋的多个版本，这可能会无法正常工作。如果我同时安装了 egg 和开发版本，那么从开发版本运行此代码将获取已安装 egg 的版本。

那么，我如何获取*我的*鸡蛋的元数据而不是我系统上安装的一些随机匹配的鸡蛋？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T10:56:40.420

我对 Python 也有些陌生，但据我了解：

尽管您可以安装多个版本的“相同”egg（具有相同的名称），但在运行时（基于您的发现方法）任何特定代码段只能使用其中一个版本。因此，如果您的 egg 是调用此代码的那个，那么它一定已经被选为此代码*的*版本`my_project`，并且您的访问权限将是您自己的版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T11:06:09.917

确切地。因此，您应该只能获取图书馆当前可用的鸡蛋（单数）的信息。如果您的站点包文件夹中有同一个库的多个鸡蛋，请检查同一文件夹中的 easy-install.pth 以查看真正使用了哪个鸡蛋:-)

在站点注释上：这正是 zc.buildout 等系统的重点，它允许您定义将提供给您的库的确切版本，例如在开发应用程序或提供 Web 应用程序时。例如，您可以将 1.0 版用于一个项目，将 1.2 版用于另一个项目。

# wpf - 如何在 WPF 页面重新加载中设置焦点？

> ID：177911
> 
> 赞同：0
> 
> 时间：2008-10-07T10:44:06.030
> 
> 标签：wpf, focus

我有一个带有几页的类似 WPF 浏览器的应用程序。当我在页面之间切换时，我想设置键盘焦点。

第一次加载页面时，这通过调用`Control.Focus()`构造函数来工作。

但是当我在页面之间切换时，这不再起作用 - 焦点仅在第一个字段上，并且忽略了我将其更改为其他任何内容的尝试:(

页面有这个属性`KeepAlive=true`——如果这也能让焦点保持活动状态就可以了，但是仅仅将焦点设置到第一个字段是很烦人的。

我试图在加载的事件中设置焦点，但它也不起作用。似乎在重新加载页面后设置了默认焦点。

有什么办法可以将焦点设置在第二次进入页面上？**在类似浏览器的应用程序中的 WPF 页面之间切换时，我应该何时、如何以及在何处设置焦点**？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-20T16:53:08.937

尝试将 FocusManager.FocusedElement="{Binding ElementName=[...]}"`` 添加到页面中的第一个元素，并将 [...] 设置为应该获得焦点的元素的名称。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-01-24T17:40:09.273

在经历了“WPF Initial Focus Nightmare”并基于堆栈上的一些答案之后，以下证明对我来说是最好的解决方案。

首先，添加您的 App.xaml OnStartup() 以下内容：

```
EventManager.RegisterClassHandler(typeof(Window), Window.LoadedEvent,
          new RoutedEventHandler(WindowLoaded)); 
```

然后在 App.xaml 中添加 'WindowLoaded' 事件：

```
void WindowLoaded(object sender, RoutedEventArgs e)
    {
        var window = e.Source as Window;
        System.Threading.Thread.Sleep(100);
        window.Dispatcher.Invoke(
        new Action(() =>
        {
            window.MoveFocus(new TraversalRequest(FocusNavigationDirection.First));

        }));
    } 
```

必须使用线程问题，因为 WPF 初始焦点主要由于某些框架竞争条件而失败。

我发现以下解决方案最好，因为它在全球范围内用于整个应用程序。

希望能帮助到你...

奥兰

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T11:15:33.080

您是否尝试在 Loaded 事件处理程序而不是构造函数中设置焦点？导航回页面时不会重新构建页面，但如果我没记错的话，它们会重新加载。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-21T13:28:56.817

由于我没有找到解决此问题的方法，因此我使用了一个简单的解决方法：

我启动了一个辅助线程，它会在页面加载后更改焦点。

幸运的是，使用 BeginInvoke 很容易做到这一点：

```
myControl.Dispatcher.BeginInvoke(System.Windows.Threading.DispatcherPriority.Background, 
(System.Threading.SendOrPostCallback)delegate(object state) 
{ 
  myControl.Focus(); 
}); 
```

这比我预期的要好得多，所以这种解决方法可能会持续使用很长时间。

# java - 什么是 Java JPA 查询“层”的好设计

> ID：177927
> 
> 赞同：2
> 
> 时间：2008-10-07T10:52:24.420
> 
> 标签：java, hibernate, jpa, ejb

在 JPA 中，实体是带有很好注释的普通 Java 对象。但是我还没有找到与它们和数据库交互的好方法。

在我当前的应用程序中，我的基本设计始终是将基于序列的 id 作为主键，因此我通常必须通过 PK 以外的其他属性查找实体。

对于每个实体，我都有一个无状态的 EJB

```
@Stateless
public class MyEntApiBean implements MyEntApi {

@PersistenceContext(unitName = "xxx") @Inject EntityManager entityManager; 
```

查询方法都是一些变化

```
/**
 * @return A List of all MyEnts that have some property
 * @param someProp some property
 */
public List<MyEnt> getAllMyEntsFromProp(final String someProp) {

    try {
        final Query query = entityManager.createQuery("select me from MyEnt me where me.someProp = :someProp");
        query.setParameter("someProp", someProp);
        return query.getResultList();
    } catch(final NoResultException nre) {
        log.warn("No MyEnts found");
    }
    return new ArrayList<MyEnt>();
} 
```

所以：

1.  我真的很讨厌在 EJB 中使用这些方法，因为它们似乎属于实体本身，而 EJB 本地接口让我很恼火。

2.  我讨厌我在每个方法中都有“try、createQuery、getResultList、catch、log、return”的重复（主要是Java中没有闭包或“with语句”或类似的结果）。

是否有人建议以更好的方式与解决我的一个或两个问题的实体和数据库进行交互？

我目前正在考虑使用泛型和反射做一些基本方法，以获得一些通用查询方法来减少重复（问题 2）（我稍后会提出一个原型供审查）。

谢谢，安德斯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-07T10:55:07.770

试试缝。[查询对象](http://docs.jboss.com/seam/2.1.0.BETA1/reference/en-US/html_single/#d0e7527)为您完成大部分工作，并且它们很容易扩展。或者，您总是可以实现类似的模式。

一般来说，Seam 做了很多有用的东西来弥合 JPA 与您的视图和业务层之间的差距。您不必使用 JSF 来使 Seam 有用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T14:35:27.623

你是不必要的冗长。一方面，getResultList() 在没有返回任何行时不会抛出异常（至少在 Eclipse 或 Toplink 中不会——我无法想象另一个提供者会有什么不同）。getSingleResult() 会， getResultList() 不会。此外，您可以使用构建器模式：

```
@SuppressWarnings("unchecked")
public List<MyEnt> getAllMyEntsFromProp(final String someProp) {
  return entityManager.createQuery("select me from MyEnt me where me.someProp = :someProp")
    .setParameter("someProp", someProp);
    .getResultList();
} 
```

如果有任何结果，则应该足以返回结果列表，如果没有，则返回空列表。有两点需要注意：

1.  @SuppressWarnings("unchecked") 是不必要的，但在将非泛型 List 结果从 getResultList() 转换为泛型 List 时，它消除了其他不可避免的警告；和

2.  可能值得用 MyEnt 上的 @NamedQuery 替换 createQuery() 调用（通常）。一方面，这将启用部署时验证和其他有用的东西。

它相当简洁和完整。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T11:46:12.207

如果您进行大量文本搜索，也许您还应该考虑一些索引框架，例如[Compass](http://www.compass-project.org/)。
我不知道它是否适合您的应用程序，但如果适合，它可以同时改进代码设计和性能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-07T12:31:33.317

我实际上正在使用Seam。查询对象建议让我找到了 Hibernates [Criteria queries](http://www.hibernate.org/hib_docs/v3/reference/en/html/querycriteria.html) (Query By Example)[功能](http://www.javalobby.org/articles/hibernatequery102/)。这似乎非常接近我正在寻找的东西。

也许在一个基类中，并带有一些[泛型](http://www.jboss.com/index.html?module=bb&op=viewtopic&p=4007946#4007946)......？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-19T07:50:50.480

嗬嗬！

这是我的单一结果版本（我在桌面 JPA 应用程序中使用它和 TopLink 基本要素）：

```
public class JPA {
  @SuppressWarnings ("unchecked")
  public static <T> T querySingle(
      EntityManager em, 
      Class<T> clazz, 
      String namedQuery, 
      Pair... params) 
  {
    Query q = em.createNamedQuery(namedQuery);
    for (Pair pair : params) {
      q.setParameter(pair.key, pair.value);      
    }
    List<T> result = q.getResultList();
    if ( result.size() == 0 ) {
      return null;
    }
    if ( result.size() == 1 ) {
      return result.get(0);
    }
    throw new 
      IllegalStateException(
        "To many result rows for query: " 
         + namedQuery 
         + " where " 
         + Arrays.toString(params));
  }

  public static class Pair {
    String key;
    Object value;

    public static Pair param (String key, Object value) {
      return new Pair (key, value);
    }

    public Pair (String key, Object value) {
      this.key = key;
      this.value = value;
    }

    @Override
    public String toString() {
      return key + "=" + value;
    }
  }
} 
```

以及用法：

```
import static org.sepix.JPA.*;
...

String id = ...
Customer customer = querySingle (em, Customer.class, 
                      "Customer.findByID", Pair.param ("id", id)); 
```

或者：

```
String inquiryID = ...
Boolean current = Boolean.TRUE;
Inquiry inq = querySingle (em, Inquiry.class, 
                      "Inquiry.findCurrent", 
                      Pair.param ("inquiry", inquiryID),
                      Pair.param ("current", current)); 
```

最好的问候，乔希。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-02-04T20:29:04.467

我更喜欢使用 Spring 的 JpaDaoSupport，它有助于处理 JPA。一个很好的例子是这里[http://github.com/rafalrusin/jpaqb/blob/master/src/test/java/jpaqb/CarDao.java](http://github.com/rafalrusin/jpaqb/blob/master/src/test/java/jpaqb/CarDao.java)。

一个很好的逻辑分离是有一个 DAO 类（数据访问对象）和 DTO（数据传输对象）。DAO 通常包含所有必需的查询，而 DTO 是具有字段的实体。

# sharepoint - 用户未出现在 Sharepoint Audiences 中

> ID：177929
> 
> 赞同：2
> 
> 时间：2008-10-07T10:52:55.077
> 
> 标签：sharepoint, active-directory, moss

我们正在运行 MOSS 2007，配置文件来自我们的活动目录。我们使用的一项功能是“受众”，它根据特定的广告组进行编译。我们对很少有没有被包含在观众中的帐户有问题。例如，我们有“采购”的 AD 组，其中 16 个用户中有 15 个包含在使用“采购”组中的成员资格作为其标准的受众中。

这似乎是该帐户特有的东西，但我看不到该帐户与任何其他帐户不同的任何内容。AD 访问由具有完全读取和写入 AD 权限的帐户完成。

关于可能是什么原因的任何想法？我不知道在哪里看，因为观众编译不会引发任何错误。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T15:33:50.800

我没有找到一个好的解决方案，但我确实发现了这个关于这些问题的非常好的帖子：

[http://www.moss2007.be/blogs/vandest/archive/2008/12/11/add-a-new-security-group-to-an-audience.aspx](http://www.moss2007.be/blogs/vandest/archive/2008/12/11/add-a-new-security-group-to-an-audience.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-17T16:33:02.437

进入观众规则并删除并重新创建操作数。之后，它应该选择未添加的用户。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-17T23:47:35.057

不久前我遇到了类似的问题，结果由于某种原因，当我试图编译受众的组是用户的主要组时（它是一个不属于域用户组的测试帐户) 观众汇编不会选择该用户。

我必须将用户的主要帐户设置为其他内容，进行新的配置文件导入，然后重新编译受众并且它起作用了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-11T21:42:06.003

问题帐户属于多少组？过去我曾看到用户是大量 AD 组（如 50 个左右）的成员的问题。并且检查事物的 .NET 代码具有它将返回的最大信息量，或者存在超时，或者完全是其他的东西。无论如何，我们做了一些检查，问题帐户不必要地是其中一些组的成员。清理会员固定的东西。作为记录，这是在一个普通的旧 ASP.NET 应用程序中，而不是 SharePoint，但它可能值得一看。

另外，您是否部署了 SP1 并检查了补丁？我知道在我们应用 SP1 之前，我们在受众编译方面遇到了一些麻烦（当然，也许还有另一个修补程序，但我不确定这个修补程序）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T06:46:10.267

我会检查日志文件（在 \12 配置单元中），看看是否有更多与受众汇编相关的信息。

如有必要，您可以通过在管理中心站点中配置日志记录来为该组件记录更多信息。

# iphone - 如何使用 OpenGL ES 1.1 实现海洋表面效果？

> ID：177935
> 
> 赞同：3
> 
> 时间：2008-10-07T10:55:58.703
> 
> 标签：iphone, opengl-es

我正在开发一款发生在海面上的 iPhone 游戏。有人可以推荐一些示例代码或教程来在 OpenGL 中实现波浪或涟漪吗？

在我写这篇文章时，iPhone 只支持 OpenGL ES 1.1，所以不支持着色器或其他花哨的效果。

我不需要太花哨的东西。例如，我不需要反射。我不想让设备负担过重。我只需要一些看起来像海洋的东西。（但如果它看起来像锦鲤池一样漂亮就好了。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-07T11:11:29.577

iPhone 在功能上很像 1999 年的 GPU（例如 NVIDIA Riva TNT 2）。所以你最现实的选择只是混合几个滚动纹理。

例如，具有某种“波浪图案”的一种纹理。将其设置为两个纹理阶段，并以不同的方向/速度滚动（通过纹理矩阵）。设置纹理组合器将纹理添加在一起以获得最终结果（或执行一些其他操作；这里有很多可能性）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-07T12:52:45.020

将形式的术语加在一起：

```
a * sin(b * x + c * y + d * t) 
```

每个这样的项都会以这种方式产生一组无聊的直波：`a`是这些波贡献的幅度（高度），`b`并`c`控制波的相对方向和频率（间距），并`d`沿该方向移动波`t`（模拟时间）变化。

试验几个该形式的项，保持`t`不变，得到一个起伏的表面。然后，您可以“调整”系数以获得您喜欢的粗糙度。一旦你找到了几组你满意的系数，就让它`t`变化起来。

# xsd - 如何在 XML Schema 中定义多个具有相同名称和不同属性值的元素？

> ID：177945
> 
> 赞同：10
> 
> 时间：2008-10-07T10:57:03.663
> 
> 标签：xsd

我想为这块 xml 创建 XML Schema，我想限制“name”属性的值，以便在输出文档中，每个工作日只允许一个 day 实例：

```
<a>
  <day name="monday" />
  <day name="tuesday" />
  <day name="wednesday" />
</a> 
```

我试过用这个：

```
 <xs:complexType name="a">
  <xs:sequence>
    <xs:element name="day" minOccurs="1" maxOccurs="1">
      <xs:complexType>
        <xs:attribute name="name" use="required">
          <xs:simpleType>
            <xs:restriction base="xs:string">
              <xs:enumeration value="monday" />
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
      </xs:complexType>
    </xs:element>
    <xs:element name="day" minOccurs="1" maxOccurs="1">
      <xs:complexType>
        <xs:attribute name="name" use="required">
          <xs:simpleType>
            <xs:restriction base="xs:string">
              <xs:enumeration value="tuesday" />
            </xs:restriction>
          </xs:simpleType>
        </xs:attribute>
      </xs:complexType>
    </xs:element>
  </xs:sequence>
</xs:complexType> 
```

但 Eclipse 中的 XML Schema 验证器显示错误“模型组中出现多个名称为 'day'、具有不同类型的元素。”。

还有其他方法吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-02T15:29:31.410

你需要这样的东西：

```
<?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" elementFormDefault="qualified">
  <xs:element name="a">
    <xs:complexType>
      <xs:sequence>
        <xs:element maxOccurs="unbounded" ref="day"/>
      </xs:sequence>
    </xs:complexType>
  </xs:element>
  <xs:element name="day">
    <xs:complexType>
      <xs:attribute name="name" use="required">
        <xs:simpleType>
            <xs:restriction base="xs:string">
                <xs:enumeration value="monday"/>
                <xs:enumeration value="tuesday"/>
                <xs:enumeration value="wednesday"/>
            </xs:restriction>
        </xs:simpleType>
        </xs:attribute>
    </xs:complexType>
  </xs:element>
</xs:schema> 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-05-06T03:16:25.927

为了满足原始问题中描述的最多一次约束，您需要在架构中使用[xs:unique](http://msdn.microsoft.com/en-us/library/ms256146.aspx)元素。

```
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
           elementFormDefault="qualified">

  <xs:element name="a">
    <xs:complexType>
      <xs:sequence>
        <xs:element name="day" maxOccurs="7" minOccurs="1">
          <xs:complexType>
            <xs:attribute name="name" use="required">
              <xs:simpleType>
                <xs:restriction base="xs:string">
                  <xs:pattern value="(mon|tues|wednes|thurs|fri|satur|sun)day"/>
                </xs:restriction>
              </xs:simpleType>
            </xs:attribute>
          </xs:complexType>
          <xs:unique name="eachDayAtMostOnce">
            <xs:selector xpath="day"/>
            <xs:field xpath="@name"/>
          </xs:unique>
        </xs:element>
      </xs:sequence>
    </xs:complexType>
  </xs:element>

</xs:schema> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-07T12:07:51.383

你考虑过这样的事情吗？（即day是一个类型，元素以星期几命名）

```
<xs:schema attributeFormDefault="unqualified" elementFormDefault="qualified" xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:complexType name="day" />
  <xs:element name="a">
    <xs:complexType>
      <xs:sequence>
        <xs:element name="monday" maxOccurs="1" minOccurs="0" type="day" />
        <xs:element name="tuesday" maxOccurs="1" minOccurs="0" type="day" />
        <xs:element name="wednesday" maxOccurs="1" minOccurs="0" type="day" />
      </xs:sequence>
    </xs:complexType>
  </xs:element>
</xs:schema> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T11:01:50.720

试试这个：

```
<xs:schema attributeFormDefault="unqualified" elementFormDefault="qualified" xmlns:xs="http://www.w3.org/2001/XMLSchema">
<xs:element name="a">
    <xs:complexType>
        <xs:sequence>
            <xs:element maxOccurs="unbounded" name="day">
                <xs:complexType>
                    <xs:attribute name="atrib" type="xs:string" use="required" />
                </xs:complexType>
            </xs:element>
        </xs:sequence>
    </xs:complexType>
</xs:element> 
```

我认为 maxOccurs="unbounded" 是您所需要的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-15T20:22:59.187

使用选择而不是顺序

通过这种方式，你只能在一个元素中拥有一天元素

对于 name 属性，使用 ref 属性并通过枚举引用它

# windows-server-2008 - Webdav windows server 2008 不允许保存 doc 文件

> ID：177953
> 
> 赞同：0
> 
> 时间：2008-10-07T11:01:40.160
> 
> 标签：windows-server-2008, webdav

我在 windows server 2008 上设置了 web dav。它似乎工作正常，但不允许我将 word 文档保存到目录，但它允许保存文本文件。有任何想法吗？

谢谢，

亚历克斯

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-08T07:01:39.283

在以下位置找到答案： [http ://learn.iis.net/page.aspx/350/installing-and-configuring-webdav-on-iis-70/](http://learn.iis.net/page.aspx/350/installing-and-configuring-webdav-on-iis-70/)

cd c:\ cd "%WinDir%\System32\InetSrv"\

AppCmd 设置配置“默认网站/文档”“/section:system.webServer/security/requestFiltering

/+fileExtensions.[fileExtension='.doc',allowed='true'] /commit:apphost

# sql - 在 SQL 查询中将 int 或 null 转换为布尔值的最佳方法是什么？

> ID：177956
> 
> 赞同：46
> 
> 时间：2008-10-07T11:02:21.843
> 
> 标签：sql, null, boolean, type-conversion

在 SQL 查询中将 int 或 null 转换为布尔值的最佳方法是什么，例如：

*   结果中的任何非空值都是**TRUE**
*   结果中的任何空值都是**FALSE**

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-10-07T11:11:52.103

据我所知（如果我错了，请纠正我），SQL 中没有文字布尔值的概念。您可以让表达式评估为布尔值，但不能输出它们。

这就是说，您可以使用 CASE WHEN 生成一个可以在比较中使用的值：

```
SELECT 
    CASE WHEN ValueColumn IS NULL THEN 'FALSE' ELSE 'TRUE' END BooleanOutput 
FROM 
    table 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-07T11:11:17.427

不需要用例......当：

```
select (column_name is not null) as result from table_name; 
```

为所有非 NULL 字段返回 1，为所有为 NULL 的字段返回 0，这与 SQL 中的布尔值尽可能接近。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-07T11:09:30.237

```
SELECT 
    CASE
        WHEN thevalue IS NULL THEN 0
        ELSE 1
    END AS newVal
FROM .... (rest of select) 
```

我认为它是这样的

实际上，ISNULL，可能需要 WHEN thevalue IS NULL THEN 0

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-07T13:20:40.940

假设您想要 0,1 值作为返回值，并且我们正在谈论整数，我将使用[Torbjörn](https://stackoverflow.com/questions/177956/what-is-the-best-way-to-convert-an-int-or-null-to-boolean-value-in-an-sql-query#177967)指定的逻辑并将其包装在函数中

```
create function dbo.isNotNull(@a int)
returns bit
as
begin
return isnull(@a-@a+1,0)
end 
```

因此，您只需调用即可随时使用它

```
select dbo.isNotNull(myIntColumn) from myTable 
```

[Tomalak](https://stackoverflow.com/questions/177956/what-is-the-best-way-to-convert-an-int-or-null-to-boolean-value-in-an-sql-query#177987)提供的答案更加通用，因为它适用于任何数据类型

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-07T11:55:00.690

您可能想要对结果进行转换（BIT，值）。因为某些 SQL 将返回一个错误，即该值不是布尔值。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-07T11:06:27.187

```
isnull(column - column + 1, 0) != 0 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-02T06:09:22.350

在 Oracle 中，假设您使用 0 表示假，使用 1 表示真：-

```
SELECT DECODE( col, NULL, 0, 1) FROM ... 
```

您也可以使用 CASE 语法来编写它，但以上在 Oracle 中是惯用的。DECODE 有点像开关/机箱；如果 col 为 NULL，则返回 0，否则返回 1。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-05-20T06:54:55.890

我所知道的最短的甲骨文：

```
SELECT NVL2(nullableColumn, 1, 0) FROM someTable 
```

`NVL2(value, ifNotNull, ifNull)``ifNotNull`如果`value`不为空，则返回，`ifNull`否则返回。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-04-11T20:53:49.193

通常使用 1 时，表示为真，否则为其他情况。

所以：

```
SELECT  IsDefault = CASE WHEN IsDefault = 1 THEN 'true' ELSE 'false' END
FROM table 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2019-12-09T15:21:55.920

语法有效，但我必须弄清楚如何将它放在我的查询中。如果可以，我想分享一个关于如何适应扩展查询的示例：

```
select count(*) as count, inventory,
CASE WHEN inventory = 0 THEN 'empty' ELSE 'not empty' END as InventoryStatus
from mytable group by count, inventory 
```

# mysql - 用 mysql、pthreads 和 gtk 在 C++ 中编译

> ID：177960
> 
> 赞同：0
> 
> 时间：2008-10-07T11:03:32.853
> 
> 标签：mysql, windows, boolean, math.h

以前有人做过吗？？？

我正在尝试使用 MinGW 编译使用 MySQL 库的程序。我不断收到重新定义函数“rint”的消息。好的，该函数确实在来自 MySQL 的 config-win.h 和来自标准库的 math.h 两个文件中，但它们都应该是没有问题的库。

在打破我的头一段时间后，我什至尝试了这个，它不会编译：

```
#include <iostream>
#include <my_global.h>
#include <mysql.h>
using namespace std;

int main() {
    cout << "Hello World!!!" << endl; // prints Hello World!!!
    return 0;   
} 
```

这是命令以及我为编译而发出的输出

**i586-mingw32msvc-cc -I/usr/include/mysql probando.cpp -w**

```
In file included from /usr/include/mysql/my_global.h:73,
                 from probando.cpp:10:
/usr/include/mysql/config-win.h: In function ‘double rint(double)’:
/usr/include/mysql/config-win.h:229: error: redefinition of ‘double rint(double)’
/usr/lib/gcc/i586-mingw32msvc/4.2.1-sjlj/../../../../i586-mingw32msvc/include/math.h:635: error: ‘double rint(double)’ previously defined here 
```

我已经在 WindowsXP 中使用 MinGW 进行了测试，MySQL 库在 .a 库中正确转换，在 Linux 中（输出来自 Linux，与 Windows 中几乎相同）使用 MinGW32。

人们......我没有选择......任何线索？有人以前使用过 MySQL 和 MinGW 吗？它可以与 Cygwin 一起使用吗？

如果您花时间回答，请提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T12:23:15.907

也是一个猜测，但似乎 math.h 和 config-win.h 有一个名为 rint 的函数，请确保没有两个具有相同名称的函数。

顺便说一句，因为我不完全确定，我正在使这个社区可编辑，如果我不正确，请随时编辑这篇文章。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T16:26:12.797

好的，我解决了。

我的愚蠢是包括错误的文件。要在 mingw 中执行此操作，您必须 #include <windows.h> 而不是 <config-win.h>

不管怎么说，还是要谢谢你！！！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T11:31:46.667

我不知道有问题的堆栈，但我的猜测是 math.h 会以某种方式被包含在内。查看 math.h 文件。在靠近顶部的某个地方应该有一个[包含防护。](http://en.wikipedia.org/wiki/Include_guard)如果您不熟悉包含保护的概念，请点击链接。在这两个地方，您都应该使用包含守卫来包含 math.h。

您还可以查找特定于 Linux 的#define；由于某处的#define，该文件可能不会在Linux上包含两次。

正如我所说，这只是一个猜测。

# asp.net - ASP.NET 2.0 成员数据库？

> ID：177964
> 
> 赞同：1
> 
> 时间：2008-10-07T11:05:40.043
> 
> 标签：asp.net, .net, sql-server-2005, .net-2.0

我有一个应用程序数据库和一个 aspnetdb 数据库（从 ASP.Net 2.0 框架生成）。我已将两个数据库从生产环境恢复到我的开发环境，但我无法使用任何在生产环境中工作的用户凭据登录。

所以我的问题是有什么东西可以将 ASP>NET 2.0 框架生成的 aspnetdb 数据库与特定的机器联系起来吗？

如果有人曾经成功地将 aspnetdb 数据库从一台机器恢复到另一台机器，请他们阐明需要相同的变量才能访问所有以前的用户。

非常感谢！

* * *

当然，我已经检查了连接字符串并仔细检查了用户和角色，我可以通过在开发环境中创建新用户并使用这些凭据登录来确认这些用户和角色正在工作。

问题是我无法使用在实时环境中使用的任何用户凭据登录。我觉得这与两台机器上 machine.config 文件的差异有关。如果有人知道我应该在 machine.config 中查找的变量，那么我可以确保它们在两个环境（即两台机器）中都是相同的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T11:40:41.423

密码使用机器密钥 AFAIK 加密。所以你需要在所有你将要测试的地方都一样。据我所知，机器密钥可以在 web.config 中设置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T11:08:18.617

不看就很难说，但我会先检查你的 web.config 中的连接字符串。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T11:30:53.487

我已经根据下面的 Scott Gus 博客链接检查了 web.config 和连接字符串以及成员资格部分，特别是应用程序名称：

[http://weblogs.asp.net/scottgu/archive/2006/04/22/443634.aspx](http://weblogs.asp.net/scottgu/archive/2006/04/22/443634.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-07T12:02:12.347

嗨，我在 web.config 中看不到机器密钥变量我检查了该部分，发现两个环境 web.config 文件都使用相同的公钥令牌

```
 <add assembly="System.Design, Version=2.0.0.0, Culture=neutral, PublicKeyToken=B03F5F7F11D50A3A"/>
        </assemblies>
        <buildProviders>
            <add extension=".rdlc" type="Microsoft.Reporting.RdlBuildProvider, Microsoft.ReportViewer.Common, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"/>
        </buildProviders> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-07T12:08:49.930

您可以检查您的用户凭据。拥有数据库备份并不意味着您拥有所有用户信息。（例如服务器范围的用户/角色）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-02-21T05:10:58.127

使用您以前的数据库表值插入表 aspnet_membership 和 aspnet_users，其中您已加密密码并且您知道该加密的真实值并使用用户名和密码您可以登录系统，之后您可以更改密码。我有以前同样的问题，我就这样解决了。

谢谢

# com - 显示加载的 COM 对象的路径/版本信息？

> ID：177965
> 
> 赞同：0
> 
> 时间：2008-10-07T11:06:03.347
> 
> 标签：com

我有一些代码使用组件类别管理器来加载所有实现特定类别的类。

有没有一种简单的方法可以从加载的 DLL 或 EXE 中获取描述、路径和版本信息？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T19:46:40.067

当对象在同一个单元中以进程内（即从 DLL）加载时，您可能会采取一些技巧来在内存中找到 DLL。例如，如果您在虚拟方法表 (vtable) 中查找指向活动对象的代码指针，它们通常会指向 DLL。然后，您可以使用一些系统调用来确定该代码属于哪个加载的 DLL。

但是有很多潜在的陷阱。如果您必须将这些对象加载到单独的单元中，则代码指针将指向存根而不是实际代码。此外，许多 COM 库实际上在运行时提供的包装类中实现了公共接口，因此这很可能在许多常见用例中为您提供错误信息。（即，您最终会获得运行时 DLL 的信息，通常是 MFC 或 ATL）。

当一个对象被加载到进程外（即从一个 EXE 中）时，我不知道有任何合理的方法来追踪哪个 EXE 对应于活动对象。（显然，这些数据必须存在于您的进程或 COM 运行时中的某个位置，但它隐藏在存根下方的某个位置，并且可能取决于您正在运行的 Windows 版本）。

因此，除非您正在查看一组非常有限的对象（所有与您在同一个单元中加载的进程内），否则您最好的选择可能是使用注册表中的注册信息来查找您需要的内容。这很麻烦，因为这是可以从操作系统版本到版本之间变化的事情之一，但幸运的是，COM 已经存在了足够长的时间，以至于这些年来这并没有发生太大的变化。

给定您从[Component Categories Manager](http://msdn.microsoft.com/en-us/library/ms692689(VS.85).aspx)获得的对象的 CLSID ，您将查找相应的二进制文件，如下所示：

1.  打开注册表项**`HKEY_CLASSES_ROOT\CLSID\{xxxxxxxxx-yyyyy-zzzz-aaaa-bbbbbbbbbbbbbb`}**，其中大括号内的字符串是您要查找的对象的 CLSID。
2.  [如果这是一个进程内对象，将有一个名为InProcServer32](http://msdn.microsoft.com/en-us/library/ms682390(VS.85).aspx)的子项，其“默认”`REG_SZ`包含您需要的 DLL 的完整路径。
3.  [如果这是一个进程外对象，将有一个名为LocalServer32](http://msdn.microsoft.com/en-us/library/ms683844(VS.85).aspx)的子键 ，其“默认”`REG_SZ`包含您需要的 EXE 的完整路径。在某些情况下，您可能必须修剪命令行开关关闭此字符串以仅获取 EXE 路径。
4.  使用前面步骤中的 DLL 或 EXE，您可以在 Win32 中调用[GetFileVersionInfo()](http://msdn.microsoft.com/en-us/library/ms647003.aspx)（或使用[System.Diagnostics.FileVersionInfo.GetVersionInfo](http://msdn.microsoft.com/en-us/library/system.diagnostics.fileversioninfo.getversioninfo.aspx)，如果您有 .NET 可用）从可执行文件中检索版本信息结构，该结构将具有版本和里面的描述。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T18:20:47.837

假设它仅用于记录目的，获取此信息的一种方法是简单地等待所有初始化完成，然后枚举加载的模块，将每个模块的详细信息转储到日志文件中。

显然，这只适用于 inproc 对象，如果应用程序非常动态，它就不起作用，但它也会捕获非 COM DLL。

# asp.net - 多维重复数据控制

> ID：177968
> 
> 赞同：0
> 
> 时间：2008-10-07T11:06:36.483
> 
> 标签：asp.net

如果它令人困惑，请原谅我的标题，但我不知道如何描述这一点，除了下面的长解释：

我想创建一个多维、模板化、数据绑定、重复的 ASP.NET 控件，具有分页和排序功能。即，您指定每页有多少列和行，因此项目会横向和向下显示，例如

[dataItem1][dataItem2]
[dataItem3][dataItem4]

Repeater 和 DataList 控件不提供分页功能，而具有分页功能的 DataGrid 被限制为每行一个项目。我将不胜感激有关如何解决此问题的建议。为此，我仅限于 .NET 2.0。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-07T11:24:37.367

3.5有一个新的ListView控件，可以按照你描述的方式显示。

如果您调整“平铺”或“单行”视图，您可能可以做您喜欢的事情，并且它支持开箱即用的分页。

# sql - 有没有办法从时间戳类型列中获取 DateTime 值？

> ID：177970
> 
> 赞同：12
> 
> 时间：2008-10-07T11:06:44.593
> 
> 标签：sql, sql-server, tsql

我需要一个从表中选择的表，它没有告诉何时插入行的列，只有`timestamp`列（值如：0x0000000000530278）。昨天有些数据被导入到表中，现在我需要找出究竟导入了什么:(

有没有办法只使用`timestamp`信息来做到这一点？[在这里](http://www.sqlhacks.com/index.php/Dates/Timestamp)我发现：

*   时间戳是一个 8 字节的连续十六进制数，与日期和时间无关。
*   要获取时间戳的当前值，请使用：@@DBTS。

也许有一种方法可以找到`timestamp`特定时间附近的价值？这将有助于形成一个选择。或者也许有一个众所周知的解决方案？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-07T11:39:25.713

Transact-SQL 时间戳数据类型是没有时间相关值的二进制数据类型。

所以回答你的问题：*有没有办法从时间戳类型列中获取 DateTime 值？*

答案是：*没有*

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-07T11:09:15.590

SQL Server 2005 中的 timestamp 数据类型是 rowversion 的同义词，它只是一个随着每次行更新而自动递增的数字。

您可以将其转换为 bigint 以查看其值。

要获得新行或更新行所需的内容，您应该适当地添加另一个日期时间列 (lastupdate) 和触发器以在每次更新时更新该列。

对于过去已经插入的行，我认为您无法做些什么来找到确切的时间。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-07T11:36:21.417

恐怕无法将 TIMESTAMP 转换/转换为 DATETIME。它们具有完全不同的用途和不兼容的实现。

请参阅此链接 [http://www.sqlteam.com/article/timestamps-vs-datetime-data-types](http://www.sqlteam.com/article/timestamps-vs-datetime-data-types)

在线书籍也说[http://msdn.microsoft.com/en-us/library/aa260631.aspx](http://msdn.microsoft.com/en-us/library/aa260631.aspx)

> SQL Server 时间戳数据类型与时间或日期无关。SQL Server 时间戳是指示数据库中数据修改的相对顺序的二进制数。时间戳数据类型最初是为了支持 SQL Server 恢复算法而实现的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-07T11:58:09.140

另一个回答你的问题：

如果时间戳列是您恢复的唯一资源（无备份等），您可以尝试使用以下逻辑

*Timestamp 只是一个计数器的值，对于在包含时间戳列的表上执行的每个插入或更新操作，它都会递增*。

如果昨天发生的数据导入是多条记录的插入，您可能会在时间戳列中看到一系列数字，例如：

```
0x00000000000007D1
0x00000000000007D2
0x00000000000007D3
0x00000000000007D4
0x00000000000007D5 
```

最近的序列可以是您添加的数据（当然不是保证的）您可以将该知识与其他事物（如使用它们时的自动增量列）结合起来以识别您感兴趣的记录。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-04-26T10:21:31.130

其他人正确地指出时间戳是二进制计数器。然而，如果在数据库的任何表中，您有时间戳和记录它的日期时间，您可以使用该信息从任何时间戳转到日期范围。日志表是一个很好的候选者。假设您的导入表是“发票”，您可以使用如下查询：

```
WITH TS 
AS
(
SELECT 
    L1.LastDateUpdated, COALESCE(L2.LastDateUpdated, {TS '2099-12-31 00:00:00'}) as LastDateUpdatedTo,
    L1.[TIMESTAMP], L2.[TIMESTAMP] as [TIMESTAMPTo]
FROM 
(
    SELECT L1.[LastDateUpdated]
          ,L1.[TIMESTAMP]
          ,ROW_NUMBER() OVER (ORDER BY L1.[LastDateUpdated]) ID
    FROM [Log] L1
) L1
left join 
(
    SELECT L2.[LastDateUpdated]
          ,L2.[TIMESTAMP]
          ,ROW_NUMBER() OVER (ORDER BY L2.[LastDateUpdated]) ID
    FROM [Log] L2
) L2 
    ON L1.ID = L2.ID - 1
)
SELECT TS.LastDateUpdated, TS.LastDateUpdatedTo, * from [Invoices]
    inner join TS ON [Invoices].Timestamp between TS.Timestamp and 
TS.TIMESTAMPTo
ORDER BY TS.TIMESTAMPTo DESC 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T11:34:28.627

我认为您最好的选择是从插入之前恢复备份并将备份的表与当前表进行比较。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-07T13:46:22.930

要通过时间戳识别新行，您需要跟踪事先存在的时间戳。在紧要关头，您可以：

*   在其他地方恢复以前的版本。
*   将两个表中的数据复制到临时数据库中。
*   从其中一个而不是另一个中存在的时间戳中识别插入的数据。

如果数据库中发生了其他任何事情，那么误报的风险很小，这将为您带来相当不错的差异。

要进行更可靠的检查，您可以在行内容上使用[Hashbytes](http://msdn.microsoft.com/en-us/library/ms174415(SQL.90).aspx)计算 MD5 或 SHA-1 哈希，从而以非常低的冲突概率为您提供差异（有关此问题的讨论，请参阅有关[生日攻击](http://en.wikipedia.org/wiki/Birthday_attack)的维基百科文章）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-05-09T21:51:00.020

我知道为时已晚，但可能会帮助其他人。

Timestamp/RowVersion 可以转换为 BigInt，但无论如何不能与 datetime 进行比较。

以下语句取自 MSDN

> Transact-SQL [rowversion](http://technet.microsoft.com/en-us/library/ms182776.aspx)数据类型不是日期或时间数据类型。**timestamp**是**rowversion**的已弃用同义词。

有关更多详细信息，请参阅[此处](http://technet.microsoft.com/en-us/library/ms186724.aspx)

# asp.net - 如何在测试期间将电子邮件发送到本地文件夹？

> ID：177974
> 
> 赞同：20
> 
> 时间：2008-10-07T11:08:19.473
> 
> 标签：asp.net, testing, smtp

如何测试从我的应用程序发送电子邮件而不会淹没我的收件箱？

有没有办法告诉 IIS/ASP.NET 如何将电子邮件发送到本地文件夹以供检查？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-10-07T11:41:58.923

是的，有办法。

> 您可以像这样更改 web.config，以便在您发送电子邮件时将其创建为 c:\LocalDir 中的 .EML 文件。

```
 <configuration>  
     <system.net>    
      <mailSettings>      
       <smtp deliveryMethod="SpecifiedPickupDirectory">        
        <specifiedPickupDirectory pickupDirectoryLocation="c:\LocalDir"/>      
       </smtp>    
      </mailSettings>  
     </system.net>
    </configuration> 
```

[`SmtpClient`](http://msdn.microsoft.com/en-us/library/system.net.mail.smtpclient.aspx)如果您不想/不能更改 web.config，也可以使用这些相同的设置创建类的实例。在 C# 中看起来像这样：

```
var smtpClient = new SmtpClient();
smtpClient.DeliveryMethod = SmtpDeliveryMethod.SpecifiedPickupDirectory;
var emailPickupDirectory = HostingEnvironment.MapPath("~/EmailPickup");
if (!Directory.Exists(emailPickupDirectory)) { 
    Directory.CreateDirectory(emailPickupDirectory)
}
smtpClient.PickupDirectoryLocation = emailPickupDirectory; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-07T13:22:17.007

在您的电子邮件客户端中配置规则以根据主题/发件人的电子邮件地址移动邮件？

# c# - 从内部服务器外部下载文档

> ID：177989
> 
> 赞同：1
> 
> 时间：2008-10-07T11:12:30.137
> 
> 标签：c#, asp.net, iis, reverse-proxy

这有点奇怪......我们有一个在服务器 (A) 上运行的内部 Web 应用程序和一个在服务器 (B) 上运行的文档存储库。

我在页面上有简单的链接，我想让用户下载文档（从 IIS 服务器（A））。但是，在用户单击按钮之前，此文档在服务器 (A) 上不存在（因为要显示的 40 多个文档在页面加载时无法全部加载）

当用户单击链接时（此时我希望被提示下载）文档被复制到服务器（A），然后重定向到浏览器提示他们下载的页面。我相信我已经正确设置了内容标题并且它可以在 FireFox 中运行。

IE(7) 只是弹出一个窗口，然后窗口消失，如果我关闭安全设置，它可以正常工作，但这不是一个选项。

任何想法如何解决这个问题。我无法直接指向 Server(B) 上的文档

补充：是的，服务器 B 也是一个 Web 服务器

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T11:19:39.890

如果世界可以看到服务器 A，服务器 A 可以看到服务器 B。我建议设置反向代理。

[http://www.codeplex.com/urlrewriter](http://www.codeplex.com/urlrewriter)

基本上，这样做是允许世界从服务器 B 下载，但只能通过反向代理。您可以使用上面的这个库创建一个反向代理接口，规则如下。

RewriteRule ^/download/(.*) [http://server-b/download/](http://server-b/download/) $1 [NC,P]

所以在这种情况下

[http://server-a/download/xyz.pdf](http://server-a/download/xyz.pdf)

它实际上会从

[http://server-b/download/xyz.pdf](http://server-b/download/xyz.pdf)

但它会像来自服务器-a一样被传递，这在技术上是通过反向代理创建一个从服务器-a到服务器-b的Web连接并将HTTP响应复制到服务器-a的响应而发生的。

如果您需要任何帮助，请告诉我。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T11:16:45.823

可以用ajax吗？例如，用户单击发送请求以将文件从 B 获取到 A 的按钮，页面上会显示一个微调器。然后在复制完成后，禁用微调器并为用户提供下载链接。

我被否决并且没有评论权限，所以我想我会在这里详细说明（也许这只是一个糟糕的解决方案，我看不到它）：

1.  用户通过单击链接请求文件
2.  请求被发送到服务器 A 并通过 ajax 禁用链接
3.  服务器 A 将文件从服务器 B 复制到临时目录
4.  服务器 A 发回临时文件夹中文件的链接

如果文档服务器不是网络服务器（SMB、AFS、NFS 等），这将起作用。

# winapi - 如何在 Comtl32.dll ListView 中获得矩形多选行为

> ID：177993
> 
> 赞同：4
> 
> 时间：2008-10-07T11:14:00.603
> 
> 标签：winapi, comctl32

> **可能重复：**
> [ListView 多选行为？](https://stackoverflow.com/questions/4383918/listview-multiple-selection-behavior)

`ListView`v6.0中的`Comtl32.dll`多选（使用Shift键时）如下（x表示选中）

```
00xxxx
xxxxxx
xxxx00

```

ListView 的早期版本如下：

```
00xx00
00xx00
00xx00

```

有没有办法让它做第一种方式（comctl32 v6.0方式）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-07T13:04:29.787

您的意思是要进行矩形选择，而不是顺序选择？**