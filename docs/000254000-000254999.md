# StackOverflow 问答 000254000-000254999

# version-control - 如何忽略 Mercurial 文件夹下的所有内容

> ID：254002
> 
> 赞同：153
> 
> 时间：2008-10-31T15:55:25.570
> 
> 标签：version-control, mercurial, hgignore

我正在寻找 .hgignore 文件的表达式，以忽略指定文件夹下的所有文件。

例如：我想忽略 bin 下的所有文件和文件夹

实际上，任何关于如何形成表达式的建议都会很棒

* * *

## 回答 #1

> 赞同：178
> 
> 时间：2008-10-31T22:05:03.483

交替：

```
syntax: glob
bin/** 
```

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2008-12-06T12:43:24.407

我做了一些实验，发现 Windows 上的正则表达式语法适用于以当前存储库开头的路径，反斜杠转换为斜杠。

因此，例如，如果您的存储库位于 E:\Dev 中，`hg status`则将对 foo/bar/file1.c 等应用模式。锚点应用于此路径。

所以：

*   Glob 适用于路径元素并植根于元素部分
*   foo 匹配任何名为 foo 的文件夹（或文件）（不匹配“foobar”或“barfoo”）
*   *foo* 匹配名称中带有“foo”的任何文件夹或文件
*   foo/bar* 匹配 "foo" 文件夹中以 "bar" 开头的所有文件

*   正则表达式区分大小写，而不是锚定
*   当然，反斜杠正则表达式特殊字符如 . （点）
*   / 匹配 Windows 上的 \ 路径分隔符。\ 与此分隔符不匹配...
*   foo 匹配所有带有“foo”的文件和文件夹
*   foo/ 仅匹配以“foo”结尾的文件夹
*   /foo/ 匹配路径中某处的文件夹“foo”
*   /foo/bar/ 匹配路径中某处文件夹“foo”中的文件夹“bar”
*   ^foo 匹配存储库根目录中以 foo 开头的文件或文件夹
*   foo$ 匹配以 foo 结尾的文件

我希望这会有所帮助，我发现[HGIGNORE(5)](http://www.selenic.com/mercurial/hgignore.5.html "海格诺尔(5)")页面有点简洁。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-31T22:19:31.893

这两个也会过滤掉一个名为 的目录`cabin`，这可能不是你想要的。如果您要过滤顶级，您可以使用：

```
^/bin/ 
```

对于`bin`根目录下的目录，您可以省略 ^。不需要指定语法，regexp 是默认的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-11-14T22:08:07.480

语法：glob bin/**

这个答案如上所示，但我还想补充一点， * 和 ** 的处理方式不同。** 是递归的， * 不是。

见[汞模式](https://www.selenic.com/mercurial/hg.1.html#patterns)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-31T16:09:45.447

没关系，我明白了

```
syntax: regexp
bin\\* 
```

表达式遵循标准的 perl 正则表达式语法。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-11-21T19:53:28.540

忽略 .class 文件

```
syntax: regexp
?\.class 
```

# java - EMMA 覆盖率工具不显示逐行覆盖率

> ID：254004
> 
> 赞同：5
> 
> 时间：2008-10-31T15:56:06.410
> 
> 标签：java, ant, code-coverage, emma

我正在使用 EMMA 工具进行代码覆盖，尽管我尽了最大努力，但 EMMA 拒绝查看原始 .java 文件并逐行生成覆盖。

我们正在使用 ANT 构建代码，并且 debug 设置为 true。我知道 EMMA 正在测量覆盖率，因为 .emma 文件似乎正在正确生成和合并。这些报告能够以百分比呈现高水平的方法覆盖率。

但是为什么它看不到 .java 文件呢？我得到的是：[在源路径中找不到源文件'a/b/c/d/e/f/code.java']

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-31T16:07:33.783

你`sourcepath`在你的`report`元素中设置吗？

```
<report>
    <sourcepath>
        <pathelement path="${java.src.dir}" />
    </sourcepath>
    <fileset dir="data">
        <include name="*.emma" />
    </fileset>

    <txt outfile="coverage.txt" />
    <html outfile="coverage.html" />
</report> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T16:15:01.800

您可以发布`build.xml`生成`EMMA`报告的部分吗？听起来是个`report sourcepath`问题。

`report sourcepath`应该指向你的*java*源。

请参阅[EMMA](http://emma.sourceforge.net/reference_single/reference.html#tool-ref.report.ANT)参考中的源路径。这可以是类似*路径的结构*，因此您可以包含多个源目录。

与往常一样，使用 ANT：

*   执行最小的 build.xml`-verbose`
*   `-debug`了解更多信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-03T02:36:37.270

我遇到了同样的问题。但是发现在设置sourcepath时我们需要设置为唯一目录级别而不是java文件位置。它类似于类路径

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T16:22:28.590

确实`{java.src.dir}`需要指向一个特定的`src`目录。

这不是一个 src 目录，因为我正在编译多个项目。每个都有自己的 build.xml 文件。

我相信这是生成所有覆盖率报告的部分：

```
 <target name="emma.report" if="use.emma">
   <emma enabled="true">
     <report sourcepath="${test.reports.dir}">
       <!--  collect all EMMA data dumps (metadata and runtime):   --> 
       <infileset dir="${test.data.dir}" includes="*.emma" /> 
       <html outfile="${test.reports.dir}/coverage.html" /> 
     </report>
   </emma>
 </target> 
```

编辑：我将源路径更改为直接指向 src 目录之一。看看这是否有效。

# c# - 在 C# 中：在以逗号分隔的字符串列表中的字符串周围添加引号

> ID：254009
> 
> 赞同：64
> 
> 时间：2008-10-31T15:56:38.063
> 
> 标签：c#, string

这可能有一个简单的答案，但我一定没有足够的咖啡来自己解决这个问题：

如果我有一个逗号分隔的字符串，例如：

```
string list = "Fred,Sam,Mike,Sarah"; 
```

如何获取每个元素并在其周围添加引号并将其粘贴在这样的字符串中：

```
string newList = "'Fred','Sam','Mike','Sarah'"; 
```

我假设迭代每一个都是一个开始，但在那之后我被难住了。

一种丑陋的解决方案：

```
int number = 0;
string newList = "";
foreach (string item in list.Split(new char[] {','}))
{
    if (number > 0)
    {
        newList = newList + "," + "'" + item + "'";
    }
    else
    {
        newList = "'" + item + "'";
    }
    number++;
} 
```

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2008-10-31T15:57:53.117

```
string s = "A,B,C";
string replaced = "'"+s.Replace(",", "','")+"'"; 
```

感谢您的评论，我错过了外部报价。

当然..如果源是一个空字符串，你是否想要额外的引号？如果输入是一堆空格……怎么办？我的意思是，为了提供 100% 完整的解决方案，我可能会要求提供单元测试列表，但我希望我的直觉能回答你的核心问题。

*更新*：还建议了基于 LINQ 的替代方案（使用 String.Format 的额外好处，因此不必担心前导/尾随引号）：

```
string list = "Fred,Sam,Mike,Sarah";
string newList = string.Join(",", list.Split(',').Select(x => string.Format("'{0}'", x)).ToList()); 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2012-03-14T15:57:33.240

按照上面 Jon Skeet 的例子，这对我有用。我已经有一个`List<String>`名为 __messages 的变量，所以这就是我所做的：

```
string sep = String.Join(", ", __messages.Select(x => "'" + x + "'")); 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2008-10-31T16:01:35.540

```
string[] bits = list.Split(','); // Param arrays are your friend
for (int i=0; i < bits.Length; i++)
{
    bits[i] = "'" + bits[i] + "'";
}
return string.Join(",", bits); 
```

`IEnumerable<string>`或者您可以使用 LINQ，特别是使用支持...的 String.Join 版本

```
return list.Split(',').Select(x => "'" + x + "'").JoinStrings(","); 
```

在 SO 的其他地方有一个 JoinStrings 的实现......我会看看它。

编辑：嗯，没有我想的 JoinStrings，所以这里是：

```
public static string JoinStrings<T>(this IEnumerable<T> source, 
                                    string separator)
{
    StringBuilder builder = new StringBuilder();
    bool first = true;
    foreach (T element in source)
    {
        if (first)
        {
            first = false;
        }
        else
        {
            builder.Append(separator);
        }
        builder.Append(element);
    }
    return builder.ToString();
} 
```

不过，这些天`string.Join`有一个通用的重载，所以你可以使用：

```
return string.Join(",", list.Split(',').Select(x => $"'{x}'")); 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-10-31T16:01:04.793

```
string[] splitList = list.Split(',');
string newList = "'" + string.Join("','", splitList) + "'"; 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2020-01-22T15:24:04.413

基于 Jon Skeet 的示例，但针对 .NET 4+ 进行了现代化改造：

```
// [ "foo", "bar" ] => "\"foo\"", "\"bar\""  
string.Join(", ", strList.Select(x => $"\"{x}\"")); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-31T16:02:34.010

我认为最简单的事情是 to [`Split`](http://msdn.microsoft.com/en-us/library/b873y76a.aspx)and then [`Join`](http://msdn.microsoft.com/en-us/library/57a79xd0.aspx)。

```
string nameList = "Fred,Sam,Mike,Sarah";
string[] names = nameList.Split(',');
string quotedNames = "'" + string.Join("','", names) + "'"; 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-31T16:01:47.413

我不会编写 C# 代码，但是这个简单的 JavaScript 代码可能很容易适应：

```
var s = "Fred,Sam,Mike,Sarah";
alert(s.replace(/\b/g, "'")); 
```

它只是用单引号替换边界（字符串的开始/结束，从单词字符非标点符号转换）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-31T16:03:17.427

```
string list = "Fred,Sam,Mike,Sarah";

string[] splitList = list.Split(',');

for (int i = 0; i < splitList.Length; i++)
    splitList[i] = String.Format("'{0}'", splitList[i]);

string newList = String.Join(",", splitList); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-04-17T02:14:46.543

如果您使用的是 JSON，以下函数会有所帮助

```
var string[] keys = list.Split(',');
console.log(JSON.stringify(keys)); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-02-17T20:35:13.403

我的要求：

1.  使用逗号分隔项目。
2.  将列表中的所有项目用双引号括起来。
3.  转义字符串中现有的双引号。
4.  处理空字符串以避免错误。
5.  不要费心将空字符串用双引号括起来。
6.  以回车和换行结束。

    string.Join(",", lCol.Select(s => s == null ? null : ("\"" + s.Replace("\"", "\"\"") + "\"") )) + "\r\n";

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-31T16:17:46.663

[@PhiLho](https://stackoverflow.com/questions/254009/in-c-add-quotes-around-string-in-a-comma-delimited-list-of-strings#254026)的 JavaScript 正则表达式解决方案的 C# 实现如下所示：

```
Regex regex = new Regex(
    @"\b",
    RegexOptions.ECMAScript
    | RegexOptions.Compiled
    );

string list = "Fred,Sam,Mike,Sarah";
string newList = regex.Replace(list,"'"); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-31T16:44:19.667

我的“不太复杂”的方法......我认为使用 StringBuilder 总是很好的做法，因为列表可能非常大。

```
string list = "Fred,Sam,Mike,Sarah";
StringBuilder sb = new StringBuilder();

string[] listArray = list.Split(new char[] { ',' });

for (int i = 0; i < listArray.Length; i++)
{
    sb.Append("'").Append(listArray[i]).Append("'");
    if (i != (listArray.Length - 1))
        sb.Append(",");
}
string newList = sb.ToString();
Console.WriteLine(newList); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-31T18:56:39.090

您要处理大量 CSV 文件吗？如果是这样，您还应该考虑使用库来执行此操作。不要重新发明轮子。不幸的是，我还没有找到像 Python 的 CSV 库那样简单的库，但是我[在 MSDN 杂志上看到过](http://msdn.microsoft.com/en-us/magazine/cc721607.aspx)[FileHelpers](http://www.filehelpers.com/)（免费），它看起来很不错。那里可能还有其他免费库。这完全取决于您将进行多少处理。通常它会不断增长，直到您意识到使用库会更好。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-12-15T16:34:56.237

这是使用字符串插值的 C# 6 解决方案。

```
string newList = string.Join(",", list.Split(new char[] { ',' }, StringSplitOptions.RemoveEmptyEntries)
                       .Select(x => $"'{x}'")
                       .ToList()); 
```

或者，如果您更喜欢带有 String.Format 的 C# 5 选项：

```
string newList = string.Join(",", list.Split(new char[] { ',' }, StringSplitOptions.RemoveEmptyEntries)
                       .Select(x => String.Format("'{0}'", x))
                       .ToList()); 
```

使用 StringSplitOptions 将删除任何空值，因此您不会有任何空引号，如果这是您要避免的事情。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-06-15T06:10:31.860

我找到了解决这个问题的新方法

我使用 linq 将网格中的选定项目值绑定到一个列表，然后使用 String.Join() 属性为每个字符串集合添加一个逗号分隔的字符串。

```
String str1 = String.Empty;
String str2 = String.Empty;              
//str1 = String.Join(",", values); if you use this method,result "X,Y,Z"
     str1 =String.Join("'" + "," + "'", values);
//The result of str1 is "X','Y','Z"
     str2 = str1.Insert(0, "'").Insert(str1.Length+1, "'");
//The result of str2 is 'X','Y','Z' 
```

我希望这会有所帮助！！！！！！！

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-09-01T14:42:12.737

对于像我这样喜欢扩展方法的人，这里是：

```
 public static string MethodA(this string[] array, string seperatedCharecter = "|")
    {
        return array.Any() ? string.Join(seperatedCharecter, array) : string.Empty;
    }

    public static string MethodB(this string[] array, string seperatedChar = "|")
    {
        return array.Any() ? MethodA(array.Select(x => $"'{x}'").ToArray(), seperatedChar) : string.Empty;
    } 
```

# c# - 如果未调用 Dispose，IDbCommand、IDataReader 或 DataTable 是否会泄漏资源？

> ID：254013
> 
> 赞同：4
> 
> 时间：2008-10-31T15:58:10.120
> 
> 标签：c#, .net, database

使用IDbCommand、IDataReader或DataTable时，是否可以依赖析构函数来dispose资源，或者如果不直接调用dispose，这些对象会泄漏资源吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-31T16:00:07.697

它们不会泄漏，但它们会消耗资源，直到它们被垃圾收集。GC 将对它们调用 Dispose()。我不认为 DataTable 维护与数据库的连接，因此您不必担心在其上调用 Dispose() 或 Close()。

[请参阅我](https://stackoverflow.com/questions/250468/why-call-sqlclientsqldatareader-close-method-anyway#250478)对类似问题的回答。

# visual-studio - 如何从命令行调用 Visual Studio 预处理器？

> ID：254022
> 
> 赞同：6
> 
> 时间：2008-10-31T16:00:13.330
> 
> 标签：visual-studio, preprocessor

我想使用这里描述的预处理器来实现解决方案：

[在 C# 代码中重用 .h 文件中的定义语句](https://stackoverflow.com/questions/100854/reuse-define-statement-from-h-file-in-c-code)

如果您可以将我指向 MSDN 上的文档，则可以加分。我很难找到他们...

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-31T16:03:41.373

对 cl.exe 使用 /P 选项...参见[MSDN](http://msdn.microsoft.com/en-us/library/8z9z0bx6(VS.80).aspx)

# java - 设置对 null 的唯一引用是否意味着它及其子线程被垃圾收集？

> ID：254037
> 
> 赞同：1
> 
> 时间：2008-10-31T16:06:01.540
> 
> 标签：java, multithreading

我有一个必须作为服务存在的应用程序，我创建了一个对象，然后产生大量线程。

如果我将该对象的唯一引用设置为 null，所有子线程都会被清理吗？还是我会遭受内存泄漏。

我是否必须明确终止所有子线程？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-31T16:12:50.417

线程和静态引用是“根对象”。它们不受 GCing 的影响，任何可以直接或间接追溯到它们的东西都不能被收集。因此，只要线程正在运行，它们就不会被收集。但是，一旦 run 方法退出，GC 就可以吃掉任何未引用的线程对象。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-31T16:10:14.587

是的，您需要确保您的其他线程停止。垃圾收集器与此无关。不过，您也应该有条不紊地这样做——不要只是中止它们。

[这是 C# 中用于协作终止线程的模式](http://pobox.com/~skeet/csharp/threads/shutdown.shtml)- 很容易转换为 Java。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-31T16:27:58.670

正如其他人所提到的，线程在停止之前不会被清理。它们是 GC 的根对象，因此您不必保留对它们的引用。在所有线程退出之前，您的应用程序不会退出。

这条规则有一个例外。如果您将线程标记为守护程序，那么它不会阻止您的应用程序退出，并且如果没有其他非守护程序线程正在运行，它们将被自动清理。

有关更多信息，请参阅[Thread 的 javadoc 。](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Thread.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T16:10:14.027

无论理论（或 StackOverflow 答案）如何，您还应该创建一些测试以查看您打算做的事情是否真的发生了。也许你有一些被遗忘的指针来阻止垃圾收集。

# http-headers - 如何从 Stellent (Oracle UCM) 脚本创建 HTTP 301 重定向

> ID：254047
> 
> 赞同：1
> 
> 时间：2008-10-31T16:09:38.833
> 
> 标签：http-headers, oracle-ucm, idoc, stellent

是否可以从 Stellent（现在称为 Oracle UCM）网站发送带有永久重定向的 HTTP 响应？我们使用带有 iDoc 脚本的 7.5.2 版。

我们可以使用 iDoc 函数 setHttpHeader() 来发送 Location HTTP 标头，但是如何发送 HTTP 响应代码 301，向浏览器发出永久重定向信号？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-07-12T21:12:48.603

元链接上有可用于 301 重定向的组件“IdocScriptRedirect”。您可以请求 oracle 支持为您提供下载链接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-09-24T22:03:26.183

在 Site Studio 中，如果您右键单击文件夹并选择“选择主页面”，然后选择“使用外部 URL”单选按钮，该页面将被重定向为 301 重定向。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-10T21:55:34.953

不...该函数附加了新的 HTTP 标头，并且在此之前设置了响应代码。您将需要一个自定义 IdocScript 函数来获得该行为。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-01-04T14:50:31.910

Idoc 脚本函数[setRedirectUrl](https://vedranstanic.wordpress.com/2011/12/10/server-side-redirect-with-idoc/)将满足您的需求。

例子：`<$setRedirectUrl("some url")$>`

# asp.net - 如何使用 ASP.NET 运行时的详细调试消息运行 ASP.NET 应用程序

> ID：254048
> 
> 赞同：1
> 
> 时间：2008-10-31T16:09:43.717
> 
> 标签：asp.net, debugging, verbosity

如何配置 ASP.NET 应用程序以编写ASP.NET 引擎本身正在执行的**详细**日志消息？我得到了什么

```
<trace enabled="true" 
       pageOutput="false"
       requestLimit="10000"
       writeToDiagnosticsTrace="true"/> 
```

只是

```
[2488] aspx.page: Begin PreInit 
[2488] aspx.page: End PreInit
[2488] aspx.page: Begin Init  
[2488] Unhandled Execution Error:  -- Object reference not set to an instance of an object.:
    at ...
    ...
[2488] aspx.page: Begin PreInit
[2488] aspx.page: End PreInit  
[2488] aspx.page: Begin Init
[2488] aspx.page: End Init  
[2488] aspx.page: Begin InitComplete  
[2488] aspx.page: End InitComplete  
[2488] aspx.page: Begin PreLoad  
[2488] aspx.page: End PreLoad  
[2488] aspx.page: Begin Load
[2488] aspx.page: End Load  
[2488] aspx.page: Begin LoadComplete  
[2488] aspx.page: End LoadComplete 
[2488] aspx.page: Begin PreRender  
[2488] aspx.page: End PreRender  
[2488] aspx.page: Begin PreRenderComplete 
[2488] aspx.page: End PreRenderComplete  
[2488] aspx.page: Begin SaveState  
[2488] aspx.page: End SaveState 
[2488] aspx.page: Begin SaveStateComplete 
[2488] aspx.page: End SaveStateComplete  
[2488] aspx.page: Begin Render  
[2488] aspx.page: End Render 
```

有没有办法获得更多的详细信息？application_folder/logs/ 文件的详细程度如何？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-29T20:15:12.220

[ELMAH](http://code.google.com/p/elmah/)为您提供了很多细节，并且很容易添加到您的 asp.net 应用程序中

# linux - 为 Linux 应用程序编写通用安装程序的最佳方法是什么？

> ID：254054
> 
> 赞同：10
> 
> 时间：2008-10-31T16:10:35.400
> 
> 标签：linux, installation

我们有一个 Linux 服务器应用程序，它由许多开源工具以及我们自己编写的程序组成。理想情况下，我们希望能够在任何常见的 Linux 发行版上安装此应用程序。

过去，我们编写了 perl 脚本来自动安装此应用程序。不幸的是，由于不同 Linux 发行版的特性，这些安装脚本中的逻辑变得非常复杂，并且可能随着每个受支持发行版的新版本的发布而改变。因此，维护安装程序成为项目中最耗时的部分之一！

我正在寻求帮助，无论是框架、文档、代码示例，都可以使这个过程不那么痛苦。以下是我们的安装人员需要执行的操作类型：

*   创建用户/组帐户

*   创建具有特定所有权和权限的目录树

*   安装开源应用程序，可能在安装期间从源代码编译它们

*   将预编译的二进制文件、脚本、配置文件和文档插入特定目录

*   注册 init 类型的启动和关闭脚本

*   生成加密密钥

*   验证与中央服务器的连接

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-31T16:22:46.887

除了安装程序方法之外，我认为比在安装时使用单个脚本更好的方法是拥有一个生成系统，该系统生成适合安装在您必须支持的每个系统上的 .deb 或 .rpm 文件。

一个穷人的方法可能是使用[checkinstall](http://www.asic-linux.com.mx/~izto/checkinstall/)，它从通过“make install”安装的文件创建包。因此，您将在每个系统上构建您的应用程序，并以发行版的本机格式神奇地创建包。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-05T18:28:33.807

我相信您描述的大多数任务在 Linux 发行版之间都是相当标准化的。根据我的经验，以下内容应该适用于 Debian 家族（包括 Ubuntu）和 Red Hat 家族（包括 Fedora 和 CentOS）：

*   创建用户/组帐户 -`adduser`命令
*   创建目录树 -`mkdir`或者`install`，或者只是展开一个 tarball
*   安装开源应用程序——除非你有特别深奥的需求，否则这应该留给发行版的包管理器。
*   安装文件 - `install`，或者只是扩展一个 tarball
*   启动和关闭脚本 -然后符号链接`install`到`/etc/init.d``/etc/rc*.d`

VMware Server 可免费用于 Linux 并执行您描述的大部分任务。它使用 Perl 和 shell 进行安装和配置，因此您可能会看到它采用的方法。

但是，作为 Linux 管理员，我*更*喜欢与我的包管理系统集成的应用程序。换句话说，按照 Vinko Vrsalovic 的建议，创建 .deb 和 .rpm 文件。构建包的文档非常详细：

*   为 Fedora（或 Red Hat 或 CentOS）构建 RPM：[文档草案](http://fedoraproject.org/wiki/Docs/Drafts/BuildingPackagesGuide)，[RPM 指南](http://docs.fedoraproject.org/drafts/rpm-guide-en/)
*   为 Debian（或 Ubuntu）构建 .debs：[Debian 维护者指南](http://www.debian.org/doc/maint-guide/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T16:18:19.940

几年前我尝试过[Autopackage](http://autopackage.org/)，不知道它有多通用，但效果很好（当时是唯一真正通用的方式）。当然，您必须提供一些与 LSB 兼容的方法来自行设置正确的目录，但是这个软件应该可以帮助您。

尽管 linux 发行版之间可能仍然存在太多差异，无法以完全与平台无关的方式完成**所有**工作，但我可能错了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-18T14:02:38.123

您可能想尝试[BitRock InstallBuilder](http://bitrock.com)。它是一个跨平台安装工具，可让您完全按照您的要求进行操作（添加用户、安装服务、安装预编译的二进制文件等）。尽管其他一些帖子提到了您可以在脚本中使用的许多工具，但问题是每个 Linux 发行版都有些不同，当您需要时，添加用户或安装服务等简单任务突然变得不简单在 Debian、Ubuntu、Mandriva、RedHat、Gentoo 等平台上执行它们。一个好的跨平台安装程序应该将您与所有这些隔离开来。许多[商业开源公司](http://bitrock.com/customers_industry.html)MySQL、SugarCRM、Zenoss、Jaspersoft、Groundwork 等正是基于我们的技术构建了安装程序（除了他们的常规源代码 tarball 等）。我们还为开源项目提供免费许可证。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-09-26T12:56:41.583

Autopackage 现在与 Listaller 项目合并。文档还不是很彻底，但似乎正在工作。

# visual-c++ - 从 VC8 (VS2005) 到 VC9 (VS2008) 的移植问题是什么？

> ID：254057
> 
> 赞同：3
> 
> 时间：2008-10-31T16:11:11.030
> 
> 标签：visual-c++, visual-c++-2008, name-decoration, vc8

我继承了一个在 VC8（VS2005）下构建和测试的非常庞大而复杂的项目（实际上是一个由 119 个“项目”组成的“解决方案”，其中大部分是 DLL），我的任务是将它移植到 VC9 （VS2008）。

我使用的移植过程是：

1.  复制 VC8 .sln 文件并将其重命名为 VC9 .sln 文件。
2.  复制所有 VC8 项目文件，并将它们重命名为 VC9 项目文件。
3.  编辑所有 VC9 项目文件，s/vc8/vc9。
4.  编辑 VC9 .sln, s/vc8/vc9/
5.  使用 VS2008 加载 VC9 .sln，并让 IDE“转换”所有项目文件。
6.  修复编译器和链接器错误，直到我得到一个好的构建。

到目前为止，我在最后一步中遇到了以下问题。

1) 修饰名称的计算方式发生变化，导致名称被截断。

这不仅仅是一个警告 ( [http://msdn.microsoft.com/en-us/library/074af4b6.aspx](http://msdn.microsoft.com/en-us/library/074af4b6.aspx) )。使用此警告构建的库不会与其他模块链接。应用 MSDN 中给出的解决方案并非易事，而是可行的。我在[如何增加 VC9 (MSVC 2008) 中允许的修饰名称长度？](https://stackoverflow.com/questions/178532/how-do-i-increase-the-allowed-decorated-name-length-in-vc9-msvc-2008)

2) 不允许将零分配给迭代器的更改。这是符合规范的，很容易找到并修复这些以前允许的编码错误。不要将零分配给迭代器，而是使用值 end()。

3) for-loop 范围现在符合 ANSI 标准。另一个容易解决的问题。

4) 预编译头文件需要更多空间。在某些情况下，需要更多的空间。我最终使用 /Zm999 来提供最大的 PCH 空间。如果 PCH 内存使用量再次增加，我认为我将不得不完全放弃 PCH，并忍受已经很长的构建时间的增加。

5) 对复制 ctor 和默认 dtor 的要求有所改变。似乎在模板类中，在我还没有完全弄清楚的某些条件下，编译器不再生成默认 ctor 或默认 dtor。我怀疑这是 VC9 中的一个错误，但可能还有其他我做错的事情。如果是这样，我肯定想知道它是什么。

6) sln 和 vcproj 文件中的 GUID 没有改变。这似乎不会以我可以检测到的任何方式影响构建，但仍然令人担忧。

请注意，尽管存在所有这些问题，该项目还是在 VC8 下构建、运行并通过了广泛的 QA 测试。我还将所有更改移植到 VC8 项目中，它们仍然像以前一样愉快地构建和运行（使用 VS2005/VC8）。因此，我为 VC9 构建所需的所有更改至少看起来是向后兼容的，尽管回归测试仍在进行中。

现在解决真正困难的问题：我遇到了 VC8 和 VC9 项目的启动顺序不同。该程序使用了一个仿照 Loki 的小对象分配器，在 Andrei Alexandrescu 的 Book *Modern C++ Design*中。该分配器使用主程序模块中定义的全局变量进行初始化。

在 VC8 下，这个全局变量是在程序启动的最开始时从模块 crtexe.c 中的代码构造的。在VC9下，第一个执行的模块是crtdll.c，表示启动顺序发生了变化。正在启动的 DLL 似乎通过在全局对象初始化统计信息之前分配和取消分配内存来混淆小对象分配器，这会导致一些虚假的诊断。该程序的运行似乎没有受到实质性影响，但 QA 人员不会允许虚假诊断通过他们。

有没有办法在加载 DLL 之前强制构建全局对象？

我可能会遇到哪些其他移植问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-04T20:37:16.573

这是一个棘手的问题，主要是因为您继承了一个本质上很危险的设计，因为您不应该依赖全局变量的初始化顺序。

这听起来像是您可以尝试通过将全局变量替换为单例来解决的问题，其他函数通过调用返回指向单例对象的指针的全局函数或方法来检索该变量。如果对象在调用时存在，则函数返回一个指向它的指针。否则，它分配一个新对象并返回一个指向新分配对象的指针。

当然，问题是我想不出一个可以避免您描述的问题的单例实现。也许这个讨论会很有用：[http ://www.oneunified.net/blog/Personal/SoftwareDevelopment/CPP/Singleton.article](http://www.oneunified.net/blog/Personal/SoftwareDevelopment/CPP/Singleton.article)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T20:22:01.890

> 有没有办法在加载 DLL 之前强制构建全局对象？

DELAYLOAD 选项怎么样？所以 DLL 在第一次调用之前不会被加载？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T23:37:14.167

这个怎么样，

1.  让你的主程序也成为一个 DLL，将其命名为 main.dll，链接到所有其他程序，然后将主函数导出为 mainEntry()。删除全局变量。
2.  创建一个新的主 exe，它具有全局变量及其初始化，但不静态链接到任何其他应用程序 DLL（分配器的东西除外）。
3.  这个新的 main.exe 然后使用 LoadLibrary() 动态加载 main.dll，然后使用 GetProcAddress 调用 mainEntry()。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T20:30:38.167

这当然是一个有趣的问题。除了改变设计以便不依赖于未定义的订单行为或链接/dll 启动之外，我没有其他解决方案。您是否考虑过使用旧链接器进行链接？（或任何 VS.NET 术语）

因为您的变量和分配器的行为依赖于一些（当时未知）任意启动顺序，所以我可能会修复它，以便将来不会出现问题。我想你真的在问是否有人知道如何在 VC9 中做一些巫术来使问题消失。我也有兴趣听听。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-28T20:07:06.973

事实证明，这个问题的解决方案比我最初想象的要简单。初始化顺序问题是由从标准容器类型派生的几个全局变量类型的存在引起的（一个基本的设计缺陷，早于我在该公司的职位）。解决方案是用单例替换所有这些全局变量。其中大约有100个。

一旦完成，初始化（和销毁）顺序就在程序员的控制之下。

# c++ - 如何更改 c++ windows 服务的显示名称？

> ID：254058
> 
> 赞同：2
> 
> 时间：2008-10-31T16:11:41.200
> 
> 标签：c++, windows-services

在 C++ 应用程序的服务控制管理器中，我可以在哪里设置显示名称？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-31T16:16:57.397

使用[ChangeServiceConfig](http://msdn.microsoft.com/en-us/library/ms681987(v=vs.85).aspx)更改显示名称；您可以使用[ChangeServiceConfig2](http://msdn.microsoft.com/en-us/library/ms681987(v=vs.85).aspx)更改描述。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T16:36:48.013

它在注册表中，在 HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Services/[yourservicekey]/DisplayName 下

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-27T06:49:31.303

如果您只想更改特定服务的 DisplayName，可以从命令行完成，而不是进行*危险*的注册表编辑。

```
sc config <ServiceName> DisplayName= <NewName> 
```

# java - 将转换应用于多个类中的多个属性的设计模式

> ID：254060
> 
> 赞同：3
> 
> 时间：2008-10-31T16:12:36.860
> 
> 标签：java, design-patterns, markdown

我在一个项目中使用 WMD 降价编辑器来处理大量字段，这些字段对应于大量实体类中的大量属性。某些类可能有多个需要降价的属性。

我正在存储降价本身，因为这使得以后更容易编辑字段。但是，我需要将属性转换为 HTML 以便稍后显示。问题是：是否有一些模式可以用来避免在我的所有实体类中编写降价转换代码？

我创建了一个实用程序类，其方法接受降价字符串并返回 HTML。我正在使用 markdownj，这很好用。

问题是对于存储降价的每个类的每个属性，我可能需要另一种转换为 HTML 的方法：

```
public class Course{

     private String description;
     .
     .
     .
     public String getDescription(){
          return description;
     }

     public String getDescriptionAsHTML(){
          return MarkdownUtil.convert(getDescription());
     }
     .
     .
     .
 } 
```

问题在于，如果 Course 类还有 2 个属性 Tuition 和 Prerequisites 说，它们都需要转换器，那么我将不得不编写 getTuitionAsHTML() 和 getPrerequisiteAsHTML()。

我觉得这有点难看，想要一个更清洁的解决方案。需要这个的类不是单个继承层次结构的一部分。

我正在考虑的另一个选择是在控制器而不是模型中执行此操作。您对此有何看法？

谢谢。

[编辑]：新想法（感谢 Jasper）。由于该项目使用 struts2（我之前没有说过），我可以创建一个视图组件，说它将为我转换降价。然后我在需要将值显示为 HTML 的地方使用它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T16:29:55.530

> 需要这个的类不是单个继承层次结构的一部分。

他们至少应该实现一个通用接口，否则提出一个干净的通用解决方案将会很麻烦。

> 我正在考虑的另一个选择是在控制器而不是模型中执行此操作。您对此有何看法？

这显然是 View 的责任。#1 MVC 规则是模型不关心它的表示，在这种情况下是降价。

但是，我觉得关于您当前架构的细节很少，无法为您的问题提供有意义的答案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T16:38:23.690

如果您不能使用继承或接口，您确实有一个选择。我知道，我知道重构，但这是现实并且 *hit 发生了。

您可以使用反射来迭代您的属性并将格式应用于它们。您可以使用属性标记它们，也可以采用命名方案（脆弱，但仍然是一个选项）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T16:39:36.837

忽略架构问题，我认为简单的答案可能是：

```
public String getDescription(MarkDownUtil converter)
{
    if (converter == null) return description;
    else return MarkdownUtil.convert(description);
} 
```

更好的是让 MarkDownUtil 实现 IStringConverter，并且您可以为不同的工作使用多个不同的 StringConverter。

# ide - 用于 HP 计算器编程的 IDE？

> ID：254061
> 
> 赞同：-1
> 
> 时间：2008-10-31T16:12:46.487
> 
> 标签：ide, calculator

在我的 HP49g+ 上输入超过 50 个字符的程序会很快过时。

哪些 IDE 专为 HP 计算器编程而设计？是否有为此目的的 Visual Studio、Eclipse、xCode 等插件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T16:19:49.530

[有一个名为hpgcc](http://hpgcc.org/)的 C 交叉编译器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T16:16:09.037

现在我正在使用[HPUserEdit4](http://www.hpcalc.org/details.php?id=4746)（带有英文翻译）。优点是语法高亮、内置模拟器、要插入的常用符号列表。

它很不错，但无论如何都不是很好，而且调试与 Visual Studio 中的情况相去甚远。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-09-15T10:16:36.737

*   [用于 hp49g+/50g 的一组编程实用程序（甚至 IDE）（](http://www.hpcalc.org/hp49/pc/programming/)甚至在整个网站上都有搜索）
    无论如何我建议：
*   调试4x
*   编辑
*   HP用户编辑

# windows-vista - 通过命令行关闭省电选项

> ID：254066
> 
> 赞同：12
> 
> 时间：2008-10-31T16:14:58.167
> 
> 标签：windows-vista, energysmart, power-saving

在 Windows XP 上，脚本中的以下命令将阻止在 PC 上启用任何省电选项（显示器睡眠、HD 睡眠等）。这对于信息亭应用程序很有用。

```
powercfg.exe /setactive presentation 
```

Vista上的等价物是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-03T14:28:25.197

将值设置为 never 可以通过将值传递`0`给`-change`选项来完成，即：

```
powercfg.exe -change -monitor-timeout-ac 0 
```

表示监视器超时将设置为“从不”。因此，演示计划可以通过以下方式实现：

```
powercfg.exe -change -monitor-timeout-ac 0
powercfg.exe -change -disk-timeout-ac 0
powercfg.exe -change -standby-timeout-ac 0
powercfg.exe -change -hibernate-timeout-ac 0 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-31T16:36:11.057

powercfg.exe 在 Vista 中的工作方式略有不同，默认情况下不包含“演示文稿”配置文件（至少在我的机器上。因此您可以设置“演示文稿”配置文件，然后使用以下内容获取 GUID

> ```
> powercfg.exe -list 
> ```

以及以下将其设置为该 GUID：

> ```
> powercfg.exe -setactive GUID 
> ```

或者，您可以使用带有 -change 或 -X 的 powercfg.exe 来更改当前电源方案的特定参数。

来自“powercfg.exe /？”的片段：

> -CHANGE, -X 修改当前电源方案中的设置值。
> 
> ```
>  Usage: POWERCFG -X <SETTING> <VALUE>
> 
>           <SETTING>   Specifies one of the following options:
>                       -monitor-timeout-ac <minutes>
>                       -monitor-timeout-dc <minutes>
>                       -disk-timeout-ac <minutes>
>                       -disk-timeout-dc <minutes>
>                       -standby-timeout-ac <minutes>
>                       -standby-timeout-dc <minutes>
>                       -hibernate-timeout-ac <minutes>
>                       -hibernate-timeout-dc <minutes>
> 
>           Example:
>               POWERCFG -Change -monitor-timeout-ac 5
> 
>           This would set the monitor idle timeout value to 5 minutes
>           when on AC power. 
> ```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-06-07T09:19:36.673

（至少）对于 Windows 7：

不错的快捷方式是：

*   powercfg -ALIASES # 列出可用配置文件的命名别名。
*   powercfg -S SCHEME_MIN #使用别名 SCHEME_MIN 激活（高性能）方案
*   powercfg -S SCHEME_MAX #使用别名 SCHEME_MAX 激活（Max-Energie-Saving）方案
*   powercfg -S SCHEME_BALANCED # ... 平衡能源方案

干杯

凯

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T16:31:37.290

C:\Windows\system32>powercfg /list

## 现有电源方案（* 有效）

电源方案 GUID：381b4222-f694-41f0-9685-ff5bb260df2e（平衡）*

电源方案 GUID：8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c（高性能）

电源方案 GUID：a1841308-3541-4fab-bc81-f71556f20b4a（节电）

C:\Windows\system32>powercfg /setactive a1841308-3541-4fab-bc81-f71556f20b4a

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-31T16:28:42.350

在 Vista 中，您创建一个电源配置文件并使用命令行 powercfg 选择该配置文件， [请参见此处](http://www.nooblet.org/blog/tag/powercfg/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-11-28T13:31:15.167

```
@ECHO OFF

powercfg -change -monitor-timeout-ac 0
powercfg -change -standby-timeout-ac 0
powercfg -change -disk-timeout-ac 0
powercfg -change -hibernate-timeout-ac 0 
```

这将起作用

# sql - 我可以在 Sql Server 2005 视图中使用递归吗？

> ID：254071
> 
> 赞同：4
> 
> 时间：2008-10-31T16:16:14.640
> 
> 标签：sql, sql-server, recursion

我试图`OPTION (MAXRECURSION 0)`在视图中使用来生成日期列表。这似乎不受支持。这个问题有解决方法吗？

编辑以解释我真正想做的事情：

我有 2 张桌子。

table1: int weekday, bool 可用

表 2：datetime 日期，可用布尔型

我想要结果：view1：日期（这里是今年的所有日子），可用（来自 table2 或来自 table1 时不在 table2 中）。

这意味着我必须在工作日的日期申请加入。我希望这个解释是可以理解的，因为我实际上在查询中使用了更多具有更多字段的表。

我找到了这段代码来生成递归：

```
WITH Dates AS
(
    SELECT cast('2008-01-01' as datetime) Date
    UNION ALL
    SELECT Date + 1
    FROM    Dates   
    WHERE   Date + 1 < DATEADD(yy, 1, GETDATE())
) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T18:17:16.047

[不](http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=124653)——如果你能在 100 个递归级别内找到一种方法（有一个数字表），这将使你达到 100 个递归级别，你就可以做到。但是，如果您有数字或数据透视表，则无论如何都不需要递归...

看到[这个问题](https://stackoverflow.com/questions/10819/sql-auxiliary-table-of-numbers)（但我会创建一个表而不是表值函数），[这个问题](https://stackoverflow.com/questions/40456/sql-missing-rows-when-grouped-by-day-month-year)和[这个链接](http://andre-silva-cardoso.blogspot.com/2007/11/sql-trickspatterns-1-numbers-table.html)和[这个链接](http://www.sqlmag.com/Article/ArticleID/94376/sql_server_94376.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T16:46:38.650

您可以使用[CTE](http://blog.crowe.co.nz/archive/2007/09/06/Microsoft-SQL-Server-2005---CTE-Example-of-a-simple.aspx)进行分层查询。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-11-16T13:24:51.267

干得好：

```
;WITH CTE_Stack(IsPartOfRecursion, Depth, MyDate) AS
(
    SELECT 
         0 AS IsPartOfRecursion
        ,0 AS Dept 
        ,DATEADD(DAY, -1, CAST('01.01.2012' as datetime))  AS MyDate 
    UNION ALL

    SELECT 
         1 AS IsPartOfRecursion 
        ,Parent.Depth + 1 AS Depth 
        --,DATEADD(DAY, 1, Parent.MyDate) AS MyDate
        ,DATEADD(DAY, 1, Parent.MyDate) AS MyDate
    FROM 
    (
        SELECT 0 AS Nothing 
    ) AS TranquillizeSyntaxCheckBecauseWeDontHaveAtable 

    INNER JOIN CTE_Stack AS Parent 
        --ON Parent.Depth < 2005 
        ON DATEADD(DAY, 1, Parent.MyDate) < DATEADD(YEAR, 1, CAST('01.01.2012' as datetime)) 
)

SELECT * FROM CTE_Stack 
WHERE IsPartOfRecursion = 1
OPTION (MAXRECURSION 367) -- Accounting for leap-years
; 
```

# visual-c++ - 错误：“BLAH.EXE”中的并排配置信息包含错误

> ID：254076
> 
> 赞同：15
> 
> 时间：2008-10-31T16:17:33.857
> 
> 标签：visual-c++, visual-studio-2005, dependencies, manifest

这是 Dependency Walker 在我使用 VC++ 2005 Express Edition 构建的可执行文件上给我的错误。尝试运行 .exe 时，我得到：

```
This application has failed to start because the application configuration
is incorrect. Reinstalling the application may fix this problem. 
```

（我是清单/SxS/等的新手。VC++ 2003 之后的处理方式。）

编辑：我在构建 .exe 的同一台机器上运行。在事件查看器中，我没有帮助：

```
Faulting application blah.exe, version 0.0.0.0, faulting module blah.exe,
version 0.0.0.0, fault address 0x004239b0. 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-06T15:01:12.570

打开项目的属性表，转到配置属性 -> C/C++ -> 代码生成页面，并将运行时库选择更改为 /MT 或 /MTd，以便您的项目不使用 DLL 运行时库。

VS2003 及更高版本使用的 C/C++ DLL 运行时不会自动随最新版本的操作系统一起分发，并且在没有此类问题的情况下安装和开始工作真的很痛苦。静态链接 c-runtime 并避免清单和特定于版本的运行时 dll 的混乱。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-07-07T15:51:15.170

很抱歉提出一个老问题，但我能够解决这个确切的问题，并认为我会发布一个解决方案以防其他人需要它......

即使在安装了 Microsoft 的可再发行 DLL 之后，我也遇到了这个错误，修复方法是复制

```
C:\Program Files\Microsoft Visual Studio 8\VC\redist\x86\Microsoft.VC80.CRT 
```

文件夹到目标 PC 上的应用程序目录中。之后，就没有更多的问题了。

顺便说一句，给我带来问题的 DLL 是一个第 3 方 DLL，之前在 100 多台其他计算机上从未出现过问题……去看看。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-01T18:37:11.640

我遇到过这个问题。该解决方案有两个步骤：
1\. 在“发布”模式而不是“调试”模式下编译程序（工具栏中通常有一个组合框）
2\. 从 Microsoft 下载运行时组件的[Redistributable Package](http://www.microsoft.com/downloads/details.aspx?familyid=32bc1bee-a3f9-4c13-9c99-220b62a191ee&displaylang=en)。确保下载适用于 32 位计算机的 x86 版本和适用于 64 位计算机/操作系统的 x64 版本。在目标计算机上安装此软件包，您的应用程序应该可以正常运行

PS 这*是*一个 SxS 的东西
PPS 或者，使用不同的编译器（比如 GCC，例如使用 Dev-Cpp）来编译你的程序的源代码，你的头痛就会消失。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-31T16:27:13.697

运行事件查看器：它会有更多信息。

可能你试图在没有安装 VC 可再发行组件的机器上运行你的程序，或者你试图在没有安装 Visual Studio 的机器上运行调试版本（调试库不是可再分配）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-06-20T01:03:40.437

我在其他 winxp sp3 机器上使用 VS 2008 构建的调试二进制文件时遇到了同样的问题。

1.  我首先尝试使用 vc redist 包安装客户端机器，因为它看起来很明智。恼人的是，它**没有用**。
2.  我尝试将所有依赖的 dll 复制到应用程序的目录 - 仍然**没有工作**
3.  在被这个问题困扰了几个小时后，我发现最新的 VS 版本需要清单和策略才能与 dll 链接。将它们复制到各自的“C:\WINDOWS\WinSxS\”文件夹后，我就可以**正常工作**了。

问题是由于 vc redist 包没有安装调试版本的 dll 引起的，他们不知何故认为这取决于程序员来解决。

# iphone - 使用 OpenAL 将音频转换为 CAF 格式以便在 iPhone 上播放

> ID：254080
> 
> 赞同：73
> 
> 时间：2008-10-31T16:19:13.960
> 
> 标签：iphone, core-audio, openal, afconvert

我在 CrashLanding 示例中使用来自 Apple 的 SoundEngine 示例代码来播放多个音频文件。使用 CrashLanding 中包含的示例 caf 文件一切正常，但是当我尝试使用我自己的使用 afconvert 转换为 CAF 的示例时，我得到的只是石质的沉默；）

有没有人有 afconvert 的设置，可以生成能够通过 OpenAL 播放的 CAF 文件？

* * *

## 回答 #1

> 赞同：189
> 
> 时间：2008-10-31T22:34:41.690

```
afconvert -f caff -d LEI16@44100 -c 1 in.wav out.caf 
```

参考：

*   Apple 的[多媒体编程指南：使用音频：iOS 中的首选音频格式](https://developer.apple.com/library/ios/documentation/audiovideo/conceptual/multimediapg/usingaudio/usingaudio.html#//apple_ref/doc/uid/TP40009767-CH2-SW28)
*   [afconvert(1) 手册页](https://developer.apple.com/library/mac/documentation/Darwin/Reference/Manpages/man1/afconvert.1.html)（用于`afconvert -h`获取完整信息）

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2010-03-10T01:02:29.493

用于将文件夹中的 mp3 文件转换为 iphone 的简单 bash 脚本

```
#!/bin/bash
for f in *.mp3; do
  echo "Processing $f file..."
  afconvert -f caff -d LEI16@44100 -c 1 "$f" "${f/mp3/caf}"
done 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2012-05-01T00:14:59.520

这是最好的尺寸：

> afconvert -f caff -d ima4 original.wav

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-16T19:24:42.140

谢谢（你的）信息。

此外，如果您正在研究使用 openAL 进行额外压缩，这可能会引起您的兴趣：

“iPhone、OpenAL 和 IMA4/ADPCM” [http://www.wooji-juice.com/blog/iphone-openal-ima4-adpcm.html](http://www.wooji-juice.com/blog/iphone-openal-ima4-adpcm.html)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-02-27T01:11:25.093

看起来 -c 今天不起作用，我得到了它：

> afconvert -f caff -d LEI16 input.m4a output.caf

# qa - 为多个中层客户维护质量保证服务器的最佳方法

> ID：254090
> 
> 赞同：-1
> 
> 时间：2008-10-31T16:23:19.867
> 
> 标签：qa

我们已经到了这样的地步，我们有几个可以从 QA 服务器中受益的中层客户端，但没有人能够负担得起专用 QA 盒和专用生产盒的费用。我一直在玩弄虚拟环境的想法，无论是托管在我们的办公室还是由第三方托管，几个客户可以点击查看正在进行的工作，从而抵消总成本。这些站点中的大多数将是 LAMP 堆栈，但每隔一段时间就有可能将 .NET 或 Java 站点混入其中。我正在寻找一种可靠的方法，但显然不是完整的实现细节。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-07T16:51:09.557

我们所有的 QA/Test 环境都托管在虚拟盒子上。我们将生产服务器的精确副本制作成虚拟服务器用于测试目的。只需确保在设置测试环境时使它们尽可能靠近生产环境。这将使您的测试结果更加可行，并且您不会遇到“它在测试中工作得很好，我不知道为什么它在生产中不起作用”的场景。

# .net - .Net 将数字从一种文化转换为另一种文化

> ID：254096
> 
> 赞同：4
> 
> 时间：2008-10-31T16:24:20.817
> 
> 标签：.net, localization, internationalization

在.Net（更具体地说是VB，但这并不重要）中，有没有办法严格通过该数字的类型将数字的格式从一种文化更改为另一种文化？

问题是这样的：在英语中，数字是 123.45。而在瑞典，这个数字是 123,45

有没有办法将 123,45 转换为 123.45 而不必将其转换为字符串（然后使用格式化方法），然后将其转换回正确的类型（单、双等）？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-31T16:28:26.407

这不会是转换*为*字符串然后*返回*正确类型的情况 - 恰恰相反。

数字本身没有任何关于它的格式信息。浮子是浮子是浮子。只有当您解析或格式化时，文化才会变得相关。

如果您已经有了一个浮点值，那么只需根据阅读它的人的文化适当地格式化它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-31T16:28:15.987

将其保留为数字。更改线程的cultureInfo，它会相应显示，无需转换。

例如

```
Thread.CurrentThread.CurrentCulture = New CultureInfo("se-SE")
Thread.CurrentThread.CurrentUICulture = Thread.CurrentThread.CurrentCulture 
```

切勿尝试将数字或日期专门格式化为字符串，否则您将走上地狱之路。

更新：乔恩在评论中指出要注意的一点，你会知道它是否适用于你的情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T16:28:28.170

您可以使用[NumberFormatInfo](http://msdn.microsoft.com/en-us/library/system.globalization.numberformatinfo.aspx)类来做到这一点。

# c# - 可以在 c# linq 的查询表达式中使用 take 而不是使用 .Take(x) 吗？

> ID：254099
> 
> 赞同：2
> 
> 时间：2008-10-31T16:25:14.840
> 
> 标签：c#, linq, linq-to-sql

我正在尝试编写一些会生成 SQL 的 LINQ To SQL 代码

```
SELECT t.Name, g.Name
FROM Theme t
INNER JOIN (
    SELECT TOP 5 * FROM [Group] ORDER BY TotalMembers
) as g ON t.K = g.ThemeK 
```

到目前为止我有

```
var q = from t in dc.Themes 
join g in dc.Groups on t.K equals g.ThemeK into groups 
select new { 
    t.Name, Groups = (from z in groups orderby z.TotalMembers select z.Name )
}; 
```

但我需要对有序组子查询进行顶部/处理。根据VB 中的[http://blogs.msdn.com/vbteam/archive/2008/01/08/converting-sql-to-linq-part-7-union-top-subqueries-bill-horst.aspx](http://blogs.msdn.com/vbteam/archive/2008/01/08/converting-sql-to-linq-part-7-union-top-subqueries-bill-horst.aspx)我可以最后添加 TAKE 5，但我无法在 c# 中使用此语法。你如何在c#中使用take语法？

编辑：PS 最后添加 .Take(5) 会导致它运行大量单独的查询

编辑 2：我对上面 SQL 的意图犯了一个小错误，但问题仍然存在。**问题是，如果您在查询中使用扩展方法，例如 .Take(5)，LinqToSql 会运行大量 SQL 查询而不是单个查询。**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-31T16:34:57.410

第二个答案，现在我重新阅读了原始问题。

您确定您显示的 SQL 实际上是正确的吗？它不会给出每个主题中的前 5 个组 - 它只会将每个主题与前 5 个组进行*匹配*。

简而言之，我怀疑如果您使用以下命令，您将获得原始 SQL：

```
var q = from t in dc.Themes 
join g in dc.Groups.OrderBy(z => z.TotalMembers).Take(5)
  on t.K equals g.ThemeK into groups 
select new { t.Name, Groups = groups }; 
```

但我不认为那是你真正想要的......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T16:27:05.273

只需将您的查询表达式括起来并调用它：

```
var q = from t in dc.Themes 
join g in dc.Groups on t.K equals g.ThemeK into groups 
select new { t.Name, Groups = 
       (from z in groups orderby z.TotalMembers select z.Name).Take(5) }; 
```

事实上，查询表达式并没有真正让事情变得更简单——你不妨直接调用 OrderBy：

```
var q = from t in dc.Themes 
join g in dc.Groups on t.K equals g.ThemeK into groups 
select new { t.Name, Groups = groups.OrderBy(z => z.TotalMembers).Take(5) }; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T18:31:01.417

这是原始查询的忠实翻译。这不应产生重复的往返。

```
var subquery =
  dc.Groups
  .OrderBy(g => g.TotalMembers)
  .Take(5);

var query =
  dc.Themes
  .Join(subquery, t => t.K, g => g.ThemeK, (t, g) => new
  {
    ThemeName = t.Name, GroupName = g.Name
  }
  ); 
```

问题中的往返是由 groupjoin（加入）引起的。LINQ 中的组具有层次结构。SQL 中的组具有行/列形状（分组键 + 聚合）。为了让 LinqToSql 从行/列结果填充其层次结构，它必须使用组的键单独查询子节点。仅当子级在聚合之外使用时才会这样做。

# javascript - Flash 抢占浏览器焦点

> ID：254111
> 
> 赞同：17
> 
> 时间：2008-10-31T16:28:36.877
> 
> 标签：javascript, html, flash

我的页面中有一个 Flash 应用程序，当用户与 Flash 应用程序交互时，浏览器/html/javascript 停止接收键盘输入。

例如，在 Firefox 中 control-t 不再打开新选项卡。

但是，如果我单击页面中没有闪烁的部分，浏览器会再次开始接收这些事件。

无论如何以编程方式（通过flash或javascript）将焦点返回给浏览器？

用户单击 Flash 中的按钮后，我让 Flash 执行 javascript 回调，因此我尝试通过 javascript 将焦点放在表单字段（和正文）上，但这种方法似乎不起作用。

一个可能更具体的例子是 Youtube。他们也有这个问题。当我单击播放/暂停按钮或调整音量时，我希望我的浏览器键盘控件仍然可以工作，但它们没有，我必须单击电影区域之外的页面上的某个位置。这是我要解决的确切问题。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-31T18:25:03.163

您可以使用 Flash 中的 ExternalInterface 类来调用 JavaScript。例如，您可以在间隔上设置一个函数（例如 Event.ENTER_FRAME）来调用 @Diodeus 提到的 JavaScript 函数：

```
document.body.focus(); 
```

或者，更好的解决方案是向 Flash 根（阶段）添加一个事件监听器，以监听鼠标何时离开 Flash。您可以设置此事件以将焦点移至 document.body。

AS3

```
package {
   import flash.display.*;
   import flash.events.*;
   import flash.external.ExternalInterface;

    public class TestMouseLeave extends Sprite
    {
        public function TestMouseLeave()
        {
            // Add event listener for when the mouse LEAVES FLASH
            addEventListener(MouseEvent.MOUSE_OUT, onMouseLeave);
        }

        private function onMouseLeave(ev:Event):void
        {
            var jslink = new ExternalInterface();
            jslink.call("changeFocus");
        }
    }

} 
```

您页面上的 Javascript：

```
<script type="text/javascript" language="javascript">
    function changeFocus(){
        document.body.focus();
    }
</script> 
```

如果您想要一个 AS2 示例，请告诉我，我会发布它。

*想对这个解决方案做一个说明：一旦将焦点推回浏览器，您将要求用户再次单击 Flash 插件以激活 Flash 插件内的用户输入。这可能是一种不和谐的用户体验，并且是使用此解决方案时需要考虑的问题。*

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-31T16:36:03.723

我认为 Adob​​e 需要在鼠标离开其客户区域时放下焦点，或者提供这样做的选项。

然而，我认为大多数 Flash 开发人员（尤其是那些制作游戏的开发人员）依赖于这样一个事实，即无论鼠标在哪里，Flash 应用程序都会捕获键盘输入。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-12-30T18:14:37.697

在 Firefox 中，`document.body.focus();`不起作用。[使用与 Cláudio Silva 对此Chrome 问题](https://stackoverflow.com/questions/594821/object-focus-problem-with-safari-and-chrome-browsers)的解决方案相同的想法，以下 JavaScript 将在 Firefox 中运行：

```
document.body.tabIndex = 0;
document.body.focus(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-27T20:28:08.127

如果有人需要，下面有一个解决方案。对我来说，这很好用。我可以在我的 Flash 周围单击，但仍然使用所有浏览器键盘功能（在 Flash 内单击时焦点转移到 html 部分）。

[http://forums.adobe.com/message/3431403#3431403](http://forums.adobe.com/message/3431403#3431403)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T06:15:21.300

```
 <?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" creationComplete="init();">
    <mx:Script>
        <![CDATA[
            private function init():void {
                i.setFocus();
                this.addEventListener(KeyboardEvent.KEY_UP,keyPressed);
            }

            private function keyPressed(event:KeyboardEvent):void {
                if(event.keyCode.toString()=="84" && event.ctrlKey==true)
                    ExternalInterface.call('newtab');
            }

        ]]>
    </mx:Script>
    <mx:TextInput x="23" y="268" width="256" id="i" text="Text Box"/>
</mx:Application>

<script type="text/javascript">
function newtab(e){
    document.body.focus();
    window.open('about:blank');
}
</script> 
```

现在，其他键盘会发生什么？T是84标准吗？我喜欢焦点的想法，但在完整的浏览器应用程序中，没有那么多空间可以失去焦点。用户也可以更改组合键，我认为如果不从浏览器快速轮询命令配置，然后像我们在这里基本上做的那样监听组合，我认为这不是一个完整的修复。我不知道。

这也只是在给予焦点后尝试打开一个新窗口，除非他们像弹出窗口一样阻止窗口，否则让用户按下它两次对我来说是没有意义的。但是首先调用焦点，如果发生这种情况，第二次尝试应该有效。如果需要，您可以在浏览器应用程序中提醒用户。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-31T16:48:34.963

您可以通过在 HTML 页面上调用 javascript 的 geturl 将焦点返回给浏览器：

```
document.body.focus() 
```

您如何在 Flash 影片中执行此操作将取决于用户与影片的交互方式。您可以在计时器上、控件失去焦点或鼠标移动时继续执行此操作。这取决于。

# c# - 如何创建 SQL Compact 2008 应用程序

> ID：254116
> 
> 赞同：0
> 
> 时间：2008-10-31T16:30:45.873
> 
> 标签：c#, .net, sql-server-ce

如何为桌面制作 SQL Compact 2008 应用程序？我知道如何使用 SQL Management Studio 2008 连接到 .SDF 文件，但我不知道如何使用我的应用程序连接到它。我已经看过关于这个的教程，我可以在 C# 代码中看到它们引用了一些特殊的命名空间，但我似乎无法让它工作。我所做的是下载 Microsoft SQL Compact SDK，但每当我尝试添加对随附的任何 DLL 的引用时都会出错。有谁知道我在哪里可以找到正确的二进制文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-31T17:25:02.457

你有没有[去这里下载所有](http://msdn.microsoft.com/en-us/library/aa983341.aspx)列出的组件（包括设计工具）？

如果您发布“错误”，您可能会更容易诊断您的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-02T21:52:57.767

您需要下载 SQL Sever Compact 3.5。

然后，您可以使用 .NET SDK（和 Visual Studio）附带的 sqlmetal 工具创建一个 LINQ2SQL 模型（dbml）。目前无法在 Visual Studio 中为紧凑框架创建 LINQ2SQL 类，但您将能够查看和编辑它们。

我现在没有太多时间，因为我真的需要开始了，但我希望这能让你开始。

PS：我项目中的引用是 System.Data、System.Data.Linq 和 System.Data.DataSetExtensions

更新：

至于您引用的 DLL……我不认为它们是 .NET 程序集，而是本机 win32 DLL 旨在供 C++ 开发人员使用。

# javascript - 检测浏览器加载的 JSON

> ID：254121
> 
> 赞同：3
> 
> 时间：2008-10-31T16:32:57.553
> 
> 标签：javascript, json, jsp

我有一个应用程序，其中大多数请求是通过 AJAX 提交的，尽管有些是通过“常规”HTTP 请求提交的。如果提交请求并且用户的会话已超时，则返回以下 JSON：

```
{"authentication":"required"} 
```

提交所有 AJAX 请求的 JavaScript 函数通过显示弹出消息并将用户重定向回登录页面来处理此响应。

但是，当非 AJAX 请求收到此响应时，JSON 会简单地显示在浏览器中，因为响​​应是由浏览器直接处理的（即绕过上述 JavaScript 函数）。显然这并不理想，我希望收到此响应的非 AJAX 请求的行为与 AJAX 请求相同。为了实现这一点，我可以想到 2 个选项：

1.  浏览应用程序并将所有请求转换为 AJAX 请求。这会起作用，但也可能需要很长时间！

2.  上面显示的 JSON 是由一个非常简单的 JSP 生成的。我想知道是否有可能向这个 JSP 添加一个 JavaScript 事件处理程序，该处理程序在内容显示在浏览器中之前运行 - 我假设这永远不会被 AJAX 请求调用？此处理程序可以调用显示弹出窗口并执行重定向的其他 JavaScript 代码。

如果有人知道我如何准确地实现我在 (2) 中概述的处理程序，或者有任何其他潜在的解决方案，如果他们能将它们传递给我，我将不胜感激。

干杯，唐

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-31T16:38:33.643

3) 更改您的 AJAX 代码以将变量添加到 GET 或 POST：`outputJson=1`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T16:39:06.277

您不能以这种方式将处理程序添加到 JSP。您添加到其中的任何内容都会使其成为非 JSON 生成页面。

我可以看到两个选项： 通过将 URL 参数附加到修改输出的屏幕来将参数添加到页面。

URL: [http://domain/page.jsp?ajaxRequest=true](http://domain/page.jsp?ajaxRequest=true) 只会输出 json

URL：[http://domain/page.jsp](http://domain/page.jsp) 将显示一个可以转发到另一个页面的 jsp 页面。

或者

更改响应以在 JSP 中包含转发代码，如果直接点击该代码，该代码将由 Web 浏览器执行。然后让您调用 AJAX 去除转发代码，然后处理剩下的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T16:42:46.083

4) 阅读“接受”请求 HTTP 标头。

然后，在服务器端定制输出：

例如

```
if(Accept contains application/json...) { // client asking for json, likely  to be XHR
  return {"foo":"bar"}
} else { // other
  return "Location: /login-please";
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T18:45:37.707

从更智能的错误消息开始，如下所示：

```
{"error":"authentication required"} 
```

将 JSON 输出包装在回调中：

```
errorHandler({"error":"authentication required"}); 
```

让处理程序在您的脚本中等待：

```
function errorHandler(r) {
   alert(r.error);
} 
```

并且不要忘记将其发送下来 as`text/javascript`和 not `application/x-json`。

# bug-tracking - 一个人的bugtracker？

> ID：254123
> 
> 赞同：38
> 
> 时间：2008-10-31T16:33:27.833
> 
> 标签：bug-tracking

最近我一直在做很多周末编码，并且随着事情的发展速度越来越快，我开始真的需要一个 bugtracker。这可能是最坏的情况，因为我基本上必须让事情在一周内冷静下来，所以我根本不记得我脑海中的错误。到目前为止，我一直在使用文本文件记下错误，但我宁愿使用更好的东西。

这里最大的一点是易于使用和很少的设置时间。不想花一个多小时学习基础知识并尝试安装一些东西。同样在我的情况下，我使用的是 Mac，这会有所帮助，但欢迎其他平台的解决方案，因为它们可能会帮助其他人。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-10-31T16:38:37.590

FogBugz 有一个无限期免费的学生/启动版，供 2 个或更少的用户使用。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-10-31T16:39:06.980

就个人而言，我使用 Excel。（等等，回来，我没疯！）对于一个更大的/团队项目，我已经从 Bugzilla 中获得了大量的里程，但这对于一个人的项目来说往往有点矫枉过正。

但是，一个组织良好的电子表格，包含“状态”、“描述”、“代码模块”、“解决日期”等列，可以让您非常接近小型项目所需的内容。按列对电子表格进行排序并不接近搜索，但它比“在文本文件中查找”要好得多。

哎呀，如果您使用 Google 文档而不是 excel，您甚至可以将内容发布为 RSS 提要并在任何地方获取。

而且，主要优点是设置时间和学习曲线实际上都是零。

附录：当然，当你的“One-Person Bug Tracker”变成“Two-Person Bug Tracker”时，你必须切换到更好的东西。Bugzilla，FogBugz，任何东西。相信我，我去过那里。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-31T16:37:29.057

Trac 或 Redmine 都不错。我不知道在 Mac 上设置它们有多容易。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-31T16:40:29.003

值得一提的是，[FogBugz 还有一个免费版本](http://www.fogcreek.com/FogBugz/StudentAndStartup.html)，最多可容纳 2 位用户，非常适合您。它是托管的，因此无需安装，您可以使用[Fluid](http://fluidapp.com/)之类的工具在其自己的窗口中访问它。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-01T08:22:43.737

我认为您的场景不需要完整的错误跟踪器。

尝试[tiddly wiki](http://www.tiddlywiki.com/)，将每个 bug 存储在 tiddler 中，并给它们贴上“打开”或“关闭”之类的标签。

无需安装（只需一个 html 文件），而且非常易于使用。和平台中立。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-31T16:37:32.740

如果您正在使用 LAMPP 堆栈，那么为了便于设置和使用，我可能会推荐[Mantis](http://www.mantisbt.org/)。它是用 PHP / MySQL 编写的，唯一涉及的安装是指定应该在哪里创建数据库以及应该使用什么凭据。

哦，还有它的[FOSS](http://en.wikipedia.org/wiki/Free_and_open_source_software)。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-31T18:14:51.170

我建议使用 Omnigroup 的[Omnifocus——](http://www.omnigroup.com/applications/omnifocus/)它是一款出色的任务跟踪器，如果您只是从错误到任务的思维跳跃，我认为它非常适合单人项目，并且是组织毫无疑问新兴任务队列的绝佳方式。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-03-11T22:02:36.317

Eclipse 有一个非常有趣的系统——我不知道为什么似乎很少有人知道它。

这与他们的待办事项清单有关。它使您能够根据需要输入尽可能多或尽可能少的信息的错误。如果您愿意，可以将其与版本控制或外部错误跟踪器联系起来。它本身就是一个不错的错误跟踪器。

真正的诀窍是它如何与您的源代码一起工作。

在开始工作之前，您从列表中选择一个错误。在您编码的所有时间，它都会跟踪您正在编辑的文件。它可以为您关闭旧选项卡，并且还会突出显示您已大量修改的源代码树区域。

好消息是，你可以回到你编辑过的任何错误，你会得到你的“环境”。不仅您的所有笔记和资料，而且相同的选项卡将打开，并且导航器中相同的代码部分将突出显示。

eclipse 也适用于几乎任何语言，它不仅限于 Java...

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-06-26T06:47:46.050

让我为[ditz](http://ditz.rubyforge.org/)说一个好词- 它有点简单，但它具有将错误签入您的存储库的宝贵功能。一旦你习惯了它的做事方式，它也很容易使用

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-31T16:39:55.980

如果您是单人团队，则可以免费使用fogbugz。它非常易于使用且快速学习。

他们这样做是为了让错误非常容易输入，没有必填字段。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-11-01T17:49:15.543

我是另一篇文章中提到的 BugTracker.NET 的作者。如果我正在为只有一个人寻找一个不费吹灰之力的追踪器，我会使用 FogBugz，因为它是托管的。无需安装，无需担心备份。

但是，你对版本控制做了什么？你不必担心这一点，并支持它吗？如果是这样，请考虑使用 Unfuddle 或 CVSDude 之类的东西，您可以在其中同时获得 Subversion 和 Trac，或 Subversion 和 Fogbugz。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-31T16:43:36.643

我在家里使用 Mantis，对此我很满意。让它工作可能会很痛苦，因此您可以选择下载免费且现成的 VM 安装。不能比这更容易，

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-31T16:44:25.813

也许电子表格将是下一个合乎逻辑的步骤？我知道这听起来很不性感，但如果你是唯一的用户，你不必太担心其他人会搞砸它，它在文本文件上添加了一些基本功能，比如排序。然后，如果您以后需要升级到 RDBMS 支持的东西，您可能会有一个可行的导入路径。我只知道对我来说，当我自己工作时，我不会把错误放在任何需要更多照顾和喂养的东西中（当然，当与他人合作时，协作需要需要更明确的存储库，但这是一个不同的故事）。

编辑：在注意到对 FogBugz 的免费托管访问的可用性之后，我正在重新考虑护理和喂养的酒吧......

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-31T17:56:52.377

[BestPractical](http://bestpractical.com/rt)的 RT 很棒。

如果我可以在一行中将它们全部表达出来，我也可以从使用 vi 将项目列表保存在一个文本文件中获得很多里程。这通常适用于单个组件或任务上的许多小待办事项。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-31T18:27:08.557

我试过 bugtracker.net，尽管它的边缘有点粗糙，但它是免费的，并且是用 ASP.NET 构建的：

[http://sourceforge.net/project/showfiles.php?group_id=66812](http://sourceforge.net/project/showfiles.php?group_id=66812)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-10-31T18:35:21.503

在这些情况下，我挖掘[ELOG](http://midas.psi.ch/elog/)，它更像是一个个人博客，但它易于处理和安装，数据在您的计算机上本地，您可以通过全文搜索所有条目。对我来说总是足够了。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-11-05T22:46:07.687

您是否也在使用源代码控制存储库？如果不是，你真的应该，即使你只是一个人的团队。

我个人的偏好是使用 VMWare 虚拟应用程序（免费），它提供轻松的设置，让您可以访问 Trac 和 Subversion。您可以通过搜索找到许多不同的虚拟设备。下面是一个启动并运行 Trac/SVN 虚拟设备的示例：

[http://www.rungeek.com/blog/archives/how-to-setup-svn-and-trac-with-a-virtual-appliance/](http://www.rungeek.com/blog/archives/how-to-setup-svn-and-trac-with-a-virtual-appliance/)

Trac 是一个出色的项目管理工具，具有错误跟踪器、wiki 和集成的源代码控制管理。它可以满足您的需求，并且非常适合我个人。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-11-21T16:13:13.273

为此，我使用 bugzilla。另外对我来说，它与 Eclipse 集成（准确地说是与 Mylyn）。FogBuzz 有它，但 AFAIK 它是非免费的。

此外，它位于我的笔记本电脑上，因此我可以在离线时编码和添加/删除错误（这对我来说是托管解决方案的最大缺点）

在 Ubuntu（以及我想的任何基于 debian 的发行版）中安装都不是问题。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2011-02-05T02:17:22.337

如果你有一个带有 IIS 和 MSSQL（包括 SQL Server Express）的 Windows 机器，你应该看看[Bugtracker.net](http://ifdefined.com/bugtrackernet.html)。它是免费和开源的（您可以获得源代码），并且是可扩展的。

即使您是一家单人商店，拥有一个具有如此强大功能的免费错误跟踪系统也会让您随着时间的推移而成长，因为将未来的用户添加到系统中是相当容易的。

您还可以根据您的组织、业务或产品的外观对其进行自定义。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-11-01T00:46:15.780

Axosoft 的 Ontime 2008 对单一用户许可证是免费的。它具有工业实力，并且会为您提供比错误跟踪更多的功能！

[http://www.axosoft.com](http://www.axosoft.com)

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-11-05T22:24:51.990

[Jira](http://www.atlassian.com/software/jira)现在拥有免费[的个人](http://www.atlassian.com/software/jira/personal.jsp)许可证。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-03-11T22:02:10.563

我为此目的使用[leo 。](http://webpages.charter.net/edreamleo/front.html)更具体地说，它的[cleo](http://leo.zwiki.org/cleodoc.html)插件。

当然，你可能需要花一些时间来适应狮子座，但它会得到回报。

纯文本文件只是一个列表，Excel 电子表格是一个二维列表。

leo 让您将数据保存在树中！它也有[克隆](http://webpages.charter.net/edreamleo/intro.html#clones-views)。

# c# - 在 WPF 中更改 Canvas 的坐标系

> ID：254125
> 
> 赞同：18
> 
> 时间：2008-10-31T16:34:09.283
> 
> 标签：c#, wpf, xaml, wpf-controls

我正在编写一个使用 Canvas 定位元素的地图应用程序。对于每个元素，我必须以编程方式将元素的 Lat/Long 转换为画布的坐标，然后设置 Canvas.Top 和 Canvas.Left 属性。

如果我有一个 360x180 画布，我可以将画布上的坐标转换为 X 轴上的 -180 到 180 而不是 0 到 360 和 Y 轴上的 90 到 -90 而不是 0 到 180？

缩放要求：

*   画布可以是任何尺寸，所以如果它是 360x180 或 5000x100，它仍然可以工作。
*   Lat/Long 区域可能并不总是 (-90,-180)x(90,180)，它可以是任何东西（即 (5,-175)x(89,-174)）。
*   PathGeometry 等基于点的元素，而不是基于 Canvas.Top/Left 的元素需要工作。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-31T19:59:57.200

这是一个全 XAML 解决方案。好吧，主要是 XAML，因为您必须在代码中包含 IValueConverter。所以：创建一个新的 WPF 项目并向其中添加一个类。该类是 MultiplyConverter：

```
namespace YourProject
{
    public class MultiplyConverter : System.Windows.Data.IValueConverter
    {
        public object Convert(object value, System.Type targetType, object parameter, System.Globalization.CultureInfo culture)
        {
            return AsDouble(value)* AsDouble(parameter);
        }
        double AsDouble(object value)
        {
            var valueText = value as string;
            if (valueText != null)
                return double.Parse(valueText);
            else
                return (double)value;
        }

        public object ConvertBack(object value, System.Type targetType, object parameter, System.Globalization.CultureInfo culture)
        {
            throw new System.NotSupportedException();
        }
    }
} 
```

然后将此 XAML 用于您的窗口。现在您应该在 XAML 预览窗口中看到结果。

**编辑**：您可以通过将画布放在另一个画布中来解决背景问题。有点奇怪，但它有效。此外，我添加了一个 ScaleTransform 翻转 Y 轴，使正 Y 向上，负 Y 向下。仔细注意哪些名称去哪里：

```
<Canvas Name="canvas" Background="Moccasin">
    <Canvas Name="innerCanvas">
        <Canvas.RenderTransform>
            <TransformGroup>
                <TranslateTransform x:Name="translate">
                    <TranslateTransform.X>
                        <Binding ElementName="canvas" Path="ActualWidth"
                                Converter="{StaticResource multiplyConverter}" ConverterParameter="0.5" />
                    </TranslateTransform.X>
                    <TranslateTransform.Y>
                        <Binding ElementName="canvas" Path="ActualHeight"
                                Converter="{StaticResource multiplyConverter}" ConverterParameter="0.5" />
                    </TranslateTransform.Y>
                </TranslateTransform>
                <ScaleTransform ScaleX="1" ScaleY="-1" CenterX="{Binding ElementName=translate,Path=X}"
                        CenterY="{Binding ElementName=translate,Path=Y}" />
            </TransformGroup>
        </Canvas.RenderTransform>
        <Rectangle Canvas.Top="-50" Canvas.Left="-50" Height="100" Width="200" Fill="Blue" />
        <Rectangle Canvas.Top="0" Canvas.Left="0" Height="200" Width="100" Fill="Green" />
        <Rectangle Canvas.Top="-25" Canvas.Left="-25" Height="50" Width="50" Fill="HotPink" />
    </Canvas>
</Canvas> 
```

至于您需要不同范围的新要求，更复杂的 ValueConverter 可能会解决问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T19:54:04.323

我可以通过创建自己的自定义画布并覆盖 ArrangeOverride 函数来实现它，如下所示：

```
 public class CustomCanvas : Canvas
    {
        protected override Size ArrangeOverride(Size arrangeSize)
        {
            foreach (UIElement child in InternalChildren)
            {
                double left = Canvas.GetLeft(child);
                double top = Canvas.GetTop(child);
                Point canvasPoint = ToCanvas(top, left);
                child.Arrange(new Rect(canvasPoint, child.DesiredSize));
            }
            return arrangeSize;
        }
        Point ToCanvas(double lat, double lon)
        {
            double x = this.Width / 360;
            x *= (lon - -180);
            double y = this.Height / 180;
            y *= -(lat + -90);
            return new Point(x, y);
        }
    } 
```

这适用于我描述的问题，但它可能不适用于我的另一个需求，即 PathGeometry。它不起作用，因为这些点没有被定义为顶部和左侧，而是作为实际点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-02T09:52:00.170

您可以使用 transform 在坐标系之间进行转换，也许是带有 TranslateTranform 的 TransformGroup 将 (0,0) 移动到画布的中心，并使用 ScaleTransform 将坐标移到正确的范围内。

通过数据绑定和一两个值转换器，您可以根据画布大小自动更新转换。

这样做的好处是它适用于任何元素（包括 PathGeometry），一个可能的缺点是它会缩放所有内容而不仅仅是点 - 所以它会改变地图上图标和文本的大小。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-11-25T00:58:09.153

这是[一个答案](https://stackoverflow.com/questions/13079610/equivalent-of-glortho-in-wpf/13093518#13093518)，它描述了`Canvas`一种允许您应用笛卡尔坐标系的扩展方法。IE：

```
canvas.SetCoordinateSystem(-10, 10, -10, 10) 
```

将设置的坐标系从 -10 到 10 并`canvas`从-10 到 10。`x``y`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-31T16:41:57.770

我很确定您不能完全做到这一点，但是拥有一种从 lat/long 转换为 Canvas 坐标的方法将非常简单。

```
Point ToCanvas(double lat, double lon) {
  double x = ((lon * myCanvas.ActualWidth) / 360.0) - 180.0;
  double y = ((lat * myCanvas.ActualHeight) / 180.0) - 90.0;
  return new Point(x,y);
} 
```

（或类似的规定）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-31T16:50:25.943

我想另一种选择是扩展画布并覆盖度量/安排以使其按照您想要的方式运行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-06-18T14:17:21.383

另一种可能的解决方案：

将自定义画布（绘图画布）嵌入另一个画布（背景画布）并设置绘图画布，使其透明且不会裁剪到边界。使用使 y 翻转 (M22 = -1) 并在父画布内平移/缩放画布以查看您正在查看的世界的扩展的矩阵变换绘制画布。

实际上，如果您在 draw-to 画布中的 -115、42 处绘制，则您正在绘制的项目“离开”画布，但无论如何都会显示出来，因为画布没有剪裁到边界。然后转换绘制到的画布，使该点显示在背景画布上的正确位置。

这是我很快就会尝试的事情。希望能帮助到你。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-12-14T21:11:23.363

我有几乎同样的问题。所以我上网了。这家伙使用矩阵从“设备像素”转换为他所谓的“世界坐标”，他的意思是真实世界数字而不是“设备像素”，请参阅链接

[http://csharphelper.com/blog/2014/09/use-transformations-draw-graph-wpf-c/](http://csharphelper.com/blog/2014/09/use-transformations-draw-graph-wpf-c/)

# c# - 如何使用 C# 在列表视图列的标题中显示排序箭头？

> ID：254129
> 
> 赞同：43
> 
> 时间：2008-10-31T16:35:55.253
> 
> 标签：c#, listview

如何在遵循操作系统本机外观的列表视图中的已排序列的标题中显示排序箭头？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-10-31T16:38:00.710

您可以使用以下扩展方法将排序箭头设置为特定列：

```
[EditorBrowsable(EditorBrowsableState.Never)]
public static class ListViewExtensions
{
    [StructLayout(LayoutKind.Sequential)]
    public struct HDITEM
    {
        public Mask mask;
        public int cxy;
        [MarshalAs(UnmanagedType.LPTStr)] public string pszText;
        public IntPtr hbm;
        public int cchTextMax;
        public Format fmt;
        public IntPtr lParam;
        // _WIN32_IE >= 0x0300 
        public int iImage;
        public int iOrder;
        // _WIN32_IE >= 0x0500
        public uint type;
        public IntPtr pvFilter;
        // _WIN32_WINNT >= 0x0600
        public uint state;

        [Flags]
        public enum Mask
        {
            Format = 0x4,       // HDI_FORMAT
        };

        [Flags]
        public enum Format
        {
            SortDown = 0x200,   // HDF_SORTDOWN
            SortUp = 0x400,     // HDF_SORTUP
        };
    };

    public const int LVM_FIRST = 0x1000;
    public const int LVM_GETHEADER = LVM_FIRST + 31;

    public const int HDM_FIRST = 0x1200;
    public const int HDM_GETITEM = HDM_FIRST + 11;
    public const int HDM_SETITEM = HDM_FIRST + 12;

    [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    public static extern IntPtr SendMessage(IntPtr hWnd, UInt32 msg, IntPtr wParam, IntPtr lParam);

    [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    public static extern IntPtr SendMessage(IntPtr hWnd, UInt32 msg, IntPtr wParam, ref HDITEM lParam);

    public static void SetSortIcon(this ListView listViewControl, int columnIndex, SortOrder order)
    {
        IntPtr columnHeader = SendMessage(listViewControl.Handle, LVM_GETHEADER, IntPtr.Zero, IntPtr.Zero);
        for (int columnNumber = 0; columnNumber <= listViewControl.Columns.Count - 1; columnNumber++)
        {
            var columnPtr = new IntPtr(columnNumber);
            var item = new HDITEM
                {
                    mask = HDITEM.Mask.Format
                };

            if (SendMessage(columnHeader, HDM_GETITEM, columnPtr, ref item) == IntPtr.Zero)
            {
                throw new Win32Exception();
            }

            if (order != SortOrder.None && columnNumber == columnIndex)
            {
                switch (order)
                {
                    case SortOrder.Ascending:
                        item.fmt &= ~HDITEM.Format.SortDown;
                        item.fmt |= HDITEM.Format.SortUp;
                        break;
                    case SortOrder.Descending:
                        item.fmt &= ~HDITEM.Format.SortUp;
                        item.fmt |= HDITEM.Format.SortDown;
                        break;
                }
            }
            else
            {
                item.fmt &= ~HDITEM.Format.SortDown & ~HDITEM.Format.SortUp;
            }

            if (SendMessage(columnHeader, HDM_SETITEM, columnPtr, ref item) == IntPtr.Zero)
            {
                throw new Win32Exception();
            }
        }
    }
} 
```

然后，您可以像这样调用扩展方法：

```
myListView.SetSortIcon(0, SortOrder.Ascending); 
```

它通过使用 P/Invoke 来工作：

*   [使用LVM_GETHEADER](http://msdn.microsoft.com/en-us/library/windows/desktop/bb774937%28v=vs.85%29.aspx)消息获取列表视图的标头控件的句柄。
*   [使用HDM_GETITEM](http://msdn.microsoft.com/en-us/library/windows/desktop/bb775335%28v=vs.85%29.aspx)消息获取有关标题列的信息。
*   然后它修改`fmt`以设置/清除返回的[HDITEM](http://msdn.microsoft.com/en-us/library/windows/desktop/bb775247%28v=vs.85%29.aspx)结构上的`HDF_SORTDOWN`和`HDF_SORTUP`标志。
*   [最后，它使用HDM_SETITEM](http://msdn.microsoft.com/en-us/library/windows/desktop/bb775367%28v=vs.85%29.aspx)消息重新设置信息。

这是它的样子：

![列表视图列上的箭头](https://i.stack.imgur.com/4deP5.png)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2014-11-17T14:01:14.247

安德鲁的回答很好。如果有人在这里寻找 VB.net 等价物，它是：

```
Public Module ListViewExtensions
    Public Enum SortOrder
        None
        Ascending
        Descending
    End Enum

    <StructLayout(LayoutKind.Sequential)>
    Public Structure HDITEM
        Public theMask As Mask
        Public cxy As Integer
        <MarshalAs(UnmanagedType.LPTStr)>
        Public pszText As String
        Public hbm As IntPtr
        Public cchTextMax As Integer
        Public fmt As Format
        Public lParam As IntPtr
        ' _WIN32_IE >= 0x0300 
        Public iImage As Integer
        Public iOrder As Integer
        ' _WIN32_IE >= 0x0500
        Public type As UInteger
        Public pvFilter As IntPtr
        ' _WIN32_WINNT >= 0x0600
        Public state As UInteger

        <Flags()>
        Public Enum Mask
            Format = &H4       ' HDI_FORMAT
        End Enum

        <Flags()>
        Public Enum Format
            SortDown = &H200 ' HDF_SORTDOWN
            SortUp = &H400     ' HDF_SORTUP
        End Enum
    End Structure

    Public Const LVM_FIRST As Integer = &H1000
    Public Const LVM_GETHEADER As Integer = LVM_FIRST + 31

    Public Const HDM_FIRST As Integer = &H1200
    Public Const HDM_GETITEM As Integer = HDM_FIRST + 11
    Public Const HDM_SETITEM As Integer = HDM_FIRST + 12

    <DllImport("user32.dll", CharSet:=CharSet.Auto, SetLastError:=True)>
    Public Function SendMessage(hWnd As IntPtr, msg As UInt32, wParam As IntPtr, lParam As IntPtr) As IntPtr
    End Function

    <DllImport("user32.dll", CharSet:=CharSet.Auto, SetLastError:=True)>
    Public Function SendMessage(hWnd As IntPtr, msg As UInt32, wParam As IntPtr, ByRef lParam As HDITEM) As IntPtr
    End Function

    <Extension()>
    Public Sub SetSortIcon(listViewControl As ListView, columnIndex As Integer, order As SortOrder)
        Dim columnHeader As IntPtr = SendMessage(listViewControl.Handle, LVM_GETHEADER, IntPtr.Zero, IntPtr.Zero)
        For columnNumber As Integer = 0 To listViewControl.Columns.Count - 1

            Dim columnPtr As New IntPtr(columnNumber)
            Dim item As New HDITEM

            item.theMask = HDITEM.Mask.Format

            If SendMessage(columnHeader, HDM_GETITEM, columnPtr, item) = IntPtr.Zero Then Throw New Win32Exception

            If order <> SortOrder.None AndAlso columnNumber = columnIndex Then
                Select Case order
                    Case SortOrder.Ascending
                        item.fmt = item.fmt And Not HDITEM.Format.SortDown
                        item.fmt = item.fmt Or HDITEM.Format.SortUp
                    Case SortOrder.Descending
                        item.fmt = item.fmt And Not HDITEM.Format.SortUp
                        item.fmt = item.fmt Or HDITEM.Format.SortDown
                End Select
            Else
                item.fmt = item.fmt And Not HDITEM.Format.SortDown And Not HDITEM.Format.SortUp
            End If

            If SendMessage(columnHeader, HDM_SETITEM, columnPtr, item) = IntPtr.Zero Then Throw New Win32Exception
        Next
    End Sub
End Module 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2017-07-25T17:37:53.940

对于任何其他懒惰的 C++ 程序员（比如我）：

```
// possible sorting header icons / indicators
enum class ListViewSortArrow { None, Ascending, Descending };

BOOL LVHeader_SetSortArrow(HWND hHeader, int nColumn, ListViewSortArrow sortArrow)
{
    ASSERT(hHeader);

    HDITEM hdrItem = { 0 };
    hdrItem.mask = HDI_FORMAT;
    if (Header_GetItem(hHeader, nColumn, &hdrItem))
    {
        switch (sortArrow)
        {
        default:
            ASSERT(false);
        case ListViewSortArrow::None:
            hdrItem.fmt = hdrItem.fmt & ~(HDF_SORTDOWN | HDF_SORTUP);
            break;
        case ListViewSortArrow::Ascending:
            hdrItem.fmt = (hdrItem.fmt & ~HDF_SORTDOWN) | HDF_SORTUP;
            break;
        case ListViewSortArrow::Descending:
            hdrItem.fmt = (hdrItem.fmt & ~HDF_SORTUP) | HDF_SORTDOWN;
            break;
        }

        return Header_SetItem(hHeader, nColumn, &hdrItem);
    }

    return FALSE;
}

BOOL ListView_SetSortArrow(HWND hListView, int nColumn, ListViewSortArrow sortArrow)
{
    ASSERT(hListView);

    if (HWND hHeader = ListView_GetHeader(hListView))
        return LVHeader_SetSortArrow(hHeader, nColumn, sortArrow);

    return FALSE;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2019-04-06T13:40:51.330

您可以妥协并使用看起来像箭头的字符，而不是弄乱 Windows API（我使用charmap 选择了它们）

```
private void SetSortArrow(ColumnHeader head, SortOrder order)
{
    const string ascArrow = " ▲";
    const string descArrow = " ▼";

    // remove arrow
    if(head.Text.EndsWith(ascArrow) || head.Text.EndsWith(descArrow))
        head.Text = head.Text.Substring(0, head.Text.Length-2);

    // add arrow
    switch (order)
    {
        case SortOrder.Ascending: head.Text += ascArrow; break;
        case  SortOrder.Descending: head.Text += descArrow; break;
    }
}

SetSortArrow(listView1.Columns[0], SortOrder.None);       // remove arrow from first column if present
SetSortArrow(listView1.Columns[1], SortOrder.Ascending);  // set second column arrow to ascending
SetSortArrow(listView1.Columns[1], SortOrder.Descending); // set second column arrow to descending 
```

# c++ - Automake：Makefile.am 中 *_la_LDFLAGS 的有效值是什么？

> ID：254132
> 
> 赞同：1
> 
> 时间：2008-10-31T16:36:14.957
> 
> 标签：c++, shared, autotools, automake

我想知道 Makefile.am 中 *_la_LDFLAGS 的可能值是多少？

如果我问这个问题，那是因为我想要以下内容：

```
Actual shared library : libA.so (or with the version number I don't care)
Symbolic links :        libA-X.Y.Z.so, libA-X.so, libA.so 
soname :                libA-X.so 
```

然而，这是我通过使用*-release*标志得到的：

```
Actual shared library : libA-X.Y.Z.so
Symbolic links :        libA.so 
soname :                libA-X.Y.Z.so    !!! this is not what I want 
```

我也尝试过完全没有标志并得到了

```
Actual shared library : libA-0.0.0.so    !!! 0.0.0 and not the real version
Symbolic links :        libA.so, libA-0.so
soname :                libA-0.so        !!! 0.0.0 and not the real version 
```

我应该怎么做 ？我应该使用哪个标志？

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-01T08:47:29.910

您应该使用`-version-info`Libtool 的选项来指定库的接口版本，但请务必阅读 [版本控制的工作原理](http://sources.redhat.com/autobook/autobook/autobook_91.html)（或[此处](http://www.gnu.org/software/libtool/manual/html_node/Versioning.html#Versioning)获取官方手册。）

您还可以`-release`尝试使您的软件包的版本号更加明显，但我怀疑您是否会得到您想要的确切名称。Libtool 有自己的一套规则来定义如何命名文件以及根据系统创建哪些符号链接：这些确实应该被视为如何安装共享库的实现细节。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-01T15:38:30.893

恕我直言，您想要的布局已损坏。由于 soname 的原因，链接到您的库的应用程序将依赖 libA-X.so。但是当 libA.so 是 X+1 版本时会发生什么？libA-X.so 符号链接指向什么？

使用 -release 标志获得的布局背后的想法是，当应用程序与 -lA 链接时，它将导致它与最新版本链接。然后，由于 soname，它将在运行时依赖于 libA-XYZso。当您安装新版本的库时，它将安装一个新的 libA-XYQso，但它会留下旧的 - 就像依赖它的旧应用程序所期望的那样。由于 libA 符号链接，新应用程序仍将链接到最新版本。

一些非常聪明的人多年来的想法已经进入了版本控制方案，该方案允许新应用程序链接到库的最新版本，同时允许多个版本和平共存以满足需要它们的应用程序的依赖关系。我的建议是，不要对这一切进行猜测。

# operating-system - 开发操作系统的资源

> ID：254149
> 
> 赞同：66
> 
> 时间：2008-10-31T16:39:46.027
> 
> 标签：operating-system, osdev

我打算写一个操作系统，但我对操作系统不太了解。有什么好的资源或书籍可供我学习吗？你有什么建议？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-10-31T16:44:06.377

我们在我就读的大学使用了 Andrew Tannenbaum 的[现代操作系统。](https://rads.stackoverflow.com/amzn/click/com/0136006639)我强烈推荐它，因为它清楚地解释了您将遇到的许多设计决策中固有的权衡。这本书比 Minix 的书要“公平和平衡”一点。

[![替代文字](https://i.stack.imgur.com/Ku7PB.jpg)](https://i.stack.imgur.com/Ku7PB.jpg)

我也推荐这本书，因为尽管他[与 Linus Torvalds 的火爆网络闻名遐迩](http://oreilly.com/catalog/opensources/book/appa.html)，但他的偏见很少在书中体现出来。此外，他是一个相当不错的作家，这本书实际上很有趣。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-31T16:43:40.433

[操作系统实施 Prentice 软件](https://rads.stackoverflow.com/amzn/click/com/0131429388)

[![替代文字](https://i.stack.imgur.com/5kxtY.jpg)](https://i.stack.imgur.com/5kxtY.jpg)

这本书是由 Minix 背后的主要人物 Tanenbaum 撰写的，这是 Linux 的基础。它为内存管理、文件系统、进程等基本操作系统概念提供了很好的概述。本书中的概念与 Minix 操作系统的示例密切相关，这是一件好事。

我认为你应该从这样的事情开始。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-31T17:35:16.553

这个网站上的类似主题：

*   [操作系统开发](https://stackoverflow.com/questions/130065/os-development "操作系统开发")
*   [构建新的操作系统](https://stackoverflow.com/questions/101294/building-a-new-operating-system "构建新的操作系统")
*   [如何开始操作系统开发](https://stackoverflow.com/questions/43180/how-to-get-started-in-operating-system-development "如何开始操作系统开发")

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-31T16:56:36.460

[操作系统概念](https://rads.stackoverflow.com/amzn/click/com/0471694665)是我们在大学使用的书。这很丑陋，但里面的信息很好地解释了（从基本的内存管理，到操作系统如何决定执行什么或如何避免死锁）。挺宽的。

[![替代文字](https://i.stack.imgur.com/v6iEs.jpg)](https://i.stack.imgur.com/v6iEs.jpg)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-31T16:45:32.723

如果您也想开始编写自己的操作系统，[Os dev网站提供了丰富的信息，](http://www.osdev.org/)

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-31T18:14:17.943

虽然很旧，但这些书非常好：

[Xinu 操作系统设计](https://rads.stackoverflow.com/amzn/click/com/0136375391)

[http://ecx.images-amazon.com/images/I/51AVJFBS3EL._SL500_BO2,204,203,200_AA219_PIsitb-sticker-dp-arrow,TopRight,-24,-23_SH20_OU01_.jpg](http://ecx.images-amazon.com/images/I/51AVJFBS3EL._SL500_BO2,204,203,200_AA219_PIsitb-sticker-dp-arrow,TopRight,-24,-23_SH20_OU01_.jpg)

[操作系统设计-与XINU互联，卷。二](https://rads.stackoverflow.com/amzn/click/com/013637414X)

[![替代文字](https://i.stack.imgur.com/tmoN3.jpg)](https://i.stack.imgur.com/tmoN3.jpg)

[3](https://rads.stackoverflow.com/amzn/click/com/013637414X)：[http://操作系统](http://Operating)设计-与XINU互联，卷。二

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-10T02:35:58.073

看看[HelenOS](http://helenos.org)，它是一个从零开始的基于微内核的操作系统，旨在成为一个完全现代的操作系统。Disclamer，我是贡献者，我正在从头开始研究它的外壳。

HelenOS 已被移植到 ia32/64、SPARC、ARM 等，其设计精良且易于阅读。它仍处于起步阶段，但展示了一种可能的设计，它真正利用了微内核设计并解决了微内核实现（例如 IPC）中的许多问题。

它还包括自动设置交叉编译所需的适当工具链的脚本。它非常容易构建并且在大多数模拟器（即 QEMU）或裸机中运行良好。

我还将研究 L4、Minix3 和 GNU HURD（基于 Mach），后者是尝试利用微内核时设计缺陷的一个例证。

如果你想走单体路线，那就学习 Linux。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-31T17:39:51.007

我强烈建议您看看[MIT 操作系统类](http://pdos.csail.mit.edu/6.828/2008/)。它有很多有用的参考资料，还有一堆你可以玩的实验室练习（包括自动评分脚本，所以你不必是麻省理工学院的学生也可以做）。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-16T22:47:35.217

[教科书 http://ecx.images-amazon.com/images/I/411E3CQQYZL._SS500_.jpg](http://ecx.images-amazon.com/images/I/411E3CQQYZL._SS500_.jpg)

我在大学时使用过*操作系统和中间件：支持受控交互。*它可能是这方面最好的教科书之一。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-31T16:45:21.990

*   [操作系统设计与实现](https://rads.stackoverflow.com/amzn/click/com/0131429388)
*   [FreeBSD操作系统的设计与实现](https://rads.stackoverflow.com/amzn/click/com/0201702452)

就在我的头上。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-31T19:11:54.800

Richard A. Burgess 开发您自己的 32 位操作系统。详细介绍了引导加载程序、设置那些奇怪的内存和进程管理寄存器等。这是 1996 年的一篇很棒的读物，当时我想我会尝试从头开始编写一个简单的操作系统，但可能会过时现在，只处理前几代奔腾级 CPU。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-31T18:05:26.447

如果我没记错的话，[Powerup to Bash Prompt HOWTO](http://tldp.org/HOWTO/From-PowerUp-To-Bash-Prompt-HOWTO.html)包含很多看起来对这个有用的信息。旧版本的 Linux From Scratch HOWTO 也是如此，但在最近的版本中已被删除。

您还可以在[了解 Linux 内核](http://oreilly.com/catalog/9780596005658/index.html)中找到很多有用的信息。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-31T18:36:04.917

我建议查看嵌入式操作系统并构建嵌入式操作系统。它将处理核心概念，而无需现代台式机 CPU 的开销。

我去年春天写了一个多任务嵌入式操作系统作为最终项目，它比你想象的要容易。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-01-10T02:06:04.543

你应该研究一下 MINIX 3。我相信这是一个用不到 10,000 行代码编写的操作系统。借助 Tanenbaum 的一本书，您可以很好地了解操作系统的工作原理，并了解 MINIX 3 的工作原理。您可以直接使用 Linux，但我认为这是一项有用的任务，并且确实可以帮助您了解构建一个正常工作的操作系统实际上不需要那么多行。

[http://www.minix3.org/](http://www.minix3.org/)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-04-26T11:52:29.250

除了书籍，还有很多学习操作系统开发的网站
[BrokenThorn Entertainment](http://www.brokenthorn.com/Resources/OSDevIndex.html)在这个网站上从基础学习操作系统开发

# database - NULL 是如何存储在数据库中的？

> ID：254152
> 
> 赞同：11
> 
> 时间：2008-10-31T16:41:28.533
> 
> 标签：database, null

我很想知道 NULL 是如何存储到数据库中的？

它肯定取决于数据库服务器，但我想对它有一个大致的了解。

* * *

第一次尝试：

假设服务器将未定义的值（可以是任何值）放入 NULL 值的字段中。

您能否非常幸运并使用以下方法检索 NULL 值

```
...WHERE field = 'the undefined value (remember, could be anything...)' 
```

* * *

第二次尝试：

服务器是否在某处有标志或任何元数据来指示该字段为 NULL ？

然后服务器必须读取此元数据以验证该字段。

如果元数据指示 NULL 值并且如果查询没有“字段 IS NULL”，则忽略该记录。

* * *

好像太容易了...

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-31T16:45:05.033

MySql 使用第二种方法。它存储一个位数组（每列一个）以及每行的数据以指示哪些列为空，然后将该字段的数据留空。我很确定这对所有其他数据库也是如此。

第一种方法的问题是，您确定为数据选择的任何值都不会显示为有效数据吗？对于某些值（如日期或浮点数），这是正确的。对于其他人（如整数），这是错误的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-31T16:55:49.800

在 PostgreSQL 上，它使用每列一个位的可选位图（0 为空，1 不为空）。如果位图不存在，则所有列都不为空。

这与数据本身的存储完全分开，但与行在同一页上（因此行和位图都被一起读取）。

参考：

*   [http://www.postgresql.org/docs/8.3/interactive/storage-page-layout.html](http://www.postgresql.org/docs/8.3/interactive/storage-page-layout.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-31T16:44:16.500

服务器通常使用元信息而不是魔法值。所以有些地方指定了该字段是否为空。

-亚当

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-01T07:04:19.650

IBM Informix Dynamic Server 使用特殊值来指示空值。例如，SMALLINT（16 位，有符号）的有效值范围是 -32767..+32767。另一个值 -32768 被保留以指示 NULL。对于 INTEGER（4 字节，有符号）和 BIGINT（8 字节，有符号）也是如此。对于其他类型，它使用其他特殊表示（例如，SQL FLOAT 和 SMALLFLOAT 的所有位 1 - 分别称为 C double 和 float）。这意味着它不必使用额外的空间。

IBM DB2 for Linux, Unix, Windows 使用额外的字节来存储空指标；AFAIK，它为每个可为空的字段使用一个单独的字节，但我在那个细节上可能是错误的。

因此，正如所指出的，机制因 DBMS 而异。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-05T21:12:40.137

用特殊值表示 NULL 的问题是迟早会插入特殊值。例如，它将被插入到一个表中，为不同的数据库服务器指定特殊的 NULL 指示符

```
| DBServer     | SpecialValue |
+--------------+--------------+
| 'Oracle'     | 'Glyph'      |
| 'SQL Server' | 'Redmond'    | 
```

;-)

# sql - sql连接帮助

> ID：254168
> 
> 赞同：2
> 
> 时间：2008-10-31T16:45:39.650
> 
> 标签：sql, sql-server

我有两张桌子：

表 1：ID、PersonCode、姓名、

表 2：ID、Table1ID、位置、服务日期

我有一个查询将表 1 连接到表 2 上 table1.ID = table2.Table1ID 其中 PersonCode = 'XYZ'

我想要做的是返回 Table1.PersonCode、Table1.Name、Table2.Location、Table2.ServiceDate，我不想要所有行，在表 2 中，我只对每个位置具有最新 ServiceDate 的行感兴趣. 我该怎么做呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-31T16:50:48.360

像这样的东西：

```
SELECT
    Table1.PersonCode, Table1.Name, Table2.Location, MAX(Table2.ServiceDate)
FROM
    Table1 
    INNER JOIN Table2 on Table1.ID = Table2.Table1ID 
WHERE
    TABLE1.PersonCode = 'XYZ'
GROUP BY
    Table1.PersonCode,Table1.Name, Table2.Location 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T16:46:51.970

使用 MAX（服务日期）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T16:49:46.317

尝试：

```
select Table1.PersonCode,Table1.Name, Table2.Location, Table2.ServiceDate
from Table1
join Table2 on table1.ID = table2.Table1ID 
where table1.PersonCode = 'XYZ'
and table2.ServiceDate = (select max(t2.ServiceDate)
                          from   table2 t2
                          where  t2.table1ID = table2.table1ID
                          and    t2.location = table2.location
                         ); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T17:02:49.553

我将使用`INNER JOIN`并选择第一条记录，并根据 Table2.ServiceDate 按时间倒序对记录进行排序。

```
SELECT TOP 1
    Table1.PersonCode, Table1.Name, Table2.Location, Table2.ServiceDate
FROM
    Table1 
    INNER JOIN Table2 on Table1.ID = Table2.Table1ID 
WHERE
    TABLE1.PersonCode = 'XYZ'
ORDER BY Table2.ServiceDate DESC
GROUP BY
    Table1.PersonCode,Table1.Name, Table2.Location 
```

# windows - 在程序运行后查找磁盘上哪些文件已更改的好工具/方法是什么？

> ID：254172
> 
> 赞同：0
> 
> 时间：2008-10-31T16:46:07.370
> 
> 标签：windows, file, replication, compare

我遇到了一个奇怪的问题，即我的 Visual Studio 2005 C++ 程序在新构建后第一次运行时崩溃。我在调试这个间歇性问题时遇到了困难，我怀疑它与我硬盘上某处正在更改的文件有关。如果我能找到这些文件，那可能会提供对这个问题的更多见解。是否有任何好的工具可以观察特定程序运行时正在创建/删除/修改哪些文件？

提前致谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-31T16:49:09.017

您可以使用[进程监视器](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)工具。将“显示文件系统活动”设置为 ON，并在进程名称上设置过滤器以仅获取您需要的跟踪。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T16:51:44.893

SysInternals（现为微软）FileMon

[http://technet.microsoft.com/en-us/sysinternals/bb896642.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896642.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T17:17:43.127

使用[查找](http://man.he.net/?topic=find&section=all)。

```
touch ~/test-marker
# run your program
find <directory> -newer ~/test-marker 
```

# c# - 是否有 C# 自动格式化程序可用于定义自定义格式化规则？

> ID：254175
> 
> 赞同：1
> 
> 时间：2008-10-31T16:46:41.050
> 
> 标签：c#, formatting, text-formatting

我的小组有一个源分析工具，它强制执行我们必须遵守的某些样式。改不了了，有些规矩就是个痛点。一个例子是所有属性都必须在方法之前，并且所有构造函数都必须在属性之前。对我来说似乎很愚蠢，我必须花时间对程序做一些事情，而编译器却是一样的。我想要一些 VS 的插件，它可以让我自动做这样的事情。此外，最好让它自动将 using 放入命名空间块中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T16:52:06.767

您有不同的可能性，具体取决于您想要做什么：

Resharper：有一个自动格式化功能，可以根据您选择的规则格式化项目/解决方案中的单个文件或所有文件的源代码。因此，您设置了大括号、命名、空格、运算符、lamdas 等设置。有关更多信息，请参见[此处](http://www.jetbrains.com/resharper/)。Resharper 还支持为所有解决方案设置源代码文件或为团队中的所有人设置相同的共享设置文件。

FxCop：我从来没有在工作中使用过它，但它也是一个很棒的工具，你还可以选择你想要执行的规则。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T16:54:51.830

除非他们将其烘焙到 VS2010 中，否则 Resharper 具有您可能正在寻找的自动格式化功能。CodeSmith 应该也有，只是我没用过。。。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T16:57:43.807

VS 内置了一些格式化选项。转到工具-->选项-->文本编辑器-->C#-->格式化。

它们不包括所有场景，但可能会让您接近。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T16:58:24.570

Resharper - 多么棒的工具。我不认为没有它我能应付。它必须是 Visual Studio 的终极生产力工具。重构、代码分析、代码格式化、代码完成——它有很多。

# c# - C# 字典 ValueOrNull / ValueorDefault

> ID：254178
> 
> 赞同：15
> 
> 时间：2008-10-31T16:47:27.790
> 
> 标签：c#, .net, dictionary

目前我正在使用

```
var x = dict.ContainsKey(key) ? dict[key] : defaultValue 
```

我想要一些方法让字典 [key] 为不存在的键返回 null，所以我可以写类似的东西

```
var x =  dict[key] ?? defaultValue; 
```

这也最终成为 linq 查询等的一部分，所以我更喜欢单线解决方案。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-31T17:02:01.147

使用扩展方法：

```
public static class MyHelper
{
    public static V GetValueOrDefault<K, V>(this IDictionary<K, V> dic, 
                                            K key, 
                                            V defaultVal = default(V))
    {
        V ret;
        bool found = dic.TryGetValue(key, out ret);
        if (found) { return ret; }
        return defaultVal;
    }
    void Example()
    {
        var dict = new Dictionary<int, string>();
        dict.GetValueOrDefault(42, "default");
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-31T16:51:24.943

您可以使用辅助方法：

```
public abstract class MyHelper {
    public static V GetValueOrDefault<K,V>( Dictionary<K,V> dic, K key ) {
        V ret;
        bool found = dic.TryGetValue( key, out ret );
        if ( found ) { return ret; }
        return default(V);
    }
}

var x = MyHelper.GetValueOrDefault( dic, key ); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-09-28T01:52:53.817

这是“终极”的解决方案，它被实现为扩展方法，使用 IDictionary 接口，提供可选的默认值，并且编写简洁。

```
public static TV GetValueOrDefault<TK, TV>(this IDictionary<TK, TV> dic, TK key,
    TV defaultVal=default(TV))
{
    TV val;
    return dic.TryGetValue(key, out val) 
        ? val 
        : defaultVal;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-24T23:05:42.087

不只是`TryGetValue(key, out value)`您正在寻找的东西吗？引用 MSDN：

```
When this method returns, contains the value associated with the specified key, if the key is found; otherwise, the default value for the type of the value parameter. This parameter is passed uninitialized. 
```

来自[http://msdn.microsoft.com/en-us/library/bb347013(v=vs.90).aspx](http://msdn.microsoft.com/en-us/library/bb347013(v=vs.90).aspx)

# asp.net - 一个gridview - 两个数据源？

> ID：254179
> 
> 赞同：0
> 
> 时间：2008-10-31T16:47:27.803
> 
> 标签：asp.net, gridview, datasource

我在一个同事网站上工作，他错误地放置了一个显示 TypeID 而不是 TypeName 的网格视图。我想输入该类型的实际名称，而不是任意 ID 号，就像他拥有它一样。我看到他在页面上有两个“ObjectDataSource”——一个用于 Type，一个用于 Item。Items 包含该项目是什么 TYPE 的 ID，它都在 Items 数据源中。他正在拉这个 ID 来填充 gridview。我想使用该 ID 从其他数据源中提取名称，并将该名称放入该特定列的网格视图中。这可以做到吗？我可以在 gridview 上使用两个不同的数据源吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-31T16:52:24.770

如果我理解这一点，那么您拥有的是两个执行此操作的数据源：

```
1) SELECT ID, Item, ItemTypeID FROM Item
2) SELECT ID, ItemType FROM ItemTypes 
```

而且您希望项目名称和项目类型显示在网格中。

如果您可以在网格上使用这两个来源，请回答您的基本问题：是的。但这不是执行操作的最有效方式，因为您需要为第一行中的每一行遍历第二个数据源。

更好的方法是将两个数据源连接在一起，并且只有一个。

将第一个数据源的 SELECT 语句修改为以下几行：

```
SELECT i.ID, i.Item, t.ItemType FROM Item i INNER JOIN ItemTypes t ON i.ItemTypeId = t.ID; 
```

# html - HTML 表单上传中的过滤器扩展

> ID：254184
> 
> 赞同：42
> 
> 时间：2008-10-31T16:49:18.363
> 
> 标签：html, webforms, file-upload

我有一个简单的 HTML 上传表单，我想指定一个默认扩展名（例如“*.drp”）。我已经读过这样做的方法是通过输入标签的 ACCEPT 属性，但我不知道具体如何。

```
<form enctype="multipart/form-data" action="uploader.php" method="POST">
Upload DRP File:
<input name="Upload Saved Replay" type="file" accept="*.drp"/><br />
<input type="submit" value="Upload File" />
</form> 
```

**编辑** 我知道可以使用 javascript 进行验证，但我希望用户只在他的弹出对话框中看到“.drp”文件。此外，我不太关心此应用程序中的服务器端验证。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2013-06-11T10:44:21.657

对于像你的“.drp”这样的特定格式。您可以直接在 accept=".drp" 中传递它，它将为此工作。

> 但没有“ * ”

```
<input name="Upload Saved Replay" type="file" accept=".drp" />
<br/>
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2011-07-22T10:21:25.007

我使用 javascript 检查文件扩展名。这是我的代码：

HTML

```
<input name="fileToUpload" type="file" onchange="check_file()" > 
```

......

javascript

```
function check_file(){
                str=document.getElementById('fileToUpload').value.toUpperCase();
        suffix=".JPG";
        suffix2=".JPEG";
        if(str.indexOf(suffix, str.length - suffix.length) == -1||
                       str.indexOf(suffix2, str.length - suffix2.length) == -1){
        alert('File type not allowed,\nAllowed file: *.jpg,*.jpeg');
            document.getElementById('fileToUpload').value='';
        }
    } 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-31T16:53:29.227

接受属性需要 MIME 类型，而不是文件掩码。例如，要接受 PNG 图像，您需要 accept="image/png"。您可能需要找出浏览器认为您的文件类型是什么 MIME 类型，并相应地使用它。但是，由于“drp”文件看起来并不标准，您**可能**必须接受通用 MIME 类型。

此外，似乎大多数浏览器可能不支持此属性。

过滤文件上传的更好方法是在服务器端。这很不方便，因为偶尔的用户可能会浪费时间上传文件，只是为了知道他们选择了错误的文件，但至少你会有某种形式的数据完整性。

或者，您可以选择在提交表单之前使用 JavaScript 进行快速检查。只需检查文件字段值的扩展名，看看它是否为“.drp”。这可能会比接受属性更受支持。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T16:56:43.527

你可以使用javascript来做到这一点。在提交函数中获取表单字段的值，解析出扩展名。

你可以从这样的事情开始：

```
<form name="someform"enctype="multipart/form-data" action="uploader.php" method="POST">
<input type=file name="file1" />
<input type=button onclick="val()" value="xxxx" />
</form>
<script>
function val() {
    alert(document.someform.file1.value)
}
</script> 
```

我同意 alexmac - 在服务器端也这样做。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-31T17:14:42.057

我不会使用这个属性，因为大多数浏览器都会忽略它，因为 CMS 指出。

一定要使用客户端验证，但只能与服务器端结合使用。任何客户端验证都可以进行。

稍微偏离主题，但有些人检查内容类型以验证上传的文件。您需要注意这一点，因为攻击者可以轻松更改它并上传例如 php 文件。请参阅以下示例：[http ://www.scanit.be/uploads/php-file-upload.pdf](http://www.scanit.be/uploads/php-file-upload.pdf)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-31T16:56:36.383

accept 属性指定表单目标将正确处理的内容类型（MIME 类型）的逗号分隔列表。不幸的是，所有主要浏览器都忽略了此属性，因此它不会以任何方式影响浏览器的文件对话框。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2013-05-31T13:16:22.877

几行的另一种解决方案

```
function checkFile(i){
  i = i.substr(i.length - 4, i.length).toLowerCase();
  i = i.replace('.','');
  switch(i){
    case 'jpg':
    case 'jpeg':
    case 'png':
    case 'gif':
      // do OK stuff
      break;
    default:
      // do error stuff
      break;
  }
} 
```

# c# - 如何获得活动屏幕尺寸？

> ID：254197
> 
> 赞同：153
> 
> 时间：2008-10-31T16:55:12.453
> 
> 标签：c#, wpf

我正在寻找的是相当于`System.Windows.SystemParameters.WorkArea`窗口当前打开的监视器。

**澄清：** 有问题的窗口是`WPF`，不是`WinForm`。

* * *

## 回答 #1

> 赞同：160
> 
> 时间：2008-10-31T17:09:33.220

`Screen.FromControl`，`Screen.FromPoint`并且`Screen.FromRectangle`应该可以帮助您。例如在 WinForms 中它将是：

```
class MyForm : Form
{
  public Rectangle GetScreen()
  {
    return Screen.FromControl(this).Bounds;
  }
} 
```

我不知道对 WPF 的等效调用。因此，您需要执行类似此扩展方法的操作。

```
static class ExtensionsForWPF
{
  public static System.Windows.Forms.Screen GetScreen(this Window window)
  {
    return System.Windows.Forms.Screen.FromHandle(new WindowInteropHelper(window).Handle);
  }
} 
```

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2009-04-13T15:44:50.460

您可以使用它来获取主屏幕的桌面工作区边界：

[`System.Windows.SystemParameters.WorkArea`](http://msdn.microsoft.com/en-us/library/system.windows.systemparameters.workarea.aspx)

这对于仅获取主屏幕的大小也很有用：

[`System.Windows.SystemParameters.PrimaryScreenWidth`](http://msdn.microsoft.com/en-us/library/system.windows.systemparameters.primaryscreenwidth.aspx) [`System.Windows.SystemParameters.PrimaryScreenHeight`](http://msdn.microsoft.com/en-us/library/system.windows.systemparameters.primaryscreenheight.aspx)

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2010-05-25T07:23:43.513

您可能还需要：

*   [SystemParameters.VirtualScreenWidth](http://msdn.microsoft.com/en-us/library/system.windows.systemparameters.virtualscreenwidth.aspx)
*   [SystemParameters.VirtualScreenHeight](http://msdn.microsoft.com/en-us/library/system.windows.systemparameters.virtualscreenheight.aspx)

获得所有显示器的组合尺寸，而不是特别的一个。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2016-04-28T16:15:56.320

添加一个不使用 WinForms 而是使用 NativeMethods 的解决方案。首先，您需要定义所需的本机方法。

```
public static class NativeMethods
{
    public const Int32 MONITOR_DEFAULTTOPRIMERTY = 0x00000001;
    public const Int32 MONITOR_DEFAULTTONEAREST = 0x00000002;

    [DllImport( "user32.dll" )]
    public static extern IntPtr MonitorFromWindow( IntPtr handle, Int32 flags );

    [DllImport( "user32.dll" )]
    public static extern Boolean GetMonitorInfo( IntPtr hMonitor, NativeMonitorInfo lpmi );

    [Serializable, StructLayout( LayoutKind.Sequential )]
    public struct NativeRectangle
    {
        public Int32 Left;
        public Int32 Top;
        public Int32 Right;
        public Int32 Bottom;

        public NativeRectangle( Int32 left, Int32 top, Int32 right, Int32 bottom )
        {
            this.Left = left;
            this.Top = top;
            this.Right = right;
            this.Bottom = bottom;
        }
    }

    [StructLayout( LayoutKind.Sequential, CharSet = CharSet.Auto )]
    public sealed class NativeMonitorInfo
    {
        public Int32 Size = Marshal.SizeOf( typeof( NativeMonitorInfo ) );
        public NativeRectangle Monitor;
        public NativeRectangle Work;
        public Int32 Flags;
    }
} 
```

然后像这样获取监视器句柄和监视器信息。

```
 var hwnd = new WindowInteropHelper( this ).EnsureHandle();
        var monitor = NativeMethods.MonitorFromWindow( hwnd, NativeMethods.MONITOR_DEFAULTTONEAREST );

        if ( monitor != IntPtr.Zero )
        {
            var monitorInfo = new NativeMonitorInfo();
            NativeMethods.GetMonitorInfo( monitor, monitorInfo );

            var left = monitorInfo.Monitor.Left;
            var top = monitorInfo.Monitor.Top;
            var width = ( monitorInfo.Monitor.Right - monitorInfo.Monitor.Left );
            var height = ( monitorInfo.Monitor.Bottom - monitorInfo.Monitor.Top );
        } 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-10-31T17:15:33.613

添加到ffpf

```
Screen.FromControl(this).Bounds 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2013-11-14T09:30:34.237

注意窗口的比例因子（100% / 125% / 150% / 200%）。您可以使用以下代码获取真实的屏幕尺寸：

```
SystemParameters.FullPrimaryScreenHeight
SystemParameters.FullPrimaryScreenWidth 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2012-09-04T14:02:52.463

我想在打开我的第一个窗口之前获得屏幕分辨率，所以这里是在实际测量屏幕尺寸之前打开一个不可见窗口的快速解决方案（您需要将窗口参数调整到您的窗口以确保两者都是 openend on同一个屏幕 - 主要`WindowStartupLocation`是重要的）

```
Window w = new Window();
w.ResizeMode = ResizeMode.NoResize;
w.WindowState = WindowState.Normal;
w.WindowStyle = WindowStyle.None;
w.Background = Brushes.Transparent;
w.Width = 0;
w.Height = 0;
w.AllowsTransparency = true;
w.IsHitTestVisible = false;
w.WindowStartupLocation = WindowStartupLocation.Manual;
w.Show();
Screen scr = Screen.FromHandle(new WindowInteropHelper(w).Handle);
w.Close(); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2013-07-10T15:00:05.370

我需要设置我的窗口应用程序的最大大小。这可以相应地更改应用程序显示在主屏幕或辅助屏幕中。为了克服这个问题，我创建了一个简单的方法，接下来我将向您展示：

```
/// <summary>
/// Set the max size of the application window taking into account the current monitor
/// </summary>
public static void SetMaxSizeWindow(ioConnect _receiver)
{
    Point absoluteScreenPos = _receiver.PointToScreen(Mouse.GetPosition(_receiver));

    if (System.Windows.SystemParameters.VirtualScreenLeft == System.Windows.SystemParameters.WorkArea.Left)
    {
        //Primary Monitor is on the Left
        if (absoluteScreenPos.X <= System.Windows.SystemParameters.PrimaryScreenWidth)
        {
            //Primary monitor
            _receiver.WindowApplication.MaxWidth = System.Windows.SystemParameters.WorkArea.Width;
            _receiver.WindowApplication.MaxHeight = System.Windows.SystemParameters.WorkArea.Height;
        }
        else
        {
            //Secondary monitor
            _receiver.WindowApplication.MaxWidth = System.Windows.SystemParameters.VirtualScreenWidth - System.Windows.SystemParameters.WorkArea.Width;
            _receiver.WindowApplication.MaxHeight = System.Windows.SystemParameters.VirtualScreenHeight;
        }
    }

    if (System.Windows.SystemParameters.VirtualScreenLeft < 0)
    {
        //Primary Monitor is on the Right
        if (absoluteScreenPos.X > 0)
        {
            //Primary monitor
            _receiver.WindowApplication.MaxWidth = System.Windows.SystemParameters.WorkArea.Width;
            _receiver.WindowApplication.MaxHeight = System.Windows.SystemParameters.WorkArea.Height;
        }
        else
        {
            //Secondary monitor
            _receiver.WindowApplication.MaxWidth = System.Windows.SystemParameters.VirtualScreenWidth - System.Windows.SystemParameters.WorkArea.Width;
            _receiver.WindowApplication.MaxHeight = System.Windows.SystemParameters.VirtualScreenHeight;
        }
    }
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-10-10T12:25:18.853

这是“中心屏幕[DotNet 4.5 解决方案](http://msdn.microsoft.com/en-us/library/system.windows.systemparameters_properties.aspx)”，使用[SystemParameters](http://msdn.microsoft.com/en-us/library/system.windows.systemparameters.aspx)而不是[System.Windows.Forms](http://msdn.microsoft.com/en-us/library/system.windows.forms.screen.aspx)或[My.Compuer.Screen](http://msdn.microsoft.com/en-us/library/hswx1e8z%28v=vs.90%29.aspx)：由于[Windows 8 更改](http://msdn.microsoft.com/en-us/library/windows/desktop/ms724385%28v=vs.85%29.aspx)了屏幕尺寸计算，它对我有用的唯一方法看起来像这样（任务栏计算包括）：

```
Private Sub Window_Loaded(ByVal sender As System.Object, ByVal e As System.Windows.RoutedEventArgs) Handles MyBase.Loaded
    Dim BarWidth As Double = SystemParameters.VirtualScreenWidth - SystemParameters.WorkArea.Width
    Dim BarHeight As Double = SystemParameters.VirtualScreenHeight - SystemParameters.WorkArea.Height
    Me.Left = (SystemParameters.VirtualScreenWidth - Me.ActualWidth - BarWidth) / 2
    Me.Top = (SystemParameters.VirtualScreenHeight - Me.ActualHeight - BarHeight) / 2         
End Sub 
```

![中心屏幕 WPF XAML](https://i.stack.imgur.com/4M784.jpg)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-07-08T10:29:55.563

在 C# winforms 中，借助以下方法，我得到了起点（例如，当我们有多个监视器/显示器并且一个表单正在调用另一个表单时）：

```
private Point get_start_point()
    {
        return
            new Point(Screen.GetBounds(parent_class_with_form.ActiveForm).X,
                      Screen.GetBounds(parent_class_with_form.ActiveForm).Y
                      );
    } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-02-16T15:39:46.920

## WinForms

对于多显示器设置，您还需要考虑 X 和 Y 位置：

```
Rectangle activeScreenDimensions = Screen.FromControl(this).Bounds;
this.Size = new Size(activeScreenDimensions.Width + activeScreenDimensions.X, activeScreenDimensions.Height + activeScreenDimensions.Y); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-07-22T06:30:25.100

此*调试*代码应该可以很好地解决问题：

您可以探索[Screen 类的属性](https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.screen?view=netcore-3.1)

*使用Screen.AllScreens*将所有显示器放在一个数组或列表中，然后捕获当前显示器的索引及其属性。

[![在此处输入图像描述](https://i.stack.imgur.com/iaKAg.png)](https://i.stack.imgur.com/iaKAg.png)

**C#** *（由 Telerik 从 VB 转换而来 - 请仔细检查）*

```
 {
    List<Screen> arrAvailableDisplays = new List<Screen>();
    List<string> arrDisplayNames = new List<string>();

    foreach (Screen Display in Screen.AllScreens)
    {
        arrAvailableDisplays.Add(Display);
        arrDisplayNames.Add(Display.DeviceName);
    }

    Screen scrCurrentDisplayInfo = Screen.FromControl(this);
    string strDeviceName = Screen.FromControl(this).DeviceName;
    int idxDevice = arrDisplayNames.IndexOf(strDeviceName);

    MessageBox.Show(this, "Number of Displays Found: " + arrAvailableDisplays.Count.ToString() + Constants.vbCrLf + "ID: " + idxDevice.ToString() + Constants.vbCrLf + "Device Name: " + scrCurrentDisplayInfo.DeviceName.ToString + Constants.vbCrLf + "Primary: " + scrCurrentDisplayInfo.Primary.ToString + Constants.vbCrLf + "Bounds: " + scrCurrentDisplayInfo.Bounds.ToString + Constants.vbCrLf + "Working Area: " + scrCurrentDisplayInfo.WorkingArea.ToString + Constants.vbCrLf + "Bits per Pixel: " + scrCurrentDisplayInfo.BitsPerPixel.ToString + Constants.vbCrLf + "Width: " + scrCurrentDisplayInfo.Bounds.Width.ToString + Constants.vbCrLf + "Height: " + scrCurrentDisplayInfo.Bounds.Height.ToString + Constants.vbCrLf + "Work Area Width: " + scrCurrentDisplayInfo.WorkingArea.Width.ToString + Constants.vbCrLf + "Work Area Height: " + scrCurrentDisplayInfo.WorkingArea.Height.ToString, "Current Info for Display '" + scrCurrentDisplayInfo.DeviceName.ToString + "' - ID: " + idxDevice.ToString(), MessageBoxButtons.OK, MessageBoxIcon.Information);
} 
```

**VB** *（原代码）*

```
 Dim arrAvailableDisplays As New List(Of Screen)()
    Dim arrDisplayNames As New List(Of String)()

    For Each Display As Screen In Screen.AllScreens
        arrAvailableDisplays.Add(Display)
        arrDisplayNames.Add(Display.DeviceName)
    Next

    Dim scrCurrentDisplayInfo As Screen = Screen.FromControl(Me)
    Dim strDeviceName As String = Screen.FromControl(Me).DeviceName
    Dim idxDevice As Integer = arrDisplayNames.IndexOf(strDeviceName)

    MessageBox.Show(Me,
                    "Number of Displays Found: " + arrAvailableDisplays.Count.ToString & vbCrLf &
                    "ID: " & idxDevice.ToString + vbCrLf &
                    "Device Name: " & scrCurrentDisplayInfo.DeviceName.ToString + vbCrLf &
                    "Primary: " & scrCurrentDisplayInfo.Primary.ToString + vbCrLf &
                    "Bounds: " & scrCurrentDisplayInfo.Bounds.ToString + vbCrLf &
                    "Working Area: " & scrCurrentDisplayInfo.WorkingArea.ToString + vbCrLf &
                    "Bits per Pixel: " & scrCurrentDisplayInfo.BitsPerPixel.ToString + vbCrLf &
                    "Width: " & scrCurrentDisplayInfo.Bounds.Width.ToString + vbCrLf &
                    "Height: " & scrCurrentDisplayInfo.Bounds.Height.ToString + vbCrLf &
                    "Work Area Width: " & scrCurrentDisplayInfo.WorkingArea.Width.ToString + vbCrLf &
                    "Work Area Height: " & scrCurrentDisplayInfo.WorkingArea.Height.ToString,
                    "Current Info for Display '" & scrCurrentDisplayInfo.DeviceName.ToString & "' - ID: " & idxDevice.ToString, MessageBoxButtons.OK, MessageBoxIcon.Information) 
```

[![屏幕列表](https://i.stack.imgur.com/HaDAa.png)](https://i.stack.imgur.com/HaDAa.png)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2022-02-23T06:03:29.090

我知道这是一个老问题，但其他人可能会从中获得一些价值

```
int formWidth = form.Width;
int formHeight = form.Height;
int formTop = form.Top;
int formLeft = form.Left;

Screen screen = Screen.PrimaryScreen;
Rectangle rect = screen.Bounds;
int screenWidth = rect.Width;
int screenHeight = rect.Height;
int screenTop = rect.Top;
int screenLeft = rect.Left; 
```

# javascript - 在 jQuery 回调中访问父属性

> ID：254200
> 
> 赞同：2
> 
> 时间：2008-10-31T16:55:45.993
> 
> 标签：javascript, jquery

不确定我的措辞是否正确，但在回调中如何引用基类的控件属性？

这一直困扰着我一段时间，我通常会解决它，但如果有人能启发我如何正确地做到这一点，我将不胜感激。

```
var base = function() {
    var controls = {};

    return {
        init: function(c) {
            this.controls = c
        },
        foo: function(args) {
            this.init(args.controls);
            $(this.controls.DropDown).change(function() {
                $(this.controls.PlaceHolder).toggle();
            });
        }
    }
}; 
```

非常感谢，

保罗

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T17:07:43.147

使用闭包的力量：

```
var base = function() {
    var controls = {};

    return {
        init: function(c) {
                this.controls = c
        },
        foo: function(args) {
                var self = this;

                this.init(args.controls);
                $(this.controls.DropDown).change(function() {
                        $(self.controls.PlaceHolder).toggle();
                });
        }
    }
}; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T19:11:15.020

尽管[首选](https://stackoverflow.com/questions/254200/access-parent-property-in-jquery-callback#254237)[闭包](https://stackoverflow.com/questions/254200/access-parent-property-in-jquery-callback#254233)，但您也可以使用 jquery传递对象：`bind`

```
var base = function() {
    var controls = {};

    return {
        init: function(c) {
            this.controls = c
        },
        foo: function(args) {
            this.init(args.controls);
            $(this.controls.DropDown).bind('change', {controls: this.controls}, function(event) {
                $(event.data.controls.PlaceHolder).toggle();
            });
        }
    }
}; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T17:06:39.187

您需要在这里利用闭包。

```
var base = function() {
var controls = {};

return {
    init: function(c) {
            this.controls = c
    },
    foo: function(args) {
            this.init(args.controls);
            $(this.controls.DropDown).change(function(controls) {
                    return function(){
                        $(controls.PlaceHolder).toggle();
                    }
            }(this.controls));
    }
} 
```

};

# asp.net - 在 ASP.NET 中动态生成 Excel 文档时出现“许可证已过期”错误

> ID：254207
> 
> 赞同：6
> 
> 时间：2008-10-31T16:57:32.403
> 
> 标签：asp.net, excel, comexception

任何熟悉以下错误的人？当我运行我的 webapp 以从本地计算机生成动态 excel 文档时，它工作正常，但是当在服务器上调用同一段代码时，我收到以下错误。似乎这是一个权限问题，因为它适用于我的机器但不适用于服务器，但我不知道从哪里开始以查明问题。非常感谢任何指导/帮助！

```
Server Error in '/' Application.
--------------------------------------------------------------------------------

This command is unavailable because the license to use this application has expired. 
Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. 

Exception Details: System.Runtime.InteropServices.COMException: This command is unavailable because the license to use this application has expired.

Source Error: 

An unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.  

Stack Trace: 

[COMException (0x800a03ec): This command is unavailable because the license to use this application has expired.]
   Microsoft.Office.Interop.Excel.Workbooks.Add(Object Template) +0
   PaymentsReport.Page_Load(Object sender, EventArgs e) +70
   System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e) +15
   System.Web.Util.CalliEventHandlerDelegateProxy.Callback(Object sender, EventArgs e) +34
   System.Web.UI.Control.OnLoad(EventArgs e) +99
   System.Web.UI.Control.LoadRecursive() +47
   System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +1061 
```

* * *

Office/Excel 安装在服务器上，我可以在服务器上打开/保存 Excel 文档。它可能是服务器上的 excel 版本与我的本地机器上的版本吗？如果是这样，我如何确保我在服务器上拥有最新的？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-09-29T12:19:34.177

除了安装之外，您还需要确保在服务器上激活了该应用程序：

[http://support.microsoft.com/kb/294973](http://support.microsoft.com/kb/294973)

有如何做到这一点的详细信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T17:01:18.213

使用 Office 互操作要求您使用的 Office 组件实际安装在服务器上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T17:09:02.287

我要拿一个 WAG 说你不能在服务器上放任何旧的 Office 副本并让多个用户通过你的网站访问它。您需要查看在服务器环境中使用 MS Office 的许可限制。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T17:06:33.773

您在服务器上是否有 Excel 的许可激活副本？它可能适用于您的本地计算机，因为您在本地安装了 Office/Excel。

# java - 在 TableModel 更改中保留 JTable 选择

> ID：254212
> 
> 赞同：15
> 
> 时间：2008-10-31T16:59:03.617
> 
> 标签：java, swing, jtable, tablemodel

当我们执行 a或from时，我们看到`JTable`选择被清除。`fireTableDataChanged()``fireTableRowsUpdated()``TableModel`

这是预期的，还是我们做错了什么？我没有在`JTable`（或其他相关类）上看到任何关于清除/保留模型更新选择的属性。

如果这是默认行为，是否有防止这种情况的好方法？也许某种方式可以在更新之前“锁定”选择并在之后解锁？

开发人员一直在尝试在更新之前保存选择并重新应用它。这有点慢。

这是 Windows XP 上的 Java 1.4.2，如果这很重要的话。根据我们使用的一些供应商代码，我们仅限于该版本。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-01T19:53:21.063

您需要保留选择，然后重新应用它。

首先，您需要获取所有选定单元格的列表。

然后，当您使用新数据重新加载 JTable 时，您需要以编程方式重新应用这些相同的选择。

我要说的另一点是，如果每次重新加载表模型后表中的行数或列数都在增加或减少，那么请不要费心保留选择。

在模型更新之前，用户可以选择具有“鸭子”值的第 2 行第 1 列。但是在模型更新之后，相同的数据现在可以出现在第 4 行第 1 列中，并且您的原始单元格第 2 行第 1 列可能有新数据，例如“Pig”。现在，如果您强制将选择设置为模型更新之前的状态，这可能不是用户想要的。

因此，以编程方式选择单元格可能是一把双刃剑。如果您不确定，请不要这样做。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-03-20T12:21:59.463

如果该表的 STRUCTURE 未更改（即，如果您未添加/删除任何列/行），您可以自动保留该表的选择，如下所示。

如果您已经编写了自己的 TableModel 实现，则可以简单地覆盖 fireTableDataChanged() 方法：

```
@Override
public void fireTableDataChanged() {
    fireTableChanged(new TableModelEvent(this, //tableModel
        0, //firstRow
        getRowCount() - 1, //lastRow 
        TableModelEvent.ALL_COLUMNS, //column 
        TableModelEvent.UPDATE)); //changeType
} 
```

这应该确保您的选择得到维护，前提是只有数据而不是表的结构发生了变化。这之间的唯一区别，如果这个方法没有被覆盖，将调用什么是 getRowCount() - 1 被传递给 lastRow 参数而不是 Integer.MAX_VALUE，后者充当一个不仅具有所有表中的数据发生了变化，但行数也可能发生了变化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-02T12:26:04.913

这是默认行为。如果您调用`fireTableDataChanged()`整个表是从头开始重建，因为您设置了全新的模型。在这种情况下，选择自然会丢失。如果您调用`fireTableRowsUpdated()`选择也清除在一般情况下。唯一的方法是记住选择然后设置它。不幸的是，不能保证选择仍然有效。恢复选择时要小心。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-07T08:26:59.870

我在应用程序中遇到了同样的问题。在我的例子中，表中的模型是一个对象列表，其中对象属性映射到列。在这种情况下，当列表被修改时，我检索了选定的索引并存储了在更新列表之前选择的对象。修改列表后，更新表格之前，我会计算所选对象的位置。如果修改后它仍然存在，那么我会将选择设置为新索引。

修改后只在表格中设置选定的索引是行不通的，因为对象可能会改变列表中的位置。

附带说明一下，我发现使用 GlazedLists 可以让处理表格时的生活变得更加轻松。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-08-25T10:58:38.723

作为参考，正如@Swapnonil Mukherjee 所说，这对带有可选行的表格起到了作用：

```
// preserve selection calling fireTableDataChanged()
final int[] sel = table.getSelectedRows();

fireTableDataChanged();

for (int i=0; i<sel.length; i++)
    table.getSelectionModel().addSelectionInterval(sel[i], sel[i]); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-31T17:10:56.713

如果我没记错的话，保存选择并重新应用它也是我们所做的......

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2013-08-09T08:55:15.693

我遇到了同样的问题，当我试图搜索我得到这个问题的原因时，但这似乎是 Java SDK 中的一个错误。[http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4276786](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4276786)

解决方法

可以使用临时解决方法。一旦这个错误被修复，它应该被删除，因为它的适用性尚未针对固定版本进行测试。

使用 JTable 的这个子类。

注意：这是针对 MetalLookAndFeel 的。如果使用其他外观，内部的 FixedTableUI 子类将不得不为该外观扩展 TableUI 子类。

```
import java.awt.*;
import java.awt.event.*;
import javax.swing.*;
import javax.swing.table.*;
import javax.swing.event.*;
import javax.swing.plaf.basic.*;

public class FixedTable extends JTable {

  private boolean isControlDownInDrag;

  public FixedTable(TableModel model) {
      super(model);
      setUI(new FixedTableUI());
  }

  private class FixedTableUI extends BasicTableUI {
      private MouseInputHandler handler = new MouseInputHandler() {
          public void mouseDragged(MouseEvent e) {
              if (e.isControlDown()) {
                  isControlDownInDrag = true;
              }
              super.mouseDragged(e);
          }

          public void mousePressed(MouseEvent e) {
              isControlDownInDrag = false;
              super.mousePressed(e);
          }

          public void mouseReleased(MouseEvent e) {
              isControlDownInDrag = false;
              super.mouseReleased(e);
          }
      };

      protected MouseInputListener createMouseInputListener() {
          return handler;
      }
  }

  public void changeSelection(int rowIndex, int columnIndex, boolean toggle, boolean extend) {
      if (isControlDownInDrag) {
          ListSelectionModel rsm = getSelectionModel();
          ListSelectionModel csm = getColumnModel().getSelectionModel();

          int anchorRow = rsm.getAnchorSelectionIndex();
          int anchorCol = csm.getAnchorSelectionIndex();

          boolean anchorSelected = isCellSelected(anchorRow, anchorCol);

          if (anchorSelected) {
              rsm.addSelectionInterval(anchorRow, rowIndex);
              csm.addSelectionInterval(anchorCol, columnIndex);
          } else {
              rsm.removeSelectionInterval(anchorRow, rowIndex);
              csm.removeSelectionInterval(anchorCol, columnIndex);
          }

          if (getAutoscrolls()) {
              Rectangle cellRect = getCellRect(rowIndex, columnIndex, false);
              if (cellRect != null) {
                  scrollRectToVisible(cellRect);
              }
          }
      } else {
          super.changeSelection(rowIndex, columnIndex, toggle, extend);
      }
  }
} 
```

**请注意**Curtsey 到[http://bugs.sun.com](http://bugs.sun.com)

# java - 如何确定给定 JDBC 连接的数据库类型？

> ID：254213
> 
> 赞同：34
> 
> 时间：2008-10-31T16:59:05.003
> 
> 标签：java, oracle, jdbc

我需要处理返回三个数据库（Oracle、sybase、MS-Server）的存储过程/函数的结果集。过程/功能通常是相同的，但在 Oracle 中的调用略有不同。

```
statement.registerOutParameter(1, oracle.jdbc.OracleTypes.CURSOR);
...
statement.execute(); 
ResultSet rs = (ResultSet)statement.getObject(1); 
```

JDBC 没有提供通用的方法来处理这个问题，所以我需要在我的代码中区分不同类型的 DB。我得到了连接，但不知道确定数据库是否是 oracle 的最佳方法。我可以使用驱动程序名称，但宁愿找到一种更简洁的方法。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-10-31T17:01:47.510

我怀疑你会想要使用 DatabaseMetaData 类。很可能[DatabaseMetaData.getDatabaseProductName](http://docs.oracle.com/javase/8/docs/api/java/sql/DatabaseMetaData.html#getDatabaseProductName--)就足够了，但如果您的代码依赖于您正在使用的特定数据库的特定版本，您可能还想使用 getDatabaseProductVersion 方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-01-30T13:42:41.567

You can use org.apache.ddlutils, class [Platformutils](http://db.apache.org/ddlutils/api/org/apache/ddlutils/PlatformUtils.html):

```
databaseName = new PlatformUtils().determineDatabaseType(dataSource) 
```

# svn - SVN 存储库搜索

> ID：254214
> 
> 赞同：157
> 
> 时间：2008-10-31T17:00:22.663
> 
> 标签：svn, search, code-search-engine

有没有什么好的软件可以让我在我的 SVN 存储库中搜索代码片段？我找到了“FishEye”，但成本是 1,200，远远超出了我的预算。

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2010-06-17T18:24:46.480

如果您只搜索文件名，请使用：

```
svn list -R file:///subversion/repository | grep filename 
```

视窗：

```
svn list -R file:///subversion/repository | findstr filename 
```

否则结帐并进行文件系统搜索：

```
egrep -r _code_ . 
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-08-17T09:54:13.337

有[sourceforge.net/projects/svn-search](http://sourceforge.net/projects/svn-search/)。

还有一个直接来自 SVN 主页的 Windows 应用程序，名为 SvnQuery，可在[http://svnquery.tigris.org获得](http://svnquery.tigris.org/)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2013-12-05T10:15:17.300

## 2020 年 1 月更新

VisualSVN Server 4.2 支持在 Web 界面中查找文件和文件夹。[在演示服务器的存储库](https://demo-server.visualsvn.com/!/#)之一上试用新功能！

请参阅[版本 4.2 发行说明](https://www.visualsvn.com/server/changes/4.2/)，并从[主下载页面](https://www.visualsvn.com/server/download/)下载 VisualSVN Server 4.2.0 。

[![在此处输入图像描述](https://i.stack.imgur.com/F5uRw.gif)](https://i.stack.imgur.com/F5uRw.gif)

* * *

**旧答案**

从[Subversion 1.8 开始，您可以将`--search`option 与`svn log`command](http://svnbook.red-bean.com/en/1.8/svn.ref.svn.c.log.html)一起使用。请注意，该命令不会在存储库中执行全文搜索，它仅考虑以下数据：

*   修订的作者（`svn:author`未版本化的属性），
*   日期（`svn:date`未版本化的属性），
*   记录消息文本（`svn:log`未版本化的属性），
*   更改的路径列表（即受特定修订影响的路径）。

以下是有关这些新搜索选项的帮助页面：

```
 If the --search option is used, log messages are displayed only if the
 provided search pattern matches any of the author, date, log message
 text (unless --quiet is used), or, if the --verbose option is also
 provided, a changed path.
 The search pattern may include "glob syntax" wildcards:
     ?      matches any single character
     *      matches a sequence of arbitrary characters
     [abc]  matches any of the characters listed inside the brackets
 If multiple --search options are provided, a log message is shown if
 it matches any of the provided search patterns. If the --search-and
 option is used, that option's argument is combined with the pattern
 from the previous --search or --search-and option, and a log message
 is shown only if it matches the combined search pattern.
 If --limit is used in combination with --search, --limit restricts the
 number of log messages searched, rather than restricting the output
 to a particular number of matching log messages. 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-31T19:00:10.423

我们使用[http://opensolaris.org/os/project/opengrok/](http://opensolaris.org/os/project/opengrok/)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2013-10-10T13:31:18.913

此示例将存储库的完整内容通过管道传输到文件，然后您可以在编辑器中快速搜索文件名：

```
svn list -R svn://svn > filelist.txt 
```

如果存储库是相对静态的，并且您希望进行快速搜索而不必从 SVN 服务器重复加载所有内容，这将非常有用。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2010-06-17T18:49:19.440

1.  创建`git-svn`该存储库的镜像。
2.  在 git: 中搜索添加或删除的字符串，`git log -S'my line of code'`或者在`gitk`

优点是您可以在本地进行许多搜索，而无需加载服务器和网络连接。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-31T18:44:29.643

我确实喜欢 TRAC - 这个插件可能对你的任务有帮助：http: [//trac-hacks.org/wiki/RepoSearchPlugin](http://trac-hacks.org/wiki/RepoSearchPlugin)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-07-08T13:09:22.127

请注意，[**FishEye**](https://www.atlassian.com/software/fisheye/overview)（和许多其他 Atlassian 产品）有一个 10 美元的 Starter Edition，就 FishEye 而言，它为您提供 5 个存储库和最多 10 个提交者的访问权限。在这种情况下，这笔钱将用于慈善事业。

> [www.atlassian.com/starter](http://www.atlassian.com/starter/)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-31T20:13:06.220

非常缓慢（并且粗略地实现），但是如果您正在搜索单个文件或小型存储库的历史记录，则 svn log 和 svn cat 的组合可以工作：

```
svn log filetosearch |
    grep '^r' |
    cut -f1 -d' ' |
    xargs -i bash -c "echo '{}'; svn cat filetosearch -'{}'" 
```

将输出文件更改的每个修订号和文件。您总是可以将每个修订版分类到不同的文件中，然后 grep 进行更改。

PS。向任何向我展示如何正确执行此操作的人进行大量投票！

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-31T19:16:49.190

如果您真的很绝望，请转储 repo（查看“svnadmin dump”），然后用 grep 遍历它。它不漂亮，但您可以查看搜索结果以找到指示文件和修订的元数据，然后检查它以获得更好的外观。

可以肯定，这不是一个好的解决方案，但它是免费的 :) SVN 不提供搜索过去签到（甚至过去的日志文件，AFAIK）的功能。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-31T17:31:10.180

许多 SVN 存储库是“简单的”HTTP 站点，因此您可以考虑查看一些现成的“网络爬虫”搜索应用程序，您可以将其指向 SVN 根目录，它会为您提供基本功能。更新它可能会有点技巧，也许黑客中的一些 SVN 检查可以让索引在你去的时候丢弃或重新索引更改。

只是大声思考。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-31T17:43:33.823

有 krugle 和 koders 但两者都很贵。两者都有 Eclipse 的 ide 插件。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-10-29T13:53:41.537

我开始使用这个工具

[http://www.supose.org/wiki/supose](http://www.supose.org/wiki/supose)

它工作得很好，只是缺少一个可视化的 UI，但是速度很快并且有点维护

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-06-28T16:58:55.930

// 编辑：工具已经在另一个答案中提到，所以把所有的功劳都归功于 Kuryaki。

刚刚发现[SupoSE](http://www.supose.org/wiki/supose)，它是一个基于 java 的命令行工具，它扫描存储库以创建索引，然后能够回答某些类型的查询。我们仍在评估该工具，但它看起来很有希望。值得一提的是，它对包括源代码文件和常用办公格式在内的所有修订进行了完整索引。

# mysql - 加入两个表而不返回不需要的行

> ID：254216
> 
> 赞同：2
> 
> 时间：2008-10-31T17:00:52.927
> 
> 标签：mysql, join

我的表结构如下所示：

```
 tbl.users                       tbl.issues
+--------+-----------+   +---------+------------+-----------+
| userid | real_name |   | issueid | assignedid | creatorid |
+--------+-----------+   +---------+------------+-----------+
|   1    |   test_1  |   |    1    |     1      |     1     |
|   2    |   test_2  |   |    2    |     1      |     2     |
+--------+-----------+   +---------+------------+-----------+ 
```

基本上我想编写一个查询，该查询将以如下所示的结果表结尾：

```
 (results table)
+---------+------------+---------------+-----------+--------------+
| issueid | assignedid | assigned_name | creatorid | creator_name |
+---------+------------+---------------+-----------+--------------+
|    1    |     1      |    test_1     |    1      |    test_1    |
|    2    |     1      |    test_1     |    2      |    test_2    |
+---------+------------+---------------+-----------+--------------+ 
```

我的 SQL 现在看起来像这样：

```
SELECT 
  `issues`.`issueid`,
  `issues`.`creatorid`,
  `issues`.`assignedid`,
  `users`.`real_name`
FROM `issues`
JOIN `users` 
  ON ( `users`.`userid` = `issues`.`creatorid` )
  OR (`users`.`userid` = `issues`.`assignedid`)
ORDER BY `issueid` ASC
LIMIT 0 , 30 
```

这将返回如下内容：

```
 (results table)
+---------+------------+-----------+-----------+
| issueid | assignedid | creatorid | real_name |
+---------+------------+-----------+-----------+
|    1    |     1      |     1     |   test_1  |
|    2    |     1      |     2     |   test_1  |
|    2    |     1      |     2     |   test_2  |
+---------+------------+-----------+-----------+ 
```

谁能帮我找到想要的结果表？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-31T17:07:04.973

```
SELECT 
  IssueID, 
  AssignedID, 
  CreatorID, 
  AssignedUser.real_name AS AssignedName, 
  CreatorUser.real_name AS CreatorName
FROM Issues
  LEFT JOIN Users AS AssignedUser
         ON Issues.AssignedID = AssignedUser.UserID
  LEFT JOIN Users AS CreatorUser
         ON Issues.CreatorID = CreatorUser.UserID
ORDER BY `issueid` ASC
LIMIT 0, 30 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-31T17:29:21.557

在一般知识方面，我们杰出的网站创始人写了一篇关于这个主题的非常好的博客文章，我发现自己一遍又一遍地提到它。

## [SQL 连接的可视化解释](https://blog.codinghorror.com/a-visual-explanation-of-sql-joins/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T17:07:05.753

用这个：

```
SELECT 
`issues`.`issueid`,
`issues`.`creatorid`,
`creator`.`real_name`,
`issues`.`assignedid`,
`assigned`.`real_name`
FROM `issues` i
INNER JOIN `users` creator ON ( `creator`.`userid` = `issues`.`creatorid` )
INNER JOIN `users` assigned ON (`assigned`.`userid` = `issues`.`assignedid`)
ORDER BY `issueid` ASC
LIMIT 0 , 30 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T17:06:38.907

```
SELECT DISTINCT (i.issueid, i.creatorid, i.assignedid, u.real_name)
FROM issues i, users u
WHERE u.userid = i.creatorid OR u.userid = assignedid
ORDER BY i.issueid ASC
LIMIT 0 , 30 
```

不确定是否需要括号。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-31T17:10:27.977

这行得通吗？

SELECT i.issueid, i.assignedid, u1.real_name as assigned_name, i.creatorid, u2.real_name as creator_name FROM users u1 INNER JOIN issues i ON u1.userid = i.assignedid INNER JOIN users u2 ON u2.userid = i.创建者 ID ORDER BY i.issueid

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-31T17:26:31.253

SELECT
i.issueid,
i.assignedid,
a.real_name,
i.creatorid,
c.real_name
FROM
issues i
INNER JOIN users c
ON c.userid = i.creatorid
INNER JOIN users a
ON a.userid = i.assignedid
ORDER BY
i .issueid ASC

# c++ - 跨平台双向 IPC

> ID：254229
> 
> 赞同：3
> 
> 时间：2008-10-31T17:03:17.367
> 
> 标签：c++, c, winapi, ipc, pipe

我有一个我认为会相对容易的项目，但结果却是我所希望的更多痛苦。首先，我与之交互的大部分代码都是我无法控制的遗留代码，因此我无法进行大的范式更改。

这是我需要做的简单解释：假设我有大量从标准输入读取并写入标准输出的简单程序。（这些我不能碰）。基本上，标准输入的输入是“将温度设置为 100”之类的命令或类似的命令。并且输出是事件“温度已设置为 100”或“温度已降至设定值以下”。

我想做的是编写一个应用程序，它可以启动一堆这些简单的程序，监视事件，然后根据需要向它们发送命令。我最初的计划是使用类似 popen 的东西，但我需要一个双向的 popen 来获得读写管道。我一起破解了一些我称之为popen2的东西，在那里我将运行命令和两个填充了读写流的FILE *传递给它。然后我需要做的就是编写一个简单的循环，从每个进程的每个标准输出中读取，执行它需要的逻辑，然后将命令写回正确的进程。

这是一些伪代码

```
FILE *p1read, *p1write;
FILE *p2read, *p2write;
FILE *p3read, *p3write;

//start each command, attach to stdin and stdout
popen2("process1",&p1read,&p1write);
popen2("process2",&p2read,&p2write);
popen2("process3",&p3read,&p3write);

while (1)
{
   //read status from each process
   char status1[1024];
   char status2[1024];
   char status3[1024];
   fread(status1,1024,p1read);
   fread(status2,1024,p2read);
   fread(status3,1024,p3read);

   char command1[1024];
   char command2[1024];
   char command3[1024];
   //do some logic here

   //write command back to each process
   fwrite(command1,p1write);
   fwrite(command2,p2write);
   fwrite(command3,p3write);
} 
```

真正的程序更复杂，它在流中查看是否有任何东西在等待，如果没有，它将跳过该进程，同样，如果它不需要向某个进程发送命令，它不需要。但是这段代码给出了基本的想法。

现在这在我的 UNIX 机器上工作得很好，甚至在带有 cygwin 的 Windows XP 机器上也很好。但是，现在我需要让它在本地运行在 Win32 上。

困难的部分是我的 popen2 使用 fork() 和 execl() 来启动进程并将流分配给子进程的标准输入和标准输出。有没有一种干净的方法可以在 Windows 中做到这一点？基本上，我想创建一个popen2，它在windows 中的工作方式与我的unix 版本相同。这样，唯一的 Windows 特定代码将在该函数中，我可以摆脱其他一切以相同方式工作的情况。

有任何想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-31T17:52:15.053

在 Windows 上，首先调用 CreatePipe（类似于 pipe(2)），然后是 CreateProcess。这里的技巧是 CreateProcess 有一个参数，您可以在其中传递新创建进程的标准输入、标准输出和标准错误。

请注意，当您使用 stdio 时，您需要在之后执行 fdopen 来创建文件对象，该对象需要文件编号。在 Microsoft CRT 中，文件编号与 OS 文件句柄不同。因此，要将 CreatePipe 的另一端返回给调用者，首先需要 _open_osfhandle 来获取 CRT 文件编号，然后对其进行 fdopen。

如果您想查看工作代码，请查看 _PyPopen

[http://svn.python.org/view/python/trunk/Modules/posixmodule.c?view=markup](http://svn.python.org/view/python/trunk/Modules/posixmodule.c?view=markup)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T17:22:56.440

我认为您已经通过使用 popen2() 函数来抽象出跨平台问题，从而为您的问题开了一个很好的开端。我期待来建议“套接字”，但我确信在阅读了这个问题后这并不相关。您可以使用套接字而不是管道 - 它会隐藏在 popen2() 函数中。

我 99% 确信您可以使用 Windows API 在 Windows 上实现所需的功能。我不能做的是可靠地为您指出正确的功能。但是，您应该知道 Microsoft 提供了大多数类似 POSIX 的 API 调用，但名称以“_”为前缀。还有实现 和 效果的本机 API`fork`调用`exec`。

您的评论表明您意识到数据可用性和可能的​​死锁问题 - 请谨慎。

# asp.net - Global.asax 被同一个 IP 调用几十次/秒

> ID：254236
> 
> 赞同：1
> 
> 时间：2008-10-31T17:07:15.253
> 
> 标签：asp.net, iis

我注意到在我的自定义应用程序日志中，我在几分钟内收到了 600 个对 Global.asax 的请求，而没有其他用户在使用该应用程序。它们都来自已知应用程序用户的 IP 地址，所以我认为这不是任何形式的攻击。我在每个公共子或函数入口处的自定义 SQL Server 数据库中生成日志整体，因此我可以看到请求来自何处。

我想知道是否有人以前见过类似的东西，或者知道为什么 IE 或 IIS/ASP.NET 可能会出现这种行为。我在任何事件日志中都没有看到任何相应的条目，更奇怪的是，我什至在 IIS 日志本身中都没有看到来自该用户的单个请求。有什么想法吗？

注意：这仅在几天前发生过一次，并且在它开始后几分钟就发生了。它发生在该用户（英格兰）的工作时间，但对我们来说是下班后，因此他很可能是当时应用程序中的唯一用户。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-01T02:22:15.600

我已经看到表单身份验证会发生这种情况，如果被拒绝的用户无权访问登录失败页面，这将触发另一个重定向到登录失败页面等。MSIE 将永远执行重定向，Firefox 将产生一个“此重定向永远不会完成”错误。唯一会执行的代码是 global.asax 中的 OnAuthenticate 事件

由于这是表单身份验证的常见配置错误，我不会感到惊讶。

# sql - 帮助 SQL 查询（加入视图？）

> ID：254238
> 
> 赞同：0
> 
> 时间：2008-10-31T17:08:55.187
> 
> 标签：sql

我有一个有列的表

> 索引、日期

其中一个索引可能有多个日期，我的目标如下：选择一个看起来像的列表

> 索引、最小日期、最大日期

其中每个索引仅列出一次，MinDate (MaxDate) 表示该*索引的整个表中*存在的最早（最新）日期。这很容易，但是让我们限制这个列表只出现在给定日期范围内的索引。

到目前为止，我有以下内容：

```
SELECT 
    Index,
    MIN([Date]),
    MAX([Date])
FROM myTable
WHERE
    Index IN
    (SELECT Index From myTable WHERE [Date] BETWEEN '1/1/2000' AND '12/31/2000')
GROUP BY Index
ORDER BY Index ASC 
```

这是极其缓慢的。有什么办法可以加快这个速度吗？[我正在运行 SQL Server 2000。]

谢谢！

编辑：为了清楚起见。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-31T17:25:30.800

我会推荐一种派生表方法。像这样：

```
SELECT 
     myTable.Index,
     MIN(myTable.[Date]),
     MAX(myTable.[Date])
FROM myTable
     Inner Join (
       SELECT Index 
       From myTable 
       WHERE [Date] BETWEEN '1/1/2000' AND '12/31/2000') As AliasName
       On myTable.Index = AliasName.Index
GROUP BY myTable.Index
ORDER BY myTable.Index ASC 
```

编辑：经过进一步审查，您可以通过另一种方式创建此查询。以下查询可能更快、更慢或在相同的时间内执行。当然，这取决于表的索引方式。

```
Select [Index],
       Min([Date]),
       Max([Date])
From   myTable
Group By [Index]
Having Sum(Case When [Date] Between '1/1/2000' And '12/31/2000' Then 1 Else 0 End) > 0 
```

在最好的情况下，此查询将导致索引扫描（而不是搜索）过滤掉您不想显示的行。我鼓励您同时运行这两个查询并选择执行速度最快的这个。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T17:23:35.813

我不是 SQL Server 专家，但如果您可以像这样进行子选择，这可能会更快。

```
SELECT Index,
  (SELECT MIN([Date] FROM myTable WHERE Index = m.Index),
  (SELECT MAX([Date] FROM myTable WHERE Index = m.Index)
From myTable m 
WHERE [Date] BETWEEN '1/1/2000' AND '12/31/2000' 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T17:34:41.750

杰克，

我认为你可能需要在这个问题上采取不同的 POV。

`**Index, Min(Date), Max(Date)**`与其涵盖的数据范围（可能是多年）相比，所选的分组不会在一天内发生巨大变化

所以一种选择是根据主表中的数据创建一个汇总表......例如

```
 SELECT 
       Index, 
       Min(Date) as MinDate, 
       Max(Date) as MaxDate
   INTO 
      MySummaryTable
   FROM 
      MyOriginalTable
   GROUP BY
      Index 
```

可以通过 sql 作业在半定期（每天）的基础上删除和重新创建此表。同样，我会在它的 id 列上粘贴一个索引。

然后当你需要运行你的日常查询时，

```
SELECT 
   summary.Index,
   summary.MinDate,
   summary.MaxDate
FROM
   MyOriginalTable mot
   INNER JOIN MySummaryTable summary
      ON mot.Index = summary.Index  --THIS IS WHERE YOUR CLUSTERED INDEX WILL PAY OFF
WHERE
   mot.Date BETWEEN '2000-01-01' AND '2000-12-31' --THIS IS WHERE A SECOND NC INDEX WILL PAY OFF 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T19:09:44.320

这应该在两个表扫描中完成。

```
SELECT
     Index,
    MIN([Date]),
    MAX([Date])
FROM myTable
WHERE
    Index IN
    (SELECT Index From myTable WHERE [Date] BETWEEN '1/1/2000' AND '12/31/2000')
GROUP BY Index
ORDER BY Index ASC
OPTION (MERGE JOIN) 
```

* * *

这是另一个查询。此查询得到**的结果**与最初要求的不同。这将获得日期范围与感兴趣期间重叠的所有索引（即使该索引的感兴趣期间没有任何实际活动）。

```
SELECT
    Index,
    MIN([Date]),
    MAX([Date])
FROM myTable
GROUP BY Index
HAVING MIN([Date]) < '2001-01-01' AND MAX([Date]) >= '2000-01-01')
ORDER BY Index ASC 
```

所以这将返回，即使 3 在 2000 年没有数据。

3、1998-01-01、2005-01-01

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-31T17:14:47.233

将聚集索引放在日期列上会大大加快这个查询的速度，但显然它可能会减慢表上其他当前快速运行的查询。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-31T17:43:49.797

你的解释不是很清楚：

> 其中每个索引仅列出一次，MinDate (MaxDate) 表示整个表中存在的最早（最新）日期。

如果是这种情况，您应该返回两个结果集或存储答案，例如：

```
DECLARE @MaxDate datetime, @MinDate datetime
SELECT
    @MinDate = MIN([Date]),
    @MaxDate = MAX([Date])
FROM myTable
--
SELECT
    [Index],
    @MinDate,
    @MaxDate
FROM myTable
WHERE [Date] BETWEEN '1/1/2000' AND '12/31/2000' 
```

如果您想知道整个表以及 [Index] 的最小值/最大值，请结合前面的代码尝试以下操作：

```
SELECT
    [Index],
    MIN([Date]) AS IndexMinDate,
    MAX([Date]) AS IndexMaxDate,
    @MinDate AS TableMinDate,
    @MaxDate AS TableMaxDate
FROM myTable
WHERE [Date] BETWEEN '1/1/2000' AND '12/31/2000'
GROUP BY [Index]
ORDER BY [Index] ASC 
```

如果可能的话，还要考虑对列进行索引和查询计划。祝你好运。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-31T18:12:38.397

EXISTS 运算符可能比子查询更快：

```
SELECT
     t1.Index,
     MIN(t1.[Date]),
     MAX(t1.[Date])
FROM
     myTable t1
WHERE
     EXISTS (SELECT * FROM myTable t2 WHERE t2.Index = t1.Index AND t2.[Date] >= '1/1/2000' AND t2.[Date] < '1/1/2001')
 GROUP BY
      t1.Index 
```

我想这将取决于表大小和索引。我也喜欢 G Mastros HAVING 子句解决方案。

另一个重要说明...如果您的日期实际上是 DATETIME 并且在您的任何日期（现在或将来）中都有时间组件，如果索引的日期为 2000 年 12 月 31 日，您可能会错过一些结果除了午夜之外的任何时间。只是要记住的事情。您也可以使用 YEAR([Date]) = 2000 （假设这里是 MS SQL Server）。我不知道如果你这样做，数据库是否足够聪明，可以在日期列上使用索引。

编辑：由于评论添加了 GROUP BY 并更改了日期逻辑

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-10-31T17:12:43.247

您不需要 where 子句中的子选择。此外，您可以将索引添加到日期列。表中有多少行？

```
SELECT
    [INDEX],
    MIN ( [Date] ),
    MAX ( [Date] )
FROM
    myTable
WHERE 
    [Date] Between '1/1/2000' And '12/31/2000'
GROUP BY
    [Index]
ORDER BY
    [INDEX] ASC 
```

# php - PHP strptime 格式错误？

> ID：254244
> 
> 赞同：2
> 
> 时间：2008-10-31T17:10:38.210
> 
> 标签：php, formatting, strptime

我正在努力解决 php 5.2.6 的问题。我们使用的 api 以这种格式返回日期 DDMMYYYYHHMM。正是这种格式，固定长度，没有分隔符。但是，在我的实验中，这种格式似乎会破坏 strptime，当我以这种格式向它提供日期时，它会返回错误（失败）。至少在我的系统上，它可以通过以下示例重现：

```
$format = "%d%m%Y%H%M"; echo print_r(strptime(strftime($format,1225405967),$format),true); 
```

如果我在日期和时间之间添加任何字符，它会起作用，甚至是空格。所以，这确实有效：

```
$format = "%d%m%Y %H%M"; echo print_r(strptime(strftime($format,1225405967),$format),true); 
```

我错过了一些明显的东西吗？

编辑：除此之外，由于评论指出的结果，这似乎是特定于平台的。我可以在办公室运行 OSX Leopard 的 Mac 上重现它，但 Linux 机器可以很好地解析它。我认为这是 OSX *nix 中底层 C 库中 strptime 的错误或特性。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-01T19:51:09.713

此功能取决于区域设置。您是否尝试过设置不同的语言环境？（见`setlocale()`）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-01T21:17:50.270

如果您认为问题出在 MacOS X 和 C 库中，那么您可以生成一个测试用例来演示它。例如，我在 MacOS X 10.4.11 (PPC, G4, 32-bit) 上运行下面的代码，得到了输出：

```
Now: 1225573977
Formatted (12): 011120082112
End: 0xBFFFF553 (Buffer: 0xBFFFF547)
Then: year = 2008, month = 11, day = 1, hour = 21, minute = 12
Reformatted (12): 011120082112 
```

我使用的代码是：

```
#include <time.h>
#include <stdio.h>

int main(void)
{
    time_t now = time(0);
    struct tm *tm = gmtime(&now);
    char format[] = "%d%m%Y%H%M";
    char buffer1[64];
    char buffer2[64];
    size_t f_len = strftime(buffer1, sizeof(buffer1), format, tm);
    struct tm then;
    char *end = strptime(buffer1, format, &then);
    size_t p_len = strftime(buffer2, sizeof(buffer2), format, &then);

    printf("Now: %ld\n", (long)now);
    printf("Formatted (%lu): %s\n", (unsigned long)f_len, buffer1);
    printf("End: 0x%08lX (Buffer: 0x%08lX)\n", (unsigned long)end, (unsigned long)buffer1);
    printf("Then: year = %d, month = %d, day = %d, hour = %d, minute = %d\n",
            then.tm_year + 1900, then.tm_mon + 1, then.tm_mday, then.tm_hour, then.tm_min);
    printf("Reformatted (%lu): %s\n", (unsigned long)p_len, buffer2);

    return(0);
} 
```

根据我所看到的，我正在使用的版本中 strptime() 没有错误。我们可以讨论不存在错误检查的优点，以及`<inttypes.h>`打印中的强制转换与 C99 表示法的优点，但我认为代码足够准确。我用`gmtime()`代替`localtime()`; 我怀疑这是否是不重现问题的一个因素。

也许你应该看看 PHP 测试套件？也许您应该将您相当复杂的表达式拆分为多个部分，以检测 PHP 中错误发生的位置？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-01T20:19:30.543

这很可能仅与 Mac 隔离，因为这甚至还没有在 Windows 上实现（尽管我已经通过了这个建议）。

```
5.2.6
Fatal error: Call to undefined function strptime() in F:\htdocs\strptime.php on line 5 
```

我会继续在[bugs.php.net](http://bugs.php.net/)提交一个错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T18:05:19.613

没有什么明显的，因为这两个版本在 PHP 5.2.0 中都能正常工作。不过，我目前无法轻松检查 5.2.6。那得等我回家了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-08-17T13:24:38.797

我确定：

```
 $p = strptime("09.02.2002", "%d.%m.%Y");
    var_dump($p); 
```

输出：

数组(9) { ["tm_sec"]=> int(0) ["tm_min"]=> int(0) ["tm_hour"]=> int(0) ["tm_mday"]=> int(9) [ "tm_mon"]=> int(1) ["tm_year"]=> int(102) ["tm_wday"]=> int(0) ["tm_yday"]=> int(0) ["unparsed"]=>字符串（0）“”}

OS X 豹，PHP 5.3.2

# javascript - 将文件夹上传到网站的最佳方式是什么？

> ID：254251
> 
> 赞同：18
> 
> 时间：2008-10-31T17:13:05.337
> 
> 标签：javascript, html, file-upload

我需要一种简单的方法来允许用户一次上传多个文件（即我需要允许用户上传一个文件夹）。我不想把压缩的负担放在用户身上。

*如果可能，我宁愿避免使用 Flash 或变体。* 如果可能的话，我正在寻找一个直接的 javascript / HTML 解决方案。请注意，这排除了以下答案：[通过 http 上传多个文件的最佳客户端浏览器库是什么？](https://stackoverflow.com/questions/159600/multiple-file-upload).

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-31T18:24:06.113

仅使用 HTML 和 Javascript 将无法做到这一点。我建议尝试[Fancy Upload](http://digitarald.de/project/fancyupload/)，这是一个用于多个文件上传的[MooTools](http://mootools.net/)插件。它混合使用了 JavaScript 和 Flash，但会优雅地降级。它适用于包括 IE6 在内的所有主流浏览器，并且还有一个 Flash 10 兼容版本可供下载（尽管演示尚未更新）。

* * *

更新（2012-11-26）：

**使用[valums](https://github.com/valums/file-uploader)或[blueimp文件上传器可以上传](https://github.com/blueimp/jQuery-File-Upload)**多个文件**。**

 **对于**递归目录**上传，您最好的解决方案是使用[Chrome 11 的新**文件夹上传 API**](https://stackoverflow.com/a/5849341/486547)。如果您使用供应商前缀，它似乎也适用于 Firefox。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-07-26T20:24:51.207

随着 Firefox 42 和 Edge 实施了新的[目录上传提议](https://microsoftedge.github.io/directory-upload/proposal.html)，我们终于能够进行跨浏览器目录上传。API 非常糟糕，您可能想查看我的包装器[uppie](https://github.com/silverwind/uppie)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-31T17:16:00.867

If you're avoiding Flash (and presumably Java?) the JS/HTML-only solution still requires single-file `input`s, but essentially you attach an `onchange`event to your `input`, adding a new `input`to the DOM whenever a file is selected.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-11-21T04:25:04.357

**使用[valums](https://github.com/valums/file-uploader)或[blueimp文件上传器可以上传](https://github.com/blueimp/jQuery-File-Upload)**多个文件**。**

 **对于**递归目录**上传，您的选择更加有限：

*   您最好的解决方案是使用[Chrome 11 的新**文件夹上传 API**](https://stackoverflow.com/a/5849341/486547)。如果您使用供应商前缀，它似乎也适用于 Firefox。

*   [这也可以与Java 小程序](http://jumploader.com/)跨浏览器。然而，这些天安装 JRE 的人的百分比已经很低了（[< 70%](http://www.statowl.com/java.php)）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-31T17:31:22.647

这不是一个纯粹的 js/html 解决方案。正如 EndangeredMassa 所指出的，这是不可能的。事实上，这个想法是一个 IE/Windows 唯一的解决方案。我不推荐它，但它可以工作。

所以，除了所有免责声明......

许多年和几个雇主以前，我们曾经做过一些实例化 FileSystemObject 的客户端工作。它将遍历每个文件并一次将它们传递给服务器。不记得我们是如何做到的的细节 :o(

无论如何，这通常意味着客户端必须将站点添加到受信任站点列表中，并为受信任站点提供一堆关闭的权限（出于很好的理由）。诸如初始化和编写未标记为安全的 ActiveX 控件的能力之类的东西。那种事。

我知道这不是一个完美的答案，但它可以为您指明正确的方向。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-31T17:34:56.727

FTP？如果需要，可以使用 Java Applet、ActiveX 或任何您想要的东西。

如果不是，尽管您不想使用 Flash，但 SWFUpload 非常酷，您可能需要重新考虑将其作为一个不错的选择。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-31T23:25:32.870

[这](http://filetree.extjs.eu/)是使用 ExtJS 库的纯 JS 解决方案

# database - 如何在 Sybase 中查找语言环境？

> ID：254252
> 
> 赞同：1
> 
> 时间：2008-10-31T17:13:29.610
> 
> 标签：database, sybase, locale

我在欧洲有一些服务器，在亚洲有一些。
我希望能够通过查询...来确定当前服务器的位置。

是否有一些我可以查询的全局变量或我可以执行的 sp_xxx 来找出服务器的语言环境？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-02T21:10:56.913

```
sp_helpsort 
```

[http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.help.ase_15.0.sprocs/html/sprocs/sprocs143.htm](http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.help.ase_15.0.sprocs/html/sprocs/sprocs143.htm)

将显示系统的排序顺序和字符集

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T20:35:32.913

我会在表格中使用一个参数。

但是，该问题可能有多种解决方案，并且它们可能会或可能不会起作用，具体取决于许多因素。例如，数据库服务器或操作系统配置是否有任何差异可以区分一个位置和另一个位置？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-04T16:26:57.533

如果为 XP 调用正确配置了数据服务器，则可以执行

```
 xp_cmdshell 'domainname' 
```

这将允许您获取操作系统“域名”命令的输出。然后，您可以对其进行解析以确定您的语言环境。

# c# - 用于 3D 球体绘制的最佳 .NET 图形库？

> ID：254256
> 
> 赞同：2
> 
> 时间：2008-10-31T17:15:15.737
> 
> 标签：c#, .net, winforms, graphics

我将制作一个应用程序，让用户为保龄球布局输入几个参数，然后显示该布局在球上的样子。我找到了一些很好的球体数学资源，所以如果我有一个中心为 (0,0,0) 的球体，我将能够获得球表面上我需要的点的值。我需要做的是让图书馆创建：

*   一个球体
*   在球体表面上标记点
*   画线连接球体上的点（沿着大圆的弧 - 换句话说，球体表面的最短距离）
*   ***超级骗子奖励***实际上是 3D，因此用户可以平移、缩放、旋转。

基本上，我想计算分数，告诉图书馆哪些要画，哪些要与哪些颜色联系起来，然后坐下来看着荣誉滚滚而来。

* * *

如果可能的话，我想使用 .NET 2.0 和 WinForms ......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T17:27:27.227

如果您要使用 WPF，我建议您使用[Perspective](http://www.codeplex.com/perspective)或[3DTools](http://www.codeplex.com/3DTools)。它们既易于使用，又能很好地完成工作。

如果我必须只推荐一个，我会选择 Perspective，在我使用它的时候它更容易并且有更多的功能，但它已经很长时间了，所以你应该自己看看。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T17:17:22.457

如果您使用 GLUT，您可以让库为您绘制球体，而无需计算点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-26T23:42:09.813

[我发现Tao 框架](http://www.taoframework.com/)的 OpenGL 部分非常有能力。它提供原始的 OpenGL 绑定，以及 GLUT 和 GLFW - 作为初学者，我发现 GLFW 比 GLUT 更容易满足我的简单需求。它带有关于 GLFW 和示例的不错的文档。

请注意，尽管这些库创建了一个覆盖整个窗口的 3d“视图”，因此添加标准 winforms UI 可能并不简单。这不是我尝试过的。然而，有一些示例显示了简单的 GUI。

# vim - 为什么 vim 在 telnet 会话中不能正常工作？

> ID：254259
> 
> 赞同：2
> 
> 时间：2008-10-31T17:15:38.543
> 
> 标签：vim, telnet, escaping, terminal-emulator, vms

我在 OpenVMS V7.3-2 上使用 vim (7.1)。

我通过终端仿真器 SmartTerm 的 telnet 会话连接到 VMS。

它工作正常。

但是，当我从 VMS 会话（通过 SmartTerm 连接）到另一个 VMS 会话启动 telnet 会话时，某些键无法正常工作。

```
|--------------| telnet   |-------------| telnet   |-----------------|
|  Smartterm   | ------>  | VMS, Vim OK | ------>  | VMS, Vim broken |
|--------------|          |-------------|          |-----------------| 
```

Insert、Delete、Home、End、PageUp 和 PageDown 在正常模式下类似于 ~（大写到小写，反之亦然）

任何的想法 ？

==============================================

编辑

我刚刚意识到我没有提到第二个远程登录会话在同一个 VMS 机器上。

我这样做是因为我需要使用其他用户的权限做某事。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-31T17:29:51.447

除了调整使用的终端仿真之外，学习 vim 的键击以执行您尝试执行的操作也是一个好主意。这些更可靠，不依赖于终端或键盘。例如：

*   插入：我
*   主页：^ 转到第一个非空白字符，0 始终转到第一列
*   结束：$
*   PageUp, PageDown: ctrl-u, ctrl-d 一次移动半页

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-02T19:15:12.297

我在复活一个满是灰尘的旧 Solaris 盒子时遇到了类似的问题。我懒得去寻找我应该如何`t_`正确设置我的 ... 变量，所以我重新映射了错误的终端转义序列：

```
:map xxx 0          (press <C-v><Home> in place of xxx)
:map xxx <C-b>      (press <C-v><PgUp> in place of xxx)
... etc 
```

如果你想正确设置这个该死的东西，RTFMing 可能会耗费一些精力和时间：

```
:h terminal-options 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T17:23:43.940

通常这是因为终端仿真 - 所以有些东西没有通过正确的键。自从我这样做以来已经有很长时间了，但是寻找像 VT-100 之类的东西。我怀疑它是特定于 vim 的，要么:)

抱歉，我无法提供更多帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T18:05:50.253

要问的第一个问题很简单：你坐在什么前面？您真的在运行 OpenVMS 的 VAX 或 Alpha 控制台上吗？我的猜测是答案是否定的。

万一答案是肯定的，只需输入：

$ 显示终端

并确保远程 UNIX 主机上的 TERM 变量与此完全匹配。

如果我的猜测是正确的，并且您正坐在运行某种终端仿真器（如 PuTTY 或 Terminal）的 PC 或 Mac 前，那么您需要探索您的软件选项，以确保它所模拟的终端正确反映在两者中VMS 系统的世界观和远程 UNIX 主机的世界观。

一旦你弄清楚你正在模拟什么样的终端，在你连接的 VMS 系统上再次使用上面的 VMS 命令以确保匹配。

如果没有，只需键入以下内容来纠正这种情况：

$ SET TERMINAL/DEVICE=(你的终端名称 - 例如 vt100)

然后确保远程 unix 主机上的 TERM 与 VMS 系统设置的匹配。

完成所有这些操作后，一切都应该正常。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-01T18:28:20.170

除了如何在终端设备兼容性上设置**环境**变量之外，关于 telnet 客户端本身的提示可能会很有用：

在通常的 Esc 组合之前使用 Ctrl+[，例如退出 vim

```
Ctrl+[ Esc :q! 
```

# java - javac 是否应该在同名的匿名类之外找到方法？

> ID：254260
> 
> 赞同：4
> 
> 时间：2008-10-31T17:15:49.260
> 
> 标签：java, methods, javac, anonymous-class

这个问题是后续问题： [为什么我不能在同名的匿名类之外调用方法](https://stackoverflow.com/questions/252267/why-cant-i-call-a-method-outside-of-an-anonymous-class-of-the-same-name)

这个先前的问题回答**了为什么**，但现在我想知道 javac**是否应该**找到 run(int bar)？（请参阅上一个问题以了解 run(42) 失败的原因）

如果不应该，是因为规范吗？它会产生模棱两可的代码吗？我的意思是，我认为这是一个错误。虽然前面的问题解释了为什么这段代码无法编译，但我觉得如果 javac 在树中搜索更高的位置，如果它未能在当前级别找到匹配项，它应该编译。IE。如果 this.run() 不匹配，它应该自动检查 NotApplicable.this 是否有运行方法。

另请注意，正确找到了 foo(int bar)。如果你给出了为什么不应该找到 run(int bar) 的任何理由，它还必须解释为什么找到 foo(int bar)。

```
public class NotApplicable {

    public NotApplicable() {
        new Runnable() {
            public void run() {

                // this works just fine, it automatically used NotApplicable.this when it couldn't find this.foo
                foo(42);

                // this fails to compile, javac find this.run(), and it does not match
                run(42);

                // to force javac to find run(int bar) you must use the following
                //NotApplicable.this.run(42);
            }
        };
    }

    private void run(int bar) {
    }

    public void foo(int bar) {
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-31T17:33:50.020

javac 的这种行为符合规范。请参阅Java 语言规范中的[§15.12 方法调用表达式，特别是“编译时间步骤 1”下的段落，解释了不合格方法调用的含义：](http://java.sun.com/docs/books/jls/third_edition/html/expressions.html#20448)

> 如果标识符出现在具有该名称的可见方法声明的范围（第 6.3 节）内，则必须存在该方法是其成员的封闭类型声明。让 T 成为最里面的这种类型声明。要搜索的类或接口是 T。

换句话说，在所有封闭范围内搜索未限定的方法*名称*，并且在其中找到名称的最里面的“类型声明”（表示类或接口声明）是整个搜索的名称签名（在“编译时间步骤 2”中）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T17:19:03.403

对我来说，这听起来像是一个模棱两可和脆弱的秘诀——一旦在你的基类中添加了一个新方法（好吧，对于接口来说不太可能......）你的代码的含义就会完全改变。

匿名类已经很丑陋了——让这点显式一点也不困扰我。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T17:37:20.280

尝试

```
NotApplicable.this.run(42); 
```

反而。

# visual-studio-2008 - Visual Studio 中无法识别 WCF 行为扩展元素

> ID：254265
> 
> 赞同：2
> 
> 时间：2008-10-31T17:16:45.967
> 
> 标签：visual-studio-2008, wcf, service, behavior

这个问题与此处发布的问题有关：

[为什么找不到我的自定义 WCF 行为扩展元素类型？](https://stackoverflow.com/questions/169342/why-isnt-my-custom-wcf-behavior-extension-element-type-being-found)

我在这里使用了 MSDN 上演示的带有自定义凭据的 WCF 行为扩展：

[http://msdn.microsoft.com/en-us/library/ms730868.aspx](http://msdn.microsoft.com/en-us/library/ms730868.aspx)

唯一的区别是我使用的是从 SDK 中的 WCF 自定义令牌示例创建的自定义令牌。这涉及创建 CreditCard 凭据。

将所有代码都准备好后，我通过 WCF 配置 GUI 添加了扩展。我知道它正在工作，因为它可以识别类型并将扩展名添加到配置文件中。

```
 <extensions>
    <behaviorExtensions>
      <add name="creditCardServiceCredentials" type="CreditCard.CreditCardServiceCredentialsConfigHandler, CreditCard, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
      <add name="creditCardClientCredentials" type="CreditCard.CreditCardClientCredentialsConfigHandler, CreditCard, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
    </behaviorExtensions>
  </extensions> 
```

添加这些元素后，我可以使用 WCF 配置 GUI 将自定义行为添加到服务行为元素或端点行为元素。虽然我没有看到属性，但它确实显示了类型本身，因为它是 ServiceCredentials 或 ClientCredentials 类型。

但是，当我使用编辑器本身时，它不会以智能感知或识别元素的形式出现。

**我正在引用包含信用卡凭据配置处理程序的项目；因此 DLL 位于服务的 bin\Debug 目录中。奇怪的是它仍然不起作用:(**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-03T20:54:21.377

如果您想使用智能感知扩展 Visual Studio xml 编辑器，请查看这篇文章：

[http://blogs.msdn.com/astebner/archive/2005/12/07/501466.aspx](http://blogs.msdn.com/astebner/archive/2005/12/07/501466.aspx)

# linq - LinQ ORM 数据对象和继承

> ID：254267
> 
> 赞同：1
> 
> 时间：2008-10-31T17:17:37.463
> 
> 标签：linq, inheritance, orm, polymorphism

我正在考虑如何做到这一点，但我的数据库、文章、NewsItems 等中有几种不同形状的数据。

它们都有一些共同点，它们都有 ID（在数据库中它们被命名为 ArticleID、NewsID 等）

他们都有一个**标题**

他们都有**BodyText**。

他们都有一个**状态**

他们都有一个**DateAdded**

我想做的是标准的类继承。

**我想要一个名为Content**的大师班（我不需要将其写入数据库），其字段如下：

*   ID
*   标题
*   字幕
*   主体
*   地位
*   添加日期

我不确定如何使用 ORM 做到这一点。为什么我想要这个是因为我可以将一个内容列表传递给负责渲染它的 UserControl。它只需要所有对象共有的信息。

这甚至可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T18:29:58.800

This is what Interfaces are for. Have each class implement an IContent interface that contains your Title, BodyText, Status and DateAdded properties. Now you can pass around a collection ( `List<IContent>` ) around that could containt different types of content.

If you're using LinqToSql you can create partial class files to have the autogenerated classes implement the interface you want.

```
public partial class SomeContent : IContent 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T17:51:16.663

我不确定您是否在谈论 LINQ to SQL，但是网上有一些关于如何使用它创建继承的资源：

1.  [LINQ To SQL 鉴别器列示例 - 继承映射教程](http://www.davidhayden.com/blog/dave/archive/2007/10/26/LINQToSQLInheritanceDiscriminatorColumnExampleInheritanceMappingTutorial.aspx)
2.  [LINQ to SQL 截屏视频中的继承](http://www.microsoft.com/uk/msdn/screencasts/screencast/207/Inheritance-in-LINQ-to-SQL.aspx)

...和更多。

高温高压

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T18:23:15.957

我发现一个页面看起来与我正在寻找的内容相似（最后一篇文章）......但我不确定是否使用弱类型对象：

[LINQ 继承](http://www.eggheadcafe.com/software/aspnet/32149682/linq-inheritance-problem.aspx)

# c# - 我什么时候可以处理 IDisposable WPF 控件，例如 WindowsFormsHost？

> ID：254271
> 
> 赞同：12
> 
> 时间：2008-10-31T17:18:46.400
> 
> 标签：c#, .net, wpf, idisposable

WPF 控件 WindowsFormsHost 继承自 IDisposable。

如果我有一个包含上述某些控件的复杂 WPF 可视化树，我可以在关机期间使用什么事件或方法来调用 IDispose？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-02T23:44:51.267

在应用程序关闭的情况下，您无需执行任何操作即可正确处理 WindowsFormsHost。因为它派生自 HwndHost，所以 Dispatcher 在 Dispatcher 关闭时处理。如果你使用 Reflector，你会看到当 HwndHost 被初始化时，它会创建一个 WeakEventDispatcherShutdown。

如果您在对话框中使用它，我可以建议的最好方法是覆盖 OnClosed 并处理您的主机，否则 HwndHost 将一直存在，直到 Dispatcher 关闭。

```
public partial class Dialog : Window
{
    public Dialog()
    {
        InitializeComponent();
    }

    protected override void OnClosed(EventArgs e)
    {
        if (host != null)
            host.Dispose();

        base.OnClosed(e);
    }
} 
```

测试何时调用 dispose 的一种简单方法是从 WindowsFormsHost 派生一个自定义类并尝试不同的情况。在 dispose 中设置一个断点，看看它何时被调用。

```
public class CustomWindowsFormsHost : WindowsFormsHost
{
    protected override void Dispose(bool disposing)
    {
        base.Dispose(disposing);
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-03T12:26:01.497

根据 Todd 的回答，我为由 Window 托管的任何 WPF 控件提出了这个通用解决方案，并希望保证在该窗口关闭时进行处理。

（显然，如果您可以避免从 IDisposable 继承，但有时您不能）

当层次结构中的第一个父窗口关闭时调用 Dispose。

（可能的改进 - 更改事件处理以使用弱模式）

```
public partial class MyCustomControl : IDisposable
    {

        public MyCustomControl() {
            InitializeComponent();

            Loaded += delegate(object sender, RoutedEventArgs e) {
                System.Windows.Window parent_window = Window.GetWindow(this);
                if (parent_window != null) {
                    parent_window.Closed += delegate(object sender2, EventArgs e2) {
                        Dispose();
                    };
                }
            };

            ...

        }

        ...
    } 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-01T00:42:22.387

关闭表单时不需要释放控件，如果控件位于表单的可视树中（作为表单的子项或表单中的其他控件），API 会自动为您处理

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-03T23:30:51.093

WPF 控件不实现 IDisposable 接口，因为**它们没有要处理的内容**（没有要清理的句柄，没有要释放的非托管内存）。您需要做的就是确保您没有对控件的任何引用，并且 GC 会清理它们。

因此 WPF 使用**[弱事件模式](http://msdn.microsoft.com/en-us/library/aa970850.aspx)**来确保控件可以被垃圾回收。这是您需要实施以确保清理的模式，而不是 IDisposable。

# c# - C# 动作 lambda 限制

> ID：254273
> 
> 赞同：16
> 
> 时间：2008-10-31T17:19:45.227
> 
> 标签：c#, compiler-construction, lambda

为什么这个 lambda 表达式不能编译？

```
Action a = () => throw new InvalidOperationException(); 
```

猜想很好，但我非常感谢对 C# 语言规范或其他文档的引用。

是的，我知道以下内容是有效的并且可以编译：

```
Action a = () => { throw new InvalidOperationException(); }; 
```

[这个博客文章](http://jacobcarpenter.wordpress.com/2008/10/06/c-compiler-eccentricity-of-the-day-throwing-lambda/)中描述了我会使用这样的东西的上下文。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-31T17:41:20.067

唔。我有答案，但不是很好。

我不相信有“扔”的*表达方式*。有一个 throw*语句*，但不仅仅是一个表达式。将此与“Console.WriteLine()”进行比较，后者是具有 void 类型的方法调用表达式。

作为并行，您不能将 switch 语句或 if 语句等作为 lambda 的主体。你只能有一个表达式或一个块（第 7.14 节）。

这有什么帮助吗？

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-31T17:35:08.427

这是我的看法：

`throw`是语句，不是表达式。

和参考：

> 12.3.3.11 抛出语句
> 
> 对于形式的语句 stmt
> 
> `throw expr;`
> 
> expr开头的v的确定赋值状态与stmt开头的v的确定赋值状态相同。

为了解释本质，也许人们应该考虑一下表达式在 C# lambda 构造中的含义。它只是语法糖：

```
delegate () { return XXX; } 
```

`XXX`表达式在哪里

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T17:27:49.313

我可以从这里找到的所有参考资料：

[http://msdn.microsoft.com/en-us/library/ms364047(VS.80).aspx#cs3spec_topic4](http://msdn.microsoft.com/en-us/library/ms364047(VS.80).aspx#cs3spec_topic4)

表明您有两个选择：

```
Action a = () => { throw new InvalidOperationException(); }; 
```

或者

```
Action a = () => throw new InvalidOperationException() 
```

注意缺少的 ; 最后。是的，这对我来说也没有意义。他们在规范中给出的例子是：

```
x => x + 1                     // Implicitly typed, expression body
x => { return x + 1; }         // Implicitly typed, statement body
(int x) => x + 1               // Explicitly typed, expression body
(int x) => { return x + 1; }   // Explicitly typed, statement body
(x, y) => x * y               // Multiple parameters
() => Console.WriteLine()      // No parameters 
```

不知道这有多大帮助 - 我不知道你在什么上下文中使用它，而不是放一个 ; 最后在 C# 中没有意义

不同之处可能在于它是一个表达式主体——而不是一个语句——如果它没有 {}。这意味着你的 throw 在那里无效，因为它是一个语句，而不是一个表达式！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T17:35:52.090

您不能从非作用域的 lambda 返回或抛出。

这样想...如果您不提供 {}，编译器会确定您的隐式返回值是什么。当您`throw`从 lambda 内部时，没有返回值。你甚至不回来`void`。为什么编译器团队不处理这种情况，我不知道。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-31T17:52:28.110

不是什么大惊喜。Lambda 表达式是*函数*式编程的一个方面。异常是*过程*编程的一个方面。两种编程风格之间的 C# 网格并不完美。

# java - 组合语法会成为 Java 的有用补充吗？

> ID：254276
> 
> 赞同：4
> 
> 时间：2008-10-31T17:21:26.690
> 
> 标签：java, inheritance, compiler-construction, programming-languages, composition

首先，我对语言理论几乎一无所知，除了 Java 之外我几乎不知道任何其他语言，但我有一个我认为很酷的想法，但我需要你们告诉我：
a：为什么它很烂
b：语言 x 多年来是如何做到的
c：我的思想多么糟糕
d：以上所有

这个想法将使组合具有与代码重用相同的便利性`extends`。

因此，如果您有这样的课程：

```
公共接口 A {  
    公共无效方法InA（）；  
}

```

然后你有一个这样的课程：

```
公共类 B {  
    私人作曲A；
    公共 B() {
        // 在构造函数中构造 A
    }
}

```

然后你就可以这样做了：

```
B myB = 新 B();
myB.methodInA();

```

无需在 B 类中添加委托。但是你也可以像继承一样做同样的事情，即：

```
@Overrides
公共无效方法InA（）{
    // B自己的委托方法
}

```

缺点包括：

*   方法隐藏在源代码中，使得调用的来源不太明显，但情况也是如此`extends`
*   如果组合字段共享相同的方法签名，则需要解决冲突（冲突接口如何解决这个问题？）
*   如果您想拥有多个相同类型的组合字段，那么委托给哪个字段将会有明显的冲突
*   可能还有 100 件我没想到的事情

就像我说的，我显然不是语言理论家，而且我还没有花很多时间思考这个问题，这个想法突然出现在我的脑海中，我想知道我错了多少。我只是觉得这会很酷。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-31T17:46:19.060

这听起来很酷，但我认为它会产生一些可怕的语言结构。显然，如果您声明同一类的多个“组合”，则会出现问题，但即使您禁止这样做，如果调用与多个（不同）组合类中的方法匹配，那又如何呢？您必须指定在主类中调用了哪一个，并且需要额外的语法。如果班级中有公共成员，情况会变得更糟。

组合用于防止多重继承问题。允许这样的组合实际上是允许多重继承，至少在解析调用哪个方法方面是这样。由于 Java 的一个关键设计决定是禁止多重继承（有充分的理由），我认为这不太可能被引入 Java。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T17:34:44.527

我不确定这样做是否有明显的优势。我理解你的意思。目前要在 A 上调用一个方法，您必须使用 myB.getAInstance().methodInA()，但您希望使用 myB.methodInA()。

但是，如果您有多个 A 实例会发生什么？如何解决方法调用？很多时候，组合意味着一对多的关联，所以 B 有很多 A 实例。那会发生什么？

我同意你列出的缺点。它可能只会导致太多的混乱而不是它的价值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T18:12:00.740

查看某些语言中所谓的“混合”，以及 Perl 5 Moose OO 系统中的“角色”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T18:17:56.750

我认为如果你限制它，使得一个类只能使用这个特性来组成一个类，它会有点有用，并且会避免很多正在讨论的令人头疼的问题。

我个人讨厌具体类的继承。我是 Bloch 的*Effective Java*中第 14 项的大力支持者，[Fav composition over inheritence](http://books.google.com/books?id=ZZOiqZQIbRMC&pg=PA71&lpg=PA71&dq=effective+java+composition+over+inheritance&source=bl&ots=UZM06thG21&sig=MQ4wfulnG28_z6TzvxL8uZaszn4&hl=en&sa=X&oi=book_result&resnum=1&ct=result)。我认为这样的事情会使他在该项目中推荐的习语更容易实现。

老实说，如果你真的知道你在做什么，我敢打赌你可以编写一个编译器注释来处理这个问题。因此，假设您有一个实现接口 IBar 的类 Bar，您的类将如下所示：

```
public class Foo {

  @Delegate(IBar.class)
  private Bar bar;

  // initialize bar via constructor or setter
} 
```

然后在编译期间，可以使 Foo 实现 IBar，并且该接口上尚未由 Foo 实现的任何方法最终都会生成如下所示：

```
public Baz method1(Qux val) {
  return bar.method1(val);
} 
```

如上所述，您希望限制每个类只有一个字段可以使用此注释。如果多个字段具有此注释，您可能希望引发编译错误。或者，您可以想办法将某种优先模型编码到传递给它的参数中。

现在我已经写出来了，这似乎有点酷。也许下周我会玩弄它。如果我设法弄清楚任何事情，我会更新这个。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-31T17:48:06.200

*还需要考虑组合*和*聚合*之间的区别。编译器如何知道您的意思是“is-a”还是“has-a”关系？

*   整个对象图是否有资格进行垃圾收集或只有图的头部？

一些 ORM 映射工具和框架在它们之上/周围提供持久对象之间的关系`belongsTo`或`has-many`关系，有些还提供级联删除（用于组合）。我不知道有哪一种可以提供您正在寻找的简单语法糖。

实际上，再想一想，Groovy 的 MetaClass 和 MetaProgramming 习惯用法可能会提供一些非常相似的东西，即“自动魔术”委托。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-31T17:52:43.307

C++ 中允许多重继承，我知道这不同，但它遵循相同的思考过程。Java 被设计为不允许多重继承，以便减少混乱，从而减少错误和漏洞利用。

你的建议与java的原则直接冲突。

话虽如此，它会很酷（不一定有用）。我是一名从 C++ 转换而来的 Java 程序员。我喜欢能够犯自己的错误。

# sql - 成绩数据库表

> ID：254278
> 
> 赞同：1
> 
> 时间：2008-10-31T17:21:55.207
> 
> 标签：sql, database, data-modeling

我正在尝试定义一个表格来存储在线成绩单的学生成绩。不过，我无法决定如何去做。

成绩是按学科给出的，在三个月内。每个学期都有一个平均成绩，总缺课和“恢复成绩”（我不知道英语的正确术语，但如果你低于平均水平，这是一个额外的测试，试图提高你的成绩） ，我还必须存储年平均和最终“恢复成绩”。基本上，它是这样的：

```
 |1st Trimester      |2nd Trimester      |3rd Trimester
Subj. |Avg.  |Mis.  |Rec  |Avg.  |Mis.  |Rec  |Avg.  |Mis.  |Rec  |Year Avg.  |Final Rec.
Math  |5.33  |1     |4    |8.0   |0           |7.0   |2           |6.5        |7.0
Sci.  |5.33  |1     |4    |8.0   |0           |7.0   |2           |6.5        |7.0 
```

我可以将此信息存储在单个数据库行中，每一行如下所示：

```
1tAverage | 1tMissedClasses | 1tRecoveringGrade | 2tAverage | 2tMissedClasses | 2tRecoveringGrade 
```

依此类推，但我认为这将是一种痛苦，如果学校决定按双学期或其他时间评分（就像它过去一直到 3 年前一样）。
我还可以概括表格字段，并使用 tinyint 来标记这些成绩是哪个学期的，或者它们是否是年终总决赛。但是这个会要求很多子查询来写成绩单，维护起来也很痛苦。

两者哪个更好，还是有其他方法？谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-31T17:45:11.667

你可以尝试用你的表来构造它。我没有所有的信息，所以我对你可能需要什么或用它做什么做了一些猜测。

时间段：

*   身份证号(INT)
*   PeriodTimeStart(日期时间)
*   PeriodTimeEnd(日期时间)
*   名称(VARCHAR(50)

学生们：

*   身份证号(INT)
*   名字（VARCHAR（60））
*   姓(VARCHAR(60))
*   生日（日期时间）
*   [添加了任何其他相关的学生领域信息......如联系信息等]

等级：

*   身份证号(INT)
*   学生ID(INT)
*   等级值（浮点数）
*   时间段ID(INT)
*   IsRecoveringGrade（布尔值）

错过的课程：

*   身份证号(INT)
*   学生ID(INT)
*   类ID（INT）
*   时间段ID(INT)
*   错过日期（日期时间）

课程：

*   身份证号(INT)
*   类名 (VARCHAR(50))
*   类描述（文本）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T17:30:04.880

我认为最好的解决方案是每个周期存储一行。所以你会有一张像这样的桌子：

```
grades
------
studentID
periodNumber
averageGrade
missedClasses
recoveringGrade 
```

因此，如果是 2 个学期，那么您将有第 1 和第 2 期。我建议使用第 0 期来表示“全年总体”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T17:32:49.350

最好有第二个表代表学期，并从成绩表中获得对学期的外键引用（并将各个成绩存储在成绩表中）。然后使用 SQL 函数 SUM 和 AVG 计算平均值、错过的课程等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T17:46:52.223

[这想到了。](http://xkcd.com/327/)

（但说真的，在太多的桌子上犯错，而不是太少。Handruin 有我迄今为止看到的最好的解决方案）。

# command-line - PHP 警告：在命令行运行 PHP 时模块 'ldap' 和 'mysql' 已经加载

> ID：254279
> 
> 赞同：9
> 
> 时间：2008-10-31T17:22:05.770
> 
> 标签：command-line, php

我收到以下错误：

```
PHP Warning:  Module 'ldap' already loaded in Unknown on line 0
PHP Warning:  Module 'mysql' already loaded in Unknown on line 0 
```

在命令行运行以下命令时：

```
php -c /etc/php.ini /path/to/script.php 
```

`/etc/php.ini`与 phpinfo() 中显示的 php.ini 相同。

有任何想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-31T17:24:20.570

这两个模块是否被编译到 PHP 二进制文件中？如果是这样，您可以删除或注释掉 php.ini 中两个相关的 extension= 行。

# objective-c - 覆盖 isEqual: 和 hash 的最佳实践

> ID：254281
> 
> 赞同：271
> 
> 时间：2008-10-31T17:22:25.783
> 
> 标签：objective-c, equality

您如何`isEqual:`在 Objective-C 中正确覆盖？“捕获”似乎是，如果两个对象相等（由`isEqual:`方法确定），它们必须具有相同的哈希值。

[Cocoa Fundamentals Guide](http://developer.apple.com/documentation/Cocoa/Conceptual/CocoaFundamentals/)的[Introspection](http://developer.apple.com/documentation/Cocoa/Conceptual/CocoaFundamentals/CocoaObjects/CocoaObjects.html#//apple_ref/doc/uid/TP40002974-CH4-SW25)部分确实有一个关于如何覆盖的示例，复制如下，用于名为 的类：`isEqual:``MyWidget`

```
- (BOOL)isEqual:(id)other {
    if (other == self)
        return YES;
    if (!other || ![other isKindOfClass:[self class]])
        return NO;
    return [self isEqualToWidget:other];
}

- (BOOL)isEqualToWidget:(MyWidget *)aWidget {
    if (self == aWidget)
        return YES;
    if (![(id)[self name] isEqual:[aWidget name]])
        return NO;
    if (![[self data] isEqualToData:[aWidget data]])
        return NO;
    return YES;
} 
```

它检查指针相等，然后是类相等，最后使用 比较对象`isEqualToWidget:`，它只检查`name`and`data`属性。该示例*未*显示的是如何覆盖`hash`.

让我们假设还有其他不影响相等性的属性，比如`age`。不应该`hash`重写该方法以便仅`name`影响`data`散列吗？如果是这样，你会怎么做？只需添加和的哈希`name`值`data`？例如：

```
- (NSUInteger)hash {
    NSUInteger hash = 0;
    hash += [[self name] hash];
    hash += [[self data] hash];
    return hash;
} 
```

这足够了吗？有没有更好的技术？如果你有原语怎么办，比如`int`？将它们转换`NSNumber`为获取它们的哈希？或类似的结构`NSRect`？

（**Brain fart**：最初将它们与`|=`. 一起写为“按位或”。意思是添加。）

* * *

## 回答 #1

> 赞同：114
> 
> 时间：2008-10-31T17:58:53.697

从...开始

```
 NSUInteger prime = 31;
 NSUInteger result = 1; 
```

然后对于你做的每一个原语

```
 result = prime * result + var 
```

对于对象，您使用 0 表示 nil，否则使用它们的哈希码。

```
 result = prime * result + [var hash]; 
```

对于布尔值，您使用两个不同的值

```
 result = prime * result + ((var)?1231:1237); 
```

* * *

## 解释和归属

这不是 tcurdt 的工作，评论要求更多解释，所以我相信对归属的编辑是公平的。

该算法在《Effective Java》一书中进行了普及，[目前可以在此处在线找到相关章节](http://www.scribd.com/doc/36454091/Effective-Java-Chapter3)。那本书普及了该算法，现在该算法已成为许多 Java 应用程序（包括 Eclipse）的默认设置。然而，它源自一个更古老的实现，该实现被各种归因于 Dan Bernstein 或 Chris Torek。那个较旧的算法最初在 Usenet 上流传，并且很难确定归属。例如，[这段 Apache 代码中有一些有趣的注释](http://svn.apache.org/repos/asf/apr/apr/trunk/tables/apr_hash.c)（搜索它们的名字），它们引用了原始源代码。

底线是，这是一个非常古老、简单的散列算法。它不是性能最好的，甚至在数学上也没有被证明是一个“好”的算法。但它很简单，很多人用了很久，效果也不错，所以有很多历史支持。

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2008-10-31T18:27:13.673

我自己只是在学习 Objective-C，所以我不能专门为那种语言说话，但是在我使用的其他语言中，如果两个实例“相等”，它们必须返回相同的哈希 - 否则你将拥有所有尝试将它们用作哈希表（或任何字典类型集合）中的键时会出现各种问题。

另一方面，如果 2 个实例不相等，它们可能具有也可能不具有相同的散列 - 最好不要。这是哈希表上的 O(1) 搜索和 O(N) 搜索之间的区别 - 如果所有哈希都发生冲突，您可能会发现搜索表并不比搜索列表好。

就最佳实践而言，您的哈希应该为其输入返回随机分布的值。这意味着，例如，如果您有一个 double，但您的大多数值倾向于聚集在 0 到 100 之间，您需要确保这些值返回的哈希值均匀分布在整个可能的哈希值范围内. 这将显着提高您的表现。

有许多散列算法，包括这里列出的几个。我尽量避免创建新的哈希算法，因为它可能会对性能产生很大影响，因此使用现有的哈希方法并像您在示例中所做的那样进行某种按位组合是避免它的好方法。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2013-11-16T02:57:09.983

> 在 99% 的情况下，对关键属性的哈希值进行简单的 XOR 就足够了。

例如：

```
- (NSUInteger)hash
{
    return [self.name hash] ^ [self.data hash];
} 
```

Mattt Thompson在[http://nshipster.com/equality/](http://nshipster.com/equality/)找到的解决方案（在他的帖子中也提到了这个问题 :~）

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2010-11-26T19:21:01.483

我发现这个线程非常有用，它提供了一次捕获实现我的方法所需的一切`isEqual:`。在示例代码`hash`中测试对象实例变量时使用：`isEqual:`

```
if (![(id)[self name] isEqual:[aWidget name]])
    return NO; 
```

***当我知道***单元测试中的对象相同时，这反复失败（*即*返回**NO**）而没有错误。原因是，其中一个实例变量是*nil*，所以上面的语句是：*`NSString`*

 **```
if (![nil isEqual: nil])
    return NO; 
```

并且由于*nil*会响应任何方法，这是完全合法的，但是

```
[nil isEqual: nil] 
```

返回*nil*，即**NO**，因此当对象和被测试对象都具有*nil*对象时，它们将被视为不相等（*即*，`isEqual:`将返回**NO**）。

这个简单的修复是将 if 语句更改为：

```
if ([self name] != [aWidget name] && ![(id)[self name] isEqual:[aWidget name]])
    return NO; 
```

这样，如果它们的地址相同，它会跳过方法调用，无论它们是*nil*还是都指向同一个对象，但如果它们不是*nil*或者它们指向不同的对象，则适当地调用比较器。

我希望这可以节省几分钟的时间。

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2010-12-08T23:44:34.253

散列函数应该创建一个不太可能与另一个对象的散列值发生冲突或匹配的半唯一值。

这是完整的哈希函数，可以适应您的类实例变量。它使用 NSUInteger 而不是 int 来实现 64/32 位应用程序的兼容性。

如果不同对象的结果变为 0，则存在哈希冲突的风险。当使用一些依赖于散列函数的集合类时，冲突散列可能会导致意外的程序行为。确保在使用前测试您的哈希函数。

```
-(NSUInteger)hash {
    NSUInteger result = 1;
    NSUInteger prime = 31;
    NSUInteger yesPrime = 1231;
    NSUInteger noPrime = 1237;

    // Add any object that already has a hash function (NSString)
    result = prime * result + [self.myObject hash];

    // Add primitive variables (int)
    result = prime * result + self.primitiveVariable; 

    // Boolean values (BOOL)
    result = prime * result + (self.isSelected ? yesPrime : noPrime);

    return result;
} 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-10-31T17:34:06.727

简单但低效的方法是为每个实例返回相同的`-hash`值。否则，是的，您必须仅基于影响相等性的对象实现散列。如果您在`-isEqual:`（例如不区分大小写的字符串比较）中使用松散的比较，这会很棘手。对于 int，您通常可以使用 int 本身，除非您将与 NSNumbers 进行比较。

但是，不要使用 |=，它会饱和。使用 ^= 代替。

随机有趣的事实：`[[NSNumber numberWithInt:0] isEqual:[NSNumber numberWithBool:NO]]`，但是`[[NSNumber numberWithInt:0] hash] != [[NSNumber numberWithBool:NO] hash]`。（rdar://4538282，自 2006 年 5 月 5 日起开放）

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2012-09-24T01:40:30.253

`isEqual`请记住，您只需要在为真时提供相等的散列。当`isEqual`为假时，散列不一定是不相等的，尽管它可能是不相等的。因此：

**保持哈希简单。选择最有特色的成员（或少数成员）变量。**

例如，对于 CLPlacemark，仅名称就足够了。是的，有 2 或 3 个不同的 CLPlacemark 具有完全相同的名称，但很少见。使用该哈希。

```
@interface CLPlacemark (equal)
- (BOOL)isEqual:(CLPlacemark*)other;
@end

@implementation CLPlacemark (equal) 
```

...

```
-(NSUInteger) hash
{
    return self.name.hash;
}

@end 
```

请注意，我不费心指定城市、国家等。名称就足够了。也许是名称和 CLLocation。

**哈希应该是均匀分布的。因此，您可以使用插入符号 ^（xor 符号）组合多个成员变量**

所以它就像

```
hash = self.member1.hash ^ self.member2.hash ^ self.member3.hash 
```

这样哈希将均匀分布。

```
Hash must be O(1), and not O(n) 
```

那么在数组中该怎么做呢？

再次，简单。您不必散列数组的所有成员。足以散列第一个元素，最后一个元素，计数，也许是一些中间元素，仅此而已。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2013-05-19T10:32:42.003

equals 和 hash 契约在 Java 世界中得到了很好的指定和彻底的研究（参见@mipardi 的回答），但是所有相同的考虑都应该适用于 Objective-C。

Eclipse 在 Java 中生成这些方法方面做得很可靠，所以这里有一个手动移植到 Objective-C 的 Eclipse 示例：

```
- (BOOL)isEqual:(id)object {
    if (self == object)
        return true;
    if ([self class] != [object class])
        return false;
    MyWidget *other = (MyWidget *)object;
    if (_name == nil) {
        if (other->_name != nil)
            return false;
    }
    else if (![_name isEqual:other->_name])
        return false;
    if (_data == nil) {
        if (other->_data != nil)
            return false;
    }
    else if (![_data isEqual:other->_data])
        return false;
    return true;
}

- (NSUInteger)hash {
    const NSUInteger prime = 31;
    NSUInteger result = 1;
    result = prime * result + [_name hash];
    result = prime * result + [_data hash];
    return result;
} 
```

`YourWidget`对于添加属性的子类`serialNo`：

```
- (BOOL)isEqual:(id)object {
    if (self == object)
        return true;
    if (![super isEqual:object])
        return false;
    if ([self class] != [object class])
        return false;
    YourWidget *other = (YourWidget *)object;
    if (_serialNo == nil) {
        if (other->_serialNo != nil)
            return false;
    }
    else if (![_serialNo isEqual:other->_serialNo])
        return false;
    return true;
}

- (NSUInteger)hash {
    const NSUInteger prime = 31;
    NSUInteger result = [super hash];
    result = prime * result + [_serialNo hash];
    return result;
} 
```

此实现避免了`isEqual:`Apple 示例中的一些子类化陷阱：

*   Apple 的类测试`other isKindOfClass:[self class]`对于`MyWidget`. 等式需要是对称的：a=b 当且仅当 b=a。这可以通过将测试更改为 来轻松解决`other isKindOfClass:[MyWidget class]`，然后所有`MyWidget`子类都可以相互比较。
*   使用`isKindOfClass:`子类测试可以防止子类`isEqual:`被精细的相等测试覆盖。这是因为相等性需要传递：如果 a=b 且 a=c 则 b=c。如果一个`MyWidget`实例比较等于两个`YourWidget`实例，那么这些`YourWidget`实例必须相互比较，即使它们`serialNo`不同。

第二个问题可以通过仅考虑属于完全相同的类的对象相等来解决，因此`[self class] != [object class]`这里进行测试。对于典型的**应用程序类**，这似乎是最好的方法。

但是，在某些情况下`isKindOfClass:`测试更可取。这比应用程序类更典型的**框架**类。例如，任何应该与具有相同基础字符序列的`NSString`任何其他进行比较，而不管/区别如何，也不管类簇中涉及哪些私有类。`NSString``NSString``NSMutableString``NSString`

在这种情况下，`isEqual:`应该有明确定义、有据可查的行为，并且应该明确子类不能覆盖它。在 Java 中，可以通过将 equals 和 hashcode 方法标记为 来强制执行“不覆盖”限制`final`，但 Objective-C 没有等效项。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2012-01-17T21:48:58.453

等等，当然，更简单的方法是首先覆盖`- (NSString )description`并提供对象状态的字符串表示（您必须在此字符串中表示对象的整个状态）。

然后，只需提供以下实现`hash`：

```
- (NSUInteger)hash {
    return [[self description] hash];
} 
```

这是基于“如果两个字符串对象相等（由 isEqualToString: 方法确定），它们必须具有相同的哈希值”的原则。

来源：[NSString 类参考](http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html)

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-10-31T17:37:16.283

我发现[此页面](http://web.archive.org/web/20071013053633/http://www.geocities.com/technofundo/tech/java/equalhash.html)是覆盖等于和哈希类型方法的有用指南。它包括一个体面的算法来计算哈希码。该页面面向 Java，但很容易将其调整为 Objective-C/Cocoa。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-10-31T17:43:29.220

这并没有直接回答你的问题（根本），但我之前使用过 MurmurHash 来生成哈希：[murmurhash](http://murmurhash.googlepages.com)

我想我应该解释一下原因：murmurhash 太快了……

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-02-24T15:04:49.303

我也是一个 Objective C 新手，但我在[这里](http://www.karlkraft.com/index.php/2008/01/07/equality-vs-identity/)找到了一篇关于 Objective C 中身份与平等的优秀文章。从我的阅读来看，您似乎可以只保留默认的哈希函数（它应该提供唯一的标识）并实现 isEqual 方法，以便它比较数据值。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-08-31T19:02:29.657

Quinn 错了，这里对 murmur 哈希的引用是无用的。Quinn 说得对，您想了解散列背后的理论。杂音将很多理论提炼成一个实现。弄清楚如何将该实现应用到这个特定的应用程序是值得探索的。

这里的一些关键点：

来自 tcurdt 的示例函数表明 '31' 是一个很好的乘数，因为它是素数。人们需要证明，成为素数是一个充要条件。事实上，31（和 7）可能不是特别好的素数，因为 31 == -1 % 32。一个奇数乘数，大约一半的位被设置，一半的位被清除可能会更好。（杂音散列乘法常​​数具有该属性。）

如果在乘法之后通过移位和异或调整结果值，这种类型的哈希函数可能会更强。乘法往往会在寄存器的高端产生大量位交互的结果，而在寄存器的底端产生低交互的结果。移位和异或增加了寄存器底端的交互。

将初始结果设置为大约一半位为零且大约一半位为一的值也往往是有用的。

注意元素组合的顺序可能很有用。人们可能应该首先处理值分布不强的布尔值和其他元素。

在计算结束时添加几个额外的比特加扰阶段可能很有用。

杂音散列对于这个应用程序是否真的很快是一个悬而未决的问题。杂音散列预混合每个输入字的位。可以并行处理多个输入词，这有助于多问题流水线 CPU。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2013-10-29T19:24:22.933

结合@tcurdt 的答案和@oscar-gomez 的[获取属性名称](https://stackoverflow.com/a/6615878/163827)的答案，我们可以为 isEqual 和 hash 创建一个简单的解决方案：

```
NSArray *PropertyNamesFromObject(id object)
{
    unsigned int propertyCount = 0;
    objc_property_t * properties = class_copyPropertyList([object class], &propertyCount);
    NSMutableArray *propertyNames = [NSMutableArray arrayWithCapacity:propertyCount];

    for (unsigned int i = 0; i < propertyCount; ++i) {
        objc_property_t property = properties[i];
        const char * name = property_getName(property);
        NSString *propertyName = [NSString stringWithUTF8String:name];
        [propertyNames addObject:propertyName];
    }
    free(properties);
    return propertyNames;
}

BOOL IsEqualObjects(id object1, id object2)
{
    if (object1 == object2)
        return YES;
    if (!object1 || ![object2 isKindOfClass:[object1 class]])
        return NO;

    NSArray *propertyNames = PropertyNamesFromObject(object1);
    for (NSString *propertyName in propertyNames) {
        if (([object1 valueForKey:propertyName] != [object2 valueForKey:propertyName])
            && (![[object1 valueForKey:propertyName] isEqual:[object2 valueForKey:propertyName]])) return NO;
    }

    return YES;
}

NSUInteger MagicHash(id object)
{
    NSUInteger prime = 31;
    NSUInteger result = 1;

    NSArray *propertyNames = PropertyNamesFromObject(object);

    for (NSString *propertyName in propertyNames) {
        id value = [object valueForKey:propertyName];
        result = prime * result + [value hash];
    }

    return result;
} 
```

现在，在您的自定义类中，您可以轻松实现`isEqual:`和`hash`：

```
- (NSUInteger)hash
{
    return MagicHash(self);
}

- (BOOL)isEqual:(id)other
{
    return IsEqualObjects(self, other);
} 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-11-03T01:05:42.947

请注意，如果您正在创建一个可以在创建后发生变异的对象，那么如果将对象插入到集合中，则哈希值*不得更改。*实际上，这意味着哈希值必须从初始对象创建的那一刻开始固定。有关更多信息，请参阅[Apple 关于 NSObject 协议的 -hash 方法的文档](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Protocols/NSObject_Protocol/Reference/NSObject.html#//apple_ref/doc/uid/20000052-BBCGFFCH)：

> 如果将可变对象添加到使用哈希值确定对象在集合中的位置的集合中，则当对象在集合中时，对象的哈希方法返回的值不得更改。因此，散列方法不能依赖任何对象的内部状态信息，或者您必须确保对象在集合中时对象的内部状态信息不会改变。因此，例如，可以将可变字典放入哈希表中，但您不能在其中更改它。（请注意，很难知道给定对象是否在集合中。）

这对我来说听起来很奇怪，因为它可能会有效地降低哈希查找的效率，但我认为最好谨慎行事并遵循文档所说的内容。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-11-05T16:40:55.653

抱歉，如果我冒着在这里听起来完全的风险，但是... ...没有人打扰提到要遵循“最佳实践”，您绝对不应该指定一个不会考虑目标对象拥有的所有数据的 equals 方法，例如任何数据聚合到你的对象，而不是它的关联，在实现 equals 时应该考虑到。如果您不想在比较中考虑“年龄”，那么您应该编写一个比较器并使用它来执行比较，而不是使用 isEqual:。

如果您定义了一个任意执行相等比较的 isEqual: 方法，一旦您忘记了对等式解释中的“扭曲”，您就会面临该方法被其他开发人员甚至您自己滥用的风险。

因此，虽然这是一个关于散列的很好的问答，但您通常不需要重新定义散列方法，您可能应该定义一个临时比较器。

# php - 调用非对象的成员函数

> ID：254291
> 
> 赞同：6
> 
> 时间：2008-10-31T17:25:44.747
> 
> 标签：php, zend-framework, smarty

我目前正在研究[Practical Web 2.0 Appications](https://rads.stackoverflow.com/amzn/click/com/1590599063)并且遇到了一些障碍。我试图让 PHP、MySQL、Apache、Smarty 和 Zend 框架都正常工作，这样我就可以开始构建应用程序了。我已经获得了 Zend 工作的引导文件，如下所示：

```
<?php
    require_once('Zend/Loader.php');
    Zend_Loader::registerAutoload();

    // load the application configuration
    $config = new Zend_Config_Ini('../settings.ini', 'development');
    Zend_Registry::set('config', $config);

    // create the application logger
    $logger = new Zend_Log(new Zend_Log_Writer_Stream($config->logging->file));
    Zend_Registry::set('logger', $logger);

    // connect to the database
    $params = array('host'     => $config->database->hostname,
                    'username' => $config->database->username,
                    'password' => $config->database->password,
                    'dbname'   => $config->database->database);

    $db = Zend_Db::factory($config->database->type, $params);
    Zend_Registry::set('db', $db);

    // handle the user request
    $controller = Zend_Controller_Front::getInstance();
    $controller->setControllerDirectory($config->paths->base .
                                        '/include/Controllers');

    // setup the view renderer
    $vr = new Zend_Controller_Action_Helper_ViewRenderer();
    $vr->setView(new Templater());
    $vr->setViewSuffix('tpl');
    Zend_Controller_Action_HelperBroker::addHelper($vr);

    $controller->dispatch();
?> 
```

这调用了 IndexController。使用此 Templater.php 使用 Zend 实现 Smarty 时出现错误：

```
<?php
    class Templater extends Zend_View_Abstract
    {
        protected $_path;
        protected $_engine;

        public function __construct()
        {
            $config = Zend_Registry::get('config');

            require_once('Smarty/Smarty.class.php');

            $this->_engine = new Smarty();
            $this->_engine->template_dir = $config->paths->templates;
            $this->_engine->compile_dir = sprintf('%s/tmp/templates_c',
                                                  $config->paths->data);

            $this->_engine->plugins_dir = array($config->paths->base .
                                                '/include/Templater/plugins',
                                                'plugins');
        }

        public function getEngine()
        {
            return $this->_engine;
        }

        public function __set($key, $val)
        {
            $this->_engine->assign($key, $val);
        }

        public function __get($key)
        {
            return $this->_engine->get_template_vars($key);
        }

        public function __isset($key)
        {
            return $this->_engine->get_template_vars($key) !== null;
        }

        public function __unset($key)
        {
            $this->_engine->clear_assign($key);
        }

        public function assign($spec, $value = null)
        {
            if (is_array($spec)) {
                $this->_engine->assign($spec);
                return;
            }

            $this->_engine->assign($spec, $value);
        }

        public function clearVars()
        {
            $this->_engine->clear_all_assign();
        }

        public function render($name)
        {
            return $this->_engine->fetch(strtolower($name));
        }

        public function _run()
        { }
    }
?> 
```

我加载页面时遇到的错误是这样的：

`Fatal error: Call to a member function fetch() on a non-object in /var/www/phpweb20/include/Templater.php on line 60`

我知道它没有将 $name 视为对象，但我不知道如何解决这个问题。控制器不应该引用 index.tpl 吗？我无法发现 $name 变量代表什么以及如何解决此问题以使基础正常工作。

非常感谢您的任何帮助！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-31T17:50:40.143

问题不在于 $name 变量，而在于 $_engine 变量。它目前是空的。您需要验证 Smarty.class.php 的路径规范是否正确。

你可以试试这个来开始你的调试：

```
$this->_engine = new Smarty();
print_r($this->_engine); 
```

如果结果证明 $_engine 在那个阶段是正确的，那么验证它是否仍然正确地填充在 render() 函数中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-10T01:04:32.807

Zend 有一个创建模板系统的示例，该系统在此处实现 Zend_View_Interface：http: [//framework.zend.com/manual/en/zend.view.scripts.html#zend.view.scripts.templates.interface](http://framework.zend.com/manual/en/zend.view.scripts.html#zend.view.scripts.templates.interface)

这可能会节省您尝试调试自定义解决方案的时间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-07T10:40:00.533

从类中删除 __construct 方法解决了我面临的类似问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-19T00:42:32.303

重命名`__construct()`为`Tempater()`我工作。

# sql - 有没有一种清理 MySQL 中重复条目的干净方法？

> ID：254295
> 
> 赞同：2
> 
> 时间：2008-10-31T17:27:15.260
> 
> 标签：sql, mysql, dirty-data

在一个表中，我有三列 - id、name 和 count。很多名称列是相同的（由于早期缺少 UNIQUE），我想解决这个问题。但是，其他（我认为 4 或 5 个 - 我将不得不检查文档）表使用 id 列来查找名称并且仅删除它们会破坏事情。那么有没有一种好的、干净的方式来表达“找到所有相同的记录并将它们合并在一起”？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-31T18:02:39.290

这种问题时不时会出现。不，没有真正干净的方法来做到这一点。您必须先更改子表中依赖于父表中不需要的值的所有行，然后才能消除父表中不需要的行。

MySQL 支持多表`UPDATE`和`DELETE`语句（与其他品牌的数据库不同），因此您可以执行一些非常巧妙的技巧，如下所示：

```
UPDATE names n1
  JOIN names n2 ON (n1.id < n2.id AND n1.name = n2.name)
  JOIN child_table c ON (n2.id = c.id)
SET c.name_id = n1.id
ORDER BY n1.id DESC; 
```

在所有子表上完成此操作后，您可以使用 MySQL 的多表`DELETE`语法删除父表中不需要的行：

```
DELETE FROM n2
  USING names n1 JOIN names n2 ON (n1.id < n2.id AND n1.name = n2.name); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T17:48:32.033

为什么你不能做类似的事情

```
update dependent_table set name_id = <id you want to keep> where name_id in (
    select id from names where name = 'foo' and id != <id you want to keep>) 
```

# javascript - 如何确定 JavaScript 中 HTML 元素的类型？

> ID：254302
> 
> 赞同：266
> 
> 时间：2008-10-31T17:29:22.837
> 
> 标签：javascript, dom

我需要一种方法来确定 JavaScript 中 HTML 元素的类型。它具有 ID，但元素本身可以是 a `<div>`、`<form>`字段、 a`<fieldset>`等。我该如何实现呢？

* * *

## 回答 #1

> 赞同：390
> 
> 时间：2008-10-31T17:33:45.450

[`nodeName`](https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeName)是您要查找的属性。例如：

```
var elt = document.getElementById('foo');
console.log(elt.nodeName); 
```

请注意，`nodeName`返回的元素名称大写且不带尖括号，这意味着如果要检查元素是否为`<div>`元素，可以按如下方式进行：

```
elt.nodeName == "DIV" 
```

虽然这不会给你预期的结果：

```
elt.nodeName == "<div>" 
```

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2008-10-31T17:32:13.207

怎么样[`element.tagName`](http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-104682815)？

另请参阅[`tagName`MDN 上的文档](https://developer.mozilla.org/en-US/docs/Web/API/Element/tagName)。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2020-02-01T18:44:39.863

您可以通过以下方式使用通用代码检查[`instanceof`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/instanceof)：

```
var e = document.getElementById('#my-element');
if (e instanceof HTMLInputElement) {}         // <input>
elseif (e instanceof HTMLSelectElement) {}    // <select>
elseif (e instanceof HTMLTextAreaElement) {}  // <textarea>
elseif (  ... ) {}                            // any interface 
```

[在此处](https://developer.mozilla.org/en-US/docs/Web/API)查找完整的接口列表。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2019-03-21T04:03:35.487

有时你想要`element.constructor.name`

```
document.createElement('div').constructor.name
// HTMLDivElement

document.createElement('a').constructor.name
// HTMLAnchorElement

document.createElement('foo').constructor.name
// HTMLUnknownElement 
```

# winforms - 使用 NHibernate 在多个数据库之间复制实体

> ID：254324
> 
> 赞同：12
> 
> 时间：2008-10-31T17:36:23.713
> 
> 标签：winforms, nhibernate

我有一个桌面（winforms）应用程序，它使用 Firebird 数据库作为数据存储（在嵌入式模式下），并且我使用 NHibernate 进行 ORM。我们需要支持的功能之一是能够从外部文件导入/导出数据组。目前，这个外部文件也是一个与主数据库具有相同架构的数据库。

我已经设置了 NHibernate 来查看多个数据库，并且我可以同时使用两个数据库。然而，问题在于在两个数据库之间复制数据。我有两种复制策略：(1) 复制对象的所有相同 ID [aka import/export] 和 (2) 复制大部分新 ID [aka duplicate / copy]。我说“大部分是新的”，因为有些查找项将始终使用相同的 ID 进行复制。

使用新 ID 复制所有内容很好，因为我将只有一个“CopyForExport”方法，该方法可以创建所有内容的副本而不分配新 ID（或清除对象树中的所有 ID）。

处理这种情况并在数据库之间复制数据同时保持相同 ID 的“最佳实践”方法是什么？

澄清：我不是要同步两个数据库，只是导出一个子集（用户可选择）或数据以传输给其他人（然后将数据子集导入他们自己的数据库）。

进一步澄清：我认为我已经将问题归结为：我想使用 NHibernate 的 ISession.SaveOrUpdate 功能，因此我使用未“分配”的身份生成器设置我的实体。但是，当我想覆盖生成的标识（用于在同一进程中的多个数据库之间复制数据）时，我遇到了问题。

有没有办法使用 Guid.Comb 或 UUID 生成器，但有时可以指定我自己的标识符（用于传输到具有相同架构的不同数据库连接）。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-03T18:28:47.677

我找到了自己问题的答案：关键是 ISession.Replicate 方法。这允许您在数据存储之间复制对象图并保持相同的标识符。要创建新的标识符，我想我可以使用 ISession.Merge，但我仍然需要验证这一点。

不过有一些注意事项：我的测试类引用了父对象（多对一关系），我必须使类非延迟加载才能使 Replicate 正常工作。如果我没有将它设置为急切加载（我猜是非延迟加载），它只会复制对象而不是父对象（我的 hbm.xml 文件中的 cascade="all"）。

java Hibernate 文档有对 Replicate() 的引用，但 NHibernate 文档没有（ java 文档中的[第 10.9 节](http://www.hibernate.org/hib_docs/reference/en/html/objectstate-replicating.html)）。

这对于复制行为是有意义的，因为我们希望在将实体转移到另一个数据存储之前拥有完全水合的实体。奇怪的是，即使两个会话都打开（每个数据存储一个），当我想复制它时，它并没有考虑对对象进行水合。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-02T18:17:11.150

您可以为此使用[FBCopy](http://www.firebirdfaq.org/fbcopy.php)。只需定义要复制的表和列，我就会完成这项工作。您还可以为每个表添加可选的 WHERE 子句，因此它只复制您想要的行。

在复制它时，确保保持导出数据的顺序，这样外键就不会中断。它还支持生成器。

# automation - 如何使用 Inno Setup 将命令传递到 Windows 中的 Cygwin 控制台

> ID：254340
> 
> 赞同：0
> 
> 时间：2008-10-31T17:44:13.337
> 
> 标签：automation, cygwin, inno-setup

我已经尝试过这种方法的变体，但除了能够启动 cygwin 窗口之外没有任何运气。（包裹在**;**为了清楚起见）

```
Filename: "c:\cygwin\bin\bash.exe";
  Parameters: "-c c:/scripts/step1.sh paramX";
  Flags: shellexec waituntilterminated;
  StatusMsg: "Running the script..." 
```

（这是用于内部安装，因此安装了 cywin，并且所有路径、脚本都是已知的）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2013-02-09T06:25:30.543

您的问题是`-c`告诉 bash 从下一个参数读取指令：例如

```
c:\cygwin\bin\bash.exe -c 'for NUM in 1 2 3 4 5 6 7 8 9 10; do echo $NUM; done' 
```

您只需要：

```
c:\cygwin\bin\bash.exe "/scripts/step1.sh paramX" 
```

所以你的代码看起来像：

```
Filename: "c:\cygwin\bin\bash.exe";
  Parameters: "c:/scripts/step1.sh paramX";
  Flags: shellexec waituntilterminated;
  StatusMsg: "Running the script..." 
```

也许这对其他人有帮助:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T17:55:27.043

我认为您将需要将整个事情作为`cmd.exe`调用的一部分，然后我不确定它是否会完全满足您的需求。

我正在查看 Inno-Setup 5 文档（可能已过时），但我认为您不需要`shellexec`or`waituntilterminated`标志。

尝试类似的东西

```
Filename: "cmd.exe"; Parameters: "/c c:\cygwin\bin\bash -c 'c:/scripts/step1.sh paramx'" 
```

未经测试，买者自负。

# html - 如何在 Perl 中从 HTML 中提取 URL 和链接文本？

> ID：254345
> 
> 赞同：21
> 
> 时间：2008-10-31T17:45:34.723
> 
> 标签：html, perl, parsing, url, cpan

我之前问过如何在 Groovy 中做到这一点。但是，由于所有 CPAN 库，现在我正在用 Perl 重写我的应用程序。

如果页面包含这些链接：

```
<a href="http://www.google.com">谷歌</a>

<a href="http://www.apple.com">苹果</a>

```

输出将是：

```
谷歌，http://www.google.com
苹果，http://www.apple.com

```

在 Perl 中执行此操作的最佳方法是什么？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-31T19:40:37.067

请查看为此使用[WWW::Mechanize](http://search.cpan.org/dist/WWW-Mechanize/)模块。它将为您获取您的网页，然后为您提供易于使用的 URL 列表。

```
my $mech = WWW::Mechanize->new();
$mech->get( $some_url );
my @links = $mech->links();
for my $link ( @links ) {
    printf "%s, %s\n", $link->text, $link->url;
} 
```

非常简单，如果您希望导航到该页面上的其他 URL，它甚至更简单。

Mech 基本上是一个对象中的浏览器。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-31T17:59:17.223

查看[HTML::LinkExtractor](http://search.cpan.org/perldoc?HTML::LinkExtractor)和[HTML::LinkExtor](http://search.cpan.org/perldoc?HTML::LinkExtor)，它们是[HTML::Parser](http://search.cpan.org/dist/HTML-Parser/)包的一部分。

HTML::LinkExtractor 类似于 HTML::LinkExtor，除了获取 URL 之外，您还获取链接文本。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-31T18:49:26.780

我喜欢将[pQuery](http://search.cpan.org/dist/pQuery/lib/pQuery.pm)用于这样的事情......

```
use pQuery;

pQuery( 'http://www.perlbuzz.com' )->find( 'a' )->each(
    sub {
        say $_->innerHTML . q{, } . $_->getAttribute( 'href' );
    }
); 
```

还可以查看之前的 stackoverflow.com 问题[Emulation of lex like features in Perl or Python](https://stackoverflow.com/questions/160889/emulation-of-lex-like-functionality-in-perl-or-python#161977)以获得类似的答案。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-06-04T20:39:14.977

如果您喜欢冒险并且想尝试不使用模块，那么这样的事情应该可以工作（根据您的需要进行调整）：

```
#!/usr/bin/perl

if($#ARGV < 0) {
  print "$0: Need URL argument.\n";
  exit 1;
}

my @content = split(/\n/,`wget -qO- $ARGV[0]`);
my @links = grep(/<a.*href=.*>/,@content);

foreach my $c (@links){
  $c =~ /<a.*href="([\s\S]+?)".*>/;
  $link = $1;
  $c =~ /<a.*href.*>([\s\S]+?)<\/a>/;
  $title = $1;
  print "$title, $link\n";
} 
```

我可能在这里做错了几件事，但它在我编写后尝试的少数测试用例中有效（它不考虑 <img> 标签等）。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-05T17:49:25.790

另一种方法是使用 XPath 来查询已解析的 HTML。在复杂情况下需要它，例如提取具有特定类的 div 中的所有链接。为此使用 HTML::TreeBuilder::XPath。

```
 my $tree=HTML::TreeBuilder::XPath->new_from_content($c);
  my $nodes=$tree->findnodes(q{//map[@name='map1']/area});
  while (my $node=$nodes->shift) {
    my $t=$node->attr('title');
  } 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-31T19:47:11.687

[Sherm](https://stackoverflow.com/questions/254345/how-can-i-extract-urls-from-a-web-page-in-perl#254381)推荐了[HTML::LinkExtor](http://search.cpan.org/perldoc?HTML::LinkExtor)，这几乎就是你想要的。不幸的是，它不能返回 <a> 标记内的文本。

[安迪](https://stackoverflow.com/questions/254345/how-can-i-extract-urls-from-a-web-page-in-perl#254687)推荐[WWW::Mechanize](http://search.cpan.org/perldoc?WWW::Mechanize)。这可能是最好的解决方案。

如果您发现 WWW::Mechanize 不符合您的喜好，请尝试[HTML::TreeBuilder](http://search.cpan.org/dist/HTML-Tree/)。它将从 HTML 中构建一个类似 DOM 的树，然后您可以搜索您想要的链接并提取您想要的任何附近的内容。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-11-02T02:43:11.503

或者考虑增强 HTML::LinkExtor 以执行您想要的操作，并将更改提交给作者。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-03-22T23:10:38.720

以前的答案非常好，我知道我迟到了，但这在 [perl] 提要中遇到了问题，所以......</p>

[XML::LibXML](http://search.cpan.org/perldoc?XML%3a%3aLibXML)非常适合 HTML 解析并且速度无与伦比。`recover`解析格式错误的 HTML 时设置选项。

```
use XML::LibXML;

my $doc = XML::LibXML->load_html(IO => \*DATA);
for my $anchor ( $doc->findnodes("//a[\@href]") )
{
    printf "%15s -> %s\n",
        $anchor->textContent,
        $anchor->getAttribute("href");
}

__DATA__
<html><head><title/></head><body>
<a href="http://www.google.com">Google</a>
<a href="http://www.apple.com">Apple</a>
</body></html> 
```

–产量–</p>

```
 Google -> http://www.google.com
      Apple -> http://www.apple.com 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-09-13T12:19:04.157

[HTML::LinkExtractor](http://search.cpan.org/~podmaster/HTML-LinkExtractor-0.13/LinkExtractor.pm)优于 HTML::LinkExtor

它可以提供链接文本和 URL。

用法：

```
 use HTML::LinkExtractor;
 my $input = q{If <a href="http://apple.com/"> Apple </a>}; #HTML string
 my $LX = new HTML::LinkExtractor(undef,undef,1);
 $LX->parse(\$input);
 for my $Link( @{ $LX->links } ) {
        if( $$Link{_TEXT}=~ m/Apple/ ) {
            print "\n LinkText $$Link{_TEXT} URL $$Link{href}\n";
        }
    } 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-31T18:49:00.430

HTML 是一种结构化标记语言，必须对其进行解析才能准确无误地提取其含义。列出的模块 Sherm 将解析 HTML 并为您提取链接。如果您知道您的输入将始终以相同的方式形成（不要忘记属性），那么基于特殊正则表达式的解决方案可能是可以接受的，但解析器几乎总是处理结构化文本的正确答案。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2013-01-29T09:36:48.043

我们可以使用正则表达式来提取链接及其链接文本。这也是一种方式。

```
local $/ = '';
my $a = <DATA>;

while( $a =~ m/<a[^>]*?href=\"([^>]*?)\"[^>]*?>\s*([\w\W]*?)\s*<\/a>/igs )
{   
    print "Link:$1 \t Text: $2\n";
}

__DATA__

<a href="http://www.google.com">Google</a>

<a href="http://www.apple.com">Apple</a> 
```

# .net - How to work with objects using Dynamic WCF?

> ID：254347
> 
> 赞同：1
> 
> 时间：2008-10-31T17:46:28.933
> 
> 标签：.net, wcf, web-services, .net-3.5

We currently have developed an application using WCF. Our clients make connections to different WCF servicehosts located on the server, and the servicehosts return the data from the DB that the clients need. Standard model. However, this current design has all of our WCF data in app.config files both on the client side as well as the servicehost side. We want to make this more dynamic, and have moved all of the data, including the endpoints, the contracts, and the bindings, into the DB.

Now the question is how do we retrieve this data, and access it properly. We've got the design working where we have one defined endpoint in a config file, and using that endpoint, we can make a call to it to get the rest of the endpoint information that we need (i.e. all of the bindings, contracts and different endpoints that it used to have defined in its app.config). This is the case on both the client side as well as the servicehost side.

The issue that I'm now struggling with is how do I code against these dynamic endpoints? When the client makes a call to the servicehost, it not only is making simple calls to the servicehost, but retrieving and passing back objects for the servicehost to process as needed. For example, on form load we may retrieve the object with all of the currently defined settings from the DB, and then the user does whatever on the fornm, and we then pass back the updated object to the servicehost. We can do that now because in Visual Studio 2008 we've added all of the service references, which has auto-generated the methods and objects that can be called and retrieved from the servicehosts. If we go to a dynamic endpoint connection, how do we get this data during the development phase?

I've developed a similar application in the past in .NET 2.0 using .NET remoting, where we were passing the object back and forth, and the client and server both used the same object definition class to know about the object. I'm not sure how we would go about doing this with WCF.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-01T01:54:28.870

You don't have to rely on app.config file to configure the service, you can configure the service at runtime e.g. get for for bindings, endpoints or behaviors from database to configure servicehost object.

However, the service, data or message contracts should be coded in the solution or web referenced otherwise it'd degrade the performance by heavily using reflection and lots of complexity to achieve the whole dynamic features.

In your scenario, I guess it can be done by some other way, e.g. process generic message. Implement the logic for processing any message data in the request. Hopefully, you can get more ideas by reading the articles about how to process 'any' message from client and server.

[http://msdn.microsoft.com/en-us/library/aa395208.aspx](http://msdn.microsoft.com/en-us/library/aa395208.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-11T17:42:51.497

Define your binding and then use it to instantiate the client.

```
BasicHttpBinding basic = new BasicHttpBinding(
       BasicHttpSecurityMode.TransportCredentialOnly);
basic.Security.Transport.ClientCredentialType = HttpClientCredentialType.Ntlm;
EndpointAddress serviceAddress = new EndpointAddress(
       "http://whatever/service.svc");
YourServiceClient m_client = new YourServiceClient(basic, serviceAddress); 
```

# asp.net - 使用 asp.net 事件验证时，如何防止半加载页面的表单提交异常？

> ID：254349
> 
> 赞同：5
> 
> 时间：2008-10-31T17:47:15.517
> 
> 标签：asp.net, eventvalidation

我有一个带有一些动态添加按钮的页面。如果在页面完全加载之前单击按钮，则会引发经典异常：

> ```
> Invalid postback or callback argument. 
> Event validation is enabled using in configuration or in a page. For 
> ```
> 
> 出于安全目的，此功能验证回发或回调事件的参数是否来自最初呈现它们的服务器控件。如果数据有效且符合预期，请使用 ClientScriptManager.RegisterForEventValidation 方法注册回发或回调数据以进行验证。

我猜 Viewstate 字段尚未加载到表单上，其他位正在提交。在维护事件验证的同时防止此错误的最佳方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-31T19:35:54.080

[我在这里](https://stackoverflow.com/questions/140303/aspnet-unable-to-validate-data#254581)回答了一个类似的问题。去引用：

本质上，您需要让 ViewState 在页面顶部加载。在 .NET 3.5 SP1 中，*RenderAllHiddenFieldsAtTopOfForm*属性被添加到 PagesSection 配置中。

**网页配置**

```
<configuration>

    <system.web>

        <pages renderAllHiddenFieldsAtTopOfForm="true"></pages>

    </system.web>

</configuration> 
```

有趣的是，它的默认值为 true。因此，从本质上讲，如果您使用的是 .NET 3.5 SP1，那么 ViewState 会自动呈现在表单顶部（在加载页面的其余部分之前），从而消除您遇到的 ViewState 错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-04T03:28:20.317

我发现这更多地是由`__EVENTVALIDATION`字段引起的，而不是未加载 ViewState。位于`__EVENTVALIDATION`页面底部，如果在用户导致回发时客户端未收到它，您将收到该异常。

我还没有找到一个很好的解决方案，但是我通常在由于大量内容而导致这种情况的页面上将按钮连接到一个 javascript 函数，该函数检查一个 isLoaded var，该函数只设置为 true document.ready 调用。如果 isLoaded 是假的，它会默默地吃掉这个事件，如果它是真的，它会让 if 通过。这是一个痛苦的设置，但它已经结束了我的大部分无效回发问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T18:01:20.543

如果您将这些按钮的可见属性默认设置为 false，并且在页面加载或事件验证结束时将其可见属性设置为 true，该怎么办？这种方式限制他们点击按钮，直到页面完全加载。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T19:05:12.830

据我所知，ViewState 是在页面上的表单标记之后加载的。

`ClientScriptManager.RegisterForEventValidation( button.UniqueID )`将按钮添加到页面后，您是否尝试过使用每个按钮？根据您添加按钮的位置，页面的事件连接可能已经发生，因此按钮生成的事件可能不会注册到页面。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-04-20T18:07:40.033

我花了很长时间试图弄清楚为什么 __EVENTVALIDATION 标签呈现在特定网站的底部，但呈现在每个其他网站的顶部。我最终发现这是因为渲染覆盖事件中的代码。这与精益视图状态一起主要消除了此错误，但为了更好地衡量，我在导致错误的按钮上添加了以下逻辑：

**页面上某处的javascript**

```
function CheckForHiddenFields()
{
    var EventValidation = document.getElementById('__EVENTVALIDATION');
    if (EventValidation && EventValidation.value && EventValidation.value != '')
    {
        return true;
    }
    else
    {
        return false;
    }
} 
```

**向 asp:Button 添加属性：**

```
OnClientClick="return CheckForHiddenFields();" 
```

# python - 在 Python 中，有没有比较简洁的方法来比较两个文本文件的内容是否相同？

> ID：254350
> 
> 赞同：69
> 
> 时间：2008-10-31T17:47:39.337
> 
> 标签：python, file, compare

我不在乎有什么不同。我只是想知道内容是否不同。

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2008-10-31T17:50:04.310

低级方式：

```
from __future__ import with_statement
with open(filename1) as f1:
   with open(filename2) as f2:
      if f1.read() == f2.read():
         ... 
```

高级方式：

```
import filecmp
if filecmp.cmp(filename1, filename2, shallow=False):
   ... 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-10-31T17:56:15.187

如果您想要达到基本的效率，您可能需要先检查文件大小：

```
if os.path.getsize(filename1) == os.path.getsize(filename2):
  if open('filename1','r').read() == open('filename2','r').read():
    # Files are the same. 
```

这样可以节省您阅读两个文件的每一行，这些文件的大小甚至不同，因此不能相同。

（更进一步，您可以调用每个文件的快速 MD5sum 并比较它们，但这不是“在 Python 中”，所以我会停在这里。）

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-31T23:03:01.760

这是一个函数式文件比较函数。如果文件大小不同，它会立即返回 False；否则，它会读取 4KiB 块大小并在第一个差异时立即返回 False：

```
from __future__ import with_statement
import os
import itertools, functools, operator
try:
    izip= itertools.izip  # Python 2
except AttributeError:
    izip= zip  # Python 3

def filecmp(filename1, filename2):
    "Do the two files have exactly the same contents?"
    with open(filename1, "rb") as fp1, open(filename2, "rb") as fp2:
        if os.fstat(fp1.fileno()).st_size != os.fstat(fp2.fileno()).st_size:
            return False # different sizes ∴ not equal

        # set up one 4k-reader for each file
        fp1_reader= functools.partial(fp1.read, 4096)
        fp2_reader= functools.partial(fp2.read, 4096)

        # pair each 4k-chunk from the two readers while they do not return '' (EOF)
        cmp_pairs= izip(iter(fp1_reader, b''), iter(fp2_reader, b''))

        # return True for all pairs that are not equal
        inequalities= itertools.starmap(operator.ne, cmp_pairs)

        # voilà; any() stops at first True value
        return not any(inequalities)

if __name__ == "__main__":
    import sys
    print filecmp(sys.argv[1], sys.argv[2]) 
```

只是一个不同的看法:)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-31T19:06:03.000

由于我无法评论其他人的答案，所以我会自己写。

如果你使用 md5 你绝对不能只使用 md5.update(f.read()) 因为你会使用太多的内存。

```
def get_file_md5(f, chunk_size=8192):
    h = hashlib.md5()
    while True:
        chunk = f.read(chunk_size)
        if not chunk:
            break
        h.update(chunk)
    return h.hexdigest() 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-31T17:52:16.910

```
 f = open(filename1, "r").read()
f2 = open(filename2,"r").read()
print f == f2 

```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-31T18:53:52.870

我会使用 MD5 对文件内容进行哈希处理。

```
import hashlib

def checksum(f):
    md5 = hashlib.md5()
    md5.update(open(f).read())
    return md5.hexdigest()

def is_contents_same(f1, f2):
    return checksum(f1) == checksum(f2)

if not is_contents_same('foo.txt', 'bar.txt'):
    print 'The contents are not the same!' 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-31T17:56:33.687

对于较大的文件，您可以计算文件的[MD5](http://docs.python.org/library/md5.html)或[SHA](http://docs.python.org/library/sha.html)哈希。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-12-15T17:10:53.367

```
from __future__ import with_statement

filename1 = "G:\\test1.TXT"

filename2 = "G:\\test2.TXT"

with open(filename1) as f1:

   with open(filename2) as f2:

      file1list = f1.read().splitlines()

      file2list = f2.read().splitlines()

      list1length = len(file1list)

      list2length = len(file2list)

      if list1length == list2length:

          for index in range(len(file1list)):

              if file1list[index] == file2list[index]:

                   print file1list[index] + "==" + file2list[index]

              else:                  

                   print file1list[index] + "!=" + file2list[index]+" Not-Equel"

      else:

          print "difference inthe size of the file and number of lines" 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-07-31T11:10:31.307

# 简单高效的解决方案：

```
import os

def is_file_content_equal(
    file_path_1: str, file_path_2: str, buffer_size: int = 1024 * 8
) -> bool:
    """Checks if two files content is equal
    Arguments:
        file_path_1 (str): Path to the first file
        file_path_2 (str): Path to the second file
        buffer_size (int): Size of the buffer to read the file
    Returns:
        bool that indicates if the file contents are equal
    Example:
        >>> is_file_content_equal("filecomp.py", "filecomp copy.py")
            True
        >>> is_file_content_equal("filecomp.py", "diagram.dio")
            False
    """
    # First check sizes
    s1, s2 = os.path.getsize(file_path_1), os.path.getsize(file_path_2)
    if s1 != s2:
        return False
    # If the sizes are the same check the content
    with open(file_path_1, "rb") as fp1, open(file_path_2, "rb") as fp2:
        while True:
            b1 = fp1.read(buffer_size)
            b2 = fp2.read(buffer_size)
            if b1 != b2:
                return False
            # if the content is the same and they are both empty bytes
            # the file is the same
            if not b1:
                return True 
```

# java - 馆藏地图

> ID：254351
> 
> 赞同：4
> 
> 时间：2008-10-31T17:47:50.880
> 
> 标签：java, generics, collections

我想用 Java 制作集合地图，所以我可以制作类似的东西

```
public void add(K key, V value) {  
    if (containsKey(key)) {
        get(key).add(value);
    } else {
        Collection c = new Collection();
        c.add(value);
        put(key, value);
    }
} 
```

我试着用类似的东西来做到这一点

```
public class CollectionMap<K, C extends Collection<V>> extends HashMap<K, C> 
```

但是编译器会抱怨该`<V>`部分，并且仍然存在制作适当的新集合的问题。

目前，我做了两个类： SetMap 看起来像这样

```
 1: public class SetMap<K, V> extends HashMap<K, Set<V>> {
 2: 
 3:    public void add(K key, V value) {
 4:        if (containsKey(key)) {
 5:            get(key).add(value);
 6:        } else {
 7:            Set<V> list = new HashSet<V>();
 8:            list.add(value);
 9:            put(key, list);
10:        }
11:    }
12:
13: } 
```

和 ListMap 看起来几乎一样，除了我创建新 ArrayList 的第 7 行。这种重复小到可以容忍，但问题仍然存在，这种“嵌套泛型”在 Java 中是否可行？

编辑：

正如[埃里克森所说](https://stackoverflow.com/questions/254351/map-of-collections#254372)，解决方案`<A, B extends Something<A>>`不仅仅是`<B extends Something<A>>`

所以代码看起来像

```
public abstract class CollelctionMap<K, V, C extends Collection<V>> extends HashMap<K, C> {

    protected abstract C newCollection();

    public void add(K key, V value) {
        if (containsKey(key)) {
            get(key).add(value);
        } else {
            C c = newCollection();
            c.add(value);
            put(key, c);
        }
    }
} 
```

而 ListMap 和 SetMap 只提供正确的集合

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-31T17:56:04.517

如果`map`是 a `Map<K, Collection<V>>`，请使用 idiom [`computeIfAbsent(...).add(...)`，](http://docs.oracle.com/javase/8/docs/api/java/util/Map.html#computeIfAbsent-K-java.util.function.Function-)如下所示：

```
map.computeIfAbsent(key, k -> new ArrayList<>()).add(value); 
```

或者，对于一个`Set`：

```
map.computeIfAbsent(key, k -> new HashSet<>()).add(value); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-31T17:58:06.773

如果可以选择，您可能只想使用 Google Collections API - [http://code.google.com/p/google-collections/](http://code.google.com/p/google-collections/)。

即使你不能使用它，也许看看他们如何实现他们的 MultiMaps 会帮助你实现。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-31T18:04:41.300

你的代码有问题：

集合 c = 新集合（）；

无法实例化。

我认为下一段代码将解决您的问题：

```
public class CollectionMap<K, V> extends HashMap<K, Collection<V>> {

    ...
    ...
    ...

    public void add(K key, V value) {
        if (containsKey(key)) {
            get(key).add(value);
        } else {
            Collection<V> c = new ArrayList<V>();
            c.add(value);
            super.put(key, c);
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-31T21:51:45.710

Apache Commons Collections 还提供了 MultiMap，但它是 JDK 1-.5 之前的版本，所以那里没有泛型安全性。您可以将其包装在 Collections.checkedMap(Key.class, Value.class, collection) 中以确保运行时安全。如果您可以使用 Google 的 Colelction API，它会提供一个更流畅的 MultiMap，其中包含所有的泛型、花里胡哨的功能。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-02T16:12:04.240

如果可能，请使用 Google 的[Guava](https://github.com/google/guava/wiki/NewCollectionTypesExplained)。伙计们在那里做得很好。

这是另一个解决方案。

```
abstract class MultiMap<K, V> {

    private Map<K, Collection<V>> entries = new LinkedHashMap<K, Collection<V>>();

    public void put(K key, V value) {
        Collection<V> values = entries.get(key);
        if (values == null) {
            entries.put(key, values = newValueCollection());
        }
        values.add(value);
    }

    // other methods
    // ..

    abstract Collection<V> newValueCollection();

    // Helper methods to create different flavors of MultiMaps

    public static <K, V> MultiMap<K, V> newArrayListMultiMap() {
        return new MultiMap<K, V>() {
            Collection<V> newValueCollection() {
                return new ArrayList<V>();
            }
        };
    }

    public static <K, V> MultiMap<K, V> newHashSetMultiMap() {
        return new MultiMap<K, V>() {
            Collection<V> newValueCollection() {
                return new HashSet<V>();
            }
        };
        }

 } 
```

你可以像这样使用它

```
MultiMap<String, Integer> data = MultiMap.newArrayListMultiMap();
data.put("first", 1);
data.put("first", 2);
data.put("first", 3); 
```

# iphone - 使用单独的委托/数据源时的 UITableView 问题

> ID：254354
> 
> 赞同：54
> 
> 时间：2008-10-31T17:48:41.270
> 
> 标签：iphone, objective-c, cocoa-touch, uitableview

**一般说明：**

首先，我有一个`UITableView`使用 Interface Builder 放置在 Xcode 生成的视图上的内容。视图的文件所有者设置为 Xcode 生成的`UIViewController`. 在这个子类中，我添加了和表视图的工作实现，并通过`numberOfSectionsInTableView: tableView:numberOfRowsInSection:`接口生成器中的文件所有者连接到这个类。`tableView:cellForRowAtIndexPath:``dataSource``delegate`

上面的配置没有问题。当我想将此表视图的`dataSource`和`delegate`- 实现移到单独的类时会出现此问题，很可能是因为除了表视图之外视图上还有其他控件，我想将表视图相关的代码移到它的自己的班级。为此，我尝试以下方法：

*   `UITableViewController`在 Xcode 中创建一个新的子类
*   将`numberOfSectionsInTableView:`,`tableView:numberOfRowsInSection:`和的已知良好实现移动`tableView:cellForRowAtIndexPath:`到新的子类
*   将 a拖到 InterfaceBuilder 中*现有*XIB`UITableViewController`的顶层 ，删除为此自动创建的/ ，然后设置的类以匹配新的子类*`UIView``UITableView``UITableViewController``UITableViewController`*
**   删除以前工作`UITableView`的现有`dataSource`和`delegate`连接并将它们连接到新的`UITableViewController`*

 *完成后，我没有工作`UITableView`. 我最终得到了三个看似随机发生的结果之一：

*   加载时`UITableView`，我收到一个运行时错误，表明我正在发送`tableView:cellForRowAtIndexPath:`到一个无法识别它的对象
*   加载时`UITableView`，项目无错误地进入调试器
*   没有错误，但`UITableView`没有出现

通过一些调试并创建了一个基本项目来重现此问题，我通常会看到上面的第三个选项（没有错误但没有可见的表格视图）。我添加了一些 NSLog 调用，发现虽然`numberOfSectionsInTableView:`和`numberOfRowsInSection:`都被调用，但`cellForRowAtIndexPath:`不是。我确信我错过了一些非常简单的东西，并希望答案对于比我更有经验的人来说可能是显而易见的。如果这不是一个简单的答案，我很乐意用一些代码或示例项目进行更新。谢谢你的时间！

**完整的重现步骤：**

*   在 Xcode 中创建一个新的 iPhone OS，基于视图的应用程序并调用它`TableTest`
*   `TableTestViewController.xib`在 Interface Builder 中打开并将 a`UITableView`拖到提供的视图表面上。
*   将`UITableView`'s`dataSource`和`delegate`-outlets 连接到应该已经代表`TableTestViewController`-class 的 File's Owner。保存您的更改
*   回到 Xcode，将以下代码添加到`TableTestViewController.m:`

* * *

```
- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView {
    NSLog(@"Returning num sections");
    return 1;
}
- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
    NSLog(@"Returning num rows");
    return 1;
}
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    NSLog(@"Trying to return cell");
    static NSString *CellIdentifier = @"Cell";

    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:CellIdentifier];
    if (cell == nil) {
        cell = [[[UITableViewCell alloc] initWithFrame:CGRectZero reuseIdentifier:CellIdentifier] autorelease];
    }
    cell.text = @"Hello";
    NSLog(@"Returning cell");
    return cell;
} 
```

*   Build and Go，你应该会看到这个词`Hello`出现在`UITableView`

*   现在尝试将 this`UITableView`的逻辑移到一个单独的类中，首先在 Xcode 中创建一个新文件，选择`UITableViewController`子类并调用该类`TableTestTableViewController`

*   把上面的代码片段去掉，`TableTestViewController.m`放到 里面`TableTestTableViewController.m`，把这三个方法的默认实现替换成我们的。
*   返回同一文件中的 Interface Builder `TableTestViewController.xib`，将 a`UITableViewController`拖入主 IB 窗口并删除`UITableView`自动附带的新对象
*   将这个新的类设置`UITableViewController`为`TableTestTableViewController`
*   从现有的、先前工作的中删除`dataSource`和绑定，然后将相同的两个绑定重新连接到我们创建的新绑定。`delegate``UITableView``TableTestTableViewController`
*   保存更改，构建并开始，如果你得到我得到的结果，请注意`UITableView`不再正常运行

**解决方案：** 通过更多故障排除和来自[iPhone 开发者论坛](https://devforums.apple.com/message/5453)的帮助，我记录了一个解决方案！项目的主要`UIViewController`子类需要一个指向`UITableViewController`实例的出口。为此，只需将以下内容添加到主视图的标题 ( `TableTestViewController.h`) 中：

```
#import "TableTestTableViewController.h" 
```

和

```
IBOutlet TableTestTableViewController *myTableViewController; 
```

然后，在 Interface Builder 中，将 File's Owner 的新出口连接到`TableTestTableViewController`主 IB 窗口中。XIB 的 UI 部分无需更改。只需设置此插座，即使没有用户代码直接使用它，也可以完全解决问题。感谢那些帮助并感谢 iPhone 开发者论坛上的 BaldEagle 找到解决方案的人。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-11-01T18:03:18.370

我按照您的步骤，重新创建了项目并遇到了同样的问题。基本上你就快到了。缺少两件事（一旦修复它就可以了）：

*   您需要将 的 连接`tableView`到`TableTestTableViewController`屏幕`UITableView`上的 。正如我之前所说，因为它不是`IBOutlet`你可以覆盖该`tableView`属性并使其`IBOutlet`：

    ```
    @interface TableTestTableViewController : UITableViewController {
        UITableView *tableView;
    }

    @property (nonatomic, retain) IBOutlet UITableView *tableView; 
    ```

*   接下来是添加对 的引用`TableTestTableViewController`并将其保留在`TableTestViewController`. 否则你`TableTestTableViewController`可能会被释放（在加载笔尖后没有任何东西挂在上面。）这就是为什么你会看到不稳定的结果、崩溃或什么都没有显示的原因。为此添加：

    ```
    @interface TableTestViewController : UIViewController {
        TableTestTableViewController *tableViewController;
    }

    @property (nonatomic, retain) IBOutlet TableTestTableViewController  *tableViewController; 
    ```

    并在 Interface Builder 中将其连接到`TableTestTableViewController`实例。

有了上述内容，这在我的机器上运行良好。

另外，我认为最好说明所有这一切背后的动机（而不是仅仅使用`UITableViewController`with 自己的`UITableView`）。就我而言，它是`UITableView`在同一屏幕内容上使用其他视图。所以我可以添加其他`UILabels`或`UIImages`下方`UIView`并显示`UITableView`它们下方或上方。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-07T04:43:34.103

我只是花了很多时间把头发拉出来，试图弄清楚为什么`UITableView`当我将它嵌入单独的笔尖而不是主笔尖时不会出现。我终于在上面找到了你的讨论，并意识到这是因为我`UITableViewController`的没有被保留！显然，委托和数据源属性`UITableView`没有标记为“保留”，所以我的笔尖正在加载，但控制器被扔掉了......由于objective-c的奇迹，我根本没有收到*任何*错误消息......我仍然不明白为什么它没有崩溃。我知道我以前看过“发送给已发布 xxx 的消息”……为什么它不给我其中之一？！？

我认为大多数开发人员会假设他们在界面构建器中构建的结构将保存在更大的上下文（Nib）中，并且不会发布。我想我知道他们为什么这样做……这样 iPhone 就可以在内存不足的情况下放下并重新加载笔尖的一部分。但是，伙计，这很难弄清楚。

有人能告诉我应该在哪里阅读文档中的这种行为吗？

另外 - 关于连接视图。首先，如果您从 UI 构建器中拖入一个，您会看到它们将视图属性（它是一个`IBOutlet`）连接到表视图。没有必要公开`tableView`似乎在内部设置的 , 。`viewDidLoad`事实上，除非您需要通知，否则似乎不需要设置视图。我刚刚断开了我的`uitableview`和`uitableviewcontroller`（仅代表和数据源集）之间的视图连接，它显然工作正常。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-31T20:16:48.257

是的，出于某种原因（如果有人知道原因，请插话......）即使它是公共财产，它的财产也没有`tableView`公开`UITableViewController`。`IBOutlet`因此，当您使用 Interface Builder 时，您看不到该属性以连接到您的其他`UITableView`. 因此，在您的子类中，您可以创建一个`tableView`标记为 an 的属性`IBOutlet`并将其连接起来。

这一切对我来说似乎很老套，也是一种解决方法，但它似乎是分离 a`UITableViewController's` `UITableView`并将其放在 UI 层次结构中的其他位置的唯一方法。当我尝试设计视图时遇到了同样的问题，`UITableView`而这就是我解决它的方式......这是正确的方法吗？？？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-03-10T23:03:13.487

我能够完成这项工作。我用 4 个 TableViews 和一个带有视频的 webview 构建了一个非常好的仪表板。关键是拥有单独的 tableView 控制器和 IBOutlets 到视图控制器中定义的其他 tableview 控制器。在 UIB 中，您只需要将其他 tableview 控制器连接到视图控制器的文件所有者。然后将表连接到数据源和委托的相应视图控制器。

# java - Java中的DBus服务器？

> ID：254366
> 
> 赞同：3
> 
> 时间：2008-10-31T17:53:12.633
> 
> 标签：java, dbus

是否有[DBus](http://www.freedesktop.org/wiki/Software/dbus) for Java 的服务器实现？有一个用于客户端和服务（不是服务器）的[库。](http://dbus.freedesktop.org/doc/dbus-java/)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2014-03-08T16:51:50.257

似乎自从您最初提出问题以来，该库已获得对您所要求的内容的支持，至少[DBusDaemon](http://dbus-java.sourcearchive.com/documentation/2.8-2/DBusDaemon_8java_source.html)源包含一个[DBusServer](http://dbus-java.sourcearchive.com/documentation/2.8-2/classorg_1_1freedesktop_1_1dbus_1_1bin_1_1DBusDaemon_1_1DBusServer.html)类。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T22:42:38.940

我没有理解为什么有必要对服务器进行特定语言的实现。我没有得到这样的印象，即一个以上的 DBus 实例旨在在服务器上并行运行，因此您公开/订阅的任何事件都是客户端。如果它是所有客户端都在 java 中，这就是您需要与之交互的所有内容。什么都不应该直接调用服务器代码，那么为什么需要服务器的 java 实现呢？

# memory - 在 64 位机器上安装 32 位操作系统是否会提高带宽？

> ID：254368
> 
> 赞同：5
> 
> 时间：2008-10-31T17:53:33.367
> 
> 标签：memory, caching, 64-bit, hardware, 32-bit

Knuth[最近反对](http://www-cs-faculty.stanford.edu/~knuth/news08.html)64 位系统，他说对于适合 4 GB 内存的程序，“它们实际上丢弃了一半的缓存”，因为指针是 32 位系统上的两倍。

我的问题是：可以通过在 64 位机器上安装 32 位操作系统来避免这个问题吗？是否有任何带宽密集型基准可以证明这种情况下的优势？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-31T18:23:59.153

带宽在这里并不是真正的正确术语。Knuth 真正谈论的是数据密度，因为它与缓存占用有关。假设你有一个 16KB 的 L1 数据缓存：如果你纯粹存储指针，你可以存储 2^14/2^2 = 2^12 = 4096 个 32 位指针，但只能存储 2048 个 64 位指针。如果您的应用程序的性能取决于能够跟踪超过 2K 的不同缓冲区，那么您可能会看到 32 位地址空间的真正性能优势。然而，大多数实际代码并非如此，缓存系统的真正性能优势通常来自能够缓存常见的整数和浮点数据结构，而不是大量的指针。如果您的工作集不是大量指针，则 64 位的缺点可以忽略不计，而如果您使用“

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-31T18:01:17.890

答案是：是的，在一定程度上可以，尽管性能差异不太可能很大。

任何测试这个的基准都必须做大量的指针解析，这将很难从噪音中分离出来。设计一个不会优化的基准是困难的。 [这篇关于有缺陷的 Java 基准测试](http://www.ibm.com/developerworks/java/library/j-jtp02225.html)的文章是有人在回答另一个问题时发布的，但其中描述的许多原则都适用于此。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-31T19:23:01.283

我不认为 Knuth 反对 64 位系统。他只是说在内存小于 4GB 的系统上使用 64 位指针是愚蠢的（至少如果你有很多指针，比如双链表中的指针）。我不能说我同意他的观点，这里有 3 种不同的方式可以采取。假设您有一个支持 64 位的 CPU，它也可以像某些 Intel Core Duo 一样在 32 位模式下运行。

1 - 一切都是 32 位的，操作系统、APPZ 等等。所以你有 32 位指针，但你不能使用 64 位模式下可用的额外寄存器/指令。

2 - 一切都是 64 位的，操作系统、APPZ 等等。所以你有 64 位指针，你可以使用 64 位模式下可用的额外寄存器/指令。但是由于您的内存少于 4GB，因此使用 64 位指针似乎很愚蠢。但是，是吗？

3 - 操作系统是 64 位的，有趣的是，操作系统确保所有代码/数据指针都在 0x00000000 - 0xFFFFFFFF 范围内（虚拟内存！！！）。ABI 以一种非常奇怪的方式运行，所有保存在内存/文件中的代码/数据指针都是 32 位宽的，但它们作为零扩展加载到 64 位寄存器中。如果有要跳转的代码位置，编译器/ABI 会进行必要的修复并执行实际的 64 位跳转。这样，指针是 32 位的，但 APPZ 可以是 64 位的，这意味着它们可以使用 64 位的寄存器和指令。我认为这个过程有点像 thunking ;-P

我的结论是::

第三个选项对我来说似乎可行，但这不是一个容易的问题。理论上它可以工作，但我认为它不可行。而且我还认为他的引用“当这样的指针值出现在结构中时，它们不仅浪费了一半的内存，而且还有效地丢弃了一半的缓存。” 被夸大了……

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-31T19:11:57.653

我在某处看到最好的组合（在 x86 CPU 上）是使用 64 位操作系统和 32 位应用程序。

使用 64 位操作系统，您将获得：

*   能够处理超过 4GB 的地址空间
*   更多、更大的寄存器来帮助数据复制操作

使用 32 位应用程序，您将获得：

*   较小的指针
*   更少、更小的寄存器以节省上下文切换

缺点：

*   所有库都必须复制。按照高清空间标准来说很小。
*   所有加载的库都在 RAM 上复制。没那么小……

令人惊讶的是，切换模式时似乎没有任何开销。我想无论用户空间的位数如何，从用户空间中断到内核的成本都是一样的。

当然，有些应用程序可以从大地址空间中受益。但对于其他一切，您可以通过保持 32 位获得额外 5% 的性能。

不，我不在乎这个小小的加速。但在 64 位 KUbuntu 机器上运行 32 位 FireFox 并没有“冒犯”我（就像我在一些论坛上看到的那样）

# jquery - 将另一个 CSS 样式添加到也是父元素的子元素

> ID：254384
> 
> 赞同：3
> 
> 时间：2008-10-31T18:00:35.520
> 
> 标签：jquery, parent, children

所以我的列表看起来像这样：

```
<div="list">
  <ul>
    <li class="page item">Parent 1
      <ul>
        <li class="page item">Child of Parent 1 and Parent of Grandchild
          <ul>
            <li class="page item">Grandchild</li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</div> 
```

这是通过 Wordpress 的 list_wp_pages 以及自定义 CSS 吸盘式下拉 CSS 代码实现的。无序列表本身无法更改任何内容，因此我需要找到一种方法将 CSS 样式添加到也是父页面的唯一子页面（父 1 的子...）。

我一直在尝试仅向具有自己的子页面的子页面添加箭头图标。我想我可以使用：

```
$("#target").addClass("newclass"); 
```

添加一个带有箭头图标的额外类作为背景图像。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T18:08:05.457

```
$("#target li").each(function() {
    if ( $("ul:eq(0)", this).length > 0 ) {
        $(this).addClass("class_name");
    }
}); 
```

检查#target 下的每个列表项以查看它是否至少有一个子无序列表，如果有，则将类名添加到刚刚检查的列表项中。

# java - 如何在不使用 -cp 开关的情况下在 Groovy 中自动加载数据库 jar？

> ID：254385
> 
> 赞同：17
> 
> 时间：2008-10-31T18:00:42.900
> 
> 标签：java, scripting, groovy, classpath

我想简化调用 Oracle 数据库的 Groovy 脚本的执行。如何将 ojdbc jar 添加到默认类路径以便我可以运行：

```
groovy RunScript.groovy 
```

代替：

```
groovy -cp ojdbc5.jar RunScript.groovy 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-31T18:27:27.837

*从Groovy Recipes*中总结，作者 Scott Davis，**在 ./groovy/lib 目录中自动包含 JAR**：

1.  `.groovy/lib`在您的登录目录中创建
2.  取消注释 ${GROOVY_HOME}/conf/groovy-starter.conf 中的以下行

    `load !{user.home}/.groovy/lib/*.jar`

3.  将要包含的 jar 复制到`.groovy/lib`

看来，对于 Groovy 1.5 或更高版本，默认情况下您会得到这个（无需编辑 conf），只需将 jar 放在 /lib 目录中即可。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-31T18:26:38.573

有几种方法可以做到这一点。您可以将 jar 添加到系统的 CLASSPATH 变量中。您可以在主目录中创建一个名为 .groovy/lib 的目录并将 jar 放入其中。它将在运行时自动添加到您的类路径中。或者，您可以在代码中执行此操作：

```
this.class.classLoader.rootLoader.addURL(new URL("file:///path to file")) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2020-04-08T15:52:22.310

一种方法是在代码中使用@Grab：

```
 @GrabConfig(systemClassLoader=true)
    @Grab('com.oracle:ojdbc6:12.1.0.2.0')
    Class.forName("oracle.jdbc.OracleDriver").newInstance() 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T18:20:16.417

`groovy`只是设置 Java 类路径的 Groovy JAR 的包装脚本。我想您也可以修改该脚本以将路径添加到您自己的 JAR 中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-03-19T18:07:00.910

您可以将以下[shebang](https://en.wikipedia.org/wiki/Shebang_(Unix))添加到 Groovy 脚本的第一行：

```
#!/usr/bin/env groovy -cp ojdbc5.jar 
```

然后，标记脚本可执行文件：

```
chmod u+x RunScript.groovy 
```

现在，单独运行脚本将自动设置类路径。

```
./RunScript.groovy 
```

# php - 如何在 PHP 中将图像转换为黑白

> ID：254388
> 
> 赞同：14
> 
> 时间：2008-10-31T18:01:53.317
> 
> 标签：php, image, imagefilter

如何在 PHP 中将图像转换为黑白？

不只是把它变成灰度，而且每个像素都变成黑色或白色？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-31T20:04:31.370

使用 php [gd](http://us2.php.net/manual/en/function.imagefilter.php)库：

```
imagefilter($im, IMG_FILTER_GRAYSCALE);
imagefilter($im, IMG_FILTER_CONTRAST, -100); 
```

查看上面链接中的用户评论以获取更多示例。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-31T18:18:55.077

只需将灰度颜色四舍五入为黑色或白色。

```
float gray = (r + g + b) / 3
if(gray > 0x7F) return 0xFF;
return 0x00; 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-31T18:03:22.020

假设您的主机支持它，您可以使用 imagemagick。你想用什么函数来决定一个像素应该是黑色还是白色？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-31T18:10:00.180

如果您打算自己执行此操作，则需要实现[抖动算法](http://en.wikipedia.org/wiki/Dithering#Dithering_algorithms)。但正如[@jonni](https://stackoverflow.com/questions/254388/how-do-you-converting-an-image-to-black-and-white-in-php#254393)所说，使用现有工具会容易得多吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-04-25T10:40:44.973

```
$rgb = imagecolorat($original, $x, $y);
        $r = ($rgb >> 16) & 0xFF;
        $g = ($rgb >> 8 ) & 0xFF;
        $b = $rgb & 0xFF;

        $gray = $r + $g + $b/3;
        if ($gray >0xFF) {$grey = 0xFFFFFF;}
        else { $grey=0x000000;} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-01-12T02:43:11.090

这个功能就像一个魅力

```
 public function ImageToBlackAndWhite($im) {

    for ($x = imagesx($im); $x--;) {
        for ($y = imagesy($im); $y--;) {
            $rgb = imagecolorat($im, $x, $y);
            $r = ($rgb >> 16) & 0xFF;
            $g = ($rgb >> 8 ) & 0xFF;
            $b = $rgb & 0xFF;
            $gray = ($r + $g + $b) / 3;
            if ($gray < 0xFF) {

                imagesetpixel($im, $x, $y, 0xFFFFFF);
            }else
                imagesetpixel($im, $x, $y, 0x000000);
        }
    }

    imagefilter($im, IMG_FILTER_NEGATE);

} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-01T01:19:55.290

对于每个像素，您必须从颜色转换为灰度 - 例如 $grey = $red * 0.299 + $green * 0.587 + $blue * 0.114; （这些是 NTSC 加权因子；存在其他类似的加权因子。这模仿了眼睛对不同颜色的不同反应）。

然后你需要决定一个截止值——通常是最大像素值的一半，但根据图像，你可能更喜欢更高的值（使图像更暗）或更低（使图像更亮）。

仅将每个像素与截止值进行比较会丢失很多细节 - 即大的黑暗区域完全变黑 - 因此要保留更多信息，您可以抖动。基本上，从图像的左上角开始：对于每个像素，在与截止值比较之前，添加左侧和上方像素的误差（原始值和最终分配值之间的差）。

请注意，在 PHP 中执行此操作会非常慢 - 您将远远领先于找到提供此功能的库。

# c - 'entry' 关键字发生了什么？

> ID：254395
> 
> 赞同：38
> 
> 时间：2008-10-31T18:04:20.490
> 
> 标签：c, language-design

前几天在浏览我的白皮书时，我注意到了 C 关键字列表。 **entry**是该列表中的关键字之一。

它保留供将来使用。回想我的 Fortran 日子，有一个函数使用**入口**语句来创建第二个参数签名或函数的入口点。

这是**条目**最初的用途吗？还是完全不同的东西？

**入口**关键字的故事是什么？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-31T18:11:16.060

我不知道，所以我用谷歌搜索了一些关于这个的东西。这就是我发现的。

首先，它被作为保留关键字包含在内。

> **Q** : K&R1 中提到的入口关键词是什么？
> **A** : 它被保留以允许具有多个不同名称入口点的函数，但它已被撤回。

（来自[http://archives.devshed.com/forums/cc-134/c-programming-faqs-371017.html](http://archives.devshed.com/forums/c-c-134/c-programming-faqs-371017.html)。）

它从未标准化。一些编译器[以非常个人的方式](http://bytes.com/forum/thread214853.html)使用它。

我猜它后来被宣布过时了。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-31T18:11:00.820

在 FORTRAN 中，“ENTRY”可以声明子程序的第二个入口点。它是一个结构化的编程工具，幸运的是 C 决定不采用它。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-31T18:12:10.083

entry 关键字来自[PL/I](http://en.wikipedia.org/wiki/PL/I)，允许多个入口点进入一个函数。该关键字由一些编译器实现，但从未标准化。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-05-23T07:32:39.823

为了补充接受的答案“条目”在 K&R1 中提到：

> **2.3 关键词**
> 
> 以下标识符保留用作关键字，不得以其他方式使用
> 
> 其他的 int 外部
> 
> 字符寄存器
> 
> 浮动类型定义做
> 
> 双静态同时
> 
> 结构跳转开关
> 
> 工会退货案
> 
> 默认的长尺寸
> 
> 短暂休息进入
> 
> 无符号继续
> 
> 自动如果

和这里：

> entry 关键字当前未由任何编译器实现，但保留供将来使用。一些实现还保留单词“fortran”和“asm”。

然后在 ANSI C 语言 (C89) 的基本原理中提到这里：

> **3.1.1 关键词**
> 
> [...]
> 
> 关键字“entry”、“fortran”和“asm”未包括在内，因为它们要么从未使用过，要么不可移植。'fortran' 和 'asm' 作为关键字的使用不是*常见的扩展*。

# macos - 这些从 tarball 中提取的零字节文件是什么？(OSX)

> ID：254397
> 
> 赞同：1
> 
> 时间：2008-10-31T18:04:45.247
> 
> 标签：macos, file, tar

我正在从 tarball 中提取一个文件夹，我看到这些零字节文件出现在结果中（它们不在源代码中。）设置（全部在 OS X 上）：

在第一台机器上，我有一个目录 /My/Stuff/Goes/Here/ 包含数百个文件。我这样建造

```
tar -cZf mystuff.tgz /My/Stuff/Goes/Here/ 
```

在机器二上，我将 tgz 文件 scp 到我的本地目录，然后解压缩它。

```
tar -xZf mystuff.tgz 
```

它创建 ~scott/My/Stuff/Goes/，但在 Goes 下，我看到两个文件：

```
Here/ - a directory,  
Here.bGd - a zero byte file. 
```

“Here.bGd”零字节文件有一个随机的 3 字符后缀，混合大小写字符。它与 tar-creation 命令中提到的最低级目录同名。它只出现在名为的最低级别目录中。任何人都知道这些来自哪里，以及我如何调整我的 tar 创建来摆脱它们？

**更新：** 我使用 tar tZvf 检查了文件的目录： toc 没有列出零字节文件，所以我倾向于解压缩机器有问题的建议。OS X 在解压机器上是 10.5.5 版（不确定如何检查文件系统类型）。Tar 是 GNU tar 1.15.1，它是机器自带的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T18:15:13.650

您可以通过执行从 tarball 获取目录

`tar tZvf mystuff.tgz`

如果这些零字节文件列在目录中，则问题出在制作 tarball 的计算机上。如果它们未列出，则问题出在解压缩 tarball 的计算机上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-01T06:57:19.430

在我的 MacOS X (10.4.11) 机器上，我有时会在目录中获取文件 .DS_Store（但这些不是空文件），并且我在 Mac 上使用过的记忆棒上看到了其他隐藏文件名。这些在某种程度上与 Mac 文件系统有关。我猜你所看到的与这些文件集中的一个或另一个有关。原始 Mac（MacOS 9 和更早版本）具有文件的数据分支和资源分支。

稍微玩一下，发现我从来没有使用过Finder的目录没有.DS_Store文件；如果我使用 Finder 导航到该目录，则会出现 .DS_Store 文件。它可能包含有关文件应如何出现在 Finder 显示中的信息（因此，如果您四处移动文件，它们将留在您放置它们的位置）。

这并不能直接回答您的问题；我希望它能给一些指示。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T18:26:52.877

我无法在我的 10.5.5 系统上复制它。

因此，对于每个系统：

1.  您使用的是什么版本的 OSX？
2.  正在使用什么文件系统？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T18:41:16.750

在使用 tar 之前，我没有看到过这个特殊问题。但是，还有另一个问题是 tar 将元数据文件与常规文件捆绑在一起（它们具有相同的名称但以“._”为前缀）。解决这个问题的方法是设置环境变量`COPYFILE_DISABLE=y`。如果您拥有的那些奇怪的文件是更多的元数据文件，也许这也可以解决您的问题？

如果做不到这一点，您可以尝试安装不同版本的 tar。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-31T18:13:02.267

我不知道（这对 Google 来说是个难题！），但这里有一个故障排除步骤：尝试`tar`不使用`Z`. 这将确定是否`compress`或`tar`正在导致问题。

# delphi - 如何在 Delphi 中的字符串中包含换行符？

> ID：254407
> 
> 赞同：103
> 
> 时间：2008-10-31T18:10:05.080
> 
> 标签：delphi, newline

我想创建一个跨越多行的字符串以分配给标签标题属性。这在 Delphi 中是如何完成的？

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2008-10-31T21:21:14.430

在 System.pas （自动被使用）中定义了以下内容：

```
const
  sLineBreak = {$IFDEF LINUX} AnsiChar(#10) {$ENDIF} 
               {$IFDEF MSWINDOWS} AnsiString(#13#10) {$ENDIF}; 
```

这是来自 Delphi 2009（注意 AnsiChar 和 AnsiString 的使用）。（我添加的换行符。）

所以如果你想让你的 TLabel 换行，请确保 AutoSize 设置为 true，然后使用以下代码：

```
label1.Caption := 'Line one'+sLineBreak+'Line two'; 
```

自引入 sLineBreak 以来，它适用于所有版本的 Delphi，我相信这是 Delphi 6。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-10-31T18:36:03.560

这是一个更短的方法：

```
my_string := 'Hello,'#13#10' world!'; 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-10-31T18:11:56.137

`my_string := 'Hello,' + #13#10 + 'world!';`

`#13#10`是十进制的 CR/LF 字符

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-31T19:32:15.257

另一方面，一个有用的技巧：
如果您将多个字符串保存在 TStrings 中，您只需使用 TStrings 的 Text 属性，如下例所示。

```
Label1.Caption := Memo1.Lines.Text; 
```

你会得到你的多行标签......

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-31T20:18:23.230

或者您也可以使用 ^M+^J 快捷方式。所有的偏好问题。“CTRL-CHAR”代码由编译器翻译。

```
MyString := 'Hello,' + ^M + ^J + 'world!'; 
```

您可以将 ^M 和 ^J 之间的 + 去掉，但是编译器会发出警告（但它仍然可以正常编译）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-07-18T21:06:18.077

```
var
  stlst: TStringList;
begin
  Label1.Caption := 'Hello,'+sLineBreak+'world!';

  Label2.Caption := 'Hello,'#13#10'world!';

  Label3.Caption := 'Hello,' + chr(13) + chr(10) + 'world!';

  stlst := TStringList.Create;
  stlst.Add('Hello,');
  stlst.Add('world!');
  Label4.Caption := stlst.Text;

  Label5.WordWrap := True; //Multi-line Caption
  Label5.Caption := 'Hello,'^M^J'world!';

  Label6.Caption := AdjustLineBreaks('Hello,'#10'world!');
  {http://delphi.about.com/library/rtl/blrtlAdjustLineBreaks.htm}
end; 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-11-30T13:41:06.390

与平台无关的方式是“sLineBreak”： [http ://www.freepascal.org/docs-html/rtl/system/slinebreak.html](http://www.freepascal.org/docs-html/rtl/system/slinebreak.html)

写（'你好' + sLineBreak + '世界！'）;

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-01T17:01:23.970

我手头没有 Delphi 的副本，但我相当确定如果您将 wordwrap 属性设置为 true 并将 autosize 属性设置为 false，它应该以您制作标签的大小包装任何文本。如果您想在某个地方换行，那么**如果您设置上述设置并从文本编辑器粘贴，它可能会起作用**。

希望这可以帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-09T14:52:21.440

```
ShowMessage('Hello'+Chr(10)+'World'); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-04-08T20:33:47.677

您已经根据您正在使用的操作系统进行了处理`const sLineBreak`。`System.pas` `unit`

使用示例：

```
TForm1.btnInfoClick(Sender: TObject);
begin
   ShowMessage ('My name is Jhon' + sLineBreak
      'Profession: Hollywood actor');
end; 
```

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2017-08-02T20:01:29.247

有时我不想弄乱我的代码空间，尤其是对于静态标签。要在表单中定义它，请在表单上输入标签文本，然后右键单击同一表单上的任意位置。选择“以文本形式查看”。您现在将看到所有设计的对象，但仅作为文本。向下滚动或搜索您的文本。找到它后，编辑标题，使其看起来像：

Caption = '第 1 行'#13'第 2 行'#13'第 3 行'

#13 表示序数 13，或用于回车的 ascii。Chr(13) 是同样的想法，CHR() 将数字更改为序数类型。

请注意，在 Delphi 的这个特定方面没有分号，并且使用“=”而不是“:=”。每行的文本都用单引号括起来。

完成后，再次右键单击并选择“以表单形式查看”。您现在可以进行任何格式设置，例如粗体、右对齐等。您不能重新编辑表单上的文本，否则您将丢失换行符。

我还使用“以文本形式查看”进行多项更改，我只想滚动浏览并进行替换等。快速。

戴夫

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2017-10-15T18:32:20.563

```
 private
   { Private declarations }
   {declare a variable like this}
   NewLine : string; // ok
  // in next event handler assign a value to that variable (NewLine)
  // like the code down
procedure TMainForm.FormCreate(Sender: TObject);
begin`enter code here`
  NewLine := #10;
 {Next Code To show NewLine In action}
  //ShowMessage('Hello to programming with Delphi' + NewLine + 'Print New Lin now !!!!');
end; 
```

# sql - 在sql server中存储视频持续时间

> ID：254410
> 
> 赞同：4
> 
> 时间：2008-10-31T18:11:39.990
> 
> 标签：sql, sql-server, database, sql-server-2005

用于在 sql server 中存储视频的持续时间信息的最合适的类型是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T18:22:11.577

这取决于您需要的粒度以及是否对最长时间有任何限制。例如，您是否需要知道精确到毫秒的持续时间，还是 1 秒的粒度就足够了？要考虑的另一件事是您（或可以）存储多少数据。

对于 SQL Server 2005，您有以下限制：

微小的

*   最小值 = 0
*   最大值 =255
*   大小 = 1 字节

小字

*   最小值 = -2^15 (-32,768)
*   最大值= 2^15 - 1 (32,767)
*   大小 = 2 个字节

整数

*   最小值 = -2^31 (-2,147,483,648)
*   最大值 = 2^31 - 1 (2,147,483,647)
*   大小 = 4 字节

大整数

*   最小值 = -2^63 (-9,223,372,036,854,775,808)
*   最大值 = 2^63 - 1 (9,223,372,036,854,775,807)
*   大小 = 8 字节

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T18:30:26.270

有[几个选项](http://www.sqlteam.com/article/working-with-time-spans-and-durations-in-sql-server)，包括使用从特定固定零偏移的内置 DateTime 或 Time 数据类型（这将允许您使用内置日期/时间函数来获取小时、分钟和秒等。

如果您使用的是 SQL Server 2005 之前的版本，则可以将其与[用户定义的数据类型技术](http://weblogs.sqlteam.com/jeffs/archive/2004/12/02/2959.aspx)（如果您的跨度小于 24 小时）结合起来，以限制日期部分以保证不会徘徊。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-31T18:59:42.640

只需将其存储为 DateTime - 您可以获得内置的排序、格式化和计算。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T18:19:18.120

我会将其存储为表示秒数的 INT，但我想这完全取决于您需要对数据库中的信息做什么（您不希望将其转换为 HH:MM:SS 或其他在你的数据库中）

# iphone - 在 iPhone 模拟器中部署测试资源

> ID：254411
> 
> 赞同：0
> 
> 时间：2008-10-31T18:11:54.000
> 
> 标签：iphone, testing

我正在开发一个将图像存储在应用程序“文档”文件夹中的 iPhone 应用程序。

我目前正在使用 iPhone Simulator 进行大部分测试。为了帮助开发，我希望将一些测试图像预加载到我的应用程序可以访问和显示的应用程序的 Document 文件夹中。

我发现在 iPhone 模拟器中运行应用程序时，您可以通过以下方式访问应用程序文件系统

/用户//库/应用程序支持/iPhone 模拟器/用户

然后应用程序由 UID 表示，其中是 Document 文件夹。将图像放在此文件夹中，然后将它们的路径添加到我的应用程序数据库中，我可以显示测试数据。

问题是每次我构建和重新部署应用程序时，旧的应用程序文件夹都会被删除并创建一个新的应用程序文件夹，这意味着我必须将图像复制到新的应用程序文件夹并更新数据库。

有没有办法在构建和部署时自动将测试资源添加到应用程序？我是否应该将测试数据放入捆绑包中，如果是这样，有没有办法在构建实际版本时不包含测试数据？

提前谢谢了

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-31T19:14:38.973

Xcode 应该足够聪明，可以在每次构建时将任何基于 UUID 的“旧”文件夹层次结构迁移到“新”文件夹层次结构中。你没有自动看到这个动作吗？

注意：您绝对应该在这里使用动态生成的路径，而不是硬编码。使用`[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) objectAtIndex: 0];`或`[@"~/Documents" stringByExpandingTildeInPath]`获取文档文件夹的正确（当前）路径。

# asp.net - ASP.NET 图像上传与调整大小

> ID：254419
> 
> 赞同：35
> 
> 时间：2008-10-31T18:14:16.897
> 
> 标签：asp.net, image, resize, uploading

我有一个 aspx 页面，它将图像从客户端 pc 上传到服务器硬盘

但现在我需要更改我的程序，以便在上传时调整图像大小。

有人对此有任何想法吗？我无法使用输入文件服务器控件找到此类属性/方法

有人指导我吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-31T18:33:10.493

将文件保存到服务器后，您可以使用这样的代码来调整大小。此代码将处理调整大小时的长/宽比。

```
public static Bitmap CreateThumbnail(string lcFilename, int lnWidth, int lnHeight)
{

    System.Drawing.Bitmap bmpOut = null;

    try
    {
        Bitmap loBMP = new Bitmap(lcFilename);
        ImageFormat loFormat = loBMP.RawFormat;

        decimal lnRatio;
        int lnNewWidth = 0;
        int lnNewHeight = 0;

        if (loBMP.Width < lnWidth && loBMP.Height < lnHeight)
            return loBMP;

        if (loBMP.Width > loBMP.Height)
        {
            lnRatio = (decimal)lnWidth / loBMP.Width;
            lnNewWidth = lnWidth;
            decimal lnTemp = loBMP.Height * lnRatio;
            lnNewHeight = (int)lnTemp;
        }
        else
        {
            lnRatio = (decimal)lnHeight / loBMP.Height;
            lnNewHeight = lnHeight;
            decimal lnTemp = loBMP.Width * lnRatio;
            lnNewWidth = (int)lnTemp;
        }

        bmpOut = new Bitmap(lnNewWidth, lnNewHeight);
        Graphics g = Graphics.FromImage(bmpOut);
        g.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic;
        g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.HighQuality;
        g.CompositingQuality = System.Drawing.Drawing2D.CompositingQuality.HighQuality;
        g.PixelOffsetMode = System.Drawing.Drawing2D.PixelOffsetMode.HighQuality;
        g.FillRectangle(Brushes.White, 0, 0, lnNewWidth, lnNewHeight);
        g.DrawImage(loBMP, 0, 0, lnNewWidth, lnNewHeight);

        loBMP.Dispose();
    }
    catch
    {
        return null;
    }
    return bmpOut;
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-31T18:19:27.730

您将无法“即时”调整大小，因为在执行任何图像转换之前您需要拥有完整的图像。但是，在上传完成之后，在向用户显示任何结果之前，您可以使用我现在在几个应用程序中使用的这种基本的图像大小调整方法：

```
 ''' <summary>
   '''    Resize image with GDI+ so that image is nice and clear with required size.
   ''' </summary>
   ''' <param name="SourceImage">Image to resize</param>
   ''' <param name="NewHeight">New height to resize to.</param>
   ''' <param name="NewWidth">New width to resize to.</param>
   ''' <returns>Image object resized to new dimensions.</returns>
   ''' <remarks></remarks>
   Public Shared Function ImageResize(ByVal SourceImage As Image, ByVal NewHeight As Int32, ByVal NewWidth As Int32) As Image

      Dim bitmap As System.Drawing.Bitmap = New System.Drawing.Bitmap(NewWidth, NewHeight, SourceImage.PixelFormat)

      If bitmap.PixelFormat = Drawing.Imaging.PixelFormat.Format1bppIndexed Or _
          bitmap.PixelFormat = Drawing.Imaging.PixelFormat.Format4bppIndexed Or _
          bitmap.PixelFormat = Drawing.Imaging.PixelFormat.Format8bppIndexed Or _
          bitmap.PixelFormat = Drawing.Imaging.PixelFormat.Undefined Or _
          bitmap.PixelFormat = Drawing.Imaging.PixelFormat.DontCare Or _
          bitmap.PixelFormat = Drawing.Imaging.PixelFormat.Format16bppArgb1555 Or _
          bitmap.PixelFormat = Drawing.Imaging.PixelFormat.Format16bppGrayScale Then
         Throw New NotSupportedException("Pixel format of the image is not supported.")
      End If

      Dim graphicsImage As System.Drawing.Graphics = System.Drawing.Graphics.FromImage(bitmap)

      graphicsImage.SmoothingMode = Drawing.Drawing2D.SmoothingMode.HighQuality
      graphicsImage.InterpolationMode = Drawing.Drawing2D.InterpolationMode.HighQualityBicubic
      graphicsImage.DrawImage(SourceImage, 0, 0, bitmap.Width, bitmap.Height)
      graphicsImage.Dispose()
      Return bitmap

   End Function 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-08-17T08:02:23.680

这就是我在项目中所做的，根据您的条件***（高度/宽度）***，您可以更改参数，即（MaxHeight）

```
 public static System.Drawing.Image ScaleImage(System.Drawing.Image image, int maxHeight)
        {
            var ratio = (double)maxHeight / image.Height;

            var newWidth = (int)(image.Width * ratio);
            var newHeight = (int)(image.Height * ratio);

            var newImage = new Bitmap(newWidth, newHeight);
            using (var g = Graphics.FromImage(newImage))
            {
                g.DrawImage(image, 0, 0, newWidth, newHeight);
            }
            return newImage;
        } 
```

* * *

**在按钮上单击：**

```
protected void Button1_Click(object sender, EventArgs e)
{
  lblmsg.Text="";
  if ((File1.PostedFile != null) && (File1.PostedFile.ContentLength > 0))
  {
    Guid uid = Guid.NewGuid();
    string fn = System.IO.Path.GetFileName(File1.PostedFile.FileName);
    string SaveLocation = Server.MapPath("LogoImagesFolder") + "\\" + uid+fn;
    try
    {
      string fileExtention = File1.PostedFile.ContentType;
      int fileLenght = File1.PostedFile.ContentLength;
      if (fileExtention == "image/png" || fileExtention == "image/jpeg" || fileExtention == "image/x-png")
      {
        if (fileLenght <= 1048576)
        {
          System.Drawing.Bitmap bmpPostedImage = new System.Drawing.Bitmap(File1.PostedFile.InputStream);
          System.Drawing.Image objImage = ScaleImage(bmpPostedImage, 81);
          objImage.Save(SaveLocation,ImageFormat.Png);
          lblmsg.Text = "The file has been uploaded.";
          lblmsg.Style.Add("Color", "Green");
         }
         else 
         {
           lblmsg.Text = "Image size cannot be more then 1 MB.";
           lblmsg.Style.Add("Color", "Red");
          }
       }
     else {
             lblmsg.Text = "Invaild Format!";
             lblmsg.Style.Add("Color", "Red");
           }
     }
     catch (Exception ex)
       {
          lblmsg.Text= "Error: " + ex.Message;
          lblmsg.Style.Add("Color", "Red");
       }
   }
 } 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-02-23T08:54:55.757

另一种方法是允许用户在浏览器中调整大小，然后按照其他答案中的描述调整图像大小。

所以看看这个解决方案，它允许您[使用 jQuery、jCrop 和 ASP.NET 上传和裁剪图像](http://www.mikesdotnetting.com/Article/95/Upload-and-Crop-Images-with-jQuery-JCrop-and-ASP.NET)。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2014-02-16T16:47:20.670

如何仅为 .jpg 扩展调整大小和上传图像：
在 upload.aspx 页面中

```
 <asp:FileUpload ID="ProductImage" runat="server"/>
    <asp:Button ID="Button1" runat="server" OnClick="Button1_Click" Text="Upload" />
 <asp:TextBox runat="server" ID="txtProductName" CssClass="form-control" />
                        <asp:RequiredFieldValidator runat="server" ControlToValidate="txtProductName" ErrorMessage="The Product name field is required." /> 
```

并上传.aspx.cs
用于调整大小

```
/// <summary>
/// Created By Rajib Chowdhury Mob. 01766-306306; Web: http://onlineshoping.somee.com/
/// Complete This Page Coding On January 05, 2014
/// Programing C# By Visual Studio 2013 For Web
/// Dot Net Version 4.5
/// Database Virsion MSSQL Server 2005
/// </summary>
        public bool ResizeImageAndUpload(System.IO.FileStream newFile, string folderPathAndFilenameNoExtension, double maxHeight, double maxWidth)
        {
            try
            {
                // Declare variable for the conversion
                float ratio;
                // Create variable to hold the image
                System.Drawing.Image thisImage = System.Drawing.Image.FromStream(newFile);
                // Get height and width of current image
                int width = (int)thisImage.Width;
                int height = (int)thisImage.Height;
                // Ratio and conversion for new size
                if (width > maxWidth)
                {
                    ratio = (float)width / (float)maxWidth;
                    width = (int)(width / ratio);
                    height = (int)(height / ratio);
                }
                // Ratio and conversion for new size
                if (height > maxHeight)
                {
                    ratio = (float)height / (float)maxHeight;
                    height = (int)(height / ratio);
                    width = (int)(width / ratio);
                }
                // Create "blank" image for drawing new image
                Bitmap outImage = new Bitmap(width, height);
                Graphics outGraphics = Graphics.FromImage(outImage);
                SolidBrush sb = new SolidBrush(System.Drawing.Color.White);
                // Fill "blank" with new sized image
                outGraphics.FillRectangle(sb, 0, 0, outImage.Width, outImage.Height);
                outGraphics.DrawImage(thisImage, 0, 0, outImage.Width, outImage.Height);
                sb.Dispose();
                outGraphics.Dispose();
                thisImage.Dispose();
                // Save new image as jpg
                outImage.Save(Server.MapPath(folderPathAndFilenameNoExtension + ".jpg"), System.Drawing.Imaging.ImageFormat.Jpeg);
                outImage.Dispose();
                return true;
            }
            catch (Exception)
            {
                return false;
            }
        } 
```

和 Button1_Click 事件

```
 string filePath = "~\\Image\\";//your normal image path
        if (Page.IsValid)
        {
            HttpPostedFile myFile = ProductImage.PostedFile;//Get Slected Image
            int nFileLen = myFile.ContentLength;//Get slected Image Size
            string myimag = txtProductName.Text;//Get user input image name
            Guid ImageName = Guid.NewGuid();//get unique id
            if ((myFile != null) && (nFileLen > 1048576))
            {
                LabelAddStatus.Text = "minimum size exceed"; //If file image size 1 MB above
            }
            else
            {
                try
                {
                    if (ProductImage.HasFile)
                    {
                        String fileExtension = System.IO.Path.GetExtension(ProductImage.FileName).ToLower();
                        String[] allowedExtensions = { ".jpg" };//Declare For Allowed Extension
                        for (int i = 0; i < allowedExtensions.Length; i++)
                        {
                            if (fileExtension == allowedExtensions[i])
                            {
                                // Read file into a data stream
                                byte[] myData = new Byte[nFileLen];
                                myFile.InputStream.Read(myData, 0, nFileLen);
                                myFile.InputStream.Dispose();
                                // Save the stream to disk as temporary file. make sure the path is unique!
                                System.IO.FileStream newFile
                                        = new System.IO.FileStream(Server.MapPath(filePath + "_temp.jpg"),
                                                                   System.IO.FileMode.Create);
                                newFile.Write(myData, 0, myData.Length);
                                bool success = ResizeImageAndUpload(newFile, filePath + ("thumbs"+myimag + ImageName), 100, 100);//Save image your thumb image path
                                success = ResizeImageAndUpload(newFile, filePath + (myimag + ImageName), 768, 1024);//Save image your normal image path
                                //delete the temp file.
                                newFile.Close();
                                System.IO.File.Delete(Server.MapPath(filePath + "_temp.jpg"));
                                LabelAddStatus.Text = "File uploaded.";
                            }
                            else
                            {
                                LabelAddStatus.Text = "Unable to accept file type..";
                            }
                        }
                    }
                }
                catch (Exception)
                {
                    //No Exception Message
                }
            }
        } 
```

谢谢...

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-05T21:10:52.263

您需要使用 WebClient 类来下载远程图像。

之后，您可以调整它的大小...使用 DrawImage，而不是 GetThumbnailImage。确保处理掉您的位图和图形句柄..（使用 using{}）。将所有质量设置设置为高。

你可能想先看看[我流行的图像调整器的源代码](http://nathanaeljones.com/products/asp-net-image-resizer/)......它将帮助你避免一些常见的问题区域。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-26T15:49:05.623

要缩小图像并获得更小的尺寸，只需进行以下更改

```
 bmpOut = new Bitmap(lnNewWidth, lnNewHeight, **System.Drawing.Imaging.PixelFormat.Format24bppRgb**);

     Graphics g = Graphics.FromImage(bmpOut); 
```

正如您在上面将 imagem 设置为 Format24bppRgb PixelFormat。

当你保存文件时，你也设置了 ImageFormat。像这样：

```
bmpOut.Save(PathImage, System.Drawing.Imaging.ImageFormat.Jpeg); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-06T00:14:13.853

```
//Here is another WAY fox!!! i have actually modify the code from You all. HIHI
//First, add one textBox and one FileUpload Control, and a button

//paste this in your code behind file... after public partial class admin : System.Web.UI.Page

    string OriPath;
    string ImageName;

public Size NewImageSize(int OriginalHeight, int OriginalWidth, double FormatSize)
    {
        Size NewSize;
        double tempval;

        if (OriginalHeight > FormatSize && OriginalWidth > FormatSize)
        {
            if (OriginalHeight > OriginalWidth)
                tempval = FormatSize / Convert.ToDouble(OriginalHeight);
            else
                tempval = FormatSize / Convert.ToDouble(OriginalWidth);

            NewSize = new Size(Convert.ToInt32(tempval * OriginalWidth), Convert.ToInt32(tempval * OriginalHeight));
        }
        else
            NewSize = new Size(OriginalWidth, OriginalHeight); return NewSize;
    } 

//Now, On Button click add the folwing code.

if (FileUpload1.PostedFile != null)
        {
           ImageName = TextBox1.Text+".jpg";

           OriPath = Server.MapPath("pix\\") + ImageName;

           //Gets the Full Path using Filecontrol1 which points to actual location in the hardisk :)

           using (System.Drawing.Image Img = System.Drawing.Image.FromFile(System.IO.Path.GetFullPath(FileUpload1.PostedFile.FileName)))
           {
               Size ThumbNailSize = NewImageSize(Img.Height, Img.Width, 800);

               using (System.Drawing.Image ImgThnail = new Bitmap(Img, ThumbNailSize.Width, ThumbNailSize.Height))
               {
                   ImgThnail.Save(OriPath, Img.RawFormat);
                   ImgThnail.Dispose();
               }
               Img.Dispose();
           }
}

//Enjoy. If any problem,, mail me at izacmail@gmail.com 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-02-22T17:34:35.857

你可以用这个，它对我来说很不错。但它对我来说不能很好地处理低分辨率图像。谢天谢地，我已经习惯了其中的许多人。只需将图像`byte[]`和预期输出发送给它，您就可以开始了。

```
public static byte[] ResizeImageFile(byte[] imageFile, int targetSize) 
{ 
    using (System.Drawing.Image oldImage = System.Drawing.Image.FromStream(new MemoryStream(imageFile))) 
    { 
        Size newSize = CalculateDimensions(oldImage.Size, targetSize); 

        using (Bitmap newImage = new Bitmap(newSize.Width, newSize.Height, PixelFormat.Format32bppRgb)) 
        { 
            newImage.SetResolution(oldImage.HorizontalResolution, oldImage.VerticalResolution); 
            using (Graphics canvas = Graphics.FromImage(newImage)) 
            { 
                canvas.SmoothingMode = SmoothingMode.AntiAlias; 
                canvas.InterpolationMode = InterpolationMode.HighQualityBicubic; 
                canvas.PixelOffsetMode = PixelOffsetMode.HighQuality; 
                canvas.DrawImage(oldImage, new Rectangle(new Point(0, 0), newSize)); 
                MemoryStream m = new MemoryStream(); 
                newImage.Save(m, ImageFormat.Jpeg); 
                return m.GetBuffer(); 
            } 
        } 

    } 
} 

private static Size CalculateDimensions(Size oldSize, int targetSize) 
{ 
    Size newSize = new Size(); 
    if (oldSize.Width > oldSize.Height) 
    { 
        newSize.Width = targetSize; 
        newSize.Height = (int)(oldSize.Height * (float)targetSize / (float)oldSize.Width); 
    } 
    else 
    { 
        newSize.Width = (int)(oldSize.Width * (float)targetSize / (float)oldSize.Height); 
        newSize.Height = targetSize; 
    } 
    return newSize; 
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-31T18:50:37.917

```
using System.IO;
using System.Drawing;
using System.Drawing.Imaging;

public partial class admin_AddPhoto : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {

        string reportPath = Server.MapPath("../picnic");

        if (!Directory.Exists(reportPath))
        {
            Directory.CreateDirectory(Server.MapPath("../picnic"));
        }
    }

    protected void PhotoForm_ItemInserting(object sender, FormViewInsertEventArgs e)
    {
        FormView uploadForm = sender as FormView;
        FileUpload uploadedFile = uploadForm.FindControl("uploadedFile") as FileUpload;

        if (uploadedFile != null)
        {
            string fileName = uploadedFile.PostedFile.FileName;
            string pathFile = System.IO.Path.GetFileName(fileName);

            try
            {
                uploadedFile.SaveAs(Server.MapPath("../picnic/") + pathFile);
            }
            catch (Exception exp)
            {
                //catch exception here
            }

            try
            {
                Bitmap uploadedimage = new Bitmap(uploadedFile.PostedFile.InputStream);

                e.Values["ImageWidth"] = uploadedimage.Width.ToString();
                e.Values["ImageHeight"] = uploadedimage.Height.ToString();
                // Make output File Name
                char[] splitter = { '.' };
                string[] splitFile = pathFile.Split(splitter);
                string OutputFilename = splitFile[0] + "s";

                System.Drawing.Image.GetThumbnailImageAbort myCallback = new System.Drawing.Image.GetThumbnailImageAbort(ThumbnailCallback);
                System.Drawing.Image thumbImage = uploadedimage.GetThumbnailImage(74, 54, myCallback, IntPtr.Zero);
                thumbImage.Save(Server.MapPath("../picnic/") + OutputFilename + ".jpg");
                e.Values["Thumbnail"] = "./picnic/" + OutputFilename + ".jpg";
            }
            catch (Exception ex)
            {
                //catch exception here
            }

            e.Values["Pic"] = "./picnic/" + pathFile;
            e.Values["Url"] = "./picnic/" + pathFile;
            e.Values["dateEntered"] = DateTime.Now.ToString();
        }
    }

    public bool ThumbnailCallback()
    {
        return false;
    }
} 
```

这使用 FileUpload 和 FormView 来插入。然后我使用 System.Drawing.Imaging 中提供的[GetThumnailImage()](http://msdn.microsoft.com/en-us/library/system.drawing.image.getthumbnailimage.aspx)方法。您可以输入任何宽度和高度值，它会相应地收缩/拉伸。

```
uploadedimage.GetThumbnailImage(W, H, myCallback, IntPtr.Zero); 
```

希望这可以帮助。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-31T20:16:21.050

您可以在使用 ActiveX 控件发送到服务器之前调整大小。这里有一个免费的 ASP.net 图片上传组件（我相信这与 Facebook 实际使用的组件相同）：

[http://forums.aurigma.com/yaf_postst2145_Image-Uploader-ASPNET-Control.aspx](http://forums.aurigma.com/yaf_postst2145_Image-Uploader-ASPNET-Control.aspx)

让我知道它是否有效，我正在考虑在我的工作项目中实施它。

编辑：看起来对象的包装器是免费的，但实际组件本身将花费您大约 200 美元。我确认它与 Facebook 使用的组件相同。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-08-09T05:28:27.867

图像文件的上传由 ASP.NET 4.0 客户端回调执行。如果您不熟悉客户端回调，那么我建议您查看 ASP.Net AJAX Control Toolkit AsyncFileUpload Control without page refresh or PostBack in ASP.Net Web Page 或 ASP.Net AJAX Update Panel。一旦用户使用文件字段控件选择文件，就会触发回调。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-10-09T19:40:36.350

```
public string ResizeImageAndSave(int Width, int Height, string imageUrl, string destPath)
    {
        System.Drawing.Image fullSizeImg = System.Drawing.Image.FromFile(imageUrl);
 double widthRatio = (double)fullSizeImg.Width / (double)Width;
  double heightRatio = (double)fullSizeImg.Height / (double)Height;
  double ratio = Math.Max(widthRatio, heightRatio);
 int newWidth = (int)(fullSizeImg.Width / ratio);
 int newHeight = (int)(fullSizeImg.Height / ratio);
        //System.Drawing.Image.GetThumbnailImageAbort dummyCallBack = new System.Drawing.Image.GetThumbnailImageAbort(ThumbnailCallback);
        System.Drawing.Image thumbNailImg = fullSizeImg.GetThumbnailImage(newWidth, newHeight, new System.Drawing.Image.GetThumbnailImageAbort(ThumbnailCallback), IntPtr.Zero);
 //DateTime MyDate = DateTime.Now;
 //String MyString = MyDate.ToString("ddMMyyhhmmss") + imageUrl.Substring(imageUrl.LastIndexOf("."));
 thumbNailImg.Save(destPath, ImageFormat.Jpeg);
 thumbNailImg.Dispose();
        return "";
    }
    public bool ThumbnailCallback() { return false; } 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2012-02-15T07:22:11.707

```
private void ResizeImage(FileUpload fileUpload)
{
    // First we check to see if the user has selected a file
    if (fileUpload.HasFile)
    {
        // Find the fileUpload control
        string filename = fileUpload.FileName;

        // Check if the directory we want the image uploaded to actually exists or not
        if (!Directory.Exists(MapPath(@"Uploaded-Files")))
        {
            // If it doesn't then we just create it before going any further
            Directory.CreateDirectory(MapPath(@"Uploaded-Files"));
        }
        // Specify the upload directory
        string directory = Server.MapPath(@"Uploaded-Files\");

        // Create a bitmap of the content of the fileUpload control in memory
        Bitmap originalBMP = new Bitmap(fileUpload.FileContent);

        // Calculate the new image dimensions
        int origWidth = originalBMP.Width;
        int origHeight = originalBMP.Height;
        int sngRatio = origWidth / origHeight;
        int newWidth = 100;
        int newHeight = newWidth / sngRatio;

        // Create a new bitmap which will hold the previous resized bitmap
        Bitmap newBMP = new Bitmap(originalBMP, newWidth, newHeight);

        // Create a graphic based on the new bitmap
        Graphics oGraphics = Graphics.FromImage(newBMP);
        // Set the properties for the new graphic file
        oGraphics.SmoothingMode = SmoothingMode.AntiAlias; 
        oGraphics.InterpolationMode = InterpolationMode.HighQualityBicubic;

        // Draw the new graphic based on the resized bitmap
        oGraphics.DrawImage(originalBMP, 0, 0, newWidth, newHeight);
        // Save the new graphic file to the server
        newBMP.Save(directory + "tn_" + filename);

        // Once finished with the bitmap objects, we deallocate them.
        originalBMP.Dispose();
        newBMP.Dispose();
        oGraphics.Dispose();

        // Write a message to inform the user all is OK
        label.Text = "File Name: <b style='color: red;'>" + filename + "</b><br>";
        label.Text += "Content Type: <b style='color: red;'>" + fileUpload.PostedFile.ContentType + "</b><br>";
        label.Text += "File Size: <b style='color: red;'>" + fileUpload.PostedFile.ContentLength.ToString() + "</b>";

        // Display the image to the user
        Image1.Visible = true;
        Image1.ImageUrl = @"Uploaded-Files/tn_" + filename;
    }
    else
    {
        label.Text = "No file uploaded!";
    }
} 
```

# wcf - 你将只有自治服务

> ID：254423
> 
> 赞同：4
> 
> 时间：2008-10-31T18:17:06.033
> 
> 标签：wcf, soa

SOA 的原则之一是：“服务是自治的”。我有 2 项服务。服务 A 依赖于服务 B。除非服务 B 启动并运行，否则服务 A 无法为客户端提供服务。我违反了这里的原则吗？

或者，如果自治必须意味着“解耦”，如果我有故障保护（比如在其他地方运行的另一个服务 B 实例，如果主实例关闭，则连接到该实例），我是否满足该原则？这可能满足我的可用性要求，但我不确定这如何减少我的依赖。是的，故障保险甚至可能是来自第三方的服务 C，在这种情况下，我确实提高了我的自主权。

或者这个原则是否仅仅意味着服务必须被设计为“fifedoms”，具有明确定义的接口来输入和输出数据。然而，一些大师似乎认为您甚至需要在内部存储您收到的这些数据，以减少依赖并保持您的自主权......

如果我将服务视为带有消息传递的组件，这是否是一个错误？:)

想法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-31T18:54:04.850

[请参阅SOA 原则](http://sendhil.spaces.live.com/blog/cns!30862CF919BD131A!449.entry)上的这篇文章。另请参阅[自治服务的分形星座](http://blogs.msdn.com/richardt/archive/2005/05/20/420650.aspx)。

“服务的部署、管理和版本控制应独立于依赖于它们的其他服务和/或应用程序。”

自治并不意味着孤立或完全独立。

相反，您可能有两个服务的“星座”。是的，它们相互依赖。不，当 B 移动或升级时，A 不会中断。当 B 的非接口内部发生变化时，A 也不会中断。

同样——从 B 的角度来看——升级到 A 的内部结构并不会影响 B 的接口和内部结构的变化。

API 独立发展。架构、消息和实现是独立的。他们只是碰巧互相引用。

“除非服务 B 启动并运行，否则服务 A 无法为客户提供服务”——别担心。如果服务 A 宕机，它也无法为客户提供服务。服务中断是个问题。B（A所依赖的）或A无关紧要。依赖与A或B是否可靠或可用无关。

是的，服务具有定义明确且独立的接口。A的*实现*依赖于 B，但接口不依赖于 B。

* * *

编辑。

“一些大师似乎认为你甚至需要在内部存储你收到的这些数据，以减少依赖并保持你的自主权......”

看不出重点。如果 A 依赖于 B，并且 B 的算法发生变化，则 A 的 B 数据副本是--嗯-- 旧的。 *Depends-on*通常意味着一种生活的、工作的、由交易完成的关系。

问题是B可能很慢，这使得A变慢，这使得使用A的应用程序变慢。真可惜。但这并不是要求打破自治规则并让 A 为 B 保留旧数据的秘密缓存。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T18:41:01.833

只有拥有后备服务才能*提高*您的自主权。如果服务 B 和 C 都出现故障怎么办？然后你的服务就会下降。您可以通过缓存来自外部服务的结果来进一步提高您的自主性（和您的性能）。这样，如果 B 和 C 出现故障，您仍然可以使用缓存结果为您的*一些客户端提供服务。*但是，只要您依赖 3rd 方服务，您就永远无法实现 100% 的自主权。

# c# - LastAccess 时间不正确

> ID：254438
> 
> 赞同：3
> 
> 时间：2008-10-31T18:24:37.377
> 
> 标签：c#, fileinfo, lastaccesstime

每次我创建一个 FileInfo 对象并访问它的 lastaccesstime 属性时，它总是有几分钟的时间。文件属性窗口保持不变，但应用程序显示它通常在属性窗口时间之后几分钟。

另外，我注意到如果我将文件拖到 cmd 窗口以将文件名作为参数传递，访问时间大部分时间都会更新，但并非总是如此。

是什么原因造成的？

下面是一个例子：

```
static void Main(string[] args)
{
    if (args.Length > 0)
    {
        FileInfo fi = new FileInfo(args[0].ToString());
        Console.WriteLine(args[0]);
        if (fi.Exists)
        {
            Console.Write("Current: " + DateTime.Now + "\n");
            Console.Write("LAT: " + fi.LastAccessTime + "\n");
            Console.Write("LWT: " + fi.LastWriteTime + "\n");
            Console.Write("CT: " + fi.CreationTime + "\n");
        }
        Console.ReadKey();
    }
} 
```

[替代文字 http://img407.imageshack.us/img407/4728/propertiesox6.png](http://img407.imageshack.us/img407/4728/propertiesox6.png) [替代文字 http://img380.imageshack.us/img380/7752/appgt0.png](http://img380.imageshack.us/img380/7752/appgt0.png)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-02T19:49:11.243

以我的经验，上次访问时间是出了名的不可靠。根据[http://technet.microsoft.com/en-us/library/cc781134.aspx](http://technet.microsoft.com/en-us/library/cc781134.aspx) ...

> 磁盘上的上次访问时间并不总是最新的，因为 NTFS 在强制上次访问时间更新到磁盘之前会查找一小时的时间间隔。当用户或程序对文件或文件夹执行只读操作（例如列出文件夹的内容或读取（但不更改）文件夹中的文件）时，NTFS 还会延迟将上次访问时间写入磁盘。

Apparently, the in-memory copy will be correct, but in my experience, you may get a cached value which may be out of date. Also, note that last access time may be turned off by the user, and is turned off by default in Vista and 2008.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-01T01:17:27.400

[包含有关文件时间的基本信息的 MSDN 文章有](http://msdn.microsoft.com/en-us/library/ms724290(VS.85).aspx)关于文件时间分辨率和上次访问时间的说明：

> 例如，在 FAT 上，创建时间的分辨率为 10 毫秒，写入时间的分辨率为 2 秒，访问时间的分辨率为 1 天（实际上是访问日期）。NTFS 将文件的最后一次访问时间的更新延迟到最后一次访问后一小时。

这意味着在 FAT 和 NTFS 上，最后写入时间通常不会很精确，尽管我不确定它们引用的确切值是否正确。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T18:49:45.997

嗯，这可能[来自 MSDN](http://msdn.microsoft.com/en-us/library/system.io.filesysteminfo.lastaccesstime.aspx)：

> 首次调用时，FileSystemInfo 调用 Refresh 并返回 API 上的缓存信息以获取属性等。在随后的调用中，您必须调用 Refresh 以获取信息的最新副本。

但是您看到 LAT 总是在 [未来|过去] 的几分钟内？

# java - HashSet.remove() 和 Iterator.remove() 不起作用

> ID：254441
> 
> 赞同：42
> 
> 时间：2008-10-31T18:25:44.923
> 
> 标签：java, collections

我在 HashSet 上调用 Iterator.remove() 时遇到问题。

我有一组带有时间戳的对象。在将新项目添加到集合之前，我会遍历集合，识别该数据对象的旧版本并将其删除（在添加新对象之前）。时间戳包含在 hashCode 和 equals() 中，但不包含在 equalsData() 中。

```
for (Iterator<DataResult> i = allResults.iterator(); i.hasNext();)
{
    DataResult oldData = i.next();
    if (data.equalsData(oldData))
    {   
        i.remove();
        break;
    }
}
allResults.add(data) 
```

奇怪的是，对于集合中的某些项目， i.remove() 会默默地失败（也不例外）。我已验证

*   实际上调用了 i.remove() 行。我可以直接在 Eclipse 的断点处从调试器调用它，但它仍然无法更改 Set 的状态

*   DataResult 是一个不可变对象，因此它在最初添加到集合后不能更改。

*   equals 和 hashCode() 方法使用 @Override 来确保它们是正确的方法。单元测试验证这些工作。

*   如果我只使用 for 语句和 Set.remove 代替，这也会失败。（例如，遍历项目，在列表中找到项目，然后在循环后调用 Set.remove(oldData)）。

*   我已经在 J​​DK 5 和 JDK 6 中进行了测试。

我以为我一定错过了一些基本的东西，但是在花了一些时间在这上面之后，我的同事和我被难住了。有什么建议要检查吗？

编辑：

有一些问题 - DataResult 真的是不可变的。是的。没有二传手。并且当检索到 Date 对象（这是一个可变对象）时，它是通过创建一个副本来完成的。

```
public Date getEntryTime()
{
    return DateUtil.copyDate(entryTime);
}

public static Date copyDate(Date date)
{
    return (date == null) ? null : new Date(date.getTime());
} 
```

进一步编辑（一段时间后）：记录在案——DataResult 不是不可变的！它引用了一个对象，该对象的哈希码在持久保存到数据库时会发生变化（我知道这是不好的做法）。事实证明，如果 DataResult 是使用瞬态子对象创建的，并且子对象被持久化，则 DataResult 哈希码已更改。

非常微妙——我看了很多次，并没有注意到缺乏不变性。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-11-01T23:27:26.560

我仍然对这个很好奇，并编写了以下测试：

```
import java.util.HashSet;
import java.util.Iterator;
import java.util.Random;
import java.util.Set;

public class HashCodeTest {
    private int hashCode = 0;

    @Override public int hashCode() {
        return hashCode ++;
    }

    public static void main(String[] args) {
        Set<HashCodeTest> set = new HashSet<HashCodeTest>();

        set.add(new HashCodeTest());
        System.out.println(set.size());
        for (Iterator<HashCodeTest> iter = set.iterator();
                iter.hasNext();) {
            iter.next();
            iter.remove();
        }
        System.out.println(set.size());
    }
} 
```

这导致：

```
1
1 
```

如果一个对象的 hashCode() 值在添加到 HashSet 后发生了变化，它似乎会使该对象无法移除。

我不确定这是否是您遇到的问题，但是如果您决定重新访问此内容，则需要研究一下。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-01T05:01:56.527

在幕后，HashSet 使用 HashMap，它在调用 HashSet.remove(Object) 或 Iterator.remove() 时调用 HashMap.removeEntryForKey(Object)。此方法同时使用 hashCode() 和 equals() 来验证它正在从集合中删除正确的对象。

如果 Iterator.remove() 和 HashSet.remove(Object) 都不起作用，那么您的 equals() 或 hashCode() 方法肯定有问题。发布这些代码将有助于诊断您的问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-01T03:37:23.670

您绝对确定 DataResult 是不可变的吗？时间戳的类型是什么？如果`java.util.Date`是你在初始化 DataResult 时复制它吗？请记住，这`java.util.Date`是可变的。

例如：

```
Date timestamp = new Date();
DataResult d = new DataResult(timestamp);
System.out.println(d.getTimestamp());
timestamp.setTime(System.currentTimeMillis());
System.out.println(d.getTimestamp()); 
```

将打印两次不同的时间。

如果您可以发布一些源代码，这也会有所帮助。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-01T21:02:47.540

感谢所有的帮助。我怀疑问题一定出在 spencerk 所建议的 equals() 和 hashCode() 上。我确实在调试器和单元测试中检查了这些，但我必须遗漏一些东西。

我最终做了一个解决方法——将除一个之外的所有项目复制到一个新集合中。对于踢球，我使用了 Apache Commons CollectionUtils。

```
 Set<DataResult> tempResults = new HashSet<DataResult>();
    CollectionUtils.select(allResults, 
            new Predicate()
            {
                public boolean evaluate(Object oldData)
                {
                    return !data.equalsData((DataResult) oldData);
                }
            }
            , tempResults);
    allResults = tempResults; 
```

我将在这里停下来——太多的工作无法简化为一个简单的测试用例。但是非常感谢您的帮助。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-02-28T21:45:15.583

您都应该小心任何通过哈希码获取其子代的 Java 集合，以防其子类型的哈希码取决于其可变状态。一个例子：

```
HashSet<HashSet<?>> or HashSet<AbstaractSet<?>> or HashMap variant: 
```

HashSet 通过它的 hashCode 来检索一个 item，但是它的 item 类型是一个 HashSet，而 hashSet.hashCode 取决于它的 item 的 state。

与此相关的代码：

```
HashSet<HashSet<String>> coll = new HashSet<HashSet<String>>();
HashSet<String> set1 = new HashSet<String>();
set1.add("1");
coll.add(set1);
print(set1.hashCode()); //---> will output X
set1.add("2");
print(set1.hashCode()); //---> will output Y
coll.remove(set1) // WILL FAIL TO REMOVE (SILENTLY) 
```

原因是 HashSet 的 remove 方法使用 HashMap 并且它通过 hashCode 识别键，而 AbstractSet 的 hashCode 是动态的并且取决于其自身的可变属性。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-31T18:40:22.833

你有没有尝试过类似的东西

```
boolean removed = allResults.remove(oldData)
if (!removed) // COMPLAIN BITTERLY! 
```

换句话说，从 Set 中移除对象并打破循环。这不会引起`Iterator`抱怨。我不认为这是一个长期的解决方案，但可能会给你一些关于`hashCode`,`equals`和`equalsData`方法的信息

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-03T17:26:12.890

几乎可以肯定，哈希码与“equals()”的新旧数据不匹配。我以前遇到过这种事情，你基本上最终会为每个对象和字符串表示吐出哈希码，并试图找出不匹配发生的原因。

如果您正在比较项目前/后数据库，有时它会丢失纳秒（取决于您的数据库列类型），这可能会导致哈希码发生变化。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-08-04T00:05:02.993

Java HashSet 在“remove()”方法中存在问题。检查下面的链接。我切换到 TreeSet，它工作正常。但我需要 O(1) 时间复杂度。

[https://bugs.openjdk.java.net/browse/JDK-8154740](https://bugs.openjdk.java.net/browse/JDK-8154740)

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-11-01T03:36:36.323

如果有两个具有相同数据的条目，则只替换其中一个...您对此进行了说明吗？以防万一，您是否尝试过另一种不使用哈希码的集合数据结构，例如列表？

* * *

## 回答 #10

> 赞同：-4
> 
> 时间：2008-11-01T06:40:19.480

我的 Java 跟不上速度，但我知道当您在 .NET 中迭代该集合时，您无法从集合中删除一个项目，尽管 .NET 会在捕获到这一点时抛出异常。这可能是问题吗？

# winforms - .net windows 窗体和选择 Vista 字体

> ID：254449
> 
> 赞同：3
> 
> 时间：2008-10-31T18:27:38.447
> 
> 标签：winforms, fonts

我正在使用 Windows 窗体构建一个 .net 应用程序。我正在思考以下问题：如果我在应用程序中指定了仅在 Vista 和 Office 07 中可用的字体，当应用程序尝试在没有这些的机器上运行时会发生什么？

我想系统将无法回退到它的家族字体，因为它们是使用字符串在内部初始化的（例如“Segoe UI”）。

要遵循的最佳做法是什么，这样我仍然可以通过表单设计器指定字体，而不必担心这样的问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T18:36:38.083

检查操作系统并在 XP 上使用 Tahoma，在 Vista 上使用 Segoe UI，或者让用户在选项对话框中进行选择。在 XP 上安装 Segoe UI 似乎被大多数人认为没有完成。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T19:09:51.653

我认为这是`System.Drawing.SystemFonts.MessageBoxFont`根据操作系统提供 Segoe UI、Tahoma 和 MS Sans Serif 的原因。只要你的布局足够流畅——WPF 擅长这一点，但在 Windows 窗体中它更难——那么它就会很好用。无论如何，值得使用该设置然后在虚拟机中进行测试以查看它是否有效。

同样不幸的是，设计师不支持这样设置字体，有时它会将东西重置为硬编码的 Segoe UI（如果您使用的是 Vista）。

这种事情实际上是我开始转向 WPF 的原因之一 :)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T18:38:19.563

我同意 Brian Cline 的观点，如果你能把它们包括在内，那将是最好的。

查看干净操作系统会发生什么的一个好方法是在您的系统上启动虚拟机并在其上安装程序。Microsoft 有一个名为“Microsoft Virtual PC”的免费虚拟机程序。使用它，您可以在虚拟机中加载任何操作系统并测试您的应用程序在“干净”安装环境中的反应。它的作用与普通计算机相同，并且只有您专门安装的程序。我将它用于我的 winforms 应用程序，效果很好！

让我知道这是否有帮助！联合部队

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T19:15:59.563

要么接受 Jasper 的建议，要么听从我的建议：不要这样做。除非您出于某种原因重新设计整个应用程序，否则只需使用系统上已定义的字体即可。如果你看起来像所有其他战舰灰色（或温和主题）应用程序，除了字体，它对用户来说看起来有点奇怪。

无论哪种方式，包括字体都是违反 EULA 的。用户可以下载 Office 2007 兼容包并获得*其中*的大部分，但一个值得注意的例外是（我相信）Segoe UI：这种字体是仅适用于 Vista 的字体。

如果您确实想与众不同，那么请听从 Jasper 的建议并检测 XP 与 Vista。如果您使用的是 XP，请使用 Tahoma 或 Trebuchet MS。如果您使用的是 Vista，请继续使用酷炫的新字体。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-31T18:31:19.467

首先在 Office 和 Vista 中检查 EULA 以确保字体不是神圣的，但您可以将这些字体包含在安装程序包中并让它安装它们。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-31T19:07:45.900

除非能够在安装程序中重新分配字体，否则您可能必须首先检查所述字体是否存在。如果它们不存在，请让您的应用从备用选项的静态列表中选择替代字体。

# sql - MS SQL 中对象的模式、所有者

> ID：254451
> 
> 赞同：21
> 
> 时间：2008-10-31T18:29:00.830
> 
> 标签：sql, sql-server, sql-server-2005, sql-server-2000

默认情况下，对象（表、存储过程等）使用 dbo 所有者/模式设置（我认为 ms sql 2000 将其称为所有者，而 ms sql 2005 将其称为模式）

所有者/模式实际上是数据库中的角色或用户。我一直保留 dbo 的默认值，但我最近在微软培训书籍中看到了一些示例，其中一些表和存储过程具有不同的所有者/模式。什么时候这样做有好处，为什么？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-31T19:22:34.077

当您有安全问题时，使用模式非常有用。

如果您有多个访问数据库的应用程序，您可能不想让后勤部门访问人力资源记录。因此，您将所有 Human Resources 表放入 hr 模式中，并且只允许 hr 角色中的用户访问它。

六个月后，物流现在需要知道内部费用账户，以便他们可以将所有这些蓝色笔调色板发送给正确的位置人员。然后，您可以创建一个存储过程，该过程以有权查看 hr 模式和物流模式的用户身份执行。物流用户永远不需要知道 HR 中发生了什么，但他们仍然可以获得他们的数据。

您还可以按照 cfeduke 建议的方式使用模式，并仅使用它们在对象浏览器中对事物进行分组。如果你正在这样做，请小心，因为当你真的只需要一个 dbo.Address 时，你可能最终会创建 Person.Address 和 Company.Address（我不是在敲你的例子，cfeduke，只是用它来说明两者地址表可能相同，也可能不同，并且 YMMV）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-31T18:38:34.413

在 SQL 2000 中，模式相当于数据库用户，在 SQL 2005 中，每个模式都是一个不同的命名空间，独立于创建它的数据库用户而存在。

当我需要制作稍后可能会在其他项目中使用的功能或模块时，我会使用模式，因此我将能够隔离模块使用的数据库对象。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-31T18:44:58.207

我在过去使用过类似于命名空间的模式，因此您可以拥有多个名为 Address ( `[Person].[Address]`, `[Company].[Address]`) 的实体。这样做的好处是 SQL Management Studio 中的可视化组织，您可以通过将所有内容放在一个模式下并使用单个标识符（即`[dbo].[PersonAddress]`）命名表来获得相同的结果。

在我们所有的开发机器上运行 SQL Server Developer Edition 之前，我也将它们用于开发人员与开发人员的开发（早在我职业生涯早期我们有一个集中式开发数据库时）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-31T18:34:46.513

组织

在开发环境中，对象的生产副本是 dbo，但开发人员可以在自己的模式中开发。然后代码可以非常简单地引用产品副本或其更改。使用别名可以使这项技术更加简单。

* * *

此外，生产数据库可能支持许多系统或子系统。您可以使用不同的模式将这些对象分组。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-01T01:19:11.390

[This article](http://www.sqlteam.com/article/understanding-the-difference-between-owners-and-schemas-in-sql-server) explains it well, including the changes from SQL Server 2000 to 2005.

# bash - chroot + execvp + bash

> ID：254458
> 
> 赞同：8
> 
> 时间：2008-10-31T18:32:50.417
> 
> 标签：bash, chroot

**更新**

*知道了！查看我的解决方案（第五条评论）*

这是我的问题：

我创建了一个名为“jail”的小型二进制文件，并在 /etc/password 中将其设置为测试用户的默认 shell。

这是--简化的--源代码：

```
#define HOME "/home/user"
#define SHELL "/bin/bash"
...
if(chdir(HOME) || chroot(HOME)) return -1;
...
char *shellargv[] = { SHELL, "-login", "-rcfile", "/bin/myscript", 0 };
execvp(SHELL, shellargv); 
```

好吧，无论我多么努力，似乎当我的测试用户登录时，*/bin/myscript*将永远不会被获取。同样，如果我将`.bashrc`文件放在用户的主目录中，它也会被忽略。

为什么bash会势利这些家伙？

--

一些精度，不一定相关，但要清除评论中提出的一些观点：

*   'jail' 二进制文件实际上是 suid，因此允许它成功 chroot()。
*   我已经使用 'ln' 来提供适当的二进制文件 - 我的牢房被很好地填充了 :)
*   问题似乎与 chrooting 用户无关……还有其他事情是疏忽的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-31T18:56:49.667

正如 Jason C 所说，被执行的 shell 不是交互式的。

他的解决方案将强制 shell 进行交互，如果它接受`-i`意味着（并且 bash 确实如此）：

```
char *shellargv[] = { SHELL, "-i", "-login", ... };
execvp(SHELL, shellargv); 
```

`ARGV[0]`不过，我想补充一点，传统上，如果以破折号开头，shell 将充当登录 shell 。

```
char *shellargv[] = {"-"SHELL, "-i", ...};
execvp(SHELL, shellargv); 
```

但是，通常 Bash 会自动检测它是否应该以交互方式运行。在您的情况下，它的失败可能是因为缺少`/dev/*`节点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T19:05:18.620

我可以确定自己想要这样做，但如果您还没有这样做，请查看[jail chroot 项目](http://www.jmcresearch.com/projects/jail/)和[jailkit](http://olivier.sessink.nl/jailkit/index.html#intro)以获取一些用于创建 jail shell 的工具。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-31T18:36:24.467

外壳不是交互式的。尝试将 -i 添加到参数列表中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T21:23:21.493

谢谢你们的帮助，伙计们，

我想到了：

我忘了**setuid()/setgid()** , chroot(), setuid()/setgid() 回来，然后使用 execve() 传递适当的环境

哦，而且，如果我不向 bash 传递任何参数，它将源*~/.bashrc*

如果我通过“-l”如果将来源*/etc/profile*

干杯!

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-31T19:02:54.770

当您的用户登录并且他们的 shell 尝试获取此文件时，它已在他们的 UID 下运行。系统`chroot()`调用只能由 root 使用——你需要比这更聪明。

此外，chroot 到用户的主目录将使他们的 shell 无用，因为（除非他们在那里有很多东西）他们将无法访问任何二进制文件。例如，有用的东西`ls`。

# c# - .NET：如何获得空对象的类型？

> ID：254461
> 
> 赞同：35
> 
> 时间：2008-10-31T18:33:18.183
> 
> 标签：c#, .net, types, gettype

我有一个带有 out 参数的方法，它尝试进行类型转换。基本上：

```
public void GetParameterValue(out object destination)
{
    object paramVal = "I want to return this. could be any type, not just string.";

    destination = null; // default out param to null
    destination = Convert.ChangeType(paramVal, destination.GetType());
} 
```

问题是通常有人会这样称呼：

```
string output;
GetParameterValue(output); 
```

这将失败，因为：

```
destination.GetType() 
```

目的地为空，所以我们不能调用`.GetType()`它。我们也不能调用：

```
typeof(destination) 
```

因为目的地是变量名而不是类型名。

那么有什么方法可以获取设置为 null 的对象的类型吗？我认为必须有一种方法可以知道存储位置的类型，而无需为其分配任何东西。

* * *

只是为了提供更多信息，我正在尝试制作一个实用方法来获取 Oracle 存储过程的输出参数。问题是`DbParameter.Value`对象类型。

对于开发人员来说，理想的做法是：

```
string val = GetParameterValue("parameterName"); 
```

值得注意的是，没有类型转换。在实践中，您不知道“等于”的 lparam，所以我选择了：

```
string val;
GetParameterValue("parameterName", out val); 
```

在方法中，我会知道输出变量的目标类型。我想这是一个糟糕的假设。作为替代方案，我还编写了该方法：

```
public T GetParameterValue<T>(string paramName) 
```

所以开发人员可以这样做：

```
string val = GetParameterValue<string>("parameterName"); 
```

我发现明确的“字符串”声明是重复的，特别是因为在实践中，目标可能是对象属性和 oracle 数据类型可能会改变（想想 ORM）：

```
MyObj.SomeProp = GetParameterValue<MyObj.SomeProp.GetType()>("parameterName"); 
```

但同样，如果 MyObj.SomeProp 为空，则该`.GetType()`调用将失败。VM 必须知道 的类型`MyObj.SomeProp`，即使它为空，对吗？否则它将如何捕获强制转换异常？

* * *

为了部分解决我自己的问题，我可以这样做：

```
MyObj.SomeProp = GetParameterValue<typeof(MyObj).GetField("SomeProp").GetType()>("parameterName"); 
```

整个想法是不必在多个地方显式使用 Type，因此如果数据类型发生变化，只需在目标对象 ( `MyObj.SomeProp`) 和 DB 中进行更改。一定有更好的方法...

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-31T18:43:39.863

> 那么有什么方法可以获取设置为 null 的对象的类型吗？我认为必须有一种方法可以知道存储位置的类型，而无需为其分配任何东西。

不必要。你能说的最好的就是它是一个`object`. 引用不指向任何`null`存储位置，因此没有元数据可以从中做出决定。

您可以做的最好的事情是将其更改为更通用，例如：

```
public void GetParameterValue<T>(out T destination)
{
    object paramVal = "Blah";
    destination = default(T);
    destination = Convert.ChangeType(paramVal, typeof(T));
} 
```

可以推断出的类型`T`，因此您不需要显式地为方法提供类型参数。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-31T18:46:03.823

如果您不介意将您的方法声明为泛型，这是可能的。试试这个。

```
class Program
{
    public static void GetParameterValue<T>(out T destination)
    {
        Console.WriteLine("typeof(T)=" + typeof(T).Name);
        destination = default(T);
    }
    static void Main(string[] args)
    {
        string s;
        GetParameterValue(out s);
        int i;
        GetParameterValue(out i);
    }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-08-03T21:54:56.603

以下扩展方法*在声明*时返回其参数的类型，而不管其内容如何：

```
using System;

namespace MyNamespace
{
    public static class Extensions
    {
        /// <summary>
        /// Gets the declared type of the specified object.
        /// </summary>
        /// <typeparam name="T">The type of the object.</typeparam>
        /// <param name="obj">The object.</param>
        /// <returns>
        /// A <see cref="Type"/> object representing type 
        /// <typeparamref name="T"/>; i.e., the type of <paramref name="obj"/> 
        /// as it was declared. Note that the contents of 
        /// <paramref name="obj"/> are irrelevant; if <paramref name="obj"/> 
        /// contains an object whose class is derived from 
        /// <typeparamref name="T"/>, then <typeparamref name="T"/> is 
        /// returned, not the derived type.
        /// </returns>
        public static Type GetDeclaredType<T>(
            this T obj )
        {
            return typeof( T );
        }
    }
} 
```

由于这是一个扩展方法，它的参数可以是一个空引用，并且以下所有工作都可以：

```
string myString = "abc";
object myObj = myString;
Type myObjType = myObj.GetDeclaredType();

string myNullString = null;
object myNullObj = myNullString;
Type myNullObjType = myNullObj.GetDeclaredType(); 
```

请注意，`myObjType`和`myNullObjType`都将设置为 System.Object，而不是 System.String。

如果你真的想要 obj 内容的类型，当它不为 null 时，则将`return`行更改为：

```
return (obj != null) ? obj.GetType() : typeof( T ); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-31T18:42:10.820

目前，您无法知道传递给该方法的内容。您可以将其转换为这样的通用方法：

```
public void GetParameterValue<T>(out T destination)
{
   ...
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-31T18:41:05.407

您的目标变量的类型始终是`System.Object`. 你可以回来

```
Convert.ChangeType(paramVal, System.Object). 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-31T19:22:30.223

@Rally25s：

```
string val;
GetParameterValue("parameterName", out val); 
```

从您的消息（在答案中）中不清楚该消息的问题是什么。如果声明为：

```
void GetParameterValue<T>(string parameterName, out T val)  { } 
```

正如您在上面写的那样，调用将起作用（您无需指定类型）。我猜这对您不起作用，因为您不能将属性用作“out”参数。解决方法是同时使用这两种方法：

```
T GetParameterValue<T>(string parameterName, T ununsed)  { } 
```

这将被称为：

```
MyObj.SomeProp = GetParameterValue("parameterName", MyObj.SomeProp); 
```

这是相当笨拙的，但不是更糟糕的方法。

* * *

我在 C++ 中使用过但在 C# 中尚未尝试过的另一种方法是让 GetParameterValue() 您自己设计的某个对象，然后为它实现一些隐式转换运算符。

```
class ParameterHelper
{
   private object value;
   public ParameterHelper(object value)   { this.value = value;  }

   public static implicit operator int(ParameterHelper v)
     { return (int) v.value; }

}
ParameterHelper GetParameterValue( string parameterName);

MyObj.SomeProp = GetParameterValue("parameterName"); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-31T18:35:25.060

在您的示例中，它将为 null 类型`System.Object`。

您的示例甚至可以编译吗？我收到“无法从 'out string' 转换为 'out object'”错误。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-31T18:45:48.377

我认为当值为空时无法获取类型。此外，由于您在 GetParameterValue 内部调用，因此您能做的最好的事情（当值为空时）是获取“目标”参数的类型，即“对象”。您*可能会*考虑将 Type 作为参数传递给 GetParameterValue 以获取更多信息，例如：

```
public void GetParameterValue(Type sourceType, out object destination) { //... } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-31T18:51:29.503

如果没有实例，则没有实例类型。

您可以做的最好的事情是使用引用的类型，这意味着如果您有一个对象引用（如问题中的方法），则引用类型是对象。

* * *

您可能不应该尝试将一种类型的空实例转换为另一种类型的空实例......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-31T20:01:43.077

在理论上，null 与 C 中的 void 指针并不完全相同，也就是说它拥有一个内存地址，仅此而已？如果是这样，那么它类似于数学中除以零的情况，其中结果未定义。

可以对这一行执行以下操作：

```
string val = GetParameterValue<string>("parameterName"); 
```

只需删除第一个字符串，现在就没有重复了：

```
var val = GetParameterValue<string>("parameterName"); 
```

不一定是您要查找的内容，尽管存在如何解释 null 的问题？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-07-27T08:48:40.587

```
//**The working answer**

//**based on your discussion eheheheheeh**

public void s<T>(out T varName)
{
    if (typeof (T) == typeof(HtmlTable)) 
    { 
         //////////       
    }

}

protected void Page_Load(object sender, EventArgs e) 
{
    HtmlTable obj=null ;
    s(out obj);       
} 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2012-03-01T09:17:17.387

[http://msdn.microsoft.com/en-us/library/58918ffs.aspx](http://msdn.microsoft.com/en-us/library/58918ffs.aspx)

或者

```
private Hashtable propertyTable = new Hashtable();

public void LoadPropertyTypes()
{
    Type t = this.GetType();

    System.Reflection.MemberInfo[] memberInfo = t.GetMembers();

    foreach (System.Reflection.MemberInfo mInfo in memberInfo)
    {
        string[] prop = mInfo.ToString().Split(Convert.ToChar(" "));
        propertyTable.Add(prop[1], prop[0]);
    }
}
public string GetMemberType(string propName)
{
    if (propertyTable.ContainsKey(propName))
    {
        return Convert.ToString(propertyTable[propName]);
    }
    else{
        return "N/A";
    }
} 
```

这样我们就可以使用 switch 来管理不同的属性类型。

# asp.net - 与 Internet 断开连接时的 OpenId 开发

> ID：254469
> 
> 赞同：0
> 
> 时间：2008-10-31T18:36:31.533
> 
> 标签：asp.net, asp.net-mvc, asp.net-membership, openid

当人们决定使用 OpenId 作为站点成员时，他们想出了哪些解决方案来离线开发他们的 Web 应用程序？

几个想法：

1.  创建两个登录页面，一个用于 OpenId，一个用于 ASP.NET Membership
2.  使用测试帐户创建本地 OpenId 提供程序

有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T18:40:30.727

您可以使用[控制反转容器](http://structuremap.sourceforge.net/Default.htm)来包含您的 OpenID 实现，并且为了快速实现，您[可以使用 Moq](http://code.google.com/p/moq/)来提供预配置的响应。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T18:39:19.747

只是嘲笑它！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T04:38:49.470

我硬连线我的 login.aspx 页面总是这样做：

```
FormsAuthentication.RedirectFromLoginPage("http://blog.nerdbank.net/") 
```

或基于某些变量的类似内容。这样，我实际上并没有使用 OpenId 登录，但它看起来像我所做的那样查看网站的其余部分。

只要确保要么还原更改，要么根据某些仅在开发中正确的条件进行更改。:)

# architecture - 图标的加载方案

> ID：254474
> 
> 赞同：1
> 
> 时间：2008-10-31T18:37:38.300
> 
> 标签：architecture, icons

为应用程序加载图标的最佳方案是什么？

一点背景知识...我正在创建一个类似 FTP 的应用程序，它有 4 个窗格（本地文件夹窗格、本地文件窗格、云文件夹窗格、云文件窗格）。在两个文件窗格中，其中一列是文件名，我想在旁边显示图标（就像您在 Windows 资源管理器中看到的一样）。

事实上，我没有云中所有文件的物理文件，我必须进入注册表（手头有文件扩展名）并获取该文件类型的 ExeFileName 和 IconIndex 组合，然后从那里检索图标。也就是说，我认为我有以下选择，并希望得到您的意见：

1) 在程序加载时为每个扩展名（例如：.doc、.txt）加载所有 ExeFileName/IconIndex 组合，并根据需要查询并使用它们调用 ExtractIcon Win32 API。

2) 仅在需要获取 ExeFileName/IconIndex 组合并调用 ExtractIcon Win32 API 以获取关联文件类型的图标时才进入注册表。

3) 将每个已知扩展名的 1 字节文件保存到一个目录并调用 SHGetFileInfo Win32 API 并在需要时从文件中提取相关图标。

4) 将安装时每个文件扩展名的物理图标文件保存到一个目录中，并在需要时调用它（但不会随着文件关联的更改、添加或删除而改变）。

5）垃圾整件事，从图标商店购买一组图标，该图标文件类型已知前 1000 种图标文件类型，并显示其他文件类型的未知图标类型。

感谢您的时间和评论。

-杰西·豪尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-31T18:43:40.580

我认为选项 2 听起来最合理，只要您缓存结果，因此您只查询给定文件类型一次，即使该类型的文件有很多。

我认为选项 4 和 5 已经过时，因为它们不会反映关联的变化。如果您的应用程序与 Windows 资源管理器中的图标不同，这可能会使用户感到困惑。

选项 1 和 3 似乎有点矫枉过正，尤其是因为您很可能会多次显示最常见的图标，而可能永远不会显示更晦涩的图标。

# sql-server - 在 Delphi 中使用 ADOConnection 查看“打印”语句的输出

> ID：254486
> 
> 赞同：10
> 
> 时间：2008-10-31T18:42:53.140
> 
> 标签：sql-server, delphi, stored-procedures, ado

我的一些 MS SQL 存储过程使用“打印”命令生成消息。在我的 Delphi 2007 应用程序中，它使用 TADOConnection 连接到 MS SQL，我如何查看这些“打印”命令的输出？

关键要求：1）我不能多次运行查询；它可能正在更新东西。2) 即使返回数据集，我也需要查看“打印”结果。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-01T00:27:54.427

那是一个有趣的事件...
**来自 ADOConnection 的 OnInfoMessage 事件有效，但魔鬼在细节中！**

**要点：**
使用CursorLocation = clUseServer 而不是默认的clUseClient。
在您的 ADOStoredProc 中使用 Open 而不是 ExecProc。
使用当前的 NextRecordset 获取以下内容，但请务必检查您是否打开了一个。
在存储过程中使用 SET NOCOUNT = ON。

**SQL 端：**你的存储过程

```
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[FG_TEST]') AND type in (N'P', N'PC'))
  DROP PROCEDURE [dbo].[FG_TEST]
GO
-- =============================================
-- Author:      François
-- Description: test multi ADO with info
-- =============================================
CREATE PROCEDURE FG_TEST
AS
BEGIN
    -- SET NOCOUNT ON absolutely NEEDED
    SET NOCOUNT ON;

    PRINT '*** start ***'

    SELECT 'one' as Set1Field1

    PRINT '*** done once ***'

    SELECT 'two' as Set2Field2

    PRINT '*** done again ***'

    SELECT 'three' as Set3Field3

    PRINT '***finish ***'
END
GO 
```

**Delphi方面：**
新建一个VCL Forms Application。
在您的表单中放置一个备忘录和一个按钮。

复制以下文本，更改目录和数据源并将其粘贴到您的表单上

```
object ADOConnection1: TADOConnection
  ConnectionString = 
    'Provider=SQLOLEDB.1;Integrated Security=SSPI;Persist Security In' +
    'fo=False;Initial Catalog=xxxYOURxxxDBxxx;Data Source=xxxYOURxxxSERVERxxx'
  CursorLocation = clUseServer
  LoginPrompt = False
  Provider = 'SQLOLEDB.1'
  OnInfoMessage = ADOConnection1InfoMessage
  Left = 24
  Top = 216
end
object ADOStoredProc1: TADOStoredProc
  Connection = ADOConnection1
  CursorLocation = clUseServer
  ProcedureName = 'FG_TEST;1'
  Parameters = <>
  Left = 24
  Top = 264
end 
```

在 ADOConnection 的 OnInfoMessage 中放

```
Memo1.Lines.Add(Error.Description); 
```

对于 ButtonClick，粘贴此代码

```
procedure TForm1.Button1Click(Sender: TObject);
const
  adStateOpen = $00000001; // or defined in ADOInt
var
  I: Integer;
  ARecordSet: _Recordset;
begin
  Memo1.Lines.Add('==========================');

  ADOStoredProc1.Open; // not ExecProc !!!!!

  ARecordSet := ADOStoredProc1.Recordset;
  while Assigned(ARecordSet) do
  begin
    // do whatever with current RecordSet
    while not ADOStoredProc1.Eof do
    begin
      Memo1.Lines.Add(ADOStoredProc1.Fields[0].FieldName + ': ' + ADOStoredProc1.Fields[0].Value);
      ADOStoredProc1.Next;
    end;
    // switch to subsequent RecordSet if any
    ARecordSet := ADOStoredProc1.NextRecordset(I);
    if Assigned(ARecordSet) and ((ARecordSet.State and adStateOpen) <> 0) then
      ADOStoredProc1.Recordset := ARecordSet
    else
      Break;
  end;

  ADOStoredProc1.Close;
end; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-31T18:58:07.587

在.net 的连接类中有一个名为InfoMessage 的事件。在此事件的处理程序中，您可以从事件参数中检索 InfoMessage（打印语句）。

我相信 Delphi 有一个名为“OnInfoMessage”的类似事件可以帮助您。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T18:48:27.843

我不认为这是可能的。您可以使用临时表转储打印语句并将其与结果一起返回。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-30T18:35:05.997

对 Francois 的代码（使用 DXE2 测试）进行了一些增强，以适应多个打印语句和来自可变数量选择的结果。变化是微妙的。

```
procedure TForm1.ADOConnection1InfoMessage(Connection: TADOConnection;
  const Error: Error; var EventStatus: TEventStatus);
var
  i: integer;
begin
  // show ALL print statements
  for i := 0 to AdoConnection1.Errors.Count - 1 do
  begin
    // was: cxMemo1.Lines.Add(Error.Description);
    cxMemo1.Lines.Add(
      ADOConnection1.Errors.Item[i].Description);
  end;
end;

procedure TForm1.cxButton1Click(Sender: TObject);
const
  adStateOpen = $00000001; // or uses ADOInt
var
  records: Integer;
  ARecordSet: _RecordSet;
begin
  cxMemo1.Lines.Add('==========================');

  ADOStoredProc1.Open;

  try
    ARecordSet := ADOStoredProc1.RecordSet; // initial fetch
    while Assigned(ARecordSet) do
    begin
      // assign the recordset to a DataSets recordset to traverse
      AdoDataSet1.Recordset := ARecordSet;
      // do whatever with current ARecordSet
      while not ADODataSet1.eof do
      begin
        cxMemo1.Lines.Add(ADODataSet1.Fields[0].FieldName + 
          ': ' + ADODataSet1.Fields[0].Value);
        AdoDataSet1.Next;
      end;
      // fetch next recordset if there is one
      ARecordSet := ADOStoredProc1.NextRecordSet(records);
      if Assigned(ARecordSet) and ((ARecordSet.State and adStateOpen) <> 0) then
        ADOStoredProc1.Recordset := ARecordSet
      else
        Break;
    end;
  finally
    ADOStoredProc1.Close;
  end;

end; 
```

# java - 使用 spring 分离测试和数据有什么缺点吗？

> ID：254494
> 
> 赞同：3
> 
> 时间：2008-10-31T18:45:03.060
> 
> 标签：java, unit-testing, spring, junit

我一直在努力想出一个好的解决方案来将我的测试数据与单元测试（硬编码值）分开。直到我意识到我可以用 spring 创建 bean 并使用这些 bean 来保存我的数据。

以这种方式编码我的单元测试有什么缺点吗？尽管它们运行得有点慢，因为 Spring 必须配置所有 bean 以及什么不是。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T18:48:04.630

*精细实践——在我看来，依赖注入*的主要动力之一（更容易进行单元测试）

由于需要调出 Spring 应用程序上下文，它会变慢，因此您可以将此技术保留用于“集成测试”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-02T11:51:51.193

对于单元测试，您始终可以手动连接 bean，就像自己创建和注入它们一样，然后将 Spring 连接留给集成测试和生产/开发。

# svn - 你如何让 AnkhSVN 与 VisualSVN 服务器一起工作？

> ID：254499
> 
> 赞同：11
> 
> 时间：2008-10-31T18:46:34.007
> 
> 标签：svn, ankhsvn, visualsvn-server

我正在寻找我能找到的最简单的免费 SVN 实现。

我下载并安装了 VisualSVN 服务器 - 非常简单。安装 TortioseSVN - 非常简单 - 两者一起工作。安装了 AnkhSVN，我无法让它连接到 VisualSVN 服务器上的存储库。

为了让 AnkhSVN 与 VisualSVN 服务器对话，我需要做些什么特别的事情吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-31T19:11:15.940

要使用 Ankh 向 SVN 添加解决方案，首先在 VisualSVN 中设置存储库。然后转到 Visual Studio 并打开解决方案。在解决方案资源管理器中，右键单击解决方案名称，然后单击“将解决方案添加到 Subversion”。然后，您将能够指定应将其添加到的存储库，例如“ [https://1.2.3.4:8443/svn/myproject/](https://1.2.3.4:8443/svn/myproject/) ”。

如果您的解决方案已经在 Subversion 中，Ankh 应该能够接受它并在 Visual Studio 中为您提供状态图标和右键单击菜单选项。

如果想在 Visual Studio 中浏览您的 SVN 存储库，请转到 View->Repository Explorer。然后，应该为您提供一个看起来不直观的小图标，当您将其悬停时会显示“添加存储库”。输入您的 SVN 存储库的地址，例如“ [https://1.2.3.4:8443/svn/myproject/](https://1.2.3.4:8443/svn/myproject/) ”。然后，您可以浏览存储库并从那里打开解决方案文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-01T03:30:31.267

不知道这里发生了什么，但我得到了它的工作。我已经卸载了 Visual Studio Standard 并安装了 Visual Studio Pro（不同之处在于 Pro 可以选择源代码控制提供程序，而标准则没有）

但是，我怀疑就是这样 - 存储库浏览器在旧版本中。很可能是我输入了错误的东西。经过一番摆弄之后，当涉及到您用于存储库的 url 和文件夹路径时，subversion 很可能区分大小写 - 所以我可以看到在我之前的测试中弄错了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T18:57:02.537

我在visualSVN中有一个存储库。我可以用 Tortoise 看到那个存储库。但是我无法使用 anhkSVN 的“存储库浏览器”功能连接到它。

我以为我已经读到使用 http/s 的 anhkSVN 存在一些问题 - 服务器上的存储库位于[https://server:8443/svn/reponame](https://server:8443/svn/reponame)

我已经能够让 anhkSVN 使用 svn:// 协议与不同的服务器一起使用，但不能使用 https: 协议与 VisualSVN-Server 一起使用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T23:29:46.370

也许[简化工具选项](http://blogs.msdn.com/saraford/archive/2008/07/11/did-you-know-how-to-turn-on-and-off-simplified-tools-options-257.aspx)是您无法选择源代码控制提供程序的原因？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-19T13:49:30.787

我刚刚在我的 Vista 系统上设置了 VisualSVN 服务器、TortoiseSVN 和 AnkhSVN。由于它是一个 Intranet，它不是一个安全连接，并且使用端口 8080（VisualSVN 服务器网络属性）。我还使用 Subversion 身份验证并将“所有人”设置为只读并运行 IIS7，因此端口 80 不可用。

我也遇到了类似的问题，但可以通过“ [http://server-name:8080/](http://server-name:8080/) ”在我的浏览器中访问存储库，这会将我带到[http://server-name:8080/svn/](http://server-name:8080/svn/)。要访问 TortoiseSVN 中的存储库，需要使用 URL“ [http://server-name:8080/svn/](http://server-name:8080/svn/) ”，因为其他所有内容都会引发错误。

这也是我在 VS 中用来访问存储库的 url。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-31T19:51:21.303

如果没有解决方案，我应该能够使用 repo explorer 查看现有存储库吗？

我无法使用 repo explorer 连接到存储库 - 它错误/超时。这就是为什么我认为我一定做错了什么（即 - 也许 AnkhSVN 不适用于 SSL，或者防火墙以不同的方式对待这个客户端？）

乔尔，我会尝试你的步骤来添加一个解决方案，看看它是否有效——它很可能只是存储库浏览器中的一个错误。

# asp.net - asp.net 中的服务器端注释（HTML 端）

> ID：254509
> 
> 赞同：0
> 
> 时间：2008-10-31T18:50:27.807
> 
> 标签：asp.net

我需要在页面/用户控件上为其他开发人员留下一些指导性评论。除了以下还有更好的方法吗？

```
 <% /* DO NOT rename control IDs here, because blah blah blah... */ %> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-31T18:58:50.833

```
<%-- Comment Here --%> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T18:56:30.900

就是这样，除非是 HTML 注释。

您的选择是：

```
 <!-- Renders to ClientOutput too --> 
```

或者：

```
 <% /* Your original idea */ %> 
```

# php - PHP 上的枚举

> ID：254514
> 
> 赞同：1262
> 
> 时间：2008-10-31T18:51:14.840
> 
> 标签：php, enumeration

我知道 PHP 还没有原生枚举。但我已经从 Java 世界习惯了它们。我很想使用枚举作为一种方式来提供 IDE 的自动完成功能可以理解的预定义值。

常量可以解决问题，但存在命名空间冲突问题并且（或者实际上是*因为*）它们是全局的。数组没有命名空间问题，但是它们太模糊了，它们可以在运行时被覆盖，并且 IDE 很少知道如何在没有额外的静态分析注释或属性的情况下自动填充它们的键。

您是否经常使用任何解决方案/解决方法？有谁记得 PHP 人员是否对枚举有任何想法或决定？

* * *

## 回答 #1

> 赞同：1612
> 
> 时间：2008-10-31T18:59:44.807

根据用例，我通常会使用如下*简单*的东西：

```
abstract class DaysOfWeek
{
    const Sunday = 0;
    const Monday = 1;
    // etc.
}

$today = DaysOfWeek::Sunday; 
```

但是，其他用例可能需要对常量和值进行更多验证。根据下面关于反射的评论和[其他一些注释](https://stackoverflow.com/a/21536800/102937)，这里有一个扩展示例，它可能更好地服务于更广泛的案例：

```
abstract class BasicEnum {
    private static $constCacheArray = NULL;

    private static function getConstants() {
        if (self::$constCacheArray == NULL) {
            self::$constCacheArray = [];
        }
        $calledClass = get_called_class();
        if (!array_key_exists($calledClass, self::$constCacheArray)) {
            $reflect = new ReflectionClass($calledClass);
            self::$constCacheArray[$calledClass] = $reflect->getConstants();
        }
        return self::$constCacheArray[$calledClass];
    }

    public static function isValidName($name, $strict = false) {
        $constants = self::getConstants();

        if ($strict) {
            return array_key_exists($name, $constants);
        }

        $keys = array_map('strtolower', array_keys($constants));
        return in_array(strtolower($name), $keys);
    }

    public static function isValidValue($value, $strict = true) {
        $values = array_values(self::getConstants());
        return in_array($value, $values, $strict);
    }
} 
```

通过创建一个扩展 BasicEnum 的简单枚举类，您现在可以使用方法进行简单的输入验证：

```
abstract class DaysOfWeek extends BasicEnum {
    const Sunday = 0;
    const Monday = 1;
    const Tuesday = 2;
    const Wednesday = 3;
    const Thursday = 4;
    const Friday = 5;
    const Saturday = 6;
}

DaysOfWeek::isValidName('Humpday');                  // false
DaysOfWeek::isValidName('Monday');                   // true
DaysOfWeek::isValidName('monday');                   // true
DaysOfWeek::isValidName('monday', $strict = true);   // false
DaysOfWeek::isValidName(0);                          // false

DaysOfWeek::isValidValue(0);                         // true
DaysOfWeek::isValidValue(5);                         // true
DaysOfWeek::isValidValue(7);                         // false
DaysOfWeek::isValidValue('Friday');                  // false 
```

**附带说明一下，每当我在数据不会更改的静态/常量类**（例如在枚举中）上至少使用一次反射时，我都会缓存这些反射调用的结果，因为每次都使用新的反射对象最终会产生明显的性能影响（存储在多个枚举的关联数组中）。

现在大多数人**最终**至少升级到 5.3 并且`SplEnum`可用，这当然也是一个可行的选择——只要您不介意在整个代码库中拥有实际枚举*实例的传统上不直观的概念。*在上面的例子中，`BasicEnum`根本`DaysOfWeek`不能实例化，也不应该实例化。

* * *

## 回答 #2

> 赞同：189
> 
> 时间：2011-03-07T18:13:19.057

还有一个原生扩展。**脾脏**_

 **> SplEnum 提供了在 PHP 中本地模拟和创建枚举对象的能力。

[http://www.php.net/manual/en/class.splenum.php](http://www.php.net/manual/en/class.splenum.php)

注意力：

[https://www.php.net/manual/en/spl-types.installation.php](https://www.php.net/manual/en/spl-types.installation.php)

> PECL 扩展不与 PHP 捆绑在一起。
> 
> 此 PECL 扩展的 DLL 当前不可用。

* * *

## 回答 #3

> 赞同：78
> 
> 时间：2021-02-15T13:21:36.243

## 从 PHP 8.1 开始，您可以使用[本机枚举](https://wiki.php.net/rfc/enumerations)。

基本语法如下所示：

```
enum TransportMode {
  case Bicycle;
  case Car;
  case Ship;
  case Plane;
  case Feet;
} 
```

```
function travelCost(TransportMode $mode, int $distance): int
{ /* implementation */ } 

$mode = TransportMode::Boat;

$bikeCost = travelCost(TransportMode::Bicycle, 90);
$boatCost = travelCost($mode, 90);

// this one would fail: (Enums are singletons, not scalars)
$failCost = travelCost('Car', 90); 
```

### 价值观

默认情况下，枚举不支持任何类型的标量。`TransportMode::Bicycle`不是，`0`并且您无法在枚举之间使用`>`or进行比较。`<`

但以下工作：

```
$foo = TransportMode::Car;
$bar = TransportMode::Car;
$baz = TransportMode::Bicycle;

$foo === $bar; // true
$bar === $baz; // false

$foo instanceof TransportMode; // true

$foo > $bar || $foo <  $bar; // false either way 
```

### 支持的枚举

您还可以拥有“支持”枚举，其中每个枚举案例都由 an`int`或 a “支持” `string`。

```
enum Metal: int {
  case Gold = 1932;
  case Silver = 1049;
  case Lead = 1134;
  case Uranium = 1905;
  case Copper = 894;
} 
```

*   如果一个案例有一个支持值，那么所有案例都需要一个支持值，没有自动生成的值。
*   请注意，支持值的类型是在枚举名称之后声明的
*   支持的值是**只读的**
*   标量值必须是**唯一的**
*   值需要是文字或文字表达式
*   要读取支持的值，您可以访问`value`属性：`Metal::Gold->value`.

最后，支持的枚举在`BackedEnum`内部实现了一个接口，该接口公开了两种方法：

*   `from(int|string): self`
*   `tryFrom(int|string): ?self`

它们几乎是等价的，重要的区别是如果找不到值，第一个将抛出异常，而第二个将简单地返回`null`。

```
// usage example:

$metal_1 = Metal::tryFrom(1932); // $metal_1 === Metal::Gold;
$metal_2 = Metal::tryFrom(1000); // $metal_2 === null;

$metal_3 = Metal::from(9999); // throws Exception 
```

### 方法

枚举可能有方法，从而实现接口。

```
interface TravelCapable
{
    public function travelCost(int $distance): int;
    public function requiresFuel(): bool;
}

enum TransportMode: int implements TravelCapable{
  case Bicycle = 10;
  case Car = 1000 ;
  case Ship = 800 ;
  case Plane = 2000;
  case Feet = 5;

  public function travelCost(int $distance): int
  {
    return $this->value * $distance;
  }

  public function requiresFuel(): bool {
    return match($this) {
        TransportMode::Car, TransportMode::Ship, TransportMode::Plane => true,
      TransportMode::Bicycle, TransportMode::Feet => false
    }
  }
}

$mode = TransportMode::Car;

$carConsumesFuel = $mode->requiresFuel();   // true
$carTravelCost   = $mode->travelCost(800);  // 800000 
```

### 价值清单

Pure Enums 和 Backed Enums 都在内部实现了 interface `UnitEnum`，其中包括 (static) method `UnitEnum::cases()`，并允许检索枚举中定义的案例数组：

```
$modes = TransportMode::cases(); 
```

现在`$modes`是：

```
[
    TransportMode::Bicycle,
    TransportMode::Car,
    TransportMode::Ship,
    TransportMode::Plane
    TransportMode::Feet
] 
```

### 静态方法

枚举可以实现自己的`static`方法，这些方法通常用于专门的构造函数。

* * *

这涵盖了基础知识。要了解全部内容，请前往[相关的 RFC](https://wiki.php.net/rfc/enumerations#dokuwiki__top)，直到该功能发布并在 PHP 文档中发布。

* * *

## 回答 #4

> 赞同：48
> 
> 时间：2008-10-31T18:57:07.327

类常量呢？

```
<?php

class YourClass
{
    const SOME_CONSTANT = 1;

    public function echoConstant()
    {
        echo self::SOME_CONSTANT;
    }
}

echo YourClass::SOME_CONSTANT;

$c = new YourClass;
$c->echoConstant(); 
```

* * *

## 回答 #5

> 赞同：39
> 
> 时间：2014-02-03T20:14:03.317

上面的最佳答案太棒了。但是，如果您`extend`以两种不同的方式进行操作，那么首先完成的任何扩展都会导致对函数的调用将创建缓存。然后，所有后续调用都将使用此缓存，无论调用是由哪个分机发起的......

要解决此问题，请将变量和第一个函数替换为：

```
private static $constCacheArray = null;

private static function getConstants() {
    if (self::$constCacheArray === null) self::$constCacheArray = array();

    $calledClass = get_called_class();
    if (!array_key_exists($calledClass, self::$constCacheArray)) {
        $reflect = new \ReflectionClass($calledClass);
        self::$constCacheArray[$calledClass] = $reflect->getConstants();
    }

    return self::$constCacheArray[$calledClass];
} 
```

* * *

## 回答 #6

> 赞同：38
> 
> 时间：2008-10-31T18:56:48.073

我使用了带常量的类：

```
class Enum {
    const NAME       = 'aaaa';
    const SOME_VALUE = 'bbbb';
}

print Enum::NAME; 
```

* * *

## 回答 #7

> 赞同：31
> 
> 时间：2013-06-11T13:17:14.137

我在这里评论了其他一些答案，所以我想我也会参与进来。归根结底，由于 PHP 不支持类型化枚举，您可以采用以下两种方法之一：破解类型化枚举，或者接受它们极难有效破解的事实。

我更愿意接受这个事实，而是使用`const`此处其他答案以某种方式使用的方法：

```
abstract class Enum
{

    const NONE = null;

    final private function __construct()
    {
        throw new NotSupportedException(); // 
    }

    final private function __clone()
    {
        throw new NotSupportedException();
    }

    final public static function toArray()
    {
        return (new ReflectionClass(static::class))->getConstants();
    }

    final public static function isValid($value)
    {
        return in_array($value, static::toArray());
    }

} 
```

一个示例枚举：

```
final class ResponseStatusCode extends Enum
{

    const OK                         = 200;
    const CREATED                    = 201;
    const ACCEPTED                   = 202;
    // ...
    const SERVICE_UNAVAILABLE        = 503;
    const GATEWAY_TIME_OUT           = 504;
    const HTTP_VERSION_NOT_SUPPORTED = 505;

} 
```

使用`Enum`作为所有其他枚举扩展的基类允许使用辅助方法，例如`toArray`,`isValid`等。对我来说，类型化的枚举（*以及管理它们的实例*）最终会变得过于混乱。

* * *

## 假想

**如果**，存在一种`__getStatic`魔法方法（*最好也有一种`__equals`魔法方法*），其中大部分可以通过一种多吨模式来缓解。

（*以下是假设性的；它**不会**起作用，尽管有一天它会起作用*）

```
final class TestEnum
{

    private static $_values = [
        'FOO' => 1,
        'BAR' => 2,
        'QUX' => 3,
    ];
    private static $_instances = [];

    public static function __getStatic($name)
    {
        if (isset(static::$_values[$name]))
        {
            if (empty(static::$_instances[$name]))
            {
                static::$_instances[$name] = new static($name);
            }
            return static::$_instances[$name];
        }
        throw new Exception(sprintf('Invalid enumeration value, "%s"', $name));
    }

    private $_value;

    public function __construct($name)
    {
        $this->_value = static::$_values[$name];
    }

    public function __equals($object)
    {
        if ($object instanceof static)
        {
            return $object->_value === $this->_value;
        }
        return $object === $this->_value;
    }

}

$foo = TestEnum::$FOO; // object(TestEnum)#1 (1) {
                       //   ["_value":"TestEnum":private]=>
                       //   int(1)
                       // }

$zap = TestEnum::$ZAP; // Uncaught exception 'Exception' with message
                       // 'Invalid enumeration member, "ZAP"'

$qux = TestEnum::$QUX;
TestEnum::$QUX == $qux; // true
'hello world!' == $qux; // false 
```

* * *

## 回答 #8

> 赞同：24
> 
> 时间：2010-12-23T20:04:01.150

好吧，对于像 php 中的枚举这样的简单 java，我使用：

```
class SomeTypeName {
    private static $enum = array(1 => "Read", 2 => "Write");

    public function toOrdinal($name) {
        return array_search($name, self::$enum);
    }

    public function toString($ordinal) {
        return self::$enum[$ordinal];
    }
} 
```

并称之为：

```
SomeTypeName::toOrdinal("Read");
SomeTypeName::toString(1); 
```

但我是 PHP 初学者，在语法上苦苦挣扎，所以这可能不是最好的方法。我用类常量进行了一些实验，使用反射从它的值中获取常量名称，可能会更整洁。

* * *

## 回答 #9

> 赞同：24
> 
> 时间：2011-11-24T14:51:56.543

我使用`interface`而不是`class`：

```
interface DaysOfWeek
{
    const Sunday = 0;
    const Monday = 1;
    // etc.
}

var $today = DaysOfWeek::Sunday; 
```

* * *

## 回答 #10

> 赞同：18
> 
> 时间：2014-08-27T11:52:43.910

四年后，我再次遇到了这个问题。我目前的方法是这样，因为它允许在 IDE 中完成代码以及类型安全：

**基类：**

```
abstract class TypedEnum
{
    private static $_instancedValues;

    private $_value;
    private $_name;

    private function __construct($value, $name)
    {
        $this->_value = $value;
        $this->_name = $name;
    }

    private static function _fromGetter($getter, $value)
    {
        $reflectionClass = new ReflectionClass(get_called_class());
        $methods = $reflectionClass->getMethods(ReflectionMethod::IS_STATIC | ReflectionMethod::IS_PUBLIC);    
        $className = get_called_class();

        foreach($methods as $method)
        {
            if ($method->class === $className)
            {
                $enumItem = $method->invoke(null);

                if ($enumItem instanceof $className && $enumItem->$getter() === $value)
                {
                    return $enumItem;
                }
            }
        }

        throw new OutOfRangeException();
    }

    protected static function _create($value)
    {
        if (self::$_instancedValues === null)
        {
            self::$_instancedValues = array();
        }

        $className = get_called_class();

        if (!isset(self::$_instancedValues[$className]))
        {
            self::$_instancedValues[$className] = array();
        }

        if (!isset(self::$_instancedValues[$className][$value]))
        {
            $debugTrace = debug_backtrace();
            $lastCaller = array_shift($debugTrace);

            while ($lastCaller['class'] !== $className && count($debugTrace) > 0)
            {
                $lastCaller = array_shift($debugTrace);
            }

            self::$_instancedValues[$className][$value] = new static($value, $lastCaller['function']);
        }

        return self::$_instancedValues[$className][$value];
    }

    public static function fromValue($value)
    {
        return self::_fromGetter('getValue', $value);
    }

    public static function fromName($value)
    {
        return self::_fromGetter('getName', $value);
    }

    public function getValue()
    {
        return $this->_value;
    }

    public function getName()
    {
        return $this->_name;
    }
} 
```

**示例枚举：**

```
final class DaysOfWeek extends TypedEnum
{
    public static function Sunday() { return self::_create(0); }    
    public static function Monday() { return self::_create(1); }
    public static function Tuesday() { return self::_create(2); }   
    public static function Wednesday() { return self::_create(3); }
    public static function Thursday() { return self::_create(4); }  
    public static function Friday() { return self::_create(5); }
    public static function Saturday() { return self::_create(6); }      
} 
```

**示例用法：**

```
function saveEvent(DaysOfWeek $weekDay, $comment)
{
    // store week day numeric value and comment:
    $myDatabase->save('myeventtable', 
       array('weekday_id' => $weekDay->getValue()),
       array('comment' => $comment));
}

// call the function, note: DaysOfWeek::Monday() returns an object of type DaysOfWeek
saveEvent(DaysOfWeek::Monday(), 'some comment'); 
```

请注意，同一枚举条目的所有实例都是相同的：

```
$monday1 = DaysOfWeek::Monday();
$monday2 = DaysOfWeek::Monday();
$monday1 === $monday2; // true 
```

你也可以在 switch 语句中使用它：

```
function getGermanWeekDayName(DaysOfWeek $weekDay)
{
    switch ($weekDay)
    {
        case DaysOfWeek::Monday(): return 'Montag';
        case DaysOfWeek::Tuesday(): return 'Dienstag';
        // ...
} 
```

您还可以按名称或值创建枚举条目：

```
$monday = DaysOfWeek::fromValue(2);
$tuesday = DaysOfWeek::fromName('Tuesday'); 
```

或者您可以从现有枚举条目中获取名称（即函数名称）：

```
$wednesday = DaysOfWeek::Wednesday()
echo $wednesDay->getName(); // Wednesday 
```

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2013-08-11T04:20:12.437

我在 github 上找到[了这个库，我认为它为这里的答案提供了一个非常不错的替代方案。](https://github.com/myclabs/php-enum)

## 受 SplEnum 启发的 PHP 枚举实现

*   您可以键入提示：`function setAction(Action $action) {`
*   您可以使用方法丰富枚举（例如`format`，`parse`...）
*   您可以扩展枚举以添加新值（使您的枚举`final`阻止它）
*   您可以获得所有可能值的列表（见下文）

## 宣言

```
<?php
use MyCLabs\Enum\Enum;

/**
 * Action enum
 */
class Action extends Enum
{
    const VIEW = 'view';
    const EDIT = 'edit';
} 
```

## 用法

```
<?php
$action = new Action(Action::VIEW);

// or
$action = Action::VIEW(); 
```

## 类型提示枚举值：

```
<?php
function setAction(Action $action) {
    // ...
} 
```

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2010-08-21T22:45:28.913

如果您需要使用全局唯一的枚举（即即使在比较不同枚举之间的元素时）并且易于使用，请随意使用以下代码。我还添加了一些我觉得有用的方法。您将在代码顶部的注释中找到示例。

```
<?php

/**
 * Class Enum
 * 
 * @author Christopher Fox <christopher.fox@gmx.de>
 *
 * @version 1.0
 *
 * This class provides the function of an enumeration.
 * The values of Enum elements are unique (even between different Enums)
 * as you would expect them to be.
 *
 * Constructing a new Enum:
 * ========================
 *
 * In the following example we construct an enum called "UserState"
 * with the elements "inactive", "active", "banned" and "deleted".
 * 
 * <code>
 * Enum::Create('UserState', 'inactive', 'active', 'banned', 'deleted');
 * </code>
 *
 * Using Enums:
 * ============
 *
 * The following example demonstrates how to compare two Enum elements
 *
 * <code>
 * var_dump(UserState::inactive == UserState::banned); // result: false
 * var_dump(UserState::active == UserState::active); // result: true
 * </code>
 *
 * Special Enum methods:
 * =====================
 *
 * Get the number of elements in an Enum:
 *
 * <code>
 * echo UserState::CountEntries(); // result: 4
 * </code>
 *
 * Get a list with all elements of the Enum:
 *
 * <code>
 * $allUserStates = UserState::GetEntries();
 * </code>
 *
 * Get a name of an element:
 *
 * <code>
 * echo UserState::GetName(UserState::deleted); // result: deleted
 * </code>
 *
 * Get an integer ID for an element (e.g. to store as a value in a database table):
 * This is simply the index of the element (beginning with 1).
 * Note that this ID is only unique for this Enum but now between different Enums.
 *
 * <code>
 * echo UserState::GetDatabaseID(UserState::active); // result: 2
 * </code>
 */
class Enum
{

    /**
     * @var Enum $instance The only instance of Enum (Singleton)
     */
    private static $instance;

    /**
     * @var array $enums    An array of all enums with Enum names as keys
     *          and arrays of element names as values
     */
    private $enums;

    /**
     * Constructs (the only) Enum instance
     */
    private function __construct()
    {
        $this->enums = array();
    }

    /**
     * Constructs a new enum
     *
     * @param string $name The class name for the enum
     * @param mixed $_ A list of strings to use as names for enum entries
     */
    public static function Create($name, $_)
    {
        // Create (the only) Enum instance if this hasn't happened yet
        if (self::$instance===null)
        {
            self::$instance = new Enum();
        }

        // Fetch the arguments of the function
        $args = func_get_args();
        // Exclude the "name" argument from the array of function arguments,
        // so only the enum element names remain in the array
        array_shift($args);
        self::$instance->add($name, $args);
    }

    /**
     * Creates an enumeration if this hasn't happened yet
     * 
     * @param string $name The class name for the enum
     * @param array $fields The names of the enum elements
     */
    private function add($name, $fields)
    {
        if (!array_key_exists($name, $this->enums))
        {
            $this->enums[$name] = array();

            // Generate the code of the class for this enumeration
            $classDeclaration =     "class " . $name . " {\n"
                        . "private static \$name = '" . $name . "';\n"
                        . $this->getClassConstants($name, $fields)
                        . $this->getFunctionGetEntries($name)
                        . $this->getFunctionCountEntries($name)
                        . $this->getFunctionGetDatabaseID()
                        . $this->getFunctionGetName()
                        . "}";

            // Create the class for this enumeration
            eval($classDeclaration);
        }
    }

    /**
     * Returns the code of the class constants
     * for an enumeration. These are the representations
     * of the elements.
     * 
     * @param string $name The class name for the enum
     * @param array $fields The names of the enum elements
     *
     * @return string The code of the class constants
     */
    private function getClassConstants($name, $fields)
    {
        $constants = '';

        foreach ($fields as $field)
        {
            // Create a unique ID for the Enum element
            // This ID is unique because class and variables
            // names can't contain a semicolon. Therefore we
            // can use the semicolon as a separator here.
            $uniqueID = $name . ";" . $field;
            $constants .=   "const " . $field . " = '". $uniqueID . "';\n";
            // Store the unique ID
            array_push($this->enums[$name], $uniqueID);
        }

        return $constants;
    }

    /**
     * Returns the code of the function "GetEntries()"
     * for an enumeration
     * 
     * @param string $name The class name for the enum
     *
     * @return string The code of the function "GetEntries()"
     */
    private function getFunctionGetEntries($name) 
    {
        $entryList = '';        

        // Put the unique element IDs in single quotes and
        // separate them with commas
        foreach ($this->enums[$name] as $key => $entry)
        {
            if ($key > 0) $entryList .= ',';
            $entryList .= "'" . $entry . "'";
        }

        return  "public static function GetEntries() { \n"
            . " return array(" . $entryList . ");\n"
            . "}\n";
    }

    /**
     * Returns the code of the function "CountEntries()"
     * for an enumeration
     * 
     * @param string $name The class name for the enum
     *
     * @return string The code of the function "CountEntries()"
     */
    private function getFunctionCountEntries($name) 
    {
        // This function will simply return a constant number (e.g. return 5;)
        return  "public static function CountEntries() { \n"
            . " return " . count($this->enums[$name]) . ";\n"
            . "}\n";
    }

    /**
     * Returns the code of the function "GetDatabaseID()"
     * for an enumeration
     * 
     * @return string The code of the function "GetDatabaseID()"
     */
    private function getFunctionGetDatabaseID()
    {
        // Check for the index of this element inside of the array
        // of elements and add +1
        return  "public static function GetDatabaseID(\$entry) { \n"
            . "\$key = array_search(\$entry, self::GetEntries());\n"
            . " return \$key + 1;\n"
            . "}\n";
    }

    /**
     * Returns the code of the function "GetName()"
     * for an enumeration
     *
     * @return string The code of the function "GetName()"
     */
    private function getFunctionGetName()
    {
        // Remove the class name from the unique ID 
        // and return this value (which is the element name)
        return  "public static function GetName(\$entry) { \n"
            . "return substr(\$entry, strlen(self::\$name) + 1 , strlen(\$entry));\n"
            . "}\n";
    }

}

?> 
```

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2011-04-13T09:55:26.313

我也喜欢 java 的枚举，因此我以这种方式编写我的枚举，我认为这是 Java 枚举中最相似的行为，当然，如果有人想使用 java 的更多方法，应该在这里写，或者在抽象类，但核心思想嵌入在下面的代码中

```
 class FruitsEnum {

    static $APPLE = null;
    static $ORANGE = null;

    private $value = null;

    public static $map;

    public function __construct($value) {
        $this->value = $value;
    }

    public static function init () {
        self::$APPLE  = new FruitsEnum("Apple");
        self::$ORANGE = new FruitsEnum("Orange");
        //static map to get object by name - example Enum::get("INIT") - returns Enum::$INIT object;
        self::$map = array (
            "Apple" => self::$APPLE,
            "Orange" => self::$ORANGE
        );
    }

    public static function get($element) {
        if($element == null)
            return null;
        return self::$map[$element];
    }

    public function getValue() {
        return $this->value;
    }

    public function equals(FruitsEnum $element) {
        return $element->getValue() == $this->getValue();
    }

    public function __toString () {
        return $this->value;
    }
}
FruitsEnum::init();

var_dump(FruitsEnum::$APPLE->equals(FruitsEnum::$APPLE)); //true
var_dump(FruitsEnum::$APPLE->equals(FruitsEnum::$ORANGE)); //false
var_dump(FruitsEnum::$APPLE instanceof FruitsEnum); //true
var_dump(FruitsEnum::get("Apple")->equals(FruitsEnum::$APPLE)); //true - enum from string
var_dump(FruitsEnum::get("Apple")->equals(FruitsEnum::get("Orange"))); //false 
```

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2013-04-19T10:47:59.307

```
abstract class Enumeration
{
    public static function enum() 
    {
        $reflect = new ReflectionClass( get_called_class() );
        return $reflect->getConstants();
    }
}

class Test extends Enumeration
{
    const A = 'a';
    const B = 'b';    
}

foreach (Test::enum() as $key => $value) {
    echo "$key -> $value<br>";
} 
```

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2015-05-28T13:26:25.997

它可能很简单

```
enum DaysOfWeek {
    Sunday,
    Monday,
    // ...
} 
```

在将来。

[PHP RFC：枚举类型](https://wiki.php.net/rfc/enum)

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2008-10-31T18:55:51.367

我在 PHP 中看到的枚举最常见的解决方案是创建一个通用枚举类，然后对其进行扩展。你可以看看[这个](http://us3.php.net/manual/en/language.oop5.php#73929)。

**更新：**或者，我从 phpclasses.org找到[了这个。](http://www.phpclasses.org/browse/package/4169.html)

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2010-10-21T08:36:53.727

这是一个用于在 php 中处理类型安全枚举的 github 库：

这个库处理类生成，类缓存，它实现了类型安全枚举设计模式，有几个处理枚举的辅助方法，比如检索枚举排序的序数，或检索枚举组合的二进制值。

生成的代码使用一个普通的旧 php 模板文件，该文件也是可配置的，因此您可以提供自己的模板。

它是用 phpunit 覆盖的完整测试。

[github 上的 php-enums（随意 fork）](http://github.com/zanshine/php-enums)

## 用法：（@see usage.php，或单元测试了解更多详细信息）

```
<?php
//require the library
require_once __DIR__ . '/src/Enum.func.php';

//if you don't have a cache directory, create one
@mkdir(__DIR__ . '/cache');
EnumGenerator::setDefaultCachedClassesDir(__DIR__ . '/cache');

//Class definition is evaluated on the fly:
Enum('FruitsEnum', array('apple' , 'orange' , 'rasberry' , 'bannana'));

//Class definition is cached in the cache directory for later usage:
Enum('CachedFruitsEnum', array('apple' , 'orange' , 'rasberry' , 'bannana'), '\my\company\name\space', true);

echo 'FruitsEnum::APPLE() == FruitsEnum::APPLE(): ';
var_dump(FruitsEnum::APPLE() == FruitsEnum::APPLE()) . "\n";

echo 'FruitsEnum::APPLE() == FruitsEnum::ORANGE(): ';
var_dump(FruitsEnum::APPLE() == FruitsEnum::ORANGE()) . "\n";

echo 'FruitsEnum::APPLE() instanceof Enum: ';
var_dump(FruitsEnum::APPLE() instanceof Enum) . "\n";

echo 'FruitsEnum::APPLE() instanceof FruitsEnum: ';
var_dump(FruitsEnum::APPLE() instanceof FruitsEnum) . "\n";

echo "->getName()\n";
foreach (FruitsEnum::iterator() as $enum)
{
  echo "  " . $enum->getName() . "\n";
}

echo "->getValue()\n";
foreach (FruitsEnum::iterator() as $enum)
{
  echo "  " . $enum->getValue() . "\n";
}

echo "->getOrdinal()\n";
foreach (CachedFruitsEnum::iterator() as $enum)
{
  echo "  " . $enum->getOrdinal() . "\n";
}

echo "->getBinary()\n";
foreach (CachedFruitsEnum::iterator() as $enum)
{
  echo "  " . $enum->getBinary() . "\n";
} 
```

## 输出：

```
FruitsEnum::APPLE() == FruitsEnum::APPLE(): bool(true)
FruitsEnum::APPLE() == FruitsEnum::ORANGE(): bool(false)
FruitsEnum::APPLE() instanceof Enum: bool(true)
FruitsEnum::APPLE() instanceof FruitsEnum: bool(true)
->getName()
  APPLE
  ORANGE
  RASBERRY
  BANNANA
->getValue()
  apple
  orange
  rasberry
  bannana
->getValue() when values have been specified
  pig
  dog
  cat
  bird
->getOrdinal()
  1
  2
  3
  4
->getBinary()
  1
  2
  4
  8 
```

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2018-09-11T04:26:11.953

最后，一个**PHP 7.1+**的答案，其中包含不能被覆盖的常量。

```
/**
 * An interface that groups HTTP Accept: header Media Types in one place.
 */
interface MediaTypes
{
    /**
    * Now, if you have to use these same constants with another class, you can
    * without creating funky inheritance / is-a relationships.
    * Also, this gets around the single inheritance limitation.
    */

    public const HTML = 'text/html';
    public const JSON = 'application/json';
    public const XML = 'application/xml';
    public const TEXT = 'text/plain';
}

/**
 * An generic request class.
 */
abstract class Request
{
    // Why not put the constants here?
    // 1) The logical reuse issue.
    // 2) Single Inheritance.
    // 3) Overriding is possible.

    // Why put class constants here?
    // 1) The constant value will not be necessary in other class families.
}

/**
 * An incoming / server-side HTTP request class.
 */
class HttpRequest extends Request implements MediaTypes
{
    // This class can implement groups of constants as necessary.
} 
```

如果您使用命名空间，代码完成应该可以工作。

但是，在这样做时，您将无法隐藏类族 ( `protected`) 或单独的类 ( ) 中的常量`private`。根据定义， an 中的所有内容`Interface`都是`public`.

[PHP 手册：接口](http://www.php.net/manual/en/language.oop5.interfaces.php)

**更新：**

PHP 8.1 现在有[枚举](http://%20https://www.php.net/manual/en/language.enumerations.php)。

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2012-12-02T00:13:05.270

我已经开始使用下面的方法，因为它使我能够为函数参数提供类型安全、NetBeans 中的自动完成和良好的性能。我不太喜欢的一件事是您必须`[extended class name]::enumerate();`在定义类后调用。

```
abstract class Enum {

    private $_value;

    protected function __construct($value) {
        $this->_value = $value;
    }

    public function __toString() {
        return (string) $this->_value;
    }

    public static function enumerate() {
        $class = get_called_class();
        $ref = new ReflectionClass($class);
        $statics = $ref->getStaticProperties();
        foreach ($statics as $name => $value) {
            $ref->setStaticPropertyValue($name, new $class($value));
        }
    }
}

class DaysOfWeek extends Enum {
    public static $MONDAY = 0;
    public static $SUNDAY = 1;
    // etc.
}
DaysOfWeek::enumerate();

function isMonday(DaysOfWeek $d) {
    if ($d == DaysOfWeek::$MONDAY) {
        return true;
    } else {
        return false;
    }
}

$day = DaysOfWeek::$MONDAY;
echo (isMonday($day) ? "bummer it's monday" : "Yay! it's not monday"); 
```

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2015-02-26T16:29:18.880

我下面的 Enum 类定义是**强类型**的，使用和定义非常**自然。**

**定义：**

```
class Fruit extends Enum {
    static public $APPLE = 1;
    static public $ORANGE = 2;
}
Fruit::initialize(); //Can also be called in autoloader 
```

**切换枚举**

```
$myFruit = Fruit::$APPLE;

switch ($myFruit) {
    case Fruit::$APPLE  : echo "I like apples\n";  break;
    case Fruit::$ORANGE : echo "I hate oranges\n"; break;
}

>> I like apples 
```

**将枚举作为参数传递（强类型）**

```
/** Function only accepts Fruit enums as input**/
function echoFruit(Fruit $fruit) {
    echo $fruit->getName().": ".$fruit->getValue()."\n";
}

/** Call function with each Enum value that Fruit has */
foreach (Fruit::getList() as $fruit) {
    echoFruit($fruit);
}

//Call function with Apple enum
echoFruit(Fruit::$APPLE)

//Will produce an error. This solution is strongly typed
echoFruit(2);

>> APPLE: 1
>> ORANGE: 2
>> APPLE: 1
>> Argument 1 passed to echoFruit() must be an instance of Fruit, integer given 
```

**将枚举回显为字符串**

```
echo "I have an $myFruit\n";

>> I have an APPLE 
```

**通过整数获取枚举**

```
$myFruit = Fruit::getByValue(2);

echo "Now I have an $myFruit\n";

>> Now I have an ORANGE 
```

**按名称获取枚举**

```
$myFruit = Fruit::getByName("APPLE");

echo "But I definitely prefer an $myFruit\n\n";

>> But I definitely prefer an APPLE 
```

**枚举类：**

```
/**
 * @author Torge Kummerow
 */
class Enum {

    /**
     * Holds the values for each type of Enum
     */
    static private $list = array();

    /**
     * Initializes the enum values by replacing the number with an instance of itself
     * using reflection
     */
    static public function initialize() {
        $className = get_called_class();
        $class = new ReflectionClass($className);
        $staticProperties = $class->getStaticProperties();

        self::$list[$className] = array();

        foreach ($staticProperties as $propertyName => &$value) {
            if ($propertyName == 'list')
                continue;

            $enum = new $className($propertyName, $value);
            $class->setStaticPropertyValue($propertyName, $enum);
            self::$list[$className][$propertyName] = $enum;
        } unset($value);
    }

    /**
     * Gets the enum for the given value
     *
     * @param integer $value
     * @throws Exception
     *
     * @return Enum
     */
    static public function getByValue($value) {
        $className = get_called_class();
        foreach (self::$list[$className] as $propertyName=>&$enum) {
            /* @var $enum Enum */
            if ($enum->value == $value)
                return $enum;
        } unset($enum);

        throw new Exception("No such enum with value=$value of type ".get_called_class());
    }

    /**
     * Gets the enum for the given name
     *
     * @param string $name
     * @throws Exception
     *
     * @return Enum
     */
    static public function getByName($name) {
        $className = get_called_class();
        if (array_key_exists($name, static::$list[$className]))
            return self::$list[$className][$name];

        throw new Exception("No such enum ".get_called_class()."::\$$name");
    }

    /**
     * Returns the list of all enum variants
     * @return Array of Enum
     */
    static public function getList() {
        $className = get_called_class();
        return self::$list[$className];
    }

    private $name;
    private $value;

    public function __construct($name, $value) {
        $this->name = $name;
        $this->value = $value;
    }

    public function __toString() {
        return $this->name;
    }

    public function getValue() {
        return $this->value;
    }

    public function getName() {
        return $this->name;
    }

} 
```

**添加**

您当然也可以为 IDE 添加注释

```
class Fruit extends Enum {

    /**
     * This comment is for autocomplete support in common IDEs
     * @var Fruit A yummy apple
     */
    static public $APPLE = 1;

    /**
     * This comment is for autocomplete support in common IDEs
     * @var Fruit A sour orange
     */
    static public $ORANGE = 2;
}

//This can also go to the autoloader if available.
Fruit::initialize(); 
```

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2015-04-28T16:23:43.777

我意识到这是一个非常非常非常古老的线程，但我对此有一个想法，想知道人们的想法。

注意：我正在玩这个，并意识到如果我只是修改了`__call()`你可以更接近实际的功能`enums`。该`__call()`函数处理所有未知的函数调用。因此，假设您要制作三个`enums`RED_LIGHT、YELLOW_LIGHT 和 GREEN_LIGHT。您现在只需执行以下操作即可：

```
$c->RED_LIGHT();
$c->YELLOW_LIGHT();
$c->GREEN_LIGHT(); 
```

定义后，您要做的就是再次调用它们以获取值：

```
echo $c->RED_LIGHT();
echo $c->YELLOW_LIGHT();
echo $c->GREEN_LIGHT(); 
```

你应该得到 0、1 和 2。玩得开心！这也出现在 GitHub 上。

更新：我已经做到了，所以现在使用`__get()`和函数。`__set()`这些允许您不必调用函数，除非您愿意。相反，现在你可以说：

```
$c->RED_LIGHT;
$c->YELLOW_LIGHT;
$c->GREEN_LIGHT; 
```

为了创造和获得价值。因为最初没有定义变量，所以`__get()`调用了函数（因为没有指定值），它看到数组中的条目还没有被创建。因此，它创建条目，将给定的最后一个值加上一（+1）分配给它，增加最后一个值变量，并返回 TRUE。如果设置值：

```
$c->RED_LIGHT = 85; 
```

然后`__set()`调用该函数并将最后一个值设置为新值加一 (+1)。所以现在我们有一个相当好的方法来做枚举，它们可以动态创建。

```
<?php
################################################################################
#   Class ENUMS
#
#       Original code by Mark Manning.
#       Copyrighted (c) 2015 by Mark Manning.
#       All rights reserved.
#
#       This set of code is hereby placed into the free software universe
#       via the GNU greater license thus placing it under the Copyleft
#       rules and regulations with the following modifications:
#
#       1\. You may use this work in any other work.  Commercial or otherwise.
#       2\. You may make as much money as you can with it.
#       3\. You owe me nothing except to give me a small blurb somewhere in
#           your program or maybe have pity on me and donate a dollar to
#           sim_sales@paypal.com.  :-)
#
#   Blurb:
#
#       PHP Class Enums by Mark Manning (markem-AT-sim1-DOT-us).
#       Used with permission.
#
#   Notes:
#
#       VIM formatting.  Set tabs to four(4) spaces.
#
################################################################################
class enums
{
    private $enums;
    private $clear_flag;
    private $last_value;

################################################################################
#   __construct(). Construction function.  Optionally pass in your enums.
################################################################################
function __construct()
{
    $this->enums = array();
    $this->clear_flag = false;
    $this->last_value = 0;

    if( func_num_args() > 0 ){
        return $this->put( func_get_args() );
        }

    return true;
}
################################################################################
#   put(). Insert one or more enums.
################################################################################
function put()
{
    $args = func_get_args();
#
#   Did they send us an array of enums?
#   Ex: $c->put( array( "a"=>0, "b"=>1,...) );
#   OR  $c->put( array( "a", "b", "c",... ) );
#
    if( is_array($args[0]) ){
#
#   Add them all in
#
        foreach( $args[0] as $k=>$v ){
#
#   Don't let them change it once it is set.
#   Remove the IF statement if you want to be able to modify the enums.
#
            if( !isset($this->enums[$k]) ){
#
#   If they sent an array of enums like this: "a","b","c",... then we have to
#   change that to be "A"=>#. Where "#" is the current count of the enums.
#
                if( is_numeric($k) ){
                    $this->enums[$v] = $this->last_value++;
                    }
#
#   Else - they sent "a"=>"A", "b"=>"B", "c"=>"C"...
#
                    else {
                        $this->last_value = $v + 1;
                        $this->enums[$k] = $v;
                        }
                }
            }
        }
#
#   Nope!  Did they just sent us one enum?
#
        else {
#
#   Is this just a default declaration?
#   Ex: $c->put( "a" );
#
            if( count($args) < 2 ){
#
#   Again - remove the IF statement if you want to be able to change the enums.
#
                if( !isset($this->enums[$args[0]]) ){
                    $this->enums[$args[0]] = $this->last_value++;
                    }
#
#   No - they sent us a regular enum
#   Ex: $c->put( "a", "This is the first enum" );
#
                    else {
#
#   Again - remove the IF statement if you want to be able to change the enums.
#
                        if( !isset($this->enums[$args[0]]) ){
                            $this->last_value = $args[1] + 1;
                            $this->enums[$args[0]] = $args[1];
                            }
                        }
                }
            }

    return true;
}
################################################################################
#   get(). Get one or more enums.
################################################################################
function get()
{
    $num = func_num_args();
    $args = func_get_args();
#
#   Is this an array of enums request? (ie: $c->get(array("a","b","c"...)) )
#
    if( is_array($args[0]) ){
        $ary = array();
        foreach( $args[0] as $k=>$v ){
            $ary[$v] = $this->enums[$v];
            }

        return $ary;
        }
#
#   Is it just ONE enum they want? (ie: $c->get("a") )
#
        else if( ($num > 0) && ($num < 2) ){
            return $this->enums[$args[0]];
            }
#
#   Is it a list of enums they want? (ie: $c->get( "a", "b", "c"...) )
#
        else if( $num > 1 ){
            $ary = array();
            foreach( $args as $k=>$v ){
                $ary[$v] = $this->enums[$v];
                }

            return $ary;
            }
#
#   They either sent something funky or nothing at all.
#
    return false;
}
################################################################################
#   clear(). Clear out the enum array.
#       Optional.  Set the flag in the __construct function.
#       After all, ENUMS are supposed to be constant.
################################################################################
function clear()
{
    if( $clear_flag ){
        unset( $this->enums );
        $this->enums = array();
        }

    return true;
}
################################################################################
#   __call().  In case someone tries to blow up the class.
################################################################################
function __call( $name, $arguments )
{
    if( isset($this->enums[$name]) ){ return $this->enums[$name]; }
        else if( !isset($this->enums[$name]) && (count($arguments) > 0) ){
            $this->last_value = $arguments[0] + 1;
            $this->enums[$name] = $arguments[0];
            return true;
            }
        else if( !isset($this->enums[$name]) && (count($arguments) < 1) ){
            $this->enums[$name] = $this->last_value++;
            return true;
            }

    return false;
}
################################################################################
#   __get(). Gets the value.
################################################################################
function __get($name)
{
    if( isset($this->enums[$name]) ){ return $this->enums[$name]; }
        else if( !isset($this->enums[$name]) ){
            $this->enums[$name] = $this->last_value++;
            return true;
            }

    return false;
}
################################################################################
#   __set().  Sets the value.
################################################################################
function __set( $name, $value=null )
{
    if( isset($this->enums[$name]) ){ return false; }
        else if( !isset($this->enums[$name]) && !is_null($value) ){
            $this->last_value = $value + 1;
            $this->enums[$name] = $value;
            return true;
            }
        else if( !isset($this->enums[$name]) && is_null($value) ){
            $this->enums[$name] = $this->last_value++;
            return true;
            }

    return false;
}
################################################################################
#   __destruct().  Deconstruct the class.  Remove the list of enums.
################################################################################
function __destruct()
{
    unset( $this->enums );
    $this->enums = null;

    return true;
}

}
#
#   Test code
#
#   $c = new enums();
#   $c->RED_LIGHT(85);
#   $c->YELLOW_LIGHT = 23;
#   $c->GREEN_LIGHT;
#
#   echo $c->RED_LIGHT . "\n";
#   echo $c->YELLOW_LIGHT . "\n";
#   echo $c->GREEN_LIGHT . "\n";

?> 
```

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2011-12-28T18:23:31.443

我知道这是一个旧线程，但是我见过的解决方法都不像枚举，因为几乎所有解决方法都需要您手动为枚举项分配值，或者它需要您将枚举键数组传递给功能。所以我为此创建了自己的解决方案。

要使用我的解决方案创建一个枚举类，可以简单地在下面扩展这个枚举类，创建一堆静态变量（不需要初始化它们），然后在你的枚举类的定义下方调用 yourEnumClass::init() .

编辑：这只适用于 php >= 5.3，但它可能被修改为在旧版本中也能工作

```
/**
 * A base class for enums. 
 * 
 * This class can be used as a base class for enums. 
 * It can be used to create regular enums (incremental indices), but it can also be used to create binary flag values.
 * To create an enum class you can simply extend this class, and make a call to <yourEnumClass>::init() before you use the enum.
 * Preferably this call is made directly after the class declaration. 
 * Example usages:
 * DaysOfTheWeek.class.php
 * abstract class DaysOfTheWeek extends Enum{
 *      static $MONDAY = 1;
 *      static $TUESDAY;
 *      static $WEDNESDAY;
 *      static $THURSDAY;
 *      static $FRIDAY;
 *      static $SATURDAY;
 *      static $SUNDAY;
 * }
 * DaysOfTheWeek::init();
 * 
 * example.php
 * require_once("DaysOfTheWeek.class.php");
 * $today = date('N');
 * if ($today == DaysOfTheWeek::$SUNDAY || $today == DaysOfTheWeek::$SATURDAY)
 *      echo "It's weekend!";
 * 
 * Flags.class.php
 * abstract class Flags extends Enum{
 *      static $FLAG_1;
 *      static $FLAG_2;
 *      static $FLAG_3;
 * }
 * Flags::init(Enum::$BINARY_FLAG);
 * 
 * example2.php
 * require_once("Flags.class.php");
 * $flags = Flags::$FLAG_1 | Flags::$FLAG_2;
 * if ($flags & Flags::$FLAG_1)
 *      echo "Flag_1 is set";
 * 
 * @author Tiddo Langerak
 */
abstract class Enum{

    static $BINARY_FLAG = 1;
    /**
     * This function must be called to initialize the enumeration!
     * 
     * @param bool $flags If the USE_BINARY flag is provided, the enum values will be binary flag values. Default: no flags set.
     */ 
    public static function init($flags = 0){
        //First, we want to get a list of all static properties of the enum class. We'll use the ReflectionClass for this.
        $enum = get_called_class();
        $ref = new ReflectionClass($enum);
        $items = $ref->getStaticProperties();
        //Now we can start assigning values to the items. 
        if ($flags & self::$BINARY_FLAG){
            //If we want binary flag values, our first value should be 1.
            $value = 1;
            //Now we can set the values for all items.
            foreach ($items as $key=>$item){
                if (!isset($item)){                 
                    //If no value is set manually, we should set it.
                    $enum::$$key = $value;
                    //And we need to calculate the new value
                    $value *= 2;
                } else {
                    //If there was already a value set, we will continue starting from that value, but only if that was a valid binary flag value.
                    //Otherwise, we will just skip this item.
                    if ($key != 0 && ($key & ($key - 1) == 0))
                        $value = 2 * $item;
                }
            }
        } else {
            //If we want to use regular indices, we'll start with index 0.
            $value = 0;
            //Now we can set the values for all items.
            foreach ($items as $key=>$item){
                if (!isset($item)){
                    //If no value is set manually, we should set it, and increment the value for the next item.
                    $enum::$$key = $value;
                    $value++;
                } else {
                    //If a value was already set, we'll continue from that value.
                    $value = $item+1;
                }
            }
        }
    }
} 
```

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2015-03-01T03:48:22.560

```
class DayOfWeek {
    static $values = array(
        self::MONDAY,
        self::TUESDAY,
        // ...
    );

    const MONDAY  = 0;
    const TUESDAY = 1;
    // ...
}

$today = DayOfWeek::MONDAY;

// If you want to check if a value is valid
assert( in_array( $today, DayOfWeek::$values ) ); 
```

不要使用反射。这使得推理您的代码和追踪正在使用的东西变得极其困难，并且往往会破坏静态分析工具（例如，内置在您的 IDE 中的东西）。

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2018-05-26T17:39:36.957

现在您可以使用**SplEnum**类在本地构建它。根据官方文档。

> SplEnum 提供了在 PHP 中本地模拟和创建枚举对象的能力。

```
<?php
class Month extends SplEnum {
    const __default = self::January;

    const January = 1;
    const February = 2;
    const March = 3;
    const April = 4;
    const May = 5;
    const June = 6;
    const July = 7;
    const August = 8;
    const September = 9;
    const October = 10;
    const November = 11;
    const December = 12;
}

echo new Month(Month::June) . PHP_EOL;

try {
    new Month(13);
} catch (UnexpectedValueException $uve) {
    echo $uve->getMessage() . PHP_EOL;
}
?> 
```

请注意，这是一个必须安装的扩展程序，但默认情况下不可用。它属于PHP 网站本身描述的[特殊类型。](http://php.net/manual/en/book.spl-types.php)上面的例子取自 PHP 站点。

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2012-11-29T08:36:18.310

公认的答案是要走的路，实际上是我为了简单而做的事情。提供了枚举的大多数优点（可读、快速等）。但是，缺少一个概念：类型安全。在大多数语言中，枚举也用于限制允许的值。下面是如何通过使用私有构造函数、静态实例化方法和类型检查来获得类型安全的示例：

```
class DaysOfWeek{
 const Sunday = 0;
 const Monday = 1;
 // etc.

 private $intVal;
 private function __construct($intVal){
   $this->intVal = $intVal;
 }

 //static instantiation methods
 public static function MONDAY(){
   return new self(self::Monday);
 }
 //etc.
}

//function using type checking
function printDayOfWeek(DaysOfWeek $d){ //compiler can now use type checking
  // to something with $d...
}

//calling the function is safe!
printDayOfWeek(DaysOfWeek::MONDAY()); 
```

我们甚至可以更进一步：在 DaysOfWeek 类中使用常量可能会导致误用：例如，人们可能会错误地以这种方式使用它：

```
printDayOfWeek(DaysOfWeek::Monday); //triggers a compiler error. 
```

这是错误的（调用整数常量）。我们可以使用私有静态变量而不是常量来防止这种情况：

```
class DaysOfWeeks{

  private static $monday = 1;
  //etc.

  private $intVal;
  //private constructor
  private function __construct($intVal){
    $this->intVal = $intVal;
  }

  //public instantiation methods
  public static function MONDAY(){
    return new self(self::$monday);
  }
  //etc.

  //convert an instance to its integer value
  public function intVal(){
    return $this->intVal;
  }

} 
```

当然，不可能访问整数常量（这实际上是目的）。intVal 方法允许将 DaysOfWeek 对象转换为其整数表示形式。

请注意，我们甚至可以通过在实例化方法中实现缓存机制来更进一步，以在枚举被广泛使用的情况下节省内存......

希望这会有所帮助

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2011-04-13T20:53:26.853

这是我对“动态”枚举的看法......所以我可以用变量来调用它，例如。从一个表格。

**查看此代码块下方的更新版本...**

```
$value = "concert";
$Enumvalue = EnumCategory::enum($value);
//$EnumValue = 1

class EnumCategory{
    const concert = 1;
    const festival = 2;
    const sport = 3;
    const nightlife = 4;
    const theatre = 5;
    const musical = 6;
    const cinema = 7;
    const charity = 8;
    const museum = 9;
    const other = 10;

    public function enum($string){
        return constant('EnumCategory::'.$string);
    }
} 
```

**更新：更好的方法......**

```
class EnumCategory {

    static $concert = 1;
    static $festival = 2;
    static $sport = 3;
    static $nightlife = 4;
    static $theatre = 5;
    static $musical = 6;
    static $cinema = 7;
    static $charity = 8;
    static $museum = 9;
    static $other = 10;

} 
```

打电话给

```
EnumCategory::${$category}; 
```

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2013-01-15T02:11:07.383

指出的解决方案效果很好。干净光滑。

但是，如果你想要强类型枚举，你可以使用这个：

```
class TestEnum extends Enum
{
    public static $TEST1;
    public static $TEST2;
}
TestEnum::init(); // Automatically initializes enum values 
```

Enum 类看起来像：

```
class Enum
{
    public static function parse($enum)
    {
        $class = get_called_class();
        $vars = get_class_vars($class);
        if (array_key_exists($enum, $vars)) {
            return $vars[$enum];
        }
        return null;
    }

    public static function init()
    {
        $className = get_called_class();
        $consts = get_class_vars($className);
        foreach ($consts as $constant => $value) {
            if (is_null($className::$$constant)) {
                $constantValue = $constant;
                $constantValueName = $className . '::' . $constant . '_VALUE';
                if (defined($constantValueName)) {
                    $constantValue = constant($constantValueName);
                }
                $className::$$constant = new $className($constantValue);
            }
        }
    }

    public function __construct($value)
    {
        $this->value = $value;
    }
} 
```

这样，枚举值是强类型的，并且

`TestEnum::$TEST1 === TestEnum::parse('TEST1') // true statement`

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2013-02-21T19:26:41.220

这里有一些好的解决方案！

这是我的版本。

*   它是强类型的
*   它适用于 IDE 自动完成
*   枚举由代码和描述定义，其中代码可以是整数、二进制值、短字符串，或者基本上是您想要的任何其他内容。该模式可以很容易地扩展以支持其他属性。
*   它支持值 (==) 和引用 (===) 比较并在 switch 语句中工作。

我认为主要缺点是枚举成员确实必须单独声明和实例化，因为描述和 PHP 无法在静态成员声明时构造对象。我想解决这个问题的方法可能是使用反射和解析的文档注释。

抽象枚举如下所示：

```
<?php

abstract class AbstractEnum
{
    /** @var array cache of all enum instances by class name and integer value */
    private static $allEnumMembers = array();

    /** @var mixed */
    private $code;

    /** @var string */
    private $description;

    /**
     * Return an enum instance of the concrete type on which this static method is called, assuming an instance
     * exists for the passed in value.  Otherwise an exception is thrown.
     *
     * @param $code
     * @return AbstractEnum
     * @throws Exception
     */
    public static function getByCode($code)
    {
        $concreteMembers = &self::getConcreteMembers();

        if (array_key_exists($code, $concreteMembers)) {
            return $concreteMembers[$code];
        }

        throw new Exception("Value '$code' does not exist for enum '".get_called_class()."'");
    }

    public static function getAllMembers()
    {
        return self::getConcreteMembers();
    }

    /**
     * Create, cache and return an instance of the concrete enum type for the supplied primitive value.
     *
     * @param mixed $code code to uniquely identify this enum
     * @param string $description
     * @throws Exception
     * @return AbstractEnum
     */
    protected static function enum($code, $description)
    {
        $concreteMembers = &self::getConcreteMembers();

        if (array_key_exists($code, $concreteMembers)) {
            throw new Exception("Value '$code' has already been added to enum '".get_called_class()."'");
        }

        $concreteMembers[$code] = $concreteEnumInstance = new static($code, $description);

        return $concreteEnumInstance;
    }

    /**
     * @return AbstractEnum[]
     */
    private static function &getConcreteMembers() {
        $thisClassName = get_called_class();

        if (!array_key_exists($thisClassName, self::$allEnumMembers)) {
            $concreteMembers = array();
            self::$allEnumMembers[$thisClassName] = $concreteMembers;
        }

        return self::$allEnumMembers[$thisClassName];
    }

    private function __construct($code, $description)
    {
        $this->code = $code;
        $this->description = $description;
    }

    public function getCode()
    {
        return $this->code;
    }

    public function getDescription()
    {
        return $this->description;
    }
} 
```

这是一个示例具体枚举：

```
<?php

require('AbstractEnum.php');

class EMyEnum extends AbstractEnum
{
    /** @var EMyEnum */
    public static $MY_FIRST_VALUE;
    /** @var EMyEnum */
    public static $MY_SECOND_VALUE;
    /** @var EMyEnum */
    public static $MY_THIRD_VALUE;

    public static function _init()
    {
        self::$MY_FIRST_VALUE = self::enum(1, 'My first value');
        self::$MY_SECOND_VALUE = self::enum(2, 'My second value');
        self::$MY_THIRD_VALUE = self::enum(3, 'My third value');
    }
}

EMyEnum::_init(); 
```

可以这样使用：

```
<?php

require('EMyEnum.php');

echo EMyEnum::$MY_FIRST_VALUE->getCode().' : '.EMyEnum::$MY_FIRST_VALUE->getDescription().PHP_EOL.PHP_EOL;

var_dump(EMyEnum::getAllMembers());

echo PHP_EOL.EMyEnum::getByCode(2)->getDescription().PHP_EOL; 
```

并产生这个输出：

> 1：我的第一个值
> 
> ```
> array(3) {  
>   [1]=>  
>   object(EMyEnum)#1 (2) {  
>     ["code":"AbstractEnum":private]=>  
>     int(1)  
>     ["description":"AbstractEnum":private]=>  
>     string(14) "My first value"  
>   }  
>   [2]=>  
>   object(EMyEnum)#2 (2) {  
>     ["code":"AbstractEnum":private]=>  
>     int(2)  
>     ["description":"AbstractEnum":private]=>  
>     string(15) "My second value"  
>   }  
>   [3]=>  
>   object(EMyEnum)#3 (2) {  
>     ["code":"AbstractEnum":private]=>  
>     int(3)  
>     ["description":"AbstractEnum":private]=>  
>     string(14) "My third value"  
>   }  
> } 
> ```
> 
> 我的第二个价值观

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2015-03-31T00:28:37.090

这里的其他一些答案中缺少的一个方面是一种使用带有类型提示的枚举的方法。

如果您将枚举定义为抽象类中的一组常量，例如

```
abstract class ShirtSize {
    public const SMALL = 1;
    public const MEDIUM = 2;
    public const LARGE = 3;
} 
```

那么你不能在函数参数中输入提示它 - 一方面，因为它不是可实例化的，而且还因为类型`ShirtSize::SMALL`is `int`， not `ShirtSize`。

这就是为什么 PHP 中的原生枚举比我们能想到的任何东西都要好。但是，我们可以通过保留一个表示枚举值的私有属性来近似枚举，然后将该属性的初始化限制为我们预定义的常量。为了防止枚举被任意实例化（没有类型检查白名单的开销），我们将构造函数设为私有。

```
class ShirtSize {
    private $size;
    private function __construct ($size) {
        $this->size = $size;
    }
    public function equals (ShirtSize $s) {
        return $this->size === $s->size;
    }
    public static function SMALL () { return new self(1); }
    public static function MEDIUM () { return new self(2); }
    public static function LARGE () { return new self(3); }
} 
```

然后我们可以`ShirtSize`这样使用：

```
function sizeIsAvailable ($productId, ShirtSize $size) {
    // business magic
}
if(sizeIsAvailable($_GET["id"], ShirtSize::LARGE())) {
    echo "Available";
} else {
    echo "Out of stock.";
}
$s2 = ShirtSize::SMALL();
$s3 = ShirtSize::MEDIUM();
echo $s2->equals($s3) ? "SMALL == MEDIUM" : "SMALL != MEDIUM"; 
```

这样，从用户的角度来看，最大的不同是您必须`()`在常量名称上加上 a。

一个缺点是`===`（比较对象相等性）在`==`返回 true 时将返回 false。出于这个原因，最好提供一种`equals`方法，这样用户就不必记住使用`==`而不是`===`比较两个枚举值。

编辑：一些现有的答案非常相似，特别是：[https](https://stackoverflow.com/a/25526473/2407870) ://stackoverflow.com/a/25526473/2407870 。

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2015-10-09T14:55:57.740

踩着@Brian Cline 的答案，我想我可能会给我 5 美分

```
<?php 
/**
 * A class that simulates Enums behaviour
 * <code>
 * class Season extends Enum{
 *    const Spring  = 0;
 *    const Summer = 1;
 *    const Autumn = 2;
 *    const Winter = 3;
 * }
 * 
 * $currentSeason = new Season(Season::Spring);
 * $nextYearSeason = new Season(Season::Spring);
 * $winter = new Season(Season::Winter);
 * $whatever = new Season(-1);               // Throws InvalidArgumentException
 * echo $currentSeason.is(Season::Spring);   // True
 * echo $currentSeason.getName();            // 'Spring'
 * echo $currentSeason.is($nextYearSeason);  // True
 * echo $currentSeason.is(Season::Winter);   // False
 * echo $currentSeason.is(Season::Spring);   // True
 * echo $currentSeason.is($winter);          // False
 * </code>
 * 
 * Class Enum
 * 
 * PHP Version 5.5
 */
abstract class Enum
{
    /**
     * Will contain all the constants of every enum that gets created to 
     * avoid expensive ReflectionClass usage
     * @var array
     */
    private static $_constCacheArray = [];
    /**
     * The value that separates this instance from the rest of the same class
     * @var mixed
     */
    private $_value;
    /**
     * The label of the Enum instance. Will take the string name of the 
     * constant provided, used for logging and human readable messages
     * @var string
     */
    private $_name;
    /**
     * Creates an enum instance, while makes sure that the value given to the 
     * enum is a valid one
     * 
     * @param mixed $value The value of the current
     * 
     * @throws \InvalidArgumentException
     */
    public final function __construct($value)
    {
        $constants = self::_getConstants();
        if (count($constants) !== count(array_unique($constants))) {
            throw new \InvalidArgumentException('Enums cannot contain duplicate constant values');
        }
        if ($name = array_search($value, $constants)) {
            $this->_value = $value;
            $this->_name = $name;
        } else {
            throw new \InvalidArgumentException('Invalid enum value provided');
        }
    }
    /**
     * Returns the constant name of the current enum instance
     * 
     * @return string
     */
    public function getName()
    {
        return $this->_name;
    }
    /**
     * Returns the value of the current enum instance
     * 
     * @return mixed
     */
    public function getValue()
    {
        return $this->_value;
    }
    /**
     * Checks whether this enum instance matches with the provided one.
     * This function should be used to compare Enums at all times instead
     * of an identity comparison 
     * <code>
     * // Assuming EnumObject and EnumObject2 both extend the Enum class
     * // and constants with such values are defined
     * $var  = new EnumObject('test'); 
     * $var2 = new EnumObject('test');
     * $var3 = new EnumObject2('test');
     * $var4 = new EnumObject2('test2');
     * echo $var->is($var2);  // true
     * echo $var->is('test'); // true
     * echo $var->is($var3);  // false
     * echo $var3->is($var4); // false
     * </code>
     * 
     * @param mixed|Enum $enum The value we are comparing this enum object against
     *                         If the value is instance of the Enum class makes
     *                         sure they are instances of the same class as well, 
     *                         otherwise just ensures they have the same value
     * 
     * @return bool
     */
    public final function is($enum)
    {
        // If we are comparing enums, just make
        // sure they have the same toString value
        if (is_subclass_of($enum, __CLASS__)) {
            return get_class($this) === get_class($enum) 
                    && $this->getValue() === $enum->getValue();
        } else {
            // Otherwise assume $enum is the value we are comparing against
            // and do an exact comparison
            return $this->getValue() === $enum;   
        }
    }

    /**
     * Returns the constants that are set for the current Enum instance
     * 
     * @return array
     */
    private static function _getConstants()
    {
        if (self::$_constCacheArray == null) {
            self::$_constCacheArray = [];
        }
        $calledClass = get_called_class();
        if (!array_key_exists($calledClass, self::$_constCacheArray)) {
            $reflect = new \ReflectionClass($calledClass);
            self::$_constCacheArray[$calledClass] = $reflect->getConstants();
        }
        return self::$_constCacheArray[$calledClass];
    }
} 
```

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2020-01-05T04:59:58.560

基于[这个 gist](https://gist.github.com/the-liquid-metal/a2608f197e1241d11c956890b7c8a635)，所有枚举的基类：

```
abstract class Enum {
    protected $val;

    protected function __construct($arg) {
        $this->val = $arg;
    }

    public function __toString() {
        return $this->val;
    }

    public function __set($arg1, $arg2) {
        throw new Exception("enum does not have property");
    }

    public function __get($arg1) {
        throw new Exception("enum does not have property");
    }

    // not really needed
    public function __call($arg1, $arg2) {
        throw new Exception("enum does not have method");
    }

    // not really needed
    static public function __callStatic($arg1, $arg2) {
        throw new Exception("enum does not have static method");
    }
} 
```

你的枚举：

```
final class MyEnum extends Enum {
    static public function val1() {
        return new self("val1");
    }

    static public function val2() {
        return new self("val2");
    }

    static public function val3() {
        return new self("val3");
    }
} 
```

测试它：

```
$a = MyEnum::val1();
echo "1.the enum value is '$a'\n";

function consumeMyEnum(MyEnum $arg) {
    return "2.the return value is '$arg'\n";
}

echo consumeMyEnum($a);
$version = explode(".", PHP_VERSION);
if ($version[0] >= 7) {
    try {
        echo consumeMyEnum("val1");
    } catch (TypeError $e) {
        echo "3.passing argument error happens (PHP 7.0 and above)\n";
    }
}

echo ($a == MyEnum::val1()) ? "4.same\n" : "4.different\n";
echo ($a == MyEnum::val2()) ? "5.same\n" : "5.different\n";

$b = MyEnum::val1();
echo ($a == $b)  ? "6.same\n" : "6.different\n";
echo ($a === $b) ? "7.same\n" : "7.different\n";

$c = MyEnum::val2();
echo ($a == $c)  ? "8.same\n" : "8.different\n";
echo ($a === $c) ? "9.same\n" : "9.different\n";

switch ($c) {
    case MyEnum::val1(): echo "10.case of 1st\n"; break;
    case MyEnum::val2(): echo "11.case of 2nd\n"; break;
    case MyEnum::val3(): echo "12.case of 3rd\n"; break;
}

try {
    $a->prop = 10;
} catch (Exception $e) {
    echo "13.set property error happens\n";
}

try {
    echo $a->prop;
} catch (Exception $e) {
    echo "14.get property error happens\n";
}

try {
    echo $a->meth();
} catch (Exception $e) {
    echo "15.method call error happens\n";
}

try {
    echo MyEnum::meth();
} catch (Exception $e) {
    echo "16.static method call error happens\n";
}

class Ordinary {}
echo $a instanceof MyEnum   ? "17.MyEnum instance\n"   : "17.not MyEnum instance\n";
echo $a instanceof Enum     ? "18.Enum instance\n"     : "18.not Enum instance\n";
echo $a instanceof Ordinary ? "19.Ordinary instance\n" : "19.not Ordinary instance\n"; 
```

在线尝试：[沙盒](http://sandbox.onlinephpfunctions.com/code/2af23ef344ed1af47785e4dedf7bbc96d84f172f)

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2011-02-19T15:57:58.980

昨天我[在我的博客上](http://arturgspb.ru/read/enum-v-php-zhestkaya-tipizaciya-perechislenij.html)写了这门课。我认为在 php 脚本中使用它可能很容易：

```
final class EnumException extends Exception{}

abstract class Enum
{
    /**
     * @var array ReflectionClass
     */
    protected static $reflectorInstances = array();
    /**
     * Массив конфигурированного объекта-константы enum
     * @var array
     */
    protected static $enumInstances = array();
    /**
     * Массив соответствий значение->ключ используется для проверки - 
     * если ли константа с таким значением
     * @var array
     */
    protected static $foundNameValueLink = array();

    protected $constName;
    protected $constValue;

    /**
     * Реализует паттерн "Одиночка"
     * Возвращает объект константы, но но как объект его использовать не стоит, 
     * т.к. для него реализован "волшебный метод" __toString()
     * Это должно использоваться только для типизачии его как параметра
     * @paradm Node
     */
    final public static function get($value)
    {
        // Это остается здесь для увеличения производительности (по замерам ~10%)
        $name = self::getName($value);
        if ($name === false)
            throw new EnumException("Неизвестая константа");
        $className = get_called_class();    
        if (!isset(self::$enumInstances[$className][$name]))
        {
            $value = constant($className.'::'.$name);
            self::$enumInstances[$className][$name] = new $className($name, $value);
        }

        return self::$enumInstances[$className][$name];
    }

    /**
     * Возвращает массив констант пар ключ-значение всего перечисления
     * @return array 
     */
    final public static function toArray()
    {
        $classConstantsArray = self::getReflectorInstance()->getConstants();
        foreach ($classConstantsArray as $k => $v)
            $classConstantsArray[$k] = (string)$v;
        return $classConstantsArray;
    }

    /**
     * Для последующего использования в toArray для получения массива констант ключ->значение 
     * @return ReflectionClass
     */
    final private static function getReflectorInstance()
    {
        $className = get_called_class();
        if (!isset(self::$reflectorInstances[$className]))
        {
            self::$reflectorInstances[$className] = new ReflectionClass($className);
        }
        return self::$reflectorInstances[$className];
    }

    /**
     * Получает имя константы по её значению
     * @param string $value
     */
    final public static function getName($value)
    {
        $className = (string)get_called_class();

        $value = (string)$value;
        if (!isset(self::$foundNameValueLink[$className][$value]))
        {
            $constantName = array_search($value, self::toArray(), true);
            self::$foundNameValueLink[$className][$value] = $constantName;
        }
        return self::$foundNameValueLink[$className][$value];
    }

    /**
     * Используется ли такое имя константы в перечислении
     * @param string $name
     */
    final public static function isExistName($name)
    {
        $constArray = self::toArray();
        return isset($constArray[$name]);
    }

    /**
     * Используется ли такое значение константы в перечислении
     * @param string $value
     */
    final public static function isExistValue($value)
    {
        return self::getName($value) === false ? false : true;
    }   

    final private function __clone(){}

    final private function __construct($name, $value)
    {
        $this->constName = $name;
        $this->constValue = $value;
    }

    final public function __toString()
    {
        return (string)$this->constValue;
    }
} 
```

用法：

```
class enumWorkType extends Enum
{
        const FULL = 0;
        const SHORT = 1;
} 
```

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2012-08-27T23:03:18.687

我尝试用 PHP 创建一个枚举...它非常有限，因为它不支持将对象作为枚举值，但仍然有些用...

```
class ProtocolsEnum {

    const HTTP = '1';
    const HTTPS = '2';
    const FTP = '3';

    /**
     * Retrieve an enum value
     * @param string $name
     * @return string
     */
    public static function getValueByName($name) {
        return constant('self::'. $name);
    } 

    /**
     * Retrieve an enum key name
     * @param string $code
     * @return string
     */
    public static function getNameByValue($code) {
        foreach(get_class_constants() as $key => $val) {
            if($val == $code) {
                return $key;
            }
        }
    }

    /**
     * Retrieve associate array of all constants (used for creating droplist options)
     * @return multitype:
     */
    public static function toArray() {      
        return array_flip(self::get_class_constants());
    }

    private static function get_class_constants()
    {
        $reflect = new ReflectionClass(__CLASS__);
        return $reflect->getConstants();
    }
} 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2015-01-14T10:46:44.100

```
// My Enumeration Class
class Enum
{
    protected $m_actions = array();

    public function __construct($actions)
    {
        $this->init($actions);
    }

    public function init($actions)
    {
        $this->m_actions = array();
        for($i = 0; $i < count($actions); ++$i)
        {
            $this->m_actions[$actions[$i]] = ($i + 1); 
            define($actions[$i], ($i + 1));
        }
    }

    public function toString($index)
    {
        $keys = array_keys($this->m_actions);
        for($i = 0; $i < count($keys); ++$i)
        {
            if($this->m_actions[$keys[$i]] == $index)
            {
                return $keys[$i];
            }
        }

        return "undefined";
    }

    public function fromString($str)
    {
        return $this->m_actions[$str];
    }
}

// Enumeration creation
$actions = new Enum(array("CREATE", "READ", "UPDATE", "DELETE"));

// Examples
print($action_objects->toString(DELETE));
print($action_objects->fromString("DELETE"));

if($action_objects->fromString($_POST["myAction"]) == CREATE)
{
    print("CREATE");
} 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2017-05-06T21:27:49.970

不使用反射的更简单和更轻的版本：

```
abstract class enum {
    private function __construct() {}
    static function has($const) {
        $name = get_called_class();
        return defined("$name::$const");
    }
    static function value($const) {
        $name = get_called_class();
        return defined("$name::$const")? constant("$name::$const") : false;
    }
} 
```

用法：

```
class requestFormat  extends enum { const HTML = 1; const JSON = 2; const XML  = 3; const FORM = 4; }

echo requestFormat::value('JSON'); // 2
echo requestFormat::has('JSON');   // true 
```

这提供了常量的优势，也允许检查它们的有效性，但它缺乏由更复杂的解决方案提供的其他花哨的功能，给出的是这个问题，更明显的是无法检查值的反转（在上面的示例中，您无法检查“2”是否为有效值）

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2018-01-23T12:57:55.623

如果您想要类型安全和一堆与该类型匹配的常量，一种方法是为您的枚举创建一个抽象类，然后使用锁定的构造函数扩展该类，如下所示：

```
abstract class DaysOfWeekEnum{
    public function __construct(string $value){
        $this->value = $value; 
    }
    public function __toString(){
        return $this->value;
    }

}
class Monday extends DaysOfWeekEnum{
    public function __construct(){
        parent::__construct("Monday");
    }
}

class Tuesday extends DaysOfWeekEnum{
    public function __construct(){
        parent::__construct("Tuesday");
    }
} 
```

然后，您可以让您的方法获取 DaysOfWeek 的实例，并将星期一、星期二等的实例传递给它......唯一的缺点是每次您想使用枚举时都必须“新建”一个实例，但我发现这值得。

```
function printWeekDay(DaysOfWeek $day){
    echo "Today is $day.";
}

printWeekDay(new Monday()); 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2021-09-12T22:12:38.853

我刚刚创建了一个希望能完成这项工作的*库。*它可以在任何 PHP 项目中独立使用，并且有一些 Laravel 好东西可以让生活更轻松。我在生产项目中使用它们。

[https://github.com/Kwaadpepper/enum](https://github.com/Kwaadpepper/enum)

如果您喜欢或不喜欢，请随时提供反馈。它可以打印出来，并序列化为 JSON。它的定义很简单。

用法很简单：

```
$enum = BasicEnum::someValue();
echo $enum->equals(BasicEnum::someValue()) ? 'true' : 'false'; // true
echo $enum->value; // 'someValue' or the value you have defined
echo $enum->label; // 'someValue' or the label you have defined
echo $enum; // 'someValue' or the value you have defined
echo json_encode($enum); // {"label": "someValue", "value: "someValue" } 
```

枚举定义非常简单（值和标签方法是可选的）

```
/**
 * @method static self post()
 * @method static self about()
 * @method static self contact()
 */
class PostType extends BaseEnum
{
    protected static function values(): array
    {
        return [
            'post' => 0,
            'about' => 1,
            'contact' => 2
        ];
    }

    protected static function labels(): array
    {
        return [
            'post' => 'Regular posts',
            'about' => 'The about page',
            'contact' => 'The contact page'
        ];
    }
} 
```

* * *

## 回答 #38

> 赞同：-1
> 
> 时间：2021-08-06T14:50:07.533

另一种方法是使用魔术方法 __set 并将枚举设为私有。

例如

```
class Human{
    private $gender;

    public function __set($key, $value){
        if($key == 'day' && !in_array($value, array('Man', 'Woman')){
            new Exception('Wrong value for '.__CLASS__.'->'.$key);
        }
        else{
            $this->$key = $value;
        }
        ...
    }
} 
```

每当类本身之外的代码尝试设置类属性时，都会调用此魔术方法。这适用于 PHP5 - 8。

* * *

## 回答 #39

> 赞同：-3
> 
> 时间：2012-05-03T08:49:52.883

对于简单的枚举，我使用如下结构。通常，您可以将它们用于 switch 语句。

```
<?php 
  define("OPTION_1", "1");
  define("OPTION_2", OPTION_1 + 1);
  define("OPTION_3", OPTION_2 + 1);

  // Some function...
   switch($Val){
    case OPTION_1:{ Perform_1();}break;
    case OPTION_2:{ Perform_2();}break;
    ...
  }
?> 
```

它不像 C++ 中的本机枚举那样方便，但如果您以后想在两者之间添加一个选项，它似乎可以工作并且需要较少的维护。

# sql-server - 将 MOSS 2007 从 SQL 2000 迁移到 SQL 2005

> ID：254517
> 
> 赞同：1
> 
> 时间：2008-10-31T18:53:36.647
> 
> 标签：sql-server, sql-server-2005, sharepoint, sharepoint-2007

我们安装了 MOSS 2007，它使用 MS SQL 2000 作为后端数据库。MOSS 的 Web 前端位于一台服务器上，而数据库位于另一台服务器上。我们想将数据库移动到 MS SQL 2005 服务器。有推荐的方法吗？有谁知道任何提供提示、技巧、教程和最佳实践的资源？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-03T11:02:39.230

*   关闭 SharePoint 服务
*   备份 SQL 2000 数据库（配置、内容）
*   将备份恢复到 SQL 2005
*   运行“stsadm -o setconfigdb -databaseserver”
*   删除“中央管理 > 应用程序 > 内容数据库”中的内容数据库连接
*   在“中央管理 > 应用程序 > 内容数据库”中添加到内容数据库的新连接

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-01T18:40:23.177

我想由于您只是迁移数据库，并且使用相同版本的 Sharepoint，因此应该适用将数据库从 SQL Server 2000 迁移到 2005 的一般建议。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T19:57:27.833

我不知道回答你自己的问题是否俗气，但现有的答案都没有对我有用。

我最终重建了农场。具体来说，我...

1.  通过运行 SharePoint 产品和技术配置向导从现有内容数据库中分离。
2.  将相关内容数据库从 SQL 2000 服务器复制到 SQL 2005 服务器。也就是说，从 SQL2000 保存备份，然后将它们恢复到 SQL2005。
3.  重新运行 SharePoint 产品和技术配置向导以创建新场。这将创建一个全新的配置数据库。
4.  在设置 Admin SSP 时，我确保指定了已移动到 SQL2005 的现有内容数据库。
5.  重新配置的 SSP。

这种方法虽然相当激进，但还有一个额外的好处是允许我重命名数据库、SSP、IIS 中的设置（即网站和应用程序池）。我们的安装是对 SPS2003 的就地升级，所以数据库名称和 SSP 有点笨拙。重新创建农场使我能够重新配置事物，使其更类似于默认的 MOSS 2007 安装。

# c++ - GCC 编译的静态库包含什么？

> ID：254526
> 
> 赞同：7
> 
> 时间：2008-10-31T18:56:38.293
> 
> 标签：c++, gcc, static-libraries

我的应用程序链接到 libsamplerate.a。我这样做是为了更容易分发最终的二进制文件。

我担心 .a 文件中的代码可能取决于我还需要分发的其他一些库。

但如果不是这样，我担心我会因为包含多个副本而使我的应用程序过于臃肿。库。

libsamplerate.a 中到底有什么？只是 libsamperate 的字节码？或者更多？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-31T19:10:55.877

.a 文件基本上只是一堆 .o 文件。您可以使用该`ar`工具进行演示。

例如，要显示库的内容：

```
ar -t libsamplerate.a 
```

要从头开始创建 .a 文件：

```
ar -r tim.a *.txt 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-31T19:13:38.400

静态库只是目标文件的集合。当您针对静态库编译程序时，程序使用的函数的目标代码将从库复制到可执行文件中。链接到静态库不会导致该库之外的任何函数包含在您的代码中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T18:59:20.177

只是 libsamplerate 的目标代码。静态链接单个库不会使所有库都静态链接。那会很糟糕。

# visual-studio-2008 - Visual Studio 设计器错误

> ID：254539
> 
> 赞同：2
> 
> 时间：2008-10-31T18:59:00.910
> 
> 标签：visual-studio-2008

我在一个紧凑的框架表单上遇到了这个错误。

“属性'inputControl'的代码生成失败。错误是：'对象引用未设置为对象的实例。'”

有人知道为什么吗？它才刚刚开始，以前从来都不是问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-03T20:29:02.203

当用户控件无法加载到 Visual Studio 设计器中时，您需要执行此操作。这些指令适用于 vb.net 项目，但 c# 应该类似。此外，在执行此操作之前，请关闭所有打开的窗口（或至少关闭您正在处理的控件的源文件和设计器文件。）

最后一件事。您应该做的第一件事是确保重新启动 Visual Studio 不能解决问题。如果没有，您可以尝试以下步骤。这些说明假定错误的用户控件位于 Visual Studio 的控件库项目中。如果不是，您应该能够稍微调整方向以使其工作，但当控件位于其自己的项目中时，它会容易得多。

请执行下列操作：

1.  使控件库成为您的启动项目。
2.  打开控件库项目的属性，然后单击调试选项卡。
3.  在 Start Action 下单击 Start external program 选项并浏览到 Visual Studio 可执行文件。

注意：这意味着当您运行解决方案时，它将启动另一个 Visual Studio 实例，而不是实际运行您的解决方案。Visual Studion 的第一个实例 (INSTANCE_1) 将在您运行时“托管”第二个 Visual Studio 实例 (INSTANCE_2)。

4.  运行您的解决方案。INSTANCE_2 将加载。
5.  切换回 INSTANCE_1。
6.  在 INSTANCE_1 中按 CTRL-ALT-E。这将打开例外对话框。选中 Common Language Runtime Exceptions 旁边的 THROWN 列复选框。

注意：这将确保 INSTANCE_1 将在任何运行时错误时中断，即使它在 try 块中被击中。

7.  切换到 INSTANCE_2。在解决方案资源管理器中双击打开错误用户控件。

您应该会发现 INSTANCE_1 OF Visual Studio 应该在导致设计器不加载控件的代码行处停止。修复代码（这通常意味着在引用对象属性之前测试 IsNot Nothing ......但可能意味着其他事情。）

此外，有时我发现控件将在 INSTANCE_2 中加载，而不是在 INSTANCE_1 中出现错误。在这种情况下，只需停止调试...关闭 INSTANCE_2。保存/重新启动 INSTANCE_1，您的问题通常会消失。

教训是这样的。用户控件必须能够加载/引用所有对象及其成员，以便将其加载到设计器中。因此，对于将被放置到其他容器上的用户控件，我通常会设计事件来通知父控件，而不是尝试将对象推送到子控件中。

希望这有助于将来参考这个老问题。

赛斯

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T19:07:29.410

查看“inputControl”最初被访问的位置，并确保它被正确实例化。

# linq - How can I get my orderby to work using an anonymous type?

> ID：254544
> 
> 赞同：6
> 
> 时间：2008-10-31T18:59:58.957
> 
> 标签：linq

What do I put in my order by?? I want to order by Name. I have moved the orderby after the distinct because I read that it needs to be done last.

```
 var result = (from r in db.RecordDocs
                  where r.RecordID == recordID
                  select new
                             {
                                 DocTypeID = r.Document.DocType.DocTypeID,
                                 Name = r.Document.DocType.Name,
                                 Number = r.Document.DocType.Number
                             }
                 ).Distinct().OrderBy( ); 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-31T19:01:41.433

Just do

```
.OrderBy(doc => doc.Name) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-31T19:19:17.623

Another option, if you really prefer the query expression syntax would be to chain your query construction across multiple statements:

```
var query = from r in db.RecordDocs
    where r.RecordID == recordID
    select new
    {
        DocTypeID = r.Document.DocType.DocTypeID,
        Name = r.Document.DocType.Name,
        Number = r.Document.DocType.Number
    };

query = query.Disctinct();
query = from doc in query orderby doc.Name select doc; 
```

Since all of these methods are deferred, this will result in the exact same execution performance.

# sql - 查询中的七个内部联接是否太多？

> ID：254546
> 
> 赞同：14
> 
> 时间：2008-10-31T19:01:30.000
> 
> 标签：sql, inner-join

我有一个有 7 个内部联接的查询（因为很多信息分布在其他表中），一些同事感到惊讶。我想知道他们是否应该感到惊讶还是有 7 个内部连接正常？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-31T19:04:07.607

这并非闻所未闻，但为了便于使用和维护，我会将其置于视图中

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-31T19:04:31.163

两个问题：

1.  它有效吗？
2.  你能解释一下吗？

如果是这样，那么七就可以了。如果您无法解释查询，那么七个太多了。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-31T19:03:41.227

如果您的架构是第[5 范式](http://en.wikipedia.org/wiki/Fifth_normal_form)，这很正常：)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-31T19:05:51.643

根据您要完成的任务，查询中的大量连接并不显着。

就个人而言，我不太关心用于返回所需结果集的连接数量，而更关心查询是否经过优化并在可接受的参数范围内运行。

如果查询已完全优化并且无法缩减，但查询本身执行速度不够快，则数据结构设计可能不适合您尝试执行的操作。此时，您可以重新评估您要完成的工作或为您的业务模型提供数据的结构。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-31T19:06:15.717

这一点也不稀奇。对于像 Siebel 这样的系统，通常会看到两位数的连接计数。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-31T19:06:15.747

七个连接使得可读性更难，但更重要的是性能和可伸缩性。如果这些都可以，那就去吧。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-31T19:05:59.833

这可能不正常，但肯定不会过度。如果您发现自己一遍又一遍地加入相同的表，请创建一些视图。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-31T19:06:39.490

连接的数量取决于您的数据模型，如果您查询的是 7 个连接，则可以在您的查询中 - 我记得在我很久以前工作的应用程序中有类似的查询，性能取决于许多因素（表大小，索引，服务器负载，服务器配置等等），我认为不能一概而论地认为 7 个连接是不好的。

如果它对你有用，那么我想它很好：D

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-31T20:12:17.657

是的，这很正常——但实际上，从性能的角度来看，这并不是一个好主意。由于查询计划是建立在*估计*成本之上的，因此当您增加连接（或任何其他运算符，就此而言）[时，错误数量会增加：](http://blogs.msdn.com/queryoptteam/archive/2006/08/29/730521.aspx)

> SQL Server 查询优化器将估计至少一行来自查找运算符。这样做是为了避免由于基数低估而选择非常昂贵的子树的情况。如果估计子树返回零行，许多计划的成本大致相同，因此计划选择可能会出现错误。因此，您会注意到这种情况下的估计值“很高”，并且可能会导致一些错误。您可能还注意到，我们估计此分支执行了 20 次，而不是实际的 10 次。但是，考虑到在此运算符之前已评估的连接数，不考虑偏离 2 倍（10 行）太糟糕了。（**错误会随着连接的数量呈指数增长**）。

此外，优化器会尝试平衡制定计划所需的时间与潜在的节省——它不会花一整天的时间来寻找最佳计划。连接越多，存在的替代计划的数量就越多——其中一些可能比优化器有时间找到的更优化。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-01T01:13:12.230

7 甚至更多在数据仓库中一点也不稀奇，因为事实表很容易拥有十几个维度的外键。在数据仓库场景中，维度的基数通常低于事实表，因此维度上的过滤器有助于通过索引查找或扫描来利用事实表。

对于规范化事务模式，如果结果集的基数在主基表中较低（即选择关于一个客户的所有内容）通常不是问题，因为外键通常可以简单地导致索引查找或索引扫描。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-31T19:12:38.760

如果您的数据库设计需要，7 很好。但是，如果 7 是实现您的目标所必需的，我会重新检查数据库设计以确保这种模糊程度确实是必要的。

出于好奇，这是 DB2 吗？只是我注意到的一个模式:)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-31T19:28:35.687

这是同一张表上的 7 个内连接，不同表上的 7 个内连接，还是 7 个*嵌套*内连接？

...诡计问题！没关系，如果这是您的数据库结构所需要的，那么它是正确的

警告：如果它是同一张表上的 7 个嵌套内部连接，则您可能有一个结构不良的表；-)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-31T20:15:14.313

这当然不是不寻常的。然而，至少在 Oracle 中，7 是一个特殊的数字，因为超过这个数字，优化器就不能再测试每个连接顺序（由于可能性数量的阶乘增长）。因此，除非您准备好照看您的执行计划，否则避免超过 7 是明智的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-31T19:08:05.180

我认为您要避免的是大于 7 的连接深度。深度小于 7 的 7 个内部连接肯定不是闻所未闻，但有时人们听到“7 连接”并认为禁止是 7 连接，不是深度。

# java - 尝试运行我的 java swing 应用程序时，Win Vista 上缺少 msvcr71.dll 文件

> ID：254553
> 
> 赞同：0
> 
> 时间：2008-10-31T19:03:40.307
> 
> 标签：java, .net, windows-vista, exe4j

我做了很多搜索，我意识到我可以下载这个文件并将其安装在 windows/system32 或应用程序的目录中。我的问题是，这个 dll 通常如何安装在 Vista 上？我尝试安装 .net framework 3.5 并没有安装它。

背景：我正在运行一个使用 exe4j 包装为 exe 的 java.jar。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-31T19:10:08.827

msvcr71.dll 是 Visual Studio 2003 的 Microsoft Visual C++ Common Runtime。使用 VS2003 开发的应用程序通常会安装它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-19T06:54:32.273

i tried this fix to resolve MSVCR71.dll missing error in Windows 7 X64: [http://backspacetab.com/2011/05/09/msvcr71-dll-windows-7-x64/](http://backspacetab.com/2011/05/09/msvcr71-dll-windows-7-x64/) Its only for 64Bit users... 32bit users follow the guide here: [http://i.justrealized.com/2009/how-to-fix-missing-msvcr71dll-problem-in-windows/](http://i.justrealized.com/2009/how-to-fix-missing-msvcr71dll-problem-in-windows/) Thanks and enjoy !!

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T19:07:38.130

您是否尝试过使用“java -jar java.jar”执行？它会产生相同的结果吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T19:19:42.427

由于 VS 2003 针对的是旧版本的 .NET 并且不是 Vista 上受支持的开发环境，因此它可能只有在应用程序的安装程序安装时才会安装在 Vista 上。

我不知道 .NET 1.1 可再发行组件是否会在 Vista 上安装它，但值得在虚拟机中尝试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-01T15:46:39.487

您的问题可能与这些 Sun 错误有关 -

[http://bugs.sun.com/view_bug.do?bug_id=6560269](http://bugs.sun.com/view_bug.do?bug_id=6560269) 和 [http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6648440](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6648440)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-03T18:50:13.047

升级到最新的exe4j（4.1版）解决了这个问题！

# javascript - 改进工具提示代码

> ID：254558
> 
> 赞同：1
> 
> 时间：2008-10-31T19:04:31.897
> 
> 标签：javascript, jquery, tooltip

我正在尝试构建一个可悬停的 Jquery 工具提示。当我将鼠标悬停在某个元素上时，此工具提示应该出现，如果我也选择将鼠标悬停在工具提示本身上，则保持原样。只有当我将鼠标悬停在原始元素或工具提示正文之外时，工具提示才会消失。

基于我发现的一个示例，我设法创建了这种行为，但由于我是 Jquery 的新手，我很高兴听到您关于改进该功能的意见。

## 编码：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<script src="jquery-1.2.6.min.js"></script>
<style>
#tooltip{
       position:absolute;
       border:1px solid #333;
       background:#f7f5d1;
       padding:2px 5px;
       color:#333;
       display:none;
       text-align: left;
}

</style>

</head>
<body>

<script type="text/javascript">
jQuery.fn.extend({
       'tooltip': function(text){
                               xOffset = 10;
                               yOffset = 20;

                               var that = this;
                       $(this).mouseover(function(e){
                               this.t = text;
                               $("body").append("<div id='tooltip'>"+ this.t +"</div>");
                               $("#tooltip")
                                       .css('position', 'absolute')
                                       .css("top",(e.pageY - xOffset) + "px")
                                       .css("left",(e.pageX + yOffset) + "px")
                                       .fadeIn("fast");
                   });
                       $(this).mouseout(function(){
                               that.hide_ff = setTimeout('$("#tooltip").hidetooltip()', 1000);
                               $("#tooltip").hover(function(){
                                       clearTimeout (that.hide_ff);
                               },
                               function(){
                                       $("#tooltip").hidetooltip()
                               });

                               //$("#tooltip").hidetooltip()
                   });
                       $(this).mousemove(function(e){
                               $("#tooltip")
                                       .css("top",(e.pageY - xOffset) + "px")
                                       .css("left",(e.pageX + yOffset) + "px");
                       });
       },

       'hidetooltip': function()
       {
               var that = this;
               $(this).remove();
               if (that.hide_ff)
               {
                       clearTimeout (that.hide_ff);
               }
       }
});

</script>
<a id="fff">ToolTip</a>

<div id="tooltip_share_text" style="display:none">
       <div style="width: 100px;">
       This is a Tooltip.
       <br/>
       <a href="javascript:void(0)" onclick="alert('boo')"> Click Me</a>
       </div>
</div>
<script type="text/javascript">
$(document).ready(function() {
       $("#fff").tooltip($('#tooltip_share_text').html());
});
</script>

</body>
</html> 
```

* * *

最困扰我的是两件事：

1.  我需要用 2 个函数（工具提示和隐藏工具提示）扩展 Jquery，我想只用一个扩展来实现相同的行为，但我没有成功实现这一点。
2.  我对“that.hide_ff”的使用似乎不正确。再一次，我认为这个变量应该属于一个“工具提示”对象，但如果我没记错的话，它是附加到 Jquery 对象本身的。

此外，我很高兴听到任何其他改进......

在此先感谢，戈迪

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T19:55:32.917

JQuery有一个[工具提示插件](http://bassistance.de/jquery-plugins/jquery-plugin-tooltip/)。如果您想自己动手，我相信您可以通过查看他们所做的来获得想法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-27T02:22:29.410

我不确定你是否仍然对此感兴趣......已经快一年了

但我稍微修改了你的代码：

*   我摆脱了 hidetooltip （额外的扩展）
*   使用 that.hide_ff 很好，所以我没有改变它
*   工具提示会在链接末尾弹出，并且不会随鼠标移动 - 我认为它看起来更干净。
*   切换了 xOffset 和 yOffset
*   注释掉原来的 mousemove 代码，如果你不喜欢它可以改回来。

```
jQuery.fn.extend({
 “工具提示”：函数（文本）{
  xOffset = 10；
  y偏移= 20；

  var that = this;
  $(this).mouseover(function(e){
   this.t = 文本；
   $("body").append(""+ this.t +"");
   $("#tooltip")
    .css('位置', '绝对')
    .css("top",(this.offsetTop + yOffset) + "px") /* .css("top",(e.pageY - xOffset) + "px") */
    .css("left",(this.offsetLeft + this.offsetWidth) + "px") /* .css("left",(e.pageX + yOffset) + "px") */
    .fadeIn("快");
  });
  $(this).mouseout(function(){
   that.hide_ff = setTimeout('$("#tooltip").remove()', 500);
   $("#tooltip").hover(函数(){
    clearTimeout (that.hide_ff);
    },
    功能（）{
     $("#tooltip").remove();
    }
   );
  });
/*
  $(this).mousemove(function(e){
   $("#tooltip")
    .css("top",(e.pageY - xOffset) + "px")
    .css("left",(e.pageX + yOffset) + "px");
  });
*/
 }
});

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-27T02:37:56.093

我发现[qTip](http://craigsworks.com/projects/qtip/)已经满足了我所有的工具提示需求：

# c# - 你能在 C# 中乱序枚举一个集合吗？

> ID：254573
> 
> 赞同：13
> 
> 时间：2008-10-31T19:07:08.460
> 
> 标签：c#, loops, foreach

有没有办法使用`foreach`循环向后或以完全随机的顺序遍历集合？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-31T19:15:05.323

使用`System.Linq`你可以做...

```
// List<...> list;
foreach (var i in list.Reverse())
{
} 
```

对于随机顺序，您必须使用`list.OrderBy`（另一个 Linq 扩展）对其进行随机排序，然后迭代该有序列表。

```
var rnd = new Random();
var randomlyOrdered = list.OrderBy(i => rnd.Next());
foreach (var i in randomlyOrdered)
{
} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-31T19:31:16.163

正如其他答案所提到的，[`Reverse()`扩展方法](http://msdn.microsoft.com/en-us/library/bb358497.aspx)将让您以相反的顺序枚举一个序列。

这是一个随机枚举扩展方法：

```
public static IEnumerable<T> OrderRandomly<T>(this IEnumerable<T> sequence)
{
    Random random = new Random();
    List<T> copy = sequence.ToList();

    while (copy.Count > 0)
    {
        int index = random.Next(copy.Count);
        yield return copy[index];
        copy.RemoveAt(index);
    }
} 
```

你的用法是：

```
foreach (int n in Enumerable.Range(1, 10).OrderRandomly())
    Console.WriteLine(n); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T19:14:48.367

我认为没有办法直接这样做，但几乎可以使用*通过**关键字*`as good`返回新集合的扩展方法。这些可能来自预先存在的库；其他人指出 LINQ 有一个方法，类似的东西也可以工作。*`yield return`*`Reverse``OrderBy`

示例：如果您在`Reverse()`上使用 LINQ 扩展方法`IEnumerable<T>`，该方法用于`yield return`以相反的顺序提供集合，那么执行 a`foreach(var myThing in myCollection.Reverse())`将以相反的顺序枚举集合。

*重要*：`yield return`是关键。它的意思是“当我枚举这个集合时，然后去取东西。” 与仅构建一个*新*的反向集合的替代方法相反，这种方法效率极低并且可能有副作用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T20:06:13.427

从 C# 2.0 开始，您可以使用 yield 关键字非常轻松地实现自定义迭代器。[您可以在 MSDN http://msdn.microsoft.com/en-us/library/9k7k7cf0.aspx](http://msdn.microsoft.com/en-us/library/9k7k7cf0.aspx)上阅读有关 yield 关键字的更多信息

您可以将 yield 视为从循环内部返回值的能力，但您应该参考上面的链接以获取有关它们是什么以及它们可以做什么的完整说明。

我写了一个关于如何实现几个自定义迭代器的简短示例。我已经将它们实现为扩展方法 ( [http://msdn.microsoft.com/en-us/library/bb383977.aspx](http://msdn.microsoft.com/en-us/library/bb383977.aspx) ) 以使代码更加流线型，并且我还使用数组初始化器 ( [http://msdn .microsoft.com/en-us/library/aa664573.aspx](http://msdn.microsoft.com/en-us/library/aa664573.aspx)）设置整数列表的初始值。

扩展方法和数组初始化器都不是实现自定义迭代器所必需的，但它们是 c# 3.0 的好特性，有助于编写更简洁的代码

这是我的例子。它展示了如何通过仅返回奇数、偶数、反转或完全随机方式的数字来迭代整数列表。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            List<int> ints = 
                new List<int> { 1,2,3,4,5,6,7,8,9,10};

            Console.WriteLine("Iterating over Odd numbers only.");
            foreach (int i in ints.Odd())
            {
                Console.WriteLine(i);
            }

            Console.WriteLine("Iterating over Even numbers only.");
            foreach (int i in ints.Even())
            {
                Console.WriteLine(i);
            }

            Console.WriteLine("Iterating over the list in reversed order.");
            foreach (int i in ints.Reversed())
            {
                Console.WriteLine(i);
            }

            Console.WriteLine("Iterating over the list in random order.");
            foreach (int i in ints.Random())
            {
                Console.WriteLine(i);
            }

            Console.ReadLine();
        }
    }

    public static class ListExtensions
    {
        /// <summary>
        /// Iterates over the list only returns even numbers
        /// </summary>
        /// <param name="list"></param>
        public static IEnumerable<int> Even(this List<int> list)
        {
            foreach (var i in list)
            {
                if (i % 2 == 0)
                 {
                    yield return i;
                }
           }
        }

        /// <summary>
        /// Iterates over the list only returns odd numbers
        /// </summary>
        public static IEnumerable<int> Odd(this List<int> list)
        {
            foreach (var i in list)
            {
                if (i % 2 != 0)
                {
                    yield return i;
                }
            }
        }

        /// <summary>
        /// Iterates over the list in reversed order
        /// </summary>
        public static IEnumerable<int> Reversed(this List<int> list)
        {
            for (int i = list.Count; i >= 0; i--)
            {
                yield return i;
            }
        }

        /// <summary>
        /// Iterates over the list in random order
        /// </summary>
        public static IEnumerable<int> Random(this List<int> list)
        {
            // Initialize a random number generator with a seed.
            System.Random rnd =
                new Random((int)DateTime.Now.Ticks);

            // Create a list to keep track of which indexes we've
            // already returned
            List<int> visited =
                new List<int>();

            // loop until we've returned the value of all indexes
            // in the list
            while (visited.Count < list.Count)
            {
                int index =
                    rnd.Next(0, list.Count);

                // Make sure we've not returned it already
                if (!visited.Contains(index))
                {
                    visited.Add(index);
                    yield return list[index];
                }
            }
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-31T20:51:39.230

我实际上很喜欢使用 LINQ 的 cfeduke 方法，但它让我很不爽，因为它让我忘记了。添加到我之前的示例。如果你想在 LINQ 的帮助下进行奇偶迭代，你可以使用

```
// Even
foreach (var i in ints.FindAll(number => number % 2 == 0))
{
      Console.WriteLine(i);
}

// Odd
foreach (var i in ints.FindAll(number => number % 2 != 0))
{
      Console.WriteLine(i);
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-31T21:00:23.567

使用[C5 Generic Collection Library](http://www.itu.dk/research/c5)`IList<T>`中的一个，反向迭代是一个特性，而不是扩展：

```
foreach (var i in list.Reverse())
{
} 
```

同样，您可以使用该`Shuffle()`方法获得随机排序：

```
var listClone = (IList<T>) list.Clone();
listClone.Shuffle();
foreach (var i in listClone)
{
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-31T19:13:53.780

你可以倒着做：

```
for (int i=col.count-1; i>0; i--){ 
      DoSomething ( col.item[i]) ;
} 
```

不确定确切的语法，但这是范式。

至于完全随机的顺序，您可以通过它的索引访问集合元素。为确保您点击了每个项目，您需要跟踪您已经处理了哪些元素（可能通过复制集合，然后在访问后删除元素）。

编辑：随机访问的更多详细信息随机访问的代码可能如下所示：

```
 collection c = originalCollection;
 while (c.count > 0) {
     int i = randomNumber(seed) mod c.count
     element d = c[i];
     c.remove(d);
     DoSomething(d);
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-31T19:17:23.180

您可以通过提供自己的 Comparator 对 List 进行排序并迭代该列表。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-31T19:44:11.740

你想收集一个集合并与之互动吗？

如果是，试试这个：

```
Random rand = new Random(Environment.TickCount);

test.Sort((string v1, string v2) => {
                if (v1.Equals(v2))
                {
                    return 0;
                }

                int x = rand.Next();
                int y = rand.Next();

                if (x == y)
                {
                    return 0;
                }
                else if (x > y)
                {
                    return 1;
                }

                return -1; 
            });

for (string item in test)
{
  Console.WriteLn(item);
}
// Note that test is List<string>; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-31T19:57:52.210

根据我对 C# 语言规范的阅读，foreach 迭代语句取决于正在迭代的结构/类/接口，其中定义了 GetEnumerator() 函数。GetEnumerator() 返回的对象必须将 MoveNext() 定义为成员函数。MoveNext() 定义为在第一次调用时访问列表中的“第一个”对象，然后在后续调用中访问“下一个”对象，返回 true 直到列表中不存在其他元素，然后返回 false。

Domenic 所指的特性 yield return 首次出现在规范的 2.0 版本中，并且似乎对此目的有用。对于 1.1 版，您唯一的选择是从您的基础派生一个新的结构/类/接口并覆盖 GetEnumerator() 以返回一个新的 IEnumerator，其中 MoveNext() 函数将遵循不同的规则来选择第一个集合元素和任何后续收集元素。

我自己的建议是使用索引集合，然后使用带有适当索引计算的 for 循环（如果需要，可以使用随机数生成器，使用整数数组或其他一些技术来验证相同的索引值不是使用两次）如果你必须在实际实践中这样做。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-21T13:25:48.400

使用随机排序
[http://www.dailycoding.com/..using_linq.aspx](http://www.dailycoding.com/Posts/random_sort_a_list_using_linq.aspx)

```
List<Employee> list = new List<Employee>();

list.Add(new Employee { Id = 1, Name = "Davolio Nancy" });
list.Add(new Employee { Id = 2, Name = "Fuller Andrew" });
list.Add(new Employee { Id = 3, Name = "Leverling Janet" });
list.Add(new Employee { Id = 4, Name = "Peacock Margaret" });
list.Add(new Employee { Id = 5, Name = "Buchanan Steven" });
list.Add(new Employee { Id = 6, Name = "Suyama Michael" });
list.Add(new Employee { Id = 7, Name = "King Robert" });
list.Add(new Employee { Id = 8, Name = "Callahan Laura" });
list.Add(new Employee { Id = 9, Name = "Dodsworth Anne" });

list = list.OrderBy(emp => Guid.NewGuid()).ToList(); 
```

# linq-to-sql - LinkDataSource 无法加载 DataContext

> ID：254585
> 
> 赞同：1
> 
> 时间：2008-10-31T19:10:36.783
> 
> 标签：linq-to-sql, datacontext, linqdatasource

我正在尝试使用 VS 2008 在网页上填充下拉列表控件，并不断收到无法加载 DataContext 的错误。我的后端是一个 SQLx server 2005 DB。我创建了一个链接到 SQL 数据上下文并在其中有 1 个表。我的 LinKDataSource 如下 - asp:LinqDataSource ID="LinqDataSource1" runat="server"ContextTypeName="DACDataContext" TableName="portfolio"> /asp:LinqDataSource

我的下拉定义是：asp:DropDownList ID="ddlPortfolio" runat="server" Width="165px" DataSourceid="LinqDataSource1" DataTextField="porfolio_name" DataValueField="portfolio_id"> /asp:DropDownList 我可以在我的属性中看到我的 ContextTypeName 是 DACDataContext 的 DatContext

我得到的具体错误是：HttpException（0x80004005）：无法加载类型“DACDataContext”。

和

InvalidOperationException：找不到 LinqDataSource 'LinqDataSource1' 的 ContextTypeName 属性中指定的类型。]

我知道这一定是非常愚蠢的事情，但我束手无策。

请帮忙。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-31T19:42:55.050

验证 DACDataContext 是公共的，您也可以尝试完全限定类型（即 ContextTypeName="MyNamespace.DACDataContext"）

# security - 用户访问检查特定数据库对象或记录的权限

> ID：254610
> 
> 赞同：0
> 
> 时间：2008-10-31T19:17:01.700
> 
> 标签：security, asp-classic, authorization

我正在与开发人员就用户登录并访问 Web 应用程序中的文档的情况进行友好的辩论。当我们加载文档供用户查看时，我们有会话中的 userID 和可能通过 QueryString 传递的 documentID。

为了防止用户修改 QueryString 上的 documentID，我建议加载文档的存储过程将 UserId 作为参数来验证对文档的权限。

我的开发人员朋友建议我们在页面前面运行一个单独的过程来确定对文档的访问权限，并在应该显示文档时运行一个过程来抓取文档。

我们错过了什么吗？哪个最有效和最安全？我认为将带有 DocID 的 UserId 传递到一个过程调用中以检查权限并提取文档是一种更有效的解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T19:31:32.920

> 我建议加载文档的存储过程将 UserId 作为参数来验证对文档的权限。

我认为这是要走的路。如果没有其他原因，那就更安全了。如果您重复使用此过程，然后忘记检查访问权限 - 您已经打开了一个大洞。这样一来，除非您有权访问，否则您无法访问文档。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T19:30:24.403

userID 应该是一个会话变量。对。在查询字符串中传递 documentID。是的。

假设文档存储在数据库中，我将有一个权限表：一个记录 ID、一个用户 ID 和一个文档 ID。调用文档时，您可以与此表进行连接。如果你没有得到结果，你就没有得到文件。很好地索引它，它会很快。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T19:47:32.030

严格从性能的角度来看，将 UserID 与 DocumentID 一起传递到一个存储过程中是最好的。您只有一次到数据库服务器的往返行程。此外，正如其他人所指出的，如果您要从其他页面或应用程序中检索此文档，如果您使用相同的存储过程，则可以确保您没有绕过安全性这样做。

但是，在某些情况下，使用专用的安全验证存储过程是有意义的。如果除了文档之外，您还有其他要保护的资源，并且您的验证码不是微不足道的，那么您可能不想在数据库中的每个存储过程中复制验证码。在这种情况下，将安全基础架构移到数据访问层可能是有意义的，并让数据访问层在检索请求的资源之前进行 db 调用以授权访问。如果您采用这条路线，您不想依赖开发人员始终记住在请求资源之前进行授权数据库调用。

# html - 版权声明的语义 HTML 标记

> ID：254613
> 
> 赞同：20
> 
> 时间：2008-10-31T19:17:36.347
> 
> 标签：html, semantic-markup

当网站在知识共享下获得许可时，我使用[rel-license 微格式](http://microformats.org/wiki/rel-license)。当一个网站在常规版权下获得许可时，我有一个无聊的段落元素。

```
<p id="copyright">&copy; 2008 Example Corporation</p> 
```

那里的 id 属性仅用于 CSS 样式目的。我想知道是否有更好的方法来标记更具语义的版权声明。这是都柏林核心元数据的工作吗？如果是这样，我该怎么做？（我以前从未使用过都柏林核心。）

一些网站提倡在 head 元素中使用元标记：

```
<meta name="copyright" content="name of owner"> 
```

这可能会被搜索引擎看到，但不会取代页面本身上的用户可见通知。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-31T20:24:24.840

感谢 Owen 为我指明了 RDFa 的方向，我想我现在已经有了解决方案：

```
<div id="footer" xmlns:dc="http://purl.org/dc/elements/1.1/">
<p id="copyright" property="dc:rights">&copy;
  <span property="dc:dateCopyrighted">2008</span>
  <span property="dc:publisher">Example Corporation</span>
</p>
</div> 
```

根据具体情况，使用 dc:creator 而不是 dc:publisher 可能会更好。来自都柏林核心网站：

> 如果 Creator 和 Publisher 相同，请不要在 Publisher 区域重复名称。如果责任的性质不明确，推荐的做法是对组织使用 Publisher，对个人使用 Creator。如果责任较轻或不明确，除了创建之外，请使用 Contributor。

我还将为尚不支持 RDFa 的搜索引擎添加一个元标记到我的 head 元素中。

```
<meta name="copyright" content="&copy; 2008 Example Corporation" /> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-31T19:47:31.327

你看过[RDFa](http://www.w3.org/TR/2008/NOTE-xhtml-rdfa-primer-20081014/)吗？它[最近被接受](http://www.w3.org/News/2008#item174)为 W3C 推荐。我提到，以防万一你想看看它推荐的语义结构的其他方面。许可部分与您当前使用的格式相同。（所以从这个意义上回答你的问题，我认为你处理正确，假设人们采用 RDFa）

对于不想点击链接的懒人：

```
// RDFa recomendation and rel=license microformat
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/">
  a Creative Commons License
</a> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-31T19:31:37.240

标记它的最语义正确的方法可能是使用定义列表。

```
<dl id="copyright">
    <dt title="Copyright">&copy;</dt>
    <dd>2008 Example Corporation</dd>
</dl> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T19:22:05.840

为什么不使用抄送格式，但表示不授予任何权限？

在任何情况下，使用 CC 格式的主要问题是人们无法清楚地识别他们出现在网页上的哪些元素适用于它们。

# php - 拆分 PHP 网站

> ID：254616
> 
> 赞同：2
> 
> 时间：2008-10-31T19:18:00.183
> 
> 标签：php

我想知道如何将我的 index.php 主页拆分为多个 php 页面（即 header.php、footer.php）并使用这些单独的 php 页面构建一个工作 index.php 页面。我知道 WordPress 使用它具有不同的功能，例如：

```
GetHeader();
GetFoodter(); 
```

但是当我尝试使用这些功能时，它会出错。我猜它们不是 PHP 的原生函数。

我需要做什么才能获得此功能？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-31T19:19:12.273

```
include 'header.php';

include 'footer.php'; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T19:24:18.737

使用 Zend 之类的 MVC 框架。这样，您将保留更多可维护的代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T19:19:47.747

您可以执行以下操作：

```
<?php
    include('header.php');
    // Template Processing Code
    include('footer.php');
?> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T19:29:11.440

include() 语句包含并评估指定的文件。

因此，如果您将 index.php 创建为：

```
<?php
include("1.php"); include("2.php"); include("3.php");
?> 
```

处理它会将三个 php 文件（通过 php 解析它们的结果）组合到 index.php 的输出中...在[http://pl.php.net/manual/pl/function.include.php中查看更多信息](http://pl.php.net/manual/pl/function.include.php)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-28T03:08:06.083

另外，如果我没记错的话，你也可以使用

```
<?php
require('filename');
?> 
```

不同之处在于，如果 php 找不到您要包含的文件，它将停在那里而不是继续执行脚本...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-28T02:59:56.957

如果您的服务器进行了相应配置，您可以使用 PHP 内置的自动附加/前置设置并将其设置在 .htaccess 文件中：

php_value auto_prepend_file "header.php"
php_value auto_append_file "footer.php"

信息：
www.php.net/manual/en/configuration.changes.php#configuration.changes.apache
www.php.net/ini.core#ini.auto-prepend-file
www.php.net/ini.core# ini.auto 附加文件

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-30T19:53:56.567

我意识到这是一个老问题，它已经有一个完全有效的公认答案，但我想添加更多信息。

虽然`include 'file.php';`它本身很好，但将这些东西包装在函数中是有好处的，例如提供范围。

我对 PHP 有点陌生，所以昨晚我第一次尝试将东西分解成诸如`'header.php'`,`'footer.php'`之类的文件`'menu.php'`。

我遇到的一个问题是，当您在该页面或该部分中时，我希望页面/部分的菜单项以不同的方式突出显示。即在 StackOverflow 上的此页面上以橙色突出显示“问题”的方式相同。我可以在每个页面上定义一个将在包含中使用的变量，但这使得该变量具有全局性。如果将 include 包装在函数中，则可以定义具有本地范围的变量来处理它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-08-24T13:31:47.727

您还可以查看[Smarty 之](http://www.smarty.net/)类的模板引擎。这样，您可以在单个文件中定义页眉和页脚以及所有其他常见元素，然后通过较小的模板或直接输出填充其余部分。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-10-31T19:19:28.917

使用包含语句仅将这些文件包含到您的页面中

我想这是

```
include '[filename]' 
```

# python - 微小的python可执行文件？

> ID：254635
> 
> 赞同：9
> 
> 时间：2008-10-31T19:20:30.633
> 
> 标签：python, executable, pyinstaller

我计划使用 PyInstaller 创建一个独立的 python 可执行文件。PythonInstaller 带有对 UPX 的内置支持，并使用它来压缩可执行文件，但它们仍然非常庞大（大约 2.7 mb）。

有没有办法创建更小的 Python 可执行文件？例如使用缩小的 python.dll 或类似的东西？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-31T19:51:46.013

如果重新编译 pythonxy.dll，可以省略不需要的模块。从大小上看，剥离 unicode 数据库和 CJK 代码会产生最大的代码缩减。当然，这假设您不需要这些。从 pythoncore 项目中删除模块，并从 PC/config.c 中删除它们

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-02-04T20:54:15.003

如果您确实需要较小的文件大小，则使用较早的 Python 版本也会大大减小大小。我不建议使用非常旧的版本，Python2.3 将是最好的选择。我的 Python 可执行文件大小达到了 700KB！我也更喜欢 Py2Exe 而不是 Pyinstaller。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-01T06:32:59.870

你不能太小，因为你显然需要捆绑 Python 解释器，而且只需要相当大的空间。

我曾经有过同样的担忧，有两种方法：

1.  在要运行的计算机上安装 Python 并仅分发脚本
2.  在某个共享驱动器的内部网络中安装 Python，并安装用户的 PATH 以识别 Python 所在的位置。通过一些安装脚本/程序技巧，用户可能完全没有注意到这一点，您将可以分发最少的应用程序。

# java - jdbc：我什么时候可以关闭什么

> ID：254639
> 
> 赞同：2
> 
> 时间：2008-10-31T19:21:17.510
> 
> 标签：java, database, jdbc

目前我有以下基本结构的jdbc代码：

获取连接

（接下来的 4 行执行几次，从不关闭语句）
get 语句
获取结果集
处理结果集
关闭结果集

紧密连接

编写此代码后，我突然想到我需要关闭该语句。
1 不关闭语句有什么影响。
2 下面的工作，这个 si 会关闭语句阻止我正常处理结果集吗？

获取连接

（多次执行接下来的 5 行）
get statement
get result set
close statement
process result set
close result set

紧密连接

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-31T21:17:59.990

关闭行为在[JDBC 规范](http://jcp.org/aboutJava/communityprocess/final/jsr221/index.html)中指定。关闭连接会释放与连接关联的所有 JDBC 资源，并将隐式关闭所有语句、结果集等。关闭语句将关闭结果集。

示例 2 不保证有效。该语句应在使用 ResultSet 后关闭。规范说，如果你尝试使用那个 ResultSet，你应该得到一个 SQLException（一些 JDBC 驱动程序不严格遵循规范——而且 MS 不是最大的罪犯）。

如果您忘记关闭 ResultSet 或 Statement，最糟糕的情况是您消耗数据库和 JVM 资源的时间超过了必要的时间。在资源受限或高负载的系统上，这可能会导致内存/连接/资源错误或性能下降。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-31T19:26:31.493

不幸的是，答案取决于您的 JDBC 驱动程序。你在那里写的可能有用。

但是，一般规则是只有在完成相应的结果集后才关闭语句。

编辑：我意识到您有第二个问题，您询问了不关闭语句/结果集等的影响。效果还取决于您的 JDBC 驱动程序，但它可能导致严重的资源泄漏。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-10T20:45:12.033

如果您使用 Oracle 并忘记关闭您将得到的语句

```
ORA-01000: maximum open cursors exceeded 
```

过了一会儿。

# architecture - 网站架构设计的最佳工具

> ID：254651
> 
> 赞同：1
> 
> 时间：2008-10-31T19:26:30.790
> 
> 标签：architecture

您有什么工具可以推荐用于网站架构设计和分析吗？我已经检查了几个，例如 Poseidon UML、Adalon 和 FuseBuilder for ColdFusion、Mindmapper 和其他一些，但还没有找到任何似乎在允许快速高级规划之间取得正确平衡的东西（可以用头脑来完成映射）到更详细的架构和分析。UML 似乎是应用程序设计的终极目标，但我不认为像 Poseidon UML 这样的工具在创建快速初始设计时特别擅长。还有什么其他东西可以应用于任何编程语言，从 CF 到 C#。也许是工具的组合？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-31T19:38:08.210

我不会用 C 编写代码，但为了我的钱，我喜欢[Visio](http://office.microsoft.com/en-us/visio/default.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T19:58:27.497

我的幻想建模工具会

*   启用“智能板”
    *   录音白板
    *   充当其背后任何软件的“指点设备”以允许绘图/突出显示
    *   光学字符识别
*   像 3x5 卡片一样轻松记录故事
*   允许使用故事板 UI 屏幕进行用例演练（起初只是命名页面）
*   支持 Quick & Dirty Class 或 E/R 图表
*   导出为中性格式以导入更正式的建模工具。

不幸的是，我买不起硬件，而且我不认为软件以无缝方式存在。

所以

我使用白板、数码相机、“便笺”、录音、笔记本电脑进行分析或故事记录。

我使用 Poseidon 是因为缺少更好的 [负担得起的] 工具

wiki 对于发布用户/客户可以查看和评论的文档/内容很有用。

当其他人付费时，我也使用过 Visio。

我迫不及待地想看到这篇文章的其他回复，希望能找到更好的答案！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T19:41:48.797

安妮，就目前而言，我通常使用 Visio，尽管它不是一个快速简单地做事的好工具，因为它在大多数情况下使用起来很痛苦。

我不知道您是否感兴趣，但 Visual Studio 2010 的预览版即将发布，其中应包含一些“Oslo”位，这些位将有助于在同一个工具中构建您的用户故事、UML 图等，并允许您以有趣的方式将多个想法映射在一起。

我从 PDC 2008 docs/casts 中阅读了有关使用他们的新域语言“M”为您的域定义模型并允许您构建 SQL 以支持您的模型等的信息。至少从我能说出的完整内容来看成熟的架构工具集。看来你真的不需要使用 .NET 来利用它，如果它不是用于 .NET 的，它只是可以生成的代码对你没有多大好处，而是用例图，活动图表、用户故事、流程图、流程图、方面对于任何项目仍然非常有用。“M”DSL 还可以帮助您对实体进行建模，并通过一种工具使用 SQL。

正如我之前所说，出于几个原因，我不知道这些信息对您有多大用处。1）它还没有出来，2）它是一个 Visual Studio 的东西（据我所知），3）它的一些优点在 ​​.NET 框架中完全实现。

但是，话虽如此，即使您不使用 .NET，它仍然可以做很多事情，而且这些东西的预览版应该很快就会发布（应该是免费的）。不幸的是，这对你现在没有任何好处。但如果你像我一样，你会不断地寻找结果，看看它将如何影响你今天所做的事情以及明天你可以做的事情。所以至少它在这方面很有用:)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T09:17:28.007

魔术抽奖很好。您还可以查看 sybase UML 解决方案。

谈到未来，您可能会看到[VS2010 中的建模可能性](http://startbigthinksmall.wordpress.com/2008/10/27/microsoft-buzzword-bingo-with-oslo-m-quadrant-dublin-and-some-facts-about-net-framework-40-and-visual-studio-2010-october-2008-pre-pdc/)。但这只是前阿尔法状态。您还应该跟进 Oslo、M 和 Quadrant 的情况……

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-08T06:59:02.507

你可能对使用[ForeUI](http://www.foreui.com/)感兴趣，它是一个创建网站/软件架构模型的工具。

# iphone - 为什么我的 iPhone 应用程序崩溃了？

> ID：254661
> 
> 赞同：0
> 
> 时间：2008-10-31T19:29:42.173
> 
> 标签：iphone, objective-c, cocoa-touch

当我尝试分配 Texture2D 时，应用程序会崩溃。我已经检查了发生崩溃的代码......我只能说“EXC BAD ACCESS”。这是应用程序委托中导致其崩溃的行：

```
_textures[myTex] = [[Texture2D alloc] initWithImage: [UIImage imageNamed:@"sometex.png"]]; 
```

sometex.png 已通过“添加现有文件”添加到资源文件夹中。我已经能够在一些示例代码中很好地加载这个 png ......但是现在当我尝试复制示例代码的功能时，它只会崩溃。有任何想法吗？

我也可以很好地执行以下操作：

```
_textField = [[UITextField alloc] initWithFrame:CGRectMake(60, 214, 200, 30)]; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-31T20:00:18.213

您的资源中有“sometex.png”吗？如果您右键单击 Xcode 创建的 .app 并选择“显示包内容”，您在那里看到它吗？听起来它在构建时没有与您的应用程序捆绑在一起。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T19:50:09.667

看起来程序找不到“sometex.png”。当我用整个路径“users/ blah blah /sometex.png”替换“sometex.png”时，不会发生崩溃。

# javascript - 使用 ASP.Net ajax 库进行跨浏览器 Xml 操作

> ID：254662
> 
> 赞同：0
> 
> 时间：2008-10-31T19:29:59.287
> 
> 标签：javascript, ajax, asp.net-ajax

我目前正在更新一个在客户端代码中使用 ActiveX 对象来操作一些 xml 的 Web 应用程序。当然，这个应用程序只适用于 IE，我需要让它跨浏览器兼容。

我正在寻找一个 javascript xml 库来处理跨浏览器的怪事，并且想知道 ASP.Net ajax 库是否可以工作。我环顾四周，但我无法找到任何使用此加载新 xmldom 对象的示例。如果没有，我应该看看其他任何好的图书馆吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-31T19:56:30.327

一年多前，我面临着类似的问题。我决定尝试[JSON](http://json.org)，我从不后悔将 XML 抛在后面。在 JavaScript（和许多其他语言）中处理速度要快一个数量级，而且要容易得多。添加阵列增强功能之类的[原型](http://prototypejs.org)，你就可以做饭了。

当然，将我的数据传输从 XML 转换为 JSON 曾经很痛苦，但它很快就收回了成本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-01T00:11:57.440

如果您需要 XPath 或（不是 or 的*xor**类型*）XSL-T，那么您可能愿意看看[Google 的 AJAXSLT](http://goog-ajaxslt.sourceforge.net/)。

 *我不知道 ASP.NET Ajax 库包含任何特定的 XML 功能。

# c# - 在 C# 变量名前面放置 @ 有什么作用？

> ID：254669
> 
> 赞同：150
> 
> 时间：2008-10-31T19:33:00.717
> 
> 标签：c#

我一直在使用一些 C# 遗留代码，并且在变量名前面看到了很多 @ 符号。这意味着什么或做什么？

目前，我在具有未保留的通用名称的变量前面看到了很多。例如：

```
MyProcedure(@step.LoadInstanceId, @step.ResultCode, @step.StatusCode); 
```

鉴于该步骤不是保留字，是否有任何理由将它们转义？

* * *

## 回答 #1

> 赞同：207
> 
> 时间：2008-10-31T19:34:44.130

这只是一种允许将保留关键字声明为 var 的方法。

```
void Foo(int @string) 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-10-31T19:38:22.903

它允许您使用保留字（例如“public”）作为变量名。

```
string @public = "foo"; 
```

我不建议这样做，因为它会导致不必要的混乱。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-10-31T19:39:16.570

将 @ 放在字符串前面告诉编译器不要处理在字符串中找到的转义序列。

从[文档中](http://msdn.microsoft.com/en-us/library/362314fe(VS.71).aspx)：

@-quoting 的优点是不处理转义序列，这使得编写起来很容易，例如，一个完全限定的文件名：

```
@"c:\Docs\Source\a.txt"  // rather than "c:\\Docs\\Source\\a.txt" 
```

要在 @-quoted 字符串中包含双引号，请将其加倍：

```
@"""Ahoy!"" cried the captain." // "Ahoy!" cried the captain. 
```

@ 符号的另一个用途是使用恰好是 C# 关键字的引用 (/reference) 标识符。有关详细信息，请参阅[2.4.2 标识符](http://msdn.microsoft.com/en-us/library/aa664670(VS.71).aspx)。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-31T19:35:46.530

这会转义 C# 中的保留字。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-12-20T13:04:09.950

最初的问题询问一个人为什么会逃避一个非保留词的原因。我想到的是，如果`step`将来成为保留字，代码示例仍然可以编译。我想这也是代码生成器的有效选择。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-12-20T13:10:18.220

@ 符号与与语言关键字相同的标识符一起使用。这有两个主要用途 - 与非 C# 代码互操作。在 VB 或 IronPython 等语言中，关键字与 C# 中的关键字不同，它们可能声明了名称与 C# 关键字匹配的类和属性。如果此功能不存在，则此代码将无法在 C# 中访问。- 机器生成的代码。如果代码生成器基于某些外部源（例如 WSDL）生成代码，则生成器可以只在所有标识符前加上 @ 前缀，而不检查和转换与 C# 关键字匹配的标识符。

你确定你的案子不是第二个？

# sql - T-SQL：如何通过 ID 获取用户定义的列数据类型？

> ID：254671
> 
> 赞同：2
> 
> 时间：2008-10-31T19:33:32.213
> 
> 标签：sql, sql-server, sql-server-2005, tsql

我有一个这样的查询：

```
SELECT TABLE_NAME, COLUMN_NAME, IS_NULLABLE, DATA_TYPE
FROM MY_DB.INFORMATION_SCHEMA.COLUMNS
WHERE COLUMN_NAME = 'OrderId'
ORDER BY TABLE_NAME
GO 
```

该`OrderId`列是用户定义的数据类型。但`DATA_TYPE`在查询中显示了底层系统类型（即 bigint）。如何显示用户定义的类型名称？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-31T20:10:30.233

您可以更改 Where 子句：

```
SELECT 
    c.name as ColumneName, 
    c.colid As ColumnOrder, 
    st.name as UserType,
    bt.name as BaseType
FROM dbo.syscolumns c
INNER JOIN dbo.systypes st ON st.xusertype = c.xusertype
INNER JOIN dbo.systypes bt ON bt.xusertype = c.xtype
WHERE c.id = OBJECT_ID('TableName')
ORDER BY c.colid 
```

编辑 - 更完整的版本 - 享受！

```
SELECT 
    OBJECT_NAME(c.id) as TableName,
    c.name as ColumnName, 
    c.colid As ColumnOrder, 
    st.name as UserType,
    bt.name as BaseType
FROM 
    dbo.syscolumns c
    INNER JOIN dbo.systypes st ON st.xusertype = c.xusertype
    INNER JOIN dbo.systypes bt ON bt.xusertype = c.xtype
WHERE 
    OBJECTPROPERTY(c.id,'ISTABLE') = 1
    AND c.name = 'ColumnName'
ORDER BY
    OBJECT_NAME(c.id), 
    c.colid 
```

# c++ - 来自两个派生类的多重继承

> ID：254673
> 
> 赞同：27
> 
> 时间：2008-10-31T19:34:35.143
> 
> 标签：c++, inheritance, multiple-inheritance

我有一个充当接口的抽象基类。

我有两个“集”派生类，它们实现了抽象类的一半。（一个“set”定义了与初始化相关的抽象虚拟方法，另一个“set”定义了与实际“工作”相关的那些。）

然后我有派生类，它们使用多重继承来构造完全定义的类（并且本身不添加任何东西）。

所以：（错误的伪代码）

```
class AbsBase {
  virtual void init() = 0;
  virtual void work() = 0;
}

class AbsInit : public AbsBase {
  void init() { do_this(); }
  // work() still abs
}

class AbsWork : public AbsBase {
  void work() { do_this(); }
  // init() still abs
}

class NotAbsTotal : public AbsInit, public AbsWork {
  // Nothing, both should be defined
} 
```

首先，我可以这样做吗？我可以从两个派生自同一个 Base 的类继承吗？（但愿如此）。

不过，这是“真正的问题”（我在上面撒了一点谎以简化示例）。

我真正所做的是向基类添加非抽象访问器方法：

```
class AbsBase {
public:
  void init() { init_impl(); }
  void work() { work_impl(); }

private:
  virtual void init_impl() = 0;
  virtual void work_impl() = 0;
} 
```

因为，一个常见的习惯是将所有虚拟方法设为私有。

不幸的是，现在 AbsInit 和 AbsWork 都继承了这些方法，因此 NotAbsTotal 继承了“每个中的两个”（我意识到我可能正在扼杀编译时真正发生的事情）。

无论如何，g++ 在尝试使用该类时抱怨说：“对成员 init() 的请求不明确”。

我假设，如果我将 AbsBase 类用作纯接口，这将是可以避免的（假设上面的例子是有效的）。

所以： - 我的实施是否可行？- 这是将虚拟方法设为私有的习语的限制吗？- 我如何重构我的代码来做我想做的事？（提供一个通用接口，但允许使用一种方法来交换成员函数“集合”的实现）

编辑：

似乎我不是第一个： [http ://en.wikipedia.org/wiki/Diamond_problem](http://en.wikipedia.org/wiki/Diamond_problem)

似乎虚拟继承是这里的解决方案。我以前听说过虚拟继承，但我还没有深入了解它。我仍然愿意接受建议。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-31T19:47:54.540

看起来你想做虚拟继承。这是否真的是一个好主意是另一个问题，但这是你如何做到的：

```
 class AbsBase {...};
class AbsInit: public virtual AbsBase {...};
class AbsWork: public virtual AbsBase {...};
class NotAbsTotal: public AbsInit, public AbsWork {...}; 
```

基本上，默认的非虚拟多重继承将包括派生类中*每个基类*的副本，并包括它们的所有方法。这就是为什么您有两个 AbsBase 副本的原因——您的方法使用不明确的原因是两组方法都已加载，因此 C++ 无法知道要访问哪个副本！

虚拟继承将所有对虚拟基类的引用压缩到一个数据结构中。这应该使基类中的方法再次明确。但是，请注意：如果两个中间类中有额外的数据，可能会有一些小的额外运行时开销，以使代码能够找到共享的虚拟基类。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T19:43:29.337

它可以做到，尽管它让大多数人不寒而栗。

您需要使用“虚拟继承”，其语法类似于

```
class AbsInit: public virtual AbsBase {...};
class AbsWork: public virtual AbsBase {...};
class NotAbsTotal: public AbsInit, public AbsWork {...}; 
```

然后您必须指定要使用的功能：

```
NotAbsTotal::work()
{
    AbsInit::work_impl();
} 
```

（用正确的语法更新）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T19:46:01.220

您需要将继承声明为虚拟：

```
struct AbsBase {
          virtual void init() = 0;
          virtual void work() = 0;
};

struct AbsInit : virtual public AbsBase {
          void init() {  }
};

struct AbsWork : virtual public AbsBase {
          void work() { }
};

struct NotAbsTotal : virtual public AbsInit, virtual public AbsWork {
};

void f(NotAbsTotal *p)
{
        p->init();
}

NotAbsTotal x; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-01T01:05:26.113

您必须开始考虑您要在这里建模的内容。

公共继承只能用于模拟“isa”关系，例如狗是动物，正方形是形状等。

查看 Scott Meyer 的《Effective C++》一书，了解 OO 设计的各个方面只能被解释为什么的优秀文章。

编辑：我忘了说，虽然到目前为止提供的答案在技术上是正确的，但我认为它们中的任何一个都不能解决你试图建模的问题，这就是你问题的症结所在！

高温高压

干杯，

抢

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-09-03T00:45:24.567

我在下面的链接中找到了一个很好的简单示例。本文通过一个计算矩形面积和周长的示例程序进行了说明。你可以检查一下..干杯

多级继承是一种继承层次结构，其中一个派生类从多个基类继承。阅读更多..

[http://www.mobihackman.in/2013/09/multiple-inheritance-example.html](http://www.mobihackman.in/2013/09/multiple-inheritance-example.html)

# vb.net - 为什么使用只读属性比使用函数更好？

> ID：254694
> 
> 赞同：22
> 
> 时间：2008-10-31T19:43:12.817
> 
> 标签：vb.net

我发现使用属性之间几乎没有功能差异

```
public readonly property foo as string
  get
    return bar
  end get
end property 
```

或函数

```
public function foo() as string
  return bar
end function 
```

为什么我要使用一种形式而不是另一种形式？

谢谢！

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-31T19:48:20.450

我最近在 Visual Studio 杂志上阅读了一篇有趣的文章，其中讨论了方法和属性之间的区别。

除非在两者之间调用其他东西，否则属性应该每次都返回一个值和相同的值。

另一方面，通常期望方法在后台执行某些操作以获取值，或者该方法可能会在每次调用时更改值，例如 GetNextId() 或其他。

DateTime.Now 是一个很好的属性示例，它应该是一个方法，因为每次使用它都会返回不同的值。

**对于那些感兴趣的人-这是文章**

[在方法和属性之间进行选择](http://visualstudiomagazine.com/articles/2008/08/01/choose-between-methods-and-properties.aspx)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-31T19:44:55.577

这纯粹是外观问题。方法意味着执行此操作，而属性意味着获取一些数据。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-31T19:46:32.810

除了 James 提到的语义（意图声明）之外，属性发挥着特殊的作用，因为它们的值由调试器显示并且可以在视觉设计师中使用。

因此，请确保属性的值不会在没有外部操作的情况下发生变化，否则调试器会搞砸您的程序。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-31T20:05:31.837

据我了解，您不能对方法进行数据绑定；只有属性。因此，物业带来了额外的好处。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-31T20:26:08.317

如果您基于框架设计指南，则必须仅在实际执行操作或访问使用起来可能很昂贵的资源（数据库、网络）时才使用方法。

该属性给用户的印象是值存储在内存中，并且在调用方法时读取属性的速度可能比仅仅“获取值”具有更深的含义。

Brad Abrams 实际上写了[一篇](http://blogs.msdn.com/brada/archive/2003/11/13/50672.aspx)关于它的文章，甚至在[这里](http://msdn.microsoft.com/en-us/library/bzwdh01d(VS.71).aspx#cpconpropertyusageguidelinesanchor1)发布在 MSDN 上。

我强烈建议您购买《[框架设计指南》](https://rads.stackoverflow.com/amzn/click/com/0321246756)一书。这是每个开发者的必读之书。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-31T19:47:03.277

据我所知，这一切都编译成同一件事。.NET 的 IL 中的属性实际上只是一个名为 PropertyName 的属性的 getPropertyName 和 setPropertyName 函数。

所以在这方面它确实是一个风格问题。它只是更好地阅读以下内容：

```
person.Address.Street; 
```

而不是

```
person.Address().Street(); 
```

所以，在某种程度上，它确实是代码美学的问题。

不幸的是，在~~.NET~~ C# 中对我来说，它并不像 Ruby 那样优雅，因为它`()`始终是可选的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-31T20:37:39.417

我的观点是，如果你看一下这些词——“属性”与“方法”相比。“属性”一词意味着“这是对象中固有的一些值，例如颜色、大小、所有者……调用属性意味着返回该值的操作相对简单。或者，如果它不是只读的属性，设置属性应该也是一个比较简单（成本低）的操作。

另一方面，“方法”意味着“我必须做一些实际的工作来执行你要求我完成的任务”——而一个方法很可能会返回一个值（即使只是说“是的，我做到了” )，它正在做很多事情来为我获取该值-这样做，它将执行一些与获取该值相关的其他操作。

因此，它主要是语义的——只读属性可以作为一种方法令人满意地实现——但我会看看返回该值所涉及的内容，以及每个人都会发送给检索该属性或调用该方法的人的含义.

# asp.net - 奇怪的 Page.Response.Redirect 问题

> ID：254695
> 
> 赞同：1
> 
> 时间：2008-10-31T19:43:22.800
> 
> 标签：asp.net

我有一个登录页面，我在其中对用户进行身份验证。当身份验证通过后，我通过 Response.Redirect 将用户重定向到另一个页面，并使用登录控件的destinationpageurl 中定义的url。

它在 Firefox 中运行良好，但是当我用 IE 测试它时。它只是将用户重定向回登录页面。

有谁知道这里发生了什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-31T19:54:37.943

在安全方面，用户被重定向到的页面是否有限制？这可能是一个问题，在 IE 中您将其锁定，因此它不会保存 cookie，因此当用户被重定向时，他们会被发送回登录页面，因为看起来他们没有登录（实际上他们确实如此，只是下一页无法说明）。

我会尝试使用 Fiddler 来确认（看看你是否确实向下一页发送了请求）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-02T07:56:32.027

我有

```
<authorization>
<deny users="?"/>
<allow users="*"/>
</authorization> 
```

和

```
<authentication mode="Forms">
        <forms loginUrl="Login.aspx" 
         name=".ASPXFORMSAUTH" 
         protection="All" 
         timeout="30" 
         requireSSL="false" 
         slidingExpiration="true" 
         enableCrossAppRedirects="false">
        </forms>
</authentication> 
```

在我的 web.config 中。它确实在登录页面之后向 Default.aspx 页面发出请求，然后重定向回登录页面。我已经使用提琴手确认了它。

# oracle - 从 oracle PL/SQL 查看变量的值

> ID：254697
> 
> 赞同：2
> 
> 时间：2008-10-31T19:43:57.620
> 
> 标签：oracle, plsql

我正在运行一个应该调用存储过程的 PL/SQL 块，该存储过程的输出参数应该填充 PL/SQL 块中的变量。

过程编译，PL/SQL 块成功运行。但我想检查该过程填充的变量的值。有没有办法输出这些值？

如果有帮助，我正在使用 Free TOAD。

谢谢，

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-31T22:43:33.983

你有几个选择：

*   使用 DBMS_OUTPUT 记录
*   使用 UTL_FILE 记录到文件
*   使用 Oracle 调试器 DBMS_DEBUG

我的偏好是使用相当简单的自定义日志记录包记录到文件。在我的自定义日志记录包中，我有一个可配置的标志来在文件日志记录和 DBMS_OUTPUT 日志记录之间切换。

Oracle 调试 API 非常好，但您肯定需要一个好的调试客户端。Oracle SQL Developer 对它有相当好的支持。

还有一个 log4plsql 记录器，但我没有使用它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T19:53:26.650

```
dbms_output.put_line(varHere); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-14T20:11:23.060

第四个选项（我通常默认使用的选项）也存在.....将调试消息记录到数据库表中。这使您能够根据需要对调试消息进行排序、查询和过滤。

正如上面提到的darreljnz，log4plsql 也可能支持记录到数据库。我发现 1) dbms_output 有太多限制 2) 记录到文件需要太多设置，如果尚未设置 utl_file_dir 参数，则重新启动数据库 3) 在没有 GUI 帮助的情况下使用 dbms_debug 非常麻烦（但我已经做到了）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-14T20:46:42.693

如果您可以下载 Oracle jDeveloper [jDeveloper 主页](http://www.oracle.com/technology/products/jdev/index.html)或 Oracle Visual Studio 的副本，请添加[VS 插件](http://www.oracle.com/technology/tech/dotnet/tools/index.html)。两者都是免费的，并允许您在 db 上的 PL/SQL 中调试（设置断点、检查变量等）。您还需要数据库上的“调试”权限来执行此操作。但是，如果您有 dba 权限，您可以授予该权限。

# html - 禁用对 HTML 文本字段的拼写检查

> ID：254712
> 
> 赞同：306
> 
> 时间：2008-10-31T19:47:53.120
> 
> 标签：html, forms

我能否以某种方式禁用 HTML 文本字段的拼写检查（如 Safari 中所见）？

* * *

## 回答 #1

> 赞同：442
> 
> 时间：2008-10-31T19:49:24.553

**更新**：根据评论者的建议（[如何在 iPhone 上禁用文本输入的拼写检查器的](https://stackoverflow.com/questions/3416867/how-can-i-disable-the-spell-checker-on-text-inputs-on-the-iphone)附加功劳），使用它来处理所有桌面和移动浏览器。

```
<tag autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/> 
```

原始答案：Javascript 不能覆盖用户设置，因此除非您使用文本字段以外的其他机制，否则这是不可能的（或不应该是）。

* * *

## 回答 #2

> 赞同：218
> 
> 时间：2009-08-07T15:53:34.293

是的，使用[HTML5](https://html.spec.whatwg.org/multipage/interaction.html#spelling-and-grammar-checking)`spellcheck="false"`定义的，例如：

```
<textarea spellcheck="false">
    ...
</textarea> 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2018-05-11T23:11:30.020

对于语法，您可以使用：

```
<textarea data-gramm="false" /> 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-12-06T22:59:19.200

至少在 Chrome 中，IFrame 将“触发”拼写检查器（如果它的 content-editable 设置为 true），就像文本字段一样。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2018-10-27T12:40:37.823

以下代码片段对所有`textarea`和`input[type=text]`元素禁用它：

```
(function () {
    function disableSpellCheck() {
        let selector = 'input[type=text], textarea';
        let textFields = document.querySelectorAll(selector);

        textFields.forEach(
            function (field, _currentIndex, _listObj) {
                field.spellcheck = false;
            }
        );
    }

    disableSpellCheck();
})(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-11-12T18:58:27.513

虽然在 < tag > 中指定*spellcheck="false"*肯定会禁用该功能，但在页面加载后能够根据需要打开和关闭该功能很方便。*因此，这是一种以编程方式设置拼写检查*属性的非 jQuery 方法：

：

```
<textarea id="my-ta" spellcheck="whatever">abcd dcba</textarea> 
```

：

```
function setSpellCheck( mode ) {
    var myTextArea = document.getElementById( "my-ta" )
        , myTextAreaValue = myTextArea.value
    ;
    myTextArea.value = '';
    myTextArea.setAttribute( "spellcheck", String( mode ) );
    myTextArea.value = myTextAreaValue;
    myTextArea.focus();
} 
```

：

```
setSpellCheck( true );
setSpellCheck( 'false' ); 
```

函数参数可以是布尔值或字符串。

无需遍历 textarea 内容，我们只需剪切粘贴那里的内容，然后设置焦点。

在*闪烁*引擎（Chrome(ium)、Edge 等）中测试

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-02-08T12:28:24.140

如果您已动态创建 HTML 元素，您将希望通过 JS 禁用该属性。然而有一个小陷阱：

设置时`elem.contentEditable`，您可以使用 boolean`false`或 string `"false"`。但是当你设置时`elem.spellcheck`，你只能使用布尔值 - 出于某种原因。因此，您的选择是：

```
elem.spellcheck = false; 
```

或者[Mac](https://stackoverflow.com/a/64810105/6151750)在他的回答中提供的选项：

```
elem.setAttribute("spellcheck", "false"); // Both string and boolean work here. 
```

# windows - 从 Autohotkey（或 VB）调用 Windows 宏的最简单方法？

> ID：254715
> 
> 赞同：1
> 
> 时间：2008-10-31T19:49:09.077
> 
> 标签：windows, vbscript, macros, autohotkey

我想从 AutoHotkey 脚本中调用以下宏，以便将 MonthCal 对象中的某些日期设置为粗体。

[http://msdn.microsoft.com/en-us/library/bb774722(VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb774722(VS.85).aspx)

我该怎么做呢？

请注意，最简单的方法可能是编写一个使用宏并调用它的简单 VB 脚本。但我对 VB 脚本一无所知。有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T20:08:49.397

我通过他们很棒的[IRC 频道](http://mibbit.com/?server=irc.freenode.net&channel=%23ahk)[在 AutoHotkey 论坛上](http://www.autohotkey.com/forum/topic14695.html)找到了以下脚本（感谢 _rhys 和 Titan）

```
monthNb := 3   ; How many months are displayed. Can be fetched with MCM_GETMONTHRANGE
MCM_FIRST := 0x1000
MCM_SETDAYSTATE := MCM_FIRST + 8

; MCS_DAYSTATE = 1
Gui, Add, MonthCal, +0x1 vMyCalendar
Gui, Add, Button, gBoldify w100, B
Gui Show

Gui +LastFound
guiID := WinExist()
ControlGet mcID, Hwnd, , SysMonthCal321, ahk_id %guiID%

Gosub SetDayState
Return

Boldify:
VarSetCapacity(daysBuffer, 4 * monthNb, 0)
if bOdd
{
   days = 1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31
}
else
{
   days = 2,4,6,8,10,12,14,16,18,20,22,24,26,28,30
}
bOdd := not bOdd
addr := &daysBuffer + 4
Loop Parse, days, `,
{
   o1 := (A_LoopField - 1) / 8
   o2 := Mod(A_LoopField - 1, 8)
   val := *(addr + o1) | (1 << o2)
   DllCall("RtlFillMemory", "UInt", addr + o1, "UInt", 1, "UChar", val)
}
Gosub SetDayState
Return

SetDayState:
   SendMessage MCM_SETDAYSTATE, monthNb, &daysBuffer, , ahk_id %mcID%
Return

GuiClose:
GuiEscape:
ExitApp 
```

# fonts - 安装xna后如何使用字体

> ID：254718
> 
> 赞同：1
> 
> 时间：2008-10-31T19:49:39.980
> 
> 标签：fonts, xna

我下载了一个教程，其中包含源代码中的字体。当我尝试构建项目时，我总是收到以下错误消息：

> 错误 1 ​​找不到字体系列“操纵杆”。请确保安装了请求的字体，并且是 TrueType 或 OpenType 字体。

该字体是通过控制面板添加的，并且是 TrueType 字体。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-01T18:13:26.303

您在 Windows\Fonts 目录中看到字体了吗？如果安装了字体，它应该在那里。您是否尝试在 Word 或其他程序中使用此字体来查看它是否真的安装了？

您可以联系源代码来的人并问他问题，或者您可以尝试使用他的源代码并更改字体。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-04T10:42:46.687

只需重新启动编辑器一次。有用。因为编辑器只在开头加载字体。

# java - 使用 Java 上传文件（带进度条）

> ID：254719
> 
> 赞同：30
> 
> 时间：2008-10-31T19:49:55.503
> 
> 标签：java, file-io, upload, progress-bar

我对 Java*非常*陌生，而且大部分时间都在自学，所以我开始构建一个小程序。我想做一个可以从本地磁盘中选择一个文件并将其作为 multipart/form-data POST 请求但**带有进度条**的上传。显然，用户必须授予 Java 小程序访问硬盘的权限。现在我已经完成了第一部分：用户可以使用一个`JFileChooser`对象选择一个文件，该对象可以方便地返回一个`File`对象。但我想知道接下来会发生什么。我知道这`File.length()`会给我文件的总大小（以字节为单位），但是如何将选定的内容发送`File`到网络，以及如何监控已发送的字节数？提前致谢。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-01-22T17:21:06.787

要使用 HttpClient 检查进度，请将 MultipartRequestEntity 包裹在一个计算发送字节数的地方。包装器如下：

```
import java.io.FilterOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import org.apache.commons.httpclient.methods.RequestEntity;

public class CountingMultipartRequestEntity implements RequestEntity {
    private final RequestEntity delegate;

    private final ProgressListener listener;

    public CountingMultipartRequestEntity(final RequestEntity entity,
            final ProgressListener listener) {
        super();
        this.delegate = entity;
        this.listener = listener;
    }

    public long getContentLength() {
        return this.delegate.getContentLength();
    }

    public String getContentType() {
        return this.delegate.getContentType();
    }

    public boolean isRepeatable() {
        return this.delegate.isRepeatable();
    }

    public void writeRequest(final OutputStream out) throws IOException {
        this.delegate.writeRequest(new CountingOutputStream(out, this.listener));
    }

    public static interface ProgressListener {
        void transferred(long num);
    }

    public static class CountingOutputStream extends FilterOutputStream {

        private final ProgressListener listener;

        private long transferred;

        public CountingOutputStream(final OutputStream out,
                final ProgressListener listener) {
            super(out);
            this.listener = listener;
            this.transferred = 0;
        }

        public void write(byte[] b, int off, int len) throws IOException {
            out.write(b, off, len);
            this.transferred += len;
            this.listener.transferred(this.transferred);
        }

        public void write(int b) throws IOException {
            out.write(b);
            this.transferred++;
            this.listener.transferred(this.transferred);
        }
    }
} 
```

然后实现一个更新进度条的 ProgressListener。
请记住，进度条更新不得在事件调度线程上运行。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-09-06T11:25:30.870

更简单的countingEntity 将不依赖于特定的实体类型，而是扩展`HttpEntityWrapped`：

```
package gr.phaistos.android.util;

import java.io.FilterOutputStream;
import java.io.IOException;
import java.io.OutputStream;

import org.apache.http.HttpEntity;
import org.apache.http.entity.HttpEntityWrapper;

public class CountingHttpEntity extends HttpEntityWrapper {

    public static interface ProgressListener {
        void transferred(long transferedBytes);
    }

    static class CountingOutputStream extends FilterOutputStream {

        private final ProgressListener listener;
        private long transferred;

        CountingOutputStream(final OutputStream out, final ProgressListener listener) {
            super(out);
            this.listener = listener;
            this.transferred = 0;
        }

        @Override
        public void write(final byte[] b, final int off, final int len) throws IOException {
            //// NO, double-counting, as super.write(byte[], int, int) delegates to write(int).
            //super.write(b, off, len);
            out.write(b, off, len);
            this.transferred += len;
            this.listener.transferred(this.transferred);
        }

        @Override
        public void write(final int b) throws IOException {
            out.write(b);
            this.transferred++;
            this.listener.transferred(this.transferred);
        }

    }

    private final ProgressListener listener;

    public CountingHttpEntity(final HttpEntity entity, final ProgressListener listener) {
        super(entity);
        this.listener = listener;
    }

    @Override
    public void writeTo(final OutputStream out) throws IOException {
        this.wrappedEntity.writeTo(out instanceof CountingOutputStream? out: new CountingOutputStream(out, this.listener));
    }
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-07-18T21:46:23.427

我最终偶然发现了一个开源 Java 上传器小程序，并在其代码中找到了我需要知道的一切。以下是描述它的博客文章的链接以及来源：

[文章](http://panyasan.wordpress.com/2008/02/29/open-source-drag-drop-upload-java-applet-for-websites/)
[源代码](https://qooxdoo-contrib.svn.sourceforge.net/svnroot/qooxdoo-contrib/trunk/qooxdoo-contrib/UploadJavaApplet/trunk/uploadApplet/java/src/dndapplet/applet/DNDApplet.java)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-04-26T09:17:42.150

侦听器返回的字节数与原始文件大小不同。所以，`transferred++`我没有修改它，而是修改了它`transferred=len`；这是写入输出流的实际字节数的长度。当我计算传输的总字节数之和时，它等于实际`ContentLength`返回的`CountingMultiPartEntity.this.getContentLength();`

```
public void write(byte[] b, int off, int len) throws IOException {
    wrappedOutputStream_.write(b,off,len);
    transferred=len;
    listener_.transferred(transferred);
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-01T00:37:17.187

请记住，当网络中的中间组件（例如，ISP 的 HTTP 代理或服务器前的反向 HTTP 代理）比服务器更快地使用您的上传时，进度条可能会产生误导。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-31T21:57:54.807

正如文森特发布的文章所述，您可以使用 Apache commons 来执行此操作。

小剪

```
 DiskFileUpload upload = new DiskFileUpload();
upload.setHeaderEncoding(ConsoleConstants.UTF8_ENCODING);

upload.setSizeMax(1000000);
upload.setSizeThreshold(1000000);

Iterator it = upload.parseRequest((HttpServletRequest) request).iterator();
FileItem item;
while(it.hasNext()){
    item = (FileItem) it.next();
    if (item.getFieldName("UPLOAD FIELD"){
       String fileName = item.getString(ConsoleConstants.UTF8_ENCODING);
       byte[] fileBytes = item.get();
    }
} 

```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-07-01T03:33:37.660

只是我的 2c 价值：

这是基于 tuler 的回答（在撰写本文时有一个错误）。我稍微修改了一下，所以这是我的 tuler 和 mmyers 答案版本（我似乎无法编辑他们的答案）。我想尝试使它更清洁和更快。`CountingOutputStream`除了错误（我在他们的答案的评论中讨论）之外，我对他们的版本的最大问题是每次写入都会创建一个新错误。这在内存方面可能会变得非常昂贵 - 大量的分配和垃圾收集。较小的问题是当它可以扩展时使用委托`MultipartEntity`。不知道他们为什么选择那个，所以我以我更熟悉的方式做了。如果有人知道这两种方法的优缺点，那就太好了。最后，FilterOutputStream#write(byte[], int,int) 方法只是在循环中调用 FilterOutputStream#write(byte)。[FOS 文档](http://java.sun.com/j2se/1.4.2/docs/api/java/io/FilterOutputStream.html)建议子类覆盖此行为并使其更有效。最好的方法是让底层的 OutputStream 处理写入请求。

```
import java.io.FilterOutputStream;
import java.io.IOException;
import java.io.OutputStream;

import org.apache.http.entity.mime.HttpMultipartMode;
import org.apache.http.entity.mime.MultipartEntity;

public class CountingMultiPartEntity extends MultipartEntity {

    private UploadProgressListener listener_;
    private CountingOutputStream outputStream_;
    private OutputStream lastOutputStream_;

    // the parameter is the same as the ProgressListener class in tuler's answer
    public CountingMultiPartEntity(UploadProgressListener listener) {
        super(HttpMultipartMode.BROWSER_COMPATIBLE);
        listener_ = listener;
    }

    @Override
    public void writeTo(OutputStream out) throws IOException {
        // If we have yet to create the CountingOutputStream, or the
        // OutputStream being passed in is different from the OutputStream used
        // to create the current CountingOutputStream
        if ((lastOutputStream_ == null) || (lastOutputStream_ != out)) {
            lastOutputStream_ = out;
            outputStream_ = new CountingOutputStream(out);
        }

        super.writeTo(outputStream_);
    }

    private class CountingOutputStream extends FilterOutputStream {

        private long transferred = 0;
            private OutputStream wrappedOutputStream_;

        public CountingOutputStream(final OutputStream out) {
            super(out);
                    wrappedOutputStream_ = out;
        }

        public void write(byte[] b, int off, int len) throws IOException {
                    wrappedOutputStream_.write(b,off,len);
                    ++transferred;
            listener_.transferred(transferred);
        }

        public void write(int b) throws IOException {
            super.write(b);
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-31T19:55:43.917

查看[HTTP 客户端](http://hc.apache.org/httpclient-3.x/)以将文件上传到网络。它应该能够做到这一点。我不确定如何获取进度条，但它会涉及以某种方式查询该 API。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-16T12:25:04.590

Apache common 是非常好的选择。Apache common 允许您配置以下内容。

1.  配置（xml文件）最大文件大小/上传文件大小
2.  目标路径（保存上传文件的位置）
3.  设置温度。文件夹来交换文件，这样文件上传会很快。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-04-03T12:13:43.070

如果不想创建类，您可以从其他答案中覆盖您正在使用的`AbstractHttpEntity`类子类或实现方法。`public void writeTo(OutputStream outstream)`

使用`FileEntity`实例的示例：

```
FileEntity fileEntity = new FileEntity(new File("img.jpg")){
    @Override
    public void writeTo(OutputStream outstream) throws IOException {
        super.writeTo(new BufferedOutputStream(outstream){
            int writedBytes = 0;

            @Override
            public synchronized void write(byte[] b, int off, int len) throws IOException {
                super.write(b, off, len);

                writedBytes+=len;
                System.out.println("wrote: "+writedBytes+"/"+getContentLength()); //Or anything you want [using other threads]
            }
        });
    }

}; 
```

# visual-studio-2008 - 如何使用 xbuild（来自 Mono）构建 Visual Studio 解决方案？

> ID：254722
> 
> 赞同：6
> 
> 时间：2008-10-31T19:51:45.467
> 
> 标签：visual-studio-2008, visual-studio-2005, mono, build, xbuild

我最近为我的新 MacBook 下载了 Mono 2。我试图弄清楚如何使用包含在 Mono 中的 xbuild 编译 Visual Studio 解决方案。有任何想法吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-10-11T12:29:51.837

更新：xbuild 现在支持解决方案文件。见[xbuild](http://www.mono-project.com/Microsoft.Build)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-31T19:56:58.547

我上次检查时，xbuild 不支持解决方案（它们使用不同的文件格式），但 *.*proj 文件支持。

如果您有一个相对简单的解决方案，您可能能够在每个项目上单独使用 xbuild，但如果您的解决方案非常复杂（项目之间存在相互依赖关系等），您可能需要做一些黑客使一切正常。

此外，值得注意的是 Visual Studio 中的 C++ 项目也不使用 msbuild（虽然 Visual Studio 2010 应该解决这个问题），所以如果你需要编译任何 C++，你完全靠自己（当然， Mono 没有 C++/CLI 编译器，所以无论如何你不会在 xbuild 中走得太远）。

[这个问题/答案](https://stackoverflow.com/questions/54790/is-it-possible-to-build-msbuild-files-visual-studio-sln-from-the-command-line-i)表明您可能希望改用 mdtool。

# java - 在 Java 中，对于字符串 x，s.length() 的运行时成本是多少？是 O(1) 还是 O(n)？

> ID：254726
> 
> 赞同：33
> 
> 时间：2008-10-31T19:53:23.123
> 
> 标签：java, string

有人告诉我这样的代码：

```
for (int i = 0; i < x.length(); i++) {
    // blah
} 
```

实际上是 O(n^2) 因为重复调用`x.length()`. 相反，我应该使用：

```
int l = x.length();
for (int i = 0; i < l; i++) {
    // blah
} 
```

这是真的？字符串长度是否存储为 String 类的私有整数属性？或者`String.length()`真的走整个字符串只是为了确定它的长度？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-10-31T19:54:26.930

不，java 字符串的长度是 O(1)，因为 java 的字符串类将长度存储为一个字段。

您收到的建议适用于 C 以及其他语言，但不适用于 java。C 的 strlen 遍历 char 数组以查找字符串结尾字符。Joel 在播客中谈到了它，但在 C.

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-01T00:22:12.520

与到目前为止所说的相反，不能保证`String.length()`字符串中包含的字符数是恒定时间操作。该类的 javadocs`String`和 Java 语言规范都不需要`String.length`是恒定时间操作。

但是，在 Sun 的实现`String.length()`中是一个常数时间操作。最终，很难想象为什么任何实现都会对这种方法进行非恒定时间实现。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-11-01T03:01:17.193

String 将长度存储在单独的变量中。由于字符串是不可变的，因此长度永远不会改变。它只需要在创建时计算一次长度，这发生在为其分配内存时。因此它的 O(1)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-01T03:18:28.077

如果你不知道你可以这样写：

```
for (int i = 0, l = x.length(); i < l; i++) {
    // Blah
} 
```

它只是稍微干净一些，因为`l`' 的范围更小。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-01T02:06:25.930

您应该知道，该`length()`方法返回 UTF-16 代码点的数量，不一定与所有情况下的字符数相同。

好的，实际影响你的可能性很小，但知道它并没有什么坏处。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-31T19:56:22.680

我不知道该链接的翻译效果如何，但请查看[. `String#length`](http://www.jdocs.com/javase/7.b12/java/lang/String.html#669)简而言之，`#length()`具有 O(1) 复杂性，因为它只是返回一个字段。这是不可变字符串的众多优点之一。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-11-10T05:38:18.113

即使我们将 length() 作为 x.length() 上的一个方法调用也不用担心，实际上 length 存储为 String 类中的字段/属性，并且每当我们调用“x.length”时这个字段/属性由 length() 方法返回()”。

查看此图像链接或下面 String 类中定义的 length() 方法的代码片段 -

[图像链接](https://i.stack.imgur.com/G8ba7.jpg)

```
public int length() {
    return value.length >> coder();
} 
```

length() 方法返回已经存储在 String 类中的长度属性。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-10-31T19:55:44.507

据此[，](http://www.docjar.com/html/api/java/lang/String.java.html)长度是 String 对象的一个​​字段。

# javascript - 如何检测 IE 是否将我的站点作为受信任站点访问？

> ID：254732
> 
> 赞同：7
> 
> 时间：2008-10-31T19:54:51.810
> 
> 标签：javascript, internet-explorer, settings

是否可以确定我的网站是否作为受信任的网站被访问？在[另一个问题](https://stackoverflow.com/questions/251696/best-way-to-readset-ie-options)中，我们确定，一般来说，查看客户端 IE 设置是不明智的。这算不算例外？

我想这样做的原因是某些功能将无法工作，除非该站点作为受信任的站点被访问（例如客户端发送邮件 - 不要问），我希望能够警告用户。尽管页面中有许多警告，但许多用户仍然不阅读，并向我们发送 nastygrams。我们希望通过检测这种情况并闪烁一个大警告来减少电子邮件数量，该警告基本上是说“**您没有阅读警告，并且您尝试执行的操作将在您更改设置之前不起作用！** ”任何欢迎提出想法。

编辑：在我们的商店中，客户端 sendmail 仅在站点受信任的情况下才有效，由于安全要求，我无法更改它，也无法切换到服务器端 sendmail。但是，这不是客户端 sendmail 失败的唯一原因，所以我不能简单地捕获 sendmail 错误来确定这一点。另外，我不希望这降级为 sendmail 讨论。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T20:51:08.030

这是您可以使用的测试：

```
function isTrustedIE(){
    try{
        var test=new ActiveXObject("Scripting.FileSystemObject");
    }
    catch(e){
        return false;
    }

    return true;
} 
```

当然，如果用户禁用了该特定对象，即使在受信任的站点上，这也会失败。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T22:21:16.413

您可以询问当前登录用户的用户名，如果您得到它，您将知道该站点位于“受信任的站点”或“本地 Intranet”区域。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-03T19:59:38.320

可能，处理这个问题的一个好方法，同时仍然支持不寻常的组合，是测试一个特定的行为是否成功。

例如，如果你需要做

```
a.innerHTML = "abc"; 
```

然后您可以检查 innerHTML 是否已更改。不幸的是，我不能向您保证所有功能都是可检测的。此外，try...catch 语句可能非常有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T20:17:29.817

据我了解，这是不可能的，但您可能会对更具体的条件进行一些运气测试，例如您需要的特定技术或技术的可用性。您的客户端代码对浏览器有什么类型的要求（ActiveX、Java、脚本等）？了解这将是了解如何测试客户端浏览器的客户端代码所需环境的一个很好的开始。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-03-19T21:28:49.700

在您的情况下（您正在处理的具体问题是 sendmail 失败），我仍然建议捕获 sendmail 失败，然后给出一个更一般的答案。“您的邮件失败了。它可能由于以下任何原因而失败”，然后放入一个项目符号列表，“没有使此站点受信任”在顶部漂亮而粗体。如果 sendmail 失败的原因不是您的站点不受信任，那么您的用户可能也需要知道这一点。

# error-handling - 如何应对“磁盘已满”的场景？

> ID：254733
> 
> 赞同：10
> 
> 时间：2008-10-31T19:54:52.793
> 
> 标签：error-handling, diskspace

绝大多数应用程序无法正确处理“磁盘已满”情况。

示例：安装程序没有看到磁盘已满，忽略所有错误，最后高兴地宣布“安装完成！”，或者电子邮件程序不知道它刚刚下载的消息无法保存，并告诉服务器删除原件。

有什么技巧可以优雅地处理这种情况？你用它们吗？你测试它们吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-08T21:56:08.723

作为用户，我希望软件能够：

1.  保存我的数据。
2.  在我做任何实际工作*之前*，尽早验证我的环境。
3.  如果`#2`不可能，*请告诉我*任何特殊要求。
4.  自己清理干净。

作为开发人员，执行此操作的技术包括：

1.  **仅**在别无选择时中止，如果前一个选择失败，则允许用户有机会做出新的选择（参见 AgentThirteen 的回答）。
2.  尽早检查所需资源（内存、磁盘空间、外围设备）。如果确定失败，立即停止；如果不确定是否成功，则显示警告，允许用户选择是否继续。
3.  预先分配资源以确保它们在需要时*仍然*可用。
4.  **在非模态对话框**中显示警告和错误，以便用户可以将应用程序置于后台并使用其他工具来解决问题。
5.  维护一个“撤消”列表：到目前为止已执行的操作的历史记录。如果应用程序必须中止，请提供撤消这些操作的机会。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T20:04:06.457

我在打开、写入或关闭文件时检查错误。另一方面，我没有做任何特别的事情来处理“磁盘已满”错误。相反，我依靠底层操作系统向我报告这些错误，就像它报告任何其他类型的错误一样。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-31T20:05:28.483

我使用数据采集软件。因为我可以在创建文件之前估计文件的大小（基于请求获取的数据量），所以我什至在创建文件之前就根据存在的磁盘空间发出警告，如果我预计我会用完空间.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-31T20:17:28.240

将持久性例程构建在循环的块内非常重要，提示用户选择一个位置然后尝试保存，直到数据正确保存或用户选择取消。这对我来说似乎很明显，但我已经看到很多应用程序在您尝试持久化时遇到异常，甚至没有处理，并将执行推到您的例程之外并丢失您的内存数据。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-08T22:16:51.727

通常情况下，我在这个问题上的立场与传统思维相矛盾。

通常，我忽略磁盘空间不足的方式与忽略内存不足的方式相同。部分原因是不可能可靠地预测这些情况。部分原因是当我们谈论软件在意外情况下的行为时（比如你不知道自己有一个导致你吃掉所有磁盘或内存的错误），不可能对这种情况进行足够好的推理来为它编写代码并测试它。（可以安全地假设，如果您有未经测试的代码，它就不起作用）。

但是，有一些特定条件表明了不同的方法：

*   如果您持有重要的、未保存的用户状态（例如带有一些编辑的文本文件），请考虑在后台预先保存数据，以便以后可以恢复崩溃。

*   如果您要根据交互式用户的命令（例如 File->Save）写入磁盘，您可以捕获失败并提供让他们再试一次。

在这两种情况下，重要的是错误看起来像错误。崩溃的错误应该崩溃。捕获意外异常并继续悄悄地剥夺您的诊断机会，同时使您的软件处于不安全状态。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-12-02T17:37:53.117

对于测试，创建一个小分区，在不同的点会用完空间，可能是作为虚拟 PC，以便测试得到很好的包含和可重复性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-31T20:02:32.387

为了进一步扩展这一点，是否有在 SQL 服务器上处理“磁盘已满”的技术？我知道永远不应该发生，但它可以（并且已经发生在我身上）。

我熟悉在独立 PC 应用程序上测试磁盘已满（在软盘时代长大的编程）。即使在空间非常紧张的旧 SCO Unix 系统上，如果你用完空间就会冻结。不太熟悉它在现代系统中的含义。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-31T20:07:27.060

你是完全正确的。软件应该优雅地处理这种情况。

您可以随时检查 IOException 以查看磁盘是否已满或用户是否有权写入该位置。

SQL Server 确实可以处理这种情况，但不能从中恢复。当磁盘已满...它停止工作。:)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-16T00:49:45.530

我们刚刚在我们的产品中添加了对此的支持。在嵌入式设备上运行，我们每小时检查磁盘空间低于 20% (10mb)，并向办公室服务器发送警告，记录问题并警告用户。

一旦处于这种状态，我们每两分钟检查一次小于 2mb 的空间，然后优雅地停止应用程序（引导系统），并拒绝运行，直到空间问题得到解决。

由于我们的产品是客户工作场所的核心系统，因此会引起管理人员的注意。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-11-23T17:38:57.520

如果我正在编写一个应用程序，我可以通过某种方式从 I/O 故障中恢复它，但如果我正在运行其他人的应用程序，我必须采取不同的方法，即尽可能多地恢复磁盘空间. [这是我使用的方法。](https://stackoverflow.com/questions/32230/tracking-down-where-disk-space-has-gone-on-linux/529102#529102)可以有大量可恢复的磁盘空间，其形式为 1) 少量大文件深深地隐藏在不起眼的目录中，或 2) 大量小文件分散在磁盘上，同样位于不明显的位置。这种方法可以找到它们。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-06-02T21:16:34.847

是的，尝试对这类问题做一些“聪明”的事情可能是一个非常糟糕的主意。基本上你能做的就是尽量减少损失。对于未保存用户数据的交互式应用程序，请尽量避免在用户有机会解决问题之前崩溃。

# asp.net - PostbackUrl 与 NavigateUrl

> ID：254735
> 
> 赞同：6
> 
> 时间：2008-10-31T19:55:01.593
> 
> 标签：asp.net, navigateurl, postbackurl

有人能告诉我 LinkBut​​ton.PostBackUrl 和 HyperLink.NavigateUrl 之间的区别吗？我有一个 asp.net 2.0 应用程序，它在整个应用程序中使用这两种方法，并且一切正常。但是，如果我通过公司 vpn 连接到应用程序，所有使用 LinkBut​​ton.PostBackUrl 的链接都会给我一个 (54) Connection reset by peer error 并且 HyperLink.NavigateUrl 工作得很好。我想知道命令之间的根本区别，以便我可以尝试找出导致连接被对等错误重置的 vpn 软件阻塞的原因。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-31T19:57:21.993

NavigateURL：向 URL 提交一个“获取”请求（就像您在浏览器中键入它一样）

PostBackURL：向指定的 URL 提交包含表单信息的“Post”请求；我不相信这是常用的

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-31T19:56:34.273

链接按钮的 PostBackURL 告诉您按钮将数据发布到哪个表单。（更多[细节](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.linkbutton.postbackurl.aspx)）

超链接的 NavigateURL 告诉您链接来自服务器的哪个控件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-12-02T21:53:19.877

PostBackUrl 首先将当前网页表单发布或发送到服务器，然后将您重定向到指定的 url，而 NavigateUrl 直接将您带到指定的 url，而不会将当前页面提交到服务器

# java - 可能不存在的属性的 JSP bean 标记

> ID：254737
> 
> 赞同：6
> 
> 时间：2008-10-31T19:55:18.377
> 
> 标签：java, jsp, jsp-tags, javabeans

在 JSP 中，我可以使用标记 ${object.property} 来引用 bean 的属性

有没有办法处理可能不存在的属性？我有一个需要处理不同类型的 JSP 页面。例子：

```
public class Person {
    public String getName()
}
public class Employee extends Person {
    public float getSalary()
} 
```

在 JSP 中，我想显示一个包含姓名和薪水列的人员表。如果此人不是雇员，则薪水应为空白。行 HTML 可能如下所示：

```
<tr>
    <td><c:out value="${person.name}"></td>
    <td><c:out value="${person.salary}"></td>
</tr> 
```

不幸的是，如果这个人不是雇员，那么它就找不到薪水并且会发生错误。我将如何在 JSP 中解决这个问题？

编辑： JSP 标记语言中是否有**instanceof检查？**

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-31T20:11:55.397

如果它是一个作用域属性，只需使用 EL 空运算符，不幸的是，您必须使用带有 <c:catch> 的employee.salary 来包围您的表达式：

```
<c:catch var="err">
    <c:out value="${employee.salary}"/>
</c:catch> 
```

如果您真的需要*instanceof*，您可以考虑使用自定义标签。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-31T21:02:37.260

如果你想上课，只需使用`${person.class}`. 你也可以使用`${person.class.name eq 'my.package.PersonClass'}`

您还可以在 c:out 上使用“默认值”。

```
 <c:out value='${person.salary}' default="Null Value" /> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-10T13:46:44.310

简洁，但未经检查。

```
<tr>
    <td>${person.name}</td>    
    <td>${person.class.simpleName == 'Employee' ? person.salary : ''}</td>
</tr> 
```

> JSP标签语言中是否有instanceof检查？

在写这篇文章的时候还没有。我在某处读到他们已经保留了它， EL 中的*instanceof*关键字可能是为了将来。此外，还有一个具有此特定标签的库。在决定为自己创建一些自定义标签之前，请先调查一下。这是链接，[非标准标签库](http://jakarta.apache.org/taglibs/sandbox/doc/unstandard-doc/intro.html)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T20:05:55.453

一种方法是创建一个自定义标签库并在其中使用多态性来处理 a `Person` *is-a* `Employee`的情况。

我已经有一段时间没有为 JSP 这样做了，但经常在 GSP（Groovy/Grails Server Pages）中使用类似的技术。

否则，您可以在（不理想）中放入一些逻辑`JSP`来测试`Employee`-ness：

```
<% 
   String salary
   if (person instanceof Employee) {
       salary = person.salary
   } else {
       salary = "" // or '&nbsp;'
   }
%>
<td><c:out value="${salary}"></td> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-31T20:03:21.607

你总是可以有一个类型字段。

```
public class Person {
    public String getType() { return "Person"; }
    public String getName()
}
public class Employee extends Person {
    public String getType() { return "Employee"; }
    public float getSalary()
} 
```

你的 JSP 看起来像

```
<tr>
    <td><c:out value="${person.name}"></td>
    <td><c:if test="'Employee' eq person.type"><c:out value="${person.salary}"></c:if></td>
</tr> 
```

当然 Class 类已经有了这个......

```
<tr>
    <td><c:out value="${person.name}"></td>
    <td><c:if test="'Employee' eq person.class.simpleName"><c:out value="${person.salary}"></c:if></td>
</tr> 
```

你也可以有 `isEmployee()' 方法。

# .net - XML 文件中日期/时间的正确格式是什么

> ID：254753
> 
> 赞同：100
> 
> 时间：2008-10-31T19:58:35.190
> 
> 标签：.net, xml, datetime

使用 .NET 写入 XML 文件时，我使用什么格式的日期/时间？我是简单地使用`DateTime.ToString()`，还是必须使用特定的格式？

* * *

## 回答 #1

> 赞同：139
> 
> 时间：2008-10-31T20:13:13.553

我总是使用[ISO 8601](http://en.wikipedia.org/wiki/ISO_8601)格式（例如`2008-10-31T15:07:38.6875000-05:00`）-- `date.ToString("o")`。它也是[XSD 日期格式](http://www.w3.org/TR/xmlschema-2/#isoformats)。这是首选格式和[标准日期和时间格式字符串](http://msdn.microsoft.com/en-us/library/az4se3k1.aspx)，但如果您不希望日期和时间之间出现“T”，则可以在必要时使用手动格式字符串：`date.ToString("yyyy-MM-dd HH:mm:ss");`

编辑：如果您使用从 XSD 或 Web 服务生成的类，您可以直接将 DateTime 实例分配给类属性。如果您正在编写 XML 文本，请使用上述内容。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-10-31T20:02:41.687

编辑：这是个坏建议。如上所述，使用“o”。“s”*做错事*。

我总是用这个：

```
dateTime.ToUniversalTime().ToString("s"); 
```

如果您的架构如下所示，这是正确的：

```
<xs:element name="startdate" type="xs:dateTime"/> 
```

这将导致：

```
<startdate>2002-05-30T09:00:00</startdate> 
```

您可以在这里获得更多信息：http: [//www.w3schools.com/xml/schema_dtypes_date.asp](http://www.w3schools.com/xml/schema_dtypes_date.asp)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-31T20:06:07.420

如果您手动组装 XML 字符串，请使用`var.ToUniversalTime().ToString("yyyy-MM-dd'T'HH:mm:ss.fffffffZ"));` 这将输出官方的 XML 日期时间格式。但是如果您使用内置的序列化方法，则不必担心格式。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-31T20:01:41.297

DTD 有什么要说的？

如果 XML 文件用于与其他现有软件（例如 SOAP）进行通信，则检查该软件是否符合预期。

如果 XML 文件用于序列化或与不存在的软件（例如，您正在编写的软件）通信，您可以定义它。在这种情况下，我会建议一些既易于用您选择的语言解析，又易于人类阅读的东西。例如，如果您的语言（无论是 VB.NET 还是 C#.NET 或其他语言）允许您轻松解析 ISO 日期（YYYY-MM-DD），那么我建议您使用这种语言。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-08-28T08:05:20.300

类提供这些`XmlConvert`类型的设施。关于 DateTimes，尤其要小心过时的方法。另请参阅：[https ://stackoverflow.com/a/7457718/1288109](https://stackoverflow.com/a/7457718/1288109)

# algorithm - 如何擅长数据结构和分析？

> ID：254762
> 
> 赞同：6
> 
> 时间：2008-10-31T20:00:54.280
> 
> 标签：algorithm, data-structures, analysis, language-agnostic

我想在数据结构和分析方面做得很好，尤其是。在爪哇。我经常发现自己很虚弱。我应该怎么做才能做好呢？有什么好的心理锻炼吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-31T20:04:05.897

一本关于复杂性分析的优秀书籍，包括流行和不太流行的数据结构的属性，是[Introduction to Algorithms, Second Edition](https://rads.stackoverflow.com/amzn/click/com/0262531968)，也称为 CLRS。它被广泛认为是算法及其分析的圣经。

对于更以 Java 为中心的内容，我的本科 Java 入门课程使用[了这本书](http://www.amazon.com/s/ref=nb_ss_b_1_13?url=search-alias%3Dstripbooks&field-keywords=data+structures+and+algorithms+in+java&x=0&y=0&sprefix=data+structur)，我发现它已经足够了。

对于心理练习，您可以通过练习来熟悉自己。试试[Project Euler](http://projecteuler.net/)、[TopCoder](http://www.topcoder.com)或 google [“acm practice problem”](http://www.google.com/search?q=acm+practice+problem)。这也许是在日常编码中能给你带来最切实好处的东西。大多数所有这些都将接受和评估 Java（和 C/C++）解决方案，所以你都在语言前沿。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-31T20:03:40.903

对于数据结构的分析，您需要学习离散数学（组合学）和统计学。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-31T20:20:14.367

通常我会推荐[CLRS](https://rads.stackoverflow.com/amzn/click/com/0262531968)，但由于您在问题中特别提到了 Java，所以我推荐[Objects, Abstraction, Data Structures and Design: Using Java version 5.0](https://rads.stackoverflow.com/amzn/click/com/0471692646)。它对数据结构和使它们起作用的算法有非常奇妙的解释。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-05T09:59:27.627

[R. Sedgewick](http://www.cs.princeton.edu/~rs/)所著的《Java算法》是一本非常好的算法书籍，其中包含 Java 实现。

# jquery - 检测 jQuery UI 自动完成

> ID：254765
> 
> 赞同：8
> 
> 时间：2008-10-31T20:01:45.603
> 
> 标签：jquery, jquery-ui

如何检测输入框当前是否为 jQuery UI 自动完成？似乎没有本机方法，但我希望有这样简单的东西：

```
if ($("#q").autocomplete)
{
  //Do something
} 
```

然而，这个条件似乎总是返回真。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-31T22:16:11.103

```
if ($("#q").hasClass("ac_input")) {
    // do something
} 
```

**更新**

JQuery UI 自动完成小部件中的类名现在是“ui-autocomplete-input”，因此代码将是：

```
if ($("#q").hasClass("ui-autocomplete-input")) {
    // do something
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-06-16T10:15:44.243

您还可以通过以下代码行找到附加到输入元素的自动完成行为：

```
if ($('Selector').data('autocomplete')) {
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2017-09-06T06:54:26.843

如果页面已经包含了自动完成 jquery UI 插件，并且您只是想查看是否已为特定（输入）元素设置了自动完成功能，则可以使用**官方 API 方法**，如下所示：

```
if ($("#q").autocomplete("instance")) {
    console.log("autocomplete already setup for #q");
} else {
    console.log("NO autocomplete for #q");
} 
```

更多细节可以在[http://api.jqueryui.com/autocomplete/#method-instance](http://api.jqueryui.com/autocomplete/#method-instance)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-04-26T13:00:15.907

您可以使用

```
if( $.isFunction( $.fn.autocomplete ) ){ } 
```

.isFunction 是 jQuery 库的一部分。（引用：http: [//james.padolsey.com/jquery/....isFunction](http://james.padolsey.com/jquery/#v=1.4&fn=jQuery.isFunction)）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-31T20:07:33.470

这是真的，因为一旦你包含了自动完成 js，每个 $() 对象现在都定义了一个 autocomplete() 方法（如果你想为这些元素激活自动完成）。您的 if() 只是说该函数不为空。

不幸的是，我没有一个可以检查这个的系统（今天把笔记本电脑留在家中），但我相信自动完成会为其使用的元素添加一个 css 类名称。你可以去找那个。

# c# - 如何在 LINQ 中执行嵌套的 Join、Add 和 Group？

> ID：254784
> 
> 赞同：3
> 
> 时间：2008-10-31T20:06:58.993
> 
> 标签：c#, linq

我有两个对象，我们称它们**`Input`**为**`Output`**

**`Input`**有属性*`Input_ID`*, *`Label`*, 并且有属性和*`Input_Amt`*
**`Output`***`Output_ID`**`Output_Amt`*

我想在 LINQ 中执行等效的 SQL 语句：

```
SELECT Label, Sum(Added_Amount) as Amount FROM
    (SELECT I.Label, I.Input_Amt + ISNULL(O.Output_Amt, 0) as Added_Amount
    FROM Input I LEFT OUTER JOIN Output O ON I.Input_ID = O.Output_ID)
GROUP BY Label 
```

对于内部查询，我正在写如下内容：

```
var InnerQuery = from i in input
                 join o in output
                 on i.Input_ID equals o.Output_ID into joined
                 from leftjoin in joined.DefaultIfEmpty()
                 select new
                 {
                     Label = i.Label,
                     AddedAmount = (i.Input_Amt + leftjoin.Output_Amt)
                 }; 
```

然而，在测试中，该语句返回 null。是什么赋予了？

此外，我如何在一个 LINQ 语句中将我的金额加在一起后继续所需的查询并执行组？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-31T20:50:11.870

好的，现在我对发生的事情有了更好的理解，主要问题是您没有等效的 ISNULL 位。试试这个：

```
var InnerQuery = from i in input
                 join o in output
                 on i.Input_ID equals o.Output_ID into joined
                 from leftjoin in joined.DefaultIfEmpty()
                 select new
                 {
                     Label = i.Label,
                     AddedAmount = (i.Input_Amt + (leftjoin == null ? 0 : leftjoin.Output_Amt))
                 }; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T20:22:25.390

这实际上使用的是哪个 LINQ 提供程序？您实际上是在与数据库交谈，还是只是在进程中工作？如果您使用的是 LINQ to SQL，则可以打开日志以查看正在生成的 SQL。

我确定 InnerQuery 本身不会为空 - 您如何检查输出？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T18:46:10.813

```
var labelsAndAmounts = input
  .GroupJoin
  (
    output,
    i => i.InputId,
    o => o.OutputId,
    (i, os) => new
    {
      i,
      oAmount = os.Any() ? os.Select(o => o.OutputAmt).Sum() : 0
    }
  )
  .GroupBy(x => x.i.Label)
  .Select(g => new
    {
      Label = g.Key,
      Amount = g.Select(x => x.i.InputAmt + x.oAmount).Sum()
    }
  ); 
```

# asp.net-mvc - 如何为 ASP.NET MVC 开发“可交付”组件？

> ID：254787
> 
> 赞同：5
> 
> 时间：2008-10-31T20:08:46.463
> 
> 标签：asp.net-mvc, components

在 ASP.NET 网络表单中，我们有服务器组件，可以将其封装到外部程序集中并作为产品交付。在 ASP.NET MVC 中，我们没有服务器组件，那么外部组件的最佳选择是什么？

环顾四周，似乎唯一可能的选择是制作一个**Html 辅助**方法，该方法返回一堆操纵事物的 html + js。如果组件需要一些逻辑，添加一些新路由的 http 模块和在同一个外部程序集中定义的控制器来处理 ajax 调用。

否则**RenderPartial**只返回一个视图...但是视图是一个真实的文件，因此很难封装在外部程序集中，除非它被添加为资源文件，然后使用查看资源文件而不是真实位置的路径提供程序检索磁盘。

或者还有其他我没有考虑的选择吗？

谢谢西莫

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T21:26:45.883

由于服务器端逻辑与客户端逻辑完全分离，因此为 Asp.Net MVC 同时制作服务器端和客户端组件并不是很有用。您可以更好地制作纯 Html/Javascript 组件，并且可以在多个平台（Ruby on rails、php、python、java）上使用，并提供如何在多个平台上集成它们的教程。*您开发的平台不是asp.net mvc，而是一般的网络浏览器！*[Ext JS 框架](http://www.extjs.com/deploy/dev/examples/samples.html "Ext JS 框架")是一个很好的灵感来源

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T20:17:42.653

> 没有什么能阻止您开发自定义控件（例如，对于花哨的网格）、将其封装在程序集中并发送它

但这仅适用于第一次渲染：如果我想让网格可排序/可分页/可编辑等等怎么办？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T20:13:10.917

除了 Html 帮助器之外，ASP.NET MVC 完全支持自定义控件和用户控件。没有什么能阻止您开发自定义控件（例如，对于花哨的网格）、将其封装在程序集中并发送它。我错过了问题的重点吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T21:11:07.133

如果你想做，比如说，排序和分页，一种方法是通过 AJAX。[Telerik 在他们的 grid 中有一个演示](http://blogs.telerik.com/VladimirEnchev/Posts/08-10-07/Using_Telerik_RadGrid_in_ASP_NET_MVC_together_with_RenderPartial_Ajax_Form_Ajax_ActionLink_and_UpdateModel.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-12-21T09:12:51.157

试试 MVCContrib 的 PortableArea。这似乎是您正在寻找的东西。即使不是，源代码也可以帮助您实现目标。

演示视频： http: [//www.viddler.com/explore/c4mvc/videos/11/](http://www.viddler.com/explore/c4mvc/videos/11/)

# .net - 为什么我不能将 e.CommandArgument 转换为 Guid？

> ID：254809
> 
> 赞同：0
> 
> 时间：2008-10-31T20:15:20.817
> 
> 标签：.net, asp.net, vb.net

以下代码在运行时失败...

```
Dim Id As Guid = CType(e.CommandArgument, Guid)

```

它抛出这个异常......

```
System.InvalidCastException 未被用户代码处理
指定的演员表无效

```

为什么我不能将***e.CommandArgument 转换***为 Guid？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T20:20:59.170

尝试：

```
Dim DeleteId As Guid = New Guid(Convert.ToString(e.CommandArgument)) 
```

这有效...

```
Dim DeleteId As Guid = New Guid(DirectCast(e.CommandArgument, String))

```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T20:29:20.663

我猜 e.CommandArgument 是一个字符串，不能通过*转换*为 Guid。可以从字符串创建 Guid：

在 C# 中：

```
 Guid DeleteId new Guid(e.CommandArgument); 
```

我真的不知道 VB.NET 语法，但我会猜测一下：

```
 Dim DeleteId As Guid = New Guid(e.CommandArgument); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T20:22:23.127

消息“强制转换无效”表明其中一个值的数据类型与数据库中的数据类型不匹配。您可以在设置 DeleteId 值的行上放置一个断点并查看 Guid 的样子吗？然后，您可以将其与您在数据库中看到的 DogId 进行比较。我怀疑你会在那里发现你的数据类型问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T20:30:29.557

您的错误与 LINQ to SQL 无关......这是一个转换错误。使用“新的 Guid（e.CommandArgument）”。

# .net - 是否可以在 .Net CF 2.0 或 3.5 上获取堆栈跟踪的行号

> ID：254810
> 
> 赞同：3
> 
> 时间：2008-10-31T20:15:57.337
> 
> 标签：.net

我有一个 .Net CF 2.0 应用程序，并且正在使用 log4net 来记录错误。我得到一个堆栈跟踪，但它没有任何行号。我注意到它似乎没有将 pdb 文件部署到设备上，所以我尝试手动将它放在与 exe 相同的目录中。但这没有帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-31T21:17:49.867

我不确定 .Net CF 是否会打开 pdbs。另外，我不确定您是否要将它们部署到设备上。如果你很勤奋，你可以制作一个工具来将具有 il 偏移量的调用堆栈转换为带有 # 行的调用堆栈。我建议在 Mike Stall 的博客上发表这篇[文章](http://blogs.msdn.com/jmstall/archive/2005/08/25/pdb2xml.aspx)，它提供了从托管 pdb 中提取信息的代码。一旦你有了偏移地图的线，就可以制作一个工具来后期处理这些调用堆栈。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T20:49:10.187

您是否尝试过冒泡异常而不将它们包装在新异常中？[关联](http://weblogs.asp.net/bhouse/archive/2004/11/30/272297.aspx)

```
try {
       //code..

     }
 catch
     {          
        throw;
      } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-03T21:30:52.397

在项目属性下，检查构建选项卡，然后是高级...，然后将调试信息下拉菜单更改为完整。这些应该是 Debug 配置的默认设置，因此如果您在 Release 下构建，请确保启用了这些设置。

祝你好运。

# iphone - 如何让我的 iPhone 应用程序找到我的图像？

> ID：254811
> 
> 赞同：2
> 
> 时间：2008-10-31T20:16:13.407
> 
> 标签：iphone, objective-c, cocoa-touch

当我在应用程序委托的 applicationDidFinishLaunching 事件中执行以下操作时，我的应用程序崩溃：

```
_textures[mytex] = [[Texture2D alloc] initWithImage: [UIImage imageNamed:@"a.png"]]; 
```

但是，当我替换`@"a.png"`为

```
@"/Users/MyUserName/Desktop/MyProjectFolder/a.png" 
```

一切正常。我已经尝试过`a.png`资源的相对路径的东西......但没有一个奏效。我怎样才能解决这个问题？我只想说`@"a.png"`所有图像资源（尤其是因为我在另一个应用程序中这样做了......我直接使用示例代码）。

那么这个神奇的设定是什么？

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-31T23:01:25.927

`+[UIImage imageNamed:]`将在您的应用程序包的资源中查找图像。如果您将图像添加到 Xcode，它将默认添加到项目的资源复制阶段。如果您想确保它被复制到您的应用程序包中，请查看 Xcode 编辑器左侧的列表，在目标下您将在那里看到您的应用程序名称，在该名称下您将看到几个构建阶段，只要`a.png`出现在“复制捆绑资源”阶段你应该很高兴。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T20:55:39.160

您需要确保将 a.png 作为资源导入 xCode。如果你已经这样做了，那么将它引用为“a.png”应该可以。

# c# - XmlSerializer 序列化空变量以使用两个标签？

> ID：254821
> 
> 赞同：5
> 
> 时间：2008-10-31T20:18:26.427
> 
> 标签：c#, xml, xml-serialization

我希望能够将序列化的 xml 类加载到 Soap Envelope。我开始了，所以我没有填充内脏，所以它看起来像：

```
<Envelope    
xmlns="http://schemas.xmlsoap.org/soap/envelope/" /> 
```

我希望它看起来像：

```
<Envelope    
xmlns="http://schemas.xmlsoap.org/soap/envelope/" ></Envelope>` 
```

我写的课是这样的：

```
[System.SerializableAttribute()]
[System.Xml.Serialization.XmlTypeAttribute(AnonymousType = true, Namespace = "http://schemas.xmlsoap.org/soap/envelope/")]
[System.Xml.Serialization.XmlRootAttribute(Namespace = "http://schemas.xmlsoap.org/soap/envelope/",ElementName="Envelope", IsNullable = true)]
public class TestXmlEnvelope
{
  [System.Xml.Serialization.XmlElement(ElementName="Body", Namespace="http://schemas.xmlsoap.org/soap/envelope/")]
  public System.Collections.ArrayList Body = new System.Collections.ArrayList();
} //class TestXmlEnvelope` 
```

我以这个为例，因为其他人可能想要它在一个单独的元素中。我确信这一定很简单，但遗憾的是我不知道正确的关键字。

一如既往地感谢您的帮助。

[编辑] 当我尝试使用此指令时出现错误

```
System.Xml.Serialization.XmlSerializer xmlout = new System.Xml.Serialization.XmlSerializer(typeof(TestXmlEnvelope));
System.IO.MemoryStream memOut = new System.IO.MemoryStream();
xmlout.Serialize(memOut, envelope, namespc);
Microsoft.Web.Services.SoapEnvelope soapEnv = new Microsoft.Web.Services.SoapEnvelope();
soapEnv.Load(memOut); 
```

它给了我错误“找不到根元素”。

[编辑]我修复了错误，问题是在我序列化对象后我没有设置memOut.Position = 0。我仍然希望这个问题可以帮助其他可能想要这样做的人。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-31T20:44:10.027

这里的主要问题是对何时写入结束标签的`XmlSerializer`调用。但是，这会在没有内容时生成速记形式。分别写结束标签。`WriteEndElement()``XmlWriter``<tag/>``WriteFullEndElement()`

您可以将自己的`XmlTextWriter`代码注入到序列化程序用来展示该功能的中间。

鉴于这`serializer`是适当的`XmlSerializer`，试试这个：

```
public class XmlTextWriterFull : XmlTextWriter
{
    public XmlTextWriterFull(TextWriter sink) : base(sink) { }

    public override void WriteEndElement()
    {
        base.WriteFullEndElement();
    }
}

...

var writer = new XmlTextWriterFull(innerwriter);
serializer.Serialize(writer, obj); 
```

[编辑]对于您添加代码的情况，添加外观构造函数：

```
public XmlTextWriterFull(Stream stream, Encoding enc) : base(stream, enc) { }
public XmlTextWriterFull(String str, Encoding enc) : base(str, enc) { } 
```

然后，像以前一样在构造函数中使用内存流作为内部流：

```
System.IO.MemoryStream memOut = new System.IO.MemoryStream();
XmlTextWriterFull writer = new XmlTextWriterFull(memOut, Encoding.UTF8Encoding); //Or the encoding of your choice
xmlout.Serialize(writer, envelope, namespc); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-28T21:25:38.100

注意记录：OP 使用的是[***Microsoft.***Web.Services.SoapEnvelope](http://msdn.microsoft.com/en-us/library/ms977223.aspx#)类，它是非常过时的 WSE 1.0 产品的一部分。此类派生自 XmlDocument 类，因此 XmlDocument 可能会出现相同的问题。

在任何情况下都不应将 WSE 用于任何新的开发，如果它已经在使用，则应尽快迁移代码。WCF 或 ASP.NET Web API 是未来应该用于 .NET Web 服务的唯一技术。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-10-31T20:23:36.260

这两种表示是等价的。为什么需要它以后一种形式出现？

# javascript - 我该如何扩展这个？

> ID：254823
> 
> 赞同：4
> 
> 时间：2008-10-31T20:19:11.620
> 
> 标签：javascript, jquery, forms, field

我有一个几页长的表格。为了遍历表单，我所做的就是显示和隐藏容器 div。最后一页是提交前的确认页面。它获取表单的内容并将其布局，以便用户可以看到他/她刚刚填写的内容。如果他们单击其中一个，它将带他们回到他们所在的页面（#nav1~3），专注于该字段，并让他们在需要时输入一个新值。

使用 jQuery，我为每个字段/radio/check/select/textarea/whatever 创建了变量。如果我的方法看起来很傻，请告诉我，但基本上，这个方法已经可以了，但我正在尝试**扩展**它，我不知道如何，因为我真的不知道我在做什么。想法？

```
  var field1 = '<a href="#"
    onclick="$(\'#nav1\').click();$(\'input#field-1\').focus();"
    title="点击编辑">' +
    $('input#field-1').val() + '</a>';
    $('#field1-confirm').html(field1);

  var field2 = '<a href="#"
    onclick="$(\'#nav1\').click();$(\'input#field-2\').focus();"
    title="点击编辑">' +
    $('input#field-2').val() + '</a>';
    $('#field2-confirm').html(field2);

```

以此类推，有field3、4、5~25等。

如果你能帮助用非程序员的术语解释，我会永远爱你。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-31T20:28:09.637

我将从介绍数组开始：对于初学者来说，[这个](http://www.hunlock.com/blogs/Mastering_Javascript_Arrays)看起来相当不错。

围绕数组和循环开始，你会得到很好的服务。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T20:35:45.270

无需太复杂，您可以创建一个处理重复内容的函数。我没有测试过这个，但你会明白的：

```
function valField(fieldName,navName) {
    var output = '<a href="javascript://" onclick="$(\''+navName+'\').click();$(\'input#'+fieldName+'\').focus();" title="Click to edit">' + $('input#'+fieldName).val() + '</a>';
 $('#'+fieldName+'-confirm').html(output);
}

valField("field-1","nav1")
valField("field-2","nav1")
valField("field-293","nav3") 
```

当您在 Javascript 方面变得更好时，您可能会创建一个循环来处理所有这些“valField()”调用，或者您会编写一些东西来检查您的表单，找到那里的内容并生成事件处理程序以自动将它们粘合在一起。这当然不是“n00bware”，但它给了你一些思考。

也不要在输出中使用它：

```
$(\''+navName+'\').click(); 
```

您可以用导航选项卡的 onclick 中实际存在的任何代码替换它。

有几十种方法可以解决这个问题。一步一步来。

# c# - 使用 LINQ 和 C# 的随机数组

> ID：254844
> 
> 赞同：11
> 
> 时间：2008-10-31T20:27:34.663
> 
> 标签：c#, vb.net, linq, enumerable

我正在阅读 MSDN 杂志上关于使用[LINQ 中的 Enumerable 类](http://msdn.microsoft.com/en-us/magazine/cc700332.aspx)生成随机数组的文章。这篇文章使用 VB.NET，我不确定 C# 中的等价物是什么：

```
Dim rnd As New System.Random()
Dim numbers = Enumerable.Range(1, 100). _
    OrderBy(Function() rnd.Next) 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-31T20:32:04.060

[Developer Fusion VB.Net 到 C# 转换器](http://www.developerfusion.com/tools/convert/vb-to-csharp/)说等效的 C# 代码是：

```
System.Random rnd = new System.Random();
IEnumerable<int> numbers = Enumerable.Range(1, 100).OrderBy(r => rnd.Next()); 
```

为了将来参考，他们还有一个[C# to VB.Net 转换器](http://www.developerfusion.com/tools/convert/csharp-to-vb/)。还有[一些其他工具](http://www.dotnetspider.com/convert/Vb-To-Csharp.aspx)可用于此。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-31T20:32:02.627

```
Random rnd = new Random();
IEnumerable<int> numbers = Enumerable.Range(1, 100).OrderBy(r => rnd.Next()); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-31T20:52:18.903

我最初认为这是一个坏主意，因为排序算法需要对数字进行多次比较，并且每次调用该数字的 lambda 时，它都会为同一数字获得不​​同的排序键。但是，它看起来只为列表中的每个元素调用一次，并存储该值以供以后使用。此代码演示了这一点：

```
int timesCalled = 0;
Random rnd = new Random();

List<int> numbers = Enumerable.Range(1, 100).OrderBy(r =>
   {
       timesCalled++;
       return rnd.Next();
   }
).ToList();

Assert.AreEqual(timesCalled, 100); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-07-06T19:46:19.097

更简单的事情呢...

```
Enumerable.Range(1, 100).OrderBy(c=> Guid.NewGuid().ToString()) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-31T20:37:45.563

在没有访问 Visual Studio 的情况下我能做到的最好的事情（交叉手指）：

```
System.Random rnd = New System.Random();
IEnumerable<int> numbers = Enumerable.Range(1, 100).OrderBy(rnd => rnd.Next); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-31T21:03:38.943

使用[C5 Generic Collection Library](http://www.itu.dk/research/c5)，您可以只使用内置`Shuffle()`方法：

```
IList<int> numbers = new ArrayList<int>(Enumerable.Range(1,100));
numbers.Shuffle(); 
```

# msbuild - MSBuild 没有使构建完全并行

> ID：254849
> 
> 赞同：1
> 
> 时间：2008-10-31T20:29:24.643
> 
> 标签：msbuild

我有一个 MSBuild 项目，其中我有一个调用多个项目的任务，我在其中设置了 BuildInParallel = "true"

例子：

```
 <Message Text="MSBuild project list = @(ProjList)" />
  <!-- Compile in parallel -->
  <MSBuild Projects="@(ProjList)" 
           Targets="Build" 
           Properties="Configuration=$(Configuration)" 
           BuildInParallel="true" /> 
```

这些子项目实际上调用了一个命令行工具来进行实际的“构建”——称之为 compile.exe。对构建过程进行粗略的分析（感谢 taskmgr.exe）有以下结果：

基于 /m 设置 - 我看到启动的 MSBuild.exe 进程的确切数量当然是预期的 - 可用的并发构建进程总数。

但是，我希望看到的是 compile.exe 的许多进程。基本上每个 MSBuild 进程都会转过身来调用 compile.exe。我看到的是启动了许多 compile.exe，然后它们慢慢完成，直到我只看到一个唯一的 compile.exe 仍然存在。每个 compile.exe 的任务花费不同的时间，因此预计其中一个任务比其他任务花费更长的时间。

但是，在它们的第一批“完成”之前，不会产生其他 compile.exe。换句话说，如果我有 /m:4 - 我将看到 4 个 compile.exe 直到全部完成，那么将产生另外 4 个。

这与我并不完全平行。有没有其他人看到过这种行为。我是不是误会了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-14T14:49:08.717

看看较新的帖子。看看 Hashimi MSPress 书 - 强烈推荐。

如果您使用的是 TeamBuild，则需要在构建服务配置文件中调整 MaxProcesses。[但你会说。]

如果您自己运行 msbuild，则需要使用 /m 调用 msbuild 以使任何事情发生。

@(ProjList) 中的文件是否都包含 ToolsVersion = 3.5？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-04-06T17:00:24.970

您是否尝试过使用该`msbuild /ds`选项？它会生成详细的摘要，可用于调试并行构建中的瓶颈。在 MSDN 网站上有一个非常好的博客条目。

# svn - 我的 CruiseControl.net 配置中只有一个两个项目在运行

> ID：254859
> 
> 赞同：1
> 
> 时间：2008-10-31T20:31:52.877
> 
> 标签：svn, cruisecontrol.net, nant, ccnet-config

我是第一次创建集成服务器，虽然我的 Cruisecontrol 配置文件中有两个项目，但似乎只有第一个项目正在执行。我的配置文件粘贴在下面。

```
<cruisecontrol>

    <project name="cc-config">
        <triggers>
            <intervalTrigger seconds="60" />
        </triggers>
        <sourcecontrol type="svn">
            <trunkUrl></trunkUrl>
            <workingDirectory>C:\Program Files (x86)\CruiseControl.NET\server\config</workingDirectory>
        </sourcecontrol>
    </project>

    <project name="stable_trunk">
        <workingDirectoy>C:\working</workingDirectory>
        <artifactDirectory>C:\artifact</artifactDirectory>
        <triggers>
            <intervalTrigger name="continuous" seconds="60"/>
        </triggers>
        <sourcecontrol type="svn">
            <trunkUrl></trunkUrl>
            <workingDirectory>C:\projects\security\trunk</workingDirectory>
        </sourcecontrol>
        <tasks>
            <nant>
                <executable>C:\projects\security\trunk\tools\nant-0.86-nightly-2008-08-18\bin\nant.exe</executable>
                <buildFile>C:\projects\security\trunk\security.build</buildFile>
            </nant>
        </tasks>
        <externalLinks>
            <externalLink name="proj" url="projURL">
        </externalLinks>
    </project>

</cruisecontrol> 
```

有谁能够帮我？谢谢卡特

附加信息：

*   日志文件没有错误，也没有提到第二个项目
*   Web 界面只显示第一个项目

就好像第二个项目甚至不存在一样。

问题是错字，我错过了日志文件中的错误。WorkingDirectory 标记缺少最后一个“r”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T20:40:33.980

1.  您是否检查过您的 CCNet 构建日志是否有任何异常？（*编辑答案：是的，没有。*）

2.  登录 CCNet Web 服务器，第二个项目是否显示为有效项目？（*编辑答案：不，它没有。*）

3.  如果是这样，您可以在其上建立力量吗？（*编辑答案：不，因为它没有出现。*）

因此，由于这些答案，我的下一个建议是从命令行（而不是通过服务）启动您的 cc 服务器，以查看是否出现任何消​​息。

这是令人惊讶的，因为通常当我的 CCNet 配置文件中有错误时，服务器会崩溃（非常困难），并且总是让我知道有问题。我真的很惊讶您可能会添加一个未显示或使服务器崩溃的项目。

您可能会尝试走简单的路线，只需添加第三个空项目，看看您是否可以让 /that/ 出现在您的列表中。此外，您可以尝试插入一个您知道会使其崩溃的故意拼写错误，然后看看您是否可以让它显示出来。我担心您可能正在编辑错误的配置文件，或者 CCNet 实际上并没有看到您对其所做的更改（源代码控制同步问题？）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-03T15:21:38.553

你有没有深究？

如果没有，请查看您的日志文件 (?:\Program Files\CruiseControl.NET\server\ccnet.log)。

我建议在这个阶段使用控制台应用程序 (ccnet.ext) 而不是服务 - 你可以更容易地看到正在发生的事情。此外，在启动控制台之前，请确保通过打开 ccnet.exe.config 文件，找到**log4net**标记并在其**root中设置****level value="DEBUG"**将其设置为 DEBUG 日志记录。

 **启动控制台并让它运行几分钟，然后停止它并查看日志（如果仍有问题，请在此处发布）。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T23:26:32.570

[间隔触发器](http://confluence.public.thoughtworks.org/display/CCNET/Interval+Trigger)的默认**buildCondition**为**IfModificationExists ，这意味着只有在**[源代码控制块](http://confluence.public.thoughtworks.org/display/CCNET/Source+Control+Blocks)中检测到修改时才会启动构建。

### 来自 ccnet 的关于 buildCondition 属性的文档

> 应该用于启动集成的条件。默认情况下，此值为 IfModificationExists，这意味着只有在检测到修改时才会触发集成。将此属性设置为 ForceBuild 以确保无论是否检测到新修改都应启动构建。使用源代码控制块来指定要观察哪些修改。

因此，如果想要*始终*启动构建，无论是否在源代码管理中发生了修改，那么都需要为**buildCondition**属性指定**ForceBuild 。**例如：

 **```
<triggers>
    <intervalTrigger name="continuous" buildCondition="ForceBuild" seconds="60"/>
</triggers> 
```

# c# - 将大括号与单行“if”语句的语句放在同一行会是不好的形式吗？

> ID：254864
> 
> 赞同：9
> 
> 时间：2008-10-31T20:33:27.287
> 
> 标签：c#, language-agnostic, coding-style

所以我知道总是包含 if、for 等的花括号被认为是一种很好的做法，即使它们是可选的，如果只有一个以下语句，因为它更容易意外地做类似的事情：

```
if(something == true)
    DoSomething();
    DoSomethingElse(); 
```

如果您不放置大括号，则在快速编辑代码时。

像这样的东西呢：

```
if(something == true)
{   DoSomething(); } 
```

这样，您仍然占用更少的行（IMO 增加了可读性），但仍然不太可能意外地从上面犯错误？

我问是因为我不相信我以前见过这种风格的 if 或循环，但我确实看到它用于 C# 属性中的 getter 和 setter，例如：

```
public string Name 
    {get;set;} 
```

不问什么是最好的，因为这太主观了，而只是问这是否被认为是可接受的风格，如果不是，为什么不。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-31T20:36:06.517

当我遇到单行 if 语句时，我通常会跳过花括号并将所有内容保持在同一行：

```
if (something == true) DoSomething(); 
```

它快速、简单且节省空间。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-31T20:35:50.340

代替：

```
if(something == true)
{   DoSomething(); } 
```

做这个：

```
if(something == true) {   DoSomething(); } 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-31T20:48:40.330

我倾向于将开口大括号放在自己的行上，如下所示：

```
if (condition)
{
   statement;
   statement;
} 
```

所以看到类似的东西：

```
if (condition)
   statement;
   statement; 
```

立即表明错误。如果我只有一个声明，我就把它保留为

```
if (condition)
   statement; 
```

如果我有额外的语句要添加，请稍后放入大括号。我真的看不出有任何混淆的余地。

将语句与条件放在同一行是一个不好的习惯，因为当您进行调试时，大多数调试器会将整个内容视为一行。（我意识到在 C# 中并非如此）。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-31T20:37:26.297

如果你在一个团队中工作，你需要提出一个标准。

我个人喜欢这样做：

```
if(foo)
    DoSomething(); 
```

或者

```
if(foo) DoSomething(); 
```

我不认为没有牙套有问题。人们引用的原因，您提到的关于在下面一行添加另一条语句的原因，是我从未遇到过的。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-31T20:57:04.307

许多人建议将两者放在一条线上。这可能会增加可读性，但在我看来是以降低调试能力为代价的。我已经通过这种方式编写了很多代码，因此调试起来更加困难。

一些调试器和 IDE 可能能够跨过单行语句的两个部分，`if`并清楚地显示条件评估是否为真，但许多其他调试器可能会将其视为单行，从而难以确定`if`-声明被调用。

例如，用于 C++ 代码的 VS2008 调试器会将其作为单行单步执行，从而难以确定是否调用了 Foo()。

```
if (a==b) { Foo(); } 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-31T21:02:28.320

就个人而言，我喜欢我所有的积木都具有相同的图案。我总是为 if 使用大括号，并且它们总是开始一个新行。我喜欢自动定义放置 { get; 的公共属性的习语。放; } 在同一行。我只是觉得让所有块都以自己的大括号开头可以提高可读性。正如其他人指出的那样，如果您跨行，它也会在调试器中更加清晰。

如果您不同意，那也没关系，但正如其他人所说，要保持一致。为此，您可能希望在您和您的同事之间共享“代码格式化”设置，以便自动格式化使每个人的一切都保持一致。

我会做：

```
if (something)
{
   DoSomething();
} 
```

和

```
public string MyProperty { get; set; } 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-31T20:36:31.447

> 这样你仍然占用更少的行（IMO增加了可读性）

我不同意减少换行符会增加可读性。代码的布局应该使它的结构更明显，而不是隐藏它。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-31T20:37:47.263

我不明白为什么不。我也将它用于简短的功能。

在进攻风格方面，远胜于难言：

```
 if (something== true)   {
      DoSomething();
  } 
```

但是，当我们谈到风格的话题时，

```
 if (something) 
```

和

```
 if (!something) 
```

绝不

```
 if (something== true) 
```

或者

```
 if (something== false) 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-31T20:43:23.943

我昨天在处理别人编写的代码时遇到了这个问题。原始代码是：

```
if (something == true) 
    DoSomething(); 
```

我想在调用之前进行调试打印`DoSomething()`。我会本能地做什么

```
if (something == true) 
    print("debug message");
    DoSomething(); 
```

但这会使`if`apply 仅适用于调试消息，而`DoSomething()`将无条件调用。这就是为什么我宁愿使用花括号，这样本能的编辑最终会变成：

```
if (something == true) {
    print("debug message");
    DoSomething();
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-31T20:48:39.020

新行、缩进、间距、对齐等形式的空白是排版的一个重要方面，广泛用于提高文章、书籍和网站中文本的可读性。不知道为什么它不适用于代码的可读性。

话虽如此，您和您的团队使用您的风格并没有错。只要你们都同意。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-31T20:36:13.770

那里没有问题......事实上，如果您尝试自动格式化它，Visual Studio 不会将该代码放在它自己的行上。所以，如果这对你来说更具可读性......你很好。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-31T20:36:41.697

如果你真的想节省代码行，你可以这样输入：

```
if(something == true) { DoSomething(); } 
```

或者这个，没有大括号

```
if(something == true) DoSomething(); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-31T20:39:27.867

我建议你像斯蒂芬和尼古拉斯曼库索所说的那样做。

采用：

```
if(something) {   DoSomething(); } 
```

带或不带支架。一旦你开始使用奇怪版本的“if”语句，你就会开始看到你的同事以一种奇怪的方式查看你的代码。

我通常使用一个衬垫进行验证。

例子：

```
if( param1 == null ) throw new ArgumentNullException("param1"); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-31T20:41:05.307

只要你保持一致，这应该不是问题。在以前的公司，这是典型的情况，但在我现在的公司，他们更喜欢将牙套放在单独的线上。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-31T21:31:54.470

只要您始终如一地执行此操作，并确保处理您的代码的每个人都知道您是如何操作的，那么您做什么并不重要。

只做你觉得最舒服的事，然后确保每个人都知道总是这样做。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-31T21:37:16.970

其实我更喜欢

```
if (something == true)
if (something == false) 
```

超过

```
if (something)
if (!something) 
```

对我来说，感叹号很难一眼看出，所以很容易错过。但是请注意，当我使用 Python 编码时，我几乎总是更喜欢：

```
if something:
if not something: 
```

除非我想将 None 与空列表区分开来。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-31T21:37:57.577

我偶尔喜欢做

```
if(obj != null) obj.method(); 
```

但这是一种有罪的乐趣......我认为它不会使代码更具可读性，那么为什么不遵循其他人都在使用的模式。我认为非常重要的一个例外是当您展示它如何成为更大模式的一部分并帮助用户更轻松地查看模式时：

```
public executeMethodOn(String cmd) {
  CommandObject co;

  if("CmdObject1".equals(cmd)) co=new CmdObject1();
  if("CmdObject2".equals(cmd)) co=new CmdObjec21();

  co.executeMethod();
} 
```

它使模式更加明显，并帮助尝试插入新功能的人看到它需要去哪里。

也就是说，如果你*曾经*有过这样的模式，那么你可能做错了。我必须在没有反射的系统上执行此操作，但我非常努力地解决它，如果我有反射，那会更棒。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-31T21:38:48.527

我通常使用单行 if 来执行此操作：

```
if($something) {
    do_something();
} 
```

一个例外（我使用 Perl，不确定 C# 中是否允许这种样式）是循环控件，我使用倒置的单线样式：

```
THING:
for my $thing (1 .. 10) {
    next THING if $thing % 3 == 0;
} 
```

通过良好的语法着色，可以使这些行明显突出。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-11-01T19:15:05.620

你们都错了错了！！！！;-)

幸运的是，VS 只需替换每个文件中的最后一个花括号，就可以将你所有的疯狂重新格式化为我个人认可的格式。

空白是一种风格。因为我们有不同的阅读风格和学习风格，所以你怎么做已经不​​重要了。这些工具可以让我们来回切换。我注意到的唯一缺点是它在跟踪源代码控制中的变化时需要付出代价。当我将 K&R 样式文件重新格式化为更健全的格式（我的观点）并检查该更改回源代码控制时，它几乎显示每一行都已更改。那是一种痛苦。但是许多 diff 实用程序可以忽略空白更改（尽管大多数仅在单行上，而不是跨行上）。这是一个问题。但不是表演的终结者。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-11-01T19:24:29.237

C 在格式化问题上提供了很大的自由度，因此将它们放在同一行或不同行与编译目的无关。

结果，“会很糟糕”仅指编码约定。这取决于上下文。如果您在一个团队中工作，最好询问其他所有人的想法并提出标准格式样式。如果没有，那真的取决于你。

因此，如果您认为这样更好，请继续。如果没有，那就不要。真的就这么简单（除非您使用强制一些样式约定的 IDE）

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-06-23T23:56:42.300

我更喜欢可怕的难以形容的语法：

```
if (true == something) {
    doSomething1();
} 
```

是的，这就是 K&R 的做法……是的，我回溯到那么远……是的，这对我来说已经足够了。这意味着即使我做这样的事情我也会得到通用的语法：

```
if (-1 == doSomething()) {
   doSomethingElse();
} 
```

无论它们包含多少行代码，我都将花括号放入其中。我被“需要添加一行测试代码”所困扰，并且错过了太多次缺少花括号。

我总是与左边的文字进行比较。这避免了“测试分配”错误（例如 if (something = true) {...}）。

“(something == true)”的可移植性并不比在布尔比较中表示“真”和“假”的重载值集更危险——但这是一种不同的危险。您是否使用将“空”（和/或零和/或 NULL 和/或空格）视为“真”或“假”的语言写作？我更喜欢对每种情况都安全的约定……因为我很懒。

# sharepoint - 如何有效地删除文档库中的所有文件？

> ID：254887
> 
> 赞同：8
> 
> 时间：2008-10-31T20:41:54.757
> 
> 标签：sharepoint, document-library

我正在寻找一个清晰、完整的示例，通过 Sharepoint 对象模型以编程方式从特定文档库中删除所有文档。doclib 不包含文件夹。我希望完全删除这些文档（即我不希望它们在回收站中）。

我知道 SPWeb.ProcessBatchData，但不知何故，它似​​乎对我不起作用。

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-01T18:14:05.227

我会坚持使用 ProcessBatchData 方法，也许这会有所帮助：

> [文森特·罗斯威尔](http://blog.thekid.me.uk)对此做了最好的介绍：http: [//blog.thekid.me.uk/archive/2007/02/24/deleting-a-considerable-number-of-items-from-a-list-in-sharepoint.aspx](http://blog.thekid.me.uk/archive/2007/02/24/deleting-a-considerable-number-of-items-from-a-list-in-sharepoint.aspx)

否则我不确定其他建议是否有效，因为 Foreach 循环不喜欢集合中的项目数随着每次删除而改变。

你可能最适合做一个反向 for 循环（我没有测试这段代码，只是一个例子）：

```
for (int i = SPItems.Length - 1; i >= 0; i--)
{
    SPListItem item = SPItems[i];
    item.File.Delete();
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T11:23:48.683

这不是删除项目的正确方法。在此处关注帖子 [http://praveenbattula.blogspot.com/2009/05/deleting-list-items-at-time-from-list.html](http://praveenbattula.blogspot.com/2009/05/deleting-list-items-at-time-from-list.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T20:52:18.233

您只需浏览文档库中的所有文件。

```
foreach(SPListItem item in SPContext.Current.Web.Lists["YourDocLibName"].Items)
{
    //TODO: Verify that the file is not checked-out before deleting
    item.File.Delete();
} 
```

从 API 对文件调用 delete 方法不会使用回收站。这是直接删除。您仍然需要验证该文件是否未被签出。

这里有一些参考：

*   [SP列表](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.splist_members.aspx)
*   [SPListItem](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.splistitem_members.aspx)
*   [SP文件](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spfile.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-08-26T16:33:15.697

Powershell方式：

```
function ProcessFolder {
    param($folderUrl)
    $folder = $web.GetFolder($folderUrl)
    foreach ($file in $folder.Files) {
        #Ensure destination directory
        $destinationfolder = $destination + "/" + $folder.Url 
        if (!(Test-Path -path $destinationfolder))
        {
            $dest = New-Item $destinationfolder -type directory 
        }
         #Delete file by deleting parent SPListItem
        $list.Items.DeleteItemById($file.Item.Id)
    }
}

#Delete root Files
ProcessFolder($list.RootFolder.Url)

#Delete files from Folders or Document Sets
foreach ($folder in $list.Folders) {
    ProcessFolder($folder.Url)
} 
```

# python - 如何在 django 模板的 url 模板标签中嵌入标签？

> ID：254895
> 
> 赞同：3
> 
> 时间：2008-10-31T20:45:04.067
> 
> 标签：python, django, url, templates, templatetag

如何在 django 模板的[url 模板标签中嵌入标签？](http://docs.djangoproject.com/en/dev/ref/templates/builtins/#url "url 模板标签")

Django 1.0，Python 2.5.2

在views.py

```
def home_page_view(request):
    NUP={"HOMEPAGE": "named-url-pattern-string-for-my-home-page-view"}    
    variables = RequestContext(request, {'NUP':NUP})
    return render_to_response('home_page.html', variables) 
```

在 home_page.html 中，如下

```
NUP.HOMEPAGE = {{ NUP.HOMEPAGE }} 
```

显示为

```
NUP.HOMEPAGE = named-url-pattern-string-for-my-home-page-view 
```

并且以下名为 pattern 的 url 有效（如预期的那样），

```
url template tag for NUP.HOMEPAGE = {% url named-url-pattern-string-for-my-home-page-view %} 
```

并显示为

```
url template tag for NUP.HOMEPAGE = /myhomepage/ 
```

但是当`{{ NUP.HOMEPAGE }}`嵌入`{% url ... %}`如下时

```
url template tag for NUP.HOMEPAGE = {% url {{ NUP.HOMEPAGE }} %} 
```

这会导致模板语法错误

```
TemplateSyntaxError at /myhomepage/
Could not parse the remainder: '}}' from '}}'
Request Method: GET
Request URL:    http://localhost:8000/myhomepage/
Exception Type: TemplateSyntaxError
Exception Value:    
Could not parse the remainder: '}}' from '}}'
Exception Location: C:\Python25\Lib\site-packages\django\template\__init__.py in __init__, line 529
Python Executable:  C:\Python25\python.exe
Python Version: 2.5.2 
```

我期望在运行时`{% url {{ NUP.HOMEPAGE }} %}`解析`{% url named-url-pattern-string-for-my-home-page-view %}` 并显示为`/myhomepage/`.

django 不支持嵌入式标签吗？

是否可以编写带有嵌入式标签支持的自定义 url 模板标签来完成这项工作？

`{% url {{ NUP.HOMEPAGE }} %}`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T21:00:30.633

也许您可以尝试将最终 URL 传递给模板？

像这样的东西：

```
from django.core.urlresolvers import reverse

def home_page_view(request):
    NUP={"HOMEPAGE": reverse('named-url-pattern-string-for-my-home-page-view')}    
    variables = RequestContext(request, {'NUP':NUP})
    return render_to_response('home_page.html', variables) 
```

然后在模板中，`NUP.HOMEPAGE`应该是 url 本身。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T20:59:47.170

这似乎太动态了。你应该做

```
{% url named-url-pattern-string-for-my-home-page-view %} 
```

就这样吧。动态填写 URL 标记的名称——坦率地说——有点奇怪。

如果您想使用大量不同的 URL 标记中的任何一个，则必须执行以下操作

```
{% if tagoption1 %}<a href="{% url named-url-1 %}">Text</a>{% endif %} 
```

这似乎是冗长的，因为再次，您试图实现的动态目标似乎有点奇怪。

如果您有类似“家庭”或“集群”页面的内容，那么单独的模板目录可能是一种更好地管理它的方法。每个页面集群都可以从基本模板继承并覆盖诸如此导航功能之类的小东西，以保持集群中的所有页面看起来相似但对于“本地主页”具有一个导航差异。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T13:28:15.153

向 Django 发布了一个错误。他们应该能够解决这个问题。

[http://code.djangoproject.com/ticket/10823](http://code.djangoproject.com/ticket/10823)

# c# - Silverlight Rest 服务，安全异常

> ID：254899
> 
> 赞同：13
> 
> 时间：2008-10-31T20:46:53.797
> 
> 标签：c#, silverlight, rest

我正在尝试让 Silverlight 使用快速示例应用程序，并在另一台计算机上调用休息服务。拥有其余服务的服务器有一个 clientaccesspolicy.xml，如下所示：

```
<access-policy>
    <cross-domain-access>
        <policy>
            <allow-from http-request-headers="*">
                <domain uri="*"/>
            </allow-from>
            <grant-to>
                <resource path="/" include-subpaths="true"/>
            </grant-to>
        </policy>
    </cross-domain-access>
</access-policy> 
```

并且正在被拾取（至少根据我运行的网络跟踪），并且没有对 crossdomain.xml 的请求。C# 代码如下所示：

```
public Page()
{
    InitializeComponent();

    string restUrl = "http://example.com/rest_service.html?action=test_result";

    WebClient testService = new WebClient();
    testService.DownloadStringCompleted += new DownloadStringCompletedEventHandler(testService_DownloadStringCompleted);
    testService.DownloadStringAsync(new Uri(restUrl, UriKind.Absolute));

}

void testService_DownloadStringCompleted(object sender, DownloadStringCompletedEventArgs e)
{
    if (e.Error == null)
    {
        LoadTreeViewWithData(e.Result);
    }
} 
```

但是，我总是收到以下安全错误：

```
{System.Security.SecurityException ---> System.Security.SecurityException：安全错误。
   在 System.Net.BrowserHttpWebRequest.InternalEndGetResponse（IAsyncResult asyncResult）
   在 System.Net.BrowserHttpWebRequest.c__DisplayClass5.b__4（对象 sendState）
   在 System.Net.AsyncHelper.c__DisplayClass2.b__0（对象 sendState）
   --- 内部异常堆栈跟踪结束 ---
   在 System.Net.AsyncHelper.BeginOnUI（SendOrPostCallback beginMethod，对象状态）
   在 System.Net.BrowserHttpWebRequest.EndGetResponse（IAsyncResult asyncResult）
   在 System.Net.WebClient.GetWebResponse（WebRequest 请求，IAsyncResult 结果）
   在 System.Net.WebClient.DownloadBitsResponseCallback（IAsyncResult 结果）}

```

我究竟做错了什么？为什么安全错误没有告诉我一些更有用的信息？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-31T21:29:29.547

如果您还没有这样做，我会首先尝试将 restUrl 更改为更简单的东西，例如同一服务器（或者如果需要在您自己的服务器上）上的静态 HTML 页面，以验证您的主要代码是否有效。

假设安全异常特定于该 REST URL（或站点），您可以查看[Silverlight 2 中的 URL 访问限制](http://msdn.microsoft.com/en-us/library/cc189008(VS.95).aspx)文章。除了更广为人知的跨域规则之外，还有一些涉及文件类型和“Internet 区域”的非显而易见的安全规则。

我第二次抱怨 Silverlight 中的许多异常消息不是很有帮助。上面引用的 MSDN 文章包含一个有趣的注释：

> 当用户收到因违反这些访问策略之一而导致的错误时，该错误可能无法指示确切原因。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-08-18T20:35:27.557

如果不将 http-methods="*" 添加到 clientaccesspolicy.xml 中的 allow-from 元素，我将无法执行跨域 REST HTTP 删除。当我添加 http-methods 属性时，一切正常，SecurityException 停止发生。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-12T13:41:36.187

[对于我的本地应用程序 ( http://localhost/](http://localhost/) ) ，从“受信任的站点”加载 HTML 页面失败- 直到我将 localhost 添加到受信任的站点列表中。

Silverlight 防止“跨区域”调用（在我的情况下为本地网络与可信站点）和“跨方案”调用（例如 http 与 https）。

到目前为止，它只适用于“crossdomain.xml”文件。我首先尝试了“clientaccesspolicy.xml”，但没有成功。

# php - 数组中的最大值

> ID：254901
> 
> 赞同：1
> 
> 时间：2008-10-31T20:47:37.663
> 
> 标签：php, arrays

有谁知道我怎样才能从以下数组的第三列中获得两个最大的值？

```
$ar = array(array(1, 1,   7.50,   'Hello'),
              array(1, 2,  18.90,   'Hello'),
              array(3, 5,  11.50,   'Hello'),
              array(2, 4,  15.90,  'Hello')); 
```

输出应该是：

```
15.90
18.90 
```

提前致谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-31T20:52:24.097

如果您确定值（二）永远不会改变，只需遍历数组并跟踪两个最大的数字。[`usort`如果不是，请使用()](http://www.php.net/manual/en/function.usort.php)对数组进行排序并提供适当的回调。然后取前两个值：

```
function cmp($a, $b) {
    $a = $a[2];
    $b = $b[2];
    return $a == $b ? 0 : $a < $b ? 1 : -1;
}

usort($ar, 'cmp'); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-31T21:00:33.567

排序是 O(n log n)，但实际上您可以在 O(n) 中完成此操作（也就是说，如果数组很大，则*更快）。*伪代码如下：

```
first  = array[0][2]
second = array[1][2]
if second > first
   first, second = second, first
for tuple in array[2:n]
   if tuple[2] > second
      second = tuple[2]
   if second > first
      first, second = second, first 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-31T21:16:26.687

一个更通用的解决方案，对于 n 个最大值（伪代码）

```
def maxN(list, n):
    result = []
    curmin = 0
    for number in list:
        if number > curmin:
            binary insert number into result.    #O(log n)
            if len(result) > n:  
                truncate last element            #O(1)
            curmin = new minimum in result list  #O(1) since list is sorted

    return result 
```

整个过程将花费... O(m log n)，其中 m 是列表的大小，n 是您想要的最大元素数。这比对大 n 需要 O(n log n) 的列表进行排序要好得多。

但是，如果您只想要最多两个元素，这也太矫枉过正了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T20:53:37.230

最简单的方法之一是将所有值收集到一个数组中，对数组进行排序，然后打印出前两个值。

有更有效的方法不涉及对整个数组进行排序，但以上内容应该可以帮助您入门。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-01T01:26:40.987

你从哪里得到数组数据？数据多久更改一次？你能得到已经按该字段排序的数组吗？如果有大量数据项，是否值得进行第二次查询？

# .net - 用于处理表单身份验证和活动目录的设计

> ID：254902
> 
> 赞同：1
> 
> 时间：2008-10-31T20:47:59.130
> 
> 标签：.net, authentication, active-directory

我应该使用什么设计模式来处理表单身份验证和活动目录？（管理设置将允许您选择其中之一）。

据我所知，.NET 会员提供者只有表格，对吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-01T18:00:27.627

实际上，您可能正在寻找“策略”模式，因为您需要实现一组特定的成员（那些需要实现身份验证“提供者”），但不希望身份验证关心它们是如何实现的。, [http://en.wikipedia.org/wiki/Strategy_pattern](http://en.wikipedia.org/wiki/Strategy_pattern)

Facade 很好，但是当您尝试“重塑”现有组件以使其与另一个组件兼容时，这更适用。由于您正在实施提供者，因此您不需要“重塑”它们以适应它们，您只需首先使用适当的提供者成员来实施它们..

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T20:51:20.730

.Net Membership 允许您使用 Windows 或 Passport 以及表单身份验证。

有一个 ActiveDirectoryMembershipProvider。[单击此页面](http://msdn.microsoft.com/en-us/library/ms998372.aspx#pagpractices0001_authhowtouseformsauthenticationwithactivedirectory)顶部链接中的“如何通过 Active Directory 使用表单身份验证”以获取详细信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T21:00:17.687

回答您的设计模式问题。在一个有类似情况的项目中（使用两个不同的系统进行身份验证），我们使用[Facade 模式](http://en.wikipedia.org/wiki/Facade_pattern)来抽象出哪个系统实际上正在执行身份验证（一个或另一个，甚至两者！）。

然后，在该外观中，我们将对身份验证提供程序进行实际调用。

# c# - 如果私有访问修饰符是多余的，您应该使用它吗？

> ID：254912
> 
> 赞同：52
> 
> 时间：2008-10-31T20:51:03.663
> 
> 标签：c#, coding-style

鉴于这两个例子是等价的，你认为哪个更可取？

**没有显式修饰符**

```
public class MyClass
{

    string name = "james";

    public string Name {
        get { return name; }
        set { name = value; }
    }

    void SomeMethod() { ... }

} 
```

**带有显式修饰符**

```
public class MyClass
{

    private string name = "james";

    public string Name {
        get { return name; }
        set { name = value; }
    }

    private void SomeMethod() { ... }

} 
```

* * *

我一直使用后者，但最近我开始采用前一种风格。private 是多余的，因为它是默认的访问器修饰符，所以排除它没有意义吗？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2008-10-31T20:52:54.113

我认为明确说明 private 有助于提高可读性。它不允许程序员以不同的方式解释其可见性。

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2010-01-12T15:42:40.970

看起来我们是唯一的，但就个人而言，**我支持**让我们删除私人活动。

我担心的是公共和私有非常相似，6-7 个字符长度，蓝色，以“p”开头，因此在 10 个显式私有方法之间指向一个公共方法比在没有访问属性的 10 个之间指向一个公共方法要困难得多。

此外，这是一个优势，因为您团队中的懒人倾向于省去编写修饰符并将方法设为私有，这实际上是一件好事。否则，您最终会得到所有公开的信息。

我通常更喜欢显式而不是隐式，但这在语言极端情况（棘手的作弊）中比在广泛的功能中更重要。在这里，我认为长期可维护性更重要。

*此外，我通常喜欢以数学*方式简单明了的代码，而不是明确的代码，以保持未来编码人员的无知。那是VB的方式，而不是C#...

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-10-31T21:02:06.917

将其标记为私有表明它是故意的，而不是“我实际上没有考虑过，所以我不知道它是否会更好。”；所以我喜欢让它明确。不过，我不会对此感到虔诚。

另外 - 这可以避免记住规则......默认情况下成员是私有的，（外部）类型默认是内部的；嵌套类型默认是私有的...

说清楚……说清楚；-p

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2008-10-31T21:05:45.490

我总是忽略它有两个原因：减少视觉混乱，并默认做正确的事情。

在 C# 中，一切都默认为尽可能低的**可见性**。类成员（字段、方法、属性）默认为私有。一个类默认为内部。嵌套类默认为私有。

因此，如果您在需要的地方忽略了可见性，那么您将自动使用尽可能少的可见性，这无论如何都是正确的做事方式。

如果您需要**更**明显的东西，请添加修饰符。这样可以轻松查看偏离默认可见性的项目。

（不幸的是，这条规则只适用于 C#。在 VB .NET 和 F# 中，默认值完全不同，在大多数情况下绝对不是“可能的最低可见性”。）

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-11-01T03:00:35.197

我已经全职使用 C# 开发了大约 7 年，直到我读到这个主题，我才知道默认的访问修饰符是什么。我知道它存在，但我从来没有使用过它。

我喜欢在编码时明确声明我的意图。既是因为当我回去查看它时，我可以看到声明，而且因为在我编写方法时实际思考和输入“私有”这个词让我更多地思考我的想法做。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-31T20:54:54.123

就个人而言，我更喜欢 private 修饰符 - 我喜欢明确性。对于字段，它还强调它是一个成员变量，而不是一个函数变量（唯一的区别是位置 - 如果人们可以正确缩进，这没关系，但否则可能会造成混淆）。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-11-04T01:30:18.263

我通常喜欢超级明确。我将始终指定“私人”。然而还有另一个原因：程序员来自默认可见性**不是**私有而是公共的编程语言，例如 PHP。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-10-31T20:53:36.903

我总是更喜欢明确，即使它是多余的。这提供了内置的代码注释，并且可以对下一个人有所帮助，尤其是如果他是菜鸟的话。:-)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-31T20:55:29.817

始终使用显式形式。如果出于某种原因，基本假设发生了变化，则具有显式访问权限的代码不会中断，而隐式含义则很容易中断。

此外，当您谈论不同类型的结构时，它们可能具有不同的默认可访问性。如果没有显式修饰符，读者就可以知道哪个结构具有什么默认值。例如，在 C# 中，结构字段默认为`public`，类字段默认为`private`，类定义默认为`internal`.

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-31T20:59:19.233

我一直都很明确。如果没有别的，它更清楚地表明了你的意图。如果我想保密，我会这么说。明确输入修饰符可以确保我考虑它，而不是因为它更快而将事情保密。一长串成员排列得更好:)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-31T21:06:18.470

我总是明确指定可见性。我不想让编译器猜测我的意图。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-31T20:54:27.103

您是对的，但是由于您希望您的代码对我认为您应该包括的每个人都可以理解，因此您永远不知道何时有人不知道这一点

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2017-07-25T17:20:49.410

首先，我会问是否有关于团队使用的以前的代码约定/标准。如果有的话，你应该遵循它。

如果您必须定义约定，我将推动明确的方式。

我的理由？

*   我喜欢保持相同的结构（我的意思是 a.-access 修饰符，b.-return-type/type，c.-name）。
*   我不希望（并且我不希望其他人）默认记住所有修饰符（[在此处](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/basic-concepts#member-access)）。
*   并非所有语言都有相同的规则。
*   不知何故，我认为，不知何故，迫使开发人员思考并更加意识到变量/方法的范围以及它们的阐述。如果您有一些经验，这可能不适用，但如果您是新手，或者您与经验较少的人一起工作，我认为这很有用。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-31T20:56:23.667

我的理解一直是成员具有“内部”可访问性，除非另有说明。如果这是真的，则需要“private”修饰符来确保这些成员实际上是私有的。

不管我对上述内容是否正确，保留修饰符将增加代码的可读性，以防其他开发人员稍后修改此类并对可访问性感到好奇。希望这可以帮助！

# javascript - 限制对页面的访问，除非来自特定页面

> ID：254929
> 
> 赞同：2
> 
> 时间：2008-10-31T20:55:23.607
> 
> 标签：javascript, html

我试图弄清楚如何限制对页面的访问，除非该页面是从特定的“门”页面导航到的。本质上，我希望该页面无法访问，除非您来自我的站点地图中它之前的页面。我不确定这是否可能。如果可能，您能否将您的建议限制为使用 html 或 javascript？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-31T20:57:55.630

> 如果可能，您能否将您的建议限制为使用 html 或 javascript？

不，因为仅使用这两种技术**没有安全的方法。**客户端发生的一切都可能被操纵（非常容易）。如果您想确定，您必须通过检查`REFERER`(sic!) 标头在服务器端强制执行此操作。

请注意，即使这是可以操纵的。

如果您使用`mod_rewrite`启用的 Apache，以下代码将根据引用页面限制访问：

```
RewriteEngine On
RewriteCond %{HTTP_REFERER} !^http://www\.example\.com/.*
RewriteRule /* http://www.example.com/access-denied.html [R,L] 
```

编辑：我刚刚检查[了手册](http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html#RewriteRule)……不幸的是，这里不可能给出 401 状态码。所以上面的解决方案并不完美，因为虽然它阻止了访问，但它并没有相应地设置 HTTP 状态。：-/在我嘴里留下不好的味道。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-31T21:22:02.960

唯一有效的方法是在服务器上设置和检查一些访问令牌（在客户端操作任何数据都是微不足道的，因此纯 JS 和 HTML 是不够的；对于`Referer`标头也是如此）。PHP中的一个简化示例：

gate_page.php：

```
<?php
session_start();
$_SESSION['allowed_access'] = true;
?><a href="protected_page.php">Protected area</a> 
```

protected_pa​​ge.php：

```
<?php
session_start();
if (!$_SESSION['allowed_access']) {
    header('Location: gate_page.php');
    echo 'Go through the <a href="gate_page.php">entry page</a> first.';
    exit();
}

// whatever happens to be at the protected page 
```

当然，很容易添加一些密码检查和/或其他安全元素，这是最低限度的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T21:07:57.547

如果您加密一个变量（如当前日期）并将其放在“门”链接中会怎样。当您到达新页面时，脚本会解密变量，如果它不匹配或什至不存在，脚本将重定向到另一个页面。

就像是：

```
<a href="restricted.php?pass=eERadWRWE3ad=">Go!</a> 
```

**编辑**：我不太了解 JS，无法打印该代码，但我知道有[几个库](http://www.google.com/search?q=javascript+encryption+library&ie=utf-8&oe=utf-8&aq=t&rls=org.mozilla:en-US:official&client=firefox-a)可以为您完成所有加密/解密。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T21:00:21.693

使用 javascript 命名一个名为“previous”的变量并将其值设置为 document.referrer。然后执行一个条件来判断referrer是否是正确的页面，如果不是，重定向它们

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-11T14:16:39.430

`document.history.previous`应该给你历史对象中最后一个文档的 URL。否则，没有更好的方法可以通过 HTML 和 Javascript 来实现。

# c# - Question SpeechSynthesizer.SetOutputToAudioStream 音频格式问题

> ID：254930
> 
> 赞同：5
> 
> 时间：2008-10-31T20:55:28.023
> 
> 标签：c#, audio, speech-recognition, text-to-speech

我目前正在开发一个应用程序，该应用程序需要传输编码为特定音频格式的语音。

```
System.Speech.AudioFormat.SpeechAudioFormatInfo synthFormat = 
                        new System.Speech.AudioFormat.SpeechAudioFormatInfo(System.Speech.AudioFormat.EncodingFormat.Pcm, 
                            8000, 16, 1, 16000, 2, null); 
```

这表明音频是 PCM 格式，每秒 8000 个样本，每样本 16 位，单声道，每秒 16000 个平均字节，块对齐为 2。

当我尝试执行以下代码时，我的 MemoryStream 实例中没有写入任何内容；但是，当我从每秒 8000 个样本更改为 11025 个样本时，音频数据已成功写入。

```
SpeechSynthesizer synthesizer = new SpeechSynthesizer(); 
waveStream = new MemoryStream(); 

PromptBuilder pbuilder = new PromptBuilder(); 
PromptStyle pStyle = new PromptStyle(); 

pStyle.Emphasis = PromptEmphasis.None; 
pStyle.Rate = PromptRate.Fast; 
pStyle.Volume = PromptVolume.ExtraLoud; 

pbuilder.StartStyle(pStyle); 
pbuilder.StartParagraph(); 
pbuilder.StartVoice(VoiceGender.Male, VoiceAge.Teen, 2); 
pbuilder.StartSentence(); 
pbuilder.AppendText("This is some text."); 
pbuilder.EndSentence(); 
pbuilder.EndVoice(); 
pbuilder.EndParagraph(); 
pbuilder.EndStyle(); 

synthesizer.SetOutputToAudioStream(waveStream, synthFormat);  
synthesizer.Speak(pbuilder); 
synthesizer.SetOutputToNull(); 
```

使用 8000 的采样率时没有记录任何异常或错误，我在有关 SetOutputToAudioStream 的文档中找不到任何有用的信息，以及为什么它以每秒 11025 个样本而不是 8000 的速度成功。我有一个涉及我的 wav 文件的解决方法使用一些声音编辑工具生成并转换为正确的采样率，但如果可以的话，我想从应用程序中生成音频。

一个特别有趣的地方是 SpeechRecognitionEngine 接受该音频格式并成功识别了我合成的波形文件中的语音......

更新：最近发现这种音频格式对于某些已安装的声音成功，但对于其他声音则失败。它专门针对 LH Michael 和 LH Michelle 失败，并且失败因 PromptBuilder 中定义的某些语音设置而异。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-10-08T22:36:09.560

LH Michael 和 LH Michelle 声音完全有可能根本不支持 8000 Hz 采样率（因为它们固有地生成 > 8000 Hz 的采样）。SAPI 允许引擎拒绝不受支持的速率。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-03T12:16:57.647

我在我的[NAudio](http://www.codeplex.com/naudio)库中创建了一些类，以允许您将音频数据转换为不同的采样率，如果您被合成器中的 11025 卡住了。看看`WaveFormatConversionStream`（使用 ACM）或`ResamplerDMO`（使用 DirectX 媒体对象）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-24T04:09:47.300

我遇到了类似的问题，想发表回复以防万一。这个线程让我找到了答案。我的问题是，我将 SpeechSynthesizer 输出到 WAV 文件，然后使用 NAudio 播放该 WAV 文件。当输出到文件时，它无需修改即可工作。但是，当尝试使用 MemoryStream 时，它会播放，但速度如此之快，您只听到吱吱声。

这段用于输出 SpeechSynthesizer 的代码解决了这个问题，并且在 NAudio 端不需要修改：

```
SpeechAudioFormatInfo synthFormat = new SpeechAudioFormatInfo(EncodingFormat.Pcm, 88200, 16, 1, 16000, 2, null);
synth.SetOutputToAudioStream(streamAudio, synthFormat); 
```

88200 是关键。默认情况下，这是 11025。只需要创建 SpeechAudioFormatInfo 并将其设置为 88200。

# mysql - 存储社会安全号码

> ID：254935
> 
> 赞同：28
> 
> 时间：2008-10-31T20:56:12.217
> 
> 标签：mysql, encryption

我目前工作的公司的人力资源部门要求我提供一个系统，用于在我们公司的数据库中存储员工的社会安全号码。这样做的原因是为了简化工资单的完成，因为我们将内部软件用于员工时间表，但必须与第三方软件集成以用于我们的实际工资单系统。这是一家相对较小的公司（20-30 名员工），我们只会存储当前员工的 SSN（因此违规只会产生有限的影响），但我仍然希望依靠安全性。

我想知道是否有任何约定可以存储与社会安全号码一样敏感的信息。我对加密不是很熟练，我知道有几种加密技术可以使用，但我想知道是否有一种特别适合这种情况的方法。AES 会是我最好的选择吗？

至于当前的软件，我们正在运行 MySQL，我们的 Web 界面是用 PHP 编写的，并在 IIS 服务器上运行。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-31T21:34:21.330

[我见过的存储敏感数据的最佳方法](http://tjic.com/?p=9646)是公钥加密，并将私钥存储在数据库以外的地方（例如，通过仅 HR 和 CEO 可以使用的应用程序）：

> 然后我们开始存储人们的信用卡……但在网站上，我们会立即用公钥对其进行加密。...
> 
> 在后端，我们有私钥，并且使用正确的密码短语，我们可以暂时解密 [私钥]，然后使用 [私钥] 解密信用卡，并从卡中收取 DVD 费用。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-01T00:10:11.577

我没有看到任何地方提到它，但是这些信息有必要在线吗？如果没有，那么您只需将这些信息存储在未连接到 Internet 的计算机上的数据库中，就可以保护一个主要的攻击途径。或者，如果您可以将其存储在 LAN 的某个地方（以便 HR 可以访问它，或其他）而不是生产服务器，那么这仍然是朝着正确方向迈出的一步。

您提到您在一家相对较小的公司工作，但考虑到离线存储此类敏感信息的好处，对一些廉价硬件的投资似乎并不难说服决策者。除非在不久的将来出现大规模招聘热潮，否则您不需要服务器级计算机以任何方式存储约 30 名员工的个人信息。

无论您将它存储在哪里，我仍然会考虑某种加密。AES 256 是当今大多数应用程序中的安全标准，并且得到了广泛的支持。这听起来不像是那种承受任何负载的应用程序，所以再一次，从它的声音来看，使用更大的密钥大小和廉价的硬件并没有什么坏处。

就实现而言，如果您对 MySQL 感到满意 - 坚持下去，他们拥有您需要的工具来做您想做的事：http: [//dev.mysql.com/doc/refman/5.0/en/加密函数.html](http://dev.mysql.com/doc/refman/5.0/en/encryption-functions.html)

归根结底，安全就是层次，没有单一的解决方案是灵丹妙药，但你可以通过添加一些非常简单、常识性的安全措施来走很长的路。

编辑：在阅读了 Graeme 所说的之后，我觉得我应该补充一点，大多数安全漏洞都是内部工作——确保在磁盘级别、通过数据库和网络上保护您的数据。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-31T21:21:00.700

我的建议：将你的 MySQL 数据存储在加密磁盘上，以便在笔记本电脑错位等情况下无法检索数据。

如果数据库应用程序本身受到威胁，当然没有任何帮助，因为应用程序本身使用 SSN。也许这是您可以纠正的设计缺陷。我倾向于考虑将 SSN 映射到（非 SSN）密钥的小型受限应用程序，然后使用该新密钥作为数据库中的“用户 ID”而不是 SSN。我会不惜一切代价避免 SSN 本身的扩散。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-20T21:16:46.640

请勿将 SSN 用作主键或以其他方式增加其值而不是必要的。使用生成的员工 ID 号或其他唯一 ID。这将降低问题的复杂性。

如果可能，请将 SSN 保存在完全不同的数据库实例中，并且不允许外部应用程序的日常功能访问它。

隔离 SSN 后，您可以使用任何建议的方法来加密数据。加密物理表和加密存储字段将使某人更难窃取物理数据库文件或使用基本 SQL 访问查看 SSN。

主要关注的是通过 DB 机制限制对 SSN 表的访问，限制 OS 访问，并在物理上保护机器。通过数据库，尽可能使用最受限制的权限。尽可能不要允许网络、在线或其他“共享”帐户访问该表。在操作系统访问中，将登录和目录访问限制为已知的用户列表。开启所有可能的审计。就物理安全而言，机器应位于锁定/安全的位置。

遵循有关存储 SSN 的计算机安全的[NSA 指南](http://www.nsa.gov/SNAC/)以及可以访问该计算机的任何计算机。

由于您只是一家小公司，因此您无需过多担心在发生违规时保留邮寄用品和资金/保险以进行身份​​监控。拥有大量员工和/或客户的组织在满足违规通知的法律要求方面面临着重大挑战。在短时间内找到[2600 万个信封并不容易。](http://articles.latimes.com/2006/may/26/nation/na-vets26)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-31T23:03:02.197

您想使用某种可逆加密，越强越好，并向 SSN 添加一些盐。添加盐将使黑客更难以仅使用数据库中的数据来反转加密。盐应该是数字，以便与 SSN 融合。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-31T23:28:50.630

社会安全号码属于“ [PII](http://en.wikipedia.org/wiki/Personally_identifiable_information) ”（个人身份信息）......您*应该*加密它们，但这不是必需的。所以，是的，AES 非常好……真的，你做的任何事情都是一个加分项。

信用卡号码属于“PCI”（支付卡行业）合规性，这是一团糟。但在你的情况下，你没事。

顺便说一句：AES 128 被认为对于 Visa、Amex、Discover 等 (PCI) 来说已经足够好了。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-31T21:46:50.073

目前有几份文件说明了政策，例如[白宫备忘录](http://www.whitehouse.gov/omb/memoranda/fy2007/m07-16.pdf)和 GAO 报告[GAO 报告](http://www.gao.gov/new.items/d071023t.pdf?source=ra)。

除此之外，还有用于安全性的[加密](http://security-basics.blogspot.com/)、[vpn](http://computer.howstuffworks.com/vpn.htm)和[PKI](http://www.cs.auckland.ac.nz/~pgut001/pubs/pkitutorial.pdf)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-31T21:36:17.987

MySQL 有许多可用于编码/解码的[加密函数。](http://dev.mysql.com/doc/refman/5.0/en/encryption-functions.html#function_encrypt)它们应该足以用于内部应用程序。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-31T21:02:40.193

我不确定您是否可以在 MySQL 中执行此操作，但您可以在表上设置一个插入/更新触发器，在数据保存到数据库时对其进行加密，然后在表上查看自动解密 SSN。

请注意，这只涉及加密**磁盘上**的数据；您还想研究传输层加密以保护线路上的数据（同样，如果 MySQL 支持）。

编辑添加：阅读 Marcin 的回答后，我意识到我没有提到密钥管理问题。任何有权访问触发器或视图定义的人也可以访问加密密钥，因此如果 MySQL 能够隐藏触发器和视图定义，那么您也需要调查一下。当然，在加密数据中包含加密密钥本质上是不安全的，因此这不是一个*完美*的解决方案。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-20T21:05:10.127

我的建议是依靠限制访问。只有一个帐户能够实际读取（并在必要时写入）存储 SSN 的表。在您的应用程序中使用该帐户访问数据库并阻止其他所有帐户的访问。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2008-10-31T21:11:03.250

好吧，您还没有提供任何有关您将如何处理这些数字的信息。如果您需要检索 SSN，那么基本上没有必要对此进行任何操作 - 将其清楚地存储。任何形式的加密都将密文和密钥放在同一个地方，只会稍微减慢攻击者的速度。这仅对无法获取大量数据、无法仅获取您的整台计算机或没有能力加入这些点的攻击者很重要。如果您正在处理后一种情况，则首先实际的访问控制更为重要。

但是，如果您从外部获得 SSN 并想找出是谁的帐户，您可以使用单向哈希来做到这一点。

# delphi - 如何让 PNG 在 D2009 中工作？

> ID：254952
> 
> 赞同：6
> 
> 时间：2008-10-31T21:02:06.463
> 
> 标签：delphi, png

Delphi 2009 的广告功能之一是对 PNG 的支持。太好了，因为 Unicode 问题破坏了我之前使用的 pngimage.pas 库。唯一的问题是，我*找不到*Delphi 2009 版本。任何人都知道它叫什么，以及将现有的基于 pngimage.pas 的代码迁移到新库有多么困难？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-31T22:26:26.637

Delphi 中的所有 VCL 图像支持都是通过 TImage 提供的。如果要显示 PNG 图像，只需拖放一个 TImage 控件，然后将 PNG 图像加载到 Picture 属性中。

如果您想在代码中操作 PNG 图像（即不显示它），那么您可以添加

png图片

添加到您的 uses 子句中，然后直接使用 TPNGImage 类。

在我的机器上，PNGImage.pas 位于：

C:\Program Files\CodeGear\RAD Studio\6.0\source\Win32\vcl\Imaging\PNGImage\pngimage.pas

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T21:24:31.427

您可以将 png 图像读入 TImage 控件。就像 gif、jpg、emf、wmf、bmp。

不确定这是否是您想要的。

# email - 如何将电子邮件转发给 FogBugz 并将其变成错误？

> ID：254958
> 
> 赞同：8
> 
> 时间：2008-10-31T21:03:47.553
> 
> 标签：email, fogbugz

我没有在帮助中看到它，但我认为这是可能的。另外，我如何找出要使用的电子邮件地址？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-31T21:07:47.873

你看过[这里](http://help.fogcreek.com/7754/using-fogbugz-to-check-pop3-and-imap-mailboxes)吗？

^(更新了指向新帮助台的链接 2013/10/7)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-10T01:58:49.223

If you're using FogBugz-on-Demand, chances are you have a cases@<your-account-name>.fogbugz.com address that already works.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-02T17:15:24.783

正如@Jonathan 所说，您必须首先为项目设置一个邮箱。有关详细信息，请参阅他的链接。然后，您只需转发到您为项目创建的地址。我们通常使用 product-support@company.com 等地址。

# winforms - WinForms：GDI+绘图表面的最佳控件是什么？

> ID：254965
> 
> 赞同：9
> 
> 时间：2008-10-31T21:06:48.000
> 
> 标签：winforms

我认为您可以在 .net windows 窗体项目中的几乎任何窗口中进行 GDI+ 绘图，但是您推荐什么作为包含自定义绘图的最佳内置控件？我将绘制自己的 xy 图、文本和图像。我可以使用 Panel、UserControl 等。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-31T21:21:09.500

如果您只是绘制控件而不是托管子控件，那么从 Control 派生 - VS 将使您成为一个合适的类（它称之为“自定义控件”），其中 OnDraw 处理程序已经存根。

如果您在控件中托管其他控件，则从 UserControl 派生（VS 将其称为“用户控件”，您将获得对 VS 设计器的支持，因此您可以在顶部拖动其他控件。

对于简单的非滚动图表，我将从 Control 派生。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T21:23:10.307

在屏幕外的位图表面中进行 GDI+ 绘图，然后将其 blit 到您需要的任何控件。

您的控件 Paint 方法只需要将表面复制到自身。

# c# - 处理 .NET IDisposable 对象

> ID：254969
> 
> 赞同：40
> 
> 时间：2008-10-31T21:08:53.660
> 
> 标签：c#, .net, visual-studio, idisposable, using-statement

`using`我在 C# 中工作，对于使用块来声明实现的对象，我一直很松懈`IDisposable`，显然你总是应该这样做。但是，我看不到一个简单的方法来知道我何时滑倒。Visual Studio 似乎没有以任何方式表明这一点（我只是错过了什么吗？）。我是不是应该每次声明任何东西时都检查一下帮助，并逐渐建立一个百科全书式的记忆，哪些对象是一次性的，哪些不是一次性的？似乎不必要、痛苦且容易出错。

*你*怎么处理这个？

**编辑：**

查看相关问题侧边栏，我发现[了另一个问题](https://stackoverflow.com/questions/2785/setting-objects-to-nullnothing-after-use-in-dot-net)，它明确表示`Dispose()`无论如何应该由对象的终结器调用。因此，即使您从未自己调用它，它最终也应该会发生，这意味着如果您不使用它就不会发生内存泄漏`using`（我想这是我一直担心的问题）。唯一需要注意的是，垃圾收集器不知道对象作为非托管的东西持有多少额外的内存，因此它无法准确知道通过收集对象将释放多少内存。这将导致垃圾收集器的性能不如通常理想。

简而言之，如果我错过了一个`using`. 我只是希望某些东西至少会产生一个警告。

（题外话：为什么链接到另一个问题没有特殊的降价？）

**编辑：**

好吧，好吧，别吵了。这是超级骗子的全能[戏剧花栗鼠](http://www.youtube.com/watch?v=a1Y73sPHKxw)级别，***重要***的是要打电话`Dispose()`，否则我们都会*死*。

现在。鉴于此，为什么这么容易——见鬼，为什么甚至*允许*——做错事？你必须不遗余力地做正确的事。像其他所有事情一样这样做会导致世界末日（显然）。封装这么多，是吧？

[离开，厌恶]

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-31T21:11:00.817

FxCop*可能会*有所帮助（尽管它没有发现我刚刚对其进行的测试）；但是是的：您应该检查一下。`IDisposable`只是系统中如此重要的一部分，您需要养成这种习惯。使用智能感知来寻找`.D`是一个好的开始（虽然并不完美）。

但是，熟悉需要处理的类型并不需要很长时间。例如，通常涉及任何外部事物（连接、文件、数据库）的任何事物。

ReSharper 也可以完成这项工作，提供“投入使用构造”选项。但是，它不会将其作为错误提供...

当然，如果你不确定 -*试试看* `using`：如果你偏执，编译器会嘲笑你：

```
using (int i = 5) {}

Error   1   'int': type used in a using statement must be implicitly convertible to 'System.IDisposable' 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-01T03:38:35.447

如果一个对象实现了`IDisposable`接口，那么它是有原因的，你应该调用它，它不应该被视为可选的。最简单的方法是使用`using`块。

`Dispose()`不打算仅由对象的终结器调用，事实上，许多对象将实现`Dispose()`但没有终结器（这是完全有效的）。

dispose 模式背后的整个想法是，您提供了一种确定性的方式来释放由对象（或其继承链中的任何对象）维护的**非托管**资源。如果没有正确调用`Dispose()`，您绝对*可能会*遇到内存泄漏（或任何数量的其他问题）。

该`Dispose()`方法与析构函数没有任何关系。.NET 中最接近析构函数的是终结器。using 语句不执行任何解除分配...实际上调用`Dispose()`不会在托管堆上执行任何解除分配；它只释放已分配的非托管资源。在 GC 运行并收集分配给该对象图的内存空间之前，不会真正释放托管资源。

确定类是否实现的最佳方法`IDisposable`是：

*   IntelliSense（如果它有一个`Dispose()`或一个`Close()`方法）
*   MSDN
*   反射器
*   编译器（如果它没有实现`IDisposable`你会得到一个编译器错误）
*   常识（如果*感觉*你应该在完成后关闭/释放对象，那么你可能*应该*）
*   语义（如果有一个`Open()`，可能有一个对应`Close()`的应该被调用）
*   编译器。试着把它放在一个`using`声明中。如果它没有实现 IDisposable，编译器会产生一个错误。

将处置模式视为与范围生命周期管理有关的全部。您希望尽可能最后获得资源，尽可能快地使用并尽快释放。using 语句通过确保`Dispose()`即使有异常也会进行调用来帮助做到这一点。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-19T17:48:51.180

> 简而言之，如果我错过了一次使用，这不是世界末日。我只是希望某些东西至少会产生一个警告。

这里的问题是您不能总是通过将 IDisposable 包装在一个`using`块中来处理它。有时你需要让物体停留更长时间。在这种情况下，您必须`Dispose`自己显式调用它的方法。

一个很好的例子是一个[类使用私有 EventWaitHandle（或 AutoResetEvent）](https://stackoverflow.com/questions/659840/do-i-need-to-dispose-or-close-an-eventwaithandle)在两个线程之间进行通信，并且您希望在线程完成后处理 WaitHandle。

因此，它不像某些工具那样简单，只是检查您是否只在`using`块内创建 IDisposable 对象。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-02T17:04:23.010

这就是为什么（恕我直言）C++ 的 RAII 优于 .NET 的`using`声明。

很多人说这`IDisposable`仅适用于非托管资源，这仅取决于您如何定义“资源”。您可以实现读/写锁`IDisposable`，然后“资源”是对代码块的概念访问。您可以在构造函数中将光标更改为沙漏并返回到先前保存的值的对象`IDispose`，然后“资源”是更改后的光标。我会说，当您希望在离开范围时发生确定性操作时，无论范围如何离开，您都可以使用 IDisposable，但我不得不承认，它远不如说“它用于管理非托管资源管理”那么吸引人。

另请参阅有关[为什么 .NET 中没有 RAII](https://stackoverflow.com/questions/173670/why-is-there-no-raii-in-net)的问题。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-02T15:49:30.277

@Atario，不仅接受的答案是错误的，您自己的编辑也是如此。想象一下以下情况（*实际发生*在 Visual Studio 2005 的一个 CTP 中）：

对于绘制图形，您无需处理它们即可创建笔。笔不需要大量内存，但它们在内部使用 GDI+ 句柄。如果不丢弃笔，GDI+ 手柄将不会释放。如果您的应用程序不是内存密集型应用程序，则可以在不调用 GC 的情况下经过相当长的一段时间。但是，可用 GDI+ 句柄的数量受到限制，并且很快，当您尝试创建新笔时，操作将失败。

事实上，在 Visual Studio 2005 CTP 中，如果您使用该应用程序的时间足够长，所有字体都会突然切换到“系统”。

这就是为什么仅仅依靠 GC 来处理是**不够的。**内存使用不一定与您获取（并且不释放）的非托管资源的数量相关。因此，这些资源可能在调用 GC 之前很久就耗尽了。

此外，当然还有这些资源可能具有的副作用的所有方面（例如访问锁），这些副作用会阻止其他应用程序正常工作。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-05T09:10:32.467

我真的没有什么可以添加到 Using 块的一般用途中，只是想为规则添加一个例外：

任何实现 IDisposable 的对象显然都不应该在其 Dispose() 方法期间抛出异常。这在 WCF（可能还有其他）之前工作得很好，现在 WCF 通道可能会在 Dispose() 期间引发异常。如果在 Using 块中使用它时发生这种情况，则会导致问题，并且需要实现异常处理。这显然需要更多了解内部工作原理，这就是为什么微软现在建议不要在 Using blocks 中使用 WCF 通道（抱歉找不到链接，但在 Google 中有很多其他结果），即使它实现了 IDisposable.. 只是为了让事情更多复杂！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-02T18:15:22.230

不幸的是，FxCop 或 StyleCop 似乎都没有对此发出警告。正如其他评论者所提到的，确保调用 dispose 通常非常重要。如果我不确定，我总是检查对象浏览器 (Ctrl+Alt+J) 来查看继承树。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-02T19:34:18.030

我主要在这种情况下使用 using 块：

我正在使用一些外部对象（在我的情况下通常是 IDisposable 包装的 COM 对象）。对象本身的状态可能会导致它抛出异常，或者它如何影响我的代码可能会导致我抛出异常，并且可能在许多不同的地方。一般来说，我不相信我当前方法之外的任何代码都可以自行运行。

为了争论，假设我的方法有 11 个退出点，其中 10 个在这个 using 块内，1 个在它之后（这在我编写的一些库代码中很典型）。

由于在退出 using 块时对象会自动释放，因此我不需要 10 次不同的 .Dispose() 调用——它只是发生了。这导致代码更简洁，因为它现在不再被 dispose 调用混乱（在这种情况下，代码行数减少了约 10 行）。

如果有人在我之后更改代码，如果他们忘记调用 dispose，引入 IDisposable 泄漏错误（这可能会很耗时）的风险也较小，因为使用块没有必要。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-01T03:13:26.183

始终尝试使用“使用”块。对于大多数对象，它并没有太大的区别，但是我遇到了一个最近的问题，我在一个类中实现了一个 ActiveX 控件，并且除非正确调用了 Dispose，否则没有优雅地清理。最重要的是，即使它似乎没有太大的不同，也要尝试正确地去做，因为有时它会有所作为。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-02-10T05:39:17.967

根据[此链接](https://stackoverflow.com/questions/24216/resharper-vs-coderush/1930393#1930393)，[CodeRush 加载项](http://www.devexpress.com/Products/Visual_Studio_Add-in/Coding_Assistance/)将在您键入时实时检测并标记本地 IDisposable 变量未清理的时间。

可以在你的任务中遇到你。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-31T21:16:38.387

与 Fxcop（与之相关）一样，VS 中的代码分析工具（如果您有更高版本之一）也会发现这些情况。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2011-01-19T15:39:58.633

我不明白你的问题的重点。多亏了垃圾收集器，内存泄漏几乎不可能发生。但是，您需要一些健壮的逻辑。

我用来创建这样的`IDisposable`类：

```
public MyClass: IDisposable
{

    private bool _disposed = false;

    //Destructor
    ~MyClass()
    { Dispose(false); }

    public void Dispose()
    { Dispose(true); }

    private void Dispose(bool disposing)
    {
        if (_disposed) return;
        GC.SuppressFinalize(this);

        /* actions to always perform */

        if (disposing) { /* actions to be performed when Dispose() is called */ }

        _disposed=true;
} 
```

现在，即使您错过了使用`using`语句，该对象最终也会被垃圾收集并执行适当的销毁逻辑。您可以停止线程、结束连接、保存数据，无论您需要什么（在[此示例](http://logbus-ng.svn.sourceforge.net/viewvc/logbus-ng/trunk/logbus-core/It.Unina.Dis.Logbus/Clients/ClientBase.cs?revision=849&view=markup)中，我取消订阅远程服务并在需要时执行远程删除调用）

[编辑] 显然，尽快调用 Dispose 有助于提高应用程序性能，并且**是**一种很好的做法。但是，感谢我的示例，如果您忘记调用 Dispose，最终将调用它并清理对象。

# mysql - 为什么没有更多的 .NET 应用程序使用 MySQL 或允许使用 MySQL 的 DAO？

> ID：254970
> 
> 赞同：3
> 
> 时间：2008-10-31T21:09:48.900
> 
> 标签：mysql, sql-server, database

我想这个问题可以很容易地应用于关于 MSSQL 的 PHP。然而，由于某些版本的 MSSQL 如此昂贵，我一直想知道，在 .NET 开发中选择它而不是 MySQL 的真正优势是什么？.NET 工具与 MySQL 数据库结合使用真的很难吗？为什么不创建某种 DAO 来抽象出两者之间的差异，以便您可以同时使用两者？当我考虑构建 .NET 应用程序时，我总是想知道，我应该只使用 MSSQL，甚至不考虑 MySQL 作为一个选项吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-31T21:18:19.177

通常，MySQL 在存储过程方面来得太晚的事实使许多人远离数据库。但是，我确实喜欢该数据库，并且在我的“办公室外”时间经常使用它。您知道 BO 将 Crystal 与 MySQL 作为其选择数据源吗？

至于.NET又该怎么办？如果您不需要高级功能，那么我会推荐 SQL Express Edition。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-01T04:24:29.677

自 MySQL v4.1 以来，我们一直在为我们的 .Net 项目使用 MySQL。我们现在使用的是 v5.1，但我们仍然没有使用存储过程或触发器，因为我们真的不需要它，而且我们更愿意向后兼容 v4.1，以防我们的客户仍然坚持使用 v4.1。

MySQL 提供的 .Net/Connector 非常适合这项工作。

我想补充一些关于 websch01ar 提到的 SQL Express Edition 的事实，它有 2GB/4GB（取决于版本）数据库文件大小限制。似乎您永远不需要所有空间，但如果您像我们一样，将图片存储为 blob，或存储采集数据（科学仪器），它会比您想象的更快被填满。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-06T08:13:44.577

我一直在使用[NHibernate](http://www.nhibernate.org/) ORM 作为抽象 MySQL、MSSQL 等的一种方式。也许它对你有用。

# c# - 帮助使用 ConfigurationSection 从配置文件中正确读取

> ID：254976
> 
> 赞同：4
> 
> 时间：2008-10-31T21:11:30.893
> 
> 标签：c#, xml, web-config, configurationsection

我正在尝试创建类以使用 ConfigurationSection 和 ConfigurationElementCollection 从我的配置文件中读取，但我遇到了困难。

作为配置示例：

```
 <PaymentMethodSettings>
  <PaymentMethods>
    <PaymentMethod name="blah blah" code="1"/>
    <PaymentMethod name="blah blah" code="42"/>
    <PaymentMethod name="blah blah" code="43"/>
    <Paymentmethod name="Base blah">
      <SubPaymentMethod name="blah blah" code="18"/>
      <SubPaymentMethod name="blah blah" code="28"/>
      <SubPaymentMethod name="blah blah" code="38"/>
    </Paymentmethod>
  </PaymentMethods>
</PaymentMethodSettings> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-31T21:36:11.777

这里的神奇之处在于使用 ConfigurationSection 类。

这些类只需要包含与您的配置模式 1:1 匹配的属性。您使用属性让 .NET 知道哪些属性与哪些元素匹配。

因此，您可以创建 PaymentMethod 并让它从 ConfigurationSection 继承

您将创建 SubPaymentMethod 并让它从 ConfigurationElement 继承。

PaymentMethod 将在其中包含 SubPaymentMethods 的 ConfigurationElementCollection 作为属性，这就是您将复杂类型连接在一起的方式。

您不需要编写自己的 XML 解析代码。

```
public class PaymentSection : ConfigurationSection
{
   // Simple One
   [ConfigurationProperty("name")]]
   public String name
   {
      get { return this["name"]; }
      set { this["name"] = value; }
   }

} 
```

ETC...

请参阅此处了解如何创建 ConfigurationElementCollections 以便您可以拥有嵌套类型：

[http://blogs.neudesic.com/blogs/jason_jung/archive/2006/08/08/208.aspx](http://blogs.neudesic.com/blogs/jason_jung/archive/2006/08/08/208.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-31T21:27:58.143

[这](http://msdn.microsoft.com/en-us/library/2tw134k3.aspx)应该可以帮助您弄清楚如何正确创建配置部分，然后从中读取。

# algorithm - 快速几何邻近谓词

> ID：254979
> 
> 赞同：5
> 
> 时间：2008-10-31T21:12:15.993
> 
> 标签：algorithm, language-agnostic, optimization, geometry, performance

我有 3 个点（A、B 和 X）和一个距离（d）。我需要创建一个函数来测试点 X 到线段 AB 上的任何点是否比距离 d 更近。

问题首先是，我的解决方案是否正确，然后提出更好（更快）的解决方案。

我的第一关如下

```
AX = X-A
BX = X-B
AB = A-B

    // closer than d to A (done squared to avoid needing to compute the sqrt in mag)
If d^2 > AX.mag^2  return true

    // closer than d to B
If d^2 > BX.mag^2 return true

    // "beyond"  B
If (dot(BX,AB) < 0) return false

    // "beyond"  A
If (dot(AX,AB) > 0) return false

    // find component of BX perpendicular to AB
Return (BX.mag)^2 - (dot(AB,BX)/AB.mag)^2 < d^2 
```

这段代码最终将针对大量 P 和大量 A/B/d 三元组运行，目的是找到所有通过至少一个 A/B/d 的 P，所以我怀疑有一种方法在此基础上降低总体成本，但我还没有研究过。

（顺便说一句：我知道一些重新排序、一些临时值和一些代数恒等式可能会降低上述成本。为了清楚起见，我只是省略了它们。）

* * *

*编辑：这是一个 2D 问题（但推广到 3D 的解决方案会很酷*

编辑：进一步思考，我预计命中率在 50% 左右。X 点可以在嵌套层次结构中形成，因此我希望能够将大型子树修剪为全通过和全失败。限制三连音的 A/B/d 将更像是一个技巧。

编辑：d 与 AB 的数量级相同。

* * *

编辑：Artelius 发布了一个不错的解决方案。我不确定我是否完全理解他的意思，因为我在完全理解之前就走上了正轨。无论如何，结果想到了另一个想法：

*   首先 Artelius 的位，预先计算一个矩阵，该矩阵将 AB 居中并与 X 轴对齐。（2 次添加、4 毫升和 2 次添加）
*   将其全部折叠到第一象限（2个腹肌）
*   在 X&Y 中缩放以使区域的中心部分成为一个单位正方形 (2 mul)
*   test if the point is in that square (2 test) is so quit
*   test the end cap (go back to the unscaled values
    *   translate in x to place the end at the origin (1 add)
    *   square and add (2 mul, 1 add)
    *   compare to d^2 (1 cmp)

I'm fairly sure this beats my solution.

(if nothing better comes along sone Artelius gets the "prize" :)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T21:33:38.617

Hmmmmmmm.... What's the hit-rate? How often does point "X" meet the proximity requirements?

I think your existing algorithm is good, and any additional optimizations will come from tuning to the real data. For example, if the "X" point meets the proximity test 99% of the time, then I think your optimization strategy should be considerably different than if it only passes the test 1% of the time.

* * *

Incidentally, when you get to the point where you're running this algorithm with thousands of points, you should organize all the points into a K-Dimensional Tree (or [KDTree](http://en.wikipedia.org/wiki/Kdtree)). It makes the calculation of "nearest-neighbor" much simpler.

Your problem is a little more complex than a basic nearest-neighbor (because you're checking proximity-to-a-line-segment rather than just proximity-to-a-point) but I still think the KDTree will be handy.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T23:05:04.877

If I read this correctly, then this is almost the same as the classic ray/sphere intersection test as used in 3D ray-tracing.

In this case you have a sphere at location X of radius d, and you're trying to find out whether the line AB intersects the sphere. The one difference with ray-tracing is that in this case you've got a specific line AB, whereas in ray-tracing the ray is normally generalised as as `origin + distance * direction`, and you don't care how far along the infinite line `AB+` it is.

In pseudo-code from my own ray-tracer (based on the algorithm given in "An Introduction to Ray-tracing" (ed. Glassner):

```
Vector v = X - A
Vector d = normalise(B - A)  // unit direction vector of AB
double b = dot(v, B - A)
double discrim = b^2 - dot(v, v) + d^2
if (discrim < 0)
     return false            // definitely no intersection 
```

If you've got this far, then there's *some* chance that your condition is met. You just have to figure out whether the intersection(s) is on the line AB:

```
discrim = sqrt(discrim)
double t2 = b + discrim
if (t2 <= 0)
    return false             // intersection is before A

double t1 = b  - discrim

result = (t1 < length(AB) || (t2 < length(AB)) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-31T23:17:23.370

If your set of (A,B,d) in fixed, you can calculate a pair of matrices for each to translate the co-ordinate system, so that the line AB becomes the X axis, and the midpoint of AB is the origin.

I *think* this is a simple way to construct the matrices:

```
trans = - ((A + B) / 2)        // translate midpoint of AB to origin

rot.col1 = AB / AB.mag         // unit vector in AB direction

                        0 -1    
rot.col2 = rot.col1 * (      ) // unit vector perp to AB
                        1  0 

rot = rot.inverse()            // but it needs to be done in reverse 
```

Then you just take each X and do `rot * (X + trans)`.

The region in question is actually symmetric in both the x and y axes now, so you can take the absolute value of the x co-ordinate, and of the y co-ordinate.

Then you just need to check:

```
y < d && x < AB.mag/2            //"along" the line segment
|| (x - AB.mag/2)^2 + y^2 < d^2  // the "end cap". 
```

You can do another trick; the matrix can scale down by a factor of `AB.mag/2` (remember the matrices are only calculated once per (A,B) meaning that it's better that finding them is slower, than the actual check itself). This means your check becomes:

```
y < 2*d/AB.mag && x < 1
|| (x - 1)^2 + y^2 < (2*d/AB.mag)^2 
```

Having replaced two instances of AB.mag/2 with the constant 1, it might be a touch faster. And of course you can precalculate `2*d/AB.mag` and `(2*d/AB.mag)^2` as well.

Whether this will work out faster than other methods depends on the inputs you give it. But if the length of AB is long compared to d, I think it will turn out considerably faster than the method you posted.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T22:18:54.063

> This code will end up being run for a large set of P's and a large set of A/B/d triplets with the intent of finding all P's that pass for at least one A/B/d so I suspect that there is a way to reduce overall the cost based on that but I haven't looked into that yet.

In the case when d ~ AB, for a given point X, you can first test whether X belongs to one of the many spheres of radius d and center Ai or Bi. Look at the picture:

```
 ......        .....
  ...........   ...........
 ...........................
.......A-------------B.......
 ...........................
  ...........   ...........
     .....         ..... 
```

The first two tests

```
If d^2 > AX.mag^2 return true
If d^2 > BX.mag^2 return true 
```

are the fastest ones, and if d ~ AB they are also the ones with highest probability to succeed (given that the test succeeds at all). Given X, you can do all the "sphere tests" first, and then all the final ones:

```
Return (BX.mag)^2 - (dot(AB,BX)/AB.mag)^2 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T15:14:39.793

If the # of sets of A/B/d are large, and you're definitely in 2D, consider using [R-trees](http://en.wikipedia.org/wiki/R-tree) (or their octagonal equivalents) where each entry in the R-tree is the minimum bounding box of the A/B/d triple. This would let you eliminate having to test a lot of the A/B/d triples & focus your CPU power only on the few ones where each point X is within the bounding boxes of the A/B/d triple. Then do a more detailed test like the one you mention.

# c# - 帮助 CredEnumerate

> ID：254980
> 
> 赞同：3
> 
> 时间：2008-10-31T21:12:34.197
> 
> 标签：c#, windows, security, winapi

[作为这个](https://stackoverflow.com/questions/199518/how-to-programatically-add-mapped-network-passwords-winxp)问题的后续行动，我希望有人可以帮助使用[CredEnumerate](http://msdn.microsoft.com/en-us/library/aa374794(VS.85).aspx) API。

正如我从文档中了解到的那样，PCREDENTIALS out 参数是“指向凭据指针数组的指针”。我能够使用 C# 成功调用 CredEnumerate API，但我不确定如何将 PCREDENTIALS 转换为有用的东西（如凭据列表）。

编辑：这是我正在使用的代码：

```
 int count = 0;
        IntPtr pCredentials = IntPtr.Zero;
        bool ret = false;
        ret = CredEnumerate(null, 0, out count, out pCredentials);
        if (ret != false)
        {
            IntPtr[] credentials = new IntPtr[count];
            IntPtr p = pCredentials;
            for (int i = 0; i < count; i++)
            {
                p = new IntPtr(p.ToInt32() + i);
                credentials[i] = Marshal.ReadIntPtr(p);
            }
            List<Credential> creds = new List<Credential>(credentials.Length);
            foreach (IntPtr ptr in credentials)
            {
                creds.Add((Credential)Marshal.PtrToStructure(ptr, typeof(Credential)));
            }
        } 
```

不幸的是，虽然这适用于数组中的第一个凭证——它被正确地生成并添加到列表中——但随后的数组项在 Marshal.PtrToStructure 处爆炸，并出现以下错误：

*尝试读取或写入受保护的内存。这通常表明其他内存已损坏。*

有任何想法吗？任何人？布勒？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-31T21:55:43.470

您需要取消引用指向数组的指针以获取数组，然后对于数组中的每个项目，您将需要取消引用该项目以获取`PCREDENTIALS`实例。

我发现[这篇文章带有一些示例代码](http://www.msnewsgroups.net/group/microsoft.public.dotnet.languages.csharp/topic33651.aspx)，用于执行您想要执行的操作：

```
[DllImport("advapi32", SetLastError = true, CharSet=CharSet.Unicode)]
static extern bool CredEnumerate(string filter, int flag, out int count, out IntPtr
pCredentials); 
```

...

```
int count = 0;
IntPtr pCredentials = IntPtr.Zero;
IntPtr[] credentials = null;
bool ret = CredEnumerate(null, 0, out count, out pCredentials);
if (ret != false)
{
    credentials = new IntPtr[count];
    IntPtr p = pCredentials;
    for (int n = 0; n < count; n++)
    {
        credentials[n] = Marshal.ReadIntPtr(pCredentials,
           n * Marshal.SizeOf(typeof(IntPtr)));
    }
} 
else
// failed.... 
```

然后对于每个指针，您需要使用`Marshal.PtrToStructure`将指针取消引用到`PCREDENTIALS`结构实例中（对不起，我无法在`PCREDENTIALS`任何地方找到 typedef，我假设您拥有它 - 如果您确实没有忘记正确的 MarshalAs 属性和 StructLayout定义它时的属性）：

```
// assuming you have declared struct PCREDENTIALS
var creds = new List<PCREDENTIALS>(credentials.Length);
foreach (var ptr in credentials)
{
    creds.Add((PCREDENTIALS)Marshal.PtrToStructure(ptr, typeof(PCREDENTIALS)));
} 
```

您显然希望将示例和`PtrToStructure`代码结合起来以获得最佳结果，但我想保持示例的完整性不变。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-01-27T10:27:22.210

您还需要正确计算“IntPtr p”，上面的代码缺少它，它只会获取第一个结构。

以下代码将获取“IntPtr pCredentials”中的所有结构

```
int count;
IntPtr pCredentials;

if (CredEnumerate(filter, 0, out count, out pCredentials) != 0)
{
    m_list = new List<PCREDENTIALS >(count);
    int sz = Marshal.SizeOf(pCredentials);

    for (int index = 0; index < count; index++)
    {
        IntPtr p = new IntPtr((sz == 4 ? pCredentials.ToInt32() : pCredentials.ToInt64()) + index * sz);
        m_list.Add((PCREDENTIALS)Marshal.PtrToStructure(p, typeof(PCREDENTIALS)));
    }
} 
```

# c++ - 选择一个 SOAP 库来与 ISAPI webapp 集成

> ID：254985
> 
> 赞同：0
> 
> 时间：2008-10-31T21:14:37.047
> 
> 标签：c++, soap, isapi-extension

我工作的公司有一个用 C++ 编写的大型 web 应用程序作为 ISAPI 扩展（不是过滤器）。我们目前正在增强我们的系统，以便与几个具有 SOAP 接口的第三方工具集成。与其自己动手，我认为最好使用一些 SOAP 库。理想情况下，它将是免费和开源的，但具有与闭源商业软件兼容的许可证。我们还需要为传入和传出的 SOAP 消息支持 SSL。

我最担心的一个问题是，我看过的每个 SOAP 库似乎都有两种操作模式：独立服务器和服务器模块（Apache 模块或 ISAPI 过滤器）。显然，我们不能使用独立服务器。在我看来，如果它作为一个模块运行，它就不会成为我应用程序的一部分——它无法访问我的其余代码，因此它无法共享数据结构等. 这是一个正确的假设吗？我们的应用程序处理的每个 HTTP 请求都由一个单独的线程处理（我们管理自己的线程池），但我们有许多在这些线程之间共享的持久数据。我认为我正在寻找的集成类型是将一些代码添加到我的应用程序中，该代码查看请求 URL，发现它正在尝试访问 SOAP 服务，并调用诸如soapService 之类的函数。处理请求（）。我不知道有什么东西可以提供这种集成。我们必须能够在 SOAP 处理函数中使用来自主应用程序的数据结构。

除了处理传入的 SOAP 请求，我们还将生成它们（与第 3 方的双向通信）。我认为几乎任何 SOAP 库都可以实现这个目的，对吧？

任何人都可以建议一个能够做到这一点的 SOAP 库，或者就如何使用不同的范例提供建议吗？我已经研究过 Apache Axis2、gSOAP 和 AlchemySOAP，但也许其中有一些我忽略了的特性。谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-02T01:02:29.147

看看[ATL Server](http://www.codeplex.com/AtlServer)这个库曾经是 Visual C++ 自带的，但现在是一个单独的开源项目

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T01:02:13.967

GSoap 是一个很棒的开源跨平台皂栈。

# 它很快。

# 伟大的互操作。

许多开源soap 库与java/c#/python/whatever 没有很好的互操作性。

它在使用非常少的内存时解析巨大的有效负载。

它是开源的！

由于您使用的是 IIS 扩展，因此您需要将 gsoap 添加到您的应用程序中，使用以下命令重新编译您的扩展 dll：[http](http://aberger.at/SOAP/iis_index.html) ://aberger.at/SOAP/iis_index.html， 您应该可以开始使用了。

gSoap [http://www.cs.fsu.edu/~engelen/soap.html](http://www.cs.fsu.edu/~engelen/soap.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T21:48:47.163

GSOAP 适用于 c++ 代码

# .net - 如何最好地处理 WPF 单选按钮？

> ID：254992
> 
> 赞同：11
> 
> 时间：2008-10-31T21:18:50.860
> 
> 标签：.net, wpf, vb.net, xaml

我的 XAML 中有一些 RadioButtons ......

```
<StackPanel>
    <RadioButton Name="RadioButton1" GroupName="Buttons" Click="ButtonsChecked" IsChecked="True">One</RadioButton>
    <RadioButton Name="RadioButton2" GroupName="Buttons" Click="ButtonsChecked">Two</RadioButton>
    <RadioButton Name="RadioButton3" GroupName="Buttons" Click="ButtonsChecked">Three</RadioButton>
</StackPanel> 
```

我可以在 Visual Basic 代码中处理他们的点击事件。这有效...

```
    Private Sub ButtonsChecked(ByVal sender As System.Object, _
                               ByVal e As System.Windows.RoutedEventArgs)
        选择案例 CType(sender, RadioButton).Name
            案例“RadioButton1”
                '做某事
                退出选择
            案例“RadioButton2”
                '做两件事
                退出选择
            案例“RadioButton3”
                '做三件事
                退出选择
        结束选择
    结束子

```

但是，我想改进它。此代码失败...

```
<StackPanel>
    <RadioButton Name="RadioButton1" GroupName="Buttons" Click="ButtonsChecked" Command="one" IsChecked="True">One</RadioButton>
    <RadioButton Name="RadioButton2" GroupName="Buttons" Click="ButtonsChecked" Command="two">Two</RadioButton>
    <RadioButton Name="RadioButton3" GroupName="Buttons" Click="ButtonsChecked" Command="three">Three</RadioButton>
</StackPanel> 
```

```
    Private Sub ButtonsChecked(ByVal sender As System.Object, _
                               ByVal e As System.Windows.RoutedEventArgs)
        选择案例 CType(sender, RadioButton).Command
            案例“一”
                '做某事
                退出选择
            案例“二”
                '做两件事
                退出选择
            案例“三”
                '做三件事
                退出选择
        结束选择
    结束子

```

在我的 XAML 中，我在**Command=**属性上得到一个蓝色波浪下划线，并且这个提示......

```
“CommandValueSerializer”ValueSerializer 无法从“System.String”转换。
```

在我的 VB 中，我在**Select Case**行上得到一个绿色波浪下划线，并且这个警告......

```
将“System.Windows.Input.ICommand”转换为“String”时可能会出现运行时错误。
```

更好的是使用带有完整 Intellisense 的 Enum 类型命令并编译错误而不是运行时错误，以防出现拼写错误。我该如何改进呢？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-31T23:09:42.417

为了使命令起作用，您需要在您的 xaml 或代码后面设置绑定。这些命令绑定必须引用先前已声明的公共静态字段。

然后在您的按钮命令属性中，您还需要引用这些相同的命令。

```
<Window 
    x:Class="RadioButtonCommandSample.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:RadioButtonCommandSample"
    Title="Window1" 
    Height="300" 
    Width="300"
    >
    <Window.CommandBindings>
        <CommandBinding Command="{x:Static local:Window1.CommandOne}" Executed="CommandBinding_Executed"/>
        <CommandBinding Command="{x:Static local:Window1.CommandTwo}" Executed="CommandBinding_Executed"/>
        <CommandBinding Command="{x:Static local:Window1.CommandThree}" Executed="CommandBinding_Executed"/>
    </Window.CommandBindings>
    <StackPanel>
        <RadioButton Name="RadioButton1" GroupName="Buttons" Command="{x:Static local:Window1.CommandOne}" IsChecked="True">One</RadioButton>
        <RadioButton Name="RadioButton2" GroupName="Buttons" Command="{x:Static local:Window1.CommandTwo}">Two</RadioButton>
        <RadioButton Name="RadioButton3" GroupName="Buttons" Command="{x:Static local:Window1.CommandThree}">Three</RadioButton>
    </StackPanel>
</Window>

public partial class Window1 : Window
{
    public static readonly RoutedCommand CommandOne = new RoutedCommand();
    public static readonly RoutedCommand CommandTwo = new RoutedCommand();
    public static readonly RoutedCommand CommandThree = new RoutedCommand();

    public Window1()
    {
        InitializeComponent();
    }

    private void CommandBinding_Executed(object sender, ExecutedRoutedEventArgs e)
    {
        if (e.Command == CommandOne)
        {
            MessageBox.Show("CommandOne");
        }
        else if (e.Command == CommandTwo)
        {
            MessageBox.Show("CommandTwo");
        }
        else if (e.Command == CommandThree)
        {
            MessageBox.Show("CommandThree");
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-10-06T17:40:21.523

**使用 WPF MVVM 设计模式的更好解决方案：**

单选按钮控件 XAML 到 Modelview.vb/ModelView.cs ：

```
XAML Code:
<RadioButton Content="On" IsEnabled="True" IsChecked="{Binding OnJob}"/>
<RadioButton Content="Off" IsEnabled="True" IsChecked="{Binding OffJob}"/> 
```

视图模型.vb：

```
Private _OffJob As Boolean = False
Private _OnJob As Boolean = False

Public Property OnJob As Boolean
    Get
        Return _OnJob
    End Get
    Set(value As Boolean)
        Me._OnJob = value
    End Set
End Property

Public Property OffJob As Boolean
    Get
        Return _OffJob
    End Get
    Set(value As Boolean)
        Me._OffJob = value
    End Set
End Property

Private Sub FindCheckedItem()
  If(Me.OnJob = True)
    MessageBox.show("You have checked On")
 End If
If(Me.OffJob = False)
 MessageBox.Show("You have checked Off")
End sub 
```

可以使用上面相同的逻辑来查看您是否选中了三个单选按钮中的任何一个，即。选项一，选项二，选项三。但是检查布尔集 id 是 true 还是 false，您可以确定单选按钮是否被选中。

# c# - 如何使用 EventHandlers 向 ASP.NET 页面动态创建/删除控件？

> ID：254993
> 
> 赞同：3
> 
> 时间：2008-10-31T21:19:55.040
> 
> 标签：c#, asp.net

在我的一个项目中，我需要构建一个 ASP.NET 页面，并且需要动态创建一些控件。这些控件由代码隐藏类添加到页面中，并且添加了一些事件处理程序。在 PostBacks 上，这些事件处理程序与页面上显示的控件有很大关系。简而言之，这对我不起作用，我似乎无法弄清楚这一点。

因此，由于我的项目涉及很多，我决定创建一个也不起作用的简短示例，但是如果您可以对其进行调整以使其起作用，那就太好了，然后我就可以将您的解决方案应用于我的原始解决方案问题。

以下示例应在面板上动态创建三个按钮。当按下其中一个按钮时，应动态重新创建所有按钮，但按下的按钮除外。换句话说，只需隐藏用户按下的按钮并显示其他两个按钮。

为了使您的解决方案有用，您不能静态创建按钮然后使用 Visible 属性（或以其他方式彻底更改示例） - 您必须在每个 PostBack 上动态重新创建所有按钮控件（不一定在事件处理程序）。这不是一个技巧问题——我真的不知道该怎么做。非常感谢您的努力。这是我的简短示例：

## 从 Default.aspx 文件：

```
<body>
    <form id="form1" runat="server">
    <div>
        <asp:Panel ID="ButtonsPanel" runat="server"></asp:Panel>
    </div>
    </form>
</body> 
```

## 从 Default.aspx.cs 代码隐藏文件：

```
using System;
using System.Web.UI;
using System.Web.UI.WebControls;

namespace DynamicControls
{
    public partial class _Default : Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {
            AddButtons();
        }

        protected void AddButtons()
        {
            var lastClick = (string) Session["ClickedButton"] ?? "";

            ButtonsPanel.Controls.Clear();
            if (!lastClick.Equals("1")) AddButtonControl("1");
            if (!lastClick.Equals("2")) AddButtonControl("2");
            if (!lastClick.Equals("3")) AddButtonControl("3");
        }

        protected void AddButtonControl(String id)
        {
            var button = new Button {Text = id};
            button.Click += button_Click;
            ButtonsPanel.Controls.Add(button);
        }

        private void button_Click(object sender, EventArgs e)
        {
            Session["ClickedButton"] = ((Button) sender).Text;
            AddButtons();
        }
    }
} 
```

我的示例显示了三个按钮，当我单击其中一个按钮时，按下的按钮被隐藏。似乎工作; 但是在第一次点击之后，我必须点击每个按钮**两次**才能隐藏它。！？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-31T21:38:26.033

我认为每次添加按钮时都必须为按钮提供相同的 ID，例如（在`AddButtonControl`方法的第一行）：

```
var button = new Button { Text = id , ID = id }; 
```

* * *

**编辑**- 我的解决方案不使用会话：

```
public partial class _Default : Page
{
    protected override void OnPreInit(EventArgs e)
    {
        base.OnPreInit(e);
        AddButtons();
    }

    protected void AddButtons()
    {
        AddButtonControl("btn1", "1");
        AddButtonControl("btn2", "2");
        AddButtonControl("btn3", "3");
    }

    protected void AddButtonControl(string id, string text)
    {
        var button = new Button { Text = text, ID = id };
        button.Click += button_Click;
        ButtonsPanel.Controls.Add(button);
    }

    private void button_Click(object sender, EventArgs e)
    {
        foreach (Control control in ButtonsPanel.Controls)
            control.Visible = !control.Equals(sender);
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-31T21:45:37.220

您需要确保在`Pre_Init`活动期间添加动态控件。

有关 ASP.NET 页面生命周期的信息，请参见此处：http: [//msdn.microsoft.com/en-us/library/ms178472.aspx](http://msdn.microsoft.com/en-us/library/ms178472.aspx)

添加事件时，您需要在`Page_Load`方法之前添加，并且*需要在每个请求中添加*它们，即您永远不应该将事件分配包装在`!IsPostBack`.

您还需要为单个请求创建动态控件。ViewState 不会代表您处理娱乐活动。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T21:29:46.033

我注意到的一件事是，当您单击一个按钮时，您将调用 AddButtons() 两次，一次在 the 中`Page_Load()`，一次在`button_Click()`方法中。您可能应该将其包装`Page_Load()`在一个`if (!IsPostBack)`块中。

```
if (!IsPostBack)
{
   AddButtons();
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T21:38:25.173

AFAIK，控件的创建不应放在 Page_Load 中，而应放在 Page_PreInit 中（ViewState 和 SessionState 在 Page_Load 之前但在 Page_PreInit 之后加载）。

对于您的问题，我建议调试 AddButtons 函数以找出 Session["ClickedButton"] 中存储的确切内容（以及何时）。然后，您应该能够找出问题所在。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-31T22:36:38.927

动态添加的控件没有缓存，所以这可能是您的问题之一**************