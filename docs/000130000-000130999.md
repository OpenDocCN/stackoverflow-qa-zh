# StackOverflow 问答 000130000-000130999

# ruby-on-rails - 除了 Rails 应用程序之外，还需要运行 TCP 服务器

> ID：130015
> 
> 赞同：1
> 
> 时间：2008-09-24T21:10:55.443
> 
> 标签：ruby-on-rails, windows, tcp

我有一个使用 postgresql 数据库运行的 Rails 2.0.2 应用程序。机器将在 TCP 端口上接收数据。我已经编写了一个工作 ruby​​ 多线程 tcp 服务器来接收请求，但我需要这个代码与我的 Rails 应用程序一起运行。

所以我想我需要知道如何在 Rails 中跨越一个新进程，或者如何创建一个工作线程来运行我的线程化 tcp 服务器循环。我的 ruby​​ tcp 服务器可以访问 ActiveRecord，但这不是必需的（我总是可以创建一个 http 请求，将接收到的数据发布到原始 Rails 服务器）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T00:24:18.707

为什么要把事情复杂化？只需并排运行应用程序——您的 TCP 服务器和 Rails 应用程序。

要么将模型层（和 ActiveRecord）拉入你的 TCP 服务器（svn::externals 或 Piston 可能会很好地工作）并让两个应用程序之间的通信通过数据库发生，或者让 Rails 应用程序成为“主”和按照您的建议通过 HTTP 与它通信。

要将 Ruby 应用程序转换为 Windows 服务，请参阅项目中`win32-service`提供的 gem `win32utils`： [http ://rubyforge.org/projects/win32utils/](http://rubyforge.org/projects/win32utils/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T01:38:42.540

我需要 tcp 服务器作为 Windows 2003 服务器上的服务运行。我使用 mongrel_service 将 Rails 作为服务加载，但我不知道对纯 ruby​​ 代码执行相同操作的方法。如果我可以在计算机启动时启动我的 tcp 服务器，我会研究你的解决方案（不过这看起来还不错）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T22:53:31.383

不要让您的 Rails 应用程序对 TCP 服务器应用程序的状态负责。这真的不太适合这样做——而且可能没有理由让它们彼此完全同步。使用 monit 或其他东西来监视两个服务器进程。

如果不了解更多应用程序架构，就不可能确定，但​​我建议使用 ActiveRecord 和数据库在服务器之间进行通信，而不是 HTTP。这样，即使您的 Rails 应用程序由于某种原因关闭，您的其他服务器仍然可以处理请求。它也可能会更活泼一些。

# asp.net - 下拉列表控件 s 用于 asp.net（网络表单）？

> ID：130020
> 
> 赞同：65
> 
> 时间：2008-09-24T21:12:08.420
> 
> 标签：asp.net, drop-down-menu, custom-server-controls, webforms

谁能推荐一个可以呈现选项组的asp.net（3.5）下拉列表控件？谢谢

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-09-24T21:19:06.173

我过去使用过标准控件，只是为它添加了一个简单的[ControlAdapter](http://msdn.microsoft.com/en-us/library/system.web.ui.adapters.controladapter.aspx)，它将覆盖默认行为，因此它可以在某些地方呈现 <optgroup>。即使您有不需要特殊行为的控件，这也很有效，因为附加功能不会妨碍您。

请注意，这是出于特定目的并用 .Net 2.0 编写的，因此它可能不适合您，但至少应该为您提供一个起点。此外，您必须在项目中使用 .browserfile 将其连接起来（请参阅文章末尾的示例）。

```
'This codes makes the dropdownlist control recognize items with "--"
'for the label or items with an OptionGroup attribute and render them
'as <optgroup> instead of <option>.
Public Class DropDownListAdapter
    Inherits System.Web.UI.WebControls.Adapters.WebControlAdapter

    Protected Overrides Sub RenderContents(ByVal writer As HtmlTextWriter)
        Dim list As DropDownList = Me.Control
        Dim currentOptionGroup As String
        Dim renderedOptionGroups As New Generic.List(Of String)

        For Each item As ListItem In list.Items
            Page.ClientScript.RegisterForEventValidation(list.UniqueID, item.Value)
            If item.Attributes("OptionGroup") IsNot Nothing Then
                'The item is part of an option group
                currentOptionGroup = item.Attributes("OptionGroup")
                If Not renderedOptionGroups.Contains(currentOptionGroup) Then
                    'the header was not written- do that first
                    'TODO: make this stack-based, so the same option group can be used more than once in longer select element (check the most-recent stack item instead of anything in the list)
                    If (renderedOptionGroups.Count > 0) Then
                        RenderOptionGroupEndTag(writer) 'need to close previous group
                    End If
                    RenderOptionGroupBeginTag(currentOptionGroup, writer)
                    renderedOptionGroups.Add(currentOptionGroup)
                End If
                RenderListItem(item, writer)
            ElseIf item.Text = "--" Then 'simple separator
                RenderOptionGroupBeginTag("--", writer)
                RenderOptionGroupEndTag(writer)
            Else
                'default behavior: render the list item as normal
                RenderListItem(item, writer)
            End If
        Next item

        If renderedOptionGroups.Count > 0 Then
            RenderOptionGroupEndTag(writer)
        End If
    End Sub

    Private Sub RenderOptionGroupBeginTag(ByVal name As String, ByVal writer As HtmlTextWriter)
        writer.WriteBeginTag("optgroup")
        writer.WriteAttribute("label", name)
        writer.Write(HtmlTextWriter.TagRightChar)
        writer.WriteLine()
    End Sub

    Private Sub RenderOptionGroupEndTag(ByVal writer As HtmlTextWriter)
        writer.WriteEndTag("optgroup")
        writer.WriteLine()
    End Sub

    Private Sub RenderListItem(ByVal item As ListItem, ByVal writer As HtmlTextWriter)
        writer.WriteBeginTag("option")
        writer.WriteAttribute("value", item.Value, True)
        If item.Selected Then
            writer.WriteAttribute("selected", "selected", False)
        End If

        For Each key As String In item.Attributes.Keys
            writer.WriteAttribute(key, item.Attributes(key))
        Next key

        writer.Write(HtmlTextWriter.TagRightChar)
        HttpUtility.HtmlEncode(item.Text, writer)
        writer.WriteEndTag("option")
        writer.WriteLine()
    End Sub
End Class 
```

这是同一类的 C# 实现：

```
/* This codes makes the dropdownlist control recognize items with "--"
 * for the label or items with an OptionGroup attribute and render them
 * as <optgroup> instead of <option>.
 */
public class DropDownListAdapter : WebControlAdapter
{
    protected override void RenderContents(HtmlTextWriter writer)
    {
        //System.Web.HttpContext.Current.Response.Write("here");
        var list = (DropDownList)this.Control;
        string currentOptionGroup;
        var renderedOptionGroups = new List<string>();

        foreach (ListItem item in list.Items)
        {
            Page.ClientScript.RegisterForEventValidation(list.UniqueID, item.Value);
            //Is the item part of an option group?
            if (item.Attributes["OptionGroup"] != null)
            {
                currentOptionGroup = item.Attributes["OptionGroup"];
                //Was the option header already written, then just render the list item
                if (renderedOptionGroups.Contains(currentOptionGroup))
                    RenderListItem(item, writer);
                //The header was not written,do that first
                else
                {
                    //Close previous group
                    if (renderedOptionGroups.Count > 0)
                        RenderOptionGroupEndTag(writer);

                    RenderOptionGroupBeginTag(currentOptionGroup, writer);
                    renderedOptionGroups.Add(currentOptionGroup);
                    RenderListItem(item, writer);
                }
            }
            //Simple separator
            else if (item.Text == "--")
            {
                RenderOptionGroupBeginTag("--", writer);
                RenderOptionGroupEndTag(writer);
            }
            //Default behavior, render the list item as normal
            else
                RenderListItem(item, writer);
        }

        if (renderedOptionGroups.Count > 0)
            RenderOptionGroupEndTag(writer);
    }

    private void RenderOptionGroupBeginTag(string name, HtmlTextWriter writer)
    {
        writer.WriteBeginTag("optgroup");
        writer.WriteAttribute("label", name);
        writer.Write(HtmlTextWriter.TagRightChar);
        writer.WriteLine();
    }
    private void RenderOptionGroupEndTag(HtmlTextWriter writer)
    {
        writer.WriteEndTag("optgroup");
        writer.WriteLine();
    }
    private void RenderListItem(ListItem item, HtmlTextWriter writer)
    {
        writer.WriteBeginTag("option");
        writer.WriteAttribute("value", item.Value, true);
        if (item.Selected)
            writer.WriteAttribute("selected", "selected", false);

        foreach (string key in item.Attributes.Keys)
            writer.WriteAttribute(key, item.Attributes[key]);

        writer.Write(HtmlTextWriter.TagRightChar);
        HttpUtility.HtmlEncode(item.Text, writer);
        writer.WriteEndTag("option");
        writer.WriteLine();
    }
} 
```

我的浏览器文件名为“App_Browsers\BrowserFile.browser”，如下所示：

```
<!--
    You can find existing browser definitions at
    <windir>\Microsoft.NET\Framework\<ver>\CONFIG\Browsers
-->
<browsers>
   <browser refID="Default">
      <controlAdapters>
        <adapter controlType="System.Web.UI.WebControls.DropDownList" 
               adapterType="DropDownListAdapter" />
      </controlAdapters>
   </browser>
</browsers> 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-12-21T20:20:08.253

我已经使用 JQuery 来完成这项任务。我首先从后端为每个添加了一个新属性`ListItem`，然后在 JQuery`wrapAll()`方法中使用该属性来创建组......

**C＃：**

```
foreach (ListItem item in ((DropDownList)sender).Items)
{
    if (System.Int32.Parse(item.Value) < 5)
        item.Attributes.Add("classification", "LessThanFive");
    else
        item.Attributes.Add("classification", "GreaterThanFive");
} 
```

**查询：**

```
$(document).ready(function() {
    //Create groups for dropdown list
    $("select.listsmall option[@classification='LessThanFive']")
        .wrapAll("&lt;optgroup label='Less than five'&gt;");
    $("select.listsmall option[@classification='GreaterThanFive']")
        .wrapAll("&lt;optgroup label='Greater than five'&gt;"); 
}); 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-06-29T03:18:45.550

谢谢乔尔！大家……如果你想要的话，这里是 C# 版本：

```
 using System;
using System.Web.UI.WebControls.Adapters;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Collections.Generic;
using System.Web;

//This codes makes the dropdownlist control recognize items with "--"'
//for the label or items with an OptionGroup attribute and render them'
//as  instead of .'
public class DropDownListAdapter : WebControlAdapter
{

    protected override void RenderContents(HtmlTextWriter writer)
    {
        DropDownList list = Control as DropDownList;
        string currentOptionGroup;
        List renderedOptionGroups = new List();

        foreach(ListItem item in list.Items)
        {
            if (item.Attributes["OptionGroup"] != null)
            {
                //'The item is part of an option group'
                currentOptionGroup = item.Attributes["OptionGroup"];
                //'the option header was already written, just render the list item'
                if(renderedOptionGroups.Contains(currentOptionGroup))
                    RenderListItem(item, writer);
                else
                {
                    //the header was not written- do that first'
                    if (renderedOptionGroups.Count > 0)
                        RenderOptionGroupEndTag(writer); //'need to close previous group'
                    RenderOptionGroupBeginTag(currentOptionGroup, writer);
                    renderedOptionGroups.Add(currentOptionGroup);
                    RenderListItem(item, writer);
                }
            }
            else if (item.Text == "--") //simple separator
            {
                RenderOptionGroupBeginTag("--", writer);
                RenderOptionGroupEndTag(writer);
            }
            else
            {
                //default behavior: render the list item as normal'
                RenderListItem(item, writer);
            }
        }

        if(renderedOptionGroups.Count > 0)
            RenderOptionGroupEndTag(writer);
    }

    private void RenderOptionGroupBeginTag(string name, HtmlTextWriter writer)
    {
        writer.WriteBeginTag("optgroup");
        writer.WriteAttribute("label", name);
        writer.Write(HtmlTextWriter.TagRightChar);
        writer.WriteLine();
    }

    private void RenderOptionGroupEndTag(HtmlTextWriter writer)
    {
        writer.WriteEndTag("optgroup");
        writer.WriteLine();
    }

    private void RenderListItem(ListItem item, HtmlTextWriter writer)
    {
        writer.WriteBeginTag("option");
        writer.WriteAttribute("value", item.Value, true);
        if (item.Selected)
            writer.WriteAttribute("selected", "selected", false);

        foreach (string key in item.Attributes.Keys)
            writer.WriteAttribute(key, item.Attributes[key]);

        writer.Write(HtmlTextWriter.TagRightChar);
        HttpUtility.HtmlEncode(item.Text, writer);
        writer.WriteEndTag("option");
        writer.WriteLine();
    }

} 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2010-06-23T18:50:00.463

上面的代码在任何选项之前呈现 optgroup 的结束标记，因此除了标记不能正确表示分组之外，选项不会像它们应该的那样缩进。这是我对汤姆的代码稍作修改的版本：

```
 public class ExtendedDropDownList : System.Web.UI.WebControls.DropDownList
{
    public const string OptionGroupTag = "optgroup";
    private const string OptionTag = "option";
    protected override void RenderContents(System.Web.UI.HtmlTextWriter writer)
    {
        ListItemCollection items = this.Items;
        int count = items.Count;
        string tag;
        string optgroupLabel;
        if (count > 0)
        {
            bool flag = false;
            string prevOptGroup = null;
            for (int i = 0; i < count; i++)
            {
                tag = OptionTag;
                optgroupLabel = null;
                ListItem item = items[i];
                if (item.Enabled)
                {
                    if (item.Attributes != null && item.Attributes.Count > 0 && item.Attributes[OptionGroupTag] != null)
                    {
                        optgroupLabel = item.Attributes[OptionGroupTag];

                        if (prevOptGroup != optgroupLabel)
                        {
                            if (prevOptGroup != null)
                            {
                                writer.WriteEndTag(OptionGroupTag);
                            }
                            writer.WriteBeginTag(OptionGroupTag);
                            if (!string.IsNullOrEmpty(optgroupLabel))
                            {
                                writer.WriteAttribute("label", optgroupLabel);
                            }
                            writer.Write('>');
                        }
                        item.Attributes.Remove(OptionGroupTag);
                        prevOptGroup = optgroupLabel;
                    }
                    else
                    {
                        if (prevOptGroup != null)
                        {
                            writer.WriteEndTag(OptionGroupTag);
                        }
                        prevOptGroup = null;
                    }

                    writer.WriteBeginTag(tag);
                    if (item.Selected)
                    {
                        if (flag)
                        {
                            this.VerifyMultiSelect();
                        }
                        flag = true;
                        writer.WriteAttribute("selected", "selected");
                    }
                    writer.WriteAttribute("value", item.Value, true);
                    if (item.Attributes != null && item.Attributes.Count > 0)
                    {
                        item.Attributes.Render(writer);
                    }
                    if (optgroupLabel != null)
                    {
                        item.Attributes.Add(OptionGroupTag, optgroupLabel);
                    }
                    if (this.Page != null)
                    {
                        this.Page.ClientScript.RegisterForEventValidation(this.UniqueID, item.Value);
                    }

                    writer.Write('>');
                    HttpUtility.HtmlEncode(item.Text, writer);
                    writer.WriteEndTag(tag);
                    writer.WriteLine();
                    if (i == count - 1)
                    {
                        if (prevOptGroup != null)
                        {
                            writer.WriteEndTag(OptionGroupTag);
                        }
                    }
                }
            }
        }
    }

    protected override object SaveViewState()
    {
        object[] state = new object[this.Items.Count + 1];
        object baseState = base.SaveViewState();
        state[0] = baseState;
        bool itemHasAttributes = false;

        for (int i = 0; i < this.Items.Count; i++)
        {
            if (this.Items[i].Attributes.Count > 0)
            {
                itemHasAttributes = true;
                object[] attributes = new object[this.Items[i].Attributes.Count * 2];
                int k = 0;

                foreach (string key in this.Items[i].Attributes.Keys)
                {
                    attributes[k] = key;
                    k++;
                    attributes[k] = this.Items[i].Attributes[key];
                    k++;
                }
                state[i + 1] = attributes;
            }
        }

        if (itemHasAttributes)
            return state;
        return baseState;
    }

    protected override void LoadViewState(object savedState)
    {
        if (savedState == null)
            return;

        if (!(savedState.GetType().GetElementType() == null) &&
            (savedState.GetType().GetElementType().Equals(typeof(object))))
        {
            object[] state = (object[])savedState;
            base.LoadViewState(state[0]);

            for (int i = 1; i < state.Length; i++)
            {
                if (state[i] != null)
                {
                    object[] attributes = (object[])state[i];
                    for (int k = 0; k < attributes.Length; k += 2)
                    {
                        this.Items[i - 1].Attributes.Add
                            (attributes[k].ToString(), attributes[k + 1].ToString());
                    }
                }
            }
        }
        else
        {
            base.LoadViewState(savedState);
        }
    }
} 
```

像这样使用它：

```
 ListItem item1 = new ListItem("option1");
        item1.Attributes.Add("optgroup", "CatA");
        ListItem item2 = new ListItem("option2");
        item2.Attributes.Add("optgroup", "CatA");
        ListItem item3 = new ListItem("option3");
        item3.Attributes.Add("optgroup", "CatB");
        ListItem item4 = new ListItem("option4");
        item4.Attributes.Add("optgroup", "CatB");
        ListItem item5 = new ListItem("NoOptGroup");

        ddlTest.Items.Add(item1);
        ddlTest.Items.Add(item2);
        ddlTest.Items.Add(item3);
        ddlTest.Items.Add(item4);
        ddlTest.Items.Add(item5); 
```

这是生成的标记（为了便于查看而缩进）：

```
 <select name="ddlTest" id="Select1">
    <optgroup label="CatA">
        <option selected="selected" value="option1">option1</option>
        <option value="option2">option2</option>
    </optgroup>
    <optgroup label="CatB">
        <option value="option3">option3</option>
        <option value="option4">option4</option>
    </optgroup>
    <option value="NoOptGroup">NoOptGroup</option>
 </select> 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-24T21:21:55.073

CodePlex 上的[Sharp Pieces 项目](http://www.codeplex.com/SharpPieces)解决了这个（以及其他几个）控制限制。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-10-16T13:53:47.597

我用反射器看看为什么不支持。这是有原因的。在 ListControl 的渲染方法中，不存在创建 optgroup 的条件。

```
protected internal override void RenderContents(HtmlTextWriter writer)
    {
        ListItemCollection items = this.Items;
        int count = items.Count;
        if (count > 0)
        {
            bool flag = false;
            for (int i = 0; i < count; i++)
            {
                ListItem item = items[i];
                if (item.Enabled)
                {
                    writer.WriteBeginTag("option");
                    if (item.Selected)
                    {
                        if (flag)
                        {
                            this.VerifyMultiSelect();
                        }
                        flag = true;
                        writer.WriteAttribute("selected", "selected");
                    }
                    writer.WriteAttribute("value", item.Value, true);
                    if (item.HasAttributes)
                    {
                        item.Attributes.Render(writer);
                    }
                    if (this.Page != null)
                    {
                        this.Page.ClientScript.RegisterForEventValidation(this.UniqueID, item.Value);
                    }
                    writer.Write('>');
                    HttpUtility.HtmlEncode(item.Text, writer);
                    writer.WriteEndTag("option");
                    writer.WriteLine();
                }
            }
        }
    } 
```

因此，我创建了自己的下拉控件，并覆盖了 RenderContents 方法。有我的控制。工作正常。我使用与 Microsoft 完全相同的代码，只是添加了一个小条件来支持 listItem 具有属性 optgroup 来创建一个 optgroup 而不是一个选项。

给我一些反馈

```
public class DropDownListWithOptionGroup : DropDownList
  {
    public const string OptionGroupTag = "optgroup";
    private const string OptionTag = "option";
    protected override void RenderContents(System.Web.UI.HtmlTextWriter writer)
    {
      ListItemCollection items = this.Items;
      int count = items.Count;     
      string tag;
      string optgroupLabel;
      if (count > 0)
      {
        bool flag = false;
        for (int i = 0; i < count; i++)
        {
          tag = OptionTag;
          optgroupLabel = null;
          ListItem item = items[i];
          if (item.Enabled)
          {
            if (item.Attributes != null && item.Attributes.Count > 0 && item.Attributes[OptionGroupTag] != null)
            {
              tag = OptionGroupTag;
              optgroupLabel = item.Attributes[OptionGroupTag];
            }           
            writer.WriteBeginTag(tag);
            // NOTE(cboivin): Is optionGroup
            if (!string.IsNullOrEmpty(optgroupLabel))
            {
              writer.WriteAttribute("label", optgroupLabel);
            }
            else
            {
              if (item.Selected)
              {
                if (flag)
                {
                  this.VerifyMultiSelect();
                }
                flag = true;
                writer.WriteAttribute("selected", "selected");
              }
              writer.WriteAttribute("value", item.Value, true);
              if (item.Attributes != null && item.Attributes.Count > 0)
              {
                item.Attributes.Render(writer);
              }
              if (this.Page != null)
              {
                this.Page.ClientScript.RegisterForEventValidation(this.UniqueID, item.Value);
              }
            }
            writer.Write('>');
            HttpUtility.HtmlEncode(item.Text, writer);
            writer.WriteEndTag(tag);
            writer.WriteLine();
          }
        }
      }

    }
  } 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2010-01-22T12:33:15.683

根据上面的帖子，我创建了具有工作视图状态的此控件的 ac# 版本。

```
 public const string OptionGroupTag = "optgroup";
    private const string OptionTag = "option";
    protected override void RenderContents(System.Web.UI.HtmlTextWriter writer)
    {
        ListItemCollection items = this.Items;
        int count = items.Count;
        string tag;
        string optgroupLabel;
        if (count > 0)
        {
            bool flag = false;
            for (int i = 0; i < count; i++)
            {
                tag = OptionTag;
                optgroupLabel = null;
                ListItem item = items[i];
                if (item.Enabled)
                {
                    if (item.Attributes != null && item.Attributes.Count > 0 && item.Attributes[OptionGroupTag] != null)
                    {
                        tag = OptionGroupTag;
                        optgroupLabel = item.Attributes[OptionGroupTag];
                    }
                    writer.WriteBeginTag(tag);
                    // NOTE(cboivin): Is optionGroup
                    if (!string.IsNullOrEmpty(optgroupLabel))
                    {
                        writer.WriteAttribute("label", optgroupLabel);
                    }
                    else
                    {
                        if (item.Selected)
                        {
                            if (flag)
                            {
                                this.VerifyMultiSelect();
                            }
                            flag = true;
                            writer.WriteAttribute("selected", "selected");
                        }
                        writer.WriteAttribute("value", item.Value, true);
                        if (item.Attributes != null && item.Attributes.Count > 0)
                        {
                            item.Attributes.Render(writer);
                        }
                        if (this.Page != null)
                        {
                            this.Page.ClientScript.RegisterForEventValidation(this.UniqueID, item.Value);
                        }
                    }
                    writer.Write('>');
                    HttpUtility.HtmlEncode(item.Text, writer);
                    writer.WriteEndTag(tag);
                    writer.WriteLine();
                }
            }
        }
    }

        protected override object SaveViewState()
    {
        object[] state = new object[this.Items.Count + 1];
        object baseState = base.SaveViewState();
        state[0] = baseState;
        bool itemHasAttributes = false;

        for (int i = 0; i < this.Items.Count; i++)
        {
            if (this.Items[i].Attributes.Count > 0)
            {
                itemHasAttributes = true;
                object[] attributes = new object[this.Items[i].Attributes.Count * 2];
                int k = 0;

                foreach (string key in this.Items[i].Attributes.Keys)
                {
                    attributes[k] = key;
                    k++;
                    attributes[k] = this.Items[i].Attributes[key];
                    k++;
                }
                state[i + 1] = attributes;
            }
        }

        if (itemHasAttributes)
            return state;
        return baseState;
    }

        protected override void LoadViewState(object savedState)
    {
        if (savedState == null)
            return;

        if (!(savedState.GetType().GetElementType() == null) &&
            (savedState.GetType().GetElementType().Equals(typeof(object))))
        {
            object[] state = (object[])savedState;
            base.LoadViewState(state[0]);

            for (int i = 1; i < state.Length; i++)
            {
                if (state[i] != null)
                {
                    object[] attributes = (object[])state[i];
                    for (int k = 0; k < attributes.Length; k += 2)
                    {
                        this.Items[i - 1].Attributes.Add
                            (attributes[k].ToString(), attributes[k + 1].ToString());
                    }
                }
            }
        }
        else
        {
            base.LoadViewState(savedState);
        }
    } 
```

我希望这可以帮助一些人:-)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2014-01-31T13:47:16.767

[Irfan 的](https://stackoverflow.com/a/1942378/932282)基于 jQuery 的解决方案的更通用的方法：

**后端**

```
private void _addSelectItem(DropDownList list, string title, string value, string group = null) {
   ListItem item = new ListItem(title, value);
   if (!String.IsNullOrEmpty(group))
   {
       item.Attributes["data-category"] = group;
   }
   list.Items.Add(item);
}

...
_addSelectItem(dropDown, "Option 1", "1");
_addSelectItem(dropDown, "Option 2", "2", "Category");
_addSelectItem(dropDown, "Option 3", "3", "Category");
... 
```

**客户**

```
var groups = {};
$("select option[data-category]").each(function () {
     groups[$.trim($(this).attr("data-category"))] = true;
});
$.each(groups, function (c) {
     $("select option[data-category='"+c+"']").wrapAll('<optgroup label="' + c + '">');
}); 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2015-01-05T17:44:12.330

我已经为 select 和 optgroups 使用了一个外部转发器，为该组中的项目使用了一个内部转发器：

```
<asp:Repeater ID="outerRepeater" runat="server">
    <HeaderTemplate>
        <select id="<%= outerRepeater.ClientID %>">
    </HeaderTemplate>
    <ItemTemplate>
            <optgroup label="<%# Eval("GroupText") %>">
                <asp:Repeater runat="server" DataSource='<%# Eval("Items") %>'>
                    <ItemTemplate>
                        <option value="<%# Eval("Value") %>"><%# Eval("Text") %></option>
                    </ItemTemplate>
                </asp:Repeater>
            </optgroup>
    </ItemTemplate>
    <FooterTemplate>
        </select>
    </FooterTemplate>
</asp:Repeater> 
```

的数据源`outerRepeater`是一个简单的分组，如下所示：

```
var data = (from o in thingsToDisplay
            group oby GetAlphaGrouping(o.Name) into g
            orderby g.Key
            select new
            {
                Alpha = g.Key,
                Items = g
            }); 
```

并获得 alpha 分组字符：

```
private string GetAlphaGrouping(string value)
{
    string firstChar = value.Substring(0, 1).ToUpper();
    int unused;

    if (int.TryParse(firstChar, out unused))
        return "#";

    return firstChar.ToUpper();
} 
```

这不是一个完美的解决方案，但它有效。*正确*的解决方案是不再使用 WebForms，而是使用 MVC。:)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-11-18T20:45:49.303

正如上面的答案，重载 RenderContents 方法确实有效。您还必须记住更改视图状态。在 UpdatePanels 中使用未更改的视图状态时遇到了问题。这部分内容取自[Sharp Pieces Project](http://www.codeplex.com/SharpPieces)。

```
 Protected Overloads Overrides Sub RenderContents(ByVal writer As HtmlTextWriter)
    Dim list As DropDownList = Me

    Dim currentOptionGroup As String
    Dim renderedOptionGroups As New List(Of String)()

    For Each item As ListItem In list.Items
        If item.Attributes("OptionGroup") Is Nothing Then
            RenderListItem(item, writer)
        Else
            currentOptionGroup = item.Attributes("OptionGroup")

            If renderedOptionGroups.Contains(currentOptionGroup) Then
                RenderListItem(item, writer)
            Else
                If renderedOptionGroups.Count > 0 Then
                    RenderOptionGroupEndTag(writer)
                End If

                RenderOptionGroupBeginTag(currentOptionGroup, writer)
                renderedOptionGroups.Add(currentOptionGroup)

                RenderListItem(item, writer)
            End If
        End If
    Next

    If renderedOptionGroups.Count > 0 Then
        RenderOptionGroupEndTag(writer)
    End If
End Sub

Private Sub RenderOptionGroupBeginTag(ByVal name As String, ByVal writer As HtmlTextWriter)
    writer.WriteBeginTag("optgroup")
    writer.WriteAttribute("label", name)
    writer.Write(HtmlTextWriter.TagRightChar)
    writer.WriteLine()
End Sub

Private Sub RenderOptionGroupEndTag(ByVal writer As HtmlTextWriter)
    writer.WriteEndTag("optgroup")
    writer.WriteLine()
End Sub

Private Sub RenderListItem(ByVal item As ListItem, ByVal writer As HtmlTextWriter)
    writer.WriteBeginTag("option")
    writer.WriteAttribute("value", item.Value, True)

    If item.Selected Then
        writer.WriteAttribute("selected", "selected", False)
    End If

    For Each key As String In item.Attributes.Keys
        writer.WriteAttribute(key, item.Attributes(key))
    Next

    writer.Write(HtmlTextWriter.TagRightChar)
    HttpUtility.HtmlEncode(item.Text, writer)
    writer.WriteEndTag("option")
    writer.WriteLine()
End Sub
Protected Overrides Function SaveViewState() As Object
    ' Create an object array with one element for the CheckBoxList's
    ' ViewState contents, and one element for each ListItem in skmCheckBoxList
    Dim state(Me.Items.Count + 1 - 1) As Object 'stupid vb array
    Dim baseState As Object = MyBase.SaveViewState()

    state(0) = baseState
    ' Now, see if we even need to save the view state
    Dim itemHasAttributes As Boolean = False

    For i As Integer = 0 To Me.Items.Count - 1
        If Me.Items(i).Attributes.Count > 0 Then
            itemHasAttributes = True
            ' Create an array of the item's Attribute's keys and values
            Dim attribKV(Me.Items(i).Attributes.Count * 2 - 1) As Object 'stupid vb array
            Dim k As Integer = 0
            For Each key As String In Me.Items(i).Attributes.Keys
                attribKV(k) = key
                k += 1
                attribKV(k) = Me.Items(i).Attributes(key)
                k += 1
            Next
            state(i + 1) = attribKV
        End If
    Next
    ' return either baseState or state, depending on whether or not
    ' any ListItems had attributes
    If (itemHasAttributes) Then
        Return state
    Else
        Return baseState
    End If
End Function

Protected Overrides Sub LoadViewState(ByVal savedState As Object)
    If savedState Is Nothing Then Return
    ' see if savedState is an object or object array
    If Not savedState.GetType.GetElementType() Is Nothing AndAlso savedState.GetType.GetElementType().Equals(GetType(Object)) Then

        ' we have just the base state
        MyBase.LoadViewState(savedState(0))
        'we have an array of items with attributes
        Dim state() As Object = savedState
        MyBase.LoadViewState(state(0))   '/ load the base state
        For i As Integer = 1 To state.Length - 1
            If Not state(i) Is Nothing Then
                ' Load back in the attributes
                Dim attribKV() As Object = state(i)
                For k As Integer = 0 To attribKV.Length - 1 Step +2
                    Me.Items(i - 1).Attributes.Add(attribKV(k).ToString(), attribKV(k + 1).ToString())
                Next
            End If
        Next
    Else
        'load it normal
        MyBase.LoadViewState(savedState)
    End If
End Sub 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-01-13T13:05:41.553

```
 // How to use:
    // 1\. Create items in a select element or asp:DropDownList control
    // 2\. Set value of an option or ListItem to "_group_", those will be converted to optgroups
    // 3\. On page onload call createOptGroups(domElement), for example like this:
    //    - var lst = document.getElementById('lst');
    //    - createOptGroups(lst, "_group_");
    // 4\. You can change groupMarkerValue to anything, I used "_group_"
    function createOptGroups(lst, groupMarkerValue) {
        // Get an array containing the options
        var childNodes = [];
        for (var i = 0; i < lst.options.length; i++)
            childNodes.push(lst.options[i]);

        // Get the selected element so we can preserve selection
        var selectedIndex = lst.selectedIndex;
        var selectedChild = childNodes[selectedIndex];
        var selectedValue = selectedChild.value;

        // Remove all elements
        while (lst.hasChildNodes())
            lst.removeChild(lst.childNodes[0]);

        // Go through the array of options and convert some into groups
        var group = null;
        for (var i = 0; i < childNodes.length; i++) {
            var node = childNodes[i];
            if (node.value == groupMarkerValue) {
                group = document.createElement("optgroup");
                group.label = node.text;
                group.value = groupMarkerValue;
                lst.appendChild(group);
                continue;
            }

            // Add to group or directly under list
            (group == null ? lst : group).appendChild(node);
        }

        // Preserve selected, no support for multi-selection here, sorry
        selectedChild.selected = true;
    } 
```

在 Chrome 16、Firefox 9 和 IE8 上测试。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-12-20T07:30:49.530

我扩展了[mkl 的答案](https://stackoverflow.com/a/3104581/1465881)，制作了一个可以 DataBind 的 DropDownList 控件。这是结果（可能会有所改进）：

```
public class UcDropDownListWithOptGroup : DropDownList
{
    public const string OptionGroupTag = "optgroup";
    private const string OptionTag = "option";

    protected override void RenderContents(HtmlTextWriter writer)
    {
        ListItemCollection items = this.Items;
        int count = items.Count;
        string tag;
        string optgroupLabel;
        if (count > 0)
        {
            bool flag = false;
            string prevOptGroup = null;
            for (int i = 0; i < count; i++)
            {
                tag = OptionTag;
                optgroupLabel = null;
                ListItem item = items[i];
                if (item.Enabled)
                {
                    if (item.Attributes != null && item.Attributes.Count > 0 && item.Attributes["data-optgroup"] != null)
                    {
                        optgroupLabel = item.Attributes["data-optgroup"];

                        if (prevOptGroup != optgroupLabel)
                        {
                            if (prevOptGroup != null)
                            {
                                writer.WriteEndTag(OptionGroupTag);
                            }
                            writer.WriteBeginTag(OptionGroupTag);
                            if (!string.IsNullOrEmpty(optgroupLabel))
                            {
                                writer.WriteAttribute("label", optgroupLabel);
                            }
                            writer.Write('>');
                        }
                        item.Attributes.Remove(OptionGroupTag);
                        prevOptGroup = optgroupLabel;
                    }
                    else
                    {
                        if (prevOptGroup != null)
                        {
                            writer.WriteEndTag(OptionGroupTag);
                        }
                        prevOptGroup = null;
                    }

                    writer.WriteBeginTag(tag);
                    if (item.Selected)
                    {
                        if (flag)
                        {
                            this.VerifyMultiSelect();
                        }
                        flag = true;
                        writer.WriteAttribute("selected", "selected");
                    }
                    writer.WriteAttribute("value", item.Value, true);
                    if (item.Attributes != null && item.Attributes.Count > 0)
                    {
                        item.Attributes.Render(writer);
                    }
                    if (optgroupLabel != null)
                    {
                        item.Attributes.Add(OptionGroupTag, optgroupLabel);
                    }
                    if (this.Page != null)
                    {
                        this.Page.ClientScript.RegisterForEventValidation(this.UniqueID, item.Value);
                    }

                    writer.Write('>');
                    HttpUtility.HtmlEncode(item.Text, writer);
                    writer.WriteEndTag(tag);
                    writer.WriteLine();
                    if (i == count - 1)
                    {
                        if (prevOptGroup != null)
                        {
                            writer.WriteEndTag(OptionGroupTag);
                        }
                    }
                }
            }
        }
    }

    protected override object SaveViewState()
    {
        object[] state = new object[this.Items.Count + 1];
        object baseState = base.SaveViewState();
        state[0] = baseState;
        bool itemHasAttributes = false;

        for (int i = 0; i < this.Items.Count; i++)
        {
            if (this.Items[i].Attributes.Count > 0)
            {
                itemHasAttributes = true;
                object[] attributes = new object[this.Items[i].Attributes.Count * 2];
                int k = 0;

                foreach (string key in this.Items[i].Attributes.Keys)
                {
                    attributes[k] = key;
                    k++;
                    attributes[k] = this.Items[i].Attributes[key];
                    k++;
                }
                state[i + 1] = attributes;
            }
        }

        if (itemHasAttributes)
            return state;
        return baseState;
    }

    protected override void LoadViewState(object savedState)
    {
        if (savedState == null)
            return;

        if (!(savedState.GetType().GetElementType() == null) &&
            (savedState.GetType().GetElementType().Equals(typeof(object))))
        {
            object[] state = (object[])savedState;
            base.LoadViewState(state[0]);

            for (int i = 1; i < state.Length; i++)
            {
                if (state[i] != null)
                {
                    object[] attributes = (object[])state[i];
                    for (int k = 0; k < attributes.Length; k += 2)
                    {
                        this.Items[i - 1].Attributes.Add
                            (attributes[k].ToString(), attributes[k + 1].ToString());
                    }
                }
            }
        }
        else
        {
            base.LoadViewState(savedState);
        }
    }

    protected override void PerformDataBinding(IEnumerable dataSource)
    {
        base.PerformDataBinding(dataSource);

        if (!string.IsNullOrWhiteSpace(DataOptGroupField) && OptGroupTitles != null)
        {
            var currentItems = Items;
            var dataSourceItems = dataSource.Cast<object>().ToList();

            var staticItemsCount = Items.Count - dataSourceItems.Count;

            for (var i = staticItemsCount; i < Items.Count; i++)
            {
                var dataSourceItem = dataSourceItems[i - staticItemsCount];
                var optGroupValue = DataBinder.GetPropertyValue(dataSourceItem, DataOptGroupField);
                currentItems[i].Attributes.Add("data-optgroup", OptGroupTitles[optGroupValue]);
            }
        }
    }

    public Dictionary<object, string> OptGroupTitles { get; set; }
    public string DataOptGroupField { get; set; }
} 
```

注意事项：

*   您可以设置 DataOptGroupField 属性，类似于 DataTextField 和 DataValueField。它定义了在确定正确的 optgroup 时应该考虑数据绑定项的哪个属性。
*   您可以设置一个 OptGroupTitles 属性，该属性定义应将 DataOptGroupField 中定义的属性转换为哪个 optgroup 标签。

例如，在您的页面或用户控件中使用以下代码：

```
<MyControls:UcDropDownListWithOptGroup runat="server" DataSourceID="dsX" DataTextField="MyDataTextField" DataValueField="MyDataValueField" DataOptGroupField="IsActive" OptGroupTitles='<%# MyGroupTitles %>' /> 
```

其中数据绑定项的“IsActive”属性是一个布尔值。

在页面或用户控件的代码隐藏中，您定义以下属性：

```
public Dictionary<object, string> MyGroupTitles
{
    get
    {
        return new Dictionary<object, string>
        {
            { true, "Active" },
            { false, "Inactive" }
        };
    }
} 
```

# session - 如何让两个浏览器窗口共享同一个“会话”？

> ID：130021
> 
> 赞同：3
> 
> 时间：2008-09-24T21:12:22.943
> 
> 标签：session, browser

我有一个应用程序需要打开一个新窗口（在同一域中），以便用户可以查看报告，但在某些浏览器*上，新窗口不共享原始窗口的非持久 cookie，这会导致用户必须重新登录。我能做些什么来阻止用户在新窗口中再次登录吗？

*事实上，在 IE7 中它是零星的——有时新窗口共享 cookie，有时不共享。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T21:23:02.450

我认为 IE7 与同一窗口中的选项卡共享非持久性 cookie，以及从当前窗口生成的窗口（无论这对于手动打开文件 - > 新建或程序脚本打开是否相同，我我不确定），但新的实例没有。

Firefox 在所有窗口中共享它们，无论它们是如何打开的。我一直认为情况就是这样，您必须使用持久性 cookie、无 cookie 会话或开发单点登录/票务机制来解决它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T21:23:26.317

我正在使用 ASP.NET 并依赖于跨浏览器窗口共享的会话行为，它对我有用。事实上，我什至出于与您在新窗口中显示报告相同的原因使用它:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T21:29:23.293

IE7 似乎确实会使用与 IE6 不同的算法生成新进程，并且可能会导致[会话 cookie](http://sqlblogcasts.com/blogs/jonsayce/archive/2007/11/06/Browsers_2C00_-processes_2C00_-cookies-and-session-state.aspx)出现问题。

最可靠的解决方案可能是围绕它进行架构设计 - 使用无 cookie 会话、持久 cookie，或者只是序列化页面中所需的数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T21:19:25.843

他们*应该*共享 cookie。这是我过去的经验。有戏后我会编辑。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T21:28:06.103

它是否与您打开窗口的方式有关，例如 - JavaScript 与目标标签？

# c# - PropertyGrid 中的多行字符串

> ID：130032
> 
> 赞同：33
> 
> 时间：2008-09-24T21:14:46.760
> 
> 标签：c#, .net, winforms, propertygrid

是否有内置编辑器用于`PropertyGrid`.

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-09-24T21:46:15.250

我发现`System.Design.dll`has `System.ComponentModel.Design.MultilineStringEditor`which 可以按如下方式使用：

```
public class Stuff
{
    [Editor(typeof(MultilineStringEditor), typeof(UITypeEditor))]
    public string MultiLineProperty { get; set; }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T21:26:17.857

不，您需要创建所谓的模态 UI 类型编辑器。您需要创建一个继承自 UITypeEditor 的类。这基本上是当您单击正在编辑的属性右侧的省略号按钮时显示的表单。

我发现的唯一缺点是我需要用特定的属性来装饰特定的字符串属性。我不得不这样做已经有一段时间了。我从 Chris Sells 的一本名为“C# 中的 Windows 窗体编程”的书中获得了这些信息

VisualHint有一个名为[Smart PropertyGrid.NET的商业属性网格。](http://www.visualhint.com/index.php/propertygrid/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-03-08T11:48:38.450

我们需要编写自定义编辑器来获得属性网格中的多行支持。

这是从[UITypeEditor实现的客户文本编辑器类](https://docs.microsoft.com/en-us/dotnet/api/system.drawing.design.uitypeeditor?view=netframework-4.7.2)

```
public class MultiLineTextEditor : UITypeEditor
{
    private IWindowsFormsEditorService _editorService;

    public override UITypeEditorEditStyle GetEditStyle(ITypeDescriptorContext context)
    {
        return UITypeEditorEditStyle.DropDown;
    }

    public override object EditValue(ITypeDescriptorContext context, IServiceProvider provider, object value)
    {
        _editorService = (IWindowsFormsEditorService)provider.GetService(typeof(IWindowsFormsEditorService));

        TextBox textEditorBox = new TextBox();
        textEditorBox.Multiline = true;
        textEditorBox.ScrollBars = ScrollBars.Vertical;
        textEditorBox.Width = 250;
        textEditorBox.Height = 150;
        textEditorBox.BorderStyle = BorderStyle.None;
        textEditorBox.AcceptsReturn = true;
        textEditorBox.Text = value as string;

        _editorService.DropDownControl(textEditorBox);

        return textEditorBox.Text;
    }
} 
```

编写您的自定义属性网格并将此 Editor 属性应用于属性

```
class CustomPropertyGrid
{
    private string multiLineStr = string.Empty;

    [Editor(typeof(MultiLineTextEditor), typeof(UITypeEditor))]
    public string MultiLineStr
    {
        get { return multiLineStr; }
        set { multiLineStr = value; }
    }
} 
```

在主窗体中分配此对象

```
 propertyGrid1.SelectedObject = new CustomPropertyGrid(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T21:26:38.947

是的。我不太记得它是如何调用的，但请查看 Items 属性编辑器以获取类似 ComboBox 的内容

已编辑：截至@fryguybob，ComboBox.Items 使用 System.Windows.Forms.Design.ListControlStringCollectionEditor

# iis - 如何在我的 IIS Windows 服务器上限制从我的网站下载速度？

> ID：130034
> 
> 赞同：6
> 
> 时间：2008-09-24T21:15:43.747
> 
> 标签：iis, webserver

当人们从我的网站下载文件时，我不希望他们每个文件的下载速度超过 300KB/秒。

有没有办法做到这一点？我在 Windows Server 2003 上运行 IIS 6.0。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-24T21:23:27.440

您不能限制下载速度，但可以限制特定网站的总流量：

1.  打开 IIS MMC
2.  选择网站
3.  选择性能选项卡
4.  启用“带宽限制”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T21:22:35.277

编写一个以块的形式传输数据的脚本。300KB 后，您等到 1 秒被消耗。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-19T10:07:45.807

我刚刚发现了这个，但我没有时间自己尝试一下[IIS 比特率限制](http://www.iis.net/download/BitRateThrottling)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T13:22:07.790

我同意魂器（不能投票，因为没有足够的代表）

如果文件小于 300KB，那么这是行不通的，但是对于大文件，整个文件下载过程中的平均速度将是 300Kbps...

我假设这个想法就像一个快速共享的想法，高级用户将有全速下载？

此外，当一个线程（用户）等待一秒钟时，另一个线程可以下载。

排队下载，只让 X 数量同时运行，然后你就一发不可收拾！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-18T15:23:24.830

在 IIS 6.0 的网站属性中，有一个性能选项卡，第一个设置是带宽限制，它允许您以千字节每秒为单位设置最大带宽值。它也有这个注释；

*要使带宽限制起作用，IIS 需要安装 Windows Packet Scheduler。*

我猜使用此设置意味着将您的下载放在一个单独的站点上，这样您就可以限制它，但保持正常内容的全部带宽。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-09-16T15:41:51.707

对于 IIS 10，转到 IIS 管理器，您将在标题下找到您的设置

媒体服务 > 比特率限制

[![在此处输入图像描述](https://i.stack.imgur.com/Xqvk6.png)](https://i.stack.imgur.com/Xqvk6.png)

* * *

## 回答 #7

> 赞同：-7
> 
> 时间：2008-09-24T21:20:15.360

降低您的 Internet 连接速度。

# reverse-engineering - 串行发生器/裂缝是如何开发的？

> ID：130058
> 
> 赞同：30
> 
> 时间：2008-09-24T21:21:22.330
> 
> 标签：reverse-engineering, cracking

我的意思是，我一直想知道有人到底是如何开发算法来打破/欺骗许多共享软件程序中合法使用的限制。

只是为了好奇。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-24T21:43:10.233

除了非法之外，这是一项非常复杂的任务。

只是在理论上讲，常见的方法是反汇编程序进行破解并尝试找到检查密钥或序列码的位置。

说起来容易做起来难，因为任何严肃的保护方案都会检查多个位置的值，并且还会从串行密钥中获取关键信息以供以后使用，这样当你认为你猜到了它时，程序就会崩溃。

要创建破解，您必须识别完成检查的所有点并适当地修改汇编代码（通常反转条件跳转或将成本存储到内存位置）。

要创建密钥生成器，您必须了解算法并编写程序来重新执行完全相同的计算（我记得旧版本的 MS Office，其序列号有一个非常简单的规则，数字的总和应该是7，所以编写 keygen 相当简单）。

这两个活动都要求您在调试器中跟踪应用程序的执行并尝试找出正在发生的事情。而且您需要了解操作系统的低级 API。

一些受到严格保护的应用程序对代码进行了加密，因此无法反汇编文件。它在加载到内存时被解密，但是如果他们检测到内存中的调试器已经启动，他们会拒绝启动，

从本质上讲，这需要非常深入的知识、独创性和大量时间！哦，我有没有提到这在大多数国家都是非法的？

如果您想了解更多信息，请参阅 Google 的 +ORC 破解教程，它们非常古老，现在可能已经无用，但会让您很好地了解它的含义。

无论如何，了解这一切的一个很好的理由是如果您想编写自己的保护方案。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-24T21:25:47.437

坏人使用反汇编程序搜索密钥检查代码。如果你知道如何做到这一点，这相对容易。

之后，您将密钥检查代码翻译成 C 或其他语言（此步骤是可选的）。逆向检查密钥的过程为您提供了一个密钥生成器。

如果您知道汇编程序，大约需要一个周末来学习如何做到这一点。几年前我已经完成了（虽然从未发布过任何东西。这只是对我的游戏开发工作的研究。要编写一个难以破解的密钥，您必须了解人们如何破解）。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-24T21:45:49.773

Nils 的帖子涉及密钥生成器。对于裂缝，通常你会找到一个分支点并反转（或删除条件）逻辑。例如，您将测试该软件是否已注册，如果是，则测试可能会返回零，然后进行相应的跳转。您可以通过修改单个字节将“如果等于零 (je) 则跳转”更改为“如果不等于零 (jne) 则跳转”。或者，您可以在代码的各个部分编写不执行您不想执行的操作的操作。

编译后的程序可以反汇编，只要有足够的时间，有决心的人就可以开发二进制补丁。破解只是一个二进制补丁，可以让程序以不同的方式运行。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-24T21:27:09.290

首先，大多数复制保护方案都不是非常先进，这就是为什么你现在看不到很多人推出自己的方案。

有几种方法可以做到这一点。您可以在调试器中单步执行代码，这通常需要具备相当的汇编知识。使用它，您可以了解程序复制保护/密钥生成方法的调用位置。这样，您可以使用[IDA Pro](http://www.hex-rays.com/idapro/)之类的反汇编程序更仔细地分析代码，并尝试了解发生了什么，以及如何绕过它。我之前通过在日期检查中插入 NOOP 指令来破解限时 Beta。

它实际上只是归结为对软件的良好理解和对汇编的基本理解。 [Hak5](http://hak5.org)在本季的前两集中制作了一个由两部分组成的系列，内容是关于逆向工程和破解的基础知识。它*真的很*基本，但它可能正是您正在寻找的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T21:28:00.893

一个潜在的破解者会反汇编程序并寻找“复制保护”位，特别是用于确定序列号是否有效的算法。从该代码中，您通常可以看到解锁功能所需的位模式，然后编写一个生成器来创建具有这些模式的数字。

另一种选择是寻找如果序列号有效则返回“true”并且如果序列号无效则返回“false”的函数，然后开发一个二进制补丁，以便该函数始终返回“true”。

其他一切基本上都是这两个想法的变体。根据定义，复制保护*总是*可以破坏的——在某些时候你必须得到可执行代码，否则处理器无法运行它。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T21:38:55.907

您可以提取算法并开始对其进行“猜测”并寻找积极响应的序列号。计算机功能强大，通常只需要一点时间就可以开始输出热门歌曲。

至于黑客，我曾经能够在高层次上单步执行程序并寻找它停止工作的点。然后你回到最后一个成功的“呼叫”并进入它，然后重复。那时，复制保护通常是写入磁盘并查看后续读取是否成功（如果成功，则复制保护失败，因为他们曾经用激光刻录软盘的一部分，因此无法写入）。

然后只需找到正确的调用并从该调用中硬编码正确的返回值即可。

我敢肯定它仍然很相似，但是他们付出了很多努力来隐藏通话的位置。我尝试的最后一个我放弃了，因为它一直在我单步执行的代码上加载代码，而且我确信从那时起它变得更加复杂。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-02T12:12:06.827

我想知道为什么他们不只是分发个性化的二进制文件，其中所有者的名字存储在二进制文件中的某个地方（加密和混淆），或者更好地分布在整个二进制文件中。AFAIK Apple 正在使用来自 iTunes 的音乐文件执行此操作存储，但是从文件中删除名称太容易了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T21:27:48.273

我假设每个破解都是不同的，但我猜在大多数情况下，有人会在调试器中花费大量时间来跟踪相关应用程序。

串行生成器通过分析检查序列号的有效性并对其进行逆向工程的算法，更进一步。

# operating-system - 为 x86 架构开发操作系统

> ID：130065
> 
> 赞同：34
> 
> 时间：2008-09-24T21:22:50.877
> 
> 标签：operating-system, x86, osdev

我正计划为 x86 架构开发一个操作系统。

*   我有哪些编程语言选项？
*   有哪些类型的编译器可用，最好是在 Windows 环境中？
*   有什么好的资源可以帮助我更多地了解操作系统开发吗？
*   在虚拟机或物理硬件上测试我的操作系统更好吗？

有什么建议么？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-09-24T21:49:08.037

在我最后一年的拼贴项目中，我开发了一个带有虚拟内存管理器、虚拟文件系统和完全抢占式多任务处理的小型 x86 操作系统。我把它开源了，代码被大量注释，查看它的源代码页面：

[https://github.com/stephenfewer/NoNameOS](https://github.com/stephenfewer/NoNameOS)

根据我的经验，我可以推荐以下内容：

各个部分都*需要*x86 汇编语言，这是不可避免的，但可以保持在最低限度。很快您就会运行 C 代码，这是 OS 开发的可靠选择。一旦你有了某种可用的内存管理器，你就可以根据需要进入 C++（你需要某种内存管理器来处理 new 和 delete 之类的事情）。

无论您选择哪种语言，您仍然需要汇编和 C 来将系统从 BIOS 引导到任何可用的形式。

最终，您选择的主要语言将取决于您要开发的操作系统类型。

我的开发环境是 GNU 开发工具[DJGPP](http://www.delorie.com/djgpp/)的 Windows 端口以及[NASM](http://www.nasm.us/)汇编器。对于我的[IDE](http://www.eclipse.org/)，我使用了 IBM 的 Eclipse 和[CDT](http://www.eclipse.org/cdt/)插件，它在 Eclipse 中提供了 C/C++ 开发环境。

对于测试，我推荐[BOCHS](http://bochs.sourceforge.net/)，一个开源 x86 PC 模拟器。它可以让您快速启动您的操作系统，这非常适合测试，并且可以集成到 eclipse 中，因此您只需按一下按钮就可以构建和运行您的操作系统。我还建议偶尔同时使用 VMWare 和物理 PC，因为这样可以发现一些细微的错误。

PS OS 开发真的很有趣，但非常密集，我花了 12 个月的大部分时间。我的建议是计划好，你的*设计*是关键！请享用 ：）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-24T21:36:55.227

语言和编译器完全取决于您要完成的工作。不过，我建议您可能从太低的层面来处理问题。

有关于操作系统基础的材料。 [麻省理工学院有关于这个主题的开放课件](http://ocw.mit.edu/OcwWeb/Electrical-Engineering-and-Computer-Science/6-828Fall-2006/CourseHome/)。通读[Andrew Tannenbaum](http://en.wikipedia.org/wiki/Andrew_S._Tanenbaum)的[操作系统系列](http://www.prenhall.com/tanenbaum/)，看看[Minix](http://www.minix3.org/)之类的东西。

了解那里有什么。开始修补东西。借用想法，看看它们的去向。如果你真的愿意，你可以重新发明轮子，但你会在其他人的作品的基础上学到更多。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-28T04:56:22.153

没关系，你选择什么语言。如果该语言是图灵完备的，那么您可以在其中编写一个操作系统。

然而，语言的表现力将使某些类型的设计很容易或很难实现。例如，旧 Smalltalk 操作系统的“活力”和活力取决于它们在 Smalltalk 中实现的事实。你*也可以*在 C 中做到这一点，但它可能太难了，你甚至都不会去想它。JavaScript 或 Ruby OTOH 可能非常适合。

[微软研究院的奇点](http://Research.Microsoft.Com/OS/Singularity/)是另一个例子。[除了 Sing#、 Spec#](http://Research.Microsoft.Com/SpecSharp/)和[C#](http://MSDN.Microsoft.Com/vcsharp/) （或类似语言）之外，它根本无法用任何其他语言实现，因为很多架构都依赖于这些语言的静态类型安全性和静态可验证性。

需要记住的一件事：用 C 语言实现的操作系统的设计空间已经得到了充分的探索。实际上有成千上万的人。但是，在其他语言中，您实际上可能会发现以前没有人发现过的东西！用 Java 编写的操作系统只有大约十几个，用 C# 编写的操作系统大约有六个，在 Haskell 中大约有两个操作系统，只有*一个*用 Python 编写，*没有一个*用 Ruby 或 JavaScript 编写。

尝试用 Erlang 或 Io 编写操作系统，看看这会如何影响您对操作系统的思考！

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-28T05:07:36.557

马里兰大学提供了一个使用[GeekOS](http://geekos.sourceforge.net/)的操作系统课程。这是一个小型、广泛评论的操作系统，专为教育目的而设计，可以使用 Bochs 或 QEMU 仿真器运行。

有关如何在课程中使用它的示例，请在课程[网页](http://www.cs.umd.edu/class/spring2008/cmsc412/)上查看之前提供的课程。在那里，您会找到必须向 GeekOS 添加不同功能的任务。

这是熟悉在 x86 架构上运行的小型简单操作系统的好方法。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T21:29:34.103

您可能想查找 XINU。这是一个适用于 x86 的微型操作系统，除了被学生解剖之外，它并没有真正用于任何其他用途。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-24T21:44:14.803

使用 ANSI C，并从模拟器开始。当您移植到真机时，会有一些汇编代码。上下文切换和中断处理（例如）更容易用汇编程序编写。

Andy Tannenbaum 写了一本关于操作系统的好书。还有许多其他好的。

祝你好运！没有什么比编写自己的操作系统更好的了，不管它多么小。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-24T21:48:32.030

另请查看[OSDev.org](http://www.osdev.org/)，其中包含您入门所需的所有信息。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-04T14:57:26.747

毫无疑问，我会使用 Ada。这是我遇到的最好的通用系统编程语言，没有之一。例如，Ada 在指定记录中对象的位布局方面比 C 好得多。Ada 还支持在特定内存位置上覆盖记录。C 要求您使用指针来实现相同的效果。这可行，但更容易出错。Ada 还具有对中断的语言支持。

另一个：安全。Ada 默认使用绑定检查数组分配，但允许您在需要时将其关闭。C“默认”为不对数组进行绑定检查，因此您必须在需要时手动进行。时间表明，这*不是*正确的默认设置。你会忘记一个需要它的地方。缓冲区溢出漏洞是黑客使用的最常见的安全漏洞。他们有整个网站解释如何找到和使用它们。

至于学习如何做这件事，我知道的两本书是[XINU](https://rads.stackoverflow.com/amzn/click/com/0136381804)（Unix 倒退，与 Scientology 无关）和[Project Oberon](https://rads.stackoverflow.com/amzn/click/com/0201544288)。第一个是在我的操作系统研究生课程中使用的，第二个是由 Pascal 的创建者 Nikalus Wirth 编写的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-24T21:36:48.737

我曾经为 PCI 板上的 386SX 做过一次。关于如何在保护模式下启动 X86 cpu 的一个很好的来源是 linux 的源代码。这只是一些汇编语句。之后，您可以使用 gcc 编译您的 C 代码。结果是 ELF 格式的目标代码。我编写了自己的链接器，用目标代码制作程序。是的，它奏效了！祝你好运。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-28T05:17:18.453

请务必查看我的问题的答案：

[如何开始操作系统开发](https://stackoverflow.com/questions/43180/how-to-get-started-in-operating-system-development)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-24T21:26:54.937

如果您正在制作完整的操作系统，则需要使用多种语言。我希望至少有汇编、C 和 C++。

我会使用虚拟机进行大部分测试。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-09-02T15:21:32.510

C 很可能...所有主要的操作系统都是用 C/C++ 或 Objective-C(Apple) 编写的

* * *

## 回答 #13

> 赞同：-5
> 
> 时间：2008-09-24T21:34:31.033

如果你想编写一个操作系统，那么你需要几个人。一个操作系统不能写一个人。我认为在现有的操作系​​统项目上工作会更好

*   [Reactos](http://www.reactos.org) --> C，汇编程序
*   [SharpOS](http://www.reactos.org) --> C#
*   [JNode](http://www.jnode.org/) --> Java

这只是 OS 项目的简短列表。您如何看到每种可能的语言都有一个项目。

# python - time.gmtime() 是否有一个反函数，可以将 UTC 元组解析为自纪元以来的秒数？

> ID：130074
> 
> 赞同：22
> 
> 时间：2008-09-24T21:24:04.727
> 
> 标签：python

python的时间模块似乎有点随意。例如，这里有一个方法列表，来自文档字符串：

```
time() -- return current time in seconds since the Epoch as a float
clock() -- return CPU time since process start as a float
sleep() -- delay for a number of seconds given as a float
gmtime() -- convert seconds since Epoch to UTC tuple
localtime() -- convert seconds since Epoch to local time tuple
asctime() -- convert time tuple to string
ctime() -- convert time in seconds to string
mktime() -- convert local time tuple to seconds since Epoch
strftime() -- convert time tuple to string according to format specification
strptime() -- parse string to time tuple according to format specification
tzset() -- change the local timezone 
```

查看 localtime() 及其逆 mktime()，为什么 gmtime() 没有逆？

额外问题：您将方法命名为什么？你将如何实施它？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-02T08:42:45.617

实际上有一个反函数，但出于某种奇怪的原因，它位于[日历](https://docs.python.org/2/library/calendar.html)模块中：calendar.timegm()。[我在这个答案](https://stackoverflow.com/questions/79797/how-do-i-convert-local-time-to-utc-in-python#79913)中列出了功能。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T21:38:28.653

我一直认为时间和日期时间模块有点不连贯。无论如何，这是 mktime 的倒数

```
import time
def mkgmtime(t):
    """Convert UTC tuple to seconds since Epoch"""
    return time.mktime(t)-time.timezone 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T21:38:59.977

我只是 Python 的新手，但这是我的方法。

```
def mkgmtime(fields):
    now = int(time.time())
    gmt = list(time.gmtime(now))
    gmt[8] = time.localtime(now).tm_isdst
    disp = now - time.mktime(tuple(gmt))
    return disp + time.mktime(fields) 
```

在那里，我也为该函数提议了名称。:-) 每次都重新计算很重要`disp`，以防夏令时值发生变化等。（Jython 需要转换回元组。CPython 似乎不需要它。）

这太糟糕了，因为`time.gmtime`总是将 DST 标志设置为 false。不过，我讨厌代码。必须有更好的方法来做到这一点。可能还有一些我还没有得到的极端案例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-09-13T10:01:12.927

mktime 文档在这里有点误导，没有任何意义说它是按本地时间计算的，而是根据提供的元组从 Epoch 计算秒数 - 无论您的计算机位置如何。

如果您确实想将 utc_tuple 转换为本地时间，您可以执行以下操作：

```
>>> time.ctime(time.time())
'Fri Sep 13 12:40:08 2013'

>>> utc_tuple = time.gmtime()
>>> time.ctime(time.mktime(utc_tuple))
'Fri Sep 13 10:40:11 2013'

>>> time.ctime(time.mktime(utc_tuple) - time.timezone)
'Fri Sep 13 12:40:11 2013' 
```

也许更准确的问题是如何**将 utc_tuple 转换为 local_tuple**。我会称之为**gm_tuple_to_local_tuple**（我更喜欢长而描述性的名称）：

```
>>> time.localtime(time.mktime(utc_tuple) - time.timezone)
time.struct_time(tm_year=2013, tm_mon=9, tm_mday=13, tm_hour=12, tm_min=40, tm_sec=11, tm_wday=4, tm_yday=256, tm_isdst=1) 
```

**验证：**

```
>>> time.ctime(time.mktime(time.localtime(time.mktime(utc_tuple) - time.timezone)))
'Fri Sep 13 12:40:11 2013' 
```

希望这会有所帮助，伊利亚。

# ruby-on-rails - CouchDB 文档模型更改？

> ID：130092
> 
> 赞同：8
> 
> 时间：2008-09-24T21:28:28.710
> 
> 标签：ruby-on-rails, ruby, couchdb

Rails 使用迁移的概念来处理使用 ActiveRecord API 的模型更改。

CouchDB 使用 JSON（嵌套映射和数组）来表示其模型对象。

到目前为止，在使用 CouchDB 时，我没有看到识别文档结构何时发生变化的好方法（除了作为开发人员受到纪律处分），或者将文档从旧模型迁移到新模型。

在 CouchDB 中是否有现有功能或者您有处理模型更改的最佳实践？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-26T18:19:22.380

RDBMS 去洗脑的时间。:)

couchdb 无模式设计的最大要点之一就是直接针对防止迁移的需要。对象的 JSON 表示可以很容易地直接输入您的对象。

例如，假设您有一个博客类型的网络应用程序，其中包含帖子以及人们在博客中存储的任何花哨的东西。您的帖子文档包含作者、标题、创建时间等字段。现在您来思考一下，“我应该在发布帖子时跟踪月亮处于什么相位......”您可以开始添加 moon_phase 为新帖子的属性。

如果您想完整，您会返回并将 moon_phase 添加到旧帖子中，但这并不是绝对必要的。

在您的视图中，您可以将 moon_phase 作为属性访问。它将为空或导致异常或其他东西。（不是 JS 专家，我认为 null 是正确的答案）

问题是，这并不重要。如果你想改变一些东西，就改变它。虽然要确保你的观点理解这种变化。根据我的经验，这并不需要太多。

此外，如果你真的很偏执，你可能会存储一个版本/类型属性，如：

```
{
   _id: "foo-post",
   _rev: "23490AD",
   type: "post",
   typevers: 0,
   moon_phase: "full"
} 
```

希望有帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T23:32:52.387

查看[ActiveCouch](https://github.com/arunthampi/activecouch/tree/master)。

CouchDB 是无模式的，因此从 ActiveRecord 迁移到 CouchDB 等价物的概念没有一对一的映射。但是，ActiveCouch 确实包括 CouchDB 的“视图”的迁移。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-04T11:07:07.973

如果你喜欢使用模式并且仍然想使用 CouchDB，你会得到“阻抗不匹配”。

然而，“迁移”并不难。向每个文档添加一个`schema_version`元素。然后让您的“文档阅读功能”包括更新。像这样的东西：

```
def read(doc_id):
    doc = db.get(doc_id)
    if doc.schema_version == 1:
        # version 1 had names broken down too much
        doc.name = "%s %s" % (doc.first, doc.last)
        del doc.first
        del doc.last
        doc.schema_version = 2
        db.put(doc)
    if doc.schema_version == 2: weight
        # version 2 used kg instead of g
        doc.weight_g = doc.weight_kg * 1000
        del doc.volume_kg
        doc.schema_version = 3
        db.put(doc)
    return doc 
```

如果您想一次升级整个数据库，只需调用`read(doc_id)`每个文档。

# batch-file - 命令行 .cmd/.bat 脚本，如何获取运行脚本的目录

> ID：130112
> 
> 赞同：82
> 
> 时间：2008-09-24T21:32:26.483
> 
> 标签：batch-file

如何获取已运行脚本的目录并在 .cmd 文件中使用它？

* * *

## 回答 #1

> 赞同：152
> 
> 时间：2008-09-24T21:38:33.567

这相当于脚本的路径：

```
%~dp0 
```

这使用批处理参数扩展语法。参数 0 始终是脚本本身。

如果您的脚本存储在`C:\example\script.bat`，则`%~dp0`计算结果为`C:\example\`。

[ss64.com](https://ss64.com/nt/syntax-args.html)有更多关于参数扩展语法的信息。以下是相关摘录：

> 您可以使用 % 后跟它在命令行上的数字位置来获取任何参数的值。
> 
> [...]
> 
> 当参数用于提供文件名时，可以应用以下扩展语法：
> 
> [...]
> 
> %~d1 仅将 %1 扩展为驱动器号 - C:
> 
> [...]
> 
> %~p1 仅将 %1 扩展为路径，例如 \utils\ 这包括一个尾随 \，它可能被某些命令解释为转义字符。
> 
> [...]
> 
> 上面的修饰符可以组合：
> 
> %~dp1 仅将 %1 扩展为驱动器号和路径
> 
> [...]
> 
> 您可以使用 %0 获取批处理脚本本身的路径名，可以对其应用参数扩展名，因此 %~dp0 会将驱动器和路径返回到批处理脚本，例如 W:\scripts\

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2008-09-24T21:34:20.770

Raymond Chen 有几个想法：

> [https://devblogs.microsoft.com/oldnewthing/20050128-00/?p=36573](https://devblogs.microsoft.com/oldnewthing/20050128-00/?p=36573)

在这里完整引用是因为 MSDN 档案往往有些不可靠：

> 简单的方法是使用`%CD%`伪变量。它扩展到当前工作目录。
> 
> `set OLDDIR=%CD%`
> `.. do stuff ..`
> `chdir /d %OLDDIR% &rem restore current directory`
> 
> （当然，使用 / 可以更轻松地完成目录保存/恢复`pushd`，`popd`但这不是重点。）
> 
> 这个`%CD%`技巧即使从命令行也很方便。例如，我经常发现自己在一个目录中，其中有一个我想要操作的文件，但是......哦，我需要 chdir 到某个其他目录才能执行该操作。
> 
> `set _=%CD%\curfile.txt`
> `cd ... some other directory ...`
> `somecommand args %_% args`
> 
> （我喜欢`%_%`用作我的临时环境变量。）
> 
> 键入`SET /?`以查看命令处理器提供的其他伪变量。

此外，文章中的评论也非常值得浏览，例如这篇文章（通过 WayBack Machine，因为评论已从旧文章中删除）：

> [http://blogs.msdn.com/oldnewthing/archive/2005/01/28/362565.aspx#362741](https://web.archive.org/web/20081014085253/http://blogs.msdn.com/oldnewthing/archive/2005/01/28/362565.aspx#362741)

这涵盖了 %~dp0 的使用：

> 如果您想知道批处理文件的位置：`%~dp0`
> 
> `%0`是批处理文件的名称。`~dp`为您提供指定参数的驱动器和路径。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-12-23T17:06:27.780

```
for /F "eol= delims=~" %%d in ('CD') do set curdir=%%d

pushd %curdir% 
```

[来源](http://www.umachandar.com/technical/CMDScripts/Main12.htm)

# batch-file - 从文本文件中读取第一行的 Windows 批处理命令

> ID：130116
> 
> 赞同：91
> 
> 时间：2008-09-24T21:33:27.730
> 
> 标签：batch-file, cmd

如何使用 Windows 批处理文件从文本文件中读取第一行？由于文件很大，我只想处理第一行。

* * *

## 回答 #1

> 赞同：235
> 
> 时间：2011-10-19T19:49:31.640

呃？imo这要简单得多

```
 set /p texte=< file.txt  
  echo %texte% 
```

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2008-09-24T22:20:14.950

这是一个通用批处理文件，用于打印`n`GNU 实用程序等文件的顶部行`head`，而不仅仅是一行。

```
@echo off

if [%1] == [] goto usage
if [%2] == [] goto usage

call :print_head %1 %2
goto :eof

REM
REM print_head
REM Prints the first non-blank %1 lines in the file %2.
REM
:print_head
setlocal EnableDelayedExpansion
set /a counter=0

for /f ^"usebackq^ eol^=^

^ delims^=^" %%a in (%2) do (
        if "!counter!"=="%1" goto :eof
        echo %%a
        set /a counter+=1
)

goto :eof

:usage
echo Usage: head.bat COUNT FILENAME 
```

例如：

```
Z:\>head 1 "test file.c"
; this is line 1

Z:\>head 3 "test file.c"
; this is line 1
    this is line 2
line 3 right here 
```

它目前不计算空行。它还受制于 8 KB 的批处理文件行长度限制。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2011-07-26T02:00:59.927

呃你们...

```
C:\>findstr /n . c:\boot.ini | findstr ^1:

1:[boot loader]

C:\>findstr /n . c:\boot.ini | findstr ^3:

3:default=multi(0)disk(0)rdisk(0)partition(1)\WINNT

C:\> 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-24T21:42:42.247

你可以试试这个：

```
@echo off

for /f %%a in (sample.txt) do (
  echo %%a
  exit /b
) 
```

**编辑** 或者，假设您有四列数据并且想要从第 5 行向下到底部，试试这个：

```
@echo off

for /f "skip=4 tokens=1-4" %%a in (junkl.txt) do (
  echo %%a %%b %%c %%d
) 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-24T21:55:41.310

感谢 thetalkingwalnut 和回答[Windows 批处理命令从文本文件中读取第一行，](https://stackoverflow.com/questions/130116/dos-batch-commands-to-read-first-line-from-text-file#130154)我想出了以下解决方案：

```
@echo off
for /f "delims=" %%a in ('type sample.txt') do (
echo %%a
exit /b
) 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-24T22:09:36.207

稍微建立在其他人的答案之上。现在允许您指定要从中读取的文件以及要将结果放入的变量：

```
@echo off
for /f "delims=" %%x in (%2) do (
set %1=%%x
exit /b
) 
```

这意味着您可以像这样使用上面的内容（假设您将其命名为 getline.bat）

```
c:\> dir > test-file
c:\> getline variable test-file
c:\> set variable  
variable= Volume in drive C has no label. 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-24T22:41:02.700

一个衬里，对使用“>”的标准输出重定向很有用：

```
@for /f %%i in ('type yourfile.txt') do @echo %%i & exit 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2021-08-19T10:27:25.957

`powershell Get-Content file.txt -Head 1`

这个比上面读取完整文件的其他 powershell 示例快得多。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-11-29T17:23:04.627

试试这个

```
@echo off
setlocal enableextensions enabledelayedexpansion
set firstLine=1
for /f "delims=" %%i in (yourfilename.txt) do (
    if !firstLine!==1 echo %%i
    set firstLine=0
)
endlocal 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2019-04-19T18:38:31.263

要循环文件（`file1.txt`、`file1[1].txt`、`file1[2].txt`等）：

```
START/WAIT C:\LAERCIO\DELPHI\CICLADOR\dprCiclador.exe C:\LAERCIUM\Ciclavel.txt

rem set/p ciclo=< C:\LAERCIUM\Ciclavel.txt:
set/p ciclo=< C:\LAERCIUM\Ciclavel.txt

rem echo %ciclo%:
echo %ciclo% 
```

它正在运行。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-07-25T16:37:49.680

解决方案的问题`EXIT /B`，当更现实地在批处理文件中作为它的一部分时，如下所示。.之后的批处理文件内没有后续处理`EXIT /B`。通常，批次不仅仅是一项有限的任务。

为了解决这个问题：

```
@echo off & setlocal enableextensions enabledelayedexpansion
set myfile_=C:\_D\TEST\My test file.txt
set FirstLine=
for /f "delims=" %%i in ('type "%myfile_%"') do (
  if not defined FirstLine set FirstLine=%%i)
echo FirstLine=%FirstLine%
endlocal & goto :EOF 
```

（不过，所谓的毒字还是有问题的。）

有关使用批处理命令获取特定行的更多信息：

> 如何获取文本文件的第 n 行、第一行和最后一行？” [http://www.netikka.net/tsneti/info/tscmd023.htm](http://www.netikka.net/tsneti/info/tscmd023.htm)

**[2012 年 8 月 28 日添加]**还可以：

```
@echo off & setlocal enableextensions
set myfile_=C:\_D\TEST\My test file.txt
for /f "tokens=* delims=" %%a in (
  'type "%myfile_%"') do (
    set FirstLine=%%a& goto _ExitForLoop)
:_ExitForLoop
echo FirstLine=%FirstLine%
endlocal & goto :EOF 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-09-20T10:05:58.997

这是使用的解决方法`powershell`：

```
powershell (Get-Content file.txt)[0] 
```

（您还可以使用 轻松阅读一系列行`powershell (Get-Content file.txt)[0..3]`）

如果您需要在批处理脚本中设置变量作为`file.txt`您可以使用的第一行：

```
for /f "usebackq delims=" %%a in (`powershell ^(Get-Content file.txt^)[0]`) do (set "head=%%a") 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-09-02T04:12:36.110

请注意，批处理文件方法将仅限于 DOS 命令处理器的行限制 - 请参阅[什么是命令行长度限制？](http://blogs.msdn.com/oldnewthing/archive/2003/12/10/56028.aspx).

因此，如果尝试处理包含超过**8192**个字符的行的文件，则脚本将跳过它们，因为无法保存该值。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-02-27T06:52:52.137

其他方式

```
setlocal enabledelayedexpansion
@echo off
for /f "delims=" %%i in (filename.txt) do (
if 1==1 (
set first_line=%%i
echo !first_line!
goto :eof
)) 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-05-14T10:11:25.043

在 Windows PowerShell 下面 cmd 可用于获取第一行并将其替换为静态值

```
powershell -Command "(gc txt1.txt) -replace (gc txt1.txt)[0], 'This is the first line' | Out-File -encoding ASCII txt1.txt" 
```

参考

* * *

[如何使用 Windows 命令行环境查找和替换文件中的文本？](https://stackoverflow.com/questions/60034/how-can-you-find-and-replace-text-in-a-file-using-the-windows-command-line-envir)

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2019-11-06T14:24:09.923

仅打印第一行（无需读取整个文件）：

```
set /p a=< file.txt & echo !a! 
```

要打印第一行，然后等待用户按下下一行的键：（
打印所需行后，按 Ctrl+C 停止。）

```
for /f "delims=" %a in (downing.txt) do echo %a & pause>nul 
```

要打印第一 n 行（无需用户按键）：

```
type nul > tmp & fc tmp "%file%" /lb %n% /t | find /v "*****" | more +2 
```

在 Win 10 CMD 上测试。

# c++ - 如果你不应该在析构函数中抛出异常，你如何处理其中的错误？

> ID：130117
> 
> 赞同：280
> 
> 时间：2008-09-24T21:34:01.177
> 
> 标签：c++, exception, destructor, raii

大多数人说*永远不要*从析构函数中抛出异常——这样做会导致未定义的行为。Stroustrup 指出*“向量析构函数显式调用每个元素的析构函数。这意味着如果元素析构函数抛出，向量析构失败......确实没有很好的方法来防止析构函数引发的异常，所以库不保证元素析构函数是否抛出”（来自附录 E3.2）*。

[这篇文章](http://www.kolpackov.net/projects/c++/eh/dtor-1.xhtml)似乎另有说法 - 抛出析构函数或多或少是可以的。

*所以我的问题是——如果从析构函数中抛出导致未定义的行为，你如何处理析构函数期间发生的错误？*

如果在清理操作过程中发生错误，您是否忽略它？如果它是一个可以在堆栈中处理但不能在析构函数中正确处理的错误，那么从析构函数中抛出异常是否有意义？

显然，这类错误很少见，但也有可能。

* * *

## 回答 #1

> 赞同：212
> 
> 时间：2008-09-24T21:35:59.893

从析构函数中抛出异常是危险的。
如果另一个异常已经在传播，则应用程序将终止。

```
#include <iostream>

class Bad
{
    public:
        // Added the noexcept(false) so the code keeps its original meaning.
        // Post C++11 destructors are by default `noexcept(true)` and
        // this will (by default) call terminate if an exception is
        // escapes the destructor.
        //
        // But this example is designed to show that terminate is called
        // if two exceptions are propagating at the same time.
        ~Bad() noexcept(false)
        {
            throw 1;
        }
};
class Bad2
{
    public:
        ~Bad2()
        {
            throw 1;
        }
};

int main(int argc, char* argv[])
{
    try
    {
        Bad   bad;
    }
    catch(...)
    {
        std::cout << "Print This\n";
    }

    try
    {
        if (argc > 3)
        {
            Bad   bad; // This destructor will throw an exception that escapes (see above)
            throw 2;   // But having two exceptions propagating at the
                       // same time causes terminate to be called.
        }
        else
        {
            Bad2  bad; // The exception in this destructor will
                       // cause terminate to be called.
        }
    }
    catch(...)
    {
        std::cout << "Never print this\n";
    }

} 
```

这基本上归结为：

任何危险的事情（即可能引发异常）都应该通过公共方法（不一定直接）来完成。然后，您的类的用户可以通过使用公共方法并捕获任何潜在的异常来潜在地处理这些情况。

然后，析构函数将通过调用这些方法来结束对象（如果用户没有明确地这样做），但是任何抛出的异常都会被捕获并丢弃（在尝试修复问题之后）。

因此，实际上您将责任转嫁给了用户。如果用户能够纠正异常，他们将手动调用适当的函数并处理任何错误。如果对象的用户不担心（因为对象将被销毁），那么析构函数将负责处理业务。

# 一个例子：

标准::fstream

close() 方法可能会引发异常。如果文件已打开，则析构函数调用 close()，但要确保任何异常都不会传播到析构函数之外。

因此，如果文件对象的用户想要对与关闭文件相关的问题进行特殊处理，他们将手动调用 close() 并处理任何异常。另一方面，如果他们不关心，那么析构函数将被留下来处理这种情况。

Scott Myers 在他的“Effective C++”一书中有一篇关于这个主题的优秀文章

### 编辑：

显然也在“更有效的 C++”
[第 11 条：防止异常离开析构函数](http://bin-login.name/ftp/pub/docs/programming_languages/cpp/cffective_cpp/MEC/MI11_FR.HTM)

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2008-12-17T15:22:03.820

抛出析构函数可能会导致崩溃，因为这个析构函数可能被称为“堆栈展开”的一部分。堆栈展开是在抛出异常时发生的过程。在这个过程中，所有从“尝试”到抛出异常之前被压入堆栈的对象都将被终止 -> 它们的析构函数将被调用。并且在此过程中，不允许再次抛出异常，因为不可能一次处理两个异常，因此，这将引发对 abort() 的调用，程序将崩溃并且控制将返回给操作系统。

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2010-11-04T16:07:37.493

我们必须在这里**区分**，而不是盲目地遵循针对*特定*情况的*一般*建议。

 *请注意，以下内容*忽略*了对象容器的问题以及面对容器内对象的多个 d'tors 该怎么办。（并且可以部分忽略，因为有些对象不适合放入容器中。）

当我们将类分为两种类型时，整个问题变得更容易思考。一个类 dtor 可以有两种不同的职责：

*   (R) 释放语义（也就是释放内存）
*   (C)*提交*语义（也就是将文件*刷新*到磁盘）

如果我们以这种方式看待这个问题，那么我认为可以说（R）语义永远不应该导致来自 dtor 的异常，因为 a）我们对此无能为力，b）许多免费资源操作不会甚至提供错误检查，例如.*`void`* `free(void* p);`

具有 (C) 语义的对象，例如需要成功刷新其数据的文件对象或在 dtor 中执行提交的（“范围保护”）数据库连接属于不同的类型：我们*可以*对错误做一些事情（在应用程序级别），我们真的不应该像什么都没发生一样继续。

如果我们遵循 RAII 路线并允许在其 d'tors 中具有 (C) 语义的对象，我认为我们还必须允许此类 d'tors 可以抛出的奇怪情况。`terminate()`因此，您不应该将此类对象放入容器中，并且如果 commit-dtor 在另一个异常处于活动状态时抛出，程序仍然可以。

* * *

关于错误处理（提交/回滚语义）和异常，[Andrei Alexandrescu](http://erdani.com/)有一个很好的演讲：*[C++ 中的错误处理/声明式控制流](http://vimeo.com/channels/ndc2014/97329153)*（在[NDC 2014](http://www.ndcoslo.com/poster)举行）

在详细信息中，他解释了 Folly 库是如何[`UncaughtExceptionCounter`](https://github.com/facebook/folly/blob/master/folly/detail/UncaughtExceptionCounter.h)为他们的[`ScopeGuard`](https://github.com/facebook/folly/blob/master/folly/ScopeGuard.h)工具实现的。

（我应该注意到[其他人](https://github.com/panaseleus/stack_unwinding/)也有类似的想法。）

虽然这次演讲的重点不是从 d'tor 投掷，但它展示了一种*今天可以用来*[解决何时](http://en.cppreference.com/w/cpp/error/uncaught_exception)从 d'tor投掷的问题的工具。

~~将来~~，~~可能~~会有一个标准特性，~~请参阅[N3614](http://www.open-std.org/JTC1/SC22/WG21/docs/papers/2013/n3614.pdf)和~~[关于它](https://groups.google.com/a/isocpp.org/forum/#!msg/std-proposals/PCpJMgzla80/-grf1-ITAYUJ)的讨论。

更新 '17：C++17 标准特性是[`std::uncaught_exceptions`](http://en.cppreference.com/w/cpp/error/uncaught_exception)afaikt。我将快速引用 cppref 文章：

> ### 笔记
> 
> `int`使用-returning的一个例子`uncaught_exceptions`是......首先创建一个保护对象，并在其构造函数中记录未捕获异常的数量。输出由保护对象的析构函数执行，除非 foo() 抛出（*在这种情况下，析构函数中未捕获的异常数量大于构造函数观察到的数量*）

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-09-24T21:42:05.417

关于从析构函数中抛出的真正问题是“调用者可以用这个做什么？” 实际上，您可以对异常做些什么有用的事情，以抵消从析构函数中抛出所产生的危险？

如果我销毁一个`Foo`对象，而`Foo`析构函数抛出一个异常，我可以合理地用它做什么？我可以记录它，也可以忽略它。就这样。我无法“修复”它，因为`Foo`对象已经消失了。最好的情况是，我记录异常并继续，就好像什么都没发生一样（或终止程序）。这真的值得通过从析构函数中抛出来潜在地导致未定义的行为吗？

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-04-11T03:00:42.170

来自 C++ 的 ISO 草案 (ISO/IEC JTC 1/SC 22 N 4411)

**所以析构函数通常应该捕获异常，而不是让它们传播出析构函数。**

> 3 为在从 try 块到 throw 表达式的路径上构造的自动对象调用析构函数的过程称为“堆栈展开”。[注意：如果在堆栈展开期间调用的析构函数因异常退出，则调用 std::terminate (15.5.1)。所以析构函数通常应该捕获异常，而不是让它们传播出析构函数。——尾注]

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-09-24T21:48:07.740

它很危险，但从可读性/代码可理解性的角度来看也没有意义。

你要问的是在这种情况下

```
int foo()
{
   Object o;
   // As foo exits, o's destructor is called
} 
```

什么应该捕获异常？应该调用 foo 吗？还是应该 foo 处理它？为什么 foo 的调用者应该关心 foo 内部的一些对象？语言可能有一种方式将其定义为有意义的，但它会变得不可读且难以理解。

更重要的是，Object 的内存去哪儿了？对象拥有的内存去哪儿了？它是否仍然被分配（表面上是因为析构函数失败）？还要考虑对象在*堆栈空间*中，所以它显然已经消失了。

然后考虑这种情况

```
class Object
{ 
   Object2 obj2;
   Object3* obj3;
   virtual ~Object()
   {
       // What should happen when this fails? How would I actually destroy this?
       delete obj3;

       // obj 2 fails to destruct when it goes out of scope, now what!?!?
       // should the exception propogate? 
   } 
}; 
```

当 obj3 的删除失败时，我该如何以保证不失败的方式实际删除呢？它是我的记忆该死的！

现在考虑在第一个代码片段中 Object 自动消失，因为它在堆栈上，而 Object3 在堆上。由于指向 Object3 的指针消失了，所以你有点 SOL。你有内存泄漏。

现在一种安全的做事方式如下

```
class Socket
{
    virtual ~Socket()
    {
      try 
      {
           Close();
      }
      catch (...) 
      {
          // Why did close fail? make sure it *really* does close here
      }
    } 

}; 
```

另请参阅此[常见问题解答](http://www.parashift.com/c++-faq-lite/exceptions.html#faq-17.3)

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2017-01-02T16:02:04.373

我所在的小组认为，在析构函数中抛出的“范围保护”模式在许多情况下都很有用 - 特别是对于单元测试。但是，请注意，在 C++11 中，抛出析构函数会导致调用，`std::terminate`因为析构函数被隐式注释为`noexcept`.

Andrzej Krzemieński 有一篇关于抛出的析构函数的精彩帖子：

*   [https://akrzemi1.wordpress.com/2011/09/21/destructors-that-throw/](https://akrzemi1.wordpress.com/2011/09/21/destructors-that-throw/)

他指出 C++11 有一种机制可以覆盖`noexcept`析构函数的默认值：

> 在 C++11 中，析构函数被隐式指定为`noexcept`. 即使您没有添加规范并像这样定义您的析构函数：
> 
> ```
>  class MyType {
>         public: ~MyType() { throw Exception(); }            // ...
>   }; 
> ```
> 
> 编译器仍会无形地`noexcept`向您的析构函数添加规范。这意味着当你的析构函数抛出异常时，`std::terminate`将被调用，即使没有双重异常情况。如果你真的决定允许你的析构函数抛出，你将不得不明确地指定它；你有三个选择：
> 
> *   明确指定你的析构函数`noexcept(false)`为
> *   从另一个已经将其析构函数指定为`noexcept(false)`.
> *   在您的类中放置一个非静态数据成员，该成员已经将其析构函数指定为`noexcept(false)`.

最后，如果您决定抛出析构函数，您应该始终注意双重异常的风险（在堆栈因异常而展开时抛出）。这会导致调用，`std::terminate`而这很少是你想要的。为了避免这种行为，您可以简单地检查是否已经存在异常，然后再使用`std::uncaught_exception()`.

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-24T21:41:01.173

您的析构函数可能在其他析构函数链中执行。抛出一个未被直接调用者捕获的异常可能会使多个对象处于不一致的状态，从而导致更多问题，然后忽略清理操作中的错误。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-01-19T05:39:54.597

其他人都解释了为什么抛出析构函数很糟糕......你能做些什么呢？如果您正在执行可能失败的操作，请创建一个单独的公共方法来执行清理并可以引发任意异常。在大多数情况下，用户会忽略这一点。如果用户想要监控清理的成功/失败，他们可以简单地调用显式清理例程。

例如：

```
class TempFile {
public:
    TempFile(); // throws if the file couldn't be created
    ~TempFile() throw(); // does nothing if close() was already called; never throws
    void close(); // throws if the file couldn't be deleted (e.g. file is open by another process)
    // the rest of the class omitted...
}; 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-01-20T19:57:08.563

作为良好、全面和准确的主要答案的补充，我想对您引用的文章发表评论——那篇文章说“在析构函数中抛出异常还不错”。

文章采用“抛出异常的替代方案是什么”这一行，并列出了每个替代方案的一些问题。这样做之后，它得出的结论是，因为我们找不到没有问题的替代方案，我们应该继续抛出异常。

问题在于，它列出的备选问题中没有一个问题与异常行为一样糟糕，让我们记住，这是“程序的未定义行为”。作者的一些反对意见包括“审美丑陋”和“鼓励不良作风”。现在你更愿意拥有哪个？一个风格不好的程序，还是一个表现出未定义行为的程序？

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-03-18T14:57:57.800

> 问：所以我的问题是——如果从析构函数中抛出导致未定义的行为，你如何处理析构函数期间发生的错误？

答：有几种选择：

1.  让异常从你的析构函数中流出，不管其他地方发生了什么。这样做时要注意（甚至害怕） std::terminate 可能会随之而来。

2.  永远不要让异常从析构函数中流出。如果可以的话，可能会写入日志，一些大红色的坏文本。

3.  *我的最爱*：如果`std::uncaught_exception`返回 false，让你的异常流出。如果它返回 true，则回退到日志记录方法。

但是投入d'tors好吗？

我同意上述大部分内容，最好在析构函数中避免投掷，如果可以的话。但有时你最好接受它可能发生，并妥善处理它。我会选择上面的3个。

在一些奇怪的情况下，从析构函数中抛出它实际上是一个*好主意。*就像“必须检查”的错误代码一样。这是从函数返回的值类型。如果调用者读取/检查包含的错误代码，则返回值会静默销毁。 *但是*，如果在返回值超出范围时尚未读取返回的错误代码，它将*从其析构函数*中抛出一些异常。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2018-01-05T13:50:02.300

> 所以我的问题是——如果从析构函数中抛出导致未定义的行为，你如何处理析构函数期间发生的错误？

主要问题是：你*不能不失败*。毕竟，失败意味着什么？如果向数据库提交事务失败，并且失败（回滚失败），我们的数据完整性会发生什么？

由于对正常和异常（失败）路径都调用了析构函数，因此它们本身不会失败，否则我们将“失败”。

这是一个概念上困难的问题，但解决方案通常是找到一种方法来确保失败不会失败。例如，数据库可能会在提交到外部数据结构或文件之前写入更改。如果事务失败，则可以丢弃文件/数据结构。然后它必须确保从该外部结构/文件提交更改是一个不会失败的原子事务。

> 务实的解决方案也许只是确保失败失败的可能性在天文数字上是不可能的，因为在某些情况下，让事情不可能失败几乎是不可能的。

对我来说最合适的解决方案是以一种清理逻辑不会失败的方式编写非清理逻辑。例如，如果您想创建一个新的数据结构来清理现有的数据结构，那么您可能会寻求提前创建该辅助结构，以便我们不再需要在析构函数中创建它。

诚然，这说起来容易做起来难，但这是我看到的唯一真正正确的方法。有时我认为应该有能力为正常的执行路径和异常的执行路径编写单独的析构函数逻辑，因为有时析构函数感觉有点像他们通过尝试处理两者来承担双重责任（一个例子是需要明确解除的范围保护; 如果他们可以区分异常破坏路径和非异常破坏路径，他们就不需要这样做）。

最终的问题仍然是我们不能失败，这是一个很难在所有情况下都完美解决的概念设计问题。如果你不被复杂的控制结构所包围，大量的小对象相互交互，它会变得更容易，而是以稍微笨重的方式对你的设计进行建模（例如：带有析构函数的粒子系统来破坏整个粒子系统，而不是每个粒子单独的非平凡析构函数）。当您在这种较粗略的级别上对设计进行建模时，您需要处理的重要析构函数就会减少，并且通常还可以承担确保析构函数不会失败所需的任何内存/处理开销。

最简单的解决方案之一自然是减少使用析构函数。在上面的粒子示例中，也许在破坏/移除粒子时，应该做一些可能由于任何原因而失败的事情。在这种情况下，不是通过可以在异常路径中执行的粒子的 dtor 调用此类逻辑，而是可以在粒子系统*移除*粒子时全部由粒子系统完成。移除粒子可能总是在非异常路径期间完成。如果系统被破坏，也许它可以只清除所有粒子，而不用打扰可能失败的单个粒子删除逻辑，而可能失败的逻辑仅在粒子系统正常执行期间删除一个或多个粒子时执行。

如果您避免使用非平凡的析构函数处理大量小对象，通常会出现类似的解决方案。你可能会陷入一团乱麻，似乎几乎不可能实现异常安全的地方是，当你确实陷入了许多都具有非平凡 dtors 的小对象中时。

如果任何指定它的东西（包括应该继承其基类的 noexcept 规范的虚函数）试图调用任何可能抛出的东西，如果 nothrow/noexcept 实际转换为编译器错误，这将有很大帮助。这样，如果我们实际上无意中编写了一个可能抛出的析构函数，我们就能够在编译时捕获所有这些东西。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-02-25T07:42:25.230

设置报警事件。通常，警报事件是在清理对象时通知故障的更好形式

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-10-27T03:31:54.980

与构造函数不同，在构造函数中，抛出异常可能是指示对象创建成功的有用方法，而在析构函数中不应抛出异常。

在堆栈展开过程中从析构函数引发异常时会出现此问题。如果发生这种情况，编译器将处于不知道是继续堆栈展开过程还是处理新异常的情况。最终结果是您的程序将立即终止。

因此，最好的做法就是完全避免在析构函数中使用异常。而是将消息写入日志文件。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-08-27T01:04:40.703

从析构函数中抛出异常永远不会导致未定义的行为。

将异常抛出析构函数的问题是，成功创建的对象的析构函数在处理未捕获的异常时（在创建异常对象之后直到异常激活的处理程序完成）会被异常处理调用机制; 并且，如果在处理未捕获的异常时调用的析构函数中的此类附加异常中断了处理未捕获的异常，它将导致调用`std::terminate`（调用的另一种情况`std::exception`是异常没有被任何处理程序处理，但这与任何其他函数一样，不管它是否是析构函数）。

* * *

如果正在处理未捕获的异常，您的代码永远不知道是否会捕获额外的异常或将归档未捕获的异常处理机制，因此永远无法确定抛出是否安全。

虽然，有可能知道正在处理未捕获的异常（[https://en.cppreference.com/w/cpp/error/uncaught_exception](https://en.cppreference.com/w/cpp/error/uncaught_exception)），因此您可以通过检查条件来过度杀伤并仅在它出现时抛出并非如此（在某些情况下它不会抛出它是安全的）。

但在实践中，这种分离为两种可能的行为是没有用的——它只是无助于你制作一个设计良好的程序。

* * *

如果你抛出析构函数而忽略未捕获的异常处理是否正在进行，为了避免可能的调用`std::terminate`，你必须保证在对象的生命周期中抛出的所有异常都可能从它们的析构函数中抛出异常在开始之前被捕获对象的破坏。它的使用非常有限；您几乎不能使用所有可以合理地以这种方式从析构函数中抛出的类；并且仅对某些类的此类使用受限的类允许此类异常的组合也阻碍了设计良好的程序。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2010-02-02T06:21:18.730

我目前遵循的政策（很多人都在说）类不应该主动从它们的析构函数中抛出异常，而是应该提供一个公共的“关闭”方法来执行可能失败的操作......

...但我确实相信容器类型类的析构函数（如向量）不应该掩盖从它们包含的类中抛出的异常。在这种情况下，我实际上使用了递归调用自身的“释放/关闭”方法。是的，我递归地说。这种疯狂是有办法的。异常传播依赖于堆栈：如果发生单个异常，则其余的析构函数仍将运行，并且一旦例程返回，挂起的异常将传播，这很好。如果发生多个异常，则（取决于编译器）第一个异常将传播或程序将终止，这没关系。如果发生这么多异常以致递归溢出堆栈，那么就出现了严重错误，有人会发现它，这也是可以的。亲自，

关键是容器保持中立，由所包含的类决定它们在从其析构函数中抛出异常时是否行为不当。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2015-04-15T20:42:07.097

Martin Ba（上图）走在正确的轨道上——你为 RELEASE 和 COMMIT 逻辑构建不同的架构。

## 对于发布：

你应该吃任何错误。您正在释放内存，关闭连接等。系统中的其他任何人都不应该再次看到这些东西，并且您正在将资源交还给操作系统。如果看起来您需要真正的错误处理，这可能是您的对象模型中设计缺陷的结果。

## 对于提交：

这是您需要与 std::lock_guard 等为互斥锁提供的相同类型的 RAII 包装器对象的地方。有了这些，您根本不会将提交逻辑放在 dtor 中。你有一个专用的 API，然后包装对象将 RAII 提交到他们的 dtors 并在那里处理错误。请记住，您可以很好地在析构函数中捕获异常；发行它们是致命的。这还允许您通过构建不同的包装器（例如 std::unique_lock 与 std::lock_guard）来实现策略和不同的错误处理，并确保您不会忘记调用提交逻辑——这是唯一的中途将它放在第一名的正当理由。

# starteam - Starteam 2005 COM API

> ID：130120
> 
> 赞同：3
> 
> 时间：2008-09-24T21:35:01.610
> 
> 标签：starteam

有没有人使用过 StarTeam COM API（特别是与 C# 集成）。

我需要编写一个从 Starteam 返回目录结构的辅助函数，但我能够使用此 API 检索的只是视图列表。

有没有其他人试过这个？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-25T04:49:22.237

哦，为了完整起见，如果您不想自己编写递归代码来导航文件夹的层次结构，那么您可以使用一个名为 FolderListManager 的帮助程序类来为您完成艰苦的工作

```
void BtnFindClick(object sender, EventArgs e)
{
    Borland.StarTeam.View v = StarTeamFinder.OpenView("username:pwd@server:49201/Project");
    FolderListManager lm = new FolderListManager(v);
    lm.IncludeFolders(v.RootFolder,-1); // -1 means recursively add child folders
    StringBuilder sb = new StringBuilder();
    foreach(Folder f in lm.Folders)
    {
        sb.AppendLine(f.Path);
    }
    txtResults.Text = sb.ToString();
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T23:00:02.013

Starteam 对象模型是分层的，项目包含视图，视图包含文件夹，文件夹包含项目（子文件夹、文件、cr 等）

因此，一旦您有了视图列表，您就可以获得属于该视图的文件夹，然后您就有一些属性可以确定它们如何映射到本地文件系统，视图对象和文件夹对象都具有只读路径属性。不过，还有 4 个其他值得关注的属性，在视图对象上读取 DefaultPath 和 AlternatePath 属性，在文件夹对象上读取 DefaultPathFragment 和 AlternatePathFragment。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T20:33:36.547

您不必使用 COM 来访问 StarTeam API。[有可用的StarTeam SDK](http://www.borland.com/downloads/download_starteam.html)的 .NET 版本。

# .net - Windows 窗体线程和事件 - 传递事件的最有效方法？

> ID：130132
> 
> 赞同：1
> 
> 时间：2008-09-24T21:38:04.100
> 
> 标签：.net, winforms, multithreading

我的表单从随机工作线程上的另一个对象接收异步回调。我一直在使用委托将数据传递给主线程（可用于更新屏幕控件），如下所示。性能很糟糕——一旦我达到每秒 500 次更新，程序就会完全锁定。我的 GUI 处理本身不是问题，因为我可以在表单中模拟这种级别的更新并且没有问题。我应该使用更有效的机制将数据从线程传递到线程吗？

```
delegate void DStatus( MyStatus obj );
DStatus _status; // set to MainThreadOnStatus during construction

// this function only called on form's owner thread
void MainThreadOnStatus( MyStatus obj )
{
   // screen updates here as needed
}

// this function called by arbitrary worker threads in external facility
void OnStatus( MyStatus obj )
{
   this.BeginInvoke( _status, obj );
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T05:34:31.870

我不是计时器的忠实拥护者，如果您想要更多事件驱动的方法，请尝试以下操作：

```
public class Foo
{
    private AsyncOperation _asyncOperation = null;
    private SendOrPostCallback _notifyNewItem = null;

    //Make sure you call this on your UI thread.
    //Alternatively you can call something like the AttachUI() below later on and catch-up with
    //your workers later.
    public Foo()
    {
        this._notifyNewItem = new SendOrPostCallback(this.NewDataInTempList);
        this._asyncOperation = AsyncOperationManager.CreateOperation(this);
    }

    public void AttachUI()
    {
        if (this._asyncOperation != null)
        {
            this._asyncOperation.OperationCompleted();
            this._asyncOperation = null;
        }

        this._asyncOperation = AsyncOperationManager.CreateOperation(this);
        //This is for catching up with the workers if they’ve been busy already
        if (this._asyncOperation != null)
        {
            this._asyncOperation.Post(this._notifyNewItem, null);
        }
    }

    private int _tempCapacity = 500;
    private object _tempListLock = new object();
    private List<MyStatus> _tempList = null;

    //This gets called on the worker threads..
    //Keeps adding to the same list until UI grabs it, then create a new one.
    public void Add(MyStatus status)
    {
        bool notify = false;
        lock (_tempListLock)
        {
            if (this._tempList == null)
            {
                this._tempList = new List<MyStatus>(this._tempCapacity);
                notify = true;
            }

            this._tempList.Add(status);
        }
        if (notify)
        {
            if (this._asyncOperation != null)
            {
                this._asyncOperation.Post(this._notifyNewItem, null);
            }
        }
    }

    //This gets called on your UI thread.
    private void NewDataInTempList(object o)
    {
        List<MyStatus> statusList = null;
        lock (this._tempListLock)
        {
            //Grab the list, and release the lock as soon as possible.
            statusList = this._tempList;
            this._tempList = null;
        }
        if (statusList != null)
        {
            //Deal with it here at your leasure
        }
    }
} 
```

我在自定义 Log4Net 记录器中使用了它，收集日志条目并将它们添加到绑定到网格的循环数组中。性能最终表现得非常好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T21:47:25.123

您可能不需要在每个事件上更新 UI，而是“不像每秒 X 次那样频繁”。您可以利用秒表或其他计时系统来收集一段时间内的事件，然后在适当的时候更新 UI。

如果您需要捕获所有事件，请将它们收集到队列中并每隔一段时间触发事件，该事件处理程序将处理队列并为所有排队事件更新一次 UI。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T22:06:19.227

我一直在做 Ilya 建议的事情。对于不需要“实时”响应的 UI，我有一个每秒走两次左右的秒表。为了更快的更新，我使用存储事件数据的队列或其他数据结构，然后使用“锁定（队列）{}”来避免争用。如果您不想减慢工作线程的速度，则必须确保 UI 线程不会阻塞工作线程太久。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T22:05:50.600

很难说出确切的问题，但有一些可能性......

您`MyStatus`传递给 OnStatus 的对象是从`MarshalByRefObject`（以及其中的每个对象）派生的吗？如果不是这样，它将在每个编组的调用上进行 serailized，这可能会导致巨大的性能损失。

此外，您应该`this.InvokeRequired`在使用控件调用委托之前调用，但实际上这只是最佳实践。

# html - 透明PNG的IE6问题

> ID：130161
> 
> 赞同：14
> 
> 时间：2008-09-24T21:44:00.980
> 
> 标签：html, css, internet-explorer-6, png

我已经习惯了这样的想法，如果我想/需要以跨浏览器的方式使用 alpha-trans PNG，我在 div 上使用背景图像，然后在仅限 IE6 的 CSS 中，将背景标记为“无”并包含正确的“过滤器”参数。

还有其他方法吗？更好的方法？有没有办法用 img 标签而不是背景图像来做到这一点？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-24T21:49:44.383

底线是，如果您希望 PNG 中的 alpha 透明度，并且您希望它在 IE6 中工作，那么您需要应用 AlphaImageLoader 过滤器。

现在，有很多方法可以做到这一点：浏览器特定的 hack、条件注释、Javascript/JQuery/JLibraryOfChoice 元素迭代、通过 UserAgent 嗅探的服务器端 CSS 服务......

但是所有这些都归结为应用了过滤器并删除了背景。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T21:57:08.577

这很可能是“最好的”方式。但请记住，IE6 在处理 PNG 文件时不能正确实现的不仅仅是 alpha-trans；由于 IE 未正确实现伽玛，色彩空间已损坏，因此 PNG 文件通常显示比应有的“暗”。
我们在最近的一个项目中实现的另一种“解决方案”是用“toGif”类标记每个 png 图像，在其 CSS 中调用自定义行为 .htc，如果浏览器是，则将 .png 扩展名更改为 .gif检测为我们已标记为问题的问题。我们只是在同一路径中包含每个 PNG 的 GIF 版本，如果发现浏览器不能正确处理 PNG，它会将其替换为图像的 GIF 版本。因此，我们牺牲了 alpha 混合，以保证完全透明和色彩准确性，并且只有在我们知道它可能不会按原样看起来正确时才这样做。
这可能不是一个理想的解决方案，但我想这是跨浏览器的本质。
编辑：实际上，现在我查看了有问题的项目，我们为一个名为“alpha”的 img 类使用了 .htc 行为，它自动在图像上抛出正确的过滤器。因此，您正在使用 javascript 而不是仅 IE6 的纯 CSS hack 来检测浏览器，因此它可能会更优雅一些......但它基本上是一样的。
有关如何编写 DHTML 行为的介绍，请尝试[此链接](http://msdn.microsoft.com/en-us/library/ms531079.aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T22:00:50.673

这是我喜欢的特定解决方案，使用 Javascript (jQuery)：

[http://jquery.andreaseberhard.de/pngFix/](http://jquery.andreaseberhard.de/pngFix/)

它很容易添加到现有网站，处理各种图像（表单按钮、背景、常规 IMG 标签等），并使您的 CSS 美观整洁。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T22:08:09.923

图像加载器是 IE6 唯一可用的修复程序。请注意，它对 PNG 的支持非常初级（与 IE7 一样），并且无法正确处理循环透明背景。在尝试使用透明容器设计网站时，我学到了这一点。当然，在 Firefox 中完美运行。

对于小范围的背景和任何透明的前景图形，该修复应该是可以的，但我再次建议不要设计一个使用 Internet Explorer 使用大量透明度的网站。

最后我的解决方案是为 IE 显示一个平面颜色，但为其他浏览器保留透明度。幸运的是，最终没有对设计造成太大伤害。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T11:43:16.293

另一种解决方法是使用 2 个单独的图像，例如 GIF 和透明 PNG，并相应地定位您的 CSS：

```
/* for IE 6 */
#banner {
    background:url(../images/banner.gif);
}

/* for other browsers */
html > #banner {
    background:url(../images/banner.png);
} 
```

IE 6 不理解 CSS 子选择器，所以会忽略该规则，而理解它的浏览器会给你一个很好的透明 PNG。

唯一的缺点是您必须有两个单独的图像，并且设计在跨浏览器时可能看起来不*完全相同*，但只要它看起来没有损坏就可以了。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-07-02T05:22:18.853

这里有 2 个不使用 AlphaImageLoader 过滤器的选项。

*   [Drew Diller 的 DD_belatedPNG](http://www.dillerdesign.com/experiment/DD_belatedPNG/)：使用基于 VML 的解决方案，而不是 AlphaImageLoader 过滤器。
*   [PNGPong](http://blog.psyrendust.com/pngpong/)：基于 Flash 的解决方案

对我来说，如果仅将乱码 .gif 发送到 IE6 是不可行的，我会使用[Fireworks 将 IE6 友好的调色板添加到 .PNG](http://www.pewpewlaser.com/articles/alpha-png-ie6-fireworks)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T21:50:27.283

img 元素的常用解决方案是将 src 更改为指向 1x1 像素的透明 GIF，然后使用相同的过滤器 hack。

# asp.net - ASP.NET 没有看到单选按钮值更改

> ID：130165
> 
> 赞同：2
> 
> 时间：2008-09-24T21:44:54.770
> 
> 标签：asp.net, javascript

我有一个带有一些默认禁用的单选按钮的表单。

当一个值输入到文本框中时，单选按钮通过 javascript 启用。然后，用户选择其中一个单选按钮并单击提交按钮，该按钮将返回到服务器。

当我回到服务器时，用户单击的单选按钮未显示为选中状态。我将使用“rbSolid”作为我关注的单选按钮。

我处理单选按钮的“onclick”事件，但除了触发之外，我没有其他功能：

> Me.rbSolid.Attributes.Add("onclick", "styleLookupChanged(this);")

在客户端，这会在文本框值更改时启用单选按钮：

> document.getElementById("ctl00_MainLayoutContent_WebPanel4_rbSolid").disabled = false;

然后我单击单选按钮，然后通过按钮发回，但回到服务器上，这总是错误的：

> 如果 Me.rbSolid.Checked 然后...

如果我默认启用单选按钮，它会显示为正确选中。

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-24T21:48:45.837

这与 ASP.NET 回发数据的方式有关。如果在呈现页面时禁用控件，`control.enabled = false`则不会将值发送回服务器。我过去如何解决它是使用属性标签而不是使用 Enabled 属性设置禁用标志。因此`control.enabled = false`，您使用`control.attributes.add("disabled", "disabled")`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T13:18:44.027

这对我不起作用。

我补充说：

```
Me.rbSolid.Style.Add("background-color", "red")

Me.rbSolid.Style.Add("disabled", "true") 
```

并且背景样式有效，但`disabled`没有。表单呈现时它仍然是可编辑的。

这是加载后的来源：

```
<span style="font-family:Verdana;font-size:8pt;background-color:red;Disabled:true;">
  <input id="ctl00_MainLayoutContent_WebPanel4_rbSolid" type="radio" name="ctl00$MainLayoutContent$WebPanel4$DetailType" value="rbSolid" onclick="styleLookupChanged(this);"/>
  <label for="ctl00_MainLayoutContent_WebPanel4_rbSolid">Solid</label>
</span> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T14:28:06.760

显然禁用的是 html 属性而不是 css 属性。如果您在 asp.net 中禁用服务器端的单选按钮，然后检查呈现的 html，则单选按钮将嵌入到 span 标记中，其 disabled 属性设置为 true。您可以尝试以按钮的跨度为目标（父元素，它没有 id）并在您的 javascript 中设置 disabled=false 以查看是否有效

# excel - 从其他工作簿“单击”命令按钮

> ID：130166
> 
> 赞同：2
> 
> 时间：2008-09-24T21:45:23.380
> 
> 标签：excel, vba

我正在尝试编写一个宏来“单击”另一个工作簿中的命令按钮。那可能吗？不更改其他工作簿中的任何代码？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2015-10-26T20:47:42.570

对于另一个工作簿中的 ActiveX 按钮：

```
Workbooks("OtherBook").Worksheets("Sheet1").CommandButton1.Value = True 
```

对于另一个工作簿中的 MSForms 按钮：

```
Application.Run Workbooks("OtherBook").Worksheets("Sheet1").Shapes("Button 1").OnAction 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T22:31:14.550

您可以`Application.Run`为此使用：

```
Run "OtherWorkbook.xls!MyOtherMacro" 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T23:55:31.693

可以直接从您的代码运行链接到该按钮的宏，而不是尝试以编程方式单击该按钮。

首先，您需要找到单击按钮时运行的宏的名称。

为此，请打开包含命令按钮的工作簿。

右键单击命令按钮并选择**“分配宏”**

将显示**“分配宏”**对话框。

在对话框顶部的**“宏名称”**框中记下全名。

单击**确定**按钮。

您的工作簿中需要调用代码的代码应如下所示。

```
Sub Run_Macro()

    Workbooks.Open Filename:="C:\Book1.xls"
'Open the workbook containing the command button
'Change  the path and filename as required

    Application.Run "Book1.xls!Macro1"
'Run the macro 
'Change the filename and macro name as required

'If the macro is attached to a worksheet rather than a module, the code would be
'Application.Run "Book1.xls!Sheet1.Macro1"

End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T22:31:51.037

你确定你的意思是工作簿而不是工作表？无论如何，如果您“[想要遍历文件夹中的所有工作簿并对每个工作簿执行操作](http://www.contextures.com/xlfaqMac.html#LoopBooks)”

如果您想访问另一张工作表，请执行以下操作：

```
Worksheets("MySheet").YourMethod() 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-14T19:29:28.710

不：

这很容易做到：

1.  在您拥有 的工作表 ABC 中`Private Sub xyz_Click()`，添加一个新的公共子例程：

    ```
    Public Sub ForceClickOnBouttonXYZ()
        Call xyz_Click
    End Sub 
    ```

2.  在您的其他工作表或模块中，添加代码：

    ```
    Sheets("ABC").Activate
    Call Sheets("ABC").ForceClickOnBouttonXYZ 
    ```

这就对了！！！如果您不希望屏幕闪烁或显示任何活动，请`Application.ScreenUpdating = False`在调用`Sheets("ABC").ForceClickOnBouttonXYZ`例程之前设置，然后`Application.ScreenUpdating = True`在它之后设置。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-10-01T16:53:27.480

我遇到了与上述类似的问题，花了一段时间才弄清楚，但这就是我所要做的。

在 Sheet1 上，我创建了一个带有以下内容的按钮：

```
 Private Sub cmdRefreshAll_Click()
         Dim SheetName As String

         SheetName = "Mon"
         Worksheets(SheetName).Activate
         ActiveSheet.cmdRefresh_Click

         SheetName = "Tue"
         Worksheets(SheetName).Activate
         ActiveSheet.cmdRefresh_Click

'    "I repeated the above code to loop through a worksheet for every day of the week"

    End Sub 
```

然后导入位使其工作，您需要转到其他工作表上的代码并将其从私有更改为公共。

到目前为止，还没有出现任何错误。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-24T22:53:45.307

没有通过代码执行此操作的干净方法，因为按钮的单击事件通常是其他工作簿的私有方法。

*但是*，您可以通过打开工作簿，找到所需的控件，然后激活它并向其发送空格字符（相当于按下按钮）来自动单击 VBA 代码。

这几乎可以肯定是一个可怕的想法，它可能只会给你和你的后代带来痛苦。我敦促您找到更好的解决方案，但与此同时，这似乎可行...

```
Public Sub RunButton(workbookName As String, worksheetName As String, controlName As String)
    Dim wkb As Workbook
    Dim wks As Worksheet
    Set wkb = Workbooks.Open(workbookName)
    wkb.Activate
    Dim obj As OLEObject
    For Each wks In wkb.Worksheets
        If wks.Name = worksheetName Then
            wks.Activate
            For Each obj In wks.OLEObjects
                If (obj.Name = controlName) Then
                    obj.Activate
                    SendKeys (" ")
                End If
            Next obj
        End If
    Next wks
End Sub 
```

# .net - 用于配置 WCF Webservice 客户端目标端点的配置文件语法

> ID：130169
> 
> 赞同：1
> 
> 时间：2008-09-24T21:46:18.463
> 
> 标签：.net, asp.net, wcf

用于指定 WCF WebService 代理的默认目标端点的 Web 配置语法是什么？

具体来说，我正在尝试配置客户端用于定位 web 服务的 .asmx 的地址

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T21:51:24.067

没关系 - 找到了。
答案是：

设置端点元素的地址属性。

IE`<endpoint address="http://fooland.com/bar.asmx" ... />`

对于像我一样在搜索 MSDN 时遇到挑战的其他人，可以在以下位置找到用于配置客户端端点的其余文档：http: [//msdn.microsoft.com/en-us/library/ms731762 (VS.85).aspx](http://http://msdn.microsoft.com/en-us/library/ms731762(VS.85).aspx)

# xml - 是否有免费/付费网络服务可供我查询以获取 MLS 数据？

> ID：130170
> 
> 赞同：10
> 
> 时间：2008-09-24T21:46:27.963
> 
> 标签：xml, web-services

给定一个[MLS](http://en.wikipedia.org/wiki/Multiple_Listing_Service) #，我想要一个 XML 文档，其中包含有关列表的详细信息，例如地址、价格等。不是 NAR 或 CREA 成员。主要对北美出租物业列表数据感兴趣。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T21:52:16.233

如果您是 NAR 会员，您可以使用他们的 Internet 数据交换 (IDX) 系统，但非会员无法使用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-12-30T16:41:04.263

目前最好的免费资源是 Oodle.com 的 API - [http://developer.oodle.com/oodle-api](http://developer.oodle.com/oodle-api)。它将为您提供出售和出租房屋。

您可以在这里查看他们的列表：[http ://realestate.oodle.com/](http://realestate.oodle.com/)

MLS' 通常不会提供他们的数据。大型租赁网站（rent.com、apartments.com 等）没有 API，但如果您与他们联系并与他们建立业务关系，则确实会提供数据馈送。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T22:21:46.287

**多重上市服务 (MLS)** - 美国和加拿大的房地产系统

对于 mls.ca（加拿大系统），这里有一个有趣的观点（*发布于 2008-08-21*）关于它对公众的*可用性：*

[加拿大房地产经纪人数据卡特尔](http://www.guydavis.ca/log/view.jsp?id=1066)摘录：

> 作为顾问的房地产经纪人也意味着他们可以放松他们的数据卡特尔，也称为多重上市服务。这个销售清单数据库有两个面孔。首先，仅限房地产经纪人的私人视图，显示实时列表以及有关房屋的完整详细信息。MLS 还提供数据的公共视图，但列表有时间延迟（通常按天），并且没有以可搜索的格式提供所有有用的详细信息，例如房屋朝向、地下室是否开发等。直到最近，由于多次提供更好的产品被卡特尔起诉，MLS 甚至添加了交互式地图。他们仍然会延迟公开列表并隐藏许多有用的细节。

# javascript - IE TextRange 选择方法无法正常工作

> ID：130186
> 
> 赞同：7
> 
> 时间：2008-09-24T21:50:36.067
> 
> 标签：javascript, internet-explorer

我在使用 contentEditable 设置为 true 的 IE 文档时遇到了一个不寻常的问题。在位于块元素之前的文本节点末尾的范围上调用 select() 会导致选择向右移动一个字符并出现在不应出现的位置。我已经向微软提交了一个针对 IE8 的错误。如果可以，请为这个问题投票，以便解决。

[https://connect.microsoft.com/IE/feedback/ViewFeedback.aspx?FeedbackID=390995](https://connect.microsoft.com/IE/feedback/ViewFeedback.aspx?FeedbackID=390995)

我写了一个测试用例来演示效果：

```
<html>
  <body>
    <iframe id="editable">
      <html>
        <body>
          <div id="test">
            Click to the right of this line -&gt;
            <p id="par">Block Element</p>
          </div>
        </body>
      </html>
    </iframe>
    <input id="mytrigger" type="button" value="Then Click here to Save and Restore" />
    <script type="text/javascript">
        window.onload = function() {
            var iframe = document.getElementById('editable');
            var doc = iframe.contentDocument || iframe.contentWindow.document;

            // An IFRAME without a source points to a blank document.  Here we'll
            // copy the content we stored in between the IFRAME tags into that
            // document.  It's a hack to allow us to use only one HTML file for this
            // test.
            doc.body.innerHTML = iframe.textContent || iframe.innerHTML;

            // Marke the IFRAME as an editable document
            if (doc.body.contentEditable) {
                doc.body.contentEditable = true;
            } else {
                var mydoc = doc;
                doc.designMode = 'On';
            }

            // A function to demonstrate the bug.
            var myhandler = function() {
                // Step 1 Get the current selection
                var selection = doc.selection || iframe.contentWindow.getSelection();
                var range = selection.createRange ? selection.createRange() : selection.getRangeAt(0);

                // Step 2 Restore the selection
                if (range.select) {
                    range.select();
                } else {
                    selection.removeAllRanges();
                    selection.addRange(range);
                    doc.body.focus();
                }
            }

            // Set up the button to perform the test code.
            var button = document.getElementById('mytrigger');
            if (button.addEventListener) {
                button.addEventListener('click', myhandler, false);
            } else {
                button.attachEvent('onclick', myhandler);
            }
          }
    </script>
  </body>
</html> 
```

这个问题暴露在 myhandler 函数中。这就是我所做的一切，在保存和恢复选择之间没有第 3 步，但是光标移动了。除非选择为空（即我有一个闪烁的光标，但没有文本），否则它似乎不会发生，并且它似乎只发生在光标位于紧接在块节点之前的文本节点的末尾时。

似乎该范围仍然在正确的位置（如果我在它返回 div 的范围上调用 parentElement），但是如果我从当前选择中获得一个新范围，则新范围在段落标记内，这就是它父元素。

**如何解决此问题并始终保存和恢复 Internet Explorer 中的选择？**

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-05T22:48:10.040

我已经想出了一些处理这样的 IE 范围的方法。

如果你只想保存光标所在的位置，然后恢复它，你可以使用 pasteHTML 方法在光标的当前位置插入一个空 span，然后使用 moveToElementText 方法将它放回到那个位置再次：

```
// Save position of cursor
range.pasteHTML('<span id="caret"></span>')

...

// Create new cursor and put it in the old position
var caretSpan = iframe.contentWindow.document.getElementById("caret");
var selection = iframe.contentWindow.document.selection;
newRange = selection.createRange();
newRange.moveToElementText(caretSpan); 
```

或者，您可以计算当前光标位置之前的字符数并保存该数字：

```
var selection = iframe.contentWindow.document.selection;
var range = selection.createRange().duplicate();
range.moveStart('sentence', -1000000);
var cursorPosition = range.text.length; 
```

要恢复光标，请将其设置为开头，然后将其移动该字符数：

```
var newRange = selection.createRange();
newRange.move('sentence', -1000000);
newRange.move('character', cursorPosition); 
```

希望这可以帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-05T00:44:24.607

我进行了一些研究，不幸的是看不到解决方法...尽管我在调试 javascript 时注意到了一件事，但似乎问题实际上出在范围对象本身而不是后续的`range.select()`. 如果您查看`selection.createRange()`返回的范围对象上的值，是的，父 dom 对象可能是正确的，但定位信息已经指向下一行的开头（即 offsetLeft/Top、boundingLeft/Top 等已经错误）。

根据[此处](http://www.quirksmode.org/dom/range_intro.html)、[此处](http://www.quirksmode.org/dom/w3c_range.html)和[此处](http://msdn.microsoft.com/en-us/library/ms535872(VS.85).aspx)的信息，我认为您对 IE 不走运，因为您只能访问 Microsoft 的 TextRange 对象，该对象似乎已损坏。根据我的实验，您可以移动范围并将其准确定位在应有的位置，但是一旦您这样做，范围对象甚至在您尝试之前自动向下移动到下一行`.select()`。例如，您可以通过将此代码放在第 1 步和第 2 步之间来查看问题：

```
if (range.boundingWidth == 0)
{
    //looks like its already at the start of the next line down...
    alert('default position: ' + range.offsetLeft + ', ' + range.offsetTop);
    //lets move the start of the range one character back
    //(i.e. select the last char on the line)
    range.moveStart("character", -1);
    //now the range looks good (except that its width will be one char);
    alert('one char back: ' + range.offsetLeft + ', ' + range.offsetTop);
    //calculate the true end of the line...
    var left = range.offsetLeft + range.boundingWidth;
    var top = range.offsetTop;
    //now we can collapse back down to 0 width range
    range.collapse();
    //the position looks right
    alert('moving to: ' + left + ', ' + top);
    //move there.
    range.moveToPoint(left, top);
    //oops... on the next line again... stupid IE.
    alert('moved to: ' + range.offsetLeft + ', ' + range.offsetTop);
} 
```

因此，不幸的是，当您再次选择范围时，似乎没有任何方法可以确保范围在正确的位置。

显然，通过将第 2 步更改为：

```
// Step 2 Restore the selection
if (range.select) {
    if (range.boundingWidth > 0) {
        range.select();
    }
} else {
    selection.removeAllRanges();
    selection.addRange(range);
    doc.body.focus();
} 
```

但据推测，您实际上想要在实际中的第 1 步和第 2 步之间做一些事情，这涉及移动选择，因此需要重新设置它。但以防万一。:)

所以，我能做的最好的就是去投票给你创建的错误......希望他们能修复它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T15:49:20.813

我最近在一个使用 Microsoft CMS 和“MSIB+ 包”控件的站点工作，其中包括在 Internet Explorer 中运行的所见即所得编辑器。

我似乎记得编辑器客户端 Javascript 中的一些评论，这些评论与 IE 中的这个错误和 Range.Select() 方法特别相关。

不幸的是，我不再在那里工作，所以我无法访问 Javascript 文件，但也许您可以从其他地方获取它们？

祝你好运

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-06T10:36:58.353

也许我误解了，但是如果我单击第一行的右侧，我的光标已经立即出现在第二行的开头，所以这不是 TextRange 问题，对吧？

添加一个文档类型，以便测试页面以标准模式呈现，而不是怪癖模式为我解决了这个问题。

而且我无法重现您的 myhandler 函数所做的事情，因为单击该按钮会将焦点移到该按钮上，因此我无法再看到光标并且也无法将其取回。*在contentEditable*区域中查找光标位置[似乎完全是一个不同的问题](http://www.google.com/search?q=ie+cursor+position+contenteditable)。

# sql - 我怎样才能改变这种看法？

> ID：130187
> 
> 赞同：-1
> 
> 时间：2008-09-24T21:50:43.007
> 
> 标签：sql, views

我想索引这个视图，但因为它有子查询我不能索引。任何人都可以建议如何更改此视图以便我可以索引它。

```
ALTER VIEW [dbo].[Recon2]
WITH SCHEMABINDING
AS
SELECT     
dbo.Transactions.CustomerCode, 
dbo.Customer_Master.CustomerName, 
dbo.Transactions.TransDate, 
dbo.Transactions.PubCode, 
dbo.Transactions.TransType, 
dbo.Transactions.Copies, 
SUM(dbo.Transactions.TotalAmount) AS TotalAmount, 
'0' AS ReceiptNo, 
'2008-01-01' AS PaymentDate, 
0 AS Amount, 
dbo.Transactions.Period, 
dbo.Transactions.Year, 
dbo.Publication_Master.PubName, 
dbo.Customer_Master.SalesCode,
COUNT_BIG(*) AS COUNT
FROM         
dbo.Publication_Master INNER JOIN
dbo.Customer_Master INNER JOIN
dbo.Transactions ON dbo.Customer_Master.CustomerCode = dbo.Transactions.CustomerCode ON 
dbo.Publication_Master.PubCode = dbo.Transactions.PubCode
WHERE     
(dbo.Customer_Master.CustomerCode NOT IN
(SELECT     CustomerCode
 FROM       dbo.StreetSaleRcpt
 WHERE      (PubCode = dbo.Transactions.PubCode) AND 
            (TransactionDate = dbo.Transactions.TransDate) AND 
            (Updated = 1) AND 
            (PeriodMonth = dbo.Transactions.Period) AND 
            (PeriodYear = dbo.Transactions.Year)))
GROUP BY dbo.Transactions.CustomerCode, dbo.Customer_Master.CustomerName, dbo.Transactions.TransDate, dbo.Transactions.PubCode, 
                      dbo.Publication_Master.PubName, dbo.Customer_Master.SalesCode, dbo.Transactions.[Update], dbo.Transactions.TransType, 
                      dbo.Transactions.Copies, dbo.Transactions.Period, dbo.Transactions.Year, dbo.Transactions.TotalAmount 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T22:12:28.400

我无法运行它（显然）但是这个呢？：

```
SELECT
dbo.Transactions.CustomerCode, 
dbo.Customer_Master.CustomerName, 
dbo.Transactions.TransDate, 
dbo.Transactions.PubCode, 
dbo.Transactions.TransType, 
dbo.Transactions.Copies, 
'0' AS ReceiptNo, 
'2008-01-01' AS PaymentDate, 
0 AS Amount, 
dbo.Transactions.Period, 
dbo.Transactions.Year, 
dbo.Publication_Master.PubName, 
dbo.Customer_Master.SalesCode, 
dbo.StreetSaleRcpt.CustomerCode,
SUM(dbo.Transactions.TotalAmount) AS TotalAmount, 
COUNT_BIG(*) AS COUNT 
FROM dbo.Publication_Master 
INNER JOIN dbo.Customer_Master ON dbo.Customer_Master.CustomerCode = dbo.Transactions.CustomerCode 
INNER JOIN dbo.Transactions ON dbo.Publication_Master.PubCode = dbo.Transactions.PubCode 
LEFT OUTER JOIN dbo.StreetSaleRcpt ON (
    dbo.StreetSaleRcpt.PubCode = dbo.Transactions.PubCode 
    AND dbo.StreetSaleRcpt.TransactionDate = dbo.Transactions.TransDate
    AND dbo.StreetSaleRcpt.PeriodMonth = dbo.Transactions.Period
    AND dbo.StreetSaleRcpt.PeriodYear = dbo.Transactions.Year
    AND dbo.StreetSaleRcpt.Updated = 1
    AND dbo.StreetSaleRcpt.CustomerCode = dbo.Customer_Master.CustomerCode
)
WHERE dbo.StreetSaleRcpt.CustomerCode IS NULL
GROUP BY 
dbo.Transactions.CustomerCode, 
dbo.Customer_Master.CustomerName, 
dbo.Transactions.TransDate, 
dbo.Transactions.PubCode, 
dbo.Publication_Master.PubName, 
dbo.Customer_Master.SalesCode, 
dbo.Transactions.[Update], 
dbo.Transactions.TransType, 
dbo.Transactions.Copies, 
dbo.Transactions.Period, 
dbo.Transactions.Year, 
dbo.Transactions.TotalAmount,
dbo.StreetSaleRcpt.CustomerCode 
```

使您的相关子查询成为左连接并测试其缺失（'WHERE dbo.StreetSaleRcpt.CustomerCode IS NULL'）与'NOT IN'。

祝你好运。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T22:22:57.533

至少在 Oracle 中，您可以从 VIEW 更改为 MATERIALIZED VIEW。还有一些其他问题，如表空间和同步方法需要考虑，但可能值得探索。

根据您的应用程序，另一种选择是基于此视图的选择创建一个普通表，并以可接受的间隔更新它或使用大量外键。

什么是最实用的取决于许多因素——表大小、更新频率、对最新数据的需求等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T11:30:41.150

此表单将允许在 StreetSaleRcpt 上为每个 Publication_Master 行使用索引：

```
ALTER VIEW [dbo].[Recon2] WITH SCHEMABINDING AS SELECT
dbo.Transactions.CustomerCode, dbo.Customer_Master.CustomerName, dbo.Transactions.TransDate, dbo.Transactions.PubCode, dbo.Transactions.TransType, dbo.Transactions.Copies, SUM(dbo.Transactions.TotalAmount) AS TotalAmount, '0' AS ReceiptNo, '2008-01-01' AS PaymentDate, 0 AS Amount, dbo.Transactions.Period, dbo.Transactions.Year, dbo.Publication_Master.PubName, dbo.Customer_Master.SalesCode, COUNT_BIG(*) AS COUNT
FROM dbo.Publication_Master 
INNER JOIN dbo.Customer_Master 
INNER JOIN dbo.Transactions ON dbo.Customer_Master.CustomerCode = dbo.Transactions.CustomerCode ON dbo.Publication_Master.PubCode = dbo.Transactions.PubCode 
WHERE
(NOT EXISTS 
   (SELECT NULL FROM dbo.StreetSaleRcpt 
   WHERE (PubCode = dbo.Transactions.PubCode) 
   AND (TransactionDate = dbo.Transactions.TransDate) 
   AND (Updated = 1)
   AND (PeriodMonth = dbo.Transactions.Period) 
   AND (PeriodYear = dbo.Transactions.Year)
   ANMD (CustomerCode = dbo.Customer_Master.CustomerCode)
   )
) GROUP BY dbo.Transactions.CustomerCode, dbo.Customer_Master.CustomerName, dbo.Transactions.TransDate, dbo.Transactions.PubCode, dbo.Publication_Master.PubName, dbo.Customer_Master.SalesCode, dbo.Transactions.[Update], dbo.Transactions.TransType, dbo.Transactions.Copies, dbo.Transactions.Period, dbo.Transactions.Year, dbo.Transactions.TotalAmount 
```

# database-design - 在关系数据库中表达 is-a 关系

> ID：130192
> 
> 赞同：3
> 
> 时间：2008-09-24T21:52:01.897
> 
> 标签：database-design, schema, relational, oop

我想知道是否有一种干净的方式来表示 is-a 关系，如下例所示：

该数据库存储三种类型节目的录制时间：电影、游戏节目、戏剧。在面向对象的意义上，这些中的每一个都是一个程序。这些子类中的每一个都有不同的属性。以下是表格（fk 前缀表示外键）：

*电影*
ID
名称
fkDirector

*gameShow*
id
name
fkHost
fkContestant

*剧* 名
_

在 OO 术语中，记录表看起来像这样：

*record*
id
fkProgram
startTime
endTime

在不违反常规形式的情况下，我能想到的唯一方法是拥有三个记录表，即 *recordMovie*、*recordGameShow*和*recordDrama*。

有没有办法在不违反数据库规范化原则的情况下将这些表合并为一个？

以下是一些无效的示例来说明这个想法：

*程序*
id
fkMovie
fkGameShow
fkDrama

该表违反了第一范式，因为它将包含空值。对于每一行，3 个条目中只有一个不为空。

*program*
id
fkSpecific ← fkMovie OR fkGameShow OR fkDrama
fkType ← 将指示要查看的表

在这里，我将无法强制执行参照完整性，因为 fkSpecific 可能指向三个表之一。

我只是想节省在这里有 3 个表而不是一个的开销。也许这根本不适用于 RDB。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T21:55:59.687

是的，那应该是一张桌子

```
Programs:
   id,
   name,
   type_id,
   length,
   etc... 
```

如果有与该类型相关的其他数据位，则带有程序类型的参考表：

```
ProgramType
   type_id,
   type_name,
   etc... 
```

像那样。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T23:02:06.830

为什么要将所有数据存储在一个表中？它们显然是不同的实体。您对主*Record*表的想法，以及辅助*recordMovie*、*recordGameShow*和*RecordDrama*。

要强制辅助表和主表之间的“is-a”关系，您需要将 Record.id 声明为所有这些表中的外键，并为其添加一个约束以使其唯一 - 这会强制执行一对一的关系，它将这些表转换为主表的扩展。

您还需要在主记录表中添加一个新字段以指示它是哪种记录（电影、游戏节目、戏剧，还是其他？）。这可以是对另一个表（RecordTypes？）的外键引用，也可以是字符串（在它可以接受的值上定义了一个约束）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-08T05:44:35.997

在“泛化专业化关系建模”上进行谷歌搜索。

“gen-spec”模型遵循与“is-a”关系相同的模式。

例如，汽车是专用车辆。卡车是一种不同的专用车辆。摩托车是第三种专用车辆。

你应该找到很多文章。

有趣的是，如果您只是在“gen-spec”上进行谷歌搜索，那么最重要的链接之一就是 Smalltalk 中对 gen-spec 建模的描述。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T21:57:33.180

这是许多人以前面临的一个相当标准的问题，您可能考虑的所有方法可能已经在某一时刻完成。

一个[简单的谷歌搜索](http://www.google.com/search?client=safari&rls=en-us&q=inheritance+in+relational+databases)就可以很好地解释每种方法的优缺点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T14:43:47.893

这些都是关于这个主题的好文章：http:
[//www.ibm.com/developerworks/library/ws-mapping-to-rdb/](http://www.ibm.com/developerworks/library/ws-mapping-to-rdb/)
[http://www.agiledata.org/essays/mappingObjects.html](http://www.agiledata.org/essays/mappingObjects.html)

这就是我最终要做的。我的程序表将是：

*节目*
编号

然后我将 fkProgram 添加到每个子类（戏剧、游戏节目和电影）中。这样，程序表将成为子类之间的中间表。我可以使用 Program 表的外键来引用任何子类的实例。这将允许我有一个单一的记录表并且不违反任何正常形式。

*电影*
id fk 节目 名称
fkDirector

*记录*
id
fkProgram
startTime
endTime

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T22:07:04.777

我的第一个想法也是为电影、节目和戏剧使用一个节目表。然后添加一个 ProgramType 表并像父帖子一样对其使用外键。

可以添加其他列，例如 fkDirector、fkMovie。然后添加一个约束，当 ProgramType 是电影时，fkDirector 不能为空，或者当它是节目时，fkHost 不能为空。

这允许轻松查找在开始和结束日期之间记录的所有电影/节目/...。还要确保填写所有数据并且参考正确。

有人有更好的主意吗？

# windows - 是否可以通过 .bat/.cmd 脚本修改注册表项？

> ID：130193
> 
> 赞同：50
> 
> 时间：2008-09-24T21:52:10.540
> 
> 标签：windows, batch-file, cmd, automation, registry

是否可以通过 .bat/.cmd 脚本修改注册表值（无论是字符串还是 DWORD）？

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2008-10-04T13:26:36.420

@Franci Penov -在**覆盖的意义上修改****是**可能的，例如 **`/f`**

 **```
reg add "HKCU\Software\etc\etc" /f /v "value" /t REG_SZ /d "Yes" 
```

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2008-09-24T21:54:20.847

您可以使用 REG 命令。来自[http://www.ss64.com/nt/reg.html](http://www.ss64.com/nt/reg.html)：

```
Syntax:

   REG QUERY [ROOT\]RegKey /v ValueName [/s]
   REG QUERY [ROOT\]RegKey /ve  --This returns the (default) value

   REG ADD [ROOT\]RegKey /v ValueName [/t DataType] [/S Separator] [/d Data] [/f]
   REG ADD [ROOT\]RegKey /ve [/d Data] [/f]  -- Set the (default) value

   REG DELETE [ROOT\]RegKey /v ValueName [/f]
   REG DELETE [ROOT\]RegKey /ve [/f]  -- Remove the (default) value
   REG DELETE [ROOT\]RegKey /va [/f]  -- Delete all values under this key

   REG COPY  [\\SourceMachine\][ROOT\]RegKey [\\DestMachine\][ROOT\]RegKey

   REG EXPORT [ROOT\]RegKey FileName.reg
   REG IMPORT FileName.reg
   REG SAVE [ROOT\]RegKey FileName.hiv
   REG RESTORE \\MachineName\[ROOT]\KeyName FileName.hiv

   REG LOAD FileName KeyName
   REG UNLOAD KeyName

   REG COMPARE [ROOT\]RegKey [ROOT\]RegKey [/v ValueName] [Output] [/s]
   REG COMPARE [ROOT\]RegKey [ROOT\]RegKey [/ve] [Output] [/s]

Key:
   ROOT :
         HKLM = HKey_Local_machine (default)
         HKCU = HKey_current_user
         HKU  = HKey_users
         HKCR = HKey_classes_root

   ValueName : The value, under the selected RegKey, to edit.
               (default is all keys and values)

   /d Data   : The actual data to store as a "String", integer etc

   /f        : Force an update without prompting "Value exists, overwrite Y/N"

   \\Machine : Name of remote machine - omitting defaults to current machine.
                Only HKLM and HKU are available on remote machines.

   FileName  : The filename to save or restore a registry hive.

   KeyName   : A key name to load a hive file into. (Creating a new key)

   /S        : Query all subkeys and values.

   /S Separator : Character to use as the separator in REG_MULTI_SZ values
                  the default is "\0" 

   /t DataType  : REG_SZ (default) | REG_DWORD | REG_EXPAND_SZ | REG_MULTI_SZ

   Output    : /od (only differences) /os (only matches) /oa (all) /on (no output) 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2008-09-24T21:54:50.127

`reg`是的，您可以使用该命令编写脚本。例子：

```
reg add HKCU\Software\SomeProduct
reg add HKCU\Software\SomeProduct /v Version /t REG_SZ /d v2.4.6 
```

这将创建 key `HKEY_CURRENT_USER\Software\SomeProduct`，并向该键添加一个名为“Version”的字符串值“v2.4.6”。

`reg /?`有详细信息。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2016-05-29T15:41:40.173

这是您可以修改注册表的方式，无需提示是或否，并且不要忘记以管理员身份运行

```
reg add HKEY_CURRENT_USER\Software\Microsoft\Windows\Shell\etc\etc   /v Valuename /t REG_SZ /d valuedata  /f 
```

下面是一个将 Internet Explorer 设置为我的默认浏览器的真实示例

```
reg add HKEY_CURRENT_USER\Software\Microsoft\Windows\Shell\Associations\UrlAssociations\https\UserChoice   /v ProgId /t REG_SZ /d IE.HTTPS  /f 
```

> /f Force：强制更新而不提示“值存在，覆盖 Y/N”
> 
> /d 数据：存储为“字符串”、整数等的实际数据
> 
> /v Value : 值名称，例如 ProgId
> 
> /t 数据类型：REG_SZ（默认）| REG_DWORD | REG_EXPAND_SZ | REG_MULTI_SZ

了解有关读取、设置或删除注册表项和值、从 .REG 文件保存和恢复的更多信息。从[这里](http://ss64.com/nt/reg.html)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-24T21:54:32.390

您可以制作一个 .reg 文件并在其上调用 start。您可以将注册表的任何部分导出为 .reg 文件以查看格式。

格式在这里：

[http://support.microsoft.com/kb/310516](http://support.microsoft.com/kb/310516)

这可以在任何 Windows 机器上运行而无需安装其他软件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-24T21:56:03.790

是的。您可以使用操作系统自带的reg.exe来添加、删除或查询注册表值。Reg.exe 没有明确的修改命令，但您可以通过删除然后添加来完成。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T22:23:39.217

除了 reg.exe，我强烈建议您还检查一下 powershell，它在注册表处理方面的功能要强大得多。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-09-24T21:54:20.767

见[http://www.chaminade.org/MIS/Articles/RegistryEdit.htm](http://www.chaminade.org/MIS/Articles/RegistryEdit.htm)

# .net - 从其名称实例化泛型的最佳方法是什么？

> ID：130208
> 
> 赞同：3
> 
> 时间：2008-09-24T21:55:38.660
> 
> 标签：.net, vb.net, generics, reflection, .net-2.0

假设我只有一个泛型的类名作为“MyCustomGenericCollection(of MyCustomObjectClass)”形式的字符串，并且不知道它来自哪个程序集，那么创建该对象实例的最简单方法是什么？

如果有帮助，我知道该类实现了 IMyCustomInterface 并且来自加载到当前 AppDomain 的程序集。

Markus Olsson 在[这里](https://stackoverflow.com/questions/31238/c-instantiating-classes-from-xml)给出了一个很好的例子，但我不知道如何将它应用于泛型。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-24T22:04:08.280

解析后，使用[Type.GetType(string)](http://msdn.microsoft.com/en-us/library/w3f99sx1.aspx)获取对所涉及类型的引用，然后使用[Type.MakeGenericType(Type[])](http://msdn.microsoft.com/en-us/library/system.type.makegenerictype.aspx)构造您需要的特定泛型类型。然后，使用[Type.GetConstructor(Type[])](http://msdn.microsoft.com/en-us/library/system.type.getconstructor.aspx)获取对特定泛型类型的构造函数的引用，最后调用[ConstructorInfo.Invoke](http://msdn.microsoft.com/en-us/library/6ycw1y17.aspx)获取对象的实例。

```
Type t1 = Type.GetType("MyCustomGenericCollection");
Type t2 = Type.GetType("MyCustomObjectClass");
Type t3 = t1.MakeGenericType(new Type[] { t2 });
ConstructorInfo ci = t3.GetConstructor(Type.EmptyTypes);
object obj = ci.Invoke(null); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T22:07:05.933

MSDN 文章[如何：使用反射检查和实例化泛型类型](http://msdn.microsoft.com/en-us/library/b8ytshk6.aspx)描述了如何使用反射来创建泛型类型的实例。将它与 Marksus 的示例结合使用应该有望帮助您入门。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T22:05:20.570

如果你不介意翻译成 VB.NET，这样的东西应该可以工作

```
foreach (Assembly assembly in AppDomain.CurrentDomain.GetAssemblies())
{
    // find the type of the item
    Type itemType = assembly.GetType("MyCustomObjectClass", false);
    // if we didnt find it, go to the next assembly
    if (itemType == null)
    {
        continue;
    }
    // Now create a generic type for the collection
    Type colType = assembly.GetType("MyCusomgGenericCollection").MakeGenericType(itemType);;

    IMyCustomInterface result = (IMyCustomInterface)Activator.CreateInstance(colType);
    break;
} 
```

# algorithm - 什么是压缩被阻止文件中记录的好算法？

> ID：130227
> 
> 赞同：3
> 
> 时间：2008-09-24T22:01:19.690
> 
> 标签：algorithm, language-agnostic, np-complete, defragmentation, knapsack-problem

假设您有一个由一堆固定大小的块组成的大文件。这些块中的每一个都包含一些可变大小的记录。每条记录必须完全适合单个块，然后根据定义，这些记录永远不会大于完整块。随着时间的推移，记录在这些块中添加和删除，因为记录来自这个“数据库”。

在某些时候，尤其是在可能将许多记录添加到数据库并删除了一些记录之后 - 许多块可能最终只被部分填充。

什么是一个好的算法来打乱这个数据库中的记录，通过更好地填充部分填充的块来压缩文件末尾不必要的块？

算法要求：

*   必须在原始文件的位置进行压缩，而不是暂时将文件从其起始大小最多扩展几个块
*   该算法不应不必要地干扰已经基本满的块
*   必须一次从文件读取或写入整个块，并且应该假设写入操作相对昂贵
*   如果记录从一个块移动到另一个块，则必须在从其起始位置删除之前将它们添加到新位置，以便在操作中断时不会因“失败”压缩而丢失记录。（假设这种记录的临时重复可以在恢复时检测到）。
*   可用于此操作的内存可能只有几个块的数量级，这仅占整个文件大小的很小百分比
*   假设记录大约为 10 字节到 1K 字节，平均大小可能为 100 字节。固定大小的块大约为 4K 或 8K，文件大约为 1000 个块。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T22:29:40.857

如果这些记录没有排序，我只需用从最后一个块中提取的记录填充前面的块。这将最大限度地减少数据的移动，相当简单，并且应该可以很好地打包数据。

例如：

```
// records should be sorted by size in memory (probably in a balanced BST)
records = read last N blocks on disk;

foreach (block in blocks) // read from disk into memory
{
    if (block.hasBeenReadFrom())
    {
        // we read from this into records already
        // all remaining records are already in memory

        writeAllToNewBlocks(records);

        // this will leave some empty blocks on the disk that can either
        // be eliminated programmatically or left alone and filled during
        // normal operation

        foreach (record in records)
        {
            record.eraseFromOriginalLocation();
        }

        break;
    }

    while(!block.full())
    {
        moveRecords = new Array; // list of records we've moved

        size = block.availableSpace();
        record = records.extractBestFit(size);
        if (record == null)
        {
            break;
        }

        moveRecords.add(record);
        block.add(record);

        if (records.gettingLow())
        {
            records.readMoreFromDisk();
        }
    }

    if(moveRecords.size() > 0)
    {
        block.writeBackToDisk();
        foreach (record in moveRecords)
        {
            record.eraseFromOriginalLocation();
        }
    }
} 
```

更新：我忽略了保持 no-blocks-only-in-memory 规则。我已经更新了伪代码来解决这个问题。还修复了我的循环条件中的故障。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T22:54:37.580

这听起来像是[装箱问题](http://en.wikipedia.org/wiki/Bin_packing_problem)的变体，但是您已经有了想要改进的劣质分配。因此，我建议查看成功解决装箱问题的方法的变体。

首先，您可能希望通过定义您认为“足够满”（块足够满以至于您不想触摸它）和“太空”（块有如此多的空白空间，以至于必须添加更多记录）。然后，您可以将所有块分类为足够满、太空或部分满（那些既不够满也不是太空）。然后，您将问题重新定义为如何通过创建尽可能多的足够满的块同时最小化部分满的块的数量来消除所有太空的块。

您还需要弄清楚更重要的事情：将记录放入尽可能少的块中，或者将它们充分打包但读取和写入的块数量最少。

我的方法是对所有块进行初始传递，将它们全部分类为上面定义的三个类之一。对于每个块，您还希望跟踪其中的可用空间，对于太空的块，您将需要一个所有记录及其大小的列表。然后，从太空块中的最大记录开始，将它们移动到部分满的块中。如果您想最小化读取和写入，请将它们移动到您当前在内存中的任何块中。如果要尽量减少浪费的空间，请找到仍保留记录的具有最少空白空间的块，必要时读入该块。如果没有块将保存记录，则创建一个新块。如果内存中的块达到“足够满”阈值，则将其写出。

我跳过了很多细节，但这应该会给你一些想法。请注意，装箱问题是[NP-hard](http://en.wikipedia.org/wiki/NP-hard)问题，这意味着对于实际应用，您需要决定什么对您最重要，因此您可以选择一种在合理时间内为您提供近似最佳解决方案的方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T08:10:08.807

在线（一次进行碎片整理）有界空间（内存要求）装箱算法的修改可能在这里起作用。

请参阅Coffman 等人的[“装箱近似算法：组合分析”](http://www.ee.columbia.edu/~egc/webpapers/survbpp5.pdf)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T00:35:22.253

这是您可能能够利用的算法，尽管您在固定大小的块中的记录可能需要更多的工作。

[有限时间内的堆碎片整理](http://cse.seas.wustl.edu/techreportfiles/getreport.asp?384)

# php - 是否可以在没有 shell 访问权限的情况下进行 SVN 导出？

> ID：130233
> 
> 赞同：1
> 
> 时间：2008-09-24T22:02:04.807
> 
> 标签：php, svn, export

我开始在我的一个项目中使用 subversion，如果我可以通过例如运行 php 或 perl 脚本从生产服务器上的存储库中导出最新版本，那将是绝对惊人的。

生产站点由不允许 shell 访问或例如 php[`exec()`](http://www.php.net/manual/en/function.exec.php)函数的共享托管提供商托管。（我不太了解 perl；我只知道我的主机允许 perl 和自定义 cgi 脚本）。

是否可以在此环境中执行 SVN 导出？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T22:12:50.333

据我所知，没有完全用 PHP 或 Perl 编写的 SVN 客户端。所以没有 exec 你就不走运了。

解决方法：

*   根据您自己的操作系统和访问 Web 空间的方法，您可以将 Web 空间挂载到本地文件系统中，然后使用系统的 SVN 客户端进行签出/更新。
*   再次根据您的访问方法（我猜是 ftp 或 sftp），您可能会更新本地结帐并将任何更改同步到网络空间。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T22:07:31.783

SVN 支持通过 WebDAV（即 HTTPS）访问。这意味着对于简单的读取访问，您实际上不需要 SVN 客户端来访问 SVN 存储库。您甚至可以使用 Web 浏览器，或者在您的情况下使用任何接受 URL 作为其参数的 PHP 函数。SVN 必须在服务器端设置才能与 apache 一起使用，有关更多信息，请查看[svn 红皮书](http://svnbook.red-bean.com/en/1.5/svn.serverconfig.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-07T21:58:25.227

看看这个：

[http://www.randomsequence.com/articles/svn-backup-script/](http://www.randomsequence.com/articles/svn-backup-script/)

当然，你仍然需要 exec ，但正如所说，在 PHP 中编写一些对你的 svn 服务器运行 http 调用的东西并不难。

或者，类似：

palaniraja.wordpress.com/2008/09/20/svn-export-only-updated-files-between-2-revisions/

干杯!

# c++ - 如何为我的开源应用程序打包 Linux 二进制文件？

> ID：130237
> 
> 赞同：6
> 
> 时间：2008-09-24T22:03:25.817
> 
> 标签：c++, linux, binary, publish

我有一个开源应用程序，我目前只发布 Windows 构建的二进制文件。此时 Linux 用户必须获取源代码并进行编译。是否有发布 Linux 二进制文件的标准方法？

我的应用程序是 c / c++ 并使用 gcc 编译的，我使用的唯一外部 Linux 代码是 X Windows 和 CUPS。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T22:07:42.250

最常见的方法是将其打包在[.rpm 文件](http://en.wikipedia.org/wiki/RPM_Package_Manager)中，用于基于[RedHat](http://www.redhat.com/)的发行版（如[Fedora](http://fedoraproject.org/)），或[.deb 文件](http://en.wikipedia.org/wiki/Deb_(file_format))用于基于[Debian](http://www.debian.org/)的发行版（如[Ubuntu](http://www.ubuntu.com/)）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T22:09:59.623

找一个熟悉 Debian 的人，并得到他们的帮助来建立一个构建过程来为 Debian 和 Ubuntu 构建 .deb 包。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T22:21:01.983

当然：看看IBM 的[这个教程](http://www-128.ibm.com/developerworks/library/l-rpm1/)。它仅适用于 RPM，但至少可以让您继续前进。DEB 文件类似 - 请参阅[本教程](http://www.ibm.com/developerworks/linux/library/l-debpkg.html)。

基本上，一旦你构建了你的二进制文件，你就可以编写一个控制文件来描述包中包含哪些文件，以及将它们放在哪里。然后，您使用打包工具将所有内容构建到一个包中。它很像 Windows，您在其中编写安装程序文件，然后通过 Wix 或 Intellishield 或其他任何方式运行它以创建 .msi 文件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T03:01:19.097

不要犹豫，在 Debian 的错误跟踪系统上提交请求包 (RFP) 错误。debian 开发人员可能会对您的软件感兴趣并将其打包。

[http://www.debian.org/Bugs/Reporting](http://www.debian.org/Bugs/Reporting)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T06:30:11.637

您可以自己提供软件包，但这不是分发应用程序的理想方式。用户将无法在其发行版的软件包存储库中找到您的软件，并且必须访问您的网站以下载最新版本。

IMO 最好的办法是为您选择的发行版寻求包维护者的帮助。让其中一个对您的应用程序感兴趣的人采用它并将其引入发行版，然后他们可以处理打包它的发行版特定细节。

您的角色将是尽可能帮助他们让您的软件在他们的平台上构建，并解决与其他软件包版本交互相关的任何错误等。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T22:07:55.150

我只使用我的发行版中的预编译二进制文件——从不使用其他手。如果您负担得起，只需滚动一个 tarball 并添加一些构建脚本，以便人们可以构建您的项目。要发布它，请将其添加到以下网站：[Freshmeat](http://www.freshmeat.net)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-25T01:05:02.603

编辑：以下是一些制作可移植 Linux 二进制文件的重要指南——

*   [如何创建可移植的 Linux 二进制文件](https://blog.gibson.sh/2017/11/26/creating-portable-linux-binaries/)，包含
    *   可移植性和向后兼容性要求
    *   动态库介绍
    *   Linux 上的符号版本控制
*   [便携式Linux二进制文件](https://evan-jones.appspot.com/portable-linux-binaries.html)，包含
    *   常见问题
    *   避免这些的方法
*   [Linux 游戏开发 - 第 2 部分](http://www.gamedev.net/reference/programming/features/linuxprogramming2/)

# php - 我可以在 PHP 中使用生成的变量名吗？

> ID：130240
> 
> 赞同：1
> 
> 时间：2008-09-24T22:03:57.483
> 
> 标签：php

我有一堆我想加在一起的值，它们被输入到一个表单中。目前，表格有 11 行，但将来可能会变得更大。我可以轻松地将所有值与以下内容相加：

```
$total = $value1 + $value2 + ... + $value11; 
```

我想加在一起的所有值都来自一个`HTML`表单。我想避免使用 JavaScript。

但是，我想避免手动操作，尤其是当它变得更大时。这是我尝试使用循环将所有值相加，但它返回“未定义变量”错误（这只是一些测试代码来尝试这个想法）：

```
<?php

$tempTotal = 0;

$pBalance1 = 5;
$pBalance2 = 5;
$pBalance3 = 5;

for  ($i = 1 ; $i <= 3 ; $i++){
    $tempTotal = $tempTotal + $pBalance.$i;
}

echo $tempTotal;

?> 
```

我想在 PHP 中做的事情是可能的吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-24T22:05:12.457

```
for  ($i = 1 ; $i <= 3 ; $i++){
    $varName = "pBalance".$i;
    $tempTotal += $$varName;
} 
```

这将做你想要的。但是，您可能确实会考虑为这种事情使用数组。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-24T22:12:25.280

我会使用@unexist 的解决方案.. 输入字段名称如下：

```
<input name="myInput[]" />
<input name="myInput[]" />
<input name="myInput[]" />
... 
```

然后在你的 PHP 中得到这样的总和：

```
$total = array_sum($_REQUEST['myInput']); 
```

由于每个输入名称末尾的 '[]'，PHP 将自动使 $_REQUEST['myInput'] 成为一个数组。PHP的一个方便的功能！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T22:05:00.947

嗯，你为什么不使用数组？如果您给表单起一个名称，如 foobar[]，它将是 PHP 中的一个数组。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T22:06:16.387

您需要的值是从表格中发布的，对吗？如果是这样，您可以遍历 $_POST 变量中与表单字段生成的名称匹配的键。

```
foreach($_POST as $key=>$value)
{
  if(strpos($key, 'pBalance')===0)
  {
    $final_total += $value;
  }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T22:08:49.923

您可以使用数组来存储数据，然后循环遍历它。

```
$tempTotal = 0;

$balances[] = 5;
$balances[] = 5;
$balances[] = 5;

for  ($i = 0; $i <= count($balances); $i++) {
    $tempTotal = $tempTotal + $balances[$i];
} 
```

或者为简洁起见，使用 foreach 循环：

```
foreach($balances as $balance) {
    $tempTotal += $balance;
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T22:13:26.790

如果您尝试收集 POST 的值，则应该使用数组。您可以避免使用以下方法手动拼凑这样的数组：

```
<input type="text" name="vals[]" value="one" />
<input type="text" name="vals[]" value="two" /> 
```

`$_POST["vals"]`然后将是 array("one", "two");

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T22:14:27.600

在涉及 PHP 生成变量的所有案例中，大约有 99% 的情况是您做错了事。我将重申其他人所说的话：

**使用数组**

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T22:06:48.943

尝试

```
$varName = 'pBalance' . $i;
$tempTotal = $tempTotal + $$varName; 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-24T22:10:21.323

您正在寻找的概念称为变量变量（至少在 PHP 中称为）。这是官方[文档](http://ca.php.net/language.variables.variable)和有用的[教程](http://www.devshed.com/c/a/PHP/Using-Variable-Variables-in-PHP/)。变量变量的语法是双美元符号 ($$)。

# python - 如何有效地过滤 Python 列表理解中的计算值？

> ID：130262
> 
> 赞同：22
> 
> 时间：2008-09-24T22:08:57.363
> 
> 标签：python, list-comprehension

Python 列表推导语法使过滤推导中的值变得容易。例如：

```
result = [x**2 for x in mylist if type(x) is int] 
```

将返回 mylist 中整数平方的列表。但是，如果测试涉及一些（昂贵的）计算并且您想过滤结果怎么办？一种选择是：

```
result = [expensive(x) for x in mylist if expensive(x)] 
```

这将产生一个非“假”的代价昂贵（x）值的列表，但是对于每个 x 调用两次代价高昂（）。是否有一种理解语法允许您进行此测试，同时每个 x 只调用一次昂贵的？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-24T22:12:24.237

经过一分钟的思考，我想出了自己的答案。它可以通过嵌套推导来完成：

```
result = [y for y in (expensive(x) for x in mylist) if y] 
```

我想这行得通，虽然我发现嵌套推导只能勉强阅读

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-09-24T22:23:50.137

如果计算已经很好地捆绑到函数中，那么使用`filter`and怎么样`map`？

```
result = filter (None, map (expensive, mylist)) 
```

`itertools.imap`如果列表非常大，您可以使用。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-24T22:24:42.163

最明显（我认为最易读）的答案是不使用列表理解或生成器表达式，而是使用真正的生成器：

```
def gen_expensive(mylist):
    for item in mylist:
        result = expensive(item)
        if result:
            yield result 
```

它需要更多的水平空间，但一眼就能看出它的作用要容易得多，而且你最终不会重复自己。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-24T22:12:26.060

```
result = [x for x in map(expensive,mylist) if x] 
```

map() 将返回 mylist 中每个对象的值的列表，这些对象的值被传递给开销 ()。然后你可以列出理解，并丢弃不必要的值。

这有点像嵌套理解，但应该更快（因为 python 解释器可以很容易地优化它）。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-25T15:12:20.943

这正是生成器适合处理的内容：

```
result = (expensive(x) for x in mylist)
result = (do_something(x) for x in result if some_condition(x))
...
result = [x for x in result if x]  # finally, a list 
```

1.  这使得在管道的每个阶段发生的事情完全清楚。
2.  显式优于隐式
3.  在最后一步之前在任何地方都使用生成器，因此没有大型中间列表

cf： [David Beazley 的“系统程序员的生成器技巧”](http://www.dabeaz.com/generators/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-24T22:14:18.177

您总是可以记住[该](http://en.wikipedia.org/wiki/Memoization)函数`expensive()`，以便第二次调用它只是查找`x`.

[这只是 memoize 作为装饰器的众多实现之一](http://wiki.python.org/moin/PythonDecoratorLibrary#head-11870a08b0fa59a8622201abfac735ea47ffade5)。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-24T22:15:58.640

你可以记住昂贵的（x）（如果你经常调用昂贵的（x），你可能应该以任何方式记住它。这个页面给出了 python 的 memoize 实现：

[http://code.activestate.com/recipes/52201/](http://code.activestate.com/recipes/52201/)

这还有一个额外的好处，那就是昂贵的（x）可能运行*少于*N 次，因为任何重复的条目都将使用上一次执行的备忘录。

请注意，这假设昂贵（x）是一个真正的函数，并且不依赖于可能改变的外部状态。如果昂贵（x）确实依赖于外部状态，并且您可以检测到该状态何时发生变化，或者您知道在列表理解期间它*不会*改变，那么您可以在理解之前重置备忘录。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-17T01:01:11.567

我会偏爱：

```
itertools.ifilter(bool, (expensive(x) for x in mylist)) 
```

这样做的好处是：

*   避免 None 作为函数（将在 Python 3 中消除）：[http ://bugs.python.org/issue2186](http://bugs.python.org/issue2186)
*   仅使用迭代器。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-17T10:25:40.840

`for`循环附加到列表也有一个简单的旧用法：

```
result = []
for x in mylist:
    expense = expensive(x)
    if expense:
        result.append(expense) 
```

# security - AWS 账户标识符的影响

> ID：130264
> 
> 赞同：17
> 
> 时间：2008-09-24T22:09:30.793
> 
> 标签：security, amazon-web-services, amazon-s3, amazon-ec2, amazon-simpledb

我正在使用亚马逊的工具来构建一个网络应用程序。我对他们很满意，但我有安全方面的顾虑。

现在，我正在使用多个 EC2 实例、S3、SimpleDB 和 SQS。为了验证对不同服务的请求，您包括[访问标识符](https://aws-portal.amazon.com/gp/aws/developer/account/index.html?ie=UTF8&awscredential=&action=access-key)（需要登录）。

例如，要将文件从 EC2 实例上传到 S3，您的 EC2 实例需要具有您的*Access Key ID*和*Secret Access Key*。

这基本上意味着您的用户名和密码需要在您的实例中。

如果我的其中一个实例遭到入侵，我的所有亚马逊资产都会遭到入侵。密钥可用于上传/替换 S3 和 SimpleDB 数据，启动和停止 EC2 实例等。

如何将单个受感染主机的损害降至最低？

我的第一个想法是为每个帐户获取多个标识符，以便我可以跟踪所做的更改并快速撤消“被黑”帐户。亚马逊不支持每个账户多于一组凭证。

我的第二个想法是创建多个帐户并使用 ACL 来控制访问。不幸的是，并非所有服务都支持授予其他帐户访问您的数据的权限。此外，您使用的带宽越多，带宽就越便宜，因此所有这些都通过一个帐户进行是理想的。

有没有人处理过，或者至少考虑过这个问题？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-25T17:20:34.990

您可以做的是拥有一个超级锁定的“身份验证服务器”。密钥只存在于这台服务器上，所有其他服务器都需要请求它的许可。您可以将自己的密钥分配给各个服务器，也可以通过 IP 地址将其锁定。这样，如果服务器受到威胁，您只需从“身份验证服务器”撤销其密钥。

这是可能的，因为 AWS 身份验证的工作方式。假设您的网络服务器需要将文件上传到 S3。首先，它将生成 AWS 请求，并将该请求与您的自定义服务器密钥一起发送到“身份验证服务器”。身份验证服务器将对请求进行身份验证，执行加密魔法，并将经过身份验证的字符串返回给网络服务器。然后，网络服务器可以使用它来实际提交请求以及要上传到 S3 的文件。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-06-23T06:51:54.083

AWS 允许您使用[Identity and Access Management](http://aws.amazon.com/iam/)创建多个用户。这将允许您实施任何一种方案。

我建议为每个 EC2 实例定义一个 IAM 用户，这允许您在相应的 EC2 实例遭到破坏时撤销对特定用户（或只是他们的访问密钥）的访问权限，并使用细粒度权限来限制用户可以调用的 API以及他们可以访问哪些资源（例如只允许用户上传到特定的存储桶）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-06-22T05:16:09.377

此外，AWS IAM 角色允许您将权限分配给 EC2 实例，而不必在实例上放置密钥。[请参阅http://aws.typepad.com/aws/2012/06/iam-roles-for-ec2-instances-simplified-secure-access-to-aws-service-apis-from-ec2.html](http://aws.typepad.com/aws/2012/06/iam-roles-for-ec2-instances-simplified-secure-access-to-aws-service-apis-from-ec2.html)上的博客文章 大多数 SDK 使用角色创建的临时密钥。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-09-07T16:40:27.603

AWS 提供“综合计费”，可以解决您的疑虑。

[https://aws-portal.amazon.com/gp/aws/developer/account/index.html?ie=UTF8&action=consolidated-billing](https://aws-portal.amazon.com/gp/aws/developer/account/index.html?ie=UTF8&action=consolidated-billing)

“Consolidated Billing 使您能够通过指定一个支付账户来合并贵公司内多个 Amazon Web Services (AWS) 账户的付款。您可以查看所有账户产生的 AWS 成本的组合视图，并获取详细的成本报告与您的支付账户关联的每个单独的 AWS 账户。合并账单还可以降低您的总体成本，因为您所有账户的累计使用量可以帮助您更快地达到价格较低的批量级别。”

# sql - 如何在 Rails 中使用自定义连接预加载对象？

> ID：130268
> 
> 赞同：33
> 
> 时间：2008-09-24T22:09:48.517
> 
> 标签：sql, ruby-on-rails, ruby, activerecord

### 背景

正常的 rails 急切加载集合的工作方式如下：

```
Person.find(:all, :include=>:companies) 
```

这会生成一些 sql

```
LEFT OUTER JOIN companies ON people.company_id = companies.id 
```

### 问题

但是，我需要一个自定义连接（如果我使用 也可能出现这种情况`find_by_sql`）所以我不能使用香草`:include => :companies`

自定义 join/sql 将为我提供我需要的所有数据，但我如何告诉 activerecord 它属于关联`Company`对象，而不仅仅是一堆额外的行？

### 更新

我需要在联接中添加其他条件。像这样的东西：

```
SELECT blah blah blah
LEFT OUTER JOIN companies ON people.company_id = companies.id AND people.magical_flag IS NULL 
<Several other joins>
WHERE blahblahblah 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-25T03:01:03.277

不能使用 ActiveRecord 添加加入条件吗？

例如，我有一个使用多个相关记录的非常复杂的查询，并且通过组合条件和包含指令可以正常工作

```
Contractors.find(
  :all, 
  :include => {:council_areas => :suburbs},
  :conditions => ["suburbs.postcode = ?", customer.postcode]                 
) 
```

假如说：

1.  承包商有_many CouncilAreas
2.  CouncilAreas has_many Suburbs

**此连接返回由customer.postcode**标识的郊区的承包商。

生成的查询如下所示：

```
SELECT contractors.*, council_areas.*, suburbs.*
FROM `contractors` 
LEFT OUTER JOIN `contractors_council_areas` ON `contractors_council_areas`.contractor_id = `contractors`.id 
LEFT OUTER JOIN `council_areas` ON `council_areas`.id = `contractors_council_areas`.council_area_id 
LEFT OUTER JOIN `council_areas_suburbs` ON `council_areas_suburbs`.council_area_id = `council_areas`.id 
LEFT OUTER JOIN `suburbs` ON `suburbs`.id = `council_areas_suburbs`.suburb_id WHERE (suburbs.postcode = '5000') 
```

（注意：为简洁起见，我编辑了列列表）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-03-15T12:31:19.577

您可以使用以下内容来获得适当的左外连接语法魔术。

```
Person.reflect_on_association(:companies).options[:conditions] = 'people.magical_flag IS NULL' 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-12-06T17:21:06.123

我不确定这是你想要的（我不是 100% 确定我已经理解你的问题和你想要完成的事情）但是：

同时提供`:joins`和怎么样`:includes`？

`Person.find( :all, :joins => 'LEFT OUTER JOIN companies ON people.company_id = companies.id AND _pass_custom_conditions_here_', :includes => :companies )`

或AR3方式：

`Person.includes(:companies).joins('LEFT OUTER JOIN companies ON people.company_id = companies.id AND _pass_custom_conditions_here_')`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T05:51:05.053

你能详细说明一下你想用这个查询完成什么吗？

另请查看查找的 :joins 选项。它允许您指定要如何连接表。[链接文本](http://api.rubyonrails.org/classes/ActiveRecord/Base.html#M001298/ ".查找文档")

使用 :include 时要小心，Rails 2.1 中的行为会发生一些变化，并且在与引用包含表的 :conditions 选项结合使用时可能会导致一些问题。[链接文本](http://pivots.pivotallabs.com/users/stevend/blog/articles/514-standup-09-23-2008-disabling-pre-rails-2-1-style-include/ "这里")和[链接文本](http://pivots.pivotallabs.com/users/stevend/blog/articles/515-standup-09-24-2008-why-does-my-jvm-crash-running-solr-/ "这里")是来自 Pivotal 的两篇文章，其中提到了这个问题。

# batch-file - .cmd 和 .bat 文件将返回代码转换为错误消息

> ID：130273
> 
> 赞同：6
> 
> 时间：2008-09-24T22:11:03.507
> 
> 标签：batch-file, cmd, build-automation

我正在尝试通过 .cmd 文件自动化我使用测试套件制作的程序。

我可以通过 %errorlevel% 获取我运行的程序的返回码。

我的程序对每种类型的错误都有一定的返回码。

例如：

1 - 表示因某某原因失败

2 - 表示因其他原因失败

...

echo FAILED：测试用例失败，错误级别：%errorlevel% >> TestSuite1Log.txt

相反，我想以某种方式说：

echo FAILED：测试用例失败，错误原因：lookupError(%errorlevel%) >> TestSuite1Log.txt

.bat 文件可以做到这一点吗？还是我必须转向像 python/perl 这样的脚本语言？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-24T22:29:37.190

您可以使用该`ENABLEDELAYEDEXPANSION`选项非常巧妙地做到这一点。这允许您`!`用作在 之后评估的变量标记`%`。

```
REM Turn on Delayed Expansion
SETLOCAL ENABLEDELAYEDEXPANSION

REM Define messages as variables with the ERRORLEVEL on the end of the name
SET MESSAGE0=Everything is fine
SET MESSAGE1=Failed for such and such a reason
SET MESSAGE2=Failed for some other reason

REM Set ERRORLEVEL - or run command here
SET ERRORLEVEL=2

REM Print the message corresponding to the ERRORLEVEL
ECHO !MESSAGE%ERRORLEVEL%! 
```

在命令提示符下键入`HELP SETLOCAL`和`HELP SET`以获取有关延迟扩展的更多信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T22:23:46.470

您可以执行类似以下代码的操作。请注意，由于 cmd 怪癖，错误级别比较应该按降序排列。

```
setlocal

rem Main script
call :LookupErrorReason %errorlevel%
echo FAILED Test case failed, error reason: %errorreason% >> TestSuite1Log.txt
goto :EndOfScript

rem Lookup subroutine
:LookupErrorReason
  if %%1 == 3 set errorreason=Some reason
  if %%1 == 2 set errorreason=Another reason
  if %%1 == 1 set errorreason=Third reason
goto :EndOfScript

:EndOfScript
endlocal 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T22:17:21.337

不完全一样，使用子例程，但您可以使用[goto](http://www.robvanderwoude.com/goto.html)解决方法用文本填充 a 变量。

如果您的这个测试套件增长了很多以使用更强大的语言，它可能会更容易。Perl 甚至 Windows Scripting Host 都可以为您提供帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T22:17:36.920

是的，您可以使用通话。只是在新行上调用，并传递错误代码。这应该可以，但我没有测试过。

```
C:\Users\matt.MATTLANT>help call
Calls one batch program from another.

CALL [drive:][path]filename [batch-parameters]

  batch-parameters   Specifies any command-line information required by the
                     batch program. 
```

SEDIT：我可能有点误解了，但你也可以使用 IF

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T22:19:38.163

以相反的顺序测试您的值并使用**IF**的重载行为：

```
@echo off
myApp.exe
if errorlevel 2 goto Do2
if errorlevel 1 goto do1
echo Success
goto End

:Do2
echo Something when 2 returned
goto End

:Do1
echo Something when 1 returned
goto End

:End 
```

如果你想更强大，你可以尝试这样的事情（你需要用 %errorlevel 替换 %1 但对我来说更难测试）。您需要为您处理的每个错误级别添加一个标签：

```
@echo off
echo passed %1
goto Label%1

:Label
echo not matched!
goto end

:Label1
echo One
goto end

:Label2
echo Two
goto end

:end 
```

这是一个测试：

```
C:\>test
passed
not matched!

C:\>test 9
passed 9
The system cannot find the batch label specified - Label9

C:\>test 1
passed 1
One

C:\>test 2
passed 2
Two 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T22:20:44.807

您可以使用“IF ERRORLEVEL”语句根据返回码执行不同的操作。

看：

[http://www.robvanderwoude.com/errorlevel.html](http://www.robvanderwoude.com/errorlevel.html)

在回答您的第二个问题时，无论如何我都会转而使用脚本语言，因为 Windows 批处理文件本身就非常有限。Perl、Python、Ruby 等有很棒的 Windows 发行版，所以真的没有理由不使用它们。我个人喜欢在 Windows 上编写 Perl 脚本。

# c++ - 流式传输 wav 文件

> ID：130287
> 
> 赞同：4
> 
> 时间：2008-09-24T22:15:55.567
> 
> 标签：c++, stream, wav

我有一个通过套接字发送数据的服务器，数据是一个 wav '文件'。我可以轻松地将数据写入磁盘，然后在 WMP 中播放，但我不知道如何在从套接字读取数据时播放它。是否可以？

额外的问题：如果流是 mp3 或其他格式，我会怎么做？

这适用于本机 C++ 中的窗口。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T22:38:36.620

因为您说的是 WMP，所以我假设这个问题适用于尝试在 Windows 机器上播放 wav 文件。如果不是，则此答案不相关。

你想做的事情不是微不足道的。[这里](http://www.codeproject.com/KB/audio-video/wavefiles.aspx)有一篇关于代码项目的好文章，描述了 Windows 音频模型。它描述了如何设置音频设备以及如何将数据流式传输到设备中进行播放。您“只需”需要提供来自套接字的数据作为播放缓冲区的数据。但这就是所有棘手的工作所在。你必须确定

*   您有足够的数据开始播放
*   当您的套接字缺少数据并且您没有任何内容可发送到播放缓冲区时处理这种情况
*   您能够以足够的速度从套接字读取数据，以保持播放缓冲区已满

这是一个有趣的练习。但是很棘手。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T05:15:12.067

Mark 认为这是一个棘手的问题是正确的。如果您使用 DirectSound 而不是 waveOut，则可能不会那么棘手。 [这是一篇](http://www.gamedev.net/reference/articles/article710.asp)关于从磁盘流式传输波形文件的文章：从网络流式传输本质上是相同的过程。确保在开始之前从网络收集足够的数据 - 您需要的不仅仅是文章提到的 2 个缓冲区。

更简单的是[FMOD](http://www.fmod.org/)。从[常见问题解答](http://www.fmod.org/fmodfeatures.html)：

**增强的互联网功能**

*   互联网音频流。包含自定义互联网流代码，允许无缝的 SHOUTcast、Icecast 和 http 流支持。
*   下载能力。FMOD 支持网络文件的模块化文件系统的一个副作用，即使是静态样本也可以从互联网上加载。

**文件格式支持**：FMOD 目前支持多种音频文件格式。 *部分清单*：

*   MP3 -（MPEG I/II 第 3 层，包括 VBR 支持）
*   OGG -（Ogg Vorbis 格式）
*   WAV -（Microsoft Wave 文件，包括压缩 wav。PCM、MP3 和 IMA ADPCM 压缩 wav

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T00:29:51.160

Mark 认为这是一个棘手的问题是正确的。waveOutXXXX API 是古老的（它早于 Windows 95）并且需要比您想象的更容易出错的编码。使用 C++ 与 API 交互比使用 C# 更容易。只要确保这是您真正想做的事情。

如果您的流是 WAV 文件数据以外的其他格式（如 MP3 或 WMA），您将必须执行将数据解码为 WAV 格式并使用 waveOutXXXX API 播放的附加步骤。找到一个好的组件来进行 MP3 解码比你想象的要棘手 - 我认为这与弗劳恩霍夫许可情况有关（如果你以任何方式使用 MP3 代码，你应该向他们付费）。

**我会找到一个现成的产品来做到这一点，除非你想要学习经验。**

# inversion-of-control - 为延迟加载注入数据访问依赖项的正确方法是什么？

> ID：130292
> 
> 赞同：11
> 
> 时间：2008-09-24T22:17:59.900
> 
> 标签：inversion-of-control, lazy-loading

当我进行延迟加载时，注入数据访问依赖项的正确方法是什么？

例如我有以下类结构

```
class CustomerDao : ICustomerDao
  public Customer GetById(int id) {...}

class Transaction {
  int customer_id; //Transaction always knows this value
  Customer _customer = null;
  ICustomerDao _customer_dao;
  Customer GetCustomer() {
    if(_customer == null)
      _customer = _customer_dao.GetById(_customer_id);
    return _customer
  } 
```

如何获取对 _customer_dao 的引用到事务对象中？如果我希望事务至少看起来像 POCO，那么为构造函数要求它似乎没有任何意义。让 Transaction 对象直接引用 Inversion of Control Container 可以吗？这也显得很尴尬。

NHibernate 之类的框架如何处理这个问题？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-06T22:41:52.433

我建议一些不同的东西......使用延迟加载类：

```
public class Lazy<T>
{
   T value;
   Func<T> loader;

   public Lazy(T value) { this.value = value; }
   public Lazy(Func<T> loader { this.loader = loader; }

   T Value
   {
     get 
    {
       if (loader != null)
       {
         value = loader();
         loader = null;
       }

       return value;
    }

    public static implicit operator T(Lazy<T> lazy)
    {
        return lazy.Value;
    }

    public static implicit operator Lazy<T>(T value)
    {
        return new Lazy<T>(value);
    }
} 
```

一旦你得到它，你就不需要在你的对象中注入 dao 了：

```
public class Transaction
{
    private static readonly Lazy<Customer> customer;

    public Transaction(Lazy<Customer> customer)
    {
      this.customer = customer;
    }

    public Customer Customer
    {
       get { return customer; } // implicit cast happen here
    }
} 
```

创建未绑定到数据库的 Transcation 对象时：

```
new Transaction(new Customer(..)) // implicite cast 
                                  //from Customer to Lazy<Customer>.. 
```

从存储库中的数据库重新生成事务时：

```
public Transaction GetTransaction(Guid id)
{
   custmerId = ... // find the customer id 
   return new Transaction(() => dao.GetCustomer(customerId));
} 
```

发生了两件有趣的事情： - 您的域对象可以在有或没有数据访问的情况下使用，它变得对数据访问无知。唯一的小转折是允许传递一个提供对象而不是对象本身的函数。- Lazy 类是内部可变的，但可以用作不可变值。readonly 关键字保持其语义，因为它的内容不能从外部更改。

当您希望该字段可写时，只需删除 readonly 关键字。当分配一个新值时，由于隐式转换，将使用新值创建一个新的 Lazy。

编辑：我在这里写了博客：

[http://www.thinkbeforecoding.com/post/2009/02/07/Lazy-load-and-persistence-ignorance](http://www.thinkbeforecoding.com/post/2009/02/07/Lazy-load-and-persistence-ignorance)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T01:50:49.030

我通常像上面那样在构造函数中进行依赖注入，但是只有在像下面这样调用“get”时才采取行动，从而使延迟加载更进一步。不确定这是否是您正在寻找的纯方法，但它确实在 1 步中消除了“脏”构造函数 DI/Lazy Loading ;)

```
public class Product
{
    private int mProductID;
    private Supplier mSupplier;
    private ISupplierService mSupplierService;

    public Product()
    {
      //if you want your object to remain POCO you can use dual constr
      //this constr will be for app use, the next will be for testing
    } 

    public Product(ISupplierService SupplierService)
    {
        mSupplierService = SupplierService;
    }

    public Supplier Supplier {
        get {
            if (mSupplier == null) {
                if (mSupplierService == null) {
                    mSupplierService = new SupplierService();
                }
                mSupplier = mSupplierService.GetSupplierByProductID(mProductID);
            }
            return mSupplier;
        }
        set { mSupplier = value; }
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T02:36:42.557

我对 POCO 这个术语不是很熟悉，但我读过的定义似乎通常遵循对象独立于某些更大框架的精神。

也就是说，无论你如何分割它，如果你正在执行依赖注入，你将与那些功能被注入的类进行协作，以及将依赖对象粘在其中的东西，无论它是一个完整的注入框架或只是一些汇编类。

对我自己来说，将 IOC 容器的引用注入到一个类中似乎很奇怪。我更喜欢在构造函数中进行注入，代码如下所示：

```
public interface IDao<T>
{
    public T GetById(int id);
}

public interface ICustomerDao : IDao<Customer>
{
}

public class CustomerDao : ICustomerDao
{
    public Customer GetById(int id) 
    {...}
}

public class Transaction<T> where T : class
{

    int _id; //Transaction always knows this value
    T _dataObject;
    IDao<T> _dao;

    public Transaction(IDao<T> myDao, int id)
    {
        _id = id;
        _dao = myDao;
    }

    public T Get()
    {
        if (_dataObject == null)
            _dataObject = _dao.GetById(_id);
        return _dataObject;
    }
} 
```

# nhibernate - 使用 NHibernate 进行说明。真实世界的项目示例？

> ID：130306
> 
> 赞同：4
> 
> 时间：2008-09-24T22:23:37.033
> 
> 标签：nhibernate

在接下来的几个月里，我的目标之一是熟悉 NHibernate，并且很好奇是否有人对从哪里开始有任何建议。最好，我想找到一个示例项目来演示您在现场应用程序中看到的内容。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-25T12:25:10.580

NHibernate ASP.NET 最佳实践文章的作者，并继续使用 ASP.NET MVC制作了一个名为[Sharp Architecture的更新示例。](http://code.google.com/p/sharp-architecture/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-24T22:46:46.040

我几乎完全基于 CodeProject 中的这篇文章：[NHibernate Best Practices](http://www.codeproject.com/KB/architecture/NHibernateBestPractices.aspx)的应用程序架构的第一次迭代。另请查看此博客：[Ayende @ Rahien](http://ayende.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T18:27:15.577

nhibernate [FAQ 博客](https://web.archive.org/web/20110227204838/http://blogs.hibernatingrhinos.com/nhibernate/Default.aspx)非常有用。

# cocoa - 来自合并模型的 NSManagedObjectModel 中的跨模型关系？

> ID：130316
> 
> 赞同：9
> 
> 时间：2008-09-24T22:27:01.080
> 
> 标签：cocoa, macos, core-data, nsmanagedobject, nsmanagedobjectcontext

如果实体总是在通过合并相关模型创建的 NSManagedObjectModel 中使用，是否可以对在单独的 NSManagedObjectModels 中定义的实体之间的关系进行建模？

例如，假设模型 1 定义了`Foo`具有关系（一对一）`toBar`的实体，而模型 2 定义了`Bar`具有关系（一对一）的实体`toFoo`。我将使用合并模型 1 和模型 2 来构建 CoreData 堆栈`-[NSManagedObjectModel mergedModelFromModels]`。有没有办法在数据建模器中或以编程方式定义这些关系，以便它们表现得好像它们是模型内关系？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-26T06:47:35.783

模型 1 和模型 2 都不能在运行时加载，除非它们格式正确——也就是说，除非`toBar`and`toFoo`关系有目的地。此外，如果模型 1 和模型 2 具有相同名称的模型，您将无法从它们创建合并模型；它们不会被合并，它们会发生碰撞，这是一个错误。

但是，您可以`NSManagedObjectModel`手动使用 API 来加载每个模型并手动创建一个包含两个实体的新模型。和类（及其子类）确实实现了`NSEntityDescription`协议，因此在大多数情况下，您应该能够将属性从每个组件模型复制到整个模型。`NSPropertyDescription``NSCopying`

此外，这些`NS*Description`类都支持`userInfo`您可以在 Xcode 的数据建模工具中编辑的字典，您可以使用它来执行诸如将关系的目标标记为替身之类的事情。例如，在模型 1 中，您可以拥有一个`Bar`带有`userInfo`键的实体，`MyRealEntity`并在创建合并模型时检查它，作为使用真实实体的信号。

您还需要为您的替代实体放置替代反向关系；合并后这些将被替换为实数倒数。不过，您不必在所有模型中完全复制您的替代实体；您只需要在实体中的真实模型中使用的反向关系。

因此，如果你的真实`Foo`有一个`name`属性，而你的真实 Bar 有一个`kind`属性，那么你的替身`Foo`就`Bar`不需要那些，只需要替身`toBar`和`toFoo`关系。

这是一些代码，演示了我在说什么：

```
- (NSManagedObjectModel *)mergeModelsReplacingDuplicates:(NSArray *)models {
    NSManagedObjectModel *mergedModel = [[[NSManagedObjectModel alloc] init] autorelease];

    // General strategy:  For each model, copy its non-placeholder entities
    // and add them to the merged model. Placeholder entities are identified
    // by a MyRealEntity key in their userInfo (which names their real entity,
    // though their mere existence is sufficient for the merging).

    NSMutableArray *mergedModelEntities = [NSMutableArray arrayWithCapacity:0];

    for (NSManagedObjectModel *model in models) {
        for (NSEntityDescription *entity in [model entities]) {
            if ([[entity userInfo] objectForKey:@"MyRealEntity"] == nil) {
                NSEntityDescription *newEntity = [entity copy];
                [mergedModelEntities addObject:newEntity];
                [newEntity release];
            } else {
                // Ignore placeholder.
            }
        }
    }

    [mergedModel setEntities:mergedModelEntities];

    return mergedModel;
} 
```

这是有效的，因为 Core Data 中的对象复制`NS*Description`是按名称而不是按值相对于关系的目标实体和反向（以及实体的子实体）。因此，虽然一个模型是可变的——也就是说，在它被设置为一个模型之前`NSPersistentStoreCoordinator`——你可以使用这样的技巧将你的模型分解为多个模型。

# programming-languages - Haskell新手：使用布局与否？优点和缺点是什么（使用示例）

> ID：130317
> 
> 赞同：0
> 
> 时间：2008-09-24T22:28:23.247
> 
> 标签：programming-languages, haskell, coding-style

我似乎找不到太多关于 haskells 布局功能的信息，因为我知道它类似于 pythons 格式要求，但它是可选的。如何选择不正确使用此选项？没有它开始是一个好主意，这样我就可以对语言本身有一个坚实的感觉吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-24T23:47:30.107

请参阅[http://en.wikibooks.org/wiki/Programming:Haskell_indentation](http://en.wikibooks.org/wiki/Programming:Haskell_indentation) 和[http://www.haskell.org/onlinereport/lexemes.html#sect2.7](http://www.haskell.org/onlinereport/lexemes.html#sect2.7) （均包含示例）。

优点：

*   少打字
*   少读，好看（如果你觉得舒服的话）

缺点：

*   你可能会弄错，特别是如果你不熟悉它。如果你不确定，大括号会让事情变得一清二楚。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-25T05:34:49.820

Haskell 的布局是其定义特征之一，恕我直言。Haskell 整个哲学的一部分是它更像数学。使用布局是朝着这一目标迈出的一大步。对于许多程序来说，如果你用数学方程编写伪代码，它最终会成为使用布局的有效 Haskell 语法。我强烈建议至少尝试布局。

缺点是可能会出现细微的缩进错误。一开始这可能会令人沮丧，尤其是。如果你不熟悉它。但是编译器会告诉你它们。一旦你修复它，你就会得到通常看起来非常令人愉快的代码。

您不能简单地通过使用花括号作为显式块和使用分号作为分隔符来使用它。

# c++ - 你如何传递一个成员函数指针？

> ID：130322
> 
> 赞同：27
> 
> 时间：2008-09-24T22:30:12.507
> 
> 标签：c++, class, function, pointers, member

我试图将一个类中的成员函数传递给一个接受成员函数类指针的函数。我遇到的问题是我不确定如何使用 this 指针在类中正确执行此操作。有人有建议吗？

这是传递成员函数的类的副本：

```
class testMenu : public MenuScreen{
public:

bool draw;

MenuButton<testMenu> x;

testMenu():MenuScreen("testMenu"){
    x.SetButton(100,100,TEXT("buttonNormal.png"),TEXT("buttonHover.png"),TEXT("buttonPressed.png"),100,40,&this->test2);

    draw = false;
}

void test2(){
    draw = true;
}
}; 
```

函数 x.SetButton(...) 包含在另一个类中，其中“object”是一个模板。

```
void SetButton(int xPos, int yPos, LPCWSTR normalFilePath, LPCWSTR hoverFilePath, LPCWSTR pressedFilePath, int Width, int Height, void (object::*ButtonFunc)()) {

    BUTTON::SetButton(xPos, yPos, normalFilePath, hoverFilePath, pressedFilePath, Width, Height);

    this->ButtonFunc = &ButtonFunc;
} 
```

如果有人对我如何正确发送此功能有任何建议，以便我以后可以使用它。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-09-24T23:11:53.577

要通过指针调用成员函数，您需要两件事：指向对象的指针和指向函数的指针。你需要两个`MenuButton::SetButton()`

```
template <class object>
void MenuButton::SetButton(int xPos, int yPos, LPCWSTR normalFilePath,
        LPCWSTR hoverFilePath, LPCWSTR pressedFilePath,
        int Width, int Height, object *ButtonObj, void (object::*ButtonFunc)())
{
  BUTTON::SetButton(xPos, yPos, normalFilePath, hoverFilePath, pressedFilePath, Width, Height);

  this->ButtonObj = ButtonObj;
  this->ButtonFunc = ButtonFunc;
} 
```

然后您可以使用两个指针调用该函数：

```
((ButtonObj)->*(ButtonFunc))(); 
```

不要忘记将指向对象的指针传递给`MenuButton::SetButton()`：

```
testMenu::testMenu()
  :MenuScreen("testMenu")
{
  x.SetButton(100,100,TEXT("buttonNormal.png"), TEXT("buttonHover.png"),
        TEXT("buttonPressed.png"), 100, 40, this, test2);
  draw = false;
} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-24T22:46:47.397

我强烈推荐`boost::bind`这样`boost::function`的事情。

请参阅[传递和调用成员函数（boost::bind / boost::function?）](https://stackoverflow.com/questions/5245072/pass-and-call-a-member-function-boostbind-boostfunction)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2015-04-15T20:03:51.527

我知道这是一个相当古老的话题。但是有一种优雅的方式可以用 c++11 来处理这个问题

```
#include <functional> 
```

像这样声明你的函数指针

```
typedef std::function<int(int,int) > Max; 
```

声明你传递这个东西的函数

```
void SetHandler(Max Handler); 
```

假设你向它传递了一个普通函数，你可以像平常一样使用它

```
SetHandler(&some function); 
```

假设你有一个成员函数

```
class test{
public:
  int GetMax(int a, int b);
...
} 
```

在您的代码中，您可以`std::placeholders`像这样使用它

```
test t;
Max Handler = std::bind(&test::GetMax,&t,std::placeholders::_1,std::placeholders::_2);
some object.SetHandler(Handler); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-25T08:11:18.803

使用标准 OO 会不会更好。定义一个合约（虚拟类）并在您自己的类中实现它，然后只需将引用传递给您自己的类并让接收者调用合约函数。

使用您的示例（我已将“test2”方法重命名为“buttonAction”）：

```
class ButtonContract
{
  public:
    virtual void buttonAction();
}

class testMenu : public MenuScreen, public virtual ButtonContract
{
  public:
    bool draw;
    MenuButton<testMenu> x;

    testMenu():MenuScreen("testMenu")
    {
      x.SetButton(100,100,TEXT("buttonNormal.png"), 
              TEXT("buttonHover.png"), 
              TEXT("buttonPressed.png"), 
              100, 40, &this);
      draw = false;
    }

    //Implementation of the ButtonContract method!
    void buttonAction()
    {
      draw = true;
    }
}; 
```

在接收器方法中，您存储对 ButtonContract 的引用，然后当您想要执行按钮的操作时，只需调用该存储的 ButtonContract 对象的“buttonAction”方法。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T23:10:23.237

在极少数情况下，您碰巧使用 Borland C++Builder 进行开发并且不介意编写特定于该开发环境的代码（即不能与其他 C++ 编译器一起使用的代码），您可以使用 __closure 关键字. 我找到了[一篇关于 C++Builder 闭包的小文章](http://www.drbob42.com/cbuilder/lstfnd15.htm)。它们主要用于 Borland VCL。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-23T16:58:18.937

其他人已经告诉你如何正确地做到这一点。但令我惊讶的是，没有人告诉你这段代码实际上很危险：

```
this->ButtonFunc = &ButtonFunc; 
```

由于 ButtonFunc 是一个参数，所以当函数返回时它会超出范围。你正在获取它的地址。您将获得一个类型的值`void (object::**ButtonFunc)()`（*指向成员函数指针的指针*）并将其分配给 this->ButtonFunc。在您尝试使用 this->ButtonFunc 时，您会尝试访问（现在不再存在）本地参数的存储，并且您的程序可能会崩溃。

我同意 Commodore 的解决方案。但你必须将他的线路改为

```
((ButtonObj)->*(ButtonFunc))(); 
```

因为 ButtonObj 是一个*指向*对象的指针。

# nhibernate - nHibernate 不检索手动更改的数据

> ID：130324
> 
> 赞同：4
> 
> 时间：2008-09-24T22:30:55.063
> 
> 标签：nhibernate

nHibernate 无法从存储库表中检索手动更改的数据？我也禁用了二级缓存，但看起来它（nhibernate）有时从缓存中检索，有时从存储库表中检索。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-02T03:15:11.193

nhibernate中有两种缓存：会话缓存和二级缓存。会话缓存始终缓存该会话看到的对象 - 这是 nhibernate 知道哪些对象已更改并需要持久化的方式。您禁用的二级缓存低于此值。您看到的缓存信息来自会话缓存。

如果您的应用程序需要查看由其他来源保留的更改（例如，手动数据库更改），答案可能是以更精细的粒度创建会话。虽然 SessionFactory 在应用程序的生命周期中存在，但应该更频繁地创建 Session 对象。例如，在 Web 应用程序中，每个请求都会生成自己的会话。

如果这不是一个选项， session.Clear() 将从会话中驱逐所有对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-11-24T02:47:55.177

与 NHibernate 的良好关系始终取决于强大的 OO 承诺，并且在最常见的情况下取决于数据更改的排他性。如果你没有它，你会看到一些令人讨厌的问题，并且会放弃 NH 可以提供的大部分真正好的东西。

假设有一个名为“Foo”的类映射到具有“Id”和“SomeProperty”列的表“Foo”。如果所有行都手动将“SomeProperty”从“oldValue”更新为“newValue”，并且 NH 向 DB 发送一些查询，询问 SomeProperty =“newValue”的所有 Foos，则 DB 按预期返回所有 Foos。但是 Foo 实例 NH 提供的可能具有“oldValue”，因为具有返回 Id 的 Foo 已经附加到会话（换句话说，它位于一级缓存上）。

让 NHibernate 了解所有手动更新的唯一捷径是使用 StatelessSession，因此它不会缓存对象实例，并且始终提供数据库版本的数据。但是，如果您想在事务系统上应用它，这是不恰当使用 NH 的明显迹象，并且您将无法获得大部分好的 NH 功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T12:45:49.063

我不知道它是否会解决您遇到的问题，但文档指出：

> 要从会话缓存中完全逐出所有对象，请调用 ISession.Clear()
> 
> 对于二级缓存，在 ISessionFactory 上定义了一些方法，用于驱逐实例、整个类、集合实例或整个集合角色的缓存状态。

如果每次对可能带外更改的数据执行 SELECT 时都执行此操作，那么它应该执行您想要的操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T15:03:33.010

这只是测试的一部分。

但将来我们可以手动编辑数据表。我还为该表设置了lazy 为false，并注释掉了hibernate 使用的所有二级缓存属性。但即便如此，它也会返回不同的值而不是新编辑的值。有时它给我旧的价值，有时给我新的价值，所以它不是恒定的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T14:11:10.717

抱歉太具体了

Nhibernate 正在毫无问题地检索数据。但是当我手动更改存储库表中的数据时。Icriterea(nhibernate) 有时会从缓存或表中获取。我正在使用 Icriteria 功能：

ICriteria 标准 = session.CreateCriteria(typeof(xyzclass)); criteria.Add(Expression.Eq("xyzclass", somestringto retreivedata)); 标准.SetCacheable(false); 返回条件.UniqueResult();

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T14:15:49.893

我从未实际使用过 NHibernate 的缓存功能，但我相信它的目的是完全消除访问数据库的需要，这意味着它不会接受手动更改，因为它不知道他们。

我会确切地质疑您在这里要实现的目标是什么，您只是通过手动编辑数据库进行一些测试，还是这将是实时应用程序中的常规活动？实际上，唯一应该修改数据库的是应用程序，通过您的 NHibernate 数据层进行修改，因此在此过程中更新和/或弄脏缓存。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-25T03:50:20.757

我认为您必须对您的确切问题进行更多描述才能获得答案；我对 nhibernate 有一些最小的经验，但我不能真正去复制正在发生的事情并尝试在没有一些代码的情况下修复它。

# linux - 基于 Linux 的域管理解决方案？

> ID：130327
> 
> 赞同：3
> 
> 时间：2008-09-24T22:31:18.293
> 
> 标签：linux, active-directory, sysadmin

使用 Windows Server 家族的任何成员，我都可以设置一个活动目录，并为大量计算机提供一个用户池；可以为给定域中的任何共享资源授予/删除访问权限（包括对客户端计算机的访问权限等）。

使用 Linux 管理多用户、多计算机环境有哪些类似（和广泛使用）的解决方案？它们的优点/缺点是什么？它们如何与 Windows 互操作？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T22:47:03.870

不确定这是否是您的想法，但带有 Samba 的 Linux 可以充当 Windows 桌面的域控制器。例如，请参阅HowToForge 中[用于小型工作组的 SAMBA（域控制器）服务器。](http://www.howtoforge.com/samba_setup_ubuntu_5.10)这适用于文件/打印共享等。

对于更类似于 Microsoft 的 Active Directory 的东西，您可以查看[Red Hat Directory Server](http://www.redhat.com/directory_server/)：

> Red Hat Directory Server 是一个基于 LDAP 的服务器，它将应用程序设置、用户配置文件、组数据、策略和访问控制信息集中到一个独立于操作系统、基于网络的注册表中。

如果成本是一个问题，有一个 Fedora Directory Server 版本，它是免费的社区版本。

另一个潜在的产品是 Sun 的[OpenDS](https://opends.dev.java.net/)项目：

> OpenDS 是一个开源社区项目，基于 LDAP 和 DSML 构建免费且全面的下一代目录服务。OpenDS 旨在解决大型部署、提供高性能、高度可扩展以及易于部署、管理和监控。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T06:21:05.073

Joe：我认为现在 NIS 被认为是遗留的 Unix 东西。我不会向新部署的任何人推荐它。

在我工作的公司，我们为 LDAP 目录和 Kerberos KDC 运行 Apple 的 Open Directory。[您可以使用 Red Hat 的目录服务器（上面 Jay 提到）或类似Apache Directory](http://directory.apache.org/)之类的东西来实现相同的目的。

虽然 LDAP 和 Kerberos 一开始可能会让人望而生畏，并且在开始工作时有些挑战，但我认为这些努力是值得的。您可以轻松地将两者扩展到您需要的任何大小。

对于 Windows 端，您可以将 Samba 挂接到 LDAP 并根据它对您的 Windows 客户端进行身份验证。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T08:07:43.323

[LDAP](http://fr.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol)显然是要走的路。参见例如[OpenLDAP Software 2.4 Administrator's Guide](http://www.openldap.org/doc/admin24/)。

An example of setting up user authentication with LDAP on Linux and FreeBSD is on my blog (in french), [Comptes Unix stockés sur LDAP](http://www1.bortzmeyer.org/comptes-unix-ldap.html).

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T22:42:05.897

假设 Linux 计算机可以使用[Like Open](http://www.centeris.com/products/likewise_open/)连接到 Active Directory 域。即使用 Active Directory 凭据进行身份验证和访问控制。

我自己简单地尝试过，但没有运气（最终无意中使我的桌面系统成为域控制器，不得不让网络管理员重新分配它！）。可能只需要更好地阅读文档......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T22:47:55.633

[Samba](http://samba.org/)提供与 Windows 域控制器的互操作性。使用版本 3，它可以充当主域控制器。根据我的阅读，第 4 版将改进对 ActiveDirectory 的支持。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T22:55:15.817

**Linux 服务器可以配置为参与[NIS](http://en.wikipedia.org/wiki/Network_Information_Service)域**，在构建服务器时通常应该提示您进行这种设置。NIS 很像 Active Directory，提供**跨多个盒子的通用身份和身份验证**。您还可以将主目录配置为从公共 NFS 共享中挂载，以便身份和工作环境随用户从一个盒子移动到另一个盒子。

我从用户/技术领导方面体验过这一点，希望 Linux 管理员可以提供有关如何执行此操作以及在何处查找资源的进一步指示。

# c# - 如何在 WebMethod 中获取调用者的 IP 地址？

> ID：130328
> 
> 赞同：52
> 
> 时间：2008-09-24T22:31:35.670
> 
> 标签：c#, asp.net, web-services

如何在 WebMethod 中获取调用者的 IP 地址？

```
[WebMethod]
public void Foo()
{
    // HttpRequest... ? - Not giving me any options through intellisense...
} 
```

使用 C# 和 ASP.NET

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2008-09-24T22:33:13.297

[HttpContext.Current.Request.UserHostAddress](http://msdn.microsoft.com/en-us/library/system.web.httprequest.userhostaddress.aspx)是您想要的。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-24T22:56:03.663

只是一个警告。IP 地址不能用于唯一标识客户端。NAT 防火墙和企业代理无处不在，将许多用户隐藏在一个 IP 后面。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-24T22:34:55.443

尝试：

```
Context.Request.UserHostAddress 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-24T22:34:06.930

试试这个：

```
string ipAddress = HttpContext.Current.Request.ServerVariables["REMOTE_ADDR"]; 
```

没有在 webMethod 中尝试过，但我在标准 HttpRequests 中使用它

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T22:33:59.473

HttpContext 实际上在`WebService`基类中可用，因此只需使用`Context.Request`（或者`HttpContext.Current`也指向当前上下文）来访问`HttpRequest`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-10-22T15:30:53.610

我做了以下功能：

```
static public string sGetIP()
{
    try
    {
        string functionReturnValue = null;

        String oRequestHttp =
            WebOperationContext.Current.IncomingRequest.Headers["User-Host-Address"];
        if (string.IsNullOrEmpty(oRequestHttp))
        {
            OperationContext context = OperationContext.Current;
            MessageProperties prop = context.IncomingMessageProperties;
            RemoteEndpointMessageProperty endpoint =
                prop[RemoteEndpointMessageProperty.Name] as RemoteEndpointMessageProperty;
            oRequestHttp = endpoint.Address;
        }
        return functionReturnValue;
    }
    catch (Exception ex)
        {
            return "unknown IP";
        }
} 
```

这仅在 Intranet 中有效，如果您有一些 Proxy 或 natting，您应该研究原始 IP 是否在 http 数据包中的其他位置移动。

# jakarta-ee - 如何防止用户在网站上多次发布数据

> ID：130337
> 
> 赞同：19
> 
> 时间：2008-09-24T22:33:13.607
> 
> 标签：jakarta-ee, double-submit-problem

我正在开发一个 Web 应用程序 (J2EE)，我想知道可用于处理来自浏览器的双重发布的选项。

我过去看到和使用的解决方案都是客户端的：

*   用户单击后立即禁用提交按钮。
*   遵循 POST-Redirect-GET 模式以防止用户单击后退按钮时出现 POST。
*   处理表单的 onSubmit 事件并使用 JavaScript 跟踪提交状态。

如果可能，我更愿意实施服务器端解决方案。有没有比我上面提到的更好的方法，或者客户端解决方案是最好的？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-24T22:38:43.640

很难实施防白痴的解决方案（因为他们一直在改进白痴）。 ***无论您做什么，客户端都可能被操纵或执行不正确。***

**您的解决方案必须在服务器端才能可靠和安全。** 也就是说，一种方法是查看请求并检查系统/数据库状态或日志以确定它是否已被处理。理想情况下，**如果可能，服务器端的进程应该是幂等的**，如果不能，它必须防止重复提交。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-24T22:35:57.890

您可以提供一个“票”作为表单的一部分，一些随机数 - 并确保它不会在服务器端被接受两次。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-24T22:36:58.810

想到了两个服务器端解决方案：

1.  在隐藏的表单字段中创建一次性使用“令牌”。使用令牌后，它将从您存储它的任何数据库或会话上下文对象中删除。第二次，它不被接受。
2.  缓存收到的信息，如果在某个时间段（10 分钟？一个小时？你决定！）内收到相同的表格，它会被忽略。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T22:40:03.763

我们使用时间敏感的一次性票。这就像一个会话ID。但它与表单/页面相关联。

当用户提交页面时，您丢弃票证，并且您只处理带有有效票证的页面。同时，您可以通过将票证附加到用户来加强安全性，因此，如果收到的票证是由不是提交票证的用户的用户提交的，您将拒绝该请求。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-24T22:37:19.590

实现一个 uniqueid 来处理请求并将其与执行一起记录。如果该 id 已被记录，则您不再执行此工作。这有点像后备解决方案 - 您应该尝试禁用按钮或链接客户端以及您自己的建议

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-25T03:10:58.963

如果你碰巧在使用 Struts，它就内置了类似的东西。

[http://struts.apache.org/1.x/apidocs/org/apache/struts/util/TokenProcessor.html](http://struts.apache.org/1.x/apidocs/org/apache/struts/util/TokenProcessor.html)

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-24T22:37:20.540

我会使用时间戳并将值与您的服务器端代码进行比较。如果两个时间戳足够接近并且具有相同的 IP 地址，则忽略第二个表单提交。

# sharepoint - Webpart 功能未添加说明

> ID：130352
> 
> 赞同：0
> 
> 时间：2008-09-24T22:35:18.393
> 
> 标签：sharepoint, deployment, web-parts, moss

我正在将 Web 部件添加到 Web 部件库，作为解决方案中功能的一部分。

将 webpart 添加到库时，webpart 描述字段将被空字符串覆盖。

我在我能想到的所有地方都添加了描述，包括：

1.  Web 部件本身。myWebpart.webpart`<property name="Description" type="string">my description</property>`
2.  特征.xml`Description="mywebpart description"`
3.  特征.xml`<Property Key="Description" Value="mywebpart description"></Property>`
4.  webpartManifest.xml（在特性中指定）`<File ...><Property Name=Description" Value="mywebpart description">`

我已经不知道在哪里放置描述，因此在部署解决方案时它将出现在 Web 部件库的“描述”字段中。

你有什么想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T22:53:50.157

查看以下博客，它描述了整个过程： [在 Sharepoint 站点定义中添加自定义 Web 部件](http://www.sharepointblogs.com/nicksevens/archive/2007/11/23/adding-custom-webparts-in-a-sharepoint-site-definition.aspx)

特别注意自定义属性*TextToDisplay*（我认为您已经完成了所有其他步骤）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T23:03:14.893

实际上，所有步骤都是正确的，只是 webpart 的属性名称被错误拼写为“ **Decriction** ”。

多哈

# testing - 如何模拟低带宽、高延迟的环境？

> ID：130354
> 
> 赞同：216
> 
> 时间：2008-09-24T22:35:23.040
> 
> 标签：testing, bandwidth, latency

我需要模拟到服务器的低带宽、高延迟连接，以便在远程站点模拟 VPN 的条件。带宽和延迟应该是可调整的，因此我可以找到最佳组合来运行我们的软件包。

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2012-03-12T22:37:59.060

对于**macOS**，有一个*Network Link Conditioner*可以模拟可配置的带宽、延迟和数据包丢失。它包含在[Xcode 的附加工具](https://developer.apple.com/download/more/?q=Additional%20Tools%20for%20Xcode)包中。 ![截屏](https://i.stack.imgur.com/FjgqM.png)

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-09-24T22:58:19.303

有一篇关于设置 FreeBSD 机器来执行此操作的优秀文章 - 使用您的标准旧桌面，添加一个额外的 NIC，然后构建。

该文章可在[http://www.freebsd.org/doc/en/articles/filtering-bridges/article.html](http://www.freebsd.org/doc/en/articles/filtering-bridges/article.html)获得。

在上述说明的第 5 步中，您将启用防火墙。对于仅模拟不同的 IP 连接，您可以（例如）执行以下操作：

创建一个`/etc/rc.firewall.56k`包含以下内容的文件：

```
ipfw add pipe 1 ip from any to any out
ipfw add pipe 2 ip from any to any in    
ipfw pipe 1 config bw 56Kbit/s   
ipfw pipe 2 config bw 56Kbit/s 
```

并改变`/etc/rc.conf`......更换线路

```
firewall_type="open" 
```

和

```
firewall_type="/etc/rc.firewall.56k" 
```

重新启动，你就拥有了一个 56K 的网桥！

如果您碰巧在 Macintosh 上工作，该操作系统默认内置了 ipfw。我通过在机场和以太网上路由网络流量来完成同样的事情，将其设置为使来自机场的任何东西都具有与我试图模拟的任何东西相同的特征。您可以直接从终端调用 ipfw 命令并获得相同的效果。

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2008-09-24T22:37:41.303

过去，我使用过使用 Linux [Netem](http://www.linuxfoundation.org/collaborate/workgroups/networking/netem)（网络仿真）功能的网桥。它是高度可配置的——允许引入延迟（第一个示例是 WAN）、丢包、损坏等。

我注意到 Netem 非常适合我的应用程序，但我也多次使用[WANem 。](http://wanem.sourceforge.net/)提供的可引导 ISO（和虚拟设备映像）使其非常方便。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2008-09-24T22:51:18.290

## 查尔斯

我遇到了[Charles](http://www.charlesproxy.com/)的 Web 调试代理应用程序，并在模拟网络延迟方面取得了巨大成功。它适用于 Windows、Mac 和 Linux。

![Mac 上的查尔斯](https://i.stack.imgur.com/hKG29.png)

> ### 带宽节流阀/带宽模拟器
> 
> Charles 可用于调整 Internet 连接的带宽和延迟。这使您能够使用高速连接模拟调制解调器条件。
> 
> 带宽可以限制为每秒任意任意字节。这可以模拟任何连接速度。
> 
> 延迟也可以设置为任意毫秒数。延迟延迟模拟在较慢的连接上经历的延迟，即发出请求和另一端接收请求之间的延迟。

## 虚拟网

您也可以使用 vmware 来运行 BSD 或 Linux，并尝试[这篇文章 (DummyNet)](http://www.myloadtest.com/free-wan-emulator/)或[这篇文章。](http://opensource.sys-con.com/node/295323)

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2015-04-29T07:07:56.520

我发现了这个用于 Windows 的小程序，叫做[clumsy](http://jagt.github.io/clumsy/index.html)。它处于 alpha 状态，但对我来说似乎工作正常，而且它是开源的。

*编辑：*其他人已经注意到你不能用笨拙的方式限制带宽，这是真的。您只能添加延迟和其他一些与网络相关的错误。这将取消此答案作为该问题的有效答案的资格，但是因为当我想模拟一个糟糕的网络时我很好地使用了它，所以只要它有 > 0 票或类似的票数，我就会把它留在这里。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2008-09-24T22:38:19.540

试试[万能](http://wanem.sourceforge.net/)

> WANem 是一个广域网模拟器，旨在在 LAN 环境中的应用程序开发/测试期间提供广域网/互联网的真实体验。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2010-09-25T07:37:42.830

对于 Windows，您可以使用此应用程序：http: [//www.softperfect.com/products/connectionemulator/](http://www.softperfect.com/products/connectionemulator/)

适用于 Windows 2000、XP、2003、Vista、7 和 2008 的 WAN 连接仿真器。

也许是唯一适用于 Windows 的。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-10-01T19:52:07.870

我会尝试在 linux 上使用[netem](http://www.linuxfoundation.org/en/Net:Netem)。使用它，您可以模拟额外的延迟、损坏、数据包丢失和重复。它甚至可以在环回设备上工作。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2010-10-22T11:38:46.233

另一个客户端程序（仅限 Windows）是 NetLimiter - [http://www.netlimiter.com](http://www.netlimiter.com)

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2013-04-06T00:46:07.623

我在我的 Windows 机器上使用 NetBalancer。

[http://seriousbit.com/netbalancer/](http://seriousbit.com/netbalancer/)

**2017-10-07 更新**：NetBalancer 的最后一个免费版本是 9.2.7。该程序有一个硬编码的到期日期。在启动 NetBalancer 服务之前，需要将系统时钟调回 2016-10-18 之前。有关详细信息，请参阅[本文](https://www.raymond.cc/blog/restrict-or-limit-internet-download-and-upload-transfer-speed/)。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2012-07-03T14:27:42.750

使用 Fiddler（免费解决方案）为 Windows 找到了这个 [http://www.logic-worx.com/index.php/tools-and-apps/fiddler-connection-simulator/](http://www.logic-worx.com/index.php/tools-and-apps/fiddler-connection-simulator/)

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2016-05-22T11:18:57.033

我想`tc`可以在基于 UNIX 的平台上完成这项工作。

`tc`用于在Linux内核中配置Traffic Control
[http://lartc.org/manpages/tc.txt](http://lartc.org/manpages/tc.txt)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2016-06-09T10:18:34.847

要模拟低带宽连接以使用 Google Chrome 测试网站，您可以转到 F12 工具中的网络选项卡并选择一个带宽级别来模拟或创建自定义带宽来模拟。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-10-07T14:17:46.610

[http://www.shunra.com](http://www.shunra.com)有一款名为 VE Desktop 的产品，可用于模拟变化的网络条件。它允许您通过简单的 UI 调整延迟、带宽和丢包率。唯一需要注意的是，它不是免费的。希望这可以帮助。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-05-20T16:44:05.013

一段时间以来，我一直在寻找一种易于使用的工具来进行此类测试。前几天我刚遇到这个： [网络延迟模拟器](http://www.akmalabs.com/downloads_netsim.php)

如果你运行的是 Windows，你应该检查一下。设置和开始使用非常容易，而且看起来效果很好。它允许您定义每个方向的带宽、延迟和数据包丢失。另一个非常好的事情是您可以定义“流量匹配条件”，以便它只影响您想要的流量。哦，是的，而且它是免费的。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-10-01T19:58:21.063

如果您使用的是 linux，我发现[Traffic Control](http://tldp.org/HOWTO/Traffic-Control-HOWTO/)程序对这类事情有很大帮助。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2013-03-31T23:09:18.640

我想我找到了我需要的东西。也许您可以使用[charles proxy](http://www.charlesproxy.com/)或[slowy](http://www.slowyapp.com)。希望能帮助到你。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2016-03-18T12:27:09.573

看看 NE-ONE 网络仿真器，它允许您配置带宽、延迟、数据包丢失、数据包重新排序、数据包复制、数据包分段、网络拥塞和更多损伤，以便您可以在实验室中创建真实的网络条件. 可以为上行链路和下行链路配置不同的损伤，因此您可以获得非常好的上行链路但非常糟糕的下行链路体验，非常适合查看应用程序如何处理 TCP 队列，因为 ack 不会及时返回以及整体延迟因此增加！

这里有一个概述视频[http://www.youtube.com/watch?v=DwtqlE7LcrQ](http://www.youtube.com/watch?v=DwtqlE7LcrQ)专门针对游戏开发人员，但它显示了它的内容。NE-ONE 使用网络浏览器进行配置，因此安装和配置非常容易 - 您无需成为网络专家 :-)

有一个硬件版本 - [http://www.itrinegy.com/index.php/products/network-emulators/ne-one](http://www.itrinegy.com/index.php/products/network-emulators/ne-one) - 或者您可以下载在 VMware ESXi Server 下运行的虚拟设备（软件）版本。可以从 VMware 的解决方案交换处下载虚拟设备 - solutionexchange.vmware.com/store/products/ne-one-flex-network-emulator

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-08-04T10:23:26.737

你可以试试这个：[CovenantSQL/GNTE](https://github.com/CovenantSQL/GNTE) 只需像这样编写 YAML：

```
group:
  - 
    name: china
    nodes:
      - 
        ip: 10.250.1.2
        cmd: "cd /scripts && ./YourBin args"
      - 
        ip: 10.250.1.3
        cmd: "cd /scripts && ./YourBin args"
    delay: "100ms 10ms 30%"
    loss: "1% 10%"
  - 
    name: us
    nodes:
      - 
        ip: 10.250.2.2
        cmd: "cd /scripts && ./YourBin args"
      - 
        ip: 10.250.2.3
        cmd: "cd /scripts && ./YourBin args"
    delay: "1000ms 10ms 30%"
    loss: "1% 10%"

network:
  -
    groups:
      - china
      - us
    delay: "200ms 10ms 1%"
    corrupt: "0.2%"
    rate: "10mbit" 
```

跑`./generate scripts/your.yaml`

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2016-08-15T22:30:09.137

LANforge ICE 是一个[网络仿真器](http://www.candelatech.com/emulate.php) ，强调虚拟路由、抖动、损坏和延迟。项目已使用它来模拟卫星链路、电缆和调制解调器连接，以及高速 (10Gbit) WAN 模拟。您可以使用 Java GUI 来构建您的虚拟网络并生成非常详细的流量报告。LANforge 产品还提供流量生成功能：帧、以太网、第 3 层和有状态流量（NFS、http）。LANforge 的最新版本也具有复杂的 WiFi 测试功能。

# visual-studio - 您可以将 Visual Studio 源代码控制绑定信息保留在 .sln 和 .csproj 文件之外吗？

> ID：130358
> 
> 赞同：2
> 
> 时间：2008-09-24T22:36:42.273
> 
> 标签：visual-studio, version-control, ankhsvn

我的 Visual Studio 2005 将有关哪些项目和解决方案与 .sln 和 .csproj 文件中的哪些源代码管理存储库一起存储的信息。是否可以将绑定信息存储在某个外部文件中？

我希望将信息存储在解决方案/项目文件之外的原因是为了方便试用 AnknSVN 插件。现在我们的所有东西都在 VSS 6 中，但我想维护 SVN 存储库的实验副本，然后使用此处描述的想法手动同步两者：

[http://www.dotnet6.com/blogs/jeroen/archive/2008/04/05/using-subversion-in-a-vss-only-shop.aspx](http://www.dotnet6.com/blogs/jeroen/archive/2008/04/05/using-subversion-in-a-vss-only-shop.aspx)

不幸的是，将绑定存储在 .sln 文件（例如）中会引发麻烦。为了说明，假设我将整个 VSS 存储库复制到一个并行的 SVN 实例中。现在我使用 AnknSvn 在 Visual Studio 中打开 SVN 的主要解决方案；在这个过程中，AnkhSvn 会将 .sln 文件中的源代码控制绑定信息更改为指向 SVN。接下来假设我向解决方案添加了一个新项目 P1。这将导致 Visual Studio 第二次修改 .sln 文件，注意 P1 的存在。假设此时我想将我在 SVN 副本中所做的更改同步回 VSS 存储库。如果源代码控制绑定没有存储在 .sln 文件中，那也不会太糟糕。但是，.sln 文件现在有两个不同的更改，我想将 project-add 更改传播回 VSS，但我没有 不想将源代码控制绑定更改传播回 VSS，因为这会破坏所有 VSS 用户的构建！我不认为没有其他人工干预就可以传播一个更改。相反，如果 Visual Studio 只是将绑定信息存储在 .sln 文件之外，那么我确实希望将所有 .sln 文件更改传播回 VSS，这样就可以了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-24T22:40:26.227

VisualSVN 不使用本机源代码控制生态系统插件 (SCC)，因此不会污染您的解决方案或项目文件。它是商业许可的，但非常合理 < 50 美元。因此允许您继续使用讨厌的 VSS（尽管理想情况下排除 .svn 目录）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T23:12:26.323

AnkhSVN 2.0 有两种操作模式。

*   已连接（推荐）。这将绑定信息存储在 .sln 和可选的项目文件中。
*   断开连接。这不存储绑定。

您可以在 File->Subversion->Change Source Control 中连接和断开解决方案和单个项目。

连接的优点是：

*   打开解决方案时在 SCC 提供商之间自动切换（例如在 VSS、TFS 和 AnkhSVN 之间）
*   兼容所有实现 SCC 支持的项目类型。
*   (2.1+) 自动处理主要工作副本之外的项目。（例如 c:\inetpub 中的网站）

注意：如果您之前在解决方案上使用过 AnkhSVN 1.X，您应该手动删除您的 Ankh.load 文件。当 AnkhSVN 2.0 看到 Ankh.load 文件时，它会自动连接您的解决方案。

[跟进：]
在另一个 SCC 实现旁边使用 AnkhSVN 的一种简单方法是创建一个额外的 .sln 文件。AnkhSVN 不使用单个项目的 SCC 字段中的实际值。（只需插入它们即可启用项目以进行完整的 SCC 管理）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T22:44:26.357

一位同事为删除绑定编写了这个 NAnt 任务

[http://www.atalasoft.com/cs/blogs/jake/archive/2008/05/21/2custom-nant-task-for-removing-tfs-bindings.aspx](http://www.atalasoft.com/cs/blogs/jake/archive/2008/05/21/2custom-nant-task-for-removing-tfs-bindings.aspx)

您可能会适应自定义构建步骤或其他脚本来帮助您。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T22:44:48.930

IIRC AnkhSVN 和 VSS 都严格通过 .sln / .csproj 文件实现版本控制绑定（VS 的版本控制插件接口便于这种存储）。因此，简短的回答是否定的。

但是，您仍然可以使用 subversion 作为外部版本控制解决方案，就安全性和稳定性而言，VSS 使用命令行（这[本书](http://svnbook.red-bean.com/)是您的朋友）或[TortoiseSVN](http://tortoisesvn.tigris.org/)会好得多。

# javascript - JavaScript中有常量吗？

> ID：130396
> 
> 赞同：1169
> 
> 时间：2008-09-24T22:45:05.233
> 
> 标签：javascript, constants

有没有办法在**JavaScript**中使用常量？

如果不是，那么指定用作常量的变量的常见做法是什么？

* * *

## 回答 #1

> 赞同：1034
> 
> 时间：2008-09-24T22:46:03.687

从[ES2015 开始](https://www.ecma-international.org/ecma-262/6.0/)，JavaScript 有一个概念[`const`](https://www.ecma-international.org/ecma-262/6.0/#sec-let-and-const-declarations)：

```
const MY_CONSTANT = "some-value"; 
```

这[几乎适用于除 IE 8、9 和 10 之外的所有浏览器](https://caniuse.com/#search=const)。有些可能还需要启用[严格模式。](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode)

如果您需要支持旧版浏览器或使用遗留代码，您可以使用`var`ALL_CAPS 等约定来表明不应修改某些值：

```
var MY_CONSTANT = "some-value"; 
```

* * *

## 回答 #2

> 赞同：315
> 
> 时间：2008-09-25T03:14:30.750

您是否试图保护变量不被修改？如果是这样，那么您可以使用模块模式：

```
var CONFIG = (function() {
     var private = {
         'MY_CONST': '1',
         'ANOTHER_CONST': '2'
     };

     return {
        get: function(name) { return private[name]; }
    };
})();

alert('MY_CONST: ' + CONFIG.get('MY_CONST'));  // 1

CONFIG.MY_CONST = '2';
alert('MY_CONST: ' + CONFIG.get('MY_CONST'));  // 1

CONFIG.private.MY_CONST = '2';                 // error
alert('MY_CONST: ' + CONFIG.get('MY_CONST'));  // 1 
```

使用这种方法，无法修改这些值。但是，您必须在 CONFIG 上使用 get() 方法:(。

如果您不需要严格保护变量值，则按照建议进行操作并使用全部大写的约定。

* * *

## 回答 #3

> 赞同：123
> 
> 时间：2009-03-26T20:29:50.643

该`const`关键字在[ECMAScript 6 草案](http://wiki.ecmascript.org/doku.php?id=harmony:const)中，但到目前为止它只享有少量的浏览器支持： http: [//kangax.github.io/compat-table/es6/](http://kangax.github.io/compat-table/es6/)。语法是：

```
const CONSTANT_NAME = 0; 
```

* * *

## 回答 #4

> 赞同：71
> 
> 时间：2014-05-04T23:58:25.097

```
"use strict";

var constants = Object.freeze({
    "π": 3.141592653589793 ,
    "e": 2.718281828459045 ,
    "i": Math.sqrt(-1)
});

constants.π;        // -> 3.141592653589793
constants.π = 3;    // -> TypeError: Cannot assign to read only property 'π' …
constants.π;        // -> 3.141592653589793

delete constants.π; // -> TypeError: Unable to delete property.
constants.π;        // -> 3.141592653589793 
```

请参阅[Object.freeze](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze)。如果您也想将参考设为只读，则可以[使用。`const`](https://stackoverflow.com/a/687457/822138)`constants`

* * *

## 回答 #5

> 赞同：64
> 
> 时间：2009-10-26T19:22:46.680

IE 确实支持常量，例如：

```
<script language="VBScript">
 Const IE_CONST = True
</script>
<script type="text/javascript">
 if (typeof TEST_CONST == 'undefined') {
    const IE_CONST = false;
 }
 alert(IE_CONST);
</script> 
```

* * *

## 回答 #6

> 赞同：59
> 
> 时间：2011-01-09T00:41:34.273

ECMAScript 5 确实引入了[`Object.defineProperty`](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object/defineProperty)：

```
Object.defineProperty (window,'CONSTANT',{ value : 5, writable: false }); 
```

[每个现代浏览器](http://kangax.github.io/compat-table/es5/)（以及 IE ≥ 9）都支持它。

另请参阅：[ES5 中的 Object.defineProperty？](https://stackoverflow.com/questions/3830800/object-defineproperty-in-es5)

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2008-09-24T22:45:51.440

不，一般不会。Firefox 实现了`const`，但我知道 IE 没有。

* * *

[**@John**](https://stackoverflow.com/questions/130396#130399)指出了多年来在其他语言中使用的 consts 的常见命名实践，我看不出你为什么不能使用它。当然，这并不意味着无论如何都不会有人改写变量的值。:)

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2010-11-24T19:46:52.457

在 JavaScript 中，我的偏好是使用函数来返回常量值。

```
function MY_CONSTANT() {
   return "some-value";
}

alert(MY_CONSTANT()); 
```

* * *

## 回答 #9

> 赞同：20
> 
> 时间：2011-04-30T09:57:54.770

[Mozilla 的 MDN Web 文档](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const)包含关于`const`. 摘抄：

```
// define MY_FAV as a constant and give it the value 7
const MY_FAV = 7;

// this will throw an error - Uncaught TypeError: Assignment to constant variable.
MY_FAV = 20; 
```

但遗憾的是IE9/10仍然不支持`const`。这很[荒谬](http://blogs.msdn.com/b/ie/archive/2010/08/25/chakra-interoperability-means-more-than-just-standards.aspx)的原因是：

> 那么，IE9 对 const 做了什么？到目前为止，我们的决定是不支持它。它还不是一个共识功能，因为它从未在所有浏览器上可用。
> 
> ...
> 
> 最后，对于网络而言，最好的长期解决方案似乎是将其排除在外，然后等待标准化进程运行。

他们没有实现它是因为其他浏览器没有正确实现它？！太害怕让它变得更好？标准定义与否，常量就是常量：设置一次，永不更改。

对于所有想法：每个功能都可以被覆盖（XSS 等）。`var`所以or没有区别`function(){return}`。`const`是唯一的实常数。

更新：IE11[支持](https://blogs.msdn.microsoft.com/ie/2013/11/07/ie11-for-windows-7-globally-available-for-consumers-and-businesses/) `const`：

> IE11 包括对新兴 ECMAScript 6 标准中定义明确且常用的特性的支持，包括 let、**`const`**、`Map`、`Set`和`WeakMap`，以及`__proto__`改进的互操作性。

* * *

## 回答 #10

> 赞同：17
> 
> 时间：2012-11-02T11:45:03.487

使用“新”对象 api，您可以执行以下操作：

```
var obj = {};
Object.defineProperty(obj, 'CONSTANT', {
  configurable: false
  enumerable: true,
  writable: false,
  value: "your constant value"
}); 
```

在Mozilla MDN 上查看更多细节[。](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/defineProperty)它不是第一级变量，因为它附加到一个对象，但如果你有一个范围，任何东西，你可以将它附加到那个。`this`应该也可以。因此，例如在全局范围内执行此操作将在窗口上声明一个伪常量值（这是一个非常糟糕的主意，您不应该粗心地声明全局变量）

```
Object.defineProperty(this, 'constant', {
  enumerable: true, 
  writable: false, 
  value: 7, 
  configurable: false
});

> constant
=> 7
> constant = 5
=> 7 
```

注意：赋值将在控制台中返回分配的值，但变量的值不会改变

* * *

## 回答 #11

> 赞同：17
> 
> 时间：2013-12-30T19:42:39.353

如果您不介意使用函数：

```
var constant = function(val) {
   return function() {
        return val;
    }
} 
```

这种方法为您提供函数而不是常规变量，但它保证^*一旦设置了值，就没有人可以更改该值。

```
a = constant(10);

a(); // 10

b = constant(20);

b(); // 20 
```

我个人觉得这很令人愉快，特别是在从淘汰赛观察到习惯了这种模式之后。

^([*除非有人`constant`在你调用它之前重新定义了这个函数])

* * *

## 回答 #12

> 赞同：14
> 
> 时间：2011-07-19T05:10:32.403

忘记 IE 并使用`const`关键字。

* * *

## 回答 #13

> 赞同：14
> 
> 时间：2015-07-02T13:12:50.133

尽可能将常量分组到结构中：

例如，在我当前的游戏项目中，我使用了以下内容：

```
var CONST_WILD_TYPES = {
    REGULAR: 'REGULAR',
    EXPANDING: 'EXPANDING',
    STICKY: 'STICKY',
    SHIFTING: 'SHIFTING'
}; 
```

任务：

```
var wildType = CONST_WILD_TYPES.REGULAR; 
```

比较：

```
if (wildType === CONST_WILD_TYPES.REGULAR) {
    // do something here
} 
```

最近我正在使用，用于比较：

```
switch (wildType) {
    case CONST_WILD_TYPES.REGULAR:
        // do something here
        break;
    case CONST_WILD_TYPES.EXPANDING:
        // do something here
        break;
} 
```

IE11 采用具有“const”声明的新 ES6 标准。
以上适用于早期的浏览器，如 IE8、IE9 和 IE10。

* * *

## 回答 #14

> 赞同：12
> 
> 时间：2011-04-08T07:15:46.167

您可以轻松地为您的脚本配备一种可以设置但不能更改的常量机制。尝试更改它们将产生错误。

```
/* author Keith Evetts 2009 License: LGPL  
anonymous function sets up:  
global function SETCONST (String name, mixed value)  
global function CONST (String name)  
constants once set may not be altered - console error is generated  
they are retrieved as CONST(name)  
the object holding the constants is private and cannot be accessed from the outer script directly, only through the setter and getter provided  
*/

(function(){  
  var constants = {};  
  self.SETCONST = function(name,value) {  
      if (typeof name !== 'string') { throw new Error('constant name is not a string'); }  
      if (!value) { throw new Error(' no value supplied for constant ' + name); }  
      else if ((name in constants) ) { throw new Error('constant ' + name + ' is already defined'); }   
      else {   
          constants[name] = value;   
          return true;  
    }    
  };  
  self.CONST = function(name) {  
      if (typeof name !== 'string') { throw new Error('constant name is not a string'); }  
      if ( name in constants ) { return constants[name]; }    
      else { throw new Error('constant ' + name + ' has not been defined'); }  
  };  
}())  

// -------------  demo ----------------------------  
SETCONST( 'VAT', 0.175 );  
alert( CONST('VAT') );

//try to alter the value of VAT  
try{  
  SETCONST( 'VAT', 0.22 );  
} catch ( exc )  {  
   alert (exc.message);  
}  
//check old value of VAT remains  
alert( CONST('VAT') );  

// try to get at constants object directly  
constants['DODO'] = "dead bird";  // error 
```

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2013-02-06T07:06:41.113

然而，没有确切的跨浏览器预​​定义的方法来做到这一点，您可以通过控制变量的范围来实现它，如其他答案所示。

但我会建议使用名称空间来区分其他变量。这会将其他变量的碰撞几率降至最低。

适当的命名空间，如

```
var iw_constant={
     name:'sudhanshu',
     age:'23'
     //all varibale come like this
} 
```

所以在使用它时将是`iw_constant.name`或`iw_constant.age`

您还可以使用 Object.freeze 方法阻止添加任何新键或更改 iw_constant 中的任何键。但是，旧版浏览器不支持它。

前任：

```
Object.freeze(iw_constant); 
```

对于较旧的浏览器，您可以使用[polyfill](https://stackoverflow.com/questions/13117771/javascript-object-doesnt-support-method-freeze)进行冻结方法。

* * *

如果您对调用函数没问题，那么以下是定义常量的最佳跨浏览器方式。在自执行函数中限定对象并为常量返回 get 函数，例如：

```
var iw_constant= (function(){
       var allConstant={
             name:'sudhanshu',
             age:'23'
             //all varibale come like this

       };

       return function(key){
          allConstant[key];
       }
    }; 
```

//获取值使用 `iw_constant('name')`或`iw_constant('age')`

* * *

** 在这两个示例中，您必须非常小心名称间距，以免您的对象或函数被其他库替换。（如果对象或函数本身将被替换，您的整个常量将消失）

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2008-09-24T23:29:59.557

`with()`有一段时间，我在传递给语句的对象文字中指定了“常量”（实际上仍然不是常量） 。我以为它很聪明。这是一个例子：

```
with ({
    MY_CONST : 'some really important value'
}) {
    alert(MY_CONST);
} 
```

过去，我还创建了一个`CONST`命名空间，用于放置所有常量。再次，与开销。嘘。

`var MY_CONST = 'whatever';`现在，我只做[KISS](http://en.wikipedia.org/wiki/KISS_principle)。

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2012-10-29T09:01:14.797

我的意见（仅适用于对象）。

```
var constants = (function(){
  var a = 9;

  //GLOBAL CONSTANT (through "return")
  window.__defineGetter__("GCONST", function(){
    return a;
  });

  //LOCAL CONSTANT
  return {
    get CONST(){
      return a;
    }
  }
})();

constants.CONST = 8; //9
alert(constants.CONST); //9 
```

尝试！但请理解 - 这是对象，但不是简单的变量。

也试试：

```
const a = 9; 
```

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2012-08-03T04:23:33.430

我也有这个问题。在寻找答案并查看每个人的所有回复之后，我想我已经想出了一个可行的解决方案。

似乎我遇到的大多数答案都是使用函数来保存常量。正如许多论坛的许多用户所发布的那样，客户端的用户可以轻松地覆盖这些功能。我对 Keith Evetts 的回答很感兴趣，即常量对象不能被外部访问，只能从内部的函数访问。

所以我想出了这个解决方案：

将所有内容都放在匿名函数中，这样客户端就不能更改变量、对象等。还可以通过让其他函数从内部调用“真实”函数来隐藏“真实”函数。我还想过使用函数来检查客户端的用户是否更改了函数。如果功能已更改，请使用内部“受保护”且无法更改的变量将其更改回来。

```
/*Tested in: IE 9.0.8; Firefox 14.0.1; Chrome 20.0.1180.60 m; Not Tested in Safari*/

(function(){
  /*The two functions _define and _access are from Keith Evetts 2009 License: LGPL (SETCONST and CONST).
    They're the same just as he did them, the only things I changed are the variable names and the text
    of the error messages.
  */

  //object literal to hold the constants
  var j = {};

  /*Global function _define(String h, mixed m). I named it define to mimic the way PHP 'defines' constants.
    The argument 'h' is the name of the const and has to be a string, 'm' is the value of the const and has
    to exist. If there is already a property with the same name in the object holder, then we throw an error.
    If not, we add the property and set the value to it. This is a 'hidden' function and the user doesn't
    see any of your coding call this function. You call the _makeDef() in your code and that function calls
    this function.    -    You can change the error messages to whatever you want them to say.
  */
  self._define = function(h,m) {
      if (typeof h !== 'string') { throw new Error('I don\'t know what to do.'); }
      if (!m) { throw new Error('I don\'t know what to do.'); }
      else if ((h in j) ) { throw new Error('We have a problem!'); }
      else {
          j[h] = m;
          return true;
    }
  };

  /*Global function _makeDef(String t, mixed y). I named it makeDef because we 'make the define' with this
    function. The argument 't' is the name of the const and doesn't need to be all caps because I set it
    to upper case within the function, 'y' is the value of the value of the const and has to exist. I
    make different variables to make it harder for a user to figure out whats going on. We then call the
    _define function with the two new variables. You call this function in your code to set the constant.
    You can change the error message to whatever you want it to say.
  */
  self._makeDef = function(t, y) {
      if(!y) { throw new Error('I don\'t know what to do.'); return false; }
      q = t.toUpperCase();
      w = y;
      _define(q, w);
  };

  /*Global function _getDef(String s). I named it getDef because we 'get the define' with this function. The
    argument 's' is the name of the const and doesn't need to be all capse because I set it to upper case
    within the function. I make a different variable to make it harder for a user to figure out whats going
    on. The function returns the _access function call. I pass the new variable and the original string
    along to the _access function. I do this because if a user is trying to get the value of something, if
    there is an error the argument doesn't get displayed with upper case in the error message. You call this
    function in your code to get the constant.
  */
  self._getDef = function(s) {
      z = s.toUpperCase();
      return _access(z, s);
  };

  /*Global function _access(String g, String f). I named it access because we 'access' the constant through
    this function. The argument 'g' is the name of the const and its all upper case, 'f' is also the name
    of the const, but its the original string that was passed to the _getDef() function. If there is an
    error, the original string, 'f', is displayed. This makes it harder for a user to figure out how the
    constants are being stored. If there is a property with the same name in the object holder, we return
    the constant value. If not, we check if the 'f' variable exists, if not, set it to the value of 'g' and
    throw an error. This is a 'hidden' function and the user doesn't see any of your coding call this
    function. You call the _getDef() function in your code and that function calls this function.
    You can change the error messages to whatever you want them to say.
  */
  self._access = function(g, f) {
      if (typeof g !== 'string') { throw new Error('I don\'t know what to do.'); }
      if ( g in j ) { return j[g]; }
      else { if(!f) { f = g; } throw new Error('I don\'t know what to do. I have no idea what \''+f+'\' is.'); }
  };

  /*The four variables below are private and cannot be accessed from the outside script except for the
    functions inside this anonymous function. These variables are strings of the four above functions and
    will be used by the all-dreaded eval() function to set them back to their original if any of them should
    be changed by a user trying to hack your code.
  */
  var _define_func_string = "function(h,m) {"+"      if (typeof h !== 'string') { throw new Error('I don\\'t know what to do.'); }"+"      if (!m) { throw new Error('I don\\'t know what to do.'); }"+"      else if ((h in j) ) { throw new Error('We have a problem!'); }"+"      else {"+"          j[h] = m;"+"          return true;"+"    }"+"  }";
  var _makeDef_func_string = "function(t, y) {"+"      if(!y) { throw new Error('I don\\'t know what to do.'); return false; }"+"      q = t.toUpperCase();"+"      w = y;"+"      _define(q, w);"+"  }";
  var _getDef_func_string = "function(s) {"+"      z = s.toUpperCase();"+"      return _access(z, s);"+"  }";
  var _access_func_string = "function(g, f) {"+"      if (typeof g !== 'string') { throw new Error('I don\\'t know what to do.'); }"+"      if ( g in j ) { return j[g]; }"+"      else { if(!f) { f = g; } throw new Error('I don\\'t know what to do. I have no idea what \\''+f+'\\' is.'); }"+"  }";

  /*Global function _doFunctionCheck(String u). I named it doFunctionCheck because we're 'checking the functions'
    The argument 'u' is the name of any of the four above function names you want to check. This function will
    check if a specific line of code is inside a given function. If it is, then we do nothing, if not, then
    we use the eval() function to set the function back to its original coding using the function string
    variables above. This function will also throw an error depending upon the doError variable being set to true
    This is a 'hidden' function and the user doesn't see any of your coding call this function. You call the
    doCodeCheck() function and that function calls this function.    -    You can change the error messages to
    whatever you want them to say.
  */
  self._doFunctionCheck = function(u) {
      var errMsg = 'We have a BIG problem! You\'ve changed my code.';
      var doError = true;
      d = u;
      switch(d.toLowerCase())
      {
           case "_getdef":
               if(_getDef.toString().indexOf("z = s.toUpperCase();") != -1) { /*do nothing*/ }
               else { eval("_getDef = "+_getDef_func_string); if(doError === true) { throw new Error(errMsg); } }
               break;
           case "_makedef":
               if(_makeDef.toString().indexOf("q = t.toUpperCase();") != -1) { /*do nothing*/ }
               else { eval("_makeDef = "+_makeDef_func_string); if(doError === true) { throw new Error(errMsg); } }
               break;
           case "_define":
               if(_define.toString().indexOf("else if((h in j) ) {") != -1) { /*do nothing*/ }
               else { eval("_define = "+_define_func_string); if(doError === true) { throw new Error(errMsg); } }
               break;
           case "_access":
               if(_access.toString().indexOf("else { if(!f) { f = g; }") != -1) { /*do nothing*/ }
               else { eval("_access = "+_access_func_string); if(doError === true) { throw new Error(errMsg); } }
               break;
           default:
                if(doError === true) { throw new Error('I don\'t know what to do.'); }
      }
  };

  /*Global function _doCodeCheck(String v). I named it doCodeCheck because we're 'doing a code check'. The argument
    'v' is the name of one of the first four functions in this script that you want to check. I make a different
    variable to make it harder for a user to figure out whats going on. You call this function in your code to check
    if any of the functions has been changed by the user.
  */
  self._doCodeCheck = function(v) {
      l = v;
      _doFunctionCheck(l);
  };
}()) 
```

似乎安全性确实是一个问题，并且没有办法从客户端“隐藏”您的编程。对我来说一个好主意是压缩你的代码，这样任何人，包括你，程序员，都很难阅读和理解它。您可以访问一个站点：http: [//javascriptcompressor.com/](http://javascriptcompressor.com/)。（这不是我的网站，别担心我不是在做广告。）这是一个可以让您免费压缩和混淆 Javascript 代码的网站。

1.  复制上述脚本中的所有代码并将其粘贴到 javascriptcompressor.com 页面的顶部文本区域中。
2.  选中 Base62 编码复选框，选中 Shrink Variables 复选框。
3.  按压缩按钮。
4.  将其全部粘贴并保存在 .js 文件中，然后将其添加到页面头部的页面中。

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2012-11-10T22:39:23.907

很明显，这表明需要一个标准化的跨浏览器 const 关键字。

但现在：

```
var myconst = value; 
```

或者

```
Object['myconst'] = value; 
```

两者似乎都足够了，其他任何事情都像是用火箭筒射击苍蝇。

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2008-09-24T22:49:33.350

我在我的 Greasemonkey 脚本中使用`const`而不是`var`，但这是因为它们只能在 Firefox 上运行......
命名约定也确实是要走的路（我两者都做！）。

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2011-01-17T14:07:36.600

在 JavaScript 中，我的做法是尽可能避免使用常量，而是使用字符串。当您想将常量暴露给外界时，会出现常量问题：

例如，可以实现以下 Date API：

```
date.add(5, MyModule.Date.DAY).add(12, MyModule.Date.HOUR) 
```

但是简单地写成更短更自然：

```
date.add(5, "days").add(12, "hours") 
```

这样，“天”和“小时”实际上就像常数一样，因为您无法从外部更改“小时”代表多少秒。但是很容易被覆盖`MyModule.Date.HOUR`。

这种方法也有助于调试。如果 Firebug 告诉您`action === 18`，很难弄清楚它的含义，但是当您看到时，`action === "save"`它会立即清晰。

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2011-06-28T04:39:48.040

好吧，这很难看，但它在 Firefox 和 Chromium 中给了我一个常量，在 Safari 和 Opera 中给了我一个不定常量（WTF？），在 IE 中给了我一个变量。

当然 eval() 是邪恶的，但没有它，IE 会抛出错误，阻止脚本运行。

Safari 和 Opera 支持 const 关键字，但*您可以更改 const 的值*。

在此示例中，服务器端代码将 JavaScript 写入页面，将 {0} 替换为一个值。

```
try{
    // i can haz const?
    eval("const FOO='{0}';");
    // for reals?
    var original=FOO;
    try{
        FOO='?NO!';
    }catch(err1){
        // no err from Firefox/Chrome - fails silently
        alert('err1 '+err1);
    }
    alert('const '+FOO);
    if(FOO=='?NO!'){
        // changed in Sf/Op - set back to original value
        FOO=original;
    }
}catch(err2){
    // IE fail
    alert('err2 '+err2);
    // set var (no var keyword - Chrome/Firefox complain about redefining const)
    FOO='{0}';
    alert('var '+FOO);
}
alert('FOO '+FOO); 
```

这有什么好处？不多，因为它不是跨浏览器。*充其量，至少有些*浏览器不会让小书签或第三方脚本修改该值，这可能会让您放心。

使用 Firefox 2、3、3.6、4、Iron 8、Chrome 10、12、Opera 11、Safari 5、IE 6、9 测试。

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2014-12-25T10:52:27.237

[伯克答案](https://stackoverflow.com/a/131286/704144)的改进版本，可让您`CONFIG.MY_CONST`代替`CONFIG.get('MY_CONST')`.

它需要 IE9+ 或真正的网络浏览器。

```
var CONFIG = (function() {
    var constants = {
        'MY_CONST': 1,
        'ANOTHER_CONST': 2
    };

    var result = {};
    for (var n in constants)
        if (constants.hasOwnProperty(n))
            Object.defineProperty(result, n, { value: constants[n] });

    return result;
}()); 
```

[** 属性是只读的，仅当初始值不可变时。*]

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2014-12-25T11:16:26.740

如果值得一提，您可以使用[angular定义常量](http://angularjs.org/)[`$provide.constant()`](https://docs.angularjs.org/api/auto/service/$provide#constant)

```
angularApp.constant('YOUR_CONSTANT', 'value'); 
```

* * *

## 回答 #25

> 赞同：4
> 
> 时间：2016-06-13T02:44:36.570

JavaScript ES6（重新）引入了[所有主流浏览器](http://caniuse.com/#feat=const)都支持的[`const`关键字](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Statements/const)。

> 通过声明的变量`const`不能重新声明或重新分配。

除此之外，`const`行为类似于[`let`](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Statements/let).

对于原始数据类型（Boolean、Null、Undefined、Number、String、Symbol），它的行为与预期的一样：

```
const x = 1;
x = 2;
console.log(x); // 1 ...as expected, re-assigning fails 
```

**注意：**注意关于对象的陷阱：

```
const o = {x: 1};
o = {x: 2};
console.log(o); // {x: 1} ...as expected, re-assigning fails

o.x = 2;
console.log(o); // {x: 2} !!! const does not make objects immutable!

const a = [];
a = [1];
console.log(a); // 1 ...as expected, re-assigning fails

a.push(1);
console.log(a); // [1] !!! const does not make objects immutable 
```

如果您真的需要一个不可变且绝对恒定的对象：只需使用`const ALL_CAPS`来明确您的意图。无论如何，对所有声明都遵循一个很好的约定`const`，所以请依赖它。

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2014-08-28T11:42:54.267

另一种选择是：

```
var constants = {
      MY_CONSTANT : "myconstant",
      SOMETHING_ELSE : 123
    }
  , constantMap = new function ConstantMap() {};

for(var c in constants) {
  !function(cKey) {
    Object.defineProperty(constantMap, cKey, {
      enumerable : true,
      get : function(name) { return constants[cKey]; }
    })
  }(c);
} 
```

然后简单地说：`var foo = constantMap.MY_CONSTANT`

如果您要这样做，`constantMap.MY_CONSTANT = "bar"`因为我们正在尝试使用带有 getter 的赋值运算符，所以它不会产生任何影响，因此`constantMap.MY_CONSTANT === "myconstant"`仍然是正确的。

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2015-05-04T15:50:43.043

在 Javascript 中已经存在[常量](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const)。你定义一个像这样的常量：

```
const name1 = value; 
```

这不能通过重新分配来改变。

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2015-07-28T10:52:22.947

关键字 'const' 是较早提出的，现在它已正式包含在 ES6 中。通过使用 const 关键字，您可以传递将充当不可变字符串的值/字符串。

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2012-02-10T06:12:25.960

在 JavaScript 中引入常量充其量只是一种 hack。

在 JavaScript 中创建持久且全局可访问的值的一种好方法是声明一个具有一些“只读”属性的对象字面量，如下所示：

```
 my={get constant1(){return "constant 1"},
                get constant2(){return "constant 2"},
                get constant3(){return "constant 3"},
                get constantN(){return "constant N"}
                } 
```

您会将所有常量组合在一个“我的”附件对象中，您可以在其中查找存储的值或您可能决定为此放置的任何其他内容。现在让我们测试它是否有效：

```
 my.constant1; >> "constant 1" 
           my.constant1 = "new constant 1";
           my.constant1; >> "constant 1" 
```

正如我们所见，“my.constant1”属性保留了它的原始值。您已经为自己制作了一些不错的“绿色”临时常量...

但当然，这只会防止您意外修改、更改、取消或清空您的属性常量值，如给定示例中的直接访问。

否则我仍然认为常量是假人。而且我仍然认为，用你的巨大自由来换取一个具有欺骗性的安全的小角落是最糟糕的交易。

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2012-11-05T15:51:26.487

`Rhino.js``const`除了上面提到的之外，还可以实现。

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2013-09-23T08:40:16.740

const 关键字在 javscript 语言中可用，但不支持 IE 浏览器。休息所有支持的浏览器。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2015-05-01T20:19:15.160

Checkout [https://www.npmjs.com/package/constjs](https://www.npmjs.com/package/constjs)，它提供了三个函数来创建枚举、字符串常量和位图。返回的结果要么[被冻结](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze)要么被[密封](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/seal)，因此您不能在创建属性后更改/删除它们，也不能向返回的结果添加新属性

创建枚举：

```
var ConstJs = require('constjs');

var Colors = ConstJs.enum("blue red");

var myColor = Colors.blue;

console.log(myColor.isBlue()); // output true 
console.log(myColor.is('blue')); // output true 
console.log(myColor.is('BLUE')); // output true 
console.log(myColor.is(0)); // output true 
console.log(myColor.is(Colors.blue)); // output true 

console.log(myColor.isRed()); // output false 
console.log(myColor.is('red')); // output false 

console.log(myColor._id); // output blue 
console.log(myColor.name()); // output blue 
console.log(myColor.toString()); // output blue 

// See how CamelCase is used to generate the isXxx() functions 
var AppMode = ConstJs.enum('SIGN_UP, LOG_IN, FORGOT_PASSWORD');
var curMode = AppMode.LOG_IN;

console.log(curMode.isLogIn()); // output true 
console.log(curMode.isSignUp()); // output false 
console.log(curMode.isForgotPassword()); // output false 
```

创建字符串常量：

```
var ConstJs = require('constjs');

var Weekdays = ConstJs.const("Mon, Tue, Wed");
console.log(Weekdays); // output {Mon: 'Mon', Tue: 'Tue', Wed: 'Wed'} 

var today = Weekdays.Wed;
console.log(today); // output: 'Wed'; 
```

创建位图：

```
var ConstJs = require('constjs');

var ColorFlags = ConstJs.bitmap("blue red");
console.log(ColorFlags.blue); // output false 

var StyleFlags = ConstJs.bitmap(true, "rustic model minimalist");
console.log(StyleFlags.rustic); // output true 

var CityFlags = ConstJs.bitmap({Chengdu: true, Sydney: false});
console.log(CityFlags.Chengdu); //output true 
console.log(CityFlags.Sydney); // output false 

var DayFlags = ConstJs.bitmap(true, {Mon: false, Tue: true});
console.log(DayFlags.Mon); // output false. Default val wont override specified val if the type is boolean 
```

欲了解更多信息，请结帐

*   [https://www.npmjs.com/package/constjs](https://www.npmjs.com/package/constjs)
*   或[https://github.com/greenlaw110/constjs](https://github.com/greenlaw110/constjs)

免责声明：如果这个工具，我是作者。

* * *

## 回答 #33

> 赞同：-1
> 
> 时间：2018-06-30T08:01:02.627

> 声明一个只读的命名常量。
> 
> 通过 const 声明的变量不能重新声明或重新分配。
> 
> 常量可以用大写或小写来声明，但一个常见的约定是使用全大写字母。

```
// const c;
// c = 9;   //intialization and declearation at same place
const c = 9;
// const c = 9;// re-declare and initialization is not possible
console.log(c);//9 
```

# javascript - JavaScript 数据格式化/漂亮的打印机

> ID：130404
> 
> 赞同：127
> 
> 时间：2008-09-24T22:46:53.637
> 
> 标签：javascript, debugging, json

我试图找到一种方法以人类可读的形式“漂亮地打印”JavaScript 数据结构以进行调试。

我有一个相当大而复杂的数据结构存储在 JS 中，我需要编写一些代码来操作它。为了弄清楚我在做什么以及哪里出了问题，我真正需要的是能够完整地查看数据结构，并在我通过 UI 进行更改时对其进行更新。

除了找到一种将 JavaScript 数据结构转储为人类可读字符串的好方法之外，我可以自己处理所有这些事情。JSON 可以，但它确实需要很好地格式化和缩进。我通常会为此使用 Firebug 出色的 DOM 转储东西，但我确实需要能够一次看到整个结构，这在 Firebug 中似乎是不可能的。

* * *

## 回答 #1

> 赞同：238
> 
> 时间：2008-09-24T23:01:01.387

像这样使用[**Crockford 的 JSON.stringify**](https://github.com/douglascrockford/JSON-js/blob/master/json2.js)：

```
var myArray = ['e', {pluribus: 'unum'}];
var text = JSON.stringify(myArray, null, '\t'); //you can specify a number instead of '\t' and that many spaces will be used for indentation... 
```

变量`text`看起来像这样：

```
[
  "e",
   {
      "pluribus": "unum"
   }
] 
```

* * *

顺便说一句，这只需要那个 JS 文件——它可以与任何库等一起使用。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-09-24T23:06:46.350

我写了一个函数来以可读的形式转储一个 JS 对象，虽然输出没有缩进，但添加它应该不难：我用我为 Lua 制作的一个函数制作了这个函数（这要复杂得多) 处理了这个缩进问题。

这是“简单”版本：

```
function DumpObject(obj)
{
  var od = new Object;
  var result = "";
  var len = 0;

  for (var property in obj)
  {
    var value = obj[property];
    if (typeof value == 'string')
      value = "'" + value + "'";
    else if (typeof value == 'object')
    {
      if (value instanceof Array)
      {
        value = "[ " + value + " ]";
      }
      else
      {
        var ood = DumpObject(value);
        value = "{ " + ood.dump + " }";
      }
    }
    result += "'" + property + "' : " + value + ", ";
    len++;
  }
  od.dump = result.replace(/, $/, "");
  od.len = len;

  return od;
} 
```

我会考虑改进一下。
注意 1：要使用它，请执行`od = DumpObject(something)`并使用 od.dump。令人费解，因为我也想要 len 值（项目数）用于另一个目的。使函数只返回字符串是微不足道的。
注意 2：它不处理引用中的循环。

**编辑**

我做了缩进的版本。

```
function DumpObjectIndented(obj, indent)
{
  var result = "";
  if (indent == null) indent = "";

  for (var property in obj)
  {
    var value = obj[property];
    if (typeof value == 'string')
      value = "'" + value + "'";
    else if (typeof value == 'object')
    {
      if (value instanceof Array)
      {
        // Just let JS convert the Array to a string!
        value = "[ " + value + " ]";
      }
      else
      {
        // Recursive dump
        // (replace "  " by "\t" or something else if you prefer)
        var od = DumpObjectIndented(value, indent + "  ");
        // If you like { on the same line as the key
        //value = "{\n" + od + "\n" + indent + "}";
        // If you prefer { and } to be aligned
        value = "\n" + indent + "{\n" + od + "\n" + indent + "}";
      }
    }
    result += indent + "'" + property + "' : " + value + ",\n";
  }
  return result.replace(/,\n$/, "");
} 
```

在递归调用的行上选择您的缩进，并通过在此之后切换注释行来支持样式。

...我看到您制作了自己的版本，这很好。游客将有一个选择。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2012-07-23T05:42:35.123

您可以使用以下

```
<pre id="dump"></pre>
<script>
   var dump = JSON.stringify(sampleJsonObject, null, 4); 
   $('#dump').html(dump)
</script> 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-09-24T22:48:56.660

在`Firebug`，如果你只是`console.debug ("%o", my_object)`你可以在控制台中点击它并进入一个交互式对象资源管理器。它显示整个对象，并允许您展开嵌套对象。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2011-10-05T18:55:56.683

对于 Node.js，使用：

```
util.inspect(object, [options]); 
```

[API 文档](http://nodejs.org/api/util.html#util_util_inspect_object_options)

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2013-06-21T13:12:05.920

对于那些正在寻找一种很棒的方式来查看您的对象的人，[请查看 prettyPrint.js](https://github.com/padolsey/prettyPrint.js)

创建一个带有可配置视图选项的表格，以打印在文档的某处。看起来比在`console`.

```
var tbl = prettyPrint( myObject, { /* options such as maxDepth, etc. */ });
document.body.appendChild(tbl); 
```

![在此处输入图像描述](https://i.stack.imgur.com/MGG1I.png)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2011-04-11T05:53:01.537

我正在编程，`Rhino`我对这里发布的任何答案都不满意。所以我写了我自己漂亮的打印机：

```
function pp(object, depth, embedded) { 
  typeof(depth) == "number" || (depth = 0)
  typeof(embedded) == "boolean" || (embedded = false)
  var newline = false
  var spacer = function(depth) { var spaces = ""; for (var i=0;i<depth;i++) { spaces += "  "}; return spaces }
  var pretty = ""
  if (      typeof(object) == "undefined" ) { pretty += "undefined" }
  else if ( typeof(object) == "boolean" || 
            typeof(object) == "number" ) {    pretty += object.toString() } 
  else if ( typeof(object) == "string" ) {    pretty += "\"" + object + "\"" } 
  else if (        object  == null) {         pretty += "null" } 
  else if ( object instanceof(Array) ) {
    if ( object.length > 0 ) {
      if (embedded) { newline = true }
      var content = ""
      for each (var item in object) { content += pp(item, depth+1) + ",\n" + spacer(depth+1) }
      content = content.replace(/,\n\s*$/, "").replace(/^\s*/,"")
      pretty += "[ " + content + "\n" + spacer(depth) + "]"
    } else { pretty += "[]" }
  } 
  else if (typeof(object) == "object") {
    if ( Object.keys(object).length > 0 ){
      if (embedded) { newline = true }
      var content = ""
      for (var key in object) { 
        content += spacer(depth + 1) + key.toString() + ": " + pp(object[key], depth+2, true) + ",\n" 
      }
      content = content.replace(/,\n\s*$/, "").replace(/^\s*/,"")
      pretty += "{ " + content + "\n" + spacer(depth) + "}"
    } else { pretty += "{}"}
  }
  else { pretty += object.toString() }
  return ((newline ? "\n" + spacer(depth) : "") + pretty)
} 
```

输出如下所示：

```
js> pp({foo:"bar", baz: 1})
{ foo: "bar",
  baz: 1
}
js> var taco
js> pp({foo:"bar", baz: [1,"taco",{"blarg": "moo", "mine": "craft"}, null, taco, {}], bleep: {a:null, b:taco, c: []}})
{ foo: "bar",
  baz: 
    [ 1,
      "taco",
      { blarg: "moo",
        mine: "craft"
      },
      null,
      undefined,
      {}
    ],
  bleep: 
    { a: null,
      b: undefined,
      c: []
    }
} 
```

对于未来可能需要的任何更改，我也已将其作为[Gist 发布在这里。](https://gist.github.com/913112)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-02-18T22:00:59.473

## [js转储](http://github.com/NV/jsDump)

```
jsDump.parse([
    window,
    document,
    { a : 5, '1' : 'foo' },
    /^[ab]+$/g,
    new RegExp('x(.*?)z','ig'),
    alert, 
    function fn( x, y, z ){
        return x + y; 
    },
    true,
    undefined,
    null,
    new Date(),
    document.body,
    document.getElementById('links')
])
```

变成

```
[
   [Window],
   [Document],
   {
      "1": "foo",
      "a": 5
   },
   /^[ab]+$/g,
   /x(.*?)z/gi,
   function alert( a ){
      [code]
   },
   function fn( a, b, c ){
      [code]
   },
   true,
   undefined,
   null,
   "Fri Feb 19 2010 00:49:45 GMT+0300 (MSK)",
   <body id="body" class="node"></body>,
   <div id="links">
]
```

[QUnit](http://github.com/jquery/qunit)（jQuery 使用的单元测试框架）使用 jsDump 的略微修补版本。

* * *

JSON.stringify() 在某些情况下不是最佳选择。

```
JSON.stringify({f:function(){}}) // "{}"
JSON.stringify(document.body)    // TypeError: Converting circular structure to JSON 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-24T23:37:38.367

在 PhiLho 的带领下（非常感谢 :)），我最终写了自己的，因为我无法让他做我想做的事。它非常粗糙且准备就绪，但它完成了我需要的工作。谢谢大家的出色建议。

我知道，这不是出色的代码，但就其价值而言，就在这里。有人可能会觉得它很有用：

```
// Usage: dump(object)
function dump(object, pad){
    var indent = '\t'
    if (!pad) pad = ''
    var out = ''
    if (object.constructor == Array){
        out += '[\n'
        for (var i=0; i<object.length; i++){
            out += pad + indent + dump(object[i], pad + indent) + '\n'
        }
        out += pad + ']'
    }else if (object.constructor == Object){
        out += '{\n'
        for (var i in object){
            out += pad + indent + i + ': ' + dump(object[i], pad + indent) + '\n'
        }
        out += pad + '}'
    }else{
        out += object
    }
    return out
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-02-18T21:46:56.380

这实际上只是对 Jason Bunting 的“使用 Crockford 的 JSON.stringify”的评论，但我无法对该答案添加评论。

如评论中所述，JSON.stringify 不能很好地与 Prototype (www.prototypejs.org) 库配合使用。但是，通过暂时删除原型添加的 Array.prototype.toJSON 方法，运行 Crockford 的 stringify()，然后像这样放回去，很容易让它们一起玩得很好：

```
 var temp = Array.prototype.toJSON;
  delete Array.prototype.toJSON;
  $('result').value += JSON.stringify(profile_base, null, 2);
  Array.prototype.toJSON = temp; 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-03-29T16:24:57.180

我认为 J. Buntings 对使用 JSON.stringify 的反应也很好。顺便说一句，如果你碰巧在使用 YUI，你可以通过 YUI 的 JSON 对象使用 JSON.stringify。在我的情况下，我需要转储到 HTML，以便调整/剪切/粘贴 PhiLho 响应更容易。

```
function dumpObject(obj, indent) 
{
  var CR = "<br />", SPC = "&nbsp;&nbsp;&nbsp;&nbsp;", result = "";
  if (indent == null) indent = "";

  for (var property in obj)
  {
    var value = obj[property];

    if (typeof value == 'string')
    {
      value = "'" + value + "'";
    }
    else if (typeof value == 'object')
    {
      if (value instanceof Array)
      {
        // Just let JS convert the Array to a string!
        value = "[ " + value + " ]";
      }
      else
      {
        var od = dumpObject(value, indent + SPC);
        value = CR + indent + "{" + CR + od + CR + indent + "}";
      }
    }
    result += indent + "'" + property + "' : " + value + "," + CR;
  }
  return result;
} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-03-21T16:00:52.980

很多人在这个线程中编写代码，有很多关于各种陷阱的评论。我喜欢这个解决方案，因为它看起来很完整，并且是一个没有依赖关系的单个文件。

[浏览器](http://www.eslinstructor.net/vkbeautify/)

[节点](http://www.eslinstructor.net/pretty-data/)

它“开箱即用”并且具有节点和浏览器版本（可能只是不同的包装器，但我没有深入确认）。

该库还支持漂亮的打印 XML、SQL 和 CSS，但我还没有尝试过这些功能。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-02-12T09:54:12.307

## 对于在 2021 年或 2021 年后检查此问题的任何人

[查看](https://stackoverflow.com/a/7220510)[hassan](https://stackoverflow.com/users/2359679/hassan)的其他 StackOverflow 答案

TLDR：

```
JSON.stringify(data,null,2) 
```

这里第三个参数是制表符/空格

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-08-29T18:29:06.520

将元素打印为字符串的简单方法：

```
var s = "";
var len = array.length;
var lenMinus1 = len - 1
for (var i = 0; i < len; i++) {
   s += array[i];
   if(i < lenMinus1)  {
      s += ", ";
   }
}
alert(s); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-04-20T16:17:28.497

我的[NeatJSON](https://github.com/Phrogz/NeatJSON)库有 Ruby 和[JavaScript 版本](https://github.com/Phrogz/NeatJSON/tree/master/javascript)。它在（许可的）MIT 许可下免费提供。您可以在以下位置查看在线演示/转换器： http:
[//phrogz.net/JS/neatjson/neatjson.html](http://phrogz.net/JS/neatjson/neatjson.html)

一些功能（全部可选）：

*   包裹到特定宽度；如果一个对象或数组可以放在一行上，它就保持在一行上。
*   对齐对象中所有键的冒号。
*   按字母顺序对对象的键进行排序。
*   将浮点数格式化为特定的小数位数。
*   换行时，使用“短”版本，将数组和对象的开/关括号与第一个/最后一个值放在同一行。
*   以精细的方式控制数组和对象的空白（在括号内、冒号和逗号之前/之后）。
*   在 Web 浏览器中工作并作为 Node.js 模块工作。

* * *

## 回答 #16

> 赞同：-5
> 
> 时间：2008-09-24T22:50:52.457

[flexjson](http://wrongnotes.blogspot.com/2007/09/flexjson-15-is-live.html)包含一个 prettyPrint() 函数，它可能会给你想要的东西。

# c# - 在每次 webservice 调用之前调用某个方法

> ID：130427
> 
> 赞同：8
> 
> 时间：2008-09-24T22:50:31.133
> 
> 标签：c#, .net, web-services

这是情况。我有一个 web 服务（C# 2.0），它（主要）由一个继承自 System.Web.Services.WebService 的类组成。它包含一些方法，它们都需要调用一个方法来检查它们是否被授权。

基本上是这样的（请原谅架构，这纯粹是一个例子）：

```
public class ProductService : WebService
{
    public AuthHeader AuthenticationHeader;

    [WebMethod(Description="Returns true")]
    [SoapHeader("AuthenticationHeader")]        
    public bool MethodWhichReturnsTrue()
    {
        if(Validate(AuthenticationHeader))
        {
            throw new SecurityException("Access Denied");
        }
        return true;
    }

    [WebMethod(Description="Returns false")]
    [SoapHeader("AuthenticationHeader")]        
    public bool MethodWhichReturnsFalse()
    {
        if(Validate(AuthenticationHeader))
        {
            throw new SecurityException("Access Denied");
        }
        return false;
    }

    private bool Validate(AuthHeader authHeader)
    {
        return authHeader.Username == "gooduser" && authHeader.Password == "goodpassword";
    }
} 
```

如您所见，`Validate`必须在每个方法中调用该方法。我正在寻找一种能够调用该方法的方法，同时仍然能够以理智的方式访问肥皂标题。我查看了 中的事件`global.asax`，但我认为我无法访问该类中的标题...可以吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-24T23:52:13.933

这是您需要做的才能使其正常工作。

可以创建自己的自定义 SoapHeader：

```
public class ServiceAuthHeader : SoapHeader
{
    public string SiteKey;
    public string Password;

    public ServiceAuthHeader() {}
} 
```

然后你需要一个 SoapExtensionAttribute：

```
public class AuthenticationSoapExtensionAttribute : SoapExtensionAttribute
{
    private int priority;

    public AuthenticationSoapExtensionAttribute()
    {
    }

    public override Type ExtensionType
    {
        get
        {
            return typeof(AuthenticationSoapExtension);
        }
    }

    public override int Priority
    {
        get
        {
            return priority;
        }
        set
        {
            priority = value;
        }
    }
} 
```

还有一个自定义的 SoapExtension：

```
public class AuthenticationSoapExtension : SoapExtension
{
    private ServiceAuthHeader authHeader;

    public AuthenticationSoapExtension()
    {
    }

    public override object GetInitializer(Type serviceType)
    {
        return null;
    }

    public override object GetInitializer(LogicalMethodInfo methodInfo, SoapExtensionAttribute attribute)
    {
        return null;
    }

    public override void Initialize(object initializer)
    {        
    }

    public override void ProcessMessage(SoapMessage message)
    {
        if (message.Stage == SoapMessageStage.AfterDeserialize)
        {
            foreach (SoapHeader header in message.Headers)
            {
                if (header is ServiceAuthHeader)
                {
                    authHeader = (ServiceAuthHeader)header;

                    if(authHeader.Password == TheCorrectUserPassword)
                    {
                        return;  //confirmed
                    }
                }
            }

            throw new SoapException("Unauthorized", SoapException.ClientFaultCode);
        }
    }
} 
```

然后，在您的 Web 服务中，将以下标头添加到您的方法中：

```
public ServiceAuthHeader AuthenticationSoapHeader;

[WebMethod]
[SoapHeader("AuthenticationSoapHeader")]
[AuthenticationSoapExtension]
public string GetSomeStuffFromTheCloud(string IdOfWhatYouWant)
{
  return WhatYouWant;
} 
```

当您使用此服务时，您必须使用正确的值实例化自定义标头并将其附加到请求中：

```
private ServiceAuthHeader header;
private PublicService ps;

header = new ServiceAuthHeader();
header.SiteKey = "Thekey";
header.Password = "Thepassword";
ps.ServiceAuthHeaderValue = header;

string WhatYouWant = ps.GetSomeStuffFromTheCloud(SomeId); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T23:27:59.983

[您可以通过从SoapExtension 基](http://msdn.microsoft.com/en-us/library/system.web.services.protocols.soapextension.aspx)类派生来实现所谓的 SOAP 扩展。这样，您将能够检查传入的 SOAP 消息并在调用特定 Web 方法之前执行验证逻辑。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T01:31:38.063

我会看看为您要保护的方法添加安全方面。看看[PostSharp](http://www.postsharp.org)，特别是 OnMethodBoundryAspect 类型和 OnEntry 方法。

# .net - 自动组织 Visual Studio 选项卡？

> ID：130431
> 
> 赞同：6
> 
> 时间：2008-09-24T22:51:03.707
> 
> 标签：.net, visual-studio, visual-studio-2008, ide

Visual Studio 2008 中是否有任何设置来分组/组织选项卡？例如，如果该页面已打开，我希望在其 .aspx 页面旁边的选项卡中打开所有代码隐藏文件，反之亦然。拖动标签真的会降低我的工作效率。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-30T08:08:05.870

乔纳森，

[Tabs Studio](http://www.tabsstudio.com)（由我开发）插件可以自动将 .aspx 和 .aspx.cs 窗口分组到一个选项卡中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-12T14:45:21.447

检查此链接 - 它解释了如何使活动选项卡跳转到最左边的位置，从而有效地防止最常用的选项卡“脱落”：[Visual Studio 中的窗口选项卡管理](http://blogs.msdn.com/msbuild/archive/2007/04/13/window-tab-management-in-visual-studio.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T00:16:13.970

对此没有设置，但请查看编写 Visual Studio 插件的文档。这将是一个非常简单的设置。

# unicode - UTF-8、UTF-16 和 UTF-32 可以存储的字符数是否不同？

> ID：130438
> 
> 赞同：52
> 
> 时间：2008-09-24T22:51:45.530
> 
> 标签：unicode, character-encoding, utf

好的。我知道这看起来像是典型的*“他为什么不直接谷歌搜索或访问[www.unicode.org](http://www.unicode.org/)并查找它？”* 问题，但是对于这样一个简单的问题，在检查了两个来源后，我仍然无法找到答案。

我很确定所有这三种编码系统都支持所有的 Unicode 字符，但在我在演示文稿中提出该声明之前，我需要确认它。

额外问题：这些编码在可以扩展支持的字符数上是否不同？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-11-11T06:42:25.853

没有 Unicode 字符可以存储在一种编码中，但不能存储在另一种编码中。这仅仅是因为有效的 Unicode 字符被限制为可以存储在 UTF-16 中的内容（它具有三种编码中最小的容量）。换句话说，UTF-8 和 UTF-32*可以*用来表示比 UTF-16 更广泛的字符，但它们*不是*. 请阅读以获得更多详情。

## UTF-8

UTF-8 是可变长度代码。有些字符需要 1 个字节，有些需要 2 个字节，有些需要 3 个字节，有些需要 4 个字节。每个字符的字节只是一个接一个地写入连续的字节流。

虽然一些 UTF-8 字符可以是 4 个字节长，但 UTF-8*不能编码 2^32 个字符*。它甚至不接近。我将尝试解释其中的原因。

读取 UTF-8 流的软件只获取一个字节序列 - 它应该如何确定接下来的 4 个字节是单个 4 字节字符，还是两个 2 字节字符，还是四个 1 字节字符（或其他组合）？基本上，这是通过确定某些 1 字节序列不是有效字符、某些 2 字节序列不是有效字符等等来完成的。当这些无效序列出现时，假定它们构成*较长*序列的一部分。

你已经看到了一个相当不同的例子，我敢肯定：它被称为转义。在许多编程语言中，`\`字符串源代码中的字符不会转换为字符串“编译”形式中的任何有效字符。当在源中找到 \ 时，假定它是较长序列的一部分，例如`\n`or `\xFF`。请注意，这`\x`是一个无效的 2 字符序列，`\xF`也是一个无效的 3 字符序列，但`\xFF`它是一个有效的 4 字符序列。

基本上，在拥有许多字符和拥有更短的字符之间需要权衡取舍。如果你想要 2^32 个字符，它们平均需要 4 个字节长。如果您希望所有字符为 2 个字节或更少，那么您不能超过 2^16 个字符。UTF-8 提供了一个合理的折衷方案：所有[ASCII](http://en.wikipedia.org/wiki/ASCII)字符（ASCII 0 到 127）都被赋予 1 字节表示，这对兼容性非常有利，但允许使用更多字符。

像大多数可变长度编码一样，包括上面显示的各种转义序列，UTF-8 是一种[瞬时编码](http://en.wikipedia.org/wiki/Instantaneous_code)。这意味着，解码器只是逐字节读取，并且一旦到达字符的最后一个字节，它就知道该字符是什么（并且它知道它*不是*更长字符的开头）。

例如，字符“A”使用字节 65 表示，并且没有第一个字节为 65 的二/三/四字节字符。否则解码器将无法将这些字符与“A”区分开来' 其次是别的东西。

但是 UTF-8 受到了更进一步的限制。它确保较短字符的编码永远不会出现*在*较长字符的编码中。例如，一个 4 字节字符中的任何一个字节都不能是 65。

由于 UTF-8 有 128 个不同的 1 字节字符（其字节值为 0-127），所有 2、3 和 4 字节字符必须仅由 128-256 范围内的字节组成。这是一个很大的限制。但是，它允许面向字节的字符串函数在很少或不需要修改的情况下工作。例如，**`strstr()`**如果 C 的输入是有效的 UTF-8 字符串，则 C 的函数总是按预期工作。

## UTF-16

UTF-16 也是变长编码；它的字符消耗 2 或 4 个字节。0xD800-0xDFFF 范围内的 2 字节值保留用于构造 4 字节字符，所有 4 字节字符由 0xD800-0xDBFF 范围内的两个字节和 0xDC00-0xDFFF 范围内的 2 个字节组成。因此，Unicode 不会分配 U+D800-U+DFFF 范围内的任何字符。

## UTF-32

UTF-32 是一个固定长度的编码，每个字符有 4 个字节长。虽然这允许对 2^32 个不同字符进行编码，但在此方案中只允许 0 到 0x10FFFF 之间的值。

## 容量比较：

*   **UTF-8：** 2,097,152（实际上是 2,166,912，但由于设计细节，其中一些映射到同一事物）
*   **UTF-16：** 1,112,064
*   **UTF-32：** 4,294,967,296（但仅限于前 1,114,112）

因此，最受限制的是 UTF-16！正式的 Unicode 定义将 Unicode 字符限制为可以用 UTF-16 编码的字符（即范围 U+0000 到 U+10FFFF，不包括 U+D800 到 U+DFFF）。UTF-8 和 UTF-32 支持所有这些字符。

UTF-8 系统实际上“人为地”限制为 4 个字节。它可以扩展到 8 个字节而不违反我之前概述的限制，这将产生 2^42 的容量。最初的 UTF-8 规范实际上最多允许 6 个字节，即 2^31 的容量。但是[RFC 3629](https://www.rfc-editor.org/rfc/rfc3629)将其限制为 4 个字节，因为这是涵盖 UTF-16 的所有功能所需的字节数。

还有其他（主要是历史性的）Unicode 编码方案，特别是 UCS-2（它只能将 U+0000 编码为 U+FFFF）。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-09-24T23:04:26.293

不，它们只是不同的编码方法。它们都支持对同一组字符进行编码。

UTF-8 每个字符使用 1 到 4 个字节，具体取决于您要编码的字符。ASCII 范围内的字符只占用一个字节，而非常不寻常的字符占用四个字节。

UTF-32 无论是什么字符，每个字符都使用四个字节，因此它总是比 UTF-8 使用更多的空间来编码相同的字符串。唯一的好处是您可以仅通过计算字节数来计算 UTF-32 字符串中的字符数。

UTF-16 对大多数字符使用两个字节，对不寻常的字符使用四个字节。

[http://en.wikipedia.org/wiki/Comparison_of_Unicode_encodings](http://en.wikipedia.org/wiki/Comparison_of_Unicode_encodings)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-24T23:00:06.600

UTF-8、UTF-16 和 UTF-32 都支持完整的 unicode 代码点集。没有一个字符支持但另一个字符不支持。

至于额外的问题“这些编码在它们可以扩展支持的字符数量上是否不同？” 是和不是。UTF-8 和 UTF-16 的编码方式将它们可以支持的代码点总数限制在 2^32 以下。但是，Unicode 联盟不会将无法以 UTF-8 或 UTF-16 表示的代码点添加到 UTF-32。这样做会违反编码标准的精神，并且无法保证从 UTF-32 到 UTF-8（或 UTF-16）的一对一映射。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-24T22:55:47.407

如果有疑问，我个人总是会查看[Joel 关于 unicode、编码和字符集的帖子。](http://www.joelonsoftware.com/articles/Unicode.html)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-24T23:13:35.820

所有 UTF-8/16/32 编码都可以映射所有 Unicode 字符。请参阅[Wikipedia 的 Unicode 编码比较](http://en.wikipedia.org/wiki/Comparison_of_Unicode_encodings)。

这篇 IBM 文章[Encode your XML documents in UTF-8](http://www.ibm.com/developerworks/xml/library/x-utf8/)非常有帮助，并指出如果您可以选择，最好选择 UTF-8。主要原因是广泛的工具支持，UTF-8*通常*可以通过不知道 unicode 的系统。

从[IBM 文章](http://www.ibm.com/developerworks/xml/library/x-utf8/)中*的规格说明*部分：

> W3C 和 IETF 最近都更加坚定地首先选择 UTF-8，最后选择，有时甚至只选择 UTF-8。The W3C Character Model for the World Wide Web 1.0: Fundamentals 指出，“当需要唯一的字符编码时，字符编码必须是 UTF-8、UTF-16 或 UTF-32。US-ASCII 向上兼容 UTF- 8（US-ASCII 字符串也是 UTF-8 字符串，参见 [RFC 3629]），因此如果需要与 US-ASCII 兼容，则 UTF-8 是合适的。” 在实践中，与 US-ASCII 的兼容性非常有用，几乎是一项要求。W3C 明智地解释说，“在其他情况下，例如对于 API，UTF-16 或 UTF-32 可能更合适。选择其中之一的可能原因包括内部处理的效率和与其他进程的互操作性。”

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-25T02:18:25.627

正如大家所说，UTF-8、UTF-16 和 UTF-32 都可以编码所有的 Unicode 码位。但是，UCS-2（有时被错误地称为 UCS-16）变体不能~~，这就是您可以在例如 Windows XP/Vista 中找到的~~变体。

有关更多信息，请参阅[维基百科](http://en.wikipedia.org/wiki/Universal_Character_Set)。

**编辑：**我对 Windows 的看法是错误的，NT 是唯一支持 UCS-2 的。但是，许多 Windows 应用程序会像 UCS-2 中一样假定每个代码点只有一个单词，因此您很可能会发现错误。请参阅[另一篇维基百科文章](http://en.wikipedia.org/wiki/UTF-16)。（感谢杰森真）

# svn - 我应该将所有项目存储在一个存储库中还是多个存储库中？

> ID：130447
> 
> 赞同：38
> 
> 时间：2008-09-24T22:54:35.973
> 
> 标签：svn, version-control, tortoisesvn, repository

我目前正在使用 TortoiseSVN 来管理我目前正在进行的几个项目。当我第一次将所有内容移入源代码控制时，我并不确定应该如何布置所有内容，因此我最终将每个项目都放入了自己的存储库中。

我想知道将它们全部移动到一个大存储库中并将它们拆分到项目文件夹中对我来说是个好主意吗？其他人都做什么？

目前它们都没有共享通用代码，但将来可能会。如果它们都在一起，是否会更容易管理。

谢谢。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-09-24T23:19:36.803

在某种程度上取决于“项目”的含义。

我有一个通用的本地存储库，其中包含我编写的随机内容（包括我的网站，因为它很小）。一个单用户本地 SVN 存储库不会出现明显的性能问题，除非您花了很多年的时间打字。到那时SVN无论如何都会更快。所以我还没有后悔把所有的东西都扔到一个存储库里，尽管里面的一些东西完全不相关，除了我写的所有东西。

如果“项目”意味着“课堂作业”，或者“我用来驱动 TiVo 的脚本”，或者“我在学习一门新语言方面的进展”，那么为每个项目创建一个 repos 对我来说似乎有点不必要。再说一次，它也不需要任何费用。所以我想我会说不要改变你正在做的事情。除非你真的想要重新组织存储库的经验，在这种情况下，*请*改变你正在做的事情:-)

但是，如果“项目”是指一个“真正的”软件项目，可以公开访问存储库，那么我认为每个项目单独的存储库是有意义的：部分原因是它清晰地划分事物并且每个项目独立扩展，但也因为这是人们期望看到的。

在不同的存储库之间共享代码比您想象的要少，因为 svn 具有相当可爱的“svn:externals”功能。这使您可以将存储库的目录指向另一个存储库中的目录，并自动将这些内容与您的内容一起签出。与往常一样，请参阅 SVN 书籍了解详细信息。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-24T23:03:32.397

我会将它们存储在同一个存储库中。它更整洁一些。再加上为什么对持续集成很重要等等 - 你总是可以从存储库中提取一个特定的文件夹。

它也更容易管理 - 一个存储库的帐户，一个存储库的访问日志等。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-24T22:59:39.987

我的经验法则是将交付的东西整合在一起。换句话说，如果您可能分别交付项目 X 和项目 Y，那么将它们放在单独的 repos 中。

是的，有时这意味着您有一个包含大量组件的项目的巨大存储库，但是人们可以在存储库的子树上进行操作，这迫使他们在提交更改时考虑“整个项目”回购。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-24T22:58:47.697

我绝对会将每个项目保存在自己的存储库中，与所有其他项目分开。这将为每个项目提供自己的提交历史。一个项目的回滚不会影响其他项目。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-24T22:56:10.387

就我个人而言，我更喜欢每个项目在它自己的存储库中

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-25T16:17:35.187

如果您与很多其他人一起工作，您可能会考虑是否每个人都需要对每个项目具有相同级别的访问权限。我认为如果您将每个项目放在单独的存储库中，则更容易为每个人授予访问权限。~~~

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-24T23:02:53.177

如果您要为每个项目使用单独的存储库，则可以使用[External 标签](http://svnbook.red-bean.com/en/1.1/ch07s04.html)来引用其他存储库 - 从而共享代码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T22:57:21.850

只要每个项目都有 /trunk /tags 和 /branches 你就很好。适当的持续集成是这里的标准。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T22:58:11.020

是的，把所有东西都放在源代码管理中。

如果您使用的是 SVN，请将项目保存在自己的存储库中 - svn 很慢，而且会变得更慢。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T23:00:23.713

如果您的项目是独立的，则可以将它们保存在单独的存储库中。如果它们共享组件，则将它们放在一起。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-24T23:00:25.367

对于 Subversion，我建议将所有内容放在同一个存储库中；设置新存储库的管理开销太高，无法轻而易举地做到这一点，因此您更有可能不对某些东西进行版本控制，以后会后悔。如果您需要限制对存储库的一部分的访问，Subversion 提供了大量细粒度的访问控制。

然而，当我开始将我的项目迁移到 Mercurial 时，我已经切换到为每个项目创建一个存储库，因为它只需要一个“hg init”就可以创建一个新的，而且我可以使用[hg 森林](http://www.selenic.com/mercurial/wiki/index.cgi/ForestExtension)扩展轻松对嵌套存储库执行操作。Subversion 有 svn:externals，它们有点相似，但需要更多的管理开销。

# java - 真正年轻的软件架构师

> ID：130448
> 
> 赞同：6
> 
> 时间：2008-09-24T22:54:36.100
> 
> 标签：java, architecture

我是一个非常年轻的软件工程师/QA 团队负责人。我已经开发软件大约 2 年了，其中 1 年我还在一家软件开发公司担任 QA 团队的负责人。目前，我仍在担任 QA 工具的 QA 团队负责人/软件工程师。最近，我被邀请加入一群想要创办一家软件公司的朋友和同事。他们希望我成为该软件的架构师/技术主管（我只能说一个用 Java 编写的特殊聊天客户端）。我非常擅长在火下学习，而且我通过实践学到了很多东西。但是，我担心我缺乏经验会导致项目失败（或至少开发不佳）。所以我想知道你会建议我担任这个职位，尽我所能，边走边学吗？还是建议我拒绝？

如果您建议我担任该职位，请您提供一个或一个对初级 Java 架构师有益的资源？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-24T22:56:05.503

1.  努力成为房间里最愚蠢的人。
2.  如果它让你感到恐惧，那就去做吧。如果它让你感到恐惧，那就逃跑。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-24T23:08:09.733

作为一个跳槽成为一家小公司的建筑师的人，我认为以下几点可能会有所帮助：

1.  你知道的比你想象的要多。仅仅因为你以前从未成为一名建筑师并不意味着你没有足够的知识成为一名建筑师。
2.  作为一名架构师，您*总是*需要学习并跟上趋势和技术。准备好这样做。
3.  听。团队成员将提出挑战您所有偏见的好主意。
4.  尤其是在一家小公司中，作为架构师，您*必须*了解政治。我不够了解，结果被烧了。这可能会影响你的友谊。
5.  小公司可能会以惊人的速度倒闭。为此做好计划，不要有财务承诺，这意味着您不能在短时间内失业。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-24T23:27:44.867

作为团队负责人，您最重要的资产不是您的经验，而是与您合作的团队。如果您认识并信任这些人，或者您可以聘请自己的团队，那么一定要去做。如果您打算进行任何招聘，请先阅读一本关于良好招聘的书（Joel on Software 有一篇很好的文章）。

您在 Stack Overflow 上询问它，因此您至少对此有正确的态度。在需要时寻求帮助。不要试图通过不谈论问题来过度补偿你缺乏经验。仅仅因为你不知道问题的答案并不意味着有经验的经理也会有。在门口检查你的自我并完成工作。无论如何，你会因此而受到更多尊重。

如果您要进入一个根深蒂固的团队，并且遇到各种问题和问题，那么当一名经验丰富的经理真正派上用场时。对我来说，这对你来说是一个绝佳的机会。如果不进行管理，您将永远无法成为一名有经验的经理。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-24T22:57:15.673

[神话人物月](https://rads.stackoverflow.com/amzn/click/com/0201835959)和人[件是您](https://rads.stackoverflow.com/amzn/click/com/0932633439)**需要**阅读的2 本书。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T23:02:21.963

我不会告诉你要不要做，但是...

我会告诉你，如果你想真正提高你的技能并在你的职业生涯中取得进步，你将不得不冒险并偶尔离开你的舒适区。

此外，作为开发人员，尽管我们经常对项目/时间表持乐观态度，但我们也经常对自己的技能/能力持悲观态度，并专注于我们不知道的事情而不是我们所做的事情。

如果您有任何疑问，您需要与您的潜在业务合作伙伴进行讨论。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T08:12:51.110

关于软件架构的有用的、独立的资源并不多。一旦你过滤掉了供应商营销和手摇象牙塔的东西，似乎就没有什么实用的建议了。

一个很好的方法是[Coding the Architecture](http://www.codingthearchitecture.com)，它专注于架构方面的实践，并为向架构师过渡的开发人员提供了大量信息*（完全披露——我已经以一种很小的方式参与其中）*。

此外，还有一个关于架构博客的类似[问题](https://stackoverflow.com/questions/21068/best-blogs-for-software-architecture)，有一些非常好的答案。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T22:56:25.207

你应该向你的新团队表达你的想法。我想说的是，您对此持开放态度是一个很大的优势。尽力而为，保持专注——经验不是一切，尤其是当您意识到自己的缺点时！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-24T23:02:22.773

由于您在同一个句子中使用了*Java*和*架构师这两个词，我可以推荐*[SCEA](http://www.sun.com/training/certification/java/scea.xml)认证中使用的学习材料吗？特别是，我发现[Core J2EE Patterns](http://www.corej2eepatterns.com/)是一本对思考更宏观的体系结构问题非常有帮助的书。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-24T23:03:44.563

对团队中的其他人保持开放态度，确保每个人都意识到风险并了解“最坏的情况”是什么。您还需要对在项目期间投入的所有额外时间感到满意，以加快技术速度。

还要问问自己，如果项目确实失败了，你是否能在经济上做到这一点。

如果每个人都还在，听起来像是一次很好的学习经历！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-24T23:19:52.187

我不会太担心成为公司失败的潜在原因。坦率地表达你的担忧，但要根据你的学习能力（和愿望）来缓和它。

你有责任审查公司创始人的融资和业务安排。我想说，公司倒闭的可能性要大得多，因为“商业”原因，而不是技术原因。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-24T23:27:15.427

如果你能在不放弃工作的情况下加入这个小组，那就太好了。但如果你必须选择走哪条路，放哪一条路，只有你才能做出这个决定。跟随你的心，你永远不会迷路。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-25T00:23:14.250

根据你到目前为止所说的，这个项目将失败。哎呀，大多数新项目都失败了。如果你没问题，那就去吧！这对您来说将是一次很好的学习经历：）请确保您不会因此而失去亲密的朋友。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-07-29T18:48:39.833

多年来，我发现 Craig Larman 关于迭代软件开发的书非常有用。 ![替代文字](https://www.craiglarman.com/wiki/images/9/9c/Agile_and_iterative_1e.jpg)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-07-29T18:53:43.693

作为团队负责人，您需要善于从团队中发挥出最好的一面，同时也需要自己学习。通过将自己的技能提高 100%，您可以将团队的生产力提高 10%。通过将团队的生产力提高 100%，您就可以提高它.. 当然是 100%。

您对朋友创业的价值不仅在于您的纯编码技能，还在于他们了解并信任您作为合作伙伴。显然对他们来说，他们觉得你可以贡献一些真正的价值，所以我的建议是你“假装它直到你做到”:)

# drupal - AOP 如何应用于 Drupal？

> ID：130467
> 
> 赞同：5
> 
> 时间：2008-09-24T22:58:48.117
> 
> 标签：drupal, aop

AOP（*面向方面​​编程*）在 Drupal 中是如何工作的？

我已经了解了 AOP 在日志记录和安全性方面的使用，但它如何应用于 Drupal？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T23:29:13.567

Drupal 通过钩子模仿 AOP 范式，这基本上允许开发人员在执行流程中编织一些代码。您可以在 Drupal 文档站点中显示[的 Drupal 钩子列表中](http://api.drupal.org/api/group/hooks/4.7)查看开发人员可以实现的钩子，该列表仅列出了从 Drupal 核心及其模块调用的钩子。

举个简单的例子，如果我正在开发一个新的基于节点的模块（节点是 Drupal 中的基本数据形式），我可以即时访问评论和分类，而无需我做任何额外的工作。注释和分类模块能够连接到节点，并提供附加功能。所以从这个意义上说，我不必在我的程序中考虑这些功能，但我可以利用这种灵活性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-07-11T12:11:07.227

Drupal 是一个“多范式”框架，只有其中的某些部分实现了“一种”AOP：

*   例如，Drupal 7 的 render() 函数通过基于基本优先规则选择适当的模板将一组嵌套数组转换为输出 HTML：这样，Drupal 的行为很像 XSLT 转换引擎，您的主题的模板文件在其中一起构成一个输入 .xsl 文件，输入数组嵌套是初始 .xml 文件。这意味着主题化的工作方式具有优雅的功能。
*   此外，D7 数据库抽象层接近于“直接”面向对象，尽管正如 Larry（见下文）所指出的，在这个 OO 层中有少量的准 AOP。

Drupal 的 AOP 范式可能更好地可视化为事件驱动，而这一切都通过 Drupal 的钩子概念发生。例如，当您执行以下操作时：

*   编写一个名为 mymodule 的模块
*   在 mymodule.module 中，创建一个`mymodule_init()`函数
*   在 Drupal 中安装这个模块

您要声明的是伪代码：

```
subscribe mymodule to "hook events" of type init 
```

然后当 Drupal 的核心运行[`module_invoke_all('init')`](https://api.drupal.org/api/drupal/includes%21module.inc/function/module_invoke_all/7.x)时，Drupal 说：

```
notify all subscribers to "hook events" of type init that this has occurred
 by passing any relevant arguments to them
 and letting them run the code they define in their hook_init() 
```

因此，尽管 PHP 仍然是一种过程语言——`mymodule_init()`如果你真的想要，你可以做各种疯狂的、未封装的事情——Drupal 仍然负责。Drupal 在某种意义上决定是否首先调用您的代码。

通过这种方式，Drupal 能够将自己的执行阶段转变为准 AOP，通过定义**关节点**（`module_invoke*()`函数）并让您编写自己的**切入点**（您的`mymodule_*()`函数，其命名约定必须与 Drupal 的钩子名称匹配。

有关这方面的更多背景信息，尤其是 Drupal 的多范式性质，[编程语言权衡](http://www.garfieldtech.com/blog/language-tradeoffs)，作者：Larry Garfield。

# lisp - 为什么将 Lisp 用于 AI？

> ID：130475
> 
> 赞同：190
> 
> 时间：2008-09-24T23:00:17.863
> 
> 标签：lisp, artificial-intelligence

我一直在学习 Lisp 来扩展我的视野，因为我听说它被用于 AI 编程。在进行了一些探索之后，我还没有找到 AI 示例或任何可以使它更倾向于它的语言。

过去使用 Lisp 是因为它可用，还是我只是缺少一些东西？

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2008-09-25T03:29:10.887

Lisp 一直用于人工智能，直到 1980 年代末。然而，在 80 年代，Common Lisp 被商业界过度吹捧为“人工智能语言”。这种强烈反对迫使大多数 AI 程序员使用 C++ 几年。如今，原型通常是用更年轻的动态语言（Perl、Python、Ruby 等）编写的，成功研究的实现通常是用 C 或 C++（有时是 Java）。

如果你对 70 年代感兴趣……好吧，我当时不在。但我认为 Lisp 在 AI 研究中的成功有以下三个原因（按重要性排序）：

1.  Lisp 是一个优秀的原型设计工具。这是很长一段时间以来*最好的。*Lisp 仍然擅长解决你还不知道如何解决的问题。这种描述完美地描述了人工智能。
2.  Lisp 很好地支持符号编程。旧人工智能也是象征性的。长期以来，这方面也独树一帜。
3.  Lisp 非常强大。代码/数据的区别较弱，因此*感觉*比其他语言更具可扩展性，因为您的函数和宏看起来像内置的东西。

我没有[Peter Norvig 的旧 AI 书籍](http://norvig.com/paip.html)，但它应该是学习在 Lisp 中编写 AI 算法的好方法。

免责声明：我是计算语言学的研究生。我比其他领域更了解自然语言处理的子领域。也许 Lisp 更多地用于其他子领域。

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2009-03-25T03:16:12.147

Lisp 用于 AI 是因为它非常支持使用符号计算的软件的实现。符号、符号表达式和计算是 Lisp 的核心。

用于符号计算的典型 AI 领域包括：计算机代数、定理证明、规划系统、诊断、重写系统、知识表示和推理、逻辑语言、机器翻译、专家系统等。

因此，这些领域中许多著名的 AI 应用程序都是用 Lisp 编写的也就不足为奇了：

*   Macsyma 作为第一个大型计算机代数系统。
*   ACL2 作为广泛使用的定理证明器，例如被 AMD 使用。
*   DART 作为美军在第一次海湾战争期间使用的后勤规划器。据说仅这个 Lisp 应用程序就收回了当时美国在人工智能研究方面的所有投资。
*   SPIKE，哈勃太空望远镜的计划和调度应用程序。也被其他几个大型望远镜使用。
*   CYC，最大的软件系统之一。人类常识知识领域的表示与推理。
*   METAL，最早商业使用的自然语言翻译系统之一。
*   美国运通的授权人助理，负责检查信用卡交易。

在这些领域有成千上万的应用程序是用 Lisp 编写的。对那些来说非常普遍的是，他们需要符号处理领域的特殊能力。一种是在 Lisp 之上实现在这些域中具有特殊解释器/编译器的特殊语言。Lisp 允许人们为符号数据和程序创建表示，并且可以实现各种机制来操纵这些表达式（数学公式、逻辑公式、计划……）。

（请注意，AI 中也使用了许多其他通用编程语言。我试图回答为什么在 AI 中特别使用 Lisp。）

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-09-25T06:19:07.700

一个原因是它允许您使用特定于您的领域的结构来扩展语言，使其有效地成为一种领域特定的语言。这种技术非常强大，因为它可以让你推理你正在解决的**问题**，而不是洗牌。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-24T23:15:39.217

我的猜测一直是，作为一种函数式语言，它不区分代码和数据。包括函数定义和函数调用在内的所有内容都可以被视为列表并像任何其他数据一样进行修改。

因此，可以轻松编写自检、自修改代码。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-25T05:38:53.663

一个可能的答案是 AI 是非常困难的问题的集合，而 Lisp 是解决难题的好语言，而不仅仅是 AI。

至于为什么会这样：宏、通用函数和丰富的自省允许简洁的代码和轻松引入域抽象——它是一种可以让你变得更强大的语言。对于许多不必要的问题，它会带来自己的成本，但对于其他问题，需要电力才能取得进展。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-25T15:53:07.133

我认为仅从人工智能的角度来考虑这一点是错误的。如果你问的是为什么它被用于人工智能，而不是为什么它现在不经常使用，那么像人工智能冬天和对普通 lisp 的商业影响之类的事情会让人分心……

无论如何，我认为这是因为大多数 AI 代码本质上是研究代码。Lisp 是一种伟大的语言，用于探索性编程、实现困难的算法、自我修改和经常修改的代码。换句话说，用于研究代码。

我今天将 lisp 用于我的一些研究代码（数学、信号处理），因为它比大多数语言更灵活、更强大，同时仍然比大多数语言生成更高效的代码。我通常可以在 c++ 速度的 +/- 2 倍内获得性能，但我可以更快地实现事情，并且处理复杂性，这将比我使用 c++、java、c# 花费更多的时间。

不过那是跑题了。我认为 AI 代码有一段时间主要是用 common lisp 编写的，因为它是研究代码的强大方法。它仍然是；但随着“人工智能”算法得到更好的理解和探索，其中一部分更容易教授和使用，因此它们出现在本科课程中的年度语言中。从那里开始，问题就变成了人们已经知道什么、有哪些图书馆可用以及哪些对大型团体有效。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-24T23:05:40.893

我猜一个重要的原因是列表作为基本数据结构的灵活性。

当时，能够将它们变成各种复合对象，以及消息传递和多态等新事物，使其成为首选语言；不是专门针对人工智能，而是针对大型、复杂的任务。尤其是在他们尝试概念时。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-25T02:54:20.640

我认为你是对的：Lisp 是一个方便的破解工具。这是因为它在程序和数据之间没有太多区别。这使黑客可以非常轻松地操纵功能，就像数据一样。

但是 lisp 对人类来说是相当难以阅读的，它的大括号和数据和程序之间没有区别。今天，我不会将 lisp 用于任何生产 AI 代码（甚至可能是原型设计），但更喜欢 python 来编写脚本。

要考虑的另一件事是该语言中/与该语言相关的现有库/工具。我无法将 lisp 库与 python 库进行比较，但我想库和开源现在比以前更重要。

这个答案的灵感来自 lisp 和 python 之间的以下比较：http: [//amitp.blogspot.com/2007/04/lisp-vs-python-syntax.html](http://amitp.blogspot.com/2007/04/lisp-vs-python-syntax.html)

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-25T06:23:44.007

我记得听说过，作为一种函数式语言，Lisp 是实现递归算法的一个非常好的选择。在考虑决策过程（遍历）和最终结果（叶节点）时，能够追踪一棵树并按照自己的方式工作是必不可少的。

这是在我们学习 Lisp 的大学 AI 课程中告诉我的。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2011-07-10T08:01:39.507

一个更愤世嫉俗的答案可能是“因为它在 1980 年代输掉了日本和美国之间的政治人工智能战争”。有一篇有趣的[博客文章推测了第五代计算机系统消亡对 Prolog 的影响](http://vanemden.wordpress.com/2010/08/21/who-killed-prolog/)。

# performance - 当您删除元素时，Perl 中的哈希值会缩小吗？

> ID：130486
> 
> 赞同：8
> 
> 时间：2008-09-24T23:03:20.417
> 
> 标签：performance, perl

当您删除元素时，Perl 中的哈希是否会缩小。

更具体地说，我有一个我继承的 perl 程序，它可以解析一个巨大的文件（1 GB）并加载一个哈希值。它会对另一个文件做同样的事情，然后比较不同的元素。在这个过程中内存消耗很大，即使我添加了删除散列元素，但它们被使用了，内存消耗似乎没有受到影响。

脚本非常慢，而且非常耗费内存。我知道它设计得不好，但是关于哈希内存使用的任何想法？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-25T00:06:22.713

您可能想查看[DBM::Deep](http://search.cpan.org/dist/DBM::Deep)之类的内容。它完成了迈克尔提到的那些捆绑的事情，所以你不必考虑它。一切都存储在磁盘上而不是内存中。它只是需要一个更高级的数据库服务器。

此外，如果您想追查性能瓶颈，请查看[Devel::NYTProf](http://search.cpan.org/dist/Devel-NYTProf)，这是来自纽约*时报*的 Perl 分析的新热点。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-24T23:09:55.783

通常，Perl 不能将内存返回给操作系统。不过，它可能能够在内部重用内存，这可以减少程序所需的内存量。

请参阅 perlfaq3：[如何释放数组或散列以缩小程序？](http://perldoc.perl.org/perlfaq3.html#How-can-I-free-an-array-or-hash-so-my-program-shrinks%3f)

如果哈希使用的内存过多（即>物理内存），您可以将`tie`它们存储到磁盘上的文件中。这将大大减少您的内存使用量，但请注意访问磁盘上的结构比访问内存中的结构要慢得多。（磁盘抖动也是如此。）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-25T00:23:05.310

如果你的散列真的很大，一个更好的策略可能是使用磁盘上的散列，让操作系统担心把东西进出内存。我特别喜欢 [Berkeley DB](http://en.wikipedia.org/wiki/Berkeley_DB)用于在磁盘上存储大哈希，Perl [BerkeleyDB](http://search.cpan.org/~pmqs/BerkeleyDB-0.35/BerkeleyDB.pod)模块提供了一个功能齐全的接口，包括一个绑定的 API。

[DBM::Deep](http://search.cpan.org/~rkinyon/DBM-Deep-1.0013/lib/DBM/Deep.pod)也可以用作插入式哈希替换，但依赖于它自己的格式。如果您的结构需要由其他（非 Perl）系统读取，这可能会很痛苦。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-25T03:26:08.520

关于具体问题：不，删除哈希键不会减少程序的内存消耗。

关于更一般的情况：绝大多数程序和语言将继续保留它们以前使用但当前未使用的内存。这是因为操作系统请求分配内存是一个相对较慢的操作，所以他们保留它以防以后再次需要它。

因此，如果您想改善这种情况，您需要减少程序所需的峰值内存量，无论是通过修改您的算法以不需要一次访问尽可能多的数据，还是通过使用磁盘存储（例如前面提到的 DBM::Deep ），或者通过将不需要的变量的空间释放回 perl （让它们超出范围或将它们设置为*undef*）以便可以重用。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-25T02:05:41.100

如果第二个文件中的输入只需要一次（因为它们被读取），您可能会将内存使用量减少一半。

根据您的算法，您甚至可以同时保持文件句柄打开和内存中尚未使用的值的小散列。一个例子是排序数据的合并或比较——您只需要保存每个文件中的当前行并在进行时将其相互比较，向前跳过直到`cmp`发生更改。

另一种方法可能是多次通过，特别是如果您的机器中有一个或多个空闲内核。打开读取管道并让子进程以可管理的预组织块的形式为您提供数据。

对于更通用的算法，你只能通过以磁盘速度为代价来避免为内存大小买单。

在大多数情况下，将每个数据源加载到内存中只会在开发时间上获胜——然后当 N 变大时，您需要为它的占用空间和/或速度付出代价。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-25T08:26:10.967

解决方法：派生一个分配所有内存的子进程。当它完成它的事情时让它传回一些聚合信息；当分叉的进程死亡时，它的内存将随之消失。有点痛苦，但适用于某些情况。如果您正在处理许多文件，每次处理一个文件，只有少数文件很大，并且需要保留很少的中间状态，这将有助于这种情况的一个示例。

# .net - 在.net中，将“行尾”字符添加到文本文件的最佳/最安全方法是什么？

> ID：130492
> 
> 赞同：1
> 
> 时间：2008-09-24T23:03:45.733
> 
> 标签：.net, text-files

我认为必须有一种独立于系统和语言的方式将“当前”EOL 字符粘贴到文本文件中，但我的 MSDN-fu 今天似乎很弱。如果有一种方法可以在 Web 应用程序中为当前客户端机器的操作系统而不是 Web 服务器的操作系统放置正确的 EOL 字符，则可以加分。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T23:04:57.027

[System.Environment.NewLine](http://msdn.microsoft.com/en-us/library/system.environment.newline.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-24T23:09:24.863

对于奖励积分：

*   检查客户端计算机的用户代理，以获取 Windows 或 Linux 等子字符串
*   Windows 的 System.Environment.NewLine 是 0x13, 0x10；在 unix 中，一般只有 0x10；
*   选择适当的换行符字符串，将其附加到该行，然后就可以了

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T23:05:35.263

打开文本文件，搜索到最后，然后追加 Environment.NewLine。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T23:06:23.950

您正在寻找`Environment.NewLine`. 但是，这仅适用于您当前的操作系统。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T23:09:37.390

对于服务器端代码，我会选择[TextWriter.WriteLine](http://msdn.microsoft.com/en-us/library/ebb1kw70.aspx)。检测客户端机器的操作系统需要[浏览器嗅探](http://aspnet.4guysfromrolla.com/articles/120402-1.aspx)- 检查 Request.Browser。

# formatting - Groovy 有源代码格式化程序吗？

> ID：130494
> 
> 赞同：27
> 
> 时间：2008-09-24T23:04:20.383
> 
> 标签：formatting, groovy

我将 Jalopy 的商业版本用于我的 Java 项目，但它不适用于 Groovy 文件。IntelliJ 有一个可用的格式化程序，但我不喜欢需要特定的 IDE。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-25T01:33:55.017

我发现[BUSL](http://busl.tigris.org/)在 Groovy 文件上工作得非常好。它也是独立的，因此您可以从文本编辑器或其他任何工具中使用它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2020-05-02T22:22:01.527

您可以通过带有 --format 选项的命令行使用 npm-groovy-lint :)

[https://www.npmjs.com/package/npm-groovy-lint](https://www.npmjs.com/package/npm-groovy-lint)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2017-04-21T14:41:05.170

[spidasoftware/format](https://github.com/spidasoftware/format)提取 groovy eclipse 插件并为其提供命令行界面。

指示：

```
git clone git@github.com:spidasoftware/format.git && \
cd format/bin && \
./format /path/to/groovy/file 
```

警告：该项目不再维护，但截至本文发布时仍然有效

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-03T01:35:40.717

最新的 eclipse 插件会做一些格式化和重构： http: [//groovy.codehaus.org/Eclipse+Plugin+Refactoring](http://groovy.codehaus.org/Eclipse+Plugin+Refactoring)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-03-19T20:18:53.853

对 Jalopy 的 Groovy 支持将于今年晚些时候推出。YouTube 上有一个展示 Eclipse 插件的小预览：

[http://www.youtube.com/watch?v=PNFUzvOZei0](http://www.youtube.com/watch?v=PNFUzvOZei0)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-12-08T12:46:06.530

实际上 groovyc 带有一个内置的格式化程序（有点）。如果将环境变量设置`JAVA_OPTS`为`-Dantlr.ast`并运行`groovyc test.groovy`，则会生成一个名为 test.groovy.pretty.groovy 的文件。

但请注意：从我在互联网上找到的关于此的信息，此格式化程序不可配置并且会删除注释！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-05-03T15:50:20.627

[Spotless](https://github.com/diffplug/spotless)也格式化了 groovy。不过，如果没有 gradle/maven 似乎是不可能运行的。:(

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-11-29T11:18:27.633

我还没有找到一个好的解决方案，我真的希望有一个。关于@Gizmomogwai 的提示，它并不像您想象的那样工作。

首先，您需要导出`JAVA_OPTS=-Dantlr.ast:groovy`. 但是，从`groovyc`它对人类来说很漂亮的意义上说，由 生成的文件显然不是“漂亮”的。“漂亮”输出生成一个文件，该文件将由编译器的下一阶段解析。实际上，这意味着它不仅会删除注释，还会添加和更改换行符和空格。它绝对*不*适合检查代码格式。

# visual-studio - MFC“警告：跳过组中的非单选按钮。”

> ID：130496
> 
> 赞同：10
> 
> 时间：2008-09-24T23:04:28.277
> 
> 标签：visual-studio, mfc, warnings

在 Visual Studio 的调试器中运行旧的 MFC 应用程序时，我在“输出”窗口中看到了很多警告，如下所示：

> 警告：跳过组中的非单选按钮。

我知道在 MFC 中，您将单选按钮分组以指示哪些单选按钮组合在一起。如果我没记错的话，您可以通过将第一个单选按钮的“组”属性设置为 true，然后将其余单选按钮的“组”属性设置为 false 来执行此操作。

关于这个警告，我有三个问题。

1.  你如何摆脱这个警告？您是否必须将所有非单选按钮控件的“组”属性设置为 true 以避免这种情况，还是应该将其设置为最后一个单选按钮之后的第一个控件？

2.  有没有一种简单的方法来找出哪些控件或对话框有这个问题？我可以打开每个对话框并摆弄它，直到弹出警告。这个应用程序有很多对话框，所以如果有更简单的方法会很好。

3.  如果您不修复此警告，可能会发生什么负面行为？换句话说，这还重要吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-25T14:39:51.100

在这里的回复和旧论坛的一些研究之间，我想我至少已经弄清楚了如何解决我的问题。这是我对上述问题的发现。

1.  ChrisN 和 Smashery 建议我重新排序选项卡以确保单选按钮按顺序排列，这确实修复了一些警告。

    此外，单选按钮组之后的选项卡顺序中的第一个控件必须设置 WS_GROUP 属性（或在编辑器中将组属性设置为 true）。这告诉 MFC 单选按钮组已经结束。没有它，在下一个 WS_GROUP 之前，所有剩余的选项卡顺序控件都会生成警告。完成这两项操作后，这些对话框中的警告消失了。

2.  这仍然是一个悬而未决的问题，在不打开每个对话框并等待警告的情况下，我没有找到定位这些问题的好方法。

    如果您知道一个对话框正在创建此警告，但您不知道是什么控件导致它，您可以在生成警告的 TRACE() 调用上的 DDX_Radio() 函数中设置一个断点。这可以更容易地识别被投诉的特定控件。

3.  我同意 ChrisN 的观点，除了让你仔细检查你的标签顺序之外，我想不出这个警告的任何理由。在网上的其他地方，我找不到任何其他关于这可能导致的问题的参考。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-24T23:23:37.620

该警告意味着在组中的第一个和最后一个单选按钮之间的选项卡顺序中除了单选按钮之外还有一些控件。具有`WS_GROUP`样式集的控件标志着组的开始。

要解决此问题，请使用对话框编辑器更改选项卡顺序并确保所有单选按钮都按顺序编号。另一种方法是在文本编辑器中打开 .rc 文件并更改每个对话框资源中语句的顺序（制表符顺序仅由列出控件的顺序定义）。

如果单选按钮分组工作正常，我认为您可以放心地忽略此警告。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T23:13:18.333

也许检查您的标签顺序（格式/标签顺序） - 听起来您在一组单选按钮中间有一个普通按钮。如果这确实是问题所在，您可以通过使用“格式/制表顺序”菜单项来解决此问题，然后以正确的顺序单击控件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-27T16:30:05.363

对于第 2 点，这就是为什么我猜你没有回答这个问题，我无法想象比对所有带有单选按钮的对话框进行文本搜索 (*.rc) 更简单的事情。对于每个命中，目视检查此问题的资源代码并更正它。我会在资源文件的源代码中手动完成，而不是尝试与 gui 设计器一起玩。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-07-13T00:43:25.397

对于它的价值，我有 3 个按正确的选项卡顺序排列的单选按钮（在 .rc 文件中确认，之后没有问题）并且仍然收到警告。DDX_Radio 中的断点显示第二个和第三个单选按钮被报告为非单选按钮！查看 resource.h 并发现使用 ID 1313 的第一个单选按钮和使用 1311 和 1312 的其他两个单选按钮。将它们按所需的 tab 顺序并重新编号 ID 以适应和解决问题。猜测 GetWindow GW_HWNDNEXT 以某种方式以 ID 顺序而不是 Tab 顺序链接，即使无线电组工作。注意：仍然使用 Visual C++ v6

# performance - 启动后几个小时的 Oracle 负载峰值

> ID：130500
> 
> 赞同：0
> 
> 时间：2008-09-24T23:04:58.710
> 
> 标签：performance, oracle

我们使用 oracle 作为我们产品的后端数据库。我一直在我们的系统上运行一系列压力测试，我开始注意到在数据库重新启动后，oracle 的速度要快得多。随着时间的推移（几个小时左右），数据库似乎变得越来越慢，我会看到数据库机器承受更大的压力。

在 oracle 重启后立即运行测试，我将看到 1 分钟的平均负载为 5 左右，平均 CPU 约为 10-15%。几个小时后，我看到负载平均为 13，CPU 为 40-70%。（这是 red hat linux 2x Quad core xeon，Raid 10 10k rpm sas 驱动器）。

我的第一个想法是数据库事务不会因为这些查询被缓存而变得更快吗？

我似乎无法弄清楚问题所在。

编辑：事实证明，由于设计不当，这是连接软件方面的问题。系统上的每个操作都创建了一个新的插入、删除和选择。随着所有这些独特查询的生成，缓存的内容不断变化。我所说的尖峰是查询缓存填满的时候。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-27T02:07:32.567

我注意到，在 Oracle 10g 中，Oracle 每天安排一个作业来自动计算统计信息。您可能希望在数据库繁忙时查看活动会话，并查看后台会话是否正忙于计算表上的统计信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T06:06:02.613

你运行的是什么版本的oracle？你有 statspack 或 AWR 设置吗？如果您这样做，请检查这些以向您展示数据库随着时间的推移在做什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-17T12:06:22.273

A perfect example for a RAC Analyst like me who has downed RAC multiple times but never knew what made it down. Now, I am using the suggested method. Really, Oracle has many hidden functionality or I am less trained hheee or i need to explore more on these

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-26T12:15:52.380

这可能是数据库 SGA 交换到磁盘的问题。与 RAM 大小相比，检查 SGA 和 PGA 的大小。

您需要提供有关 Oracle 和 Red Hat 版本的更多信息（例如，我遇到了 Oracle 9i 和 Red Hat Enterprise Linux 3.x 的性能问题，RAM 大小为 4 GB 或更大，升级到红帽 4.x 和 Oracle 10g)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T16:16:10.410

So after you do the reboot and the performance improves again, do you drop the data or do you keep it? You need to run statspack/AWR/ADDM/OEM to get more information about what's happening.

As you haven't posted any detailed diagnostic info I take it you need to start learning the ABCs first. See [Oracle 10.2 Performance Tuning Guide](http://www.oracle.com/pls/db102/to_toc?pathname=server.102%2Fb14211%2Ftoc.htm&remark=portal+%28Getting+Started%29)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T16:31:32.603

Add to the list of information needed the following:

Are you using archive logs? How many redo log groups do you have? How many redo logs are in each group? How big are the redo logs?

How are you restarting Oracle? Are you just doing a shutdown immediate followed by a startup? Are you rebooting the server?

If your log files are too small you might be getting into a state where you're waiting for the redo logs to be written to the archive logs before being able to continue, you can help remedy this by increasing the size of the redo logs.

Shutting down and restarting oracle would result in the redo logs all being written to the archive logs and being fresh and ready to go after you start back up. Then as they fill with redo information you hit a bottleneck when it comes time to archive them.

An AWR report would really be the most useful thing if you're running Oracle 10g. If you're running 9i then statspack equvalent.

**Running a AWR Report**

Login to sqlplus

```
sqlplus <sys or system user>/<password>@<SID> 
```

Create a 'before' statistics snapshot

```
SQL> execute dbms_workload_repository.create_snapshot 
```

Run your specific performance/load tests

Create an 'after' statistics snapshot

```
SQL> execute dbms_workload_repository.create_snapshot 
```

Create a workload repository report

```
SQL> start awrrpt 
```

Using the AWR report you should be able to determine where your bottleneck is.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T23:09:30.027

您确定压力测试正在释放它使用的会话吗？会话的累积，然后这些会话的后续时间可能会产生这种行为。

根据请求将此查询从评论移至我的答案正文...

```
select
  username,
  osuser,
  lockwait,
  status,
  sql_text
from
  v$session,
  v$sqltext
where
  username is not null
and
  username not in ('SYSMAN','DBSNMP')
and
  hash_value = sql_hash_value
order by
  username,
  hash_value,
  piece; 
```

# java - 我应该在我的 Java 程序中使用多少个线程？

> ID：130506
> 
> 赞同：17
> 
> 时间：2008-09-24T23:07:02.623
> 
> 标签：java, multithreading

我最近继承了一个小型 Java 程序，该程序从大型数据库中获取信息，进行一些处理并生成有关信息的详细图像。原作者使用单线程编写代码，后来对其进行了修改以允许其使用多线程。

在代码中他定义了一个常量；

```
//  number of threads
public static final int THREADS =  Runtime.getRuntime().availableProcessors(); 
```

然后设置用于创建图像的线程数。

我理解他的推理，即线程数不能大于可用处理器的数量，因此将其设置为充分发挥处理器潜力的数量。它是否正确？还是有更好的方法来利用处理器的全部潜力？

编辑：为了更清楚地说明，正在线程化的特定算法可以缩放到正在创建的图片的分辨率（每个像素 1 个线程）。但这显然不是最好的解决方案。该算法所做的工作是所有时间的工作，并且完全是数学运算，没有锁或其他因素会导致任何给定线程休眠。我只想最大化程序 CPU 利用率以减少完成时间。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-25T04:48:17.997

线程很好，但正如其他人所指出的，您必须高度了解您的瓶颈。您的算法听起来很容易受到多个 CPU 之间的缓存争用的影响 - 这尤其令人讨厌，因为它有可能影响所有线程的性能（通常您会考虑在等待慢速或高速时使用多个线程继续处理延迟 IO 操作）。

缓存争用是使用多 CPU 处理高度并行化算法的一个非常重要的方面：确保考虑到内存利用率。如果您可以构建数据对象，使每个线程都有自己的内存供其工作，那么您可以大大减少 CPU 之间的缓存争用。例如，拥有一个大整数数组并让不同的线程处理该数组的不同部分可能更容易 - 但在 Java 中，对该数组的边界检查将尝试访问内存中的相同地址，这可能导致给定 CPU 必须从 L2 或 L3 缓存重新加载数据。

[将数据拆分成它自己的数据结构，并配置这些数据结构，使它们是线程本地的（使用ThreadLocal](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/ThreadLocal.html)甚至可能更优化——它实际上使用操作系统中的结构，提供 CPU 可以用来优化缓存的保证。

我能给你的最好的建议是测试，测试，测试。不要对 CPU 的性能做出假设——如今，CPU 中正在发生*大量*的魔法，通常会产生违反直觉的结果。另请注意，JIT 运行时优化将在这里增加一层额外的复杂性（也许很好，也许不是）。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-24T23:14:25.083

一方面，您会认为 Threads == CPU/Cores 非常有意义。如果没有任何东西可以运行它，为什么还要有一个线程？

细节归结为“线程在做什么”。空闲等待网络数据包或磁盘块的线程是在浪费 CPU 时间。

如果您的线程占用大量 CPU，那么 1:1 的相关性是有意义的。如果您有一个为其他线程提供数据的“读取数据库”线程，以及一个“转储数据”线程并从 CPU 线程中提取数据并创建输出，那么这两个线程很可能很容易共享一个 CPU，而 CPU 很重线程不断搅动。

与各种事情一样，真正的答案是衡量它。由于数字是可配置的（显然），配置它！以 1:1 线程到 CPU、2:1、1.5:1 等运行它，并对结果进行计时。快的一方获胜。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-24T23:11:51.067

您的应用程序需要的号码；不多也不少。

显然，如果您正在编写一个包含一些可并行算法的应用程序，那么您可能可以开始进行基准测试以在线程数量上找到一个良好的平衡，但请记住，数百个线程不会加速任何操作。

如果您的算法无法并行化，那么没有多少额外的线程会有所帮助。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T23:15:18.657

是的，这是一个完全合理的方法。每个处理器/内核一个线程将最大化处理能力并最小化上下文切换。除非我通过基准测试/分析发现问题，否则我可能会保持原样。

需要注意的一件事是 JVM 不保证`availableProcessors()`会保持不变，因此从技术上讲，您应该在生成线程之前立即检查它。不过，我怀疑这个值在典型计算机上运行时可能会发生变化。

PS 正如其他人所指出的，如果您的进程不受 CPU 限制，那么这种方法不太可能是最佳的。但是，由于您说这些线程用于生成图像，因此我假设您*受*CPU 限制。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T23:17:56.887

处理器数量是一个好的开始；但是，如果这些线程执行大量 i/o，那么更多...或更少可能会更好。

首先考虑有哪些可用资源以及您想要优化什么（完成时间最短、对其他任务的影响最小等）。然后做数学。

有时，如果您将一个或两个线程专用于每个 i/o 资源，而其他线程争夺 CPU，可能会更好。在这些设计上，analisys 通常更容易。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T23:21:39.123

使用线程的好处是通过允许您的程序在作业的不同部分上工作而另一部分正在等待某些事情发生（通常是 I/O）来减少程序的挂钟执行时间。如果您的程序完全受 CPU 限制，则添加线程只会减慢它的速度。如果它是完全或部分 I/O 绑定的，添加线程可能会有所帮助，但在添加线程的开销和将要完成的额外工作之间需要达到一个平衡点。如果程序完全或几乎完全受 CPU 限制，使线程数等于处理器数将产生峰值性能。

与许多带有“应该”一词的问题一样，答案是“视情况而定”。如果您认为可以获得更好的性能，请向上或向下调整线程数并对应用程序的性能进行基准测试。还要考虑可能影响决策的任何其他因素（如果您的应用程序正在消耗 100% 的计算机可用功率，那么其他应用程序的性能将会降低）。

这假设多线程代码编写正确等。如果原始开发人员只有一个 CPU，他将永远不会遇到编写糟糕的线程代码的问题。因此，您可能应该在调整线程数时测试行为和性能。

顺便说一句，您可能需要考虑允许在运行时而不是编译时配置线程数，以使整个过程更容易。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-24T23:30:19.913

看到您的编辑后，很有可能每个 CPU 一个线程就可以做到最好。您的应用程序似乎非常可并行化。如果您有额外的硬件，您可以使用 GridGain 为您的应用程序启用网格并让它在多台机器上运行。除了购买更快/更多的内核之外，这可能是唯一可以加快速度的事情。

# wpf - 如何将 WPF 的 D3DImage 与托管 DirectX 或 XNA 一起使用？

> ID：130507
> 
> 赞同：5
> 
> 时间：2008-09-24T23:07:40.763
> 
> 标签：wpf, directx, xna

我真的很想学习一些 D3D 编码，但是我最近没有时间学习 C++ 来完成一个爱好项目。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T02:39:13.487

据我所知，它没有得到官方支持。看起来有些人[破解了它以使其工作](http://jmorrill.hjtcentral.com/Home/tabid/428/EntryID/259/Default.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T18:01:50.310

看起来这可能不再是一个问题，至少在 .NET 4.0 中。微软周二在 PDC 上展示了 XNA 与 WPF 集成的演示。如果您想看到它的实际效果，您可以在 PDC 网站上观看会议视频：

[https://sessions.microsoftpdc.com/public/timeline.aspx](https://sessions.microsoftpdc.com/public/timeline.aspx)

会议是 PC46（WPF 路线图），XNA 演示在 38 分钟左右。我希望他们能在今天的 WPF 图形期货谈话（PC07 会议）中详细介绍。可能有点落后，但令人鼓舞的是他们正在努力。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-04T00:54:18.100

如果您正在寻找一种托管方式来进行 Direct3D 编程，我会推荐[SlimDX](http://slimdx.mdxinfo.com/wiki/index.php?title=Main_Page)。它是一个基于 DirectX 的开源 .NET 包装器。由于 Microsoft 不再支持托管 DirectX，因此这是将托管代码与 D3D 一起使用的好方法。它的更新非常频繁，到目前为止我使用它的运气非常好。[这里](http://www.gamedev.net/community/forums/topic.asp?topic_id=507941)有一个线程讨论将 SlimDX 与 D3DImage 结合使用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-24T22:40:40.687

托管 DirectX 和 XNA 的另一个替代方案是[MOgre](http://www.ogre3d.org/wiki/index.php/MOGRE)，它是一个 C# 包装器，它围绕一个使用 Direct3D 的优秀开源 C++ 图形引擎，称为[Ogre3D](http://www.ogre3d.org/)。（如果这是一个爱好项目，我认为使用这样的引擎而不是直接 D3D 可能会更快。我对 XNA 或 SlimDX 了解不多。）

[这是 Leslie Godwin 的 CodeProject 文章，](http://www.codeproject.com/KB/WPF/OgreInTheWpf.aspx)它采用 D3DImage 类（来自 Ian 提到的 Dr. WPF 文章）并展示了如何将它与 MOgre 一起使用。

[编辑：我创建了一个名为MogreInWpf](http://bitbucket.org/JaredThirsk/mogreinwpf)的开源项目，用于将 D3DImage 与 Mogre 结合使用，基于上面引用的 Leslie Godwin 的代码，以及一个替代示例应用程序。

# php - PHP：用于向浏览器发送数据的当前编码

> ID：130511
> 
> 赞同：1
> 
> 时间：2008-09-24T23:08:19.483
> 
> 标签：php, header, character-encoding

向浏览器发送数据时，我如何知道 PHP 将使用什么编码？即带有 Cotent-Type 标头，例如：iso-8859-1。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T23:12:33.000

您可以使用 William 建议的 header() 解决方案，但是如果您正在运行 Apache，并且 Apache 配置使用默认字符集，那么每次都会获胜（Internet Explorer 会发疯）请参阅：[AddDefaultCharset](http://httpd.apache.org/docs/2.0/mod/core.html#adddefaultcharset)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T23:22:59.307

请记住，内容类型和编码是两个不同的东西。text/html 是一个内容类型；ISO-8859-1 和 UTF-8 是编码。

服务器发送的 HTTP 响应标头通常如下所示：

```
Content-Type: text/html; charset=utf-8 
```

“charset”实际上是字符编码。它不在单独的标题中；但是有一个名为“Content-Encoding”的标头实际上指定了响应使用的压缩类型（例如 gzip）。

如果要将字符编码更改为 UTF-8，请在包含 HTML 的文件中：

```
<?
header("Content-Type: text/html; charset=utf-8"); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-06T12:16:28.477

通常 webhosters 的 Apache + PHP 服务器被配置为发送**NO`charset`标头**。测试服务器配置方式的最短方法是：

*   使用此工具通过在您的网站上获取您的任何一个页面[来查看服务器标头。](http://www.seoconsultants.com/tools/headers)如果您在服务器标头中看到 a `charset`，则表示您的服务器正在使用它，通常它不会包含`charset`.
*   另一种方法是在您的服务器上运行这个简单的脚本：`<?php echo ini_get('default_charset'); ?>`如上所述，这通常会打印出一个空字符串，如果不同，它将向您显示`charset`PHP 的。

第二个解决方案是假设 Apache 没有配置，`AddDefaultCharset some_charset`这通常不是这种情况，但在这种情况下，我担心 Apache 设置可能会覆盖 PHP deafult_charset ini 指令。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T23:10:09.103

你可以设置你自己的`header('Content-type: xxx/yyy');`，但我相信 text/html 是默认发送的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T23:10:52.567

AFAIK，PHP 按字节发送字符串。也就是说，如果您的变量包含 UTF-8，它将发送 UTF-8。如果你有 iso-8859-1，它也会发送。如果你把它们混合起来，它不会很漂亮。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-08-30T17:45:09.787

如果您的服务器未配置为具有默认内容或字符集，PHP 也没有，则 PHP 将仅发送`Content-Type: text/html`- 它根本不会指定字符集，并将发送它在脚本中看到的字节。

如果浏览器接收到没有指定字符集的页面，可能会发生各种情况：

*   大多数浏览器都有“编码/字符集”菜单；如果用户明确选择一个，浏览器将尝试应用它。不会经常发生，所以：
*   一些浏览器尝试使用默认字符集呈现它（这取决于区域设置，例如，对于 FF 和 cs_CZ，它曾经是`iso-8859-2`；YMMV）
*   IE 将尝试以启发式方式确定字符集（它会根据字符分布进行猜测 - 很多时候它是正确的；有时它会出错，你会得到一个罗马尼亚语页面被解释为中文文本，这通常意味着“不可读")
*   一些旧浏览器将重新使用`us-ascii`

如果使用此过程，PHP 脚本的字符集和浏览器的字符集匹配，则文本将 - 意外 - 可读。如果没有，就会出现奇怪的迹象和类似的现象。

# vba - 在 PowerPoint 中重命名对象

> ID：130526
> 
> 赞同：16
> 
> 时间：2008-09-24T23:11:45.077
> 
> 标签：vba, ms-office, powerpoint

可能是一个非常愚蠢的问题，但我不知道如何在 PowerPoint 中重命名对象。例如，默认情况下，我的所有图表都称为“图表 1”等。有人可以帮我吗？谢谢！

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-24T23:19:04.777

在 PowerPoint 2007 中，您可以从“选择”窗格执行此操作。

要显示选择窗格，请单击功能区中的主页选项卡，然后单击排列，然后单击底部的“选择窗格...”。选择窗格将在右侧打开。（或按 CTRL+F10）

要重命名对象，首先选择对象，然后在选择窗格中双击对象名称，您将能够键入新的对象名称。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-21T23:05:09.947

（此答案假设您只是在开发过程中分配更有意义的名称，因此您引用对象的其他代码更具可读性）。

将下面的代码放入 sub 中，然后从相关幻灯片中运行它。将依次选择每个形状，因此您可以看到正在引用的形状。输入框将告诉您当前名称并要求您输入新名称。如果您取消或确定零长度输入，则旧名称将保持不变。此代码中没有名称输入验证，因此请确保仅键入有效名称。运行一次后，您可以再次运行它，以检查您在第一轮中键入的名称是否已应用于您想要的对象。

循环将覆盖当前幻灯片上的所有对象，因此如果要处理多张幻灯片，则必须在每张幻灯片上单独运行。幻灯片上的每个对象都被考虑在内：标题、绘图对象、组、嵌入图片、方程式等 - 只是不要为您不关心的对象键入新名称。

在您的开发完成后，最好隐藏（Private Sub）或删除此代码，以免您的用户错误地更改对象名称。

```
Dim s As Integer, NewName As String

With ActiveWindow.Selection.SlideRange
    For s = 1 To .Shapes.Count
        .Shapes(s).Select ' So you can see the object in question
        NewName = InputBox(.Shapes(s).Name) ' Tell what current name it is and ask for new name
        If Len(NewName) > 0 Then .Shapes(s).Name = NewName ' If you typed a new name, apply it
    Next s ' 1 To .Shapes.Count
End With ' ActiveWindow.Selection.SlideRange 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T23:50:45.590

感谢您的帮助，但实际上我只是使用 VBA 来做...

```
ActiveWindow.Selection.ShapeRange(1).Name = "newname" 
```

干杯

# javascript - 谁能推荐一个好的 Javascript 中的 Hashtable 实现？

> ID：130543
> 
> 赞同：28
> 
> 时间：2008-09-24T23:15:41.540
> 
> 标签：javascript, dictionary, hashtable, associative-array

我发现 jCache 和其他一些使用关联数组的本土方法。如果您有使用 jCache 的经验，是否有任何限制？

# finalbuilder - In FinalBuilder, how do I use the HTTP Get File action with Windows Authentication?

> ID：130546
> 
> 赞同：1
> 
> 时间：2008-09-24T23:17:09.273
> 
> 标签：finalbuilder

I have a FinalBuilder project where I deploy an ASP.Net website to a remote folder, configured as a website in IIS. As part of my build script, I want to use the FinalBuilder action **HTTP Get File** to help determine whether my deployment was succesful.

I'm having difficulty, because the website is configured (under IIS 6) to use Integrated Windows Authentication, and anonymous access is not enabled.

Now the HTTP Get File action, has only a handful of properties, one of which is a security section, containing a UserName and Password. Great I thought! I can just put some valid credentials in there, which FinalBuilder will impersonate, whilst retrieving my file. It turns out I was mistaken. I receive the following error:

> Error retrieving url : Socket Error # 10061 Connection refused.

If I run the action *without* setting the Security Username and Password, I get the following error:

> Error retrieving url : HTTP/1.1 401 Unauthorized Response Code : 401

Here are some facts to help with the context of my problem. I'm running FinalBuilder 6 Professional, upon a Windows Server 2003 installation, and deploying my ASP.Net website to a remote IIS6 server within our corporate LAN. If I configure IIS on the remote server to allow Anonymous access, I can run the HTTP Get File action without error. However, running this particular site with anon access is not acceptable in our situation.

Can anyone help suggest a workaround?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-27T07:56:45.240

For a definitive answer, I think the [Finalbuilder Forum](http://www.finalbuilder.com/forums.aspx?view=topics&forumid=1) is probably your best bet.

My guess, though, is that the HTTP library used by FB doesn't support Windows authentication, and is failing because no common authentication method can be negotiated. Since HTTPS isn't supported either by the 'HTTP Get File action', the possible workaround of allowing basic authentication on your site isn't a good idea, as you would be passing credentials over the network in plain text.

The only remaining workaround I can think of (other than waiting for a future FB release), is creating your own FB action to retrieve the file. Using the .NET Framework [System.Net.WebClient](http://msdn.microsoft.com/en-us/library/system.net.webclient.aspx), that should be trivial. Just start with a standalone EXE to make sure everything works, then refactor it into a 'real' action using FinalBuilder Action Studio (if that's even required: spawning an external EXE may work just fine in your case).

# sql-server - 设置 Rails 以使用 sqlserver

> ID：130547
> 
> 赞同：13
> 
> 时间：2008-09-24T23:17:12.927
> 
> 标签：sql-server, ruby-on-rails, windows, ruby

好的，我按照在我的 Vista 机器上设置 ruby​​ 和 rails 的步骤操作，但在连接数据库时遇到问题。

## 的内容`database.yml`

```
development:
  adapter: sqlserver
  database: APPS_SETUP
  Host: WindowsVT06\SQLEXPRESS
  Username: se
  Password: paswd 
```

`rake db:migrate`从 myapp 目录运行

```
----------
rake aborted!
no such file to load -- deprecated 
```

## **ADO**

我安装了 dbi 0.4.0 并在

`C:\Ruby\lib\ruby\site_ruby\1.8\DBD\ADO`

我从 dbi 0.2.2 得到了 ado.rb

我还应该看什么来解决连接到数据库的问题？请不要告诉我使用 MySql 或 Sqlite 或 Postgres。

****更新****

我已经从 --source= [http://gems.rubyonrails.org安装了 activerecord-sqlserver-adapter gem](http://gems.rubyonrails.org)

还是行不通。

我已经验证我可以通过使用凭据登录到 SQL Management Studio 来连接到数据库。

* * *

**耙分贝：迁移——跟踪**

* * *

```
PS C:\Inetpub\wwwroot\myapp> rake db:migrate --trace
(in C:/Inetpub/wwwroot/myapp)
** Invoke db:migrate (first_time)
** Invoke environment (first_time)
** Execute environment
** Execute db:migrate
rake aborted!
no such file to load -- deprecated
C:/Ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:27:in `gem_original_require'
C:/Ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:27:in `require'
C:/Ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.1/lib/active_support/dependencies.rb:510:in `require'
C:/Ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.1/lib/active_support/dependencies.rb:355:in `new_constants_in'
C:/Ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.1/lib/active_support/dependencies.rb:510:in `require'
C:/Ruby/lib/ruby/site_ruby/1.8/dbi.rb:48
C:/Ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:27:in `gem_original_require'
C:/Ruby/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:27:in `require'
C:/Ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.1/lib/active_support/dependencies.rb:510:in `require'
C:/Ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.1/lib/active_support/dependencies.rb:355:in `new_constants_in'
C:/Ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.1/lib/active_support/dependencies.rb:510:in `require'
C:/Ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.1/lib/active_support/core_ext/kernel/requires.rb:7:in `require_library_
or_gem'
C:/Ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.1/lib/active_support/core_ext/kernel/reporting.rb:11:in `silence_warnin
gs'
C:/Ruby/lib/ruby/gems/1.8/gems/activesupport-2.1.1/lib/active_support/core_ext/kernel/requires.rb:5:in `require_library_
or_gem'
C:/Ruby/lib/ruby/gems/1.8/gems/activerecord-sqlserver-adapter-1.0.0.9250/lib/active_record/connection_adapters/sqlserver
_adapter.rb:29:in `sqlserver_connection'
C:/Ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/connection_adapters/abstract/connection_specificatio
n.rb:292:in `send'
C:/Ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/connection_adapters/abstract/connection_specificatio
n.rb:292:in `connection='
C:/Ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/connection_adapters/abstract/connection_specificatio
n.rb:260:in `retrieve_connection'
C:/Ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/connection_adapters/abstract/connection_specificatio
n.rb:78:in `connection'
C:/Ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/migration.rb:408:in `initialize'
C:/Ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/migration.rb:373:in `new'
C:/Ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/migration.rb:373:in `up'
C:/Ruby/lib/ruby/gems/1.8/gems/activerecord-2.1.1/lib/active_record/migration.rb:356:in `migrate'
C:/Ruby/lib/ruby/gems/1.8/gems/rails-2.1.1/lib/tasks/databases.rake:99
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/lib/rake.rb:621:in `call'
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/lib/rake.rb:621:in `execute'
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/lib/rake.rb:616:in `each'
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/lib/rake.rb:616:in `execute'
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/lib/rake.rb:582:in `invoke_with_call_chain'
C:/Ruby/lib/ruby/1.8/monitor.rb:242:in `synchronize'
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/lib/rake.rb:575:in `invoke_with_call_chain'
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/lib/rake.rb:568:in `invoke'
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/lib/rake.rb:2031:in `invoke_task'
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/lib/rake.rb:2009:in `top_level'
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/lib/rake.rb:2009:in `each'
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/lib/rake.rb:2009:in `top_level'
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/lib/rake.rb:2048:in `standard_exception_handling'
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/lib/rake.rb:2003:in `top_level'
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/lib/rake.rb:1982:in `run'
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/lib/rake.rb:2048:in `standard_exception_handling'
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/lib/rake.rb:1979:in `run'
C:/Ruby/lib/ruby/gems/1.8/gems/rake-0.8.2/bin/rake:31
C:/Ruby/bin/rake:19:in `load'
C:/Ruby/bin/rake:19
PS C:\Inetpub\wwwroot\myapp> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T15:56:13.143

我昨天遇到了同样的问题。显然 'deprecated' 是一个 gem，所以你想运行 "gem install deprecated" 来获取并安装最新版本。祝你好运。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-30T18:49:14.983

我使用了 ODBC 数据源和 Windows Server 2008 上的 SQL Server 适配器，以针对在远程实例上运行的 SQL Server 2000。

**安装 SQL Server 适配器**

```
gem.bat install activerecord-sqlserver-adapter
  Successfully installed deprecated-2.0.1
  Successfully installed dbi-0.4.1
  Successfully installed dbd-odbc-0.2.4
  Successfully installed activerecord-sqlserver-adapter-2.2.22
  4 gems installed 
```

**创建 ODBC 数据源**

*   类型：SQL Server
*   名称：rails_development
*   描述：rails_development
*   服务器：服务器
*   SQL 身份验证 (sa/12345)
*   默认数据库：DATABASE

**设置数据库.yml**

```
development:
    adapter: sqlserver
    mode: odbc
    dsn: rails_development
    username: sa
    password: 12345 
```

**YMMV**

几个有用的链接：

*   [http://rubyrailsandwindows.blogspot.com/2008/03/rails-2-and-sql-server-2008-on-windows_24.html](http://rubyrailsandwindows.blogspot.com/2008/03/rails-2-and-sql-server-2008-on-windows_24.html)
*   [http://wiki.rubyonrails.org/rails/pages/HowToUseLegacySchemas](http://wiki.rubyonrails.org/rails/pages/HowToUseLegacySchemas)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-25T04:38:01.717

您是否安装了 SQL Server 适配器？

```
gem install activerecord-sqlserver-adapter --source=http://gems.rubyonrails.org 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-06T18:21:44.320

如果您使用的是 64 位计算机，则有两个 ODBC 管理员程序，一个用于 32 位，一个用于 64 位。activerecord-sqlserver-adapter 查找使用 32 位版本设置的 DSN。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-19T21:45:14.727

正确的链接是[http://rubyrailsandwindows.blogspot.com/2008/03/rails-2-and-sql-server-2008-on-windows_24.html](http://rubyrailsandwindows.blogspot.com/2008/03/rails-2-and-sql-server-2008-on-windows_24.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-12T19:29:15.167

我也遇到过这个问题。还有另一种解决方法。您可以从控制面板->管理工具->Odbc 为应用程序数据库创建 DSN。Database.yml 文件应如下所示：

```
adapter: sqlserver
mode: odbc
dsn: DSN_NAME
host: localhost
database: App_development
username: uname
password: password 
```

我尝试使用已弃用的 gem，并没有多大用处。我也尝试过安装一个 ADO 适配器，但它变得无用。

# c# - 服务定位协议的示例客户端实现？

> ID：130558
> 
> 赞同：1
> 
> 时间：2008-09-24T23:19:50.657
> 
> 标签：c#, active-directory, ldap

有谁知道可以在 Windows 盒子上构建/运行的服务位置协议的一个很好的示例实现？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T03:15:25.893

据说[OpenSLP在 Windows 上编译得很好。](http://www.openslp.org/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T17:52:27.957

上面提到的 OpenSLP 是 Novell 现在用于 eDirectory 的 SLP 实施的代码库。如今，真正真正使用 SLP 的东西并不多。通常更多的是半心半意的实施

# asp.net - 使用 Web 用户控件更新页面文本

> ID：130561
> 
> 赞同：0
> 
> 时间：2008-09-24T23:20:16.117
> 
> 标签：asp.net, user-controls

我正在构建一个应用程序，其中页面将根据查询字符串动态加载用户控件（x.ascx）。

我在页面上有一个验证摘要，并希望从用户控件更新它。这将允许我使用一个验证摘要进行多个控件。如何在控件和页面之间传递数据。

我知道我可以在设计时定义控件并使用事件来执行此操作，但这些控件是使用 Page.LoadControl 动态加载的。

另外，我想避免使用会话或查询字符串。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T04:30:50.533

**找到了这样做的方法：**

第 1 步：创建一个基本用户控件并在此控件中定义委托和事件。

第 2 步：在基本用户控件中创建一个公共函数以引发在第 1 步中定义的事件。

```
'第 1 步和第 2 步的源代码
Public Delegate Sub UpdatePageHeaderHandler(ByVal PageHeading As String)
公共类 CommonUserControl
    继承 System.Web.UI.UserControl

    公共事件 UpdatePageHeaderEvent 作为 UpdatePageHeaderHandler
    Public Sub UpdatePageHeader(ByVal PageHeadinga As String)
        RaiseEvent UpdatePageHeaderEvent(PageHeadinga)
    结束子
结束类

```

第 3 步：从您在第 1 步中创建的基本用户控件继承您的 Web 用户控件。

第 4 步：从您的 Web 用户控件 - 调用您在第 2 步中定义的 MyBase.FunctionName。

```
'步骤 3 和步骤 4 的源代码
部分类 DerivedUserControl
    继承 CommonUserControl

    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) 处理 Me.Load
        MyBase.PageHeader("测试页眉")
    结束子
结束类

```

第 5 步：在您的页面中，使用 Page.LoadControl 动态加载控件并将控件转换为基本用户控件。

第 6 步：使用此控件附加事件处理程序。

```
'第 5 步和第 6 步的源代码
私有子 LoadDynamicControl()
    尝试
        '尝试加载控件
        Dim c As CommonUserControl = CType(LoadControl("/Common/Controls/Test.ascx", CommonUserControl))
        '将事件处理程序附加到 LoadedControl
        AddHandler c.UpdatePageHeaderEvent, AddressOf PageHeaders
        DynamicControlPlaceHolder.Controls.Add(c)
    抓住前任作为例外
        '日志错误
    结束尝试
结束子
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T23:46:04.650

假设您正在谈论 asp 的验证器控件，使它们与验证摘要一起工作应该很容易：使用相同的验证组。通常，我从添加了 ValidationGroup 属性的基类派生所有用户控件，该属性的设置器调用将所有内部验证器更改为同一验证组的重写方法。

棘手的部分是让它们在动态添加时表现出来。您应该注意一些问题，主要是关于页面周期以及何时将它们添加到 Page 对象。如果您知道在设计期间将使用的所有可能的用户控件，我会尝试使用 EnableViewState 和 Visible 静态添加它们以最小化开销，即使它们太多。

# javascript - 我怎样才能让表格的主体滚动但将其头部固定在原位？

> ID：130564
> 
> 赞同：148
> 
> 时间：2008-09-24T23:21:48.280
> 
> 标签：javascript, html, css, html-table

我正在写一个页面，我需要一个 HTML 表格来保持设定的大小。我需要表格顶部的标题始终保持在那里，但无论向表格中添加多少行，我还需要表格的主体滚动。想想一个迷你版的excel。这似乎是一项简单的任务，但我在网上找到的几乎所有解决方案都有一些缺点。我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-09-29T21:36:36.423

我必须找到相同的答案。我发现的最佳示例是[http://www.cssplay.co.uk/menu/tablescroll.html](http://www.cssplay.co.uk/menu/tablescroll.html) - 我发现示例 #2 对我来说效果很好。您必须使用 Java Script 设置内表的高度，其余的是 CSS。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2011-12-18T03:25:55.050

我发现[DataTables](http://datatables.net/examples/basic_init/scroll_y.html)非常灵活。虽然它的默认版本基于 jquery，但还有一个[AngularJs 插件](http://l-lin.github.io/angular-datatables/#/withScroller)。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2012-10-11T18:55:29.637

我看到了 Sean Haddy[对类似问题的出色解决方案，](https://stackoverflow.com/questions/1019938/make-tbody-scrollable-in-webkit-browsers/11460752#11460752)并冒昧地[进行了一些编辑](http://jsfiddle.net/jhfrench/eNP2N/)：

*   使用类而不是 ID，因此一个 jQuery 脚本可以重复用于一页上的多个表
*   添加了对语义 HTML 表格元素的支持，例如标题、thead、tfoot 和 tbody
*   使滚动条可选，因此它不会出现在比可滚动高度“短”的表格中
*   调整滚动 div 的宽度以使滚动条上升到表格的右边缘
*   使概念可通过
    *   在注入的静态表头上使用 aria-hidden="true"
    *   并留下原始的thead，只是用jQuery隐藏并设置`aria-hidden="false"`
*   显示了多个不同大小的表格的示例

不过，肖恩完成了繁重的工作。也感谢 Matt Burland 指出需要支持 tfoot。

请在[http://jsfiddle.net/jhfrench/eNP2N/上亲自查看](http://jsfiddle.net/jhfrench/eNP2N/)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-24T23:23:13.300

您是否尝试过使用 thead 和 tbody，并使用 overflow:scroll 在 tbody 上设置固定高度？

你的目标浏览器是什么？

编辑：它在 Firefox 中（几乎）运行良好 - 添加垂直滚动条也导致需要水平滚动条 - 呸。IE 只是将每个 td 的高度设置为我指定的 tbody 高度。这是我能想到的最好的：

```
<html>
    <head>
    <title>Blah</title>
    <style type="text/css">
    table { width:300px; }
    tbody { height:10em;  overflow:scroll;}
    td { height:auto; }
    </style>
    </head>
    <body>
    <table>
        <thead>
            <tr>
              <th>One</th><th>Two</th>
              </td>
            </tr>
        </thead>
        <tbody>
            <tr><td>Data</td><td>Data</td></tr>
            <tr><td>Data</td><td>Data</td></tr>
            <tr><td>Data</td><td>Data</td></tr>
            <tr><td>Data</td><td>Data</td></tr>
            <tr><td>Data</td><td>Data</td></tr>
            <tr><td>Data</td><td>Data</td></tr>
            <tr><td>Data</td><td>Data</td></tr>
            <tr><td>Data</td><td>Data</td></tr>
            <tr><td>Data</td><td>Data</td></tr>
            <tr><td>Data</td><td>Data</td></tr>
            <tr><td>Data</td><td>Data</td></tr>
            <tr><td>Data</td><td>Data</td></tr>
            <tr><td>Data</td><td>Data</td></tr>
            <tr><td>Data</td><td>Data</td></tr>
            <tr><td>Data</td><td>Data</td></tr>
        </tbody>
    </table>
    </body>
</html> 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2014-05-11T15:26:43.693

你需要的是：

1)**具有有限高度的表格主体，**因为仅当内容大于滚动窗口时才会发生滚动。但是`tbody`无法调整大小，您必须将其显示为 a`block`这样做：

```
tbody {
   overflow-y: auto;
   display: block;
   max-height: 10em;    // For example
} 
```

2)**重新同步表头和表体列的宽度**，使后者成为`block`不相关的元素。这样做的唯一方法是通过*对两者强制使用相同的列宽度来*模拟同步。

但是，由于`tbody`它本身是 a `block`now，它的行为不再像 a `table`。由于您仍然需要`table`正确显示列的行为，因此解决方案是要求您的每一行显示为单独`table`的 s：

```
thead {         
   display: table;  
   width: 100%;     // Fill the containing table
}
tbody tr {
   display: table;
   width: 100%;     // Fill the containing table
} 
```

（请注意，使用此技术，您将无法再跨越行）。

完成后，您可以强制列宽在`thead`和中具有相同的宽度`tbody`。你不能这样：

*   单独为每一列（通过特定的 CSS 类或内联样式），这对于每个表实例来说是相当乏味的；
*   统一用于所有列（`th, td { width: 20%; }`例如，如果您有 5 列），这更实用（无需为每个表实例设置宽度）但不适用于任何列数
*   通过固定的表格布局，对任何列数统一。

我更喜欢最后一个选项，它需要添加：

```
thead {
   table-layout: fixed;   // Same layout for all cells
}
tbody tr {
   table-layout: fixed;   // Same layout for all cells
}
th, td {
   width: auto;   // Same width for all cells, if table has fixed layout
} 
```

[在这里](http://jsfiddle.net/Javarome/DQJJW/1/)查看一个演示，从[这个问题](https://stackoverflow.com/questions/16984323/table-tbody-scroll-in-ie8)的答案中分叉出来。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-05-04T15:20:31.250

**编辑：**   这是一个非常古老的答案，在这里是为了繁荣，只是为了表明它在 2000 年代曾受到支持，但由于 2010 年代的浏览器策略是尊重 W3C 规范，即使删除了某些功能，它也是如此：具有固定标题的可滚动表/footer 在 HTML5 之前被笨拙地指定。

* * *

## 坏消息

不幸的是，没有优雅的方法来处理带有固定`thead`/的可滚动表格，`tfoot` 因为[HTML/CSS 规范对该功能不是很清楚](https://bugzilla.mozilla.org/show_bug.cgi?id=135236#c36)。

## 解释

虽然[HTML 4.01 规范](http://www.w3.org/TR/html401/struct/tables.html#idx-row_group)说`thead`/ `tfoot`/`tbody`用于（引入？）滚动表格正文：

> 可以使用 THEAD、TFOOT 和 TBODY 元素 [...] 对表行进行分组 [...]。这种划分使用户代理能够支持独立于表头和表脚滚动表体。

但是 FF 3.6 上的工作可滚动表格功能已在 FF 3.7 中删除，因为不符合 HTML/CSS 规范被认为是一个错误。请参阅[有关](https://bugzilla.mozilla.org/show_bug.cgi?id=577308#c2)FF 错误[的](https://bugzilla.mozilla.org/show_bug.cgi?id=28800#c35)评论。

## Mozilla 开发者网络提示

下面是简化版的*MDN 可滚动表格的有用提示，*
[请参阅此存档页面](https://developer.mozilla.org/en-US/docs/Useful_CSS_tips/Tables$revision/287559#Fixed_header)或[当前法语版本](https://developer.mozilla.org/fr/docs/Astuces_CSS/Tableaux)

```
<style type="text/css">
table {
  border-spacing: 0;              /* workaround */
}
tbody {
  height: 4em;                    /* define the height */
  overflow-x: hidden;             /* esthetics */
  overflow-y: auto;               /* allow scrolling cells */
}
td {
  border-left:   1px solid blue;  /* workaround */
  border-bottom: 1px solid blue;  /* workaround */
}
</style>

<table>
    <thead><tr><th>Header
    <tfoot><tr><th>Footer
    <tbody>
        <tr><td>Cell 1    <tr><td>Cell 2
        <tr><td>Cell 3    <tr><td>Cell 4
        <tr><td>Cell 5    <tr><td>Cell 6
        <tr><td>Cell 7    <tr><td>Cell 8
        <tr><td>Cell 9    <tr><td>Cell 10
        <tr><td>Cell 11   <tr><td>Cell 12
        <tr><td>Cell 13   <tr><td>Cell 14
    </tbody>
</table> 
```

然而 MDN 也说[这在 FF 上不再起作用](https://developer.mozilla.org/en-US/docs/Useful_CSS_tips/Tables$revision/287559#Fixed_header):-(
我也在 IE8 上测试过 => 表也不能滚动 :-((

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-08-06T15:47:26.477

不知道是否有人还在看这个，但他们以前这样做的方式是使用两个表格来显示单个原始表格 - 第一个只是原始表格标题行，没有表格正文行（或制作一个空的正文行它验证）。

第二个是在一个单独的 div 中，没有标题，只有原始表体行。然后使单独的 div 可滚动。

它的 div 中的第二个表位于 HTML 中第一个表的正下方，它看起来像一个具有固定标题和可滚动下部的单个表。我只在 Safari、Firefox 和 IE（2010 年春季的最新版本）中对此进行了测试，但它在所有这些中都有效。

唯一的问题是第一个表在没有正文的情况下无法验证（W3.org 验证器 - XHTML 1.0 严格），当我添加一个没有内容的表时，它会导致空白行。您可以使用 CSS 使其不可见，但它仍然会占用页面上的空间。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-09-03T21:45:30.380

此解决方案适用于 Chrome 35、Firefox 30 和 IE 11（未测试其他版本）

它的纯 CSS：http: [//jsfiddle.net/ffabreti/d4sope1u/](http://jsfiddle.net/ffabreti/d4sope1u/)

一切都设置为显示：块，表格需要一个高度：

```
 table {
        overflow: scroll;
        display: block;    /*inline-block*/
        height: 120px;
    }
    thead > tr  {
        position: absolute;
        display: block;
        padding: 0;
        margin: 0;
        top: 0;
        background-color: gray;
    }
    tbody > tr:nth-of-type(1) {
        margin-top: 16px;
    }
    tbody tr {
        display: block;
    }

    td, th {
        width: 70px;
        border-style:solid;
        border-width:1px;
        border-color:black;
    } 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-24T23:30:16.170

这让我非常头疼，试图为我们的应用程序实现这样的网格。我尝试了所有各种技术，但它们都有问题。我最接近的是使用 jQuery 插件，例如[Flexigrid](http://webplicity.net/flexigrid/)（在[http://www.ajaxrain.com](http://www.ajaxrain.com)上查看替代方案），但这似乎不支持 100% 宽的表格，而这正是我所需要的。

我最终做的是自己动手；Firefox 支持滚动`tbody`元素，所以我浏览器嗅探并使用适当的 CSS（设置高度、溢出等...询问您是否需要更多详细信息）来进行滚动，然后对于其他浏览器，我使用了两个单独的表来设置使用`table-layout: fixed`大小保证不会溢出规定大小的算法（当内容太宽而无法容纳时，普通表格会扩展）。通过给两个表相同的宽度，我能够让它们的列对齐。我将第二个包裹在一个 div 集中以滚动，并用一些带有边距等的摇摆不定的扑克来设法获得我想要的外观和感觉。

对不起，如果这个答案在某些地方听起来有点含糊；我写得很快，因为我没有太多时间。如果您希望我进一步扩展，请发表评论！

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-01-24T19:34:01.497

这是一个真正适用于 IE 和 FF 的代码（至少）：

```
<html>
<head>
    <title>Test</title>
    <style type="text/css">
        table{
            width: 400px;
        }
        tbody {
            height: 100px;
            overflow: scroll;
        }
        div {
            height: 100px;
            width: 400px;
            position: relative;
        }
        tr.alt td {
            background-color: #EEEEEE;
        }
    </style>
    <!--[if IE]>
        <style type="text/css">
            div {
                overflow-y: scroll;
                overflow-x: hidden;
            }
            thead tr {
                position: absolute;
                top: expression(this.offsetParent.scrollTop);
            }
            tbody {
                height: auto;
            }
        </style>
    <![endif]--> 
</head>
<body>
    <div >
        <table border="0" cellspacing="0" cellpadding="0">
            <thead>
                <tr>
                    <th style="background: lightgreen;">user</th>
                    <th style="background: lightgreen;">email</th>
                    <th style="background: lightgreen;">id</th>
                    <th style="background: lightgreen;">Y/N</th>
                </tr>
            </thead>
            <tbody align="center">
                <!--[if IE]>
                    <tr>
                        <td colspan="4">on IE it's overridden by the header</td>
                    </tr>
                <![endif]--> 
                <tr>
                    <td>user 1</td>
                    <td>user@user.com</td>
                    <td>1</td>
                    <td>Y</td>
                </tr>
                <tr class="alt">
                    <td>user 2</td>
                    <td>user@user.com</td>
                    <td>2</td>
                    <td>N</td>
                </tr>
                <tr>
                    <td>user 3</td>
                    <td>user@user.com</td>
                    <td>3</td>
                    <td>Y</td>
                </tr>
                <tr class="alt">
                    <td>user 4</td>
                    <td>user@user.com</td>
                    <td>4</td>
                    <td>N</td>
                </tr>
                <tr>
                    <td>user 5</td>
                    <td>user@user.com</td>
                    <td>5</td>
                    <td>Y</td>
                </tr>
                <tr class="alt">
                    <td>user 6</td>
                    <td>user@user.com</td>
                    <td>6</td>
                    <td>N</td>
                </tr>
                <tr>
                    <td>user 7</td>
                    <td>user@user.com</td>
                    <td>7</td>
                    <td>Y</td>
                </tr>
                <tr class="alt">
                    <td>user 8</td>
                    <td>user@user.com</td>
                    <td>8</td>
                    <td>N</td>
                </tr>
            </tbody>
        </table>
    </div>
</body></html> 
```

我更改了原始代码以使其更清晰，并使其在 IE 和 FF 中正常工作。

原始代码[在这里](http://geekswithblogs.net/LSheu/Default.aspx)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-11-22T04:34:37.583

我对上述建议的主要问题是能够插入 tablesorter.js 并且能够浮动限制为特定最大大小的表的标题。我最终偶然发现了插件[jQuery.floatThead](http://programmingdrunk.com/floatThead/)，它提供了浮动标题并允许排序继续工作。

它还有一个很好的比较页面，显示自己与[类似插件](http://programmingdrunk.com/floatThead/other-libs.htm)。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-03-03T08:44:04.003

这是我的选择。它还为页眉、正文和页脚使用不同的 DIV，但与窗口大小调整以及搜索、滚动、排序、过滤和定位同步：

[我的 CD 列表](http://hifi.goneill.co.nz/cd.php)

单击 Jazz、Classic... 按钮查看表格。即使关闭了 JavaScript，它的设置也足够了。

在 IE、FF 和 WebKit（Chrome、Safari）上似乎没问题。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-07-19T11:12:38.997

抱歉，我还没有阅读对您问题的所有回复。

是的，你想要的东西在这里（我已经做过了）

您可以使用两个具有相同类名的表来实现相似的样式，一个仅带有表头，另一个带有您的行。现在将此表放在具有固定高度的 div 中，并带有溢出-y：自动或滚动。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-06-29T18:43:38.630

现场[JsFiddle](https://jsfiddle.net/rafee/3zay75ps/)

仅使用 HTML 和 CSS 即可

```
table.scrollTable {
  border: 1px solid #963;
  width: 718px;
}

thead.fixedHeader {
  display: block;
}

thead.fixedHeader tr {
  height: 30px;
  background: #c96;
}

thead.fixedHeader tr th {
  border-right: 1px solid black;
}

tbody.scrollContent {
  display: block;
  height: 262px;
  overflow: auto;
}

tbody.scrollContent td {
  background: #eee;
  border-right: 1px solid black;
  height: 25px;
}

tbody.scrollContent tr.alternateRow td {
  background: #fff;
}

thead.fixedHeader th {
  width: 233px;
}

thead.fixedHeader th:last-child {
  width: 251px;
}

tbody.scrollContent td {
  width: 233px;
}
```

```
<table cellspacing="0" cellpadding="0" class="scrollTable">
  <thead class="fixedHeader">
    <tr class="alternateRow">
      <th>Header 1</th>
      <th>Header 2</th>
      <th>Header 3</th>
    </tr>
  </thead>
  <tbody class="scrollContent">
    <tr class="normalRow">
      <td>Cell Content 1</td>
      <td>Cell Content 2</td>
      <td>Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>More Cell Content 1</td>
      <td>More Cell Content 2</td>
      <td>More Cell Content 3</td>
    </tr>
    <tr class="normalRow">
      <td>Even More Cell Content 1</td>
      <td>Even More Cell Content 2</td>
      <td>Even More Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>And Repeat 1</td>
      <td>And Repeat 2</td>
      <td>And Repeat 3</td>
    </tr>
    <tr class="normalRow">
      <td>Cell Content 1</td>
      <td>Cell Content 2</td>
      <td>Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>More Cell Content 1</td>
      <td>More Cell Content 2</td>
      <td>More Cell Content 3</td>
    </tr>
    <tr class="normalRow">
      <td>Even More Cell Content 1</td>
      <td>Even More Cell Content 2</td>
      <td>Even More Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>And Repeat 1</td>
      <td>And Repeat 2</td>
      <td>And Repeat 3</td>
    </tr>
    <tr class="normalRow">
      <td>Cell Content 1</td>
      <td>Cell Content 2</td>
      <td>Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>More Cell Content 1</td>
      <td>More Cell Content 2</td>
      <td>More Cell Content 3</td>
    </tr>
    <tr class="normalRow">
      <td>Even More Cell Content 1</td>
      <td>Even More Cell Content 2</td>
      <td>Even More Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>And Repeat 1</td>
      <td>And Repeat 2</td>
      <td>And Repeat 3</td>
    </tr>
    <tr class="normalRow">
      <td>Cell Content 1</td>
      <td>Cell Content 2</td>
      <td>Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>More Cell Content 1</td>
      <td>More Cell Content 2</td>
      <td>More Cell Content 3</td>
    </tr>
    <tr class="normalRow">
      <td>Even More Cell Content 1</td>
      <td>Even More Cell Content 2</td>
      <td>Even More Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>And Repeat 1</td>
      <td>And Repeat 2</td>
      <td>And Repeat 3</td>
    </tr>
    <tr class="normalRow">
      <td>Cell Content 1</td>
      <td>Cell Content 2</td>
      <td>Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>More Cell Content 1</td>
      <td>More Cell Content 2</td>
      <td>More Cell Content 3</td>
    </tr>
    <tr class="normalRow">
      <td>Even More Cell Content 1</td>
      <td>Even More Cell Content 2</td>
      <td>Even More Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>And Repeat 1</td>
      <td>And Repeat 2</td>
      <td>And Repeat 3</td>
    </tr>
    <tr class="normalRow">
      <td>Cell Content 1</td>
      <td>Cell Content 2</td>
      <td>Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>More Cell Content 1</td>
      <td>More Cell Content 2</td>
      <td>More Cell Content 3</td>
    </tr>
    <tr class="normalRow">
      <td>Even More Cell Content 1</td>
      <td>Even More Cell Content 2</td>
      <td>Even More Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>And Repeat 1</td>
      <td>And Repeat 2</td>
      <td>And Repeat 3</td>
    </tr>
    <tr class="normalRow">
      <td>Cell Content 1</td>
      <td>Cell Content 2</td>
      <td>Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>More Cell Content 1</td>
      <td>More Cell Content 2</td>
      <td>More Cell Content 3</td>
    </tr>
    <tr class="normalRow">
      <td>Even More Cell Content 1</td>
      <td>Even More Cell Content 2</td>
      <td>Even More Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>And Repeat 1</td>
      <td>And Repeat 2</td>
      <td>And Repeat 3</td>
    </tr>
    <tr class="normalRow">
      <td>Cell Content 1</td>
      <td>Cell Content 2</td>
      <td>Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>More Cell Content 1</td>
      <td>More Cell Content 2</td>
      <td>More Cell Content 3</td>
    </tr>
    <tr class="normalRow">
      <td>Even More Cell Content 1</td>
      <td>Even More Cell Content 2</td>
      <td>Even More Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>And Repeat 1</td>
      <td>And Repeat 2</td>
      <td>And Repeat 3</td>
    </tr>
    <tr class="normalRow">
      <td>Cell Content 1</td>
      <td>Cell Content 2</td>
      <td>Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>More Cell Content 1</td>
      <td>More Cell Content 2</td>
      <td>More Cell Content 3</td>
    </tr>
    <tr class="normalRow">
      <td>Even More Cell Content 1</td>
      <td>Even More Cell Content 2</td>
      <td>Even More Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>And Repeat 1</td>
      <td>And Repeat 2</td>
      <td>And Repeat 3</td>
    </tr>
    <tr class="normalRow">
      <td>Cell Content 1</td>
      <td>Cell Content 2</td>
      <td>Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>More Cell Content 1</td>
      <td>More Cell Content 2</td>
      <td>More Cell Content 3</td>
    </tr>
    <tr class="normalRow">
      <td>Even More Cell Content 1</td>
      <td>Even More Cell Content 2</td>
      <td>Even More Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>And Repeat 1</td>
      <td>And Repeat 2</td>
      <td>And Repeat 3</td>
    </tr>
    <tr class="normalRow">
      <td>Cell Content 1</td>
      <td>Cell Content 2</td>
      <td>Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>More Cell Content 1</td>
      <td>More Cell Content 2</td>
      <td>More Cell Content 3</td>
    </tr>
    <tr class="normalRow">
      <td>Even More Cell Content 1</td>
      <td>Even More Cell Content 2</td>
      <td>Even More Cell Content 3</td>
    </tr>
    <tr class="alternateRow">
      <td>End of Cell Content 1</td>
      <td>End of Cell Content 2</td>
      <td>End of Cell Content 3</td>
    </tr>
  </tbody>
</table>
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-05-16T17:26:48.063

我使用 javascript（无库）和 CSS 执行此操作 - 表格主体**随页面滚动，**表格不必是固定的宽度或高度，尽管每列必须有一个宽度。**您还可以保留排序功能。**

基本上：

1.  在 HTML 中，创建容器 div 来定位表格标题行和表格主体，还创建一个“掩码”div 来隐藏表格主体，因为它滚动经过标题

2.  在 CSS 中，将表格部分转换为块

3.  在Javascript中，获取表格宽度并匹配掩码的宽度...获取页面内容的高度...测量滚动位置...操作CSS设置表格标题行位置和掩码高度

这是 javascript 和**[jsFiddle 演示。](http://jsfiddle.net/deborah/Msvvr/)**

```
// get table width and match the mask width

function setMaskWidth() { 
  if (document.getElementById('mask') !==null) {
    var tableWidth = document.getElementById('theTable').offsetWidth;

    // match elements to the table width
    document.getElementById('mask').style.width = tableWidth + "px";
   }
}

function fixTop() {

  // get height of page content 
  function getScrollY() {
      var y = 0;
      if( typeof ( window.pageYOffset ) == 'number' ) {
        y = window.pageYOffset;
      } else if ( document.body && ( document.body.scrollTop) ) {
        y = document.body.scrollTop;
      } else if ( document.documentElement && ( document.documentElement.scrollTop) ) {
        y = document.documentElement.scrollTop;
      }
      return [y];
  }  

  var y = getScrollY();
  var y = y[0];

  if (document.getElementById('mask') !==null) {
      document.getElementById('mask').style.height = y + "px" ;

      if (document.all && document.querySelector && !document.addEventListener) {
        document.styleSheets[1].rules[0].style.top = y + "px" ;
      } else {
        document.styleSheets[1].cssRules[0].style.top = y + "px" ;
      }
  }

}

window.onscroll = function() {
  setMaskWidth();
  fixTop();
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-04-20T07:36:32.863

如果可以在这里使用 JavaScript 是我的解决方案在所有列（像素！）上创建一个设置固定宽度的表，将类 Scrollify 添加到表中，并在 css 或样式中添加这个 javascript + jquery 1.4.x 设置高度！

测试于：Opera, Chrome, Safari, FF, IE5.5( **Epic script fail** ), IE6, IE7, IE8, IE9

```
//Usage add Scrollify class to a table where all columns (header and body) have a fixed pixel width
$(document).ready(function () {
    $("table.Scrollify").each(function (index, element) {
        var header = $(element).children().children().first();
        var headerHtml = header.html();
        var width = $(element).outerWidth();
        var height = parseInt($(element).css("height")) - header.outerHeight();
        $(element).height("auto");
        header.remove();
        var html = "<table style=\"border-collapse: collapse;\" border=\"1\" rules=\"all\" cellspacing=\"0\"><tr>" + headerHtml +
                         "</tr></table><div style=\"overflow: auto;border:0;margin:0;padding:0;height:" + height + "px;width:" + (parseInt(width) + scrollbarWidth()) + "px;\">" +
                         $(element).parent().html() + "</div>";

        $(element).parent().html(html);
    });
});

//Function source: http://www.fleegix.org/articles/2006-05-30-getting-the-scrollbar-width-in-pixels
//License: Apache License, version 2
function scrollbarWidth() {
    var scr = null;
    var inn = null;
    var wNoScroll = 0;
    var wScroll = 0;

    // Outer scrolling div
    scr = document.createElement('div');
    scr.style.position = 'absolute';
    scr.style.top = '-1000px';
    scr.style.left = '-1000px';
    scr.style.width = '100px';
    scr.style.height = '50px';
    // Start with no scrollbar
    scr.style.overflow = 'hidden';

    // Inner content div
    inn = document.createElement('div');
    inn.style.width = '100%';
    inn.style.height = '200px';

    // Put the inner div in the scrolling div
    scr.appendChild(inn);
    // Append the scrolling div to the doc
    document.body.appendChild(scr);

    // Width of the inner div sans scrollbar
    wNoScroll = inn.offsetWidth;
    // Add the scrollbar
    scr.style.overflow = 'auto';
    // Width of the inner div width scrollbar
    wScroll = inn.offsetWidth;

    // Remove the scrolling div from the doc
    document.body.removeChild(
        document.body.lastChild);

    // Pixel width of the scroller
    return (wNoScroll - wScroll);
} 
```

编辑：固定高度。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-07-26T13:34:57.947

对我来说，在我从表格 CSS 中删除宽度之前，与滚动相关的任何东西都没有真正起作用。最初，表格 CSS 看起来像这样：

```
.table-fill {
    background: white;
    border-radius:3px;
    border-collapse: collapse;
    margin: auto;
    width: 100%;
    max-width: 800px;
    padding:5px;
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
    animation: float 5s infinite;
} 
```

一旦我删除了 width:100%; 所有滚动功能开始工作。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-01-23T18:15:20.730

如果您的标准足够低；）您可以将仅包含标题的表格直接放在只有正文的表格上方。它不会水平滚动，但如果你不需要...

# firebird - 在 Installshield 中，仅在安装时而不是在卸载或修复时启动应用程序的最佳事件是什么？

> ID：130570
> 
> 赞同：0
> 
> 时间：2008-09-24T23:23:31.757
> 
> 标签：firebird, installshield

我们最近从滚动我们自己的安装移回 InstallShield 2008。所以，我仍在努力提高学习曲线。

我们正在使用 Firebird 和一个 USB 驱动程序，我们找不到好的 msi 安装解决方案。因此，我们有一个 cmd 行来静默安装 firebird，而 USB 驱动程序大多静默安装。

我们已将此代码放入事件处理程序 DefaultFeatureInstalled。这在第一次安装时效果很好。但是，当我进行卸载时，它会尝试再次启动 firebird 安装程序，因此它必须再次发送 DefaultFeatureInstalled 事件。

他们是要使用另一个事件，还是有办法在 DefaultFeatureInstalled 事件中检测它是安装还是卸载？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T15:43:18.650

克里斯，我根本无法让 MsiGetProperty 工作。只需添加您拥有的代码

```
string sRemove;
number nBuffer;

nBuffer = 256;
if (MsiGetProperty(ISMSI_HANDLE, "REMOVE", sRemove, nBuffer) = ERROR_SUCCESS) then
     //do something
endif; 
```

我得到“未定义的标识符”。我尝试了几件事来让 IS 识别它，但没有成功。经过一番摸索，我意识到 IS 一开始并没有在卸载时调用该函数。我有另一个函数， onEnd 我认为那是调用相同的东西。清理完之后，我得到了我一开始所期望的结果。

因此，正确的答案是您不必为 DefaultFeature_Installed 事件中的代码在卸载时不被调用做任何事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T12:52:09.653

如果您使用的是 InstallScript 或 InstallScript MSI 项目，您将需要处理 OnFirstUIBefore 事件。第一次运行安装程序时调用它。当安装程序再次启动时，将在其位置引发 OnMaintUIBefore 事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T14:58:14.113

我正在做一个 InstallScript 项目。

我仔细检查了该事件，我使用的函数是带下划线的 DefaultFeature_Installed。我搜索了网络和 IS 的网站，发现提到它但没有定义。我在这里询问了最初将代码移至此事件的开发人员，她不记得将代码移至此事件的位置或原因。

今天早上我将研究 MsiGetProperty。感谢您的指点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T00:20:30.323

您可以查看一些 MSI 属性，这些属性会告诉您产品是否已安装或是否正在卸载。如果产品已经存在，Installed 属性将为真，因此您可以在布尔表达式中使用它（例如：未安装）。如果正在进行卸载，则 REMOVE 属性将设置为“ALL”。您可能可以根据这些属性调整 Firebird 安装逻辑，您可以使用[MsiGetProperty](http://msdn.microsoft.com/en-us/library/aa370134(VS.85).aspx)函数检索这些属性。

注意：属性名称的含义因大小写而异，因此请确保使用上述大小写。

我在 IS 在线帮助或 Google 中找不到对 DefaultFeatureInstalled 事件的任何引用。您的 InstallShield 项目是 Basic MSI 还是 InstallScript？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-28T00:40:20.193

您可以将此代码添加到 DefaultFeature_Installed 事件：

```
string sRemove;
number nBuffer;

nBuffer = 256;
if (MsiGetProperty(ISMSI_HANDLE, "REMOVE", sRemove, nBuffer) = ERROR_SUCCESS) then
     //do something
endif; 
```

注意：函数名区分大小写。ISMSI_HANDLE 值是InstallShield 安装引擎的句柄。如果 sRemove 等于“ALL”，表示正在卸载，您可以跳过 Firebird 安装。

# windows - Windows FILETIME 结构是否包含闰秒？

> ID：130573
> 
> 赞同：20
> 
> 时间：2008-09-24T23:24:45.747
> 
> 标签：windows, datetime, filetime, leap-second

根据 Microsoft 文档，该[`FILETIME`结构](http://msdn.microsoft.com/en-us/library/ms724284(VS.85).aspx)从 1601 年 1 月 1 日（大概是那天开始）开始计算，但这是否包括闰秒？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2010-08-30T18:10:49.630

问题不应该是是否`FILETIME`包含闰秒。

它应该是：

> `FILETIME`解释 a (ie )的人员、函数和库`FileTimeToSystemTime`在计算持续时间时是否包括闰秒？

简单的答案是*“不”*。`FileTimeToSystemTime`返回秒为`0..59`.

* * *

更简单的答案是：“*当然不是，怎么可能呢？* ”。

我的 Windows 2000 机器不知道自发布以来的十年中增加了 2 个闰秒。它对 a 的任何解释`FILETIME`都是错误的。

* * *

最后，我们可以通过直接的实验观察来确定，而不是依靠逻辑，来确定海报问题的答案：

```
var
    systemTime: TSystemTime;
    fileTime: TFileTime;
begin
    //Construct a system-time for the 12/31/2008 11:59:59 pm
    ZeroMemory(@systemTime, SizeOf(systemTime));
    systemtime.wYear := 2008;
    systemTime.wMonth := 12;
    systemTime.wDay := 31;
    systemTime.wHour := 23;
    systemtime.wMinute := 59;
    systemtime.wSecond := 59;

    //Convert it to a file time
    SystemTimeToFileTime(systemTime, {var}fileTime);

    //There was a leap second 12/31/2008 11:59:60 pm
    //Add one second to our filetime to reach the leap second
    filetime.dwLowDateTime := fileTime.dwLowDateTime+10000000; //10,000,000 * 100ns = 1s

    //Convert the filetime, sitting on a leap second, to a displayable system time
    FileTimeToSystemTime(fileTime, {var}systemTime);

    //And now print the system time
    ShowMessage(DateTimeToStr(SystemTimeToDateTime(systemTime))); 
```

增加一秒

```
12/31/2008 11:59:59pm 
```

给

```
1/1/2009 12:00:00am 
```

而不是

```
1/1/2009 11:59:60pm 
```

量子点

原始海报可能不喜欢它，但上帝故意操纵它，使一年不能被一天整除。他这样做只是为了搞砸程序员。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-08-09T00:50:12.080

[以下](https://devblogs.microsoft.com/oldnewthing/20090306-00/?p=18913)是有关选择该特定日期的原因的更多信息。

> FILETIME 结构以 1601 年 1 月 1 日以来 100 纳秒间隔的形式记录时间。为什么选择那个日期？
> 
> 公历以 400 年为周期运行，1601 年是在设计 Windows NT 时处于活动状态的第一年。换句话说，选择它是为了使数学很好地得出结论。
> 
> 我实际上收到了来自 Dave Cutler 的电子邮件，证实了这一点。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-10-05T03:33:10.237

如果不先决定，就不可能有一个单一的答案：Windows FILETIME 实际计数是多少？微软文档说它从 1601 UTC 开始计算 100 纳秒的间隔，但这是有问题的。

在 1960 年之前不存在任何形式的国际协调时间。UTC 名称本身在 1964 年之前的任何文献中都没有出现。作为官方名称的 UTC 名称直到 1970 年才存在。但它变得更糟。皇家格林威治天文台直到 1676 年才成立，因此即使试图将 FILETIME 解释为 GMT 也没有明确的含义，直到那时，带有精确擒纵机构的摆钟才开始提供 1 秒的精度。

如果 FILETIME 被解释为平均太阳秒，那么自 1601 年以来的闰秒数为零，因为 UT 没有闰秒。如果 FILETIME 被解释为好像有原子计时器，那么自 1601 年以来的闰秒数约为 -60（即负 60 闰秒）。

那是古老的历史，自原子钟以来的时代呢？这也好不到哪里去，因为各国政府没有区分平均太阳秒和 SI 秒。十年来，ITU-R一直在讨论放弃闰秒，但尚未达成国际共识。部分原因可以 [在此页面上的 javascript中看到](http://www.ucolick.org/~sla/leapsecs/epochtime.html)（有关古代历史的情节，另请参见该页面上的 delta-T 链接）。由于各国政府尚未做出明确区分，因此自 1972 年以来定义秒数的任何尝试都存在根据某些司法管辖区的法律无效的风险。ITU-R 的代表和 POSIX 委员会的成员都意识到了这种复杂性。在外交问题解决之前，在各国政府和国际标准对平均太阳能和 SI 秒做出明确区分和选择之前，计算机标准能够效仿的希望渺茫。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2018-10-26T20:27:40.837

这个问题的答案曾经是否定的，但现在变成了：**是的，有点，有时**......

根据[Windows 网络团队博客文章](https://blogs.technet.microsoft.com/networking/2018/10/24/leap-seconds-for-the-appdev-what-you-should-know/)：

> 从 Server 2019 开始，Windows 10 October [2018] 更新时间 API 现在将考虑操作系统在将 FILETIME 转换为 SystemTime 时知道的所有闰秒。

由于自添加此功能以来没有发出闰秒，因此操作系统仍然不知道任何闰秒。但是，当下一个官方闰秒进入世界时，启用了此新功能的 Windows 计算机将对其进行跟踪，因此`FILETIME`值将被解释时计算机上的闰秒数所抵消.

博客文章继续描述：

> FILETIME 没有改变。它仍然表示自纪元开始以来的 100 ns 间隔数。改变的是该数字在转换为 SYSTEMTIME 并返回时的解释。以下是受影响的 API 列表：
> 
> *   获取系统时间
> *   获取本地时间
> *   文件时间到系统时间
> *   文件时间到本地时间
> *   系统时间到文件时间
> *   设置系统时间
> *   设置本地时间
> 
> 在此版本之前，SYSTEMTIME 的 wSecond 有效值介于 0 和 59 之间。SYSTEMTIME 现在已更新为允许值 60，前提是年、月和日表示闰秒有效的日期。
> 
> ...
> 
> 为了接收 SYSTEMTIME 结构中的 60 秒，进程必须明确选择加入。

请注意，选择加入适用于列出关于 a 如何`FILETIME`映射到 a的函数中的行为`SYSTEMTIME`。无论您是否选择加入，操作系统仍将`FILETIME`根据它所知道的闰秒偏移值。

关于兼容性，文章指出：

> 依赖 3rd 方框架的应用程序应确保其框架在 Windows 上的实现也调用正确的 API 以计算正确的时间，否则应用程序将报告错误的时间。

并且还提供了一个指向[较早帖子](https://blogs.technet.microsoft.com/networking/2018/10/17/leapseconds-for-the-itpro/)的链接，该帖子描述了如何禁用整个功能，如下所示：

> ...您可以通过添加以下注册表项恢复到以前的操作系统行为并全面禁用闰秒：
> 
> *   `HKLM:\SYSTEM\CurrentControlSet\Control\LeapSecondInformation`
> *   类型：“REG_DWORD”
> *   名称：启用
> *   值：`0`禁用系统范围的设置
> *   值：`1`启用系统范围的设置
> 
> 接下来，重新启动系统。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T13:25:34.087

IERS 不可预测地添加了闰秒。自 1972 年定义 UTC 和闰秒以来，增加了 23 秒。维基百科说“由于地球的自转速度从长远来看是不可预测的，因此无法提前六个月以上预测对它们的需求。”

由于您必须保留插入闰秒的历史记录，并不断更新操作系统以保留插入时间的参考，而且差异如此之小，因此不要期望通用操作系统能够补偿闰秒。

此外，与 UTC 相比，PC 中的简单电子时钟的常规时钟漂移远大于闰秒所需的补偿。如果您需要那种精度来补偿闰秒，您不应该使用高度不准确的 PC 时钟。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-27T05:01:08.140

根据此[评论](http://blogs.msdn.com/oldnewthing/archive/2004/02/26/80492.aspx#81867)，windows 完全不知道闰秒。如果将 24 * 60 * 60 秒添加到表示今天 1:39:45 的 FILETIME 中，无论如何都会得到表示明天 1:39:45 的 FILETIME。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-24T23:42:49.930

一个非常粗略的总结：

UTC =（原子时）+（闰秒）~~（平均太阳时）

MS 文档具体说是“UTC”，因此应该包括闰秒。与 MS 一样，您的里程可能会有所不同。

# algorithm - 从比特序列中解码字母（'a' .. 'z'）而不浪费

> ID：130574
> 
> 赞同：3
> 
> 时间：2008-09-24T23:24:46.293
> 
> 标签：algorithm, language-agnostic, math

我寻求一种算法，它可以让我将输入的位序列表示为字母（'a' .. 'z'），以最小的方式使位流可以从字母中重新生成，而无需保存整个序列在记忆中。

也就是说，给定一个外部位源（每次读取都返回一个几乎随机的位），并且用户输入了一些位，我想打印出可以代表这些位的最少字符数。

理想情况下，应该有一个参数化 - 在需要一些浪费之前有多少内存与最大位。

效率目标 - 与位的 base-26 表示相同的字符数。

非解决方案：

1.  如果存在足够的存储空间，则存储整个序列并使用大整数 MOD 26 运算。

2.  将每 9 位转换为 2 个字符 - 这似乎不是最理想的，浪费了字母输出的 25% 的信息容量。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-24T23:46:04.370

如果您为每个字母分配不同数量的位，您应该能够在允许的 26 个字母中精确编码位，而不会浪费任何位。（这很像霍夫曼代码，只是有一个预先构建的平衡树。）

要将位编码为字母： 累积位，直到您与查找表中的位代码完全匹配。输出那个字母，清除位缓冲区，然后继续。

将字母解码为位： 对于每个字母，输出表中的位序列。

在代码中实现留给读者作为练习。（或者对我来说，如果我以后觉得无聊的话。）

```
a 0000
b 0001
c 0010
d 0011
e 0100
f 0101
g 01100
h 01101
i 01110
j 01111
k 10000
l 10001
m 10010
n 10011
o 10100
p 10101
q 10110
r 10111
s 11000
t 11001
u 11010
v 11011
w 11100
x 11101
y 11110
z 11111 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-24T23:48:12.447

将每个 47 位块转换为 10 位的基数 26 数。这为您提供超过 99.99% 的效率。

这种方法，以及像 Huffman 这样的其他方法，需要一种填充机制来支持可变长度输入。这引入了一些低效率，这对于较长的输入来说不太重要。

在比特流的末尾，附加一个额外的`1`比特。在所有情况下都必须这样做，即使比特流的长度是 47 的倍数。在编码输出的最后一个块中可以跳过任何“零”值的高位字母。

解码字母时，可以用“零”字母填充截断的最终块并转换为 47 位 base 2 表示。最后`1`一位不是数据，而是标志着位流的结束。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T23:30:06.997

[霍夫曼编码](http://en.wikipedia.org/wiki/Huffman_coding)会是您正在寻找的吗？这是一种压缩算法，它几乎可以用最少的浪费位表示任何信息。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-25T05:49:53.310

零浪费是每个字母 log_2(26) 位。如前所述，您可以通过读取 47 位并将它们转换为 10 个字母来达到 4.7。但是，您可以通过将每 14 位转换为 3 个字符来达到 4.67。这具有适合整数的优点。如果您有存储空间并且运行时间很重要，您可以创建一个包含 17,576 个条目的查找表，将可能的 14 位映射为 3 个字母。否则，您可以执行 mod 和 div 操作来计算 3 个字母。

```
number of letters    number of bits    bits/letter
 1                    4                4
 2                    9                4.5
 3                   14                4.67
 4                   18                4.5
 5                   23                4.6
 6                   28                4.67
 7                   32                4.57
 8                   37                4.63
 9                   42                4.67
10                   47                4.7 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-24T23:31:30.253

您使用的任何解决方案都将是空间效率低下的，因为 26 不是 2 的幂。就算法而言，我宁愿使用查找表而不是对每个 9 位系列进行动态计算。您的查找表将包含 512 个条目。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T05:30:24.667

如果您希望每个字母的二进制足迹具有相同的大小，则最佳解决方案将由[Arithmetic Encoding](http://en.wikipedia.org/wiki/Arithmetic_encoding)给出。但是，它不会达到 4.5 位/字符的平均表示的目标。给定 26 个不同的字符（不包括空格等），如果不使用可变长度编码（例如 Huffman。请参阅 Jaegers 的答案）或其他压缩算法，4.7 将是最好的。

一个次优但更简单的解决方案可能是找到一个可行的字符数以适合一个大整数。例如，如果您从每 6 个字符块（可能为 26^6 < 2^32）中形成一个 32 位整数，则使用 5.33 位/字符。实际上，您甚至可以将 13 个字母放入 64 位整数（4.92 位/字符）中。这非常接近最佳解决方案，并且仍然很容易实现。由于缺少许多编程语言的本机支持，使用大于 64 位的整数可能会很棘手。

如果您想要更好的文本压缩率，您绝对还应该研究基于字典的压缩算法，例如 LZW 或 Deflate。

# delphi - 你觉得 D2009 中新的 Ribbon Controls 怎么样？

> ID：130576
> 
> 赞同：1
> 
> 时间：2008-09-24T23:25:12.827
> 
> 标签：delphi, ribbon

它们与 DevXpress 或原始 MSOffice 相比如何。
它们是否值得在它们上投入时间（现在用于实际使用，而不是我无论如何都会做的学术好奇心）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T12:05:56.557

根据我的经验，新的功能区控件实现了 Microsoft 制定的整个规范。我注意到的唯一问题是在调整表单大小时轻微闪烁，导致其中一个部分折叠或展开。

值得花时间去吗？当然，因为它们的重量更轻，而且有人摆脱闪烁只是时间问题（可能就像在源代码中插入 lockwindowupdate 一样简单？）。使用 Delphi 操作管理器并没有什么坏处，一切都基于它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T11:51:45.377

到目前为止，我能看到的唯一问题是 Windows Vista 上缺少 Glass Frame 实现（请参阅我的问题[here](https://stackoverflow.com/questions/170282/delphi-2009-ribbon-controls-glass-frame)），除非有人找到了实现该功能的方法。对您自己来说可能不是问题的唯一部分是似乎没有自定义主题的方法，我知道有些人希望在他们的应用程序中这样做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-21T15:35:05.810

IMO，DevExpress 功能区控件比它需要的复杂得多。我拥有 DevExpress 功能区控件，但转换为使用 delphi TRibbon。delphi TRibbon 也不完美，但我学会了避免这些问题。

# apache - 将静态文件上传到 Apache 服务器的首选协议？

> ID：130585
> 
> 赞同：1
> 
> 时间：2008-09-24T23:28:09.123
> 
> 标签：apache, security, administration, file-management

如果您是 Apache Web 服务器的管理员，您希望为 Web 开发人员上传静态文件 (html/gif/css/...) 提供什么协议，以实现最大的安全性？
如果您是 Web 开发人员/图形设计师，您希望在 Apache 服务器上使用哪些协议来上传静态文件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-24T23:29:54.050

SCP是我会去的。

您甚至可以使用 Filezilla 并假装它是不安全的 FTP： http: [//filezilla-project.org/](http://filezilla-project.org/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T23:31:06.387

SSH/SCP。它简单、快速、免费，并且可以随心所欲地安全。替代方案是 FTP（哈哈哈，是的）和通过 HTTPS 发布文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T23:36:26.950

我向 Web 开发人员提供有关使用 sftp/scp 客户端和使用[scponly](http://sublimation.org/scponly/wiki/index.php/Main_Page)的登录 shell 的说明。这样他们就可以访问上传文件，但我不太担心他们会对网络服务器做坏事。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T01:15:53.483

我使用 ssh 配置来限制用户在开发服务器上使用 sftp，然后使用版本控制来查看更改并使用 got format-patch 将它们移至生产环境

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T01:24:34.913

我们使用 Capistrano 进行部署，afaik 通过 git（通过 SSH）完成所有工作——至少在我们的部署脚本中是这样。

# python - 如何将所有 Visual Studio 2008“宏”传递给 Python 脚本？

> ID：130587
> 
> 赞同：2
> 
> 时间：2008-09-24T23:28:24.037
> 
> 标签：python, visual-studio, visual-studio-2008, visual-c++, visual-studio-2005

*[[注意：这个问题与这个](https://stackoverflow.com/questions/128634/how-to-use-system-environment-variables-in-vs-2008-post-build-events)问题相似但**不一样**。]*

Visual Studio 定义了几十个“宏”，它们是一种模拟环境变量（与 C++ 宏完全无关），其中包含有关正在进行的构建的信息。例子：

```
    配置名称发布
    目标路径 D:\work\foo\win\Release\foo.exe
    VCInstallDir C:\ProgramFiles\Microsoft Visual Studio 9.0\VC\

```

这是我看到的完整的 43 个内置宏集（您的宏可能会有所不同，具体取决于您使用的 VS 版本和启用的工具）：

```
    ConfigurationName IntDir RootNamespace TargetFileName
    DevEnvDir OutDir SafeInputName TargetFramework
    FrameworkDir ParentName SafeParentName TargetName
    FrameworkSDKDir PlatformName SafeRootNamespace TargetPath
    FrameworkVersion ProjectDir SolutionDir VCInstallDir
    FxCopDir ProjectExt SolutionExt VSInstallDir
    InputDir ProjectFileName SolutionFileName WebDeployPath
    InputExt ProjectName SolutionName WebDeployRoot
    InputFileName ProjectPath SolutionPath WindowsSdkDir
    InputName 引用 TargetDir WindowsSdkDirIA64
    InputPath RemoteMachine TargetExt             

```

其中，只有四个（、 和`FrameworkDir`）`FrameworkSDKDir`设置在用于构建事件的环境中。`VCInstallDir``VSInstallDir`

正如 Brian 所提到的，用户定义的宏可以定义为设置在构建任务执行的环境中。我的问题是内置宏。

作为构建过程的一部分，我使用 Visual Studio 构建后事件来运行 python 脚本。我想将整个宏集（内置和用户定义）传递给我在环境中的脚本，但我不知道如何。在我的脚本中，我可以访问常规环境变量（例如，Path、SystemRoot），但不能访问这些“宏”。我现在所能做的就是将它们作为命名选项逐个传递，然后在我的脚本中进行处理。例如，这是我的 Post-Build Event 命令行的样子：

```
    postbuild.py --t="$(TargetPath)" --c="$(ConfigurationName)"

```

除了让人头疼之外，Post-Build Event 命令行的大小也有限制，所以即使我想通过这种方法也无法传递几十个宏，因为命令行被截断了。

有谁知道是否有办法将整组宏名称和值传递给不需要切换到 MSBuild（我认为它不适用于本机 VC++）或其他类似 make 的构建工具的命令？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T18:29:30.580

您可能想查看 PropertySheets。这些是包含 Visual C++ 设置的文件，包括用户宏。图纸可以从其他图纸继承，并使用 Visual Studio 中的 PropertyManager 视图附加到 VC++ 项目。当您创建其中一张表时，会有一个用于创建用户宏的界面。当您使用此机制添加宏时，有一个用于将用户宏设置为环境变量的复选框。我们在构建系统中使用这种类型的机制来快速设置项目以执行异地构建。我们的各种构建目录都定义为用户宏。我实际上并没有验证环境变量是在从构建后调用的外部脚本中设置的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T00:24:23.467

这有点hacky，但它可以工作。

为什么不连续调用多个 .py 脚本？

每个脚本都可以将一小部分参数和值传递给临时文本文件。最终脚本将读取并处理临时文本文件。

我同意这种方法充满了危险和WTF，但有时你必须把东西拼凑在一起。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-14T20:28:15.937

据我所知，问题中描述的方法是将构建变量传递给 Python 脚本的唯一方法。

也许 Visual Studio 2010 有更好的东西？

# database - 如何实现公司内部的图标库

> ID：130589
> 
> 赞同：1
> 
> 时间：2008-09-24T23:28:45.377
> 
> 标签：database, web-applications, icons, gallery

我喜欢编写自己的基于 Web 的应用程序，但不想屈服于*此处未发明的综合症。* 因此，在我自己写这篇文章之前，我正在寻找可以做到这一点的解决方案，或者可能是框架（如 Django 或 Joomla 等），这些框架（如 Django 或 Joomla 等）给我一个非常接近我需要的起点。

我的公司生产具有多种用户界面的软件。我们决定保留一个**图标数据库**，人们可以在其中按大小、关键字等搜索图标，跟踪它们迄今为止的使用情况，上传它们，浏览它们等。

我已经考虑过从“图片库”（Gallery、Coppermine、4homepages 等）开始的想法，但我希望有一些东西可以让我们跟踪图标的**版本**，就像我们对所有其他源文件所做的那样，我确信我们在每个图标旁边跟踪的属性会随着时间的推移而扩展，因此它需要易于扩展。

那么人们建议我使用什么作为解决方案或解决方案的起点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-24T23:36:38.667

听起来你需要一个[DAM](http://en.wikipedia.org/wiki/Digital_asset_management)系统

# continuous-integration - 持续集成对于独立开发者来说重要吗？

> ID：130592
> 
> 赞同：69
> 
> 时间：2008-09-24T23:29:15.157
> 
> 标签：continuous-integration

我以前从未使用过 CI 工具，但从我所读到的内容来看，我不确定它是否会给不每天编写代码的独立开发人员带来任何好处。

首先 - CI 对任何项目都有什么好处？

第二 - 谁应该使用 CI？它是否使所有开发人员受益？

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2008-09-24T23:35:17.610

CI 的基本概念是，您拥有一个系统，该系统可以在每次有人提交版本控制系统时构建代码并运行自动化测试。这些测试将包括单元和功能测试，甚至是行为驱动测试。

好处是您可以立即知道有人破坏了构建。
这意味着：

**一个**。他们提交了阻止编译的代码，这会搞砸任何人

**乙**。他们提交的代码破坏了一些测试，这意味着他们引入了需要修复的错误，或者需要更新测试以反映代码中的更改。

如果你是一个单独的开发者，如果你有在提交之前运行测试的好习惯，那么 CI 就没有*那么*有用了，这是你*应该*做的。话虽如此，您可能会养成让 CI 为您进行测试的坏习惯。

作为一个单独的程序员，它主要归结为纪律。使用 CI 是一项有用的技能，但您要避免养成任何不会转化为团队环境的坏习惯。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-07-17T13:37:59.890

正如其他人所指出的，CI*确实*对独立开发人员具有优势。但是你必须问自己的问题是；是否值得开销？如果你和我一样，为一个项目设置一个 CI 系统可能需要一两个小时，因为我必须分配一台服务器，设置所有网络，并安装软件。请记住，CI 系统一次只会为您节省几秒钟的时间。对于独立开发人员来说，这些时间加起来可能不会超过进行 CI 设置所花费的时间。

但是，如果您以前从未设置过 CI 系统，我建议您这样做只是为了学习如何操作。它不会花这么长时间，它不值得学习经验。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-24T23:33:28.783

CI 的好处在于能够及早发现签入破坏构建的时间。您还可以针对构建运行您的自动化测试套件，以及运行任何类型的工具来为您提供指标等。

显然，当您拥有一个提交者团队时，这是非常有价值的，并非所有人都努力检查重大更改。作为一个单独的开发者，它并不那么有价值。大概，你运行​​你的单元测试，甚至可能是集成测试。但是，我见过很多情况下开发人员忘记从集合中签入文件。

CI 构建也可以被认为是您的“发布”构建。环境应该是稳定的，并且不受您刚刚添加到机器中的任何开发小工具的影响。它应该允许您始终重现构建。如果您向项目添加新的依赖项，并且忘记设置发布构建环境以将其考虑在内，这可能会很有价值。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-21T14:46:24.460

事实是，持续集成在团队中最有意义。单个开发人员也可以获得一些优势，你必须自己决定他们是否足以抵消你在设置 CI 系统上投入的时间。

*   如果您忘记签入某些需要的文件，则存储库包含损坏的版本，即使它在您的计算机上运行也是如此。CI 会检测到这种情况。
*   如果您的 CI 服务器在不同的机器上运行，它可以指示对您的构建环境的依赖关系。意思是，构建和所有测试都可以在您的开发盒上运行，但在另一台机器上，一些依赖关系没有实现并且构建中断。
*   每日构建可以表明，您的旧软件不适用于操作系统/编译器/库的最新升级......
*   如果您的 CI 系统有构建工件的存档，您可以轻松获得旧版本软件的分发。
*   一些 CI 有一个很好的界面来向您显示有关您的构建的指标，具有指向自动生成的文档和类似内容的链接。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-23T19:50:50.867

如果您需要支持多个编译器，那么在您只在一个 IDE 中进行开发的同时，拥有一个 CI 构建系统来完成所有这些工作会很方便。我的代码在 x86 中通过 VS2008 使用 Vc6 构建，而 x64 在 VS2005 和 8 上构建，因此每个项目配置每个项目 7 次构建...拥有 CI 系统意味着我可以在一个 IDE 中开发并让 CI 系统证明所有我支持的编译器仍在构建。

同样，如果您正在构建由多个项目使用的库，那么 CI 将确保它们适用于所有项目，而不仅仅是您现在正在使用的项目......

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-23T20:06:40.523

我们使用 CI 系统进行发布构建（以及通常的自动“提交时”构建）。

能够单击一个按钮启动发布版本，该版本逐步完成所有流程以发布设置：

*   快（我可以直接做其他事情，它在单独的机器上运行，所以它不会减慢我的速度）；
*   重复（它不会忘记任何事情，包括将设置复制到发布文件夹并通知所有需要知道的人）
*   可靠（没有错误，不像人类！）。

在敏捷环境中，您希望每 2-4 周交付一次工作软件，这绝对值得拥有，即使是在 1 人的团队中。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-24T23:34:01.027

从某种意义上说，如果您忘记签入某些内容（因为构建将被破坏），CI 会使独立开发人员受益。但是，当没有其他开发人员时，它的集成价值会降低。

# c# - 寻找一个总结数字而不是溢出的 .NET 函数，它只返回 int.MaxValue

> ID：130604
> 
> 赞同：1
> 
> 时间：2008-09-24T23:32:21.330
> 
> 标签：c#, .net, math

我使用 int.MaxValue 作为惩罚，有时我会一起计算惩罚。是否有一种功能，或者您将如何以最优雅和最高效的方式创建一个功能。

IE。

50 + 100 = 150

int.Max + 50 = int.Max 而不是 int.Min + 50

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-25T00:47:57.217

这个答案...

```
int penaltySum(int a, int b)
{
    return (int.MaxValue - a < b) ? int.MaxValue : a + b;
} 
```

未通过以下测试：

```
[TestMethod]
public void PenaltySumTest()
{
    int x = -200000; 
    int y = 200000; 
    int z = 0;

    Assert.AreEqual(z, penaltySum(x, y));
} 
```

我建议按如下方式实施penaltySum()：

```
private int penaltySum(int x, int y, int max)
{
    long result = (long) x + y;
    return result > max ? max : (int) result;
} 
```

请注意，我正在传递最大值，但如果您愿意，您可以在 int.MaxValue 中进行硬编码。

或者，您可以强制算术运算溢出检查并执行以下操作：

```
private int penaltySum(int x, int y, int max)
{
   int result = int.MaxValue;

   checked
   {
       try
       {
           result = x + y;
       }
       catch
       {
           // Arithmetic operation resulted in an overflow.
       }
   }

   return result; 
```

}

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-24T23:43:07.607

```
int penaltySum(int a, int b)
{
    return (int.MaxValue - a < b) ? int.MaxValue : a + b;
} 
```

更新：如果您的处罚可能是负面的，这将更合适：

```
int penaltySum(int a, int b)
{
    if (a > 0 && b > 0)
    {
        return (int.MaxValue - a < b) ? int.MaxValue : a + b;
    }

    if (a < 0 && b < 0)
    {
        return (int.MinValue - a > b) ? int.MinValue : a + b;
    }

    return a + b;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-18T03:51:58.213

它是否溢出很多，或者这是一个错误情况？使用 try/catch（溢出异常）怎么样？

# c# - LINQ（to SQL）可以按位查询吗？

> ID：130605
> 
> 赞同：5
> 
> 时间：2008-09-24T23:32:44.323
> 
> 标签：c#, linq-to-sql, bitmask

我有一个用户表，其中包含用户所属角色的位掩码。我想在位掩码值中选择属于一个或多个角色的用户。例如：

```
选择 *
来自 [用户]
其中 UserRolesBitmask | 22 = 22
```

这将选择在其位掩码中具有角色“2”、“4”或“16”的所有用户。这可以在 LINQ 查询中表达吗？谢谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-08-23T12:08:09.230

作为对我的谷歌同事的附注： `UserRolesBitmask | 22 == 22`选择没有任何其他标志的所有用户（它不是过滤器，就像说`1==1`）。

你想要的是：

*   `UserRolesBitmask & 22 == 22`它选择在其位掩码中具有所有角色的用户，或者：
*   `UserRolesBitmask & 22 != 0`它选择在其位掩码中至少具有一个角色的用户

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-24T23:52:21.217

我认为这会起作用，但我还没有测试过。替换您的 DataContext 对象的名称。YMMV。

```
from u in DataContext.Users
where UserRolesBitmask | 22 == 22
select u 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T00:03:43.767

如果这不起作用，您可以随时使用`ExecuteCommand`：

```
DataContext.ExecuteCommand("select * from [User] where UserRolesBitmask | {0} = {0}", 22); 
```

# c# - 更改 C# 字典中项目的基数

> ID：130614
> 
> 赞同：4
> 
> 时间：2008-09-24T23:33:56.537
> 
> 标签：c#, dictionary, cardinality

我有一本字典，比如

```
Dictionary<Foo,String> fooDict 
```

我逐步浏览字典中的所有内容，例如

```
foreach (Foo foo in fooDict.Keys)
    MessageBox.show(fooDict[foo]); 
```

它按照将 foo 添加到字典中的顺序执行此操作，因此添加的第一个项目是返回的第一个 foo。

如何更改基数，例如，添加的第三个 foo 将是返回的第二个 foo？换句话说，我想改变它的“索引”。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-24T23:45:24.697

如果您阅读 MSDN 上的文档，您会看到：

“退货的顺序未定义。”

您无法保证订单，因为 Dictionary 不是列表或数组。它旨在通过键查找值，任何迭代值的能力都只是一种方便，但顺序不是您应该依赖的行为。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-25T01:08:08.103

您可能对命名空间中的[`OrderedDicationary`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.specialized.ordereddictionary)类感兴趣[`System.Collections.Specialized`](https://docs.microsoft.com/en-us/dotnet/api/system.collections.specialized)。

如果您查看最底部的评论，则来自 MSFT 的某人发布了此有趣的注释：

> 这种类型实际上是错误命名的；它不是一个“有序”字典，而是一个“索引”字典。虽然，今天没有这种类型的等效通用版本，但如果我们将来添加一个，我们很可能会命名为“IndexedDictionary”类型。

我认为从此类派生并制作 OrderedDictionary 的通用版本将是微不足道的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T23:42:06.017

我*在该领域没有受过充分的教育*来正确回答这个问题，但我**感觉**字典会根据键对值进行排序，以便执行快速键搜索。这表明字典是根据键比较按键值排序的。但是，在查看**对象**方法时，我假设它们使用哈希码来比较不同的对象，因为对用于键的类型没有要求。这只是一个猜测。更有知识的人应该填写更多细节。

当字典的目的是使用任意类型进行索引时，您为什么对操作字典的“索引”感兴趣？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T00:34:34.753

我不知道是否有人会发现这很有用，但这是我最终弄清楚的。它似乎有效（我的意思是它不会抛出任何异常），但我仍然无法测试它是否像我希望的那样有效。不过，我以前也做过类似的事情。

```
 public void sortSections()
    {
        //OMG THIS IS UGLY!!!
        KeyValuePair<ListViewItem, TextSection>[] sortable = textSecs.ToArray();
        IOrderedEnumerable<KeyValuePair<ListViewItem, TextSection>> sorted = sortable.OrderBy(kvp => kvp.Value.cardinality);

        foreach (KeyValuePair<ListViewItem, TextSection> kvp in sorted)
        {
            TextSection sec = kvp.Value;
            ListViewItem key = kvp.Key;

            textSecs.Remove(key);
            textSecs.Add(key, sec);
        }
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T00:40:34.143

简短的回答是，自从字典“表示键和值的集合”以来，不应该有办法。这并不意味着任何排序。您可能发现的任何 hack 都超出了该类的定义，并且可能会更改。

您可能应该首先问自己在这种情况下是否真的需要字典，或者您是否可以使用 KeyValuePairs 列表。

否则，这样的事情可能会有用：

```
public class IndexableDictionary<T1, T2> : Dictionary<T1, T2>
{
    private SortedDictionary<int, T1> _sortedKeys;

    public IndexableDictionary()
    {
        _sortedKeys = new SortedDictionary<int, T1>();
    }
    public new void Add(T1 key, T2 value)
    {
        _sortedKeys.Add(_sortedKeys.Count + 1, key);
        base.Add(key, value);
    }

    private IEnumerable<KeyValuePair<T1, T2>> Enumerable()
    {
        foreach (T1 key in _sortedKeys.Values)
        {
            yield return new KeyValuePair<T1, T2>(key, this[key]);
        }
    }

    public new IEnumerator<KeyValuePair<T1, T2>> GetEnumerator()
    {
        return Enumerable().GetEnumerator();
    }

    public KeyValuePair<T1, T2> this[int index]
    {
        get
        {
            return new KeyValuePair<T1, T2> (_sortedKeys[index], base[_sortedKeys[index]]);
        }
        set
        {
            _sortedKeys[index] = value.Key;
            base[value.Key] = value.Value;
        }

    }

} 
```

客户端代码看起来像这样：

```
 static void Main(string[] args)
    {
        IndexableDictionary<string, string> fooDict = new IndexableDictionary<string, string>();

        fooDict.Add("One", "One");
        fooDict.Add("Two", "Two");
        fooDict.Add("Three", "Three");

        // Print One, Two, Three
        foreach (KeyValuePair<string, string> kvp in fooDict)
            Console.WriteLine(kvp.Value);

        KeyValuePair<string, string> temp = fooDict[1];
        fooDict[1] = fooDict[2];
        fooDict[2] = temp;

        // Print Two, One, Three
        foreach (KeyValuePair<string, string> kvp in fooDict)
            Console.WriteLine(kvp.Value);

        Console.ReadLine();
    } 
```

**更新：**出于某种原因，它不会让我评论我自己的答案。

无论如何，IndexableDictionary 与 OrderedDictionary 的不同之处在于

1.  “OrderedDictionary 的元素不以任何方式排序。” 所以foreach不会关注数字索引
2.  它是强类型的，所以你不必乱用 DictionaryEntry 结构中的东西

# winapi - 以无密码用户身份启动服务

> ID：130616
> 
> 赞同：2
> 
> 时间：2008-09-24T23:34:03.727
> 
> 标签：winapi, mfc, windows-services, service

我正在尝试以用户身份启动服务并且一切正常，直到我尝试使用没有密码的用户。然后，它无法启动（由于登录错误）。

我做错了什么还是这是“设计使然”？

注册此服务的代码：

```
 SC_HANDLE schService = CreateService( 
        schSCManager,           
        strNameNoSpaces,      
        strServiceName,           
        SERVICE_ALL_ACCESS,       
        SERVICE_WIN32_OWN_PROCESS, 
        SERVICE_AUTO_START,    
        SERVICE_ERROR_NORMAL,      
        szPath,                  
        NULL,                     
        NULL,                  
        NULL,                    
        strUser,
        (strPassword.IsEmpty())?NULL:strPassword); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T00:43:42.513

这可能是由于操作系统安全要求或安全策略。检查安全策略以查看那里是否有任何相关内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T01:12:34.457

是的，确实和安全策略有关。详细说明：

[http://technet.microsoft.com/en-us/library/bb457114.aspx](http://technet.microsoft.com/en-us/library/bb457114.aspx)

“如果您想禁用无密码登录网络的限制，您可以通过本地安全策略执行此操作。控制空白密码限制的策略设置可以使用本地安全策略或组策略 MMC 管理单元进行修改。您可以使用任一工具在**Security Settings\Local Policies\Security Options**中找到此策略选项。策略的名称是 Accounts: **Limit local account use of blank passwords to console login only**。默认情况下启用。"

禁用后，一切正常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T23:42:47.293

您需要指定一个空字符串，如果没有密码，则不是 NULL。NULL 不是有效的空字符串，"" 是。可能您应该只传递`strPassword`最后一个参数。

```
SC_HANDLE schService = CreateService( 
            schSCManager,           
            strNameNoSpaces,      
            strServiceName,           
            SERVICE_ALL_ACCESS,       
            SERVICE_WIN32_OWN_PROCESS, 
            SERVICE_AUTO_START,    
            SERVICE_ERROR_NORMAL,      
            szPath,                  
            NULL,                     
            NULL,                  
            NULL,                    
            strUser,

// change this line to:
            strPassword.IsEmpty() ? L"" : strPassword);
// or maybe
            strPassword); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-24T23:53:31.340

谢谢-实际上我已经尝试过，但无济于事。

如果我启动 services.msc，手动进入服务属性并清除 2 个密码字段，然后按“应用”并尝试启动它，它也失败了。

# c# - 如何检查写入目录或文件的权限？

> ID：130617
> 
> 赞同：61
> 
> 时间：2008-09-24T23:34:03.773
> 
> 标签：c#, .net

我有一个程序，它使用如下方法将一些数据写入文件。

```
 public void ExportToFile(string filename)
{
     using(FileStream fstream = new FileStream(filename,FileMode.Create))
     using (TextWriter writer = new StreamWriter(fstream))
     {
         // try catch block for write permissions 
         writer.WriteLine(text);

     }
} 
```

运行程序时出现错误：

> 未处理的异常：System.UnauthorizedAccessException：对路径“mypath”的访问被拒绝。在 System.IO.__Error.WinIOError(Int32 errorCode, String maybeFullPath) 在 System.IO.FileStream.Init(String path, FileMode mode, FileAccess access, nt32 rights, Boolean useRights, FileShare share, Int32 bufferSize, FileOptions ptions, SECURITY_ATTRIBUTES secAttrs , String msgPath, Boolean bFromProxy) at System.IO.FileStream..ctor(String path, FileMode mode, FileAccess access FileShare share, Int32 bufferSize, FileOptions options, String msgPath, Boolea bFromProxy)

问题：我需要什么代码来捕捉它以及如何授予访问权限？

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-09-24T23:39:38.427

**更新：**

根据[此答案](https://stackoverflow.com/a/4397002/11702)修改代码以摆脱过时的方法。

您可以使用 Security 命名空间来检查：

```
public void ExportToFile(string filename)
{
    var permissionSet = new PermissionSet(PermissionState.None);    
    var writePermission = new FileIOPermission(FileIOPermissionAccess.Write, filename);
    permissionSet.AddPermission(writePermission);

    if (permissionSet.IsSubsetOf(AppDomain.CurrentDomain.PermissionSet))
    {
        using (FileStream fstream = new FileStream(filename, FileMode.Create))
        using (TextWriter writer = new StreamWriter(fstream))
        {
            // try catch block for write permissions 
            writer.WriteLine("sometext");

        }
    }
    else
    {
        //perform some recovery action here
    }

} 
```

就获得这些许可而言，您将不得不要求用户以某种方式为您执行此操作。如果您可以以编程方式执行此操作，那么我们都会遇到麻烦；）

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-01-20T17:48:24.533

当您的代码执行以下操作时：

1.  检查当前用户是否有权做某事。
2.  执行需要在 1 中签入的权利的操作。

您冒着权限在*1*和*2*之间变化的风险，因为您无法预测运行时系统上还会发生什么。因此，即使您之前检查过权限，您的代码也应该处理引发*UnauthorisedAccessException的情况。*

请注意，*SecurityManager*类用于检查 CAS 权限，实际上并不与操作系统检查当前用户是否具有对指定位置的写入权限（通过 ACL 和 ACE）。因此，对于本地运行的应用程序，*IsGranted*将始终返回 true。

**示例**（源自[Josh 的示例](https://stackoverflow.com/questions/130617/how-do-you-check-for-permissions-to-write-to-a-directory-or-file#130641)）：

```
//1\. Provide early notification that the user does not have permission to write.
FileIOPermission writePermission = new FileIOPermission(FileIOPermissionAccess.Write, filename);
if(!SecurityManager.IsGranted(writePermission))
{
    //No permission. 
    //Either throw an exception so this can be handled by a calling function
    //or inform the user that they do not have permission to write to the folder and return.
}

//2\. Attempt the action but handle permission changes.
try
{
    using (FileStream fstream = new FileStream(filename, FileMode.Create))
    using (TextWriter writer = new StreamWriter(fstream))
    {
        writer.WriteLine("sometext");
    }
}
catch (UnauthorizedAccessException ex)
{
    //No permission. 
    //Either throw an exception so this can be handled by a calling function
    //or inform the user that they do not have permission to write to the folder and return.
} 
```

尝试根据原始 ACL（这些都可以通过*System.Security.AccessControl*类获得）以编程方式计算文件夹的有效权限很棘手，**因此不建议这样做。**Stack Overflow 和更广泛的网络上的其他答案建议尝试执行该操作以了解是否允许权限。[这篇](http://groups.google.co.uk/group/microsoft.public.dotnet.languages.csharp/msg/208347aa99a2de3b)文章总结了实现权限计算所需的内容，应该足以让你放弃这样做。

 ** * *

## 回答 #3

> 赞同：12
> 
> 时间：2015-06-25T03:24:38.430

它是 MaxOvrdrv[代码](https://stackoverflow.com/a/25333202/836308)的固定版本。

```
public static bool IsReadable(this DirectoryInfo di)
{
    AuthorizationRuleCollection rules;
    WindowsIdentity identity;
    try
    {
        rules = di.GetAccessControl().GetAccessRules(true, true, typeof(SecurityIdentifier));
        identity = WindowsIdentity.GetCurrent();
    }
    catch (UnauthorizedAccessException uae)
    {
        Debug.WriteLine(uae.ToString());
        return false;
    }

    bool isAllow = false;
    string userSID = identity.User.Value;

    foreach (FileSystemAccessRule rule in rules)
    {
        if (rule.IdentityReference.ToString() == userSID || identity.Groups.Contains(rule.IdentityReference))
        {
            if ((rule.FileSystemRights.HasFlag(FileSystemRights.Read) ||
                rule.FileSystemRights.HasFlag(FileSystemRights.ReadAttributes) ||
                rule.FileSystemRights.HasFlag(FileSystemRights.ReadData)) && rule.AccessControlType == AccessControlType.Deny)
                return false;
            else if ((rule.FileSystemRights.HasFlag(FileSystemRights.Read) &&
                rule.FileSystemRights.HasFlag(FileSystemRights.ReadAttributes) &&
                rule.FileSystemRights.HasFlag(FileSystemRights.ReadData)) && rule.AccessControlType == AccessControlType.Allow)
                isAllow = true;

        }
    }
    return isAllow;
}

public static bool IsWriteable(this DirectoryInfo me)
{
    AuthorizationRuleCollection rules;
    WindowsIdentity identity;
    try
    {
        rules = me.GetAccessControl().GetAccessRules(true, true, typeof(System.Security.Principal.SecurityIdentifier));
        identity = WindowsIdentity.GetCurrent();
    }
    catch (UnauthorizedAccessException uae)
    {
        Debug.WriteLine(uae.ToString());
        return false;
    }

    bool isAllow = false;
    string userSID = identity.User.Value;

    foreach (FileSystemAccessRule rule in rules)
    {
        if (rule.IdentityReference.ToString() == userSID || identity.Groups.Contains(rule.IdentityReference))
        {
            if ((rule.FileSystemRights.HasFlag(FileSystemRights.Write) ||
                rule.FileSystemRights.HasFlag(FileSystemRights.WriteAttributes) ||
                rule.FileSystemRights.HasFlag(FileSystemRights.WriteData) ||
                rule.FileSystemRights.HasFlag(FileSystemRights.CreateDirectories) ||
                rule.FileSystemRights.HasFlag(FileSystemRights.CreateFiles)) && rule.AccessControlType == AccessControlType.Deny)
                return false;
            else if ((rule.FileSystemRights.HasFlag(FileSystemRights.Write) &&
                rule.FileSystemRights.HasFlag(FileSystemRights.WriteAttributes) &&
                rule.FileSystemRights.HasFlag(FileSystemRights.WriteData) &&
                rule.FileSystemRights.HasFlag(FileSystemRights.CreateDirectories) &&
                rule.FileSystemRights.HasFlag(FileSystemRights.CreateFiles)) && rule.AccessControlType == AccessControlType.Allow)
                isAllow = true;

        }
    }
    return isAllow;
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-08-06T09:10:55.317

对不起，但以前的解决方案都没有帮助我。我需要检查双方：SecurityManager 和 SO 权限。我从 Josh 代码和 iain 答案中学到了很多东西，但恐怕我需要使用 Rakesh 代码（也感谢他）。只有一个错误：我发现他只检查 Allow 而不是 Deny 权限。所以我的建议是：

```
 string folder;
        AuthorizationRuleCollection rules;
        try {
            rules = Directory.GetAccessControl(folder)
                .GetAccessRules(true, true, typeof(System.Security.Principal.NTAccount));
        } catch(Exception ex) { //Posible UnauthorizedAccessException
            throw new Exception("No permission", ex);
        }

        var rulesCast = rules.Cast<FileSystemAccessRule>();
        if(rulesCast.Any(rule => rule.AccessControlType == AccessControlType.Deny)
            || !rulesCast.Any(rule => rule.AccessControlType == AccessControlType.Allow))
            throw new Exception("No permission");

        //Here I have permission, ole! 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-08-15T19:49:47.840

由于这没有关闭，我想为任何希望为他们正常工作的人提交一个新条目......使用我在此处找到的内容的合并，以及使用 DirectoryServices 来调试代码本身并找到使用正确的代码，这是我发现在每种情况下都适用于我的代码...请注意，我的解决方案扩展了 DirectoryInfo 对象...：

```
 public static bool IsReadable(this DirectoryInfo me)
    {

        AuthorizationRuleCollection rules;
        WindowsIdentity identity;
        try
        {
            rules = me.GetAccessControl().GetAccessRules(true, true, typeof(System.Security.Principal.SecurityIdentifier));
            identity = WindowsIdentity.GetCurrent();
        }
        catch (Exception ex)
        { //Posible UnauthorizedAccessException
            return false;
        }

        bool isAllow=false;
        string userSID = identity.User.Value;

        foreach (FileSystemAccessRule rule in rules)
        {
            if (rule.IdentityReference.ToString() == userSID || identity.Groups.Contains(rule.IdentityReference))
            {
                if ((rule.FileSystemRights.HasFlag(FileSystemRights.Read) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.ReadAndExecute) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.ReadAttributes) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.ReadData) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.ReadExtendedAttributes) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.ReadPermissions)) && rule.AccessControlType == AccessControlType.Deny)
                    return false;
                else if ((rule.FileSystemRights.HasFlag(FileSystemRights.Read) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.ReadAndExecute) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.ReadAttributes) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.ReadData) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.ReadExtendedAttributes) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.ReadPermissions)) && rule.AccessControlType == AccessControlType.Allow)
                    isAllow = true;
            }
        }

        return isAllow;
    }

    public static bool IsWriteable(this DirectoryInfo me)
    {
        AuthorizationRuleCollection rules;
        WindowsIdentity identity;
        try
        {
            rules = me.GetAccessControl().GetAccessRules(true, true, typeof(System.Security.Principal.SecurityIdentifier));
            identity = WindowsIdentity.GetCurrent();
        }
        catch (Exception ex)
        { //Posible UnauthorizedAccessException
            return false;
        }

        bool isAllow = false;
        string userSID = identity.User.Value;

        foreach (FileSystemAccessRule rule in rules)
        {
            if (rule.IdentityReference.ToString() == userSID || identity.Groups.Contains(rule.IdentityReference))
            {
                if ((rule.FileSystemRights.HasFlag(FileSystemRights.Write) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.WriteAttributes) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.WriteData) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.WriteExtendedAttributes) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.CreateDirectories) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.CreateFiles)) && rule.AccessControlType == AccessControlType.Deny)
                    return false;
                else if ((rule.FileSystemRights.HasFlag(FileSystemRights.Write) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.WriteAttributes) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.WriteData) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.WriteExtendedAttributes) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.CreateDirectories) ||
                    rule.FileSystemRights.HasFlag(FileSystemRights.CreateFiles)) && rule.AccessControlType == AccessControlType.Allow)
                    isAllow = true;
            }
        }

        return me.IsReadable() && isAllow;
    } 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-02-23T18:31:28.700

这些都不适合我..即使不是这样，它们也会返回真实。问题是，您必须针对当前进程用户权限测试可用权限，这将测试文件创建权限，只需将 FileSystemRights 子句更改为“Write”以测试写入权限。

```
/// <summary>
/// Test a directory for create file access permissions
/// </summary>
/// <param name="DirectoryPath">Full directory path</param>
/// <returns>State [bool]</returns>
public static bool DirectoryCanCreate(string DirectoryPath)
{
    if (string.IsNullOrEmpty(DirectoryPath)) return false;

    try
    {
        AuthorizationRuleCollection rules = Directory.GetAccessControl(DirectoryPath).GetAccessRules(true, true, typeof(System.Security.Principal.SecurityIdentifier));
        WindowsIdentity identity = WindowsIdentity.GetCurrent();

        foreach (FileSystemAccessRule rule in rules)
        {
            if (identity.Groups.Contains(rule.IdentityReference))
            {
                if ((FileSystemRights.CreateFiles & rule.FileSystemRights) == FileSystemRights.CreateFiles)
                {
                    if (rule.AccessControlType == AccessControlType.Allow)
                        return true;
                }
            }
        }
    }
    catch {}
    return false;
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-11-26T06:19:11.697

您可以尝试以下代码块来检查目录是否具有写入权限。

它检查 FileSystemAccessRule。

```
 string directoryPath = "C:\\XYZ"; //folderBrowserDialog.SelectedPath;
           bool isWriteAccess = false;
           try
           {
              AuthorizationRuleCollection collection = Directory.GetAccessControl(directoryPath).GetAccessRules(true, true, typeof(System.Security.Principal.NTAccount));
              foreach (FileSystemAccessRule rule in collection)
              {
                 if (rule.AccessControlType == AccessControlType.Allow)
                 {
                    isWriteAccess = true;
                    break;
                 }
              }
           }
           catch (UnauthorizedAccessException ex)
           {
              isWriteAccess = false;
           }
           catch (Exception ex)
           {
              isWriteAccess = false;
           }
           if (!isWriteAccess)
           {
             //handle notifications                 
           } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-09-27T15:58:43.297

哇……这个线程中有很多低级安全代码——其中大部分对我也不起作用——尽管我在这个过程中学到了很多东西。我了解到的一件事是，大部分代码并不适合寻求每个用户访问权限的应用程序——它适用于希望以编程方式更改权限的管理员，正如已经指出的那样——这*不是*一件好事。作为一名开发人员，我不能使用“简单的方法”——以管理员身份运行——这——我不是运行代码的机器上的人，我的用户也不是——所以，就像这些解决方案一样聪明- 它们不适合我的情况，也可能不适合大多数普通开发人员。

像大多数这类问题的海报一样——我最初也觉得它是“hackey”——我已经决定尝试它并让可能的异常告诉你用户的权利是什么——因为我得到的信息并没有告诉我这些权利到底是什么。下面的代码——做了。

```
 Private Function CheckUserAccessLevel(folder As String) As Boolean
Try
  Dim newDir As String = String.Format("{0}{1}{2}",
                                       folder,
                                       If(folder.EndsWith("\"),
                                          "",
                                          "\"),
                                       "LookWhatICanDo")
  Dim lookWhatICanDo = Directory.CreateDirectory(newDir)

  Directory.Delete(newDir)
  Return True

Catch ex As Exception
  Return False
End Try 
```

结束功能

# python - Python 日期比较

> ID：130618
> 
> 赞同：63
> 
> 时间：2008-09-24T23:34:31.447
> 
> 标签：python, datetime

我想知道一个特定的 python 日期时间对象是否早于 X 小时或分钟。我正在尝试做类似的事情：

```
if (datetime.now() - self.timestamp) > 100
# Where 100 is either seconds or minutes 
```

这会产生类型错误。

在 python 中进行日期时间比较的正确方法是什么？我已经看过[WorkingWithTime](http://wiki.python.org/moin/WorkingWithTime)，它很接近但不完全是我想要的。我假设我只想以秒为单位表示 datetime 对象，以便可以进行正常的 int 比较。

请发布日期时间最佳实践列表。

* * *

## 回答 #1

> 赞同：110
> 
> 时间：2008-09-24T23:44:27.837

使用`datetime.timedelta`类：

```
>>> from datetime import datetime, timedelta
>>> then = datetime.now() - timedelta(hours = 2)
>>> now = datetime.now()
>>> (now - then) > timedelta(days = 1)
False
>>> (now - then) > timedelta(hours = 1)
True 
```

你的例子可以写成：

```
if (datetime.now() - self.timestamp) > timedelta(seconds = 100) 
```

或者

```
if (datetime.now() - self.timestamp) > timedelta(minutes = 100) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T23:42:01.757

将差异与您创建的 timedelta 进行比较：

```
if datetime.datetime.now() - timestamp > datetime.timedelta(seconds = 5):
    print 'older' 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-05-11T06:14:38.880

选择：

```
if (datetime.now() - self.timestamp).total_seconds() > 100: 
```

假设 self.timestamp 是一个日期时间实例

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T23:40:43.400

您可以使用返回对象的 'days' 和 'seconds' 属性的组合来找出答案，如下所示：

```
def seconds_difference(stamp1, stamp2):
    delta = stamp1 - stamp2
    return 24*60*60*delta.days + delta.seconds + delta.microseconds/1000000. 
```

如果您总是想要一个正数的秒数，请在答案中使用 abs()。

要了解时间戳过去多少秒，您可以像这样使用它：

```
if seconds_difference(datetime.datetime.now(), timestamp) < 100:
     pass 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-24T23:35:26.547

您可以减去两个[日期](http://docs.python.org/lib/module-datetime.html)时间对象以找出它们之间的差异。
您可以使用它`datetime.fromtimestamp`来解析 POSIX 时间戳。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T23:45:28.240

像这样：

```
# self.timestamp should be a datetime object
if (datetime.now() - self.timestamp).seconds > 100:
    print "object is over 100 seconds old" 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-05-27T17:30:49.353

将您的时间增量转换为秒，然后使用转换回经过的小时数和剩余分钟数。

```
start_time=datetime(
   year=2021,
   month=5,
   day=27,
   hour=10,
   minute=24,
   microsecond=0)

 end_time=datetime.now()
 delta=(end_time-start_time)

 seconds_in_day = 24 * 60 * 60
 seconds_in_hour= 1 * 60 * 60

 elapsed_seconds=delta.days * seconds_in_day + delta.seconds

 hours=  int(elapsed_seconds/seconds_in_hour)
 minutes= int((elapsed_seconds - (hours*seconds_in_hour))/60)

 print("Hours {} Minutes {}".format(hours,minutes)) 
```

# installation - 如何编译Clisp 2.46？

> ID：130636
> 
> 赞同：4
> 
> 时间：2008-09-24T23:38:51.283
> 
> 标签：installation, lisp, common-lisp, configure

当我尝试在 Ubuntu 8.04 上编译最新版本的 Clisp 时，运行 configure 后总是出现此错误：

```
Configure findings:
FFI:        no (user requested: default)
readline:   yes (user requested: yes)
libsigsegv: no, consider installing GNU libsigsegv
./configure: libsigsegv was not detected, thus some features, such as
generational garbage collection and
stack overflow detection in interpreted Lisp code
cannot be provided.
Please do this:
  mkdir tools; cd tools; prefix=`pwd`/i686-pc-linux-gnu
  wget http://ftp.gnu.org/pub/gnu/libsigsegv/libsigsegv-2.5.tar.gz
  tar xfz libsigsegv-2.5.tar.gz
  cd libsigsegv-2.5
  ./configure --prefix=${prefix} && make && make check && make install
  cd ../..
  ./configure --with-libsigsegv-prefix=${prefix} --with-readline --with-unicode --with-module=i18n --with-module=gdbm --with-module=pcre --with-module=readline --with-module=regexp
If you insist on building without libsigsegv, please pass
  --ignore-absence-of-libsigsegv
to this script:
  ./configure --ignore-absence-of-libsigsegv --with-readline --with-unicode --with-module=i18n --with-module=gdbm --with-module=pcre --with-module=readline --with-module=regexp 
```

我试过按要求做，但没有帮助：它似乎忽略了这个`--with-libsigsegv-prefix`选项。我还尝试将 libsigsegv 安装在标准位置 ( `/usr/local`)。哦，当然，Ubuntu 告诉我系统中安装了 libsigsegv 和 libsigsegv-dev。

我真的很希望能够编译这个版本的 Clips，因为它对 Ubuntu 附带的版本进行了一些重大改进（我也想要 PCRE）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T00:18:23.167

这是我过去在 Ubuntu 上编译 CLISP 的笔记，希望对您有所帮助：

```
sudo apt-get install libsigsegv-dev libreadline5-dev

# as of 7.10, Ubuntu's libffcall1-dev is broken and I had to get it from CVS
# and make sure CLISP didn't use Ubuntu's version.
sudo apt-get remove libffcall1-dev libffcall1
cvs -z3 -d:pserver:anonymous@cvs.sv.gnu.org:/sources/libffcall co -P ffcall
cd ffcall; ./configure; make
sudo make install

cvs -z3 -d:pserver:anonymous@clisp.cvs.sourceforge.net:/cvsroot/clisp co -P clisp
cd clisp
./configure --with-libffcall-prefix=/usr/local --prefix=/home/luis/Software
ulimit -s 16384
cd src; make install 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-24T23:42:17.653

如果您查看“config.log”，它可能会告诉您为什么 configure 没有找到 libsigsegv

# debugging - ACCESS_VIOLATION_BAD_IP

> ID：130637
> 
> 赞同：0
> 
> 时间：2008-09-24T23:38:57.867
> 
> 标签：debugging, crash, windbg

我试图找出我的应用程序中的崩溃。WinDbg 告诉我以下内容：（使用破折号代替下划线）

**LAST-CONTROL-TRANSFER：从 005f5c7e 到 6e697474
DEFAULT-BUCKET-ID：BAD_IP
BUGCHECK-STR：ACCESS-VIOLATION**

对我来说很明显 6e697474 不是一个有效的地址。

我有三个问题：
1）“BAD_IP”存储桶 ID 是否意味着“错误指令指针”？
2) 这是一个多线程应用程序，因此一个考虑因素是我试图调用其函数的对象超出范围。有谁知道这是否会导致相同的错误消息？
3）还有什么可能导致这样的错误？我的一位同事建议这可能是**堆栈溢出**问题，但 WinDBG 过去已证明在检测和指出这些问题方面相当可靠。（并不是说我确定它在后台进行的巫术诊断）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T00:00:51.243

Bad-IP 是坏指令指针。根据您对问题的描述，我认为这是**堆栈损坏**而不是堆栈溢出。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T13:07:57.607

问一下可能会有所帮助，什么可以将字符串 'ttie' 写入此位置？通常当您有 0x41-0x5A、0x61-0x7A ([a-zA-Z]) 范围内的字节时，它表示字符串缓冲区溢出。

至于实际被覆盖的内容，它可能是返回地址、您正在使用的其他函数指针，或者有时`vfptr`对象中的虚函数表指针 ( ) 被覆盖以指向字符串的中间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T00:06:38.703

我可以想到以下可能导致跳转到无效地址的事情，按可能性降序排列：

*   在释放的对象上调用成员函数。（正如你所怀疑的）
*   调用损坏对象的成员函数。
*   使用损坏的 vtable 调用对象的成员函数。
*   覆盖代码空间的胭脂指针。

我会通过在 005f5c7e 找到代码并查看那里正在访问哪些对象来开始调试。

# vms - 是否有合理的方法在 VMS 上实现 cd 命令？

> ID：130640
> 
> 赞同：4
> 
> 时间：2008-09-24T23:39:36.163
> 
> 标签：vms

我希望能够说类似的话

**cd [.fred]**并让我的默认目录到那里，我的提示更改以指示我当前位置的完整路径。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-25T03:11:49.197

只需键入

`cd:==set default`

在命令提示符下。你也可以把它放在你的 LOGIN.COM 文件中，但一定要在前面放一个 $，即

`$ cd:==set default`

要更改您的提示以显示您的默认值，这样的事情可能会起作用

`$ set prompt='f$env("default")'`

尽管 VMS 提示符最多有 32 个字符，但您的默认值可能比这更长。看看[这个页面](http://www.phrack.com/issues.html?issue=19&id=2)来解决这个问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-25T02:55:39.937

我的 DCL*真的*生锈了，但你不能为 SET DEFAULT 命名 CD 创建一个别名吗？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-21T20:49:12.590

这是我的设置：

您需要 2 个文件（在下面键入）： sys$login 中的 godir.com 和 prompt.com

您可以定义一个符号

```
CD == "@sys$login:godir.com" 
```

但我建议你使用其他东西......（即 SD == "@sys$login:godir.com"）

我修改了帮助文本。原来是法语...

您必须将转义字符重新输入 godir.com 将 ESC 替换为 GRAPH_BOUCLE 中的真正转义：（参见 godir.com 底部）

然后使用它：

```
SD ?
SD a_directory
... 
```

希望能帮助到你。

* * *

这里是prompt.com

```
$       noeud   = f$trnlnm("SYS$NODE") - "::"
$       if noeud .eqs. "HQSVYC" then noeud = "¥"
$!
$       noeud = noeud - "MQO"
$       def_dir = f$directory()
$       def_dir = f$extract(1,f$length(def_dir)-2,def_dir)
$boucle:
$       i = f$locate(".",def_dir)
$       if i .eq. f$length(def_dir) then goto fin_boucle
$       def_dir = f$extract(i+1,f$length(def_dir)-1,def_dir)
$       goto boucle
$!
$fin_boucle:
$!      temp = "''noeud' ''def_dir' " + "''car_prompt'"
$       temp = "''noeud'" -
             + " ''def_dir' " -
             + "''f$logical(""environnement"")'" -
             + "''car_prompt'"
$!      temp = "''noeud'" -
$!           + "''def_dir'" -
$!           + "''f$logical(""environnement"")'" -
$!           + "''car_prompt'"
$       set prompt="''temp' "
$!
$! PROMPT.COM
$! 
```

这里是 godir.com

```
$!
$! GODIR.COM
$!
$       set noon
$       set_prompt = "@sys$login:prompt.com"
$       if f$type(TAB_DIR_N) .nes. "" then goto 10$
$       goto 20$
$ INIT:
$       temp2 = "INIT"
$ CLEAR:
$       temp = 0
$
$ INIT2:
$       temp = temp +1
$       if temp .gt. TAB_DIR_N then goto INIT3
$       delete/symb/glo TAB_DIR_'temp'
$       goto INIT2
$
$ INIT3:
$       P1 = ""
$       if temp2 .eqs. "INIT" then goto 20$
$       delete/symb/glo TAB_DIR_N
$       delete/symb/glo TAB_DIR_P
$       delete/symb/glo TAB_DIR_I
$       exit
$
$ 20$:
$       TAB_DIR_N == 1
$       TAB_DIR_P == 1
$       TAB_DIR_I == 1
$       if "''car_prompt'" .eqs. "" then car_prompt == ">"
$       TAB_DIR_1 == f$parse(f$dir(),,,"device")+f$dir()
$ 10$:
$       if P1 .eqs. ""  then goto LIST
$       if P1 .eqs. "?" then goto SHOW
$       if P1 .eqs. "." then P1 = "[]"
$       if P1 .eqs. "^" then goto SET_CUR
$       if (P1 .eqs. "<") .or. (P1 .eqs. ">") .or. -
           (P1 .eqs. "..") then P1 = "[-]"
$       if (P1 .eqs. "*") .or. (P1 .eqs. "0") then goto HOME
$       if (P1 .eqs. "P") .or. (P1 .eqs. "p") then goto PREVIOUS
$       if (P1 .eqs. "H") .or. (P1 .eqs. "h") then goto HELP
$       if (P1 .eqs. "S") .or. (P1 .eqs. "s") then goto SET_PROMPT
$       if (P1 .eqs. "G") .or. (P1 .eqs. "g") then goto SET_PROMPT_GRAPHIC
$       temp2 = ""
$       if (P1 .eqs. "~INIT")  .or. (P1 .eqs. "~init")  then goto INIT
$       if (P1 .eqs. "~CLEAR") .or. (P1 .eqs. "~clear") then goto CLEAR
$
$!      *** Specification par un numero
$       temp = f$extract(0,1,P1)
$       if temp .eqs. "-" then goto DELETE
$       temp2 = ""
$boucle_reculer:
$       if temp .nes. "\" then goto fin_reculer
$       temp2 = temp2 + "-."
$       P1 = P1 - "\"
$       temp = f$extract(0,1,P1)
$       goto boucle_reculer
$!
$fin_reculer:
$       P1 = temp2 + P1
$       if (P1 .lts. "0") .or. (P1 .gts. "9") then goto SPEC
$       temp = f$integer("''P1'")
$       if temp .eq. 0 then goto HOME
$       if (temp .lt. 1) .or. (temp .gt. TAB_DIR_N) then goto ERR
$       TAB_DIR_P == TAB_DIR_I
$       TAB_DIR_I == temp
$       goto SET2
$
$ SPEC:
$!      *** Specification relative de directory
$
$       temp = f$parse("[.''P1']","missing.mis")
$       DD = f$extract(0,f$locate("]",temp)+1,temp)
$       if DD .nes. "" then goto SET1
$
$!      *** Specification de directory principal
$
$       temp = f$parse("[''P1']","missing.mis")
$       DD = f$extract(0,f$locate("]",temp)+1,temp)
$       if DD .nes. "" then goto SET1
$
$       temp = f$parse("[''P1']","sys$login:missing.mis")
$       DD = f$extract(0,f$locate("]",temp)+1,temp)
$       if DD .nes. "" then goto SET1
$
$!      *** Specification exacte de directory
$
$       temp = f$parse(P1,"missing.mis")
$       if f$locate("]"+P1,temp) .ne. f$length(temp) then goto ERR
$       if f$locate(".][",temp) .ne. f$length(temp) then temp = temp - "]["
$       DD = f$extract(0,f$locate("]",temp)+1,temp)
$!      if DD .eqs. TAB_DIR_'TAB_DIR_I' then goto SHOW
$       if DD .eqs. TAB_DIR_'TAB_DIR_I' then goto SET2
$       if DD .nes. "" then goto SET1
$
$       temp = f$parse(P1,"sys$login:missing.mis")
$       if f$locate("]"+P1,temp) .ne. f$length(temp) then goto ERR
$       if f$locate(".][",temp) .ne. f$length(temp) then temp = temp - "]["
$       DD = f$extract(0,f$locate("]",temp)+1,temp)
$!      if DD .eqs. TAB_DIR_'TAB_DIR_I' then goto SHOW
$       if DD .eqs. TAB_DIR_'TAB_DIR_I' then goto SET2
$       if DD .nes. "" then goto SET1
$
$       goto ERR
$
$ HOME:
$       DD = "SYS$LOGIN"
$
$ SET1:
$       Set On
$       On error then goto ERR1
$       set message/nofac/noid/nosever/notext
$       Set def 'DD'
$       dir/output=nl:
$       set message/fac/id/sever/text
$       temp = f$parse(f$dir()) - ".;"
$       if temp .nes. "" then goto SET1F
$ ERR1:
$       set message/fac/id/sever/text
$       temp = TAB_DIR_'TAB_DIR_I'
$       Set def 'temp'
$       goto ERR
$ SET1F:
$       I = 0
$ LOOP1:
$       I = I + 1
$       if temp .eqs. TAB_DIR_'I' then goto FOUND
$       if I .lt. TAB_DIR_N then goto LOOP1
$
$       TAB_DIR_N == TAB_DIR_N + 1
$       TAB_DIR_P == TAB_DIR_I
$       TAB_DIR_I == TAB_DIR_N
$       TAB_DIR_'TAB_DIR_I' == temp
$       goto SHOW
$
$ FOUND:
$       TAB_DIR_P == TAB_DIR_I
$       TAB_DIR_I == I
$       goto SET2
$
$ SET_PROMPT:
$       car_prompt == "''P2'"
$       set_prompt
$       exit
$
$ PREVIOUS:
$       temp = TAB_DIR_P
$       TAB_DIR_P == TAB_DIR_I
$       TAB_DIR_I == temp
$
$ SET_CUR:
$ SET2:
$       DD = TAB_DIR_'TAB_DIR_I'
$       set def 'DD'
$
$ SHOW:
$       temp = TAB_DIR_'TAB_DIR_I'
$       ws "  ''TAB_DIR_I' * ''temp'"
$       set_prompt
$       exit
$
$ LIST:
$       I = 0
$ LOOP2:
$       I = I + 1
$       temp = TAB_DIR_'I'
$       if I .eq. TAB_DIR_I then goto L_CUR
$       if I .eq. TAB_DIR_P then GOTO L_PRE
$       ws "  ''I' = ''temp'"
$       goto F_LOOP2
$ L_CUR:
$       ws "  ''I' * ''temp'"
$       goto F_LOOP2
$ L_PRE:
$       ws "  ''I' + ''temp'"
$
$ F_LOOP2:
$       if I .lt. TAB_DIR_N then goto LOOP2
$       set_prompt
$
$       exit
$
$ DELETE:
$       P1 = P1 - "-"
$       temp2 = f$integer("''P1'")
$ DEL_1:
$       temp = f$integer("''P1'")
$       if (temp .lt. 1) .or. (temp .gt. TAB_DIR_N) then goto ERR
$       if temp .eq. TAB_DIR_I then goto ERR
$       if temp .lt. TAB_DIR_I then TAB_DIR_I == TAB_DIR_I - 1
$       if temp .eq. TAB_DIR_P then TAB_DIR_P == TAB_DIR_I
$       if temp .lt. TAB_DIR_P then TAB_DIR_P == TAB_DIR_P - 1
$ LOOP3:
$       if temp .eq. TAB_DIR_N then goto F_LOOP3
$       temp3 = temp + 1
$       TAB_DIR_'temp' == TAB_DIR_'temp3'
$       temp = temp + 1
$       goto LOOP3
$ F_LOOP3:
$       delete/symb/glo tab_dir_'tab_dir_n'
$       TAB_DIR_N == TAB_DIR_N - 1
$       if P2 .eqs. "" then goto FIN_DEL
$       temp2 = temp2 + 1
$       if temp2 .le. f$integer("''P2'") then goto DEL_1
$ FIN_DEL:
$       goto LIST
$
$ ERR:
$       ws "*** ERREUR ***"
$       exit
$
$ HELP:
$       ws "    H       Show this menu"
$       ws "    null    Show a list of directories"
$       ws "    ?       Show current directory"
$       ws "    < or [-] or"
$       ws "    > or .. Remonte d'un niveau de directory"
$       ws "    * ou 0  Return to SYS$LOGIN"
$       ws "    P       Last directory "
$       ws "    . ou [] Set cureent directory"
$       ws "    ^       Return to next directory"
$       ws "    x       Set def to number x"
$       ws "    -x      Remove the number x"
$       ws "    -x y    Remove from x to y"
$       ws "    ddd     Set def to [ddd] or [.ddd] or ddd:"
$       ws "    \ddd    Set def to [-.ddd]"
$       ws "    S "">>""  Modify prompt for >>"
$       ws "    ~INIT   Initialize to current directory "
$       ws "            (and delete all others references)"
$       ws "    ~CLEAR  Remove all references
$       ws ""
$
$       exit
$
$ SET_PROMPT_GRAPHIC:
$       temp = "''P2'"
$       i=0
$       car_prompt == ""
$ GRAPH_BOUCLE:
$       t=f$extract(i,1,temp)
$       if (t .eqs. "e") .or. (t .eqs. "E") then t="ESC"
$       if (t .eqs. "g") .or. (t .eqs. "G") then t="ESC(0"
$       V° (} .L-_. "N") .-_. (} .L-_. "H") }NL+ }="ESC(B"
$       car_prompt == car_prompt + t
$       i = i+1
$       if i .lts. f$length(temp) then goto GRAPH_BOUCLE
$
$       set_prompt
$       exit 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-12-17T14:16:56.983

使用实现 SD（SET DEFAULT 的缩写）命令的 HGSD。只是谷歌它。它是 Hunter Goatley 对旧实现的改进版本。

它（目前）唯一不能处理的是具有多种翻译的逻辑。除此之外，它就像一个魅力，你不需要输入完整的目录名称。您甚至可以移动到同一级别的下一个目录。

如果您拥有正确的权限，它还可以设置提示，因此您的提示将反映您的默认目录，就像过去在 DOS 上一样。

# c++ - 合并两个可执行文件

> ID：130664
> 
> 赞同：1
> 
> 时间：2008-09-24T23:44:21.347
> 
> 标签：c++, command-line, assembly, executable

我有一个命令行可执行文件，它改变了我想从我的程序中使用的文件中的一些位。是否可以创建我自己的使用此工具的可执行文件并仅分发一个可执行文件？

[编辑] 澄清：

命令行工具获取偏移量和一些位，并更改给定文件中此偏移量的位。所以我想为一个将特定位更改为特定值的应用程序创建一个修补程序，所以我能做的就是写一个批处理文件之类的东西来完成它，但我想创建一个可执行文件，即将工具嵌入到一个使用特定值调用它的包装程序。

我可以在（windows）c\c++、asm 中编写包装器，但请不要使用 .net。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-25T00:13:10.077

滚动你自己的这个程序的实现比编写包装器更容易；这听起来很简单——只需打开文件，寻找正确的位置，写入你的位，关闭文件，你就完成了。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T23:47:32.743

最简单的方法是将这个 exe 嵌入到您自己的中，然后将其写入磁盘以运行它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-24T23:48:47.577

您可以将可执行文件作为二进制流资源添加到可执行文件中，并在需要时将其提取到临时文件夹中并使用临时文件创建新进程。

您需要执行此操作的确切代码取决于您是在编写 .Net 代码还是 C++ 代码。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T23:48:59.073

简短的回答：没有。

简短的回答：除非它是安装程序或可执行的自解压存档，否则不会。

更长的推测性答案：如果文件系统支持备用数据流，您可以将包含该实用程序的流添加到您的程序中，然后您的程序可以访问它自己的备用数据流，并在需要时提取该实用程序。啊哈哈。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-24T23:51:10.660

您可以将一个可执行文件附加到另一个可执行文件的末尾，然后编写一些代码将其解压缩到一个临时文件夹。

我之前做过类似的事情，但是在 Windows 中将配置文件和一些位图附加到 EXE 中。我这样做的方法是首先将我的东西附加到 EXE 的末尾，然后在其后写一个小结构，其中包含数据的文件偏移量，在你的情况下，这将是第二个 exe 的偏移量。

运行您的应用程序时，查找文件末尾减去结构大小，提取文件偏移量并将第二个 exe 复制到临时文件夹，然后启动它。

好的，这里有一些更详细的要求。这是一些用于创建组合 EXE 的伪代码。这是您在编译主 EXE 后运行的一个小实用程序：

```
Open destination file
Open main exe as a binary file
Copy main exe to destination file
offset = size of main exe
Open 2nd exe as a binary file
Copy 2nd exe to the output file
Write the offset to the output file 
```

现在进行提取过程。这在您的主 EXE 中：

```
Find the location of our own EXE file (GetModuleFileName() under Windows)
Open the file in binary mode
Seek to the end minus sizeof(offset) (typically 4 bytes)
Read the offset value
Seek to the offset position
Open a temporary file in binary mode
Read bytes from the main EXE and write to the temporary file
Launch the temporary file 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T00:20:13.430

我认为为您的目的执行此操作的最简单方法可能是使用自解压可执行包。例如，使用像[Paquet Builder](http://www.gdgsoft.com/pb/index.aspx)这样的工具，它将打包 exe（以及您想要的任何其他文件），并且可以配置为在用户解压自解压可执行文件时调用 exe 或批处理文件或您想要的任何其他文件。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-25T00:59:40.323

如果 exe 被构建为可重定位（本质上是链接器标志 /fixed:no），您实际上可以对其执行 LoadLibrary，获取基地址，设置调用链并调用（跳转）到它。这不值得付出努力，而且很少有 exe 以这种方式构建，因此您必须拥有代码来重建它，此时您将不会参与此练习。

所以不行。

我对不介意用 C/C++/asm 编写，但“不是 .net”的开发人员更感兴趣——但显然被 fopen/fseek/fwrite 阻碍了——因为这就是你描述的所有程序听起来像是正在做。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-25T05:43:15.913

我认为这也可以通过使用[AutoIt 的 FileInstall 功能来实现](http://www.autoitscript.com/autoit3/docs/functions/FileInstall.htm)。为此，您必须设置 AutoIt，使用 FileInstall 函数创建一个脚本以包含 who exe，然后使用[函数 RunWait](http://www.autoitscript.com/autoit3/docs/functions/RunWait.htm)执行它们。编译成一个exe，你应该完成了。

# perl - 如何保护批处理文件中的引号？

> ID：130698
> 
> 赞同：5
> 
> 时间：2008-09-24T23:55:23.177
> 
> 标签：perl, batch-file, quotes

我想在批处理文件中包装一个[Perl 单行](https://en.wikipedia.org/wiki/One-liner_program#Perl)。对于一个（微不足道的）示例，在 Unix shell 中，我可以引用如下命令：

```
perl -e 'print localtime() . "\n"' 
```

但是 DOS 用这个有用的错误消息阻止了这一点：

> 在 -e 第 1 行的 EOF 之前的任何地方都找不到字符串终止符“'”。

[在.bat 文件](https://en.wikipedia.org/wiki/Batch_file)中执行此操作的最佳方法是什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-25T00:08:23.833

对于 Windows 上的 Perl 内容，我尝试尽可能多地使用广义引用，这样我就不会患上倾斜牙签综合症。我为 DOS 需要的东西保存了引号：

```
perl -e "print scalar localtime() . qq(\n)" 
```

如果您只需要在打印结束时换行，您可以让`-l`开关为您执行此操作：

```
perl -le "print scalar localtime()" 
```

有关您可以使用开关做的其他很酷的事情，请参阅[perlrun](http://perldoc.perl.org/perlrun.html)文档。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-25T00:08:33.630

在 Windows 的“DOS 提示符”（cmd.exe）中，您需要使用双引号而不是单引号。对于引用的 Perl 代码，Perl 为您提供了很多选项。三是：

```
perl -e "print localtime() . qq(\n)"
perl -e "print localtime() . $/"
perl -le "print ''.localtime()" 
```

如果您有 Perl 5.10 或更新版本：

```
perl -E "say scalar localtime()" 
```

感谢[JF Sebastian](https://stackoverflow.com/users/4279/jf-sebastian)的评论。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T14:18:29.163

对于 Windows NT+ 下的一般批处理文件，^ 字符会转义很多东西 (<>|&)，但对于引号，将它们加倍会产生奇迹：

```
C:\>perl -e "print localtime() . ""\n"""
Thu Oct  2 09:17:32 2008 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T00:09:13.830

在 DOS 中，您在 Perl 命令周围使用“”。DOS shell 不像普通的 Unix shell 那样做单引号：

```
perl -e "print localtime();" 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-25T01:59:32.817

首先，你得到的任何答案都是特定于命令的，因为 DOS shell 不像 uniq 那样解析命令行；它将整个未解析的字符串传递给执行任何拆分的命令。也就是说，如果使用 /subsystem:console，C 运行时会在调用 main() 之前提供拆分，并且大多数命令都使用它。

如果应用程序正在使用这种拆分，则键入文字双引号的方式是将其加倍。所以你会做

```
perl -e "print localtime() . ""\n""" 
```

# asp.net - 如何使用动态添加的 Control 子类访问 Control.ViewState？

> ID：130705
> 
> 赞同：0
> 
> 时间：2008-09-24T23:59:43.603
> 
> 标签：asp.net, controls, viewstate

我们已经创建了一个需要通过 Control 类的 ViewState 属性来持久化数据的控件。我们的类子类严格控制以访问 ViewState 属性（它在 Page 对象上受到保护）。我们在 OnInit 中将控件添加到 Page.Controls，然后尝试在 OnPreLoad 中设置 ViewState 属性。

当我们解码并检查页面的 ViewState 时，我们的值还没有被写出，因此不能用于以后的检索。

有谁知道我们如何让我们的控制权参与 ViewState 过程？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T01:24:48.313

问题是将控件直接添加到页面。不幸的是，这在控件层次结构中太高了，无法参与 Forms ViewState 处理。如果您将控件添加到实际的 ASPNet 表单的 Controls 集合中，那么它将成功地参与 LoadViewStateRecursive 和 SaveViewStateRecursive。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T00:03:09.820

尝试在 OnInit 中创建您的控件，然后在 OnLoad 期间将其添加到 Page.Controls。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T00:39:00.950

ViewState 直到 OnInit 之后才加载，但在 OnLoad 之前。

这是页面生命周期 ( [GregMac](https://stackoverflow.com/users/7913/gregmac) ) 的粗略轮廓，在回答我之前的问题时发布了此内容。

*   初始化*   加载视图状态*   加载回发数据*   呼叫控制加载事件*   调用加载事件*   呼叫控制事件*   控制预渲染*   预渲染*   保存视图状态*   卸下

# visual-studio - 扩展区域将扩展 Visual Studio 中的子项

> ID：130708
> 
> 赞同：0
> 
> 时间：2008-09-25T00:00:46.627
> 
> 标签：visual-studio

我正在开发一个 ASP.NET Ajax 表单，并决定将大部分站点放在一个页面中，因为它不是一个非常复杂的站点（它更像是一个表单）。在代码隐藏中，我通过向其添加区域（内部是控件的单击事件等）来使我的代码更有条理。

当我扩展一个区域时，所有的子程序和子区域都会被扩展。Visual Studio 中是否有防止这种情况发生的选项？我希望能够扩展一个区域，然后扩展我想编辑的区域或子程序，而不是收缩所有子程序和子区域以防止我被我的胖代码分心。:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T00:05:15.773

这些键盘快捷键应该会有所帮助。我相信您可以折叠所有区域，然后，当您打开一个区域时，它的子区域将保持折叠状态。虽然没有测试。

```
Ctrl + M, Ctrl + M  Collapse or expand the block you?re currently in.
Ctrl + M, Ctrl + O  Collapse all blocks in the file
Ctrl + M, Ctrl + L  Expand all blocks in the file 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T00:02:33.363

尝试“键和弦”：Ctrl+M、Ctrl+O，然后使用 Ctrl+M、Ctrl+M 一次展开一个。

虽然，我确实认为区域是邪恶的，你应该对胖代码做点什么；）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T00:08:30.977

VS 默认不展开所有嵌套区域。它保持嵌套区域的状态。VS 中没有选项可以在扩展区域时显式折叠或扩展所有嵌套区域。

您可以使用 Ctrl-M Ctrl-L 将文件中的所有区域切换为折叠，然后使用 Ctrl-M Ctrl-M 沿着区域树向下导航到您需要的区域。

您还可以使用部分类并将您的代码隐藏在几个源文件中。

# continuous-integration - 设置一个新的 CI 存储库需要多长时间？

> ID：130711
> 
> 赞同：3
> 
> 时间：2008-09-25T00:01:36.733
> 
> 标签：continuous-integration

我想知道通常需要多长时间：

1.  专业的
2.  平均的
3.  初学者

为新项目设置和配置 CI？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T03:13:52.123

我以前从未设置过 CI，这使我完全属于您的“初学者”类别。您的问题促使我尝试为我的项目设置 CI 系统；我一直避免的事情，因为我认为这会花费我很多精力和时间。

我花了整整20分钟。

我使用了一个*很棒*的项目，叫做[CInABox (Continuous Integration in a Box)](https://GitHub.Com/TheWoolleyMan/CInABox/)。它由两个简单的脚本组成，它们下载和编译 Ruby，并为 Ubuntu 8.04下载、安装和配置[CruiseControl.rb 。](http://CruiseControlRb.ThoughtWorks.Com/)

在短短 20 分钟内，我下载了 Ubuntu JeOS 8.04，配置了 VirtualBox VM，在该 VM 中安装了 Ubuntu，设置网络，安装了 Ruby，安装了 CruiseControl.rb，将我的第一个项目添加到 CC.rb，然后看着灯变绿了！大部分时间实际上都花在了下载 Ubuntu、下载 Ruby 和安装 Ubuntu 上。实际的 CI 设置不到 5 分钟。

不要让这个名字欺骗了你：CC.rb 是*用*Ruby 编写的，但你可以用它构建*任何东西*。在默认配置中，它假定您正在使用`rake`构建项目，但是通过仅设置一个配置选项，您也可以使用 shell 脚本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T00:10:03.937

这取决于您已经拥有多少其他基础设施，以及您是否在将所有内容捆绑在一起时遇到问题。即使考虑到这一点，如果您对自己正在做的事情有一个不错的了解，您应该能够在一天左右的时间内启动并运行[TeamCity和所有基础架构。](http://www.jetbrains.com/teamcity/)该文档对 TeamCity 来说非常好，应该可以帮助您克服任何困难。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-05T06:36:18.857

这取决于可能的因素：

*   您想使用 CI 的哪些功能。
*   您是否已经在 CI 环境中安装了项目。
*   什么类型的项目。它可以多么容易地安装在新鲜的环境中。只是说几句。

我认为如果项目不是一件小事，那么花在 CI 环境上的所有时间都是值得的。不管是20分钟还是3天。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T00:05:32.967

[CI工厂](http://www.cifactory.org/joomla/)

[团队城市](http://www.jetbrains.com/teamcity/)

[CC.NET 示例配置](http://code.google.com/p/dot-net-reference-app/source/browse/#svn/trunk%3Fstate%3Dclosed)

尝试。

# apache-flex - Flex：为什么我不能处理某些事件？

> ID：130720
> 
> 赞同：2
> 
> 时间：2008-09-25T00:04:05.120
> 
> 标签：apache-flex, events

在某些情况下，我似乎无法让组件接收事件。

[编辑]

为了澄清，示例代码只是为了演示，我真正要问的是是否有一个可以添加侦听器的中心位置，一个可以可靠地向任意对象发送事件和从任意对象发送事件的中心位置。

我最终使用 parentApplication 来调度和接收我需要处理的事件。

[/编辑]

如果两个组件具有不同的父组件，或者如下例所示，一个是弹出窗口，则事件似乎永远不会到达侦听器（请参阅方法“popUp”以了解不起作用的调度）：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" 
        layout="absolute" 
        initialize="init()">
<mx:Script>
    <![CDATA[
        import mx.controls.Menu;
        import mx.managers.PopUpManager;

        // Add listeners
        public function init():void
        {
            this.addEventListener("child", handleChild);
            this.addEventListener("stepchild", handleStepchild);
        }

        // Handle the no pop button event
        public function noPop(event:Event):void
        {
            dispatchEvent(new Event("child"));
        }

        // Handle the pop up
        public function popUp(event:Event):void
        {
            var menu:Menu = new Menu();
            var btnMenu:Button = new Button();
            btnMenu.label = "stepchild";
            menu.addChild(btnMenu);
            PopUpManager.addPopUp(menu, this);

            // neither of these work...
            this.callLater(btnMenu.dispatchEvent, [new Event("stepchild", true)]);
            btnMenu.dispatchEvent(new Event("stepchild", true));
        }

        // Event handlers

        public function handleChild(event:Event):void 
        {
            trace("I handled child");
        }

        public function handleStepchild(event:Event):void {
            trace("I handled stepchild");
        }
    ]]>
</mx:Script>

<mx:VBox>
    <mx:Button label="NoPop" id="btnNoPop" click="noPop(event)"/>
    <mx:Button label="PopUp" id="btnPop" click="popUp(event)"/>
</mx:VBox>
</mx:Application> 
```

**我可以想到变通办法，但似乎应该有一些中央事件总线......**

我错过了什么吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T12:34:01.997

以上是正确的。您正在从 btnMenu 分派事件，但您没有监听 btnMenu 上的事件 - 您正在监听应用程序上的事件。

从应用程序调度：

```
dispatchEvent(new Event("stepchild", true)); 
```

或在 btnMenu 上收听

```
btnMenu.addEventListener("stepchild",handleStepChild);
btnMenu.dispatchEvent(new Event("stepchild",true)); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-25T01:43:49.907

您正在将侦听器附加到`this`从`btnMenu`.

这应该有效：

```
dispatchEvent(new Event("stepchild", true));

```

附言。真的没有理由在`this`任何地方都放一个不必要的 ' '，除非明确要求它来克服范围问题。在这种情况下，您可以忽略所有内容`this`。

# asp.net - 在 Asp.Net 中模拟用户

> ID：130721
> 
> 赞同：3
> 
> 时间：2008-09-25T00:04:56.057
> 
> 标签：asp.net, database-connection

我的 DBA 要求通过受信任的域帐户完成所有数据库访问。如果您设置 web.config ，则可以做到这一点。这要求用户登录或在域上，以便 IE 传递凭据。我想通过使用代码来模拟用户。我正在使用此知识库文章中的代码：

[http://support.microsoft.com/kb/306158](http://support.microsoft.com/kb/306158)

效果很好，我传入凭据，模拟用户，然后调用数据库并返回数据。

问题是如果我转到另一个页面，我会丢失我的模拟凭据。这意味着每次我调用数据库时，我都必须运行模拟代码。

如果 IIS 可以为所有页​​面模拟域用户，那么为什么我在使用代码时不能模拟用户？

这似乎与线程上下文切换有关。我尝试在 Aspnet.config 文件中设置 alwaysFlowImpersonatingPolicy，但它不起作用。

[http://msdn.microsoft.com/en-us/library/ms229553.aspx](http://msdn.microsoft.com/en-us/library/ms229553.aspx)

有什么建议吗？甚至可以做我想做的事吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T00:52:07.097

模拟发生在线程级别。模拟导致线程的访问令牌（通常从进程继承）被另一个替换。最佳做法是在您完成所需的操作后立即恢复模拟的效果，从而恢复令牌。IIS 或 ASP.NET 的情况也不例外。每个请求通常由不同的线程处理，因此您必须让每个线程模拟用户。

> 这意味着每次我调用数据库时，我都必须运行模拟代码。

所以这是正确的。

> 如果 IIS 可以为所有页​​面模拟域用户，那么为什么我在使用代码时不能模拟用户？

IIS 的做法并没有什么不同，因此它可能只是一种错觉。它不能模拟所有页面的用户，除非所有页面都由同一个线程提供服务，并且在提供每个页面时从未恢复模拟的令牌。

> 这似乎与线程上下文切换有关。

并不真地。除非您正在进行异步处理（您没有在问题中声明您这样做），否则模拟上下文的流程将不相关。如果您在处理单个请求期间直接或间接导致线程切换，您只需要担心模拟上下文的流动。如果您希望辅助（工作）线程完成的工作继续在主线程的模拟上下文下发生，那么您需要确保辅助线程借用模拟令牌。在 .NET Framework 1.1 中，您必须非常小心并手动编排模拟上下文的流程。然而，在 .NET 2.0 中，引入了[ExecutionContext](http://msdn.microsoft.com/en-us/library/system.threading.executioncontext.aspx) API 并完成了很多繁重的工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T00:31:59.593

您丢失模拟上下文的原因是每次新页面请求结束时，模拟上下文都会超出范围。

根据文档`<alwaysFlowImpersonationPolicy>`，用于确保跨异步调用维护相同的模拟上下文。例如，当对远程 Web 服务进行异步调用时，回调模拟上下文与启动线程相同。在 ASP.NET 的情况下，模拟上下文只会在页面请求的生命周期内流动。

# c# - 如何对不可变类构造函数进行单元测试？

> ID：130730
> 
> 赞同：1
> 
> 时间：2008-09-25T00:09:13.423
> 
> 标签：c#, unit-testing

我有一个不可变类，其中包含在构造函数执行期间设置的一些私有字段。我想对这个构造函数进行单元测试，但我不确定这种情况下的“最佳实践”。

**简单示例**

此类在 Assembly1 中定义：

```
public class Class2Test
{
    private readonly string _StringProperty;

    public Class2Test()
    {
        _StringProperty = ConfigurationManager.AppSettings["stringProperty"];
    }
} 
```

此类在 Assembly2 中定义：

```
[TestClass]
public class TestClass
{
    [TestMethod]
    public void Class2Test_Default_Constructor()
    {
        Class2Test x = new Class2Test();
        //what do I assert to validate that the field was set properly?
    }
} 
```

**编辑 1**：我已经用一个潜在的解决方案回答了这个问题，但我不确定这是否是“正确的方法”。因此，如果您认为自己有更好的想法，请发布。

这个例子真的不值得测试，但假设构造函数有一些更复杂的逻辑。如果类上方法的所有测试都有效，那么最好的方法是避免测试构造函数并假设它有效吗？

**编辑 2**：看起来我让样本有点简单。我已经用更合理的情况更新了它。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-25T00:10:23.983

什么都没有，除非您使用该字段。您不希望通过测试进行过度规范。换句话说，不需要测试赋值运算符是否有效。

如果您在方法或其他东西中使用该字段，请调用该方法并对其进行断言。

编辑：

> 假设构造函数有一些更复杂的逻辑

您不应该在构造函数中执行任何逻辑。

编辑2：

> ```
> public Class2Test()
> {
>      _StringProperty = ConfigurationManager.AppSettings["stringProperty"];
> } 
> ```

不要那样做！=) 你的简单单元测试现在变成了集成测试，因为它依赖于多个类的成功运行。编写一个处理配置值的类。WebConfigSettingsReader 可以是名称，它应该封装`ConfigurationManager.AppSettings`调用。将该 SettingsReader 类的实例传递给`Class2Test`. 然后，在你的*单元测试*中，你可以模拟你的`WebConfigSettingsReader`并存根对你可能对其进行的任何调用的响应。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T00:09:33.253

我已`[InternalsVisibleTo]`在 Assembly1（代码）上正确启用，以便与 Assembly2（测试）存在信任关系。

```
public class Class2Test
{
    private readonly string _StringProperty;
    internal string StringProperty { get { return _StringProperty; } }

    public Class2Test(string stringProperty)
    {
        _StringProperty = stringProperty;
    }
} 
```

这让我可以断言：

```
Assert.AreEqual(x.StringProperty, "something"); 
```

我唯一不喜欢的是，当您仅查看`Class2Test`内部属性的用途时，还不清楚（没有评论）。

额外的想法将不胜感激。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T00:27:01.930

在您的编辑中，您现在依赖于难以测试的 ConfigurationManager。

一个建议是提取一个接口，然后让 Class2Test ctor 将 IConfigManager 实例作为参数。现在您可以使用假/模拟对象来设置其状态，以便可以测试任何依赖配置的方法以查看它们是否使用了正确的值...

```
 public interface IConfigManager
    {
        string FooSetting { get; set; }
    }

    public class Class2Test
    {
        private IConfigManager _config;
        public Class2Test(IConfigManager configManager)
        {
            _config = configManager;   
        }

        public void methodToTest()
        {
            //do something important with ConfigManager.FooSetting
            var important = _config.FooSetting;
            return important;
        }
    }

    [TestClass]
    public class When_doing_something_important
    {
        [TestMethod]
        public void Should_use_configuration_values()
        {
            IConfigManager fake = new FakeConfigurationManager();
            //setup state
            fake.FooSetting = "foo";
            var sut = new Class2Test(fake);
            Assert.AreEqual("foo", sut.methodToTest());
        }
    } 
```

# html - 如何在 Vim 中快速关闭 HTML 标签？

> ID：130734
> 
> 赞同：121
> 
> 时间：2008-09-25T00:10:08.663
> 
> 标签：html, xml, vim, autocomplete

自从我不得不在 中编写任何类似 HTML 的代码以来已经有一段时间了`Vim`，但最近我又遇到了这个问题。假设我正在写一些简单的东西`HTML`：

```
<html><head><title>This is a title</title></head></html> 
```

如何快速写下标题、标题和 html 的结束标签？我觉得我在这里错过了一些非常简单的方法，不涉及我将它们一一写下来。

当然，我可以使用`Ctrl``P`自动完成各个标签名称，但让我在笔记本电脑键盘上使用的实际上是正确使用括号和斜线。

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2008-09-25T18:15:23.377

我发现使用[xmledit](https://www.vim.org/scripts/script.php?script_id=301)插件非常有用。它增加了两个功能：

1.  当您打开一个标签（*例如*type `<p>`）时，它会在您键入结束时立即展开标签并将光标置于插入模式下的标签内`>`。`<p></p>`
2.  如果您随后立即键入另一个`>`（*例如*您键入`<p>>`），它会将其扩展为

    `<p>`

    `</p>`

并将光标置于标签内，缩进一次，处于插入模式。

[xml](http://www.vim.org/scripts/script.php?script_id=1397) vim 插件为这些功能添加了代码折叠和嵌套标记匹配。

[当然，如果您在Markdown](http://daringfireball.net/projects/markdown/)中编写 HTML 内容并使用`%!`您选择的 Markdown 处理器过滤您的 Vim 缓冲区，您根本不必担心关闭标签:)

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2009-02-10T14:55:18.440

我喜欢极简的东西，

```
imap ,/ </<C-X><C-O> 
```

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2008-09-27T18:08:09.653

我发现让 vim 为我编写开始和结束标记更方便，而不仅仅是结束标记。您可以使用 Tim Pope 的优秀[ragtag 插件](http://www.vim.org/scripts/script.php?script_id=1896)。用法如下所示（让 | 标记光标位置）您键入：

```
跨度|
```

按`CTRL`+`x` `SPACE`

你得到

```
<span>|</span>
```

你也可以使用`CTRL`+`x` `ENTER`而不是`CTRL`+ `x` `SPACE`，你会得到

```
<跨度>
|
</span>
```

Ragtag 可以做的不仅仅是它（例如，在这个 %> 或 DOCTYPE 周围插入 <%= 内容）。您可能想查看[ragtag 作者的](http://www.vim.org/account/profile.php?user_id=9012)其他插件，尤其是[环绕](http://www.vim.org/scripts/script.php?script_id=1697)。

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2008-09-25T00:12:02.387

看一下这个..

closetag.vim

```
Functions and mappings to close open HTML/XML tags 
```

[https://www.vim.org/scripts/script.php?script_id=13](https://www.vim.org/scripts/script.php?script_id=13)

我使用类似的东西。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2010-12-14T12:12:31.710

如果您正在做任何复杂的事情，[那么 sparkup](https://github.com/rstacruz/sparkup)非常好。

他们网站上的一个例子：

`ul > li.item-$*3`扩展为：

```
<ul>
    <li class="item-1"></li>
    <li class="item-2"></li>
    <li class="item-3"></li>
</ul> 
```

带一个`<C-e>`。

要执行问题中给出的示例，

```
html > head > title{This is a title} 
```

产量

```
<html>
  <head>
    <title>This is a title</title>
  </head>
</html> 
```

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2011-12-08T01:14:14.580

还有一个zencoding vim插件：[https ://github.com/mattn/zencoding-vim](https://github.com/mattn/zencoding-vim)

教程：[https ://github.com/mattn/zencoding-vim/blob/master/TUTORIAL](https://github.com/mattn/zencoding-vim/blob/master/TUTORIAL)

* * *

**更新：**现在称为***Emmet***：[http ://emmet.io/](http://emmet.io/)

* * *

教程的摘录：

```
1\. Expand Abbreviation

  Type abbreviation as 'div>p#foo$*3>a' and type '<c-y>,'.
  ---------------------
  <div>
      <p id="foo1">
          <a href=""></a>
      </p>
      <p id="foo2">
          <a href=""></a>
      </p>
      <p id="foo3">
          <a href=""></a>
      </p>
  </div>
  ---------------------

2\. Wrap with Abbreviation

  Write as below.
  ---------------------
  test1
  test2
  test3
  ---------------------
  Then do visual select(line wize) and type '<c-y>,'.
  If you request 'Tag:', then type 'ul>li*'.
  ---------------------
  <ul>
      <li>test1</li>
      <li>test2</li>
      <li>test3</li>
  </ul>
  ---------------------

...

12\. Make anchor from URL

  Move cursor to URL
  ---------------------
  http://www.google.com/
  ---------------------
  Type '<c-y>a'
  ---------------------
  <a href="http://www.google.com/">Google</a>
  --------------------- 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2012-08-12T19:53:13.720

## 映射

我喜欢立即关闭我的块标签（而不是内联标签）并使用尽可能简单的快捷方式（我喜欢尽可能避免使用特殊键`CTRL`，尽管我确实使用`closetag.vim`关闭我的内联标签。）我喜欢使用这个开始标签块时的快捷方式（感谢@kimilhee；这是他的回答）：

```
inoremap ><Tab> ><Esc>F<lyt>o</<C-r>"><Esc>O<Space> 
```

## 示例使用

类型——</p>

```
<p>[Tab] 
```

结果——</p>

```
<p>
 |
</p> 
```

where`|`表示光标位置。

## 解释

*   `inoremap` *表示*以插入模式创建映射
*   `><Tab>` *表示*右尖括号和制表符；这是匹配的
*   `><Esc>` *表示*结束第一个标签并退出插入到正常模式
*   `F<` *表示*找到最后一个左尖括号
*   `l` *表示*将光标向右移动一个（不要复制左尖括号）
*   `yt>` *表示*从光标位置拉到下一个右尖括号之前（即复制标签内容）
*   `o</` *表示*以插入模式开始新行并添加左尖括号和斜线
*   `<C-r>"` *表示*从默认寄存器以插入模式粘贴 ( `"`)
*   `><Esc>` *表示*关闭结束标签并退出插入模式
*   `O<Space>` *表示*在光标上方以插入模式开始一个新行并插入一个空格

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2017-02-24T00:15:11.267

# 查看[`vim-closetag`](https://github.com/alvan/vim-closetag)

这是一个非常简单的脚本（也可作为`vundle`插件使用），可以为您关闭 (X)HTML 标记。从它`README`：

> 如果这是当前内容：
> 
> ```
> <table| 
> ```
> 
> 现在按下`>`，内容将是：
> 
> ```
> <table>|</table> 
> ```
> 
> 现在如果你再按`>`一下，内容将是：
> 
> ```
> <table>
>    |
> </table> 
> ```

* * *

*注意：`|`这里是光标*

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2010-05-29T09:21:43.317

allml（现在是 Ragtag）和 Omni-completion（<CX><CO>）在 .py 或 .java 这样的文件中不起作用。

如果你想在这些文件中自动关闭标签，你可以像这样映射。

```
imap <Cj> <ESC>F<lyt>$a</^R">

```

（ ^R 是 Contrl+R ：您可以像这样输入 Control+v 然后 Control+r ）

（| 是光标位置）现在如果你输入..

<p>abcde|

并输入 ^j

然后它像这样关闭标签..

<p>abcde</p>|

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2012-10-26T12:10:54.163

这是另一个基于易于找到的 Web 写作的简单解决方案：

1.  [自动关闭 HTML 标签](http://vim.wikia.com/wiki/Auto_closing_an_HTML_tag)

    `:iabbrev </ </<C-X><C-O>`

2.  [打开完成](http://amix.dk/blog/post/19021#Vim-7-Turning-completion-on)

    `autocmd FileType xml set omnifunc=xmlcomplete#CompleteTags`

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2016-08-18T15:47:32.757

基于@KeithPinson 的出色答案（抱歉，还没有足够的声誉点来评论您的答案），这种替代方案将阻止自动完成复制任何可能在 html 标记内的额外内容（例如类、ID 等。 .) 但不应复制到结束标签。

**更新**我已经更新了我对`filename.html.erb`文件处理的回复。
我注意到我的原始响应在 Rails 视图中常用的文件中不起作用，例如`some_file.html.erb`当我使用嵌入式 ruby​​ 时（例如`<p>Year: <%= @year %><p>`）。下面的代码*将*适用于`.html.erb`文件。

```
inoremap ><Tab> ><Esc>?<[a-z]<CR>lyiwo</<C-r>"><Esc>O 
```

**示例使用**

类型：

```
<div class="foo">[Tab] 
```

结果：

```
<div class="foo">
  |
<div> 
```

where`|`表示光标位置

作为添加结束标记内联而不是块样式的示例：

```
inoremap ><Tab> ><Esc>?<[a-z]<CR>lyiwh/[^%]><CR>la</<C-r>"><Esc>F<i 
```

**示例使用**

类型：

```
<div class="foo">[Tab] 
```

结果：

```
<div class="foo">|<div> 
```

where`|`表示光标位置

确实，上述两个示例都依赖于`>[Tab]`发出结束标签的信号（这意味着您必须选择内联**或**块样式）。就个人而言，我使用块样式 with`>[Tab]`和内联样式 with `>>`。

# gcc - 在 32 位模式下编译 gcc 原子操作时出现链接错误

> ID：130740
> 
> 赞同：17
> 
> 时间：2008-09-25T00:11:59.907
> 
> 标签：gcc, linker, atomic

我有以下程序：

```
~/test> cat test.cc
int main()
{
  int i = 3;
  int j = __sync_add_and_fetch(&i, 1);
  return 0;
} 
```

我在多 CPU 64 位 Intel 机器上运行的 Linux 上使用 GCC 4.2.2 编译这个程序：

```
~/test> uname --all
Linux doom 2.6.9-67.ELsmp #1 SMP Wed Nov 7 13:56:44 EST 2007 x86_64 x86_64 x86_64 GNU/Linux 
```

当我在 64 位模式下编译程序时，它可以正常编译和链接：

```
~/test> /share/tools/gcc-4.2.2/bin/g++ test.cc
~/test> 
```

当我在 32 位模式下编译它时，我收到以下错误：

```
~/test> /share/tools/gcc-4.2.2/bin/g++ -m32 test.cc
/tmp/ccEVHGkB.o(.text+0x27): In function `main':
: undefined reference to `__sync_add_and_fetch_4'
collect2: ld returned 1 exit status
~/test> 
```

虽然我永远不会真正在 32 位处理器上运行，但我确实需要一个 32 位可执行文件，以便可以链接一些 32 位库。

我的两个问题是：

1.  为什么在 32 位模式下编译时会出现链接错误？

2.  有没有办法让程序编译和链接，同时仍然能够与 32 位库链接？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-25T00:33:39.450

Dan Udey 的回答很接近，事实上接近到足以让我找到真正的解决方案。

根据手册页，“-mcpu”是“-mtune”的已弃用同义词，仅表示“针对特定 CPU 进行优化（但仍可在较旧的 CPU 上运行，尽管优化程度较低）”。我试过这个，它并没有解决问题。

但是，“-march=”表示“为特定 CPU 生成代码（并且不在旧 CPU 上运行）”。当我尝试这样做时，它解决了问题：指定 i486 或更好的 CPU 消除了链接错误。

```
~/test> /share/tools/gcc-4.2.2/bin/g++ -m32  test.cc
/tmp/ccYnYLj6.o(.text+0x27): In function `main':
: undefined reference to `__sync_add_and_fetch_4'
collect2: ld returned 1 exit status

~/test> /share/tools/gcc-4.2.2/bin/g++ -m32 -march=i386 test.cc
/tmp/ccOr3ww8.o(.text+0x22): In function `main':
: undefined reference to `__sync_add_and_fetch_4'
collect2: ld returned 1 exit status

~/test> /share/tools/gcc-4.2.2/bin/g++ -m32 -march=i486 test.cc

~/test> /share/tools/gcc-4.2.2/bin/g++ -m32 -march=pentium test.cc 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-25T00:18:46.130

从[Atomic Builtins 的 GCC 页面](http://gcc.gnu.org/onlinedocs/gcc-4.1.0/gcc/Atomic-Builtins.html#Atomic-Builtins)：

> 并非所有目标处理器都支持所有操作。如果无法在目标处理器上执行特定操作，则会生成警告并调用外部函数。外部函数将与内置函数具有相同的名称，并带有一个附加后缀“_n”，其中 n 是数据类型的大小。

从您的编译器输出来看，它指的是`__sync_add_and_fetch_4`，这就是正在发生的事情。出于某种原因，GCC 没有正确生成外部函数。

这可能就是为什么您只在 32 位模式下收到错误的原因 - 当为 64 位模式编译时，它会更紧密地为您的处理器编译。在为 32 位编译时，它很可能会使用原生不支持这些功能的通用架构（例如 i386）。尝试通过 -mcpu 为您的芯片系列（Xeon、Core 2 等）指定特定架构，看看是否可行。

如果没有，您将不得不弄清楚为什么 GCC 不包含它应该生成的适当函数。

# c# - 基于单选按钮交换两个 .NET 控件的最佳方式

> ID：130748
> 
> 赞同：0
> 
> 时间：2008-09-25T00:16:19.117
> 
> 标签：c#, .net, winforms

我有一个表单，其中有两个单选按钮和两个可互换的控件（由一个 ListView 和几个按钮组成）。根据选择的单选按钮，我想向用户显示正确的控件。

我现在这样做的方式只是加载两个控件并设置一个 OnRadioButtonSelectionChanged() 方法，该方法在表单加载（以设置初始状态）时调用，并且在任何时候更改选择。此方法只是将每个控件上的可见属性设置为适当的值。

这似乎工作得很好，但我很好奇是否有更好或更常见的方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T00:31:23.683

是的，我就是这么干的。我会将两个单选按钮的 CheckedChanged 事件设置为指向单个事件处理程序，并放置以下代码以换出可见控件。

```
private void OnRadioButtonCheckedChanged(object sender, EventArgs e)
{
    Control1.Visible = RadioButton1.Checked;
    Control2.Visible = RadioButton2.Checked;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T16:49:48.960

那么你也可以使用数据绑定......对我来说似乎更优雅一些。假设您有两个单选按钮“rbA”和“rbB”以及两个文本框“txtA”和“txtB”。并且您希望 txtA 仅在检查 rbA 时可见，而 txtB 仅在检查 rbB 时可见。你可以这样做：

```
private void Form1_Load(object sender, EventArgs e)
{
    txtA.DataBindings.Add("Visible", rbA, "Checked");
    txtB.DataBindings.Add("Visible", rbB, "Checked");
} 
```

但是......我观察到使用 UserControls 而不是 TextBoxes 会破坏功能，我应该在网上阅读为什么......

稍后编辑：

数据绑定有两种方式！：如果您以编程方式（从其他地方）将 txtA 的可见性设置为 false，则 rbA 将变为未选中状态。这就是数据绑定的美妙之处。

# sql-server - 上次执行存储过程的时间

> ID：130753
> 
> 赞同：18
> 
> 时间：2008-09-25T00:18:42.620
> 
> 标签：sql-server, stored-procedures, sql-server-2000

在 Sql Server 2000 上，有没有办法找出存储过程最后一次执行的日期和时间？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-25T00:20:52.180

如果存储过程仍在过程缓存中，您可以通过查询 sys.dm_exec_query_stats DMV 找到它最后一次执行的时间。在此示例中，我还交叉应用到 sys.dm_exec_query_plan DMF 以限定对象 ID：

```
declare @proc_nm sysname

-- select the procedure name here
set @proc_nm = 'usp_test'

select s.last_execution_time
from sys.dm_exec_query_stats s
cross apply sys.dm_exec_query_plan (s.plan_handle) p
where object_name(p.objectid, db_id('AdventureWorks')) = @proc_nm 
```

[[来源]](http://joesack.com/WordPress/?p=101)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-25T00:19:31.060

恐怕不是没有记录或跟踪

# python - 从 Python 脚本中请求 UAC 提升？

> ID：130763
> 
> 赞同：111
> 
> 时间：2008-09-25T00:22:26.857
> 
> 标签：python, windows, windows-vista, uac

我希望我的 Python 脚本在 Vista 上复制文件。当我从普通`cmd.exe`窗口运行它时，不会产生错误，但不会复制文件。如果我以`cmd.exe`“管理员身份”运行，然后运行我的脚本，它就可以正常工作。

这是有道理的，因为用户帐户控制 (UAC) 通常会阻止许多文件系统操作。

有没有一种方法可以从 Python 脚本中调用 UAC 提升请求（那些对话框会说“某某应用程序需要管理员访问权限，可以吗？”）

如果这是不可能的，有没有办法我的脚本至少可以检测到它没有被提升，所以它可以优雅地失败？

* * *

## 回答 #1

> 赞同：131
> 
> 时间：2017-01-30T07:10:56.903

截至 2017 年，实现这一目标的简单方法如下：

```
import ctypes, sys

def is_admin():
    try:
        return ctypes.windll.shell32.IsUserAnAdmin()
    except:
        return False

if is_admin():
    # Code of your program here
else:
    # Re-run the program with admin rights
    ctypes.windll.shell32.ShellExecuteW(None, "runas", sys.executable, " ".join(sys.argv), None, 1) 
```

如果您使用的是 Python 2.x，则应将最后一行替换为：

```
ctypes.windll.shell32.ShellExecuteW(None, u"runas", unicode(sys.executable), unicode(" ".join(sys.argv)), None, 1) 
```

另请注意，如果您将 python 脚本转换为可执行文件（使用`py2exe`, `cx_freeze`,等工具`pyinstaller`），那么您应该在第四个参数中使用`sys.argv[1:]`而不是。`sys.argv`

这里的一些优点是：

*   不需要外部库。它只使用`ctypes`和`sys`来自标准库。
*   适用于 Python 2 和 Python 3。
*   无需修改文件资源，也无需创建清单文件。
*   如果您不在 if/else 语句下面添加代码，则该代码将永远不会被执行两次。
*   您可以在最后一行获取 API 调用的返回值，并在失败时执行操作（代码 <= 32）。[在此处](https://docs.microsoft.com/en-us/windows/win32/api/shellapi/nf-shellapi-shellexecutea?redirectedfrom=MSDN#return-value)检查可能的返回值。
*   您可以通过修改第六个参数来更改衍生进程的显示方法。

底层 ShellExecute 调用的文档在[这里](https://msdn.microsoft.com/en-us/library/windows/desktop/bb762153%28v=vs.85%29.aspx?f=255&MSPPError=-2147217396)。

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2012-07-31T18:09:35.973

我花了一点时间才让 dguaraglia 的答案起作用，所以为了节省其他人的时间，这就是我为实现这个想法所做的事情：

```
import os
import sys
import win32com.shell.shell as shell
ASADMIN = 'asadmin'

if sys.argv[-1] != ASADMIN:
    script = os.path.abspath(sys.argv[0])
    params = ' '.join([script] + sys.argv[1:] + [ASADMIN])
    shell.ShellExecuteEx(lpVerb='runas', lpFile=sys.executable, lpParameters=params)
    sys.exit(0) 
```

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2008-09-25T02:01:34.263

似乎暂时无法提升应用程序权限以执行特定任务。Windows 需要在程序启动时知道应用程序是否需要某些权限，并在应用程序执行任何*需要*这些权限的任务时要求用户确认。有两种方法可以做到这一点：

1.  编写一个清单文件，告诉 Windows 应用程序可能需要一些权限
2.  从另一个程序内部以提升的权限运行应用程序

这[两篇](http://www.codeproject.com/KB/vista-security/UAC__The_Definitive_Guide.aspx) [文章](http://msdn.microsoft.com/en-gb/magazine/cc163486.aspx)更详细地解释了它是如何工作的。

如果您不想为 CreateElevatedProcess API 编写一个讨厌的 ctypes 包装器，我会做的是使用 Code Project 文章中解释的 ShellExecuteEx 技巧（Pywin32 带有一个用于 ShellExecute 的包装器）。如何？像这样的东西：

当您的程序启动时，它会检查它是否具有管理员权限，如果没有，它会使用 ShellExecute 技巧自行运行并立即退出，如果有，则执行手头的任务。

当您将程序描述为“脚本”时，我想这足以满足您的需求。

干杯。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2019-10-22T23:55:46.060

只需添加这个答案，以防其他人像我一样被谷歌搜索引导到这里。`elevate`我在我的 Python 脚本中使用了该模块，并在 Windows 10 中使用管理员权限执行了该脚本。

[https://pypi.org/project/elevate/](https://pypi.org/project/elevate/)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2017-03-14T13:35:42.277

以下示例基于**MARTIN DE LA FUENTE SAAVEDRA 的**出色工作和公认的答案。特别介绍了两个枚举。第一个允许轻松指定如何打开提升的程序，第二个有助于在需要轻松识别错误时提供帮助。请注意，如果您希望将所有命令行参数传递给新进程，`sys.argv[0]`则可能应替换为函数调用：`subprocess.list2cmdline(sys.argv)`.

```
#! /usr/bin/env python3
import ctypes
import enum
import subprocess
import sys

# Reference:
# msdn.microsoft.com/en-us/library/windows/desktop/bb762153(v=vs.85).aspx

# noinspection SpellCheckingInspection
class SW(enum.IntEnum):
    HIDE = 0
    MAXIMIZE = 3
    MINIMIZE = 6
    RESTORE = 9
    SHOW = 5
    SHOWDEFAULT = 10
    SHOWMAXIMIZED = 3
    SHOWMINIMIZED = 2
    SHOWMINNOACTIVE = 7
    SHOWNA = 8
    SHOWNOACTIVATE = 4
    SHOWNORMAL = 1

class ERROR(enum.IntEnum):
    ZERO = 0
    FILE_NOT_FOUND = 2
    PATH_NOT_FOUND = 3
    BAD_FORMAT = 11
    ACCESS_DENIED = 5
    ASSOC_INCOMPLETE = 27
    DDE_BUSY = 30
    DDE_FAIL = 29
    DDE_TIMEOUT = 28
    DLL_NOT_FOUND = 32
    NO_ASSOC = 31
    OOM = 8
    SHARE = 26

def bootstrap():
    if ctypes.windll.shell32.IsUserAnAdmin():
        main()
    else:
       # noinspection SpellCheckingInspection
        hinstance = ctypes.windll.shell32.ShellExecuteW(
            None,
            'runas',
            sys.executable,
            subprocess.list2cmdline(sys.argv),
            None,
            SW.SHOWNORMAL
        )
        if hinstance <= 32:
            raise RuntimeError(ERROR(hinstance))

def main():
    # Your Code Here
    print(input('Echo: '))

if __name__ == '__main__':
    bootstrap() 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-08-26T15:03:36.627

认识到这个问题是几年前提出的，我认为frmdstryr 使用他的模块 pywinutils在[github上提供了一个更优雅的解决方案：](https://github.com/frmdstryr/pywinutils)

摘抄：

```
import pythoncom
from win32com.shell import shell,shellcon

def copy(src,dst,flags=shellcon.FOF_NOCONFIRMATION):
    """ Copy files using the built in Windows File copy dialog

    Requires absolute paths. Does NOT create root destination folder if it doesn't exist.
    Overwrites and is recursive by default 
    @see http://msdn.microsoft.com/en-us/library/bb775799(v=vs.85).aspx for flags available
    """
    # @see IFileOperation
    pfo = pythoncom.CoCreateInstance(shell.CLSID_FileOperation,None,pythoncom.CLSCTX_ALL,shell.IID_IFileOperation)

    # Respond with Yes to All for any dialog
    # @see http://msdn.microsoft.com/en-us/library/bb775799(v=vs.85).aspx
    pfo.SetOperationFlags(flags)

    # Set the destionation folder
    dst = shell.SHCreateItemFromParsingName(dst,None,shell.IID_IShellItem)

    if type(src) not in (tuple,list):
        src = (src,)

    for f in src:
        item = shell.SHCreateItemFromParsingName(f,None,shell.IID_IShellItem)
        pfo.CopyItem(item,dst) # Schedule an operation to be performed

    # @see http://msdn.microsoft.com/en-us/library/bb775780(v=vs.85).aspx
    success = pfo.PerformOperations()

    # @see sdn.microsoft.com/en-us/library/bb775769(v=vs.85).aspx
    aborted = pfo.GetAnyOperationsAborted()
    return success is None and not aborted 
```

这利用了 COM 界面，并通过熟悉的对话框提示自动指示需要管理员权限，如果您正在复制到需要管理员权限的目录，您会看到该对话框提示，并且还在复制操作期间提供典型的文件进度对话框。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-09-24T13:43:33.283

这可能无法完全回答您的问题，但您也可以尝试使用 Elevate Command Powertoy 以使用提升的 UAC 权限运行脚本。

[http://technet.microsoft.com/en-us/magazine/2008.06.elevation.aspx](http://technet.microsoft.com/en-us/magazine/2008.06.elevation.aspx)

我认为如果你使用它，它看起来像“提升 python yourscript.py”

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-04-02T19:56:40.883

您可以在某处创建快捷方式并作为目标使用：python yourscript.py 然后在属性和高级选择下以管理员身份运行。

当用户执行快捷方式时，它会要求他们提升应用程序。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2015-12-11T05:34:25.443

Jorenko 上述工作的一个变体允许提升的进程使用相同的控制台（但请参阅下面的评论）：

```
def spawn_as_administrator():
    """ Spawn ourself with administrator rights and wait for new process to exit
        Make the new process use the same console as the old one.
          Raise Exception() if we could not get a handle for the new re-run the process
          Raise pywintypes.error() if we could not re-spawn
        Return the exit code of the new process,
          or return None if already running the second admin process. """
    #pylint: disable=no-name-in-module,import-error
    import win32event, win32api, win32process
    import win32com.shell.shell as shell
    if '--admin' in sys.argv:
        return None
    script = os.path.abspath(sys.argv[0])
    params = ' '.join([script] + sys.argv[1:] + ['--admin'])
    SEE_MASK_NO_CONSOLE = 0x00008000
    SEE_MASK_NOCLOSE_PROCESS = 0x00000040
    process = shell.ShellExecuteEx(lpVerb='runas', lpFile=sys.executable, lpParameters=params, fMask=SEE_MASK_NO_CONSOLE|SEE_MASK_NOCLOSE_PROCESS)
    hProcess = process['hProcess']
    if not hProcess:
        raise Exception("Could not identify administrator process to install drivers")
    # It is necessary to wait for the elevated process or else
    #  stdin lines are shared between 2 processes: they get one line each
    INFINITE = -1
    win32event.WaitForSingleObject(hProcess, INFINITE)
    exitcode = win32process.GetExitCodeProcess(hProcess)
    win32api.CloseHandle(hProcess)
    return exitcode 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-04-10T16:52:42.050

`__file__`这主要是对 Jorenko 答案的升级，它允许在 Windows 中使用带空格的参数，但在 Linux 上也应该可以很好地工作 :) 此外，由于我们不使用但`sys.argv[0]`作为可执行文件，因此可以与 cx_freeze 或 py2exe 一起使用

[编辑] 免责声明：本文中的代码已过时。 **我已将海拔代码作为 python 包发布。** 安装`pip install command_runner`

用法：

```
from command_runner.elevate import elevate

def main():
    """My main function that should be elevated"""
    print("Who's the administrator, now ?")

if __name__ == '__main__':
    elevate(main) 
```

[/编辑]

```
import sys,ctypes,platform

def is_admin():
    try:
        return ctypes.windll.shell32.IsUserAnAdmin()
    except:
        raise False

if __name__ == '__main__':

    if platform.system() == "Windows":
        if is_admin():
            main(sys.argv[1:])
        else:
            # Re-run the program with admin rights, don't use __file__ since py2exe won't know about it
            # Use sys.argv[0] as script path and sys.argv[1:] as arguments, join them as lpstr, quoting each parameter or spaces will divide parameters
            lpParameters = ""
            # Litteraly quote all parameters which get unquoted when passed to python
            for i, item in enumerate(sys.argv[0:]):
                lpParameters += '"' + item + '" '
            try:
                ctypes.windll.shell32.ShellExecuteW(None, "runas", sys.executable, lpParameters , None, 1)
            except:
                sys.exit(1)
    else:
        main(sys.argv[1:]) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-26T11:54:18.390

如果您的脚本始终需要管理员权限，则：

```
runas /user:Administrator "python your_script.py" 
```

# variables - 一个名为 i 的变量是不可接受的吗？

> ID：130775
> 
> 赞同：16
> 
> 时间：2008-09-25T00:24:44.103
> 
> 标签：variables, coding-style, iterator, naming-conventions

就变量命名约定而言，应该命名迭代器`i`还是更语义化的东西`count`？如果你不使用`i`，为什么不呢？如果您认为这`i`是可以接受的，是否存在不应该使用它的迭代案例？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-09-25T00:32:27.627

取决于我想的上下文。如果您在某个集合中循环遍历一组对象，那么从上下文中您正在做什么应该是相当明显的。

```
for(int i = 0; i < 10; i++)
{
    // i is well known here to be the index
    objectCollection[i].SomeProperty = someValue;
} 
```

但是，如果从上下文中不能立即清楚您在做什么，或者如果您正在修改索引，则应该使用更能说明用法的变量名称。

```
for(int currentRow = 0; currentRow < numRows; currentRow++)
{
    for(int currentCol = 0; currentCol < numCols; currentCol++)
    {
        someTable[currentRow][currentCol] = someValue;
    }
} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-25T00:30:41.687

“i”对程序员来说*意味着*“循环计数器”。它没有任何问题。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-25T00:31:32.887

这是另一个完全没问题的例子：

```
foreach (Product p in ProductList)
{
    // Do something with p
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-25T00:31:30.343

我倾向于将 i、j、k 用于非常本地化的循环（就源代码行数而言仅存在很短的一段时间）。对于存在于较大源区域中的变量，我倾向于使用更详细的名称，这样我就可以看到它们的用途，而无需在代码中进行搜索。

顺便说一句，我认为这些命名约定来自早期的 Fortran 语言，我是第一个整数变量（A - H 是浮点数）？

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-25T00:33:30.510

`i`是可以接受的，可以肯定的。然而，一个学期我从一位 C++ 老师那里学到了很多东西，他拒绝了对每个变量都没有描述性名称的代码。描述性地命名一切的简单行为迫使我更加努力地思考我的代码，并且在那门课程之后我编写了更好的程序，不是来自学习 C++，而是来自学习命名一切。*Code Complete*在这个主题上有一些好话。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-25T01:43:47.847

**我**很好，但这样的事情不是：

```
for (int i = 0; i < 10; i++)
{
    for (int j = 0; j < 10; j++)
    {
        string s = datarow[i][j].ToString(); // or worse
    }
} 
```

程序员在不经意间交换代码中的 i 和 j 是很常见的，尤其是当他们视力不好或他们的 Windows 主题是“热狗”时。对我来说，这总是一种“代码味道”——如果没有搞砸，这种情况很少见。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-25T02:00:02.237

i 是如此常见以至于它是可以接受的，即使对于喜欢描述性变量名称的人也是如此。

绝对不可接受的（在我的书中是一个罪过）是在任何其他上下文中使用 i、j 或 k，而不是作为循环中的整数索引......例如

```
foreach(Input i in inputs)
{
    Process(i);

} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-25T00:26:27.003

我绝对可以接受。不知道我需要做出什么样的理由——但我确实一直在使用它，其他非常受人尊敬的程序员也这样做。

社会验证，我猜:)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-25T00:27:02.820

是的，事实上它是首选，因为任何阅读您的代码的程序员都会明白它只是一个迭代器。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-25T00:36:21.673

使用 i 而不是更具体的变量名有什么价值？为了节省 1 秒或 10 秒，或者甚至可能，甚至 30 秒的思考和打字？

使用 i 的成本是多少？也许什么都没有。也许代码很简单，使用 i 就可以了。但也许，也许，使用 i 将迫使未来使用此代码的开发人员不得不思考片刻“我在这里的意思是什么？” 他们将不得不思考：“它是一个索引、一个计数、一个偏移量还是一个标志？” 他们将不得不思考：“这种变化是否安全，是否正确，我会落后 1 分吗？”

在编写代码时使用 i 可以节省时间和精力，但最终可能会在未来花费更多的精力，甚至可能由于误解代码而导致无意中引入缺陷。

一般来说，大多数软件开发都是维护和扩展，因此阅读代码所花费的时间将大大超过编写代码所花费的时间。

很容易养成在任何地方使用有意义的名字的习惯，一旦你养成了这个习惯，用有意义的名字编写代码只需要几秒钟，但是你的代码更容易阅读、更容易理解等等显然是正确的。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-25T00:37:54.150

我将 i 用于短循环。

没问题的原因是，我发现有人可以看到带有初始化程序的迭代器类型声明，然后在三行之后声称不清楚该变量代表什么，这完全令人难以置信。他们只是在假装，因为他们已经决定“有意义的变量名”必须意味着“长变量名”。

我实际这样做的原因是，我发现使用与手头的特定任务无关的东西，而且我只会在很小的范围内使用，这样我就不用担心我可能会使用一个具有误导性或模棱两可的名称，或者有一天会在更大范围内对其他东西有用。它是“i”而不是“q”或“count”的原因只是从数学中借来的惯例。

如果出现以下情况，我不使用 i：

*   循环体不小，或者
*   除了从范围开始到循环结束的前进（或后退）之外，迭代器执行任何操作：

i 不一定必须以 1 为增量，只要增量一致且清晰，当然可能会在 iterand 结束之前停止，但如果它改变方向，或者没有被循环的迭代修改（包括在前向循环中对 iterator.insertAfter() 的恶意使用），我尽量记住使用不同的东西。这表明“这不仅仅是一个平凡的循环变量，因此这可能不是一个平凡的循环”。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-25T00:29:59.443

如果“更语义化的东西”是“迭代器”，那么没有理由不使用 i；这是一个很好理解的成语。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-25T11:01:08.223

我认为我在 for 循环情况下是完全可以接受的。我一直觉得这是非常标准的，当我在这种情况下使用时，从来没有真正遇到过解释问题。foreach-loops 变得有点棘手，我认为这真的取决于你的情况。我很少在 foreach 中使用 i，仅在 for 循环中使用，因为我发现 i 在这些情况下太不具描述性了。对于 foreach 我尝试使用正在循环的对象类型的缩写。例如：

```
foreach(DataRow dr in datatable.Rows)
{
    //do stuff to/with datarow dr here
} 
```

无论如何，只是我的 0.02 美元。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-25T00:26:14.553

如果您将其命名为描述它正在循环的内容，它会有所帮助。但我通常只使用 i.

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-25T00:28:40.227

只要您使用 i 来计算循环，或者使用从 0（或 1，取决于 PL）到 n 的索引的一部分，那么我会说 i 很好。

否则它可能很容易命名 i 一些有意义的东西，它不仅仅是一个索引。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-25T00:32:02.900

我应该指出 i 和 j 也是矩阵索引的数学符号。通常，您正在遍历一个数组。所以这是有道理的。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-25T00:32:41.963

只要您在一个简单的循环中临时使用它，并且很明显您在做什么，当然可以。也就是说，没有其他短词可以代替吗？

`i`被广泛称为循环迭代器，所以如果你在循环之外使用它，你实际上更有可能混淆维护程序员，但如果你使用更具描述性的东西（如`filecounter`），它会使代码更好。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-25T00:38:56.020

这取决于。如果您正在迭代某些特定的数据集，那么我认为使用描述性名称更有意义。（例如，`filecounter`正如丹建议的那样）。

但是，如果您正在执行任意循环，则`i`可以接受。正如一位工作伙伴向我描述的那样 -`i`是一种约定，意思是“这个变量只被`for`循环构造修改。如果这不是真的，不要使用`i`”

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-25T00:39:55.957

将 i、j、k 用于 INTEGER 循环计数器可以追溯到 FORTRAN 的早期。
只要它们是整数计数，就我个人而言，我对它们没有任何问题。
但后来我在 FORTRAN 上长大！

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-09-25T16:46:11.890

我的感觉是使用单个字母的*概念*对于“简单”循环来说很好，但是，我很久以前就学会了使用双字母并且效果很好。

我上周问了一个[类似的问题，以下是](https://stackoverflow.com/questions/101070)[我自己回答](https://stackoverflow.com/questions/101070#101071)的一部分：

```
// recommended style              ●    // "typical" single-letter style
                                  ●
for (ii=0; ii<10; ++ii) {         ●    for (i=0; i<10; ++i) {
    for (jj=0; jj<10; ++jj) {     ●        for (j=0; j<10; ++j) {
        mm[ii][jj] = ii * jj;     ●             m[i][j] = i * j;
    }                             ●        }
}                                 ●    }
```

如果好处不是很明显：在代码中搜索任何一个字母都会发现很多*不是*你想要的东西。该字母`i`经常出现在不是您要查找的变量的代码中。

我已经这样做了至少10年了。

请注意，很多人评论说上述任何一个/两个都是“丑陋的”......

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2010-11-03T17:44:28.310

我要反对谷物，说不。

对于说“我被理解为迭代器”的人群，这可能是真的，但对我来说，这相当于“将值 5 分配给变量 Y”之类的评论。像评论这样的变量名称应该解释为什么/什么不是如何。

要使用先前答案中的示例：

```
for(int i = 0; i < 10; i++)
{
    // i is well known here to be the index
    objectCollection[i].SomeProperty = someValue;
} 
```

像这样使用一个有意义的名字就更难了吗？

```
for(int objectCollectionIndex = 0; objectCollectionIndex  < 10; objectCollectionIndex ++)
{
    objectCollection[objectCollectionIndex].SomeProperty = someValue;
} 
```

授予（借用的）变量名称 objectCollection 的名称也很糟糕。

# database - 你能在关系数据库中使用决策表吗

> ID：130789
> 
> 赞同：2
> 
> 时间：2008-09-25T00:27:25.610
> 
> 标签：database

听说关系型数据库中的决策表在学术界已经有很多研究了。我也知道业务规则引擎使用决策表，许多 BPMS 也使用它们。我想知道今天人们是否在他们的关系数据库中使用决策表？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T10:22:16.913

决策表是一组条件和动作。条件可以很简单，您可以使用简单的“将列与该值匹配”字符串来表示它。或者一个条件可能非常复杂。类似地，一个操作可以像“将此值移动到一列”一样简单。或者该动作可能涉及多个部分或步骤，或者 - 嗯 - 任何东西。

SELECT 或 WHERE 子句中的 CASE 函数*是*一个决策表。这是关系数据库“中”的决策表的第一个示例。

您可以拥有一个“转换”表，其中包含具有旧值和替换值的列。然后，您可以编写一小段代码，如下所示。

```
def decision_table( aRow ):
    result= connection.execute( "SELECT replacement_value FROM transformation WHERE old_value = ?", aRow['somecolumn'] )
    replacement= result.fetchone()
    aRow['anotherColumn']= result['replacement_value'] 
```

决策表的每一行都有一个“匹配这个旧值”和“移动这个替换值”类型的定义。

决策表的“条件”部分必须在某处进行评估。您的应用程序就是发生这种情况的地方。您将从数据库中获取条件值。您将在某些函数中使用这些值来查看规则是否为真。

决策表的“动作”部分必须在某处执行；再次，您的应用程序会做一些事情。您将从数据库中获取操作值。您将使用这些值来插入、更新或删除其他值。

决策表一直在使用；它们一直存在于关系数据库中。每个表都需要一个高度定制的数据模型。它还需要一个独特的条件函数和动作过程。

它不能很好地概括。如果需要，您可以将 XML 存储在数据库中并调用一些规则引擎来解释和执行 BPEL 规则。在这种情况下，规则引擎进行条件和动作处理。

如果您愿意，您可以将 Python（或 Tcl 或其他）存储在数据库中。严重地。您将在 Python 中编写条件和操作。您将从数据库中获取它并运行 Python 代码片段。

很多选择。没有“学术”。事实上，基本条件 - 动作的东西一直都在做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T21:02:50.897

是否将决策表放入数据库取决于许多其他问题。

您的条件会在 RDBMS 内部或其他地方计算吗？如果可以设计出用于评估这些条件的数据，以及在 RDBMS 中评估它们的合适方法，那么这可能是一个好主意。也许您的操作也发生在您的数据库中，这将使其更具吸引力。

您的条件，甚至您的操作的执行可能在 RDBMS 的外部，但您仍然可以在内部保持条件和操作组合之间的连接。可能是因为你们中的大多数其他数据都在那里，而你们所拥有的只是一个位于其之上的 Web 服务器。

我可以想出两种对此建模的方法，这取决于您有多少条件（以及它们是否是二进制的），以及每个表的列容量是多少。

假设您有 6 个二元条件，这意味着您有 2^6 = 64 种可能的组合。然后，您可以为每个组合设置一列，为每个操作设置一行。

或者您可以有 16 个条件，这意味着您将拥有几乎无法计算的组合数量（实际上是 65536）。这是一个荒谬的列数。最好为每个条件设置一列，为每个操作设置一列，以及在每种可能的情况下执行 65536 行。每行代表一种情况以及在这种情况下要做什么。您使用的唯一数据类型是 bool。您还可以将这些布尔值打包成位掩码整数。

实际上，最好避免使用更大的决策表。分而治之，使用更多的表是更好的方法。通常，如果被要求就过多的条件发表意见，主题专家会感到疲倦。

决策表的强大之处在于建模阶段，开发人员和主题专家可以找出是否映射了所有可能的情况，并且不存在盲点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-18T23:49:06.283

我认为他们将有助于过去“面对面”通信的已经太多下降的状态——足够隐藏在屏幕后面，因为它是......从壁橱里出来，出去——得到照片。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-25T01:08:00.787

我会考虑使用对象数据库而不是传统的 RDBMS（关系数据库管理系统）。对象数据库旨在快速处理对象之间的层次关系，而在 RDBMS 中，您必须在多个表行甚至表中表示这些关系，因此您的查询（树遍历）会很慢。

# c# - GDI+ System.Drawing.Bitmap 给出错误参数间歇性无效

> ID：130790
> 
> 赞同：13
> 
> 时间：2008-09-25T00:27:34.550
> 
> 标签：c#, asp.net

我在执行此操作的 ASP.Net 应用程序中有一些 C# 代码：

位图 bmp = 新位图 (1184, 1900);

偶尔它会抛出异常“参数无效”。现在我一直在谷歌搜索，显然 GDI+ 因抛出随机异常而臭名昭著，很多人都遇到过这个问题，但没有人能解决它！我检查了系统，它有足够的 RAM 和交换空间。现在过去，如果我执行“iisreset”，那么问题就会消失，但过几天又会出现。但我不相信我造成了内存泄漏，因为正如我上面所说，有很多 ram+swap 空闲。

任何人有任何解决方案？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-04T20:26:33.327

停止使用 GDI+ 并开始使用 WPF Imaging 类 (.NET 3.0)。这些是对 GDI+ 类的主要清理，并针对性能进行了调整。此外，它还设置了一个“位图链”，使您可以轻松高效地对位图执行多项操作。

阅读有关[BitmapSource的更多信息](http://msdn.microsoft.com/en-us/library/system.windows.media.imaging.bitmapsource.aspx)

这是一个从等待接收一些像素的空白位图开始的示例：

```
using System.Windows.Media.Imaging;
class Program {
    public static void Main(string[] args) {
        var bmp = new WriteableBitmap(1184, 1900, 96.0, 96.0, PixelFormat.Bgr32, null);
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-08T02:14:00.100

对于任何感兴趣的人，我将使用的解决方案是来自 mono C# 发行版的 Mono.Cairo 库，而不是使用 system.drawing。如果我只是将 mono.cairo.dll、libcairo-2.dll、libpng13.dll 和 zlib1.dll 文件从 mono 的 windows 版本拖到与我的可执行文件相同的文件夹中，那么我可以使用 Visual Studio 2005 在 Windows 中进行开发和这一切都很好。

更新 - 我已经完成了上述操作，并对应用程序进行了压力测试，现在一切似乎运行顺利，并且启动时使用的内存减少了 200mb。很高兴。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-04T20:13:46.223

迄今为止，我在上下文中看到的所有内容都与内存泄漏/句柄泄漏有关。我建议你换一双新的眼睛来研究你的代码。

实际发生的情况是，图像会在未来随机放置，即使您已经在前一行代码中创建了它。这可能是因为内存/句柄泄漏（从我的代码中清除一些似乎有所改善，但不能完全解决此问题）。

因为这个错误是在应用程序使用一段时间后出现的，有时会使用大量内存，有时不会，我觉得垃圾收集器不遵守规则，因为一些与服务相关的特殊调整，这就是为什么微软洗他们的这个问题的手。

[http://blog.lavablast.com/post/2007/11/The-Mysterious-Parameter-Is-Not-Valid-Exception.aspx](http://blog.lavablast.com/post/2007/11/The-Mysterious-Parameter-Is-Not-Valid-Exception.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T01:00:05.033

您不仅需要足够的内存，还需要是连续的。随着时间的推移，内存变得碎片化，并且变得更难找到大块。除了从较小的位图构建图像之外，没有很多好的解决方案。

new Bitmap(x, y) 几乎只需要分配内存——假设您的程序没有以某种方式损坏（是否有任何可能损坏堆的不安全代码），那么我将从分配失败开始。需要一个连续的块是一个看似很小的分配可能会失败的原因。堆的碎片通常可以通过自定义分配器来解决——我认为这在 IIS 中不是一个好主意（或可能）。

要查看内存不足的错误，请尝试分配一个巨大的位图作为测试——看看它抛出了什么错误。

我见过的一种策略是预先分配一些大的内存块（在你的情况下是位图）并将它们视为一个池（获取并将它们返回到池中）。如果您只在短时间内需要它们，您可能只需在内存中保留一些并共享它们即可。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-28T23:29:22.667

我刚收到微软支持的回复。显然，如果你看这里：

[http://msdn.microsoft.com/en-us/library/system.drawing.aspx](http://msdn.microsoft.com/en-us/library/system.drawing.aspx)

您可以看到它说“System.Drawing 命名空间中的类不支持在 Windows 或 ASP.NET 服务中使用。尝试从这些应用程序类型之一中使用这些类可能会产生意外问题，例如服务性能下降和运行时异常。” 所以他们基本上是在洗手。看来他们承认 .Net 框架的这一部分是不可靠的。我有点失望。

接下来 - 任何人都可以推荐一个类似的库来打开一个 gif 文件，叠加一些文本，然后再次保存吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-12-02T10:35:21.973

不支持在 Windows 或 ASP.NET 服务中使用 System.Drawing 命名空间中的类

有关受支持的替代方案，请参阅[Windows Imaging Components](http://en.wikipedia.org/wiki/Windows_Imaging_Component) ( [msdn](http://msdn.microsoft.com/en-us/library/ee719654.aspx) )，这是一个具有讽刺意味的是 System.Drawing 所基于的本机库。

# design-patterns - 什么是依赖注入？

> ID：130794
> 
> 赞同：3398
> 
> 时间：2008-09-25T00:28:40.600
> 
> 标签：design-patterns, language-agnostic, dependency-injection, terminology

已经发布了几个关于[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)的特定问题的问题，例如何时使用它以及有哪些框架可供使用。然而，

**什么是依赖注入以及何时/为什么应该或不应该使用它？**

* * *

## 回答 #1

> 赞同：2585
> 
> 时间：2008-09-26T16:50:35.683

到目前为止，我发现的最好的定义是[James Shore](http://jamesshore.com/Blog/Dependency-Injection-Demystified.html)的定义：

> “依赖注入”是 5 美分概念的 25 美元术语。[...] 依赖注入意味着给一个对象它的实例变量。[...]。

Martin Fowler的[一篇文章](http://martinfowler.com/articles/injection.html)也可能被证明是有用的。

依赖注入基本上是提供对象需要的对象（它的依赖项），而不是让它自己构造它们。这是一种非常有用的测试技术，因为它允许模拟或删除依赖项。

可以通过多种方式（例如构造函数注入或 setter 注入）将依赖项注入到对象中。甚至可以使用专门的依赖注入框架（例如 Spring）来做到这一点，但它们当然不是必需的。您不需要这些框架来进行依赖注入。显式实例化和传递对象（依赖项）与框架注入一样好。

* * *

## 回答 #2

> 赞同：2075
> 
> 时间：2008-09-25T00:49:32.063

**依赖注入**是将依赖传递给其他**对象**或**框架**（依赖注入器）。

依赖注入使测试更容易。注入可以通过**构造函数**完成。

`SomeClass()`其构造函数如下：

```
public SomeClass() {
    myObject = Factory.getObject();
} 
```

**问题**：如果`myObject`涉及到磁盘访问或网络访问等复杂任务，则**很难**在`SomeClass()`. 程序员必须模拟`myObject`并可能**拦截**工厂调用。

**替代解决方案**：

*   `myObject`作为参数传入构造函数

```
public SomeClass (MyClass myObject) {
    this.myObject = myObject;
} 
```

`myObject`可以直接通过，这使得测试更容易。

*   一种常见的替代方法是定义一个**无所事事的构造函数**。依赖注入可以通过setter来完成。（h/t @MikeVella）。
*   [Martin Fowler](http://martinfowler.com/articles/injection.html#InterfaceInjection)记录了第三种选择（h/t @MarcDix），其中**类显式地为程序员希望注入的依赖项实现接口**。

在没有依赖注入的情况下，很难在单元测试中隔离组件。

2013 年，当我写这个答案时，这是[Google 测试博客](http://googletesting.blogspot.com/)上的一个主题。这对我来说仍然是最大的优势，因为程序员在他们的运行时设计中并不总是需要额外的灵活性（例如，对于服务定位器或类似的模式）。程序员经常需要在测试期间隔离类。

* * *

## 回答 #3

> 赞同：752
> 
> 时间：2011-05-22T04:01:24.207

*[我在松散耦合](https://en.wikipedia.org/wiki/Loose_coupling)方面发现了这个有趣的例子：*

资料来源：*[了解依赖注入](http://ganeshtiwaridotcomdotnp.blogspot.com/2011/05/understanding-dependency-injection-and.html)*

任何应用程序都由许多对象组成，这些对象相互协作以执行一些有用的事情。传统上，每个对象都负责获取自己对与之协作的依赖对象（依赖项）的引用。这导致了高度耦合的类和难以测试的代码。

例如，考虑一个`Car`对象。

A`Car`依靠车轮、发动机、燃料、电池等来运行。传统上，我们定义此类依赖对象的品牌以及对象的定义`Car`。

**没有依赖注入（DI）：**

```
class Car{
  private Wheel wh = new NepaliRubberWheel();
  private Battery bt = new ExcideBattery();

  //The rest
} 
```

在这里，`Car`对象*负责创建依赖对象。*

如果我们想`Wheel`在初始`NepaliRubberWheel()`穿刺之后改变它的依赖对象的类型——比如说——怎么办？我们需要用它的新依赖重新创建 Car 对象 say `ChineseRubberWheel()`，但只有`Car`制造商可以这样做。

***那么这`Dependency Injection`对我们有什么作用……？***

当使用依赖注入时，对象*在运行时而不是编译时（汽车制造时）*被赋予它们的依赖关系。这样我们现在就可以随时更改`Wheel`。这里，`dependency`( `wheel`) 可以在运行时注入`Car`。

**使用依赖注入后：**

在这里，我们在运行时**注入****依赖项**（Wheel 和 Battery）。因此，术语：*依赖注入。*我们通常依靠 Spring、Guice、Weld 等 DI 框架来创建依赖项并在需要的地方注入。

```
class Car{
  private Wheel wh; // Inject an Instance of Wheel (dependency of car) at runtime
  private Battery bt; // Inject an Instance of Battery (dependency of car) at runtime
  Car(Wheel wh,Battery bt) {
      this.wh = wh;
      this.bt = bt;
  }
  //Or we can have setters
  void setWheel(Wheel wh) {
      this.wh = wh;
  }
} 
```

**优点是：**

*   解耦对象的创建（换句话说，将使用与对象的创建分开）
*   能够替换依赖项（例如：Wheel、Battery）而不更改使用它的类（汽车）
*   提倡“代码接口而不是实现”原则
*   在测试期间创建和使用模拟依赖项的能力（如果我们想在测试期间使用车轮模拟而不是真实实例。我们可以创建模拟车轮对象并让 DI 框架注入到 Car）

* * *

## 回答 #4

> 赞同：280
> 
> 时间：2008-09-25T06:49:02.107

依赖注入是一种实践，其中对象的设计方式是从其他代码段接收对象的实例，而不是在内部构造它们。这意味着任何实现对象所需接口的对象都可以在不更改代码的情况下被替换，从而简化了测试，并提高了解耦性。

例如，考虑这些类：

```
public class PersonService {
  public void addManager( Person employee, Person newManager ) { ... }
  public void removeManager( Person employee, Person oldManager ) { ... }
  public Group getGroupByManager( Person manager ) { ... }
}

public class GroupMembershipService() {
  public void addPersonToGroup( Person person, Group group ) { ... }
  public void removePersonFromGroup( Person person, Group group ) { ... }
} 
```

在这个例子中，`PersonService::addManager`and的实现`PersonService::removeManager`需要一个实例`GroupMembershipService`来完成它的工作。如果没有依赖注入，传统的做法是`GroupMembershipService`在构造函数中实例化一个 new`PersonService`并在两个函数中使用该实例属性。但是，如果 的构造函数需要多个东西，或者更`GroupMembershipService`糟糕的是，需要在取决于。此外，到的链接被硬编码到，这意味着你不能“假装”`GroupMembershipService``PersonService``GroupMembershipService``GroupMembershipService``GroupMembershipService``PersonService``GroupMembershipService`出于测试目的，或在应用程序的不同部分使用策略模式。

使用依赖注入，`GroupMembershipService`您`PersonService`可以将其传递给`PersonService`构造函数，或者添加一个属性（getter 和 setter）来设置它的本地实例，而不是在 . 这意味着您`PersonService`不再需要担心如何创建 a `GroupMembershipService`，它只接受它给出的那些，并与它们一起工作。这也意味着任何是 的子类`GroupMembershipService`或实现`GroupMembershipService`接口的东西都可以“注入”到 中`PersonService`，并且`PersonService`不需要知道更改。

* * *

## 回答 #5

> 赞同：189
> 
> 时间：2011-01-06T18:33:39.763

公认的答案是一个很好的答案——但我想补充一点，DI 非常类似于在代码中避免硬编码常量的经典做法。

当您使用一些常量（如数据库名称）时，您会快速将其从代码内部移动到某个配置文件，并将包含该值的变量传递到需要它的地方。这样做的原因是这些常量通常比代码的其余部分更频繁地更改。例如，如果您想在测试数据库中测试代码。

在面向对象编程的世界中，DI 与此类似。那里的值而不是常量文字是整个对象-但是将创建它们的代码从类代码中移出的原因是相似的-对象的更改比使用它们的代码更频繁。需要进行此类更改的一个重要案例是测试。

* * *

## 回答 #6

> 赞同：168
> 
> 时间：2017-07-06T09:42:27.623

让我们尝试使用**Car**和**Engine**类的简单示例，任何汽车都需要引擎才能去任何地方，至少现在是这样。下面是没有依赖注入的代码的外观。

```
public class Car
{
    public Car()
    {
        GasEngine engine = new GasEngine();
        engine.Start();
    }
}

public class GasEngine
{
    public void Start()
    {
        Console.WriteLine("I use gas as my fuel!");
    }
} 
```

为了实例化 Car 类，我们将使用下面的代码：

```
Car car = new Car(); 
```

这段代码的问题是我们与 GasEngine 紧密耦合，如果我们决定将其更改为 ElectricityEngine，那么我们将需要重写 Car 类。应用程序越大，我们必须添加和使用新型引擎的问题和头痛就越多。

换句话说，这种方法是我们的​​高级 Car 类依赖于较低级别的 GasEngine 类，这违反了 SOLID 的依赖倒置原则 (DIP)。DIP 建议我们应该依赖抽象，而不是具体的类。因此，为了满足这一点，我们引入了 IEngine 接口并重写了如下代码：

```
 public interface IEngine
    {
        void Start();
    }

    public class GasEngine : IEngine
    {
        public void Start()
        {
            Console.WriteLine("I use gas as my fuel!");
        }
    }

    public class ElectricityEngine : IEngine
    {
        public void Start()
        {
            Console.WriteLine("I am electrocar");
        }
    }

    public class Car
    {
        private readonly IEngine _engine;
        public Car(IEngine engine)
        {
            _engine = engine;
        }

        public void Run()
        {
            _engine.Start();
        }
    } 
```

现在我们的 Car 类只依赖于 IEngine 接口，而不是引擎的具体实现。现在，唯一的技巧是我们如何创建 Car 的实例并为其提供一个实际的具体 Engine 类，例如 GasEngine 或 ElectricityEngine。这就是**依赖注入**的用武之地。

```
 Car gasCar = new Car(new GasEngine());
   gasCar.Run();
   Car electroCar = new Car(new ElectricityEngine());
   electroCar.Run(); 
```

在这里，我们基本上将我们的依赖项（Engine 实例）注入（传递）到 Car 构造函数。所以现在我们的类在对象和它们的依赖之间有了松散的耦合，我们可以很容易地添加新类型的引擎而不改变 Car 类。

**依赖注入**的主要好处是类更松散耦合，因为它们没有硬编码的依赖关系。这遵循上面提到的依赖倒置原则。类不是引用特定的实现，而是请求在构造类时提供给它们的抽象（通常是**接口）。**

> 所以说到底，**依赖注入**只是一种实现对象与其依赖之间松耦合的技术。与其直接实例化类执行其操作所需的依赖项，不如通过构造函数注入（最常见）向类提供依赖项。

此外，当我们有许多依赖项时，使用控制反转（IoC）容器是非常好的做法，我们可以告诉哪些接口应该映射到所有依赖项的哪些具体实现，并且我们可以让它在构造时为我们解决这些依赖项我们的对象。例如，我们可以在 IoC 容器的映射中指定**IEngine**依赖项应该映射到**GasEngine**类，当我们向 IoC 容器请求**Car**类的实例时，它会自动构造带有**GasEngine**依赖项的**Car**类通过了。

 ****更新：**最近观看了 Julie Lerman 的关于 EF Core 的课程，也喜欢她对 DI 的简短定义。

> 依赖注入是一种模式，允许您的应用程序动态地将对象注入到需要它们的类中，而无需强制这些类对这些对象负责。它允许您的代码更加松散耦合，并且 Entity Framework Core 插入到同一个服务系统中。

* * *

## 回答 #7

> 赞同：126
> 
> 时间：2012-10-22T04:47:39.320

假设你想去钓鱼：

*   如果没有依赖注入，您需要自己处理所有事情。你需要找一条船，买一根钓鱼竿，寻找诱饵，等等。当然有可能，但这会让你承担很多责任。用软件术语来说，这意味着您必须对所有这些东西进行查找。

*   通过依赖注入，其他人负责所有准备工作并为您提供所需的设备。您将收到（“被注射”）船、钓鱼竿和诱饵 - 都可以使用。

* * *

## 回答 #8

> 赞同：107
> 
> 时间：2016-05-05T11:53:32.470

[这](http://php-di.org/doc/understanding-di.html)是我见过的关于**依赖注入**和**依赖注入容器**最简单的解释：

# 没有依赖注入

*   应用程序需要 Foo（例如控制器），所以：
*   应用程序创建 Foo
*   应用程序调用 Foo
    *   Foo 需要 Bar（例如服务），所以：
    *   Foo 创建 Bar
    *   Foo 呼叫 Bar
        *   Bar 需要 Bim（服务、存储库……），所以：
        *   Bar 创建 Bim
        *   酒吧做点什么

# 依赖注入

*   应用需要Foo，需要Bar，需要Bim，所以：
*   应用程序创建 Bim
*   应用程序创建 Bar 并为其提供 Bim
*   应用程序创建 Foo 并给它 Bar
*   应用程序调用 Foo
    *   Foo 呼叫 Bar
        *   酒吧做点什么

# 使用依赖注入容器

*   应用程序需要 Foo 所以：
*   应用程序从容器中获取 Foo，所以：
    *   容器创建 Bim
    *   Container 创建 Bar 并给它 Bim
    *   Container 创建 Foo 并给它 Bar
*   应用程序调用 Foo
    *   Foo 呼叫 Bar
        *   酒吧做点什么

**依赖注入**和**依赖注入容器**是不同的东西：

*   依赖注入是一种编写更好代码的方法
*   DI Container 是帮助注入依赖项的工具

您不需要容器来进行依赖注入。但是，容器可以帮助您。

* * *

## 回答 #9

> 赞同：73
> 
> 时间：2020-01-27T09:42:44.730

在进行技术描述之前，首先用一个真实的例子来形象化它，因为你会发现很多技术资料来学习依赖注入，但大多数人无法理解它的核心概念。

在第一张图片中，假设您有一家拥有很多单位的**汽车厂。**汽车实际上是在**装配单元**中制造的，但它需要**发动机**、**座椅**和**车轮**。因此，**装配单元**依赖于这些所有单元，它们是工厂的**依赖项。**

您会觉得现在维护这个工厂的所有任务太复杂了，因为除了主要任务（在组装单元中组装汽车）您还必须专注于**其他单元**。现在维护成本非常高，而且厂房很大，所以要多花钱租。

现在，看第二张图。如果您发现一些供应商公司会以比您自己生产成本更低的价格为您提供**车轮**、**座椅**和**发动机**，那么现在您不需要在您的工厂制造它们。您现在可以为您的**装配单元**租用较小的建筑物，这将减少您的维护任务并降低您的额外租金成本。现在您也可以只专注于您的主要任务（汽车组装）。

现在我们可以说组装汽车的所有**依赖项都是从****供应商****注入**到工厂的。这是一个真实的***依赖注入（DI）***的例子。

 ****现在用技术术语来说，依赖注入是一种技术，一个对象（或静态方法）提供另一个对象的依赖项。因此，将创建对象的任务转移给其他人并直接使用依赖项称为依赖项注入。

[这](https://www.freecodecamp.org/news/a-quick-intro-to-dependency-injection-what-it-is-and-when-to-use-it-7578c84fa88f/)将帮助您现在通过技术解释来学习 DI。[这](http://tutorials.jenkov.com/dependency-injection/when-to-use-dependency-injection.html)将显示何时使用 DI 以及何时不应该使用[DI](https://softwareengineering.stackexchange.com/questions/135971/when-is-it-not-appropriate-to-use-the-dependency-injection-pattern)。

[![一站式汽车工厂](https://i.stack.imgur.com/E7OWM.png)](https://i.stack.imgur.com/E7OWM.png).

[![简单的汽车厂](https://i.stack.imgur.com/auqDX.png)](https://i.stack.imgur.com/auqDX.png)

* * *

## 回答 #10

> 赞同：62
> 
> 时间：2013-05-02T00:40:11.150

“依赖注入”不只是意味着使用参数化构造函数和公共设置器吗？

[James Shore 的文章显示了以下示例以供比较](http://www.jamesshore.com/Blog/Dependency-Injection-Demystified.html)。

> 没有依赖注入的构造函数：
> 
> ```
> public class Example { 
>   private DatabaseThingie myDatabase; 
> 
>   public Example() { 
>     myDatabase = new DatabaseThingie(); 
>   } 
> 
>   public void doStuff() { 
>     ... 
>     myDatabase.getData(); 
>     ... 
>   } 
> } 
> ```
> 
> 具有依赖注入的构造函数：
> 
> ```
> public class Example { 
>   private DatabaseThingie myDatabase; 
> 
>   public Example(DatabaseThingie useThisDatabaseInstead) { 
>     myDatabase = useThisDatabaseInstead; 
>   }
> 
>   public void doStuff() { 
>     ... 
>     myDatabase.getData(); 
>     ... 
>   } 
> } 
> ```

* * *

## 回答 #11

> 赞同：45
> 
> 时间：2016-10-28T20:30:22.057

使依赖注入概念易于理解。让我们以开关按钮为例来切换（开/关）灯泡。

## 没有依赖注入

Switch 需要事先知道我连接到哪个灯泡（硬编码依赖）。所以，

Switch -> PermanentBulb *//switch 直接接永久灯泡，不易测试*

[![](https://i.stack.imgur.com/cIt97.jpg)](https://i.stack.imgur.com/cIt97.jpg)

```
Switch(){
PermanentBulb = new Bulb();
PermanentBulb.Toggle();
} 
```

## 依赖注入

Switch只知道我需要打开/关闭传递给我的任何灯泡。所以，

Switch -> Bulb1 OR Bulb2 OR NightBulb（注入依赖）

[![](https://i.stack.imgur.com/NrXaF.jpg)](https://i.stack.imgur.com/NrXaF.jpg)

```
Switch(AnyBulb){ //pass it whichever bulb you like
AnyBulb.Toggle();
} 
```

修改开关和灯泡的[James](http://www.jamesshore.com/Blog/Dependency-Injection-Demystified.html)示例：

```
public class SwitchTest { 
  TestToggleBulb() { 
    MockBulb mockbulb = new MockBulb(); 

    // MockBulb is a subclass of Bulb, so we can 
    // "inject" it here: 
    Switch switch = new Switch(mockBulb); 

    switch.ToggleBulb(); 
    mockBulb.AssertToggleWasCalled(); 
  } 
}

public class Switch { 
  private Bulb myBulb; 

  public Switch() { 
    myBulb = new Bulb(); 
  } 

  public Switch(Bulb useThisBulbInstead) { 
    myBulb = useThisBulbInstead; 
  } 

  public void ToggleBulb() { 
    ... 
    myBulb.Toggle(); 
    ... 
  } 
}` 
```

* * *

## 回答 #12

> 赞同：37
> 
> 时间：2015-04-28T20:17:54.893

**什么是依赖注入（DI）？**

正如其他人所说，*依赖注入（DI）*消除了我们感兴趣的类（消费者类）所依赖的其他对象实例（在[UML 意义上](https://en.wikipedia.org/wiki/Class_diagram#Dependency)）的直接创建和生命周期管理的责任。这些实例被传递给我们的消费者类，通常作为构造函数参数或通过属性设置器（依赖对象实例化和传递给消费者类的管理通常由*控制反转（IoC）*容器执行，但这是另一个主题） .

**DI、DIP 和 SOLID**

具体来说，在 Robert C Martin 的[面向对象设计的 SOLID 原则](http://en.wikipedia.org/wiki/SOLID_(object-oriented_design))范式中，是[依赖倒置原则 (DIP)](http://en.wikipedia.org/wiki/Dependency_inversion_principle)`DI`的可能实现之一。[DIP 是](https://stackoverflow.com/q/27978841/314291)[口头禅](https://stackoverflow.com/q/27978841/314291)[-](https://stackoverflow.com/q/27978841/314291) 其他 DIP 实现包括服务定位器和插件模式。[`D``SOLID`](https://stackoverflow.com/q/27978841/314291)

DIP 的目标是解耦类之间紧密的、具体的依赖关系，而是通过抽象来放松耦合，这可以通过或来实现`interface`，具体取决于所使用的语言和方法。`abstract class``pure virtual class`

如果没有 DIP，我们的代码（我称之为“消费类”）直接耦合到一个具体的依赖项，并且通常还承担着知道如何获取和管理此依赖项实例的责任，即概念上：

```
"I need to create/use a Foo and invoke method `GetBar()`" 
```

而在应用 DIP 之后，要求放宽了，并且消除了获取和管理`Foo`依赖项生命周期的问题：

```
"I need to invoke something which offers `GetBar()`" 
```

**为什么使用 DIP（和 DI）？**

以这种方式解耦类之间的依赖关系可以*很容易地*用其他实现替换这些依赖类，这些实现也满足抽象的先决条件（例如，可以用相同接口的另一个实现切换依赖关系）。此外，正如其他人所提到的，通过 DIP 解耦类*的*最常见原因可能是允许单独测试消费类，因为现在可以对这些相同的依赖项进行存根和/或模拟。

DI 的一个后果是依赖对象实例的生命周期管理不再由消费类控制，因为依赖对象现在被传递到消费类（通过构造函数或 setter 注入）。

这可以通过不同的方式查看：

*   如果需要保留消费类对依赖项的生命周期控制，则可以通过将用于创建依赖类实例的（抽象）工厂注入到消费类中来重新建立控制。消费者将能够`Create`根据需要通过工厂上的 a 获取实例，并在完成后处置这些实例。
*   或者，依赖实例的生命周期控制可以交给一个 IoC 容器（下面有更多关于这个）。

**何时使用 DI？**

*   如果可能需要将依赖项替换为等效的实现，
*   任何时候您需要对一个类的方法进行单元测试，以隔离其依赖项，
*   依赖项生命周期的不确定性可能需要进行实验（例如，`MyDepClass`线程安全吗？如果我们将其设为单例并将相同的实例注入所有消费者会怎样？）

**例子**

这是一个简单的 C# 实现。鉴于以下消费类：

```
public class MyLogger
{
   public void LogRecord(string somethingToLog)
   {
      Console.WriteLine("{0:HH:mm:ss} - {1}", DateTime.Now, somethingToLog);
   }
} 
```

虽然看似无害，但它对另外两个类有两个依赖`static`，`System.DateTime`和`System.Console`一个非确定性的系统时钟。

然而，我们可以应用`DIP`到这个类，将时间戳作为依赖项抽象出来，并且`MyLogger`只耦合到一个简单的接口：

```
public interface IClock
{
    DateTime Now { get; }
} 
```

我们还可以放松对抽象的依赖`Console`，例如`TextWriter`. 依赖注入通常被实现为`constructor`注入（将抽象传递给依赖作为参数给消费类的构造函数）或`Setter Injection`（通过`setXyz()`setter 或定义的 .Net 属性传递依赖`{set;}`）。构造函数注入是首选，因为这样可以保证类在构造后处于正确状态，并允许将内部依赖字段标记为`readonly`(C#) 或`final`(Java)。所以在上面的例子中使用构造函数注入，这给我们留下了：

```
public class MyLogger : ILogger // Others will depend on our logger.
{
    private readonly TextWriter _output;
    private readonly IClock _clock;

    // Dependencies are injected through the constructor
    public MyLogger(TextWriter stream, IClock clock)
    {
        _output = stream;
        _clock = clock;
    }

    public void LogRecord(string somethingToLog)
    {
        // We can now use our dependencies through the abstraction 
        // and without knowledge of the lifespans of the dependencies
        _output.Write("{0:yyyy-MM-dd HH:mm:ss} - {1}", _clock.Now, somethingToLog);
    }
} 
```

（`Clock`需要提供一个具体的，当然可以恢复为`DateTime.Now`，并且这两个依赖项需要由 IoC 容器通过构造函数注入提供）

可以构建一个自动化的单元测试，它明确地证明我们的记录器工作正常，因为我们现在可以控制依赖关系 - 时间，我们可以监视书面输出：

```
[Test]
public void LoggingMustRecordAllInformationAndStampTheTime()
{
    // Arrange
    var mockClock = new Mock<IClock>();
    mockClock.Setup(c => c.Now).Returns(new DateTime(2015, 4, 11, 12, 31, 45));
    var fakeConsole = new StringWriter();

    // Act
    new MyLogger(fakeConsole, mockClock.Object)
        .LogRecord("Foo");

    // Assert
    Assert.AreEqual("2015-04-11 12:31:45 - Foo", fakeConsole.ToString());
} 
```

**下一步**

依赖注入总是与[控制反转容器（IoC）](http://martinfowler.com/articles/injection.html)相关联，以注入（提供）具体的依赖实例，并管理生命周期实例。在配置/引导过程中，`IoC`容器允许定义以下内容：

*   每个抽象和配置的具体实现之间的映射（例如*“任何时候消费者请求一个`IBar`，返回一个`ConcreteBar`实例”*）
*   可以为每个依赖项的生命周期管理设置策略，例如为每个消费者实例创建一个新对象，在所有消费者之间共享一个单例依赖实例，仅在同一个线程中共享相同的依赖实例等。
*   在 .Net 中，IoC 容器知道诸如协议之类的协议，并将根据配置的生命周期管理承担依赖关系`IDisposable`的责任。`Disposing`

通常，一旦 IoC 容器被配置/引导，它们就会在后台无缝运行，从而使编码人员可以专注于手头的代码，而不必担心依赖关系。

> DI 友好代码的关键是避免类的静态耦合，并且不使用 new() 来创建依赖项

根据上面的示例，依赖关系的解耦确实需要一些设计工作，并且对于开发人员来说，需要进行范式转变来打破`new`直接依赖依赖的习惯，而是信任容器来管理依赖关系。

但是好处很多，特别是在彻底测试您感兴趣的课程的能力方面。

**注意**`new ..()`： POCO / POJO / 序列化 DTO / 实体图 / 匿名 JSON 投影等的创建/映射/投影（通过） - 即“仅数据”类或记录 - 使用或从方法返回*不*被视为依赖项（在UML 意义）并且不受 DI 约束。用来`new`投影这些就好了。

* * *

## 回答 #13

> 赞同：27
> 
> 时间：2017-11-03T07:36:52.950

**以上所有答案都很好，我的目的是用简单的方式解释这个概念，以便任何没有编程知识的人也能理解这个概念**

依赖注入是帮助我们以更简单的方式创建复杂系统的设计模式之一。

我们可以在日常生活中看到这种模式的广泛应用。一些例子是磁带录音机、VCD、CD 驱动器等。

[![卷对卷便携式录音机，20 世纪中叶。](https://i.stack.imgur.com/Ubcrh.jpg)](https://i.stack.imgur.com/Ubcrh.jpg)

上图是 20 世纪中叶卷对卷便携式录音机的图像。[来源](https://www.britannica.com/technology/tape-recorder)。

录音机的主要目的是记录或播放声音。

在设计系统时，它需要一个卷轴来记录或播放声音或音乐。设计这个系统有两种可能性

1.  我们可以把卷轴放在机器里面
2.  我们可以为卷轴提供一个挂钩，可以放置它。

如果我们使用第一个，我们需要打开机器来更换卷轴。如果我们选择第二个，即为卷轴放置一个钩子，我们将获得通过更换卷轴播放任何音乐的额外好处。并且还减少了仅在卷轴中播放任何内容的功能。

同样，依赖注入是将依赖关系外部化以仅关注组件的特定功能的过程，以便可以将独立的组件耦合在一起以形成复杂的系统。

我们通过使用依赖注入获得的主要好处。

*   高内聚和松耦合。
*   外化依赖，只看责任。
*   将事物作为组件并组合成一个功能强大的大型系统。
*   它有助于开发高质量的组件，因为它们是独立开发的，并且经过了适当的测试。
*   如果一个组件出现故障，它有助于用另一个组件替换该组件。

现在，这些概念构成了编程世界中众所周知的框架的基础。Spring Angular 等是建立在这个概念之上的知名软件框架

依赖注入是一种用于创建其他对象所依赖的对象实例的模式，而在编译时不知道哪个类将用于提供该功能，或者只是将属性注入对象的方式称为依赖注入。

**依赖注入示例**

以前我们是这样写代码的

```
Public MyClass{
 DependentClass dependentObject
 /*
  At somewhere in our code we need to instantiate 
  the object with new operator  inorder to use it or perform some method.
  */ 
  dependentObject= new DependentClass();
  dependentObject.someMethod();
} 
```

使用依赖注入，依赖注入器将为我们取消实例化

```
Public MyClass{
 /* Dependency injector will instantiate object*/
 DependentClass dependentObject

 /*
  At somewhere in our code we perform some method. 
  The process of  instantiation will be handled by the dependency injector
 */ 

  dependentObject.someMethod();
} 
```

你也可以阅读

[控制反转和依赖注入之间的区别](https://stackoverflow.com/questions/26884881/difference-between-inversion-of-control-dependency-injection/41519414#41519414)

* * *

## 回答 #14

> 赞同：26
> 
> 时间：2013-09-23T16:28:27.860

依赖注入 (DI) 的全部意义在于保持应用程序源代码的**干净**和**稳定**：

*   **清除**依赖初始化代码
*   **稳定**，无论使用的依赖项如何

实际上，每个设计模式都会将关注点分开，以使未来的更改影响最小的文件。

DI 的具体领域是依赖配置和初始化的委托。

## 示例：带有 shell 脚本的 DI

如果您偶尔在 Java 之外工作，请回想一下`source`在许多脚本语言（Shell、Tcl 等，甚至`import`在 Python 中被滥用于此目的）中经常使用的方式。

考虑简单的`dependent.sh`脚本：

```
#!/bin/sh
# Dependent
touch         "one.txt" "two.txt"
archive_files "one.txt" "two.txt" 
```

该脚本是依赖的：它不会自行成功执行（`archive_files`未定义）。

您`archive_files`在`archive_files_zip.sh`实现脚本中定义（`zip`在这种情况下使用）：

```
#!/bin/sh
# Dependency
function archive_files {
    zip files.zip "$@"
} 
```

不是`source`直接在依赖项中 -ing 实现脚本，而是使用`injector.sh`包装两个“组件”的“容器”：

```
#!/bin/sh 
# Injector
source ./archive_files_zip.sh
source ./dependent.sh 
```

`archive_files` *依赖*项刚刚被*注入*到*依赖*脚本中。

您可以注入`archive_files`使用`tar`或实现的依赖项`xz`。

## 示例：删除 DI

如果`dependent.sh`脚本直接使用依赖，则该方法称为*依赖查找*（与*依赖注入*相反）：

```
#!/bin/sh
# Dependent

# dependency look-up
source ./archive_files_zip.sh

touch         "one.txt" "two.txt"
archive_files "one.txt" "two.txt" 
```

现在的问题是依赖的“组件”必须自己执行初始化。

“组件”的源代码既不**干净**也不**稳定**，因为依赖项初始化的每次更改都需要“组件”的源代码文件的新版本。

## 最后的话

DI 不像在 Java 框架中那样被广泛强调和普及。

但这是一种解决以下问题的通用方法：

*   应用程序**开发**（**单一**源代码发布生命周期）
*   应用程序**部署**（具有独立生命周期的**多个目标环境）**

仅将配置与*依赖项查找*一起使用并没有帮助，因为配置参数的数量可能会根据依赖项（例如新的身份验证类型）以及受支持的依赖项类型的数量（例如新的数据库类型）而改变。

* * *

## 回答 #15

> 赞同：21
> 
> 时间：2018-03-14T04:41:06.763

例如，我们有 2 个班级`Client`和`Service`. `Client`将使用`Service`

```
public class Service {
    public void doSomeThingInService() {
        // ...
    }
} 
```

## 没有依赖注入

**方式1）**

```
public class Client {
    public void doSomeThingInClient() {
        Service service = new Service();
        service.doSomeThingInService();
    }
} 
```

**方式2）**

```
public class Client {
    Service service = new Service();
    public void doSomeThingInClient() {
        service.doSomeThingInService();
    }
} 
```

**方式3）**

```
public class Client {
    Service service;
    public Client() {
        service = new Service();
    }
    public void doSomeThingInClient() {
        service.doSomeThingInService();
    }
} 
```

**1) 2) 3) 使用**

```
Client client = new Client();
client.doSomeThingInService(); 
```

**好处**

*   简单的

**缺点**

*   考试`Client`课难
*   当我们更改`Service`构造函数时，我们需要在所有地方更改代码创建`Service`对象

## 使用依赖注入

**方式一）**构造函数注入

```
public class Client {
    Service service;

    Client(Service service) {
        this.service = service;
    }

    // Example Client has 2 dependency 
    // Client(Service service, IDatabas database) {
    //    this.service = service;
    //    this.database = database;
    // }

    public void doSomeThingInClient() {
        service.doSomeThingInService();
    }
} 
```

*使用*

```
Client client = new Client(new Service());
// Client client = new Client(new Service(), new SqliteDatabase());
client.doSomeThingInClient(); 
```

**方式2）** Setter注入

```
public class Client {
    Service service;

    public void setService(Service service) {
        this.service = service;
    }

    public void doSomeThingInClient() {
        service.doSomeThingInService();
    }
} 
```

*使用*

```
Client client = new Client();
client.setService(new Service());
client.doSomeThingInClient(); 
```

**方式3）**接口注入

检查[https://en.wikipedia.org/wiki/Dependency_injection](https://en.wikipedia.org/wiki/Dependency_injection)

===

现在，这段代码已经被遵循，测试类`Dependency Injection`更容易了。 但是，我们仍然使用了很多时间，并且在更改构造函数时并不好。为了防止它，我们可以使用 DI 注射器，如 1) 简单的手动`Client`
`new Service()``Service`
`Injector`

```
public class Injector {
    public static Service provideService(){
        return new Service();
    }

    public static IDatabase provideDatatBase(){
        return new SqliteDatabase();
    }
    public static ObjectA provideObjectA(){
        return new ObjectA(provideService(...));
    }
} 
```

**使用**

```
Service service = Injector.provideService(); 
```

2) 使用库：Android [dagger2](https://github.com/google/dagger)

**好处**

*   让测试更轻松
*   更改时`Service`，只需要在 Injector 类中更改即可
*   如果你使用 use `Constructor Injection`，当你查看构造函数时，你会看到类`Client`的依赖项有多少`Client`

**缺点**

*   如果你使用 use `Constructor Injection`，`Service`对象是在创建时`Client`创建的，有时我们在`Client`类中使用函数而不使用`Service`所以创建`Service`是浪费的

### 依赖注入定义

[https://en.wikipedia.org/wiki/Dependency_injection](https://en.wikipedia.org/wiki/Dependency_injection)

> 依赖项是可以使用的对象（`Service`）
> 注入是将依赖项（）传递给将使用它`Service`的依赖对象（ ）`Client`

* * *

## 回答 #16

> 赞同：17
> 
> 时间：2015-12-04T05:50:02.007

## 什么是依赖注入？

依赖注入（DI）意味着解耦相互依赖的对象。假设对象 A 依赖于对象 B，因此想法是将这些对象彼此分离。尽管有编译时间，我们不需要使用 new 关键字对对象进行硬编码，而是在运行时共享对对象的依赖关系。如果我们谈论

## 依赖注入在 Spring 中是如何工作的：

我们不需要使用 new 关键字对对象进行硬编码，而是在配置文件中定义 bean 依赖项。弹簧容器将负责连接所有。

## 控制反转 (IOC)

IOC 是一个通用概念，它可以用多种不同的方式表达，而依赖注入是 IOC 的一个具体例子。

## 两种类型的依赖注入：

1.  构造函数注入
2.  二传手注入

## 1.基于构造函数的依赖注入：

当容器调用具有多个参数的类构造函数时，就完成了基于构造函数的 DI，每个参数都表示对其他类的依赖。

```
public class Triangle {

private String type;

public String getType(){
    return type;
 }

public Triangle(String type){   //constructor injection
    this.type=type;
 }
}
<bean id=triangle" class ="com.test.dependencyInjection.Triangle">
        <constructor-arg value="20"/>
  </bean> 
```

## 2.基于Setter的依赖注入：

基于 Setter 的 DI 是通过容器在调用无参数构造函数或无参数静态工厂方法来实例化 bean 后调用 bean 上的 setter 方法来完成的。

```
public class Triangle{

 private String type;

 public String getType(){
    return type;
  }
 public void setType(String type){          //setter injection
    this.type = type;
  }
 }

<!-- setter injection -->
 <bean id="triangle" class="com.test.dependencyInjection.Triangle">
        <property name="type" value="equivialteral"/> 
```

注意：对于强制依赖项使用构造函数参数和对可选依赖项使用设置器是一个很好的经验法则。请注意，如果我们在 setter 上使用基于注释而不是 @Required 注释可用于使 setter 成为必需的依赖项。

* * *

## 回答 #17

> 赞同：15
> 
> 时间：2016-04-05T16:15:55.390

我能想到的最好的类比是手术室里的外科医生和他的助手，外科医生是主要人员，他的助手在需要时提供各种手术组件，以便外科医生可以专注于一个他最擅长的事情（手术）。如果没有助手，外科医生每次需要时都必须自己获取组件。

简而言之，DI 是一种通过向组件提供组件来消除组件上常见的额外责任（负担）以获取依赖组件的技术。

DI 让您更接近单一职责 (SR) 原则，例如`surgeon who can concentrate on surgery`.

何时使用 DI：我建议在几乎所有生产项目（小型/大型）中使用 DI，尤其是在不断变化的业务环境中：）

原因：因为您希望您的代码易于测试、可模拟等，以便您可以快速测试您的更改并将其推向市场。此外，当您有很多很棒的免费工具/框架来支持您在您拥有更多控制权的代码库的过程中，您为什么不这样做。

* * *

## 回答 #18

> 赞同：13
> 
> 时间：2014-01-07T11:45:31.137

这意味着对象应该只具有完成其工作所需的依赖项，并且依赖项应该很少。此外，如果可能，对象的依赖关系应该在接口上，而不是在“具体”对象上。（具体对象是使用关键字 new 创建的任何对象。）松散耦合促进了更高的可重用性、更容易的可维护性，并允许您轻松地提供“模拟”对象来代替昂贵的服务。

“依赖注入”（DI）也称为“控制反转”（IoC），可用作鼓励这种松散耦合的技术。

实施 DI 有两种主要方法：

1.  构造函数注入
2.  二传手注入

## 构造函数注入

这是将对象依赖项传递给其构造函数的技术。

请注意，构造函数接受接口而不是具体对象。另请注意，如果 orderDao 参数为空，则会引发异常。这强调了接收有效依赖项的重要性。在我看来，构造函数注入是赋予对象依赖关系的首选机制。开发人员在调用对象时很清楚需要将哪些依赖项提供给“Person”对象才能正确执行。

## 二传手注入

但是请考虑以下示例……假设您有一个包含十个没有依赖关系的方法的类，但是您正在添加一个确实依赖于 IDAO 的新方法。您可以更改构造函数以使用构造函数注入，但这可能会迫使您更改所有构造函数调用。或者，您可以只添加一个接受依赖项的新构造函数，但是开发人员如何轻松知道何时使用一个构造函数而不是另一个。最后，如果依赖项的创建成本很高，那么在它可能很少使用的情况下，为什么还要创建它并传递给构造函数呢？“Setter Injection”是另一种可用于此类情况的 DI 技术。

Setter 注入不会强制将依赖项传递给构造函数。相反，依赖关系被设置到需要的对象公开的公共属性上。如前所述，这样做的主要动机包括：

1.  支持依赖注入，无需修改遗留类的构造函数。
2.  允许尽可能晚且仅在需要时创建昂贵的资源或服务。

以下是上述代码的示例：

```
public class Person {
    public Person() {}

    public IDAO Address {
        set { addressdao = value; }
        get {
            if (addressdao == null)
              throw new MemberAccessException("addressdao" +
                             " has not been initialized");
            return addressdao;
        }
    }

    public Address GetAddress() {
       // ... code that uses the addressdao object
       // to fetch address details from the datasource ...
    }

    // Should not be called directly;
    // use the public property instead
    private IDAO addressdao; 
```

* * *

## 回答 #19

> 赞同：10
> 
> 时间：2014-11-12T14:37:27.597

我知道已经有很多答案，但我发现这很有帮助：[http ://tutorials.jenkov.com/dependency-injection/index.html](http://tutorials.jenkov.com/dependency-injection/index.html)

### 无依赖：

```
public class MyDao {

  protected DataSource dataSource = new DataSourceImpl(
    "driver", "url", "user", "password");

  //data access methods...
  public Person readPerson(int primaryKey) {...}     
} 
```

### 依赖：

```
public class MyDao {

  protected DataSource dataSource = null;

  public MyDao(String driver, String url, String user, String password) {
    this.dataSource = new DataSourceImpl(driver, url, user, password);
  }

  //data access methods...
  public Person readPerson(int primaryKey) {...}
} 
```

注意`DataSourceImpl`实例化是如何移动到构造函数中的。构造函数接受四个参数，它们是`DataSourceImpl`. 尽管`MyDao`该类仍然依赖于这四个值，但它本身不再满足这些依赖关系。它们由创建`MyDao`实例的任何类提供。

* * *

## 回答 #20

> 赞同：9
> 
> 时间：2013-10-25T03:56:09.493

我想既然每个人都为DI写过，让我问几个问题..

1.  当您有一个 DI 配置时，所有实际实现（不是接口）都将被注入到一个类中（例如向控制器提供服务），为什么这不是某种硬编码？
2.  如果我想在运行时更改对象怎么办？例如，我的配置已经说明当我实例化 MyController 时，将 FileLogger 注入为 ILogger。但我可能想注入 DatabaseLogger。
3.  每次我想更改我的 AClass 需要的对象时，我现在需要查看两个地方 - 类本身和配置文件。这如何让生活更轻松？
4.  如果没有注入 AClass 的属性，是不是更难模拟出来？
5.  回到第一个问题。如果使用 new object() 不好，我们如何注入实现而不是接口？我想你们中的很多人都在说我们实际上是在注入接口，但是配置使您指定该接口的实现..而不是在运行时..它在编译时是硬编码的。

这是基于@Adam N 发布的答案。

为什么 PersonService 再也不用担心 GroupMembershipService 了？您刚刚提到 GroupMembership 有多个它依赖的东西（对象/属性）。如果 PService 中需要 GMService，那么您可以将其作为属性。无论您是否注入它，您都可以模拟它。我唯一希望注入它的是 GMService 是否有更具体的子类，直到运行时你才会知道。然后你想注入子类。或者，如果您想将其用作单例或原型。老实说，配置文件对编译时要注入的类型（接口）的子类进行了硬编码。

**编辑**

[Jose Maria Arranz 对 DI 的精彩评论](https://dzone.com/articles/dependency-injection-makes)

*DI 通过消除确定依赖方向和编写任何胶水代码的任何需要来增加凝聚力。*

错误的。依赖的方向是XML形式或注解，你的依赖被写成XML代码和注解。XML 和注释是源代码。

*DI 通过使所有组件模块化（即可替换）并具有明确定义的相互接口来减少耦合。*

错误的。您不需要 DI 框架来构建基于接口的模块化代码。

关于可替换：使用非常简单的 .properties 存档和 Class.forName 您可以定义哪些类可以更改。如果您的代码的任何类都可以更改，Java 不适合您，请使用脚本语言。顺便说一句：不重新编译就无法更改注释。

在我看来，DI 框架的唯一原因是：减少样板。使用完善的工厂系统，您可以像首选的 DI 框架那样做同样的事情，更可控和更可预测，DI 框架承诺代码减少（XML 和注释也是源代码）。问题是这种样板减少在非常非常简单的情况下是真实的（每个类一个实例和类似的），有时在现实世界中选择适当的服务对象并不像将一个类映射到一个单例对象那么容易。

* * *

## 回答 #21

> 赞同：8
> 
> 时间：2015-06-02T18:09:07.307

流行的答案是无用的，因为它们以一种无用的方式定义依赖注入。让我们同意，“依赖”是指我们的对象 X 需要的一些预先存在的其他对象。但是当我们说时我们并没有说我们正在做“依赖注入”

```
$foo = Foo->new($bar); 
```

我们只是将其称为将参数传递给构造函数。自从构造函数被发明以来，我们就经常这样做。

“依赖注入”被认为是一种“控制反转”，这意味着从调用者中取出一些逻辑。当调用者传入参数时，情况并非如此，所以如果那是 DI，DI 不会暗示控制反转。

DI 意味着在调用者和管理依赖的构造函数之间有一个中间层。Makefile 是依赖注入的一个简单示例。“调用者”是在命令行中键入“make bar”的人，“构造者”是编译器。Makefile 指定 bar 依赖于 foo，它执行

```
gcc -c foo.cpp; gcc -c bar.cpp 
```

在做之前

```
gcc foo.o bar.o -o bar 
```

键入“make bar”的人不需要知道 bar 依赖于 foo。在“make bar”和 gcc 之间注入了依赖项。

中间层的主要目的不仅仅是将依赖项传递给构造函数，而是将所有依赖项都列出在*一个地方*，并对编码器隐藏它们（而不是让编码器提供它们）。

通常中间层为构造的对象提供工厂，它必须提供每个请求的对象类型必须满足的角色。那是因为有了一个隐藏构造细节的中间层，你已经招致了工厂强加的抽象惩罚，所以你还不如使用工厂。

* * *

## 回答 #22

> 赞同：8
> 
> 时间：2015-12-10T15:50:06.963

[依赖注入](https://en.wikipedia.org/wiki/Dependency_injection)意味着一种方式（实际上是**任何方式**）代码的一部分（例如一个类）以模块化的方式访问依赖项（代码的其他部分，例如它所依赖的其他类），而无需对其进行硬编码（因此它们可以根据需要自由更改或覆盖，甚至可以在其他时间加载）

*（和 ps ，是的，它已成为一个相当简单的概念的过度炒作的 25 美元名称）*，我的`.25`美分

* * *

## 回答 #23

> 赞同：6
> 
> 时间：2014-04-01T22:21:08.317

依赖注入是通常被称为“依赖混淆”要求的一种可能的解决方案。依赖混淆是一种从向需要它的类提供依赖的过程中去除“明显”性质的方法，因此以某种方式混淆了向所述类提供所述依赖。这不一定是坏事。事实上，通过混淆向类提供依赖项的方式，然后类外部的东西负责创建依赖项，这意味着在各种情况下，可以将依赖项的不同实现提供给类而无需进行任何更改到班级。这非常适合在生产模式和测试模式之间切换（例如，使用“模拟”服务依赖项）。

不幸的是，有些人认为您需要一个专门的框架来进行依赖混淆，并且如果您选择不使用特定的框架来做这件事，那么您在某种程度上就是一个“小”程序员。许多人认为，另一个非常令人不安的神话是依赖注入是实现依赖混淆的唯一方法。从历史上看，这显然是 100% 错误的，但是您将难以说服某些人有依赖注入的替代方法来满足您的依赖混淆要求。

多年来，程序员已经了解依赖混淆的要求，并且在依赖注入被构想之前和之后，许多替代解决方案已经发展起来。有工厂模式，但也有许多使用 ThreadLocal 的选项，其中不需要注入到特定实例 - 依赖项被有效地注入到线程中，这有利于使对象可用（通过方便的静态 getter 方法）*任何*需要它的类，而不必向需要它的类添加注释并设置复杂的 XML“胶水”来实现它。当您的依赖项需要持久性（JPA/JDO 或其他）时，它允许您更轻松地实现“透明持久性”，并使用纯粹由 POJO 组成的域模型和业务模型类（即没有特定于框架的/锁定在注释中）。

* * *

## 回答 #24

> 赞同：5
> 
> 时间：2013-05-18T19:27:31.980

摘自《[扎实的 Java 开发人员：Java 7 和多语言编程的重要技术》一书](https://rads.stackoverflow.com/amzn/click/com/1617290068)

> DI 是 IoC 的一种特殊形式，因此查找依赖项的过程不受当前执行代码的直接控制。

* * *

## 回答 #25

> 赞同：5
> 
> 时间：2019-09-07T15:16:32.973

5岁儿童的依赖注入。

当你自己去冰箱里取东西时，你可能会出问题。你可能会把门开着，你可能会得到一些妈妈或爸爸不希望你拥有的东西。您甚至可能正在寻找我们甚至没有或已过期的东西。

你应该做的是陈述一个需求，“我午餐需要喝点东西”，然后我们会确保你坐下来吃饭时有东西。

* * *

## 回答 #26

> 赞同：4
> 
> 时间：2015-08-28T10:00:30.557

来自Book **Apress.Spring.Persistence.with.Hibernate.Oct.2010**

> 依赖注入的目的是将解析外部软件组件的工作与应用程序业务逻辑分离。没有依赖注入，组件如何访问所需服务的细节可能会与组件的代码混淆。这不仅增加了错误的可能性，增加了代码膨胀，并放大了维护的复杂性；它将组件更紧密地耦合在一起，使得在重构或测试时很难修改依赖关系。

* * *

## 回答 #27

> 赞同：4
> 
> 时间：2015-09-20T12:33:13.593

依赖注入 (DI) 来自设计模式，它使用 OOP 的基本特征——一个对象与另一个对象的关系。虽然继承继承一个对象来执行更复杂和更具体的另一个对象，但关系或关联只是使用属性从一个对象创建指向另一个对象的指针。DI 的强大功能与 OOP 的其他特性相结合，如接口和隐藏代码。假设我们在图书馆有一个客户（订户），为了简单起见，他只能借一本书。

书籍界面：

```
package com.deepam.hidden;

public interface BookInterface {

public BookInterface setHeight(int height);
public BookInterface setPages(int pages);   
public int getHeight();
public int getPages();  

public String toString();
} 
```

接下来我们可以拥有多种书籍；一种类型是虚构的：

```
package com.deepam.hidden;

public class FictionBook implements BookInterface {
int height = 0; // height in cm
int pages = 0; // number of pages

/** constructor */
public FictionBook() {
    // TODO Auto-generated constructor stub
}

@Override
public FictionBook setHeight(int height) {
  this.height = height;
  return this;
}

@Override
public FictionBook setPages(int pages) {
  this.pages = pages;
  return this;      
}

@Override
public int getHeight() {
    // TODO Auto-generated method stub
    return height;
}

@Override
public int getPages() {
    // TODO Auto-generated method stub
    return pages;
}

@Override
public String toString(){
    return ("height: " + height + ", " + "pages: " + pages);
}
} 
```

现在订阅者可以关联到这本书：

```
package com.deepam.hidden;

import java.lang.reflect.Constructor;
import java.lang.reflect.InvocationTargetException;

public class Subscriber {
BookInterface book;

/** constructor*/
public Subscriber() {
    // TODO Auto-generated constructor stub
}

// injection I
public void setBook(BookInterface book) {
    this.book = book;
}

// injection II
public BookInterface setBook(String bookName) {
    try {
        Class<?> cl = Class.forName(bookName);
        Constructor<?> constructor = cl.getConstructor(); // use it for parameters in constructor
        BookInterface book = (BookInterface) constructor.newInstance();
        //book = (BookInterface) Class.forName(bookName).newInstance();
    } catch (InstantiationException e) {
        e.printStackTrace();
    } catch (IllegalAccessException e) {
        e.printStackTrace();
    } catch (ClassNotFoundException e) {
        e.printStackTrace();
    } catch (NoSuchMethodException e) {
        e.printStackTrace();
    } catch (SecurityException e) {
        e.printStackTrace();
    } catch (IllegalArgumentException e) {
        e.printStackTrace();
    } catch (InvocationTargetException e) {
        e.printStackTrace();
    }
    return book;
}

public BookInterface getBook() {
  return book;
}

public static void main(String[] args) {

}

} 
```

所有这三个类都可以隐藏起来以实现它自己的实现。现在我们可以将此代码用于 DI：

```
package com.deepam.implement;

import com.deepam.hidden.Subscriber;
import com.deepam.hidden.FictionBook;

public class CallHiddenImplBook {

public CallHiddenImplBook() {
    // TODO Auto-generated constructor stub
}

public void doIt() {
    Subscriber ab = new Subscriber();

    // injection I
    FictionBook bookI = new FictionBook();
    bookI.setHeight(30); // cm
    bookI.setPages(250);
    ab.setBook(bookI); // inject
    System.out.println("injection I " + ab.getBook().toString());

    // injection II
    FictionBook bookII = ((FictionBook) ab.setBook("com.deepam.hidden.FictionBook")).setHeight(5).setPages(108); // inject and set
    System.out.println("injection II " + ab.getBook().toString());      
}

public static void main(String[] args) {
    CallHiddenImplBook kh = new CallHiddenImplBook();
    kh.doIt();
}
} 
```

如何使用依赖注入有很多不同的方法。可以和Singleton等结合，但基本上还是只是通过在另一个对象内部创建对象类型的属性来实现关联。有用性仅在功能上，我们应该一次又一次编写的代码总是为我们准备和完成。这就是为什么 DI 与控制反转 (IoC) 紧密结合的原因，这意味着我们的程序将控制权传递给另一个正在运行的模块，该模块将 bean 注入我们的代码。（每个可以注入的对象都可以被签名或视为一个 Bean。）例如在 Spring 中，它是通过创建和初始化*ApplicationContext来完成的*容器，它为我们工作。我们只需在代码中创建上下文并调用 bean 的初始化。在那一刻，注射已自动完成。

* * *

## 回答 #28

> 赞同：4
> 
> 时间：2016-06-03T23:34:22.700

依赖注入 (DI) 是依赖倒置原则 (DIP) 实践的一部分，也称为控制反转 (IoC)。基本上你需要做 DIP 因为你想让你的代码更加模块化和单元测试，而不仅仅是一个单一的系统。因此，您开始识别可以与类分离并抽象出来的代码部分。现在需要从类外部注入抽象的实现。通常这可以通过构造函数来完成。因此，您创建了一个接受抽象作为参数的构造函数，这称为依赖注入（通过构造函数）。有关 DIP、DI 和 IoC 容器的更多说明，您可以阅读[此处](http://kusnaditjung.blogspot.co.uk/2016/05/dependency-inversion-principle-dip.html)

* * *

## 回答 #29

> 赞同：4
> 
> 时间：2018-07-01T18:52:37.360

来自 Christoffer Noring，Pablo Deeleman 的书“Learning Angular - Second Edition”：

“随着我们的**应用程序**的增长和发展，我们的每个**代码实体**都将在内部需要**其他对象的实例，这些对象**在软件工程领域中被更好地称为**依赖**项。将此类**依赖项传递给依赖客户端的****操作**称为**注入**，它还需要另一个代码实体的参与，称为**注入器**。**注入器**将负责**实例化**和**引导**所需的**依赖项****************因此，从成功注入客户端的那一刻起，它们就可以使用了。**这一点非常重要，因为客户端对如何实例化**自己的**依赖**项一无所知，只知道它们为了使用它们而实现的**接口。”****************

 ****来自：安东·莫伊谢耶夫。《使用 Typescript 进行 Angular 开发，第二版》一书：

“简而言之，**DI**可以帮助您以**松耦合**的方式编写代码，并使您的**代码**更具**可测试性**和**可重用性**。”</p>

* * *

## 回答 #30

> 赞同：4
> 
> 时间：2018-09-21T09:42:34.913

我会提出一个稍微不同的、简短而精确的定义，即依赖注入是什么，关注主要目标，而不是技术手段（从[这里开始](https://blog.softwaremill.com/what-is-dependency-injection-8c9e7805502f)）：

> 依赖注入是创建服务对象的静态、无状态图的过程，其中每个服务都通过其依赖项进行参数化。

我们在应用程序中创建的对象（无论我们使用 Java、C# 还是其他面向对象的语言）通常属于以下两类之一：无状态、静态和全局“服务对象”（模块），以及有状态、动态和本地“数据对象”。

模块图——服务对象的图——通常在应用程序启动时创建。这可以使用容器来完成，例如 Spring，但也可以通过将参数传递给对象构造函数来手动完成。两种方式各有利弊，但在您的应用程序中使用 DI 绝对不需要框架。

一项要求是服务必须通过其依赖项进行参数化。这意味着什么完全取决于给定系统中采用的语言和方法。通常，这采用构造函数参数的形式，但使用 setter 也是一种选择。这也意味着服务的依赖项对服务的用户是隐藏的（在调用服务方法时）。

什么时候使用？我会说，只要应用程序足够大，将逻辑封装到单独的模块中，模块之间的依赖图就会提高代码的可读性和可探索性。

* * *

## 回答 #31

> 赞同：3
> 
> 时间：2013-11-12T05:19:09.413

简而言之，依赖注入 (DI) 是消除不同对象之间的依赖关系或紧密耦合的方法。依赖注入为每个对象提供了一个内聚的行为。

DI 是 Spring 的 IOC 主体的实现，它说“不要打电话给我们，我们会打电话给你”。使用依赖注入程序员不需要使用 new 关键字创建对象。

对象一旦加载到 Spring 容器中，然后我们在需要时通过使用 getBean(String beanName) 方法从 Spring 容器中获取这些对象来重用它们。

* * *

## 回答 #32

> 赞同：3
> 
> 时间：2014-05-28T09:08:59.107

依赖注入是与 Spring 框架相关概念的核心。在创建任何项目的框架时，spring 可能会发挥至关重要的作用，而依赖注入在这里出现了。

实际上，假设您在java中创建了两个不同的类，分别是A类和B类，并且您想在A类中使用B类中可用的任何功能，那么此时可以使用依赖注入。您可以在另一个类中创建一个类的对象，就像您可以在另一个类中注入整个类以使其可访问一样。通过这种方式可以克服依赖。

依赖注入只是简单地粘合两个类，同时保持它们分开。

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2016-11-17T22:01:43.510

**依赖注入**是基于框架构建的“**控制反转**”原则的一种实现。

**GoF的“设计模式”中所述的框架**是实现主要控制流逻辑的类，促使开发人员这样做，通过这种方式框架实现了控制原则的反转。

一种作为技术实现的方法，而不是作为类层次结构，这个 IoC 原则就是依赖注入。

**DI**主要包括将类实例和类型引用的映射委托给外部“实体”：对象、静态类、组件、框架等......

类实例是“***依赖***”，调用组件通过引用与类实例的外部绑定就是“***注入***”。

显然，您可以从 OOP 的角度以多种方式实现此技术，例如*构造函数注入*、*setter 注入*、*接口注入*。

委托第三方执行将 ref 匹配到对象的任务，当您想要将需要某些服务的组件与相同的服务实现完全分离时，这非常有用。

这样，在设计组件时，您可以专注于它们的架构和它们的特定逻辑，信任与其他对象协作的接口，而不用担心使用的对象/服务的任何类型的实现更改，即使您正在使用相同的对象将被完全替换（显然尊重接口）。

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2018-09-27T07:00:35.370

依赖注入是使解耦组件与它们的一些依赖无关的做法，这遵循[SOLID](https://en.wikipedia.org/wiki/SOLID)指南，即

> 依赖倒置原则：应该“依赖于抽象，而不是具体。

依赖注入的更好实现是组合根设计模式，因为它允许您的组件与依赖注入容器分离。

我推荐这篇关于 Composition Root 的精彩文章 [http://blog.ploeh.dk/2011/07/28/CompositionRoot/](http://blog.ploeh.dk/2011/07/28/CompositionRoot/) 由 Mark Seemann 撰写

以下是这篇文章的要点：

> 组合根是模块组合在一起的应用程序中的（最好）唯一位置。

...

> 只有应用程序应该有组合根。库和框架不应该。

...

> DI Container 只能从 Composition Root 引用。所有其他模块都不应引用容器。

Di-Ninja 的文档，一个依赖注入框架，是一个很好的例子来展示组合根和依赖注入的原理是如何工作的。 [https://github.com/di-ninja/di-ninja](https://github.com/di-ninja/di-ninja) 据我所知，它是 JavaScript 中唯一一个实现 Composition-Root 设计模式的 DiC。

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2020-01-21T08:48:21.280

我们可以实现一个依赖注入来了解它：

```
class Injector {
  constructor() {
    this.dependencies = {};
    this.register = (key, value) => {
      this.dependencies[key] = value;
    };
  }
  resolve(...args) {
    let func = null;
    let deps = null;
    let scope = null;
    const self = this;
    if (typeof args[0] === 'string') {
      func = args[1];
      deps = args[0].replace(/ /g, '').split(',');
      scope = args[2] || {};
    } else {
      func = args[0];
      deps = func.toString().match(/^function\s*[^\(]*\(\s*([^\)]*)\)/m)[1].replace(/ /g, '').split(',');
      scope = args[1] || {};
    }
    return (...args) => {
      func.apply(scope || {}, deps.map(dep => self.dependencies[dep] && dep != '' ? self.dependencies[dep] : args.shift()));
    }
  }
}

injector = new Injector();

injector.register('module1', () => { console.log('hello') });
injector.register('module2', () => { console.log('world') });

var doSomething1 = injector.resolve(function (module1, module2, other) {
  module1();
  module2();
  console.log(other);
});
doSomething1("Other");

console.log('--------')

var doSomething2 = injector.resolve('module1,module2,', function (a, b, c) {
  a();
  b();
  console.log(c);
});
doSomething2("Other"); 
```

以上是javascript的实现

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2017-03-27T10:16:38.660

任何重要的应用程序都由两个或多个相互协作以执行某些业务逻辑的类组成。传统上，每个对象都负责获取自己对与之协作的对象（其依赖项）的引用。**应用 DI 时，对象在创建时由协调系统中每个对象的某个外部实体赋予它们的依赖关系。**换句话说，依赖项被注入到对象中。

有关更多详细信息，请参阅[在此处输入链接描述](http://www.javaworld.com/article/2071914/excellent-explanation-of-dependency-injection--inversion-of-control-.html)

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2019-01-05T08:53:00.237

DI 是真实对象之间实际交互的方式，而不需要一个对象负责另一个对象的存在。对象应该被平等对待。它们都是对象。没有人应该表现得像一个创造者。这就是你如何公正对待你的对象。

**简单的例子**：

如果您需要医生，您只需去找（现有的）医生。您不会考虑从头开始创建一名医生来帮助您。他已经存在，他可能会为你或其他对象服务。无论您（单个对象）是否需要他，他都有权存在，因为他的目的是为一个或多个对象服务。决定他存在的是全能神，而不是自然选择。因此，DI 的一个优点是避免在你的 Universe（即应用程序）的生命周期中创建无用的冗余对象。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2022-02-04T14:32:23.287

在`Dependency Injection (DI)`中，组件的依赖关系由名为 的外部实体作为输入提供`injector`。注入器使用提供者创建依赖项。提供者是知道如何创建依赖项的配方。

注入器初始化不同的组件并将它们的依赖关系联系在一起。它可以是一个简单的初始化脚本，也可以是一个更复杂的全局容器，映射所有依赖关系并集中系统所有模块的布线。这种方法的主要优点是改进了解耦，尤其是对于依赖于有状态实例的模块（例如，数据库连接）。使用 DI，从外部接收每个依赖项，而不是硬编码到模块中。这意味着依赖模块可以配置为使用任何兼容的依赖项，因此模块本身可以在不同的上下文中重用。依赖注入增加了应用程序的灵活性和模块化。在应用程序中使用它可以使代码灵活、可测试和可变。

# c# - 桌面应用程序中的数据可视化

> ID：130800
> 
> 赞同：1
> 
> 时间：2008-09-25T00:30:34.527
> 
> 标签：c#, .net, c++, mfc, visualization

我想在桌面应用程序中创建数据可视化，使用有助于完成此类任务的框架、语言和库。可视化应该是交互式的：可点击、可拖动、可定制、动画......

我想创建的是类似于此处看到的示例：http: [//www.visualcomplexity.com/vc/](http://www.visualcomplexity.com/vc/)

这些是我已经知道的链接：[http ://delicious.com/laura_laura/visualization?setcount=100](http://delicious.com/laura_laura/visualization?setcount=100)

首选语言是 C++/Visual C++ (MFC)，因为我对它很熟悉，但欢迎使用任何其他技术，我想列出一个列表，从与 Visual C++ 的“尽可能相似”到与 Visual C++ 的“非常不同” C++。

WPF、flex、Adobe Air、flare、JavaScript（在浏览器中作为可以访问本地文件的客户端应用程序或作为桌面应用程序运行）是可能的，发布任何好的示例、教程、操作方法等链接了解。

不同选项的学习曲线和复杂性是什么？你会选择哪一个，为什么？您已经与哪一位合作过，您的体验如何？您将如何从具有这种特征的项目开始？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-25T00:59:27.563

您的帖子中有太多问题，无法在一个回复中轻松回答，因此您可以尝试重新发布特定问题。数据可视化是一个巨大的研究领域，Web 应用程序与桌面应用程序没有显着差异。

简而言之，它是以一种直观地讲述数据故事的方式显示数据。在数据量很大以至于表格显示无效的情况下，它最有用。趋势、异常值和异常事件有时只能在数据以可视方式表示时才能看到。视觉上可以是简单的图表，也可以是更高级的可视化，例如树状图或专题制图/GIS 演示。

如果这是您有兴趣学习的领域，请查看：

[Edward Tufte](http://www.edwardtufte.com/tufte/) - 作家、教授和信息展示的全能大师

[许多眼睛](http://services.alphaworks.ibm.com/manyeyes/home)- 来自 IBM AlphaWorks

[Processing](http://www.processing.org) - 基于 Java 的可视化“素描”语言

[Visualizing Data](https://rads.stackoverflow.com/amzn/click/com/0596514557) - Ben Fry 的 O'Reilly 书籍，Processing 的共同创造者之一

除此之外，我认为具体情况取决于您想要完成的任务——正在分析什么数据、受众是谁以及所需的“信息”是什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T17:54:06.760

如果您愿意使用 Flash/Flex/ActionScript/AIR 开发平台，请查看 prefuse 项目中的“flare”库：

[http://flare.prefuse.org/](http://flare.prefuse.org/)

在这一点上，我只是被它弄湿了，但到目前为止，我喜欢我所看到的。

# unit-testing - 如何使用 GNU 自动工具为“make check”创建测试

> ID：130801
> 
> 赞同：31
> 
> 时间：2008-09-25T00:30:36.167
> 
> 标签：unit-testing, language-agnostic, automated-tests, autotools

我正在为特定项目的构建系统使用 GNU 自动工具。我想开始编写用于验证的自动化测试。我只想输入“make check”让它自动运行这些。我的项目是用 C++ 编写的，尽管我仍然对为其他语言编写自动化测试感到好奇。

*这是否与几乎所有的单元测试框架兼容（我正在考虑使用 cppunit）？如何将这些单元测试框架挂钩到 make check 中？我可以确保我不需要安装单元测试软件来配置和构建项目的其余部分吗？*

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-06T12:56:05.437

要在发出时进行测试`make check`，您需要将它们添加到`TESTS`变量中

假设您已经构建了运行单元测试的可执行文件，您只需将可执行文件的名称添加到 TESTS 变量中，如下所示：

```
TESTS=my-test-executable 
```

然后它应该在你时自动运行`make check`，如果可执行文件返回一个非零值，它将报告为测试失败。如果您有多个单元测试可执行文件，只需在`TESTS`变量中列出它们：

```
TESTS=my-first-test my-second-test my-third-test 
```

他们都会跑起来。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2013-11-29T02:07:34.523

我正在使用[检查 0.9.10](https://libcheck.github.io/check/)

```
 configure.ac
    Makefile.am
    src/Makefile.am
    src/foo.c
    tests/check_foo.c
    tests/Makefile.am 
```

1.  `./configure.ac`

    PKG_CHECK_MODULES([检查], [检查 >= 0.9.10])

2.  `./tests/Makefile.am`用于测试代码

    ```
    TESTS = check_foo
    check_PROGRAMS = check_foo
    check_foo_SOURCES = check_foo.c $(top_builddir)/src/foo.h
    check_foo_CFLAGS = @CHECK_CFLAGS@ 
    ```

3.  并编写测试代码，`./tests/check_foo.c`

    ```
    START_TEST (test_foo)
    {
        ck_assert( foo() == 0 );
        ck_assert_int_eq( foo(), 0);
    }
    END_TEST

    /// And there are some tcase_xxx codes to run this test 
    ```

使用检查，您可以使用超时和引发信号。这很有帮助。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-25T03:03:44.410

您似乎在第一段中问了两个问题。

第一个是关于向 GNU autotools 工具链添加测试 - 但如果我对您的理解正确，这些测试既用于验证构建应用程序所需的环境（依赖库和工具）以及使构建适应环境（平台特定差异）。

第二个是关于对您的 C++ 应用程序进行单元测试以及在哪里调用这些测试，您已经建议从 autotools 工具链中这样做，大概是从配置脚本中进行的。这样做不是传统的 - 在 Makefile 中放置一个“测试”目标是执行测试套件的更传统的方式。使用自动工具构建和安装应用程序的典型步骤（至少从用户的角度来看，而不是从您的开发人员的角度来看）是运行配置脚本，然后运行 ​​make，然后可选地运行 make test，最后进行 make install。

对于第二个问题，不希望 cppunit 成为依赖项，为什么不将它与您的 c++ 应用程序一起分发呢？你能把它和你的源代码一起放在你正在使用的任何存档格式（无论是 tar.gz、tar.bz2 还是 .zip）中。我过去使用过 cppunit 并且对它很满意，使用过 JUnit 和其他 xUnit 风格的框架。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2020-02-22T00:38:05.743

这是一个没有依赖关系的方法：

```
#src/Makefile.am
check_PROGRAMS = test1 test2
test1_SOURCES = test/test1.c code_needed_to_test1.h code_needed_to_test1.c
test2_SOURCES = test/test2.c code_needed_to_test2.h code_needed_to_test2.c
TESTS = $(check_PROGRAMS) 
```

将`make check`自然地工作并显示格式化和汇总的输出：

```
$ make check
...
PASS: test1
PASS: test2
============================================================================
Testsuite summary for foo 1.0
============================================================================
# TOTAL: 2
# PASS:  2
# SKIP:  0
# XFAIL: 0
# FAIL:  0
# XPASS: 0
# ERROR: 0
============================================================================ 
```

1.  当你什么`make dist`都不做时`src/test/*`将在 tarball 中。测试代码不在 dist 中，只有源代码。
2.  当您执行`make distcheck`时，它将运行`make check`并运行您的测试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-10-20T19:59:24.430

您可以使用 Automake`TESTS`运行生成的程序，`check_PROGRAMS`但这将假定您使用日志驱动程序和编译器进行输出。它可能更容易使用`check_PROGRAMS`，但使用 Makefile 中的本地规则调用测试套件：

```
check_PROGRAMS=testsuite

testsuite_SOURCES=...
testsuite_CFLAGS=...
testsuite_LDADD=...

check-local:
    ./testsuite 
```

# vb.net - VB.NET - 应用程序遇到用户定义的断点

> ID：130803
> 
> 赞同：3
> 
> 时间：2008-09-25T00:31:00.173
> 
> 标签：vb.net

我对 VB.NET 不太了解，我正在开发的应用程序不是我自己编写的。
它可以通过 IDE 正常工作，但是一旦我从 exe 运行它，它就会出现上述错误。

有什么线索吗？

这真的是在坑我！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-25T00:38:22.217

我能想到的唯一用户定义的断点是

```
Debugger.Break() 
```

所以，我怀疑 .exe 是在调试模式下编译的。我建议[Reflector](http://www.red-gate.com/products/reflector/index.htm)查看代码并确定其中是否存在 Debugger.Break() 。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T00:51:38.050

Afaik，如果您在调试设置下编译，可能会发生这种情况的唯一方法。您*应该*能够通过执行以下操作来修复它：

1.  在解决方案资源管理器上右键单击您的解决方案。
2.  选择配置属性。
3.  在对话框的顶部应该有一个组合框，很可能会显示“Active(Debug)”。
4.  单击下拉菜单并选择发布。
5.  好的一切。
6.  构建 > 重建解决方案。

资料来源：[p2p.wrox.com](http://p2p.wrox.com/topic.asp?TOPIC_ID=7712)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T00:40:36.640

我相信 exe 文件是使用“调试”设置编译的。尝试将 Build 设置更改为 Release 并执行项目的完整构建（重建）。然后尝试运行可执行文件。然后它应该正常运行。

您看到该错误的原因是，当您通常在 Visual Studio 中编译和运行应用程序时，它会编译可执行文件的调试版本。调试构建和发布构建之间的不同之处在于，调试构建由编译器添加了附加信息，因此可以正确调试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-06-14T16:13:58.667

`stop`我建议在你的代码中寻找。这就是为我产生此错误的原因。

# asp.net - 将类放入 aspx 和 ascx 代码隐藏时的性能损失

> ID：130814
> 
> 赞同：2
> 
> 时间：2008-09-25T00:33:54.020
> 
> 标签：asp.net, performance

在 aspx/ascx 代码隐藏中定义类而不是事先将它们编译到 dll 中的性能损失是什么？我知道这不是最佳实践，并且存在很多问题（例如，难以进行单元测试，代码不可重用等），但是当您处理需要的类时，它确实非常方便每天动态修改几次，因为这些修改不需要任何类型的应用程序重启（例如，App_Code 更改，更新 bin 文件夹中的 dll）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-25T00:36:46.820

“没有任何。” 代码隐藏类动态编译成 DLL，然后保留该 DLL。所以基本上第一次加载页面时会有短暂的延迟，但之后的速度应该与预编译类相同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T00:54:59.163

初始编译后，您应该看不到任何性能问题。听起来好像您的业务逻辑经常发生变化，而不一定是网页。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-25T01:20:04.783

选择使用动态编译还是编译的 DLL 确实与发布过程的组织方式有关。如果您的应用程序被紧密编译成 DLL，那么您可以期望您已经测试了构建错误并期望在您发布时事情会更加稳固。使用动态编译，您可以动态交换 .cs 文件（例如拖放、ftp）。这意味着您可能更加敏捷，但您可能没有额外的保证步骤来帮助您知道您正在保持构建完好无损。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T08:35:41.087

**附带损害 - 会话重置**

从个人经验来看，用户更可能抱怨应用域回收导致的​​会话重置，而不是轻微的性能损失。因此，如果您可以将更改从代码转移到数据并完全避免代码更新，那么一定要这样做。这将提高您的用户的性能:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T00:37:43.263

我不相信在初始动态编译之后确实存在性能损失（这将发生在第一次点击修改了代码隐藏的页面时）。你是怎么最终不得不一天换几次课的？那会很糟糕！

**编辑：** 我应该补充一点，这不应该像你所说的那样影响单元测试或代码可重用性。没有什么可以阻止您出于可维护性目的部署非预编译站点，同时仍然能够在签入/构建期间运行单元测试、为其他项目部署已编译的程序集（如果需要）等。

但是，如果您没有使用源代码控制并且没有自动构建，那么就会出现一个全新的问题。我们的团队成员过去直接在生产服务器上编辑 CODE 文件。*颤抖*

# vb.net - 在没有 .NET 支持的情况下在 Visual Studio 2008 上编写 VB6？

> ID：130819
> 
> 赞同：8
> 
> 时间：2008-09-25T00:35:09.617
> 
> 标签：vb.net, visual-studio-2008, vb6

我必须继续支持VB6 应用程序。我已经安装了 VB6 (Visual Studio 6) 和 Visual Studio 2008。我可以在 Visual Studio 2008 中读写 VB6 项目吗？它会损坏或破坏我的 VB6 应用程序吗？如果我能腾出大量空间并摆脱 Visual Studio 6，那将是非常酷的。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-25T00:36:58.630

Visual Studio 2008 无法编译 VB6 应用程序。您只能将它用作文本编辑器（尽管它会为您提供 VB.NET IntelliSense，而不是 VB6）。但是，您需要 Visual Studio 6 才能构建您的应用程序。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-26T13:36:39.767

VB6 IDE 将非常愉快地与 Visual Studio 2008 共存。

VB.NET LANGUAGE 与 VB6 相关但不兼容。VB6 和 VB.NET 之间的转换是有问题的。两者之间存在许多细微和粗略的差异，使它们有效地分离了语言。

您需要在计算机上同时安装单独的 IDES 和库，以便处理这两种语言。

如果您需要两者互操作，您可以通过创建 COM 库来实现。两种语言都可以使用在另一种语言中创建的 COM 库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T00:39:09.327

如果您删除 VB6，您将无法构建您的 VB6 应用程序？VS2002/3/5/8 不知道如何编译VB6 项目。

# jquery - Delphi 中的 JQuery TypeWatch 功能

> ID：130822
> 
> 赞同：3
> 
> 时间：2008-09-25T00:36:12.813
> 
> 标签：jquery, delphi, typewatch

TypeWatch 是一个 JQuery 插件，用于监控文本输入框中击键之间的时间。

它允许在用户键入搜索词时刷新搜索结果等功能，如 Stack Overflow 的“用户”页面所示。

如果您正在输入您希望搜索的用户的名称并暂停输入半秒钟，则会出现您已输入内容的搜索结果。

有没有人有任何关于如何以类似方式在delphi中监控文本框的示例或信息，因为用户正在输入触发另一个事件，如果它在一段时间内停止输入，比如半秒。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T01:26:34.517

您可以查看常规 ComboBox 的自动完成功能背后的想法。
或者实现一个 Timer，它在 Edit 中的每个 Keypress 处重置为 0，并在达到您指定的延迟时触发其 onTimer 事件处理程序（即在此时间间隔内没有键输入之后）。
我很确定有可用的免费组件来实现这个......

# 3d - 3d 到 2d 投影矩阵

> ID：130829
> 
> 赞同：16
> 
> 时间：2008-09-25T00:37:52.887
> 
> 标签：3d, geometry, matrix, 2d, projection

我在 3D 空间中有 3 个点，我知道它们的确切位置。假设它们是`(x0,y0,z0)`：`(x1,y1,z1)`和`(x2,y2,z2)`。

此外，我有一台正在查看这 3 个点的相机，并且我知道这三个点在相机视图平面上的 2D 位置。例如，从相机的角度来看，将会是，`(x0,y0,z0)`将会是`(x0',y0')`，并且将会`(x1,y1,z1)`是。`(x1',y1')``(x2,y2,z2)``(x2',y2')`

找到将这些 3D 点投影到相机视图平面上的 2D 点的投影矩阵的最简单方法是什么。我们对相机位置一无所知。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-25T01:07:10.307

这为您提供了两组，每组 3 个变量中的三个方程：

```
a*x0+b*y0+c*z0 = x0'
a*x1+b*y1+c*z1 = x1'
a*x2+b*y2+c*z2 = x2'

d*x0+e*y0+f*z0 = y0'
d*x1+e*y1+f*z1 = y1'
d*x2+e*y2+f*z2 = y2' 
```

只需使用在您的情况下最容易解决联立方程的任何方法（“手动”解决这些问题甚至都不难）。那么你的变换矩阵就是 ((a,b,c)(d,e,f))。

...

实际上，这过于简化了，并假设相机指向您的 3D 坐标系的原点并且没有透视。

从角度来看，变换矩阵的工作原理更像：

```
 ( a, b, c, d )   ( xt )
( x, y, z, 1 ) ( e, f, g, h ) = ( yt )
               ( i, j, k, l )   ( zt )

( xv, yv ) = ( xc+s*xt/zt, yc+s*yt/zt ) if md < zt; 
```

但是 4x3 矩阵比 12 自由度更受约束，因为我们应该有

```
a*a+b*b+c*c = e*e+f*f+g*g = i*i+j*j+k*k = 1
a*a+e*e+i*i = b*b+f*f+j*j = c*c+g*g+k*k = 1 
```

因此，您可能应该有 4 个点来获得 8 个方程来涵盖相机位置和角度的 6 个变量以及 1 个用于缩放二维视点的变量，因为我们将能够消除“中心”坐标 (xc,yc ）。

因此，如果您有 4 个点并将您的 2-D 视点转换为相对于显示器的中心，那么您可以获得 13 个变量的 14 个联立方程并求解。

不幸的是，其中六个方程不是线性方程。幸运的是，这些方程中的所有变量都限制在 -1 和 1 之间的值，因此求解方程仍然可能是可行的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T01:13:25.830

您的相机（至少）有 7 个自由度 - 3 个用于位置，3 个用于方向，1 个用于 FOV。如果我错了，我相信有人会纠正我，但似乎 3 分不足以获得完整的解决方案。

有关此问题的通用解决方案，请查看 Graphics Gems II 中的“查看相关性”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-02-14T09:35:35.630

您正在寻找的是所谓的姿势估计算法。看看 OpenCV 中的 POSIT 实现：http: [//opencv.willowgarage.com/documentation/c/calib3d_camera_calibration_and_3d_reconstruction.html#posit](http://opencv.willowgarage.com/documentation/c/calib3d_camera_calibration_and_3d_reconstruction.html#posit)

您将需要四个或更多点，它们可能不在同一平面上。

这个实现的教程在这里： http: [//opencv.willowgarage.com/wiki/Posit](http://opencv.willowgarage.com/wiki/Posit)

但请注意：在本教程中使用了方形视口，因此所有视图坐标都在 -1,-1 到 1,1 范围内。这导致人们假设这些应该在相机坐标系中（在宽高比校正之前）。情况并非如此，因此如果您使用纵横比为 4:3 的视口，那么您的输入坐标应该在 -1.3333,-1 到 1.3333,1 的范围内。

顺便说一句，如果您的点*必须*位于同一平面上，那么您也可以查看 OpenCV 中的 CameraCalibration 算法，但这需要更多的设置，并且需要更多的点作为输入。但是，它也会为您提供相机的失真信息和内在参数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T01:08:34.513

我认为没有足够的信息来找到最终的解决方案。在不知道相机位置和视图平面的情况下，有无数个矩阵可以解决这个问题。

# javascript - 我应该使用什么（JavaScript）正则表达式来确保字符串是有效的文件名？

> ID：130837
> 
> 赞同：1
> 
> 时间：2008-09-25T00:39:34.490
> 
> 标签：javascript, regex, filenames

我目前仍在学习 RegEx，但暂时有人可以帮我解决这个问题吗？我对格式化字符串有一些特殊要求：

1.  没有目录。只是文件名。
2.  文件名必须全部小写。
3.  空格需要用下划线代替。

应该不难，但我时间紧迫，我不确定确保文件名有效的“正确”方式（即我忘记了哪些字符应该对文件名无效）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T00:41:38.947

如果您非常着急，通常可以在[http://regexlib.com/](http://regexlib.com/)的库中找到可接受的正则表达式。编辑说： [这可能对您有用](http://regexlib.com/REDetails.aspx?regexp_id=1934)：

```
([0-9a-z_-]+[\.][0-9a-z_-]{1,3})$ 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T12:54:49.103

如果您从用户那里获取字符串路径（例如，通过读取文件上传字段的 .value），您实际上无法确定路径分隔符是什么。它可能是反斜杠（Windows）、正斜杠（Linux、OS X、BSD 等）或其他完全在旧的或晦涩的操作系统上的东西。在正斜杠或反斜杠上拆分路径将涵盖常见情况，但最好包含用户覆盖文件名的功能，以防我们猜错了。

至于“无效字符”，这些也取决于操作系统。可能最简单的方法是将所有非字母数字替换为占位符，例如下划线。

这是我使用的：

```
var parts= path.split('\\');
parts= parts[parts.length-1].split('/');
var filename= parts[parts.length-1].toLowerCase();
filename= filename.replace(new RegExp('[^a-z0-9]+', 'g'), '_');
if (filename=='') filename= '_' 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T02:02:05.450

我建议使用 RegExp 和其他 javascript 的简单组合：

```
var a = "c:\\some\\path\\to\\a\\file\\with Whitespace.TXT";
a = a.replace(/^.*[\\\/]([^\\\/]*)$/i,"$1");
a = a.replace(/\s/g,"_");
a = a.toLowerCase();
alert(a); 
```

# javascript - 如何在 IE6 中添加 using Element with Prototype？ 使用 Prototype 1.6 的“new Element(...)”我试图创建一个 <table> 元素同时具有 <thead> 和 <tbody> 但在 IE6 中没有任何反应。 var tableProto = new Element('table').update('<thead><tr> 问问题 Zack Mulgrew 问问题 2008-09-25T00:40:36.983 5387 次 This question shows research effort; it is useful and clear 4 This question does not show any research effort; it is unclear or not useful Bookmark this question. Show activity on this post. 使用 Prototype 1.6 的“new Element(...)”我试图创建一个 <table> 元素同时具有 <thead> 和 <tbody> 但在 IE6 中没有任何反应。 var tableProto = new Element('table').update('<thead><tr><th>Situation Task</th><th>Action</th><th>Result</th></tr></thead><tbody><tr><td>a</td><td>b</td><td>c</td></tr></tbody>'); 然后我尝试像这样注入它的副本： $$('div.question').each(function(o) { Element.insert(o, { after:$(tableProto.cloneNode(true)) }); }); 我当前的解决方法是创建一个 <div> 而不是 <table> 元素，然后使用所有表格 HTML 来“更新”它。 如何成功地做到这一点？ 如果原型的 .update() 方法在内部尝试设置 .innerHTML 它将在 IE 中失败。在 IE 中，表格元素的 .innerHTML 是只读的。 来源： http://webbugtrack.blogspot.com/2007/12/bug-210-no-innerhtml-support-on-tables.html javascriptdomprototypejs 4 2 回答 2 This answer is useful 5 事实证明，我在问题中提供的示例代码没有任何问题——它在 IE6 中运行得很好。我面临的问题是我还在构造函数中错误地为 <table> 元素指定了一个类，但在我的示例中省略了这一点。 “真实”代码如下，并且不正确： var tableProto = new Element('table', { class:'hide-on-screen'} ).update('<thead><tr><th>Situation Task</th><th>Action</th><th>Result</th></tr></thead><tbody><tr><td>a</td><td>b</td><td>c</td></tr></tbody>'); 这在 Firefox 中正常工作，但在 IE6 中失败，因为它是错误的。 通过此构造函数向元素添加属性的正确方法是提供字符串，而不仅仅是属性名称。以下代码适用于两种浏览器： var tableProto = new Element('table', { 'class':'hide-on-screen'} ).update('<thead><tr><th>Situation Task</th><th>Action</th><th>Result</th></tr></thead><tbody><tr><td>a</td><td>b</td><td>c</td></tr></tbody>'); 由于“类”是 JavaScript 中的保留字，因此出现错误。嗬！ 对于那些不提供实际代码的人来说，这是一个教训！ 于 2008-09-25T04:21:25.347 回答 This answer is useful 2 如果原型的 .update() 方法在内部尝试设置 .innerHTML 它将在 IE 中失败。在 IE 中，表格元素的 .innerHTML 是只读的。 资源： http://webbugtrack.blogspot.com/2007/12/bug-210-no-innerhtml-support-on-tables.html 于 2008-09-25T00:59:13.787 回答 Related 1 android - 从不工作的网站检索数据 (Android) 2 windows - 通过批处理“CMD”文件为特定系统执行特定工作 2 android - Android Image 应用 OutOfMemory 再次 1 android - Android导致错误 1 ruby-on-rails - 在显示视图中编辑 has_many 对象属性。简单的值增量不会更新 1 asp.net - ASP.NET Javascript Minification with Map 1 c# - SaveAdd 抛出“GDI+ 中发生一般错误” 2 winapi - 如何在基本文本窗口win32 c ++中更改文本大小 0 php - PHP/Apache 显示来自不同服务器的站点 1 opencv - 减少行人检测中的错误检测 Reference php × 1429865 c/c++ × 756500 nginx × 49975 mongodb × 159057 mybatis × 3233 anaconda × 13410 pycharm × 14671 python × 1902243 vscode × 56040 docker × 110988 github × 49000 flask × 49129 ffmpeg × 24037 jmeter × 16910 matplotlib × 63493 bootstrap × 54641

> ID：130843
> 
> 赞同：4
> 
> 时间：
> 
> 标签：javascript, dom, prototypejs

使用 Prototype 1.6 的“new Element(...)”我试图创建一个 <table> 元素同时具有 <thead> 和 <tbody> 但在 IE6 中没有任何反应。

```
var tableProto = new Element('table').update('<thead><tr><th>Situation Task</th><th>Action</th><th>Result</th></tr></thead><tbody><tr><td>a</td><td>b</td><td>c</td></tr></tbody>'); 
```

然后我尝试像这样注入它的副本：

```
$$('div.question').each(function(o) {
  Element.insert(o, { after:$(tableProto.cloneNode(true)) });
}); 
```

我当前的解决方法是创建一个 <div> 而不是 <table> 元素，然后使用所有表格 HTML 来“更新”它。

如何成功地做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-25T04:21:25.347

事实证明，我在问题中提供的示例代码没有任何问题——它在 IE6 中运行得很好。我面临的问题是我还在构造函数中错误地为 <table> 元素指定了一个类，但在我的示例中省略了这一点。

“真实”代码如下，并且不正确：

```
var tableProto = new Element('table', { class:'hide-on-screen'} ).update('<thead><tr><th>Situation Task</th><th>Action</th><th>Result</th></tr></thead><tbody><tr><td>a</td><td>b</td><td>c</td></tr></tbody>'); 
```

这在 Firefox 中正常工作，但在 IE6 中失败，因为它是**错误**的。

通过此构造函数向元素添加属性的正确方法是提供字符串，而不仅仅是属性名称。以下代码适用于两种浏览器：

```
var tableProto = new Element('table', { 'class':'hide-on-screen'} ).update('<thead><tr><th>Situation Task</th><th>Action</th><th>Result</th></tr></thead><tbody><tr><td>a</td><td>b</td><td>c</td></tr></tbody>'); 
```

由于“类”是 JavaScript 中的保留字，因此出现错误。嗬！

对于那些不提供**实际**代码的人来说，这是一个教训！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T00:59:13.787

如果原型的 .update() 方法在内部尝试设置 .innerHTML 它将在 IE 中失败。在 IE 中，**表格元素的 .innerHTML 是只读的**。

资源：

[http://webbugtrack.blogspot.com/2007/12/bug-210-no-innerhtml-support-on-tables.html](http://webbugtrack.blogspot.com/2007/12/bug-210-no-innerhtml-support-on-tables.html)

# excel - 您如何确定 VBA 中的夏令时？

> ID：130877
> 
> 赞同：5
> 
> 时间：2008-09-25T00:56:22.593
> 
> 标签：excel, vba, function, code-snippets, dst

什么函数可以让我们知道 VBA 中的日期是否在 DST 中？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-25T00:57:37.880

**对于非当前日期（DST 2007+）：**

首先，您需要一个函数来查找一个月中特定工作日的数量：

```
Public Function NDow(Y As Integer, M As Integer, _
                N As Integer, DOW As Integer) As Date  

' Returns Date of Nth Day of the Week in Month  

NDow = DateSerial(Y, M, (8 - Weekday(DateSerial(Y, M, 1), _
              (DOW + 1) Mod 8)) + ((N - 1) * 7))  

End Function 
```

然后，您可以检查 DST 日与以下函数调用：

秋季：NDow(Year(newdate), 11, 1, 1)
春季：NDow(Year(newdate), 3, 2, 1)

**对于当前日期：**

调用 Windows API 函数 GetTimeZoneInformation，它将返回一个带有状态的枚举（整数）。

我从 Chip Pearson 的 Excel 网站获得了代码。

[皮尔逊的网站](http://www.cpearson.com/excel/MainPage.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-12-18T13:58:38.773

对于想知道如何计算欧洲夏令时（欧洲中部时间）的任何人，我修改了来自[Chip Pearson](http://www.cpearson.com/excel/DaylightSavings.htm)的脚本。3 月的最后一个星期日（凌晨 2 点至凌晨 3 点）和 10 月的最后一个星期日（凌晨 3 点至凌晨 2 点）是发生时间切换的日子。

以下代码是 Excel 中按钮的单击事件：

```
Dim dates As String
dates = "A1:A20"

For Each c In Worksheets("Sheet1").Range(dates).Cells
    If (IsDateWithinDST(c.Value)) Then
        c.Value = DateAdd("h", 1, c.Value)
    End If
Next 
```

包含必要方法的模块可以在[这里](https://github.com/pheemery2/EuropeanDST)找到。

[有关欧洲 DST 的更多信息。](https://en.wikipedia.org/wiki/Summer_Time_in_Europe)

# php - 用于数据库连接的全局或单例？

> ID：130878
> 
> 赞同：81
> 
> 时间：2008-09-25T00:56:27.930
> 
> 标签：php, design-patterns, singleton

在 PHP 中使用单例而不是全局进行数据库连接有什么好处？我觉得使用单例而不是全局会使代码变得不必要地复杂。

## 全球代码

```
$conn = new PDO(...);

function getSomething()
{
    global $conn;
    .
    .
    .
} 
```

## 单例代码

```
class DB_Instance
{
    private static $db;

    public static function getDBO()
    {
        if (!self::$db)
            self::$db = new PDO(...);

        return self::$db;
    }
}

function getSomething()
{
    $conn = DB_Instance::getDBO();
    .
    .
    .
} 
```

如果除了全局或单例之外还有更好的初始化数据库连接的方法，请提及并描述它相对于全局或单例的优势。

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2008-10-20T19:37:20.160

我知道这是旧的，但 Dr8k 的答案*几乎*就在那里。

当您考虑编写一段代码时，假设它会发生变化。这并不意味着你假设它会在未来的某个时候对其进行更改，而是会进行某种形式的更改。

把它作为一个目标来减轻未来做出改变的痛苦：一个全局是危险的，因为它很难在一个地方进行管理。如果我想在将来让数据库连接上下文感知怎么办？如果我希望它在每 5 次使用时关闭并重新打开怎么办。如果我决定为了扩展我的应用程序我想使用一个包含 10 个连接的池怎么办？还是可配置的连接数？

单例**工厂**为您提供了这种灵活性。我以很少的额外复杂性进行设置，并且获得的不仅仅是访问相同的连接；我获得了稍后以简单的方式更改该连接传递给我的方式的能力。

请注意，我说的是*单例工厂*，而不是简单的*单例*。单例和全局之间几乎没有什么区别，真的。正因为如此，没有理由建立一个单例连接：当你可以创建一个常规的全局变量时，为什么还要花时间设置它呢？

工厂为您提供的是为什么要获得联系，以及一个单独的位置来决定您将获得哪些联系（或联系）。

## 例子

```
class ConnectionFactory
{
    private static $factory;
    private $db;

    public static function getFactory()
    {
        if (!self::$factory)
            self::$factory = new ConnectionFactory(...);
        return self::$factory;
    }

    public function getConnection() {
        if (!$this->db)
            $this->db = new PDO(...);
        return $this->db;
    }
}

function getSomething()
{
    $conn = ConnectionFactory::getFactory()->getConnection();
    .
    .
    .
} 
```

然后，在 6 个月内，当您的应用程序非常有名并被挖走并被 slashdotted 时，您决定需要多个连接，您所要做的就是在 getConnection() 方法中实现一些池化。或者，如果您决定想要一个实现 SQL 日志记录的包装器，您可以传递一个 PDO 子类。或者，如果您决定在每次调用时都需要一个新连接，您可以这样做。它是灵活的，而不是刚性的。

16 行代码，包括大括号，这将为您节省数小时和数小时的重构时间。

请注意，我不考虑这种“功能蔓延”，因为我在第一轮中没有做任何功能实现。这是“Future Creep”的边界线，但在某些时候，“为今天的明天编码”*总是*一件坏事的想法对我来说并不适用。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-25T01:05:47.047

我不确定我是否可以回答您的具体问题，但我想建议如果对于基于 Web 的系统，全局/单例连接对象可能不是最好的主意。DBMS 通常被设计为以有效的方式管理大量的唯一连接。如果您使用的是全局连接对象，那么您正在做几件事：

1.  强制您的页面按顺序执行所有数据库连接并终止异步页面加载的任何尝试。

2.  可能在数据库元素上保持打开锁的时间超过必要时间，从而降低整体数据库性能。

3.  最大化您的数据库可以支持的同时连接总数，并阻止新用户访问资源。

我相信还有其他潜在的后果。请记住，此方法将尝试为访问该站点的每个用户维持数据库连接。如果您只有一两个用户，那不是问题。如果这是一个公共网站并且您想要流量，那么可扩展性将成为一个问题。

**[编辑]**

在更大规模的情况下，每次访问数据时都创建新连接可能很糟糕。但是，答案不是创建一个全局连接并将其重用于所有内容。答案是连接池。

使用连接池，可以维护许多不同的连接。当应用程序需要连接时，将从池中检索第一个可用连接，然后在其工作完成后将其返回到池中。如果请求连接并且没有可用的连接，将发生以下两种情况之一：a) 如果未达到允许的最大连接数，则打开一个新连接，或 b) 应用程序被迫等待连接变为可用.

**注意：**在 .Net 语言中，连接池默认由 ADO.Net 对象处理（连接字符串设置所有必需的信息）。

感谢克拉德对此发表评论。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-12-13T00:35:10.247

创建单例方法是为了确保任何类只有一个实例。但是，由于人们将其用作快捷全球化的一种方式，因此它被称为懒惰和/或糟糕的编程。

因此，我会忽略 global 和 Singleton，因为两者都不是真正的 OOP。

您正在寻找的是**依赖注入**。

[您可以在http://components.symfony-project.org/dependency-injection/trunk/book/01-Dependency-Injection](http://components.symfony-project.org/dependency-injection/trunk/book/01-Dependency-Injection)上查看易于阅读的与依赖注入相关的基于 PHP 的信息（带有示例）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-25T02:44:19.760

这两种模式实现了相同的净效果，为您的数据库调用提供了一个单一的访问点。

在具体实现方面，单例有一个小优势，即在您的至少一个其他方法请求它之前不启动数据库连接。实际上，在我编写的大多数应用程序中，这并没有太大的区别，但是如果您有一些根本不进行任何数据库调用的页面/执行路径，这是一个潜在的优势，因为这些页面不会曾经请求连接到数据库。

另一个小的区别是全局实现可能会无意中践踏应用程序中的其他变量名。您不太可能意外地声明另一个全局 $db 引用，尽管您可能会意外地覆盖它（例如，当您打算编写 if($db == null) 时，您编写了 if($db = null)。单例对象可以防止这种情况。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T01:03:55.867

如果您不打算使用持久连接，并且在某些情况下不这样做，我发现单例在概念上比面向对象设计中的全局更可口。

在真正的 OO 架构中，单例比每次都为对象创建一个新实例更有效。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-25T01:06:13.053

在给定的示例中，我认为没有理由使用单例。根据经验，如果我唯一关心的是允许对象的单个实例，如果语言允许，我更喜欢使用全局变量

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-25T01:14:39.803

一般来说，我会使用单例进行数据库连接...您不想每次需要与数据库交互时都创建新连接...这可能会损害网络的性能和带宽...为什么要创建一个新的，当有可用的时候......只要我的 2 美分......

温迪

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-25T00:59:56.470

这很简单。永远不要使用全局 OR Singleton。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-05-27T18:36:25.827

作为建议，**单例**和**全局**都是有效的，并且可以在同一个*系统、项目、插件、产品等*中加入......在我的例子中，我为网络（插件）制作数字产品。

我在主类中只使用**单例**，并且我原则上使用它。我几乎不使用它，因为我知道主类不会再次实例化它

```
<?php // file0.php

final class Main_Class
{
    private static $instance;
    private $time;

    private final function __construct()
    {
        $this->time = 0;
    }
    public final static function getInstance() : self
    {
        if (self::$instance instanceof self) {
            return self::$instance;
        }

        return self::$instance = new self();
    }
    public final function __clone()
    {
        throw new LogicException("Cloning timer is prohibited");
    }
    public final function __sleep()
    {
        throw new LogicException("Serializing timer is prohibited");
    }
    public final function __wakeup()
    {
        throw new LogicException("UnSerializing timer is prohibited");
    }
} 
```

**几乎所有次要课程的全球**使用，例如：

```
<?php // file1.php
global $YUZO;
$YUZO = new YUZO; // YUZO is name class 
```

而在运行时，我可以使用**Global**在同一个实例中调用它们的方法和属性，因为我不需要我的主要产品类的另一个实例。

```
<?php // file2.php
global $YUZO;
$YUZO->method1()->run();
$YUZO->method2( 'parameter' )->html()->print(); 
```

我得到的全局是使用相同的实例来使产品工作，因为我不需要同一类的实例的工厂，通常实例工厂用于大型系统或非常罕见的目的。

`In conclusion:`，如果你已经很好地理解了反模式**Singleton**并且理解了**Global**，你必须使用这两个选项之一或混合它们，但如果我建议不要滥用，因为有很多程序员非常例外并且忠实于编程 OOP，将它用于在执行时间内经常使用的主要和次要类。（它为你节省了大量的 CPU）。

# ubuntu - 如何从源代码构建 Debian/Ubuntu 软件包？

> ID：130894
> 
> 赞同：117
> 
> 时间：2008-09-25T01:01:39.837
> 
> 标签：ubuntu, debian, packaging

我有一个程序的源代码（取自 cvs/svn/git/...），我想为它构建一个 Debian/Ubuntu 软件包。该软件包存在于存储库中，但是：

*   这是一个旧版本（缺少我需要的功能）
*   我需要的编译选项与默认选项略有不同。

最简单的方法是什么？我担心几件事

*   如何检查我是否正确列出了所有依赖项？（我可以通过查看旧版本所依赖的内容来获得一些提示，但可能已经添加了新的依赖项。）
*   如何防止更新系统在更新时在 repo 中安装旧版本？
*   如何防止系统安装更新版本（当它出来时）覆盖我的自定义包？

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2008-11-21T14:40:08.907

您可以对所有尚未在 debian/ubuntu 中的软件包使用特殊软件包“checkinstall”。

您可以使用 "uupdate" ( `apt-get install devscripts`) 从包含现有 debian 源代码的源代码构建包：

libdrm2 的示例：

```
apt-get build-dep libdrm2
apt-get source libdrm2
cd libdrm-2.3.1
uupdate ~/Downloads/libdrm-2.4.1.tar.gz
cd ../libdrm-2.4.1
dpkg-buildpackage -us -uc -nc 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-25T02:00:51.597

首先，标题问题：假设debian目录已经存在，在源目录（包含debian目录的目录）并调用dpkg-buildpackage。我喜欢使用以下选项运行它：

```
dpkg-buildpackage -us -uc -nc 
```

这意味着不要签署结果并且不要清理。

> 如何检查我是否正确列出了所有依赖项？

获取依赖项是一门黑色艺术。“官方”的方式是检查构建依赖是否仅使用基本系统、“构建基本”包和您指定的构建依赖项构建。不知道常规依赖项的一般答案，只是涉足:)

> 如何防止更新系统在更新时在 repo 中安装旧版本？如何防止系统安装更新版本（当它出来时）覆盖我的自定义包？

我的知识可能已经过时了，但要解决这两个问题：使用 dpkg --set-selections。假设 nullidentd 是您想要保留的包，以 root 身份运行

```
echo 'nullidentd hold' | dpkg --set-selections 
```

或者，由于您是从源代码构建的，因此您可以使用[epoch](http://www.us.debian.org/doc/debian-policy/ch-controlfields.html#s-f-Version)将版本号人为地设置为高，并且再也不会被打扰。要使用 epoch，请在 debian/changelog 文件中添加一个新条目，并在版本号前面放置一个 99:。鉴于我的 nullidentd 示例，您更新的变更日志的第一行将显示为：

```
nullidentd (99:1.0-4) unstable; urgency=low 
```

[Bernard 的链接](http://www.debian.org/doc/maint-guide/)很好，特别是如果您必须自己创建 debian 目录 -[开发人员参考](http://www.us.debian.org/doc/developers-reference/)和[一般资源页面](http://www.us.debian.org/devel/)也很有帮助。 [亚当的链接](http://tldp.org/HOWTO/html_single/Debian-Binary-Package-Building-HOWTO/)看起来也不错，但我不熟悉。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-09-18T21:16:43.690

**基于 Ubuntu 的**ccache构建示例：

```
sudo apt-get update
sudo apt-get build-dep ccache
apt-get -b source ccache
sudo dpkg -i ccache*.deb 
```

更多细节：[http ://blog.aplikacja.info/2011/11/building-packages-from-sources-in-debianubuntu/](http://blog.aplikacja.info/2011/11/building-packages-from-sources-in-debianubuntu/)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-25T15:00:57.510

对于您想要做的事情，您可能想要使用 debian 源 diff，因此您的包与使用的上游版本之外的官方包相似。[您可以从packages.debian.org](http://packages.debian.org)下载源 diff ，或者可以使用“apt-get source”将其与 .dsc 和原始源存档一起获取。

然后解压新版本的上游源代码，切换到该目录，然后通过执行以下操作应用下载的差异

```
zcat ~/downloaded.diff.gz | patch -p1
chmod +x debian/rules 
```

然后进行您想要编译选项的更改，并通过执行构建包

```
dpkg-buildpackage -rfakeroot -us -uc 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-07-29T03:55:38.410

*   put "debian" directory from original package to your source directory
*   use "[dch](http://manpages.ubuntu.com/manpages/lucid/man1/dch.1.html)" to update version of package
*   use "debuild" to build the package

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-25T01:06:32.913

我相信[这](http://www.debian.org/doc/maint-guide/)是 Debian 软件包“圣经”。

嗯，这是 Debian 新维护者指南，所以很多内容都不适用，但它们确实涵盖了哪些内容。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-03-06T00:10:09.990

如果您使用的是 Ubuntu，请查看 pkgcreator 项目： [http ://code.google.com/p/pkgcreator](http://code.google.com/p/pkgcreator)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-03-08T16:01:31.077

如果您想要一种快速而肮脏的方式来安装构建依赖项，请使用：

```
apt-get build-dep 
```

这将安装依赖项。为此，您需要 sources.list 中的源代码行：

```
deb-src http://ftp.nl.debian.org/debian/ squeeze-updates main contrib non-free 
```

如果您将包从测试向后移植到稳定，请注意依赖关系可能已更改。命令 apt-get build-deb 为当前存储库中的源包安装依赖项。

但当然， dpkg-buildpackage -us -uc 会显示任何已卸载的依赖项。

如果您想更频繁地编译，请使用 cowbuilder。

```
apt-get install cowbuilder 
```

然后创建一个构建区域：

sudo DIST=squeeze ARCH=amd64 cowbuilder --create

然后编译一个源码包：

```
apt-get source cowsay

# do your magic editing
dpkg-source -b cowsay-3.03+dfsg1              # build the new source packages
cowbuilder --build cowsay_3.03+dfsg1-2.dsc    # build the packages from source 
```

观察 cowbuilder 将生成的包放在哪里。

祝你好运！

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-25T01:27:07.153

[这](http://tldp.org/HOWTO/html_single/Debian-Binary-Package-Building-HOWTO/)是构建 Debian 软件包的教程。

基本上，您需要：

1.  设置文件夹结构
2.  创建**控制**文件
3.  可选择创建**postinst**或**prerm**脚本
4.  运行 dpkg-deb

我通常在我的 Makefile 中完成所有这些操作，因此我只需键入**make**即可吐出二进制文件并将其打包。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-11-03T14:29:11.303

> 如何检查我是否正确列出了所有依赖项？

通过`pbuilder`在 chroot 环境中设置干净的基础系统，它是检查构建依赖关系和依赖关系的优秀工具。通过在 pbuilder 中编译包，您可以轻松检查构建依赖关系，并通过在 pbuilder 环境中对其进行测试，您可以检查依赖关系。

# c# - C# 列表推导简介

> ID：130898
> 
> 赞同：62
> 
> 时间：2008-09-25T01:03:25.807
> 
> 标签：c#, linq

如何在 C# 中执行列表推导？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-06-05T03:00:35.677

列表理解是一种集合符号，程序员可以在其中描述集合成员必须满足的属性。它通常用于通过对现有集合应用某种类型的组合、变换或归约函数来基于其他已经存在的一个或多个集合创建一个集合。

考虑以下问题：您有一个从 0 到 9 的 10 个数字序列，您需要从该序列中提取所有偶数。在诸如 C# 1.1 版这样的语言中，您几乎只能使用以下代码来解决此问题：

```
ArrayList evens = new ArrayList();
ArrayList numbers = Range(10);
int size = numbers.Count;
int i = 0;

while (i < size) 
{
    if (i % 2 == 0) 
    {
        evens.Add(i);
    }
    i++;
} 
```

上面的代码没有显示 Range 函数的实现，它在下面的完整代码列表中可用。随着 C# 3.0 和 .NET Framework 3.5 的出现，基于 Linq 的列表理解表示法现在可供 C# 程序员使用。上面的 C# 1.1 代码可以像这样移植到 C# 3.0：

```
IEnumerable<int> numbers = Enumerable.Range(0, 10);
var evens = from num in numbers where num % 2 == 0 select num; 
```

*从技术上讲，通过将对 Enumarable.Range的调用移动到生成**事件*序列的 Linq 表达式，可以将上面的 C# 3.0 代码编写为单行代码。在 C# List Comprehension 中，我通过将函数（模 2）应用于该序列来减少集合*数。*这会以更简洁的方式生成*偶数序列，并避免使用循环语法。*现在，你可能会问自己：这纯粹是语法糖吗？我不知道，但我肯定会调查，甚至可能自己在这里问这个问题。我怀疑这不仅仅是语法糖，还有一些真正的优化可以通过利用底层 monad 来完成。

完整的代码清单可[在此处](http://thestandardoutput.com/2009/06/list-comprehensions-in-c/)获得。

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2009-03-26T01:43:08.963

当我在查找如何在 C# 中进行列表推导时发现了这个...

当有人说列表推导时，我会立即想到 Python。下面的代码生成一个如下所示的列表：

```
[0,2,4,6,8,10,12,14,16,18] 
```

Python的方式是这样的：

```
list = [2*number for number in range(0,10)] 
```

在 C# 中：

```
var list2 = from number in Enumerable.Range(0, 10) select 2*number; 
```

两种方法都是惰性评估的。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-25T01:17:28.347

@Ian P

```
 return (from user in users
         where user.Valid
         select user.Name).ToArray(); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-25T01:11:38.767

您可以使用 LINQ 生成类似于列表推导式的表达式。这是一个稍微解释一下的网站：

[使用 LINQ 的 C# 中的列表理解](http://artyprog.blogspot.com/2008/07/list-comprehension-in-c-with-linq.html)

[使用 LINQ 在 C# 中理解列表 - 第 2 部分](http://artyprog.blogspot.com/2008/07/list-comprehension-in-c-with-linq-part.html)

* * *

## 回答 #5

> 赞同：-7
> 
> 时间：2008-09-25T01:08:48.850

虽然这不是教程，但这里有一些代码说明了这个概念：

```
public List<string> ValidUsers(List<User> users) {
  List<string> names = new List<string>();
  foreach(User user in users) {
    if(user.Valid) {
      names.Add(user.Name);
    }
  }
  return names;
} 
```

# c++ - Eclipse 中 C++ 重构支持的状态如何？

> ID：130913
> 
> 赞同：20
> 
> 时间：2008-09-25T01:08:34.390
> 
> 标签：c++, eclipse, refactoring

它是否处于实际有用的状态并且可以做的不仅仅是重命名类？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-25T01:12:44.380

CDT (C/C++ Development Tools - eclipse project) 5.0 有一堆新的重构

```
* Declare Method
* Extract Baseclass
* Extract Constant
* Extract Method
* Extract Subclass
* Hide Method
* Implement Method
* Move Field / Method
* Replace Number
* Separate Class
* Generate Getters and Setters 
```

有一个 CDT 重构[wiki](http://r2.ifs.hsr.ch/cdtrefactoring)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-20T08:29:27.420

为 C++ 提供重构工具已经做了很多努力，但大部分都在很早的时候就失败了，因为创建这些工具需要完全具备处理 C++ 源代码的能力，也就是说，首先你需要一个可以工作的完整的 c++ 编译器来实现即使是最基本的自动源到源转换形式。

幸运的是，随着在 gcc 中引入[插件](http://gcc.gnu.org/wiki/plugins)，最终可以预见的是，相关工作实际上可能能够利用现有的 C++ 编译器来实现这一目的，而不必求助于他们自己的 C++ 编译器实现。

如需更深入的讨论，您可能需要查看[此](http://www.crystalclearsoftware.com/cgi-bin/boost_wiki/wiki.pl?action=browse&id=BoostSpiritCXXParser&revision=48)内容。

目前，提供广泛自动化 C++ 重构支持的最有希望的候选者无疑是 Mozilla[猪肉](https://wiki.mozilla.org/pork)项目，以及其相关的配套项目[Dehydra](https://developer.mozilla.org/En/Dehydra)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-12-10T10:47:54.983

例如 Ref++ 支持的一些 C++ 重构不需要完全理解 C++ 语法。例如上拉法、下推法等非常简单。出于某种原因，这种重构并未针对 CDT 重构实施。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T15:12:43.957

是的，如果代码太复杂，它们中的大多数实际上都不起作用。移动方法、重命名等有时会出现问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-07T21:07:34.307

C++ 是一种很难提供重构支持的语言。这是因为语言非常复杂且难以解析，但这主要是因为预处理器。

预处理器是 C/C++ IDE 落后于其他语言的主要原因。

# optimization - 将文件保存在 OS 块缓冲区中

> ID：130916
> 
> 赞同：2
> 
> 时间：2008-09-25T01:09:41.487
> 
> 标签：optimization, memory-management, caching, filesystems, performance

我需要在操作系统块缓存中保留尽可能多的大文件，即使它比我可以放入 ram 的要大，而且我正在不断地读取另一个非常大的文件。ATM 当我从另一个文件流式读取时，我将从系统缓存中删除大块的大型重要文件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-25T01:26:53.877

在 linux 中，您可以将文件系统挂载为*tmpfs*类型，如果需要，它使用可用的交换内存作为支持。您应该能够创建一个大于内存大小的文件系统，并且它将优先考虑该文件系统在系统缓存中的内容。

```
mount -t tmpfs none /mnt/point 
```

见： http: [//lxr.linux.no/linux/Documentation/filesystems/tmpfs.txt](http://lxr.linux.no/linux/Documentation/filesystems/tmpfs.txt)

您还可以从这些文件中`swapiness`受益`drop_cache``/proc/sys/vm`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T17:11:35.210

如果您使用的是 Windows，请考虑使用标志打开您正在扫描的文件

```
FILE_FLAG_SEQUENTIAL_SCAN 
```

你也可以使用

```
FILE_FLAG_NO_BUFFERING 
```

对于该文件，但它对您的读取大小和缓冲区对齐施加了一些限制。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T17:21:30.007

在 Linux 或 Solaris 等 POSIX 系统中，尝试使用 posix_fadvise。

在流文件上，执行以下操作：

```
posix_fadvise(fd, 0, 0, POSIX_FADV_SEQUENTIAL);
while( bytes > 0 ) {
  bytes = pread(fd, buffer, 64 * 1024, current_pos);
  current_pos += 64 * 1024;
  posix_fadvise(fd, 0, current_pos, POSIX_FADV_DONTNEED);
} 
```

您可以将 POSIX_FADV_WILLNEED 应用于您的其他文件，这应该会提高其内存优先级。

现在，我知道 Windows Vista 和 Server 2008 也可以在内存优先级方面做一些漂亮的事情。可能像 XP 这样的旧版本也可以做更多的基本技巧。但我不知道我脑海中的功能，也没有时间查找它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T01:20:21.617

某些操作系统具有 ramdisk，您可以使用它来留出一段 ram 用于存储，然后将其挂载为文件系统。

但是，我不明白为什么要阻止操作系统缓存文件。你的完整问题对我来说真的没有意义。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T10:53:10.803

购买更多的内存（它相对便宜！）或让操作系统做它的事情。我想你会发现绕过操作系统会比它的价值更麻烦。操作系统将根据需要缓存尽可能多的文件，直到您的或任何其他应用程序需要内存。

我想你可以尽量减少进程的数量，但购买更多的内存可能会更快。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T17:07:07.997

mlock() 和 mlockall() 分别将调用进程的部分或全部虚拟地址空间锁定到 RAM 中，防止该内存被分页到交换区域。

（从 MLOCK(2) Linux 手册页复制）

# coding-style - 设计和编码 - 从上到下还是从下到上？

> ID：130933
> 
> 赞同：11
> 
> 时间：2008-09-25T01:15:37.557
> 
> 标签：coding-style

在编码时，根据您的经验，更好的方法是什么？

1.  将问题分解成足够小的部分，然后实施每一部分。
2.  分解问题，然后使用自上而下的方法实施。
3.  任何其他？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-25T02:40:43.590

我倾向于设计自上而下并实施自下而上。

对于实现，构建最小的功能部件并将它们组装到更高级别的结构中似乎是最适合我的方法。但是，对于设计，我需要从整体情况开始，然后分解以确定这些部分将是什么。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-25T01:28:44.543

这就是我所做的：

先了解领域。了解要解决的问题。确保您和客户（即使那个客户就是您！）对于要解决的问题在同一页面上。

然后针对这个问题提出一个高层次的解决方案，然后设计将变成页面上的气泡或项目符号或其他任何东西，但关键是它会变成可以设计的组件。

那时，我为尚未编写的类编写测试，然后充实这些类以通过这些测试。

我使用测试优先的方法并构建工作的、经过测试的组件。这对我有用。当组件接口已知并且“规则”知道它们如何相互通信并相互提供服务时，那么它通常会变成一个简单的“将所有东西连接在一起”的练习。

我就是这样做的，而且对我来说效果很好。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-25T01:22:45.900

您可能想查看[敏捷宣言](http://agilemanifesto.org/)。自上而下和自下而上的前提是“一次性构建”的设计和构造。

“工作软件优于综合文档”意味着您构建的第一件事是您可以运行的最小有用的东西。最佳？底部？两者都不。

* * *

当我年轻的时候，我从事的项目——根据合同——严格自上而下。这行不通。确实，它行不通。结果，您会得到大量的冗余设计和代码。盲目应用时，这不是一个合理的方法。

我注意到敏捷方法——有效的小部分——倾向于将问题分解为可以一次全部掌握的部分。自上而下/自下而上不再那么重要。事实上，这可能根本不重要。

哪些线索会：“你如何分解敏捷开发？” 诀窍是避免创建必须分解**的大事物。**如果你分析一个问题，你会发现参与者试图完成用例并且失败了，因为他们没有所有的信息，或者他们没有及时获得信息，或者他们无法执行他们的决定，或者类似的事情。

通常，这些不是需要分解的大事。当它们出现时，您需要在**目标向后**的方向上解决问题。从目标到使您能够实现该目标的事物，再到使​​促成因素成为可能的事物等。由于目标通常是大事物，因此这往往是自上而下的——从一般业务目标到详细的业务流程和步骤。

在某些时候，我们会概述导致目标的这些不同步骤。我们已经完成了分析部分（分解）。现在是综合部分：我们将我们拥有的东西重新组合成我们可以实际构建的东西。合成是自下而上的。但是，我们不要得意忘形。我们有几个观点，每个观点都不一样。

我们有一个模型。这通常从细节构建到更大的概念模型中。然后，有时会再次分解为针对 OLTP 规范化的模型。或者分解为针对 OLAP 规范化的星型模式。然后我们从标准化模型创建一个 ORM 映射。上 - 下 - 上。

我们有处理。这通常是从业务流程的总结到处理步骤的详细信息。然后围绕这些步骤设计软件。然后将软件分解为类和方法。向下-向上-向下。

[*题外话*。对于开明的用户，这种分解定义了新的职位和工作方式。对于未开化的用户，旧工作仍然存在，我们编写大量文档以将旧工作映射到新软件。]

我们有组件。我们经常看碎片，看看我们对可用组件的了解，并进行一种匹配。这是最随机的过程；它类似于晶体的形成方式——有成核中心，设计在这些中心周围凝固。网页服务。数据库。交易管理。表现。体积。不同的功能以某种方式帮助我们选择实现部分或全部解决方案的组件。经常感觉自下而上（从功能到产品），但有时是自上而下（“我拿着一把锤子，把所有东西都称为钉子”== 对所有事情都使用 RDBMS。）

最终我们必须编码。这是自下而上的。有点儿。您必须定义一个包结构。您必须将类定义为一个整体。那部分是自上而下的。您必须在类中编写方法。我经常做这种自下而上的——粗略的方法，写一个单元测试，完成方法。粗略下一个方法，写一个单元测试，完成方法。

驱动原则是敏捷——构建行之有效的东西。细节无处不在——上、下、前、后、数据、流程、参与者、主题区域、业务价值。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-25T01:18:53.147

是的。做所有这些事情。

这可能看起来很讽刺（对不起，我恢复形式），但这确实是一个没有正确答案的情况。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-25T01:40:49.023

同样以敏捷的方式，首先编写您的测试！

那么所有的软件都是一个不断循环的

*   红色 - 代码未通过测试
*   绿色 - 代码通过测试
*   重构——保留意图的代码改进。

缺陷，新功能，变化。这一切都遵循相同的模式。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-25T01:19:34.473

你的第二个选择是一个合理的方法。如果您将问题分解为可理解的部分，则自上而下的方法将在您实施所有小细节之前揭示任何主要的设计缺陷。您可以为较低级别的功能编写存根，以将所有内容挂在一起。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-25T01:29:07.443

我认为除了自上而下的设计之外，还有更多需要考虑的因素。您显然需要将设计分解为可管理的工作单元，但您还需要考虑优先级等。在迭代开发项目中，一旦您为前一个迭代交付了解决方案，您通常会为下一次迭代重新定义问题.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-25T01:40:17.027

在设计时，我喜欢做中间。我喜欢对领域进行建模，然后设计类，然后从那里转移到数据库和 UI。如果有基于 UI 或基于数据库的特定功能，我也可以预先设计这些功能。

编码时，如果可能的话，我通常喜欢自下而上（首先是数据库，然后是业务实体，然后是 UI）。我发现使用这种方法更容易保持直截了当。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-13T15:25:12.600

我相信，对于优秀的软件设计师（在我看来，所有软件开发人员在某种程度上也应该是软件设计师），其神奇之处在于能够同时进行自上而下和自下而上的工作。

我的导师“教育”我做的是从非常简短的自上而下开始了解所涉及的实体，然后转向自下而上找出我想要创建的基本元素，然后备份并看看我是如何可以向下一层，知道我对自下而上的结果的了解，依此类推，直到“他们在中间相遇”。

希望有帮助。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-25T01:31:50.357

外向内设计。

你从你想要达到的最高端开始，你知道你必须在最低端做什么。继续工作，直到他们在中间相遇。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-25T01:56:15.087

我有点同意所有人说“都不是”的观点，但每个人都属于范围内的某个地方。

我更像是一个自上而下的人。我选择了一个高级功能/点/任何东西，并将其作为一个完整的程序来实现。这让我在问题域的范围内勾勒出一个基本的计划和结构。

然后，我从另一个特性开始，将所有可以被第二个使用的原始特性重构为新的共享实体。起泡，冲洗，重复直到应用完成。

但是，我认识很多自下而上的人，他们听到问题并开始考虑在其之上构建应用程序可能需要的所有支持子系统。

我不相信任何一种方法是错误的或正确的。他们都可以取得成果。我什至试着找自下而上的人一起工作，因为我们可以从两个不同的角度来解决这个问题。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-28T04:27:40.383

两者都是有效的方法。有时一个人只是“感觉”比另一个人更自然。但是，有一个大问题：一些主流语言，尤其是它们的框架和库，确实非常*依赖*IDE 支持，例如语法高亮、背景类型检查、后台编译、智能代码完成、IntelliSense 等。

但是，*这不适用于自上而下的编码！*在自上而下的编码中，您经常使用尚未*实现的变量、字段、常量、函数、过程、方法、类、模块、特征、mixin、方面、包和类型！*因此，IDE 会因为编译错误不断地对你大喊大叫，到处都是红色的波浪线，你将无法完成代码等等。因此，IDE 几乎*禁止*您进行自上而下的编码。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-13T19:56:07.003

我做了一个自上而下的变体。我倾向于先尝试做界面 - 然后我将其用作我的功能列表。这个版本的好处是，它仍然适用于否则会抱怨的 IDE。只需注释掉对尚未实现的功能的一个函数调用。

# .net - .Net 多线程：SQL 连接池

> ID：130941
> 
> 赞同：1
> 
> 时间：2008-09-25T01:17:13.463
> 
> 标签：.net, multithreading, connection-pooling

在 VB.Net Windows 服务中，我目前正在使用以下工作单元：

```
ThreadPool.QueueUserWorkItem(operation, nextQueueID) 
```

在每个工作单元（或为了便于理解我将使用的线程）中，它将进行几个 MSSQL 操作，如下所示：

```
 Using sqlcmd As New SqlCommand("", New SqlConnection(ConnString))
        With sqlcmd
            .CommandType = CommandType.Text
            .CommandText = "UPDATE [some table]"

            .Parameters.Add("@ID", SqlDbType.Int).Value = msgID

            .Connection.Open()
            .ExecuteNonQuery()
            .Connection.Close()   'Found connections not closed quick enough'
        End With
    End Using 
```

在服务器上运行 a`netstat -a -o`时，我看到大约有 50 个与 SQL 服务器的连接位于`IDLE`or上`ESTABLISHED`，这对我来说似乎太过分了，特别是因为我们有更大的 Web 应用程序，可以通过 5-10 个连接来解决问题。

连接字符串对应用程序是全局的（不会更改），并且也已`Pooling=true`定义。

`ConnectionPool`现在这些线程中的每一个都有自己的`ConnectionPool`.EXE 进程吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-25T01:22:00.613

来自 MS Docs -

“每个进程、每个应用程序域、每个连接字符串以及在使用集成安全性时、每个 Windows 身份时，都将连接池化”

[http://msdn.microsoft.com/en-us/library/8xx3tyca.aspx](http://msdn.microsoft.com/en-us/library/8xx3tyca.aspx)

您是否遇到错误，例如 -

*异常详细信息：System.InvalidOperationException：超时已过期。在从池中获取连接之前超时时间已过。这可能是因为所有池连接都在使用中并且达到了最大池大小。*

还有多少工作项在服务中排队？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-25T06:55:23.260

您的代码的一个大问题是，如果 ExecuteNonQuery 引发异常，您并没有关闭连接。处理 SqlCommand 是不够的，您还需要在抛出异常时处理 SqlConnection，例如：

```
Using SqlConnection connection = New SqlConnection(ConnString)
    Using sqlcmd As New SqlCommand("", connection)        
        With sqlcmd            
          ... etc
        End With    
    End Using
End Using 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T21:43:39.940

虽然我通常喜欢 using 语句，但我发现有时在 .NET 库中，句柄的实际 CLOSE 直到垃圾回收才完成。因此，作为对此类事情的老派和宗教信仰，我在 using 语句的末尾添加了一个明确的结束语。这是伪代码，因为我通常用 C# 而不是 VB.NET 编写代码，但它应该给你这个想法。

```
Using SqlConnection connection = New SqlConnection(ConnString)

   TRY
      Using sqlcmd As New SqlCommand("", connection)
                  With sqlcmd
                        ... etc
          End With
      End Using
   FINALLY
      connection.Close()

End Using 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-25T02:43:36.360

如果打开的连接数冒犯了您，请控制[连接字符串](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.connectionstring.aspx)

注意：MinPoolSize 和 MaxPoolSize。

# ruby - 在Ruby中将二进制文件作为字符串读取

> ID：130948
> 
> 赞同：267
> 
> 时间：2008-09-25T01:18:26.347
> 
> 标签：ruby, string, file-io

我需要一种简单的方法来获取 tar 文件并将其转换为字符串（反之亦然）。有没有办法在 Ruby 中做到这一点？我最好的尝试是这样的：

```
file = File.open("path-to-file.tar.gz")
contents = ""
file.each {|line|
  contents << line
} 
```

我认为将其转换为字符串就足够了，但是当我尝试像这样将其写回时...

```
newFile = File.open("test.tar.gz", "w")
newFile.write(contents) 
```

不是同一个文件。做`ls -l`显示文件大小不同，尽管它们非常接近（打开文件会显示大部分内容完好无损）。我是否犯了一个小错误或完全不同（但可行）的方式来实现这一点？

* * *

## 回答 #1

> 赞同：399
> 
> 时间：2008-09-25T01:30:56.863

首先，您应该将文件作为二进制文件打开。然后，您可以在一个命令中读取整个文件。

```
file = File.open("path-to-file.tar.gz", "rb")
contents = file.read 
```

这将使您获得一个字符串中的整个文件。

之后，您可能想要`file.close`. 如果你不这样做，`file`在它被垃圾收集之前不会被关闭，所以它在打开时会稍微浪费系统资源。

* * *

## 回答 #2

> 赞同：247
> 
> 时间：2008-11-07T05:24:54.170

如果您需要二进制模式，则需要以艰难的方式进行：

```
s = File.open(filename, 'rb') { |f| f.read } 
```

如果没有，更短更甜的是：

```
s = IO.read(filename) 
```

* * *

## 回答 #3

> 赞同：114
> 
> 时间：2008-09-25T02:02:43.277

为避免文件处于打开状态，最好将块传递给 File.open。这样，文件将在块执行后关闭。

```
contents = File.open('path-to-file.tar.gz', 'rb') { |f| f.read } 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2010-12-30T18:21:26.020

一些打开/关闭安全性怎么样。

```
string = File.open('file.txt', 'rb') { |file| file.read } 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2008-09-25T01:27:34.530

在 os x 上，这些对我来说是一样的......这可能是 Windows 中额外的“\r”吗？

无论如何，您可能会更好：

```
contents = File.read("e.tgz")
newFile = File.open("ee.tgz", "w")
newFile.write(contents) 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2015-06-12T09:02:07.617

Ruby 具有二进制读取功能

```
data = IO.binread(path/filaname) 
```

或者如果低于 Ruby 1.9.2

```
data = IO.read(path/file) 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-25T01:27:05.140

您可能可以在 Base64 中对 tar 文件进行编码。Base 64 将为您提供可以存储在纯文本文件中的文件的纯 ASCII 表示。然后，您可以通过将文本解码回来来检索 tar 文件。

你做这样的事情：

```
require 'base64'

file_contents = Base64.encode64(tar_file_data) 
```

查看 Base64 [Rubydocs](http://www.ruby-doc.org/stdlib/libdoc/base64/rdoc/index.html)以获得更好的想法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-04-28T18:26:12.003

Ruby 1.9+ 具有[`IO.binread`](https://ruby-doc.org/core-1.9.2/IO.html#method-c-binread)（参见[@bardzo 的回答](https://stackoverflow.com/a/30799222/27358)）并且还支持将编码作为选项传递给`IO.read`：

*   [红宝石 1.9](https://ruby-doc.org/core-1.9.2/IO.html#method-c-read)

    ```
    data = File.read(name, {:encoding => 'BINARY'}) 
    ```

*   [红宝石 2+](https://ruby-doc.org/core-2.0.0/IO.html#method-c-read)

    ```
    data = File.read(name, encoding: 'BINARY') 
    ```

（请注意，在这两种情况下，它`'BINARY'`都是 . 的[别名](https://ruby-doc.org/core-1.9.2/Encoding.html#method-c-aliases)。`'ASCII-8BIT'`）

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2014-11-24T11:31:26.653

如果您可以通过 Base64 对 tar 文件进行编码（并将其存储在纯文本文件中），您可以使用

```
File.open("my_tar.txt").each {|line| puts line} 
```

**或者**

```
File.new("name_file.txt", "r").each {|line| puts line} 
```

打印 cmd 中的每一行（文本）。

# java - 如何使用 JAXP DocumentBuilder 提供自定义错误消息？

> ID：130960
> 
> 赞同：2
> 
> 时间：2008-09-25T01:20:57.403
> 
> 标签：java, xml, jaxp

我想提供我自己在 中完成的验证的消息`DocumentBuilder`，而不是来自`XMLMessages.properties`.

现在我看到[`error-reporter`](http://apache.org/xml/properties/internal/error-reporter)需要将一个属性设置为扩展的类`XMLErrorReporter`。

但是，我无法`ComponentManager`从`Document`/ `Builder`/获取`Factory`。

解析字符串`SAXParseException`是最后的选择，但我只是认为可能有一种“最佳实践”的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-26T15:41:08.453

have you already looked at [DocumentBuilder#setErrorHandler](http://java.sun.com/j2se/1.4.2/docs/api/javax/xml/parsers/DocumentBuilder.html#setErrorHandler(org.xml.sax.ErrorHandler))?

if yes, could you explain why this approach doesn't work for you?

# sql-server - 计划将 PostgreSQL 与 ASP.NET 一起使用：坏主意？

> ID：130968
> 
> 赞同：10
> 
> 时间：2008-09-25T01:24:06.147
> 
> 标签：sql-server, asp.net-mvc, database, linq-to-sql, postgresql

我目前正在为我未来的 Web 项目规划基础设施。我想像 Joel 那样为每个客户拥有一个数据库，现在想着哪个数据库引擎对我有好处。最好的当然是 SQL Server，但我现在买不起完整的版本，我不认为 SQL Server Express 将是加载服务的好选择。现在我正在考虑改用 PostgreSQL。鉴于我的开发环境将是 ASP.NET 3.5，比如 NHibernate 或 LINQ to SQL，如果我使用 PostgreSQL 而不是 SQL Server，我会有多少麻烦？

谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-25T02:02:50.703

NHibernate 可以在 PostgreSQL 上正常工作（无论数据库是在 Windows 还是类似 UNIX 的操作系统上），而 .NET 使用 Npgsql db 提供程序可以很好地工作。

您将遇到的唯一“麻烦”当然是 PostgreSQL 不执行 T-SQL。事实上，它的 PL/pgSQL 存储过程语言更接近于 Oracle 的 PL/SQL，而不是 MS SQL Server 的 T-SQL。因此，您必须重新编码您的存储过程，并且如果您使用 ADO.NET，将会有一些需要注意的问题。如果您使用 NHibernate，您可能不必为此担心太多。虽然没有 LINQ to SQL，但你运气不好。

PostgreSQL 是可扩展的，现在可以在 Windows 上正常工作（早期版本不正式支持 Windows），而 pgAdmin 是一个很好的管理工具，你可以用 SQL Server 的 GUI 工具完成大部分工作它在很短的时间内。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-25T01:57:22.977

我不认为这是一个坏主意，而是一次很棒的经历。

顺便说一句，NHibernate 是去 Linq 到 Nhibernate 的方式，它正在大量开发中，并且可以在主干中使用，所以如果你关心 Linq 的“我不关心”，不要害怕使用它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-25T01:29:02.623

为什么不从 SQL Server Express 开始并在有钱时进行迁移？这样，您就可以朝着您认为理想的方向前进并降低转换成本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T01:29:18.880

如果您使用 PostgreSQL，您将无法使用 LINQ to SQL。目前 LINQ 仅适用于 SQL Server（可能是 Oracle）。我不确定NHibernate。另外，如果您使用 PostgreSQL，上次我检查时，他们已经放弃了对 Windows 的支持。因此，您将考虑拥有第二个为 DB 运行 Linux 的机器。

[编辑]

事实证明 Windows 支持 PostgreSQL。我不记得我在哪里看到支持被取消了。无论如何，我听说它在 Linux 上运行得更好，所以你可能想考虑这样做。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-07-25T03:11:09.353

如今，postgres 与 .net 一起工作得非常快，它与专有的 mssql 一样好甚至更好

# database-design - 经济实惠的数据库建模工具

> ID：130986
> 
> 赞同：3
> 
> 时间：2008-09-25T01:27:22.957
> 
> 标签：database-design, architecture

你们能推荐一些支持 SQL Server、PostgreSQL 和 MySQL 的经济实惠的 SQL 建模工具吗？我正在研究每个许可证范围最高 300 美元。请每个答案一个工具！

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-25T01:56:47.817

除了[Microsoft Visio](http://office.microsoft.com/en-gb/visio/default.aspx)和 SQL Server 数据库图表之外，还没有提到的一个工具是[EA Architect](http://www.sparxsystems.com.au/products/ea/index.html)，可以以低于 200.00 美元的价格购买

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T09:44:30.533

密切关注[SchemaBank](http://schemabank.com)，它们现在处于 beta 质量：只是实体关系的可视化绘图、SQL 语句的前向工程、版本控制以及与其他人的简单共享模式。他们似乎提供免费帐户。仅适用于 MySQL 和 PG。

猜猜基于 Web 的数据库建模即将起飞？他们是 SaaS 供应商。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-10-08T02:43:09.487

事实上，最全面的数据库建模/设计工具列表来自[wikipedia](http://en.wikipedia.org/wiki/Comparison_of_database_tools)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-25T01:28:25.247

ERwin 一直是我最喜欢的数据建模工具。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-25T01:43:04.353

与我共事过的一些人对[TOAD](http://www.toadsoft.com/toadmysql/Overview.htm)有很好的评价——它适用于 Mysql，但不适用于 PostgreSQL。它是免费下载的，包括[图形建模](http://www.toadsoft.com/toaddm/toad_data_modeler.htm)支持。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-25T03:03:24.567

这个网站有一些可用的工具：[http](http://www.databaseanswers.com/modelling_tools.htm) ://www.databaseanswers.com/modelling_tools.htm 。

我尝试了 Datanamic 的 Dezign，该网站推荐给个人用户。它非常易于使用并且具有许多功能。它在不同程度上支持大约 20 个不同的数据库。

它有一个免费试用版，标准版的许可证是 245 美元（不是网站上列出的 139 美元）。我最终没有买它，因为我没有任何工具预算，但如果我有的话我会买的。如果您需要多个许可证，5 包和 10 包提供比单一许可证费用大幅折扣。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-02-22T09:39:34.930

**Sybase PowerDesigner**是我见过的最好和最通用的数据库工具，但我无法获得有关定价的信息，因为“您的国家目前不支持在线购买。”。

它支持 50 多个数据库，包括 MySQL、Oracle、MSSQL 等等。我不确定 PostgreSQL，但应该支持它。

更多信息在这里：[http ://www.sybase.com/products/modelingdevelopment/powerdesigner](http://www.sybase.com/products/modelingdevelopment/powerdesigner)

# asp.net-mvc - ASP.net MVC HomeController URL

> ID：130997
> 
> 赞同：1
> 
> 时间：2008-09-25T01:29:54.370
> 
> 标签：asp.net-mvc

默认情况下，MVC Preview 5 web 项目带有一个 HomeController.vb 类。默认情况下，这会将 Web URL 设置为[http://www.mywebsite.com/home/](http://www.mywebsite.com/home/)。如果我只是希望它默认为[http://www.mywebsite.com/](http://www.mywebsite.com/)，我将如何实现呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-25T01:33:11.943

已经回答了，所以我将指导您[如何在 ASP.Net MVC 中摆脱 Home？](https://stackoverflow.com/questions/15470/how-do-i-get-rid-of-home-in-aspnet-mvc).

^(10k+ rep的用户也可以参考[https://stackoverflow.com/questions/33861/aspnet-mvc-routing-basics-root-route](https://stackoverflow.com/questions/33861/aspnet-mvc-routing-basics-root-route)（已删除）)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T01:32:04.660

我不确定我是否理解您的问题，如果您想要访问[http://www.mywebsite.com/](http://www.mywebsite.com/)而不是 /home 跟踪它，这就是您将得到的行为。

你还有什么要找的吗？**************