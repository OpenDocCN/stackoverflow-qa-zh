# StackOverflow 问答 000497000-000497999

# c - 是否有一个函数可以在 C 中舍入一个浮点数，还是我需要自己编写？

> ID：497018
> 
> 赞同：26
> 
> 时间：2009-01-30T20:03:52.960
> 
> 标签：c, floating-point, rounding

是否有一个函数可以在 C 中舍入一个浮点数，还是我需要自己编写？

> 浮点转换 = 45\. **59** 2346543;

我想将实际值四舍五入到小数点后一位， conver = 45\. **6**。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-01-30T20:08:15.807

当然，您可以使用*roundf()*。如果你想四舍五入到小数点后，你可以这样做：`roundf(10 * x) / 10`

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-01-30T20:19:19.327

正如 Rob 所提到的，您可能只想将浮点数*打印*到小数点后 1 位。在这种情况下，您可以执行以下操作：

```
#include <stdio.h>
#include <stdlib.h>

int main()
{
  float conver = 45.592346543;
  printf("conver is %0.1f\n",conver);
  return 0;
} 
```

如果你想实际四舍五入存储的值，那就有点复杂了。一方面，您的一位小数位表示很少有精确的浮点模拟。如果你只是想尽可能靠近，这样的事情可能会奏效：

```
#include <stdio.h>
#include <stdlib.h>
#include <math.h>

int main()
{
  float conver = 45.592346543;
  printf("conver is %0.1f\n",conver);

  conver = conver*10.0f;
  conver = (conver > (floor(conver)+0.5f)) ? ceil(conver) : floor(conver);
  conver = conver/10.0f;

  //If you're using C99 or better, rather than ANSI C/C89/C90, the following will also work.
  //conver = roundf(conver*10.0f)/10.0f;

  printf("conver is now %f\n",conver);
  return 0;
} 
```

我怀疑第二个示例是您要查找的内容，但为了完整起见，我将其包含在内。如果您确实需要在内部以这种方式表示您的数字，而不仅仅是在输出上，请考虑使用[定点表示](http://en.wikipedia.org/wiki/Fixed-point_arithmetic)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-30T20:07:57.617

```
#include <math.h>

double round(double x);
float roundf(float x); 
```

不要忘记与 -lm 链接。另请参见 ceil()、floor() 和 trunc()。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T20:09:00.767

只是为了概括 Rob 的回答，如果您*不在*输出上执行此操作，您仍然可以使用与`sprintf()`.

不过，我认为还有另一种方法可以做到这一点。你可以尝试`ceil()`上下`floor()`四舍五入。一个很好的技巧是添加 0.5，因此任何超过 0.5 的内容都会向上取整，但低于 0.5 的任何内容都会向下取整。`ceil()`并且`floor()`只在`double`s 上工作。

编辑：另外，对于浮点数，您可以使用`truncf()`截断浮点数。相同的 +0.5 技巧应该可以进行精确的舍入。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-01-29T17:27:11.797

要*打印*一个四舍五入的值，[@Matt J](https://stackoverflow.com/a/497079/2410359)很好地回答了这个问题。

```
float x = 45.592346543;
printf("%0.1f\n", x);  // 45.6 
```

* * *

由于大多数浮点 (FP) 是基于*二进制*的，因此当数学上正确的答案是 时，不可能*精确*四舍五入到*小数点*`x.1, x.2, ...`后一位。

将 FP 编号转换为*最接近* `0.1`的数字是另一回事。

**溢出**：首先按 10（或 100、1000 等）缩放的方法可能会溢出 large `x`.

```
float round_tenth1(float x) {
  x = x * 10.0f;
  ...
} 
```

**双舍入**`floorf(x*10.0f + 0.5f)/10.0`：当中间和向上舍入`x*10.0f + 0.5f`到一个新整数时，添加 0.5f 然后使用返回错误的结果。

```
// Fails to round 838860.4375 correctly, comes up with 838860.5 
// 0.4499999880790710449 fails as it rounds to 0.5
float round_tenth2(float x) {
  if (x < 0.0) {
    return ceilf(x*10.0f + 0.5f)/10.0f;
  }
  return floorf(x*10.0f + 0.5f)/10.0f;
} 
```

**投到**远大于时`int`有明显的问题。`float x``INT_MAX`

* * *

使用`roundf()`和家庭，可用`<math.h>`是最好的方法。

```
float round_tenthA(float x) {
  double x10 = 10.0 * x;
  return (float) (round(x10)/10.0);
} 
```

为避免使用`double`，只需测试数字是否需要四舍五入。

```
float round_tenthB(float x) {
  const float limit = 1.0/FLT_EPSILON;
  if (fabsf(x) < limit) {
    return roundf(x*10.0f)/10.0f;
  }
  return x;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-05-22T17:22:53.290

还有一个`round()`函数，也`fround()`可以四舍五入到最接近的整数，表示为双精度数。但这不是你想要的。

我有同样的问题并写了这个：

```
#include <math.h>

   double db_round(double value, int nsig)
/* ===============
**
** Rounds double <value> to <nsig> significant figures.  Always rounds
** away from zero, so -2.6 to 1 sig fig will become -3.0.
**
** <nsig> should be in the range 1 - 15
*/

{
    double     a, b;
    long long  i;
    int        neg = 0;

    if(!value) return value;

    if(value < 0.0)
    {
        value = -value;
        neg = 1;
    }

    i = nsig - log10(value);

    if(i) a = pow(10.0, (double)i);
    else  a = 1.0;

    b = value * a;
    i = b + 0.5;
    value = i / a;

    return neg ? -value : value;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-04-15T02:57:32.383

你可以使用#define round(a) (int) (a+0.5) 作为宏，所以当你写 round(1.6) 时它返回 2，而当你写 round(1.3) 时它返回 1。

# sql-server - SQL Server 2005 安装问题

> ID：497019
> 
> 赞同：0
> 
> 时间：2009-01-30T20:04:15.080
> 
> 标签：sql-server, coldfusion, odbc

我有两个问题都与（我相信）我的 SQL Server 设置有关。我已经在我的 Vista 64 Home Premium 盒子上安装了从 MSDN 下载的 x64 版本的 SQL Server（完整的东西）。在遇到多个问题后，我终于让它工作了。这是一个新盒子，所以我移植了一个需要从另一台服务器处理的数据库。那也很好用。然而，当我尝试在 SQL Server Management Studio 中打开数据库时，我的第一个问题出现了：

“找不到请求的 .Net Framework 数据提供程序。它可能未安装。（System.Data）”

盒子本身不是新的，肯定安装了 .NET（我相信是第 3 版）。我发现有人将此作为错误发布，但由于团队（SQL Server 团队）无法重现它，他们将其删除。我尝试安装推荐的 SP3 补丁，但无济于事。仅当我尝试打开表格以查看数据时（右键单击并“打开表格”）。我什至可以执行查询和检索结果（从管理工作室内部）。我会遵循几乎任何建议来尝试使其正常工作。

我的第二个问题是我无法连接到服务器。我以为我可以解决它（使用查询），但我没有发现它在盒子上添加了任何 ODBC 连接，只是驱动程序。Management Studio 可以很好地访问数据库，但机器本身似乎没有识别出任何东西在其上运行，至少在默认端口 (1433) 上没有，我没有命名实例。当尝试手动将服务器添加到 DSN 或任何数据源时，它找不到 SQL 服务器（在控制面板 > 管理工具 > 数据源（ODBC）下。在 SQL Server Management Studio 下，它显示为注册的数据库服务器（我认为这是因为它连接到我所听到的端口 1434？不确定）。这是我的主要问题，即使我可以 打开表格（第一个问题）我绝对需要能够设置它以便我可以连接到它。我连接的语言源是 ColdFusion，它设置为独立服务器（未安装 IIS，现在不使用它）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-30T20:09:53.540

至于连接到它，请确保所有服务都在运行。特别是 SQL Server 代理。

此外，检查服务和连接的 SQL Server 2005 外围应用配置。检查“远程连接”下的“本地和远程”连接是否打开。它可能被设置为“仅限本地”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T20:36:08.310

CF 版本 6+ 不使用操作系统的 ODBC 连接。他们使用 JDBC over IP 进行连接。您需要确保已使用 SQL Server Configuration Studio 允许 TCP/IP 连接到数据库。然后，使用 CF 管理员页面中的数据源页面（通常是 localhost:port/cfide/administrator，将“port”替换为您用于 CF 内置服务器的端口）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T00:31:09.380

> 但是，为什么它会默认为这个，为什么这是我自己的机器（本地测试）的问题？

默认情况下，SQL Server 2005 旨在更安全，因此默认情况下并非所有协议都是开放的。

> Sql Server 代理与远程连接没有任何关系，但我似乎记得如果代理没有启动，在网络上进行发现会出现问题

也许您正在考虑使用命名实例的 SQL 浏览器。

你试过这个过程吗？ [http://oakleafblog.blogspot.com/2007/03/orcas-march-ctp-on-vista-database.html](http://oakleafblog.blogspot.com/2007/03/orcas-march-ctp-on-vista-database.html)

# javascript - 在 HTML 表格单元格中插入日期

> ID：497020
> 
> 赞同：0
> 
> 时间：2009-01-30T20:04:19.450
> 
> 标签：javascript, html, date, html-table

我希望在网页上垂直排列的表格单元格中显示一系列日期（主要是月、日、年）。第一个日期需要是当前日期减去一天，序列中的下一个日期是当前日期，其余日期需要在未来的一天内递增到 16 天。

有人可以帮我弄清楚如何做到这一点吗？我已经查看并理解了用于操作和显示单个日期（加或减）的 Javascript，但无法在单元格中获取该日期，也无法弄清楚如何在 HTML 表中显示上述其他多个日期。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T00:54:20.050

尝试这个：

HTML

```
<table id="myTable"></table> 
```

JavaScript

```
var table = document.getElementById('myTable')
var myDate = new Date();
myDate.setDate(myDate.getDate() - 1)
for(var i = 0; i < 16; i++)
{
    var row = document.createElement('TR');
    var cell = document.createElement('TD');     
    cell.innerText = myDate.getDate() + "/" + (myDate.getMonth() + 1) + "/"  + myDate.getYear();
    myDate.setDate(myDate.getDate() + 1)
    row.appendChild(cell);
    table.tBodies[0].appendChild(row);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T21:13:44.147

**选项 1：** 您可以使用将输出写入文档，如：

```
<table>
<tr>
  <td><script type="text/javascript">document.write(mydate);</script></td>
  ...
</tr> 
```

**选项 2：**在 javascript 中生成标记，然后将其注入 DOM：

```
var markup = '<table>\
<tr>\
  <td>' + mydate + '</td>\
</tr>\
...
</table>';
document.getElementById('contentDiv').innerHTML = markup; 
```

页面中有 div 元素的位置：

```
<div id="contentDiv"></div> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T20:08:53.323

您是否尝试过 myDate.toString() 或 myDate.toDateString()？

你需要做的是有一些变量持有日期......像这样

```
var myDate = new Date(); 
```

把你喜欢的日期放在里面，然后这样做。

```
myDate.toDateString() 
```

您可以在 javascript 中循环创建表格并用日期填充它。

这有帮助吗？

# archive - 为什么 TAR 文件会小于其内容？

> ID：497024
> 
> 赞同：24
> 
> 时间：2009-01-30T20:05:07.043
> 
> 标签：archive, tar, unix

我有一个要归档的目录：

```
$ du -sh oldcode
1400848
$ tar cf oldcode.tar oldcode 
```

所以目录是1.4gb。但是，该文件要小得多：

```
$ ls -l oldcode.tar
-rw-r--r-- 1 ieure ieure 940339200 2002-01-30 10:33 oldcode.tar 
```

只有897mb。它没有以任何方式压缩：

```
$ file oldcode.tar
oldcode.tar: POSIX tar archive 
```

为什么 tar 文件比它的内容小？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-01-30T20:14:18.273

由于文件系统的工作方式，您会有所不同。

简而言之，您的磁盘是由集群组成的。每个集群都有一个固定的大小——比如说——4 KB。如果您在这样的集群中存储 1kb 文件，则 3kb 将不会被使用。确切的细节因您使用的文件系统类型而异，但大多数文件系统都是这样工作的。

3kb 浪费的空间对于单个文件来说并不算多，但是如果您有很多非常小的文件，那么浪费可能会成为磁盘使用量的重要组成部分。

在 tar-archive 中，文件不是存储在集群中，而是一个接一个地存储。这就是差异的来源。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-30T20:14:29.320

不知道您正在使用什么 tar 或您正在使用什么类型的 Unix 系统，这是我的猜测：oldcode 包含许多较小的文件，当它们本身使用磁盘空间时效率低下，因为磁盘空间是由某种块分配的，而不是逐字节。在 tar 文件中，它们被连接起来，并最大限度地利用分配给它们的磁盘空间。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-30T20:33:54.537

这与文件系统的块大小有关。MacOSX 10.5.6 上的**man 1 du状态：**

> du 实用程序显示每个文件参数以及以每个目录参数为根的文件层次结构中的每个目录的文件系统*块使用情况。*如果未指定文件，则显示以当前目录为根的层次结构的块使用情况。

```
[mirko@borg foo]$ ls -la
total 0
drwxr-xr-x   2 mirko  wheel   68 Jan 30 21:20 .
drwxrwxrwt  10 root   wheel  340 Jan 30 21:16 ..
[mirko@borg foo]$ du -sh
0B  .
[mirko@borg foo]$ touch foo
[mirko@borg foo]$ ls -la
total 0
drwxr-xr-x   3 mirko  wheel  102 Jan 30 21:20 .
drwxrwxrwt  10 root   wheel  340 Jan 30 21:16 ..
-rw-r--r--   1 mirko  wheel    0 Jan 30 21:20 foo
[mirko@borg foo]$ du -sh
0B  .
[mirko@borg foo]$ echo 1 > foo
[mirko@borg foo]$ ls -la
total 8
drwxr-xr-x   3 mirko  wheel  102 Jan 30 21:20 .
drwxrwxrwt  10 root   wheel  340 Jan 30 21:16 ..
-rw-r--r--   1 mirko  wheel    2 Jan 30 21:20 foo
[mirko@borg foo]$ du -sh
4.0K    . 
```

如您所见，即使是 2 字节的文件也需要 4kb 的整个块。有一些文件系统通过[块子分配](http://en.wikipedia.org/wiki/Tail_packing)来避免这种空间浪费。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-01-19T04:39:26.007

有2种可能性。

# 小文件

最有可能的是，它*不*小于其内容。[正如 Nils Pipenbrinck 所写](https://stackoverflow.com/a/497060/319931)，`du`显示文件系统分配的空间量，因为文件存储在文件系统块中，所以大于文件的逻辑大小。

要查看文件的逻辑大小，请使用`du --apparent-size`. 在这种情况下，结果应该小于 tar 文件。

# 稀疏文件

tar 文件可以存储稀疏文件。如果 tarball 是使用 创建[`--sparse`](http://www.gnu.org/software/tar/manual/html_node/sparse.html)的，稀疏文件中的漏洞将被记录，因此 tarball 可能小于文件的逻辑大小。

如果您提取的副本中的稀疏信息以某种方式丢失（例如，如果您将 tarball 提取到不支持稀疏文件的文件系统上，或者如果它被压缩然后解压缩等），那么`df`将报告扩展大小。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T20:13:43.673

du 计算磁盘块，而不是文件大小 duder。

# java - 在迭代java期间修改集合

> ID：497025
> 
> 赞同：2
> 
> 时间：2009-01-30T20:05:11.867
> 
> 标签：java, iterator, hashset

我正在寻找一种递归方法迭代。

我有一个要迭代的对象列表，然后检查它们的子对象。

递归：

```
doFunction(Object)
while(iterator.hasNext())
{
   //doStuff
   doFunction(Object.subObjects);
} 
```

我想把它改成这样

```
doFunction(Object)
iIterator = hashSet.iterator();
while(Iterator.hasNext()
{
   //doStuff
   hashSet.addAll(Object.subObjects);
} 
```

很抱歉伪代码很差，但基本上我想迭代子对象，同时将新对象附加到列表末尾以进行检查。

我可以使用列表来执行此操作，并执行类似的操作

```
while(list.size() > 0)
{
   //doStuff
   list.addAll(Object.subObjects);
} 
```

但我真的不想添加重复的子对象。当然，我可以在添加它之前检查 list.contains(each subObject) 是否。

但我很想使用 Set 来完成清洁工作。

所以基本上无论如何都要在迭代它时附加到一个集合，或者是否有一种更简单的方法可以使列表像一个集合而不是手动检查.contains()？

任何意见表示赞赏。

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-31T01:51:14.693

我将使用两种数据结构——一个**队列**（例如[`ArrayDeque`](http://java.sun.com/javase/6/docs/api/java/util/ArrayDeque.html)）用于存储要访问其子对象的对象，一个**集合**（例如[`HashSet`](http://java.sun.com/javase/6/docs/api/java/util/HashSet.html)）用于存储所有访问过的对象而不重复。

```
Set visited = new HashSet();   // all visited objects
Queue next = new ArrayDeque(); // objects whose subobjects are to be visited

// NOTE: At all times, the objects in "next" are contained in "visited"

// add the first object
visited.add(obj);

Object nextObject = obj;

while (nextObject != null)
{
    // do stuff to nextObject

    for (Object o : nextObject.subobjects)
    {
        boolean fresh = visited.add(o);

        if (fresh)
        {
            next.add(o);
        }
    }

    nextObject = next.poll(); // removes the next object to visit, null if empty
}

// Now, "visited" contains all the visited objects 
```

**笔记：**

*   [`ArrayDeque`](http://java.sun.com/javase/6/docs/api/java/util/ArrayDeque.html)是一个节省空间的队列。它被实现为一个循环数组，这意味着您使用的空间比[`List`](http://java.sun.com/javase/6/docs/api/java/awt/List.html)添加元素时不断增长的 a 少。
*   " `boolean fresh = visited.add(o)`" 结合了 " `boolean fresh = !visited.contains(o)`" 和 " `if (fresh) visited.add(o)`"。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T20:16:13.217

我认为您的问题本质上是一个需要通过列表解决的问题。如果您考虑一下，您的解决方案的 Set 版本只是将项目转换为 List 然后对其进行操作。

当然，List.contains() 与 Set.contains() 相比是一个缓慢的操作，所以如果速度是一个问题，可能值得提出一个混合：

```
while(list.size() > 0)
{
   //doStuff

   for each subObject
   {
      if (!set.contains(subObject))
      {
         list.add(subObject);
         set.add(subObject)
      }
   }
} 
```

这个解决方案速度很快，而且在概念上也是合理的——Set 可以被认为是所有可见项目的列表，而 List 是要处理的项目的队列。不过，它确实比单独使用 List 占用更多的内存。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T20:17:10.110

如果您不使用 List，则在修改集合后，一旦您从中读取，迭代器就会抛出异常。我建议使用 List 并强制执行插入限制，然后使用 ListIterator 因为这将允许您在迭代列表时修改列表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T20:35:49.103

```
 HashSet nextObjects = new HashSet();
    HashSet currentObjects = new HashSet(firstObject.subObjects);

    while(currentObjects.size() > 0)
    {
        Iterator iter = currentObjects.iterator();
        while(iter.hasNext())
        {
            //doStuff
            nextObjects.add(subobjects);
        }
        currentObjects = nextObjects;
        nextObjects = new HashSet();
    } 
```

我认为这样的事情会做我想要的，我不担心第一个 Set 包含重复项，只是 subObjects 可能指向相同的对象。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T20:36:31.130

使用一组以上并在“轮次”中进行：

```
/* very pseudo-code */
doFunction(Object o) {
    Set processed = new HashSet();
    Set toProcess = new HashSet();
    Set processNext = new HashSet();

    toProcess.add(o);

    while (toProcess.size() > 0) {
        for(it = toProcess.iterator(); it.hasNext();) {
            Object o = it.next();
            doStuff(o);
            processNext.addAll(o.subObjects);
        }
        processed.addAll(toProcess);
        toProcess = processNext;
        toProcess.removeAll(processed);
        processNext = new HashSet();
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-30T20:37:37.463

为什么不创建一个包含整个对象集的附加集呢？您可以将其用于查找。

# silverlight - 哪个 Expression 产品适合 Silverlight 开发人员？

> ID：497026
> 
> 赞同：1
> 
> 时间：2009-01-30T20:05:31.600
> 
> 标签：silverlight, ide

我不是图形人，但我想学习 Silverlight 开发。

我在这里看的是哪个表情产品？Blend 或 studio 还是 vs.net 2008 我只需要？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-30T20:08:01.203

整个[工作室](http://www.microsoft.com/expression/products/Overview.aspx?key=studio)都很棒，你也可以用 VS 做一些事情，但你可能正在寻找[Expression Blend](http://www.microsoft.com/expression/products/Overview.aspx?key=blend)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T20:07:25.417

Blend是我一直用于silverlight的产品。您可以只使用 Visual Studio 2008，但 Bend 可以使矢量图形更容易制作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T21:49:31.313

对于 silverlight Visual Studio 的开发人员而言，您所需要的就是一切。对于设计师来说，Expression Blend 是您想要的。

基本上，visusl studio 设计器是只读的，这意味着您必须手动编写所有 xaml，blend 使您能够拖放组件并且通常使创建 UI 更容易。（与手动编码 XAML 相比）

# mod-rewrite - 如何测试 IIRF 是否有效？

> ID：497030
> 
> 赞同：4
> 
> 时间：2009-01-30T20:06:54.983
> 
> 标签：mod-rewrite, shared-hosting, iirf

[http://www.codeplex.com/IIRF/Thread/List.aspx](http://www.codeplex.com/IIRF/Thread/List.aspx)

我的虚拟主机为我安装了 IIRF，我确信他们没有正确安装。我已经尝试了许多示例，其中一个我知道可以与 apache 的 mod_rewrite 一起使用，但我无法与 IIRF 一起使用。有没有你们知道的规则或配置选项会显示事情是否正常工作？

即使是像重写所有 url 到 anothersite.com 之类的东西现在也会对我有所帮助。我希望你们明白我来寻求帮助的原因。我可以自己弄清楚如何执行重写规则，但我不知道错误是因为我还是网络主机。由于我在共享虚拟主机上，因此我的选择也有限。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-07-12T05:55:23.040

[IIRF](https://archive.codeplex.com/?p=iirf)的新版本v1.2.16 R3 包含一个 StatusUrl 指令，如果您对其执行 HTTP GET，它将为您提供一个状态页面。它看起来像这样： [![IIRF 状态页面](https://i.stack.imgur.com/OziTY.png)](https://i.stack.imgur.com/OziTY.png)

如果你得到那个页面，那么 IIRF 正在运行。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-31T00:45:05.357

这是经过测试并与 IIRF 一起使用的：

```
RedirectRule ^.*$ http://www.google.com/ [I,R=301] 
```

它将匹配**任何**URL 并重定向到 Google。

# c# - 从我的数据库中获取数据最干燥的方法是什么？

> ID：497038
> 
> 赞同：0
> 
> 时间：2009-01-30T20:08:52.763
> 
> 标签：c#, coding-style, class-design, u2, universe

我必须编写一个 ASP.NET 应用程序来连接到我们的旧版 IBM Universe 数据库，并且我们正在使用一个名为 mv.net 的产品，它允许我们连接、读取、写入、选择、运行服务器端程序等。

我希望尽可能少的代码重复，但我也希望尽可能少的数据传输。

为了打开连接，我们必须首先使用以下代码获取对帐户的引用：

```
mvAccount myAccount = new mvAccount(serverName, login); 
```

然后我们可以读取一个项目：

```
mvFile myInvoiceFile = myAccount.FileOpen("INVOICE");
mvItem myInvoiceRecord = myInvoiceFile.Read(invoiceID); 
```

然后我们就完成了：

```
myAccount.Logout(); 
```

每个模块都有一个类，所以我可能有 INVOICE、PURCHASE_ORDER、RMA、REQ、SHIPMENT 等等。在 INVOICE 中，我可能需要访问多个表，例如 CUSTOMER、INVOICE、TERMS、SHIPVIA 等。

我计划做的是创建一个名为 TechDB 的类，它是我们数据库的名称，并将代码放在那里，所以在我的 INVOICE 类中我可以说：

```
TechDB connection = new TechDB();
mvItem myInvoiceRecord = connection.Read("INVOICE", invoiceID) 
```

当我这样做时，我的 TechDB 类将打开连接，读取记录，然后一步注销。

我想我正朝着正确的方向前进，但如果不是，请告诉我。这是我的问题：

1.  如何在我的 INVOICE 类中返回错误？例如，如果我们无法连接到数据库、无法打开文件、无法读取记录，则可能会发生错误。

2.  如果我需要从我的 INVOICE 中获取一些数据然后读取 TERMS 表怎么办。当我刚打开一个数据库时，我不想打开一个新的连接。

3.  我应该在所有有这个的类上调用 Dispose 方法吗？例如，mvAccount 有一个 Dispose 方法。没有文档说要调用它，但是我应该在 Logout() 之后调用它吗？

4.  我可以在执行 myAccount.Logout() 的 TechDB 类上创建一个 Dispose 方法吗？这样连接将保持打开状态，当我完全完成它时，我可以从我的 INVOICE 类中关闭它吗？

给我一些关于处理这个问题的最佳方法的意见？我的目标是一个健壮的应用程序，它易于修改并且代码重复尽可能少。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T20:18:01.043

我会使用闭包，我认为对于 C# 你有代表。所以像：

```
MyAccount.loginAndDo(servername, login, delegate(account){
   invoice = account.read("INVOICE");
   .
   .
   .
});

```

在 loginAndDo 中，您将登录，调用代理，然后关闭帐户。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T20:33:21.560

1.  自定义异常类
2.  一个想法是构建批处理请求（代表列表）。

按照 3/4。在我的例子中，我所有的数据访问对象都继承自一个包含对连接的静态引用的类。我对在 Dispose 中实现断开逻辑犹豫不决，因为可能会出现断电或系统崩溃或其他情况，并且连接未释放。

# sql - 我应该使用哪些锁定提示 (T-SQL)？

> ID：497049
> 
> 赞同：17
> 
> 时间：2009-01-30T20:10:51.307
> 
> 标签：sql, sql-server, tsql, concurrency, locking

我想实现一个原子事务，如下所示：

```
BEGIN TRAN A

SELECT id
FROM Inventory
WITH (???)
WHERE material_id = 25 AND quantity > 10

/*
Process some things using the inventory record and
eventually write some updates that are dependent on the fact that
that specific inventory record had sufficient quantity (greater than 10).
*/

COMMIT TRAN A 
```

问题是发生的其他交易消耗了我们库存中的数量，因此在选择记录和将更新写入交易 A 之间，该记录可能成为无效选择，因为它的数量可能已降低到阈值以下在 WHERE 子句中。

所以问题是我应该在 WITH 子句中使用哪些锁定提示来防止在我完成更新并提交事务之前更改选定的库存记录？

编辑：感谢 John，一个好的解决方案似乎是将事务隔离级别设置为 REPEATABLE READ。这将确保“在当前事务完成之前，没有其他事务可以修改当前事务已读取的数据”。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-30T20:19:13.943

实际上，您最好设置事务隔离级别而不是使用查询提示。

来自联机丛书的以下参考提供了每个不同隔离级别的详细信息。

[http://msdn.microsoft.com/en-us/library/ms173763.aspx](http://msdn.microsoft.com/en-us/library/ms173763.aspx)

这是一篇很好的文章，它解释了 SQL Server 中各种类型的锁定行为，并提供了示例。

[http://www.sqlteam.com/article/introduction-to-locking-in-sql-server](http://www.sqlteam.com/article/introduction-to-locking-in-sql-server)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-30T20:29:12.287

[表提示](http://msdn.microsoft.com/en-us/library/ms187373(SQL.90).asp)

`WITH (HOLDLOCK)`允许其他读者。其他地方建议的 UPDLOCK 是专有的。

HOLDLOCK 将阻止其他更新，但它们可能会使用稍后更新的数据。

在您提交或回滚之前，UPDLOCK 将阻止任何人读取数据。

你看过[sp_getapplock](http://msdn.microsoft.com/en-us/library/ms189823(SQL.90).aspx)吗？这将允许您在没有 UPDLOCK 阻塞的情况下序列化此代码（如果它是唯一的更新位）

编辑：问题主要在于这段代码在 2 个不同的会话中运行。使用 HOLDLOCk 或 REPEATABLE_READ，数据将在第一个会话更新之前的第二个会话中读取。使用UPDLOCK，没有人可以读取任何会话中的数据。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-30T20:38:51.737

微软SQL：

```
SELECT id
FROM Inventory (UPDLOCK)
WHERE material_id = 25 AND quantity > 10;

http://www.devx.com/tips/Tip/13134 
```

* * *

如果您对 PostgreSQL 感兴趣：

```
SELECT id
FROM Inventory    
WHERE material_id = 25 AND quantity > 10
FOR UPDATE; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T20:13:59.040

我相信这将是UPDLOCK。

[http://www.devx.com/tips/Tip/13134](http://www.devx.com/tips/Tip/13134)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T20:15:52.063

锁定提示：

```
WITH (UPDLOCK, HOLDLOCK) 
```

# .net - 单元测试我的电子邮件服务

> ID：497052
> 
> 赞同：2
> 
> 时间：2009-01-30T20:11:20.603
> 
> 标签：.net, unit-testing

如何为使用 System.Net.Mail 等外部服务的方法编写单元测试？

我是否只检查返回值以查看发送电子邮件是否有任何错误并假设是否没有成功发送？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-30T20:15:05.980

为邮件服务创建一个[模拟对象](http://en.wikipedia.org/wiki/Mock_object)。

简而言之，这将意味着您编写一个可以替代发送邮件行为的类。这样，您可以很容易地为您的测试创建不同的情况：成功的邮件、失败的邮件等。

一个简短的介绍： http: [//www.programmersheaven.com/user/pheaven/blog/217-An-Introduction-to-Mock-Objects/](http://www.programmersheaven.com/user/pheaven/blog/217-An-Introduction-to-Mock-Objects/)

另一个，带有代码示例：http: [//blogs.clearscreen.com/ragc/archive/2004/08/31/395.aspx](http://blogs.clearscreen.com/ragc/archive/2004/08/31/395.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-30T20:23:59.970

这取决于您想要的测试级别。如果您更关心测试方法，并且电子邮件只是一小部分，那么您可以考虑将电子邮件发送服务模拟出来。**Gerrie**的链接很好。

但是，如果您真的想测试邮件发送，这里有一些想法。

*   使用[SmtpDeliveryLocation](http://msdn.microsoft.com/en-us/library/system.net.mail.smtpdeliverymethod.aspx)将电子邮件输出到文件夹而不是邮件服务器。然后，您可以检查该文件夹。
*   发送电子邮件，然后查询远程 POP 服务器以查看它是否到达。
*   如果没有例外，请发送并假设它正常工作。我不记得 SmtpClient.Send 是阻塞还是非阻塞。

因为这些测试通常意味着与外部事物交谈，所以它们被称为[集成测试](http://en.wikipedia.org/wiki/Integration_testing)而不是单元测试。

但总的来说，我认为您更关心的是确保格式/电子邮件地址正确，而不是 Microsoft 是否正确实施了 SmtpClient。所以单元测试和模拟在那里更有意义。

# c# - 缓存需要同步吗？

> ID：497063
> 
> 赞同：3
> 
> 时间：2009-01-30T20:14:47.603
> 
> 标签：c#, java, multithreading, caching

这似乎是一个幼稚的问题，但我与一位同事进行了讨论，我认为没有真正需要缓存是线程安全/同步的，因为我认为谁放置并不重要在一个值中，因为给定键的值应该是“恒定的”（因为它最终来自同一来源）。如果值可以很容易地更改，那么缓存本身似乎并不是很有用（因为如果您关心该值“当前正确”，您应该转到原始来源）。

我认为至少使 GET 同步的主要原因是，如果在缓存中丢失非常昂贵，并且您不希望每个线程都出去获取一个值以放回缓存中。即使这样，您也需要在读取-读取-放置周期中真正阻止所有消费者的东西。

无论如何，我的工作假设是哈希本质上是线程安全的，因为对于任何 {key,value} 组合，该值要么为空，要么与谁“先”去那里编写无关紧要。

问题是：这是一个合理的假设吗？

更新：我的问题的真正范围是非常简单的 id->value 样式缓存（或 {parameters}->{calculated value} 无论谁写入缓存，值都是相同的，我们只是想从“重新计算”/返回数据库保存。对象的实际图形不相关，缓存通常是长期存在的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-30T20:20:15.267

对于哈希的大多数实现，您需要同步。如果哈希表需要扩展/重新散列怎么办？如果两个线程试图在键不同的哈希表中添加一些东西，但哈希冲突怎么办？他们都可以同时以不同的方式修改哈希表中的同一个槽。假设您正在使用哈希表来实现缓存（您在问题中暗示了这一点），如果您还不熟悉的话，我建议您阅读一些有关如何[实现哈希表的详细信息。](http://en.wikipedia.org/wiki/Hash_table)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-30T20:20:19.573

写入并不总是原子的。您必须要么使用原子数据类型，要么提供一些同步（RCU、锁等）。没有共享数据本身是线程安全的。或者通过坚持无锁算法（即在可能和可行的情况下）来消除这种情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-30T20:20:06.063

只要获取和释放锁的成本低于重新创建对象（从文件或数据库或其他）的成本，所有对缓存的访问确实应该同步。如果不是，您根本不需要缓存。:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T20:33:57.470

If you want to avoid data corruption, you must synchronize. This is especially true when the cache contains multiple tables that must be updated atomically. Imagine you have a database for a DMV (department of motor vehicles). You add a new person to the database, that person will have records for auto registrations plus records for tickets received for records for home address and perhaps other contact information. If you don't update these tables atomically -- in the database **and** in the cache -- then any client pulling data out of the cache may get inconsistent data.

Yes, any one piece of data may be constant, but databases very commonly hold data that -- if not updated together and atomically -- can cause database clients to get incorrect or incomplete or inconsistent results.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T20:34:06.923

If you are using Java 5 or above you can use a ConcurrentHashMap. This supports multiple readers and writers in a threadsafe manner.

# email - 为什么 CR 和 LF 在电子邮件中一起出现如此重要？

> ID：497064
> 
> 赞同：2
> 
> 时间：2009-01-30T20:15:03.577
> 
> 标签：email, rfc

来自[http://www.faqs.org/rfcs/rfc2822.html](http://www.faqs.org/rfcs/rfc2822.html)：

> CR 和 LF 必须仅作为 CRLF 一起出现；它们不得独立出现在体内。

我们有一个发送确认电子邮件的网络服务，但我们的一位用户指出这不符合 rfc2822 标准。所以我的问题是，为什么 CR 和 LF 在电子邮件消息中一起出现很重要？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-30T20:19:04.427

因为它在公认的 RFC 中？

实现源自 RFC。如果不是这种情况，则无法保证不同实现之间的互操作性。要求它们一起出现可能有也可能没有具体的技术原因，但在这种情况下，这些原因是无关紧要的。这是一个简单的问题，“因为他们这么说”。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-30T20:19:42.053

想想旧的电传打字机。CR 将写入头返回到行首，LF 将纸张向前滚动一行。您需要这两个步骤来开始新的一行。如果你使用 CR 没有 LF，你会覆盖相同的文本，这当然是非法的。

无论如何，这是将 CR+LF 定义为新行的 ASCII 代码的历史原因。当然最终它只是任意代码。有些系统只使用 CR 来表示换行，有些系统只使用 LF，有些则完全使用不同的字符。RFC2822 只好选择了一个，并决定只允许 CRLF 序列。

由于 RFC 决定使用 CRLF，因此单独禁止 CR 或 LF 是有意义的，因为无论如何处理这将是非常无用且有问题的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-30T20:20:41.100

因为在电子邮件中 ​​CRLF 是行分隔符。如果您只使用 CR 或仅使用 LF，您将遇到各种客户端、SMTP 服务器组合的各种意外问题。有些服务器会拒绝您的电子邮件，有些会“修复”您的电子邮件。固定电子邮件是处理起来最有趣的一些。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T20:20:34.783

如果不是你最终得到一个 CR，它把你放在同一行，那么无论你写什么都将在同一行左侧的字符顶部，然后是 LF，你在中间的某个列中重新开始写作。乱。

# java - 基于 Java 的简单 CRUD 网站的最佳技术

> ID：497073
> 
> 赞同：6
> 
> 时间：2009-01-30T20:17:52.853
> 
> 标签：java, web-applications, crud

我想使用最简单的 Java 工具创建一个 CRUD（创建、检索、更新、删除）网站。该站点将允许用户管理四个表，其中两个是用于构建菜单的参考表，其中两个将进行 CRUD 活动。

我倾向于 Stripes，但我想听听体验开发者的意见。三个关键要求是简单，简单，简单！我认为 Struts 和 Spring MVC 比我需要的更复杂。

-=笨拙

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-30T20:19:51.010

[grails](http://grails.org/)，因为您的工作流程将变为：

1.  为您的域对象定义类
2.  运行 grails 生成所有

您将拥有一个非常简单的 CRUD 应用程序，它*也*可以扩展到“真正的应用程序状态”，而无需丢弃所有内容并重新开始。grails 中的 CRUD 不超过 5 分钟。为严重。查看[Scott Davis 的介绍教程](http://www.ibm.com/developerworks/java/library/j-grails01158/)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-30T20:20:35.110

最简单的应用程序是一个处理基于 java 的 sql 引擎（例如 Derby (jabaDB) 或 HSQLDB）的简单 servlet

您甚至可以想到用 Java 编写的 CGI。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-07-13T22:14:22.950

最简单的解决方案是使用管理界面，它将提供 CRUD 功能、验证、过滤数据、安全性，并具有简单而干净的 UI（如 Django 或 ActiveAdmin/Ruby 中的管理面板）。

我知道的唯一**Java解决方案是**[LightAdmin](http://lightadmin.org)。它是 JPA 支持的应用程序的可插入开源 Java 库，它为您的 JPA 数据模型提供**管理接口。**它具有用于 UI 定制的内置 DSL，并且基于 Spring 技术堆栈。

**LightAdmin**的好处是您不需要维护代码库中的所有支持代码。所有内容都捆绑在库中，包括 UI。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-01-16T07:37:04.880

我会使用 Grails，因为它完全符合您的要求。我从来没有更快地创建简单的 CRUD 网站。Stripes 编程模型更像是一个调整过的 Struts - 有点尴尬。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-30T20:43:52.117

我建议使用 GWT（谷歌网络工具包），尽管我从未使用过 Grails。

使用 GWT，您的客户端 gui 全部用 java 编写。有一个编译器用于创建应用程序的 javascript 版本。因此，创建反映您的对象的简单 GUI 非常容易。当用户按下“保存”时，在服务器端接收到准备保存的对象。然后，只需使用 hibernate/JPA 将对象保存到数据库。

我们曾经有一个简单的内部工具来管理用户权限。管理员只需选中/取消选中一个复选框。AJAX 调用会将更新后的对象发送到服务器，服务器只需在休眠层调用 save()。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-30T20:21:02.910

jruby 或 Grails 上的导轨。是的，这是一种不同的语言，但它们并不难学，而且值得。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-01-16T07:15:11.757

基于 Tapestry 的纯 Java 解决方案，请查看[Tynamo](http://tynamo.org)。符合要求，它简单但可扩展，没有多余的绒毛。同意前面的评论，H2 是一个很棒的小数据库，它也是 Tynamo 默认使用的

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-08-18T13:38:12.227

我不建议在您的情况下使用框架。带有 jdbc 的简单 jsp/servlet 应该可以工作。

但是，如果您决定使用框架，根据我使用 Stripes、Struts1 和 JSF(MyFaces) 的经验，请毫不犹豫地推荐 Stripes。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-30T20:44:25.250

使用[Oracle XE](http://www.oracle.com/technology/products/database/xe/index.html)尝试[tox](http://tox.sourceforge.net/)。两者都是免费的。Tox 是 GPLv2。它是一个使用 XSLT、JavaScript 和 PL/SQL 的 MVC 架构。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-08-15T23:37:15.247

您还可以考虑 Spring Roo，它基本上是纯 Java 的 Grails 等价物。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-31T07:10:04.207

这是我最近一直在使用的一个非常简单的 Java Web 堆栈：

*   **数据库** [H2](http://ttp://www.h2database.com/html/main.html "H2")
*   **RESTful 路由** [Restlet](http://www.restlet.org/)

Restlet 可以在任何 servlet 容器中运行。尽管它们在 Simple 或 Winstone 中效果不佳，但它们在 Jetty 中对我来说效果很好。

可选地，[H2 可以与 Active Objects 结合](http://www.manskes.de/index.php/2008/10/30/the-simplest-activeobjects-database-provider-for-the-h2-database/)以提供非常轻量级的持久性，但我自己没有尝试过。

如果您的数据量很小并且您真的想要简单，为什么不完全放弃 rdbms 并使用[Prevayler](http://prevayler.codehaus.org/)，提供仅由 Restlet 和 Prevayler 组成的完整堆栈？

# java - '.' 之间的区别 和 ”。” 在java中

> ID：497081
> 
> 赞同：7
> 
> 时间：2009-01-30T20:19:34.770
> 
> 标签：java

用 '' 和 "" 连接字符串有区别吗？

例如，有什么区别：

```
String s = "hello" + "/" + "world"; 
```

和

```
String s = "hello" + '/' + "world"; 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-30T20:22:53.263

用双引号括起来的文字，例如`"foo"`，是**字符串**，而单引号文字，例如`'c'`，是**字符**。就串联行为而言，不会有明显的区别。

尽管如此，值得记住的是，字符串和字符并非在所有情况下都可以互换，并且您不能拥有由多个字符组成的单引号字符串。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-01-30T21:46:51.147

```
System.out.println('a'+'b'+'c');
> 294
System.out.println("a"+"b"+"c");
> abc 
```

这里发生的是 (char)+(char)=(int) 换句话说。使用“”作为文本以避免意外。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-30T20:21:39.180

`"."`是一个字符串，`'.'`是一个字符。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-30T21:53:07.060

你可以看看 JDK :-)

给定两个函数：

```
public static String concatString(String cs) {
    return "hello" + cs + "world";
}

public static String concatChar(char cc) {
    return "hello" + cc + "world";
} 
```

在检查字节码后，它归结为两个[AbstractStringBuilder.append(String)](http://kickjava.com/src/java/lang/AbstractStringBuilder.java.htm#387)与[AbstractStringBuilder.append(char)](http://kickjava.com/src/java/lang/AbstractStringBuilder.java.htm#572)。

这两种方法都会调用[AbstractStringBuilder.expandCapacity(int))](http://kickjava.com/src/java/lang/AbstractStringBuilder.java.htm#92)，它最终将分配一个新的*char[]*并首先分配*System.arraycopy*旧的内容。

之后[AbstractStringBuilder.append(char)](http://kickjava.com/src/java/lang/AbstractStringBuilder.java.htm#572)只需将给定的 char 放入数组中，而[AbstractStringBuilder.append(String)](http://kickjava.com/src/java/lang/AbstractStringBuilder.java.htm#387)必须检查一些约束并调用[String.getChars(int, int, char[], int)](http://kickjava.com/src/java/lang/String.java.htm#716)来执行另一个*系统.arraycopy*附加字符串。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-30T20:32:38.567

'' 用于字符文字。

所以你不能这样做：

“Osc”+“ar”+“雷耶斯”

因为 ar 不是字符文字。

在您的示例中，它没有太大区别，因为

```
'/' 
```

是一个 char 文字，并且

```
 "/" 
```

是一个仅包含一个字符的字符串文字。

此外，您可以使用具有以下语法的任何 UTF 字符

```
'\u3c00' 
```

所以你也可以使用：

```
"Osc" + '\u3c00' + "ar 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-30T20:23:29.660

“。” 是一个仅由一个字符组成的字符串。'。' 是一个字符。

一旦将它们连接在一起，就没有区别了。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-30T20:46:46.867

添加一个字符比添加一个字符的字符串快大约 25%。然而，这通常并不重要，例如

```
String s = "hello" + "/" + "world"; 
```

编译器将其转换为一个字符串，因此在任何情况下都不会在运行时发生字符串连接/追加。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-30T20:31:46.930

从理论上讲，将 char 添加到字符串中会更快——Java 6 似乎在幕后创建了 StringBuffers，我记得在 Java Performance 网站上读到，连接 char 会稍微快一些。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-30T21:35:42.073

您可能会发现以下文章很有用：

*   ~~[Java 字符串性能测试](http://bitcraft.ca/2005/05/04/java-string-performance-testing/)~~
*   [Java 字符串连接](http://paulbarry.com/articles/2007/03/15/java-string-concatenation)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-05-22T17:40:14.860

char theLetterA = 'A'; string myString = "一个字符串";

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-07-16T07:14:17.697

如果要添加**更多**字符，则只能在“”之间放置一个**字符**，请使用“”之间的字符。

 **因为字符串是字符的集合，例如**强文本**“hello world”

我们可以通过使用 '' like- **'h' 'e' 'l' 'l' 'o' ...**来获得相同的东西， 并且每个都必须存储在不同的 char 变量中，这可能非常忙碌，所以使用 ""当您有多个要存储的字符和 '' 用于单个字符时

# javascript - 如何找出哪个 DOM 元素具有焦点？

> ID：497094
> 
> 赞同：1507
> 
> 时间：2009-01-30T20:21:31.647
> 
> 标签：javascript, dom

我想在 JavaScript 中找出当前焦点所在的元素。我一直在浏览 DOM，但还没有找到我需要的东西。有没有办法做到这一点，以及如何做到这一点？

我一直在寻找这个的原因：

我正在尝试制作像箭头一样的键并`enter`在输入元素表中导航。选项卡现在可以工作，但输入和箭头默认情况下似乎没有。我已经设置了关键处理部分，但现在我需要弄清楚如何将焦点移到事件处理函数中。

* * *

## 回答 #1

> 赞同：1771
> 
> 时间：2009-01-30T20:24:55.960

使用[`document.activeElement`](https://developer.mozilla.org/en-US/docs/Web/API/Document/activeElement)，所有主流浏览器都支持。

以前，如果您试图找出哪个表单域具有焦点，则不能。要在旧浏览器中模拟检测，请将​​“焦点”事件处理程序添加到所有字段并将最后一个焦点字段记录在变量中。添加一个“模糊”处理程序以在最后一个焦点字段的模糊事件中清除变量。

如果您需要删除，`activeElement`您可以使用模糊；`document.activeElement.blur()`. 它将更改`activeElement`为`body`.

相关链接：

*   [activeElement 浏览器兼容性](https://developer.mozilla.org/en/DOM/document.activeElement#Browser_compatibility)
*   [document.activeElement 的 jQuery 替代品](https://stackoverflow.com/questions/3328320/jquery-alternative-for-document-activeelement)

* * *

## 回答 #2

> 赞同：141
> 
> 时间：2009-01-30T20:34:18.810

正如 JW 所说，您找不到当前的焦点元素，至少以与浏览器无关的方式。但是，如果您的应用程序只有 IE（有些是...），您可以通过以下方式找到它：

```
document.activeElement 
```

看起来 IE 并没有完全出错，这是 HTML5 草案的一部分，并且似乎至少受到最新版本的 Chrome、Safari 和 Firefox 的支持。

* * *

## 回答 #3

> 赞同：91
> 
> 时间：2011-08-27T17:33:54.230

如果你可以使用 jQuery，它现在支持 :focus，只要确保你使用的是 1.6+ 版本。

该语句将为您提供当前关注的元素。

```
$(":focus") 
```

来自：[如何使用 jQuery 选择一个关注它的元素](https://stackoverflow.com/questions/516152/how-to-select-an-element-that-has-focus-on-it-with-jquery/2061798#2061798)

* * *

## 回答 #4

> 赞同：49
> 
> 时间：2011-10-19T13:01:06.370

`document.activeElement`现在[是 HTML5 工作草案](http://www.w3.org/TR/html5/editing.html#dom-document-activeelement)规范的一部分，但在某些非主流/移动/旧版浏览器中可能尚不支持。您可以回退到`querySelector`（如果支持）。还值得一提的是，如果没有元素被聚焦，`document.activeElement`它将返回`document.body`——即使浏览器窗口没有焦点。

以下代码将解决此问题并回退到`querySelector`提供更好的支持。

```
var focused = document.activeElement;
if (!focused || focused == document.body)
    focused = null;
else if (document.querySelector)
    focused = document.querySelector(":focus"); 
```

另外需要注意的是这两种方法之间的性能差异。使用选择器查询文档总是比访问`activeElement`属性慢得多。请参阅此[jsperf.com 测试](http://jsperf.com/focus-pseudo-class-vs-activeelement)。

* * *

## 回答 #5

> 赞同：35
> 
> 时间：2016-11-29T18:51:04.267

如果文档没有聚焦，它本身`document.activeElement`仍然可以返回一个元素（因此文档中没有*任何*内容聚焦！）

您*可能*想要这种行为，或者它*可能*无关紧要（例如在`keydown`事件中），但如果您需要知道某事实际上是专注的，您可以另外检查[`document.hasFocus()`](https://developer.mozilla.org/en-US/docs/Web/API/Document/hasFocus).

如果有一个，以下将为您提供焦点元素，否则`null`。

```
var focused_element = null;
if (
    document.hasFocus() &&
    document.activeElement !== document.body &&
    document.activeElement !== document.documentElement
) {
    focused_element = document.activeElement;
} 
```

要检查*特定*元素是否具有焦点，它更简单：

```
var input_focused = document.activeElement === input && document.hasFocus(); 
```

要检查是否*有任何*焦点，它再次变得更加复杂：

```
var anything_is_focused = (
    document.hasFocus() &&
    document.activeElement !== null &&
    document.activeElement !== document.body &&
    document.activeElement !== document.documentElement
); 
```

* * *

**健壮性注意**：在检查`document.body`and的代码中`document.documentElement`，这是因为某些浏览器返回其中之一或`null`没有关注任何内容。

它没有考虑`<body>`（或可能`<html>`）是否具有`tabIndex`属性，因此*实际上可以被聚焦*。如果您正在编写库或其他东西并希望它健壮，您可能应该以某种方式处理它。

* * *

这是获取焦点元素的（*重*引号）“单线”版本，它在*概念上更复杂*，因为您必须了解短路，并且您知道，假设您显然不适合在一条线上希望它是可读的。
我不会推荐这个。但如果你是 1337 hax0r，idk……它就在那里。如果您不介意在某些情况下获得，
您也可以删除该部分。（你仍然可以得到if is ）：`|| null``false``null``document.activeElement``null`

```
var focused_element = (
    document.hasFocus() &&
    document.activeElement !== document.body &&
    document.activeElement !== document.documentElement &&
    document.activeElement
) || null; 
```

* * *

为了检查特定元素是否被聚焦，或者您*可以*使用事件，但这种方式需要设置（并且可能需要拆卸），并且重要的是，*假设初始状态*：

```
var input_focused = false;
input.addEventListener("focus", function() {
    input_focused = true;
});
input.addEventListener("blur", function() {
    input_focused = false;
}); 
```

您可以通过使用非事件方式来修复初始状态假设，但您也可以直接使用它。

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2014-08-06T19:32:17.920

`document.activeElement``<body>`如果没有可聚焦的元素处于焦点，则可能默认为该元素。此外，如果一个元素被聚焦并且浏览器窗口是模糊的，`activeElement`将继续保持聚焦元素。

如果这两种行为中的任何一种都不可取，请考虑使用基于 CSS 的方法：`document.querySelector( ':focus' )`.

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2017-10-20T11:20:01.097

我发现以下代码片段在尝试确定当前具有焦点的元素时很有用。将以下内容复制到浏览器的控制台中，它会每秒打印出当前焦点元素的详细信息。

```
setInterval(function() { console.log(document.querySelector(":focus")); }, 1000); 
```

`console.log`如果打印出整个元素不能帮助您精确定位元素，请随意修改以注销不同的内容以帮助您精确定位元素。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2010-02-04T12:36:56.283

我在 Mootools 中用于这些目的的一个小帮手：

```
FocusTracker = {
    startFocusTracking: function() {
       this.store('hasFocus', false);
       this.addEvent('focus', function() { this.store('hasFocus', true); });
       this.addEvent('blur', function() { this.store('hasFocus', false); });
    },

    hasFocus: function() {
       return this.retrieve('hasFocus');
    }
}

Element.implement(FocusTracker); 
```

这样，您可以检查元素是否具有在给定元素上调用的`el.hasFocus()`提供的焦点。`startFocusTracking()`

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2010-09-08T18:47:29.503

我喜欢 Joel S 使用的方法，但我也喜欢`document.activeElement`. 我使用了 jQuery 并将两者结合起来。不支持的旧浏览器`document.activeElement`将用于`jQuery.data()`存储“hasFocus”的值。较新的浏览器将使用`document.activeElement`. 我认为这`document.activeElement`会有更好的表现。

```
(function($) {
var settings;
$.fn.focusTracker = function(options) {
    settings = $.extend({}, $.focusTracker.defaults, options);

    if (!document.activeElement) {
        this.each(function() {
            var $this = $(this).data('hasFocus', false);

            $this.focus(function(event) {
                $this.data('hasFocus', true);
            });
            $this.blur(function(event) {
                $this.data('hasFocus', false);
            });
        });
    }
    return this;
};

$.fn.hasFocus = function() {
    if (this.length === 0) { return false; }
    if (document.activeElement) {
        return this.get(0) === document.activeElement;
    }
    return this.data('hasFocus');
};

$.focusTracker = {
    defaults: {
        context: 'body'
    },
    focusedElement: function(context) {
        var focused;
        if (!context) { context = settings.context; }
        if (document.activeElement) {
            if ($(document.activeElement).closest(context).length > 0) {
                focused = document.activeElement;
            }
        } else {
            $(':visible:enabled', context).each(function() {
                if ($(this).data('hasFocus')) {
                    focused = this;
                    return false;
                }
            });
        }
        return $(focused);
    }
};
})(jQuery); 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2011-03-10T23:10:36.767

JQuery 确实支持当前的`:focus`伪类。如果您在 JQuery 文档中查找它，请在“选择器”下查看它指向[W3C CSS 文档](http://www.w3.org/TR/CSS21/syndata.html#value-def-identifier)的位置。我已经用 Chrome、FF 和 IE 7+ 进行了测试。请注意，要使其在 IE 中工作，`<!DOCTYPE...`必须存在于 html 页面上。这是一个示例，假设您已为具有焦点的元素分配了一个 id：

```
$(":focus").each(function() {
  alert($(this).attr("id") + " has focus!");
}); 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2016-07-17T05:52:57.227

如果你想得到一个实例的对象`Element`，你必须使用`document.activeElement`，但如果你想得到一个实例的对象`Text`，你必须使用`document.getSelection().focusNode`。

我希望有所帮助。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2012-02-14T19:29:01.977

如果您使用的是 jQuery，则可以使用它来确定元素是否处于活动状态：

```
$("input#id").is(":active"); 
```

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2015-03-01T07:36:58.577

使用 document.activeElement 存在潜在问题。考虑：

```
<div contentEditable="true">
  <div>Some text</div>
  <div>Some text</div>
  <div>Some text</div>
</div> 
```

如果用户关注的是内部 div，那么 document.activeElement 仍然会引用外部 div。您不能使用 document.activeElement 来确定哪个内部 div 具有焦点。

以下函数解决了这个问题，并返回焦点节点：

```
function active_node(){
  return window.getSelection().anchorNode;
} 
```

如果您希望获得焦点元素，请使用：

```
function active_element(){
  var anchor = window.getSelection().anchorNode;
  if(anchor.nodeType == 3){
        return anchor.parentNode;
  }else if(anchor.nodeType == 1){
        return anchor;
  }
} 
```

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2011-08-04T23:20:21.753

阅读其他答案并尝试自己，它似乎`document.activeElement`会给你在大多数浏览器中需要的元素。

如果你有一个不支持 document.activeElement 的浏览器，如果你有 jQuery，你应该能够用像这样非常简单的东西将它填充到所有焦点事件上（未经测试，因为我没有满足这些标准的浏览器手头):

```
if (typeof document.activeElement === 'undefined') { // Check browser doesn't do it anyway
  $('*').live('focus', function () { // Attach to all focus events using .live()
    document.activeElement = this; // Set activeElement to the element that has been focussed
  });
} 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2012-01-13T11:55:48.300

使用 dojo，您可以使用 dijit.getFocus()

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2009-05-18T12:48:51.537

只是把它放在这里给出我最终想出的解决方案。

我创建了一个名为 document.activeInputArea 的属性，并使用 jQuery 的 HotKeys 插件来捕获箭头键、tab 和 enter 的键盘事件，并创建了一个用于单击输入元素的事件处理程序。

然后每次焦点改变时我都会调整 activeInputArea，这样我就可以使用该属性来找出我在哪里。

不过，这很容易搞砸，因为如果您的系统中有错误并且焦点不在您认为的位置，那么很难恢复正确的焦点。

# .net - 常量类库——最佳实践？

> ID：497101
> 
> 赞同：4
> 
> 时间：2009-01-30T20:22:51.893
> 
> 标签：.net

我在一个内部应用程序上使用 .Net Reflector 来尝试了解以前的开发人员在做什么并学习。我从来没有关于如何开发应用程序的*实际指导，所以我从我能做到的地方（万岁堆栈溢出）。*话虽如此，我发现了一些让我感到困惑的东西。一个名为 WinConstant 的类库，包含以下代码。

这是我的实际问题：

1.  这有什么可能的用途？

2.  在类库中存储一堆常量有什么价值？

3.  这被认为是“最佳实践”吗？

想法和指导表示赞赏！

```
 Public Class clsConstant
    Public Const cAccess As String = "Access"
    Public Const cAddress As String = "Address"
    Public Const cCancel As String = "Cancel"
    Public Const cCity As String = "City"
    Public Const cClear As String = "Clear"
    Public Const cClickOnMessage As String = "Click on any row in top pane to see the detail fields in the bottom pane."
    Public Const cClientID As String = "ClientID"
    Public Const cColon As String = ": "
    Public Const cComma As String = ","
    Public Const cContactID As String = "ContactID"
    Public Const cCounty As String = "County"
    Public Const cDash As String = "-"
    Public Const cDelete As String = "Delete"
    Public Const cDepartment As String = "Department"
    Public Const cError As String = "Error"
    Public Const cExec As String = "Exec"
    Public Const cFalse As String = "False"
    Public Const cFavorite As String = "Favorite"
    Public Const cFederal As String = "Federal"
    Public Const cFriday As String = "Friday"
    Public Const cfrmMain As String = "frmMain"
    Public Const cfrmModuleLogin As String = "frmModuleLogin"
    Public Const cfrmModuleSplash As String = "frmModuleSplash"
    Public Const cHelp As String = "Help"
    Public Const cHint As String = "Hint"
    Public Const cImagePath As String = "../../image"
    Public Const cIn As String = "In"
    Public Const cInformation As String = "Information"
    Public Const cInitialScreenID As String = "InitialScreenID"
    Public Const cInsert As String = "Insert"
    Public Const cJuvenileID As String = "JuvenileID"
    Public Const cLetter As String = "Letter"
    Public Const cManual As String = "Manual"
    Public Const cMasterID As String = "MasterID"
    Public Const cModuleID As String = "ModuleID"
    Public Const cModuleName As String = "ModuleName"
    Public Const cMonday As String = "Monday"
    Public Const cName As String = "Name"
    Public Const cNegative As String = "Negative"
     _
    Public Shared ReadOnly cNLowDate As DateTime = New DateTime(&H851055320574000)
     _
    Public Shared ReadOnly cNullDate As DateTime = New DateTime
    Public Const cNullDateString As String = "12:00:00 AM"
    Public Const cOfficeIDDefault As String = "01"
    Public Const cOne As Integer = 1
    Public Const cOut As String = "Out"
    Public Const cPopUp As String = "PopUp"
    Public Const cPositive As String = "Positive"
    Public Const cProcess As String = "Process"
    Public Const cProviderID As String = "ProviderID"
    Public Const cQuestion As String = "Question"
    Public Const cRead As String = "Read"
    Public Const cReferralID As String = "ReferralID"
    Public Const cReminder As String = "Reminder"
    Public Const cReport As String = "Report"
    Public Const cReportEngine As String = "ReportEngine"
    Public Const cReportEnginePath As String = "ReportEnginePath"
    Public Const cReportingServices As String = "ReportingServices"
    Public Const cReportServer As String = "ReportServer"
    Public Const cReportService As String = "ReportService"
    Public Const cReportServiceLocal As String = "ReportServiceLocal"
    Public Const cReportServiceServer As String = "ReportServiceServer"
    Public Const cSaturday As String = "Saturday"
    Public Const cSearch As String = "Search"
    Public Const cSelect As String = "Select"
    Public Const cSpace As String = " "
    Public Const cSQLLoginError As String = "SQL Server login/password invalid"
    Public Const cStart As String = "Select a module"
    Public Const cState As String = "State"
    Public Const cSubjectID As String = "SubjectID"
    Public Const cSunday As String = "Sunday"
    Public Const cThursday As String = "Thursday"
    Public Const cTooltipCancel As String = "Reset form data values back to before all manual changes."
    Public Const cTooltipClear As String = "Clears all data entry fields prior to an Insert"
    Public Const cTooltipClient As String = "Display a Client popup window."
    Public Const cTooltipClose As String = "Close this form"
    Public Const cTooltipDelete As String = "Delete the current record being displayed, no undo possible."
    Public Const cTooltipExe As String = "Initiate a batch process."
    Public Const cTooltipInsert As String = "Insert a brand new record"
    Public Const cTooltipSearch As String = "Perform a Search for values entered."
    Public Const cTooltipSelect As String = "Perform a Select for values entered."
    Public Const cTooltipUpdate As String = "Update an existing record"
    Public Const cTrue As String = "True"
    Public Const cTuesday As String = "Tuesday"
    Public Const cUnderscore As String = "____________________________________________________________"
    Public Const cUpdate As String = "Update"
    Public Const cWarning As String = "Warning"
    Public Const cWeb As String = "Web"
    Public Const cWednesday As String = "Wednesday"
    Public Const cWorkerID As String = "WorkerID"
    Public Const cZero As Integer = 0
    Public Shared strLongDate As String() = DateAndTime.Now.ToLongDateString.Split(New Char() { ","c })
    Public Shared strModuleMainStatusStripFormID As String = Nothing
End Class 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-30T20:51:38.650

在用 c 编写 windows 应用程序的时代，windows 中有类似的文件#included，其中包含**一长串**创建常量的#defines。各种 c 应用程序在它们自己的文件中模拟了这种方法。“阶级”似乎是这种“c-ism”的“音译”。面向对象设计的基本原理是将代码和数据混合成相关的功能单元：对象。正如[杰富勒顿](http://www.rtis.com/nat/user/jfullerton/BENEFIT.HTM)所写：

> 从编程的角度来看，面向对象涉及程序对象、封装、继承和多态。概念对象在程序代码中建模。封装将对象的数据和使用这些数据的方法一起作为对象的一部分。

很明显，这个常量列表不符合 OO 实践，而是回到过去。

要回答您的问题：

1.  -- 这个类持有常量，就是这样
2.  -- 老开发者这样做可能是因为他习惯这样做
3.  -- 这不是*当前*的最佳实践。

当然，如果这是您的应用程序的一部分，您就不能将其丢弃。[相反，假设您使用测试驱动开发](http://c2.com/cgi/wiki?TestDrivenDevelopment)和[重构的](https://rads.stackoverflow.com/amzn/click/com/0201485672)*当前*最佳实践，随着时间的推移，这是需要重构的东西

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-30T20:27:35.517

将*文字*与其余代码分开是个好主意。

奇怪的是，这些应该主要是资源而不是常量字符串。然后，如果需要，它们可以很容易地本地化，或者在不重新编译整个应用程序的情况下替换/更新它们。

其中一些甚至不应该是资源：`cUnderscore`例如，看起来它正在使用文本来创建视觉效果——通常是一个坏主意。

在你的前任的辩护中，我认为这段代码比在整个源代码中找到相同的常量更可取，因为它会使资源重构变得更简单一些。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-30T20:26:08.127

常数是永远不会改变的东西，例如

```
Public Const NumberOne as Int = 1 
```

所以这是我的第一句话：你总结的一些东西并不是真正的 const。

另一个缺点是使用 const 关键字会产生二进制依赖性。这意味着您将不得不重建使用您的 constants.dll 的程序集。你不能只是更换它。这是由 consts 的工作方式引起的：编译器将名称替换**为编译时**的值。

解决此问题的方法是使用 ReadOnly 而不是 Const。

我真的不认为创建这样一个库是一个好习惯。无论如何，我不会允许我的团队创建一个...

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-30T20:29:49.460

这看起来就像一个开发人员有一个编码标准说：不要在代码中使用字符串文字，并且尽职尽责地分离出每个常量，无论它是否有意义。

例如，其中可能有一些元素在代码中需要数字 1，而不是使用 DefaultNumberOfLineItems 或其他一些描述性常量，而是使用 NumberOne = 1;

最佳实践是保持常量的描述性并接近其使用点。具有某种含义并且彼此相关的相关常量的静态类没有任何问题。

例如，我研究过一个系统，它使用唯一键标记属性。这些键被收集在一个静态类中，属性上有描述性名称，实际上键是由自动化系统生成的

```
public static class AttributeIDs
{
   public const string Name = "UniqueGeneratedKeyForNameAttribute";
   public const string Description ="UnqiueGeneratedKeyForDescriptionAttribute";
   ... etc.
} 
```

在实践中，这就像

```
MyAccess.GetValueForAttribute(AttributeIDs.Name); 
```

它将所有相关的常量放在一起。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-30T20:30:54.997

这样的类有可能有用的场景。通常，诸如“幻数”或“幻字符串”之类的东西会变成常量并放在静态（共享）类中。这样做的原因是将这些“神奇”值隔离到一个位置，并允许它们被有意义的名称引用。（通常用于数值。）在字符串值的情况下，它有助于确保每次都由相同的值引用。最好的例子是 app.config 文件中的字符串键。

话虽这么说，常量应该用于不会改变的东西（或者很少改变它实际上是常量）。在大多数情况下，可能会更改（或需要本地化）的字符串应作为资源存储在 .resx 文件中。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-30T20:36:37.560

拥有一个常量类库并没有错。一般来说，常量是一种很好的做法。毕竟，枚举在 .NET 中无处不在，它们只是分组的数字常量。对常量程序集的依赖与任何其他依赖没有什么不同。理解常量的用途更多的是关于应用程序的逻辑。我的猜测是，这些常量可以启用详细日志记录，而无需使用一堆字符串文字填充应用程序。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-30T21:16:37.150

它真的看起来像一个简单的字符串表实现。

这些值不是魔术字符串和“简单”的系统范围更改。我认为资源文件更容易实现和维护。

您同事的实施是最佳实践吗？我会说不。使用字符串表，特别是如果您需要在应用程序中进行国际化。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-06T16:11:22.753

在许多情况下，将字符串常量放入单独的类中是一种最佳实践，但是，这是一个糟糕的示例。更好的方法是创建一个 StringConstants 命名空间，然后组织字符串，以便将相关的字符串常量组织到单独的类中。这只是一个好主意的糟糕实现。

如果全球化是一个问题，那么（正如其他人指出的那样），字符串应该保存在资源文件中。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-06-05T08:35:52.327

我们这样做是为了从代码库中分离出数据库特定的常量。这种解耦使我们有可能在将来将数据库（当前为 MS Access）更新为更好的东西（可能是 SQL Server），而根本无需更改很多代码库。这是一个特定于表的常量块的示例：

```
 Public Class Equalisations
    Public Const TableName As String = "Equalisations"
    Public Class SPs
        Public Const SelectAll As String = General.SPs.Prefix & TableName & General.SPs.SelectAll
        Public Const SelectDropDownList As String = General.SPs.Prefix & TableName & General.SPs.SelectDropDownList
        Public Const SelectAllChildRecords As String = General.SPs.Prefix & TableName & General.SPs.SelectAllChildRecords
        Public Const SelectRecord As String = General.SPs.Prefix & TableName & General.SPs.SelectRecord
        Public Const SelectMaxId As String = General.SPs.Prefix & TableName & General.SPs.SelectMaxId
        Public Const InsertRecord As String = General.SPs.Prefix & TableName & General.SPs.InsertRecord
        Public Const DeleteAllRecords As String = General.SPs.Prefix & TableName & "_DeleteAllRecords"
    End Class
    Public Class Cols
        Public Const CompanyAccountID As String = "CitiAccountID"
        Public Const NAVDate As String = "NAVDate"
        Public Const GLCodeID As String = "GLCodeID"
        Public Const Income As String = "Income"
        Public Const LoadedFileID As String = "LoadedFileID"
    End Class
    Public Class Parms
        Public Const CompanyAccountID As String = "pCitiAccountID"
        Public Const NAVDate As String = "pNAVDate"
        Public Const GLCodeID As String = "pGLCodeID"
        Public Const Income As String = "pIncome"
        Public Const LoadedFileID As String = "pLoadedFileID"
    End Class
End Class 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-30T20:25:45.567

我能想到的唯一解释是某种消息库——但这不适用于 90% 的条目。

例如，这很愚蠢：

```
 Public Const cInsert As String = "Insert" 
```

这闻起来非常非常糟糕。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-09-07T07:02:01.207

c# 中有两种可用的常量：编译时常量和运行时常量。他们有不同的行为，使用错误的行为会降低你的表现或正确性。所以选择你正在为你的项目使用的正确的常量类型..

[http://dotnetacademy.blogspot.com/2011/09/constants-in-net.html](http://dotnetacademy.blogspot.com/2011/09/constants-in-net.html)

# sql - 这个 SQLite 查询有什么问题？

> ID：497109
> 
> 赞同：1
> 
> 时间：2009-01-30T20:25:07.690
> 
> 标签：sql, flash, actionscript-3, sqlite, air

我正在创建一个连接到 SQLite 数据库的 AIR 应用程序。数据库对这个插入语句犹豫不决，我根本不知道为什么。没有错误，它只是没有继续前进。

```
INSERT INTO Attendee (AttendeeId,ShowCode,LastName,FirstName,Company,Address,Address2,City,State,ZipCode,Country,Phone,Fax,Email,BuyNum,PrimaryBusiness,Business,Employees,Job,Value,Volume,SpouseBusiness,DateAdded,ConstructionWorkType,UserPurchaser,DecisionMaker,SafetyProducts,NearFuturePurchase,RepContact,Winner) VALUES('39610','111111','SMITH','JIM','COMPANY','1000 ROAD STREET','','PITTSBURGH','PA','15219','','5555555555','5555555555','PERSON@EXAMPLE.NET','','','0000000000000000000','','','','','0?','Fri Jan 30 14:20:08 GMT-0500 2009','other','neither','no','gas_detection','no','no','winner') 
```

我知道该应用程序可以连接到数据库，因为它可以很好地创建表。这是表的架构供您参考：

```
CREATE TABLE Attendee (AttendeeId TEXT PRIMARY KEY,ShowCode TEXT,LastName TEXT,FirstName TEXT,Company TEXT,Address TEXT,Address2 TEXT,City TEXT,State TEXT,ZipCode TEXT,Country TEXT,Phone TEXT,Fax TEXT,Email TEXT,BuyNum TEXT,PrimaryBusiness TEXT,Business TEXT,Employees TEXT,Job TEXT,Value TEXT,Volume TEXT,SpouseBusiness TEXT,DateAdded TEXT,ConstructionWorkType TEXT,UserPurchaser TEXT,DecisionMaker TEXT,SafetyProducts TEXT,NearFuturePurchase TEXT,RepContact TEXT, Winner TEXT) 
```

INSERT 语句中很有可能存在错误，因为如果我尝试在单独的 Adob​​e Air SQLite 管理程序上执行它，它会引发一个模棱两可的错误 (#3115)。

感谢您提供的任何见解。

编辑：

对于那些想知道的人，如果我制作一个简单的表格，那么：

```
CREATE TABLE Attendee (AttendeeId TEXT) 
```

并尝试插入，因此：

```
INSERT INTO Attendee (AttendeeId) VALUES('09283A') 
```

我仍然收到错误 #3115。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-30T20:30:26.400

您是否尝试过运行较小的语句？就像，一个非常简单的表上的一个非常简单的 INSERT？

您是否尝试过引用列名？也许其中一个是保留字。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T20:29:40.397

```
insert into Attendee ("AttendeeId", "ShowCode", "LastName", "FirstName", "Company", "Address", "Address2", "City", "State", "ZipCode", "Country", "Phone", "Fax", "Email", "BuyNum", "PrimaryBusiness", "Business", "Employees", "Job", "Value", "Volume", "SpouseBusiness", "DateAdded", "ConstructionWorkType", "UserPurchaser", "DecisionMaker", "SafetyProducts", "NearFuturePurchase", "RepContact", "Winner") values ('39610', '111111', 'SMITH', 'JIM', 'COMPANY', '1000 ROAD STREET', '', 'PITTSBURGH', 'PA', '15219', '', '5555555555', '5555555555', 'PERSON@EXAMPLE.NET', '', '', '0000000000000000000', '', '', '', '', '0?', 'Fri Jan 30 14:20:08 GMT-0500 2009', 'other', 'neither', 'no', 'gas_detection', 'no', 'no', 'winner'); 
```

试试这个，它是计算机生成的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T12:57:57.463

[显然](http://coenraets.org/blog/2008/02/sqlite-admin-for-air-10/#div-comment-273178)你需要使用双引号而不是单引号。

# python - 是否有 Python 等效于 Perl 的 x 运算符（复制字符串）？

> ID：497114
> 
> 赞同：12
> 
> 时间：2009-01-30T20:27:49.403
> 
> 标签：python, perl, replicate

在 Perl 中，我可以使用 'x' 运算符复制字符串：

```
$str = "x" x 5; 
```

我可以在 Python 中做类似的事情吗？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-01-30T20:29:15.390

```
>>> "blah" * 5
'blahblahblahblahblah' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-05-23T06:43:10.823

这是对官方 Python3 文档的参考：

[https://docs.python.org/3/library/stdtypes.html#string-methods](https://docs.python.org/3/library/stdtypes.html#string-methods)

> 字符串实现了所有[*常见*](https://docs.python.org/3/library/stdtypes.html#typesseq-common)的序列操作......

...这导致我们：

[https://docs.python.org/3/library/stdtypes.html#typesseq-common](https://docs.python.org/3/library/stdtypes.html#typesseq-common)

```
Operation      | Result
s * n or n * s | n shallow copies of s concatenated 
```

例子：

```
>>> 'a' * 5
'aaaaa'
>>> 5 * 'b'
'bbbbb' 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-12-25T12:03:27.007

在 Perl ( `man perlop`)`x`中[称为](https://perldoc.perl.org/perlop.html). 在 Python 3中，这也[称为](https://docs.python.org/3/library/stdtypes.html#common-sequence-operations). 在 Python 2 中，它可能被称为相同的东西，但我只[发现它被称为](https://docs.python.org/2/library/operator.html#mapping-operators-to-functions)内置运算符。`repetition operator`
`*``repetition operator`
`sequence repetition`

我认为离题很重要，字符串不是操作员的唯一用途。这里还有一些：

*   字符串（好的，是的）
    *   Perl`"ab"x5`产生`"ababababab"`
    *   Python`"ab"*5`也一样。
*   列表
    *   Perl`@ones = (1) x @ones`分配每个数组元素并且不会重新分配引用。
    *   Python`ones = [1] * len(ones)`看起来像相同的结果，但重新分配了引用。
*   列表列表：
    *   Perl`(0)x5`来产生`((0),(0),(0),(0),(0))`.
    *   Python，几乎：`[[0]]*5` *是* `[[0],[0],[0],[0],[0]]`
*   字典/哈希：
    *   Perl：似乎不支持散列。您需要转换为列表并返回。
    *   Python：dict 似乎也不支持。

然而，正如上面“几乎”所暗示的那样，Python 中有一个警告（来自文档）：

```
>>> lists = [[]] * 3
>>> lists
[[], [], []]
>>> lists[0].append(3)
>>> lists
[[3], [3], [3]] 
```

同样在 Perl 中，我不确定它在哪里记录，但空列表与运算符的行为有点不同，可能是因为它与`False`.

```
@one=((1))x5;
say(scalar @one); # 5
@arr=(())x5;
say(scalar @arr); # 0 
```

# php - 人气算法

> ID：497116
> 
> 赞同：4
> 
> 时间：2009-01-30T20:28:53.143
> 
> 标签：php, mysql, algorithm

我想用上传的“最热门”插图填充我的用户提交插图网站的主页。

以下是我可以采取的措施：

*   有多少人收藏了那幅插图
    *   `votes`表包括投票日期
*   插图上传时
    *   `illustration`表的创建日期
*   评论数量（目前最大评论总数约为 10 条）
    *   `comments`表有评论日期

我已经四处搜索，但不希望用户权限发挥作用，但大多数算法都包含这一点。

我还需要确定在获取数据的 MySQL 中进行计算是否更好，或者是否应该每隔一小时左右有一个 PHP/cron 方法。

我只需要 20 幅插图来填充主页。我不需要对这些数据进行任何类型的分页。

我如何权衡年龄与选票？当然，提交较少的网站需要较少的添加日期权重？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-31T13:45:26.267

许多使用某种流行度排名的网站通过使用标准算法来确定分数，然后随着时间的推移永久衰减。我发现对于流量较少的网站效果更好的是一个乘数，它可以为新内容/活动提供奖励——它基本上是相同的，但是在您选择的一段时间后分数会停止变化。

例如，这里有一个您可能想尝试的伪示例。当然，您需要根据自己对网站的体验来调整对每个类别的权重。评论很少见，但需要用户付出更多的努力而不是喜欢/投票，因此他们可能应该获得更多的权重。

```
score = (votes / 10) + comments  
age = UNIX_TIMESTAMP() - UNIX_TIMESTAMP(date_created)

if(age < 86400) score = score * 1.5 
```

这种方法会给过去一天上传的新内容带来好处。如果您只想以类似的方式处理最近收藏或评论的内容，您可以在查询中添加一些 WHERE 约束，从数据库中获取分数。

实际上有两个重要的原因不能即时计算这个排名。

1.  要求您的数据库获取所有这些数据并在每个页面加载时进行计算以重新排序项目会导致昂贵的查询。
2.  可能是一个较小的陷阱，但如果您在网站上的活动量相对较少，排名的微小变化可能会导致内容大幅移动。

这使您可以定期缓存结果或设置一个 cron 作业来更新一个新的数据库列，该列包含您排名所依据的这个分数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-30T21:07:23.440

显然，这有一些主观性——没有一种“正确”的算法可以确定适当的平衡——但我会从每单位年龄的投票数开始。MySQL 可以做基本的数学运算，因此您可以要求它按投票商随时间的推移进行排序；但是，出于性能原因，缓存查询结果可能是个好主意。也许像

```
SELECT images.url FROM images ORDER BY (NOW() - images.date) / COUNT((SELECT COUNT(*) FROM votes WHERE votes.image_id = images.id)) DESC LIMIT 20 
```

但我的 SQL 生锈了 ;-)

当然，取一个简单的平均值会偏向于出现在首页上的新图像。如果你想消除这种偏见，比如说，你可以只计算在图像发布后特定时间限制内发生的那些投票。对于比该时间限制更新的图像，您必须通过将投票数乘以时间限制然后除以图像的年龄来进行标准化。或者，您可以为选票赋予不断变化的权重，例如`exp(-time(vote) + time(image))`. 依此类推……取决于您对该算法将要做什么的具体程度，可能需要进行一些实验才能确定哪种公式可以提供最佳结果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T20:31:28.350

就实际算法而言，我没有有用的想法，但在实现方面，我建议将结果缓存在某个地方，并定期更新 - 如果结果计算导致昂贵的查询，你可能不会想要减慢您的响应时间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T21:01:54.717

就像是：

`(count favorited + k) * / time since last activity`

权重越高`k`，收藏它的人数越少。

您还可以将时间更改为它首次出现的时间 + 最后一次活动的时间，这将确保旧插图随着时间的推移而消失。

# c# - 使用 Visual Studio 在 C# 中进行单元测试入门

> ID：497118
> 
> 赞同：16
> 
> 时间：2009-01-30T20:29:12.737
> 
> 标签：c#, visual-studio, unit-testing

我知道 Visual Studio 提供了一些单元测试的好东西。我如何使用它们，你如何使用它们？关于单元测试我应该知道什么（假设我什么都不知道）。

[这个问题](https://stackoverflow.com/questions/16860/getting-started-with-unit-testing)很相似，但它没有解决 Visual Studio 可以做什么，因此请不要将其标记为重复。发布为社区 Wiki，因为我不想成为代表妓女。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-30T21:12:04.350

很明显，最显着的区别是 MSTest 支持内置于 Visual Studio 中，并直接提供单元测试、代码覆盖和模拟支持。为了在外部（第三方）单元测试框架中做相同类型的事情，通常需要多个框架（一个单元测试框架和一个模拟框架）和其他工具来进行代码覆盖率分析。

使用 MSTest 单元测试工具的最简单方法是打开要为其创建单元测试的文件，在编辑器窗口中单击鼠标右键，然后从上下文菜单中选择“创建单元测试...”菜单。我更喜欢将我的单元测试放在一个单独的项目中，但这只是个人喜好。这样做将创建一种“模板”测试类，其中包含测试方法，允许您测试类的每个功能和属性。此时，您需要确定测试通过或失败意味着什么（换句话说，确定在给定一组输入的情况下应该发生什么）。

通常，您最终会编写类似于以下内容的测试：

```
string stringVal = "This";
Assert.IsTrue(stringVal.Length == 4); 
```

这表示对于名为 stringVal 的变量，在赋值后 Length 属性应该等于 4。

另一个线程中列出的资源应该提供一个很好的起点来理解什么是一般的单元测试。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-30T20:44:48.807

VS 中的单元测试结构在使用上与 NUnit 类似。它的一个有趣（且有用）的特性确实与 NUnit 有很大不同。VS 单元测试可以用于没有考虑单元测试的代码。

您可以在编写应用程序后构建单元测试框架，因为测试结构允许您从外部引用方法调用并使用加速和拆卸代码来准备测试环境。例如：如果您有一个类中的方法使用该方法外部的资源，您可以在加速类（VS 为您创建）中创建它们，然后在单元测试类（也创建VS 为您服务）。测试完成后，拆卸类（再次......由 VS 为您提供）将释放资源并进行清理。整个过程存在于您的应用程序之外，因此不会干扰代码库。

VS 单元测试框架其实是一个很好实现且易于使用的框架。最重要的是，您可以将它与没有考虑单元测试的应用程序一起使用（这对于 NUnit 来说并不容易）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-30T20:54:24.323

我要做的第一件事是下载一份[TestDriven.Net](http://testdriven.net)以用作测试运行程序。这将添加一个右键单击菜单，您可以通过右键单击测试方法并选择 Run Test(s) 来运行单个测试。这也适用于类中的所有测试（在类中右键单击，但在方法外）、命名空间（右键单击项目或在类外的命名空间中）或整个解决方案（右键单击解决方案）。它还增加了使用覆盖率（内置或 nCover）或从同一右键单击菜单中的调试器运行测试的能力。

至于设置测试，通常我坚持每个项目一个测试项目，每个测试类一个测试类。有时我会为跨很多类的方面创建测试类，但通常不会。我创建它们的典型方法是首先创建类的骨架——没有属性，没有构造函数，但是使用我要测试的第一个方法。此方法只是抛出一个 NotImplementedException。

创建类骨架后，我在被测方法中使用右键单击 Create Unit Tests。这会弹出一个对话框，让您创建一个新的测试项目或选择一个现有的项目。我创建并适当命名一个新的测试项目，并让向导创建类。完成此操作后，您可能还想为测试项目中的类创建私有访问器函数。如果您的班级发生重大变化，有时需要更新（重新创建）这些内容。

现在你有一个测试项目和你的第一个测试。首先修改测试以定义方法的所需行为。编写足够的代码（勉强）通过测试。继续编写测试/编写代码，为该方法指定更多行为，直到定义该方法的所有行为。然后根据需要转到下一个方法或类，直到您有足够的代码来完成您正在处理的功能。

您可以根据需要添加更多不同类型的测试。您还可以将源代码控制设置为要求部分或所有测试在签入前通过。

# linq - 基于组合框值构建动态 LINQ 查询

> ID：497121
> 
> 赞同：9
> 
> 时间：2009-01-30T20:29:42.143
> 
> 标签：linq, silverlight, linq-to-sql, dynamic-linq

我在 Silverlight 中有一个组合框。它具有由我的一个 LINQ-to-SQL 对象（即名称、地址、年龄等）的属性构建的一组值。我想根据组合框中选择的值过滤我的结果。

示例：假设我希望每个人都姓“Smith”。我会从下拉列表中选择“姓氏”，然后在文本框控件中输入 smith。通常我会写一个类似于...的LINQ查询

> **var query = from p in collection
> where p.LastName == textbox.Text
> select p;**

是否可以动态决定属性，也许使用反射？就像是

> **var query = from p in collection
> where p.(DropDownValue) == textbox.Text
> select p;**

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-30T23:41:36.077

假设：

```
public class Person
{
    public string LastName { get; set; }
}

IQueryable<Person> collection; 
```

您的查询：

```
var query =
    from p in collection
    where p.LastName == textBox.Text
    select p; 
```

意思相同：

```
var query = collection.Where(p => p.LastName == textBox.Text); 
```

编译器将其从扩展方法转换为：

```
var query = Queryable.Where(collection, p => p.LastName == textBox.Text); 
```

的第二个参数`Queryable.Where`是一个`Expression<Func<Person, bool>>`。编译器了解`Expression<>`类型并生成代码以构建表示 lambda的[表达式树：](http://msdn.microsoft.com/en-us/library/bb397951.aspx)

```
using System.Linq.Expressions;

var query = Queryable.Where(
    collection,
    Expression.Lambda<Func<Person, bool>>(
        Expression.Equal(
            Expression.MakeMemberAccess(
                Expression.Parameter(typeof(Person), "p"),
                typeof(Person).GetProperty("LastName")),
            Expression.MakeMemberAccess(
                Expression.Constant(textBox),
                typeof(TextBox).GetProperty("Text"))),
        Expression.Parameter(typeof(Person), "p")); 
```

这就是查询语法的含义。

您可以自己调用这些方法。要更改比较属性，请将其替换：

```
typeof(Person).GetProperty("LastName") 
```

和：

```
typeof(Person).GetProperty(dropDown.SelectedValue); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T21:00:46.887

Scott Guthrie 有一个关于动态构建的 LINQ to SQL 查询的简短系列：

[http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)

这是最简单的方法......然后还有另一种更复杂的方法：

[http://www.albahari.com/nutshell/predicatebuilder.aspx](http://www.albahari.com/nutshell/predicatebuilder.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T01:46:40.843

您还可以使用我创建的库：http: [//tomasp.net/blog/dynamic-linq-queries.aspx](http://tomasp.net/blog/dynamic-linq-queries.aspx)。您可以将 ComboBox 中的属性存储为 lambda 表达式，然后只需编写：

```
var f = (Expression<Func<Product, string>>)comboBox.SelectedValue;
var query =
    from p in collection
    where f.Expand(textBox.Text)
    select p; 
```

# wpf - 如何防止 VS WPF 设计器在工具箱中的每个对象上放置边距

> ID：497125
> 
> 赞同：5
> 
> 时间：2009-01-30T20:30:17.353
> 
> 标签：wpf, visual-studio-2008, wpf-controls, designer

当我将控件从工具箱拖到 Visual Studio 2008 WPF 设计图面上时，它会根据我放置它的位置和默认大小来设置边距。

有什么办法可以防止 VS 设置这些？当我将控件放在堆栈面板上时，我希望它流入面板中的现有控件。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-30T21:43:52.290

我从来没有找到防止这种情况的方法。我只是键入 XAML。

**编辑**：

以上是我将近三年前写的。与此同时，设计时体验似乎变得更好了。

虽然如果您拖放，设计师仍然会添加硬编码的边距，但有一些方法可以删除这些边距，而无需手动操作。

这是一篇文章的链接，该文章说明了如何使用 Visual Studio 2010 中的设计工具来布置表单，而无需键入任何 XAML。（尽管有标题，但它是关于 WPF 的。）

文章的第一部分显示了硬编码的像素，但我已经链接到第二部分，它显示了如何在没有硬编码的情况下布置控件。

[Windows 窗体开发人员的布局技术](https://blogs.msdn.microsoft.com/wpfsldesigner/2010/06/04/layout-techniques-for-windows-forms-developers/#content)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-31T17:25:10.847

当我将控件放入堆栈面板时，它不会添加边距，而是与其余部分一起“流入”。

默认情况下，您放置在设计图面上的控件有一个边距，因为这就是它知道放置位置的方式。我通常做的是创建一个网格并将它的边距设置在我想要的位置，然后创建列和行以将控件放入其中。我加入了其他控件，这将添加通常不是我想要的边距。在将所有控件放入网格并合理放置后，我切换到 XAML 视图并完全删除边距（这会导致像按钮一样的控件填充整个空间），或者将边距设置为 5，这样可以放置一些控件周围有很好的填充。

底线...对于 Silverlight 开发尤其如此，您必须习惯于直接操作 XAML。这是您在所需位置获得布局的唯一方法。这是我的意见，也是我店里大多数从事 WPF/silverlight 开发的人的意见。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T04:41:07.860

不幸的是，似乎没有办法做到这一点。

默认大小设置为您操纵控件大小的结果是设计器。当您增加控件的宽度和/或高度时，设计人员会将您的操作解释为使控件具有指定宽度和/或高度的请求。

边缘也遇到了类似的情况。当您更改控件在设计器中的位置时，它会修改属性以实现您创建的布局。在大多数容器的情况下，最简单的解决方案是修改边距以达到所需的位置，正如您已经指出的那样，简单的解决方案并不总是最理想的。

就我个人而言，我更喜欢只使用 XAML 编辑器，并且当我想查看当前布局时，偶尔会在 WPF 设计器中使用高峰。我也倾向于使用 Grid 来布局我的大部分窗口/控件，因为它不仅为大小和定位提供了最大的灵活性，而且还为其他任务/功能（如动画、变换等）提供了最大的灵活性。

# sql-server-2005 - 在 SQL 中创建程序集时出错：MSG 33009

> ID：497128
> 
> 赞同：4
> 
> 时间：2009-01-30T20:30:33.983
> 
> 标签：sql-server-2005, assemblies

我正在尝试将 dll 加载到 MSSQL 中：

```
USE dbname
GO

CREATE ASSEMBLY foo 
FROM 'C:\foo\foo.dll'
WITH PERMISSION_SET = UNSAFE
GO 
```

我收到一个错误，指出：

```
消息 33009，第 16 层，状态 2，第 2 行
master数据库中记录的数据库所有者SID与数据库所有者不同
SID 记录在数据库“dbname”中。您应该通过重置
使用 ALTER AUTHORIZATION 语句的数据库“dbname”的所有者。

```

MSDN 实际上并没有告诉我更多关于错误的信息，而不是错误告诉自己的信息。

我浏览了整个互联网，得出的结论是，任何人为避免这种情况所做的唯一事情就是：

```
use dbname
go
EXEC dbo.sp_changedbowner @loginame = N'sa', @map = false 
```

但是改变所有者真的是避免这个错误的唯一方法吗？为什么我必须这样做，还有其他方法吗？在我进入并盲目更改所有者之前，我想了解有关此错误的更多信息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T03:52:43.540

我遇到了完全相同的问题，对我来说唯一的解决方案是更改所有者，然后再将其更改回来。

问题是用户既是每个数据库又是每个服务器。发生的情况是每个数据库用户的用户名与每个服务器用户的用户名相同，但是它们的 SID 不匹配，因此它认为它可能是不同的人。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-09T15:00:48.300

您可能想要检查的内容：如果您登录的用户（并且正在创建数据库）也映射到“模型”数据库，那么该用户将在新数据库的用户选项卡下创建。这意味着在实例的安全选项卡和数据库的本地用户下都有凭据。要立即解决问题，请从本地数据库中删除用户 - 然后您可以将其设置回所有者（从实例凭据）：

删除用户 [MyUser]; exec sp_changedbowner [我的用户]

要长期解决此问题，请从“模型”数据库中取消映射用户（Security/Logins/[MyUser] Properties - User Mapping）。

# haskell - C++ 的 std::bind2nd 是否有内置的 Haskell 等价物？

> ID：497132
> 
> 赞同：4
> 
> 时间：2009-01-30T20:31:29.427
> 
> 标签：haskell, bind2nd

我缺少的是部分应用函数的第二个参数而不是第一个参数的能力。当我想将函数传递给 map 之类的东西时，这特别有用，但不必每次都为它编写 lambda。

我为此编写了自己的函数（定义如下，以防万一确实没有任何内置函数，并且其他人对此感到好奇），但我真的很想知道 Prelude 中是否已经存在为此成语，因为我更喜欢重用而不是重新发明。

这是我的定义和一个简单的例子：

```
bind2nd :: (a -> b -> c) -> b -> a -> c
bind2nd f b = \a -> f a b

foo :: Int -> Bool -> String
foo n b | b = show n
        | otherwise = "blabla"

alwaysN :: Int -> String
alwaysN = bind2nd foo True 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-30T20:37:56.853

它被称为[`flip`](http://www.zvon.org/other/haskell/Outputprelude/flip_f.html)。

例子：

```
Prelude> flip (-) 2 3
1 
```

为了将来参考，只需在[Hoogle](http://haskell.org/hoogle/)中搜索您问题中的类型签名即可找到它，即[(a -> b -> c) -> b -> a -> c](http://www.haskell.org/hoogle/?hoogle=(a+-%3E+b+-%3E+c)+-%3E+b+-%3E+a+-%3E+c)。:-)

# c# - 我是否需要在非托管代码中删除通过 Marshal.PtrToStructure 封送的结构？

> ID：497133
> 
> 赞同：13
> 
> 时间：2009-01-30T20:31:29.707
> 
> 标签：c#, .net, interop, marshalling

我有这个 C++ 代码：

```
extern "C" __declspec(dllexport) VOID AllocateFoo(MY_DATA_STRUCTURE** foo)
{
    *foo = new MY_DATA_STRUCTURE;

    //do stuff to foo
} 
```

然后在 C# 中我这样调用函数：

```
[DllImport("MyDll.dll")]
static extern void AllocateFoo(out IntPtr pMyDataStruct);

...

MyDataStructure GetMyDataStructure()
{
    IntPtr pData;
    ManagedAllocateFooDelegate(out pData);

    MyDataStructure foo = (MyDataStructure)Marshal.PtrToStructure(pData, typeof(MyDataStructure));
    return foo;
} 
```

其中 MyDataStructure 是一个结构（不是类），它对应于 MY_DATA_STRUCTURE 并且成员被适当地编组。

所以问题：当 MyDataStructure 被 GC 时，我是否需要存储 pData 然后在非托管代码中再次释放它？MSDN 对 Marshal.PtrToStructure(IntPtr, Type) 说：“将数据从非托管内存块编组到新分配的指定类型的托管对象。” 在那句话中，“Marshall”是指“复制”吗？在这种情况下，我需要保留 (IntPtr pData)，然后将其传递给非托管代码（在 MyDataStructure 析构函数中），以便我可以执行 C++“删除”？

我已经搜索过，但找不到足够明确的答案。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-30T21:19:00.203

正如埃里克所说，元帅确实意味着复制，但我认为他没有回答您问题的主要观点。

您是否需要保留 pData 本机指针，直到 MyDataStructure 被 GCed？不。

编组后，您的 MyDataStructure 实例 foo 包含 pData 指向的结构的副本。您不再需要保留 pData。为了避免内存泄漏，您必须将该 pData 传递给另一个将删除它的非托管函数，并且可以在封送处理之后立即完成，无论您持有 MyDataStructure 实例多长时间。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-30T20:53:00.177

是的，在这种情况下，Marshall 表示复制；因此，您需要在非托管代码中释放内存。对 PtrToStructure 的所有调用都是从 pData 指向的内存位置读取由目标结构“MyDataStructure”的大小指示的字节数。

当然，细节完全取决于“MyDataStructure”的样子（您是否在 MyDataStructure 中使用任何 FieldOffset 或 StructLayout 属性） - 但最终结果是 PtrToStructure 的返回是数据的副本。

正如[GBegen在](https://stackoverflow.com/users/10223/gbegen)[他的回答](https://stackoverflow.com/questions/497133/do-i-need-to-delete-structures-marshaled-via-marshal-ptrtostructure-in-unmanaged/497293#497293)中指出的那样，我没有回答你问题的主要观点。是的，您需要在非托管代码中删除结构的非托管副本，但不，您不需要保留 pData - 一旦对 PtrToStructure 的调用完成，您就可以删除非托管副本。

PS：我已经编辑了我的帖子以包含此信息，以便将答案合并到一个帖子中 - 如果有人支持这个答案，请支持 GBegen 的回答以及他的贡献。

# asp.net - .net开发动态创建的控件需要自己的方法

> ID：497139
> 
> 赞同：0
> 
> 时间：2009-01-30T20:33:34.617
> 
> 标签：asp.net, javascript, code-behind, server-side

我敢肯定，几乎每个在 .net 中编程的人都遇到过与动态创建按钮类似的问题。

示例场景..

我有一个gridview，并且在其中一个gridview 字段中我有一个按钮。通常在 .net 中使用 Visual Studio，您可以轻松获取按钮的单击事件，但是由于这些按钮是动态创建的，因此它们并不容易获取。我很好奇获取按钮点击事件的最佳方法是什么。

我理解它可以使用 dopostback；但是，我不确定如何实现它，也没有尝试过，因为我也读过 dopostback 方法不是一个很好用的方法。这是为什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-30T20:37:42.813

在 gridview 中，有一个名为[RowDatabound](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.rowdatabound.aspx)的事件。在上面放置一个事件处理程序：

> ```
> gv.RowDataBound += new EventHandler(rowBound); 
> ```

现在在该函数中，您将使用 FindControl 来定位按钮并添加一个处理程序：

> ```
> function rowbound(Object sender, GridViewRowEventArgs e)
> {
>   if(e.Row.RowType == DataControlRowType.DataRow)
>   {
>       var b = e.Row.FindControl("btn") as Button;
>       b.Click += new EventHandler(handleBtnClick);
>   }
> } 
> ```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-30T20:38:16.260

在 Gridview 的 ItemCreated 事件期间，使用 FindControl 获取对按钮的引用并将事件处理程序附加到那里。IE。btn.Click += Somehandler;

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-04T15:50:26.463

可悲的是，答案比我想象的要简单得多。

我没有意识到 ItemCommand 事件可用于在 TemplateField 中创建的按钮。

我真正要做的就是..

```
Private Sub GridView1_ItemCommand(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.DetailsViewCommandEventArgs) Handles DetailsView1.ItemCommand
    If e.CommandName = "myButton" Then
        //'myButton press event logic here
    End If
End Sub 
```

谢谢你们的帮助。我真的很感激。我敢肯定，您的回答将来会对您有所帮助。

# linux - 在 FreeBSD/Linux 下监控哪个进程修改了文件

> ID：497146
> 
> 赞同：2
> 
> 时间：2009-01-30T20:34:41.540
> 
> 标签：linux, freebsd, system

有时，我感兴趣的文件会被某个进程修改。我需要找出哪个进程正在修改这个文件。使用 lsof 将不起作用，kqueue 也不起作用。这在 FreeBSD 和 Linux 下可行吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-30T20:48:07.707

在 Linux 上，有一个用于[inotify](http://en.wikipedia.org/wiki/Inotify)的内核补丁。但是，有些人说这很少有用，并且可能存在安全风险。无论如何，这是[补丁](http://lwn.net/Articles/307536/)。

除此之外，我不确定是否有任何方法可以使用*inotify*或*dnotify*获取 PID 。您可以进一步调查（例如搜索*pid dnotify*或*pid inotify*），但我认为这不太可能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T12:14:17.757

在 FreeBSD 上，最好[检查一下它的审计功能](http://www.freebsd.org/doc/en/books/handbook/audit-config.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-05-24T12:25:35.030

Linux 有一个审计守护进程[http://www.cyberciti.biz/tips/linux-audit-files-to-see-who-made-changes-to-a-file.html](http://www.cyberciti.biz/tips/linux-audit-files-to-see-who-made-changes-to-a-file.html)

另请参阅[auditd 主页](http://people.redhat.com/sgrubb/audit/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T11:47:29.357

您可以通过安装和使用 lsof (List Open Files) 命令查看哪些进程打开了文件。

# security - 密码的陷阱

> ID：497156
> 
> 赞同：4
> 
> 时间：2009-01-30T20:36:47.887
> 
> 标签：security, cryptography, prng

我正在修改现有的安全代码。规范很清楚，有示例代码，但我不是密码专家。事实上，示例代码有一个免责声明，实际上是“不要逐字使用此代码”。

在审核我要修改的代码（据说功能完整）时，我遇到了这个用于生成挑战的小宝石：

```
static uint16 randomSeed;

...

uint16 GetRandomValue(void)
{
  return randomSeed++;/* This is not a good example of very random generation :o) */
} 
```

当然，我立即做的第一件事就是把它传遍办公室，这样我们都可以大笑。

生成此代码的程序员知道这不是一个好的算法（如评论所示），但我认为他们不理解安全隐患。他们甚至懒得在主循环中调用它，所以它至少会变成一个自由运行的计数器——仍然不理想，但世界不止于此。

但是，我知道我生成的代码同样会导致真正的安全专家发笑或发抖。

*   我需要了解的最常见的密码学安全问题是什么？
*   有哪些好的资源可以让我了解除了常见错误之外我应该知道的内容？

-亚当

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-30T20:51:48.543

不要尝试自己动手——尽可能使用标准库。对安全代码的细微更改可能会产生不易发现的巨大影响，但可能会打开安全漏洞。例如，对一个库的[两条修改行](http://www.technologyreview.com/computing/20801/?a=f)打开了一个在很长一段时间内并不明显的漏洞。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-30T20:55:48.503

[应用密码学](http://www.schneier.com/book-applied.html)是一本很好的书，可以帮助你理解密码和代码。它涵盖了许多基础知识，例如分组密码的工作原理，以及为什么即使您使用的是完美实现的 AES 版本，选择较差的密码模式也会使您的代码毫无用处。

需要注意的一些事项：

*   [随机性的不良来源](http://www.metasploit.com/users/hdm/tools/debian-openssl/)
*   试图设计自己的算法或协议——永远不要这样做。
*   没有得到它的代码审查。最好通过在线发布。
*   不使用完善的库并尝试自己编写。
*   加密作为万能药 - 加密数据不会神奇地使其安全
*   密钥管理。如今，通过侧信道攻击窃取密钥通常比攻击加密货币更容易。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-30T20:51:37.887

您的问题显示了一个更常见的问题：随机性来源不佳。如果它们的位不够随机，则使用 256 位密钥也没关系。

第二个可能是假设你可以设计一个比专家更好的系统。这是一个标准的高质量实施几乎肯定会比创新更好的领域。请记住，在 SSL 真正安全之前需要 3 个主要版本。我们认为。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-30T21:37:43.707

恕我直言，您应该注意四个级别的攻击：

1.  社会工程学攻击。您应该训练您的用户不要做愚蠢的事情，并编写您的软件，使用户很难做愚蠢的事情。我不知道有什么好的参考资料。

2.  不要执行任意代码（缓冲区溢出、xss 漏洞利用、sql 注入都在这里分组）。为了了解这一点，要做的最少的事情是阅读 MS 某人的“编写安全代码”并观看“如何破解 Web 软件”谷歌技术讲座。这也应该教会你一些关于深度防御的知识。

3.  逻辑攻击。如果您的代码正在操作纯文本、证书、签名、密文、公钥或任何其他加密对象，您应该意识到以不良方式处理它们可能会导致坏事。您应该注意的最少的事情包括离线和在线字典攻击、重放攻击、中间人攻击。了解这一点的起点是[http://www.soe.ucsc.edu/~abadi/Papers/gep-ieee.ps](http://www.soe.ucsc.edu/~abadi/Papers/gep-ieee.ps)

4.  密码攻击。加密漏洞包括：

    *   您可以避免的事情：错误的随机数生成、使用损坏的散列函数、安全原语的损坏实现（例如，工程师在代码中的某处忘记了 -1，这使得加密函数可逆）
    *   除非尽可能保持最新，否则您无法避免的事情：针对散列函数或加密函数的新攻击（参见最近的 MD5 谈话），新的攻击技术（参见最近对通过网络发送加密语音的协议的攻击）网络）

一般来说，一个很好的参考应该是应用密码学。

此外，我非常担心移动设备上可能已锁定且难以更新的内容是由询问stackoverflow安全性的人编写的。我相信您的案例是少数需要外部（优秀）顾问帮助您正确获取细节的案例之一。即使您聘请了我建议您这样做的安全顾问，也请阅读上述（简约的）参考资料。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-30T20:54:52.140

> 我需要了解的最常见的密码学安全问题是什么？

容易 - 你（1）不够聪明，无法提出自己的算法。

(1) 你，我的意思是你，我和其他阅读这个网站的人......除了可能是[Alan Kay](https://stackoverflow.com/users/48710/alan-kay)和[Jon Skeet](https://stackoverflow.com/users/22656/jon-skeet)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-30T20:57:00.450

我也不是加密专家，但 S-box 被弄乱时可能会很麻烦（而且它们确实会有所作为）。您还需要一个真正的熵源，而不仅仅是一个 PRNG（无论它看起来多么随机）。PRNG 没用。接下来，您应该确保熵源不是确定性的并且不能被篡改。

我的谦虚建议是：坚持使用已知的加密算法，除非你是专家并且了解风险。使用一些经过测试的、公开可用的开源/公共域代码可能会更好。

# c - 如何从 dll 访问调用应用程序中的变量？

> ID：497163
> 
> 赞同：0
> 
> 时间：2009-01-30T20:38:10.037
> 
> 标签：c, winapi

我正在尝试一个小概念测试来更改罗技 MS3200 键盘的一项功能（缩放功能）。我有从缩放控件发送的键。所以，我有一个主应用程序和一个包含挂钩过程的 dll。

这是主应用程序：

```
#include <stdio.h>
#include <windows.h>

HANDLE hHook;

int main()
{
    HINSTANCE hMod = GetModuleHandle(NULL);

    hHook = SetWindowsHookEx(WH_KEYBOARD, HookProc,0,0);

    if(hHook == NULL)
        printf("Unable to set hook! Error: %d", GetLastError());
    else
        printf("Hook set successfully!");

    while(TRUE)
    {
        Sleep(1000);
    }

    return 0;
} 
```

这是钩子程序dll：

```
#include <windows.h>

int __declspec (dllexport) HookProc(int nCode, WPARAM wParam, LPARAM lParam)
{
    if(nCode < 0)
    {
        return CallNextHookEx(hHook, nCode, wParam, lParam);
    }

    if(wParam == VK_ADD || wParam == VK_SUBTRACT)
    {
        short status = GetKeyState(VK_CONTROL);

        if(status == 1)
        {
            if(wParam == VK_ADD)
                wParam = VK_UP;
            else
                wParam = VK_DOWN;
        }
    }

    return CallNextHookEx(hHook, nCode, wParam, lParam);
}

int WINAPI dllmain(HINSTANCE hMod, DWORD data, LPVOID lpVOid)
{
  return 0;
} 
```

我需要能够从 dll 访问 SetWindowsHookEx (hHook) 返回的内容，以便调用 CallNextHookEx()。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-30T20:44:22.957

这可能是可能的，但不值得你花时间去调查。

相反，将挂钩设置代码移动到 DLL。

哦，我认为您需要将 DLL 模块句柄传递给钩子设置函数，而不是 NULL

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T20:44:08.790

处理此问题的一种可能方法是在 DLL 中使用另一个导出函数来传递 hHook，并将其保存在 DLL 中的本地变量中以在 HookProc 中使用。

```
 HANDLE dllHook;
void __declspec (dllexport) HookHandle(HANDLE hHook)
{
  dllHook = hHook;
}

int __declspec (dllexport) HookProc(int nCode, WPARAM wParam, LPARAM lParam)
{
    if(nCode < 0 && dllHook!= NULL)
    {
        return CallNextHookEx(dllHook, nCode, wParam, lParam);
    }
    //....
}

int WINAPI dllmain(HINSTANCE hMod, DWORD data, LPVOID lpVOid)
{
  dllHook = NULL; //initialize
  return 0;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T20:43:01.743

DLL 中的代码不能直接访问调用应用程序中的变量，因为无法保证加载 DLL 的应用程序会定义这些变量，即使这样做了，DLL 也无法知道它的存储位置.

您可以在 DLL 中有一个全局变量和一个额外的设置它的入口点，在调用 SetWindowsHookEx 后调用它。DLL 需要等到调用 CallNextHookEx 之前调用此入口点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-21T14:31:16.597

在 NT/XP/2003 等上，CallNextHookEx 的第一个参数被忽略。请参阅 CallNextHookEx 的文档：

[http://msdn.microsoft.com/en-us/library/ms644974%28VS.85%29.aspx](http://msdn.microsoft.com/en-us/library/ms644974%28VS.85%29.aspx)

hth

# delphi - 多多自动登录

> ID：497169
> 
> 赞同：1
> 
> 时间：2009-01-30T20:41:47.127
> 
> 标签：delphi

我试图从 ADO 连接字符串中将用户名设置为空白，但是在运行应用程序登录对话框时总是显示？空白密码被选中，

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-30T20:44:10.990

确保 LoginPrompt 属性设置为 False。

# vb.net - 在 VB.Net 中将枚举转换为底层类型的字符串（Option Strict On）

> ID：497171
> 
> 赞同：2
> 
> 时间：2009-01-30T20:42:57.827
> 
> 标签：vb.net, enums, option-strict

我想获得枚举的基础类型的字符串表示形式。

```
 Dim target As System.ConsoleColor = ConsoleColor.Cyan
    Dim actual = 'What goes here?
    Dim expected = "11" 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-30T20:46:52.500

在 C# 术语中；你可以假设int：

```
int val = (int) target;
string valString = val.ToString(); 
```

或者如果你不想要这个假设：

```
object val = Convert.ChangeType(target,
    Enum.GetUnderlyingType(typeof(ConsoleColor)));
string valString = val.ToString(); 
```

# java - java中实现runnable的类可以有run()以外的方法吗？

> ID：497176
> 
> 赞同：2
> 
> 时间：2009-01-30T20:43:57.403
> 
> 标签：java, multithreading

我正在尝试实现一个像这样的简单类：

```
public static void main(String args[])
{
    try
    {
        myClass test = new Thread(new myClass(stuff));
        test.start();
        test.join();
    }
    catch (Throwable t) { }
} 
```

当我尝试在 myClass 中包含 print() 方法并使用它时，我在类 java.lang.Thread 中得到“找不到符号”。我真的不必把它变成一个线程，但我想，只是为了测试它。如果我想让我的 print() 方法工作，我是否必须更改它？

编辑：对不起，我刚刚意识到我可以在 run() 函数中调用 print() 大声笑。为什么我不能在外面打电话呢？这对我来说没有意义。如果我添加同步或其他东西，我可以在运行/类之外调用该函数吗？

EDIT2：对不起，我在这里写错了名字。

EDIT3：我目前正在这样做：

```
Thread test = new Thread(new myClass(stuff));
teste.start();
teste.join(); 
```

如果我使用 new Runner，似乎我不能使用 start() 和 join()。有没有办法解决这个问题？

EDIT4：好的，让我们再试一次：我有myEnvironment，这是一个类，我有myAgent，这是另一个类。myAgent 是线程。myAgent 需要一个 myEnvironment，所以我将它作为参数传递给构造函数。但是，我无法通过扩展 Thread 来做到这一点，因为没有找到构造函数 (myEnvironment)。我必须通过另一个函数设置 myEnvironment 还是可以使用构造函数传递它？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-30T20:48:41.623

你可以实现任何你想要的方法。但是，您需要确保引用使用您的类名，而不是 Runnable：

```
public class MyRunner implements Runnable
{
    @Override public void run();
    public void somethingElse();
}

Runnable r = new MyRunner();
r.somethingElse(); // won't work, this method not defined by Runnable.

MyRunner m = new MyRunner();
m.somethingElse(); // success! 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-30T21:12:34.710

您必须记住您在这里使用的不同类/接口：

*   线
*   可运行
*   Runnable 或 Thread 的子类

如果变量的声明类型具有该方法，则只能调用该变量的方法。并且 Runnable 对象不是线程；它们只是线程可以运行的代码。

例子：

```
class MyRunnable implements Runnable() {
  public void run() { /* do run stuff */ }
  public void print() { /* do print stuff */ }
}

class MyThread extends Thread() {
  public void run() { /* do run stuff */ }
  public void print() { /* do print stuff */ }
}

Thread t = new Thread(new MyRunnable());
t.start();
t.print(); // error, t is a Thread not a MyRunnable and not a MyThread
t.join();

MyRunnable mr = new MyRunnable();
mr.run(); // doesn't run in its own thread
mr.print(); // this is ok

Runnable r = new MyRunnable();
r.run(); // doesn't run in its own thread
r.print(); // error, r is defined as Runnable which has no print() method

MyThread mt = new MyThread();
mt.start();
mt.print(); // this is ok because mt is a MyThread
mt.join(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-30T20:46:28.553

您可以有其他方法。

您的问题似乎是变量的命名！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T20:47:38.567

对你的问题的回答是肯定的，他们可以。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T20:49:57.937

您能否提供实际调用 print() 的代码并指出定义 print() 的范围？否则我们只需要猜测你的代码是什么样的。您的问题不太可能与线程有关。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-30T20:56:04.430

我认为您在示例中的代码是错误的。如果 myClass 不扩展 Thread，则此行不应编译：

```
myClass test = new Thread(new myClass(stuff)); 
```

它可能是这样的，这会给你带来错误，因为 Thread 没有 print() 方法：

```
Thread test = new Thread(new myClass(stuff)); 
```

相反，请执行以下操作：

```
public static void main(String args[])
{
    try
    {
        myClass foo = new myClass(stuff);
        myClass test = new Thread(foo);
        test.start();
        test.join();
        foo.print();
    }
    catch (Throwable t) { }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-09T13:36:16.347

我遇到了类似的问题，不是真正的问题，而是一些误解。

在我之前处理我的代码的人创建了一些方法并将 Runnable 作为参数传递，更有可能：

```
void myMethod(Runnable runnable){
runnable.run();
} 
```

然后从 main 中调用 myMethod 如下所示：

```
public static void main(String args[])
{
    try
    {
        myMethod(new Runnable(){
                      public void run() {
                          //do something...;
                }});
    }
    catch (Throwable t) { }
} 
```

因此，要为 myMethod 提供参数，我需要实例化实现 Runnable 的（在本例中为匿名）类的对象。

我的问题是：在这个例子中是否有必要使用 Runnable ？我可以使用任何不同的界面吗？我的意思是我可以用单一方法创建新接口，即

```
interface MyInterface{ 
void doThis();
}

then change look of myMethod:
void myMethod(MyInterface myObject){
myObject.doThis();
} 
```

当然还有客户：

```
public static void main(String args[])
{
    try
    {
        myMethod(new MyInterface (){
                      public void doThis() {
                          //do something...;
                }});
    }
    catch (Throwable t) { }
} 
```

或者也许是关于 Runnable 的东西？！

# c++ - 如何获得在当前 RB 文件中运行的 Ruby 类的实例？（在 C++ 中嵌入 Ruby）

> ID：497179
> 
> 赞同：1
> 
> 时间：2009-01-30T20:44:22.597
> 
> 标签：c++, ruby

我在我的 C++ 应用程序中嵌入了 Ruby。我已经使用 SWIG 生成了绑定。

基本上，我运行 ruby​​ 文件，然后 Ruby 接管并调用我的 C++ 类。

根据我之前的问题，我想将 ruby​​ 文件中定义的类的当前实例返回到 C++ 类，以便我可以执行实例方法。

我按如下方式执行 ruby​​ 文件：

```
rb_eval_string_protect(<ruby script string>, &status );

rb_funcall(Qnil, rb_intern("main"), 0); 
```

脚本中的全局 main 方法在文件中创建已定义类的实例。这就是我所追求的实例。

如果必须，我将添加一个参数或另一个函数以将实例传回，但是，我不确定如何在 C++ 中定义它，以便当 SWIG 生成绑定时，一切正常。

任何帮助，将不胜感激。

上一个问题：[从 C++ 调用 Ruby 类方法](https://stackoverflow.com/questions/496304/calling-ruby-class-methods-from-c "从 C++ 调用 Ruby 类方法")

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T01:59:11.917

ruby 的 C api 尽最大努力保留 ruby​​ 的功能特性，因此`rb_eval_string_protect()`返回给定脚本的最后一行的`rb_funcall()`VALUE，并返回所调用方法的最后一行的 VALUE。

所以诀窍真的是把它想象成你如何在纯红宝石中获得那个实例值？如果只是main的返回值，比如

```
# I'm a ruby script!
main_retval = main() 
```

然后在 C 中捕获返回值是类似的：

```
// I'm some C (or C++) code
VALUE main_retval;
// ...
rb_eval_string_protect("...", &status);
main_retval = rb_funcall(Qnil, rb_intern("main"), 0); 
```

并且会给你一个对返回的 ruby​​ 对象的引用`main`。

您可以正常使用此对象，调用方法等

```
VALUE main_retval_as_string = rb_funcall(main_retval, rb_intern("to_s"), 0); 
```

# command-line - 是否可以通过命令行使用“IDE 托管组件”编译项目？

> ID：497192
> 
> 赞同：0
> 
> 时间：2009-01-30T20:48:04.027
> 
> 标签：command-line, c++builder

一段时间以来，我一直在尝试在 BCB5 中构建一些大型项目。我想使用命令行工具，因为它可以将构建时间缩短 50% 以上（在 IDE 中已经需要 4 个小时）。通常，项目在 IDE 中构建得很好，但在命令行中却惨遭失败。我做了一些挖掘并在头文件中发现了这个不错的小注释：

```
__published:    // IDE-managed Components 
```

这是说后面的组件只能在IDE打开的情况下构建吗？请告诉我有办法解决这个问题。BCB5开始让我沮丧。

额外信息：

Make.exe 给出了一堆错误，声称头文件和导入的文件之间存在歧义。我很确定头文件应该引用导入的文件，而不是与之比较。

在头文件中：

```
#include <ComCtrls.hpp> 
```

ComCtrls.hpp 具有变量 TTreeNode。

来自make的错误：

```
[exec] Error E2015 .\TMain.h 876: Ambiguity between 'TTreeNode' and 'Comctrls::TTreeNode' 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T23:04:09.010

> __published: // IDE 管理的组件 这是说后面的组件只能在 IDE 打开的情况下构建吗？请告诉我有办法解决这个问题。BCB5开始让我沮丧。

不，这并不意味着您只能在 IDE 中构建源代码。这只是意味着此部分由 IDE（表单设计器）自动填充

虽然有很好的第三方解决方案（正如其他人所提到的），但 C++Builder 2007 及更高版本在构建系统中做出了巨大的改进。IDE 构建时间与命令行构建非常相似，并且 MSBuild 集成现在可以确保将相同的参数传递给 IDE 使用的命令行工具。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-31T19:19:21.693

您是否尝试过安装 Andreas Hausladen 的[C++ Compiler Enhancements](http://andy.jgknet.de/blog/?page_id=12)插件，它可以提高编译速度。我还建议安装[DelphiSpeedUp](http://andy.jgknet.de/blog/?page_id=8)插件。

我认为您需要将项目导出为 makefile，以便从命令行编译，因为 C++Builder 5 项目文件是 XML。看看[这篇](http://bcbjournal.org/articles/vol4/0008/Command_line_builds_with_make.htm)来自 C++Builder Developer's Journal 的文章。

如果以上都没有失败，请尝试[官方 C++Builder 论坛](https://forums.codegear.com/category.jspa?categoryID=8)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T20:26:05.577

我或多或少地放弃了 BCB5 命令行工具。看来它们从根本上被破坏了。

然而，我确实设法找到了一个很好的开源工具 ProjectMaker，它可以有效地使用命令行工具。你可以在这里找到它：[http](http://projectmaker.jomitech.com/) ://projectmaker.jomitech.com 。

ProjectMaker 修复了 BPR2MAK 的一些问题，但并不完美。大多数项目都使用 ProjectMaker 完美构建，有些仍然需要 IDE。这不是一个完美的解决方案，但它没问题。

# php - PHP If else 语句表明数据库记录为空，它将显示默认图片

> ID：497194
> 
> 赞同：1
> 
> 时间：2009-01-30T20:48:23.917
> 
> 标签：php, mysql, if-statement

嗨，基本上我正在尝试创建一个简单的 IF 语句，如果尚未将图片输入到我的数据库中，则该语句会显示默认图片。我正在使用服务器来存储我的图片和一个数据库来存储文件名，所以如果它在数据库中有一个文件名，我可以让图像显示，但我希望 If 语句说如果记录为空，则显示此默认值图片。我在这里有一些我尝试过的代码但是它没有任何想法？我尝试了其他一些方法，但它们也没有奏效。

干杯。

到目前为止的代码：

```
//Retrieves data from MySQL
$data = mysql_query("SELECT * FROM db*****") or die(mysql_error());

//Puts it into an array
while($info = mysql_fetch_array( $data ))
{
?>

        <div class="member">
        <div class="imageSection">
       <? 

        if($info['photo'] == '')
         {echo "<img class=\"memberImage\" src=images/default.jpg>";}
          else {echo "<img class=\"memberImage\" src=images/".$info['photo'] .">";}
         ?>
        </div>  
        <div class="memberInfo">
<? Echo "<p><strong>Name: ".$info['nameMember'] . "</strong></p>";
Echo "<p>Position: ".$info['bandMember'] . " </p>";
Echo "<p>About Band Member ".$info['nameMember'] .":".$info['aboutMember'] . "</p>";
Echo "<p>Other Bands: ".$info['otherBands'] . " </p><br/></div></div><br class=\"clearBoth\"/>";

}
?> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-30T20:57:26.707

那么简单的[三元](http://php.net/language.operators.comparison)呢：

```
$photo = ($info['photo'] == null) ? "default.jpg" : $info['photo'];
echo "<img class=\"memberImage\" src=images/". $photo .">"; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T20:57:48.233

您确定该列的默认值设置为“”。它可以设置为空吗？虽然 idk 如果那会导致它不起作用。

在 if 语句之前添加以下代码

```
echo $info['photo']; 
```

另一个建议是在比较之前修剪数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-30T21:04:09.250

您可以使用[file_exists](http://php.net/function.file-exists)，即使手动删除图像也可以使用。

```
$photo = 'images/'. $info['photo'];
if (file_exists($photo) == FALSE)
{
  $photo = 'images/default.jpg';
} 
echo '<img class="memberImage" src="'. $photo .'"/>'; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T21:04:18.657

[empty()](http://php.net/empty)可以捕捉到你所追求的那种条件，所以试试

```
 if(empty($info['photo']))
 {
     ....
 } 
```

如果参数为 ''、NULL、false、'0'、0 或空数组，则 empty() 返回 true。

# xml - 弹性树节点命名问题

> ID：497196
> 
> 赞同：0
> 
> 时间：2009-01-30T20:49:37.003
> 
> 标签：xml, apache-flex, actionscript, tree

我有一个从 XML 文档构建到 XMLlist 的 flex 树

在 XML 中，标签都是不同的，每个标签都有一堆属性，并且不一致。

当我发布文件时，我希望树中文件夹的名称成为标签。使用属性很容易......“@id”或类似的东西，但我找不到使用标签本身可能是什么。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-31T19:22:35.930

您必须使用自定义标签功能来做到这一点。这是一个例子。希望这可以帮助。

```
<?xml version="1.0" encoding="utf-8"?>
<WindowedApplication xmlns="http://ns.adobe.com/mxml/2009">

  <Script>
    <![CDATA[
      [Bindable]
      public var xml:XML = <node1><node2a><node3><node4/></node3></node2a><node2b/></node1>;

      public function myLabelFunction(item:Object):String {
        var node:XML = XML(item);
        var nodeName:QName = node.name();
        return nodeName.localName;
      }
    ]]>
  </Script>

  <Tree width="100%" dataProvider="{xml}" labelFunction="myLabelFunction"/>

</WindowedApplication> 
```

# c# - 如何在代码中使用 wsDualHttpBinding 设置 WCF 客户端？

> ID：497209
> 
> 赞同：8
> 
> 时间：2009-01-30T20:56:12.933
> 
> 标签：c#, wcf, app-config

我需要连接到我编写的 WCF 服务，而无需为我正在编写的客户端应用程序部署 app.config。但是，我一直很难弄清楚如何在代码中从客户端进行设置。这是据我所知......有没有人知道我需要做什么才能让它工作？我真的很感激。

这是我到目前为止的代码：

```
 String baseAddress = "http://localhost/CommService";

    WSDualHttpBinding binding = new WSDualHttpBinding();
    binding.Name = "WSDualHttpBinding_ICommService";
    binding.ClientBaseAddress = new Uri(baseAddress);
    binding.ReliableSession.Ordered = true;
    binding.ReliableSession.InactivityTimeout = new TimeSpan(0, 10, 0);
    binding.ReceiveTimeout = new TimeSpan(0, 10, 0);
    binding.SendTimeout = new TimeSpan(0, 0, 5);

    InstanceContext context = new InstanceContext(this);
    client = new CommServiceClient(context, "WSDualHttpBinding_ICommService");
    client.Endpoint.Binding = binding; 
```

这是我的客户端应用程序的 app.config：

```
<system.serviceModel>
    <bindings>
        <wsDualHttpBinding>
            <binding name="WSDualHttpBinding_ICommService" closeTimeout="00:01:00"
                openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:00:05"
                bypassProxyOnLocal="false" transactionFlow="false" hostNameComparisonMode="StrongWildcard"
                maxBufferPoolSize="524288" maxReceivedMessageSize="65536"
                messageEncoding="Text" textEncoding="utf-8" useDefaultWebProxy="true">
                <readerQuotas maxDepth="32" maxStringContentLength="8192" maxArrayLength="16384"
                    maxBytesPerRead="4096" maxNameTableCharCount="16384" />
                <reliableSession ordered="true" inactivityTimeout="00:10:00" />
                <security mode="Message">
                    <message clientCredentialType="Windows" negotiateServiceCredential="true"
                        algorithmSuite="Default" />
                </security>
            </binding>
        </wsDualHttpBinding>
    </bindings>
    <client>
        <endpoint address="http://localhost/CommService/"
            binding="wsDualHttpBinding" bindingConfiguration="WSDualHttpBinding_ICommService"
            contract="Services.ICommService" name="WSDualHttpBinding_ICommService">
            <identity>
                <dns value="localhost" />
            </identity>
        </endpoint>
    </client>
</system.serviceModel> 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-30T22:39:13.613

您可以轻松实现您想要的。请参阅下面的代码：

```
 Uri baseAddress = new Uri("http://localhost/CommService");
 WSDualHttpBinding wsd = new WSDualHttpBinding();
 EndpointAddress ea = new EndpointAddress(baseAddress, EndpointIdentity.CreateDnsIdentity("localhost"));
 client  = new CommServiceClient(new InstanceContext(this), wsd, ea); 
```

让我解释一下：

*   首先，我们使用默认设置创建一个 WSDualHttpBinding 实例（这些正是生成的 app.config 所具有的那些）。如果要修改任何设置，可以通过公开的属性进行修改。
*   然后我们创建一个带有所需 URL 和身份的 EndPointAddress。无需将其与绑定链接，因为我们将在 Service Client 构造函数中链接所有这些。
*   最后我们创建服务客户端。构造函数重载之一允许我们指定绑定和端点地址。
*   通常，app.config 文件中可用的每个元素在 .NET 代码中都有一个关联的类，并且每个属性或子元素在指定的类中都有一个关联的属性。

# asp.net - 需要向 3rd 方提供访问我的网站的 REST URL 建议

> ID：497210
> 
> 赞同：2
> 
> 时间：2009-01-30T20:56:42.527
> 
> 标签：asp.net, asp.net-mvc, routing, rest

**重要提示：这个问题实际上并不是一个真正的 ASP.NET 问题。**任何对 URLS 有所了解的人都可以回答。我只是碰巧使用了 ASP.NET 路由，所以包含了这个细节。

简而言之，我的问题是：

“我应该设计什么样的 URL 格式，我可以将其提供给外部各方，以到达我网站上的特定位置，这将是未来的证明。[我是创建这些 'REST' URL 的新手]。”

* * *

我需要一个 ASP.NET 路由 URL，该 URL 将提供给第三方以跟踪营销活动。它本质上是一个“网关” URL，将用户重定向到我们网站上的特定页面，该页面可能是主页、特殊竞赛或特定产品。

除了[尝试捕获](https://stackoverflow.com/questions/257609/which-browsers-plugins-block-httpreferer-from-being-sent)[推荐](http://mail-archives.apache.org/mod_mbox/roller-dev/200511.mbox/<4377751C.8040507@busybuddha.org)人之外，我还需要接收一个合作伙伴 ID、一个活动编号和可能的其他参数。我想提供一条路线来做到这一点，但我想第一次把它做好，因为很明显，一旦它被外部使用，我就不能轻易地改变它。

这样的东西看起来怎么样？

```
routes.MapRoute(
   "3rd-party-campaign-route",
   "campaign/{destination}/{partnerid}/{campaignid}/{custom}",
   new
   {
       controller = "Campaign",
       action = "Redirect",
       custom = (string)null // optional so we need to set it null 
   }
); 
```

**活动**：可能不希望在实际链接中出现“活动”一词——因为用户会在 URL 栏中看到它。我可能会将其更改为像“c”这样的神秘事物。

**目的地**：指示链接将把用户带到我们网站上的哪个页面。例如 PR 将用户引导到产品页面。

**partnerid**：我们分配的公司 ID - 例如堆栈溢出的 SO。

**Campaignid**：活动 ID，例如 123 - 每个合作伙伴唯一。我已经意识到，我认为我更希望 3rd 方公司能够自己管理活动 ID，而不是我们提供一个网站来“创建活动”。不过，我还不完全确定这一点。

**custom**：自定义数据（可选）。我可以在不破坏现有 URL 的情况下添加更多自定义数据参数

注意：我有“目的地”的原因是因为活动 ID 是由客户决定的，所以他们还需要告诉我们该活动的目的地在哪里。或者，他们可以向我们“注册”一个活动。这可能是避免人们输入随机广告系列 ID 的更好解决方案，但我并不太担心这一点，我认为这个系统提供了更大的灵活性。

此外，我们可能还想知道他们用来链接到我们的图片（这样我们就可以跟踪哪个横幅效果最好）。我认为这是一个新的活动 ID 的候选人，而不是自定义数据字段，但我不确定。

目前我正在使用一个非常原始的 URL，例如[http://example.com?cid=123](http://example.com?cid=123)。在这种情况下，广告系列 ID 需要发给第三方，这不是一个非常灵活的系统。我想立即转移到新客户的新系统。

对未来验证这个系统有什么想法吗？我可能错过了什么？我知道我总是可以添加新格式，但如果这是个好主意，我想尽可能多地使用这种格式。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-05T14:47:54.730

这个网址：

```
"campaign/{destination}/{partnerid}/{campaignid}/{custom}", 
```

...在我看来不像资源，它看起来像远程方法调用。这里有很多业务逻辑，将来可能会发生变化。此外，它很复杂。在设计 URL 时，我的直觉是越简单通常越好。当您将 URL 交给外部合作伙伴时，这会增加一倍。

统一**资源**定位器应该指定资源。目的地当然是一种资源（稍后会详细介绍），我认为您可以将广告系列视为一种资源。合作伙伴不是您服务的资源。自定义当然不是资源，因为它完全未定义。

我听到你说不想告诉合作伙伴“创建一个活动”，但考虑到你最终可能不得不走这条路。只要广告系列具有合作伙伴标识符以外的任何属性，您就必须这样做。

因此，我首先得出的结论是，您可能应该摆脱合作伙伴 ID，并从广告系列中获取它。如果有必要，也可以摆脱自定义，并使用查询字符串参数。使用查询字符串参数来指定如何返回资源（而不是资源的标识）是合适的。

删除这些产量：

```
"campaign/{destination}/{campaignid}", 
```

好的，这更简单，但它仍然看起来不正确。广告系列和广告系列 ID 之间的目的地在做什么？一种方法是重新排列事物：

```
"campaign/{campaignid}/{destination}", 
```

另一个是使用 Astoria 风格的索引：

```
"campaign({campaignid})/{destination}", 
```

出于某种原因，这对很多人来说看起来很奇怪，但它是完全合法的。随意使用其他合法字符将活动与 ID 分开；这里的重点是 / 不是唯一的选择，也可能不是合适的选择。

**然而...**

我们尚未讨论的一个问题是，如果/当用户提交了一个有效的目的地，但一个无效的广告系列或合作伙伴 ID 时会发生什么。如果正确的响应是用户应该看到错误，那么以上所有内容仍然有效。另一方面，如果正确的响应是无论如何都应该默默地将用户带到目标页面，那么活动 ID 实际上是一个查询字符串参数，而不是资源的一部分。或许有些合作伙伴不希望得到一个带有问号的 URL，但从纯粹的 REST 角度来看，我认为这是正确的方法，如果活动 ID 的有效性不能确定用户最终的位置。在这种情况下，URL 将是：

```
"campaign/{destination}", 
```

...您将添加一个带有广告系列 ID 的查询字符串参数。

我意识到我没有给你一个明确的答案来回答你的问题。问题在于，这大部分取决于您可能知道的商业考虑，但我当然不是。因此，我更多地尝试介绍 REST-ful URL 的理念，而不是尝试向您解释您的业务。:)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-10T04:23:14.770

我认为 URL 重写最近有点失控。并非所有内容都属于 URL。毕竟，URL 应该描述可以搜索、发现或操作的资源，在我看来，至少上面的合作伙伴 ID 和自定义字段不是资源的一部分。

更不用说在某些时候您实际上希望在多个广告系列中保持合作伙伴 ID 不变，这意味着它现在与他们需要访问的特定地点正交。如果您将这些作为参数保留，您将允许您的合作伙伴统一访问您网站上的多个资源，同时仍然可靠地识别自己，因此您可以跟踪他们对您的任何活动的参与。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-31T16:13:24.733

看起来你已经覆盖了所有的基础。我唯一的建议是改变

```
{custom} 
```

到

```
{*custom} 
```

这样，如果您需要接受更多参数，您就不必冒险让旧 URL 得到 404。例如：

如果您的 URL 如下所示：

> 竞选/PR/SO/123

并且您决定将来要接受第四个和第五个参数：

> 竞选/PR/SO/123/blah/foo

那么第一个 URL 仍然有效，因为您在 {*custom} 中使用了通配符。"blah/foo" 将作为字符串传递给您的操作。要获得这两个额外的参数，您只需将操作中的自定义参数用“/”拆分即可。添加一些友好的错误处理，如果它们不存在并且您已经成功地更改了您可以通过活动 URL 接收的信息量，而不会完全破坏已经存在的 URL。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-09T17:39:43.490

为什么不使用 URL 编码变量而不是路由？它们更加灵活——您可以在未来添加任何新功能，同时仍保持 100% 的向后兼容性。诚然，手动打字有点麻烦，但如果反正有所有这些参数，那已经不是野餐了。

```
http://mysite.com/page?campaign=1&dest=products&pid=15&cid=25 
```

对我来说，这更能说明正在发生的事情。使用路径意味着资源存在于该位置。但实际上，您只是提供了一个带有各种参数的 Web 服务，而这个模型更清楚地捕捉到了这一点。将来，您可以毫不费力地添加更多参数。如果它们丢失，您也可以默认参数而不会弄乱任何东西。

不确定 ASP 中的代码，但实现起来应该很简单。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-10T02:44:18.593

我想我会像 SO 那样做问题。

```
"campaign/{campaign-id}/friendly-name-of-campaign" 
```

创建活动时在数据库中创建一个映射，将您需要的所有数据与自动生成的 ID 相关联。友好名称的分配方式基本上与 SO 上的问题相同——由用户——但您也可以有一个批准过程，以确保它满足您的要求并且与任何现有的活动名称不同。您的跟踪公司可以通过 id 进行跟踪，并且您可以通过简单的查找将其与关联数据相关联。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-09T13:31:37.300

您拥有的东西看起来很适合您的需求。这里的其他帖子有很好的观点。但可能不适合你。在将来对链接进行校对时，您可以考虑的一件事是在其中的某处放置一个版本号。

```
"campaign/{version}/{destination}/{partnerid}/{campaignid}/{custom}" 
```

这样，如果您决定完全更改格式，您可以将版本升级到 2.0（或其他），并且仍然跟踪进来的旧链接。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-10T16:15:24.877

我会做

```
/c/{destination}/{partnerid}/{campaignid}/?customvar=s 
```

您应该考虑第一个参数的层次结构，您已经很好地管理了它。仅当存在层次结构路径段时才应使用。

根据您的描述，目的地似乎是最广泛的参数，partnerid 仅适用于目的地，而 campaingid 特定于合作伙伴。

当您确实需要添加自定义参数时，我会选择查询变量（它们在 REST 中不被禁止），因为它们不是层次结构的一部分。

你也不应该在这里尝试太 RESTful。毕竟，它是针对活动和重定向到最终资源的。所以你想在这里设计的 URL 并不是真正的 REST 术语中的特定资源。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-10T18:13:37.933

创建一个名为[http://mysite.com/gateway的 URL](http://mysite.com/gateway)

返回一个 HTML 表单，告诉您的合作伙伴填写表单并发布。根据表单值重定向。

您可以轻松地为您的合作伙伴提供 javascript 来执行 GET 和 POST。应该是微不足道的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-10T20:43:18.510

我学到的关于 REST URL 的最重要的事情通常深藏在一些书或文章中：

URL 应该指向一个资源，并且下面的 ?querystring 应该包含所有需要的范围信息。不要将这两者混为一谈，否则您将拥有一个很难使用的设计。

除此之外，我完全同意 Craig Stuntz

# database - Predicting Oracle Table Growth

> ID：497214
> 
> 赞同：3
> 
> 时间：2009-01-30T20:57:30.357
> 
> 标签：database, oracle

How can I predict the future size / growth of an Oracle table?

Assuming:

*   linear growth of the number of rows
*   known columns of basic datatypes (char, number, and date)
    *   ignore the variability of varchar2
    *   basic understanding of the space required to store them (e.g. [number](http://www.jlcomp.demon.co.uk/faq/num_size.html))
*   basic understanding of [blocks, extents, segments](http://download.oracle.com/docs/cd/B19306_01/server.102/b14220/logical.htm), and [block overhead](http://www.adp-gmbh.ch/ora/concepts/db_block.html)

I'm looking for something more proactive than "measure now, wait, measure again."

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-30T21:18:15.633

1.  Estimate the average row size based on your data types.
2.  Estimate the available space in a block. This will be the block size, minus the block header size, minus the space left over by PCTFREE. For example, if your block header size is 100 bytes, your PCTFREE is 10, and your block size is 8192 bytes, then the free space in a given block is `(8192 - 100) * 0.9 = 7282`.
3.  Estimate how many rows will fit in that space. If your average row size is 1 kB, then roughly 7 rows will fit in an 8 kB block.
4.  Estimate your rate of growth, in rows per time unit. For example, if you anticipate a million rows per year, your table will grow by roughly 1 GB annually given 7 rows per 8 kB block.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T21:17:33.483

I suspect that the estimate will depend 100% on the problem domain. Your proposed method seems as good a general procedure as is possible.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T04:57:31.307

Given your assumptions, "measure, wait, measure again" is perfectly predictive. In 10g+ Oracle even does the "measure, wait, measure again" for you. [http://download.oracle.com/docs/cd/B19306_01/server.102/b14237/statviews_3165.htm#I1023436](http://download.oracle.com/docs/cd/B19306_01/server.102/b14237/statviews_3165.htm#I1023436)

# ruby-on-rails - Is it ok to use different different OSes for production/development servers with Rails?

> ID：497217
> 
> 赞同：1
> 
> 时间：2009-01-30T20:58:02.680
> 
> 标签：ruby-on-rails, deployment, production, mod-rails

Say, I love Debian+mod_rails and run it on my laptop which is my development platform. Yet, I am deploying to a production server running Ubuntu+mod_rails.

Is it better in a long run if I install Ubuntu on my laptop or are the problems with deployment so miniscule I can go with whatever the hell I like on dev. machine?

Thanks.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-30T21:00:14.750

The problems with deployment, *especially* between debian and ubuntu, are so miniscule you can go on without worrying about it.

However, I wouldn't do it myself, because when that miniscule problem occurs, it's **really** hard to find and resolve. At minimum make sure you have a staging setup that is exactly the same as the production server and perform testing on that if you don't or can't make your development machine match.

-Adam

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T21:00:55.187

Deployment is always a hassle with rails, but I wouldn't worry about it. You just set it up once with capistrano and it's pain free from then on. I use windows for dev, and mac or linux on a virtual host for prod.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T21:13:24.380

I think this is true for any programming language, but no you shouldn't have different OS's for DEV/TEST/PROD. 99.9% of the time you won't notice a difference or problems, but that very small percentage 0.1% of the time, you'll be pulling your hair out trying to figure out what is wrong.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T21:16:51.673

You're increasing the likeliness of things going wrong while you transistion between development and production.

Which means that you're just going to get more stressed out.

Which path you choose is really up to you ;)

# excel - excel中的网格线通过互操作

> ID：497220
> 
> 赞同：6
> 
> 时间：2009-01-30T20:59:44.737
> 
> 标签：excel, interop

知道在互操作中使用 excel 2003 时设置隐藏在哪里以关闭网格线吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-30T21:22:12.397

DisplayGridlines 是 Excel Window 对象上的一种方法。例如：

```
ActiveWindow.DisplayGridlines = true 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-09-06T16:14:01.253

```
using Excel = Microsoft.Office.Interop.Excel;
Excel.Application oXL;
oXL.Windows.get_Item(1).DisplayGridlines = false; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-01-13T10:32:28.687

```
oXL.Windows.Application.ActiveWindow.DisplayGridlines = false; 
```

在保存excel代码行之前编写代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-06-09T17:28:11.983

目前，使用`VS2012`，我这样做如下：

```
Excel.Application oXl = new Excel.Application();

oXl.Visible = false; // true for debug

Excel.Workbook wb = oXl.Workbooks.Add();
Excel.Worksheet ws = wb.Worksheets[1];

oXL.ActiveWindow.DisplayGridlines = false; //true is the default in Excel 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-30T21:37:59.463

`ActiveWorkbook.Windows(1).DisplayGridlines = True 'OR False`

# return-value - 是否有任何 Common Lisp 函数返回 3 个值？

> ID：497229
> 
> 赞同：3
> 
> 时间：2009-01-30T21:01:55.417
> 
> 标签：return-value, common-lisp

是否有任何 Common Lisp（内置）函数返回超过 2 个值？我知道很多返回 2，但我想不出一个返回 3。

（我在这里看到一个关于返回超过 2 个值的评论，并试图考虑 CL 这样做但不能这样做的情况。）

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-11T10:42:34.047

是的，存在这样的功能。下面是 COMMON-LISP 包中函数的完整列表，它们正好返回三个值，如 SBCL 源代码中所声明的：

```
COMPILE                                 required: 3, optional: 0, rest?: NIL
INTEGER-DECODE-FLOAT                    required: 3, optional: 0, rest?: NIL
COMPILE-FILE                            required: 3, optional: 0, rest?: NIL
GET-PROPERTIES                          required: 3, optional: 0, rest?: NIL
FUNCTION-LAMBDA-EXPRESSION              required: 3, optional: 0, rest?: NIL
DECODE-FLOAT                            required: 3, optional: 0, rest?: NIL
RENAME-FILE                             required: 3, optional: 0, rest?: NIL 
```

此外，以下函数返回大于三的常数值：

```
DECODE-UNIVERSAL-TIME                   required: 9, optional: 0, rest?: NIL
GET-DECODED-TIME                        required: 9, optional: 0, rest?: NIL 
```

这些函数返回可变数量的值，因此可能超过三个：

```
NO-APPLICABLE-METHOD                    required: 0, optional: 0, rest?: T
NO-NEXT-METHOD                          required: 0, optional: 0, rest?: T
VALUES                                  required: 0, optional: 0, rest?: T

(I've omitted some functions from this list where SBCL does not declare
a values type explicitly.  get-setf-expansion is one of them.) 
```

列说明：`required`是这些函数的最小返回值`optional`数量，SBCL 认为可能返回或可能不返回的返回值的固定数量，`rest?`表示预期的值数量可变。（仅实际使用 &optional `macroexpand`，`macroexpand-1`不要问我为什么。）

只是为了好玩，这里是我用来制作这些表格的源代码：

```
(do-external-symbols (sym :common-lisp)                                         
  (when (fboundp sym)                                                           
    (multiple-value-bind (required optional rest)                               
        (let ((fun-type (sb-int:info :function :type sym)))                     
          (etypecase fun-type                                                   
            (sb-kernel:fun-type                                                 
             (let ((returns                                                     
                    (sb-kernel:fun-type-returns fun-type)))                     
               (etypecase returns                                               
                 (sb-kernel:values-type                                         
                  (values (length (sb-kernel:values-type-required returns))     
                          (length (sb-kernel:values-type-optional returns))     
                          (sb-kernel:values-type-rest returns)))                
                 (sb-kernel:named-type                                          
                  (if (sb-kernel:named-type-name returns)                       
                      (values 1 0 t)                                          
                      (values 0 0 nil))))))                                     
            (t                                                                  
             (values 0 0 t))))                                                  
      (format t                                                                 
              "~A~40Trequired: ~D, optional: ~D, rest?: ~A~%"                   
              sym                                                               
              required optional rest)))) 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-08T08:39:27.593

decode-universal-time 返回九个值。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-30T21:56:00.690

有一个 get-setf-expansion 函数。它返回 5 个值。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-08T05:29:53.140

[VALUES](http://www.lispworks.com/documentation/HyperSpec/Body/f_values.htm#values)和[VALUES-LIST](http://www.lispworks.com/documentation/HyperSpec/Body/f_vals_l.htm#values-list)等等。

# python - Python 的 os.path 被希伯来文件名阻塞

> ID：497233
> 
> 赞同：14
> 
> 时间：2009-01-30T21:03:24.900
> 
> 标签：python, internationalization, hebrew

我正在编写一个必须移动一些文件的脚本，但不幸的是，它似乎不太`os.path`适合国际化。当我有以希伯来语命名的文件时，就会出现问题。这是目录内容的屏幕截图：

[![替代文字](https://i.stack.imgur.com/ypP2Z.png)](https://i.stack.imgur.com/ypP2Z.png)
[（来源：[thegreenplace.net](http://eli.thegreenplace.net/files/temp/hebfilenameshot.png)）]

现在考虑遍历此目录中文件的这段代码：

```
files = os.listdir('test_source')

for f in files:
    pf = os.path.join('test_source', f)
    print pf, os.path.exists(pf) 
```

输出是：

```
test_source\ex True
test_source\joe True
test_source\mie.txt True
test_source\__()'''.txt True
test_source\????.txt False 
```

请注意如何`os.path.exists`认为希伯来文命名的文件甚至不存在？我怎样才能解决这个问题？

Windows XP Home SP2 上的 ActivePython 2.5.2

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-30T21:40:06.730

嗯，经过[一番挖掘](http://www.amk.ca/python/howto/unicode)，似乎在提供 os.listdir 一个 unicode 字符串时，这有点工作：

```
files = os.listdir(u'test_source')

for f in files:

    pf = os.path.join(u'test_source', f)
    print pf.encode('ascii', 'replace'), os.path.exists(pf) 
```

===>

```
test_source\ex True
test_source\joe True
test_source\mie.txt True
test_source\__()'''.txt True
test_source\????.txt True 
```

这里有一些重要的观察：

*   Windows XP（与所有 NT 衍生产品一样）以 unicode存储*所有文件名*
*   `os.listdir`（以及类似的函数，如`os.walk`）应该传递一个 unicode 字符串，以便正确使用 unicode 路径。这是上述链接的引述：

> 返回文件名的 os.listdir() 引发了一个问题：它应该返回文件名的 Unicode 版本，还是应该返回包含编码版本的 8 位字符串？os.listdir() 将同时执行这两种操作，具体取决于您将目录路径提供为 8 位字符串还是 Unicode 字符串。如果您将 Unicode 字符串作为路径传递，文件名将使用文件系统的编码进行解码并返回 Unicode 字符串列表，而传递 8 位路径将返回文件名的 8 位版本。

*   最后，`print`想要一个 ascii 字符串，而不是 unicode，因此必须将路径编码为 ascii。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-30T21:25:24.513

它看起来像一个 Unicode 与 ASCII 问题 -`os.listdir`返回一个 ASCII 字符串列表。

编辑：我在 Python 3.0 和 XP SP2 上都试过了，`os.listdir`只是省略了希伯来文文件名，根本没有列出它们。

根据文档，这意味着它无法解码：

> 请注意，当 os.listdir() 返回字符串列表时，将省略无法正确解码的文件名，而不是引发 UnicodeError。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-30T21:38:37.683

在 OS X 上使用 Python 2.5.1 就像一个魅力：

```
subdir/bar.txt True
subdir/foo.txt True
subdir/עִבְרִית.txt True 
```

也许这意味着这与 Windows XP 有某种关系？

编辑：我还尝试使用 unicode 字符串来更好地模仿 Windows 行为：

```
for f in os.listdir(u'subdir'):
  pf = os.path.join(u'subdir', f)
  print pf, os.path.exists(pf)

subdir/bar.txt True
subdir/foo.txt True
subdir/עִבְרִית.txt True 
```

在终端（os x stock command prompt app）中。使用 IDLE 它仍然有效，但没有正确打印文件名。为了确保它确实是unicode，我检查了：

```
>>>os.listdir(u'listdir')[2]
u'\u05e2\u05b4\u05d1\u05b0\u05e8\u05b4\u05d9\u05ea.txt' 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T22:27:12.577

问号是在无法以特定编码表示 unicode 字符时显示的或多或少的通用符号。您在 Windows 下的终端或交互式会话可能正在使用 ASCII 或 ISO-8859-1 或其他东西。所以实际的字符串是 unicode，但它被翻译成 ???? 打印到终端时。这就是为什么它适用于 PEZ，使用 OSX。

# process-management - 与不合逻辑的经理打交道

> ID：497234
> 
> 赞同：-1
> 
> 时间：2009-01-30T21:03:28.940
> 
> 标签：process-management

在我曾经工作过的地方，他们对任何问题的典型反应都是责怪硬件或用户没有完美地使用系统。我已经接受了这样的理念，即这是我的错，直到我能在这份工作之前证明并非如此（到目前为止，100 次中至少有 99 次是正确的）。

当我有大量数据库超时时，最后一个“无法解决”的问题之一。经过几个月的研究，我仍然只有理论，但无法证明其中的任何一个。我的一位开发人员坚决建议更换网络（每个路由器、交换机、接入点），但无法提供任何证据表明网络是原因；然而，根据我的经理（没有开发/IT经验）的说法，这“显然是原因”所以他接管了这个问题。一个警告和 Fog Creek 插件： **他无法解释这样一个事实，即通过 FogBugz 的错误报告工作完美，并且与其余数据相同的 SQL Server。**

几个月后，没有超时，我的经理吹嘘他已经修复了超时（“看，没有超时！”）。我不得不忍住抓起一块石头说“看，没有老虎！” 但我确实问过他是怎么知道他们会发生的，但我没有得到回应。几个月后，超时确实返回（并且数量更多）。

我对自己处理这种情况的方式非常满意，但我很好奇 SO 人群会如何回应让上级/同事实施您知道（或非常确定）错误的解决方案并且可能会浪费数千美元？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-30T21:08:43.157

让他们，但同时继续寻找真正的原因。

如果能阻止我反对这种想法（这是徒劳的），那么几千美元是值得的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-30T21:07:27.200

好吧，如果问题是高层管理人员，那么我会像你一样做 - 提出你的投诉，然后按照指示进行。如果事实证明他们是对的（这种情况时不时发生），那么尽管你有疑虑，但你看起来还是一个好员工。如果事实证明你是对的，那么他们可能更愿意听你的话，因为你允许他们轮到他们。

这当然是乐观的。

在同事的情况下，将问题提升一个层次，并就如何处理该主题向您的上级咨询。公平对待你和你同事的观点，然后听从你得到的建议。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-30T21:52:29.370

有时最好离开经理。如果你考虑他的压力和责任，他必须被视为在做某事，而不是“什么都不做”。经过足够的时间后，“调查”对于需要超时停止的外部各方来说一无所获。

通过采取行动，他创造了继续研究的机会。诀窍是找到一种方法将您的解决方案放在他的上下文中。这是我们现在可以做的事情，也是我们可以继续做的事情。例如，“我们可以更换网络设备作为预防措施，然后查看版本控制日志以排除这种可能性。”

这给了他一些积极主动的东西，这样他就可以在实现您想要的最终成功的解决方案的同时，在他的链条上看起来很有成效。

In the long term you should look to work for someone who trusts your technical decisions implicitly, you can talk candidly with and who well help you help him navigate the politics in a way you both know what's going on. If you manager isn't that person, move.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T21:07:59.133

这是一个大问题吗？除了您希望您的公司保持偿付能力以便您获得报酬之外，您的工作不是为您的公司节省资金。

如果只是一个经理，他迟早会被淘汰，如果你的整个公司文化都是这样，也许是时候继续前进了。

与此同时，看看你是否能从[你的经理的角度看到这一点。](http://www.randsinrepose.com/archives/2006/06/06/deconstructing_managers_day_1.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-30T21:42:11.967

我认为你是经理的意图是一件好事。我觉得更难的是那些不想打扰的人。最好找到一种方法来利用这种能量来提供帮助。

许多人（有时是我自己）的一个常见问题是，他们在尝试诊断问题时会四处乱窜。如果你疯狂地猜测它，那么现代计算机的特殊性，你只有最渺茫的可能性是正确的。以这种态度来处理这类问题，通常意味着你永远无法解决它。

处理复杂调试的最佳方式是分而治之。在这种情况下，首先想出一个测试，然后他们实施它。该测试是否按预期进行？根据您在哪里进行测试，您离问题越来越近或越来越远。关键是所有的测试都必须产生一些具体的（客观的）行为。如果结果模棱两可，那么测试是没有用的。

如果您在系统的一部分中断开连接，但其他部分没有，那么您拥有大量有价值的信息（这也表明它不是网络）。各部分有什么区别？开始下降，直到你到达某个地方......

回到你的经理那里。每当我遇到这种类型的人格问题时，我都会尝试将精力重新定向到更有用的东西上。欲望就在那里，它只是需要一些帮助来塑造。如果你能说服你的经理确保测试是具体的，那么如果他们做了足够多的测试，他们就会产生足够的信息来正确猜测错误。当然，更一致的方法可能会更快，但为什么要拒​​绝一些免费帮助。我通常觉得任何人在任何项目中都有一些有用的角色，这一切都是为了让他们能够利用他们的努力......

保罗。

# programming-languages - 各种函数式语言有哪些优点/缺点？

> ID：497238
> 
> 赞同：3
> 
> 时间：2009-01-30T21:04:41.357
> 
> 标签：programming-languages, functional-programming

我知道几种函数式语言——F#、Lisp 及其方言、R 等等。然而，由于我从未使用过它们中的任何一个（尽管我提到的三个在我的“学习”列表中），我想知道各种函数式语言的优缺点。在学习语言和该语言的任何实际应用中是否有显着的优点/缺点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-30T21:34:43.197

Haskell 是“极端的”（懒惰的，纯粹的），有活跃的用户，大量的文档，并制作可运行的应用程序。

SML 是“不那么极端”（严格的、不纯的），有活跃的用户、正式的规范、许多实现（SML/NJ、Mlton、Moscow ML 等）。实现方式因运行时部署应用程序的方式而异。

OCaml 是有态度的机器学习。它具有面向对象、活跃用户、文档、附加组件和可运行的应用程序。

Erlang 是并发的、严格的、纯粹的（大部分），并且支持分布式应用程序。它需要单独安装一个运行时，因此部署与制作可运行二进制文件的语言不同。

F# 类似于带有 Microsoft 支持和 .NET 库的 OCaml。

Scala 在 JVM 上运行，可用作具有高级特性的函数式语言，或简单地用作增强型 Java，或两者兼而有之。灵活性被认为是*学习*函数式语言的一个缺点，因为它很容易回到命令式 Java 方式。当然，如果您想使用现有的 JVM 库，这也是一个优势。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-30T21:39:10.380

我不确定您的问题是一般的功能语言，还是它们之间的差异。有关为何起作用的一般信息：

[http://paulspontifications.blogspot.com/2007/08/no-silver-bullet-and-functional.html](http://paulspontifications.blogspot.com/2007/08/no-silver-bullet-and-functional.html)

[为什么函数式编程很重要](http://www.cs.chalmers.se/~rjmh/Papers/whyfp.html)

至于功能语言之间的差异：

[函数式语言的显着特征](https://stackoverflow.com/questions/485418/distinctive-traits-of-the-functional-languages)

函数式语言的绝妙之处在于它以 lambda 演算和其他数学为基础。这导致能够更轻松地跨语言使用类似的算法和思想。

至于你应该学习哪一个：选择一个会给你一个舒适的环境。例如，如果您使用的是 .NET 和 Visual Studio，那么 F# 非常适合。（实际上，VS 集成使 F# 成为强有力的竞争者，时期。）带有 PLT Scheme 的“ [How to Design Programs](http://www.htdp.org/) ”一书（全文，免费，在线）也是一个不错的选择。

我有偏见，但 F# 看起来具有最大的“现实世界”潜力。这主要是因为良好的 IDE/.NET 集成，允许您充分利用 .NET 和 OO，同时保持大量功能强大（并以多种方式对其进行扩展）。Scala 可能是竞争者，但它更像是一种具有一些功能特性的 OO 语言；因此 Scala 的生产力提升不会那么大。

编辑：在有人对此发表评论之前，请注意 JavaScript 和 Ruby :)。如果你在做这种类型的 web 开发，Ruby 是你可以看看的其他东西，因为它有很多功能概念，虽然不像其他语言那样精致。

最大的缺点是，一旦你看到你可以拥有的力量，你就不会乐于使用较少的语言。如果您被迫与尚未理解的人打交道，这将成为一个问题。

最后一点，唯一的“缺点”是“它太复杂了”。这实际上不是真的——函数式语言通常更简单——但如果你的大脑中有多年的 C 或诸如此类的东西，那么“获得”函数式概念可能是一个重大障碍。咔嚓一声之后，应该是比较顺利的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-30T21:29:35.953

Lisp 有一个温和的学习曲线。你可以在一个小时内学习基础知识，当然学习习语等需要更长的时间。不利的一面是，Lisp 的方言很多，很难与 Java 或 .NET 等主流环境交互。

除非您需要进行统计，否则我不会推荐 R。这是一种奇怪的语言，而且不完全是功能性的。您可以在 R 中进行函数式编程，但大多数人不这样做。

如果您熟悉 Microsoft 工具堆栈，F# 可能很容易上手。它背后有一个庞大的、经过良好测试的库，即 CLR。

您可以在任何语言中使用函数式编程风格，尽管有些语言比其他语言更容易。就这一点而言，您可以尝试 Python。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T21:34:48.440

机器学习系列（SML/OCaml/F#）：

优点：

*   相当简单
*   有有效的实现（在 Java/C# 的水平上）
*   易于预测的资源消耗（与惰性语言相比）
*   可读语法
*   强大的模块系统
*   （对于 F#）：可用的大型 .Net 库
*   有可变变量

缺点：

*   有时过于简单（没有类型类 => 重载问题）
*   （F# 除外）：标准库缺少一些有用的东西
*   有可变变量:)
*   不能有无限的数据结构（不是惰性语言）

我没有提到大多数静态类型函数语言共有的特性：类型推断、参数多态性、高阶函数、代数数据类型和模式匹配。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T22:08:07.390

我在大学里像纯函数式语言一样学习了 Haskell，我可以说它真的很强大，但我也找不到实际用途。

但是，我发现了这个：[Haskell in practice](http://www.haskell.org/haskellwiki/Applications)。检查它，是惊人的。

功能范式的特征有时是优点，有时是缺点，具体取决于情况/上下文。他们之中有一些是：

*   高水平
*   拉姆达函数
*   懒惰的评价
*   高阶函数
*   递归
*   类型推断

引用自维基百科：

> 效率问题
> 
> 函数式编程语言在使用 CPU 和内存方面的效率被认为不如 C 和 Pascal 等命令式语言。 [26] 但是，对于执行密集数值计算的程序，OCaml 和 Clean 等函数式语言的速度与 C 相似。对于处理大型矩阵和多维数据库的程序，数组函数式语言（如 J 和 K）在设计时进行了速度优化头脑。
> 
> 纯函数式语言以比命令式语言慢而闻名。但是，在许多情况下，数据的不变性可以提高执行效率，从而允许编译器做出命令式语言中不安全的假设，从而大大增加了内联的机会。
> 
> 惰性求值也可能会加速程序，即使是渐近的，但它最多可能会减慢一个常数因子（但是，如果使用不当，它可能会导致内存泄漏）。

# performance - 展示和传达性能改进（例如百分比、原始数据、图形）的最有效方式是什么？

> ID：497240
> 
> 赞同：3
> 
> 时间：2009-01-30T21:05:30.153
> 
> 标签：performance, project-management, metrics

使用百分比或仅使用数字的差异来描述改进是否更好？例如，如果您将关键 ETL SQL 查询的性能从 4000 毫秒提高到 312 毫秒，您将如何在性能评估中将其表示为“成就”？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-30T21:09:28.180

以货币计。金钱是传达价值的最有效媒介，这就是你试图用绩效评估来证明的。

节省的工时，（非常粗略的）$NEW_THING_THE_COMPANY_CAN_DO_AS_RESULT 的估计值，避免了未来的硬件升级等。

你得到了丰厚的奖金，表明你对公司的财务状况很敏感；一个能与公司真正的目标保持一致的极客。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-30T21:13:46.907

1.  吃土豆
2.  用打火机液体浇土豆
3.  火上的小土豆
4.  把土豆递给老板
5.  让boss按住4秒。
6.  问老板那 4 秒感觉多长时间
7.  问老板半秒会好多少
8.  沉浸在荣耀中

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-30T21:28:33.367

衡量相对改进总是更好。

所以，如果你把它从 4000 毫秒降低到 312 毫秒，那么它是 3688 毫秒的改进，是原始速度的 92.2%。因此，您将运行时间减少了 92.2%。换句话说，您将运行时间降低到原来的 7.8%。

另一方面，绝对数字通常不是那么好，因为它们没有可比性。（如果您最初的运行时间是 4,000,000 毫秒，那么 3688 毫秒的改进并不是那么好。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T22:35:45.790

有关一些不错的图表建议，请参阅[此链接](http://www.flickr.com/photos/amit-agarwal/3196386402/sizes/l/)。

## 与要求的比较

如果我有要求（响应时间、吞吐量），我喜欢对绝对数字进行颜色编码，如下所示：

> 绿色：<= 80% 的需求（响应时间）；>= 120% of > 要求（吞吐量）
> 无格式：满足要求。
> 红色：不符合要求。

比较很有趣，但前提是我们有足够的能力看到一段时间内的趋势；我们的表现是在稳步提高还是在下降？最终，企业只关心我们是否满足要求。只有当我们不要求他们要求与以前的版本进行比较时。

## 基准比较

如果我将基准与某个基准进行比较，那么我喜欢使用百分比，但前提是基准与基准相比具有统计学意义的变化。

## 硬件尺寸

如果我正在做硬件调整或容量规划，那么我喜欢将性能表示为绝对数字加上每笔交易的成本。例如：

*   系统 A：1,000 笔交易/秒，0.02 美元/笔交易
*   系统 B：1,500 笔交易/秒，0.04 美元/笔交易

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T21:09:54.963

考虑到变化，使用最令人印象深刻的。根据一种计算方法，该更改将查询速度提高了 1,300%，这看起来比 13 倍的改进更令人印象深刻，或者

*   ============== <-- 旧查询
*   = <-- 新查询

虽然图表不是一个坏方法。

如果你能计算出金钱的改善，那就去吧。我多年前编写的一个软件每天为一些工程师节省了一点时间。计算出工资、福利、管理费用的成本，这为一家小公司每年节省了超过 12,000 美元。

-亚当

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-30T21:13:36.673

经验法则：哪个听起来更令人印象深刻。

如果您在一段时间内完成的任务从 10 项增加到 12 项，您可以说您的性能提高了 20% 说您多完成了两项任务似乎并不令人印象深刻。

在你的情况下，这两个数字听起来都不错，但尝试不同的表示，看看你会得到什么！

有时图形有助于在许多因素上进行很多改进，但组合起来看起来并不那么酷

示例：您有 5 个参数 A、B、C、D、E。您可以制作一个条形图，其中包含这 5 个参数和每个参数并排的“之前和之后”值。那肯定会令人印象深刻。

上帝，我开始听起来像我的营销朋友！

*尖叫着跑开*

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-01-31T22:56:55.280

你可以让数字和图表说出你想要的任何东西——重要的是让它们说出对你展示给他们的观众有意义和相关的东西。如果是最终用户，您可以向他们展示屏幕刷新的差异（他们理解这一点），向管理人员展示他们支持应用程序所需的服务器数量可能会减少（节省美元），财务......这都是关于$ 它为他们节省了多少钱。一般规则是，团队技术越少，您需要的图形和戏剧性就越强。

# sql - 如何对 SQL Server 中的别名列执行 GROUP BY？

> ID：497241
> 
> 赞同：76
> 
> 时间：2009-01-30T21:05:35.380
> 
> 标签：sql, sql-server, tsql, syntax

我正在尝试对别名列（下面的示例）执行*分组*操作，但无法确定正确的语法。

```
SELECT       LastName + ', ' + FirstName AS 'FullName'
FROM         customers
GROUP BY     'FullName' 
```

什么是正确的语法？

进一步扩展问题（我没想到会收到我收到的答案）该解决方案是否仍适用于 CASEed 别名列？

```
SELECT       
    CASE
        WHEN LastName IS NULL THEN FirstName
        WHEN LastName IS NOT NULL THEN LastName + ', ' + FirstName
    END AS 'FullName'
FROM         customers
GROUP BY     
    LastName, FirstName 
```

答案是肯定的，它仍然适用。

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2009-01-30T21:08:54.857

您传递要分组的表达式而不是别名

```
SELECT       LastName + ', ' + FirstName AS 'FullName'
FROM         customers
GROUP BY      LastName + ', ' + FirstName 
```

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2009-01-30T21:12:18.250

这就是我所做的。

```
SELECT FullName
FROM
(
  SELECT LastName + ', ' + FirstName AS FullName
  FROM customers
) as sub
GROUP BY FullName 
```

* * *

此技术以直接的方式应用于您的“编辑”场景：

```
SELECT FullName
FROM
(
  SELECT
     CASE
       WHEN LastName IS NULL THEN FirstName
       WHEN LastName IS NOT NULL THEN LastName + ', ' + FirstName
     END AS FullName
  FROM customers
) as sub
GROUP BY FullName 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-30T21:09:58.850

不幸的是，您不能在 GROUP BY 语句中引用您的别名，您将不得不再次编写逻辑，这看起来很神奇。

```
SELECT       LastName + ', ' + FirstName AS 'FullName'
FROM         customers
GROUP BY     LastName + ', ' + FirstName 
```

或者，您可以将选择放入子选择或公用表表达式中，之后您可以对列名进行分组（不再是别名。）

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-30T21:12:23.400

抱歉，这在 MS SQL Server 中是不可能的（虽然在 PostgreSQL 中是可能的）：

```
select lastname + ', ' + firstname as fullname
from person
group by fullname 
```

否则就用这个：

```
select x.fullname
from 
(
    select lastname + ', ' + firstname as fullname
    from person
) as x
group by x.fullname 
```

或这个：

```
select lastname + ', ' + firstname as fullname
from person
group by lastname, firstname  -- no need to put the ', ' 
```

上面的查询更快，首先对字段进行分组，然后**计算**这些字段。

以下查询较慢（它首先尝试**计算**选择表达式，然后根据该计算对记录进行分组）。

```
select lastname + ', ' + firstname as fullname
from person
group by lastname + ', ' + firstname 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-30T21:10:34.573

我的猜测是：

```
SELECT       LastName + ', ' + FirstName AS 'FullName'
FROM         customers
GROUP BY     LastName + ', ' + FirstName 
```

Oracle 也有类似的限制，这很烦人。我很好奇是否存在更好的解决方案。

要回答问题的后半部分，此限制也适用于更复杂的表达式，例如您的 case 语句。我见过的最好的建议是使用子选择来命名复杂的表达式。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-30T21:41:52.950

鉴于您编辑的问题描述，我建议使用`COALESCE()`而不是那个笨拙的`CASE`表达：

```
SELECT FullName
FROM (
  SELECT COALESCE(LastName+', '+FirstName, FirstName) AS FullName
  FROM customers
) c
GROUP BY FullName; 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-12-13T18:49:57.400

您可以使用`CROSS APPLY`创建别名并在`GROUP BY`子句中使用它，如下所示：

```
SELECT       FullName
FROM         Customers
CROSS APPLY  (SELECT LastName + ', ' + FirstName AS FullName) Alias
GROUP BY     FullName 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-31T13:51:40.653

```
SELECT       
    CASE
        WHEN LastName IS NULL THEN FirstName
        WHEN LastName IS NOT NULL THEN LastName + ', ' + FirstName
    END AS 'FullName'
FROM
    customers
GROUP BY     
    LastName,
    FirstName 
```

这是有效的，因为您使用的公式（CASE 语句）永远不会为两个不同的输入给出相同的答案。

如果您使用以下内容，则情况并非如此：

```
LEFT(FirstName, 1) + ' ' + LastName 
```

在这种情况下，“James Taylor”和“John Taylor”都会产生“J Taylor”。

如果您希望您的输出有两次“J Taylor”（每个人一个）：

```
GROUP BY LastName, FirstName 
```

但是，如果您只想要一排“J Taylor”，您会想要：

```
GROUP BY LastName, LEFT(FirstName, 1) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-30T21:13:08.407

在旧的[FoxPro](http://en.wikipedia.org/wiki/Visual_FoxPro)中（我从 2.5 版开始就没有使用过），你可以这样写：

```
SELECT       LastName + ', ' + FirstName AS 'FullName', Birthday, Title
FROM         customers
GROUP BY     1,3,2 
```

我真的很喜欢这种语法。为什么不在其他地方实施？这是一个不错的捷径，但我认为它会导致其他问题？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-02T03:09:44.770

如果您想避免 case 语句在您的查询中出现两次混乱，您可能希望将其放在用户定义的函数中。

抱歉，SQL Server 不会在 Group By 子句之前呈现数据集，因此列别名不可用。您可以在 Order By 中使用它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-09-10T20:00:56.053

```
SELECT 
CASE WHEN LastName IS NULL THEN FirstName         
     WHEN LastName IS NOT NULL THEN LastName + ', ' + FirstName     
END AS 'FullName' 
FROM  customers GROUP BY 1` 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-09-22T11:07:06.863

对于发现自己遇到以下问题的任何人（通过确保零值和空值被视为相等进行分组）...

```
SELECT AccountNumber, Amount AS MyAlias
FROM Transactions
GROUP BY AccountNumber, ISNULL(Amount, 0) 
```

*（即 SQL Server 抱怨您没有在 Group By 或聚合函数中包含字段 Amount）*

...记住在您的 SELECT 中放置完全相同的功能...

```
SELECT AccountNumber, ISNULL(Amount, 0) AS MyAlias
FROM Transactions
GROUP BY AccountNumber, ISNULL(Amount, 0) 
```

# language-agnostic - 遍历目录树的方法有哪些？

> ID：497243
> 
> 赞同：11
> 
> 时间：2009-01-30T21:07:17.107
> 
> 标签：language-agnostic, filesystems, directory-traversal

你如何用你喜欢的语言遍历目录树？

在不同操作系统中遍历目录树需要知道什么？在不同的文件系统上？

您最喜欢用于帮助遍历目录树的库/模块是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-30T21:47:17.400

在**Python**中：

如果您正在寻找一种快速、干净且便携的解决方案，请尝试：

```
import os
base_dir = '.'

def foo(arg, curr_dir, files):
  print curr_dir
  print files

os.path.walk(base_dir, foo, None) 
```

请注意，您可以修改 foo 以执行其他操作，而不仅仅是打印名称。此外，如果您有兴趣迁移到 Python 3.0，则必须改用 os.walk()。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-30T21:22:55.953

在**Java**中：

递归在这里很有用。下面是一段在 Internet 上流传多年的 Java 代码片段。不确定谁值得称赞。

```
// Process all files and directories under dir

    public static void visitAllDirsAndFiles(File dir) {

        process(dir);  //do something useful with the file or dir

        if (dir.isDirectory()) {
            String[] children = dir.list();
            for (int i=0; i<children.length; i++) {
                visitAllDirsAndFiles(new File(dir, children[i]));
            }
        }
    } 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-12-30T03:17:23.890

重击：

```
#!/bin/bash

function walk_tree {
      echo "Directory: $1"
      local directory="$1"
      local i
      for i in "$directory"/*; 
      do
      echo "File: $i"
        if [ "$i" = . -o "$i" = .. ]; then 
            continue
        elif [ -d "$i" ]; then  # Process directory and / or walk-down into directory
            # add command here to process all files in directory (i.e. ls -l "$i/"*)
            walk_tree "$i"      # DO NOT COMMENT OUT THIS LINE!!
        else
            continue    # replace continue to process individual file (i.e. echo "$i")
        fi
      done
}

walk_tree $HOME 
```

（改编自[http://ubuntuforums.org/showthread.php?t=886272](http://ubuntuforums.org/showthread.php?t=886272)评论 #4）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-30T21:22:54.860

在**C#**中：

```
Stack<DirectoryInfo> dirs = new Stack<DirectoryInfo>();

dirs.Push(new DirectoryInfo("C:\\"));

while (dirs.Count > 0) {
    DirectoryInfo current = dirs.Pop();

    // Do something with 'current' (if you want)

    Array.ForEach(current.GetFiles(), delegate(FileInfo f)
    {
        // Do something with 'f'
    });

    Array.ForEach(current.GetDirectories(), delegate(DirectoryInfo d)
    {
        dirs.Push(d);
    });
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-12-30T03:36:23.433

**C++**

```
#include <utility>
#include <boost/filesystem.hpp>
#include <boost/foreach.hpp>

#define foreach BOOST_FOREACH
namespace fs = boost::filesystem;

fs::recursive_directory_iterator it(top), eod;
foreach (fs::path const & p, std::make_pair(it, eod)) {
    if (is_directory(p)) {
        ...
    } else if (is_regular_file(p)) {
        ...
    } else if (is_symlink(p)) {
        ...
    }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-12T13:48:54.960

**在 Linux 上使用 GNU 工具**

```
find -print0 | xargs -0 md5sum 
```

或者

```
find -print0 | xargs -0 -iASD echo 'this file "ASD" should be dealt with lile this (ASD)' 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-30T22:34:15.933

嗯，C# 有一定的递归......

```
public static List<string> CrawlPath(string path, bool IncludeSubFolders)
{
    List<string> fileList = new List<string>();
    try
    {
        Stack<string> filez = new Stack<string>(Directory.GetFiles(path));
        while (filez.Count > 0)
        {
            fileList.Add(filez.Pop());
        }

        if (IncludeSubFolders)
        {
            filez = new Stack<string>(Directory.GetDirectories(path));
            while (filez.Count > 0)
            {
                string curDir = filez.Pop();
                fileList.AddRange(CrawlPath(curDir, IncludeSubFolders));
            }
        }
     }
     catch (System.Exception err)
     {
         Console.WriteLine("Error: " + err.Message);
     }
     return fileList;
  } 
```

# asp.net - 为什么 Visual Studio 2005/2008 总是“忘记”颜色代码和格式？

> ID：497256
> 
> 赞同：2
> 
> 时间：2009-01-30T21:10:27.833
> 
> 标签：asp.net, visual-studio

还有没有其他问题，在使用 VS2005 或 VS2008 时，它突然“忘记”为您设置颜色代码和格式化文本？突然之间，它就像一个普通的旧记事本编辑器。有时，如果我保存并重新打开文件，或者完全重新启动 Visual Studio，它会突然“记住”。我想这可能是因为我的机器上安装不正确，但最近升级到了一个新的、全新的、带有所有服务包的全新安装 - 我们又回到了不稳定的行为....

这是一个已知问题吗？是否有解决方法（即我可以点击一个键组合来告诉它做它的事情？）

PS：这发生在我用 VB 代码做 asp.net 时——不确定它是否会影响其他风格的工具......

**编辑：**这是在 Vista 上全新安装的 VS2008，但在 XP 上也有。两种设置都没有插件，问题经常发生。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T21:12:59.933

有时在我的 VB.Net 中会发生类似的事情。就我而言，它一直是由于某种原因而停止工作的后台编译器服务。除了重新启动视觉工作室之外，还没有找到任何帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T21:32:45.013

我在处理大型 Web 项目（> 1K 页面和 4K 总文件）时经常遇到这种情况，最常见的是处理 ashx 文件。

同时，我会失去智能感知，这是因为我添加的文件在文件属性 -> 构建选项中没有被标记为“编译”。

我从来没有找到原因（假设它使解决方案负担过重），但我发现如果我定期删除 SUO 文件（它进入 1MB 范围），它会保持更长时间。

自从来到一家新公司、新 PC 等，我没有遇到过这个问题，但我又一次没有从事大型网络项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T21:14:03.020

我在VS2008中使用C#，没有遇到任何问题。也许这是 VB.NET 相关的？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T21:28:21.353

我曾经看到“网站”的问题。从那以后，我将大部分项目更改为“Web 应用程序”，并且有一段时间没有看到这个问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T21:30:17.590

我在 VS 2003 上遇到了类似的问题。我现在使用 VS 2008，但这种情况不再发生。

# c# - 如何从 IEnumerable 中获取第一个元素 在.net？

> ID：497261
> 
> 赞同：174
> 
> 时间：2009-01-30T21:12:21.620
> 
> 标签：c#, .net

我经常想`IEnumerable<T>`在 .net 中获取第一个元素，但我还没有找到一个好的方法来做到这一点。我想出的最好的是：

```
foreach(Elem e in enumerable) {
  // do something with e
  break;
} 
```

呸！那么，有没有很好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：273
> 
> 时间：2009-01-30T21:13:50.540

如果您可以使用 LINQ，则可以使用：

```
var e = enumerable.First(); 
```

如果 enumerable 为空，这将引发异常：在这种情况下，您可以使用：

```
var e = enumerable.FirstOrDefault(); 
```

`FirstOrDefault()`如果可枚举为空，则返回`default(T)`，这将`null`用于引用类型或值类型的默认“零值”。

如果您不能使用 LINQ，那么您的方法在技术上是正确的，并且与使用`GetEnumerator`and`MoveNext`方法创建一个枚举器来检索第一个结果没有什么不同（此示例假设 enumerable 是一个`IEnumerable<Elem>`）：

```
Elem e = myDefault;
using (IEnumerator<Elem> enumer = enumerable.GetEnumerator()) {
    if (enumer.MoveNext()) e = enumer.Current;
} 
```

[Joel Coehoorn](https://stackoverflow.com/users/3043/joel-coehoorn)在评论中提到`.Single()`；如果您希望您的可枚举只包含一个元素，这也将起作用 - 但是如果它为空或大于一个元素，它将引发异常。有一种相应的`SingleOrDefault()`方法以与`FirstOrDefault()`. 但是，[David B](https://stackoverflow.com/users/8155/david-b)解释说，`SingleOrDefault()`在可枚举包含多个项目的情况下仍可能引发异常。

编辑：感谢[Marc Gravell](https://stackoverflow.com/users/23354/marc-gravell)指出我需要`IEnumerator`在使用对象后处理它 - 我已经编辑了非 LINQ 示例以显示`using`关键字来实现此模式。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-01-30T21:39:21.253

以防万一您使用的是 .NET 2.0 并且无权访问 LINQ：

```
 static T First<T>(IEnumerable<T> items)
 {
     using(IEnumerator<T> iter = items.GetEnumerator())
     {
         iter.MoveNext();
         return iter.Current;
     }
 } 
```

这应该可以满足您的需求...它使用泛型，因此您可以获取任何类型 IEnumerable 的第一项。

像这样称呼它：

```
List<string> items = new List<string>() { "A", "B", "C", "D", "E" };
string firstItem = First<string>(items); 
```

或者

```
int[] items = new int[] { 1, 2, 3, 4, 5 };
int firstItem = First<int>(items); 
```

您可以轻松地对其进行修改以模仿 .NET 3.5 的 IEnumerable.ElementAt() 扩展方法：

```
static T ElementAt<T>(IEnumerable<T> items, int index)
{
    using(IEnumerator<T> iter = items.GetEnumerator())
    {
        for (int i = 0; i <= index; i++, iter.MoveNext()) ;
        return iter.Current;
    }
} 
```

像这样称呼它：

```
int[] items = { 1, 2, 3, 4, 5 };
int elemIdx = 3;
int item = ElementAt<int>(items, elemIdx); 
```

当然，如果您*确实*可以访问 LINQ，那么已经发布了很多好的答案......

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2009-01-30T21:15:36.513

好吧，您没有指定您使用的 .Net 版本。

假设你有 3.5，另一种方法是 ElementAt 方法：

```
var e = enumerable.ElementAt(0); 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-30T21:14:43.380

[第一或默认](http://msdn.microsoft.com/en-us/library/bb340482.aspx)？

```
Elem e = enumerable.FirstOrDefault();
//do something with e 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-08-30T09:51:06.997

试试这个

```
IEnumberable<string> aa;
string a = (from t in aa where t.Equals("") select t.Value).ToArray()[0]; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-30T22:14:07.783

如前所述，使用 FirstOrDefault 或 foreach 循环。应避免手动获取枚举器并调用 Current。如果 foreach 实现 IDisposable，它将为您处理您的枚举器。调用 MoveNext 和 Current 时，您必须手动处理它（如果适用）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-12-31T17:05:27.663

如果您的 IEnumerable 没有公开它`<T>`并且 Linq 失败，您可以使用反射编写一个方法：

```
public static T GetEnumeratedItem<T>(Object items, int index) where T : class
{
  T item = null;
  if (items != null)
  {
    System.Reflection.MethodInfo mi = items.GetType()
      .GetMethod("GetEnumerator");
    if (mi != null)
    {
      object o = mi.Invoke(items, null);
      if (o != null)
      {
        System.Reflection.MethodInfo mn = o.GetType()
          .GetMethod("MoveNext");
        if (mn != null)
        {
          object next = mn.Invoke(o, null);
          while (next != null && next.ToString() == "True")
          {
            if (index < 1)
            {
              System.Reflection.PropertyInfo pi = o
                .GetType().GetProperty("Current");
              if (pi != null) item = pi
                .GetValue(o, null) as T;
              break;
            }
            index--;
          }
        }
      }
    }
  }
  return item;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-04-19T15:44:23.990

您还可以尝试更通用的版本，它为您提供第 i 个元素

可枚举的.ElementAtOrDefault(i));

希望能帮助到你

# sql-server - TSQL OLE (com) 对象

> ID：497265
> 
> 赞同：0
> 
> 时间：2009-01-30T21:12:37.487
> 
> 标签：sql-server, tsql, com, ole, sqlclr

从 tsql 调用 ole 对象是否存在任何固有问题？我遇到了一个我想仅使用存储过程来解决的问题，使用 ole 对象而不是用基于 clr 的语言编写它有什么需要担心的吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-30T21:22:17.483

只要确保您不能首先将其作为基于集合的操作来执行，请记住在完成后释放它们，并记住这根本不会是可移植的（但是 clr 代码也不会）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T15:02:19.200

Com 对象大多是本地代码，如果你调用有内存泄漏的东西，你可能会导致问题

# automation - 如何在 Word 2007 中自动“从 XYZ 模板重置为快速样式”？

> ID：497269
> 
> 赞同：0
> 
> 时间：2009-01-30T21:13:14.567
> 
> 标签：automation, ms-office, office-2007, word-2007

在 Word 2007 中，用户可以通过在“更改样式”菜单选项中选择“从 XYZ 模板重置为快速样式”来更新应用的样式。

![从 XYZ 模板重置为快速样式](https://farm4.static.flickr.com/3320/3239869162_e6e3cb92ea.jpg)

有谁知道自动化的方法？我尝试在模板项目的 VBA 中的 Document_Open() 方法中添加一个宏，但它出错了。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-19T10:11:44.547

*当您录制“从xxx*模板重置为快速样式”的宏时，Word 会生成 VBA 代码：

```
WordBasic.ApplyQFSetTemplate 
```

我也无法让这个命令工作，也找不到任何关于它的 Word VBA 文档。相反，当附加了正确的模板时，请使用以下命令：

```
ActiveDocument.UpdateStyles 
```

那个确实有效！

# performance - 如何以编程方式使用 Firebug 网络面板数据？

> ID：497276
> 
> 赞同：10
> 
> 时间：2009-01-30T21:14:00.930
> 
> 标签：performance, testing, selenium, firebug, metrics

我的敏捷团队将为现有的房地产网站添加新功能。 **当我们添加功能时，我们希望更好地处理网站的整体性能以及特定页面的性能。**

我想根据每个页面的请求/响应自动收集性能指标（*例如，浏览器发送了哪些子请求，有多少子请求，传输了多少数据，以及每个请求需要多长时间履行*）。

**Firebug**目前在其网络面板中捕获此信息，但是，我还没有找到任何以编程方式提取此信息的方法。

***有谁知道在页面加载后提取此信息的方法？***

我们目前正在使用**Selenium**运行我们的用户验收测试，我已经考虑将此功能添加到 selenium 接口，以便我们的测试可以在不启动任何其他服务的情况下运行并收集数据。

欢迎所有建议，包括利用其他工具/方法收集性能指标的建议。

*谢谢你。*

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T14:22:14.353

Jan Odvarko 写了一篇 关于如何在 Firebug 中使用新的监听器功能来记录网络面板结果的[教程：](http://www.softwareishard.com/blog/firebug-tutorial/extending-firebug-net-panel-listener-part-viii/)

“自 Firebug 1.4a13 以来，网络面板引入了几个新事件，这些事件允许轻松收集所有网络请求以及 Firebug 收集和计算的相关信息。

在 Firebug 扩展想要将网络活动信息存储到本地数据库或将其发送回服务器以进行进一步分析的情况下，此功能也应该很有用（我在这里考虑性能统计）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-05-11T07:43:32.440

查看 FireBug 的[NetExport](https://getfirebug.com/wiki/index.php/Firebug_Extensions#NetExport)扩展。

脚步：

1.  在首选项中启用自动导出（您也可以自动执行此操作）
2.  选择要添加数据的文件夹
3.  读取文件

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T16:44:29.367

虽然它不是直接的 Firebug 解决方案，但也许像 Jiffy 这样的东西会有所帮助？

Jiffy 的工作方式非常类似于 Firebug 测量工具的基于服务器的版本。我还没有在愤怒中使用它，但它可能会做你想要的？

[http://code.google.com/p/jiffy-web/](http://code.google.com/p/jiffy-web/)

*Jiffy 允许开发人员：*

**   测量每个客户端上的各个页面呈现（脚本加载、AJAX 执行、页面加载等）*   将这些测量值和其他元数据报告给 Web 服务器*   将 Web 服务器日志聚合到数据库中*
*   *生成报告*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-13T02:27:11.970

有一种方法可以使用 ySlow 将性能数据发送到您选择的 URL。它没有很好的记录，我发现的唯一信息在这里：

[http://tech.groups.yahoo.com/group/exceptional-performance/messages/490?threaded=1&m=e&var=1&tidx=1](http://tech.groups.yahoo.com/group/exceptional-performance/messages/490?threaded=1&m=e&var=1&tidx=1)

除此之外，我会考虑编写一个 Firebug 插件，我认为您可以访问大多数 Firebug 属性。这是一个教程：[http ://www.firephp.org/Reference/Developers/ExtendingFirebug.htm](http://www.firephp.org/Reference/Developers/ExtendingFirebug.htm)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T15:59:08.043

Ben，我通过扩展 Selenium RC 的 ProxyHandler 来完成这项工作，以将看到的 URL 排队，然后允许您通过其他一些 API 将它们拉下来。它要求您代理*所有内容*，这不是 Selenium 的默认行为。好消息是 Selenium 最终成为推动自动化和收集所见结果的地方。

这可能是我们在推出 1.0 之后很快就会添加到 Selenium RC 的一个功能（我们已经**非常**接近了！）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-10T21:13:38.670

好吧，我承认这不是一个直接的答案，但直接去源头怎么样？删除 FireBug 并转到 Web 服务器。服务器能否以足够的粒度记录事件以允许计算您需要的信息？将日志文件解析为有用的数据应该不是特别困难，并且具有独立于用户平台的优势，并且有可能记录比 FireBug 提供的数据集更大的数据（顺便说一句很棒的工具）。

# validation - 如何在没有日期的情况下使用 CompareValidator？

> ID：497294
> 
> 赞同：4
> 
> 时间：2009-01-30T21:19:11.903
> 
> 标签：validation, asp.net-2.0, comparevalidator

当我在 Start 控件中输入*9:00* ，在 Finish中输入*16:00 ；*下面的代码验证失败。

有人知道我可以在没有日期的情况下使用 ASP.NET 验证器的方法吗？

```
Start <asp:TextBox ID="txtStart" runat="server" /> (hh:mm)
<br />
Finish <asp:TextBox ID="txtFinish" runat="server" /> (hh:mm)
<br />
<asp:CompareValidator
    id="cpvFinish"
    ControlToValidate="txtFinish"
    ControlToCompare="txtStart"
    Operator="GreaterThanEqual"
    Type="Date"
    Display="Static"
    EnableClientScript="true"
    ErrorMessage="Finish time must be later than the start time."
    runat="server" /> 
```

PS-我知道我可以轻松地使用 CustomValidator 代替，这似乎是这个验证器应该能够处理的事情。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-11T20:32:08.823

这显然是做不到的。

作为记录; 我使用了自定义验证器。

编辑：这是我的自定义验证器代码，以防任何人（即 alhambraeidos）需要它。请注意，此代码将我的示例控件名称（txtStart 和 txtFinish）替换为我的应用程序中的实际名称（txtReady 和 txtClose）。

```
try
{
    // parse & compare dates
    string randomDt = "01/01/2000 ";
    args.IsValid = DateTime.Parse(randomDt + txtClose.Text) > DateTime.Parse(randomDt + txtReady.Text);
}
catch(Exception /*ex*/)
{
    // exception is assumed to be invalid times entered
    args.IsValid = false;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T21:35:48.547

尝试将 Type 属性更改为 String，它应该可以工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T21:36:28.653

比较验证器允许的类型有：Stinrg、Integer、Double、Date（无时间） Currency

# asp.net-mvc - 返回 JsonResult 的 ASP.Net MVC Ajax 调用

> ID：497295
> 
> 赞同：3
> 
> 时间：2009-01-30T21:19:12.497
> 
> 标签：asp.net-mvc, asp.net-ajax

我开始学习 ASP.Net MVC（候选版本），但遇到了一些麻烦。我可能只是挑剔，但我想我会问。

我想使用内置的（扩展的）ASP.Net Ajax 方法来调用我的控制器，称为“GetNames”，它返回一个 JsonResult 对象。我见过使用 $.getJSON() jQuery 方法的示例，但我更喜欢这样做：

```
 <%using ( Ajax.BeginForm("GetNames", new AjaxOptions() { OnSuccess = "GetNamesSuccess", OnBegin = "GetNamesBegin", OnComplete = "GetNamesComplte", OnFailure = "GetNamesFailure" } ) ) { %>

    <%=Html.TextBox("DummyData") %>
    <input type=submit />

<% } %>

<script type="text/javascript">
    function GetNamesSuccess()
    {
        alert("Success");
    }

    function GetNamesBegin()
    {
        alert("Begin");
    }

    function GetNamesComplete()
    {
        alert("Complete");   
    }

    function GetNamesFailure()
    {
        alert("Failure");
    }        
</script> 
```

当我单击提交按钮时，我没有收到任何警报，并且提示我下载包含 Json 对象文本的文件，我相信这表明至少控制器方法工作正常。但这不是我的预期行为......理想情况下，Ajax.BeginForm 将设置它，以便 Json 对象将传递给 OnSuccess 或 OnComplete 方法。

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-30T21:30:58.213

您是否在视图页面中同时包含了 MicrosoftAjax.js 和 MicrosoftMvcAjax.js javascript 文件？在我看来，它实际上是在发布表单而不是使用 Ajax。当我缺少 MicrosoftAjax.js 包含时，我遇到了这个问题，因为 Ajax 回发由于缺少 javascript 类而失败，因此它调用了正常的表单帖子。

在相关说明中，您应该检查控制器中的请求是否为 Ajax，如果不是，则返回 ViewResult（或 Redirect）而不是 Json。如果有人关闭了 javascript，或者您的页面上有错误，您希望它优雅地降级并将其作为正常的回发处理，而不是返回 Json。

# resize - GTK：调整文本视图中包含的小部件的大小

> ID：497304
> 
> 赞同：2
> 
> 时间：2009-01-30T21:23:25.123
> 
> 标签：resize, widget, gtk, gtktextview

我有一个`Gtk.TextView`控件，我正在将子小部件插入其中。我希望能够在调整表单大小时让孩子调整大小以适应 TextView 的宽度。有没有内置的方法可以做到这一点？如果没有，任何人都可以提出一个写我自己的好方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-15T17:37:26.030

您可以使用[gtk_text_view_get_window() 方法](http://library.gnome.org/devel/gtk/stable/GtkTextView.html#gtk-text-view-get-window)来获取 Gtk.TextView 的宽度。使用这个数字，您可以相应地调整您的孩子小部件的大小。如果您想在 Gtk.TextView 调整大小时自动调整子窗口小部件的大小，可以使用[信号 check-resize](http://library.gnome.org/devel/gtk/stable/GtkContainer.html#GtkContainer-check-resize)来调整大小。

# file - 如何在Lua中只读取文本文件的最后一行？

> ID：497311
> 
> 赞同：1
> 
> 时间：2009-01-30T21:26:43.060
> 
> 标签：file, lua, io

我有一个程序可以生成最大为 20 米的文本字段。有时我只关心文件中的最后一行，有没有办法只读取该行而不浪费内存读取文件的其余部分？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-31T00:00:15.743

我可能会弄错，但如果不诉诸诡计，似乎你不能。但是，如果您对行的长度有一个粗略的估计，您可以打开一个文件，然后从末尾开始查找，例如 1Kb。

```
local f = io.open([[c:\test_file.txt]], "r")
local len = f:seek("end")

f:seek("set", len - 1024)
local text = f:read("*a")

print(string.match(text, "[^%c]*$"))
f:close() 
```

希望这可以帮助。考虑到该模式需要一些改进。它目前假定一行上没有出现控制字符。如果您的行有 ie 选项卡，那么它将从那里捕获到文件末尾。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2020-12-09T13:02:21.257

我不确定这对于包含非常大行的文件会如何表现，因为它会进行大量`f:read(1)`调用。我还添加了一个可选参数来读取不止一行。

```
-- assumes file ends with line break
function lastline(path, how_many)
    how_many = (how_many) or 1
    how_many = how_many + 1

    local f = assert(io.open(path))
    local new_lines_found = 0

    -- needs to find at least a pair of \n
    local len = f:seek("end")
    for back_by=1, len do
        f:seek("end", -back_by)
        if f:read(1) == '\n' then
            new_lines_found = new_lines_found + 1
            if new_lines_found == how_many then
                local last_lines = f:read("a")
                io.write(last_lines)
                return
            end
        end
    end

    f:close()
end 
```

# c# - .NET Remoting - 服务器如何更新客户端？

> ID：497314
> 
> 赞同：1
> 
> 时间：2009-01-30T21:26:54.337
> 
> 标签：c#, .net, architecture, asynchronous, remoting

现在，我正处于原型设计阶段。所以我才刚刚开始。

情况：服务器 - 将运行测试并将进度发布到客户端，必须是低影响的，没有网络服务器，可能运行 xp Embedded 或 xp home。

客户 - 启动测试并接收进度报告。运行xp pro。

两台机器通过以太网连接。我想使用 .NET 远程处理在两台机器之间进行通信，并且我想使用事件来使用来自服务器的新结果更新客户端，但我已经读到在这些条件下事件是不可靠的。我该怎么做？服务器可以连接到客户端并使用远程处理来发布事件吗？这行得通吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-30T22:01:26.077

我曾经部署了一个使用远程处理的系统，服务器启动了一些客户端可以订阅的事件。

为了使它成为可能，您必须将 typeFilterLevel 设置为 full，并且您还必须创建一个在客户端和服务器上已知的“中间”对象，以便能够处理您的事件。

例如：这是服务器端和客户端已知的类。

```
public abstract class MyDelegateObject : MarshalByRefObject
{
   public void EventHandlerCallback( object sender, EventArgs e )
   {
      EventHandlerCallbackCore(sender, e);
   }

   protected abstract void EventHandlerCallbackCore(object sender, EventArgs e );

   public override object InitializeLifetimeService() { return null; }
} 
```

在客户端，您创建另一个从上述类继承的类，并实现在引发事件时必须执行的实际逻辑。

```
public class MyConcreteHandler : MyDelegateObject
{
   protected override EventHandlerCallbackCore(object sender, EventArgs e)
   {
       // do some stuff
   }
} 
```

您只需将事件处理程序附加到远程对象的事件，如下所示：

```
MyConcreteHandler handler = new MyConcreteHandler();
myRemoteObject.MyEventOccured += new EventHandler(handler.EventHandlerCallback); 
```

当然，如果您在 EventHandler 类中更新 Winform 控件，该类也应该实现 ISynchronizeInvoke。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-30T22:11:20.567

由于您仍处于原型设计阶段，您可能需要考虑使用 Windows Communication Foundation (WCF) 而不是远程处理。[WCF 具有对发布-订阅方案的](http://msdn.microsoft.com/en-us/magazine/cc163537.aspx)内置支持，并且已经包含 .NET 远程处理和 Web 服务的所有功能（据我了解）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T21:49:15.807

通过服务器连接到客户端，您实际上是在反转模型并使服务器成为客户端，反之亦然。

您最好让客户端启动测试，并轮询服务器以获取状态更新。

您选择的远程处理并不是什么大问题（并且对我提供的意见没有影响），但您可能想要调查它的替代品 (WCF)，而不是花时间在“已替代但仍受支持”的技术上。

# database-design - 上午/下午列名称

> ID：497316
> 
> 赞同：4
> 
> 时间：2009-01-30T21:27:39.920
> 
> 标签：database-design, datetime

无需争论以这种方式存储日期时间的相对优点......

如果您有一个存储 AM 或 PM 的列，您会如何称呼该列？

**编辑：**

我应该想到会有一群人忍不住对这个想法嗤之以鼻......你从哪里看不到我要这样做，我想这样做，我正在不清楚不这样做的无数理由……但你们中的一些人仍然觉得自己不得不固执己见，关心自己有多聪明，而不是接受这个问题的价值并提供有用的东西。

我也很高兴有这么多人不应该受到这种诽谤并提出了一些很棒的想法。谢谢你的想法。

大多数值组都有名称，从 1 到 24 的值称为小时，从 1 到 12 个月等。但是对于 AM/PM，组、集合、域的名称是什么……它们是显然不是“meridiem”，因为那是一个时间点的名称 Noon。这就像将 AD 和 BC 称为基督的或主的。而 BCE 或 CE 可能适合“时代”列。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-30T21:30:20.180

AM 和 PM 分别代表“ante meridiem”和“post meridiem”。

因此，该列的一种可能性是： `meridiem CHAR(2)`

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-30T21:31:23.440

[当您在格式字符串](http://msdn.microsoft.com/en-us/library/8kb3ddd4.aspx)中指定 't' 或 'tt' 时查找 MS 调用它，他们只是说 AM/PM 指示符。

不过，这并不适合我，因为列的类型（如果您*必须*这样做）当然应该是`bit`. 考虑到这一点，您需要一个列名，其中的值由每条记录值的真/假清楚地指示。更像是 IsPM、IsAM、IsAfterNoon 或 IsPostMeridiem。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-30T21:33:09.927

好的，所以“meridiem”是它的官方技术术语，但请记住，另一个程序员出现并看到一个名为 this 的位字段，并且可能不知道它是什么。

AMPM 更具描述性，我认为这是一个更好的名称

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-30T21:36:08.313

我将其称为 meridiemoffset 并在其中存储 0 或 12。可以根据需要轻松转换为 AM 或 PM，但主要特点是您可以通过加法轻松计算实际小时数，甚至在 SQL 语句中（这使得排序更容易和更明显）。

-亚当

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-30T21:30:21.553

我认为这是一个糟糕的主意。哦，不讨论优点？我将其称为“XM”或“meridiem”，但这两者都可能令人困惑。“amORpm”怎么样？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-30T21:35:11.077

HourPeriod -> 在时钟 (am) 或秒 (pm) 上的第一次迭代

早上 -> 只是存储一点

Zombie -> 因为这就是你在没有咖啡的情况下在 AM 中的样子（另外，如果你以这种方式存储日期时间，你可能没有严格的命名约定）

或者，您可以只在代码端进行转换并存储 24 小时时间。13:58 总是“下午”，1:58 总是“上午”。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-30T21:37:20.963

如果您不能使用 24 小时时钟存储时间并且必须存储 AM/PM 值，我可能会有一个名为 PM_Timestamp 的位列，其中 0 = AM 和 1 = PM ......但我不喜欢它.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-30T21:52:35.067

我认为AMPM是最好的选择。很明显它的意思是什么。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-31T05:04:46.160

怎么样：

```
 AM_OR_PM 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-30T21:42:16.990

鉴于缩写词，“meridiem”是最准确的术语。但是，它在拉丁语中的意思是“中午”，因此可能会造成混淆。

如果您追求纯粹的可读性（并且坚决反对日期时间），我会推荐**IsMorning**或**IsAfternoon**。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-30T21:47:54.170

如果您使用的是 SQLServer，您可以用方括号括起非标准文本并将其命名为“ **?M** ”......所以您可以像*mytable.[?M]*一样使用它 ；-)

PS-我知道这可以做到，因为我的前任做到了。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-01-14T07:15:13.727

创建一个名为“day_period”的表，其中包含两列 - id 和 day_period。然后插入两个值 am 和 pm。

现在在表格中，您可以将列命名为“day_period_id”。可能的值为 1 和 2。

# sql - 如何查看 SQL 数据库的所有授权？

> ID：497317
> 
> 赞同：23
> 
> 时间：2009-01-30T21:28:01.807
> 
> 标签：sql, sql-server-2005, permissions

我正在使用 SQL Server 2005，我想找出所有表的特定数据库上的所有授权。它还有助于找出已为特定用户授予删除权限的所有表。

注意：这可能类似于[这个问题](https://stackoverflow.com/questions/212681/how-do-i-generate-a-table-of-permissions-granted-to-database-tables-for-a-databas)，但我无法让所选答案的解决方案正常工作（如果有人可以提供一个更好的例子来说明如何使用它，它也会有所帮助）

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-01-31T17:37:28.653

给定的解决方案不包括对架构或数据库本身授予权限的位置，它们也对表授予权限。这也会给你这些情况。您可以对 permission_name 使用 WHERE 子句来限制为仅 DELETE。

```
SELECT 
    class_desc 
  , CASE WHEN class = 0 THEN DB_NAME()
         WHEN class = 1 THEN OBJECT_NAME(major_id)
         WHEN class = 3 THEN SCHEMA_NAME(major_id) END [Securable]
  , USER_NAME(grantee_principal_id) [User]
  , permission_name
  , state_desc
FROM sys.database_permissions 
```

此外，需要检查 db_datawriter 的成员资格，因为它提供隐式 INSERT、UPDATE 和 DELETE 权限，这意味着您不会看到它出现在权限 DMV 或其派生词中。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2014-02-12T01:32:36.353

我喜欢 K. Brian Kelly 的回答，但我想要更多信息（如架构）以及生成相应的 GRANT 和 REVOKE 语句，以便我可以将它们应用于不同的环境（例如 dev/test/prod）。

请注意，您可以轻松排除系统对象，请参阅注释的 where 子句

```
select 
    class_desc 
    ,USER_NAME(grantee_principal_id) as user_or_role
    ,CASE WHEN class = 0 THEN DB_NAME()
          WHEN class = 1 THEN ISNULL(SCHEMA_NAME(o.uid)+'.','')+OBJECT_NAME(major_id)
          WHEN class = 3 THEN SCHEMA_NAME(major_id) END [Securable]
    ,permission_name
    ,state_desc
    ,'revoke ' + permission_name + ' on ' +
        isnull(schema_name(o.uid)+'.','')+OBJECT_NAME(major_id)+ ' from [' +
        USER_NAME(grantee_principal_id) + ']' as 'revokeStatement'
    ,'grant ' + permission_name + ' on ' +
        isnull(schema_name(o.uid)+'.','')+OBJECT_NAME(major_id)+ ' to ' +
        '[' + USER_NAME(grantee_principal_id) + ']' as 'grantStatement'
FROM sys.database_permissions dp
LEFT OUTER JOIN sysobjects o
    ON o.id = dp.major_id
-- where major_id >= 1  -- ignore sysobjects

order by 
    class_desc desc
    ,USER_NAME(grantee_principal_id)
    ,CASE WHEN class = 0 THEN DB_NAME()
         WHEN class = 1 THEN isnull(schema_name(o.uid)+'.','')+OBJECT_NAME(major_id)
         WHEN class = 3 THEN SCHEMA_NAME(major_id) end
    ,permission_name 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-30T21:42:36.380

要列出所有可以控制的权限，您可以使用该功能`fn_my_permission`。此查询列出**服务器**上的所有权限：

```
select * from fn_my_permissions(NULL, NULL) 
```

您必须使用具有 sysadmin 角色的帐户登录。

*您可以使用以下参数优化函数调用。*

对于**数据库**的所有权限：

```
select * from fn_my_permissions(NULL, 'database') 
```

对于 dbo**架构**的所有权限：

```
select * from fn_my_permissions('dbo', 'schema') 
```

对于**表**的所有权限：

```
select * from fn_my_permissions('dbo.test', 'object') 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-30T21:41:29.080

要查看特定数据库上的所有授权，请使用以下命令：

```
Select * from INFORMATION_SCHEMA.TABLE_PRIVILEGES 
```

要仅查看特定数据库上的删除授权，请使用以下命令：

```
Select * from INFORMATION_SCHEMA.TABLE_PRIVILEGES WHERE PRIVILEGE_TYPE = 'DELETE' 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-30T21:41:42.560

要查看整个数据库的授权，请选择有问题的数据库，打开一个新的查询窗口，输入 - `sp_helprotect`，执行查询

# php - 数据映射器模式和其他对象的自动更新

> ID：497320
> 
> 赞同：2
> 
> 时间：2009-01-30T21:28:33.977
> 
> 标签：php, datamapper

我正在使用数据映射器模式构建一个 PHP 应用程序，以将我的数据库与域对象分开。我有一个映射器类，它根据数据库中的数据返回站点对象，并接受现有的站点对象以保存回数据库。

我的问题是，在系统中，所有站点中的一个（也是唯一一个）必须标记为“主要”站点，这意味着如果我将一个设置为主要站点，我希望能够自动取消设置当前的初级。

所以，像：

```
$mapper = new Site_Mapper();
$site = $mapper->fetch(2);
$site->isPrimary = true;
$mapper->save($site); 
```

会以某种方式在后台自动执行此操作：

```
$mapper = new Site_Mapper();
$site = $mapper->fetch(1);
$site->isPrimary = false;
$mapper->save($site); 
```

问题是，自动更新现有主站点的逻辑应该去哪里？它必须在对象保存回数据库之后发生，而不是之前，以防数据库查询失败并且您没有站点作为主要站点。

干杯，杰克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T21:47:43.860

听起来像是数据库触发器的工作。

```
DELIMITER $$

CREATE TRIGGER test_trigger AFTER INSERT ON table
  FOR EACH ROW BEGIN
    IF NEW.isPrimary = 1 THEN 
       UPDATE table 
       SET isPrimary = 0
       WHERE id <> NEW.id;
    END IF;
  END$$

DELIMITER ; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-01T15:44:51.703

就我个人而言，我认为将附加更新逻辑与 Site_Mapper 类一起放置是最有意义的，特别是考虑到您在两个实例中都处理同一个表/映射器。您可以简单地覆盖 save($siteObj) 方法，使其像这样工作：

```
 public function save($siteObj) 
 {
     // Save the passed object.

     $sql = "UPDATE site SET isPrimary = 1 WHERE id != ?";

     $stmt = new PDO_Statement($sql);

     $stmt->execute($siteObj->id);

 } 
```

显然，您可以创建一个自定义的 save() 函数来更顺利地执行此操作，或者您可以使用 if 比较来确保您确实需要运行更新语句。

# php - Nusphere PHPEd：PHP 函数提示丢失参数？

> ID：497331
> 
> 赞同：0
> 
> 时间：2009-01-30T21:33:18.130
> 
> 标签：php, ide, phped

我的 PHPEd 突然停止在提示中显示参数和 arg 顺序，现在只显示函数的基本描述。

在我深入研究配置文件之前，有没有其他人遇到过这个问题？

谢谢！

**编辑：**

抱歉，我可能对此并不完全清楚。我自己的类没有问题，只有实际的 php 函数。

例子：

它以前是如何工作的：

我键入一个 PHP 函数，比如 strpos。一旦我在它的末尾键入“（”，我就会得到一个黄色的小框，显示如下：

```
int strpos  ( string $haystack  , mixed $needle  [, int $offset=0  ] ) 
```

第一个参数加粗。如果我输入它，然后输入一个逗号，它会将第二个 arg 加粗，依此类推。这真的很好，因为 PHP 函数在参数顺序方面有点混乱，而且我不必每次都查找它们。

现在如何运作：

我输入一个 php 函数，比如 strpos。一旦我在它的末尾键入“（”，我就会得到一个黄色的小框。它说类似“strpos - 返回大海捞针字符串中第一次出现的针的数字位置。”

没有显示任何参数，这使得小盒子基本上毫无价值 - 我知道 strpos 做了什么，我只想提醒一下参数顺序。

我认为这可能是我从未使用过的包含的 PHPDoc 的问题，但可能是提示框的数据来源。

我最近确实升级到了 5.6，但最终将其删除并恢复了 5.2。我安装到另一个文件夹，然后从那里卸载，但它可能覆盖了原始文件夹中的某些内容？

我正在使用 v5.2 (5220)。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-04T08:40:53.663

您使用的是什么版本的 PhpEd？你最近更新了 PhpEd 吗？

正如[论坛](http://forum.nusphere.com/viewtopic.php?t=1906&highlight=hints)中提到的，可以修改“函数参数工具提示”功能行为。

检查这是否与设置相关联的一种方法是移动`phped.cfg`配置文件（保存），并让 PhpEd 使用默认值重新创建它。如果确实恢复了工具提示，请使用差异程序检查可能已更改的选项。

您是看不到*所有*类的提示，还是只看到您自己的 Php 类（在后一种情况下，[此线程](http://forum.nusphere.com/viewtopic.php?t=3153&highlight=hints)有一些设置建议）？

* * *

注意：我要求版本的原因是因为[这个最近的线程](http://forum.nusphere.com/viewtopic.php?t=5661&highlight=function+argument+tooltip)，关于 PhpEd5.5：

[![替代文字](https://i.stack.imgur.com/pENxK.jpg)](https://i.stack.imgur.com/pENxK.jpg)

在这种情况下，建议是**复制`%PROGRAMFILES%\nusphere\phped\config\func.rel`到`%APPDATA%\nusphere\phped\config\`覆盖其中文件的目录中。**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T09:50:02.977

完全重新安装似乎已经解决了这个问题。可能是部分升级或设置版本不匹配的问题。

# algorithm - 高效的列表交集算法

> ID：497338
> 
> 赞同：80
> 
> 时间：2009-01-30T21:35:40.327
> 
> 标签：algorithm, list, set-intersection

给定两个列表（不一定是排序的），找到这些列表的集合交集的最有效的非递归算法是什么？
我不相信我可以使用散列算法。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-01-30T21:39:46.167

您可以将第一个列表的所有元素放入一个哈希集中。然后，迭代第二个，并且对于它的每个元素，检查哈希以查看它是否存在于第一个列表中。如果是，则将其作为交集的元素输出。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2010-05-23T16:22:00.213

你可能想看看布隆过滤器。它们是位向量，可以给出一个元素是否是集合成员的概率答案。设置交集可以通过简单的按位与运算来实现。如果您有大量的空交点，布隆过滤器可以帮助您快速消除它们。但是，您仍然必须使用此处提到的其他算法之一来计算实际的交点。 [http://en.wikipedia.org/wiki/Bloom_filter](http://en.wikipedia.org/wiki/Bloom_filter)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-30T21:49:10.970

没有散​​列，我想你有两个选择：

*   天真的方法是将每个元素与其他元素进行比较。O(n^2)
*   另一种方法是先对列表进行排序，然后对其进行迭代： O(n lg n) * 2 + 2 * O(n)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-05-23T16:56:30.090

从[eviews 功能列表](http://www.eviews.com/EViews7/ev7dmanage.html)看来，它支持复杂的合并和连接（如果这是数据库术语中的“连接”，它将计算交集）。现在浏览您的文档:-)

此外，eviews 有自己的用户论坛 - 为什么不在那里问_

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-04-21T02:23:55.863

使用 set 1 构建二叉搜索树`O(log n)`并迭代 set2 并搜索`BST m X O(log n)`总`O(log n) + O(m)+O(log n) ==> O(log n)(m+1)`

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-05-07T04:41:33.397

在 C++ 中，可以使用 STL map 尝试以下操作

```
vector<int> set_intersection(vector<int> s1, vector<int> s2){

    vector<int> ret;
    map<int, bool> store;
    for(int i=0; i < s1.size(); i++){

        store[s1[i]] = true;
    }
    for(int i=0; i < s2.size(); i++){

        if(store[s2[i]] == true) ret.push_back(s2[i]);

    }
    return ret;
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-01-04T19:55:31.677

这是我想出的另一种可能的解决方案，时间复杂度为 O(nlogn)，并且没有任何额外的存储空间。你可以在这里查看[https://gist.github.com/4455373](https://gist.github.com/4455373)

它是这样工作的：假设集合不包含任何重复，将所有集合合并为一个并对其进行排序。然后遍历合并的集合，并在每次迭代中在当前索引 i 和 i+n 之间创建一个子集，其中 n 是 Universe 中可用的集合数。我们在循环时寻找的是一个大小为 n 的重复序列，该序列等于宇宙中集合的数量。

如果 i 处的子集等于 n 处的子集，则意味着 i 处的元素重复 n 次，这等于集合的总数。由于在任何集合中都没有重复，这意味着每个集合都包含该值，因此我们将其添加到交集。然后我们将索引移动 i + 它和 n 之间剩余的内容，因为这些索引肯定不会形成重复序列。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-30T21:47:50.067

首先，使用 quicksort 对两个列表进行排序：O(n*log(n)。然后，通过首先浏览最低值来比较列表，然后添加公共值。例如，在 lua 中)：

```
function findIntersection(l1, l2)
    i, j = 1,1
    intersect = {}

    while i < #l1 and j < #l2 do
        if l1[i] == l2[i] then
            i, j = i + 1, j + 1
            table.insert(intersect, l1[i])
        else if l1[i] > l2[j] then
            l1, l2 = l2, l1
            i, j = j, i
        else
            i = i + 1
        end
    end

    return intersect
end 
```

这是列表的`O(max(n, m))`位置`n`和`m`大小。

编辑：快速排序是递归的，如评论中所述，但看起来有[非递归](http://www.seeingwithc.org/topic2html.html) [实现](http://www.codeguru.com/forum/archive/index.php/t-333288.html)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-06-16T14:11:25.140

使用[跳过指针](http://nlp.stanford.edu/IR-book/html/htmledition/faster-postings-list-intersection-via-skip-pointers-1.html)和[SSE 指令](https://highlyscalable.wordpress.com/2012/06/05/fast-intersection-sorted-lists-sse/)可以提高列表交集效率。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-30T21:53:09.387

为什么不实现自己的简单哈希表或哈希集？如果您的列表如您所说的那样大，那么避免 nlogn 交集是值得的。

由于您事先对数据有所了解，因此您应该能够选择一个好的散列函数。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-30T21:54:16.107

如果支持内置的[集合](http://en.wikipedia.org/wiki/Set_%28computer_science%29)（正如您在标题中所说的那样），通常会有一个交集方法。

无论如何，正如有人所说，如果您对列表进行了排序，您可以轻松完成（我不会发布代码，有人已经这样做了）。如果您不能使用递归，则没有问题。有[快速排序无递归](http://www.codeproject.com/KB/recipes/QuickSortWithoutRecursion.aspx)实现。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-31T22:55:26.467

我支持“集合”的想法。在 JavaScript 中，您可以使用第一个列表来填充对象，使用列表元素作为名称。然后使用第二个列表中的列表元素并查看这些属性是否存在。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-07-16T12:47:07.903

在 PHP 中，类似

```
function intersect($X) { // X is an array of arrays; returns intersection of all the arrays
  $counts = Array(); $result = Array();
  foreach ($X AS $x) {
    foreach ($x AS $y) { $counts[$y]++; }
  }
  foreach ($counts AS $x => $count) {
    if ($count == count($X)) { $result[] = $x; }
  }
  return $result;
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-06-29T14:41:18.413

**时间：O(n) 空间：O(1)**用于识别*交叉点的解决方案。*

**例如，**两个给定节点将通过每次到达终点时交换指针来检测交点。[视频说明在这里。](https://www.youtube.com/watch?v=8qi8a2ph71o)

```
public ListNode getIntersectionNode(ListNode headA, ListNode headB) {
    ListNode pA = headA;
    ListNode pB = headB;
    while (pA != pB) {
        pA = pA == null ? headB : pA.next;
        pB = pB == null ? headA : pB.next;
    }
    return pA;
} 
```

谢谢。

## 编辑

我对**交点**的解释是找到*交点*。

例如：

[![路口](https://i.stack.imgur.com/Gg9sU.png)](https://i.stack.imgur.com/Gg9sU.png)

对于给定的列表 A 和 B，A 和 B 将在点“相遇/相交” `c1`，并且上面的算法将返回`c1`。正如 OP 所说，OP 无法访问`Hashmaps`或某种方式，我相信 OP 是说算法应该具有`O(1)`空间复杂性。

前段时间我从 Leetcode 那里得到了这个想法，如果有兴趣的话：[Intersection of Two Linked Lists](https://leetcode.com/problems/intersection-of-two-linked-lists/)。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-10-19T10:08:28.163

根据 Big-Oh 符号的定义：

> 如果存在正常数 c 和 n 0 使得 T(N) ≤ cf(N) 当 N ≥ n 0 时，则 T(N) = O(f(N))。

这实际上意味着如果两个列表的大小相对较小，那么每两个 for 循环中少 100 个元素就可以了。循环第一个列表并在第二个列表中查找类似的对象。就我而言，它工作得很好，因为我的列表中最多不会有超过 10 - 20 个元素。但是，一个好的解决方案是对第一个 O(n log n) 进行排序，对第二个也进行 O(n log n) 排序并合并它们，另一个 O(n log n) 粗略地说 O(3 n log n)，说这两个列表大小相同。

# java - 从 FTP 文件列表中获取项目的时间戳

> ID：497343
> 
> 赞同：4
> 
> 时间：2009-01-30T21:36:44.100
> 
> 标签：java, ftp

在 Java 中，我尝试登录 FTP 服务器并查找所有比 x 更新的文件以进行检索。

目前我有一个输入流，它正在读取目录内容并将它们逐行打印出来，这一切都很好，但是输出相当模糊......看起来像这样......

```
-rw-------     1 vuser  4773 Jun 10  2008 .bash_history
-rw-r--r--     1 vuser  1012 Dec  9  2007 .bashrc
lrwxrwxrwx     1 root      7 Dec  9  2007 .profile -> .bashrc
drwx------     2 vuser  4096 Jan 30 01:08 .spamassassin
drwxr-xr-x     2 vuser  4096 Dec  9  2007 backup.upgrade_3_7
dr-xr-xr-x     2 root   4096 Dec 10  2007 bin 
```

ETC...

但是，我需要以秒或毫秒为单位的实际时间戳，以便确定是否需要该文件。

我认为这与 FTP 服务器的配置有关吗？但我有点难过。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-30T21:45:16.920

也许值得看看具有 FTP 功能的[Jakarta Commons Net API。](http://commons.apache.org/net/)

我认为有了它，您可以使用[列表文件](http://commons.apache.org/net/api/org/apache/commons/net/ftp/FTPClient.html#listFiles())，这些文件将为您提供可以执行[getTimeStamp](http://commons.apache.org/net/api/org/apache/commons/net/ftp/FTPFile.html#getTimestamp())的文件对象，然后您应该能够获得您需要的那些。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-30T21:47:36.743

不幸的是，标准没有强制要求 FTP 服务器目录列表的输出。事实上，它被明确描述为不用于机器解析。某些操作系统上的服务器之间的格式会有很大差异。

RFC 3659 描述了对 FTP 标准的一些扩展，包括用于查询修改时间的“MDTM”命令。如果你幸运的话，你想与之交谈的服务器已经实现了这个扩展。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-08T15:23:49.353

`getTimestamp()`获取文件的最后修改时间。如果您试图获取文件上传到服务器的时间，那将行不通。我正在尝试做类似的事情，我想获取 X 时间之后上传的所有文件。`ls`如果不实际执行并解析它，我找不到一种干净的方法。

# .net - 如何在不调用 ResourceManager.GetString() 并捕获异常的情况下确定 ResourceManager 是否包含键？

> ID：497347
> 
> 赞同：1
> 
> 时间：2009-01-30T21:37:16.767
> 
> 标签：.net, c++, localization

所以我有一个 ResourceManager 指向一个包含一堆字符串的资源文件。当我`GetString()`使用文件中不存在的密钥调用时，我得到一个`System.Resources.MissingManifestResourceException`. 我需要在不使用异常处理来控制程序流的情况下找出 Resource 是否包含指定的键。有没有 keys.exists() 方法之类的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-01-18T23:14:14.463

请注意，默认情况下，新 .net 项目的 Resources.resx 似乎将位于 Properties 文件夹中，因此您需要像这样创建 ResourceManager：

```
rm = new ResourceManager("MyNamespace.Properties.MyResource", assembly); 
```

或者，由于感到沮丧并删除/重新创建 Resources.resx，您可能会在项目的根目录中创建它，在这种情况下，您之前正在做的事情，即：

```
rm = new ResourceManager("MyNamespace.MyResource", assembly); 
```

将工作。这正是今天发生在我身上的事情，我添加这篇文章是希望它能减轻一些人的悲伤。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-10T16:11:15.510

使用不存在的键调用 GetString 方法不会引发异常，它只会返回 null。

但是，在尝试使用错误名称创建 ResourceManager 时会发生 MissingManifestResourceException。最常见的错误是忘记在资源名称中包含命名空间。

例如，做：

```
var r = new ResourceManager("MyResource", assembly); 
```

代替

```
var r = new ResourceManager("MyNamespace.MyResource", assembly); 
```

将导致 MissingManifestResourceException。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T22:27:37.740

不知道问题是什么，但我很沮丧并删除/重新创建了 resx 文件，这很有效。

# powershell - powershell：get-date.adddays 不正确？

> ID：497353
> 
> 赞同：1
> 
> 时间：2009-01-30T21:39:19.523
> 
> 标签：powershell

我要做的是创建一个 PowerShell 脚本，该脚本获取目录中的文件夹列表，该列表由正则表达式过滤，筛选出具有 nnnnnnx31 或 nnnnnnddd 的文件夹名称，其中 n = alpha chars for the first 6 characters and the last 3是静态字符串 x31 的任一数字。接下来，它会筛选文件是否存在 90 天，这些文件将被复制到不同的目录。

当我尝试运行时：

```
get-childitem | where {$_.name -match "^\d{6}([a-zA-Z]{3}|x31)$"} | where {$_.lastwritetime -lt (get-date.adddays(-90)} 
```

我得到错误：

```
You must provide a value expression on the right-hand side of the -lt operator
At line: 1 char: 96
+ get-childitem | where {$_.name -match "^\d{6}([a-zA-Z]{3}|x31)$"} | where {$_.lastwritetime -lt  <<<< get-date.adddays(-90)} 
```

我也尝试了以下方法，但没有奏效：

```
get-childitem | where {$_.name -match "^\d{6}([a-zA-Z]{3}|x31)$"} | where {$_.lastwritetime -lt (get-date | foreach-object {$_.adddays(-90)}) } 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-30T21:50:32.433

你需要做`(get-date).AddDays(-90)`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T21:50:37.533

试试这个 -`get-childitem | where {$_.name -match "^\d{6}([a-zA-Z]{3}|x31)$"} | where {$_.lastwritetime -lt (get-date).adddays(-90)}`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-31T16:28:15.547

您可以使用一个 where-object 而不是两个：

```
get-childitem | where {$_.name -match "^\d{6}([a-zA-Z]{3}|x31)$" -AND $_.lastwritetime -lt (get-date).adddays(-90)} 
```

# apache-flex - 如何为自定义 Flex 组件定义默认样式？

> ID：497359
> 
> 赞同：11
> 
> 时间：2009-01-30T21:41:00.707
> 
> 标签：apache-flex, flex3, flexbuilder

我正在创建一个新的 Flex 组件 (Flex 3)。我希望它具有默认样式。我的 .cs 文件是否有命名约定或其他内容以使其成为默认样式？我错过了什么吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-03-20T17:22:54.510

Christian 关于应用 CSS 是正确的，但是如果您计划在跨项目的库中使用该组件，您将需要为该库编写一个默认的 css 文件。这是你如何做到的：

1.  创建一个名为“defaults.css”的 css 文件（只有这个文件名可以使用！）并将其放在库的“src”文件夹下的顶层。如果 css 文件引用了任何资产，它们也必须在“src”下。
2.  （重要！）转到库项目的 Properties > Flex Library Build Path > Assets 并包含 css 文件和所有资产。

这就是 Adob​​e 团队设置所有默认样式的方式，现在您也可以这样做。刚刚想通了——巨大的

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-30T23:32:01.947

两种方式，一般。一个是直接引用类名——例如，如果您在 ActionScript 中创建了一个新组件类，或者通过使MXML`MyComponent`组件间接扩展另一个名为`MyComponent`在您的外部样式表中，前提是样式表已导入您的应用程序（例如，通过`Style source`）：

```
MyComponent
{
     backgroundColor: #FFFFFF;
} 
```

另一种方法是设置 UIComponent 的`styleName`属性（作为字符串）：

```
public class MyComponent
{
     // ...

     this.styleName = "myStyle";

     // ...
} 
```

...并像这样在 CSS 文件中定义样式（注意点符号）：

```
.myStyle
{
     backgroundColor: #FFFFFF;
} 
```

有道理？

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-02T00:24:16.507

除了 Christian Nunciato 的建议之外，另一种选择是为 Flex 组件的样式定义一个静态初始化程序。这允许您设置默认样式，而无需开发人员包含 CSS 文件。

```
private static function initializeStyles():void
{
    var styles:CSSStyleDeclaration = StyleManager.getStyleDeclaration("ExampleComponent");
    if(!styles)
    {
        styles = new CSSStyleDeclaration();
    }

    styles.defaultFactory = function():void
    {
        this.exampleNumericStyle = 4;
        this.exampleStringStyle = "word to your mother";
        this.exampleClassStyle = DefaultItemRenderer //make sure to import it!
    }

    StyleManager.setStyleDeclaration("ExampleComponent", styles, false);
}
//call the static function immediately after the declaration
initializeStyles(); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-01-14T17:28:58.467

对 joshtynjala 建议的改进：

```
public class CustomComponent extends UIComponent {
    private static var classConstructed:Boolean = classConstruct();

    private static function classConstruct():Boolean {
        if (!StyleManager.getStyleDeclaration("CustomComponent")) {
            var cssStyle:CSSStyleDeclaration = new CSSStyleDeclaration();
            cssStyle.defaultFactory = function():void {
                this.fontFamily = "Tahoma";
                this.backgroundColor = 0xFF0000;
                this.backgroundAlpha = 0.2;
            }
            StyleManager.setStyleDeclaration("CustomComponent", cssStyle, true);
        }
        return true;
    }
} 
```

我在某处的文档中读过这个；classContruct 方法被自动调用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-08-10T21:15:19.753

您可能希望使用`<fx:Style>`标签或类似标签覆盖默认样式。如果是这种情况，则在检查 classConstructed 时可能已经存在 CSSStyleDeclaration。这是一个解决方案：

```
private static var classConstructed:Boolean = getClassConstructed ();
private static function getClassConstructed ():Boolean {
  var defaultCSSStyles:Object = {
    backgroundColorGood: 0x87E224, 
    backgroundColorBad: 0xFF4B4B, 
    backgroundColorInactive: 0xCCCCCC, 
    borderColorGood: 0x333333, 
    borderColorBad: 0x333333, 
    borderColorInactive: 0x666666, 
    borderWeightGood: 2, 
    borderWeightBad: 2, 
    borderWeightInactive: 2
  };
  var cssStyleDeclaration:CSSStyleDeclaration = FlexGlobals.topLevelApplication.styleManager.getStyleDeclaration ("StatusIndicator");
  if (!cssStyleDeclaration) {
    cssStyleDeclaration = new CSSStyleDeclaration ("StatusIndicator", FlexGlobals.topLevelApplication.styleManager, true);
  }
  for (var i:String in defaultCSSStyles) {
    if (cssStyleDeclaration.getStyle (i) == undefined) {
      cssStyleDeclaration.setStyle (i, defaultCSSStyles [i]);
    }
  }
  return (true);
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-04-23T03:38:52.513

要创建默认样式，您还可以在类中拥有一个属性并覆盖 UIComponent 中的 styleChanged() 函数，例如，仅在组件宽度的一半上绘制背景颜色：

```
// this metadata helps flex builder to give you auto complete when writing
// css for your CustomComponent
[Style(name="customBackgroundColor", type="uint", format="color", inherit="no")]

public class CustomComponent extends UIComponent {

    private static const DEFAULT_CUSTOM_COLOR:uint = 0x00FF00;

    private var customBackgroundColor:uint = DEFAULT_CUSTOM_COLOR;

    override public function styleChanged(styleProp:String):void
    {
        super.styleChanged(styleProp);

        var allStyles:Boolean = (!styleProp || styleProp == "styleName");

        if(allStyles || styleProp == "customBackgroundColor")
        {
            if(getStyle("customBackgroundColor") is uint);
            {
                customBackgroundColor = getStyle("customBackgroundColor");
            }
            else
            {
                customBackgroundColor = DEFAULT_CUSTOM_COLOR;
            }
            invalidateDisplayList();
        }

        // carry on setting any other properties you might like
        // check out UIComponent.styleChanged() for more examples
    }

    override protected function updateDisplayList(unscaledWidth:Number, unscaledHeight:Number):void
    {
        super.updateDisplayList(unscaledWidth, unscaledHeight);

        graphics.clear();
        graphics.beginFill(customBackgroundColor);
        graphics.drawRect(0,0,unscaledWidth/2,unscaledHeight);
    }
} 
```

您还可以为名为 invalidateDisplayList() 的 customBackgroundColor 创建一个设置器，因此您还可以通过编程方式以及通过 css 设置 customBackgroundColor 属性。

# .net - Visual Studio Team Systems 分析工具与 ANTS 或 dotTrace 等工具之间的主要区别是什么？

> ID：497374
> 
> 赞同：1
> 
> 时间：2009-01-30T21:45:21.413
> 
> 标签：.net, profiling, profiler

我试图了解 Visual Studio Team System 中内置的分析工具与 Red-Gate 和 Jet Brains 等第三方提供的分析工具之间的主要区别。

谁能提供一些链接？我很难找到一些好的比较。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T22:17:47.433

VS（和旧版本的 ANTS）是基于检查点的。在您尝试分析的任何操作之前和之后，您基本上都必须按下一个按钮。如果您错过了窗口，或者只是想查看其他内容，则必须从头开始重新开始配置文件。

新版 ANTS 呈现连续图。您可以随时选择全部或部分图表。这使您可以更轻松地专注于您感兴趣的领域以及探索该计划。

我还发现 ANTS（两个版本）使用起来更愉快。屏幕易于阅读，您可以将视图限制为特定线程，您可以查看挂墙时间与 CPU 时间（挂墙时间对于 I/O 性能问题很重要），报告看起来很漂亮，它会生成管理层可以理解的图表. 总而言之，我真的很喜欢这个工具。

# visual-studio - Visual Studio 构建事件中的管道

> ID：497377
> 
> 赞同：0
> 
> 时间：2009-01-30T21:45:57.183
> 
> 标签：visual-studio, visual-studio-2005, batch-file, pipe

我正在使用带有 SP1 的 Visual Studio 2005 Express Edition。

我有一个预链接事件，它需要调用一个程序并将其输出发送到另一个程序。

```
foo | bar 
```

从命令行或批处理文件调用时，此命令按预期工作。从 Pre-Link 事件调用该命令时会失败（即使 Pre-Link 事件调用包含该命令的单独批处理文件）。'foo' 运行并产生出现在 Visual Studio 中的输出，但此输出不会馈送到 'bar'，实际上它似乎根本不会调用 'bar'。即使当 Pre-Link 事件调用 CMD 或 NMAKE 进而调用管道命令时，也只有 'foo' 运行。

Visual Studio 是否损坏和/或我可以执行一些神秘的仪式来完成这项工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T21:52:18.060

[此处](https://stackoverflow.com/questions/410029/how-do-i-pipe-output-when-debugging-in-visual-studio-2008)为 > 运算符回答了此问题。我怀疑管道可能会发生同样的事情。

# vb6 - 如何在 VB6 PictureBox 的 Paint 事件中执行我自己的重绘？

> ID：497383
> 
> 赞同：1
> 
> 时间：2009-01-30T21:47:09.647
> 
> 标签：vb6

一位同事在尝试运行我们正在开发的 VB6 应用程序时遇到错误。错误是“480：无法创建 AutoRedraw 图像”。微软的文档说这是因为“没有足够的可用内存将 AutoRedraw 属性设置为 True。将 AutoRedraw 属性设置为 False 并在 Paint 事件过程中执行您自己的重绘或缩小 PictureBox 控件或 Form 对象。 ..”

使 PictureBox 更小不是一种选择。我很高兴“......在 Paint 事件过程中执行我自己的重绘......”，但我不知道如何去做。有人能给我指路吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T22:43:01.637

如果您不介意重写图形代码以使用 GDI API - 这可能是一项相当大的任务 - 我在2006年的 VB6 讨论组中找到了这个[线程，](http://groups.google.com/group/microsoft.public.vb.general.discussion/browse_thread/thread/ce76acf9d11173e8/20b9b5c20cbfc500?hl=en&) [Mike Sutton](http://edais.mvps.org/)在回答类似问题时说：

> VB 的后台缓冲区实现使用一个设备相关位图 (DDB) 来存储图像数据，它的大小非常有限。在较旧的操作系统上，这曾经是 ~16mb 的未压缩数据大小，在后来的操作系统上，这已被扩展，但仍然非常有限。
> 
> 解决方法是使用设备独立位图 (DIB) 并自己管理 GDI 资源，请查看我网站上的[DIB 文章](http://edais.mvps.org/Tutorials/GDI/DIB/index.html)以了解如何使用它们的示例。

我自己没试过。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T17:04:15.317

如果没有细节，这将是一个简单的答案。一般来说，大多数刚开始使用 VB6 的程序员都会使用 AutoRedraw=True 来响应某些输入。填写一些数据，点击绘制，出现在图片框中。

Draw Button 中的单击事件与您的绘图代码相关联。第一步是将绘图代码的调用移至图片的绘制事件。第二步是将所有对绘图代码的调用替换为 MyPictureBox.Refresh。刷新会强制触发该图片框的绘制事件。

您必须关注的主要问题是每次表单需要刷新时都会触发绘制事件。就像一个遮住它的窗户被移动了一样。这意味着您的绘图代码中的任何速度问题都会暴露出来。AutoRedraw=True 将您绘制的内容放入一个隐藏的位图中，PictureBox 使用该位图来显示您绘制的内容。

Paint 事件将执行绘图过程的每个步骤，因此您必须确保尽可能快。根据您的应用程序的动态程度，将出现更严重的减速问题。如果您正在显示静态图像，那么问题并没有那么严重。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T23:26:08.493

> 使 PictureBox 更小不是一种选择。我很高兴“......在 Paint 事件过程中执行我自己的重绘......”，但我不知道如何去做。有人能给我指路吗？

这很容易。您只需实现 Form 或 PictureBox 的 _Paint()-Event 并进行绘制。

因为你在问，我想我应该澄清 AutoRedraw-Propeprty 的作用。如果设置为 true，您可以以任何您想要的方式“仅绘制图像”。在多个步骤中。任何。例如，如果它需要重新绘制，因为它上面有另一个窗口，它会神奇地完成。对于绘图部分，下站点很慢。

如果 AutoRedraw 为 false，则不会发生任何魔法。Paint()-Event 将被触发，您有责任再次绘制图像。如果您的窗口不经常“无效”（例如“覆盖”），这会快得多。或者你正在画很多画。

或者您的“魔法空间”内存不足；-)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-03T22:08:24.003

在表单代码窗口中，您的控件通常有一个事件下拉框。您需要选择绘画事件：

```
Private Sub object_Paint() 
```

并填写您在 PictureBox 上绘图的代码。

# asp.net - 在 ASP.NET 中显示多个记录的多个复选框的最佳方法是什么

> ID：497389
> 
> 赞同：1
> 
> 时间：2009-01-30T21:48:51.453
> 
> 标签：asp.net, checkbox, repeater

情况如下：

我有一个包含许多 RSS 类别的数据库，而这些类别又具有许多 RSS 提要。我想以下列方式显示它们：

```
RSS Category 1
 [ ] Rss Feed 1
 [ ] Rss Feed 2
 [ ] Rss Feed 3

RSS Category 2
 [ ] Rss Feed 1
 [ ] Rss Feed 2
 [ ] Rss Feed 3 
```

其中 [ ] 代表一个复选框。

因此，每个 RSS Feed 都会根据父 RSS 类别的 id 从数据库中提取出来。我不能使用 CheckBoxList，因为每个复选框都必须包含在无序列表列表项中。我需要标记在语义上正确并且不能使用控制适配器。

我最初设想了两个嵌套转发器，外部一个数据绑定到数据库中的 RSS 类别列表，该列表显示类别标题并包含一个具有类别 ID 的隐藏控件，然后是一个内部转发器，其中包含该类别的 RSS 提要。

如何从父转发器中的隐藏字段控件访问类别 ID，以便查找正确的 RSS 源？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-01T03:42:34.907

我想你可能正在寻找这样的东西：

ASPX：

```
<asp:Repeater ID="rptOuter" runat="server" OnItemDataBound="rptOuter_ItemDataBound">
        <HeaderTemplate>
            <ul style="list-style-type: none">
        </HeaderTemplate>
        <ItemTemplate>
            <li id='<%# Eval("Id") %>'>
            <%# Eval("Category") %>
            <asp:Repeater ID="rptInner" runat="server">
                <HeaderTemplate>
                    <ul style="list-style-type: none">
                </HeaderTemplate>
                <ItemTemplate>
                    <li>
                        <asp:CheckBox ID="chkFeed" runat="server" Text='<%# Eval("Feed") %>' />
                    </li>
                </ItemTemplate>
                <FooterTemplate>
                    </ul>
                </FooterTemplate>
            </asp:Repeater>
            </li>
        </ItemTemplate>
        <FooterTemplate>
            </ul>
        </FooterTemplate>
</asp:Repeater> 
```

代码背后：

```
protected void Page_Load(object sender, EventArgs e)
{
    using (SqlConnection conn = new SqlConnection(connString))
    {
        conn.Open();
        SqlCommand cmd = new SqlCommand("SELECT id, category FROM rsscategory_tbl", conn);
        SqlDataReader rdr = cmd.ExecuteReader();
        this.rptOuter.DataSource = rdr;
        this.rptOuter.DataBind();
        rdr.Close();
    }
}

protected void rptOuter_ItemDataBound(object sender, RepeaterItemEventArgs e)
{
    if (e.Item.ItemType == ListItemType.Item ||
        e.Item.ItemType == ListItemType.AlternatingItem)
    {            
        using (SqlConnection conn = new SqlConnection(connString))
        {
            conn.Open();
            System.Data.Common.DbDataRecord rd = (System.Data.Common.DbDataRecord)e.Item.DataItem;
            SqlCommand cmd = new SqlCommand("SELECT feed FROM rssfeed_tbl WHERE categoryid = " + rd.GetInt32(rd.GetOrdinal("id")), conn);
            Repeater rptInner = (Repeater)e.Item.FindControl("rptInner");
            SqlDataReader rdr = cmd.ExecuteReader();
            rptInner.DataSource = rdr;
            rptInner.DataBind();
            rdr.Close();
        }
     }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T22:01:06.123

如果您不能使用 CheckBoxList，则必须手动处理这些值。

您可以在它们之间手动 .Controls.Add(new LiteralControl("</li><li>")) ，但这有点俗气。

您可以使用带有 TemplateColumn 的 DataGrid 来破解它，但这并不优雅。

为什么这需要在列表中？CheckBoxList 不提供您需要的功能吗？

另外，尝试 myCheckBox.Parent.Controls.FindControl("MyHiddenField").Value 。

如何从父转发器中的隐藏字段控件访问类别 ID，以便查找正确的 RSS 源？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T22:27:12.250

我有一个应用程序，我需要在其中动态创建各种不同的控件。它适用于多个复选框（或其他任何东西）。

首先，在您的 ASPX 页面上，放置“PlaceHolder”控件：

```
<asp:PlaceHolder runat="server" id="CtrlCanvas" /> 
```

现在，在您的代码中，动态创建您的控件：

```
Label aLbl = new Label {Text = "Prompt: ", ID = ("WSLabel" + counter++)};
CtrlCanvas.Controls.Add(aLbl); 
```

那是一个标签，这是一个文本框：

```
TextBox aBox = new TextBox {ID = "XTest1", Columns = 5, Text = " ", Width = 50};
CtrlCanvas.Controls.Add(aBox);
aBox.Focus(); 
```

这是一个单选框列表：

```
RadioButtonList WRRadio = new RadioButtonList { ID = "XTestRadioList1" };
WRRadio.Items.Add("Walking  &nbsp; ");
WRRadio.Items.Add("Running");
WRRadio.SelectedIndex = WalkRun;
WRRadio.RepeatColumns = 2;
CtrlCanvas.Controls.Add(WRRadio); 
```

这就是创建控件的全部内容。要获取这些值，您需要有一个命名约定，以允许您识别 ASP.NET 放在控件上的前缀。我使用“XTest”。这是一个例子：

```
foreach (string aStr in Form.AllKeys)
{
    int position = aStr.IndexOf("XTest");  // XTest is used in my controls
    if (position > 0)
    {
        // Get the *prefix* added by ASP.NET
        CtlPrefix = aStr.Substring(0, position);
        break;
    }
 } 
```

现在要获取存储在特定控件中的值很容易：

```
 string result = Form.Get(CtlPrefix + "XTest1") 
```

至少对于单选框，Get 返回选定的索引。我想你会分别命名每个复选框，这样你就可以检查 0 或 1。

希望这可以帮助！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T05:34:56.083

> 我需要标记在语义上正确并且不能使用控制适配器。

您指的是[这些适配器](http://www.codeplex.com/cssfriendly)吗？如果没有，你应该看看。您不必使用整套；编辑您的 .browser 文件以仅指定`CheckBoxListAdapter`. 它应该完全满足您的需求。这样，您可以简单地获取`Repeater`或`ListView`控制并将其数据绑定到类别列表，然后将 a`CheckBoxList`放入其中。

# sql - 计算通话时长的数学公式

> ID：497390
> 
> 赞同：7
> 
> 时间：2009-01-30T21:48:59.003
> 
> 标签：sql, math, formula, query-help

几年前我在一家电信公司工作，我不得不根据以下算法生成一个计算通话时长的公式：

*   t1 是第一个时期
*   t2 是循环周期
*   RCT 是实际通话时间（以秒为单位）
*   CD 是有效通话时长（用于计费目的）

如果 RCT 小于 t1，则 CD 等于 t1
，如果 RCT 大于 t1，则 CD = t1 + x*t2，其中 x 会将 RCT“四舍五入”到 t2 的下一个最高倍数。

该算法转换为：“前 t1 秒充电，之后每 t2 秒充电一次”。

例子：

```
t1  t2  RCT CD  
60  10  48  60
60  10  65  70
60  10  121 130
30  20  25  30
30  20  35  50
30  20  65  70 
```

你能创建一个函数/SQL来返回“通话持续时间”CD吗？

不使用 if then else ...？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-30T22:18:22.940

假设 int 列：

```
SELECT t1
    ,t2
    ,RCT
    CASE
    WHEN RCT < t1
        THEN t1 
    ELSE
        t1 + t2 * ((RCT - t1) / t2 + SIGN((RCT - t1) % t2))
    END AS CD 
```

但我猜还有一个CASE，让我看看能不能摆脱它。

仅使用整数算术（仍然不是 ANSI）：

```
SELECT  t1
       ,t2
       ,RCT
       ,CD
       ,t1 + SIGN(RCT / t1) * t2 * ((RCT - t1) / t2 + SIGN((RCT - t1) % t2)) AS CalcCD
FROM    Calls 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-30T22:38:31.633

我会使用：

```
t1 + t2*ceiling( (rct - t1 + abs(rct - t1))*1.00/(2*t2) ) 
```

或者：

```
t1 + t2*ceiling( Cast((rct - t1 + abs(rct - t1)) as float)/(2*t2) ) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-30T22:10:34.873

编辑：进一步简化，并修复 < vs <= 错误。

没有浮点并且在我可以访问的每个数据库上工作：

```
create table calls (t1 int, t2 int, rct int, cd int)

insert into calls (t1, t2, rct, cd) 
values (60, 10, 48, 60)

insert into calls (t1, t2, rct, cd) 
values (60, 10, 65, 70)

insert into calls  (t1, t2, rct, cd)
values (60, 10, 121, 130)

insert into calls  (t1, t2, rct, cd)
values (30, 20, 25, 30)

insert into calls  (t1, t2, rct, cd)
values (30, 20, 35, 50)

insert into calls  (t1, t2, rct, cd)
values (30, 20, 65, 70)

--Additional test to show that it works
insert into calls  (t1, t2, rct, cd)
values (60, 10, 70, 70)

select t1, t2, rct, cd, 
t1 + case when rct <= t1 
  then 0 
  else ( (rct-1-t1) / t2 + 1) * t2 end as CalceCD
from calls 
```

结果：

```
t1 t2 rct cd CalceCD
----------- ------------ ----------- ----------- ------ -----
60 10 48 60 60
60 10 65 70 70
60 10 121 130 130
30 20 25 30 30
30 20 35 50 50
30 20 65 70 70
60 10 70 70 70

（6 行受影响）

```

您可以自由地将函数创建为 UDF 或 SQL 环境允许清理选择的任何内容。

编辑：是的，地板和一个偏移量避免了浮动数学。

# database - 解决多对多关系

> ID：497395
> 
> 赞同：2
> 
> 时间：2009-01-30T21:49:47.613
> 
> 标签：database

有没有人有用于确定如何在关系数据库中解决多对多关系的过程或方法？这是我的场景。我有一组联系人和一组电话号码。每个联系人可以关联多个电话号码，每个电话号码可以关联多个联系人。

这种情况的一个简单示例是办公室有两名员工（e1 和 e2），一条主语音线路（v1），一条私人语音线路（v2）。e1 是 CEO，因此他们有自己的私人语音线路 v1，但也可以通过呼叫主线路 v2 并询问 CEO 来联系他们。e2 只是一个员工，只能通过调用 v2 来访问。

因此，e1 应该与 v1 & v2 相关。e2 应该与 v2 相关。相反，v1 应该与 e1 相关，而 v2 应该与 e1 & e2 相关。

这里的目标是能够运行诸如“e1 可以达到哪些数字”和“v2 可以达到哪些员工”等查询。我知道答案将涉及一个或多个中间表，但我只是可以似乎没有确定确切的架构。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-30T21:54:52.347

查询不需要任何临时表。有一个用于映射的中间表。

> ```
> numbers_tbl
> -----------
> nid   int
> number    varchar
> 
> employees_tbl
> -----------
> eid       int
> name  varchar
> 
> employee_to_phone_tbl
> -----------
> eid       int
> nid       int 
> ```

我怎么给鲍勃打电话？

> ```
> select *
> from employees_tbl e
> inner join employee_to_phone_tbl m
>   on e.eid = m.eid
> inner join numbers_tbl n
>   on m.nid = n.nid
> where e.name = 'Bob' 
> ```

如果我拨打这个号码，谁可以接听？

> ```
> select *
> from numbers_tbl n
> inner join employee_to_phone_tbl m
>   on m.nid = n.nid
> inner join employees_tbl e
>   on e.eid = m.eid
> where n.number = '555-5555' 
> ```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-30T22:01:52.333

雇员：

```
eID, eName
1, e1
2, e2 
```

电话号码：

```
pID, pNumber
1, v1
2, v2 
```

员工电话：

```
eID, pID
1, 1
1, 2
2, 2 
```

然后你内部加入。如果您需要找出在 (t-sql) 处可以达到哪些号码 e1：

```
SELECT E.eName, P.pNumber 
FROM   dbo.Employees E 
INNER JOIN dbo.EmployeePhones EP ON E.eID = EP.eID 
INNER JOIN dbo.PhoneNumbers P ON EP.pID = P.eID 
WHERE E.eName = 'e1' 
```

我相信这应该有效（现在测试它......）

编辑：我花了几分钟打字，抱歉重复......

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-30T22:36:39.190

其他人已经解释了架构，但我将解释这个概念。他们正在为您构建的名为 EmployeePhones 和 employee_to_phone_tbl 的表称为[关联实体](http://en.wikipedia.org/wiki/Associative_entity)，它是一种[弱实体](http://en.wikipedia.org/wiki/Weak_entity)。

弱实体没有自己的自然键，而是必须根据其外键来定义。存在关联实体的唯一目的是在不支持该概念的数据库中映射多对多关系。它的主键是它映射的表的分组外键。

有关关系理论的更多信息，请参阅[此链接](http://en.wikipedia.org/wiki/Entity-relationship_model)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T21:54:26.700

1.  标准化
2.  参照完整性最佳实践
3.  检查这个 - [http://statisticsio.com/Home/tabid/36/articleType/ArticleView/articleId/327/Need-Some-More-Sample-Databases.aspx](http://statisticsio.com/Home/tabid/36/articleType/ArticleView/articleId/327/Need-Some-More-Sample-Databases.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T22:12:54.043

经过多一点思考，这就是我想出的。它可能与 AviewAnew 正在考虑的方法相一致。

员工
ID（索引）
名称

编号
id（索引）
编号

关系
employees.id (index)
numbers.id (index)

* * *

员工
1：e1
2：e2

数字
1：v1
2：v2

关系
1 : 1
1 : 2
2 : 1

这是最好/唯一的方法吗？

# c++ - 模板类型定义错误

> ID：497408
> 
> 赞同：3
> 
> 时间：2009-01-30T21:54:06.343
> 
> 标签：c++, templates

谁能解释为什么这段代码会出现错误：

```
error C2039: 'RT' : is not a member of 'ConcreteTable' 
```

（至少在使用 VS2008 SP1 编译时）

```
class  Record
{
};

template <class T>
class Table
{
public:
    typedef typename T::RT Zot; // << error occurs here
};

class ConcreteTable : public Table<ConcreteTable>
{
public:
    typedef Record RT;
}; 
```

可以做些什么来修复它。谢谢！

**更新：** 感谢指出问题和所有建议。此代码段基于在现有代码库中提供可扩展点的代码，主要设计目标是减少使用此机制添加新扩展所需的工作量（键入）。

一个单独的“类型特征”样式类实际上最适合解决方案。尤其是如果样式警察不看，我什至可以将其包装在 C 样式宏中！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-30T22:22:24.803

那是因为在实例化 Table 时类 ConcreteTable 还没有实例化，所以编译器还没有看到 T::RT。我不太确定 C++ 标准究竟是如何处理这种递归的（我怀疑它是未定义的），但它并没有按照你的预期工作（这可能很好，否则事情会复杂得多——你可以用它表达一个逻辑悖论 - 就像一个 const bool 如果它为真则为假）。

## 定影

使用 typedefs，我认为您只能希望将 RT 作为附加模板参数传递，就像这样

```
template <class T, class RT>
class Table
{
public:
    typedef typename RT Zot;
};

class ConcreteTable : public Table<ConcreteTable, Record>
{
public:
    typedef Record RT;
}; 
```

如果您不坚持 RT 可用 as `Table<>::Zot`，则可以将其放在嵌套结构中

```
template <class T>
class Table
{
public:
  struct S {
    typedef typename RT Zot;
  };
};

class ConcreteTable : public Table<ConcreteTable>
{
public:
    typedef Record RT;
}; 
```

甚至是外部特征结构

```
template <class T>
struct TableTraits<T>;

template <class T>
struct TableTraits<Table<T> > {
  typedef typename T::RT Zot;
}; 
```

如果您只希望类型是方法的参数/返回类型，则可以通过模板化此方法来实现，例如。

```
void f(typename T::RT*); // this won't work

template <class U>
void f(U*); // this will 
```

所有这些操作的重点是尽可能晚地推迟对 T::RT 的需求，特别是直到 ConcreteTable 是一个完整的类之后。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T22:03:18.897

您正在尝试在完全定义类之前使用类 CponcreateTable 作为模板参数。

以下等效代码可以正常工作：

```
class  Record
{
};

template <class T>  Table
{
public:
    typedef typename T::RT Zot; // << error occurs here
};

class ConcreteTableParent
{
public:
    typedef Record RT;
};

 class ConcreteTable: public Table<ConcreteTableParent>
{
public:
...
}; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-30T22:09:19.417

为什么不做这样的事情呢？

```
class  Record
{
};

template <class T>
class Table
{
public:
    typedef typename T Zot;
};

class ConcreteTable : public Table<Record>
{
public:
    typedef Record RT;  //You may not even need this line any more
}; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T22:17:25.623

问题是ConcreteTable是根据Table来定义的，但是没有ConcreteTable的定义就不能定义Table，所以创建了一个循环定义。

看起来您设计类层次结构的方式可能存在潜在问题。我猜您正在尝试做的是提供在您的表定义中操作通用记录类型的方法，但将其留给 ConcreteTable 来定义记录类型是什么。更好的解决方案是将记录类型作为表模板的参数，并将 ConcreteTable 作为直接子类：

```
class Record {};

template <class T>
class Table {
public:
    typedef T RT;
};

class ConcreteTable : public Table<Record> {
}; 
```

现在你消除了循环依赖，Table 仍然是根据记录的类型进行抽象的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-30T22:25:57.417

请注意，编译器不允许您想做的事情。如果可能的话，您可以这样做：

```
template <class T>
class Table
{
public:
    typedef typename T::RT Zot; 
};

class ConcreteTable : public Table<ConcreteTable>
{
public:
    typedef Zot RT;
}; 
```

这将是一种类型定义无限循环。

编译器通过要求一个类在需要使用其成员之一时完全定义来阻止这种可能性；在这种情况下，Table的模板实例化点（ConcreteTable中的祖先列表）在RT的定义之前，因此不能在Table内部使用RT。

正如其他人已经说过的那样，解决方法需要有一个中间类来避免相互依赖。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-30T22:26:38.710

当`Table<ConcreteTable>`被实例化时，`ConcreteTable`仍然是一个不完整的类型。假设您想坚持使用[CRTP](http://en.wikipedia.org/wiki/Curiously_Recurring_Template_Pattern)，您可以将 Record 作为附加模板参数传递，例如：

```
class  Record
{
};

template <class T, class U>
struct Table
{
    typedef U RT;
};

struct ConcreteTable : Table<ConcreteTable, Record>
{
}; 
```

另请注意，您可以`ConcreteTable`在任何成员函数中作为完整类型访问，`Table`因为它们仅在稍后使用时才被实例化。所以这没关系：

```
struct  Record
{
};

template <class T>
struct Table
{
    void foo()
    {
      typedef typename T::RT Zot;
      Zot a; // ...
    }
};

struct ConcreteTable : Table<ConcreteTable>
{
    typedef Record RT;
};

int main()
{
    ConcreteTable tab;
    tab.foo();
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-30T22:46:35.580

我认为其他人都很好地涵盖了它，我只是想补充一点，我认为从 self 模板继承然后尝试修补以使其工作是不好的做法。我会采用不同的方法，将记录类型 (RT) 作为参数而不是 ConcreteTable 本身。如果您曾经看过 std::iterator 类，它会使用这种精确的方法：

```
template <class Category, class T, class Distance = ptrdiff_t,
      class Pointer = T*, class Reference = T&>
  struct iterator {
    typedef T         value_type;
    typedef Distance  difference_type;
    typedef Pointer   pointer;
    typedef Reference reference;
    typedef Category  iterator_category;
  }; 
```

当子类从迭代器继承时，它会这样做：

```
struct ExampleIterator : std::iterator<std::forward_iterator_tag, Example> 
```

这正是您想要做的。请注意，“RecordType”字段实际上在超类中，并通过模板参数传入。这是最好的方法，因为它在标准库中。

如果你想对 ConcreteTable 子类做更多的专门化，你总是可以覆盖 Table 中的方法，以及使用模板参数。

# javascript - 将标题层次结构生成为有序列表

> ID：497418
> 
> 赞同：7
> 
> 时间：2009-01-30T21:58:00.140
> 
> 标签：javascript, html, methodology

我一直在思考这个问题，但无法提出一个可行的解决方案。我什至不能伪编码它......

例如，假设您有一个标题结构如下的页面：

```
<h1>Heading level 1</h1>

    <h2>Sub heading #1</h2>

    <h2>Sub heading #2</h2>

        <h3>Sub Sub heading</h3>

    <h2>Sub heading #3</h2>

        <h3>Sub Sub heading #1</h3>

        <h3>Sub Sub heading #2</h3>

            <h4>Sub Sub Sub heading</h4>

    <h2>Sub heading #4</h2>

        <h3>Sub Sub heading</h3> 
```

使用 JavaScript（任何框架都可以），您将如何生成这样的列表：（使用嵌套列表）

```
<ol>
    <li>Heading level 1
        <ol>
            <li>Sub heading #1</li>
            <li>Sub heading #2
                <ol>
                    <li>Sub Sub heading</li>
                </ol>
            </li>
            <li>Sub heading #3
                <ol>
                    <li>Sub Sub heading #1</li>
                    <li>Sub Sub heading #2
                        <ol>
                            <li>Sub Sub Sub heading (h4)</li>
                        </ol>
                    </li>
                </ol>
            </li>
            <li>Sub heading #4
                <ol>
                    <li>Sub Sub heading</li>
                </ol>
            </li>
        </ol>
    </li>
</ol> 
```

每次我尝试从某种方法开始时，它都会变得非常臃肿。

解决方案需要遍历每个标题并将其放入相应的嵌套列表中——我不断对自己重复这一点，但我无法勾勒出任何东西！

即使你脑子里有一个方法，但没有时间编写它，我仍然想知道它！:)

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-31T01:51:40.917

这里的问题是没有任何好的方法可以按文档顺序检索标题。例如，jQuery 调用`$('h1,h2,h3,h4,h5,h6')`将返回您的所有标题，但所有`<h1>`s 将首先出现，然后是`<h2>`s，依此类推。当您使用逗号分隔的选择器时，没有主要框架按文档顺序返回元素。

您可以通过向每个标题添加一个公共类来解决此问题。例如：

```
<h1 class="heading">Heading level 1</h1>

    <h2 class="heading">Sub heading #1</h2>

    <h2 class="heading">Sub heading #2</h2>

        <h3 class="heading">Sub Sub heading</h3>

    <h2 class="heading">Sub heading #3</h2>

    ... 
```

现在选择器`$('.heading')`将按顺序排列它们。

以下是我将如何使用 jQuery：

```
var $result = $('<div/>');
var curDepth = 0;

$('h1,h2,h3,h4,h5,h6').addClass('heading');
$('.heading').each(function() {

    var $li = $('<li/>').text($(this).text());

    var depth = parseInt(this.tagName.substring(1));

    if(depth > curDepth) { // going deeper

        $result.append($('<ol/>').append($li));
        $result = $li;

    } else if (depth < curDepth) { // going shallower

        $result.parents('ol:eq(' + (curDepth - depth - 1) + ')').append($li);
        $result = $li;

    } else { // same level

        $result.parent().append($li);
        $result = $li;

    }

    curDepth = depth;

});

$result = $result.parents('ol:last');

// clean up
$('h1,h2,h3,h4,h5,h6').removeClass('heading'); 
```

`$result`现在应该是你的`<ol>`.

另外，请注意，这将处理 an`<h4>`后跟 an `<h1>`（一次向下移动多个级别），但它不会处理 an`<h1>`后跟 an `<h4>`（一次以上多个级别）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-30T22:14:02.870

首先，建一棵树。伪代码（因为我不精通 Javascript）：

```
var headings = array(...);
var treeLevels = array();
var treeRoots = array();

foreach(headings as heading) {
    if(heading.level == treeLevels.length) {
        /* Adjacent siblings. */

        if(heading.level == 1) {
            treeRoots[] = heading;  // Append.
        } else {
            treeLevels[treeLevels.length - 2].children[] = heading;  // Add child to parent element.
        }

        treeLevels[treeLevels.length - 1] = heading;
    } else if(heading.level > treeLevels.length) {
        /* Child. */

        while(heading.level - 1 > treeLevels.length) {
            /* Create dummy headings if needed. */
            treeLevels[] = new Heading();
        }

        treeLevels[] = heading;
    } else {
        /* Child of ancestor. */

        treeLevels.remove(heading.level, treeLevels.length - 1);

        treeLevels[treeLevels.length - 1].children[] = heading;
        treeLevels[] = heading;
    }
} 
```

接下来，我们横穿它，构建列表。

```
function buildList(root) {
    var li = new LI(root.text);

    if(root.children.length) {
        var subUl = new UL();
        li.children[] = subUl;

        foreach(root.children as child) {
            subUl.children[] = buildList(child);
        }
    }

    return li; 
} 
```

最后，将`LI`返回的 by`buildList`插入到`UL`for each`treeRoots`中。

在 jQuery 中，您可以按如下顺序获取标题元素：

```
var headers = $('*').filter(function() {
    return this.tagName.match(/h\d/i);
}).get(); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-02-13T06:46:31.717

我可以设想很多情况，你可能会过度思考这一点。在许多情况下，您实际上只需要层次结构的*外观*，而不需要实际重新生成的 HTML 层次结构本身，您可以为此做一些简单的事情：

```
#nav li.h1 { padding: 0 0 0  0px; } #nav li.h1:before { content: 'h1 '; }
#nav li.h2 { padding: 0 0 0 10px; } #nav li.h2:before { content: 'h2 '; }
#nav li.h3 { padding: 0 0 0 20px; } #nav li.h3:before { content: 'h3 '; }
#nav li.h4 { padding: 0 0 0 30px; } #nav li.h4:before { content: 'h4 '; }
#nav li.h5 { padding: 0 0 0 40px; } #nav li.h5:before { content: 'h5 '; }
#nav li.h6 { padding: 0 0 0 50px; } #nav li.h6:before { content: 'h6 '; } 
```

```
for (i=1; i<=6; i++) {
    var headers = document.getElementsByTagName('h'+i);
    for (j=0; j<headers.length; j++) {
        headers[j].className = 'h';
    }
}
var headers = document.getElementsByClassName('h');
var h1 = document.getElementsByTagName('h1')[0];
h1.parentNode.insertBefore(document.createElement('ul'),h1.nextSibling);
h1.nextSibling.id = 'nav';
for (i=0; i<headers.length; i++) {
    document.getElementById('nav').innerHTML += '<li class="'+headers[i].tagName.toLowerCase()+'">'+headers[i].innerHTML+'</li>';
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2016-02-23T05:34:33.380

这会将所有 h1-h6 标记选择到文档的 docElTgt DOM 部分，并将遵守订单标题进入 html 文档

```
var hItemsList = docElTgt.querySelectorAll('h1, h2, h3, h4, h5, h6'); 
```

可以是 docElTgt 的值的示例：

```
docElTgt = document.body;
docElTgt = anyelement.id; 
```

选择所有标题后，可以应用算法将层次结构作为其他用户显示的有序列表

# xml - 记录导致 XML 解析中断？

> ID：497420
> 
> 赞同：4
> 
> 时间：2009-01-30T21:58:25.053
> 
> 标签：xml, apache-flex, actionscript-3, logging

我看到我正在维护的 Flex 应用程序中发生了一些非常奇怪的事情。

我一直在通过它删除所有对 trace() 的调用并将其替换为对日志框架的调用（使用内置的 mx.logging 东西）。这样做之后，一些 XML 解析代码突然崩溃了，我终生无法弄清楚为什么。

这是代码：

```
private var loader:URLLoader; // created elsewhere

private function handleComplete(event:Event):void {    
  default xml namespace = com;
  xml = XML(loader.data);
  var response:XML = new XML(xml..raniResponse);
  //now handles a null response object
  if(xml && response.children().length() > 0) {
    LOG.debug("Got response.");
    var cityXML:XML = new XML(xml..city);
    var stateXML:XML = new XML(xml..stateProv);
    /* Some extra processing is done here */
  }
} 
```

使用这样的代码，在适当的 LOG.debug() 调用中，我在定义 cityXML 的行上得到以下错误：

```
TypeError: Error #1088: The markup in the document following the root element must be well-formed. 
```

如果我注释掉 LOG.debug() 调用它工作正常。

我认为我创建的自定义日志目标可能有些奇怪，所以我删除了它。目前唯一使用的目标是内置跟踪目标。

有谁知道发生了什么？为什么日志调用会破坏 XML 解析？我想不出它可以做的任何事情会破坏它。

编辑：

我做了更多的测试，它变得越来越奇怪。

我根据 David 的评论更改了代码，以使用 xml..city[0] 而不是 new XML(xml..city) 进行这两个任务。这导致稍后发生异常（在上面未显示的某些代码中，它引用了 cityXML）。所以我尝试在调试器中单步执行并注意到一些奇怪的东西。

cityXML 被设置为 null，而 stateXML 获得了正确的值。在调试器中查看 xml 对象显示了所有正确的数据，所以应该没问题。作为一项随机测试，我重新排列了代码，以便首先加载 stateXML。之后，stateXML 为空，而 cityXML 是正确的。

因此，无论在日志失败后立即发生什么分配，但在那之后发生的任何事情都可以正常工作。

这是正在解析的（经过一定程度净化的）XML：

```
<?xml version="1.0" encoding="utf-8"?>
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
  <soapenv:Body>
    <com:MyCompanyRANIv.01 xmlns:com="com:myc:rani:1:0:message" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
      <com:raniResponse>
        <com:telephonyInfo>
          <com:countryCode>1</com:countryCode>
          <com:telephoneNumber>14121234567</com:telephoneNumber>
        </com:telephonyInfo>
        <com:geoInfo>
          <com:coordinates>
            <com:latLon>
              <com:lat>40.49</com:lat>
              <com:lon>-79.92</com:lon>
            </com:latLon>
          </com:coordinates>
          <com:countryInfo>
            <com:country>
              <com:featureName>United States</com:featureName>
              <com:featureTypeDescription>United States of America</com:featureTypeDescription>
              <com:featureCode value="US" system="ISO 3166" family="Country Code" systemVer="1-alpha-2" />
            </com:country>
          </com:countryInfo>
          <com:stateProvInfo>
            <com:stateProv>
              <com:featureName>PENNSYLVANIA</com:featureName>
              <com:featureTypeDescription xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" />
              <com:featureCode family="US State Code" system="FIPS State Alpha Code" systemVer="" value="PA" />
            </com:stateProv>
          </com:stateProvInfo>
          <com:regionInfo>
            <com:region>
              <com:featureName xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" />
              <com:featureTypeDescription xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" />
              <com:featureCode family="" system="" systemVer="" value="" />
            </com:region>
          </com:regionInfo>
          <com:countyParishInfo>
            <com:countyParish>
              <com:featureName>ALLEGHENY</com:featureName>
              <com:featureTypeDescription xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" />
              <com:featureCode family="" system="" systemVer="" value="" />
            </com:countyParish>
          </com:countyParishInfo>
          <com:cityInfo>
            <com:city>
              <com:featureName>PITTSBURGH</com:featureName>
              <com:featureTypeDescription xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" />
              <com:featureCode family="" system="" systemVer="" value="" />
            </com:city>
          </com:cityInfo>
          <com:buildingInfo>
            <com:building>
              <com:featureName xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" />
              <com:featureTypeDescription xsi:nil="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" />
            </com:building>
          </com:buildingInfo>
          <com:streetAddress address="" />
        </com:geoInfo>
        <com:services host="false" wireless="false" other="false" />
      </com:raniResponse>
      <com:raniRequest>
        <com:fullyQualifiedTelephoneNumber>14121234567</com:fullyQualifiedTelephoneNumber>
      </com:raniRequest>
    </com:MyCompanyRANIv.01>
  </soapenv:Body>
</soapenv:Envelope> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T10:25:04.750

这是一个艰难的。我从未使用过日志记录类，所以我不确定问题的那一部分，但是像你一样将 XMLList 转换为 XML：

```
var cityXML:XML = new XML(xml..city); 
```

仅当 XMLList 包含单个项目时才有效，否则您会收到引用的警告。请尝试以下表格：

```
var cityXML:XML = xml..city[0]; 
```

这适用于空列表以及包含许多项目的列表。您还可以检查孩子的数量，`xml..city.length()`如果不是 1，则记录警告消息。也许这将有助于找出确切的问题。

但是，如何通过添加或删除日志调用来实现这一点让我很吃惊。

（在一个有点相关的注释中，我注意到在 switch 语句的块中声明*和*赋值给 XML 变量`case`并没有按预期工作，即简单地忽略赋值，并且不会为变量赋值。打破两行有帮助。这对我来说似乎也是一个错误，所以在 AS3 中编译 XML 相关代码可能并非一切都是正确的。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T15:45:25.647

将其发布为答案而不是编辑，因为它包含一些解决方法。

我又做了几个测试。这是第一个的相关代码：

```
LOG.debug("Got response:");
var cityXML:XML = xml..city[0];
var stateXML:XML = xml..stateProv[0]; 
```

使用调试器单步执行，cityXML 被分配为 null，而 stateXML 获得正确的值。

接下来，我尝试了这个：

```
LOG.debug("Got response:");
trace("foobar");
var cityXML:XML = xml..city[0];
var stateXML:XML = xml..stateProv[0]; 
```

有效！（为什么？！）。cityXML 和 stateXML 都得到了正确的值。

对此不满意，我尝试了另一个测试。我想也许我只需要在日志和第一次分配之间进行一些其他操作（不知道为什么，但只是在这里做实验）。所以我尝试了这个：

```
LOG.debug("Got response:");
var someDumbVariable:Number = 42;
var cityXML:XML = xml..city[0];
var stateXML:XML = xml..stateProv[0]; 
```

这没有用。因此，再进行一项测试：

```
LOG.debug("Got response:");
var cityXML:XML = xml..city[0];
cityXML = xml..city[0];
var stateXML:XML = xml..stateProv[0]; 
```

这行得通！当使用调试器单步执行时，第一个分配以 cityXML 设置为 null 结束。但是，对其的第二次分配给出了正确的值。（我尝试简单地将 cityXML 行拆分为一行上的声明和另一行上的赋值，但这并没有改变行为。2 个赋值似乎是必要的）。

另一种解决方法：

```
LOG.debug("Got response:");
if(xml.length() == 0) { return; }
var cityXML:XML = xml..city[0];
var stateXML:XML = xml..stateProv[0]; 
```

我仍然不知道为什么日志会导致这些事情发生，但似乎要么输入跟踪要么尝试分配两次都可以解决这个问题。我将继续调查，看看我是否可以找出根本原因，但至少我现在有几个不涉及删除日志记录的解决方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T15:58:52.047

唔。这看起来与我提到的问题非常相似。试试这个：将 XML 变量声明移动到函数的头部：

```
private function handleComplete(event:Event):void {    
  var cityXML:XML;
  var stateXML:XML;

  default xml namespace = com;
  xml = XML(loader.data);
  var response:XML = new XML(xml..raniResponse);
  //now handles a null response object
  if(xml && response.children().length() > 0) {
    LOG.debug("Got response.");
    cityXML = new XML(xml..city);
    stateXML = new XML(xml..stateProv);
    /* Some extra processing is done here */
  }
} 
```

（作为单独的答案发布，因为它与之前的答案有很大不同。）

# flowchart - Visual Studio .ncb 文件的内部格式

> ID：497421
> 
> 赞同：0
> 
> 时间：2009-01-30T21:58:48.157
> 
> 标签：flowchart, ncb

我已经决定我真的需要一些流程图来对我继承的一些代码进行逆向工程。我没有 VS 的 Team 版本，因此我无法将 Team 的内置功能与 Visio 一起使用。所以我想我会解析.ncb（解析器信息）文件并用点制作图表（来自graphviz.org）。那能有多难？但我找不到该文件内部的任何文档。

我真的不想使用商业应用程序来制作流程图。我见过的免费插件都假设我使用的是 C# 或 VB。但是，我使用的是 C 和 C++。

我确实尝试了具有“可视化编程流程图”工具的 Microsoft“Visual Studio 学习包”。但它似乎不适用于 C++。很近！

那么，是否有人对文件格式或其他建议有意见（保持礼貌！）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-30T22:20:38.597

我认为您没有太多机会解析 NCB 文件。它们采用专有的二进制格式，会在每个 Visual Studio 版本之间发生变化并且可能会发生变化。根据我在某处读到的内容，有可能在 VS2010 中 NCB 将被丢弃，而智能感知信息将使用 SQL Server Express 保存在普通数据库中。

您可能会考虑的另一个选择是使用其他一些工具来分析您的代码并构建图表和 UML 图表。Doxygen 在某种程度上做到了这一点，并且有大量的商业工具也能做到这一点。我对 Rational Rose（现在可能已经不存在了..）和一个名为 Together 的工具有一些个人经验。[此列表](http://en.wikipedia.org/wiki/List_of_UML_tools)可能会有所帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-25T11:36:26.993

对于“谁调用什么”、“谁继承/重载哪里”和“谁读/写全局变量”意义上的结构分析，我曾经使用 DeHydra（一个 mozilla 项目）进行分析，并使用了（www.yworks.com）图形显示。两者都是免费的。

Dehydra 在 linux 下运行，需要你的代码通过 gcc 编译。这不是一个太严重的障碍，因为 VC 可以生成 makefile，可以为 gnu make 手动修改。就我而言，需要对包含文件进行一些修补，但我最终可以得到所需的信息。

我花了 3 天时间让 DeHydra 正常工作，又花了 2 天时间来调整 makefile 和包含文件，又花了 3 天时间来调整 JavaScript 代码，这些代码在 DeHydra 中提取了所需的信息。

DeHydra + Javascript 现在在一个编译器中提供了一个包含代码结构的 graphml 文件，可以在 yed 中直接显示和交互操作。

# php - 用于阅读 PDF 的 PHP 库？

> ID：497422
> 
> 赞同：3
> 
> 时间：2009-01-30T21:59:17.657
> 
> 标签：php, pdf

你知道在 PHP 中*阅读PDF 的任何**免费*库吗，内置的 PDF 功能仅用于呈现 PDF 输出。

 ** * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-30T22:07:16.457

Zend Framework 再次引人注目：[Zend_Pdf](http://framework.zend.com/manual/en/zend.pdf.html)是一个 PDF（可移植文档格式）操作引擎。它可以加载、创建、修改和保存文档。因此，它可以帮助任何 PHP 驱动的应用程序通过修改现有模板或从头开始生成新模板来动态创建 PDF 文档。[...]

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-30T22:57:12.970

> Zend Framework 再次来袭：Zend_Pdf 是一个 PDF（可移植文档格式）操作引擎

不要忘记 Zend Pdf 适用于非 Zend 环境。大多数 Zend 组件都可以轻松插入到任何 PHP 应用程序中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-31T02:24:47.467

您可以使用[FPDI](http://www.setasign.de/products/pdf-php-solutions/fpdi/about/)阅读 pdf 并将它们翻译成fpdf

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T22:03:28.163

如果您的网络服务器是 Unix，请使用 pdftotext 实用程序将 PDF 转储为文本，然后以您想要的方式显示它。它不会有格式，但文本将可用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-14T06:38:39.020

您可以使用 phpLiveDocx 将 PDF、DOC、DOCX、RTF 等转换为 TXT。详情见[http://www.phplivedocx.org](http://www.phplivedocx.org)

# eclipse - 如何使用 Subversive 取消删除文件？

> ID：497423
> 
> 赞同：18
> 
> 时间：2009-01-30T21:59:19.123
> 
> 标签：eclipse, svn, subversive

请注意：这是一个关于**Eclipse 插件 Subversive**的问题，而不是关于 Subversion 本身的问题。请不要将标题更改为“颠覆”。

所以我删除了一个我真的不应该拥有的文件。

我已经找到了在 Eclipse/Subversive 之外恢复文件的各种方法，但我想知道是否有使用 Subversive 工具恢复文件的最佳/最容易使用/历史恢复方式。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-09-01T15:10:11.683

1.  选择项目中包含已删除文件的文件夹。
2.  右键单击，选择*团队 > 合并...*
3.  在*URL*选项卡上，将*URL*设置为同一文件夹的服务器 URL。
4.  在*Revisions*中，选择*Revisions*并输入包含删除的范围，例如 1000-1001，或使用*浏览*按钮选择它们。
5.  在*Revisions*中，启用*反向合并*
6.  单击*预览*并检查它是否显示您计划恢复的文件的已*添加条目。*
7.  单击*OK* - Eclipse在*Synchronize*视图中切换到*SVN Merge 。*
**   在*同步*视图中，右键单击所需的文件并选择*接受**   在*Synchronize*视图中，使用*Synchronize SVN*图标从*SVN Merge*切换到*SVN*，您可以在其中将恢复的文件视为传出更改。*

 ** * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-30T23:19:04.890

如果您已经提交了删除，那么现在是时候回滚到早期版本了。在 Subversion 中，您可以使用“svn merge”来执行此操作，您可以在其中“向后”从当前版本合并到以前的版本。

假设你这样做了：

```
$ svn rm file.txt
$ svn ci -m "don't need that file"
Committed revision 1325. 
```

现在您要撤消此操作并恢复旧版本 1324，即删除之前的状态（点表示“当前目录”）：

```
$ svn merge -r1325:1324 . 
```

如果您不确定是否可以先进行空运行，svn 将打印命令的输出，但实际上不执行任何操作：

```
$ svn --dry-run merge -r1325:1324 . 
```

结果应该表明文件正在被添加（再次）：

```
A file.txt 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-30T22:54:01.260

您可以切换到该文件所在的修订版。编辑/复制此文件并切换回 head revison 并在此处提交。

您还可以合并两个修订之间的更改 - 头文件和最后一个修订文件存在于存储库中，并将更改应用于您的工作副本。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-01-14T09:00:56.313

只需在文件夹上“显示历史记录”，文件就存在于其中。然后单击历史记录并找到丢失的文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T23:03:46.107

我猜你希望不求助于命令行，但如果它作为最后的手段有用，请参阅这个问题以了解如何从命令行执行此操作： [在颠覆中取消删除文件的简单方法是什么？](https://stackoverflow.com/questions/497670/whats-a-simple-way-to-undelete)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-12-19T17:37:10.407

更简单：尝试提交，Eclipse 将显示包含更改文件的对话框，单击要删除的文件，右键单击并选择“还原”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-02-10T15:55:47.103

我遇到了类似的问题，我删除了一组与几个月后想要恢复的功能相关的文件。

在我的案例中，最直接的解决方案是*在一个单独的目录中签出整个项目，就像在删除文件之前一样*。

要从 Eclipse Repository View 执行此操作，请转到您的项目，右键单击“Check Out As...”，在模式窗口中写入目标文件夹，选择已删除文件存在的过去的合适日期（奇怪，我的插件不提供选择给定版本的可能性..) 并签出。

现在您可以轻松搜索、查找和复制粘贴要恢复的文件。

# python - 从列表中删除多个元素

> ID：497426
> 
> 赞同：186
> 
> 时间：2009-01-30T21:59:38.703
> 
> 标签：python, list

是否可以同时从列表中删除多个元素？如果我想删除索引 0 和 2 处的元素，并尝试类似`del somelist[0]`, 后跟`del somelist[2]`，第二条语句实际上将 delete `somelist[3]`。

我想我总是可以先删除编号较高的元素，但我希望有更好的方法。

* * *

## 回答 #1

> 赞同：209
> 
> 时间：2015-02-24T13:36:44.773

出于某种原因，我不喜欢这里的任何答案。是的，它们有效，但严格来说，它们中的大多数都不会删除列表中的元素，是吗？（但是制作一个副本，然后用编辑后的副本替换原始副本）。

为什么不先删除较高的索引？

是否有一个原因？我会这样做：

```
for i in sorted(indices, reverse=True):
    del somelist[i] 
```

如果您真的不想向后删除项目，那么我想您应该只减少大于上次删除索引的索引值（不能真正使用相同的索引，因为您有不同的列表）或使用列表的副本（不会“删除”，而是用编辑后的副本替换原件）。

我在这里遗漏了什么，有什么理由不按相反的顺序删除吗？

* * *

## 回答 #2

> 赞同：134
> 
> 时间：2009-01-30T22:05:01.950

您可以使用`enumerate`和删除其索引与要删除的索引匹配的值：

```
indices = 0, 2
somelist = [i for j, i in enumerate(somelist) if j not in indices] 
```

* * *

## 回答 #3

> 赞同：127
> 
> 时间：2009-01-30T22:02:26.667

如果您要删除多个不相邻的项目，那么您所描述的是最好的方法（是的，请务必从最高索引开始）。

如果您的项目是相邻的，您可以使用切片分配语法：

```
a[2:10] = [] 
```

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2015-09-23T15:49:17.923

您可以`numpy.delete`按如下方式使用：

```
import numpy as np
a = ['a', 'l', 3.14, 42, 'u']
I = [0, 2]
np.delete(a, I).tolist()
# Returns: ['l', '42', 'u'] 
```

如果您不介意最后以`numpy`数组结尾，则可以省略`.tolist()`. 您还应该看到一些相当大的速度改进，使其成为更具可扩展性的解决方案。我没有对其进行基准测试，但`numpy`操作是用 C 或 Fortran 编写的编译代码。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2009-02-01T02:55:32.083

作为 Greg 答案的专业化，您甚至可以使用扩展切片语法。例如。如果要删除项目 0 和 2：

```
>>> a= [0, 1, 2, 3, 4]
>>> del a[0:3:2]
>>> a
[1, 3, 4] 
```

当然，这不包括任何任意选择，但它当然可以用于删除任何两个项目。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2009-01-30T22:09:38.917

作为一个函数：

```
def multi_delete(list_, *args):
    indexes = sorted(list(args), reverse=True)
    for index in indexes:
        del list_[index]
    return list_ 
```

在**n log(n)**时间内运行，这应该使其成为迄今为止最快的正确解决方案。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2009-01-31T02:23:39.357

那么，您本质上是想一次性删除多个元素吗？在这种情况下，下一个要删除的元素的位置将被之前删除的许多元素所抵消。

我们的目标是删除所有元音，它们被预先计算为索引 1、4 和 7。请注意，to_delete 索引按升序排列很重要，否则它将不起作用。

```
to_delete = [1, 4, 7]
target = list("hello world")
for offset, index in enumerate(to_delete):
  index -= offset
  del target[index] 
```

如果您想以任何顺序删除元素，那就更复杂了。IMO，排序`to_delete`可能比弄清楚何时应该或不应该从`index`.

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2012-09-13T20:36:53.700

我是 Python 的初学者，目前的编程至少可以说是粗糙和肮脏的，但我的解决方案是结合使用我在早期教程中学到的基本命令：

```
some_list = [1,2,3,4,5,6,7,8,10]
rem = [0,5,7]

for i in rem:
    some_list[i] = '!' # mark for deletion

for i in range(0, some_list.count('!')):
    some_list.remove('!') # remove
print some_list 
```

显然，由于必须选择“删除标记”字符，这有其局限性。

至于列表大小的性能，我确信我的解决方案是次优的。但是，它很简单，我希望能吸引其他初学者，并且可以在`some_list`具有众所周知的格式的简单情况下工作，例如，总是数字......

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2013-12-14T22:45:47.733

这是一种替代方法，它不使用 enumerate() 创建元组（如 SilentGhost 的原始答案）。

这对我来说似乎更具可读性。（如果我习惯于使用 enumerate，也许我会有不同的感觉。） CAVEAT：我还没有测试过这两种方法的性能。

```
# Returns a new list. "lst" is not modified.
def delete_by_indices(lst, indices):
    indices_as_set = set(indices)
    return [ lst[i] for i in xrange(len(lst)) if i not in indices_as_set ] 
```

注意：Python 2.7 语法。对于 Python 3，`xrange`=> `range`。

用法：

```
lst = [ 11*x for x in xrange(10) ]
somelist = delete_by_indices( lst, [0, 4, 5]) 
```

一些列表：

```
[11, 22, 33, 66, 77, 88, 99] 
```

* * *

**- - 奖金 - -**

从列表中删除多个值。也就是说，我们有要删除的值：

```
# Returns a new list. "lst" is not modified.
def delete__by_values(lst, values):
    values_as_set = set(values)
    return [ x for x in lst if x not in values_as_set ] 
```

用法：

```
somelist = delete__by_values( lst, [0, 44, 55] ) 
```

一些列表：

```
[11, 22, 33, 66, 77, 88, 99] 
```

这与之前的答案相同，但这次我们提供了要删除的 VALUES `[0, 44, 55]`。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2015-12-06T18:32:34.503

另一种使用列表索引值的列表理解方法：

```
stuff = ['a', 'b', 'c', 'd', 'e', 'f', 'woof']
index = [0, 3, 6]
new = [i for i in stuff if stuff.index(i) not in index] 
```

这将返回：

```
['b', 'c', 'e', 'f'] 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2011-08-10T18:48:23.483

这是另一种删除元素的方法。此外，如果您的列表真的很长，它会更快。

```
>>> a = range(10)
>>> remove = [0,4,5]
>>> from collections import deque
>>> deque((list.pop(a, i) for i in sorted(remove, reverse=True)), maxlen=0)

>>> timeit.timeit('[i for j, i in enumerate(a) if j not in remove]', setup='import random;remove=[random.randrange(100000) for i in range(100)]; a = range(100000)', number=1)
0.1704120635986328

>>> timeit.timeit('deque((list.pop(a, i) for i in sorted(remove, reverse=True)), maxlen=0)', setup='from collections import deque;import random;remove=[random.randrange(100000) for i in range(100)]; a = range(100000)', number=1)
0.004853963851928711 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2014-09-28T10:37:42.463

这已被提及，但不知何故，没有人能够真正做到正确。

解决`O(n)`方案是：

```
indices = {0, 2}
somelist = [i for j, i in enumerate(somelist) if j not in indices] 
```

[这与SilentGhost 的版本](https://stackoverflow.com/a/497439/1763356)非常接近，但增加了两个大括号。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2017-07-13T16:57:03.293

```
l = ['a','b','a','c','a','d']
to_remove = [1, 3]
[l[i] for i in range(0, len(l)) if i not in to_remove]) 
```

它与最高投票的答案基本相同，只是写法不同。请注意，使用 l.index() 不是一个好主意，因为它无法处理列表中的重复元素。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-09-11T16:12:03.643

remove 方法会导致列表元素的大量移位。我认为最好制作一个副本：

```
...
new_list = []
for el in obj.my_list:
   if condition_is_true(el):
      new_list.append(el)
del obj.my_list
obj.my_list = new_list
... 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2015-06-17T20:08:39.400

从技术上讲，答案是否定的，不可能同时删除两个对象。但是，可以在一行漂亮的 python 中删除两个对象。

```
del (foo['bar'],foo['baz']) 
```

将递归删除`foo['bar']`，然后`foo['baz']`

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2015-12-18T06:50:23.823

我们可以通过在按降序对索引列表进行排序后使用 for 循环遍历索引来做到这一点

```
mylist=[66.25, 333, 1, 4, 6, 7, 8, 56, 8769, 65]
indexes = 4,6
indexes = sorted(indexes, reverse=True)
for i in index:
    mylist.pop(i)
print mylist 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2016-05-08T11:43:42.927

对于 listA 中的索引 0 和 2：

```
for x in (2,0): listA.pop(x) 
```

对于要从​​ listA 中删除的一些随机索引：

```
indices=(5,3,2,7,0) 
for x in sorted(indices)[::-1]: listA.pop(x) 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2017-03-24T22:01:21.937

我想要一种方法来比较不同的解决方案，从而轻松转动旋钮。

首先我生成了我的数据：

```
import random

N = 16 * 1024
x = range(N)
random.shuffle(x)
y = random.sample(range(N), N / 10) 
```

然后我定义了我的功能：

```
def list_set(value_list, index_list):
    index_list = set(index_list)
    result = [value for index, value in enumerate(value_list) if index not in index_list]
    return result

def list_del(value_list, index_list):
    for index in sorted(index_list, reverse=True):
        del(value_list[index])

def list_pop(value_list, index_list):
    for index in sorted(index_list, reverse=True):
        value_list.pop(index) 
```

然后我用来`timeit`比较解决方案：

```
import timeit
from collections import OrderedDict

M = 1000
setup = 'from __main__ import x, y, list_set, list_del, list_pop'
statement_dict = OrderedDict([
    ('overhead',  'a = x[:]'),
    ('set', 'a = x[:]; list_set(a, y)'),
    ('del', 'a = x[:]; list_del(a, y)'),
    ('pop', 'a = x[:]; list_pop(a, y)'),
])

overhead = None
result_dict = OrderedDict()
for name, statement in statement_dict.iteritems():
    result = timeit.timeit(statement, number=M, setup=setup)
    if overhead is None:
        overhead = result
    else:
        result = result - overhead
        result_dict[name] = result

for name, result in result_dict.iteritems():
    print "%s = %7.3f" % (name, result) 
```

**输出**

```
set =   1.711
del =   3.450
pop =   3.618 
```

所以索引在 a`set`中的生成器是赢家。并且`del`稍微快一点`pop`。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2017-11-16T15:11:35.017

您可以使用以下逻辑：

```
my_list = ['word','yes','no','nice']

c=[b for i,b in enumerate(my_list) if not i in (0,2,3)]

print c 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2018-09-19T14:17:04.623

从最高索引中删除的想法的另一种实现。

```
for i in range(len(yourlist)-1, -1, -1):
    del yourlist(i) 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2009-01-30T22:10:18.523

你可以在字典上这样做，而不是在列表上。在列表中，元素是按顺序排列的。在字典中，它们仅依赖于索引。

*简单的*代码只是为了解释它：

```
>>> lst = ['a','b','c']
>>> dct = {0: 'a', 1: 'b', 2:'c'}
>>> lst[0]
'a'
>>> dct[0]
'a'
>>> del lst[0]
>>> del dct[0]
>>> lst[0]
'b'
>>> dct[0]
Traceback (most recent call last):
  File "<pyshell#19>", line 1, in <module>
    dct[0]
KeyError: 0
>>> dct[1]
'b'
>>> lst[1]
'c' 
```

在 dict 中“转换”列表的一种方法是：

```
>>> dct = {}
>>> for i in xrange(0,len(lst)): dct[i] = lst[i] 
```

逆是：

```
lst = [dct[i] for i in sorted(dct.keys())] 
```

无论如何，我认为最好从您所说的更高索引开始删除。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2009-01-30T22:13:28.173

我实际上可以想到两种方法来做到这一点：

1.  像这样对列表进行切片（这会删除第 1、3 和 8 个元素）

    somelist = somelist[1:2]+somelist[3:7]+somelist[8:]

2.  就地这样做，但一次一个：

    somelist.pop(2) somelist.pop(0)

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2016-06-19T13:28:05.587

概括来自[@sth](https://stackoverflow.com/users/56338/sth)的评论。任何实现[abc.MutableSequence](https://docs.python.org/3/library/collections.abc.html#collections.abc.MutableSequence)的类中的项目删除`list`，特别是通过`__delitem__`魔术方法完成。此方法的工作原理类似于`__getitem__`，这意味着它可以接受整数或切片。这是一个例子：

```
class MyList(list):
    def __delitem__(self, item):
        if isinstance(item, slice):
            for i in range(*item.indices(len(self))):
                self[i] = 'null'
        else:
            self[item] = 'null'

l = MyList(range(10))
print(l)
del l[5:8]
print(l) 
```

这将输出

```
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
[0, 1, 2, 3, 4, 'null', 'null', 'null', 8, 9] 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2016-09-05T10:39:38.317

仅出于这个原因导入它可能是矫枉过正，但如果你碰巧在使用`pandas`，那么解决方案简单明了：

```
import pandas as pd
stuff = pd.Series(['a','b','a','c','a','d'])
less_stuff = stuff[stuff != 'a']  # define any condition here
# results ['b','c','d'] 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2018-05-19T23:47:11.743

```
some_list.remove(some_list[max(i, j)]) 
```

避免排序成本和必须显式复制列表。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2019-10-25T18:38:11.570

到目前为止，提供的答案都没有在 O(n) 中对要删除的任意数量的索引执行列表长度上的适当删除，所以这是我的版本*：*

```
def multi_delete(the_list, indices):
    assert type(indices) in {set, frozenset}, "indices must be a set or frozenset"
    offset = 0
    for i in range(len(the_list)):
        if i in indices:
            offset += 1
        elif offset:
            the_list[i - offset] = the_list[i]
    if offset:
        del the_list[-offset:]

# Example:
a = [0, 1, 2, 3, 4, 5, 6, 7]
multi_delete(a, {1, 2, 4, 6, 7})
print(a)  # prints [0, 3, 5] 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2020-11-19T15:02:13.127

您可能只想使用 np.delete：

```
list_indices = [0, 2]
original_list = [0, 1, 2, 3]
new_list = np.delete(original_list, list_indices) 
```

输出

```
array([1, 3]) 
```

这里，第一个参数是原始列表，第二个是要删除的索引或索引列表。

在具有 ndarray 的情况下，您可以使用第三个参数：**axis**（在 ndarray 的情况下，0 表示行，1 表示列）。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2019-08-30T20:01:47.727

其中一个怎么样（我对 Python 很陌生，但它们*看起来*还不错）：

```
ocean_basin = ['a', 'Atlantic', 'Pacific', 'Indian', 'a', 'a', 'a']
for i in range(1, (ocean_basin.count('a') + 1)):
    ocean_basin.remove('a')
print(ocean_basin) 
```

['大西洋'，'太平洋'，'印度']

```
ob = ['a', 'b', 4, 5,'Atlantic', 'Pacific', 'Indian', 'a', 'a', 4, 'a']
remove = ('a', 'b', 4, 5)
ob = [i for i in ob if i not in (remove)]
print(ob) 
```

['大西洋'，'太平洋'，'印度']

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2019-12-27T13:35:42.320

我将它们放在一个`list_diff`函数中，该函数只需将两个列表作为输入并返回它们的差异，同时保留第一个列表的原始顺序。

```
def list_diff(list_a, list_b, verbose=False):

    # returns a difference of list_a and list_b,
    # preserving the original order, unlike set-based solutions

    # get indices of elements to be excluded from list_a
    excl_ind = [i for i, x in enumerate(list_a) if x in list_b]
    if verbose:
        print(excl_ind)

    # filter out the excluded indices, producing a new list 
    new_list = [i for i in list_a if list_a.index(i) not in excl_ind]
    if verbose:
        print(new_list)

    return(new_list) 
```

示例用法：

```
my_list = ['a', 'b', 'c', 'd', 'e', 'f', 'woof']
# index = [0, 3, 6]

# define excluded names list
excl_names_list = ['woof', 'c']

list_diff(my_list, excl_names_list)
>> ['a', 'b', 'd', 'e', 'f'] 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2021-09-20T12:58:11.210

使用[numpy.delete](https://numpy.org/doc/stable/reference/generated/numpy.delete.html)肯定比 python 列表快（376 倍，如下所示）。

第一种方法（使用numpy）：

```
import numpy as np

arr = np.array([0,3,5,7])
# [0,3,5,7]
indexes = [0,3]
np.delete(arr, indexes)
# [3,5] 
```

第二种方法（使用python列表）：

```
arr = [0,3,5,7]
# [0,3,5,7]
indexes = [0,3]
for index in sorted(indexes, reverse=True):
    del arr[index]
arr
# [3,5] 
```

代码在 500000 个元素的数组上对这两种方法进行基准测试，随机删除一半元素：

```
import numpy as np
import random
import time

start = 0
stop = 500000
elements = np.arange(start,stop)
num_elements = len(temp)

temp = np.copy(elements)
temp2 = elements.tolist()

indexes = random.sample(range(0, num_elements), int(num_elements/2))

start_time = time.time()

temp = np.delete(temp, indexes)

end_time = time.time()
total_time = end_time - start_time
print("First method: ", total_time)

start_time = time.time()

for index in sorted(indexes, reverse=True):
    del temp2[index]

end_time = time.time()
total_time = end_time - start_time
print("Second method: ", total_time)

# First method:  0.04500985145568848
# Second method:  16.94180393218994 
```

第一种方法比第二种方法快大约 376 倍。

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2019-11-15T18:42:51.033

您也可以使用删除。

```
delete_from_somelist = []
for i in [int(0), int(2)]:
     delete_from_somelist.append(somelist[i])
for j in delete_from_somelist:
     newlist = somelist.remove(j) 
```

# perl - 是否可以在 Perl 的哈希构造函数中定义匿名子例程？

> ID：497427
> 
> 赞同：1
> 
> 时间：2009-01-30T22:00:07.750
> 
> 标签：perl, hash, coderef

是否可以在 Perl 的哈希构造函数中定义匿名子例程？

我正在尝试做这样的事情：

```
my %array = { one   => sub { print "first $_[0]" },
              two   => sub { print "next  $_[0]" },
              three => sub { print "last  $_[0]" }};

$array{$foo}->('thing'); 
```

但它不起作用。代码似乎可以运行和编译，但数组中的值是空白的。如果我这样做：

```
my %array;

$array{'one'}   = sub { print "first $_[0]" };
$array{'two'}   = sub { print "next  $_[0]" };
$array{'three'} = sub { print "last  $_[0]" };

$array{$foo}->('thing'); 
```

然后它似乎工作正常。所以我有一个解决方法，但这只是让我烦恼，我想知道是否有人知道这是否可能，如果有，语法是什么。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-30T22:06:47.580

看起来您错误地分配到哈希中。Using`{}`构造了一个匿名哈希引用，您将其分配给一个标量。但是您分配给一个命名的哈希 ( `%array`)。

您需要分配一个标量：

```
my $array = { one   => sub { print "first $_[0]" },
              two   => sub { print "next  $_[0]" },
              three => sub { print "last  $_[0]" }};

$array->{$foo}->('thing'); 
```

或者不使用匿名构造函数语法：

```
my %array = ( one   => sub { print "first $_[0]" },
              two   => sub { print "next  $_[0]" },
              three => sub { print "last  $_[0]" });

$array{$foo}->('thing'); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-30T22:06:33.150

那是因为在第一种情况下，您创建的是 hashref 而不是哈希，您想要的是：

```
my $array;
$array = { one => ... }; # not %array = { .. };
...
$array->{one}->('thing'); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-30T23:21:41.143

Greg Hewgill 走在正确的轨道上。始终启用`strict`编译指示。此外，始终启用警告——但我建议不要在代码中使用 -w 开关。

相反，请利用`use warnings`pragma。这样，您可以在代码的词法范围区域中选择性地禁用特定的警告组。

例如：

```
use strict;
use warnings;

foo('bar');
foo();

sub foo {
    no warnings 'uninitialized';

    my $foo = shift || 'DEFAULT';

    print "Foo is $foo\n";
} 
```

始终使用 strict 和 warnings 编译指示将为您节省数小时的时间。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-30T22:34:28.193

不久前，我花了大约两个小时试图在脚本中找出这个[确切的大括号对括号问题。](http://hewgill.com/journal/entries/466-stupid-perl)如果您使用`-w`切换到 Perl，那么您将收到一条警告“在预期偶数大小列表的位置找到引用”，这至少提供了在哪里查找的线索。今天，所有 Perl 脚本都应该以：

```
#!/usr/bin/perl -w

use strict; 
```

您的 Perl 生活将变得无比沮丧。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-30T22:10:19.647

它应该是括号，而不是花括号：

```
my %array = ( one   => sub { print "first $_[0]" },
              two   => sub { print "next  $_[0]" },
              three => sub { print "last  $_[0]" }}); 
```

'{ a => 1, b => 2 }' 产生对哈希的引用。所以以下也可以工作：

```
my $array = { one   => sub { print "first $_[0]" },
              two   => sub { print "next  $_[0]" },
              three => sub { print "last  $_[0]" }};

$array->{one}->('thing'); 
```

# c# - 如何将 .NET 中的 RSA 公钥导入 OpenSSL

> ID：497428
> 
> 赞同：3
> 
> 时间：2009-01-30T22:00:37.233
> 
> 标签：c#, c++, openssl, rsa

我有一个 .NET 程序和一个 Borland Win32 程序，它们需要传递一些加密安全信息。现在的计划是让 .NET 应用程序创建一个公钥/私钥对，将公钥存储在磁盘上，并在 .NET 程序运行期间将私钥保存在内存中。

然后 Borland 应用程序将从磁盘读取公钥并使用 OpenSSL 库使用公钥加密数据并将结果写入磁盘。

最后，.NET 应用程序将读取加密数据并使用私钥对其进行解密。

从 .NET 导出密钥然后将其导入 OpenSSL 库的最佳方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-02T21:08:47.523

在 .NET 程序中创建一个新的`RSACryptoServiceProvider`. 将公钥导出为`RSAParameters`并将`Modulus`和`Exponent`值写入磁盘。像这样：

```
RSACryptoServiceProvider rsa = new RSACryptoServiceProvider(4096); //4096 bit key
RSAParameters par = rsa.ExportParameters(false); // export the public key

File.WriteAllBytes(@"C:\modulus.bin", par.Modulus); // write the modulus and the exponent to disk
File.WriteAllBytes(@"C:\exponent.bin", par.Exponent); 
```

在 C++ 端，您需要从磁盘读取模数和指数值，将它们转换为`BIGNUM`值。这些值将被加载到 RSA 密钥中，然后您可以加密纯文本并将密文写入磁盘。像这样：

```
RSA * key;

unsigned char *modulus; 
unsigned char *exp; 

FILE * fp = fopen("c:\\modulus.bin", "rb"); // Read the modulus from disk
modulus = new unsigned char[512];
memset(modulus, 0, 512);
fread(modulus, 512, 1, fp);
fclose(fp);

fp = fopen("c:\\exponent.bin", "rb"); // Read the exponent from disk
exp = new unsigned char[3];
memset(exp, 0, 3);
fread(exp, 3, 1, fp);
fclose(fp);

BIGNUM * bn_mod = NULL;
BIGNUM * bn_exp = NULL;

bn_mod = BN_bin2bn(modulus, 512, NULL); // Convert both values to BIGNUM
bn_exp = BN_bin2bn(exp, 3, NULL);

key = RSA_new(); // Create a new RSA key
key->n = bn_mod; // Assign in the values
key->e = bn_exp;
key->d = NULL;
key->p = NULL;
key->q = NULL;

int maxSize = RSA_size(key); // Find the length of the cipher text

cipher = new char[valid];
memset(cipher, 0, valid);
RSA_public_encrypt(strlen(plain), plain, cipher, key, RSA_PKCS1_PADDING); // Encrypt plaintext

fp = fopen("C:\\cipher.bin", "wb"); // write ciphertext to disk
fwrite(cipher, 512, 1, fp);
fclose(fp); 
```

最后，您可以毫无困难地获取密文并在 C# 中对其进行解密。

```
byte[] cipher = File.ReadAllBytes(@"c:\cipher.bin"); // Read ciphertext from file
byte[] plain = rsa.Decrypt(cipher, false); // Decrypt ciphertext

Console.WriteLine(ASCIIEncoding.ASCII.GetString(plain)); // Decode and display plain text 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-02T12:50:45.500

[您可以通过OpenSSL.NET](http://openssl-net.sourceforge.net)包装器直接在 C# 中使用 OpenSSL ！

# .net - 反思：为自动化测试走一堂课

> ID：497447
> 
> 赞同：1
> 
> 时间：2009-01-30T22:08:53.643
> 
> 标签：.net, unit-testing, reflection

我有存储数据的类，以及获取个人贷款数据的方法。

我有遍历属性并将数据拉回的代码，但根据 MSDN 编码指南，属性只是应该获取数据，而不是做任何事情。我的属性实际上移动到大型机上的屏幕并抓取数据。因此，当我将鼠标悬停在某个属性上或将鼠标移到调试器中的代码上时，有时它会触发，改变我所在的大型机中的屏幕。所以我想改变我的反射步行器也能够拉返回函数结果并将未缓冲的数据更改为函数。

```
Public Function GetAllReadableProperties(ByVal obj As Object) As String
        Dim result As New System.Text.StringBuilder(300)

        For Each Item As System.Reflection.PropertyInfo In obj.GetType.GetProperties()
            With Item
                If .CanRead Then
                    result.Append(.Name + ":")
                    If .GetIndexParameters().Length = 0 Then
                        Dim value As Object = .GetValue(obj, Nothing)
                        If value Is Nothing Then
                            result.AppendLine("<Nothing>")
                        Else
                            result.AppendLine(value.ToString)
                        End If
                    Else
                        result.AppendLine("Indexed")
                    End If
                End If
            End With
        Next
        Return result.ToString
    End Function 
```

我也将如何走这些方法？将某些功能标记为默认行走或默认不行走的最简单方法是什么？自定义属性？

此代码是否适用于传入的结构而不是类？

当我走得更远时，我想将其编码为构建 datagridview 显示的数据表。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T22:23:35.050

重新将鼠标悬停，也许`[DebuggerBrowsable(DebuggerBrowsableState.Never)]`？

但是，也许更好的方法是遵循指南，并使属性具有幂等性，并使用填充它们的方法？即在将对象传递给网格之前调用“填充”方法（告诉它您需要知道的内容）。

对于一个结构......好吧，一个结构应该（除了非常具体的原因）总是不可变的。所以延迟加载结构几乎是矛盾的。您可能会冒着忘记这里发生的事情的风险......简短版本：使其成为一个类（很可能是一个`IDisposable`，并且可能有一个终结器）。

# haskell - 类定义中的管道是什么意思？

> ID：497449
> 
> 赞同：33
> 
> 时间：2009-01-30T22:09:10.960
> 
> 标签：haskell, syntax, types, typeclass, functional-dependencies

```
class (Monoid w, Monad m) => MonadWriter w m | m -> w where 
   pass   :: m (a,w -> w) -> m a 
   listen :: m a -> m (a,w) 
   tell   :: w -> m () 
```

上面的管道是什么意思？片段来自[这里](http://www.haskell.org/all_about_monads/html/writermonad.html)。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-30T22:26:39.660

实际上，它是一种“[功能依赖](http://en.wikibooks.org/wiki/Haskell/Advanced_type_classes#Functional_dependencies)”。在这种情况下，这意味着`m`唯一标识`w`——类型`m`决定类型`w`。（[这](http://www.haskell.org/haskellwiki/Functional_dependencies)可能是一个更好的链接。）

# ant - subant failonerror 微妙之处

> ID：497452
> 
> 赞同：4
> 
> 时间：2009-01-30T22:09:53.627
> 
> 标签：ant

我有启动所有子目录中的发布版本的 ant 代码：

```
<target name="all-release" >
    <subant target="sub-release" failonerror="true">
        <fileset dir="." includes="*/build.xml" />
    </subant>
</target> 
```

如前所述，如果任何单个构建失败，all-release 将很快失败（以后的构建都不会成功。如果我切换 failonerror="false"，则 all-release 将一直成功。事实证明，所有子-builds 是独立的，所以我真正想要的是：

运行所有子版本构建，然后如果一个或多个子版本失败（理想情况下带有关于哪些构建失败的好错误消息），则所有发布失败。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-10-21T22:28:50.813

建议您查看[ant-contrib](http://ant-contrib.sourceforge.net/)任务中可用的扩展。

'for' 任务可能会根据您的要求进行调整。

带有 ant-contrib taskdef 的“全部发布”目标可能如下所示：

```
<taskdef resource="net/sf/antcontrib/antlib.xml">
    <classpath>
        <pathelement location="lib/ant-contrib-1.0b3.jar"/>
    </classpath>
</taskdef>

<target name="all-release">
    <for keepgoing="true" param="file">
        <path>
            <fileset dir="." includes="*/build.xml" />
        </path>
        <sequential>
            <ant antfile="@{file}" target="sub-release" />
        </sequential>
    </for>
</target> 
```

使用其他一些 ant-contrib 功能可能会获得失败列表。

来自上述 build.xml 的示例日志：

```
$ ant all-release
Buildfile: build.xml

all-release:
     [echo] /work/Scratch/dir1/build.xml

sub-release:
     [echo] dir1
     [echo] /work/Scratch/dir2/build.xml

sub-release:
     [echo] dir2
      [for] /work/Scratch/dir2/build.xml: The following error occurred while executing this line:
      [for] /work/Scratch/build.xml:17: The following error occurred while executing this line:
      [for] /work/Scratch/dir2/build.xml:6: dir2 failed
     [echo] /work/Scratch/dir3/build.xml

sub-release:
     [echo] dir3

BUILD FAILED
/work/Scratch/build.xml:11: Keepgoing execution: 1 of 3 iterations failed.

Total time: 0 seconds 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-29T14:02:14.457

[Antelope](http://antelope.tigris.org/) Ant 扩展有一个`try-catch`命令可以用来满足你的需要：

```
<taskdef name="try" classname="ise.antelope.tasks.TryTask"/>
....
<try break="false" printmessage="true" >
   <antcall target="xmlValidate" />
   <antcall target="runJunit" />
   <antcall target="..." />
   <catch>
      <property name="haderrors" value="true"/>
   </catch>
</try>
<fail message="FAILED" if="haderrors" /> 
```

`break=false`让我们在失败后继续下一个命令。但是失败的目标设置了`haderrors`最后检查的属性。我经常用它来构建工作（它工作正常），但我不确定它是否适用于`<fileset>`inside `<subant>`。也许您必须`<subant>`明确列出所有调用。

# installation - WinCE CabWiz 错误：“inf 包含不受支持的 DirID”

> ID：497453
> 
> 赞同：2
> 
> 时间：2009-01-30T22:09:56.077
> 
> 标签：installation, windows-ce, cab, cabwiz

在为我们的产品构建 windows mobile cab 时，windows CE CAB 向导 (CabWiz.exe) 有时会返回错误：

> 错误：文件 c:\docume~1\build\locals~1\temp\wiz3340.inf 包含不受支持的 DirID

当使用超过 998 个文件、~260 个目录或未转义 % 符号（使用另一个 %）时，可能会发生此错误，但这些不适用于我们的案例。

有没有人遇到过这个问题？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-19T12:01:17.817

我今天遇到了这个问题，并为我找到了一个在这里工作的解决方案：

[https://web.archive.org/web/20100330064330/http://blogs.msdn.com/raffael/archive/2008/03/18/x-inf-contains-dirids-which-are-not-supported。 aspx](https://web.archive.org/web/20100330064330/http://blogs.msdn.com/raffael/archive/2008/03/18/x-inf-contains-dirids-which-are-not-supported.aspx)

> 所以我想：好的，他达到了可以打包在 CAB 中的 998 个文件的已知限制......错误：当使用更少的文件时也发生了问题，比如 300...... Program Files\Microsoft Visual Studio 9.0\SmartDevices\SDK\SDKTools\CabWiz.exe，版本 4.0.4332.0。
> 
> 运行一些测试后，我达到了一个神奇的数字：262。使用 262 个文件 VS2008 可以成功创建智能设备 CAB，使用 263 个文件它给出错误“x.inf 包含不支持的 DirID”。此时我注意到，在 VS2008 创建并提供给 CabWiz.exe 的 .INF 文件中，它在 [DestinationDirs] 下为每个添加的文件编写了一个条目，即使设备上的目标文件夹与它在我的情况。通过手动编辑 INF（使用一些自动创建行的应用程序......），我可以成功地为 263+ 个文件创建 CAB，在 [DestinationDirs] 下仅指定一个条目。所以，我不知道的另一个限制是：VS2008 的 CabWiz 可以在 [DestinationDirs] 下解析多达 262 个不同的条目。
> 
> 现在：Windows Mobile 6 SDK 附带了较新版本的 CabWiz.exe，v4.5.5102.0，而且非常有趣的是，它不仅克服了 998 个文件的限制，而且还克服了 [DestinationDirs] 下大约 262 个条目的限制。因此，在这种情况下，“简单”的解决方案是下载 2 个 Windows Mobile 6 SDK 之一并使用该 CabWiz.exe (C:\Program Files\Windows Mobile 6 SDK\Tools\CabWiz)。

# c# - 确定 MS 项目任务沿袭

> ID：497454
> 
> 赞同：0
> 
> 时间：2009-01-30T22:10:05.107
> 
> 标签：c#, office-interop, ms-project

我有一个 MS 项目文件，我正在使用主互操作程序集进行解析。如何确定任务的沿袭？我依赖于 WBS 代码，但是客户端已经开始摆弄这个字段，它不再代表数据的层次结构。

编辑：通过血统，我的意思是一种确定任务存在于层次结构中的位置的方法。默认情况下，WBS 代码完美地模仿了这一点。

我需要这些信息来确定任务的父级。

例子

*   一种
*   乙
    *   B1
    *   B2
    *   B3
*   C

B3 的血统为 2.3（如果我们按 1 计数，如项目）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T22:38:29.810

尝试 Task 对象的 OutlineNumber 属性和 PredecessorTasks 集合。

HTM

科尔比非洲

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-02-25T17:58:00.517

使用“OutlineChildren”属性：

```
// from caller:
ListTasks(prj.OutlineChildren, "");

void ListTasks(Tasks lst, string indent)
{
    foreach (Microsoft.Office.Interop.MSProject.Task t in lst) {
        Log(indent + t.Start + " - " + t.Name);
        ListTasks(t.OutlineChildren, indent + "    ");
    }
} 
```

它创建缩进的任务树。

# ldap - 由于单引号导致 LDAP 查询失败

> ID：497461
> 
> 赞同：2
> 
> 时间：2009-01-30T22:11:55.197
> 
> 标签：ldap, quotes

我正在尝试使用以下 c# 代码在 Active Directory 中查找员工：

```
"Select userPrincipalName, ADsPath, Department, Mail,
 HomeMDB, cn, ssn FROM 
'LDAP://" + DomainName + "'
WHERE objectCategory = 'person' and 
sAMAccountName = '" + UserName.Replace("'", "''") + "'"; 
```

当我为姓氏中带有单引号的员工（例如“O'Connor”）运行此命令时，我收到以下错误：

**AdsDsoObject' 失败，没有可用的错误消息，结果代码：DB_E_NOTABLE(0x80040E37)。**

```
I also tried Replace("'", "\''"), nothing is working. 
```

我究竟做错了什么？需要帮忙。

谢谢你！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T20:31:11.780

在自己的线路上进行替换。

```
Username.Replace("'", "\'");

"Select userPrincipalName, ADsPath, Department, Mail, HomeMDB, cn, ssn FROM 
'LDAP://" + DomainName + "' WHERE objectCategory = 'person' and 
sAMAccountName = '" + UserName + "'"; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T22:20:17.273

你试过：

```
Replace("'", "\''") 
```

并不是：

```
Replace("'", "\'") 
```

（那里有一个额外的单引号）。

# sql - 有没有办法同时选择和更新行？

> ID：497464
> 
> 赞同：54
> 
> 时间：2009-01-30T22:12:38.973
> 
> 标签：sql, sql-server, tsql, sql-server-2008

我想根据一个简单的标准更新一组行并获取已更改的 PK 列表。我以为我可以做这样的事情，但我担心可能的并发问题：

```
SELECT Id FROM Table1 WHERE AlertDate IS NULL;
UPDATE Table1 SET AlertDate = getutcdate() WHERE AlertDate IS NULL; 
```

如果它包含在事务中，是否会出现任何并发问题？还是有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2009-01-30T22:16:07.950

考虑查看[OUTPUT 子句](http://msdn.microsoft.com/en-us/library/ms177564.aspx)：

```
USE AdventureWorks2012;  
GO  

DECLARE @MyTableVar table(  
    EmpID int NOT NULL,  
    OldVacationHours int,  
    NewVacationHours int,  
    ModifiedDate datetime);  

UPDATE TOP (10) HumanResources.Employee  
SET VacationHours = VacationHours * 1.25,  
    ModifiedDate = GETDATE()   
OUTPUT inserted.BusinessEntityID,  
       deleted.VacationHours,  
       inserted.VacationHours,  
       inserted.ModifiedDate  
INTO @MyTableVar;  

--Display the result set of the table variable.  
SELECT EmpID, OldVacationHours, NewVacationHours, ModifiedDate  
FROM @MyTableVar;  
GO  
--Display the result set of the table.  
SELECT TOP (10) BusinessEntityID, VacationHours, ModifiedDate  
FROM HumanResources.Employee;  
GO 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2015-09-09T15:50:50.767

许多年后...

使用 OUTPUT 子句的公认答案很好。我不得不挖掘实际的语法，所以这里是：

```
DECLARE @UpdatedIDs table (ID int)
UPDATE 
    Table1 
SET 
    AlertDate = getutcdate() 
OUTPUT
    inserted.Id
INTO
    @UpdatedIDs
WHERE 
    AlertDate IS NULL; 
```

**2015**年 9 月 14 日添加：

“我可以使用标量变量而不是表变量吗？” 有人可能会问......对不起，但不，你不能。`SELECT @SomeID = ID from @UpdatedIDs`如果您需要一个 ID ，则必须这样做。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-01-30T22:31:07.610

处理此问题的一种方法是在事务中执行此操作，并使您的 SELECT 查询对所选行进行更新锁定，直到事务完成。

```
BEGIN TRAN

SELECT Id FROM Table1 WITH (UPDLOCK)
WHERE AlertDate IS NULL;

UPDATE Table1 SET AlertDate = getutcdate() 
WHERE AlertDate IS NULL;

COMMIT TRAN 
```

这消除了并发客户端更新在您的 SELECT 和 UPDATE 之间选择的行的可能性。

当您提交事务时，更新锁将被释放。

处理此问题的另一种方法是使用 FOR UPDATE 选项为您的 SELECT 声明一个游标。然后更新光标的当前位置。以下内容未经测试，但应该为您提供基本思路：

```
DECLARE cur1 CURSOR FOR
  SELECT AlertDate FROM Table1 
  WHERE AlertDate IS NULL
  FOR UPDATE;

DECLARE @UpdateTime DATETIME

SET @UpdateTime = GETUTCDATE()

OPEN cur1;

FETCH NEXT FROM cur1;

WHILE @@FETCH_STATUS = 0
BEGIN

  UPDATE Table1 
  SET AlertDate = @UpdateTime  --set value
  WHERE CURRENT OF cur1;

  FETCH NEXT FROM cur1;

END 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-01-30T22:15:54.160

首先进行更新然后运行'SELECT ID FROM INSERTED'会更容易。

查看[SQL Tips](http://blogs.msdn.com/sqltips/archive/2005/06/13/OUTPUT-clause.aspx)以获取更多信息和示例。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-01-30T22:37:35.833

也许更像这样？

```
declare @UpdateTime datetime

set @UpdateTime = getutcdate()

update Table1 set AlertDate = @UpdateTime where AlertDate is null

select ID from Table1 where AlertDate = @UpdateTime 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-07-12T17:38:45.160

我也遇到过同样的问题；我必须更新信用额度，并且必须从 DB 获取修改时间以及信用详细信息。基本上是

在 MYSQL 中同步/原子执行（先更新然后获取）

我尝试了很多选项，并找到了一个可以解决我的问题的选项。

1) OPTION_1 选择更新

这是保持锁定直到更新（从 GET 到 UPDATE 的同步），但我需要在更新后锁定直到 GET。

2) OPTION_2 存储过程

存储过程不会像 redis lua 那样同步执行，所以我们还需要同步代码来执行。

3) OPTION_3 交易

我已经使用了如下的 JPA entityManager，认为在提交之前没有人可以更新，并且在提交之前我将获得更新的对象以及修改时间（来自 DB）。但我没有得到最新的对象。只有提交我得到了最新的。

```
 try {
        entityManager.getTransaction().begin();
        //entityManager.persist(object);
        int upsert = entityManager.createNativeQuery(
        "update com.bill.Credit c set c.balance = c.balance - ?1
          where c.accountId = ?2 and c.balance >= ?1").executeUpdate(); 
             //c.balance >= ? for limit check
        Credit newCredit = entityManager.find(Credit.class, "id");
        entityManager.refresh(newCredit); //SHOULD GET LATEST BUT NOT
        entityManager.getTransaction().commit();
    } finally {     
        entityManager.unwrap(Session.class).close();
    } 
```

4) OPTION_4 LOCK 解决了这个问题，所以在更新之前我获得了锁；然后在 GET 之后我释放了锁。

```
private Object getLock(final EntityManager entityManager, final String Id){

    entityManager.getTransaction().begin();
    Object obj_acquire = entityManager.createNativeQuery("SELECT GET_LOCK('" + Id + "', 10)").getSingleResult();
    entityManager.getTransaction().commit();
    return obj_acquire;
}

private Object releaseLock(final EntityManager entityManager, final String Id){

    entityManager.getTransaction().begin();
    Object obj_release = entityManager.createNativeQuery("SELECT RELEASE_LOCK('" + Id + "')").getSingleResult();
    entityManager.getTransaction().commit();
    return obj_release;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-30T22:26:02.220

编辑：我的错，您希望选择在更新后显示结果，而不是从选择中更新。

您是否尝试过子选择？

```
update mytable set mydate = sysdate 
where mydate in (select mydate from mytable where mydate is null); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-30T22:16:44.907

如果它在事务内部，数据库锁定系统将处理并发问题。当然，如果你使用一个（mssql默认是它使用锁，所以它说明你是否不覆盖它）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-02T14:32:19.290

在 SQL 2008 中，引入了一个新的 TSQL 语句“MERGE”，它根据与源表连接的结果对目标表执行插入、更新或删除操作。您可以通过根据在另一个表中发现的差异在一个表中插入、更新或删除行来同步两个表。

[http://blogs.msdn.com/ajaiman/archive/2008/06/25/tsql-merge-statement-sql-2008.aspx](http://blogs.msdn.com/ajaiman/archive/2008/06/25/tsql-merge-statement-sql-2008.aspx) [http://msdn.microsoft.com/en-us/library/bb510625.aspx](http://msdn.microsoft.com/en-us/library/bb510625.aspx)

# c++ - 加倍到十六进制字符串和十六进制字符串加倍

> ID：497472
> 
> 赞同：6
> 
> 时间：2009-01-30T22:14:13.290
> 
> 标签：c++, c, double, hex

我要做的是将双精度转换为十六进制字符串，然后再转换为双精度。

以下代码将双精度字符串转换为十六进制字符串。

```
char * double2HexString(double a)
{
   char *buf = new char[17]; // double is 8-byte long, so we have 2*8 + terminating \0
   char *d2c;
   d2c = (char *) &a;
   char *n = buf;
   int i;
   for(i = 0; i < 8; i++)
   {
      sprintf(n, "%02X", *d2c++);
      n += 2;
   } 
   *(n) = '\0';
} 
```

这似乎可行，但是，我不确定如何将结果字符串转换回双精度。请指教 ：）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2013-08-22T09:45:38.990

我很惊讶没有人提出标准解决方案，即`%a`ISO C99 标准中的格式说明符。

```
#include <iostream>
#include <string>
#include <stdio.h>

std::string double2hexastr(double d) {

  char buffer[25] = { 0 };

  ::snprintf(buffer, 25, "%A", d); // TODO Check for errors

  return buffer;
}

double hexastr2double(const std::string& s) {

  double d = 0.0;

  ::sscanf(s.c_str(), "%lA", &d); // TODO Check for errors

  return d;
}

int main() {

  std::cout << "0.1 in hexadecimal: " << double2hexastr(0.1) << std::endl;

  std::cout << "Reading back 0X1.999999999999AP-4, it is ";

  std::cout << hexastr2double("0X1.999999999999AP-4") << std::endl;

} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-30T22:29:28.080

```
char *doubleToRawString(double x) {
    const size_t bytesInDouble = 8;

    union {
        double value;
        unsigned char bytes[bytesInDouble];
    } u;

    u.value = x;

    char *buffer = new char[bytesInDouble * 2 + 1];
    unsigned char *input = u.bytes;
    char *output = buffer;

    for(int i = 0; i < bytesInDouble; ++i) {
        sprintf(output, "%02hhX", *input);

        ++input;
        output += 2;
    }

    return buffer;
}

double rawStringToDouble(const char *input) {
    const size_t bytesInDouble = 8;

    union {
        double value;
        unsigned char bytes[bytesInDouble];
    } u;

    unsigned char *output = u.bytes;

    for(int i = 0; i < bytesInDouble; ++i) {
        sscanf(input, "%02hhX", output);

        input += 2;
        ++output;
    }

    return u.value;
} 
```

这使用了非标准`hh`修饰符。如果您不想使用它，请使用：

```
unsigned int tmp = *input;
sprintf(output, "%02X", tmp);

unsigned int tmp;
sscanf(input, "%02X", &tmp);
*output = tmp; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-30T22:33:28.273

```
char *doubleToRawString(double x) {
    // Assumes sizeof(long long) == 8.

    char *buffer = new char[32];
    sprintf(buffer, "%llx", *(unsigned long long *)&x);  // Evil!
    return buffer;
}

double rawStringToDouble(const char *s) {
    // Assumes sizeof(long long) == 8.

    double ret;
    sscanf(s, "%llx", (unsigned long long *)&ret);  // Evil!
    return ret;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-12-12T16:10:03.267

对于 MFC，将 double 转换为 CString :)

```
CString MFCClass::DoubleToCString(double d, int beforKomma)
{
    char a[17]="0123456789ABCDEF";
    CString str = _T("");
    double dInt=0,dPunkt=0;
    bool is_otr=0;
    if (d<0) {is_otr=1; d=-d;}
    dPunkt = modf(d, &dInt);
    //целая часть
    long ld = (long)dInt;
    long mask = 0xf;
    int it;
    while(ld>0)
    {
        it = ld&mask;
        ld = ld>>4;
        str.Insert(0,a[it]);
    };
    // дробная часть
    //если целая часть 0:
    if (str.GetLength()==0) str += _T("0");
    str += _T(".");
    for (int i=0; i<beforKomma; i++)
    {
        dPunkt*=16;
        dPunkt = modf(dPunkt, &dInt);
        str += a[(int)dInt];
    }

    if (is_otr) str.Insert(0,_T("-"));
    return (str);
} 
```

-345.86783907228863 -> "-159.DE2" (beforKomma=3)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-10T04:29:41.110

您想使用联合并避免这种坏习惯：

字符 *d2c;

d2c = (char *) &a;

只是打印它还不错，当您尝试修改 d2c 然后使用 a 时，您就会遇到麻烦。（对于共享相同（理论）内存的任何两个变量或指针（或数组）也是如此。

```
union
{
    double f;
    unsigned long ul;
} myun;

myun.f = a;
printf("0x%lX",myun.ul);

to go the other way (scanf is also a very dangerous function that should be avoided).

myun.ul=strtoul(string,NULL,16);
a=myun.f; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-30T22:32:41.600

几乎相同的程序应该做

```
void hex2double(const char* buf, double& a)
{
   char tmpbuf[3]={0};
   char *d2c;
   unsigned int tmp;
   d2c = (char *) &a;
   char *n = buf;
   int i;
   for(i = 0; i < 8; i++)
   {
      tmpbuf[0]=*buf++;
      tmpbuf[1]=*buf++;
      sscanf(tmpbuf, "%X", &tmp);
      *d2c++=tmp;
   }
} 
```

又快又脏。

但是请注意，这是在玩火。首先，您的十六进制字符串只能在具有相同双格式和相同字节序的机器上使用。其次，转换函数缺乏严格的别名规则。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-30T22:46:35.533

```
#include <stdio.h>
main() {
  union double_ull_t {
    double d;
    unsigned long long u;
  } x;
  scanf("%lf",&x.d);
  printf("%016llX %lf\n",x.u,x.d);
  scanf("%016llX",&x.u);
  printf("%016llX %lf\n",x.u,x.d);
} 
```

也许不是最有效的解决方案，但最容易编码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-30T22:26:05.653

老实说，使用 sprintf 很慢，但是您可以使用 sscanf 恢复它，做几乎完全相同的事情。

好吧，实际上，您必须将每两个字符复制到一个缓冲区字符串中，以便单独解码。我的第一次尝试，以下是不正确的：

```
double hexString2Double(char *buf)
{
  char *buf2 = new char[3];
  double a;
  char* c2d;
  c2d = (char *) &a;
  int i;

  buf2[2] = '\0'

  for(i = 0; i < 16; i++)
  {
    buf2[0] = *buf++;
    buf2[1] = *buf++;
    sscanf(buf2, "%X", c2d++);
  }

  return a;
} 
```

你看，%X 被解码为一个 int，而不是一个字节。它甚至可能会起作用，具体取决于低端/高端问题，但它基本上已经坏了。所以，让我们尝试解决这个问题：

```
double hexString2Double(char *buf)
{
  char *buf2 = new char[3];
  double a;
  char* c2d;
  c2d = (char *) &a;
  int i;
  int decoder;

  buf2[2] = '\0'

  for(i = 0; i < 16; i++)
  {
    buf2[0] = *buf++;
    buf2[1] = *buf++;
    sscanf(buf2, "%X", &decoder);
    c2d++ = (char) decoder;
  }

  return a;
} 
```

除非语法错误等，我认为这应该可行。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-01-21T04:09:55.520

我正在使用以下函数将双精度转换为十六进制。

```
char * double2HexString(double a) 
{ 
   char *buf = new char[17]; // double is 8-byte long, so we have 2*8 + terminating \0 
   char *d2c; 
   d2c = (char *) &a; 
   char *n = buf; 
   int i; 
   for(i = 0; i < 8; i++) 
   { 
      sprintf(n, "%02X", *d2c++); 
      n += 2; 
   }  
   *(n) = '\0'; 
} 
```

将 1.0 和 16.0 传递给此函数，观察到的返回值分别为 000000000000FF37 和 0000000000003040。我认为我们应该得到 1 和 10。

# c - 在 C 中创建一个 FIFO 队列

> ID：497477
> 
> 赞同：7
> 
> 时间：2009-01-30T22:16:43.957
> 
> 标签：c, stack, queue

是否可以在不使用 2 个堆栈的情况下在 C 中创建一个 FIFO“堆栈”？

谢谢！

（对不起那些回答前一个问题的人。我在想 LIFO，意思是 FIFO。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-30T22:20:31.407

这很容易。只需实现一个双向链表，保存指向列表中最后一项的指针。

要添加到队列中，请在开头创建一个新节点，将其链接到前一个开头。（正常列表插入）

要从队列中删除，请取消指向最后一项的指针，将指针更改为前一项指针，然后返回最后一项......（这就是双向链表的原因。另一个选项是单链表list 并迭代整个列表以获取指向最后两个元素的指针）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-30T22:20:45.103

听起来您正在尝试创建一个队列，在其中插入一端并从另一端拉出。

一种方法是使用链表。您可以存储指向头部和尾部的指针。当你插入时，将新记录附加到尾部，当你从队列中弹出一些东西时，你抓住头指针指向的节点。（反之亦然，没关系）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-30T22:21:06.397

这不只是一个标准的链表，除了你只定义函数来拉出头元素并将东西推到尾元素上吗？您甚至可以在带有尾指针的单链表中执行此操作，而不是在完全双向链表中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T22:20:39.143

为此使用 2 个堆栈是一个有趣的解决方案，而且是一个缓慢的解决方案。当您可以使用普通队列时，为什么要提到堆栈？这是你想要的先进先出，对吧？您可以使用数组来创建队列，并对其长度进行取模以使其成为圆形。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-30T22:39:07.623

您还可以使用[循环数组](http://datastructures.itgo.com/staque/queues/circular/insert.htm)实现队列。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-31T01:04:56.753

尽管已经提出了正确的解决方案，但我只想纠正 FIFO 并不是真正的堆栈。

这个问题经常出现在算法课上，他们要求你使用堆栈构建一个，并证明插入和移除的摊销成本是 O(1)。

可以使用双向链表、带有开始和结束指针的数组/向量、循环数组等来构建 FIFO。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-30T23:09:15.473

我认为 OP 想知道如果他所拥有的只是堆栈，无论出于何种神秘原因，如何处理它。诀窍是记住将东西压入堆栈然后将其弹出会颠倒项目的顺序，因此您可以使用两个堆栈来反转它两次。

传入的项目被推到 stack1 上，并且当 stack2 为空时全部弹出到 stack2 上。所以第一个项目被推入stack1，立即弹出并推入stack2，准备输出。后续项在 stack1 上堆叠，直到 stack2 弹出，此时最后一项在 stack2 上，然后是倒数第二项，依此类推，直到 stack1 再次为空。现在所有项目都重新堆叠在 stack2 上，最新的在底部，最旧的在顶部。新的推送继续在 stack1 上建立，等待 stack2 再次变空，stack2 只是按照原始顺序生成项目，直到它为空，此时我们重复 unstack-restack 过程。

我不会评论效率等；只是“你可以那样做”。我在一次采访中被问到这个问题，我的直接回答是“什么样的白痴*会这样做*？只需实现一个实际的队列并完成它” - 我认为这不是他们正在寻找的答案。

# vim - 用“.”重复包围 VIM 中的命令

> ID：497485
> 
> 赞同：16
> 
> 时间：2009-01-30T22:18:57.070
> 
> 标签：vim, surround

有没有人让[round.vim](http://www.vim.org/scripts/script.php?script_id=1697)与[repeat.vim](http://www.vim.org/scripts/script.php?script_id=2136)一起工作？

这应该使您能够使用“。”重复环绕插件提供的任何命令。命令。

我认为surround.vim 应该已经内置了对repeat 插件的支持，所以它应该可以开箱即用，但我无法让它工作。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-31T10:28:35.150

我只是将surround.vim 和repeat.vim 放在我的.vim/plugins 文件夹中并试了一下。对我来说，它像描述的那样工作。

*您可以在不受支持*的功能上尝试重复命令。在环绕.vim 的文档中它说

```
 The "." command will work with ds, cs, and yss if you install repeat.vim 
```

它并不是说*所有*命令都可以与 repeat.vim 一起使用。例如，视觉模式的东西（选择多行并围绕它们）不适用于 repeat.vim

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-31T11:15:53.243

你是对的。它似乎只适用于 ds、cs 和 yss。

它也可以部分地在`yse`, `ysiw`, `ysaw`,上工作`ys2w`。当您重复 ysiw 命令时，它会在提示符处停止，等待您输入周围的类型（即 b、B、r、"、t...）。

虽然仍然没有视觉命令。我希望未来的版本会增加对其余命令的支持。

感谢你的回答。

# ctypes - DataListItem 到 DropDownList 或 TextBox VB.Net

> ID：497499
> 
> 赞同：1
> 
> 时间：2009-01-30T22:22:53.053
> 
> 标签：ctypes, datalistitem

我有一个 DataListItem，它可能是一个下拉列表或一个文本框。要获得我需要做的价值：

```
 CType(item.FindControl("myControl"), TextBox).Text 
```

或者

```
CType(item.FindControl("myControl"), DropDownList).SelectedValue.ToString() 
```

问题是，如果它是我得到的下拉列表..

> 无法将“System.Web.UI.WebControls.DropDownList”类型的对象转换为“System.Web.UI.WebControls.TextBox”类型。

有没有办法在 Ctyping 之前检查 CType 是否会占用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T22:33:35.373

使用 TryCast：

```
Dim txt as TextBox = TryCast(item.FindControl("myControl"), TextBox)
If txt Is Nothing Then
    TryCast(item.FindControl("myControl"), DropDownList)
End If 
```

# asp.net - 日期计算

> ID：497504
> 
> 赞同：0
> 
> 时间：2009-01-30T22:24:50.587
> 
> 标签：asp.net, vb.net

你能在 vb.net 中给我一个简单的函数，它可以将天数和日期作为参数，并从给定日期中减去这些天数。例如

```
Private function Calculate(Byval p_number_days,p_date) as date

 Dim calculated_date as Date= (p_date) - (p_number_days) 
 return calculated

End Function 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-30T22:28:47.490

```
Private Function Calculate(ByVal p_Number_Days As Integer, ByVal p_Date As DateTime) As DateTime
    Return p_Date.AddDays(p_Number_Days * -1)
End Function 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T22:29:11.577

只需使用 DateTime 类的 AddDays() 方法 - [MSDN](http://msdn.microsoft.com/en-us/library/system.datetime.adddays.aspx)

它可以取负值也可以取正值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T22:30:36.563

对不起，我很久没用VB了，所以有些语法可能是错误的。

```
Private Function Calculate(p_days AS Integer, p_date AS Date) AS Date
  Return p_date - TimeSpan.FromDays(p_days)
End Function 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T22:40:07.293

如果可以，请始终将天数表示为 TimeSpan。它使代码看起来更好。

```
Private function Calculate(Byval p_number_days as TimeSpan,p_date as Date) as date
    Return p_date - p_number_days 
```

# .net-1.1 - .NET 3.5 SP1 将如何影响我的 .NET 1.1 应用程序？

> ID：497508
> 
> 赞同：4
> 
> 时间：2009-01-30T22:25:54.453
> 
> 标签：.net-1.1, .net-3.5

如果我有许多使用 .NET 1.1 编写和部署的现有应用程序，那么在服务器上安装 .NET 3.5 SP1 是否有任何风险？我的理解是 .NET 3.5 SP1 仅适用于 .NET 2.0 代码库，因此它不会触及或影响我的 .NET 1.1 应用程序。

您还可以向我指出任何相关的 MSDN 文档吗？我已经搜索但找不到任何东西。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-30T22:34:19.927

**如果**您的代码已经与 2.0 并行工作，3.5SP1 将不会产生任何实际影响；重要的因素是 CLR 的选择：如果它已经做到这一点，那么您应该不会受到太大影响。在这种情况下，即使选择了 2.0 CLR（1.1 代码可以在 2.0 中运行），您也只会看到捆绑在 3.5SP1 中的 2.0 服务包的更改。这可能会对`ThreadPool`使用等产生一些微妙的影响，但它们应该是最小的。

当然，如果您的 1.1 代码还不是 2.0 安全的，那么还有**更多**需要注意的更改——比如线程异常总是致命的……您可能希望主动请求 1.1。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T22:34:44.183

目前尚不清楚应用程序在哪里运行或它们是什么。

*   如果它们是 ASP.NET，那么您可以告诉 IIS 使用哪个版本的框架
*   如果它们是在客户端上运行的 WinForms 应用程序，则可能取决于它们与服务器的通信方式
*   如果你是服务器上的其他应用程序，你可以[告诉 .NET 使用哪个版本](http://msdn.microsoft.com/en-us/library/9w519wzk.aspx)

抱歉含糊不清 - 如果您能提供更多信息，我们可能会为您提供更多帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-30T22:35:23.247

如果您同时拥有 .NET 1.1 和 .NET 2.0，则 1.1 应用程序将使用 1.1 运行时。

如果您只有 .NET 3.5，您的 1.1 应用程序将使用 2.0 运行时。

如果您同时拥有 .NET 1.1 和 .NET 2.0 并且同时拥有 1.1 和 2.0 应用程序，那没问题。每个程序都有自己的正确运行时实例。

如果您同时使用 .NET 1.1 和 .NET 2.0 并且有一个同时具有 1.1 和 2.0 插件的程序，那么您就完蛋了。程序有 50-50 的机会首先加载 1.1 运行时，导致 2.0 插件失败。（每个应用程序只允许一个运行时。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T22:36:44.993

我在具有一些现有 .NET 1.1 应用程序的服务器上安装了 .NET 3.5 SP1，并且没有发现任何问题。框架版本与 1.1 和 3.5 完全不同，尽管我知道 3.5 包含一些 2.0 的补丁，这些补丁可能会改变 2.0 应用程序的行为。我也没有注意到那里的任何东西。

您可能对这篇博文感兴趣，该[博](http://blogs.msdn.com/swiss_dpe_team/archive/2008/04/10/migrating-from-net-1-1-to-2-0-3-0-and-3-5.aspx)文涵盖了很多关于更新的内容，但特别提到，不理会 1.1 应用程序是可以的。它也有很多其他来源的参考。

# asp.net - 错误渲染控件缓存不可用

> ID：497519
> 
> 赞同：3
> 
> 时间：2009-01-30T22:27:22.327
> 
> 标签：asp.net, visual-studio-2008, custom-controls

我有一个自定义控件，它显示从数据库中获得的值（产品的价格）。出于性能原因，此值存储在缓存中，并且工作正常。但是，在 Visual Studio 2008 的设计模式中，我收到一条错误消息，提示“错误呈现控件。发生未处理的异常。缓存不可用”

我正在使用一个 ControlDesigner，带有一个非常简单的 GetDesignTimeHtml：

```
public override string GetDesignTimeHtml()
{
  return "[$9.99]";
} 
```

我希望这能解决问题，但事实并非如此。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-31T19:07:50.967

您需要为自定义控件的缓存访问添加一个包装器，否则当 HttpContext.Current 为空时，它们将在设计模式下失败。你想做这样的事情：

```
public object GetFromCache(string key)
{
     var myContext = HttpContext.Current;
     if(myContext != null)
     {
         return myContext.Cache[key];
     }
     return "[Design Time Value]";
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T22:36:47.940

您是否直接在 ASPX 文件中引用 Cache 对象？

# sql - SQL 选择列表中的布尔表达式

> ID：497522
> 
> 赞同：64
> 
> 时间：2009-01-30T22:28:26.490
> 
> 标签：sql, unit-testing, tsql, expression, assert

我想创建一个 SQL Select 在 MS SQL Server 2005 中进行单元测试。基本思想是这样的：

```
select 'Test Name', foo = 'Result'
from bar
where baz = (some criteria) 
```

这个想法是，如果“foo”列的值是“Result”，那么我会得到一个值 true/1；如果不是，我会得到 false/0。

不幸的是，T-SQL 不喜欢这个表达式。它在等号上窒息。

是否有某种方法可以评估 SQL 选择列表中的表达式并获得可返回的结果？（或者其他实现我想要的单元测试的方法？）

* * *

编辑：3 个很棒的答案，都是围绕 CASE 构建的。我会接受 feihtthief 的，因为他的代表最少，因此最需要它。：-） 谢谢大家。

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2009-01-30T22:30:45.627

使用 case 构造：

```
select 'Test Name', 
    case when foo = 'Result' then 1 else 0 end 
    from bar where baz = (some criteria) 
```

另请参阅[MSDN Transact-SQL CASE 文档](http://msdn.microsoft.com/en-us/library/ms181765.aspx)。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-01-30T22:30:44.427

```
SELECT 'TestName', 
    CASE WHEN Foo = 'Result' THEN 1 ELSE 0 END AS TestResult
FROM bar 
WHERE baz = @Criteria 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-01-30T22:33:14.813

用例：

```
SELECT 'Test Name' [col1],
  CASE foo
    WHEN 'Result' THEN 1
    ELSE 0
  END AS [col2]
FROM bar
WHERE baz = (some criteria) 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2015-09-12T00:48:31.407

您还可以使用：

```
select 
    'Test Name', 
    iif(foo = 'Result', 1, 0)
from bar 
where baz = (some criteria) 
```

我知道这是不久前被问到的，但我希望这对那里的人有所帮助。

# sql - How do I join the most recent row in one table to another table?

> ID：497535
> 
> 赞同：51
> 
> 时间：2009-01-30T22:31:34.940
> 
> 标签：sql, date, join, greatest-n-per-group

I have data that looks like this:

```
entities
id         name
1          Apple
2          Orange
3          Banana 
```

Periodically, a process will run and give a score to each entity. The process generates the data and adds it to a scores table like so:

```
scores 
id  entity_id    score   date_added
1    1            10       1/2/09
2    2            10       1/2/09
3    1            15       1/3/09
4    2            10       1/03/09
5    1            15       1/4/09
6    2            15       1/4/09
7    3            22       1/4/09 
```

I want to be able to select all of the entities along with the most recent recorded score for each resulting in some data like this:

```
entities
id name     score  date_added
1  Apple     15     1/4/09
2  Orange    15     1/4/09
3  Banana    15     1/4/09 
```

I can get the data for a single entity using this query:

```
SELECT entities.*, 
       scores.score, 
       scores.date_added 
FROM entities

INNER  JOIN scores
ON entities.id = scores.entity_id

WHERE entities.id = ?

ORDER BY scores.date_added DESC
LIMIT 1 
```

But I'm at a loss for how to select the same for all entities. Perhaps it's staring me in the face?

Thank you very kindly for taking the time.

Thanks for the great responses. I'll give it a few days to see if a preferred solution bubbles up then I'll select the answer.

UPDATE: I've tried out several of the proposed solutions, the main issue I'm facing now is that if an entity does not yet have a generated score they don't appear in the list.

What would the SQL look like to ensure that all entities are returned, even if they don't have any score posted yet?

UPDATE: Answer selected. Thanks everyone!

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-01-30T22:36:46.803

I do it this way:

```
SELECT e.*, s1.score, s1.date_added 
FROM entities e
  INNER JOIN scores s1
    ON (e.id = s1.entity_id)
  LEFT OUTER JOIN scores s2
    ON (e.id = s2.entity_id AND s1.id < s2.id)
WHERE s2.id IS NULL; 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-31T03:45:01.453

Just to add my variation on it:

```
SELECT e.*, s1.score
FROM entities e
INNER JOIN score s1 ON e.id = s1.entity_id
WHERE NOT EXISTS (
    SELECT 1 FROM score s2 WHERE s2.id > s1.id
) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-31T03:37:21.967

**approach 1**

```
SELECT entities.*, 
       scores.score, 
       scores.date_added 
FROM entities

INNER  JOIN scores
ON entities.id = scores.entity_id

WHERE scores.date_added = 
  (SELECT max(date_added) FROM scores where entity_id = entities.id) 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-10-10T14:44:28.760

I know this is a old question, just thought I'd add a approach no-one has mentioned yet, `Cross Apply` or `Outer Apply`. These are available in SQL Server 2005 (the database type is not tagged in this question) Or higher

Using the temporary tables

```
DECLARE @Entities TABLE(Id INT PRIMARY KEY, name NVARCHAR(MAX))
INSERT INTO @Entities
VALUES (1, 'Apple'), (2, 'Orange'), (3, 'Banana'), (4, 'Cherry')

DECLARE @Scores TABLE(Id INT PRIMARY KEY, Entity_Id INT, Score INT, Date_Added DATE)
INSERT INTO @Scores
VALUES (1,1,10,'2009-02-01'),
(2,2,10,'2009-02-01'),
(3,1,15,'2009-02-01'),
(4,2,10,'2009-03-01'),
(5,1,15,'2009-04-01'),
(6,2,15,'2009-04-01'),
(7,3,22,'2009-04-01') 
```

You could use

```
SELECT E.Id, E.name, S.Score, S.Date_Added 
FROM @Entities E
CROSS APPLY
(
    SELECT TOP 1 * 
    FROM @Scores Sc 
    WHERE Sc.Entity_Id = E.Id  
    ORDER BY sc.Score DESC
) AS S 
```

to get the desired results. The equivilent to allow entities without scores would be

```
SELECT E.Id, E.name, S.Score, S.Date_Added 
FROM @Entities E
OUTER APPLY
(
    SELECT TOP 1 * 
    FROM @Scores Sc 
    WHERE Sc.Entity_Id = E.Id  
    ORDER BY sc.Score DESC
) AS S 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-31T03:43:57.743

**approach 2**

query cost relative to batch:

*   [approach 1](https://stackoverflow.com/questions/497535/how-do-i-join-the-most-recent-row-in-one-table-to-another-table/498166#498166): 22% -- faster

*   approach 2: 22% -- faster

*   [approach 3](https://stackoverflow.com/questions/497535/how-do-i-join-the-most-recent-row-in-one-table-to-another-table/497557#497557): 27%

*   [approach 4](https://stackoverflow.com/questions/497535/how-do-i-join-the-most-recent-row-in-one-table-to-another-table/498179#498179): 27%

* * *

```
SELECT entities.*, 
       scores.score, 
       scores.date_added 
FROM entities

INNER  JOIN scores
ON entities.id = scores.entity_id

inner join 
    (
    SELECT 
           entity_id, max(date_added) as recent_date
    FROM scores
    group by entity_id
    ) as y on entities.id = y.entity_id and scores.date_added = y.recent_date 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-30T22:35:31.390

```
SELECT entities.*, 
       scores.score, 
       scores.date_added 
FROM entities

INNER  JOIN scores
ON entities.id = scores.entity_id

WHERE entities.id in 
(select id from scores s2 where date_added = max(date_added) and s2.id = entities.id)

ORDER BY scores.date_added DESC
LIMIT 1 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-12-23T23:54:54.707

You can also do this today in most RDBMSs (Oracle, PostgreSQL, SQL Server) with a natural query using window functions such as ROW_NUMBER:

```
SELECT id, name, score, date_added FROM (
 SELECT e.id, e.name, s.score, s.date_added,
 ROW_NUMBER() OVER (PARTITION BY e.id ORDER BY s.date_added DESC) rn
 FROM Entities e INNER JOIN Scores s ON e.id = s.entity_id
) tmp WHERE rn = 1; 
```

[**SQL Fiddle**](http://sqlfiddle.com/#!6/24ff0/1)

# silverlight-2.0 - Silverlight：强制 Canvas 使其自身无效或重绘？

> ID：497543
> 
> 赞同：6
> 
> 时间：2009-01-30T22:34:19.647
> 
> 标签：silverlight-2.0

我有一个 Silverlight 应用程序，上面有一个 Canvas。在那个画布上，我动态地“绘制”了一堆东西，但在画布上添加了控件。

我在 Canvas 区域外有一个按钮，用于清除内容。对象被移除（成功）。但是，Canvas 区域不会立即自行刷新；它目前需要画布本身的 MouseOver 或其他事件。

让外部对象使 Canvas 无效的最简单方法是什么？我确定我错过了一些简单的东西！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-01T20:52:37.713

这有点肮脏，但您可以尝试将 Canvas 的可见性更改为“可见”（即使它已经是），所以：

```
myCanvas.Visibility = Visibility.Visible; 
```

我们发现这会强制重绘，即使 myCanvas.Visible 的实际值没有改变......

试一试，它只是一个可以解决问题的班轮。尽管如果您要从中删除内容，我希望 Canvas 无论如何都会重新绘制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-09-20T05:49:04.373

万一有人像我一样在寻找这个答案之后出现......

```
yourFrameworkElement.InvalidateArrange();
yourFrameworkElement.UpdateLayout(); 
```

为我工作。

注意：只打电话对`this.yourFrameworkElement.UpdateLayout();`我**不起作用**。我不得不打电话`InvalidateArrange()`。此后我立即致电`UpdateLayout()`以求完整性-可能实际影响为零。

这个`myCanvas.Visibility = Visibility.Visible;`技巧也对我不起作用，因为我试图触发 LayoutUpdated 事件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-17T20:54:26.503

不是一个简单的单线，但它的工作原理。根据我的经验，它运作良好。它将给定的动作推迟十分之一秒以允许 UI 线程更新，但它仍然在 UI 线程上执行该动作。

```
using System;
using System.Windows.Threading;

public static class MyTestClass
{
    public static void Postpone(Action a_action)
    {
        TaggedDispatchTimer timer = new TaggedDispatchTimer();
        timer.Interval = TimeSpan.FromSeconds(0.1);
        timer.Tick += OnDoPostponedAction;
        timer.UserState = a_action;
        timer.Start();
    }

    private static void OnDoPostponedAction(object sender, EventArgs e)
    {
        TaggedDispatchTimer timer = sender as TaggedDispatchTimer;
        timer.Stop();
        timer.Tick -= OnDoPostponedAction;

        var action = timer.UserState as Action;
        if (action != null)
            action();
    }
}

public class TaggedDispatchTimer : DispatcherTimer
{
    public Object UserState { get; set; }

} 
```

这是我如何使用它：

```
MyTestClass.Postpone(() =>
    {
        // Do some bloody long operation.
    }); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-05-17T19:37:24.270

在我的情况下（我在 Canvas 中有一个 Canvas 并且由于方向变化我需要调整内部画布的大小），这个`myCanvas.Visibility = Visibility.Visible;`技巧没有做到，但它真的很接近：

```
myCanvas.Visibility = Visibility.Collapsed;
myCanvas.Visibility = Visibility.Visible; 
```

工作得很好。

`InvalidateArrange`后面的an也`UpdateLayout`没有做到。

最后，这一切都不是必需的，因为我意识到 Canvas 中的 Canvas 不是必需的，并且能够更改 StackPanel 的内部 Canvas，并且不需要任何技巧就可以按预期工作。

# nhibernate - nHibernate 2.0 - 映射复合 ID *和* 多对一关系会导致“无效索引”错误

> ID：497548
> 
> 赞同：20
> 
> 时间：2009-01-30T22:34:56.087
> 
> 标签：nhibernate, nhibernate-mapping

我有个问题。想象一下这个数据模型：

```
[Person] table has: PersonId, Name1  
[Tag] table has:  TagId, TagDescription  
[PersonTag] has: PersonId, TagId, IsActive 
```

由于`[PersonTag]`不仅仅是一个简单的多对多连接表，我在 nHibernate 中创建了所有三个实体（就像它们在数据模型中一样）。`PersonTag`，因此，需要一个复合ID，我已将其映射到这样的类：

```
<composite-id name="PersonTagKey" class="PersonTagKey">
  <key-property name="PersonId"></key-property>
  <key-property name="TagId"></key-property>
</composite-id> 
```

我想遍历对象图并能够从检索到的对象中同时查看`Person`和对象。所以，我有对象的属性来做到这一点，映射如下：`Tag``PersonTag``PersonTag`

```
<many-to-one name="Person" column="PersonId" lazy="proxy" cascade="none" class="Person"/>
<many-to-one name="Tag" column="TagId" lazy="proxy" cascade="none" class="Tag"/> 
```

当我尝试创建一个`PersonTag`对象并保存它时，我收到*“Invalid index n for this SqlParameterCollection with Count=n”*错误。我知道这是因为我已经映射了两次`PersonId`and`TagId`属性，一次用于复合 ID，一次用于多对一关系。如果我不映射多对一对象，那么一切正常。

*有没有办法让我能够基于在同一 nHibernate 实体中建模的同一列建立复合 ID 和多对一关系？*

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-02T20:50:58.073

凯，这就是答案。几乎没有关于此的文档：

```
<composite-id name="PersonTagKey" class="PersonTagKey"> 
  <key-many-to-one name="Person" column="PersonId" lazy="proxy" class="Person">
  <key-many-to-one name="Tag" column="TagId" lazy="proxy" class="Tag"/>
</composite-id> 
```

这将允许您创建一个由多对一关系的逆组成的复合 ID。

好猎...

# java - 通过 EJB 共享静态单例

> ID：497552
> 
> 赞同：1
> 
> 时间：2009-01-30T22:35:33.950
> 
> 标签：java, jakarta-ee, static, singleton, ejb

我正在尝试在 Web 服务中创建缓存。为此，我创建了一个新的无状态 Bean 来将此缓存提供给其他无状态 bean。此缓存只是一个静态 ConcurrentMap，其中 MyObject 是一个 POJO。问题是似乎有不同的缓存对象。一个用于客户端 bean，另一个用于本地。

```
-CacheService
-CacheServiceBean
  -getMyObject()
  -insertMyObject(MyObject)
  -size()

-SomeOtherBean
 cache = jndiLookup(CacheService)
 cache.insertMyObject(x)
 cache.size() -> 1 
```

在这个分配之后，如果我从 CacheServiceBean 内部调用 cache.size，我得到 0。甚至可以通过 bean 共享静态单例吗？最后我决定使用数据库表，但我仍在考虑这个问题。

感谢您的回复。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-30T22:49:44.233

据我记得，您不能确定无状态 bean 是否足够全局，可以让您将数据保存在静态字段中。有几个缓存框架可以帮助您解决这个问题。也许[内存缓存](http://www.whalin.com/memcached/)？

编辑： http: [//java.sun.com/blueprints/qanda/ejb_tier/restrictions.html#static_fields](http://java.sun.com/blueprints/qanda/ejb_tier/restrictions.html#static_fields)说：

> 在 EJB 中不允许使用非最终静态类字段，因为此类字段使企业 bean 难以或无法分发

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-30T23:39:04.897

从表面上看，这似乎是一个矛盾，因为缓存几乎肯定是我不会认为无状态的东西，至少在一般意义上。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-30T23:33:40.213

```
@Stateless
public class CacheSessionBean implements CacheSessionLocal {
    private static Map<String, Object> cacheMap = new HashMap<String, Object>();

    public Object getCache(String key) {
        return cacheMap.get(key);
    }

    public void putCache(String key, Object o) {
        cacheMap.put(key, o);
    }
} 
```

关于集群中 EJB 分布的注意事项适用于静态变量。但是，如果您不进行集群，它们几乎不适用于您，因此在这个级别上，静态是“好的”。

您将遇到同步问题。

缓解这种情况的一种方法是将容器配置为仅创建和池化 CacheSession bean 的单个实例，然后容器将为您管理该同步。

您也可以自己管理同步，但您不应该在 EJB 方法级别这样做，而是拥有一个同步的 Cache 对象（与通用 HashMap 相比）可能会更好。

但关键是在这一点上，静态变量只是静态变量。

从理论上讲，您需要了解会话 Bean 的容器生命周期（因为它可能会释放所有实例，因此实际的 bean 类可能有资格进行 GC，因此可能会丢失任何静态数据）。但是，在实践中，如果该服务很受欢迎，这不太可能发生。但是，仅供参考，它可能会发生。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T22:51:02.343

使用无状态 bean 时，您无法控制拥有多少实例（这取决于您的应用服务器来处理）。您可以从另一个 bean 获得输出，而不是您从客户端查找的那个。你把它打印在你的日志里了吗？在这种情况下，您可能应该看到不止一个输出。关键是，当您通过 jndi 查找无状态 bean 时，您无法知道获得了哪个实例（您只获得了一个）。而且，您没有状态，所以我不知道这是否是缓存的最佳选择。

通过静态单例我想你的意思是一个单例对象？是的，通过许多 bean 访问单例应该不是问题。但请记住您可能会遇到的并发问题。应用服务器（一般是 bean）从你那里抽象了很多东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-08-09T23:41:18.677

我知道这篇文章是不久前的，但似乎有一个新的 Singleton Bean 可以满足原始问题所针对的缓存需求：

[http://download.oracle.com/javaee/6/tutorial/doc/gipjg.html](http://download.oracle.com/javaee/6/tutorial/doc/gipjg.html)

> 单例会话 bean 提供与无状态会话 bean 类似的功能，但与它们的不同之处在于每个应用程序只有一个单例会话 bean，而不是无状态会话 bean 池，其中任何一个都可以响应客户端请求。与无状态会话 bean 一样，单例会话 bean 可以实现 Web 服务端点。

我已经尝试创建一个并从 WebService/Stateless bean 引用它两个问题。像宣传的那样工作。

# javascript - 我的 JavaScript 有什么问题？褪色图像

> ID：497560
> 
> 赞同：0
> 
> 时间：2009-01-30T22:37:06.130
> 
> 标签：javascript, image, coding-style

我试图通过每隔几秒钟改变它们的背景来让 Javascript 改变某些 DIV ID 的样式。基本上，一个褪色的标题......这是我的代码，它根本不会改变背景。

你如何调用一个函数？

[http://pixolia.net/sandbox/morph/index.php](http://pixolia.net/sandbox/morph/index.php)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-30T22:42:28.960

您的 javascript 在函数中，不会从任何地方调用。尝试从 window.onload 或 $(document).ready(function(){ }) 调用其中一个函数；如果你使用 jQuery

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T23:06:32.717

你可以做这样的事情

```
<body onload="Appear(id1, id2);"> 
```

这样当页面加载时它开始淡入/淡出

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T10:16:16.577

对于我刚刚看到的版本，对 Appear(id1, id2) 的 onload 调用失败，因为 id1 和 id2 尚未定义。

要么定义 id1 和 id2，例如 ... pics_array[2] = pic2; 变量 id1 = 0; 变量 id2 = 0;

但由于它的 onload 函数只被调用一次，您不妨将 body 标签更改为

唯一的问题是代码落在这一行： new Effect.Appear('appear-div');

可能是因为找不到文件 effects.js。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T10:17:23.813

抱歉，... 将 boday 标签更改为 ... onload="Appear(0, 1);"

# c# - StructureMap CacheBy InstanceScope.HttpSession 不起作用

> ID：497564
> 
> 赞同：0
> 
> 时间：2009-01-30T22:38:29.357
> 
> 标签：c#, dependency-injection, inversion-of-control, structuremap

这是我的 StructureMap 引导：

```
ObjectFactory.Initialize(factory =>
{
  //Business Conversation is per session
  factory.ForRequestedType<IConversation>().
    TheDefaultIsConcreteType<Conversation>().
      CacheBy(InstanceScope.HttpSession);

  //Session Factory is life time
  factory.ForRequestedType<INHibernateSessionManager>().
    TheDefaultIsConcreteType<NHibernateSessionManager>().
      CacheBy(InstanceScope.Singleton);
});

var conversation = ObjectFactory.GetInstance<IConversation>(); 
```

当我将对话设置为使用 .CacheBy(InstanceScope.HttpSession) 时，我得到找不到对象引用，但是如果我不使用 CacheBy 它工作正常。这需要进入会话，我不确定为什么这不起作用。

我做错了什么还是这似乎是 StructureMap 中的错误？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T13:41:02.467

要回答我自己的问题，是的，这是 StructureMap 中的错误。该错误已在主干中修复，或者将在 2.5.3 或更高版本的任何二进制版本中修复。

# c# - 同时通过 ref 和 typecast

> ID：497575
> 
> 赞同：1
> 
> 时间：2009-01-30T22:42:46.197
> 
> 标签：c#

有没有办法在 C# 中做到这一点？

```
private void Caller()
{
  MyControl c = new MyControl();
  Callee(ref c);                       //Here I want to cast c as Control and pass by ref
}

private void Callee(ref Control c)
{

} 
```

* * *

在泛型示例中，它如何推断 T = MyControl？你能解释一下吗？我是仿制药的新手

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-30T22:44:19.203

首先，我会质疑你是否*需要* `ref`——这似乎很不寻常；这是否意味着您打算重新分配方法内的变量？（不同于更改传递实例的属性）。

对于`ref`，它必须是完全匹配的；你可以使用：

```
Control tmp = c;
Callee(ref tmp);
c = (MyControl) tmp; 
```

或者，考虑泛型：

```
private void Callee<T>(ref T c) where T : Control
{ ... } 
```

然后你可以使用`Callee(ref c)`它会推断`T = MyControl`

（更新重新评论）

在泛型示例中，我们声明`Callee`为“T”的泛型方法，其中 T*至少*为 a `Control`。这个“至少”确保我们仍然可以访问`Control`方法内部的所有成员（因为任何子类`Control`仍然具有这些成员）。

泛型有点像模板（但不完全是）。**调用者**在调用方法时可以指定 T。所以调用者可以使用`Callee<Control>(...)`，这将与调用您现有的`Callee(ref Control c)`. 或者他们可以使用`Callee<MyControl>(...)`，这就像调用`Callee(ref MyControl c)`- 在这两种情况下，`T`在整个方法中都会被替换。

但是，C# 编译器足够智能，您通常不需要在尖括号中告诉它。它可以看到您正在传递 a `MyControl`，因此它将假定（除非您另有说明）它应该使用`T = MyControl`- 这称为泛型类型推断。这里的重点是它可以很容易地`ref`与数据的子类一起使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T22:45:52.697

不，这是不可能的，这是有充分理由的。想象一下，您在 Callee 中更改 c 并将 Control 的另一个后代分配给它，它不是 MyControl 的实例。

# vb6 - 如何计算VB6中标题栏的高度？

> ID：497578
> 
> 赞同：7
> 
> 时间：2009-01-30T22:44:15.507
> 
> 标签：vb6

我正在尝试在其下方的控件上显示一种相对于 Button 的表单。

但是 Button.top 是相对于底部窗体的**标题栏**的，而顶部窗体将是相对于屏幕的。

所以，为了弥补这一点，我现在需要标题栏有多高。

我使用了 Form.height-Form.ScalehHeight 但 ScaleHeight 不包括标题栏**或**边框，因此 Scaleheight 略微膨胀。

*有人知道*如何计算标题栏的高度吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-30T22:53:36.207

您需要使用`GetSystemMetrics`API 调用来获取标题栏的高度。

```
Private Declare Function GetSystemMetrics Lib "user32" (ByVal nIndex As Long) As Long
Private Const SM_CYCAPTION = 4

Property Get TitleBarHeight() as Long
    TitleBarHeight = GetSystemMetrics(SM_CYCAPTION)
End Property 
```

注意：这将返回以像素为单位的高度。如果您需要缇，则必须使用表单的`ScaleY`方法进行转换，如下所示：`Me.ScaleY(TitleBarHeight(), vbPixels, vbTwips)`

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-30T22:54:19.777

减去它：

```
(Form.height-Form.ScaleHeight) - (Form.Width-Form.ScaleWidth) / 2 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-02T19:01:33.177

上面的“递归”答案并不完全正确。它减去边框宽度的两倍 - 左边有一个边框，右边有一个边框！

我们得到了最好的结果：

```
(Form.Height-Form.ScaleHeight) - (Form.Width-Form.ScaleWidth)/2 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-06-10T14:30:09.827

```
' For completeness:
Public Const SM_CYCAPTION = 4
Public Const SM_CYBORDER = 6
Public Const SM_CYFRAME = 33

' in Pixels
Property Get NonClinetHeight()
    FrameH = GetSystemMetrics(SM_CYFRAME)     ' Total height, Top + Bottom
    CaptionH = GetSystemMetrics(SM_CYCAPTION) 
    BorderH = GetSystemMetrics(SM_CYBORDER)   ' Border around Client area
    NonClinetHeight = FrameH + CaptionH + (BorderH * 2)
End Property 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-30T22:51:14.590

您可能需要对[GetSystemMetrics()进行 Win32 API 调用](http://msdn.microsoft.com/en-us/library/ms724385.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-04-05T10:31:46.013

您可以使用`ClientToScreen()`windows API 函数将点从客户端坐标转换为屏幕坐标：

```
Dim Position As Point

Position.x = 0
Position.y = 0
ClientToScreen Me.hWnd, Position
FormTop = Position.y 
```

如果你想跳过这个并直接进入按钮，你可以使用按钮的位置（以像素为单位）：

```
Position.x = This.ScaleX(Button.Left, this.ScaleMode, vbPixels)
Position.Y = This.ScaleY(Button.Top, this.ScaleMode, vbPixels)
... 
```

或者只是使用获取按钮位置`GetWindowRect()`

```
Dim Position2 As Rect

GetClientRect Button.hWnd, Position2
Position.x = Position2.left
Position.y = Position2.top
... 
```

# asp.net-ajax - ASP.net Ajax：链接按钮的回发问题

> ID：497584
> 
> 赞同：3
> 
> 时间：2009-01-30T22:45:29.467
> 
> 标签：asp.net-ajax

我有一个触发弹出窗口的“是”链接按钮（ModalPopUpExtender） 弹出窗口包含一个 Web 用户控件，如果用户单击“是”链接按钮，则允许用户进行一些数据输入。

Yes 链接按钮位于一个 asp 面板中，另一个名为“No”的链接按钮被隐藏，当用户单击文本框时将变为可见。此文本框是 dropdownextender 的目标。是和否链接按钮都会触发 UpdatePanel 内的文本框，并将其文本值更新为 Y 或 N。

如果我单击“否”链接按钮，它将触发事件背后的代码并更新文本框值，但不会使用“是”链接按钮。它不会触发它的事件（OnClick）（后面的代码）。它只会触发模态弹出扩展器，因此我无法使用 Yes 链接按钮将文本框值更新为 Y。

我可以通过 javascript 更改文本框的值，但是当我单击更新按钮来更新数据库时。文本框的值仍然没有改变。我猜 javascript 只更改文本框的 html 值，但不会更改视图状态中的值。

两个问题：

1.  如果控件在 ajax 框架控件中用作目标控件，是否可以触发事件（在代码后面运行代码）？我错过了什么吗？

2.  如何通过 javascript 更改控件的值？不仅在表面（html）上，而且在视图状态中，因此当发生更新时，控件的实际值（例如文本框的 .text 值）会发生变化。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T17:17:13.667

我对你的问题有点困惑......但我记得尝试做类似的事情。每当与 ASP 和 java 交互时，此页面都非常有帮助：

[http://msdn.microsoft.com/en-us/library/system.web.ui.clientscriptmanager_methods.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.clientscriptmanager_methods.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T23:05:47.960

如果 Yes 和 No LinkBut​​tons 都在 UpdatePanel 内，为什么不让 Yes 按钮触发异步回发，更改 TextBox 值，然后从后面的代码调用 ModalPopup 上的 Show() 方法？

我不确定我是否完全理解您的问题......一些代码可能会帮助我们更好地了解您的情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T20:06:42.313

全部。我有点作弊并使用隐藏场。我使用 javascript 来更改隐藏字段的值，从而得到我想要的结果。

我希望这对有类似问题的人有所帮助。

杰克

# windows - 在 EmacsW32 中向操作系统发送击键

> ID：497585
> 
> 赞同：0
> 
> 时间：2009-01-30T22:45:31.073
> 
> 标签：windows, emacs, emacsw32

如果您用多种语言编写文本并使用 Emacs，您可能知道，Emacs 有自己独立于 Windows（或其他操作系统）的输入法系统。输入法可以用`toggle-input-method`命令切换。当 Windows 语言改变时，Emacs 会收到一个`<language-change>`按键。然后我想绑定`<language-change>`到`toggle-input-method`. 不幸的是，如果我这样做

```
(global-set-key (kbd "<language-change>") 'toggle-input-method) 
```

Windows 语言和输入法都将被切换。所以我需要类似的东西

```
(defvar safe-language-change-flag nil)
(defun safe-language-change ()
  (interactive)
  (setq safe-language-change-flag (not safe-language-change-flag))
  (when safe-language-change-flag
    (toggle-input-method)
    (send-key (kbd "<language-change>"))))

(global-set-key (kbd "<language-change>") 'safe-language-change) 
```

我似乎找不到一个函数调用，它将向操作系统发送密钥（或以另一种方式更改系统语言）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T01:44:31.900

只是为了确保您希望发生这种情况：您更改操作系统中的语言。Emacs 获取此事件，将按键发送回操作系统，然后取消更改语言。

您可以调用外部实用程序来执行此操作。

不过，我不确定您为什么要这样做。

如果您更改了操作系统的语言，则让操作系统处理输入法。如果您不想使用操作系统的输入法，请在 emacs 中执行切换输入法，而不必担心操作系统的状态。

我错过了什么吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-31T06:50:00.893

> 如果您不想使用操作系统的输入法，请在 emacs 中执行切换输入法，而不必担心操作系统的状态。

这正是我想要得到的结果。困难在于我发现自己一直在切换操作系统输入法，因为“按 Shift 切换语言”现在已经成为我手指记忆的一部分。

# msmq - MSMQ 冗余

> ID：497586
> 
> 赞同：2
> 
> 时间：2009-01-30T22:45:37.207
> 
> 标签：msmq

我正在研究 WCF/MSMQ。

有谁知道如何使用 MSMQ 处理冗余？我的理解是队列位于服务器上，但是如果服务器出现故障并且无法恢复怎么办，如何防止消息丢失？

关于这个主题的任何好文章？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-30T22:56:38.243

[这里](http://www.devx.com/enterprise/Article/22314/0/page/3)有一篇关于在企业中使用 MSMQ 的好文章。

提示 8 是您应该阅读的。

“使用 Microsoft 的 Windows 集群工具，如果其中一台队列服务器机器停止正常运行，队列将从一台机器故障转移到另一台机器。故障转移过程将队列及其内容从故障机器移动到备份机器。微软的集群工作，但在根据我的经验，很难正确配置并且经常出现故障。此外，要运行 Microsoft 的 Cluster Server，您还必须运行 Windows Server Enterprise Edition——这是一个昂贵的许可操作系统。这些问题加在一起值得寻找替代品。

使用 Microsoft 的 Cluster Server 的一种替代方法是使用第三方 IP 负载平衡解决方案，其中有几个是市售的。这些设备像标准网络交换机一样连接到您的网络，一旦配置完成，就会在配置的设备之间对 IP 会话进行负载平衡。要对 MSMQ 进行负载均衡，您只需在负载均衡设备上设置一个虚拟 IP 地址并将其配置为负载均衡端口 1801。要连接到 MSMQ 队列，发送应用程序指定负载均衡托管的虚拟 IP 地址设备，然后将负载有效地分配到托管接收应用程序的已配置机器上。

要使用硬件负载平衡器，您需要在配置为用于负载平衡的每台服务器上创建相同的队列，让负载平衡器将发送应用程序连接到组中的任何一台机器。为了增加额外的稳健性，您还可以配置所有接收应用程序以监控组中所有其他机器的队列，这有助于防止在一台或多台机器不可用时出现问题。在远程机器上进行这种队列监控的成本很高（从本地队列读取消息几乎总是更有效），但额外的可用性级别可能值得付出代价。”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T23:00:21.607

不要冷嘲热讽，但你有点回答了你自己的问题。如果服务器不可恢复，则您无法恢复消息。

话虽如此，您可能希望定期备份消息文件夹。这篇 TechNet 文章将告诉您如何操作：

[http://technet.microsoft.com/en-us/library/cc773213.aspx](http://technet.microsoft.com/en-us/library/cc773213.aspx)

此外，它不会备份快递信息，因此您必须注意这一点。

如果您愿意，您可能希望在收到实际消息后将其存储在数据库中进行处理，并让服务成为生产者/消费者模式中的消费者。

# algorithm - “绝对”字符串度量

> ID：497591
> 
> 赞同：6
> 
> 时间：2009-01-30T22:46:59.650
> 
> 标签：algorithm, string, text-processing, hilbert-curve, string-metric

我有一组巨大（但有限）的自然语言字符串。

我需要一种将每个字符串转换为数值的方法。对于任何给定的字符串，每次的值都必须相同。

两个给定的字符串越“不同”，两个对应的值应该越不同。它们越“相似”，不同的值应该越少。

我还不知道我需要的字符串之间差异的确切定义。反正没有自然语言解析。它可能应该类似于 Levenstein（但 Levenstein 是相对的，我需要绝对度量）。让我们从简单的事情开始。

## 尺寸更新

我很乐意接受多维（最好是 3d）向量而不是单个数值。

## 更新预期结果的正确性

正如在[此处](https://stackoverflow.com/questions/497591/absolute-string-metric/497640#497640)和[此处](https://stackoverflow.com/questions/497591/absolute-string-metric/498888#498888)正确指出的那样，从一个字符串到另一个字符串的距离是一个具有`MAX(firstStringLength, secondStringLength)`维度的向量。一般来说，在不丢失一些信息的情况下减少维数是不可能的。

但是我不需要一个绝对的解决方案。我会满足于从 N 维字符串空间到我的 3D 空间的任何“足够好”的转换。

另请注意，我有有限数量的有限长度的字符串。（虽然字符串的数量相当大，大约 8000 万（10 GB），所以我最好选择一些单通道无状态算法。）

从扫描参考资料来看，我的印象是[希尔伯特空间填充曲线](http://en.wikipedia.org/wiki/Hilbert_curve)可能对我有所帮助。看起来[希尔伯特空间填充曲线的聚类特性分析](http://www.cs.cmu.edu/afs/cs.cmu.edu/user/christos/www/PUBLICATIONS/ieee-tkde-hilbert.ps.gz)文章讨论了一些接近我的问题的东西......

## 希尔伯特曲线方法的更新

1.  我们将每个字符串映射到 N 维空间中的一个点，其中 N 是集合中字符串的最大长度。顺便说一句，字符串中的第 i 个字符代码可以用作这里的第 i 个坐标值吗？
2.  我们通过该 N 维空间绘制一条希尔伯特曲线。
3.  对于每个字符串，我们在曲线上取点，最接近字符串的坐标。该点的希尔伯特值（从曲线开始的长度）是我寻求的一维值。
4.  如果我们需要 3D 值，我们在 3D 中绘制 Hilbert 曲线并选择匹配 Hilbert 值的点，如上所述。

这看起来对吗？这里的计算费用是多少？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-30T23:11:13.177

我认为这是不可能的。从一个简单的字符串开始，并将其分配为零（数字是什么并不重要）

*   “你好世界” = 0

以下字符串与它的距离为 2：

*   “XXllo 世界” = 一个
*   “HeXXo 世界” = b
*   “你好 XXrld” = c
*   “你好，WorXX” = d

然而，这些字符串中的每一个都彼此相距 4。对于以下示例，无法对数字进行排序以使其正常工作：

a = 1, b = -1, c = 2, d = -2

考虑 c 到 0 是 2，而 c 到 a 是 1，但 0 比 a 更接近。

这只是一个简单的案例。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-30T23:08:23.383

我认为您将不得不更清楚地说明您的问题，您究竟想用这个指标实现什么？

我这样说是因为 Levenstein 之所以有效，是因为它将字符串对映射到一个度量，这可以保留字符串空间的维度。如果您尝试将字符串映射到数字，会发生大量的维度信息丢失。例如，假设我有字符串“cat”，我希望“bat”、“hat”、“rat”、“can”、“cot”等都合理地接近这个。对于大量的单词，结果是您最终会得到不同的单词相对频繁地接近，例如“bat”和“cot”可能很接近，因为它们都恰好与正面的“cat”距离相似。这类似于当您尝试将平面映射到一条线时发生的问题，很难满足平面上的点远在直线上的限制。因此，这样做的结果是“两个给定的字符串越“不同”，两个对应的值应该越不同”的要求是困难的。

所以，我的第一个建议是，你真的需要这样做吗，一个简单的哈希码是否足以为你提供唯一值，或者你可以使用 Levenstein 并忽略单个字符串的值？如果这些都不够，也许您可​​以使用多维函数值，即将字符串映射成对、三元组或另一个小的数字元组。以这种方式授予的额外维度将为您提供更好的结果。

一个例子可能是将字符串编码为三元组：长度、字符串中字母值的总和、字母值的交替总和，例如 f("cat") = (3, 3 + 1 + 20, 3 - 1 + 20) = (3, 24, 22)。这将具有您想要的一些属性，但可能不是最佳的。尝试寻找字符串的正交特征来进行这种编码，或者甚至更好，如果您有大量的字符串测试集，那么现有的库可以将此类数据映射到低维同时保留指标（例如 Levenstein 指标），并且您可以训练你的功能。我记得 S 语言支持这种东西。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-09-29T18:10:05.427

所以在这里我希望展示根本问题和解决方案。

**问题：**寻找“足够好”的解决方案是正确的，因为不可能获得完美的解决方案（我可以在信息论中证明这一点，但我会选择几何，因为它更具可读性）。您有一个 N 维空间，因此无法在不丢失信息的情况下投影距离度量：

```
distance projected onto X: (x,y,z).(1,0,0) = x 
```

但是，您可以使用考虑多个维度的向量，但最终会得到相距相同的元素：

```
(30,0,0).(1/3,1/3,1/3) = (0,30,0).(1/3,1/3,1/3) = (0,0,30).(1/3,1/3,1/3) = 10 
```

**所以现在解决方案：**您希望做的最好的事情是使用主[成分分析](http://en.wikipedia.org/wiki/Principal_component_analysis "耶为 PCA！")进行聚类，以找到您的字符串差异最大的三个维度。这又取决于您使用的距离度量的组成部分，并且不重要（即，我不想让这篇文章更长）。

对于一个快速的解决方案，我建议您使用下面描述的 3 个字符串的 Levenstein 距离*快速尝试在 head 中的 PCA*：

```
"acegikmoqsuwy" //use half your permitted symbols then repeat until you have a string of size equal to your longest string.
"bdfhjlnprtv" //use the other half then repeat as above.
"" //The empty string, this will just give you the length of the string, so a cheap one. 
```

此外，如果您想深入了解，这对指标/距离可能会有所帮助： [http ://www.springer.com/mathematics/geometry/book/978-3-642-00233-5](http://www.springer.com/mathematics/geometry/book/978-3-642-00233-5)

和 levenstein 距离演示：[http ://www.merriampark.com/ld.htm](http://www.merriampark.com/ld.htm)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-31T14:18:31.627

我想扩展 FryGuy 的答案，为什么它不能在任何固定数量的维度上工作。让我们拿`aaaaaaaaaa`和`baaaaaaaaa`, `abaaaaaaaa`, ... , `aaaaaaaaab`. 在此示例中，字符串的长度为 10，但它们可以是任意长度。`b`10 个字符串中的每一个的距离`aaaaaaaaaa`是 1，它们之间的距离是 2。一般来说，如果你在 2 个字母的字母表上取长度为 N 的固定字符串，它们的距离图是一个 N 维超立方体。

除非您的字符串长度有限，否则您无法将其映射到固定数量的维度。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-30T23:23:26.473

测量与空字符串的编辑距离，但不是将每个编辑视为具有值“1”，而是将其在按使用频率排序的字母表中添加/删除的字母的索引（etaoinshrdlu ...），并且如果您的算法允许您将替换检测为替换而不是插入+删除对，则字母索引之间的差异。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-31T16:42:54.427

您还可以尝试研究潜在语义分析和向量空间模型，但问题是您必须限制最大字符串长度。

您的尺寸是字母表元素和字符串中位置的乘积。给定字母表（“a”、“b”、“c”、“t”）和最大长度为 3，尺寸为 (a:1, b:1, c:1, t:1, ... , a:3, b:3, c:3, t:3)

例如，`"cat"`变为 (0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1)。

这当然是一个巨大的数据集，但您可以使用降维技术（如[SVD](http://en.wikipedia.org/wiki/Singular_value_decomposition)）来减少维数。这应该很好用，因为单词中有许多重复出现的模式。您可以调整输出维度的数量以满足您的需求。

两个词之间的相似度可以通过词向量之间的余弦相似度来计算。您还可以存储 SVD 的变换向量以获得单词的简化向量，甚至是以前看不见的向量。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-30T22:51:24.837

要克服“相对距离”问题，您需要做的就是取一个固定点进行测量。

您仍然可以使用 Levenstein 距离，但从固定的“Origin”字符串中获取。例如，您可以使用所有空格的任意长度字符串作为原始字符串。

无论如何，我会先用一小部分已知字符串对其进行测试，以查看这些值是否反映了您希望看到的内容。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-01-31T03:48:14.863

这是对这个问题的“头脑风暴”回答。

基本上，这计算了句子 2 与句子 1 的距离，作为与句子 1 的笛卡尔距离（假设在原点），其中距离是 2 个句子中单词之间的最小 Levenshtein 差异的总和。它具有 2 个相等的句子给出 0 距离的特性。

如果这种方法已在其他地方发表，我不知道。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Diagnostics;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            string str1 = "The cat sat on the mat";
            string str2 = "The quick brown fox jumped over the lazy cow";
            ReportDifference(str1, str1);
            ReportDifference(str2, str2);
            ReportDifference(str1, str2);
            ReportDifference(str2, str1);
        }
        /// <summary>
        /// Quick test andisplay routine
        /// </summary>
        /// <param name="str1">First sentence to test with</param>
        /// <param name="str2">Second sentence to test with</param>
        static void ReportDifference(string str1, string str2)
        {
            Debug.WriteLine(
                String.Format("difference between \"{0}\" and \"{1}\" is {2}", 
                str1, str2, Difference(str1, str2))); 
        }
        /// <summary>
        /// This does the hard work.
        /// Basically, what it does is:
        /// 1) Split the stings into tokens/words
        /// 2) Form a cartesian product of the 2 lists of words. 
        /// 3) Calculate the Levenshtein Distance between each word.
        /// 4) Group on the words from the first sentance
        /// 5) Get the min distance between the word in first sentence and all of the words from the second
        /// 6) Square the distances for each word. 
        ///     (based on the distance betwen 2 points is the sqrt of the sum of the x,y,... axises distances
        ///     what this assumes is the first word is the origin)
        /// 7) take the square root of sum
        /// </summary>
        /// <param name="str1">sentence 1 compare</param>
        /// <param name="str2">sentence 2 compare</param>
        /// <returns>distance calculated</returns>
        static double Difference(string str1, string str2)
        {
            string[] splitters = { " " };

            var a = Math.Sqrt(
                (from x in str1.Split(splitters, StringSplitOptions.RemoveEmptyEntries)
                     from y in str2.Split(splitters, StringSplitOptions.RemoveEmptyEntries)
                     select new {x, y, ld = Distance.LD(x,y)} )
                    .GroupBy(x => x.x)
                    .Select(q => new { q.Key, min_match = q.Min(p => p.ld) })
                    .Sum(s =>  (double)(s.min_match * s.min_match )));
            return a;
        }
    }

    /// <summary>
    /// Lifted from http://www.merriampark.com/ldcsharp.htm
    /// </summary>
    public class Distance
    {

        /// <summary>
        /// Compute Levenshtein distance
        /// </summary>
        /// <param name="s">String 1</param>
        /// <param name="t">String 2</param>
        /// <returns>Distance between the two strings.
        /// The larger the number, the bigger the difference.
        /// </returns>
        public static int LD(string s, string t)
        {
            int n = s.Length; //length of s
            int m = t.Length; //length of t
            int[,] d = new int[n + 1, m + 1]; // matrix
            int cost; // cost
            // Step 1
            if (n == 0) return m;
            if (m == 0) return n;
            // Step 2
            for (int i = 0; i <= n; d[i, 0] = i++) ;
            for (int j = 0; j <= m; d[0, j] = j++) ;
            // Step 3
            for (int i = 1; i <= n; i++)
            {
                //Step 4
                for (int j = 1; j <= m; j++)
                {
                    // Step 5
                    cost = (t.Substring(j - 1, 1) == s.Substring(i - 1, 1) ? 0 : 1);
                    // Step 6
                    d[i, j] = System.Math.Min(System.Math.Min(d[i - 1, j] + 1, d[i, j - 1] + 1),
                              d[i - 1, j - 1] + cost);
                }
            }
            // Step 7
            return d[n, m];
        }
    }
} 
```

# search - 如何使用 HitCollector 按字段值对 Lucene 结果进行排序？

> ID：497609
> 
> 赞同：16
> 
> 时间：2009-01-30T22:55:39.353
> 
> 标签：search, lucene

我正在使用以下代码在 Lucene.Net 中执行查询

```
var collector = new GroupingHitCollector(searcher.GetIndexReader());
searcher.Search(myQuery, collector);
resultsCount = collector.Hits.Count; 
```

如何根据字段对这些搜索结果进行排序？

* * *

## 更新

谢谢[你的回答](https://stackoverflow.com/questions/497609/sorting-lucene-search-results/500409#500409)。我曾尝试使用，但当我作为参数值传递时`TopFieldDocCollector`出现错误消息。请建议一个有效的值来传递。`"value is too small or too large"``5000``numHits`

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-30T23:04:40.350

该[`search.Searcher.search`](http://lucene.apache.org/core/3_0_3/api/core/org/apache/lucene/search/IndexSearcher.html#search%28org.apache.lucene.search.Weight,%20org.apache.lucene.search.Filter,%20int,%20org.apache.lucene.search.Sort%29)方法将接受一个[`search.Sort`](http://lucene.apache.org/core/3_0_3/api/core/org/apache/lucene/search/Sort.html)参数，该参数可以简单地构造为：

```
new Sort("my_sort_field") 
```

但是，可以对哪些字段进行排序有一些限制——它们需要被索引但不被标记化，并且值可以转换为`String`s、`Float`s 或`Integer`s。

[Lucene in Action](http://www.manning.com/hatcher2/)涵盖了所有细节，以及按多个字段排序等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-01T08:01:02.077

您正在寻找的可能是[TopFieldDocCollector](http://hudson.zones.apache.org/hudson/job/Lucene-trunk/javadoc//org/apache/lucene/search/TopFieldDocCollector.html)。使用它来代替`GroupingHitCollector`（那是什么？），或者在里面。

如果您需要更多信息，请对此发表评论。我很乐意提供帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T18:22:33.710

在 Lucene 的原始 (Java) 版本中，对结果的大小没有硬性限制`TopFieldDocCollector`。接受任何大于零的数字。尽管内存限制和性能下降会产生一个取决于您的环境的实际限制，但 5000 次点击是微不足道的，不应该在移动设备之外造成问题。

也许在移植 Lucene 时，`TopFieldDocCollector`它​​被修改为使用 Lucene 的“堆”实现（称为`PriorityQueue`，由 扩展`FieldSortedHitQueue`）以外的东西——这对结果大小施加了不合理的小限制。如果是这样，您可能想查看 的源代码`TopFieldDocCollector`，并使用更好的堆实现来实现您自己的类似命中收集器。

但是，我不得不问，您为什么要收集 5000 个结果？交互式应用程序中的用户不会希望看到这么多。我认为愿意查看 200 个结果的用户很少见，但作为安全因素，将其翻倍至 400 个。根据应用程序，限制结果大小可能会阻碍恶意屏幕抓取并减轻拒绝服务攻击。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-04-06T18:09:26.650

仅接受字符串字段名称的 Sort 构造函数已被弃用。现在您必须创建一个排序对象并将其作为[searcher.Search()的最后一个参数传入](https://lucene.apache.org/core/5_3_0/core/org/apache/lucene/search/IndexSearcher.html#search(org.apache.lucene.search.Query,%20int,%20org.apache.lucene.search.Sort))

```
/* sorting by a field of type long called "size" from greatest -> smallest 
(signified by passing in true for the last isReversed paramater)*/

Sort sorter = new Sorter(new SortField("size", SortField.Type.LONG, true))
searcher.Search(myQuery, collector, sorter); 
```

# vba - 在文档中查找一个字符串并删除它之后的所有内容

> ID：497624
> 
> 赞同：3
> 
> 时间：2009-01-30T23:06:20.330
> 
> 标签：vba, ms-word, ms-office, range, document

我想在word文档中找到一个字符串并删除它之后的所有内容。

不使用`Selection`对象的最佳方法是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-31T02:39:46.123

改为使用`Range`对象。直接离开 Word 2003 帮助：

> 如果您从 Range 对象获得 Find 对象，则在找到匹配查找条件的文本时选择不会更改，但 Range 对象会被重新定义。下面的示例在活动文档中定位单词“blue”的第一次出现。如果在文档中找到“蓝色”，则重新定义 myRange

```
Set myRange = ActiveDocument.Content
myRange.Find.Execute FindText:="blue", _
    Forward:=True
If myRange.Find.Found = True Then 
```

现在使用该对象的`SetRange`方法`Range`使范围的开头成为您搜索的字符串结尾之后的下一个字符，并使范围的结尾成为文档的结尾：

```
myRange.SetRange (myRange.End + 1), ActiveDocument.Content.End 
```

（TODO：当您的字符串是文档中的最后一件事时，您需要处理这种情况）

要删除内容：

```
myRange.Delete 
```

# c# - C# 为什么这个子字符串不起作用？错误：输入字符串的格式不正确

> ID：497629
> 
> 赞同：1
> 
> 时间：2009-01-30T23:08:03.243
> 
> 标签：c#, string

问题在于 txt 框值的转换，但为什么呢？

```
string strChar = strTest.Substring(0, Convert.ToInt16(txtBoxValue.Text)); 
```

错误是：输入字符串的格式不正确。

谢谢大家。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-30T23:09:51.837

txtBoxValue.Text 可能不包含有效的 int16。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T23:17:56.250

避免该错误的一个好方法是使用 .tryParse（.net 2.0 及更高版本）

```
int subLength;

if(!int.TryParse(txtBoxValue.Text,out subLength)
   subLength= 0;

string strChar = strTest.Substring(0, subLength); 
```

这样，如果 txtBoxValue.Text 不包含有效数字，则 subLength 将设置为 0；

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-30T23:22:36.303

您可能想尝试的一件事是使用 TryParse

```
Int16 myInt16;
if(Int16.TryParse(myString, out myInt16)
{
   string strChar = strTest.Substring(0, myInt16);
}
else
{
   MessageBox.Show("Hey this isn't an Int16!");
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T23:15:42.043

代码可能有问题的几个原因。要真正确定它，请将您的简短转换放在一个新行上，如下所示：

```
short val = Convert.ToInt16(txtBoxValue.Text);
string strChar = strTest.Substring(0, val); 
```

可能 txtBoxValue.Text 中的值不短（它可能太大，或者其中包含字母字符）。如果它是有效的并且 val 被分配，那么 strTest 中可能没有足够的字符来使 substring 工作，尽管这通常会返回一个不同的错误。此外，子字符串的第二个参数可能需要一个 int（不确定，现在无法测试），因此您可能需要实际转换为 int32 而不是 16。

测试期间 txtBoxValue.Text 的值是多少？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T23:27:48.710

ASP.NET 提供了几个用于检查用户输入的验证控件。如果您期望特定类型的输入（例如整数），您应该在 WebForm 中使用 CompareValidator 或 RegularExpressionValiditor 之类的东西。

# c++ - 安全地覆盖 C++ 虚函数

> ID：497630
> 
> 赞同：102
> 
> 时间：2009-01-30T23:08:03.743
> 
> 标签：c++, overriding, virtual-functions

我有一个带有虚函数的基类，我想在派生类中重写该函数。有没有办法让编译器检查我在派生类中声明的函数是否实际上覆盖了基类中的函数？我想添加一些宏或其他东西，以确保我不会意外声明一个新函数，而不是覆盖旧函数。

举个例子：

```
class parent {
public:
  virtual void handle_event(int something) const {
    // boring default code
  }
};

class child : public parent {
public:
  virtual void handle_event(int something) {
    // new exciting code
  }
};

int main() {
  parent *p = new child();
  p->handle_event(1);
} 
```

这里`parent::handle_event()`被调用而不是`child::handle_event()`，因为孩子的方法错过了`const`声明，因此声明了一个新方法。这也可能是函数名称的拼写错误或参数类型的一些细微差别。如果基类的接口发生更改并且某些派生类未更新以反映更改，也很容易发生这种情况。

有什么方法可以避免这个问题，我可以告诉编译器或其他工具帮我检查吗？任何有用的编译器标志（最好是 g++）？你如何避免这些问题？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2012-07-23T09:37:00.913

从 g++ 4.7 开始，它确实理解新的 C++11`override`关键字：

```
class child : public parent {
    public:
      // force handle_event to override a existing function in parent
      // error out if the function with the correct signature does not exist
      void handle_event(int something) override;
}; 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-01-30T23:31:01.793

像 C# 的`override`关键字这样的东西不是 C++ 的一部分。

在 gcc 中，`-Woverloaded-virtual`警告不要隐藏具有相同名称但签名完全不同的函数的基类虚函数，它不会覆盖它。但是，它不会保护您不会因为函数名称本身拼写错误而无法覆盖函数。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-01-30T23:32:24.443

据我所知，你不能把它抽象化吗？

```
class parent {
public:
  virtual void handle_event(int something) const = 0 {
    // boring default code
  }
}; 
```

我以为我在 www.parashift.com 上读到过，您实际上可以实现一个抽象方法。这对我个人来说是有道理的，它唯一做的就是强制子类实现它，没有人说它不允许自己实现。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-01-31T00:26:23.633

`override`在 MSVC 中，即使不是为 CLR 编译，也可以使用 CLR关键字。

在 g++ 中，没有直接的方法可以在所有情况下强制执行。其他人就如何使用`-Woverloaded-virtual`. 在未来的版本中，有人可能会`__attribute__ ((override))`使用 C++0x 语法添加类似或等效的语法。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2011-07-16T18:55:23.943

在 MSVC++ 中，您可以使用[关键字`override`](http://msdn.microsoft.com/en-us/library/41w3sh1c(VS.80).aspx)

```
class child : public parent {
public:
  virtual void handle_event(int something) <b>override</b> {
    // new exciting code
  }
}; 
```

`override`适用于 MSVC++ 中的本机代码和 CLR 代码。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-01-31T07:56:38.467

使函数抽象化，以便派生类除了重写它之外别无选择。

@Ray 您的代码无效。

```
class parent {
public:
  virtual void handle_event(int something) const = 0 {
    // boring default code
  }
}; 
```

抽象函数不能具有内联定义的主体。必须修改为

```
class parent {
public:
  virtual void handle_event(int something) const = 0;
};

void parent::handle_event( int something ) { /* do w/e you want here. */ } 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-30T23:12:45.293

我建议对您的逻辑稍作改动。它可能会或可能不会起作用，这取决于您需要完成的工作。

handle_event() 仍然可以执行“无聊的默认代码”，但不是虚拟的，而是在您希望它执行“新的令人兴奋的代码”时让基类调用抽象方法（即必须重写）方法这将由您的后代班级提供。

编辑：如果您后来决定您的某些后代类*不需要*提供“新的令人兴奋的代码”，那么您可以将抽象更改为虚拟并提供该“插入”功能的空基类实现。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-30T23:17:45.753

如果基类函数被隐藏，您的编译器可能会生成一个警告。如果是，请启用它。这将捕获参数列表中的 const 冲突和差异。不幸的是，这不会发现拼写错误。

例如，这是 Microsoft Visual C++ 中的警告 C4263。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-10-07T15:14:00.557

当C++11`override`关键字与派生类中的函数声明一起使用时，它会强制编译器检查声明的函数是否实际上覆盖了某些基类函数。否则，编译器会抛出错误。

因此，您可以使用`override`说明符来确保动态多态性（函数覆盖）。

```
class derived: public base{
public:
  virtual void func_name(int var_name) override {
    // statement
  }
}; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-06-13T01:48:56.710

```
class MyClass {
public:

  MyClass() {}
  virtual uint32_t someFunction(bool param = false) {
    if (param) {
      std::cout << "This is an example virtual function with default code" << std::endl;
    }
    return 1100;  //just for return something
  }; 
```

*   然后您可以根据需要覆盖该功能

```
class MyClass2 : public MyClass  {
public:
  MyClass2();
  uint32_t someFunction(bool param) override;
}; 
```

```
 uint32_t MyClass2::someFunction(bool verbose) {
  std::cout << "This is new implementation for virtual method " << std::endl;

} 
```

# algorithm - 将数值列表映射到颜色

> ID：497635
> 
> 赞同：5
> 
> 时间：2009-01-30T23:08:58.000
> 
> 标签：algorithm, colors, contrast, color-mapping

我有一个数值列表。如果需要，我可以标准化这些值。

我需要将此列表转换为颜色列表（在 HSL、RGB 或任何其他颜色模型中——我总是可以稍后进行转换）。

对于任何给定的值，颜色每次都必须相同。

两个给定数值越不同，对应值的对比度应该越大。

所有使用的颜色必须尽可能相互对比（这是一个软限制，粗略的解决方案就可以了）。

请注意，列表相当大（数以千计的数字），因此简单地将所有数字压缩到单个颜色通道中会产生过于密集的结果。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-30T23:30:27.550

无论您最终选择哪种算法，都可以尝试[CIELAB](http://en.wikipedia.org/wiki/CIELAB)色彩空间。它将人类颜色感知的差异归一化，因此相等的数字间距会产生相等的感知差异。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-30T23:37:48.690

您可以考虑在您选择的色彩空间中使用 3D[空间填充曲线。](http://en.wikipedia.org/wiki/Space-filling_curve)我会支持 Mark 的[CIELAB](http://en.wikipedia.org/wiki/CIELAB)建议，希望上次我必须解决类似问题时知道这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-30T23:13:12.157

请参阅：[如何自动生成 N 个“不同”颜色？](https://stackoverflow.com/questions/470690/how-to-automatically-generate-n-distinct-colors)

最好标准化您的值，并通过我建议的代码运行它们（其中色调 == 您的值），构建地图/哈希。（您可以改用哈希样式的函数，这可能更有效。）

例如，您可以使用数字的某些预定位“随机化”亮度（或亮度，取决于您的型号）和饱和度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T23:13:11.893

为什么不使用灰色阴影？只需计算最小/最大值并使用它将每个数字转换为从白色到黑色的不同阴影。

我知道这不是颜色，但在我看来，解释结果会更容易。我可以说出颜色较深与较浅的含义，但谁能说，例如，绿色比橙色的值更高？

# rss - 任何人都可以推荐一个好的（最好是免费的）工具来将文件和文件内容转换为 RSS 吗？

> ID：497637
> 
> 赞同：-1
> 
> 时间：2009-01-30T23:09:37.907
> 
> 标签：rss

我需要一些东西来获取目录的内容，然后根据目录中的文件继续生成 RSS，这意味着：

```
/myDir -ls 
.
..
a.xml
b.xml
c.xml
d.txt 
```

我正在寻找的机制只会查看扩展名为 .xml 的文件，并将它们的内容组合成一个更大的 .xml（或 .rss）文件，然后通过 HTTP 将其吐出。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-30T23:32:41.073

您可能想看看[ROME](https://rome.dev.java.net/)。它是一个很棒的实用程序，可让您创建、使用和操作*所有*类型的提要，无论它们是 RSS 还是任何版本的 ATOM。

帮助您入门的快速文章是[ROME in a Day: Parse and Publish Feeds in Java](http://www.xml.com/pub/a/2006/02/22/rome-parse-publish-rss-atom-feeds-java.html)。

# ruby-on-rails - ActiveRecord 的两个外键？[导轨]

> ID：497647
> 
> 赞同：4
> 
> 时间：2009-01-30T23:15:23.370
> 
> 标签：ruby-on-rails, foreign-keys

我有一个引用 Message 类的 User 类。消息类有一个`user_id` （即发送者）和一个`receiver_id`. 所以在用户类中我有

```
 has_many :messages
  has_many :messages, :foreign_key => "receiver_id" 
```

然后在我的 Message 类中

```
 belongs_to :user 
```

第一个关系——通过`user_id`——非常顺利。**我一点也不知道在第二个关系的 Message 类中放什么。**消息表是用`user_id`和构建的`receiver_id`，所以支持就在那里。

**这甚至可能吗？**

另外，我不知道如何获取用户收到的消息......或收到消息的用户:)

[我知道我可以通过有一个发送者表和一个接收者表和一个消息表，也许还有一堆其他表（一个对话表！）来解决这个问题，但我想这样做，为了好玩其中。此应用程序将仅用于学习。]

同样重要的是：文档在哪里？[这](http://api.rubyonrails.org/files/vendor/rails/activerecord/lib/active_record/associations/has_one_through_association_rb.html)不是很有帮助。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-30T23:34:49.913

在您的用户类中：

```
has_many :messages
has_many :received_messages, 
         :foreign_key => "receiver_id", :class_name => "Message" 
```

在您的 Message 类中：

```
belongs_to :user
belongs_to :receiver, :class_name => "User"

@user = User.first
@user.messages
@user.received_messages 
```

# c# - Enterprise Library Database.ExecuteNonQuery 隐藏的性能问题（连接到 IBM iSeries）

> ID：497649
> 
> 赞同：2
> 
> 时间：2009-01-30T23:17:41.743
> 
> 标签：c#, oledb, enterprise-library, ibm-midrange

我想知道在企业库中使用数据库对象的隐藏性能影响是什么。我有一个 OleDbCommand (type=stored procedue) 正在调用一个 IBM iSeries 存储过程，该过程需要 1.5 到 4.5 分钟才能完成。

如果我使用 iSeries 工具和类似参数手动运行存储过程，则大约需要 5 秒。因此，性能下降要么是在与 iSeries 的网络通信中，要么是在企业库中的数据库对象中隐藏的东西。只是寻找任何想法。

```
m_asi = DatabaseFactory.CreateDatabase("ASI-TEST");
using (var cmd = new OleDbCommand())
{
    cmd.CommandType = CommandType.StoredProcedure;
    cmd.CommandText = string.Format("{0}.P_VNDR_INV", m_strASISprocCatalog);
    cmd.Parameters.Add("@RUN_ENV", OleDbType.Char, 1).Value = strEnvironmentCode;
    cmd.Parameters.Add("@SIS_KEY", OleDbType.Char, 36).Value = InvFilter.SISKey;
    cmd.Parameters.Add("@FROM_DTE", OleDbType.Char, 8).Value = InvFilter.CheckDateFrom.ToString("yyyyMMdd");
    cmd.Parameters.Add("@TO_DTE", OleDbType.Char, 8).Value = InvFilter.CheckDateTo.ToString("yyyyMMdd");
    cmd.Parameters.Add("@EXT_Y", OleDbType.Char, 1).Value = (InvFilter.IsExternal ? "Y" : "N");
    cmd.Parameters.Add("@INC_Y", OleDbType.Char, 1).Value = (InvFilter.IncludeASI ? "Y" : "N");
    cmd.Parameters.Add("@VND_ID", OleDbType.Char, 1800).Value = InvFilter.GetVendorQueryString(18, 1800);

    // This call is the bottleneck
    m_asi.ExecuteNonQuery(cmd);
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T23:21:54.823

我*希望*它是一些与 iSeries 工具和 .NET 客户端不同的奇怪设置 - 例如：

*   交易模式？
*   安西设置？
*   其他连接选项？（对于 SQL Server，我的意思是 SET CONCAT_NULL_YIELDS_NULL 等）

我对 iSeries 了解不多，但以 SQL Server 为例，如果一切都恰到好处，它只能使用“索引持久计算”列；否则它会重新计算每行的公式。

你试过追踪吗？

# python - 频繁修改模型时的Django工作流程？

> ID：497654
> 
> 赞同：25
> 
> 时间：2009-01-30T23:18:54.737
> 
> 标签：python, django, django-models, workflow, django-syncdb

因为我通常不会在 Django 项目中对我的模型进行前期设计，所以我最终会大量修改模型，因此每次都会删除我的测试数据库（因为“syncdb”永远不会为您自动更改表）。下面是我的工作流程，我想听听你的。欢迎任何想法..

1.  修改模型。
2.  删除测试数据库。（对我来说总是一个简单的 sqlite 数据库。）
3.  运行“同步数据库”。
4.  通过代码生成一些测试数据。
5.  转到 1。

关于这个的第二个问题..如果您的工作流程像上面那样，您如何执行 4\. 步骤？您是手动生成测试数据还是在 Django 应用程序中有适当的挂钩点，您可以在服务器启动时注入测试数据生成代码？\

TIA。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-30T23:29:45.337

步骤 2 和 3 可以一步完成：

```
manage.py reset appname 
```

据我了解，第 4 步最容易管理，方法是使用[固定装置](http://www.djangoproject.com/documentation/models/fixtures/)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-01-30T23:32:02.197

这是 Django 固定装置的工作。它们很方便，因为它们独立于数据库，并且测试工具（和 manage.py）具有对它们的内置支持。

要使用它们：

1.  使用管理工具在您的应用程序中设置您的数据（称之为“foo”）
2.  在您的“foo”应用程序目录中创建一个fixtures 目录
3.  类型：`python manage.py dumpdata --indent=4 foo > foo/fixtures/foo.json`

现在，在您的 syncdb 阶段之后，您只需键入：

```
 python manage.py loaddata foo.json 
```

您的数据将被重新创建。

如果您希望它们出现在测试用例中：

```
class FooTests(TestCase):
    fixtures = ['foo.json'] 
```

请注意，如果您的架构发生巨大变化，您将不得不重新创建或手动更新您的固定装置。

您可以在 django docs for [Fixture Loading中阅读更多关于fixture 的信息](http://docs.djangoproject.com/en/dev/topics/testing/#fixture-loading)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-01-31T02:39:00.573

这就是我们所做的。

1.  应用程序以架构版本号命名。 `appa_2`,`appb_1`等。

2.  微小的变化不会改变数字。

3.  重大更改会增加数字。同步数据库有效。并且可以编写“数据迁移”脚本。

    ```
    def migrate_appa_2_to_3():
        for a in appa_2.SomeThing.objects.all():
            appa_3.AnotherThing.create( a.this, a.that )
            appa_3.NewThing.create( a.another, a.yetAnother )
        for b in ... 
    ```

关键是 drop 和 recreate 并不总是合适的。有时将数据从旧模型移动到新模型而不从头开始重建会很有帮助。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-03-12T00:33:46.143

南方最酷。

虽然当数据无关紧要时，好的 ol' 重置效果最好。

[http://south.aeracode.org/](http://south.aeracode.org/)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-31T02:43:29.737

为了补充 Matthew 的回复，我还经常使用自定义 SQL 来提供[此处](http://docs.djangoproject.com/en/dev/howto/initial-data/#providing-initial-sql-data)记录的初始数据。

Django 只是在或期间创建表后在其中查找文件`<app>/sql/<modelname>.sql`并运行它们。当我需要从其他非 Django 数据库表中填充我的 Django 表时，我会使用自定义 SQL。`syncdb``sqlreset`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-31T02:48:53.907

就我个人而言，我的开发数据库是针对我现在正在处理的一个项目的，它相当大，所以我使用[dmigrations](http://code.google.com/p/dmigrations/)创建数据库迁移脚本来修改数据库（而不是像我一开始那样每次都清除数据库）。

编辑：实际上，我现在正在使用 South :-)

# c# - 我可以在我的开发机器上模拟 MS Compute Cluster Server 吗？

> ID：497656
> 
> 赞同：4
> 
> 时间：2009-01-30T23:19:10.600
> 
> 标签：c#, .net, cluster-computing, hpc

我有一个客户项目，其中包括管理 MS Compute Cluster 上的作业。我将在他们的网络之外开发应用程序，并且想要一种无需在他们的网络上就可以开发/调试我的应用程序的方法。

我正在用 C# 开发应用程序，到目前为止我只有 Microsoft Compute Cluster Pack SDK。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T17:57:44.913

网络广播很有帮助，因为它把我带到了 MPI.Net API。MPI.Net 将允许我编写一个可以通过 mpiexec.exe 启动的可执行文件，并且可以管理创建和监视并行任务的过程。据我了解，集群中的头节点会自动将每个任务委派给我合适的计算节点。

由于 mpiexec.exe 随 ComputeCluster SDK 一起提供，并且将在我的多核开发机器上运行，因此这可能足够接近集群仿真来完成我的工作。

谢谢你的帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T00:58:05.123

根据您的开发机器的“健壮性”，您可以使用 HyperV 相对轻松地设置本地集群。您不会看到实际集群/实际硬件的生产力提升，但对于您尝试构建的管理工具，它应该可以正常工作。具有 4-8 GB ram 的商品盒应该可以很好地创建一个头节点和两个用于开发/测试的子节点。

# php - 如何检查函数是否可以使用参数调用？

> ID：497657
> 
> 赞同：3
> 
> 时间：2009-01-30T23:19:44.517
> 
> 标签：php

我正在使用 call_user_func_array 调用一个函数：

```
call_user_func_array(array($this, 'myFunction'), array('param1', 'param2', 'param3')); 
```

一切都很好，除非我不知道函数需要多少参数。如果函数需要 4 个参数，它会向我发送一个错误，我想测试我是否可以调用该函数（使用参数数组）。is_callable() 不允许参数检查。编辑：如果调用失败，我需要调用另一个函数，这就是我需要检查的原因。

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-31T00:24:49.767

您可以使用反射来获取参数的数量：

```
$refl = new ReflectionMethod(get_class($this), 'myFunction');
$numParams = $refl->getNumberOfParameters(); 
```

或者

```
$numParams = $refl->getNumberOfRequiredParameters(); 
```

有关更多信息，请参见[此处](http://uk.php.net/manual/en/language.oop5.reflection.php#language.oop5.reflection.reflectionmethod)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T23:30:24.620

解决此问题的一种方法是始终使用*大量*参数调用该函数。PHP 的设计方式是，您可以传递任意数量的无关参数，而多余的参数将被函数定义忽略。

请参阅手册条目[`func_get_args()`](http://php.net/func-get-args)以查看有关此的说明。

*编辑：*正如用户 crescentfresh 指出的那样，这不适用于内置函数，仅适用于用户定义的函数。如果您尝试将太多（或很少）参数传递给内置函数，您将收到以下警告：

```
警告：命令行代码中 strpos() 的参数计数错误 [...]
```

# c++ - 我可以在没有 COM 的情况下将 x-headers 添加到 Lotus Notes 电子邮件消息吗？

> ID：497659
> 
> 赞同：0
> 
> 时间：2009-01-30T23:20:49.660
> 
> 标签：c++, mime, lotus-notes, email, email-client

在从 Lotus Notes 客户端应用程序发送邮件之前，尝试从 Notes 客户端扩展的上下文将自定义标题项添加到 Lotus Notes 电子邮件项。

这可能吗？

如果可能的话，我正在考虑使用 NSFItemSetText 系列函数中的某些东西，而不是我收集的莲花脚本对象模型是 COM 组件。

我在继承的代码中实现了这一点，并且没有关于我应该在哪里寻找这类事情的教程的参考。

基本的谷歌搜索将我带入了可怕的 IBM 参考站点的领域，而且肯定有比这更好的东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-06T13:28:32.877

您可以使用 mailsrv.h 中的 MailAddHeaderItem 函数添加[标题](http://www-12.lotus.com/ldd/doc/tools/c/7.0/api70ref.nsf/852561e0006ccd85852561bf006728c8?OpenView&Start=30&Count=30&Expand=42.2#42.2)

如果您使用 NSFItemSetText，您可能有基于 SENDMEMO 示例的代码。查看使用 MailAddHeaderItemByHandle 引用的 SENDMAIL 示例。这些示例包含在 C api 工具包中，如果您还没有，可以[在此处下载。](http://www14.software.ibm.com/webapp/download/nochargesearch.jsp?k=ALL&S_TACT=104CBW71&status=Active&q=Lotus+%22C+API%22)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T15:05:13.747

NotesMimeEntity 和 NotesMimeHeader 类应该为您提供所需的功能。我假设您可以访问 Notes Developer 客户端，因此请查看 Developer Help 以获取有关使用的一些很好的示例。

我只在 LotusScript 中使用过这些类，我不确定它们的工作方式是否不同，或者根本不通过 COM。

# windows-services - 以登录用户身份运行的 Windows 服务存在 UAC 的访问问题 b/c

> ID：497661
> 
> 赞同：0
> 
> 时间：2009-01-30T23:21:21.533
> 
> 标签：windows-services, windows-vista, uac

我有一个以登录用户（本地管理员）身份运行的 Windows 服务。在启动期间，我收到一条消息：“无法生成临时类（结果 = 1）”。所以，我去了 windows/temp 文件夹，UAC 提示我提升我的权限——在我这样做之后，服务会正常启动。那么，我该如何从 Windows 服务的角度来处理这个 UAC 提示呢？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-08-29T23:39:47.647

关于最初的问题 - 除了解决您的症状的事件顺序的具体问题。

当属于本地管理员组成员的用户登录到 UAC 下的计算机时，将授予两个安全令牌 - 一个具有有限权限，一个具有更高权限集。默认情况下，使用较低的权限 - 除非主动指定了较高的权限。指定的主要方式是通过 UI - 正如您所做的那样。另一种方法是使用应用程序清单：指定操作系统如何处理此应用程序的 XML 文件。清单文件应与可执行文件放在同一文件夹中，并使用以下格式命名：“my_application_name.exe.manifest”

清单中的 XML 如下所示：
`<?xml version="1.0" encoding="UTF-8" standalone="yes"?> <assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0"> <assemblyIdentity version="1.0.0.0" name="MY_APPLICATION_NAME" type="win32"/> <trustInfo xmlns="urn:schemas-microsoft-com:asm.v3"> <security> <requestedPrivileges> <requestedExecutionLevel level="requireAdministrator"/> </requestedPrivileges> </security> </trustInfo> </assembly>`
我相信你可以通过谷歌搜索“UAC Manifest”找到更多具体信息......

希望这是有用的...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-31T00:43:56.030

即使我仍然不知道如何回答我的问题，我也解决了我的问题。基本上，我的服务从引导过程继承了临时目录，所以我将其更改为使用当前用户的临时目录。您将需要按照以下方式做一些事情：

myProcess.StartInfo.EnvironmentVariables.Add("TempPath", "C:\Temp")

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-04T19:27:33.967

为什么不让 Windows 服务作为 LocalSystem 运行？

# search - 是否有任何搜索引擎可以搜索更深入的网络？

> ID：497663
> 
> 赞同：3
> 
> 时间：2009-01-30T23:21:46.603
> 
> 标签：search

是否有任何搜索引擎可以填补普通搜索引擎返回零结果的空白。

有时我需要进行包含特殊字符的搜索。例如搜索 gnu 构建配置参数“--with-newlib”。谷歌完全破坏我想要搜索的特定字符串 och 字符并没有或没有任何用处的情况并不少见。

知道您想要的搜索词确实很常见但无法返回单个结果，这真的很烦人。

编辑：谷歌代码搜索似乎有它的用途，但它根本不搜索网络。当我搜索网络时，我宁愿拥有包含搜索词的高排名网页。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-30T23:25:38.653

Google 不会存储这些字符以进行正常搜索，因为它们很少见，并且相对于存储额外信息的成本而言，对主流搜索没有太大好处。

对于你想要的，试试[谷歌代码搜索](http://www.google.com/codesearch)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-31T00:06:58.477

我喜欢使用[Clusty](http://clusty.com)，它以组（集群）的形式返回搜索结果，我发现这些结果比原始 Google 结果更容易减少。

[使用您的示例](http://clusty.com/search?v:file=viv_1066@20:YqbdID&v:frame=list&v:state=(root(N454(N442)))|N454&id=N454&action=list&sw=|Gcc|Gcc||Gcc|&sec=1233360080&)查看搜索，[`--with-newlib`](http://clusty.com/search?v:file=viv_1066@20:YqbdID&v:frame=list&v:state=(root(N454(N442)))|N454&id=N454&action=list&sw=|Gcc|Gcc||Gcc|&sec=1233360080&)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-02-05T17:19:48.657

您可以使用一些编码技巧在 Google 上搜索诸如“--with-newlib”之类的字符串。您可能需要对它们进行试验才能找到适合您的组合。您将需要一个 HTML 编码表或计算器，如 ISO 10646、ISO 8879、ISO 8859-1 中所述。

首先，使用 HTML 编号进行编码，例如，搜索（重要的引号）：

```
"&#45;&#45;with&#45;newlib" 
```

使用 HTML 名称编码，例如，搜索：

```
"&amp;" 
```

编码级联 - 运行搜索，注意查询框返回的内容，再次单击搜索按钮，重复

```
"&#38;&#35;38;&#38;&#35;35;57;" 
```

另一个搜索级联示例，这次是在 KML 文件中查询与号编码

```
"&#38;&#35;38;" doctype:xml 
```

您也可以以类似的方式查询 URI 编码，例如 50-100%

```
"50..100&#38;&#35;37;" 
```

或更简单地说

```
"100&#37;26" 
```

归根结底，所有这些搜索都涉及创建一个人工查询来搜索编码字符，以便 Google 不会简单地将其删除。有时这有效，有时则无效。您几乎应该总是用引号括起您的搜索，并且您还应该在首次运行搜索后使用搜索工具--> 所有结果--> 逐字下提供的逐字过滤器尝试运行这些查询。

一个提示 - 选择并复制您的原始查询，因为 Google 在运行搜索后会将 HTML 编码转换为演示格式，您可能希望在再次运行之前将其粘贴并修改查询。

# windows - powershell：有没有人尝试在 windows 2000 服务器上安装 powershell？

> ID：497669
> 
> 赞同：2
> 
> 时间：2009-01-30T23:23:39.063
> 
> 标签：windows, powershell, windows-server-2000

有没有人尝试在 Windows 2000 服务器上安装 powershell？我意识到它不应该安装在 Windows 2000 服务器上，因此不受支持；但是，在其上运行的 vbscript 需要 3.5 天才能完成，powershell 可能会在更短的时间内完成。不过，我注意到它只需要 .NET 2.0 即可运行。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T14:17:17.807

如果您具有对相关 Windows 2000 服务器的管理员访问权限，您可以在同一域中受支持的计算机上运行 PowerShell，并使用 set-location 将您的工作目录更改为远程服务器

```
cd \\remoteserver\<drive>$\path\to\folder\you\want\to\start\in 
```

然后，您可以在远程目录上运行您想要的任何 PowerShell 脚本。如果您开始的文件夹是共享的，那就更简单了（您不需要访问管理员共享）。或者，您可以使用链接到目标目录的 PowerShell 映射计算机上的驱动器。

这可能比在不受支持的机器上强制安装更顺畅。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-06-15T20:06:19.160

是的。这行得通。无需在服务器上安装 Powershell，只需像远程一样与它交谈：-

```
Set-Location "\\MyServer\D$\wwwportal\MyChangedFileFolder\" 
Get-ChildItem -filter *.txt -Recurse 
```

# svn - 在颠覆中取消删除文件的简单方法是什么？

> ID：497670
> 
> 赞同：76
> 
> 时间：2009-01-30T23:23:58.937
> 
> 标签：svn, version-control

这些说明有点令人生畏和困惑：[http](http://svnbook.red-bean.com/en/1.0/ch04s04.html#svn-ch-4-sect-4.3) ://svnbook.red-bean.com/en/1.0/ch04s04.html#svn-ch-4-sect-4.3 。而且他们似乎也没有提到如果您在完成“ `svn rm`” [1] 之后还没有签到，这会简单得多。

所以我认为这将是一个为那些在谷歌上搜索的人记录一个更简单的答案的好地方。

[1] 对于 svn 新手来说，" " 可能会`svn rm`立即销毁文件。我记得我曾经`svn rm`想过将它从源代码控制中删除，并在文件本身实际消失时吓坏了。所以一个子问题是，在不实际删除本地副本的情况下从版本控制中删除文件的正确方法是什么？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-01-30T23:24:06.160

如果你刚刚

```
svn rm foo.txt 
```

然后你可以简单地撤消它

```
svn revert foo.txt 
```

如果您在执行“ `svn rm`”后已经签入，那么您可以查看日志 ( `svn log`)，找到文件存在的最后一个修订版，然后从该版本中获取它。

一种方法是合并具有该文件的旧版本。假设当前版本是 123 并且该文件的最后一个版本是 120，然后执行以下操作：

```
svn merge -r123:120 
```

也许首先做一个试运行以确保它不会做任何你不想要的事情：

```
svn --dry-run merge -r123:120 
```

* * *

对于子问题，如何在不删除本地副本的情况下从 svn 中删除文件：

```
svn rm foo.txt --keep-local 
```

或者，当然，您可以在 svn rm'ing 之前复制到一个临时文件，然后再复制回来：

```
cp foo.txt foo.txt-tmp
svn rm foo.txt
(svn ci -m "just removed foo.txt from the repository")
cp foo.txt-tmp foo.txt 
```

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2010-03-10T20:18:28.750

无论出于何种原因，`-r`arg 对我不起作用（svn 版本 1.6.9）。我在 之前和之后尝试过`src`，但一直收到一条消息，指出在当前修订版中找不到该文件（duh）。与 --revision 相同。使用 @ 样式语法虽然有效：

```
svn cp url/to/removed/foo.txt@4 foo.txt 
```

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2009-01-31T07:51:28.680

要删除文件但将其保留在工作副本中，请使用

```
svn rm foo.txt --keep-local 
```

要在提交删除后取回文件，您可以使用合并命令或复制命令 - 两者都将保留文件历史记录。由于合并方式已经在别处描述，这里是复制方式：

```
svn rm foo.txt
svn ci foo.txt -m "removed file"
(now at r5 as an example)
svn cp url/to/removed/foo.txt -r4 foo.txt
svn ci foo.txt -m "got file back" 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2018-03-12T00:52:53.287

对于 TortoiseSVN 用户，这很容易通过 Repo Browser 完成。在 Repo Browser 中切换到文件被删除之前的版本（您可以使用右上角的“Revision:”按钮更改版本）：

[![在此处输入图像描述](https://i.stack.imgur.com/80fXm.png)](https://i.stack.imgur.com/80fXm.png)

然后，您应该能够在 Repo Browser 的原始位置看到已删除的文件。右键单击它并选择“复制到工作副本...”：

[![在此处输入图像描述](https://i.stack.imgur.com/qMqh6.png)](https://i.stack.imgur.com/qMqh6.png)

然后该文件将恢复到准备提交的工作副本（就像添加了 svn 一样），并且其日志历史记录完好无损。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-04-03T20:35:39.413

在 SVN 中恢复已删除的文件。在删除之前找到修订号（比如 341）。然后将该文件单独恢复为该修订号。

```
svn up -r341 [path_to_deletedFile] 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-04-29T14:03:53.960

我使用了上一个版本中的复制菜单项，使用了乌龟，为我工作并保留了历史记录。

# php - 我应该如何在 PHP 中设计与 SQL 列生成器的接口？

> ID：497679
> 
> 赞同：1
> 
> 时间：2009-01-30T23:27:23.673
> 
> 标签：php, mysql, code-generation, yaml

我正在开发一个 PHP 框架，这个框架的一部分工作是编写 SQL 代码来生成新的 MySQL 列。

为列传递一堆参数然后将其转换为 SQL 代码的最优雅的方法是什么？作为一个例子，我有一些 YAML，它指定了用于创建 varchar 列的参数：

```
- type: character
        data-type:
            type: varchar
            length: 255
            decimals: null
            unsigned: null
            zerofill: null
            collate: utf8_unicode_ci
            character-set: utf8
            binary: false
            spatial-type: null
            values: null
        nullify: true
        default: null
        increment: false
        unique: false
        primary: false
        comment: This is a small general text field.
        format: default
        storage: default 
```

我的设计约束如下：

1.  YAML 不能包含任何 SQL 语法
2.  PHP 代码必须尽可能简洁。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T02:56:49.727

我建议您创建一个 Column 类，作为构造函数参数，该类可以定义您想要的各种配置点的数组。在每个特定情况下无关紧要的那些你只是没有定义。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-31T18:55:58.727

不完全相关，但您知道[Propel](http://propel.phpdb.org/)项目吗？

他们使用 xml 来解释模型，但[symfony 项目](http://www.symfony-project.org)（使用 propel 作为插件）使用 yaml。

# shell - 使用 mplayer 确定音频/视频文件的长度

> ID：497681
> 
> 赞同：12
> 
> 时间：2009-01-30T23:27:49.243
> 
> 标签：shell

以下方法可以很好地确定各种音频/视频文件的长度：

```
mplayer -identify file.ogg 2>/dev/null | grep ID_LENGTH 
```

但是，我想终止 mplayer 的输出，以便更有效地确定许多文件的长度。我怎么做？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-31T03:09:17.080

`MPlayer`源代码附带一个名为 的示例脚本，`midentify`如下所示：

```
#!/bin/sh
#
# This is a wrapper around the -identify functionality.
# It is supposed to escape the output properly, so it can be easily
# used in shellscripts by 'eval'ing the output of this script.
#
# Written by Tobias Diedrich <ranma+mplayer@tdiedrich.de>
# Licensed under GNU GPL.

if [ -z "$1" ]; then
        echo "Usage: midentify.sh <file> [<file> ...]"
        exit 1
fi

mplayer -vo null -ao null -frames 0 -identify "$@" 2>/dev/null |
        sed -ne '/^ID_/ {
                          s/[]()|&;<>`'"'"'\\!$" []/\\&/g;p
                        }' 
```

立即退出，并阻止`-frames 0`它尝试打开任何视频或音频设备。这些选项都记录在.`mplayer``-vo null -ao null``man mplayer`

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-31T00:39:34.667

FFMPEG 可以以不同的格式为您提供相同的信息（并且不会尝试播放文件）：

```
ffmpeg -i <myfile> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-07-03T00:43:51.713

除了@codelogic 的方法之外，还有另一种 FF 方式，它不会因错误而退出：

```
ffprobe <file> 
```

并查找持续时间条目。

或者直接在错误流中对其进行grep：

```
ffprobe <file> 2> >(grep Duration) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-07-05T00:23:00.733

看起来还有其他一些可用的库，请参阅[mp3 文件的时间长度](https://stackoverflow.com/questions/119404/time-length-of-an-mp3-file/5059165#5059165)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2020-04-08T13:05:49.543

下载您的 .mp3 文件，用您的播放器（例如 Windows Media Player）播放，播放器将在播放结束时显示总时间。

# cuda - CUDA 应用程序在几秒钟后超时并失败 - 如何解决这个问题？

> ID：497685
> 
> 赞同：32
> 
> 时间：2009-01-30T23:29:28.957
> 
> 标签：cuda, timeout, gpgpu, gpu

我注意到 CUDA 应用程序在失败并退出之前往往有大约 5-15 秒的粗略最大运行时间。我意识到最好不要让 CUDA 应用程序运行那么长时间，但假设使用 CUDA 是正确的选择，并且由于每个线程的顺序工作量必须运行那么长时间，有没有办法延长这段时间或绕过它？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-03T03:21:56.070

我不是 CUDA 专家，--- 我一直在使用 AMD Stream SDK 进行开发，AFAIK 与它大致相当。

您可以禁用 Windows 看门狗计时器，但***强烈建议不要这样做***，原因应该很明显。要禁用它，您需要 regedit `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Watchdog\Display\DisableBugCheck`，创建一个 REG_DWORD 并将其设置为 1。您可能还需要在 NVidia 控制面板中执行某些操作。在 CUDA 文档中查找对“VPU 恢复”的一些参考。

理想情况下，您应该能够将内核操作分解为对数据的多次传递，以将其分解为在时间限制内运行的操作。

或者，您可以划分问题域，以便每个命令计算更少的输出像素。即，与其一举计算 1,000,000 个输出像素，不如向 GPU 发出 10 个命令，每个命令计算 100,000 个。

必须适应时间片的基本单元不是您的整个应用程序，而是单个命令缓冲区的执行。在 AMD Stream SDK 中，可以通过调用 CtxFlush() 显式刷新命令队列，将长序列的操作分解为多个时间片。也许CUDA有类似的东西？

您**不必**在每个时间片上通过 PCIX 总线来回读取所有数据；您可以将纹理等留在 gpu 本地内存中；您只是偶尔完成一些命令缓冲区，以向操作系统证明您没有陷入无限循环。

最后，GPU*速度很快*，所以如果您的应用程序无法在那 5 或 10 秒内完成有用的工作，我会将其视为出现问题的迹象。

**[编辑 2010 年 3 月更新：** ] *（再次过时，请参阅下面的更新以获取最新信息）*上面的注册表项已过时。我认为这是 Windows XP 64 位的关键。Vista 和 Windows 7 有新的注册表项。您可以在此处找到它们：http: [//www.microsoft.com/whdc/device/display/wddm_timeout.mspx](http://www.microsoft.com/whdc/device/display/wddm_timeout.mspx) 或此处：http: [//msdn.microsoft.com/en -us/图书馆/ee817001.aspx](http://msdn.microsoft.com/en-us/library/ee817001.aspx)

**[编辑 2015 年 4 月更新：** ] 这已经过时了。假设您安装了 NVIDIA Nsight 工具，为 Cuda 编程禁用 TDR 的最简单方法是打开 Nsight Monitor，单击“Nsight Monitor options”，然后在“General”下将“WDDM TDR enabled”设置为 false。这将为您更改注册表设置。关闭并重新启动。在重新启动之前，对 TDR 注册表设置的任何更改都不会生效。

**[编辑 2018 年 8 月更新：]** 虽然 NVIDIA 工具现在允许禁用 TDR，但同样的问题与 AMD/OpenCL 开发人员有关。对于那些：记录 TDR 设置的当前链接位于[https://docs.microsoft.com/en-us/windows-hardware/drivers/display/tdr-registry-keys](https://docs.microsoft.com/en-us/windows-hardware/drivers/display/tdr-registry-keys)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-30T23:50:19.510

在 Windows 上，图形驱动程序有一个看门狗定时器，它会终止运行超过 5 秒的任何着色器程序。请注意，Xorg/XFree86 驱动程序不这样做，因此一种可能的解决方法是在 Linux 上运行 CUDA 应用程序。

AFAIK 无法在 Windows 上禁用看门狗计时器。在 Windows 上解决此问题的唯一方法是使用第二张没有显示屏幕的卡。它不必是特斯拉，但它必须没有活动屏幕。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-06-09T17:07:10.977

> 解决超时检测和恢复 - WINDOWS 7（32/64 位）
> 
> 在 Windows 中创建一个注册表项以将 TDR 设置更改为更高的数量，以便 Windows 在 TDR 进程开始之前允许更长的延迟。
> 
> 从运行或 DOS 打开 Regedit。
> 
> 在 Windows 7 中导航到正确的注册表项区域，以创建新项：
> 
> **HKEY_LOCAL_MACHINE>SYSTEM>CurrentControlSet>Control>GraphicsDrivers**。
> 
> 那里可能会有一个名为 DxgKrnlVersion 的键作为 DWord。
> 
> 右键单击并选择创建一个新键**REG_DWORD**，并将其命名为 **TdrDelay**。分配给它的值是 TDR 启动前的秒数 - 它 > 当前在 Windows 中自动为 2（即使 reg. 键值不存在 > 直到您创建它）。为它分配一个新值（我尝试了 4 秒），这使 TDR 之前的时间加倍。然后重启电脑。您需要重新启动 PC 才能使该值生效。

来自[Win7 TDR（驱动程序超时检测和恢复）](https://devtalk.nvidia.com/default/topic/502643/win7-tdr-driver-timeout-detection-38-recovery-/)的来源 我也验证了这一点并且工作正常。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-30T23:29:45.010

最基本的解决方案是在计算过程中选择一个点，我确信我正在使用的 GPU 能够及时完成，保存所有状态信息并停止，然后重新开始。

更新：对于 Linux：退出 X 将允许您根据需要运行 CUDA 应用程序。不需要特斯拉（测试时使用了 9600）

然而，需要注意的一件事是，如果从未输入 X，驱动程序可能不会被加载，并且它不会工作。

似乎对于 Linux，当时根本不显示任何 X 也可以，因此只要您屏幕到非 X 全屏终端，就不需要退出 X。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-30T23:36:11.223

这是不可能的。超时是为了防止计算中的错误长时间占用 GPU。

如果您使用专用卡进行 CUDA 工作，则取消时间限制。我不确定这是否需要 Tesla 卡，或者是否可以使用没有连接显示器的 GeForce。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-08-31T14:35:07.687

看门狗定时器仅适用于带有显示器的 GPU。

在 Windows 上，计时器是 WDDM 的一部分，可以使用某些注册表项修改设置（超时、达到超时时的行为等），有关详细信息，请参阅此[Microsoft 文章](http://www.microsoft.com/whdc/device/display/wddm_timeout.mspx)。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-07-25T16:36:39.577

我使用的解决方案是：

1\. 将所有信息传递给设备。
2\. 运行算法的迭代版本，其中每次迭代调用已经存储在设备中的内存上的内核。
3\. 最后只有在所有迭代结束后才将内存转移到主机。

这可以控制来自 CPU 的迭代（包括中止选项），而无需在迭代之间进行昂贵的设备<-->主机内存传输。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-11-19T20:31:09.650

可以在 Linux 中禁用此行为。尽管“看门狗”有一个明显的目的，但在使用着色器/CUDA 进行大量计算时，它可能会导致一些非常意外的结果。

该选项可以在您的 X 配置中切换（可能是 /etc/X11/xorg.conf）

添加：将选项“交互式”“0”添加到 GPU 的设备部分即可完成这项工作。

请参阅[CUDA Visual Profiler 'Interactive' X 配置选项？](https://stackoverflow.com/questions/6906579/cuda-visual-profiler-interactive-x-config-option)

有关配置的详细信息

和

请参阅[ftp://download.nvidia.com/XFree86/Linux-x86/270.41.06/README/xconfigoptions.html#Interactive](ftp://download.nvidia.com/XFree86/Linux-x86/270.41.06/README/xconfigoptions.html#Interactive)

有关参数的说明。

# unit-testing - 指望 NUnit 单元测试的顺序是不是很糟糕

> ID：497699
> 
> 赞同：15
> 
> 时间：2009-01-30T23:33:31.383
> 
> 标签：unit-testing, nunit

我一直在疯狂地创建单元测试，并发现我经常不得不在一个测试中设置一些我在之前的测试中刚刚拆除的东西。在一次测试（例如插入测试）中创建某些东西（例如数据库记录）然后将其用于以后的测试（例如删除测试）是否合理？或者每一个测试都应该完全独立吗？

您甚至可以确定 NUnit 中测试的顺序还是它们总是按字母顺序进行？

注意：我专门询问*一个*测试文件中的测试顺序。 *不*跨测试文件或以任何方式更全局。

**更新：**感谢所有回答的人 - 有*很多*很好的答案，而且小组的感觉非常一致。我选择了 John Nolan 的答案，因为他提供了最完整的解释和大量链接。正如您可能已经猜到的那样，我非常想打破这条规则，尽管我认为它可能像约翰所说的那样有点“臭”。还要感谢 Fortyrunner 添加了*单元测试*标签。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-30T23:40:24.193

查看[测试夹具设置](http://www.nunit.com/index.php?p=fixtureSetup&r=2.4.8)，这些设置允许您指定将在夹具中的任何测试之前执行的功能。这允许您进行一次通用设置，并且无论您运行一个测试还是套件中的所有测试，它都将始终运行。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-30T23:58:03.267

依赖测试的顺序表明您正在跨测试保持状态。这个*[好臭](http://en.wikipedia.org/wiki/Code_smell)*

一种更简洁的测试方式是您只依赖于要检查其行为的单个功能。通常，您会[模拟](http://en.wikipedia.org/wiki/Mock_object) 其他对象，以使您的测试方法正常运行。

考虑进行单元测试的一个好方法是[Arrange, Act, Assert](http://www.lostechies.com/blogs/jimmy_bogard/archive/2008/07/24/arrange-act-assert-and-bdd-specifications.aspx)模式。

以下是 Karl Seguin 出色的免费[电子书](http://codebetter.com/blogs/karlseguin/archive/2008/06/24/foundations-of-programming-ebook.aspx)的片段。我已经注释了 Arrange、Act 和 Assert。

```
[TestFixture] public class CarTest 
{ 
    [Test] public void SaveCarCallsUpdateWhenAlreadyExistingCar()   
    {
         //Arrange
         MockRepository mocks = new MockRepository();
         IDataAccess dataAccess = mocks.CreateMock<IDataAccess>();   
         ObjectFactory.InjectStub(typeof(IDataAccess), dataAccess); 
         //Act
         Car car = new Car(); 
         Expect.Call(dataAccess.Save(car)).Return(389); 
         mocks.ReplayAll(); 
         car.Save(); 
         mocks.VerifyAll(); 
         // Assert
         Assert.AreEqual(389, car.Id); 
         ObjectFactory.ResetDefaults();
    } 
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-30T23:41:42.147

单元测试旨在独立运行，而不是作为顺序脚本运行。如果您确实需要它们按顺序运行，请将它们收集到单个测试函数中。

如果您的单元测试受到[昂贵的设置的](http://c2.com/cgi/wiki?ExpensiveSetUpSmell)影响，那么当您认为您正在进行单元测试时，您可能正在执行集成测试。如果您在大多数单元测试中使用 SQL 数据库，那么您实际上是在与数据访问层进行集成测试。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-30T23:39:23.663

我认为每个测试都完全独立于任何其他测试。即使您可以规定测试的顺序，当测试必须更改时，这将是一场维护噩梦。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-30T23:38:52.450

我真的不会依赖测试的顺序。相反，我会将通用设置代码放入一个单独的方法中，并从简单测试和更复杂的测试中调用它。或者，只需在删除测试开始时调用插入测试本身。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-30T23:49:34.300

我强烈建议让你的所有单元测试独立。

您的业​​务逻辑/数据库结构等可能会随着时间而改变，因此您最终将不得不替换或重写（甚至丢弃）现有的单元测试 - 如果您有几个其他测试取决于您要替换的测试，这可能会导致不必要的麻烦，因为您还必须通过所有其他测试并检查这些测试是否仍按预期工作。

此外，一个失败的单元测试不应拖累许多其他单元测试（它们可能完全独立运行）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-30T23:40:39.310

不幸的是，单元测试的运行顺序是不可预测的，或者至少将来可能会改变。例如，单元测试框架将被更改，因此每个测试都将在单独的线程中执行。所以从我的角度来看，使用测试顺序是不合理的。另一方面，您可以创建一组小型独立测试来测试代码的一小部分，然后创建一个或多个大型测试，以特定顺序运行您的小型测试。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-31T00:02:02.450

如果您有状态测试（数据库工作的常见问题 - 这是我不在 SO 时所做的事情），那么在我看来，避免测试文件中的顺序并不是绝对必要的。但是，您必须认识到，如果您有 2 个测试，其中测试 2 取决于测试 1 通过，那么如果测试 1 失败，您将获得“灾难性”双重失败，因为测试 2 没有预期的设置（并且，更重要的是，如果您认为测试 2 依赖于测试 1 的通过，您会担心测试 2 是否在测试 1 失败后通过）。

这就是为什么您希望测试尽可能独立 - 文件内和文件间。

依赖于不同文件中（组）测试之间的顺序是非常不明智的。

# python - Python 3.0 `wsgiref` 服务器无法正常工作

> ID：497704
> 
> 赞同：1
> 
> 时间：2009-01-30T23:35:05.653
> 
> 标签：python, python-3.x, wsgi, wsgiref

我似乎无法让`wsgiref`模块在 Python 3.0 下工作。但是，它对我来说在 2.5 下工作正常。即使我尝试[文档中的示例](http://docs.python.org/3.0/library/wsgiref.html?highlight=wsgiref#examples)，它也会失败。它失败得很厉害，即使我在上面有一个打印功能：“ `from wsgiref.simple_server import make_server`”，由于某种原因它永远不会被打印出来。它在运行时不会出现任何错误，它只是在浏览器中显示一个空白页面并且不记录任何类型的请求。

有谁知道问题可能是什么？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-31T00:17:03.400

[问题 4718：wsgiref 包完全损坏](http://bugs.python.org/issue4718)。对于那个很抱歉。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-01T02:43:53.230

恐怕您在 Python 3.0 上使用 WSGI 处于未知领域。

WEB-SIG 很久以前就知道 wsgiref 在 3.0 中被破坏了，但选择什么都不做。该规范尚未更新以应对 3.0；即使对于每个人都非常同意的事情，推动 WSGI 向前发展也是非常缓慢的。这是令人沮丧和毫无意义的。

所以，是的，很容易通过 simple_server 中的标头解包来修复明显的错误，但您仍将在已自动从 Python 2 到 3 转换且未经真正测试的服务器上运行，没有法律上的标准准确地说出它应该做什么......不要介意框架兼容性。

用于 Web 脚本的 Python 3.0：需要一些工作。

# http - 在某些情况下，HTTP POST 到外部 ASPX 表单会导致 HTTP 405 错误

> ID：497713
> 
> 赞同：0
> 
> 时间：2009-01-30T23:39:16.160
> 
> 标签：http, iis, post, http-status-code-405

我有一种情况，我们正在汇总来自 N 个客户的营销数据，其中客户可以使用他们选择的任何后端托管 HTML 表单，每个表单的操作都指向我们正在使用的路径托管。每个客户端都有不同的 URL，没有身份验证（但对数据进行了一些简单的验证），并且通常一切正常。

然而，有一个小皱纹我似乎无法理解。

处理提交数据的 aspx 位于一个路径中，我们称之为 ~/submit/default.aspx。我们的想法是，我们*应该*能够向我们的合作伙伴提供一个类似于“ [http://sample.com/submit/?foo=bar](http://sample.com/submit/?foo=bar) ”的 URL 作为他们表单的操作。但是，这样做会导致 HTTP 405 错误，“资源不允许”。

但是，将表单的操作设置为“ [http://sample.com/submit/default.aspx](http://sample.com/submit/default.aspx) ”可以正常工作。

*   Default.aspx 设置为 IIS 6 中的默认文档名称之一。
*   .aspx 文件扩展名已正确映射到正确的 .Net dll，并为映射激活了动词 GET、HEAd、POST 和 DEBUG。

这是我唯一能想到的首先要仔细检查的两件事——其他人有什么想法吗？我更喜欢使用 IIS7 的 URL 重写/路由，但不幸的是，这不是一个选项——而且我有许多额外的要求，其中“干净”的 URL 将非常可取，所以解决这个问题将是一个相当不错的选择要解决的核心问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T00:38:54.480

IIRC，如果请求的资源是目录，IIS 将仅使用默认文档。由于第一种情况下请求的资源不是，它永远不会通过默认的文档处理程序 - 而是在 POST 到未注册的脚本扩展 (405) 时失败。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-09T22:25:53.113

出于某种原因，它没有呈现我的代码示例！你们需要为您的“您的答案”文本框解码和编码小于和大于符号......无论如何，

```
<httpHandlers>
<add verb="your.class.to.handle.doc.files"/>
</httpHandlers> 
```

是您的 web.config 文件中应该包含的内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-09T22:21:40.857

它可能取决于“ [http://sample.com/submit/?foo=bar](http://sample.com/submit/?foo=bar) ”的文档类型...如果您的 IIS 不知道如何处理返回给它的文档类型（然后将其返回给你，客户端），那么你可能会收到一个 http 405 错误 - 这意味着它不知道如何处理该文档类型，服务器方面。也许尝试在驱动应用程序的 web.config 文件中放置类似的内容。HTTP 处理程序是模块化的代码片段，用 .net 语言编写和编译，如果您熟悉 Java 术语，它可以充当一种“servlet”。这是一段向客户端写出某些内容的代码——在您的情况下，可能是 .doc 文件的呈现，以编程方式在您的处理程序类中找到。

# java - 返回特定对话框

> ID：497714
> 
> 赞同：0
> 
> 时间：2009-01-30T23:39:22.167
> 
> 标签：java, swing

我正在编写一个非常简单的文本编辑器，但遇到了一个小问题。下面的代码

保存文件，当文件存在时，会提示用户覆盖、取消或不覆盖（可以选择重试）。

所以我有一个 JFileChooser 会提示用户覆盖：是，否，取消

在没有被选中的情况下，它应该返回到 JFileChoose 对话框，但我只是不知道如何。谁能帮我解决这个问题？取消和是选项没有任何问题（据我所知，尚未深入测试）

```
String contents = textArea.getText();
if (openPath != null) {
    savePath = openPath;                    
} else if (saveAsPath != null) {
    savePath = saveAsPath;
} else if (savePath != null) {
    savePath = savePath;
} else if (openPath == null) {
    JFileChooser saveFile = new JFileChooser();
    int returnVal = saveFile.showOpenDialog(null);
    if (returnVal == saveFile.APPROVE_OPTION) {
        savePath = saveFile.getSelectedFile();
        if (!savePath.exists()) {
        FileWriter fstream = new FileWriter (savePath);
        BufferedWriter saveWrite = new BufferedWriter(fstream);
        saveWrite.write(contents);
        saveWrite.close();
        } else if (savePath.exists()) {
            JOptionPane overwritePrompt = new JOptionPane();
            Object[] options = {"Yes","No","Cancel"};
            int n = JOptionPane.showOptionDialog(overwritePrompt,
               "Already exists. Overwrite?","Overwrite File?", 
               JOptionPane.YES_NO_CANCEL_OPTION,JOptionPane.WARNING_MESSAGE,
               null,options,options[2]);
        if (n == 0) {
        FileWriter fstream = new FileWriter(saveAsPath);
        BufferedWriter out = new BufferedWriter(fstream);
        out.write(contents);
        out.close();
        } else if (n == 1) {
            savePath = null;
            openPath = null;
            saveAsPath = null;
            return; // should return to JFileChooser
        } else {
                savePath = null;
            openPath = null;
            saveAsPath = null;
            return;
        }
    }
} else {
    return;
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-30T23:43:55.607

从这一行重新开始怎么样：

```
int returnVal = saveFile.showOpenDialog(null); 
```

再次，您应该何时返回 JFileChooser？我假设同一个文件选择器会再次显示其打开的对话框？

# c - 如何模拟按键到任何当前聚焦的窗口？

> ID：497720
> 
> 赞同：2
> 
> 时间：2009-01-30T23:43:35.980
> 
> 标签：c, winapi, keyboard-hook

我正在尝试更改键盘发送到应用程序的键。我已经创建了一个全局挂钩并且可以阻止我想要的密钥，但我现在想发送一个新密钥。这是我的钩子过程：

```
LRESULT __declspec (dllexport) HookProc(int nCode, WPARAM wParam, LPARAM lParam)
{
    int ret;

    if(nCode < 0)
    {
        return CallNextHookEx(hHook, nCode, wParam, lParam);
    }

    kbStruct = (KBDLLHOOKSTRUCT*)lParam;

    printf("\nCaught [%x]", kbStruct->vkCode);

    if(kbStruct->vkCode == VK_OEM_MINUS)
    {
        printf(" - oem minus!");
        keybd_event(VK_DOWN, 72, KEYEVENTF_KEYUP, NULL);
        return -1;
    }
    else if(kbStruct->vkCode == VK_OEM_PLUS)
    {
        printf(" - oem plus!");
        keybd_event(VK_UP, 75, KEYEVENTF_KEYUP, NULL);
        return -1;
    }

    return CallNextHookEx(hHook, nCode, wParam, lParam);
} 
```

我已经尝试将 SendMessage 和 PostMessage 与 GetFocus() 和 GetForegroudWindow() 一起使用，但无法弄清楚如何为 WM_KEYUP 或 WM_KEYDOWN 创建 LPARAM。我还尝试了 keybd_event()，它确实模拟了按键（我知道是因为这个钩子 proc 捕获了模拟的按键），包括 5 或 6 个不同的扫描代码，但没有任何影响我的前台窗口。

我基本上是想将我的 ms3200 上的缩放栏变成滚动控件，所以我什至可能发送了错误的键（向上和向下）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-31T00:02:42.120

调用 keybd_event 是正确的。如果您所做的只是按键，则窗口可能会处理按键消息。您确实需要先发送一个键，然后再发送一个键：

```
keybd_event(VK_UP, 75, 0, NULL);
keybd_event(VK_UP, 75, KEYEVENTF_KEYUP, NULL); 
```

或者，更好的是，当 OEM 密钥下降时将密钥向下发送，当 OEM 密钥上升时将密钥向上发送。您可以通过 kbStruct->flags & LLKHF_UP 来判断 down/up 状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-11T15:31:28.427

您可能希望使用[SendInput](http://msdn.microsoft.com/en-us/library/ms646310(VS.85).aspx)，因为[keybd_event](http://msdn.microsoft.com/en-us/library/ms646304(VS.85).aspx)已被取代。MSDN 杂志文章[C++ Q&A: Sending Keystrokes to Any App](http://msdn.microsoft.com/en-us/magazine/cc163867.aspx)有一个有用的例子。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T02:15:57.983

您可能想尝试 Control-UpArrow 和 Control-DownArrow 而不是 Up 和 Down。然而，这似乎并不适用于所有应用程序，甚至在它工作的应用程序上，它也可能取决于焦点在哪里。

# http - 如何编码大数字（在 URL 中）？

> ID：497729
> 
> 赞同：4
> 
> 时间：2009-01-30T23:51:54.653
> 
> 标签：http, url, encoding

很多时候，必须在 url 中编码一个大数字（例如 128 或 160 位）。例如，许多 Web 应用程序使用 md5(random()) 作为 UUID。

如果您需要将该值放在 URL 中，常见的方法是将其编码为十六进制字符串。

但显然十六进制编码不是一个非常严格的编码。还有哪些其他方法可以很好地适应 URL？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-31T00:04:58.853

我会使用“安全的 URL 和文件名”Base 64 Alphabet。

Base 64 使用两个字符集。

```
Data: ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/
URLs: ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_ 
```

要使用 base 64，您需要将值填充为 3 字节长（24 位）的倍数，然后将这 24 位拆分为 4 个 6 位字节。每个 6 位值都是按我在上面给出的字符串中的位置查找的。

如果一切顺利，您的最终 base64 值将始终是 4 个字符长的倍数，并解码回 3（8 位）字节长的倍数。

根据您使用的语言，其中很多都内置了编码和解码功能。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-30T23:58:54.407

您可以使用 base64-url 编码（az、AZ、0-9、- 和 _ [参见 RFC4648 第 5 节]）做得更好。[RFC4648](http://www.ietf.org/rfc/rfc4648.txt)涵盖了许多不同的编码方法（base16、base32 和 base64）和几个变体。此外，根据数字中设置的位的稀疏性，您可以想象通过 gzip 运行它，然后使用所描述的编码方法之一。当然 gzip 的使用实际上取决于您要编码的数字有多大。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-30T23:54:06.223

如果你想要它紧，你可以使用 base-36 编码（从 0 到 Z）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-29T16:36:47.273

使用 base36 的提示，我目前使用这样的东西（在 Python 中）：

```
>>> str(base64.b32encode(uuid.uuid1().bytes).rstrip('='))
'MTB2ONDSL3YWJN3CA6XIG7O4HM' 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-01-31T00:07:18.880

只需使用十六进制。即使您要获得每个字符 8 位，您仍然使用 16-20 字符的随机序列，没有人愿意输入或说。如果您无法提供简短的标识符，请使用您的搜索功能。

# asp.net - 您是否使用虚拟机作为主要开发环境？

> ID：497730
> 
> 赞同：23
> 
> 时间：2009-01-30T23:53:38.800
> 
> 标签：asp.net, iis, development-environment, virtual-machine

最近我购买了一个带有 Windows Home Basic 的笔记本（没有 ASP.Net/IIS。我想将 Windows 版本升级到带有 ASP.Net/IIS 的版本，但我认为还有另一种可能性：

我有一个 360Gb HD 的硬盘盒。我想在这个 HD 案例中使用 Windows Ultimate（也安装 ASP.Net、IIS 和 Visual Studio 2008）创建一个虚拟机，然后我可以在我将要使用的任何计算机上访问我的“开发环境”（我的台式机和我的笔记本）。

但我担心表现。我没有在虚拟机上工作的经验（我用它只是为了快速进行兼容性测试）。

您是否使用虚拟机作为主要开发环境？你的发现是什么？

* * *

**编辑**

感谢您的回答！它真的帮助了我！

我也想了解可移植性，即*我在笔记本电脑中创建的虚拟机可以在桌面上运行吗？我需要重新激活 Windows 吗？*

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-31T00:01:23.793

我经常使用 VMWare 和基于 Microsoft VPC 的 VM，它们托管在基于 Quad 6600 的 XP Pro 盒子中。

我最初使用虚拟机是为了在不同的环境中进行测试，为了调试，我不得不在其中一两个环境中安装 SQL Server 和 VS2008。

出于这些目的，VM 非常方便。

但基于那次经验，我不会将虚拟机作为我的主要开发环境，仅仅是出于性能原因。VM 性能出奇的好，但差异（几乎所有东西）虽然不是很大，但足以引起注意。

当我每天编译几十次，运行大查询等时，我不希望我的开发机器比它绝对必须的慢。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-31T00:00:24.107

只要您有足够的内存供两个操作系统使用，就可以使用虚拟机。

您还应该知道虚拟机有一些限制，例如在支持图形卡方面，因此您需要确保您正在开发的任何东西都不依赖于虚拟机上不可用的功能。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-02T22:39:25.213

几年来，我一直使用 VMWare 作为我的主要开发环境。

**我通常在一些环境之间切换**

*   Windows 窗体/WPF 开发（XP、.Net 3.5）
*   Ruby Development - 用 ruby​​ 做了一个网站（XP，Instant Rails）
*   ASP.net 3.5 - 用于玩新东西（XP、.net 3.5、IIS、SQL Server）
*   ASP.net 2.0 - 有时地方仍然停留在 2.0（XP、.net 2.0、IIS、SQL Server 2005）

**我学到了一些东西**

*   使用 XP 而不是 Vista。当您运行多个虚拟机时，额外的绒毛非常明显
*   给每个 VM 大约 1gb（有时只有 512MB）。你想给他们尽可能少的东西，防止他们换成你经常做的事情。
*   在进行任何开发之前，为您的堆栈保留基本安装的快照。
*   四核 + 8gb 内存现在很便宜。我通常在开发时运行多个虚拟机。如果您的内存或内核较少，请减少正在运行的虚拟机数量。
*   关闭软件鼠标光标并以全屏模式运行（大多数人直到我展示它们才意识到它是一个虚拟机）。

**好处**

*   我可以在我拥有的任何电脑上在 5 分钟内运行我的任何主要堆栈。
*   我可以在紧要关头将我的整个开发环境转移到笔记本电脑或另一台电脑上。
*   我可以轻松地保留单独的开发堆栈，否则可能会踩到彼此的脚趾。

**硬盘**：您的第一个瓶颈将是 RAM，但现在 RAM 很便宜，所以没有理由不拥有 8-16gb。您的下一个主要瓶颈主要是硬盘驱动器。我现在尝试为每个活动虚拟机配备一个硬盘（用于桌面工作负载，而不是服务器）。Raid 设置可以提供极大**的帮助，如果您负担得起，SSD**可以完全解决问题。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-31T03:49:29.387

我从 2002 年开始使用 VMware。我的第一个用途是在来宾 VM 中创建一个开发环境，然后为我的队友复制它。当需要进行硬件升级时，我在大约一个小时内切换到了新桌面（安装 VMware，复制 VM）。

我经常在台式机、笔记本电脑和服务器上使用 VMware。我将它们用于开发、测试和生产。我曾尝试在虚拟机内玩游戏，但大多数游戏都无法解决问题（VMware 这么说，但我还是尝试了）。但是，最新的 VMware Workstation 版本可能会玩一些游戏。

我特别喜欢笔记本电脑上的 VMware，我真的很喜欢在 Ubuntu Linux 上使用它。到目前为止，我发现最好将 Windows（2000 Pro SP4 或 XP）用于主机操作系统，因为它具有出色的设备驱动程序。但是，我更喜欢在 Ubuntu 上实际工作以进行开发，但这在 VM 中效果很好。我已经在各种硬件上直接安装了 Ubuntu，但到目前为止还不够满意，以至于离开它超过几个月，然后再次恢复到 Windows。

但是，我的笔记本电脑确实可以很好地运行 Ubuntu，而我只是恢复到 Windows XP，因为我想加载一个 eSATA 卡，它可以让我高性能地访问外部硬盘驱动器以...运行虚拟机！！！由于工作分心，我还没有完成安装。

说到工作......我已经“获得”了三个旧的孤立桌面，我将它们变成了 VM 主机。我即将尝试加载 VMware ESXi，尽管我刚刚用 Windows 2000 Pro SP4 和 VMware Server 1.0.8 加载了两个。我管理着一个开发团队，我主要将这些虚拟机用于开发环境，因为我们公司在实际工作中过多地削弱了我们的主要台式机/笔记本电脑。

喝可乐！！！VMware 很棒，还有很多其他不错的 VM 选项！

最良好的祝愿。

编辑：更多好东西...

特别是，请查看 VMware ESXi、VMware Server 和 Ubuntu JeOS。好吃的东西！！！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-30T23:58:48.820

不，但是当我在 IE 中测试网页时，将它用作测试机。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-30T23:56:23.613

是的，我的服务器使用 VMWare 工作站 6.5 和 ESX 3.0。奇迹般有效。没有明显的性能损失。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-30T23:59:54.793

我过去曾使用 VM 进行开发，并且经常使用它们进行各种测试。使用虚拟机进行开发工作非常好，我唯一要提醒您的是，一些外部硬盘驱动器非常慢，这可能会给您带来问题，但快速驱动器运行良好。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-31T00:48:31.217

我在 Vista 64 之上使用 Ubuntu 作为我的 linux 开发环境。

这台机器有一个 10k 的驱动器、大量的快速内存和一个双核 CPU，所以它运行得非常好。我最终得到了这个大杂烩，因为当时我构建了一台无法运行 ubuntu 的机器，而使用 VM 是处理这个问题的最简单方法。不过，我发现它非常方便，所以即使 ubuntu 现在可能对这台机器没问题，我仍然使用虚拟机。

使完全备份我的开发环境并将其带到异地或分发它变得微不足道（即，GPL 合规性是小菜一碟 - 无需与试图为他们建立开发环境并处理怪癖的人合作软件版本等）

嵌入式 ARM linux 开发需要。

-亚当

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-31T00:31:58.363

我在 Mac 上使用 VMWare Fusion 来运行 Windows Server 2003、Visual Studio 和我所有的 IIS 要求。

我没有问题，但我的 Macbook pro 在运行时确实有 4GB 的 RAM 和 2GB 分配给 WMVare。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-31T00:43:11.570

我的主要 Windows 开发环境是本机 Vista x64。由于上面提到的显卡原因以及（可能没有根据的）对 VM 环境和调试的担忧，我决定我仍然想要一个用于我的 .Net 和 Windows Win32/64 开发的本机环境。我目前在 GUI 开发方面工作得更多。

但是，我过去使用 VM 进行的一种非常重要的开发是基于 Python 的程序，无论是带有 wxWindows 的纯 Python 还是从 C++ 调用的嵌入式 Python。使用 VM 使我能够控制 Python 环境并针对保证与部署环境匹配的不同安装进行工作。我建议任何使用动态语言的人使用这种语言，在这种语言中，您倾向于安装大量外部软件包，并且很难干净地恢复到早期版本。

要考虑的另一件事是使用带有远程调试块的 VM 作为目标。Macintosh 上的许多 REALbasic 开发人员在他们的 Windows 测试中这样做（REALbasic 具有出色的跨平台调试功能），但我过去也将它用于 Visual Studio。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-31T03:26:15.423

快照很方便。您可以使用多个虚拟机在不同的操作系统上进行测试。

我们的工程师在 VMWare esx 上运行 Windows VM。我们可能有 12 个 Windows 虚拟机在单个 Dell Poweredge 上运行（是的，它很强大，但仍然如此）。它们在网络上几乎看起来比我在 Core2 Duo 上本地安装的 XP 更快！

而在本地机器上，只要你有内存，它仍然可以很好地运行。一个精简的 XP 虚拟机（类似于 TinyXP）的性能与我 6 个月大的本机安装一样好！

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-31T18:53:48.950

关于便携性；假设相同的架构（和操作系统），那么虚拟机应该在两台物理计算机上运行良好。如果 VM 的硬件配置没有太大变化，则不需要在 VM 中重新激活 Windows。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-07T13:39:28.807

我运行 Ubuntu 作为我的主要操作系统，然后使用 Windows 2003 虚拟机（使用 VirtualBox）在 Windows 中进行开发。主要用于 Visual Studio 2008 Web 开发。在家里这样做了 3 年，但现在正在工作中尝试。

工作正常，即使使用 ReSharper 和大约 50 个项目的解决方案。它不像我直接通过 Windows 运行它那么快，但是拥有一个设置良好的虚拟机意味着我可以与其他开发人员共享它，并且可以轻松地在 vm 之间切换（我们正在考虑试用 Windows Server 2008）。

也意味着我可以使用 Windows，然后让 Linux 处理诸如 IM、Firefox、音乐（当然）、索引（跟踪器）、FTP 等之类的事情......另外我有终端可供我使用（grep、ssh 你的名字它）。

我们用 Windows 的幻影图像进行了尝试，但发现由于人们拥有不同的硬件，图像并不总是有效。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-06-18T16:31:22.433

我用 3 GB Ram 在我的笔记本电脑上运行 Windows 7 64 位（是的，它很低）。

我发现在虚拟机上运行我的开发环境真的很痛苦。当我打开 5 个 IDE 时，SQL Server 2008、NotePad++、OxyGenXML 编辑器和 Chrome/IE/FireFox 都在我的 VM 中打开，然后我的主机有 Outlook、OneNote 和其他一些运行它的程序变成废话。

使用虚拟机也不容易使用多个显示器，特别是如果您经常将笔记本电脑拿走，然后将其重新连接起来。重新同步非常耗时。

即使使用 5-6GB 内存，我的其他同事也有同样的问题。

如果我把所有时间都浪费在等待虚拟机导致的额外处理上，那将比我不得不从头开始重新做我的电脑要多——这需要不到 8 个小时。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-06-18T16:44:25.017

这真的取决于情况。我在企业界遇到的最可怕的环境是 Windows 笔记本电脑 + Linux 虚拟环境（笔记本电脑本身并不是一流的，我一开始就不喜欢将笔记本电脑作为开发机器）。我主要是一名 java 开发人员，喜欢编写很多单元测试，通常使用这种组合（我真的不想使用一个，但是好吧，我只是懒得抱怨那么多）运行单元测试需要很多时间。

当然，这取决于测试的类型，但在这种情况下，我的猜测是磁盘 I/O 只会减慢速度。我只是喜欢编译和测试，所以这就是我支持原生环境的主要原因：速度。即使是一点点，有时也会让人觉得太过分了。很抱歉没有在更广泛的范围内和非常主观地回答。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-01-31T00:01:25.867

我在 Mac 上使用 Parallels - 没有问题。

在工作中，我们在大多数测试环境中使用虚拟机——它们运行良好

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-01-31T02:31:18.607

我曾经将虚拟机用作沙箱，以防止不守规矩的应用程序做不守规矩的事情。（Sandboxie 是一个很棒的程序）但我总是忘记将它们包含在内，只是不时地重新安装 Windows，这比持续维护要容易得多。

至于虚拟机，由于您的 bios 和硬件都已仿真，因此您被可用的硬件搞砸了。在某些情况下几乎不可能写出低水平的东西。但是，当通过远程桌面连接在虚拟机上使用托管服务器时......绝对精彩，如此简单！我只需点击几下就可以进出，所以我想这是我使用的第一个虚拟化。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-01-31T03:09:50.433

VMware 调试设备和过滤驱动程序。VirtualBox 对于偶尔使用的 Ubuntu 和 XP 来说既好又快，支持 IE6、FF2、Chrome、Opera 和 Safari，用于测试和安装我不信任的应用程序。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-01-31T18:19:47.723

我有一台运行我的几个开发环境的 Windows 2008 Hyper-V 机器。它一点也不慢（我可以注意到）。我的一些环境虽然没有虚拟化。通常如果设置需要一些难以回滚的东西，那么我会使用虚拟机，如果没有，我会使用桌面。请记住许可费用。如果要虚拟化 Windows Server 的副本，则还需要 Windows Server 的许可证。将 Vista Home Basic 升级到运行 IIS 的版本可能会更便宜（尽管我的建议是运行 Win 7 beta，因为它是免费的，然后在准备好时升级到 win7 的最终版本）

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2010-04-08T04:21:19.967

现在已经快一年了，你们还在用虚拟机作为开发环境吗？我曾经，但由于性能越来越差而停止了。就是想。

# asp.net - ASP.NET 自定义错误被忽略

> ID：497735
> 
> 赞同：2
> 
> 时间：2009-01-30T23:56:59.213
> 
> 标签：asp.net, iis-6

我在 web.config 中配置了自定义错误，但 IIS 6.0 正在返回网站配置的自定义错误选项卡中指定的自定义错误。

```
 <system.web>
        <customErrors>
              <error statusCode="404" redirect="UrlRedirect.aspx" />
        </customErrors>
  </system.web> 
```

我能错过什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-31T00:03:07.360

您可能缺少 mode="On"：

```
<system.web>
        <customErrors mode="On">
              <error statusCode="404" redirect="UrlRedirect.aspx" />
        </customErrors>
</system.web> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T00:42:06.533

请记住，web.config 中指定的 404 处理程序仅适用于由 ASP.NET 运行时处理的文件 - .htm、图像、css、javascript 都将由主机 IIS 设置中指定的 404 页面处理。

如果您希望这些文件类型由您的自定义错误处理，您需要将 IIS 设置为将 404 定向到 UrlRedirect.aspx。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T00:13:06.997

实际上，如果我正确理解了您的困境，听起来好像正在返回自定义错误，如果这不是您想要的，您需要将模式设置为“关闭”或“RemoteOnly”才能查看详细的错误消息在你的环境中。

```
<customErrors mode="Off"/> 
```

# c# - IronPython 与 C# 的小规模项目

> ID：497747
> 
> 赞同：8
> 
> 时间：2009-01-30T23:59:34.530
> 
> 标签：c#, .net, python, ironpython

我目前的大部分编程项目（主要是小程序和原型的快速开发）都使用 Python。我想花时间学习一门语言，只要有机会，我就可以灵活地使用各种 Microsoft 工具和 API。我正在尝试在 IronPython 和 C# 之间做出决定。由于 Python 是我最喜欢的编程语言（主要是因为它简洁明了的语法），IronPython 听起来像是理想的选择。然而，在阅读了一点之后，我有几个问题。

对于那些使用过 IronPython 的人来说，是否曾经不清楚经典 Python 在哪里结束而 .NET 从哪里开始？例如，.NET 库和 Python 标准库之间的功能似乎有很大的重叠，所以当我需要进行字符串操作或解析 XML 时，我不清楚应该使用哪个库。另外，我不清楚何时应该在我的代码中使用 Python 和 .NET 数据类型。例如，我将在我的代码中使用以下哪一项？

```
d = {} 
```

或者

```
d = System.Collections.Hashtable() 
```

（顺便说一句，如果我做很多像后者这样的事情，我可能会失去一些简洁性，这就是为什么我首先偏爱 Python。）

另一个问题是 Microsoft 的一些开发工具，例如 .NET CF 和 Xbox XNA，在 IronPython 中不可用。是否还有更多 IronPython 无法让我充分利用 C# 的情况？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-31T01:15:04.487

我在 IronPython 中构建了一个与 C# 绑定的大型应用程序。

它几乎是完全无缝的。IronPython 中真正“python”感觉中唯一缺少的是基于 C 的库（必须使用 .NET）和 IDLE。

该语言像梦一样与其他 .NET 语言交互......特别是如果您嵌入解释器并通过引用绑定变量。

顺便说一句，在 IronPython 中声明了一个哈希：

```
d = {} 
```

请注意，它实际上是 IronPython.Dict 对象，而不是 C# 字典。也就是说，如果您将转换传递给 .NET 类，转换通常是不可见的，如果您需要显式转换，则有内置函数可以很好地完成转换。

总而言之，如果你有理由的话，这是一种与 .NET 一起使用的很棒的语言。

只是一个建议：避免像瘟疫一样使用 Visual Studio IronPython IDE。我发现自动行完成在空格和制表符之间的缩进上搞砸了。现在 - 那 - 是插入到代码中的一个难以追踪的错误。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-31T02:17:45.763

我建议看一下[Boo [](http://boo.codehaus.org/) [http://boo.codehaus.org/]](http://boo.codehaus.org/])，这是一种基于 .NET 的语言，其语法受 Python 启发，但它提供了 .NET 3.5 的全部功能。

IronPython is great for using .NET-centric libraries -- but it isn't well-suited to *creating* them due to underlying differences in how the languages do typing. As Boo does inference-based typing at compile time except where duck typing is explicitly requested (or a specific type is given by the user), it lets you build .NET-centric libraries easily usable from C# (and other languages') code, which IronPython isn't suitable for; also, as it has to do less introspection at runtime, Boo compiles to faster code.

# python - Python string.join(list) 对象数组而不是字符串数组

> ID：497765
> 
> 赞同：319
> 
> 时间：2009-01-31T00:06:07.620
> 
> 标签：python, list

在 Python 中，我可以这样做：

```
>>> list = ['a', 'b', 'c']
>>> ', '.join(list)
'a, b, c' 
```

当我有一个对象列表时，有什么简单的方法可以做同样的事情吗？

```
>>> class Obj:
...     def __str__(self):
...         return 'name'
...
>>> list = [Obj(), Obj(), Obj()]
>>> ', '.join(list)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: sequence item 0: expected string, instance found 
```

还是我必须求助于 for 循环？

* * *

## 回答 #1

> 赞同：471
> 
> 时间：2009-01-31T00:10:58.563

您可以改用列表推导式或生成器表达式：

```
', '.join([str(x) for x in list])  # list comprehension
', '.join(str(x) for x in list)    # generator expression 
```

* * *

## 回答 #2

> 赞同：101
> 
> 时间：2009-01-31T00:16:03.950

内置的字符串构造函数将自动调用`obj.__str__`：

```
''.join(map(str,list)) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2018-08-15T11:41:23.797

另一种解决方案是覆盖 str 类的连接运算符。

让我们定义一个新的类 my_string 如下

```
class my_string(str):
    def join(self, l):
        l_tmp = [str(x) for x in l]
        return super(my_string, self).join(l_tmp) 
```

然后你可以做

```
class Obj:
    def __str__(self):
        return 'name'

list = [Obj(), Obj(), Obj()]
comma = my_string(',')

print comma.join(list) 
```

你得到

```
name,name,name 
```

顺便说一句，通过使用**列表**作为变量名，您正在重新定义列表类（关键字）！最好使用另一个标识符名称。

希望你会发现我的回答很有用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-11-21T04:54:10.387

我知道这是一个超级旧的帖子，但我认为错过的是压倒一切`__repr__`的，所以`__repr__ = __str__`，这是这个[标记为重复的问题](https://stackoverflow.com/questions/12448175/confused-about-str-on-list-in-python)的公认答案。

# c# - c++0x 概念和 c# 约束有什么区别？

> ID：497766
> 
> 赞同：6
> 
> 时间：2009-01-31T00:06:34.827
> 
> 标签：c#, c++, constraints, semantics, c++-concepts

C++0x 引入了**概念**，基本上可以定义类型的类型。[它指定类型所需的属性](http://www.artima.com/cppsource/cpp0xP.html)。

C# 允许您使用“ *[where](http://msdn.microsoft.com/en-us/library/6b0scde8(VS.80).aspx)* ”子句指定泛型的**约束。**

它们之间有语义上的区别吗？

谢谢你。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-31T00:21:16.793

要记住的一件事是 C++ 模板和 C# 泛型并不完全相同。有关这些差异的更多详细信息，请参阅此[答案](https://stackoverflow.com/questions/31693/differences-in-generics/31929#31929)。

从您链接到解释 C++0x 概念的页面中，听起来想法是在 C++ 中您希望能够指定模板类型实现某些属性。在 C# 中，约束比这更进一步，并强制泛型类型“属于”该约束。例如，以下 C# 代码：

```
public GenericList<T> where T : IDisposable 
```

表示任何用于代替 T 的类型都**必须**实现 IDisposable 接口。同样，以下代码：

```
public abstract class ABC {}
public class XYZ : ABC {}

public GenericList<T> where T : ABC 
```

表示任何用于代替 T 的类型必须是 ABC 类型或派生自 ABC。

C++0x 概念思想只是说用于代替 T 的类型必须具有与 ABC（或 IDisposable）定义的相同的属性，而不是它必须属于该类型。

# design-patterns - 您不能没有哪种 GoF 模式？

> ID：497767
> 
> 赞同：5
> 
> 时间：2009-01-31T00:06:57.337
> 
> 标签：design-patterns

如果将来您只能使用《[四人帮》中](https://rads.stackoverflow.com/amzn/click/com/0201633612)定义的规范模式中的一种，您会选择哪一种，出于什么原因？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-31T00:21:14.877

不是设计模式，但对我来说，这条原则绝对是对我整本书的编程风格影响最大的：

> 优先考虑对象组合而不是类继承。

结合另一个原则“编程到接口，而不是实现”，大多数设计模式自然而然地遵循。

在我看来，选择一种模式作为最重要的模式是不可能的。他们都有自己的目的，并且相辅相成。这就像问锤子还是螺丝刀更有用。这取决于问题，有时你有钉子，有时你有螺丝。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-31T00:14:36.573

抽象工厂模式或模板方法模式......但主要是抽象工厂模式。它们在很多情况下都非常有用。

我特别喜欢抽象工厂的方式，它允许您通过以不同的方式遵循相同的规则来为您知道程序将来可能发生变化的情况做准备。

就像抽象类允许您在代码“内部”定义规范，限制代码遵循该规范，而工厂允许您在这些规范中“选择”。简单的美丽。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-31T02:01:52.270

观察者模式

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-31T01:05:57.640

我喜欢状态模式。这对建模很有好处，嗯，状态。对于我正在编写的游戏项目，我使用状态层次结构来跟踪游戏状态。它很简单但非常灵活。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-31T01:30:37.200

我会说[装饰者模式](http://en.wikipedia.org/wiki/Decorator_pattern)。主要是因为它已经在框架中大量使用。

例如，如果您曾经编写过这样的代码：

```
FileStream file = new FileStream("file.txt");
GZipStream compression = new GZipStream(file);
TextReader reader = new TextReader(compression);
reader.ReadAll(); 
```

然后你就使用了装饰器模式。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-31T00:18:05.163

如果我*必须*选择一个，我会选择封面上的 MCEscher 图片，然后贴在墙上。;)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-31T00:21:17.700

这是一个困难的问题，因为我发现当我学习模式时，我正在以与许多设计模式非常相似的方式实现许多系统（尤其是更基本的模式，例如创建模式或状态，以及战略和模板）。

既然我了解了 GoF，我就无法在脑海中区分出哪些模式是我自然不会发现的，而对我来说，这就是一个**好的**模式。一个好的模式是一种非常自然的模式，以至于您使用该模式编写代码，因为它是一个很好的解决方案。

模式只是为我们提供了一种方式来讨论我们用通用方言组合解决方案的策略。我知道我没有回答你的问题，所以我applogize。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-31T00:47:09.597

我喜欢**访客**模式。不止一次，我遇到了一个设计问题，无法真正解决，直到我终于发现访问者模式就是答案。

您可以向类添加任何功能而无需更改它！只需在其中放置一个 accept() 函数即可。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-02T11:45:19.300

**侦听器或观察者**模式。

无法想象我的生活会轮询一些东西以检查它是否发生。

其他：

1.  **适配器**（如果您不想接触有效的代码但您没有时间了解如何操作，或者您只是不知道，这非常有用）
2.  **状态**
3.  **战略**

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-31T00:36:32.537

我不得不说**单例模式。** 多少次你需要一个你一遍又一遍地使用的类的实例！它可能被认为是一种反模式，但它是我经常使用的一种。

再次重申，**抽象工厂模式**也是我一直使用的模式，并且当我们需要实现一组新的需求时，前期开发为我节省了数小时的重构时间。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-02T11:39:46.907

**行为**模式：

*   *说明*我的业务逻辑何时分发；
*   *上下文改变算法时的策略*；**
**   *读取对象集合时的*迭代器；***

 *** * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-02T18:21:56.020

一个我不能没有的是迭代器。我每天都用它。我几乎无法想象没有它的生活 :-) 我第二常用的是装饰器/包装器。

# java - 在 Java 中强制转换引用变量

> ID：497772
> 
> 赞同：3
> 
> 时间：2009-01-31T00:10:49.530
> 
> 标签：java, reference, casting

我对在 Java 中转换引用变量有一些不清楚的地方。

我有两个类 A 和 B。A 是 B 的超类。如果我有这两个对象，那么 print 语句：

```
A a = new A(); //superclass

B b = new B(); //subclass

System.out.println ((A)b); 
```

那么执行 println 方法时到底发生了什么？

我知道因为 B 是 A 的子类，所以我可以进行以下转换：

```
A a2 = (A)b; 
```

我还知道，当 println 将引用变量作为参数时，会调用（隐式）调用已创建对象参数的类的 toString() 方法。之所以如此，是因为 println() 方法正在寻找 String 类型的参数，而 toString() 方法将对象表示为字符串。即使我们不写 toString()，该方法也会被隐式调用。因此，以下两个语句是等价的：

```
System.out.println (b);

System.out.println (b.toString()); 
```

所以，我的问题是：当我们有

```
System.out.println ((A)b); 
```

?

我想参考变量 b 的类型会自动从 B 更改为 A。变量应该仍然指向同一个对象 - 使用创建的对象

```
B b = new B(); 
```

但现在只更改 b 的类型。这个对吗？另一个问题：即使我将 b 的类型更改为超类的类型，是否会调用子类中的覆盖方法，而不是超类的方法？

非常感谢。

问候

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-31T01:00:30.223

在这种情况下，演员表没有影响。

System.out.println(XXX) 采用不同类型的参数（多个重载版本），但在这种情况下，您将获得采用 Object 的版本。由于 Java 中的每个对象都支持 toString()，因此无论实际参数是什么，都会调用 toString。

现在，由于 Java 中的所有方法都是动态分派的，因此运行的版本是对应于动态类型的版本。将 B 的对象转换为 A 只会更改表达式的静态（声明的）类型。动态类型（真正存在的）仍然是 B。因此，会调用 B 中的版本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-31T12:03:12.743

`println(...)`类中有许多声明`PrintStream`（即 的类型`System.out`）。

其中两个是：

```
void println(String x)
void println(Object x) 
```

当您调用时`println((A)b)`，编译器会选择调用`println(Object)`，因为`A`is not `String`（或任何其他`println`支持的类型）。当您调用`println(b.toString())`时，编译器会选择`println(String)`，因为您*正在*传递一个字符串。

在您的情况下，转换`b`为`A`无效，因为 println() 没有 A 或 B 类型的声明。但是转换仍然会发生（因为你要求它），或者它不会因为编译器优化它，因为它知道它是多余的并且它不会失败并且没有效果。

不习惯这样写：

```
A a2 = (A)b; 
```

因为这是多余的，因为 B 是 A 的子类。编译器可能会优化转换（这是*检查*对象是否属于特定类型的运行时操作，从不更改其类型）。

一旦构造了 B 类型的对象，它的类型就*永远不会*改变。它总是一个 B：

```
class B extends/implements A {...}
B b = new B();   // construct a B
A a = b;         // assign a B to an A variable, it's superclass
A a = (A) b      // as above including check to see that b is an A (redundant, may be optimised away).

B b = a;         // Syntax error, won't compile
B b = (B) a      // Will check whether a is of type B then assign to variable b 
```

在最后一种情况下，因为`B`是 的子类`A`，所以可能是 a 持有 的实例`B`并且强制转换会成功。或者它可能是 a 持有其他扩展/实现/是`A`而不是 a 的类的实例，`B`你会得到一个`ClassCastException`.

因此，由于类型 B 的对象始终保留其身份（它是“B”-ness），因此在该对象上调用的任何（实例-）方法将始终调用 B 的实现，无论您访问对象所通过的变量是否被声明为 A或 B。

请记住，您只能调用在定义变量的类中声明的方法。

例如，如果 B 声明了一个方法，`b_only()`那么编译器将不允许您编写`a.b_only()`; 你可以写`((B)a).b_only()`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-31T00:31:58.270

> 这个对吗？

有点。转换表达式的结果将是 A 类型。“b”变量的类型将始终保持为 B 类型。

> 另一个问题：即使我将 b 的类型更改为超类的类型，是否会调用子类中的覆盖方法，而不是超类的方法？

*底层对象*的实例方法将被调用。例子：

```
class Foo {
    public static void main(String[] args) {
        B b = new B();
        assert "B".equals(((A) b).m());
    }
}

class A {
    String m() { return "A"; }
}

class B extends A {
    String m() { return "B"; }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-31T00:36:02.677

由于 Java 方法都有动态分派，因此调用哪个函数不取决于引用的静态类型。因此，无论有没有演员，结果都是一样的。[如果您向下转换，结果可能会有所不同 - 转换版本可能会引发异常]

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-17T06:33:51.750

我认为当我们在 java 中使用引用变量并使用这个变量时，我们可以分配任何类类型的对象。大多数情况下，我们创建接口和抽象类的引用变量，因为我们无法创建接口和抽象类的对象，所以将类的对象分配到接口或抽象类的引用变量中。前任-

```
Interface X {
 public abstract void xx();
 public abstract void yy();
}

Class XXX implements X {
   ...........
}

Class XY extends XXX {
  X xy = new XXX();
} 
```

这里xy是Interface X的引用，在Interface的引用中赋值给Class XXX的对象。

所以根据我的观点，通过使用引用变量我们也可以使用接口来参与对象的创建。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-31T04:49:33.273

始终将您的对象视为它被实例化的类型（在您的情况下为 B）。如果对 A 很上心，可以把它想象成——嗯——把它想象成 B 穿上 A 的衣服。它可能看起来像一个 A，你可能无法做任何你想做的好 B 的事情，但在衣服里面它仍然是一个 B——衣服根本不会改变底层的对象。

所以总结是——你只能调用 A 中的方法，但是当你调用它时，它会直接执行它，就像它是 B 一样。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-08-19T13:49:44.170

**问题：即使我将 b 的类型更改为超类的类型，是否会调用子类中的覆盖方法，而不是超类的方法？**

在这种情况下，**子类 b**的方法被调用；令人信服地理解原因；您可能与以下现实世界场景有关

考虑一个父类**父亲**表现出一种行为（方法）：**高度** 定义为

父亲很高；身高 = 6'2"

**Son**是一个子类，继承了父亲的**身高**行为；因此他也很高；高度为 6' 显然覆盖了行为

每当您的子类 Son 以他的名字调用行为高度时，他都会显示**被覆盖的行为，即他自己的高度 6'**。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-02T14:41:57.227

The casting, as has been mentioned, is irrelevant in this case due to overridden methods being dynamically bound. Since the toString is present in all objects it meets this condition and thus the object type and method to call are determined at runtime.

Please note though, this is NOT the case with all methods since only overridden methods are dynamically bound. Overloaded methods are statically bound. Many of the answers here mention that java methods are always dynamically bound, which is incorrect.

[See this question for a more detailed explanation.](https://stackoverflow.com/questions/321864/java-dynamic-binding-and-method-overriding/322234#322234)

# c# - 用所有注册的文件类型（不仅仅是扩展名）填充组合框的最有效方法是什么

> ID：497777
> 
> 赞同：1
> 
> 时间：2009-01-31T00:11:40.153
> 
> 标签：c#, file, combobox, registry

在 Windows 中用所有已注册的文件类型填充 ComboBox 最有效的是什么？

我想要完整的文件类型，而不仅仅是扩展名。我正在使用 VB 9 (VS2008)。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-31T00:23:13.403

所有文件类型都存储在 HKEY_CLASS_ROOT 下的注册表中，您可以使用框架的[Registry 类](http://msdn.microsoft.com/en-us/library/microsoft.win32.registry.aspx)来获取它。

这是执行任务的 c# 代码：

```
using Microsoft.Win32;

public class FileAssoc
{
    public string Extension;
    public string Filetype;

    public FileAssoc(string fileext, string name)
    {
        Extension = fileext;
        Filetype = name;
    }
}

public static class EnumRegFiles
{
    public static List<FileAssoc> GetFileAssociations()
    {
        List<FileAssoc> result = new List<FileAssoc>();
        RegistryKey rk = Registry.ClassesRoot;

        String[] names = rk.GetSubKeyNames();
        foreach (string file in names)
        {
            if (file.StartsWith("."))
            {
                RegistryKey rkey = rk.OpenSubKey(file);
                object descKey = rkey.GetValue("");

                if (descKey != null)
                {
                    string desc = descKey.ToString();
                    if (!string.IsNullOrEmpty(desc))
                    {
                        result.Add(new FileAssoc(file, desc));
                    }
                }
            }
        }

        return result;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-31T00:46:28.850

我同意 Joel 的观点，这将是很多条目，并且试图在包含数百个项目的组合框列表中查找某些内容最终会导致用户体验非常糟糕。除此之外，获取此信息的唯一方法是通过注册表，正如 Mitch 所说，但这不是简单的代码。

你想达到什么目的？

**编辑：** @Mitch Wheat，我知道这是写给@Mark Brackett，但我无法抗拒挑战。使用 LINQ，您的代码可以写成：

```
public static IList GetFileAssociations()
{
    return Registry.ClassesRoot.GetSubKeyNames().Where(key => key.StartsWith(".")).Select(key =>
    {
        string description = Registry.ClassesRoot.OpenSubKey(key).GetValue("") as string;
        if (!String.IsNullOrEmpty(description))
        {
            return new { key, description };
        }
        else
        {
            return null;
        }
    }).Where(a => a != null).ToList();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-10-04T16:29:08.200

```
using Microsoft.Win32;
using System.Collections;
internal static class Extensions
{
    /// <summary>
    /// Gets a dictionary containing known file extensions and description from HKEY_CLASSES_ROOT.
    /// </summary>
    /// <returns>dictionary containing extensions and description.</returns>
    public static Dictionary<string, string> GetAllRegisteredFileExtensions()
    {
        //get into the HKEY_CLASSES_ROOT
        RegistryKey root = Registry.ClassesRoot;

        //generic list to hold all the subkey names
        Dictionary<string, string> subKeys = new Dictionary<string, string>();

        //IEnumerator for enumerating through the subkeys
        IEnumerator enums = root.GetSubKeyNames().GetEnumerator();

        //make sure we still have values
        while (enums.MoveNext())
        {
            //all registered extensions start with a period (.) so
            //we need to check for that
            if (enums.Current.ToString().StartsWith("."))
                //valid extension so add it and the default description if it exists
                subKeys.Add(enums.Current.ToString(), Registry.GetValue(root.Name + "\\" + enums.Current.ToString(), "", "").ToString());
        }
        return subKeys;
    }   
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T00:15:28.910

我知道这不能回答您的问题，但值得考虑：在许多系统上，有*很多*项目。也许是搜索或列表框？

# c# - 收益中断有什么用？

> ID：497780
> 
> 赞同：34
> 
> 时间：2009-01-31T00:13:50.913
> 
> 标签：c#, yield, iterator

> **可能重复：**
> [“yield break”是什么意思？在 C# 中做？](https://stackoverflow.com/questions/231893/what-does-yield-break-do-in-c)

任何人都可以看到使用“break”或“return”无法实现的“yield break”语句的用途。

这种说法似乎完全没有用。更重要的是，如果没有这个语句，“yield return X”语句可能会被简化为“yield X”，这样更易​​读。

我错过了什么？

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-01-31T01:04:38.080

举一个代码示例，假设您要编写一个迭代器，如果源为 null 或为空，则该迭代器不返回任何内容。

```
public IEnumerable<T> EnumerateThroughNull<T>(IEnumerable<T> source)
{
    if (source == null)
        yield break;

    foreach (T item in source)
        yield return item;
} 
```

如果没有 yield break，就不可能在迭代器中返回一个空集。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-31T00:29:57.807

yield break 指定方法应该停止返回结果。“返回”本身不够好，甚至可能导致错误，因为方法的返回类型必须是 IEnumerable。

我不确定为什么还需要 return 关键字。我最好的猜测是它有助于使声明的意图更加清晰。

如果你有兴趣，这篇文章解释了 yield 在幕后做了什么

[C# yield 关键字的幕后花絮](http://startbigthinksmall.wordpress.com/2008/06/09/behind-the-scenes-of-the-c-yield-keyword/)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-31T01:04:40.483

yield break 和 break 做完全不同的事情！看

```
for(int i = 0; i < 10; ++i) {
   if(i > 5) { break; }
   yield return i;
}

for(int v = 2710; v < 2714; v+=2) {
   yield return v;
}

for(int s = 16; s < 147; ++s) {
   if(s == 27) { yield break; }
   else if(s > 17) { yield return s; }
} 
```

输出将是以下值的 IEnumerable：0、1、2、3、4、5、2710、2712、18、19、20、21、22、23、24、25、26

这是一些没有用的方法，但它说明您可以将 yield break 和 break 组合到同一个方法中，它们做了两件不同的事情！Break 只是跳出循环，yield break 完全结束方法。

我猜未使用 return 的原因是因为您没有在方法中自己返回 IEnumerable 。此外，对于这种迭代情况，您不认为 yield break 比 return 更清晰吗？我个人会。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-31T00:56:08.347

`return`在迭代器块中使用语句是非法的。此外，`break`如果允许该语句影响迭代，则该语句可以在迭代器块中用于双重目的：它可以用于跳出循环或跳出开关，并且可以用于跳出整个迭代。

`yield return`and `yield break`and 本身就是两个关键字，它们似乎都是必要的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-31T00:52:18.807

您需要区分返回一个已经存在的 IEnumerable 实现（也许您将返回一个 List）和一个匿名迭代器。

您不能只使用 return 或 break，因为它们是可用于其他目的的有效关键字。您也不能单独使用yield，因为您需要有一种方法来指定是返回枚举中的项目还是结束枚举，因此需要yield return 和yield break。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-31T00:58:22.943

`return`语句用于从函数返回值。

如果您有这样的迭代器函数：

```
public IEnumerable<int> IteratorOverInt() { } 
```

上述函数中的 return 语句需要返回一个填充的`IEnumerable<int>`.

```
public IEnumerable<int> IteratorOverInt() {
    return new List<int> { 1, 2, 3, 4 };
} 
```

但是如果您正在处理迭代器函数，您将使用`yield return`，因此您的代码可能如下所示：

```
public IEnumerable<int> IteratorOverInt() {
    for (int i = 0; i < 4; i++) {
        yield return i;
    }
} 
```

方法签名要求`yield return`的返回时间也是如此`int``IEnumerable<int>`

`return`在上述情况下，声明会做什么？返回结果覆盖收益率？将任何内容连接到收益率？`return`在上述情况下没有多大意义。

因此，我们需要一种`return`在迭代器块中有意义的方法，这就是为什么存在`yield break`.

当然你可以用 a 来做`break`，但是如果你有更多要执行的代码，你将如何退出函数体？将所有内容包装在一个复杂的 if-else 块中？我会说只是拥有`yield break`会更好。

# c# - 如何在 c# 中将字符串从 utf8 转换（音译）为 ASCII（单字节）？

> ID：497782
> 
> 赞同：11
> 
> 时间：2009-01-31T00:14:26.480
> 
> 标签：c#, encoding, utf-8, ascii, transliteration

我有一个字符串对象

“具有多个字符甚至特殊字符”

我正在尝试使用

```
UTF8Encoding utf8 = new UTF8Encoding();
ASCIIEncoding ascii = new ASCIIEncoding(); 
```

对象，以便将该字符串转换为 ascii。我可以请人为这个简单的任务带来一些启发，那就是打猎我的下午。

编辑 1：我们想要完成的是摆脱特殊字符，如一些特殊的 windows 撇号。我在下面发布的作为答案的代码不会解决这个问题。基本上

> 奥布莱恩将成为奥布莱恩。其中 ' 是特殊撇号之一

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-31T00:34:28.780

这是对您的另一个问题的回应，看起来它已被删除......这一点仍然存在。

看起来像一个[经典的 Unicode 到 ASCII 问题](http://www.joelonsoftware.com/articles/Unicode.html)。诀窍是找到它发生的*地方*。

.NET 与 Unicode 一起工作得很好，假设[它被告知它是以 Unicode](http://msdn.microsoft.com/en-us/library/system.text.encoding.aspx)开头（或保留为默认值）。

我的*猜测*是您的接收应用程序无法处理它。所以，我可能会将[ASCIIEncoder](http://msdn.microsoft.com/en-us/library/system.text.asciiencoding.aspx) [与](http://msdn.microsoft.com/en-us/library/system.text.encoder.fallback.aspx)[EncoderReplacementFallback](http://msdn.microsoft.com/en-us/library/system.text.encoderreplacementfallback.aspx)和 String.Empty一起使用：

```
using System.Text;

string inputString = GetInput();
var encoder = ASCIIEncoding.GetEncoder();
encoder.Fallback = new EncoderReplacementFallback(string.Empty);

byte[] bAsciiString = encoder.GetBytes(inputString);

// Do something with bytes...
// can write to a file as is
File.WriteAllBytes(FILE_NAME, bAsciiString);
// or turn back into a "clean" string
string cleanString = ASCIIEncoding.GetString(bAsciiString); 
// since the offending bytes have been removed, can use default encoding as well
Assert.AreEqual(cleanString, Default.GetString(bAsciiString)); 
```

当然，在过去，我们只是循环并删除任何[大于 127](http://asciitable.com/)的字符......好吧，至少我们这些在美国的人。;)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-31T00:25:33.477

我能够弄清楚。如果有人想知道下面对我有用的代码：

```
ASCIIEncoding ascii = new ASCIIEncoding();
byte[] byteArray = Encoding.UTF8.GetBytes(sOriginal);
byte[] asciiArray = Encoding.Convert(Encoding.UTF8, Encoding.ASCII, byteArray);
string finalString = ascii.GetString(asciiArray); 
```

让我知道是否有更简单的方法。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-02-02T21:48:34.683

对于任何喜欢扩展方法的人来说，这个方法对我们有用。

```
using System.Text;

namespace System
{
    public static class StringExtension
    {
        private static readonly ASCIIEncoding asciiEncoding = new ASCIIEncoding();

        public static string ToAscii(this string dirty)
        {
            byte[] bytes = asciiEncoding.GetBytes(dirty);
            string clean = asciiEncoding.GetString(bytes);
            return clean;
        }
    }
} 
```

（系统命名空间，因此它几乎可以自动用于我们所有的字符串。）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-03-28T09:33:45.837

基于上面 Mark 的回答（和 Geo 的评论），我创建了一个两个班轮版本来从字符串中删除所有 ASCII 异常情况。提供给寻找这个答案的人（就像我一样）。

```
using System.Text;

// Create encoder with a replacing encoder fallback
var encoder = ASCIIEncoding.GetEncoding("us-ascii", 
    new EncoderReplacementFallback(string.Empty), 
    new DecoderExceptionFallback());

string cleanString = encoder.GetString(encoder.GetBytes(dirtyString)); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-07-17T14:23:23.417

如果您想要在许多编码中使用的字符的 8 位表示，这可能会对您有所帮助。

您必须将变量**targetEncoding**更改为您想要的任何编码。

```
Encoding targetEncoding = Encoding.GetEncoding(874); // Your target encoding
Encoding utf8 = Encoding.UTF8;

var stringBytes = utf8.GetBytes(Name);
var stringTargetBytes = Encoding.Convert(utf8, targetEncoding, stringBytes);
var ascii8BitRepresentAsCsString = Encoding.GetEncoding("Latin1").GetString(stringTargetBytes); 
```

# c++ - 为什么有人会使用 C 而不是 C++？

> ID：497786
> 
> 赞同：147
> 
> 时间：2009-01-31T00:15:49.207
> 
> 标签：c++, c

尽管人们似乎喜欢[抱怨](http://odgaard.org/jeod/funny/interview.html)C++，但我还没有找到太多证据来说明您为什么要选择 C ​​而不是 C++。C 似乎并没有受到那么多的抨击，如果 C++ 有所有这些问题，为什么你不能把自己限制在 C 子集上呢？你的想法/经验是什么？

* * *

## 回答 #1

> 赞同：143
> 
> 时间：2009-01-31T00:43:31.617

Joel 的回答很好，因为您可能*不得不*使用 C，尽管还有其他一些原因：

*   您必须符合行业准则，这些准则更容易在 C 中证明和测试
*   您有使用 C 的工具，但没有使用 C++（不仅要考虑编译器，还要考虑所有支持工具、覆盖范围、分析等）
*   您的目标开发人员是 C 大师
*   您正在编写驱动程序、内核或其他低级代码
*   您知道 C++ 编译器不擅长优化您需要编写的代码类型
*   您的应用程序不仅不适合面向对象，而且更难以这种形式编写

但是，在某些情况下，您可能*希望*使用 C 而不是 C++：

*   您想要汇编程序的性能而无需在汇编程序中进行编码（理论上，C++ 具有“完美”性能，但编译器并不擅长看到优秀的 C 程序员会看到的优化）

*   您正在编写的软件是微不足道的，或者几乎是微不足道的 - 拿出微型 C 编译器，编写几行代码，编译，一切就绪 - 无需打开带有助手的大型编辑器，无需实际编写空且无用的类，处理命名空间等。您可以使用 C++ 编译器执行几乎相同的操作，只需使用 C 子集，但 C++ 编译器速度较慢，即使对于小型程序也是如此。

*   您需要极高的性能或较小的代码大小，并且知道由于库的大小和性能，C++ 编译器实际上会使其更难完成。

您争辩说您可以只使用 C 子集并使用 C++ 编译器进行编译，但您会发现，如果这样做，您会得到稍微不同的结果，具体取决于编译器。

无论如何，如果你这样做，你正在使用 C。你的问题真的是“为什么 C 程序员不使用 C++ 编译器？” 如果是，那么您要么不了解语言差异，要么不了解编译器理论。

* * *

## 回答 #2

> 赞同：119
> 
> 时间：2009-04-05T04:23:48.957

我喜欢极简主义和简单。

* * *

## 回答 #3

> 赞同：69
> 
> 时间：2009-01-31T00:18:50.403

*   因为他们已经知道 C
*   因为他们正在为只有 C 编译器的平台构建嵌入式应用程序
*   因为他们正在维护用 C 编写的遗留软件
*   您正在编写操作系统、关系数据库引擎或零售 3D 视频游戏引擎级别的东西。

* * *

## 回答 #4

> 赞同：61
> 
> 时间：2009-01-31T00:52:21.537

对性能或膨胀的恐惧并不是放弃 C++ 的好理由。每种语言都有其潜在的缺陷和权衡——优秀的程序员会了解这些，并在必要时制定应对策略，糟糕的程序员会犯错并责怪该语言。

解释型 Python 在许多方面都被认为是一种“慢”语言，但对于不平凡的任务，熟练的 Python 程序员可以轻松地生成执行速度比没有经验的 C 开发人员更快的代码。

在我的行业，视频游戏中，我们通过避免诸如 RTTI、异常或内部循环中的虚函数之类的东西来用 C++ 编写高性能代码。这些可能非常有用，但存在需要避免的性能或膨胀问题。如果我们更进一步并完全切换到 C，我们将收获甚微，并且会失去 C++ 中最有用的结构。

首选 C 的最大实际原因是支持比 C++ 更广泛。有许多平台，尤其是嵌入式平台，甚至没有 C++ 编译器。

还有供应商的兼容性问题。虽然 C 具有稳定且定义明确的 ABI（应用程序二进制接口），但 C++ 没有。由于 vtables 和构造函数/析构函数之类的东西，C++ 中的 ABI 更加复杂，因此每个供应商的实现方式都不同，甚至供应商工具链的版本也不同。

实际上，这意味着您无法获取由一个编译器生成的库并将其与来自另一个编译器的代码或库链接，这为分布式项目或二进制库的中间件提供者创造了一场噩梦。

* * *

## 回答 #5

> 赞同：48
> 
> 时间：2009-02-02T07:11:31.053

我持有另一种观点：为什么使用 C++ 而不是 C？

[The C Programming Language](https://rads.stackoverflow.com/amzn/click/com/0131103628) （又名：K&R）这本书在 300 页内清楚地告诉你如何做这门语言可以做的所有事情。这是极简主义的杰作。甚至没有 C++ 书籍能接近。

明显的反对意见是，即使不是全部，大多数现代语言也可以这样说——它们也不能在几百页内告诉你如何做所有事情。真的。那么为什么要改用 C++ 呢？功能丰富？力量？如果您需要功能更丰富或更强大的东西，请使用 C#、Objective C、Java 或其他类似的东西。为什么要背负 C++ 的复杂性？如果您需要 C++ 授予的控制程度，那么我主张使用 C。C 可以做任何事情并且可以做得很好。

* * *

## 回答 #6

> 赞同：40
> 
> 时间：2009-01-31T00:26:07.877

我选择用 C 编写是因为我喜欢使用一种小巧紧凑的语言。我喜欢访问可以在合理的时间内阅读的标准（对我来说——我是一个非常慢的读者）。此外，我用它为嵌入式系统编写软件，这些系统几乎没有理想的 C++ 编译器（比如**一些**PIC 微控制器）。

* * *

## 回答 #7

> 赞同：34
> 
> 时间：2009-01-31T16:48:43.773

除了已经提到的其他几点：

少惊喜

也就是说，更容易看出一段代码究竟会做*什么*。在 C++ 中，您需要接近大师级别才能准确了解编译器生成的代码（尝试组合模板、多重继承、自动生成的构造函数、虚函数并混合一些命名空间魔术和参数相关查找）。

在许多情况下，这种魔法很不错，但例如在实时系统中，它真的会搞砸你的一天。

* * *

## 回答 #8

> 赞同：28
> 
> 时间：2009-01-31T00:30:28.117

Linus 对您的问题的回答是[“因为 C++ 是一种可怕的语言”](http://thread.gmane.org/gmane.comp.version-control.git/57643/focus=57918)

他的证据充其量只是轶事，但他有一个道理。

作为一种低级语言，您会更喜欢 C++..C++ 是 C，具有添加的库和对额外功能的编译器支持（[两种语言都具有另一种语言没有的功能，并且实现方式不同](http://www.cs.utk.edu/~huangj/CS302S04/notes/c_versus_c++.html)），但是如果您有使用 C 的时间和经验，您可以从额外添加的低级相关功能中受益... **[编辑]**（因为您*习惯于*手动完成更多工作，而不是从语言/编译器本身的某些功能中受益）

添加链接：

[为什么 C++ 用于嵌入式](http://www.embedded.com/212101526)

[你为什么还在用C？PDF格式](http://www.objectmentor.com/resources/articles/WhyAreYouStillUsingC.pdf)

我会为此[谷歌](http://www.google.com/search?source=ig&hl=en&rlz=1G1GGLQ_ENXX247&q=c+versus+c%2B%2B&btnG=Google+Search&aq=0&oq=c+versus+c)..因为网上已经有很多评论了

* * *

## 回答 #9

> 赞同：28
> 
> 时间：2012-06-04T19:41:34.700

我习惯于在我的项目中使用 C++。然后我找到了一份使用纯 C 的工作（一个 20 年的不断发展的 AV 软件代码库，文档很差......）。

我在 C 中喜欢的 3 件事是：

*   没有什么是隐含的：你可以看到你的程序究竟做了什么或不做什么。这使得调试更容易。

*   没有命名空间和重载可能是一个优势：如果你想知道某个函数在哪里被调用，只需通过 grep 搜索源代码目录，它就会告诉你。无需其他特殊工具。

*   我重新发现了函数指针的威力。基本上它们允许你做所有你在 C++ 中做的多态的事情，但它们更加灵活。

* * *

## 回答 #10

> 赞同：26
> 
> 时间：2009-01-31T00:24:08.503

因为他们正在编写一个插件，而 C++ 没有标准的 ABI。

* * *

## 回答 #11

> 赞同：25
> 
> 时间：2009-01-31T00:35:39.573

编译时间长可能很烦人。使用 C++，你可以有很长的编译时间（当然，这意味着 Stack Overflow 有更多的时间！）。

* * *

## 回答 #12

> 赞同：20
> 
> 时间：2009-03-13T13:00:48.493

如果您希望几乎任何程序员都能理解您的代码，请使用 C 语言编写。

* * *

## 回答 #13

> 赞同：15
> 
> 时间：2009-01-31T01:53:34.440

我很惊讶没有人提到图书馆。许多语言可以链接到 C 库并调用 C 函数（包括带有外部“C”的 C++）。C++ 几乎是唯一可以使用 C++ 库的东西（定义为“使用 C++ 中没有的 C 功能的库 [例如重载函数、虚拟方法、重载运算符……]，并且不导出一切都通过 C 兼容接口通过 extern "C"')。

* * *

## 回答 #14

> 赞同：13
> 
> 时间：2009-01-31T00:28:38.213

因为他们想使用 C99 中没有 C++ 等价物的特性。

* * *

但是，对 C++ 有用的 C99 特性并不像人们乍一看那样多。变长数组？C++ 有 std::vectors。支持复数/虚数？C++ 有一个模板化的复杂类型。类型通用数学函数？C++ 重载了标准数学函数，导致相同的结果。

命名初始化器？不在 C++ 中，但有一个解决方法：

```
struct My_class_params {
    int i;
    long j;
    std::string name;

    My_class_params& set_i(int ii)
    {
        i = ii;
        return *this;
    }

    My_class_params& set_j(long jj)
    {
        j = jj;
        return *this;
    }

    template <typename STRING>
    My_class_params& set_name(STRING&& n)
    {
        name = std::forward<STRING>(n);
        return *this;
    }

    My_class_params()
    {
        // set defaults
    }
};

class My_class {
    My_class_params params;
  public:
    My_class(const My_class_params& p) : params(p) { }
    ...
}; 
```

这使您可以编写如下内容：

```
My_class mc(My_class_params().set_i(5).set_name("Me")); 
```

* * *

## 回答 #15

> 赞同：10
> 
> 时间：2009-02-02T06:58:33.497

这很肤浅，但作为一个忙碌的学生，我选择了 C，因为我认为 C++ 学习时间太长。我大学的许多教授不会接受 Python 的作业，我需要快速学习一些东西。

* * *

## 回答 #16

> 赞同：9
> 
> 时间：2009-01-31T09:23:46.013

因为对于许多编程任务，C 更简单，而且足够好。特别是当我在编写轻量级实用程序时，我会觉得 C++ 想要我构建一个优雅的超级结构，而不是简单地编写代码。

OTOH，对于更复杂的项目，优雅提供了比我的键盘自然流出的更好的坚固结构严谨性。

* * *

## 回答 #17

> 赞同：8
> 
> 时间：2009-01-31T02:12:18.940

c++ 的大多数重要特性都以某种方式涉及类或模板。除了编译器将它们转换为目标代码的方式之外，这些都是很棒的特性。大多数编译器使用名称修饰，而那些不做的事情至少是混乱的。

如果您的系统独立运行，就像许多应用程序一样，那么 C++ 是一个不错的选择。

如果您的系统需要与不一定用 C++ 编写的软件（最常见的是汇编程序或 Fortran 库）进行交互，那么您就处于困境中。要与这些情况进行交互，您需要禁用这些符号的名称修改。这通常通过声明这些对象来完成`extern "C"`，但它们不能是模板、重载函数或类。如果这些很可能是您的应用程序 API，那么您必须用辅助函数包装它们，并使这些函数与实际实现保持同步。

实际上，C++ 语言为可以在纯 C 中轻松实现的功能提供了标准语法。

简而言之，可互操作的 C++ 的开销对于大多数人来说太高了。

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2009-06-11T05:19:08.167

哦，我的，C 与 C++，一个伟大的方式来开始一场激烈的战争。:)

我认为 C 更适合驱动程序和嵌入式代码。

C++ 有一些 C 没有的强大特性，但是当人们编写代码时，C++ 的许多面向对象特性可能会导致巨大的编码混乱，而这些代码在幕后会出现不明显的副作用。疯狂的代码可以隐藏在构造函数、析构函数、虚函数中...等等。很多问题是某些人的不良编码习惯。

我的完美语言将是 C99 和更安全的 C++ 功能的最小子集的组合，它将零（或接近零）编译器开销添加到二进制输出。完美的补充将是数据和函数的类封装和命名概念。

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2009-01-31T11:39:12.930

关于“只使用你想使用的 C++ 的子集”的一句话：这个想法的问题在于，强制项目中的每个人都使用相同的子集是有代价的。我自己的观点是，对于松散耦合的项目（例如开源项目）来说，这些成本相当高，而且 C++ 在成为更好的 C 方面完全失败，因为无论你在哪里使用 C，你都不能使用 C++。

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2009-01-31T16:27:46.220

> 我还没有找到很多证据来说明您为什么要选择 C ​​而不是 C++。

你很难把我要说的东西称为证据；这只是我的意见。

人们喜欢 C 是因为它非常适合程序员的头脑。

C++有很多复杂的规则【什么时候需要虚析构函数，什么时候可以在构造函数中调用虚方法，重载和覆盖如何交互……】，要掌握它们都需要付出很多努力。此外，在引用、运算符重载和函数重载之间，理解一段代码可能需要您理解其他可能不容易找到的代码，也可能不容易找到。

关于为什么组织更喜欢 C 而不是 C++ 的另一个问题。我不知道，我只是一个人;-)

在为 C++ 辩护时，它确实带来了有价值的特性；不过，我最看重的可能是参数（'ish）多态性：将一种或多种类型作为参数的操作和类型。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2009-01-31T00:20:25.377

我想说，C 比 C++ 可以更好地控制优化和效率，因此在内存和其他资源有限且每个优化都有帮助的情况下很有用。当然，它的占地面积也更小。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2009-01-31T01:13:17.377

还有一些商店采用类似 C 的方式使用 C++ 的*某些*特性的方法，但要避免那些令人反感的特性。例如，使用类和类方法以及函数重载（即使是 C 顽固分子通常也很容易应对），但不使用 STL、流运算符和 Boost（它们更难学习并且可能具有不良的内存特性）。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2009-01-31T00:59:05.173

因为您正在为资源紧张的系统（例如嵌入式系统或某种真正的裸机代码，如内核）编写代码，并且您希望尽可能少的开销。

大多数嵌入式系统没有 C++ 编译器是有原因的——并不是人们不想要一个，而是将 C++ 代码塞进这么小的空间是几乎不可能完成的任务。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2009-01-31T01:50:23.230

C 需要的是一个更好的预处理器。cfront 是其中之一，因此诞生了 c++

我会使用 C，其中“c++ 作为预处理器”是不行的。

我很确定，在任何编写良好的 c++ 库/框架/工具包的底部，您都会找到脏旧的 c（或静态强制转换，它们是相同的）

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2009-01-31T01:00:49.477

*   直到几年前，现有的 C++ 编译器都缺少重要的特性，或者支持很差，支持的特性在它们之间差异很大，因此很难编写可移植的应用程序。
*   由于符号没有标准命名，其他语言/应用程序很难直接支持 C++ 类。

# java - 快速排序比合并排序慢？

> ID：497794
> 
> 赞同：21
> 
> 时间：2009-01-31T00:20:04.627
> 
> 标签：java, algorithm, quicksort, mergesort

昨天我正在努力实现一个快速排序，然后我运行它，期望比 Mergesort 更快的运行时间（我也实现了）。我运行了这两个，虽然快速排序对于小于 100 个元素的较小数据集更快（并且我*确实*验证了它的工作原理），但合并排序很快成为更快的算法。有人告诉我，快速排序几乎总是比归并排序“更快”，而且我知道关于这个话题存在一些争论，但我至少预计它会比这更接近。对于 >10000 个元素的数据集，合并排序的速度提高了 4 倍以上。这是意料之中的，还是我的快速排序代码中有错误？

合并排序：

```
public static void mergeSort(int[ ] e)
{
    if (e.length <= 1) return;
    int[] first = new int[e.length/2];
    int[] second = new int[e.length - first.length];
    System.arraycopy(e, 0, first, 0, first.length);
    System.arraycopy(e, first.length, second, 0, second.length);
    mergeSort(first);
    mergeSort(second);
    System.arraycopy(merge(first, second), 0, e, 0, e.length);
}

private static int[] merge(int[] first, int[] second) {
    int iFirst = 0;
    int iSecond = 0;
    int iCombined = 0;

    int[] combined = new int[first.length + second.length];
    while(iFirst < first.length && iSecond < second.length) {
        if (first[iFirst] > second[iSecond]) {
            combined[iCombined++] = second[iSecond++];
        }
        else combined[iCombined++] = first[iFirst++];
    }
    for(; iFirst < first.length; iFirst++) {
        combined[iCombined++] = first[iFirst];
    }
    for(; iSecond < second.length; iSecond++) {
        combined[iCombined++] = second[iSecond];
    }
    return combined;
} 
```

快速排序：

```
public static void quicksort(int[] a, int first, int last) {
    if (first >= last) return;

    int partitionIndex = partition(a, first, last);
    quicksort(a, first, partitionIndex - 1);
    quicksort(a, partitionIndex + 1, last);
}

public static int partition(int[] x, int first, int last) {
    int left = first;
    int right = last;
    int pivot = x[first];
    int pivotIdx = first;

    while(left <= right) {
        while(left < x.length && x[left] <= pivot) left++;
        while(right >= 0 && x[right] > pivot) right--;
        if (left <= right) {
            int temp = x[left];
            x[left] = x[right];
            x[right] = temp;
        }
    }
    pivotIdx = right;
    x[first] = x[right];
    x[pivotIdx] = pivot;
    return pivotIdx;
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-31T01:29:43.833

实际上，我只是用 C 语言编写了一个“链表比较排序演示程序”，并得出了类似的结论（合并排序在大多数情况下会胜过快速排序），尽管有人告诉我快速排序通常不用于链表。我会注意到**枢轴值的选择**是一个可怕的因素——我的初始版本使用一个随机节点作为枢轴，当我稍微改进它以取两个（随机）节点的平均值时，1000000 条记录的执行时间从超过 4 分钟缩短到不到 10 秒，与归并排序相当。

合并排序和快速排序具有相同的大 O 最佳情况 (n*log(n))，尽管人们可能试图声称，大 O 实际上是关于迭代计数而不是比较计数。它们两者之间可以产生的**最大差异**总是对快速排序不利，并且它涉及已经大量排序或包含大量关系的列表（当快速排序比合并排序更好时，差异不会那么大伟大的）。这是因为关系或已经排序的段直接通过合并排序进行流线化；当两个拆分列表返回合并时，如果一个列表已经包含所有较小的值，则左侧的所有值将一次一个地与右侧的第一个元素进行比较，然后（因为返回的列表具有内部秩序）没有进一步*需要进行*比较，然后将权利简单地**迭代*到最后。也就是说，迭代次数会保持不变，但比较次数会减半。如果您正在谈论实际时间并且正在对字符串进行排序，那么比较昂贵。*

 *如果没有仔细确定枢轴值，则快速排序中的平局和已排序的段很容易导致不平衡的列表，而不平衡的列表（例如，右侧一个，左侧十个）是导致减速的原因。因此，如果您可以让您的快速排序在已经排序的列表上像在随机化列表上一样执行，那么您就有了一个很好的方法来找到枢轴。

如果您有兴趣，演示程序会产生如下输出：

```
[root~/C] ./a.out -1 3 
Using "", 0 records
Primary Criteria offset=128

Command (h for help, Q to quit): N
How many records? 4000000
New list is 562500.00 kb

Command (h for help, Q to quit): m

Mergesorting..............3999999 function calls
123539969 Iterations     Comparison calls: 82696100
Elapsed time: 0 min 9 sec

Command (h for help, Q to quit): S
Shuffled.

Command (h for help, Q to quit): q

Quicksorting..............4000000 function calls
190179315 Iterations     Comparison calls: 100817020
Elapsed time: 0 min 23 sec 
```

Altho 没有疯狂的色彩。[在这一页](http://cboard.cprogramming.com/showthread.php?t=111262&page=2 "这一页")的一半左右，我还有一些关于它的东西。

附言。两种排序都不需要链接列表的额外内存。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-12-10T00:18:26.860

Mergesort 对于基于随机数组的数据要慢得多，只要它适合 ram。这是我第一次看到它辩论。

*   qsort 首先排序最短的子数组。
*   切换到 5-25 个元素以下的插入排序
*   做一个正常的枢轴选择

您的 qsort 非常慢，因为它尝试对长度为 2 和 3 的数组进行分区和 qsort 排序。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-31T00:26:30.870

之前在SO上讨论过：“[为什么quicksort比mergesort好？](https://stackoverflow.com/questions/70402/why-is-quicksort-better-than-mergesort) ”

~

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-31T01:11:40.203

对于相对较小的数组大小，快速排序的优点之一只是硬件实现的产物。

在数组上，可以就地完成快速排序，这意味着您正在读取和写入同一内​​存区域。另一方面，合并排序通常需要分配新的缓冲区，这意味着您的内存访问更加分散。您可以在示例实现中看到这两种行为。

因此，对于相对较小的数据集，快速排序更有可能获得缓存命中，因此往往在大多数硬件上运行得更快。

正如您的实验所证实的那样，对于大型数据集或其他数据结构（如链表）来说，合并排序仍然是一个很好的解决方案。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-31T00:27:18.623

根据这篇维基百科[文章](http://en.wikipedia.org/wiki/Merge_sort)，您的结果是预期的。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-31T00:57:38.093

合并排序的最坏情况是快速排序的平均情况，所以如果你没有一个好的实现，合并排序总体上会更快。让快速排序快速工作是为了避免低于平均水平的情况。选择一个更好的支点（3 的中位数有帮助），您会看到不同。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-31T01:39:10.863

(1) 有一个 qsort 算法，由 C qsort() 使用，它不需要额外的内存。这很可能是霍尔发明的。*这*使得 qsort() 在 C 中快速。

(2) 在运行 qsort 之前随机化数据几乎总是会加快速度。

(3) 为枢轴选择中值数据可能会使其更快，

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-31T00:36:08.120

我可以想象，通过直接访问内存，例如使用 C，可以比使用 Mergesort 提高 Quicksort 的性能。

另一个原因是 Mergesort 需要更多内存，因为很难将其实现为就地排序。

特别是对于您的实现，您可以改进枢轴的选择，有很多不同的算法可以找到一个好的枢轴。

[正如在 wikipedia](http://en.wikipedia.org/wiki/Quicksort)上所见，可以以不同的方式实现快速排序。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-31T04:42:04.817

这与算法的分析是一致的。对于任何输入和每个运行时，合并排序都保证 O(nlogn)。快速排序是最佳情况 O(nlogn) 和平均情况 O(nlogn)，但最坏情况 O(n^2)，因此平均执行将介于 O(nlogn) 和 O(n^2) 之间。

快速排序是最好的一般情况算法，因为它的开销很低，因此它对于 n 值高达大约 10000 左右具有良好的速度，并且对于任意天文数值的 n 仍然具有良好的运行时间。合并排序具有编写堆栈帧的不幸开销，这是每个递归调用都需要的。因此，对于 n 的低值，它在 RT = cnlogn 中具有非常高的 c，并且它不是首选的一般排序方法。

编辑：软件猴子指出了一个矛盾：快速排序平均 O(nlogn) 随机输入，但 O(n^2) 最坏的情况。所以它实际上在某种程度上受数据熵的约束——或者你可以随机选择枢轴。不过，我可能还是有点走神。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-31T09:26:16.460

如果在快速排序最坏的情况下将堆排序实现为基本排序算法，则可以实现 theta(n log n) 算法。

如果您不需要稳定的排序，也不对链表进行排序，我认为这将是您最快的。

[合并排序](http://en.wikipedia.org/wiki/Merge_sort)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-11-21T22:37:22.153

我认为只要数据适合内存，好的合并排序实现就比好的快速排序实现更好。

qsort() 最广泛使用的实现之一，glibc qsort()，在数据适合内存的大多数情况下内部使用合并排序。这种合并排序分配了一个临时内存空间用于合并，这增加了一些内存开销，但大多数时候，它通过良好的枢轴选择和优化优于其自己的内部快速排序实现。当合并排序的数据和临时内存无法放入内存时，glibc 仅使用快速排序。

我已经在我的机器上用 2.1GHz CPU 和几 GB RAM 测量了这两个实现的性能。输入是用伪随机生成器生成的，每个键是32位无符号整数，这意味着由于比较函数的接口，比较周期比整数比较多一点。

对于合并排序：

```
2 MB, time_diff 165.156000 ms, 78.752518 ns per byte
4 MB, time_diff 344.298000 ms, 82.087040 ns per byte
8 MB, time_diff 730.926000 ms, 87.133169 ns per byte
16 MB, time_diff 1541.215000 ms, 91.863573 ns per byte
32 MB, time_diff 3088.924000 ms, 92.057109 ns per byte
64 MB, time_diff 6262.868000 ms, 93.324006 ns per byte
128 MB, time_diff 12887.018000 ms, 96.015766 ns per byte
256 MB, time_diff 26731.597000 ms, 99.582959 ns per byte 
```

快速排序：

```
2 MB, time_diff 243.519000 ms, 116.118908 ns per byte
4 MB, time_diff 504.975000 ms, 120.395422 ns per byte
8 MB, time_diff 1075.276000 ms, 128.182888 ns per byte
16 MB, time_diff 2183.865000 ms, 130.168498 ns per byte
32 MB, time_diff 4343.993000 ms, 129.461080 ns per byte
64 MB, time_diff 8714.166000 ms, 129.851192 ns per byte
128 MB, time_diff 17881.344000 ms, 133.226395 ns per byte
256 MB, time_diff 36751.029000 ms, 136.908252 ns per byte 
```

您可以看到这两种实现之间的性能存在明显差异，以及为什么在如此广泛使用的 qsort 实现中合并排序优于快速排序。这种差异背后的主要原因似乎是因为快速排序的比较次数比合并排序多 10-20%，这是由于每一步的拆分不均匀。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-05-15T18:08:03.607

我进行了类似的测试，结果证明纯快速排序（随机选择枢轴）比大型数组的合并排序慢得多。

选择枢轴作为第一个、中间和最后一个元素的中位数提高了快速排序的性能，但在大型数组（> 100000 个元素）上，快速排序仍然肯定比合并排序更差。

当我实现介绍排序时，我看到了很大的改进，即如果递归深度超过某个阈值，快速排序会退回到堆排序。我的介绍排序实现几乎和我的合并排序实现一样快。当然，介绍排序不再是**纯快速排序**，因为当纯快速排序遇到一些不良数据时，它使用堆排序将复杂度恢复到 n log(n)。如果您有兴趣，我可以发布结果。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-31T00:47:06.413

你的数据集足够随机吗？它们是部分排序的吗？

这可能会影响排序的速度......

就像 QuickSort 的 partition() 一样，如果数字按排序顺序，你会跳过，直到找到一个不是的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-31T00:48:56.707

这可能取决于您为测试排序的数据类型（已经排序的列表、随机的、反向排序的）。此外，如果您选择随机枢轴而不是使用第一个元素，则快速排序通常可能会更快。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-31T09:04:00.170

为了快速排序的良好性能，重要的是不要一直递归到长度为 1 的列表

如果需要，您应该考虑将 2、3 甚至 4 的列表排序为嵌套的 ifs 交换。让我们知道性能如何变化。

# asp.net - 如何阻止 ASP.NET 更改 ID 以使用 jQuery

> ID：497802
> 
> 赞同：52
> 
> 时间：2009-01-31T00:21:24.890
> 
> 标签：asp.net, jquery, ajax

我的网页中有这个标签控件

```
<asp:Label ID="Label1" runat="server" Text="test"></asp:Label> 
```

当页面呈现时，控件的 id 更改为这样的

```
 <span id="ctl00_ContentPlaceHolder1_Label3">test</span> 
```

如何阻止 asp.net 更改 ID 以执行这样的 jQuery 操作

```
$('#label1').html(xml); 
```

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2011-12-08T08:32:01.313

### 简短的回答：

放`ClientIDMode="Static"`

```
<asp:Label ID="myLabel" ClientIDMode="Static" runat="server" Text="testing"></asp:Label> 
```

* * *

### 长答案：

.NET 4 现在可以让您选择[ClientIDMode](http://msdn.microsoft.com/en-us/library/system.web.ui.control.clientidmode.aspx)：

类型：[System.Web.UI.ClientIDMode](http://msdn.microsoft.com/en-us/library/system.web.ui.clientidmode.aspx)
一个值，指示如何生成 ClientID 属性。

> **AutoID**
> ClientID 值是通过将每个父命名容器的 ID 值与控件的 ID 值连接起来生成的。在呈现控件的多个实例的数据绑定方案中，将在控件的 ID 值前面插入一个递增值。每个段由下划线字符 (_) 分隔。此算法在早于 ASP.NET 4 的 ASP.NET 版本中使用。
> 
> **静态**
> ClientID 值设置为 ID 属性的值。如果控件是命名容器，则该控件用作它所包含的任何控件的命名容器层次结构的顶部。
> 
> **可预测**
> 此算法用于数据绑定控件中的控件。ClientID 值是通过将父命名容器的 ClientID 值与控件的 ID 值连接起来生成的。如果控件是生成多行的数据绑定控件，则在末尾添加 ClientIDRowSuffix 属性中指定的数据字段的值。对于 GridView 控件，可以指定多个数据字段。如果 ClientIDRowSuffix 属性为空，则在末尾添加序号，而不是数据字段值。这个数字从零开始，每行加 1。每个段由下划线字符 (_) 分隔。
> 
> **Inherit**
> 控件继承其 NamingContainer 控件的 ClientIDMode 设置。这是默认设置。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-01-31T00:26:04.053

而不是使用这个选择器

```
$('#Label1') 
```

使用这个，基本上你使用的是经典的 asp 内联服务器端代码。

```
$('#<%= Label1.ClientID %>') 
```

这将插入生成的任何 ID 以作为文字放置。

如果您希望使用外部文件，那么我建议您在页面上创建一个全局的 obj 来保存所有客户端 ID，然后在外部文件中引用该 obj（不理想，但它是一种解决方案）

```
var MyClientIDs = {
    Label1 = '<%= Label1.ClientID %>',
    Label2 = '<%= Label2.ClientID %>',
    Textbox1 = '<%= Textbox1.ClientID %>',
    Textbox2 = '<%= Textbox2.ClientID %>'
}; 
```

然后在您的外部文件中，您可以访问 Label1 例如：`$('#' + MyClientIDs.Label1)`

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2013-10-01T06:50:45.103

在 .NET 4+ 中设置`ClientIDMode="Static"`. 这将解决您的问题。

例子：

```
<asp:Label ID="Label1" ClientIDMode="Static" runat="server" Text="test"></asp:Label> 
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2009-01-31T00:27:06.953

您无法阻止 asp.net 生成这些 ID。这就是它做事的方式。

您仍然可以像这样使用 jquery：

```
$('#<%=label1.ClientID %>').html(xml) 
```

或者

```
$('[id$=_label1]').html(xml) 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-01-31T15:13:53.887

**当**且**仅当**您的容器布局永远不会改变**并且**您需要将 JavaSctipt/jQuery 放在外部文件中时，您可以在 jQuery 选择器中使用生成的 id，即

```
$('#ctl00_ContentPlaceHolder1_Label3').html(xml); 
```

显然，这种方法需要您找出生成的 id 将是什么，并且如果您开始更改站点/应用程序结构，则需要谨慎。

否则，您*最好*的选择是

**1.**使用内联服务器端代码标记。这种方法的缺点是您不能将 js 代码放在外部文件中 -

```
$('#<%= Label3.ClientID %>').html(xml); 
```

**2.**在您需要在 jQuery 中使用的每个控件上定义唯一的 CSS 类，这仍然允许您将 js 代码放在外部文件中 -

```
<asp:Label ID="Label3" runat="server" Text="test" CssClass="label3">
</asp:Label>

$('.label3').html(xml); 
```

**3.**使用 jQuery 选择器对原始 id 进行模式匹配，这再次允许您将 js 代码放在外部文件中 -

```
$('[id$=Label3]').html(xml); 
```

此 jQuery 选择器将选择所有具有属性*id*且其值以*Label3*结尾的元素。我可以看到这种方法的唯一潜在缺点是，理论上，可以在一个母版页和两个内容页中拥有一个 ID 为 Label3 的 Label 控件。在此示例中，使用上面的 jQuery 选择器将匹配所有三个标签，这可能会产生不良后果。

**编辑：**

我认为提高您对[IDOverride 控件](http://www.wilcob.com/Wilco/News/AspNetIDOverride.aspx)的注意力可能会很有用。[可以在此处找到示例](http://www.wilcob.com/Demos/IDOverride/)页面

它允许您指定在呈现 HTML 页面时，哪些控件应该在输出的 HTML 标记中使用 .aspx 文件中给出的 id 覆盖其错位 id。我只用一个母版页和面板简单地玩过它，但它似乎运行良好。使用它，您可以在 jQuery 选择器中使用原始 id。但是请注意，如果您在母版页和内容页中拥有具有相同 id 的控件，这些控件组合起来呈现一个页面的 HTML，则结果是不可预测的。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-01-31T15:27:07.213

简短的回答，不用担心使用 asp.net ID。在 asp.net 中，您可以将自己的属性添加到标签：

```
<asp:TexBox ID="myTBox" runat="server" MyCustomAttr="foo" /> 
```

然后在 jquery 中，您可以通过以下方式引用此元素：

```
$("input[MyCustomAttr='foo']") 
```

我一直用 jQuery 来做这件事。希望能帮助到你。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2014-03-31T12:44:00.947

您可以调用类名而不是使用 ID

例如;

```
$('.CssClassName'). ... 
```

或者，如果您在 MasterPage 的第一行中键入此内容，您的控件 ID 将不会更改：

`ClientIDMode="Static"`

例如;

```
<%@ Master Language="C#" AutoEventWireup="true" CodeFile="MasterPage.master.cs" Inherits="Main_MasterPage" ClientIDMode="Static" %> 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-01-31T02:08:27.700

内联代码是正确的方法。但是，这将在 ASP.NET 4.0 中发生变化。我们花了一些时间添加一个允许完全控制在客户端生成的 ID 的功能。以下是网络上有关此功能的一些资源。

*   [http://blog.osbornm.com/archive/2009/01/06/asp.net-4.0-clientid-overview-again.aspx](http://blog.osbornm.com/archive/2009/01/06/asp.net-4.0-clientid-overview-again.aspx)
*   [http://channel9.msdn.com/shows/10-4/10-4-Episode-3-ASPNET-WebForms-40/](http://channel9.msdn.com/shows/10-4/10-4-Episode-3-ASPNET-WebForms-40/)

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-01-31T00:44:10.803

这里的大多数建议都可以，但是 jQuery 代码的测试结果表明纯 ID 选择器是迄今为止最快的。我最常用的一个：

```
$("[id$=origControlId]") 
```

速度很慢，但是除非页面有很多控件和很多 jQuery，否则问题不会太明显。

由于将多个类分配给一个控件相当容易，因此您可以为每个类分配一个与 ID 匹配的 CSSClass。由于它们将是唯一的（您必须观看生成多个控件的中继器类型控件），您可以按类进行选择。

例如：

```
<asp:Label ID="Label1" CssClass="Label1 SomeOtherClass" runat="server" Text="test">
</asp:Label> 
```

可以通过以下方式唯一选择：

```
$(".Label1") 
```

这*几乎*和 ID 选择一样快。

我从来没有考虑过这个：

```
$('#<%= Label1.ClientID %>') 
```

但我要试试看！

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-01-31T00:26:03.447

您必须将控件的 ClientID 传递给 javascript 代码（我怀疑 Label1 已重命名为 Label3）

```
ClientScriptManager.RegisterClientScriptBlock(GetType(), "someKey", 
    "$('#" + Label1.ClientID + "').html(xml);", true); 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-01-31T01:59:23.070

您可以使用`ClientID`（就像其他人所说的那样），但问题是它不能在外部 JavaScript 文件中使用。

因此，理想情况下，不要使用 ID 从 jQuery 中引用它，而是**使用 CSS 类**：

```
<asp:Label ID="Label1" runat="server" Text="test" CssClass="myclass"></asp:Label> 
```

然后你可以像这样引用它：

```
$(".myclass") 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-01-31T00:27:05.520

[您可以像这个家伙那样](http://www.west-wind.com/WebLog/posts/4605.aspx)覆盖 ClientID 和 UniqueID 。

```
/// <summary>
/// Override to force simple IDs all around
/// </summary>

public override string UniqueID
{
    get
    {
        return this.ID;
    }
}

/// <summary>
/// Override to force simple IDs all around
/// </summary>

public override string ClientID
{
    get
    {
        return this.ID;
    }
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-01-31T00:27:40.430

您还可以创建一个从 Label 继承的自定义控件，该控件将 ID 属性覆盖为您想要的。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2010-07-19T21:58:02.220

这可以通过在呈现控件时将 asp.net id 替换为原始 id 来实现。这很容易，可以通过创建一组自定义控件来完成。

[http://www.bytechaser.com/en/articles/ts8t6k5psp/how-to-display-aspnet-controls-with-clean-id-value.aspx](http://www.bytechaser.com/en/articles/ts8t6k5psp/how-to-display-aspnet-controls-with-clean-id-value.aspx)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-07-19T22:10:03.780

冒着明显变化的风险：

```
<asp:Label ID="Label1" runat="server" Text="test"></asp:Label> 
```

到

```
<Label ID="Label1" Text="test"></Label> 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2016-02-11T13:52:50.460

您需要将属性`ClientIDMode="Static"`放在您的按钮中，这使得 ID 在运行时将是相同的，这是您在 Javascript 中获取对象所需要的。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-01-31T01:04:06.833

您无需“阻止”asp.net 更改控件 ID 即可使用 jquery 或 javascript。

在您的页面上呈现的 id 是控件的 ClientID 属性，而您在控件本身上设置的是 ID。您无法设置 ClientID 属性，它是为您生成的，可能与您的 ID 相同也可能不同。但是，正如其他人所提到的，您可以在您的 aspx 中使用 ClientID 属性：

```
$('<%= Label1.ClientID %>').html() 
```

或通过使用 ClientScriptManager 方法之一在您的代码隐藏文件中注册客户端脚本。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-01-31T01:54:54.407

只需摆脱占位符。或者按类或 DOM 层次结构选择。或者甚至在不得已的情况下使用 ID 上的部分匹配。在 jQuery 中选择元素有许多简单、干净的方法，我们需要摆脱我们旧的、丑陋的 ASP.NET 习惯。

德里亚斯·格雷奇（Dreas Grech）将最后一颗钉子钉在棺材上。您不能将外部脚本文件与 $('#<%=label1.ClientID %>') 类型的解决方案一起使用。

麦克风

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-02-17T14:10:31.910

您仍然可以使用 PlaceHolders 并在 PlaceHolder 标记中设置**ClientIDMode ：**

```
<asp:ContentPlaceHolder ID="BodyContent" runat="server" ClientIDMode="Static">        
</asp:ContentPlaceHolder> 
```

所有包含的控件 ID 都不会更改。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-07-12T21:16:57.023

简单，重写控制类。这是一个带有 HtmlGenericControl 的示例，但您可以使用任何 ASP.Net 控件来执行此操作：

```
public class NoNamingContainerControl : HtmlGenericControl
{
    public NoNamingContainerControl(string tag) : base(tag) { }
    public override string ClientID
    {
        get
        {
            return this.ID;
        }
    }
} 
```

# ruby-on-rails - 如何在 Rails 中测试模型是否具有给定的方法？

> ID：497809
> 
> 赞同：3
> 
> 时间：2009-01-31T00:23:53.793
> 
> 标签：ruby-on-rails, ruby, unit-testing, testing, shoulda

我想实现该方法`User.calculate_hashed_password`。我正在尝试使用与 Rails 的内置测试工具一起使用的 Shoulda 测试库，因此与 Test::Unit 相关的答案与与 Shoulda 相关的答案一样好（我认为）。

我试图弄清楚**我**需要测试什么以及我应该**如何**测试它。我最初的想法是做类似...

```
class UserTest < ActiveSupport::TestCase
  should 'Return a hashed password'
    assert_not_nil User.calculate_hashed_password
  end
end 
```

这是正确的方法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-31T00:42:15.863

您无需测试该方法是否存在，只需测试该方法的行为是否正确。说这样的话：

```
class UserTest < ActiveSupport::TestCase
  setup do
    @user = User.new
  end

  should 'Calculate the hashed password correctly'
    @user.password = "password"
    @user.hashed_password = "xxxxx" # Manually calculate it
  end
end 
```

（我不使用 shoulda，所以请原谅任何明显的语法错误。）

如果该方法不存在，该测试将失败。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-31T14:55:44.783

我同意奥托的观点；但正如 dylanfm 所指出的，我使用 #respond_to 来测试 RSpec 中的关联。

```
it "should know about associated Projects" do
  @user.should respond_to(:projects)
end 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-31T00:33:31.760

也许使用`respond_to?`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T21:01:37.600

您应该检查[Object#respond_to？](http://www.ruby-doc.org/core/classes/Object.html#M000333)和新版本的 Rails 中的[Object#try 。](http://ryandaigle.com/articles/2008/11/20/what-s-new-in-edge-rails-object-try)如果您是一般测试的新手，请务必通读这份[出色的 Rails 测试指南](http://guides.rubyonrails.org/testing_rails_applications.html#_unit_testing_your_models)。

# java - 如何让 Tomcat 在启动时预编译 JSP？

> ID：497830
> 
> 赞同：15
> 
> 时间：2009-01-31T00:30:42.390
> 
> 标签：java, jsp, tomcat, jakarta-ee

我们在我工作的地方同时使用 Apache Tomcat 6.0 和 Jetty 6。我们主要使用 Jetty 进行测试（它非常适合运行嵌入式 JUnit 测试）和 Tomcat 进行生产。

默认情况下，Tomcat 在用户请求时即时编译 JSP。但这会导致第一次命中的性能下降。它还突出了 Tomcat 的 JSP 编译器中的[奇怪错误](https://issues.apache.org/bugzilla/show_bug.cgi?id=43878)。

[Tomcat 文档](http://tomcat.apache.org/tomcat-6.0-doc/jasper-howto.html)提供了在构建时使用 Ant 预编译 JSP的建议（并且 Maven 插件也可用）...但是生成的 WAR 包含特定于 Tomcat 的内容，例如 PageContextImpl.proprietaryEvaluate，因此我们不能在 Jetty 中使用它.

是否有一些标志或设置我们可以在某个地方使用来强制 Tomcat 在 WAR 初始化后立即预编译所有 JSP？我们准备在启动时等待更长的时间。

提前：我知道有一种方法可以通过在 web.xml 中为一个 JSP 显式识别 /servlet/load-on-startup 标记来预编译*一个*JSP。但是对于数十甚至数百个 JSP 来说，这变得难以管理。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-01T04:05:45.030

[http://www.devshed.com/c/a/BrainDump/Tomcat-Capacity-Planning/](http://www.devshed.com/c/a/BrainDump/Tomcat-Capacity-Planning/)

* * *

```
 project name="pre-compile-jsps" default="compile-jsp-servlets">

  <!-- Private properties. -- >
  <property name="webapp.dir" value="${basedir}/webapp-dir"/>
  <property name="tomcat.home" value="/opt/tomcat"/>
  <property name="jspc.pkg.prefix" value="com.mycompany"/>
  <property name="jspc.dir.prefix" value="com/mycompany"/> 

  <!-- Compilation properties. -->
  <property name="debug" value="on"/> 
  <property name="debuglevel" value="lines,vars,source"/>
  <property name="deprecation" value="on"/>
  <property name="encoding" value="ISO-8859-1"/>
  <property name="optimize" value="off"/>
  <property name="build.compiler" value="modern"/>
  <property name="source.version" value="1.5"/> 

  <!-- Initialize Paths. -->
  <path id="jspc.classpath">
    <fileset dir="${tomcat.home}/bin">
      <include name="*.jar"/>
    </fileset>
    <fileset dir="${tomcat.home}/server/lib">
      <include name="*.jar"/>
    </fileset>
    <fileset dir="${tomcat.home}/common/i18n">
      <include name="*.jar"/>
    </fileset>
    <fileset dir="${tomcat.home}/common/lib">
      <include name="*.jar"/>
    </fileset>
    <fileset dir="${webapp.dir}/WEB-INF">
      <include name="lib/*.jar"/>
    </fileset>
    <pathelement location="${webapp.dir}/WEB-INF/classes"/>
    <pathelement location="${ant.home}/lib/ant.jar"/>
    <pathelement location="${java.home}/../lib/tools.jar"/>
  </path>
  <property name="jspc.classpath" refid="jspc.classpath"/> 

  <!--========================================================== -->
  <!-- Generates Java source and a web.xml file from JSP files.                     -->
  <!-- ==========================================================
-->
  <target name="generate-jsp-java-src"> 
    <mkdir dir="${webapp.dir}/WEB-INF/jspc-src/${jspc.dir.prefix}"/>
    <taskdef classname="org.apache.jasper.JspC" name="jasper2">
      <classpath>
        <path refid="jspc.classpath"/>
      </classpath>
    </taskdef>
    <touch file="${webapp.dir}/WEB-INF/jspc-web.xml"/>
    <jasper2 uriroot="${webapp.dir}"
             package="${jspc.pkg.prefix}" 
          webXmlFragment="${webapp.dir}/WEB-INF/jspc-web.xml" 
             outputDir="${webapp.dir}/WEB-INF/jspc-src/${jspc.dir.prefix}"
             verbose="1"/>
  </target> 

  <!-- ========================================================== -->
  <!-- Compiles (generates Java class files from) the JSP servlet -->
  <!-- source code that was generated by the JspC task.            -->
  <!-- ========================================================== -->
  <target name="compile-jsp-servlets" depends="generate-jsp-java-src">
    <mkdir dir="${webapp.dir}/WEB-INF/classes"/>
    <javac srcdir="${webapp.dir}/WEB-INF/jspc-src"
           destdir="${webapp.dir}/WEB-INF/classes"
           includes="**/*.java"
           debug="${debug}"
           debuglevel="${debuglevel}"
           deprecation="${deprecation}"
           encoding="${encoding}"
           optimize="${optimize}"
           source="${source.version}">
      <classpath>
        <path refid="jspc.classpath"/>
      </classpath>
    </javac>
  </target> 

  <!-- ========================================================= -->
  <!-- Cleans any pre-compiled JSP source, classes, jspc-web.xml -->
  <!-- ========================================================= -->
  <target name="clean">
    <delete dir="${webapp.dir}/WEB-INF/jspc-src"/>
    <delete dir="${webapp.dir}/WEB-INF/classes/${jspc.dir.prefix}"/>
    <delete file="${webapp.dir}/WEB-INF/jspc-web.xml"/>
  </target>

</project 
```

此构建文件将找到您的所有 webapp 的 JSP 文件，将它们编译成 servlet 类，并为这些 JSP servlet 类生成 servlet 映射。它生成的 servlet 映射 ping 必须进入您的 webapp 的 WEB-INF/web.xml 文件，但是很难编写一个知道如何以可重复的方式将 servlet 映射插入到 web.xml 文件中的 Ant 构建文件。构建文件运行的时间。相反，我们使用了 XML 实体包含，以便每次构建文件运行时生成的 servlet 映射进入一个新文件，并且该 servlet 映射文件可以通过 XML 实体包含机制插入到您的 web.xml 文件中。要使用它，你的 webapp 的 WEB-INF/web.xml 必须在文件顶部有一个特殊的实体声明，加上对 web 内容中实体的引用。您希望在其中包含 servlet 映射文件的 xml 文件。以下是经过这些修改后空 servlet 2.5 webapp 的 web.xml 文件的外观：

```
<!DOCTYPE jspc-webxml [
    <!ENTITY jspc-webxml SYSTEM "jspc-web.xml">
  ]> 

  <web-app xmlns=http://java.sun.com/xml/ns/javaee
      xmlns:xsi=http://www.w3.org/2001/ XMLSchema-instance 
      xsi:schemaLocation="http:// java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/ 
  javaee/web-app_2_5.xsd"
      version="2.5"> 

    <!-- We include the JspC-generated mappings here. -->
    &jspc-webxml; 

    <!-- Non-generated web.xml content goes here. --> 

  </web-app> 
```

确保您的 webapp 的 web.xml 文件在文件顶部一直有内联 DTD（DOCTYPE 标记），并且在其下方有 servlet 2.5 web-app 模式声明。然后，无论您想在 web.xml 文件中插入生成的 servlet 映射的什么位置，都将实体引用 &jspc-webxml; . 请记住，实体引用以与号 ( & ) 开头，然后是实体的名称，并以分号 ( ; ) 结尾。

要使用构建文件，只需编辑它并将顶部的所有属性设置为与您的设置匹配的值，然后像这样运行它：

$ ant -f 预编译-jsps.xml

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-16T00:09:30.493

如果您使用 duffymo 提到的指向 Vinny Carpenter 博客的解决方案，我有一个提示。有一个区域导致我的容器在联系 localhost 时无限期挂起（特别是在私有 connect() 方法中）。使用以下 hack 是我的解决方法：

```
 private void connect(final String urlString) {

        HttpURLConnection conn;
        try {
            final URL url = new URL(urlString);
            conn = (HttpURLConnection)url.openConnection();
            conn.setConnectTimeout(5000);
            //time it out quickly - otherwise hangs forever
            //seems to be an issue hitting localhost
            //will still precompile the page
            conn.setReadTimeout(100);
            conn.setAllowUserInteraction(true);
            conn.getInputStream();
            conn.disconnect();
        }
        catch (SocketTimeoutException e) {
            log.debug(e);
        }
        catch (IOException ioe) {
            log.error(ioe);
        }
    } 
```

设置超时并忽略 SocketTimeoutException 有效（尽管公认不是最佳解决方案）。此外，使用此过程意味着您需要在 web.xml 中指定 JSP。这足以满足我的需求。

# asp.net - 如何将多个“CssClass”分配给asp.net中的控件

> ID：497837
> 
> 赞同：16
> 
> 时间：2009-01-31T00:32:19.300
> 
> 标签：asp.net, css

我可以为asp.net中的控件分配多个“CssClass”吗？如何做到这一点？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-31T00:34:55.020

要分配类“myClass1”和“myClass2”，您只需说：

```
<asp:Label runat="server" CssClass="myClass1 myClass2" /> 
```

这与您在普通 HTML 中使用的方法相同，如下所示：

```
<div class="myClass1 myClass2"></div> 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-31T00:39:36.197

如果您想以编程方式添加另一个类并且不知道已经添加了哪些类

```
MyControl.CssClass += " newclass"; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-31T00:36:04.253

您可以尝试以下等效项：

类=“类1类2”

因此，如果它是一个属性，只需尝试将类扔在那里，它们之间有一个空格。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T00:36:41.723

我想这就像在 XHTML 元素中设置类属性一样。

```
<p class="foo bar"></p>

<asp:Something CssClass="foo bar" runat="server" /> 
```

# eclipse - 如何仅对已修改的文件执行 ANT 任务

> ID：497850
> 
> 赞同：15
> 
> 时间：2009-01-31T00:36:21.630
> 
> 标签：eclipse, ant

我有一个构建脚本可以做很多事情（最小化 javascript，上传到 amazon s3 等）。最小化 ANT 任务仅在我修改过的 javascript 上运行，而忽略其余部分（我没有编写此脚本）。我想为 amazon s3 任务做类似的事情，其中​​只在任务中上传更新的内容。任何有关如何做到这一点的线索将不胜感激。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-17T20:01:07.327

您可以选择带有修改日期标签的文件集。修改后的标签非常强大，因此请查看：[Ant Selectors - Modified](http://ant.apache.org/manual/Types/selectors.html#modified)。

为了告诉它发生了什么变化，它可以在属性文件中保留一个缓存，在每次成功构建后更新，除非你使用 delayupdate 属性 - 所以也许要测试它，你可以拥有：

```
<param name="commitUpdate" value="false" />
[...]
<ftp ...>
    <fileset dir="src">
        <modified delayupdate="${commitUpdate}" />
    </fileset>
</ftp> 
```

当然，您可以通过命令行参数或其他方式设置 commitUpdate。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-25T18:26:17.840

您可能需要考虑 Ant-contrib 库提供的[OutOfDate](http://ant-contrib.sourceforge.net/tasks/tasks/outofdate.html) Ant 任务。它允许您为文件集中的每个源文件设置一个顺序/并行任务来执行。您可以应用文件映射器来定义目标文件以测试源文件，以便只有已修改的文件运行特定的顺序/并行任务。

看看这个 SO 线程：

[只有在源文件被修改的情况下，如何执行 Ant 任务？](https://stackoverflow.com/questions/503865/how-to-execute-an-ant-task-only-when-source-files-have-been-modified)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T00:43:23.363

通常，您可以使用[File Mappers](http://ant.apache.org/manual/Types/mapper.html)对具有源文件和目标文件的任务执行此操作，以便该任务仅应用于已更改的源文件。我不知道是否有办法做一些 Ant 看不到目标文件的事情，比如上传。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T20:21:25.843

如果您不想更改/重写 S3 任务并希望纯粹使用 XML，您可以使用[Uptodate 任务](http://ant.apache.org/manual/Tasks/uptodate.html)和影子目录来模仿这种行为 - 例如保留您上传的副本（可能很大）或只是一个带有您上次上传的创建日期的空文件。手册页上的示例应该提供很多提示。

当然，您也可以编写自己的 S2Uptodate 任务，连接到 S3 以比较日期。首选的解决方案取决于有多少文件（例如，您可以在不同的操作中检查几个大文件，或者您可以以不同方式处理的几乎无限数量的小文件。

您也可能会受到[Xjc 任务](https://jaxb.dev.java.net/nonav/2.0.2/docs/xjcTask.html)对和元素的使用的启发，尽管这当然纯粹是在本地文件上运行的。

# python - Python逐元素元组操作，如sum

> ID：497885
> 
> 赞同：130
> 
> 时间：2009-01-31T00:51:48.637
> 
> 标签：python, tuples

无论如何让Python中的元组操作像这样工作：

```
>>> a = (1,2,3)
>>> b = (3,2,1)
>>> a + b
(4,4,4) 
```

代替：

```
>>> a = (1,2,3)
>>> b = (3,2,1)
>>> a + b
(1,2,3,3,2,1) 
```

我知道它是这样工作的，因为`__add__`and`__mul__`方法被定义为这样工作。那么唯一的方法是重新定义它们吗？

* * *

## 回答 #1

> 赞同：159
> 
> 时间：2009-01-31T00:55:01.313

```
import operator
tuple(map(operator.add, a, b)) 
```

* * *

## 回答 #2

> 赞同：149
> 
> 时间：2009-01-31T02:49:16.993

使用所有内置插件..

```
tuple(map(sum, zip(a, b))) 
```

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2012-10-03T06:20:20.357

此解决方案不需要导入：

```
tuple(map(lambda x, y: x + y, tuple1, tuple2)) 
```

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-01-31T22:25:06.467

```
from numpy import array

a = array( [1,2,3] )
b = array( [3,2,1] )

print a + b 
```

给`array([4,4,4])`.

见[http://www.scipy.org/Tentative_NumPy_Tutorial](http://www.scipy.org/Tentative_NumPy_Tutorial)

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2009-01-31T01:10:18.303

将前两个答案组合在一起，对 Ironfroggy 的代码进行了调整，使其返回一个元组：

```
import operator

class stuple(tuple):
    def __add__(self, other):
        return self.__class__(map(operator.add, self, other))
        # obviously leaving out checking lengths

>>> a = stuple([1,2,3])
>>> b = stuple([3,2,1])
>>> a + b
(4, 4, 4) 
```

注意：使用`self.__class__`而不是`stuple`简化子类化。

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2016-01-14T20:22:45.280

可以使用生成器理解而不是地图。内置的 map 函数并没有过时，但对大多数人来说，它的可读性不如 list/generator/dict 理解，所以我建议一般不要使用 map 函数。

```
tuple(p+q for p, q in zip(a, b)) 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2010-06-24T16:10:24.917

没有返回元组的类定义的简单解决方案

```
import operator
tuple(map(operator.add,a,b)) 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2012-09-26T21:25:32.603

所有发电机解决方案。不确定性能（虽然 itertools 很快）

```
import itertools
tuple(x+y for x, y in itertools.izip(a,b)) 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2016-06-12T23:17:31.947

更简单，不使用地图，你可以做到这一点

```
>>> tuple(sum(i) for i in zip((1, 2, 3), (3, 2, 1)))
(4, 4, 4) 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-01-31T00:55:54.213

是的。但是你不能重新定义内置类型。您必须对它们进行子类化：

```
MyTuple 类（元组）：
    def __add__(self, other):
         如果 len(self) != len(other):
             raise ValueError("元组长度不匹配")
         return MyTuple(x + y for (x, y) in zip(self, other))

```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-06-25T18:06:48.720

我目前将“元组”类子类化以重载 +、- 和 *。我发现它使代码更漂亮并且更容易编写代码。

```
class tupleN(tuple):
    def __add__(self, other):
        if len(self) != len(other):
             return NotImplemented
        else:
             return tupleN(x+y for x,y in zip(self,other))
    def __sub__(self, other):
        if len(self) != len(other):
             return NotImplemented
        else:
             return tupleN(x-y for x,y in zip(self,other))
    def __mul__(self, other):
        if len(self) != len(other):
             return NotImplemented
        else:
             return tupleN(x*y for x,y in zip(self,other))

t1 = tupleN((1,3,3))
t2 = tupleN((1,3,4))
print(t1 + t2, t1 - t2, t1 * t2, t1 + t1 - t1 - t1)
(2, 6, 7) (0, 0, -1) (1, 9, 12) (0, 0, 0) 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-12-17T16:23:46.943

如果您已经在使用`numpy`. 它很紧凑，加法运算可以用**任何**numpy 表达式代替。

```
import numpy as np
tuple(np.array(a) + b) 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-12-28T22:32:05.827

我一直回到这个问题，我并不特别喜欢任何答案，因为他们都在回答一般情况的问题，我通常在寻找特殊情况的答案：我通常使用一个固定的元组计数，例如对于 n 维。

```
 # eg adding a dx/dy to an xy point.
   # if I have a point xy and another point dxdy
   x, y = xy
   dx, dy = dxdy
   return x+dx, y+dy 
```

虽然我通常对不必要的变量感到不寒而栗，但我解包元组的原因通常是因为我正在作为个人处理元素，这就是上面要求的元组添加所发生的事情。

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2018-01-20T04:32:32.870

如果有人需要平均一个元组列表：

```
import operator 
from functools import reduce
tuple(reduce(lambda x, y: tuple(map(operator.add, x, y)),list_of_tuples)) 
```

# asp.net - 基本编译问题 - 缺少 using 指令或程序集引用

> ID：497886
> 
> 赞同：1
> 
> 时间：2009-01-31T00:51:58.247
> 
> 标签：asp.net, ajax

我从网上得到了以下代码，并试图编译和运行它。它是一个 ajax 应用程序。我无法让它编译/构建这个应用程序，因为它给出了以下错误：

> 您是否缺少 using 指令或程序集引用

有人可以建议我应该检查什么/在哪里检查吗？

这是来自 AjaxController.cs 的代码；并且控制器词带有下划线：

```
namespace System.Web.Mvc {

    public class AjaxController : Controller {

        private bool _isAjaxRequest;

        protected internal virtual bool IsAjaxRequest {
            get {
                return _isAjaxRequest;
            }
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T01:03:44.430

检查项目是否引用了 System.Web.Extensions 程序集。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-31T01:25:32.687

是的，实际上确实如此。以前有一个错误，System.Web.Extensions 在引用下有感叹号。我通过删除那个并使用添加引用再次添加对 System.Web.Extensions 的引用来解决这个问题。

控制器字由编译器加下划线，这就是不被识别为类的内容:(

感谢您的意见，请告知我还能做什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T01:39:40.410

我是一名 C# 程序员，但没有使用过 .NET，但我认为您在 System.Web.Mvc 命名空间中声明一个类很奇怪。我做了一些研究，看起来您正在尝试编译一些可能没有帮助的代码。AjaxController 看起来像是微软提供的一个类，所以你不需要自己编写代码，你只需要使用它即可。你是怎么做到的，我不知道，但我认为你现在走错了路。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T02:02:17.370

System.Web.Mvc.Controller 类是新的 ASP.NET MVC 的一部分。您可以从[http://www.asp.net/mvc了解更多信息，并从](http://www.asp.net/mvc)[这里](http://www.microsoft.com/downloads/details.aspx?FamilyID=f4e4ee26-4bc5-41ed-80c9-261336b2a5b6&displaylang=en)下载 ASP.NET MVC Release Candidate 1 。

# java - 在没有 Java 知识的情况下学习 Clojure

> ID：497890
> 
> 赞同：17
> 
> 时间：2009-01-31T00:53:44.780
> 
> 标签：java, lisp, clojure

好的，所以我对另一个列表感到兴奋。我给自己买了一本测试版 Clojure 编程书……

我最注意到的一件事是假设我知道......就像所有主要的java类一样。

除了，一般来说，我并不真正关心 Java。我只是希望有足够的知识让 Clojure 成为我的选择。

关于如何学习我所需要的一切的任何建议？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-12T06:20:07.330

嗯，实际上，虽然 Clojure 是为 Java 开发人员开发的，但它并不是*为*Java 程序员编写的。

> Clojure 旨在在 Java 环境中进行良好的互操作。

虽然确实如此，但这并不是*它*的设计目的（至少不是“Java 环境”的语言部分）。而“Java 环境”意味着语言和 JVM 以某种方式相互关联，从而使它们成为一体。他们不是。Conjure 是一种原生 JVM 语言（与 Jython 或 JRuby 不同），它使用一个构建良好的虚拟机来运行。

> 就像 Greg 说的那样，Clojure 是为 Java 而构建的，除非你想真正进入 Clojure 的软件事务内存系统，否则我会建议检查一个不同的 Lisp。

不，谢谢。Clojure 不是“与 Java 一起构建”。它是为 JVM 构建的。如果愿意，您可以使用 Java 库，但这不是必需的（尽管它很有用）。如果您不想学习 Java，建议使用不同的 Lisp。这是荒谬的。Clojure 并不意味着是 Java。它应该是一个一流的 Lisp。顺便说一句，这意味着以某种方式增强 Lisp，使其更加现代和实用。它与 Java 一起工作的能力应该被视为一种奖励，而不是一种负担。

> 正如上面的 Greg 所指出的，像 Clojure 和 Groovy 这样的语言以 JVM 为目标的主要原因之一是，Java 开发人员可以两全其美。

也错了。由于上述原因。它们不是为 Java 开发人员编写的。很抱歉在这里直言不讳，但我在这些回复中没有看到一篇关于 Clojure 的受过教育的帖子，而且我今天才了解 Clojure！看到这种有害的建议如此轻易地给出，真是令人沮丧。

我将以 Rick Hickey（编写 Clojure 的人）的一句话作为结尾：

“你可以讨厌 Java 而喜欢 JVM。”

他接着说，这就是他的立场。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-01-31T15:50:19.260

我对您的主要建议是，您已经通过购买 Programming Clojure 完成了。多年来，我一直在回避和厌恶 Java，并且（编程）Clojure 对其进行了充分的修复，以至于该语言现在让我兴奋不已。谁会想到一个以繁重着称的系统会让您进行交互`(map #(.getName %) (.getMethods (class "")))`？浏览“使用 Java，3.5 将 Ant 项目和任务添加到 Lancet”，以我熟悉的*Ruby*风格进行探索。

如果你在[Freenode](http://freenode.net/) #clojure ，也加入 ##java。获取 Java 的[API 文档](http://java.sun.com/javase/reference/api.jsp)并随身携带。在 Web 上搜索您想做的事情的[Java 答案](http://www.spiration.co.uk/post/1199/Java%20md5%20example%20with%20MessageDigest)，并将其或多或少地直接翻译[成 Clojure](http://paste.lisp.org/display/74629)。

编辑：在 clj：

```
user=> (use 'clojure.contrib.javadoc)
nil
user=> (keys (ns-publics 'clojure.contrib.javadoc))
(*remote-javadocs* javadoc find-javadoc-url add-remote-javadoc
*core-java-api* add-local-javadoc *local-javadocs*)
user=> (javadoc "this is a java.lang.String")
true  (browses to http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html)
user=> (javadoc java.net.ServerSocket)
true  (...)
user=> 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-31T11:51:03.237

没有冒犯格雷格，但我不同意。学习 Clojure 也是了解 Java 世界的绝佳机会。我一生中从未有过一天用 Java 编程，我正在学习 Clojure 并热爱它的每一分钟。当然，我不知道所有的课程，但我看不出这本书假设你都知道的地方。无论哪种方式，Java 都不是学习 Clojure 的必要条件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-31T01:06:19.323

您应该能够通过 Google 和 StackOverflow 找到您需要的东西，但希望在您对 Java 的标准库有一个很好的感觉之前访问这两个网站。

就像 Greg 说的那样，Clojure 是为 Java 而构建的，除非你想真正进入 Clojure 的软件事务内存系统，否则我会建议检查一个不同的 Lisp。Java 当然不是必需的，但不必在 Clojure 的标准库之上学习标准库是一个巨大的进步。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-11T04:11:34.097

正如上面的 Greg 所指出的，*像*Clojure 和 Groovy 这样的语言以 JVM 为目标的主要原因之一是，Java 开发人员可以*两全其美*。所以，如果你想学习 Lisp，Scheme 或 Common Lisp 将是一个很好的开始！

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-31T01:01:14.607

如果您对 Clojure 的所有 Java 方面都不感兴趣，也许您最好学习 Lisp 的另一种方言，例如 Common Lisp 或 Scheme。Clojure 旨在在 Java 环境中进行良好的互操作。

# java - 结果集-> XLS

> ID：497893
> 
> 赞同：0
> 
> 时间：2009-01-31T00:54:47.367
> 
> 标签：java, sql, excel, jdbc, spreadsheet

我必须运行几个 SQL 查询并将结果放入电子表格。由于我在 Spring/Java 环境中，我将使用 JDBC 运行查询，遍历 ResultSet，并使用 Jakarta POI 创建一个简单的 XLS。

这看起来是一个非常常见的要求，所以我想知道是否已经有一些可用的东西 - 一个给出一些 SQL 查询和一个数据源的包，可以执行查询并将它们的结果集“导出”到电子表格中。有人知道这样的包吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-31T13:04:27.487

比起 POI，我更喜欢 Andy Khan 的[JExcel](http://jexcelapi.sourceforge.net/)。也许你也会。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T01:07:23.987

您可以完全跳过 Java。Microsoft SQL Server Management Studio 可以连接到您的 Excel 工作簿并将数据直接转储到其中。

*   "[将数据从 SQL Server 2005 导出到 Microsoft Excel 数据表](http://blog.sqlauthority.com/2008/01/08/sql-server-2005-export-data-from-sql-server-2005-to-microsoft-excel-datasheet/)"

如果您使用 MS SQL Server 2005 以外的其他工具，您仍然可以在 Excel 中创建对任何 ODBC 数据源的查询，并编写 SQL 查询以将数据提取到工作表中。然后您可以随时重新运行查询以刷新数据。我建议你需要对这些数据做任何其他事情，你可以在单独的工作表上做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-31T01:35:30.967

SSMS 具有可以使用的内置功能。您也可以使用 SSIS。我也很喜欢[SQLAnswers Query](http://www.sqlanswers.com/Software/SAQ/Default.aspx)的易用性，它非常简洁。您还可以使用命令行 BCP 输出到 CSV。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-31T12:00:47.880

不是对您的问题的直接回答，但对于此类任务，我宁愿看一下[dbunit](http://www.dbunit.org/)，它虽然通常用于测试 DAO，但具有执行此操作所需的所有功能。它还可以执行相反的任务（即从 XLS 文件中读取数据并将其输入数据库）。

我认为在不到一小时的时间内，你可以让它做你需要的。对于这种特殊用途，您当然可以删除对 JUnit 的 dbunit 依赖（您将用于此的 dbunit 类都不依赖于 JUnit）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-31T12:48:33.337

你可以看看[Jasper Reports](http://www.jaspersoft.com/JasperSoft_JasperReports.html)。它当然可以导出到 XLS（或 CSV，或 PDF ......），我相信向它提供 SQL 结果集应该相对简单。

# html - URL 是否允许包含空格？

> ID：497908
> 
> 赞同：143
> 
> 时间：2009-01-31T01:02:48.397
> 
> 标签：html, http, url, encoding

是否允许 URI（特别是 HTTP URL）包含一个或多个空格字符？*如果必须*对 URL进行编码，这`+`只是一种普遍遵循的约定，还是一种合法的替代方案？

特别是，有人可以指向一个 RFC，该 RFC 表明*必须*对带有空格的 URL进行编码？

**提问的动机：**在对一个网站进行 beta 测试时，我注意到一些 URL 是用空格构成的。Firefox 似乎做了正确的事，这让我很惊讶！但我希望能够将开发人员指向 RFC，以便他们觉得有必要修复这些 URL。

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2009-01-31T01:32:24.920

根据[RFC 1738](http://www.ietf.org/rfc/rfc1738.txt)：

> 不安全：
> 
> 由于多种原因，字符可能不安全。 **空格字符是不安全的，因为当 URL 被转录或排版或经受文字处理程序的处理时，重要的空格可能会消失，并且可能会引入无关紧要的空格。** 字符`"<"`和`">"`是不安全的，因为它们被用作自由文本中 URL 的分隔符；在某些系统中，引号 ( `"""`) 用于分隔 URL。该字符`"#"`是不安全的，应始终进行编码，因为它在万维网和其他系统中用于将 URL 与可能跟随它的片段/锚标识符分隔。性格`"%"`是不安全的，因为它用于其他字符的编码。其他字符是不安全的，因为已知网关和其他传输代理有时会修改这些字符。这些字符是`"{"`, `"}"`, `"|"`, `"\"`, `"^"`, `"~"`, `"["`, `"]"`, 和`"`"`。
> 
> **所有不安全的字符必须始终在 URL 中进行编码**。例如，`"#"`即使在通常不处理片段或锚标识符的系统中，字符也必须在 URL 中进行编码，因此如果将 URL 复制到确实使用它们的另一个系统中，则无需更改 URL 编码。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2009-01-31T01:44:31.913

为什么一定要编码？请求如下所示：

```
GET /url HTTP/1.1
(Ignoring headers) 
```

有 3 个字段由空格分隔。如果您在 url 中放置一个空格：

```
GET /url end_url HTTP/1.1 
```

你知道有 4 个字段，HTTP 服务器会告诉你这是一个无效请求。

```
GET /url%20end_url HTTP/1.1 
```

3 个字段 => 有效

注意：在查询字符串中（在 ? 之后），空格通常编码为 +

```
GET /url?var=foo+bar HTTP/1.1 
```

而不是

```
GET /url?var=foo%20bar HTTP/1.1 
```

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2009-01-31T01:41:50.343

简短的回答：不，您必须编码一个空格；将空格编码为*是*正确的`+`，但仅限于查询字符串中；在您必须使用的路径中`%20`。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-01-31T01:25:33.123

URL 在[RFC 3986](http://www.ietf.org/rfc/rfc3986.txt)中定义，尽管其他 RFC 也是相关的，但[RFC 1738](http://www.ietf.org/rfc/rfc1738.txt)已过时。

它们中可能没有空格以及许多其他字符。由于这些禁止字符通常需要以某种方式表示，因此有一种方案可以将它们编码为 URL，方法是将它们转换为带有“%”前缀的 ASCII 十六进制等价物。

大多数编程语言/平台都提供了对 URL 进行编码和解码的功能，尽管它们可能无法正确遵守 RFC 标准。例如，我知道 PHP 没有。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-01-31T01:04:45.177

是的，空间通常被编码为“%20”。出于安全原因，任何传递给 URL 的参数都应该被编码。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2012-06-24T08:51:08.003

URL 中可以有一个空格字符，它们在大多数浏览器中会显示为 %20，但是浏览器编码规则经常变化，我们不能依赖浏览器如何显示 URL。

因此，您可以将 URL 中的空格字符替换为您认为会使 URL 更具可读性和“漂亮”的任何字符；) ..... O 所以首选的一般字符是“-”、“_”、 “+” .... 但这些不是强制性的，因此您可以使用任何不应该在 URL 中的字符。

请避免使用 %,&,},{,],[,/,>,< 作为 URL 空格字符替换，因为它们可能会在某些浏览器和平台上引发错误。

如您所见，Stak 溢出本身使用“-”字符作为空格（%20）替换。

有一个快乐的提问。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-01-31T01:07:46.747

网址中不应*包含*空格。如果您需要解决一个问题，请使用其编码值`%20`

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-01-31T19:11:28.883

> 有人可以指向一个 RFC，表明必须对带有空格的 URL 进行编码吗？

URI 和 URL 在 RFC 3986 中定义。

如果您查看那里定义的语法，您最终会注意到空格字符永远不能成为语法合法 URL 的一部分，因此术语“带空格的 URL”本身就是矛盾的。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-01-31T01:10:06.930

回答你的问题。我会说应用程序替换将在 URL 中使用的值中的空格是相当普遍的。这样做的原因通常是为了避免出现更难读取的百分比 (URI) 编码。

查看这篇关于[Percent-encoding 的](http://en.wikipedia.org/wiki/Percent-encoding)维基百科文章。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-31T01:08:33.360

Firefox 3 会将`%20`URL 中的 s 显示为地址栏中的空格。

# unit-testing - 使用 IOC 容器时需要注意哪些事项（陷阱）？

> ID：497937
> 
> 赞同：3
> 
> 时间：2009-01-31T01:14:31.523
> 
> 标签：unit-testing, design-patterns, dependency-injection, inversion-of-control, loose-coupling

使用 IOC 容器时需要注意哪些事项（陷阱）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-31T21:38:11.380

Trying not to fall too much for a Service Locator pattern, where some static wrapper to your IoC container provides you with instances of type xyz. While you may need it at times, ensuring that you do inject your dependencies to your consuming type will keep your code a lot cleaner and make the container much less intrusive.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-31T01:50:11.810

如果你使用spring aop，就会有很多神奇的事情发生，如果某些事情不能正常工作，那么真的很难找出问题所在。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-31T21:33:45.633

Complexity of configuration.

Keep an eye out up-front that the complexity you're getting with the various XML files and setup is worth the problem you're addressing. One example - in Apache HiveMind, the configuration of binding class instances to each other, and passing configuration information in can easily become more difficult to maintain, read, and understand then the equivalent Java would have required.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T21:41:58.207

Troubleshooting can be harder in my experience. Not only are you working against interfaces, which means it can be difficult to identify the actual type of the instances used by looking at the code. You also move a lot of the wiring from compile time to runtime (which is one of the point of IoC of course, but it doesn't do wonders for finding problems).

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-31T11:02:29.590

在正确的时间处理正确的事情，否则会造成内存泄漏。

# arrays - 转换 IEnumerable 的最佳方法 到一个 T[]

> ID：497943
> 
> 赞同：8
> 
> 时间：2009-01-31T01:18:38.457
> 
> 标签：arrays, collections, .net-2.0, c#-2.0, ienumerable

从通用`IEnumerable<T>`实现转换为 T 数组的最佳方法是什么？我目前的解决方案如下所示：

```
IEnumerable<string> foo = getFoo();
string[] bar = new List<string>(foo).ToArray(); 
```

通过 a 转移`List<T>`似乎是不必要的，但我一直无法找到更好的方法来做到这一点。

注意：我在这里使用 C# 2.0。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-31T01:27:07.783

## .NET 3.0 及更高版本：

调用on[`ToArray`扩展方法](https://msdn.microsoft.com/en-us/library/bb298736(v=vs.110).aspx)`IEnumerable<T>`，它的作用与下面几乎相同，执行类型嗅探和其他一些优化。

## .NET 2.0 及之前版本：

一般来说，使用 a [`List<T>`](http://msdn.microsoft.com/en-us/library/6sh2ey19.aspx)which 将被初始化，[`IEnumerable<T>`](http://msdn.microsoft.com/en-us/library/9eekhta0.aspx)然后调用[`ToArray`](http://msdn.microsoft.com/en-us/library/x303t819.aspx)可能是最简单的方法。

for的[构造函数`List<T>`](http://msdn.microsoft.com/en-us/library/fkbw11z0.aspx)将检查`IEnumerable<T>`它是否实现[`ICollection<T>`](http://msdn.microsoft.com/en-us/library/92t2ye13.aspx)了获取项目计数以正确初始化列表的容量。如果没有，它将正常扩展。

当然，您最终可能`List<T>`只是为了转换`IEnumerable<T>`为`T[]`. 为此，您可以编写自己的方法，但实际上您只是在复制`List<T>`已经存在的代码。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-02T12:24:08.503

做一点 .NET Reflector 看起来 Linq ToArray 扩展方法基本上与通过 List<> 传递 IEnumerable 做同样的事情。Buffer 类是内部的，但其行为似乎与 List<> 非常相似。

```
public static TSource[] ToArray<TSource>(this IEnumerable<TSource> source)
{
    if (source == null)
    {
        throw Error.ArgumentNull("source");
    }
    Buffer<TSource> buffer = new Buffer<TSource>(source);
    return buffer.ToArray();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-11-04T12:03:07.283

```
// src is IEnumerable<T>
// target is T[]
target = src == null ? new T[] {} : src.ToArray(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-31T01:25:46.553

如果无法确定数组的长度，那么这是最好的方法。

IEnumerable 中没有任何内容可以让您确定长度，但也许您的代码有办法找出另一种方法。如果是这样，请使用它来构造一个数组。

# windows - 从命令行使用 schtasks，什么参数可以将计算机从睡眠中唤醒并执行任务

> ID：497945
> 
> 赞同：13
> 
> 时间：2009-01-31T01:19:09.813
> 
> 标签：windows, command-line, scheduled-tasks

该选项存在于 UI 中，但不存在于命令行中显示的帮助中。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-03T08:37:14.263

您是通过`schtasks.exe`命令行创建新任务，还是更新现有任务？

在 Vista 上，`schtasks.exe`可以`/xml`同时选择`/create`和`/query`. 使用此任务的 XML 编码，您可以看到`WakeToRun`可以设置节点以将计算机从睡眠状态唤醒以运行任务：

```
<?xml version="1.0" encoding="UTF-16"?>
<Task version="1.2" xmlns="http://schemas.microsoft.com/windows/2004/02/mit/task">
  <RegistrationInfo>
    ...
  </RegistrationInfo>
  <Triggers />
  <Principals>
    ...
  </Principals>
  <Settings>
    ...
    <WakeToRun>true</WakeToRun>
    ...
  </Settings>
  <Actions Context="Author">
    <Exec>
      <Command>myprogram.exe</Command>
    </Exec>
  </Actions>
</Task> 
```

如果您需要从唤醒计算机的命令行创建任务，您可以将任务的基本信息导出为 XML，修改此 XML 以添加`WakeToRun`，然后重新导入此 XML 定义。您可以通过以下两种方式执行此操作：

1.  在任务计划程序 UI 中，选择“唤醒计算机以运行此任务”，右键单击该任务并`Export...`转到 XML。然后，您可以在另一台机器上重新导入此文件（见下文），然后将设置 Wake-To-Run。或者，

2.  通过命令行，创建具有基本设置（动作、时间等）的任务。然后，导出 XML，以编程方式添加`WakeToRun`节点（通过 XSLT 或搜索/替换），然后重新导入此更新的 XML：

    schtasks.exe /create /tn /xml MyTask.xml /f

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-08-11T13:08:12.437

在步骤 2 中的命令行；`schtasks.exe /create /tn /xml MyTask.xml /f` 这可能会引发一个错误，上面写着；无效的语法。缺少强制选项“tn”。

`/tn`需要一个名字。这应该是

```
schtasks.exe /create /tn MyTask /xml "C:\MyTask.xml" /f 
```

如果您在名称中有或想要一个空格，您可以使用；

```
schtasks.exe /create /tn "My Task With Spaces" /xml "C:\My Task With Spaces.xml" /f 
```

希望这可以帮助...

# settings - 如何获取可以在“外观”对话框中找到的系统设置？

> ID：497949
> 
> 赞同：0
> 
> 时间：2009-01-31T01:21:08.140
> 
> 标签：settings, system, appearance

我需要获取一些系统设置，例如标准对话框的字体大小和颜色？（我使用 C#）谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-31T01:23:57.353

以下类具有可为您提供所需信息的属性：

```
System.Drawing.SystemFonts
System.Drawing.SystemColors
System.Windows.Forms.SystemInformation 
```

回答 OP 评论：

```
Font messageBoxFont = System.Drawing.SystemFonts.MessageBoxFont; 
```

# python - 如何让python优雅地失败？

> ID：497952
> 
> 赞同：15
> 
> 时间：2009-01-31T01:22:08.137
> 
> 标签：python

我只是想知道如何让 python 在所有可能的错误中以用户定义的方式失败。

例如，我正在编写一个处理（大）项目列表的程序，其中一些项目可能不是我定义的格式。如果 python 检测到错误，它目前只是吐出一条丑陋的错误消息并停止整个过程。但是，我希望它只将错误与某些上下文一起输出到某个地方，然后继续进行下一项。

如果有人可以帮助我，将不胜感激！

非常感谢！

杰森

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-31T02:01:10.650

以下是我经常在不平凡的脚本和中型应用程序中使用的一些基本策略。

提示 1：在继续处理有意义的每个级别捕获错误。在您的情况下，它可能在循环内部。您不必保护每一行或每一个函数调用，而只需保护能够在错误中幸存下来的地方。

提示 2：使用日志记录模块以一种可配置的方式报告发生的事情，该方式与您在大型应用程序中与其他模块的组合方式无关。开始在你的模块中导入根记录器，然后，在几个不同的地方使用它，你最终可能会找到一个更合理的日志层次结构。

```
import logging
logger = logging.getLogger()

for item in items:
    try:
        process(item)
    except Exception, exc:
        logger.warn("error while processing item: %s", exc) 
```

技巧 3：定义“应用程序异常”，最终您可能希望定义此类异常的层次结构，但最好在需要时发现。当您处理的数据不是您所期望的或表示不一致的情况时，使用此类异常“冒泡”，同时将它们与由模型域之外的常规错误或问题（IO 错误）引起的正常标准异常区分开来ETC）。

```
class DomainException(Exception):
    """Life is not what I expected"""

def process(item):
    # There is no way that this item can be processed, so bail out quickly.
    # Here you are assuming that your caller will report this error but probably
    # it will be able to process the other items.
    if item.foo > item.bar:
        raise DomainException("bad news")

    # Everybody knows that every item has more that 10 wickets, so
    # the following instruction is assumed always being successful.
    # But even if luck is not on our side, our caller will be able to
    # cope with this situation and keep on working
    item.wickets[10] *= 2 
```

主要功能是最外面的检查点：最后在这里处理您的任务完成的可能方式。如果这不是一个 shell 脚本（但例如 UI 应用程序中的对话框下的处理或 Web 应用程序中 POST 之后的操作），那么只有您报告错误的方式会发生变化（并且使用日志记录方法会完全分离实现从它的接口处理）。

```
def main():
    try:
        do_all_the_processing()
        return 0
    except DomainException, exc:
        logger.error("I couldn't finish. The reason is: %s", exc)
        return 1
    except Exception, exc:
        logger.error("Unexpected error: %s - %s", exc.__class__.__name__, exc)
        # In this case you may want to forward a stacktrace to the developers via e-mail
        return 1
    except BaseException:
        logger.info("user stop") # this deals with a ctrl-c
        return 1

if __name__ == '__main__':
    sys.exit(main()) 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-31T01:26:01.280

丑陋的错误消息意味着引发了异常。您需要捕获异常。

[Python 教程中关于异常的部分](http://docs.python.org/tutorial/errors.html)是一个很好的起点。

基本上，您需要将代码包装在这样的`try...except`块中：

```
try:
    do_something_dangerous()
except SomeException:
    handle_the_error() 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-31T01:28:28.093

使用[try... 除了](http://docs.python.org/reference/compound_stmts.html#try)成语

```
try:
    # code that possibly breaks
except RelevantError:          # you need to know what kind of errors you code might produce
    # show your message 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-31T02:04:04.060

> 所有可能的错误

其他答案几乎涵盖了如何让你的程序优雅地失败，但我想提一件事——你不想优雅地失败*所有*错误。如果你隐藏了所有的错误，你就不会看到那些表明程序逻辑错误的错误——即你*想*看到的错误。

因此，虽然捕获异常很重要，但请确保您确切知道实际捕获了哪些异常。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-31T01:28:45.817

当 Python 遇到错误条件时，它会抛出异常。

处理这个问题的方法是捕获异常并可能处理它。

您可以查看 python[教程](http://docs.python.org/tutorial/errors.html)中关于异常的部分。

您表示有兴趣捕获所有异常。这可以通过捕获 Exception 类来完成。根据文档：

> 所有内置的、非系统退出的异常都派生自这个类。所有用户定义的异常也应该从这个类派生

# asp.net - 使用什么：Asp.net 应用程序中的回调、AjAX 或简单的 Javascript

> ID：497966
> 
> 赞同：0
> 
> 时间：2009-01-31T01:29:31.413
> 
> 标签：asp.net, javascript, callback

至于什么是这项工作的最佳工具，我有点不知所措：

我需要什么：父页面有一个链接，当点击一个`pop-up`会弹出一个`gridview`和一个`save`按钮。

如果用户保存了`gridview`，父页面应该刷新和更改，换句话说，我需要能够在客户端和服务器之间传递数据。也许，我应该提到该`Save`按钮将保存`gridview`数据库中的数据，我希望关闭弹出窗口并刷新父页面。

我正在使用 ASP.NET 2.0，目前没有安装 AJAX 库。我在 ASP.NET 中查看`CallBack`并倾向于使用它，因为在这种情况下它似乎是最简单的。

编辑：也许我还应该提到我希望父页面在子窗口启动时处于非活动状态......

你会推荐使用什么？谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-31T01:47:53.890

我肯定会为此使用Javascript。取决于您是要打开新窗口还是使用 javascript 使用伪弹出对话框。对于前者，您将在两个页面上都有一些相互交互的 javascript，这虽然简单，但有点难看。对于后一种方法，您将使用 Ajax 进行保存，然后使用 javascript 刷新页面。

# cocoa-touch - 更改 UIBackButtonItem 标题

> ID：497974
> 
> 赞同：30
> 
> 时间：2009-01-31T01:32:59.020
> 
> 标签：cocoa-touch

我有一个基于 navigationController 的应用程序。我想更改根视图控制器的后退按钮的标题。我在 rootViewController 的 viewDidLoad 方法中尝试了以下代码，但没有成功：

```
self.navigationItem.backBarButtonItem.title = @"Back"; 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-01-31T02:35:30.767

我通过创建自己的 UIBarButtonItem 而不是设置现有标题的标题取得了成功：

```
UIBarButtonItem *backButton = [[UIBarButtonItem alloc] initWithTitle:@"Back" style:UIBarButtonItemStylePlain target:nil action:nil];
self.navigationItem.backBarButtonItem = backButton;
[backButton release]; 
```

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2010-11-25T13:58:24.323

后退按钮的标题是：

1.  前一个视图控制器的标题
2.  前一个视图控制器的导航项后退按钮的名称

如果您正在为当前视图控制器的导航项设置后退按钮，则您没有设置在当前视图中显示的按钮。您实际上是在设置从它推动另一个视图控制器时将使用的后退按钮。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-09-08T18:19:44.700

可能已经回答了，但不简单。

`self.navigationItem.backBarButtonItem`默认为零。因此，如果您将标题设置为它，则不会发生任何事情，因为它会影响`nil`地址对象。这不会抛出错误，因为objective-c 允许消息传递`nil`对象。

**解答： 您必须创建自己的按钮对象才能设置它的标题。**您可以`initWithTitle`或创建它，然后设置标题。

PS - 如前所述，`backBarButtonItem`唯一影响它的是在导航堆栈中推送到其顶部的子视图。根据您构建应用程序的方式，根视图不能再弹出，也不能有后退按钮。不过，您可以影响`leftBarButtonItem`.

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-07-08T05:50:03.743

**后退按钮从父视图控制器的标题中提取其文本。**

在父视图控制器（点击后退按钮时出现的视图控制器）中，将其自己的标题设置为后退按钮上所需的文本。

例如，假设我们有一`RootViewController`堂课。当我们在其表格视图中单击一个单元格时，我们推送一个`SecondViewController`. 我们希望实例的后退按钮显示为`SecondViewController`“Home”。

在*RootViewController.m*`viewDidLoad`的方法中：

 *```
self.title = @"Home"; 
```

在*SecondViewController.m*`viewDidLoad`的方法中：

 *```
UIBarButtonItem *backButton = [[UIBarButtonItem alloc] initWithTitle:@"Back" style:UIBarButtonItemStylePlain target:nil action:nil];
self.navigationItem.backBarButtonItem = backButton;
[backButton release]; 
```

如果您希望您的后退按钮显示“后退”，请将父视图控制器的标题设置为`@"Back"`；

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-31T04:16:38.847

您不能简单地更改根视图控制器中后退按钮的标题，因为根视图控制器不显示后退按钮。毕竟是根，你能回到什么地方呢？虽然您的应用程序中可能有一些合乎逻辑的东西，但默认实现应该做的事情并不明显。

您可以在那里放置一个自定义按钮，而不是真的想要一个控件（制作一个 UIBarButtonItem 并将 navigationItem.backBarButtonItem 设置为它），尽管它的外观与默认按钮之一不同（它将是一个正方形，而不是箭头）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-04-24T17:43:51.067

Mihai Damian 和 Chris Lundie 的答案是正确的。

但是要注意的另一件事是，如果您在设置自定义navigationItem.backBarButtonItem 后更改viewController 的navigationItem.title，它将返回其默认状态，即丢弃您的自定义backBarButtonItem 并使用您刚刚设置的新标题。

因此，我确保在更改 viewController 的标题时重新设置 backBarButtonItem：

```
self.navigationItem.title = @"New Title";
UIBarButtonItem *backButton = [[UIBarButtonItem alloc] init];
backButton.title = @"Back";
self.navigationItem.backBarButtonItem = backButton; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-18T06:39:57.940

您的问题可能与此处描述的问题非常相似：http: [//blog.tmro.net/2009/05/uitabbarbuttonitem-did-not-change-its.html](http://blog.tmro.net/2009/05/uitabbarbuttonitem-did-not-change-its.html)

尝试调试以查看是否为您的按钮设置了任何 _barButtonItemFlags...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-02-14T05:56:20.660

正如之前的海报 (Brenden) 所提到的，默认情况下 backBarButtonItem 的值为 nil，因此设置其标题会导致向 nil 对象发送消息，该对象当然会被忽略。

如果您不想为了设置其标题而手动创建一个新按钮，可以在 Interface Builder 中解决此问题。

在 IB 中，对于作为 navigationController 堆栈一部分的给定视图控制器，您可以单击代表 navigationBar 的 navigationItem。单击时，属性检查器允许您设置三个属性：Title、Prompt 和 BackButton。

如果在 backButton 字段中键入任何旧的随机文本，这具有实例化 backBarButtonItem 对象的效果，并且在您的代码中，您现在可以将其标题设置为您想要的任何文本。

希望这可以帮助某人。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-04-24T11:45:24.110

也许您不希望每个从 viewController 推送的 viewController 都有一个取消按钮，而只是在显示 viewController 中设置一个 leftBarButtonItem 并带有自定义标题

```
self.navigationItem.leftBarButtonItem = [[[UIBarButtonItem alloc] initWithTitle:NSLocalizedString(@"back", @"") style:UIBarButtonSystemItemCancel target:self action:@selector(popViewController)] autorelease];

- (void)popViewController {
    [self.navigationController popViewControllerAnimated:YES];
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-03-04T07:50:07.117

假设：在您的导航控制器中有两个 ViewController 是 **RootViewController**和**DetailViewController**。

*   第一步：您必须覆盖***RootViewController的返回标题***

    ```
    self.navigationItem.backBarButtonItem = [[UIBarButtonItem alloc] initWithTitle:@"backTitle" style:UIBarButtonItemStylePlain target:nil action:nil]; 
    ```

*   第二步：

    [self.navigationController pushViewController:detailVC 动画:YES];

完成了！你会看到 DetailViewController 的后退按钮是“backTitle”

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-04-14T08:54:23.573

```
- (void)pushViewController:(UIViewController *)controller 
             withBackTitle:(NSString *)backTitle 
                  animated:(BOOL)animated {
    self.navigationItem.backBarButtonItem = [[UIBarButtonItem alloc] initWithTitle:backTitle
                                                                             style:UIBarButtonItemStyleDone
                                                                            target:nil
                                                                            action:nil];
    [self.navigationController pushViewController:controller animated:animated];
} 
```

这是作品。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2010-06-01T07:36:36.453

这是最好的解决方案，不要像 self.navigationitem.title 那样设置导航项标题。将此代码放在父视图didload上

```
 CGRect frame = CGRectMake(0, 0, 320, 44);
UILabel *label = [[[UILabel alloc] initWithFrame:frame] autorelease];
label.backgroundColor = [UIColor clearColor];
label.font = [UIFont boldSystemFontOfSize:20.0];
label.shadowColor = [UIColor colorWithWhite:0.0 alpha:0.5];
label.textAlignment = UITextAlignmentCenter;
label.textColor = [UIColor whiteColor];

self.navigationItem.titleView = label;
label.text = @"My Navigation Bar"; 
```

通过将标题设置为上述实际导航标题将为 nil，因此后退按钮标题将自动为“返回”

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2011-09-06T08:52:47.633

```
self.navigationController.navigationBar.backItem.title = @"TEXT"; 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2012-01-06T09:23:04.543

我有有趣的解决方案：

在导航到第二个视图的方法（IBAction 或 didSelectRaw 等）中，我在后面的项目标题中更改为我想要的标题，例如：`self.title = @"Inbox";`. 此外，我添加了 ViewWillApear 方法，以在用户单击返回主标题时更改标题。

# c# - 通过忽略某些字符来比较两个字符串

> ID：497978
> 
> 赞同：3
> 
> 时间：2009-01-31T01:36:22.070
> 
> 标签：c#, string

我想知道是否有一种简单的方法可以通过排除字符串中的某些字符来检查两个字符串是否匹配。请参见下面的示例。

我可以通过编写正则表达式来轻松编写这样的方法来查找“通配符”字符，并将它们替换为常用字符。然后比较两个字符串str1和str2。我不是在寻找这样的实现，而是想知道是否有任何 .Net 框架类可以解决这个问题。似乎是一种常见的需求，但我找不到任何这样的方法。

例如：

```
string str1 = "ABC-EFG";    
string str2 = "ABC*EFG"; 
```

这两个字符串必须声明为相等。

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-12-15T07:57:25.770

我发现自己有同样的要求，我使用的解决方案是基于 String.Compare 方法：

```
String.Compare(str1, str2, CultureInfo.InvariantCulture, CompareOptions.IgnoreSymbols) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-31T05:09:04.437

不确定这是否有帮助：

[Damerau-Levenshtein 距离](http://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance)是处理[模糊字符串搜索](http://en.wikipedia.org/wiki/Fuzzy_string_searching)的几种算法之一。

“ABC-EFG”和“ABC*EFG”之间的 DLD 为 1——“将一个字符串转换为另一个字符串所需的最小操作数，其中操作定义为单个字符的插入、删除或替换，或两个字符的换位。”

当然，这个算法也会为“ZBC-EFG”和“ABC-EFG”这两个字符串返回 1——可能不是你要找的。

DLD 的 Python 实现，来自[http://paxe.googlecode.com/svn/trunk/paxe/Lib/Installer.py](http://paxe.googlecode.com/svn/trunk/paxe/Lib/Installer.py)：

```
def dist(s1, s2):
    d = {}
    lenstr1 = len(s1)
    lenstr2 = len(s2)
    for i in xrange(-1,lenstr1+1):
        d[(i,-1)] = i+1
    for j in xrange(-1,lenstr2+1):
        d[(-1,j)] = j+1

    for i in xrange(0,lenstr1):
        for j in xrange(0,lenstr2):
            if s1[i] == s2[j]:
                cost = 0
            else:
                cost = 1
            d[(i,j)] = min(
                d[(i-1,j)] + 1, # deletion
                d[(i,j-1)] + 1, # insertion
                d[(i-1,j-1)] + cost, # substitution
                )
            if i>1 and j>1 and s1[i]==s2[j-1] and s1[i-1] == s2[j]:
                d[(i,j)] = min (d[(i,j)], d[i-2,j-2] + cost) # transposition

    return d[lenstr1-1,lenstr2-1] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-31T01:41:34.870

抱歉，但我认为正则表达式或用通用字符替换“通配符”字符将是您最好的解决方案。基本上，你说你不想收到的答案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-31T03:15:31.013

您当然可以测试不带替换的正则表达式：

```
[a-zA-z]{3}.[a-zA-z]{3} 
```

似乎是正则表达式的常见用途，那么为什么要避免呢？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-31T01:37:59.823

不，框架本身没有任何东西可以做到这一点。

# cocoa-touch - 多视图应用程序

> ID：497979
> 
> 赞同：0
> 
> 时间：2009-01-31T01:36:45.940
> 
> 标签：cocoa-touch

嗨，我有一个 rootViewController。当应用程序开始加载 mainViewController 作为 rootController 上的子视图。

我想切换视图并将 settingsViewController 加载为 rootView 上的子视图并删除 mainView。

当采取一些行动时，我想删除 settingsView 并加载 mainViewController。

我尝试使用 CATransition、UIView 动画但没有。

你有这方面的教程或例子吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-31T03:01:06.440

查看“Utility Application”项目（创建一个新的 iPhone 项目并选择“Utility Application”）。

这个项目的 RootViewController.m 中的`-(IBAction)toggleView`方法应该做你想要的。

# .net - 事实核查：.NET 应用程序对反编译有多脆弱？

> ID：497980
> 
> 赞同：1
> 
> 时间：2009-01-31T01:37:09.433
> 
> 标签：.net, decompiling, disassembly

我在 MSMobiles.com 博客上看到了这篇文章，其中包含以下内容[：](http://msmobiles.com/news.php/7973.html)

> .Net 在很多方面都很棒，但对于商业应用程序？没门！任何人都可以查看您的源代码。一个高端的混淆器会有很大帮助，但任何坚定的黑客都会在不到一天的时间内修复你的代码。尽管在反盗版和混淆工具上花费了 1000 美元，但我从悲惨的经历中了解到这一点。

然后它说以下关于在 .NET 中开发商业 Windows Mobile 应用程序的内容：

> 准备好 1 天的延迟，之后您的竞争对手将复制您的功能并在 Skymarket 中放置具有相同功能的自己的应用程序

对于那些熟悉 .NET 的人：这是真的还是胡说八道？这个问题是 Windows Mobile 特有的，还是也适用于 Windows 上的 .NET？这让我感到惊讶，因为我知道微软用 .NET 编写了大量自己的客户端软件（而且许多供应商用 Java 编写昂贵的应用程序，显然也有同样的问题），而且他们的IP很容易被盗。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-31T01:43:58.420

我认为这在很大程度上是无意义的，原因很简单，如果您的竞争优势和业务成功取决于代码中的某些算法，那么您已经被搞砸了。成功的应用程序不仅仅是代码，它是众多部分之一。

如果这是你真正担心的事情，那么我会投资混淆并预付一些法律顾问（不管你信不信很便宜），他们会代表你向你认为窃取你的代码的竞争对手发送停止和停止信函。虽然这在法律上几乎无处可去 - 采取行动的威胁只是你最有效的工具。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-31T01:51:12.760

反编译 .NET 应用程序的难易程度是有一定道理的。（这适用于任何 .NET 应用程序，而不仅仅是在 Windows Mobile 上运行的应用程序。）

使用免费和商业工具获取已编译的程序集并获取源代码**相对**容易。（只需看看 Reflector。）话虽如此，您可以使用混淆器，它可以阻止大多数人，但只会减慢坚定的黑客。

尽管如此，几乎所有语言都有反编译器，如果公司（或个人）决心查看您产品的内部结构，无论如何他们都会找到方法。

阅读您引用的帖子听起来确实像是由对 Microsoft、.NET 和/或 Windows Mobile 有非常糟糕体验的人撰写的，并且其中的一些陈述充其量是不正确的。（特别是关于这在 iPhone 上不是问题的一点，因为它是用“本机”代码编写的。）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-31T02:05:05.727

虽然使用中间字节码语言可能会稍微容易一些，但事实是您可以使用任何语言来做到这一点。

可执行代码可以轻松反汇编和执行。 [IDA-Pro](http://www.hex-rays.com/idapro/)可以加载本机可执行文件，反汇编它们，并且使用 Hex-Rays 插件，它甚至可以提供类似 C 的伪代码进行检查。即使没有 Hex-Rays，单步调试汇编代码并推断正在发生的事情也不是很困难。这就是为许可产品制作密钥生成器的方式。它们被反汇编，程序员研究负责生成和验证产品密钥的相关汇编代码。

但是，从应用程序中撤消任何主要功能的成本非常高。因此，除非它是一些涉及商业秘密算法的竞争激烈的功能，否则与逆向工程相比，简单地聘请程序员从头开始编写它几乎总是更容易且更具成本效益。

如果您正在寻找更高级别的保护，您可以混淆您的代码并使用商业打包程序，这使得反汇编程序更具挑战性（并防止在打包应用程序时使用任何反射器）。然而，这些可以被规避，解包和混淆代码并不会真正减慢一个好的 RE。所以，不要过分强调，在我看来，.NET 与任何其他非字节码语言一样适用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-31T02:57:06.887

您唯一的选择是拥有一个网络应用程序 - 您只分发查询主服务器的客户端。这样，努力工作的源头就是你的秘密。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-31T01:41:37.210

它也适用于 Windows 上的 .NET。它也适用于 Java。

您可以对代码进行混淆，其中一些混淆器很好（您可以通过 google 轻松找到好的混淆器），但最后，您必须在保护您的 IP 时保持警惕，因为混淆器并不是一种完美的技术。混淆器击败了变得更智能的反编译器，并击败了变得更智能的混淆器，等等。

从技术上讲，您可以通过查看编译代码来了解 C++ 程序或任何程序的工作原理。只是它编译到的级别比 IL（.NET 应用程序编译到的级别）要复杂得多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-31T01:44:14.893

去反射器上做一个谷歌。是的，它是真实的，是的，它发生了，是的，你的混淆可以提供帮助，但并不完美。然后去反思反射器本身。不确定 Redgate 是否仍在混淆它，但原作者使用不可打印的字符混淆了它，这些字符非常讨厌。

然而，Java 也存在同样的问题，所以选择你的位置。哦，一个真正有决心的黑客会破解任何平台上的任何应用程序，所以选择一个平台来实现它的功能，并且适合你的问题和你的技能。

使用工具来帮助提高您的安全性并提高您的标准。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-31T01:49:24.183

IL 的优点之一是它完全限定了所有类型的全名。因此，当您查看例如 Reflector 中的混淆代码时，您可能在同一个类中有十几个具有相同名称的变量，但由于它们在 IL 中是完全限定的，因此运行时对它们没有任何问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-31T01:49:45.913

阅读 .Net 程序集非常容易。你可以自己试试：

[http://www.codeproject.com/KB/dotnet/NetDasm.aspx](http://www.codeproject.com/KB/dotnet/NetDasm.aspx) [http://www.shutterspeaks.com/2006/08/27/how-to-disassemble-net-assembly-files/](http://www.shutterspeaks.com/2006/08/27/how-to-disassemble-net-assembly-files/)

有一些混淆器可以使工作变得更难。使用 Mono（.Net 的开源实现），还可以将 .net 代码编译为可执行文件，这应该会使反汇编变得更加困难。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-31T01:53:50.477

是的，casper 肯定是对的，你总是可以只看机器码。尽管在查看汇编代码级别时很难辨别更复杂的面向对象关系（如多态性）。

但在我看来，整个保护源代码的心态是有缺陷的。开源理念是，将您的代码开放给公众审查有助于使您的软件变得更好，因为有更多的人在那里发现错误和安全漏洞。此外，[Linus 定律](http://en.wikipedia.org/wiki/Linus%27s_law)正被越来越多的大公司所接受，如 Sun、Google 等。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-31T02:29:12.153

软件的知识产权实际上不仅仅存在于代码本身，它还存在于开始生产产品的想法，在开发、测试和部署产品时获得的知识，以及涉及修复、维护和增强产品的基础设施。

将代码添加到应用程序很像拥有汽车。当然，你可以把它拆开，看看它是如何组装起来的，但是你能仅仅因为你有这些知识就在下周开始生产汽车吗？几乎不。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-02T19:45:11.857

我已经有一段时间没有使用它了，但 Salamander.NET 会将 .NET 应用程序转换为 Win32 本机应用程序（没有框架依赖项）。不确定它是否曾经升级到 .NET 2.0 或更高版本，但它在 2005 年的 1.1 中工作。

# c# - 自动获取博客提要 URL

> ID：497987
> 
> 赞同：0
> 
> 时间：2009-01-31T01:41:10.033
> 
> 标签：c#, rss

给定一个博客 URL，获取其 RSS 提要 URL。我知道这个问题是[在这里](https://stackoverflow.com/questions/61535/how-to-discover-rss-feeds-for-a-given-url)问的，但我正在寻找一个独立于框架的算法，但我更喜欢 C# 中的代码。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-31T01:43:47.250

寻找一个

```
<link rel="alternate" type="..." href="..." /> 
```

来自给定 URL 的页面中的标记。

该类型将`application/atom+xml`用于 Atom，`application/rss+xml`用于 RSS。href 将是提要的 URL。

# compiler-construction - 为什么需要虚拟机？

> ID：497992
> 
> 赞同：30
> 
> 时间：2009-01-31T01:42:04.133
> 
> 标签：compiler-construction, vm-implementation

我正在阅读[这个问题](https://stackoverflow.com/questions/453610/javas-virtual-machine-and-clr)以找出 Java 虚拟机和 .NET CLR 之间的区别，而 Benji 的回答让我想知道为什么首先需要虚拟机。

根据我对 Benji 解释的理解，虚拟机的 JIT 编译器将中间代码解释为在 CPU 上运行的实际汇编代码。之所以必须这样做，是因为 CPU 通常具有不同数量的寄存器，并且根据 Benji 的说法，“有些寄存器是专用的，每条指令都希望其操作数位于不同的寄存器中。” 这是有道理的，因此需要像虚拟机这样的中间解释器，以便可以在任何 CPU 上运行相同的代码。

但是，如果是这样的话，那么我不明白为什么编译成机器代码的 C 或 C++ 代码能够在任何计算机上运行，​​只要它是正确的操作系统。那么为什么我在使用 Pentium 的 Windows 机器上编译的 C 程序能够在使用 AMD 的其他 Windows 机器上运行？

如果 C 代码可以在任何 CPU 上运行，那么虚拟机的目的是什么？是否可以在任何操作系统上运行相同的代码？我知道 Java 在几乎任何操作系统上都有 VM 版本，但是除了 Windows 之外，还有其他操作系统的 CLR 吗？

还是我还缺少其他东西？操作系统是否对其运行的汇编代码进行其他解释以使其适应特定的 CPU 或其他东西？

我很好奇这一切是如何运作的，因此将不胜感激。

注意：我不只是在 JVM 与 CLR 问题中将我的查询作为评论发布的原因是因为我还没有足够的积分来发表评论 =b。

编辑：感谢所有伟大的答案！所以似乎我缺少的是，尽管所有处理器都有差异，但有一个共同的标准化，主要是 X86 架构，它提供了足够多的通用特性集，以便在一个 X86 处理器上编译的 C 代码大部分都可以工作在另一个 X86 处理器上。这进一步证明了虚拟机的合理性，更不用说我忘记了垃圾收集的重要性。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-01-31T02:08:38.217

AMD 和英特尔处理器使用相同的指令集和机器架构（从机器代码执行的角度来看）。

C 和 C++ 编译器编译为机器代码，并带有适合其目标操作系统的标头。一旦编译，它们就不再以任何方式、形状或形式与编译它们的语言相关联，并且仅仅是二进制可执行文件。（有些工件可能会显示它是用什么语言编译的，但这不是重点）

因此，一旦编译，它们就会与机器（X86、intel 和 amd 指令集和架构）和操作系统相关联。

这就是为什么它们可以在任何兼容的 x86 机器和任何兼容的操作系统（win95 到 winvista，对于某些软件）上运行的原因。

但是，它们无法在 OSX 机器上运行，即使它在英特尔处理器上运行 - 二进制文件不兼容，除非您运行其他仿真软件（例如并行程序或带有 Windows 的 VM）。

除此之外，如果你想在 ARM 处理器、MIPS 或 PowerPC 上运行它们，那么你必须运行一个完整的机器指令集模拟器，它将 X86 中的二进制机器代码解释为你正在运行它的任何机器。

将其与 .NET 进行对比。

.NET 虚拟机的制造就好像世界上有更好的处理器——理解对象、内存分配和垃圾收集以及其他高级构造的处理器。这是一台非常复杂的机器，现在不能直接在硅片中构建（具有良好的性能），但可以编写一个仿真器，使其能够在任何现有处理器上运行。

突然之间，您可以为要在其上运行 .NET 的任何处理器编写一个特定于机器的模拟器，然后任何 .NET 程序都可以在其上运行。无需担心操作系统或底层 CPU 架构 - 如果有 .NET VM，那么软件就会运行。

但是让我们更进一步——一旦你有了这种通用语言，为什么不制作将任何其他书面语言转换成它的编译器呢？

因此，现在您可以拥有一个 C、C#、C++、Java、javascript、Basic、python、lua 或任何其他语言编译器来转换书面代码，以便它可以在这个虚拟机上运行。

您已经将机器与语言分离了 2 度，并且无需太多工作，您就可以让任何人编写任何代码并让它在任何机器上运行，只要存在编译器和 VM 来映射这两种分离度.

如果您仍然想知道为什么这是一件好事，请考虑早期的 DOS 机器，以及微软对世界的*真正*贡献是：

Autocad 必须为每台可以打印的打印机编写驱动程序。莲花 1-2-3 也是如此。事实上，如果您想打印您的软件，您必须编写自己的驱动程序。如果有 10 台打印机和 10 个程序，则必须分别独立编写 100 段基本相同的代码。

windows 3.1 试图完成的（连同 GEM 和许多其他抽象层）是让打印机制造商为他们的打印机编写一个驱动程序，而程序员为 windows 打印机类编写一个驱动程序。

现在有 10 个程序和 10 台打印机，只需要编写 20 段代码，而且由于代码的 microsoft 方面对每个人来说都是一样的，那么来自 MS 的示例意味着您几乎没有工作要做。

现在一个程序不仅限于他们选择支持的 10 台打印机，而是所有制造商在 windows 中提供驱动程序的打印机。

同样的问题也发生在应用程序开发中。因为我不使用 MAC，所以我无法使用一些非常简洁的应用程序。有大量重复（我们真的需要多少世界级的文字处理器？）。

Java 旨在解决这个问题，但它有很多限制，其中一些并没有真正解决。

.NET 更接近，但没有人在为 Windows 以外的平台开发世界级的 VM（mono 是如此接近......但并不完全在那里）。

所以...这就是我们需要虚拟机的原因。因为我不想仅仅因为他们选择了不同于我自己的操作系统/机器组合而将自己限制在较小的受众中。

-亚当

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-31T01:56:34.917

您认为 C 代码可以在任何处理器上运行的假设是不正确的。像寄存器和字节序这样的东西会使编译的 C 程序在一个平台上根本无法运行，而它可能在另一个平台上运行。

但是，处理器之间存在某些相似之处，例如，Intel x86 处理器和 AMD 处理器共享一组足够大的属性，大多数针对其中一个编译的代码将在另一个上运行。但是，如果您想使用特定于处理器的属性，那么您需要一个编译器或一组库来为您执行此操作。

至于为什么你想要一个虚拟机，除了它会为你处理处理器差异的声明之外，还有一个事实是虚拟机提供的代码服务对于今天用 C++ 编译的程序（非托管）是不可用的。

提供的最突出的服务是垃圾收集，由 CLR 和 JVM 提供。这两个虚拟机都免费为您提供这项服务。他们为您管理内存。

还提供了诸如边界检查、访问违规（虽然仍然可能，但它们非常困难）之类的东西。

CLR 还为您提供了一种代码安全形式。

这些都不是作为基本运行时环境的一部分提供给许多其他不能在虚拟机上运行的语言。

您可能会通过使用库来获得其中的一些，但这会迫使您进入使用库的模式，而在 .NET 和 Java 中，通过 CLR 和 JVM 提供给您的服务在访问方面是一致的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-31T02:05:08.957

从本质上讲，它允许“托管代码”，这正是它所说的 - 虚拟机在运行时管理代码。这样做的三个主要好处是即时编译、托管指针/垃圾收集和安全控制。

对于即时编译，虚拟机监视代码执行，因此随着代码运行得更频繁，它会被重新优化以更快地运行。您不能使用本机代码执行此操作。

托管指针也更容易优化，因为虚拟机在它们运行时跟踪它们，根据它们的大小和生命周期以不同的方式管理它们。在 C++ 中很难做到这一点，因为仅阅读代码就无法真正判断指针将去往何处。

安全性是不言自明的，虚拟机阻止代码做它不应该做的事情，因为它正在监视。我个人认为这可能是微软为 C# 选择托管代码的最大原因。

基本上我的观点是，因为虚拟机可以实时观察代码，它可以做一些事情，让程序员的生活更轻松，让代码更快。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-02T02:49:47.727

大多数编译器，甚至本机代码编译器，都使用某种中间语言。

这样做主要是为了降低编译器的构建成本。世界上有许多 (N) 种编程语言。世界上也有很多（M）个硬件平台。如果编译器在不使用中间语言的情况下工作，则需要编写以支持所有硬件平台上的所有语言的“编译器”总数将是 N*M。

但是，通过定义一种中间语言并将编译器分成两部分，前端和后端，前端将源代码编译为 IL，后端将 IL 编译为机器代码，您可以只写N+M 编译器。这最终会节省大量成本。

CLR / JVM 编译器和本机代码编译器之间的最大区别在于前端和后端编译器相互链接的方式。在本机代码编译器中，这两个组件通常组合成同一个可执行文件，并且当程序员在 IDE 中点击“构建”时，这两个组件都会运行。

使用 CLR / JVM 编译器，前端和后端在不同的时间运行。前端在编译时运行，生成实际交付给客户的 IL。然后将后端包含在运行时调用的单独组件中。

所以，这就引出了另一个问题，“将后端编译延迟到运行时有什么好处”？

答案是：“这取决于”。

通过将后端编译延迟到运行时，可以发布一组可以在多个硬件平台上运行的二进制文件。它还使程序可以利用后端编译技术的改进而无需重新部署。它还可以为有效实现许多动态语言特性提供基础。最后，它提供了在单独编译的动态链接库 (dll) 之间引入安全性和可靠性约束的能力，这在前期机器代码编译中是不可能的。

但是，也有缺点。实现广泛的编译器优化所需的分析可能很昂贵。这意味着“JIT”后端通常会比前端后端做更少的优化。这可能会损害性能。此外，在运行时调用编译器的需要也增加了加载程序所需的时间。使用“前期”编译器生成的程序没有这些问题。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-31T02:35:57.973

首先，机器代码不是 CPU 的最低指令形式。今天的 x86 CPU 本身使用微码将 X86 指令集解释为另一种内部格式。唯一真正编写微码的人是芯片开发工程师类型，他们忠实而轻松地模拟传统的 x86 指令芯片，以使用当今的技术实现最高性能。

由于它们带来的强大功能和特性，开发人员类型一直在添加额外的抽象层。毕竟，更好的抽象允许更快、更可靠地编写新应用程序。企业并不关心他们编码的内容或方式，他们只是希望能够可靠、快速地完成工作。如果应用程序的 C 版本花费的时间少了几毫秒，但最终花费了两倍的时间来开发，这真的很重要吗？

速度问题几乎不是一个争论，因为许多服务于数百万人的企业应用程序是用 Java 等平台/语言编写的——例如 GMail、GMaps。忘记哪种语言/平台最快。更重要的是您使用正确的算法并编写有效的代码并完成工作。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-31T01:49:14.590

AMD 和 Intel 处理器都具有 x86 架构，如果您想在不同的架构上运行 c/c++ 程序，您必须为该架构使用编译器，相同的二进制可执行文件不会在不同的处理器架构上运行。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-31T01:55:06.480

> 我知道 Java 在几乎任何操作系统上都有 VM 版本，但是除了 Windows 之外，还有其他操作系统的 CLR 吗？

[单核细胞增多症](http://www.mono-project.com/Main_Page)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-31T01:56:13.607

以一种非常简单的方式，那是因为 Intel 和 AMD 实现了相同的汇编语言，具有相同数量的寄存器等等......

因此，您的 C 编译器编译代码以在 Linux 上运行。该程序集使用的是 Linux [ABI](http://en.wikipedia.org/wiki/Application_binary_interface)，因此只要编译程序在 Linux、x86 程序集上运行并且具有正确的函数签名，那么一切都很好。

现在尝试获取已编译的代码，并坚持下去，比如 Linux/PPC（例如，旧 iBook 上的 Linux）。那是行不通的。因为 JVM 已经在 Linux/PPC 平台上实现了，所以 Java 程序在哪里。

现在的汇编语言基本上是程序员可以编程的另一种接口。x86（32 位）允许您访问 eax、ebx、ecx、edx 用于通用整数寄存器，以及 f00-f07 用于浮点。在幕后，CPU 实际上还有数百个寄存器，并将这些东西混在一起以挤出性能。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-31T01:54:43.157

你的分析是对的，java 或 C# 可以设计为直接编译以在任何机器上运行，如果他们这样做可能会更快。但是虚拟机方法可以完全控制代码运行的环境，VM 创建一个安全沙箱，只允许具有正确安全访问权限的命令执行可能具有破坏性的代码——例如更改密码或更新 HD 引导扇区。还有许多其他好处，但这就是杀手锏。您无法在 C# 中获得 StackOverflow ...

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-31T03:43:04.140

我认为你的问题的前提是有效的——你肯定不是第一个问这个问题的人。因此，请查看[http://llvm.org](http://llvm.org)以了解另一种方法（现在是一个正在运行的项目？或由 Apple 赞助）*********