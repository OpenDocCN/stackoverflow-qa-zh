# StackOverflow 问答 000151000-000151999

# c# - 终结器和处置

> ID：151000
> 
> 赞同：4
> 
> 时间：2008-09-29T22:28:27.063
> 
> 标签：c#, dispose, idisposable, finalizer, disposable

我有一个名为的类`BackgroundWorker`，它有一个不断运行的线程。要关闭这个线程，一个名为`stop`to 的实例变量需要是`true`.

为了确保在使用完类时释放线程，我添加`IDisposable`了一个调用`Dispose()`. 假设`stop = true`确实会导致该线程退出，那么这个 sippet 是否正确？`Dispose`从终结器调用很好，对吗？

`Dispose`如果`object`继承，终结器应该总是调用`IDisposable`，对吗？

```
/// <summary>
/// Force the background thread to exit.
/// </summary>
public void Dispose()
{
    lock (this.locker)
    {
        this.stop = true;
    }
}

~BackgroundWorker()
{
    this.Dispose();
} 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-29T23:40:09.213

首先，**严重警告**。不要像你一样使用终结器。如果你在终结器中使用锁，你就会为自己设置一些非常糟糕的效果。短篇小说是不要这样做。现在回到原来的问题。

```
public void Dispose()
{
    Dispose(true);
    GC.SuppressFinalize(this);
}

/// <summary>
/// Force the background thread to exit.
/// </summary>
protected virtual void Dispose(bool disposing)
{
    if (disposing)
    {
        lock (this.locker)
        {
            this.stop = true;
        }
    }
}

~BackgroundWorker()
{
    Dispose(false);
} 
```

拥有终结器的唯一原因是允许子类扩展和释放**非托管资源**。如果您没有子类，则密封您的类并完全删除终结器。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T07:03:39.977

出于兴趣，有什么理由不能使用完全支持取消的常规[BackgroundWorker ？](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)

重新锁定- volatile bool 字段可能不那么麻烦。

然而，在这种情况下，你的终结器并没有做任何有趣的事情，特别是考虑到“if(disposing)”——即它只在 Dispose() 期间运行有趣的代码。就个人而言，我很想只使用 IDisposable，而不提供终结器：您应该使用 Dispose() 来清理它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T07:30:46.667

你的代码很好，虽然锁定终结器有点“可怕”，我会避免它 - 如果你遇到死锁......我不能 100% 确定会发生什么，但这不会很好。但是，如果您是安全的，这应该不是问题。大多。垃圾收集的内部是痛苦的，我希望你永远不必看到它们；）

正如 Marc Gravell 所指出的，一个 volatile bool 可以让你摆脱锁，从而缓解这个问题。如果可以，请实施此更改。

nedruod 的代码将赋值放在 if (disposing) 检查中，这是完全错误的 - 线程是非托管资源，即使没有显式处理也必须停止。您的代码很好，我只是指出您不应该接受该代码片段中给出的建议。

是的，如果实现 IDisposable 模式，您几乎总是应该从终结器调用 Dispose()。完整的 IDisposable 模式比你拥有的要大一点，但你并不总是需要它——它只是提供了两种额外的可能性：

1.  检测是否调用了 Dispose() 或终结器是否正在执行（不允许在终结器中触摸任何托管资源，在被终结的对象之外）；
2.  使子类能够覆盖 Dispose() 方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T22:35:44.547

“停止”实例变量是属性吗？如果没有，则在终结器期间设置它没有特别的意义 - 不再引用该对象，因此没有任何东西可以查询该成员。

如果您实际上是在释放资源，那么让 Dispose() 和终结器执行相同的工作（首先测试该工作是否仍需要完成）是一个很好的模式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T23:10:15.183

您需要完整的一次性模式，但停止必须是线程可以访问的东西。如果它是被处置的类的成员变量，那就不好了，因为它不能引用已处置的类。考虑让线程拥有一个事件并在 dispose 上发出信号。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-12-02T07:35:03.323

实现终结器的对象需要对标志的引用——存储*在另一个对象*中——线程将能够看到该标志；线程*不能*对实现终结器的对象有任何直接或间接的强引用。终结器应该使用类似 CompareExchange 的东西设置标志，并且线程应该使用类似的方法来测试它。请注意，如果一个对象的终结器访问另一个对象，则另一个对象可能已经终结，但它仍然存在。如果终结器引用其他对象的方式不会被它们的终结所困扰，那么终结器就可以了。如果你所做的只是设置一个标志，那你很好。

# c# - 如何在不安装 Microsoft Office 的情况下在 C# 中创建 Excel（.XLS 和 .XLSX）文件？

> ID：151005
> 
> 赞同：2070
> 
> 时间：2008-09-29T22:30:28.680
> 
> 标签：c#, .net, excel, file-io

如何使用 C# 创建 Excel 电子表格，而无需在运行代码的机器上安装 Excel？

* * *

## 回答 #1

> 赞同：1139
> 
> 时间：2010-04-08T21:36:03.573

您可以使用名为 ExcelLibrary 的库。这是一个发布在 Google Code 上的免费开源库：

[Excel库](https://code.google.com/archive/p/excellibrary/)

这看起来是您上面提到的 PHP ExcelWriter 的一个端口。它不会写入新的 .xlsx 格式，但他们正在努力添加该功能。

它非常简单、小巧且易于使用。此外，它还有一个 DataSetHelper，可让您使用 DataSets 和 DataTables 轻松处理 Excel 数据。

ExcelLibrary 似乎仍然只适用于较旧的 Excel 格式（.xls 文件），但将来可能会增加对较新的 2007/2010 格式的支持。

您还可以使用[EPPlus](https://github.com/JanKallman/EPPlus)，它仅适用于 Excel 2007/2010 格式文件（.xlsx 文件）。还有适用于两者的[NPOI 。](https://github.com/tonyqus/npoi)

如评论中所述，每个库都有一些已知的错误。总之，随着时间的推移，EPPlus 似乎是最佳选择。它似乎也得到了更积极的更新和记录。

此外，正如下面@АртёмЦарионов 所指出的，EPPlus 支持数据透视表，ExcelLibrary 可能有一些支持（[ExcelLibrary 中的数据透视表问题](https://code.google.com/archive/p/excellibrary/issues/98)）

这里有几个链接供快速参考：
[ExcelLibrary](https://code.google.com/archive/p/excellibrary/) - [GNU Lesser GPL](https://www.gnu.org/licenses/lgpl.html)
[EPPlus](https://github.com/JanKallman/EPPlus) - [GNU (LGPL) - 不再维护](https://github.com/JanKallman/EPPlus#license)
[EPPlus 5](https://www.epplussoftware.com/) - [Polyform Noncommercial - 从 2020 年 5 月开始](https://www.epplussoftware.com/en/LicenseOverview)
[NPOI](https://github.com/tonyqus/npoi) - [Apache 许可证](https://github.com/tonyqus/npoi/blob/master/LICENSE)

**这里有一些 ExcelLibrary 的示例代码：**

这是一个从数据库中获取数据并从中创建工作簿的示例。请注意，ExcelLibrary 代码是底部的单行：

```
//Create the data set and table
DataSet ds = new DataSet("New_DataSet");
DataTable dt = new DataTable("New_DataTable");

//Set the locale for each
ds.Locale = System.Threading.Thread.CurrentThread.CurrentCulture;
dt.Locale = System.Threading.Thread.CurrentThread.CurrentCulture;

//Open a DB connection (in this example with OleDB)
OleDbConnection con = new OleDbConnection(dbConnectionString);
con.Open();

//Create a query and fill the data table with the data from the DB
string sql = "SELECT Whatever FROM MyDBTable;";
OleDbCommand cmd = new OleDbCommand(sql, con);
OleDbDataAdapter adptr = new OleDbDataAdapter();

adptr.SelectCommand = cmd;
adptr.Fill(dt);
con.Close();

//Add the table to the data set
ds.Tables.Add(dt);

//Here's the easy part. Create the Excel worksheet from the data set
ExcelLibrary.DataSetHelper.CreateWorkbook("MyExcelFile.xls", ds); 
```

创建 Excel 文件就这么简单。您也可以手动创建 Excel 文件，但上述功能给我留下了深刻的印象。

* * *

## 回答 #2

> 赞同：630
> 
> 时间：2010-03-29T12:25:54.837

如果您对 xlsx 格式感到满意，请尝试我的库 EPPlus。它从 ExcelPackage 的源代码开始，但后来完全重写。

它支持范围、单元格样式、图表、形状、图片、命名范围、自动筛选和许多其他内容。

你有两个选择：

*   [EPPlus 4](https://github.com/JanKallman/EPPlus)，根据 LGPL 许可（原始分支，开发到 2020 年）

*   [EPPlus 5](https://github.com/EPPlusSoftware/EPPlus)，在 Polyform Noncommercial 1.0.0 下获得许可（自 2020 年起）。

从 EPPlus 5 readme.md：

> 有了新的许可证，EPPlus 在某些情况下仍然可以免费使用，但需要商业许可证才能用于商业业务。

EPPlus 网站：[https ://www.epplussoftware.com/](https://www.epplussoftware.com/)

* * *

## 回答 #3

> 赞同：206
> 
> 时间：2011-08-16T09:25:58.290

那么对于 Microsoft Office 使用 Open XML SDK 2.0 又如何呢？

几个好处：

*   不需要安装 Office
*   微软制造 = 体面的 MSDN 文档
*   项目中只需使用一个 .Net dll
*   SDK 带有许多工具，例如 diff、validator 等

链接：

*   [Github](https://github.com/officedev/open-xml-sdk)
*   [主要 MSDN 登陆](https://docs.microsoft.com/en-us/office/open-xml/open-xml-sdk)
*   [“我如何...”起始页](https://docs.microsoft.com/en-us/office/open-xml/how-do-i)
*   blogs.MSDN brian_jones[宣布 SDK](https://blogs.msdn.microsoft.com/brian_jones/2010/03/12/announcing-the-release-of-the-open-xml-sdk-2-0/)
*   blogs.MSDN brian_jones[描述 SDK 处理大文件而不崩溃（与 DOM 方法不同）](https://blogs.msdn.microsoft.com/brian_jones/2010/06/22/writing-large-excel-files-with-the-open-xml-sdk/)

* * *

## 回答 #4

> 赞同：175
> 
> 时间：2009-06-20T20:48:26.883

我已经成功使用了以下开源项目：

*   OOXML 格式的 ExcelPackage (Office 2007)

*   .XLS 格式的 NPOI (Office 2003)。[NPOI 2.0](https://github.com/tonyqus/npoi) (Beta) 也支持 XLSX。

看看我的博文：

[在 C# 中创建 Excel 电子表格 .XLS 和 .XLSX](https://www.leniel.net/2009/07/creating-excel-spreadsheets-xls-xlsx-c.html)

[带有 Excel 表格和动态图表的 NPOI](https://www.leniel.net/2009/10/npoi-with-excel-table-and-dynamic-chart.html)

* * *

## 回答 #5

> 赞同：114
> 
> 时间：2008-09-29T22:41:09.793

您可以使用 OLEDB 创建和操作 Excel 文件。检查这个：[Reading and Writing Excel using OLEDB](https://www.codeproject.com/Articles/8500/Reading-and-Writing-Excel-using-OLEDB)。

典型例子：

```
using (OleDbConnection conn = new OleDbConnection("Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\\temp\\test.xls;Extended Properties='Excel 8.0;HDR=Yes'"))
{
  conn.Open();
  OleDbCommand cmd = new OleDbCommand("CREATE TABLE [Sheet1] ([Column1] string, [Column2] string)", conn);
  cmd.ExecuteNonQuery();
} 
```

编辑 - 更多链接：

*   [嘿，脚本专家！如何在不使用 Excel 的情况下从 Excel 中读取？](https://devblogs.microsoft.com/scripting/hey-scripting-guy-how-can-i-read-from-excel-without-using-excel/)
*   [如何使用 ADO.NET 通过 Visual Basic .NET 检索和修改 Excel 工作簿中的记录](http://support.microsoft.com/kb/316934)
*   [使用 ADO.NET C# DbProviderFactory 读取和写入 Excel 电子表格](http://davidhayden.com/blog/dave/archive/2006/05/26/2973.aspx)

* * *

## 回答 #6

> 赞同：83
> 
> 时间：2009-01-24T18:33:17.310

商业解决方案[SpreadsheetGear for .NET](https://www.spreadsheetgear.com/)可以做到这一点。

您可以在此处查看实时 ASP.NET（C# 和 VB）示例并[在](https://www.spreadsheetgear.com/downloads/register.aspx)[此处](https://www.spreadsheetgear.com/support/samples/)下载评估版。

免责声明：我拥有 SpreadsheetGear LLC

* * *

## 回答 #7

> 赞同：68
> 
> 时间：2008-09-29T22:37:59.287

一个非常轻量级的选项可能是使用 HTML 表格。只需在文件中创建 head、body 和 table 标记，并将其保存为扩展名为 .xls 的文件。您可以使用 Microsoft 特定的属性来设置输出样式，包括公式。

我意识到您可能没有在 Web 应用程序中对此进行编码，但这里有一个通过 HTML 表组成 Excel 文件的[示例](https://web.archive.org/web/20051122071945/http://jasonhaley.com/blog/archive/2004/03/20/9583.aspx)。如果您正在编写控制台应用程序、桌面应用程序或服务，则可以使用此技术。

* * *

## 回答 #8

> 赞同：68
> 
> 时间：2009-06-01T15:45:06.220

我用过的几个选项：

如果 XLSX 是必须的：[ExcelPackage](https://archive.codeplex.com/?p=ExcelPackage)是一个好的开始，但在开发人员退出工作后就消失了。ExML 从那里获得并添加了一些功能。[ExML](https://archive.codeplex.com/?p=exml)不是一个糟糕的选择，我仍在几个生产网站中使用它。

不过，对于我所有的新项目，我都使用[NPOI ，即](https://github.com/tonyqus/npoi)[Apache POI](https://poi.apache.org/)的 .NET 端口。 [NPOI 2.0 (Alpha)](https://github.com/tonyqus/npoi)也支持 XLSX。

* * *

## 回答 #9

> 赞同：58
> 
> 时间：2010-11-23T16:33:00.703

如果您正在创建 Excel 2007/2010 文件，请尝试此开源项目：[https ://github.com/closedxml/closedxml](https://github.com/closedxml/closedxml)

> 它提供了一种面向对象的方式来操作文件（类似于 VBA），而无需处理 XML 文档的麻烦。它可以被任何 .NET 语言使用，例如 C# 和 Visual Basic (VB)。
> 
> ClosedXML 允许您在没有 Excel 应用程序的情况下创建 Excel 2007/2010 文件。典型示例是在 Web 服务器上创建 Excel 报告：
> 
> ```
> var workbook = new XLWorkbook();
> var worksheet = workbook.Worksheets.Add("Sample Sheet");
> worksheet.Cell("A1").Value = "Hello World!";
> workbook.SaveAs("HelloWorld.xlsx"); 
> ```

* * *

## 回答 #10

> 赞同：51
> 
> 时间：2008-09-29T22:34:23.553

您实际上可能想查看 C# 中可用的互操作类（例如`Microsoft.Office.Interop.Excel`。您说没有 OLE（这不是），但互操作类非常易于使用。在[此处查看 C# 文档](http://msdn.microsoft.com/en-us/library/ms173186(VS.80).aspx)（Interop for Excel 开始于C# PDF 的第 1072 页）。

如果您没有尝试过它们，您可能会印象深刻。

请注意微软对此的[立场](https://support.microsoft.com/en-in/help/257757/considerations-for-server-side-automation-of-office)：

> Microsoft 目前不推荐也不支持任何无人值守、非交互式客户端应用程序或组件（包括 ASP、ASP.NET、DCOM 和 NT 服务）的 Microsoft Office 应用程序自动化，因为 Office 可能表现出不稳定的行为和/或在此环境中运行 Office 时出现死锁。

* * *

## 回答 #11

> 赞同：51
> 
> 时间：2009-02-12T15:04:46.603

您可以使用[ExcelXmlWriter](https://www.carlosag.net/Tools/ExcelXmlWriter/)。

它工作正常。

* * *

## 回答 #12

> 赞同：36
> 
> 时间：2011-12-05T12:08:36.693

这是一个完全免费的 C# 库，它允许您使用 OpenXML 库从 .xlsx 文件或真正的 Excel 2007 .xlsx 文件中`DataSet`导出：`DataTable``List<>`

[http://mikesknowledgebase.com/pages/CSharp/ExportToExcel.htm](http://mikesknowledgebase.com/pages/CSharp/ExportToExcel.htm)

免费提供完整的源代码以及说明和演示应用程序。

将此类添加到应用程序后，只需一行代码即可将 DataSet 导出到 Excel：

```
CreateExcelFile.CreateExcelDocument(myDataSet, "C:\\Sample.xlsx"); 
```

没有比这更简单的了……

它甚至不需要 Excel 出现在您的服务器上。

* * *

## 回答 #13

> 赞同：28
> 
> 时间：2008-09-30T01:16:40.870

您可以考虑使用[XML 电子表格 2003](https://en.wikipedia.org/wiki/Microsoft_Office_XML_formats#Excel_XML_Spreadsheet_example)格式创建文件。这是一种简单的 XML 格式，使用了[有据可查的模式](https://docs.microsoft.com/en-us/previous-versions/office/developer/office-xp/aa140066(v=office.10)#odc_xmlss_ss:Workbook)。

* * *

## 回答 #14

> 赞同：25
> 
> 时间：2008-09-29T22:48:00.650

您可能想看看[GemBox.Spreadsheet](https://www.gemboxsoftware.com/spreadsheet/free-version)。

他们有一个具有所有功能的免费版本，但如果符合您的需要，则限制为每张 150 行和每工作簿 5 张。

我自己还不需要使用它，但看起来确实很有趣。

* * *

## 回答 #15

> 赞同：23
> 
> 时间：2016-10-07T18:03:31.263

[Syncfusion Essential XlsIO](https://www.syncfusion.com/products/file-formats/xlsio)可以做到这一点。它不依赖微软office，也对不同平台有特定的支持。

*   [ASP.NET](https://help.syncfusion.com/file-formats/xlsio/asp-net)
*   [ASP.NET MVC](https://help.syncfusion.com/file-formats/xlsio/asp-net-mvc)
*   [UWP](https://help.syncfusion.com/file-formats/xlsio/uwp)
*   [赛马林](https://help.syncfusion.com/file-formats/xlsio/xamarin)
*   WPF 和 Windows 窗体
*   Windows 服务和基于批处理的操作

代码示例：

```
//Creates a new instance for ExcelEngine.
ExcelEngine excelEngine = new ExcelEngine();
//Loads or open an existing workbook through Open method of IWorkbooks
IWorkbook workbook = excelEngine.Excel.Workbooks.Open(fileName);
//To-Do some manipulation|
//To-Do some manipulation
//Set the version of the workbook.
workbook.Version = ExcelVersion.Excel2013;
//Save the workbook in file system as xlsx format
workbook.SaveAs(outputFileName); 
```

如果您符合条件（收入少于 100 万美元），则可以通过[社区许可](https://www.syncfusion.com/products/communitylicense)计划免费获得整套控件。注意：我为 Syncfusion 工作。

* * *

## 回答 #16

> 赞同：19
> 
> 时间：2008-11-24T08:22:41.007

各种可用的 Office 2003 XML 库非常适用于较小的 excel 文件。但是，我发现以 XML 格式保存的大型工作簿的绝对大小是一个问题。例如，我使用的工作簿为 40MB，采用新的（当然更紧凑的）XLSX 格式变成了 360MB 的 XML 文件。

就我的研究而言，有两个商业软件包允许输出到较旧的二进制文件格式。他们是：

*   [宝石盒](https://www.gemboxsoftware.com/)
*   [ComponentOne Excel](http://www.componentone.com/SuperProducts/ExcelNET/)

两者都不便宜（我认为分别是 500 美元和 800 美元）。但两者都独立于 Excel 本身工作。

我会好奇的是 OpenOffice.org 之类的 Excel 输出模块。我想知道它们是否可以从 Java 移植到 .Net。

* * *

## 回答 #17

> 赞同：19
> 
> 时间：2009-11-10T05:05:23.653

好，

[您还可以使用Aspose](http://aspose.com)等第三方库。

这个库的好处是它不需要在你的机器上安装 Excel，这对你的情况来说是理想的。

* * *

## 回答 #18

> 赞同：18
> 
> 时间：2009-02-15T08:12:37.353

我最近刚刚使用**[了 FlexCel.NET](https://www.tmssoftware.com/site/flexcelnet.asp)**，发现它是一个很棒的库！我不会说太多的软件产品。在这里给出整个销售宣传毫无意义，您可以阅读他们网站上的所有功能。

它是一种商业产品，但如果您购买它，您将获得完整的来源。所以我想如果你真的想的话，你可以把它编译到你的程序集中。否则，它只是 xcopy 的一个额外程序集 - 没有配置或安装或类似的东西。

我认为如果没有第三方库，您将找不到任何方法，因为 .NET 框架显然没有内置支持，而 OLE 自动化只是一个痛苦的世界。

* * *

## 回答 #19

> 赞同：18
> 
> 时间：2015-07-23T07:55:17.267

我编写了一个简单的代码，通过使用 System.IO.StreamWriter 将数据集导出到 excel 而不使用 excel 对象。

下面的代码将从数据集中读取所有表并将它们一张一张地写入工作表。我从[这篇文章](https://www.codeproject.com/Articles/9380/Export-a-DataSet-to-Microsoft-Excel-without-the-us)中得到了帮助。

```
public static void exportToExcel(DataSet source, string fileName)
{
        const string endExcelXML = "</Workbook>";
        const string startExcelXML = "<xml version>\r\n<Workbook " +
                 "xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\r\n" +
                 " xmlns:o=\"urn:schemas-microsoft-com:office:office\"\r\n " +
                 "xmlns:x=\"urn:schemas-    microsoft-com:office:" +
                 "excel\"\r\n xmlns:ss=\"urn:schemas-microsoft-com:" +
                 "office:spreadsheet\">\r\n <Styles>\r\n " +
                 "<Style ss:ID=\"Default\" ss:Name=\"Normal\">\r\n " +
                 "<Alignment ss:Vertical=\"Bottom\"/>\r\n <Borders/>" +
                 "\r\n <Font/>\r\n <Interior/>\r\n <NumberFormat/>" +
                 "\r\n <Protection/>\r\n </Style>\r\n " +
                 "<Style ss:ID=\"BoldColumn\">\r\n <Font " +
                 "x:Family=\"Swiss\" ss:Bold=\"1\"/>\r\n </Style>\r\n " +
                 "<Style     ss:ID=\"StringLiteral\">\r\n <NumberFormat" +
                 " ss:Format=\"@\"/>\r\n </Style>\r\n <Style " +
                 "ss:ID=\"Decimal\">\r\n <NumberFormat " +
                 "ss:Format=\"0.0000\"/>\r\n </Style>\r\n " +
                 "<Style ss:ID=\"Integer\">\r\n <NumberFormat " +
                 "ss:Format=\"0\"/>\r\n </Style>\r\n <Style " +
                 "ss:ID=\"DateLiteral\">\r\n <NumberFormat " +
                 "ss:Format=\"mm/dd/yyyy;@\"/>\r\n </Style>\r\n " +
                 "</Styles>\r\n ";
        System.IO.StreamWriter excelDoc = null;
        excelDoc = new System.IO.StreamWriter(fileName);

        int sheetCount = 1;
        excelDoc.Write(startExcelXML);
        foreach (DataTable table in source.Tables)
        {
            int rowCount = 0;
            excelDoc.Write("<Worksheet ss:Name=\"" + table.TableName + "\">");
            excelDoc.Write("<Table>");
            excelDoc.Write("<Row>");
            for (int x = 0; x < table.Columns.Count; x++)
            {
                excelDoc.Write("<Cell ss:StyleID=\"BoldColumn\"><Data ss:Type=\"String\">");
                excelDoc.Write(table.Columns[x].ColumnName);
                excelDoc.Write("</Data></Cell>");
            }
            excelDoc.Write("</Row>");
            foreach (DataRow x in table.Rows)
            {
                rowCount++;
                //if the number of rows is > 64000 create a new page to continue output
                if (rowCount == 64000)
                {
                    rowCount = 0;
                    sheetCount++;
                    excelDoc.Write("</Table>");
                    excelDoc.Write(" </Worksheet>");
                    excelDoc.Write("<Worksheet ss:Name=\"" + table.TableName + "\">");
                    excelDoc.Write("<Table>");
                }
                excelDoc.Write("<Row>"); //ID=" + rowCount + "
                for (int y = 0; y < table.Columns.Count; y++)
                {
                    System.Type rowType;
                    rowType = x[y].GetType();
                    switch (rowType.ToString())
                    {
                        case "System.String":
                            string XMLstring = x[y].ToString();
                            XMLstring = XMLstring.Trim();
                            XMLstring = XMLstring.Replace("&", "&");
                            XMLstring = XMLstring.Replace(">", ">");
                            XMLstring = XMLstring.Replace("<", "<");
                            excelDoc.Write("<Cell ss:StyleID=\"StringLiteral\">" +
                                           "<Data ss:Type=\"String\">");
                            excelDoc.Write(XMLstring);
                            excelDoc.Write("</Data></Cell>");
                            break;
                        case "System.DateTime":
                            //Excel has a specific Date Format of YYYY-MM-DD followed by  
                            //the letter 'T' then hh:mm:sss.lll Example 2005-01-31T24:01:21.000
                            //The Following Code puts the date stored in XMLDate 
                            //to the format above
                            DateTime XMLDate = (DateTime)x[y];
                            string XMLDatetoString = ""; //Excel Converted Date
                            XMLDatetoString = XMLDate.Year.ToString() +
                                 "-" +
                                 (XMLDate.Month < 10 ? "0" +
                                 XMLDate.Month.ToString() : XMLDate.Month.ToString()) +
                                 "-" +
                                 (XMLDate.Day < 10 ? "0" +
                                 XMLDate.Day.ToString() : XMLDate.Day.ToString()) +
                                 "T" +
                                 (XMLDate.Hour < 10 ? "0" +
                                 XMLDate.Hour.ToString() : XMLDate.Hour.ToString()) +
                                 ":" +
                                 (XMLDate.Minute < 10 ? "0" +
                                 XMLDate.Minute.ToString() : XMLDate.Minute.ToString()) +
                                 ":" +
                                 (XMLDate.Second < 10 ? "0" +
                                 XMLDate.Second.ToString() : XMLDate.Second.ToString()) +
                                 ".000";
                            excelDoc.Write("<Cell ss:StyleID=\"DateLiteral\">" +
                                         "<Data ss:Type=\"DateTime\">");
                            excelDoc.Write(XMLDatetoString);
                            excelDoc.Write("</Data></Cell>");
                            break;
                        case "System.Boolean":
                            excelDoc.Write("<Cell ss:StyleID=\"StringLiteral\">" +
                                        "<Data ss:Type=\"String\">");
                            excelDoc.Write(x[y].ToString());
                            excelDoc.Write("</Data></Cell>");
                            break;
                        case "System.Int16":
                        case "System.Int32":
                        case "System.Int64":
                        case "System.Byte":
                            excelDoc.Write("<Cell ss:StyleID=\"Integer\">" +
                                    "<Data ss:Type=\"Number\">");
                            excelDoc.Write(x[y].ToString());
                            excelDoc.Write("</Data></Cell>");
                            break;
                        case "System.Decimal":
                        case "System.Double":
                            excelDoc.Write("<Cell ss:StyleID=\"Decimal\">" +
                                  "<Data ss:Type=\"Number\">");
                            excelDoc.Write(x[y].ToString());
                            excelDoc.Write("</Data></Cell>");
                            break;
                        case "System.DBNull":
                            excelDoc.Write("<Cell ss:StyleID=\"StringLiteral\">" +
                                  "<Data ss:Type=\"String\">");
                            excelDoc.Write("");
                            excelDoc.Write("</Data></Cell>");
                            break;
                        default:
                            throw (new Exception(rowType.ToString() + " not handled."));
                    }
                }
                excelDoc.Write("</Row>");
            }
            excelDoc.Write("</Table>");
            excelDoc.Write(" </Worksheet>");
            sheetCount++;
        }

        excelDoc.Write(endExcelXML);
        excelDoc.Close();
    } 
```

* * *

## 回答 #20

> 赞同：18
> 
> 时间：2015-12-02T13:30:28.503

OpenXML 也是一个很好的替代方案，有助于避免在服务器上安装 MS Excel。Microsoft 提供的 Open XML SDK 2.0 简化了操作 Open XML 包和包中的底层 Open XML 模式元素的任务。Open XML 应用程序编程接口 (API) 封装了开发人员在 Open XML 包上执行的许多常见任务。

检查一下[OpenXML：有助于避免在服务器上安装 MS Excel 的替代方法](http://technowide.net/2015/11/03/openxml-alternative-helps-avoid-ms-excel-server/)

* * *

## 回答 #21

> 赞同：16
> 
> 时间：2008-09-30T03:53:10.743

我同意生成 XML 电子表格，这是一个关于如何为 C# 3 执行此操作的示例（每个人都只是在 VB 9 中写博客：P）[http://www.aaron-powell.com/linq-to-xml-to-擅长](http://www.aaron-powell.com/linq-to-xml-to-excel)

* * *

## 回答 #22

> 赞同：14
> 
> 时间：2011-08-23T16:52:27.803

只想添加对直接解决您的问题的第三方解决方案的另一个引用： [http ://www.officewriter.com](http://www.officewriter.com)

（免责声明：我为制作 OfficeWriter 的公司 SoftArtisans 工作）

* * *

## 回答 #23

> 赞同：12
> 
> 时间：2008-09-29T22:39:50.297

[IKVM](http://www.ikvm.net/) + [POI](http://poi.apache.org/)

或者，您可以使用互操作...

* * *

## 回答 #24

> 赞同：12
> 
> 时间：2008-09-30T01:39:05.170

这是一种使用 LINQ to XML 的方法，并附有示例代码：

[使用 LINQ to XML 快速导入和导出 Excel 数据](http://blogs.msdn.com/bethmassi/archive/2007/10/30/quickly-import-and-export-excel-data-with-linq-to-xml.aspx)

这有点复杂，因为您必须导入命名空间等，但它确实可以让您避免任何外部依赖。

（当然，它是 VB .NET，而不是 C#，但您始终可以在其自己的项目中隔离 VB .NET 内容以使用 XML Literals，并在 C# 中执行其他所有操作。）

* * *

## 回答 #25

> 赞同：12
> 
> 时间：2010-12-03T19:53:12.747

您可以使用此库创建格式良好的 Excel 文件：http: [//officehelper.codeplex.com/documentation](http://officehelper.codeplex.com/documentation)
请参见以下示例：

```
using (ExcelHelper helper = new ExcelHelper(TEMPLATE_FILE_NAME, GENERATED_FILE_NAME))
{
    helper.Direction = ExcelHelper.DirectionType.TOP_TO_DOWN;
    helper.CurrentSheetName = "Sheet1";
    helper.CurrentPosition = new CellRef("C3");

    //the template xlsx should contains the named range "header"; use the command "insert"/"name".
    helper.InsertRange("header");

    //the template xlsx should contains the named range "sample1";
    //inside this range you should have cells with these values:
    //<name> , <value> and <comment>, which will be replaced by the values from the getSample()
    CellRangeTemplate sample1 = helper.CreateCellRangeTemplate("sample1", new List<string> {"name", "value", "comment"}); 
    helper.InsertRange(sample1, getSample());

    //you could use here other named ranges to insert new cells and call InsertRange as many times you want, 
    //it will be copied one after another;
    //even you can change direction or the current cell/sheet before you insert

    //typically you put all your "template ranges" (the names) on the same sheet and then you just delete it
    helper.DeleteSheet("Sheet3");
} 
```

示例如下所示：

```
private IEnumerable<List<object>> getSample()
{
    var random = new Random();

    for (int loop = 0; loop < 3000; loop++)
    {
        yield return new List<object> {"test", DateTime.Now.AddDays(random.NextDouble()*100 - 50), loop};
    }
} 
```

* * *

## 回答 #26

> 赞同：12
> 
> 时间：2011-02-16T11:47:30.080

一些第三方组件供应商，如 Infragistics 或 Syncfusion 提供了非常好的 Excel 导出功能，不需要安装 Microsoft Excel。

由于这些供应商还提供高级 UI 网格组件，因此如果您希望 excel 导出的样式和布局能够在应用程序的用户界面中模拟网格的当前状态，这些组件就特别方便。

如果您的导出打算在服务器端执行，重点是要导出的数据并且没有到 UI 的链接，那么我会选择免费的开源选项之一（例如 ExcelLibrary）。

我以前参与过尝试在 Microsoft Office 套件上使用服务器端自动化的项目。基于这种经验，我强烈建议不要使用这种方法。

* * *

## 回答 #27

> 赞同：12
> 
> 时间：2011-04-28T10:40:05.043

```
public class GridViewExportUtil
{
    public static void Export(string fileName, GridView gv)
    {
        HttpContext.Current.Response.Clear();
        HttpContext.Current.Response.AddHeader(
            "content-disposition", string.Format("attachment; filename={0}", fileName));
        HttpContext.Current.Response.ContentType = "application/ms-excel";

        using (StringWriter sw = new StringWriter())
        {
            using (HtmlTextWriter htw = new HtmlTextWriter(sw))
            {
                //  Create a form to contain the grid
                Table table = new Table();

                //  add the header row to the table
                if (gv.HeaderRow != null)
                {
                    GridViewExportUtil.PrepareControlForExport(gv.HeaderRow);
                    table.Rows.Add(gv.HeaderRow);
                }

                //  add each of the data rows to the table
                foreach (GridViewRow row in gv.Rows)
                {
                    GridViewExportUtil.PrepareControlForExport(row);
                    table.Rows.Add(row);
                }

                //  add the footer row to the table
                if (gv.FooterRow != null)
                {
                    GridViewExportUtil.PrepareControlForExport(gv.FooterRow);
                    table.Rows.Add(gv.FooterRow);
                }

                //  render the table into the htmlwriter
                table.RenderControl(htw);

                //  render the htmlwriter into the response
                HttpContext.Current.Response.Write(sw.ToString());
                HttpContext.Current.Response.End();
            }
        }
    }

    /// <summary>
    /// Replace any of the contained controls with literals
    /// </summary>
    /// <param name="control"></param>
    private static void PrepareControlForExport(Control control)
    {
        for (int i = 0; i < control.Controls.Count; i++)
        {
            Control current = control.Controls[i];
            if (current is LinkButton)
            {
                control.Controls.Remove(current);
                control.Controls.AddAt(i, new LiteralControl((current as LinkButton).Text));
            }
            else if (current is ImageButton)
            {
                control.Controls.Remove(current);
                control.Controls.AddAt(i, new LiteralControl((current as ImageButton).AlternateText));
            }
            else if (current is HyperLink)
            {
                control.Controls.Remove(current);
                control.Controls.AddAt(i, new LiteralControl((current as HyperLink).Text));
            }
            else if (current is DropDownList)
            {
                control.Controls.Remove(current);
                control.Controls.AddAt(i, new LiteralControl((current as DropDownList).SelectedItem.Text));
            }
            else if (current is CheckBox)
            {
                control.Controls.Remove(current);
                control.Controls.AddAt(i, new LiteralControl((current as CheckBox).Checked ? "True" : "False"));
            }

            if (current.HasControls())
            {
                GridViewExportUtil.PrepareControlForExport(current);
            }
        }
    }
} 
```

嗨，这个解决方案是将您的网格视图导出到您的 excel 文件，它可能会帮助您

* * *

## 回答 #28

> 赞同：12
> 
> 时间：2017-02-27T23:30:08.897

从 C# 创建 Excel 文件的最简单、最快的方法是使用 Open XML Productivity Tool。Open XML Productivity Tool 随 Open XML SDK 安装一起提供。该工具将任何 Excel 文件反向工程为 C# 代码。然后可以使用 C# 代码重新生成该文件。

所涉及过程的概述是：

1.  使用该工具安装 Open XML SDK。
2.  使用具有所需外观的最新 Excel 客户端创建 Excel 文件。命名它`DesiredLook.xlsx`。
3.  打开该工具`DesiredLook.xlsx`并单击顶部附近的反映代码按钮。 [![在此处输入图像描述](https://i.stack.imgur.com/gB30w.png)](https://i.stack.imgur.com/gB30w.png)
4.  您的文件的 C# 代码将在该工具的右窗格中生成。将此添加到您的 C# 解决方案并生成具有所需外观的文件。

作为奖励，此方法适用于任何 Word 和 PowerPoint 文件。作为 C# 开发人员，您将对代码进行更改以满足您的需求。

[为此，我在 github 上](https://github.com/thomasbtatum/GenerateAnyExcelFileWithCSharp)开发了一个简单的 WPF 应用程序，它将在 Windows 上运行。有一个占位符类`GeneratedClass`，您可以在其中粘贴生成的代码。如果您返回文件的一个版本，它将生成一个这样的 excel 文件：

[![在此处输入图像描述](https://i.stack.imgur.com/w7Pcg.png)](https://github.com/thomasbtatum/GenerateAnyExcelFileWithCSharp)

* * *

## 回答 #29

> 赞同：7
> 
> 时间：2008-09-30T00:53:38.587

Java 开源解决方案是[Apache POI](https://poi.apache.org/)。也许有一种方法可以在这里设置互操作，但我对 Java 的了解还不够，无法回答这个问题。

当我探索这个问题时，我最终使用了互操作程序集。

* * *

## 回答 #30

> 赞同：7
> 
> 时间：2008-11-04T20:15:11.830

你试过 sylk 吗？

我们曾经在经典的 asp 中以 sylk 生成 excelsheets，现在我们也在寻找一个 excelgenerator。

sylk 的优点是，您可以格式化单元格。

* * *

## 回答 #31

> 赞同：6
> 
> 时间：2010-07-09T19:21:26.040

您可以使用 Excel XML 格式将其写入 XML，并使用 .XLS 扩展名命名它，它将使用 excel 打开。您可以控制 XML 文件标题中的所有格式（粗体、宽度等）。

有一个[来自 Wikipedia 的示例 XML](https://en.wikipedia.org/wiki/Microsoft_Office_XML_formats#Excel_XML_Spreadsheet_example)。

* * *

## 回答 #32

> 赞同：5
> 
> 时间：2009-10-22T15:21:25.427

我也投票给[GemBox.Spreadsheet](https://www.gemboxsoftware.com/spreadsheet)。

非常快速且易于使用，在他们的网站上有大量示例。

将我的报告任务提升到了一个全新的执行速度水平。

* * *

## 回答 #33

> 赞同：5
> 
> 时间：2017-12-07T20:40:09.543

一个经常被忽视的非常简单的选择是使用[Microsoft Reporting](https://msdn.microsoft.com/en-us/library/bb885185.aspx?f=255&MSPPError=-2147217396)创建一个 .rdlc 报告并将其导出为 excel 格式。您可以在 Visual Studio 中设计它并使用以下命令生成文件：

```
localReport.Render("EXCELOPENXML", null, ((name, ext, encoding, mimeType, willSeek) => stream = new FileStream(name, FileMode.CreateNew)), out warnings); 
```

您还可以分别使用`"WORDOPENXML"`和将其导出为 .doc 或 .pdf，`"PDF"`并且它在许多不同的平台（例如 ASP.NET 和 SSRS）上都受支持。

在可以看到结果的可视化设计器中进行更改要容易得多，相信我，一旦您开始对数据进行分组、格式化组标题、添加新部分，您就不想弄乱数十个 XML 节点。

* * *

## 回答 #34

> 赞同：5
> 
> 时间：2019-12-20T19:02:46.577

你可以试试我的[SwiftExcel](https://github.com/RomanPavelko/SwiftExcel)库。该库直接写入文件，因此非常高效。例如，您可以在几秒钟内写入 100k 行，而无需使用任何内存。

下面是一个简单的用法示例：

```
using (var ew = new ExcelWriter("C:\\temp\\test.xlsx"))
{
    for (var row = 1; row <= 10; row++)
    {
        for (var col = 1; col <= 5; col++)
        {
            ew.Write($"row:{row}-col:{col}", col, row);
        }
    }
} 
```

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2011-02-09T10:39:33.580

[http://www.codeproject.com/KB/cs/Excel_and_C_.aspx](http://www.codeproject.com/KB/cs/Excel_and_C_.aspx) <= 为什么不直接使用windows的内置功能，只要在服务器上安装office，你安装的任何应用程序都可以自动化。

只需使用本机方法就容易多了。

如果安装了它，您就可以使用它，这是 Windows 中最棒且使用率最低的功能，它在过去被称为 COM，它可以为您节省大量时间和痛苦。

或者更容易使用参考库 MS 用品 - [http://csharp.net-informations.com/excel/csharp-create-excel.htm](http://csharp.net-informations.com/excel/csharp-create-excel.htm)

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2019-12-05T21:14:52.877

## 如何在 OneDrive 上使用 C# 创建 Excel (.xslx) 文件而不安装 Microsoft Office

[Microsoft Graph API](https://developer.microsoft.com/en-us/graph)提供文件和 Excel API，用于为企业和消费者帐户创建和修改存储在 OneDrive 中的 Excel 文件。[Microsoft.Graph](https://www.nuget.org/packages/Microsoft.Graph) NuGet 包提供了许多用于使用文件和 Excel API 的接口。

```
{
  Name = "myExcelFile.xslx",
  File = new Microsoft.Graph.File()
};

// Create an empty file in the user's OneDrive.
var excelWorkbookDriveItem = await graphClient.Me.Drive.Root.Children.Request().AddAsync(excelWorkbook);

// Add the contents of a template Excel file.
DriveItem excelDriveItem;
using (Stream ms = ResourceHelper.GetResourceAsStream(ResourceHelper.ExcelTestResource))
{
    //Upload content to the file. ExcelTestResource is an empty template Excel file.
    //https://graph.microsoft.io/en-us/docs/api-reference/v1.0/api/item_uploadcontent
    excelDriveItem = await graphClient.Me.Drive.Items[excelWorkbookDriveItem.Id].Content.Request().PutAsync<DriveItem>(ms);
} 
```

此时，您现在已经在用户（企业或消费者）或组的 OneDrive 中创建了一个 Excel 文件。您现在可以使用[Excel API](https://docs.microsoft.com/en-us/graph/api/resources/excel?view=graph-rest-1.0)对**Excel 文件进行更改，而无需使用 Excel，也无需了解 Excel XML 格式**。

* * *

## 回答 #37

> 赞同：3
> 
> 时间：2020-12-08T20:25:16.187

我重新编码了代码，现在您可以创建一个 .xls 文件，稍后您可以转换为 Excel 2003 Open XML 格式。

```
private static void exportToExcel(DataSet source, string fileName)
    {
        // Documentacion en:
        // https://en.wikipedia.org/wiki/Microsoft_Office_XML_formats
        // https://answers.microsoft.com/en-us/msoffice/forum/all/how-to-save-office-ms-xml-as-xlsx-file/4a77dae5-6855-457d-8359-e7b537beb1db
        // https://riptutorial.com/es/openxml

        const string startExcelXML = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n"+
                 "<?mso-application progid=\"Excel.Sheet\"?>\r\n" +
                 "<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\r\n" +
                 "xmlns:o=\"urn:schemas-microsoft-com:office:office\"\r\n " +
                 "xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\r\n " +
                 "xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\"\r\n " +
                 "xmlns:html=\"http://www.w3.org/TR/REC-html40\">\r\n " +
                 "xmlns:html=\"https://www.w3.org/TR/html401/\">\r\n " +

                 "<DocumentProperties xmlns=\"urn:schemas-microsoft-com:office:office\">\r\n " +
                 "  <Version>16.00</Version>\r\n " +
                 "</DocumentProperties>\r\n " +
                 " <OfficeDocumentSettings xmlns=\"urn:schemas-microsoft-com:office:office\">\r\n " +
                 "  <AllowPNG/>\r\n " +
                 " </OfficeDocumentSettings>\r\n " +

                 " <ExcelWorkbook xmlns=\"urn:schemas-microsoft-com:office:excel\">\r\n " +
                 "  <WindowHeight>9750</WindowHeight>\r\n " +
                 "  <WindowWidth>24000</WindowWidth>\r\n " +
                 "  <WindowTopX>0</WindowTopX>\r\n " +
                 "  <WindowTopY>0</WindowTopY>\r\n " +
                 "  <RefModeR1C1/>\r\n " +
                 "  <ProtectStructure>False</ProtectStructure>\r\n " +
                 "  <ProtectWindows>False</ProtectWindows>\r\n " +
                 " </ExcelWorkbook>\r\n " +

                 "<Styles>\r\n " +
                 "<Style ss:ID=\"Default\" ss:Name=\"Normal\">\r\n " +
                 "<Alignment ss:Vertical=\"Bottom\"/>\r\n <Borders/>" +
                 "\r\n <Font/>\r\n <Interior/>\r\n <NumberFormat/>" +
                 "\r\n <Protection/>\r\n </Style>\r\n " +
                 "<Style ss:ID=\"BoldColumn\">\r\n <Font " +
                 "x:Family=\"Swiss\" ss:Bold=\"1\"/>\r\n </Style>\r\n " +
                 "<Style ss:ID=\"StringLiteral\">\r\n <NumberFormat" +
                 " ss:Format=\"@\"/>\r\n </Style>\r\n <Style " +
                 "ss:ID=\"Decimal\">\r\n <NumberFormat " +
                 "ss:Format=\"0.0000\"/>\r\n </Style>\r\n " +
                 "<Style ss:ID=\"Integer\">\r\n <NumberFormat/>" +
                 "ss:Format=\"0\"/>\r\n </Style>\r\n <Style " +
                 "ss:ID=\"DateLiteral\">\r\n <NumberFormat " +
                 "ss:Format=\"dd/mm/yyyy;@\"/>\r\n </Style>\r\n " +
                 "</Styles>\r\n ";
        System.IO.StreamWriter excelDoc = null;
        excelDoc = new System.IO.StreamWriter(fileName,false);

        int sheetCount = 1;
        excelDoc.Write(startExcelXML);
        foreach (DataTable table in source.Tables)
        {
            int rowCount = 0;
            excelDoc.Write("<Worksheet ss:Name=\"" + table.TableName + "\">");
            excelDoc.Write("<Table>");
            excelDoc.Write("<Row>");
            for (int x = 0; x < table.Columns.Count; x++)
            {
                excelDoc.Write("<Cell ss:StyleID=\"BoldColumn\"><Data ss:Type=\"String\">");
                excelDoc.Write(table.Columns[x].ColumnName);
                excelDoc.Write("</Data></Cell>");
            }
            excelDoc.Write("</Row>");
            foreach (DataRow x in table.Rows)
            {
                rowCount++;
                //if the number of rows is > 64000 create a new page to continue output
                if (rowCount == 1048576)
                {
                    rowCount = 0;
                    sheetCount++;
                    excelDoc.Write("</Table>");
                    excelDoc.Write(" </Worksheet>");
                    excelDoc.Write("<Worksheet ss:Name=\"" + table.TableName + "\">");
                    excelDoc.Write("<Table>");
                }
                excelDoc.Write("<Row>"); //ID=" + rowCount + "
                for (int y = 0; y < table.Columns.Count; y++)
                {
                    System.Type rowType;
                    rowType = x[y].GetType();
                    switch (rowType.ToString())
                    {
                        case "System.String":
                            string XMLstring = x[y].ToString();
                            XMLstring = XMLstring.Trim();
                            XMLstring = XMLstring.Replace("&", "&");
                            XMLstring = XMLstring.Replace(">", ">");
                            XMLstring = XMLstring.Replace("<", "<");
                            excelDoc.Write("<Cell ss:StyleID=\"StringLiteral\">" +
                                           "<Data ss:Type=\"String\">");
                            excelDoc.Write(XMLstring);
                            excelDoc.Write("</Data></Cell>");
                            break;
                        case "System.DateTime":
                            //Excel has a specific Date Format of YYYY-MM-DD followed by  
                            //the letter 'T' then hh:mm:sss.lll Example 2005-01-31T24:01:21.000
                            //The Following Code puts the date stored in XMLDate 
                            //to the format above
                            DateTime XMLDate = (DateTime)x[y];
                            string XMLDatetoString = ""; //Excel Converted Date
                            XMLDatetoString = XMLDate.Year.ToString() +
                                 "-" +
                                 (XMLDate.Month < 10 ? "0" +
                                 XMLDate.Month.ToString() : XMLDate.Month.ToString()) +
                                 "-" +
                                 (XMLDate.Day < 10 ? "0" +
                                 XMLDate.Day.ToString() : XMLDate.Day.ToString()) +
                                 "T" +
                                 (XMLDate.Hour < 10 ? "0" +
                                 XMLDate.Hour.ToString() : XMLDate.Hour.ToString()) +
                                 ":" +
                                 (XMLDate.Minute < 10 ? "0" +
                                 XMLDate.Minute.ToString() : XMLDate.Minute.ToString()) +
                                 ":" +
                                 (XMLDate.Second < 10 ? "0" +
                                 XMLDate.Second.ToString() : XMLDate.Second.ToString()) +
                                 ".000";
                            excelDoc.Write("<Cell ss:StyleID=\"DateLiteral\">" +
                                         "<Data ss:Type=\"DateTime\">");
                            excelDoc.Write(XMLDatetoString);
                            excelDoc.Write("</Data></Cell>");
                            break;
                        case "System.Boolean":
                            excelDoc.Write("<Cell ss:StyleID=\"StringLiteral\">" +
                                        "<Data ss:Type=\"String\">");
                            excelDoc.Write(x[y].ToString());
                            excelDoc.Write("</Data></Cell>");
                            break;
                        case "System.Int16":
                        case "System.Int32":
                        case "System.Int64":
                        case "System.Byte":
                            excelDoc.Write("<Cell ss:StyleID=\"Integer\">" +
                                    "<Data ss:Type=\"Number\">");
                            excelDoc.Write(x[y].ToString());
                            excelDoc.Write("</Data></Cell>");
                            break;
                        case "System.Decimal":
                        case "System.Double":
                            excelDoc.Write("<Cell ss:StyleID=\"Decimal\">" +
                                  "<Data ss:Type=\"Number\">");
                            excelDoc.Write(x[y].ToString());
                            excelDoc.Write("</Data></Cell>");
                            break;
                        case "System.DBNull":
                            excelDoc.Write("<Cell ss:StyleID=\"StringLiteral\">" +
                                  "<Data ss:Type=\"String\">");
                            excelDoc.Write("");
                            excelDoc.Write("</Data></Cell>");
                            break;
                        default:
                            throw (new Exception(rowType.ToString() + " not handled."));
                    }
                }
                excelDoc.Write("</Row>");
            }
            excelDoc.Write("</Table>");
            excelDoc.Write("</Worksheet>");               
            sheetCount++;
        }

        const string endExcelOptions1 = "\r\n<WorksheetOptions xmlns=\"urn:schemas-microsoft-com:office:excel\">\r\n" +
            "<Selected/>\r\n" +
            "<ProtectObjects>False</ProtectObjects>\r\n" +
            "<ProtectScenarios>False</ProtectScenarios>\r\n" +
            "</WorksheetOptions>\r\n";

        excelDoc.Write(endExcelOptions1);
        excelDoc.Write("</Workbook>");
        excelDoc.Close();
    } 
```

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2020-06-30T11:49:43.227

您可以在 Visual Studio 上安装 OpenXml nuget 包。下面是一些将数据表导出到 excel 文件的代码：

```
Imports DocumentFormat.OpenXml
Imports DocumentFormat.OpenXml.Packaging
Imports DocumentFormat.OpenXml.Spreadsheet

Public Class ExportExcelClass
    Public Sub New()

    End Sub

    Public Sub ExportDataTable(ByVal table As DataTable, ByVal exportFile As String)
        ' Create a spreadsheet document by supplying the filepath.
        ' By default, AutoSave = true, Editable = true, and Type = xlsx.
        Dim spreadsheetDocument As SpreadsheetDocument = spreadsheetDocument.Create(exportFile, SpreadsheetDocumentType.Workbook)

        ' Add a WorkbookPart to the document.
        Dim workbook As WorkbookPart = spreadsheetDocument.AddWorkbookPart
        workbook.Workbook = New Workbook

        ' Add a WorksheetPart to the WorkbookPart.
        Dim Worksheet As WorksheetPart = workbook.AddNewPart(Of WorksheetPart)()
        Worksheet.Worksheet = New Worksheet(New SheetData())

        ' Add Sheets to the Workbook.
        Dim sheets As Sheets = spreadsheetDocument.WorkbookPart.Workbook.AppendChild(Of Sheets)(New Sheets())

        Dim data As SheetData = Worksheet.Worksheet.GetFirstChild(Of SheetData)()
        Dim Header As Row = New Row()
        Header.RowIndex = CType(1, UInt32)

        For Each column As DataColumn In table.Columns
            Dim headerCell As Cell = createTextCell(table.Columns.IndexOf(column) + 1, 1, column.ColumnName)
            Header.AppendChild(headerCell)
        Next

        data.AppendChild(Header)

        Dim contentRow As DataRow
        For i As Integer = 0 To table.Rows.Count - 1
            contentRow = table.Rows(i)
            data.AppendChild(createContentRow(contentRow, i + 2))
        Next

    End Sub

    Private Function createTextCell(ByVal columnIndex As Integer, ByVal rowIndex As Integer, ByVal cellValue As Object) As Cell
        Dim cell As Cell = New Cell()
        cell.DataType = CellValues.InlineString

        cell.CellReference = getColumnName(columnIndex) + rowIndex.ToString

        Dim inlineString As InlineString = New InlineString()
        Dim t As Text = New Text()
        t.Text = cellValue.ToString()
        inlineString.AppendChild(t)
        cell.AppendChild(inlineString)
        Return cell
    End Function

    Private Function createContentRow(ByVal dataRow As DataRow, ByVal rowIndex As Integer) As Row
        Dim row As Row = New Row With {
            .rowIndex = CType(rowIndex, UInt32)
        }

        For i As Integer = 0 To dataRow.Table.Columns.Count - 1
            Dim dataCell As Cell = createTextCell(i + 1, rowIndex, dataRow(i))
            row.AppendChild(dataCell)
        Next

        Return row
    End Function

    Private Function getColumnName(ByVal columnIndex As Integer) As String
        Dim dividend As Integer = columnIndex
        Dim columnName As String = String.Empty
        Dim modifier As Integer

        While dividend > 0
            modifier = (dividend - 1) Mod 26
            columnName = Convert.ToChar(65 + modifier).ToString() & columnName
            dividend = CInt(((dividend - modifier) / 26))
        End While

        Return columnName
    End Function
End Class 
```

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2017-04-05T09:00:59.640

如果您从代码中制作数据表或数据网格视图，您可以使用这种简单的方法保存所有数据。不推荐这种方法，但它可以 100% 工作，即使您没有在计算机上安装 MS Excel。

```
try
 {
  SaveFileDialog saveFileDialog1 = new SaveFileDialog();
  saveFileDialog1.Filter = "Excel Documents (*.xls)|*.xls";
  saveFileDialog1.FileName = "Employee Details.xls";
  if (saveFileDialog1.ShowDialog() == DialogResult.OK)
  {
  string fname = saveFileDialog1.FileName;
  StreamWriter wr = new StreamWriter(fname);
  for (int i = 0; i <DataTable.Columns.Count; i++)
  {
  wr.Write(DataTable.Columns[i].ToString().ToUpper() + "\t");
  }
  wr.WriteLine();

  //write rows to excel file
  for (int i = 0; i < (DataTable.Rows.Count); i++)
  {
  for (int j = 0; j < DataTable.Columns.Count; j++)
  {
  if (DataTable.Rows[i][j] != null)
  {
  wr.Write(Convert.ToString(getallData.Rows[i][j]) + "\t");
  }
   else
   {
   wr.Write("\t");
   }
   }
   //go to next line
   wr.WriteLine();
   }
   //close file
   wr.Close();
   }
   }
   catch (Exception)
   {
    MessageBox.Show("Error Create Excel Sheet!");
   } 
```

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2017-09-27T15:18:35.453

前段时间，我在 NPOI 之上创建了一个 DLL。使用它非常简单：

```
IList<DummyPerson> dummyPeople = new List<DummyPerson>();
//Add data to dummyPeople...
IExportEngine engine = new ExcelExportEngine();
engine.AddData(dummyPeople); 
MemoryStream memory = engine.Export(); 
```

[你可以在这里](https://github.com/vvenegasv/exportable)阅读更多关于它的信息。

顺便说一句，它是 100% 开源的。随意使用、编辑和分享；）

* * *

## 回答 #41

> 赞同：1
> 
> 时间：2018-11-05T07:46:39.800

要将 xls 保存为 xlsx 格式，我们只需要从库中调用`SaveAs`方法。`Microsoft.Office.Interop.Excel`此方法将采用大约 16 个参数，其中一个也是文件格式。

Microsoft 文档：此处 [SaveAs 方法参数](https://docs.microsoft.com/en-us/dotnet/api/microsoft.office.interop.excel._workbook.saveas?view=excel-pia)

我们需要传递的对象就像

```
wb.SaveAs(filename, 51, System.Reflection.Missing.Value,
System.Reflection.Missing.Value, false, false, 1,1, true, 
System.Reflection.Missing.Value, System.Reflection.Missing.Value, System.Reflection.Missing.Value) 
```

这里，51 是 XLSX 的枚举值

对于不同文件格式的 SaveAs，您可以参考[xlFileFormat](https://docs.microsoft.com/en-us/dotnet/api/microsoft.office.interop.excel.xlfileformat?view=excel-pia)

* * *

## 回答 #42

> 赞同：1
> 
> 时间：2020-11-15T15:40:01.360

我想知道为什么没有人建议使用免费的 ImportExcel 模块使用 PowerShell；它可以轻松创建 XML-Excel 文件 (xlsx)。

在创建来自 SQL Server 等数据库的 Excel 表格时特别容易......

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2021-09-28T17:33:59.170

在我的项目中，我使用了一些 .net 库来提取 Excel 文件（.xls 和 .xlsx）

为了导出数据，我经常使用[rdlc](https://www.aspsnippets.com/Articles/Export-RDLC-Report-to-Excel-programmatically-in-ASPNet.aspx)。

要修改我使用的 excel 文件（尝试设置空白单元格 A15 时的示例代码）：

[封闭式XML](https://www.nuget.org/packages/ClosedXML/)

```
 //Closed XML
        var workbook = new XLWorkbook(sUrlFile); // load the existing excel file
        var worksheet = workbook.Worksheets.Worksheet(1);
        worksheet.Cell("A15").SetValue("");
        workbook.Save(); 
```

[IronXL](https://www.nuget.org/packages/IronXL.Excel)

```
 string sUrlFile = "G:\\ReportAmortizedDetail.xls";
        WorkBook workbook = WorkBook.Load(sUrlFile);
        WorkSheet sheet = workbook.WorkSheets.First();
        //Select cells easily in Excel notation and return the calculated value
        sheet["A15"].First().Value = "";
        sheet["A15"].First().FormatString = "";

        workbook.Save();
        workbook.Close();
        workbook = null; 
```

[SpireXLS](https://www.e-iceblue.com/Tutorials/Spire.XLS/Getting-started/Spire.XLS-Quick-Start.html)（当我尝试时，图书馆会打印附加表以提供我们使用试用图书馆的信息

```
 string sUrlFile = "G:\\ReportAmortizedDetail.xls";
            Workbook workbook = new Workbook();
            workbook.LoadFromFile(sUrlFile);
            //Get the 1st sheet
            Worksheet sheet = workbook.Worksheets[0];
            //Specify the cell range
            CellRange range = sheet.Range["A15"];
            //Find all matched text in the range
            CellRange[] cells = range.FindAllString("hi", false, false);
            //Replace text
            foreach (CellRange cell in range)
            {
                cell.Text = "";
            }
            //Save
            workbook.Save(); 
```

**喷气机奥尔德布**

```
 //ExcelTool Class
    public static int ExcelUpdateSheets(string path, string sWorksheetName, string sCellLocation, string sValue)
    {
        int iResult = -99;
        String sConnectionString = @"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" + path + ";Extended Properties='Excel 8.0;HDR=NO'";
        OleDbConnection objConn = new OleDbConnection(sConnectionString);
        objConn.Open();
        OleDbCommand objCmdSelect = new OleDbCommand("UPDATE [" + sWorksheetName + "$" + sCellLocation + "] SET F1=" + UtilityClass.ValueSQL(sValue), objConn);
        objCmdSelect.ExecuteNonQuery();
        objConn.Close();

        return iResult;
    } 
```

用法 ：

```
 ExcelTool.ExcelUpdateSheets(sUrlFile, "ReportAmortizedDetail", "A15:A15", ""); 
```

**假设**

```
 var workbook = new Aspose.Cells.Workbook(sUrlFile);
            // access first (default) worksheet
            var sheet = workbook.Worksheets[0];
            // access CellsCollection of first worksheet
            var cells = sheet.Cells;
            // write HelloWorld to cells A1
            cells["A15"].Value = "";
            // save spreadsheet to disc
            workbook.Save(sUrlFile);
            workbook.Dispose();
            workbook = null; 
```

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2021-11-12T15:33:15.600

这是创建 Excel 文件的最简单方法。

扩展名为 .xlsx 的 Excel 文件是包含 .XML 文件的压缩文件夹 - 但很复杂。

首先创建文件夹结构如下 -

```
public class CreateFileOrFolder
{
    static void Main()
    {
        //
        // https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/file-system/how-to-create-a-file-or-folder
        //
        // https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/file-system/how-to-write-to-a-text-file
        //
        // .NET Framework 4.7.2
        //
        // Specify a name for your top-level folder.
        string folderName = @"C:\Users\david\Desktop\Book3";

        // To create a string that specifies the path to a subfolder under your
        // top-level folder, add a name for the subfolder to folderName.

        string pathString = System.IO.Path.Combine(folderName, "_rels");
        System.IO.Directory.CreateDirectory(pathString);
        pathString = System.IO.Path.Combine(folderName, "docProps");
        System.IO.Directory.CreateDirectory(pathString);
        pathString = System.IO.Path.Combine(folderName, "xl");
        System.IO.Directory.CreateDirectory(pathString);

        string subPathString = System.IO.Path.Combine(pathString, "_rels");
        System.IO.Directory.CreateDirectory(subPathString);
        subPathString = System.IO.Path.Combine(pathString, "theme");
        System.IO.Directory.CreateDirectory(subPathString);
        subPathString = System.IO.Path.Combine(pathString, "worksheets");
        System.IO.Directory.CreateDirectory(subPathString);
        // Keep the console window open in debug mode.
        System.Console.WriteLine("Press any key to exit.");
        System.Console.ReadKey();
    }
} 
```

接下来，创建文本文件来保存描述 Excel 电子表格所需的 XML。

```
namespace MakeFiles3
{
    class Program
    {
        static void Main(string[] args)
        {
            //
            // https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/file-system/how-to-write-to-a-text-file
            //
            // .NET Framework 4.7.2
            //
            string fileName = @"C:\Users\david\Desktop\Book3\_rels\.rels";
            fnWriteFile(fileName);
            fileName = @"C:\Users\david\Desktop\Book3\docProps\app.xml";
            fnWriteFile(fileName);
            fileName = @"C:\Users\david\Desktop\Book3\docProps\core.xml";
            fnWriteFile(fileName);
            fileName = @"C:\Users\david\Desktop\Book3\xl\_rels\workbook.xml.rels";
            fnWriteFile(fileName);
            fileName = @"C:\Users\david\Desktop\Book3\xl\theme\theme1.xml";
            fnWriteFile(fileName);
            fileName = @"C:\Users\david\Desktop\Book3\xl\worksheets\sheet1.xml";
            fnWriteFile(fileName);
            fileName = @"C:\Users\david\Desktop\Book3\xl\styles.xml";
            fnWriteFile(fileName);
            fileName = @"C:\Users\david\Desktop\Book3\xl\workbook.xml";
            fnWriteFile(fileName);
            fileName = @"C:\Users\david\Desktop\Book3\[Content_Types].xml";
            fnWriteFile(fileName);
            // Keep the console window open in debug mode.
            System.Console.WriteLine("Press any key to exit.");
            System.Console.ReadKey();

            bool fnWriteFile(string strFilePath)
            {
                if (!System.IO.File.Exists(strFilePath))
                {
                    using (System.IO.FileStream fs = System.IO.File.Create(strFilePath))
                    {
                        return true;
                    }
                }
                else
                {
                    System.Console.WriteLine("File \"{0}\" already exists.", strFilePath);
                    return false;
                }
            }
        }
    }
} 
```

接下来用 XML 填充文本文件。

所需的 XML 相当冗长，因此您可能需要使用此 github 存储库。

[https://github.com/DaveTallett26/MakeFiles4/blob/master/MakeFiles4/Program.cs](https://github.com/DaveTallett26/MakeFiles4/blob/master/MakeFiles4/Program.cs)

```
//
// https://docs.microsoft.com/en-us/dotnet/standard/io/how-to-write-text-to-a-file
// .NET Framework 4.7.2
//
using System.IO;

namespace MakeFiles4
{
    class Program
    {
        static void Main(string[] args)
        {
            string xContents = @"a";
            string xFilename = @"a";
            xFilename = @"C:\Users\david\Desktop\Book3\[Content_Types].xml";
            xContents = @"<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><Types xmlns=""http://schemas.openxmlformats.org/package/2006/content-types""><Default Extension=""rels"" ContentType=""application/vnd.openxmlformats-package.relationships+xml""/><Default Extension=""xml"" ContentType=""application/xml""/><Override PartName=""/xl/workbook.xml"" ContentType=""application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml""/><Override PartName=""/xl/worksheets/sheet1.xml"" ContentType=""application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml""/><Override PartName=""/xl/theme/theme1.xml"" ContentType=""application/vnd.openxmlformats-officedocument.theme+xml""/><Override PartName=""/xl/styles.xml"" ContentType=""application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml""/><Override PartName=""/docProps/core.xml"" ContentType=""application/vnd.openxmlformats-package.core-properties+xml""/><Override PartName=""/docProps/app.xml"" ContentType=""application/vnd.openxmlformats-officedocument.extended-properties+xml""/></Types>";
            StartExstream(xContents, xFilename);

            xFilename = @"C:\Users\david\Desktop\Book3\_rels\.rels";
            xContents = @"<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><Relationships xmlns=""http://schemas.openxmlformats.org/package/2006/relationships""><Relationship Id=""rId3"" Type=""http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties"" Target=""docProps/app.xml""/><Relationship Id=""rId2"" Type=""http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties"" Target=""docProps/core.xml""/><Relationship Id=""rId1"" Type=""http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument"" Target=""xl/workbook.xml""/></Relationships>";
            StartExstream(xContents, xFilename);

            xFilename = @"C:\Users\david\Desktop\Book3\docProps\app.xml";
            xContents = @"<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><Properties xmlns=""http://schemas.openxmlformats.org/officeDocument/2006/extended-properties"" xmlns:vt=""http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes""><Application>Microsoft Excel</Application><DocSecurity>0</DocSecurity><ScaleCrop>false</ScaleCrop><HeadingPairs><vt:vector size=""2"" baseType=""variant""><vt:variant><vt:lpstr>Worksheets</vt:lpstr></vt:variant><vt:variant><vt:i4>1</vt:i4></vt:variant></vt:vector></HeadingPairs><TitlesOfParts><vt:vector size=""1"" baseType=""lpstr""><vt:lpstr>Sheet1</vt:lpstr></vt:vector></TitlesOfParts><Company></Company><LinksUpToDate>false</LinksUpToDate><SharedDoc>false</SharedDoc><HyperlinksChanged>false</HyperlinksChanged><AppVersion>16.0300</AppVersion></Properties>";
            StartExstream(xContents, xFilename);

            xFilename = @"C:\Users\david\Desktop\Book3\docProps\core.xml";
            xContents = @"<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><cp:coreProperties xmlns:cp=""http://schemas.openxmlformats.org/package/2006/metadata/core-properties"" xmlns:dc=""http://purl.org/dc/elements/1.1/"" xmlns:dcterms=""http://purl.org/dc/terms/"" xmlns:dcmitype=""http://purl.org/dc/dcmitype/"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance""><dc:creator>David Tallett</dc:creator><cp:lastModifiedBy>David Tallett</cp:lastModifiedBy><dcterms:created xsi:type=""dcterms:W3CDTF"">2021-10-26T15:47:15Z</dcterms:created><dcterms:modified xsi:type=""dcterms:W3CDTF"">2021-10-26T15:47:35Z</dcterms:modified></cp:coreProperties>";
            StartExstream(xContents, xFilename);

            xFilename = @"C:\Users\david\Desktop\Book3\xl\styles.xml";
            xContents = @"<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><styleSheet xmlns=""http://schemas.openxmlformats.org/spreadsheetml/2006/main"" xmlns:mc=""http://schemas.openxmlformats.org/markup-compatibility/2006"" mc:Ignorable=""x14ac x16r2 xr"" xmlns:x14ac=""http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac"" xmlns:x16r2=""http://schemas.microsoft.com/office/spreadsheetml/2015/02/main"" xmlns:xr=""http://schemas.microsoft.com/office/spreadsheetml/2014/revision""><fonts count=""1"" x14ac:knownFonts=""1""><font><sz val=""11""/><color theme=""1""/><name val=""Calibri""/><family val=""2""/><scheme val=""minor""/></font></fonts><fills count=""2""><fill><patternFill patternType=""none""/></fill><fill><patternFill patternType=""gray125""/></fill></fills><borders count=""1""><border><left/><right/><top/><bottom/><diagonal/></border></borders><cellStyleXfs count=""1""><xf numFmtId=""0"" fontId=""0"" fillId=""0"" borderId=""0""/></cellStyleXfs><cellXfs count=""1""><xf numFmtId=""0"" fontId=""0"" fillId=""0"" borderId=""0"" xfId=""0""/></cellXfs><cellStyles count=""1""><cellStyle name=""Normal"" xfId=""0"" builtinId=""0""/></cellStyles><dxfs count=""0""/><tableStyles count=""0"" defaultTableStyle=""TableStyleMedium2"" defaultPivotStyle=""PivotStyleLight16""/><extLst><ext uri=""{EB79DEF2-80B8-43e5-95BD-54CBDDF9020C}"" xmlns:x14=""http://schemas.microsoft.com/office/spreadsheetml/2009/9/main""><x14:slicerStyles defaultSlicerStyle=""SlicerStyleLight1""/></ext><ext uri=""{9260A510-F301-46a8-8635-F512D64BE5F5}"" xmlns:x15=""http://schemas.microsoft.com/office/spreadsheetml/2010/11/main""><x15:timelineStyles defaultTimelineStyle=""TimeSlicerStyleLight1""/></ext></extLst></styleSheet>";
            StartExstream(xContents, xFilename);

            xFilename = @"C:\Users\david\Desktop\Book3\xl\workbook.xml";
            xContents = @"<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><workbook xmlns=""http://schemas.openxmlformats.org/spreadsheetml/2006/main"" xmlns:r=""http://schemas.openxmlformats.org/officeDocument/2006/relationships"" xmlns:mc=""http://schemas.openxmlformats.org/markup-compatibility/2006"" mc:Ignorable=""x15 xr xr6 xr10 xr2"" xmlns:x15=""http://schemas.microsoft.com/office/spreadsheetml/2010/11/main"" xmlns:xr=""http://schemas.microsoft.com/office/spreadsheetml/2014/revision"" xmlns:xr6=""http://schemas.microsoft.com/office/spreadsheetml/2016/revision6"" xmlns:xr10=""http://schemas.microsoft.com/office/spreadsheetml/2016/revision10"" xmlns:xr2=""http://schemas.microsoft.com/office/spreadsheetml/2015/revision2""><fileVersion appName=""xl"" lastEdited=""7"" lowestEdited=""7"" rupBuild=""24430""/><workbookPr defaultThemeVersion=""166925""/><mc:AlternateContent xmlns:mc=""http://schemas.openxmlformats.org/markup-compatibility/2006""><mc:Choice Requires=""x15""><x15ac:absPath url=""C:\Users\david\Desktop\"" xmlns:x15ac=""http://schemas.microsoft.com/office/spreadsheetml/2010/11/ac""/></mc:Choice></mc:AlternateContent><xr:revisionPtr revIDLastSave=""0"" documentId=""8_{C633700D-2D40-49EE-8C5E-2561E28A6758}"" xr6:coauthVersionLast=""47"" xr6:coauthVersionMax=""47"" xr10:uidLastSave=""{00000000-0000-0000-0000-000000000000}""/><bookViews><workbookView xWindow=""-120"" yWindow=""-120"" windowWidth=""29040"" windowHeight=""15840"" xr2:uid=""{934C5B62-1DC1-4322-BAE8-00D615BD2FB3}""/></bookViews><sheets><sheet name=""Sheet1"" sheetId=""1"" r:id=""rId1""/></sheets><calcPr calcId=""191029""/><extLst><ext uri=""{140A7094-0E35-4892-8432-C4D2E57EDEB5}"" xmlns:x15=""http://schemas.microsoft.com/office/spreadsheetml/2010/11/main""><x15:workbookPr chartTrackingRefBase=""1""/></ext><ext uri=""{B58B0392-4F1F-4190-BB64-5DF3571DCE5F}"" xmlns:xcalcf=""http://schemas.microsoft.com/office/spreadsheetml/2018/calcfeatures""><xcalcf:calcFeatures><xcalcf:feature name=""microsoft.com:RD""/><xcalcf:feature name=""microsoft.com:Single""/><xcalcf:feature name=""microsoft.com:FV""/><xcalcf:feature name=""microsoft.com:CNMTM""/><xcalcf:feature name=""microsoft.com:LET_WF""/></xcalcf:calcFeatures></ext></extLst></workbook>";
            StartExstream(xContents, xFilename);

            xFilename = @"C:\Users\david\Desktop\Book3\xl\_rels\workbook.xml.rels";
            xContents = @"<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><Relationships xmlns=""http://schemas.openxmlformats.org/package/2006/relationships""><Relationship Id=""rId3"" Type=""http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles"" Target=""styles.xml""/><Relationship Id=""rId2"" Type=""http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme"" Target=""theme/theme1.xml""/><Relationship Id=""rId1"" Type=""http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet"" Target=""worksheets/sheet1.xml""/></Relationships>";
            StartExstream(xContents, xFilename);

            xFilename = @"C:\Users\david\Desktop\Book3\xl\theme\theme1.xml";
            xContents = @"<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><a:theme xmlns:a=""http://schemas.openxmlformats.org/drawingml/2006/main"" name=""Office Theme""><a:themeElements><a:clrScheme name=""Office""><a:dk1><a:sysClr val=""windowText"" lastClr=""000000""/></a:dk1><a:lt1><a:sysClr val=""window"" lastClr=""FFFFFF""/></a:lt1><a:dk2><a:srgbClr val=""44546A""/></a:dk2><a:lt2><a:srgbClr val=""E7E6E6""/></a:lt2><a:accent1><a:srgbClr val=""4472C4""/></a:accent1><a:accent2><a:srgbClr val=""ED7D31""/></a:accent2><a:accent3><a:srgbClr val=""A5A5A5""/></a:accent3><a:accent4><a:srgbClr val=""FFC000""/></a:accent4><a:accent5><a:srgbClr val=""5B9BD5""/></a:accent5><a:accent6><a:srgbClr val=""70AD47""/></a:accent6><a:hlink><a:srgbClr val=""0563C1""/></a:hlink><a:folHlink><a:srgbClr val=""954F72""/></a:folHlink></a:clrScheme><a:fontScheme name=""Office""><a:majorFont><a:latin typeface=""Calibri Light"" panose=""020F0302020204030204""/><a:ea typeface=""""/><a:cs typeface=""""/><a:font script=""Jpan"" typeface=""游ゴシック Light""/><a:font script=""Hang"" typeface=""맑은 고딕""/><a:font script=""Hans"" typeface=""等线 Light""/><a:font script=""Hant"" typeface=""新細明體""/><a:font script=""Arab"" typeface=""Times New Roman""/><a:font script=""Hebr"" typeface=""Times New Roman""/><a:font script=""Thai"" typeface=""Tahoma""/><a:font script=""Ethi"" typeface=""Nyala""/><a:font script=""Beng"" typeface=""Vrinda""/><a:font script=""Gujr"" typeface=""Shruti""/><a:font script=""Khmr"" typeface=""MoolBoran""/><a:font script=""Knda"" typeface=""Tunga""/><a:font script=""Guru"" typeface=""Raavi""/><a:font script=""Cans"" typeface=""Euphemia""/><a:font script=""Cher"" typeface=""Plantagenet Cherokee""/><a:font script=""Yiii"" typeface=""Microsoft Yi Baiti""/><a:font script=""Tibt"" typeface=""Microsoft Himalaya""/><a:font script=""Thaa"" typeface=""MV Boli""/><a:font script=""Deva"" typeface=""Mangal""/><a:font script=""Telu"" typeface=""Gautami""/><a:font script=""Taml"" typeface=""Latha""/><a:font script=""Syrc"" typeface=""Estrangelo Edessa""/><a:font script=""Orya"" typeface=""Kalinga""/><a:font script=""Mlym"" typeface=""Kartika""/><a:font script=""Laoo"" typeface=""DokChampa""/><a:font script=""Sinh"" typeface=""Iskoola Pota""/><a:font script=""Mong"" typeface=""Mongolian Baiti""/><a:font script=""Viet"" typeface=""Times New Roman""/><a:font script=""Uigh"" typeface=""Microsoft Uighur""/><a:font script=""Geor"" typeface=""Sylfaen""/><a:font script=""Armn"" typeface=""Arial""/><a:font script=""Bugi"" typeface=""Leelawadee UI""/><a:font script=""Bopo"" typeface=""Microsoft JhengHei""/><a:font script=""Java"" typeface=""Javanese Text""/><a:font script=""Lisu"" typeface=""Segoe UI""/><a:font script=""Mymr"" typeface=""Myanmar Text""/><a:font script=""Nkoo"" typeface=""Ebrima""/><a:font script=""Olck"" typeface=""Nirmala UI""/><a:font script=""Osma"" typeface=""Ebrima""/><a:font script=""Phag"" typeface=""Phagspa""/><a:font script=""Syrn"" typeface=""Estrangelo Edessa""/><a:font script=""Syrj"" typeface=""Estrangelo Edessa""/><a:font script=""Syre"" typeface=""Estrangelo Edessa""/><a:font script=""Sora"" typeface=""Nirmala UI""/><a:font script=""Tale"" typeface=""Microsoft Tai Le""/><a:font script=""Talu"" typeface=""Microsoft New Tai Lue""/><a:font script=""Tfng"" typeface=""Ebrima""/></a:majorFont><a:minorFont><a:latin typeface=""Calibri"" panose=""020F0502020204030204""/><a:ea typeface=""""/><a:cs typeface=""""/><a:font script=""Jpan"" typeface=""游ゴシック&quot;"/><a:font script=""Hang"" typeface=""맑은 고딕""/><a:font script=""Hans"" typeface=""等线""/><a:font script=""Hant"" typeface=""新細明體""/><a:font script=""Arab"" typeface=""Arial""/><a:font script=""Hebr"" typeface=""Arial""/><a:font script=""Thai"" typeface=""Tahoma""/><a:font script=""Ethi"" typeface=""Nyala""/><a:font script=""Beng"" typeface=""Vrinda""/><a:font script=""Gujr"" typeface=""Shruti""/><a:font script=""Khmr"" typeface=""DaunPenh""/><a:font script=""Knda"" typeface=""Tunga""/><a:font script=""Guru"" typeface=""Raavi""/><a:font script=""Cans"" typeface=""Euphemia""/><a:font script=""Cher"" typeface=""Plantagenet Cherokee""/><a:font script=""Yiii"" typeface=""Microsoft Yi Baiti""/><a:font script=""Tibt"" typeface=""Microsoft Himalaya""/><a:font script=""Thaa"" typeface=""MV Boli""/><a:font script=""Deva"" typeface=""Mangal""/><a:font script=""Telu"" typeface=""Gautami""/><a:font script=""Taml"" typeface=""Latha""/><a:font script=""Syrc"" typeface=""Estrangelo Edessa""/><a:font script=""Orya"" typeface=""Kalinga""/><a:font script=""Mlym"" typeface=""Kartika""/><a:font script=""Laoo"" typeface=""DokChampa""/><a:font script=""Sinh"" typeface=""Iskoola Pota""/><a:font script=""Mong"" typeface=""Mongolian Baiti""/><a:font script=""Viet"" typeface=""Arial""/><a:font script=""Uigh"" typeface=""Microsoft Uighur""/><a:font script=""Geor"" typeface=""Sylfaen""/><a:font script=""Armn"" typeface=""Arial""/><a:font script=""Bugi"" typeface=""Leelawadee UI""/><a:font script=""Bopo"" typeface=""Microsoft JhengHei""/><a:font script=""Java"" typeface=""Javanese Text""/><a:font script=""Lisu"" typeface=""Segoe UI""/><a:font script=""Mymr"" typeface=""Myanmar Text""/><a:font script=""Nkoo"" typeface=""Ebrima""/><a:font script=""Olck"" typeface=""Nirmala UI""/><a:font script=""Osma"" typeface=""Ebrima""/><a:font script=""Phag"" typeface=""Phagspa""/><a:font script=""Syrn"" typeface=""Estrangelo Edessa""/><a:font script=""Syrj"" typeface=""Estrangelo Edessa""/><a:font script=""Syre"" typeface=""Estrangelo Edessa""/><a:font script=""Sora"" typeface=""Nirmala UI""/><a:font script=""Tale"" typeface=""Microsoft Tai Le""/><a:font script=""Talu"" typeface=""Microsoft New Tai Lue""/><a:font script=""Tfng"" typeface=""Ebrima""/></a:minorFont></a:fontScheme><a:fmtScheme name=""Office""><a:fillStyleLst><a:solidFill><a:schemeClr val=""phClr""/></a:solidFill><a:gradFill rotWithShape=""1""><a:gsLst><a:gs pos=""0""><a:schemeClr val=""phClr""><a:lumMod val=""110000""/><a:satMod val=""105000""/><a:tint val=""67000""/></a:schemeClr></a:gs><a:gs pos=""50000""><a:schemeClr val=""phClr""><a:lumMod val=""105000""/><a:satMod val=""103000""/><a:tint val=""73000""/></a:schemeClr></a:gs><a:gs pos=""100000""><a:schemeClr val=""phClr""><a:lumMod val=""105000""/><a:satMod val=""109000""/><a:tint val=""81000""/></a:schemeClr></a:gs></a:gsLst><a:lin ang=""5400000"" scaled=""0""/></a:gradFill><a:gradFill rotWithShape=""1""><a:gsLst><a:gs pos=""0""><a:schemeClr val=""phClr""><a:satMod val=""103000""/><a:lumMod val=""102000""/><a:tint val=""94000""/></a:schemeClr></a:gs><a:gs pos=""50000""><a:schemeClr val=""phClr""><a:satMod val=""110000""/><a:lumMod val=""100000""/><a:shade val=""100000""/></a:schemeClr></a:gs><a:gs pos=""100000""><a:schemeClr val=""phClr""><a:lumMod val=""99000""/><a:satMod val=""120000""/><a:shade val=""78000""/></a:schemeClr></a:gs></a:gsLst><a:lin ang=""5400000"" scaled=""0""/></a:gradFill></a:fillStyleLst><a:lnStyleLst><a:ln w=""6350"" cap=""flat"" cmpd=""sng"" algn=""ctr""><a:solidFill><a:schemeClr val=""phClr""/></a:solidFill><a:prstDash val=""solid""/><a:miter lim=""800000""/></a:ln><a:ln w=""12700"" cap=""flat"" cmpd=""sng"" algn=""ctr""><a:solidFill><a:schemeClr val=""phClr""/></a:solidFill><a:prstDash val=""solid""/><a:miter lim=""800000""/></a:ln><a:ln w=""19050"" cap=""flat"" cmpd=""sng"" algn=""ctr""><a:solidFill><a:schemeClr val=""phClr""/></a:solidFill><a:prstDash val=""solid""/><a:miter lim=""800000""/></a:ln></a:lnStyleLst><a:effectStyleLst><a:effectStyle><a:effectLst/></a:effectStyle><a:effectStyle><a:effectLst/></a:effectStyle><a:effectStyle><a:effectLst><a:outerShdw blurRad=""57150"" dist=""19050"" dir=""5400000"" algn=""ctr"" rotWithShape=""0""><a:srgbClr val=""000000""><a:alpha val=""63000""/></a:srgbClr></a:outerShdw></a:effectLst></a:effectStyle></a:effectStyleLst><a:bgFillStyleLst><a:solidFill><a:schemeClr val=""phClr""/></a:solidFill><a:solidFill><a:schemeClr val=""phClr""><a:tint val=""95000""/><a:satMod val=""170000""/></a:schemeClr></a:solidFill><a:gradFill rotWithShape=""1""><a:gsLst><a:gs pos=""0""><a:schemeClr val=""phClr""><a:tint val=""93000""/><a:satMod val=""150000""/><a:shade val=""98000""/><a:lumMod val=""102000""/></a:schemeClr></a:gs><a:gs pos=""50000""><a:schemeClr val=""phClr""><a:tint val=""98000""/><a:satMod val=""130000""/><a:shade val=""90000""/><a:lumMod val=""103000""/></a:schemeClr></a:gs><a:gs pos=""100000""><a:schemeClr val=""phClr""><a:shade val=""63000""/><a:satMod val=""120000""/></a:schemeClr></a:gs></a:gsLst><a:lin ang=""5400000"" scaled=""0""/></a:gradFill></a:bgFillStyleLst></a:fmtScheme></a:themeElements><a:objectDefaults/><a:extraClrSchemeLst/><a:extLst><a:ext uri=""{05A4C25C-085E-4340-85A3-A5531E510DB2}""><thm15:themeFamily xmlns:thm15=""http://schemas.microsoft.com/office/thememl/2012/main"" name=""Office Theme"" id=""{62F939B6-93AF-4DB8-9C6B-D6C7DFDC589F}"" vid=""{4A3C46E8-61CC-4603-A589-7422A47A8E4A}""/></a:ext></a:extLst></a:theme>";
            StartExstream(xContents, xFilename);

            xFilename = @"C:\Users\david\Desktop\Book3\xl\worksheets\sheet1.xml";
            xContents = @"<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><worksheet xmlns=""http://schemas.openxmlformats.org/spreadsheetml/2006/main"" xmlns:r=""http://schemas.openxmlformats.org/officeDocument/2006/relationships"" xmlns:mc=""http://schemas.openxmlformats.org/markup-compatibility/2006"" mc:Ignorable=""x14ac xr xr2 xr3"" xmlns:x14ac=""http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac"" xmlns:xr=""http://schemas.microsoft.com/office/spreadsheetml/2014/revision"" xmlns:xr2=""http://schemas.microsoft.com/office/spreadsheetml/2015/revision2"" xmlns:xr3=""http://schemas.microsoft.com/office/spreadsheetml/2016/revision3"" xr:uid=""{54E3D330-4E78-4755-89E0-1AADACAC4953}""><dimension ref=""A1:A3""/><sheetViews><sheetView tabSelected=""1"" workbookViewId=""0""><selection activeCell=""A4"" sqref=""A4""/></sheetView></sheetViews><sheetFormatPr defaultRowHeight=""15"" x14ac:dyDescent=""0.25""/><sheetData><row r=""1"" spans=""1:1"" x14ac:dyDescent=""0.25""><c r=""A1""><v>1</v></c></row><row r=""2"" spans=""1:1"" x14ac:dyDescent=""0.25""><c r=""A2""><v>2</v></c></row><row r=""3"" spans=""1:1"" x14ac:dyDescent=""0.25""><c r=""A3""><v>3</v></c></row></sheetData><pageMargins left=""0.7"" right=""0.7"" top=""0.75"" bottom=""0.75"" header=""0.3"" footer=""0.3""/></worksheet>";
            StartExstream(xContents, xFilename);

            // Keep the console window open in debug mode.
            System.Console.WriteLine("Press any key to exit.");
            System.Console.ReadKey();

            bool StartExstream(string strLine, string strFileName)
            {
                // Write the string to a file.
                using (StreamWriter outputFile = new StreamWriter(strFileName))
                {
                    outputFile.WriteLine(strLine);
                    return true;
                }
            }
        }
    }
} 
```

最后压缩包含 XML 的文件夹结构 -

```
namespace ZipFolder
// .NET Framework 4.7.2
// https://stackoverflow.com/questions/15241889/i-didnt-find-zipfile-class-in-the-system-io-compression-namespace?answertab=votes#tab-top
{
    class Program
    {
        static void Main(string[] args)
        {
            string xlPath = @"C:\Users\david\Desktop\Book3.xlsx";
            string folderPath = @"C:\Users\david\Desktop\Book3";

            System.IO.Compression.ZipFile.CreateFromDirectory(folderPath, xlPath);

            // Keep the console window open in debug mode.
            System.Console.WriteLine("Press any key to exit.");
            System.Console.ReadKey();
        }
    }
} 
```

这会生成一个名为 Book3.xlsx 的 Excel 文件，该文件有效并在 Windows 11 上的 Excel 365 中干净地打开。

结果是一个非常简单的 Excel 电子表格，但您可能需要对更复杂的版本进行逆向工程。这是解压缩 .xlsx 文件的代码。

```
namespace UnZipXL
// .NET Framework 4.7.2
// https://stackoverflow.com/questions/15241889/i-didnt-find-zipfile-class-in-the-system-io-compression-namespace?answertab=votes#tab-top
{
    class Program
    {
        static void Main(string[] args)
        {
            string XLPath = @"C:\Users\david\Desktop\Book2.xlsx";
            string extractPath = @"C:\Users\david\Desktop\extract";

            System.IO.Compression.ZipFile.ExtractToDirectory(XLPath, extractPath);

            // Keep the console window open in debug mode.
            System.Console.WriteLine("Press any key to exit.");
            System.Console.ReadKey();
        }
    }
} 
```

更新：

这是更新 Excel 文件的代码片段。这又很简单。

```
//
// https://docs.microsoft.com/en-us/dotnet/standard/io/how-to-write-text-to-a-file
// .NET Framework 4.7.2
//
using System.IO;

namespace UpdateWorksheet5
{
    class Program
    {
        static void Main(string[] args)
        {
            string xContents = @"a";
            string xFilename = @"a";

            xFilename = @"C:\Users\david\Desktop\Book3\xl\worksheets\sheet1.xml";
            xContents = @"<?xml version=""1.0"" encoding=""UTF-8"" standalone=""yes""?><worksheet xmlns=""http://schemas.openxmlformats.org/spreadsheetml/2006/main"" xmlns:r=""http://schemas.openxmlformats.org/officeDocument/2006/relationships"" xmlns:mc=""http://schemas.openxmlformats.org/markup-compatibility/2006"" mc:Ignorable=""x14ac xr xr2 xr3"" xmlns:x14ac=""http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac"" xmlns:xr=""http://schemas.microsoft.com/office/spreadsheetml/2014/revision"" xmlns:xr2=""http://schemas.microsoft.com/office/spreadsheetml/2015/revision2"" xmlns:xr3=""http://schemas.microsoft.com/office/spreadsheetml/2016/revision3"" xr:uid=""{54E3D330-4E78-4755-89E0-1AADACAC4953}""><dimension ref=""A1:A3""/><sheetViews><sheetView tabSelected=""1"" workbookViewId=""0""><selection activeCell=""A4"" sqref=""A4""/></sheetView></sheetViews><sheetFormatPr defaultRowHeight=""15"" x14ac:dyDescent=""0.25""/><sheetData><row r=""1"" spans=""1:1"" x14ac:dyDescent=""0.25""><c r=""A1""><v>1</v></c></row><row r=""2"" spans=""1:1"" x14ac:dyDescent=""0.25""><c r=""A2""><v>2</v></c></row><row r=""3"" spans=""1:1"" x14ac:dyDescent=""0.25""><c r=""A3""><v>3</v></c></row></sheetData><pageMargins left=""0.7"" right=""0.7"" top=""0.75"" bottom=""0.75"" header=""0.3"" footer=""0.3""/></worksheet>";
            xContents = xContents.Remove(941, 1).Insert(941, "0"); //  character to replace is at 942 => index 941
            StartExstream(xContents, xFilename);

            // Keep the console window open in debug mode.
            System.Console.WriteLine("Press any key to exit.");
            System.Console.ReadKey();

            bool StartExstream(string strLine, string strFileName)
            {
                // Write the string to a file.
                using (StreamWriter outputFile = new StreamWriter(strFileName))
                {
                    outputFile.WriteLine(strLine);
                    return true;
                }
            }
        }
    }
} 
```

更新 2 - 除了 Mac 上的文件夹路径外，此代码几乎没有变化。使用 Microsoft Excel Online、.NET Framework 3.1、Visual Studio 2019 for Mac、MacOS Monterey 12.1。

* * *

## 回答 #45

> 赞同：-2
> 
> 时间：2019-01-04T05:17:40.663

检查这个不需要第三方库你可以简单地使用这个将数据表数据导出到excel文件

```
var dt = "your code for getting data into datatable";
            Response.ClearContent();
            Response.AddHeader("content-disposition", string.Format("attachment;filename={0}.xls", DateTime.Now.ToString("yyyy-MM-dd")));
            Response.ContentType = "application/vnd.ms-excel";
            string tab = "";
            foreach (DataColumn dataColumn in dt.Columns)
            {
                Response.Write(tab + dataColumn.ColumnName);
                tab = "\t";
            }
            Response.Write("\n");
            int i;
            foreach (DataRow dataRow in dt.Rows)
            {
                tab = "";
                for (i = 0; i < dt.Columns.Count; i++)
                {
                    Response.Write(tab + dataRow[i].ToString());
                    tab = "\t";
                }
                Response.Write("\n");
            }
            Response.End(); 
```

* * *

## 回答 #46

> 赞同：-6
> 
> 时间：2014-12-20T06:37:43.647

我正在使用以下代码创建 excel 2007 文件，该文件创建文件并写入该文件，但是当我打开文件但它给我错误，即 exel 无法打开文件 bcz 文件可能已损坏或文件扩展名不兼容。但如果我使用 .xls 作为文件，它可以正常工作

```
for (int i = 0; i < TotalFile; i++)
{
    Contact.Clear();
    if (innerloop == SplitSize)
    {
        for (int j = 0; j < SplitSize; j++)
        {
            string strContact = DSt.Tables[0].Rows[i * SplitSize + j][0].ToString();
            Contact.Add(strContact);
        }
        string strExcel = strFileName + "_" + i.ToString() + ".xlsx";
                         File.WriteAllLines(strExcel, Contact.ToArray());
    }
} 
```

也参考链接

[http://dotnet-magic.blogspot.in/2011/10/createformat-excel-file-from-cnet.html](http://dotnet-magic.blogspot.in/2011/10/createformat-excel-file-from-cnet.html)

# c# - ASP.net中使用静态变量缓存信息可以吗？

> ID：151021
> 
> 赞同：23
> 
> 时间：2008-09-29T22:35:40.023
> 
> 标签：c#, asp.net, caching, static-variables

目前，我正在 ASP.net 上使用 C# 3.5 开发项目管理应用程序。为了减少对数据库的访问，我使用静态变量缓存了大量信息。例如，用户列表保存在内存中的静态类中。该类在启动时从数据库中读取所有信息，并在进行更改时更新数据库，但它永远不需要从数据库中读取。

该类在写入数据库的同时使用更新的信息 ping 其他网络服务器（如果它们存在）。ping 机制是一种 Windows 服务，缓存对象使用随机可用端口注册到该服务。它也用于其他事情。

数据量并不是那么大。目前我使用它只是为了缓存用户（密码哈希、权限、姓名、电子邮件等）。它只是保存了一堆对数据库的调用。

我想知道这种方法是否存在任何缺陷和/或是否有更好的方法来缓存数据？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-29T22:42:08.073

一个陷阱：一个静态字段的范围是每个应用程序域，增加的负载将使服务器在池中生成更多的应用程序域。如果您只从静态数据中读取，这不一定是问题，但是您会在内存中获得重复的数据，并且每次创建或回收应用程序域时都会受到打击。

最好使用 Cache 对象 - 它适用于这样的事情。

编辑：原来我对 AppDomains 的看法是错误的（正如评论中指出的那样） - 更多的*应用程序*实例将在负载下生成，但它们都将在同一个 AppDomain 中运行。（但您仍然应该使用 Cache 对象！）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T22:49:25.203

只要您可以预期缓存永远不会增长到大于可用内存量的大小，就可以了。此外，请确保每个数据库只有一个此应用程序的实例，否则应用程序不同实例中的缓存可能“不同步”。

在我工作的地方，我们有一个本土的 O/RM，我们做的事情类似于你对某些预计不会增长或改变太多的表所做的事情。所以，你所做的并不是史无前例的，事实上在我们的系统中，是经过验证的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-29T22:52:29.577

您必须考虑的另一个陷阱是线程安全。您的所有应用程序请求都在同一个 AppDomain 中运行，但可能来自不同的线程。访问静态变量必须考虑到它是从多个线程访问的。可能比您正在寻找的开销更多。缓存对象更适合此目的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-29T22:38:30.393

嗯......“经典”方法将是应用程序缓存，但前提是您从不更新静态变量，或者如果您这样做了了解锁定问题，并且您了解它们可以随时通过 appdomain 重新启动而消失，那么我不没有真正看到使用静态的危害。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T01:48:30.810

我建议您研究为您的应用程序提供分布式缓存的方法。你可以看看[NCache](http://www.alachisoft.com/ncache/)或[indeXus.Net](http://www.sharedcache.com/cms/)

我建议这样做的原因是您采用了自己的临时方式来更新您正在缓存的信息。静态变量/引用很好，但它们不会更新/刷新（所以你必须自己处理老化）并且你似乎有一个分布式设置。

# macos - 如何在 OS X 上升级 *console* 版本的 vim？

> ID：151024
> 
> 赞同：15
> 
> 时间：2008-09-29T22:35:46.450
> 
> 标签：macos, vim, console

我确定这是一个新手问题，但是每次我为 os x 编译/dl'ed 一个新版本的 vim 时，在命令行上运行 vim 都会打开 gvim 应用程序。我只想升级控制台版本（例如，我可以编译 python 以使用omnicomplete）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-11-07T13:36:19.713

如果我正确理解了问题，这里是另一个解决方案：查看[http://www.andrewvos.com/2011/07/23/upgrading-vim-on-os-x-with-homebrew/](http://www.andrewvos.com/2011/07/23/upgrading-vim-on-os-x-with-homebrew/)

真的很简单，快速，无痛。它使用 homebrew-alt，您还需要安装 mercurial（如果没有，它会提示您）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-29T23:21:43.050

您还可以使用 MacPorts 为您处理安装。安装后，运行`/opt/local/bin/vim`二进制文件。我将它放在我`PATH`的系统二进制目录之前（尽管请注意，这可能会导致依赖于 OS X 附带的工具版本的 cmdline 工具出现问题）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T22:57:39.783

这听起来可能很愚蠢，但你是在将 vim 二进制文件复制到 /usr/bin 吗？默认情况下，“vim”路径是 /usr/bin/vim。如果您从源代码编译，您可能需要将 vim 二进制文件复制到 /usr/bin/vim（从而覆盖原始 vim），或者通过绝对路径启动编译版本（例如 ~/vim-checkout/build /vim)。

然而，这只是一个猜测。我看不出有什么比这更多的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-02-14T03:00:07.687

使用自制软件：

```
brew install macvim
ln -s /usr/local/bin/mvim /usr/local/bin/vim 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T23:53:30.243

还可以将您的新二进制文件符号链接到 /usr/local/bin/

# sqlite - 如何解锁 SQLite 数据库？

> ID：151026
> 
> 赞同：297
> 
> 时间：2008-09-29T22:35:49.277
> 
> 标签：sqlite

```
sqlite> DELETE FROM mails WHERE (`id` = 71);
SQL error: database is locked 
```

如何解锁数据库，这样才能正常工作？

* * *

## 回答 #1

> 赞同：300
> 
> 时间：2010-08-13T22:37:16.860

在 Windows 中，您可以尝试这个程序[http://www.nirsoft.net/utils/opened_files_view.html](http://www.nirsoft.net/utils/opened_files_view.html)来找出进程正在处理 db 文件。尝试关闭该程序以解锁数据库

在 Linux 和 macOS 中，您可以执行类似的操作，例如，如果您的锁定文件是 development.db：

> $定影器开发.db

此命令将显示锁定文件的进程：

> > 开发.db：5430

直接杀掉进程...

> 杀死-9 5430

...您的数据库将被解锁。

* * *

## 回答 #2

> 赞同：95
> 
> 时间：2011-10-12T13:12:52.397

我在写入期间通过崩溃应用程序导致我的 sqlite 数据库被锁定。这是我修复它的方法：

```
echo ".dump" | sqlite old.db | sqlite new.db 
```

取自：[http ://random.kakaopor.hu/how-to-repair-an-sqlite-database](http://random.kakaopor.hu/how-to-repair-an-sqlite-database)

* * *

## 回答 #3

> 赞同：55
> 
> 时间：2008-10-20T14:24:02.277

SQLite wiki [DatabaseIsLocked](https://www2.sqlite.org/cvstrac/wiki?p=DatabaseIsLocked)页面提供了此错误消息的解释。它部分说明争用的来源是内部的（对于发出错误的进程而言）。本页未解释的是 SQLite 如何确定您的进程中的某些内容持有锁定以及哪些条件可能导致误报。

> 当您尝试从同一数据库连接同时对数据库执行两项不兼容的操作时，会出现此错误代码。

* * *

v3 中引入的与文件锁定相关的更改，可能对未来的读者有用，可以在这里找到：[SQLite 版本 3 中的文件锁定和并发](https://www.sqlite.org/lockingv3.html)

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2009-06-22T14:25:15.060

删除 -journal 文件听起来是个糟糕的主意。它允许 sqlite 在崩溃后将数据库回滚到一致的状态。如果您在数据库处于不一致状态时删除它，那么您将得到一个损坏的数据库。引用来自[sqlite 站点](http://www.sqlite.org/atomiccommit.html)的页面：

> 如果确实发生崩溃或断电并且热日志留在磁盘上，则原始数据库文件和热日志必须以其原始名称保留在磁盘上，直到数据库文件被另一个 SQLite 进程打开并回滚. [...]
> 
> 我们怀疑 SQLite 恢复的常见故障模式是这样的：发生电源故障。电源恢复后，善意的用户或系统管理员开始四处查看磁盘是否损坏。他们看到名为“important.data”的数据库文件。他们可能对这个文件很熟悉。但在崩溃之后，还有一个名为“important.data-journal”的热门期刊。然后用户删除了热日志，认为他们正在帮助清理系统。除了用户教育之外，我们没有办法阻止这种情况。

回滚应该在下次打开数据库时自动发生，但如果进程无法锁定数据库，它将失败。正如其他人所说，一个可能的原因是另一个进程当前打开了它。如果数据库位于 NFS 卷上，另一种可能性是过时的 NFS 锁。在这种情况下，解决方法是将数据库文件替换为未锁定在 NFS 服务器上的新副本（mv database.db original.db；cp original.db database.db）。请注意，由于 NFS 文件锁定的错误实现，sqlite FAQ 建议在并发访问 NFS 卷上的数据库时要小心。

我无法解释为什么删除 -journal 文件会让您锁定以前无法锁定的数据库。那是可重现的吗？

顺便说一句，-journal 文件的存在并不一定意味着发生了崩溃或有更改要回滚。Sqlite 有几种不同的日志模式，在 PERSIST 或 TRUNCATE 模式下，它始终保留 -journal 文件，并更改内容以指示是否有部分事务要回滚。

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2013-03-07T12:28:33.807

如果要删除“数据库已锁定”错误，请按照以下步骤操作：

1.  将您的数据库文件复制到其他位置。
2.  用复制的数据库替换数据库。这将取消引用正在访问您的数据库文件的所有进程。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2009-01-29T22:58:06.557

如果进程在 SQLite DB 上锁定并崩溃，则 DB 将永久保持锁定状态。那就是问题所在。这并不是说其他​​一些进程有锁。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2008-09-29T22:39:14.273

SQLite db 文件只是文件，所以第一步是确保它不是只读的。另一件事是确保您没有打开数据库的某种 GUI SQLite DB 查看器。您可以在另一个 shell 中打开数据库，或者您的代码可能打开了数据库。通常，如果不同的线程或 SQLite 数据库浏览器等应用程序打开数据库进行写入，您会看到这一点。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2009-08-04T11:02:36.647

我的锁是由系统崩溃引起的，而不是由挂起的进程引起的。为了解决这个问题，我只是重命名了文件，然后将其复制回原来的名称和位置。

使用 linux shell 会...

```
mv mydata.db temp.db
cp temp.db mydata.db 
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2011-06-16T03:19:32.503

我刚才遇到了这个问题，在远程服务器上使用 SQLite 数据库，存储在 NFS 挂载上。在我使用的远程 shell 会话在数据库打开时崩溃后，SQLite 无法获得锁定。

上面建议的恢复方法对我不起作用（包括先移动然后将数据库复制回来的想法）。但在将其复制到非 NFS 系统后，数据库变得可用，并且似乎没有数据丢失。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2016-03-08T09:49:00.987

我`Pooling=true`在连接字符串中添加了“”，它起作用了。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-11-14T18:44:35.950

我发现 SQLite 中各种锁定状态的[文档](http://www.sqlite.org/lockingv3.html)非常有帮助。Michael，如果您可以执行读取操作但无法执行对数据库的写入操作，这意味着一个进程已在您的数据库上获得了 RESERVED 锁，但尚未执行写入操作。如果您使用的是 SQLite3，则有一个名为 PENDING 的新锁，不允许更多进程连接，但现有连接仍然可以执行读取，因此如果这是您应该查看的问题。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2012-09-12T20:29:35.770

如果文件位于远程文件夹（如共享文件夹）中，则可能会引发此错误。我将数据库更改为本地目录，它运行良好。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2015-02-19T16:05:22.777

某些功能，例如 INDEX'ing，可能需要很长时间 - 并且在运行时会锁定整个数据库。在这种情况下，它甚至可能不使用日志文件！

因此，检查您的数据库是否被锁定的最佳/唯一方法是因为一个进程正在主动写入它（因此您应该让它独自一人直到它完成它的操作）是 md5（或某些系统上的 md5sum）文件两次. 如果您得到不同的校验和，则正在写入数据库，并且您真的真的不想杀死 -9 该进程，因为如果这样做，您很容易以损坏的表/数据库告终。

我会重申，因为它很重要——解决方案不是找到锁定程序并杀死它——而是找出数据库是否有一个写锁是有充分理由的，然后从那里开始。有时正确的解决方案只是喝咖啡休息时间。

创建这种锁定但未写入情况的唯一方法是，如果您的程序运行`BEGIN EXCLUSIVE`，因为它想要做一些表更改或其他事情，那么无论出于何种原因，`END`之后永远不会发送，**并且进程永远不会终止**。在任何正确编写的代码中都不太可能满足所有三个条件，因此，当有人想要杀死 -9 他们的锁定进程时，100 次中有 99 次，锁定进程实际上锁定了您的数据库，这是有充分理由的。`BEGIN EXCLUSIVE`除非确实需要，否则程序员通常不会添加条件，因为它会阻止并发并增加用户投诉。SQLite 本身仅在真正需要时才添加它（例如在索引时）。

最后，正如几个答案所述，文件内部不存在“锁定”状态 - 它位于操作系统的内核中。运行的进程`BEGIN EXCLUSIVE`已向操作系统请求锁定文件。即使您的独占进程崩溃了，您的操作系统也将能够确定它是否应该保持文件锁定！不可能最终得到一个被锁定但没有进程主动锁定它的数据库！在查看哪个进程正在锁定文件时，通常最好使用 lsof 而不是 fuser（这是一个很好的说明：[https ://unix.stackexchange.com/questions/94316/fuser-vs-lsof-检查使用中的文件](https://unix.stackexchange.com/questions/94316/fuser-vs-lsof-to-check-files-in-use)）。或者，如果您有 DTrace (OSX)，您可以在文件上使用 iosnoop。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2012-02-17T18:39:06.070

我在应用程序中有这样的问题，它从 2 个连接访问 SQLite - 一个是只读的，第二个是用于读写的。看起来该只读连接阻止了第二个连接的写入。最后，事实证明需要在使用后立即完成或至少重置准备好的语句。直到打开准备好的语句，它才导致数据库被阻止写入。

**不要忘记致电：**

```
sqlite_reset(xxx); 
```

或者

```
sqlite_finalize(xxx); 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-11-14T18:37:13.000

我刚刚发生了类似的事情——我的 Web 应用程序能够从数据库中读取，但无法执行任何插入或更新。重新启动 Apache 至少暂时解决了这个问题。

但是，如果能够找到根本原因，那就太好了。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2011-04-03T11:49:40.157

应该是数据库的内部问题......
对我来说，它已经在尝试使用“SQLite manager”浏览数据库后表现出来......
所以，如果你找不到另一个进程连接到数据库并且你无法修复它，试试这个激进的解决方案：

1.  提供导出表格（您可以在 Firefox 上使用“SQLite 管理器”）
2.  如果迁移改变了您的数据库方案，请删除上次失败的迁移
3.  重命名您的“database.sqlite”文件
4.  执行“rake db:migrate”创建一个新的工作数据库
5.  提供给数据库正确的权限以进行表的导入
6.  导入您的备份表
7.  编写新的迁移
8.  用“ `rake db:migrate`”执行

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2011-09-16T20:29:25.050

**我的 Linux 环境中的lsof**命令帮助我找出一个进程正在挂起以保持文件打开。
杀掉进程，问题就解决了。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2013-05-16T05:50:51.957

这个链接解决了这个问题。:[当 Sqlite 给出: 数据库锁定错误](https://stackoverflow.com/questions/8853954/sqlite-error-database-is-locked) 它解决了我的问题可能对你有用。

并且您可以使用开始事务和结束事务来避免将来锁定数据库。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-06-12T20:20:21.627

我在从终端会话运行 Python 脚本的 Mac OS X 10.5.7 上遇到了同样的问题。即使我停止了脚本并且终端窗口位于命令提示符下，下次运行时也会出现此错误。解决方案是关闭终端窗口，然后再次打开它。对我来说没有意义，但它起作用了。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2010-06-21T10:45:32.213

在关闭重启选项之前，有必要看看是否可以找到 sqlite 数据库的用户。

在 Linux 上，可以`fuser`为此使用：

```
$ fuser database.db

$ fuser database.db-journal 
```

就我而言，我得到了以下回复：

```
philip    3556  4700  0 10:24 pts/3    00:00:01 /usr/bin/python manage.py shell 
```

这表明我有另一个使用数据库的 pid 为 3556 (manage.py) 的 Python 程序。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2011-12-15T09:11:05.793

我只是有同样的错误。在 5 个矿井谷歌搜索后，我发现我没有关闭一个正在使用数据库的 shell 女巫。只需将其关闭并重试；）

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2012-02-17T11:56:43.823

我有同样的问题。显然，回滚功能似乎用与 db 文件相同但没有最新更改的日志覆盖 db 文件。我已经在下面的代码中实现了这一点，从那时起它一直运行良好，而在我的代码之前，由于数据库保持锁定，我的代码会卡在循环中。

希望这可以帮助

### 我的python代码

```
##############
#### Defs ####
##############
def conn_exec( connection , cursor , cmd_str ):
    done        = False
    try_count   = 0.0
    while not done:
        try:
            cursor.execute( cmd_str )
            done = True
        except sqlite.IntegrityError:
            # Ignore this error because it means the item already exists in the database
            done = True
        except Exception, error:
            if try_count%60.0 == 0.0:       # print error every minute
                print "\t" , "Error executing command" , cmd_str
                print "Message:" , error

            if try_count%120.0 == 0.0:      # if waited for 2 miutes, roll back
                print "Forcing Unlock"
                connection.rollback()

            time.sleep(0.05)    
            try_count += 0.05

def conn_comit( connection ):
    done        = False
    try_count   = 0.0
    while not done:
        try:
            connection.commit()
            done = True
        except sqlite.IntegrityError:
            # Ignore this error because it means the item already exists in the database
            done = True
        except Exception, error:
            if try_count%60.0 == 0.0:       # print error every minute
                print "\t" , "Error executing command" , cmd_str
                print "Message:" , error

            if try_count%120.0 == 0.0:      # if waited for 2 miutes, roll back
                print "Forcing Unlock"
                connection.rollback()

            time.sleep(0.05)    
            try_count += 0.05       

##################
#### Run Code ####
##################
connection = sqlite.connect( db_path )
cursor = connection.cursor()
# Create tables if database does not exist
conn_exec( connection , cursor , '''CREATE TABLE IF NOT EXISTS fix (path TEXT PRIMARY KEY);''')
conn_exec( connection , cursor , '''CREATE TABLE IF NOT EXISTS tx (path TEXT PRIMARY KEY);''')
conn_exec( connection , cursor , '''CREATE TABLE IF NOT EXISTS completed (fix DATE, tx DATE);''')
conn_comit( connection ) 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2012-10-24T17:33:42.863

出现此异常的一个常见原因是当您尝试执行写入操作同时仍为读取操作保留资源时。例如，如果您从表中选择，然后尝试更新您选择的内容，而不先关闭您的 ResultSet。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2016-03-02T22:38:09.657

我在多线程应用程序中也遇到了“数据库被锁定”错误，这似乎是[SQLITE_BUSY](http://sqlite.org/rescode.html#busy)结果代码，我通过将[sqlite3_busy_timeout](http://sqlite.org/c3ref/busy_timeout.html)设置为合适的长度（如 30000）来解决它。

（顺便说一句，在一个 7 岁的问题上没有人发现这一点真是太奇怪了！SQLite 真的是一个奇特而令人惊叹的项目......）

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2016-04-20T10:31:15.213

一个老问题，有很多答案，这是我最近阅读上述答案所遵循的步骤，但在我的情况下，问题是由于 cifs 资源共享造成的。这个案例以前没有报道过，所以希望它对某人有所帮助。

*   检查您的 java 代码中没有打开任何连接。
*   检查没有其他进程正在使用带有 lsof 的 SQLite db 文件。
*   检查正在运行的 jvm 进程的用户所有者对该文件是否具有 r/w 权限。
*   尝试在连接打开时强制锁定模式

    ```
    final SQLiteConfig config = new SQLiteConfig();

    config.setReadOnly(false);

    config.setLockingMode(LockingMode.NORMAL);

    connection = DriverManager.getConnection(url, config.toProperties()); 
    ```

如果您在 NFS 共享文件夹上使用 SQLite db 文件，请检查SQLite 常见问题的[这一点](https://www.sqlite.org/faq.html#q5)，并查看安装配置选项以确保避免锁定，如下[所述](https://support.shotgunsoftware.com/entries/95443658-Getting-database-is-locked-on-NFS-and-CIFS-setup)：

```
//myserver /mymount cifs username=*****,password=*****,iocharset=utf8,sec=ntlm,file,nolock,file_mode=0700,dir_mode=0700,uid=0500,gid=0500 0 0 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2016-08-09T03:21:29.980

我在与此处描述的情况略有不同的情况下遇到此错误。

SQLite 数据库基于由 3 个服务器共享的 NFS 文件系统。在其中两台服务器上，我能够成功地对数据库运行查询，而在第三台服务器上，我认为我收到了“数据库已锁定”消息。

这第三台机器的问题是它没有剩余空间`/var`。每次我尝试在位于此文件系统中的任何 SQLite 数据库中运行查询时，我都会收到“数据库已锁定”消息以及日志中的此错误：

> 8 月 8 日 10:33:38 server01 内核：锁定：无法监控 172.22.84.87

还有这个：

> 8 月 8 日 10:33:38 server01 rpc.statd[7430]：插入失败：写入 /var/lib/nfs/statd/sm/other.server.name.com：设备上没有剩余空间 8 月 8 日 10:33： 38 server01 rpc.statd[7430]: STAT_FAIL 到 server01 用于 172.22.84.87 的 SM_MON

空间情况处理完毕后，一切都恢复了正常。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2018-02-25T20:51:54.863

如果您尝试解锁**Chrome 数据库**以[使用 SQLite 查看它](https://superuser.com/a/224318/139292)，则只需关闭 Chrome。

视窗

```
%userprofile%\Local Settings\Application Data\Google\Chrome\User Data\Default\Web Data

or

%userprofile%\Local Settings\Application Data\Google\Chrome\User Data\Default\Chrome Web Data 
```

苹果电脑

```
~/Library/Application Support/Google/Chrome/Default/Web Data 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2021-04-18T09:19:24.507

根据我的经验，此错误是由以下原因引起的：您打开了多个连接。

例如：

1.  1 个或多个 sqlitebrowser (GUI)
2.  1 个或多个电子线
3.  导轨螺纹

我不确定 SQLITE3 如何处理多线程/请求的细节，但是当我关闭 sqlitebrowser 和电子线程时，rails 运行良好，不会再阻塞。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-12-29T01:44:57.637

根据您之前的评论，您说存在 -journal 文件。

这可能意味着您已经打开和（独占？）事务并且尚未提交数据。您的程序或其他一些过程是否留下了 -journal？

重新启动 sqlite 进程将查看日志文件并清理所有未提交的操作并删除 -journal 文件。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2010-01-07T05:51:56.330

正如 Seun Osewa 所说，有时僵尸进程会坐在终端中并获得锁，即使您认为这是不可能的。您的脚本运行，崩溃，然后您返回到提示符，但是库调用在某处产生了一个僵尸进程，并且该进程具有锁定。

关闭您所在的终端（在 OSX 上）可能会起作用。重新启动将起作用。您可以寻找没有做任何事情的“python”进程（例如），然后杀死它们。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2010-06-27T11:28:28.007

你可以试试这个：`.timeout 100`设置 timeout 。我不知道在命令行中发生了什么，但在 C# .Net 中执行此操作时：`"UPDATE table-name SET column-name = value;"`我得到数据库已锁定，但这`"UPDATE table-name SET column-name = value"`一切正常。

看起来当您添加 ; 时，sqlite 会寻找进一步的命令。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2014-03-14T20:32:55.797

将 Delphi 与 LiteDAC 组件一起使用时出现此错误。事实证明，如果 SQLite 连接组件（在本例中为 TLiteConnection）的 Connected 属性设置为 True，则只有在从 Delphi IDE 运行我的应用程序时才会发生这种情况。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2014-05-24T14:12:47.283

由于某种原因，数据库被锁定。这是我修复它的方法。

1.  我将 sqlite 文件下载到我的系统（FTP）
2.  删除了网上的sqlite文件
3.  将文件上传回托管服务提供商

它现在工作正常。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2016-04-22T17:54:05.780

就我而言，我也遇到了这个错误。

我已经检查了可能导致数据库锁定的其他进程，例如（SQLite 管理器，连接到我的数据库的其他程序）。但是没有其他程序可以连接到它，它只是同一个应用程序中的另一个活动**SQLConnection**保持**连接**。

> **在建立新的 SQLConnection**和**新的命令**之前，请尝试检查您之前可能仍处于连接状态的**活动 SQLConnection** （先断开连接） 。

 ***** * *

## 回答 #35

> 赞同：0
> 
> 时间：2016-05-30T08:30:30.810

这是因为该数据库上正在运行一些其他查询。SQLite 是一个查询同步执行的数据库。因此，如果其他人正在使用该数据库，那么如果您执行查询或事务，则会出现此错误。

因此，停止使用特定数据库的进程，然后执行您的查询。

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2018-12-13T10:58:40.220

我在尝试写入数据时构建的 C# .NET 4.6.1 应用程序中也收到了 sqlite 锁，但在我的开发机器上的 Visual Studio 中运行该应用程序时没有。相反，只有在远程 Windows 10 机器上安装并运行应用程序时才会发生这种情况。

最初我以为是文件系统权限，但结果是我使用 Nuget 在项目中安装的 System.Data.SQLite 包驱动程序（v1.0.109.2）导致了问题。我删除了 NuGet 包，并在项目中手动引用了旧版本的驱动程序，一旦在远程计算机上重新安装了应用程序，锁定问题就神奇地消失了。只能认为最新的驱动程序或 Nuget 包存在错误。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2020-11-06T14:34:51.400

我运行了“DB Browser for SQLite”工具，并且也在其中工作。显然，该工具也会锁定事物。点击“Write Changes”或“Revert Changes”后，锁定消失了，其他进程（A React-Native 脚本）不再给出该错误。

[![SQLite 数据库浏览器 - 写入更改](https://i.stack.imgur.com/mX4kd.png)](https://i.stack.imgur.com/mX4kd.png)

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2021-10-02T19:51:06.827

我在 Google Chrome 中查看存储的密码时遇到了这个错误。

```
# ~/.config/google-chrome/Default
$ sqlite3 Login\ Data
SQLite version 3.35.5 2021-04-19 18:32:05
sqlite> .tables
Error: database is locked 
```

如果您不特别关心父进程，或者您不想停止正在使用数据库的当前 chrome 进程，只需将文件复制到其他位置即可。

```
$ cp Login\ Data ~/tmp/ld.sql
$ sqlite3 ~/tmp/ld.sql .tables
field_info              meta   sync_model_metadata   
insecure_credentials    stats                 
logins                  sync_entities_metadata 
```

这样做将允许您在不干扰或停止主 chrome 进程的情况下读取数据库的内容。

# ruby-on-rails - 如何在 Ruby on Rails 的控制台中调用控制器/视图辅助方法？

> ID：151030
> 
> 赞同：458
> 
> 时间：2008-09-29T22:36:21.910
> 
> 标签：ruby-on-rails, console

当我加载时`script/console`，有时我想使用控制器或视图辅助方法的输出。

有没有办法：

*   模拟请求？
*   根据所述请求从控制器实例调用方法？
*   通过所述控制器实例或其他方式测试辅助方法？

* * *

## 回答 #1

> 赞同：488
> 
> 时间：2009-07-21T19:15:06.960

要调用助手，请使用`helper`对象：

```
$ ./script/console
>> helper.number_to_currency('123.45')
=> "R$ 123,45" 
```

如果您想使用默认不包含的帮助器（例如，因为您`helper :all`从中删除`ApplicationController`），只需包含该帮助器。

```
>> include BogusHelper
>> helper.bogus
=> "bogus output" 
```

至于处理**控制器**，我引用[尼克的](https://stackoverflow.com/questions/151030/how-do-i-call-controller-view-methods-from-the-console-in-rails/1436342#1436342)回答：

> ```
> > app.get '/posts/1'
> > response = app.response
> # you now have a rails response object much like the integration tests
> 
> > response.body            # get you the HTML
> > response.cookies         # hash of the cookies
> 
> # etc, etc 
> ```

* * *

## 回答 #2

> 赞同：152
> 
> 时间：2009-09-17T01:40:23.927

从脚本/控制台调用控制器操作并查看/操作响应对象的简单方法是：

```
> app.get '/posts/1'
> response = app.response
# You now have a Ruby on Rails response object much like the integration tests

> response.body            # Get you the HTML
> response.cookies         # Hash of the cookies

# etc., etc. 
```

app 对象是[ActionController::Integration::Session的一个实例](http://api.rubyonrails.org/classes/ActionDispatch/Integration/Session.html)

这适用于我使用 Ruby on Rails 2.1 和 2.3，我没有尝试早期版本。

* * *

## 回答 #3

> 赞同：115
> 
> 时间：2012-02-06T12:07:31.040

如果您需要从控制台进行测试（在 Ruby on Rails 3.1 和 4.1 上测试）：

调用控制器操作：

```
app.get '/'
   app.response
   app.response.headers  # => { "Content-Type"=>"text/html", ... }
   app.response.body     # => "<!DOCTYPE html>\n<html>\n\n<head>\n..." 
```

应用控制器方法：

```
foo = ActionController::Base::ApplicationController.new
foo.public_methods(true||false).sort
foo.some_method 
```

路线助手：

```
app.myresource_path     # => "/myresource"
app.myresource_url      # => "http://www.example.com/myresource" 
```

查看助手：

```
foo = ActionView::Base.new

foo.javascript_include_tag 'myscript' #=> "<script src=\"/javascripts/myscript.js\"></script>"

helper.link_to "foo", "bar" #=> "<a href=\"bar\">foo</a>"

ActionController::Base.helpers.image_tag('logo.png')  #=> "<img alt=\"Logo\" src=\"/images/logo.png\" />" 
```

使成为：

```
views = Rails::Application::Configuration.new(Rails.root).paths["app/views"]
views_helper = ActionView::Base.new views
views_helper.render 'myview/mytemplate'
views_helper.render file: 'myview/_mypartial', locals: {my_var: "display:block;"}
views_helper.assets_prefix  #=> '/assets' 
```

主动支持方法：

```
require 'active_support/all'
1.week.ago
=> 2013-08-31 10:07:26 -0300
a = {'a'=>123}
a.symbolize_keys
=> {:a=>123} 
```

库模块：

```
> require 'my_utils'
 => true
> include MyUtils
 => Object
> MyUtils.say "hi"
evaluate: hi
 => true 
```

* * *

## 回答 #4

> 赞同：77
> 
> 时间：2008-09-30T00:19:53.813

这是通过控制台执行此操作的一种方法：

```
>> foo = ActionView::Base.new
=> #<ActionView::Base:0x2aaab0ac2af8 @assigns_added=nil, @assigns={}, @helpers=#<ActionView::Base::ProxyModule:0x2aaab0ac2a58>, @controller=nil, @view_paths=[]>

>> foo.extend YourHelperModule
=> #<ActionView::Base:0x2aaab0ac2af8 @assigns_added=nil, @assigns={}, @helpers=#<ActionView::Base::ProxyModule:0x2aaab0ac2a58>, @controller=nil, @view_paths=[]>

>> foo.your_helper_method(args)
=> "<html>created by your helper</html>" 
```

创建一个新的实例可以`ActionView::Base`让你访问你的助手可能使用的普通视图方法。然后扩展`YourHelperModule`将其方法混合到您的对象中，让您查看它们的返回值。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2011-06-22T07:02:12.737

如果方法是`POST`方法，那么：

```
app.post 'controller/action?parameter1=value1&parameter2=value2' 
```

（此处的参数将根据您的适用性而定。）

否则，如果是`GET`方法，则：

```
app.get 'controller/action' 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2009-01-31T14:27:54.667

另一种方法是使用 Ruby on Rails 调试器。[在http://guides.rubyonrails.org/debugging_rails_applications.html](http://guides.rubyonrails.org/debugging_rails_applications.html)上有一个关于调试的 Ruby on Rails 指南

基本上，使用 -u 选项启动服务器：

```
./script/server -u 
```

然后在您希望访问控制器、助手等的脚本中插入一个断点。

```
class EventsController < ApplicationController
  def index
    debugger
  end
end 
```

当您发出请求并点击代码中的该部分时，服务器控制台将返回一个提示，您可以在其中从命令提示符发出请求、查看对象等。完成后，只需键入“cont”继续执行。还有扩展调试的选项，但这至少应该让你开始。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2013-10-30T11:22:39.303

您可以在 Ruby on Rails 控制台中访问您的方法，如下所示：

```
controller.method_name
helper.method_name 
```

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2014-05-27T22:02:14.490

以下是如何发出经过身份验证的 POST 请求，以 Refinery 为例：

```
# Start Rails console
rails console
# Get the login form
app.get '/community_members/sign_in'
# View the session
app.session.to_hash
# Copy the CSRF token "_csrf_token" and place it in the login request.
# Log in from the console to create a session
app.post '/community_members/login', {"authenticity_token"=>"gT7G17RNFaWUDLC6PJGapwHk/OEyYfI1V8yrlg0lHpM=",  "refinery_user[login]"=>'chloe', 'refinery_user[password]'=>'test'}
# View the session to verify CSRF token is the same
app.session.to_hash
# Copy the CSRF token "_csrf_token" and place it in the request. It's best to edit this in Notepad++
app.post '/refinery/blog/posts', {"authenticity_token"=>"gT7G17RNFaWUDLC6PJGapwHk/OEyYfI1V8yrlg0lHpM=", "switch_locale"=>"en", "post"=>{"title"=>"Test", "homepage"=>"0", "featured"=>"0", "magazine"=>"0", "refinery_category_ids"=>["1282"], "body"=>"Tests do a body good.", "custom_teaser"=>"", "draft"=>"0", "tag_list"=>"", "published_at(1i)"=>"2014", "published_at(2i)"=>"5", "published_at(3i)"=>"27", "published_at(4i)"=>"21", "published_at(5i)"=>"20", "custom_url"=>"", "source_url_title"=>"", "source_url"=>"", "user_id"=>"56", "browser_title"=>"", "meta_description"=>""}, "continue_editing"=>"false", "locale"=>:en} 
```

如果您遇到错误，您可能会发现这些也很有用：

```
app.cookies.to_hash
app.flash.to_hash
app.response # long, raw, HTML 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2013-03-29T18:19:13.410

在 Ruby on Rails 3 中，试试这个：

```
session = ActionDispatch::Integration::Session.new(Rails.application)
session.get(url)
body = session.response.body 
```

正文将包含 URL 的 HTML。

*[如何在 Ruby on Rails 3 中从模型路由和渲染（调度）](https://stackoverflow.com/questions/7770119/how-to-route-and-render-dispatch-from-a-model-in-rails-3)*

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2009-07-25T23:58:25.627

较早的答案是调用助手，但以下将有助于调用控制器方法。我在 Ruby on Rails 2.3.2 上使用过这个。

首先将以下代码添加到您的 .irbrc 文件中（可以在您的主目录中）

```
class Object
   def request(options = {})
     url=app.url_for(options)
     app.get(url)
     puts app.html_document.root.to_s
  end
end 
```

然后在 Ruby on Rails 控制台中，您可以键入类似...

```
request(:controller => :show, :action => :show_frontpage) 
```

...并且 HTML 将被转储到控制台。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2019-02-01T09:54:25.153

对于控制器，您可以在 Ruby on Rails 控制台中实例化控制器对象。

例如，

```
class CustomPagesController < ApplicationController

  def index
    @customs = CustomPage.all
  end

  def get_number
    puts "Got the Number"
  end

  protected

  def get_private_number
    puts 'Got private Number'
  end

end

custom = CustomPagesController.new
2.1.5 :011 > custom = CustomPagesController.new
 => #<CustomPagesController:0xb594f77c @_action_has_layout=true, @_routes=nil, @_headers={"Content-Type"=>"text/html"}, @_status=200, @_request=nil, @_response=nil>
2.1.5 :014 > custom.get_number
Got the Number
 => nil

# For calling private or protected methods,
2.1.5 :048 > custom.send(:get_private_number)
Got private Number
 => nil 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2017-12-24T07:18:48.223

在任何控制器操作或视图中，您都可以通过调用**控制台**方法来调用控制台。

例如，在控制器中：

```
class PostsController < ApplicationController
  def new
    console
    @post = Post.new
  end
end 
```

或者在一个视图中：

```
<% console %>

<h2>New Post</h2> 
```

这将在您的视图中呈现一个控制台。您无需关心控制台调用的位置；它不会在调用时呈现，而是在您的 HTML 内容旁边呈现。

见： http: [//guides.rubyonrails.org/debugging_rails_applications.html](http://guides.rubyonrails.org/debugging_rails_applications.html)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2016-06-15T08:57:31.720

在 Ruby on Rails 控制台中进行 Helper 方法测试的一种可能方法是：

```
Struct.new(:t).extend(YourHelper).your_method(*arg) 
```

对于重新加载，请执行以下操作：

```
reload!; Struct.new(:t).extend(YourHelper).your_method(*arg) 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2018-01-08T07:15:27.923

如果您添加了自己的助手并且希望其方法在控制台中可用，请执行以下操作：

1.  在控制台执行`include YourHelperName`
2.  您的辅助方法现在在控制台中可用，并在控制台中使用它们调用`method_name(args)`。

示例：假设您在“app/helpers/my_helper.rb”中有 MyHelper（带有方法`my_method`），然后在控制台中执行：

1.  `include MyHelper`
2.  `my_helper.my_method`

# testing - 您如何为开源项目征集测试人员？

> ID：151033
> 
> 赞同：1
> 
> 时间：2008-09-29T22:37:53.170
> 
> 标签：testing, open-source

为了改进我的开源项目，我需要测试人员。我已经独立创建了我的项目，所以到目前为止我一直是唯一的编码员和测试员。我已经测试了这个东西，但众所周知，作为开发人员测试自己的代码是危险的。我正在寻找有关如何让其他眼睛锻炼它的想法。

* * *

澄清一下，我已经在 sourceforge 上发布了它，并在freshmeat、dzone、reddit 等上发布了它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T23:40:21.537

您在寻找“测试人员”还是“用户”？有天壤之别。

测试人员会花费*他的*时间和精力来查找*您的*错误。有多少人愿意这样做？粗略的猜测，我会说零。

用户使用*您的*软件来解决*他的*问题。他向您报告错误，因为他认为您可以为他修复它们。所以你必须找到有问题的人，并说服他们你的软件会解决它。

您需要的一件事是大量文档。1 分钟的截屏视频、深入的 API 以及介于两者之间的所有内容。你需要说服某人，“如果我使用毒药，我会彻底**摇滚**！”

那是你的测试员。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T22:41:13.850

发布早期版本，在[freshmeat](http://freshmeat.net/)上宣布，等待世界为您开辟道路？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T13:58:32.480

去测试人员所在的地方。查找测试人员所在的站点。[http://www.stickyminds.com](http://www.stickyminds.com)，本地 QA 小组（如我的）[http://redearthqa.blogspot.com/](http://redearthqa.blogspot.com/)或有 QA 人员正在寻找经验的本地招聘人员。

# eclipse - Eclipse 编辑器是否有等效于 Emacs 的“align-regex”？

> ID：151034
> 
> 赞同：16
> 
> 时间：2008-09-29T22:37:54.653
> 
> 标签：eclipse, emacs

几年来，我一直在定期使用 Eclipse，但我承认没有探索过它所提供的所有奥秘，尤其是在编辑器提供的格式化功能方面。

我从 (X)emacs 中错过的主要内容是“align-regex”命令，它让我将几行放入一个区域，然后格式化它们，以便对齐所有行中的一些常见模式。最简单的例子是一系列变量赋值：

```
var str = new String('aString');
var index = 0;
var longCamelCaseObjectName = new LongNameObject(); 
```

在“=”上执行 align-regex 后，将变为：

```
var str                     = new String('aString');
var index                   = 0;
var longCamelCaseObjectName = new LongNameObject(); 
```

现在，您可能对样式（ab）使用空白和对齐等有自己的想法，但这只是一个示例（我实际上是在尝试完全对齐另一种混乱）。

谁能告诉我在 Eclipse 中是否有一个简单的组合键快捷方式？或者甚至是一个中等难度的？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-29T23:11:27.240

您可以设置格式化程序来执行此操作：

首选项 -> Java -> 代码样式 -> 格式化程序。单击配置文件上的“编辑”（您可能需要创建一个新的，因为您无法编辑默认值）。

在缩进部分中选择“将字段与列对齐”。

然后，在您的代码中++`CTRL`将运行该格式化程序。`SHIFT``F`

这当然会运行所有其他规则，因此您可能需要仔细阅读此处的各种选项。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-03-14T22:38:23.590

Emacs+ 插件的 2.8.7 版现在在 Eclipse 中提供了一个相当完整的 align-regexp 实现

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T23:14:41.740

如果您希望做一些比对齐字段（或 Eclipse 代码格式化程序为您提供的任何其他东西）更复杂的事情，您几乎必须编写自己的插件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-10-11T17:26:12.653

[columns4eclipse](http://columns4eclipse.sourceforge.net/)是一个不错的选择。它是一个 Eclipse 插件，可让您进行问题中提到的对齐。我将它与 Eclipse 4.3 和 4.5 一起使用，效果很好。我制作了一个 gif 视频来展示它的用途，但是我的答案被一个 mod 删除了，所以我让你自己试试看。

[![在此处输入图像描述](https://i.stack.imgur.com/opbUf.png)](https://i.stack.imgur.com/opbUf.png)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-06-06T08:16:24.223

这个插件正是你想要的：[OCDFormat](https://github.com/eduardp/OCDFormat/)

它适用于所有文本文件，而不仅仅是 Java。

# c++ - 如何检测 std::map 循环中的最后一次迭代？

> ID：151046
> 
> 赞同：29
> 
> 时间：2008-09-29T22:40:59.560
> 
> 标签：c++, stl, iterator, maps

我试图找出最好的方法来确定我是否处于地图上循环的最后一次迭代中，以便执行以下操作：

```
for (iter = someMap.begin(); iter != someMap.end(); ++iter) {
    bool last_iteration;
    // do something for all iterations
    if (!last_iteration) {
        // do something for all but the last iteration
    }
} 
```

似乎有几种方法可以做到这一点：随机访问迭代器、`distance`函数等。规范方法是什么？

编辑：地图没有随机访问迭代器！

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-29T22:49:41.440

典范？我不能这么说，但我建议

```
final_iter = someMap.end();
--final_iter;
if (iter != final_iter) ... 
```

****[按照KTC](https://stackoverflow.com/questions/151046/c-last-loop-iteration-stl-map-iterator#151104)****的建议进行编辑**以更正**。**（谢谢！有时你走得太快，把最简单的事情搞砸了……）**

 *** * *

## 回答 #2

> 赞同：23
> 
> 时间：2015-12-11T11:13:35.823

从 C++11 开始，您还可以使用 std::next()

```
 for (auto iter = someMap.begin(); iter != someMap.end(); ++iter) { 
        // do something for all iterations
        if (std::next(iter) != someMap.end()) {
            // do something for all but the last iteration
        }
    } 
```

虽然这个问题是不久前提出的，但我认为值得分享。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-09-29T22:47:19.857

这似乎是最简单的：

```
bool last_iteration = iter == (--someMap.end()); 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-30T11:54:13.757

如果您只想使用 ForwardIterator，这应该可以工作：

```
for ( i = c.begin(); i != c.end(); ) {
        iterator cur = i++;
        // do something, using cur
        if ( i != c.end() ) {
                // do something using cur for all but the last iteration
        }
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-29T22:57:57.367

修改了 Mark Ransom 的，所以它实际上按预期工作。

```
finalIter = someMap.end();
--finalIter;
if (iter != final_iter) 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-01-30T10:28:32.920

很惊讶没有人提到它，但当然 boost 有一些东西 ;)

[Boost.Next](http://www.boost.org/doc/libs/1_37_0/libs/utility/utility.htm#functions_next_prior)（和等效的 Boost.Prior）

您的示例如下所示：

```
for (iter = someMap.begin(); iter != someMap.end(); ++iter) {
    // do something for all iterations
    if (boost::next(iter) != someMap.end()) {
        // do something for all but the last iteration
    }
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-12-08T12:47:57.817

以下代码将由编译器进行优化，以便在性能和 OOP 规则方面成为该任务的最佳解决方案：

```
if (&*it == &*someMap.rbegin()) {
    //the last iteration
} 
```

这是 OOP 规则中最好的代码，因为 std::map 有一个特殊的成员函数 rbegin 用于如下代码：

```
final_iter = someMap.end();
--final_iter; 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2013-04-06T05:48:13.893

为什么要努力找到EOF，这样你就不会给它一些东西。

**简单地说，排除它；**

```
for (iter = someMap.begin(); someMap.end() - 1; ++iter) {
    //apply to all from begin to second last element
} 
```

**亲吻（保持简单）**

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-30T02:08:37.047

```
#include <boost/lambda/lambda.hpp>
#include <boost/lambda/bind.hpp>
#include <algorithm>

using namespace boost::lambda;

// call the function foo on each element but the last...
if( !someMap.empty() )
{
  std::for_each( someMap.begin(), --someMap.end(), bind( &Foo, _1 ) );
} 
```

使用 std::for_each 将确保循环紧凑且准确...注意函数 foo() 的引入，该函数采用单个参数（类型应与 someMap 中包含的内容匹配）。这种方法增加了 1 行。当然，如果 Foo 真的很小，您可以使用 lambda 函数并摆脱对 &Foo 的调用。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-11-02T10:34:30.807

这个怎么样，没有人说，但是...

```
for (iter = someMap.begin(); iter != someMap.end(); ++iter) {
    // do something for all iterations
    if (iter != --someMap.end()) {
        // do something for all but the last iteration
    }
} 
```

这看起来很简单，嗯...

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-12-05T04:17:45.030

对于喜欢 C++11 基于范围的循环的人：

```
 for (const auto& pair : someMap) {
      if (&pair != &*someMap.rbegin()) ...
    } 
```

注意只有引用类型在这里有效，而不是`auto pair`

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-29T23:01:10.057

一个简单但有效的方法：

```
 size_t items_remaining = someMap.size();

  for (iter = someMap.begin(); iter != someMap.end(); iter++) {
    bool last_iteration = items_remaining-- == 1;
  } 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-09-29T23:20:15.813

完整程序：

```
#include <iostream>
#include <list>

void process(int ii)
{
   std::cout << " " << ii;
}

int main(void)
{
   std::list<int> ll;

   ll.push_back(1);
   ll.push_back(2);
   ll.push_back(3);
   ll.push_back(4);
   ll.push_back(5);
   ll.push_back(6);

   std::list<int>::iterator iter = ll.begin();
   if (iter != ll.end())
   {
      std::list<int>::iterator lastIter = iter;
      ++ iter;
      while (iter != ll.end())
      {
         process(*lastIter);
         lastIter = iter;
         ++ iter;
      }
      // todo: think if you need to process *lastIter
      std::cout << " | last:";
      process(*lastIter);
   }

   std::cout << std::endl;

   return 0;
} 
```

该程序产生：

```
 1 2 3 4 5 | last: 6 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-10-01T05:10:19.223

这是我的优化：

```
iter = someMap.begin();

do {
    // Note that curr = iter++ may involve up to three copy operations
    curr = iter;

    // Do stuff with curr

    if (++iter == someMap.end()) {
        // Oh, this was the last iteration
        break;
    }

    // Do more stuff with curr

} while (true); 
```

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2008-09-29T22:47:57.453

您可以在迭代之前将元素从地图中拉出，然后在循环之外执行“最后一次迭代”工作，然后将元素放回*地图*中。这对于异步代码来说是非常糟糕的，但是考虑到 C++ 的其余部分对于并发性有多糟糕，我认为这不会是一个问题。:-)

# c# - 我什么时候应该使用 GC.SuppressFinalize()？

> ID：151051
> 
> 赞同：339
> 
> 时间：2008-09-29T22:41:40.197
> 
> 标签：c#, .net, garbage-collection, idisposable, suppressfinalize

在 .NET 中，我应该在什么情况下使用`GC.SuppressFinalize()`?

使用这种方法能给我带来什么好处？

* * *

## 回答 #1

> 赞同：343
> 
> 时间：2008-09-29T23:56:03.623

`SuppressFinalize`只能由具有终结器的类调用。它通知垃圾收集器（GC）`this`对象已被完全清理。

`IDisposable`当你有一个终结器时推荐的模式是：

```
public class MyClass : IDisposable
{
    private bool disposed = false;

    protected virtual void Dispose(bool disposing)
    {
        if (!disposed)
        {
            if (disposing)
            {
                // called via myClass.Dispose(). 
                // OK to use any private object references
            }
            // Release unmanaged resources.
            // Set large fields to null.                
            disposed = true;
        }
    }

    public void Dispose() // Implement IDisposable
    {
        Dispose(true);
        GC.SuppressFinalize(this);
    }

    ~MyClass() // the finalizer
    {
        Dispose(false);
    }
} 
```

通常，CLR 在创建对象时会使用终结器对对象进行标记（使创建它们的成本更高）。`SuppressFinalize`告诉 GC 对象已正确清理，不需要进入终结器队列。它看起来像一个 C++ 析构函数，但不像一个析构函数。

优化并非微不足道，因为您的`SuppressFinalize`对象可以在终结器队列中等待很长时间。不要试图调用`SuppressFinalize`其他对象，请注意。这是一个等待发生的严重缺陷。

设计指南告诉我们，如果您的对象实现了终结器，则不需要终结器`IDisposable`，但如果您有终结器，则应该实现`IDisposable`以允许对您的类进行确定性清理。

大多数时候，您应该能够侥幸`IDisposable`清理资源。当你的对象持有非托管资源并且你需要保证这些资源被清理时，你应该只需要一个终结器。

注意：有时编码人员会添加一个终结器来调试他们自己的`IDisposable`类的构建，以测试代码是否`IDisposable`正确地处理了他们的对象。

```
public void Dispose() // Implement IDisposable
{
    Dispose(true);
#if DEBUG
    GC.SuppressFinalize(this);
#endif
}

#if DEBUG
~MyClass() // the finalizer
{
    Dispose(false);
}
#endif 
```

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-09-29T22:44:21.593

`SupressFinalize`告诉系统在终结器中已经完成的任何工作都已经完成，因此不需要调用终结器。来自 .NET 文档：

> 实现 IDisposable 接口的对象可以从 IDisposable.Dispose 方法调用此方法，以防止垃圾收集器对不需要它的对象调用 Object.Finalize。

一般来说，大多数任何`Dispose()`方法都应该能够调用`GC.SupressFinalize()`，因为它应该清理所有将在终结器中清理的内容。

`SupressFinalize`只是提供了一种优化，使系统不必费心将对象排队到终结器线程。正确编写的`Dispose()`/finalizer 在调用或不调用`GC.SupressFinalize()`.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2018-04-16T01:54:03.387

```
Dispose(true);
GC.SuppressFinalize(this); 
```

如果对象有终结器，.net 会在终结队列中放置一个引用。

由于我们有 call `Dispose(true)`，它清除对象，所以我们不需要完成队列来完成这项工作。

所以在完成队列中调用`GC.SuppressFinalize(this)`删除引用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-04-26T23:05:22.277

如果一个类或从它派生的任何东西可能持有对具有终结器的对象的最后一个实时引用，那么在任何可能受到该终结器不利影响的操作之后对该对象调用`GC.SuppressFinalize(this)`或`GC.KeepAlive(this)`应该调用该对象，从而确保终结器获胜'直到该操作完成后才运行。

`GC.KeepAlive()`和`GC.SuppressFinalize(this)`在任何没有终结器的类中的成本基本相同，并且具有终结器的类通常应该调用`GC.SuppressFinalize(this)`，因此使用后一个函数作为最后一步`Dispose()`可能并不总是必要的，但它不会是错的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T22:44:11.703

必须在`Dispose`实现 的对象的方法上调用该方法，`IDisposable`这样如果有人调用该`Dispose`方法，GC 就不会再次调用终结器。

请参阅：[GC.SuppressFinalize(Object) 方法 - Microsoft Docs](https://docs.microsoft.com/en-us/dotnet/api/system.gc.suppressfinalize)

# ruby-on-rails - 如何在 Ruby on Rails 中实现特定于部分的导航？

> ID：151066
> 
> 赞同：12
> 
> 时间：2008-09-29T22:45:57.550
> 
> 标签：ruby-on-rails, ruby, templates, actionview

我有一个 Ruby/Rails 应用程序，它有两个或三个主要“部分”。当用户访问该部分时，我希望显示一些子导航。所有三个部分都使用相同的布局，所以我不能将导航“硬编码”到布局中。

我可以想到几种不同的方法来做到这一点。我想为了帮助人们投票，我会把它们作为答案。

还有其他想法吗？或者你投什么票？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-01T13:01:46.767

假设每个部分都有自己的控制器，您可以使用部分轻松地做到这一点。

假设您有三个部分，分别称为**Posts**、**Users**和**Admin**，每个部分都有自己的控制器`PostsController`：`UsersController`和`AdminController`。

在每个相应`views`的目录中，您声明一个`_subnav.html.erb`部分：

```
/app/views/users/_subnav.html.erb
/app/views/posts/_subnav.html.erb
/app/views/admin/_subnav.html.erb

```

在每个子导航部分中，您声明特定于该部分的选项，因此`/users/_subnav.html.erb`可能包含：

```
<ul id="subnav">
  <li><%= link_to 'All Users', users_path %></li>
  <li><%= link_to 'New User', new_user_path %></li>
</ul> 
```

虽然`/posts/_subnav.html.erb`可能包含：

```
<ul id="subnav">
  <li><%= link_to 'All Posts', posts_path %></li>
  <li><%= link_to 'New Post', new_post_path %></li>
</ul> 
```

最后，一旦你完成了这个，你只需要在布局中包含 subnav 部分：

```
<div id="header">...</div>    
<%= render :partial => "subnav" %>
<div id="content"><%= yield %></div>
<div id="footer">...</div> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-29T22:46:28.827

3.  **部分渲染**。这与辅助方法非常相似，只是布局可能会有一些 if 语句，或者将其传递给辅助方法......

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-30T00:32:49.417

至于子菜单的内容，您可以在每个控制器中以声明的方式进行处理。

```
class PostsController < ApplicationController
#...
protected
  helper_method :menu_items
  def menu_items
    [
      ['Submenu 1', url_for(me)],
      ['Submenu 2', url_for(you)]
    ]
  end
end 
```

现在，每当您从视图调用 menu_items 时，您将拥有正确的列表来迭代特定控制器。

这让我觉得这是一个比将这个逻辑放在视图模板中更简洁的解决方案。

请注意，您可能还想在 ApplicationController 中声明一个默认（空？）menu_items。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-30T08:12:52.710

**警告：前方有高级技巧！**

*全部渲染*。使用 CSS/Javascript 隐藏您不需要的那些，可以通过多种方式轻松初始化。（Javascript 可以读取使用的 URL、查询参数、cookie 中的某些内容等）这具有可能更好地使用缓存的优势（为什么缓存三个视图，然后当您可以缓存一个视图时必须同时使它们全部过期） ?)，并且可以用来呈现更好的用户体验。

**例如**，假设您有一个带有子导航的通用标签栏界面。如果您呈现所有三个选项卡的内容（即它以 HTML 编写）并隐藏其中两个，则在两个选项卡之间切换是微不足道的 Javascript，**甚至不会影响您的服务器**。大胜！用户没有延迟。没有服务器负载。

想要**另一个大胜利**？您可以使用此技术的变体来欺骗可能在用户中 99% 常见但仍包含用户状态的页面。例如，您可能有一个网站的首页，该页面在所有用户中相对常见，但在他们登录时会说“Hiya Bob”。将非常见部分（“Hiya，Bob”）放入 cookie 中。让页面的那部分通过 Javascript 读取 cookie 被读取。 ***无论页面缓存中的登录状态如何，都*****为所有用户缓存整个页面。** *这实际上能够在某些站点上从整个 Rails 堆栈中切出 70% 的访问。*

 *当你的网站真的是 Nginx 提供静态资产时，谁在乎 Rails 是否可以扩展，新的 HTML 页面偶尔会由一些运行在每千次访问左右的 Ruby 交付；）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T00:06:22.787

[您可以在http://rpheath.com/posts/309-rails-plugin-navigation-helper](http://rpheath.com/posts/309-rails-plugin-navigation-helper)使用类似导航插件的东西

它没有开箱即用的子部分导航，但稍作调整，您可能可以将其设置为执行类似的操作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T00:23:12.497

我建议你使用部分。有几种方法可以解决。当我创建需要特定变量的部分有点挑剔时，我还为它创建了一个辅助方法。

```
module RenderHelper
  #options: a nested array of menu names and their corresponding url
  def render_submenu(menu_items=[[]])
    render :partial => 'shared/submenu', :locals => {:menu_items => menu_items}
  end
end 
```

现在，partial 有一个名为 menu_items 的局部变量，您可以对其进行迭代以创建子菜单。请注意，我建议使用嵌套数组而不是散列，因为散列的顺序是不可预测的。

请注意，决定哪些项目应在菜单中显示的逻辑也可以在 render_submenu 中，如果这对您更有意义的话。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-01T10:16:05.027

我自己也问了几乎相同的问题：[需要建议：子菜单的 Rails 视图结构？](https://stackoverflow.com/questions/126238/need-advice-structure-of-rails-views-for-submenus)最好的解决方案可能是使用部分。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-01T12:45:21.330

还有另一种可能的方法：嵌套布局

我不记得我在哪里找到了这段代码，所以向原作者道歉。

在您的 lib 文件夹中创建一个名为 nested_layouts.rb 的文件，并包含以下代码：

```
module NestedLayouts
  def render(options = nil, &block)
    if options
      if options[:layout].is_a?(Array)
        layouts = options.delete(:layout)
        options[:layout] = layouts.pop
        inner_layout = layouts.shift
        options[:text] = layouts.inject(render_to_string(options.merge({:layout=>inner_layout}))) do |output,layout|
          render_to_string(options.merge({:text => output, :layout => layout}))
        end
      end
    end
    super
  end
end 
```

然后，在布局文件夹中创建各种布局（例如“admin.rhtml”和“application.rhtml”）。

现在在您的控制器中将其添加到类中：

```
include NestedLayouts 
```

最后，在您的操作结束时执行以下操作：

```
def show
  ...
  render :layout => ['admin','application']
end 
```

数组中布局的顺序很重要。无论 'yeild' 在哪里，管理布局都将呈现在应用程序布局中。

这种方法可以很好地工作，具体取决于网站的设计以及各种元素的组织方式。例如，其中一个包含的布局可能只包含一系列 div，其中包含需要为特定操作显示的内容，而更高布局上的 CSS 可以控制它们的位置。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-26T20:08:07.897

解决这个问题的方法很少。

您可能希望为每个部分使用不同的布局。

您可能希望使用给定目录中所有视图包含的部分。

您可能希望使用`content_for`由视图或部分填充的视图，并在全局布局中调用（如果有的话）。

我个人认为在这种情况下你应该避免更多的抽象。

# http - “名称” web pdf 以在 Acrobat 中获得更好的默认保存文件名？

> ID：151079
> 
> 赞同：43
> 
> 时间：2008-09-29T22:49:44.640
> 
> 标签：http, pdf, content-type, acrobat

我的应用程序生成 PDF 供用户使用。“Content-Disposition”http 标头的设置如此[处](https://stackoverflow.com/questions/74019/specifying-filename-for-dynamic-pdf-in-aspnet)所述。这设置为“inline; filename=foo.pdf”，这足以让 Acrobat 在保存 pdf 时将“foo.pdf”作为文件名。

但是，单击嵌入浏览器的 Acrobat 中的“保存”按钮后，要保存的默认名称不是该文件名，而是带有斜杠的 URL 更改为下划线。又大又丑。有没有办法影响 Adob​​e 中的这个默认文件名？

URL 中有一个查询字符串，这是不可协商的。这可能很重要，但在 URL 末尾添加“&foo=/title.pdf”不会影响默认文件名。

更新2：我都试过了

```
content-disposition  inline; filename=foo.pdf
Content-Type         application/pdf; filename=foo.pdf 
```

和

```
content-disposition  inline; filename=foo.pdf
Content-Type         application/pdf; name=foo.pdf 
```

（通过 Firebug 验证）遗憾的是，两者都不起作用。

示例网址是

```
/bar/sessions/958d8a22-0/views/1493881172/export?format=application/pdf&no-attachment=true
```

转换为默认的 Acrobat 保存为文件名

```
http___localhost_bar_sessions_958d8a22-0_views_1493881172_export_format=application_pdf&no-attachment=true.pdf
```

更新 3：Julian Reschke 为这个案例带来了真正的洞察力和严谨性。请点赞他的回答。这似乎在 FF ( [https://bugzilla.mozilla.org/show_bug.cgi?id=433613](https://bugzilla.mozilla.org/show_bug.cgi?id=433613) ) 和 IE 中被破坏，但在 Opera、Safari 和 Chrome 中有效。[http://greenbytes.de/tech/tc2231/#inlwithasciifilenamepdf](http://greenbytes.de/tech/tc2231/#inlwithasciifilenamepdf)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-30T00:28:57.957

还要在**ContentType**中设置**文件名**。这应该可以解决问题。

 **```
context.Response.ContentType = "application/pdf; name=" + fileName;
// the usual stuff
context.Response.AddHeader("content-disposition", "inline; filename=" + fileName); 
```

设置 content-disposition 标头后，还要添加 content-length 标头，然后使用 binarywrite 流式传输 PDF。

```
context.Response.AddHeader("Content-Length", fileBytes.Length.ToString());
context.Response.BinaryWrite(fileBytes); 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-21T11:20:48.147

部分问题在于相关的 [RFC 2183](http://greenbytes.de/tech/webdav/rfc2183.html)并没有真正说明如何处理“内联”处置类型和文件名。

此外，据我所知，唯一真正使用 type=inline 文件名的 UA 是 Firefox（请参阅[测试用例](http://greenbytes.de/tech/tc2231/#inlwithasciifilename)）。

最后，插件 API 是否确实提供了这些信息并不明显（也许熟悉 API 的人可以详细说明）。

话虽如此，我已向 Adob​​e 人员发送了指向此问题的指针；也许合适的人会看看。

相关：请参阅在[draft-reschke-rfc2183-in-http](http://greenbytes.de/tech/webdav/draft-reschke-rfc2183-in-http-latest.html)中澄清 HTTP 中的 Content-Disposition 的尝试——这是正在进行的早期工作，感谢反馈。

更新：我添加了一个[测试用例](http://greenbytes.de/tech/tc2231/#inlwithasciifilenamepdf)，这似乎表明 Acrobat 阅读器插件不使用响应标头（在 Firefox 中），尽管插件 API 提供了对它们的访问。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-03T22:47:26.610

像你一样，我尝试并尝试让它发挥作用。最后我放弃了这个想法，只是选择了一种解决方法。

我正在使用 ASP.NET MVC 框架，因此我修改了该控制器/操作的路由，以确保提供的 PDF 文件是 URI 位置部分的最后一部分（在查询字符串之前），并传递所有内容else 在查询字符串中。

例如：

旧 URI：

[http://server/app/report/showpdf?param1=foo¶m2=bar&filename=myreport.pdf](http://server/app/report/showpdf?param1=foo&param2=bar&filename=myreport.pdf)

新的 URI：

[http://server/app/report/showpdf/myreport.pdf?param1=foo¶m2=bar](http://server/app/report/showpdf/myreport.pdf?param1=foo&param2=bar)

生成的标题看起来与您所描述的完全一样（内容类型是 application/pdf，处置是内联的，文件名是标题的无用部分）。Acrobat 在浏览器窗口中显示它（没有另存为对话框），如果用户单击 Acrobat 保存按钮，则自动填充的文件名是报告文件名。

几点考虑：

为了使文件名看起来不错，它们不应该有任何转义字符（即，没有空格等）......这有点限制。在这种情况下，我的文件名是自动生成的，之前其中有空格，在生成的保存对话框文件名中显示为“%20”。我只是用下划线替换了空格，然后就解决了。

这绝不是最好的解决方案，但它确实有效。这也意味着您必须拥有可用的文件名才能使其成为原始 URI 的一部分，这可能会干扰程序的工作流程。如果它当前正在生成 PDF 的服务器端调用期间从数据库中生成或检索，则您可能需要将生成文件名的代码作为表单提交的一部分移动到 javascript，或者如果它来自数据库，则使其成为在构建导致内联 PDF 的 URL 时，快速 ajax 调用以获取文件名。

如果您从表单上的用户输入中获取文件名，那么应该验证它不包含转义字符，这会惹恼用户。

希望有帮助。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-12-02T19:12:57.603

尝试将文件名放在 URL 的末尾，在任何其他参数之前。这对我有用。 [http://www.setasign.de/support/tips-and-tricks/filename-in-browser-plugin/](http://www.setasign.de/support/tips-and-tricks/filename-in-browser-plugin/)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-12-26T16:13:20.417

在 ASP.NET 2.0 中，将 URL 从

```
http://www. server.com/DocServe.aspx?DocId=XXXXXXX 
```

到

```
http://www. server.com/DocServe.aspx/MySaveAsFileName?DocId=XXXXXXX 
```

这适用于 Acrobat 8​​，默认的 SaveAs 文件名现在是`MySaveAsFileName.pdf`.

但是，您必须限制允许的字符`MySaveAsFileName`（无句点等）。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-07-27T23:36:51.583

Apache`mod_rewrite`可以解决这个问题。

我有一个端点为 的 Web 服务`/foo/getDoc.service`。当然 Acrobat 会将文件另存为`getDoc.pdf`. 我在中添加了以下几行`apache.conf`：

```
LoadModule     RewriteModule         modules/mod_rewrite.so
RewriteEngine  on
RewriteRule    ^/foo/getDoc/(.*)$    /foo/getDoc.service     [P,NE] 
```

现在，当我请求时`/foo/getDoc/filename.pdf?bar&qux`，它在内部被重写为`/foo/getDoc.service?bar&qux`，因此我访问了 Web 服务的正确端点，但 Acrobat 认为它将我的文件保存为`filename.pdf`.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-22T14:35:17.197

如果您使用asp.net，您可以通过页面（url）文件名控制pdf文件名。正如其他用户所写，Acrobat 有点...当您按“保存”按钮选择 pdf 文件名时：它采用页面名称，删除扩展名并添加“.pdf”。所以 /foo/bar/GetMyPdf.aspx 给出了 GetMyPdf.pdf。

我找到的唯一解决方案是通过 asp.net 处理程序管理“动态”页面名称：

*   创建一个实现 IHttpHandler 的类
*   将 web.config 中的处理程序映射到类

Mapping1：所有页面都有一个共同的基数（MyDocument_）：

```
<httpHandlers>  
<add verb="*" path="MyDocument_*.ashx" type="ITextMiscWeb.MyDocumentHandler"/> 
```

Mapping2：完全免费的文件名（路径中需要一个文件夹）：

```
<add verb="*" path="/CustomName/*.ashx" type="ITextMiscWeb.MyDocumentHandler"/> 
```

这里有一些提示（pdf 是使用 iTextSharp 动态创建的）： http:
[//fhtino.blogspot.com/2006/11/how-to-show-or-download-pdf-file-from.html](http://fhtino.blogspot.com/2006/11/how-to-show-or-download-pdf-file-from.html)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-30T01:54:04.323

您可以尝试内联而不是附件：

```
Response.AddHeader("content-disposition", "inline;filename=MyFile.pdf"); 
```

我在以前的 Web 应用程序中使用内联，该应用程序将 Crystal Reports 输出生成为 PDF 并在浏览器中将其发送给用户。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-14T16:54:24.843

我相信这已经以一种或另一种方式提到过，但我会尝试用我自己的话来陈述它。

而不是这样：

```
/bar/sessions/958d8a22-0/views/1493881172/export?format=application/pdf&no-attachment=true 
```

我用这个：

```
/bar/sessions/958d8a22-0/views/1493881172/NameThatIWantPDFToBe.pdf?GeneratePDF=1 
```

当有请求进来时，我没有让“导出”处理请求，而是在 URL 中查找 GeneratePDF=1。如果找到，我会运行在“导出”中运行的任何代码，而不是让我的系统尝试在 location 中搜索和提供 PDF `/bar/sessions/958d8a22-0/views/1493881172/NameThatIWantPDFToBe.pdf`。如果在 URL 中找不到 GeneratePDF，我只需传输请求的文件。（请注意，我不能简单地重定向到请求的文件 - 否则我会陷入无限循环）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-12-18T07:42:50.937

带有保存和打开选项的文件下载对话框 (PDF)

要记住的要点：

1.  从服务返回具有正确数组大小的流
2.  根据流长度从流中读取具有正确字节长度的字节数组。
3.  设置正确的内容类型

这是读取流的代码并打开 PDF 文件的文件下载对话框

```
private void DownloadSharePointDocument()
{
    Uri uriAddress = new Uri("http://hyddlf5187:900/SharePointDownloadService/FulfillmentDownload.svc/GetDocumentByID/1/drmfree/");
    HttpWebRequest req = WebRequest.Create(uriAddress) as HttpWebRequest;
    // Get response   
    using (HttpWebResponse httpWebResponse = req.GetResponse() as HttpWebResponse)
    {
        Stream stream = httpWebResponse.GetResponseStream();
        int byteCount = Convert.ToInt32(httpWebResponse.ContentLength);
        byte[] Buffer1 = new byte[byteCount];
        using (BinaryReader reader = new BinaryReader(stream))
        {
            Buffer1 = reader.ReadBytes(byteCount);
        }
        Response.Clear();
        Response.ClearHeaders();
        // set the content type to PDF 
        Response.ContentType = "application/pdf";
        Response.AddHeader("Content-Disposition", "attachment;filename=Filename.pdf");
        Response.Buffer = true;
        Response.BinaryWrite(Buffer1);
        Response.Flush();
       // Response.End();
    }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-29T23:35:12.893

你总是可以有两个链接。一个在浏览器中打开文档，另一个用于下载（使用不正确的内容类型）。这就是 Gmail 所做的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-14T01:52:44.460

我被重定向到这里，因为我有同样的问题。我也尝试了 Troy Howard 的解决方法，但它似乎不起作用。

我在这个上所做的方法是不再使用响应对象来动态写入文件。由于 PDF 已经存在于服务器上，我所做的是将我的页面重定向到该 PDF 文件。效果很好。

[http://forums.asp.net/t/143631.aspx](http://forums.asp.net/t/143631.aspx)

我希望我模糊的解释能给你一个想法。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-11-26T20:21:49.407

我解决这个问题的方法（使用PHP）如下：

假设您的 URL 是`SomeScript.php?id=ID&data=DATA`并且您要使用的文件是`TEST.pdf`.

将 URL 更改为`SomeScript.php/id/ID/data/DATA/EXT/TEST.pdf`.

最后一个参数是您希望 Adob​​e 使用的文件名，这一点很重要（“EXT”可以是任何内容）。确保上面的字符串中没有特殊字符，顺便说一句。

现在，在顶部`SomeScript.php`添加：

```
$_REQUEST = MakeFriendlyURI( $_SERVER['PHP\_SELF'], $_SERVER['SCRIPT_FILENAME']); 
```

然后将此函数添加到`SomeScript.php`（或您的函数库）：

```
function MakeFriendlyURI($URI, $ScriptName) {

/* Need to remove everything up to the script name */
$MyName = '/^.*'.preg_quote(basename($ScriptName)."/", '/').'/';
$Str = preg_replace($MyName,'',$URI);
$RequestArray = array();

/* Breaks down like this
      0      1     2     3     4     5
    PARAM1/VAL1/PARAM2/VAL2/PARAM3/VAL3
*/

$tmp = explode('/',$Str);   
/* Ok so build an associative array with Key->value
   This way it can be returned back to $_REQUEST or $_GET
 */
for ($i=0;$i < count($tmp); $i = $i+2){
    $RequestArray[$tmp[$i]] = $tmp[$i+1];
}
return $RequestArray;       
}//EO MakeFriendlyURI 
```

现在`$_REQUEST`（或者`$_GET`如果您愿意）可以像 normal `$_REQUEST['id']`、`$_REQUEST['data']`等一样访问。

当您在线发送文件时，Adobe 将使用您想要的文件名作为默认另存为或电子邮件信息。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-01-06T19:37:51.583

对于仍在关注此问题的任何人，我使用了[此处](http://docs.google.com/View?docid=dchmct9k_9dxkdwk)找到的解决方案，并且效果非常好。谢谢法布里齐奥！

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-07-12T10:22:18.633

归功于[Vivek](https://stackoverflow.com/users/7418/vivek)。

* * *

# Nginx

```
location /file.pdf
{
    # more_set_headers "Content-Type: application/pdf; name=save_as_file.pdf";
    add_header Content-Disposition "inline; filename=save_as_file.pdf";
    alias /var/www/file.pdf;
} 
```

检查与

```
curl -I https://example.com/file.pdf 
```

Firefox 62.0b5（64 位）：好的。

Chrome 67.0.3396.99（64 位）：好的。

IE 11：没有评论。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2009-04-06T22:38:11.847

试试这个，如果你的可执行文件是“get.cgi”

[http://server,org/get.cgi/filename.pdf?file=filename.pdf](http://server,org/get.cgi/filename.pdf?file=filename.pdf)

是的，这完全是疯了。服务器上没有名为“filename.pdf”的文件，可执行文件get.cgi下根本没有目录。

但它似乎工作。服务器忽略 filename.pdf，pdf 阅读器忽略“get.cgi”

担

# ruby-on-rails - 如何防止 link_to 在 Rails 的 URL 参数中转义斜杠？

> ID：151083
> 
> 赞同：5
> 
> 时间：2008-09-29T22:52:18.487
> 
> 标签：ruby-on-rails

有这条路线：

```
map.foo 'foo/*path', :controller => 'foo', :action => 'index' 
```

我有以下`link_to`通话结果

```
link_to "Foo", :controller => 'foo', :path => 'bar/baz'
# <a href="/foo/bar%2Fbaz">Foo</a> 
```

调用`url_for`或`foo_url`直接调用，甚至使用`:escape => false`，给我相同的 url：

```
foo_url(:path => 'bar/baz', :escape => false, :only_path => true)
# /foo/bar%2Fbaz 
```

我希望得到的网址是：`/foo/bar/baz`

有没有办法在不修补导轨的情况下解决这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T23:54:22.580

不要将路径传递给字符串，而是给它一个数组。

```
link_to "Foo", :controller => 'foo', :path => %w(bar baz)
# <a href="/foo/bar/baz">Foo</a> 
```

如果您的路线文件中没有路线，则相同的 link_to 将改为创建：

```
# <a href="/foo?path[]=bar&path[]=baz">Foo</a> 
```

我能找到这个记录的唯一地方是[这张票](http://dev.rubyonrails.org/ticket/7047)。

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2008-09-30T00:15:55.900

您需要使用该路径生成 URL 的任何原因？

只定义一个额外的路由来覆盖该 URL 会更简洁。

# sql - 如何查找未加入的记录？

> ID：151099
> 
> 赞同：76
> 
> 时间：2008-09-29T22:56:45.340
> 
> 标签：sql, select, join, anti-join

我有两个连接在一起的表。

A有很多B

通常你会这样做：

```
select * from a,b where b.a_id = a.id 
```

从a中获取所有在b中有记录的记录。

如何仅获取 a 中没有 b 中任何内容的记录？

* * *

## 回答 #1

> 赞同：118
> 
> 时间：2008-09-29T22:57:50.423

```
select * from a where id not in (select a_id from b) 
```

或者就像这个线程上的其他人说的：

```
select a.* from a
left outer join b on a.id = b.a_id
where b.a_id is null 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-09-29T23:00:23.617

```
select * from a
left outer join b on a.id = b.a_id
where b.a_id is null 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-29T23:01:10.150

另一种方法：

```
select * from a where not exists (select * from b where b.a_id = a.id) 
```

如果您需要将其他一些“where”子句附加到内部查询，则“exists”方法很有用。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-03-13T10:42:44.707

```
SELECT id FROM a
EXCEPT
SELECT a_id FROM b; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-29T23:05:52.527

如果您使用外连接，您可能会获得更好的性能（比使用'not in'）：

```
select * from a left outer join b on a.id = b.a_id where b.a_id is null; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-05-12T10:28:30.250

下图将有助于理解 SQL **LET JOIN**：

[![在此处输入图像描述](https://i.stack.imgur.com/Ja30P.png)](https://i.stack.imgur.com/Ja30P.png)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-29T22:57:55.633

```
SELECT <columnns>
FROM a WHERE id NOT IN (SELECT a_id FROM b) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T23:06:44.537

另一种写法

```
select a.*
from a 
left outer join b
on a.id = b.id
where b.id is null 
```

哎哟，被内森打败了：）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-29T23:14:45.670

这将保护您免受 IN 子句中的空值的影响，这可能导致意外行为。

select * from a where id not in (select [a id] from b where **[a id] is not null** )

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-01-05T15:38:01.270

在一次连接的情况下，它非常快，但是当我们从具有大约 5000 万条记录和 4 个或更多连接的数据库中删除记录时，由于外键，它需要几分钟才能完成。像这样使用 WHERE NOT IN 条件要快得多：

```
select a.* from a
where a.id NOT IN(SELECT DISTINCT a_id FROM b where a_id IS NOT NULL)
//And for more joins
AND a.id NOT IN(SELECT DISTINCT a_id FROM c where a_id IS NOT NULL) 
```

如果我们没有配置级联删除，我也可以推荐这种删除方法。这个查询只需要几秒钟。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-01-16T10:09:55.353

第一种方法是

```
select a.* from a where a.id  not in (select b.ida from b) 
```

第二种方法是

```
select a.*
  from a left outer join b on a.id = b.ida
  where b.ida is null 
```

第一种方法非常昂贵。第二种方法更好。

使用 PostgreSql 9.4，我执行了“解释查询”功能，并将第一个查询作为*cost=0.00..1982043603.32*的成本。而是将连接查询作为*cost=45946.77..45946.78的成本*

例如，我搜索所有与无车辆不兼容的产品。我有 100k 产品和超过 1m 的兼容性。

```
select count(*) from product a left outer join compatible c on a.id=c.idprod where c.idprod is null 
```

连接查询花费了大约 5 秒，而子查询版本在 3 分钟后从未结束。

# hibernate - 如何使用 Struts 2 + Hibernate 3 向浏览器提供图像？

> ID：151100
> 
> 赞同：2
> 
> 时间：2008-09-29T22:57:18.177
> 
> 标签：hibernate, image, struts2

我正在使用 Struts 2.1.2 和 Hibernate 3.2.6.GA 开发一个 Web 应用程序。我有一个实体，`User`我已使用 Hibernate 将其映射到`USERS`数据库中的一个表。我想要一个与该实体关联的图像，我计划将其存储为`BLOB`数据库中。我还想在网页上显示图像以及`User`.

我能想到的解决方案是有一个表格`IMAGES(ID, IMAGE)`，其中`IMAGE`有一`BLOB`列。`USERS`将有一个`FK`名为 的列`IMAGEID`，它指向`IMAGES`表。然后，我将在`User`实体上映射一个属性，称为`imageId`映射到此`IMAGEID`作为 Long。当使用 JSP 渲染页面时，我会添加图像`<img src="images.action?id=1"/>`等，并有一个 Action 读取图像并将内容流式传输到浏览器，并将标头设置为长时间缓存图像。

这行得通吗？有没有更好的方法来渲染存储在数据库中的图像？首先将此类图像存储在数据库中是正确的方法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T23:34:58.837

是的，您建议的解决方案将起作用。鉴于您在 Java 环境中工作，将图像存储在数据库中是最好的方法。如果您在具有应用程序服务器的单服务器环境中运行，从技术上讲，它允许您以爆炸格式部署，您可以将图像存储在磁盘上，但这不是最佳实践。一个建议是使用 servlet 而不是 JSP。为了获得良好的浏览器行为，您希望浏览器认为它正在显示的文件类型与它所期望的文件类型相匹配。尽管存在 mime 类型标头，但文件扩展名仍然非常重要。所以你想要一个看起来像这样的链接：

```
<a href="foo.jsp"><img src="imageservlet/123456789.png"></a> 
```

其中 123456789 是数据库中图像的主键。您的 servlet 映射如下所示：

```
<servlet>
  <servlet-name>ImageServlet</servlet-name>
  <servlet-class>com.example.ImageServlet</servlet-class>
</servlet>
<servlet-mapping>
  <servlet-name>ImageServlet</servlet-name>
  <url-pattern>/imageservlet/*</url-pattern>
</servlet-mapping> 
```

然后在您的 servlet 中简单地解析图像 ID 的请求 URL，而不是使用查询字符串，因为查询字符串会混淆一些浏览器。使用查询字符串不会彻底破坏浏览器，但您会在缓存方面遇到奇怪的行为，并且某些浏览器可能会将内容报告为不安全。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-29T23:11:53.197

如果您想直接显示带有属性的用户图像，您可以考虑将图像数据直接嵌入到 HTML 中。

使用特殊的 data: URL 方案，您可以在 HTML 页面中嵌入任何 mime 数据，格式如下：

> ```
> data:<mimetype>;base64,<data> 
> ```

**需要替换为数据的 mime 类型（例如 image/png）和 **是文件实际字节的 base64 编码字符串。****

 ****请参阅[RFC 2557](http://www.ietf.org/rfc/rfc2557.txt)。

[示例](http://rifers.org/blogs/gbevin/2005/4/11/embedding_images_inside_html)：

```
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAAAmCAYAAAB52u3eAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsSAAALEgHS3X78AAAAB3RJTUUH1AkICzQgAc6C2QAACrxJREFUeNrtmnl0VdUVxn/3vnnIPBKmJECYkoAEERArgxGqCDIUkKVoqRZKUVREnC1SXXWJlKo4VrEi4EAUEARUtM5oVcAwZhZIyEySlzfe4fSPlzwSEzGUuLpa2Gu9te49Z99zzvvu3vt8e58rCSEAUBWNoyV1wZtzVHokR0pGkwEASQhB2bF6sX/vCZxhFjzuwDkJSlWFm4LDVYyf1I9ho3pKRiWg8f23ZfTPTCQ+0XkuGwzPr/qCZ1Z8zsDBXTCWFNYKq81EVIwNm910TgNzwbBufPlxCR9uzxMyQEO9j/MSlLpaLwDyeSjal3MOmBunb/gvABNQoepku12qqrVpUxTtjKdQVY1mivFTY7Wn09x/rKSuQ/MYOwsTUViKOn0RxifvRYqLAuDw/goeuO1dIiJtVJa7+PWUAcy//WJUVWPhdTl43AFqqz0sXT4utDOOndCHS/r/jb88fRUjLk1mRvbLbNw1FyEEdy14h9Kj9TS6/MyZfyEDMhP50+LtGI0GMrOSWLJsbBudSTPSmTfzDVRVJyrG1uGX0SnAiGPlKBfPhIp6pAG9Wrw5nfJSF6/tvB6AsYNWM/OGC/j0g0Ji4uw8u2EGleUuZmS/zCNPTmT7pkN07R5Ot56RfLSzAGe4hR4pQZB3bjmMxWrk1W3XoSgaEy58llVrplBZ3sgHexYgyzI7Nh9qo2M0yvRIieLBFRMoKaxl6ugXfxlgPn6vgEaXnyunDQy1abPvRVQUIPfMgghHK/0BgxKR5aDH9ktP4GjxSQrzasjM6gpAfGIYHneArBHdWb50J8m9orlx0QjWrP6K6Bgbo8amhqxv3zel3HJ9DkIIEpPC8HlVBrYYvz2d/XvLSb+gCwDJvaIJj7R2PjB+v8q82a+zbMUVoTZ966fon+1CIgoMMhgMrZ4pyqtudZ3ULYJuPSM5cqAyuD2e9GKxGLFYjERG2di6cT/rts8h59V9bM05yMubZof+VGZWV5avOjX3/r0nkGUpdN+ezptr94bWUHHChauD1OSMgHl4yXvU1LhbWYu+ZjMgBeO4xwdeP9gsp6xJE9w8ZyMN9X4uvbw3cQlOrvrNQN5ev49b575FcX4Ndz+SDcCosal8sO0IdruZkaNTOLD3BPGJYQBMnD6Q9945wtyp64mJc+DzKsy7/eJW62tP57HnJ3PdxFdZMm8zXo9CWETHLIa8g5Vi8+u5or7OK04ne746JszcJn7V/4lTjQFFBLqNF376Cz8Zwm+4QOiFx0PduXvKxC3XbxQeT0DUVLvbjFlZ7hJeb0CcidSd9IiqCtcZ6ei6LsrLGoSmaad97uP3C8T4oc+ILW/kig5ZjM+rMP/aN9EReNwBVFXHaJQRpZWI8uomwzOAVof4OhcpNRg/TGYD0bEObDYTNlvbdCMu4cxzs4hI2xnrSJJEQpewM5qnQ8DcOW8L3+QfJRYHxcdqKThcRb/0BHC5QQ00uRKAhL5+J/KsCQD0HRDPgyuC17ouePetgxQX1+JtCODxBBCAxWIgLSOecdlpRMXaQ3OWHq1n08bvkZGwWc1cM3cIFquRb3cf47PPi7DJrYEWgCo0ps0cRGLXcHLW7aO8ogGT1Drm+XWVPr3imHB1/7MDZlvOQZ5b+wWxOJGABuFh82u59PtzAiTFg8MJblcTV3Sgb9+FOFKC1De51TiapnPLDTkUu6uxYMKPH9AAMyYMJMVE8OTT07hqRnqzi7Nw8euAgXicTJ6ZjsVqZMemQ9z3aA5mnE2AnCJyCl769I4jsWs4j96/i38VF2HG8iMdH9lDMn4WmNMyX0XRePiu9zBjCNmEAwuvvfQdXo+CFBOBPDwD8DT1GkB1oT3wTLvjRUbZiMSBAzNTRw9h0Q3ZpMd1wYmFkzUefjdrAyUFtUE3NBkIw0E0dqIi7UhScAU2uwlTU3skNpxYQj+wUF/na3InK2E4iMFORAs9Ezb8PvXsXCnvQBWHCspxYA61WTGSd6KK3Z+WMGZ8H+SbpqHv2tniqXD0NzYhbr4GadTgdsd1E+Dmu37F6PG9OV5Sx5ispzhZ66FGePhwRx5zFw7/2YV7CHDRkJ489txkmtm/puskp0a30qvHx9LFlzF5VgZCCHQhsNtMZx9jNFrnHBLgR6XgUFUQmKljkVLSEcWFgLXJCHXUBY9g2vNakNv8SCQkGl1+ALolR9KvTwL//CofCfC4lY7lTGhERdsZNLTr6dM3NNIHd2HQ0KTOC7590+MZc3Eftnz+PTE4kZHwoiAh0T8zMahkMiIvmIG25IEmYACciNzd6C9tRr5pStsUAoHDGbTC/XtO8P2BUkwYUNAYfknPDma/Mu7GAOVlLhDBKCJJEvGJzlakz46JbW8foK7Oi6bp+ITCyOEpZA3v/p8DYzTKrNk0m6W3OPloZz5+j0pKagyLbrs0RNUB5EmXot0ZCUJvEbasaE9tQL7xapCkVuM6sbBi2UesWf0Vn35YhMvjJ4DG0lsvY+jIHh0CxomFPV8fZ3ivlUELEjp2q5kv8xcRE+dspffGW3v4x1tfIwEqHpbdMeXsgAGIjrXzwvpZNPh0PPUeEtvjHj4/COVHw9kQ+/MRxWUhXtMsFozs2H0QkIjGhkDw1FPTuOGPF3XY1CUk/LpKua8hSAfQsfstaFpr19cR2DFjx4xAUAtYOyPGhEJqVTnh3dv3U23VOsAHhLeORroXyirhR8D4UZkyZhBF+dUUHa/BgMQLT+9m0swMoltwmdPmbSik9IhhyZxxoaBqMhlwhlnaBN/77x7PtGsHAQJNEx0q+ncYGPXxdYj9uRiX34E0dACYjIii4+grX0Ffsx5oj1kawNGWqTbiZ8mysST3jubCtMfxNip8ebCYh+7YwaqXp3ZoPT4UeqXFsnT5uNPqKWik9okhbUDcL1PalC/KQN+1DWXkNSi9rkJJm4zS92q01X8HHC3Y76n9QIpLaEP0mt2gsryRhC5hLL5rDHV4icXBhrXf8UNRbYdd6XRFJ10PupQJmd2fleD1KPh9Kj6vis+nInTRScBkD0dypAX3lGM/IPLzmtKBiHZAkYB65N9PA3v72WxzPL7+D8PoER6FjqBGd7Nx7b5OqSiaTAY0dCKw8epL3zAs5XEuSl3J0NQVjOj9V8qO13dSzTc2EsOdvwXqAHPT1mz4CeVqpCGXYLjvxlatrnof9Xjx4Q297choG5df0Zca6tDQWP/itwgBQghceKnHS0O9L1TD9ftUFLy48eJu/OlT04nTB+LBSx1eGvFzqLKC3BMnOFBeRnFpNRarsfPqMYYHbkLk/YC+7pUmYGwtsBWAH2hEGp2NaeMqsJ4KhLIkMWlmBhXVjShCpXvPqFDfnPnDqPG6sUtmZCQ87gBJ3SO4ZvJQjJJMuMOK2RJc6sDBXZg+aRhGSWZw+k+Tu4VLL8HuMPHJJ4VIASlkoQo6MZF2nGHWzqnHtBRt7VYRGDFb+K1Zwk9f4SdN+MkUgfRJQn1infhflTOux7Txv2uvRL72SkRZJZSUgaJC13ik3j34f5GzOiWQkuKDpYfzJ5Hnj2jPAwNQUdZwHolmolHZGAwTAb/KPTdvFWHhVkaNTTmnQVkybwtVFY0cqrlHMprMBq6elcnKhz7i689+CJUGzzWpq/VQW+1h5YtTcDjNwW/wABpdft7feuSc/jgxe2JfqTk7/zeNpiqnFESz8wAAAABJRU5ErkJggg=="> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T23:15:40.350

Internet Explorer 不支持该样式的图像嵌入。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-30T14:35:53.543

您建议的解决方案将完美运行。我也做过同样的事情。

但是您不需要 servlet。Struts2 已经有一个流结果。

请参阅此[Struts 2 示例](http://cwiki.apache.org/WW/stream-result.html)，它准确地描述了您想要的内容。

# c++ - 哪个是对的？捕获（_com_error e）还是捕获（_com_error& e）？

> ID：151124
> 
> 赞同：13
> 
> 时间：2008-09-29T23:07:56.123
> 
> 标签：c++, exception, com

我应该使用哪一个？

```
catch (_com_error e) 
```

或者

```
catch (_com_error& e) 
```

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-29T23:09:02.580

第二。这是我引用萨特的尝试

“按值抛出，按引用捕获”

> 学会`catch`正确地：按值（而不是指针）抛出异常并通过引用（通常是 to `const`）捕获它们。这是与异常语义最匹配的组合。`throw;`重新抛出相同的异常时，更喜欢`throw e;`.

这是[第 73 条的完整内容。按值抛出，按引用捕获。](http://www.informit.com/content/images/0321113586/items/sutter_item73.pdf)

* * *

避免按值捕获异常的原因是它隐式地复制了异常。如果异常属于子类，则有关它的信息将丢失。

```
try { throw MyException ("error") } 
catch (Exception e) {
    /* Implies: Exception e (MyException ("error")) */
    /* e is an instance of Exception, but not MyException */
} 
```

通过引用捕获通过不复制异常来避免这个问题。

```
try { throw MyException ("error") } 
catch (Exception& e) {
    /* Implies: Exception &e = MyException ("error"); */
    /* e is an instance of MyException */
} 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-30T01:52:32.127

就个人而言，我会选择第三种选择：

```
catch (const _com_error& e) 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-29T23:14:42.270

另外，请注意，在使用 MFC 时，您可能必须[按指针捕获](http://www.parashift.com/c++-faq-lite/exceptions.html#faq-17.8)。否则，@JaredPar 的答案是您通常应该采用的方式（希望永远不必处理抛出指针的事情）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-29T23:13:24.973

绝对是第二个。如果您有以下情况：

```
class my_exception : public exception
{
  int my_exception_data;
};

void foo()
{
  throw my_exception;
}

void bar()
{
  try
  {
    foo();
  }
  catch (exception e)
  {
    // e is "sliced off" - you lose the "my_exception-ness" of the exception object
  }
} 
```

# spring-mvc - 控制器扩展接口时无法识别带注释的 Spring-MVC 控制器

> ID：151152
> 
> 赞同：6
> 
> 时间：2008-09-29T23:15:11.427
> 
> 标签：spring-mvc, mapping, controller, annotations

我正在使用 spring 2.5，并且正在使用注释来配置我的控制器。如果我不实现任何其他接口，我的控制器工作正常，但是当我添加接口实现时，spring 容器无法识别控制器/请求映射。

我不明白为什么添加接口实现会弄乱控制器的配置和请求映射。有任何想法吗？

所以，这有效：

```
package com.shaneleopard.web.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.providers.encoding.Md5PasswordEncoder;
import org.springframework.stereotype.Controller;
import org.springframework.validation.Errors;
import org.springframework.validation.Validator;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

import com.shaneleopard.model.User;
import com.shaneleopard.service.UserService;
import com.shaneleopard.validator.RegistrationValidator;
import com.shaneleopard.web.command.RegisterCommand;

@Controller
public class RegistrationController {

    @Autowired
    private UserService userService;

    @Autowired
    private Md5PasswordEncoder passwordEncoder;

    @Autowired
    private RegistrationValidator registrationValidator;

    @RequestMapping( method = RequestMethod.GET, value = "/register.html" )
    public void registerForm(@ModelAttribute RegisterCommand registerCommand) {
        // no op
    }

    @RequestMapping( method = RequestMethod.POST, value = "/register.html" )
    public String registerNewUser( @ModelAttribute RegisterCommand command,
            Errors errors ) {
        String returnView = "redirect:index.html";

        if ( errors.hasErrors() ) {
            returnView = "register";
        } else {
            User newUser = new User();
            newUser.setUsername( command.getUsername() );
            newUser.setPassword( passwordEncoder.encodePassword( command
                    .getPassword(), null ) );
            newUser.setEmailAddress( command.getEmailAddress() );
            newUser.setFirstName( command.getFirstName() );
            newUser.setLastName( command.getLastName() );

            userService.registerNewUser( newUser );
        }
        return returnView;

    }

    public Validator getValidator() {
        return registrationValidator;
    }
} 
```

但这不是：

```
package com.shaneleopard.web.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.providers.encoding.Md5PasswordEncoder;
import org.springframework.stereotype.Controller;
import org.springframework.validation.Errors;
import org.springframework.validation.Validator;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

import com.shaneleopard.model.User;
import com.shaneleopard.service.UserService;
import com.shaneleopard.validator.RegistrationValidator;
import com.shaneleopard.web.command.RegisterCommand;

@Controller
public class RegistrationController extends ValidatingController {

    @Autowired
    private UserService userService;

    @Autowired
    private Md5PasswordEncoder passwordEncoder;

    @Autowired
    private RegistrationValidator registrationValidator;

    @RequestMapping( method = RequestMethod.GET, value = "/register.html" )
    public void registerForm(@ModelAttribute RegisterCommand registerCommand) {
        // no op
    }

    @RequestMapping( method = RequestMethod.POST, value = "/register.html" )
    public String registerNewUser( @ModelAttribute RegisterCommand command,
            Errors errors ) {
        String returnView = "redirect:index.html";

        if ( errors.hasErrors() ) {
            returnView = "register";
        } else {
            User newUser = new User();
            newUser.setUsername( command.getUsername() );
            newUser.setPassword( passwordEncoder.encodePassword( command
                    .getPassword(), null ) );
            newUser.setEmailAddress( command.getEmailAddress() );
            newUser.setFirstName( command.getFirstName() );
            newUser.setLastName( command.getLastName() );

            userService.registerNewUser( newUser );
        }
        return returnView;

    }

    public Validator getValidator() {
        return registrationValidator;
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-13T03:37:03.350

*莱恩*，您将问题描述为在您的控制器类实现接口时发生，但在您提供的代码示例中，当您的控制器类扩展您的另一个类时，问题会发生`ValidatingController`。

可能父类也定义了一些 Spring 注解，Spring 容器首先注意到它们，并将控制器类归类为该类型的托管对象，并且不费心检查`@Controller`您在子类中也定义的注解。只是一个猜测，但如果成功，我建议将其报告给 Spring 团队，因为这听起来像是一个错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-06-06T19:42:47.670

默认情况下，JDK 代理是使用接口创建的，如果控制器实现了接口，则 RequestMapping 注释将被忽略，因为未使用 targetClass

在你的 servlet 上下文配置中添加这个：

```
<aop:aspectj-autoproxy proxy-target-class="true"/> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T01:23:53.773

我想你会发现问题与继承和使用注释有关，它们不能很好地混合。

您是否尝试过使用继承和 SimpleFormController 以及在您的应用程序上下文中配置的所有其他详细信息来实现上述内容？这至少会将问题缩小到注释和继承问题。

# asp.net - 停止 MaskedEditExtender 验证 asp.net 中的输入

> ID：151173
> 
> 赞同：1
> 
> 时间：2008-09-29T23:24:22.870
> 
> 标签：asp.net, ajax

我有一个 asp.net 文本框和一个 MaskedEditExtender 控件。文本框用于日期输入。MaskedEditExtender 具有 MaskType="Date" Mask="99/99/9999"。

当使用无效日期提交表单时，浏览器会显示 Javascript 错误“...字符串未被识别为有效日期时间”。

我知道为什么会出现错误。有没有办法使用扩展器来控制用户输入的内容而不验证或转换输入？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-28T12:05:38.640

阻止表单以无效日期提交。使用 MaskedEditValidator

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T01:54:37.190

在你的文本框上设置一个按键功能。

验证按下的键是数字 String.fromCharCode(event.which) 还是 event.keycode (ie or FF)

然后可以检查文本框是否包含有效的代码和格式。

如果无效，您可以设置为有效的默认值，或者使用 preventDefault() 来阻止按键

如果无效格式也可以禁用提交按钮....

祝你好运

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T13:24:32.210

不要将掩码类型指定为“日期”，这应该会阻止此错误。

# keyboard - 用于 Visual Studio 的 Sidewinder x6 键盘宏？

> ID：151183
> 
> 赞同：3
> 
> 时间：2008-09-29T23:27:52.567
> 
> 标签：keyboard, hardware

微软的新键盘，[Sidewinder x6](http://www.microsoft.com/hardware/gaming/productdetails.aspx?pid=102)可以录制游戏宏。如果它可以在 Visual Studio 中使用（也可以在应用程序中记录密钥），我很担心？

（这对于按 1 键而不是 Ctrl+M,M 来切换大纲非常有用。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-02T02:52:59.470

是的，它可以！当然，为什么不呢？好的，我的回答背后有一些推理。

只需为 devenv.exe 而不是游戏创建一个“游戏配置文件”。砰！你去吧。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-09T01:34:58.597

是的，它非常适合 vs2008。一个+++++++++

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-01T13:19:15.987

我在 Visual Studio 中使用 Side Winder x6 和 logictech Revolution MX 有一段时间了，我什至为我的工作和家庭购买了相同的键盘和鼠标。我无法回到正常的键盘和鼠标。它们都可以分配给特定的应用程序。

我并没有真正使用它自己的内置宏功能。相反，我为它们分配了很多击键并链接到我的自定义重构程序。

还得到一个可编程鼠标，你可以将视觉工作室最大化到一定的水平。例如，将 CTRL+ALT+SHIFT 分配给鼠标按钮之一，然后您只需按住该按钮并按任意键。您可以产生 CTRL+ALT+SHIFT+ [AZ] 击键！！！

如果您购买了一些适合您的程序。用你自己的聪明想法尝试它们，相信我你不会回到普通的键盘和鼠标。

Resharper AutoIt3 QMenu DualMonitorTools

# sql - pl/sql 美元运算符？

> ID：151190
> 
> 赞同：3
> 
> 时间：2008-09-29T23:34:37.713
> 
> 标签：sql, database, oracle

我今天早上在 pl/sql 脚本中遇到了以下 ddl：

创建索引 genuser.idx$$_0bdd0011 ...

我最初的想法是索引名称是由工具生成的……但我也不是 pl/sql 超级明星，所以我很可能是不正确的。双美元符号在这个语句中有什么特殊意义吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T23:46:47.437

没有特别的意义或意义。

```
SQL> create table t (col number)
  2  /

Table created.

SQL> create index idx$$_0bdd0011 on t(col)
  2  /

Index created. 
```

注意：CREATE INDEX 是一个 DDL 语句，通常在 SQL 脚本中执行，而不是在 PL/SQL 中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T23:48:39.053

您最初的想法似乎是正确的。这看起来是由工具生成的索引名称（但不是由 Oracle 分配，因为未指定索引名称）。美元符号除了是人类开发人员很少使用的有效符号之外没有任何特殊含义，因此可以方便地降低系统生成的名称与人类生成的名称冲突的风险。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T03:23:40.097

不管他的名字来自哪里，这都与 Oracle 的记录建议相反：http: [//download.oracle.com/docs/cd/B19306_01/server.102/b14200/sql_elements008.htm#SQLRF00223](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/sql_elements008.htm#SQLRF00223)

> Oracle 强烈建议您不要在非引号标识符中使用 $ 和 #

# sql - 可以使用 SQL 按日期排序但将空日期放在结果集的后面吗？

> ID：151195
> 
> 赞同：57
> 
> 时间：2008-09-29T23:35:08.587
> 
> 标签：sql, mysql

我在 MySQL 数据库中有一堆任务，其中一个字段是“截止日期”。并非每项任务都必须有截止日期。

我想使用 SQL 按截止日期对任务进行排序，但将没有截止日期的任务放在结果集的后面。就像现在一样，首先显示空日期，然后按截止日期从最早到最晚排序。

关于如何单独使用 SQL 做到这一点的任何想法？（如果需要，我可以使用 PHP 来完成，但只有 SQL 的解决方案会很棒。）

谢谢！

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2008-09-30T00:46:15.310

这是一个仅使用标准 SQL 而不是 ISNULL() 的解决方案。该函数不是标准 SQL，可能不适用于其他品牌的 RDBMS。

```
SELECT * FROM myTable
WHERE ...
ORDER BY CASE WHEN myDate IS NULL THEN 1 ELSE 0 END, myDate; 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-09-29T23:39:16.737

```
SELECT * FROM myTable
WHERE ...
ORDER BY ISNULL(myDate), myDate 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-29T23:38:24.227

```
SELECT foo, bar, due_date FROM tablename
ORDER BY CASE ISNULL(due_date, 0)
WHEN 0 THEN 1 ELSE 0 END, due_date 
```

所以你有 2 个 order by 子句。第一个将所有非空值放在前面，然后按截止日期排序

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2019-09-11T14:22:15.407

最简单的方法是使用带有 DESC 的减号运算符。

`SELECT * FROM request ORDER BY -date DESC`

在 MySQL 中，NULL 值的顺序被认为低于任何非 NULL 值，因此按升序 (ASC) 排序 NULL 列在最前面，如果降序 (DESC) 则列在最后。

当在列名前添加 -（减号）符号时，NULL 变为 -NULL。

由于 -NULL == NULL，添加 DESC 使所有行按日期按升序排序，最后是 NULL。

# python - 如何计算两个给定日期之间的天数

> ID：151199
> 
> 赞同：666
> 
> 时间：2008-09-29T23:36:25.977
> 
> 标签：python, date, datetime

如果我有两个日期（例如`'8/18/2008'`和`'9/26/2008'`），获取这两个日期之间天数的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1031
> 
> 时间：2008-09-29T23:41:22.830

如果您有两个日期对象，您可以将它们相减，从而计算出一个[`timedelta`](https://docs.python.org/3/library/datetime.html#datetime.timedelta)对象。

```
from datetime import date

d0 = date(2008, 8, 18)
d1 = date(2008, 9, 26)
delta = d1 - d0
print(delta.days) 
```

文档的相关部分： [https](https://docs.python.org/library/datetime.html) ://docs.python.org/library/datetime.html 。

有关另一个示例，请参[见此答案](https://stackoverflow.com/a/8258465)。

* * *

## 回答 #2

> 赞同：203
> 
> 时间：2008-09-29T23:41:59.710

使用日期时间的力量：

```
from datetime import datetime
date_format = "%m/%d/%Y"
a = datetime.strptime('8/18/2008', date_format)
b = datetime.strptime('9/26/2008', date_format)
delta = b - a
print delta.days # that's it 
```

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2008-09-29T23:43:01.937

离圣诞节还有几天：

```
>>> import datetime
>>> today = datetime.date.today()
>>> someday = datetime.date(2008, 12, 25)
>>> diff = someday - today
>>> diff.days
86 
```

更多的算术[在这里](https://web.archive.org/web/20061007015511/http://www.daniweb.com/code/snippet236.html)。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-09-29T23:43:10.300

你想要 datetime 模块。

```
>>> from datetime import datetime, timedelta 
>>> datetime(2008,08,18) - datetime(2008,09,26) 
datetime.timedelta(4) 
```

另一个例子：

```
>>> import datetime 
>>> today = datetime.date.today() 
>>> print(today)
2008-09-01 
>>> last_year = datetime.date(2007, 9, 1) 
>>> print(today - last_year)
366 days, 0:00:00 
```

[正如这里](http://python.6.x6.nabble.com/How-Compute-of-Days-between-Two-Dates-tp1711833p1711841.html)所指出的

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2019-11-13T06:22:05.673

每个人都用日期回答得很好，让我尝试用熊猫回答

```
dt = pd.to_datetime('2008/08/18', format='%Y/%m/%d')
dt1 = pd.to_datetime('2008/09/26', format='%Y/%m/%d')

(dt1-dt).days 
```

这将给出答案。如果输入之一是数据框列。只需使用**dt.days**代替**days**

```
(dt1-dt).dt.days 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2012-04-26T10:58:02.887

```
from datetime import datetime
start_date = datetime.strptime('8/18/2008', "%m/%d/%Y")
end_date = datetime.strptime('9/26/2008', "%m/%d/%Y")
print abs((end_date-start_date).days) 
```

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2017-05-11T18:35:15.533

它也可以通过以下方式轻松完成`arrow`：

```
import arrow

a = arrow.get('2017-05-09')
b = arrow.get('2017-05-11')

delta = (b-a)
print delta.days 
```

供参考：[http ://arrow.readthedocs.io/en/latest/](http://arrow.readthedocs.io/en/latest/)

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2018-02-05T22:37:00.863

不使用 Lib 只是纯代码：

```
#Calculate the Days between Two Date

daysOfMonths = [ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]

def isLeapYear(year):

    # Pseudo code for this algorithm is found at
    # http://en.wikipedia.org/wiki/Leap_year#Algorithm
    ## if (year is not divisible by 4) then (it is a common Year)
    #else if (year is not divisable by 100) then (ut us a leap year)
    #else if (year is not disible by 400) then (it is a common year)
    #else(it is aleap year)
    return (year % 4 == 0 and year % 100 != 0) or year % 400 == 0

def Count_Days(year1, month1, day1):
    if month1 ==2:
        if isLeapYear(year1):
            if day1 < daysOfMonths[month1-1]+1:
                return year1, month1, day1+1
            else:
                if month1 ==12:
                    return year1+1,1,1
                else:
                    return year1, month1 +1 , 1
        else: 
            if day1 < daysOfMonths[month1-1]:
                return year1, month1, day1+1
            else:
                if month1 ==12:
                    return year1+1,1,1
                else:
                    return year1, month1 +1 , 1
    else:
        if day1 < daysOfMonths[month1-1]:
             return year1, month1, day1+1
        else:
            if month1 ==12:
                return year1+1,1,1
            else:
                    return year1, month1 +1 , 1

def daysBetweenDates(y1, m1, d1, y2, m2, d2,end_day):

    if y1 > y2:
        m1,m2 = m2,m1
        y1,y2 = y2,y1
        d1,d2 = d2,d1
    days=0
    while(not(m1==m2 and y1==y2 and d1==d2)):
        y1,m1,d1 = Count_Days(y1,m1,d1)
        days+=1
    if end_day:
        days+=1
    return days

# Test Case

def test():
    test_cases = [((2012,1,1,2012,2,28,False), 58), 
                  ((2012,1,1,2012,3,1,False), 60),
                  ((2011,6,30,2012,6,30,False), 366),
                  ((2011,1,1,2012,8,8,False), 585 ),
                  ((1994,5,15,2019,8,31,False), 9239),
                  ((1999,3,24,2018,2,4,False), 6892),
                  ((1999,6,24,2018,8,4,False),6981),
                  ((1995,5,24,2018,12,15,False),8606),
                  ((1994,8,24,2019,12,15,True),9245),
                  ((2019,12,15,1994,8,24,True),9245),
                  ((2019,5,15,1994,10,24,True),8970),
                  ((1994,11,24,2019,8,15,True),9031)]

    for (args, answer) in test_cases:
        result = daysBetweenDates(*args)
        if result != answer:
            print "Test with data:", args, "failed"
        else:
            print "Test case passed!"

test() 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2019-06-09T14:03:16.917

还有一种`datetime.toordinal()`方法还没有提到：

```
import datetime
print(datetime.date(2008,9,26).toordinal() - datetime.date(2008,8,18).toordinal())  # 39 
```

[https://docs.python.org/3/library/datetime.html#datetime.date.toordinal](https://docs.python.org/3/library/datetime.html#datetime.date.toordinal)

> `date.`**序数（）**
> 
> 返回日期的预测公历序数，其中第 1 年的 1 月 1 日的序数为 1。对于任何`date`对象*d*， `date.fromordinal(d.toordinal()) == d`.

似乎很适合计算天数差异，尽管不如`timedelta.days`.

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2018-01-31T10:53:46.613

对于计算日期和时间，有几个选项，但我会写一个简单的方法：

```
from datetime import timedelta, datetime, date
import dateutil.relativedelta

# current time
date_and_time = datetime.now()
date_only = date.today()
time_only = datetime.now().time()

# calculate date and time
result = date_and_time - timedelta(hours=26, minutes=25, seconds=10)

# calculate dates: years (-/+)
result = date_only - dateutil.relativedelta.relativedelta(years=10)

# months
result = date_only - dateutil.relativedelta.relativedelta(months=10)

# days
result = date_only - dateutil.relativedelta.relativedelta(days=10)

# calculate time 
result = date_and_time - timedelta(hours=26, minutes=25, seconds=10)
result.time() 
```

希望能帮助到你

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2016-04-15T14:50:41.070

```
from datetime import date
def d(s):
  [month, day, year] = map(int, s.split('/'))
  return date(year, month, day)
def days(start, end):
  return (d(end) - d(start)).days
print days('8/18/2008', '9/26/2008') 
```

当然，这假设您已经验证您的日期格式为`r'\d+/\d+/\d+'`.

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2018-03-20T13:29:28.427

以下是解决此问题的三种方法：

```
from datetime import datetime

Now = datetime.now()
StartDate = datetime.strptime(str(Now.year) +'-01-01', '%Y-%m-%d')
NumberOfDays = (Now - StartDate)

print(NumberOfDays.days)                     # Starts at 0
print(datetime.now().timetuple().tm_yday)    # Starts at 1
print(Now.strftime('%j'))                    # Starts at 1 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-05-10T16:29:04.207

如果您想自己编写计算代码，那么这里有一个函数将返回给定年、月和日的序数：

```
def ordinal(year, month, day):
    return ((year-1)*365 + (year-1)//4 - (year-1)//100 + (year-1)//400
         + [ 0,31,59,90,120,151,181,212,243,273,304,334][month - 1]
         + day
         + int(((year%4==0 and year%100!=0) or year%400==0) and month > 2)) 
```

[`date.toordinal`](https://docs.python.org/3/library/datetime.html#datetime.date.toordinal)该函数与datetime 模块中的方法兼容。

您可以获得两个日期之间的差异天数，如下所示：

```
print(ordinal(2021, 5, 10) - ordinal(2001, 9, 11)) 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-07-26T03:00:11.510

在 python 中不使用 datetime 对象。

```
# A date has day 'd', month 'm' and year 'y' 
class Date:
    def __init__(self, d, m, y):
            self.d = d
            self.m = m
            self.y = y

# To store number of days in all months from 
# January to Dec. 
monthDays = [31, 28, 31, 30, 31, 30,
                                            31, 31, 30, 31, 30, 31 ]

# This function counts number of leap years 
# before the given date 
def countLeapYears(d):

    years = d.y

    # Check if the current year needs to be considered 
    # for the count of leap years or not 
    if (d.m <= 2) :
            years-= 1

    # An year is a leap year if it is a multiple of 4, 
    # multiple of 400 and not a multiple of 100\. 
    return int(years / 4 - years / 100 + years / 400 )

# This function returns number of days between two 
# given dates 
def getDifference(dt1, dt2) :

    # COUNT TOTAL NUMBER OF DAYS BEFORE FIRST DATE 'dt1' 

    # initialize count using years and day 
    n1 = dt1.y * 365 + dt1.d

    # Add days for months in given date 
    for i in range(0, dt1.m - 1) :
            n1 += monthDays[i]

    # Since every leap year is of 366 days, 
    # Add a day for every leap year 
    n1 += countLeapYears(dt1)

    # SIMILARLY, COUNT TOTAL NUMBER OF DAYS BEFORE 'dt2' 

    n2 = dt2.y * 365 + dt2.d
    for i in range(0, dt2.m - 1) :
            n2 += monthDays[i]
    n2 += countLeapYears(dt2)

    # return difference between two counts 
    return (n2 - n1)

# Driver program 
dt1 = Date(31, 12, 2018 )
dt2 = Date(1, 1, 2019 )

print(getDifference(dt1, dt2), "days") 
```

# java - 如何将 Caucho Resin 的 Java 类路径配置到系统的库目录

> ID：151204
> 
> 赞同：4
> 
> 时间：2008-09-29T23:39:22.040
> 
> 标签：java, classpath, resin

我有一个文件夹，“/var/unity/conf”，其中包含一些属性文件，我希望 Caucho 的 Resin JVM 在类路径中有该目录。

修改resin.conf 以便Resin 知道将此目录添加到类路径的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-24T09:11:54.100

对于 Resin 3.1.6 及更高版本，请使用

```
<server-default>
    ...
    <jvm-classpath>/var/unity/conf/...</jvm-classpath>
    ...
</server-default> 
```

（我知道，游戏很晚了，我自己在寻找这个问题的答案，并在这里找到了这篇文章以及解决方案，所以我想我会重新加入集体）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T03:31:43.183

cd %RESIN_HOME%/lib | ln -s /var/unity/conf/....

# c# - 这些面试问题对初学者来说是否太具有挑战性？

> ID：151210
> 
> 赞同：5
> 
> 时间：2008-09-29T23:40:36.420
> 
> 标签：c#

所以我今天刚采访了两个人，给他们做“测试”，看看他们的技能怎么样。两人都是入门级申请者，其中一位实际上还在上大学。两位申请人都没有发现以下代码有任何问题。

很明显，我愿意，否则我不会选择这些例子。 **你觉得这些问题对新手程序员来说太苛刻了吗？**

我想我还应该注意到他们都没有太多的 C# 经验......但我不认为这些问题与语言有关。

```
//For the following functions, evaluate the code for quality and discuss.  E.g.
//E.g. could it be done more efficiently? could it cause bugs?        
public void Question1()
{
    int active = 0;

    CheckBox chkactive = (CheckBox)item.FindControl("chkactive");
    if (chkactive.Checked == true)
    {
        active = 1;
    }

    dmxdevice.Active = Convert.ToBoolean(active);
}

public void Question2(bool IsPostBack)
{
    if (!IsPostBack)
    {
        BindlistviewNotification();
    }

    if (lsvnotificationList.Items.Count == 0)
    {
        BindlistviewNotification();
    }
}

//Question 3
protected void lsvnotificationList_ItemUpdating(object sender, ListViewUpdateEventArgs e)
{
   ListViewDataItem item = lsvnotificationList.Items[e.ItemIndex];
   string Email = ((TextBox)item.FindControl("txtEmailAddress")).Text;
   int id = Convert.ToInt32(((HiddenField)item.FindControl("hfID")).Value);

   ESLinq.ESLinqDataContext db = new ESLinq.ESLinqDataContext();
   var compare = from N in db.NotificationLists
                 where N.ID == id 
                 select N;
   if (compare.Count() > 0)
   {
       lblmessage.Text = "Record Already Exists";
   }
   else
   {
       ESLinq.NotificationList Notice = db.NotificationLists.Where(N => N.ID == id).Single();
       Notice.EmailAddress = Email;
       db.SubmitChanges();
   }
   lsvnotificationList.EditIndex = -1;
   BindlistviewNotification();
} 
```

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-09-30T00:03:34.743

I don't typically throw code at someone interviewing for a position and say "what's wrong?", mainly because I'm not convinced it really finds me the best candidate. Interviews are sometimes stressful and a bit overwhelming and coders aren't always on their A-game.

Regarding the questions, honestly I think that if I didn't know C#, I'd have a hard time with question 3\. Question #2 is a bit funky too. Yes, I get what you're going for there but what if the idea was that BindlistviewNotification() was supposed to be called twice? It isn't clear and one could argue there isn't enough info. Question 1 is easy enough to clean up, but I'm not convinced even it proves anything for an entry-level developer without a background in C#.

I think I'd rather have something talk me through how they'd attack a problem (in pseudo-code or whatever language they are comfortable with) and assess them from that. Just a personal opinion, though.

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-29T23:51:47.190

我是一名初级程序员，所以我可以尝试一下：

1.  “主动”是不必要的：

    ```
    CheckBox chkactive = (CheckBox)item.FindControl("chkactive");
    dmxdevice.Active = chkactive.Checked 
    ```

2.  您应该使用安全转换来转换为 CheckBox 对象。当然，无论如何，您应该能够通过其变量名找到复选框。：

    ```
    CheckBox chkactive = item.FindControl("chkactive") as CheckBox; 
    ```

3.  第二个函数可能更简洁：

    ```
    public void Question2(bool IsPostBack)
    {
        if (!IsPostBack || lsvnotificationList.Items.Count == 0)
        {
            BindlistviewNotification();
        }
    } 
    ```

只有那两个有时间，工作在召唤！

编辑：我刚刚意识到我没有回答你的问题。我不认为这很复杂。无论如何，我都不是专家，我可以很容易地看到这里的低效率。但是，我确实认为这通常是错误的方法。在我看来，这些特定于语言的测试并不是很有用。尝试了解他们将如何攻击和解决问题。任何能够通过该测试的人都可以轻松掌握一门语言并从错误中吸取教训。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-30T00:14:23.017

I think you are testing the wrong thing. You are obviously looking for a C# programmer, rather than a talented programmer (not that you cannot be a talented C# programmer). The guys might be great C++ programmers, for example. C# can be learned, smarts cannot. I prefer to ask for code during an interview, rather than presenting code in a specific language (example: implement an ArrayList and a LinkedList in any language).
When I was looking for 3 programmers earlier this year, to work mostly in C#, Java, PL/SQL, Javascript and Delphi, I looked for C/C++ programmers, and have not been disappointed. Any one can learn Java, not everyone has a sense of good arachitecture, data strutures and a grasp of new complex problems. C++ is hard, so it acts as a good filter. If I had asked find errors in this Java code, I would have lost them.
BTW, I am a team lead, been programming for 20 years with dozens of large projects developed on time and on budget, and I had no clue with what was wrong with question 2 or 3, having only a passing familiarity with C#, and certainly not with Linq, Not that I could not learn it.... I figured it out after a couple minutes, but would not expect a recent graduate to grasp it, all the LINQ code in question 3 is a distraction that hides the real problems.

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-30T01:19:36.183

> 你觉得这些问题对新手程序员来说太苛刻了吗？

是的，IMO 他们太苛刻了。

> 两位申请人都没有发现以下代码有任何问题。

1.  虽然有很多“可能的问题”，比如不检查空指针、强制转换等，但似乎没有任何“实际问题”。（例如：给定合理的输入，程序看起来会实际运行）。
    我猜一个新手程序员会对此感到困惑。

2.  由于 linq 是相当新的，而且还没有被广泛使用，所以它会超出*你*的新手的头脑。

3.  什么是`ESLinqDataContext`? 如果人们不知道您的对象是什么或它的行为方式，他们应该如何知道它是否被正确使用？

4.  > 评估代码的质量并讨论

您只能从使用类似于您面前的代码的合理经验中真正学会挑选诸如无效强制转换异常之类的东西（更不用说能够判断和评论“代码质量”）。

也许我理解错了，但对我来说，“入门级”职位几乎从定义上讲对以前的经验没有期望，因此根据需要经验的标准对他们进行评分似乎不公平。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-30T00:45:24.533

我不是 C# 程序员，所以我不知道 BindlistviewNotification 做了什么，但正在改变

```
public void Question2(bool IsPostBack)
{
    if (!IsPostBack)
    {
        foo();
    }

    if (lsvnotificationList.Items.Count == 0)
    {
        foo();
    }
} 
```

至

```
public void Question2(bool IsPostBack)
{
    if (!IsPostBack || lsvnotificationList.Items.Count == 0)
    {
        foo();
    }
} 
```

**改变功能**！如果 IsPostBack 为 false，则执行 foo。如果 lsvnotificationList.Items.Count == 0 则 foo**再次**执行。修改后的代码只会执行**一次**foo 。

您可能会争辩说 BindlistviewNotification 可以执行多次而没有副作用，或者 IsPostBack 永远不能为 false 并且 lsvnotificationList.Items.Count 同时等于 0，但这些是语言相关和实现相关的问题，无法用给定的代码解决片段。

此外，如果这是一个“应该”在采访中发现的错误，那么这根本不是语言无关的。没有什么可以告诉我这应该是一个错误。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-29T23:47:20.290

作为一个新手，我希望雇主更关心我的思维过程，而不是答案是否“正确”。我可以为这些问题想出一些答案，但它们可能不会是正确的。:)

话虽如此，我认为您可以解决这些问题，但是您绝对应该对“正确”答案更加自由一些。

只要把这些条件说清楚，我认为得到一张没有任何想法的空白纸是一件坏事。这意味着他们要么真的认为代码是完美的（我们知道这几乎从来都不是真的），要么太羞怯而无法分享他们的想法（这也是一件坏事）。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-30T00:15:40.877

I don't think 1 and 2 are too difficult, #3 requires a decent understanding on how databinding and LINQ works in .NET, so it may be somewhat hard for an entry level person. I think these are fairly good questions for junior level developers who have some .NET experience.

For what its worth, my notes:

# Question 1:

*   Using an integer as boolean
*   No null check on findControl
*   Excessive verbosity

My revision:

```
public void Question1()
{    
    CheckBox chkactive = item.FindControl("chkactive") as CheckBox;
    if (chkActive != null)    
       dmxdevice.Active = chkActive.Checked;
    else
       dmxdevice.Active = false;
} 
```

# Question 2:

*   Excessive verbosity
*   Databinding will happen twice if its not a postback, and there are no items to bind.

My revision:

```
public void Question2(bool IsPostBack)
{
    if (!IsPostBack || lsnotificationList.Items.Count == 0)
    {
        BindlistviewNotification();
    }
} 
```

# Question 3:

*   Replace indexed loopup with getting e.Item.DataItem;
*   Add nullchecks to findControl calls.
*   Switch to TryParse and add a default id value.
*   Added better error handling
*   Document some major architectural issues, why are you querying the database from the frontend? Those LINQ queries could be optimized too.
*   Why not check for duplicates within the list items collection, and why not batch all updates with a single submit later?

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-30T00:07:16.577

So you asked this to someone with no c#, .net, asp.net or linq knowledge? I wouldn't expected anything on the paper?

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-30T01:53:18.800

我唯一的建议是确保您的测试问题实际编译。

我认为 FizzBu​​zz 类型问题的价值在于观察某人如何解决您的问题。

看着他们将解决方案加载到 IDE 中，编译它，通过调试器逐步执行代码，为明显的预期行为编写测试，然后重构代码以使其更正确/可维护，这比知道他们更有价值可以阅读代码并理解它。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-29T23:55:43.437

Not knowing C#, it took me a bit longer, but I'm assuming #1 could be expressed as

dmxdevice.Active = ((CheckBox)item.FindControl("chkactive")).Checked == true

And in #2 the two conditions could be joined as an A OR B statement?

If that's what you're looking for, then no, those aren't too hard. I think #1 is something you might learn only after programming for a little while, but #2 seems easier. Are you looking for them to catch null pointer exceptions also?

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-29T23:55:56.213

I think the first two are fine. The third may be a wee bit complicated for a graduate level interview, but maybe not, it depends whether they've done any .net coding before.

It has LINQ statements in there, and that's pretty new. Especially since many unis/colleges are a bit behind in teaching the latest technology. So I would say run with 1 & 2 and either simplify 3 or heavily comment it as others have mentioned

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-30T00:02:28.613

The first two appear to be more a test to see if a person can follow logically and realize that there is extra code. I'm not convinced that an entry level developer would understand that 'less is more' yet. However, if you explained the answer to Question 1 and they did not then extraplolate that answer to #2, I would be worried.

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-30T00:02:53.543

Question 3 appears to be a big ball of mud type of implementation. This is almost expected to be the style of a junior developer straight from college. I remember most of my profs/TAs in college never read my code -- they only ran the executable and then put in test sets. I would not expect a new developer to understand what was wrong with it...

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-05T03:57:44.487

It's funny to see everyone jumping to change or fix the code. The questions targeted "efficiently? could it cause bugs?" Answers: Given enough time and money, sure each one could probably be made more efficient. Bugs, please try to avoid casting and writing difficult to read code (code should be self-documenting). If it doesn't have bugs it might after the next junior programmer tries to change it... Also, avoid writing code that appears to rely on state contained outside the scope of the method/function, those nasty global variables. If I got some insightful comments like this it might be appropriate to use this as a tool to create some good conversation. But, I think some better ice-breakers exist to determine if a persons critical thinking skills are appropriate and if they will fit in with the rest of the team. I don't think playing stump the programmer is very effective.

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-30T00:59:25.357

你期望从这次采访中得到什么？您的员工是否必须在没有调试器或其他东西的情况下调试代码？您是否正在雇用只做维护编程的人？

在我看来，这些问题对你了解候选人的能力没有多大帮助。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-30T01:28:18.050

## 如果您正在寻找维护程序员或测试员，这是一个很好的问题。

但是，这不是检测优秀程序员的好方法。一个好的程序员当然会通过这个测试，但是很多不好的程序员也会通过它。

如果你想要一个优秀的程序员，你需要定义一个只有优秀程序员才能通过的测试。优秀的程序员具有出色的解决问题的能力，并且知道如何在开始工作之前提出问题以了解问题的核心——既节省他们的时间，也节省您的时间。

一个好的程序员只需一点学习曲线就可以用许多不同的语言编程，所以你的“代码”测试可以由伪代码组成。告诉他们您希望他们解决问题并让他们用伪代码编写解决方案——这意味着他们无法访问所有那些漂亮的库。一个好的程序员知道这些库是如何工作的，并且可以在需要时重新创建它们。

所以......是的，你基本上是在问教科书知识问题 - 显示记忆和语言知识的项目，但不是解决问题所需的技能。

-亚当

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-29T23:46:41.820

**问题 #1**

```
 boolean active = true; 
```

**问题2**

```
 if ((!IsPostBack) || (lsvnotificationList.Items.Count == 0)) 
```

**问题 3：**

完全重写并添加评论。读了 30 秒后，我仍然不知道代码要做什么。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-29T23:57:49.547

I'm not a C# programmer. On Q1, there seem to be undeclared objects dmxdevice and item, which confuses me. However, there does seem to be a lot of obfuscation in the rest of the code. On Q2, lsvnotificationList is not declared, and it not clear to me why one test is abbreviated with ! and the other with == 0 -- but the tests could be combined with ||, it seems. In Q3, lsvnotificationList is not self-evidently declared, again. For the rest, it seems to be doing a database lookup using LINQ. I'd at least expect that to be factored into a function that validates the hidden field ID more transparently. But if you have other ideas, well...I'm still not a C# programmer.

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-30T00:17:07.113

Disclaimer: I come from a 4 year degree and a year's worth of professional Java experience.

The first two questions are quite straightforward and if a candidate doesn't see a better approach I would suspect it's because they haven't been paying attention in class ;-)

Most of the answers to the second question presented so far alter the functions behaviour. The function could very well be evaluated twice in the original code, although I can't say if that is the intent of the function. Side effects are important.

I would probably one-line the first function, myself.

The questions are fairly language agnostic, but they're not library agnostic, which I would argue is equally as important. If you're specifically looking for .NET knowledge, well and good, but without Google I couldn't tell you what an ESLinq.DataContext is, and my answer to the third question suffers accordingly. As it is, it's nearly incomprehensible to me.

I think you also have to be careful how you present the questions. There's nothing *incorrect* about the first two methods, per se. They're just a little more verbose than they should be.

I would just present them with the sheet and say, "What do you think of this code?" Make it open ended, that way if they want to bring up error-handling/logging/commenting or other things, it doesn't limit the discussion.

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-09-30T15:40:49.640

我不得不说，我对这些问题的回答是，如果没有注释（或文档）来解释代码的用途，甚至没有理由查看代码。该代码完全按照它的作用。如果你改变它来做其他事情，甚至改变它来防止抛出异常，你可能会让它做一些意想不到的事情并破坏更大的程序。

这三个问题的问题在于没有意图。如果您修改代码，则假设您知道原始编码器的意图。这种假设通常是错误的。

并回答这个问题：是的，这对大多数初级程序员来说太难了，因为从来没有教过记录代码。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-09-30T01:03:33.443

粗略的一瞥表明，其余代码的大部分都存在结构差和不必要的条件等问题。这本身并没有什么“错误”，尤其是在程序按预期运行的情况下。也许你应该换个问题？

另一方面，铸造看起来根本没有正确完成，例如。(cast)object.Method() vs (cast)(object.Method()) vs ((cast)object).Method()。在第一种情况下，这不是与语言无关的问题——它取决于优先规则。

我认为这并不难，但这完全取决于您想要测试的内容。IMO，聪明的候选人在尝试回答之前应该问很多关于程序功能和类结构的问题。例如。如果他们不问，他们应该如何知道“项目”是否是全局/成员变量？他们怎么知道它的类型？他们甚至知道它是否支持 FindControl 方法吗？FindControl 的返回类型呢？

不过，我不确定有多少大学教授 Linq，所以也许你应该删除那部分。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-09-30T03:50:29.893

好的，所以在我熬夜之后阅读所有答案并评论其中的大多数......

普遍的共识似乎是这些问题并不算太糟糕，但是，特别是对于第三季度，可以通过使用伪代码或其他一些技术来隐藏一些特定于语言的内容来更好地解决问题。

我想现在我不会过多地权衡这些问题。

（当然，他们缺乏 SQL 知识仍然令人不安……如果只是因为他们的简历上都有 SQL。:()

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-09-30T02:09:14.973

没有人用代码回答 #3。这应该表明人们对此的感受。通常stackoverflowers会先遇到这些。

这是我的尝试。我必须在 msdn 上查找 EventArgs 才能知道属性。我知道 LINQ 是因为我在过去 8 个月里仔细研究了它。我没有太多的 UI 经验，所以我无法判断事件处理程序中的绑定调用是否不好（或者其他对于 UI 编码人员来说很明显的事情）。

```
protected void lsvnotificationList_ItemUpdating(object sender, ListViewUpdateEventArgs e)
{
  string Email = e.NewValues["EmailAddress"].ToString();
  int id = Convert.ToInt32(e.NewValues["ID"]);

  using (ESLinq.ESLinqDataContext db = new ESLinq.ESLinqDataContext(connectionString))
  {
    List<NotificationList> compare = db.NotificationLists.Where(n => n.ID = id).ToList();

    if (!compare.Any())
    {
      lblmessage.Text = "Record Does Not Exist";
    }
    else
    {
      NotificationList Notice = compare.First();
      Notice.EmailAddress = Email;
      db.SubmitChanges();
    }
  }
  lsvnotificationList.EditIndex = -1;
  BindlistviewNotification();

} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-09-30T03:02:10.680

虽然这里的人们在业余时间显然可以轻松访问此代码，但作为大约一年前刚从大学毕业的人经历了整个求职/面试过程的人，我认为你必须记住这些问题的压力有多大。我知道你只是在寻找思考过程，但我认为，如果你在让受访者平静下来之后，随意地和对话地提出这样的问题，你会从别人身上得到更多。这听起来像是在逃避，但是关于技术上可行但需要修剪的代码的问题可能比纠正无法编译的代码要困难得多，因为人们会假设这些示例无法编译，并且会把自己逼上墙，试图找出解决你问题的诀窍。

问题 3 中的代码本身似乎非常特定于 C#。我只知道 LINQ 是因为有人在此处的答案中指出了这一点，但作为 Java 开发人员进来，我根本不会意识到这一点。我的意思是你真的希望大学教授最近才在 .net 3.5 中引入的功能吗？

我还想指出这里有多少人被问题 2 绊倒，通过简化代码，他们不小心改变了代码的行为。这应该告诉你很多关于你的问题的难度。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2009-07-21T22:24:13.410

好吧，我不打算回答我在这里看到的 C# 问题，因为你有足够多的候选人可以在与你的工作面试中做得很好。

我确实认为这些测试不会让您很好地了解一个人的编程技能。看看乔尔的面试指南：
[http ://www.joelonsoftware.com/articles/fog0000000073.html](http://www.joelonsoftware.com/articles/fog0000000073.html)

当谈到可能的候选人时，他谈到了两件事：他们是否聪明以及他们是否完成了工作（现在这是一个强大的组合）。让你的候选人谈谈他们所做的项目或他们在家里玩的东西. 了解他们是否对编程充满热情。一些经验当然很好，只是不要让他们做花招。

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2008-09-29T23:56:50.640

Q1 also has a potential InvalidCastException on the `item.FindControl()` line.

I don't think Q1 or Q2 are outside the realms of being too hard, even for non C# users. Any level code should be able to see that you should be using a boolean for active, and only using one if statement.

Q3 though atleast needs comments as someone else noted. That's not basic code, especially if you're targeting non-C# users with it too.

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2008-09-30T01:52:30.160

在问题 2 中，为了更好的模块化，我建议将 lsvnotificationList.Items 的计数作为参数传递：

```
public void Question2(bool IsPostBack, int listItemsCount)
{
    if (!IsPostBack || listItemsCount == 0)
       BindlistviewNotification();
} 
```

# vmware - VMware Server 2.0 - VMware Infrastructure Web 服务没有响应

> ID：151228
> 
> 赞同：7
> 
> 时间：2008-09-29T23:50:11.657
> 
> 标签：vmware, vmware-server

安装 VMware Server 后，当我尝试访问基于 Web 的 VMware 服务器管理器时出现以下错误：

> “ [http://localhost:8222/sdk](http://localhost:8222/sdk) ”处的 VMware Infrastructure Web 服务没有响应

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-29T23:51:11.310

进入服务管理器并检查**“VMware Host Agent”**服务是否正在运行。如果没有，请启动它，然后再次尝试浏览该站点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-03-18T13:16:40.787

Vmware Hostd 也不适合我。

但是，在尝试启动服务时，它会自动停止。通常发生这种情况是因为您的 config.xml 中有错误。C:\ProgramData\VMware\VMware Server\hostd\config.xml

在我的情况下，检查日志：C:\ProgramData\VMware\VMware Server

在“尝试 hostsvc”后显示它出错。

在 config.xml 中搜索 hostsvc 显示了对几件事的引用，第一件事是数据存储。在检查我的 datastores.xml 文件时： C:\ProgramData\VMware\VMware Server\hostd\datastores.xml 。

我发现它充满了各种随机字符，而不是格式正确的 XML 文档。

将 datastores.xml 重命名为 datastorex.xml.bad 允许我启动服务。此时我不得不通过 GUI 重新添加我的数据存储。

希望这会帮助其他人。我没有在谷歌中找到任何其他关于这个问题的参考资料。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T16:09:24.047

尝试通过不带 /sdk 的“ [http://localhost:8222 ”访问。](http://localhost:8222)您还可以通过“ [https://localhost:8333](https://localhost:8333) ”尝试安全站点。

# c# - 如何以编程方式获取计算机的本地网络 IP 地址？

> ID：151231
> 
> 赞同：26
> 
> 时间：2008-09-29T23:51:24.023
> 
> 标签：c#, .net, .net-3.5, ip-address

我需要使用 C# 和 .NET 3.5 从我的程序中获取计算机的实际本地网络 IP 地址（例如 192.168.0.220）。在这种情况下，我不能只使用 127.0.0.1 。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-30T00:33:24.280

如果您正在寻找命令行实用程序 ipconfig 可以提供的那种信息，您可能应该使用 System.Net.NetworkInformation 命名空间。

此示例代码将枚举所有网络接口并转储每个适配器的已知地址。

```
using System;
using System.Net;
using System.Net.NetworkInformation;

class Program
{
    static void Main(string[] args)
    {
        foreach ( NetworkInterface netif in NetworkInterface.GetAllNetworkInterfaces() )
        {
            Console.WriteLine("Network Interface: {0}", netif.Name);
            IPInterfaceProperties properties = netif.GetIPProperties();
            foreach ( IPAddress dns in properties.DnsAddresses )
                Console.WriteLine("\tDNS: {0}", dns);
            foreach ( IPAddressInformation anycast in properties.AnycastAddresses )
                Console.WriteLine("\tAnyCast: {0}", anycast.Address);
            foreach ( IPAddressInformation multicast in properties.MulticastAddresses )
                Console.WriteLine("\tMultiCast: {0}", multicast.Address);
            foreach ( IPAddressInformation unicast in properties.UnicastAddresses )
                Console.WriteLine("\tUniCast: {0}", unicast.Address);
        }
    }
} 
```

您可能对 UnicastAddresses 最感兴趣。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-30T00:49:38.143

使用 Dns 需要在本地 DNS 服务器上注册您的计算机，如果您在 Intranet 上，则不一定如此，如果您在家中有 ISP，则更不可能。它还需要网络往返——所有这些都是为了找出有关您自己计算机的信息。

正确的方法：

```
NetworkInterface[] nics = NetworkInterface.GetAllNetworkInterfaces();
foreach(NetworkInterface  adapter in  nics)
{
    foreach(var x in adapter.GetIPProperties().UnicastAddresses)
    {
        if (x.Address.AddressFamily == AddressFamily.InterNetwork  && x.IsDnsEligible)
        {
                    Console.WriteLine(" IPAddress ........ : {0:x}", x.Address.ToString());
        }
    }
} 
```

（2015 年 7 月 31 日更新：修复了代码的一些问题）

或者对于那些只喜欢一行 Linq 的人：

```
NetworkInterface.GetAllNetworkInterfaces()
    .SelectMany(adapter=> adapter.GetIPProperties().UnicastAddresses)
    .Where(adr=>adr.Address.AddressFamily == AddressFamily.InterNetwork  && adr.IsDnsEligible)
    .Select (adr => adr.Address.ToString()); 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-09-29T23:53:52.707

在John Spano[*的 How to get IP addresses in .NET with a host name*](http://www.devcity.net/Articles/62/1/gethostbyname.aspx "John Spano 的文章，2002 年 12 月 1 日出版")`System.Net`中，它说要添加命名空间，并使用以下代码：

> ```
> //To get the local IP address 
> string sHostName = Dns.GetHostName (); 
> IPHostEntry ipE = Dns.GetHostByName (sHostName); 
> IPAddress [] IpA = ipE.AddressList; 
> for (int i = 0; i < IpA.Length; i++) 
> { 
>     Console.WriteLine ("IP Address {0}: {1} ", i, IpA[i].ToString ()); 
> } 
> ```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-30T00:02:30.533

由于一台机器可以有多个 IP 地址，因此找出您将用于路由到一般互联网的 IP 地址的正确方法是打开一个连接到互联网上主机的套接字，然后检查套接字连接到查看该连接中使用的本地地址是什么。

通过检查套接字连接，您将能够考虑到奇怪的路由表、多个 IP 地址和古怪的主机名。上面主机名的技巧可以工作，但我不认为它完全可靠。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-10-17T16:46:54.800

如果您知道您的计算机有一个或多个 IPv4 地址，这将提供其中之一：

```
Dns.GetHostAddresses(Dns.GetHostName())
    .First(a => a.AddressFamily == AddressFamily.InterNetwork).ToString() 
```

`GetHostAddresses`通常在查询 DNS 服务器时阻塞调用线程，`SocketException`如果查询失败则抛出 a。我不知道在查找您自己的主机名时它是否会跳过网络调用。

# jmx - Has anyone ever got a remote JMX JConsole to work?

> ID：151238
> 
> 赞同：123
> 
> 时间：2008-09-29T23:54:03.050
> 
> 标签：jmx, jconsole

It seems that I've never got this to work in the past. Currently, I KNOW it doesn't work.

But we start up our Java process:

```
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.port=6002
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.ssl=false 
```

I can telnet to the port, and "something is there" (that is, if I don't start the process, nothing answers, but if I do, it does), but I can not get JConsole to work filling in the IP and port.

Seems like it should be so simple, but no errors, no noise, no nothing. Just doesn't work.

Anyone know the hot tip for this?

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2013-07-03T20:19:20.100

我有一个解决方案：

如果您的**Java 进程在防火墙后面的 Linux 上运行，**并且您想在本地计算机上的 Windows 上启动**JConsole/Java VisualVM/Java Mission Control ，以将其连接到****Java 进程的 JMX 端口**。

您需要通过 SSH 登录访问您的 linux 机器。所有通信都将通过 SSH 连接进行隧道传输。

**提示：**无论是否有防火墙，此解决方案都有效。

**缺点：**每次**重新启动**java 进程时，都需要再次执行 4 - 9 的所有步骤。

# 1\. 您需要从这里为您的 Windows 机器安装 putty-suite：

> [http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html)
> 
> 至少**putty.exe**

# 2\. 在你的 linux 机器上定义一个空闲端口：

```
<jmx-remote-port> 
```

### 例子：

```
jmx-remote-port = 15666 
```

# 3\. 给linux机器上的java进程添加参数

这必须完全像这样完成。如果它像下面那样完成，它适用于防火墙后面的 linux 机器（它是`-Djava.rmi.server.hostname=localhost`争论的原因）。

```
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.port=<jmx-remote-port>
-Dcom.sun.management.jmxremote.ssl=false
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.local.only=false
-Djava.rmi.server.hostname=localhost 
```

### 例子：

```
java -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=15666 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.local.only=false -Djava.rmi.server.hostname=localhost ch.sushicutta.jmxremote.Main 
```

# 4\. 获取 Java 进程的 Process-Id

```
ps -ef | grep <java-processname>

result ---> <process-id> 
```

### 例子：

```
ps -ef | grep ch.sushicutta.jmxremote.Main

result ---> 24321 
```

# 5.找到RMIServer stubs下载的任意端口

java 进程在 linux 机器上打开一个新的 TCP 端口，RMI Server-Stubs 将可供下载。该端口还需要通过 SSH 隧道提供，才能连接到 Java 虚拟机。

通过`netstat -lp`这个端口，还可以找到`lsof -i`从 java 进程中打开了哪些端口的提示。

**注意：这个端口总是在 java 进程启动时改变。**

```
netstat -lp | grep <process-id>

tcp        0      0 *:<jmx-remote-port>     *:*     LISTEN      24321/java
tcp        0      0 *:<rmi-server-port>     *:*     LISTEN      24321/java

result ---> <rmi-server-port> 
```

### 例子：

```
netstat -lp | grep 24321

tcp        0      0 *:15666     *:*     LISTEN      24321/java
tcp        0      0 *:37123     *:*     LISTEN      24321/java

result ---> 37123 
```

# 6\. 在你的 Windows 机器上使用 putty 启用两个 SSH 隧道

```
Source port: <jmx-remote-port>
Destination: localhost:<jmx-remote-port>
[x] Local       
[x] Auto       

Source port: <rmi-server-port>
Destination: localhost:<rmi-server-port>
[x] Local       
[x] Auto 
```

### 例子：

```
Source port: 15666
Destination: localhost:15666
[x] Local       
[x] Auto       

Source port: 37123
Destination: localhost:37123
[x] Local       
[x] Auto 
```

![通过 Putty 打开 SSL 隧道的设置](https://i.stack.imgur.com/CHa4j.jpg)

# 7\. 使用启用了 SSH 隧道的 Putty 登录到您的 Linux 机器。

**让 putty 会话保持打开状态。**

登录后，Putty 将通过 SSH 端口 22 将所有 TCP 连接隧道连接到 linux 机器。

JMX-端口：

```
Windows machine: localhost:15666   >>> SSH >>>   linux machine: localhost:15666 
```

RMIServer 存根端口：

```
Windows Machine: localhost:37123   >>> SSH >>>   linux machine: localhost:37123 
```

# 8\. 使用以下 URL 启动 JConsole / Java VisualVM / Java Mission Control 以连接到您的 Java 进程

这可行，因为 JConsole / Java VisualVM / Java Mission Control 认为您连接到本地 Windows 机器上的端口。但是腻子将所有有效负载发送到端口 15666 到您的 linux 机器。

在 linux 机器上，java 进程首先给出答案并发回 RMIServer 端口。在本例中为 37123。

然后 JConsole / Java VisualVM / Java Mission Control 认为它连接到 localhost:37123 并且 putty 会将整个有效负载转发到 linux 机器

java 进程应答并且连接打开。

```
[x] Remote Process:
service:jmx:rmi:///jndi/rmi://localhost:<jndi-remote-port>/jmxrmi 
```

### 例子：

```
[x] Remote Process:
service:jmx:rmi:///jndi/rmi://localhost:15666/jmxrmi 
```

![通过 jmx 服务 url 连接](https://i.stack.imgur.com/QnfvI.jpg)

# 9.享受#8-]

* * *

## 回答 #2

> 赞同：80
> 
> 时间：2009-05-22T21:08:17.720

添加`-Djava.rmi.server.hostname='<host ip>'`为我解决了这个问题。

* * *

## 回答 #3

> 赞同：65
> 
> 时间：2015-11-24T11:47:16.180

## 尝试使用 Java 8 和更新版本

该解决方案也适用于防火墙

### 1\. 将此添加到远程主机上的 java 启动脚本中：

```
-Dcom.sun.management.jmxremote.port=1616
-Dcom.sun.management.jmxremote.rmi.port=1616
-Dcom.sun.management.jmxremote.ssl=false
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.local.only=false
-Djava.rmi.server.hostname=localhost 
```

### 2\. 在您的计算机上执行此操作。

*   *Windows 用户*：

    `putty.exe -ssh user@remote-host -L 1616:remote-host:1616`

*   *Linux 和 Mac 用户*：

    `ssh user@remote-host -L 1616:remote-host:1616`

### 3.`jconsole`在您的计算机上启动

```
jconsole localhost:1616 
```

### 4.玩得开心！

PS：在第 2 步中，使用`ssh`并且`-L`您指定必须将本地（客户端）主机上的端口 1616 转发到远程端。这是一个 ssh 隧道，有助于避免防火墙或各种网络问题。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2008-12-12T14:45:44.147

您可能遇到防火墙问题。“问题”是您指定的端口不是唯一使用的端口，它为 RMI 使用了 1 个或什至 2 个端口，并且这些端口可能被防火墙阻止。

如果您使用默认的 RMI 配置，则不会预先知道其中一个额外的端口，因此您必须打开大量端口 - 这可能不会让服务器管理员感到高兴。

有一个不需要打开很多端口的解决方案，但是，我已经使用来自的组合源代码片段和提示让它工作了

~~[http://forums.sun.com/thread.jspa?threadID=5267091](http://forums.sun.com/thread.jspa?threadID=5267091)~~ - 链接不再起作用

[http://blogs.oracle.com/jmxetc/entry/connecting_through_firewall_using_jmx](http://blogs.oracle.com/jmxetc/entry/connecting_through_firewall_using_jmx)

[http://java.sun.com/javase/6/docs/technotes/guides/management/agent.html](http://java.sun.com/javase/6/docs/technotes/guides/management/agent.html)

甚至可以设置一个 ssh 隧道并让它继续工作:-)

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2014-12-16T19:10:07.237

在过去几天对我的 Google-fu 进行测试后，在编译了 Stack Overflow 和此页面[http://help.boomi.com/atomsphere/GUID-F787998C-的答案后，我终于能够让它工作了53C8-4662-AA06-8B1D32F9D55B.html](http://help.boomi.com/atomsphere/GUID-F787998C-53C8-4662-AA06-8B1D32F9D55B.html)。

从 Dell Boomi 页面重新发布：

```
To Enable Remote JMX on an Atom

If you want to monitor the status of an Atom, you need to turn on Remote JMX (Java Management Extensions) for the Atom.

Use a text editor to open the <atom_installation_directory>\bin\atom.vmoptions file.

Add the following lines to the file:

-Dcom.sun.management.jmxremote.port=5002
-Dcom.sun.management.jmxremote.rmi.port=5002
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.ssl=false 
```

我没有看到任何 Stack Overflow 答案封面的一行是

```
-Dcom.sun.management.jmxremote.rmi.port=5002 
```

就我而言，我试图检索 Kafka 指标，因此我只是更改了上述选项以匹配该`-Dcom.sun.management.jmxremote.port`值。因此，如果没有任何类型的身份验证，最低配置应该如下所示：

```
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.ssl=false
-Dcom.sun.management.jmxremote.port=(jmx remote port)

-Dcom.sun.management.jmxremote.local.only=false
-Dcom.sun.management.jmxremote.rmi.port=(jmx remote port)
-Djava.rmi.server.hostname=(CNAME|IP Address) 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-09-30T03:13:08.080

你在 Linux 上运行吗？也许管理代理绑定到本地主机：

[http://java.sun.com/j2se/1.5.0/docs/guide/management/faq.html#linux1](http://java.sun.com/j2se/1.5.0/docs/guide/management/faq.html#linux1)

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2016-04-08T12:18:04.010

Sushicutta 的步骤 4-7 可以通过在步骤 3 中添加以下行来跳过：

```
-Dcom.sun.management.jmxremote.rmi.port=<same port as jmx-remote-port> 
```

例如添加启动参数：

```
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.port=12345
-Dcom.sun.management.jmxremote.rmi.port=12345
-Dcom.sun.management.jmxremote.ssl=false
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.local.only=false
-Djava.rmi.server.hostname=localhost 
```

对于端口转发，使用以下方式连接：

```
ssh -L 12345:localhost:12345 <username>@<host> 
```

如果您的主机是垫脚石，只需在上面的垫脚石上运行以下命令，将端口向前链接：

```
ssh -L 12345:localhost:12345 <username>@<host2> 
```

请注意，需要**hostname=localhost**以确保 jmxremote 告诉 rmi 连接使用隧道。否则它可能会尝试直接连接并击中防火墙。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2013-10-11T09:48:12.753

专家提示：

RMI 端口在任意端口号上打开。如果您有防火墙并且不想打开端口 1024-65535（或使用 vpn），那么您需要执行以下操作。

您需要修复（如拥有一个已知编号）RMI 注册表和 JMX/RMI 服务器端口。为此，您可以在 lib-dir 中放置一个 jar 文件（catalina-jmx-remote.jar，它位于额外的文件中）并在服务器下配置一个特殊的侦听器：

```
<Listener className="org.apache.catalina.mbeans.JmxRemoteLifecycleListener"
      rmiRegistryPortPlatform="10001" rmiServerPortPlatform="10002" /> 
```

（当然还有用于激活 JMX 的常用标志

```
 -Dcom.sun.management.jmxremote  \
    -Dcom.sun.management.jmxremote.ssl=false \
    -Dcom.sun.management.jmxremote.authenticate=false \
    -Djava.rmi.server.hostname=<HOSTNAME> \ 
```

[请参阅：http: //tomcat.apache.org/tomcat-6.0-doc/config/listeners.html](http://tomcat.apache.org/tomcat-6.0-doc/config/listeners.html)上的 JMX 远程生命周期侦听器

然后你可以使用这个可怕的 URL 进行连接：

```
service:jmx:rmi://<hostname>:10002/jndi/rmi://<hostname>:10001/jmxrmi 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2015-06-04T06:37:08.387

检查您的服务器是否位于防火墙后面。JMX 基于 RMI，启动时打开两个端口。一是注册端口，默认为1099，可以通过`com.sun.management.jmxremote.port`选项指定。另一个是用于数据通信，并且是随机的，这就是导致问题的原因。一个好消息是，从 JDK6 开始，这个随机端口可以通过`com.sun.management.jmxremote.rmi.port`选项指定。

```
export CATALINA_OPTS="-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=8991 -Dcom.sun.management.jmxremote.rmi.port=8991 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false" 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2013-06-17T07:34:45.070

让 JMX 通过防火墙真的很难。问题是标准 RMI 使用第二个随机分配的端口（在 RMI 注册表旁边）。

我们有三种可行的解决方案，但每种情况都需要不同的解决方案：

1.  JMX over SSH Tunnel 和 Socks 代理，使用标准 RMI 和 SSH 魔术 [http://simplygenius.com/2010/08/jconsole-via-socks-ssh-tunnel.html](http://simplygenius.com/2010/08/jconsole-via-socks-ssh-tunnel.html)

2.  JMX MP（标准 RMI 的替代品），仅使用一个固定端口，但在服务器和客户端上需要一个特殊的 jar [http://meteatamel.wordpress.com/2012/02/13/jmx-rmi-vs-jmxmp/](http://meteatamel.wordpress.com/2012/02/13/jmx-rmi-vs-jmxmp/)

3.  启动 JMX Server 表单代码，可以使用标准 RMI 并使用固定的第二个端口： [https ://issues.apache.org/bugzilla/show_bug.cgi?id=39055](https://issues.apache.org/bugzilla/show_bug.cgi?id=39055)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-12T14:17:21.570

在测试/调试/诊断*远程*JMX 问题时，首先总是尝试连接到包含 MBeanServer（即 localhost）的同一主机上，以排除网络和其他非 JMX 特定问题。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-01-27T09:31:36.807

这里已经有一些很好的答案，但是，有一个稍微简单的方法，我认为值得分享。

sushicutta 的方法很好，但是非常手动，因为您每次都必须获取 RMI 端口。值得庆幸的是，我们可以通过使用 SOCKS 代理而不是显式打开端口隧道来解决这个问题。这种方法的缺点是您在机器上运行的 JMX 应用程序需要能够配置为使用代理。大多数进程都可以通过添加 java 属性来实现，但是，有些应用程序不支持这一点。

脚步：

1.  将 JMX 选项添加到远程 Java 服务的启动脚本中：

    ```
    -Dcom.sun.management.jmxremote=true
    -Dcom.sun.management.jmxremote.port=8090
    -Dcom.sun.management.jmxremote.ssl=false
    -Dcom.sun.management.jmxremote.authenticate=false 
    ```

2.  设置到远程机器的 SOCKS 代理连接：

    ```
    ssh -D 9696 user@remotemachine.com 
    ```

3.  配置您的本地 Java 监控应用程序以使用 SOCKS 代理 (localhost:9696)。注意：您*有时*可以从命令行执行此操作，即：

    ```
    jconsole -J-DsocksProxyHost=localhost -J-DsocksProxyPort=9696 
    ```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2018-10-10T07:56:06.747

以下对我有用（尽管我认为端口 2101 并没有真正为此做出贡献）：

```
-Dcom.sun.management.jmxremote.port=2100
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.ssl=false
-Dcom.sun.management.jmxremote.local.only=false
-Dcom.sun.management.jmxremote.rmi.port=2101
-Djava.rmi.server.hostname=<IP_ADDRESS>OR<HOSTNAME> 
```

我正在从远程机器连接到运行 Docker 并且进程位于容器内的服务器。另外，我停止了 firewallD，但我认为这不是问题，因为即使防火墙打开，我也可以远程登录到 2100。希望能帮助到你。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-07-15T13:57:17.093

我在连接到运行 Linux Redhat ES3 的 tomcat 的 Windows 上运行 JConsole/JVisualVm。

使用以下命令禁用数据包过滤对我有用：

```
/usr/sbin/iptables -I INPUT -s jconsole-host -p tcp --destination-port jmxremote-port -j ACCEPT 
```

其中 jconsole-host 是运行 JConsole 的主机名或主机地址，jmxremote-port 是为 com.sun.management.jmxremote.port 设置的用于远程管理的端口号。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-05-29T08:11:56.353

我正在使用 boot2docker 运行带有 Tomcat 的 docker 容器，我遇到了同样的问题，解决方案是：

*   添加`-Djava.rmi.server.hostname=192.168.59.103`
*   在主机和 docker 容器中使用相同的 JMX 端口，例如：`docker run ... -p 9999:9999 ...`. 使用不同的端口不起作用。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-08-26T23:44:58.683

让 JMX 通过防火墙一点也不难。有一个小问题。您必须转发您的 JMX 配置端口，即。9010 和它在我的机器上监听的动态端口之一 > 30000

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-03-28T15:46:59.913

您还需要确保您的机器名称解析为 JMX 绑定的 IP；不是本地主机也不是 127.0.0.1。对我来说，它有助于将一个条目放入明确定义它的主机中。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-02-10T20:22:39.970

这些是对我有用的步骤（服务器端防火墙后面的 debian，从我的本地 Mac 通过 VPN 访问）：

检查服务器ip

```
hostname -i 
```

使用 JVM 参数：

```
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.port=[jmx port]
-Dcom.sun.management.jmxremote.local.only=false
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.ssl=false
-Djava.rmi.server.hostname=[server ip from step 1] 
```

运行应用程序

查找正在运行的java进程的pid

检查 JMX/RMI 使用的所有端口

```
netstat -lp | grep [pid from step 4] 
```

在防火墙上打开第 5 步中的所有端口

瞧。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-12-22T00:21:46.167

我正在尝试让 JMC 运行 Flight Recorder (JFR) 以在不提供运行 JMC 的图形环境的远程服务器上分析 NiFi。

根据此处给出的其他答案，并经过反复试验，这是我在启动 NiFi 时向 JVM ( *conf/bootstrap.conf ) 提供的内容：*

```
java.arg.90=-Dcom.sun.management.jmxremote=true
java.arg.91=-Dcom.sun.management.jmxremote.port=9098
java.arg.92=-Dcom.sun.management.jmxremote.rmi.port=9098
java.arg.93=-Dcom.sun.management.jmxremote.authenticate=false
java.arg.94=-Dcom.sun.management.jmxremote.ssl=false
java.arg.95=-Dcom.sun.management.jmxremote.local.only=false
java.arg.96=-Djava.rmi.server.hostname=10.10.10.92  (the IP address of my server running NiFi) 
```

我确实把它放在*/etc/hosts*中，但我怀疑它是否需要：

```
10.10.10.92   localhost 
```

然后，在启动 JMC 时，我使用以下属性创建远程连接：

```
Host: 10.10.10.92
Port: 9098
User: (nothing)
Password: (ibid) 
```

顺便说一句，如果我单击自定义 JMX 服务 URL，我会看到：

```
service:jmx:rmi:///jndi/rmi://10.10.10.92:9098/jmxrmi 
```

这终于为我做到了。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2015-09-23T20:22:42.927

为了做出贡献，这是我在 CentOS 6.4 上为 Tomcat 6 所做的。

1.  关闭 iptables 服务

    ```
    service iptables stop 
    ```

2.  将以下行添加到 tomcat6.conf

    ```
    CATALINA_OPTS="${CATALINA_OPTS} -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=8085 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Djava.rmi.server.hostname=[host_ip]" 
    ```

这样我就可以使用 JConsole 从另一台 PC 进行连接。

# asp.net-ajax - ASP.NET AJAX 嵌套 updatePanel modalPopup funkiness

> ID：151241
> 
> 赞同：3
> 
> 时间：2008-09-29T23:54:54.140
> 
> 标签：asp.net-ajax, modalpopupextender

似乎在某些情况下，如果您最终使用 updatePanels 包裹的嵌套 modalPopups （我知道这并不理想，可能应该重构，但这就是我们正在使用的，因为我们想要重构一些用户控件使用已编写），当您触发应该打开嵌套 modalPopup 的回发时，它会关闭父级。为了争论，如果我设置断点并运行

```
((ModalPopupExtender)this.Parent.Parent.FindControl("modalPopupExtender'sID").Show(); 
```

就在调用子 modalPopup 的 Show() 方法之前，它按我们最初的预期工作。在我看来，因为当 updatePanels 嵌套时，它们可以回发其父级，父级 modalPopup “不知道”它应该显示并从头开始重新加载其面板的可见性为假。因为子 modalPopup 然后嵌套在可见性为 false 的父面板中，所以对其调用 Show() 也没有任何效果。因此，不是打开另一个 modalPopup，而是关闭当前的。这不是错误，只是我们没有预料到的行为，所以很难追踪，没有任何地方抛出异常，但我认为上面的解释是有道理的......如果我理解错误的问题，请澄清它并启发我，因为这不会
在这一点上，对于这种特殊情况，我们被困在重新编写其中一些控件以不以嵌套的 updatePanels 结束，所以这不会发生，但我很好奇：
以前有没有人遇到过这个问题，你来过吗？是否有任何不涉及调用 FindControl() 以 re-Show() 有问题的 modalPopup 的巧妙解决方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T16:10:35.853

我已经解决了这个问题！
如果您将 UpdatePanel 的 UpdateMode 更改为“Conditional”，则父 UpdatePanel 不会在子 UpdatePanel 回发时回发，然后嵌套它们根本没有问题！
我不确定为什么 UpdateMode="Always" 是默认值，但是，吸取了教训。

# visual-studio - 如何使用 Visual Studio 在 MSI 文件中嵌入文件版本？

> ID：151250
> 
> 赞同：2
> 
> 时间：2008-09-29T23:57:28.313
> 
> 标签：visual-studio, installation, versioning

我的 C# 程序有一个安装项目，这个安装项目的属性中有一个版本。我希望生成的 MSI 文件中嵌入了这个版本，所以我可以在资源管理器中将鼠标悬停在它上面并查看文件是什么版本。

我正在使用VS2008。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-30T02:20:39.767

如果您只是将“版本：1.5.0”文本添加到安装项目的描述属性中，版本号也会显示在 MSI 文件中，如下所示：

[http://screencast.com/t/A499i6jS](http://screencast.com/t/A499i6jS)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T00:43:51.887

据我所知，MSI 文件永远不会显示版本。原因很简单，MSI 文件不是 PE 文件，它们是某种数据库。Msiexec.exe 然后解释此数据库以执行实际安装。您提到的版本属性由 MSI 引擎在内部用于升级、卸载等，并且从不显示。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T00:43:27.173

这是一个很好的问题，但我不知道**有任何**设置工具可以做到这一点。此外，我从未遇到过嵌入了文件版本**资源的 MSI 文件，因此这不是一种常见的做法。**通常，如果我想找出 MSI 文件的版本，我必须在[Orca](http://msdn.microsoft.com/en-us/library/aa370557.aspx)中打开它并检查那里的 ProductVersion 属性（在属性表中）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-07-19T15:52:06.600

在文本编辑器中打开关联的 .vdproj 文件。查找“产品”部分，然后修改“产品版本”和“制造商”字段。

```
 "Product"
    {
    "Name" = "8:Microsoft Visual Studio"
    "ProductName" = "8:tidAxCleanupScript"
    "ProductCode" = "8:{0949AAAD-2C29-415E-851C-825C74C9CA81}"
    "PackageCode" = "8:{8F012EF1-D5D0-43DC-BBFD-761A639DDB07}"
    "UpgradeCode" = "8:{38DE1949-0782-4EF3-BDC2-080EB5B73EF8}"
    "RestartWWWService" = "11:FALSE"
    "RemovePreviousVersions" = "11:TRUE"
    "DetectNewerInstalledVersion" = "11:TRUE"
    "InstallAllUsers" = "11:FALSE"
    "ProductVersion" = "8:**1.5.0**"
    "Manufacturer" = "8:**Default Company Name**"
    "ARPHELPTELEPHONE" = "8:" 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T00:19:37.433

我可能错了，但是 msi 版本不遵循您启动项目的 AssemblyInfo 文件中的版本吗？

# linux - How to force abort on "glibc detected *** free(): invalid pointer"

> ID：151268
> 
> 赞同：16
> 
> 时间：2008-09-30T00:08:38.990
> 
> 标签：linux, memory-management, glibc

In Linux environment, when getting "glibc detected *** free(): invalid pointer" errors, how do I identify which line of code is causing it?

Is there a way to force an abort? I recall there being an ENV var to control this?

How to set a breakpoint in gdb for the glibc error?

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-30T02:38:47.413

我相信如果你将环境设置`MALLOC_CHECK_`为 2，glibc 会`abort()`在检测到“free(): invalid pointer”错误时调用。请注意环境变量名称中的尾随下划线。

如果`MALLOC_CHECK_`为 1，glibc 将打印“free(): invalid pointer”（以及类似的 printfs 用于其他错误）。如果`MALLOC_CHECK_`为 0，glibc 将默默地忽略此类错误并简单地返回。如果`MALLOC_CHECK_`是 3 glibc 将打印消息然后调用`abort()`. 即它的位掩码。

您也可以`mallopt(M_CHECK_ACTION, arg)`使用 0-3 的参数进行调用，并获得与使用相同的结果`MALLOC_CHECK_`。

由于您看到“free(): invalid pointer”消息，我认为您一定已经在设置`MALLOC_CHECK_`或调用`mallopt()`. 默认情况下 glibc 不打印这些消息。

至于如何调试它，安装处理程序`SIGABRT`可能是最好的方法。您可以在处理程序中设置断点或故意触发核心转储。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-30T02:26:17.520

我建议你获得 valgrind：

valgrind --tool=memcheck --leak-check=full ./a.out

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T00:20:19.977

In general, it looks like you might have to recompile glibc, ugh.

You don't say what environment you're running on, but if you can recompile your code for OS X, then its version of libc has a free() that listens to this environment variable:

```
MallocErrorAbort             If set, causes abort(3) to be called if an
                              error was encountered in malloc(3) or
                              free(3) , such as a calling free(3) on a
                              pointer previously freed. 
```

The man page for free() on OS X has more information.

If you're on Linux, then try [Valgrind](http://valgrind.org/), it can find some impossible-to-hunt bugs.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-30T00:32:00.027

> 如何在gdb中设置断点？

(gdb) b 文件名：行号 // 例如 b main.cpp:100

> 有没有办法强制中止？我记得有一个 ENV var 来控制这个？

我的印象是它默认中止。确保您已安装调试版本。

或者使用 libdmalloc5：“替换系统的`malloc',`realloc'、`calloc',`free' 和其他内存管理例程，同时提供在运行时可配置的强大调试工具。这些工具包括内存泄漏跟踪、fence-post 写入检测、文件/行数字报告和统计数据的一般记录。”

将此添加到您的链接命令

```
-L/usr/lib/debug/lib -ldmallocth 
```

当 glibc 触发中止时，gdb 应该自动返回控制。

或者，您可以为 SIGABRT 设置信号处理程序以将堆栈跟踪转储到 fd（文件描述符）。下面，mp_logfile 是一个 FILE*

```
void *array[512 / sizeof(void *)]; // 100 is just an arbitrary number of backtraces, increase if you want.
size_t size;

size = backtrace (array, 512 / sizeof(void *));
backtrace_symbols_fd (array, size, fileno(mp_logfile)); 
```

# imdb - 给定一个 IMDB 电影 ID，我如何以编程方式获取其海报图像？

> ID：151272
> 
> 赞同：19
> 
> 时间：2008-09-30T00:11:38.280
> 
> 标签：imdb

电影 id tt0438097 可以在[http://www.imdb.com/title/tt0438097/找到](http://www.imdb.com/title/tt0438097/)

它的海报图片的网址是什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2011-04-12T05:19:07.777

查看~~[http://www.imdbapi.com/](http://www.imdbapi.com/) ,~~它以字符串形式返回海报 url。

例如，检查~~[http://www.imdbapi.com/?i=&t=inception](http://www.imdbapi.com/?i=&t=inception)~~你会得到海报地址：`Poster":"http://ia.media-imdb.com/images/M/MV5BMjAxMzY3NjcxNF5BMl5BanBnXkFtZTcwNTI5OTM0Mw@@._V1._SX320.jpg"`

**更新**：似乎网站所有者与 IMDB 法律人员发生了一些争论。如原站点所述，新站点地址为[http://www.omdbapi.com/](http://www.omdbapi.com/)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2015-02-23T16:04:25.143

最好的解决方案是使用[tmdb.org](http://www.themoviedb.org/documentation/api)：

1.  在以下 api url 中使用您的 imdbid `find/`：

    `https://api.themoviedb.org/3/find/tt0111161?api_key=__YOURAPIKEY__&external_source=imdb_id`

2.  检索 json 响应并选择`poster_path`属性：

    例如`"poster_path":"/9O7gLzmreU0nGkIB6K3BsJbzvNv.jpg"`

3.  在此路径前加上`"http://image.tmdb.org/t/p/w150"`，您将拥有可在 img 标签中使用的海报 URL :-)

* * *

omdbapi 有效，但我发现你不能真正使用这些图像（因为屏幕抓取，[如果你在 img 标签中使用它们，它们无论如何都会被阻止](https://stackoverflow.com/questions/28676608/403-error-for-loading-image-from-http-and-not-https/28676680)）

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-30T00:17:50.153

我相信你知道，该图片的实际网址是

[http://ia.media-imdb.com/images/M/MV5BMTI0MDcxMzE3OF5BMl5BanBnXkFtZTcwODc3OTYzMQ@@._V1._SX100_SY133_.jpg](http://ia.media-imdb.com/images/M/MV5BMTI0MDcxMzE3OF5BMl5BanBnXkFtZTcwODc3OTYzMQ@@._V1._SX100_SY133_.jpg)

您将很难弄清楚它是如何生成的，而且他们似乎没有公开可用的 API。

屏幕抓取可能是您最好的选择。

图片似乎通常在带有**class=photo的 div 内，并且****a**标签的名称是*poster*。

图像本身就在**a**标签内。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-30T00:16:42.230

据我所知，URL 是一个随机字符串。

它仍然可以轻松检索。它是唯一`img`一个名为 的锚点`poster`。

因此，如果您正在阅读源代码，只需搜索，`<a name="poster"`它将是第一个之后的文本`src="`。

但是，您需要更新屏幕抓取代码，因为这可能会改变。

* * *

您还应该知道图像受版权保护，因此请注意仅在良好的“合理使用”理由下使用图像。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-07-07T10:11:34.193

如果拇指足够，您可以使用 Facebook Graph API： [http ://graph.facebook.com/?ids=http://www.imdb.com/title/tt0438097/](http://graph.facebook.com/?ids=http://www.imdb.com/title/tt0438097/)

为您获取缩略图： [http ://profile.ak.fbcdn.net/hprofile-ak-ash2/50289_117058658320339_650214_s.jpg](http://profile.ak.fbcdn.net/hprofile-ak-ash2/50289_117058658320339_650214_s.jpg)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2014-04-12T12:17:22.847

我知道为时已晚，但在我的项目中，我使用了这个：-

1.  使用 omdbapi，让我们以 Inception 为例，使用[www.omdbapi.com/?t=inception](http://www.omdbapi.com/?t=inception)它将返回一个 json 对象。
2.  在该 json 对象中获取“海报”对象，它包含图像的海报。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-10-19T13:09:10.790

您可以使用[`imdb-cli`工具](https://github.com/bgr/imdb-cli)下载电影的海报，例如

```
omdbtool -t "Ice Age: The Meltdown" | wget `sed -n '/^poster/{n;p;}'` 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-06-12T19:14:30.650

请注意，[服务条款](http://www.imdb.com/help/show_article?conditions)明确禁止屏幕抓取。您可以将 IMDB 数据库作为[一组文本文件下载](http://www.imdb.com/interfaces)，但据我了解，在这些文本文件中找不到 IMDB 电影 ID。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-11-02T18:18:29.887

您可以使用 Trakt API，您必须使用 imdb ID 发出搜索请求，并且 Trakt API 给出的 Json 结果包含该电影的两个图像（海报和粉丝艺术）的链接 [http://trakt.tv/api-文档/搜索电影](http://trakt.tv/api-docs/search-movies)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-11-29T20:35:06.150

我使用 phantomjs 和 wget 做了类似的事情。这部分 phantomjs 接受搜索查询并返回第一个结果的电影海报 url。您可以轻松地将其更改为您的需要。

```
var system = require('system');

if (system.args.length === 1) {
  console.log('Usage: moviePoster.js <movie name>');
  phantom.exit();
}

var formattedTitle = encodeURIComponent(system.args[1]).replace(/%20/g, "+");
var page = require('webpage').create();
page.open('http://m.imdb.com/find?q=' + formattedTitle, function() {
  var url = page.evaluate(function() {
    return 'http://www.imdb.com' + $(".title").first().find('a').attr('href');
  });
  page.close();
  page = require('webpage').create();
  page.open(url, function() {
    var url = page.evaluate(function() {
      return 'http://www.imdb.com' + $("#img_primary").find('a').attr('href');
    });
    page.close();
    page = require('webpage').create();
    page.open(url, function() {
      var url = page.evaluate(function() {
        return $(".photo").first().find('img').attr('src');
      });
      console.log(url);
      page.close();
      phantom.exit();
    });
  });
}); 
```

我使用 wget 为使用此 bash 脚本的目录中的许多电影下载图像。mp4 文件具有 IMDB 喜欢的名称，这就是为什么几乎可以保证第一个搜索结果是正确的。名称如“Love Exposure (2008).mp4”。

```
for file in *.mp4; do
  title="${file%.mp4}"
  if [ ! -f "${title}.jpg" ] 
    then
      wget `phantomjs moviePoster.js "$title"` -O "${title}.jpg"
  fi
done 
```

然后 minidlna 在构建缩略图数据库时使用电影海报，因为它与视频文件具有相同的名称。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-04-22T21:09:52.067

```
$Movies = Get-ChildItem -path "Z:\MOVIES\COMEDY" | Where-Object {$_.Extension -eq ".avi" -or $_.Extension -eq ".mp4" -or $_.Extension -eq ".mkv" -or $_.Extension -eq<br>  <br>".flv" -or $_.Extension -eq ".xvid" -or $_.Extension -eq ".divx"} | Select-Object Name, FullName | Sort Name <br>
#Grab all the extension types and filter the ones I ONLY want <br>
<br>
$COMEDY = ForEach($Movie in $Movies) <br>
{<br>
        $Title = $($Movie.Name)<br>
        #Remove the file extension<br>
        $Title = $Title.split('.')[0] <br>       
<br>
        #Changing the case to all lower <br>       
        $Title = $Title.ToLower()<br>
<br>
        #Replace a space w/ %20 for the search structure<br>
        $searchTitle = $Title.Replace(' ','%20')       <br>
<br>
        #Fetching search results<br>
        $moviesearch = Invoke-WebRequest "http://www.imdb.com/search/title?title=$searchTitle&title_type=feature"<br>
         <br>
        #Moving html elements into variable<br>
        $titleclassarray = $moviesearch.AllElements | where Class -eq 'title' | select -First 1<br>
<br>
        #Checking if result contains movies<br>
        try<br><br>
        {
            $titleclass = $titleclassarray[0]<br>
        }<br>
        catch<br>
        {<br>
            Write-Warning "No movie found matching that title http://www.imdb.com/search/title?title=$searchTitle&title_type=feature"<br>
        }      <br>
                   <br>
        #Parcing HTML for movie link<br>
        $regex = "<\s*a\s*[^>]*?href\s*=\s*[`"']*([^`"'>]+)[^>]*?>"<br>
        $linksFound = [Regex]::Matches($titleclass.innerHTML, $regex, "IgnoreCase")<br>
         <br><br>

        #Fetching the first result from <br>
        $titlelink = New-Object System.Collections.ArrayList<br>
        foreach($link in $linksFound)<br>
        {<br>
            $trimmedlink = $link.Groups[1].Value.Trim()<br>
            if ($trimmedlink.Contains('/title/'))<br>
            {<br>
                [void] $titlelink.Add($trimmedlink)<br>
            }<br>
        }<br>
        #Fetching movie page<br>
        $movieURL = "http://www.imdb.com$($titlelink[0])"<br>
        <br>
        #Grabbing the URL for the Movie Poster<br>
        $MoviePoster = ((Invoke-WebRequest –Uri $movieURL).Images | Where-Object {$_.title -like "$Title Poster"} | Where src -like "http:*").src  <br> 
<br>
        $MyVariable = "<a href=" + '"' + $($Movie.FullName) + '"' + " " + "title='$Title'" + ">"<br>
        $ImgLocation = "<img src=" + '"' + "$MoviePoster" + '"' + "width=" + '"' + "225" + '"' + "height=" + '"' + "275" + '"' + "border=" + '"' + "0" + '"' + "alt=" +<br> '"' + $Title + '"' + "></a>" + "&nbsp;" + "&nbsp;" + "&nbsp;"+ "&nbsp;" + "&nbsp;" + "&nbsp;"+ "&nbsp;" + "&nbsp;" + "&nbsp;"<br>
        <br>
        Write-Output $MyVariable, $ImgLocation<br>
       <br>
    }$COMEDY | Out-File z:\db\COMEDY.htm  <br>
<br>
    $after = Get-Content z:\db\COMEDY.htm <br>
<br>
    #adding a back button to the Index <br>
    $before = Get-Content z:\db\before.txt<br>
<br>
    #adding the back button prior to the poster images content<br>
    Set-Content z:\db\COMEDY.htm –value $before, $after<br> 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-02-23T00:21:34.640

在玩弄了上面@Hawk 的 BASE64 发现之后，我发现 BASE64 代码之后的所有内容都是显示信息。如果您删除最后一个之间的所有内容`@`，`.jpg`它将以它拥有的最高分辨率加载图像。

```
https://m.media-amazon.com/images/M/MV5BMjAwODg3OTAxMl5BMl5BanBnXkFtZTcwMjg2NjYyMw@@._V1_UX182_CR0,0,182,268_AL_.jpg 
```

变成

```
https://m.media-amazon.com/images/M/MV5BMjAwODg3OTAxMl5BMl5BanBnXkFtZTcwMjg2NjYyMw@@.jpg 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-09-04T06:56:49.953

有一个 API 服务提供商将根据您在其查询字符串中提供的电影名称为您提供海报图像 URL 和许多其他详细信息。

[这里是上述服务提供商网站的链接。](http://www.omdbapi.com/)

您可以在代码中注册并使用 API 服务。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-30T00:21:03.983

这些海报图像似乎与标题页没有任何关联，因此您必须先检索标题页，然后检索页面的 img 元素。好消息是 img 标签被包裹在一个带有 name="poster" 的标签中。您没有说您使用的是哪种工具，但这基本上是一个屏幕抓取操作。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-04-04T02:32:34.977

这是我为在 imdb 页面上找到的电影公司生成人类可读的 html 摘要页面的程序。根据您的喜好更改初始 url，它会生成一个 html 文件，您可以在其中查看标题、摘要、分数和缩略图。

```
npm install -g phantomjs 
```

这是脚本，将其保存到 imdb.js

```
var system = require('system');

var page = require('webpage').create();
page.open('http://www.imdb.com/company/co0026841/?ref_=fn_al_co_1', function() {
  console.log('Fetching movies list');
  var movies = page.evaluate(function() {
    var list = $('ol li');
    var json = []
    $.each(list, function(index, listItem) {
      var link = $(listItem).find('a');
      json.push({link: 'http://www.imdb.com' + link.attr('href')});
    });
    return json;
  });
  page.close();

  console.log('Found ' + movies.length + ' movies');

  fetchMovies(movies, 0);
});

function fetchMovies(movies, index) {
  if (index == movies.length) {
    console.log('Done');

    console.log('Generating HTML');
    genHtml(movies);

    phantom.exit();
    return;
  }
  var movie = movies[index];

  console.log('Requesting data for '+ movie.link);

  var page = require('webpage').create();
  page.open(movie.link, function() {
    console.log('Fetching data');
    var data = page.evaluate(function() {
      var title = $('.title_wrapper h1').text().trim();
      var summary = $('.summary_text').text().trim();
      var rating = $('.ratingValue strong').attr('title');
      var thumb = $('.poster img').attr('src');

      if (title == undefined || thumb == undefined) {
        return null;
      }
      return { title: title, summary: summary, rating: rating, thumb: thumb };
    });

    if (data != null) {
      movie.title = data.title;
      movie.summary = data.summary;
      movie.rating = data.rating;
      movie.thumb = data.thumb;
      console.log(movie.title)
      console.log('Request complete');
    } else {
      movies.slice(index, 1);
      index -= 1;
      console.log('No data found');
    }
    page.close();
    fetchMovies(movies, index + 1);
  });
}

function genHtml(movies) {
  var fs = require('fs');

  var path = 'movies.html';
  var content = Array();

  movies.forEach(function(movie) {
    var section = '';

    section += '<div>';
    section += '<h3>'+movie.title+'</h3>';
    section += '<p>'+movie.summary+'</p>';
    section += '<p>'+movie.rating+'</p>';
    section += '<img src="'+movie.thumb+'">';
    section += '</div>';

    content.push(section);
  });

  var html = '<html>'+content.join('\n')+'</html>';

  fs.write(path, html, 'w');
} 
```

像这样运行它

```
phantomjs imdb.js 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2017-07-03T00:46:13.667

```
$Title = $($Movie.Name)

$searchTitle = $Title.Replace(' ','%20')  

$moviesearch = Invoke-WebRequest "http://www.imdb.com/search/title?title=$searchTitle&title_type=feature"

$titleclassarray = $moviesearch.AllElements | where Class -eq 'loadlate' | select -First 1

$MoviePoster = $titleclassarray.loadlate 
```

* * *

## 回答 #17

> 赞同：-3
> 
> 时间：2012-07-07T10:46:44.143

现在，所有现代浏览器都有“**检查**”部分：

100% 正确，仅适用于 Google Chrome：

1.  将光标放在图像上。
2.  右键单击它，选择“**检查元素**”。
3.  在出现的窗口中，在**元素**选项卡下，您会发现突出显示的文本为
4.  只需点击它。
5.  在“资源”选项卡中，右键单击图像。
6.  选择“**复制图像 URL** ”选项。

尝试将其作为 URL 粘贴到任何浏览器中的任何位置，您只会得到图像。

# polyglot - What combination do you use for your polyglot solution?

> ID：151290
> 
> 赞同：-1
> 
> 时间：2008-09-30T00:23:37.143
> 
> 标签：polyglot

Those of us who use multiple languages to solve problems can combine them in a lot of ways. Personally I use PL/SQL, XSLT, JavaScript, and Java plus the pseudo languages HTML, XML, CSS, Ant, and Bash. What do you use?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T00:34:56.867

转述我最喜欢的一句话：

> 始终编​​写您的代码，就好像它将由一个知道您家庭地址的杀人狂人维护一样。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T00:30:33.023

I have a D/MySQL/JavaScript[1]/HTML/CPP[2] app.

[1] compile time D template generated [2] C pre-processor used to generate apache configs and SQL sprocs

Yes, I *am* trying to take things to the insane! ;)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T00:46:08.370

我在桌面应用程序上工作，所以我的字母汤看起来像：C# 和 C++ 以及 XML 和 T-SQL。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-02T00:36:38.747

Java + Clojure 作为组合对我来说效果很好。

*   Java 适用于需要优化的低级代码。它还使您可以访问 Java 生态系统中的大量库。

*   Clojure 非常适合快速开发更高级别的代码，在 REPL 中以交互方式工作。它对元编程和并发性有很好的支持，我经常使用 Clojure 将基于 Java 的组件“粘合”到一个工作应用程序中。

Java 和 Clojure 在同一个 JVM 中运行非常有帮助——两者之间的调用非常容易，并且实际上具有零性能开销。

# .net - 我可以在 .NET 中使用“System.Currency”吗？

> ID：151291
> 
> 赞同：12
> 
> 时间：2008-09-30T00:24:06.427
> 
> 标签：.net

是否可以使用system.currency。它说 system.currency 由于其保护级别而无法访问。什么是货币的替代品。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-30T00:27:56.090

您必须使用[十进制](http://msdn.microsoft.com/en-us/library/364x0z75.aspx)数据类型..

十进制关键字表示 128 位数据类型。与浮点类型相比，十进制类型的精度更高，范围更小，适用于金融和货币计算。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-30T00:37:20.667

使用十进制。Currency 提供的所有函数都是 Decimal、FromOACurrency 和 ToOACurrency 上的静态方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T00:33:56.370

通过反射可能是可能的，但它存在的原因是 for**`FromOACurrency()`**和**`ToOACurrency()`**静态方法 on **`System.Decimal`**，这是为了从/转换到`Currency`Visual Basic 6 使用的 Ole 自动化类型。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2008-09-30T14:54:27.347

您实际上不能将 Decimal 用于 Currency。以后分裂的时候会面临更大的问题。假设你将 1 美元分成 3 份，即 1/3 = 0.33（四舍五入），但 3 x 0.33 = 0.99 != 1。它可能很小，但是当你在会计中这样做并堆叠你的床单时，它将是一个巨大的身影。这也是为什么 .Net 中的默认向上/向下舍入行为（不确定其他编程语言）是下一个偶数值，也称为银行家的舍入，与我们正常的“人类”舍入方式相比，可以最大限度地减少会计错误。

阅读此页面以获得更清晰的解释和处理金钱的特殊课程。[代码项目：CLR 的 Money 类型](http://www.codeproject.com/KB/recipes/MoneyTypeForCLR.aspx)

还有关于[四舍五入](http://en.wikipedia.org/wiki/Rounding)

# .net - 是否有在 CLR 上运行的 CLR？

> ID：151298
> 
> 赞同：10
> 
> 时间：2008-09-30T00:27:02.987
> 
> 标签：.net, clr, cil

**我想知道是否有使用 CLI**（公共语言基础结构）实现的与 .NET 兼容的 CLR，例如，使用 .NET 本身，或者至少是否有任何资源可以帮助构建一个。

基本上，类似于 .NET 程序将程序集作为 MemoryStreams 加载、解析字节码、构造类型并执行指令。或者，它可以使用 Reflection.Emit 或然而 JIT 编译为标准 IL。

**我不想*编译*由原始 CLR 运行的 .NET 语言。我想要一个用 .NET 语言***（不是通常的非托管 C++ 或 C）***编写*****并*运行*CIL 的 CLR。**如果操作正确，它应该能够自行运行。*

 *对使用 Mono.Cecil 做这种事情有什么想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T03:21:04.347

我认为目前没有任何独立的.net VM 是自托管的，但[Cosmos](http://www.gocosmos.org)和[SharpOS](http://sharpos.org)都是用 C# 编写的.net 运行时。

It may be possible to reuse some of their runtime code to extra a standalone runtime. Cosmos can be used to host a custom application on boot: [http://www.codeproject.com/KB/system/CosmosIntro.aspx](http://www.codeproject.com/KB/system/CosmosIntro.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T02:18:46.227

您应该查看[IKVM.NET 项目](http://www.ikvm.net/)。它包括一个用 .NET 编写的 Java 虚拟机。

[http://www.ikvm.net/](http://www.ikvm.net/)

我知道它不是在 CLR 之上运行的实际 CLR，但它是我所知道的最接近你想要的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T00:43:22.777

我不知道，但是在 JVM 上运行的 JVM 的想法应该会有所帮助。

*   [吉克斯 RVM](http://jikesrvm.org/)
*   [马克辛虚拟机](http://maxine.dev.java.net/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T01:08:19.783

如果您愿意将“运行 CIL”的定义扩展为“JIT-Compiles CIL to Native Code”，那么您应该看看[托管操作系统联盟](http://www.mosa-project.org/)——一群致力于创建运行时的人（包括我自己）编写托管操作系统内核所必需的部分。

目前，还有很多工作要做，但可以 JIT 编译和运行简单的方法（仅限 Win32——我们目前使用 P/Invoke 创建本机代码缓冲区）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-07-20T06:47:08.897

It is possible in principle by combining technologies:

*   [Jikes RVM](http://jikesrvm.org/) is a Java Virtual Machine implementation written in Java.
*   [IKVM.NET](https://en.wikipedia.org/wiki/IKVM.NET), an implementation of the Java platform on .NET.

It might also be possible to take [Mono](https://en.wikipedia.org/wiki/Mono_%28software%29), compile to LLVM bytecode, compile the bytecode to Javascript using [Emscripten](https://github.com/kripken/emscripten), and run the Javascript on .NET using any of various interpreters.

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-09-30T00:31:48.403

查看 System.Reflection.Emit 命名空间，特别是 ILGenerator 类。

您可以即时发出 IL。

[http://msdn.microsoft.com/en-us/library/system.reflection.emit.ilgenerator_members.aspx](http://msdn.microsoft.com/en-us/library/system.reflection.emit.ilgenerator_members.aspx)

# c++ - 在 Windows 应用程序的编译时嵌入 SVN 修订号

> ID：151299
> 
> 赞同：18
> 
> 时间：2008-09-30T00:27:51.783
> 
> 标签：c++, windows, visual-studio, svn

我希望我的 .exe 能够使用我的 svn 版本访问资源字符串。我可以手动输入，但我更喜欢在编译时自动嵌入。Visual Studio 2008 中是否有任何此类功能？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-30T01:47:34.383

我想要一个类似的可用性，但发现 $Rev$ 是不够的，因为它只在文件的修订被更改时才更新（这意味着它必须非常及时地编辑和提交：这不是我想做的事情。）相反，我想要一些基于存储库修订号的东西。

对于我现在正在处理的项目，我编写了一个 Perl 脚本，该脚本`svnversion -n`从我的工作副本的最顶层目录运行并将最新的修订信息输出到一个 .h 文件（我实际上将它与保存在我的工作副本中的非版本化文件，这样我就不会在每次编译时覆盖当前的修订信息，但您是否选择这样做取决于您。）这个 .h 文件（或必要时的多个文件，取决于您方法）在我的应用程序代码和资源文件中都被引用以获取我想要的信息。

此脚本作为预构建步骤运行，以便在构建开始之前一切都是最新的，并且构建工具会自动重新构建适当的文件。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-10-16T06:27:01.367

如何使用[SubWCRev随](http://tortoisesvn.net/docs/nightly/TortoiseSVN_en/tsvn-subwcrev.html)[TortoiseSVN](http://tortoisesvn.net/)一起提供的命令行工具。您创建一个模板文件，其中包含 $WCREV$ $WCDATE$ 等标记。然后有一个预构建步骤，在您的模板文件上运行 SubWCRev 以创建馈送到编译器的实际源文件。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-30T00:35:04.247

如果可以解决问题，您可以让[SVN 为您嵌入它。](http://svnbook.red-bean.com/nightly/en/svn.advanced.props.special.keywords.html)请参阅该页面上的 $Rev$ 关键字。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-30T00:35:32.437

[在这里](http://svnbook.red-bean.com/en/1.4/svn.advanced.props.special.keywords.html)查看 svn 关键字替换。我通过谷歌找到了另一个 SO question [here ！](https://stackoverflow.com/questions/145449/easy-way-to-embed-svn-revision-number-in-page-in-php-closed)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-30T04:53:44.843

antik 的解决方案是我们使用的解决方案。小心使用环境变量，.h 文件确保您可以拥有一个依赖项，这将导致任何需要它的文件在 svn rev 号更改时重新编译。

# vb.net - AddHandler/RemoveHandler Not Disposing Correctly

> ID：151303
> 
> 赞同：4
> 
> 时间：2008-09-30T00:29:08.160
> 
> 标签：vb.net, .net-2.0

Using the `AddHandler` method, if I never use `RemoveHandler`, will that lead to memory leaks in some conditions and situations? I'm not so sure about the truth of this.

And are there other causes to memory leaks that are solely available in VB as opposed to C#?

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-30T01:38:07.853

*好吧，通常它不会……但这种可能性是存在的。*
当你订阅一个事件时，你基本上给你的方法一个委托（如果你愿意的话，一个 func 指针）给事件发布者，只要你不使用 -= 操作符取消订阅，谁就会持有它。

举个例子，你生成一个子表单并且表单订阅了表单上的 Click 按钮事件。

```
button1.Click += new EventHandler(Form_Click_Handler); 
```

现在按钮对象将保留表单引用。当表单关闭/处置/设置为 null 时，不再需要表单和按钮；内存被回收。

当您拥有一个具有更长生命周期的全局结构或对象时，就会出现问题。假设 Application 对象维护一个打开的子窗口列表。因此，每当创建子表单时，应用程序对象都会订阅一个 Form 事件，以便它可以对其进行跟踪。在这种情况下，即使表单已关闭/处置，应用程序对象仍使其保持活动状态（非垃圾对象持有表单的引用）并且不允许回收其内存。当您不断创建和关闭窗口时，您的应用程序会占用越来越多的内存。因此，您需要显式取消订阅以从应用程序中删除表单引用。

```
childForm.Event -= new EventHandler(Form_Handler) 
```

**因此，它建议您有一个取消订阅块 (-=) 来补充您的订阅例程 (+=)...但是您可以在没有它的情况下管理库存场景。**

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T00:30:45.503

If object a is suscribed to the object b event then object b will not be collected until object a is collected.

An event suscription counts as a reference to the publisher object.

And yes, this happens on C# too, i has nothing to do with the language.

# vb.net - VB.Net - 如何支持隐式类型转换以及自定义相等

> ID：151318
> 
> 赞同：3
> 
> 时间：2008-09-30T00:35:05.917
> 
> 标签：vb.net, clr, type-conversion

**固定：见底部注释**

我正在实现一个支持两个特性的泛型类，隐式类型转换和自定义相等运算符。好吧，它也支持 IN 平等，如果它这样做的话。

```
1) if ( "value" = myInstance ) then ...
2) Dim s As String = myInstance
3) Dim s As String = CType(myInstance,String) 
```

我遇到的问题是，如果我支持 #2 隐式转换，那么我无法让我的相等运算符工作，因为他们抱怨没有最具体的转换。

我得到的错误是这样的（为了简洁而简化了一点）：

```
Overload resolution failed because no accessible '=' is most specific for these arguments:
    'Public Shared Operator =(obj As MyClass, data As String) As Boolean': Not most specific.
    'Public Shared Operator =(data As String, obj As MyClass) As Boolean': Not most specific.
    'Public Shared Operator =(obj1 As MyClass, obj2 As MyClass) As Boolean': Not most specific. 
```

实现这一点的最佳方法是什么。同样重要的是，我应该遗漏什么？我已经实现了以下转换

```
Operator =(ByVal data As String,    ByVal obj  As classType) As Boolean (and <>)
Operator =(ByVal obj  As classType, byval data As String) As Boolean (and <>)
Operator =(ByVal obj1 As classType, ByVal obj2 As classType) As Boolean (and <>)
Equals(obj as Object) as Boolean
Equals(compareTo as classType ) as Boolean
Equals(compareTo as String) as Boolean
Widening Operator CType(ByVal source As String) As classType
Widening Operator CType(ByVal source As classType) as String
Narrowing Operator CType(ByVal inst As classType) As dataType 
```

在我的加宽运算符中，我进行了一些反思，这就是为什么当我与左侧的字符串进行比较或赋值时，我希望能够将 DOWN 隐式转换为 String。

```
A) SomeObject.StringPropertySetter = MyClass 
```

## **修复**（编辑）

我在实施的过程中做得太过火了，因为我不明白发生了什么。基本类型（即 string/double/guid）之间的比较通过扩展 ctype(...) as String（或 Guid 等）运算符进行。最后，我刚刚实现了这些功能，除了从类分配到基类型实例之外，我所有的测试用例仍然通过

```
Public Class MyClass(Of BaseType)

    Widening Operator CType(ByVal source As dataType) As MyClass 
    Widening Operator CType(ByVal source As MyClass) As dataType //conv between inst & base
    Equals()  // for datatype, classType, object
    Operator <>(MyClass,MyClass) // for comparison between two instances
    Opeator   =(MyClass,MyClass) 
```

*注释是 c 风格，但代码是 vb.net*

当然，这门课比这要复杂一些，但这给了我我需要的一切:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T02:21:12.743

您不应覆盖 = 运算符。如果您对诸如`string`or之类的类型进行了隐式转换`int`，则让默认的相等运算符接管。

作为一般规则，如果您需要为类自定义相等性，则应覆盖该`Equals(object)`方法。

# virtual-machine - 使用 Virtual PC 2007 在 VM 和主机之间共享文件

> ID：151327
> 
> 赞同：4
> 
> 时间：2008-09-30T00:41:08.990
> 
> 标签：virtual-machine, virtual-pc

我知道我可以使用 Virtual PC 中的共享文件夹共享文件，但这种方法似乎性能很差。是否有另一种共享文件的方法可以提供更好的性能？（除了使用Virtual PC以外的东西）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T01:07:11.157

最好的方法可能是在主机和 VM 之间建立适当的桥接网络连接。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T17:49:37.980

使用 VirtualBox，我在设置共享文件夹时遇到了问题（我尝试设置它，但它不能立即直观地工作，所以我厌倦了它）。因此，我只是 ftp'​​ed 到主机操作系统（我在使用 Linux 时就已经设置好了），并以这种方式传输文件。

我建议定时通过共享文件夹传输一个合理大小的文件，然后使用 FTP 再次定时......如果它更快，那是你的解决方案:-)

抱歉，我无法给出实际的性能指标！

# .net - .NET Winforms 部署

> ID：151335
> 
> 赞同：2
> 
> 时间：2008-09-30T00:43:35.443
> 
> 标签：.net, winforms, deployment, embedding

无论如何将所有资源组合成一个 exe 文件，例如 app.config 和相关的 DLL 文件？

一些应用程序似乎可以做到这一点，例如 eMule。

我不希望我的 app.config 坐在那里等待编辑。

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T00:50:33.100

当然，在`Solution Explorer`（假设这里是 Visual Studio，因为你没有提到）`Right-click`和`Properties`你想要包含的文件中。

那里应该有一个选项`Build Action`，您可以将其设置为`Embedded Resource`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T00:50:21.043

您当然可以嵌入资源。转到应用程序属性并选择“资源”选项卡。添加的所有资源都将在主二进制文件中。

为什么不让 app.config 坐在那里等待编辑？许多专业软件包都有配置和ini文件可以自由编辑。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T04:08:21.707

老兄，这就是为什么它是一个配置文件！它应该允许你改变应用程序的工作方式。

如果您担心不应该更改的设置，请尝试其他存储、类、数据库、注册表、平面文件等，或者只是在某个地方保留一个副本，可以用来替换搞砸的那个。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T05:08:39.580

合并 dll - ILMerge

合并配置文件是不值得的，因为它应该是调整应用程序行为而不重新编译它的方式。如果您不需要，只需对所有内容进行硬编码（无论是代码还是作为 EmbeddedResources）。

如果您仍然需要可配置性，您可以将文件隐藏到用户配置文件中。

例如，参见[http://www.codeproject.com/KB/cs/SystemConfiguration.aspx](http://www.codeproject.com/KB/cs/SystemConfiguration.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T00:48:31.703

我之前使用过 Thinstall 作为应用程序虚拟化收缩包装器：

[https://thinstall.com/help/index.php?_netsupport.htm](https://thinstall.com/help/index.php?_netsupport.htm)

这可以满足您的需求，即将应用程序的所有依赖项捆绑到一个可执行文件中，包括 .configs。

您还可以很好地研究其他软件收缩包装工具。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T02:12:58.347

如果您不想更改设置，请将它们移动到代码中而不是配置中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T03:58:53.693

我同意一些用户的看法。它确实违背了“配置”的目的。只需对共享类调用“设置”中的所有信息进行硬编码，然后像这样引用

_serverIP = settings.MailServerIP

唯一应该考虑的项目是 helperfiles（它与某些东西有关，据说）、图像、第 3 方 dll（虽然我不确定）......仅举几例。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T04:03:19.270

.net app.config 文件的问题在于修改它们会改变应用程序的工作方式。

嵌入资源不是问题，它是我担心的那个特定文件。

# javascript - 如何在 JavaScript 中获取对当前焦点表单字段的引用？

> ID：151337
> 
> 赞同：5
> 
> 时间：2008-09-30T00:44:06.253
> 
> 标签：javascript, forms, dom, cross-browser

我正在寻找一种跨浏览器的方法——我知道 IE 有一些东西（我已经忘记了什么），而在 Mozilla 中实现它的方法可能与我发现的一个 focusNode 东西有关，这似乎与获取文本有关选择。

涉及 jQuery 或其他常见 JS 库的方法对我来说很好。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T01:07:22.373

查看[额外](http://www.softwareunity.com/sandbox/JQueryMoreSelectors/)的[jQuery](https://jquery.com/)选择器插件，它包含一个`:focus`满足您需求的选择器。如果您不使用其他选择器，则可以只使用该选择器的实现。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T00:58:36.297

好的，所以使用 jQuery。

目前没有可用的方法来问这个问题。[您需要在焦点事件发生时对其进行跟踪，因此此示例（在此](http://groups.google.com/group/jquery-en/browse_thread/thread/e31e21ba4ef3160c/21c2d4c016336fad?lnk=raot&pli=1)感谢 Karl Rudd ）在所有元素中执行此操作。这适用于输入，但您可以调整选择器以满足您的需求，甚至在整个 DOM 中。

```
var currentFocus = null; 
$(':input').focus( function() { 
    currentFocus = this; 
}).blur( function() { 

    currentFocus = null; 
}); 
```

# ruby - 在 Ruby 中为类添加实例变量

> ID：151338
> 
> 赞同：38
> 
> 时间：2008-09-30T00:44:22.540
> 
> 标签：ruby, metaprogramming

如何在**运行时**将实例变量添加到定义的类，然后从类外部获取和设置其值？

我正在寻找一种元编程解决方案，它允许我在运行时修改类实例，而不是修改最初定义类的源代码。一些解决方案解释了如何在类定义中声明实例变量，但这不是我要问的。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-09-30T00:52:15.733

Ruby 为此提供了方法，`instance_variable_get`并且`instance_variable_set`. （[文档](http://www.ruby-doc.org/core/classes/Object.html)）

您可以像这样创建和分配新的实例变量：

```
>> foo = Object.new
=> #<Object:0x2aaaaaacc400>

>> foo.instance_variable_set(:@bar, "baz")
=> "baz"

>> foo.inspect
=> #<Object:0x2aaaaaacc400 @bar=\"baz\"> 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-30T00:53:57.103

您可以使用属性访问器：

```
class Array
  attr_accessor :var
end 
```

现在您可以通过以下方式访问它：

```
array = []
array.var = 123
puts array.var 
```

* * *

请注意，您也可以使用`attr_reader`或`attr_writer`仅定义 getter 或 setter，或者您可以手动定义它们：

```
class Array
  attr_reader :getter_only_method
  attr_writer :setter_only_method

  # Manual definitions equivalent to using attr_reader/writer/accessor
  def var
    @var
  end

  def var=(value)
    @var = value
  end
end 
```

* * *

如果您只想在单个实例上定义它，也可以使用单例方法：

```
array = []

def array.var
  @var
end

def array.var=(value)
  @var = value
end

array.var = 123
puts array.var 
```

* * *

仅供参考，针对对此答案的评论，单例方法工作正常，以下是证明：

```
irb(main):001:0> class A
irb(main):002:1>   attr_accessor :b
irb(main):003:1> end
=> nil
irb(main):004:0> a = A.new
=> #<A:0x7fbb4b0efe58>
irb(main):005:0> a.b = 1
=> 1
irb(main):006:0> a.b
=> 1
irb(main):007:0> def a.setit=(value)
irb(main):008:1>   @b = value
irb(main):009:1> end
=> nil
irb(main):010:0> a.setit = 2
=> 2
irb(main):011:0> a.b
=> 2
irb(main):012:0> 
```

如您所见，单例方法`setit`将设置与`@b`使用 attr_accessor... 定义的字段相同的字段，因此单例方法是解决此问题的一种完全有效的方法。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-09-30T08:14:32.083

@[只读](https://stackoverflow.com/questions/151338/adding-an-instance-variable-to-a-class-in-ruby#151797)

如果您对“class MyObject”的使用是对开放类的使用，那么请注意您正在重新定义初始化方法。

在 Ruby 中，没有重载之类的东西......只有覆盖或重新定义......换句话说，任何给定方法只能有 1 个实例，所以如果你重新定义它，它就会被重新定义......并且初始化方法没有什么不同（即使它是 Class 对象的新方法使用的）。

因此，永远不要重新定义现有方法而不首先对其进行别名......至少如果您想访问原始定义。并且重新定义未知类的初始化方法可能是相当冒险的。

无论如何，我想我有一个更简单的解决方案，它使用实际的元类来定义单例方法：

```
m = MyObject.new
metaclass = class << m; self; end
metaclass.send :attr_accessor, :first, :second
m.first = "first"
m.second = "second"
puts m.first, m.second 
```

您可以同时使用元类和开放类来变得更加棘手，并执行以下操作：

```
class MyObject
  def metaclass
    class << self
      self
    end
  end

  def define_attributes(hash)
    hash.each_pair { |key, value|
      metaclass.send :attr_accessor, key
      send "#{key}=".to_sym, value
    }
  end
end

m = MyObject.new
m.define_attributes({ :first => "first", :second => "second" }) 
```

以上基本上是通过“元类”方法暴露元类，然后在define_attributes中使用它来动态定义一堆属性与attr_accessor，然后用哈希中的关联值调用属性设置器。

使用 Ruby，您可以发挥创造力并以多种不同方式做同样的事情 ;-)

* * *

仅供参考，如果您不知道，像我所做的那样使用元类意味着您只对给定的对象实例进行操作。因此，调用 define_attributes 只会为该特定实例定义那些属性。

例子：

```
m1 = MyObject.new
m2 = MyObject.new
m1.define_attributes({:a => 123, :b => 321})
m2.define_attributes({:c => "abc", :d => "zxy"})
puts m1.a, m1.b, m2.c, m2.d # this will work
m1.c = 5 # this will fail because c= is not defined on m1!
m2.a = 5 # this will fail because a= is not defined on m2! 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T01:17:28.357

[Mike Stone 的回答](https://stackoverflow.com/questions/151338/adding-an-instance-variable-to-a-class-in-ruby#151359)已经很全面了，但我想补充一点细节。

您可以随时修改您的类，即使在创建了某个实例之后，也可以得到您想要的结果。您可以在控制台中尝试一下：

```
s1 = 'string 1'
s2 = 'string 2'

class String
  attr_accessor :my_var
end

s1.my_var = 'comment #1'
s2.my_var = 'comment 2'

puts s1.my_var, s2.my_var 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T02:01:16.007

其他解决方案也可以完美运行，但这里有一个使用 define_method 的示例，如果你一心不使用开放类......它将为数组类定义“var”变量......但请注意它是 EQUIVALENT使用开放类...好处是您可以为未知类执行此操作（因此任何对象的类，而不是打开特定类）... define_method 也将在方法内工作，而您不能在其中打开类一个方法。

```
array = []
array.class.send(:define_method, :var) { @var }
array.class.send(:define_method, :var=) { |value| @var = value } 
```

这是它的使用示例...请注意，array2，一个**不同**的数组也有方法，所以如果这不是你想要的，你可能想要我在另一篇文章中解释的单例方法。

```
irb(main):001:0> array = []
=> []
irb(main):002:0> array.class.send(:define_method, :var) { @var }
=> #<Proc:0x00007f289ccb62b0@(irb):2>
irb(main):003:0> array.class.send(:define_method, :var=) { |value| @var = value }
=> #<Proc:0x00007f289cc9fa88@(irb):3>
irb(main):004:0> array.var = 123
=> 123
irb(main):005:0> array.var
=> 123
irb(main):006:0> array2 = []
=> []
irb(main):007:0> array2.var = 321
=> 321
irb(main):008:0> array2.var
=> 321
irb(main):009:0> array.var
=> 123 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T01:44:46.153

只读，以响应您的编辑：

> 编辑：看起来我需要澄清我正在寻找一种元编程解决方案，它允许我在运行时修改类实例，而不是修改最初定义类的源代码。一些解决方案解释了如何在类定义中声明实例变量，但这不是我要问的。对困惑感到抱歉。

我想你不是很理解“公开课”的概念，也就是说你可以随时开课。例如：

```
class A
  def hello
    print "hello "
  end
end

class A
  def world
    puts "world!"
  end
end

a = A.new
a.hello
a.world 
```

以上是完全有效的 Ruby 代码，两个类定义可以分布在多个 Ruby 文件中。您可以使用 Module 对象中的“define_method”方法在类实例上定义新方法，但这相当于使用开放类。

Ruby 中的“开放类”意味着您可以在任何时间点重新定义任何类……这意味着添加新方法、重新定义现有方法或任何您真正想要的方法。听起来“公开课”解决方案确实是您正在寻找的......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-11-11T20:28:43.847

我前段时间为此写了一个宝石。它被称为“灵活”，不能通过 ruby​​gems 获得，但直到昨天才可以通过 github 获得。我删除了它，因为它对我没用。

你可以做

```
class Foo
    include Flexible
end
f = Foo.new
f.bar = 1 
```

没有任何错误。因此，您可以即时从对象中设置和获取实例变量。如果您有兴趣...我可以再次将源代码上传到 github。它需要一些修改才能启用

```
f.bar?
#=> true 
```

作为询问对象是否定义了实例变量“bar”的方法，但其他任何东西都在运行。

亲切的问候，musicmatze

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-10-20T18:34:30.643

看起来所有先前的答案都假设您在编写代码时知道要调整的类的名称是什么。好吧，这并不总是正确的（至少，对我来说不是）。我可能正在迭代一堆我想赋予一些变量的类（例如，保存一些元数据或其他东西）。在这种情况下，这样的事情就可以完成，

```
# example classes that we want to tweak
class Foo;end
class Bar;end
klasses = [Foo, Bar]

# iterating over a collection of klasses
klasses.each do |klass|
  # #class_eval gets it done
  klass.class_eval do
    attr_accessor :baz
  end
end

# it works
f = Foo.new
f.baz # => nil
f.baz = 'it works' # => "it works"
b = Bar.new
b.baz # => nil
b.baz = 'it still works' # => "it still works" 
```

# javascript - 如何检查对象是否是 IE 中 NodeList 的实例？

> ID：151348
> 
> 赞同：8
> 
> 时间：2008-09-30T00:49:11.187
> 
> 标签：javascript

为什么在 IE6/7 中未定义 NodeList？

```
<form action="/" method="post" id="testform">
    <input type="checkbox" name="foobar[]" value="1" id="" />
    <input type="checkbox" name="foobar[]" value="2" id="" />
    <input type="checkbox" name="foobar[]" value="3" id="" />    
</form>

<script type="text/javascript" charset="utf-8">
(function () {
    var el = document.getElementById('testform')['foobar[]']
    if (el instanceof NodeList) {
        alert("I'm a NodeList");
    }  
})();
</script> 
```

这适用于 FF3/Safari 3.1，但不适用于 IE6/7。任何人都知道如何检查 el 是否是所有浏览器中的 NodeList 实例？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-30T03:14:11.650

“[鸭子打字](http://en.wikipedia.org/wiki/Duck_typing)”应该总是有效的：

```
...

if (typeof el.length == 'number' 
    && typeof el.item == 'function'
    && typeof el.nextNode == 'function'
    && typeof el.reset == 'function')
{
    alert("I'm a NodeList");
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-05-24T15:44:03.213

亚当佛朗哥的回答*几乎*奏效。不幸的是，`typeof el.item`在不同版本的 IE 中返回不同的东西（7：字符串，8：对象，9：函数）。所以我正在使用他的代码，但是我将行更改为并始终`typeof el.item !== "undefined"`更改`==`为。`===`

```
if (typeof el.length === 'number' 
    && typeof el.item !== 'undefined'
    && typeof el.nextNode === 'function'
    && typeof el.reset === 'function')
{
    alert("I'm a NodeList");
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-09T23:01:27.913

With **jQuery**:

```
if (1 < $(el).length) {
    alert("I'm a NodeList");
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T01:25:55.513

我只会使用总是评估为某种类型的东西。然后你只需做一个真/假类型检查，看看你是否有一个有效的对象。在您的情况下，我会像您现在一样获得对选择项的引用，然后使用它的 getOptions() 方法来获取表示选项的 HTMLCollection。此对象类型与 NodeList 非常相似，因此使用它应该没有问题。

# c# - IDE 用于 Linux 上的 C# 开发？

> ID：151350
> 
> 赞同：69
> 
> 时间：2008-09-30T00:49:50.107
> 
> 标签：c#, linux, ide, mono

我有哪些选择？一年多前我尝试过 MonoDevelop，但它非常有问题。最新版本是稳定的开发环境吗？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-09-30T00:56:18.003

MonoDevelop 2.0 已经发布，它现在有一个不错的 GUI 调试器、代码完成、Intellisense C# 3.0 支持（包括 linq）和一个不错的 GTK# 可视化设计器。

简而言之，从 2.0 版本开始，我再次开始使用 Mono Develop，并且到目前为止对它非常满意。

查看[MonoDevelop 网站](http://monodevelop.com/)了解更多信息。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2016-04-20T17:17:17.890

微软已经发布了 Linux 的[Visual Studio Code](https://www.visualstudio.com/en-us/products/code-vs.aspx "视觉工作室代码")，它自然有很好的 C# 支持。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-05T08:09:59.507

**Monodevelop**
有 2 个版本：

*   1.0：当前稳定的版本。它确实很稳定，但它的功能有些有限。这对于小型项目非常有用。我是通过 ubuntu hardy repos 得到的。

*   2.0RC（又名 1.9.x）你可以通过 SVN 和编译得到它。该过程非常简单，您无需安装（通过`make run`）即可运行它。它比 1.0 稍微不稳定，但这取决于您获得的构建版本（这是一个开发快照）。关于能力，它很棒。它具有重构、分析、大量插件等。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-30T16:41:06.670

我会推荐来自[Omnicore](http://www.omnicore.com)的 X-develop 。它是一个非常好的 IDE，但只能免费使用 30 天。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-05T07:29:46.767

Eclipse 有一个 C# 绑定，虽然我没有亲自尝试过，所以我不能保证。我使用 MonoDevelop，它并不完美，但在大多数情况下工作得相当好。Ubuntu 8.04 (Hardy Heron) 中包含的版本比 Gutsy Gibbon 版本稳定得多。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2017-01-11T20:11:29.493

我使用[JetBrains Rider](https://www.jetbrains.com/rider)已经有一段时间了，我非常喜欢它。

它具有 ReSharper 的所有优点，并且在 OS/X 或 Linux 上使用是一种乐趣。请注意，它仍处于抢先体验计划中，因此它到处都有一些粗糙的边缘，但大多数时候它运行良好，足以满足日常使用。

你可以在这里得到它： [https ://www.jetbrains.com/rider/download/](https://www.jetbrains.com/rider/download/)

PS 我主要将它用于 .NET Core 开发需求，但也将它用于传统的 .NET 编码。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-30T01:02:10.780

不久前我使用了 MonoDevelop，它很好。对于 Java 开发，它远不如 Eclipse 或 NetBeans 好，但它们确实属于自己的一类。而且我认为唯一真正的选择是使用 emacs 或 vim ......

它相当抛光。稳定性真的不是问题。那里有简单的代码完成，以及跳转到声明、超类和非常有用的查找引用。但是，调试不存在，这是一个相当明显的遗漏。实际上，我花了几分钟尝试设置断点，直到我意识到甚至没有办法“调试...”而不是“运行...”

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-30T01:25:49.460

你看过[SlickEdit](http://www.slickedit.com/)吗？几年前，当我在 Linux 上开发 C++ 应用程序时，我认为它非常好。它说它支持 C#，但我不能评论它有多好。不过，我很高兴将它用于我的 C++ 开发。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-30T00:52:16.827

> 最新版本稳定是稳定的开发环境吗？

可能......它在去年春天达到了 1.0。

# javascript - 访问 iframe 文档对象时出现“访问被拒绝”错误

> ID：151362
> 
> 赞同：26
> 
> 时间：2008-09-30T00:56:00.513
> 
> 标签：javascript, ajax, iframe

为了在具有许多参数的表单中发布 AJAX 表单，我使用了一种解决方案，即创建一个`iframe`，通过 POST 将表单发布到它，然后访问`iframe`的内容。具体来说，我正在访问这样的内容：

```
$("some_iframe_id").get(0).contentWindow.document 
```

我测试了它并且它有效。

在某些页面上，我开始收到“访问被拒绝”错误。据我所知，如果 iframe 来自同一个域，则不应该发生这种情况。

我很确定它以前工作过。有人有线索吗？

如果我不够清楚：我发布到*同一个域*。所以这不是跨域请求。我只在 IE 上测试。

PS 我不能使用简单的 ajax POST 查询（不要问...）

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-09-30T01:20:57.537

自己解决了！

问题是，即使发送了正确的响应（使用 Fiddler 验证），它也发送了 HTTP 500 错误代码（而不是 200）。

事实证明，如果发送带有错误代码的响应，IE 会用`iframe`从磁盘加载的错误消息替换 IE 的内容（`res://ieframe.dll/http_500.htm`），这会导致跨域访问被拒绝错误。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-04-03T15:26:09.843

注意与**iFrame**相关的安全限制，例如*跨域*限制（又名 CORS）。以下是与 CORS 相关的 3 个常见错误：

1.  加载具有不同域的 iFrame。（例如：打开“ *www.foo.com* ”，而顶部框架是“ *www.ooof.com* ”）

2.  使用不同的端口加载 iFrame：iFrame 的 URL*端口*与顶部框架的端口不同。

3.  不同的协议：通过 HTTPS 加载 iFrame 资源，而父 Frame 使用 HTTP。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-02-11T03:34:59.197

我的问题是`X-Frame-Options`HTTP 标头。我的 Apache 配置已设置为：

```
Header always append X-Frame-Options DENY 
```

删除它允许它工作。特别是在我的情况下，我使用 jQuery 的 iframe 传输和 jQuery 文件上传插件来上传 IE 9 和 IE 10 中的文件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-05-06T14:25:54.867

我知道这个问题很老，但我想提一下，上面的答案对我有用：在每个页面上设置 document.domain 相同——父页面和 iframe 页面。然而，在我的搜索中，我确实找到了这篇有趣的文章：

[http://softwareas.com/cross-domain-communication-with-iframes](http://softwareas.com/cross-domain-communication-with-iframes)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-08-02T13:22:43.360

请注意，如果您有一个 iframe，`src='javascript:void(0)'`那么类似 javascript的 iframe`frame.document.location =...`将因 IE 中的访问被拒绝错误而失败。正在使用与目标框架交互的 javascript 库。即使它试图将框架更改为与父级相同的域，iframe 最初设置为 javascript:void 这触发了跨域访问被拒绝错误。

为了解决这个问题，我在我的网站中创建了一个 blank.html 页面，如果我需要提前声明一个 iframe，该 iframe 在通过 javascript 更改之前最初是空白的，然后我将它指向空白页面，以便它`src='/content/blank.html'`位于同一个域中。

或者，您可以完全通过 javascript 创建 iframe，以便在创建时设置 src，但在我的情况下，我使用的库需要已在页面上声明的 iframe。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T01:04:17.327

基本上，当框架内和 ii 外的文档具有不同的域时，就会发生此错误。因此，为了防止跨端脚本浏览器禁用这种执行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T01:15:32.713

如果是域问题（或子域），例如 www.foo.com 向 www.api.foo.com 发送请求

在每个页面上，您可以设置

```
document.domain = www.foo.com 
```

允许“跨域”权限

# html - 将基于表格的 HTML 布局重构为 CSS 的工具？

> ID：151369
> 
> 赞同：5
> 
> 时间：2008-09-30T01:01:58.003
> 
> 标签：html, css, refactoring, css-tables

给定一个 HTML 页面，该页面具有复杂的基于表格的布局和许多重复且浪费的标签，例如：

```
td align="left" class="tableformat" width="65%" style="border-bottom:1px solid #ff9600; border-right:1px solid #ff9600; background-color:#FDD69E" nowrap etc. 
```

是否有工具可以帮助将页面重构为更紧凑的形式？例如，自动生成 CSS 样式和选择器的工具？将表格转换为 div 布局？

*只是为了说明问题的顺序，我正在查看的页面超过 8000 行 HTML 和 JavaScript，不计算*图像是 500Kb ！

* * *

更新：在重新。“放弃，从头开始”评论。在现实世界中，这意味着什么？打印页面，扫描它，在 Dreamweaver 中将其设置为背景图像，然后开始？严重地？这真的会比重构更有效吗？

* * *

更新：我不是在贬低“从头开始跟踪它”，也不是暗示 Dreamweaver 无论如何都是我选择的工具。我很惊讶重构布局被认为是一个棘手的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T01:57:30.693

我不知道具体的工具，只有 caffeine 和[Firebug](http://getfirebug.com/)的通用工具，任何从事 CSS 工作的人都应该知道这些工具。

我认为这个问题非常困难，以至于自动化工具很难生成好的、可维护的标记和 CSS。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T02:15:24.800

似乎您正在寻找更自动化的方法来将旧的基于表格的布局重构为 CSS 标准。但是，我同意“从头开始”的其他一些评论。

这对您意味着您应该尝试重建（使用 CSS）使用 HTML 表格实现的外观。如果这个概念让你无法理解，那么我建议你在谷歌上搜索一些 CSS 初学者教程，甚至可能专注于教授 Table->CSS 布局的概念。

另一个需要考虑的工具（可能会进一步帮助您）是某种 CSS“框架”。我为此推荐[Blueprint CSS](http://code.google.com/p/blueprintcss/)，因为它有助于以最小的努力创建类似网格/表格的布局。另一个不错的是[Yet-Another-Multicolumn-Layout](http://www.yaml.de/en/)，它有一个非常简洁[的多列布局构建器](http://builder.yaml.de/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T02:49:04.860

我同意[TimB](https://stackoverflow.com/questions/151369/tools-for-refactoring-table-based-html-layouts-to-css#151466)的观点，因为自动化工具在执行此操作时会遇到麻烦，尤其是通过关系跳转以最有效的方式组合和抽象 CSS。

如果您正在呈现表格数据，尝试将内联 CSS 重构为可重用类**可能是合理的。**

如果您有很多具有内联样式的类似表格，您可以通过简单的搜索和替换逐步重构 CSS。这将为您提供许多与相似表的子集和许多有些相似的类相匹配的类。将其分解为布局和表示将是一个好的开始，然后用每个主题或语义相关项目的特定类覆盖这些。

我仍然建议**从头开始**，它可能会更快，并且您可以只重新创建呈现页面所需的内容，并且可以在以后重用元素或元素集合。

如果需要再次修改页面，所花费的时间也将得到**显着**回报。

但这**根本**不可能是吗？:D

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T02:31:02.830

不要只是把它扔进dreamweaver 或任何选择的工具中，然后将其分割。首先以纯语义样式编写 HTML。例如，一个非常常见的布局最终会是：

```
<body>
  <div id="header">
    <img id="logo"/>
    <h1 id="title">
      My Site
    </h1>
    <div id="subtitle">Playing with css</div>
  </div>
  <div id="content">
    <h2>Page 1</h2>
    <p>Blah blah blah..</p>
  </div>
  <div id="menu">
    <ul>
      <li><a>Some link</a></li>
      ...
    </ul>
  </div>
</body> 
```

以对您的内容有意义的方式编写 HTML。如果您根本没有 CSS，它应该是可用的。之后，添加 CSS 使其看起来像您想要的那样。现在浏览器/CSS 的状态下，您可能仍然需要向 HTML 添加一些装饰器 - 例如，将一些东西包装在额外的 div 中，以便能够以您想要的方式获取内容。

完成后，您将拥有一个非常灵活的布局，可以使用 CSS 轻松修改，并且您将拥有一个可供残疾人和搜索引擎访问的页面。

在掌握它的诀窍之前确实需要相当多的学习，但这是值得的。抵制放弃并回到基于表格的布局的诱惑，并按照自己的方式进行操作。一切都可以用语义 HTML 和 CSS 来完成。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T02:06:25.697

您在您的问题中贬低了这种方法，但我建议您在浏览器中截取您最喜欢其呈现效果的页面，声明它作为您的参考，然后开始尝试重新创建它。这比你想象的要容易。我不得不采用基于表格的旧式布局，并将它们转换为使用现代技术完成的 CMS 模板，这并不是一项糟糕的工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T03:13:25.443

我目前正在处理一个类似的问题，虽然不像听起来那么混乱，但真正糟糕的 asp.net web 表单、过度的视图状态和深度嵌套的服务器控件会格式化来自数据库的搜索结果。导致 50 个数据库行的标记约为 300 - 400K - 是的。

我还没有找到任何自动化工具可以完成一半合理的重构工作。

从 Visual Studio 之类的工具开始，您可以使用该工具将代码重新格式化为一致的方式会有所帮助。然后，您可以使用正则表达式和矩形选择的组合来开始清除垃圾，剥离多余的标记，开始整理什么是重要的，什么不是，然后开始手动定义一个有效的模式来呈现信息。

诀窍是分解成可管理的块，然后从那里构建它。

如果你有很多实际的“表格数据”要格式化，而且只是一次，我发现 excel 在某些情况下是我的救星，将数据粘贴到工作表中，然后使用连接和填充的组合为表格数据生成标记。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T03:13:38.670

从头开始意味着回到设计绘图板。如果您需要重构这样一个怪物，那么您将花费所有时间使它变得更好，您还不如进行完整的重新设计。

如果你想摆脱重复和浪费的标签，你需要逃离 Dreamweaver。一个好的文本编辑器（jedit、emacs、vim、eclipse 等）真的是你所需要的。如果您正确自定义编辑器，您甚至不会错过 Dreamweaver。（我最喜欢带有 nXhtml 和 yasnippets 的 Emacs。）

# testing - 如何对视频流服务器进行压力测试？

> ID：151392
> 
> 赞同：23
> 
> 时间：2008-09-30T01:14:07.927
> 
> 标签：testing, video, streaming

有谁知道我可以用来在视频流服务器上执行压力测试的任何好工具？我需要测试我的服务器处理 5,000 多个连接的能力。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T03:27:06.440

一种选择是使用 VLC。您可以在命令行上指定一个 url。（详见[此处](http://wiki.videolan.org/VLC_command-line_help)）。然后，您可以编写一个简短的 shell 脚本来打开所有 5000 个连接。

例如。以下 perl 脚本（非常快速的 hack - 运行前检查，可能会导致爆炸等）

```
$i = 0;
$myurl = "udp://someurl";
@cmdline = ("/usr/bin/vlc", "");
for( $i = 1; $i <= 5000; $i++ )
{
    if( $pid = fork )
    {
        # parent - ignore
    }
    elsif( defined $pid )
    {
        $cmdline[1] = sprintf "%s:%d", $myurl, $i;
        exec(@cmdline);
    }
    # elseif - do more error checking here
} 
```

如果您的视频流服务器正在进行多播，那么打开套接字并使其成为 5000 个多播组的成员就足够了（不必对流进行任何操作。通过不实际解码流，您将减少客户端的性能问题）。

我不知道有任何工具可以为您执行此操作，但如果您准备编写自己的实用程序，您可以从[这里](http://tldp.org/HOWTO/Multicast-HOWTO-6.html)开始了解详细信息。

编辑：第二个选项假定您的客户端计算机上的操作系统具有多播功能。我提到这一点是因为（从记忆中）linux内核默认情况下不是，我想为你省去那种痛苦。:-)

简单的判断方法（再次在 Linux 上）是检查是否存在`/proc/net/igmp`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T02:43:20.630

开始下载具有不同连接的 5000 多个相同类型的文件。真的不需要播放它们，因为基本上客户端视频播放器、flash、Windows 媒体播放器等只会进行下载。因此，如果您的服务器可以处理 5000+ 次下载，那您就可以了。我敢打赌，您的带宽会在您的服务器之前发出。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-01-14T21:28:09.503

对于基础架构，您可以使用 JMeter SAAS 或您自己的云服务器来克服注入器可能出现的网络问题。

为了重现用户体验并获得关于用户体验的宝贵指标，您可以使用[Apache JMeter](https://jmeter.apache.org/) + 这个[商业插件](https://ubikloadpack.com/)，它可以真实地模拟玩家的行为，而无需任何脚本：

*   [Apple HTTP 实时流媒体](https://www.ubik-ingenierie.com/blog/easy-and-realistic-load-testing-of-http-live-streaming-hls-with-apache-jmeter/)
*   [MPEG-DASH](https://www.ubik-ingenierie.com/blog/load-testing-mpeg-dash-jmeter-ubik-videostreaming-plugin/)流媒体
*   [流畅的视频流](https://www.ubik-ingenierie.com/blog/load-testing-smooth-streaming-video-with-jmeter/)

这个插件还提供了模拟[自适应比特率流的能力](https://www.ubik-ingenierie.com/blog/videostreaming-plugin-with-live-and-abr-streaming/)

免责声明：我们支持此解决方案的开发

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-11-06T23:55:51.157

一个新的 JMeter 插件已经发布，通过仅使用一个自定义采样器来帮助模拟 HLS 场景。现在，您不需要多个 HTTP 请求采样器、ForEach 控制器或 RegEx 后处理器。这使得整个过程比以前简单得多。

相反，完整的逻辑被无缝封装，因此您只需要关心用例：媒体类型、播放时间和网络条件。就是这样！该插件是全新的，可以通过 JMeter Plugins Manager 安装。

在这里您可以了解更多信息：

[https://abstracta.us/blog/performance-testing/how-to-run-video-streaming-performance-tests-on-hls/](https://abstracta.us/blog/performance-testing/how-to-run-video-streaming-performance-tests-on-hls/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-08-30T05:03:47.693

我也在寻找相同的答案，我遇到以下工具可能对某人有帮助[http://www.radview.com/Solutions/multimedia-load-testing.aspx](http://www.radview.com/Solutions/multimedia-load-testing.aspx)

此工具用于测试视频流。希望它可以帮助某人。如果我得到一个更好的答案，我会更新答案。

谢谢。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2013-06-14T03:36:24.553

该[HLS Analyzer](http://www.mocomsoft.com/en-US/products/HLSAnalyzer.aspx)软件可用于对 HTTP Live Streaming 服务器进行压力测试和监控下载性能。

# installation - 什么是一个很好的免费实用程序来创建带有嵌入式文件版本的自解压可执行文件？

> ID：151403
> 
> 赞同：5
> 
> 时间：2008-09-30T01:20:50.283
> 
> 标签：installation, versioning, self-extracting

根据[这个](https://stackoverflow.com/questions/151250/how-do-i-embed-a-file-version-in-an-msi-file-with-visual-studio)问题的答案，我无法在我的 .msi 文件中嵌入文件版本。

我给客户的安装程序需要有一个文件版本。

所以，我想做的是创建一个包含 msi 文件和由 Visual Studio 生成的 setup.exe 的自解压可执行文件，并将文件版本放在这个自解压可执行文件上。

因此，我需要一个实用程序来创建支持在其输出中嵌入文件版本的自解压可执行文件。它还需要支持解压后自动运行文件，这样我才能自动启动真正的安装程序。如果它是可编写脚本的就好了。

我只能找到[这个](http://www.gdgsoft.com/pb/customize-package.aspx)，它看起来很棒，但我更喜欢免费的替代品。

有没有人有什么建议？

**编辑：**澄清一下，我并不是真的想创建一个安装程序——我已经有一个 VS 安装项目。我只想要一个自解压器（就像 WinZip 可以创建的那样）。因此，用户将鼠标悬停在 Setup-Blorgbeard2008.exe 上，会看到“版本：1.0.0.0”。用户双击它，它会静默地将 setup.exe 和 setup.msi 提取到临时文件夹，然后运行 ​​setup.exe。然后用户会看到正常的安装程序屏幕并正常进行。

**另一个编辑：**是的，我不再需要自解压器了，因为我的另一个问题现在已经得到解答。这使得整个问题几乎无关紧要。*能够*仅分发一个文件而不是 setup.exe 和 setup.msi 仍然很好。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-17T12:44:35.500

有点惊讶它还没有在此处列出：[IExpress](http://technet.microsoft.com/library/Dd346760)是 Windows 附带的一个简单工具，可用于创建自解压安装程序。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T02:50:32.860

NSIS 可以做到这一点。

我们构建环境的一部分是一个脚本，它将版本信息输出到我们的 NSIS 脚本来源的“头”文件。您应该能够使用类似的东西来嵌入您的版本信息，并且您当然可以让 NSIS 在提取后运行文件。

事实上，当 NSIS 创建安装程序包时……您可以大大简化您的方法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T02:46:28.940

下载 Windows SDK 时，有 MSStuff.exe 和 Setup.exe，MS 提供源代码编译。MSIStuff 会将您提供的 MSI “填充”到 Setup.exe 中。然后可以分发 Setup.exe。

更多信息，请访问[http://support.microsoft.com/kb/888473](http://support.microsoft.com/kb/888473)

缺点：

*   每次有新版本的产品 (MSI) 时，您都必须使用产品版本重新编译 Setup.exe。
*   不确定 Setup.exe 源的分发许可证是什么。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T05:08:52.840

实际上，我最终在这个特定版本中使用了 NSIS，因为我还需要捆绑其他一些安装程序。

作为参考，这是我使用的脚本：

```
VIProductVersion              "1.0.0.0" ; set version here
VIAddVersionKey "FileVersion" "1.0.0.0" ; and here!
VIAddVersionKey "CompanyName" "MyCompany"
VIAddVersionKey "LegalCopyright" "© MyCompany"
VIAddVersionKey "FileDescription" "Installer for MyProgram"
OutFile MyProgram-Setup.exe

SilentInstall silent

Section Main    
    SetOutPath $TEMP
    SetOverwrite on
    File SharedManagementObjects.msi
    File SQLSysClrTypes.msi
    File Release\Setup.exe
    File Release\Setup.msi
    ExecWait 'msiexec /passive /i "$OUTDIR\SharedManagementObjects.msi"'
    ExecWait 'msiexec /passive /i "$OUTDIR\SQLSysClrTypes.msi"'
    Exec     '"$OUTDIR\Setup.exe"'
SectionEnd 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-10-22T20:42:34.670

[DotNetZip](http://dotnetzip.codeplex.com)可以生成自解压存档，其中包括显示在 Windows 资源管理器鼠标悬停中的版本号。SFX 还包括产品名称、描述、产品版本和版权，显示在 Windows 资源管理器的“属性/详细信息”视图中。

SFX 可以运行您在提取后指定的命令。

SFX 的创建可以从 powershell 编写脚本，或者您可以编写一个程序来执行它，使用 VB.NET、C#、VBScript 或 JavaScript 等。

要获取版本号，您至少需要 v1.9.0.26 的 DotNetZip。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-30T01:35:06.927

尝试[inno-setup](http://www.innosetup.com/isinfo.php)

将 VersionInfoVersion 指令设置为您的二进制版本号，例如

```
VersionInfoVersion = 1.1.0.0 
```

这将出现在鼠标悬停文本和属性中

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T01:40:01.267

[nsis](http://nsis.sourceforge.net/Main_Page)看起来是个不错的选择

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-30T01:58:38.960

在这里进行实验：

弹出版本信息： [http ://screencast.com/t/LVqvLfxCj3g](http://screencast.com/t/LVqvLfxCj3g)

来自 Visual Studio 程序集信息： [http ://screencast.com/t/fqunlMNh13](http://screencast.com/t/fqunlMNh13)

使用普通的旧 MSI 文件安装。

通过将“版本：1.5.0”文本添加到设置项目的描述属性中，版本号也会显示在 MSI 文件中，如下所示： [http ://screencast.com/t/A499i6jS](http://screencast.com/t/A499i6jS)

我通常只是为了我自己的目的重命名 MSI 文件，比如 DataMonkey_1_5_0.msi。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-01-27T22:59:11.273

仅供参考，如果您使用引导程序 setup.exe 来验证 .NET 是否已安装（DotNetZip 自解压器需要 .NET 2.0），则使用 DotNetZip 自解压器没有意义。

# x11 - 如何从进程 ID 获取 X11 窗口？

> ID：151407
> 
> 赞同：60
> 
> 时间：2008-09-30T01:23:59.777
> 
> 标签：x11

在 Linux 下，我的 C++ 应用程序使用 fork() 和 execv() 来启动多个 OpenOffice 实例，以便查看一些幻灯片放映。这部分有效。

接下来，我希望能够将 OpenOffice 窗口移动到显示器上的特定位置。我可以使用 XMoveResizeWindow() 函数来做到这一点，但我需要为每个实例找到窗口。

我有每个实例的进程 ID，如何从中找到 X11 窗口？

* * *

**更新**- 感谢安迪的建议，我已经完成了这个。我在此处发布代码以与 Stack Overflow 社区分享。

不幸的是，Open Office 似乎没有设置 _NET_WM_PID 属性，所以这并不能最终解决我的问题，但它确实回答了这个问题。

```
// Attempt to identify a window by name or attribute.
// by Adam Pierce <adam@doctort.org>

#include <X11/Xlib.h>
#include <X11/Xatom.h>
#include <iostream>
#include <list>

using namespace std;

class WindowsMatchingPid
{
public:
    WindowsMatchingPid(Display *display, Window wRoot, unsigned long pid)
        : _display(display)
        , _pid(pid)
    {
    // Get the PID property atom.
        _atomPID = XInternAtom(display, "_NET_WM_PID", True);
        if(_atomPID == None)
        {
            cout << "No such atom" << endl;
            return;
        }

        search(wRoot);
    }

    const list<Window> &result() const { return _result; }

private:
    unsigned long  _pid;
    Atom           _atomPID;
    Display       *_display;
    list<Window>   _result;

    void search(Window w)
    {
    // Get the PID for the current Window.
        Atom           type;
        int            format;
        unsigned long  nItems;
        unsigned long  bytesAfter;
        unsigned char *propPID = 0;
        if(Success == XGetWindowProperty(_display, w, _atomPID, 0, 1, False, XA_CARDINAL,
                                         &type, &format, &nItems, &bytesAfter, &propPID))
        {
            if(propPID != 0)
            {
            // If the PID matches, add this window to the result set.
                if(_pid == *((unsigned long *)propPID))
                    _result.push_back(w);

                XFree(propPID);
            }
        }

    // Recurse into child windows.
        Window    wRoot;
        Window    wParent;
        Window   *wChild;
        unsigned  nChildren;
        if(0 != XQueryTree(_display, w, &wRoot, &wParent, &wChild, &nChildren))
        {
            for(unsigned i = 0; i < nChildren; i++)
                search(wChild[i]);
        }
    }
};

int main(int argc, char **argv)
{
    if(argc < 2)
        return 1;

    int pid = atoi(argv[1]);
    cout << "Searching for windows associated with PID " << pid << endl;

// Start with the root window.
    Display *display = XOpenDisplay(0);

    WindowsMatchingPid match(display, XDefaultRootWindow(display), pid);

// Print the result.
    const list<Window> &result = match.result();
    for(list<Window>::const_iterator it = result.begin(); it != result.end(); it++)
        cout << "Window #" << (unsigned long)(*it) << endl;

    return 0;
} 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-30T02:27:54.990

我知道这样做的唯一方法是遍历窗口树，直到找到所需的内容。遍历并不难（如果需要示例，只需查看 xwininfo.c 即可了解 xwininfo -root -tree 的作用）。

但是你如何识别你正在寻找的窗口呢？ **一些**应用程序设置了一个名为 _NET_WM_PID 的窗口属性。

我相信 OpenOffice*是*设置该属性的应用程序之一（就像大多数 Gnome 应用程序一样），所以你很幸运。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2010-05-02T18:42:26.280

检查 /proc/PID/environ 是否包含名为 WINDOWID 的变量

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2012-11-20T21:00:51.637

派对迟到了。然而：早在 2004 年，Harald Welte 发布了一个代码片段，该代码片段通过 LD_PRELOAD 包装了 XCreateWindow() 调用并将进程 ID 存储在 _NET_WM_PID 中。这确保创建的每个窗口都有一个 PID 条目。

[http://www.mail-archive.com/devel@xfree86.org/msg05806.html](http://www.mail-archive.com/devel@xfree86.org/msg05806.html)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2014-12-15T14:22:54.493

尝试安装`xdotool`，然后：

```
#!/bin/bash
# --any and --name present only as a work-around, see: https://github.com/jordansissel/xdotool/issues/14
ids=$(xdotool search --any --pid "$1" --name "dummy") 
```

我确实得到了很多身份证。当使用长命令完成时，我使用它来将终端窗口设置为紧急程序`seturgent`。我只是遍历所有我从中获得的 id`xdotool`并`seturgent`在它们上运行。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T02:20:57.347

没有什么好办法。我看到的唯一真正的选择是：

1.  您可以查看进程的地址空间以查找连接信息和窗口 ID。
2.  您可以尝试使用 netstat 或 lsof 或 ipcs 将连接映射到 Xserver，然后（不知何故！您至少需要 root）查看其连接信息以找到它们。
3.  当生成一个实例时，你可以等到另一个窗口被映射，假设它是正确的，然后继续。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-04-30T13:14:39.240

我利用一些现代 C++ 特性自由地重新实现了 OP 的代码。它保持相同的功能，但我认为它读起来更好一些。即使向量插入碰巧抛出，它也不会泄漏。

```
// Attempt to identify a window by name or attribute.
// originally written by Adam Pierce <adam@doctort.org>
// revised by Dario Pellegrini <pellegrini.dario@gmail.com>

#include <X11/Xlib.h>
#include <X11/Xatom.h>
#include <iostream>
#include <vector>

std::vector<Window> pid2windows(pid_t pid, Display* display, Window w) {
  struct implementation {
    struct FreeWrapRAII {
      void * data;
      FreeWrapRAII(void * data): data(data) {}
      ~FreeWrapRAII(){ XFree(data); }
    };

    std::vector<Window> result;
    pid_t pid;
    Display* display;
    Atom atomPID;

    implementation(pid_t pid, Display* display): pid(pid), display(display) {
      // Get the PID property atom
      atomPID = XInternAtom(display, "_NET_WM_PID", True);
      if(atomPID == None) {
        throw std::runtime_error("pid2windows: no such atom");
      }
    }

    std::vector<Window> getChildren(Window w) {
      Window    wRoot;
      Window    wParent;
      Window   *wChild;
      unsigned  nChildren;
      std::vector<Window> children;
      if(0 != XQueryTree(display, w, &wRoot, &wParent, &wChild, &nChildren)) {
        FreeWrapRAII tmp( wChild );
        children.insert(children.end(), wChild, wChild+nChildren);
      }
      return children;
    }

    void emplaceIfMatches(Window w) {
      // Get the PID for the given Window
      Atom           type;
      int            format;
      unsigned long  nItems;
      unsigned long  bytesAfter;
      unsigned char *propPID = 0;
      if(Success == XGetWindowProperty(display, w, atomPID, 0, 1, False, XA_CARDINAL,
                                       &type, &format, &nItems, &bytesAfter, &propPID)) {
        if(propPID != 0) {
          FreeWrapRAII tmp( propPID );
          if(pid == *reinterpret_cast<pid_t*>(propPID)) {
            result.emplace_back(w);
          }
        }
      }
    }

    void recurse( Window w) {
      emplaceIfMatches(w);
      for (auto & child: getChildren(w)) {
        recurse(child);
      }
    }

    std::vector<Window> operator()( Window w ) {
      result.clear();
      recurse(w);
      return result;
    }
  };
  //back to pid2windows function
  return implementation{pid, display}(w);
}

std::vector<Window> pid2windows(const size_t pid, Display* display) {
  return pid2windows(pid, display, XDefaultRootWindow(display));
}

int main(int argc, char **argv) {
  if(argc < 2)
    return 1;

  int pid = atoi(argv[1]);
  std::cout << "Searching for windows associated with PID " << pid << std::endl;

  // Start with the root window.
  Display *display = XOpenDisplay(0);
  auto res = pid2windows(pid, display);

  // Print the result.
  for( auto & w: res) {
    std::cout << "Window #" << static_cast<unsigned long>(w) << std::endl;
  }

  XCloseDisplay(display);
  return 0;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T02:13:55.430

你确定你有每个实例的进程 ID 吗？我对 OOo 的经验是，尝试运行 OOo 的第二个实例只是与 OOo 的第一个实例对话，并告诉它打开附加文件。

我认为您将需要使用 X 的消息发送功能来很好地询问它的窗口。我希望 OOo 在某处记录其覆盖范围。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-04-23T00:33:55.077

如果你使用 python，我在[这里](https://bbs.archlinux.org/viewtopic.php?id=113346)找到了一个方法，这个想法来自[BurntSushi](https://github.com/BurntSushi/)

如果您启动了应用程序，那么您应该知道它的 cmd 字符串，使用它可以减少对 的调用`xprop`，您可以随时循环遍历所有 xid 并检查 pid 是否与您想要的 pid 相同

```
import subprocess
import re

import struct
import xcffib as xcb
import xcffib.xproto

def get_property_value(property_reply):
    assert isinstance(property_reply, xcb.xproto.GetPropertyReply)

    if property_reply.format == 8:
        if 0 in property_reply.value:
            ret = []
            s = ''
            for o in property_reply.value:
                if o == 0:
                    ret.append(s)
                    s = ''
                else:
                    s += chr(o)
        else:
            ret = str(property_reply.value.buf())

        return ret
    elif property_reply.format in (16, 32):
        return list(struct.unpack('I' * property_reply.value_len,
                                  property_reply.value.buf()))

    return None

def getProperty(connection, ident, propertyName):

    propertyType = eval(' xcb.xproto.Atom.%s' % propertyName)

    try:
        return connection.core.GetProperty(False, ident, propertyType,
                                        xcb.xproto.GetPropertyType.Any,
                                        0, 2 ** 32 - 1)
    except:
        return None

c = xcb.connect()
root = c.get_setup().roots[0].root

_NET_CLIENT_LIST = c.core.InternAtom(True, len('_NET_CLIENT_LIST'),
                                     '_NET_CLIENT_LIST').reply().atom

raw_clientlist = c.core.GetProperty(False, root, _NET_CLIENT_LIST,
                                    xcb.xproto.GetPropertyType.Any,
                                    0, 2 ** 32 - 1).reply()

clientlist = get_property_value(raw_clientlist)

cookies = {}

for ident in clientlist:
    wm_command = getProperty(c, ident, 'WM_COMMAND')
    cookies[ident] = (wm_command)

xids=[]

for ident in cookies:
    cmd = get_property_value(cookies[ident].reply())
    if cmd and spref in cmd:
        xids.append(ident)

for xid in xids:
    pid = subprocess.check_output('xprop -id %s _NET_WM_PID' % xid, shell=True)
    pid = re.search('(?<=\s=\s)\d+', pid).group()

    if int(pid) == self.pid:
        print 'found pid:', pid
        break

print 'your xid:', xid 
```

# c# - 调用Web服务时如何解决HTTP状态405“Method Not Allowed”

> ID：151413
> 
> 赞同：19
> 
> 时间：2008-09-30T01:26:16.510
> 
> 标签：c#, .net, web-services, wse2.0

我有一个需要访问具有 WSE 2.0 安全性的 SOAP Web 服务的情况。我已经获得了所有生成的 c# 代理（从 Microsoft.Web.Services2.WebServicesClientProtocol 派生），我正在应用证书，但是当我调用一个方法时出现错误：

```
System.Net.WebException : The request failed with HTTP status 405: Method Not Allowed.
   at System.Web.Services.Protocols.SoapHttpClientProtocol.ReadResponse(SoapClientMessage message, WebResponse response, Stream responseStream, Boolean asyncCall)
   at System.Web.Services.Protocols.SoapHttpClientProtocol.Invoke(String methodName, Object[] parameters) 
```

我做了一些谷歌搜索，看来这是一个服务器配置问题。但是这个网络服务被很多客户端使用没有任何问题（网络服务是由新西兰电信提供的，所以它必须正确配置。我相信它是用Java编写的）

任何人都可以对这个问题有所了解吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-06T00:24:48.370

好的，找到问题所在了。我试图调用 .wsdl url 而不是 .asmx url。嗬！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-03-02T20:29:58.883

我发现这是由于 IIS 上没有安装 WCF。主要的是 .svc 扩展名必须在 IIS 中映射，[请参阅此处的 MSDN。](http://msdn.microsoft.com/en-us/library/ms752252%28v=vs.90%29.aspx)使用 ServiceModelReg 工具完成安装。每当您获得一台新机器或重新安装 IIS 时，您总是希望验证 WCF 已安装并且 .svc 已映射到 IIS。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-04-07T16:37:09.777

我有同样的问题，但细节不同：

我们使用的 URL 没有文件 (.asmx) 部分。在浏览器中调用 URL 是可以的。它还可以在通过 Visual Studio 设置 URL 的简单客户端中工作。但是动态设置 URL 没有用！它给出了相同的 405 错误。

最后我们发现将文件部分添加到Web Service Url中解决了这个问题。也许是一个 .Net 框架错误？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2019-03-18T14:01:45.410

您需要启用 HTTP 激活

转到控制面板 > Windows 功能 > .NET Framework 4.5 高级服务 > WCF 服务 > HTTP 激活

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T01:28:27.473

嗯，其他客户端是否也在使用 C#/.NET？

不允许的方法 --> 这可以是 REST 服务，而不是 SOAP Web 服务吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-01-15T15:48:13.017

在我的情况下，问题是应用程序配置的格式/调用不正确：在配置中，服务 url 使用“localhost”作为域名，但真正的主机名与我调用的 URL 不同:(所以我在配置中更改了“localhost”到我在 URL 中使用的域名。就是这样！

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2013-05-31T07:57:32.743

MethodNotAllowed 等效于 HTTP 状态 405。 MethodNotAllowed 表示在请求的资源上不允许使用请求方法（POST 或 GET）。

问题在于您的 enpoint uri 不完整或 wcf 的地址不正确 - .scv 检查您的 proxy.enpoint 或 wcf client.enpoint uri 是否正确。

# java - 解释 Mac OSX Leopard 上的 JVM 目录布局

> ID：151414
> 
> 赞同：8
> 
> 时间：2008-09-30T01:26:18.087
> 
> 标签：java, macos, jvm

这是 Leopard 安装的目录布局。什么是“A”目录，为什么除了“CurrentJDK”之外还有“Current”目录？

看来您可以通过移动 CurrentJDK 链接轻松切换当前 JDK，但是 Current 和 A 下的内容将不同步。

```
lrwxr-xr-x 1 根轮 5 Jun 14 15:49 1.3 -> 1.3.1
drwxr-xr-x 3 根轮 102 2008 年 1 月 14 日 1.3.1
lrwxr-xr-x 1 根轮 5 Feb 21 2008 1.4 -> 1.4.2
lrwxr-xr-x 1 根轮 3 Jun 14 15:49 1.4.1 -> 1.4
drwxr-xr-x 8 根轮 272 2008 年 2 月 21 日 1.4.2
lrwxr-xr-x 1 根轮 5 Feb 21 2008 1.5 -> 1.5.0
drwxr-xr-x 8 根轮 272 2008 年 2 月 21 日 1.5.0
lrwxr-xr-x 1 根轮 5 Jun 14 15:49 1.6 -> 1.6.0
drwxr-xr-x 8 根轮 272 Jun 14 15:49 1.6.0
drwxr-xr-x 8 根轮 272 Jun 14 15:49 A
lrwxr-xr-x 1 根轮 1 Jun 14 15:49 当前 -> A
lrwxr-xr-x 1 根轮 3 Jun 14 15:49 CurrentJDK -> 1.5
史蒂夫-mbp /System/Library/Frameworks/JavaVM.framework/Versions $

```

和A的内容

```
-rw-r--r-- 1 个根轮 1925 年 2 月 29 日 2008 代码资源
drwxr-xr-x 34 根轮 1156 Jun 14 15:49 命令
drwxr-xr-x 3 根轮 102 2008 年 3 月 6 日
drwxr-xr-x 16 根轮 544 Jun 14 15:49 标头
-rwxr-xr-x 1 根轮 236080 2008 年 2 月 29 日 JavaVM
drwxr-xr-x 29 根轮 986 Jun 14 15:49 资源
史蒂夫-mbp /System/Library/Frameworks/JavaVM.framework/Versions/A $

```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T01:56:30.120

( `A`,`Current`符号链接到`A`) 是 Mac OS X 框架结构的一部分，即`JavaVM.framework`。除了实际的 JVM 安装之外，该框架中可能包含 C 或 Objective-C 代码。因此，除了包含 JVM 之外，它还可能与某些 C 或 Objective-C 代码相关联。

请注意，您**不应**将`CurrentJDK`链接更改为指向 Mac OS X 设置的任何内容。与其他平台不同，Java 虚拟机是 Mac OS X 上的操作系统服务，以这种方式更改它会使您处于不受支持（并且可能未经测试、不稳定等）的配置。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-30T02:19:12.607

您应该使用 Java Preferences 命令来更改 jvm 版本。

如果你的硬盘上有亮点，你可以只关注“Java Preferences”

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T02:14:43.633

如果您想恢复到较旧的 JVM（此处为 1.5），您可以将以下内容放入您的`~/.profile`（或将其粘贴到特定的终端窗口中）：

```
export JAVA_HOME="/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Home/"
export PATH=$JAVA_HOME/bin/:$PATH 
```

# c++ - 在特定对象实例上调用 C++ 函数指针

> ID：151418
> 
> 赞同：13
> 
> 时间：2008-09-30T01:29:46.877
> 
> 标签：c++, pointers, function

我有一个由以下定义的函数指针：

```
typedef void (*EventFunction)(int nEvent); 
```

有没有办法使用 C++ 对象的特定实例来处理该函数？

```
class A
{
private:
    EventFunction handler;

public:
    void SetEvent(EventFunction func) { handler = func; }

    void EventOne() { handler(1); }
};

class B
{
private:
    A a;
public:
    B() { a.SetEvent(EventFromA); }  // What do I do here?

    void EventFromA(int nEvent) { // do stuff }
}; 
```

**编辑：** Orion 指出了 Boost 提供的选项，例如：

```
boost::function<int (int)> f;
X x;
f = std::bind1st(
      std::mem_fun(&X::foo), &x);
f(5); // Call x.foo(5) 
```

不幸的是，Boost 对我来说不是一个选择。是否有某种可以用 C++ 编写的“currying”函数，它将指向成员函数的指针包装到普通函数指针中？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-30T01:51:27.603

您可以使用函数指针来索引给定对象实例的 vtable。这称为[成员函数指针](http://www.parashift.com/c++-faq-lite/pointers-to-members.html)。您的语法需要更改以使用“.*”和“&::”运算符：

```
class A;
class B;
typedef void (B::*EventFunction)(int nEvent) 
```

进而：

```
class A
{
private:
    EventFunction handler;

public:
    void SetEvent(EventFunction func) { handler = func; }

    void EventOne(B* delegate) { ((*delegate).*handler)(1); } // note: ".*"
};

class B
{
private:
    A a;
public:
    B() { a.SetEvent(&B::EventFromA); } // note: "&::"

    void EventFromA(int nEvent) { /* do stuff */ }
}; 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-30T01:42:46.283

远离原始 C++ 函数指针，并[`std::function`](http://msdn.microsoft.com/en-us/library/bb982519.aspx)改用它。

[`boost::function`](http://www.boost.org/doc/libs/1_36_0/doc/html/function/tutorial.html#id2903300)如果您使用的是不支持 C++11 的旧编译器，例如 Visual Studio 2008，则可以使用。
`boost:function`并且`std::function`是同一件事 - 他们将相当多的提升内容放入 C++11 的标准库中。

注意：您可能需要阅读 boost 函数文档而不是 microsoft 文档，因为它更容易理解

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-30T04:29:56.427

我强烈推荐 Don Clugston 出色的 FastDelegate 库。它提供了您对真正委托的所有期望，并在大多数情况下编译为一些 ASM 指令。随附的文章也很好地阅读了成员函数指针。

[http://www.codeproject.com/KB/cpp/FastDelegate.aspx](http://www.codeproject.com/KB/cpp/FastDelegate.aspx)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-30T01:37:38.760

您可能会发现[Marshall Cline 的 C++ FAQ](http://www.parashift.com/c++-faq/pointers-to-members.html)对您想要完成的工作很有帮助。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T01:40:53.667

阅读[指向成员](http://msdn.microsoft.com/en-us/library/f2wbycwh.aspx)的指针。要在派生类上调用方法，该方法必须在基类中声明为虚拟方法并在基类中覆盖，并且您的指针应指向基类方法。更多关于[指向虚拟成员](http://msdn.microsoft.com/en-us/library/fa0207h3.aspx)的指针。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-30T04:17:27.440

如果您正在与 C 库交互，那么您不能使用类成员函数而不使用`boost::bind`. 大多数采用回调函数的 C 库通常还允许您传递您选择的额外参数（通常是 type `void*`），您可以使用它来引导您的类，如下所示：

```
 class C
{
public:
  int Method1(void) { return 3; }
  int Method2(void) { return x; }

  int x;
};

// This structure will hold a thunk to
struct CCallback
{
  C *obj;  // Instance to callback on
  int (C::*callback)(void);  // Class callback method, taking no arguments and returning int
};

int CBootstrapper(CCallback *pThunk)
{
  // Call the thunk
  return ((pThunk->obj) ->* (pThunk->callback))( /* args go here */ );
}

void DoIt(C *obj, int (C::*callback)(void))
{
  // foobar() is some C library function that takes a function which takes no arguments and returns int, and it also takes a void*, and we can't change it
  struct CCallback thunk = {obj, callback};
  foobar(&CBootstrapper, &thunk);
}

int main(void)
{
  C c;
  DoIt(&c, &C::Method1);  // Essentially calls foobar() with a callback of C::Method1 on c
  DoIt(&c, &C::Method2);  // Ditto for C::Method2
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T01:36:47.903

不幸的是，EventFunction 类型不能指向 B 的函数，因为它不是正确的类型。您可以将其设为正确的类型，但这可能不是您真正想要的解决方案：

`typedef void (*B::EventFunction)(int nEvent);`

...然后，一旦您使用 B 的对象调用回调，一切正常。但是您可能希望能够调用 B 之外的函数，在其他执行其他操作的类中。这就是回调的重点。但现在这种类型肯定指向 B 中的某些东西。更有吸引力的解决方案是：

*   使 B 成为基类，然后为可能被调用的每个其他类覆盖一个虚函数。然后 A 存储指向 B 的指针而不是函数指针。干净多了。
*   如果您不想将函数绑定到特定的类类型，甚至是基类（我不会责怪您），那么我建议您将被称为静态函数的函数：“ `static void EventFrom A(int nEvent);`”。然后你可以直接调用它，而不需要 B 的对象。但你可能希望它调用 B 的特定实例（除非 B 是单例）。
*   因此，如果您希望能够调用 B 的特定实例，但也能够调用非 B 的实例，那么您需要将其他内容传递给您的回调函数，以便回调函数可以调用正确的对象。如上所述，使您的函数成为静态函数，并添加一个 void* 参数，您将创建一个指向 B 的指针。

在实践中，您会看到此问题的两种解决方案：传递 void* 和事件的临时系统，以及在基类中具有虚函数的层次结构，如窗口系统

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-30T04:48:28.833

你提到提升不是你的选择，但你有可用的 TR1 吗？

TR1 提供基于 boost 库的函数、绑定和 mem_fn 对象，您可能已经将它与编译器捆绑在一起。它还不是标准的，但我最近使用的至少两个编译器都有它。

[http://en.wikipedia.org/wiki/Technical_Report_1](http://en.wikipedia.org/wiki/Technical_Report_1)
[http://msdn.microsoft.com/en-us/library/bb982702.aspx](http://msdn.microsoft.com/en-us/library/bb982702.aspx)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T01:41:05.197

有点不清楚您要在这里完成什么。很明显，函数指针不是办法。

也许您正在寻找的是指向方法的指针。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-30T04:04:54.927

我有一组类用于我在我的 c++ 框架中使用的这个确切的东西。

[http://code.google.com/p/kgui/source/browse/trunk/kgui.h](http://code.google.com/p/kgui/source/browse/trunk/kgui.h)

我如何处理它是每个可以用作回调的类函数都需要一个将对象类型绑定到它的静态函数。我有一组自动执行此操作的宏。它创建了一个具有相同名称的静态函数，除了带有“CB_”前缀和一个额外的第一个参数，即类对象指针。

查看类类型 kGUICallBack 及其各种模板版本，以处理不同的参数组合。

```
#define CALLBACKGLUE(classname , func) static void CB_ ## func(void *obj) {static_cast< classname *>(obj)->func();}
#define CALLBACKGLUEPTR(classname , func, type) static void CB_ ## func(void *obj,type *name) {static_cast< classname *>(obj)->func(name);}
#define CALLBACKGLUEPTRPTR(classname , func, type,type2) static void CB_ ## func(void *obj,type *name,type2 *name2) {static_cast< classname *>(obj)->func(name,name2);}
#define CALLBACKGLUEPTRPTRPTR(classname , func, type,type2,type3) static void CB_ ## func(void *obj,type *name,type2 *name2,type3 *name3) {static_cast< classname *>(obj)->func(name,name2,name3);}
#define CALLBACKGLUEVAL(classname , func, type) static void CB_ ## func(void *obj,type val) {static_cast< classname *>(obj)->func(val);} 
```

# web-services - 从 Web 服务调用返回空值

> ID：151434
> 
> 赞同：4
> 
> 时间：2008-09-30T01:40:03.730
> 
> 标签：web-services

我有一个网络服务 API。一些调用返回包含用户提供信息的文本字段的对象。从设计和安全的角度来看，当没有提供信息时，在这些字段中返回 null 有什么缺点？除了通过不需要客户端代码检查空值来简化 API 之外，始终返回空字符串是否有明显的优势？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T04:17:23.197

**简短的回答：**不要在 web 服务中使用 null。

一般来说，我建议坚持使用空字符串而不是空字符串，除非含义是零字符。我宁愿仅将 null 用作“未定义”。例如，对于用户输入，如果用户输入该字段并且没有输入任何内容，那么这将是一个空字符串。但是如果用户只是跳过该字段，那可能是空的。

在我定义 null 的含义之前，我倾向于返回一个空字符串并在处理端使用 String.IsNUllOrEmpty，因为代替任何未来的知识，我应该假设 null 和 empty 是相同的。

但是 Web 服务有一个特殊的转折点，那就是``<element/>``在``<element></element>``. 足够的混乱，除非我控制整个事情，否则我不相信互操作性是可以接受的。

因此，如果我需要表示一个像 null 这样的概念，我将创建一个单独的布尔元素来指示存在/不存在。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T01:59:16.040

这完全取决于您是否将空字符串值视为在语义上与空字符串不同。

如果 null 和空字符串都意味着该字段没有数据，那么我认为没有理由不通过不必检查和返回空字符串来简化客户的生活。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-22T02:29:21.323

我个人更喜欢返回空值而不是空字符串。如果数据库有一个空值，返回该值的 Web 服务应该返回空值而不是空字符串。

话虽如此，我遇到了一些问题，像 Adob​​e Flex 之类的 Web 服务客户端无法真正使用空值，如果无法修改客户端，您可能必须传入一个空字符串。

无论哪种方式，我都没有看到任何安全问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T03:44:59.547

空只是意味着空。那里没有固有的安全问题。

由于 Web 服务是一个公共 API，因此您应该严格检查所有输入数据并期望出现格式错误的输入。您永远不能假设客户端代码做正确的事情并且不会（恶意或以其他方式）向您发送 null 。

因此，空字符串或其他标记值不会使您免于检查输入，它们也不一定会使生活更轻松。语义上的空字符串也不为空，它们是空的。

对于它的价值，.net SoapFormatter 为 null 生成的 xml 是普通的旧东西，这与空字符串不同。这是一个微不足道的例子，但信息丰富。如果您发送 null ，您也会发送更少的数据，这可能是需要考虑的事情。

```
{
    [WebMethod]
    public MyClass HelloWorld() 
    {
        MyClass val = new MyClass()
        {
            IsValid = false,
            HelloString = "Hello World",
            BlankString = "",
            Nested = new NestedClass { Name = "Bob" }
        };

        return val;
    }

}

public class MyClass
{
    public bool IsValid { get; set; }
    public string HelloString { get; set; }
    public string BlankString { get; set; }
    public string OtherString { get; set; }
    public NestedClass Nested { get; set; }
    public NestedClass NullNested { get; set; }
}

public class NestedClass
{
    public string Name { get; set; }
} 
```

产生以下 xml 响应。请注意响应中完全缺失`OtherString`和缺失的方式，这与.`NullNested``BlankString`

```
<MyClass>
  <IsValid>false</IsValid> 
  <HelloString>Hello World</HelloString> 
  <BlankString /> 
  <Nested>
    <Name>Bob</Name> 
  </Nested>
</MyClass> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T01:54:00.483

我认为返回 null 与返回空字符串不存在安全问题。

为那些没有信息的字段返回 null 并没有任何真正的缺点——这就是 null 的意思。

您可以使用简化客户端代码

```
string.IsNullOrEmpty() 
```

（假设这是.NET）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-04-03T08:03:59.573

仅出于完整性考虑，假设您将一行或一组数据行作为 JSON 字符串返回，则始终有可能完全省略具有空值的字段。这会减少通过网络传输的数据，并且通常可以由任何客户端轻松处理（显然，这样的约定应该记录在某处）。参见例如以下杰克逊配置（它也省略了空集合）：

```
private static ObjectMapper configureMapper(ObjectMapper mapper) {
  mapper.setDefaultPropertyInclusion(JsonInclude.Value.construct(JsonInclude.Include.NON_EMPY, JsonInclude.Include.NON_NULL));
  mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
  return mapper;
} 
```

# php - Haxe 在 PHP 环境中部署的 Web“框架”？

> ID：151438
> 
> 赞同：7
> 
> 时间：2008-09-30T01:41:26.457
> 
> 标签：php, web-frameworks, haxe

最近我一直在看[Haxe](http://haxe.org)，以构建一个应用程序以部署到运行 PHP 的 Apache。好吧，虽然它看起来可能适合我的需求（部署到 PHP，但不使用糟糕的语言），但我没有发现任何东西可以比构建传统的非 MVC PHP 应用程序更容易进行实际应用程序开发。是否有任何我缺少的工具包/框架，这是值得的？

如果它是受 MVC 启发的，那就太好了，而且我肯定想要一种简单的方法来使用漂亮的 URL，尽管如果有必要我可以满足于 mod_rewrite 规则。

编辑：这个想法是**不要**在 PHP 端使用像 CakePHP 这样的东西，而是在 Haxe 端使用像 CakePHP 这样的东西。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-12T18:24:54.067

Haxe 有一个 PureMVC 端口：[https ://github.com/PureMVC/puremvc-haxe-standard-framework/wiki](https://github.com/PureMVC/puremvc-haxe-standard-framework/wiki "PureMVC haXe")

据我所知，这是 Haxe 唯一的事情，但邮件列表中有关于创建自己的框架的讨论，但这可能需要一段时间。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-12-11T02:19:32.083

我很高兴地说 haXigniter 已经被完全重写，以摆脱 Marek 提到的 PHP 框架风格。现在它更多地遵循更好的 OO 原则，并且也是一个标准的 haXe 库，因此升级更加简单。请在[http://github.com/ciscoheat/haxigniter 查看](http://github.com/ciscoheat/haxigniter)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-07T13:41:36.000

我看到有人开始为 Haxe 开发一个名为“Hails”的 MVC 框架，虽然我不知道它是否可用。

hails：一个受 Rails 启发的最小 MVC 网络框架，用于 Haxe / PHP

[http://code.google.com/p/hails/](http://code.google.com/p/hails/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-25T06:53:21.440

看看 HaXigniter，一个新来的孩子：

[http://github.com/ciscoheat/haxigniter](http://github.com/ciscoheat/haxigniter)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-11-15T20:52:28.173

我会劝你自己做。上述框架（不包括 PureMVC）的问题在于它们是为特定语言设计的。Haxigniter 是一个很好的副本，但它具有 PHP4 强制执行的架构。

这是一个很好的练习！让您了解差异并制定底线机制 - 这非常重要，因为您的 haxe 代码将被翻译（因此您有双重抽象 1\. 翻译 2\. 框架很高兴知道如何解决问题；]）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-19T08:40:27.863

我正在为 NekoVM/PHP 开发基于 Haxe 的工具包/框架。它也是围绕 Zend Framework/Ruby-on-Rails-ish MVC 工作流构建的，并具有用于身份验证、缓存、表单验证、会话管理等的各种类。它可以编译为 NekoVM 和 PHP，我已经使用过这个库对于几个网站。不幸的是，目前没有太多可用的文档，但我正在为即将发布的库的第 1 版进行研究。

该项目托管在[http://code.google.com/p/toolkat](http://code.google.com/p/toolkat)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-09-14T08:56:36.450

还有前面的：

*   [http://lib.haxe.org/p/ufront](http://lib.haxe.org/p/ufront)
*   [http://code.google.com/p/ufront/](http://code.google.com/p/ufront/)

它适用于 php 和 neko。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-10-01T04:26:32.563

请参阅 [论坛常见问题解答（第 7 个条目）](http://haxe.org/forum/thread/1323)，但列表和链接可能仍然不相关，因此下面是一些似乎最新的修订列表。

*   [波科](http://code.google.com/p/poko/)
*   [查询](http://haquery.com/haquery/)
*   [uform](http://haxe.org/com/libs/ufront)
*   [维基百科](https://github.com/ncannasse/hxWiki)

但是，如果您只对 MVC 结构感兴趣，那么我怀疑更多的机器人腿类型的方法可能会更好，并且注入也很有用。

*   [未注入](https://github.com/ciscoheat/unject/wiki/Description-and-Quickstart)
*   [立方体](https://github.com/xirsys/cube)
*   [注入](https://github.com/massiveinteractive/minject)
*   [机器人腿](https://github.com/massiveinteractive/mmvc)

# asp-classic - Response.Write vs <%= %>

> ID：151448
> 
> 赞同：27
> 
> 时间：2008-09-30T01:51:12.457
> 
> 标签：asp-classic, vbscript

请记住，这是针对**经典 asp**

更好的是，所有 HTML 都包含在 Response.Write 语句中或通过 <%= %> 将变量插入 HTML。
例如

```
Response.Write "<table>" & vbCrlf
Response.Write "<tr>" &vbCrLf
Response.Write "<td class=""someClass"">" & someVariable & "</td>" & vbCrLf
Response.Write "</tr>" & vbCrLf
Response.Write "</table>" & vbCrLf 
```

VS

```
<table>
  <tr>
     <td class="someClass"><%= someVariable %></td>
  </tr>
</table> 
```

我主要是从性能的角度问，当插入多个变量时，哪个对服务器的影响最小？

如果没有技术差异，那么两者之间的论点是什么？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-09-30T02:59:13.947

首先，您应该考虑的最重要因素是易于维护。您可以购买一个服务器场，而这些钱和时间会浪费在必须破译一个混乱的网站来维护它的情况下。

无论如何，没关系。归根结底，ASP 所做的只是执行一个脚本！ASP 解析器获取页面，并转换`<%= expression %>`为直接的脚本调用，每个连续的 HTML 块都变成一个对`Response.Write`. 生成的脚本将被缓存并重用，除非磁盘上的页面发生更改，这会导致重新计算缓存的脚本。

现在，过多的使用`<%= %>`导致了现代版的“意大利面条代码”：可怕的“标签汤”。您将无法确定逻辑的正面或反面。另一方面，过多地使用 Response.Write 意味着您将永远无法看到页面，直到它呈现。在适当的时候使用`<%= %>`以获得两全其美。

我的第一条规则是注意“可变文本”与“静态文本”的比例。

如果您只有几个地方需要替换可变文本，则`<%= %>`语法非常紧凑且易读。然而，随着`<%= %>`开始积累，它们模糊了越来越多的 HTML，同时 HTML 也越来越模糊了你的逻辑。作为一般规则，一旦您开始使用循环，您需要停止并切换到 Response.Write`。

没有很多其他硬性规定。您需要为您的特定页面（或页面的部分）决定哪个更重要，或者自然更难理解，或更容易破坏：您的逻辑还是您的 HTML？通常是其中之一（我见过数百个案例）

如果你的逻辑更关键，你应该更重视`Response.Write`; 它将使逻辑脱颖而出。如果您对 HTML 更挑剔，请青睐`<%= %>`，这将使页面结构更加明显。

有时我不得不编写两个版本并并排比较它们以确定哪个更易读；这是不得已而为之的办法，但要在代码记忆犹新的时候这样做，三个月后当你不得不进行更改时，你会很高兴。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-30T01:53:02.983

从个人喜好的角度来看，我更喜欢 <%= %> 方法，因为我觉得它可以更好地将变量内容与静态内容分开。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-30T07:46:28.420

这里的许多答案表明这两种方法产生相同的输出，并且选择是编码风格和性能之一。它似乎认为 <% %> 之外的静态内容变成了单个 Response.Write。

然而，更准确的说法是 <% %> 之外的代码是通过 BinaryWrite 发送的。

Response.Write 采用 Unicode 字符串并将其编码为当前的 Response.CodePage，然后将其放入缓冲区。ASP 文件中的静态内容不会发生这种编码。<% %> 之外的字符逐个字节地转储到缓冲区中。

因此，如果 Response.CodePage 与用于保存 ASP 文件的 CodePage 不同，则两种方法的结果可能不同。

例如，假设我将此内容保存在标准 1252 代码页中：-

```
<%
     Response.CodePage = 65001
     Response.CharSet = "UTF-8"
 %>
<p> The British £</p>
<%Response.Write("<p> The British £</p>")%> 
```

第一段是乱码，因为 £ 不会使用 UTF-8 编码发送，第二段很好，因为提供的 Unicode 字符串被编码为 UTF-8。

因此，从性能的角度来看，使用静态内容更可取，因为它不需要编码，但如果保存的代码页与输出代码页不同，则需要注意。出于这个原因，我更喜欢保存为 UTF-8，包括 <%@ codepage=65001 并设置 Response.Charset = "UTF-8"。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-30T03:35:13.923

撇开其他人已经解决的代码可读性/可维护性问题不谈，您的问题特别是关于当您要插入多个变量时的性能 - 所以我假设您将多次重复您的代码片段之类的东西。在这种情况下，您应该通过使用单个 Response.Write 而不连接所有换行符来获得最佳性能：

```
Response.Write "<table><tr><td class=""someClass"">" & someVar & "</td></tr></table>" 
```

浏览器不需要换行符或制表符或任何其他漂亮的格式来解析 HTML。如果您要追求性能，则可以删除所有这些。您还将使您的 HTML 输出更小，这将使您的页面加载时间更快。

在单个变量的情况下，它并没有太大的区别。但是对于多个变量，您希望最小化 HTML 和 ASP 之间的上下文切换——每次从一个变量跳转到另一个变量都会受到打击。

为了在构建更长的语句时提高可读性，您可以在源代码（但不是输出）中使用 VBScript 行继续字符和制表符来表示结构，而不会影响您的性能：

```
Response.Write "<table>" _
        & "<tr>" _
            & "<td class=""someClass"">" & someVar & "</td>" _
        & "</tr>" _
        & "<tr>" _
            & "<td class=""anotherClass"">" & anotherVar & "</td>" _
        & "</tr>" _
        & "<tr>" _
            & "<td class=""etc"">" & andSoOn & "</td>" _
        & "</tr>" _
    & "</table>" 
```

它不像 HTML 版本那样易读，但如果您将大量变量放入输出中（即 HTML 和 ASP 之间的大量上下文切换），您会看到更好的性能。

性能提升是否值得，或者你是否会更好地扩展你的硬件是一个单独的问题——当然，这并不总是一个选择。

**更新：**有关使用 Response.Buffer 提高性能和避免上下文切换的信息，请参阅 Len Cardinal 的这篇 MSDN 文章中的提示 14 和 15：http: [//msdn.microsoft.com/en-us/library/ms972335.aspx#asptips_topic15](http://msdn.microsoft.com/en-us/library/ms972335.aspx#asptips_topic15)。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-30T03:24:54.230

在大多数情况下，出于几个原因，我更喜欢 <%= %> 方法。

1.  HTML 向 IDE 公开，以便对其进行处理，为您提供工具提示、标签关闭等。
2.  在输出 HTML 中保持缩进更容易，这对重新设计布局非常有帮助。
3.  没有在所有内容上附加 vbCrLf 的新行，并再次查看输出源。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-30T02:24:22.377

响应格式将呈现 HTML，如下所示：

```
<table>
<tr>
<td class="someClass">variable value</td>
</tr>
</table> 
```

结果，不仅生成代码的方法不可读，而且结果也会被不恰当地标记。坚持另一个选项。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-30T03:29:28.977

我更喜欢`<%= %>`仅仅因为它使 Javascript 开发更容易。您可以编写引用您的控件的代码，如下所示

```
var myControl = document.getElementById('<%= myControl.ClientID %>'); 
```

然后，我可以在我的 javascript 代码中以任何我喜欢的方式使用该控件，而不必担心硬编码的 ID。

Response.Write 在某些情况下可能会破坏一些 ASP.NET AJAX 代码，因此我尽量避免使用它，除非使用它来呈现自定义控件中的特定内容。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-30T03:59:53.427

我在做 ASP/PHP 时尝试使用 MVC 范例。它使事情更容易维护、重新架构和扩展。在这方面，我倾向于有一个代表模型的页面。它主要是 VB/PHP 并设置变量供以后在视图中使用。它还会在循环时生成大量 HTML 以供以后包含在视图中。然后我有一个代表视图的页面。这主要是带有 <%= %> 标签的 HTML。该模型是视图中的#include -d，然后您就可以走了。控制器逻辑通常在第三页或服务器端的 JavaScript 中完成。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-23T17:45:07.267

我的经典 ASP 生锈了，但是：

```
Response.Write "<table>" & vbCrlf
Response.Write "<tr>" &vbCrLf
Response.Write "<tdclass=""someClass"">" & someVariable & "</td>" & vbCrLf 
Response.Write "</tr>" & vbCrLf 
Response.Write "</table>" & vbCrLf 
```

这是按原样运行的。然而，这：

```
<table>
  <tr>
     <td class="someClass"><%= someVariable %></td>
  </tr>
</table> 
```

结果是：

```
Response.Write"<table>\r\n<tr>\r\n<td class="someClass">"
Response.Write someVariable
Response.Write "</td>\r\n</tr>\r\n</table>" 
```

其中 \r\n 是 vbCrLf

所以从技术上讲，第二个更快。但是，差异将以毫秒为单位测量，所以我不会担心。我会更担心第一个是几乎无法维护的（尤其是 HTML-UI 开发人员），而第二个是微不足道的维护。

@Euro Micelli 的道具 - 维护是关键（这也是为什么像 Ruby、Python 和过去的语言（尽管如此......）C# 和 Java 与 C、C++ 和汇编相提并论的原因——人类可以维护代码，这比将页面加载时间缩短几毫秒更重要。

当然，C/C++ 等都有它们的位置....但不是这样。:)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-30T01:53:13.793

`<%= %>`其余的被扩展为`Response.Write()`最终相同。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-30T01:56:39.387

切换到 Response.Write 并没有提高性能，并且使用快捷表示法可以更快地读取和维护。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-30T02:18:25.667

您应该根据代码重用和代码可维护性（也称为可读性）来构建这些问题。无论哪种方式，实际上都没有性能提升。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-30T03:08:02.817

**<%=Bazify()%>在您从****与一些 HTML 内联**的短表达式生成 HTML 时很有用。

**Response.Write "foo"**当你需要**用大量代码做一些 HTML 内联**时会更好。

从技术上讲，它们是相同的。

但是，谈到您的示例， Response.Write 代码使用 & 进行了很多字符串连接，这[在 VBScript 中非常慢](http://www.asp101.com/articles/john/outputperf/default.asp)。此外，就像[Russell Myers 所说](https://stackoverflow.com/questions/151448/responsewrite-vs#151536)，它的标签方式与您的其他代码不同，这可能是无意的。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-01T08:52:34.743

我同意[Jason](https://stackoverflow.com/users/20540/jason-dufair)的观点，尤其是现在 .NET 提供了一个 MVC 框架来替代最初使用的糟糕的 Web Form/Postback/ViewState。

也许是因为我是老派经典的 ASP/HTML/JavaScript，而不是 VB 桌面应用程序程序员，导致我无法理解“Web 表单的方式”？但我很高兴我们似乎正在走完整个循环，回到[Jason](https://stackoverflow.com/users/20540/jason-dufair)所指的方法论。

考虑到这一点，我总是会在您的有效模板 HTML“视图”中选择包含您的模型/逻辑和 <%= %> 标记的包含页面。您的 HTML 将更具“可读性”，并且您的逻辑将与经典 ASP 允许的一样多；你用那块石头杀死了几只鸟。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-01-28T16:38:15.427

如果您需要编写和维护 Classic ASP 应用程序，您应该查看免费的 KudzuASP 模板引擎。

它能够 100% 地分离代码和 HTML，并允许对原始 asp 页面进行条件内容、变量替换、模板级控制。If-Then-Else、Try-Catch-Finally、Switch-Case 和其他结构标签可用，以及基于 asp 页面或动态可加载库（asp 代码文件）的自定义标签 结构标签可以嵌入到其他结构中标记到任何所需的级别。

自定义标签和标签库很容易编写，可以包含在 asp 页面的代码级别，也可以在模板级别使用包含标签。

可以通过在母版页级别调用模板引擎并为任何内部内容利用第二个子模板引擎来编写母版页。

在 KudzuASP 中，您的 asp 页面只包含代码、创建模板引擎、设置初始条件并调用模板。该模板包含 HTML 布局。一旦 asp 页面调用模板，它就会成为一个事件驱动的资源，完全由模板的评估和它包含的结构驱动。

# .net - String.Empty 和“”（空字符串）有什么区别？

> ID：151472
> 
> 赞同：323
> 
> 时间：2008-09-30T01:59:47.333
> 
> 标签：.net, double-quotes, string

在 .NET 中， 和 之间有什么区别`String.Empty`，`""`它们是否可以互换，或者是否存在一些围绕相等性的潜在参考或本地化问题`String.Empty`可以确保不存在问题？

* * *

## 回答 #1

> 赞同：330
> 
> 时间：2008-09-30T02:02:38.607

在 .NET 2.0 之前的版本中，`""`创建一个对象而不`string.Empty`创建对象^([ref](https://docs.microsoft.com/archive/blogs/brada/string-empty-vs))，这样`string.Empty`效率更高。

在 .NET 2.0 及更高版本中，所有出现的 都`""`指代相同的字符串文字，这意味着`""`等同于`.Empty`，但仍不如`.Length == 0`.

`.Length == 0`是最快的选择，但`.Empty`代码更简洁。

有关详细信息，请参阅[.NET 规范](https://www.ecma-international.org/publications/standards/Ecma-334.htm)。

* * *

## 回答 #2

> 赞同：219
> 
> 时间：2012-12-04T12:39:12.817

> String.Empty 和 "" 有什么区别，它们可以互换吗

[`string.Empty`](http://msdn.microsoft.com/en-us/library/system.string.empty.aspx)是一个只读字段，而`""`是一个编译时间常数。他们表现不同的地方是：

**C# 4.0 或更高版本中的默认参数值**

```
void SomeMethod(int ID, string value = string.Empty)
// Error: Default parameter value for 'value' must be a compile-time constant
{
    //... implementation
} 
```

**switch 语句中的 case 表达式**

```
string str = "";
switch(str)
{
    case string.Empty: // Error: A constant value is expected. 
        break;

    case "":
        break;

} 
```

**属性参数**

```
[Example(String.Empty)]
// Error: An attribute argument must be a constant expression, typeof expression 
//        or array creation expression of an attribute parameter type 
```

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2008-09-30T02:19:32.123

之前的答案对于 .NET 1.1 是正确的（查看他们链接的帖子的日期：2003 年）。从 .NET 2.0 及更高版本开始，基本上没有区别。无论如何，JIT 最终都会引用堆上的同一个对象。

根据 C# 规范，第 2.4.4.5 节：http: [//msdn.microsoft.com/en-us/library/aa691090 (VS.71).aspx](http://web.archive.org/web/20130328171027/http://msdn.microsoft.com/en-us/library/aa691090(VS.71).aspx)

> 每个字符串文字不一定会产生一个新的字符串实例。当根据字符串相等运算符（第 7.9.7 节）等效的两个或多个字符串文字出现在同一个程序集中时，这些字符串文字引用同一个字符串实例。

甚至有人在 Brad Abram 的帖子的评论中提到了这一点

综上所述，"" 与 String.Empty 的实际结果是 nil。JIT 最终会解决这个问题。

就我个人而言，我发现 JIT 比我聪明得多，所以我尽量不要对像这样的微编译器优化过于聪明。与我或 C# 编译器之前预期的相比，JIT 将在更合适的时间更好地展开 for() 循环、删除冗余代码、内联方法等。让 JIT 完成它的工作 :)

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2008-10-01T03:18:03.957

`String.Empty`是一个*只读*字段，`""`而是一个*const*。这意味着您不能`String.Empty`在 switch 语句中使用，因为它不是常量。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2013-06-30T02:07:51.477

另一个区别是 String.Empty 生成更大的 CIL 代码。虽然引用 "" 和 String.Empty 的代码长度相同，但编译器不会为 String.Empty 参数优化字符串连接（请参阅 Eric Lippert 的[博客文章）。](http://ericlippert.com/2013/06/17/string-concatenation-behind-the-scenes-part-one)以下等价函数

```
string foo()
{
    return "foo" + "";
}
string bar()
{
    return "bar" + string.Empty;
} 
```

生成这个 IL

```
.method private hidebysig instance string foo() cil managed
{
    .maxstack 8
    L_0000: ldstr "foo"
    L_0005: ret 
}
.method private hidebysig instance string bar() cil managed
{
    .maxstack 8
    L_0000: ldstr "bar"
    L_0005: ldsfld string [mscorlib]System.String::Empty
    L_000a: call string [mscorlib]System.String::Concat(string, string)
    L_000f: ret 
} 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2015-11-25T11:42:56.350

我倾向于使用`String.Empty`而不是`""`出于一个简单但不明显的原因： `"﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿"`并且`""`不一样，第一个实际上有 16 个零宽度字符。显然，没有一个称职的开发人员会在他们的代码中加入零宽度字符，但如果他们确实进入了那里，那可能是维护的噩梦。

笔记：

*   我在这个例子中使用了[U+FEFF 。](http://www.fileformat.info/info/unicode/char/feff/index.htm)

*   不确定 SO 是否会吃掉这些字符，但可以自己尝试使用许多零宽度字符之一

*   [多亏了https://codegolf.stackexchange.com/](https://codegolf.stackexchange.com/)，我才知道这一点

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-09-30T04:06:11.977

上述答案在技术上是正确的，但为了获得最佳代码可读性和最小的异常机会，您可能真正想要使用的是[String.IsNullOrEmpty(s)](http://msdn.microsoft.com/en-us/library/system.string.isnullorempty.aspx)

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-09-30T02:08:05.693

"" 的所有实例都是相同的内部字符串文字（或者它们应该是）。所以你真的不会每次使用 "" 时都在堆上抛出一个新对象，而只是创建对同一个内部对象的引用。话虽如此，我更喜欢 string.Empty。我认为它使代码更具可读性。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2016-02-11T09:20:10.590

***使用`String.Empty`而不是`""`.***

> 这比内存使用更多的是速度，但它是一个有用的提示。这 `""`是一个文字，因此将充当文字：在第一次使用时创建它，并在以下使用时返回它的引用。`""`无论我们使用多少次，只有一个实例会存储在内存中！我在这里看不到任何内存损失。***问题是每次`""`使用时，都会执行一个比较循环来检查是否 `""`已经在实习池中。***另一方面，`String.Empty` 是对`""`存储在*.NET Framework 内存区域*中的引用。 `String.Empty`指向 VB.NET 和 C# 应用程序的相同内存地址。那么，当您有参考资料时，为什么每次需要`""` 时都搜索参考资料`String.Empty`?

参考：[`String.Empty`vs`""`](http://www.iss-shipping.com/Microsites/Document%20Library/Garbage%20Collector.docx)

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-09-30T02:02:48.513

String.Empty 不会创建对象，而 "" 会。[然而，正如这里](http://blogs.msdn.com/brada/archive/2003/04/22/49997.aspx)所指出的，差异是微不足道的。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-09-30T02:05:53.577

没关系！

过去对此的一些讨论：

[http://www.codinghorror.com/blog/archives/000185.html](http://www.codinghorror.com/blog/archives/000185.html)

[http://blogs.msdn.com/brada/archive/2003/04/22/49997.aspx](http://blogs.msdn.com/brada/archive/2003/04/22/49997.aspx)

[http://blogs.msdn.com/brada/archive/2003/04/27/50014.aspx](http://blogs.msdn.com/brada/archive/2003/04/27/50014.aspx)

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2015-04-17T16:34:26.920

```
string mystring = "";
ldstr "" 
```

`ldstr`将新对象引用推送到存储在元数据中的字符串文字。

```
string mystring = String.Empty;
ldsfld string [mscorlib]System.String::Empty 
```

`ldsfld`将静态字段的值推送到评估堆栈上

我倾向于使用`String.Empty`而不是`""`因为恕我直言，它更清晰，更少 VB-ish。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2019-01-31T04:42:34.297

> [**Eric Lippert** [写道](https://ericlippert.com/2013/06/17/string-concatenation-behind-the-scenes-part-one/)（2013 年 6 月 17 日）：
> “我在 C# 编译器中使用的第一个算法是处理字符串连接的优化器。*不幸的是，在我离开之前我没有设法将这些优化移植到 Roslyn 代码库；希望有人会达到那个目的！* ”]

以下是截至 2019 年 1 月的一些**Roslyn x64**结果。尽管此页面上其他答案的一致意见，但在我看来，当前的 x64 JIT 并没有对所有这些情况进行相同的处理，当一切都说了又做了。

但是，请特别注意，这些示例中只有一个实际上最终调用了`String.Concat`，我猜这是出于模糊的正确性原因（与优化疏忽相反）。其他差异似乎更难解释。

* * *

**默认（字符串）+ { 默认（字符串），“”，String.Empty }**

```
static String s00() => default(String) + default(String);
    mov  rax,[String::Empty]
    mov  rax,qword ptr [rax]
    add  rsp,28h
    ret

static String s01() => default(String) + "";
    mov  rax,[String::Empty]
    mov  rax,qword ptr [rax]
    add  rsp,28h
    ret

static String s02() => default(String) + String.Empty;
    mov  rax,[String::Empty]
    mov  rax,qword ptr [rax]
    mov  rdx,rax
    test rdx,rdx
    jne  _L
    mov  rdx,rax
_L: mov  rax,rdx
    add  rsp,28h
    ret 
```

**"" + { 默认(字符串), "", String.Empty }**

```
static String s03() => "" + default(String);
    mov  rax,[String::Empty]
    mov  rax,qword ptr [rax]
    add  rsp,28h
    ret

static String s04() => "" + "";
    mov  rax,[String::Empty]
    mov  rax,qword ptr [rax]
    add  rsp,28h
    ret

static String s05() => "" + String.Empty;
    mov  rax,[String::Empty]
    mov  rax,qword ptr [rax]
    mov  rdx,rax
    test rdx,rdx
    jne  _L
    mov  rdx,rax
_L: mov  rax,rdx
    add  rsp,28h
    ret 
```

**String.Empty + { default(String), "", String.Empty }**

```
static String s06() => String.Empty + default(String);
    mov  rax,[String::Empty]
    mov  rax,qword ptr [rax]
    mov  rdx,rax
    test rdx,rdx
    jne  _L
    mov  rdx,rax
_L: mov  rax,rdx
    add  rsp,28h
    ret

static String s07() => String.Empty + "";
    mov  rax,[String::Empty]
    mov  rax,qword ptr [rax]
    mov  rdx,rax
    test rdx,rdx
    jne  _L
    mov  rdx,rax
_L: mov  rax,rdx
    add  rsp,28h
    ret

static String s08() => String.Empty + String.Empty;
    mov  rcx,[String::Empty]
    mov  rcx,qword ptr [rcx]
    mov  qword ptr [rsp+20h],rcx
    mov  rcx,qword ptr [rsp+20h]
    mov  rdx,qword ptr [rsp+20h]
    call F330CF60                 ; <-- String.Concat
    nop
    add  rsp,28h
    ret 
```

* * *

**测试详情**

```
Microsoft (R) Visual C# Compiler version 2.10.0.0 (b9fb1610)
AMD64 Release
[MethodImpl(MethodImplOptions.NoInlining)]
'SuppressJitOptimization' = false 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2019-05-07T13:58:22.157

当您在视觉上扫描代码时，“”会像字符串一样被着色。string.Empty 看起来像一个常规的类成员访问。在快速浏览期间，更容易发现“”或直观含义。

找出字符串（堆栈溢出着色并不完全有帮助，但在 VS 中这更明显）：

```
var i = 30;
var f = Math.Pi;
var s = "";
var d = 22.2m;
var t = "I am some text";
var e = string.Empty; 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2017-03-09T11:59:29.850

从实体框架的角度来看：EF 版本 6.1.3 在验证时似乎以不同的方式对待 String.Empty 和 ""。

string.Empty 出于验证目的被视为 null 值，如果在必需（属性）字段上使用它将引发验证错误；其中 "" 将通过验证而不抛出错误。

此问题可能在 EF 7+ 中得到解决。参考： -https: [//github.com/aspnet/EntityFramework/issues/2610](https://github.com/aspnet/EntityFramework/issues/2610)）。

编辑： [Required(AllowEmptyStrings = true)] 将解决此问题，允许 string.Empty 进行验证。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2017-03-14T07:11:07.173

由于 String.Empty 不是编译时常量，因此您不能将其用作函数定义中的默认值。

```
public void test(int i=0,string s="")
    {
      // Function Body
    } 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2021-03-12T17:48:50.530

感谢您提供非常丰富的答案。

如果我错了，请原谅我的无知。我正在使用 VB，但我认为如果您测试未分配字符串的长度（即 IS Nothing），它会返回错误。现在，我在 1969 年开始编程，所以我已经远远落后了，但是我总是通过连接一个空字符串 ("") 来测试字符串。例如（以任何语言）： -

`if string + "" = ""`

* * *

## 回答 #18

> 赞同：-10
> 
> 时间：2016-01-21T15:57:14.337

这里的每个人都给出了一些很好的理论解释。我也有类似的疑问。所以我尝试了一个基本的编码。我发现了不同之处。这就是区别。

```
string str=null;
Console.WriteLine(str.Length);  // Exception(NullRefernceException) for pointing to null reference. 

string str = string.Empty;
Console.WriteLine(str.Length);  // 0 
```

所以看起来“Null”意味着绝对无效和“String.Empty”意味着它包含某种值，但它是空的。

# java - 用Java表达Excel公式（十进制到时间的解释）

> ID：151496
> 
> 赞同：1
> 
> 时间：2008-09-30T02:08:36.347
> 
> 标签：java, excel, datetime, decimal

我正在将 excel 工作表公式转换为 java，但我不明白 excel 如何设法采用以下公式：0.22 应用公式：=TEXT(R5/14, "h:mm") 并以某种方式得出：0.22

如果我再次提供： 2.8 它到达 4.48 有人可以向我解释它是如何做到的。我已经阅读了一些关于十进制的内容并且我理解转换，但这还没有帮助解释上述内容。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T02:28:32.647

Excel 将日期时间值存储为：

*   小数点左边的数字代表自 1900 年 1 月 1 日以来的天数
*   小数点右边的数字代表一天 24 小时的小数部分

在您的示例中，您将小数转换为日期时间值的小时和分钟部分的文本表示。

通过你的第一个公式，0.22 除以 14（你为什么这样做？）等于 0.015714286。如果然后将此分数应用于 24 小时制（乘以 1440 分钟），则它等于 22 分钟和一些变化（即“0:22”）。

通过第二个公式，2.8 除以 14 等于 0.2。乘以 1440 等于 288 分钟，即 4 小时 48 分钟（即“4:48”）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-09T06:30:29.407

或者用于 Java 的 Abacus 公式编译器，它允许您将 Excel 工作表中的公式直接编译为 Java 字节码，以便从 Java 应用程序快速轻松地调用（可以在没有 JDK 的情况下在运行时编译）。

[http://www.formulacompiler.org/](http://www.formulacompiler.org/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T02:23:41.537

是的，这有点傻。取出 /14 会有帮助。基本上 1 = 1 天，因此 R5 以一天的 14 表示。你可能会做

```
int msInADay= 86400000;
Time value = new Time(R5/14 * msInADay); 
```

但它未经测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T03:13:00.560

谢谢克里登斯。

它适用于：双 r = 0.22；双驱动时间 = (r / 14) * 1440;

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T05:40:18.083

可以在 OpenFormula 规范（其中记录/定义 OpenOffice-Calc）中找到一个非常好的电子表格内部文档。

[http://www.oasis-open.org/committees/documents.php?wg_abbrev=office-formula](http://www.oasis-open.org/committees/documents.php?wg_abbrev=office-formula)

如果您寻求 Java 库来评估 Excel 公式，Apache-POI 或 Pentaho 的 LibFormula 可能会有所帮助：

兴趣点：http: [//poi.apache.org/](http://poi.apache.org/)

LibFormula： http: [//sourceforge.net/project/showfiles.php ?group_id=51669&package_id=213669](http://sourceforge.net/project/showfiles.php?group_id=51669&package_id=213669)

# ruby - 类和模块的区别

> ID：151505
> 
> 赞同：449
> 
> 时间：2008-09-30T02:11:29.867
> 
> 标签：ruby, class, module

我来自 Java，现在我更多地使用 Ruby。

我不熟悉的一种语言功能是`module`. 我想知道 a 到底是什么`module`，你什么时候使用一个，为什么使用 a`module`而不是 a `class`？

* * *

## 回答 #1

> 赞同：525
> 
> 时间：2012-03-19T21:12:07.913

```
╔═══════════════╦═══════════════════════════╦═════════════════════════════════╗
║               ║ class                     ║ module                          ║
╠═══════════════╬═══════════════════════════╬═════════════════════════════════╣
║ instantiation ║ can be instantiated       ║ can *not* be instantiated       ║
╟───────────────╫───────────────────────────╫─────────────────────────────────╢
║ usage         ║ object creation           ║ mixin facility. provide         ║
║               ║                           ║   a namespace.                  ║
╟───────────────╫───────────────────────────╫─────────────────────────────────╢
║ superclass    ║ module                    ║ object                          ║
╟───────────────╫───────────────────────────╫─────────────────────────────────╢
║ methods       ║ class methods and         ║ module methods and              ║
║               ║   instance methods        ║   instance methods              ║
╟───────────────╫───────────────────────────╫─────────────────────────────────╢
║ inheritance   ║ inherits behaviour and can║ No inheritance                  ║
║               ║   be base for inheritance ║                                 ║
╟───────────────╫───────────────────────────╫─────────────────────────────────╢
║ inclusion     ║ cannot be included        ║ can be included in classes and  ║
║               ║                           ║   modules by using the include  ║
║               ║                           ║   command (includes all         ║
║               ║                           ║   instance methods as instance  ║
║               ║                           ║   methods in a class/module)    ║
╟───────────────╫───────────────────────────╫─────────────────────────────────╢
║ extension     ║ can not extend with       ║ module can extend instance by   ║
║               ║   extend command          ║   using extend command (extends ║
║               ║   (only with inheritance) ║   given instance with singleton ║
║               ║                           ║   methods from module)          ║
╚═══════════════╩═══════════════════════════╩═════════════════════════════════╝ 
```

* * *

## 回答 #2

> 赞同：416
> 
> 时间：2008-09-30T04:38:39.620

第一个答案很好，并给出了一些结构性的答案，但另一种方法是考虑你在做什么。模块是关于提供可以跨多个类使用的方法——将它们视为“库”（就像您在 Rails 应用程序中看到的那样）。类是关于对象的；模块是关于功能的。

例如，身份验证和授权系统就是很好的模块示例。身份验证系统跨多个应用程序级类工作（用户经过身份验证，会话管理身份验证，许多其他类将根据身份验证状态采取不同的行动），因此身份验证系统充当共享 API。

当您在多个应用程序之间共享方法时，您也可以使用模块（同样，库模型在这里很好）。

* * *

## 回答 #3

> 赞同：97
> 
> 时间：2013-08-08T19:28:29.620

我很惊讶没有人这么说。

由于提问者来自 Java 背景（我也是），所以这里有一个有帮助的类比。

类就像 Java 类一样。

模块就像 Java 静态类。想想`Math`Java中的类。您不实例化它，而是重用静态类中的方法（例如。`Math.random()`）。

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2008-09-30T02:21:56.783

基本上，模块不能被实例化。当一个类包含一个模块时，会生成一个代理超类，它提供对所有模块方法以及类方法的访问。

一个模块可以包含在多个类中。模块不能被继承，但是这种“mixin”模型提供了一种有用的“多重继承”类型。OO 纯粹主义者会不同意这种说法，但不要让纯粹性妨碍完成工作。

* * *

*（此答案最初链接到`http://www.rubycentral.com/pickaxe/classes.html`，但该链接及其域不再有效。）*

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2018-06-15T23:23:44.827

命名空间：**模块是命名空间**......在java中不存在;）

我也从 Java 和 python 切换到 Ruby，我记得有完全相同的问题......

所以最简单的答案是模块是一个命名空间，它在 Java 中是不存在的。在 java 中，与命名空间最接近的思维方式是**package**。

所以 ruby​​ 中的模块就像 java 中的那样：
**类？**没有
**接口？**没有
**抽象类？**没有
**包裹？**也许吧）

java中类中的静态方法：与ruby中模块中的方法相同

在java中，最小单位是一个类，你不能在一个类之外拥有一个函数。然而在 ruby​​ 中这是可能的（比如 python）。

那么模块中包含什么？
类、方法、常量。模块在该名称空间下保护它们。

**无实例：**模块不能用于创建实例

**Mixed ins：**有时继承模型对类不好，但在功能方面希望将一组类/方法/常量组合在一起

关于 ruby​​ 中模块的规则：
- 模块名称是 UpperCamelCase
- 模块内的常量全部大写（此规则对所有 ruby​​ 常量都相同，而不是特定于模块）
- 访问方法：使用 . 运算符
- 访问常量：使用 :: 符号

一个简单的模块示例：

```
module MySampleModule
  CONST1 = "some constant"

  def self.method_one(arg1)
    arg1 + 2
  end
end 
```

如何在模块中使用方法：

```
puts MySampleModule.method_one(1) # prints: 3 
```

如何使用模块的常量：

```
puts MySampleModule::CONST1 # prints: some constant 
```

关于模块的其他一些约定：
在文件中使用一个模块（如 ruby​​ 类，每个 ruby​​ 文件一个类）

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2013-06-10T15:23:13.757

`Module`在 Ruby 中，在一定程度上对应于 Java*抽象类*——具有实例方法，类可以从它继承（通过`include`，Ruby 人称它为“mixin”），但没有实例。还有其他一些细微的差异，但这么多信息足以让您入门。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2015-03-23T20:03:03.933

底线：模块是静态/实用程序类和 mixin 之间的交叉。

Mixins 是“部分”实现的可重用部分，可以以混合和匹配的方式组合（或组合），以帮助编写新类。当然，这些类还可以有自己的状态和/或代码。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2017-10-28T19:12:34.500

**班级**

当你定义一个类时，你定义了一个数据类型的蓝图。类保存数据，具有与该数据交互并用于实例化对象的方法。

**模块**

*   模块是将方法、类和常量组合在一起的一种方式。

*   模块为您带来两大好处：

    => 模块提供命名空间并防止名称冲突。命名空间有助于避免与其他人编写的具有相同名称的函数和类发生冲突。

    => 模块实现了 mixin 工具。

> （包括 Klazz 中的 Module 提供了 Klazz 访问 Module 方法的实例。）
> 
> （使用 Mod 扩展 Klazz，使 Klazz 类可以访问 Mods 方法。）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-05-29T01:51:32.637

首先，一些尚未提及的相似之处。Ruby 支持开放类，但模块也是开放的。毕竟，Class 继承自 Class 继承链中的 Module，因此 Class 和 Module 确实有一些相似的行为。

但是您需要问自己在编程语言中同时拥有类和模块的目的是什么？一个类旨在成为创建实例的蓝图，每个实例都是蓝图的实现变体。实例只是蓝图（类）的已实现变体。很自然，类的作用就是创建对象。此外，由于我们有时希望一个蓝图派生自另一个蓝图，因此类旨在支持继承。

模块不能被实例化，不能创建对象，也不支持继承。所以请记住一个模块不会从另一个模块继承！

那么在语言中使用模块有什么意义呢？模块的一个明显用途是创建命名空间，您也会注意到其他语言的这一点。同样，Ruby 的酷之处在于可以重新打开模块（就像类一样）。当您想在不同的 Ruby 文件中重用命名空间时，这是一个很大的用法：

```
module Apple
  def a
    puts 'a'
  end
end

module Apple 
  def b
    puts 'b'
  end
end

class Fruit
  include Apple
end

 > f = Fruit.new
 => #<Fruit:0x007fe90c527c98> 
 > f.a
 => a
 > f.b
 => b 
```

但是模块之间没有继承：

```
module Apple
  module Green
    def green
      puts 'green'
    end
  end
end

class Fruit
  include Apple
end

> f = Fruit.new
 => #<Fruit:0x007fe90c462420> 
> f.green
NoMethodError: undefined method `green' for #<Fruit:0x007fe90c462420> 
```

Apple 模块没有从 Green 模块继承任何方法，当我们在 Fruit 类中包含 Apple 时，Apple 模块的方法被添加到 Apple 实例的祖先链中，但不是 Green 模块的方法，即使 Green模块是在 Apple 模块中定义的。

那么我们如何获得绿色方法呢？您必须将其明确包含在您的课程中：

```
class Fruit
  include Apple::Green
end
 => Fruit 
 > f.green
=> green 
```

但是 Ruby 对 Modules 有另一个重要的用途。这是 Mixin 工具，我在另一个关于 SO 的答案中对此进行了描述。但总而言之，mixin 允许您将方法定义到对象的继承链中。通过mixins，可以给对象实例的继承链（include）或者self的singleton_class（extend）添加方法。

# .net - 实施 ICloneable 时是否应该提供深度克隆？

> ID：151520
> 
> 赞同：6
> 
> 时间：2008-09-30T02:17:13.207
> 
> 标签：.net, oop

从[MSDN 文档](http://msdn.microsoft.com/en-us/library/system.icloneable.aspx)中我不清楚在实现 ICloneable 时我应该提供深层克隆还是浅层克隆。什么是首选？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-30T02:19:54.137

简短的回答：是的。

长答案：不要使用 ICloneable。那是因为 .Clone 没有被定义为浅或深克隆。您应该实现自己的 IClone 接口，并描述克隆应该如何工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T02:18:49.643

默认情况下，克隆很深，这就是命名约定，出于性能原因，如果需要，复制构造函数可以很浅。

编辑：这个命名约定超越了边界，对于.Net、Java、C++、Javascript 等也是如此……实际的来源超出了我的知识范围，但它是标准面向对象词典的一部分，就像对象和类一样。因此，MSDN 没有指定实现，因为它是由单词本身给出的（当然很多 OO 语言的新手不知道这一点，他们应该指定它，但无论如何他们的文档还是很节俭的）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-01-01T20:48:05.633

鉴于定义对象的方式，“深度克隆”与“浅层克隆”不应该存在任何问题。如果一个对象封装了事物的身份，则该对象的克隆应该封装相同事物的身份。如果一个对象封装了可变对象的值，则副本应该封装具有相同值的分离的可变对象。

不幸的是，.NET 或 Java 都没有在类型系统中包含引用是否被保存以封装身份、可变值，或者两者都没有。相反，他们只使用一个引用类型，并认为拥有引用的唯一副本的代码，或者拥有对包含该引用的唯一副本的容器的唯一引用，可以使用该引用来封装值或状态。这种想法对于单个对象可能是可以容忍的，但在涉及复制和相等性测试操作等问题时会带来真正的问题。

如果一个类有一个`Foo`封装了 a 的状态的字段，该字段将封装`List<Bar>`对象的身份，并且将来可能封装不同对象的身份，那么 的克隆`Foo`应该持有对标识相同对象的新列表的引用. 如果`List<Bar>`用于封装对象的可变状态，则克隆应具有对新列表的引用，该列表标识具有相同状态的新对象。

如果对象包括单独的“等价”和“等价”方法，每个方法都有哈希码，并且如果对于每个堆对象类型都有引用类型被表示为封装身份、可变状态、两者兼有或两者都没有，那么 99% 的相等性测试和克隆方法可以自动处理。如果封装身份或可变状态的所有组件都相等（不仅相等）并且封装两者的组件至少相等，则两个聚合是相等的；只有当所有对应的组件都是并且总是等价时，两个聚合才等价[这通常意味着引用相等，但并非总是如此]。复制聚合需要对封装可变状态的每个成分制作一个分离的副本，复制对封装身份的每个成分的引用，并为既不封装的则执行上述任一操作；不能简单地克隆具有封装可变状态和身份的成分的聚合。

在一些棘手的情况下，这些用于克隆、相等和等价的规则无法正确处理，但如果有一个约定来区分 a`List<IdentityOfFoo>`和 a`List<MutableStateOfFoo>`并支持“等价”和“等价”测试，则 99%对象可以自动生成 Clone、Equals、Equivalent、EqualityHash 和 EquivalenceHash 并正常工作。

# vb.net - 用于 KML 的 Linq to XML？

> ID：151521
> 
> 赞同：6
> 
> 时间：2008-09-30T02:17:39.507
> 
> 标签：vb.net, linq-to-xml, kml

我是 LINQ to XML 新手，也是 KML 新手；所以请耐心等待。

我的目标是从 KML 文件中提取单个地标。我的 KML 就这样开始了：

```
<?xml version="1.0" encoding="utf-8"?>
<Document xmlns="http://earth.google.com/kml/2.0">
  <name>Concessions</name>
  <visibility>1</visibility>
  <Folder>
    <visibility>1</visibility>
    <Placemark>
      <name>IN920211</name>
      <Style>
        <PolyStyle>
          <color>80000000</color>
        </PolyStyle>
      </Style>
      <Polygon>
        <altitudeMode>relativeToGround</altitudeMode>
        <outerBoundaryIs>
          <LinearRing>
            <coordinates>11.728374,1.976421,0 11.732967,1.965322,0 11.737225,1.953161,0 11.635858,1.940812,0 11.658102,1.976874,0 11.728374,1.976421,0 </coordinates>
          </LinearRing>
        </outerBoundaryIs>
      </Polygon>
    </Placemark>
    <Placemark>
    ... 
```

这是据我所知：

```
 Dim Kml As XDocument = XDocument.Load(Server.MapPath("../kmlimport/ga.kml"))
    Dim Placemarks = From Placemark In Kml.Descendants("Placemark") _
         Select Name = Placemark.Element("Name").Value 
```

到目前为止不好 - Kml.Descendants("Placemark") 给了我一个空的枚举。文档已正确加载 - 因为 KML.Descendants 包含每个节点。对于这些查询的价值，这些查询也是空的：

```
Dim foo = Kml.Descendants("Document") 
Dim foo = Kml.Descendants("Folder") 
```

有人可以指出我正确的方向吗？链接到好的 Linq to XML 教程的加分点——我在网上找到的那些在非常简单的场景中停止。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-09-29T17:43:58.080

这在 C# 中对我有用：

```
XDocument doc = XDocument.Load(@"TheFile.kml");

var q = doc.Descendants().Where(x => x.Name.LocalName == "Placemark"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T14:26:15.590

感谢spoon16 和Bruce Murdock 为我指明了正确的方向。spoon16 发布的代码有效，但强制您将命名空间与每个元素名称连接起来，这并不像我想要的那样干净。

我进行了更多搜索，并弄清楚了应该如何完成 - 这非常简洁，我喜欢用于引用 XML 元素的新 <...> 括号语法。

```
Imports <xmlns:g='http://earth.google.com/kml/2.0'>
Imports System.Xml.Linq

 ...

    Dim Kml As XDocument = XDocument.Load(Server.MapPath("../kmlimport/ga.kml"))
    For Each Placemark As XElement In Kml.<g:Document>.<g:Folder>.<g:Placemark>
        Dim Name As String = Placemark.<g:name>.Value
    Next 
```

请注意第一行中 xmlns 后面的**:g 。**这为您提供了在其他地方引用此命名空间的快捷方式。

有关 XNamespace 类的更多信息，请参阅[MSDN 文档](http://msdn.microsoft.com/en-us/library/system.xml.linq.xnamespace.aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-21T20:39:29.693

Scott Hanselman 为那些寻找基于 C# 的解决方案的人提供了一个简洁的解决方案。

[VB9 中的 XLINQ to XML 支持](http://www.hanselman.com/blog/XLINQToXMLSupportInVB9.aspx)

此外，使用 XNamespace 会派上用场，而不仅仅是附加一个字符串。这有点正式。

```
// This code should get all Placemarks from a KML file            
var xdoc = XDocument.Parse(kmlContent);
XNamespace ns = XNamespace.Get("http://earth.google.com/kml/2.0");
var ele = xdoc.Element(ns + "kml").Element(ns + "Document").Elements(ns + "Placemark"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T02:33:56.363

您可能需要将命名空间添加到 XElement 名称

```
Dim ns as string = "http://earth.google.com/kml/2.0"
dim foo = Kml.Descendants(ns + "Document") 
```

忽略任何语法错误，我在 C# 中工作

`XElement.Name`你会发现vs可能有区别`XElement.Name.LocalName/`

我通常`foreach`通过`XElements`文档中的所有内容作为第一步，以确保我使用了正确的命名。

C# 这是我用法的摘录，好像我忘记了 {}

```
 private string GpNamespace = 
 "{http://schemas.microsoft.com/GroupPolicy/2006/07/PolicyDefinitions}";

 var results = admldoc.Descendants(GpNamespace + 
               "presentationTable").Descendants().Select(
                p => new dcPolicyPresentation(p)); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T14:01:36.710

上述修复都没有完成这项工作；有关详细信息，请参阅我的评论。我相信spoon16 和Bruce Murdock 都在正确的轨道上，因为命名空间绝对是问题所在。

在进一步谷歌搜索后，我在[此页面](http://www.scip.be/index.php?Page=ArticlesNET21&Lang=NL)上发现了一些代码，这些代码建议了一种解决方法：只需从原始 XML 中删除 xmlns 属性。

```
 ' Read raw XML
    Dim RawXml As String = ReadFile("../kmlimport/ga.kml")
    ' HACK: Linq to XML choking on the namespace, just get rid of it
    RawXml = RawXml.Replace("xmlns=""http://earth.google.com/kml/2.0""", "")
    ' Parse XML
    Dim Kml As XDocument = XDocument.Parse(RawXml)
    ' Loop through placemarks
    Dim Placemarks = From Placemark In Kml.<Document>.<Folder>.Descendants("Placemark")
    For Each Placemark As XElement In Placemarks
        Dim Name As String = Placemark.<name>.Value
        ...
    Next 
```

如果有人可以发布与命名空间一起工作的工作代码而不是对其进行核对，我很乐意为他们提供答案。

# html - IE7中的Textarea在鼠标悬停时消失

> ID：151528
> 
> 赞同：5
> 
> 时间：2008-09-30T02:19:40.843
> 
> 标签：html, css, internet-explorer-7, html-input

我有这种大数据输入页面，一种使用 div 的表格布局。每行都有可以打开/关闭的子行。使用 css 可见性设置触发切换。表格的每个“单元格”的角落都有一个小图像，单击图像，会打开一个弹出窗口，允许您在条目上添加注释。

这个弹出窗口有一个文本区域和一组复选框，还有一个按钮（我认为输入类型=提交）。弹出窗口是嵌套在隐藏 div 内的 iframe。

在 IE7 中，一旦您弹出打开此注释 iframe 并向下滚动页面，将鼠标悬停在弹出窗口的文本区域上会使其消失并在其下方显示页面内容。当您将鼠标悬停时，复选框还会显示下面的页面。

所以，我尝试了一些不同的修复方法。Z-index 是我希望可以用来解决这个问题的。没有这样的运气。我可能会尝试用普通输入 type=text 替换文本区域，但由于复选框也出现此错误，我怀疑单行文本输入也会导致错误。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-30T11:25:25.277

最简单的触发方法`hasLayout`（在另一篇文章中提到）是添加`zoom: 1`.

在调试一些最愚蠢的 IE 6/7 显示问题时，我有时会转储一个临时的

```
* {
    zoom: 1;
} 
```

到我的 CSS 看看是否有任何变化。如果是这样，我开始有选择地将它添加到以元素开头的元素、元素的父/子等。

`zoom`仅受 IE 支持，因此在您的文档中包含它是非常“安全”的。它还使您不必做任何疯狂的事情，例如绝对定位元素等。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-30T06:32:33.513

除了块元素之外，z-index 还适用于所有具有 IE 调用 hasLayout 的元素[阅读更多](http://haslayout.net/haslayout)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T02:33:06.320

如果我没记错的话，Z-Index 仅适用于绝对定位的块元素。所以尝试将弹出框的位置设置为绝对，然后尝试z-index。如果您需要弹出窗口位于某个位置，请将包装元素设置为相对位置。我以前遇到过这个问题，我相信我按照我描述的方式解决了它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-29T09:39:24.480

我在 IE7 中的输入字段和文本区域都遇到了完全相同的问题，但前提是我给了它们一个宽度。

我不记得我从哪里得到它，但我找到了这个解决方案，它可能不是很优雅，但它解决了这个问题。只需添加：

```
filter:alpha(opacity=100) 
```

到麻烦字段的样式属性的CSS。

# javascript - 如何检测客户端滚动到网页的顶部或底部？

> ID：151544
> 
> 赞同：9
> 
> 时间：2008-09-30T02:28:54.440
> 
> 标签：javascript

我正在寻找一种跨浏览器方法来检测客户端 Web 浏览器是否一直滚动到屏幕的底部（或顶部）。

确实，顶部相当容易，
`scrY = window.pageYOffset || document.body.scrollTop || document.documentElement.scrollTop`
如果您处于顶部，则为零。问题是 scrY 似乎返回滚动条的顶部，而不是底部，所以我没有得到与文档高度（以像素为单位）相当的东西，我大概是文档的高度减去大小滚动条。

是否有一种简单的跨浏览器方法来确定用户是否向下滚动到文档/窗口的底部？最具体地说，我了解一般的滚动条操作（设置它、移动它等），但我怎样才能获得滚动条底部位置相对于窗口/文档底部的增量。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T02:39:30.983

[http://www.softcomplex.com/docs/get_window_size_and_scrollbar_position.html](http://www.softcomplex.com/docs/get_window_size_and_scrollbar_position.html)

[http://www.sitepoint.com/article/preserve-page-scroll-position/](http://www.sitepoint.com/article/preserve-page-scroll-position/)

[http://codepunk.hardwar.org.uk/ajs02.htm](http://codepunk.hardwar.org.uk/ajs02.htm)

为了确保元素可见，可以使用[.scrollIntoView 方法](http://msdn.microsoft.com/en-us/library/ms536730(VS.85).aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-07T06:28:13.443

FF 3.5 中的工作总结：

```
function isTop() {
    return window.pageYOffset == 0;
}

function isBottom() {
    return window.pageYOffset >= window.scrollMaxY;
} 
```

# ruby - 如何在 Ruby 中获取当前主机的 FQDN？

> ID：151545
> 
> 赞同：13
> 
> 时间：2008-09-30T02:29:33.393
> 
> 标签：ruby, fqdn

我需要获取运行 Ruby 脚本的主机的完全扩展主机名。在 Perl 中，我使用了 Sys::Hostname::Long 并取得了不错的效果。谷歌似乎建议我应该在 ruby​​ 中使用 Socket.hostname，但这只是返回节点名，而不是完整的主机名。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-30T02:43:19.710

这似乎有效：

```
hostname = Socket.gethostbyname(Socket.gethostname).first 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-08-20T22:51:58.630

```
hostname = Socket.gethostbyname(Socket.gethostname).first 
```

不建议使用，只有在正确设置反向 DNS 解析时才能使用。[如果需要，这个因素错误](https://projects.puppetlabs.com/issues/3898)有更长的解释。

如果您阅读事实代码，您会注意到他们通过以下[方式完全回避了这个问题](https://github.com/puppetlabs/facter/blob/master/lib/facter/fqdn.rb)：

```
fqdn = hostname + domainname 
```

在哪里：

```
hostname = %[hostname]
domainname = %[hostname -f] # minus the first element 
```

这是一个合理的假设，不依赖于 DNS 的设置（可能在盒子外部）。

* * *

## 回答 #3

> 赞同：-5
> 
> 时间：2009-12-01T07:59:01.273

可能更简单 => 主机名 = Socket.gethostname

# javascript - 如何从 Firefox 扩展执行页面定义的 JavaScript 函数？

> ID：151555
> 
> 赞同：9
> 
> 时间：2008-09-30T02:32:19.720
> 
> 标签：javascript, firefox, dom, document

我正在为演示目的创建一个 Firefox 扩展。我从扩展中调用文档中的特定 JavaScript 函数。我在我的 HTML 文档中写了这个（不是在扩展中，而是由 Firefox 加载的页面）：

```
document.funcToBeCalled = function() {
   // function body
}; 
```

然后，扩展程序将在某些事件上运行它：

```
var document = Application.activeWindow.activeTab.document;
document.funcToBeCalled(); 
```

但是，它会引发一个错误，指出`funcToBeCalled`未定义。

注意：我可以通过调用来获取文档上的元素`document.getElementById(id);`

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-03T18:20:10.277

出于安全原因，您对扩展程序的内容页面的访问受到限制。请参阅[XPCNativeWrapper](http://developer.mozilla.org/en/docs/XPCNativeWrapper)和[Safely access content DOM from chrome](http://developer.mozilla.org/en/Safely_accessing_content_DOM_from_chrome)，

如果您控制页面，最好的方法是在页面中设置一个事件监听器并从您的扩展中调度一个事件（页面中的 addEventListener，扩展中的 dispatchEvent）。

否则，请参阅[http://groups.google.com/group/mozilla.dev.extensions/msg/bdf1de5fb305d365](http://groups.google.com/group/mozilla.dev.extensions/msg/bdf1de5fb305d365)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-03-26T18:39:38.697

```
document.wrappedJSObject.funcToBeCalled(); 
```

这是**不安全**的，并且允许恶意页面将其权限提升到您的扩展程序的权限......但是，它确实按照您的要求进行。阅读早期的[greasemonkey 漏洞](http://www.oreillynet.com/pub/a/network/2005/11/01/avoid-common-greasemonkey-pitfalls.html?page=1)，了解为什么这是一个坏主意。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-05-24T09:53:51.273

我有一个非常简单的方法来做到这一点。假设您必须调用写在页面上的 xyz() 函数。你必须从你的插件中调用它。

创建一个按钮（“使其不可见。这样它就不会干扰您的页面”）。onclick 该按钮调用此 xyz() 函数。

```
<input type="button" id="testbutton" onclick="xyz()" /> 
```

现在在插件中你有一个页面的文档对象。假设它的 mainDoc

在你想调用 xyz() 的地方，只需执行这一行

```
mainDoc.getElementById('testbutton').click(); 
```

它将调用 xyz() 函数。

祝你好运 ：）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T04:44:38.810

您可以这样做，但您需要控制页面并能够提高脚本的权限级别。[Mozilla 文档给出了一个例子](http://developer.mozilla.org/en/How_to_Build_an_XPCOM_Component_in_Javascript)——在页面上搜索“Privilege”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-02-13T04:46:28.283

```
var pattern = "the url you want to block";

function onExecuted(result) {
console.log(`We made it`);
}

function onError(error) {
console.log(`Error: ${error}`);
}

function redirect(requestDetails) {
var callbackName = 'callbackFunction'; //a function in content js
var data = getDictForkey('a url');
var funcStr = callbackName + '(' + data + ')';
const scriptStr = 'var header = document.createElement(\'button\');\n' +
    ' header.setAttribute(\'onclick\',\'' + funcStr + '\');' +
    ' var t=document.createTextNode(\'\');\n' +
    ' header.appendChild(t);\n' +
    ' document.body.appendChild(header);' +
    ' header.style.visibility="hidden";' +
    ' header.click();';
const executing = browser.tabs.executeScript({
    code: scriptStr
});
executing.then(onExecuted, onError);
return {
    cancel: true
}
}

chrome.webRequest.onBeforeRequest.addListener(
redirect,
{urls: [pattern]},
["blocking"]
);

function getDictForkey(url) {
xxxx
return xxxx;
} 
```

# database-design - 哪些工具可用于 TDDD（测试驱动数据库开发）？

> ID：151563
> 
> 赞同：5
> 
> 时间：2008-09-30T02:34:18.453
> 
> 标签：database-design, testing, tdd

大约一年前，我阅读了 Scott Ambler 的[重构数据库：进化数据库设计](https://rads.stackoverflow.com/amzn/click/com/0321293533)。我被这样的想法所说服，就像您可以使用 TDD 开发代码一样，您可能应该（至少）使用单元测试覆盖您的数据库，甚至在更改架构之前编写数据库测试，以便您进行数据库工作也是 TDD 风格。

我真的很喜欢这个想法，并且我一直在手动执行此操作（好吧，有时我会执行此操作）一段时间，只是编写规则的单元测试，这些测试恰好连接到数据库并根据给定的模式文件检查其结构。但是我还没有找到任何可以帮助自动化这个过程的好的数据库变更管理工具包。有人知道吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T02:36:39.727

我只知道两个单元测试框架：

*   [数据库单元](http://dbunit.sourceforge.net/)
*   [TSQLUnit](http://tsqlunit.sourceforge.net/)

至于变更管理，这些是一些推荐的工具：

*   [Redgate SQL 比较](http://www.red-gate.com/products/SQL_Compare/index.htm)
*   [ApexSQL](http://www.apexsql.com/)
*   [蟾蜍](http://www.toadsoft.com/)

虽然我不确定这是否真的是你想要的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T03:02:00.883

Jon 提到，我已经尝试了大多数工具，但主要还是决定使用 SMO 和 SQL 命令编写 nUnit 测试。我通常会验证表结构、存储过程、视图和函数。能够向老板展示由于开发人员数据类型更改而导致的 14 个损坏的测试，这使得所有工作都变得非常值得。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T02:44:36.477

Microsoft 的下一个版本的 Visual Studio for Database 应该有这些。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T04:20:51.207

用于 PL/SQL 的[UTPLSQL](http://utplsql.oracledeveloper.nl/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T04:22:43.933

[ounit](http://www.ounit.com/)工具之于 Oracle 的 PL/SQL 就像 junit 之于 java。我们用它来“利用”我们的数据库调用。我们可以轻松地重复它们并比较代码或下划线数据结构更改前后的结果。

# windows-xp - 如何禁用 Tortoise BZR？

> ID：151587
> 
> 赞同：10
> 
> 时间：2008-09-30T02:55:18.170
> 
> 标签：windows-xp, tortoisebzr

我是 bzr 的忠实粉丝，我很高兴他们正在为它开发乌龟，但目前它太慢而无法使用。这些图标几乎总是不正确，当我在资源管理器中加载一个包含很多分支的目录时，它会将我的整个系统锁定 10 秒到 2 分钟不等。我期待将来再次尝试它，但现在我想禁用它。

不幸的是，我在添加/删除程序中看不到它，也找不到在集市配置目录中禁用它的方法。当我右键单击任务面板中的图标（按时钟）并选择“退出程序”时，它稍后会重新启动。我也没有在“服务”面板中看到它。有没有办法禁用它？

我在有问题的系统上运行 Windows XP。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-12T17:30:14.710

我认为你可以这样做：

```
regsvr32 /u tbzrshellext_x86.dll 
```

我还杀死了内存中的 tbzrcachew.exe，但是因为像 enobrev 一样，我无法使用 AutoRuns 找到它，我会假设它是运行此缓存的 shell 扩展。

将确定我何时重新启动计算机...

我同意目前这些图标很慢，不会实时更新，并且上下文菜单中的选项通常是有限的。我希望所有这些点在未来都会得到改善。

[编辑] 它有效！也不需要杀死缓存。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T05:54:21.000

根据[TortoiseBZR 自述文件](http://bazaar.launchpad.net/~amduser29/tortoisebzr/trunk/annotate/270?file_id=readme.tortoisebzr-20070416091904-uwoqp8zpdevxcgcq-1)，您可以通过运行禁用它

```
python tortoise-bzr.py --unregister 
```

从安装文件夹。不确定它默认安装在哪里，但它看起来可能在您的 Python 站点包文件夹中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T20:56:04.873

您可以通过上下文菜单禁用图标覆盖（使其变慢的主要因素）：右键单击托盘中的 bzr 图标，设置，取消选中所有驱动器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-04T12:24:05.053

我进入安装目录“C:\Program Files\Bazaar”并运行**unins000.exe**并获得了一个不错的卸载程序。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-28T12:21:53.560

您可以使用 SysInternals（现在是 Microsoft 的一部分）的实用程序“Autoruns”来禁用 Windows 资源管理器扩展（例如将自身添加为右键单击菜单项的扩展）。

当您在应用程序中找不到“正确”的方法或应用程序不提供这种方法时，这可以派上用场。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-03T18:28:57.327

[Jason 的回答](https://stackoverflow.com/questions/151587/how-do-i-disable-tortoise-bzr#151911)似乎有效，所以我花了一些时间寻找 py 文件。它无处可寻。通过安装程序安装 bzr 时，它似乎也安装了 tbzr 二进制文件。我已经浏览了尽可能多的面板。Process Explorer (sysinternals)、AutoRuns (sysinternals)、Some Shell Extension browser 等。我在任何地方都找不到正式的条目。

我找到了注册表项，但我不知道它们来自哪里或如何“正式”摆脱它们。我没有心情开始关闭注册表项，因为我这周实际上必须完成工作。

我只是要运行卸载，然后安装最新版本（未选中 TBZR）。据我所知，这是解决此问题的唯一方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-13T05:14:15.673

我听到你的声音了。

很难将其删除，这很烦人。我也只会卸载，然后重新安装 BZR。

另一方面，“BZR”是一个糟糕的键序列，必须为每个命令键入。我一定会将“BZR.EXE”重命名为对手指更友好的名称，因为我的小指始终无法处理那个“z”键。

# java - 如何检测远程侧套接字关闭？

> ID：151590
> 
> 赞同：88
> 
> 时间：2008-09-30T02:58:18.147
> 
> 标签：java, networking, sockets, tcp

您如何检测是否`Socket#close()`已在远程端的套接字上调用？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2008-09-30T07:41:15.173

该`isConnected`方法无济于事，`true`即使远程端已关闭套接字，它也会返回。试试这个：

```
public class MyServer {
    public static final int PORT = 12345;
    public static void main(String[] args) throws IOException, InterruptedException {
        ServerSocket ss = ServerSocketFactory.getDefault().createServerSocket(PORT);
        Socket s = ss.accept();
        Thread.sleep(5000);
        ss.close();
        s.close();
    }
}

public class MyClient {
    public static void main(String[] args) throws IOException, InterruptedException {
        Socket s = SocketFactory.getDefault().createSocket("localhost", MyServer.PORT);
        System.out.println(" connected: " + s.isConnected());
        Thread.sleep(10000);
        System.out.println(" connected: " + s.isConnected());
    }
} 
```

启动服务器，启动客户端。您会看到它打印了两次“connected: true”，即使第二次关闭了套接字。

真正找出答案的唯一方法是`IOException`在关联的输入/输出流上读取（您将获得 -1 作为返回值）或写入（将抛出一个（损坏的管道））。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2011-11-25T11:33:01.773

由于答案有偏差，我决定对此进行测试并发布结果 - 包括测试示例。

这里的服务器只是将数据写入客户端，不需要任何输入。

服务器：

```
ServerSocket serverSocket = new ServerSocket(4444);
Socket clientSocket = serverSocket.accept();
PrintWriter out = new PrintWriter(clientSocket.getOutputStream(), true);
while (true) {
  out.println("output");
  if (out.checkError()) System.out.println("ERROR writing data to socket !!!");
  System.out.println(clientSocket.isConnected());
  System.out.println(clientSocket.getInputStream().read());
        // thread sleep ...
  // break condition , close sockets and the like ...
} 
```

*   一旦客户端连接（甚至在断开连接之后），clientSocket.isConnected() 总是返回真奇怪！
*   getInputStream().read()
    *   只要客户端连接，线程就会等待输入，因此使您的程序不做任何事情 - 除非您得到一些输入
    *   如果客户端断开连接，则返回 -1
*   **客户端断开连接后，out.checkError() 为真，所以我推荐这个**

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-10-29T22:52:46.810

您还可以在写入客户端套接字时检查套接字输出流错误。

```
out.println(output);
if(out.checkError())
{
    throw new Exception("Error transmitting data.");
} 
```

* * *

## 回答 #4

> 赞同：-12
> 
> 时间：2016-01-27T21:42:39.080

如果远程系统已断开/关闭连接，则方法 Socket.Available 将立即抛出 SocketException。

# variables - 大范围函数变量的良好命名约定是什么？

> ID：151594
> 
> 赞同：4
> 
> 时间：2008-09-30T03:00:08.983
> 
> 标签：variables, naming

您可以对类成员、静态对象、全局对象和结构有不同的命名约定。其中一些示例如下。

```
_member
m_member 
```

或者在 Java 的情况下，使用`this.member`.

但是对于函数变量范围是否有任何好的技术或命名约定来传达单个变量具有完整的函数范围或短的生命周期范围？

```
void MyFunction()
{
  int functionScopeVariable;

  if(true)
  {
    //no need for function variable scope naming convention
  }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-22T19:00:39.643

我实际上鼓励将此任务委托给您使用的 IDE/编辑器。

不，我实际上并不是在谈论命名变量，这仍然最好由人类完成。但是这种命名策略的基本任务是向您展示任何一个名称代表哪种类型的变量。

几乎每个值得一提的 IDE 都可以为不同的变量类型（实例成员、静态成员、参数、局部变量……）定义不同的样式（颜色、字体、字体类型……），所以让 IDE 告诉你什么变量的类型实际上使您不必每次都键入那些（否则无用的）前缀或后缀。

所以我的建议：使用没有任何前缀或后缀的有意义的名称。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-30T03:03:41.517

一种方法是遵循变量范围越大，名称越长的准则。通过这种方式，全局变量获得了长描述性的名称，而像循环索引变量这样的范围有限的东西可以小到单个字母。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-30T03:05:12.310

我对全局变量、静态变量和成员变量使用前缀或特殊命名约定，因此我不必在本地变量上使用前缀。我更喜欢使用短的局部变量名，特别是对于循环变量。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T03:25:20.733

有一个论点是你不应该有“大范围函数”，所以命名不应该有问题 - 只需使用“小范围函数”变量命名约定。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-07-19T15:51:30.103

MSFT 和其他私有实例字段样式指南的指南是`_memberName`（以“ 为前缀的驼峰式表示法” `_"`）。这也是最近许多 Microsoft 教程的源代码中使用的约定。

我使用它是因为它更短，而不是匈牙利语，并且 R# 支持它作为私有实例字段的默认规则。

我也喜欢它，因为它在某种程度上掩盖了 Intellisense 的私有字段，因为您应该更喜欢首先访问您的公共成员。如果我想访问属性名称并开始输入“ `Na`”，第一个建议是使用 Pascal 大小写的公共实例属性名称。在极少数情况下，我想直接访问私有字段，这迫使我有意识地决定开始输入“ `_`”，然后我会在 Intellisense 弹出窗口中获得我的私有字段的完整列表。

我还看到指导说它应该是 _MemberName 如果它是名为 MemberName 的公共属性的支持字段（以“ `_`”为前缀的 Pascal 大小写表示法）我个人不喜欢这样，因为我认为大写 M 是多余的，补充说不必要的击键，并且不会添加任何额外的信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T03:01:55.360

我们倾向于在函数中使用 l_ 前缀来表示“本地”。而且，效果很好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T03:11:08.927

实际上，这一切都归结为语言的风格指南是否有任何建议。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T03:35:58.430

我想任何事情都可以，只要它传达了有关其使用的含义。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T03:52:31.213

我更喜欢保持简单，我使用：

```
 m_varname - Class member variables
 g_varname - Global variables 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-07-19T16:07:10.253

我使用与班级成员相同的约定。IDE 应该负责查找您的声明。如果一个函数如此庞大和令人困惑以至于它成为一个问题，那么需要解决一个更大的问题。

# ruby-on-rails - JRuby on Rails 与 Ruby on Rails，有什么区别？

> ID：151595
> 
> 赞同：137
> 
> 时间：2008-09-30T03:00:17.690
> 
> 标签：ruby-on-rails, ruby, jruby, jrubyonrails

我正在尝试在 Rails 上试用 JRuby 和 JRuby。我很难找到有关 JRuby on Rails 和 Ruby on Rails 之间区别的信息。

我需要注意哪些差异？

* * *

## 回答 #1

> 赞同：163
> 
> 时间：2008-09-30T04:13:59.103

JRuby 是在 JVM 上运行的 Ruby 实现，而 Matz 的 Ruby 是 C 实现。

需要注意的主要特点是：

1.  JRuby 在 Java VM 上运行，它可以被编译或解释为 Java 字节码。
2.  JRuby 可以与Java 代码集成。如果您有 Java 类库 (.jar)，您可以在带有 JRuby 的 Ruby 代码中引用和使用它们。在另一个方向上，您也可以从 Java 中调用 JRuby 代码。JRuby 还可以使用 JVM 和应用程序服务器功能。
3.  JRuby 通常托管在 Java 应用程序服务器中，例如 Sun 的 GlassFish 甚至 Tomcat Web 服务器。
4.  尽管您不能将本机 Ruby gem 与 JRuby 一起使用，但大多数流行的 Ruby 库都有 JRuby 实现。

JRuby wiki 中列出了其他差异：

*   [JRuby 和 Ruby (MRI) 之间的差异](https://github.com/jruby/jruby/wiki/Differences-Between-MRI-and-JRuby)
*   [JRuby On Rails](https://github.com/jruby/jruby/wiki/JRubyOnRails)

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2012-06-29T07:52:35.693

我很惊讶在这个问题的所有答案中都缺少与**GIL**相关的关键内容。

您应该关心的主要区别是 esp。在诸如使用 Rails 构建的 Web 应用程序中是**真正的并发**（“全局解释器锁”免费）。当使用 JRuby 运行两个线程（例如服务 2 个用户请求）时，它们能够在单个进程中同时运行，而在 MRI 中，有避免并行执行 Ruby 代码的 GIL（即使使用 1.9 的本机线程）。

对于应用程序开发人员来说，这是在考虑 JRuby 时首先要记住的事情，因为它确实很出色，`config.threadsafe!`但要求您确保您的代码（和您的 gems 代码）是“真正的”线程安全的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-07T14:42:13.037

我可能错了，但我认为你可以用普通 RoR 无法做到的方式打包 JRuby on Rails 应用程序——看看 Mingle 或类似的。可以在不掉裤子/打开 komono 的情况下进行销售。

就是说，我对 RoR 包装还不够熟悉，所以请不要执着于它 :)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-30T03:53:42.427

大多数情况下它应该工作相同。在 jRoR 中，您可以访问在 RoR 中没有的东西。通常它主要是部署问题。

但是，如果您的 RoR 应用程序使用的本机库没有在 JVM 上运行的等效库，那可能会很痛苦。然而，大多数库都有可用的非本机版本（至少是我遇到的流行版本）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-12-16T15:59:05.670

这里已经有一些很好的答案。

eebbesen 已经涵盖了基础知识，并且 kares（他自己！）告诉我们 JRuby 没有 GIL。

我将从更实际的角度补充一下，我已经在 Ruby on Rails 上启动了应用程序，然后出于性能原因迁移到了 JRuby。

有两个主要的性能优势：JRuby 在某些情况下（或曾经）比 Ruby 快，第二，缺少 Global Interpreter Lock kares 提到的允许我执行多线程，虽然很棘手，但解锁数量级的性能优势.

一个非常大的 Ruby on Rails 应用程序在一个小时内移植并运行，gem 等等。唯一的实际故障是 Java 的正则表达式与 Ruby 的略有不同。这对 JRuby 来说是一项不朽的成就。

# emacs - Yasnippet 和 pabbrev 在 Emacs 中一起工作

> ID：151639
> 
> 赞同：3
> 
> 时间：2008-09-30T03:20:56.173
> 
> 标签：emacs, pabbrev

我试图让 yasnippet 和 pabbrev 包与 emacs 一起工作，但我似乎得不到任何爱。我怎样才能让他们一起玩得很好？

问题的症结在于 pabbrev 和 yasnippet 绑定到 tab 键。当找不到匹配项时，这两个包似乎都会执行此回退，但它们没有正确回退。

我目前正在使用 Emacs W32（最后一个 emacs 22 版本）。yasnippet 是字节编译的，但 pabbrev 不是。

编辑：到目前为止，tabkey2 和 hippie expand 都不是开箱即用的，这就是为什么我还没有将这两种解决方案标记为正确答案的原因。我正在破解 tabkey2 以使其正常工作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T07:10:02.177

我使用[hippie-expand](http://www.emacswiki.org/emacs/hippie-exp-ext.el)来管理标签扩展包。

以下代码将尝试每个包以展开您的 tab 按键：

```
(require 'hippie-exp)

(setq hippie-expand-try-functions-list
      '(yas/hippie-try-expand
        try-expand-dabbrev
        try-expand-dabbrev-all-buffers
        try-expand-dabbrev-from-kill
        try-complete-file-name
        try-complete-lisp-symbol)) 
```

注意： hippie-expand 可能不适用于 pabbrev，因为 pabbrev 是 emacs 次要模式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T06:18:31.160

看看[tabkey2.el](http://www.emacswiki.org/cgi-bin/wiki/tabkey2.el)。看起来它解决了您遇到的问题。

# apache-flex - Flex 弹出按钮问题

> ID：151641
> 
> 赞同：1
> 
> 时间：2008-09-30T03:22:28.120
> 
> 标签：apache-flex

把我的头撞到这里的墙上。我不想重新发明轮子。

PopupButton 的默认 Flex 3 类是两个按钮的组合。一个是带有标签和/或图标的普通按钮，第二个是打开弹出窗口的箭头。

我在这里的挣扎是我只想要一个带有图标的按钮，可以直接打开弹出窗口，而不必重新编写所有弹出窗口处理代码。计划是用一个名为 SimplePopupButton 的新类来覆盖 PopupButton 类。此类只会隐藏箭头，并指向按钮单击处理程序以打开弹出窗口。

看起来很简单，但我没有看到一个简单的方法来做到这一点。建议？备择方案？

* * *

[**编辑**] 我想要一个 16x16 的图标按钮来打开一个弹出窗口。flex 附带的 PopupButton 有两个按钮：“它包含一个主按钮和一个辅助按钮，称为弹出按钮，当用户单击弹出按钮时，它会弹出任何 UIComponent 对象。” （[来源](http://livedocs.adobe.com/flex/3/langref/index.html)）。我希望主按钮打开弹出窗口，并隐藏弹出按钮。（或相反亦然）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T20:22:01.040

你试过设置[新皮肤](http://www.adobe.com/devnet/flex/articles/flex_skins.html)吗？不确定它是否会起作用，但它比尝试编写新控件要容易得多。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-05T01:42:18.857

在 Flex 3.4 中，PopUpButton 控件有一个名为“ [openAlways](http://livedocs.adobe.com/flex/3/langref/mx/controls/PopUpButton.html#openAlways) ”的属性，如果设置为 true，则允许主按钮也可以打开 popUp。然后，如前所述，只需将按钮的外观设置为隐藏向下箭头。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T07:09:40.320

自从我使用 Flex 做一些工作以来已经有一段时间了，但这是我的想法：
创建一个由经典按钮和列表组成的新组件。组件应该有两个视图状态。该列表在基本状态下不应该是可见的，但是当组件进入另一个状态时应该是可见的。当然，另一种状态是在单击按钮时进入的。您可以将列表设置为初始定位，使其左下角与按钮的左下角对齐。然后创建一个从基本状态到另一个状态的转换，这将使列表像在标准 PopuButton 控件中一样“向下滑动”。您可以通过同时使用擦除效果和移动效果来做到这一点，在该效果中，您可以在其 y 轴上移动列表，直到它的左上角是它的左下角。将组件命名为 MyPopupButton 或任何您希望调用的名称。要返回基本状态，只需对这些效果进行反向操作。至于处理代码 - 当然，您的应用程序只需要知道用户从列表中选择了什么，因此不会比平常更多的代码。
希望这会有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T15:16:23.097

嗯，我可能在这里完全是个白痴，但你为什么不能只使用 ComboBox 呢？我的意思是它的操作本质上与没有箭头按钮分离的弹出按钮相同？还是我在这里很愚蠢。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T15:30:51.487

尝试在 [此处](http://livedocs.adobe.com/flex/201/langref/mx/controls/PopUpButton.html#popUp)找到的弹出属性。它应该设置为您的弹出窗口。

```
print(</mx:Script>
    <![CDATA[
          import mx.controls.Alert;
          public var myAlert:Alert = new Alert();
     ]]>
    </mx:Script>
    <mx:popUpButton popUp="{myAlert}" label="Button"/> 
```

);

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-19T16:53:34.690

这是一种设计技巧，但我只是在我的弹出按钮上设置了以下属性......（或者如果你想重用，你可以创建一个样式）

假设您只想在单击时弹出一个 16x16 图标...

```
<mx:PopUpButton icon="@Embed(source='pathToIcon.png')" arrowButtonWidth="16" paddingLeft="0" paddingRight="0" width="16" height="16" popUp="{menu}"/> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-25T23:14:20.100

有点讨厌，但我做了一些很像上面的马特的事情，似乎工作/看起来不错。

在 CSS 中。

```
.camButtons
{
    padding-left:0;
    padding-right:1;
    up-skin: Embed(source="/assets/images/skins.swf", symbol="Button_ChatRoomControlsOver");
    over-skin: Embed(source="/assets/images/skins.swf", symbol="Button_ChatRoomControls");
    down-skin: Embed(source="/assets/images/skins.swf", symbol="Button_ChatRoomControls");
    disabled-skin: Embed(source="/assets/images/skins.swf", symbol="Button_ChatRoomControls");

    pop-up-up-skin: Embed(source="/assets/images/skins.swf", symbol="Button_ChatRoomControlsOver");
    pop-up-down-skin: Embed(source="/assets/images/skins.swf", symbol="Button_ChatRoomControls");
    pop-up-over-skin: Embed(source="/assets/images/skins.swf", symbol="Button_ChatRoomControls");
}

<mx:PopUpButton width="38" popUpGap="0" paddingLeft="37" arrowButtonWidth="38" id="flirts_btn" popUp="{flirts_menu}" styleName="camButtons" icon="@Embed(source='/assets/images/skins.swf', symbol='Icon_WinkOver')" downIcon="@Embed(source='/assets/images/skins.swf', symbol='Icon_WinkOver')" disabledIcon="@Embed(source='/assets/images/skins.swf', symbol='Icon_Wink')" toolTip="Send Flirt to User" buttonMode="true" useHandCursor="true" /> 
```

....重要的部分...

```
pop-up-up-skin: Embed(source="/assets/images/skins.swf", symbol="Button_ChatRoomControlsOver");
    pop-up-down-skin: Embed(source="/assets/images/skins.swf", symbol="Button_ChatRoomControls");
    pop-up-over-skin: Embed(source="/assets/images/skins.swf", symbol="Button_ChatRoomControls");

width="38" popUpGap="0" paddingLeft="37" arrowButtonWidth="38" 
```

# database - 有人用谷歌数据吗？

> ID：151651
> 
> 赞同：2
> 
> 时间：2008-09-30T03:27:07.937
> 
> 标签：database, google-data-api

我最近正在考虑将 GoogleData 用于一个爱好项目来存储我的服务的旧数据（比如 24 小时以上），同时我将新数据保存在我的服务器上（爱好项目==便宜的家庭服务器）。

但是我还没有真正听说过有人使用 GoogleData，所以我想知道其他人的经历是什么。

编辑：我的简要使用模式是基本上存储代表（历史）实体的对象（缓存版本）。以及相对不可变的数据，例如过去的事件或这些实体，我的对象的全局原型数据（也相对不可变），以减少我的服务器上的负载。

至于活动实体，我将在本地存储更改，然后将它们发布到 GooglData（24 小时后）。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T20:08:21.447

我确实使用 GoogleData 来存储来自我的一个名为 TaskList 的项目的数据。我专门使用谷歌电子表格。这很难开始，但从谷歌的示例中，你可以很确定地知道下一步该做什么。我在 C# 中做到了这一点。[这是google-gdata](http://code.google.com/p/google-gdata/downloads/list)的示例应用程序和 sdk 。我的建议是，不要费心阅读有关 gdata 的在线文档，它解释了很多关于底层 xml 结构和访问每个级别（私有与公共）数据的方法。您需要有一个谷歌帐户才能开始。与标准 SQL 或数据集相比，读取和写入数据的方式非常奇怪。但总的来说，API 设计得很好，几乎所有事情都得到了照顾。一定要试一试。

PS：毫无疑问，当使用所有 xml 开销以及大量使用 gdata 的冗余标记进行访问时，它有点慢。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T02:44:22.670

由于您对此并没有真正得到满意的答案，我可能会建议您查看[Amazon SimpleDB](http://aws.amazon.com/simpledb/)。它不是免费的，但除非您存储数以万计的记录，否则您每月可能只会花费几美分。与亚马逊的其他网络服务一样，您只需为使用的内容付费。

SimpleDB 比 Google Data 服务更通用，可能适合更广泛的应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T15:53:22.043

所以，我想显然没有人使用谷歌数据。

存储您自己负担不起的数据似乎确实不错。因此，我想我仍然会尝试一下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-02T16:01:40.587

还没来得及到我的电脑前清理代码以进行发布，但我目前的解决方案是使用 Yahoo Pipes 将我的查询结果从 Google Data 直接获取到浏览器，作为 JSON 而不是通过服务器的 XML。而且这一切都只用客户端 Javascript 完成，所以我可以在不需要服务器的情况下获取和使用数据。但是我还没有编写脚本来将数据存储在 Google Data 上。那是下一步。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-09T00:54:24.010

[这里](http://groups.google.com/group/Google-Docs-Data-APIs/web/share-your-project)列出了一些不错的基于 gdata 的应用程序。

您可以将电子表格视为基本数据库，看看[这个 python 包装器](http://code.google.com/p/gdata-python-client/source/browse/trunk/src/gdata/spreadsheet/text_db.py)及其[.net 端口](http://bugsquash.blogspot.com/2008/10/crud-api-for-google-spreadsheets.html)。

# windows-vista - 创建系统范围的 vista 键盘快捷键和宏

> ID：151652
> 
> 赞同：0
> 
> 时间：2008-09-30T03:27:23.443
> 
> 标签：windows-vista, keyboard-shortcuts

这个问题一开始可能看起来与编程无关，但让我解释一下。

我坚持使用没有`home` `end` `page up`和`page down`按钮的键盘。我需要这些功能进行编程。

所以问题是：在vista中定义系统范围的快捷方式和宏的好/免费实用程序是什么？映射例如 " `ctrl`/ `left arrow`to `home`，`ctrl`/ `right arrow`to`end`将解决我的问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T03:33:35.580

AutoHotKey 是我所知道的最可配置的...

[http://www.autohotkey.com](http://www.autohotkey.com)

[编辑] 另一个简洁的实用程序是 Microsoft 键盘布局创建者

[http://www.microsoft.com/globaldev/tools/msklc.mspx](http://www.microsoft.com/globaldev/tools/msklc.mspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T15:47:09.030

[AutoHotkey](http://www.autohotkey.com)效果很好。这是我正在使用的脚本：

```
#Right::End
#Left::Home 
#Up::PgUp
#Down::PgDn
#BS::Del 
```

这会将“Win”+“右箭头”映射到“end”等……这使得[Apple 蓝牙无线键盘](http://www.apple.com/keyboard/)可用于编程。感谢您的建议！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T03:34:22.723

我没有亲自使用过，但我相信 Key Transformation 应用程序会帮助您：

[http://softboy.net/key/index.htm](http://softboy.net/key/index.htm)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T04:06:14.940

按键调整

[http://webpages.charter.net/krumsick/](http://webpages.charter.net/krumsick/)

# php - 我可以信任调用 PHP __destruct() 方法吗？

> ID：151660
> 
> 赞同：43
> 
> 时间：2008-09-30T03:29:54.543
> 
> 标签：php, garbage-collection

在 PHP5 中，是否保证为每个对象实例调用 __destruct() 方法？程序中的异常可以防止这种情况发生吗？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-09-30T03:53:49.917

还值得一提的是，在子类有自己的析构函数的情况下，**不会**自动调用父析构函数。

如果父类进行任何必需的清理，您必须从子类**__destruct()**方法显式调用**parent::__destruct() 。**

 *** * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-09-30T03:35:23.157

当释放所有引用或脚本终止时，将调用析构函数。我认为这意味着脚本正确终止时。我会说关键异常不能保证调用析构函数。

[PHP 文档](http://au2.php.net/__construct)有点薄，但确实说析构函数中的异常会导致问题。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2011-11-28T09:39:56.100

以我的经验，在 PHP 5.3 中总是会调用析构函数，但请注意，如果某些代码调用 exit() 或发生致命错误，PHP 将以“任何”顺序调用析构函数（我认为实际顺序是 order in内存或内存为对象保留的顺序。实际上，这个顺序几乎总是有问题的）。这在 PHP 文档中称为“关闭序列”。

[析构函数的 PHP 文档](http://php.net/__construct)说：

> PHP 5 引入了与其他面向对象语言（如 C++）类似的析构函数概念。只要没有对特定对象的其他引用，或者在关闭序列期间以任何顺序调用，就会调用析构函数方法。

因此，如果你有一个类 X 包含对 Y 的引用，则 X 的析构函数可能会在 Y 的析构函数已经被调用之后被调用。希望对 Y 的引用不是那么重要……正式地说，这不是一个错误，因为它已被记录在案。

但是，很难解决这个问题，因为官方 PHP 无法知道是否正常调用析构函数（以正确的顺序调用析构函数）或以“任何”顺序调用析构函数，在这种情况下您不能使用来自引用对象的数据，因为这些可能已经被摧毁了。可以使用 debug_backtrace() 并检查堆栈来解决这种检测不足的问题。缺少正常堆栈似乎意味着 PHP 5.3 的“关闭顺序”，但这也是未定义的。如果您有循环引用，那么这些对象的析构函数将不会在 PHP 5.2 或更低版本中被调用，并且将在 PHP 5.3 或更高版本的“关闭序列”期间以“任何”顺序调用。对于循环引用，不存在逻辑上“正确”的顺序，因此“任何”

有一些例外（这毕竟是 PHP）：

*   如果`exit()`在另一个析构函数中调用，则不会调用任何剩余的析构函数（[http://php.net/manual/en/language.oop5.decon.php](http://php.net/manual/en/language.oop5.decon.php)）
*   如果`FATAL`错误发生在任何地方（许多可能的原因，例如试图从任何其他析构函数中抛出异常可能是一个原因），则不会调用任何剩余的析构函数。

当然，如果 PHP 引擎遇到分段错误或发生其他一些内部错误，那么所有的赌注都没有了。

如果您想了解“关机序列”的*当前*实现，请参阅[https://stackoverflow.com/a/14101767](https://stackoverflow.com/a/14101767)。请注意，此实现可能会在未来的 PHP 版本中更改。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-30T04:01:08.870

当前存在一个带有循环引用的错误，该错误会阻止隐式调用 destruct 方法。[http://bugs.php.net/bug.php?id=33595](http://bugs.php.net/bug.php?id=33595) 应该在 5.3 中修复

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-12-30T23:10:32.500

如果您想确定，请使用关闭功能：[register_shutdown_function()](http://php.net/manual/en/function.register-shutdown-function.php)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-12-18T19:28:36.390

值得注意的是，虽然析构函数可能会被调用，但并不能保证它们会被调用，正如[The Daily WTF](https://thedailywtf.com/articles/My-Tales)中的这个故事所示：

> “好吧，”我叹了口气。尽管要求他描述刚刚捏造的流程编组概念很诱人，但我决定让步。就在那一刻，我想到了完美的反驳。“但如果你只是，说，拔掉插头呢？计算机关闭时， ~~Finally 块~~__destruct 不会执行！”</p>
> 
> 我希望开发人员会因为“不合理的场景”而跳回去责备我。可他们的脸色却是一片白。他们慢慢转过头来看着对方。很明显，他们犯了许多之前犯过的错误：相信 Try-Finally 与数据库事务之类的东西一样可靠。
> 
> “而且……嗯……”我慢慢地说，打破了尴尬的沉默，“这就是为什么……你应该……永远不要将关键的……业务交易代码放在 finally 块中。”</p>

如果您只是释放资源或进行一些日志记录，可以假设将调用析构函数，但它们不能安全地用于“撤消”先前的操作以尝试使某些代码符合 ACID。

# header - 将许可证头添加到源文件的工具？

> ID：151677
> 
> 赞同：94
> 
> 时间：2008-09-30T03:37:12.390
> 
> 标签：header, language-agnostic

我正在寻找一种工具，它可以批量向一些源文件添加许可证头，其中一些源文件已经有了头文件。是否有一个工具可以插入一个标题，如果它不存在的话？

*编辑：我故意不标记这个问题的答案，因为答案基本上都是特定于环境和主观的*

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-09-30T03:48:48.540

```
#!/bin/bash

for i in *.cc # or whatever other pattern...
do
  if ! grep -q Copyright $i
  then
    cat copyright.txt $i >$i.new && mv $i.new $i
  fi
done 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-30T03:44:46.817

Python 2 解决方案，根据自己的需要进行修改

特征：

*   处理 UTF 标头（对大多数 IDE 很重要）
*   递归更新目标目录中传递给定掩码的所有文件（修改 .endswith 参数以获取您的语言的文件掩码（.c、.java、..etc）
*   覆盖以前的版权文本的能力（提供旧的版权参数来做到这一点）
*   可选地省略`excludedir`数组中给定的目录

```
# updates the copyright information for all .cs files
# usage: call recursive_traversal, with the following parameters
# parent directory, old copyright text content, new copyright text content

import os

excludedir = ["..\\Lib"]

def update_source(filename, oldcopyright, copyright):
    utfstr = chr(0xef)+chr(0xbb)+chr(0xbf)
    fdata = file(filename,"r+").read()
    isUTF = False
    if (fdata.startswith(utfstr)):
        isUTF = True
        fdata = fdata[3:]
    if (oldcopyright != None):
        if (fdata.startswith(oldcopyright)):
            fdata = fdata[len(oldcopyright):]
    if not (fdata.startswith(copyright)):
        print "updating "+filename
        fdata = copyright + fdata
        if (isUTF):
            file(filename,"w").write(utfstr+fdata)
        else:
            file(filename,"w").write(fdata)

def recursive_traversal(dir,  oldcopyright, copyright):
    global excludedir
    fns = os.listdir(dir)
    print "listing "+dir
    for fn in fns:
        fullfn = os.path.join(dir,fn)
        if (fullfn in excludedir):
            continue
        if (os.path.isdir(fullfn)):
            recursive_traversal(fullfn, oldcopyright, copyright)
        else:
            if (fullfn.endswith(".cs")):
                update_source(fullfn, oldcopyright, copyright)

oldcright = file("oldcr.txt","r+").read()
cright = file("copyrightText.txt","r+").read()
recursive_traversal("..", oldcright, cright)
exit() 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-30T03:56:06.773

假设您在文件 license.txt 中有许可标头，下面是一个可以解决问题的 Bash 脚本：

文件 addlicense.sh：

```
#!/bin/bash  
for x in $*; do  
head -$LICENSELEN $x | diff license.txt - || ( ( cat license.txt; echo; cat $x) > /tmp/file;  
mv /tmp/file $x )  
done 
```

现在在您的源目录中运行它：

```
export LICENSELEN=`wc -l license.txt | cut -f1 -d ' '`  
find . -type f \(-name \*.cpp -o -name \*.h \) -print0 | xargs -0 ./addlicense.sh 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2012-07-17T22:05:05.133

查看[版权标题](https://github.com/osterman/copyright-header)RubyGem。它支持扩展名以 php、c、h、cpp、hpp、hh、rb、css、js、html 结尾的文件。它还可以添加和删除标题。

输入“ `sudo gem install copyright-header`”安装

之后，可以执行以下操作：

```
copyright-header --license GPL3 \
  --add-path lib/ \
  --copyright-holder 'Dude1 <dude1@host.com>' \
  --copyright-holder 'Dude2 <dude2@host.com>' \
  --copyright-software 'Super Duper' \
  --copyright-software-description "A program that makes life easier" \
  --copyright-year 2012 \
  --copyright-year 2012 \
  --word-wrap 80 --output-dir ./ 
```

它还支持使用 --license-file 参数的自定义许可证文件。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2012-03-12T17:11:03.963

编辑：如果您使用的是 eclipse，则有[一个插件](http://www.wdev91.com/?p=cpw)

我根据银龙的回复写了一个简单的python脚本。我需要一个更灵活的解决方案，所以我想出了这个。它允许您递归地将头文件添加到目录中的所有文件。您可以选择添加文件名应匹配的正则表达式，目录名称应匹配的正则表达式和文件中第一行不应匹配的正则表达式。您可以使用最后一个参数来检查标头是否已包含在内。

如果文件以 shebang (#!) 开头，此脚本将自动跳过文件中的第一行。这不会破坏依赖于此的其他脚本。如果您不希望这种行为，您必须在 writeheader 中注释掉 3 行。

这里是：

```
#!/usr/bin/python
"""
This script attempts to add a header to each file in the given directory 
The header will be put the line after a Shebang (#!) if present.
If a line starting with a regular expression 'skip' is present as first line or after the shebang it will ignore that file.
If filename is given only files matchign the filename regex will be considered for adding the license to,
by default this is '*'

usage: python addheader.py headerfile directory [filenameregex [dirregex [skip regex]]]

easy example: add header to all files in this directory:
python addheader.py licenseheader.txt . 

harder example adding someone as copyrightholder to all python files in a source directory,exept directories named 'includes' where he isn't added yet:
python addheader.py licenseheader.txt src/ ".*\.py" "^((?!includes).)*$" "#Copyright .* Jens Timmerman*" 
where licenseheader.txt contains '#Copyright 2012 Jens Timmerman'
"""
import os
import re
import sys

def writeheader(filename,header,skip=None):
    """
    write a header to filename, 
    skip files where first line after optional shebang matches the skip regex
    filename should be the name of the file to write to
    header should be a list of strings
    skip should be a regex
    """
    f = open(filename,"r")
    inpt =f.readlines()
    f.close()
    output = []

    #comment out the next 3 lines if you don't wish to preserve shebangs
    if len(inpt) > 0 and inpt[0].startswith("#!"): 
        output.append(inpt[0])
        inpt = inpt[1:]

    if skip and skip.match(inpt[0]): #skip matches, so skip this file
        return

    output.extend(header) #add the header
    for line in inpt:
        output.append(line)
    try:
        f = open(filename,'w')
        f.writelines(output)
        f.close()
        print "added header to %s" %filename
    except IOError,err:
        print "something went wrong trying to add header to %s: %s" % (filename,err)

def addheader(directory,header,skipreg,filenamereg,dirregex):
    """
    recursively adds a header to all files in a dir
    arguments: see module docstring
    """
    listing = os.listdir(directory)
    print "listing: %s " %listing
    #for each file/dir in this dir
    for i in listing:
        #get the full name, this way subsubdirs with the same name don't get ignored
        fullfn = os.path.join(directory,i) 
        if os.path.isdir(fullfn): #if dir, recursively go in
            if (dirregex.match(fullfn)):
                print "going into %s" % fullfn
                addheader(fullfn, header,skipreg,filenamereg,dirregex)
        else:
            if (filenamereg.match(fullfn)): #if file matches file regex, write the header
                writeheader(fullfn, header,skipreg)

def main(arguments=sys.argv):
    """
    main function: parses arguments and calls addheader
    """
    ##argument parsing
    if len(arguments) > 6 or len(arguments) < 3:
        sys.stderr.write("Usage: %s headerfile directory [filenameregex [dirregex [skip regex]]]\n" \
                         "Hint: '.*' is a catch all regex\nHint:'^((?!regexp).)*$' negates a regex\n"%sys.argv[0])
        sys.exit(1)

    skipreg = None
    fileregex = ".*"
    dirregex = ".*"
    if len(arguments) > 5:
        skipreg = re.compile(arguments[5])
    if len(arguments) > 3:
        fileregex =  arguments[3]
    if len(arguments) > 4:
        dirregex =  arguments[4]
    #compile regex    
    fileregex = re.compile(fileregex)
    dirregex = re.compile(dirregex)
    #read in the headerfile just once
    headerfile = open(arguments[1])
    header = headerfile.readlines()
    headerfile.close()
    addheader(arguments[2],header,skipreg,fileregex,dirregex)

#call the main method
main() 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-10-01T02:07:49.757

对于 Java，您可以使用 Maven 的许可证插件：[http ://code.google.com/p/maven-license-plugin/](http://code.google.com/p/maven-license-plugin/)

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2011-10-29T19:39:51.477

好的，这是一个简单的仅限 Windows 的 UI 工具，它在文件夹中搜索您指定类型的所有文件，将您想要的文本添加到顶部（您的许可证文本），并将结果复制到另一个目录（避免潜在的覆盖问题） . 它也是免费的。需要 .Net 4.0。

我实际上是作者，所以请随时请求修复或新功能……尽管对交付时间表没有承诺。;)

更多信息：[Amazify.com](http://amazify.com)上的[许可证头工具](http://www.amazify.com/license-header-tool/)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-09-02T08:49:06.577

查看许可证添加器。它支持多个代码文件（甚至是自定义的）并正确处理现有的标头。已经带有最常见的开源许可证的模板。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2013-04-21T03:15:40.067

这是我使用 PHP 来修改 PHP 文件的一个。我也有旧的许可证信息要删除，所以它首先替换旧文本，然后在打开后立即添加新文本

```
<?php
class Licenses
{
    protected $paths = array();
    protected $oldTxt = '/**
 * Old license to delete
 */';
    protected $newTxt = '/**
 * @license    http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */';

    function licensesForDir($path)
    {
        foreach(glob($path.'/*') as $eachPath)
        {
            if(is_dir($eachPath))
            {
                $this->licensesForDir($eachPath);
            }
            if(preg_match('#\.php#',$eachPath))
            {
                $this->paths[] = $eachPath;
            }
        }
    }

    function exec()
    {

        $this->licensesForDir('.');
        foreach($this->paths as $path)
        {
            $this->handleFile($path);
        }
    }

    function handleFile($path)
    {
        $source = file_get_contents($path);
        $source = str_replace($this->oldTxt, '', $source);
        $source = preg_replace('#\<\?php#',"<?php\n".$this->newTxt,$source,1);
        file_put_contents($path,$source);
        echo $path."\n";
    }
}

$licenses = new Licenses;
$licenses->exec(); 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-01-31T11:59:25.417

[这是](http://www.mail-archive.com/community@apache.org/msg04322.html)我在 Apache 列表中找到的一个。它是用 Ruby 编写的，看起来很容易阅读。你甚至应该能够从 rake 中调用它以获得额外的特殊好处。:)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-20T20:03:27.463

如果你还需要一个，我写了一个小工具，叫做**SrcHead**。您可以在[http://www.solvasoft.nl/downloads.html找到它](http://www.solvasoft.nl/downloads.html)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-05-28T21:58:25.480

如果您使用的是 sbt，则有[https://github.com/Banno/sbt-license-plugin](https://github.com/Banno/sbt-license-plugin)

# silverlight - 动态设置 Silverlight DataGrid 列的标题文本

> ID：151682
> 
> 赞同：29
> 
> 时间：2008-09-30T03:41:02.117
> 
> 标签：silverlight

```
 <my:DataGridTemplateColumn 
            CanUserResize="False" 
            Width="150" 
            Header="{Binding MeetingName, Source={StaticResource LocStrings}}" 
            SortMemberPath="MeetingName"> 
  </my:DataGridTemplateColumn> 
```

我在 Silverlight 网格控件中有上述列。但它给了我一个 XamlParser 错误，因为我试图设置 Header 属性。有没有人这样做过？我想为多种语言做到这一点。

我绑定到资源的语法也是正确的，因为我在网格外的标签中尝试过它。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-30T05:38:58.570

您不能绑定到 Header，因为它不是 FrameworkElement。您可以通过像这样修改标题模板来使文本动态化：

```
xmlns:data="clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls.Data"
xmlns:dataprimitives="clr-namespace:System.Windows.Controls.Primitives;assembly=System.Windows.Controls.Data"

<data:DataGridTemplateColumn>   
   <data:DataGridTemplateColumn.HeaderStyle>
       <Style TargetType="dataprimitives:DataGridColumnHeader">
          <Setter Property="Template">
             <Setter.Value>
                <ControlTemplate>                                        
                  <TextBlock Text="{Binding MeetingName, Source={StaticResource LocStrings}}" />                
               </ControlTemplate>
            </Setter.Value>
         </Setter>
      </Style>
   </data:DataGridTemplateColumn.HeaderStyle>
</data:DataGridTemplateColumn> 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-04-29T15:07:04.263

我的解决方法是使用附加属性自动设置绑定：

```
public static class DataGridColumnHelper
{
    public static readonly DependencyProperty HeaderBindingProperty = DependencyProperty.RegisterAttached(
        "HeaderBinding",
        typeof(object),
        typeof(DataGridColumnHelper),
        new PropertyMetadata(null, DataGridColumnHelper.HeaderBinding_PropertyChanged));

    public static object GetHeaderBinding(DependencyObject source)
    {
        return (object)source.GetValue(DataGridColumnHelper.HeaderBindingProperty);
    }

    public static void SetHeaderBinding(DependencyObject target, object value)
    {
        target.SetValue(DataGridColumnHelper.HeaderBindingProperty, value);
    }

    private static void HeaderBinding_PropertyChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        DataGridColumn column = d as DataGridColumn;

        if (column == null) { return; }

        column.Header = e.NewValue;
    }
} 
```

然后，在 XAML 中：

```
<data:DataGridTextColumn util:DataGridColumnHelper.HeaderBinding="{Binding MeetingName, Source={StaticResource LocStrings}}" /> 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-09-02T13:08:02.700

要保留原始标题的视觉样式，请使用 ContentTemplate 而不是 Template：

```
<Setter Property="ContentTemplate">
<Setter.Value>
    <DataTemplate>
        <Image Source="<image url goes here>"/>
    </DataTemplate>
</Setter.Value> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-03-09T13:19:09.820

找到了一个有趣的解决方法，它也适用于[wpflocalizeaddin.codeplex.com](http://wpflocalizeaddin.codeplex.com)：

由[Slyi创建](http://forums.silverlight.net/members/slyi.aspx)

它使用一个`IValueConverter`：

```
public class BindingConverter : IValueConverter
{
    public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
    {
        if (value.GetType().Name == "Binding")
        {
            ContentControl cc = new ContentControl();
            cc.SetBinding(ContentControl.ContentProperty, value as Binding);
            return cc;
        }
        else return value;
    }

    public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
    {

        return null;
    }
} 
```

还有一种风格`DataGridColumnHeader`

```
<UserControl.Resources>
    <local:BindingConverter x:Key="BindCon"/>
    <Style x:Key="ColBinding" TargetType="dataprimitives:DataGridColumnHeader" >
        <Setter Property="ContentTemplate" >
            <Setter.Value>
                <DataTemplate>
                    <ContentPresenter Content="{Binding Converter={StaticResource BindCon}}"  />
                </DataTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</UserControl.Resources> 
```

这样您就可以在`Header`属性上保留您最喜欢的绑定语法

```
<Grid x:Name="LayoutRoot" Background="White">
    <StackPanel>
        <TextBox Text="binding header" x:Name="tbox" />

        <data:DataGrid ItemsSource="{Binding AllPeople,Source={StaticResource folks}}" AutoGenerateColumns="False" ColumnHeaderStyle="{StaticResource ColBinding}"  >
            <data:DataGrid.Columns>
                <data:DataGridTextColumn Binding="{Binding ID}" 

                                         Header="{Binding Text, ElementName=tbox}" />
                <data:DataGridTextColumn Binding="{Binding Name}" 

                                         Header="hello" />
            </data:DataGrid.Columns>
        </data:DataGrid>
    </StackPanel>

</Grid> 
```

[http://cid-289eaf995528b9fd.skydrive.live.com/self.aspx/Public/HeaderBinding.zip](http://cid-289eaf995528b9fd.skydrive.live.com/self.aspx/Public/HeaderBinding.zip)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-11-11T12:04:56.560

如上所述，在代码中设置值似乎要简单得多：

```
dg1.Columns[3].Header = SomeDynamicValue; 
```

避免使用 Setter Property 语法，这在我的情况下似乎会弄乱样式，即使我确实尝试使用 ContentTemplate 和 Template。

我漏掉的一点是，最好使用 `dg1.Columns[3].Header`符号而不是尝试引用命名列。

我已经命名了我的一个专栏，并试图在代码中引用它，但得到了空异常。使用 Columns[index] 方法效果很好，我可以根据本地化资源为 Header 分配一个文本字符串。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-02-05T16:38:22.153

为什么不简单地在代码中设置它：

```
dg1.Columns[3].Header = SomeDynamicValue; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-08-16T09:19:11.153

请注意，在 RobSiklos 提供的解决方案中，Source {staticResource...} 是关键，如果您打算像

```
Binding DataContext.SelectedHistoryTypeItem,RelativeSource={RelativeSource AncestorType=sdk:DataGrid}, 
```

它可能不起作用

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-04-06T12:42:40.760

我得到了一些绑定解决方案。由于您使用 DataGridTemplateColumn，请将其子类化并添加一个名为 Binding 类型的属性，例如“HeaderBinding”。现在您可以从 XAML 绑定到该属性。接下来，您应该将绑定传播到标题的 DataTemplate 中的 TextBlock。例如，您可以使用该 TextBlock 的 OnLoaded 事件来执行此操作。

```
 HeaderTextBlock.SetBinding(TextBlock.TextProperty, HeaderBinding); 
```

就是这样。如果您有更多列并且只想使用一个 DataTemplate，那么它会有点复杂，但想法是一样的。

# c# - 异步 WPF 命令

> ID：151686
> 
> 赞同：13
> 
> 时间：2008-09-30T03:45:11.310
> 
> 标签：c#, .net, wpf, multithreading, concurrency

***注意****：如果您想要完整的源**代码，此问题中的代码是[deSleeper的一部分。](http://www.codeplex.com/desleeper)*

我想要的命令之一是异步操作的烘焙设计。我希望在命令执行时按下按钮禁用，并在完成后返回。我希望在 ThreadPool 工作项中执行实际工作。最后，我想要一种方法来处理异步处理期间发生的任何错误。

我的解决方案是 AsyncCommand：

```
public abstract class AsyncCommand : ICommand
{
    public event EventHandler CanExecuteChanged;
    public event EventHandler ExecutionStarting;
    public event EventHandler<AsyncCommandCompleteEventArgs> ExecutionComplete;

    public abstract string Text { get; }
    private bool _isExecuting;
    public bool IsExecuting
    {
        get { return _isExecuting; }
        private set
        {
            _isExecuting = value;
            if (CanExecuteChanged != null)
                CanExecuteChanged(this, EventArgs.Empty);
        }
    }

    protected abstract void OnExecute(object parameter);

    public void Execute(object parameter)
    {   
        try
        {
            IsExecuting = true;
            if (ExecutionStarting != null)
                ExecutionStarting(this, EventArgs.Empty);

            var dispatcher = Dispatcher.CurrentDispatcher;
            ThreadPool.QueueUserWorkItem(
                obj =>
                {
                    try
                    {
                        OnExecute(parameter);
                        if (ExecutionComplete != null)
                            dispatcher.Invoke(DispatcherPriority.Normal, 
                                ExecutionComplete, this, 
                                new AsyncCommandCompleteEventArgs(null));
                    }
                    catch (Exception ex)
                    {
                        if (ExecutionComplete != null)
                            dispatcher.Invoke(DispatcherPriority.Normal, 
                                ExecutionComplete, this, 
                                new AsyncCommandCompleteEventArgs(ex));
                    }
                    finally
                    {
                        dispatcher.Invoke(DispatcherPriority.Normal, 
                            new Action(() => IsExecuting = false));
                    }
                });
        }
        catch (Exception ex)
        {
            IsExecuting = false;
            if (ExecutionComplete != null)
                ExecutionComplete(this, new AsyncCommandCompleteEventArgs(ex));
        }
    }

    public virtual bool CanExecute(object parameter)
    {
        return !IsExecuting;
    }
} 
```

所以问题是：这一切有必要吗？我注意到内置了对数据绑定的异步支持，那么为什么不执行命令呢？可能和参数问题有关，这是我的下一个问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-23T06:22:02.527

我已经能够细化原始样本，并为遇到类似情况的其他人提供一些建议。

首先，考虑 BackgroundWorker 是否能满足需求。我仍然经常使用 AsyncCommand 来获得自动禁用功能，但如果有很多事情可以用 BackgroundWorker 完成的话。

但是通过包装 BackgroundWorker，AsyncCommand 提供了具有异步行为的类似命令的功能（我也有[关于这个主题的博客条目](http://tech.norabble.com/2008/10/asynchronous-wpf.html)）

```
public abstract class AsyncCommand : ICommand
{
    public event EventHandler CanExecuteChanged;
    public event EventHandler RunWorkerStarting;
    public event RunWorkerCompletedEventHandler RunWorkerCompleted;

    public abstract string Text { get; }
    private bool _isExecuting;
    public bool IsExecuting
    {
        get { return _isExecuting; }
        private set
        {
            _isExecuting = value;
            if (CanExecuteChanged != null)
                CanExecuteChanged(this, EventArgs.Empty);
        }
    }

    protected abstract void OnExecute(object parameter);

    public void Execute(object parameter)
    {   
        try
        {   
            onRunWorkerStarting();

            var worker = new BackgroundWorker();
            worker.DoWork += ((sender, e) => OnExecute(e.Argument));
            worker.RunWorkerCompleted += ((sender, e) => onRunWorkerCompleted(e));
            worker.RunWorkerAsync(parameter);
        }
        catch (Exception ex)
        {
            onRunWorkerCompleted(new RunWorkerCompletedEventArgs(null, ex, true));
        }
    }

    private void onRunWorkerStarting()
    {
        IsExecuting = true;
        if (RunWorkerStarting != null)
            RunWorkerStarting(this, EventArgs.Empty);
    }

    private void onRunWorkerCompleted(RunWorkerCompletedEventArgs e)
    {
        IsExecuting = false;
        if (RunWorkerCompleted != null)
            RunWorkerCompleted(this, e);
    }

    public virtual bool CanExecute(object parameter)
    {
        return !IsExecuting;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T04:18:22.277

正如我在您的另一个问题中回答的那样，您可能仍希望同步绑定到此，然后异步启动命令。这样你就避免了你现在遇到的问题。

# linux - 您将嵌入式系统上的内核控制台发送到哪里？

> ID：151687
> 
> 赞同：7
> 
> 时间：2008-09-30T03:45:54.023
> 
> 标签：linux, embedded

我正在开发一个嵌入式系统，该系统当前通过串行端口 1 上的控制台输出引导 linux（使用引导加载程序中的控制台引导参数）。但是，最终我们将使用这个串行端口。内核控制台输出的最佳解决方案是什么？/开发/空？是否可以以某种方式将其放在 pty 上，以便我们可以访问它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T03:59:17.500

如果您只想从控制台读取内核 printk 消息，而不是实际在其上运行 getty 或 shell，则可以使用 netconsole。您可以向引导加载程序内核选项（或 modprobe netconsole）提供以下内容：

```
netconsole=4444@10.0.0.1/eth1,9353@10.0.0.2/12:34:56:78:9a:bc 
```

其中 4444 是本地端口，10.0.0.1 是本地 ip，eth1 是发送消息的本地接口。9353 是远程端口，10.0.0.2 是要发送消息的远程 ip，最后一个参数是您的远程（例如：您的桌面）系统的 mac 地址。

然后查看消息运行：

```
netcat -u -l -p 9353 
```

[您可以在Documentation/networking/netconsole.txt](http://www.mjmwired.net/kernel/Documentation/networking/netconsole.txt)中阅读更多相关信息

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T04:26:58.480

您可以使用 dmesg 从 shell 访问 printk 消息缓冲区。内核缓冲区的大小是有限的，并且会用最新的条目覆盖最旧的条目，因此您需要定期检查 dmesg 或按照@bmdhacks 的建议连接 netconsole。

如果没有控制台，您将错过任何由内核崩溃打印出的 oops 信息。如果内核在 TCP 设法将输出传递到远程套接字之前死掉并开始重新启动，即使使用 netconsole 也可能无济于事。我们一般会修改 kernel/panic.c:panic() 以将寄存器内容和其他状态保存到 NOR flash 的一个区域，这样至少会有一些信息可用于事后调试。

# c# - C# Custom Applications that Access TFS

> ID：151691
> 
> 赞同：4
> 
> 时间：2008-09-30T03:49:18.443
> 
> 标签：c#, tfs

We have built a custom application, for internal use, that accesses TFS. We use the Microsoft libraries for this (e.g Microsoft.TeamFoundation.dll).

When this application is deployed to PCs that already have Team Explorer or VS installed, everything is fine. When it’s deployed to PCs that don’t have this installed, it fails.

We include all the required DLLs, but the error we get is “Common Language Runtime detected and invalid program”. The error occurs on the moderately innocuous line:

```
TeamFoundationServer myServer = new TeamFoundationServer(“ourserver.ourdomain.com”); 
```

Interestingly the popular TFSAdmin tool (when you drop in the required DLLs to the exe directory) gives the same error.

I also note that many other custom applications that access TFS (e.g. [http://hinshelwood.com/tfsstickybuddy.aspx](http://hinshelwood.com/tfsstickybuddy.aspx)) also require Team Explorer or VS to be installed to work.

Clearly the DLLs are not enough and there is some magic that happens when these installs occur. Anyone know what it is? Anyone know how to make the magic happen?

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-30T20:20:35.287

The "officially supported" way of writing an application that uses the TFS Object Model is to have Team Explorer installed on the machine. This is especially important for servicing purposes - i.e. making sure that when a service pack for VSTS is applied to the client machine then the TFS API's get upgraded as well. There are no re-distribution rights to the TFS API's therefore they should not be shipped with your application.

BTW - Also note that if you are writing an application that used the TFS OM, then be sure to compile it as "X86" only rather than "Any CPU". The TFS API assemblies are all marked X86, but if you app is marked "Any CPU" then on a x64 machine it will get loaded by the 64bit CLR but when it comes time to dynamically load the TFS Assemblies it will fail.

Good luck,

Martin.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T04:01:07.153

Try this list:

[http://geekswithblogs.net/jjulian/archive/2007/06/14/113228.aspx](http://geekswithblogs.net/jjulian/archive/2007/06/14/113228.aspx)

And also trying putting them in the GAC. It may be a security trust issue - assemblies in the GAC are granted a higher CAS level.

# .net - Infragistics V7.3 与 V8.1

> ID：151696
> 
> 赞同：0
> 
> 时间：2008-09-30T03:53:43.520
> 
> 标签：.net, infragistics

我们使用 .net 的 Infragistics 控件（包括 ASP.Net 和 WinForms）已有几年了。我们想升级我们当前的版本（v6.3）并且处于泡菜中。由于许可限制，我们可以升级到 v7.3 或 v8.1，但不能升级到更高版本，并且我们不想在许可上花费更多钱，除非确实有必要。有传言说 x.1 版本通常不如之前的 (x-1).3 版本稳定，因为有更多的变化。这只是一个谣言，我不知道它是否真实，我也不声称它是真的。

我想知道的是哪个选项是首选以及为什么：

1.  升级到 v7.3
2.  升级到 v8.1
3.  购买更多许可证并升级到最新最好的（必须是非常好的理由）。

有什么建议吗？您是否有使用这两个版本的经验并且可以比较它们的稳定性？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T18:04:18.693

传统上，我对 Infragistics NetAdvantage 版本没有任何“稳定性”问题。但是，我发现了重大更改（尤其是在 ASP.NET CSOM 方面），以及更小、更隐蔽的陷阱。因此，我们公司的政策是在绝对、非常必要之前不升级支持 Infragistics 的项目。（是的，这意味着我当前的开发机器实际上安装了四个版本的 IG。我的上一个有 8 个，因为它还支持 VS2003/.NET 1.1！）

IG在发布新版本时**确实**倾向于修复相当多的错误。我经常会发现在旧项目中需要的 hack 或解决方法在新项目中不再需要。（这显然是特定于控制的。）

如果您要升级给定项目的控制集，我的官方建议是尽可能更新。无论如何，您将（可能）进行重大更改等，但至少通过这种方式，您也可以获得最新错误修复的优势。请注意，这可能不是新许可的理由——如果您要取消 IG 订阅，这不是撤销它的理由。但是尽可能更新——对你来说，这听起来像 8.1。

# c# - WPF 命令和参数

> ID：151700
> 
> 赞同：3
> 
> 时间：2008-09-30T03:56:43.170
> 
> 标签：c#, .net, wpf, xaml

我发现 WPF 命令参数是一个限制。也许这表明我将它们用于错误的目的，但在我报废并采取不同的策略之前，我仍在尝试。

我组装了一个[异步执行命令](https://stackoverflow.com/questions/151686/asynchrnonous-wpf-commands)的系统，但是很难使用任何需要数据输入的东西。我知道 WPF 命令的一种常见模式是传入`this`. 但是`this`对于异步命令根本不起作用，因为所有依赖项属性都无法访问。

我最终得到这样的代码：

```
<Button Command="{Binding ElementName=servicePage, Path=InstallServiceCommand}">
  <Button.CommandParameter>
     <MultiBinding Converter="{StaticResource InstallServiceParameterConverter}">
        <MultiBinding.Bindings>
           <Binding ElementName="servicePage" Path="IsInstalled"/>
           <Binding ElementName="localURI" Path="Text"/>
           <Binding ElementName="meshURI" Path="Text"/>
           <Binding ElementName="registerWithMesh" Path="IsChecked"/>
         </MultiBinding.Bindings>
      </MultiBinding>
  </Button.CommandParameter>
</Button> 
```

并且还需要 InstallServiceParametersConverter 类（加上 InstallServiceParameters）。

任何人都看到了一种明显的改进方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T13:56:24.373

让我指出我的开源项目 Caliburn。你可以在[这里](http://caliburn.codeplex.com/)找到它。最有助于解决您的问题的功能[在此处简要记录](http://caliburn.codeplex.com/Wiki/View.aspx?title=Action%20Basics&referringTitle=Table%20Of%20Contents.)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-15T09:53:07.050

尝试使用类似 MVVM 的东西：

创建一个类来存储当前“视图”（窗口、页面、对您的应用程序有意义的任何内容）中显示的所有数据。

将您的控件绑定到此类的一个实例。

让类公开一些 ICommand 属性，将按钮的 Command 属性绑定到数据类中的相应属性，您不需要设置命令参数，因为所有数据已经​​使用普通的日常数据绑定传输到对象。

有一个 ICommand 派生类回调你的对象，看看这个链接的几个实现：

[http://dotnet.org.za/rudi/archive/2009/03/05/the-power-of-icommand.aspx](http://dotnet.org.za/rudi/archive/2009/03/05/the-power-of-icommand.aspx)

在命令调用的方法中，打包所有需要的数据并将其发送到后台线程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-15T11:46:13.610

命令用于避免 UI 和程序逻辑之间的紧密耦合。在这里，你试图绕过它，所以你会发现它很痛苦。您希望将 UI 绑定到其他对象（包含此数据），然后您的命令可以简单地调用该对象。尝试搜索 MV-VM，或查看 PRISM 示例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T04:13:22.210

您需要一些允许您请求正确对象的东西。也许您需要一个对象来存储您的父对象可以作为属性公开的这些参数。

真正应该做的是让命令保持同步并通过抛出一个新线程或将它们传递给命令管理器（家庭滚动）来异步执行它们。

# javascript - 在 iframe 中运行 Google Analytics？

> ID：151701
> 
> 赞同：18
> 
> 时间：2008-09-30T03:58:11.310
> 
> 标签：javascript, iframe, google-analytics, cross-domain, tracking

我们公司运行一个网站 (oursite.com) 与向我们发送流量的附属合作伙伴。在某些情况下，我们使用自己的子域 (affiliate.oursite.com) 设置我们的关联公司，并且他们使用 iframe 在其网站 (affiliate.com) 上显示我们网站的选定内容。

他们网站上的页面示例：

```
<html>
<head></head>
<body>
<iframe src="affiliate.example.com/example_page.html">
...content...
[google analytics code for affiliate.oursite.com]
</iframe>
[google analytics code for affiliate.com]
</body>
</html> 
```

我们希望对affiliate.oursite.com 进行谷歌分析跟踪。目前，当从 iframe 加载页面时，Google 似乎没有收到任何来自会员的数据。

现在，存在安全隐患，因为 Javascript 不喜欢访问有关不同域中页面的信息，而 IE 不喜欢为不同域设置 cookie。

有人对此有解决方案吗？我们是否需要将affiliate.oursite.com 命名为 cname.oursite.com，还是有更清洁的解决方案？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-30T09:36:29.047

1.  您必须将 Google Analytics 跟踪代码附加到`example_page.html`. `<iframe>`-标签之间的内容`</iframe>`只显示给不支持该特定标签的浏览器。

2.  如果您需要合并来自子域的结果，Google 帮助站点上有一篇很棒的文章：[如何在一个配置文件中跟踪我站点的所有子域？](http://www.google.com/support/googleanalytics/bin/answer.py?hl=en&answer=55524)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-12T00:40:47.310

对不起，但它不会工作。原因是因为谷歌分析使用第一方 cookie。这意味着 GA 设置的 cookie 特定于代码所在的域。在您的情况下，iFrame 位于第三方域中。这意味着您将拥有两组 GA cookie（每个域一组），并且没有真正的方法来协调数据。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-12-23T10:29:18.907

在 iframe 的具体情况下，谷歌并没有多说。我也遇到过同样的情况，但我很高兴我弄明白了。我在[这里发布了一个演练](http://www.emarketeur.fr/gestion-de-projet/developper/mesurer-son-trafic-sur-plusieurs-domaines-au-travers-dun-iframe-avec-google-analytics)。它是法语的，但您无需说该语言即可复制/粘贴代码。此外，您还可以下载一个演示文件。

# svn - 代码提升：构建还是二进制？

> ID：151721
> 
> 赞同：4
> 
> 时间：2008-09-30T04:12:56.063
> 
> 标签：svn, version-control, tfs

给定一个非常基本的源代码树结构，如下所示：

```
树干  -  -  - -
   质量保证 |--------
     舞台|-------
        产品 |------

```

以及一个反映了这一点的环境（开发、QA、登台和生产服务器）——你们都如何管理自动或手动代码提升？您是否在所有阶段都使用 CI 服务器进行构建和推广？开发人员的 CI 构建始终使用的二进制文件？其他混血儿？

我一直在思考几个想法。第一个是每次升级都会执行获取最新、构建，然后将构建的输出推送到正确的服务器。第二个是在某些时候 - QA 或 Staging - 被提升的二进制文件将与复制到其他阶段的完全相同。第三是为已部署的二进制文件保留一个二级源代码树，它会自动与代码升级同步移动。还有其他想法或想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T04:17:46.847

您绝对不希望生产代码与测试的 QA 代码不同，因此您应该使用二进制文件。

您还应该标记用于创建每个构建的源，因此如果需要，您可以在开发环境中重现构建。至少如果你在这一点上犯了一个错误，后果不会那么严重。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T04:19:59.870

我们在开发阶段使用 CI，并使用推广的每日构建。如果成功，这些每日构建会在 SVN 中标记，这样我们就不需要保留二进制文件的单独副本。还包括引用的任何第三方库，以便标记是所编译内容的精确源副本。

# c++ - 分别针对不同平台开发，有人推荐吗？

> ID：151728
> 
> 赞同：3
> 
> 时间：2008-09-30T04:15:07.587
> 
> 标签：c++, user-interface, cross-platform, platform-specific

我知道推荐几个跨平台库很容易。

但是，为您的产品单独处理每个平台是否有好处？

是的，所有平台都会使用一些基础库，但 UI 和其他一些东西在每个平台上都会有所不同。

我没有限制每个平台上的产品必须 100% 相似。

Mac、Linux 和 Windows 是目标平台。

重win32 API，MFC已经用于Windows版本。

我不完全支持跨平台库的原因是因为我觉得最终产品在尝试将其推广到所有平台时会受到一点影响。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-30T04:24:16.347

我想说每个平台的个人开发的好处是：

- 原生的外观和感觉

- 您的开发人员获得的平台知识

-...我没有想法

说真的，如果您不小心，开发和维护应用程序的 3 个独立副本的成本可能会非常高。

如果它只是您担心的 GUI 代码，那么无论如何都要将 GUI 部分分离到每个平台的开发工作中，但是您会后悔没有保持核心“业务逻辑”类型代码的通用性。

考虑到将您的 GUI 与逻辑分开通常被认为是一个好主意，当不可避免地出现将“一点点”业务逻辑放入表示层的诱惑时，这将迫使您的开发人员保持这种分离。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T04:26:04.753

我认为好处是

*   能够在所有平台上获得完全原生的行为，这对最终用户来说是一件好事

风险在于

*   您最终可能会编写三个应用程序而不是一个有一些差异的应用程序（即，让我们也以不同的方式做 X 更容易陷入困境！）
*   您将在不同的操作系统版本之间创建轻微的不兼容性，而不会注意到它。
*   维护成本将与您拥有的不同代码的数量成正比

因此，通过考虑风险，您可以开发具有尽可能大的通用核心（抵制风险 1 的诱惑）、适用于所有平台的大量集成测试（最小化风险 2）并设计为性能良好的原生应用程序减少获得本机行为所需的代码量（注意风险 3）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T04:18:55.923

我不能否认这很有吸引力，但它肯定会提出中间立场的问题。很明显，你会分享一些后端代码，但是你能分享多少，你会在设计和代码两个方面在 UI 方面分享什么？

我认为这是一个个案问题。通常，这可能不值得，但某些特定平台上的某些特定应用程序应该针对该操作系统的细节。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T04:23:04.090

是的，跨平台 UI 库总是会让你的程序在至少一个平台上看起来和/或表现得有点“怪异”。

如果您在 UI 代码和内部实现了良好的分离，那么重用非 UI 代码并为每个平台创建优化的用户界面并不难。许多高预算的跨平台应用程序就是这样制作的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T06:25:31.533

它还取决于您的平台有多不同，以及一个平台上的所有功能是否在另一个平台上可用。我开发的工具具有适用于 Win32 平台、Windows CE 和移动设备以及各种嵌入式平台的版本。该产品的某些方面根本与没有匹配硬件的平台相关。例如，我目前正在研究 [link text] 基于实地的土地调查产品[1](http://www.atlascomputers.ie/index.php?page=pocketdtm-views)与各种测量设备（如 GPS 和全站仪）配合使用，在各种平台上使用各种通信媒体，如蓝牙、RS232 和无线电调制解调器。我目前正在研究的特定版本将托管在具有相对较小的屏幕和键盘以及非常有限的内存和存储空间的测量设备上。包含与其他设备相关的功能是没有意义的，保持界面尽可能简单和流线型对用户非常有益。

流线型的用户界面、小的可执行文件和对膨胀软件的零容忍在某些领域仍然至关重要。肯定有很多通用源，但也有很多特定于目标的源和条件编译。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T15:58:19.917

对于客户端程序（即不是 Web 服务器程序），很难找到优秀的 Mac 和 Linux 开发人员，也很难找到优秀的 Windows 开发人员。

您拥有的独立于平台的代码越多，在所有三个平台上完成您的项目就越容易和更快。

维护三个代码库既昂贵又冒险。使用跨平台工具的竞争对手每次都会在市场上击败您。

# .net - 数据集列的自定义排序

> ID：151730
> 
> 赞同：0
> 
> 时间：2008-09-30T04:16:50.140
> 
> 标签：.net, database

我有一个包含几列的数据集。这些列之一是数字 - 大多数情况下。因为它偶尔是一个字符串，所以在数据库中它是一个 varchar(10) 列。

但是，当您对 varchar 列进行排序时，它会将其排序为字符串。我想做的是尝试以某种方式覆盖它，以便它像整数一样对整数进行排序；这并不难，而且我已经有一个函数可以在我的代码中的其他地方执行此操作。但是，我认为不可能像我有一个具有自己的排序实现的自定义类型那样提供一个类型化的 DataSet，而且从我所见 BindingSource 根本不考虑列，这使得排序变得非常困难他们。我可以使用 ListView/DataGridView 排序功能轻松做到这一点——但由于我拥有的数据量，我希望显示处于虚拟模式，为此我需要提供自己的排序。

有什么办法可以做我想做的事吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T04:23:45.523

我认为您最好的选择是添加一个新的计算列，将 varchar(10) 转换为 int，然后对其进行排序。

```
myDataTable.Columns.Add("Sorter", typeof(System.Int32), "Convert(TextColumn, 'System.Int32')"); 
```

当您的 varchar 列（我在上面的代码中将其称为“TextColumn”）中的字符串时，这将引发异常，但您可以使用表达式中的 Iif() 函数调用来解决这个问题。

# javascript - Ext.form.FormPanel 和表单提交

> ID：151731
> 
> 赞同：0
> 
> 时间：2008-09-30T04:17:16.350
> 
> 标签：javascript, ajax, json, user-interface, extjs

我一直在尝试使用 Ext 默认的 Action 类提交带有 FormPanel 的表单。但是，我希望将响应视为脚本，而不是 JSON 编码。

有没有人有这方面的经验？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T07:48:38.417

最好的计划是通过扩展来创建自定义操作`Ext.form.Action`。

`eval`然后，您可以在自定义操作的回调中使用`response`对象或`result`对象。`success`

可以以`Ext.form.BasicForm`通常的方式调用您的自定义操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-21T17:24:42.860

使用`Form.getForm().submit()`作为您的操作响应调用效果很好，并且会自动将您的表单值以及您想要提供的任何自定义值提交到您的后端。在返回响应中，您会收到一个响应对象，它可以是您想要的任何东西。因此，您可以轻松地评估成功处理程序中的返回值。

还有一些覆盖可以将此功能添加到[此处](http://extjs.com/forum/showthread.php?t=17691)`Ext.ajax.request`看到的普通中。除了跨域脚本标签外，也存在相同的功能。`Ext.data.ScriptTagProxy`

# c# - 参数化单例模式

> ID：151736
> 
> 赞同：5
> 
> 时间：2008-09-30T04:18:23.477
> 
> 标签：c#, design-patterns

此处的链接列出了 ([http://www.yoda.arachsys.com/csharp/singleton.html][1]) C# 中的一些单例模式。这篇文章还描述了一个明显的单例并不意味着接受参数，“否则对实例的第二次请求但使用不同的参数可能会出现问题”。这意味着你需要让类工作的任何参数都应该作为属性引入。

我很想知道是否有任何参数化的单例设计模式。接受值作为属性不会对消费者强制执行任何操作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T04:26:53.423

根据您的问题，您似乎正在查看一个抽象工厂模式（创建几个类家族的实例），该模式保留已实例化的类的内部列表/字典，从而模仿单例模式功能。

然后，您将使用此工厂类根据您传入的参数请求一个对象，如果它存在于其内部列表中，则返回，如果不存在，则创建一个新实例，然后将其添加到列表中并返回。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T04:31:46.923

> 他的意思是，你需要让类工作的任何参数都应该被引入为一个属性。

理想情况下，单例类不应依赖于外部代码。

如果您需要向单例构造函数提供其他信息，您可以创建一个对象池。

它可以是一个简单的列表或任何其他合适的数据结构。您需要使其成为线程安全的（如果重要的话）并保证不会有多个使用相同参数实例化的对象。

基本上你会有一个类工厂。它将为相同的参数返回相同的对象。

在这种情况下，您将拥有 N 个单例对象 - 即具有不同状态的对象将被视为完全不同的实例。

您可以在 Inversion of Controls 容器中找到此类单例的示例。

例如，您可以拥有一些依赖于其他服务的服务。当您调用 container.Get（服务类型）时。DI 容器将自动使用所需参数初始化服务实例并将其返回给调用者。但是这个服务实例变成了单例——你将无法创建另一个具有相同参数的服务。

# iphone - iPhone标签栏项目图像分辨率？

> ID：151746
> 
> 赞同：43
> 
> 时间：2008-09-30T04:22:29.147
> 
> 标签：iphone

标签栏项目的图像分辨率是多少？

此外，请提供有关该选项卡项目图像的其他一些有用信息。

提前致谢。

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2008-10-06T05:49:32.957

文档说标签栏图像通常是 30x30，但我发现设置图像的最佳尺寸是 48x32 像素。这个尺寸仍然可以渲染并为您提供更多空间。

该图像是具有透明度的PNG，仅使用了蒙版。UI 在未选中时将蒙版呈现为灰色，在选中时呈现蓝色/铬色。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-07-14T04:45:55.677

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2011-04-28T17:27:03.143

这种说法在技术上是不正确的：

“...仅使用蒙版。UI 在未选中时将蒙版呈现为灰色，在选中时将蒙版呈现为蓝色/铬色......”

您不提供任何类型的口罩。相反，标签图像应该只是一个**单色**.png 图像，也就是**只使用一种颜色**。

如果您提供彩色图像，UIKit 会将其量化为单色图像。在最坏的情况下，彩色图像将是 ~8000 字节，这浪费了 ~6k（视网膜）。文件格式必须是具有透明度的 24 位 .png 才能使量化正常工作。即使这是一种颜色文件格式，也不要使用颜色，否则会浪费空间。

*底线是要有合适的大小，最好的性能和内存使用，使用以下之一：*

标准显示
  **48x32 .PNG，24 位透明（但仅使用 1 种颜色）**。最坏情况大小约为 500 字节。
  **30x30 .PNG，24 位透明（但仅使用 1 种颜色）**。最坏情况大小约为 350 字节。

Retina 显示
  **60x60 .PNG，24 位透明（但仅使用 1 种颜色）**。最坏情况大小约为 2000 字节。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-30T05:11:17.077

[检查SDK 文档](http://developer.apple.com/library/ios/#documentation/uikit/reference/UITabBarItem_Class/Reference/Reference.html)中的“UITabBarItem 类参考”

# c# - 情节提要找不到 ControlTemplate 元素

> ID：151752
> 
> 赞同：14
> 
> 时间：2008-09-30T04:25:21.150
> 
> 标签：c#, .net, wpf, xaml, animation

我创建了一些相当简单的 XAML，并且它运行良好（至少在 KAXML 中）。从 XAML 中调用情节提要时，情节提要运行良好，但是当我尝试从外部访问它们时，出现错误：

```
'buttonGlow' name cannot be found in the name scope of 'System.Windows.Controls.Button'. 
```

我正在使用流阅读器加载 XAML，如下所示：

```
Button x = (Button)XamlReader.Load(stream); 
```

并尝试使用以下方式运行情节提要：

```
Storyboard pressedButtonStoryboard =   
    Storyboard)_xamlButton.Template.Resources["ButtonPressed"];
pressedButtonStoryboard.Begin(_xamlButton); 
```

我认为问题在于我正在制作动画的字段在模板中，并且情节提要正在访问按钮。

这是 XAML：

```
<Button xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:customControls="clr-namespace:pk_rodoment.SkinningEngine;assembly=pk_rodoment" 
    Width="150" Height="55">
    <Button.Resources>
        <Style TargetType="Button">
            <Setter Property="Control.Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid Background="#00FFFFFF">
                            <Grid.BitmapEffect>
                                <BitmapEffectGroup>
                                    <OuterGlowBitmapEffect x:Name="buttonGlow" GlowColor="#A0FEDF00" GlowSize="0"/>
                                </BitmapEffectGroup>
                            </Grid.BitmapEffect>
                            <Border x:Name="background" Margin="1,1,1,1" CornerRadius="15">
                                <Border.Background>
                                    <SolidColorBrush Color="#FF0062B6"/>
                                </Border.Background>                                
                            </Border>                            
                            <ContentPresenter HorizontalAlignment="Center"
                                Margin="{TemplateBinding Control.Padding}"
                                VerticalAlignment="Center"
                                Content="{TemplateBinding ContentControl.Content}"
                                ContentTemplate="{TemplateBinding ContentControl.ContentTemplate}"/>
                        </Grid>
                        <ControlTemplate.Resources>
                            <Storyboard x:Key="ButtonPressed">
                                <Storyboard.Children>
                                    <DoubleAnimation Duration="0:0:0.4"
                                                  FillBehavior="HoldEnd"
                                                  Storyboard.TargetName="buttonGlow"
                                                  Storyboard.TargetProperty="GlowSize" To="4"/>
                                    <ColorAnimation Duration="0:0:0.6"
                                                  FillBehavior="HoldEnd"
                                                  Storyboard.TargetName="background"
                                                  Storyboard.TargetProperty="(Panel.Background).(SolidColorBrush.Color)"
                                                  To="#FF844800"/>
                                </Storyboard.Children>
                            </Storyboard>
                            <Storyboard x:Key="ButtonReleased">
                                <Storyboard.Children>
                                    <DoubleAnimation Duration="0:0:0.2"
                                                  FillBehavior="HoldEnd"
                                                  Storyboard.TargetName="buttonGlow"
                                                  Storyboard.TargetProperty="GlowSize" To="0"/>
                                    <ColorAnimation Duration="0:0:0.2"
                                                  FillBehavior="Stop"
                                                  Storyboard.TargetName="background"
                                                  Storyboard.TargetProperty="(Panel.Background).(SolidColorBrush.Color)"
                                                  To="#FF0062B6"/>
                                </Storyboard.Children>
                            </Storyboard>
                        </ControlTemplate.Resources>
                        <ControlTemplate.Triggers>
                            <Trigger Property="ButtonBase.IsPressed" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard Storyboard="{StaticResource ButtonPressed}"/>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard Storyboard="{StaticResource ButtonReleased}"/>
                                </Trigger.ExitActions>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Button.Resources>
    <DockPanel>
        <TextBlock x:Name="TextContent" FontSize="28" Foreground="White" >Test</TextBlock>        
    </DockPanel>
</Button> 
```

任何比我更了解 WPF 和 XAML 的人有什么建议吗？

这是错误堆栈跟踪：

```
at System.Windows.Media.Animation.Storyboard.ResolveTargetName(String targetName, INameScope nameScope, DependencyObject element)
at System.Windows.Media.Animation.Storyboard.ClockTreeWalkRecursive(Clock currentClock, DependencyObject containingObject, INameScope nameScope, DependencyObject parentObject, String parentObjectName, PropertyPath parentPropertyPath, HandoffBehavior handoffBehavior, HybridDictionary clockMappings, Int64 layer)
at System.Windows.Media.Animation.Storyboard.ClockTreeWalkRecursive(Clock currentClock, DependencyObject containingObject, INameScope nameScope, DependencyObject parentObject, String parentObjectName, PropertyPath parentPropertyPath, HandoffBehavior handoffBehavior, HybridDictionary clockMappings, Int64 layer)
at System.Windows.Media.Animation.Storyboard.BeginCommon(DependencyObject containingObject, INameScope nameScope, HandoffBehavior handoffBehavior, Boolean isControllable, Int64 layer)
at System.Windows.Media.Animation.Storyboard.Begin(FrameworkElement containingObject)
at pk_rodoment.SkinningEngine.ButtonControlWPF._button_MouseDown(Object sender, MouseButtonEventArgs e)
at System.Windows.Input.MouseButtonEventArgs.InvokeEventHandler(Delegate genericHandler, Object genericTarget)
at System.Windows.RoutedEventArgs.InvokeHandler(Delegate handler, Object target)
at System.Windows.RoutedEventHandlerInfo.InvokeHandler(Object target, RoutedEventArgs routedEventArgs)
at System.Windows.EventRoute.InvokeHandlersImpl(Object source, RoutedEventArgs args, Boolean reRaised)
at System.Windows.UIElement.RaiseEventImpl(DependencyObject sender, RoutedEventArgs args)
at System.Windows.UIElement.RaiseEvent(RoutedEventArgs args, Boolean trusted)
at System.Windows.Input.InputManager.ProcessStagingArea()
at System.Windows.Input.InputManager.ProcessInput(InputEventArgs input)
at System.Windows.Input.InputProviderSite.ReportInput(InputReport inputReport)
at System.Windows.Interop.HwndMouseInputProvider.ReportInput(IntPtr hwnd, InputMode mode, Int32 timestamp, RawMouseActions actions, Int32 x, Int32 y, Int32 wheel)
at System.Windows.Interop.HwndMouseInputProvider.FilterMessage(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, Boolean& handled)
at System.Windows.Interop.HwndSource.InputFilterMessage(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, Boolean& handled)
at MS.Win32.HwndWrapper.WndProc(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, Boolean& handled)
at MS.Win32.HwndSubclass.DispatcherCallbackOperation(Object o)
at System.Windows.Threading.ExceptionWrapper.InternalRealCall(Delegate callback, Object args, Boolean isSingleParameter)
at System.Windows.Threading.ExceptionWrapper.TryCatchWhen(Object source, Delegate callback, Object args, Boolean isSingleParameter, Delegate catchHandler)
at System.Windows.Threading.Dispatcher.WrappedInvoke(Delegate callback, Object args, Boolean isSingleParameter, Delegate catchHandler)
at System.Windows.Threading.Dispatcher.InvokeImpl(DispatcherPriority priority, TimeSpan timeout, Delegate method, Object args, Boolean isSingleParameter)
at System.Windows.Threading.Dispatcher.Invoke(DispatcherPriority priority, Delegate method, Object arg)
at MS.Win32.HwndSubclass.SubclassWndProc(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam)
at MS.Win32.UnsafeNativeMethods.DispatchMessage(MSG& msg)
at System.Windows.Threading.Dispatcher.PushFrameImpl(DispatcherFrame frame)
at System.Windows.Threading.Dispatcher.PushFrame(DispatcherFrame frame)
at System.Windows.Threading.Dispatcher.Run()
at System.Windows.Application.RunDispatcher(Object ignore)
at System.Windows.Application.RunInternal(Window window)
at System.Windows.Application.Run(Window window)
at System.Windows.Application.Run()
at ControlTestbed.App.Main() in C:\svnprojects\rodomont\ControlsTestbed\obj\Debug\App.g.cs:line 0
at System.AppDomain._nExecuteAssembly(Assembly assembly, String[] args)
at System.AppDomain.ExecuteAssembly(String assemblyFile, Evidence assemblySecurity, String[] args)
at Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()
at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)
at System.Threading.ThreadHelper.ThreadStart() 
```

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-30T17:49:40.843

终于找到了。当您在引用 ControlTemplate 中元素的情节提要上调用 Begin 时，您也必须传入控件模板。

改变：

```
pressedButtonStoryboard.Begin(_xamlButton); 
```

到：

```
pressedButtonStoryboard.Begin(_xamlButton, _xamlButton.Template); 
```

修复了一切。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-30T17:53:02.440

我通过重组 XAML 使其工作，以便按钮的资源`SolidColorBrush`和`OuterGlowBitmapEffect`资源被`Storyboard`s 和它们所应用的元素共享。我像您一样检索`Storyboard`并调用`Begin()`了它，但这里是修改后的 XAML `Button`：

（请注意键`"buttonGlow"`和引用它们的`"borderBackground"`所有`StaticResource`标记扩展。）

```
<Button
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Width="150"
    Height="55">
    <Button.Resources>
        <OuterGlowBitmapEffect
            x:Key="buttonGlow"
            GlowColor="#A0FEDF00"
            GlowSize="0" />
        <SolidColorBrush
            x:Key="borderBackground"
            Color="#FF0062B6" />
        <Style
            TargetType="Button">
            <Setter
                Property="Control.Template">
                <Setter.Value>
                    <ControlTemplate
                        TargetType="Button">
                        <Grid
                            Name="outerGrid"
                            Background="#00FFFFFF"
                            BitmapEffect="{StaticResource buttonGlow}">
                            <Border
                                x:Name="background"
                                Margin="1,1,1,1"
                                CornerRadius="15"
                                Background="{StaticResource borderBackground}">
                            </Border>
                            <ContentPresenter
                                HorizontalAlignment="Center"
                                Margin="{TemplateBinding Control.Padding}"
                                VerticalAlignment="Center"
                                Content="{TemplateBinding ContentControl.Content}"
                                ContentTemplate="{TemplateBinding ContentControl.ContentTemplate}" />
                        </Grid>
                        <ControlTemplate.Resources>
                            <Storyboard
                                x:Key="ButtonPressed">
                                <Storyboard.Children>
                                    <DoubleAnimation
                                        Duration="0:0:0.4"
                                        FillBehavior="HoldEnd"
                                        Storyboard.Target="{StaticResource buttonGlow}"
                                        Storyboard.TargetProperty="GlowSize"
                                        To="4" />
                                    <ColorAnimation
                                        Duration="0:0:0.6"
                                        FillBehavior="HoldEnd"
                                        Storyboard.Target="{StaticResource borderBackground}"
                                        Storyboard.TargetProperty="Color"
                                        To="#FF844800" />
                                </Storyboard.Children>
                            </Storyboard>
                            <Storyboard
                                x:Key="ButtonReleased">
                                <Storyboard.Children>
                                    <DoubleAnimation
                                        Duration="0:0:0.2"
                                        FillBehavior="HoldEnd"
                                        Storyboard.Target="{StaticResource buttonGlow}"
                                        Storyboard.TargetProperty="GlowSize"
                                        To="0" />
                                    <ColorAnimation
                                        Duration="0:0:0.2"
                                        FillBehavior="Stop"
                                        Storyboard.Target="{StaticResource borderBackground}"
                                        Storyboard.TargetProperty="Color"
                                        To="#FF0062B6" />
                                </Storyboard.Children>
                            </Storyboard>
                        </ControlTemplate.Resources>
                        <ControlTemplate.Triggers>
                            <Trigger
                                Property="ButtonBase.IsPressed"
                                Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard
                                        Storyboard="{StaticResource ButtonPressed}" />
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard
                                        Storyboard="{StaticResource ButtonReleased}" />
                                </Trigger.ExitActions>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Button.Resources>
    <DockPanel>
        <TextBlock
            x:Name="TextContent"
            FontSize="28"
            Foreground="White">Test</TextBlock>
    </DockPanel>
</Button> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T17:32:09.777

我想刚刚有这个问题。

让我向您推荐我关于此事的博客文章：[http ://www.cplotts.com/2008/09/26/dr-wpf-namescopes/](http://www.cplotts.com/2008/09/26/dr-wpf-namescopes/)

基本上，诀窍是您需要使用一个参数调用 Begin，该参数是故事板所针对的同名范围内的对象。

特别是，从上面的示例中，我会尝试调用 Begin 并发送对模板中 _background 元素的引用。

如果这不能解决您的问题，请告诉我。

**更新：**

我比我更喜欢 Erickson 的解决方案……它也对我有用。我不知道我是怎么错过 Begin 方法的重载的！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-19T07:32:18.240

（@ Sam Meldrum）要停止工作，请在开头为“isControllable”添加“true”

```
pressedButtonStoryboard.Begin(_xamlButton, _xamlButton.Template); 
```

改成

```
pressedButtonStoryboard.Begin(_xamlButton, _xamlButton.Template,true); 
```

现在

```
pressedButtonStoryboard.Stop(xamlButton) 
```

将工作

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-08-15T16:09:36.807

我也遇到了这个错误。我的情况有点不同，也许更简单。我有一个 WPF 窗口，上面有一个带有动画的模板。然后，我在窗口本身上为按钮定义了由 MouseEnter 触发的单独的完全不相关的动画。我开始收到“在名称范围内找不到 button1”。在这里玩了一些想法并调试了实际的 Namescope 之后（关注 NameScope.GetNameScope(this) 的结果，我终于发现解决方案是：

```
 this.RegisterName("button1", this.button1); 
```

在代码中定义并附加到按钮的 MouseEnter 方法中。此 MouseEnter 将在 xaml 触发器之前调用。奇怪的是，如果 register 方法在构造函数或 Window.Activated() 方法中，则它不起作用。希望这可以帮助某人。

# browser - 识别请求响应的设备

> ID：151756
> 
> 赞同：1
> 
> 时间：2008-09-30T04:27:42.987
> 
> 标签：browser, user-agent

网络服务器是否有可能知道收到了哪种*类型的设备请求？*

例如，如果请求来自计算机 (Firefox)，是否可以创建一个显示不同内容的网站，如果请求来自 iPhone，则显示不同的内容？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T04:31:17.767

米奇所说的，但有可能伪造用户代理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T04:37:45.630

如前所述，方法是用户代理标头。您最好使用这样的列表[来](http://www.zytrax.com/tech/web/mobile_ids.html)找出它是哪部手机。

当我不得不做类似的事情时，我将未知的接收到的用户代理存储在一个表中，以便稍后找出我没有存储的用户代理，因此无法确定要提供什么服务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T04:30:37.957

检查`User-Agent`请求标头中的

有关 HTTP 标头的完整详细信息，请参阅[http://www.w3.org/Protocols/](http://www.w3.org/Protocols/)上的规范。

# .net - .NET 框架更新是否推送给了 windows-updates 的每个用户？

> ID：151765
> 
> 赞同：2
> 
> 时间：2008-09-30T04:35:39.677
> 
> 标签：.net, deployment

Microsoft 是否强制对其所有 windows-update 用户进行更新？是出于法律原因吗？

编辑（阿库）：

问题被重新制定。如果您想知道 .NET 附带的 Windows 版本，请参阅此主题：

[https://stackoverflow.com/questions/71390/which-operating-systems-come-with-net](https://stackoverflow.com/questions/71390/which-operating-systems-come-with-net)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-30T04:36:41.560

是的，Windows Vista 附带 .NET Framework 3.0。我确信未来版本的 Windows 将随框架的最新版本一起提供。

Scott Hanselman 最近发表了一篇关于 Windows Update 上 .NET 3.5 状态的博客：

[http://www.hanselman.com/blog/UpdateOnNETFramework35SP1AndWindowsUpdate.aspx](http://www.hanselman.com/blog/UpdateOnNETFramework35SP1AndWindowsUpdate.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T04:37:43.587

> Microsoft 是否强制对其所有 windows-update 用户进行更新？是出于法律原因吗？

可能最好问问微软。

我不记得他们强行安装新版本的 .NET 的案例。AFAIK 只有重要的安全更新是强制性的。他们不会强迫您安装服务包等。但我可能是错的 :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T04:38:38.653

某些 XP OEM 安装安装了某些版本的 .NET，因为某些包含的软件需要它。Vista 安装了 .NET 3.0。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T04:59:26.310

Microsoft 只会在 Windows/Microsoft 更新过程中推送更新，即使这样，也只有在您将它们设置为自动安装的情况下。如果您没有更新配置为无需询问即可运行，那么您将永远不必更新 .NET 框架，尽管这些更新很少会破坏功能，并且出于安全原因强烈建议您这样做。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T05:12:02.380

Scott Hanselman 最近发表了一篇关于 Windows Update 上 .NET 3.5 状态的博客：

[http://www.hanselman.com/blog/UpdateOnNETFramework35SP1AndWindowsUpdate.aspx](http://www.hanselman.com/blog/UpdateOnNETFramework35SP1AndWindowsUpdate.aspx)

# design-patterns - OOP模式设计（数据访问）的常用方法是什么

> ID：151769
> 
> 赞同：5
> 
> 时间：2008-09-30T04:37:34.583
> 
> 标签：design-patterns, oop, multi-tier

最初有我的 BO 调用信息然后传递给 UI 的 DAL 对象。然后我开始注意到 UI 中的代码减少了，并且有 Controller 类。有什么好的推荐。

我目前正在构建我的

```
Public Class OrderDAL

    Private _id Integer
    Private _order as Order

    Public Function GetOrder(id as Integer) as Order

        ...return Order

    End Function

End Class 
```

然后我有控制器类（最近实现了这种风格）

```
Public Class OrderController

    Private Shared _orderDAL as new OrderDAL

    Public Shared Function GetOrder(id) As Order

        Return _orderDAL.GetOrder(id)

    End Function

End Class 
```

然后在我的应用程序中

```
My app Sub

    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click

        msgbox(OrderController.GetOrder(12345).Customer.Name)

    End Sub

End app 
```

我最初发现使用共享类时，我不必在需要获取数据时继续创建 DAL 的新实例

```
Dim _orderDAL as New OrderDal

_orderDAL.GetOrder(1234)

..... 
```

你怎么看？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T04:54:01.660

我认为这本优秀的书中列出了几种替代方案：[企业应用程序架构模式](https://rads.stackoverflow.com/amzn/click/com/0321127420)。您可能感兴趣的一些模式：

*   [活动记录](http://martinfowler.com/eaaCatalog/activeRecord.html)
*   [表数据网关](http://martinfowler.com/eaaCatalog/tableDataGateway.html)
*   [行数据网关](http://martinfowler.com/eaaCatalog/rowDataGateway.html)
*   [数据映射器](http://martinfowler.com/eaaCatalog/dataMapper.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T04:51:16.923

好吧，您的应用程序不应该实例化数据访问层的单独版本，因此您可以控制它。您发布的 Psuedo 代码确实很难阅读。

问题是，你的数据访问层是什么，有多少？这将决定你做什么。如果你坚持到一个文件，那么我认为你写的很好，如果你需要与系统中的其他控制器共享它，可以将项目包装成一个 singelton（颤抖）。

如果你真的在做订单处理并持久化回数据库，我个人认为是时候看看 ORM 了。这些包将为您处理 CRUM 方面并减少您必须维护的项目数量。

我的 $.02，一旦我看到更好的例子，我保留修改我的答案的权利。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T05:07:56.977

我不能谈论 VB 细节，因为我不是 VB 开发人员，但是：

您正在做的是一个行之有效的良好实践，将 GUI/表示层与数据层分开。在 GUI 事件方法中包含真实的应用程序代码是一种（可悲的是也很成熟的）不好的做法。

您的控制器类类似于[桥接模式](http://en.wikipedia.org/wiki/Bridge_pattern)，如果两个层都能够在其他层不知道的情况下更改它们的形式，这也是一个好主意。

前进！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T07:59:19.047

这是一个很好的实践——尤其是当你到达控制器需要做的不仅仅是简单地委托给底层 DAL 的时候。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T08:26:37.263

我过去使用过您的解决方案，我面临的唯一问题是“共享”或“静态”方法不支持继承。当您的应用程序增长时，您可能非常需要支持不同类型的“OrderControllers”。

理论上，支持不同 OrderController 的既定方法是创建一个工厂：

```
OrderControllerFactory.ConfiguredOrderController().GetOrder(42); 
```

这里的问题是：“ConfiguredOrderController()”返回什么类型？因为它必须有静态的“GetOrder(int id)”方法——继承或接口不支持静态方法。解决这个问题的方法是不要在 OrderController 类中使用静态方法。

```
public interface IOrderController
{
    Order GetOrder(int Id)
}

public class OrderController: IOrderController
{
    public Order GetOrder(int Id)
    {}
} 
```

和

```
public class OrderControllerFactory()
{
    public IOrderController ConfiguredOrderController()
    {}
} 
```

因此，对控制器使用非静态方法可能会更好。

# c++-cli - 是否有任何工具可以将托管 C++ 转换为 C++/CLI？

> ID：151776
> 
> 赞同：6
> 
> 时间：2008-09-30T04:40:26.870
> 
> 标签：c++-cli, managed-c++, code-conversion

我们有一个使用托管 C++ 语法编写的旧项目。我想向团队提出一种合理无痛的更新方法（我不介意某种程度的人际互动，我认为我的期望是现实的，我们仍然必须手动完成一些工作）更新方法将现有代码转换为 C++/CLI 语法，以便我们还可以添加 XML 文档（该项目是其他项目的库，拥有文档将非常有用）。

那么，有什么好的工具可以帮助解决这个问题吗？还是只是切换到新的 C++/CLI 语法编译器并在我们进行时修复错误？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T05:44:36.047

微软有一个[工具](http://www.microsoft.com/downloads/details.aspx?FamilyID=a3581805-1af2-4c34-9d0e-6029cc078441&displaylang=en)可以提供一点帮助。[关于它的 Visual c++ 博客文章。](http://blogs.msdn.com/vcblog/archive/2006/12/08/managed-extensions-for-c-to-c-cli-conversion-tool.aspx) 以下是我在切换 [C++/CLI Migration Primer](http://msdn.microsoft.com/en-us/ms235289.aspx) [Managed Extensions for C++ Syntax Upgrade Checklist时发现的一些其他资源](http://msdn.microsoft.com/en-us/b23b94s7.aspx)

Microsoft 工具只是一个开始。有许多文件无法转换。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-22T18:00:22.293

不幸的是，我发现微软的[迁移工具](http://www.microsoft.com/downloads/details.aspx?FamilyID=a3581805-1af2-4c34-9d0e-6029cc078441&displaylang=en)离没用只有两步之遥。但是，有用于[Reflector的](http://www.red-gate.com/products/reflector/index.htm)[C++/CLI 反汇编](http://www.sandpapersoftware.com/Main/Reflector.html)程序，它已被证明更有用。

这并不完美，因为注释会丢失，但我发现重新添加注释比尝试手动转换大部分代码要容易得多。

# android - 如何使用保存实例状态保存活动状态？

> ID：151777
> 
> 赞同：2791
> 
> 时间：2008-09-30T04:41:15.340
> 
> 标签：android, android-activity, application-state

我一直在研究Android SDK平台，有点不清楚如何保存应用程序的状态。因此，鉴于“你好，Android”示例的这个小工具改造：

```
package com.android.hello;

import android.app.Activity;
import android.os.Bundle;
import android.widget.TextView;

public class HelloAndroid extends Activity {

  private TextView mTextView = null;

  /** Called when the activity is first created. */
  @Override
  public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);

    mTextView = new TextView(this);

    if (savedInstanceState == null) {
       mTextView.setText("Welcome to HelloAndroid!");
    } else {
       mTextView.setText("Welcome back.");
    }

    setContentView(mTextView);
  }
} 
```

我认为这对于最简单的情况就足够了，但无论我如何离开应用程序，它总是会响应第一条消息。

我确信解决方案就像覆盖`onPause`或类似的东西一样简单，但我已经在文档中戳了 30 分钟左右，但没有发现任何明显的东西。

* * *

## 回答 #1

> 赞同：2682
> 
> 时间：2008-09-30T06:12:20.847

您需要覆盖`onSaveInstanceState(Bundle savedInstanceState)`并将要更改的应用程序状态值写入`Bundle`参数，如下所示：

```
@Override
public void onSaveInstanceState(Bundle savedInstanceState) {
  super.onSaveInstanceState(savedInstanceState);
  // Save UI state changes to the savedInstanceState.
  // This bundle will be passed to onCreate if the process is
  // killed and restarted.
  savedInstanceState.putBoolean("MyBoolean", true);
  savedInstanceState.putDouble("myDouble", 1.9);
  savedInstanceState.putInt("MyInt", 1);
  savedInstanceState.putString("MyString", "Welcome back to Android");
  // etc.
} 
```

Bundle 本质上是一种存储 NVP（“名称-值对”）映射的方式，它将被传递到`onCreate()`您`onRestoreInstanceState()`将从活动中提取值的位置，如下所示：

```
@Override
public void onRestoreInstanceState(Bundle savedInstanceState) {
  super.onRestoreInstanceState(savedInstanceState);
  // Restore UI state from the savedInstanceState.
  // This bundle has also been passed to onCreate.
  boolean myBoolean = savedInstanceState.getBoolean("MyBoolean");
  double myDouble = savedInstanceState.getDouble("myDouble");
  int myInt = savedInstanceState.getInt("MyInt");
  String myString = savedInstanceState.getString("MyString");
} 
```

或者来自一个片段。

```
@Override
public void onViewStateRestored(@Nullable Bundle savedInstanceState) {
    super.onViewStateRestored(savedInstanceState);
    // Restore UI state from the savedInstanceState.
    // This bundle has also been passed to onCreate.
    boolean myBoolean = savedInstanceState.getBoolean("MyBoolean");
    double myDouble = savedInstanceState.getDouble("myDouble");
    int myInt = savedInstanceState.getInt("MyInt");
    String myString = savedInstanceState.getString("MyString");
} 
```

您通常会使用这种技术来存储应用程序的实例值（选择、未保存的文本等）。

* * *

## 回答 #2

> 赞同：454
> 
> 时间：2008-09-30T05:03:44.133

仅用于保存与 Activity 的当前实例相关联的`savedInstanceState`状态，例如当前导航或选择信息，以便在 Android 销毁并重新创建 Activity 时，它可以像以前一样返回。请参阅文档[`onCreate`](http://developer.android.com/reference/android/app/Activity.html#onCreate(android.os.Bundle))和[`onSaveInstanceState`](http://developer.android.com/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle))

对于更长寿的状态，请考虑使用 SQLite 数据库、文件或首选项。请参阅[保存持久状态](http://developer.android.com/reference/android/app/Activity.html#SavingPersistentState)。

* * *

## 回答 #3

> 赞同：441
> 
> 时间：2010-05-25T23:22:51.547

请注意，根据 *[Activity 的文档](http://developer.android.com/reference/android/app/Activity.html)*，使用和**用于持久数据是*****不安全***的。`onSaveInstanceState``onRestoreInstanceState`

 **该文件指出（在“活动生命周期”部分）：

> 请注意，将持久数据保存在其中很重要`onPause()`，`onSaveInstanceState(Bundle)` 因为后者不是生命周期回调的一部分，因此不会在其文档中描述的所有情况下都被调用。

换句话说，将持久数据的保存/恢复代码放入`onPause()`和`onResume()`！

为了进一步澄清，这里是`onSaveInstanceState()`文档：

> 这个方法在一个活动可能被杀死之前被调用，这样当它在未来某个时间回来时它可以恢复它的状态。例如，如果活动 B 在活动 A 之前启动，并且在某个时刻活动 A 被杀死以回收资源，活动 A 将有机会通过此方法保存其用户界面的当前状态，以便当用户返回时对于活动 A，用户界面的状态可以通过`onCreate(Bundle)`或 恢复`onRestoreInstanceState(Bundle)`。

* * *

## 回答 #4

> 赞同：222
> 
> 时间：2010-08-27T13:54:51.297

我的同事写了一篇文章来解释 Android 设备上的应用程序状态，包括对 Activity 生命周期和状态信息、如何存储状态信息以及保存到状态`Bundle`和`SharedPreferences`. [看看这里](http://www.eigo.co.uk/Managing-State-in-an-Android-Activity.aspx)。

本文介绍了三种方法：

## 使用实例状态包存储应用程序生命周期（即临时）的局部变量/UI 控制数据

```
[Code sample – Store state in state bundle]
@Override
public void onSaveInstanceState(Bundle savedInstanceState)
{
  // Store UI state to the savedInstanceState.
  // This bundle will be passed to onCreate on next call.  EditText txtName = (EditText)findViewById(R.id.txtName);
  String strName = txtName.getText().toString();

  EditText txtEmail = (EditText)findViewById(R.id.txtEmail);
  String strEmail = txtEmail.getText().toString();

  CheckBox chkTandC = (CheckBox)findViewById(R.id.chkTandC);
  boolean blnTandC = chkTandC.isChecked();

  savedInstanceState.putString(“Name”, strName);
  savedInstanceState.putString(“Email”, strEmail);
  savedInstanceState.putBoolean(“TandC”, blnTandC);

  super.onSaveInstanceState(savedInstanceState);
} 
```

## 使用共享首选项在应用程序实例之间（即永久）存储局部变量/UI 控制数据

```
[Code sample – store state in SharedPreferences]
@Override
protected void onPause()
{
  super.onPause();

  // Store values between instances here
  SharedPreferences preferences = getPreferences(MODE_PRIVATE);
  SharedPreferences.Editor editor = preferences.edit();  // Put the values from the UI
  EditText txtName = (EditText)findViewById(R.id.txtName);
  String strName = txtName.getText().toString();

  EditText txtEmail = (EditText)findViewById(R.id.txtEmail);
  String strEmail = txtEmail.getText().toString();

  CheckBox chkTandC = (CheckBox)findViewById(R.id.chkTandC);
  boolean blnTandC = chkTandC.isChecked();

  editor.putString(“Name”, strName); // value to store
  editor.putString(“Email”, strEmail); // value to store
  editor.putBoolean(“TandC”, blnTandC); // value to store
  // Commit to storage
  editor.commit();
} 
```

## 使用保留的非配置实例在应用程序生命周期内的活动之间使对象实例在内存中保持活动状态

```
[Code sample – store object instance]
private cMyClassType moInstanceOfAClass; // Store the instance of an object
@Override
public Object onRetainNonConfigurationInstance()
{
  if (moInstanceOfAClass != null) // Check that the object exists
      return(moInstanceOfAClass);
  return super.onRetainNonConfigurationInstance();
} 
```

* * *

## 回答 #5

> 赞同：157
> 
> 时间：2012-10-19T23:47:22.343

这是 Android 开发的经典“陷阱”。这里有两个问题：

*   有一个微妙的 Android 框架错误，它使开发过程中的应用程序堆栈管理变得非常复杂，至少在旧版本上是这样（不完全确定是否/何时/如何修复它）。我将在下面讨论这个错误。
*   管理此问题的“正常”或预期方式本身相当复杂，因为 onPause/onResume 和 onSaveInstanceState/onRestoreInstanceState 的双重性

浏览所有这些线程，我怀疑开发人员大部分时间都在同时讨论这两个不同的问题......因此所有关于“这对我不起作用”的混乱和报告。

首先，澄清“预期”行为：onSaveInstance 和 onRestoreInstance 是脆弱的，仅适用于瞬态。预期用途（据我所知）是在手机旋转（方向改变）时处理活动娱乐。换句话说，预期用途是当您的 Activity 在逻辑上仍处于“顶部”时，但仍必须由系统重新实例化。保存的 Bundle 不会保留在进程/内存/ [GC](https://en.wikipedia.org/wiki/Garbage_collection_%28computer_science%29)之外，因此如果您的活动进入后台，则不能真正依赖它。是的，也许你的 Activity 的内存会在它的后台之旅中幸存下来并逃脱 GC，但这并不可靠（也不是可预测的）。

因此，如果您的应用程序的“启动”之间存在有意义的“用户进度”或状态，则指导是使用 onPause 和 onResume。您必须自己选择并准备一个持久存储。

*但是*- 有一个非常令人困惑的错误使这一切变得复杂。详情在这里：

*   *[从 Eclipse 启动应用程序时，Activity 堆栈在首次运行期间行为不正确](http://code.google.com/p/android/issues/detail?id=2373)*(#36907463)

*   *[市场/浏览器应用程序安装程序允许第二个实例关闭应用程序](https://issuetracker.google.com/issues/36911210)*(#36911210)

基本上，如果您的应用程序使用 SingleTask 标志启动，然后您从主屏幕或启动器菜单启动它，那么后续调用将创建一个新任务......您将有效地拥有应用程序的两个不同实例居住在同一个堆栈中......这很快就会变得非常奇怪。这似乎发生在您在开发期间启动应用程序时（即从[Eclipse](https://en.wikipedia.org/wiki/Eclipse_%28software%29)或[IntelliJ](https://en.wikipedia.org/wiki/IntelliJ_IDEA)），因此开发人员经常遇到这种情况。但也通过一些应用商店更新机制（因此它也会影响您的用户）。

在我意识到我的主要问题是这个错误，而不是预期的框架行为之前，我在这些线程中挣扎了几个小时。一个伟大的写作和~~解决方法~~（更新：见下文）似乎来自用户@kaciula 在这个答案中：

*[Home 按键行为](https://stackoverflow.com/questions/3042420/home-key-press-behaviour/4782423#4782423)*

**2013 年 6 月更新**：几个月后，我终于找到了“正确”的解决方案。您不需要自己管理任何有状态的startedApp 标志。您可以从框架中检测到这一点并适当地保释。我在 LauncherActivity.onCreate 的开头附近使用它：

```
if (!isTaskRoot()) {
    Intent intent = getIntent();
    String action = intent.getAction();
    if (intent.hasCategory(Intent.CATEGORY_LAUNCHER) && action != null && action.equals(Intent.ACTION_MAIN)) {
        finish();
        return;
    }
} 
```

* * *

## 回答 #6

> 赞同：100
> 
> 时间：2010-05-07T00:21:48.930

`onSaveInstanceState`当系统需要内存并终止应用程序时调用。当用户刚刚关闭应用程序时不会调用它。所以我认为应用程序状态也应该保​​存在`onPause`.

它应该保存到一些持久性存储中，例如`Preferences`SQLite。

* * *

## 回答 #7

> 赞同：79
> 
> 时间：2011-06-27T16:17:25.003

这两种方法都是有用且有效的，并且都最适合不同的场景：

1.  用户终止应用程序并在以后重新打开它，但应用程序需要从最后一个会话重新加载数据——这需要一种持久存储方法，例如使用 SQLite。
2.  用户切换应用程序，然后返回到原来的位置，并希望从他们离开的地方继续 - 保存和恢复捆绑数据（例如应用程序状态数据），`onSaveInstanceState()`通常`onRestoreInstanceState()`就足够了。

如果您以持久方式保存状态数据，则可以在`onResume()`or `onCreate()`（或实际上在任何生命周期调用中）重新加载它。这可能是也可能不是期望的行为。如果你将它存储在一个包中`InstanceState`，那么它是暂时的，只适用于存储在同一用户“会话”中使用的数据（我松散地使用术语会话），但不适用于“会话”之间。

并不是说一种方法比另一种更好，就像所有事情一样，重要的是了解您需要什么行为并选择最合适的方法。

* * *

## 回答 #8

> 赞同：78
> 
> 时间：2011-06-23T17:07:53.047

就我而言，保存状态充其量只是一个kludge。如果您需要保存持久数据，只需使用[SQLite](http://en.wikipedia.org/wiki/SQLite)数据库。Android 让它变得如此***简单***。

像这样的东西：

```
import java.util.Date;
import android.content.Context;
import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import android.database.sqlite.SQLiteOpenHelper;

public class dataHelper {

    private static final String DATABASE_NAME = "autoMate.db";
    private static final int DATABASE_VERSION = 1;

    private Context context;
    private SQLiteDatabase db;
    private OpenHelper oh ;

    public dataHelper(Context context) {
        this.context = context;
        this.oh = new OpenHelper(this.context);
        this.db = oh.getWritableDatabase();
    }

    public void close() {
        db.close();
        oh.close();
        db = null;
        oh = null;
        SQLiteDatabase.releaseMemory();
    }

    public void setCode(String codeName, Object codeValue, String codeDataType) {
        Cursor codeRow = db.rawQuery("SELECT * FROM code WHERE codeName = '"+  codeName + "'", null);
        String cv = "" ;

        if (codeDataType.toLowerCase().trim().equals("long") == true){
            cv = String.valueOf(codeValue);
        }
        else if (codeDataType.toLowerCase().trim().equals("int") == true)
        {
            cv = String.valueOf(codeValue);
        }
        else if (codeDataType.toLowerCase().trim().equals("date") == true)
        {
            cv = String.valueOf(((Date)codeValue).getTime());
        }
        else if (codeDataType.toLowerCase().trim().equals("boolean") == true)
        {
            String.valueOf(codeValue);
        }
        else
        {
            cv = String.valueOf(codeValue);
        }

        if(codeRow.getCount() > 0) //exists-- update
        {
            db.execSQL("update code set codeValue = '" + cv +
                "' where codeName = '" + codeName + "'");
        }
        else // does not exist, insert
        {
            db.execSQL("INSERT INTO code (codeName, codeValue, codeDataType) VALUES(" +
                    "'" + codeName + "'," +
                    "'" + cv + "'," +
                    "'" + codeDataType + "')" );
        }
    }

    public Object getCode(String codeName, Object defaultValue){

        //Check to see if it already exists
        String codeValue = "";
        String codeDataType = "";
        boolean found = false;
        Cursor codeRow  = db.rawQuery("SELECT * FROM code WHERE codeName = '"+  codeName + "'", null);
        if (codeRow.moveToFirst())
        {
            codeValue = codeRow.getString(codeRow.getColumnIndex("codeValue"));
            codeDataType = codeRow.getString(codeRow.getColumnIndex("codeDataType"));
            found = true;
        }

        if (found == false)
        {
            return defaultValue;
        }
        else if (codeDataType.toLowerCase().trim().equals("long") == true)
        {
            if (codeValue.equals("") == true)
            {
                return (long)0;
            }
            return Long.parseLong(codeValue);
        }
        else if (codeDataType.toLowerCase().trim().equals("int") == true)
        {
            if (codeValue.equals("") == true)
            {
                return (int)0;
            }
            return Integer.parseInt(codeValue);
        }
        else if (codeDataType.toLowerCase().trim().equals("date") == true)
        {
            if (codeValue.equals("") == true)
            {
                return null;
            }
            return new Date(Long.parseLong(codeValue));
        }
        else if (codeDataType.toLowerCase().trim().equals("boolean") == true)
        {
            if (codeValue.equals("") == true)
            {
                return false;
            }
            return Boolean.parseBoolean(codeValue);
        }
        else
        {
            return (String)codeValue;
        }
    }

    private static class OpenHelper extends SQLiteOpenHelper {

        OpenHelper(Context context) {
            super(context, DATABASE_NAME, null, DATABASE_VERSION);
        }

        @Override
        public void onCreate(SQLiteDatabase db) {
            db.execSQL("CREATE TABLE IF  NOT EXISTS code" +
            "(id INTEGER PRIMARY KEY, codeName TEXT, codeValue TEXT, codeDataType TEXT)");
        }

        @Override
        public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {
        }
    }
} 
```

之后一个简单的调用

```
dataHelper dh = new dataHelper(getBaseContext());
String status = (String) dh.getCode("appState", "safetyDisabled");
Date serviceStart = (Date) dh.getCode("serviceStartTime", null);
dh.close();
dh = null; 
```

* * *

## 回答 #9

> 赞同：66
> 
> 时间：2012-02-05T11:35:19.087

我想我找到了答案。让我用简单的话告诉我我做了什么：

假设我有两个活动，活动 1 和活动 2，我正在从活动 1 导航到活动 2（我在活动 2 中做了一些工作），然后通过单击活动 1 中的按钮再次返回活动 1。现在在这个阶段，我想回到活动 2，我想看到我的活动 2 与我上次离开活动 2 时的状态相同。

对于上述情况，我所做的是在清单中我进行了一些更改，如下所示：

```
<activity android:name=".activity2"
          android:alwaysRetainTaskState="true"      
          android:launchMode="singleInstance">
</activity> 
```

在按钮单击事件的activity1中，我这样做了：

```
Intent intent = new Intent();
intent.setFlags(Intent.FLAG_ACTIVITY_REORDER_TO_FRONT);
intent.setClassName(this,"com.mainscreen.activity2");
startActivity(intent); 
```

在按钮点击事件的activity2中，我做了这样的事情：

```
Intent intent=new Intent();
intent.setClassName(this,"com.mainscreen.activity1");
startActivity(intent); 
```

现在会发生的是，无论我们在activity2中所做的任何更改都不会丢失，并且我们可以查看activity2的状态，就像我们之前离开时一样。

我相信这就是答案，这对我来说很好。如果我错了，请纠正我。

* * *

## 回答 #10

> 赞同：51
> 
> 时间：2012-01-17T18:28:40.513

`onSaveInstanceState()`对于瞬态数据（在`onCreate()`/中恢复`onRestoreInstanceState()`），`onPause()`对于持久数据（在 中恢复`onResume()`）。来自Android技术资源：

> **如果 Activity 正在停止并且可能在它恢复之前被杀死，Android 会调用**onSaveInstanceState() ！**这意味着它应该存储在重新启动 Activity 时重新初始化到相同条件所需的任何状态。它是 onCreate() 方法的对应物，实际上传递给 onCreate() 的 savedInstanceState Bundle 与您在 onSaveInstanceState() 方法中构造为 outState 的 Bundle 相同。**
> 
>  ****onPause()**和**onResume()**也是互补的方法。onPause() 总是在 Activity 结束时被调用，即使是我们发起的（例如使用 finish() 调用）。我们将使用它来将当前笔记保存回数据库。好的做法是释放任何可以在 onPause() 期间释放的资源，以便在处于被动状态时占用更少的资源。**

 *** * *

## 回答 #11

> 赞同：46
> 
> 时间：2010-05-23T22:32:44.110

真正`onSaveInstanceState()`在 Activity 进入后台时被调用。

来自文档的引用：“这个方法在一个活动可能被杀死之前被调用，这样当它在未来某个时间回来时它可以恢复它的状态。” [来源](https://developer.android.com/reference/android/app/Activity.html#onSaveInstanceState(android.os.Bundle))

* * *

## 回答 #12

> 赞同：41
> 
> 时间：2012-03-31T13:36:59.767

同时我一般不再使用

```
Bundle savedInstanceState & Co 
```

对于大多数活动来说，生命周期过于复杂且没有必要。

谷歌自称，它甚至不可靠。

我的方法是立即在首选项中保存任何更改：

```
 SharedPreferences p;
 p.edit().put(..).commit() 
```

在某些方面，SharedPreferences 的工作方式与 Bundle 类似。当然，首先必须从偏好中读取这些值。

在复杂数据的情况下，您可以使用 SQLite 而不是使用首选项。

应用此概念时，活动将继续使用上次保存的状态，无论它是初始打开并在其间重新启动，还是由于返回堆栈而重新打开。

* * *

## 回答 #13

> 赞同：41
> 
> 时间：2015-08-20T02:04:11.063

为了帮助减少样板文件，我使用以下内容`interface`并`class`读取/写入 a`Bundle`以保存实例状态。

* * *

首先，创建一个用于注释实例变量的接口：

```
import java.lang.annotation.Documented;
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

@Documented
@Retention(RetentionPolicy.RUNTIME)
@Target({
        ElementType.FIELD
})
public @interface SaveInstance {

} 
```

然后，创建一个类，其中将使用反射将值保存到包中：

```
import android.app.Activity;
import android.app.Fragment;
import android.os.Bundle;
import android.os.Parcelable;
import android.util.Log;

import java.io.Serializable;
import java.lang.reflect.Field;

/**
 * Save and load fields to/from a {@link Bundle}. All fields should be annotated with {@link
 * SaveInstance}.</p>
 */
public class Icicle {

    private static final String TAG = "Icicle";

    /**
     * Find all fields with the {@link SaveInstance} annotation and add them to the {@link Bundle}.
     *
     * @param outState
     *         The bundle from {@link Activity#onSaveInstanceState(Bundle)} or {@link
     *         Fragment#onSaveInstanceState(Bundle)}
     * @param classInstance
     *         The object to access the fields which have the {@link SaveInstance} annotation.
     * @see #load(Bundle, Object)
     */
    public static void save(Bundle outState, Object classInstance) {
        save(outState, classInstance, classInstance.getClass());
    }

    /**
     * Find all fields with the {@link SaveInstance} annotation and add them to the {@link Bundle}.
     *
     * @param outState
     *         The bundle from {@link Activity#onSaveInstanceState(Bundle)} or {@link
     *         Fragment#onSaveInstanceState(Bundle)}
     * @param classInstance
     *         The object to access the fields which have the {@link SaveInstance} annotation.
     * @param baseClass
     *         Base class, used to get all superclasses of the instance.
     * @see #load(Bundle, Object, Class)
     */
    public static void save(Bundle outState, Object classInstance, Class<?> baseClass) {
        if (outState == null) {
            return;
        }
        Class<?> clazz = classInstance.getClass();
        while (baseClass.isAssignableFrom(clazz)) {
            String className = clazz.getName();
            for (Field field : clazz.getDeclaredFields()) {
                if (field.isAnnotationPresent(SaveInstance.class)) {
                    field.setAccessible(true);
                    String key = className + "#" + field.getName();
                    try {
                        Object value = field.get(classInstance);
                        if (value instanceof Parcelable) {
                            outState.putParcelable(key, (Parcelable) value);
                        } else if (value instanceof Serializable) {
                            outState.putSerializable(key, (Serializable) value);
                        }
                    } catch (Throwable t) {
                        Log.d(TAG, "The field '" + key + "' was not added to the bundle");
                    }
                }
            }
            clazz = clazz.getSuperclass();
        }
    }

    /**
     * Load all saved fields that have the {@link SaveInstance} annotation.
     *
     * @param savedInstanceState
     *         The saved-instance {@link Bundle} from an {@link Activity} or {@link Fragment}.
     * @param classInstance
     *         The object to access the fields which have the {@link SaveInstance} annotation.
     * @see #save(Bundle, Object)
     */
    public static void load(Bundle savedInstanceState, Object classInstance) {
        load(savedInstanceState, classInstance, classInstance.getClass());
    }

    /**
     * Load all saved fields that have the {@link SaveInstance} annotation.
     *
     * @param savedInstanceState
     *         The saved-instance {@link Bundle} from an {@link Activity} or {@link Fragment}.
     * @param classInstance
     *         The object to access the fields which have the {@link SaveInstance} annotation.
     * @param baseClass
     *         Base class, used to get all superclasses of the instance.
     * @see #save(Bundle, Object, Class)
     */
    public static void load(Bundle savedInstanceState, Object classInstance, Class<?> baseClass) {
        if (savedInstanceState == null) {
            return;
        }
        Class<?> clazz = classInstance.getClass();
        while (baseClass.isAssignableFrom(clazz)) {
            String className = clazz.getName();
            for (Field field : clazz.getDeclaredFields()) {
                if (field.isAnnotationPresent(SaveInstance.class)) {
                    String key = className + "#" + field.getName();
                    field.setAccessible(true);
                    try {
                        Object fieldVal = savedInstanceState.get(key);
                        if (fieldVal != null) {
                            field.set(classInstance, fieldVal);
                        }
                    } catch (Throwable t) {
                        Log.d(TAG, "The field '" + key + "' was not retrieved from the bundle");
                    }
                }
            }
            clazz = clazz.getSuperclass();
        }
    }

} 
```

* * *

## 示例用法：

```
public class MainActivity extends Activity {

    @SaveInstance
    private String foo;

    @SaveInstance
    private int bar;

    @SaveInstance
    private Intent baz;

    @SaveInstance
    private boolean qux;

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        Icicle.load(savedInstanceState, this);
    }

    @Override
    public void onSaveInstanceState(Bundle outState) {
        super.onSaveInstanceState(outState);
        Icicle.save(outState, this);
    }

} 
```

* * *

**注意：**此代码改编自一个名为[AndroidAutowire的库项目，该项目在](https://github.com/CardinalNow/AndroidAutowire)[MIT](https://raw.githubusercontent.com/CardinalNow/AndroidAutowire/master/LICENSE)许可下获得许可。

* * *

## 回答 #14

> 赞同：35
> 
> 时间：2015-01-21T02:19:16.443

直接回答原问题。savedInstancestate 为空，因为您的 Activity 永远不会被重新创建。

只有在以下情况下，您的 Activity 才会使用状态包重新创建：

*   配置更改，例如更改方向或电话语言，这可能需要创建新的活动实例。
*   操作系统销毁活动后，您从后台返回应用程序。

Android 将在内存压力下或在后台长时间处于后台后销毁后台活动。

在测试你的 hello world 示例时，有几种方法可以离开和返回 Activity。

*   当您按下后退按钮时，活动完成。重新启动应用程序是一个全新的实例。你根本没有从后台恢复。
*   当您按下主页按钮或使用任务切换器时，Activity 将进入后台。当导航回应用程序时，只有在必须销毁 Activity 时才会调用 onCreate。

在大多数情况下，如果您只是按下主页然后再次启动应用程序，则不需要重新创建活动。它已经存在于内存中，因此不会调用 onCreate()。

设置 -> 开发人员选项下有一个名为“不保留活动”的选项。启用后，Android 将始终销毁活动并在后台运行时重新创建它们。这是在开发时保持启用状态的绝佳选择，因为它模拟了最坏的情况。（低内存设备一直在回收您的活动）。

其他答案很有价值，因为它们教您存储状态的正确方法，但我觉得他们并没有真正回答为什么您的代码没有按您预期的方式工作。

* * *

## 回答 #15

> 赞同：32
> 
> 时间：2012-09-05T08:27:49.410

`onSaveInstanceState(bundle)`和`onRestoreInstanceState(bundle)`方法仅在旋转屏幕（方向改变）时对数据持久性很有用。
在应用程序之间切换时它们甚至都不好（因为该方法`onSaveInstanceState()`被调用但没有再次调用。 为了获得更多持久性，请使用共享首选项。[阅读本文](http://www.eigo.co.uk/Managing-State-in-an-Android-Activity.aspx)`onCreate(bundle)``onRestoreInstanceState(bundle)`

* * *

## 回答 #16

> 赞同：23
> 
> 时间：2014-04-16T17:11:47.937

我的问题是我只需要在应用程序生命周期内保持持久性（即一次执行，包括在同一个应用程序中启动其他子活动和旋转设备等）。我尝试了上述答案的各种组合，但在所有情况下都没有得到我想要的。最后，对我有用的是在 onCreate 期间获得对 savedInstanceState 的引用：

```
mySavedInstanceState=savedInstanceState; 
```

并在我需要时使用它来获取我的变量的内容，如下所示：

```
if (mySavedInstanceState !=null) {
   boolean myVariable = mySavedInstanceState.getBoolean("MyVariable");
} 
```

我使用`onSaveInstanceState`and`onRestoreInstanceState`如上所述，但我想我也可以或替代地使用我的方法在变量更改时保存变量（例如使用`putBoolean`）

* * *

## 回答 #17

> 赞同：21
> 
> 时间：2016-01-26T03:07:39.650

尽管公认的答案是正确的，但有一种更快、更简单的方法可以使用名为[Icepick](https://github.com/frankiesardo/icepick)的库在 Android 上保存 Activity 状态。Icepick 是一个注释处理器，它负责为您保存和恢复状态所使用的所有样板代码。

用 Icepick 做这样的事情：

```
class MainActivity extends Activity {
  @State String username; // These will be automatically saved and restored
  @State String password;
  @State int age;

  @Override public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    Icepick.restoreInstanceState(this, savedInstanceState);
  }

  @Override public void onSaveInstanceState(Bundle outState) {
    super.onSaveInstanceState(outState);
    Icepick.saveInstanceState(this, outState);
  }
} 
```

和这样做是一样的：

```
class MainActivity extends Activity {
  String username;
  String password;
  int age;

  @Override
  public void onSaveInstanceState(Bundle savedInstanceState) {
    super.onSaveInstanceState(savedInstanceState);
    savedInstanceState.putString("MyString", username);
    savedInstanceState.putString("MyPassword", password);
    savedInstanceState.putInt("MyAge", age); 
    /* remember you would need to actually initialize these variables before putting it in the
    Bundle */
  }

  @Override
  public void onRestoreInstanceState(Bundle savedInstanceState) {
    super.onRestoreInstanceState(savedInstanceState);
    username = savedInstanceState.getString("MyString");
    password = savedInstanceState.getString("MyPassword");
    age = savedInstanceState.getInt("MyAge");
  }
} 
```

Icepick 将适用于任何使用`Bundle`.

* * *

## 回答 #18

> 赞同：18
> 
> 时间：2017-01-23T10:29:47.133

当一个活动被创建时，它的 onCreate() 方法被调用。

```
 @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
    } 
```

savedInstanceState 是 Bundle 类的一个对象，它第一次为 null，但它在重新创建时包含值。要保存 Activity 的状态，您必须重写 onSaveInstanceState()。

```
 @Override
    protected void onSaveInstanceState(Bundle outState) {
      outState.putString("key","Welcome Back")
        super.onSaveInstanceState(outState);       //save state
    } 
```

将您的值放入“outState”Bundle 对象中，例如 outState.putString("key","Welcome Back") 并通过调用 super 保存。当活动将被销毁时，它的状态会保存在 Bundle 对象中，并且可以在 onCreate() 或 onRestoreInstanceState() 重新创建后恢复。在 onCreate() 和 onRestoreInstanceState() 中收到的 Bundle 是相同的。

```
 @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

          //restore activity's state
         if(savedInstanceState!=null){
          String reStoredString=savedInstanceState.getString("key");
            }
    } 
```

或者

```
 //restores activity's saved state
 @Override
    protected void onRestoreInstanceState(Bundle savedInstanceState) {
      String restoredMessage=savedInstanceState.getString("key");
    } 
```

* * *

## 回答 #19

> 赞同：16
> 
> 时间：2015-12-18T11:43:52.537

基本上有两种方法可以实现此更改。

1.  使用`onSaveInstanceState()`和`onRestoreInstanceState()`。
2.  在清单`android:configChanges="orientation|screenSize"`中。

我真的不建议使用第二种方法。因为根据我的经验，当从纵向旋转到横向时，它会导致一半的设备屏幕变黑，反之亦然。

使用上面提到的第一种方法，我们可以在方向更改或任何配置更改发生时持久化数据。我知道一种可以将任何类型的数据存储在 savedInstance 状态对象中的方法。

*示例：如果要持久化 Json 对象，请考虑一个案例。创建一个带有 getter 和 setter 的模型类。*

```
class MyModel extends Serializable{
JSONObject obj;

setJsonObject(JsonObject obj)
{
this.obj=obj;
}

JSONObject getJsonObject()
return this.obj;
} 
} 
```

*现在在 onCreate 和 onSaveInstanceState 方法的活动中执行以下操作。它看起来像这样：*

```
@override
onCreate(Bundle savedInstaceState){
MyModel data= (MyModel)savedInstaceState.getSerializable("yourkey")
JSONObject obj=data.getJsonObject();
//Here you have retained JSONObject and can use.
}

@Override
protected void onSaveInstanceState(Bundle outState) {
super.onSaveInstanceState(outState);
//Obj is some json object 
MyModel dataToSave= new MyModel();
dataToSave.setJsonObject(obj);
oustate.putSerializable("yourkey",dataToSave); 

} 
```

* * *

## 回答 #20

> 赞同：12
> 
> 时间：2017-02-07T15:56:41.803

这是来自**Steve Moseley**的回答（由**ToolmakerSteve 撰写**）的评论，将事情放在了正确的位置（在整个 onSaveInstanceState 与 onPause，东部成本与西部成本传奇中）

> @VVK - 我部分不同意。退出应用程序的某些方式不会触发 onSaveInstanceState (oSIS)。这限制了 oSIS 的实用性。对于最少的操作系统资源，它值得支持，但是如果一个应用程序想要将用户返回到他们所处的状态，那么无论应用程序是如何退出的，都需要使用持久存储方法来代替。 **我使用 onCreate 检查捆绑包，如果丢失，则检查** **持久存储。**这集中了决策制定。我可以从崩溃中恢复，或者返回按钮退出或自定义菜单项退出，或者在很多天后回到用户所在的屏幕。– ToolmakerSteve 2015 年 9 月 19 日在 10:38

* * *

## 回答 #21

> 赞同：12
> 
> 时间：2018-02-12T19:42:32.367

科特林代码：

节省：

```
override fun onSaveInstanceState(outState: Bundle) {
    super.onSaveInstanceState(outState.apply {
        putInt("intKey", 1)
        putString("stringKey", "String Value")
        putParcelable("parcelableKey", parcelableObject)
    })
} 
```

然后在`onCreate()`或`onRestoreInstanceState()`

```
 val restoredInt = savedInstanceState?.getInt("intKey") ?: 1 //default int
    val restoredString = savedInstanceState?.getString("stringKey") ?: "default string"
    val restoredParcelable = savedInstanceState?.getParcelable<ParcelableClass>("parcelableKey") ?: ParcelableClass() //default parcelable 
```

如果您不想拥有 Optionals，请添加默认值

* * *

## 回答 #22

> 赞同：10
> 
> 时间：2016-09-28T11:46:11.060

要获取存储在 中的活动状态数据`onCreate()`，首先您必须通过覆盖`SaveInstanceState(Bundle savedInstanceState)`方法将数据保存在 savedInstanceState 中。

当调用活动销毁`SaveInstanceState(Bundle savedInstanceState)`方法并在那里保存要保存的数据时。当活动重新启动时，您会得到相同的`onCreate()`结果。（savedInstanceState 不会为空，因为您在活动被破坏之前已经在其中保存了一些数据）

* * *

## 回答 #23

> 赞同：9
> 
> 时间：2019-06-01T07:05:38.573

# 科特林

您必须覆盖`onSaveInstanceState`并`onRestoreInstanceState`存储和检索您想要持久的变量

### 生命周期图

![](https://i.stack.imgur.com/Ts2F1.png)

### 存储变量

```
public override fun onSaveInstanceState(savedInstanceState: Bundle) {
    super.onSaveInstanceState(savedInstanceState)

    // prepare variables here
    savedInstanceState.putInt("kInt", 10)
    savedInstanceState.putBoolean("kBool", true)
    savedInstanceState.putDouble("kDouble", 4.5)
    savedInstanceState.putString("kString", "Hello Kotlin")
} 
```

### 检索变量

```
public override fun onRestoreInstanceState(savedInstanceState: Bundle) {
    super.onRestoreInstanceState(savedInstanceState)

    val myInt = savedInstanceState.getInt("kInt")
    val myBoolean = savedInstanceState.getBoolean("kBool")
    val myDouble = savedInstanceState.getDouble("kDouble")
    val myString = savedInstanceState.getString("kString")
    // use variables here
} 
```

* * *

## 回答 #24

> 赞同：8
> 
> 时间：2016-08-09T12:57:37.613

不确定我的解决方案是否不受欢迎，但我使用绑定服务来保持 ViewModel 状态。是否将其存储在服务的内存中或持久化并从 SQLite 数据库中检索它取决于您的要求。这就是任何风格的服务所做的，它们提供诸如维护应用程序状态和抽象通用业务逻辑之类的服务。

由于移动设备固有的内存和处理限制，我以与网页类似的方式处理 Android 视图。页面不维护状态，它纯粹是一个表示层组件，其唯一目的是呈现应用程序状态并接受用户输入。Web 应用程序架构的最新趋势采用了古老的模型、视图、控制器 (MVC) 模式，其中页面是视图，域数据是模型，控制器位于 Web 服务后面。相同的模式可以在 Android 中使用，View 是，嗯...... View，模型是您的域数据，而 Controller 是作为 Android 绑定服务实现的。每当您希望视图与控制器交互时，请在启动/恢复时绑定到它，并在停止/暂停时取消绑定。

这种方法为您提供了执行关注点分离设计原则的额外好处，因为您所有的应用程序业务逻辑都可以移动到您的服务中，这减少了跨多个视图的重复逻辑并允许视图执行另一个重要的设计原则，即单一职责。

* * *

## 回答 #25

> 赞同：7
> 
> 时间：2016-08-08T02:07:19.273

简单快速地解决这个问题是使用[IcePick](https://github.com/frankiesardo/icepick)

首先，在`app/build.gradle`

```
repositories {
  maven {url "https://clojars.org/repo/"}
}
dependencies {
  compile 'frankiesardo:icepick:3.2.0'
  provided 'frankiesardo:icepick-processor:3.2.0'
} 
```

现在，让我们看看下面这个例子如何在 Activity 中保存状态

```
public class ExampleActivity extends Activity {
  @State String username; // This will be automatically saved and restored

  @Override public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    Icepick.restoreInstanceState(this, savedInstanceState);
  }

  @Override public void onSaveInstanceState(Bundle outState) {
    super.onSaveInstanceState(outState);
    Icepick.saveInstanceState(this, outState);
  }
} 
```

它适用于活动、片段或任何需要在 Bundle 上序列化其状态的对象（例如迫击炮的 ViewPresenters）

Icepick 还可以为自定义 Views 生成实例状态码：

```
class CustomView extends View {
  @State int selectedPosition; // This will be automatically saved and restored

  @Override public Parcelable onSaveInstanceState() {
    return Icepick.saveInstanceState(this, super.onSaveInstanceState());
  }

  @Override public void onRestoreInstanceState(Parcelable state) {
    super.onRestoreInstanceState(Icepick.restoreInstanceState(this, state));
  }

  // You can put the calls to Icepick into a BaseCustomView and inherit from it
  // All Views extending this CustomView automatically have state saved/restored
} 
```

* * *

## 回答 #26

> 赞同：5
> 
> 时间：2018-08-27T11:51:27.283

现在 Android 提供了[ViewModels](https://developer.android.com/topic/libraries/architecture/saving-states)来保存状态，你应该尝试使用它而不是 saveInstanceState。

* * *

## 回答 #27

> 赞同：4
> 
> 时间：2019-10-21T11:32:27.290

有一种方法可以让 Android 在不实现任何方法的情况下保存状态。只需将此行添加到您的 Manifest in Activity 声明中：

```
android:configChanges="orientation|screenSize" 
```

它应该如下所示：

```
<activity
    android:name=".activities.MyActivity"
    android:configChanges="orientation|screenSize">
</activity> 
```

[在这里](https://developer.android.com/guide/topics/resources/runtime-changes)您可以找到有关此房产的更多信息。

建议让 Android 为您处理，而不是手动处理。

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2019-01-10T08:48:45.570

## 什么该保存，什么不该保存？

有没有想过为什么在`EditText`方向改变时会自动保存文本中的文本？好吧，这个答案是给你的。

当 Activity 的一个实例被销毁并且系统重新创建一个新实例时（例如，配置更改）。它尝试使用一组保存的旧活动状态（**实例状态**）数据重新创建它。

实例状态是存储在对象中的**键值**对的集合。`Bundle`

> 例如，默认情况下系统将视图对象保存在 Bundle 中。

*   文本输入`EditText`
*   在 a 中滚动位置`ListView`等。

如果您需要将另一个变量保存为实例状态的一部分，您应该使用**OVERRIDE** `onSavedInstanceState(Bundle savedinstaneState)`方法。

例如，`int currentScore`在 GameActivity

### 保存数据时有关 onSavedInstanceState(Bundle savedinstaneState) 的更多详细信息

```
@Override
public void onSaveInstanceState(Bundle savedInstanceState) {
    // Save the user's current game state
    savedInstanceState.putInt(STATE_SCORE, mCurrentScore);

    // Always call the superclass so it can save the view hierarchy state
    super.onSaveInstanceState(savedInstanceState);
} 
```

> 因此，如果您忘记调用 `super.onSaveInstanceState(savedInstanceState);`默认行为，则错误地将不起作用，即 EditText 中的文本将无法保存。

### 选择哪个来恢复 Activity 状态？

```
 onCreate(Bundle savedInstanceState) 
```

*或者*

```
onRestoreInstanceState(Bundle savedInstanceState) 
```

两种方法都获得相同的 Bundle 对象，因此在哪里编写恢复逻辑并不重要。唯一的区别是，在`onCreate(Bundle savedInstanceState)`方法中，您必须进行空检查，而在后一种情况下则不需要。其他答案已经有代码片段。你可以参考他们。

### 有关 onRestoreInstanceState(Bundle savedinstaneState) 的更多详细信息

```
@Override
public void onRestoreInstanceState(Bundle savedInstanceState) {
    // Always call the superclass so it can restore the view hierarchy
    super.onRestoreInstanceState(savedInstanceState);

    // Restore state members from the saved instance
    mCurrentScore = savedInstanceState.getInt(STATE_SCORE);
} 
```

> 始终调用`super.onRestoreInstanceState(savedInstanceState);`，以便系统默认恢复视图层次结构

## 奖金

只有当`onSaveInstanceState(Bundle savedInstanceState)`用户打算返回 Activity 时，系统才会调用它。例如，您正在使用 App X，突然接到一个电话。您移动到调用者应用程序并返回到应用程序 X。在这种情况下，`onSaveInstanceState(Bundle savedInstanceState)`将调用该方法。

但是如果用户按下后退按钮，请考虑这一点。假设用户不打算回到 Activity，因此在这种情况下`onSaveInstanceState(Bundle savedInstanceState)`不会被系统调用。要点是您在保存数据时应该考虑所有情况。

# 相关链接：

[默认行为演示](https://github.com/rohitksingh/My_Android_Garage/blob/master/Activity%20Related%20Stuff/app/src/main/java/rohitksingh/com/activityrelatedstuff/FirstActivity.java)
[Android 官方文档](https://developer.android.com/guide/components/activities/activity-lifecycle#saras)。

* * *

## 回答 #29

> 赞同：3
> 
> 时间：2021-01-04T09:33:41.987

使用 Android ViewModel & SavedStateHandle 来持久化可序列化的数据

```
public class MainActivity extends AppCompatActivity {
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        ActivityMainBinding binding = ActivityMainBinding.inflate(getLayoutInflater());
        binding.setViewModel(new ViewModelProvider(this).get(ViewModel.class));
        binding.setLifecycleOwner(this);
        setContentView(binding.getRoot());
    }

    public static class ViewModel extends AndroidViewModel {

        //This field SURVIVE the background process reclaim/killing & the configuration change
        public final SavedStateHandle savedStateHandle;

        //This field NOT SURVIVE the background process reclaim/killing but SURVIVE the configuration change
        public final MutableLiveData<String> inputText2 = new MutableLiveData<>();

        public ViewModel(@NonNull Application application, SavedStateHandle savedStateHandle) {
            super(application);
            this.savedStateHandle = savedStateHandle;
        }
    }
} 
```

在布局文件中

```
<?xml version="1.0" encoding="utf-8"?>
<layout xmlns:android="http://schemas.android.com/apk/res/android">

    <data>

        <variable
            name="viewModel"
            type="com.xxx.viewmodelsavedstatetest.MainActivity.ViewModel" />
    </data>

    <LinearLayout xmlns:tools="http://schemas.android.com/tools"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:orientation="vertical"
        tools:context=".MainActivity">

        <EditText
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:autofillHints=""
            android:hint="This field SURVIVE the background process reclaim/killing &amp; the configuration change"
            android:text='@={(String)viewModel.savedStateHandle.getLiveData("activity_main/inputText", "")}' />

        <SeekBar
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:max="100"
            android:progress='@={(Integer)viewModel.savedStateHandle.getLiveData("activity_main/progress", 50)}' />

        <EditText
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:hint="This field SURVIVE the background process reclaim/killing &amp; the configuration change"
            android:text='@={(String)viewModel.savedStateHandle.getLiveData("activity_main/inputText", "")}' />

        <SeekBar
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:max="100"
            android:progress='@={(Integer)viewModel.savedStateHandle.getLiveData("activity_main/progress", 50)}' />

        <EditText
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:hint="This field NOT SURVIVE the background process reclaim/killing but SURVIVE the configuration change"
            android:text='@={viewModel.inputText2}' />

    </LinearLayout>
</layout> 
```

测试：

```
1\. start the test activity
2\. press home key to go home
3\. adb shell kill <the test activity process>
4\. open recent app list and restart the test activity 
```

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2019-09-20T16:56:04.457

您可以使用`Live Data`and `View Model`For L `ifecycle Handel`From `JetPack`。看到这个参考：

[https://developer.android.com/topic/libraries/architecture/livedata](https://developer.android.com/topic/libraries/architecture/livedata)

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2019-10-09T12:17:05.563

取而代之的是，您应该使用 ViewModel，它将保留数据直到活动生命周期。

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2019-12-10T07:45:56.397

现在在视图模型中做 2 种方式是有意义的。如果要将第一个保存为已保存的实例：您可以像这样在视图模型中添加状态参数 [https://developer.android.com/topic/libraries/architecture/viewmodel-savedstate#java](https://developer.android.com/topic/libraries/architecture/viewmodel-savedstate#java)

或者您可以在视图模型中保存变量或对象，在这种情况下，视图模型将保持生命周期，直到活动被销毁。

```
public class HelloAndroidViewModel extends ViewModel {
   public Booelan firstInit = false;

    public HelloAndroidViewModel() {
        firstInit = false;
    }
    ...
}

public class HelloAndroid extends Activity {

  private TextView mTextView = null;
  HelloAndroidViewModel viewModel = ViewModelProviders.of(this).get(HelloAndroidViewModel.class);
  /** Called when the activity is first created. */
  @Override
  public void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);

    mTextView = new TextView(this);

    //Because even if the state is deleted, the data in the viewmodel will be kept because the activity does not destroy
    if(!viewModel.firstInit){
        viewModel.firstInit = true
        mTextView.setText("Welcome to HelloAndroid!");
    }else{
       mTextView.setText("Welcome back.");
    }

    setContentView(mTextView);
  }
} 
```

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2020-06-14T06:00:40.667

**Kotlin 解决方案：** 对于自定义类保存，`onSaveInstanceState`您可以将类转换为`JSON`字符串并通过`Gson`转换将其恢复，对于单`String, Double, Int, Long`值保存和恢复，如下所示。以下示例适用于`Fragment`和`Activity`：

**对于活动：**

对于将数据放入`saveInstanceState`：

```
override fun onSaveInstanceState(outState: Bundle) {
        super.onSaveInstanceState(outState)

        //for custom class-----
        val gson = Gson()
        val json = gson.toJson(your_custom_class)
        outState.putString("CUSTOM_CLASS", json)

        //for single value------
        outState.putString("MyString", stringValue)
        outState.putBoolean("MyBoolean", true)
        outState.putDouble("myDouble", doubleValue)
        outState.putInt("MyInt", intValue)
    } 
```

恢复数据：

```
 override fun onRestoreInstanceState(savedInstanceState: Bundle) {
    super.onRestoreInstanceState(savedInstanceState)

    //for custom class restore
    val json = savedInstanceState?.getString("CUSTOM_CLASS")
    if (!json!!.isEmpty()) {
        val gson = Gson()
        testBundle = gson.fromJson(json, Session::class.java)
    }

  //for single value restore

   val myBoolean: Boolean = savedInstanceState?.getBoolean("MyBoolean")
   val myDouble: Double = savedInstanceState?.getDouble("myDouble")
   val myInt: Int = savedInstanceState?.getInt("MyInt")
   val myString: String = savedInstanceState?.getString("MyString")
 } 
```

您也可以在 Activity 上恢复它`onCreate`。

**对于片段：**

对于放入类`saveInstanceState`：

```
 override fun onSaveInstanceState(outState: Bundle) {
        super.onSaveInstanceState(outState)
        val gson = Gson()
        val json = gson.toJson(customClass)
        outState.putString("CUSTOM_CLASS", json)
    } 
```

恢复数据：

```
 override fun onActivityCreated(savedInstanceState: Bundle?) {
        super.onActivityCreated(savedInstanceState)

        //for custom class restore
        if (savedInstanceState != null) {
            val json = savedInstanceState.getString("CUSTOM_CLASS")
            if (!json!!.isEmpty()) {
                val gson = Gson()
                val customClass: CustomClass = gson.fromJson(json, CustomClass::class.java)
            }
        }

      // for single value restore
      val myBoolean: Boolean = savedInstanceState.getBoolean("MyBoolean")
      val myDouble: Double = savedInstanceState.getDouble("myDouble")
      val myInt: Int = savedInstanceState.getInt("MyInt")
      val myString: String = savedInstanceState.getString("MyString")
    } 
```

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2020-10-31T08:19:16.673

2020年我们有一些变化：

如果您希望`Activity`在进程被终止并重新启动后恢复其状态，您可能需要使用“已保存状态”功能。以前，您需要覆盖`Activity`:`onSaveInstanceState`和`onRestoreInstanceState`. 您还可以在`onCreate`方法中访问恢复的状态。同样，在 中`Fragment`，您有`onSaveInstanceState`可用的方法（并且恢复的状态在 、 和 方法中`onCreate`可用`onCreateView`）`onActivityCreated`。

从[AndroidX SavedState 1.0.0](https://developer.android.com/jetpack/androidx/releases/savedstate)开始，它是[AndroidX Activity](https://developer.android.com/jetpack/androidx/releases/activity)和[AndroidX Fragment](https://developer.android.com/jetpack/androidx/releases/fragment)的依赖项，您可以访问`SavedStateRegistry`. 您可以`SavedStateRegistry`从 Activity/Fragment 获取，然后注册您的`SavedStateProvider`：

```
class MyActivity : AppCompatActivity() {

  companion object {
    private const val MY_SAVED_STATE_KEY = "MY_SAVED_STATE_KEY "
    private const val SOME_VALUE_KEY = "SOME_VALUE_KEY "
  }

  private lateinit var someValue: String
  private val savedStateProvider = SavedStateRegistry.SavedStateProvider {    
    Bundle().apply {
      putString(SOME_VALUE_KEY, someValue)
    }
  }

  override fun onCreate(savedInstanceState: Bundle?) {    
    super.onCreate(savedInstanceState)
    savedStateRegistry.registerSavedStateProvider(MY_SAVED_STATE_KEY, savedStateProvider)
    someValue = savedStateRegistry.consumeRestoredStateForKey(MY_SAVED_STATE_KEY)?.getString(SOME_VALUE_KEY) ?: ""
  }

} 
```

如您所见，`SavedStateRegistry`强制您使用数据的密钥。这可以防止您的数据被另一个`SavedStateProvider`附加到同一`Activity/Fragment`.Also 的数据损坏。您还可以将您的数据提取`SavedStateProvider`到另一个类中，通过使用您想要的任何抽象来使其与您的数据一起使用，从而在您的应用程序中实现干净的保存状态行为.

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2021-11-29T06:23:39.457

现在，您可以使用实时数据和生命周期感知组件

[https://developer.android.com/topic/libraries/architecture/lifecycle](https://developer.android.com/topic/libraries/architecture/lifecycle)

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2020-04-08T08:55:40.457

您需要覆盖 onSaveInstanceState(Bundle savedInstanceState) 并将要更改的应用程序状态值写入 Bundle 参数

# java - Java 中静态方法的替代方案

> ID：151778
> 
> 赞同：13
> 
> 时间：2008-09-30T04:41:36.900
> 
> 标签：java, interface, static

我正在为我正在编写的 Java 程序制作一个迷你 ORM……我的数据库中的每个表都有一个类，所有表都继承自`ModelBase`.

`ModelBase`是抽象的，提供了一堆静态方法来从数据库中查找和绑定对象，例如：

```
public static ArrayList findAll(Class cast_to_class) {
  //build the sql query & execute it 
} 
```

所以你可以做一些事情，比如`ModelBase.findAll(Albums.class)`获取所有持久专辑的列表。我的问题是，在这个静态上下文中，我需要从具体类 Album 中获取适当的 sql 字符串。我不能有像这样的静态方法

```
public class Album extends ModelBase {
  public static String getSelectSQL() { return "select * from albums.....";}
} 
```

因为Java中没有静态方法的多态性。但是我不想在其中创建`getSelectSQL()`一个实例方法，`Album`因为我需要创建它的一个实例只是为了获得一个行为上真正静态的字符串。

目前，`findAll()`使用反射来为有问题的类获取适当的 sql：

```
select_sql = (String)cast_to_class.getDeclaredMethod("getSelectSql", new Class[]{} ).invoke(null, null); 
```

但这太恶心了。

那么有什么想法吗？这是我一次又一次遇到的一个普遍问题——无法在类或接口中指定抽象静态方法。我知道*为什么*静态方法多态性不能也不能工作，但这并不能阻止我想再次使用它！

是否有任何模式/结构可以让我确保具体的子类 X 和 Y 实现一个类方法（或者如果失败，一个类常量！）？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T14:01:35.947

在这里使用静态是错误的。

概念上的静态是错误的，因为它仅适用于与实际对象（物理或概念）不对应的服务。您有许多表，每个表都应该由系统中的实际对象表示，而不仅仅是一个类。这听起来有点理论，但它有实际的后果，正如我们将看到的那样。

每个表属于不同的类别，这没关系。由于您只能拥有一个表，因此将每个类的实例数限制为一个（使用标志 - 不要使其成为单例）。让程序在访问表之前创建一个类的实例。

现在你有几个优点。由于您的方法不再是静态的，因此您可以使用继承和覆盖的全部功能。您可以使用构造函数进行任何初始化，包括将 SQL 与表相关联（您的方法稍后可以使用的 SQL）。这应该会让你上面的所有问题都消失，或者至少变得更简单。

似乎必须创建对象和额外的内存需要额外的工作，但与优势相比，它真的微不足道。对象的几个字节内存不会被注意到，少数构造函数调用可能需要十分钟才能添加。这样做的好处是，如果不使用表，则不需要运行初始化任何表的代码（不应调用构造函数）。你会发现它简化了很多事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T17:17:25.320

虽然，我完全同意“在这里使用静态是错误的东西”这一点，我有点理解你在这里想要解决的问题。仍然实例行为应该是工作方式，但如果你坚持这是我会做的：

从您的评论开始“我需要创建它的一个实例只是为了获得一个行为上真正静态的字符串”

这并不完全正确。如果你看起来不错，你并没有改变基类的行为，只是改变了方法的参数。换句话说，您正在更改数据，而不是算法。

当一个新的子类想要改变一个方法的工作方式时，继承更有用，如果你只需要改变这个类用来工作的“数据”，那么这样的方法就可以了。

```
class ModelBase {
    // Initialize the queries
    private static Map<String,String> selectMap = new HashMap<String,String>(); static {
        selectMap.put( "Album", "select field_1, field_2 from album");
        selectMap.put( "Artist", "select field_1, field_2 from artist");
        selectMap.put( "Track", "select field_1, field_2 from track");
    }

    // Finds all the objects for the specified class...
    // Note: it is better to use "List" rather than "ArrayList" I'll explain this later.
    public static List findAll(Class classToFind ) {
        String sql = getSelectSQL( classToFind );
        results = execute( sql );
        //etc...
        return ....
    }

    // Return the correct select sql..
    private static String getSelectSQL( Class classToFind ){
        String statement = tableMap.get( classToFind.getSimpleName() );
        if( statement == null ) {
            throw new IllegalArgumentException("Class " + 
                 classToFind.getSimpleName + " is not mapped");
        }
        return statement;

    }
} 
```

也就是说，用一个 Map 映射所有语句。“显而易见”的下一步是从外部资源（例如属性文件、xml 甚至（为什么不）数据库表）加载地图，以获得额外的灵活性。

这样你就可以让你的班级客户（和你自己）开心，因为你不需要“创建一个实例”来完成这项工作。

```
// Client usage:

...
List albums = ModelBase.findAll( Album.class ); 
```

...

另一种方法是从后面创建实例，并在使用实例方法时保持客户端接口完整，这些方法被标记为“受保护”以避免外部调用。以与上一个示例类似的方式，您也可以执行此操作

```
// Second option, instance used under the hood.
class ModelBase {
    // Initialize the queries
    private static Map<String,ModelBase> daoMap = new HashMap<String,ModelBase>(); static {
        selectMap.put( "Album", new AlbumModel() );
        selectMap.put( "Artist", new ArtistModel());
        selectMap.put( "Track", new TrackModel());
    }

    // Finds all the objects for the specified class...
    // Note: it is better to use "List" rather than "ArrayList" I'll explain this later.
    public static List findAll(Class classToFind ) {
        String sql = getSelectSQL( classToFind );
        results = execute( sql );
        //etc...
        return ....
    }

    // Return the correct select sql..
    private static String getSelectSQL( Class classToFind ){
        ModelBase dao = tableMap.get( classToFind.getSimpleName() );
        if( statement == null ) {
            throw new IllegalArgumentException("Class " + 
                 classToFind.getSimpleName + " is not mapped");
        }
        return dao.selectSql();
    }
    // Instance class to be overrided... 
    // this is "protected" ... 
    protected abstract String selectSql();
}
class AlbumModel  extends ModelBase {
    public String selectSql(){
        return "select ... from album";
    }
}
class ArtistModel  extends ModelBase {
    public String selectSql(){
        return "select ... from artist";
    }
}
class TrackModel  extends ModelBase {
    public String selectSql(){
        return "select ... from track";
    }
} 
```

而且你不需要改变客户端代码，仍然拥有多态的力量。

```
// Client usage:

...
List albums = ModelBase.findAll( Album.class ); // Does not know , behind the scenes you use instances. 
```

...

我希望这有帮助。

关于使用 List 与 ArrayList 的最后一点说明。对接口编程总是比对实现更好，这样你的代码就更灵活了。您可以使用另一个更快的 List 实现，或执行其他操作，而无需更改客户端代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T04:49:07.817

为什么不使用注释？它们非常适合您正在做的事情：将元信息（这里是 SQL 查询）添加到类中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T08:04:09.783

正如建议的那样，您可以使用注释，或者您可以将静态方法移动到工厂对象：

```
public abstract class BaseFactory<E> {
    public abstract String getSelectSQL();
    public List<E> findAll(Class<E> clazz) {
       // Use getSelectSQL();
    }
}

public class AlbumFactory extends BaseFactory<Album> {
    public String getSelectSQL() { return "select * from albums....."; }
} 
```

但是，没有任何状态的物体并不是一种很好的气味。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T04:48:08.460

如果是传一个Class给findAll，为什么不能传一个class给ModelBase中的getSelectSQL呢？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T05:26:12.877

asterite：你的意思是 getSelectSQL 只存在于 ModelBase 中，它使用传入的类来制作表名或类似的东西？我不能这样做，因为一些模型有非常不同的选择结构，所以我不能使用通用的“select * from”+ classToTableName();。任何从模型中获取有关其选择构造的信息的尝试都会遇到与原始问题相同的问题——您需要模型的实例或一些花哨的反射。

Gizmo：我肯定会看看注释。虽然我不禁想知道在没有反思之前人们对这些问题做了什么？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T05:45:33.673

您可以将 SQL 方法作为实例方法放在单独的类中。
然后将模型对象传递给这个新类的构造函数，并调用它的方法来获取 SQL。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T07:39:55.567

哇——这是我之前用更一般的术语问过的一个更好的例子——如何以一种避免重复的方式为每个实现类实现静态的属性或方法，提供静态访问而不需要实例化相关的类和感觉'对'。

简短回答（Java 或 .NET）：你不能。更长的答案 - 如果您不介意使用类级别注释（反射）或实例化对象（实例方法），则可以，但两者都不是真正的“干净”。

在此处查看我之前的（相关）问题：[如何处理因实现类而异的静态字段](https://stackoverflow.com/questions/66505/how-to-handle-static-fields-that-vary-by-implementing-class) 我认为答案都非常蹩脚并且没有抓住重点。你的问题措辞更好。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-30T06:13:48.440

我同意 Gizmo：您正在查看注释或某种配置文件。我会看看 Hibernate 和其他 ORM 框架（甚至可能是 log4j 之类的库！），看看它们如何处理类级元信息的加载。

并非所有事情都可以或应该以编程方式完成，我觉得这可能是其中一种情况。

# internet-explorer-7 - 在ie7中启用本地脚本和flash

> ID：151781
> 
> 赞同：3
> 
> 时间：2008-09-30T04:42:49.190
> 
> 标签：internet-explorer-7

我正在运行一个旧的小应用程序，它从本地文件在浏览器中运行，并且我不断收到“为了帮助保护您的安全，Internet Explorer 已限制此网页运行可能访问您的计算机的脚本或 Activex 控件”消息。

是否有注册表设置或我可以调整以使其自动运行的东西？

我知道[Mark of the Web](http://msdn.microsoft.com/en-us/library/ms537628(VS.85).aspx)，但在这种情况下并不实用（不幸的是，两者都没有在Firefox中运行）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-15T12:35:50.093

Internet 选项 > 高级 > 安全 > 允许活动内容在我的电脑上的文件中运行

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T04:56:17.240

您需要在安全设置中将本地文件系统（file://*）添加到安全网站。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-18T23:31:00.187

它位于 Internet 选项 > 高级 > 安全 > 允许活动内容在我的电脑上的文件中运行。

# .net - MS 会在 .Net 4.* 或 5.* 中放弃对 XP 的支持吗？

> ID：151782
> 
> 赞同：5
> 
> 时间：2008-09-30T04:42:49.237
> 
> 标签：.net, windows-xp, legacy

.Net 的当前版本和更新版本不支持 windows 2000 对开发人员来说是否重要？

想到我的几个客户仍在使用 Windows 2000，我感到害怕，尽管我可能决定有一天停止支持 Windows 2000，但我不喜欢微软将它推向人们的产品。

谁能看到微软在未来使用 XP 来刺激 Vista 及更高版本的销售？

澄清一下，这绝不是对 MS 的抨击，我喜欢 MS，但这是一个真正的问题，我想对此发表意见。

相比之下，我看不到 C++0x 实现者说“它在 Windows 2000 上不起作用”

我真的很想说服自己我应该改用.Net，但这是我的担忧之一。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T04:47:41.957

支持旧操作系统需要花钱。这并不一定是为了刺激新系统的销售，而是为了避免试图在他们已经停止支持的旧系统上运行的成本。正如 Windows 2000 支持已经结束，Windows XP 支持、Vista 支持、Windows 7 支持等也将结束。继续在不再以任何其他方式支持的操作系统上支持 .NET 框架似乎并不谨慎。

编辑：为了解决由于 .NET 2.0 和较新的框架版本的 CLR 相同的概念，限制是人为的。虽然它仍在同一个 CLR 上工作，但这并不意味着他们添加的所有支持都可以在 Windows 2000 上有效工作。需要考虑性能和硬件，我认为考虑到 Windows 2000 的时代和一些在 3.0 和 3.5 框架中添加的更密集的特性中，放弃 WIndows 2k 是一个合理的决定。

每当我们作为开发人员考虑支持特定用户群时，都必须考虑添加额外用户群所需的资源，而不是支持它们的好处。必须将测试、错误修复和支持成本考虑在内。由于不再为 Windows 2000 提供任何安全更新，因此他们需要恢复仅针对 .NET 更新的更新机制。我怀疑在这种情况下收益不会超过成本。因此，对我来说，微软应该人为地阻止较新的框架在 Windows 2000 上运行是有道理的，因为它们会为自己节省这些额外的成本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T07:37:03.623

考虑到微软在这件事上有双重利益（向你出售新操作系统和生产 .NET 框架），我会非常怀疑。

实际上，您将能够使用[Mono](http://www.mono-project.com/Main_Page)在旧操作系统上支持新的 .NET 版本，它几乎被设计为跨平台和向后兼容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T04:59:55.343

由于在我上次回复后问题发生了变化，我将补充一点，对 Windows 2k 的 3.0 和 3.5 支持并未“毫无警告”地被删除。有很多迹象表明这是在测试版结束之前发生的，所以我认为这个问题在这方面的措辞并不公平。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T04:57:20.420

我想这很大程度上取决于公司。例如，我一直在使用 IBM 和 Microsoft 的混合技术，我们的客户有这个非常老的 AS400 平台，他们甚至不支持他们数据库上的事务或关系，但是这些大公司投入了大量的时间和他们的系统上的钱，他们希望保持这种状态。

我们所做的是添加一个图层，以便他们可以在网站上使用此信息。我不认为 IBM 将其客户抛在后面，他们仍在开发软件组件以连接到 .Net 的这些旧技术，例如，如果他们进行研究并发现他们有许多客户仍在使用 Windows 2000，我相信微软也会这样做。您可能没有最新技术的所有功能，但至少我很确定他们会为它与最新技术保持一层兼容性。告诉一家拥有超过 10,000 名员工和数百万美元投资的公司只是切换到最新的操作系统或数据库系统并不容易，因为他们没有任何意义，相信我，即使微软希望你购买最现代的他们会赢的软件'

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T05:18:47.560

无论您使用什么技术堆栈，“支持最新功能”和“保持向后兼容性”之间总是存在矛盾。在哪里进行权衡很大程度上取决于您正在构建的产品类型和您拥有的客户类型。

我曾经使用 C++ 和 SQL 开发仓库管理应用程序，我们总是必须支持至少两个从 SQL Server 的“当前版本”返回的版本，因为我们的客户非常不愿意升级。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T04:51:57.983

好吧，这就是我的想法：

*   Windows 2000 是一个已有 9 年历史的产品，到明年很可能会失去支持，因此这可能是停止支持它的好借口
*   安装 .NET Framework非常*容易*
*   .NET Framework 对磁盘空间的影响很小（~20 - 30 MB），所以我不认为将它“推送”给客户端是硬盘空间方面的问题
*   有大量程序确实使用 .NET Framework，尤其是在企业环境中，因此您的客户很有可能已经拥有它们

老实说，我不确定你在担心什么。

顺便说一句，有一些方法可以使用仅安装 .NET 2.0 的 .NET 3.5 Framework 功能，并且已经在一些 SO 问题中介绍过。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T07:19:25.040

如果您查看最近的技术创新，尤其是基于 Atom 处理器的上网本，我认为 XP 将伴随我们一段时间，因为该套件的大部分不运行 Vista。同样在移动市场中，除了 Windows CE 变体之外，我们还嵌入了 XP，而不是 Vista。虽然戴尔等主要制造商仍在推出不支持 Vista 的[新套件，但 XP 仍然存在，](http://www1.euro.dell.com/content/products/productdetails.aspx/laptop-inspiron-9?c=ie&cs=iedhs1&l=en&s=dhs)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-30T05:05:14.907

由于我最近经历了这个，这里是微软声明的支持指南。 [生命周期指导。](http://support.microsoft.com/?LN=en-us&pr=lifecycle&scid=gp%3B%5Bln%5D%3Blifecycle&x=15&y=11)

仅供参考，对 XP 的支持至少应该持续到 2010 年，如果他们愿意为支持付费，可能还要再过几年。.Net 3[4].XX 会在 XP 上运行吗？可能，但谁知道呢？Win2k 在这一点上是一个非常古老的系统，并且操作系统中缺少一些东西。放手吧。

# multithreading - 哪些 CPU 架构支持比较和交换 (CAS)？

> ID：151783
> 
> 赞同：35
> 
> 时间：2008-09-30T04:42:57.647
> 
> 标签：multithreading, multicore, atomic, cpu-architecture

只是想知道哪些 CPU 架构支持比较和交换原子原语？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-30T05:15:13.557

Powerpc 有更强大的可用原语：“lwarx”和“stwcx”

lwarx 从内存中加载一个值，但会记住该位置。接触该位置的任何其他线程或 cpu 都会导致条件存储指令“stwcx”失败。

所以 lwarx /stwcx 组合允许您实现原子增量/减量、比较和交换，以及更强大的原子操作，如“原子增量循环缓冲区索引”

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2013-04-29T15:59:24.033

很抱歉写了很多信。:(

x86 ISA 中的几乎所有指令（除了所谓的字符串指令，可能还有少数其他指令），包括 CMPXCHG，在单核 CPU 的上下文中都是原子的。这是因为根据 x86 架构，CPU 在每条指令执行完成后检查到达的中断，而不是在中间。结果，可以检测到中断请求，并且仅在两个连续指令执行之间的边界处启动它的处理。因此，CPU 在执行单条指令期间采用的所有内存引用都是隔离的，并且不能被任何其他活动交错。这种行为在单核和多核 CPU 中很常见。但是如果在单核 CPU 的上下文中只有一个系统单元执行对内存的访问，在多核 CPU 的上下文中，系统中有多个单元同时执行对内存的访问。在这种环境下，指令隔离不足以保持一致性，因为不同 CPU 在同一时间进行的内存访问可以相互交错。由于这个额外的保护层必须应用于数据更改协议。对于 x86，这一层是锁定前缀，它在系统总线上启动原子事务。

![在此处输入图像描述](https://i.stack.imgur.com/C7ZGE.png)

总结：如果你保证这个指令访问的数据只能被一个内核访问，那么使用没有锁前缀的同步指令，如CMPXCHG、XADD、BTS等是安全且成本更低的。如果您对此不放心，请应用锁定前缀以通过权衡性能来提供安全性。

CPU 支持硬件同步有两种主要方法：

1.  基于原子事务。
2.  基于缓存一致性协议。

没有人是银弹。两种方法都有其优点和缺点。

基于原子事务的方法依赖于对内存总线上特殊类型事务的支持。在此类事务期间，只有一个连接到总线的代理（CPU 内核）有资格访问内存。结果，一方面，总线所有者在原子事务期间所做的所有内存引用都被确保作为单个不间断事务进行。另一方面，所有其他总线代理（CPU 内核）将被强制等待原子事务完成，以恢复访问内存的能力。他们想要访问哪些内存单元并不重要，即使他们想要访问在原子事务期间总线所有者未引用的内存区域也是如此。因此，大量使用以锁定为前缀的指令会显着降低系统速度。另一方面，由于总线仲裁器根据循环调度为每个总线代理授予对总线的访问权，因此可以保证每个总线代理对内存的访问相对公平，并且所有代理都能够取得进展和以同样的速度做到了。此外，在原子事务的情况下，ABA 问题也会发挥作用，因为原子事务本质上是非常短的（单个指令进行的内存引用很少），并且在事务期间对内存执行的所有操作仅依赖于内存区域的值，没有考虑到，内存区域是在两个事务之间被其他人访问的。基于原子事务的同步支持的一个很好的例子是 x86 架构，其中锁定前缀指令强制 CPU 在原子事务中执行它们。

基于缓存一致性协议的方法依赖于这样一个事实，即内存行只能在一个瞬间缓存在一个 L1 缓存中。缓存一致性系统中的内存访问协议类似于下一个动作序列：

1.  CPU A 将内存线 X 存储在 L1 高速缓存中。同时 CPU B 希望访问内存行 X。（X --> CPU A L1）
2.  CPU B 在总线上发出内存线 X 访问事务。(X --> CPU A L1)
3.  所有总线代理（CPU 内核）都有一个所谓的监听代理，它监听总线上的所有事务并检查事务请求的内存线访问是否存储在其所有者 CPU L1 缓存中。因此，CPU A snooping agent 检测到 CPU A 拥有 CPU B 请求的内存线。 (X --> CPU A L1)
4.  CPU A 暂停 CPU B 发出的内存访问事务。 (X --> CPU A L1)
5.  CPU A 从其 L1 高速缓存中刷新 B 请求的内存行。（X --> 内存）
6.  CPU A 恢复先前暂停的事务。（X --> 内存）
7.  CPU B 从内存中取出内存行 X。(X --> CPU B L1)

由于该协议，CPU 内核始终访问内存中的实际数据，并且对内存的访问是按严格的顺序序列化的，一次访问是及时的。基于缓存一致性协议的同步支持依赖于这样一个事实，即 CPU 可以轻松检测到特定内存行在两个时间点之间被访问。在对必须打开事务的行 X 的第一次内存访问期间，CPU 可以标记 L1 缓存中的该内存行必须由 snooping agent 控制。反过来，侦听代理可以在缓存行刷新期间执行检查以识别该行是否被标记为控制，如果受控行被刷新，则引发内部标志。结果，如果 CPU 在关闭事务的内存访问期间检查内部标志，它将知道受控内存线是否能够被其他人更改并得出结论是事务必须成功完成或必须被视为失败。这就是 LL\SC 指令类的实现方式。这种方法比原子事务更简单，并且在同步方面提供了更大的灵活性，因为与原子事务方法相比，可以在其基础上构建更多数量的不同同步原语。这种方法更具可扩展性和效率，因为它不会阻止系统所有其他部分对内存的访问。正如你所看到的，它解决了 ABA 问题，因为它基于内存区域访问检测的事实，而不是内存区域变化检测的值。对参与正在进行的事务的内存区域的任何访问都将被视为事务失败。这可能是好是坏，因为特定算法可能只对内存区域的值感兴趣并且不考虑该位置被中间人访问过，直到该访问更改内存. 在这种情况下，读取中间的内存值将导致错误的否定交易失败。此外，这种方法会导致位于同一内存线上的控制流的性能大幅下降，因为它们能够不断地相互连接内存线，从而阻止彼此成功完成事务。这是一个非常重要的问题，因为在终端情况下它可以使系统处于活锁状态。基于缓存一致性协议的同步支持通常用于 RISC CPU，因为它简单且灵活。但必须注意的是，英特尔也决定在 x86 架构中支持这种方法来支持同步。去年，英特尔宣布了 x86 架构的事务同步扩展，将在 Haswell 一代英特尔处理器中实现。结果，看起来 x86 将拥有最强大的同步支持，并允许系统开发人员利用这两种方法的优势。去年，英特尔宣布了 x86 架构的事务同步扩展，将在 Haswell 一代英特尔处理器中实现。结果，看起来 x86 将拥有最强大的同步支持，并允许系统开发人员利用这两种方法的优势。去年，英特尔宣布了 x86 架构的事务同步扩展，将在 Haswell 一代英特尔处理器中实现。结果，看起来 x86 将拥有最强大的同步支持，并允许系统开发人员利用这两种方法的优势。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-11-26T15:32:39.680

回答这个问题的另一种更简单的方法可能是列出不支持比较和交换的多处理器平台（或可用于编写的加载链接/存储条件）。

我知道的唯一一个是 PARISC，它只有一个原子明文指令。这可用于构造互斥体（前提是在 16 字节边界上对齐字）。此架构上没有 CAS（与 x86、ia64、ppc、sparc、mips、s390 不同，...）

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-09-24T11:11:04.467

一些人评论/询问了 cmpxchg 在 x86/x64 上是否需要“锁定”前缀。对于多核机器，答案是肯定的。对于没有锁的单核机器，该指令是完全原子的。

自从我深入研究这些东西以来已经有一段时间了，但我似乎记得该指令在技术上是可重新启动的 - 它可以在飞行中中止指令（如果它还没有任何副作用）以避免延迟中断处理太长。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-30T04:51:58.967

Intel x86 有这种支持。IBM 在它的[Solaris to Linux Porting Guide](http://www.ibm.com/developerworks/linux/library/l-solar/)中给出了这个例子：

```
bool_t My_CompareAndSwap(IN int *ptr, IN int old, IN int new)
{
        unsigned char ret;

        /* Note that sete sets a 'byte' not the word */
        __asm__ __volatile__ (
                "  lock\n"
                "  cmpxchgl %2,%1\n"
                "  sete %0\n"
                : "=q" (ret), "=m" (*ptr)
                : "r" (new), "m" (*ptr), "a" (old)
                : "memory");

        return ret;
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-30T05:48:14.587

从 ARMv6 架构开始，ARM 具有可用于实现原子比较交换操作的 LDREX/STREX 指令。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-01T04:00:41.810

只是为了完成列表，MIPS 具有加载链接 (ll) 和条件存储 (sc) 指令，它们从内存中加载一个值，然后如果没有其他 CPU 访问该位置，则有条件地存储。确实，您可以使用这些指令来执行交换、递增和其他操作。然而，缺点是大量 CPU 非常频繁地使用锁，你会陷入活锁：条件存储会经常失败，需要另一个循环再试一次，这会失败，等等。

如果这些情况被认为足够重要，需要担心的话，软件 mutex_lock 的实现可能会变得非常复杂，试图实现指数退避。在我使用 128 个内核工作的一个系统中，它们是。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-30T04:49:46.100

x86 和 Itanium 有 CMPXCHG（比较和交换）

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-08-17T00:53:10.467

比较和交换于 1973 年被添加到 IBM 大型机中。它（以及比较双精度和交换）仍然在 IBM 大型机上（以及最近的多处理器功能，如 PLO - 执行锁定操作）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-30T04:46:22.613

Sparc v9 有一个 cas 指令。SPARC v9[体系结构手册](http://www.sparc.org/standards/SPARCV9.pdf)讨论了附录 J 中 CAS 指令的使用，具体参见示例 J.11 和 J.12。

我相信指令的名称实际上是“casa”，因为它可以访问当前地址空间或备用地址空间。“cas”是访问当前 ASI 的汇编器宏。

[developer.sun.com](http://developers.sun.com/solaris/articles/atomic_sparc/)上还有一篇文章讨论了 Sparc 处理器多年来实现的各种原子指令，包括 cas。

# asp.net-mvc - 对视图进行单元测试？

> ID：151794
> 
> 赞同：22
> 
> 时间：2008-09-30T04:48:52.857
> 
> 标签：asp.net-mvc, unit-testing

关于如何在 ASP.NET MVC 中对视图进行单元测试的任何想法？

当我启动我的 MVC 项目时，我厌倦了遇到黄屏死机，只是因为当`Action`我的控制器的方法之一更改名称时我忘记更新视图。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-30T07:50:12.563

[您可以使用Watin](http://watin.sourceforge.net/)编写集成测试，但如果您只需要快速检查您的视图中是否有任何错误，您还可以尝试这篇文章中提到的解决方案：[如何在加载之前编译 ASP.NET 页面与网络服务器](https://stackoverflow.com/questions/108405/how-can-i-compile-aspnet-aspx-pages-before-loading-them-with-a-webserver)。预构建您的 aspx 页面，一切顺利！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-07-10T15:54:49.637

在您的项目文件中设置`<MvcBuildViews>`为 true ，编译器会在您构建时让您知道此类问题。

这假定您的项目文件还包含以下部分（在 ASP.NET MVC 1.0 中自动添加）

```
<Target Name="AfterBuild" Condition="'$(MvcBuildViews)'=='true'">
  <AspNetCompiler VirtualPath="temp" PhysicalPath="$(ProjectDir)\..\$(ProjectName)" />
</Target> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-10T17:17:14.677

好吧，除了[AugustLights](https://stackoverflow.com/users/17729/augustlights)提到的[Stephen Walther 的博客条目](http://stephenwalther.com/archive/2008/07/26/asp-net-mvc-tip-25-unit-test-your-views-without-a-web-server)之外，还有其他一些选项......

[Jim Zimmerman](http://www.jimzimmerman.com/blog/2008/08/30/Testing+Code+By+Precompiling+View+Pages+In+Aspnet+Mvc.aspx)在他的博客上谈到了他为动态预编译他的 ASP.NET MVC 视图页面以查找任何简单错误而编写的一些代码。

您还可以使用具有预编译功能的[Spark View Engine](http://sparkviewengine.com/documentation/precompiling)，而不是使用由 ASP.NET MVC 启用的默认 ASPX View Engine。这是一个非常戏剧性的变化，可能不是您的选择；）

如果您想了解有关 Spark 或其他视图引擎的更多信息，[Scott Hanselman](http://www.hanselman.com/blog/PrecompileaxdInASPNET11WithSystemWebHandlersBatchHandlerAHarbingerOfASPNET20LeftVestigiallyIn11.aspx)有一篇很棒的博客文章描述了它们以及它们的外观。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T05:32:04.750

S. Walther 有一些东西可以解决这个问题，但它看起来有点麻烦...... [http://stephenwalther.com/archive/2008/07/26/asp-net-mvc-tip-25-unit-test-your-没有网络服务器的视图](http://weblogs.asp.net/stephenwalther/archive/2008/07/26/asp-net-mvc-tip-25-unit-test-your-views-without-a-web-server.aspx)

我要再调查一下……这似乎是一件合理的事情……

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-06-14T09:01:30.723

## T4MVC 避免魔法值

您的问题归结为**魔术字符串**不是吗。那么为什么不尝试解决这些问题呢？

[T4MVC](http://t4mvc.codeplex.com/)正是为了避免那些讨厌的魔法字符串。因此，每当您重命名操作方法时，您的编译都会中断，因为旧的操作引用将不再存在。

## 单元测试视图？测试静态非功能性的东西？

单元测试是关于测试您的应用程序的功能方面，而不是静态方面（在您的情况下，这将是其他人的情况下的链接，这将是一些我不知道的...... CSS 类或页面上的特定 HTML 元素）。那只是不买我对视图进行单元测试......

因此，对您的视图进行单元测试可以从根本上解决您的问题。

# css - 在 Firefox 中单击按钮时出现水平线

> ID：151795
> 
> 赞同：0
> 
> 时间：2008-09-30T04:49:04.557
> 
> 标签：css, firefox

我在 Firefox 3 中有一些 CSS 问题。我的页面上有几个图像按钮，当我点击它们时，我看到屏幕顶部和底部按钮边框的水平线。我在其他网站上看到过这样的问题，所以我认为这是已知的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-30T04:54:30.347

这是因为`outline`CSS 中的样式 - 其想法是突出显示焦点元素，以便残障人士更好地注意到它。

您可以在css中设置`outline`样式，这应该可以解决它。`none`

# sql - Sqlite 更新字段（如果包含）

> ID：151800
> 
> 赞同：3
> 
> 时间：2008-09-30T04:51:20.697
> 
> 标签：sql, database, sqlite, syntax

给定一个名为“widget_ids”的数据库字段，其中包含“67/797/124/”或“45/”之类的数据，其中数字是斜线分隔的widget_ids...您将如何使用SQL 生成一条更新语句：“如果 id X 行的 widget_ids 包含文本“somenumber/”，则不执行任何操作，否则将“somenumber/”附加到它的当前值”

你能用 SQL 或者更具体地说是 sqlite 做类似的事情吗？出于某种原因，这是在程序中更好地完成的事情，还是支持 SQL 中的类似“if-then”的语法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-30T05:08:14.137

更新有点像 if-thens 本身，并且在大多数 SQL 实现中也有某种 if-then 支持。一个简单的解决方案可能是：

```
update <tablename>
  set widget_id = widget_id + "somenumber/"
  where row_id = X
    and widget_id not like "%/somenumber/%"
    and widget_id not like "somenumber/%"; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T06:16:16.267

首先，摆脱符号分隔的列表。使用另一个表，每行有一个小部件 ID。

```
CREATE TABLE ThingieWidgets (
  thingie_id INT REFERENCES Thingies,
  widget_id INT REFERENCES Widgets,
  PRIMARY KEY(thingie_id, widget_id)
); 
```

用斜杠分隔列表中的值填充表格：

```
INSERT INTO ThingieWidgets (thingie_id, widget_id)
  VALUES (1234, 67), (1234, 797), (1234, 124); 
```

现在您可以测试 Thingie 1234 是否引用了 Widget 45：

```
SELECT * FROM ThingieWidgets
WHERE thingie_id = 1234 AND widget_id = 45; 
```

如果出现重复键错误，您可以尝试插入和恢复：

```
INSERT INTO ThingieWidgets (thingie_id, widget_id)
  VALUES (1234, 45); 
```

# .net - System.IO.FileSystemWatcher 监控网络服务器文件夹 - 性能注意事项

> ID：151804
> 
> 赞同：45
> 
> 时间：2008-09-30T04:53:27.230
> 
> 标签：.net, performance, filesystemwatcher

我想查看网络服务器上的文件夹树是否有更改。这些文件都有一个特定的扩展名。树中有大约 200 个文件夹和大约 1200 个文件，扩展名为我正在查看。

我无法编写要在服务器上运行的服务（禁止！），因此解决方案必须在客户端本地。及时性并不是特别重要。我可以忍受一分钟或更长时间的通知延迟。我正在关注创建、删除、重命名和更改。

使用 .NET System.IO.fileSystemWatcher 会在服务器上产生大量负载吗？

10 个单独的观察者如何减少被观察的文件夹/文件的数量？（从 700 个文件夹减少到 200 个，总共从 5500 个文件减少到 1200 个）更多网络流量而不是更少？我的想法是在服务器上重新洗牌，将监视的文件放在一棵树下。我可能并不总是有这个选项，因此有观察者团队。

我想另一种解决方案是定期检查 FSW 是否在服务器上创建了过度负载，或者它是否由于一大堆 SysAdmin 类型的原因而不起作用。

有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2008-09-30T06:00:47.927

从服务器负载的角度来看，在您描述的场景中使用[IO.FileSystemWatcher](https://docs.microsoft.com/en-us/dotnet/api/system.io.filesystemwatcher)进行远程更改通知可能是最有效的方法。它在内部使用[FindFirstChangeNotification](http://msdn.microsoft.com/en-us/library/aa364417.aspx)和[ReadDirectoryChangesW](http://msdn.microsoft.com/en-us/library/aa365465.aspx) Win32 API 函数，这反过来又以优化的方式与网络重定向器通信（假设标准 Windows 网络：如果使用第三方重定向器，并且它不支持所需的功能，事情会成功根本不工作）。.NET 包装器还使用异步 I/O 和一切，进一步确保最大效率。

这个解决方案的唯一问题是它不是很可靠。除了必须处理暂时断开的网络连接（这不是什么大问题，因为在这种情况下 IO.FileSystemWatcher 会触发一个您可以处理的错误事件），底层机制具有某些基本限制。来自 Win32 API 函数的 MSDN 文档：

*   当缓冲区长度大于 64 KB 并且应用程序正在通过网络监视目录时，[ReadDirectoryChangesW失败并显示 ERROR_INVALID_PARAMETER。](https://docs.microsoft.com/en-us/windows/desktop/api/winbase/nf-winbase-readdirectorychangesw)这是由于底层文件共享协议的数据包大小限制

*   为远程文件系统调用[FindFirstChangeNotification](https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-findfirstchangenotificationw)时可能不会返回通知

换句话说：在高负载下（当您需要一个大缓冲区时），或者更糟糕的是，在随机未指定的情况下，您可能不会收到您期望的通知。这甚至是本地文件系统观察者的问题，但更多的是网络上的问题。[这里关于 SO 的另一个问题](https://stackoverflow.com/questions/57254/)更详细地详细说明了 API 的固有可靠性问题。

使用文件系统观察程序时，您的应用程序应该能够处理这些限制。例如：

*   如果您要查找的文件有序列号，请存储您收到通知的最后一个序列号，以便您可以在未来的通知中查找“空白”并处理您未收到通知的文件；

*   收到通知后，请始终进行完整目录扫描。这听起来可能很糟糕，但由于扫描是事件驱动的，它仍然比哑轮询更有效。此外，只要您将文件总数保持在单个目录中，以及要扫描的目录数在 1000 左右，此操作对性能的影响无论如何应该是非常小的。

设置多个监听器是你应该尽可能避免的事情：如果有的话，这会让事情变得*更不*可靠......

无论如何，如果您绝对*必须*使用文件系统观察程序，只要您了解这些限制，事情就可以正常工作，并且不要期望每个修改/创建的文件都有 1:1 的通知。

因此，如果您有其他选择（基本上，让写入文件的过程以基于非文件系统的方式通知您：任何常规 RPC 方法都将是一种改进......），从可靠性的角度来看，这些绝对值得研究观点。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-30T20:07:43.787

我已经多次使用 C# 中的文件系统观察程序。第一次使用它们时，我遇到了它们停止工作的问题，主要是因为我正在处理报告更改的线程中的更改。

然而，现在，我只是将更改推送到一个队列并在另一个线程上处理该队列。这似乎解决了我最初遇到的问题。对于您的问题，您可以让多个观察者推送到同一个队列中。

但是，我没有将它用于您的问题规模。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-03T11:09:14.430

以我的经验，FSW 不会产生高网络流量。但是，如果存在性能问题，您使用多个观察者并将其分解为更少被观察的文件夹的方法听起来是合理的。

不过，我在网络驱动器上使用 FSW 时遇到了一些大问题：删除文件总是抛出错误事件，而不是删除事件。我没有找到解决方案，所以如果有办法，我现在避免使用 FSW...

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T05:31:16.610

[MSDN 文档表明](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher(VS.85).aspx)您可以使用 FileSystemWatcher 组件来监视网络**驱动器**上的文件系统更改。

它还表明观察程序组件侦听文件系统更改通知，而不是定期询问目标驱动器的更改。

基于此，网络流量完全取决于您期望该网络驱动器的内容发生多少变化。FSW 组件不会增加网络流量的级别。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-09-24T17:13:23.243

观察者看起来 100% 可靠 - 只需观察观察者对象上的缓冲区大小。我已经测试了数千个文件更新，没有一个丢失。

我建议使用多线程方法 - 触发器是文件观察器。它可以为检测到的每个文件更改启动一个线程。观察者可以更快地处理并且溢出的机会更少。（使用异步线程）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-05-27T06:52:31.027

使用 System.IO.FileSystemWatcher 一段时间后。它不够稳定，无法处理来得太快的事件。确保 100% 读取文件。我使用简单的目录方法来搜索文件。阅读后，立即将文件复制到另一个文件夹。在您阅读文件时将其与添加的新文件隔离开来。

定时器用于定期读取文件夹。通过将已读取的文件复制到存档文件夹，可以确保不会再次读取它。随后的读取将始终是新文件。

```
var fileNames = Directory.GetFiles(srcFolder);
foreach (string fileName in fileNames)
{
   string[] lines = File.ReadAllLines(fileName);
} 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-30T05:08:42.247

我认为带有 FSW 的计算机和其位置被监视的计算机之间没有任何类型的活动状态或通信。换句话说，FSW 不会 ping 联网操作系统来检查文件。

可以想象，消息或事件仅在发生更改时*才会*引发/发送到联网的 FSW。

但这一切都只是猜测。:)

# c# - 搜索有关构建大型企业系统的信息

> ID：151812
> 
> 赞同：1
> 
> 时间：2008-09-30T04:57:59.043
> 
> 标签：c#, .net, database, scalability, reliability

如果在一个会话中上传和处理 500000 条数据记录是正常操作（C# .NET 3.5 + MS SQL 2005），您如何组织信息管理系统的 DB 层、业务逻辑和跨平台 API？

我对经过生产验证的分页模式特别感兴趣，这些模式在并发性、可伸缩性和可靠性方面表现良好。

有没有人有任何想法，在什么方向挖掘？

*   开源项目（不管语言和平台，只要不是Ook）
*   图书
*   文章
*   谷歌关键词
*   论坛或新闻组

任何帮助将不胜感激！

**更新：**

*   简单的分页（即：SQL 2005 中的行号）不起作用，因为数据库有很多**并发**更改。在页面请求之间删除或插入的项目会自动使当前页面索引无效。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T05:01:08.257

这是一本很好的入门书：

Martin Fowler[的企业应用架构模式](http://www.amazon.co.uk/Enterprise-Application-Architecture-Addison-Wesley-signature/dp/0321127420)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T08:43:23.107

当涉及到大量数据的数据库优化时，您很可能会从使用“BigTable”技术中受益。我发现[这里的文章](http://highscalability.com/how-i-learned-stop-worrying-and-love-using-lot-disk-space-scale)非常有用。不久的想法是使用 DB 非规范化来交换磁盘空间以获得更好的性能。

对于 MS SQL 2005 中的分页，您需要找到有关使用 ROW_NUMBER 函数的更多信息。[这只是一个简单的例子](http://www.davidhayden.com/blog/dave/archive/2005/12/30/2652.aspx)，你会发现很多使用谷歌（关键字：ROW_NUMBER paging SQL 2005）。不过不要挖掘太多——实现中没有魔法，而是你将如何使用/呈现分页本身。谷歌搜索就是一个很好的例子。

注意：我们发现 NHibernate 框架原生分页支持不足以满足我们的解决方案。

此外，您可能会对创建 FULLTEXT 索引和使用全文搜索感兴趣。这是有关创建全文索引[的 MSDN 文章](http://msdn.microsoft.com/en-us/library/ms187317.aspx)，以及有关全文搜索的[一些信息。](http://dev.mysql.com/doc/refman/5.0/en/fulltext-search.html)

祝你好运。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-19T11:29:35.957

完成了实施。我最近被告知其中一个上传是大约 2148849 条记录。在此上传期间，Tiers 确实成功地处理了数据库级别的几个断开的连接和数十个死锁。

如果其他人需要一些信息：

*   [产品页面](http://www.lokad.com/sdk-dot-net.ashx)
*   [异常处理操作策略](http://rabdullin.com/journal/2008/12/1/net-exception-handling-action-policies-application-block.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T09:02:50.390

丹迪卡斯，

感谢您提及部分非规范化。是的，这就是我正在考虑提高某些查询性能的方法。

不幸的是，NHibernate ORM 不适合该解决方案，因为它增加了性能开销。与 SQL 分页相同 - 它在大量并发编辑的情况下不起作用（由[压力测试检测](http://rabdullin.com/stress-testing-the-stability/)到）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T09:21:53.963

我负责管理一个上传数十万条记录的提要的企业数据仓库。
我不确定这是否是您的情况，但我们：

*   接收我们上传到 Sybase 数据库的文本文件。
*   使用 awk 格式化不同的提要，使它们采用通用格式。
*   使用 bcp 将它们加载到非规范化中间表中。
*   运行存储过程以填充规范化的数据库结构。
*   从非规范化中间表中删除。

这运行得相当好，但我们强制我们的上传是顺序的。即，当提要到达时，它们进入队列，我们​​在查看其余提要之前完全处理队列头部的提要。

这些有帮助吗？

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-01T07:34:50.033

> 与 SQL 分页相同 - 它在大量并发编辑的情况下不起作用（由压力测试检测到）

正如我所提到的，实现分页并没有什么神奇之处——您可以使用 ROW_NUMBER 或临时表。这里的魔力在于评估您在现实世界中最常见的使用场景。使用临时表和用户跟踪可能有助于克服并发编辑场景。虽然我感觉你会通过回答问题赢得更多：

1.  用户在移动到另一个页面之前在一个页面上停留了多长时间？
2.  用户多久从第一个页面移动到任何其他页面？
3.  用户将浏览的常见页面数是多少？
4.  如果在用户从一个页面移动到另一个页面并返回时某些信息发生变化，这有多重要？
5.  如果用户在显示信息的页面上时删除了某些信息，这有多重要？

尽量不要专注于这样的问题：“如何在分页时处理任何可能的并发编辑场景？” 在您首先回答上述问题之前，然后只处理真正重要的情况。

另一个注意事项是 UI。尽可能多地查看分页 UI，因为除了左右箭头或排列页码之外，还有更好的解决方案。一些解决方案有助于隐藏/克服技术上无法解决的分页场景。

PS如果这个答案有用，我会将它与我的第一个答案结合起来。

# functional-programming - Occam-pi 是学习 LEGO MINDSTORMS & Surveyor Corporation SRV-1 编程的好语言吗？

> ID：151825
> 
> 赞同：2
> 
> 时间：2008-09-30T05:05:23.723
> 
> 标签：functional-programming, lego, nxt, occam-pi

Occam-pi 是学习为编程新手编程 LEGO MINDSTORMS & Surveyor Corporation SRV-1 机器人的好语言吗？是否有任何开源项目使用相同的 - 来阅读源代码。occam-pi 的网址：- [http://www.transterpreter.org/](http://www.transterpreter.org/)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-17T14:48:37.953

我在翻译器上使用了occam [-pi](http://www.occam-pi.org) [，](http://www.transterpreter.org)它似乎做得很好。你可能想看看这个[博客](http://www.sububi.org/)。它是由其中一位开发人员编写的。如果你给马特一封电子邮件，他可能会为你指出正确的材料方向。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-06-18T13:38:55.900

如果您对 SRV-1 上的并行编程感兴趣，我可以说是的，Occam-Pi 很棒。几年前，Matt Jadud（Occam-Pi 的开发者之一）是我的教授，我们几乎只使用 Occam-Pi/SRV-1 组合。它有它的怪癖（或者至少当时是这样），但我们基本上能够解决它们。对于一个新程序员来说，学习一门语言并没有那么糟糕（这是**我的**第一门语言，我做得很好！）我绝对建议向马特询问任何问题，他很容易得到答复。我也很乐意回答您的任何问题，您可以给我发电子邮件：

bp 在 brdpwrs dot com

祝你好运！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-04-04T23:29:05.807

我发现 Occam-pi 是可以使用的机器人编程语言，没有失败。在考虑同时感知和行动的主动机器人时，它是其他语言所不具备的直观方式 - 并行。

在 Occam-pi 中编程就像连接物理机器人。您知道哪些硬件组件在做什么，因此您可以将它们连接到正确的位置。在使用并发编程语言（如 Occam-pi）进行编程时，也会出现类似的思维方式。您弄清楚必须如何编写所需的特定进程才能运行，然后通过通道（很像电线）将其连接到其他进程。

为了在 C、C++ 和 Java 等语言中做同样的事情，在微控制器上，有必要与诸如此类的野兽作斗争：定时器中断、易失性变量和错综复杂的“for”循环。

简而言之，Occam-pi 极大地简化了机器人编程。

带火

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-11-06T00:24:29.960

我会回应莫丹早些时候的评论。从某种意义上说，Occam 是一种非常好的语言——它以一种很可能是首屈一指的可靠、健壮的方式进行显式并发。但不幸的是，它不是通用编程语言。如果您只学过 C 和 Java 之类的语言，那么学习也不是一件容易的事。

它需要一种不同的思维方式，这也是它在并发方面如此出色的部分原因，尤其是在 NXT 等嵌入式系统中。与大多数程序员相比，必要的思维更类似于硬件设计人员使用的思维（特别是，OO 程序员可能会因拒绝引用别名而苦恼 - 这是 Occam 保证正确并发行为的原因之一；[更多细节可以在这里找到](http://www.cs.kent.ac.uk/projects/ofa/jcsp/components.pdf)）。必要的思维方式更像是某种塑料积木玩具产品所需的思维方式。

所以总而言之，这是一个不错的选择......但不幸的是，它会让大量没有经验的用户感到沮丧。如果您喜欢具有挑战性的冒险，请尝试一下！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-20T13:52:22.750

Occam**绝对**不是编程新手的语言。

我建议新手尝试并获得可在多种情况下使用的技能，并在将来随着您的职业/爱好的发展为您提供帮助。我要给出的另一个建议是在一个有一个充满活力的开发者社区可供学习的领域学习。如果您选择了正确的语言，您会发现友好的教程可以让您轻松进入该过程。

话虽如此，我对奥卡姆的体验是近十年前的事了，我仍然有一部分想回到它，再玩一次。当它工作时，这是一种非常有益的体验，尽管当你遇到一个错误，当你的进程被阻塞时性能会慢慢降低时，这会让人很恼火。

我建议你只有在已经有 Lego Mindstorms 编程经验后才花时间学习 Occam **，**即使那样，也只有在你有大量时间和耐心的情况下。如果你有机会，它是一门很棒的语言，绝对是我遇到的最好的高度并行编程语言。我怀疑它是否会成为主流。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-04T13:54:31.467

可能不是。它是一种研究语言，因此不会对您想要的内容提供支持。对不起。

LEGO MINDSTORMS Education NXT 软件可能是编程新手的更好选择。SRV-1 很酷 - 但并没有真正为初学者提供支持资源。

祝你好运！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-17T14:55:34.663

当最初的头脑风暴问世时，我使用了“不完全 c”——正确的编程语法，但很容易使用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-11T11:03:27.240

好吧，让我们这样说吧：你不需要一直与数据库交互。

我认为您可能会发现学习一门研究语言以掌握其他语言的新功能是值得的。我应该写更多，但没有时间。

# c++ - 高级比较和交换 (CAS) 函数？

> ID：151841
> 
> 赞同：13
> 
> 时间：2008-09-30T05:16:49.060
> 
> 标签：c++, multithreading, multicore, atomic

我想记录哪些高级（即 C++ 不是内联汇编器）函数或宏可用于比较和交换（CAS）原子原语......

`_InterlockedCompareExchange`例如，x86 上的 WIN32在标头中有一系列函数`<_intrin.h>`。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-30T05:21:44.917

我会让其他人列出各种特定于平台的 API，但为了将来在 C++09 中参考，您将获得

```
atomic_compare_exchange() 
```

新的“原子操作库”中的操作。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-30T08:18:32.043

glib 是 Linux 和 Unix 系统上的通用系统库（但也支持 Windows 和 Mac OS X），定义[了几个原子操作](http://library.gnome.org/devel/glib/2.16/glib-Atomic-Operations.html)，包括**g_atomic_int_compare_and_exchange**和**g_atomic_pointer_compare_and_exchange**。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-30T06:24:32.080

GCC 也有一些[内置的原子访问](http://gcc.gnu.org/onlinedocs/gcc-4.3.0/gcc/Atomic-Builtins.html)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T05:29:33.070

在 Solaris 上有“atomic.h”（即[<sys/atomic.h>](http://src.opensolaris.org/source/xref/onnv/onnv-gate/usr/src/uts/common/sys/atomic.h)）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-30T06:01:03.323

MacOS X 有[OSAtomic.h](http://developer.apple.com/documentation/Darwin/Reference/KernelIOKitFramework/OSAtomic/CompositePage.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-11-07T23:15:08.023

已经有一系列关于这个主题的工作组论文提议对 C++ 标准库进行更改。[WG N2427](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2427.html)（*C++ 原子类型和操作*）是最新的，它为待定标准的第 29 节——*原子操作库做出了贡献。*

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-30T06:35:30.637

java也有这个CAS操作

看[这里](http://java.sun.com/javase/6/docs/api/java/util/concurrent/atomic/AtomicReferenceFieldUpdater.html#compareAndSet(java.lang.Object,java.lang.Object,java.lang.Object))

这有实际用途，例如多处理器系统中使用[的无锁哈希表](http://video.google.com/videoplay?docid=2139967204534450862&ei=h8jhSM61N6Ky2gKK2LydCw&q=hashtable&emb=1)

# unicode - 可用于欺骗字符串排序器的 Unicode 字符？

> ID：151844
> 
> 赞同：6
> 
> 时间：2008-09-30T05:19:02.690
> 
> 标签：unicode, sorting

由于 Unicode 缺少一系列零宽度排序字符，因此我需要确定等效字符，以便我可以在按字符值自动排序的列表上强制执行特定顺序。不幸的是，列表项不是按字母顺序排列的，也不可以在它们前面加上可见字符以确保排序结果与想要的结果相匹配。

哪些 Unicode 字符可以放在常规拉丁字母文本前面，并且不会出现，但仍然允许我以我需要的方式“尖峰”排序？

（顺便说一句，这是使用带有用户配置文件列表字段的 Drupal 5 完成的。不要费心建议将其更改为词汇/类别。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-30T19:50:41.690

零宽度空间 (U+200B) 应该可以满足您的需求。从 Unicode 规范：

> 零宽度空间。U+200B ZERO WIDTH SPACE 表示换行机会，除了它没有宽度。零宽度空格字符旨在用于没有可见字间距以表示换行机会的语言，例如泰语、高棉语和日语。

应该是您遇到的大多数字体，但 YMMV.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T05:58:50.287

就个人而言，我只是更喜欢使用主/次排序键。它不那么笨拙，并且易于在典型的 sql 查询中实现（ORDER BY column_a,column_b）。**编辑添加**：在 PHP 中`usort(array, comparisonFunction)`，如果您不能使用 SQL 来解决问题，您可以使用自定义比较函数来添加额外的排序逻辑。

但是，如果您只有一列可以使用并且无法修复，则只需使用一定数量的不太可能的字符（如下划线）作为前缀进行排序，然后在显示它们之前将它们剥离。（使用正则表达式替换或类似的）。

基于 Unicode 的 hack 将在很大程度上取决于使用的字体、您使用的区域设置的排序/排序顺序，并且可能会对您无法控制的客户端产生不良副作用（不同的浏览器、不同的操作系统、不同的客户端区域设置） . 大多数“不可打印”字符在不支持它们的系统上显示时会产生“未知字符”，通常看起来像一个空方块。有一些零宽度字符用于阿拉伯语等语言，但它们不应该影响排序，除非在具有非常不正当的 Unicode 支持的应用程序中。

# python - 在 Python 中获取其他正在运行的进程窗口大小

> ID：151846
> 
> 赞同：8
> 
> 时间：2008-09-30T05:20:27.320
> 
> 标签：python, windows, winapi, pywin32

这并不像听起来那么恶意，我想获取他们窗口的当前大小，而不是查看其中的内容。目的是弄清楚如果每个其他窗口都是全屏的，那么我也应该这样启动。或者，如果所有其他进程只有 800x600，尽管分辨率很高，那么这可能就是用户想要的。为什么要让他们浪费时间和精力来调整我的窗口大小以匹配他们拥有的所有其他窗口？我主要是一个 Windows 开发者，但如果有跨平台的方式来做到这一点，它至少不会让我感到不安。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-30T10:02:38.250

使用[WindowMover 文章](http://www.devx.com/opensource/Article/37773/1954)和[Nattee Niparnan 的博客](http://our.obor.us/?q=node/42)文章中的提示，我设法创建了这个：

```
import win32con
import win32gui

def isRealWindow(hWnd):
    '''Return True iff given window is a real Windows application window.'''
    if not win32gui.IsWindowVisible(hWnd):
        return False
    if win32gui.GetParent(hWnd) != 0:
        return False
    hasNoOwner = win32gui.GetWindow(hWnd, win32con.GW_OWNER) == 0
    lExStyle = win32gui.GetWindowLong(hWnd, win32con.GWL_EXSTYLE)
    if (((lExStyle & win32con.WS_EX_TOOLWINDOW) == 0 and hasNoOwner)
      or ((lExStyle & win32con.WS_EX_APPWINDOW != 0) and not hasNoOwner)):
        if win32gui.GetWindowText(hWnd):
            return True
    return False

def getWindowSizes():
    '''
    Return a list of tuples (handler, (width, height)) for each real window.
    '''
    def callback(hWnd, windows):
        if not isRealWindow(hWnd):
            return
        rect = win32gui.GetWindowRect(hWnd)
        windows.append((hWnd, (rect[2] - rect[0], rect[3] - rect[1])))
    windows = []
    win32gui.EnumWindows(callback, windows)
    return windows

for win in getWindowSizes():
    print win 
```

为此，您需要[Win32 Extensions for Python 模块](http://python.net/crew/mhammond/win32/Downloads.html)。

编辑：我发现它`GetWindowRect`给出的结果比`GetClientRect`. 源已更新。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-30T23:30:58.247

[我是AutoIt](http://www.autoitscript.com/autoit3/)的忠实粉丝。他们有一个 COM 版本，允许您从 Python 中使用他们的大部分功能。

```
import win32com.client
oAutoItX = win32com.client.Dispatch( "AutoItX3.Control" )

oAutoItX.Opt("WinTitleMatchMode", 2) #Match text anywhere in a window title

width = oAutoItX.WinGetClientSizeWidth("Firefox")
height = oAutoItX.WinGetClientSizeHeight("Firefox")

print width, height 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T07:35:04.267

查看 Python 的 Windows 扩展中的[`win32gui`模块](http://www.devx.com/opensource/Article/37773/1954)。它可能会提供您正在寻找的一些功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-02-25T10:17:50.213

我更新了 GREAT @DZinX 代码，添加了窗口的标题/文本：

```
import win32con
import win32gui

def isRealWindow(hWnd):
    #'''Return True iff given window is a real Windows application window.'''
    if not win32gui.IsWindowVisible(hWnd):
        return False
    if win32gui.GetParent(hWnd) != 0:
        return False
    hasNoOwner = win32gui.GetWindow(hWnd, win32con.GW_OWNER) == 0
lExStyle = win32gui.GetWindowLong(hWnd, win32con.GWL_EXSTYLE)
if (((lExStyle & win32con.WS_EX_TOOLWINDOW) == 0 and hasNoOwner)
  or ((lExStyle & win32con.WS_EX_APPWINDOW != 0) and not hasNoOwner)):
    if win32gui.GetWindowText(hWnd):
        return True
return False

def getWindowSizes():

Return a list of tuples (handler, (width, height)) for each real window.
'''
def callback(hWnd, windows):
    if not isRealWindow(hWnd):
        return
    rect = win32gui.GetWindowRect(hWnd)
    text = win32gui.GetWindowText(hWnd)
    windows.append((hWnd, (rect[2] - rect[0], rect[3] - rect[1]), text ))
windows = []
win32gui.EnumWindows(callback, windows)
return windows

for win in getWindowSizes():
print(win) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-10-18T03:25:14.437

我修改某人的代码，

这很好地帮助运行其他应用程序并获取 PID，

```
import win32process
import subprocess
import win32gui
import time 

def get_hwnds_for_pid (pid):
  def callback (hwnd, hwnds):
    if win32gui.IsWindowVisible (hwnd) and win32gui.IsWindowEnabled (hwnd):
      _, found_pid = win32process.GetWindowThreadProcessId (hwnd)
      if found_pid == pid:
        hwnds.append (hwnd)
    return True

  hwnds = []
  win32gui.EnumWindows (callback, hwnds)
  return hwnds

# This the process I want to get windows size. 
notepad = subprocess.Popen ([r"C:\\Users\\dniwa\\Adb\\scrcpy.exe"]) 
time.sleep (2.0)

while True: 
  for hwnd in get_hwnds_for_pid (notepad.pid):
    rect = win32gui.GetWindowRect(hwnd)
    print(hwnd, "=>", win32gui.GetWindowText (hwnd))

    # You need to test if your resolution really get exactly because mine is doesn't . 
    # I use . 16:9 Monitor , Calculate the percent using this calculations , , (x * .0204082) and (y * .0115774)
    print((hwnd, (rect[2] - rect[0], rect[3] - rect[1])))
    x = rect[2] - rect[0]
    y = rect[3] - rect[1]
    print(type(x), type(y))
    time.sleep(1) 
```

# conditional-statements - 为什么要在条件中使用赋值？

> ID：151850
> 
> 赞同：86
> 
> 时间：2008-09-30T05:24:43.737
> 
> 标签：conditional-statements, language-agnostic, variable-assignment

在许多语言中，作业在条件下是合法的。我一直不明白这背后的原因。你为什么要写：

```
if (var1 = var2) {
  ...
} 
```

代替：

```
var1 = var2;
if (var1) {
  ...
} 
```

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2008-09-30T05:32:39.460

循环比 if 语句更有用。

```
while( var = GetNext() )
{
  ...do something with var 
} 
```

否则必须写

```
var = GetNext();
while( var )
{
 ...do something
 var = GetNext();
} 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-09-30T05:59:00.410

我发现它在通常涉及错误检测等的操作链中最有用。

```
if ((rc = first_check(arg1, arg2)) != 0)
{
    report error based on rc
}
else if ((rc = second_check(arg2, arg3)) != 0)
{
    report error based on new rc
}
else if ((rc = third_check(arg3, arg4)) != 0)
{
    report error based on new rc
}
else
{
    do what you really wanted to do
} 
```

替代方案（不使用条件中的分配）是：

```
rc = first_check(arg1, arg2);
if (rc != 0)
{
    report error based on rc
}
else
{
    rc = second_check(arg2, arg3);
    if (rc != 0)
    {
        report error based on new rc
    }
    else
    {
        rc = third_check(arg3, arg4);
        if (rc != 0)
        {
            report error based on new rc
        }
        else
        {
            do what you really wanted to do
        }
    }
} 
```

通过延长错误检查，替代方案可以在页面的 RHS 之外运行，而条件分配版本则不会这样做。

错误检查也可以是“动作”——、、、`first_action()`——当然`second_action()`，`third_action()`而不仅仅是检查。也就是说，可以在该功能管理的过程中检查它们的步骤。（大多数情况下，在我使用的代码中，函数与前置条件检查，或函数工作所需的内存分配，或类似的行一致）。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2008-09-30T05:27:16.773

如果您正在调用一个函数，它会更有用：

```
if (n = foo())
{
    /* foo returned a non-zero value, do something with the return value */
} else {
    /* foo returned zero, do something else */
} 
```

当然，你可以把 n = foo(); 在单独的语句 then if (n)，但我认为上面是一个相当易读的习语。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2008-09-30T05:26:51.207

如果您调用的函数返回要处理的数据或指示错误（或您已完成）的标志，这将很有用。

就像是：

```
while ((c = getchar()) != EOF) {
    // process the character
}

// end of file reached... 
```

就个人而言，这是一个我不太喜欢的成语，但有时替代方案更丑陋。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-09-30T05:32:34.250

如果您无意中尝试使用赋值作为真值，GCC 可以帮助您检测（使用 -Wall），以防它建议您编写

```
if ((n = foo())) {
   ...
} 
```

即使用额外的括号表示这确实是您想要的。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-09-30T05:32:33.767

当您编写`while`循环而不是`if`语句时，该成语更有用。对于`if`声明，您可以按照您的描述将其分解。但是如果没有这个结构，你要么必须重复自己：

```
c = getchar();
while (c != EOF) {
    // ...
    c = getchar();
} 
```

或使用循环半结构：

```
while (true) {
    c = getchar();
    if (c == EOF) break;
    // ...
} 
```

我通常更喜欢循环半形式。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-30T06:36:29.493

简短的回答是[面向表达式的](http://en.wikipedia.org/wiki/Expression-oriented_programming_languages)编程语言允许更简洁的代码。它们不会强迫您[将命令与查询分开](http://en.wikipedia.org/wiki/Command-query_separation)。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-30T05:33:00.067

例如，在 PHP 中，它对于遍历 SQL 数据库结果很有用：

```
while ($row = mysql_fetch_assoc($result)) {
    // Display row
} 
```

这看起来比：

```
$row = mysql_fetch_assoc($result);
while ($row) {
    // Display row
    $row = mysql_fetch_assoc($result);
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-10-10T06:39:30.620

另一个优点是在使用 gdb 期间。在下面的代码中，如果我们单步执行，则不知道错误代码。

```
while (checkstatus() != -1) {
    // process
} 
```

相当

```
while (true) {
    int error = checkstatus();
    if (error != -1)
        // process
    else
        //fail
} 
```

现在，在单步中，我们可以知道 checkstatus() 的返回错误代码是什么。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-11-22T18:39:54.673

`boost::optional`我发现它对于返回可选项（或`std::optional`在 C++17 中）的函数非常有用：

```
std::optional<int> maybe_int(); // function maybe returns an int

if (auto i = maybe_int()) {
    use_int(*i);
} 
```

这减少了我的变量的范围，使代码更紧凑并且不妨碍可读性（我发现）。

与指针相同：

```
int* ptr_int();

if (int* i = ptr_int()) {
    use_int(*i);
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-05-27T11:48:52.337

我今天在用 Arduino（C 语言）编程时使用它。

## 案子

我有一个发射器和一个接收器。发送器想要发送数据，直到它被接收到。我想在过程完成后设置一个标志。

```
while (!(newtork_joined = transmitter.send(data))) {
Serial.println("Not Joined");
} 
```

这里：

*   "transmitter.send" - 传输成功时返回 true
*   “newtork_joined” - 是我成功时设置的标志

## 结果

1.  传输不成功时，不设置标志，while循环为真，一直执行

2.  成功时，设置标志，while循环为假，我们退出

> 不漂亮吗？

* * *

## 回答 #12

> 赞同：-4
> 
> 时间：2016-11-18T12:24:40.923

原因是：

1.  性能改进（有时）

2.  更少的代码（总是）

举个例子：有一个方法`someMethod()`，在一个`if`条件下要检查方法的返回值是否为`null`. 如果没有，您将再次使用返回值。

```
If(null != someMethod()){
    String s = someMethod();
    ......
    //Use s
} 
```

由于您两次调用相同的方法，因此会影响性能。而是使用：

```
String s;
If(null != (s = someMethod())) {
    ......
    //Use s
} 
```

# excel - 重命名后无法访问excel文件

> ID：151851
> 
> 赞同：0
> 
> 时间：2008-09-30T05:24:50.557
> 
> 标签：excel, file, renaming

我在我的网络服务器上重命名了一些 excel 文件，重命名后用户无法下载这些文件。可能是什么问题呢。它们都是excel文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T05:31:28.387

我能想到的一些可能性：

*   确保文件的扩展名仍然是 .xls（这就是它关联 mime 类型的方式）
*   检查文件的文件保护以防万一，或者在重命名它们时所有权已更改
*   确保 Excel 没有在 Web 服务器（如果是 Windows Web 服务器）上打开它们，因为它会一直锁定它们，直到 EXCEL.EXE 进程被终止。

可能是其中之一...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T05:38:44.720

另一个可能的问题是您的网络服务器在文件名方面区分大小写，并且当您重命名文件时，名称可能与之前的大小写不同（想想 .XLS 到 .xls）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T05:38:03.177

一个原因是重命名网络服务器中的文件将需要 refrseh 或重新加载页面。你尝试过吗

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-09-09T19:58:59.573

我通过右键单击文件夹中的文件名并滚动到“重命名”并输入我想要的内容，将一个 Excel 文件从 Columbus 重命名为 Columbus PPWK。我已经用其他文件做了一万亿次，没有任何问题。当我试图打开这个时，它会问我如何用一堆选项打开它，但没有任何效果。此外，新重命名文件旁边的小图片只是一个空白的白色矩形，而不是带有绿色 X 的普通白色矩形。我通过简单地将其重命名为 Columbus PPWK.xls 来修复它一旦我添加了 .xls，它允许我再次打开它并重新保存它以确保它出现并正常运行，它确实如此。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-10-12T05:54:31.643

我试图寻找一些解决方案，直到我自己找到它。这可能会有所帮助。重命名文件太长是我遇到的问题。因此，使文件名简短。

# windows - Windows中等效的根文件夹

> ID：151860
> 
> 赞同：8
> 
> 时间：2008-09-30T05:30:25.753
> 
> 标签：windows, filesystems

当在 linux 和 windows C:\folder1\folder2 中说 \folder1\folder2\ 时，C 驱动器是否被视为 Windows 中的根文件夹。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-30T05:37:26.330

在 Windows 中，它与当前工作目录所在的驱动器有关。如果您的当前目录位于 C 驱动器中，则 C:\ 将是根目录。如果当前目录是 D 驱动器，则 D:\ 将是根目录。没有绝对的根。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-30T06:21:45.147

在文件系统级别，Win32 API 没有根文件夹，但正如其他人指出的那样，[Shell API](http://msdn.microsoft.com/en-us/library/aa457128.aspx)有，即。桌面。Shell 命名空间是使用（图形）shell 浏览的，它恰好是 Explorer.exe。

在低得多的级别上，Windows 内核也有一个根文件夹，注册表和文件系统是它的子文件夹。如果您正在编写设备驱动程序，这是相关的。可以使用名为[WinObj](http://technet.microsoft.com/en-us/sysinternals/bb896657.aspx)的工具浏览[对象管理器](http://en.wikipedia.org/wiki/Object_Manager_(Windows))命名空间。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-30T07:54:21.633

如果您正在运行 Windows CE，则 \ 是根目录。这类似于 Unix 的 / 根目录。这是唯一一种可以简单回答问题的 Windows。

如果您运行的是 Windows NT/2000/XP/2003，那么最接近的等价物是包含文件 NTLDR、NTDETECT.COM、BOOT.INI 和 BOOTFONT.BIN 的分区。BIOS 和 MBR 通过查找要启动的驱动器、扫描 MBR 并查找活动分区来找到此分区。Microsoft 将此称为系统分区。我不完全确定程序如何找到这是哪个分区。无论如何，当您找到这是哪个驱动器号时，比如说字母 L，那么您可以说 L:\ 是根目录。99% 的时间这将是驱动器号 C:。

此外，如果您运行的是 Windows NT/2000/XP/2003，那么您还有一个包含 Windows 系统文件的分区，例如目录 \Windows 或其他。Microsoft 将此称为引导分区。正如其他人所说，您可以从符号 %SystemDrive% 获取驱动器号。如果这是驱动器号 Q，那么您可以说 Q:\ 是系统驱动器的根目录。

如果您运行的是 Vista，那么事情会更加复杂。如果您通过引导 DVD 安装，那么引导分区（包含系统文件）是 C:，而您的系统分区（包含引导文件）是 D:，除非它们是同一个分区，然后分区是 C:。但是，如果您通过已经运行 Windows、插入 DVD 并在该 Windows 安装下启动安装程序来安装，那么驱动器号几乎可以是任何东西。

在 Windows 95/98/ME 中，BIOS 和 MBR 会在活动分区中查找文件 IO.SYS、COMMAND.COM 和其他一些文件。这通常会得到驱动器号 C:，因此根分区是 C:。与往常一样，Windows 系统文件可以安装在目录 \Windows 或任何分区上的其他目录中。

有些人谈论台式机。当然，每个登录用户都有一个桌面。这有点像每个 Unix 用户的主目录。它肯定不是根目录。

附录：在倒数第二段中，关于 Windows 95/98/ME，我输入了“所以根分区将是 C:”。也就是说，字母 C、冒号、反斜杠，然后是句末句点（不是目录名称的一部分）。查看页面时，反斜杠未显示。但是，在编辑此答案以添加此附录时，反斜杠与我输入的内容完全相同。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-30T07:05:03.933

在 Windows 中，您没有特殊的根节点，而是在文件系统上有一些以环境变量形式存在的入口点：

％应用程序数据％

%程序文件%

%通用程序文件%

%系统驱动器%

%系统根%

即使根的概念在 Windows 中脱离上下文，根的更好等价物可能是 %SystemDrive%。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-30T05:49:42.850

正如其他人所提到的，Windows 与 UNIX 不同，在 UNIX 中，文件系统为所有设备都有一个逻辑“路径”空间（每个设备都安装到这个空间，例如 /dev/floppy）。

在 Windows 中，每个设备（无论是硬盘分区、CD/DVD ROM 还是闪存驱动器）都有自己的逻辑路径空间，根植于其逻辑驱动器号的“\”目录。

虽然 Windows 资源管理器在组织“我的电脑”下的所有驱动器方面做得还不错，但这是纯粹的 UI 糖，没有办法通过相对路径从一个驱动器号获取到另一个驱动器号。

然而，每个单独的驱动器文件系统的行为与 UNIX 相似，并且确实有一个名为“\”的根。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-30T05:38:20.350

Windows 不共享根文件夹的 UNIX 概念。相反，每个带有文件存储的分区或设备都有自己的根文件夹。鉴于 C: 分区/驱动器（几乎）始终是操作系统的主目录，但是，您可能会认为它的根文件夹与 Windows 相同。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-30T05:55:10.887

在 Windows 中，根文件夹将是桌面。Desktop->Computer->C:\folder1\folder2 与 IShellFolder 接口。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-30T07:15:20.307

Unix 使用文件系统代表系统的几乎所有部分，从上到下，这意味着根文件系统文件夹在逻辑上也代表“系统根”。但在 Windows 中，文件系统与系统并没有如此紧密的联系，因此在文件系统中没有“系统根”的概念。[休](https://stackoverflow.com/questions/151860/root-folder-equivalent-in-windows#151967)更详细地解释了它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T05:32:33.737

是的，“\”是当前驱动器的根文件夹。例如 DOS 命令 "cd \" 将当前目录更改为根文件夹，或者 "cd \folder1\folder2" 转到 "c:\folder1\folder2"

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2014-02-27T04:40:55.030

事实上，windows 有一个根文件夹。该文件夹虽然不可见，但被称为“i386”

# c# - 我们如何设置放置在 Infragistics Windows Grid 控件中的按钮的可见性

> ID：151872
> 
> 赞同：1
> 
> 时间：2008-09-30T05:33:01.160
> 
> 标签：c#, infragistics, ultrawingrid

我有一个表单，我使用 Infragistics windows 网格控件来显示数据。在此，我在其中一个单元格上放置了一个按钮。我想根据行条件将其可见性设置为 True 或 False。我已经处理了**UltraWinGrid控件的****InitializeRow**事件并且能够禁用该按钮。但我无法将按钮的可见设置为 False。

 *** * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T11:26:15.383

```
UltraGridRow row = ...

row.Cells[buttonCellIndex].Hidden = true; 
```

（我正在使用`UltraGrid`Infragistics NetAdvantage for Windows Forms 2008 Vol. 2 CLR 2.0。）

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-01-01T08:41:52.770

首先你必须实现行和单元格，然后使用 findControl 方法并将其分配给一个按钮，现在按钮在你的手中。你可以设置可见性:)

# c# - 什么是 ASP.NET 的优秀可扩展博客应用程序？

> ID：151873
> 
> 赞同：2
> 
> 时间：2008-09-30T05:36:00.777
> 
> 标签：c#, asp.net, blogs

[我正在寻找一个相对较好且支持良好，最好是在ASP.NET](http://en.wikipedia.org/wiki/ASP.NET)和[SQL Server](http://en.wikipedia.org/wiki/Microsoft_SQL_Server)上运行的开源博客应用程序。它不需要包装完整的功能，它只需要基础知识，例如标记、评论等。额外的功能是一个奖励。

我还希望它是开源的，或者有一个可扩展的框架，不仅可以定制外观，还可以定制功能；如果它是开源的，最好用 C# 编写，因为那是我选择的语言。

良好的性能等，在寻找应用程序时通常的东西。

即使它是一个包含博客的[CMS](http://en.wikipedia.org/wiki/Content_management_system)，也需要指出这一点。

请提供名称、链接以及您认为它的一些优点。即使有人发布了您要发布的内容，但您还有其他喜欢的内容，请无论如何添加这些内容。

* * *

我从响应中获得了检查[BlogEngine.Net](http://www.dotnetblogengine.net/)、[subtext](http://subtextproject.com/)、[dasBlog](http://www.dasblog.info/)并远离[DotNetNuke](http://en.wikipedia.org/wiki/DotNetNuke)中的博客。我将从 BlogEngine 开始。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-30T05:39:00.850

我为[我的一个客户](http://blog.atomium.be/)使用了[BlogEngine.NET](http://www.dotnetblogengine.net/)，绝对可以推荐它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T06:00:45.883

两个大的是[BlogRngine.NET](http://www.dotnetblogengine.net/)和[Subtext](https://en.wikipedia.org/wiki/Subtext_%28software%29)。[dasblog](https://dasblog.codeplex.com/)很好，但请注意它是在 XML 上运行的；没有优点和缺点的数据库后端。

我强烈建议您远离[DotNetNuke](http://en.wikipedia.org/wiki/DotNetNuke)博客引擎。它的功能少，配置困难，使用起来也不是很直观。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T05:44:03.317

*[潜台词](http://subtextproject.com/)*是一个不错的选择。我还没有看到它提供标签云，但除此之外它工作得很好！

引用他们的网站：

> Subtext 是一个在 BSD 许可下许可的开源项目。它是流行的 .TEXT 博客平台的一个分支。

它作为 ASP.NET/C# 站点运行并连接到 SQL Server。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T05:39:48.897

我知道有两个：BlogEngine.NET 和 DasBlog

我正在使用 BlogEngine.NET。它很容易扩展，因为它使用提供者来提供会员资格等。它可以配置为在 SQL Server 上运行，但默认情况下它将使用 XML 运行。

DasBlog 也应该是一个很棒的博客引擎，虽然我从来没有真正玩过它。

两者都是开源的并且在 C# 中。

# java - 无法检索日期

> ID：151874
> 
> 赞同：0
> 
> 时间：2008-09-30T05:37:00.137
> 
> 标签：java, dynpro

我正在使用 web Dynpro java.. 我创建了一个无状态会话 bean，其中我创建了用于从我的字典表中插入和检索记录的业务方法。我的表有两个`java.sql.Date`类型的字段我创建的 Web 服务工作正常`insertRecords()`，但`showRecords()`我无法获取日期..

这是我应用的以下代码..

```
public WrapperClass[] showRecords() 
{
    ArrayList arr = new ArrayList();

            WrapperClass model;

            WrapperClass[] modelArr = null;

            try {
                InitialContext ctx = new InitialContext();
                DataSource ds = (DataSource)ctx.lookup("jdbc/SAPSR3DB");
                Connection conn = ds.getConnection();

                PreparedStatement stmt = conn.prepareStatement("select * from TMP_DIC");

                ResultSet rs = stmt.executeQuery();

                while(rs.next())
                {
                     model  = new WrapperClass();

                    model.setTitle(rs.getString("TITLE"));
                    model.setStatus(rs.getString("STATUS"));
                    model.setSt_date(rs.getDate("START_DATE"));
                    model.setEnd_date(rs.getDate("END_DATE"));

                    arr.add(model);
                    //arr.add(rs.getString(2));
                    //arr.add(rs.getString(3));
                }
                modelArr = new WrapperClass[arr.size()];
                for(int j=0;j<arr.size();j++)
                {

                    model = (WrapperClass)arr.get(j);
                    modelArr[j] = model;
                }
                stmt.close();
                conn.close();
            } catch (NamingException e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
            } catch (SQLException e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
            }

            arr.toArray(modelArr);
            return modelArr;
} 
```

任何人都可以帮忙..谢谢Ankita

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T11:30:34.047

您是否尝试过 getTimestamp() 而不是 getDate()？当您尝试将其作为日期获取时，您会遇到什么错误？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-03-24T15:25:20.260

我使用另一种方法。

除了 bean 之外，我还创建了服务，我在其中创建了包含用于操作 DB 表的查询的函数。

现在，在 Java Wb Dynpro 中我放了这样的东西：

```
try {
            ctx = new InitialContext();

            Object o = ctx
                    .lookup("sc.fiat.com/um~pers_app/LOCAL/UserServices/com.fiat.sc.um.pers.services.UserServicesLocal");
            userServices = (UserServicesLocal) o;

} catch (Exception e) {
            logger.traceThrowableT(Severity.ERROR, e.getMessage(), e);
            msgMgr.reportException(e);
        } 
```

在 wdDoInit 方法中。我也这样声明

```
private UserServicesLocal userServices; 
```

物体。

现在我将能够操纵我的数据库表调用服务类的方法......

# windows - saslpasswd2：Windows 上的一般故障

> ID：151900
> 
> 赞同：2
> 
> 时间：2008-09-30T05:48:59.997
> 
> 标签：windows, svn, sasl

尝试运行时出现一般故障：

```
saslpasswd2 username 
```

这是由 Collanet 的 Subversion 1.5.2 安装的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T05:51:11.663

我遇到的问题是 sasl 可执行文件正在尝试访问 sasldb 文件：

```
C:\CMU\sasldb2 
```

确保创建目录 C:\CMU

# sql - 制作双插入的最佳方法

> ID：151905
> 
> 赞同：4
> 
> 时间：2008-09-30T05:51:40.320
> 
> 标签：sql, database

在表 A 中插入信息并使用表 A 中的索引与表 B 相关的最佳方法是什么？

我尝试的“解决方案”是将信息插入表 A（具有自动生成的 ID）中，然后选择最后一个索引并将其插入表 B。这可能不是很有用，因为最后一个索引可能会在插入，因为另一个用户可以在表 A 中生成新索引

我在使用各种 DBMS postgreSQL、Informix、MySQL 和 MSSQL 时遇到过这个问题（感谢 lomaxx 的回答）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-30T05:53:53.403

如果您使用的是 MSSQL，您可以使用 SCOPE_IDENTITY 返回当前会话中插入的最后一个 ID。然后，您可以使用它插入表 B。

[MSDN 的这篇文章](http://msdn.microsoft.com/en-us/library/ms190315.aspx)给出了一个很好的例子来说明如何做到这一点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-30T05:54:28.660

这是顺序解决方案（对于 postgres），当然，您必须在存储过程或应用程序代码中执行此操作。

```
postgres=# create table foo(id serial primary key, text varchar);
NOTICE:  CREATE TABLE will create implicit sequence "foo_id_seq" for serial column "foo.id"
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "foo_pkey" for table "foo"
CREATE TABLE

postgres=# create table bar(id int references foo, text varchar);
CREATE TABLE
postgres=# select nextval('foo_id_seq');
 nextval
---------
       1
(1 row)

postgres=# insert into foo values (1,'a'); insert into bar values(1,'b');
INSERT 0 1
INSERT 0 1 
```

对于[MySQL](http://dev.mysql.com/doc/refman/5.0/en/getting-unique-id.html)，事务很重要，不要自己绊倒，以防您对多个插入使用相同的连接。

> 对于 LAST_INSERT_ID()，最近生成的 ID 在每个连接的基础上维护在服务器中。它不会被其他客户端更改。如果您使用非魔术值（即非 NULL 且非 0 的值）更新另一个 AUTO_INCREMENT 列，它甚至不会更改。从多个客户端同时使用 LAST_INSERT_ID() 和 AUTO_INCREMENT 列是完全有效的。每个客户端都将收到客户端执行的最后一条语句的最后插入 ID。

```
mysql> create table foo(id int primary key auto_increment, text varchar(10)) Engine=InnoDB;
Query OK, 0 rows affected (0.06 sec)

mysql> create table bar(id int references foo, text varchar(10)) Engine=InnoDB;
Query OK, 0 rows affected (0.01 sec)

mysql> begin;
Query OK, 0 rows affected (0.00 sec)

mysql> insert into foo(text) values ('x');
Query OK, 1 row affected (0.00 sec)

mysql> insert into bar values (last_insert_id(),'y');
Query OK, 1 row affected (0.00 sec)

mysql> commit;
Query OK, 0 rows affected (0.04 sec) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-30T06:04:00.710

另一种选择是创建一个序列并在插入表之前获取变量中的序列值并使用它来插入两个表。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-30T11:51:12.390

在 ORACLE 中，使用序列来保持 PK 值，并使用 RETURNING 子句

```
INSERT INTO table1 ( pk_table1, value1 ) 
   VALUES ( table1_seq.NEXTVAL, p_value1 ) RETURNING pk_table1 INTO l_table1_id;

INSERT INTO table2 ( pk_table2, pk_table1, value2 ) 
  VALUES ( table2_seq.NEXTVAL, l_table1_id, p_value2 ); 
```

最佳实践是在 Oracle 中使用 PACKAGES 来存储应用程序的所有 SQL / 数据操作层。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-30T06:17:13.237

对于 IBM Informix Dynamic Server (IDS)，它取决于您用于实现双插入的语言。如果它是服务器（SPL - 存储过程语言），并且如果您使用的是 SERIAL 列，那么您使用 DBINFO('sqlca.sqlerrd2') 来表示插入表 B 时添加到表 A 的序列值。如果您在客户端（ESQL/C、I4GL、JDBC、ODBC）中工作，您通过批准的接口（ESQL/C 中的 sqlca.sqlerrd[1]，I4GL 中的 sqlca.sqlerrd[2]）收集串行，然后传输它再次回来。

IDS 还支持序列，因此您可以使用该技术。

IDS 11.50 支持 SERIAL8 和 BIGSERIAL 以及 SERIAL（一个 4 字节整数）；每一个的详细接口略有不同，但基本原理是相同的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T07:38:52.403

如果您的表是 UUID 键控的，请生成 UUID 并在两个插入中使用它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T07:56:16.993

[Microsoft 知识库](http://support.microsoft.com/kb/815629/en-us)中描述了 Access 2000+ (Jet 4.0) 答案。基本上，您可以使用它`SELECT @@Identity`来检索在您的连接上生成的自动增量字段的值。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T08:28:07.370

另一个 Access 2000+ (Jet 4.0) 答案是创建一个 Jet 4.0 `VIEW`（在 Access 术语中：`SELECT`保存为 Query 对象的查询），`INNER JOIN`在`IDENTITY`(Autonumber) 列上有一个；连接列必须在 SELECT 子句和引用的表中公开。然后为所有没有`INSERT INTO`的列`VIEW`提供值。`NOT NULL``DEFAULT`

列`IDENTITY`值可以被省略，在这种情况下，引擎将像往常一样自动生成该值，或者提供并接受一个明确的值；如果另外提供了另一个表中的连接列的值（没有`IDENTITY`列的那个），那么它必须与该`IDENTITY`值相同，否则会发生错误；如果`IDENTITY`省略该值，则为连接列提供的任何值都将被忽略。请注意，`FOREIGN KEY`通常需要在此类表之间使用 a，但这不是此过程正常工作的先决条件。

快速示例（ANSI-92 查询模式 Jet 4.0 语法）：

```
CREATE TABLE Table1 
(
   key_col INTEGER IDENTITY NOT NULL PRIMARY KEY, 
   data_col_1 INTEGER NOT NULL
)
;
CREATE TABLE Table2
(
   key_col INTEGER NOT NULL, 
   data_col_2 INTEGER NOT NULL, 
   PRIMARY KEY (key_col, data_col_2)
)
;
CREATE VIEW View1
AS 
SELECT T1.key_col AS key_col_1, T2.key_col AS key_col_2, 
       T1.data_col_1, T2.data_col_2
  FROM Table2 AS T2
       INNER JOIN Table1 AS T1
          ON T1.key_col = T2.key_col
;
INSERT INTO View1 (data_col_1, data_col_2) 
VALUES (1, 2)
; 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T08:51:04.070

如果您使用的是 sql server 2005+，您还可以使用 OUTPUT 子句输出已更新、插入或删除的数据。它非常酷，完全适合您需要的东西。 [http://msdn.microsoft.com/en-us/library/ms177564.aspx](http://msdn.microsoft.com/en-us/library/ms177564.aspx)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-30T08:58:39.730

在 SQL Server 中，您使用 @@IDENTITY 字段，并将`INSERT`'s 包装在事务中。

```
DEFINE ... etc etc 

BEGIN TRANSACTION

INSERT INTO table1 ( value1 ) VALUES ( @p_value1 )
SET @pk_table1 = @@IDENTITY

INSERT INTO table2 ( pk_table1, value2 ) VALUES ( @pk_table1, @p_value2 )

COMMIT 
```

TSQL 中的最佳实践是在`@@IDENTITY`之后立即将值存储在变量中，`INSERT`以避免该值被未来的维护代码破坏。

使用存储过程也是最佳实践。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-28T20:50:10.910

如果它在 Informix 和 JSP 中，则有一个函数在插入后返回表的 Serial 字段。

```
import com.informix.jdbc.*;

cmd = "insert into serialTable(i) values (100)";
stmt.executeUpdate(cmd);
System.out.println(cmd+"...okay");
int serialValue = ((IfmxStatement)stmt).getSerial();
System.out.println("serial value: " + serialValue); 
```

[这是链接](http://publib.boulder.ibm.com/infocenter/idshelp/v111/index.jsp?topic=/com.ibm.jdbc_pg.doc/jdbc118.htm)

（出于某种原因，在我的工作计算机中，它用西班牙语描述了所有内容，可能是因为在墨西哥）

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-26T05:10:04.393

使用事务来避免这个问题：“这可能不是很有用，因为最后一个索引可能会在插入之间发生变化，因为另一个用户可以在表 A 中生成新索引。”

而且，在 PostgreSQL 中，你可以使用 'nextval' 和 'currval' 来完成你想做的事情：

```
BEGIN;

INSERT INTO products (prod_id, prod_name, description) VALUES (
    nextval('products_prod_id_seq')
    , 'a product'
    , 'a product description'
);

INSERT INTO prices (price_id, prod_id, price) VALUES (
    nextval('prices_price_id_seq')
    , currval('products_prod_id_seq')
    , 0.99
);

COMMIT; 
```

如果您还需要 DDL 片段，请告诉我。

# java - Java中的自动锁定 - 如何？

> ID：151917
> 
> 赞同：2
> 
> 时间：2008-09-30T05:58:22.690
> 
> 标签：java, synchronization, locking

离开作用域时释放资源（在这种情况下解锁 ReadWriteLock）的最佳方法是什么？如何涵盖所有可能的方式（返回、中断、异常等）？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-30T06:05:11.287

try/finally 块是最接近这种行为的方法：

```
Lock l = new Lock();
l.lock();  // Call the lock before calling try.
try {
    // Do some processing.
    // All code must go in here including break, return etc.
    return something;
} finally {
    l.unlock();
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T06:20:14.540

就像迈克所说，一个 finally 块应该是你的选择。请参阅[finally 块教程](http://java.sun.com/docs/books/tutorial/essential/exceptions/finally.html)，其中说明：

> finally 块**总是**在 try 块退出时执行。这样可以确保即使发生意外异常也会执行 finally 块。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-11-27T13:33:29.830

一个更好的方法是使用 try-with-resources 语句，它可以让你模仿 C++ 的[RAII 机制](https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)：

```
public class MutexTests {

    static class Autolock implements AutoCloseable {
        Autolock(ReentrantLock lock) {
            this.mLock = lock;
            mLock.lock();
        }

        @Override
        public void close() {
            mLock.unlock();
        }

        private final ReentrantLock mLock;
    }

    public static void main(String[] args) throws InterruptedException {
        final ReentrantLock lock = new ReentrantLock();

        try (Autolock alock = new Autolock(lock)) {
            // Whatever you need to do while you own the lock
        }
        // Here, you have already released the lock, regardless of exceptions

    }

} 
```

# c++ - 什么时候应该使用 __forceinline 而不是 inline？

> ID：151919
> 
> 赞同：40
> 
> 时间：2008-09-30T05:58:53.640
> 
> 标签：c++, visual-studio, inline-functions

Visual Studio 包括对 __forceinline 的支持。Microsoft Visual Studio 2005 文档指出：

> __forceinline 关键字覆盖了成本/收益分析，而是依赖于程序员的判断。

这就提出了一个问题：编译器的成本/收益分析什么时候出错了？而且，我怎么知道这是错的？

在什么情况下假设我在这个问题上比我的编译器更了解？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-09-30T06:03:03.927

只有当您的分析数据告诉您时，您才比编译器更清楚。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-10-26T20:56:35.280

我使用它的一个地方是许可证验证。

防止容易* 破解的一个重要因素是验证在多个地方而不是仅在一个地方获得许可，并且您不希望这些地方是同一个函数调用。

* * *

*）请不要在讨论中讨论一切都可以破解 - 我知道。此外，仅此一项并没有太大帮助。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-09-30T06:49:46.747

编译器根据静态代码分析做出决定，而如果您按照唐所说的那样进行分析，那么您正在执行的动态分析可能会更远。对特定代码段的调用次数通常很大程度上取决于使用它的上下文，例如数据。分析一组典型的用例就可以做到这一点。就个人而言，我通过在我的自动回归测试中启用分析来收集这些信息。除了强制内联，我还根据这些数据展开了循环，并进行了其他手动优化，效果很好。事后再次分析也是必要的，因为有时您的最大努力实际上会导致性能下降。同样，自动化使这变得不那么痛苦。

不过，根据我的经验，通常情况下，调整算法会比直接优化代码提供更好的结果。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-02T09:17:49.263

我为资源有限的设备开发软件已有 9 年左右的时间，我**唯一**`__forceinline`一次看到需要使用的是在一个紧密的循环中，其中相机驱动程序需要将像素数据从捕获缓冲区复制到设备屏幕。在那里我们可以清楚地看到特定函数调用的成本确实占用了叠加绘制性能。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-30T06:02:49.653

唯一可以确定的方法是衡量有无的性能。除非您正在编写高性能的关键代码，否则这通常是不必要的。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2018-10-07T09:39:05.243

对于 SIMD 代码。

SIMD 代码经常使用常量/幻数。在常规函数中，every`const __m128 c = _mm_setr_ps(1,2,3,4);`成为内存引用。

使用`__forceinline`，编译器可以加载一次并重用该值，除非您的代码耗尽了寄存器（通常为 16 个）。

CPU 缓存很棒，但寄存器仍然更快。

PS 一个人就获得了 12% 的性能提升`__forceinline`。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-06-06T18:03:03.067

当用于以下功能时，内联指令将完全没有用：

递归的，长的，由循环组成，

如果您想使用 __forceinline 强制执行此决定

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2013-02-01T07:12:11.187

实际上，即使使用 __forceinline 关键字。Visual C++ 有时会选择不内联代码。（来源：生成的汇编源代码。）

始终查看生成的汇编代码，其中速度很重要（例如需要在每一帧上运行紧密的内部循环）。

有时使用 #define 而不是 inline 可以解决问题。（当然，使用#define 会减少很多检查，因此仅在真正重要的时间和地点使用它）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-30T06:10:28.853

在几种情况下，编译器无法明确地确定内联函数是否合适或有益。内联可能涉及编译器不愿意做出的权衡，但您愿意（例如，代码膨胀）。

一般来说，现代编译器实际上非常擅长做出这个决定。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-01-25T18:43:22.987

当您知道要在一个地方多次调用该函数以进行复杂的计算时，使用 __forceinline 是一个好主意。例如，动画的矩阵乘法可能需要调用很多次，以至于对函数的调用将开始被您的分析器注意到。正如其他人所说，编译器无法真正知道这一点，尤其是在编译时代码执行未知的动态情况下。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-09-18T14:33:06.683

实际上，boost 已经加载了它。

例如

```
 BOOST_CONTAINER_FORCEINLINE flat_tree&  operator=(BOOST_RV_REF(flat_tree) x)
    BOOST_NOEXCEPT_IF( (allocator_traits_type::propagate_on_container_move_assignment::value ||
                        allocator_traits_type::is_always_equal::value) &&
                         boost::container::container_detail::is_nothrow_move_assignable<Compare>::value)
 {  m_data = boost::move(x.m_data); return *this;  }

 BOOST_CONTAINER_FORCEINLINE const value_compare &priv_value_comp() const
 { return static_cast<const value_compare &>(this->m_data); }

 BOOST_CONTAINER_FORCEINLINE value_compare &priv_value_comp()
 { return static_cast<value_compare &>(this->m_data); }

 BOOST_CONTAINER_FORCEINLINE const key_compare &priv_key_comp() const
 { return this->priv_value_comp().get_comp(); }

 BOOST_CONTAINER_FORCEINLINE key_compare &priv_key_comp()
 { return this->priv_value_comp().get_comp(); }

 public:
 // accessors:
 BOOST_CONTAINER_FORCEINLINE Compare key_comp() const
 { return this->m_data.get_comp(); }

 BOOST_CONTAINER_FORCEINLINE value_compare value_comp() const
 { return this->m_data; }

 BOOST_CONTAINER_FORCEINLINE allocator_type get_allocator() const
 { return this->m_data.m_vect.get_allocator(); }

 BOOST_CONTAINER_FORCEINLINE const stored_allocator_type &get_stored_allocator() const
 {  return this->m_data.m_vect.get_stored_allocator(); }

 BOOST_CONTAINER_FORCEINLINE stored_allocator_type &get_stored_allocator()
 {  return this->m_data.m_vect.get_stored_allocator(); }

 BOOST_CONTAINER_FORCEINLINE iterator begin()
 { return this->m_data.m_vect.begin(); }

 BOOST_CONTAINER_FORCEINLINE const_iterator begin() const
 { return this->cbegin(); }

 BOOST_CONTAINER_FORCEINLINE const_iterator cbegin() const
 { return this->m_data.m_vect.begin(); } 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-09-28T00:50:21.007

w**一个案例`noinline`**

我想提出一个不寻常的建议，并实际上`__noinline`在 MSVC 或`noinline`GCC 和 ICC 中的属性/编译指示中担保，作为在查看分析器热点时首先尝试`__forceinline`及其等价物的替代方案。YMMV，但是告诉编译器*永远不要*内联的内容比*总是*内联的内容要多得多（衡量改进）。它的侵入性也往往要小得多，并且在分析变化时可以产生更多可预测和可理解的热点。

*虽然通过告诉编译器什么不要*内联来尝试提高性能似乎非常违反直觉并且有些落后，但根据我的经验，我认为它与优化编译器的工作方式更加*协调*，并且对他们的代码的侵入性要小得多一代。要记住的一个很容易忘记的细节是：

> 内联 a`callee`通常会导致`caller`, 或 , 的调用者`caller`停止内联。

这就是强制内联对代码生成进行相当侵入性更改的原因，这可能会在您的分析会话中产生混乱的结果。我什至遇到过这样的情况，强制内联在多个地方重复使用的函数以非常令人困惑的方式完全重新洗牌了所有前十个热点，其中自采样率最高。有时，我觉得我在与优化器作斗争，使一件事在这里变得更快，只是为了在同样常见的用例中交换其他地方的减速，特别是在字节码解释等优化器的棘手情况下。我发现`noinline`一些方法更容易成功地用于消除热点，而无需在其他地方交换另一个热点。

> 如果我们可以在调用站点内联而不是确定是否对函数的每个调用都应该内联，那么内联函数的侵入性就会大大降低。不幸的是，除了 ICC 之外，我还没有找到很多支持这种功能的编译器。如果我们通过在调用站点内联而不是强制内联特定函数的每次调用来响应热点，这对我来说更有意义。由于缺乏大多数编译器的广泛支持，我在 `noinline`.

**优化`noinline`**

所以优化 with 的想法`noinline`仍然是为了同一个目标：帮助优化器内联我们最关键的功能。不同之处在于，我们不是试图通过强制内联它们来告诉编译器它们是什么，而是相反，通过强制阻止它们被内联来告诉编译器哪些函数绝对不是关键执行路径的一部分。我们专注于识别罕见的非关键路径，同时让编译器仍然可以自由地确定在关键路径中内联的内容。

假设您有一个执行一百万次迭代的循环，并且有一个调用的函数`baz`，即使它只有 5 行代码，平均每几千次迭代在该循环中很少调用一次，以响应非常不寻常的用户输入并且没有复杂的表达。您已经分析了此代码，分析器在反汇编中显示调用一个函数`foo`，然后调用该函数`baz`具有最大数量的样本，并且大量样本分布在调用指令周围。自然的诱惑可能是强制 inline `foo`。我建议改为尝试将结果标记`baz`为`noinline`并计时。通过这种方式，我设法使某些关键循环的执行速度提高了 3 倍。

分析生成的程序集，加速来自`foo`现在被内联的函数，因为不再`baz`将调用内联到其主体中。

[![在此处输入图像描述](https://i.stack.imgur.com/wsDyy.png)](https://i.stack.imgur.com/wsDyy.png)

我经常发现在这样的情况下，将类比标记为比强制内`baz`联`noinline`产生更大的改进`foo`。我不是计算机体系结构向导，无法准确理解原因，但在这种情况下查看分析器中的反汇编和样本分布，强制内联的结果`foo`是编译器仍在内联很少执行`baz`的顶部`foo`，使得`foo`通过仍然内联罕见情况的函数调用，比必要的更臃肿。`baz`通过简单地用标记`noinline`，我们允许`foo`在没有实际内联的情况下被内联`baz`。为什么内联会产生额外的代码`baz`以及减慢整体功能仍然不是我准确理解的；根据我的经验，到更远的代码路径的跳转指令似乎总是比更近的跳转花费更多的时间，但我不知道为什么（可能与跳转指令在更大的操作数上花费更多时间有关做指令缓存）。我可以肯定地说，`noinline`在这种情况下偏爱提供了卓越的性能来强制内联，并且在随后的分析会话中也没有这样的破坏性结果。

所以无论如何，我建议先`noinline`尝试一下，然后再强制内联。

**人类与优化器**

> 在什么情况下假设我在这个问题上比我的编译器更了解？

我会避免如此大胆地假设。至少我还不够好做那件事。如果有的话，多年来我已经了解到一个令人羞愧的事实，即一旦我检查和测量我用分析器尝试的东西，我的假设往往是错误的。我已经超越了这个阶段（几十年来让我的分析器成为我最好的朋友），以避免在黑暗中完全盲目地刺伤，只是为了面对卑微的失败并恢复我的改变，但在我最好的情况下，我仍然在做，在大多数，有根据的猜测。尽管如此，我总是比我的编译器更了解，希望我们大多数程序员总是比我们的编译器更了解这一点，我们的产品应该如何设计以及我们的客户最有可能如何使用它. 这至少让我们在理解编译器不具备的常见情​​况和罕见情况的代码分支方面有了一些优势（至少在没有 PGO 的情况下，我从来没有用 PGO 获得过最好的结果）。编译器不具备这种类型的运行时信息和对常见用户输入的预见性。正是当我将这些用户端知识和手头的分析器结合起来时，我才发现最大的改进是在这里和那里推动优化器教它内联什么，或者在我的情况下更常见的是什么从不内联。

# python - Python的机械化模块错误

> ID：151929
> 
> 赞同：6
> 
> 时间：2008-09-30T06:03:47.793
> 
> 标签：python, exception, urllib2, mechanize

我正在使用该`mechanize`模块从 Python 执行一些 Web 查询。我希望我的程序能够容错并优雅地处理各种错误（错误的 URL、403/404 响应）。但是，我在 mechanize 的文档中找不到它为各种错误引发的错误/异常。

我只是用它来称呼它：

```
 self.browser = mechanize.Browser()
    self.browser.addheaders = [('User-agent', browser_header)]

    self.browser.open(query_url)
    self.result_page = self.browser.response().read() 
```

我怎么知道这里可以抛出哪些错误/异常并处理它们？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-30T21:15:47.510

```
$ perl -0777 -ne'print qq($1) if /__all__ = \[(.*?)\]/s' __init__.py | grep Error 

'BrowserStateError',
'ContentTooShortError',
'FormNotFoundError',
'GopherError',
'HTTPDefaultErrorHandler',
'HTTPError',
'HTTPErrorProcessor',
'LinkNotFoundError',
'LoadError',
'ParseError',
'RobotExclusionError',
'URLError', 
```

或者：

```
>>> import mechanize
>>> filter(lambda s: "Error" in s, dir(mechanize))
['BrowserStateError', 'ContentTooShortError', 'FormNotFoundError', 'GopherError'
, 'HTTPDefaultErrorHandler', 'HTTPError', 'HTTPErrorProcessor', 'LinkNotFoundErr
or', 'LoadError', 'ParseError', 'RobotExclusionError', 'URLError'] 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-01-10T16:27:15.590

虽然这是很久以前发布的，但我认为仍然需要正确回答这个问题，因为它出现在谷歌的搜索结果中。

在我写这篇文章时，Python 265 中的 mechanize ( **version** = (0, 1, 11, None, None)) 会引发 urllib2.HTTPError ，因此可以通过捕获此异常来获得 http 状态，例如：

```
import urllib2
try:
...  br.open("http://www.example.org/invalid-page")
... except urllib2.HTTPError, e:
...  print e.code
... 
404 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T06:06:44.370

我在他们的文档中发现了这一点：

> 最后要注意的一点是，模块中有一些包罗万象的 except: 语句，它们用于处理意外的错误输入而不会使程序崩溃。如果发生这种情况，这是机械化中的一个错误，所以请把警告文本发给我。

所以我想他们不会提出任何例外。您还可以搜索 Exception 子类的源代码并查看它们的使用方式。

# c# - .NET 中的空数组是否使用任何空间？

> ID：151936
> 
> 赞同：26
> 
> 时间：2008-09-30T06:07:53.807
> 
> 标签：c#, .net, arrays

我有一些代码在其中返回一个对象数组。

这是一个简化的示例：

```
string[] GetTheStuff() {
    List<string> s = null;
    if( somePredicate() ) {
        s = new List<string>(); // imagine we load some data or something
    }
    return (s == null) ? 
        new string[0] :
        s.ToArray();
} 
```

问题是，它有多贵`new string[0]`？
我应该只返回 null 并让调用者接受 null 作为指示“未找到任何内容”的有效方式吗？

注意：这是在一个循环中调用的，它会运行数百次，所以这是我认为这种优化实际上并不“过早”的少数情况之一。

PS：即使它为时过早，我仍然想知道它是如何工作的:-)

### 更新：

最初，当我问它是否使用任何空间时，我是从“C/C++”的角度考虑的，有点像在 C 中，写入`char a[5];`将在堆栈上分配 5 个字节的空间，`char b[0];`并将分配 0 个字节。

我意识到这不适合 .NET 世界，但我很好奇这是否是编译器或 CLR 会检测和优化出来的东西，因为大小为零的不可调整大小的数组真的不应该（就我可以看到？）需要任何存储空间。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-09-30T06:16:23.193

即使它被称为“数百次”，我也会说这是一个过早的优化。如果结果作为空数组更清晰，请使用它。

现在给出实际答案：是的，一个空数组需要一些内存。它具有正常的对象开销（我相信 x86 上的 8 个字节）和 4 个字节的计数。我不知道除此之外是否还有什么，但它并不是完全免费的。（虽然它*非常*便宜......）

幸运的是，您可以在不影响 API 本身的情况下进行优化：拥有一个空数组的“常量”。如果您允许的话，我已经做了另一个小改动以使代码更清晰......

```
private static readonly string[] EmptyStringArray = new string[0];

string[] GetTheStuff() {
    if( somePredicate() ) {
        List<string> s = new List<string>(); 
        // imagine we load some data or something
        return s.ToArray();
    } else {
        return EmptyStringArray;
    }
} 
```

如果你发现自己经常需要这个，你甚至可以创建一个带有静态成员的泛型类来返回一个正确类型的空数组。.NET 泛型的工作方式使这变得微不足道：

```
public static class Arrays<T> {
    public static readonly Empty = new T[0];
} 
```

（当然，您可以将其包装在一个属性中。）

然后只需使用： Arrays<string>.Empty;

编辑：我刚刚记得[Eric Lippert 在 arrays 上的帖子](http://blogs.msdn.com/ericlippert/archive/2008/09/22/arrays-considered-somewhat-harmful.aspx)。您确定数组是最适合返回的类型吗？

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2015-05-22T20:09:40.203

即将发布的 .NET 4.6 版（2015 年晚些时候）包含一个返回长度为零[的静态方法](https://msdn.microsoft.com/en-us/library/dn906179.aspx)`string[]`：

```
Array.Empty<string>() 
```

我想如果多次调用它会返回相同的实例。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-30T06:13:23.137

声明的数组必须始终包含以下信息：

*   等级（维数）
*   要包含的类型
*   每个维度的长度

这很可能是微不足道的，但是对于更多的维度和更长的长度，*它将*对循环产生性能影响。

至于返回类型，我同意应该返回一个空数组而不是 null。

更多信息：[.NET 中的数组类型](http://msdn.microsoft.com/en-us/magazine/cc301755.aspx)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-30T07:53:45.347

是的，正如其他人所说，空数组占用了对象头和长度字段的几个字节。

但是，如果您担心性能，那么您会在此方法中关注错误的执行分支。我会更关心填充列表上的*ToArray*调用，这将导致内存分配等于其内部大小以及列表内容的内存副本。

如果您真的想提高性能，那么（如果可能）通过将返回类型设置为以下之一直接返回列表：`List<T>, IList<T>, ICollection<T>, IEnumerable<T>`取决于您需要的工具（请注意，在一般情况下，不太具体更好）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-30T06:10:35.873

我猜想一个空数组只使用分配对象指针本身所需的空间。

从内存中，API 指南说您应该始终从返回数组而不是返回 null 的方法返回一个空数组，所以无论如何我都会让您的代码保持原样。这样，调用者就知道他一定会得到一个数组（甚至是一个空数组），并且不需要在每次调用时检查 null。

编辑：关于返回空数组的链接：

[http://wesnerm.blogs.com/net_undocumented/2004/02/empty_arrays.html](http://wesnerm.blogs.com/net_undocumented/2004/02/empty_arrays.html)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-16T17:54:32.097

其他人很好地回答了你的问题。所以只是一个简单的点...

我会避免返回一个数组（除非你不能）。坚持使用 IEnumerable，然后您可以`Enumerable.Empty<T>()`从 LINQ API 中使用。显然微软已经为你优化了这个场景。

```
IEnumerable<string> GetTheStuff()
{
    List<string> s = null;
    if (somePredicate())
    {
        var stuff = new List<string>();
        // load data
        return stuff;
    }

    return Enumerable.Empty<string>();
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-30T06:18:32.423

这不是您问题的直接答案。

阅读为什么[数组被认为有些有害](http://blogs.msdn.com/ericlippert/archive/2008/09/22/arrays-considered-somewhat-harmful.aspx)。在这种情况下，我建议您返回一个 IList<string> 并稍微重构代码：

```
IList<string> GetTheStuff() {
    List<string> s = new List<string>();
    if( somePredicate() ) {
        // imagine we load some data or something
    }
    return s;
} 
```

通过这种方式，调用者不必关心空返回值。

* * *

**编辑**：如果返回的列表不可编辑，您可以将 List 包装在[ReadOnlyCollection](http://msdn.microsoft.com/en-us/library/ms132476.aspx)中。只需将最后一行更改为。我也会考虑这种最佳做法。

```
 return new ReadOnlyCollection(s); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-07-30T12:13:44.603

我知道这是一个老问题，但这是一个基本问题，我需要一个详细的答案。

所以我对此进行了探索并得到了结果：

在 .Net 中，当您创建一个数组（在此示例中我使用`int[]`）时，您需要**6 个字节**，然后再为您的数据分配任何内存。

考虑以下代码 [在**32 位**应用程序中！]：

```
int[] myArray = new int[0];
int[] myArray2 = new int[1];
char[] myArray3 = new char[0]; 
```

并查看内存：

```
myArray:  a8 1a 8f 70 00 00 00 00 00 00 00 00
myArray2: a8 1a 8f 70 01 00 00 00 00 00 00 00 00 00 00 00
myArray3: 50 06 8f 70 00 00 00 00 00 00 00 00 
```

* * *

## 让我们解释一下内存：

*   看起来前 2 个字节是某种元数据，您可以看到它在`int[]`和`char[]` **(** `a8 1a 8f 70` **vs** `50 06 8f 70`**)之间变化**
*   然后它将数组的大小保存在整数变量（小端）中。所以它是`00 00 00 00`为了`myArray`和`01 00 00 00`为了`myArray2`
*   **现在它是我们宝贵的数据**[我用**即时窗口**测试过]
*   之后我们看到一个常数 ( `00 00 00 00`)。我不知道它是什么意思。

* * *

> **现在我对零长度数组感觉好多了，我知道它是如何工作的** **=]**

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-30T06:15:43.663

如果我理解正确，将为字符串数组分配少量内存。无论如何，您的代码本质上都需要创建一个通用列表，那么为什么不直接返回呢？

[编辑]删除了返回空值的代码版本。在这种情况下建议不要返回空值的其他答案似乎是更好的建议[/EDIT]

```
List<string> GetTheStuff()
{
   List<string> s = new List<string();
   if (somePredicarte())
   {
      // more code
   }
   return s;
} 
```

# emacs - 如何控制 Emacs 制作备份文件的方式？

> ID：151945
> 
> 赞同：354
> 
> 时间：2008-09-30T06:15:08.750
> 
> 标签：emacs

Emacs 将备份文件放在`foo~`任何地方，我不喜欢记住删除它们。此外，如果我编辑的文件在文件系统的其他位置具有硬链接，那么当我完成编辑时，硬链接会指向备份，这会让人感到困惑和糟糕。我怎样才能消除这些备份文件，或者让它们放在同一个目录以外的地方？

* * *

## 回答 #1

> 赞同：564
> 
> 时间：2008-09-30T06:15:25.427

如果您曾经被 Emacs 备份文件保存过，那么您可能想要更多，而不是更少。它们与您正在编辑的文件位于同一目录中，这很烦人，但这很容易更改。您可以通过在您的 `.emacs`.

```
(setq backup-directory-alist `(("." . "~/.saves"))) 
```

有许多与 Emacs 如何创建备份文件相关的神秘细节。它应该重命名原始文件并写出编辑过的缓冲区吗？如果原件有链接怎么办？一般来说，最安全但最慢的选择是始终通过复制进行备份。

```
(setq backup-by-copying t) 
```

如果由于某种原因这太慢了，你也可以看看 `backup-by-copying-when-linked`.

由于您的备份现在都在自己的位置，您可能需要更多，而不是更少。查看这些变量的 Emacs 文档（带有`C-h v`）。

```
(setq delete-old-versions t
  kept-new-versions 6
  kept-old-versions 2
  version-control t) 
```

最后，如果您绝对不能有备份文件：

```
(setq make-backup-files nil) 
```

想到这我就恶心。

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2013-08-20T08:47:43.157

Emacs 备份/自动保存文件非常有用。但这些功能令人困惑。

**备份文件**

备份文件末尾有波浪号（`~`或`~9~`），应写入用户主目录。当`make-backup-files`文件第一次从缓冲区保存时，Emacs 会自动创建原始文件的备份。如果您正在编辑一个新文件，Emacs 将在您第二次保存该文件时创建一个备份。

无论您保存文件多少次，备份都保持不变。如果您杀死缓冲区然后再次访问该文件，或者下次启动新的 Emacs 会话时，将创建一个新的备份文件。新备份在重新打开后或在编辑会话开始时反映文件的内容。但是现有的备份永远不会再被触及。因此，我发现创建编号备份很有用（请参阅下面的配置）。

要显式创建备份，请使用带有前缀参数的`save-buffer`( )。`C-x C-s`

`diff-backup`并将`dired-diff-backup`文件与其备份进行比较，反之亦然。但是没有恢复备份文件的功能。例如，在 Windows 下，恢复备份文件

```
C:\Users\USERNAME\.emacs.d\backups\!drive_c!Users!USERNAME!.emacs.el.~7~ 
```

它必须手动复制为

```
C:\Users\USERNAME\.emacs.el 
```

**自动保存文件**

自动保存文件使用井号 ( `#`) 并应在项目目录中本地写入（与实际文件一起）。原因是自动保存文件只是 Emacs 创建的临时文件，直到再次保存文件（如匆忙服从）。

*   在用户按下`C-x C-s`( `save-buffer`) 保存文件之前，Emacs 会根据击键计数 ( `auto-save-interval`) 或您停止输入 ( `auto-save-timeout`) 时自动保存文件。
*   Emacs 还会在崩溃时自动保存，包括使用 shell 命令终止 Emacs 作业。

当用户保存文件时，自动保存的版本被删除。但是当用户退出文件而不保存时，Emacs 或 X 会话崩溃，自动保存的文件仍然存在。

使用`revert-buffer`或`recover-file`恢复自动保存文件。请注意，Emacs 会在名为*~/.emacs.d/auto-save-list*的文件中记录中断的会话以供以后恢复。该`recover-session`函数将使用此信息。

从自动保存的文件中恢复的首选方法是`M-x revert-buffer RET`. Emacs 将询问“缓冲区最近已自动保存。从自动保存文件恢复？” 或“从文件 FILENAME 恢复缓冲区？”。如果是后者，则没有自动保存文件。例如，因为您在键入另一个`auto-save-intervall`击键之前已经保存，在这种情况下，Emacs 已经删除了自动保存文件。

现在默认情况下禁用自动保存，因为当连接到慢速机器时它会减慢编辑速度，并且因为许多文件包含敏感数据。

**配置**

这是恕我直言效果最好的配置：

```
(defvar --backup-directory (concat user-emacs-directory "backups"))
(if (not (file-exists-p --backup-directory))
        (make-directory --backup-directory t))
(setq backup-directory-alist `(("." . ,--backup-directory)))
(setq make-backup-files t               ; backup of a file the first time it is saved.
      backup-by-copying t               ; don't clobber symlinks
      version-control t                 ; version numbers for backup files
      delete-old-versions t             ; delete excess backup files silently
      delete-by-moving-to-trash t
      kept-old-versions 6               ; oldest versions to keep when a new numbered backup is made (default: 2)
      kept-new-versions 9               ; newest versions to keep when a new numbered backup is made (default: 2)
      auto-save-default t               ; auto-save every buffer that visits a file
      auto-save-timeout 20              ; number of seconds idle time before auto-save (default: 30)
      auto-save-interval 200            ; number of keystrokes between auto-saves (default: 300)
      ) 
```

**敏感数据**

另一个问题是您不想让 Emacs 传播包含敏感数据的文件副本。在每个文件的基础上使用[此模式。](http://anirudhsasikumar.net/blog/2005.01.21.html)由于这是一种次要模式，因此出于我的目的，我将其重命名为`sensitive-minor-mode`.

*要为所有.vcf*和*.gpg*文件启用它，请在您的 .emacs 中使用以下内容：

```
(setq auto-mode-alist
      (append
       (list
        '("\\.\\(vcf\\|gpg\\)$" . sensitive-minor-mode)
        )
       auto-mode-alist)) 
```

或者，要仅保护某些文件，例如某些*.txt*文件，请使用如下行

```
// -*-mode:asciidoc; mode:sensitive-minor; fill-column:132-*- 
```

在文件中。

* * *

## 回答 #3

> 赞同：71
> 
> 时间：2013-12-29T11:22:45.143

[接受](https://stackoverflow.com/a/151946/470844)的答案很好，但可以通过在***每次*****保存时额外备份 和备份*版本化*文件****来大大改进。**

 **[首先，接受的答案](https://stackoverflow.com/a/151946/470844)中描述的基本设置：

```
(setq version-control t     ;; Use version numbers for backups.
      kept-new-versions 10  ;; Number of newest versions to keep.
      kept-old-versions 0   ;; Number of oldest versions to keep.
      delete-old-versions t ;; Don't ask to delete excess backup versions.
      backup-by-copying t)  ;; Copy all files, don't rename them. 
```

接下来，还要备份版本化文件，Emacs 默认不这样做（你不会在每次保存时都提交，对吧？）：

```
(setq vc-make-backup-files t) 
```

最后，对每次保存进行备份，而不仅仅是第一次。我们进行两种备份：

1.  每会话备份：在每个 Emacs 会话中*第一次*保存缓冲区时执行一次。这些模拟 Emac 的默认备份行为。

2.  每次保存备份：*每次*保存一次。默认情况下，Emacs 不会这样做，但如果您让 Emacs 长时间运行，它会非常有用。

备份放在不同的[地方](http://www.emacswiki.org/emacs/BackupDirectory)，如果备份目录不存在，Emacs 会自动创建它们：

```
;; Default and per-save backups go here:
(setq backup-directory-alist '(("" . "~/.emacs.d/backup/per-save")))

(defun force-backup-of-buffer ()
  ;; Make a special "per session" backup at the first save of each
  ;; emacs session.
  (when (not buffer-backed-up)
    ;; Override the default parameters for per-session backups.
    (let ((backup-directory-alist '(("" . "~/.emacs.d/backup/per-session")))
          (kept-new-versions 3))
      (backup-buffer)))
  ;; Make a "per save" backup on each save.  The first save results in
  ;; both a per-session and a per-save backup, to keep the numbering
  ;; of per-save backups consistent.
  (let ((buffer-backed-up nil))
    (backup-buffer)))

(add-hook 'before-save-hook  'force-backup-of-buffer) 
```

在我之前提交大约三个小时后，我开始对这个话题产生了浓厚的兴趣，`$<`而不是 `$@`在我的 :P`Makefile`

以上基于[我大量编辑的 Emacs Wiki 页面](http://www.emacswiki.org/emacs/ForceBackups)。

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2008-09-30T08:14:27.683

另一种配置备份选项的方法是通过自定义界面。进入：

```
M-x customize-group 
```

然后在`Customize group:`提示符处输入`backup`.

如果您滚动到缓冲区的底部，您将看到**Backup Directory Alist**。单击**Show Value**并将列表的第一个条目设置如下：

```
Regexp matching filename: .*
Backup directory name: /path/to/your/backup/dir 
```

或者，您可以关闭备份我的设置**将备份文件**设置为`off`.

如果您不希望 Emacs 自动编辑您的`.emacs`文件，您需要[设置一个自定义文件](http://www.gnu.org/software/emacs/manual/html_node/emacs/Saving-Customizations.html)。

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2009-01-21T21:24:48.493

您可以通过以下方式完全禁用它们

```
(setq make-backup-files nil) 
```

# c# - 什么是本机代码？

> ID：151952
> 
> 赞同：17
> 
> 时间：2008-09-30T06:17:19.040
> 
> 标签：c#, asp.net, visual-studio-2008

项目的 Web 部分（在 VS2008 中的项目属性下）有一个调试器列表：ASP.NET、本机代码、SQL Server。什么是本机代码？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-30T06:18:25.387

本机代码是由 CPU 直接执行的机器代码。这与由 .NET 虚拟机解释的 .NET 字节码形成对比。

一个不错的 MSDN 热门：[调试本机代码](https://docs.microsoft.com/en-us/visualstudio/debugger/debugging-native-code?view=vs-2017)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-30T06:19:10.580

本机代码不在公共语言运行时 (CLR) 上运行。一个示例是非托管 C++ 应用程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-05-20T19:12:25.503

本机代码本质上是内存中的数据，计算机中的中央处理芯片可以直接读取和执行。想象一下 CPU 吸入数据，并且数据翻转在它通过时切换，关闭和打开事物：

```
 [  CPU  ] ==================================== [  RAM  ]
     ^^^^^
     |   |

     LOAD _memoryAddress12, D1   ; tells the CPU to get data from slot 12
                                 ; in RAM, and put it in register D1 inside the CPU

     ^^^^^
     |   |

     ADD D1, 24                  ; tells the CPU to do an internal calculation

     ^^^^^
     |   |

     STORE R0, _memoryAddress23 ; tells the CPU to put the answer into slot 23 in ram 
```

你可以想像打孔卡之类的指令，或者那些音乐钢琴卷的东西，当它们进入时它们会在 CPU 中翻转开关。重要的部分是它在硬件中：它**实际上是**在电线/电路上发生的，几乎以速度的光。但是有*很多*开关可以翻转。因此，进入机器的每一条“本机指令”都会以机器的“时钟速度”执行（在现代 PC 上大约每秒 25 亿次）。实际上，它有点复杂，有些指令需要更长的时间，有些是同时完成的，等等。

现在，相比之下，虚拟机运行非本机代码（通常称为字节码），实际上是在**虚拟**的假机器上运行。就语言而言，虚拟机是运行另一个程序的程序，而不是直接在硬件中运行的程序。因此，在上述程序加载数据、添加数据并将结果存储在三个本机指令中的地方，虚拟程序可能会做更多类似这样的事情（免责声明：这是生锈的伪汇编代码）：

```
 load _firstInstruction, D1
   if_equal D1, 12
   jump _itsAnAddInstructionHandleIt
   if_equal D1, 13
   jump _itsASubstractInstructionHandleIt
   if_equal D1, 14
   jump _itsAMultiplyInstructionHandleIt
   if_equal D1, 15
   jump _itsADivideInstructionHandleIt
   if_equal D1, 16
   jump _itsALoadInstructionHandleIt
   ...

_itsALoadInstructionHandleIt:
   load D1, D2
   add 4, D2
   load D2, D3
   return 
```

等等。这只是以非本机方式处理**上述**本机指令之一的示例：大约 10 条指令（取决于实现）而不是第一条、单条本机指令，并且我遗漏了重要的细节，例如拆箱数据！关键是，在平均大约 20-30 条指令之后，您将完成与上面本地代码中的一行相同的事情。

现在。话虽如此，GOOD 虚拟机有一个 JIT，它可以在执行时或在执行它们之前将其中的一些转换为本机代码。但是有很多东西，比如盒装类型，不能直接转换，因为虚拟机的全部意义在于它不能以低级、电路友好的方式工作，而本地代码会. 虚拟机更容易编程，但速度要慢得多。

虚拟机的另一个巨大缺点是它们通常具有很大的内存开销，如果您想同时在内存中编写数百万条数据项，它们就毫无用处。在这种情况下，虽然 VM 旨在使代码更高级、更易读，但它可能会迫使你做比本地代码更底层、更糟糕的事情，因为好处开始变成缺点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-10-23T11:12:47.207

对于初学者来说，本机代码只是为在特定程序集上运行而量身定制的中间语言。它类似于其他 HLL 中的目标代码。

# arrays - 用于调用和比较 2D 数据阵列的良好数据库设计？

> ID：151957
> 
> 赞同：2
> 
> 时间：2008-09-30T06:18:31.613
> 
> 标签：arrays, database-design

我希望在数据库中存储 900x100 元素的二维数组。阵列的有效召回和比较很重要。我可以使用具有 [A, x, y, A(x,y)] 之类的架构的表，这样单个数组就会破坏 90,000 条记录。这似乎是一个存储数组的~ok~表设计，并且可以有效地调用单个元素，但调用整个数组的效率很低，并且会导致非常低效的数组比较。

我应该以这种方式离开表格设计并在代码中构建和比较我的数组吗？或者有没有更好的方法来构造表，以便我可以使用仅数据库操作获得有效的数组比较？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T06:34:51.417

如果数据类型允许，将其以串联格式存储，并在取消串联后在内存中进行比较。数据库操作将快得多，内存中的操作也将比数据库检索更快。

谁知道呢，你甚至可以在不去连接的情况下比较它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T06:26:55.133

900 x 100 元素实际上非常小（即使这些元素是巨大的 1K 东西，也只有 90 MB）。您不能在需要时在内存中进行比较并以某种序列化格式存储在磁盘上吗？

将二维数组存储在数据库中是没有意义的，尤其是当它是不可变数据时。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-13T14:30:34.510

当我以前在地震行业工作时，我们过去只是将我们的数组（通常是几千个元素的 1d）转储到二进制文件中。该数据库将仅用于本质上是元数据（位置、索引等）。这会更快，但它也允许数据在必要时解耦：在生产中这很常见，几千个元素听起来并不多，但典型的数据集很容易达到数百 GB - 这是 1990 年代，所以我们必须与磁带解耦。

# sql-server-2005 - 使用 SQL Server/Reporting Services 进行日期转换

> ID：151959
> 
> 赞同：1
> 
> 时间：2008-09-30T06:19:07.803
> 
> 标签：sql-server-2005, reporting-services

我在数据库月份（数字）和年份（数字）中有 2 个字段，我想将它们组合在一个报告中，该报表组合这 2 个字段并使用 MMM-YYYY 格式化它们。例如 7-2008 变为 Jul-2008。我怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-30T07:41:13.583

`DateSerial`是正确的答案：

[http://msdn.microsoft.com/en-us/library/bbx05d0c(VS.80).aspx](http://msdn.microsoft.com/en-us/library/bbx05d0c(VS.80).aspx)

SSRS 使用 VB.Net 进行表达式。使用表达式编辑器浏览可用的函数，其中之一是 DateSerial。

要格式化日期，请在文本框上设置 Format 属性。您应该能够使用“MMM-yyyy”作为格式。

**更新**：正如彼得指出的那样，您可以根据需要指定参数。如果您只关心年份和月份，只需提供`1`一天的值。由于您正在格式化没有日期组件的值，因此使用什么值实际上并不重要（只要它创建一个有效的日期）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-30T06:20:52.760

=DateSerial(年、月、日)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T11:03:30.553

布兰农的回答是正确的，只是他忽略了您仅指定当天的文字这一事实。1 到 28 之间的任何值都可以。

# c# - Asp.Net MVC：如何获取当前控制器/视图的虚拟 url？

> ID：151963
> 
> 赞同：20
> 
> 时间：2008-09-30T06:20:43.540
> 
> 标签：c#, asp.net-mvc, routing

是否可以获取与控制器操作或视图关联的路由/虚拟 url？我看到 Preview 4 添加了 LinkBuilder.BuildUrlFromExpression 助手，但如果你想在 master 上使用它并不是很有用，因为控制器类型可以不同。任何想法表示赞赏。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2011-01-25T04:44:33.980

我总是尝试实现满足项目要求的最简单的解决方案。正如恩斯坦所说，“让事情尽可能简单，但不要简单。” 试试这个。

```
<%: Request.Path %> 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-03-28T01:41:51.370

这对我有用：

`<%= this.Url.RouteUrl(this.ViewContext.RouteData.Values) %>`

它返回当前的 Url；`/Home/About`

也许有一种更简单的方法来返回实际的路由字符串？

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-08-12T19:51:10.600

您可以从 ViewContext.RouteData 中获取该数据。以下是有关如何访问（和使用）该信息的一些示例：

/// 这些被添加到我的 viewmasterpage、viewpage 和 viewusercontrol 基类中：

```
public bool IsController(string controller)
{
    if (ViewContext.RouteData.Values["controller"] != null)
    {
        return ViewContext.RouteData.Values["controller"].ToString().Equals(controller, StringComparison.OrdinalIgnoreCase);
    }
    return false;
}
public bool IsAction(string action)
{
    if (ViewContext.RouteData.Values["action"] != null)
    {
        return ViewContext.RouteData.Values["action"].ToString().Equals(action, StringComparison.OrdinalIgnoreCase);
    }
    return false;
}
public bool IsAction(string action, string controller)
{
    return IsController(controller) && IsAction(action);
} 
```

/// 我添加到 UrlHelper 类的一些扩展方法。

```
public static class UrlHelperExtensions
{
    /// <summary>
    /// Determines if the current view equals the specified action
    /// </summary>
    /// <typeparam name="TController">The type of the controller.</typeparam>
    /// <param name="helper">Url Helper</param>
    /// <param name="action">The action to check.</param>
    /// <returns>
    ///     <c>true</c> if the specified action is the current view; otherwise, <c>false</c>.
    /// </returns>
    public static bool IsAction<TController>(this UrlHelper helper, LambdaExpression action) where TController : Controller
    {
        MethodCallExpression call = action.Body as MethodCallExpression;
        if (call == null)
        {
            throw new ArgumentException("Expression must be a method call", "action");
        }

        return (call.Method.Name.Equals(helper.ViewContext.ViewName, StringComparison.OrdinalIgnoreCase) &&
                typeof(TController) == helper.ViewContext.Controller.GetType());
    }

    /// <summary>
    /// Determines if the current view equals the specified action
    /// </summary>
    /// <param name="helper">Url Helper</param>
    /// <param name="actionName">Name of the action.</param>
    /// <returns>
    ///     <c>true</c> if the specified action is the current view; otherwise, <c>false</c>.
    /// </returns>
    public static bool IsAction(this UrlHelper helper, string actionName)
    {
        if (String.IsNullOrEmpty(actionName))
        {
            throw new ArgumentException("Please specify the name of the action", "actionName");
        }
        string controllerName = helper.ViewContext.RouteData.GetRequiredString("controller");
        return IsAction(helper, actionName, controllerName);
    }

    /// <summary>
    /// Determines if the current view equals the specified action
    /// </summary>
    /// <param name="helper">Url Helper</param>
    /// <param name="actionName">Name of the action.</param>
    /// <param name="controllerName">Name of the controller.</param>
    /// <returns>
    ///     <c>true</c> if the specified action is the current view; otherwise, <c>false</c>.
    /// </returns>
    public static bool IsAction(this UrlHelper helper, string actionName, string controllerName)
    {
        if (String.IsNullOrEmpty(actionName))
        {
            throw new ArgumentException("Please specify the name of the action", "actionName");
        }
        if (String.IsNullOrEmpty(controllerName))
        {
            throw new ArgumentException("Please specify the name of the controller", "controllerName");
        }

        if (!controllerName.EndsWith("Controller", StringComparison.OrdinalIgnoreCase))
        {
            controllerName = controllerName + "Controller";
        }

        bool isOnView = helper.ViewContext.ViewName.SafeEquals(actionName, StringComparison.OrdinalIgnoreCase);
        return isOnView && helper.ViewContext.Controller.GetType().Name.Equals(controllerName, StringComparison.OrdinalIgnoreCase);
    }

    /// <summary>
    /// Determines if the current request is on the specified controller
    /// </summary>
    /// <param name="helper">The helper.</param>
    /// <param name="controllerName">Name of the controller.</param>
    /// <returns>
    ///     <c>true</c> if the current view is on the specified controller; otherwise, <c>false</c>.
    /// </returns>
    public static bool IsController(this UrlHelper helper, string controllerName)
    {
        if (String.IsNullOrEmpty(controllerName))
        {
            throw new ArgumentException("Please specify the name of the controller", "controllerName");
        }

        if (!controllerName.EndsWith("Controller", StringComparison.OrdinalIgnoreCase))
        {
            controllerName = controllerName + "Controller";
        }

        return helper.ViewContext.Controller.GetType().Name.Equals(controllerName, StringComparison.OrdinalIgnoreCase);
    }

    /// <summary>
    /// Determines if the current request is on the specified controller
    /// </summary>
    /// <typeparam name="TController">The type of the controller.</typeparam>
    /// <param name="helper">The helper.</param>
    /// <returns>
    ///     <c>true</c> if the current view is on the specified controller; otherwise, <c>false</c>.
    /// </returns>
    public static bool IsController<TController>(this UrlHelper helper) where TController : Controller
    {
        return (typeof(TController) == helper.ViewContext.Controller.GetType());
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-30T14:13:26.650

您可以使用 <%= Url.Action(action, controller, values) %> 从母版页中构建 URL。

您这样做是为了突出显示当前页面的标签或其他内容吗？

如果是这样，您可以从视图中使用 ViewContext 并获取您需要的值。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-28T22:21:33.587

我写[了一个帮助类](http://biasecurities.com/blog/2009/helper-to-access-route-parameters/)，允许我访问路由参数。使用此帮助器，您可以获取控制器、操作以及传递给操作的所有参数。

# visual-studio-2008 - 为什么远程调试时没有加载符号？

> ID：151966
> 
> 赞同：54
> 
> 时间：2008-09-30T06:21:38.750
> 
> 标签：visual-studio-2008, remote-debugging

我想使用远程调试。我要调试的程序在机器 b 上运行。Visual Studio 在机器 a 上运行。

在机器 b 上，我有一个包含以下文件的文件夹：

*   msvcr72.dll
*   msvsmon.exe
*   NatDbgDE.dll
*   NatDbgDEUI.dll
*   NatDbgEE.dll
*   NatDbgEEUI.dll

如果您认为某些文件丢失了，您能否描述一下它们通常的位置？

在下一步中`msvsmon.exe`，我在机器 b 上启动了我的程序。在机器 a 上，我启动了 Visual Studio 2008 和编写程序的解决方案。然后我选择“调试 - 附加到进程”。我选择了“远程传输（仅本机，没有身份验证）”。我使用了正确的 IP 作为限定符并采用了正确的进程（program.exe）。过了一会儿，弹出窗口中出现以下消息：

> program.exe 中 0x7c812a7b 处未处理的异常：0xE0434F4D：0xe0434f4d

我可以继续或中断；继续时，异常一次又一次地发生。所以我按下了break，出现了以下消息：

> 没有为任何调用堆栈帧加载符号。无法显示源代码。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-30T06:23:03.257

确保将随程序集生成的 .PDB 文件复制到远程计算机上的同一文件夹中。这将允许调试器拾取调试符号。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2011-07-13T12:26:55.820

*   在 Visual Studio 2010 的“工具”菜单上，选择“选项”。
*   在“选项”对话框中，打开“调试”节点，然后单击“常规”。
*   如果需要，选中显示所有设置并找到**启用仅我的代码** （仅限托管）
*   **取消选中它**并单击确定

在您可以附加远程进程之后

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-07-17T17:17:47.853

1.  在您的开发机器上添加一个指向 .pdb 文件位置的共享文件夹
2.  在远程机器上设置一个环境变量`_NT_SYMBOL_PATH`，指向你的开发机器上的共享文件夹

远程调试器现在将在您的开发机器上搜索符号。无需为每个构建复制它们。

[在此处](http://www.microsoft.com/uk/msdn/nuggets/nugget/313/Visual-Studio-2008-Remote-Debugging-with-MSVSMONEXE.aspx)查看 MS 视频。

开始观看 8-9 分钟。他演示了如何设置远程调试器以从开发机器上的驱动器共享加载符号。

祝你好运！

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-30T07:21:10.137

如果您不将 .PDB 文件放入已调试代码所在**的同一目录**中，则 .NET 中的远程调试将不起作用。

如果VS还是找不到调试的源码，说明调试的代码和VS工程源码**不是同一个版本**。解决方案是重建和重新部署项目。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-30T06:34:27.067

0xE0434F4D 是来自 CLR（即托管代码）的异常。您需要使用身份验证进行远程调试并选择调试托管代码。或者，可以使用一些调试器扩展来提取托管异常信息，但这有点困难。

参考：

[如果坏了就是...](http://blogs.msdn.com/tess/archive/2006/04/27/584927.aspx)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-10-14T04:34:45.837

1800 INFORMATION 是对的，您必须使用 Windows 身份验证进行远程调试才能调试托管代码，否则您将无法加载托管程序集的符号。让它与身份验证一起工作非常棘手，因为它需要两台机器上的本地帐户具有相同的密码等。这个问题和每个人的答案对于让它发挥作用非常有用。

[Visual Studio (VS2008) 中的远程调试，Windows 窗体应用程序](https://stackoverflow.com/questions/396101/remote-debugging-in-visual-studio-vs2008-windows-forms-application)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-12-12T21:02:44.907

虽然上述答案是正确的，但我遇到了这样的情况：使用正在调试的程序集构建的 PDB 在远程位置就位，并且没有被拾取。如果您使用的是 TFS 或其他支持发布调试符号的构建机制，我建议您这样做。然后在 Visual Studio 选项>调试>符号中，您可以将该位置添加到符号服务器选项中，以便在发现它们匹配时加载这些符号。

这使我能够在我编写的任何正在运行的东西附近进行调试，即使它是一个动态调用的程序集（当只使用程序集发布符号时，我无法终生工作）。利用这个非常方便的功能！

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-05-18T06:24:13.870

我有同样的问题。[在msdn 论坛](http://social.msdn.microsoft.com/Forums/en-US/vbide/thread/5ba1d641-214b-451a-949c-d08ddf030aa6)上找到了答案，我将在此处复制/粘贴正确答案：

> 确保您使用的是正确版本的 msvsmon.exe！！！！就是这样！我在远程调试 C# 应用程序时遇到了同样的问题。我使用的是 x64 msvsmon.exe，因为服务器运行的是 64 位 Windows Server 2008，但应用程序是为 x86 编写的，所以我必须运行 x86 版本的 msvsmon.exe 才能摆脱这个恼人的错误。不需要其他任何东西。只需运行与您的应用程序的目标体系结构相对应的 msvsmon.exe 版本 ^_^

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-12-27T17:49:34.093

**我在使用自定义构建配置**时也遇到了这个问题。（*开发而不是调试*）

为了纠正这个问题，我修改了 Project Properties-->Build-->Output-->Advanced 设置并确保 Output-->Debug Info 设置为**full**或**pdb-only**。默认**发布**配置通常设置为**none**。

![](https://i.stack.imgur.com/lUI8t.png)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-02-14T15:01:16.253

我可以通过转到项目属性、编译选项卡并将构建输出路径设置到我的远程计算机来完成这项工作，例如 \myserver\myshare\myappdir

在调试选项卡中，我选中了使用远程机器并将其设置为 myserver

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-07-11T16:31:58.343

转到**Tools->Options->Debugging->Symbols**并添加可执行文件的 .pdb 文件的路径。我本地机器上的路径运行良好。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-04-24T09:39:17.650

根据文档，对于托管（我尝试使用 Visual Studio 2012 在远程计算机上附加到托管 Windows 服务（针对 .net 4.5 构建）），符号应该**位于远程**计算机上。

所以，我只是在远程机器上保留符号（确保它们与远程机器上的应用程序的模块/程序集匹配），共享它并通过本地系统的符号设置（运行 vs 的地方）引用它。

注意：服务和符号不必与使用 2k12 + .net 4.5 windows 服务为我工作的目录位于同一目录中。

**详情：**

[http://msdn.microsoft.com/en-us/library/bt727f1t(v=vs.100).aspx](http://msdn.microsoft.com/en-us/library/bt727f1t%28v=vs.100%29.aspx)

**摘自链接：**

定位符号 (.pdb) 文件

* * *

符号文件包含已编译可执行文件的调试信息。要调试的应用程序的符号文件必须是编译应用程序可执行文件时创建的文件。符号文件也必须位于调试器可以找到它们的位置。

• 本机应用程序的符号文件必须位于 Visual Studio 主机上。

•<strong>托管应用程序的符号文件必须位于远程计算机上。

• 混合（托管和本机）应用程序的符号文件必须位于 Visual Studio 主机和远程计算机上。

问候！

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-01-22T13:21:08.000

我遇到了这个问题，上述解决方案并没有为我解决这个问题。就我而言，我的 VS2010 解决方案中有很多项目。我试图远程调试的项目**没有**在我的 VS2010 解决方案中设置为启动项目，因为我的 make 脚本不太正确。

我在我试图调试和选择的解决方案中右键单击项目`Set as StartUp Project`，然后我的符号正确加载并且我的断点被命中。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-02-21T07:33:20.110

我在远程调试时遇到了同样的问题，在 VS 2008 上通过以下步骤解决了：

1.  您将本地 pdb 文件与二进制文件一起复制
2.  运行与构建应用程序相同版本的 msvmon，如果您的应用程序是为 x86 架构构建的，则需要运行 x86 版本的 msvmon，即使您在 x64 机器上运行它也是如此。当您尝试运行时它会发出警告，但它应该运行。

# php - 我什么时候应该使用 'self' 而不是 '$this'？

> ID：151969
> 
> 赞同：2152
> 
> 时间：2008-09-30T06:23:06.343
> 
> 标签：php, class, oop, scope

`self`在 PHP 5 中，使用和 和有什么区别`$this`？

什么时候合适？

* * *

## 回答 #1

> 赞同：1871
> 
> 时间：2008-09-30T06:29:25.627

# 简答

> 用于`$this`引用当前对象。用于`self`引用当前类。换句话说， `$this->member`用于非静态成员，`self::$member`用于静态成员。

# 完整答案

下面是一个**正确**使用`$this`和`self`用于非静态和静态成员变量的示例：

```
<?php
class X {
    private $non_static_member = 1;
    private static $static_member = 2;

    function __construct() {
        echo $this->non_static_member . ' '
           . self::$static_member;
    }
}

new X();
?> 
```

以下是非静态和静态成员变量的**不正确**用法示例：`$this``self`

```
<?php
class X {
    private $non_static_member = 1;
    private static $static_member = 2;

    function __construct() {
        echo self::$non_static_member . ' '
           . $this->static_member;
    }
}

new X();
?> 
```

下面是一个带有for 成员函数的**多态性示例：**`$this`

```
<?php
class X {
    function foo() {
        echo 'X::foo()';
    }

    function bar() {
        $this->foo();
    }
}

class Y extends X {
    function foo() {
        echo 'Y::foo()';
    }
}

$x = new Y();
$x->bar();
?> 
```

下面是一个使用for 成员函数来**抑制多态行为的例子：**`self`

```
<?php
class X {
    function foo() {
        echo 'X::foo()';
    }

    function bar() {
        self::foo();
    }
}

class Y extends X {
    function foo() {
        echo 'Y::foo()';
    }
}

$x = new Y();
$x->bar();
?> 
```

> 这个想法是`$this->foo()`调用`foo()`当前对象的确切类型的成员函数。如果对象是 of `type X`，它会调用`X::foo()`. 如果对象是 of `type Y`，则调用`Y::foo()`. 但是 self::foo()`X::foo()`总是被调用。

来自[http://www.phpbuilder.com/board/showthread.php?t=10354489](http://www.phpbuilder.com/board/showthread.php?t=10354489)：

通过[http://board.phpbuilder.com/member.php?145249-laserlight](http://board.phpbuilder.com/member.php?145249-laserlight)

* * *

## 回答 #2

> 赞同：760
> 
> 时间：2009-07-27T18:00:42.863

关键字 self不仅仅指“当前类”，至少不是以将您限制为静态成员的方式**。**在非静态成员的上下文中，`self`还提供了一种绕过当前对象的 vtable（[参见关于 vtable 的 wiki ）的方法。](https://en.wikipedia.org/wiki/Virtual_method_table)就像你可以使用`parent::methodName()`调用父版本的函数一样，你也可以调用`self::methodName()`调用当前类实现的方法。

```
class Person {
    private $name;

    public function __construct($name) {
        $this->name = $name;
    }

    public function getName() {
        return $this->name;
    }

    public function getTitle() {
        return $this->getName()." the person";
    }

    public function sayHello() {
        echo "Hello, I'm ".$this->getTitle()."<br/>";
    }

    public function sayGoodbye() {
        echo "Goodbye from ".self::getTitle()."<br/>";
    }
}

class Geek extends Person {
    public function __construct($name) {
        parent::__construct($name);
    }

    public function getTitle() {
        return $this->getName()." the geek";
    }
}

$geekObj = new Geek("Ludwig");
$geekObj->sayHello();
$geekObj->sayGoodbye(); 
```

这将输出：

> 你好，我是极客
> 路德维希再见路德维希这个人

`sayHello()`使用`$this`指针，因此调用 vtable 来调用`Geek::getTitle()`. `sayGoodbye()`uses `self::getTitle()`，所以 vtable 没有被使用，`Person::getTitle()`而是被调用。在这两种情况下，我们都在处理实例化对象的方法，并且可以访问`$this`被调用函数中的指针。

* * *

## 回答 #3

> 赞同：483
> 
> 时间：2011-07-24T15:08:22.287

***不要使用*** *`self::`. 使用`static::`**

self:: 还有一个方面值得一提。烦人的是，**`self::`指的是定义时的范围，而不是执行时的范围**。考虑这个具有两种方法的简单类：

```
class Person
{

    public static function status()
    {
        self::getStatus();
    }

    protected static function getStatus()
    {
           echo "Person is alive";
    }

} 
```

如果我们打电话`Person::status()`，我们将看到 "Person is alive" 。现在考虑当我们创建一个继承自这个的类时会发生什么：

```
class Deceased extends Person
{

    protected static function getStatus()
    {
           echo "Person is deceased";
    }

} 
```

调用`Deceased::status()`我们希望看到“Person is dead”。但是，我们看到“Person is alive”，因为作用域包含定义调用时的原始方法定义`self::getStatus()`。

PHP 5.3 有一个解决方案。解析运算符实现了“**`static::`**后期静态绑定”，这是一种奇特的说法，它被绑定到所调用的类的范围内。将行更改`status()`为`static::getStatus()`，结果是您所期望的。在旧版本的 PHP 中，您必须找到一个组合来执行此操作。

请参阅[PHP 文档](http://php.net/manual/en/language.oop5.late-static-bindings.php)

因此，要回答未按要求回答的问题...

`$this->`指的是当前对象（类的一个实例），而`static::`指的是一个类。

* * *

## 回答 #4

> 赞同：263
> 
> 时间：2013-06-10T15:21:28.410

当我们谈论`self`vs时，要真正理解我们在谈论什么`$this`，我们需要在概念和实践层面上深入研究正在发生的事情。我真的不觉得任何答案都能恰当地做到这一点，所以这是我的尝试。

让我们从什么是*类*和*对象*开始。

# 概念上的类和对象

那么，什么**是**类*？*很多人将其定义为对象的*蓝图*或*模板*。事实上，您可以[在此处阅读更多关于 PHP 中的类](https://stackoverflow.com/questions/2206387/what-is-a-class-in-php/2206835#2206835)。在某种程度上，这就是它的真实情况。我们来看一个类：

```
class Person {
    public $name = 'my name';
    public function sayHello() {
        echo "Hello";
    }
} 
```

如您所知，该类上有一个名为的属性`$name`和一个名为 的方法（函数）`sayHello()`。

需要注意的是，*该类*是一个静态结构，这一点*非常重要。*这意味着 class ，一旦定义，在你看到的任何地方都是一样的。*`Person`*

 *另一方面，对象是所谓的类的*实例*。这意味着我们采用类的“蓝图”，并使用它来制作动态副本。该副本现在专门与它存储的变量相关联。因此，对实例的任何更改都是该*实例*的本地更改。

```
$bob = new Person;
$adam = new Person;
$bob->name = 'Bob';
echo $adam->name; // "my name" 
```

我们使用操作符创建一个类的新*实例*`new`。

因此，我们说一个类是一个全局结构，一个对象是一个局部结构。不用担心那个有趣的`->`语法，我们稍后会详细介绍。

我们应该讨论的另一件事是，我们可以*检查*一个实例是否是`instanceof`一个特定的类：如果实例是使用该类创建的，`$bob instanceof Person`它返回一个布尔值，*或者*是.`$bob``Person`*`Person`*

 *# 定义状态

因此，让我们深入了解一个类实际包含的内容。一个类包含 5 种类型的“事物”：

1.  *属性*- 将这些视为每个实例将包含的变量。

    ```
    class Foo {
        public $bar = 1;
    } 
    ```

2.  *静态属性*- 将这些视为在类级别共享的变量。这意味着它们永远不会被每个实例复制。

    ```
    class Foo {
        public static $bar = 1;
    } 
    ```

3.  *方法*- 这些是每个实例将包含的函数（并对实例进行操作）。

    ```
    class Foo {
        public function bar() {}
    } 
    ```

4.  *静态方法*- 这些是在整个类中共享的函数。它们**不对**实例进行操作，而是仅对静态属性进行操作。

    ```
    class Foo {
        public static function bar() {}
    } 
    ```

5.  *常量*- 类解析常量。这里不再深入，但为了完整性而添加：

    ```
    class Foo {
        const BAR = 1;
    } 
    ```

所以基本上，我们使用关于*静态*的“提示”将信息存储在类和对象容器上，这些“提示”标识信息是共享的（因此是静态的）还是不共享的（因此是动态的）。

# 状态和方法

在方法内部，对象的实例由`$this`变量表示。该对象的当前状态在那里，并且改变（更改）任何属性将导致对该实例（但不是其他实例）的更改。

如果静态调用方法，则`$this`变量*未定义*。这是因为没有与静态调用关联的实例。

这里有趣的是如何进行静态调用。那么让我们来谈谈我们如何访问状态：

# 访问状态

所以现在我们已经存储了那个状态，我们需要访问它。这可能会有点棘手（或多于一点），所以让我们将其分为两个观点：从实例/类外部（例如从普通函数调用或从全局范围），以及在实例**内部**/class（来自对象的方法内）。

## 从实例/类外部

从实例/类的外部来看，我们的规则非常简单且可预测。我们有两个运算符，每个运算符都会立即告诉我们是在处理实例还是静态类：

*   `->`- *object-operator* - 当我们访问一个实例时总是使用它。

    ```
    $bob = new Person;
    echo $bob->name; 
    ```

    重要的是要注意调用`Person->foo`没有意义（因为`Person`是一个类，而不是一个实例）。因此，这是一个解析错误。

*   `::`- *scope-resolution-operator* - 这始终用于访问 Class 静态属性或方法。

    ```
    echo Foo::bar() 
    ```

    此外，我们可以以相同的方式调用对象的静态方法：

    ```
    echo $foo::bar() 
    ```

    *非常*重要的是要注意，当我们**从外部**执行此操作时，对象的实例对方法是隐藏的`bar()`。这意味着它与运行完全相同：

    ```
    $class = get_class($foo);
    $class::bar(); 
    ```

因此，`$this`在静态调用中没有定义。

## 从实例/类内部

这里的情况发生了一些变化。使用相同的运算符，但它们的含义变得非常模糊。

*对象操作符* `->`仍用于调用对象的实例状态。

```
class Foo {
    public $a = 1;
    public function bar() {
        return $this->a;
    }
} 
```

使用 object-operator:调用（的实例）`bar()`上的方法将导致实例的版本为.`$foo``Foo``$foo->bar()``$a`

这就是我们所期望的。

运算符的含义`::`虽然发生了变化。这取决于调用当前函数的上下文：

*   在静态上下文中

    在静态上下文中，使用 using 进行的任何调用`::`也将是静态的。让我们看一个例子：

    ```
    class Foo {
        public function bar() {
            return Foo::baz();
        }
        public function baz() {
            return isset($this);
        }
    } 
    ```

    调用`Foo::bar()`将`baz()`静态调用该方法，因此`$this`不会**被**填充。值得注意的是，在最近的 PHP (5.3+) 版本中，这将触发`E_STRICT`错误，因为我们正在静态调用非静态方法。

*   在实例上下文中

    另一方面，在实例上下文中，使用 using`::`进行的调用取决于调用的接收者（我们正在调用的方法）。如果方法定义为`static`，那么它将使用静态调用。如果不是，它将转发实例信息。

    因此，查看上面的代码，调用`$foo->bar()`将返回`true`，因为“静态”调用发生在实例上下文中。

有道理？没想到。这很令人困惑。

# 快捷关键字

因为使用类名将所有内容联系在一起是相当肮脏的，所以 PHP 提供了 3 个基本的“快捷方式”关键字来使范围解析更容易。

*   `self`- 这是指当前的类名。所以在类`self::baz()`中是一样的（它上面的任何方法）。`Foo::baz()``Foo`

*   `parent`- 这是指当前类的父类。

*   `static`- 这是指被调用的类。由于继承，子类可以覆盖方法和静态属性。因此，使用`static`而不是类名来调用它们可以让我们解析调用的来源，而不是当前级别。

# 例子

理解这一点的最简单方法是开始查看一些示例。让我们选择一个类：

```
class Person {
    public static $number = 0;
    public $id = 0;
    public function __construct() {
        self::$number++;
        $this->id = self::$number;
    }
    public $name = "";
    public function getName() {
        return $this->name;
    }
    public function getId() {
        return $this->id;
    }
}

class Child extends Person {
    public $age = 0;
    public function __construct($age) {
        $this->age = $age;
        parent::__construct();
    }
    public function getName() {
        return 'child: ' . parent::getName();
    }
} 
```

现在，我们也在关注继承。暂时忽略这是一个糟糕的对象模型，但让我们看看当我们玩这个时会发生什么：

```
$bob = new Person;
$bob->name = "Bob";
$adam = new Person;
$adam->name = "Adam";
$billy = new Child;
$billy->name = "Billy";
var_dump($bob->getId()); // 1
var_dump($adam->getId()); // 2
var_dump($billy->getId()); // 3 
```

因此，ID 计数器在实例和子类之间共享（因为我们正在使用`self`它来访问它。如果我们使用`static`，我们可以在子类中覆盖它）。

```
var_dump($bob->getName()); // Bob
var_dump($adam->getName()); // Adam
var_dump($billy->getName()); // child: Billy 
```

请注意，我们每次都在执行`Person::getName()` *实例方法。*但是我们`parent::getName()`在其中一种情况（子情况）中使用 来做到这一点。这就是使这种方法强大的原因。

# 警告 #1

请注意，调用上下文决定是否使用实例。所以：

```
class Foo {
    public function isFoo() {
        return $this instanceof Foo;
    }
} 
```

并非**总是**如此。

```
class Bar {
    public function doSomething() {
        return Foo::isFoo();
    }
}
$b = new Bar;
var_dump($b->doSomething()); // bool(false) 
```

现在这里*真的很*奇怪。我们调用了一个不同的类，但是`$this`传递给`Foo::isFoo()`方法的是`$bar`.

这可能会导致各种错误和概念上的 WTF-ery。所以我强烈建议避免`::`在实例方法中使用运算符，除了这三个虚拟“快捷”关键字（`static`、、`self`和`parent`）之外的任何东西。

# 警告#2

请注意，每个人都共享静态方法和属性。这使得它们基本上是全局变量。与全局变量相同的问题。因此，除非您对真正的全局性感到满意，否则我会非常犹豫将信息存储在静态方法/属性中。

# 警告#3

通常，您会希望通过使用`static`而不是`self`. 但请注意，它们不是一回事，所以说“总是使用`static`而不是`self`真的短视。相反，停下来想想你想要打的电话，想想你是否希望子类能够覆盖*静态解析*称呼。

# TL/DR

太糟糕了，回去读一读。它可能太长了，但它就是那么长，因为这是一个复杂的话题

# TL/DR #2

好的。简而言之，`self`用于引用*类中的当前类名*，其中 as`$this`指的是当前对象*实例*。请注意，这`self`是一个复制/粘贴快捷方式。你可以安全地用你的类名替换它，它会正常工作。但是`$this`是一个无法提前确定的动态变量（甚至可能不是您的班级）。

# TL/DR #3

如果使用了对象运算符 ( `->`)，那么您*总是*知道您正在处理一个实例。如果使用范围解析操作符 ( `::`)，您需要有关上下文的更多信息（我们是否已经在对象上下文中？我们是否在对象之外？等等）。

* * *

## 回答 #5

> 赞同：122
> 
> 时间：2008-09-30T07:26:16.410

`self`(not $self) 指的是类的*类型*，而`$this`指的是类的当前*实例*。 `self`用于静态成员函数，以允许您访问静态成员变量。`$this`在非静态成员函数中使用，并且是对调用成员函数的类的实例的引用。

因为`this`是一个对象，所以你可以像这样使用它：`$this->member`

因为`self`不是对象，所以基本上是自动引用当前类的类型。你像这样使用它：`self::member`

* * *

## 回答 #6

> 赞同：99
> 
> 时间：2008-10-22T17:52:00.153

`$this->`用于引用类的变量（成员变量）或方法的特定实例。

```
Example: 
$derek = new Person(); 
```

$derek 现在是 Person 的一个特定实例。每个 Person 都有一个 first_name 和一个 last_name，但是 $derek 有一个特定的 first_name 和 last_name (Derek Martin)。在 $derek 实例中，我们可以将它们称为 $this->first_name 和 $this->last_name

ClassName:: 用于引用该类型的类，以及它的静态变量、静态方法。如果有帮助，您可以在脑海中将“静态”一词替换为“共享”。因为它们是共享的，所以它们不能引用 $this，它引用特定的实例（非共享）。静态变量（即静态 $db_connection）可以在一类对象的所有实例之间共享。例如，所有数据库对象共享一个连接（静态 $connection）。

**静态变量示例：** 假设我们有一个具有单个成员变量的数据库类：static $num_connections; 现在，把它放在构造函数中：

```
function __construct()
{
    if(!isset $num_connections || $num_connections==null)
    {
        $num_connections=0;
    }
    else
    {
        $num_connections++;
    }
} 
```

就像对象有构造函数一样，它们也有析构函数，它们在对象死亡或未设置时执行：

```
function __destruct()
{
    $num_connections--;
} 
```

每次我们创建一个新实例时，它都会将我们的连接计数器增加一个。每次我们销毁或停止使用实例时，它都会将连接计数器减一。通过这种方式，我们可以监控我们使用的数据库对象的实例数量：

```
echo DB::num_connections; 
```

因为 $num_connections 是静态的（共享的），它将反映活动数据库对象的总数。您可能已经看到这种技术用于在数据库类的所有实例之间共享数据库连接。这样做是因为创建数据库连接需要很长时间，所以最好只创建一个并共享它（这称为单例模式）。

静态方法（即 public static View::format_phone_number($digits)）可以在不首先实例化其中一个对象的情况下使用（即它们在内部不引用 $this）。

**静态方法示例：**

```
public static function prettyName($first_name, $last_name)
{
    echo ucfirst($first_name).' '.ucfirst($last_name);
}

echo Person::prettyName($derek->first_name, $derek->last_name); 
```

如您所见，公共静态函数 prettyName 对对象一无所知。它只是使用您传入的参数，就像不属于对象的普通函数一样。那么，如果我们不能将它作为对象的一部分，为什么还要麻烦呢？

1.  首先，将函数附加到对象可以帮助您保持事物井井有条，因此您知道在哪里可以找到它们。
2.  其次，它可以防止命名冲突。在一个大项目中，您可能有两个开发人员创建 getName() 函数。如果一个创建 ClassName1::getName()，另一个创建 ClassName2::getName()，则完全没有问题。没有冲突。耶静态方法！

**SELF::** 如果您在具有要引用的静态方法的对象*之外进行编码，则必须使用对象的名称调用它 View::format_phone_number($phone_number);* 如果您在具有您想要引用的静态方法的对象*内部进行编码，您**可以*使用对象的名称 View::format_phone_number($pn)，或者您可以使用 self::format_phone_number($pn) 快捷方式

静态变量也是如此： **示例：** View::templates_path 与 self::templates_path

在 DB 类中，如果我们引用某个其他对象的静态方法，我们将使用该对象的名称： **示例：** Session::getUsersOnline();

但是如果 DB 类想要引用它自己的静态变量，它只会说 self: **Example:** self::connection;

希望这有助于解决问题:)

* * *

## 回答 #7

> 赞同：31
> 
> 时间：2013-05-10T12:00:31.160

从[这篇博文](http://www.programmerinterview.com/index.php/php-questions/php-self-vs-this/)：

> *   `self`指当前类
> *   `self`可用于调用静态函数和引用静态成员变量
> *   `self`可以在静态函数中使用
> *   `self`也可以通过绕过 vtable 来关闭多态行为
> *   `$this`指当前对象
> *   `$this`可用于调用静态函数
> *   `$this`不应该用来调用静态成员变量。改为使用`self`。
> *   `$this`不能在静态函数内部使用

* * *

## 回答 #8

> 赞同：27
> 
> 时间：2014-12-29T13:20:20.600

在 PHP 中，您使用 self 关键字来访问静态属性和方法。

问题是您可以`$this->method()`用`self::method()`任何地方替换，无论是否`method()`声明为静态。那么你应该使用哪一个呢？

考虑这段代码：

```
class ParentClass {
    function test() {
        self::who();    // will output 'parent'
        $this->who();   // will output 'child'
    }

    function who() {
        echo 'parent';
    }
}

class ChildClass extends ParentClass {
    function who() {
        echo 'child';
    }
}

$obj = new ChildClass();
$obj->test(); 
```

在此示例中，`self::who()`将始终输出“父级”，而`$this->who()`将取决于对象具有的类。

现在我们可以看到 self 指的是调用它的类，而`$this`指**的是当前对象**的类。

所以，你应该只在不可用时使用 self `$this`，或者当你不想让后代类覆盖当前方法时。

* * *

## 回答 #9

> 赞同：22
> 
> 时间：2013-05-08T06:58:59.743

在类定义中，`$this`指的是当前对象，而`self`指的是当前类。

有必要使用 来引用类元素`self`，并使用 来引用对象元素`$this`。

```
self::STAT // refer to a constant value
self::$stat // static variable
$this->stat // refer to an object variable 
```

* * *

## 回答 #10

> 赞同：21
> 
> 时间：2011-12-06T11:26:22.880

> 下面是对非静态和静态成员变量正确使用 $this 和 self 的示例：

```
<?php
class X {
    private $non_static_member = 1;
    private static $static_member = 2;

    function __construct() {
        echo $this->non_static_member . ' '
           . self::$static_member;
    }
}

new X();
?> 
```

* * *

## 回答 #11

> 赞同：20
> 
> 时间：2008-09-30T06:29:17.843

根据*[Static Keyword](http://www.php.net/manual/en/language.oop5.static.php)*，没有任何`$self`. 只有`$this`, 用于引用类的当前实例（对象），而`self`, 可用于引用类的静态成员。对象实例和类之间的区别在这里发挥作用。

* * *

## 回答 #12

> 赞同：20
> 
> 时间：2013-03-22T15:24:23.317

*   对象指针指向`$this`当前对象。
*   类值`static`是指当前对象。
*   类值`self`指的是定义它的确切类。
*   类值`parent`指的是定义它的确切类的父级。

请参阅以下显示重载的示例。

```
<?php

class A {

    public static function newStaticClass()
    {
        return new static;
    }

    public static function newSelfClass()
    {
        return new self;
    }

    public function newThisClass()
    {
        return new $this;
    }
}

class B extends A
{
    public function newParentClass()
    {
        return new parent;
    }
}

$b = new B;

var_dump($b::newStaticClass()); // B
var_dump($b::newSelfClass()); // A because self belongs to "A"
var_dump($b->newThisClass()); // B
var_dump($b->newParentClass()); // A

class C extends B
{
    public static function newSelfClass()
    {
        return new self;
    }
}

$c = new C;

var_dump($c::newStaticClass()); // C
var_dump($c::newSelfClass()); // C because self now points to "C" class
var_dump($c->newThisClass()); // C
var_dump($b->newParentClass()); // A because parent was defined *way back* in class "B" 
```

大多数时候你想引用当前类，这就是你使用`static`or的原因`$this`。但是，有时您*需要* `self`，因为您想要原始类，而不管它扩展了什么。（非常，很少）

* * *

## 回答 #13

> 赞同：20
> 
> 时间：2016-01-01T06:36:43.480

`self`引用当前类（在其中调用它），

`$this`指当前对象。您可以使用静态而不是自我。

请参阅示例：

```
class ParentClass {
    function test() {
        self::which();    // Outputs 'parent'
        $this->which();   // Outputs 'child'
    }

    function which() {
        echo 'parent';
    }
}

class ChildClass extends ParentClass {
    function which() {
        echo 'child';
    }
}

$obj = new ChildClass();
$obj->test(); 
```

输出：

```
 parent
 child 
```

* * *

## 回答 #14

> 赞同：17
> 
> 时间：2009-05-18T19:42:36.210

我相信问题不在于你是否可以通过调用来调用类的静态成员`ClassName::staticMember`。`self::classmember`问题是使用和之间有什么区别`$this->classmember`。

例如，以下两个示例都可以正常工作，无论您使用`self::`还是`$this->`

```
class Person{
    private $name;
    private $address;

    public function __construct($new_name,$new_address){
        $this->name = $new_name;
        $this->address = $new_address;
    }
}

class Person{
    private $name;
    private $address;
    public function __construct($new_name,$new_address){
        self::$name = $new_name;
        self::$address = $new_address;
    }
} 
```

* * *

## 回答 #15

> 赞同：14
> 
> 时间：2015-05-31T07:09:31.523

这是一个小基准（repl.it 上的[7.2.24](https://repl.it/repls/FewUnacceptableObservatory)）：

```
 Speed (in seconds)  Percentage
$this->     0.91760206222534    100
self::      1.0047659873962     109.49909865716
static::    0.98066782951355    106.87288857386 
```

4 000 000 次运行的结果。结论：没关系。这是我使用的代码：

```
<?php

class Foo
{
  public function calling_this() { $this->called(); }
  public function calling_self() { self::called(); }
  public function calling_static() { static::called(); }
  public static function called() {}
}

$foo = new Foo();
$n = 4000000;
$times = [];

// warmup
for ($i = 0; $i < $n; $i++) { $foo->calling_this(); }
for ($i = 0; $i < $n; $i++) { $foo->calling_self(); }
for ($i = 0; $i < $n; $i++) { $foo->calling_static(); }

$start = microtime(true);
for ($i = 0; $i < $n; $i++) { $foo->calling_this(); }
$times["this"] = microtime(true)-$start;

$start = microtime(true);
for ($i = 0; $i < $n; $i++) { $foo->calling_self(); }
$times["self"] = microtime(true)-$start;

$start = microtime(true);
for ($i = 0; $i < $n; $i++) { $foo->calling_static(); }
$times["static"] = microtime(true)-$start;

$min = min($times);
echo $times["this"] . "\t" . ($times["this"] / $min)*100 . "\n";
echo $times["self"] . "\t" . ($times["self"] / $min)*100 . "\n";
echo $times["static"] . "\t" . ($times["static"] / $min)*100 . "\n"; 
```

* * *

## 回答 #16

> 赞同：13
> 
> 时间：2013-03-22T15:13:36.330

当`self`与`::`运算符一起使用时，它指的是当前类，这可以在静态和非静态上下文中完成。`$this`指对象本身。此外，使用`$this`调用静态方法（但不引用字段）是完全合法的。

* * *

## 回答 #17

> 赞同：11
> 
> 时间：2018-05-19T15:23:49.373

我遇到了同样的问题，简单的答案是：

*   `$this`需要类的实例
*   `self::`没有

每当您使用**静态方法**或**静态属性**并且想要在没有实例化类的对象的情况下调用它们时，您需要使用`self:`来调用它们，因为`$this`总是需要创建一个对象。

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2014-09-15T06:36:28.857

`$this`引用当前类对象，并`self`引用当前类（非对象）。类是对象的蓝图。所以你定义了一个类，但是你构造了对象。

所以换句话说，使用`self for static`and `this for none-static members or methods`。

同样在子/父场景中，`self / parent`主要用于标识子类和父类的成员和方法。

* * *

## 回答 #19

> 赞同：7
> 
> 时间：2014-09-29T19:28:12.300

另外，由于`$this::`尚未讨论。

仅供参考，从 PHP 5.3 开始，在处理实例化对象以获取当前范围值时，与 using`static::`不同，可以`$this::`像这样使用。

[http://ideone.com/7etRHy](http://ideone.com/7etRHy)

```
class Foo
{
    const NAME = 'Foo';

    //Always Foo::NAME (Foo) due to self
    protected static $staticName = self::NAME;

    public function __construct()
    {
        echo $this::NAME;
    }

    public function getStaticName()
    {
       echo $this::$staticName;
    }
}

class Bar extends Foo
{
    const NAME = 'FooBar';

    /**
     * override getStaticName to output Bar::NAME
     */
    public function getStaticName()
    {
        $this::$staticName = $this::NAME;
        parent::getStaticName();
    }
}

$foo = new Foo; //outputs Foo
$bar = new Bar; //outputs FooBar
$foo->getStaticName(); //outputs Foo
$bar->getStaticName(); //outputs FooBar
$foo->getStaticName(); //outputs FooBar 
```

使用上面的代码不是常见的或推荐的做法，只是为了说明它的用法，并且更像是一个“你知道吗？” 参考原始海报的问题。

它也代表了`$object::CONSTANT`例如的用法，`echo $foo::NAME;`而不是`$this::NAME;`

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2013-04-10T15:13:03.877

如果`self`您想在不创建该类的对象/实例的情况下调用类的方法，从而节省[RAM](http://en.wikipedia.org/wiki/Random-access_memory)（有时为此目的使用 self），请使用此选项。换句话说，它实际上是在静态调用一个方法。用于`this`对象透视。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2016-02-02T20:51:51.027

案例1：使用`self`可用于类常量

```
类A类{
     常量 FIXED_NUMBER = 4;
     自我::POUNDS_TO_KILOGRAMS
}

```

如果要在类之外调用它，请使用`classA::POUNDS_TO_KILOGRAMS`访问常量

案例 2：对于静态属性

```
类 C {
     公共函数 __construct() {
     自我::$_counter++; $this->num = self::$_counter;
   }
}

```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2020-04-16T19:19:56.397

**self::**用于当前类的关键字，基本上用于访问静态成员、方法和常量。但是在**$this**的情况下，您不能调用静态成员、方法和函数。

您可以在另一个类中使用**self::**关键字并访问静态成员、方法和常量。当它从父类扩展时，在**$this**关键字的情况下也是如此。当从父类扩展时，您可以访问另一个类中的非静态成员、方法和函数。

下面给出的代码是**self::**和**$this**关键字的示例。只需将代码复制并粘贴到代码文件中即可查看输出。

```
class cars{
    var $doors = 4;
    static $car_wheel = 4;

    public function car_features(){
        echo $this->doors . " Doors <br>";
        echo self::$car_wheel . " Wheels <br>";
    }
}

class spec extends cars{
    function car_spec(){
        print(self::$car_wheel . " Doors <br>");
        print($this->doors . " Wheels <br>");
    }
}

/********Parent class output*********/

$car = new cars;
print_r($car->car_features());

echo "------------------------<br>";

/********Extend class from another class output**********/

$car_spec_show = new spec;

print($car_spec_show->car_spec()); 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2015-12-07T10:21:24.357

根据 php.net，在此上下文中有三个特殊关键字`self`：`parent`和`static`. 它们用于从类定义内部访问属性或方法。

`$this`另一方面，用于调用任何类的实例和方法，只要该类是可访问的。

# c++ - 您经常关注的 C++ 博客？

> ID：151974
> 
> 赞同：183
> 
> 时间：2008-09-30T06:28:53.817
> 
> 标签：c++, blogs

您关注的所有 C++ 博客是什么？

***请为一篇文章添加一个网址。***

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2008-09-30T06:30:23.567

[萨特磨坊](http://herbsutter.wordpress.com/)

* * *

## 回答 #2

> 赞同：70
> 
> 时间：2008-10-02T00:08:45.277

[https://stackoverflow.com/questions/tagged/c++](https://stackoverflow.com/questions/tagged/c++) ;-)

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2008-09-30T06:33:13.340

[Visual C++ 团队博客](http://blogs.msdn.com/vcblog/)

特别是 Stephan T. Lavavej（STL 的！）的帖子。

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2008-09-30T07:59:44.303

[C++ 汤！](http://www.cplusplus-soup.com/)C++ 提示、技巧、评论和评论，作者：Dean Michael Berris。

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2008-09-30T07:12:32.403

[C++ 真理](http://cpptruths.blogspot.com/)

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2008-09-30T07:40:07.423

[DrDobb 的 C++ 博客](http://www.drdobbs.com/cpp)

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2009-04-08T05:51:19.830

[旧事新事](http://blogs.msdn.com/oldnewthing/)

* * *

## 回答 #8

> 赞同：19
> 
> 时间：2009-08-27T18:13:46.830

[C++下一步](http://cpp-next.com/)

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2008-09-30T10:25:57.883

[The C++ Source](http://www.artima.com/cppsource)

* * *

## 回答 #10

> 赞同：16
> 
> 时间：2008-09-30T09:33:50.223

[2 游戏的力量](http://en.wikipedia.org/wiki/Cybersquatting)

更新：这些文章现在托管在[Games From Within 上](http://gamesfromwithin.com/?paged=7)。

* * *

## 回答 #11

> 赞同：15
> 
> 时间：2008-10-06T18:47:59.533

[来自 Aristeia](http://scottmeyers.blogspot.com/)以前[Scott Meyers 邮件列表的观点](http://tech.groups.yahoo.com/group/scott_meyers/)

* * *

## 回答 #12

> 赞同：14
> 
> 时间：2008-12-20T11:08:55.680

[C++ 常见问题解答精简版](http://www.parashift.com/c++-faq-lite/)

* * *

## 回答 #13

> 赞同：12
> 
> 时间：2008-09-30T07:15:44.143

[C++ 中的异步思考](http://think-async.blogspot.com/)

* * *

## 回答 #14

> 赞同：11
> 
> 时间：2009-03-19T12:40:00.417

[Bartosz Milewski 的编程咖啡馆：并发、多核、语言设计、D、C++](http://bartoszmilewski.wordpress.com/)

* * *

## 回答 #15

> 赞同：10
> 
> 时间：2008-10-05T15:01:47.977

不是博客，而是经常添加新的 C++ 内容：[更多 C++ 成语](http://en.wikibooks.org/wiki/More_C++_Idioms)

* * *

## 回答 #16

> 赞同：9
> 
> 时间：2008-09-30T06:33:11.733

[Google 测试博客](http://googletesting.blogspot.com/)涵盖了各种出色的测试技巧和技术。

* * *

## 回答 #17

> 赞同：8
> 
> 时间：2008-10-10T00:42:49.267

[雷迪特 C++](http://www.reddit.com/r/cpp)

* * *

## 回答 #18

> 赞同：8
> 
> 时间：2008-09-30T06:36:18.700

[安德鲁·科尼格的博客](http://dobbscodetalk.com/index.php?option=com_myblog&blogger=andrewk&Itemid=29)

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2008-10-02T14:18:44.983

[漫无边际的评论](http://www.lenholgate.com/index.rdf)（[Len Holgate](https://stackoverflow.com/users/7925/len-holgate)的博客）

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2008-09-30T07:16:49.973

[mr-edd.co.uk](http://www.mr-edd.co.uk/)

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2009-10-01T08:50:24.420

我曾经跟随[GotW](http://www.gotw.ca/gotw/)。

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2008-09-30T09:35:01.267

[Garry 的位模式](http://blog.programmerslog.com/)（尽管这些天主要是关于 Python）。

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2008-09-30T07:56:02.033

[有吸引力的混乱](http://attractivechaos.wordpress.com/)

* * *

## 回答 #24

> 赞同：4
> 
> 时间：2008-09-30T07:56:07.960

[C/C++ 关于.com](http://cplus.about.com)

* * *

## 回答 #25

> 赞同：4
> 
> 时间：2009-03-19T12:43:20.143

Scott Meyers[的 Fastware 项目](http://fastwareproject.blogspot.com/)

* * *

## 回答 #26

> 赞同：4
> 
> 时间：2008-09-30T14:30:01.820

[只是软件解决方案](http://www.justsoftwaresolutions.co.uk/blog/)

* * *

## 回答 #27

> 赞同：4
> 
> 时间：2008-09-30T14:32:49.397

[轻睡者](http://pkisensee.spaces.live.com/)

* * *

## 回答 #28

> 赞同：4
> 
> 时间：2009-07-09T22:25:33.737

ACCU（C 和 C++ 用户协会）期刊：

[http://accu.org/index.php/journals/c78/](http://accu.org/index.php/journals/c78/)

* * *

## 回答 #29

> 赞同：3
> 
> 时间：2008-09-30T06:33:16.617

Abhishek Padmanabh[学习 c++](http://learningcppisfun.blogspot.com/)

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2008-09-30T08:51:38.843

[学习 C++](http://www.learncpp.com/posts/)

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2008-10-28T18:51:59.603

[英特尔软件博客](http://software.intel.com/en-us/blogs/)（不是纯粹的 C++，但很多帖子都是）

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2008-10-28T19:04:45.833

[只是软件解决方案/C++](http://www.justsoftwaresolutions.co.uk/cplusplus/)（Anthony Williams 的 C++）

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2009-03-06T21:22:11.637

[STLab 论文和演示文稿](http://stlab.adobe.com/wiki/index.php/Papers_and_Presentations)

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2009-08-25T21:28:24.790

Danny Kalev 的[博客和文章](http://www.informit.com/authors/bio.aspx?a=e19aded6-574c-4c46-8511-101f9f0ed8f8)以及他在 informIT上的 c++ 参考[指南的更新](http://www.informit.com/guides/guide.aspx?g=cplusplus)

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2009-07-09T22:27:37.197

[C++ 标准委员会 WG 论文](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/)

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2010-01-08T00:08:00.180

[C++ 下一个](http://cpp-next.com/)

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2009-01-21T14:38:04.493

[凯南李](http://kenanlee.blogspot.com/search/label/C%2FC%2B%2B)

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2011-02-14T22:35:38.133

[Visual C++ 每周新闻](http://paper.li/visualc/news/)

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2008-12-20T11:58:05.877

[波科](http://pocoproject.org/blog)

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2008-12-20T14:22:29.970

[DevX：C++ 专区](http://www.devx.com/cplus/Door/7042)

* * *

## 回答 #41

> 赞同：1
> 
> 时间：2011-06-30T06:51:02.577

[Andrzej 的 C++ 博客](http://akrzemi1.wordpress.com/)

* * *

## 回答 #42

> 赞同：1
> 
> 时间：2010-04-20T15:29:22.457

[Bannalia：](http://bannalia.blogspot.com/)来自 Boost.Multiindex 的作者 Joaquín M López Muñoz 关于不同主题的琐碎笔记，包括一些有趣的 C++ 文章。

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2011-05-09T16:48:20.393

[Mad Software](http://madsoftware.blogspot.com/)

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2009-10-12T10:50:19.527

[http://embracingcpp.blogspot.com](http://embracingcpp.blogspot.com)

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2010-03-18T04:09:46.207

[不耐烦的程序员的 C / C++ 编程秘诀](http://thecprogrammer.com)

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2009-07-03T05:07:18.370

[http://www.codemaestro.com/](http://www.codemaestro.com/)

* * *

## 回答 #47

> 赞同：0
> 
> 时间：2010-02-27T01:24:32.073

[谷歌 C++ 风格指南](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml)

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2009-12-11T18:08:44.297

[现代 C++](http://pizer.wordpress.com/)

* * *

## 回答 #49

> 赞同：0
> 
> 时间：2009-12-03T21:38:14.153

[http://cplusplus.co.il](http://cplusplus.co.il)

* * *

## 回答 #50

> 赞同：0
> 
> 时间：2010-10-19T15:15:50.680

[代码项目。](http://www.codeproject.com)

* * *

## 回答 #51

> 赞同：0
> 
> 时间：2010-10-18T13:20:32.537

[MasterCplusplus（初学者）](http://mastercplusplus.blogspot.com/)

# .net - WPF 中的 GroupBox 标题是否会吞下鼠标单击？

> ID：151979
> 
> 赞同：41
> 
> 时间：2008-09-30T06:32:09.880
> 
> 标签：.net, wpf, checkbox, groupbox

看看这个非常简单的示例 WPF 程序：

```
<Window x:Class="WpfApplication1.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">

    <GroupBox>
        <GroupBox.Header>
            <CheckBox Content="Click Here"/>
        </GroupBox.Header>
    </GroupBox>
</Window> 
```

所以我有一个GroupBox，它的标题是一个CheckBox。我们都做过这样的事情——通常你绑定 GroupBox 的内容，这样当 CheckBox 未选中时它就会被禁用。

但是，当我运行此应用程序并单击 CheckBox 时，我发现有时我的鼠标单击被吞下并且 CheckBox 的状态没有改变。如果我是对的，那就是当我单击 GroupBox 的顶部边框所在的确切像素行时。

有人可以复制这个吗？为什么会发生这种情况，有没有办法解决它？

编辑：将 GroupBox 的 BorderThickness 设置为 0 可以解决问题，但显然它会删除边框，因此它看起来不再像 GroupBox。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2010-10-25T12:28:45.433

伊恩奥克斯回答塞满了标签顺序，使得标题出现在内容之后。可以修改控件模板，使边框无法获得焦点。

为此，请修改模板，使第 2 和第 3 个边框（都在 Grid Row 1 中）具有`IsHitTestVisible=false`

下面的完整模板

```
<BorderGapMaskConverter x:Key="GroupBoxBorderGapMaskConverter" />

<Style x:Key="{x:Type GroupBox}" TargetType="{x:Type GroupBox}">
    <Setter Property="Control.BorderBrush" Value="#FFD5DFE5" />
    <Setter Property="Control.BorderThickness" Value="1" />
    <Setter Property="Control.Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type GroupBox}">
                <Grid SnapsToDevicePixels="True">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="6" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="6" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="6" />
                    </Grid.RowDefinitions>
                    <Border Name="Header" Padding="3,1,3,0" Grid.Row="0" Grid.RowSpan="2" Grid.Column="1">
                        <ContentPresenter ContentSource="Header" RecognizesAccessKey="True" SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}" />
                    </Border>
                    <Border CornerRadius="4" Grid.Row="1" Grid.RowSpan="3" Grid.Column="0" Grid.ColumnSpan="4" BorderThickness="{TemplateBinding Control.BorderThickness}" BorderBrush="#00FFFFFF" Background="{TemplateBinding Control.Background}" IsHitTestVisible="False" />
                    <ContentPresenter Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2" Margin="{TemplateBinding Control.Padding}" SnapsToDevicePixels="{TemplateBinding UIElement.SnapsToDevicePixels}"/>
                    <Border CornerRadius="4" Grid.Row="1" Grid.RowSpan="3" Grid.ColumnSpan="4" BorderThickness="{TemplateBinding Control.BorderThickness}" BorderBrush="#FFFFFFFF" IsHitTestVisible="False">
                        <UIElement.OpacityMask>
                            <MultiBinding Converter="{StaticResource GroupBoxBorderGapMaskConverter}" ConverterParameter="7">
                                <Binding ElementName="Header" Path="ActualWidth" />
                                <Binding Path="ActualWidth" RelativeSource="{RelativeSource Self}" />
                                <Binding Path="ActualHeight" RelativeSource="{RelativeSource Self}" />
                            </MultiBinding>
                        </UIElement.OpacityMask>
                        <Border BorderThickness="{TemplateBinding Control.BorderThickness}" BorderBrush="{TemplateBinding Control.BorderBrush}" CornerRadius="3">
                            <Border BorderThickness="{TemplateBinding Control.BorderThickness}" BorderBrush="#FFFFFFFF" CornerRadius="2" />
                        </Border>
                    </Border>                        
                </Grid>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style> 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-30T10:50:29.290

这似乎是 GroupBox 控件模板中的一个细微错误。我发现通过编辑 GroupBox 的默认模板并将名为“Header”的边框移动到控件模板 Grid 元素中的最后一项，问题自行解决。

原因是具有 BorderBrush 的 TemplateBinding 的其他 Border 元素之一在可视树中更靠下，并且正在捕获鼠标单击，这就是将 BorderBrush 设置为 null 允许 CheckBox 正确接收鼠标单击的原因。

下面是 GroupBox 的结果样式。它与控件的默认模板几乎相同，除了名为“Header”的 Border 元素，它现在是 Grid 的最后一个子元素，而不是第二个。

```
<BorderGapMaskConverter x:Key="BorderGapMaskConverter"/>

<Style x:Key="GroupBoxStyle1" TargetType="{x:Type GroupBox}">
    <Setter Property="BorderBrush" Value="#D5DFE5"/>
    <Setter Property="BorderThickness" Value="1"/>
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type GroupBox}">
                <Grid SnapsToDevicePixels="true">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="6"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="6"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="6"/>
                    </Grid.ColumnDefinitions>
                    <Border Grid.Column="0" Grid.ColumnSpan="4" Grid.Row="1" Grid.RowSpan="3" Background="{TemplateBinding Background}" BorderBrush="Transparent" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="4"/>
                    <ContentPresenter Margin="{TemplateBinding Padding}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" Grid.Column="1" Grid.ColumnSpan="2" Grid.Row="2"/>
                    <Border Grid.ColumnSpan="4" Grid.Row="1" Grid.RowSpan="3" BorderBrush="White" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="4">
                        <Border.OpacityMask>
                            <MultiBinding Converter="{StaticResource BorderGapMaskConverter}" ConverterParameter="7">
                                <Binding Path="ActualWidth" ElementName="Header"/>
                                <Binding Path="ActualWidth" RelativeSource="{RelativeSource Self}"/>
                                <Binding Path="ActualHeight" RelativeSource="{RelativeSource Self}"/>
                            </MultiBinding>
                        </Border.OpacityMask>
                        <Border BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="3">
                            <Border BorderBrush="White" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="2"/>
                        </Border>
                    </Border>
                    <Border x:Name="Header" Grid.Column="1" Grid.Row="0" Grid.RowSpan="2" Padding="3,1,3,0">
                        <ContentPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" ContentSource="Header" RecognizesAccessKey="True"/>
                    </Border>
                </Grid>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style> 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-09-14T14:37:01.333

我提出的另一种解决方案是在派生的 GroupBox 中实现 OnApplyTemplate：

```
public override void OnApplyTemplate()
{
  base.OnApplyTemplate();
  if (Children.Count == 0) return;

  var grid = GetVisualChild(0) as Grid;
  if (grid != null && grid.Children.Count > 3)
  {
    var bd = grid.Children[3] as Border;
    if (bd != null)
    {
      bd.IsHitTestVisible = false;
    }
  }
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-30T06:50:43.173

如果您更改 GroupBox 的 BorderBrush，它就可以工作！

```
<GroupBox BorderBrush="{x:Null}"> 
```

我知道这违背了目标，但它确实证明了问题所在！**************************