# StackOverflow 问答 000508000-000508999

# vb.net - 是否可以使用 AJAX 回发刷新 CSS 表？

> ID：508000
> 
> 赞同：0
> 
> 时间：2009-02-03T17:07:06.543
> 
> 标签：vb.net, asp.net-ajax, asp.net-3.5, dynamic-css

我一直在学习如何使用 ASP.NET 3.5 创建动态图像和动态样式表。我背后的原因是我有一个网页，我想自动更改标题背景图像（使用 css 设置）。在下面检查我的测试脚本：

* * *

```
<%@ Page Language="VB" AutoEventWireup="false" CodeFile="Default.aspx.vb" Inherits="_Default" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title></title>
    <%
        Response.Output.WriteLine("<link rel=""Stylesheet"" type=""text/css"" href=""style.aspx?t={0}&v={1}"" />", oType, oText)
    %>
</head>
<body>
    <form id="form1" runat="server" action="Default.aspx">
        <asp:ScriptManager ID="ScriptManager1" runat="server" />
        <asp:UpdatePanel ID="UpdatePanel1" runat="server">
            <ContentTemplate>
                <div class="testheader">&nbsp;</div>
                <asp:Label ID="Label1" runat="server" Text="Label"></asp:Label> <%-- for testing --%>
            </ContentTemplate>
            <Triggers>
                <asp:AsyncPostBackTrigger ControlID="Button1" EventName="Click" />
            </Triggers>
        </asp:UpdatePanel>
        <asp:Button ID="Button1" runat="server" Text="Button" />
    </form>
</body>
</html> 
```

因此，上面的默认表单页面没有什么特别之处，它有一个 DIV 样式以具有动态背景图像和一个标签，正如评论所示，这只是为了确保我的 AsyncPostBack 正常运行。

```
Partial Class _Default
    Inherits System.Web.UI.Page
    Public oType As String = "m"
    Public oText As String = "Genius on the Web"
    Protected Sub Button1_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles Button1.Click
        Select Case oType
            Case "m"
                oType = "c"
            Case "c"
                oType = "m"
        End Select
        Label1.Text = Now.ToString
    End Sub
End Class 
```

再一次，没什么特别的。只需将我临时硬编码到程序中的两个值交换，并更新标签文本。

这是我的动态样式表：

```
<%@ Page Language="VB" %>

<%  
    Response.ContentType = "text/css"
    Dim qString As String = Request.QueryString("t")
    Dim bText As String = Request.QueryString("v")
    If String.IsNullOrEmpty(qString) Then qString = "blank"
    If String.IsNullOrEmpty(bText) Then bText = "Placeholder"
    Dim theColor, H1size, bannerImg As String
    Select Case qString
        Case "c"
            theColor = "green"
            H1size = 30
        Case "m"
            theColor = "blue"
            H1size = 26
        Case Else
            theColor = "red"
    End Select
    bannerImg = String.Format("image.aspx?t={0}&p={1}", Server.UrlEncode(bText), qString)

    %>

body { background-color: <%=theColor%>; }
.testheader { background: url(<%=bannerImg%>); background-repeat:no-repeat; height:120px; }
.testclass { font-size: <%=H1size%>px; border:1px solid yellow; margin-bottom:2em; } 
```

最后，这是我的动态图像脚本：

```
Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
    Response.ContentType = "image/jpeg"
    Response.Clear()
    Response.BufferOutput = True

    Try
        Dim oText As String = Server.HtmlDecode(Request.QueryString("t"))
        If String.IsNullOrEmpty(oText) Then oText = "Placeholder"

        Dim oPType As String = Server.HtmlDecode(Request.QueryString("p"))
        If String.IsNullOrEmpty(oPType) Then oPType = "none"

        Dim imgPath As String = ""

        Select Case oPType
            Case "c"
                imgPath = "img/banner_green.jpg"
            Case "m"
                imgPath = "img/banner_blue.jpg"
            Case Else
                Throw New Exception("no ptype")
        End Select

        Dim oBitmap As Bitmap = New Bitmap(Server.MapPath(imgPath))

        Dim oGraphic As Graphics = Graphics.FromImage(oBitmap)
        Dim frontColorBrush As New SolidBrush(Color.White)

        Dim oFont As New Font(FONT_NAME, 30)

        Dim oInfo() As ImageCodecInfo = ImageCodecInfo.GetImageEncoders
        Dim oEncoderParams As New EncoderParameters(1) 'jpeg
        Dim xOffset As Single = Math.Round((oBitmap.Height - oFont.Height) / 2, MidpointRounding.ToEven)

        Dim oPoint As New PointF(275.0F, xOffset + 10)

        oEncoderParams.Param(0) = New EncoderParameter(Encoder.Quality, 100L)

        oGraphic.TextRenderingHint = Drawing.Text.TextRenderingHint.AntiAlias
        oGraphic.DrawString(oText, oFont, frontColorBrush, oPoint)

        oBitmap.Save(Response.OutputStream, oInfo(1), oEncoderParams)

        Response.Output.Write(oBitmap)

        oBitmap.Dispose()
        oGraphic.Dispose()

        Response.Flush()
    Catch ex As Exception

    End Try
End Sub 
```

* * *

因此，有了这些信息，我想知道 AsyncPostBack 是否可以刷新 CSS，以便在单击 Button2 时图像会发生变化。我愿意接受建议和/或“这是愚蠢/艰难的做法，试试这个……”类型的反馈。

多谢你们！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T17:45:32.300

既然你说你愿意接受建议......你为什么要使用 AsyncPostBack 和 CSS 来做这件事？为什么不使用 javascript onclick 事件在单击 Button2 时动态更改图像？

编辑（回应下面的帖子）：

不会有回发（如果这就是闪烁的意思）：您仍然可以将 AsyncPostBack 用于您正在做的任何其他事情，然后在 onclick 上触发一个额外的 javascript 函数，它会执行类似的操作

```
document.getElementById('headerimg').src='2.jpg'; 
```

这会将图像更改为新的源文件，而无需任何页面刷新。

# php - PHP 或 Perl 是我的 Web 项目的正确选择吗？

> ID：508004
> 
> 赞同：3
> 
> 时间：2009-02-03T17:10:33.697
> 
> 标签：php, perl, web-applications

我期待听到一些关于选择“正确”语言（和模块？）以实现单人网络项目的建议（仅限 LAMP，复杂性介于留言簿和成熟博客之间，为高流量网站开发每天 50,000+ 次展示）基于以下要求：

*   **输出缓存**（想想：Wordpress Super-Cache 等），当缓存页面存在时完全绕过脚本语言。这个真的很重要。

*   “**网站蜘蛛**”模块访问网站和解析 HTML，Javascript 支持将是一个优势

*   **多媒体文件**（mp3、jpg/gif/png、flv/wmv）的面向对象处理，无需为所有内容编写自己的包装器

*   可以将原始**脚本文件****编码**为不易被篡改的东西（二进制？）

 **对于 MVC 合规性，我已经在研究像 Catalyst 这样的框架。我读到的唯一抱怨是它似乎需要自己的服务器应用程序。也许 PHP 等价物有更好的方式来启动应用程序......？

回答时，不要只说“PHP/Perl 可以做所有这些以及更多”，而是请针对这些要点提供一点建议。

提前致谢

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-03T18:20:55.897

输出缓存：两种语言都有出色的缓存解决方案。

网站蜘蛛：Perl 有[WWW::Mechanize](http://search.cpan.org/perldoc?WWW::Mechanize)，这是我见过的最好的模块。

多媒体文件的面向对象处理：Perl 有一个优势。CPAN 有各种多媒体文件的模块。PHP 似乎特别缺少对视频格式的支持。

编码：两者都必须是可解释的才能执行。我知道两者都有混淆它们的解决方案，但也有反混淆工具。我建议放弃它，这主要是让你自己的生活更加困难。

PS Catalyst 不需要自己的网络服务器，但它确实为[开发目的](http://search.cpan.org/perldoc?Catalyst::Engine::HTTP)提供了一个特殊的服务器。通常你会使用 Apache 或其他支持 FastCGI 的网络服务器来部署它。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-04T02:21:43.583

我建议不要使用 WWW::Mechanize 作为爬虫，而是使用[Gungho](http://search.cpan.org/perldoc?Gungho)。

至于缓存，它往往取决于应用程序（除非它只是“将此页面缓存 10 分钟”）。使用 MVC Perl 应用程序比使用 PHP 实现它要容易得多。看看我有点聪明的[Angerwhale::Cache](http://github.com/jrockway/angerwhale/blob/95da08ea31d2005de3b21f93049e89ffcc0ffaf7/lib/Angerwhale/Plugin/Cache.pm)。您会注意到我在这里以速度换取准确性——*永远不会*提供过时的页面。您可能愿意更加自由，如果是这样，您可以将应用程序从许多请求中删除。（例如，每 5 分钟运行一次以更新静态 HTML 页面。）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-04T08:45:39.393

Catalyst 将轻松完成您需要的所有事情。如果您正确使用 M 和 V 并将 C 保持在最低限度（如 Catalyst 社区所鼓励的那样），那么您没有理由不获得所需的可扩展性。

我不知道您所说的“它似乎需要自己的服务器应用程序”是什么意思。部署 Catalyst 应用程序可以简单到

```
CATALYST_ENGINE=HTTP:Prefork script/myapp_server.pl -p 80 
```

但它显然也支持其他选项。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-04T19:17:32.537

使用 Perl，您可以使用[PAR](http://par.perl.org/)来打包您的应用程序。这可以简化部署并允许使用[PAR::Filter 模块](http://search.cpan.org/search?query=PAR%3A%3AFilter&mode=module)对其进行混淆。还有[Apache::PAR](http://search.cpan.org/dist/Apache-PAR/)将 PAR 与 mod_perl 环境集成。

**更新：** 嗯，正如网站上所说，PAR 是纯 perl（不需要 C 编译），因此您可以将它安装在任何可以编写文件的服务器上。您可以在普通 perl 脚本中从 PAR 文件加载模块，如下所示：

```
 use PAR;
 use lib "foo.par";             # the .par part is optional
 use Hello;                     # module from the par file. 
```

将大部分逻辑放入模块中，并使用简单的启动器脚本从 PAR 文件中加载它们。

但是，如果您打算构建一个大型、复杂的应用程序，请帮自己一个忙，并获得一个主机，它可以让您安装模块或为您安装它们。此外，使用 mod_perl 或 FastCgi 来加速您的应用程序。

[GrokThis](http://www.grokthis.net/)有便宜的好计划。那里还有其他好主人。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-03T19:03:47.010

我认为 PHP 可以轻松应对这样的项目，就像 Leon 所说的那样，它对多媒体的支持可能不如 perl 好，但对于其余的东西，它肯定是好的。

大量不同的缓存 API 和 PHP 框架，我个人可以推荐 CakePHP 是一个非常好的框架，但是它非常庞大，定制的解决方案可能会更好。

我用过的最好的 PHP 网站蜘蛛是[Sphider](http://www.sphider.eu/)。

不确定在 PHP 中处理视频和音频文件，但[ImageMagick](http://uk3.php.net/imagick)非常适合图像。

php 中的大量内容以及用于编码的内容，请查看这些内容的[手册](http://uk3.php.net/manual/en/index.php)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-04T20:38:31.123

查看 MVC 框架[Symfony](http://www.symfony-project.org/)和[Cake](http://cakephp.org/) for PHP。被广泛使用的。

但是请记住，50,000 次展示听起来很多，但并没有那么多。在您真正开始与并发用户产生大量流量之前，您可能不需要担心缓存。

几乎所有其他内容都被提及。如果您的服务器被锁定，您的源代码永远不应该被更改 - 所以除非您分发零售应用程序，否则我不明白为什么您需要部署源代码模糊。您将只为您的站点/软件的实施/部署和解释添加更多步骤。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-04T09:13:57.323

*   PHP 源代码混淆可以使用 IONCube 完成，但它需要服务器上的相应模块（这对*托管* 不友好）。
*   对于 Perl，几年前我使用 perl 编译器创建 Pcode 或将源代码与独立包中的解释器链接。
*   您描述的输出缓存听起来像反向代理。
*   PHP 没有任何电影/音频支持。您应该求助于 FFMpeg 或 MEncoder 等外部工具来进行后端处理或文件统计。

# active-directory - sAMAccountName 和域的 Active Directory LDAP 查询

> ID：508014
> 
> 赞同：26
> 
> 时间：2009-02-03T17:13:51.163
> 
> 标签：active-directory, ldap, ldap-query

如何通过 sAMAccountName 和域查询 LDAP 存储？Active Directory 或 LDAP 术语中命名的“域”属性是什么？

到目前为止，这就是我所拥有的过滤器。我希望能够在域中添加：

```
(&(objectCategory=Person)(sAMAccountName=BTYNDALL)) 
```

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-04T22:27:00.203

首先，修改您的搜索过滤器以仅查找用户而不是联系人：

```
(&(objectCategory=person)(objectClass=user)(sAMAccountName=BTYNDALL)) 
```

您可以通过连接到配置分区并枚举分区容器中的所有条目来枚举森林的所有域。抱歉，我现在没有任何 C# 代码，但这里有一些我过去使用过的 vbscript 代码：

```
Set objRootDSE = GetObject("LDAP://RootDSE")
AdComm.Properties("Sort on") = "name"
AdComm.CommandText = "<LDAP://cn=Partitions," & _
    objRootDSE.Get("ConfigurationNamingContext") & ">;" & _
        "(&(objectcategory=crossRef)(systemFlags=3));" & _
            "name,nCName,dnsRoot;onelevel"
set AdRs = AdComm.Execute 
```

从中您可以检索每个分区的名称和 dnsRoot：

```
AdRs.MoveFirst
With AdRs
  While Not .EOF
    dnsRoot = .Fields("dnsRoot")

    Set objOption = Document.createElement("OPTION")
    objOption.Text = dnsRoot(0)
    objOption.Value = "LDAP://" & dnsRoot(0) & "/" & .Fields("nCName").Value
    Domain.Add(objOption)
    .MoveNext 
  Wend 
End With 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2013-10-07T11:55:59.763

您可以使用以下查询

登录名（Windows 2000 之前）等于**John的用户**

```
(&(objectCategory=person)(objectClass=user)(!sAMAccountType=805306370)(sAMAccountName=**John**)) 
```

所有用户

```
(&(objectCategory=person)(objectClass=user)(!sAMAccountType=805306370)) 
```

启用的用户

```
(&(objectCategory=person)(objectClass=user)(!sAMAccountType=805306370)(!userAccountControl:1.2.840.113556.1.4.803:=2)) 
```

禁用用户

```
(&(objectCategory=person)(objectClass=user)(!sAMAccountType=805306370)(userAccountControl:1.2.840.113556.1.4.803:=2)) 
```

锁定用户

```
(&(objectCategory=person)(objectClass=user)(!sAMAccountType=805306370)(lockouttime>=1)) 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-04-07T09:43:27.577

搜索**用户**的**最佳方式**是.**`(sAMAccountType=805306368)`**

 **或者对于残疾用户：

`(&(sAMAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=2))`

或者对于活跃用户：

`(&(sAMAccountType=805306368)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))`

我发现 LDAP 并不像它应该的那样轻巧。

也是[常见 LDAP 查询](http://www.ldapexplorer.com/en/manual/109050000-famous-filters.htm)的资源- 尝试自己找到它们，您将失去宝贵的时间并且肯定会犯错误。

关于域：在单个查询中是不可能的，因为域是用户`distinguisedName`( `DN`) 的一部分，在 Microsoft AD 上，不能通过部分匹配进行搜索。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-03T18:13:53.773

“域”不是 LDAP 对象的属性。它更像是存储对象的*数据库的名称。*

因此，您必须连接到正确的数据库（在 LDAP 术语中：*“绑定到域/目录服务器”*）才能在该数据库中执行搜索。

成功绑定后，您只需要当前形状的查询即可。

顺便说一句：选择是一个很好`"ObjectCategory=Person"`的`"ObjectClass=user"`决定。在 AD 中，前者是一个性能优异的“索引属性”，后者没有索引并且速度稍慢。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-03T17:26:15.163

您必须在域中执行搜索：

[http://msdn.microsoft.com/en-us/library/ms677934(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms677934(VS.85).aspx) 所以，基本上你应该绑定到一个域以便在这个域内搜索。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-03T17:30:04.093

如果您使用的是 .NET，请使用[DirectorySearcher](http://msdn.microsoft.com/en-us/library/system.directoryservices.directorysearcher.aspx)类。您可以将域作为字符串传递给构造函数。

```
// if you domain is domain.com...
string username = "user"
string domain = "LDAP://DC=domain,DC=com";
DirectorySearcher search = new DirectorySearcher(domain);
search.Filter = "(SAMAccountName=" + username + ")"; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-08-23T13:43:34.293

我写了一个 C# 类

*   Dscoduc 的算法，
*   来自 sorin 的查询优化，
*   域到服务器映射的缓存，以及
*   一种以 DOMAIN\sAMAccountName 格式搜索帐户名称的方法。

但是，它不是站点感知的。

```
using System;
using System.Collections.Generic;
using System.DirectoryServices;
using System.Linq;
using System.Text;

public static class ADUserFinder
{
    private static Dictionary<string, string> _dictDomain2LDAPPath;

    private static Dictionary<string, string> DictDomain2LDAPPath
    {
        get
        {
            if (null == _dictDomain2LDAPPath)
            {
                string configContainer;
                using (DirectoryEntry rootDSE = new DirectoryEntry("LDAP://RootDSE"))
                    configContainer = rootDSE.Properties["ConfigurationNamingContext"].Value.ToString();

                using (DirectoryEntry partitionsContainer = new DirectoryEntry("LDAP://CN=Partitions," + configContainer))
                using (DirectorySearcher dsPartitions = new DirectorySearcher(
                        partitionsContainer,
                        "(&(objectcategory=crossRef)(systemFlags=3))",
                        new string[] { "name", "nCName", "dnsRoot" },
                        SearchScope.OneLevel
                    ))
                using (SearchResultCollection srcPartitions = dsPartitions.FindAll())
                {
                    _dictDomain2LDAPPath = srcPartitions.OfType<SearchResult>()
                        .ToDictionary(
                        result => result.Properties["name"][0].ToString(), // the DOMAIN part
                        result => $"LDAP://{result.Properties["dnsRoot"][0]}/{result.Properties["nCName"][0]}"
                    );
                }
            }

            return _dictDomain2LDAPPath;
        }
    }

    private static DirectoryEntry FindRootEntry(string domainPart)
    {
        if (DictDomain2LDAPPath.ContainsKey(domainPart))
            return new DirectoryEntry(DictDomain2LDAPPath[domainPart]);
        else
            throw new ArgumentException($"Domain \"{domainPart}\" is unknown in Active Directory");
    }

    public static DirectoryEntry FindUser(string domain, string sAMAccountName)
    {
        using (DirectoryEntry rootEntryForDomain = FindRootEntry(domain))
        using (DirectorySearcher dsUser = new DirectorySearcher(
                rootEntryForDomain,
                $"(&(sAMAccountType=805306368)(sAMAccountName={EscapeLdapSearchFilter(sAMAccountName)}))" // magic number 805306368 means "user objects", it's more efficient than (objectClass=user)
            ))
            return dsUser.FindOne().GetDirectoryEntry();
    }

    public static DirectoryEntry FindUser(string domainBackslashSAMAccountName)
    {
        string[] domainAndsAMAccountName = domainBackslashSAMAccountName.Split('\\');
        if (domainAndsAMAccountName.Length != 2)
            throw new ArgumentException($"User name \"{domainBackslashSAMAccountName}\" is not in correct format DOMAIN\\SAMACCOUNTNAME", "DomainBackslashSAMAccountName");

        string domain = domainAndsAMAccountName[0];
        string sAMAccountName = domainAndsAMAccountName[1];

        return FindUser(domain, sAMAccountName);
    }

    /// <summary>
    /// Escapes the LDAP search filter to prevent LDAP injection attacks.
    /// Copied from https://stackoverflow.com/questions/649149/how-to-escape-a-string-in-c-for-use-in-an-ldap-query
    /// </summary>
    /// <param name="searchFilter">The search filter.</param>
    /// <see cref="https://blogs.oracle.com/shankar/entry/what_is_ldap_injection" />
    /// <see cref="http://msdn.microsoft.com/en-us/library/aa746475.aspx" />
    /// <returns>The escaped search filter.</returns>
    private static string EscapeLdapSearchFilter(string searchFilter)
    {
        StringBuilder escape = new StringBuilder();
        for (int i = 0; i < searchFilter.Length; ++i)
        {
            char current = searchFilter[i];
            switch (current)
            {
                case '\\':
                    escape.Append(@"\5c");
                    break;
                case '*':
                    escape.Append(@"\2a");
                    break;
                case '(':
                    escape.Append(@"\28");
                    break;
                case ')':
                    escape.Append(@"\29");
                    break;
                case '\u0000':
                    escape.Append(@"\00");
                    break;
                case '/':
                    escape.Append(@"\2f");
                    break;
                default:
                    escape.Append(current);
                    break;
            }
        }

        return escape.ToString();
    }
} 
```

# java - 如何使用 JPA 和 Hibernate 在 UTC 时区中存储日期/时间和时间戳

> ID：508019
> 
> 赞同：119
> 
> 时间：2009-02-03T17:15:51.470
> 
> 标签：java, hibernate, datetime, jpa, timezone

如何配置 JPA/Hibernate 以将数据库中的日期/时间存储为 UTC (GMT) 时区？考虑这个带注释的 JPA 实体：

```
public class Event {
    @Id
    public int id;

    @Temporal(TemporalType.TIMESTAMP)
    public java.util.Date date;
} 
```

如果日期是 2008 年 2 月 3 日上午 9:30 太平洋标准时间 (PST)，那么我希望将 2008 年 2 月 3 日下午 5:30 的 UTC 时间存储在数据库中。同样，当从数据库中检索日期时，我希望将其解释为 UTC。所以在这种情况下 530pm 是 530pm UTC。当它显示时，它将被格式化为太平洋标准时间上午 9:30。

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2016-11-05T13:24:33.783

从 Hibernate 5.2 开始，您现在可以通过将以下配置属性添加到`properties.xml`JPA 配置文件中来强制使用 UTC 时区：

```
<property name="hibernate.jdbc.time_zone" value="UTC"/> 
```

如果您使用的是 Spring Boot，则将此属性添加到您的`application.properties`文件中：

```
spring.jpa.properties.hibernate.jdbc.time_zone=UTC 
```

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2009-02-03T18:44:32.230

据我所知，您需要将整个 Java 应用程序置于 UTC 时区（以便 Hibernate 将日期存储在 UTC 中），并且您需要在显示内容时转换为所需的任何时区（至少我们这样做这边走）。

在启动时，我们会：

```
TimeZone.setDefault(TimeZone.getTimeZone("Etc/UTC")); 
```

并将所需的时区设置为 DateFormat：

```
fmt.setTimeZone(TimeZone.getTimeZone("Europe/Budapest")) 
```

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2010-08-07T15:29:44.210

Hibernate 不知道 Dates 中的时区内容（因为没有任何内容），但实际上是 JDBC 层导致了问题。`ResultSet.getTimestamp`并且`PreparedStatement.setTimestamp`都在他们的文档中说，在从数据库读取和写入数据库时​​，默认情况下他们将日期转换为当前 JVM 时区。

我在 Hibernate 3.5 中提出了一个解决方案，通过子类`org.hibernate.type.TimestampType`化强制这些 JDBC 方法使用 UTC 而不是本地时区：

```
public class UtcTimestampType extends TimestampType {

    private static final long serialVersionUID = 8088663383676984635L;

    private static final TimeZone UTC = TimeZone.getTimeZone("UTC");

    @Override
    public Object get(ResultSet rs, String name) throws SQLException {
        return rs.getTimestamp(name, Calendar.getInstance(UTC));
    }

    @Override
    public void set(PreparedStatement st, Object value, int index) throws SQLException {
        Timestamp ts;
        if(value instanceof Timestamp) {
            ts = (Timestamp) value;
        } else {
            ts = new Timestamp(((java.util.Date) value).getTime());
        }
        st.setTimestamp(index, ts, Calendar.getInstance(UTC));
    }
} 
```

如果您使用这些类型，则应该做同样的事情来修复 TimeType 和 DateType。缺点是您必须手动指定要使用这些类型，而不是 POJO 中每个 Date 字段的默认值（并且还会破坏纯 JPA 兼容性），除非有人知道更通用的覆盖方法。

更新：Hibernate 3.6 更改了类型 API。在 3.6 中，我编写了一个类 UtcTimestampTypeDescriptor 来实现这一点。

```
public class UtcTimestampTypeDescriptor extends TimestampTypeDescriptor {
    public static final UtcTimestampTypeDescriptor INSTANCE = new UtcTimestampTypeDescriptor();

    private static final TimeZone UTC = TimeZone.getTimeZone("UTC");

    public <X> ValueBinder<X> getBinder(final JavaTypeDescriptor<X> javaTypeDescriptor) {
        return new BasicBinder<X>( javaTypeDescriptor, this ) {
            @Override
            protected void doBind(PreparedStatement st, X value, int index, WrapperOptions options) throws SQLException {
                st.setTimestamp( index, javaTypeDescriptor.unwrap( value, Timestamp.class, options ), Calendar.getInstance(UTC) );
            }
        };
    }

    public <X> ValueExtractor<X> getExtractor(final JavaTypeDescriptor<X> javaTypeDescriptor) {
        return new BasicExtractor<X>( javaTypeDescriptor, this ) {
            @Override
            protected X doExtract(ResultSet rs, String name, WrapperOptions options) throws SQLException {
                return javaTypeDescriptor.wrap( rs.getTimestamp( name, Calendar.getInstance(UTC) ), options );
            }
        };
    }
} 
```

现在，当应用程序启动时，如果您将 TimestampTypeDescriptor.INSTANCE 设置为 UtcTimestampTypeDescriptor 的实例，则所有时间戳都将被存储并视为 UTC，而无需更改 POJO 上的注释。[我还没有测试过这个]

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2019-03-27T15:58:19.183

使用 Spring Boot JPA，在 application.properties 文件中使用以下代码，显然您可以根据自己的选择修改时区

```
spring.jpa.properties.hibernate.jdbc.time_zone = UTC 
```

然后在您的实体类文件中，

```
@Column
private LocalDateTime created; 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2013-06-06T06:28:14.070

添加一个**完全**基于并感谢 divestoclimb 并得到 Shaun Stone 提示的答案。只是想详细说明它，因为这是一个常见问题，解决方案有点混乱。

这是使用 Hibernate 4.1.4.Final，尽管我怀疑 3.6 之后的任何东西都可以工作。

首先，创建divestoclimb的UtcTimestampTypeDescriptor

```
public class UtcTimestampTypeDescriptor extends TimestampTypeDescriptor {
    public static final UtcTimestampTypeDescriptor INSTANCE = new UtcTimestampTypeDescriptor();

    private static final TimeZone UTC = TimeZone.getTimeZone("UTC");

    public <X> ValueBinder<X> getBinder(final JavaTypeDescriptor<X> javaTypeDescriptor) {
        return new BasicBinder<X>( javaTypeDescriptor, this ) {
            @Override
            protected void doBind(PreparedStatement st, X value, int index, WrapperOptions options) throws SQLException {
                st.setTimestamp( index, javaTypeDescriptor.unwrap( value, Timestamp.class, options ), Calendar.getInstance(UTC) );
            }
        };
    }

    public <X> ValueExtractor<X> getExtractor(final JavaTypeDescriptor<X> javaTypeDescriptor) {
        return new BasicExtractor<X>( javaTypeDescriptor, this ) {
            @Override
            protected X doExtract(ResultSet rs, String name, WrapperOptions options) throws SQLException {
                return javaTypeDescriptor.wrap( rs.getTimestamp( name, Calendar.getInstance(UTC) ), options );
            }
        };
    }
} 
```

然后创建 UtcTimestampType，它使用 UtcTimestampTypeDescriptor 而不是 TimestampTypeDescriptor 作为超级构造函数调用中的 SqlTypeDescriptor，否则将所有内容委托给 TimestampType：

```
public class UtcTimestampType
        extends AbstractSingleColumnStandardBasicType<Date>
        implements VersionType<Date>, LiteralType<Date> {
    public static final UtcTimestampType INSTANCE = new UtcTimestampType();

    public UtcTimestampType() {
        super( UtcTimestampTypeDescriptor.INSTANCE, JdbcTimestampTypeDescriptor.INSTANCE );
    }

    public String getName() {
        return TimestampType.INSTANCE.getName();
    }

    @Override
    public String[] getRegistrationKeys() {
        return TimestampType.INSTANCE.getRegistrationKeys();
    }

    public Date next(Date current, SessionImplementor session) {
        return TimestampType.INSTANCE.next(current, session);
    }

    public Date seed(SessionImplementor session) {
        return TimestampType.INSTANCE.seed(session);
    }

    public Comparator<Date> getComparator() {
        return TimestampType.INSTANCE.getComparator();        
    }

    public String objectToSQLString(Date value, Dialect dialect) throws Exception {
        return TimestampType.INSTANCE.objectToSQLString(value, dialect);
    }

    public Date fromStringValue(String xml) throws HibernateException {
        return TimestampType.INSTANCE.fromStringValue(xml);
    }
} 
```

最后，当您初始化 Hibernate 配置时，将 UtcTimestampType 注册为类型覆盖：

```
configuration.registerTypeOverride(new UtcTimestampType()); 
```

现在时间戳在进出数据库的过程中不应该与 JVM 的时区有关。HTH。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-02-17T17:33:51.030

你会认为这个常见的问题会被 Hibernate 解决。但它不是！有一些“技巧”可以让它正确。

我使用的一个是将日期作为 Long 存储在数据库中。所以我总是在 70 年 1 月 1 日之后以毫秒为单位工作。然后我在我的类上有 getter 和 setter 只返回/接受日期。所以 API 保持不变。不利的一面是我在数据库中很长。所以使用 SQL 我几乎只能做 <,>,= 比较——而不是花哨的日期运算符。

另一种方法是使用此处描述的自定义映射类型： [http ://www.hibernate.org/100.html](http://www.hibernate.org/100.html)

我认为处理这个问题的正确方法是使用日历而不是日期。使用日历，您可以在持久化之前设置时区。

注意：愚蠢的 stackoverflow 不允许我发表评论，所以这是对 david a 的回应。

如果您在芝加哥创建此对象：

```
new Date(0); 
```

Hibernate 将其保留为“1969 年 12 月 31 日 18:00:00”。日期应该没有时区，所以我不确定为什么要进行调整。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2010-12-13T21:07:45.103

这里有几个时区在运行：

1.  Java 的 Date 类（util 和 sql），具有 UTC 的隐式时区
2.  您的 JVM 正在运行的时区，以及
3.  数据库服务器的默认时区。

所有这些都可能不同。Hibernate/JPA 有一个严重的设计缺陷，即用户不能轻易确保时区信息保存在数据库服务器中（这允许在 JVM 中重建正确的时间和日期）。

如果无法（轻松）使用 JPA/Hibernate 存储时区，那么信息就会丢失，一旦信息丢失，构建它就会变得昂贵（如果可能的话）。

我认为最好始终存储时区信息（应该是默认值），然后用户应该具有优化时区的可选能力（尽管它只会影响显示，但在任何日期仍然存在隐式时区）。

抱歉，这篇文章没有提供解决方法（已在其他地方得到回答），但它是为什么总是存储时区信息很重要的合理化。不幸的是，似乎许多计算机科学家和编程从业者反对时区的必要性，仅仅是因为他们不理解“信息丢失”的观点，以及这如何使国际化等事情变得非常困难——这对于现在可以访问的网站非常重要您组织中的客户和人员在世界各地移动时。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-05-01T15:35:45.360

请查看我在 Sourceforge 上的项目，其中包含标准 SQL 日期和时间类型以及 JSR 310 和 Joda Time 的用户类型。所有类型都试图解决抵消问题。见[http://sourceforge.net/projects/usertype/](http://sourceforge.net/projects/usertype/)

编辑：针对附在此评论中的 Derek Mahar 的问题：

“克里斯，您的用户类型是否适用于 Hibernate 3 或更高版本？——Derek Mahar 2010 年 11 月 7 日 12:30”

是的，这些类型支持 Hibernate 3.x 版本，包括 Hibernate 3.6。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-23T19:02:36.850

日期不在任何时区（对于每个人来说，它是从定义的时间开始的毫秒办公室），但底层 (R)DB 通常以政治格式存储时间戳（年、月、日、小时、分钟、秒、. ..) 那是时区敏感的。

说真的，Hibernate*必须*允许在某种形式的映射中被告知 DB 日期在某某时区中，以便在加载或存储它时不会假定它是自己的……

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-12-08T19:26:53.780

Hibernate 不允许通过注释或任何其他方式指定时区。如果您使用日历而不是日期，则可以使用 HIbernate 属性 AccessType 实现解决方法并自己实现映射。更高级的解决方案是实现自定义 UserType 来映射您的日期或日历。这两种解决方案都在我的博客文章中进行了解释：http: [//www.joobik.com/2010/11/mapping-dates-and-time-zones-with.html](http://www.joobik.com/2010/11/mapping-dates-and-time-zones-with.html)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-11-08T13:31:32.043

当我想将数据库中的日期存储为 UTC 并避免使用`varchar`和显式`String <-> java.util.Date`转换，或者将我的整个 Java 应用程序设置在 UTC 时区时，我遇到了同样的问题（因为这可能会导致另一个意外问题，如果 JVM 是在许多应用程序中共享）。

因此，有一个开源项目`DbAssist`，它允许您轻松地将数据库中的读/写修复为 UTC 日期。由于您使用 JPA Annotations 来映射实体中的字段，因此您所要做的就是将以下依赖项包含到您的 Maven`pom`文件中：

```
<dependency>
    <groupId>com.montrosesoftware</groupId>
    <artifactId>DbAssist-5.2.2</artifactId>
    <version>1.0-RELEASE</version>
</dependency> 
```

`@EnableAutoConfiguration`然后通过在 Spring 应用程序类之前添加注释来应用修复（对于 Hibernate + Spring Boot 示例） 。有关其他设置安装说明和更多使用示例，请参阅项目的[github](https://github.com/montrosesoftware/DbAssist)。

好处是您根本不必修改实体；您可以保持`java.util.Date`原样。

`5.2.2`必须与您使用的 Hibernate 版本相对应。我不确定您在项目中使用的是哪个版本，但提供的修复程序的完整列表可在项目[github](https://github.com/montrosesoftware/DbAssist/wiki#add-the-dependency)的 wiki 页面上找到。不同 Hibernate 版本的修复不同的原因是，Hibernate 创建者在版本之间更改了几次 API。

在内部，该修复程序使用了来自 divestoclimb、Shane 和其他一些来源的提示来创建自定义`UtcDateType`. 然后它将标准`java.util.Date`与`UtcDateType`处理所有必要时区处理的自定义映射。类型的映射是使用提供的文件`@Typedef`中的注释来实现的。`package-info.java`

```
@TypeDef(name = "UtcDateType", defaultForType = Date.class, typeClass = UtcDateType.class),
package com.montrosesoftware.dbassist.types; 
```

[你可以在这里](http://blog.montrosesoftware.com/2016/11/08/dates-and-times-in-java-unexpected-timezone-shift/)找到一篇文章，它解释了为什么会发生这种时间偏移以及解决它的方法是什么。

# asp.net - 模态弹出窗口中的文本框有时会在 FF 中冻结

> ID：508021
> 
> 赞同：0
> 
> 时间：2009-02-03T17:16:24.810
> 
> 标签：asp.net, javascript, ajax, modal-dialog

我在`Ajax ModalPopUp`. 有时，每当加载模式时，文本框都会在 Firefox 中冻结。它没有发生在 Internet Explorer -**只是 Firefox**中。

有什么建议么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-06T07:43:53.260

也许，只是也许，这是因为您有一些代码在显示对话框之前清除了文本框？也许，只是也许，那个代码进入了一个循环？我见过很多发生这种情况的地方——一个文本框既可以写入也可以读取。当太多的 GUI 更新发生时，Firefox 可能需要更长的时间，甚至在恢复活动之前将 CPU 固定在 100%。MSIE 不会经常这样做——它要么崩溃，要么只是从文本框中传递过时的数据。

删除清除文本框的代码，这应该会有所帮助。祝你好运！

# javascript - 是否可以从网络请求中确定用户时间？

> ID：508026
> 
> 赞同：4
> 
> 时间：2009-02-03T17:18:56.287
> 
> 标签：javascript, time

是否可以在 Web 服务器上确定用户发送请求时的本地时间和时区？

可以使用javascript捕获它并将其发布回服务器吗？

我的公司想要跟踪有多少用户在办公时间以外使用我们的网站（不，我也不知道为什么！）。

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T17:22:42.377

您需要将客户端的 JavaScript 时间放入隐藏字段，并假设他们的时钟设置正确。

```
myTime = new Date() >> Tue Feb 03 2009 12:24:28 GMT-0500 (Eastern Standard Time) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T17:23:07.697

您可以使用 JavaScript 将日期加载到隐藏字段中：

```
var newDate = new Date();
hiddenFieldName.value = newDate.toLocaleString(); 
```

然后在回发到服务器时抢占该字段。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T19:07:35.117

您应该考虑对现有 Web 服务器日志进行反向 DNS 解析。然后，您可以使用地理编码来猜测用户的时区（以及相对于您的 Web 服务器时间的本地时间）。

您无需编写新的 JavaScript 代码、编写自定义服务器端代码来记录用户时间，然后部署更新的网站。

这个 Perl 脚本可能是一个有用的例子：[Perl Script that Does Bulk Reverse-DNS Lookups](http://blog.unixlore.net/2006/03/perl-script-that-does-bulk-reverse-dns.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T17:24:18.770

JavaScript确实是要走的路。

幸运的是，网络上有[很多您可以使用的示例代码](http://www.google.com/search?q=javascript+time+zone)。[这个页面](http://www.willmaster.com/library/javascript/determining-your-visitors-time-zone.php)看起来很全面。

应该注意的是，知道某人的当前偏移量*与*知道他们的时区不同，但这可能足以满足您的目的:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T17:27:08.047

当然，您可以嵌入 JS 派生的客户端时间戳并将其发送回附加到​​其他请求，但这完全不可靠，因为用户可以将客户端时间设置为他们想要的任何时间，并且它需要第二个请求，这可能有点滥用，或技术上很难确保。许多实现将通过对文本文件的 AJAX 请求触发后忘记，或向页面添加单个空白像素图像来实现这一点。

您可以尝试根据第一次请求和地理定位 IP 得出类似的指标 - 位置和 GMT 时间戳为您提供本地时间 - 但如果您还没有 IP/Geo 数据库，这可能会很昂贵:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T17:24:32.890

好吧，您可以使用 JavaScript 读取浏览器的本地时间：

```
var now = new Date(); 
```

然后您可以使用 XmlHttpRequest 或隐藏的表单字段将其发布到服务器...

# sql-server - Windows 2003 中可用于 JDBC 连接的套接字数

> ID：508028
> 
> 赞同：1
> 
> 时间：2009-02-03T17:20:41.337
> 
> 标签：sql-server, windows, sockets, jdbc, jtds

我的团队使用带有 JTDS 驱动程序的纯 JDBC（无连接池）用 Java 构建了一个连接到 Windows 2003 Server 中的 SQL Server 2005 的 Windows 服务。

一段时间后，打开与数据库的连接的方法开始引发异常，并带有以下堆栈跟踪：

```
 java.net.BindException: Address already in use: connect
at java.net.PlainSocketImpl.socketConnect(Native Method)
at java.net.PlainSocketImpl.doConnect(PlainSocketImpl .java:305)
at java.net.PlainSocketImpl.connectToAddress(PlainSoc ketImpl.java:171)
at java.net.PlainSocketImpl.connect(PlainSocketImpl.j ava:158)
at java.net.Socket.connect(Socket.java:452)
at java.net.Socket.connect(Socket.java:402)
at java.net.Socket.<init>(Socket.java:309)
at java.net.Socket.<init>(Socket.java:124) 
```

尽管程序员在完成后很小心地关闭了连接，但有些事情并不顺利。

目前，我们解决了切换到命名管道协议的问题（因为所有都托管在同一台机器上），但这是一个临时解决方案。

我已经用谷歌搜索了这个问题，似乎我们应该使用一些连接池库，比如 c3p0。这是解决问题的唯一方法吗？

我可以尝试提高 Windows 2003 中的套接字限制吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T18:10:27.883

您是否以非常快的速度打开/关闭连接？[当 TCP 连接关闭时，它们会在TIME_WAIT](http://wiki.apache.org/HttpComponents/FrequentlyAskedConnectionManagementQuestions)状态下徘徊一会儿。在 Windows 上，它们存在的默认时间是 240 秒。听起来您可能有很多处于 TIME_WAIT 状态的 tcp 连接。

您可以通过运行 netstat 来检查这一点。如果您在 TIME_WAIT 状态下与数据库服务器有大量 tcp 连接，则连接池将解决您的问题。

您可以尝试提高套接字限制，和/或降低连接保持在 TIME_WAIT 状态的时间。但这会改变所有 tcp 连接的行为。所以使用连接池 :) 我们使用[dbcp](http://commons.apache.org/dbcp/)作为 Java 中的连接池解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T17:38:00.570

看起来您的连接确实没有关闭。那或者您正在尝试错误地重新使用连接...

出于各种性能原因，强烈建议使用连接池。例如，您不需要每次都创建一个连接，这非常昂贵。重复使用连接会带来不同的世界。

其次，你真的要创建自己的池化机制吗？它并不像看起来那么简单，有很多特殊的线程问题。仅使用经受住时间考验的现有库要容易得多。

# .net - 将制表符转换为 .NET 字符串中的空格

> ID：508033
> 
> 赞同：11
> 
> 时间：2009-02-03T17:21:23.143
> 
> 标签：.net, string

我正在使用正则表达式构建一个文本解析器。我需要将字符串中的所有制表符转换为空格字符。我不能假设一个制表符应该包含多少个空格，否则我可以用 4 个空格字符替换一个制表符。这类问题有什么好的解决办法吗。我需要在代码中执行此操作，因此我无法使用外部工具。

* * *

不幸的是，这些答案都没有解决我遇到的问题。我正在从外部文本文件中提取文本，我无法假设它们是如何创建的或使用哪个操作系统来创建它们的。我相信制表符的长度可能会有所不同，因此如果在阅读文本文件时遇到制表符，我想知道应该用多少个空格字符替换它。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-03T17:27:46.267

不幸的是，您需要假设一个制表符代表多少个空格。您应该将其设置为固定值（如提到的四个）或使其成为用户选项。

最快的方法是 .NET 是（我正在使用 C#）：

```
var NewString = "This is a string with a    Tab";
var TabLength = 4;
var TabSpace = new String(' ', TabLength);

NewString = NewString.Replace("\t", TabSpace); 
```

然后，您可以将 TabLength 变量更改为您想要的任何值，通常如前所述，四个空格字符。

所有操作系统中的选项卡长度相同，一个选项卡！不同的是软件显示它们的方式，通常这是四个空格字符的等效宽度，并且这还假设显示使用的是固定宽度的字体，例如[Courier New](https://en.wikipedia.org/wiki/Courier_%28typeface%29#Courier_New)。

例如，我[选择的 IDE](http://www.ultraedit.com/)允许我将制表符的宽度更改为适合我的值。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-03T19:26:47.073

我不确定选项卡将如何从 Unix 文本文件中读取，或者您的各种格式是什么，但这适用于内联文本。也许它会有所帮助。

```
var textWithTabs = "some\tvalues\tseperated\twith\ttabs";
var textWithSpaces = string.Empty;

var textValues = textWithTabs.Split('\t');

foreach (var val in textValues)
{
    textWithSpaces += val + new string(' ', 8 - val.Length % 8);
}

Console.WriteLine(textWithTabs);
Console.WriteLine(textWithSpaces);
Console.Read(); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-03T18:06:48.980

我想你的意思是你想用它们扩展到的有效空间量替换选项卡。想到的第一种方法不涉及正则表达式（我不知道这个问题可以用它们解决）。

*   逐个字符地遍历字符串，跟踪您在字符串中的当前位置。
*   当您找到一个制表符时，将其替换为 N 个空格，其中`N = tab_length - (current_position % tab_length)`.
*   将 N 添加到您当前的位置并继续处理字符串。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-01-31T16:55:08.070

*（如果您正在寻找如何在编辑器中将制表符转换为空格，请参阅我的答案末尾。）*

我最近被要求用空格替换制表符。

该解决方案将制表符替换为**最多**4 或 8 个空格。

逻辑遍历输入字符串，一次一个字符，并跟踪输出字符串中的当前位置（列#）。

*   如果遇到`\t`(tab char) - 查找下一个制表位，计算到达下一个制表位所需的空格数，并将 \t 替换为这些空格数。
*   If `\n`(new line) - 将其附加到输出字符串并在新行上将位置指针重置为 1。Windows 上的新行是`\r\n`和 Unix（或风味） use `\n`，所以我想这应该适用于两个平台。我已经在 Windows 上进行了测试，但没有方便的 Unix。
*   任何其他字符 - 将其附加到输出字符串并增加位置。

.

```
using System.Text;

namespace CSharpScratchPad
{
    class TabToSpaceConvertor
    {
        static int GetNearestTabStop(int currentPosition, int tabLength)
        {
            // If already at the tab stop, jump to the next tab stop.
            if ((currentPosition % tabLength) == 1)
                currentPosition += tabLength;
            else
            {
                // If in the middle of two tab stops, move forward to the nearest.
                for (int i = 0; i < tabLength; i++, currentPosition++)
                    if ((currentPosition % tabLength) == 1)
                        break;
            }

            return currentPosition;
        }

        public static string Process(string input, int tabLength)
        {
            if (string.IsNullOrEmpty(input))
                return input;

            StringBuilder output = new StringBuilder();

            int positionInOutput = 1;
            foreach (var c in input)
            {
                switch (c)
                {
                    case '\t':
                        int spacesToAdd = GetNearestTabStop(positionInOutput, tabLength) - positionInOutput;
                        output.Append(new string(' ', spacesToAdd));
                        positionInOutput += spacesToAdd;
                        break;

                    case '\n':
                        output.Append(c);
                        positionInOutput = 1;
                        break;

                    default:
                        output.Append(c);
                        positionInOutput++;
                        break;
                }
            }
            return output.ToString();
        }
    }
} 
```

调用代码如下：

```
string input = "I\tlove\tYosemite\tNational\tPark\t\t,\t\t\tGrand Canyon,\n\t\tand\tZion";
string output = CSharpScratchPad.TabToSpaceConvertor.Process(input, 4); 
```

输出字符串将获得值：

```
 I   love    Yosemite    National    Park        ,           Grand Canyon,
            and Zion 
```

**如何在编辑器中将制表符转换为空格？**

如果您偶然发现了这个问题，因为您在编辑器中找不到将制表符转换为空格的选项（就像我所做的那样，并想编写自己的实用程序来执行此操作），这里是该选项位于不同编辑器中的位置 -

```
Notepad++:              Edit → Blank Operations → TAB to Space
Visual Studio:          Edit → Advanced → Untabify Selected Lines
SQL Management Studio:  Edit → Advanced → Untabify Selected Lines 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-08-03T16:46:59.693

我不确定我的解决方案在执行上是否更高效，但它的代码更紧凑。这接近[用户*ckal*](https://stackoverflow.com/questions/508033/convert-tabs-to-spaces-in-a-net-string/508524#508524)的解决方案，但使用 Join 函数而不是“+=”重新组合拆分字符串。

```
public static string ExpandTabs(string input, int tabLength)
{
    string[] parts = input.Split('\t');
    int count = 0;
    int maxpart = parts.Count() - 1;
    foreach (string part in parts)
    {
        if (count < maxpart)
            parts[count] = part + new string(' ', tabLength - (part.Length % tabLength));
        count++;
    }
    return(string.Join("", parts));
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-02-17T22:30:28.140

这正是他们所说的需要。[我在Visual Basic 6.0](http://en.wikipedia.org/wiki/Visual_Basic#Timeline)中写回了这个。我做了一些快速的 VB.NET 2010 更新，但它可以使用一些更好的修复它。只需确定并设置所需的标签宽度即可；它在那里设置为8。只需将字符串发送给它，或者甚至像这样在文本框中修复它们：

```
RichTextBox1.Text = strFixTab(RichTextBox1.Text)

Function strFixTab(ByVal TheStr As String) As String
    Dim c As Integer
    Dim i As Integer
    Dim T As Integer
    Dim RetStr As String
    Dim ch As String
    Dim TabWidth as Integer = 8    ' Set the desired tab width

    c = 1
    For i = 1 To TheStr.Length
        ch = Mid(TheStr, i, 1)
        If ch = vbTab Then
            T = (TabWidth + 1) - (c Mod TabWidth)
            If T = TabWidth + 1 Then T = 1
            RetStr &= Space(T)
            c += T - 1
        Else
            RetStr &= ch
        End If
        If ch = vbCr Or ch = vbLf Then
            c = 1
        Else
            c += 1
        End If
    Next
    Return RetStr
End Function 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T17:26:53.413

您可以使用替换功能：

```
char tabs = '\u0009';
String newLine = withTabs.Replace(tabs.ToString(), "    "); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-11-26T14:49:56.117

这里有很多答案忽略了制表符表示*下一个制表位的空格数*，而不是“四个（或八个）空格”。相当多的答案也忽略了回车和换行，因此不处理多行内容。所以事不宜迟：

```
 public static string TabsToSpaces(string inTxt, int tabLen=4 )
    {
        var outTxt = new List<string>();

        var textValues = inTxt.Split('\t');

        foreach (var val in textValues)
        {
            var lines = val.Split("\r");
            var preTxt = lines[lines.Length - 1];
            preTxt = preTxt.Replace("\n", "");
            var numSpaces = tabLen - preTxt.Length % tabLen;
            if (numSpaces == 0)
                numSpaces = tabLen;
            outTxt.Add(val + new string(' ', numSpaces));
        }
        return String.Join("", outTxt);
    } 
```

（顺便说一下，这也是 CPU 高效的，因为它不会重新复制巨大的字符串。）

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-02-03T17:26:56.177

您希望能够将制表符转换为 N 个空格吗？一种快速而肮脏的选择是：

```
output = input.Replace("\t", "".PadRight(N, (char)" ")); 
```

显然 N 必须在某个地方定义，无论是用户输入还是程序中的其他地方。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-02-03T17:27:17.050

```
Regex.Replace(input, "\t", "    "); 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-02-03T17:34:10.450

我不确定您所说的“我不能假设一个选项卡应该包含多少个空格”是什么意思，但是这个示例将用您指定的任意数量的空格替换选项卡。

```
public static string ReplaceTabs(string value, int numSpaces)
{
   string spaces = new String(' ', numSpaces);
   return value.Replace("\t", spaces);     
} 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-02-03T19:29:27.847

我想每个人都已经涵盖了它，但制表符就是这样。一个字符... 该字符由 表示`\t`。每个应用程序都可以选择用一个空格、两个空格、四个空格、一个笑脸来显示。无论如何......所以......没有真正的答案。

# asp.net - 如何阻止 ASP.NET 在首次加载时从 bin 加载所有程序集

> ID：508034
> 
> 赞同：16
> 
> 时间：2009-02-03T17:21:37.327
> 
> 标签：asp.net

本机 DotNet 应用程序将在首次使用时加载所有引用的程序集（及其引用）。但是，ASP.NET 将在首次访问时加载所有引用的程序集（及其引用）。

1.  这种理解正确吗？

2.  有没有办法强制 ASP.NET 按需加载程序集（如本地应用程序）？

3.  我试图解决的具体情况是：

    *   bin 文件夹包含 2 个文件：*A.dll*和*B.dll*。
    *   *A.dll*引用*B.dll*。
    *   *B.dll*引用系统上其他地方的*C.dll 。*在这种情况下，缺少*C.dll*。
    *   *A.dll*由主应用程序加载（使用反射）。
    *   遇到的错误（*无法加载文件或程序集...*）与*B.dll*缺少依赖项有关。
    *   *如果缺少C.dll*，我们希望应用程序能够正常运行，因为这是主应用程序的可选组件。
    *   我们无法控制B.dll或*C.dll的**内容*。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-03T18:17:11.440

要回答第 3 点，导致在首次访问时加载 bin 文件夹中的所有程序集的设置可以在文件*C:\winnt\Microsoft.NET\Framework\v2.0.50727\CONFIG\web.config*中找到（取决于在您的环境中）。该文件的删减提取：

```
<system.web>
    <compilation>
        <assemblies>
            <add assembly="*" />
        </assemblies>
    </compilation>
</system.web> 
```

与通配符匹配的所有程序集都作为初始编译的一部分加载。

通过修改应用程序的 web.config（**不是**全局 DotNet 之一）以包含 Web 服务程序集并排除通配符匹配，如果缺少可选依赖项，应用程序似乎可以运行：

```
<system.web>
    <compilation>
        <assemblies>
            <remove assembly="*" />
            <add assembly="Main.Application.WebService, Version=1.0.0.0, Culture=neutral, PublicKeyToken=YOURKEYHERE" />
        </assemblies>
    </compilation>
</system.web> 
```

我们仍在对此进行试验，因此不确定这是否完全解决了问题或有任何不寻常的副作用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T17:26:22.933

asp.net 加载所有需要的程序集，因为工作进程创建了一个应用程序域，其中包含每个实例所需的所有程序集。

如果您想按需加载程序集，请尝试以这种方式使用反射，您可以控制加载程序集的方式和时间。

**编辑： **

如果您无法控制 B 和 C，但您说 B 需要 C 才能运行，并且 A 对 B 有硬引用。对我来说，听起来您需要 ABC 组件才能工作，您可以尝试从一个通过使它松散的夫妇。

您可以使用反射从 A 加载 B，但 B 仍然需要 C，它仍然会导致问题。

您的解决方案如何在没有 C 组件的情况下编译？

C存储在GAC中吗？

# c# - NHibernate 的 T4 模板？- 不流利的NHibernate

> ID：508035
> 
> 赞同：8
> 
> 时间：2009-02-03T17:21:39.930
> 
> 标签：c#, .net, nhibernate, t4

想知道是否有人知道一组 T4 模板，用于生成 C# POCO 类以及从数据库中的一组表映射 NHibernate 的 XML 文件。我看到 David Hayden 创建了 T4 用于基于 DBML 模型生成 FluentNH 代码，但我还没有准备好使用 FluentNH，因为还没有正式发布（尽管我喜欢这个想法）。

任何人都知道使用普通 NHibernate 的任何 T4 模板吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T18:57:07.430

可能不是您正在寻找的答案，但几个月前我花了很多时间到处寻找相同的东西。但是，我找不到任何东西。

不确定您是否出于任何特定原因使用 T4，但我最终使用 CodeSmith 进行代码生成，因为已经有几个模板可用。MyGeneration 有几个，但 CodeSmith 走得更远。

注意：如果你确实找到了一些，你应该把它贴在这里，因为我，可能还有其他人，会非常有兴趣为 nHibernate 找到一些做得好的 T4 模板。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-04T15:22:52.900

[LLBLGen](http://www.llblgen.com)即将发布的版本 (V3)，目前处于测试阶段，将包含用于生成 NHibernate POCO 类和映射的模板，以及用于 EF1/4 及其自己的框架的模板。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-02T12:09:01.013

我正在尝试制作一个。看看： [https ://code.google.com/p/t4nh/](https://code.google.com/p/t4nh/)

我在我的三个项目中使用了这个模板集，效果很好。以前没有发表，因为我仍然不知道人们是否可以很好地应用它。希望我可以在社区中更好地设置我的模板

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-09-17T14:53:08.330

试试 Devart 的 Entity Developer。我需要对动态字段进行一些调整的版本，但到目前为止我所看到的看起来不错。我需要编辑 T4 模板，并且更喜欢在 VS 中进行，而不是在 Entity Developer 中，这就是我找到这个线程的方式......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-04T11:41:20.717

CodeSmith 有从数据库生成 POCO 类和 NHibernate 映射文件的模板：http: [//www.codesmithtools.com/video/nhibernate.html](http://www.codesmithtools.com/video/nhibernate.html) [http://www.codesmithtools.com/features/frameworks.aspx](http://www.codesmithtools.com/features/frameworks.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-03-04T15:19:42.767

如果我没记错的话，[S#harpArchitecture 有一套](http://www.sharparchitecture.net)完整的 T4 模板，用于生成基于 NHibernate 的代码。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-04T10:05:25.720

NHibernate 主干中有几个工具，用于从数据库生成[hbm.xml映射文件的](http://nhforge.org/media/p/615.aspx)[Db2hbm](http://nhforge.org/media/p/546.aspx)（当前仅支持 MSSQL）和用于从 hbm 文件生成 POCO 的 Hbm2net。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-07-28T07:33:46.040

您可以为此目的使用 CodeSmith - 它有自己的模板来生成 NH 类。当然那不是 T4 而是更强大的模板引擎

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-07-21T14:03:30.230

Visual NHibernate (http://www.slyce.com/VisualNHibernate/) 还支持为实体定义模板，并生成 HBM.XML 和 Fluent NHibernate 映射。注意：我与 Visual NHibernate 没有任何关联。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-03-03T22:12:04.723

后续：我决定为 NHibernate xml 映射文件和 POCO 类编写自己的代码生成器。我在 T4 Toolbox 项目中的 Linq to SQL 生成器之后对其进行了建模。

我计划一有机会就发布有关经验并在[我的网站](http://nathanwdavis.com/)上提供下载。如果您有兴趣，请告诉我，我会尽快处理。

# sql - 不支持 SQL Server 版本 10 错误

> ID：508045
> 
> 赞同：3
> 
> 时间：2009-02-03T17:24:28.910
> 
> 标签：sql, sql-server, databasepublishingwizard

有人知道我在哪里可以找到 SQL Server 2008 的 SQL 数据库发布向导吗？当我尝试运行 1.1 版时，它说不支持 SQL Server 10 版。我发现了[一篇 MSDN 文章](http://msdn.microsoft.com/en-us/library/cc440724.aspx)，其中指出 Visual Studio 2008 中有 SQL Server 2008 的 SQL 数据库发布向导，但我不知道在哪里可以找到它。

我们从命令行使用 SQL 数据库发布向导来复制数据库的状态。

- -回答 - -

原来我需要为 Sql server 2005 安装 SP3 来修复“不支持 SQL Server 版本 10 错误”。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T20:32:22.247

原来我需要为 Sql server 2005 安装 SP3 来修复“不支持 SQL Server 版本 10 错误”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T17:43:50.633

如果数据库已添加到 Visual Studio 2008 解决方案中，您应该可以通过右键单击“发布到提供者”来查看它

# asp.net - 如何根据 DropDownList 的值触发 ModalPopupExtender？

> ID：508053
> 
> 赞同：1
> 
> 时间：2009-02-03T17:25:33.573
> 
> 标签：asp.net, asp.net-ajax, modalpopupextender

我有一个 DropDownList、一个按钮和一个 ModalPopupExtender。

当用户单击按钮时，根据他们选择的值，我想让按钮导致正常回发，或者触发 ModalPopupExtender（并取消按钮回发）。

我通过在服务器端使用 ModalPopupExtender.Show() 和 ModalPopupExtender.Enabled 实现了这一点，但想知道是否有人能想到更好的方法，使用 JavaScript 来避免回发。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-04T13:43:26.250

我已经使用一点 jQuery 让它工作了（尽管这不是必需的）。我将在另一次充实这个答案，但在此之前这里是基础知识：

```
<asp:HiddenField ID="ModalPopupExtenderHiddenField" runat="server" />

<asp:LinkButton OnClientClick="javascript:return ApplyButton_Click()" />

<uc:ModalPopupExtender TargetControlID="DiscardModalPopupExtenderHiddenField" BehaviorID="ModalPopupExtender" />

function ApplyButton_Click()
{
    if ($('.jsActionsDropDown')[0].value == 1)
    {
        $find('ModalPopupExtender').show();
        return false;
    }
} 
```

# c# - C#将当前对象传递给另一个对象？

> ID：508054
> 
> 赞同：5
> 
> 时间：2009-02-03T17:25:34.213
> 
> 标签：c#

我正在创建一个具有这样的构造函数的对象......

```
public class BusinessLogic()
{

     public BusinessLogic()
      {

           BusinessLogicSubClass blsc = new BusinessLogicSubClass(and I want to pass in BusinessLogic here)
      }
} 
```

我这样做是因为我希望 BusinessLogicSubClass 在完成一种或另一种方法时回调 BusinessLogic 中的不同方法。BusinessLogicSubClass 还使用构造函数注入来让我的单元测试与 NMock2 一起工作。

这里的任何建议都会有所帮助，提前谢谢你！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-03T17:28:37.343

```
 public BusinessLogic()
  {
       BusinessLogicSubClass blsc = new BusinessLogicSubClass(this);
  } 
```

对此的替代方案（以解决 Jon Skeet 的评论）是有一个构造函数和一个使用“this”指针的初始化程序：

```
public class BusinessLogic 
{
    private BusinessLogicSubClass blsc = null;

    public BusinessLogic() {}

    public void Initialize()
    {
        blsc = new BusinessLogicSubClass(this);
    }
}

public class Implementor
{
    public void SomeFunction()
    {
        BusinessLogic bl = new BusinessLogic();
        bl.Initialize();
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-03T17:28:47.030

您可以`this`在构造函数中使用。不过，这通常不是一个好主意，因为这意味着您在对象完成构建之前已经发布了引用。

不过，尚不清楚为什么要在类本身中创建子类-我怀疑您的继承层次结构可能并不理想。您能否提供更多细节，以便我们可以推荐更好的设计模式？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T17:31:39.223

您是否可以在属性上使用惰性实例化来延迟 BusinessLogicSubClass 的实例化，以便在您需要它时以及在 BusinessLogic 完成构建时进行？我认为这将是一个更好的设计。例如

```
public class BusinessLogic {

    private BusinessLogicSubClass mChild;

    public BusinessLogic() {
    }

    public BusinessLogicSubClass Child {
        get {
            return mChild ?? (mChild = new BusinessLogicSubClass(this));
        }
    }

    public class BusinessLogicSubClass {
        public BusinessLogicSubClass(BusinessLogic parent) {
        }
    }
} 
```

使用惰性实例化来防止传入`this`原始构造函数，这对于构造不正确的对象来说不是一个好主意——尽管根据其他情况可能没问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T17:30:05.607

所以，你想要这样的东西：

```
public class BusinessTest
{
    private BusinessSubTest aSub;

    public BusinessTest()
    {
        aSub = new BusinessSubTest(this);
    }

}

public class BusinessSubTest
{
    public BusinessSubTest(BusinessTest aTest)
    {

    }    
} 
```

还是我误读了这个问题？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T17:30:14.530

“这个”怎么样，例如

```
public BusinessLogic()
{
    BusinesLogicSubClass blsc = new BusinessLogicSubClass(this);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T17:35:33.273

如何使用构造 BusinessLogic 然后构造 BusinesLogicSubClass 将 BusinessLogic 实例传递到其构造函数的静态方法。

然后使用BusinessLogic实例上的一个属性来传入BusinesLogicSubClass？

例如...

```
public class BusinessLogic
{
    private BusinessLogicSubClass subClass;

    private BusinessLogic()
    {
    }

    public static BusinessLogic CreateBusinessLogic()
    {
        BusinessLogic bl = new BusinessLogic();
        BusinessLogicSubClass blsc = new BusinessLogicSubClass(bl);

        bl.subClass = blsc;
        return bl;
    }
} 
```

所以构造函数被标记为私有，所以构造对象的唯一方法是通过调用这样的静态方法......

```
BusinessLogic bl = BusinessLogic.CreateBusinessLogic(); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T21:45:43.843

看起来好像这是有效的。我认为这对我来说是一个错误。

使用 Initialize 而不是构造函数听起来不错，我想我会改用它。

惰性实例化看起来很不错，但是这个类现在是启动这个应用程序的类。也许我需要更多的东西来完成这项工作？（比如调用属性的东西？我想我有一个可以懒惰实例化它的调用者。我将不得不考虑更多。

我必须从 Si Keep 说我超出了我的领域才能真正理解答案。也许一个例子可以帮助我理解。

谢谢您的帮助。我稍后会尝试注册，因为 Stack Overflow 的第一次尝试似乎效果很好。:)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-02-03T17:28:51.647

我猜你想通过你刚刚创建的课程。使用 this 关键字，它传递当前对象。

```
public class BusinessLogic()
{

     public BusinessLogic()
      {

           BusinessLogicSubClass blsc = new BusinessLogicSubClass(this)
      }
} 
```

# perl - “本地我们的”是在 mod_perl2 下的对象模块中使用的东西，还是只在脚本中使用？

> ID：508065
> 
> 赞同：1
> 
> 时间：2009-02-03T17:27:21.930
> 
> 标签：perl, oop, module, mod-perl2

为了使您的脚本适合 mp2，避免需要任何兼容性包装器等，据说您应该使用“local our”而不是“my”来声明变量。在模块中呢？

```
sub new
{
    local our $type = shift;
    local our $self = {};
    bless $self, $type;
} 
```

是对的吗？或者它应该是“我的”，以便模块的其余部分可以在“使用严格”下获得 $self？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T18:52:57.093

`local our`是一个丑陋的结构，从长远来看会咬你。

有关更多详细信息，请参阅 Perlmonks 上的[线程](http://perlmonks.org/?node_id=574597)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T17:33:04.417

你肯定需要`my`。

该`local our`建议与模块中的全局变量有关。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T17:41:16.663

$self 在方法中也以 $_[0] 的形式获得（Perl 会自动在 @_ 前面加上它。）

# sql - 对分组数据应用多个条件的 SQL 查询

> ID：508075
> 
> 赞同：1
> 
> 时间：2009-02-03T17:29:22.317
> 
> 标签：sql

给定表格：

```
Exam (ExamId, SubjectId)
Result (ExamId, StudentId, GradeId) 
```

检索在每个科目的最近考试中收到 GradeId='A' in SubjectId='Maths' AND GradeId ='B' in SubjectId='English' 的学生列表的最佳方法是什么？我们可以假设 ExamIds 随着时间的推移而增加，或者在 Exam 中添加一个 ExamDate 列。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T20:02:23.553

您需要做的第一件事是处理“最近的考试”情况。

以下按科目获取每个学生的最新考试...

```
SELECT
  [Result].StudentID,
  [Exam].SubjectID,
  MAX([Exam].id) AS ExamID
FROM
  Result
     INNER JOIN
  Exam
     ON [Exam].id = [Result].ExamID
GROUP BY
  [Result].StudentID,
  [Exam].SubjectID 
```

然后，您需要获得每次考试的成绩，并应用您的限制...

```
SELECT
  [Recent].StudentID
FROM
(
  SELECT
    [Result].StudentID,
    [Exam].SubjectID,
    MAX([Exam].id) AS ExamID
  FROM
    Result
       INNER JOIN
    Exam
       ON [Exam].id = [Result].ExamID
  GROUP BY
    [Result].StudentID,
    [Exam].SubjectID
)
  AS [Recent]
INNER JOIN
  Result
    ON  [Result].StudentID = [Recent].StudentID
    AND [Result].ExamID    = [Recent].ExamID
GROUP BY
  [Recent].StudentID
HAVING
  MIN(      
    CASE [Exam].SubjectID
       WHEN 'Maths'   THEN CASE WHEN GradeID = 'A' THEN 1 ELSE 0 END
       WHEN 'English' THEN CASE WHEN GradeID = 'B' THEN 1 ELSE 0 END
       ELSE 1
    END
  )
  = 1 
```

如果您知道您只需要 MATHS 和 ENGLISH，则可以通过在 [Recent] 的子查询中放置 WHERE 子句来加快速度...

```
 WHERE
    [Exam].Subject IN ('Maths', 'English') 
```

编辑：

查询的“MIN(CASE) = 1”部分的工作方式如下...
- 如果主题是数学，他们得到 A，那么 1。否则 0。
- 如果主题是英语，他们得到 B ，则为 1。否则为 0。
- 如果主题是其他内容，则为 1。

如果其中任何一个返回 0，则忽略该学生。

因此，如果学生有数学：A、英语：B、地理：A，则地理不会导致 0，因此不会导致学生被忽略，无论他们的地理等级如何。

不过现在想一想，如果他们没有数学和/或英语成绩，他们仍然可以通过这项检查。如果您想排除未参加数学和/或英语测试的学生，请改用此 HAVING 子句...

```
 SUM(      
    CASE [Exam].SubjectID
       WHEN 'Maths'   THEN CASE WHEN GradeID = 'A' THEN 1 ELSE 0 END
       WHEN 'English' THEN CASE WHEN GradeID = 'B' THEN 1 ELSE 0 END
       ELSE 0
    END
  )
  = 2 
```

ELSE 0 确保忽略其他主题，SUM() = 2 确保两个条件都匹配。

编辑：

将要求放在一张表中（并加快一切速度）......

```
DECLARE @requirements TABLE (
  SubjectID    NVARCHAR(32),
  GradeID      NCHAR(1)
  )

INSERT INTO @requirements VALUES (N'Maths',   N'A')
INSERT INTO @requirements VALUES (N'English', N'B')

SELECT
  [Recent].StudentID
FROM
(
  SELECT
    [Result].StudentID     AS [StudentID],
    [Exam].SubjectID       AS [SubjectID],
    MAX([Exam].id)         AS [ExamID],
    [Requirements].GradeID AS [RequiredGrade]
  FROM
    Exam
  INNER JOIN
    @requirements [Requirements]
      ON [Requirements].SubjectID = [Exam].SubjectID
  INNER JOIN   
    Result
      ON [Exam].id = [Result].ExamID
  GROUP BY
    [Result].StudentID,
    [Exam].SubjectID,
    [Requirements].GradeID AS RequiredGrade
)
  AS [StudentExam]
INNER JOIN
  Result
    ON  [Result].StudentID = [StudentExam].StudentID
    AND [Result].ExamID    = [StudentExam].ExamID
    AND [Result].GradeID   = [StudentExam].RequiredGrade
GROUP BY
  [Recent].StudentID
HAVING
  COUNT(*) = (SELECT COUNT(*) FROM @requirements) 
```

如另一篇文章所述，如果您可以在其中获得 ExamDate，那将比 ExamID 列更可靠。还应该说，如果您对数据库有足够的控制权，您应该能够防止 Identity 值做任何事情，而不是继续前进。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T19:14:30.717

如果您从这篇文章中没有得到任何其他信息，那就这样吧：不要假设 ID 总是会增加。那只会导致黑暗面。输入一个考试日期（我不知道为什么你还没有，除非你的教授只是忘记把它放在作业问题中），然后用它来确定考试是在另一场考试之前还是之后。

也就是说，这里有两种可能的方法。两者都没有经过测试，因此您应该对其进行测试并确保您完全理解解决方案。毕竟他们可能正在参加考试。:)

```
SELECT
     ENG.StudentID
FROM
     Results ENG_RES
INNER JOIN Exams ENG_EX ON
     ENG_EX.ExamID = ENG_RES.ExamID AND
     ENG_EX.SubjectID = 'English'
INNER JOIN Results MATH_RES ON
     MATH_RES.StudentID = ENG_RES.StudentID AND
     MATH_RES.GradeID = 'A'
INNER JOIN Exams MATH_EX
     MATH_EX.ExamID = MATH_RES.ExamID AND
     MATH_EX.SubjectID = 'Math'
LEFT OUTER JOIN Results MATH_RES2 ON
     MATH_RES2.StudentID = ENG_RES.StudentID
LEFT OUTER JOIN Exams MATH_EX2
     MATH_EX2.ExamID = MATH_RES2.ExamID AND
     MATH_EX2.SubjectID = 'Math' AND
     MATH_EX2.ExamDate > MATH_EX.ExamDate
LEFT OUTER JOIN Results ENG_RES2 ON
     ENG_RES2.StudentID = ENG_RES.StudentID
LEFT OUTER JOIN Exams ENG_EX2
     ENG_EX2.ExamID = ENG_RES2.ExamID AND
     ENG_EX2.SubjectID = 'English' AND
     ENG_EX2.ExamDate > ENG_EX.ExamDate
WHERE
     ENG_RES.GradeID = 'B' AND
     MATH_EX2.ExamID IS NULL AND
     ENG_EX2.ExamID IS NULL 
```

或者：

```
SELECT
     ENG.StudentID
FROM
     Results ENG_RES
INNER JOIN Exams ENG_EX ON
     ENG_EX.ExamID = ENG_RES.ExamID AND
     ENG_EX.SubjectID = 'English'
INNER JOIN Results MATH_RES ON
     MATH_RES.StudentID = ENG_RES.StudentID AND
     MATH_RES.GradeID = 'A'
INNER JOIN Exams MATH_EX
     MATH_EX.ExamID = MATH_RES.ExamID AND
     MATH_EX.SubjectID = 'Math'
WHERE
     ENG_RES.GradeID = 'B' AND
     NOT EXISTS
          (
               SELECT *
               FROM
                    Results SQR1
               INNER JOIN Exams SQE1 ON
                    SQE1.ExamID = SQR1.ExamID AND
                    SQE1.SubjectID = 'Math' AND
                    SQE1.ExamDate > MATH_EX.ExamDate
               WHERE
                    SQR1.StudentID = ENG_RES.StudentID
          ) AND
     NOT EXISTS
          (
               SELECT *
               FROM
                    Results SQR2
               INNER JOIN Exams SQE2 ON
                    SQE2.ExamID = SQR2.ExamID AND
                    SQE2.SubjectID = 'English' AND
                    SQE2.ExamDate > ENG_EX.ExamDate
               WHERE
                    SQR2.StudentID = ENG_RES.StudentID
          ) 
```

# c# - 单声道功能齐全

> ID：508085
> 
> 赞同：1
> 
> 时间：2009-02-03T17:30:43.750
> 
> 标签：c#, .net, mono

Mono 是否遗漏了 .NET 的任何功能？如果没有，我们什么时候才能看到官方对它的认可，比如在 MSDN 的平台部分中包含 Mono 平台？

似乎它们被视为独立的事物。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T17:32:21.687

它们*是*不同的东西——Mono 是 .NET 的竞争对手。我非常怀疑我们是否会在 MSDN 上看到它的广告。你希望微软在那里有一个 Linux 发行版的广告吗？;)

（不，Mono[不包含 .NET 的所有内容](http://mono-project.com/Guidelines:Application_Portability#Missing_Functionality)。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T17:34:35.833

要查看 Mono 对象模型与 .NET Framework 中任何内容的状态，您可以转到[此](http://go-mono.com/status/)页面...

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-03T22:00:14.690

[MoMA](http://www.mono-project.com/MoMA)是一个有用的工具，用于检查您的程序集并报告任何潜在问题（例如，未实现的方法）。

Mono 有几件事需要注意。尽管 MoMA 的报告很好，但正如您所料，我们还是遇到了错误（包括新 2.2 版本中的回归）。你确实有源代码，我真的建议能够构建 Mono（特别是编译库的托管部分）。请务必通过 Mono 的公共 bugzilla 推送错误报告。

另外，请注意对第三方库的依赖。彻底的测试是必须的。例如，我们尝试将 xUnit.net 与单声道一起使用，并且效果很好。但是，它使用丑陋的反射黑客来设置私有成员变量的值（在 Exception 类中）。当然，这样的事情必然会导致运行时问题。再次，作为 xUnit.net 的源代码是开源的。

# c# - 什么物理引擎适合 Silverlight 池引擎？

> ID：508095
> 
> 赞同：4
> 
> 时间：2009-02-03T17:32:33.963
> 
> 标签：c#, silverlight, pool, billiards

我已经研究了 Farseer 引擎，但我几乎没有触及表面。它或其他引擎是否适合相当准确的台球游戏引擎？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-06T02:12:57.610

在我看来，Farseer 是你最好的选择。它是最受支持和最常用的，应该很容易完成像台球这样的 2D 游戏的任务。

# sql - 列的条件选择

> ID：508097
> 
> 赞同：4
> 
> 时间：2009-02-03T17:32:47.053
> 
> 标签：sql, database, conditional

也许您可以通过 SQL 查询帮助我：

我在辅助表中有一个转换值，结构如下：

```
ID PRICE_BRL PRICE_USD
-- --------- ---------
1  10        5
2  12        NULL
3  NULL      3
4  14        NULL
5  NULL      4
6  NULL      NULL 
```

我需要一个类似的结果集，它优先考虑第一列，如果为 NULL，则给我第二列值乘以存储在辅助表中的转换值。类似的东西，在伪代码中：

```
SELECT 
  id, 
  (
   IF (price_brl != null) 
     price_brl
   ELSE 
     price_usd * tbl_2.value
  ) as final_price
FROM tbl_1 
```

我认为使用 Joins 一定很简单，但我想不通！

提前致谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-03T17:34:38.703

伪代码也是：

```
select id, coalesce(price_brl, price_usd * tbl_2.value) 
from tbl_1
inner join tbl2 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T17:36:22.693

```
select  id, isnull( price_brl, price_usd * tbl_2.value)
from    tbl_1
    inner join tbl_2
        on tbl_1.id=tbl_2.id 
```

显然，您需要调整连接。但我认为这会奏效。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-03T17:37:37.887

coalesce() 语句完全符合您在示例中想要执行的操作，它在字段中测试 null，然后在它为 null 时提供不同的值。但是，如果您想做除了测试 null 之外的其他事情（它也适用于 null），您可以使用 case 语句：

```
SELECT id, CASE WHEN price_brl != NULL THEN price_brl ELSE price_usd * tbl_2.value END as final price... 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T18:01:37.120

另一种方法是：

```
SELECT id, 
CASE WHEN price_brl IS NULL THEN (price_usd * tbl_2.Value)
ELSE 
price_brl
END AS Final_Price
FROM tbl_1
JOIN tbl_2 ON /*Join Conditions and then Where conditions*/ 
```

但我会推荐上面的 Coallesce 选项（如果您有 3 个或更多选项）或 IsNull（因为看起来您有 2 个选项）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T17:45:52.753

假设您使用的是 SQL Server 或其他支持用户定义函数的系统，我会考虑创建一个封装逻辑的函数，因此我的选择将是

从 tbl1 中选择 udf_getPrice(id)

尽管这会带来一些开销，但从您的问题来看，您似乎并不处于性能对查询至关重要的位置。使用函数的优势在于，您使用的查询类型可能会发生业务变化——例如，除了美元之外，您可能会开始以欧元或日元采购，或者用于计算的规则可能会发生变化。将转换逻辑封装在一个函数中将增加一层抽象，可以为未来的维护带来丰厚的回报。

# mysql - MySQL：从另一台服务器选择

> ID：508100
> 
> 赞同：27
> 
> 时间：2009-02-03T17:33:29.830
> 
> 标签：mysql, networking, data-transfer

恐怕我已经知道我的问题的答案，但我还是会问：

当有两台 MySQL 数据库服务器时，我可以访问存储在另一台服务器上的数据吗？

换句话说：我可以以某种方式做到这一点：

```
INSERT INTO table (x, y, z)
   SELECT x, y, x+y
      FROM [otherserver].[database].[table] 
```

答案真的像“否”那么短吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-03T18:04:11.733

您可以在 MySQL 中设置联合表来完成您想要做的事情。有一些限制。

[http://dev.mysql.com/doc/refman/en/federated-storage-engine.html](http://dev.mysql.com/doc/refman/en/federated-storage-engine.html) [http://dev.mysql.com/doc/refman/en/federated-usagenotes.html](http://dev.mysql.com/doc/refman/en/federated-usagenotes.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2018-02-10T17:52:16.560

```
CREATE TABLE `remote_table`(
  `foo` VARCHAR(100),
  UNIQUE KEY(`foo`(30))
) ENGINE=FEDERATED CONNECTION='mysql://thedomain.com:3306/remotedbname/remotetablename'; 
```

然后像其他任何表一样使用 SELECT、UPDATE、INSERT、DELETE 查询它。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2021-01-12T12:15:04.750

你也可以这样做。假设您在目标框中（要将表复制到的位置）：

```
-bash$ mysqldump -u user -p password -h remote_host --databases \
db_name --tables table1 table2 table3 | mysql -u user -p password \
-D local_db_name 
```

这将使用 mysqldump 从远程主机提取数据并将其插入本地主机。

# regex - 用于电子邮件验证的正则表达式

> ID：508108
> 
> 赞同：11
> 
> 时间：2009-02-03T17:34:41.387
> 
> 标签：regex, email

我已经为一个非常简单的电子邮件验证编写了下面的正则表达式。我打算发送一个确认链接。

```
/.*@[a-z0-9.-]*/i 
```

但是，我想从当前状态增强它，因为这样的字符串不会产生预期的结果：

测试，my.name+test@gmail-something.co.uk，测试

“测试”部分不希望地包含在匹配中。我尝试了单词边界，但没有成功。

1.  我应该如何修改？
2.  即使我保持这个简单，是否有任何有效的电子邮件格式会被排除在外？

谢谢！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-03T17:40:59.160

It's a ***lot*** more complicated !!! See [Mail::RFC822::Address](http://www.ex-parrot.com/~pdw/Mail-RFC822-Address.html) and be scared...very scared.

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-03T17:37:15.280

**不要使用正则表达式来验证电子邮件地址**

相反，来自Ben Finney 编写的[mail.python.org/pipermail/python-list](https://web.archive.org/web/20090907143425/http://mail.python.org:80/pipermail/python-list/2006-September/404146.html) ^(1 。)

> 当人们问“我如何验证电子邮件地址是否有效？”时，我看到的最佳建议是。是“尝试向它发送邮件”。
> 
> 它既是 Pythonic 的，也是真正的最佳方式。如果你真的想确认，不要尝试静态验证；*使用*电子邮件地址，然后检查结果。向该地址发送电子邮件，除非您收到收件人的回复说“是的，这是使用正确的地址”，否则不要再使用它。
> 
> 发送系统的邮件传输代理，而不是正则表达式，确定将邮件发送到哪个域。
> 
> 域名系统，而不是正则表达式，决定了哪些域是有效的，以及哪个主机应该接收该域的邮件。
> 
> Most especially, the receiving mail system, not regular expressions, determines what local-parts are valid.

*^(¹[This is original link before it went dead](http://mail.python.org/pipermail/python-list/2006-September/404146.html))*

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-03T17:43:52.273

Almost nothing you use that is short enought to make sense looking at it will TRULY validate an email address. With that being said, here is what I typically use:

```
^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$ 
```

It's actually the built in regex for ASP.NET's regular expression validator for email addresses.

NOTE: many of the regexes given in this thread MAY have worked in the 90's, but TLD's are allowed to be less than 2 characters and more than 4 characters in today's web environment. For example, info@about.museum IS a valid email address because .museum is one of those new, long TLDs.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-03T19:30:59.700

I found that instead of matching the whole email-address against a regular expression, it is much more practical to just split the string at the @ and:

*   First check for existing MX or A records of the domain part via a DNS-library.
*   Then check the localpart (the part on the left hand side of the @) against a simpler regex.

The reason to do the DNS checking is that unreachable email-addresses albeit RFC-compliant are worth nothing. The reason for additionally checking the A-record is that they are used to determine where to deliver mail to when no MX record is found. (see RFC2821, 3.6)

Further tips:

*   Use a robust DNS resolver library, do not roll your own. Test it against large companies. These sometimes have a huge number of mailservers, which can lead to problems. I've seen a buggy library crap out on bmw.com. Just saying. :)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T17:44:58.167

Instead of . try matching every character except \s (whitespace):

```
/[^\s]*@[a-z0-9.-]*/i 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-03T17:41:12.357

A smaller two step regex provides good results

/** check to see if email address is in a valid format. * Leading character of mailbox must be alpha
* remaining characters alphanumeric plus -_ and dot
* domain base must be at least 2 characters
* domain extension must be at least 2, not more than 4 alpha
* Subdomains are permitted. * @version 050208 added apostrophe as valid char * @version 04/25/07 single letter email address and single
* letter domain names are permitted. */ public static boolean isValidEmailAddress(String address){ String sRegExp;

```
 // 050208 using the literal that was actually in place
    // 050719 tweaked 
    // 050907 tweaked, for spaces next to @ sign, two letter email left of @ ok
    // 042507 changed to allow single letter email addresses and single letter domain names
    // 080612 added trap and unit test for two adjacent @signs
    sRegExp =   "[a-z0-9#$%&]"          // don't lead with dot
        +   "[a-z0-9#$%&'\\.\\-_]*"     // more stuff dots OK
        +   "@[^\\.\\s@]"               // no dots or space or another @ sign next to @ sign
        +   "[a-z0-9_\\.\\-_]*"         // may or may  not have more character
        +   "\\.[a-z]{2,4}";            // ending with top level domain: com,. biz, .de, etc.

    boolean bTestOne =  java.util.regex.Pattern.compile( sRegExp,
            java.util.regex.Pattern.CASE_INSENSITIVE).matcher(address).matches();

    // should this work ?
    boolean bTwoDots =  java.util.regex.Pattern.compile("\\.\\.",  // no adjacent dots
                    java.util.regex.Pattern.CASE_INSENSITIVE).matcher(address).find();

    boolean bDotBefore = java.util.regex.Pattern.compile("[\\.\\s]@", //no dots or spaces before @
                         java.util.regex.Pattern.CASE_INSENSITIVE).matcher(address).find();

    return bTestOne && !bTwoDots && !bDotBefore;
}   // end IsValidEmail 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-03T17:41:55.770

this comes from Regex Buddy (definitely a need to buy prog!)

```
\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,6}\b 
```

# sql - SQL 中多列“级联”约束的优雅语法？

> ID：508109
> 
> 赞同：0
> 
> 时间：2009-02-03T17:34:45.007
> 
> 标签：sql

我正在构建一个查询，该查询自然会返回一个结果，该结果具有多个列的值，以及一些整数值分组列（指示特定值列是否被小计，但这本身与我的问题无关）。我想对此查询的分组列施加约束，如果所有分组列 1 - ( *n* -1) 也非零，则只接受分组列*n非零的行。*

 *似乎应该有一种用 SQL 表达这一点的好方法，但到目前为止我所能想到的只是相当繁琐

```
where ((grp1 = 0 AND grp2 = 0 AND grp3 = 0 AND ... AND grpn = 0)
    or (grp1 = 1 AND grp2 = 0 AND grp3 = 0 AND ... AND grpn = 0)
    or (grp1 = 1 AND grp2 = 1 AND grp3 = 0 AND ... AND grpn = 0)
    ...
    or (grp1 = 1 AND grp2 = 1 AND grp3 = 1 AND ... AND grpn = 1) 
```

如果您正在阅读它，这将更难理解这个概念，看起来 SQL 引擎更难进行体面的优化，并且通常也会阻塞日志，掩埋 SQL 的重要部分在噪音中。

由于这个概念似乎并不太不寻常，我希望有一种更好的方式来表达它，通常会更简洁，并希望在服务器本身上性能更高（假设我的幼稚版本不会那么高效） .

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T17:48:45.790

你说这些值是整数。他们可以是消极的吗？如果没有，您可以只使用一组比较：

```
where (grp1 >= grp2 and grp2 >= grp3 ...) 
```

编辑：实际上，我在这里也假设非零值必须为 1 ......但如果不是这种情况，我想这个原则仍然可以应用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T19:28:48.253

如果 (n) 是固定的，那么 Ben 的答案似乎是最好的。

如果您的数据已标准化并且 (n) 是可变的，我会假设您有类似这样的数据...

```
data_fk | grp_id | flag 
```

然后，您要搜索 data_fk，其中各种 grp_id 的标志符合您设定的规则。这条规则（在我看来）可以重述为......

(highest group_id where the flag = 1) 应该是 (lowest group_id where the flag = 0) 之前的 grp_id，或者所有标志为 1，或所有标志为 0。

```
SELECT
    data_fk
FROM
    a_table
GROUP BY
    data_fk
HAVING
    ISNULL(MIN(CASE WHEN flag = 0 THEN grp_id ELSE NULL END), MAX(grp_id) + 1)
    =
    MAX(CASE WHEN flag = 1 THEN grp_id ELSE 0 END) + 1 
```

# c# - 在 C# 中实现代理或装饰器类的最短方法是什么？

> ID：508110
> 
> 赞同：7
> 
> 时间：2009-02-03T17:34:49.827
> 
> 标签：c#, .net, reflection, proxy, decorator

当你有一个实现 IVehicle 的类 car 并且你想将它包装在一个装饰器中，将所有调用转发给 car 并计算它们，你会怎么做？

在 Ruby 中，我可以只构建一个没有任何方法的装饰器，并使用 method_missing 将所有调用转发到汽车对象。

在 Java 中，我可以构建一个 Proxy 对象，该对象通过一种方法运行所有代码并在之后转发它。

我可以在 C# 中做任何类似的事情吗？

* * *

更新：

根据答案和我读到的关于 System.Reflection.Emit 的内容，应该可以编写一个与此类似的方法：

```
Type proxyBuilder(Type someType, delagate functionToBeApplied, Object forward) 
```

其中 type 实现了 someType 的所有接口，执行 functionToBeApplied 然后将方法调用转发给对象，同时返回其返回值。

是否有一些库可以做到这一点，或者我必须自己编写？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T17:55:55.057

对于代理，如果您想使用标准类型，您可以查看“RealProxy”，但使用起来有点麻烦（并且它需要您的类继承自 MarshalByRefObject）。

```
public class TestProxy<T> : RealProxy where T : class
{
    public T Instance { get { return (T)GetTransparentProxy(); } }
    private readonly MarshalByRefObject refObject;
    private readonly string uri;

    public TestProxy() : base(typeof(T))
    {
        refObject = (MarshalByRefObject)Activator.CreateInstance(typeof(T));
        var objRef = RemotingServices.Marshal(refObject);
        uri = objRef.URI;
    }

    // You can find more info on what can be done in here off MSDN.
    public override IMessage Invoke(IMessage message)
    {
        Console.WriteLine("Invoke!");
        message.Properties["__Uri"] = uri;
        return ChannelServices.SyncDispatchMessage(message);
    }
} 
```

或者，您可以从 Castle 获得“DynamicProxy”。根据我的经验，它的效果要好一些。

如果您使用其中一个，您不一定会获得出色的性能，但我主要在可能会很慢的调用中使用它们。但是如果您愿意，可以尝试一下。

Marc 的解决方案会有更好的性能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T17:41:56.380

不幸的是，C# 中没有 mixin 支持。所以你需要实现所有方法，或者使用一些重型反射.emit 来做到这一点。另一种选择是（可选）代理/装饰器基类...

```
abstract class FooBase : IFoo {
   protected FooBase(IFoo next) {this.next = next;}
   private readonly IFoo next;
   public virtual void Bar() { // one of the interface methods
       next.Bar();
   }
   public virtual int Blop() { // one of the interface methods
       return next.Blop();
   }
   // etc
} 
```

然后

```
class SomeFoo : FooBase {
   public SomeFoo(IFoo next) : base(next) {}
   public override void Bar() {...}
} 
```

注意 的使用`FooBase`是严格可选的；任何 IFoo 都是允许的。

# asp-classic - 带有 Interdev 用户的 Windows 2000 Server - 如何查找和更改

> ID：508115
> 
> 赞同：0
> 
> 时间：2009-02-03T17:36:16.237
> 
> 标签：asp-classic, windows-server-2000

我继承了一个 Windows 2000 服务器，其中包含支持 Interdev 的站点。我不知道如何找出哪些“interdev 用户”映射到域/本地帐户或如何更改 Interdev 站点上的用户/密码。有人提到他们可以用“FPSE”或“Interdev”来做到这一点，但我不确定这意味着什么。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-09T21:09:29.943

一种选择是进入 Interdev，创建一个新项目或打开一个现有项目，然后：

1.  点击网站
2.  选择项目 -> Web 项目 -> Web 权限。
3.  点击“用户”
4.  添加/编辑此站点的用户。

Web 服务器上的用户和组也将显示这些用户和 FPSE 为这些管理员创建的组。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T17:54:07.870

FPSE 是 FrontPage 服务器扩展。Visual Interdev 使用 Frontpage 服务器扩展与服务器通信。

查看 vti_ 文件夹，我相信有一个或多个 dll 是一个 isapi 应用程序，您可以使用管理扩展。那里可能还有可编辑的文件来更改内容。自从使用VI以来已经很多年了，我不记得具体细节了。

# ajax - ASP.NET MVC RC ajax onsubmit

> ID：508120
> 
> 赞同：0
> 
> 时间：2009-02-03T17:37:06.623
> 
> 标签：ajax, asp.net-mvc

当我使用 preventDefault 选项时，onsubmit 的问题仍然存在。我的问题与[Asp.net mvc beta ajax 问题相同](https://stackoverflow.com/questions/237691/aspnet-mvc-beta-ajax-upgrade-problem)

```
<% using (this.Ajax.BeginForm("den2",
                              "Deneme",
                              null,
                              new AjaxOptions {
                                   UpdateTargetId = "panel1",
                                   InsertionMode=InsertionMode.Replace
                              },
                              new { id = "panelOneForm" })) { }  %>
<div class="panel" id="panel1">
   <img src="/Content/ajax-loader.gif" />
</div>
<script type="text/javascript">
   $get("panelOneForm").onsubmit({ preventDefault: function() { } });
</script> 
```

这次我收到以下错误：

```
e.type is undefined
var etype = this.type = e.type.toLowerCase(); 
```

当我调试它时：

```
 var e = Function._validateParams(arguments, [

 {name: "eventObject"} ]);

 if (e) throw e;

 var e = eventObject;

 var etype = this.type = e.type.toLowerCase();

 this.rawEvent = e;

 ...(function continues) at MicrosoftAjax.debug.js line 2862 
```

有没有办法解决它或者我应该传递这个方法中使用的每个参数属性？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T11:02:49.240

After some research, I found that was an issue with the RC version of MicrosoftAjax.js

It works fine if I use an older version of this file. Not a solution, but it will help temporarly.

# c# - 实体类的 GetHashCode() 的正确实现是什么？

> ID：508126
> 
> 赞同：15
> 
> 时间：2009-02-03T17:38:09.850
> 
> 标签：c#, .net, orm

下面是一个为实体基类重写 Object.Equals() 的示例实现，应用程序中的所有其他实体都派生自该实体基类。

所有实体类都有属性 Id，它是一个可为空的 int。（它是实体类对应的任何表的主键。）

```
public override bool Equals(object obj)
        {
            if (obj == null || GetType() != obj.GetType())
                return false;

            if (base.Equals(obj))
                return true;

            return Id.HasValue && ((EntityBase) obj).Id.HasValue &&
                   Id.Value == ((EntityBase) obj).Id.Value;
        } 
```

鉴于 Equals() 的这种实现，如何正确实现 GetHashCode()？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-03T17:45:22.847

如果您源自已经覆盖的东西，`GetHashCode`我会将其实现为：

```
public override int GetHashCode()
{
    unchecked
    {
        int hash = 37;
        hash = hash * 23 + base.GetHashCode();
        hash = hash * 23 + Id.GetHashCode();
        return hash;
    }
} 
```

Id 的空值将为 Id.GetHashCode() 返回 0。

如果您的类只是从 Object 派生，我会返回`Id.GetHashCode()`- 您*不想*在哈希码中包含`object.GetHashCode`实现，因为这基本上最终成为对象标识。

请注意，如果两个实体都没有 Id，则您的相等定义*将不会*返回，但两个对象都会返回相同的哈希码。`true`您可能希望考虑更改您的 Equals 实现。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-24T19:12:24.743

Jon Skeet 回答的是一个很好的解决方案，但是，您可能想要添加一个未经检查的代码块以允许整数溢出

```
unchecked
{
  int hash = ...;
  return hash
} 
```

[https://msdn.microsoft.com/en-us/library/khy08726(v=vs.140).aspx](https://msdn.microsoft.com/en-us/library/khy08726(v=vs.140).aspx)

> 如果未指定选中或未选中，则默认上下文取决于编译器选项等外部因素。

我还想再次补充一点，`base.GetHashCode()`在 POCO 上使用将调用 default `object.GetHashCode`。这绝对不是你想要的...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-12-12T21:24:01.550

将类型用作哈希码的一部分怎么样？
这会是一个很好的实现吗？

```
public class Foo
{
    public int Id { get; set; }

    // other properties here
    // ......

    public override int GetHashCode()
    {
        int hash = 37;
        hash = hash * 23 + typeof(Foo).GetHashCode();
        hash = hash * 23 + Id.GetHashCode();
        return hash;
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T17:40:23.137

只有当属性在实例的生命周期内（或至少在需要使用其哈希值时，例如当对象位于需要哈希值的映射或其他集合中时）`GetHashCode()`该属性是不可变的时，您才能正确实现。`Id`

假设是这样，您可以将 的值`Id`用作所有有效值的散列，然后将固定散列用于空值。我不记得最合适的是什么，但我会假设一个随机选择的 null 值（在编译之前随机选择，而不是在运行时）或有效值的中间`Id`值（即介于 0 和 int.Max 之间的中间值）。

# svn - 如何防止 SVN 更新存储库中已经存在的目录

> ID：508135
> 
> 赞同：13
> 
> 时间：2009-02-03T17:41:13.340
> 
> 标签：svn, ignore

我不认为这不是标准的 svn 忽略问题。

我有一个存储库，其中包含我不想要的巨大目录。因为其他使用存储库的人*这样做*，我不能只是从树中删除它。但是，我不想每次执行 svn up 时都重新下载这个目录。我可以理解，忽略会阻止我拥有的目录被上传到 svn，但我怎么能告诉 svn 我不希望它重新下载已经在存储库中的特定目录。

我做什么...

```
svn up
rm badDirectory 
```

然后future svn up重新下载它。我想阻止这种情况。

谢谢！

编辑：好的。我希望 SVN 有一个我还没有注意到的内置选项。我希望避免不得不“破解”颠覆的不足之处，但下面的选项似乎是可以接受的替代方案。

再次编辑以解决一些评论：

> 是否有特殊原因导致您无法签出该文件夹并保留它？没有磁盘空间（可能没有，因为你可以签出它）？安全原因？

我可以查看文件夹。整个 svn 存储库大约有 291 兆。其中 290 位于这个“坏”目录中。基本上，其他一些可以控制存储库的人（因此可以决定其中的内容）会在其中放置一个真正不需要的目录。我并不是说这是关于政策和使用 svn 的“正确和正确”方式的问题。我只是想知道是否有技术解决方案。

> 您能否更好地描述存储库的树结构？是否有与坏目录处于同一级别的文件，或者只有其他目录？——</p>

基本结构：

```
repository root
 - good dir 1
    - plenty of subdirs in all of these directories
 - good dir 2
 - good dir X
 - bad dir 1
 - bad dir 2
 - bad dir X 
 - good file 1
 - good file 2
 - good file X 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2011-02-16T18:24:40.563

我选择了类似于 Stefan 提到的稀疏结帐路线。不同之处在于我排除了整个目录。

这是我为排除整个目录及其所有子目录所做的。注意：不需要的目录已经在我的磁盘上，所以我先将其删除。

`$ rm -rf unwanted-directory
$ svn checkout url/to/repo/unwanted-directory unwanted-directory --depth empty
$ cd root/of/my/tree
$ svn update` <- 不需要的目录不是从存储库中获取的

作为参考，我们的树中有一个“原型”目录，其中包含一堆实验代码。因为我不在这个领域工作，所以我对在我的多个开发树中使用 1G 资源没有兴趣。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-03T18:34:01.110

您可以进行[稀疏结帐](http://svnbook.red-bean.com/en/1.5/svn.advanced.sparsedirs.html)：

```
svn co url/to/repo mywc --depth=files 
```

这将为您提供一个 wc，其中只有文件，没有子文件夹。您现在可以获取所需的所有文件夹

```
svn up url/to/repo/subfolder1 --set-depth infinity 
svn up url/to/repo/subfolder2 --set-depth infinity 
svn up url/to/repo/subfolder3 --set-depth infinity 
... 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-03T17:47:23.467

您可以使用脚本 svn update --non-recursive 当前目录，然后以递归方式单独更新剩余的子目录。使用 bash 脚本，您可以遍历所有子目录并跳过有问题的子目录。

像这样的东西：

```
#!/bin/bash

BADDIR="bad"
FILELIST="*"

svn update --non-recursive

for file in $FILELIST
do
if [ -d $file ]
then
   if [ $file != $BADDIR ] 
   then
     svn update $file
   fi
fi
done 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-03T17:49:10.157

如果您重命名坏文件夹中的 .svn 目录然后运行更新，svn 将跳过该目录并说它已被删除，即使它仍然存在。

但是，当您要提交时，您需要将其放回原处，至少在包含错误目录的上层。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-06-13T09:45:03.523

更新所有当前位置数据，除了一些坏目录：

```
svn up `svn ls | grep -v badDirectory` 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T17:51:50.977

您可以指定 --non-recursive 或 -N 来禁止它获取所有子目录

并且明确地对您想要的内容进行更新。

一个小批处理文件将使其易于重复

\0

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-04T11:42:55.777

已经提供了解决方案，我会说需要定期忽略存储库的一部分是存储库结构不良的明显迹象。尝试找到一种方法将其移动到存储库中的其他位置或类似的位置。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-25T15:51:20.943

Kirby 的解决方案很干净，只是它不更新当前目录。

如果你有这样的结构：

```
root -
     |-subdir1
     |-subdir2
     |-fileA
     |-fileB 
```

Kirby 的解决方案不会更新 fileA、fileB 和稍后添加到根目录的任何其他文件。

您需要添加一个“svn up -N”。您可以使用别名和分号来执行此操作：

```
alias myup='ls | args svn up; svn up -N' 
```

（这是 bash 别名语法。如果您使用不同的 shell，请根据需要进行更改）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-02-25T08:09:59.627

使用以下命令

```
find -maxdepth 1 ! -name . ! -name .svn ! -name badDirectory -exec svn up {} \; 
```

继续在 -exec 之前附加所有目录，例如！-name 目录名

```
find -maxdepth 1 ! -name . ! -name .svn ! -name badDirectory ! -name badDirectory2 ! -name badDirectory3 -exec svn up {} \; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-11-10T19:41:22.717

在考虑特定于供应商的解决方案时，在 TortoiseSVN 中，您可以按照[手册页](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-checkout.html "签出工作副本")中描述的过程来实现它，在“结帐深度”部分中列出之后。

> 如果您签出一个稀疏的工作副本（即，通过为签出深度选择完全递归以外的其他内容），您可以稍后使用存储库浏览器（称为“存储库浏览器”的部分）或检查修改对话框（称为“本地和远程状态”的部分）。
> 
> 在 Windows 资源管理器中，右键单击已签出的文件夹，然后使用 TortoiseSVN → Repo-Browser 调出存储库浏览器。找到您要添加到工作副本的子文件夹，然后使用上下文菜单 → 更新项目以修订...。

**但是：**我想补充一点，我会更改最后一步。不要从工作副本中找到要添加（或删除）的子文件夹，而是右键单击根文件夹，选择“将项目更新为修订...”，在工作深度上单击按钮“选择项目”并选择打开的文件管理器上的所有子项。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-07-15T19:04:39.313

我看到这个问题在很久以前就被问过了，但如果你仍然感兴趣，我偶然发现了一个很好的博客，它解释了使用“svn:ignore”的不同方法

这是链接：[http ://superchlorine.com/2013/08/getting-svn-to-ignore-files-and-directories/](http://superchlorine.com/2013/08/getting-svn-to-ignore-files-and-directories/)

如博客中所述，您可能可以在文件中创建“坏文件夹”列表并使用“svn propset svn:ignore -RF bad_folder_list_file”

希望有帮助！

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-02-03T18:00:04.503

如果它不是您（或您的团队）日常工作所必需的文件夹，您可以要求管理员更新 svn 层次结构以将该文件夹移动到与您必须更新的文件夹相同（或更高）的级别。

例如

```
projet - 非必要文件夹
       \ 基本文件夹
```

并且您只需要更新（签出）“基本文件夹”，其他人也必须更新（签出）“非必要文件夹”。

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2009-02-18T21:09:40.487

所以我只是想出了我认为最快的问题答案。由于 SVN 无法自动忽略我不想更新的目录...

这是我现有的目录结构：

根 -> goodDir 1 -> goodDir 2 等

我已经从结帐中删除了坏目录。我无法从根目录执行“svn up”，因为它会尝试重新检查坏目录。

但是，以下命令效果很好：

```
 ls | xargs svn up 
```

简短、甜美、简单且易于记忆。

# ruby - 即使引号被转义，Ruby CSV“非法引用”

> ID：508141
> 
> 赞同：2
> 
> 时间：2009-02-03T17:42:12.010
> 
> 标签：ruby, csv

我正在使用 FasterCSV 解析一个制表符分隔的文件：

```
 csv_rows = FasterCSV.readlines(file_location, {:col_sep=>"\t"}) 
```

当我解析这个时，我得到一个“第 1 行的非法引用”。错误。该行包含以下文本：

```
...around \"foo bar\" with... 
```

是否有另一种方法可以逃避可能有效的引号？

谢谢，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T18:14:44.877

> 是否有另一种方法可以逃避可能有效的引号？

“...围绕”“foo bar””与...”

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T17:27:12.787

顺便说一句，我认为常规的 CSV 课程会接受这一点。

# python - 快速 PDF 拆分器库

> ID：508144
> 
> 赞同：7
> 
> 时间：2009-02-03T17:42:37.033
> 
> 标签：python, c, pdf, pypdf

pyPdf 是一个很好的拆分、合并 PDF 文件的库。我正在使用它将 pdf 文档拆分为 1 页文档。pyPdf 是纯python，在保存提取的页面时，在 PdfFileWriter 对象的 _sweepIndirectReferences() 方法中花费了相当多的时间。我需要性能更好的东西。我尝试过使用多线程，但由于大部分时间都花在 python 代码中，因此 GIL 并没有提高速度（它实际上运行速度较慢）。

是否有任何用 c 编写的提供相同功能的库？或者是否有人对如何提高性能有一个好主意（除了为我要拆分的每个 pdf 文件生成一个新进程）

先感谢您。

跟进。几个命令行解决方案的链接，有时可以证明比 pyPDF 更快：

*   [http://multivalent.sourceforge.net/Tools/pdf/Split.html](http://multivalent.sourceforge.net/Tools/pdf/Split.html)
*   [http://www.linuxsolutions.fr/how-to-extract-pages-from-a-pdf/](http://www.linuxsolutions.fr/how-to-extract-pages-from-a-pdf/)

我修改了 pyPDF PdfWriter 类以跟踪在 _sweepIndirectReferences() 方法上花费了多少时间。如果它太长（现在我使用 3 秒的神奇值），那么我通过从 python 调用它来恢复使用 ghostscript。

感谢您的所有回答。（codelogic 的 xpdf 参考是让我寻找不同方法的参考）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T18:53:10.900

[mbtPdfAsm](http://thierry.schmit.free.fr/spip/spip.php?article15)是一个快速、开源的 PDF 处理命令行工具。

[Xpdf](http://www.foolabs.com/xpdf/download.html)也值得一提，因为它是 GPL 并且是用 C++ 编写的。源代码模块化良好，允许编写命令行工具。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-04T02:47:53.097

它必须是python吗？我的纯 Perl 库[CAM::PDF](http://search.cpan.org/dist/CAM-PDF/)在追加和删除 PDF 文档页面方面非常快。在可能的情况下，它将清扫工作保存到最后。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T17:55:37.273

pdfLaTex 可以做很多 PDF 管理，而且速度*非常*快。

我已经将它用于一些相当复杂的拼版工作流。TeX 语言对编程来说真的很陌生，但是很容易编写一个 python 脚本来生成所需的 LaTex 布局并对其进行处理。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T21:44:30.710

您是否尝试过将[Psyco](http://psyco.sourceforge.net/)与 pyPdf 一起使用？

# c# - ProcessStartInfo.WindowStyle c#

> ID：508149
> 
> 赞同：1
> 
> 时间：2009-02-03T17:43:38.687
> 
> 标签：c#

我使用以下内容启动我的一个应用程序

```
 // Start the process
 ProcessStartInfo startInfo = new ProcessStartInfo(this.exeName);

 startInfo.WindowStyle = ProcessWindowStyle.Minimized;

 controlProcess = System.Diagnostics.Process.Start(startInfo); 
```

我看到的行为是，如果我的任务栏中没有项目，上面会启动我的独立应用程序，通过使用属性 this.exeName 获取应用程序的路径，并且在任务栏上可以看到独立应用程序。

如果我的任务栏只有几个项目，则不会发生上述情况，并且只有当我在任务管理器中找到它时才知道我的独立应用程序，这是我想要的，而不是上面段落中描述的场景。

本质上，我想启动一个应用程序并使其保持运行而不显示其 UI，更像是预加载应用程序，当用户单击某些操作时，使应用程序聚焦并启用它，以便用户可以执行操作

我的示例代码来自这里，看看这是否是我自己的实验项目的可行解决方案

[链接文本](http://www.codeproject.com/KB/miscctrl/AppControl.aspx)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T18:22:38.700

您需要在要启动的应用程序的主窗体上将 ShowInTaskbar 属性设置为 false。此外，您需要隐藏表单，直到用户操作请求显示它。

如果您想保持应用程序在某种程度上可见，您还可以将 notifyIcon 添加到系统托盘。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T17:48:25.337

执行您要求的操作（预加载应用程序）的可能性完全取决于应用程序的功能；在启动进程时，您不能独立地对进程进行这种控制。

# c# - 如何按文件大小对列表视图进行排序？

> ID：508165
> 
> 赞同：0
> 
> 时间：2009-02-03T17:47:30.113
> 
> 标签：c#, sorting, file

我有一个包含 4 列的列表视图 - 名称、扩展名、大小和位置。我有一种方法，它以字节为单位获取文件大小并根据需要转换为 KB、MB、GB 等。一个示例输出是一个 1024 字节的文件，打印为“1KB”。然后将该值放置在列表视图中。

我需要做的是智能地对大小列进行排序。现在排序只是一个简单的比较，所以 1025 KB 高于 1024 MB。我怎样才能让它“知道大小”？

我当前的排序代码来自这篇知识库文章： http: [//support.microsoft.com/kb/319401](http://support.microsoft.com/kb/319401) 这是我生成文件大小文本的代码：

```
 public static string getDynamicFileSize(string fileName)
    {
        FileInfo fi = new FileInfo(fileName);
        long sizeInBytes = fi.Length;
        if (sizeInBytes >= 1073741824)
        {
            double sizeInGB = sizeInBytes / Math.Pow(1024, 3);
            return Math.Round(sizeInGB, 2) + " GB";
        }

        if (sizeInBytes >= 1048576)
        {
            double sizeInMB = sizeInBytes / Math.Pow(1024, 2);
            return Math.Round(sizeInMB, 2) + " MB";
        }

        if (sizeInBytes >= 1024)
        {
            double sizeInKB = sizeInBytes / Math.Pow(1024,1);
            return Math.Round(sizeInKB, 2) + " KB";
        }

        //No conversion needed
        return sizeInBytes + " bytes";
    } 
```

谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T18:14:09.607

.NET 中的大多数对象都有一个 Tag 成员。这是一个你可以塞进任何你需要的东西的地方。在您的情况下，我会将文件大小（以字节为单位）填充到 ListViewSubItem.Tag 属性中。然后，您的排序算法可以使用它来排序而不是列文本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-07-02T06:06:05.747

以下答案可能重复。它应该很容易解决你的问题。

[如何对包含文件大小数据的列表视图列进行排序？C＃](https://stackoverflow.com/questions/6035815/how-to-sort-a-listview-column-that-contains-file-size-data-c-sharp/11288425#11288425)

# iphone - 如何创建像 iPhone 主屏幕这样的图标网格？

> ID：508167
> 
> 赞同：11
> 
> 时间：2009-02-03T17:48:00.703
> 
> 标签：iphone, cocoa-touch, uitableview, uibutton, quartz-graphics

我应该如何在 iPhone 上创建类似于 Springboard（主屏幕）的 UI？我想要一个带有图像的均匀间隔按钮网格，我可以在其中响应按钮点击。

UITable 是否合适？我应该使用普通的 UIView 并在 DrawRect 中手动定位图标吗？是否有替代方案可以自动均匀地排列按钮、允许重新组织并根据 iPhone 方向调整布局？

我来自 C#/Winforms 背景，现在刚刚开始使用 2.2.1 标头在 Open Toolchain 上进行 iPhone 开发。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-02-06T04:46:16.133

我写了一些示例代码来做这样的事情。请参阅我的[Tiles](http://undefinedvalue.com/2010/02/05/iphone-sample-code-tiles-arrangement)博客条目，或直接下载代码：[Tiles-v1.0.zip](http://undefinedvalue.com/sites/undefinedvalue.com/files/Tiles-v1.0.zip)。

我的代码将图标创建为核心动画层，而不是 UIView，但确实演示了如何检测点击并允许重新组织图标。它不处理方向变化。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-06-29T17:45:41.753

旧线程，但您也应该查看 Alan Quartrmain 的[AQGridView](http://github.com/AlanQuatermain/AQGridView)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T19:38:41.060

您需要将您的图标（它们是某种 UIViews）添加为“Springboard”视图的子视图。不需要自定义绘图，UITable 是绝对错误的方法。您只需要进行数学运算即可正确放置它们（通过设置它们的框架）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-04T20:06:07.353

@August：我听取了您的建议并将 UIButtons 添加为 UIView 的子视图，而不是进一步研究 UITable。谢谢！

希望下面的代码将有助于启动其他人。我在网格中静态放置了 4 个按钮。根据父 UIView 的边界和方向放置任意数量的按钮应该不会更难。

```
@implementation IconView
- (id)initWithFrame:(struct CGRect)windowRect{
  self = [super initWithFrame: windowRect];
  if (self != nil){
    for(int i = 0; i < 4; i++){
      buttons[i] = [self buildButton];
      [self addSubview: buttons[i]];
    }
    [self reInit];
  }
  return self;
}
- (UIButton *) buildButton{
  UIButton *button = [[UIButton alloc] initWithFrame:CGRectMake(0, 0, 60, 60)];
  [button setBackgroundImage: [[UIImage imageNamed:@"icon.png"] stretchableImageWithLeftCapWidth:60 topCapHeight:0] forState:UIControlStateNormal];
  return [button autorelease];
}
- (void)reInit{
  CGRect rect;
  rect = buttons[0].frame;
  rect.origin = CGPointMake(5, 5);
  buttons[0].frame = rect;

  rect = buttons[1].frame;
  rect.origin = CGPointMake(70, 5);
  buttons[1].frame = rect;

  rect = buttons[2].frame;
  rect.origin = CGPointMake(5, 70);
  buttons[2].frame = rect;

  rect = buttons[3].frame;
  rect.origin = CGPointMake(70, 70);
  buttons[3].frame = rect;
}
@end 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-23T10:50:51.767

使用 Arijasoft 的 gridView 实现。它是一个静态库，可让您使用回调和委托方法生成网格类型的视图以进行优化

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-03-16T19:50:14.447

如上所述，使用 UIView 并进行数学布局视图是最简单的选择。

从 developer.apple.com 检查示例代码[https://developer.apple.com/library/ios/#samplecode/PageControl/Introduction/Intro.html#//apple_ref/doc/uid/DTS40007795](https://developer.apple.com/library/ios/#samplecode/PageControl/Introduction/Intro.html#//apple_ref/doc/uid/DTS40007795)

根据您的要求，您可能不需要使用任何外部框架。

# .net - 在 .NET 中实现嵌套的异步“调用堆栈”场景

> ID：508177
> 
> 赞同：1
> 
> 时间：2009-02-03T17:51:12.413
> 
> 标签：.net, silverlight, web-services, architecture

我正在尝试重构一些适度复杂的现有 .NET 代码，以便在 Silverlight 中使用。核心问题是所有 Silverlight Web 服务调用必须是异步的，并且现有代码是以相当典型的同步方式实现的。

典型操作的现有调用堆栈可能是这样的：

Page -> GetPersonMethod -> PersonBusinessObject -> PersonDataObject -> CallWebservice -> （冒泡响应回栈）

我的想法是将所有方法拆分为单独的请求和响应方法，并保留应用程序的整体结构。

相同操作的新调用堆栈将如下所示：

页面 -> GetPersonRequest -> PersonBusinessRequest -> PersonDataRequest -> WebserviceRequest

页面 <- GetPersonResponse <- PersonBusinessResponse <- PersonDataResponse <- WebserviceResponse

核心问题：

1.  这是一个糟糕的想法吗，我真的应该用更异步的视角从头开始重写它吗？

2.  假设我采用这种方法，如何为嵌套响应保留调用堆栈？

TIA-

-埃里克

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-04T05:33:44.320

1.  您不能阻止主 Silverlight 线程，否则您的 UI 将挂起。这就是 SL 中的所有网络操作都被强制异步的原因。
2.  除了 UI 线程，您不能从任何线程触摸 UI。

这是两个约束。我解决这个问题的方法是创建一个“异步包装器”函数来为你包装它。它需要 3 个函数（委托）： 1\. 在新线程上执行（“f”）（确保您没有在函数中捕获任何 UI 对象！） 2\. 在异常时执行（“econt”） 3 . 完成时执行（“cont”）

两个延续都将通过 System.Windows.Deployment.Current.Dispatcher.BeginInvoke 在 UI 线程上调度。

有了这个，您只需将 Web 服务调用更改为“通过异步同步”，正如 mbeckish 所说（使用 ManualResetEvent，来自同步线程的 WaitOne，在回调中设置）。

帮助程序的代码可能看起来像这样（伪代码，没有检查它）：

```
static void AsyncHelp<T>(Func<T> f, Action<Exception> econt, Action<T> cont) {
  var t = new Thread((_) => {
    try {
      var res = f();
      System.Windows.Deployment.Current.Dispatcher.BeginInvoke(() => cont(res));
    } catch (Exception ex) {
      System.Windows.Deployment.Current.Dispatcher.BeginInvoke(() => econt(ex));
    }
  });
  t.Start();
} 
```

你最终会像这样使用它：

```
some_handler() {
  var id = mytextbox.Text; // Save from UI to local
  AsyncHelp( 
    () => GetBla(id), 
    bla => result.Text = bla.ToString(), // This is safe cause it's dispatched
    ex => error.Text = ex.ToString()
  );
} 
```

**更新** 要通过异步调用同步，你会做这样的事情，假设你使用默认的“基于事件的异步模式”（使用 BeginXXX/EndXXX 更容易，IMO）。

```
Exception ex;
Result r;
var mre = new ManualResetEvent(false);
myService.OnGetBlaCompleted += (_, e) => {
  ex = e.Error;
  r = e.Result;
  mre.Set();
}
myService.GetBlaAsync(id);
mre.WaitOne();
if (ex != null) throw ex;
// and so on 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T18:11:53.417

为避免重构，您可以将 CallWebService 实现为内部使用异步请求/响应的同步方法：

1.  发出异步请求后，对 ManualResetEvent 执行 WaitOne()。
2.  在回调中，对 ManualResetEvent 执行 Set()。

请参阅[http://msdn.microsoft.com/en-us/library/system.net.webrequest.endgetrequeststream.aspx](http://msdn.microsoft.com/en-us/library/system.net.webrequest.endgetrequeststream.aspx)

# python - 从python中的URL获取站点名称

> ID：508183
> 
> 赞同：1
> 
> 时间：2009-02-03T17:53:30.770
> 
> 标签：python

我是 Python 新手，它似乎有很多我不知道的好功能。我可以使用什么函数来获取根站点名称？例如，如果我为函数提供 URL“ [http://www.faqs.org/docs/diveintopython/kgp_commandline.html ”，我将如何获得](http://ttp://www.faqs.org/docs/diveintopython/kgp_commandline.html)*faqs.org*？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T17:57:18.097

```
 >>> from urllib.parse import urlparse
 >>> urlparse('http://www.cwi.nl:80/%7Eguido/Python.html').hostname
 'www.cwi.nl' 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T17:58:24.710

被忽视的[urlparse](http://www.python.org/doc/2.5.4/lib/module-urlparse.html)模块：

```
from urlparse import urlparse
scheme, netloc, path, params, query, fragment = urlparse("http://www.faqs.org/docs/diveintopython/kgp_commandline.html")
print netloc 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T18:08:01.257

你在用什么版本的 Python 学习？请注意，SilentGhost 的答案适用于 Python 3.0，而 Alabaster Codify 的答案适用于 2.x 系列。

# google-app-engine - 有谁知道您是否可以在使用 Google App Engine 开发的网站上使用 Amazon 的 s3？

> ID：508187
> 
> 赞同：4
> 
> 时间：2009-02-03T17:54:12.003
> 
> 标签：google-app-engine, amazon-s3

如果将亚马逊的 S3 服务与 Google App Engine 一起使用，会违反与 Google App Engine 的协议条款吗？我知道你能做什么和不能做什么是有限制的，但我不确定这一点。

拥有这两个组合功能，与托管公司相比，可以以相对较低的成本提供一个系统。

有没有人已经这样做了，或者听说过结合了这两种技术的应用程序？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T18:33:52.920

**免责声明 - 这不应被解释为法律建议**

我对您的应用程序的内部运作了解不多，但似乎在 Google 或 Amazon 的服务条款中没有任何限制。仔细阅读有关细节的条款，如果您还有其他问题，请提出！

以下是 Google 当前的限制（禁止操作、内容）

*   [App Engine 计划政策](http://code.google.com/appengine/program_policies.html)

这是亚马逊的 S3 服务条款

*   [亚马逊的 S3 服务条款](http://aws.amazon.com/agreement/)

最后，Google App Engine 的服务条款

*   [App Engine 服务条款](http://code.google.com/appengine/terms.html)

**编辑：** 看起来有几个人也在尝试这个。见[这里](http://rel.me/2008/09/23/shrub-s3-proxy-service-on-google-app-engine/)和[这里](http://www.idlewords.com/2008/08/using_google_app_engine_with_amazon_web_services.htm)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-13T15:45:22.520

我正在为我的 AppEngine 应用程序寻找一些文件存储，并找到了将 AppEngine 与 S3（存储和检索）连接起来的示例代码。不过，如果这还有效，还没有尝试过。

[http://opensocial-resources.googlecode.com/svn/samples/cloud/appengine+s3/cloud.py](http://opensocial-resources.googlecode.com/svn/samples/cloud/appengine+s3/cloud.py)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-09T16:46:37.643

我目前正在开发一个使用 Amazon S3 的 GAE 应用程序。效果很好！python S3 库开箱即用。

[http://developer.amazonwebservices.com/connect/entry.jspa?externalID=134](http://developer.amazonwebservices.com/connect/entry.jspa?externalID=134)

# c++ - 如何在 C++ 中将字符串转换为整数

> ID：508191
> 
> 赞同：4
> 
> 时间：2009-02-03T17:55:50.423
> 
> 标签：c++, string, int, casting

我正在尝试将 bar 中的值复制到整数 foo 中。

这就是我到目前为止所拥有的。当我运行它时，我得到一个不同的十六进制值。任何帮助都会很棒。

```
int main()
{

    string bar = "0x00EB0C62";

    int foo = (int)bar;

    cout << hex << foo;
    ChangeMemVal("pinball.exe", (void*) foo, "100000", 4);

    return 0;
} 
```

所以输出应该是0x00EB0C62。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T17:58:15.707

[atoi](http://www.cplusplus.com/reference/clibrary/cstdlib/atoi.html)应该工作：

```
string bar = "0x00EB0C62";

int foo = atoi(bar.c_str()); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T18:01:57.557

[以前的答案。](https://stackoverflow.com/questions/200090/how-do-you-convert-a-c-string-to-an-int)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T18:05:30.590

Atoi 当然可以，但如果你想用 C++ 的方式来做，那么 stringstreams 是最好的选择。它是这样的，请注意，代码未经测试，可能无法开箱即用，但您应该了解总体思路。

```
int i = 4;
stringstream ss;
ss << i;
string str = ss.str(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T17:58:14.227

当您将字符串转换为 int 时，您将获得该字符串的 ascii 值，而不是转换后的字符串值，以正确转换 0x00EB0C62，您必须将其传递给字符串解析器。（一种简单的方法是做 ascii 算术）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T18:02:47.943

这就是字符串流的用途，你想做这样的事情。

```
#include< sstream>
#include< string>
#include< iostream>
int main()
{
    std::string bar="0x00EB0C62";

    int foo=0;

    std::istringstream to_int;
    to_int.str(bar);
    to_int>>foo;

    std::cout<<std::ios_base::hex<<foo<<std::endl;;

    .
    etc.
    .

    return EXIT_SUCCESS;
} 
```

这应该够了吧。抱歉，如果我的 ios_base 不正确，我不记得没有参考的十六进制标志的确切位置。

# version-control - 具有工作目录模型的分布式源代码控制？

> ID：508204
> 
> 赞同：0
> 
> 时间：2009-02-03T17:58:29.747
> 
> 标签：version-control, dvcs

我正在寻找一个分布式源代码控制系统，它可以让我进行颠覆类型的检查。我有几个不同的项目，并希望将它们合并到一个存储库中。我希望能够像 subversion 一样拥有工作目录，因此每个项目不必是它自己的存储库。从 Mercurial 来看，这是不可能的，因为任何文件都必须存储在存储库中才能跟踪那里的更改。如果有人知道可以让我使用工作目录的分布式源代码控制系统，我将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-02-09T14:03:39.947

这个问题是将几个不同的模块组合到一个项目存储库中以使工作更容易吗？

在 Subversion 中，这将使用 svn:externals 处理。

Mercurial 中的等价物是[嵌套存储库](http://mercurial.selenic.com/wiki/subrepos)。

以下问题可能会被证明是有用的：

1.  [人们如何管理对存储在多个（Mercurial）存储库中的公共库文件的更改？](https://stackoverflow.com/questions/1981457/how-do-people-manage-changes-to-common-library-files-stored-across-mutiple-mercu)
2.  [Mercurial Subrepos - 你如何创建它们以及它们是如何工作的？](https://stackoverflow.com/questions/2083393/mercurial-subrepos-how-do-you-create-them-and-how-do-they-work)
3.  [Mercurial 1.4.x 中的 subprepos 功能是否已准备好用于生产？](https://stackoverflow.com/questions/2213709/does-subprepos-feature-in-mercurial-1-4-x-ready-for-production-use)

抱歉，如果我误解了您的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T18:09:19.537

每个结帐都是它自己的存储库这一事实不应该比任何`.svn`地方的目录更不方便。

*   CVS 将元数据（只是少量）存储在一个`CVS`目录中，分散在各处
*   Subversion 将元数据（包括每个文件的完整基础副本）存储在一个`.svn`目录中，分散在各处
*   Git 将更多元数据（包括每个文件的完整历史记录）存储在单个`.git`目录中

我认为 Git 签出比 Subversion 签出*更*方便，因为只`.git`需要关注一个子目录。此外，Git 检出通常小于等效的 Subversion 检出，因为所有历史修订都以有效的压缩格式存储，而不是作为单独的未压缩文件存储。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T18:04:11.747

[SourceGear 的 Vault](http://www.sourcegear.com/vault)支持这一点，对一个用户免费，并通过支持 Mono 跨平台运行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T18:09:01.503

*“分布式源代码控制”中“分布式*”的部分意义在于所有副本都是平等的——没有“主”副本，也没有“从属”或“工作”副本。

您似乎要求的是“分布式源代码控制 - 但不是真的”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-20T06:28:46.120

Bazaar VCS 的结账模型类似于 SVN/CVS 中的结账模型。

# c# - C# 中的 Thread.Sleep(1) 有什么影响？

> ID：508208
> 
> 赞同：30
> 
> 时间：2009-02-03T17:59:29.043
> 
> 标签：c#, multithreading

在 windows 窗体应用程序中，调用的影响是什么，`Thread.Sleep(1)`如下面的代码所示：

```
public Constructor()
{
    Thread thread = new Thread(Task);
    thread.IsBackground = true;
    thread.Start();
}

private void Task()
{
    while (true)
    {
        // do something
        Thread.Sleep(1);
    }
} 
```

这个线程会占用所有可用的 CPU 吗？

我可以使用哪些分析技术来测量此线程的 CPU 使用率（任务管理器除外）？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-02-03T18:35:29.877

如前所述，您的循环不会占用 CPU。

*但请注意*：Windows**不是**实时操作系统，因此您**不会**从 Thread.Sleep(1) 获得每秒 1000 次唤醒。如果您没有使用[timeBeginPeriod](http://msdn.microsoft.com/en-us/library/ms713413.aspx)设置最小分辨率，您将大约每 15 毫秒唤醒一次。即使您将最小分辨率设置为 1 毫秒，您仍然只会每 3-4 毫秒唤醒一次。

为了获得毫秒级的计时器粒度，您必须使用 Win32 多媒体计时器（[C# 包装器](http://www.codeproject.com/KB/miscctrl/lescsmultimediatimer.aspx)）。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-02-03T18:01:32.113

不，它不会占用 CPU，它只会暂停你的线程*至少*那么长时间。当您的线程暂停时，操作系统可以调度另一个不相关的线程来使用处理器。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-02-04T00:47:24.447

如上所述的 Thread.Sleep(1) 不会占用 CPU。

以下是线程休眠（或多或少）时发生的情况：

*   Thread.Sleep 被翻译成一个系统调用，然后触发一个陷阱（允许操作系统控制的中断）
*   操作系统检测到睡眠调用并将您的线程标记为阻塞。
*   操作系统在内部保留了一个需要唤醒的线程列表以及何时唤醒。
*   由于线程不再使用 CPU 操作系统...
*   如果父进程没有用完它的所有时间片，操作系统将调度该进程的另一个线程来执行。
*   否则另一个进程（或空闲进程）将开始执行。
*   时间到了，你的线程会再次被调度执行，但这并不意味着它会自动开始执行。

最后一点，我不完全知道你在做什么，但看起来你正在尝试扮演调度程序的角色，也就是说，睡觉为 CPU 提供时间来做其他事情......

在少数情况下（确实很少）可能没问题，但大多数情况下您应该让调度程序完成它的工作，它可能**比您知道的更多**，并且**可以使工作比您做得更好**。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-04-03T05:17:30.970

应该避免小的睡眠时间，因为放弃其时间片的线程在重新发出信号时会获得优先级提升，这可能导致高上下文切换。在多线程/服务器应用程序中，这可能会导致抖动效应，因为线程正在争夺 CPU 时间。相反，依赖异步函数和同步对象，例如临界区或互斥体/信号量。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-06T23:39:15.530

正如 Bob Nadler 提到`Thread.Sleep(1)`的，不保证 1ms 的睡眠时间。

这是一个使用 Win32 多媒体计时器强制休眠 1 毫秒的示例。

```
 [DllImport("winmm.dll")]
    internal static extern uint timeBeginPeriod(uint period);
    [DllImport("winmm.dll")]
    internal static extern uint timeEndPeriod(uint period);

    timeBeginPeriod(1);
    while(true)
    {
        Thread.Sleep(1); // will sleep 1ms every time
    }
    timeEndPeriod(1); 
```

在 C# GUI 应用程序中对此进行测试，我发现该应用程序使用了大约 50% 的 CPU。

有关此主题的更多讨论，请参阅以下论坛主题：

[http://www.dotnet247.com/247reference/msgs/57/289291.aspx](http://www.dotnet247.com/247reference/msgs/57/289291.aspx)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-11-02T17:57:31.020

这是一个旧线程，在我的很多搜索中都会出现，但 Win7 有一个新的调度程序，并且其行为似乎与上述不同。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;

namespace ConsoleApplication2
{
    class Program
    {
        static void Main(string[] args)
        {
            DateTime dtEnd = DateTime.Now.AddSeconds(1.0);
            int i = 0;
            while (DateTime.Now < dtEnd)
            {
                i++;
                Thread.Sleep(1);
            }

            Console.WriteLine(i.ToString());

            i = 0;
            long lStart = DateTime.Now.Ticks;
            while (i++ < 1000)
                Thread.Sleep(1);

            long lTmp = (DateTime.Now.Ticks - lStart) / 10000;

            Console.WriteLine(lTmp.ToString());

            Console.Read();
        }
    }
} 
```

使用上面的代码，我的第一个结果是 946。所以在 1 秒的时间跨度内使用 1ms 的睡眠，我得到了 946 次唤醒。这非常接近 1ms。

第二部分询问以 1ms 的时间完成 1000 个睡眠事件需要多长时间。我得到了 1034 毫秒。同样，将近 1 毫秒。

这是在 1.8ghz core2duo + Win7 上使用 .Net 4.0

编辑：记住，sleep(x) 并不意味着此时醒来，它意味着不早于这个时间叫醒我。不能保证。虽然，您可以增加线程的优先级，并且 Windows 应该在较低优先级的线程之前安排您的线程。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-03T18:01:42.783

不，它不会占用所有可用的 CPU，因为当另一个线程有工作要做时，操作系统的调度程序将关闭一个睡眠线程。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-03T18:01:52.953

不，它不会。你几乎看不到它。某处每秒不到 1000 次，该线程将在再次入睡之前醒来并且几乎什么都不做。

编辑：

我不得不检查。在 Java 1.5 上运行，这个测试

```
@Test
public void testSpeed() throws InterruptedException {
    long currentTime = System.currentTimeMillis();
    int i = 0;
        while (i < 1000)
        {
            Thread.sleep(1);
            i++;
        }
    System.out.println("Executed in " + (System.currentTimeMillis() - currentTime));
} 
```

在我的 3ghz 机器上以每秒大约 500 次睡眠的速度运行。我想C#应该差不多。我假设有人会为这个非常重要的现实世界基准测试报告 C# 数字。顺便说一句，没有可观察到的 CPU 使用率。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-04T00:36:44.047

一个线程一次最多只能占用一个（逻辑）CPU。并且 1 毫秒的睡眠不会占用太多时间。不要出汗。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-03-21T14:25:35.050

也看看这个：[msdn论坛](http://social.msdn.microsoft.com/Forums/en-US/csharpgeneral/thread/ffad3056-6913-4a09-b2f9-5ceb1a67a06a)

```
using System;
using System.Diagnostics;
using System.Runtime.InteropServices;
using System.Threading;

namespace Test
{
    public static class Program
    {
        public static void Main(string[] args)
        {
            Stopwatch sw = new Stopwatch();

            for (int i = 0; i < 10; ++i)
            {
                sw.Reset();
                sw.Start();
                Thread.Sleep(50);
                sw.Stop();

                Console.WriteLine("(default) Slept for " + sw.ElapsedMilliseconds);

                TimeBeginPeriod(1);
                sw.Reset();
                sw.Start();
                Thread.Sleep(50);
                sw.Stop();
                TimeEndPeriod(1);

                Console.WriteLine("(highres) Slept for " + sw.ElapsedMilliseconds + "\n");
            }
        }

        [DllImport("winmm.dll", EntryPoint="timeBeginPeriod", SetLastError=true)]
        private static extern uint TimeBeginPeriod(uint uMilliseconds);

        [DllImport("winmm.dll", EntryPoint="timeEndPeriod", SetLastError=true)]
        private static extern uint TimeEndPeriod(uint uMilliseconds);
    }
} 
```

# c# - 有没有办法在.net中动态执行字符串，类似于javascript中的eval（）或sql中的动态sql？

> ID：508213
> 
> 赞同：8
> 
> 时间：2009-02-03T18:01:25.780
> 
> 标签：c#, .net, string, dynamic

有没有办法使用 .net 2.0 以类似于 javascript 中的 eval() 或在 tsql 中使用 sp_executeSQL 的方式动态执行包含在字符串中的代码？

我的变量中有一个字符串值，我想在我的应用程序中的某个时间点进行操作 - 所以代码本质上是字符串操作。我不知道需要什么不同的操作，所以我希望它们是可配置的。

我真的不在乎动态代码是用什么语言编写的，无论哪种语言最容易实现且编写起来足够简单。

例如，我可能想替换 '.' 的实例。带有'-'的字符，或去掉所有空格，或类似的。如果我在 sql 中执行此操作，我会使用动态 sql，但我想在 .net 代码中执行它，如下所示：

```
// Get the value to be manipulated
string s = ... // wherever s comes from

// Get the manipulation code, eg this might come from a database 
// setting that can be changed without recompiling the .net code.
string manipulation = Settings.GetSomeValue("ManipulationSetting");

// This is what I want to know how to do: apply some manipulation to the string.
string result = MagicDynamicEvalClass.Eval(manipulation, s);

// Now I would do stuff with the result. 
```

我可能只使用正则表达式查找/替换表达式。由于我所做的只是字符串操作，只要我能编写足够聪明的正则表达式就足够了。例如：

```
// Get the value to be manipulated
string s = ... // wherever s comes from

// Get the code to use to manipulate s, eg this might come from a database 
// setting that can be changed without recompiling the .net code.
string findRegex = Settings.GetSomeValue("RegexPattern");
string replaceRegex = Settings.GetSomeValue("RegexReplace");

// This is what I want to know how to do: apply some manipulation to the string.
string result = Regex.Replace(s, findRegex, replaceRegex);

// Now I can do stuff with the result. 
```

但在某些情况下，我的操作要求可能超出了正则表达式的可能，或者我可能想要应用多个步骤，例如替换“。” 带“-”，还去掉空格。也许我可以存储一个查找/替换正则表达式列表并对其进行迭代......但有人有更好的建议吗？

更新 - 使用动态 sql 的示例

我不想要一个需要我事先知道可以进行哪些操作的解决方案，我真的在寻找简单的东西。例如在 sql 我会做这样的事情：

```
declare @s nvarchar(1000)
declare @manipulation nvarchar(1000)
declare @result nvarchar(1000)

-- ... Get the values from wherever they come from

-- Execute the manipulation dynamically
EXEC sp_ExecuteSQL @stmt = @manipulation
    , @params = N'@s nvarchar(1000), @result nvarchar(1000) OUTPUT'
    , @s = @s, @result = @result OUTPUT 
```

然后我可以将任意 sql 放入我的@manipulation 中，就像这样 SET @result = REPLACE(REPLACE(@s, '.', '-'), ' ', '' )

是的，这需要我注意允许将哪些值放入@manipulation，但这会给我未来需要的灵活性。

我猜想在 javascript 中使用 eval() 也可以使用类似的方法。

更新 - 使用 .net 中的 MSScript 控件的示例：

[这](http://weblogs.asp.net/rosherove/articles/DotNetScripting.aspx)似乎是一种可能的方法，尽管对于我想要处理的简单案例来说可能有点矫枉过正。它使用 Microsoft Script Control 库来允许执行任意 VBScript。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-04T04:31:38.317

这不是太难；）我整理了一个小例子。这应该可以帮助您决定是否要使用动态脚本.. 或正则表达式。

您可以做的是在您的程序集中创建一个接口，您的动态代码将实现该接口：

```
namespace CompileScriptExample
{
  public interface IStringManipulator
  {
    string processString(string aString);
  }
} 
```

然后创建一个 ScriptRunner 类：

```
namespace CompileScriptExample
{ 
public class ScriptRunner
{

    public static string RunScript(string scriptCode, string scriptParameter)
    {

        CodeDomProvider provider = new Microsoft.CSharp.CSharpCodeProvider();

        //configure parameters
        CompilerParameters parameters = new CompilerParameters();
        parameters.GenerateExecutable = false;
        parameters.GenerateInMemory = true;
        parameters.IncludeDebugInformation = false;
        string reference;
        // Set reference to current assembly - this reference is a hack for the example..
        reference = System.IO.Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location);
        parameters.ReferencedAssemblies.Add(reference+"\\CompileScriptExample.exe");

        //compile
        CompilerResults results = provider.CompileAssemblyFromSource(parameters, new string[] { scriptCode });

        if (results.Errors.Count == 0)
        {
            IStringManipulator compiledScript=(IStringManipulator)FindInterface(results.CompiledAssembly, "IStringManipulator");
            return compiledScript.processString(scriptParameter);//run the script, pass the string param..
        }
        else
        {
            foreach(CompilerError anError in results.Errors)
            {
                MessageBox.Show(anError.ErrorText);
            }
            //handle compilation errors here
            //..use results.errors collection
            throw new Exception("Compilation error...");
        }
    }

    private static object FindInterface(Assembly anAssembly, string interfaceName)
    {
        // find our interface type..
        foreach (Type aType in anAssembly.GetTypes())
        {
            if (aType.GetInterface(interfaceName, true) != null)
                return anAssembly.CreateInstance(aType.FullName);
        }
        return null;
    }
} 
```

}

现在您所要做的就是使用实现您的接口的代码创建一个脚本字符串，例如..

```
string myScriptString=@"using CompileScriptExample;
public class MyStringManipulator : IStringManipulator
{
  public string processString(string aString)
  {
        return aString+aString;
  }
}; 
```

然后.. 在您的代码中，使用 ScriptRunner 用您的动态代码处理您的字符串：

```
string processedString = ScriptRunner.RunScript(myScriptString, "hello"); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-03T20:26:15.457

我知道你在 C# 之后，但我的代码是在 VB 中。您可以使用 Developer Fusion 的 VB 到 C# 转换器轻松地将其翻译。我在一个项目中使用它来允许用户在运行时将复杂的计算添加到他们的应用程序中。它将他们的 VB 代码编译到内存中的库中，然后运行返回结果输出的代码。它可以很容易地重新用于您尝试做的事情。

```
Imports System.Reflection
Imports System.CodeDom.Compiler
Imports System.Text.RegularExpressions
Imports System.Math

Module Module1

  Function Evaluate(ByVal Expression As String, ByVal Args() As Object) As Object

    If Expression.Length > 0 Then

        'Replace each parameter in the calculation expression with the correct values
        Dim MatchStr = "{(\d+)}"
        Dim oMatches = Regex.Matches(Expression, MatchStr)
        If oMatches.Count > 0 Then
            Dim DistinctCount = (From m In oMatches _
                                 Select m.Value).Distinct.Count
            If DistinctCount = Args.Length Then
                For i = 0 To Args.Length - 1
                    Expression = Expression.Replace("{" & i & "}", Args(i))
                Next
            Else
                Throw New ArgumentException("Invalid number of parameters passed")
            End If
        End If

        Dim FuncName As String = "Eval" & Guid.NewGuid.ToString("N")
        Dim FuncString As String = "Imports System.Math" & vbCrLf & _
                                   "Namespace EvaluatorLibrary" & vbCrLf & _
                                   "  Class Evaluators" & vbCrLf & _
                                   "    Public Shared Function " & FuncName & "() As Double" & vbCrLf & _
                                   "      " & Expression & vbCrLf & _
                                   "    End Function" & vbCrLf & _
                                   "  End Class" & vbCrLf & _
                                   "End Namespace"

        'Tell the compiler what language was used
        Dim CodeProvider As CodeDomProvider = CodeDomProvider.CreateProvider("VB")

        'Set up our compiler options...
        Dim CompilerOptions As New CompilerParameters()
        With CompilerOptions
            .ReferencedAssemblies.Add("System.dll")
            .GenerateInMemory = True
            .TreatWarningsAsErrors = True
        End With

        'Compile the code that is to be evaluated
        Dim Results As CompilerResults = _
            CodeProvider.CompileAssemblyFromSource(CompilerOptions, FuncString)

        'Check there were no errors...
        If Results.Errors.Count > 0 Then
        Else
            'Run the code and return the value...
            Dim dynamicType As Type = Results.CompiledAssembly.GetType("EvaluatorLibrary.Evaluators")
            Dim methodInfo As MethodInfo = dynamicType.GetMethod(FuncName)
            Return methodInfo.Invoke(Nothing, Nothing)
        End If

    Else
        Return 0

    End If

    Return 0

  End Function

End Module 
```

我这样设置我的动态代码：

```
Dim Expr As String = "  If ({0} < 20000) Then" & vbCrLf & _
                     "    Return Max(15, Min(75,0.12*{0}))" & vbCrLf & _
                     "  Else" & vbCrLf & _
                     "    Return Max(75,0.05*{0})" & vbCrLf & _
                     "  End If" 
```

然后为表达式设置一些参数并执行：

```
Dim Args As New List(Of String)
While True
    Dim Val As String = Console.ReadLine
    Args.Clear()
    If IsNumeric(Val) Then
        Args.Add(Val)
        Dim dblOut As Object = Evaluate(Expr, Args.ToArray)
        Console.WriteLine(dblOut)
    Else
        Exit While
    End If
End While 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T18:08:01.820

我认为可以使用反射.emit 和 codedom 来做到这一点，但这一点也不简单，我建议不要这样做。

作为替代方案，您可以尝试配置格式字符串，可能除了正则表达式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T19:52:34.137

就像其他人已经提到的那样，在 eval() 函数中编译 c# 是不可能的。该功能计划用于安德斯在 PDC 上演示的 clr 的后续版本。

作为一个不同的解决方案，如果您的应用程序能够在单声道上运行，您可以使用它的 eval 函数，它可以动态编译 c# 代码，就像 javascript 一样。它基本上已经在做 .net 在一两年内能够做到的事情。

作为替代方案，如果您不能使用单声道，您可以编写在具有 eval() 的 Ironruby 中进行字符串操作的部分。您的其余代码甚至不知道您正在为该类/组装使用 ruby​​。

对于这样一个简单的用例，您在更新中发布的链接看起来相当复杂。使用ironruby，您所要做的就是编写类似这样的MyDynamicEvalClass：

```
class MyDynamicEvalClass
  def eval(someString,transformString)
    eval(someString,transformString)
  end
end 
```

并用一些返回新字符串的红宝石代码替换“ManipulationSetting”

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-01-26T18:02:23.640

我的 Eval 解决方案怎么样

[如何在动态类型上执行字符串路径？](https://stackoverflow.com/questions/4802626/how-to-execute-string-path-on-dynamic-type/4803594#4803594)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T18:29:11.667

虽然您可以使用枚举来指示您要执行的操作，或者使用 CodeDom 动态发出代码，但归根结底是您想要定义某种转换，这意味着您有输入和输出.

在这种情况下，弄清楚输出很容易，你有一个字符串。对于输入，您似乎可以有可变数量的输入。那将被定义为`IEnumerable<string>`.

考虑到这一点，您可以像这样定义一个接口：

```
public interface IStringManipulation
{
  string Manipulate(IEnumerable<string> parameters);
} 
```

然后，很容易定义这种类型的实现，然后将类型名称放入您的配置中。

您*真的*想这样做，而不是从字符串动态编译代码。在使用字符串时，您有很大的灵活性，是的，但是您没有编译时检查，并且正在向错误和安全问题敞开大门。

此外，编写一段代码以根据您提供的字符串片段发出代码所花费的时间也将非常乏味，因为您必须构建程序集、类、方法，然后编译，然后调用你通过反射动态编译的方法（除非你让它实现一个接口，在这种情况下，你还是按照我的建议去做）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T20:27:16.017

前几天我刚刚遇到了一些用另一种 .NET 语言执行此操作的东西： [http ://reverseblade.blogspot.com/2009/02/dont-wait-for-c-5-use-nemerle.html](http://reverseblade.blogspot.com/2009/02/dont-wait-for-c-5-use-nemerle.html)

我想你可以用你的 C# 或 VB 应用程序在 nemerle 中编写、编译和引用你的字符串处理代码。

我仍然喜欢 casperOne 建议的可扩展设计。通过执行动态脚本，您只需将编译推送到应用程序中并部署到任何将编程字符串发送到应用程序的过程中。但听起来你有你的理由，所以我在这里唯一考虑的另一件事是安全性。理想情况下，您希望尽可能地限制用户*只*操作字符串，在这种情况下，List-of-Regex 似乎是一个不错的选择。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-06-10T02:51:02.347

没有用于在运行时调用 eval() 的 C# 内置方法。

但是，我的 C# eval 程序确实允许评估 C# 代码。它提供了在运行时评估 C# 代码并支持许多 C# 语句。事实上，此代码可用于任何 .NET 项目，但仅限于使用 C# 语法。查看我的网站[http://csharp-eval.com](http://csharp-eval.com)了解更多详细信息。

# java - 哪个 Java Web 框架最适合 Web 设计人员？

> ID：508225
> 
> 赞同：4
> 
> 时间：2009-02-03T18:02:29.380
> 
> 标签：java, web-frameworks, tapestry

哪个 Java Web 框架最能支持**“Web UI 设计师”**角色？也就是说，哪个框架允许您：

*   在您的视图/页面上使用流行的网页设计工具（XHTML 验证器、CSS 编辑器等）
*   无需在服务器上运行即可查看更改
*   快速原型化不同的 UI 选项
*   支持“开发人员”和“设计人员”（术语故意模糊）之间的（有点）清晰的分离

像许多其他人一样，我发现我的大型遗留 Struts 1.x 应用程序严重缺乏这些功能，这些应用程序使用大量 JSP 片段和包含。

我已决定将我的应用程序移植到 JSR-168/268 门户环境，但尚未决定哪些 Java Web 框架将为 portlet 提供支持。我对任何类型（基于动作、基于组件等）持开放态度，一个关键标准是它对上述角色的支持程度。

我对 Tapestry 很感兴趣，它声称它的视图是符合 XHTML 的页面（只是在它们上添加了额外的 Tapestry 特定属性以在运行时处理）。*听起来*它可以很好地与 Web UI 设计师的工具包配合使用。但是，我想知道这是否是现实世界中*实际*发生的情况，或者是否需要妥协。

当然，如果有比 Tapestry 更好的东西，我很想听听！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-03T19:06:31.357

试试[检票口](http://wicket.apache.org/)。它有你需要的一切。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T18:38:33.893

您可能会考虑使用 JSP 进行 ZK：http: [//zkoss.org/](http://zkoss.org/)这都是关于快速原型设计的。很多东西都是设计的并且非常容易，但是扩展小部件很难。此外，如果您不确切知道自己在做什么，巨型网络应用程序可能会出现性能问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-22T18:41:28.337

如果您的企业计算需求很复杂，Tapestry 有一个内置的 IoC 容器这一事实真的很有帮助。但是，如果您不熟悉这种类型的编程，这也会导致 Tapestry 的高学习曲线。将纯 HTML 页面更改为 Tapestry 页面很容易，因为 Tapestry 标记尽可能地具有非侵入性。查看[Jumpstart](http://jumpstart.doublenegative.com.au:8080/jumpstart/)以获取示例。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-01-16T11:28:21.310

我认为 Spring MVC 对你来说是更好的选择。你会很熟悉它（它是动作框架），它支持你所需要的一切。

如果您想尝试 OO/组件框架，请尝试[Apache Click](http://incubator.apache.org/click/)。Click 类似于 Tapestry，但比 Tapestry 和 Wicket 容易得多。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T18:07:28.373

我在使用 JSTL 和 CSS、Spring 和 SiteMesh 的 JSP 上非常幸运。SiteMesh 尤其棒，因为它允许您在没有包含的情况下编写页面。它使用 Decorator 和 Composite 模式获得了很好的优势。

Web 设计师使用 HTML 和 CSS 使用 Dreamweaver 创建页面。开发人员将采用这些并使用 JSTL 添加动态位。页眉、页脚和其余部分是使用 SiteMesh 添加的。关注点分离很好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-04-03T20:50:00.010

[Stripes MVC 框架](http://www.stripesframework.org/ "条纹框架")可以满足您的所有需求。这是一个易于使用的 Web 框架，并且由于它是基于操作的，因此它接近 HTTP 和生成的 HTML，因此您可以完全控制自己的 HTML。

作为视图技术，它支持[Freemarker](http://freemarker.sourceforge.net/ "自由标记")或带有自定义 Stripes JSP 标签的 JSP（没有 scriplets！）。两种解决方案都完全符合 XHTML。

Stripes 框架支持快速原型设计。编辑完视图后，不需要重新编译代码，甚至不需要重启服务器，只需重新加载页面即可。

关注点分离非常好。只是生成控制器命令它执行的操作的愚蠢视图。控制器代码也简单明了，不需要在 XML 文件中进行大量映射，所有这些都由 Java 5 @annotations 很好地默认和配置。（参见：[维基百科示例代码](http://en.wikipedia.org/wiki/Stripes_(framework) "维基百科条纹框架")）。

不太了解portlet，但有一个[Liferay](http://www.liferay.com/ "生命射线")实现。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-03T18:57:34.917

我最近尝试过，我对 RichFaces 非常满意，您可以[在这里](http://livedemo.exadel.com/richfaces-demo/richfaces/actionparam.jsf)查看如何呈现，并与 facelets 连接。对我有用；）

# c# - 如何将 const char* API 导入 C#？

> ID：508227
> 
> 赞同：7
> 
> 时间：2009-02-03T18:03:04.370
> 
> 标签：c#, dllimport

鉴于此 C API 声明，如何将其导入 C#？

```
const char* _stdcall z4LLkGetKeySTD(void); 
```

我已经能够做到这一点：

```
 [DllImport("zip4_w32.dll",
       CallingConvention = CallingConvention.StdCall,
       EntryPoint = "z4LLkGetKeySTD",
       ExactSpelling = false)]
   private extern static const char* z4LLkGetKeySTD(); 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-03T18:12:07.910

试试这个

```
 [DllImport("zip4_w32.dll",
       CallingConvention = CallingConvention.StdCall,
       EntryPoint = "z4LLkGetKeySTD",
       ExactSpelling = false)]
   private extern static IntPtr z4LLkGetKeySTD(); 
```

然后，您可以使用 Marshal.PtrToStringAnsi() 将结果转换为字符串。您仍然需要使用适当的 Marshal.Free* 方法为 IntPtr 释放内存。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-08-17T02:08:20.703

始终使用 C++ const char* 或 char* 而不是 std::string。

还要记住，C++ 中的 char 在 C# 中是一个 sbyte，而 unsigned char 在 C# 中是一个字节。

处理 DllImport 时建议使用不安全的代码。

```
[DllImport("zip4_w32.dll",
   CallingConvention = CallingConvention.StdCall,
   EntryPoint = "z4LLkGetKeySTD",
   ExactSpelling = false)]
 private extern static sbyte* or byte* z4LLkGetKeySTD();

 void foo()
 {
   string res = new string(z4LLkGetKeySTD());
 } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T18:05:38.657

只需使用 'string' 而不是 'const char *'。

编辑：由于 JaredPar 解释的原因，这很危险。如果您不想要免费，请不要使用此方法。

# ruby - 在 Mac 上，Shoes 关于窗口尺寸的想法是否被打破，还是我疯了？

> ID：508228
> 
> 赞同：2
> 
> 时间：2009-02-03T18:03:11.580
> 
> 标签：ruby, shoes

完全披露：我对 Ruby 很陌生。

以下代码似乎应该在您调整它的大小时使用应用程序的当前尺寸更新 para 的文本。

```
Shoes.app do  
    stack do  
        @para = para  
    end  
    animate 1 do  
        @para.text = "%d x %d" % [ app.width, app.height]  
    end  
end 
```

但它永远不会改变。我知道在实际调整大小操作期间动画会被阻止，但是当你放开鼠标时它会赶上。那么，我做错了什么还是这只是没有在 OS X 上实现？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T22:41:08.337

我不太了解鞋子，但是更改应用程序的尺寸似乎是个问题。您的动画确实会更新，但应用程序的宽度和高度不会更新。以下代码显示它确实有动画（帧号会改变）：

```
Shoes.app do
    stack do
        @para = para
    end
    animate 1 do |f|
        @para.text = "%d x %d #{f}" % [ app.width, app.height]
    end
end 
```

进一步看来，当您调整窗口大小时，Shoes 附带的其他示例程序不起作用。simple-bounce.rb，它用鞋子标志为一个弹跳的球制作动画，即使在调整窗口大小时也坚持在原始盒子中弹跳。

看起来这是鞋子代码中的错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T15:01:10.523

我查看了 Shoes 源代码，它似乎没有捕获本机窗口调整大小事件来更新 App 对象 Shoes 内的变量（至少对于 OS X）。因此，当 Shoes 向 Cocoa 发送调整大小事件时，它们并没有从另一个方向接收。

与此同时，这样的事情会更好一些：

```
Shoes.app do
    @stack = stack :width => 1.0, :height => 1.0 do
        @para = para 
    end  
    animate 1 do |f| 
        @para.text = "%d x %d #{f}" % [ @stack.width, @stack.height ]   
    end  
end 
```

但是堆栈仍然不会按照您预期的方式调整大小。对此进行测试表明宽度已正确更新，但高度只能扩展......

# sharepoint - 如何在 word 文档中包含 sharepoint 版本列的值？

> ID：508229
> 
> 赞同：30
> 
> 时间：2009-02-03T18:03:29.830
> 
> 标签：sharepoint, moss, ms-word

我正在尝试找出一种方法来将 SharePoint 中版本列的内容（即每次签入文件时更改的值）显示为 Word 文档中的字段（或类似内容）。

理想情况下，我想知道如何配置 SharePoint，以便我可以单击“插入 > 快速部件 > 文档属性 > 版本”之类的内容，它将在文档中包含版本。目标是让某人更容易将文档的打印版本与 SharePoint 的版本历史相关联。

我*已经*能够将可编辑的文本列添加到文档内容类型，并将它们显示为文档属性快速部件。我还能够添加一个计算列，它将版本作为文本字符串获取......但是这个计算列*没有*在 Word 中显示为文档属性。（也许我错过了计算列上的设置）

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-26T13:03:29.517

这是在文档中获取版本的一种方法，让它工作有点痛苦......

*   在您的文档库上启用版本控制和内容类型。
*   进入文档库设置并选择您希望版本出现的内容类型。
*   从内容类型菜单中选择信息管理策略设置。
*   选择定义策略并单击 。
*   单击“启用标签”复选框
*   不要选中标签部分中的其他两个框。
*   在标签格式字段中，按以下格式输入元数据字段：

    ```
     Version : {Version} \n 
    ```

*   设置标签外观并单击预览。

*   单击页面底部的 。
*   返回库并使用您修改的内容类型创建一个新文档。
*   将文件另存为 Word 2007 格式。
*   选择插入选项卡
*   从功能区菜单中选择快速部件并将鼠标悬停在文档属性上
*   从属性列表中选择标签
*   这应该将标签中定义的元数据显示为 Word 文档中的字段。下次打开文档时，该字段将自动更新。
*   节省。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-09-15T19:18:49.433

这需要同时配置 SharePoint 和您的 Word 文档。

* * *

**配置 SHAREPOINT 的文档库：**

1.  转到您计划存储版本控制文档的文档库。
2.  单击设置 > 文档库设置
3.  单击“版本控制设置”并确保您拥有“创建主要版本”或“创建主要和次要（草稿）版本”。
4.  单击确定。
5.  点击“信息管理策略设置”
6.  如果您的库可以处理多种内容类型，您将看到它们的列表。点击“文档”。如果它只能处理一种内容类型，请跳过此步骤。
7.  选择“定义策略...”并单击确定。
8.  选中“启用标签”框，但不要选中该部分中的其他两个框。
9.  `{Version}`在“标签格式”框中键入。
10.  （可选）您可以格式化版本标签。
11.  单击“刷新”按钮以查看版本标签的预览。它会说类似 {_UIVersionString}
12.  当您对标签的外观感到满意时，单击“确定”。
13.  要返回您的文档库，请单击页面顶部面包屑路径中的文档库名称。

* * *

**配置您的 WORD 文档：**

1.  在库中创建一个新文档或上传一个。
2.  打开文档并进行编辑。
3.  将光标放在要显示版本标签的任何位置。
4.  转到插入>快速部件>文档属性>标签
5.  版本标签“{_UIVersionString}”将显示在文档中。
6.  保存文档（并选择下一个版本应该是什么）。你都准备好了！
7.  如果要测试它，请关闭文档并重新打开它。更新的版本将自动出现在您放置版本标签的位置。

* * *

*这些说明基于 Erwin 的回答。*

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-07-24T01:00:19.770

我按照瑞秋的指示，他们工作得很好。但是，如果您想进行电子签名，在文档中捕获此版本更新确实会产生问题。例如，如果您的版本是 1.6，并且您决定这是供人们签名的版本；你会发现当他们签名时，文档将保存为 1.7 版本。当您再次打开文档时，1.7 版本将与 1.6 的授权版本不匹配，您将被告知所有签名均无效。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-10-06T10:25:12.013

重要说明：在 SP2010 中，当在信息管理策略设置下的文档库中启用标签时，您无法将其另存为站点模板。文档库会损坏，即使我们禁用该策略，另存为站点模板功能仍然会损坏。唯一的选择似乎是永久删除并重建列表。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-12T21:06:57.950

我认为 jaloplo 所指的 RevNum 字段与 SharePoint 文档版本号不同。每次保存文档时它都会更新，但似乎保留了自己的修订编号系统，与 SharePoint 版本编号系统相关（但独立于）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T19:49:59.257

尝试在自定义内容类型中创建计算字段。该字段可以等于版本。这将使您能够将其作为属性添加到文档中。这仅适用于 Office 2007 文档。

创建自定义内容类型后，您将根据该内容类型创建一个新文档。创建文档后，您可以提取文档信息面板并保存。它是一个信息路径表单，因此您可以根据需要对其进行自定义，并将自定义面板上传到内容类型。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-04-17T03:27:25.757

欧文的回答很到位，但我想留下这个，以防有人遇到我遇到的同样问题。如果您尝试在网站集内容类型而不是在文档库级别设置版本标签，您将收到错误“找不到标签引用版本”。预览或保存信息策略时。此外，如果您之前在网站集内容类型级别定义了一个策略，您将无法在文档库级别保存策略。它*必须*在网站集内容类型上设置为“无”。可能从一开始就对我来说应该是显而易见的，但事实并非如此，也许这会帮助其他人。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-02-05T22:09:19.177

文档库的所有列都是 Word 文档的文档属性。要获取文档的版本，您必须显示文档属性，然后选择“高级属性”。此时，您将看到经典的文档属性窗口，您可以在最后一个选项卡中看到“版本”属性。

因此，您可以将此属性的值添加到文档中所需的位置，例如页脚。

# hibernate - 完整单词的HQL字符串匹配？

> ID：508233
> 
> 赞同：2
> 
> 时间：2009-02-03T18:04:46.070
> 
> 标签：hibernate, hql

如何匹配休眠 HQL 查询中的完整单词？例如，假设在我们的数据库中有一个条目“Sam Adams”。现在，给定这个 HQL 片段：

```
book.character like 'Sam' 
```

我不匹配“Sam Adams”。

但是，如果我将查询更改为：

```
book.character = 'Sam%' 
```

然后我也匹配“萨曼莎”。但是，我不希望它与“Sam”这个词的变体相匹配；我只想匹配完整的单词“Sam”。

（并且，通过扩展，查询“Sam Adams”也可以匹配，因为这是两个完整的单词。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T19:51:43.077

由于 HQL 直接映射到 SQL LIKE 功能，而 LIKE 功能不支持正则表达式，因此您必须发挥创造力并执行以下操作：

book.character like 'Sam %' OR book.character like '% Sam' OR book.character like '% Sam %' OR book.character = 'Sam'

这可能不是确切的语法，但你明白了。如果你没有意识到，这个坏男孩的表现不会令人印象深刻。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-30T05:50:29.983

像 Lucene 这样的全文搜索引擎可以更好地处理这种类型的搜索。Hibernate Search 包装了 Lucene，因此在这种情况下将是一个不错的选择。

# php - 如何每天执行一次查询并使用 cron 将结果输出到平面文件？

> ID：508234
> 
> 赞同：3
> 
> 时间：2009-02-03T18:04:48.313
> 
> 标签：php, mysql, cron

我有一个**PHP/MySQL**网站，我想在主页上输出数据库/表中的条目数，但我不想每次用户点击主页时都进行此查询。我希望它每天自动运行一次并将查询结果输出到一个平面文件中，然后我可以将其包含在内。我认为应该减少一些负载。

我以前从未做过 cron 工作，对 Unix 系统/命令也不是很熟悉。我的站点与一个拥有 Plesk 控制面板的 ISP 合作，我看到一个“crontab”部分，它可以让我设置 cron 作业。

我不太确定要输入什么“命令”。我可以很好地制定查询，但不确定如何将结果输出到我可以通过 PHP 包含的平面文件。此外，理想情况下，平面文件将出现在 Web 根目录中（与站点的其余部分一起）并每天覆盖自身，我不想在年底得到 365 个平面文件。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T23:09:23.193

您应该编写一个独立的 PHP 脚本来完成所有工作，然后将其添加到您的 crontab 中，如下所示：

```
0 2 * * * cd /path/to/script; /usr/bin/php daily.php 1> output.txt 2> errors.log 
```

每天凌晨 2 点，您的`daily.php`脚本将运行，输出在其中，`output.txt`并且生成的任何错误（打开 display_errors）都将以`errors.log`. 与将查询直接放入 cron 相比，这有一些优点：

*   您不需要将 mysql 连接详细信息放入 cron
*   如果需要，您可以包含您网站的任何 PHP 包含文件
*   您可以独立测试脚本，而无需等待 cron 运行它。

将数据包含在 PHP 页面中的最简单和最安全的方法可能是[serialize()](http://www.php.net/serialize)查询结果的数组，然后在需要时对其进行 unserialize()：

```
// daily.php
$data = array(
    'rows_in_table_foo' => 2343, // replace this with a query result
    'rows_in_table_bar' => 4321, // replace this with a query result
    );
echo serialize($data);
exit 0; 
```

...并阅读它...

```
// index.php
$data = unserialize(file_get_contents('output.txt')); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T18:18:17.710

如果没有进一步了解您的托管系统，这可能有点棘手。如果有可用的 mysql 命令行客户端，您可以尝试以下操作：

```
/usr/bin/mysql -u db_user --password=db_password -e "SELECT COUNT(*) INTO OUTFILE '/tmp/myoutfile.txt' FROM my_table;" my_database 
```

请注意，您必须在此调用中替换“db_user”、“db_password”等内容。另请注意，`/usr/bin`恰好是客户端位于我的系统上的目录。它可能在您的托管平台上有所不同。

如果 Web 前端允许您直接执行 shell 命令，我会首先尝试以这种方式执行命令，因为如果出现错误或丢失，这应该会给您更好的反馈。

如果您对 PHP 编码感觉更舒服，另一种解决方案是编写一个小的 PHP 脚本来完成创建/更新文件的工作，并在您的 crontab 中调用该脚本：

```
/path/to/php/bin/php /path/to/my/phpscript.php 
```

当然，这取决于系统上可用的 PHP 命令行版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T18:28:01.950

对于您问题的 crontab 部分，您可以简单地在您的 crontab 中添加类似这样的内容（使用命令“crontab -e”进行编辑）：

```
0 0 * * * COMMAND TO EXECTUTE QUERY > THE_FILE 
```

它只是每天执行查询并将其结果通过管道传输到 THE_FILE 中，从而覆盖其内容。

crontab 条目的格式为：

```
minutes hours day_of_month month day_of_week COMMAND 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-04T09:17:35.803

让我们总结一下您的问题。你想缓存查询结果，怎么做？

在回答问题之前，您要提出解决方案（存储在平面文件中）。所以当然，你可以做到这一点。但是，如果您要创建一点基础设施，为什么不编写一个缓存数据类并缓存各种东西。它可以有3个属性

-- 缓存项名称 -- 缓存项值 -- 缓存项上次更新时间戳

添加几个功能

```
function loadCachedData($itemName);

//see if more time has passed than in the cache expiration window 
function isLoadedDataFresh($expirationWindowInSeconds);

function getLoadedItemValue();

function storeCacheValueForItem($itemName, $value); 
```

您已经必须编写查询来选择您的项目，因此在您的控制器中，只需执行以下操作：

```
$cacheHandle = new Cache();

$cacheHandler->loadCachedData('whateverMyVarIs');

$displayValue = '';
if($cacheHandler->isLoadedDataFresh(60 * 60 * 24) ) //sec*min*hour = 1 day
{
    $displayValue = $cacheHandler->getLoadedItemValue();
}
else
{
    //update the display value here with your real query
    $displayValue = doMyStuff();
    $cacheHandler->storeCacheValueForItem('whateverMyVarIs', $displayValue);

} 
```

当然，您必须彻底清除该代码，将到期时间窗口转换为常量，并实现该类，但这应该不会太难。另外，你已经有一个 db.. 只需用它返回缓存类，然后缓存！或者，如果您想使用更好的工具进行快速缓存，请使用 memcached！[http://www.danga.com/memcached/](http://www.danga.com/memcached/)

但最后，我只需要问...您是否过早优化？有人真的抱怨过这个页面的表现吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T18:07:05.330

那么首先它被称为“cron”并且它很容易实现..查看一些关于它的信息：[http](http://en.wikipedia.org/wiki/Cron) ://en.wikipedia.org/wiki/Cron和入门指南：[http://www.unixgeeks .org/security/newbie/unix/cron-1.html](http://www.unixgeeks.org/security/newbie/unix/cron-1.html)。

您希望在此网站上看到多少流量？我不明白为什么在大多数情况下启动查询会是一个大问题......

*   尼古拉斯

# delphi - Delphi 2009 类/组件读/写文件权限

> ID：508240
> 
> 赞同：5
> 
> 时间：2009-02-03T18:05:39.653
> 
> 标签：delphi, delphi-2009, ntfs, file-permissions

有没有人有一组类/组件可以与 Delphi 2009 (Unicode) 一起使用来读取和写入 NTFS 文件权限？

有一个叫做“NTSet”的东西——但他们在大约 3 年前在 Delphi 2006 停止了开发:-(

还有其他接班人吗？？

谢谢！马克

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-03T18:30:10.637

[JCL](http://sourceforge.net/projects/jcl/)有处理文件权限的单元，他们声称与 D2009 兼容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T23:14:45.053

Colin Wilson 的“NT 低级”组件集封装了您需要的 API，并支持 Delphi 2009 以及早期版本。但是，如果您需要详细帮助来实施特定操作，您可能需要依赖 MS 文档和示例。[您可以在http://www.wilsonc.demon.co.uk/delphi.htm](http://www.wilsonc.demon.co.uk/delphi.htm)找到组件（和其他）。它们是免费软件/捐赠软件。多年来，我发现它们有很多用途。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T20:11:35.797

虽然不是原生 Delphi，但您可以使用[SetACL](http://setacl.sourceforge.net/)。有了这个，你有2个选择。您可以从 Delphi 程序中脱壳并调用 SetAcl.exe，或者您可以使用 SetACL.OCX 并直接从您的代码中调用它。

当然，您需要将 SetAcl.ocx 与您的应用程序一起分发，但它工作得非常好。

# apache-flex - mx:Remoteobject 出错

> ID：508241
> 
> 赞同：0
> 
> 时间：2009-02-03T18:06:44.787
> 
> 标签：apache-flex

我正在构建一个 Flex/PHP 应用程序。我在我的页面上放了一些图表，我希望它们从数据库中获取数据。

查看 mx:RemoteObject，似乎我需要查询来选择记录（在 PHP 代码中）并调用该方法。没什么难的（我已经在下面发布了如何做到这一点的链接），但是这条线一直抛出一个错误：

```
 <mx:RemoteObject showBusyCursor="true" source="ChartPersistance" result="result(event)" fault="fault(event)"> 
```

我的代码中有结果和故障函数作为私有范围。上面的行有什么问题？

[http://www.sephiroth.it/tutorials/flashPHP/flex_remoteobject/](http://www.sephiroth.it/tutorials/flashPHP/flex_remoteobject/)

[http://www.cftips.net/post.cfm/flex-line-chart-using-cfc-flash-remoting](http://www.cftips.net/post.cfm/flex-line-chart-using-cfc-flash-remoting)

我到底做错了什么？源似乎是类文件（虽然不在目录中）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-04T00:21:29.583

你看到的错误是什么？顺便说一句，粘贴的代码中可能只是缺少它，但是`<mx:RemoteObject .... />`如果您没有任何内部标记，则应该关闭 RemoteObject 标记。

# .net - Web.config 中的 ODP.NET 配置

> ID：508252
> 
> 赞同：3
> 
> 时间：2009-02-03T18:09:53.610
> 
> 标签：.net, oracle, odp.net

我在应用程序 web.config 文件中添加了 odp 配置。为此，我有一个名为“oracle.dataaccess.client”的配置部分。因此，我在该`<configSections>`部分中添加了一个条目。像这样的东西：

```
<section name="oracle.dataaccess.client" type="System.Data.Common.DbProviderConfigurationHandler, System.Data, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" /> 
```

我不确定类型参数。我的问题是，我必须为类型参数使用什么值？我在哪里可以找到它？Oracle 客户端是 9.2。.net 框架是 1.1

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T18:32:10.397

另请查看[Oracle® Data Provider for .NET Developer's Guide](http://download.oracle.com/docs/cd/B28359_01/win.111/e10927/featConfig.htm)

编辑：

好的，所以我想这就是您要查找的内容：

`<configuration> <configsections>`在以下条目下添加到 web.config：

```
<section name="oracle.dataaccess.client" 
type="System.Data.Common.DbProviderConfigurationHandler, System.Data, 
Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" /> 
```

`<system.data> <DbProviderFactories>`在以下条目下添加

```
<add name="Oracle Data Provider for .NET" 
invariant="Oracle.DataAccess.Client" description="Oracle Data Provider 
for .NET" type="Oracle.DataAccess.Client.OracleClientFactory, 
Oracle.DataAccess, Version=2.102.2.20, Culture=neutral, 
PublicKeyToken=89b483f429c47342" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T23:27:35.027

ODP 9.2 在 .Net 2 之前发布，并没有实现这个框架添加的新接口和工厂（在 System.Data.Common 命名空间中）

换言之，您无法通过 System.Data.Common 配置条目配置此版本的 ODP。ADO.net 2.0 兼容性始于 ODP 版本 10.2.0.2（例如，参见[http://www.oracle.com/technology/oramag/oracle/06-winsupp/win06odp.html ）](http://www.oracle.com/technology/oramag/oracle/06-winsupp/win06odp.html)

# grails - 如何使用 Groovy 显示时间长度？

> ID：508267
> 
> 赞同：1
> 
> 时间：2009-02-03T18:14:55.067
> 
> 标签：grails, groovy

我想要一个像这样工作的方法/闭包

```
 println TimeDifference.format( System.currentMilliSeconds()-1000*60*60*24*7*6 ) 
```

并打印

```
 1 month, 3 weeks, 2 days, 45 hours and 3 minutes ago. 
```

有现成的解决方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T23:01:38.387

这是一个快速端口。你可以试试：

```
def distance_of_time_in_words = { fromTime, toTime, includeSeconds, options ->
    if(toTime==null) toTime = 0
    if(includeSeconds==null) includeSeconds = false
    if(options==null) options = []

    def distance_in_mins = (int)Math.round(Math.abs(toTime - fromTime)/60.0)
    def distance_in_seconds = (int)Math.round(Math.abs(toTime - fromTime))

    switch (distance_in_mins) {
        case 0..1:
            if(distance_in_mins == 0) {
                return "less than 1 minute"
            } else {
                if (includeSeconds == false) return "${distance_in_mins} minute"
            }

            switch (distance_in_seconds) {
                case 0..4: return "less than 5 seconds"
                case 5..9: return "less than 10 seconds"
                case 10..19: return "less than 20 seconds"
                case 20..39: return "half a minute"
                case 40..59: return "less than 1 minute"
                default: return "1 minute"
            }

        case 2..44: return "${distance_in_mins} minutes"
        case 45..89: return "about an hour"
        case 90..1439: return "about ${Math.round(distance_in_mins / 60.0)} hours"
        case 1440..2879: return "a day"
        case 2880..43199: return "${Math.round(distance_in_mins / 1440)} days"
        case 43200..86399: return "a month"
        case 86400..525599: return "${Math.round(distance_in_mins / 43200)} months"
        case 525600..1051199: return "a year"
        default: return "over ${Math.round(distance_in_mins / 525600)} years"
    }

}

def d = new Date().time
println distance_of_time_in_words(d, d + 10, true, [])
println distance_of_time_in_words(d, d + 60, true, [])
println distance_of_time_in_words(d, d + 35, true, [])
println distance_of_time_in_words(d, d + 123, true, [])
println distance_of_time_in_words(d, d + 400, true, [])
println distance_of_time_in_words(d, d + 1300*60, true, [])
println distance_of_time_in_words(d, d + 2000*60, true, [])
println distance_of_time_in_words(d, d + 3.5*60*60*24, true, [])
println distance_of_time_in_words(d, d + 32*60*60*24, true, [])
println distance_of_time_in_words(d, d + 65*60*60*24, true, [])
println distance_of_time_in_words(d, d + 1.5*12*30*60*60*24, true, [])
println distance_of_time_in_words(d, d + 7*12*30*60*60*24, true, []) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-05T08:41:30.167

看看[这个库](http://johannburkard.de/blog/programming/java/date-formatting-parsing-humans-humantime.html)，它被称为人类时间，它允许解析和渲染更容易被人类消化的时间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T21:16:46.727

我不了解 Groovy，但是[从 rails](http://api.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html#M001663)移植它非常简单。您可以通过单击“显示源代码”查看 Ruby 源代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-05T01:43:08.830

你可以使用这个 PrettyDate 插件——http: [//www.grails.org/plugin/pretty-date](http://www.grails.org/plugin/pretty-date)

或者这个 PrettyTime 插件——http: [//www.grails.org/plugin/pretty-time](http://www.grails.org/plugin/pretty-time)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-19T15:30:55.647

您还可以使用在 javascript 端完成的[timeago进行检查。](http://timeago.yarp.com/)编写一个标记库非常容易，您可以使用它在标记中使用适当的类创建日期。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-05-20T08:10:16.873

我会使用 joda-time 插件[Period](http://joda-time.sourceforge.net/key_period.html)和[PeriodFormatter](http://joda-time.sourceforge.net/apidocs/org/joda/time/format/PeriodFormatter.html)，就像[这里](https://stackoverflow.com/questions/1440557/joda-time-period-to-string)一样。

# javascript - 如何在 JavaScript 中的多行代码中拆分字符串？

> ID：508269
> 
> 赞同：234
> 
> 时间：2009-02-03T18:16:19.320
> 
> 标签：javascript, line-breaks

JavaScript 中是否有一个字符可以分解一行代码，以便尽管它位于新行上，但仍将其读取为连续的？

就像是....

```
1\. alert("请选择文件   
2.\删除");

```

* * *

## 回答 #1

> 赞同：306
> 
> 时间：2009-02-03T18:18:21.203

在您的示例中，您可以将字符串分成两部分：

```
alert ( "Please Select file"
 + " to delete"); 
```

或者，当它是一个字符串时，就像你的情况一样，你可以使用@Gumbo 建议的[反斜杠：](http://www.nczonline.net/blog/2006/12/26/interesting-javascript-string-capability/)

```
alert ( "Please Select file\
 to delete"); 
```

请注意，这种反斜杠方法[不一定是首选](http://davidwalsh.name/multiline-javascript-strings#comments)的，也可能不是普遍支持的（我很难找到这方面的硬数据）。它*不在*[ECMA 5.1 规范](http://www.ecma-international.org/ecma-262/5.1/#sec-7.8.4)中。

使用其他代码（不在引号中）时，会忽略换行符，并且完全可以接受。例如：

```
if(SuperLongConditionWhyIsThisSoLong
  && SuperLongConditionOnAnotherLine
  && SuperLongConditionOnThirdLineSheesh)
{
    // launch_missiles();
} 
```

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2009-02-03T18:18:53.560

将反斜杠放在行尾：

```
alert("Please Select file\
 to delete"); 
```

* * *

**编辑**    我必须注意，这*不是*[ECMAScript 字符串](http://bclary.com/2004/11/07/#a-7.8.4)的一部分，因为根本不允许[行终止字符：](http://bclary.com/2004/11/07/#a-7.3)

> ' *LineTerminator* ' 字符不能出现在字符串文字中，即使前面有反斜杠`\`。使行终止符成为字符串文字的字符串值的一部分的正确方法是使用转义序列，例如`\n`or `\u000A`。

所以使用字符串连接是更好的选择。

* * *

**更新 2015-01-05**     [ECMAScript5 中的字符串文字](http://www.ecma-international.org/ecma-262/5.1/#sec-7.8.4)允许上述语法：

> 行终止符不能出现在字符串文字中，除非作为*LineContinuation*的一部分以产生空字符序列。使行终止符成为字符串文字的 String 值的一部分的正确方法是使用转义序列，例如`\n`or `\u000A`。

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2015-06-28T18:40:02.183

ECMAScript 6 引入了[模板字符串](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/template_strings)：

> 模板字符串是允许嵌入表达式的字符串文字。您可以使用多行字符串和字符串插值功能。

例如：

```
alert(`Please Select file   
to delete`); 
```

会提醒：

```
Please Select file   
to delete 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-03T18:19:05.230

把绳子分成两段 

```
alert ("Please select file " +
       "to delete"); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-03-17T07:06:57.227

有趣的是要注意。试过：

```
alert("Some \
    string \
    wrapped \
    across \
    mutliples lines.") 
```

这奏效了。但是，意外！最后一个反斜杠后面有一个空格字符（所有其他反斜杠都在该行的末尾）。这导致了javascript中的错误！不过，删除此空间可修复错误。

这是在 ADT for Android 中使用 Cordova。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T18:18:54.730

你可以使用

```
1:  alert("Please select file" +
2:        " to delete"); 
```

那应该工作

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-10-05T10:08:18.593

反斜杠运算符不可靠。尝试将此函数粘贴到浏览器控制台中：

```
function printString (){
  const s = "someLongLineOfText\
  ThatShouldNotBeBroken";
  console.log(s);
} 
```

然后运行它。由于函数中的常规（和正确）缩进，将包含两个额外的空格，导致`someLongLineOfText ThatShouldNotBeBroken`.

在这种情况下，即使使用反引号也无济于事。始终使用连接“+”运算符来防止此类问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-05-01T22:33:59.970

您可以将长字符串常量分解为逻辑块并将它们分配到数组中。然后`join`用一个空字符串作为分隔符。

```
var stringArray = [
  '1\. This is first part....',
  '2\. This is second part.....',
  '3\. Finishing here.'
];

var bigLongString = stringArray.join('');
console.log(bigLongString); 
```

输出将是：

> 1.  这是第一部分....2。这是第二部分..... 3。到此结束。

这种方式对性能有轻微影响，但您会获得代码的可读性和可维护性。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-12-13T06:57:45.923

*对于 VSCode 用户来说，*[这是一个很好的解决方案](https://stackoverflow.com/q/45204617/2163837)，如果一个字符串分解成多行导致问题（当我不得不测试一个长 JWT 令牌时遇到了这个问题，并且不知何故使用模板文字并没有解决问题。）

* * *

## 回答 #10

> 赞同：-4
> 
> 时间：2013-07-31T09:27:26.887

我尝试了上述一些建议，但在 Chrome 代码检查器中收到了非法字符警告。以下对我有用（虽然只在 Chrome 中测试过！）

```
alert('stuff on line 1\\nstuff on line 2); 
```

出来像...

```
stuff on line 1
stuff on line 2 
```

注意双反斜杠！！...这似乎很重要！

* * *

## 回答 #11

> 赞同：-6
> 
> 时间：2012-07-04T13:24:12.157

无需任何手动中断代码。只需在要中断的位置添加 \n 即可。

```
alert ("Please Select file \n to delete"); 
```

这将显示警报，例如

```
Please select file 
to delete. 
```

# windows - 适用于 Windows 的分布式网络质量监控

> ID：508271
> 
> 赞同：0
> 
> 时间：2009-02-03T18:16:49.397
> 
> 标签：windows, networking, monitoring

我的办公室被一个非常不可靠的网络所诅咒。有时事情似乎停止工作 - 服务器都很好。我们认为故障在于我们计算机之间的电线和路由器。

我的团队负责管理大量 Windows 服务器和工作站。每台 PC 运行许多分布式应用程序，因此任何计算机都可能需要与任何其他计算机通信。

这些服务器都运行一个监控应用程序，它使我们能够保证 PC 及其上运行的所有进程的健康状况，但我们没有任何东西可以让我们判断将所有服务器连接在一起的网络的健康状况。

是否有一些应用程序可以让我们监控网络的健康状况？最好将其分布在我们的机器中，以便我们可以从多个角度看待网络。

我希望能够执行 ping 之类的基本操作，但也可以执行更高级别的操作，例如将模拟事务从一台机器发送到我们的一台服务器。

有什么建议么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-02-15T18:22:13.460

use [ntop](http://www.ntop.org). You can see the whole network activity. who is uploading and downloading. which ports are open.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T18:25:54.263

Solarwinds 是我见过的最好的。它会完成您所要求的所有事情，但是一旦您将所有网络组件都安装在那里，它的价格确实会很高。

[http://www.solarwinds.com](http://www.solarwinds.com)

# sql - 使用日期字段获取不同的记录？

> ID：508274
> 
> 赞同：1
> 
> 时间：2009-02-03T18:17:51.470
> 
> 标签：sql, distinct, max

我有一个查询，我想通过输入的最新日期和描述 ID 获得不同的描述。我可以得到不同的部分，但我在尝试获取 ID 时遇到了麻烦，因为我在日期使用 MAX。这是查询：

```
SELECT DISTINCT Resource.Description, MAX(arq.DateReferred) AS DateReferred, arq.AssessmentResourceID
FROM AssessmentXResource AS arq 
INNER JOIN Resource ON arq.ResourceID = Resource.ResourceID 
INNER JOIN Assessment AS aq 
INNER JOIN [Case] AS cq ON aq.CaseID = cq.CaseID 
INNER JOIN [Plan] AS pq ON cq.CaseID = pq.CaseID ON arq.AssessmentID = aq.AssessmentID
WHERE     (pq.PlanID = 22)
GROUP BY Resource.Description, arq.AssessmentResourceID
ORDER BY Resource.Description 
```

我确定它很简单，但我没有看到它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T19:04:05.420

```
SELECT
    Resource.Description,
    arq.DateReferred AS DateReferred,
    arq.AssessmentResourceID
FROM
    Resource
INNER JOIN
    AssessmentXResource AS arq 
        ON arq.ResourceID = Resource.ResourceID 
        AND arq.DateReferred = (
                                SELECT
                                    MAX(DateReferred)
                                FROM
                                    AssessmentXResource
                                WHERE
                                    ResourceID = Resource.ResourceID
                               )
INNER JOIN
    Assessment AS aq
        ON arq.AssessmentID = aq.AssessmentID
INNER JOIN
    [Case] AS cq
        ON aq.CaseID = cq.CaseID 
INNER JOIN
    [Plan] AS pq
        ON cq.CaseID = pq.CaseID
WHERE
    (pq.PlanID = 22)
ORDER BY
    Resource.Description 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T18:56:21.957

我看不出加入 [Case] 表的原因，所以我把它省略了。如果出于某种原因需要它，您可以将其添加回来。

```
SELECT
     RES.Description,
     ARQ.DateReferred,
     ARQ.AssessmentResourceID
FROM
     AssessmentXResource ARQ
INNER JOIN Resource ON
     ARQ.ResourceID = RES.ResourceID
INNER JOIN Assessment AQ ON
     AQ.AssessmentID = ARQ.AssessmentID
INNER JOIN [Plan] PQ ON
     PQ.CaseID = AQ.CaseID
LEFT OUTER JOIN AssessmentXResource ARQ2 ON
     ARQ2.ResourceID = ARQ.ResourceID AND
     ARQ2.DateReferred > ARQ.DateReferred
WHERE
     PQ.PlanID = 22 AND
     ARQ2.ResourceID IS NULL 
```

如果您的数据中相同的 ResourceID 存在相同的 DateReferred 值，则这可能不会起到预期的作用。您应该针对这种情况提出一个业务规则并相应地更改查询。此外，如果不能保证您的 AssessmentXResource 行的 Assessment、Plan 和 Case 表中有匹配的行，这将与您的查询略有不同。您可以通过为那些添加到 ARQ2 的连接来使其工作，但这会影响性能并且也更复杂一些。如果您需要，请发表评论，我可以更改查询以处理它，或者您可以自己解决。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T19:12:23.483

简短回答：如果您按 id 分组，max 函数将不起作用。您最终将返回每个不同 id 的最大值。即一切

您可能需要更改子查询表示，但您明白了。

select id, val from table where val = (select max(val) from table)

# git - 如何使用 textmate 查看 git diff

> ID：508276
> 
> 赞同：18
> 
> 时间：2009-02-03T18:18:07.460
> 
> 标签：git, diff, textmate

我将编辑器设置为 textmate，但是当我执行 git diff 时，它使用 vi 向我显示 diff 输出，有没有办法将其设置为在 textmate 中显示差异？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-03T18:37:05.630

我通常像这样通过管道将内容配对：

```
git diff | mate - 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-03T18:33:01.737

[`GIT_PAGER`环境变量](http://www.kernel.org/pub/software/scm/git/docs/)用于指定使用哪个程序来显示多页输出。您应该能够将其设置为指向 textmate。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-04T01:59:35.690

如果您安装了终端链接，则很简单：

```
git diff | mate 
```

我个人有一个将“diffmate”映射到该命令的别名设置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-04-04T15:02:54.553

另外，需要指出的是，在 TextMate 中，可以使用 Bundles>>Diff 在 TextMate 中进行比较。

# python - Python有没有好的依赖分析工具？

> ID：508277
> 
> 赞同：31
> 
> 时间：2009-02-03T18:18:07.697
> 
> 标签：python, dependencies

依赖分析程序通过控制代码中模块之间的依赖关系来帮助我们组织代码。当一个模块是另一个模块的循环依赖时，找到一种方法将其转换为单向依赖或将两个模块合并为一个模块是一个线索。

Python代码的最佳依赖分析工具是什么？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-03T22:26:13.967

我建议使用[蛇食](http://furius.ca/snakefood/)来创建 Python 项目的图形依赖图。它可以很好地检测依赖关系，以便立即查看需要重构的区域。如果您阅读一些文档，它的用法非常简单。

当然，您可以省略图形创建步骤并在文件中接收依赖字典。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T21:30:33.283

我不知道什么是*最好*的依赖分析工具。您可以查看`modulefinder`- 它是标准库中的一个模块，用于确定脚本导入的模块集。

当然，使用 python 时，您会遇到条件导入问题，甚至可能`__import__`会直接调用脚本，因此它可能无法找到所有内容。这就是为什么像 py2exe 这样的工具需要特殊的帮助来处理像 PIL 这样的包。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-14T21:03:08.053

PyStructure – Python 代码的自动结构和依赖分析

这用于 PyDev 的重构功能。[http://pystructure.ifs.hsr.ch/trac/](http://pystructure.ifs.hsr.ch/trac/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-01-06T17:04:28.227

我不确定最好的工具，但依赖分析最好通过提取和扫描项目的 python 文件来完成。

这是一个使用上述技术的工具：[orkohunter.net/depends](http://orkohunter.net/depends/)

# c# - C# 大树迭代

> ID：508280
> 
> 赞同：2
> 
> 时间：2009-02-03T18:18:44.217
> 
> 标签：c#, algorithm, recursion, iteration, tree-traversal

我有一个以父/子关系组装的大型结果集。我需要遍历树并向用户显示结果。

我在使用递归之前已经这样做了，但是因为我的结果集可能很大，所以我想避免收到 StackOverflowException 的可能性。

我在使用堆栈的 MSDN 上找到了以下[示例。](http://msdn.microsoft.com/en-us/library/bb513869.aspx)我遇到的问题是因为堆栈是后进先出的，我的数据没有正确显示。我希望它看起来像下面这样：

```
 LeveL 1
Level 1.1
Level 1.1.1 
Level 1.1.2 
Level 1.2 
Level 1.2.1 
Level 1.2.2 
```

但它看起来像：

```
 LeveL 1
Level 1.2 
Level 1.2.2 
Level 1.2.1 
Level 1.1 
Level 1.1.2 
Level 1.1.1 
```

有任何想法吗？

这是我的代码示例。假设`DataTable dt`具有以下列：ID、ParentID 和 Text

```
 private struct Item
    {
        public string Text;
        public int ID;
        public int ParentID;
    }

    private void BuildView()
    {
        Stack<Item> itemTree = new Stack<Item>(40);

        //Get All Parent Nodes
        DataView dv = new DataView(dt);
        dv.RowFilter = "ParentID = 0";

        //Add the parent nodes to the stack
        foreach (DataRowView drv in dv)
        {
            Item item = new Item();
            item.Text = drv["Text"].ToString();
            item.ID = drv["ID"].ToString();
            item.ParentID = drv["ParentID"].ToString();
            itemTree.Push(item);
        }

        //Go through the stack one node at a time
        while (itemTree.Count > 0)
        {
            Item currentItem = itemTree.Pop();
            Debug.WriteLine(currentItem.Text);

            //Get children of current node
            dv.RowFilter = String.Format("ParentID = {0}", currentItem.ID);
            if (dv.Count > 0)
            {
                //Add child nodes to the stack
                foreach (DataRowView drvChild in dv)
                {
                    Item item = new Item();
                    item.Text = drvChild["Text"].ToString();
                    item.ID = drvChild["ID"].ToString();
                    item.ParentID = drvChild["ParentID"].ToString();
                    itemTree.Push(item);
                }
            }
        }

    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T18:21:24.833

在当前算法中，您首先要寻找正确的孩子。

让它先离开孩子。就这样。

例如，在您的代码中可能有如下内容：

```
node = node.rightChild() 
```

将其更改为

```
node = node.leftChild() 
```

这是此类问题的一般解决方案。

由于 MSDN 实现没有公开这种代码，我无法对此发表评论。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T18:24:45.623

以相反的顺序将您的项目推入堆栈，即 2 在 1 之前。

例子：

```
// suppose I want to push children[] onto the stack

for (int i = children.Length - 1; i >= 0; i--)
{
   stack.Push(children[i]);
} 
```

要在您的代码中执行此操作，请尝试以下`for-each`语句：

```
foreach (DataRowView drvChild in dv.Reverse()) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T18:45:55.377

如果只是提供关注的顺序，请从使用堆栈更改为使用队列。出于实际目的，它们是相同的，不同之处在于队列是先进先出的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T19:07:49.170

通过以相反的顺序更改子节点的迭代，它们按需要显示

```
//Add child nodes to the stack
for (int i = dv.Count - 1; i >= 0; i--)
{
    DataRowView drvChild = dv[i];
    Item item = new Item();
    item.Text = drvChild["Text"].ToString();
    item.ID = drvChild["ID"].ToString();
    item.ParentID = drvChild["ParentID"].ToString();
    itemTree.Push(item);
} 
```

# perl - 为什么当我在 constant.pm 中使用散列引用时 Perl 会报错？

> ID：508289
> 
> 赞同：4
> 
> 时间：2009-02-03T18:22:17.563
> 
> 标签：perl, constants

我有 perl, v5.6.1 为 ActiveState 提供的 MSWin32-x86-multi-thread Binary build 638 构建。

我正在编写一个 Perl 脚本，我在其中声明了稍后用于比较目的的常量。出于某种原因，我收到一个错误，指出常量名称行中的某些内容在脚本的第 31 行有无效字符（下面代码中使用常量子句之后的行）。我检查并发现常量名称中的“_”（下划线）是合法字符。我还尝试将 '0.00' 更改为 '0' 以查看这是否是原因，但我得到了同样的错误。我不确定我做错了什么。任何人都知道为什么编译器不喜欢这个？

谢谢！

这是代码：

```
use constant {
MIN_NET_DLR => 0.00,
MAX_NET_DLR => 99.99,
MIN_SUM_DLR => 0.00,
MAX_SUM_DLR => 999.99,
MIN_UNITS => 0,
MAX_UNITS => 99,
MIN_SUM_UNITS => 0,
MAX_SUM_UNITS => 999,
PCT_THRES_AO => 1,
PCT_THRES_TRANS_CUST_BI => 20,
PCT_THRES_CUST => 3,
}; 
```

问题：

问题是 perl 5.6.1 提供的常量版本不支持哈希引用。

解决方案：

对常量使用常规声明。因此，声明将如下所示：

```
use constant MIN_NET_DLR => 0.00;
use constant MAX_NET_DLR => 99.99;
use constant MIN_SUM_DLR => 0.00;
use constant MAX_SUM_DLR => 999.99;
use constant MIN_UNITS => 0;
use constant MAX_UNITS => 99;
use constant MIN_SUM_UNITS => 0;
use constant MAX_SUM_UNITS => 999;
use constant PCT_THRES_AO =>    1;
use constant PCT_THRES_TRANS_CUST_BI => 20;
use constant PCT_THRES_CUST => 3; 
```

感谢@leon 的解决方案以及其他参与其中的人。

更新：另一种（更优雅的）解决方案是将您的 Perl 版本更新为在声明常量时支持散列引用的版本。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-03T18:39:07.107

问题是您使用的是哈希引用。perl 5.6.1 提供的版本`constant`不支持。您要么必须移除大括号，要么升级您的`constant`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T18:41:21.440

它在 perl5.8 上对我来说很好，但在 perl5.6 上不起作用。错误信息是：

> 无法将“HASH(0x80c05d8)”定义为常量（名称包含无效字符或为空）

似乎是一个旧版本的问题，可能是 Leon[描述](https://stackoverflow.com/questions/508289/perl-script-giving-grief-about-constant-name/508357#508357)的问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-04T00:46:20.127

您的旧 perl 可能不支持在一个语句中声明多个常量的语法。尝试像这样分别定义每个常量...

```
use constant MAX_NET_DLR => 99.99; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-04T15:32:28.000

我会使用[Readonly](http://search.cpan.org/~roode/Readonly-1.03/Readonly.pm)模块。

常量的缺点是，它在调用者命名空间内创建一个函数，该函数返回一个常量值。

Readonly 可用于声明标量、数组和哈希只读（实常数）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T18:26:01.533

为我工作。您确定该代码中的某处没有任何控制字符吗？

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2009-02-03T18:38:35.003

删除此行末尾的最后一个逗号：

```
PCT_THRES_CUST => 3, 
```

这可能是问题所在。

# .net - 维护一个“干净”的程序集引用列表有什么好处？

> ID：508292
> 
> 赞同：2
> 
> 时间：2009-02-03T18:22:59.590
> 
> 标签：.net, optimization, assemblies, reference, load

就像[卡尔在这里的问题](https://stackoverflow.com/questions/235250/what-are-the-benefits-of-maintaining-a-clean-list-of-using-directives-in-c)一样，我想问你（因为我自己无法找到它：（）如果通过删除非静态或动态的程序集引用（例如通过反射）有任何好处使用.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T18:45:48.980

除了清理项目之外，删除未使用的程序集引用不会改变任何事情。当您添加程序集引用时，编译器将忽略您在代码中实际未使用的任何程序集。因此，如果您要设置对 System.Data.dll 和 System.Windows.Forms.dll 的引用，但只编写了以下代码：

```
using System;

public class MyClass
{
  public static void Main()
  {
    Console.WriteLine("Hi there.");
  }
} 
```

编译器只会引用强制的 mscorlib.dll

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T18:46:05.017

如果您动态使用该类型，那么您将不会在元数据中引用它所包含的程序集，除非该程序集在您的程序集中的其他地方使用。

话虽这么说，如果您在不使用引用时删除它，那是没有意义的，因为我相信 C# 编译器不会将程序集引用写入输出程序集的元数据中，当它没有在任何地方的代码中引用时。

基本上，它会为您完成。

# c# - 在多个类似命名的控件上调用 DataBindings.Clear()

> ID：508293
> 
> 赞同：2
> 
> 时间：2009-02-03T18:23:01.087
> 
> 标签：c#, grouping

最初在另一个论坛上发布了一段时间，希望我能在这里找到更多帮助:)

嗨，大家好，

我确信这是一个非常基本的问题，但我对很多编程和 C# 还是很陌生。我发现我需要清除几个控件上的数据绑定，目前有：

```
 lblTableValue1.DataBindings.Clear();
            lblTableValue2.DataBindings.Clear();
            lblTableValue3.DataBindings.Clear();
            lblTableValue4.DataBindings.Clear();
            lblTableValue5.DataBindings.Clear();
            lblTableValue6.DataBindings.Clear();
            lblTableValue7.DataBindings.Clear(); 
```

这不是最好的方法吗？我还需要将所有这些文本值设置为“”，我可以以某种方式将它们分组并在整个组上调用 clear 吗？

非常感谢提前

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T18:25:50.333

```
foreach(Control c in this.Controls)
{
    if(c.Name.StartsWith("lblTableValue"))
    {
        c.DataBindings.Clear();
    }
} 
```

这可能会完成这项工作。或者，如果您更纯粹：

```
foreach(Control c in new Control[]
    {
        lblTableValue1,
        lblTableValue2,
        etc
    })
{
    c.DataBindings.Clear();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T18:37:37.047

在这种情况下，我发现最好将我想要操作的控件包含在某种容器中，比如面板。然后迭代变得容易：

```
private void SetLabelText() 
{ 
  foreach (Control c in Panel1.Controls) 
  { 
    if (c is Label && c.ID.StartsWith("lblTableValue"))
    { 
      Label lbl = c as Label; 
      lbl.Text = string.Empty;
      lbl.DataBindings.Clear();
    } 
  } 
} 
```

# web-services - 哪种类型的 Web 服务创建是您的主要选择？

> ID：508294
> 
> 赞同：2
> 
> 时间：2009-02-03T18:23:17.327
> 
> 标签：web-services, wsdl

“自下而上”还是“自上而下”？

首先我使用自上而下，但我觉得有很多没有任何实现或验证的设计选项。

现在我的方法是在创建新服务时“自下而上”天堂。

*   自下而上：当您使用代码制作 Web 服务时。
*   自上而下：当您创建和使用 wsdl 文件来制作 Web 服务并生成一些代码时。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T18:33:54.450

我使用“合同优先”——从描述 XML 消息的模式开始，然后从那里开始工作。从中生成 WSDL，并让端点处理 XML。你可以那样做“鸭子打字”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T18:31:15.873

我绝对更喜欢从代码生成 WSDL，因为代码优先建模更加舒适和容易。此外，根据我的经验，从 XSD 生成的类往往相当混乱，并且在作为 API 公开时可能是一场真正的噩梦。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T20:18:36.780

我不确定您是否可以将 wsdl 创建描述为自上而下与自下而上。我认为这取决于您使用的工具。有些产品更适合首先创建模式。其他人最好从代码开始。这实际上取决于您可以访问的内容。

我认为您可以将整体 SOA 实施策略描述为自上而下与自下而上。自下而上是在数据访问级别开始构建服务，然后在这些之上构建更高阶的服务。在自上而下的主要项目中，创建一些要利用、清理、冲洗和重复的服务。

在这种情况下，自下而上是要走的路。投资回报率更长，但正是因为这些服务继续被利用，您才能体验到 soa 声称能够实现的节省。

# javascript - jQuery Flot 中的事件标志

> ID：508297
> 
> 赞同：1
> 
> 时间：2009-02-03T18:24:17.323
> 
> 标签：javascript, jquery, charts, flot

我希望将事件添加到一些 Google Flot 图表中，例如在 Google Finance 中看到的那些。在搜索了一些之后，看起来有人已经开始这样做并在[http://code.google.com/p/flot/wiki/FlotUsage](http://code.google.com/p/flot/wiki/FlotUsage)上发布了几张图片。我找不到任何可以做到这一点的 Flot 插件。

有谁知道 Flot 插件或示例，所以我可以确保不会重新发明任何轮子？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T21:13:37.093

当前版本（0.5）不能做到这一点，但如果你从“主干”中提取最新版本，它可以。只需在 API 文档中查找称为“标记”的内容： [http ://code.google.com/p/flot/source/browse/trunk/API.txt](http://code.google.com/p/flot/source/browse/trunk/API.txt)

我使用标记功能在某天发生某事时画一条垂直线。例如，您可以在包含网站流量指标的图表上绘制新软件发布日期的垂直线。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-21T08:26:21.803

我制作了一个添加高级事件支持的[插件。](http://joeloughton.com/blog/web-applications/flot-plugins-event-graphics/)您可能想检查一下（尽管这是很久以前的事了 :-P）

# multithreading - 哪个操作系统上的线程编程足以利用多个内核？

> ID：508301
> 
> 赞同：2
> 
> 时间：2009-02-03T18:25:17.150
> 
> 标签：multithreading, operating-system, multicore

我想使用我的多线程编程技能（我有技能），但我意识到这还不够。如果操作系统没有意识到这种潜力，我的线程可能仍会竞争相同的内核。我可以在英特尔至强架构上使用哪些操作系统/编译器/库组合来线程处理内核？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-03T19:10:06.873

所有现代操作系统都在所有可用内核上分配线程；但是有几种语言或库可以防止这种情况发生。最常见的问题是：

*   绿色线程。当多个 CPU 很少且操作系统没有得到足够优化时，它曾经具有性能优势。有几个 Java VM 吹嘘这是一个特性，后来转向 M:N 方案，我认为现在到处都是 N:N。

*   GIL：全局解释器锁。一些脚本语言在解释器循环中有很多全局状态，所以有一个大（互斥）锁来确保一致性；但这会阻止同一“空间”的两个线程同时运行。至少 Python 和 Lua 有这个问题。在这些情况下，最好使用多个进程而不是多个线程。

此外，最好记住大多数 CPU 绑定应用程序的最大瓶颈是 RAM 带宽，通常不是 CPU 本身，因此让多个线程争夺相同的内存可能不是最好的设计。在几个通过小消息进行通信的单独进程中重构通常要好得多。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T18:28:16.333

在每个操作系统上。这几乎就是线程的定义。

如果您创建一个启动两个线程的应用程序，那么操作系统可以将它们放在两个单独的内核上。对于 Windows、OSX、Linux 和您能想到的任何其他操作系统都是如此。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-07T17:52:35.450

既然你“掌握了技能”，我假设你已经知道几乎所有现代操作系统都会在多个内核上执行你的线程，如果它们可用并且你的线程没有某种有效地使它们顺序的锁定问题.

所以我猜你真的在问如何将你的线程绑定到核心，这样它们就不会相互竞争。这是通过设置线程的处理器亲和性来完成的。以下是针对 Windows 和 Linux 的文章链接。我敢肯定，其他风格的 Unix 也存在其他人。我还要注意，这通常不是必需的，因为在某些特殊情况之外，操作系统会更好地知道在哪里安排您执行的线程。请记住，现代操作系统是多进程的，因此您的线程不仅仅是相互竞争，它们还与机器上所有其他进程的线程竞争。根据负载，将线程限制为单个内核实际上可能会使它们更快。

[http://www.microsoft.com/technet/prodtechnol/windows2000serv/reskit/core/fnef_mul_dnpl.mspx?mfr=true](http://www.microsoft.com/technet/prodtechnol/windows2000serv/reskit/core/fnef_mul_dnpl.mspx?mfr=true)

[http://www.ibm.com/developerworks/linux/library/l-affinity.html](http://www.ibm.com/developerworks/linux/library/l-affinity.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-04T01:23:21.270

大多数现代操作系统都为多处理做好了准备。因此，它们为多核做好了准备。但是，调度程序负责将线程分配给内核。FreeBSD 是最高效的多核和多处理操作系统之一。然而，并不是每个操作系统都能够将线程调度到不同的内核。例如，旧的 Windows 98 不能使用多个内核。此外，许多操作系统对最大内核数有限制。

我在 Stackoverflow 中阅读了一些用户谈论 Packt Publishing 的新书的帖子，并且我在 Packt Publishing 网页中找到了以下文章：

[http://www.packtpub.com/article/simplifying-parallelism-complexity-c-sharp](http://www.packtpub.com/article/simplifying-parallelism-complexity-c-sharp)

我读过Joe Duffy 的书《Concurrent Programming with Windows》。现在，我正在等待希拉尔的书“C# 2008 和 2005 线程编程” - [http://www.amazon.com/2008-2005-Threaded-Programming-Beginners/dp/1847197108/ref=pd_rhf_p_t_2](https://rads.stackoverflow.com/amzn/click/com/1847197108)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-04T01:27:20.683

在另一篇文章中，我推荐了一本新书。如果您正在寻找深入的答案，我建议您阅读 Gaston C. Hillar - Packt Publishing 的“C# 2008 和 2005 线程编程”的前两章。5天前买这本书之前，我不知道你的问题的答案。现在，我可以看到我的 Core 2 Quad Q6700 使用 4 个并发线程在 C# 中达到 98% 的 CPU 使用率！这比我想象的要容易。如果你有多线程知识，那对你来说会更容易。我对同时使用多个内核所获得的结果印象深刻。我向那些对使用 C# 进行多核或线程编程感兴趣的人推荐这本书。我不是 C++ 程序员。出于这个原因，我需要一本 C# 初学者的书来利用线程来利用多核。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T18:29:42.133

AFAIK，几乎所有现代操作系统都会跨多个内核调度线程。当然，我曾经使用过的任何 Unix 变体都没有任何问题，而且我相当肯定所有的 Windows 都能很好地处理它。编译器不是问题，因为本机线程是操作系统级别的东西，所以编译器只是向下传递系统调用。

有一些语言（例如 Ruby）不使用本机线程，而是使用它们自己的“绿色”线程，这些线程在解释器中实现，因此对于操作系统来说看起来像是一个单线程，但它们是例外而不是规则，并且通常在文档中很明显发生了什么。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T18:33:14.060

让我们做一个小区别。线程化的软件不一定会同时在两个内核上运行。

您需要编写支持同时多线程 (SMT) 的代码。大多数操作系统都毫无问题地支持这一点 - 唯一真正的区别在于您的软件如何处理锁定和资源。如果您的线程完全依赖于相同的内存或资源，就会发生争用，并且在某个时间点中，一个或另一个被停止等待资源、内存或其他锁。

大多数具有线程的编程语言也能够做到这一点 - 确保它同时运行实际上取决于程序员。

您可以在此处找到有关如何在 Windows 中使用 Visual Studio C++ 执行此操作的信息：

[http://msdn.microsoft.com/en-us/library/172d2hhw.aspx](http://msdn.microsoft.com/en-us/library/172d2hhw.aspx)

有很多关于这方面的教程，特别是针对 Windows（C#、C++、VB 等）的教程——可以通过搜索找到它们：

[http://www.google.com/search?q=simultaneous+multithreading+C%2B%2B](http://www.google.com/search?q=simultaneous+multithreading+C%2B%2B)

-亚当

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-03T18:33:25.683

正如其他人所说，任何现代操作系统都会为您做到这一点。但是，它的执行方式会对性能产生很大影响，因此您可能希望以操作系统预期的方式使用线程。这篇[Wikipedia 文章](http://en.wikipedia.org/wiki/Scheduling_(computing))似乎对主要操作系统使用的调度技术有一个不错的概述。

# nant - 南特 安静模式下的任务？

> ID：508302
> 
> 赞同：1
> 
> 时间：2009-02-03T18:25:27.447
> 
> 标签：nant

我想在我的构建脚本中使用 <nant> 任务，但我希望该任务以安静模式运行。我希望主脚本以正常模式运行。这可能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T22:03:06.163

我可能是错的，但据我所知，它不允许你让它保持沉默。

但是从构建的角度来看，如果您尝试使其保持静音并且您的嵌套构建之一失败，您将不知道导致构建失败的原因。

磁盘空间很便宜，日志文件很小，所以我会说 letter rip。实际上，在构建设置中，我们实际上增加了详细程度，以便我们可以获得尽可能详细的构建日志。当事情变得混乱时，它已经帮助了好几次（通常是由于人们没有检查东西）。

# c# - 启动具有数据库支持的新应用程序

> ID：508309
> 
> 赞同：3
> 
> 时间：2009-02-03T18:27:26.647
> 
> 标签：c#, .net, sql-server, database, version-control

我正在开始一个使用数据库的新 C# 项目，但我希望这一切都受到版本控制。我正在考虑一个 SQL Server 数据库（如果我制作一个 mdf 文件，我可以在没有安装 SQL Server 的计算机上使用它吗？）和 LINQ to SQL。

你通常如何开始这样的项目？您是否创建一个 .sql 文件来创建数据库，然后创建 linq 模型？有没有更好的办法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T18:33:10.847

这真的取决于你喜欢什么。你会得到答案，告诉你最好先设计对象模型（程序员会告诉你），然后会有人告诉你先设计数据模型（数据库管理员）。

最后，正确的方式是你感觉最舒服的方式。如果您觉得您将在代码中对数据进行大部分操作，那么从对象模型开始可能对您有好处。如果您觉得您将在数据中执行大部分操作，那么您最好从数据库开始。

关于源代码控制，如果您想对所有内容进行版本控制，那么您将不得不生成一个 sql 文件，该文件将包含您从头开始创建数据库所需的内容。然后，每次更改或更新数据库架构或数据时，您也应该将该文件放入源代码管理中。我还建议使用一种命名约定，将文件的日期和时间合并到文件中，以便在从头开始工作时或之后的任何时间点轻松确定应用文件的顺序。

当然，您还需要对源代码进行版本控制，但这不言而喻。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T18:34:04.513

第一个问题：是的，您总是需要在您的机器上安装 sql server 才能在本地访问数据库，否则您需要设置您的服务器以接受外部连接。

第二：不，您不应该将数据库 MDF 文件存储在源代码控制之下。正如您所说，将 sql 脚本存储在源代码管理中。

第三：我建议查看诸如 FluentNHibernate 和 NHibernate 之类的对象关系映射系统，这样除了实际的表创建/更改语句和索引之外，您不需要在 sql 中管理任何数据库。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T18:59:01.043

如果您使用 .mdf，您的用户将需要使用某些版本的 SQL Server。对于小型应用程序，您可以使用（免费）SQL Server Express。

至于如何设计您的解决方案，这可能很困难，但是您希望将*所有内容都*放在源代码管理中是正确的。开发人员经常不将他们的数据库代码置于源代码控制中，这总是让人头疼。

问题是在 Visual Studio 中控制数据库的版本可能很棘手。仅将更改脚本放在文件夹中很困难，因为您必须记住在设计数据库时创建它们。字段重命名等简单的事情可能很乏味，因为以正确的顺序执行它们很重要。您可能需要考虑将 RikMigrations 等迁移框架作为一种方法。对于较大的应用程序，Visual Studio 数据库项目（需要新安装，但最近在“团队开发人员”Sku 中提供）将帮助您控制数据库更改脚本等。

# c#-3.0 - ASP.NET Membership 保持身份验证问题

> ID：508316
> 
> 赞同：2
> 
> 时间：2009-02-03T18:29:44.833
> 
> 标签：c#-3.0, asp.net-membership, asp.net-3.5

所以，我的应用程序很奇怪，当您登录时，您将保持登录状态一两个页面然后迷路。我的设置是这样的：

```
 <authentication mode="Forms">    
     <forms name=".ASPXFORMSAUTH"  timeout="20"/>
  </authentication>

 <authorization>
<allow users="*" />
</authorization>
 <membership defaultProvider="MySqlConnection" userIsOnlineTimeWindow="45">
 <providers>
    <clear />
    <add name="MySqlConnection" type="System.Web.Security.SqlMembershipProvider" connectionStringName="MySqlConnection" 
applicationName="HQChannel" 
enablePasswordRetrieval="true" 
enablePasswordReset="true"
requiresQuestionAndAnswer="false" 
requiresUniqueEmail="true" 
passwordFormat="Hashed" 
minRequiredNonalphanumericCharacters="0" 
minRequiredPasswordLength="6" />
 </providers>
 </membership> 
```

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T19:29:52.277

这里有两件事对我来说很突出。首先是您允许 * 用户而不是 ? 用户。* 表示匿名，? 表示经过身份验证。我会将其更改为以下内容并查看是否有帮助...

```
<authorization>
   <allow users="?" />
   <deny users="*" />
</authorization> 
```

第二个想法是您想将slidingExpiration="true" 添加到您的身份验证块中。这将使登录进入一个滑动窗口 - 所以他们只有在 20 分钟不活动后才会退出......

```
<forms name=".ASPXFORMSAUTH" timeout="20" slidingExpiration="true" /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T19:37:00.687

我还将检查代码并查看表单身份验证票证是否被不同的超时覆盖，如下面的示例所示。

```
FormsAuthenticationTicket ticket = new FormsAuthenticationTicket
(
   1, // version
   txtEmail.Text, // name
   DateTime.Now, // issueDate
   DateTime.Now.AddMinutes(30), // expiration
   false, // isPersistent
   roles, // userData
   FormsAuthentication.FormsCookiePath // cookiePath
 ); 
```

如果设置被代码明确覆盖，则 web.config 设置将无法按预期工作。

# .net - 如何让 WebBrowser 将其内容保存为 MHT 文件？

> ID：508318
> 
> 赞同：1
> 
> 时间：2009-02-03T18:29:58.857
> 
> 标签：.net, internet-explorer, com, browser, extensibility

Internet Explorer 可以使用“另存为...”菜单命令将其内容保存为 MHTML 文件。这个特性是通过它的 COM 接口暴露出来的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T18:32:59.663

是的。

这是。

尝试类似：

```
WebBrowser.ExecWB OLECMDID_SAVEAS, OLECMDEXECOPT_PROMPTUSER 
```

顺便说一句，要手动进行 MHT 转换，请查看[Jeff Atwood 的代码](http://www.codeproject.com/KB/files/MhtBuilder.aspx?fid=104741&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2381970)。

# c# - 在 C# 中使用带有泛型的访问者模式

> ID：508321
> 
> 赞同：8
> 
> 时间：2009-02-03T18:30:19.060
> 
> 标签：c#, design-patterns, visitor-pattern

我想知道下面的访问者模式是否可以接受。从 Accept() 或 Visit() 调用返回时我感到有点不舒服 - 这是该模式的适当用法吗？如果不是，为什么不呢？

**注意：**为长代码示例道歉，似乎有必要了解我正在做的事情，因为访问者似乎总是有点参与......

```
interface IAnimalElement<T>
{
   T Accept(IAnimalVisitor<T> visitor);
}

interface IAnimalVisitor<T>
{
    T Visit(Lion lion);
    T Visit(Peacock peacock);
    T VisitZoo(List<Animal> animals);
}

abstract class Animal
{
    public int Age { get; protected set; }
}

class Lion : Animal, IAnimalElement<int>
{
    public Lion(int age)
    {
        Age = age;
    }

    public int Accept(IAnimalVisitor<int> visitor)
    {
        return visitor.Visit(this);
    }
}

class Peacock : Animal, IAnimalElement<int>
{
    public Peacock(int age)
    {
        Age = age;
    }

    public int Accept(IAnimalVisitor<int> visitor)
    {
        return visitor.Visit(this);
    }
}

class AnimalAgeVisitor : IAnimalVisitor<int>
{
    public int TotalAge { get; private set; }

    int IAnimalVisitor<int>.Visit(Lion lion)
    {
        TotalAge += lion.Age;
        return lion.Age;
    }

    int IAnimalVisitor<int>.Visit(Peacock peacock)
    {
        TotalAge += peacock.Age + 10;
        return peacock.Age + 10; // peacocks ages are always -10y, correct.
    }

    public int VisitZoo(List<Animal> animals)
    {
        // Calculate average animal age.

        int sum = 0;
        int count = 0;
        foreach (IAnimalElement<int> animal in animals)
        {
            sum += animal.Accept(this);
            ++count;
        }

        return count == 0 ? 0 : sum / count;
    }
}

class Program
{
    static void Main(string[] args)
    {
        List<Animal> animals = new List<Animal>() { new Lion(10), 
          new Lion(15), new Peacock(3), new Lion(2), new Peacock(9) };

        AnimalAgeVisitor visitor = new AnimalAgeVisitor();

        Console.WriteLine("Average age = {0}, Total age = {1}", 
            visitor.VisitZoo(animals), visitor.TotalAge);
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-04T05:09:47.240

对我来说，这感觉就像实施有点悬而未决。

要么让您的 Visit 和 Accept 方法返回 void 并跟踪 Visitor 对象中的所有状态。最后询问一下。

或者 ...

让访问和接受返回进行中状态并以功能方式接受传入的进行中状态。

如果您选择第二个选项，我不确定是否需要访问者对象或模式，您可以使用迭代器、函数和一些瞬态代替。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-12-23T18:23:38.507

**简短的回答：**我没有看到公开返回泛型参数的 IVisitor 的任何问题。
请参阅[FxCop 规则](https://msdn.microsoft.com/en-us/library/bb429379%28v=vs.80%29.aspx)。

然后它允许使用不同的**IVisitor** ，每个返回不同的值。

但是，**在您的情况下**， Visitor 没有用，因为每只动物都有*Age*属性，所以一切都可以通过**Animal**或新的**IAnimal**接口来完成。

**另一种选择是以丢失Strong Typing**为代价使用**[多次调度](https://en.wikipedia.org/wiki/Multiple_dispatch)**。

 **当您想替换（或避免编写）这样的**开关**时，请使用[**访问者**模式](https://en.wikipedia.org/wiki/Visitor_pattern)：

 **```
IAnimal animal = ...;
switch (animal.GetType().Name)
{
  case "Peacock":
    var peacock = animal as Peacock;
    // Do something using the specific methods/properties of Peacock
    break;
  case "Lion":
    var peacock = animal as Lion;
    // Do something using the specific methods/properties of Lion
    break;
   etc...
} 
```

或嵌套的***if-then-else***等效项。

其目的是通过使用多态性将实例路由到与其类型相关的例程，然后避免***丑陋的 if-then-else/switch 语句***和***手动转换***。此外，它有助于减少不相关代码之间的**耦合。**

替代方法是在类树中添加一个虚拟方法来访问。但是，有时这是不可能或不可取的：

*   **不可修改**的可访问类代码（例如不拥有）
*   **与访问代码无关的可访问**类代码（将其添加到类中将意味着降低类的**凝聚力**）。

这就是为什么它经常用于遍历对象树（html 节点、词法分析器标记等）。**访问者**模式意味着以下接口：

*   **访问者**

    ```
    /// <summary>
    /// Interface to implement for classes visiting others. 
    /// See Visitor design pattern for more details.
    /// </summary>
    /// <typeparam name="TVisited">The type of the visited.</typeparam>
    /// <typeparam name="TResult">The type of the result.</typeparam>
    public interface IVisitor<TVisited, TResult> : IVisitor where TVisited : IVisitable
    {
        TResult Visit(TVisited visited);
    }

    /// <summary>
    /// Marking interface.
    /// </summary>
    public interface IVisitor{} 
    ```

*   **可访问**

    ```
    /// <summary>
    /// Interface to implement for classes visitable by a visitor.
    /// See Visitor design pattern for more details.
    /// </summary>
    /// <typeparam name="TVisitor">The type of the visitor.</typeparam>
    /// <typeparam name="TResult">The type of the result.</typeparam>
    public interface IVisitable<TVisitor, TResult> : IVisitable where TVisitor : IVisitor
    {
        TResult Accept(TVisitor visitor);
    }

    /// <summary>
    /// Marking interface.
    /// </summary>
    public interface IVisitable {} 
    ```

每个**IVisitable**中**Accept**的实现应该调用*Visit(this)*。

 **** * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-05-02T18:38:02.767

可访问的接受方法不应该返回任何东西。接受仅应指示访问者在访问之后或访问期间访问什么。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T18:51:44.117

这是相当普遍的。我不知道您是否可以在 C# 中执行此操作，但在 Java 中，将 Accept 方法保留为通用方法是正常的，因此返回的内容由访问者而不是访问者决定：

```
interface IAnimalElement
{
   <T> T Accept(IAnimalVisitor<T> visitor);
}

interface IAnimalVisitor<T> 
{
   T Visit(Peacock animal);
  ...
} 
```

对于程序，可以使用`IAnimalVisitor<Void>`返回。`null`

# algorithm - 算法复杂度

> ID：508324
> 
> 赞同：5
> 
> 时间：2009-02-03T18:32:07.340
> 
> 标签：algorithm, complexity-theory

我会有一个很笼统的问题。除了在学校作为程序员之外，您是否曾经必须真正计算（例如在纸上）算法的复杂性？如果..你能给我一个例子吗？

谢谢你 ：）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T18:40:06.963

如果您正在编写一个软件并且您可以考虑多种方法来实现它，那么通常决定因素之一（除了概念复杂性和实现时间）将是算法复杂性。因此，当你的老板想要为你的决定提供理由时，弄清楚每个决定的复杂性是必要的。虽然有些人可能认为这是一种过早优化的形式，但我认为共识是选择适合您的问题的设计只是好的软件工程。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T18:42:31.857

绝对 - 我们最近刚刚遇到了我们的应用程序的问题，它突然开始出现一些严重的减速。事实证明，我们在一个非常主要的函数中间有一个三次 (O(n^3)) 算法。它被隐藏在抽象层之下。弄清楚发生了什么需要绘制函数调用图并查看细节。

诚然，一旦我们这样做了，我就不需要应用任何数学来注意到 O(n^3) 算法，但这主要是因为在大学里 3 年的算法分析让我对三次算法有一个大致的感觉好像。

无论如何，事实证明 N 只增加了一点点，但它正处于从几百毫秒到几秒钟再到几分钟的风口浪尖 - 所以这个问题直到最近才出现.

在大多数情况下，您将使用已定义复杂性的预打包算法。快速排序是 O(n^2) 最坏情况和 O(n*log(n)) 平均情况，二分查找是 O(log(n)) 等等。库通常会指定它们的性能特征，而您只需需要担心它们是如何组成的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-03T18:41:26.370

在工作中，我们随便讨论解决问题的各种算法，复杂性发挥了作用。这绝不是我们必须对复杂性进行严格证明的事情，而只是一般的“我们可以做 X，但那会是 O(N^2)，这太过分了，因为我们可能会迭代数百万行。”

过度优化可能会导致糟糕的代码，但了解基本算法的复杂性对于确定解决编程问题的最佳方法大有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T18:35:35.787

不知道你有没有把编程竞赛当成学校，但是要看你能不能在时限内解决一个竞赛问题（有指定的问题大小限制），你得通过考虑所用算法的复杂性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T18:41:59.270

当然！任何时候，你做的事情超过一百万次，你可能想要检查你的算法。

我做过的一个例子是，当我生成数百万张必须适合网格模式的图像时。抱歉 - 无法更具体地说明这一点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T18:44:27.487

是的。

一般来说，复杂性对于餐巾纸的猜测来说已经足够明显了，这对于开发来说是很好的，直到我达到需要测量性能的地步。在许多情况下，我担心的部分很好（即餐巾猜测已经足够好），而其他一些事情正在减慢软件的速度。在几乎所有情况下，遵循我的基本假设并稍后衡量性能是值得的。

但是，当我在编写时间要求非常严格的代码时，尤其是在图形渲染中，我确实会坐下来确定算法复杂性以及与以替代方式执行它相关的权衡。

今天我正在使用其他人的代码，而且速度非常慢。我真的不在乎 - 它可能需要 10 分钟，这对它增强的整个过程很重要。但是我不得不查看代码来修复一个错误，而这个人在循环中的循环中有循环，他们中的大多数人每次都以相同的方式搜索相同的列表以查找不同的元素。本质上，他改变了一个很好的数组函数，比如 func(i){return records[i];} 变成了一个可怕的搜索例程：

```
func(i)
{
   for each index in records
      if i==index return records[index]
   next
} 
```

现实要糟糕得多，但你明白了。

你现在在学校学习这个的原因是你可以看到这些结构并自动对它们进行分类。您可能不需要实际计算或将其减少到一个很好的简洁复杂性数字，但如果您现在不手动操作并看到很多，您也将生成这样的代码，您只需没有线索。

-亚当

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T18:44:44.757

我不知道我真的把事情写下来了，但我一直在评估我是如何构建我的算法的，看看我是否可以提高它的效率。对于代码，我问自己是否有办法将嵌套循环变成单个循环，或者从循环变成使用分而治之的方法。这相当于从 O(N ² ) 到 O(N) 和从 O(N) 到 O(log [2] N)。SQL 也是如此——我可以删除一个连接并使用索引来执行子查询——也许从 O(N ² ) 到 O(N) （甚至 O(1) 如果它使我能够在两张表）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-03T18:45:48.497

是和不是。

我正在编写一个工具来将一组包的 RPM 依赖项扁平化为一个链。显而易见的解决方案运行得太慢了，所以我稍微挖掘了一下记忆以记住`O(n+m)`图论课上的算法。我做了一些粗略的计算以确保它确实是`O(n+m)`，然后将其编写并投入生产:)

# ruby - 如何在不使用 eval 的情况下动态调用类？

> ID：508331
> 
> 赞同：0
> 
> 时间：2009-02-03T18:33:13.017
> 
> 标签：ruby, eval

是否可以摆脱下面的**eval**语句？下面的代码过滤掉所有从 BaseClass 类型派生的类。然后实例化这些类并调用方法“hello”。

```
module MySpace

  class BaseClass
    def hello; print "\nhello world"; end
  end

  class A<BaseClass
    def hello; super; print ", class A was here"; end
  end

  class B<BaseClass
    def hello; super; print ", I'm just a noisy class"; end
  end

  MySpace.constants.each do | e |
    c=eval(e)
    if c < BaseClass
      c.new.hello
    end
  end

end 
```

所以执行后的输出是：

**你好世界，我只是一个吵闹的班级
你好世界，A班来了**

我认为不必要地使用**eval**是邪恶的。而且我不确定这里是否强制使用**eval 。**动态调用“BaseClass”类型的所有类是否有更智能的方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T18:40:16.933

```
c = MySpace.const_get(e) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T18:40:28.087

你有看过`class_eval`吗？

```
-------------------------------------------------- ---- 模块#class_eval
     mod.class_eval(string [, filename [, lineno]]) => obj
     mod.module_eval {|| 块 } => 对象
-------------------------------------------------- ----------------------
     在 _mod_ 的上下文中评估字符串或块。这可以是
     用于向类添加方法。+module_eval+ 返回结果
     评估其论点。可选的 _filename_ 和 _lineno_
     参数设置错误消息的文本。

        类的东西
        结尾
        a = %q{def hello() "你好！" 结尾}
        Thing.module_eval(a)
        将 Thing.new.hello()
        Thing.module_eval("无效代码", "dummy", 123)

    产生：

        你好呀！
        dummy:123:in `module_eval': 未定义的局部变量
            或 Thing:Class 的方法“代码”

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T18:41:34.497

eval 是我所知道的将字符串转换为常量的唯一方法。它甚至是rails的方式：http: [//api.rubyonrails.com/classes/Inflector.html#M001638](http://api.rubyonrails.com/classes/Inflector.html#M001638)

奇怪的是常量返回字符串。

# apache-flex - 在 papervision3d 应用程序中使用 flex 组件

> ID：508337
> 
> 赞同：1
> 
> 时间：2009-02-03T18:34:02.857
> 
> 标签：apache-flex, flash, papervision3d

我正在使用 papervision3d 为 3D 库设计 3D 全景查看器。我使用 FlashDevelop 完全在 ActionScript3 中编码。我现在需要添加简单的组件（按钮、下拉菜单、工具栏等）。我知道使用 mxml 很容易创建 UI。有没有人有任何在 mxml 中创建 UI，然后在 papervision3d 对象中使用它们的经验？基本上，我想在全景图中间放置一个由 mxml 文件指定的按钮，但我不知道该怎么做。谢谢你的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-04T09:05:25.173

我正在做一些非常相似的事情：我一直在使用 Papervision3D 开发一个 3D 全景查看器，并将 Flex 控件添加为界面。[（您可以在http://www.panocast.com](http://www.panocast.com)查看查看器的当前状态）

我在这里所做的与您的要求完全相反：我将 Papervision3D 视图包装在 UIComponent 中，并将其放入 MXML 文件中。通过将它放在一个 中`Canvas`，我能够将控件放置在它上面。就是这样：

```
<mx:Canvas width="100%" height="100%">
    <!-- the main panoarama player object -->
    <pp:PanoViewer id="pv" width="100%" height="100%" />

    <!-- horizontal control bar -->
    <mx:HBox id="controls" bottom="10" left="10" right="10">
        <!-- rewind & play/pause buttons -->
        <mx:ButtonBar id="playbackButtons" buttonWidth="26">
            <mx:dataProvider>
                <mx:Array>
                    <mx:Object icon="@Embed(source='../../../../assets/rewind.png')" toolTip="Rewind video" name="rewind" />
                    <mx:Object icon="{playIcon}" toolTip="Play video (space)" name="play" />
                </mx:Array>
            </mx:dataProvider>
        </mx:ButtonBar>
    ... 
```

等等

# c# - C# 如何连接到 MS Access 2007

> ID：508345
> 
> 赞同：5
> 
> 时间：2009-02-03T18:36:19.123
> 
> 标签：c#

我在连接到我的 MS Access DB 2007 时遇到问题。代码：

```
private void btnSave_Click(object sender, EventArgs e)
    {
        OleDbConnection Conn = new OleDbConnection();

        try
        {
            string conn = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source="+ Directory.GetCurrentDirectory() +"\\dvd_manager.accdb;Persist Security Info=False;";
            Conn.ConnectionString = conn;

            Conn.Open();

            int i = cbbLocatie.SelectedIndex + 65;
            char c = (char)i;

            string sql = "INSERT INTO DVD (titel, locatie)VALUES(@titel, @locatie)";
            OleDbCommand Com = new OleDbCommand();
            Com.CommandText = sql;
            Com.Connection = Conn;

            OleDbParameter Param = new OleDbParameter("@titel", txtTitle.Text);
            Com.Parameters.Add(Param);

            Param = new OleDbParameter("@locatie", c);
            Com.Parameters.Add(Param);

            Com.ExecuteNonQuery();
            Conn.Close();

            MessageBox.Show("Data is opgeslagen " + sql);
        }
        catch (Exception ex)
        {
            MessageBox.Show("Fout opgetreden: " + ex.Message);
        }
        finally
        {
            Conn.Close();
        }
    } 
```

当我运行此代码时，会出现消息框。这应该意味着我的数据被插入。但是当我打开 accdb 文件时，没有插入任何数据。我究竟做错了什么？

谢谢

编辑： ExecuteNonQuery() 的返回值为 1 （我编辑我的帖子，因为我无法添加任何评论，当我单击添加评论时，该框不显示..）

编辑 2：我创建了一个具有 Title 和 Location 属性的类。代码：private void btnSave_Click(object sender, EventArgs e) { OleDbConnection Conn = new OleDbConnection();

```
try
{
    string conn = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source="+ Directory.GetCurrentDirectory() +"\\dvd_manager.accdb;Persist Security Info=False;";
    Conn.ConnectionString = conn;

    // Create object
    Medium M = new Medium();
    int i = cbbLocatie.SelectedIndex + 65;
    char c = (char)i;

    M.Location = c;
    M.Title = txtTitle.Text;

    Conn.Open();

    string sql = "INSERT INTO DVD (titel, locatie)VALUES(@titel, @locatie)";
    OleDbCommand Com = new OleDbCommand();
    Com.CommandText = sql;
    Com.Connection = Conn;

    OleDbParameter Param1 = new OleDbParameter("@titel", M.Title);
    Com.Parameters.Add(Param1);

    OleDbParameter Param2 = new OleDbParameter("@locatie", M.Location);
    Com.Parameters.Add(Param2);

    int ret = Com.ExecuteNonQuery();
    Conn.Close();

    MessageBox.Show("Data is opgeslagen " + ret);
}
catch (OleDbException ex)
{
    MessageBox.Show(ex.Message);
}
catch (Exception ex)
{
    MessageBox.Show("Fout opgetreden: " + ex.Message);
}
finally
{
    Conn.Close();
} 
```

}

由于我仍然无法单击添加评论按钮，这是我的带有无名 sql 参数的新代码：

```
// some code
Conn.Open();

string sql = "INSERT INTO DVD (titel, locatie)VALUES(?, ?)";
OleDbCommand Com = new OleDbCommand();
Com.CommandText = sql;
Com.Connection = Conn;

OleDbParameter Param1 = new OleDbParameter("@p1", OleDbType.VarChar, 1);
Param1.Value = M.Title;
Com.Parameters.Add(Param1);

OleDbParameter Param2 = new OleDbParameter("@p2", OleDbType.VarChar, 255);
Param2.Value = M.Location;
Com.Parameters.Add(Param2);

int ret = Com.ExecuteNonQuery();
Conn.Close();
// morde code 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T18:40:03.593

ExecuteNonQuery 将返回一个 int 指示受影响的行数。我要做的第一件事是检查退货。ExecuteNonQuery 可以执行并且不会影响任何不会触发捕获的行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T19:10:47.683

据我所知，您不能将命名参数与 OleDbParameter 一起使用。

您的插入应如下所示：

```
string sql = "INSERT INTO DVD (titel, locatie)VALUES(?, ?)"; 
```

然后您必须以正确的顺序添加 OleDbParameters。不使用名称。

[http://msdn.microsoft.com/en-us/library/system.data.oledb.oledbparameter.aspx](http://msdn.microsoft.com/en-us/library/system.data.oledb.oledbparameter.aspx)

编辑：

下面是未经测试的代码，但这里是我将如何做的一个例子。

```
using(OleDbConnection connection = new OleDbConnection(CONNECTION_STRING))
{
  using(OleDbCommand command = connection.CreateCommand())
  {
    command.CommandType = CommandType.Text;
    command.CommandText = "INSERT INTO DVD(title,locatie)VALUES(?,?)";
    command.Parameters.Add("@p1", OleDbType.VarChar, 1).Value = M.Title;
    command.Parameters.Add("@p2", OleDbType.VarChar, 255).Value = M.Location;

    connection.Open();
    int ret = command.ExecuteNonQuery();
  }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-02T17:18:09.733

当我编码时，我喜欢简化我的工作，而不是在我有方法时重做。我会简单地为参数创建一个方法，例如：

```
public void setParameter(String paramAT, String paramTxt)
{
    OleDbCommand myCommand;
    DbParameter parameter = myCommand.CreateParameter();
    parameter.ParameterName = paramAT;
    parameter.Value = paramTxt;
    myCommand.Parameters.Add(parameter);
}

public int CreateDVD()
{
    try
    {
        string strSqldvd = "INSERT INTO DVD(title,locatie)VALUES(@title,@locate?)";

        myCommand = (OleDbCommand)dbconn.MyProvider.CreateCommand();
        dbconn.MyConnection.Open();
        myCommand.Connection = dbconn.MyConnection;
        myCommand.CommandText = strSqldvd;
        setParameter("@title",M.Title );
        setParameter("@locate", M.Location);
    }
    catch (Exception)
    {
        throw new ArgumentException();
    }

    int count = myCommand.ExecuteNonQuery();
    dbconn.MyConnection.Close();
    return count;
} 
```

这是多么简单。我在更新和插入等中插入并继续使用此参数方法......希望这会有所帮助。

# javascript - 确定网格上允许的移动

> ID：508356
> 
> 赞同：2
> 
> 时间：2009-02-03T18:38:42.367
> 
> 标签：javascript, grid

任何人都可以建议一种合适的方法来计算网格上允许的棋子移动，类似于下图中的网格。

![网格布局](https://farm4.static.flickr.com/3534/3250436085_c91b07c7fd.jpg)

假设piece1在a1位置，piece2在c3位置，如果piece1可以移动（比如说）3个方格，而piece2可以移动2个方格，我怎么知道哪些方格是允许移动的？

我似乎花了太长时间开发基于文本的 MUDS，即使在最简单的情况下，我也根本无法让我的大脑采取下一步措施来可视化潜在的运动。

如果这很重要，我会尝试在 javascript 中执行此操作，但老实说，我认为我在这里的失败是未能正确概念化 - 而不是语言理解方面的失败。

**更新 - 我正在添加在发布以下回复后编写的第一轮代码。我认为查看代码可能对与我处于类似情况的人有用**

它很草率，到目前为止它仅适用于放置在板上的一个项目，但至少该`check_allowable_moves()`功能适用​​于此初始运行。对于那些想知道为什么我要创建那些奇怪的字母数字对象而不仅仅是使用数字 x 轴和 y 轴的人 - 这是因为 HTML 中的 id 不能以数字开头。事实上，假装我*可以*使用数字来开始 id 对理解我得到的奇妙答案所描述的功能和概念有很大帮助。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml;utf-8"/>

<title>Test page</title>
<style> 

    #chessboard { clear: both; border:solid 1px black; height: 656px; 
                  width:656px; /*width = 8*40 + 16 for border*/ }
    #chessboard .row { overflow: auto; clear: both; }
    #chessboard .row span { display: block; height: 80px; 
                            width: 80px; float: left; 
                            border:solid 1px black; }
    .allowable { background: blue; }
</style>
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
    google.load("jquery", "1.2.6");
    google.load("jqueryui", "1.5.3");
</script>
<script type="text/javascript">
$(document).ready(function() {
    (function() {
    var global = this;
    global.Map = function(container) {
        function render_board() {
        var max_rows = 8;
        var cols = new Array('a','b', 'c', 'd', 'e', 'f', 'g', 'h');
        var jqMap = $('<div />');
        jqMap.attr('id', 'chessboard');
        var x=0;
        for(x; x<max_rows; x++) {
            var jqRow = $('<span />');
            jqRow.addClass('row');
            var i=0;
            for(i; i<cols.length; i++) {
                var jqCol = $('<span />');
                jqCol.attr('id', cols[i]+(x+1));
                jqCol.addClass(cols[i]);
                jqRow.append(jqCol);
            }
          jqMap.append(jqRow);
        }
     $('#'+container).append(jqMap);
   }
   function add_piece(where, id) {
     var jqPiece = $('<div>MY PIECE'+id+'</div>');
     var jqWhere = $('#'+where);
     jqPiece.attr('id', 'piece-'+id);
     jqPiece.addClass('army');
     jqPiece.draggable({cursor: 'move',
                              grid:[82, 82],
                              containment: '#chessboard',
                              revert: 'invalid',
                              stop: function(ev, ui) {
                                //console.log(ev.target.id);
                              }
                            });
     jqWhere.append(jqPiece);
     check_allowable_moves(where);
    }
    function check_allowable_moves(location) {
     var x_axis = { 'a':1,'b':2, 'c':3, 'd':4, 'e':5, 'f':6, 'g':7, 'h':8 };
     var x_axis_alpha = { 1:'a',2:'b', 3:'c', 4:'d', 5:'e', 6:'f', 7:'g', 8:'h' };
     $('.allowable').droppable("destroy");
     $('.allowable').removeClass('allowable');
     //get the x,y values of the piece just placed
     var x = parseInt(x_axis[location[0]], 10);
     var y = parseInt(location[1], 10);
     var x_min = x-2;
     var y_min = y-2;
      for(x_min; x_min<=x+2; x_min++) {
        for(y_min; y_min<=y+2; y_min++) {
           var jqCell = $('#'+x_axis_alpha[x_min]+y_min)
           jqCell.addClass('allowable');
           jqCell.droppable({ accept: '.army',
              drop: function(ev, ui) {
                //console.log(ev, ui, $(this));
                //handle_drop(ev, ui, $(this));
                check_allowable_moves($(this).attr('id'));
              }
            });
        }
        y_min = parseFloat(y)-2;
      }
    }
    render_board();
    add_piece('d5', '2');
   }
 })();
var map = new Map('content');
});
</script>
</head>

<body id="debug">
    <div id="page">
        <div id="content"> </div>
    </div><!-- end page -->
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T18:49:25.277

假设 p 位于位置 x, y 并且可以将 n 个方格移开到位置 x2, y2。这意味着 (x - x2) 和 (y - y2) 之间的绝对差之和不能大于 n。

如果您要显示可以移动到哪些方格（而不是输入 x2 和 y2），我认为最好在棋子周围的方格中循环所有位置。那是...

```
for (x - n TO x + n):
    for (y - n TO x + n):
        if (abs(x - x2) + abs(y - y2) <= n):
            mark as okay. 
```

这个答案假设棋子只能移动到相邻的方格而不是对角线。

编辑：如果您想要对角线移动，并且沿对角线移动的成本与水平或垂直移动一样多，那么问题实际上要容易得多 - 块 p 可以在 (x - n, x + n) 和(y - n, y + n)。

如果对角线移动的成本不如水平+垂直移动的成本高（例如，如果对角线的成本为 1.5，而 h/v 的成本为 1），那么答案将变得更加复杂。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T19:43:34.513

一般而言，此类问题涉及人们可能到达的合理有限的网格。取一个网格大小的数据结构，其元素可以以足够的精度保存剩余运动点的数量。

将网格初始化为未访问的值。这不得在零到最大可能移动速度的范围内。负值是理想的。

将起始位置初始化为剩余的移动次数。

此时有三种可能的方法：

1）每一步重新扫描整个网格。简单但速度较慢。终止是当没有点产生合法的举动时。

2）将点存储在堆栈上。比#1 快，但仍然不是最好的。终止是堆栈为空时。

3) 将点存储在队列中。这是最好的。终止是队列为空时。

```
Repeat
   ObtainPoint {From queue, stack or brute force}
   For Each Neighbor do
      Remaining = Current - MovementCost
      If Remaining > CurrentValue[Neighbor] then
         CurrentValue[Neighbor] = Remaining
         Push or Queue Neighbor
Until Done 
```

请注意，使用基于堆栈的方法时，您总是会遇到一些最终丢弃旧计算并再次执行它们的情况。只有在某些情况下绕过恶劣地形比通过它便宜时，基于队列的方法才会发生这种情况。

仅在循环结束时检查终止条件，否则在获取点尝试使用空队列或堆栈时终止。获得点之后的空队列/堆栈并不*意味着*你已经完成了！

（请注意，这是对伊恩答案的相当大的扩展。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T18:53:52.100

这纯粹是在概念层面上，但试试这个逻辑：

1.  将所有可能的位置从您的起点移走一步并将它们放在堆栈上（已采取的移动 =0）

2.  从堆栈中弹出一个并重复，使用该新坐标作为您的新起点。（采取的行动=1）。您必须确保不要在堆栈上放置任何重复的坐标

3.  重复 2 直到你用尽了所有可用的动作。

我可能无法很好地解释这一点，如果您对我要说的内容有任何疑问，请告诉我。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T19:20:46.493

您可以使用上述方法，但改用递归。

递归“深度”是移动距离。

当深度 > 运动时爆发。

每次迭代都应该返回一个空间向量并添加它自己的位置。

删除重复项

# c++ - C/C++ 中的四元数库

> ID：508370
> 
> 赞同：25
> 
> 时间：2009-02-03T18:42:01.297
> 
> 标签：c++, math, quaternions

在 C/C++ 中有什么好的*四元数计算库吗？*

旁注：任何好的教程/示例？我已经用谷歌搜索并浏览了前几页，但也许你有一些来自 compsci 或数学课程的演示/实验室，你可以/愿意分享？

谢谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-03T21:29:27.637

我是 Irrlicht 四元数类的粉丝。它是 zlib 许可的，并且很容易从 Irrlicht 中提取：

*   [Irrlicht 四元数文档](http://irrlicht.sourceforge.net/docu/classirr_1_1core_1_1quaternion.html)
*   [四元数](https://irrlicht.sourceforge.io/docu/quaternion_8h_source.html)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-03T18:46:01.943

您可以尝试使用 Boost - 通常是开始的好地方。他们有一个[专门](http://www.boost.org/doc/libs/1_37_0/libs/math/doc/quaternion/html/index.html)的子库。

至于示例，请查看 Boost 随附的文档和单元测试。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-11-14T02:45:09.247

有 Eigen，一个用于 Blender 和 KDE 程序的数学和几何模板库，它在单个 .h 文件中定义了一个漂亮的四元数类。

[http://eigen.tuxfamily.org/index.php?title=Main_Page](http://eigen.tuxfamily.org/index.php?title=Main_Page) 和 [http://www.ohloh.net/p/5393](http://www.ohloh.net/p/5393)上的信息

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-08-17T23:46:06.250

如果你决定自己动手，或者真的想了解代码背后的数学原理（对调试很有用），我强烈推荐[Martin Baker 的网站](http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/index.htm)。它看起来很原始，但解释很透彻，易于理解，而且他还提供了一些地方的代码。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-03T18:53:51.930

DirectX 有自己的[四元数函数](http://msdn.microsoft.com/en-us/library/bb206327.aspx)，其他几个 3D 库也是如此。

在我看来，学习四元数如何工作的最好方法是自己研究数学。[四元数](http://en.wikipedia.org/wiki/Quaternions_and_spatial_rotation)和[转换](http://en.wikipedia.org/wiki/Conversion_between_quaternions_and_Euler_angles)的维基百科页面包含您需要的所有公式。我从那写了我自己的四元数库:)（它在 Haskell 中，所以我不会费心发布它。）

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-03T21:14:17.263

有关四元数的文档，请查看 3D 图形教科书。它们只是使用乘法而不是计算量大的三角函数来产生 3D 旋转效果的矩阵。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-05-28T08:06:25.273

如果您使用四元数，这个网络[euclideanspace](http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/index.htm)非常重要。它具有所有算术逐步，等价，简化，不同语言的代码示例。在此页面之后，我自己完成了大部分功能。我更喜欢下载图书馆。功能易于编程，您可以边学习边学习。

作为一个例子，我建议你检查这个关于四元数乘法的 c++ 函数： [Efficient C++ quaternion multiplication using cv::Mat](https://stackoverflow.com/questions/10781033/eficient-c-quaternion-multiplication-using-cvmat)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-07-03T08:50:52.497

[石墨烯](https://github.com/ebassi/graphene/)是一个简单的 C/GObject 库，对 3D 图形中常见的各种矢量、矩阵、四元数等计算进行了 SIMD 优化。

# computer-science - 什么是向量，它们在编程中是如何使用的？

> ID：508374
> 
> 赞同：54
> 
> 时间：2009-02-03T18:44:06.223
> 
> 标签：computer-science, vector

我熟悉向量的数学/物理概念作为幅度和方向，但我也经常在编程上下文中遇到对向量的引用（例如 C++ 似乎有一个 stl::vector 库出现在 SO 上相当频繁）。

我从上下文中的直觉是，它们是一个相当原始的构造，最常用于表示沿可变长度数组的线的东西（我认为将其大小存储为幅度），但如果有人能为我提供更完整的解释，最好包括它们在实践中的使用方式和原因。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-02-03T18:47:26.980

来自[http://www.cplusplus.com/reference/stl/vector/](http://www.cplusplus.com/reference/stl/vector/)

> 向量容器被实现为动态数组；与常规数组一样，向量容器的元素存储在连续的存储位置，这意味着不仅可以使用迭代器访问它们的元素，还可以使用指向元素的常规指针的偏移量来访问它们的元素。
> 
> 但与常规数组不同，向量中的存储是自动处理的，可以根据需要进行扩展和收缩。

此外，向量通常可以保存任何对象——因此您可以创建一个类来保存有关车辆的信息，然后将车队存储在向量中。

除了调整大小之外，向量的好处是它们仍然允许通过索引在恒定时间内访问单个元素，就像数组一样。

调整大小的权衡是，当您达到当前容量时，它必须重新分配，有时复制到更多内存。然而，大多数容量增加算法在每次遇到障碍时都会使容量翻倍，因此您永远不会超过 log2（可用堆），在整个程序运行过程中，在最坏的情况下可能会达到十几次。

-亚当

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-02-03T18:59:28.110

在数学中，向量可以被认为是方向和大小的组合。但是，它也可以被认为是一个坐标。例如，大小为 5 且与水平线成约 37 度角的矢量表示 2D 平面上的一个点。这个点也可以用笛卡尔坐标对 (3, 4) 来表示。这对 (3, 4) 也是一个数学向量。

在编程中，“向量”这个名称最初用于描述任何固定长度的标量数序列。长度为 2 的向量表示 2D 平面中的点，长度为 3 的向量表示 3D 空间中的点，依此类推。长度为 100 的向量表示 100 维空间中的一个点（数学家可以毫不费力地思考这些事情）。

在现代编程库中，“向量”这个名称通常意味着*可变*大小的值序列（不一定是数字）。除非您正在执行某种投影操作，否则您通常不会更改数学向量的大小（长度或维度）。但是更改包含字符串序列的编程向量的长度可能是一种常见的操作。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-03T18:51:06.833

您习惯使用的数学向量是[第一级的张量](http://mathworld.wolfram.com/Vector.html)；计算机科学中的数据结构不一定遵守张量转换规则。如前所述，它们只是可以扩展和收缩的数组。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-03T18:47:42.800

向量容器被实现为动态数组；与常规数组一样，向量容器的元素存储在连续的存储位置，这意味着不仅可以使用迭代器访问它们的元素，还可以使用指向元素的常规指针的偏移量来访问它们的元素。

但与常规数组不同，向量中的存储是自动处理的，可以根据需要进行扩展和收缩。

向量擅长：

*   通过位置索引（恒定时间）访问单个元素。
*   以任何顺序（线性时间）迭代元素。
*   从其末尾添加和删除元素（恒定摊销时间）。

[参考](http://www.cplusplus.com/reference/stl/vector/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-03T18:52:02.633

我可以从名称中理解您的困惑（我曾经也对此感到困惑）。更接近数学定义的 3D 图形编程中的向量概念并没有帮助。在数学中，向量可以被认为是任意长度的一维矩阵（长度是坐标系的维数）。在大多数 OO 语言中，向量本质上是一维矩阵（数组），因此得名。它们与坐标没有任何关系，除非程序员决定将它们用于该任务（这很少见——我从未见过）。他们通常也没有任何数学运算符来进行矩阵乘法或任何类似的运算。所以它们的一维性质是关于相似性结束的地方。一世'

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-03T18:49:47.583

由于至少有两个其他答案是从[该站点](http://www.cplusplus.com/reference/stl/vector/)粘贴的，因此您可能还想阅读那里的其余描述... :-)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-03T19:04:55.557

来自[SICP 书](http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-33.html#%_sec_5.3.1)：

> 为了对计算机内存进行建模，我们使用了一种称为向量的新型数据结构。抽象地说，向量是一个复合数据对象，其各个元素可以通过整数索引在与索引无关的时间内访问。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-10-20T05:31:23.080

为了帮助你记住“向量”这个词的 CS 含义，参考拉丁词根 vehere 可能会有所帮助，意思是传达或携带。因此，一般来说，向量携带或包含事物。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-08-31T21:23:58.740

[https://isocpp.org/wiki/faq/containers](https://isocpp.org/wiki/faq/containers)有很多你需要的信息来理解这个问题的内容。它将向量与链表、数组等进行对比。

此外，来自 Stroustrup's *Tour* ( [http://www.stroustrup.com/Tour.html](http://www.stroustrup.com/Tour.html) )，第 9 章：

> 大多数计算涉及创建值的集合……。一个以保存对象为主要目的的类……称为**容器**。… 最有用的`stl`容器是`vector`. A`stl::vector`是给定类型的元素序列。元素连续存储在内存中。

**因此，STL 向量是相同类型**的值的集合——在这种方式下，它就像向量/模块的数学含义——但**主要问题是如何存储元素**。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-03-20T17:52:50.010

编程中的向量基本上是动态数组，其中存储自动处理，允许根据需要扩展和收缩。最好的是，它们还允许通过索引在恒定时间内访问单个元素，就像常规数组一样。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-07-20T23:41:00.557

除了 C++ 中的数据结构外，向量也是指向代码的指针的术语。Fe 一个中断向量指向要调用的中断代码。

# mysql - 在 mySQL 中删除查询

> ID：508375
> 
> 赞同：-2
> 
> 时间：2009-02-03T18:44:17.783
> 
> 标签：mysql, propel

阅读文档的底部，特别是：

> “您仍然可以检索已删除对象的属性，但无法保存已删除对象。”

如何？是否只有启用设置？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T18:49:33.013

已删除的对象只是在数据库中被删除并标记为被删除。您仍然可以在 php 中访问它，例如向用户显示一些再见数据（“产品 XYZ 已删除”）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T18:51:41.793

我认为“对象”指的是已经加载到内存中的对象。它是说您仍然可以查看它的属性，但是如果您尝试调用 save 它将尝试执行一个 UPDATE SQL 语句，该语句将失败，因为该记录实际上已被删除。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T18:54:34.440

我对 Propel 的确切工作原理不是很熟悉。但重要的是要了解数据库（MySQL）和 ORM 层（Propel）之间的区别。Propel 是一种抽象，它通过将数据库中的行包装在对象中来表示它们。然后，您可以通过调用相应对象的方法来更改或删除这些行，Propel 将生成并执行所需的 SQL 语句。

因此，在执行 SQL DELETE 语句之后，对象包装器仍将保存在删除行之前加载的数据。但是它将不再允许您修改行数据，因为 Propel 没有地方可以将这些更改写入。

# .net - .NET：如何在 BeginInvoke 回调期间与表单对话？

> ID：508386
> 
> 赞同：2
> 
> 时间：2009-02-03T18:45:58.480
> 
> 标签：.net, asynchronous, delegates

我有一个长期运行的功能¹：

```
public string FindPasswordFromHash(String hash)
{
    ...
} 
```

这被称为：

```
private void Button1_Click(object sender, EventArgs e)
{
    PasswordTextBox.Text = FindPasswordFromHash(HashTextBox.Text);
} 
```

现在我想将其转换为异步 BeginInvoke/EndInvoke 委托模式：

```
private void Button1_Click(object sender, EventArgs e)
{
   MyAsyncDelegate asyncDelegate = new MyAsyncDelegate(HashTextBox.Text);
   asyncDelegte.BeginInvoke(hash, CompleteCallback, null);
}

private void CompleteCallback(IAsyncResult ar)
{
   MyAsyncDelegate asyncDelegate = ((AsyncResult)ar).AsyncDelegate;
   PasswordTextBox.Text = asyncDelegate.EndInvoke(asyncResult);
}

delegate string MyAsyncDelegate(String hash); 
```

当然，这是行不通的，因为异步委托的实现方式存在泄漏抽象：

> “跨线程操作无效：控件'PasswordTextBox'从创建它的线程以外的线程访问。”

鉴于发明了异步委托模式以将长时间运行的操作转换为异步操作 - 使用 BeginInvoke/EndInvoke 替代同步调用的正确技术是什么？

更具体地说，强制回调编组回调用线程的方法是什么？

* * *

¹ 例如发明的函数名称

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T18:54:01.977

您正在正确处理 BeginInvoke() 和 EndInvoke() 调用。您只需要处理需要在 GUI 线程上完成操作 GUI 的事实。

幸运的是，该框架提供了[Control.Invoke()](http://msdn.microsoft.com/en-us/library/zyzhdc6b.aspx)方法，它允许您在 GUI 线程上执行代码。

我通常会这样做：

```
private void SetPasswordText(string password){
  if(InvokeRequired){
    MethodInvoker mi = () => SetPasswordText(password);
    Invoke(mi);
    return;
  }
  PasswordTextBox.Text = password;
} 
```

对于这种特殊情况，您也可以这样做

```
private void RecoveryCompleteCallback(IAsyncResult ar)
{
   MyAsyncDelegate asyncDelegate = ((AsyncResult)ar).AsyncDelegate;
   string password = asyncDelegate.EndInvoke(asyncResult);
   Invoke(()=>{PasswordTextBox.Text = password;});
} 
```

如果你使用 C# 2.0，你会这样做：

```
MethodInvoker mi = delegate(){ SetPasswordText(password); };
Invoke(mi); 
```

或者

```
Invoke(delegate(){PasswordTextBox.Text = password;}); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T18:53:00.963

最好的选择是使用[BackgroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)对象。后台工作对象将允许您运行任务并使用 ReportProgress 更新表单。

希望这可以帮助！联合部队

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T20:00:46.613

这是另一个可能有助于解释幕后情况的实现。

```
 string hash = " your hash text ";

    delegate string MyAsyncDelegate(String hash);

    delegate void UpdateDelegate(string pwd);

    private string FindHash(string hs) {
        Thread.Sleep(5000);

        return "hash computed by worker Thread: " + Thread.CurrentThread.ManagedThreadId;
    }

    private void Button1_Click(object sender, EventArgs e) {
        //invoke FindHash on another thread from the threadpool.
        MessageBox.Show("Current Thread Id: " + Thread.CurrentThread.ManagedThreadId);
        MyAsyncDelegate asyncDelegate = new MyAsyncDelegate(this.FindHash);
        asyncDelegate.BeginInvoke(hash, RecoveryCompleteCallback, asyncDelegate);
    }

    private void RecoveryCompleteCallback(IAsyncResult result) {
        MyAsyncDelegate asyncDelegate = (MyAsyncDelegate)result.AsyncState;
        string pwd = asyncDelegate.EndInvoke(result);

        UpdatePassword(pwd);
    }

    private void UpdatePassword(string s) {

        System.ComponentModel.ISynchronizeInvoke invoker = PasswordTextBox as System.ComponentModel.ISynchronizeInvoke;
        if (invoker != null && invoker.InvokeRequired) {
            // still in worker thread.
            invoker.Invoke(new UpdateDelegate(UpdatePassword), new object[] { s });
        } else {
            PasswordTextBox.Text = s;
            MessageBox.Show("Current Thread Id: " + Thread.CurrentThread.ManagedThreadId);
        }
    } 
```

我知道它有点冗长，但它可以帮助你理解......基本上你永远不想从 GUI 线程以外的线程更新 GUI。

# c# - 基于 XPath 创建 XML 节点？

> ID：508390
> 
> 赞同：49
> 
> 时间：2009-02-03T18:46:23.613
> 
> 标签：c#, xml, xpath

有谁知道从 XPath 表达式以编程方式创建 XML 层次结构的现有方法？

例如，如果我有一个 XML 片段，例如：

```
<feed>
    <entry>
        <data></data>
        <content></content>
    </entry>
</feed> 
```

给定 XPath 表达式 /feed/entry/content/@source 我会：

```
<feed>
    <entry>
        <data></data>
        <content @source=""></content>
    </entry>
</feed> 
```

我意识到使用 XSLT 可以做到这一点，但由于我试图完成固定转换的动态特性将无法正常工作。

我正在使用 C#，但如果有人有使用其他语言的解决方案，请加入。

谢谢您的帮助！

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-02-03T22:59:12.620

在您展示的示例中，唯一创建的是属性...

```
XmlElement element = (XmlElement)doc.SelectSingleNode("/feed/entry/content");
if (element != null)
    element.SetAttribute("source", ""); 
```

如果您真正想要的是能够创建不存在的层次结构，那么您可以拥有自己的简单 xpath 解析器。我不知道将属性保留在 xpath 中。我宁愿将节点转换为元素并添加 .SetAttribute ，就像我在这里所做的那样：

```
 static private XmlNode makeXPath(XmlDocument doc, string xpath)
{
    return makeXPath(doc, doc as XmlNode, xpath);
}

static private XmlNode makeXPath(XmlDocument doc, XmlNode parent, string xpath)
{
    // grab the next node name in the xpath; or return parent if empty
    string[] partsOfXPath = xpath.Trim('/').Split('/');
    string nextNodeInXPath = partsOfXPath.First();
    if (string.IsNullOrEmpty(nextNodeInXPath))
        return parent;

    // get or create the node from the name
    XmlNode node = parent.SelectSingleNode(nextNodeInXPath);
    if (node == null)
        node = parent.AppendChild(doc.CreateElement(nextNodeInXPath));

    // rejoin the remainder of the array as an xpath expression and recurse
    string rest = String.Join("/", partsOfXPath.Skip(1).ToArray());
    return makeXPath(doc, node, rest);
}

static void Main(string[] args)
{
    XmlDocument doc = new XmlDocument();
    doc.LoadXml("<feed />");

    makeXPath(doc, "/feed/entry/data");
    XmlElement contentElement = (XmlElement)makeXPath(doc, "/feed/entry/content");
    contentElement.SetAttribute("source", "");

    Console.WriteLine(doc.OuterXml);
} 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2010-08-12T08:13:54.257

这是我的快速技巧，只要您使用`/configuration/appSettings/add[@key='name']/@value`.

```
static XmlNode createXPath(XmlDocument doc, string xpath)
{
  XmlNode node=doc;
  foreach (string part in xpath.Substring(1).Split('/'))
  {
    XmlNodeList nodes=node.SelectNodes(part);
    if (nodes.Count>1) throw new ComponentException("Xpath '"+xpath+"' was not found multiple times!");
    else if (nodes.Count==1) { node=nodes[0]; continue; }

    if (part.StartsWith("@"))
    {
      var anode=doc.CreateAttribute(part.Substring(1));
      node.Attributes.Append(anode);
      node=anode;
    }
    else
    {
      string elName, attrib=null;
      if (part.Contains("["))
      {
        part.SplitOnce("[", out elName, out attrib);
        if (!attrib.EndsWith("]")) throw new ComponentException("Unsupported XPath (missing ]): "+part);
        attrib=attrib.Substring(0, attrib.Length-1);
      }
      else elName=part;

      XmlNode next=doc.CreateElement(elName);
      node.AppendChild(next);
      node=next;

      if (attrib!=null)
      {
        if (!attrib.StartsWith("@")) throw new ComponentException("Unsupported XPath attrib (missing @): "+part);
        string name, value;
        attrib.Substring(1).SplitOnce("='", out name, out value);
        if (string.IsNullOrEmpty(value) || !value.EndsWith("'")) throw new ComponentException("Unsupported XPath attrib: "+part);
        value=value.Substring(0, value.Length-1);
        var anode=doc.CreateAttribute(name);
        anode.Value=value;
        node.Attributes.Append(anode);
      }
    }
  }
  return node;
} 
```

SplitOnce 是一种扩展方法：

```
public static void SplitOnce(this string value, string separator, out string part1, out string part2)
{
  if (value!=null)
  {
    int idx=value.IndexOf(separator);
    if (idx>=0)
    {
      part1=value.Substring(0, idx);
      part2=value.Substring(idx+separator.Length);
    }
    else
    {
      part1=value;
      part2=null;
    }
  }
  else
  {
    part1="";
    part2=null;
  }
} 
```

样本：

```
public static void Set(XmlDocument doc, string xpath, string value)
{
  if (doc==null) throw new ArgumentNullException("doc");
  if (string.IsNullOrEmpty(xpath)) throw new ArgumentNullException("xpath");

  XmlNodeList nodes=doc.SelectNodes(xpath);
  if (nodes.Count>1) throw new ComponentException("Xpath '"+xpath+"' was not found multiple times!");
  else if (nodes.Count==0) createXPath(doc, xpath).InnerText=value;
  else nodes[0].InnerText=value;
} 
```

例如

```
Set(doc, "/configuration/appSettings/add[@key='Server']/@value", "foobar"); 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-12-03T17:22:53.423

这个想法的一个问题是 xpath 会“破坏”信息。

有无数个 xml 树可以匹配许多 xpath。现在在某些情况下，就像您给出的示例一样，有一个明显的最小 xml 树与您的 xpath 匹配，其中您有一个使用“=”的谓词。

但是例如，如果谓词使用不等于或任何其他除等于以外的算术运算符，则存在无限种可能性。您可以尝试选择一个“规范的”xml 树，例如，它需要最少的位来表示。

例如，假设您有 xpath `/feed/entry/content[@source > 0]`。现在，任何具有适当结构的 xml 树，其中节点内容具有值大于 0 的属性源都将匹配，但有无限数量的大于零的数字。通过选择“最小”值，大概是 1，您可以尝试规范化您的 xml。

Xpath 谓词可以包含相当任意的算术表达式，因此对此的一般解决方案是相当困难的，如果不是不可能的话。你可以想象那里有一个巨大的方程，它必须逆向求解才能得出与方程匹配的值；但是由于可以有无限数量的匹配值（只要它真的是不等式而不是方程），就需要找到一个规范的解决方案。

许多其他形式的表达也会破坏信息。例如，像“或”这样的运算符总是会破坏信息。如果你知道`(X or Y) == 1`，你就不知道 X 是 1，Y 是 1，还是两者都是 1；你肯定知道其中一个是1！因此，如果您有一个使用 OR 的表达式，您无法判断作为 OR 输入的哪些节点或值应该为 1（您可以做出任意选择并将两者都设置为 1，因为这肯定会满足表达式，正如其中只有一个是 1) 的两个选择。

现在假设 xpath 中有几个表达式引用同一组值。然后，您最终会得到一个几乎不可能求解的联立方程或不等式系统。同样，如果将允许的 xpath 限制为其全部功能的一小部分，则可以解决此问题。但是，我怀疑完全一般的情况类似于图灵停止问题。在这种情况下，给定一个任意程序（xpath），找出一组与程序匹配的一致数据，并且在某种意义上是最小的。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-07-15T14:41:59.180

这是我的版本。希望这也会对某人有所帮助。

```
 public static void Main(string[] args)
    {

        XmlDocument doc = new XmlDocument();
        XmlNode rootNode = GenerateXPathXmlElements(doc, "/RootNode/FirstChild/SecondChild/ThirdChild");

        Console.Write(rootNode.OuterXml);

    }

    private static XmlDocument GenerateXPathXmlElements(XmlDocument xmlDocument, string xpath)
    {
        XmlNode parentNode = xmlDocument;

        if (xmlDocument != null && !string.IsNullOrEmpty(xpath))
        {
            string[] partsOfXPath = xpath.Split('/');

            string xPathSoFar = string.Empty;

            foreach (string xPathElement in partsOfXPath)
            {
                if(string.IsNullOrEmpty(xPathElement))
                    continue;

                xPathSoFar += "/" + xPathElement.Trim();

                XmlNode childNode = xmlDocument.SelectSingleNode(xPathSoFar);
                if(childNode == null)
                {
                    childNode = xmlDocument.CreateElement(xPathElement);
                }

                parentNode.AppendChild(childNode);

                parentNode = childNode;
            }
        }

        return xmlDocument;
    } 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-01-09T21:08:23.640

[Mark Miller 的 Java 解决方案](https://stackoverflow.com/a/6608660/241211)的 C# 版本

```
 /// <summary>
    /// Makes the X path. Use a format like //configuration/appSettings/add[@key='name']/@value
    /// </summary>
    /// <param name="doc">The doc.</param>
    /// <param name="xpath">The xpath.</param>
    /// <returns></returns>
    public static XmlNode createNodeFromXPath(XmlDocument doc, string xpath)
    {
        // Create a new Regex object
        Regex r = new Regex(@"/+([\w]+)(\[@([\w]+)='([^']*)'\])?|/@([\w]+)");

        // Find matches
        Match m = r.Match(xpath);

        XmlNode currentNode = doc.FirstChild;
        StringBuilder currentPath = new StringBuilder();

        while (m.Success)
        {
            String currentXPath = m.Groups[0].Value;    // "/configuration" or "/appSettings" or "/add"
            String elementName = m.Groups[1].Value;     // "configuration" or "appSettings" or "add"
            String filterName = m.Groups[3].Value;      // "" or "key"
            String filterValue = m.Groups[4].Value;     // "" or "name"
            String attributeName = m.Groups[5].Value;   // "" or "value"

            StringBuilder builder = currentPath.Append(currentXPath);
            String relativePath = builder.ToString();
            XmlNode newNode = doc.SelectSingleNode(relativePath);

            if (newNode == null)
            {
                if (!string.IsNullOrEmpty(attributeName))
                {
                    ((XmlElement)currentNode).SetAttribute(attributeName, "");
                    newNode = doc.SelectSingleNode(relativePath);
                }
                else if (!string.IsNullOrEmpty(elementName))
                {
                    XmlElement element = doc.CreateElement(elementName);
                    if (!string.IsNullOrEmpty(filterName))
                    {
                        element.SetAttribute(filterName, filterValue);
                    }

                    currentNode.AppendChild(element);
                    newNode = element;
                }
                else
                {
                    throw new FormatException("The given xPath is not supported " + relativePath);
                }
            }

            currentNode = newNode;

            m = m.NextMatch();
        }

        // Assure that the node is found or created
        if (doc.SelectSingleNode(xpath) == null)
        {
            throw new FormatException("The given xPath cannot be created " + xpath);
        }

        return currentNode;
    } 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-09-26T09:33:19.307

我需要一个 XNode 而不是 XmlNode 实现，而 RegEx 对我不起作用（因为带有 . 或 - 的元素名称不起作用）

所以这对我有用：

```
public static XNode createNodeFromXPath(XElement elem, string xpath)
{
    // Create a new Regex object
    Regex r = new Regex(@"/*([a-zA-Z0-9_\.\-]+)(\[@([a-zA-Z0-9_\.\-]+)='([^']*)'\])?|/@([a-zA-Z0-9_\.\-]+)");

    xpath = xpath.Replace("\"", "'");
    // Find matches
    Match m = r.Match(xpath);

    XNode currentNode = elem;
    StringBuilder currentPath = new StringBuilder();

    while (m.Success)
    {
        String currentXPath = m.Groups[0].Value;    // "/configuration" or "/appSettings" or "/add"
        String elementName = m.Groups[1].Value;     // "configuration" or "appSettings" or "add"
        String filterName = m.Groups[3].Value;      // "" or "key"
        String filterValue = m.Groups[4].Value;     // "" or "name"
        String attributeName = m.Groups[5].Value;   // "" or "value"

        StringBuilder builder = currentPath.Append(currentXPath);
        String relativePath = builder.ToString();
        XNode newNode = (XNode)elem.XPathSelectElement(relativePath);

        if (newNode == null)
        {
            if (!string.IsNullOrEmpty(attributeName))
            {
                ((XElement)currentNode).Attribute(attributeName).Value = "";
                newNode = (XNode)elem.XPathEvaluate(relativePath);
            }
            else if (!string.IsNullOrEmpty(elementName))
            {
                XElement newElem = new XElement(elementName);
                if (!string.IsNullOrEmpty(filterName))
                {
                    newElem.Add(new XAttribute(filterName, filterValue));
                }

                ((XElement)currentNode).Add(newElem);
                newNode = newElem;
            }
            else
            {
                throw new FormatException("The given xPath is not supported " + relativePath);
            }
        }

        currentNode = newNode;
        m = m.NextMatch();
    }

    // Assure that the node is found or created
    if (elem.XPathEvaluate(xpath) == null)
    {
        throw new FormatException("The given xPath cannot be created " + xpath);
    }

    return currentNode;
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-08-07T16:13:43.367

这是[Christian Peeters 解决方案](https://stackoverflow.com/a/19024484/241211)的改进版本，支持 xpath 表达式中的命名空间。

```
public static XNode CreateNodeFromXPath(XElement elem, string xpath)
{
    // Create a new Regex object
    Regex r = new Regex(@"/*([a-zA-Z0-9_\.\-\:]+)(\[@([a-zA-Z0-9_\.\-]+)='([^']*)'\])?|/@([a-zA-Z0-9_\.\-]+)");

    xpath = xpath.Replace("\"", "'");
    // Find matches
    Match m = r.Match(xpath);

    XNode currentNode = elem;
    StringBuilder currentPath = new StringBuilder();
    XPathNavigator XNav = elem.CreateNavigator();

    while (m.Success)
    {
        String currentXPath = m.Groups[0].Value;    // "/ns:configuration" or "/appSettings" or "/add"
        String NamespaceAndElementName = m.Groups[1].Value;     // "ns:configuration" or "appSettings" or "add"
        String filterName = m.Groups[3].Value;      // "" or "key"
        String filterValue = m.Groups[4].Value;     // "" or "name"
        String attributeName = m.Groups[5].Value;   // "" or "value"

        XNamespace nspace = "";
        string elementName;
        int p = NamespaceAndElementName.IndexOf(':');
        if (p >= 0)
        {
            string ns = NamespaceAndElementName.Substring(0, p);
            elementName = NamespaceAndElementName.Substring(p + 1);
            nspace = XNav.GetNamespace(ns);
        }
        else
            elementName = NamespaceAndElementName;

        StringBuilder builder = currentPath.Append(currentXPath);
        String relativePath = builder.ToString();
        XNode newNode = (XNode)elem.XPathSelectElement(relativePath, XNav);

        if (newNode == null)
        {
            if (!string.IsNullOrEmpty(attributeName))
            {
                ((XElement)currentNode).Attribute(attributeName).Value = "";
                newNode = (XNode)elem.XPathEvaluate(relativePath, XNav);
            }
            else if (!string.IsNullOrEmpty(elementName))
            {
                XElement newElem = new XElement(nspace + elementName);
                if (!string.IsNullOrEmpty(filterName))
                {
                    newElem.Add(new XAttribute(filterName, filterValue));
                }

                ((XElement)currentNode).Add(newElem);
                newNode = newElem;
            }
            else
            {
                throw new FormatException("The given xPath is not supported " + relativePath);
            }
        }

        currentNode = newNode;
        m = m.NextMatch();
    }

    // Assure that the node is found or created
    if (elem.XPathEvaluate(xpath, XNav) == null)
    {
        throw new FormatException("The given xPath cannot be created " + xpath);
    }

    return currentNode;
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-07-30T11:03:46.447

*   对于**XDocument**
*   支持属性创建

*利用*

```
var xDoc = new XDocument(new XElement("root",
                        new XElement("child1"),
                        new XElement("child2")));

CreateElement(xDoc, "/root/child3");
CreateElement(xDoc, "/root/child4[@year=32][@month=44]");
CreateElement(xDoc, "/root/child4[@year=32][@month=44]/subchild1");
CreateElement(xDoc, "/root/child4[@year=32][@month=44]/subchild1/subchild[@name='jon']");
CreateElement(xDoc, "/root/child1"); 
```

*定义*

```
public static XDocument CreateElement(XDocument document, string xpath)
{
    if (string.IsNullOrEmpty(xpath))
        throw new InvalidOperationException("Xpath must not be empty");

    var xNodes = Regex.Matches(xpath, @"\/[^\/]+").Cast<Match>().Select(it => it.Value).ToList();
    if (!xNodes.Any())
        throw new InvalidOperationException("Invalid xPath");

    var parent = document.Root;
    var currentNodeXPath = "";
    foreach (var xNode in xNodes)
    {
        currentNodeXPath += xNode;
        var nodeName = Regex.Match(xNode, @"(?<=\/)[^\[]+").Value;
        var existingNode = parent.XPathSelectElement(currentNodeXPath);
        if (existingNode != null)
        {
            parent = existingNode;
            continue;
        }

        var attributeNames =
          Regex.Matches(xNode, @"(?<=@)([^=]+)\=([^]]+)")
                .Cast<Match>()
                .Select(it =>
                {
                    var groups = it.Groups.Cast<Group>().ToList();
                    return new { AttributeName = groups[1].Value, AttributeValue = groups[2].Value };
                });

        parent.Add(new XElement(nodeName, attributeNames.Select(it => new XAttribute(it.AttributeName, it.AttributeValue)).ToArray()));
        parent = parent.Descendants().Last();
    }
    return document;
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-02-22T23:34:29.277

如果从后到前处理 XPath 字符串，则更容易处理无根 XPath，例如。//a/b/c... 它也应该支持 Gordon 的 XPath 语法，虽然我没有尝试过...

```
static private XmlNode makeXPath(XmlDocument doc, string xpath)
{
    string[] partsOfXPath = xpath.Split('/');
    XmlNode node = null;
    for (int xpathPos = partsOfXPath.Length; xpathPos > 0; xpathPos--)
    {
        string subXpath = string.Join("/", partsOfXPath, 0, xpathPos);
        node = doc.SelectSingleNode(subXpath);
        if (node != null)
        {
            // append new descendants
            for (int newXpathPos = xpathPos; newXpathPos < partsOfXPath.Length; newXpathPos++)
            {
                node = node.AppendChild(doc.CreateElement(partsOfXPath[newXpathPos]));
            }
            break;
        }
    }

    return node;
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-01-16T15:00:05.220

这是基于[Mark Miller 代码的增强正则表达式](https://stackoverflow.com/a/6608660/241211)

```
/([\w]+)(?:(?:[\[])(@|)([\w]+)(?:([!=<>]+)(?:(?:(?:')([^']+)(?:'))|([^']+))|)(?:[]])|)|([.]+))

Group 1: Node name
Group 2: @ (or Empty, for non attributes)
Group 3: Attribute Key
Group 4: Attribute Value (if string)
Group 5: Attribute Value (if number)
Group 6: .. (dots, one or more) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-07-07T09:47:14.360

我知道这是一个非常古老的线程......但我一直在尝试同样的事情并想出了以下不完美但我发现更通用的正则表达式

```
/+([\w]+)(\[@([\w]+)='([^']*)'\])?|/@([\w]+) 
```

字符串 /configuration/appSettings/add[@key='name']/@value

应该解析为

找到 14 个匹配项：

start=0, end=14 Group(0) = /configuration Group(1) = configuration Group(2) = null Group(3) = null Group(4) = null Group(5) = null

start=14, end=26 Group(0) = /appSettings Group(1) = appSettings Group(2) = null Group(3) = null Group(4) = null Group(5) = null

start=26, end=43 Group(0) = /add[@key='name'] Group(1) = add Group(2) = [@key='name'] Group(3) = key Group(4 ) = 名称组 (5) = null

开始=43，结束=50 Group(0) = /@value Group(1) = null Group(2) = null Group(3) = null Group(4) = null Group(5) = value

* * *

这意味着我们有

Group(0) = 忽略 Group(1) = 元素名称 Group(2) = 忽略 Group(3) = 过滤属性名称 Group(4) = 过滤属性值

这是一个可以使用该模式的java方法

```
public static Node createNodeFromXPath(Document doc, String expression) throws XPathExpressionException {
StringBuilder currentPath = new StringBuilder();
Matcher matcher = xpathParserPattern.matcher(expression);

Node currentNode = doc.getFirstChild();

while (matcher.find()) {
    String currentXPath = matcher.group(0);
    String elementName = matcher.group(1);
    String filterName = matcher.group(3);
    String filterValue = matcher.group(4);
    String attributeName = matcher.group(5);

    StringBuilder builder = currentPath.append(currentXPath);
    String relativePath = builder.toString();
    Node newNode = selectSingleNode(doc, relativePath);

    if (newNode == null) {
        if (attributeName != null) {
            ((Element) currentNode).setAttribute(attributeName, "");
            newNode = selectSingleNode(doc, relativePath);

        } else if (elementName != null) {
            Element element = doc.createElement(elementName);
            if (filterName != null) {
                element.setAttribute(filterName, filterValue);
            }
            currentNode.appendChild(element);
            newNode = element;

        } else {
            throw new UnsupportedOperationException("The given xPath is not supported " + relativePath);
        }
    }

    currentNode = newNode;
}

if (selectSingleNode(doc, expression) == null) {
    throw new IllegalArgumentException("The given xPath cannot be created " + expression);
}

return currentNode; 
```

}

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2010-08-18T18:55:49.197

我喜欢 Chris 的版​​本，因为它处理了 xpaths 中的属性，而其他解决方案没有（尽管它没有很好地处理我修复的路径中的“text()”）。不幸的是，我不得不在 VB 应用程序中使用它，所以这里是它的转换：

```
 Private Sub SplitOnce(ByVal value As String, ByVal separator As String, ByRef part1 As String, ByRef part2 As String)
        If (value IsNot Nothing) Then
            Dim idx As Integer = value.IndexOf(separator)
            If (idx >= 0) Then
                part1 = value.Substring(0, idx)
                part2 = value.Substring(idx + separator.Length)
            Else
                part1 = value
                part2 = Nothing
            End If
        Else
            part1 = ""
            part2 = Nothing
        End If
    End Sub
    Private Function createXPath(ByVal doc As XmlDocument, ByVal xpath As String) As XmlNode
        Dim node As XmlNode = doc
        Dim part As String
        For Each part In xpath.Substring(1).Split("/")
            Dim nodes As XmlNodeList = node.SelectNodes(part)
            If (nodes.Count > 1) Then
                Throw New Exception("Xpath '" + xpath + "' was not found multiple times!")
            ElseIf (nodes.Count = 1) Then
                node = nodes(0)
                Continue For
            End If

            If (part.EndsWith("text()")) Then
                ' treat this the same as previous node since this is really innertext
                Exit For
            ElseIf (part.StartsWith("@")) Then
                Dim anode As XmlAttribute = doc.CreateAttribute(part.Substring(1))
                node.Attributes.Append(anode)
                node = anode
            Else
                Dim elName As String = Nothing
                Dim attrib As String = Nothing
                If (part.Contains("[")) Then
                    SplitOnce(part, "[", elName, attrib)
                    If (Not attrib.EndsWith("]")) Then
                        Throw New Exception("Unsupported XPath (missing ]): " + part)
                    End If
                    attrib = attrib.Substring(0, attrib.Length - 1)
                Else
                    elName = part
                End If
                Dim nextnode As XmlNode = doc.CreateElement(elName)
                node.AppendChild(nextnode)
                node = nextnode
                If (attrib IsNot Nothing) Then
                    If (Not attrib.StartsWith("@")) Then
                        Throw New Exception("Unsupported XPath attrib (missing @): " + part)
                    End If
                    Dim name As String = ""
                    Dim value As String = ""
                    SplitOnce(attrib.Substring(1), "='", name, value)
                    If (String.IsNullOrEmpty(value) Or Not value.EndsWith("'")) Then
                        Throw New Exception("Unsupported XPath attrib: " + part)
                    End If
                    value = value.Substring(0, value.Length - 1)
                    Dim anode As XmlAttribute = doc.CreateAttribute(name)
                    anode.Value = value
                    node.Attributes.Append(anode)
                End If
            End If
        Next
        Return node
    End Function 
```

# c# - 检测 C# 应用程序中的死锁

> ID：508398
> 
> 赞同：24
> 
> 时间：2009-02-03T18:47:57.637
> 
> 标签：c#, multithreading, deadlock

> **可能重复：**
> [用于查找竞争条件/死锁的 C#/.NET 分析工具](https://stackoverflow.com/questions/2379610/c-net-analysis-tool-to-find-race-conditions-deadlocks)

我正在调试一个我怀疑陷入僵局和挂起的应用程序。但是，这种情况每隔几天才会发生一次，而且它从未在我的计算机上发生过，因此我无法将调试器连接到它。是否有任何实用程序或方法可以用来查询正在运行的应用程序并找出哪些方法/锁/无论它是什么死锁？

**更新：**通常应用程序在客户位置运行，我无权访问机器，我不太愿意让他们安装大量软件。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-03T19:11:05.543

您可以使用[WinDbg](http://www.microsoft.com/whdc/devtools/debugging/installx86.Mspx)检查应用程序中的线程。这是您可以做什么的简要计划。

*   当应用程序挂起时，将 WinDbg 文件复制到计算机。
*   将 WinDbg 附加到进程或使用 ADPlus 获取进程的挂起转储。如果您选择 ADPlus，那么您将在 WinDbg 中加载转储。
*   从 WinDbg 加载 sos.dll，以便检查托管代码。
*   该`!threads`命令将向您显示应用程序中的所有线程，该`!clrstack`命令将向您显示它们在做什么。用于`~e!clrstack`转储所有线程的调用堆栈。寻找对 Wait 方法的调用，因为它们指示锁定。
*   该`!syncblk`命令将为您提供有关哪些线程持有不同锁的信息。
*   要找出给定线程试图获取的锁，请切换到该线程并检查堆栈对象 ( `!dso`)。从这里你应该能够找到线程试图获取的锁。

澄清：WinDbg 不需要定期安装。只需复制文件。此外，如果您使用挂起转储，如果需要，您可以在另一台机器上继续调试。

补充：[Sosex](http://www.stevestechspot.com/)有`!dlk`在很多情况下自动识别死锁的命令。它并不总是有效，但是当它有效时，它会为您完成所有工作，因此这应该是您的首选。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-03T19:25:11.507

除了使用常规的`lock`&`Monitor.Enter`方法来锁定某些数据，您还可以使用“TimedLock”结构。如果无法及时获取锁，此 TimedLock 会引发异常，如果您有一些未释放的锁，它也会给您一个警告。

[Ian Griffiths 的这篇](http://www.interact-sw.co.uk/iangblog/2004/04/26/yetmoretimedlocking)文章可能会有所帮助。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-03-08T19:10:30.167

并发编程中的超时是一个可怕的想法。这会导致不确定性，从而导致无法复制的行为。尝试使用像[CHESS](http://msdn.microsoft.com/en-us/devlabs/cc950526.aspx)这样的死锁检测工具。更好的是，尽量减少与无锁算法一起使用的锁的数量，或者完全避免使用锁并将您的程序划分为单线程隔间，并使用队列在隔间之间传递数据（更好地称为消息传递/参与者并发）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T18:53:38.967

[http://blogs.technet.com/askperf/archive/2007/06/15/capturing-application-crash-dumps.aspx](http://blogs.technet.com/askperf/archive/2007/06/15/capturing-application-crash-dumps.aspx)的结尾说，至少在 Vista 上，您可以使用 Task 获得正在运行的进程的崩溃转储经理。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T19:08:35.423

你实际上有一个非常有趣的问题。您可以做几件事：

使用好的记录器：重现多线程错误的方法之一是使用记录器来打印所采取的操作和执行它们的线程，这样您就可以找到引导您找到错误的跟踪。如果您可以添加记录器，这是一个相当简单的解决方案。

使用 FSP：使用 FSP 定义您的多线程系统。这样，您将能够创建过程的有限状态机，您可以通过它来查找错误。这个解决方案是一个更数学的解决方案。

我给你的两个解决方案/程序正是一些英国大学和美国大学之间接近多线程开发的主要区别。在英国，教授们更乐于在编程之前尝试使用 FSP 证明他们的系统没有错误，而美国人更喜欢通过测试来证明他们工作正常，这是一个品味问题。

我真的推荐阅读这本书：Jeff Magee 和 Jeff Kramer：并发：状态模型和 Java 程序，Wiley，1999

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T19:01:39.650

这是一个非常有趣和痛苦的问题，因为它每隔几天才会发生一次。我[在 CodeProject 上找到了这篇文章](http://www.codeproject.com/KB/dotnet/Deadlock_Detection.aspx)。这对你来说可能是一个开始。

一种老式的方法是记录大量消息并使用日志文件来尝试检测它何时发生。:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T21:42:29.983

除了这里的答案之外，通常对线程编程有用的另一件事是确保您的开发箱是多处理器机器，特别是死锁（通常）更可靠地重现。

# assemblies - StructureMap 和扫描程序集

> ID：508399
> 
> 赞同：8
> 
> 时间：2009-02-03T18:48:18.337
> 
> 标签：assemblies, registry, structuremap

所以，我有一个使用 StructureMap 的 .NET 解决方案，我想让 StructureMap 读取一个外部程序集，该程序集从该解决方案中的项目实现接口并为其定义注册表项。

我的解决方案的 StructreMap 配置：

```
ObjectFactory.Initialize(registry =>
{
  registry.Scan(assembly =>
   {
     assembly.TheCallingAssembly();

     //Telling StructureMap to sweep a folder called "extensions" directly
     //underneath the application root folder for any assemblies found in that folder
     assembly.AssembliesFromPath("extensions", addedAssembly => addedAssembly.GetName().Name.ToLower().Contains("extension"));

     //Direct StructureMap to add any Registries that it finds in these assemblies, assuming that all the StructureMap directives are
     //contained in registry classes
     assembly.LookForRegistries();
   });
}); 
```

非常简单，我告诉它将调用程序集和从目录中的程序集添加到程序集集合中。我已经调试了程序集变量，它确实找到了所有程序集（包括扩展目录中的程序集）。

在我与原始解决方案分开创建的 DLL 项目中，我有一个接口的实现（我从原始解决方案中引用了接口项目），并编写了一个非常简单的注册表：

```
public class ProductMockRegistry : Registry
{
    public ProductMockRegistry()
    {
        ForRequestedType<IProductRepository>().AddInstances(repository =>
        {
            repository.OfConcreteType<ProductMockRepository>();
        });
    }
} 
```

我遇到的问题是，StructureMap 在外部 DLL 中找不到注册表。它发现 DLL 很好，但是当我告诉 LookForRegistries 时，它没有找到它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-02T19:02:58.390

[IoC、Dll 引用和程序集扫描](https://stackoverflow.com/questions/809051/ioc-dll-references-and-assembly-scanning/816376#816376)

# regex - 如何在不使用 Perl 中的正则表达式的情况下找到文件中的特定行？

> ID：508413
> 
> 赞同：2
> 
> 时间：2009-02-03T18:52:02.680
> 
> 标签：regex, perl, parsing

我有一个要使用[File::Slurp](http://search.cpan.org/dist/File-Slurp)模块读取的文件，然后在该文件中搜索特定行。我知道 Perl 有正则表达式，但我正在搜索的字符串是用户生成的，所以不必担心转义所有内容。我可以编写一个 foreach 循环来执行此操作，但想知道 Perl 中是否有一个函数可以为我执行此操作？我在网上看到的关于在 Perl 中查找文本的所有内容都使用正则表达式。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-03T18:56:32.593

您可以只使用正则表达式。您不必担心转义所有内容，Perl 有[quotemeta](http://perldoc.perl.org/functions/quotemeta.html)函数（或者，“\Q\E”）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T21:12:54.677

像这样？

```
use List::Util qw<first>;

my $line 
    = first { index( $_, $something_users_are_looking_for ) > -1 } 
      <$file>
    ; 
```

如果你想要他们全部。

```
my @lines
    = grep { index( $_, $something_users_are_looking_for ) > -1 } 
      <$file>
    ; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T19:16:08.607

你可以使用 q() 来使用字符串文字吗？

```
print(q(This string can contain regex: (\n\t*\n)(\n))); 
```

# sql-server - 如何在 SSAS 中正确汇总此计算的度量？

> ID：508414
> 
> 赞同：2
> 
> 时间：2009-02-03T18:52:04.023
> 
> 标签：sql-server, ssas

我在 Analysis Services 中有一个计算度量，它根据过去三个时期返回一个位置的平均每日收入。期间是位置定义的时间长度，因此一个位置可能会每月关闭其期间，而另一个位置可能会每季度关闭其期间。

要返回平均每日收入，我有一个 factPeriods 表，它返回一个时期的收入，以及该时期的天数。以下 MDX 在位置级别返回正确的值，([Measures].[Days In AR Charges]) / ([Measures].[Days In AR Days])。

问题是当我汇总到更高级别时，比如说我想按州返回平均每日收入，计算不正确，因为它首先汇总了对这些时期有贡献的天数，然后除以。我希望首先在最低级别进行平均，然后将每日平均收入的结果相加。这是发生的事情与我想要发生的事情的示例。

假设我只有两个地点，A 和 B。A 每月关闭，B 每季度关闭。最后关闭的结果是：

位置/收入/贡献收入的天数

地点 A / $3000 / 30 天地点 B / $1800 / 90 天

地点 A 每天产生 100 美元的收入，地点 B 每天只产生 20 美元的收入。我的总金额应该是每天 120 美元。相反，它将返回 40 美元/天。以下是计算级别发生的情况。

我希望公式采用伪代码 SUM(([Measures].[Days In AR Charges]) / ([Measures].[Days In AR Days]))

但它实际上给了我 (SUM([Measures].[Days In AR Charges])) / (SUM([Measures].[Days In AR Days]))

任何人都可以帮我确定适当的公式以使这项工作按需要进行吗？它最终应该是 100 美元/天 + 20 美元/天，而不是 4800 美元/120 天。我怀疑我可能需要使用后代，但我不清楚我将如何使用它们，或者这是否是正确的方向。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T05:34:55.707

强制计算在叶级别发生然后汇总的最简单方法是将其移动到 CALCULATE 之前；MDX 脚本中的语句。

通常你应该离开计算；应该是脚本中的第一条语句，但我认为您描述的情况是在 CALCULATE 之前有一个计算成员是合理的例外情况之一；

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-17T13:18:57.750

使用自定义成员公式

[http://msdn.microsoft.com/en-us/library/ms174474%28SQL.90%29.aspx](http://msdn.microsoft.com/en-us/library/ms174474%28SQL.90%29.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T11:34:38.050

如果您可以在 ETL 或处理中获得所需的数字，请不要使用 SSAS 计算，因为它会执行得更好。

在这种情况下，我将添加一个 DSV 计算来进行除法，然后允许 SSAS 正常求和。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T21:18:28.033

我的直接解决方案是计算 ETL 过程中的平均每日收入，然后 SSAS 将仅对值求和。如果有人知道的话，我仍然希望看到 MDX 解决问题的方法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-04T00:52:31.517

这只是在您的计算中指定正确的“求解顺序”的问题。我无法为您提供特定的 MDX 来解决您的问题，因为我不知道您的多维数据集结构是什么，但请查看文档或通过 Google 中的“解决顺序”。这正是“解决订单”应该解决的问题。您将基本上告诉 Analysis Services 首先要做什么。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2012-04-01T18:58:57.473

减少一个方程 3 个单独的方程？计算一个的分子，另一个的分母，然后第三个的除法？我不知道您在谈论的工具，所以我不知道您是否可以按顺序进行多次计算。但这肯定会强制为您订购。

# java - 有没有一种简单的方法可以将我的 XML 对象转换回 java 中的字符串？

> ID：508428
> 
> 赞同：8
> 
> 时间：2009-02-03T18:54:59.510
> 
> 标签：java, xml

我有一个需要转换为字符串的 xml 文档对象。

有没有这么简单的方法来做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T19:01:26.827

这是我从附近的图书馆中提取的一些快速代码。可能想打扮它，但它有效：

```
import java.io.*;
import javax.xml.transform.*;
import javax.xml.transform.dom.*;
import javax.xml.transform.stream.*;

public String TransformDocumentToString(Document doc)
{
    DOMSource dom = new DOMSource(doc);
    StringWriter writer = new StringWriter();  
    StreamResult result = new StreamResult(writer);

    TransformerFactory factory = TransformerFactory.newInstance();
    Transformer transformer = factory.newTransformer();
    transformer.transform(dom, result);

    return writer.toString();
} 
```

编辑：正如评论员之前注意到的，我有一个语法错误。不得不拔出一些敏感的线，这样我就不会被罐头并以错误的顺序放回去。谢谢！;-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T19:00:58.280

您可以使用 Dom4J：

```
OutputFormat format = OutputFormat.createPrettyPrint();
XMLWriter writer = new XMLWriter( System.out, format );
writer.write( document ); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T19:47:56.483

我把它放在评论中，但后来认为如果我真的将它添加为答案，以供将来参考，人们可能会发现它更容易。所以... Joshua.ewer 的回答是正确的，但需要 xalan-2.7.0.jar。

# asp.net - 回调和 asp.net gridview

> ID：508430
> 
> 赞同：0
> 
> 时间：2009-02-03T18:55:17.153
> 
> 标签：asp.net, gridview, callback

我有以下情况。我有一个gridview，我需要向它动态添加行。一切正常，花花公子。然而，最近，我对让这个过程更快、更有用感到好奇。我在 asp.net 2.0 中发现了一个回调功能。

对于使用 gridview 来显示某些内容的情况，这似乎是有意义的。但是，以编程方式添加一行需要向 DataTable 添加一行（即绑定到的 gridview）。由于 DataTable 驻留在服务器上，据我了解，在这里使用 Callback 没有意义......

[这](http://csharpfeeds.com/post/4287/Asynchronous_GridView_in_5_simple_steps.aspx)是一个很好的教程，概述了主要内容。

在第 5 步中：

“要完成异步加载，我们必须实现由我们在步骤 3 中实现的 ICallbackEventHandler 接口定义的两种方法。其中一种方法将 DataTable 绑定到 GridView 并呈现控件。”

据我所知，没有办法在没有回发的情况下向gridview动态添加行......有什么想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-11-29T18:23:25.417

这是正确的——你不能在没有回发的情况下动态地将行添加到 GridView。您可以在客户端向 html 添加行，但在下一次回发后将无法识别它们。

我通常只使用 jQuery 在客户端使用纯 HTML 表来完成您所描述的操作，并在适当的地方进行 jQuery ajax 调用。

# c++ - 将 Linux 上的静态英特尔 IPP 库与 g++ 链接时出现问题

> ID：508441
> 
> 赞同：2
> 
> 时间：2009-02-03T18:59:48.983
> 
> 标签：c++, linux, linker, g++, intel-ipp

我一直在尝试将项目从 Xcode 转移到 Linux（目前是 Ubuntu x86，但希望静态链接的可执行文件将在 x86 CentOS 机器上运行？我希望我希望？）。我已经编译了整个项目，但它在链接阶段失败了——它为 IPP 定义的所有函数提供了未定义的引用。这可能是一件非常小而愚蠢的事情，但我已经为此绞尽脑汁好几天了，但我无法让它发挥作用。

这是编译语句（我也有一个生成相同错误的生成文件）：

> g++ -static /opt/intel/ipp/6.0.1.071/ia32/lib/libippiemerged.a /opt/intel/ipp/6.0.1.071/ia32/lib/libippimerged.a /opt/intel/ipp/6.0.1.071/ ia32/lib/libippsemerged.a /opt/intel/ipp/6.0.1.071/ia32/lib/libippsmerged.a /opt/intel/ipp/6.0.1.071/ia32/lib/libippcore.a -pthread -I /opt/ intel/ipp/6.0.1.071/ia32/include -I 工具/include -o main main.cpp pick_peak.cpp get_starting_segments.cpp get_segment_timing_differences.cpp recast_and_normalize_wave_file.cpp pitch_score.cpp pitch_score.cpp pitch_curve.cpp tools/source/LocalBuffer.cpp工具/来源/wave.cpp distance.cpp

...这是一长串链接器错误的开头：

```
./main.o: In function `main':
main.cpp:(.text+0x13f): undefined reference to `ippsMalloc_16s'
main.cpp:(.text+0x166): undefined reference to `ippsMalloc_32f'
main.cpp:(.text+0x213): undefined reference to `ippsMalloc_16s' 
```

有任何想法吗？FWIW，这些是我的 Xcode 项目中的 IPP 依赖项，它们可以毫无问题地构建、链接和运行：“-lippiemerged”、“-lippimerged”、“-lippsemerged”、“-lippsmerged”、“-lippcore”、

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T19:17:57.637

我在将代码与 ipp 的 v 6 链接时遇到问题；使用编译器的 v11 版本（包括对 ipp 的更新）神秘地修复了它们。当然，那是在 Windows 平台上，但我得到了 8u 版本的函数来编译，没有 32f 版本，尽管这两个版本在文档中都被列为有效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-07T05:22:51.233

您的链接问题可能是由于您的链接行完全*向后：*存档库应该在命令行上*遵循源文件和目标文件，而不是在它们之前。*要了解顺序为何重要，请阅读[此](http://webpages.charter.net/ppluzhnikov/linker.html)内容。

另请注意，在 Linux 上，静态链接的可执行文件的可移植性明显低于动态链接的可执行文件。一般来说，如果您在较旧的 Linux 系统上动态链接系统库，它将适用于所有较新的系统（我使用的是古老的 RedHat 6.2，我还没有看到我的可执行文件无法在其上运行的系统）。对于完全静态的可执行文件，情况并非如此。当移动到具有与它们链接的libc不同的系统时，它们可能会以各种“有趣”的方式崩溃。

# database - 如何找到数据点最多的一小时时段？

> ID：508444
> 
> 赞同：9
> 
> 时间：2009-02-03T19:00:52.867
> 
> 标签：database, statistics

我有一个包含数十万个论坛帖子的数据库表，我想找出一个小时的时间段包含的帖子数量最多。

我可以一次向前爬行一分钟，保留一系列时间戳并跟踪其中最多的时间，但我觉得有更好的方法来做到这一点。我将在一年的帖子上运行此操作，因此检查一年中的每一分钟似乎非常糟糕。

理想情况下，有一种方法可以在单个数据库查询中执行此操作。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T19:18:43.627

给定一个包含您感兴趣的一年中每一分钟的`Minutes`表格和一个`Posts`包含一`Time`列的表格：

```
select top 1 minutes.time, count (posts.time)
from Minutes
   left join posts on posts.time >= minutes.time AND posts.time < dateadd(hour, 1, Minutes.Time)
group by minutes.time
order by count (posts.time) desc 
```

要解决生成分钟表的问题，可以使用[ufn_GenerateIntegers 之类的函数。](http://www.sql-server-helper.com/functions/integer-table.aspx) 那么函数就变成了

```
select top 5 minutes.time, count (posts.time)
from (select dateadd(minute, IntValue, '2008-01-01') as Time from ufn_GenerateIntegers(525600)) Minutes
   left join posts on posts.time >= minutes.time AND posts.time < dateadd(hour, 1, Minutes.Time)
group by minutes.time
order by count(posts.time) desc 
```

我刚刚用大约 5000 个随机帖子进行了测试，在我的机器上花了 16 秒。因此，对于偶尔的一次性查询来说，这不是微不足道的，但也不是荒谬的。幸运的是，这是一个数据点，您可以每天计算一次，甚至每月计算一次，如果您想频繁显示该值，可以将其缓存。

看看[lassevk的改进](https://stackoverflow.com/questions/508444/how-to-find-the-one-hour-period-with-the-most-datapoints/508572#508572)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T19:17:25.937

如果您想查看诸如 10:00 - 11:00 之类的时间间隔，则分档将起作用。但是，如果您在 10:30 - 11:30 之间突然产生了兴趣，那么它将被分成两个垃圾箱，因此可能会被恰好在一个时钟小时内完全适合的较少点击量隐藏。

避免这个问题的唯一方法是生成一个按时间排序的列表并逐步执行。像这样的东西：

```
max = 0; maxTime = 0
for each $item in the list:
   push $item onto queue
   while head of queue is more than an hour before $item
      drop queue head.
   if queue.count > max then max = queue.count; maxTime = $item.time 
```

这样你只需要在内存中保存一个 1 小时的窗口而不是整个列表。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T19:37:37.817

将每个帖子的时间戳视为一个小时的开始，并计算该小时内的所有其他帖子，包括开始它的帖子。根据每个小时的帖子数，按降序对生成的小时数进行排序。

完成此操作后，您会发现其中帖子最多的单个“小时”，但这段时间可能不完全是一小时，它可能更短（但永远不会更长）。

要获得“更漂亮”的时期，您可以计算它的实际长度，除以 2，然后将时期的开始向后调整该数量，并将结束向前调整，这将在一小时内“居中”帖子。此调整保证不包括任何新帖子，因此计数仍然有效。如果帖子足够接近以至于在您将其扩展到一小时后突然被包含在该时段中，那么较早的时间点将包含“最多帖子”而不是您选择的那个。

如果这是一个 SQL 问题，您可以重用 Josh 在[此处](https://stackoverflow.com/questions/508444/how-to-find-the-one-hour-period-with-the-most-datapoints/508498#508498)发布的 SQL ，只需将 Minutes 表替换为您的帖子表的另一个链接。

* * *

**您可以使用的另一种方法**是使用滑动窗口。

首先根据时间戳对所有帖子进行排序。使用列表跟踪帖子，可以使用链接列表。

现在，对于每个帖子，将其添加到列表的末尾。然后，对于列表开头的每个帖子，如果该帖子比您刚刚添加的帖子早一个多小时，请将其从列表中删除。

在对列表中的单个新帖子执行该 2 步操作后，检查列表中的帖子数量是否超过以前的最大值，如果是，则复制列表或至少存储该帖子你刚刚添加。

完成后，您将获得一小时内帖子最多的“列表副本”，或者您获得了包含最多帖子的 1 小时窗口结束的帖子。

伪代码：

```
initialize posts-window-list to empty list
for each post in sorted-posts-list:
    add post to end of posts-window-list
    for each other-post from start of posts-window-list:
        if other-post is more than one hour older than post, remove it
        otherwise, end this inner loop
    if number of posts in list is more than previous maximum:
        make copy of list, this is the new maximum 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T19:47:43.693

这适用于一个小型测试 MS-SQL 数据库。

```
SELECT TOP 1 id, date_entered,
  (SELECT COUNT(*)
   FROM   dbo.notes AS n2
   WHERE n2.date_entered >= n.date_entered 
   AND n2.date_entered < Dateadd(hh, 1, n.date_entered)) AS num
FROM  dbo.notes n
ORDER BY num DESC 
```

这不是很有效，根据每个帖子的一个小时进行检查。

```
For MYSQL 

SELECT ID,f.Date, (SELECT COUNT(*)
FROM Forum AS f2
WHERE f2.Date >= f.Date AND f2.Date < Date_ADD(f.Date, INTERVAL 1 HOUR)) As num
FROM Forum AS f
ORDER BY num
LIMIT 0,1 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T19:06:57.270

这导致 O(n) 数据库查询和 O(n) 最大时间搜索，总复杂度为 O(2n)（当然，仍然是 O(n)）：

在 SQL 中使用 count distinct 命令，它会以分钟的增量为您“装箱”项目。

因此，您将在此表上运行计数查询：

```
time
1
2      
4
3
3
2
4
1
3
2 
```

它会返回：

```
0 1
1 1
2 3
3 3
4 2 
```

通过计算每个项目。

我怀疑你可以对你的桌子做同样的事情，并按分钟将它们装箱，然后在上面运行一个算法。

```
SELECT customer_name, COUNT(DISTINCT city) as "Distinct Cities"
FROM customers
GROUP BY customer_name; 
```

从本教程计数：[http](http://www.techonthenet.com/sql/count.php) ://www.techonthenet.com/sql/count.php （接近尾声）。

这是 MySQL 手册中的一个类似页面：http: [//dev.mysql.com/doc/refman/5.1/en/counting-rows.html](http://dev.mysql.com/doc/refman/5.1/en/counting-rows.html)

因此，如果您有一个包含时间日期的表（到分钟，允许按分钟进行分箱）：

```
datetime (yyyymmddhhmm)
200901121435
200901121538
200901121435
200901121538
200901121435
200901121538
200901121538
200901121435
200901121435
200901121538
200901121435
200901121435 
```

然后是 SQL

```
SELECT datetime, COUNT(DISTINCT datetime) as "Date Time"
FROM post
GROUP BY datetime; 
```

应该返回

```
200901121435 7
200901121538 5 
```

您仍然需要对此进行后期处理，但是分组和计数的艰苦工作已经完成，并且每年只会产生超过 50 万行（60 分钟、24 小时、365 天）

后处理将是：

```
Start at time T = first post time.
Set greatestTime = T
Sum all counts between T and T+one hour --> currentHourCount and greatestHourCount
While records exist past T+one hour
   Increment T by one minute.
   While the first element is prior to time T, subtract it
   while the last element is before time T+ one hour, add it
   If currentHourCount > greatestHourCount then
      greatestHourCount = currentHourCount
      greatestTime = T
end while 
```

-亚当

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T21:22:07.900

这是其他 Josh 实现的一个细微变化，它放弃了直接表，并在自身上使用自联接来查找该帖子一小时内的任何帖子。

```
select top 1 posts.DateCreated, count (posts.datecreated),
min(minutes.DateCreated) as MinPostDate,
max(minutes.datecreated) as MaxPostDate
from posts Minutes   
left join posts on posts.datecreated >= minutes.DateCreated 
AND posts.datecreated < dateadd(hour, 1, Minutes.DateCreated)
group by posts.DateCreated
order by count(posts.datecreated) desc 
```

从只有 6 行的表的性能角度来看，他使用该函数生成中间表的方法耗时 16 秒，而这个方法是亚秒级。

我不肯定是否有可能使用它来错过有效的时间范围，因为时间跨度是基于每个帖子的偏移量。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-02T14:51:47.373

这会做到的。

SELECT DateOfEvent HourBegin, DATEADD(hh, 1, DateOfEvent)) HourEnd, COUNT(*) AS NumEventsPerHour FROM tEvents AS A JOIN tEvents AS B ON A.DateOfEvent >= B.DateOfEvents AND DATEADD(hh, 1, A.DateOfEvent) < = B.DateOfEvent 按 A.DateOfEvent 分组

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-03T19:04:40.673

```
选择 DATEPART(小时, PostDateTime) 作为 HourOfDay,
        COUNT(*) 个论坛帖子
来自帖子
按日期分组（小时，PostDateTime）

```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-03T19:08:15.863

如果是mysql：

`select substr( timestamp, 1, 16 ) as hour, count(*) as count from forum_posts group by hour order by count desc limit 1;`

编辑：不确定原始问题是否意味着任何可能的 60 分钟时间

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-03T19:14:02.357

如果使用 MySQL：

```
SELECT DATE(postDate), HOUR(postDate), COUNT(*) AS n
FROM posts
GROUP BY DATE(postDate), HOUR(postDate)
ORDER BY n DESC
LIMIT 1 
```

# c# - 通过 Tao/C# 显示 OpenGL 16 位

> ID：508448
> 
> 赞同：2
> 
> 时间：2009-02-03T19:02:51.800
> 
> 标签：c#, opengl, textures, 16-bit, tao-framework

我有一些科学图像数据来自 16 位范围内的检测器设备，然后在图像中呈现。为了显示这些数据，我使用了 OpenGL，因为它应该支持 ushorts 作为库的一部分。我已经设法将这些数据放入 OpenGL 1.4 平台上的纹理渲染中，这是该项目要求的一个限制。

不幸的是，生成的纹理看起来像是减少到 8 位，而不是 16 位。我通过生成渐变图像并显示它来测试它；虽然图像本身的每个像素都与其相邻像素不同，但显示的纹理显示条纹图案，其中所有相邻的像素都显示为相等的值。

我试过用 GlDrawPixels 来做这个，结果图像实际上看起来像是真的渲染了所有 16 位。

如何强制这些纹理正确显示？

为了提供更多背景信息，LUT（查找表）由以下代码确定：

```
 String str = "!!ARBfp1.0\n" +
            "ATTRIB tex = fragment.texcoord[0];\n" +
            "PARAM cbias = program.local[0];\n" +
            "PARAM cscale = program.local[1];\n" +
            "OUTPUT cout = result.color;\n" +

            "TEMP tmp;\n" +
            "TXP tmp, tex, texture[0], 2D;\n" +
            "SUB tmp, tmp, cbias;\n" +
            "MUL cout, tmp, cscale;\n" +
            "END";

        Gl.glEnable(Gl.GL_FRAGMENT_PROGRAM_ARB);
        Gl.glGenProgramsARB(1, out mFragProg);
        Gl.glBindProgramARB(Gl.GL_FRAGMENT_PROGRAM_ARB, mFragProg);

        System.Text.Encoding ascii = System.Text.Encoding.ASCII;
        Byte[] encodedBytes = ascii.GetBytes(str);
        Gl.glProgramStringARB(Gl.GL_FRAGMENT_PROGRAM_ARB, Gl.GL_PROGRAM_FORMAT_ASCII_ARB, 
            count, encodedBytes);

        GetGLError("Shader");
        Gl.glDisable(Gl.GL_FRAGMENT_PROGRAM_ARB); 
```

其中 cbias 和 cScale 介于 0 和 1 之间。

谢谢！

编辑：要回答其他一些问题，请使用 glTexImage 行：

```
 Gl.glBindTexture(Gl.GL_TEXTURE_2D, inTexData.TexName);

        Gl.glTexImage2D(Gl.GL_TEXTURE_2D, 0, Gl.GL_LUMINANCE, inTexData.TexWidth, inTexData.TexHeight,
            0, Gl.GL_LUMINANCE, Gl.GL_UNSIGNED_SHORT, theTexBuffer);

        Gl.glTexParameteri(Gl.GL_TEXTURE_2D, Gl.GL_TEXTURE_MIN_FILTER, Gl.GL_LINEAR);   // Linear Filtering
        Gl.glTexParameteri(Gl.GL_TEXTURE_2D, Gl.GL_TEXTURE_MAG_FILTER, Gl.GL_LINEAR);   // Linear Filtering

        theTexBuffer = null;
        GC.Collect();
        GC.WaitForPendingFinalizers(); 
```

初始化上下文时设置像素格式：

```
 Gdi.PIXELFORMATDESCRIPTOR pfd = new Gdi.PIXELFORMATDESCRIPTOR();// The pixel format descriptor
        pfd.nSize = (short)Marshal.SizeOf(pfd);                        // Size of the pixel format descriptor
        pfd.nVersion = 1;                                               // Version number (always 1)
        pfd.dwFlags = Gdi.PFD_DRAW_TO_WINDOW |                          // Format must support windowed mode
                    Gdi.PFD_SUPPORT_OPENGL |                            // Format must support OpenGL
                    Gdi.PFD_DOUBLEBUFFER;                               // Must support double buffering
        pfd.iPixelType = (byte)Gdi.PFD_TYPE_RGBA;                      // Request an RGBA format
        pfd.cColorBits = (byte)colorBits;                              // Select our color depth
        pfd.cRedBits = 0;                                               // Individual color bits ignored
        pfd.cRedShift = 0;
        pfd.cGreenBits = 0;
        pfd.cGreenShift = 0;
        pfd.cBlueBits = 0;
        pfd.cBlueShift = 0;
        pfd.cAlphaBits = 0;                                             // No alpha buffer
        pfd.cAlphaShift = 0;                                            // Alpha shift bit ignored
        pfd.cAccumBits = 0;                                     // Accumulation buffer
        pfd.cAccumRedBits = 0;                                          // Individual accumulation bits ignored
        pfd.cAccumGreenBits = 0;
        pfd.cAccumBlueBits = 0;
        pfd.cAccumAlphaBits = 0;
        pfd.cDepthBits = 16;                                     // Z-buffer (depth buffer)
        pfd.cStencilBits = 0;                                 // No stencil buffer
        pfd.cAuxBuffers = 0;                                            // No auxiliary buffer
        pfd.iLayerType = (byte)Gdi.PFD_MAIN_PLANE;                     // Main drawing layer
        pfd.bReserved = 0;                                              // Reserved
        pfd.dwLayerMask = 0;                                            // Layer masks ignored
        pfd.dwVisibleMask = 0;
        pfd.dwDamageMask = 0;

        pixelFormat = Gdi.ChoosePixelFormat(mDC, ref pfd);    // Attempt to find an appropriate pixel format

        if (!Gdi.SetPixelFormat(mDC, pixelFormat, ref pfd))
        {  // Are we not able to set the pixel format?
            BigMessageBox.ShowMessage("Can not set the chosen PixelFormat.  Chosen PixelFormat was " + pixelFormat + ".");
            Environment.Exit(-1);
        } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T22:47:36.917

如果创建纹理，则 glTexImage 的“类型”参数只是纹理数据在 OpenGL 将其转换为自己的格式之前所在的数据类型。要创建每通道 16 位的纹理，您需要 GL_LUMINANCE16 之类的格式（内部格式仍为 GL_LUMINANCE）。如果 OpenGL 1.4 没有 GL_LUMINANCE16，请检查 GL_EXT_texture 是否可用并与 GL_LUMINANCE16_EXT 一起尝试。

其中之一应该工作。但是，如果不是，您可以使用 GL_LUMINANCE_ALPHA 将您的 16 位值编码为两个 8 位对，然后在着色器中再次对其进行解码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T22:37:57.623

我从来没有在比每通道 8 位更高（更深）的深度工作过，但这是我首先要尝试的：

关闭纹理上的过滤，看看它如何影响输出。

将纹理 glHints 设置为最佳质量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-04T08:39:01.373

您可以考虑通过其中之一使用单通道浮点纹理`GL_ARB_texture_float`，`GL_ATI_texture_float`或者`GL_NV_float_buffer`如果硬件支持它的扩展，我不记得 GL 1.4 是否具有浮点纹理。

# sql - 如何实现 NOT LIKE 作为 containstable(Full-Text Query) 的搜索条件？

> ID：508449
> 
> 赞同：1
> 
> 时间：2009-02-03T19:03:40.410
> 
> 标签：sql, sql-server, full-text-search

如果我们想检索 columnName 不包含 "thisWord" 的所有键，下面查询的搜索条件是什么？

```
SELECT [key] AS someValue 
     FROM CONTAINSTABLE ( table ,columnName, ??what goes here?? ) 
```

注意：这是基于全文的搜索。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T19:08:59.073

我认为：

```
SELECT 
   [key] 
FROM tableName 
   LEFT JOIN CONTAINSTABLE ( tableName ,columnName, '' ) AS ct ON tableName.[key] = ct.[key]
WHERE tc.[key] IS NULL 
```

# containers - 翡翠代理容器

> ID：508477
> 
> 赞同：4
> 
> 时间：2009-02-03T19:10:54.767
> 
> 标签：containers, agent, agents-jade

谁能告诉我如何通过 java 代码找到可用的代理容器？我正在使用 JADE 代理框架，并且我已经弄清楚如何创建新容器但找不到现有容器（以便可以在其中部署代理）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-12-10T09:26:51.507

有两种方法可以做到这一点，具体取决于您是希望通过正在进行的服务还是通过消息中的当前快照接收信息。

要获取当前可用代理容器的 ID 快照，请向代理管理服务 (AMS) 发送请求消息并等待其回复。使用 JADE 管理本体和*QueryPlatformLocationsAction*术语，发送和接收方法将是：

```
private void queryAMS() throws CodecException, OntologyException {
    QueryPlatformLocationsAction query = new QueryPlatformLocationsAction();
    Action action = new Action(myAgent.getAID(), query);

    ACLMessage message = new ACLMessage(ACLMessage.REQUEST);
    message.addReceiver(myAgent.getAMS());
    message.setLanguage(FIPANames.ContentLanguage.FIPA_SL);
    message.setOntology(JADEManagementOntology.getInstance().getName());
    myAgent.getContentManager().fillContent(message, action);
    myAgent.send(message);
}
private void listenForAMSReply() throws UngroundedException, CodecException, 
OntologyException {
    ACLMessage receivedMessage = myAgent.blockingReceive(MessageTemplate
            .MatchSender(myAgent.getAMS()));
    ContentElement content = myAgent.getContentManager().extractContent(
        receivedMessage);

    // received message is a Result object, whose Value field is a List of
    // ContainerIDs
    Result result = (Result) content;
    List listOfPlatforms = (List) result.getValue();

    // use it
    Iterator iter = listOfPlatforms.iterator();
    while (iter.hasNext()) {
        ContainerID next = (ContainerID) iter.next();
        System.out.println(next.getID());
    }
} 
```

要将此信息作为持续服务获取，并在每个容器向 AMS 注册时接收它的 ContainerID，请创建一个扩展 AMSSubscriber 的行为。为 AdditionalContainer 事件注册一个处理程序，您将能够访问新可用容器的 ContainerID：

```
public class AMSListenerBehaviour extends AMSSubscriber {
@Override
public void installHandlers(Map handlersTable) {
    handlersTable.put(AddedContainer.NAME, addedContainerHandler);
}

public final class AddedContainerHandler implements EventHandler {
@Override
public void handle(Event ev) {
    AddedContainer event = (AddedContainer) ev;
    ContainerID addedContainer = event.getContainer();
    System.out.println(addedContainer.getID());
} 
```

希望这可以帮助，

拉斯

# redirect - 在标头中通过基本授权的 ASP 重定向

> ID：508491
> 
> 赞同：2
> 
> 时间：2009-02-03T19:16:08.920
> 
> 标签：redirect, asp-classic, authorization

如何在 ASP（.NET 之前）中进行重定向，以将 Basic Authorization 标头作为 ASP 请求进行传输。我们尝试使用以下代码。

```
response.setHeader( "Authorization", "Basic " + strAuth );
response.sendRedirect( src );
response.flushBuffer(); 
```

标头是在 .asp 的响应中设置的，但不会传递给对新页面的请求。有没有办法确保授权标头附加到结果请求？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T19:23:48.593

您是否正在重定向到同一站点中的另一个 ASP“经典”页面？如果是这样，您最好将身份验证字符串存储在 Session 变量中和/或使用 Server.Transfer。Server.Transfer 会将执行转移到另一个 ASP 脚本，然后该脚本将有权访问调用页面的 Request 对象。

还有... response.setHeader？在经典的 pre-.NET ASP 中？经典 ASP 使用 response.addheader 和 response.redirect，而不是 response.setHeader 和 response.sendRedirect。

也许您接下来正在使用 On Error Resume 并且您没有看到代码实际生成的错误。因为该代码不会运行。

# wpf - 是否有任何可用的原生 WPF 多选组合框？

> ID：508506
> 
> 赞同：13
> 
> 时间：2009-02-03T19:22:15.053
> 
> 标签：wpf, combobox, wpf-controls, multi-select

即使是第 3 方也可以。

谢谢

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-03T20:29:23.250

我不确定 a`ComboBox`将如何以这种方式显示数据，因为它被设计为单选控件。

也许您正在寻找类似 a or`ListBox`的`ListView`东西or ？`SelectionMode``Multiple``Extended`

```
<ListBox SelectionMode="Multiple" />

<ListBox SelectionMode="Extended" /> 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-03T21:35:06.173

WPF 中没有本机多选组合框。请查看我的博客，了解使用表达式混合在组合框上实现多选的简单技巧。 [http://jobijoy.blogspot.com/2009/02/simple-multiselect-combobox-using.html](http://jobijoy.blogspot.com/2009/02/simple-multiselect-combobox-using.html) 这个想法是通过编辑控件模板来利用 ListBox 的多选功能到 ComboBox 中。

但要访问选定的项目，您可能需要使用代码中的下面一行。

```
((ListBox)cmbBox.Template.FindName("lstBox",cmbBox)).SelectedItems 
```

cmbBox是您的组合框，*lstBox是控件**模板*内的 ListBox。

 ** * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-12-16T18:42:49.233

我使用了扩展器，并在扩展器的标题中填充了选择内容，并用列表框填充了内容。列表框绑定到一个集合。每当用户进行选择时，我都会更新标题以显示用户选择的内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-02-24T09:23:39.980

我从 Codeproject - [ComboBoxMultiSelect中找到了这些有用的信息](http://www.codeproject.com/Articles/45782/A-WPF-Combo-Box-with-Multiple-Selection)

我自己还没有尝试过，但会告诉我我的经验。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-03-16T17:44:54.263

虽然我还没有让它工作，但这看起来像我需要的并且类似于你正在寻找的东西：[Just Guy's Blog](http://blogs.microsoft.co.il/blogs/justguy/archive/2009/01/19/wpf-combobox-with-checkboxes-as-items-it-will-even-update-on-the-fly.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-09-10T12:27:27.253

如果它对任何人都有用，我已经制作了一个粗略且现成的多选组合框。基本上只是一个带有按钮、列表框和弹出窗口的文本块。我认为很容易建立。设置为使用选择作为列表（字符串），itemsSource 作为列表（字符串），并引发 selectionsChanges 事件。

XAML：（不包括设计尺寸的用户控件）

```
<Grid Margin="0,4,0,0">
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="1*"/>
        <ColumnDefinition Width="18"/>
    </Grid.ColumnDefinitions>
    <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>
    <Border x:Name="bdr" BorderBrush="Gray" BorderThickness="1" Grid.ColumnSpan="2"/>
    <TextBlock x:Name="txtValues" MinWidth="50" Background="#F0F0F0" Margin="1,1,0,1" Padding="3,1,0,1">
        <TextBlock.ContextMenu><ContextMenu><MenuItem Header="Clear" Click="clearItems"/></ContextMenu></TextBlock.ContextMenu>
    </TextBlock>
    <Button Grid.Column="1" Click="showListBox">
        <Polygon Points="0,2 12,2 6,8" Fill="Black"/>
    </Button>
    <Popup x:Name="pop" StaysOpen="False" Grid.ColumnSpan="2"
           PlacementTarget="{Binding ElementName=bdr}" Closed="pop_Closed">
        <ListBox x:Name="items" SelectionMode="Extended"
                 Width="{Binding ElementName=bdr,Path=ActualWidth}"/>
    </Popup>
</Grid> 
```

和代码..

```
Public Class multiCombo
Private _itemsSource As List(Of String)
Private _selections As List(Of String)
Public Event selectionsChanges(sender As Object, e As EventArgs)
Public Property selections As List(Of String)
    Get
        Return _selections
    End Get
    Set
        _selections = Value
        For Each itm In items.Items
            If Value.Contains(itm) Then
                If Not items.SelectedItems.Contains(itm) Then items.SelectedItems.Add(itm)
            Else
                If items.SelectedItems.Contains(itm) Then items.SelectedItems.Remove(itm)
            End If
        Next
        txtValues.Text = String.Empty
        For Each itm In Value
            If txtValues.Text.Length > 0 Then txtValues.Text += ", "
            txtValues.Text += itm
        Next
    End Set
End Property
Public Property itemsSource As List(Of String)
    Get
        Return _itemsSource
    End Get
    Set
        _itemsSource = Value
        items.ItemsSource = Value
    End Set
End Property
Private Sub showListBox(sender As Object, e As RoutedEventArgs)
    pop.IsOpen = True
End Sub
Private Sub pop_Closed(sender As Object, e As EventArgs)
    Dim changed = items.SelectedItems.Count <> selections.Count
    If Not changed Then
        For Each selItm In items.SelectedItems
            If Not selections.Contains(selItm) Then changed = True
        Next
    End If
    If changed Then
        selections.Clear()
        txtValues.Text = String.Empty
        For Each selItm In items.SelectedItems
            selections.Add(selItm)
            If txtValues.Text.Length > 0 Then txtValues.Text += ", "
            txtValues.Text += selItm
        Next
        RaiseEvent selectionsChanges(Me, Nothing)
    End If
End Sub
Private Sub clearItems(sender As Object, e As RoutedEventArgs)
    If selections.Count > 0 Then
        selections.Clear()
        txtValues.Text = String.Empty
        items.SelectedItems.Clear()
        RaiseEvent selectionsChanges(Me, Nothing)
    End If
End Sub
End Class 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2017-06-21T16:07:59.730

另一个 CodeProject 详细解释了如何创建具有多个可选复选框的 ComboBox： [Multi Select ComboBox in WPF](https://www.codeproject.com/Articles/563862/Multi-Select-ComboBox-in-WPF "WPF中的多选组合框")

# sql - 使用 SQL 查找不匹配的记录

> ID：508509
> 
> 赞同：16
> 
> 时间：2009-02-03T19:22:33.947
> 
> 标签：sql, select

我正在尝试编写一个查询来查找在另一个表中没有匹配记录的记录。

例如，我有两个表，其结构如下所示：

```
表格1
    状态 | 产品 | 经销商 | 其他领域
    加利福尼亚州 | P1 | 一个 | xxxx
    或 | P1 | 一个 | xxxx
    或 | P1 | 乙| xxxx
    或 | P1 | X | xxxx
    西澳 | P1 | X | xxxx
    弗吉尼亚州 | P2 | 一个 | xxxx

表2
    状态 | 产品 | 版本 | 其他领域
    加利福尼亚州 | P1 | 1.0 | xxxx
    或 | P1 | 1.5 | xxxx
    西澳 | P1 | 1.0 | xxxx
    弗吉尼亚州 | P2 | 1.2 | xxxx

```

（State/Product/Distributor 共同构成 Table1 的 key。State/Product 是 Table2 的 key）

我想找到所有未使用分发服务器 X 的状态/产品/版本组合。（因此，此示例中的结果是 CA-P1-1.0 和 VA-P2-1.2。）

对查询有什么建议吗？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-02-03T19:25:45.093

```
SELECT
    *
FROM
    Table2 T2
WHERE
    NOT EXISTS (SELECT *
        FROM
           Table1 T1
        WHERE
           T1.State = T2.State AND
           T1.Product = T2.Product AND
           T1.Distributor = 'X') 
```

这应该是 ANSI 兼容的。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-03T19:27:41.050

在 T-SQL 中：

```
SELECT DISTINCT Table2.State, Table2.Product, Table2.Version
FROM Table2 
  LEFT JOIN Table1 ON Table1.State = Table2.State AND Table1.Product = Table2.Product AND Table1.Distributor = 'X'
WHERE Table1.Distributor IS NULL 
```

不需要子查询。

编辑：正如评论所示， DISTINCT 不是必需的。谢谢！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T19:25:57.620

select * from table1 where state not in（从表1中选择状态，其中分发者='X'）

可能不是最聪明的，但应该可以。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T19:29:42.713

```
SELECT DISTINCT t2.State, t2.Product, t2.Version
FROM table2 t2
JOIN table1 t1 ON t1.State = t2.State AND t1.Product = t2.Product
                AND t1.Distributor <> 'X' 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T19:37:51.340

在甲骨文中：

```
SELECT t2.State, t2.Product, t2.Version
FROM Table2 t2, Table t1
WHERE t1.State(+) = t2.State
  AND t1.Product(+) = t2.Product
  AND t1.Distributor(+) = :distributor
  AND t1.State IS NULL 
```

# php - Zend_Form_Decorator - 如何将属性添加到 Zend_Form_Element_Hidden？

> ID：508511
> 
> 赞同：0
> 
> 时间：2009-02-03T19:23:07.987
> 
> 标签：php, zend-framework, zend-form, decorator, zend-decorators

我有两个要求：1）所有隐藏的输入元素都应该受到影响，而不需要删除标准装饰器。2）这应该发生而不必在每个元素的基础上指定它。

如果元素类型是 Zend_Form_Element_Hidden，我所需要的只是将 CSS 类附加到 DT 和 DD 标签。

我尝试过创建自定义 HtmlTag、DtDdWrapper 和 FormElement 装饰器，但无法弄清楚如何去做。

默认情况下，它们以这种方式显示：

```
<dt>&nbsp;</dt>
<dd><input type="hidden" name="whatever" value="bling" /></dd> 
```

我希望它们以这种方式出现：

```
<dt class="hidden">&nbsp;</dt>
<dd class="hidden"><input type="hidden" name="whatever" value="bling" /></dd> 
```

这样他们仍然会在他们应该在的地方，但他们不会中断文档的流动。

不起作用的示例：

```
class My_Form_Decorator_DtDdWrapper extends Zend_Form_Decorator_DtDdWrapper
{
    public function render($content)
    {
        if ($this->getElement() instanceof Zend_Form_Element_Hidden)
        {
            return '<dt class="hidden">&nbsp;</dt><dd class="hidden">'.$content.'</dd>';
        }
        else
        {
            return parent::render($content);
        }
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-06T10:43:12.120

根据您所需的示例输出，我不清楚您为什么要包含`<dt>`on hidden 元素，特别是因为您没有应用任何标签，它们最终会成为不必要的标记。假设 label*是不必要*的，您可以通过以下方式达到预期的效果：

```
class TestForm extends Zend_Form
{
    protected $_hiddenElementDecorator = array(
        'ViewHelper',
        array('HtmlTag', array('tag' => 'dd', 'class' => 'hidden')),
    );

    public function init()
    {
        $this->addElement('hidden', 'hiddenElement0');

        $element = new Zend_Form_Element_Hidden('hiddenElement1');
        $this->addElement($element);

    }

    public function loadDefaultDecorators()
    {
        foreach ($this->getElements() as $element) {
            if ($element->getType() === "Zend_Form_Element_Hidden") {
                $element->setDecorators($this->_hiddenElementDecorator);
            }
        }

        parent::loadDefaultDecorators();
    }
} 
```

上述两个元素都将产生具有各自 id 的相同输出。例子：

```
<dd class="hidden">
    <input type="hidden" name="hiddenElement0" value="" id="hiddenElement0" />
</dd> 
```

该方法中的`foreach`循环在构建表单时`loadDefaultDecorators()`迭代地应用于`$this->_hiddenElementDecorator`每个隐藏的表单元素。如果你想在多个表单上应用隐藏元素装饰器，只需创建一个包含`$_hiddenElementDecorator`变量和`loadDefaultDecorators()`方法的父类。

* * *

但是，如果您一心想要包含`<dt>`示例输出中描述的标签元素 ( ) 并应用“隐藏”类，那么您最终会得到：

```
<dt class="hidden">&nbsp;</dt>
<dd class="hidden">
    <input type="hidden" name="hiddenElement0" value="" id="hiddenElement0" />
</dd> 
```

...您将需要扩展`Zend_Form_Decorator_Label`类并覆盖 render() 方法。看看`if (null !== $tag)`块中的评论：

```
class My_Form_Decorator_Label extends Zend_Form_Decorator_Label
{
    public function render($content)
    {
        $element = $this->getElement();
        $view    = $element->getView();
        if (null === $view) {
            return $content;
        }

        $label     = $this->getLabel();
        $separator = $this->getSeparator();
        $placement = $this->getPlacement();
        $tag       = $this->getTag();
        $id        = $this->getId();
        $class     = $this->getClass();
        $options   = $this->getOptions();

        if (empty($label) && empty($tag)) {
            return $content;
        }

        if (!empty($label)) {
            $options['class'] = $class;
            $label = $view->formLabel($element->getFullyQualifiedName(), trim($label), $options);
        } else {
            $label = '&nbsp;';
        }

        if (null !== $tag) {
            require_once 'Zend/Form/Decorator/HtmlTag.php';
            $decorator = new Zend_Form_Decorator_HtmlTag();
            // Add 'class' => 'hidden' to the <dt> tag decorator options.
            $decorator->setOptions(array('tag' => $tag, 'class' => 'hidden'));
            $label = $decorator->render($label);
        }

        switch ($placement) {
            case self::APPEND:
                return $content . $separator . $label;
            case self::PREPEND:
                return $label . $separator . $content;
        }

    }
} 
```

最后，要将新装饰器应用于所有隐藏的表单元素，您需要将元素前缀路径点添加到装饰器，并将标签装饰器*重新添加*`$_hiddenElementDecorator`到类中的数组中`TestForm`：

```
class TestForm extends Zend_Form
{
    protected $_hiddenElementDecorator = array(
        'ViewHelper',
        array('HtmlTag', array('tag' => 'dd', 'class' => 'hidden')),
        // Add back the label element.
        array('Label', array('tag' => 'dt', 'class' => 'hidden')),
    );

    public function init()
    {
        $this->addElement('hidden', 'hiddenElement0');

        $element = new Zend_Form_Element_Hidden('hiddenElement1');
        $this->addElement($element);

    }

    public function loadDefaultDecorators()
    {
        foreach ($this->getElements() as $element) {
            if ($element->getType() === "Zend_Form_Element_Hidden") {
                $element->setDecorators($this->_hiddenElementDecorator);
            }
        }

        // Add a decorator prefix path pointing to our new nifty decorator.
        $this->addElementPrefixPath('My_Form_Decorator', '/path/to/Decorator', Zend_Form_Element::DECORATOR);
        parent::loadDefaultDecorators();
    }
} 
```

像馅饼一样容易，不是吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T20:23:16.803

这将对您有所帮助：您还可以指定任何其他属性。

```
$el = $form->getElement('whatever');
$el->addDecorators(
            array('ViewHelper',
            array('HtmlTag',array('tag' => 'dt','class'=>'hidden')),
            array('Label', array('tag' => 'dd ',  'class'=>'hidden')),
            )); 
```

# asp.net - 为什么这在 Firefox 中有效，但在 IE 中无效？

> ID：508529
> 
> 赞同：0
> 
> 时间：2009-02-03T19:27:46.667
> 
> 标签：asp.net, cross-browser

```
 'display the left product image
           if intImagePos = 2 then
              response.write("<td class=""ProductImage"">" & vbcrlf)
              'show image
              if Len(objProduct.Image2) > 0 then
                 response.write("<a class=""thumbnail"" href=""javascript: void(0)"" onclick=""MM_openBrWindow('images/festool/KAPEXKS120-571287/KAPEXKS120-571287-Gallery/','scrollbars=no,resizable=no,width=840,height=580')""><img src=" & objProduct.Image1 & " border=""0""><br>See gallery of this product</a>")
              else
                 response.write("<p>No Picture Available</p>")
              end if
              response.write("</td>")
           end if 
```

IE中的错误代码是：

> 行：28 字符：3 错误：参数无效。代码：0

第 28 行是：

```
 var newWindow = window.open(theURL,winName,features+win_position); 
```

感谢您为解决此问题提供的任何帮助，我根本不是程序员，也不知道我在看什么，只是复制、粘贴和操作文本以尝试让东西按我想要的方式工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T20:16:52.980

这只是一个猜测，但我记得 window.open 有问题，即 winName 变量中有一个空格。也许在它之前放一个 alert(winName) 来检查。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T20:28:18.947

您对 MM_openBrWindow() 的调用只有两个参数，但需要三个参数。尝试将其更改为：

```
MM_openBrWindow('images/festool/KAPEXKS120-571287/KAPEXKS120-571287-Gallery/','putsomenamehere','scrollbars=no,resizable=no,width=840,height=580'); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T20:16:59.953

您可能想在 Firefox 的 javascript 调试器中查看错误：

> [https://addons.mozilla.org/en-US/firefox/addon/216](https://addons.mozilla.org/en-US/firefox/addon/216)

Firefox 经常在 JavaScript 错误上静默失败。所以它可能不是一个 IE 唯一的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T20:20:53.377

该错误不在您的服务器端代码中。我会在页面呈现后寻找问题。

# c++ - 在 C++ 中将字符串转换为枚举？

> ID：508530
> 
> 赞同：1
> 
> 时间：2009-02-03T19:27:50.783
> 
> 标签：c++, enums

[C# 中的字符串到枚举](https://stackoverflow.com/questions/16100/converting-a-string-to-an-enumeration-value-in-c)，你通常如何在 C++ 中将字符串转换为枚举。您使用的任何辅助函数都是一个好主意。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T19:36:25.633

不久前我回顾了这种方法 - 可通过[Code Project](http://www.codeproject.com/KB/cpp/EnumBinder.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-04-15T10:24:33.210

```
#include <EnumString.h> 
```

来自[http://codeproject.com/Articles/42035/Enum-to-String-and-Vice-Versa-in-C](http://codeproject.com/Articles/42035/Enum-to-String-and-Vice-Versa-in-C)及之后

```
enum FORM {
    F_NONE = 0,
    F_BOX,
    F_CUBE,
    F_SPHERE,
}; 
```

插入

```
Begin_Enum_String( FORM )
{
    Enum_String( F_NONE );
    Enum_String( F_BOX );
    Enum_String( F_CUBE );
    Enum_String( F_SPHERE );
}
End_Enum_String; 
```

如果枚举中的值不重复，则工作正常。

代码中的示例

```
enum FORM f = ...
const std::string& str = EnumString< FORM >::From( f ); 
```

反之亦然

```
assert( EnumString< FORM >::To( f, str ) ); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T19:32:50.680

您可能需要使用 std::map 或 hash_map 数据结构。

# c# - 数字文本框

> ID：508533
> 
> 赞同：4
> 
> 时间：2009-02-03T19:28:13.653
> 
> 标签：c#, textbox, numeric

我是编程新手，我不太了解，但我正在制作一个计算器，我想使用一个只接受数字和小数的文本框，当用户从剪贴板粘贴文本时，文本框会删除任何文字字符，比如MS计算。

请花时间解释每个部分，以便我可以学习或编写它并告诉我要搜索的内容。

谢谢

编辑：我会更具体：

如何在 C# 中制作数字文本框？我使用了蒙面的文本框，但它不会带小数。

我已经阅读了有关重载 OnKeyPress 方法的内容，因此它可以更正任何错误的字符，但我不知道该怎么做。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-04T07:20:30.637

为您只想为数字的文本框添加一个事件处理程序，并添加以下代码：

```
private void textBoxNumbersOnly_KeyPress(object sender, KeyPressEventArgs e)
{
   if (Char.IsDigit(e.KeyChar) || e.KeyChar == '\b')
   {
      e.Handled = false;
   }
   else
   {
      e.Handled = true;
   }
} 
```

这允许数字 0 到 9，以及退格（有用的恕我直言）。允许通过'.' 如果你想支持小数，字符

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-03T19:47:38.247

如果您仔细观察，在 Windows 计算器中，数字显示在标签而不是文本框中（它不接收焦点）。窗口接收键盘事件。

因此，请查看表单上的 KeyPressed 和 KeyDown 事件。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-03T20:29:02.547

最简单的方法:)

在文本框上的 Keypress 事件

* * *

```
if ((e.KeyChar <= 57 && e.KeyChar >= 48) || e.KeyChar == 13 || e.KeyChar == 8)
{
}
else
{
     e.Handled = true;
} 
```

* * *

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T22:34:33.527

框架中有一个专门用于数字输入的控件：NumericUpDown 控件。它还管理十进制值。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-31T13:54:16.167

```
 if ("1234567890".IndexOf(e.KeyChar.ToString()) > 0)
        {
            e.Handled = false;
        }
        else
        {
            e.Handled = true;
        } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T19:36:51.937

在这里如何在 vb.net 中执行此操作

```
Private Sub TextBox1_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TextBox1.TextChanged
    Dim reg As New System.Text.RegularExpressions.Regex("[^0-9_ ]")
    TextBox1.Text = reg.Replace(TextBox1.Text, "")
End Sub 
```

只需根据您的特定需求修复正则表达式

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T19:37:53.633

研究 MaskedTextBox。

这个问题有点宽泛，无法解释一切。如果您需要细节，请尝试关注问题，因为您要求很多社区“解释每个部分”。如果你问一些具体的问题（并排除“请花时间解释......”），你会得到更好的回答。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-03T19:39:58.840

据我所知，.NET 框架（至少 2.0）中没有任何原生功能可以做到这一点。您的选择是：

1.  创建一个继承自文本框控件并且只允许数字输入的自定义控件。这具有可以重复使用控件的优点。
2.  处理 KeyPress 事件并检查 charCode 以仅允许数字击键。这更容易，但可重用性要低得多。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-03T19:40:22.630

我可能会使用正则表达式来筛选出非数字。

伪代码：

```
for (each item in the input string) {
   if (!match(some regular expression, item)) {
        toss it out
   } else {
        add item to text box or whatever you were going to do with it
   }

} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-03T20:08:27.800

您可以使用纯文本框或标签作为计算器显示，并确保值（字符串？）始终是数字。例如，您可以保留一个双精度并在您希望显示它时将其转换为字符串。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-11-04T21:47:20.850

对于十进制数字输入很有用，但如果（右键单击并粘贴）其他文本会有一些错误。:D

```
 private void textBox1_KeyPress(object sender, KeyPressEventArgs e)
    {
        string original = (sender as TextBox).Text;
        if (!char.IsDigit(e.KeyChar))
        {
            e.Handled = true;
        }
        if (e.KeyChar == '.')
        {
            if (original.Contains('.'))
                e.Handled = true;
            else if (!(original.Contains('.')))
                e.Handled = false;

        }
        else if (char.IsDigit(e.KeyChar)||e.KeyChar=='\b')
        {
            e.Handled = false;
        }

    } 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-06-06T21:06:02.060

这是我根据[mahasen](https://stackoverflow.com/a/819108/1718702)的回答制作的自定义控件。将它放在它自己的类文件中，并将名称空间修复为您想要的任何内容。重建解决方案后，它应该在您的工具箱菜单选项卡中显示为一个新控件，您可以将其拖放到`Form`.

```
using System;
using System.Linq;
using System.Windows.Forms;

namespace MyApp.GUI
{
    public class FilteredTextBox : TextBox
    {
        // Fields
        private char[] m_validCharacters;
        private string m_filter;
        private event EventHandler m_maxLength;

        // Properties
        public string Filter
        {
            get
            {
                return m_filter;
            }
            set
            {
                m_filter = value;
                m_validCharacters = value.ToCharArray();
            }
        }

        // Constructor
        public FilteredTextBox()
        {
            m_filter = "";
            this.KeyPress += Validate_Char_OnKeyPress;
            this.TextChanged += Check_Text_Length_OnTextChanged;
        }

        // Event Hooks
        public event EventHandler TextBoxFull
        {
            add { m_maxLength += value; }
            remove { m_maxLength -= value; }
        }

        // Methods
        void Validate_Char_OnKeyPress(object sender, KeyPressEventArgs e)
        {
            if (m_validCharacters.Contains(e.KeyChar) || e.KeyChar == '\b')
                e.Handled = false;
            else
                e.Handled = true;
        }
        void Check_Text_Length_OnTextChanged(object sender, EventArgs e)
        {
            if (this.TextLength == this.MaxLength)
            {
                var Handle = m_maxLength;
                if (Handle != null)
                    Handle(this, EventArgs.Empty);
            }
        }
    }
} 
```

作为奖励，我希望它在输入 3 个字符后自动切换到另一个框，因此我将框的最大长度设置为 3，并在`Form`代码中挂钩了 TextBoxFull 事件并专注于它旁边的框。这是将 4 个过滤框链接在一起以输入 IP 地址。前两个框的表单代码如下...

```
 private bool ValidateAddressChunk(string p_text)
    {
        byte AddressChunk = new byte();
        return byte.TryParse(p_text, out AddressChunk);
    }
    private void filteredTextBox1_TextBoxFull(object sender, EventArgs e)
    {
        var Filtered_Text_Box = (FilteredTextBox)sender;

        if (!ValidateAddressChunk(Filtered_Text_Box.Text))
            filteredTextBox1.Text = "255";
        else
            filteredTextBox2.Focus();
    }
    private void filteredTextBox2_TextBoxFull(object sender, EventArgs e)
    {
        var Filtered_Text_Box = (FilteredTextBox)sender;

        if (!ValidateAddressChunk(Filtered_Text_Box.Text))
            filteredTextBox2.Text = "255";
        // etc.
    } 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-02-03T20:19:24.470

作为新手，您最好投资于一个好的第三方工具包。例如，来自 Telerik 的 Radcontrols 有一个数字文本框，可以完成您正在寻找的内容。

# c# - 等待在 C# 中创建文件

> ID：508534
> 
> 赞同：3
> 
> 时间：2009-02-03T19:28:29.817
> 
> 标签：c#, file-io

是否有内置方法等待在 c# 中创建文件？等待文件被完全写入怎么样？

我已经通过在文件上反复尝试 File.OpenRead() 直到它成功（并且超时失败）来烘焙我自己的方法，但是在文件上旋转似乎不是正确的做法。我猜.NET 中有一个内置的方法可以做到这一点，但我找不到它。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-03T19:29:30.500

使用 FileSystemWatcher 组件怎么样？

此类“监视”给定的目录或文件，并且可以在发生某些事情（您可以定义什么）时引发事件。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-06-21T21:03:17.867

当你创建一个文件时，`File.Create`你可以调用`Close`函数。像这样：

```
File.Create(savePath).Close(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T19:41:21.943

[FileSystemWatcher](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)可以在文件创建、删除、更新、属性更改等时通知您。它将解决您等待创建文件的第一个问题。

至于等待写入，当一个文件被创建时，你可以分拆并开始跟踪它的大小并等待它停止更新，然后添加一个结算时间段，你也可以尝试获得一个独占锁但是如果其他进程也试图锁定它，请小心锁定文件......你可能会导致意外的事情发生。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-02T04:03:31.790

FileSysWatcher 无法监控网络路径。在这种情况下，您必须手动“抓取”目录中的文件——这可能会导致上述用户错误。

是否有替代方案，以便我们可以确保在文件完全写入磁盘并关闭之前不会打开文件？

# php - PHP 加密 openssl_pkcs7_encrypt() 失败

> ID：508538
> 
> 赞同：1
> 
> 时间：2009-02-03T19:29:07.897
> 
> 标签：php, encryption, permissions, openssl, pkcs#7

我有这个代码：

```
 $fp = fopen($unenc_path, "w");
 fwrite($fp, $msg);
 fclose($fp);

 $easy_access_emails = 'person@##.com';
 $headers =   "From: support@##.com <support@##.com>\n" . 
              "Reply-to: support@##.com\n" . 
              "Subject: " . $subject . "\n";

 $key = implode("", file("../newcert.pem"));

 $ArrayMessageProperties = explode("\n", $headers);

 $unenc_path = '..\\tmp\\'. preg_replace('/[^0-9]/','', microtime()) . rand(0,1000) . "msg.txt";
 $enc_path = '..\\tmp\\'. preg_replace('/[^0-9]/','', microtime()) . rand(0,1000) . "enc.txt";

 if (openssl_pkcs7_encrypt($unenc_path, $enc_path, $key, $ArrayMessageProperties))
 {
    $info = file_get_contents($enc_path);

    foreach ($easy_access_emails as $email)
    {
         mail($email, $subject, $info, $headers);
    }
} else {
    die("Failed Encryption");
} 
```

在我的本地开发环境（运行 LAMP 的 Macbook）上可以正常工作。我将其移至 Windows 服务器进行测试，现在`openssl_pkcs7_encrypt`每次都失败。我认为这是一个权限问题，因为该函数需要写入`$enc_path`; 但我已将 Windows 服务器上的目录尽可能地打开。（将完全控制设置为几乎每个可能与它有关的用户/组。任何人都知道调试它的好方法吗？看起来该函数在失败时只是返回 false 而没有说明原因。

经过进一步调查，该脚本似乎具有对该目录的写访问权限。它写入 $unenc_path 没问题，只是在调用`openssl_pkcs7_encrypt`.

**另一个更新：**我正在使用 filemon 来观察一些请求，我看到它打开并写入未加密的文件，但即使尝试写入加密文件也没有输出。

还添加了加载密钥的行。我已经通过回显它来验证它正在加载，它似乎很好。

**另一个更新：** 再次观看 filemon，大约在它应该调用的时间`openssq_pkcs7_encrypt`我看到一个条目，它正在 Windows tmp 目录中寻找未加密的消息。

```
w3wp.exe:4172  C:\windows\system32\tmp\04277530010012336..msg.txt 
PATH NOT FOUND  Options: Open Access: Read 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T21:48:28.707

原来 Windows /`openssl_pkcs7_encrypt`不喜欢那个相对路径，在弄乱了正斜杠和反斜杠 ( `/. \\`) 后给出了一个完整的路径来修复它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T20:07:57.223

您是否将密钥加载到`$key`代码中的某个位置？我在片段上看不到

# msbuild - 是否可以避免本地安装并为 WiX 使用平面文件？

> ID：508541
> 
> 赞同：3
> 
> 时间：2009-02-03T19:29:15.430
> 
> 标签：msbuild, automation, wix

## 背景：

我总是试图在我的项目中确保以下原则：

**重新结帐后，开发人员应该能够仅使用组合文件夹的内容来完成所有与项目相关的任务。**

显然，这并不总是可行的（例如用于 Windows 开发的 Visual Studio）。但是，我真的不喜欢安装任何特定于项目的第三方库或工具，如 log4net、NHibernate、NUnit 等。这有很多原因，包括：

*   对于给定的开发机器，您可能会处理多个不同的项目，所有这些项目都利用相同第三方库或工具的不同版本。
*   最小化环境设置要求使得设置新的开发人员或机器更加容易
*   有助于更轻松地维护自动化构建

## 假设/限制

*   我目前正在使用 WiX 3 beta，但如果有 2.0 或 3.0 的方法，请回复
*   我正在使用 Visual Studio 2005
*   IDE 语法高亮不是必需的。

## 问题：

是否可以避免本地安装 WiX 工具集而使用平面文件？如果是这样，请解释如何。

## 也可以看看：

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T21:54:08.133

**首先，构建您的 WiX 安装程序：**

*   在 Visual Studio 2005 中创建一个新的 WiX 安装程序项目。
*   相应地构建您的 WiX XML。

**现在，要将 WiX 工具包集成到您的源代码树中：**

*   复制`c:\Program Files\Windows Installer XML v3\bin`到源代码树中的子目录。我使用`WiX\bin`相对于我的 .wixproj 文件。
*   复制`c:\Program Files\MSBuild\WiX\v3.0\`到源代码树中的子目录。我使用`WiX\v3.0`相对于我的 .wixproj 文件。
*   添加以下代码或替换以下行：

`<WixTargetsPath Condition=" '$(WixTargetsPath)' == ''>$(MSBuildExtensionsPath)\Microsoft\WiX\v3.0\Wix.targets</WixTargetsPath>`

使用以下几行：

`<WixToolPath>$(MSBuildProjectDirectory)\WiX\bin\</WixToolPath> <WixTasksPath>$(MSBuildProjectDirectory)\WiX\v3.0\WixTasks.dll</WixTasksPath> <WixTargetsPath>$(MSBuildProjectDirectory)\WiX\v3.0\Wix.targets</WixTargetsPath>`

如您所见，`WixToolPath`和`WixTasksPath`指令`WixTargetsPath`反映了我指示您复制的文件夹的位置。

*   将您的 .wixproj 重命名为 .csproj。这可确保 Visual Studio 不会被 .wixproj 文件混淆，但由于 .wixproj 是有效的 MSBuild 项目，Visual Studio 将能够使用它。

使用这种方法，所描述的 WiX 目录大约有 9MB 大。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T19:44:18.893

我知道使用 WiX 2，您只需将可执行文件和 dll 下载到项目所在的任何目录即可。然后创建一个 .bat 文件以使用构建安装程序所需的参数运行烛台.exe 和 light.exe。

这样，您的所有项目都可以拥有自己的 WiX 版本，每个项目的磁盘驱动器命中率仅为 4 兆。

我不是很肯定，但我认为你可以用 WiX 3 做同样的事情。

# excel - Microsoft Excel 在保存文件时使用什么字符集？

> ID：508558
> 
> 赞同：64
> 
> 时间：2009-02-03T19:32:26.407
> 
> 标签：excel, encoding, character-encoding

我有一个 Java 应用程序，它可以读取在 Excel 中创建的 CSV 文件（例如 2007）。有谁知道 MS Excel 使用什么字符集来保存这些文件？

我会猜到：

*   windows-1255 (CP1255)
*   ISO-8859-1
*   UTF8

但我无法使用这些字符集类型中的任何一种解码扩展字符（例如法语重音字母）。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-10-01T06:03:23.820

从内存中，Excel 使用机器特定的 ANSI 编码。所以这将是 Windows-1252 用于 EN-US 安装，1251 用于俄语等。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2010-05-17T20:34:53.187

CSV 文件可以是任何格式，具体取决于从 Excel 导出期间指定的编码选项：（保存对话框、工具按钮、Web 选项项、编码选项卡）

更新：Excel（包括 Office 2013）实际上并不尊重在“另存为...”对话框中选择的 Web 选项，因此这是某种错误。我现在只是使用 OpenOffice Calc 打开我的 XLSX 文件并将它们导出为 CSV 文件（编辑过滤器设置，选择 UTF-8 编码）。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2017-02-02T15:21:40.590

唤醒这个旧线程......我们现在是 2017 年。而且 Excel 仍然无法在保留原始编码的同时将简单的电子表格保存为 CSV 格式......真是太棒了。

幸运的是，Google Docs 生活在正确的世纪。我的解决方案是使用 Google Docs 打开电子表格，而不是将其下载为 CSV。结果是一个正确编码的 CSV 文件（所有字符串都以 UTF8 编码）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-03T19:44:48.190

上周我遇到了类似的问题。我收到了许多不同编码的 CSV 文件。在导入数据库之前，我使用[chardet 库](https://github.com/chardet/chardet)自动嗅出正确的编码。

Chardet 是 Mozilla 字符检测引擎的一个端口，如果样本量足够大（一个强调字符不会做），效果会非常好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-03T19:45:16.770

`Russian Edition`提供和。`CSV`_`CSV (Macintosh)``CSV (DOS)`

以普通方式保存时`CSV`，它使用`windows-1251`.

我只是尝试将法语单词`Résumé`与俄语文本一起保存，它保存为`HEX`like `52 3F 73 75 6D 3F`，`3F`作为.`ASCII``question mark`

当我打开`CSV`文件时，这个词当然变得不可读（`R?sum?`）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-12-18T09:29:36.833

Excel 2010 会保存一个 UTF-16/UCS-2 *TSV*文件，如果您选择`File > Save As > Unicode Text (.txt)`. 它是（强制）后缀“.txt”，您可以将其更改为“.tsv”。

如果您需要 CSV，则可以在 Notepad++、Ultra Edit、Crimson Editor 等文本编辑器中转换 TSV 文件，将制表符替换为分号、逗号等。请注意，例如，对于读取数据库表，TSV 通常已经可以正常工作（并且手动读取通常更容易）。

如果您需要不同的代码页，如 UTF-8，请使用上述编辑器之一进行转换。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-10-01T05:47:56.613

cp1250 广泛用于 Microsoft Office 文档，包括 Word 和 Excel 2003。

[http://en.wikipedia.org/wiki/Windows-1250](http://en.wikipedia.org/wiki/Windows-1250)

确认这一点的一个简单方法是：

1.  在其中一个单元格中创建具有更高阶字符的电子表格，例如“Veszprém”；
2.  使用您最喜欢的脚本语言来解析和解码电子表格；
3.  查看打印出解码数据时脚本产生的内容。

示例 perl 脚本：

```
#!perl

use strict;

use Spreadsheet::ParseExcel::Simple;
use Encode qw( decode );

my $file    = "my_spreadsheet.xls";

my $xls     = Spreadsheet::ParseExcel::Simple->read( $file );
my $sheet   = [ $xls->sheets ]->[0];

while ($sheet->has_data) {

    my @data = $sheet->next_row;

    for my $datum ( @data ) {
        print decode( 'cp1250', $datum );
    }

} 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2012-06-14T22:18:02.730

虽然将包含特殊字符的 excel 文件导出到 csv 确实很麻烦，但是有一个简单的解决方法：只需将单元格复制/粘贴到谷歌文档中，然后从那里保存。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2016-06-28T14:59:52.360

您可以使用此 Visual Studio VB.Net 代码来获取编码：

```
Dim strEncryptionType As String = String.Empty
Dim myStreamRdr As System.IO.StreamReader = New System.IO.StreamReader(myFileName, True)
Dim myString As String = myStreamRdr.ReadToEnd()
strEncryptionType = myStreamRdr.CurrentEncoding.EncodingName 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2021-01-13T15:20:57.097

[您可以使用编码 UTF8 + BOM ( https://en.wikipedia.org/wiki/Byte_order_mark](https://en.wikipedia.org/wiki/Byte_order_mark) )创建 CSV 文件。

前三个字节是 BOM (0xEF,0xBB,0xBF)，然后是 UTF8 内容。

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2009-02-03T19:41:03.020

根据维基百科的说法，像 Excel 2007 中的[OOXML文件是用 UTF-8 编码的。](http://en.wikipedia.org/wiki/Office_Open_XML)我不知道 CSV 文件，但它有理由使用相同的格式......

# powershell - 如何在 Powershell 中发出经过身份验证的 Web 请求？

> ID：508565
> 
> 赞同：45
> 
> 时间：2009-02-03T19:36:17.990
> 
> 标签：powershell

在 C# 中，我可能会这样做：

```
System.Net.WebClient w = new System.Net.WebClient();
w.Credentials = new System.Net.NetworkCredential(username, auth, domain);
string webpage = w.DownloadString(url); 
```

是否有此的 Powershell 版本，或者我应该直接致电[CLR](https://stackoverflow.com/questions/340553/what-is-the-best-way-to-send-http-requests-from-windows-powershell)吗？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2009-02-03T23:10:40.943

PowerShell 几乎完全相同。

```
$webclient = new-object System.Net.WebClient
$webclient.Credentials = new-object System.Net.NetworkCredential($username, $password, $domain)
$webpage = $webclient.DownloadString($url) 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2012-09-14T08:52:26.677

对于那些需要 Powershell 来返回诸如 Http StatusCode 之类的附加信息的用户，这里有一个示例。其中包括两种最有可能传递凭据的方式。

它是这个 SO 答案的略微修改版本：
[如何在 PowerShell 中获取数字 HTTP 状态代码](https://stackoverflow.com/questions/1473358/how-to-obtain-numeric-http-status-codes-in-powershell)

```
$req = [system.Net.WebRequest]::Create($url)
# method 1 $req.UseDefaultCredentials = $true
# method 2 $req.Credentials = New-Object System.Net.NetworkCredential($username, $pwd, $domain); 
try
{
    $res = $req.GetResponse()
}
catch [System.Net.WebException]
{
    $res = $_.Exception.Response
}

$int = [int]$res.StatusCode
$status = $res.StatusCode
return "$int $status" 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-09-14T07:46:03.810

在某些情况下，如果提供正确的凭据，NTLM 身份验证仍然无法工作。

有一种机制可以使 WebClient 中的 NTLM 身份验证无效，有关更多信息，请参见此处：[System.Net.WebClient 不适用于 Windows 身份验证](https://stackoverflow.com/questions/1030177/system-net-webclient-doesnt-work-with-windows-authentication)

如果您尝试上述答案但仍然无法正常工作，请按照上面的链接添加注册表以将域列入白名单。

在此处发布此内容以节省其他人的时间；）

# unit-testing - 在这些经济时代作为一个团队开始单元测试

> ID：508570
> 
> 赞同：3
> 
> 时间：2009-02-03T19:37:02.997
> 
> 标签：unit-testing, tdd

我们有一群开发人员和一些业务分析师。作为开发人员，我们希望开始将单元测试作为我们编码实践的一部分，以便我们可以交付可维护和可扩展的代码，特别是因为我们也将成为未来支持和增强应用程序的人。但在这次经济低迷时期，我们正在努力推动开始，因为我们面临的挑战是尽快提供解决方案，而质量不是重中之重。我们可以做些什么或说些什么来表明我们将能够更快地提供更高质量的产品，并为未来的改进做准备。

基本上我们只需要克服将单元测试纳入我们日常工作的学习曲线，但我们现在不能这样做，因为它被视为一种不必要的开销，会延迟我们现在业务需要的项目。

作为开发人员，我们希望为业务提供最高价值，尤其是快速，但我们知道从现在起 6 个月后我们也需要这样做，我们也需要为此做好计划，我们相信单元测试将帮助我们大大下降。

**编辑** 所有很棒的输入，谢谢。我个人知道如何编写单元测试，但是我没有经验来判断那个单元测试是否好。我刚刚订购了[测试驱动开发：以身作则](https://rads.stackoverflow.com/amzn/click/com/0321146530)，并将主动在我们的团队中加入单元测试。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T19:40:48.527

无论是否获得许可，您都需要开始这样做。最后，它将使您更有效率并提高您的代码质量。您可以从小处着手，包括一些关键的单元，一旦您展示了好处，您就可以参与其中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T19:39:47.750

我想推荐这本书 [实用软件测试](http://www.wiley.com/WileyCDA/WileyTitle/productCd-0470127902.html)

[Pragmatic Unit Testing](http://www.pragprog.com/titles/utc2/pragmatic-unit-testing-in-c-with-nunit)这本书也是一本好书，虽然它更侧重于 C# 和 NUnit，但也有适用于语言独立的主题

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T19:51:50.283

去做就对了...

如果它是您对任何新代码的个人流程的一部分，那么您至少会涵盖这一点。您可能永远不会获得添加单元测试以覆盖所有代码的权限，但您至少可以确保未来的更改不会从给定的时间点撤消工作。

从业务端想想，为什么还要写代码来证明自己已经写的代码是正确的？为什么是错的？

获得 100% 的覆盖率会很好，但要花时间去那里，不要为当前没有错误的现有代码编写测试；在测试中断时编写测试，这样您至少不会无意中撤消某些操作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T20:35:10.227

在创建函数或类时开始对它们进行单元测试。从没有外部依赖项（数据库、文件系统）的简单类/函数开始。

在团队内部分享您的进展。计算测试的数量并**显示一个大图表**来显示您的进度（除非管理/分析师对单元测试非常敌视）。

阅读有关 TDD：“[测试驱动开发：示例](https://rads.stackoverflow.com/amzn/click/com/0321146530)”。首先编写测试会导致代码易于测试。如果您先编写生产代码，您可能很难对其进行测试。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-03T21:58:31.807

您甚至不需要与管理层讨论它（尽管您描述的情况远非理想）。这就像按合同设计 - 我在以前工作过的代码中介绍了它，只是作为开发过程的一部分。一旦它进入并且它工作，相信我，没有人敢删除它。

单元测试也可以看作是开发的*一部分*。因此，如果您有“20 天”的时间来开发功能 A、B 和 C，那么您通常可以在对开发本身的估计中包含单元测试。

进行单元测试非常容易。与多线程问题或任何类型的复杂设计相比，单元测试对于任何有能力的开发人员来说都非常容易掌握。

你可以在半天之内阅读关于它的优秀文献（你有几十个在线教程），然后在下午开始做你的第一次测试。

真的 -**去做吧！**

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T19:47:58.170

我知道这对您来说可能不容易获得，但我相信让您团队中的*测试感染者*向您展示方法是在引入测试时保持生产力的最简单方法。您的员工显然需要了解这些概念，他们可以通过阅读书籍或参加用户组来做到这一点。受测试感染的开发人员可以向您展示如何在实际的日常工作中执行此操作，同时将生产力损失降至最低。如果您的速度立即提高，我不会感到惊讶，但我不会做出任何此类声明。测试经验也带来了可测试设计的知识，我认为这是关键。

# c# - COM+ System.InvalidCastException 上的错误。

> ID：508571
> 
> 赞同：1
> 
> 时间：2009-02-03T19:37:08.113
> 
> 标签：c#, asp.net, com+

我们有一个不时发生的问题。我们有一个 Web 服务器和一个应用程序服务器。我们的应用服务器包含我们的业务逻辑代码，它作为 COM+ 服务器和库应用程序安装。然后，我们在 Web 服务器上放置一个代理，以强制从 Web 服务器到 COM+ 服务器的所有调用。几乎 100% 的时间一切都正常运行。每一次，一个蓝月亮，当然，只有在生产机器上，这个问题才会让人头疼。下面是我们通过企业库记录的事件日志条目。

它开始记录此事件日志：

```
Type : System.InvalidCastException, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
Message : Unable to cast object of type 'System.__ComObject' to type 'System.EnterpriseServices.IRemoteDispatch'.
Source : System.EnterpriseServices
Help link : 
Data : System.Collections.ListDictionaryInternal
TargetSite : System.Runtime.Remoting.Messaging.IMessage Invoke(System.Runtime.Remoting.Messaging.IMessage)
Stack Trace :    at System.EnterpriseServices.RemoteServicedComponentProxy.Invoke(IMessage reqMsg)
   at System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke(MessageData& msgData, Int32 type) 
```

然后在稍后的请求之后记录此事件日志。

```
Type : System.InvalidCastException, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
Message : Unable to cast COM object of type 'System.__ComObject' to interface type 'System.EnterpriseServices.IRemoteDispatch'. This operation failed because the QueryInterface call on the COM component for the interface with IID '{6619A740-8154-43BE-A186-0319578E02DB}' failed due to the following error: The remote procedure call failed. (Exception from HRESULT: 0x800706BE).
Source : System.EnterpriseServices
Help link : 
Data : System.Collections.ListDictionaryInternal
TargetSite : System.Runtime.Remoting.Messaging.IMessage Invoke(System.Runtime.Remoting.Messaging.IMessage)
Stack Trace :    at System.EnterpriseServices.RemoteServicedComponentProxy.Invoke(IMessage reqMsg)
   at System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke(MessageData& msgData, Int32 type) 
```

堆栈跟踪走得更远一点，但这没关系。基本上在它应该从 Web 服务器跳转到 COM+ 服务器时发生。

我们可以通过在 COM+ Server 上重新启动 COM+ Server 应用程序来解决这个问题，但这对我来说还不够好……我本质上是一个修复者。

这些错误并不完全清楚地说明正在发生的事情。谁能阐明这些错误的含义以及如何避免出现这些错误？

通常情况下，我永远不会发这样的帖子。我想我遇到的问题是正在发生的异常的模糊不清。搜索为什么会发生这种情况会产生很少的结果。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-12-22T20:09:22.590

它们之间的硬件 Web 服务器、应用程序服务器和防火墙发生了超时。防火墙的超时小于应用程序服务器的默认超时。为了解决这个问题，我们所要做的就是将以下注册表项（一开始并不存在）放在应用程序服务器的注册表中。

创建注册表项：“My Computer\HKey_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\Tcpip\Parameters\KeepAliveTime”。创建一个十六进制值为 300000 的 DWORD 条目。

这增加了应用服务器超时以匹配防火墙的超时。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T19:43:04.903

据我所知，第二条消息表明远程过程调用失败，这意味着对 QueryInterface 的调用失败。这可能是由于网络中断、COM+ 服务器出现故障（如挂起、超时）或其他问题。如果重复调用有效（不更改任何内容），那么它是某种挂起或超时；如果随后每次重复调用都失败，则 Web 服务器和 COM+ 服务器之间的网络出现故障，或者 COM+ 服务器由于某种原因停止工作。

COM+ 对象中是否存在内存泄漏或其他原因？对象是否被正确释放？是否达到句柄限制？可能值得对 COM 端和 Web 端进行剖析，以了解每个人在对象引用方面的表现都很好。

# search - 在网站上实现搜索功能的最简单方法是什么？

> ID：508586
> 
> 赞同：1
> 
> 时间：2009-02-03T19:40:27.263
> 
> 标签：search, function

该网站几乎完全是 d/x/html，并托管在 linux/apache 服务器上。

虽然我不反对使用数据库，但有人告诉我，我可以实现一个解决方案，解析 html 文档并返回我的搜索结果，而不用过多地使用 asp/php/cgi（我最肯定新手）。

这可能吗？有没有更好的办法？我应该查看特定的第三方应用程序吗？

谢谢！！！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T19:45:53.307

除了支付搜索设备费用外，您还可以向 Google 支付费用，让它抓取您的网站并显示自定义搜索结果。它很便宜，而且谷歌在索引所有内容（包括 PDF）方面做得很好。如果我没记错的话，它的广告支持版本是免费的（即您需要付费才能删除广告）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T20:41:08.797

谷歌搜索是最简单的方法。我唯一建议的是您将谷歌站点地图添加到您的站点。这样，您可以通知 google 更新或新页面，以确保搜索列表尽可能是最新的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T19:43:27.837

有“蜘蛛”会抓取您的网站并生成某种形式的搜索索引。我真的不能说这些有多可靠以及它们的表现如何。我们最近在这里购买了两台 Google 搜索设备，其中一台用于我们的内部网，另一台用于我们的外部网络。他们在准确索引您想要的内容以及设置专门的“搜索区域”甚至关键字映射方面做得非常好。

我强烈推荐他们：[http ://www.google.com/enterprise/mini/](http://www.google.com/enterprise/mini/)

*   尼古拉斯

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T21:35:32.587

如果你可以用你最喜欢的编程语言编写一些代码，你也可以看看 Apache Solr ( [url](http://lucene.apache.org/solr/) )。这个概念很简单：你得到一个单独的搜索服务器，已经实现并作为一个单独的程序。您可以通过发布（HTTP-Post）将文档放入搜索服务器。您可以通过发出 GET 请求并返回带有搜索结果的 XML 文件来进行搜索。

您必须编写的是将文件发送到搜索搜索的代码（仅几行代码）和 xml-search-results 的解析（可以使用 xslt 轻松完成）

*我不知道您在谈论多少文档，但此解决方案的扩展性非常好，我目前将它与索引中的 2.5 个 Mio 页面一起使用，并在 50 毫秒内获得结果。*

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T19:52:57.643

添加一个指向 Google 的链接，该链接仅返回您的域的结果（带有`site:`分隔符）。我不知道该怎么做，但应该不难

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T20:03:55.330

谢谢大家！我目前正在研究谷歌自定义搜索引擎。带有徽标的搜索栏很麻烦，但如果谷歌想要的只是一个带水印的搜索栏和几个广告，那么这就是我的解决方案！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T21:48:53.917

以下是我在我的博客上进行搜索的方式（使用 Google）......不记得我最初是从哪里得到这个模板的，但从评论中我猜它最初来自 javascriptkit.com。:)

```
<script type="text/javascript">

// Google Internal Site Search script- By JavaScriptKit.com(http://www.javascriptkit.com) 
// For this and over 400+ free scripts, visit JavaScript Kit-http://www.javascriptkit.com/ 
// This notice must stay intact for use

//Enter domain of site to search. 
var domainroot="ericasberry.com"

function Gsitesearch(curobj) 
{ 
    curobj.q.value="site:"+domainroot+" "+curobj.qfront.value 
}

</script>

<form action="http://www.google.com/search" method="get"
    onSubmit="Gsitesearch(this)"&gt;

<p>Search ericasberry.com:<br /> 
<input name="q" type="hidden" /> 
<input name="qfront" type="text" style="width: 180px" /> 
<input type="submit" value="Search" /></p>

</form> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-03T21:55:53.373

谷歌 Ajax 搜索 API

# ruby-on-rails - ActionMailer 最佳实践：在模型还是控制器中调用方法？

> ID：508587
> 
> 赞同：24
> 
> 时间：2009-02-03T19:40:37.187
> 
> 标签：ruby-on-rails, ruby, model-view-controller, methodology

发送电子邮件通常在对模型执行操作之后调用，但电子邮件本身是视图操作。我正在寻找您如何考虑要问自己哪些问题来确定将操作邮件方法调用放在哪里。

我见过/使用过它们：

*   在模型方法中 - 相关但单独的关注点的不良耦合？
*   在模型的回调中（例如 after_save）——就我目前的知识水平而言，最好的分离。
*   在控制器操作中 - 只是感觉不对，但是在某些情况下这将是构建代码的最聪明的方式吗？

如果我想知道如何编程，我需要像程序员一样思考，因此学习如何通过特定的编程解决方案进行思考值得我独自进行几个月的编码。谢谢！

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2012-09-24T09:35:10.590

迟到的答案，但我想对这个主题进行合理化：

通常，在 Web 应用程序中，您希望发送电子邮件作为对客户的直接反应。或者作为一项后台任务，以防我们谈论新闻通讯/通知邮件之类的事情。

该模型基本上是一个数据存储映射器。它的逻辑应该封装数据处理/通信与数据存储处理。因此，插入与它无关的逻辑有点棘手，并且在大多数情况下是错误的。让我们举个例子：用户注册一个帐户，应该会收到一封确认电子邮件。在这种情况下，可以说，确认电子邮件是创建新帐户的直接影响。现在，尝试在控制台中创建用户，而不是在 Web 应用程序中执行此操作。在这种情况下触发回调听起来是错误的，对吧？因此，回调选项被划伤。我们还应该在模型中编写方法吗？好吧，如果它是用户操作/输入的直接影响，那么它应该保留在该工作流程中。成功创建用户后，我会将其写入控制器。直接地。无论如何，在要在控制器中调用的模型中复制此逻辑会增加不必要的模块化，以及 Active Record 模型对 Action Mailer 的依赖性。尝试考虑在许多应用程序上共享模型，其中一些应用程序不希望使用 Action Mailer。出于上述原因，我认为邮件呼叫应该是有意义的，通常模型是*不是*那个地方。试着给我一些例子。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T21:42:51.573

好吧，取决于。

我已经使用了所有这些选项以及您关于“我为什么要把它放在哪里？”的观点。很好。

如果这是我希望每次以某种方式更新模型时都发生的事情，那么我将其放入模型中。甚至可能在模型中的回调中。

有时您只是在发布报告；没有任何更新。在这种情况下，我通常有一个带有发送报告的索引操作的资源。

如果邮件程序与正在更改的模型并不真正相关，我可以看到将其放入回调中。我不经常这样做。我更有可能仍将其封装在模型中。我做过，只是不经常。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-10-16T09:27:03.680

我知道已经有一段时间了，但最佳实践永远不会消失，对吧？:)

电子邮件按照定义*是*异步通信（确认电子邮件除外，但即使是这封电子邮件，在必须确认之前留出延迟应该是一种最佳实践）。

因此，在我看来，最合乎逻辑的发送方式是：

*   在后台操作中（使用[Sidekiq](http://sidekiq.org/)或[delay_job](https://github.com/collectiveidea/delayed_job)）
*   在一个回调方法中：“嘿，这个动作成功完成了，也许我们现在可以告诉世界了？”

Rails 中的问题是它没有太多的回调（例如在 JS 中）：我个人觉得有这样的代码很脏：

```
after_save :callback

def callback
  if test_that_is_true_once_in_the_objects_life
    Mailer.send_email()
  end
end 
```

所以，如果你真的*想像程序员一样思考*，那么想法是在你的应用程序中设置一些自定义回调系统。

例如。

```
def run_with_callback(action, callback_name)
  if send(action)
    delay.send(callback_name)
  end
end 
```

甚至[在您的应用程序中创建一个事件系统](https://stackoverflow.com/questions/12673330/event-trigger-system-design-in-rails)将是一个不错的解决方案。

但最终这些解决方案在时间上是相当昂贵的，所以人们最终在行动之后将其内联编写

```
def activate
  [...]
  user.save
  Mailer.send_mail
  respond_to 
  [...]
end 
```

这是同步编程中最接近回调的方式，并且结果使 Mailers 到处调用（in`Model`和 in `Controller`）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-02-20T18:50:51.557

控制器对于邮件程序来说是一个好地方有几个原因：

*   与模型无关的电子邮件。
*   如果您的电子邮件依赖于几个彼此不了解的模型。
*   将模型提取到 API 并不意味着重新实现邮件程序。
*   邮件内容由您不想传递给模型的请求变量确定。
*   如果您的业务模型需要大量不同的电子邮件，则模型回调可以叠加。
*   如果电子邮件不依赖于模型计算的结果。

# ruby - 使用 Ruby 解析文本文件时如何跳过某些列？

> ID：508588
> 
> 赞同：2
> 
> 时间：2009-02-03T19:40:40.853
> 
> 标签：ruby

我必须用 Ruby 解析一个制表符分隔的文本文件以从中提取一些数据。由于某些未知的原因，有些柱子没有被使用，只是本质上是垫片；我想忽略这些列，因为我不需要它们的输出（但是我不能忽略所有空列，因为某些合法列具有空值）。我已经知道这些列的索引（例如第 6、14、24 和 38 列）。

虽然我可以在解析文件时添加一个条件并说解析它，除非它是这些列之一，但这似乎不是很“Rubyish”——有没有更好、更优雅的方法来处理这个？正则表达式，也许？我想过做一些类似`[6, 14, 24, 38].each { |x| columns.delete_at(x) }`删除未使用的列的事情，但这将迫使我重新确定我实际需要的列的索引。我真正想做的只是循环遍历整个内容，检查当前列的索引，如果它是“坏”列之一，则忽略它。然而，有这样的代码似乎很丑陋`unless x == 6 || x == 14 || x == 24 || x == 38`

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-03T19:45:13.697

不需要像这样的大规模条件。

```
bad_cols = [6, 14, 24, 38]
columns.each_with_index do |val,idx|
  next if bad_cols.include? idx
  #process the data
end 
```

# c# - 打开文件并将内容写入 DIV、跨度、标签、某种容器

> ID：508590
> 
> 赞同：5
> 
> 时间：2009-02-03T19:40:55.500
> 
> 标签：c#, asp.net, html

我希望能够打开一个 text/html 文件并将其内容写入容器，HTML div 或 asp 标签都可以。如何在相关页面的 C# 代码文件中执行此操作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T19:58:32.250

您只想在文件中流式传输并将文本放入 Label.text 字段：

```
lable1.text= System.IO.File.ReadAllText( path ); 
```

# c# - 按下 Close, X, 按钮时不会调用 OnClosing 事件。视窗手机

> ID：508606
> 
> 赞同：4
> 
> 时间：2009-02-03T19:45:13.790
> 
> 标签：c#, windows-mobile

我是 Windows Mobile 的新手，并创建了一个需要在窗体关闭时进行一些清理的应用程序。当我单击 ControlBox 中的 Close 时，它​​不会调用 OnClosing 事件。这在常规窗口中运行良好，但不适用于我的 Windows Mobile 设备。

这是我的代码：

```
protected override void OnClosing(System.ComponentModel.CancelEventArgs e)
{
...
} 
```

我也试过这个没有运气：

```
Form.Closing += new System.ComponentModel.CancelEventHandler(WindBaseForm_Closing); 
```

我将不胜感激您能提供的任何帮助。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-03T19:49:19.070

正确的。Windows Mobile 中的 (X) 按钮称为“智能最小化”按钮，仅最小化窗体。将 Form 的[MinimizeBox](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.minimizebox.aspx)属性设置为 false，它将更改为 (OK)，这将关闭 Form（并引发事件）。

有关为什么会发生这种情况的血腥细节，[请阅读此内容](http://blogs.msdn.com/windowsmobile/archive/2006/10/05/The-Emperor-Has-No-Close.aspx)。

# c# - 凭证存储最佳实践

> ID：508608
> 
> 赞同：4
> 
> 时间：2009-02-03T19:45:21.387
> 
> 标签：c#, powershell, windows-services

我正在编写 Windows 服务，需要发出经过身份验证的 Web 请求。该服务将不会在用于发出请求的凭据的所有权下运行；这意味着我需要以某种方式存储请求的凭据。

这里有哪些最佳实践？凭据需要存储在 App.config（或模拟）中；我宁愿不让密码以纯文本形式出现。由于密码经常更改，因此无法选择构建或以其他方式将密码烘焙到二进制文件中。

同样的问题也适用于 Powershell。我需要发出经过身份验证的请求，但我不希望脚本以纯文本形式包含用于请求的凭据。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T19:53:26.303

不能把答案归功于：但这里有一篇名为“Encrypting Passwords in .NET App Config”的博客文章，其中包含完整代码。

[http://weblogs.asp.net/jgalloway/archive/2008/04/13/encrypting-passwords-in-a-net-app-config-file.aspx](http://weblogs.asp.net/jgalloway/archive/2008/04/13/encrypting-passwords-in-a-net-app-config-file.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-04T00:18:26.203

我总是参考 Keith Brown 的“The .NET Developer's Guide to Windows Security”这本书。

完整的文本在线[http://alt.pluralsight.com/wiki/default.aspx/Keith.GuideBook.HomePage](http://alt.pluralsight.com/wiki/default.aspx/Keith.GuideBook.HomePage)

您想要的特定部分（关于存储机密）位于[http://alt.pluralsight.com/wiki/default.aspx/Keith.GuideBook/HowToStoreSecretsOnAMachine.html](http://alt.pluralsight.com/wiki/default.aspx/Keith.GuideBook/HowToStoreSecretsOnAMachine.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-01-11T07:10:08.447

**选项 #1**`ProtectSection()` ：使用该方法加密 App.config for Web.config 文件中的部分。这适用于 Web 和桌面应用程序以及依赖于复制带有加密部分的 Web.config 文件的 Web 场。

### 涵盖 RSA 提供程序使用的深入 MSDN 教程：

*   [使用受保护的配置加密配置信息](https://msdn.microsoft.com/en-us/library/53tyfkaw.aspx)：

### 例子：

```
static public void ProtectSection()
{

    // Get the current configuration file.
    System.Configuration.Configuration config =
            ConfigurationManager.OpenExeConfiguration(
            ConfigurationUserLevel.None);

    // Get the section.
    UrlsSection section =
        (UrlsSection)config.GetSection("MyUrls");

    // Protect (encrypt)the section.
    section.SectionInformation.ProtectSection(
        "RsaProtectedConfigurationProvider");

    // Save the encrypted section.
    section.SectionInformation.ForceSave = true;

    config.Save(ConfigurationSaveMode.Full);

    // Display decrypted configuration 
    // section. Note, the system
    // uses the Rsa provider to decrypt
    // the section transparently.
    string sectionXml =
        section.SectionInformation.GetRawXml();

    Console.WriteLine("Decrypted section:");
    Console.WriteLine(sectionXml);

} 
```

### 使用 DPAPI 提供程序的旧方法：

*   [如何：使用 DPAPI 加密 ASP.NET 2.0 中的配置节](https://msdn.microsoft.com/en-us/library/ff647398.aspx)

### 加密：

```
aspnet_regiis -pe "connectionStrings" -app "/SampleApplication" -prov "RsaProtectedConfigurationProvider" 
```

### 解密：

```
aspnet_regiis -pd "connectionStrings" -app "/SampleApplication" 
```

*   [加密/解密命令参考](https://msdn.microsoft.com/en-us/library/zhhddkxy.aspx)

### 未加密部分：

```
<configuration>
  <connectionStrings>
    <add name="SampleSqlServer" connectionString="Data Source=localhost;Integrated Security=SSPI;Initial Catalog=Northwind;" />
   </connectionStrings>
</configuration> 
```

### 加密部分：

```
<configuration>
  <connectionStrings configProtectionProvider="RsaProtectedConfigurationProvider">
    <EncryptedData Type="http://www.w3.org/2001/04/xmlenc#Element"
      xmlns="http://www.w3.org/2001/04/xmlenc#">
      <EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#tripledes-cbc" />
      <KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#">
        <EncryptedKey xmlns="http://www.w3.org/2001/04/xmlenc#">
          <EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#rsa-1_5" />
          <KeyInfo xmlns="http://www.w3.org/2000/09/xmldsig#">
            <KeyName>RSA Key</KeyName>
          </KeyInfo>
          <CipherData>
            <CipherValue>RXO/zmmy3sR0iOJoF4ooxkFxwelVYpT0riwP2mYpR3FU+r6BPfvsqb384pohivkyNY7Dm4lPgR2bE9F7k6TblLVJFvnQu7p7d/yjnhzgHwWKMqb0M0t0Y8DOwogkDDXFxs1UxIhtknc+2a7UGtGh6Di3N572qxdfmGfQc7ZbwNE=
            </CipherValue>
          </CipherData>
        </EncryptedKey>
      </KeyInfo>
      <CipherData>
        <CipherValue>KMNKBuV9nOid8pUvdNLY5I8R7BaEGncjkwYgshW8ClKjrXSM7zeIRmAy/cTaniu8Rfk92KVkEK83+UlQd+GQ6pycO3eM8DTM5kCyLcEiJa5XUAQv4KITBNBN6fBXsWrGuEyUDWZYm6Eijl8DqRDb11i+StkBLlHPyyhbnCAsXdz5CaqVuG0obEy2xmnGQ6G3Mzr74j4ifxnyvRq7levA2sBR4lhE5M80Cd5yKEJktcPWZYM99TmyO3KYjtmRW/Ws/XO3z9z1b1KohE5Ok/YX1YV0+Uk4/yuZo0Bjk+rErG505YMfRVtxSJ4ee418ZMfp4vOaqzKrSkHPie3zIR7SuVUeYPFZbcV65BKCUlT4EtPLgi8CHu8bMBQkdWxOnQEIBeY+TerAee/SiBCrA8M/n9bpLlRJkUb+URiGLoaj+XHym//fmCclAcveKlba6vKrcbqhEjsnY2F522yaTHcc1+wXUWqif7rSIPhc0+MT1hB1SZjd8dmPgtZUyzcL51DoChy+hZ4vLzE=
        </CipherValue>
      </CipherData>
    </EncryptedData>
  </connectionStrings>
</configuration> 
```

**选项 #1a**`aspnet_regiis`您可以将此加密移动到您的应用程序中，而不是使用 执行加密。它只是检测您需要保护的部分是否已加密，如果没有，它会对其进行加密。您在开发期间需要一个选项，以避免在生产之前运行此代码。

*   [例子](http://weblogs.asp.net/jongalloway/encrypting-passwords-in-a-net-app-config-file)

**选项 #2**加密配置文件中的字符串并使用 SecureString() 临时存储解密的字符串。这可能会或可能不会让您获得太多的攻击面里程，具体取决于您使用字符串的 API 是否[支持 SecureString](https://msdn.microsoft.com/en-us/library/system.security.securestring(v=vs.110).aspx#HowSecure)。

*   [例子](http://weblogs.asp.net/jongalloway/encrypting-passwords-in-a-net-app-config-file)

# python - 为什么 Django 只提供包含空格的文件？

> ID：508609
> 
> 赞同：1
> 
> 时间：2009-02-03T19:45:25.413
> 
> 标签：python, django

我正在编写一个基本的 Django 应用程序。出于测试/开发目的，我正在尝试按照[http://docs.djangoproject.com/en/dev/howto/static-files/#howto-static-files](http://docs.djangoproject.com/en/dev/howto/static-files/#howto-static-files)使用 Django 的开发服务器来提供网站的静态内容。

我的 urls.py 包含：

```
 (r'^admin/(.*)', admin.site.root),

    (r'^(?P<page_name>\S*)$', 'Blah.content.views.index'),

    (r'^static/(?P<path>.*)$', 'django.views.static.serve',
        {'document_root': 'C:/Users/My User/workspace/Blah/media',
         'show_indexes': True}) 
```

但是，当我尝试访问诸如[http://localhost:8000/static/images/Logo.jpg 之类](http://localhost:8000/static/images/Logo.jpg)的文件时， Django 给了我一个 404 错误，声称“没有页面与给定的查询匹配”。

当我尝试访问诸如[http://localhost:8000/static/images/Blah%20Logo.jpg](http://localhost:8000/static/images/Blah%20Logo.jpg)之类的文件时，它会提供该文件！

这是怎么回事？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-03T20:50:48.353

你有错误的模式顺序`urls.py`。

当您尝试检索*没有*空格的路径时，它匹配：

```
(r'^(?P<page_name>\S*)$', 'Blah.content.views.index'), 
```

不是`static.serve`，当然你没有这样的页面，但是当你尝试*使用*空格访问路径时，它匹配正确的`static.serve`模式，因为它更通用并且允许空格。

要解决这个问题，只需交换这些模式。

# c++ - 使用 C++ 创建一个新的 Windows 注册表项

> ID：508614
> 
> 赞同：16
> 
> 时间：2009-02-03T19:47:22.447
> 
> 标签：c++, registry

我正在尝试使用 C++ 在 Windows 注册表中创建一个新的注册表项。这是我到目前为止的代码：

```
HKEY hKey;
    LPCTSTR sk = TEXT("SOFTWARE\\OtherTestSoftware");

    LONG openRes = RegCreateKeyEx(
            HKEY_LOCAL_MACHINE,
            sk,
            0,
            NULL,
            REG_OPTION_BACKUP_RESTORE,
            KEY_ALL_ACCESS,
            NULL,
            &hKey,
            NULL);

    if (openRes==ERROR_SUCCESS) {
        printf("Success creating key.");
    } else {
        printf("Error creating key.");
    }

    LPCTSTR value = TEXT("OtherTestSoftwareKey");
    LPCTSTR data = "OtherTestData\0";

    LONG setRes = RegSetValueEx (hKey, value, 0, REG_SZ, (LPBYTE)data, strlen(data)+1);

    if (setRes == ERROR_SUCCESS) {
        printf("Success writing to Registry.");
    } else {
        printf("Error writing to Registry.");
    }

    //RegDeleteKey(hKey, sk);

    LONG closeOut = RegCloseKey(hKey);

    if (closeOut == ERROR_SUCCESS) {
        printf("Success closing key.");
    } else {
        printf("Error closing key.");
    } 
```

我能够使用非常相似的代码片段成功打开现有密钥（基本上用 RegOpenKeyEx 替换 RegCreateKeyEx）。我想我传递给 RegCreateKeyEx 的一个或多个参数会导致麻烦。老实说，由于我捕获的所有错误代码都显示成功，因此我不确定在哪里可能会出现问题。作为参考，这里是 RegCreateKeyEx 的函数签名：

```
/*
 * LONG WINAPI RegCreateKeyEx(
      __in        HKEY hKey,
      __in        LPCTSTR lpSubKey,
      __reserved  DWORD Reserved,
      __in_opt    LPTSTR lpClass,
      __in        DWORD dwOptions,
      __in        REGSAM samDesired,
      __in_opt    LPSECURITY_ATTRIBUTES lpSecurityAttributes,
      __out       PHKEY phkResult,
      __out_opt   LPDWORD lpdwDisposition
    );
 */ 
```

任何想法都会很棒！

谢谢，布赖恩

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-03T20:58:10.197

多年来，我一直在编译自己的个人函数库。其中一部分完全处理注册表访问，请参阅[Registry.Cpp](https://github.com/NTDLS/NSWFL/blob/master/NSWFL_Registry.Cpp)文件中的 CreateRegistryKey 函数。

如果你有兴趣，你可以在[这里获取整个图书馆](https://github.com/NTDLS/NSWFL)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T20:56:22.073

如前所述，您`REG_OPTION_BACKUP_RESTORE`在对 的调用中指定了选项`RegCreateKeyEx`，这意味着您正在打开密钥以执行备份或恢复。通常，您会`REG_OPTION_NON_VOLATILE`改用。

你运行的是什么操作系统？在 Windows 2000/XP 中，`HKEY_LOCAL_MACHINE`非管理员用户无法写入注册表配置单元，因此`RegCreateKeyEx`将失败并出现拒绝访问错误（错误 5）。这也适用于 Vista，如果您的应用程序`requestedExecutionLevel`在其清单中有一个条目。如果您正在运行 Vista，并且您的应用程序没有指定 a `requestedExecutionLevel`（或者如果它根本没有清单），则访问`HKEY_LOCAL_MACHINE`将被虚拟化，因此`RegCreateKeyEx`应该会成功。有关详细信息，请参阅MSDN[中的 Windows Vista 中的注册表虚拟化。](http://msdn.microsoft.com/en-us/library/bb530198.aspx)

`UNICODE`您发布的代码还有一些问题，只有在您使用定义编译项目时才会变得明显。这一行：

```
LPCTSTR data = "OtherTestData\0"; 
```

应该

```
LPCTSTR data = TEXT("OtherTestData\0"); 
```

这行：

```
LONG setRes = RegSetValueEx(hKey, value, 0, REG_SZ,
    (LPBYTE)data, _tcslen(data)+1); 
```

应该：

```
LONG setRes = RegSetValueEx(hKey, value, 0, REG_SZ,
    (LPBYTE)data, (_tcslen(data)+1) * sizeof(TCHAR)); 
```

因为`cbData`参数 in`RegSetValueEx`是以字节为单位的数据长度，而不是字符。

我希望这有帮助！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T19:54:24.320

第一个线索是你使用`REG_OPTION_BACKUP_RESTORE`. 您可能不想使用该标志，因为我认为它需要您需要事先启用的特殊“备份”权限。普通应用程序不想这样做。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-05-30T12:03:03.667

可能这[就是您无法](http://support.microsoft.com/kb/257176)使用代码创建新密钥的原因。

这些链接可能会有所帮助。

[http://www.codeguru.com/forum/archive/index.php/t-378884.html](http://www.codeguru.com/forum/archive/index.php/t-378884.html)
[http://www.codeguru.com/forum/archive/index.php/t-275250.html](http://www.codeguru.com/forum/archive/index.php/t-275250.html)

作为旁注，请始终尝试 GetLastError() 以获取错误消息。

我没有测试过它们中的任何一个。

# python - python的sqlite问题中的AUTO_INCREMENT

> ID：508627
> 
> 赞同：16
> 
> 时间：2009-02-03T19:49:59.960
> 
> 标签：python, sqlite

我在 python 2.5 中使用 sqlite。我收到以下语法的 sqlite 错误。我环顾四周，在此页面[http://www.sqlite.org/syntaxdiagrams.html#column-constraint](http://www.sqlite.org/syntaxdiagrams.html#column-constraint)上看到了 AUTOINCREMENT，但这也不起作用。没有 AUTO_INCREMENT 我的表可以创建。

```
An error occurred: near "AUTO_INCREMENT": syntax error 
CREATE TABLE fileInfo
(
fileId int NOT NULL AUTO_INCREMENT,
name varchar(255),
status int NOT NULL,
PRIMARY KEY (fileId)
); 
```

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-02-03T19:56:53.173

这在[SQLite FAQ](http://www.sqlite.org/faq.html)中得到解决。 [问题 #1](http://www.sqlite.org/faq.html#q1)。

其中指出：

> 如何创建 AUTOINCREMENT 字段？
> 
> 简短回答：声明为 INTEGER PRIMARY KEY 的列将自动递增。
> 
> 这是一个长答案：如果您将表的列声明为 INTEGER PRIMARY KEY，那么每当您在表的该列中插入 NULL 时，NULL 会自动转换为比最大值大 1 的整数该列覆盖表中的所有其他行，如果表为空，则为 1。（如果可能的最大整数键为 9223372036854775807，则随机选择一个未使用的键值。）例如，假设您有一个这样的表：
> 
> `CREATE TABLE t1( a INTEGER PRIMARY` `KEY, b INTEGER );`有了这张表，语句
> 
> `INSERT INTO t1 VALUES(NULL,123);`逻辑上等同于说：
> 
> `INSERT INTO t1 VALUES((SELECT max(a) FROM t1)+1,123);`有一个名为的函数`sqlite3_last_insert_rowid()` 将返回最近插入操作的整数键。
> 
> 请注意，整数键比插入前表中的最大键大一。新键在表中当前的所有键中都是唯一的，但它可能与之前从表中删除的键重叠。要创建在表的生命周期内唯一的键，请将 AUTOINCREMENT 关键字添加到 INTEGER PRIMARY KEY 声明中。那么选择的键将比该表中曾经存在的最大键多一个。如果该表中先前存在最大可能键，则 INSERT 将失败并返回 SQLITE_FULL 错误代码。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-03T19:57:06.513

看起来 AUTO_INCREMENT 应该是 AUTOINCREMENT 见[http://www.sqlite.org/syntaxdiagrams.html#column-constraint](http://www.sqlite.org/syntaxdiagrams.html#column-constraint)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-03T20:01:05.523

你可以试试

```
创建表文件信息
(
fileid 整数主键自动增量，
名称字符串，
状态整数非空
);
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-12-01T15:56:22.877

我们刚刚更改了订单

```
NOT NULL, AUTO_INCREMENT 
```

到

```
AUTO_INCREMENT NOT NULL, 
```

# java - Java相当于unsigned long long？

> ID：508630
> 
> 赞同：115
> 
> 时间：2009-02-03T19:50:26.543
> 
> 标签：java, unsigned, primitive, unsigned-long-long-int

在 C++ 中，我喜欢访问 64 位无符号整数 via`unsigned long long int`或 via `uint64_t`。现在，我知道，在 Java 中 long 是 64 位。但是，它们已签名。

是否有可用作 Java 原语的 unsigned long (long)？我该如何使用它？

* * *

## 回答 #1

> 赞同：149
> 
> 时间：2014-08-11T17:09:34.213

从 Java 8 开始，支持 unsigned long（无符号 64 位）。您可以使用它的方式是：

```
Long l1 = Long.parseUnsignedLong("17916881237904312345"); 
```

要打印它，你不能简单地打印 l1，但你必须首先：

```
String l1Str = Long.toUnsignedString(l1) 
```

然后

```
System.out.println(l1Str); 
```

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2009-02-03T19:52:47.380

我不相信。一旦你想要比有符号长的更大，我认为[BigInteger](http://docs.oracle.com/javase/7/docs/api/java/math/BigInteger.html)是唯一的（开箱即用的）方法。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-03T19:53:19.140

不，没有。您必须使用原始`long`数据类型并处理签名问题，或者使用诸如[`BigInteger`](http://java.sun.com/javase/6/docs/api/java/math/BigInteger.html).

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-03T19:53:04.883

不，没有。Java 的设计者公开表示他们不喜欢无符号整数。请改用[BigInteger](http://java.sun.com/j2se/1.5.0/docs/api/java/math/BigInteger.html)。有关详细信息，请参阅[此问题](https://stackoverflow.com/questions/430346/why-doesnt-java-support-unsigned-ints)。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2014-11-17T20:10:27.690

[Java 8](https://docs.oracle.com/javase/8/docs/api/java/lang/Long.html)提供了一组 unsigned long 操作，允许您直接将那些 Long 变量视为 unsigned Long，以下是一些常用的：

*   String [toUnsignedString](https://docs.oracle.com/javase/8/docs/api/java/lang/Long.html#toUnsignedString-long-) (long i)
*   int [compareUnsigned](https://docs.oracle.com/javase/8/docs/api/java/lang/Long.html#compareUnsigned-long-long-) (long x, long y)
*   long [divideUnsigned](https://docs.oracle.com/javase/8/docs/api/java/lang/Long.html#divideUnsigned-long-long-)（长除数，长除数）
*   长[余数](https://docs.oracle.com/javase/8/docs/api/java/lang/Long.html#remainderUnsigned-long-long-)无符号（长除数，长除数）

加法、减法和乘法对于有符号和无符号长整数是相同的。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-03T21:30:06.637

根据您打算执行的操作，结果大致相同，有符号或无符号。但是，除非您使用微不足道的操作，否则您最终将使用 BigInteger。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-08-06T11:34:01.723

对于 unsigned long，您可以使用**[Guava 库](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/primitives/package-summary.html)**[中的UnsignedLong](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/primitives/UnsignedLong.html)类：

它支持各种操作：

*   加
*   减
*   次
*   模组
*   除以

目前似乎缺少的是字节移位运算符。如果您需要这些，您可以使用 Java 中的 BigInteger。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-03T20:06:59.380

Java 没有无符号类型。如前所述，产生 BigInteger 的开销或使用 JNI 访问本机代码。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-12-08T11:27:22.003

org.apache.axis.types 包有一个

UnsignedLong 类。

对于行家：

```
<dependency>
    <groupId>org.apache.axis</groupId>
    <artifactId>axis</artifactId>
    <version>1.4</version>
</dependency> 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-06-05T12:28:21.190

似乎在 Java 8 中，[一些方法被添加](http://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html)到 Long 以将旧的 [signed] long 视为无符号。似乎是一种解决方法，但有时可能会有所帮助。

# css - 水平导航栏的 CSS 相同大小的列表项

> ID：508635
> 
> 赞同：4
> 
> 时间：2009-02-03T19:51:09.740
> 
> 标签：css

尝试学习一点 CSS，我想要一个水平导航栏，我正在使用 ul 和 li 来构建它。我希望所有“按钮”都具有相同的宽度，仅使用 CSS 就可以吗？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T19:56:47.043

不完全确定您所说的相同宽度是什么意思。你只是在链接上用像素设置它？你的限制是什么？你知道列表宽度吗？或链接宽度？

```
<style type="text/css">
    .menu { margin:0px auto; padding:0px; list-style-type:none; }
    .menu li { margin:0px auto; padding:0px; float:left; }
    .menu li a { display:block; width:200px; }
</style>

<ul class="menu">
    <li><a href="#section1">Section1</a></li>
    <li><a href="#section1">Section1</a></li>
    <li><a href="#section1">Section1</a></li>
</ul> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T19:54:34.647

是的，

```
ul li
{
    display: block;
    float: left;
    width: 100px;
}
ul
{
    padding: 0px;
    list-style-type: none;
} 
```

像这样的东西。（未测试）；

# java - 为什么必须首先在 Java 构造函数中委托给不同的构造函数？

> ID：508639
> 
> 赞同：37
> 
> 时间：2009-02-03T19:52:06.540
> 
> 标签：java, syntax

在Java的构造函数中，如果要调用另一个构造函数（或超级构造函数），它必须是构造函数的第一行。我认为这是因为您不应该被允许在其他构造函数运行之前修改任何实例变量。但是为什么你不能在构造函数委托之前有语句，以便计算另一个函数的复数值呢？我想不出任何好的理由，而且我遇到了一些真实的案例，我编写了一些丑陋的代码来解决这个限制。

所以我只是想知道：

1.  这种限制有充分的理由吗？
2.  是否有计划在未来的 Java 版本中允许这样做？（或者 Sun 是否明确表示这不会发生？）

* * *

有关我正在谈论的内容的示例，请考虑我在[此 StackOverflow 答案](https://stackoverflow.com/questions/474535/best-way-to-represent-a-fraction-in-java/474612#474612)中给出的一些代码。在该代码中，我有一个 BigFraction 类，它有一个 BigInteger 分子和一个 BigInteger 分母。“规范”构造函数是`BigFraction(BigInteger numerator, BigInteger denominator)`表单。对于所有其他构造函数，我只是将输入参数转换为 BigIntegers，并调用“规范”构造函数，因为我不想重复所有工作。

在某些情况下，这很容易；例如，采用两个`long`s 的构造函数是微不足道的：

```
 public BigFraction(long numerator, long denominator)
  {
    this(BigInteger.valueOf(numerator), BigInteger.valueOf(denominator));
  } 
```

但在其他情况下，难度更大。考虑采用 BigDecimal 的构造函数：

```
 public BigFraction(BigDecimal d)
  {
    this(d.scale() < 0 ? d.unscaledValue().multiply(BigInteger.TEN.pow(-d.scale())) : d.unscaledValue(),
         d.scale() < 0 ? BigInteger.ONE                                             : BigInteger.TEN.pow(d.scale()));
  } 
```

我觉得这很丑陋，但它可以帮助我避免重复代码。以下是我想做的，但在 Java 中是非法的：

```
 public BigFraction(BigDecimal d)
  {
    BigInteger numerator = null;
    BigInteger denominator = null;
    if(d.scale() < 0)
    {
      numerator = d.unscaledValue().multiply(BigInteger.TEN.pow(-d.scale()));
      denominator = BigInteger.ONE;
    }
    else
    {
      numerator = d.unscaledValue();
      denominator = BigInteger.TEN.pow(d.scale());
    }
    this(numerator, denominator);
  } 
```

* * *

**更新**

有很好的答案，但到目前为止，还没有提供我完全满意的答案，但我不在乎开始赏金，所以我正在回答我自己的问题（主要是为了摆脱那个烦人的“您是否考虑过标记已接受的答案”消息）。

已建议的解决方法是：

1.  静态工厂。
    *   我在很多地方都使用过这个类，所以如果我突然摆脱公共构造函数并使用 valueOf() 函数，代码就会中断。
    *   感觉就像是一种限制的解决方法。我不会得到工厂的任何其他好处，因为它不能被子类化，并且因为公共值没有被缓存/实习。
2.  私有静态“构造函数助手”方法。
    *   这会导致大量代码膨胀。
    *   `BigInteger[]`代码变得丑陋，因为在某些情况下，我确实需要同时计算分子和分母，并且除非我返回一个或某种私有内部类，否则我无法返回多个值。

反对此功能的主要论点是编译器必须在调用超构造函数之前检查您没有使用任何实例变量或方法，因为该对象将处于无效状态。我同意，但我认为这将比确保所有最终实例变量始终在每个构造函数中初始化的检查更容易，无论采用何种代码路径。另一个论点是您根本无法事先执行代码，但这显然是错误的，因为计算超构造函数参数的代码正在*某处*执行，因此必须在字节码级别允许它。

现在，我想看到的是编译器不能让我使用这段代码的一些*很好*的理由：

```
public MyClass(String s) {
  this(Integer.parseInt(s));
}
public MyClass(int i) {
  this.i = i;
} 
```

并像这样重写它（我认为字节码基本上是相同的）：

```
public MyClass(String s) {
  int tmp = Integer.parseInt(s);
  this(tmp);
}
public MyClass(int i) {
  this.i = i;
} 
```

我在这两个示例之间看到的唯一真正区别是“ `tmp`”变量的范围允许在调用`this(tmp)`第二个示例后访问它。`static{}`所以可能需要引入一种特殊的语法（类似于类初始化的块）：

```
public MyClass(String s) {
  //"init{}" is a hypothetical syntax where there is no access to instance
  //variables/methods, and which must end with a call to another constructor
  //(using either "this(...)" or "super(...)")
  init {
    int tmp = Integer.parseInt(s);
    this(tmp);
  }
}
public MyClass(int i) {
  this.i = i;
} 
```

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-11-24T18:40:46.497

我认为这里的几个答案是错误的，因为他们假设在调用一些代码后调用 super() 时封装以某种方式被破坏。事实是 super 实际上可以破坏封装本身，因为 Java 允许在构造函数中覆盖方法。

考虑这些类：

```
class A {
  protected int i;
  public void print() { System.out.println("Hello"); }
  public A() { i = 13; print(); }
}

class B extends A {
  private String msg;
  public void print() { System.out.println(msg); }
  public B(String msg) { super(); this.msg = msg; }
} 
```

如果你这样做

```
new B("Wubba lubba dub dub"); 
```

打印出来的消息是“null”。那是因为 A 的构造函数正在访问 B 的未初始化字段。坦率地说，如果有人想这样做：

```
class C extends A {
  public C() { 
    System.out.println(i); // i not yet initialized
    super();
  }
} 
```

那么这就是他们的问题，就好像他们在上面做 B 级一样。在这两种情况下，程序员都必须知道在构造过程中如何访问变量。并且鉴于您可以调用`super()`或`this()`使用参数列表中的各种表达式，在调用另一个构造函数之前您无法计算任何表达式似乎是一种人为的限制。更不用说该限制适用于两者`super()`，并且`this()`大概您知道如何在调用时不破坏自己的封装`this()`。

我的结论：这个功能是编译器中的一个错误，可能最初是有充分理由的，但在目前的形式下，它是一个没有目的的人为限制。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-03T21:11:32.197

> 我觉得这很丑陋，但它可以帮助我避免重复代码。以下是我想做的，但在 Java 中是非法的......

您还可以通过使用返回新对象的静态工厂方法来解决此限制：

```
public static BigFraction valueOf(BigDecimal d)
{
    // computate numerator and denominator from d

    return new BigFraction(numerator, denominator);
} 
```

或者，您可以通过调用私有静态方法为您的构造函数进行计算来作弊：

```
public BigFraction(BigDecimal d)
{
    this(computeNumerator(d), computeDenominator(d));
}

private static BigInteger computeNumerator(BigDecimal d) { ... }
private static BigInteger computeDenominator(BigDecimal d) { ... } 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-03T20:01:28.627

必须按顺序调用构造函数，从根父类到最派生的类。您不能在派生构造函数中预先执行任何代码，因为在调用父构造函数之前，派生构造函数的堆栈框架甚至还没有分配，因为派生构造函数还没有开始执行。诚然，Java 的语法并没有说明这个事实。

编辑：总而言之，当派生类构造函数在 this() 调用之前“执行”时，以下几点适用。

1.  成员变量不能被触及，因为它们在基类构建之前是无效的。
2.  参数是只读的，因为堆栈帧尚未分配。
3.  无法访问局部变量，因为堆栈帧尚未分配。

如果您以相反的顺序（从派生类到基类）分配构造函数的堆栈帧，则可以访问参数和局部变量，但这将要求所有帧同时处于活动状态，从而为每个对象构造浪费内存以允许对于在构造基类之前想要触及局部变量的极少数代码情况。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-03T21:49:05.727

> “我的猜测是，在为每个层次结构调用构造函数之前，该对象处于无效状态。在完全构造之前，JVM 在其上运行任何东西都是不安全的。”

实际上，*可以*在不调用层次结构中的*每个*构造函数的情况下在 Java 中构造对象，尽管不使用`new`关键字。

例如，Java 的序列化在反序列化过程中构造对象时，会调用层次结构中第一个不可序列化类的构造函数。因此，当 java.util.HashMap 被反序列化时，首先分配一个 java.util.HashMap 实例，然后调用其第一个不可序列化超类 java.util.AbstractMap 的构造函数（进而调用 java.lang.Object 的构造函数） .

您还可以使用[Objenesis](http://code.google.com/p/objenesis/)库来实例化对象，而无需调用构造函数。

或者，如果您愿意，您可以自己生成字节码（使用[ASM](http://asm.objectweb.org/)或类似工具）。在字节码级别，`new Foo()`编译为两条指令：

```
NEW Foo
INVOKESPECIAL Foo.<init> ()V 
```

如果要避免调用 Foo 的构造函数，可以更改第二条命令，例如：

```
NEW Foo
INVOKESPECIAL java/lang/Object.<init> ()V 
```

但即便如此，Foo 的构造函数也必须包含对其超类的调用。否则 JVM 的类加载器会在加载类时抛出异常，抱怨没有调用`super()`.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-04T14:39:51.007

允许代码不首先调用超级构造函数会破坏封装——你可以编写代码并能够*证明*无论其他人做什么——扩展它、调用它、实例化它——它总是处于有效状态的想法。

IOW：这不是 JVM 要求，而是 Comp Sci 要求。还有一个重要的。

为了解决您的问题，顺便说一句，您使用私有静态方法 - 它们不依赖于任何实例：

```
public BigFraction(BigDecimal d)
{
  this(appropriateInitializationNumeratorFor(d),
       appropriateInitializationDenominatorFor(d));
}

private static appropriateInitializationNumeratorFor(BigDecimal d)
{
  if(d.scale() < 0)
  {
    return d.unscaledValue().multiply(BigInteger.TEN.pow(-d.scale()));
  }
  else
  {
    return d.unscaledValue();
  }
} 
```

如果您不喜欢使用单独的方法（例如，许多您只想执行一次的常见逻辑），请使用一种方法返回一个私有的小型静态内部类，该内部类用于调用私有构造函数。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T19:57:11.240

我的*猜测*是，在为每个层次结构调用构造函数之前，该对象处于无效状态。JVM 在它完全构建之前在其上运行任何东西都是不安全的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-04T03:36:44.790

好吧，问题是 java 无法检测到您将在 super 调用之前放置哪些“语句”。例如，您可以引用尚未初始化的成员变量。所以我认为java永远不会支持这一点。现在，有很多方法可以解决这个问题，例如使用工厂或模板方法。

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2009-02-12T06:17:57.807

往这边看。

假设一个对象由 10 个部分组成。

1,2,3,4,5,6,7,8,9,10

好的？

从 1 到 9 属于超类，第 10 部分是您的补充。

在前 9 个完成之前，Simple 无法添加第 10 个部分。

就是这样。

如果从 1 到 6 来自另一个很好的超类，那么事情就是以特定顺序创建一个对象，**这就是设计的方式**。

当然，真正的原因远比这复杂得多，但我认为这几乎可以回答这个问题。

至于替代品，我认为这里已经发布了很多。

# iis - URL 级别的自定义身份验证，仍然与 .NET 一起使用 ISAPI 还是有新的方法？

> ID：508640
> 
> 赞同：1
> 
> 时间：2009-02-03T19:52:23.403
> 
> 标签：iis, authentication, isapi

是否有一种非 IIS 方式来验证不使用 HTML 的用户？

我知道我可以为 IIS 创建自己的 ISAPI 过滤器，但我想用 .NET 代码实现同样的事情，而不是将其与 IIS 集成。

现在有没有办法使用最新的 .NET 来做到这一点，还是 ISAPI 仍然可行？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-08T06:25:28.177

如果要对所有内容应用自定义身份验证，则 IIS 5/6/7 需要 ISAPI 扩展。

Greg 的方式仅适用于 IIS 5/6 上的 ASP.NET 内容。但是，如果您对 IIS 7 的 Integrated Pipeline 功能有很好的了解，您可以配置一个像 Greg 的 ASP.NET HTTP 模块以应用于所有内容。

如果您进一步搜索，MSDN 和 IIS.net 可以为我提供更多详细信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T20:08:48.470

您可以使用 an[`IHttpModule`](http://msdn.microsoft.com/en-us/library/system.web.ihttpmodule.aspx)来执行此类操作，例如

```
public class AuthModule : IHttpModule
{
    public void Init(HttpApplication context)
    {
        context.AuthenticateRequest += OnAuthenticateRequest;
        context.AuthorizeRequest += OnAuthorizeRequest;
    }

    private static void OnAuthenticateRequest(object sender, EventArgs e)
    {
        // authenticate the user here...
        // (note that the sender argument is an HttpApplication instance)
    }

    private static void OnAuthorizeRequest(object sender, EventArgs e)
    {
        // ...then authorize their attempted action here, if needed
    }
} 
```

# asp.net - 在 VMWare 上运行的虚拟服务器上托管 ASP.NET

> ID：508651
> 
> 赞同：0
> 
> 时间：2009-02-03T19:54:07.160
> 
> 标签：asp.net, hosting, vmware, virtualization

我的公司正在运营多个销售保险产品的国际网站。我们当前的设置是一个 Webfarm，其中有多个负载平衡的 Web 服务器托管我们的**ASP.NET**应用程序。后端是一个单一但功能强大的 SQL Server。（都在一个数据中心）

我们的网络管理员想要迁移到在**VMWare**上运行的虚拟服务器。

场景可能是

1.  **Webfarm**：多个标准网络服务器、负载平衡（当前设置）、SQL Server 上的会话状态
2.  **Virtual Webfarm**：多个虚拟服务器，在一台物理 VMWare 主机上进行负载平衡，SQL Server 2.a 上的会话状态与上述相同，但具有多个物理主机
3.  **单一虚拟网络服务器**：一个强大的虚拟网络服务器，不需要负载平衡，会话状态可以保持在进程中

围绕虚拟化大肆宣传，我可以看到好处，但没有这方面的经验。我不知道我们将面临什么问题，我们应该特别注意什么。

*   有没有人有过这种虚拟设置的经验？
*   一般建议是什么？

我倾向于2a。我害怕在一台物理机器上拥有所有网络服务器。

非常感谢您提前分享您的想法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T22:31:48.090

为一个应用程序使用多个 Web 服务器的原因有以下三个：

1.  缩放 - 需要比一台机器提供更多的咕噜声
2.  可靠性 - 网站应在出现故障时继续运行（a. 硬件 b. 软件）
3.  优先级 - 其中一个网络服务器承担繁重的工作（可能是计划任务），让另一个快速响应客户端请求。

嫁给你的场景：

方案 1 提供 1、2、3 方案 2 提供 2b（如果是完全硬件冗余（怀疑），则可能是 2a） 方案 2a ​​提供 1、2 方案 3 不提供上述任何一项

虚拟主机的优势：

*   在服务于多种用途的大型集群上降低总拥有成本 (TCO) 具有成本效益
*   如果需要，可以快速创建新服务器
*   如果成本在许多应用程序之间分摊，则冗余硬件更容易证明其合理性

缺点：

*   其他虚拟机可能会吸走您的 CPU/磁盘 IO 容量

恕我直言，在同一虚拟服务器上对多个虚拟机进行负载平衡几乎没有意义。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T22:52:09.437

罗伯特几乎涵盖了所有内容，我主要只是添加一个注释，说明我们的至少一个客户目前正在使用选项 2a 运行。

所以我们有多个负载平衡的 Web 服务器在几个 VM 主机上运行，​​与非虚拟化 SQL 集群通信——这对它们来说非常有效。

虚拟化的另一个优点是它可以让您更充分地利用您的硬件 - 但是，您需要注意，如果您的虚拟主机以大约 90% 的容量运行多个虚拟机，您就没有很多任何流量高峰的备用容量 - 如果您不期待任何流量高峰，那就太好了，但如果您是，您需要准备一些东西来应对。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-05T08:50:09.103

我同意上述所有答案，并且我实际上在网络托管服务商工作。:-) 如果您现在使用多个负载平衡的网络服务器，那么我只能假设它的原因是

*   硬件冗余：如果单个应用程序服务器出现故障，则这些会话将丢失，但应用程序继续在其他服务器上运行，用户可以立即重新连接。

或者

*   应用程序负载分布（已经很晚了，所以我想不出更好的名字）：您的流量决定了您有多个应用程序服务器，因为您的所有用户都会使单个应用程序服务器崩溃。

如果 #1 是原因，那么转到 VMWare 就达不到目的了，因为您只有一台服务器支持所有功能，并且在硬盘驱动器崩溃等情况下，您在修复时会停机。如果 #2 是原因，那么基于 VMWare 的解决方案可能会起作用，但请记住，您使用的硬件几乎必然比您当前使用的硬件具有更高的性能。因此，您可能会物有所值，但您仍然会失去多台物理机为您提供的冗余。

现在，您总是可以通过让多台物理机都运行 VMWare 来将两者结合起来，但这会增加您可能不一定想要的事情的复杂性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T22:55:39.413

在同一个物理主机上运行多个虚拟服务器听起来并没有什么切实的好处，你只是增加了开销。除非我在您描述设置的方式上遗漏了一些东西，否则迁移到 VMware 根本不会有任何好处 - 除非您正在考虑利用[VMotion等功能](http://www.vmware.com/products/vi/vc/vmotion.html)

VMware 对于整合未充分利用的硬件最为有用。如果您的硬件在高峰期以接近容量运行，那么您不希望在一台机器上运行多个 VM。

虚拟化有很多好处，但您的网络管理员需要在您考虑切换之前证明您的公司有好处。我会说，如果您有多个应用程序在低流量的专用服务器上运行（即每个应用程序都有自己的物理服务器），那么可以肯定，Virtualize。如果您在多台服务器上拥有一个应用程序，则不要这样做。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-11T14:38:55.180

您应该能够使用每个主机具有多个 vm 的虚拟机主机，并在所有主机之间进行负载平衡。

微软正在使用 msdn 和 technet [http://virtualization.info/en/news/2008/05/microsoft-migrates-msdn-and-technet-on.html](http://virtualization.info/en/news/2008/05/microsoft-migrates-msdn-and-technet-on.html)来做这件事。

# java - Python中的多维数组

> ID：508657
> 
> 赞同：10
> 
> 时间：2009-02-03T19:54:37.720
> 
> 标签：java, python, arrays

我有一个小 Java 问题，我想翻译成 Python。因此我需要一个多维数组。在 Java 中，它看起来像：

```
double dArray[][][] = new double[x.length()+1][y.length()+1][x.length()+y.length()+3];
dArray[0][0][0] = 0;
dArray[0][0][1] = POSITIVE_INFINITY; 
```

将在循环中创建更多值并将其写入数组。

如何实例化数组？

PS：不涉及矩阵乘法...

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-04T06:37:50.187

如果您将自己限制在 Python 标准库中，那么列表列表是最接近的构造：

```
arr = [[1,2],[3,4]] 
```

给出一个二维数组. 可以像in一样`arr[i]`访问行，但很难访问列。`i``{0,..,len(arr}`

如果您愿意添加库依赖项，那么[NumPy](http://numpy.scipy.org)包就是您真正想要的。您可以使用以下列表从列表列表中创建一个固定长度的数组：

```
import numpy
arr = numpy.array([[1,2],[3,4]]) 
```

列访问与列表列表相同，但列访问很容易：`arr[:,i]`for `i`in `{0,..,arr.shape[1]}`（列数）。

事实上，NumPy 数组可以是 n 维的。

可以使用创建空数组

```
numpy.empty(shape) 
```

其中`shape`是每个维度中大小的元组；`shape=(1,3,2)`给出一个 3 维数组，第一维大小为 1，第二维大小为 3，第三维大小为 2.

如果要将对象存储在 NumPy 数组中，也可以这样做：

```
 arr = numpy.empty((1,), dtype=numpy.object)
 arr[0] = 'abc' 
```

有关 NumPy 项目的更多信息，请查看[NumPy 主页](http://numpy.scipy.org)。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-04T09:34:25.103

要创建任意大小数组的标准 python 数组：

```
a = [[0]*cols for _ in [0]*rows] 
```

它的访问方式如下：

```
a[0][1] = 5 # set cell at row 0, col 1 to 5 
```

一个值得一提的小蟒蛇陷阱：只需键入即可

```
a = [[0]*cols]*rows 
```

*但这会将相同*的列数组复制到每一行，从而导致不需要的行为。即：

```
>>> a[0][0] = 5
>>> print a[1][0]
5 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-03T19:59:02.360

您可以使用嵌套列表创建它：

```
matrix = [[a,b],[c,d],[e,f]] 
```

如果它必须是动态的，那就更复杂了，为什么不自己写一个小类呢？

```
class Matrix(object):
    def __init__(self, rows, columns, default=0):
        self.m = []
        for i in range(rows):
            self.m.append([default for j in range(columns)])

    def __getitem__(self, index):
        return self.m[index] 
```

这可以像这样使用：

```
m = Matrix(10,5)
m[3][6] = 7
print m[3][6] // -> 7 
```

我确信可以更有效地实施它。:)

如果您需要多维数组，您可以创建一个数组并计算偏移量，或者您可以在数组中的数组中使用数组，这可能对内存非常不利。（虽然可能更快......）我已经实现了这样的第一个想法：

```
class Matrix(object):
    def __init__(self, *dims):
        self._shortcuts = [i for i in self._create_shortcuts(dims)]
        self._li = [None] * (self._shortcuts.pop())
        self._shortcuts.reverse()

    def _create_shortcuts(self, dims):
        dimList = list(dims)
        dimList.reverse()
        number = 1
        yield 1
        for i in dimList:
            number *= i
            yield number

    def _flat_index(self, index):
        if len(index) != len(self._shortcuts):
            raise TypeError()

        flatIndex = 0
        for i, num in enumerate(index):
            flatIndex += num * self._shortcuts[i]
        return flatIndex

    def __getitem__(self, index):
        return self._li[self._flat_index(index)]

    def __setitem__(self, index, value):
        self._li[self._flat_index(index)] = value 
```

可以这样使用：

```
m = Matrix(4,5,2,6)
m[2,3,1,3] = 'x'
m[2,3,1,3] // -> 'x' 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-02-03T20:00:21.500

看看[numpy](http://numpy.scipy.org//)

这是给你的代码片段

```
import numpy as npy

d = npy.zeros((len(x)+1, len(y)+1, len(x)+len(y)+3))
d[0][0][0] = 0 # although this is unnecessary since zeros initialises to zero
d[i][j][k] = npy.inf 
```

我认为您不需要实施科学应用程序来证明使用 numpy. 它更快、更灵活，您几乎可以存储任何东西。鉴于我认为尝试并证明*不*使用它可能会更好。有正当的理由，但它增加了很多，而且成本很低，所以值得考虑。

PS你的数组长度正确吗？它看起来像一个形状非常奇特的矩阵......

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-11-04T12:04:00.183

多维数组有点模糊。使用它们的原因很少，而需要三思而后行并使用更能反映您正在做的事情的其他东西的原因很多。[暗示。你的问题在上下文中很薄弱;-)]

如果你正在做矩阵数学，那么使用`numpy`.

然而，有些人使用的语言迫使他们使用多维数组，因为这就是他们所拥有的一切。如果您和我一样大（我在 70 年代开始编程），那么您可能还记得多维数组是您拥有的唯一数据结构的日子。或者，您的经验可能将您限制在必须将问题转化为多维数组的语言中。

假设您有一个集合*n* 3D 点。每个点都有一个 x、y、z 和时间值。这是一个*n* x 4 数组吗？还是一个 4 * *n*数组？并不真地。

由于每个点都有 4 个固定值，因此这更合适地是一个元组列表。

```
a = [ ( x, y, z, t ), ( x, y, z, t ), ... ] 
```

更好的是，我们可以将其表示为对象列表。

```
class Point( object ):
    def __init__( self, x, y, z, t ):
        self.x, self.y, self.z, self.t = x, y, z, t

a = [ Point(x,y,x,t), Point(x,y,z,t), ... ] 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-03T20:04:14.890

如果您可以使用稀疏数组，则可以使用 dict 来存储您的值。Python 的 dicts 允许您使用元组作为键，因此，您可以像这样分配和访问“稀疏数组”（这里实际上是一个 dict）的元素：

```
d = {}
d[0,2,7] = 123 # assign 123 to x=0, y=2, z=7
v = d[0,2,7] 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-02-03T20:00:38.423

可能与您无关，但如果您正在做认真的矩阵工作，请参阅[numpy](http://numpy.scipy.org/)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-04T05:47:59.413

对于数值数据，[Numpy Arrays](http://numpy.scipy.org/)：

```
>>> matrix1 = array(([0,1],[1,3]))
>>> print matrix1
[[0 1]
[1 3]] 
```

对于一般数据（例如字符串），您可以使用列表列表、元组列表...

```
matrix2 = [['a','b'], ['x','y']] 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-03T21:34:16.020

这是创建用零初始化的嵌套 3 维列表的快速方法：

```
# dim1, dim2, dim3 are the dimensions of the array
a =[[[0 for _ in range(dim1)] for _ in range(dim2)] for _ in range(dim1) ]
a[0][0][0] = 1 
```

这是一个列表列表，比数组更灵活一点，你可以这样做：

```
a[0][0] = [1,2,3,4] 
```

替换数组中的一整行，甚至像这样滥用它：

```
a[0] = "Ouch"
print a[0][0] #will print "O", since strings are indexable the same way as lists
print a[0][0][0] #will raise an error, since "O" isn't indexable 
```

但如果你需要性能，那么我同意 numpy 是要走的路。

另外，请注意：

```
a = [[[0] * 5]*5]*5] 
```

如果你尝试`a[0][0][0]=7`上面的对象，你会发现它有什么问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-05T07:33:36.687

另一种选择是使用字典：

```
>>> from collections import defaultdict
>>> array = defaultdict(int) # replace int with the default-factory you want
>>> array[(0,0)]
0
>>> array[(99,99)]
0 
```

您还需要跟踪上限和下限。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-07-28T15:31:04.103

我刚刚遇到了类似的需求并对此进行了编码：

```
def nDimensionsMatrix(dims, elem_count, ptr=[]):
    if (dims > 1):
        for i in range(elem_count[dims-1]):
            empty = []
            ptr.append(empty)
            nDimensionsMatrix(dims-1, elem_count, empty)
        return ptr
    elif dims == 1:
        ptr.extend([0 for i in range(elem_count[dims])])
        return ptr

matrix = nDimensionsMatrix(3, (2,2,2)) 
```

我不看速度，只看功能；）

我想创建一个具有 N 维的矩阵并用 0 初始化（每个维度中元素的*elem_count*个数）。

希望它可以帮助某人

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-09-29T19:29:39.380

很简单，使用 numpy 时：

```
b = ones((2,3,4)) # creates a 2x3x4 array containing all ones. 
```

'ones' 可以替换为 'zeros'

# business-objects - 业务对象字段结构子集的最佳实践？

> ID：508658
> 
> 赞同：1
> 
> 时间：2009-02-03T19:54:43.943
> 
> 标签：business-objects

如果我有一个包含 50 个字段的业务对象，我需要使用业务对象中的 3 个字段填充下拉列表或网格视图之类的内容，以便快速浏览。

加载完全填充的 BO 然后只在表示层中获取几个必填字段是最佳做法吗？

填充这样大小的 Bo 集合似乎效率低下，但唯一的其他方法似乎是仅返回部分填充的 BO，其中仅包含特定 UI 所需的字段，如果您有很多类似的 UI 要求，这将很难管理，或者创建一个像 MyBusinessObjectHeader 这样包含字段的基类，然后让 MyBusinessObject 继承它并实现其余的字段，但这似乎会使你的 UI 过于紧密。

这种情况的最佳做法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T20:17:48.733

我制作了一个单独的只读摘要对象（或结构）的只读列表，这些对象是轻量级的并且无法操作。该系列可以根据您正常的任何需求进行定制。可以通过将“摘要”对象传递给类型转换、工厂或构造函数来检索完整对象——无论您使用什么技术。

请注意，这是一种优化，仅在成熟对象的集合变得太慢时才会发生。那时可以很容易地创建它。通常，只有在必要时才会创建此类类。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T20:05:07.120

有很多框架可以执行您所说的这种 o/r 映射。

您需要花费更多开销来换取易用性和强大的配置。

如果您使用的是 .net，请参阅[Hibernate](http://www.hibernate.org/)或[NHibernate 。](http://www.hibernate.org/343.html)

# c# - WCF [DataContract] 设置/获取未执行

> ID：508661
> 
> 赞同：2
> 
> 时间：2009-02-03T19:55:20.150
> 
> 标签：c#, wcf

我对 WCF 有点陌生，我认为我不完全理解 DataContracts 的交易。我有这个'RequestArray'类：

```
[DataContract]
public class RequestArray
{
  private int m_TotalRecords;
  private RequestRecord[] m_Record;

  [System.Xml.Serialization.XmlElement]
  [DataMember]
  public RequestRecord[] Record
  { 
    get { return m_Record; }
  }

  [DataMember]
  public int TotalRecords
  {
    get { return m_TotalRecords; }
    set {
      if (value > 0 && value <= 100) {
        m_TotalRecords = value;
    m_Record = new RequestRecord[value];
    for (int i = 0; i < m_TotalRecords; i++)
      m_Record[i] = new RequestRecord();
      }
    }
  }
} 
```

这个想法是当客户说`requestArray.TotalRecords=6;`Record 数组将被分配和初始化时（我意识到我在分配后面隐藏了一个实现，这是我无法控制的）。

问题是当客户端这样做时，TotalRecord 的设置代码没有被调用，服务中的断点也确认了这一点。相反，已经生成了某种通用的 setter 来代替调用。如何让客户改用我的设置器？

编辑：看起来我不太了解 [DataContract] 的工作原理，但客户端不会执行此代码是有道理的。就像我在评论中提到的那样，如果我“手动”完成设置器的工作，我会看到设置代码在我调用服务函数时会正确执行。

连载我还不确定。RequestRecord[] 数组的内容不会被转移。Record 类有 setter/getter，我觉得我需要一个辅助函数来帮助它序列化整个类。

感谢你的帮助！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T21:51:35.330

客户端代理将在客户端和服务器上执行相同代码的前提是有缺陷的，因为 WCF 是基于接口的。我在下面的第 2 条中解释了这一点。

## 共享 WCF 接口和实现的规则

如果您想共享数据契约的实现，您需要将 RequestArray 类分解到一个类库中，该类库只包含数据契约类，可能还包括 RequestRecord 类。

我生活的规则：

1.  将所有数据合同本身 (100%) 分组到一个或多个程序集中，没有例外。

2.  将所有服务合同归为一个或多个程序集。

3.  将所有服务类型（即实现服务契约的类）分组到一个或多个程序集中。

4.  将所有客户端通道代理（即调用服务合同接口上定义的方法的类）分组到一个或多个程序集中。

5.  在所有客户端软件都作为 WCF 服务运行的通用框架中（我避免双工连接），合并规则 2、3 和 4 是安全的，以便将服务合同、服务类型和通道代理组合到一个程序集中。

*将接口分离成更灵活的依赖链的主要原因是可以将一组有限的程序集部署到客户端，而不会暴露不必要的和潜在的专有实现细节。另一个原因是它使重构变得更加容易，尤其是在您想通过继承或委托来实现或扩展通用框架的情况下。*

## 检查代码

RequestArray 的代码存在一些大问题......

1.  当反序列化 DataContract 实例时，setter 逻辑将覆盖 m_Record 数组变量的任何已修改元素。这违反了反序列化原则。

2.  Record 属性将无法反序列化，因为 RequestArray 类的 Record 属性是只读的（因为它缺少 setter）。 *通常，我发现对于 DataContract 类，只读属性的最佳方法只是一种方法。* 养成将数据合约视为比特桶的习惯是一个坏主意。属性基本上做的是动态创建专门用于数据序列化和反序列化的接口定义。 *我认为将线路上的数据视为对象是错误的。相反，它是一种选择加入的方式，用于指定需要通过网络持久化的对象的相关数据部分。*

3.  如果 TotalRecords 属性最终（正确地）只允许设置 m_TotalRecords 变量，它就会变得危险，因为它将完全独立于内部数组。为了让我在我的示例代码（如下）中可以接受它，我必须用`if (m_TotalRecords == 0)`. 在我保存以备将来使用的示例代码中，我完全注释掉了 TotalRecords 属性，但我留下 m_TotalRecords 只是为了说明私有对象实际上是通过网络保留的。

## 固定代码

我改编了本德威的示例代码（谢谢！）并提出了这个完整的测试。注意：我必须定义 RequestRecord。另外，请参阅代码注释。如果有任何错误或任何不清楚的地方，请告诉我。

```
#region WCFDataContractTest
    [DataContract] // The enclosed type needs to also be attributed for WCF
    public class RequestRecord
    {
        public RequestRecord() { }
        [DataMember] // This is CRUCIAL, otherwise the Name property will not be preserved.
        public string Name { get; set; }
    }
    [DataContract] // Encloses the RequestRecord type
    public class RequestArray
    {
        private int m_TotalRecords; // should be for internal bookkeeping only
        private RequestRecord[] m_Record;

        [System.Xml.Serialization.XmlElement]
        [DataMember]
        public RequestRecord[] Record
        {
            get { return m_Record; }
            // deserialization will not work without the set
            set { m_Record = value; }
        }

        [DataMember] // is not really needed
        public int TotalRecords
        {
            get { return m_TotalRecords; }
            set
            {
                if (m_TotalRecords == 0)
                    m_TotalRecords = value;
            }
        }

        // The constructor is not called by the deserialization mechanism,
        // therefore this is the right place to specify the array size and to
        // perform the array initialization.
        public RequestArray(int totalRecords)
        {
            if (totalRecords > 0 && totalRecords <= 100)
            {
                m_TotalRecords = totalRecords;
                m_Record = new RequestRecord[totalRecords];
                for (int i = 0; i < m_TotalRecords; i++)
                    m_Record[i] = new RequestRecord() { Name = "Record #" + i.ToString() };

                m_TotalRecords = totalRecords;
            }
            else
                m_TotalRecords = 0;
        }
    }
    public static void TestWCFDataContract()
    {
        var serializer = new DataContractSerializer(typeof(RequestArray));

        var test = new RequestArray(6);

        Trace.WriteLine("Array contents after 'new':");
        for (int i = 0; i < test.Record.Length; i++)
            Trace.WriteLine("\tRecord #" + i.ToString() + " .Name = " + test.Record[i].Name);

        //Modify the record values...
        for (int i = 0; i < test.Record.Length; i++)
            test.Record[i].Name = "Record (Altered) #" + i.ToString();

        Trace.WriteLine("Array contents after modification:");
        for (int i = 0; i < test.Record.Length; i++)
            Trace.WriteLine("\tRecord #" + i.ToString() + " .Name = " + test.Record[i].Name);

        using (var ms = new MemoryStream())
        {
            serializer.WriteObject(ms, test);

            ms.Flush();
            ms.Position = 0;

            var newE = serializer.ReadObject(ms) as RequestArray;

            Trace.WriteLine("Array contents upon deserialization:");
            for (int i = 0; i < newE.Record.Length; i++)
                Trace.WriteLine("\tRecord #" + i.ToString() + " .Name = " + newE.Record[i].Name);
        }
    }
#endregion 
```

运行 TestWCFDataContract 后，此示例程序的清单是：

'new' 之后的数组内容：

```
 Record #0 .Name = Record #0
    Record #1 .Name = Record #1
    Record #2 .Name = Record #2
    Record #3 .Name = Record #3
    Record #4 .Name = Record #4
    Record #5 .Name = Record #5 
```

修改后的数组内容：

```
 Record #0 .Name = Record (Altered) #0
    Record #1 .Name = Record (Altered) #1
    Record #2 .Name = Record (Altered) #2
    Record #3 .Name = Record (Altered) #3
    Record #4 .Name = Record (Altered) #4
    Record #5 .Name = Record (Altered) #5 
```

反序列化时的数组内容：

```
 Record #0 .Name = Record (Altered) #0
    Record #1 .Name = Record (Altered) #1
    Record #2 .Name = Record (Altered) #2
    Record #3 .Name = Record (Altered) #3
    Record #4 .Name = Record (Altered) #4
    Record #5 .Name = Record (Altered) #5 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T20:12:26.887

我只是进行了一个小测试，它调用了 setter。你是如何反序列化对象的？

```
class Program
{
    static void Main(string[] args)
    {
        var serializer = new DataContractSerializer(typeof(Employee));

        var employee = new Employee() { Name="Joe" };
        using (var ms = new MemoryStream())
        {
            serializer.WriteObject(ms, employee);

            ms.Flush();
            ms.Position = 0;

            var newE = serializer.ReadObject(ms) as Employee;
        }

        Console.ReadKey();

    }
}
[DataContract]
public class Employee
{
    private string _name;
    [DataMember]
    public string Name
    {
        get { return _name; }
        set { _name = value; }
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T21:22:42.487

假设您正在创建对 WCF 服务的服务引用，我相信另一条评论是正确的，因为在客户端上您实际上正在访问已作为代理类生成的一部分创建的生成类。

有一种方法可以实现您想要实现的目标。我会从架构的角度质疑它，它只适用于 .NET 客户端。

*   将您的服务接口、参数类型和返回类型（即您的 DataContracts）隔离到一个程序集中。我称之为*合同*组装

*   将你的服务实现移动到一个单独的程序集中，我称之为*实现程序集*，并引用合同程序集

*   在客户端中创建对 Contract Assembly 的引用

*   在客户端手动编码通道的实例化......像这样（你必须查找确切的语法）： IMyService myService = new ChannelFactory< IMyService>().CreateChannel();

后置条件应该是在客户端成功调用DataContract类中编写的行为，因为使用了本地类型引用。

快乐编码！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T20:10:14.007

听起来您可能会混淆服务器端和客户端功能。如果您通过 Visual Studio 生成客户端类，那么您的 Set 逻辑将不会被继承。您可以通过打开 ProjectFolder\Service References\SomeServiceName\References.cs 文件并查看为您生成的对象 VS 的定义来检查这一点。

如果您的客户端和服务器与您的 Set 逻辑共享一个公共 dll，那将非常奇怪。我需要查看更多调用它的代码。

编辑：作为附录，如果您希望您的服务器和客户端在他们的合同对象上共享相同的逻辑，最好的办法是为您的所有数据合同和服务合同预留一个单独的 dll，然后在两个项目中包含这个 dll。我还发现让 VS 为您生成代理类既好又快，但从长远来看，这会引起很大的麻烦。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T20:42:48.730

客户端必须使用相同的类实现。当您向特定应用程序添加服务引用时，VS 生成客户端类时，数据协定属性背后的实现细节不会添加到类中。将公开的类编译到单独的类库中，在客户端项目中引用该类库，当您将服务引用添加到您的项目时，请确保在“高级...”选项卡下，“在引用的程序集中重用类型”被检查。

# java - java中parseInt()和valueOf()的区别？

> ID：508665
> 
> 赞同：494
> 
> 时间：2009-02-03T19:56:56.980
> 
> 标签：java, integer, parseint, value-of

有什么`parseInt()`不同`valueOf()`？

他们似乎对我做了完全相同的事情（也适用于`parseFloat()`,`parseDouble()`等`parseLong()`，它们与 有什么不同`Long.valueOf(string)`？

此外，按照惯例，哪一个更可取并且更经常使用？

* * *

## 回答 #1

> 赞同：463
> 
> 时间：2009-02-03T20:04:33.503

好吧，API for[`Integer.valueOf(String)`](http://java.sun.com/javase/6/docs/api/java/lang/Integer.html#valueOf(java.lang.String))确实说`String`被解释为就好像它被赋予了[`Integer.parseInt(String)`](http://java.sun.com/javase/6/docs/api/java/lang/Integer.html#parseInt(java.lang.String)). 但是，`valueOf(String)`返回一个对象，而返回一个原语。**`new`** `Integer()``parseInt(String)``int`

如果你想享受潜在的缓存优势[`Integer.valueOf(int)`](http://java.sun.com/javase/6/docs/api/java/lang/Integer.html#valueOf(int))，你也可以使用这个碍眼的：

```
Integer k = Integer.valueOf(Integer.parseInt("123")) 
```

现在，如果您想要的是对象而不是原始对象，那么使用`valueOf(String)`可能比使用新对象更有吸引力，`parseInt(String)`因为前者始终存在于`Integer`、`Long`、`Double`等。

* * *

## 回答 #2

> 赞同：80
> 
> 时间：2009-02-03T20:01:12.450

从[这个论坛](http://www.coderanch.com/t/378048/Java-General-intermediate/java/What-differece-bw-Parseint-ValueOf#1650781)：

> **`parseInt()`**返回原始整数类型 ( *int* )，从而**`valueOf`**返回 *java.lang.Integer*，它是表示整数的对象。在某些情况下，您可能需要一个 Integer 对象，而不是原始类型。
> 
> 当然，另一个明显的区别是**intValue**是一个实例方法，而**parseInt**是一个静态方法。

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2009-02-03T20:01:45.350

```
Integer.valueOf(s) 
```

类似于

```
new Integer(Integer.parseInt(s)) 
```

不同之处在于`valueOf()`返回一个`Integer`，并`parseInt()`返回一个`int`（原始类型）。另请注意，它`valueOf()`可能会返回一个缓存的`Integer`实例，这可能会导致`==`测试结果间歇性正确的混乱结果。在[自动装箱](http://java.sun.com/j2se/1.5.0/docs/guide/language/autoboxing.html)之前，便利性可能会有所不同，在 java 1.5 之后，这并不重要。

此外，`Integer.parseInt(s)`也可以采用原始数据类型。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2014-10-28T08:53:29.387

查看 Java 源代码：`valueOf`正在使用`parseInt`：

```
/**
 * Parses the specified string as a signed decimal integer value.
 *
 * @param string
 *            the string representation of an integer value.
 * @return an {@code Integer} instance containing the integer value
 *         represented by {@code string}.
 * @throws NumberFormatException
 *             if {@code string} cannot be parsed as an integer value.
 * @see #parseInt(String)
 */
public static Integer valueOf(String string) throws NumberFormatException {
    return valueOf(parseInt(string));
} 
```

`parseInt`返回`int`（不是`Integer`）

```
/**
 * Parses the specified string as a signed decimal integer value. The ASCII
 * character \u002d ('-') is recognized as the minus sign.
 *
 * @param string
 *            the string representation of an integer value.
 * @return the primitive integer value represented by {@code string}.
 * @throws NumberFormatException
 *             if {@code string} cannot be parsed as an integer value.
 */
public static int parseInt(String string) throws NumberFormatException {
    return parseInt(string, 10);
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-03T20:28:28.727

Integer.parseInt 可以只返回 int 作为本机类型。

Integer.valueOf 实际上可能需要分配一个 Integer 对象，除非该整数恰好是预分配的整数之一。这成本更高。

如果您只需要本机类型，请使用 parseInt。如果您需要一个对象，请使用 valueOf。

此外，由于这种潜在的分配，自动装箱实际上在各个方面都不是好事。它可以减慢速度。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2019-02-15T14:09:55.953

*   **valueOf** - 转换为 Wrapper 类
*   **parseInt** - 转换为原始类型

Integer.parseInt 仅接受 String 并返回原始整数类型 (int)。

```
 public static int parseInt(String s) throws NumberFormatException {
        return parseInt(s,10);
    } 
```

Iteger.valueOf 接受 int 和 String。如果 value 是 String，valueOf 使用 parseInt 将其转换为简单的 int，如果输入小于 -128 或大于 127，则返回 new Integer。如果输入在范围 (-128 - 127) 内，它总是从内部整数缓存。Integer 类维护一个内部静态 IntegerCache 类，它充当缓存并保存从 -128 到 127 的整数对象，这就是为什么当我们尝试获取 127 的整数对象时（例如）我们总是得到相同的对象。

`Iteger.valueOf(200)`将给出 200 的新整数。就像;`new Integer(200)` `Iteger.valueOf(127)`一样`Integer = 127`

如果您不想将 String 转换为 Integer，请使用`Iteger.valueOf`.

如果您不想将 String 转换为简单的 int ，请使用`Integer.parseInt`. 它工作得更快。

```
 public static Integer valueOf(int i) {
        if (i >= IntegerCache.low && i <= IntegerCache.high)
            return IntegerCache.cache[i + (-IntegerCache.low)];
        return new Integer(i);
    }

  public static Integer valueOf(String s) throws NumberFormatException {
        return Integer.valueOf(parseInt(s, 10));
  }

  private static class IntegerCache {
      static final int low = -128;
      static final int high;
      static final Integer cache[];

    static {
        // high value may be configured by property
        int h = 127;
        String integerCacheHighPropValue =
            sun.misc.VM.getSavedProperty("java.lang.Integer.IntegerCache.high");
        if (integerCacheHighPropValue != null) {
            try {
                int i = parseInt(integerCacheHighPropValue);
                i = Math.max(i, 127);
                // Maximum array size is Integer.MAX_VALUE
                h = Math.min(i, Integer.MAX_VALUE - (-low) -1);
            } catch( NumberFormatException nfe) {
                // If the property cannot be parsed into an int, ignore it.
            }
        }
        high = h;

        cache = new Integer[(high - low) + 1];
        int j = low;
        for(int k = 0; k < cache.length; k++)
            cache[k] = new Integer(j++);

        // range [-128, 127] must be interned (JLS7 5.1.7)
        assert IntegerCache.high >= 127;
    }

    private IntegerCache() {}
  } 
```

并且比较 Integer.valueOf(127) == Integer.valueOf(127) 返回 true

```
Integer a = 127; // Compiler converts this line to Integer a = Integer.valueOf(127);
Integer b = 127; // Compiler converts this line to Integer b = Integer.valueOf(127);
a == b; // return true 
```

因为它从缓存中获取具有相同引用的 Integer 对象。

但是 Integer.valueOf(128) == Integer.valueOf(128) 是假的，因为 128 超出了 IntegerCache 的范围，它返回新的 Integer，所以对象会有不同的引用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-03T20:02:37.780

parse* 变体返回原始类型，valueOf 版本返回对象。我相信 valueOf 版本也将使用内部引用池为给定值返回 SAME 对象，而不仅仅是具有相同内部值的另一个实例。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-12-16T09:05:23.073

因为您可能正在使用 jdk1.5+ 并且它会自动转换为 int。因此，在您的代码中，它首先返回 Integer，然后自动转换为 int。

您的代码与

```
int abc = new Integer(123); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-07-23T17:58:28.300

如果您检查 Integer 类，您会发现 valueof 调用 parseInt 方法。最大的区别是调用 valueof API 时的缓存。如果值在 -128 到 127 之间，它会缓存 请在下面的链接中找到更多信息

[http://docs.oracle.com/javase/7/docs/api/java/lang/Integer.html](http://docs.oracle.com/javase/7/docs/api/java/lang/Integer.html)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-09-29T03:31:14.670

公共静态整数 valueOf(String s)

1.  该参数被解释为表示一个带符号的十进制整数，就像将该参数提供给 parseInt(java.lang.String) 方法一样。
2.  结果是一个表示字符串指定的整数值的 Integer 对象。

3.  换句话说，此方法返回一个等于以下值的 Integer 对象： new Integer(Integer.parseInt(s))

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2009-08-26T07:08:04.440

1.  在 ValueOf -> 的情况下，它正在创建一个 Integer 对象。不是原始类型，也不是静态方法。
2.  在 ParseInt.ParseFloat -> 的情况下，它返回各自的原始类型。并且是一个静态方法。

我们应该根据需要使用任何一种。在 ValueOf 的情况下，它正在实例化一个对象。如果我们只需要一些文本的值，它将消耗更多资源，那么我们应该使用 parseInt、parseFloat 等。

# java - 如何在所有缩放级别实时准确地绘制大数据向量？

> ID：508666
> 
> 赞同：8
> 
> 时间：2009-02-03T19:57:03.830
> 
> 标签：java, matlab, plot, zooming, large-data-volumes

我有需要实时绘制的大型数据集（10 Hz 数据，因此每 24 小时有 864k 个点）。这个想法是用户可以缩放和平移到高度详细的散点图。

数据不是很连续，有尖峰。由于数据集如此之大，我无法在每次绘图刷新时绘制每个点。

但我也不能只绘制每个第 n 个点，否则我会错过大而短的尖峰等主要特征。

Matlab 做得对。您可以给它一个全零的 864k 向量，只需将任意一点设置为 1，它就会通过缩放和平移实时正确绘制。

Matlab是如何做到的？

我的目标系统是 Java，所以我将在 Swing/Java2D 中生成该图的视图。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T20:02:39.123

您应该尝试 MATLAB Central 中的文件：

[https://mathworks.com/matlabcentral/fileexchange/15850-dsplot-downsampled-plot](https://mathworks.com/matlabcentral/fileexchange/15850-dsplot-downsampled-plot)

![](https://mathworks.com/matlabcentral/mlc-downloads/downloads/submissions/15850/versions/2/screenshot.gif)

**来自作者：**

此版本的“绘图”将允许您可视化具有大量元素的数据。绘制大型数据集会使您的图形变得迟缓，但大多数时候您并不需要绘图中显示的所有信息。您的屏幕只有这么多像素，您的眼睛将无法检测到屏幕上未捕获的任何信息。

此函数将对数据进行下采样并仅绘制数据的子集，从而提高内存需求。放大绘图时，会显示更多信息。已完成一些工作以确保捕获异常值。

句法：

```
dsplot(x, y)  
dsplot(y)  
dsplot(x, y, numpoints) 
```

例子：

```
x =linspace(0, 2*pi, 1000000);  
y1=sin(x)+.02*cos(200*x)+0.001*sin(2000*x)+0.0001*cos(20000*x);  
dsplot(x,y1); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T20:05:15.997

我不知道 Matlab 是如何做到的，但我会从[Quadtrees](http://en.wikipedia.org/wiki/Quadtree)开始。

将所有数据点转储到四叉树中，然后以给定的缩放级别进行渲染，沿着四叉树向下走（从与您正在查看的内容重叠的区域开始），直到到达与像素大小相当的区域。在该区域的中间粘贴一个像素。

补充：使用 OpenGL/JOGL 进行绘图也将帮助您获得更快的绘图速度。特别是如果您可以预测平移，并建立要在显示列表或其他内容中显示的点，这样您就不必为新帧做任何 CPU 工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T20:18:02.430

10Hz 数据意味着您只需每秒绘制 10 帧。这应该很容易，因为许多游戏可以实现超过 100 fps 的图形，而且图形要复杂得多。

如果您为每个可能的数据点每秒绘制 10 个像素，则可以使用 600 像素宽的小部件显示一分钟的数据。如果将第 600 个样本的索引保存到最后一个样本，那么只绘制最新数据应该很容易。

如果您没有每 10 秒的新数据点，您必须想出一种插入插值数据点的方法。想到三个选择：

1.  重复最后一个数据点。
2.  插入一个“空”数据点。这将导致图表中的空白。
3.  在下一个数据点到达之前不要更新图表。然后插入您没有立即绘制的所有像素，并在数据点之间进行线性插值。

为了使动画流畅使用[双缓冲](http://en.wikipedia.org/wiki/Double_buffering)。如果您的目标语言支持画布小部件，它可能支持双缓冲。

缩放时，您有与上述相同的三个选择，因为即使原始数据点是缩放的数据点也是不连续的。

[这](http://java.sun.com/products/jfc/tsc/articles/painting/)可能有助于在 Java 中实现它。

# c# - 生成 .po/.mo 文件

> ID：508673
> 
> 赞同：0
> 
> 时间：2009-02-03T19:58:12.783
> 
> 标签：c#, php, asp.net, localization, internationalization

我有一个充满翻译的数据库，我想生成 .po 或 .mo 文件。我正在使用 C#，但如果存在，我也可以从 PHP 移植一个实现。除了 GNU 的 gettext 实用程序之外，我找不到任何语言的示例。有人知道吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T20:18:54.270

.po 文件非常容易生成，您可以使用 poedit。当所有字符串（未翻译）都在文件中时，编写一个脚本，该脚本通过数据库搜索 msgid，然后将 msgstr 从数据库复制到 .po 文件中。.po 文件完成保存后，poedit 会为您创建一个 .mo 文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-04T20:23:18.627

阅读规范后，它看起来是一种相当简单的格式。不如 XML 漂亮，但至少每个元素都以唯一的序列开头。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-25T09:29:29.543

我无法使用 POEdit 创建 .po 文件？怎么做？有一条以 开头的路径。选择“新目录”时，但该路径应该是什么？

# asp.net - 数据表和 JavaScript

> ID：508676
> 
> 赞同：0
> 
> 时间：2009-02-03T19:58:35.230
> 
> 标签：asp.net, javascript, gridview, datatable

每次添加一行时，有没有办法避免使用 gridview 回发？

换句话说，我是否可以将 DataTable 存储在客户端并在完成保存后将其传递给服务器控件，而不是每次添加行时都进行回发？

我搜索和搜索......我能找到的只是 Web 服务、JSON，我觉得这里是多余的......这是一个简单的任务，我相信每个人都必须在某个时候做。

任何人都可以对此有所了解吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T20:34:48.217

如果您正在处理使用 ViewState 的标准 ASP.NET GridView，则无法避免回发。

但是，您可以禁用 ViewState 并在每次页面加载时手动（以编程方式）呈现控件。这将让您控制行创建/删除/更新的各个方面，但您必须手动完成所有操作。是的，您将利用 AJAX 在服务器上读取或更新。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T20:22:07.353

除了UpdatePanel，我不知道任何可以让您使用开箱即用的gridview 做到这一点的东西，但这并不重要。如果您想实现一个完整的 AJAX 网格，我会考虑使用 ListView 控件，这将使您对生成的 html 有更多的控制权。

这是来自 MSDN 杂志的一篇很棒的文章[http://msdn.microsoft.com/en-us/magazine/cc337898.aspx](http://msdn.microsoft.com/en-us/magazine/cc337898.aspx)

# ruby-on-rails - Rails App 在后台运行长时间任务的最佳实践？

> ID：508678
> 
> 赞同：32
> 
> 时间：2009-02-03T19:59:31.297
> 
> 标签：ruby-on-rails, ruby

我有一个 Rails 应用程序，不幸的是，在向控制器发出请求后，它必须进行一些需要一段时间的处理。在 Rails 中为长期运行的任务或请求提供反馈或进度的最佳实践是什么？这些控制器方法通常持续 60 多秒。

我不关心客户端......我计划每隔一秒左右发出一个 Ajax 请求并显示一个进度指示器。我只是不确定 Rails 的最佳实践，我要创建一个额外的控制器吗？有什么聪明的我可以做的吗？我希望答案只集中在使用 Rails 的服务器端。

在此先感谢您的帮助。

编辑：

如果重要，http 请求是针对 PDF 的。然后我让 Rails 与 Ruport 一起生成这些 PDF。问题是，这些 PDF 非常大并且包含大量数据。使用后台任务仍然有意义吗？假设平均 PDF 需要大约一到两分钟，这是否会使我的 Rails 应用程序在此期间对任何其他服务器请求都没有响应？

编辑2：

好的，经过进一步调查，似乎我的 Rails 应用程序在收到大 PDF 请求后确实对任何其他 HTTP 请求没有响应。 **所以，我想现在的问题变成了：最好的线程/后台机制是什么？** 它必须是稳定和维护的。我很惊讶 Rails 没有内置这样的东西。

编辑3：

我已阅读此页面：[http](http://wiki.rubyonrails.org/rails/pages/HowToRunBackgroundJobsInRails) ://wiki.rubyonrails.org/rails/pages/HowToRunBackgroundJobsInRails 。我很想阅读有关使用这些工具的各种经验。

编辑4：

如果重要的话，我正在使用Passenger Phusion“modrails”。

编辑5：

我的开发机器使用的是 Windows Vista 64 位；但是，我的生产机器是 Ubuntu 8.04 LTS。我应该考虑为我的开发机器切换到 Linux 吗？提出的解决方案是否适用于两者？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-03T20:29:29.787

Workling[插件](https://github.com/ascarter/workling)允许您在队列中安排后台任务（它们将执行冗长的任务）。从 0.3 版开始，您可以向工作人员询问其状态，这将允许您显示一些漂亮的进度条。

Workling 的另一个很酷的功能是可以切换异步后端：您可以使用 DelayedJobs、Spawn（经典 fork）、Starling...

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-19T22:01:36.563

我有一个非常大的站点，可以生成大量的大型 CSV 文件。这些有时需要几分钟才能完成。我执行以下操作：

*   我有一个包含所请求文件详细信息的作业表。当用户请求一个文件时，该请求进入该表，并且用户被带到一个“工作状态”页面，该页面列出了他们所有的工作。
*   我有一个运行所有未完成作业的 rake 任务（作业模型上的一个类方法）。
*   我在另一个处理这些工作的盒子上单独安装了导轨。这个盒子只是做工作，外界无法访问。
*   在这个单独的框中，一个 cron 作业每 60 秒运行一次所有未完成的作业，除非作业从最后一次调用开始仍在运行。
*   用户的作业状态页面会自动刷新以显示作业的状态（在作业开始、运行和完成时由作业框更新）。作业完成后，会出现一个指向结果文件的链接。

如果您只打算一次运行一两个，这可能太繁重了，但是如果您想扩展...... :)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-19T22:20:01.370

在后台调用 ./script/runner 对我来说效果最好。（我也在做 PDF 生成。）它似乎是最小的公分母，同时也是最容易实现的。 [这是我的经验的记录](https://web.archive.org/web/20111214053225/http://www.ahabman.com/blog/2008/05/rails-background-process-simple-fast-easy/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T10:58:46.167

一个不需要任何额外 Gem 或插件的简单解决方案是创建一个自定义 Rake 任务来处理 PDF 生成。您可以将 PDF 生成过程建模为状态机，其中包含已*提交*、*处理*和*完成*等状态，这些状态存储在模型的数据库表中。对 Rails 应用程序的初始 HTTP 请求将简单地将一条记录添加到具有*提交*状态的表中并返回。

会有一个 cron 作业将您的自定义 Rake 任务作为单独的 Ruby 进程运行，因此 Rails 主应用程序不受影响。Rake 任务可以使用 ActiveRecord 查找所有具有已*提交*状态的模型，将状态更改为正在*处理*，然后生成相关的 PDF。最后，它应该将状态设置为*完成*。这使 Rails 应用程序中的 AJAX 调用能够监控 PDF 生成过程的状态。

如果将 Rake 任务放在***your_rails_app* /lib/tasks**中，那么它可以访问 Rails 应用程序中的模型。这种**pdf_generator.rake**的骨架如下所示：

```
namespace :pdfgenerator do
  desc 'Generates PDFs etc.'
  task :run => :environment do

    # Code goes here...
  end
end 
```

正如 wiki 中所述，这种方法有一些缺点。您将使用 cron 定期创建一个相当重量级的 Ruby 进程，并且您的 cron 作业的时间需要仔细调整，以确保每个作业都有足够的时间在下一个作业出现之前完成。但是，该方法很简单，应该可以满足您的需求。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-02-04T09:37:32.037

这看起来是一个很老的线程。但是，我在我的应用程序中需要为不同页面运行多个**倒数计时器**的问题是使用**Ruby Thread**。即使页面被用户关闭，计时器也必须继续运行。

[Ruby 使用 Thread 类可以轻松编写多线程程序。Ruby 线程是一种在代码中实现并行性的轻量级且高效的方法。](http://www.tutorialspoint.com/ruby/ruby_multithreading.htm)我希望这将有助于其他希望在他们的应用程序中实现背景：并行/并发服务的流浪者。同样，Ajax 使每秒调用特定的 Rails [自定义] 操作变得更加容易。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T07:02:09.393

这听起来确实像是您应该运行后台进程而不是应用程序实例（无论您使用的是乘客/杂种），因为这样您的应用程序可以继续做它应该做的事情，服务请求，而后台任务某种，Workling 很好，处理数字运算。我知道这不涉及进步问题，但除非绝对必要，否则我认为这是一个很小的代价。

您可以让用户单击所需的操作，让该操作将请求传递到 Workling 队列，并让它在完成时向用户发送某种通知，可能是电子邮件或其他东西。我不确定它的实用性，只是大声思考，但我的观点是，这似乎真的应该是某种背景任务。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-25T20:13:39.600

> 我的开发机器使用的是 Windows Vista 64 位；但是，我的生产机器是 Ubuntu 8.04 LTS。我应该考虑为我的开发机器切换到 Linux 吗？提出的解决方案是否适用于两者？

您是否考虑过在 Vista 之上的 VM 中运行 Linux？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-02-07T12:37:25.773

对于繁重的后台进程，我建议使用带有[resque-status](https://github.com/quirkey/resque-status)插件的[Resque](https://github.com/resque/resque) gem 。

## 雷斯克

> Resque 是一个 Redis 支持的 Ruby 库，用于创建后台作业，将它们放置在多个队列中，并在以后处理它们。

## 请求状态

> resque-status 是 resque 队列系统的扩展，提供简单的可跟踪作业。

一旦您使用 resque-status 扩展在 Resque 工作人员上运行作业，您将能够获得有关您正在进行的进度和非常容易终止特定进程的能力的信息。查看示例：

```
status.pct_complete #=> 0
status.status #=> 'queued'
status.queued? #=> true
status.working? #=> false
status.time #=> Time object        
status.message #=> "Created at ..." 
```

resque 和 resque-status 也有一个很酷的 Web 界面来与你的工作进行交互，这很酷。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-19T22:27:34.113

有全新的[Growl4Rails](http://www.writebetterbits.com/2009/01/update-to-growl4rails.html) ... 用于此特定用例（以及其他用例）。

[http://www.writebetterbits.com/2009/01/update-to-growl4rails.html](http://www.writebetterbits.com/2009/01/update-to-growl4rails.html)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-19T22:32:39.470

我使用后台作业（[http://codeforpeople.rubyforge.org/svn/bj/trunk/README](http://codeforpeople.rubyforge.org/svn/bj/trunk/README)）来安排任务。我正在构建一个小型管理站点，它允许站点管理员运行各种你和我会从命令行从一个漂亮的 Web 界面运行的东西。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-20T09:13:10.757

我知道您说过您并不担心客户端，但我认为您可能会觉得这很有趣： [Growl4Rails](http://www.writebetterbits.com/2009/01/update-to-growl4rails.html) - 从他们使用的示例来看，它是为您正在做的事情而开发的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-23T03:03:11.730

我以前用过[spawn](http://wiki.github.com/tra/spawn)，肯定会推荐它。

设置起来非常简单（许多其他解决方案都没有），并且运行良好。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-26T04:22:05.837

查看[BackgrounDRb](http://backgroundrb.rubyforge.org/)，它专为您所描述的场景而设计。

我认为它已经存在了一段时间并且非常成熟。您可以监控工作人员的状态。

在与生产环境相同的开发平台上进行开发是一个不错的主意，尤其是在使用 Rails 时。在 VM 中运行 Linux 的建议是一个很好的建议。查看[Sun xVM](http://www.sun.com/software/products/xvm/index.jsp)以获取开源虚拟化软件。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-03-09T20:33:44.217

我个人将 active_messaging 插件与 activemq 服务器（stomp 或 rest 协议）一起使用。这对我们来说非常稳定，每月处理数百万条消息。

# dynamics-crm - 用于访问 Project Server Web 服务的 MS CRM 自定义工作流

> ID：508680
> 
> 赞同：1
> 
> 时间：2009-02-03T20:00:22.310
> 
> 标签：dynamics-crm, crm, dynamics-crm-4, project-server

我正在尝试在 ms crm 4 中创建一个自定义工作流，以便在完成任务后，它将获取任务的一些属性并在时间表上的项目服务器中添加一个条目。我能够访问项目服务器 Web 服务 (PSI) 并从 ac# 控制台应用程序创建一个时间表条目，并且我可以在 crm 中执行与项目服务器无关的其他自定义工作流。使用 Project Server Web 服务 (PSI) 时，我必须引用并包含 3 个 office 项目 dll，但是当我进行自定义工作流插件注册时，我不确定如何让那些在 CRM 中注册。任何想法都会有所帮助。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-11T19:34:16.157

根据我的经验，您要么必须将这些 DLL 部署到 Server\bin 目录，要么使用 ILMerge 之类的工具将它们与您的 DLL 合并，并将其全部注册为一大块。

# .net - ASP.NET Web 应用程序 - 编译 .cs 文件

> ID：508689
> 
> 赞同：1
> 
> 时间：2009-02-03T20:02:04.193
> 
> 标签：.net, asp.net, compilation

我想我从 .NET 2.0 开始就一直在使用网站模型，并且从未回头。现在我在几个项目中使用 Web 应用程序模式。你如何告诉编译器编译项目中的 .cs 文件？我假设您可以这样做，因为较新的 MVC 项目为控制器执行此操作。

我有一个类 RestRouteHandler，它实现了 IRouteHandler 接口，但是因为我认为 .cs 文件没有被编译，所以我不能在我的 Global.asax 中使用它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T20:18:16.220

右键单击解决方案资源管理器中的 .cs 文件，然后单击属性。设置“Build Action”进行编译。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T20:09:09.110

使用 Visual Studio 中的“构建”菜单

# sql - MySQL查询仅返回具有计数的重复条目

> ID：508692
> 
> 赞同：1
> 
> 时间：2009-02-03T20:02:36.923
> 
> 标签：sql, mysql

我有一个`lnk_lists_addresses`用列`list_id`和`address_id`. 我想编写一个查询来报告相同的所有情况`list_id`-`address_id`组合在表中多次出现并计数。

我试过这个...

```
SELECT count(*), list_id, address_id
FROM lnk_lists_addresses
GROUP BY list_id, address_id
ORDER BY count(*) DESC
LIMIT 20 
```

它工作，有点，因为有少于 20 个重复。但是我如何只返回大于 1 的计数？

我尝试`WHERE count(*) > 1`在前后添加“”，`GROUP BY`但出现错误，表明该语句无效。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-03T20:05:24.437

```
SELECT count(*), list_id, address_id
FROM lnk_lists_addresses
GROUP BY list_id, address_id
HAVING count(*)>1
ORDER BY count(*) DESC 
```

结合我的和 Todd.Run 的答案以获得更“完整”的答案。您想使用 HAVING 子句：

[http://dev.mysql.com/doc/refman/5.1/en/select.html](http://dev.mysql.com/doc/refman/5.1/en/select.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T20:06:52.577

您想使用“HAVING”子句。MySQL 手册中解释了它的使用。

[http://dev.mysql.com/doc/refman/5.1/en/select.html](http://dev.mysql.com/doc/refman/5.1/en/select.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T20:06:08.430

```
SELECT count(*) AS total, list_id, address_id
FROM lnk_lists_addresses
WHERE total > 1
GROUP BY list_id, address_id
ORDER BY total DESC
LIMIT 20 
```

如果您命名 COUNT() 字段，您可以稍后在语句中使用它。

编辑：忘记了`HAVING`(>_<)

# apache-flex - Flex：您如何验证 2 个密码字段以确保它们匹配？

> ID：508696
> 
> 赞同：3
> 
> 时间：2009-02-03T20:03:44.080
> 
> 标签：apache-flex, validation

我想使用验证器来确保 Flex 中的 2 个密码字段匹配。我希望验证器像普通的 flex 验证控件一样突出显示表单字段。谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-09T03:14:01.107

`enter code here`我创建了自己的自定义验证器（主要从日期验证器复制）：

```
package validators
{
    import mx.validators.ValidationResult;
    import mx.validators.Validator;

    public class PasswordValidator extends Validator
    {
        // Define Array for the return value of doValidation().
        private var results:Array;

        public function PasswordValidator()
        {
            super();
        }

        public var confirmationSource: Object;
        public var confirmationProperty: String;

        // Define the doValidation() method.
        override protected function doValidation(value:Object):Array {

            // Call base class doValidation().
            var results:Array = super.doValidation(value.password);

            if (value.password != value.confirmation) {
                results.push(new ValidationResult(true, null, "Mismatch",
                "Password Dosen't match Retype!"));

            }

            return results;
        }       

        /**
         *  @private
         *  Grabs the data for the confirmation password from its different sources
         *  if its there and bundles it to be processed by the doValidation routine.
         */
        override protected function getValueFromSource():Object
        {
            var value:Object = {};

            value.password = super.getValueFromSource();

            if (confirmationSource && confirmationProperty)
            {
                value.confirmation = confirmationSource[confirmationProperty];
            }

            return  value;
        }       

    }
} 
```

使用的示例 mxml：

```
<validators:PasswordValidator id="pwvPasswords" required="true" source="{txtPassword}" property="text" confirmationSource="{txtPasswordConfirm}" confirmationProperty="text" trigger="{btnStep2Finish}" /> 
```

这是非常基本的，但它主要是我需要的。它只突出显示密码框，但希望它同时突出显示。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-01-24T23:49:12.320

这是一个更好的自定义验证器，它更通用、更简洁，并且可以很好地与“必需”字段配合使用。

```
 import mx.validators.ValidationResult;
 import mx.validators.Validator;

 public class MatchValidator extends Validator{
  private var _matchSource: Object = null;
  private var _matchProperty: String = null;
  private var _noMatchError: String = "Fields did not match";

  [Inspectable(category="General", defaultValue="Fields did not match")]
  public function set noMatchError( argError:String):void{
   _noMatchError = argError;
  }
  public function get noMatchError():String{
   return _noMatchError;
  }

  [Inspectable(category="General", defaultValue="null")]
  public function set matchSource( argObject:Object):void{
   _matchSource = argObject;
  }
  public function get matchSource():Object{
   return _matchSource;
  }

  [Inspectable(category="General", defaultValue="null")]
  public function set matchProperty( argProperty:String):void{
   _matchProperty = argProperty;
  }
  public function get matchProperty():String{
   return _matchProperty;
  }

  override protected function doValidation(value:Object):Array {

   // Call base class doValidation().
   var results:Array = super.doValidation(value.ours);

   var val:String = value.ours ? String(value.ours) : "";
   if (results.length > 0 || ((val.length == 0) && !required)){
    return results;
   }else{
    if(val != value.toMatch){
     results.length = 0;
     results.push( new ValidationResult(true,null,"mismatch",_noMatchError));
     return results;
    }else{
     return results;
    }
   }
  }  

  override protected function getValueFromSource():Object {
   var value:Object = {};

   value.ours = super.getValueFromSource();

   if (_matchSource && _matchProperty){
    value.toMatch = _matchSource[_matchProperty];
   }else{
    value.toMatch = null;
   }
   return value;
  }
 } 
```

这是一个例子：

```
<components:MatchValidator source="{passwordCheckField}" property="text" matchSource="{passwordField}" matchProperty="text"
    valid="passwordsMatch = true" invalid="passwordsMatch = false" noMatchError="Passwords do not match"/> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-11-18T12:11:16.290

我使用自定义验证规则以不同的方式完成了这项工作。

看看： http: [//martypitt.wordpress.com/2009/08/26/rule-based-asynchronous-validation-in-flex-forms/](http://martypitt.wordpress.com/2009/08/26/rule-based-asynchronous-validation-in-flex-forms/)

它展示了如何进行异步验证（例如，检查服务器上的用户名可用），以及其他不完全适合 flex 开箱即用框架的验证场景，包括两个密码匹配。

例如：

```
<mx:Button label="Register" enabled="{ validationRules.isValid }" />
<validation:ValidationRuleCollection id="validationRules">
      <validation:UsernameIsUniqueValidationRule username="{ txtUsername.text }" targetComponent="{ txtUsername }" />
      <validation:EmailIsUniqueValidationRule email="{ txtEmailAddress.text }" targetComponent="{ txtEmailAddress }" />
      <validation:PasswordsMustMatchValidationRule password1="{ txtPassword.text }" password2="{ txtPasswordConfirm.text }" targetComponent="{ txtPasswordConfirm }" />
      <mx:StringValidator required="true" source="{ txtUsername }" property="text" requiredFieldError="{ ResourceManager.getInstance().getString( ResourceBundles.ERROR_MESSAGES , 'REQUIRED_FIELD_ERROR' )}" />
</validation:ValidationRuleCollection> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-04-15T20:22:14.633

我扩展了 Daniel 的解决方案，还添加了触发匹配源的能力。

```
import flash.events.Event;

import mx.validators.ValidationResult;
import mx.validators.Validator;

public class MatchValidator extends Validator
{
    private var _matchSource: Object = null;
    private var _matchProperty: String = null;
    private var _noMatchError: String = "Fields did not match";

    [Inspectable(category="General", defaultValue="Fields did not match")]
    public function set noMatchError( argError:String):void{
        _noMatchError = argError;
    }
    public function get noMatchError():String{
        return _noMatchError;
    }

    [Inspectable(category="General", defaultValue="null")]
    public function set matchSource( argObject:Object):void{
        removeTriggerHandler();
        _matchSource = argObject;
        addTriggerHandler();
    }
    public function get matchSource():Object{
        return _matchSource;
    }

    [Inspectable(category="General", defaultValue="null")]
    public function set matchProperty( argProperty:String):void{
        _matchProperty = argProperty;
    }
    public function get matchProperty():String{
        return _matchProperty;
    }

    override protected function doValidation(value:Object):Array {

        // Call base class doValidation().
        var results:Array = super.doValidation(value.ours);

        var val:String = value.ours ? String(value.ours) : "";
        if (results.length > 0 || ((val.length == 0) && !required)){
            return results;
        }else{
            if(val != value.toMatch){
                results.length = 0;
                results.push( new ValidationResult(true,null,"mismatch",_noMatchError));
                return results;
            }else{
                return results;
            }
        }
    }  

    override protected function getValueFromSource():Object {
        var value:Object = {};

        value.ours = super.getValueFromSource();

        if (_matchSource && _matchProperty){
            value.toMatch = _matchSource[_matchProperty];
        }else{
            value.toMatch = null;
        }
        return value;
    }

    override public function set triggerEvent(value:String):void
    {
        removeTriggerHandler();
        super.triggerEvent = value;
        addTriggerHandler();
    }

    private function addTriggerHandler():void
    {
        if (_matchSource)
            _matchSource.addEventListener(triggerEvent,triggerHandler);
    }

    private function removeTriggerHandler():void
    {
        if (_matchSource)
            _matchSource.removeEventListener(triggerEvent,triggerHandler);
    }

    private function triggerHandler(event:Event):void
    {
        validate();
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T20:13:30.583

除非您*必须*使用验证器，否则您可以简单地附加一个更改事件处理程序并`errorString`在密码不匹配时设置密码字段的属性。它提供与验证器相同的突出显示。

# file - 你如何备份 Xampp 目录？

> ID：508699
> 
> 赞同：0
> 
> 时间：2009-02-03T20:04:03.503
> 
> 标签：file, backup, xampp, transfer

我想备份我的 Xampp 目录并将其传输到另一台计算机。

是否有捷径可寻？

当我尝试复制它时，它给了我一个限制，即使我当时没有运行 xampp。

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T20:56:43.023

我会说 rsync 将是一个很好的方法，您可以备份整个目录，也可以使用“--files-from =”参数指定包含要备份的列表的文件，又名 htdocs 目录和配置文件。

您可以查看涵盖本地和远程备份的 rsync[示例页面。](http://samba.anu.edu.au/rsync/examples.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T20:58:37.793

确保您已关闭所有服务（apache、mysql、ftp 等）。转到开始->运行->services.msc

# mysql - mysql 只计算连接查询中的不同值

> ID：508707
> 
> 赞同：1
> 
> 时间：2009-02-03T20:06:02.237
> 
> 标签：mysql, count

哇！这是一个奇怪的标题，但我很高兴你在看，因为我找不到另一种说法。

我有一张人员表和一张照片和视频链接表。我把人们加入媒体，当然一个人可以拥有不止一种媒体。

我试图在一个查询中获取前 30 个人及其所有媒体，但是当我说 LIMIT 0,30 时。当然，我只会得到前 30 个媒体文件，可能是 10 个人。

在我进行查询之前，我不知道每个人将拥有多少媒体文件。有没有办法我可以说 LIMIT DISTINCT(uid 0,30)????

或类似的东西？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T20:13:35.560

你可以在你的 MySQL 版本中使用子查询吗？

> ```
> select *
> from media m
> inner join
>      ( select uid
>      from users_tbl
>      limit 0,30) map
>   on map.uid = m.uid
> inner join users_tbl u
>   on u.uid = m.uid 
> ```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T22:15:39.463

FWIW，这是另一个应该返回相同结果的查询：

```
SELECT *
FROM media m INNER JOIN users_tbl u USING (uid)
WHERE u.uid IN (SELECT uid FROM users_tbl ORDER BY uid LIMIT 0,30); 
```

请注意，当您使用 时`LIMIT`，您应该始终使用`ORDER BY`. 否则无法保证您将获得*哪30 个用户。*

# java - 创建 Java 消息对话框（swing/awt/other）的最快方法？

> ID：508723
> 
> 赞同：12
> 
> 时间：2009-02-03T20:10:18.373
> 
> 标签：java, user-interface, swing, dialog, awt

我正在创建一个 Java 应用程序，它将进行一些处理，然后需要显示一条消息以向用户提供反馈。

然而，它似乎非常慢 - 需要两秒钟以上才能返回。

我将源代码剥离到明显的罪魁祸首，这是使用的代码：

```
package SwingPlay;

import javax.swing.JFrame;

public class Dialog
{

    public static void main( String[] args )
    {
        JFrame frame = new JFrame( "DialogDemo" );
    }

} 
```

我从命令行执行这个：

```
java -classpath . SwingPlay.Dialog 
```

正如你所看到的——我什么也没做，只是创建了一个 JFrame，甚至没有显示它。

如果它是相关的，这是我的`java -version`输出：

```
java version "1.6.0_11"
Java(TM) SE Runtime Environment (build 1.6.0_11-b03)
Java HotSpot(TM) Client VM (build 11.0-b16, mixed mode, sharing) 
```

这是（当前）针对 Win XP SP2 运行的。

* * *

所以，第一个问题：为什么这么慢？

更重要的是，我只想立即显示一条简单的消息（GUI，而不是 cmdline）——任何人都可以提供一些代码来做到这一点吗？

* * *

**更新：**

一些背景知识可能会有所帮助：
我正在创建一个应用程序，它将有许多“头”（即不同的用户界面都使用相同的核心类来完成复杂的部分）。
我目前有一个可以正常工作的纯命令行头 - 立即响应。
我还将有一个带有常规点击 GUI 的标准应用程序，并且不要预见这一点会出现问题。
我目前正在处理的是这两者的混合体 - 它将从运行框（或类似的启动器）启动，可能带有参数，并且只需要有效地响应状态消息，可以用按键。

后一个是问题的重点。

虽然我不反对将我现有的命令行版本与 shell 脚本一起使用（尽管认为没有必要！），但现有的答案似乎表明事情对我来说并没有像其他人那样快 - 一个示例对我来说需要 1460 毫秒，而 70 毫秒 - 一个显着的差异。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-03T21:03:25.757

延迟它的原因是因为 Java 是一种解释语言，并且需要时间来启动一个新的 JVM（解释器）

实际上创建框架只需不到几毫秒（在我的机器中大约需要 70 毫秒）。

如果要在 Java 应用程序中使用它，则无需担心。这几乎是瞬时的（您应该为此使用 JDialog 或 JOptionPane ）

如果这不会在 Java 应用程序中使用，并且 2 秒太多（我认为太多了），那么您应该考虑另一种工具来完成这项工作。

这是我在您的代码中测量时间的方法：

```
import javax.swing.JFrame;

public class Dialog {

    public static void main( String[] args ) {
        long start = System.currentTimeMillis();
        JFrame frame = new JFrame( "DialogDemo" );
        System.out.println( "Took: " + (  System.currentTimeMillis() - start   ) );
    }

} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-03T20:36:54.467

我会使用[JOptionPane](http://java.sun.com/javase/6/docs/api/javax/swing/JOptionPane.html)来显示消息。这是一个简单的例子：

```
import javax.swing.*;

public class OptionDemo {
    public static void main(String[] args) throws Exception {
        JOptionPane.showMessageDialog(null, "Hello World");
    }
} 
```

不过，恐怕我无法解释您遇到的延迟。在我的系统上，您的代码片段在 500 毫秒内运行。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-03T20:47:50.887

Java 是错误的工具。设置 JVM 涉及在执行第一行 Java 代码之前在后台发生的很多事情，而且真的没有办法绕过它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T23:57:25.827

你需要使用java来显示消息框吗？如果该框来自您的应用程序之外，那么您可能想要使用其他东西来生成一个对话框。

要制作一个仅从命令行字符串显示消息框的本机 Windows 应用程序，最多只需要几个小时。大多数常见的脚本语言也应该有办法做到这一点。这是某个人通过命令行通过 javascript 提供的示例：

[http://www.snee.com/bobdc.blog/2009/01/displaying-a-message-box-from.html](http://www.snee.com/bobdc.blog/2009/01/displaying-a-message-box-from.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-03T20:24:06.583

此外，创建[AWT Window](http://java.sun.com/j2se/1.5.0/docs/api/java/awt/Window.html)（或者可能是[Frame](http://java.sun.com/j2se/1.5.0/docs/api/java/awt/Frame.html)）而不是[JFrame](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/JFrame.html)会快得多，因为后者必须引入大量额外的类文件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T20:37:14.950

你可以使用 JOptionDialog

```
JOptionPane.showMessageDialog([parent frame], [message], [title], JOptionPane.MESSAGE_TYPE); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-03T20:26:21.400

哦，如果你真的不需要从 Java 显示对话框，你可以考虑使用[KDialog](http://techbase.kde.org/Development/Tutorials/Shell_Scripting_with_KDE_Dialogs)（或者它的 GNOME 对应物）或类似的东西。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-06-28T21:14:37.650

由于您有兴趣加快这一速度，并且由于大部分开销似乎是 JVM 启动开销，因此请查看[Nailgun](http://www.martiansoftware.com/nailgun/)，它旨在通过让 JVM 始终在后台运行来解决缓慢的 JVM 启动问题。在您的情况下，在一次运行之后，Swing 库也将最终被缓存（希望在再运行几次之后也被 JITed），进一步减少开销。

但是，由于后台 JVM，这种方法会导致内存使用量增加，并且还会导致其他问题，因为确定何时关闭它可能并不简单。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-03T20:12:53.813

您可能正在寻找的是[Java 6 中的新 SplashScreen 功能](http://java.sun.com/developer/technicalArticles/J2SE/Desktop/javase6/splashscreen/)。无需等待 JVM 加载（加载任何 VM 总是有成本的），这将预先加载一个屏幕。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-03T21:49:18.423

您是否尝试过通过像[NetBeans](http://profiler.netbeans.org)这样的分析器运行它？如果标准库深处存在瓶颈，那么这是找到它的好方法。

# python - Python 时间老化

> ID：508727
> 
> 赞同：3
> 
> 时间：2009-02-03T20:12:06.920
> 
> 标签：python, datetime

我正在尝试将日期字符串转换为年龄。

字符串就像：“Mon, 17 Nov 2008 01:45:32 +0200”，我需要算出它有多少天了。

我已成功使用以下方法转换日期：

```
>>> time.strptime("Mon, 17 Nov 2008 01:45:32 +0200","%a, %d %b %Y %H:%M:%S +0200")
(2008, 11, 17, 1, 45, 32, 0, 322, -1) 
```

出于某种原因，%z 给了我一个 +0200 的错误，但这并不重要。

我可以使用以下方法获取当前时间：

```
>>> time.localtime()
(2009, 2, 3, 19, 55, 32, 1, 34, 0) 
```

但是如何在不遍历列表中的每个项目并手动执行的情况下从另一个中减去一个？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-03T20:16:48.407

您需要使用模块`datetime`和对象[`datetime.timedelta`](http://docs.python.org/library/datetime.html#datetime.timedelta)

```
from datetime import datetime

t1 = datetime.strptime("Mon, 17 Nov 2008 01:45:32 +0200","%a, %d %b %Y %H:%M:%S +0200")
t2 = datetime.now()

tdelta = t2 - t1 # actually a datetime.timedelta object
print tdelta.days 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-03T20:30:17.350

在 Python 中，`datetime`对象本身就支持减法：

```
from datetime import datetime
age = datetime.now() - datetime.strptime(...)
print age.days 
```

结果是一个[timedelta](http://docs.python.org/library/datetime.html#datetime.timedelta)对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T20:21:39.723

```
from datetime import datetime, timedelta
datetime.now()
datetime.datetime(2009, 2, 3, 15, 17, 35, 156000)
datetime.now() - datetime(1984, 6, 29 )
datetime.timedelta(8985, 55091, 206000)
datetime.now() - datetime(1984, 6, 29 )
datetime.timedelta(8985, 55094, 198000) # my age... 
```

timedelta（天[，秒[，微秒[，毫秒[，分钟[，小时[，周]]]]]]]）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-04T09:24:29.223

如果您不想使用 datetime（例如，如果您的 Python 很旧并且您没有该模块），您可以只使用 time 模块。

```
s = "Mon, 17 Nov 2008 01:45:32 +0200"
import time
import email.utils # Using email.utils means we can handle the timezone.
t = email.utils.parsedate_tz(s) # Gets the time.mktime 9-tuple, plus tz
d = time.time() - time.mktime(t[:9]) + t[9] # Gives the difference in seconds. 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T20:59:42.580

谢谢大家，我最终得到以下内容：

```
def getAge( d ):
    """ Calculate age from date """
    delta = datetime.now() - datetime.strptime(d, "%a, %d %b %Y %H:%M:%S +0200")
    return delta.days + delta.seconds / 86400.0 # divide secs into days 
```

给予：

```
>>> getAge("Mon, 17 Nov 2008 01:45:32 +0200")
78.801319444444445 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-08-21T12:44:32.717

从 Python 3.2 开始，如果提供了指令，则`datetime.strptime()`返回一个感知的日期时间对象：`%z`

```
#!/usr/bin/env python3
from datetime import datetime, timezone, timedelta

s = "Mon, 17 Nov 2008 01:45:32 +0200"
birthday = datetime.strptime(s, '%a, %d %b %Y %H:%M:%S %z')
age = (datetime.now(timezone.utc) - birthday) / timedelta(1) # age in days
print("%.0f" % age) 
```

在较旧的 Python 版本上，可以使用[@Tony Meyer 答案的正确版本：](https://stackoverflow.com/a/510638/4279)

```
#!/usr/bin/env python
import time
from email.utils import parsedate_tz, mktime_tz

s = "Mon, 17 Nov 2008 01:45:32 +0200"
ts = mktime_tz(parsedate_tz(s))   # seconds since Epoch
age = (time.time() - ts) / 86400  # age in days
print("%.0f" % age) 
```

两个代码示例产生相同的结果。

# java - java.awt.HeadlessException - Applet 未显示 - 第 2 部分

> ID：508733
> 
> 赞同：0
> 
> 时间：2009-02-03T20:14:16.167
> 
> 标签：java, applet

这是参考问题 java.awt.HeadlessException - Applet not displayed。 [java.awt.HeadlessException - Applet 未显示](https://stackoverflow.com/questions/445049/java-awt-headlessexception-applet-not-displayed)

在我在 tomcat 的 startup.sh 文件中添加“export DISPLAY=:0.0”后，HeadlessException 消失了。现在，部分代码在作为单独服务器的批处理服务器上运行。在批处理服务器上调用代码时会发生相同的 HeadlessException。当我在批处理服务器的启动文件中添加相同的“export DISPLAY=:0.0”时，异常消失了，但它给批处理服务器上运行的其他（非 java）应用程序带来了问题。这可能是因为我们正在覆盖正在为其他应用程序工作的显示。

接下来我将 JAVA_OPTS="-Djava.awt.headless=true" 导出到批处理服务器的启动文件，但它不起作用。我看到 Sun 的以下链接说代码应该检查无头异常。

[http://java.sun.com/j2se/1.4.2/docs/guide/awt/AWTChanges.html](http://java.sun.com/j2se/1.4.2/docs/guide/awt/AWTChanges.html)

那么捕获无头异常会使其工作吗？喜欢：

```
try {

 //Code that throws headless exception

} catch (HeadlessException e) {

  printStacktrace(); //basically do nothing
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-04T04:52:22.313

您可以捕获该异常，也可以通过首先检查来避免它：

```
if (! java.awt.GraphicsEnvironment.isHeadless()) {
    // code that throws headless exception
} else {
  log.info("Skipping GUI portion")
} 
```

不要在没有人会看到的服务器上设置 DISPLAY，否则您可能会永远等待某人在没有人可以看到的对话框上单击“确定”。

# sharepoint - SharePoint 解决方案部署：如何防止 SP 在升级或收回全局部署的解决方案时重置 IIS？

> ID：508734
> 
> 赞同：2
> 
> 时间：2009-02-03T20:14:24.153
> 
> 标签：sharepoint, moss, wss, wsp

所以我发现通过将 ResetWebServer="FALSE" 属性添加到解决方案清单可以防止 SharePoint 回收任何应用程序池。

但是，当升级最初未指定 ResetWebServer="FALSE" 的解决方案时，或撤回指定 ResetWebServer="FALSE" 的解决方案时，应用程序池仍会被回收。有没有办法防止应用程序池的任何自动回收？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T21:12:43.787

鉴于 MSDN 上的文档（见下文），这似乎是不可能的，请注意，我包括部署解决方案而不是升级解决方案，因为它在下面有效地进行文件替换。我相信由于 IIS 的功能，重新启动/回收是必要的。探索是否要在发生这种情况时进行管理的一个选项是确保所有部署都通过计时器作业完成，并在其影响最小化时执行。

*   [部署解决方案](http://msdn.microsoft.com/en-us/library/aa544500.aspx)

> 最初，解析清单和功能清单以查找程序集和 _layouts 文件，这些文件被复制到适当的位置。功能目录中包含的所有其他文件都将复制到功能目录中。解决方案文件复制到目标计算机后，会为所有前端 Web 服务器安排配置重置；重置然后部署文件并重新启动 Microsoft Internet 信息服务 (IIS)。

*   [撤回解决方案](http://msdn.microsoft.com/en-us/library/aa543958.aspx)

> 在每个前端 Web 服务器上，会发生以下情况：
> 
> *   Microsoft Internet 信息服务 (IIS) 已禁用。
> *   文件从系统中删除。
> *   当用户浏览到一个页面时，IIS 被重新启用并且 Windows SharePoint Services 被重新加载。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T05:12:03.550

您还可以查看“-local”开关。还没有尝试过，但是当您处于负载平衡的情况下，它似乎允许每台服务器部署服务器。

可能是一个很好的引导。

# java - Java 中没有属性语法

> ID：508735
> 
> 赞同：6
> 
> 时间：2009-02-03T20:14:46.087
> 
> 标签：java, syntax, properties

C# 具有声明和使用属性的语法。例如，可以声明一个简单的属性，如下所示：

```
public int Size { get; set; } 
```

也可以在属性中加入一些逻辑，如下所示：

```
public string SizeHex
{
    get
    {
        return String.Format("{0:X}", Size);
    }
    set
    {
        Size = int.Parse(value, NumberStyles.HexNumber);
    }
} 
```

不管有没有逻辑，属性的使用方式与字段相同：

```
int fileSize = myFile.Size; 
```

我对 Java 或 C# 都不陌生——我都用过很多次，而且我总是想念 Java 中的属性语法。我在[这个问题](https://stackoverflow.com/questions/36701/struct-like-objects-in-java)中读到“在 Java 7 或可能永远不会添加属性支持的可能性极小”，但坦率地说，我发现在讨论、论坛、博客、评论和 JSR 中挖掘工作量太大以找出为什么。

所以我的问题是：谁能总结一下为什么 Java 不可能获得属性语法？

*   是因为与其他可能的改进相比，它被认为不够重要吗？
*   是否存在技术（例如与 JVM 相关的）限制？
*   是政治问题吗？（例如*“我已经用 Java 编码 50 年了，我说我们不需要任何 steenkin 属性！”*）
*   这是自行车脱落的情况[吗](http://en.wikipedia.org/wiki/Parkinson%27s_Law_of_Triviality)？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-03T20:25:38.343

我认为这只是 Java 对事物的一般哲学。属性有点“神奇”，Java 的理念是让核心语言尽可能简单，避免像瘟疫一样的魔法。这使 Java 成为几乎任何程序员都可以理解的*通用语言。*它还可以很容易地推断任意隔离的代码在做什么，并提供更好的工具支持。缺点是它使语言更加冗长且缺乏表达力。这不一定是设计语言的正确方法或错误方法，它只是一种权衡。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-03T20:26:10.183

10 年左右的时间里，sun 一直在尽可能地抵制语言的任何重大变化。在同一时期，C# 经历了引人入胜的发展，每个版本都添加了许多新的酷特性。

我认为很久以前火车就留在了 java 中的属性上，它们本来会很好，但是我们有 java-bean 规范。现在添加属性只会使语言更加混乱。虽然 javabean 规范 IMO 远没有那么好，但它必须这样做。在更宏大的计划中，我认为属性并不是那么相关。java 代码中的膨胀是由 getter 和 setter 以外的其他因素引起的。

还有更重要的事情需要关注，例如获得一个体面的关闭标准。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-03T20:30:32.357

C# 中的属性语法只不过是[语法糖](http://en.wikipedia.org/wiki/Syntactic_sugar)。你不需要它，它只是为了方便。Java 人不喜欢语法糖。这似乎是它缺席的充分理由。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-03T20:27:04.220

可能的论点仅基于我不知情的意见

*   C# 中的属性语法是一个丑陋的 hack，因为它将实现模式与语言语法混合在一起
*   这不是真的必要，因为它相当微不足道。
*   它会对任何根据代码行付费的人产生不利影响。

我实际上希望对属性有某种语法糖，因为整个语法往往会混淆概念上非常简单的代码。Ruby for one 似乎毫不费力地做到了这一点。

顺便说一句，我实际上尝试编写一些没有属性访问的中型系统（几十个类），只是因为减少了混乱和代码库的大小。除了不安全的设计问题（在那种情况下我愿意捏造），这几乎是不可能的，因为每个框架、每个库、java 中的每个东西都通过 get 和 set 方法自动发现属性。它们一直伴随着我们，直到非常时间的尽头，有点像小句法训练轮。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-03T20:24:37.813

我会说它反映了语言变化的缓慢性。正如之前的评论者所提到的，对于现在的大多数 IDE，这真的没什么大不了的。但是没有 JVM 不存在的特定原因。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T20:19:42.100

添加到 Java 中可能很有用，但它在列表中的重要性可能不如闭包。

就个人而言，我发现一个体面的 IDE 使这成为一个争论点。IntelliJ 可以为我生成所有的 getter/setter；我所要做的就是将您所做的行为嵌入到方法中。我不认为这会破坏交易。

我承认我对 C# 不了解，所以也许那些了解 C# 的人会否决我。这只是我的看法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-03T22:47:19.260

如果我不得不猜测，我会说它与对语法糖的哲学反对（他们添加了自动装箱，增强的 for 循环，静态导入等 - 所有糖）的关系不大，而不是与向后兼容性的问题有关。至少到目前为止，Java 人员已经非常努力地设计新的语言特性，以保留源代码级的向后兼容性（即为 1.4 编写的代码仍然可以编译和运行，而无需在 5 或 6 中进行修改或超过）。

假设他们引入了属性语法。那么以下是什么意思：

```
myObj.attr = 5; 
```

这取决于您是在谈论添加属性功能之前还是之后编写的代码，并且可能取决于类本身的定义。

我并不是说这些问题无法解决，但我怀疑它们能否以一种干净、明确的语法得到解决，同时保持与以前版本的源代码兼容性。

python 人可能能够摆脱旧代码的破坏，但这不是 Java 的方式......

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-06-27T15:12:52.603

根据 Core Java 的第 2 卷（作者忘记了，但这是一本非常受欢迎的书），语言设计者认为将方法调用隐藏在字段访问语法后面是一个糟糕的主意，因此将其排除在外。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-03T20:28:42.347

这与它们不会更改 Java 中的任何其他内容的原因相同 - 向后兼容性。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-03T20:36:40.270

> *- 是不是因为与其他可能的改进相比，它被认为不够重要？*

这是我的猜测。

> *- 是否存在技术（例如与JVM 相关的）限制？*

不

> *- 是政治问题吗？（例如“我已经用 Java 编码 50 年了，我说：我们不需要任何 steenkin 属性！”）*

最有可能的。

> *- 这是自行车脱落的情况吗？*

呃？

Java 的主要目标之一是保持语言简单。

来自：[维基百科](http://en.wikipedia.org/wiki/Java_(programming_language))

> *Java 抑制了类的几个特性 [...] 以简化语言并防止可能的错误和反模式设计。*

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-03T21:37:38.807

这里有一些逻辑，对我来说，导致不喜欢语言中的属性：

一些编程结构被使用是因为它们存在，即使它们支持不良的编程实践。

设置器意味着可变对象。很少使用的东西。

好的 OO 设计你要求一个对象做一些业务逻辑。属性意味着您正在向它索取数据并自己操作数据。

尽管您可以覆盖 setter 和 getter 中的方法，但很少有人这样做；最终的公共变量也与 getter 完全相同。因此，如果您没有可变对象，那将是一个有争议的问题。

如果您的变量具有与之关联的业务逻辑，则该逻辑通常应在具有该变量的类中。如果没有，为什么它是一个变量？？？它应该是“数据”并位于数据结构中，因此可以通过通用代码进行操作。

* * *

我相信 Jon Skeet 指出 C# 有一种处理这种数据的新方法，数据应该是编译时类型的，但不应该是真正的变量，但是因为我的世界与 C# 世界几乎没有交互，我会相信他的话，这很酷。

另外，我完全接受，根据您的风格和与之交互的代码，您只需要时不时地设置/获取情况。我仍然平均每两个或两个类都有一个 setter/getter，但这不足以让我觉得新的编程结构是合理的。

请注意，我对工作和家庭编程有非常不同的要求。对于我的代码必须与其他 20 个人的代码交互的工作，我相信越结构化和明确越好。在家里，Groovy/Ruby 很好，性能也很好，等等。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-01-28T02:58:04.423

你可能不需要“get”和“set”前缀，为了让它看起来更像属性，你可以这样做：

```
public class Person {
    private String firstName = "";
    private Integer age = 0;

    public String firstName() { return firstName; } // getter
    public void firstName(String val) { firstName = val; } // setter

    public Integer age() { return age; } // getter
    public void age(Integer val) { age = val; } //setter

    public static void main(String[] args) {
        Person p = new Person();

        //set
        p.firstName("Lemuel");
        p.age(40);

        //get
        System.out.println(String.format("I'm %s, %d yearsold",
            p.firstName(),
            p.age());
    }
} 
```

# asp.net - 如何在用户控件上实现 TabIndex

> ID：508736
> 
> 赞同：2
> 
> 时间：2009-02-03T20:14:48.600
> 
> 标签：asp.net, user-controls

我使用几个用户控件以及标准的 ASP.Net 控件来构建我的网络表单。标准控件有一个 TabIndex 属性，可以让我控制控件接收焦点的顺序。我可以为我的用户控件实现这个吗？我的用户控件在视觉上很简单，看起来像一个标准的文本框或下拉列表。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T20:18:27.873

只需在您的用户控件上创建一个公共属性，该属性获取/设置您希望它影响的 ui 控件（文本框等）上的 tabindex 属性。

编辑：如果你调用属性“TabIndex”，你将不得不声明它覆盖

# sql-server - SQL 存储过程是否区分大小写？

> ID：508739
> 
> 赞同：7
> 
> 时间：2009-02-03T20:15:19.317
> 
> 标签：sql-server, stored-procedures, case-sensitive

例如...

```
ALTER PROCEDURE [dbo].[Reports_Dashboard_Get_Sav]   
    -- Add the parameters for the stored procedure here
    @startDate datetime,
    @endDate datetime,
    @companyID int=null

set @days=datediff(m,@startdate,@enddate)
if (@days)=0 
    set @days=1 
```

这不是我的代码，但如果这是区分大小写的，那么 @days 将不会被正确计算，因为 startDate/startdate 和 endDate/enddate 变量不匹配......

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-03T20:20:12.143

它们可以是，取决于您的数据库的排序规则。当您安装 SQL Server 并选择默认排序规则时，您会注意到有一个“区分大小写”复选框。某些排序规则区分大小写，会影响您的查询（和存储过程）。

更糟糕的是，许多供应商不会在具有区分大小写排序规则的服务器上测试他们的产品，这会导致运行时错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T20:17:21.450

不，至少不是 T-SQL...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T20:18:32.880

我记得，它们对 SQL 命令本身不区分大小写，我经常看到它们写成小写。我很确定其余部分也不区分大小写，因为它是 T-SQL 规范的扩展。

# javascript - 在javascript中将上午/下午时间转换为24小时时间的简单方法是什么

> ID：508752
> 
> 赞同：4
> 
> 时间：2009-02-03T20:18:22.243
> 
> 标签：javascript, jquery, time

我一直在玩 jquery，但我遇到了时间问题。我有 3 个时间输入选择框，一个用于小时，一个用于分钟，一个用于子午线。我需要将此时间转换为 24 小时字符串格式，然后将其粘贴到隐藏输入中。

```
var time = "";
time += $("#EventCloseTimeHour option:selected").text();
time += ":" + $("#EventCloseTimeMin option:selected").text() + ":00";
time += " " + $("#EventCloseTimeMeridian option:selected").text();

$("#ConditionValue").val(time); 
```

这给了我“下午 1:30:00”，我需要“13:30:00”。任何快速的javascript时间提示？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-03T20:49:01.650

[tj111](https://stackoverflow.com/users/12605/)建议示例：

```
$("#ConditionValue").val(
    (
        new Date(
            "01/01/2000 " + 
            $("#EventCloseTimeHour option:selected").text() +
            $("#EventCloseTimeMin option:selected").text() + ":00" +
            " " +
            $("#EventCloseTimeMeridian option:selected").text()
        )
    ).toTimeString().slice(0,8))
; 
```

或者您可以使用：

```
hour = hour %12 + (meridian === "AM"? 0 : 12);
hour = hour < 10 ? "0" + hour : hour; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T20:20:52.847

您应该查看原生[JavaScript 日期对象](http://www.w3schools.com/jsref/jsref_obj_date.asp)方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T20:36:18.773

```
var time = "";
var hour = Number($("#EventCloseTimeHour option:selected").text())%12 + ($("#EventCloseTimeMeridian option:selected").text() == 'PM'?12:0)) ;

time +=("00"+String(hour)).slice(-2)+":"+ $("#EventCloseTimeMin option:selected").text(); 
```

这个解决方案的关键是使用条件运算符“a?b:c”，它转换为“if a then b else c”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T21:13:31.680

我得到了几个人的答案。

```
var time = "";
var hour = Number($("#EventCloseTimeHour option:selected").text());
if($("#EventCloseTimeMeridian option:selected").text() == 'PM'){
    hour = String((hour%12) + 12);
}
hour = hour < 10 ? "0" + hour : hour;
time +=hour+":"+ $("#EventCloseTimeMin option:selected").text() + ":00"; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-07-04T06:57:14.507

只是为了添加一个简单的 JS 答案，以下将根据初始字符串的长度格式化时间。如果 h:mm 返回 HH:mm，如果 h:mm:ss 返回 HH:mm:ss。

如果始终需要 HH:mm:ss，如果初始字符串中不存在“:00”的默认秒数，则添加默认秒数很简单。

```
// Change time in h:mm:ss ap to  HH:mm:ss time
// If time missing seconds, returns HH:mm
function timeToHHmm(time) {
  var nums = time.match(/\d+/g);
  var am   = /am/i.test(time);
  nums[0] = ('0' + ((nums[0]%12) + (am? 0 : 12))).slice(-2);
  // If HH:mm:ss required, use following line instead of last
  // return nums.join(':') + (nums.length == 2? ':00' : '');
  return nums.join(':');
}

// Some tests
['2:45am',     // hh:mm only
 '5:15:45pm',  // hh:mm:ss
 '5:15:45 pm', // space before am/pm
 '05:15:45 pm',// leading zero on hour
 '12:02am',
 '12:02 pm',
 '12:02:00am'
 ].forEach(function(time) {
  console.log(time + ' => ' + timeToHHmm(time));
});
```

# silverlight - 属性值继承

> ID：508763
> 
> 赞同：5
> 
> 时间：2009-02-03T20:21:32.593
> 
> 标签：silverlight, dependency-properties

在对 MSDN 和其他来源进行大量搜索之后，我基本上发现“一些”依赖属性确实支持类似于 WPF 的属性值继承。但是，据我所知，没有明确的清单列出哪些属性可以，哪些不可以。例如，我知道字体属性；然而 Horizo​​ntalContentAlignment 没有。我还在这个论坛中看到了另一个线程，它指出 DP 优先级列表不包括值继承（[http://msdn.microsoft.com/en-us/library/cc265148(VS.95).aspx#listing](http://msdn.microsoft.com/en-us/library/cc265148(VS.95).aspx#listing)）。

此外，似乎甚至不可能将可继承的元数据应用于任何自定义 DP，因此 Silverlight 框架似乎已经针对特定属性对其进行了自定义破解。我需要确切知道哪些依赖属性确实支持属性值继承。如果我错过了关于此的明显文章或线程，那么我很抱歉，但我的搜索非常彻底。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T22:32:59.350

你提到字体属性支持这一点，所以我在反射器中做了一些挖掘，发现这很有趣：

文本块

```
public static readonly DependencyProperty FontSizeProperty = DependencyProperty.RegisterCoreProperty(0x40003714, typeof(double)); 
```

控制

```
public static readonly DependencyProperty FontSizeProperty = DependencyProperty.RegisterCoreProperty(0x80003714, typeof(double)); 
```

排队

```
public static readonly DependencyProperty FontSizeProperty = DependencyProperty.RegisterCoreProperty(0x3714, typeof(double)); 
```

所以这三个类都定义了一个 FontSizeProperty 并且使用的 id 看起来非常相似，就好像第一位只是某种标志一样。因此，也许在幕后发生了一些事情，允许您所谓的属性继承，因为框架可能会在这些相似的 dp id 之间传输值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-14T14:37:51.567

请参阅 MaxHeight （不继承父值）和 FontSize （如您所描述的那样传播）的“依赖属性信息”部分：

[最大高度](http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement.maxheight.aspx)

[字体大小](http://msdn.microsoft.com/en-us/library/system.windows.controls.accesstext.fontsize.aspx)

* * *

从[MSDN 网页](http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement.maxheight.aspx)：

属性值继承

元素可以从树中的父级继承依赖属性的值。

笔记：

*属性值继承行为并非对所有依赖属性全局启用，因为继承的计算时间确实会对性能产生一些影响。属性值继承通常仅对特定场景表明属性值继承是合适的属性启用。**您可以通过查看 SDK 参考中该依赖属性的 Dependency Property Information 部分来确定依赖属性是否继承**。*

* * *

# batch-file - 如何告诉 forfiles 在 PATH 中执行命令？

> ID：508779
> 
> 赞同：7
> 
> 时间：2009-02-03T20:26:42.740
> 
> 标签：batch-file, cmd, forfiles

在以下 Windows Server 2k3 批处理命令中，我遗漏了一些关于转义字符串或空格的内容（很明显？）。

```
FORFILES -m *.wsp -c "CMD /C C:\Program^ Files\Common^ Files\Microsoft^ Shared\web^ server^ extensions\12\bin\stsadm.exe^ -o^ addsolution^ -filename^ @FILE" 
```

导致以下错误

```
'C:\Program Files\Common Files\Microsoft Shared\web server extensions\12\bin\stsadm.exe -o addsolution -filename "foobar.wsp"' is not recognized as an internal or external command,operable program or batch file. 
```

但我不知道为什么。我正在研究[Simon Sheppard 先生的精美文档](http://www.ss64.com/nt/forfiles.html)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-03T21:17:08.363

路径需要被引用，并且引用必须被转义。

```
FORFILES -m *.wsp -c "CMD /C ^0x22C:\Program^ Files\Common^ Files\Microsoft^ Shared\web^ server^ extensions\12\bin\stsadm.exe^0x22 -o^ addsolution^ -filename^ @FILE" 
```

一位同事建议将十六进制用于“，我最终发现该十六进制需要转义。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-07T01:35:02.200

另一个可能的答案是使用通过 dir /X 获得的旧 8.3 名称。

像：C:\PROGRA~1 而不是 C:\Program Files。

# text-to-speech - 如何在使用 SSML 说话时跳过部分文本

> ID：508790
> 
> 赞同：5
> 
> 时间：2009-02-03T20:29:07.417
> 
> 标签：text-to-speech, ssml

是否有一些 SSML 标签等，以从说话中删除特定的文本行。是的，我知道我可以使用字符串函数将其删除，然后再将其发送到语音合成器。但我的问题是，有没有办法标记或标记某些文本，使其无法播放。我正在为这个问题寻找一些基于 XML 的解决方案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-24T23:27:23.447

方法有很多，你应该弄清楚你想要完成什么。

也许其中之一会帮助你：

```
 1\. standard XML comment <!-- -->
   2\. <sub alias=" "> your text </sub>
   3\. <audio src='short_silence.wav'> your text </audio>
   4\. <prosody volume='silent'> your text </prosody> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-10T02:07:37.153

快速查看[W3C 的 SSML 文档](http://www.w3.org/TR/speech-synthesis/)，我发现了[韵律](http://www.w3.org/TR/speech-synthesis/#edef_prosody)元素。

看起来您可以通过将音量设置为 0 并将持续时间设置为非常小的值来跳过该部分。

将音量设置为零应该会抑制音频输出，但“阅读”该部分可能需要与大声朗读一样的时间。如果您也设置了持续时间，您应该能够基本上“跳过”该部分（快速默读）。

你必须尝试看看这是否有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-07T04:46:12.743

我想知道 XML 注释是否是您想要完成的有效解决方案：

```
<!-- <say-as interpret-as="telephone" format="39">+39.347.7577577</say-as> --> 
```

或者：

```
<say-as interpret-as="telephone" format="39"><!-- +39.347.7577577 --></say-as> 
```

希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-08-16T01:48:08.220

使用元标记可能会提供一些解决方案。

```
<speak>This is spoken <meta  content="this is not spoken"/> </speak> 
```

# mysql - MySQL 查询 GROUP BY 日/月/年

> ID：508791
> 
> 赞同：740
> 
> 时间：2009-02-03T20:29:19.177
> 
> 标签：mysql, sql, date, datetime, group-by

是否可以进行简单的查询来计算我在确定的时间段内（例如一年、一个月或一天）有多少记录，有一个`TIMESTAMP`字段，例如：

```
SELECT COUNT(id)
FROM stats
WHERE record_date.YEAR = 2009
GROUP BY record_date.YEAR 
```

甚至：

```
SELECT COUNT(id)
FROM stats
GROUP BY record_date.YEAR, record_date.MONTH 
```

要有月度统计。

谢谢！

* * *

## 回答 #1

> 赞同：1146
> 
> 时间：2009-02-03T20:33:38.717

```
GROUP BY YEAR(record_date), MONTH(record_date) 
```

查看 MySQL 中的[日期和时间函数](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_month)。

* * *

## 回答 #2

> 赞同：267
> 
> 时间：2011-04-23T19:33:05.920

```
GROUP BY [DATE_FORMAT](http://dev.mysql.com/doc/refman/4.1/en/date-and-time-functions.html#function_date-format)(record_date, '%Y%m')
```

* * *

***注意**（主要是给潜在的反对者）。目前，这可能不如其他建议有效。尽管如此，我还是把它作为一种替代方案，也可以作为一种替代方案，它可以帮助我们了解其他解决方案的速度有多快。（因为在你看到区别之前，你无法真正区分快与慢。）此外，随着时间的推移，可以对 MySQL 的引擎进行关于优化的更改，以便在某些情况下（也许不是这样）做出这个解决方案遥远的）未来点，在效率上与大多数其他人相当。*

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2011-10-11T03:44:25.897

试试这个

```
SELECT COUNT(id)
FROM stats
GROUP BY EXTRACT(YEAR_MONTH FROM record_date) 
```

[EXTRACT(unit FROM date)](http://dev.mysql.com/doc/refman/5.5/en/date-and-time-functions.html#function_extract)函数更好，因为使用较少的分组并且该函数返回一个数字值。

分组时的比较条件将比 DATE_FORMAT 函数（返回字符串值）更快。尝试使用为 SQL 比较条件（WHERE、HAVING、ORDER BY、GROUP BY）返回非字符串值的函数|字段。

* * *

## 回答 #4

> 赞同：49
> 
> 时间：2011-04-23T17:52:41.710

我尝试使用上面的“WHERE”语句，我认为它是正确的，因为没有人纠正它，但我错了；经过一番搜索，我发现这是 WHERE 语句的正确公式，因此代码如下所示：

```
SELECT COUNT(id)  
FROM stats  
WHERE YEAR(record_date) = 2009  
GROUP BY MONTH(record_date) 
```

* * *

## 回答 #5

> 赞同：38
> 
> 时间：2013-06-09T09:17:00.857

如果您的搜索时间超过几年，并且您仍想按月分组，我建议：

**版本#1：**

```
SELECT SQL_NO_CACHE YEAR(record_date), MONTH(record_date), COUNT(*)
FROM stats
GROUP BY DATE_FORMAT(record_date, '%Y%m') 
```

**版本 #2**（更高效）**：**

```
SELECT SQL_NO_CACHE YEAR(record_date), MONTH(record_date), COUNT(*)
FROM stats
GROUP BY YEAR(record_date)*100 + MONTH(record_date) 
```

[我在一张有 1,357,918 行 ( innodb](/questions/tagged/innodb "显示标记为“innodb”的问题") )的大表上比较了这些版本，第二个版本似乎有更好的结果。

**版本 1** *（平均 10 次执行）*：1.404 秒
**版本 2** *（平均 10 次执行）*：0.780 秒

（`SQL_NO_CACHE`添加键以防止 MySQL 缓存到查询。）

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2014-01-18T10:26:47.433

如果您想过滤特定年份（例如 2000 年）的记录，请`WHERE`像这样优化子句：

```
SELECT MONTH(date_column), COUNT(*)
FROM date_table
WHERE date_column >= '2000-01-01' AND date_column < '2001-01-01'
GROUP BY MONTH(date_column)
-- average 0.016 sec. 
```

代替：

```
WHERE YEAR(date_column) = 2000
-- average 0.132 sec. 
```

结果是针对包含 300k 行和日期列索引的表生成的。

至于`GROUP BY`条款，我对照上述表格测试了三个变体；结果如下：

```
SELECT YEAR(date_column), MONTH(date_column), COUNT(*)
FROM date_table
GROUP BY YEAR(date_column), MONTH(date_column)
-- codelogic
-- average 0.250 sec.

SELECT YEAR(date_column), MONTH(date_column), COUNT(*)
FROM date_table
GROUP BY DATE_FORMAT(date_column, '%Y%m')
-- Andriy M
-- average 0.468 sec.

SELECT YEAR(date_column), MONTH(date_column), COUNT(*)
FROM date_table
GROUP BY EXTRACT(YEAR_MONTH FROM date_column)
-- fu-chi
-- average 0.203 sec. 
```

最后一位是获胜者。

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2011-10-10T05:16:36.397

如果要在 MySQL 中按日期分组，请使用以下代码：

```
 SELECT COUNT(id)
 FROM stats
 GROUP BY DAYOFMONTH(record_date) 
```

希望这可以为那些将要找到这个线程的人节省一些时间。

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2017-09-07T13:31:43.320

完整而简单的解决方案，具有类似性能但更短且更灵活的替代方案，目前处于活动状态：

```
SELECT COUNT(*) FROM stats
-- GROUP BY YEAR(record_date), MONTH(record_date), DAYOFMONTH(record_date)
GROUP BY DATE_FORMAT(record_date, '%Y-%m-%d') 
```

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2016-11-30T18:37:34.657

您可以在 GROUP BY 中简单地执行 Mysql [DATE_FORMAT()函数。](http://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html#function_date-format)在某些情况下，您可能需要添加一个额外的列以增加清晰度，例如记录跨越几年，然后同一个月出现在不同的年份。这里有很多选项可以自定义。请在开始之前阅读此内容。希望它对你很有帮助。这是您理解的示例查询

```
SELECT
    COUNT(id),
    DATE_FORMAT(record_date, '%Y-%m-%d') AS DAY,
    DATE_FORMAT(record_date, '%Y-%m') AS MONTH,
    DATE_FORMAT(record_date, '%Y') AS YEAR

FROM
    stats
WHERE
    YEAR = 2009
GROUP BY
    DATE_FORMAT(record_date, '%Y-%m-%d '); 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2013-11-22T00:01:38.940

如果您想获得按最近一个月排序的每年每月行数的月度统计数据，请尝试以下操作：

```
SELECT count(id),
      YEAR(record_date),
      MONTH(record_date) 
FROM `table` 
GROUP BY YEAR(record_date),
        MONTH(record_date) 
ORDER BY YEAR(record_date) DESC,
        MONTH(record_date) DESC 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2015-05-22T06:32:33.100

以下查询在 Oracle Database 12c 版本 12.1.0.1.0 中对我有用

```
SELECT COUNT(*)
FROM stats
GROUP BY 
extract(MONTH FROM TIMESTAMP),
extract(MONTH FROM TIMESTAMP),
extract(YEAR  FROM TIMESTAMP); 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2014-07-30T10:30:14.110

我更喜欢像这样优化一年组选择：

```
SELECT COUNT(*)
  FROM stats
 WHERE record_date >= :year 
   AND record_date <  :year + INTERVAL 1 YEAR; 
```

这样，您只需将年份绑定一次，例如`'2009'`，使用命名参数，而无需担心单独添加`'-01-01'`或传入`'2010'`。

另外，大概我们只是在计算行数，`id`而不是`NULL`，我更`COUNT(*)`喜欢`COUNT(id)`。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-06-04T19:55:41.617

`.... group by to_char(date, 'YYYY')`--> 1989

`.... group by to_char(date,'MM')` -->05

`.... group by to_char(date,'DD')` --->23

`.... group by to_char(date,'MON')` --->五月

`.... group by to_char(date,'YY')` --->89

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-07-31T13:09:02.780

这是另一种方法。这使用 [MySQL 的 LAST_DAY() 函数][1] 将每个时间戳映射到其月份。如果`record_date`.

```
 SELECT LAST_DAY(record_date) month_ending, COUNT(*) record_count
    FROM stats
   WHERE record_date >= '2000-01-01'
     AND record_date <  '2000-01-01' + INTERVAL 1 YEAR
   GROUP BY LAST_DAY(record_date) 
```

如果您想要每天的结果，请`DATE(record_date)`改用。

如果您希望按日历季度获得结果，请使用`YEAR(record_date), QUARTER(record_date)`.

这是一篇文章。[https://www.plumislandmedia.net/mysql/sql-reporting-time-intervals/](https://www.plumislandmedia.net/mysql/sql-reporting-time-intervals/) [1]：[https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions。 html#function_last-day](https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_last-day)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-01-26T12:37:53.413

我想每天得到类似的数据，经过一番实验，这是我能找到的最快的我的场景

```
SELECT COUNT(id)
FROM stats
GROUP BY record_date DIV 1000000; 
```

如果您想每月拥有它，请添加额外的零 (00) 从“使代码可读”的角度来看，我不建议这样做，它也可能会在不同的版本中中断。但在我们的案例中，与我测试的其他一些更清晰的查询相比，这花费的时间不到一半。

这是一个 MySQL 答案（因为 MySQL 在问题中被标记）并且在手册[https://dev.mysql.com/doc/refman/8.0/en/date-and-time-type-conversion.html中有详细记录](https://dev.mysql.com/doc/refman/8.0/en/date-and-time-type-conversion.html)

# javascript - 如何避免使用基于 YUI 的 EditorGridPanel 和 ColumnTree 替代品的 EXTjs？

> ID：508796
> 
> 赞同：1
> 
> 时间：2009-02-03T20:30:16.820
> 
> 标签：javascript, extjs, yui, yui-datatable

在我的工作中有一些关于使用 Jack Slocum 的 EXTjs 库作为 YUI（已经在使用）的扩展来开发项目的讨论。如果可能的话，我想帮助避免对 EXTjs 的商业许可模型的依赖。

EXTjs 所需的两个主要功能是 EditorGridPanel 和 ColumnTree。

据我所知，自 2.6.0 以来，YUI 似乎已将 EditorGridPanel 功能添加到其 DataGrid 中。使用 YUI 的内置功能是否有一些重要的警告？关于 EditorGridPanel，还有什么更巧妙的方法吗？

至于 ColumnTree... 我没有看到任何简单的 YUI 替代此功能集。YUI 中是否有一些我没有看到的东西？现在 YUI 几乎没有使用，还有其他好的选择吗？

是否最好硬着头皮为这种功能支付 EXTjs（并处理商业许可证依赖）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-04T01:47:18.693

我一直在寻找像你这样的 ExtJS 替代品。我打算使用框架开发一个基于 Web 的应用程序，以避免浪费宝贵的时间。

你太近了，找不到正确的页面，这里是：[ [ExtJS 的替代品是什么？](https://stackoverflow.com/questions/200284/what-are-alternatives-to-extjs])

首先阅读上面的文章，然后您可能想查看其他链接：

**BackBase** [ [http://demo.backbase.com/explorer/]](http://demo.backbase.com/explorer/]) [ [http://demo.backbase.com/layouts/]](http://demo.backbase.com/layouts/]) [ [http://demo.backbase.com/layouts/layout7/index.html]](http://demo.backbase.com/layouts/layout7/index.html])

**jQuery** [ [http://ui.jquery.com/home]](http://ui.jquery.com/home])

**qooxdoo** [ [http://qooxdoo.org/][http://demo.qooxdoo.org/current/demobrowser/][http://ui.jquery.com/themeroller/](http://qooxdoo.org/]) []](http://demo.qooxdoo.org/current/demobrowser/]) _ _ [_](http://ui.jquery.com/themeroller/])

祝你好运

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-04T02:31:13.347

My employer recently went through a similar evaluation with regard to the EXT widget library. Our criteria were slightly different in that we were looking for a widget library that would plug into GWT and provide a more polished widget set than those provided by the default GWT implementation. After a month of evaluation, our team concluded that the EXT license fees are a small price to pay for the functionality gained. Again, we're not using the raw javascript library, but we have been very pleased with GXT. In my opinion the library is a bit under-documented but it does work solidly across different browsers. One thing for sure, their editor grid is very slick.

# c# - .Net C# 设计视图错误

> ID：508801
> 
> 赞同：2
> 
> 时间：2009-02-03T20:31:10.580
> 
> 标签：c#, .net, treeview

我对 Treeview 进行了子类化，并在实例化时加载了一个新的 ImageList（以及相关的图像）。

每当我切换到设计器视图时，它也会尝试运行此代码，但是图像不在设计器的路径中，因此它崩溃了。我最终进行了修改以查看当前目录是否为“Visual Studio”，然后什么也不做……但这太难看了。

我发现这发生在其他事情上。如果控件在加载/初始化期间尝试使用仅在程序运行时可用的对象，则设计视图无法调出控件。

但是有没有办法解决这个问题？

我想我希望的是（仅）对 Designer 进行尝试/捕获，并能够忽略我知道会发生的一些错误（如 FileNotFoundException 等）。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T20:34:18.420

继承自的所有内容`System.Windows.Forms.Control`都有一个`DesignMode`属性，该属性返回一个布尔值，指示您是否处于设计模式。您可以使用它来确定何时/何时不加载外部资源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T20:36:14.360

通常最好将这些资源的加载移动到 OnLoad 的覆盖，因为它们很少在构造时直接需要。这解决了您看到的问题，并意味着只有至少显示一次的树才能执行这些额外的资源加载步骤。

否则，您可以在设计时通过检查`DesignMode`属性并采取相应措施来排除这些步骤。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T21:12:39.840

感谢您为我指出正确的方向。

我曾尝试注册到 OnLoad 事件，但是当设计视图出现时会触发该事件，所以这对我来说不太有效（我做错了什么吗？）。

无论如何，我对 DesignMode 属性进行了更多研究。它只能用于控件，有时您的对象甚至可能不是控件。

所以这是我更喜欢的答案：

```
if (LicenseManager.UsageMode == LicenseUsageMode.Designtime) {
    // design-time stuff
} else {
    // run-time stuff
} 
```

[在这里](http://www.csharp-architect.com/designmodewinformsissue.aspx)找到它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T21:32:43.450

如果您在设计器中显示带有图像样本的控件库或与其他设计器功能挂钩，那么这是一个很好的模式，但作为一种开发模式，我不确定它是否非常有效。

我建议将您的“业务逻辑”（在这种情况下将某些图像加载到树视图中）转移到树视图控件的范围之外。在您的情况下，我会将逻辑放在控件所在表单的 Load 事件中：

```
public void Load(object sender, EventArgs e)
{
    string path = "c:\somePath\toAwesome\Images";
    myFunkyTreeView.AddImages(path);
} 
```

对于较大的应用程序，我个人认为您甚至希望将逻辑从表单本身中移出，但这是有争议的措施，因为它需要额外的管道来权衡它提供的灵活性。

# javascript - 作为原型用户，我应该注意哪些 jQuery 烦恼？

> ID：508802
> 
> 赞同：6
> 
> 时间：2009-02-03T20:31:22.887
> 
> 标签：javascript, jquery, frameworks, prototypejs

我们正在考虑将我们的网站从 Prototype 切换到 jQuery。由于对 Prototype 非常熟悉，我很清楚 Prototype 的一些限制或烦人的事情。

我对 jQuery 用户的问题是：在使用 jQuery 一段时间后，你有什么挫败感？jQuery 是否有一些事情让您考虑切换（返回）到 Prototype？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T20:36:40.223

我认为唯一让我感动的是，当我对单个元素进行选择查询时，我必须记住它返回一个元素数组，即使我知道只有一个元素。通常，这没有任何区别，除非您想直接与元素交互而不是通过 jQuery 方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T20:49:31.710

可能我遇到的唯一真正的问题是 $(this) 范围问题。例如，如果您使用内置的 JQuery .each() 函数对元素和子元素进行嵌套 for 循环，那么 $(this) 指的是什么？在这种情况下，它指的是最内部的范围，它应该是，但它并不总是预期的。

简单的解决方案是在进一步钻入链之前将 $(this) 缓存到变量中：

```
$("li").each(function() {
    // cache this
    var list_item = $(this);
    // get all child a tags
    list_item.find("a").each(function() {
        // scope of this now relates to a tags
        $(this).hide("slow");
    });
}); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T20:35:50.537

（我能想到的唯一一件事是，这是元素而不是`$("...").each(function)`-calls 中的 jQuery 对象，因为`$(element)`它更常用，然后只是元素。而那个极其次要的事情就是它。

上面的例子（简化了，我知道还有其他更好的方法可以做到这一点，我现在想不出更好的例子）：

```
// Make all divs that has foo=bar pink.
$("div").each(function(){
  if($(this).attr("foo") == "bar"){
    $(this).css("background", "pink");
  }
}); 
```

`each`是一个以函数为参数的函数，该函数为每个匹配元素调用一次。在传递的函数中，`this`指的是实际浏览器的 DOM 元素，但我发现你经常会想在每个元素上使用一些 jQuery 函数，因此不得不使用`$(this)`. 如果将其设置为`$(this)`is，您将获得更短的代码，并且您仍然可以使用`this.get(0)`. 现在我明白了事情是这样的原因，即编写`$(this)`而不是这个，几乎没有那么麻烦，如果你可以用 DOM 元素做你想做的事情，它的方式比它可以的方式更快已经，并且在您想要的情况下，另一种方式不会更快`$(this)`。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T20:40:15.507

我的两个痛点是支架地狱，可能会变得非常混乱

```
$('.myDiv').append($('<ul />').append($('<li />').text('content'))); 
```

我的另一个常见问题与在 jQuery 中使用 JSON 有关，我总是错过最后一个逗号，

```
$('.myDiv').tabs({ option1:true, options2:false(, woops)}); 
```

最后，我已经使用 jQuery 大约 6 个月了，我认为我永远不会回到原型。我非常喜欢 jQuery，他们使用的许多技巧帮助我学到了很多东西。我喜欢的一个很酷的技巧是使用字符串文字进行方法调用，我从来没有真正用原型做太多。

```
$('.myDiv')[(add ? 'add' : 'remove') + 'Class']('redText'); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-03T21:33:05.337

我不认为有任何真正的陷阱，甚至任何挥之不去的烦恼。这里的其他答案似乎证实了这一点 - 问题只是由 jQuery 鼓励的 API 略有不同和 JavaScript 编码风格不同引起的。

几年前我开始使用 Prototype 并发现它是一个启示。如此强大，如此优雅。几个月后，我试用了 jQuery，发现了真正的力量和优雅。我不记得有任何烦恼。现在我又回到了使用 Prototype 的项目上，感觉就像退了一步（公平地说，我们使用的是 Prototype 1.5.1）。

如果你颠倒了这个问题——“作为一个 jQuery 用户，我应该注意哪些 Prototype 烦恼？” - 你会得到更多的答案。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T20:37:58.037

没有。纳达。奈特。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-02-03T20:52:16.573

**。每个：**

jQuery（你需要索引，即使你没有使用它）：

```
$.each(collection, function(index, item) {
  item.hide();
}); 
```

原型（您通常使用该项目，因此您可以省略索引）：

```
collection.each(function(item) {
  item.hide();
}); 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-02-03T21:10:52.497

如果您正在执行大量 DOM 操作，这真的只是一个烦恼。PrototypeJs 自动将其 API 添加到 DOM 元素中，因此这在prototypejs 中有效（jQuery 当然不这样做）：

```
var el = document.createElement("div");
el.addClassName("hello"); // addClassName is a prototypejs method implemented on the native HTMLElement 
```

即使没有通过 $() 函数运行本机元素。

PS：应该注意这在IE中不起作用。

# windows - Windows 中的虚拟 COM 端口 - 传真模拟器

> ID：508810
> 
> 赞同：5
> 
> 时间：2009-02-03T20:34:22.040
> 
> 标签：windows, fax

我有一个 Windows 应用程序，它利用第 3 方工具 ( [FaxMan](http://data-tech.com/products/fax.aspx) ) 通过连接到 PC 的 COM 端口发送传真。为了对我的应用程序进行压力测试，我想创建一些假装连接了传真调制解调器的虚拟 COM 端口。然后我想“欺骗”发送传真，而不实际发送任何东西。虚拟 COM 端口需要像发送传真一样响应标准 AT 命令。欺骗失败的能力将是一个额外的好处。

我的第一个想法是使用虚拟 COM 端口驱动程序重定向到 telnet 或其他 TCP 会话 - 然后我可以拥有一个假装通过传真动作的 TCP 服务器。但是，如果存在组件，我很乐意为组件付费。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T21:06:23.127

我在这个问题上工作了几年，开发了一个 LAN 传真产品。我怀疑你能否做好。

开发虚拟 COM 驱动程序意味着开发内核驱动程序（除非您可以购买现成的）：这是可行的（我做到了），但我猜它的麻烦远大于它的价值（如果它值得我会感到惊讶你的时间）。

另一个问题是有多种传真调制解调器和传真调制解调器标准（你说你希望模仿一个足以欺骗 FaxMan）。

另一个（基本）问题是更简单的（非纠错）传真协议是（硬）**实时**协议：传真调制解调器上有一些（或多或少）缓冲，但连接到传真调制解调器的 PC不能承受发送时欠载或接收时超载...这意味着通过 telnet（使用 TCP 计时器和缓冲区）重定向此流量要么在最坏的情况下中断传真会话（FaxMan 将超时），要么在最好的情况下意味着您的测试不能代表真实世界（非模拟）的性能。

无论如何，您要对什么进行压力测试：您的应用程序，还是第三方 FaxMan？

我建议最便宜的解决方案和最真实的测试是使用真实的硬件：真实的 COM 端口、真实的传真调制解调器和真实的（或者，可能是模拟的）电话线。

* * *

**编辑以回答迈克尔回答中评论中的问题**

> 假设数据的传输是一个小问题（例如，因为您可以简单地将两个串行端口背靠背连接），那么编写模拟传真调制解调器的软件是一个小问题吗？

它可能很小：如果您的负载测试只是“将传真数据发送到比特桶”，那么您的模拟调制解调器大多只需要对看起来像 AT 命令的每个/任何东西响应“OK”，以及对各种其他响应特定于传真的 AT+F_whatever_ 命令。但这是一个相当低保真度，而不是非常严格的测试。

> 这很简单——但是传真数据传输中不涉及一些协议吗？还是该协议只是 AT 命令集的变体，而欺骗“OK”就是它的全部内容？老实说，我不知道，但我认为会有一个更复杂的协议。

电话协议的名称类似于“T.4”和“T.30”。PC-to-faxmodem 协议通常是一种称为“1 类传真”或“2 类传真”的协议。后者（“2 类”或“2.0 类”）是两者中的更高级别：更多的 ASCII 和更少的二进制数据，对时间不那么敏感（1 类对 10 秒的毫秒 iirc 敏感），因为它封装了/比第 1 类包含更多的底层 T.30 协商；它由扩展的 AT 命令（即 AT+F_something_ 命令及其响应）以及二进制编码传真图像数据的转储组成。

一些响应不仅仅是“OK”（即它们代表可用/协商的传真会话参数），而且（在第 2 类而不是第 1 类中）它们是 ASCII 编码而不是二进制，所以一点也不难.

> 必须有某种握手，对吧？否则，一台普通的旧传真机在加载新页面时可能会丢失大量数据。

*是的，页面之间*（即每页之前）有一些握手（“我现在可以发送吗？” ）。不测试时间的负载测试仿真只会响应“是的，继续（我只会将数据转储到位桶中，甚至不看它，所以我在乎什么）”握手询问。

为了在 PC-dumps-image-data-to-the-modem 结束时响应 OK，仿真还必须观察`<DLE><ETX>`和的二进制图像数据（它从 PC 获取） 。`<DLE><DLE>`

我不知道 FaxMan 应用程序中可能内置了哪些计时器（您是否可能需要在模拟响应中添加人为延迟，以防止 FaxMan 意识到响应异常快）：也许不是，但也许。

页面内可能有也可能没有任何握手：

*   对于较旧的传真机/传真协议，没有：相反，设备在页面之前协商“传真会话参数”，包括波特率：它们协商两端都能够支持的同步波特率。这（同步处理整页数据的能力）是为什么它是硬实时协议的一部分。
*   较新的传真机/传真协议支持在每个页面内进行“纠错”：页面以较小的（但仍然是同步的）块发送：并且每个块都得到确认，或者 NAK 并重新传输。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T22:36:43.790

我认为[ChrisW 的建议](https://stackoverflow.com/questions/508810/virtual-com-ports-in-windows-fax-emulator/508897#508897)是合理的——尤其是获得电话线模拟器——它们并不太贵，而且在我做调制解调器驱动程序时非常有用。

也就是说，有一个开源驱动程序包（根据他们的说法）可以让您设置虚拟 com 端口对：[http ://com0com.sourceforge.net/](http://com0com.sourceforge.net/)

您可以将 FaxMan 应用程序连接到一个 COM 端口，然后连接一个传真“模拟器”来处理 AT 命令集以及您要测试的传真协议中的任何内容。这听起来像你在找什么 - 但是......

1.  我不知道 com0com 驱动程序的工作情况如何——我什至从来没有下载过它们，更不用说尝试了（我不确定我是否应该发布这个答案......）
2.  我不知道编写传真模拟会涉及多少工作。我想这不是一个小任务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T08:17:45.210

虚拟调制解调器：[http ://www.eltima.com/products/virtual-modem-pro/](http://www.eltima.com/products/virtual-modem-pro/)

# python - python的httplib的替代品？

> ID：508817
> 
> 赞同：11
> 
> 时间：2009-02-03T20:36:21.410
> 
> 标签：python, http, curl, twisted

我有一个 python 客户端，它通过标准库的 httlib 推送大量数据。用户抱怨应用程序很慢。我怀疑这可能部分是由于我使用的 HTTP 客户端。

我可以通过用其他东西替换 httplib 来提高性能吗？

我已经看到twisted 提供了一个HTTP 客户端。与他们的其他协议产品相比，它似乎非常基础。

PyCurl 可能是一个有效的替代方案，但它的使用似乎非常不符合 Python 风格，另一方面，如果它的性能非常好，那么我可以忍受一些非 Python 风格的代码。

因此，如果您有更好的 Python HTTP 客户端库的经验，请告诉我。我想知道您对 httplib 相关性能的看法以及您对实现质量的看法。

UPDATE 0：我对httplib的使用其实是非常有限的——替换需要做到以下几点：

```
conn = httplib.HTTPConnection(host, port)
conn.request("POST", url, params, headers)
compressedstream = StringIO.StringIO(conn.getresponse().read()) 
```

就是这样：没有代理、重定向或任何花哨的东西。这是普通的 HTTP。我只需要能够尽可能快地做到这一点。

更新 1：我坚持使用 Python2.4，并且正在使用 Windows 32。请不要告诉我使用 httplib 的更好方法 - 我想了解 httplib 的一些替代方案。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-03T20:44:37.213

通常，当我遇到 httplib 的性能问题时，问题不在于 httplib 本身，而在于我如何使用它。以下是一些常见的陷阱：

(1) 不要为每个 Web 请求建立新的 TCP 连接。如果您向同一台服务器发出大量请求，而不是这种模式：

```
    conn = httplib.HTTPConnection("www.somewhere.com")
    conn.request("GET", '/foo')
    conn = httplib.HTTPConnection("www.somewhere.com")
    conn.request("GET", '/bar')
    conn = httplib.HTTPConnection("www.somewhere.com")
    conn.request("GET", '/baz')

```

改为这样做：

```
    conn = httplib.HTTPConnection("www.somewhere.com")
    conn.request("GET", '/foo')
    conn.request("GET", '/bar')
    conn.request("GET", '/baz')

```

(2) 不要序列化你的请求。您可以使用线程或 asynccore 或任何您喜欢的东西，但是如果您从不同的服务器发出多个请求，您可以通过并行运行它们来提高性能。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-02-03T20:53:12.547

> 用户抱怨应用程序很慢。我怀疑这可能部分是由于我使用的 HTTP 客户端。
> 
> 我可以通过用其他东西替换 httplib 来提高性能吗？

你*怀疑*它还是你*确定*它是`httplib`？在你做任何事情来提高你的应用程序的性能之前进行分析。

我发现我自己对时间花在哪里的直觉通常很糟糕（假设没有一些代码内核执行了数百万次）。实施一些东西来提高性能然后拉起应用程序并看到它没有任何区别，这真的很令人失望。

如果您不进行分析，那么您就是在黑暗中拍摄！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-03T23:36:07.053

PyCurl 很棒，而且性能非常好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T21:38:43.780

httplib2 是另一种选择： [http ://code.google.com/p/httplib2/](http://code.google.com/p/httplib2/)

与 httplib 相比，我从未对它进行基准测试或分析，但我也会对那里的任何发现感兴趣。

* * *

2012 年 12 月更新：我不再使用 httplib2。现在使用**[Requests](http://docs.python-requests.org)** : HTTP For Humans，用于任何带有 Python 的 http。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T20:44:32.440

您似乎认为它是图书馆。它是开源的，因此值得检查代码以查看它是否是。

您提到您正在通过 HTTP 发送大量数据。效率低下可能是因为库，但 HTTP 并不是发送大量数据的最有效协议。再说一次，它可能是库的简单使用（您是发送一个大字符串或列表，还是使用流或生成器？）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-05T10:33:18.817

正如其他人回答的那样，httplib2 是一个很好的选择，因为它可以正确处理标头并可以缓存响应，但我怀疑这会有助于提高 POST 性能。

[Twisted.web 中的新 HTTP 1.1 客户端](http://twistedmatrix.com/trac/ticket/886)可能实际上可以提高 POST 的性能，尤其是在 Windows 上

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-04T04:37:50.410

httplib2 是一个很好的选择。Joe Gregorio 修复了 httplib 的许多错误。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-07-20T22:21:18.870

它适用于我的 Windows 机器：使用 Py 2.3（不支持 IPv6）这只是 IPv4 地址，但使用 Py 2.4-2.6 的顺序是（在我的 Win XP 主机上）首先是 IPv6 地址，然后是 IPv4 地址。由于首先检查 IPv6 地址，这会导致超时并导致缓慢的 connect() 调用。

我只将“localhost”更改为 127.0.0.1，它开始工作的速度提高了 10 倍（从 1087 毫秒到 87 毫秒）。来自[http://www.velocityreviews.com/forums/t668272-problem-with-slow-httplib-connections-on-windows-and-maybe-otherplatforms.html的解决方案](http://www.velocityreviews.com/forums/t668272-problem-with-slow-httplib-connections-on-windows-and-maybe-otherplatforms.html)

# c# - 在动态添加的 UserControl 上设置属性

> ID：508826
> 
> 赞同：7
> 
> 时间：2009-02-03T20:38:43.480
> 
> 标签：c#, .net, asp.net, user-controls, .net-2.0

[根据这篇文章](https://stackoverflow.com/questions/213429/programmatically-adding-user-controls-inside-an-updatepanel)，我正在向页面动态添加自定义用户控件。

但是，当我将其添加到页面时，我需要在用户控件上设置一个属性。我怎么做？

代码片段会很好:)

细节：

我有一个带有公共字段的自定义用户控件（属性......例如 public int someId;）

当我将 UserControl 添加到页面时，它的类型是 UserControl。我只是将其转换为 MyCustomUCType 并在转换控件上设置属性吗？

ps 看起来我毕竟已经回答了我自己的问题。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-03T20:59:25.653

啊，在您添加额外说明之前，我已经回答了。简短的回答是，是的，只需将其转换为您的自定义类型。

我将把其余的答案留在这里以供参考，尽管您似乎不需要它。

* * *

借用另一个问题中的代码，并假设您的所有用户控件都可以从同一个基类继承，您可以这样做。

创建一个新类作为基本控件：

```
public class MyBaseControl : System.Web.UI.UserControl
{
    public string MyProperty 
    {
        get { return ViewState["MyProp"] as string; }
        set { ViewState["MyProp"] = value; }
    }
} 
```

然后更新您的用户控件以从您的基类而不是 UserControl 继承：

```
public partial class SampleControl2 : MyBaseControl
{
    .... 
```

然后，在你加载控件的地方，改变这个：

```
UserControl uc = (UserControl)LoadControl(controlPath);
PlaceHolder1.Controls.Add(uc); 
```

到：

```
MyBaseControl uc = (MyBaseControl)LoadControl(controlPath);
uc.MyProperty = "foo";
PlaceHolder1.Controls.Add(uc); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T20:57:07.187

> “当我将 UserControl 添加到页面时，它的类型是 UserControl。我是否只需将其转换为 MyCustomUCType 并在转换控件上设置属性？”

这就是我要做的。如果您实际上使用的是加载不同控件的示例代码，我也会使用 if(x is ControlType) 。

> ```
> if(x is Label)
> {    
>      Label l = x as Label;
>      l.Text = "Batman!";
> }
> else
>      //... 
> ```

**编辑**：现在它与 2.0 兼容

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T20:56:48.203

是的，您只需将控件转换为正确的类型。前任：

```
((MyControl)control).MyProperty = "blah"; 
```

# eclipse - 当编辑器模板已经存在时，为什么还需要 Eclipse Snippets View？

> ID：508834
> 
> 赞同：7
> 
> 时间：2009-02-03T20:41:37.140
> 
> 标签：eclipse

Eclipse Snippets View 与编辑器模板的权衡是什么？为什么首先引入 Snippets？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-03T20:55:45.240

片段似乎是模板的自定义版本，具有透视图中的视图和 GUI 对话框以提示模板中的变量值。

他们拥有的唯一“新”功能是通过编辑器中的工具栏项提供他们的功能。

[片段视图](http://help.eclipse.org/ganymede/index.jsp?topic=/org.eclipse.wst.sse.doc.user/topics/csrcedt001.html)是 WTP（Web 工具平台）为模板提出的一种扩展，更面向（Web）*代码格式*，而[模板](http://help.eclipse.org/ganymede/index.jsp?topic=/org.eclipse.jdt.doc.user/concepts/concept-editor-templates.htm)帮助用户将*重复出现的模式*输入到文本编辑器中。

* * *

所以一开始，Eclipse Templates 是一个标准的 Eclipse 特性，只能应用于 java 和 javadocs。

片段基本上是相同的，但对于其他类型的文件，**WTP 引入来满足相同的需求，但对于它们自己的文件类型（xml、jps、html，...）**
（这就是，就在那里，“为什么首先要引入片段”）

* * *

模板没有自己的视图，而是一个不起眼的 Preference 页面 ( `Preferences -> Java -> Editor -> Templates`)

但是，您当时可以[编写一个小的 eclipse 扩展](http://eclipsesnippets.blogspot.com/2007/07/quickfix-converting-preference-page-to.html)来制作模板视图。

[从eclipse3.4M6](https://bugs.eclipse.org/bugs/show_bug.cgi?id=69581)开始这个问题已经解决了（模板有自己的看法）

* * *

您还可以构建一些[自定义的高级片段视图](http://www.ibm.com/developerworks/opensource/library/os-eclipse-snippet/index.html)

![片段查看示例](https://i.stack.imgur.com/aUywg.jpg)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-21T20:35:37.183

此外，Snippets 视图最初是在 Eclipse 1.0 和 2.0 之间的开发时间框架内构想的，当时内容辅助模板还没有像现在这样强大。 *这*就是它被创建的原因，它只是作为 IBM 对该项目最初贡献的一部分进入 WTP。

# c++ - 初始化 SDL_Surface 时遇到问题

> ID：508844
> 
> 赞同：2
> 
> 时间：2009-02-03T20:47:20.670
> 
> 标签：c++, initialization, sdl, rectangles

我正在尝试在 SDL [in C++] 中设置一些东西，我可以在其中绘制一个像素大的矩形。除了我的第二个 SDL_Surface 称为矩形之外，我的代码中的所有内容都可以正常工作。我在初始化它时遇到问题。这是我尝试初始化它的行：

```
rectangle = SDL_Surface(SDL_DOUBLEBUF | SDL_HWACCEL | 
                        SDL_SRCALPHA  | SDL_HWSURFACE,
                        screen->format, 1, 1, 16, NULL, clip_rect, 1); 
```

感谢您花时间阅读本文以及您可能选择给出的任何答案。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T21:04:10.417

我认为您遇到的主要问题是没有`SDL_Surface`功能。要创建新曲面，请使用[`SDL_CreateRGBSurface`](http://www.libsdl.org/cgi/docwiki.cgi/SDL_CreateRGBSurface). 请务必在`SDL_FreeSurface`完成后调用返回的表面，否则会泄漏内存。

此外，我不确定您为什么要为矩形创建表面。绘制纯色矩形的一种更简洁的方法是[`SDL_FillRect`](http://www.libsdl.org/cgi/docwiki.cgi/SDL_FillRect)不创建新表面。

# c# - C# 功能请求：在匿名类型上实现接口

> ID：508853
> 
> 赞同：14
> 
> 时间：2009-02-03T20:51:05.657
> 
> 标签：c#, compiler-construction, anonymous-types

我想知道做这样的事情需要什么：

```
using System;

class Program
{
    static void Main()
    {
        var f = new IFoo { 
                    Foo = "foo",
                    Print = () => Console.WriteLine(Foo)
            };
    }
}

interface IFoo
{
    String Foo { get; set; }
    void Print();
} 
```

创建的匿名类型如下所示：

```
internal sealed class <>f__AnonymousType0<<Foo>j__TPar> : IFoo
{
    readonly <Foo>j__TPar <Foo>i__Field;

    public <>f__AnonymousType0(<Foo>j__TPar Foo)
    {
        this.<Foo>i__Field = Foo;
    }

    public <Foo>j__TPar Foo
    {
        get { return this.<Foo>i__Field; }
    }

    public void Print()
    {
        Console.WriteLine(this.Foo);
    }
} 
```

编译器有什么理由不能做这样的事情吗？即使对于非 void 方法或带参数的方法，编译器也应该能够从接口声明中推断出类型。

**免责声明：**虽然我确实意识到这目前是不可能的，并且在这种情况下简单地创建一个具体的类会更有意义，但我对此的理论方面更感兴趣。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-04T12:05:43.407

重载成员、索引器和显式接口实现会有一些问题。

但是，您可能可以以一种允许您解决这些问题的方式定义语法。

有趣的是，您可以通过编写一个库来非常接近您想要的 C# 3.0。基本上，你可以这样做：

```
Create<IFoo>
(
    new
    {
        Foo = "foo",
        Print = (Action)(() => Console.WriteLine(Foo))
    }
); 
```

这与您想要的非常接近。主要区别在于调用“Create”而不是“new”关键字以及您需要指定委托类型这一事实。

“创建”的声明如下所示：

```
T Create<T> (object o)
{
//...
} 
```

然后它将使用 Reflection.Emit 在运行时动态生成接口实现。

但是，这种语法确实存在显式接口实现和重载成员的问题，如果不更改编译器就无法解决这些问题。

另一种方法是使用集合初始化器而不是匿名类型。看起来像这样：

```
Create
{
    new Members<IFoo>
    {
        {"Print", ((IFoo @this)=>Console.WriteLine(Foo))},
        {"Foo", "foo"}
    }
} 
```

这将使您能够：

1.  通过为字符串参数指定类似“IEnumerable.Current”的内容来处理显式接口实现。
2.  定义 Members.Add 以便您无需在初始化程序中指定委托类型。

你需要做一些事情来实现这个：

1.  为 C# 类型名称编写一个小型解析器。这只需要“.”、“[]”、“<>”、ID 和原始类型名称，因此您可能会在几个小时内完成
2.  实现缓存，以便您只为每个唯一接口生成一个类
3.  实现 Reflection.Emit 代码生成。这可能最多需要2天左右。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-03-08T16:38:49.037

它需要 c# 4，但开源框架[即兴接口](http://code.google.com/p/impromptu-interface/)可以在内部使用 DLR 代理来伪造它。性能很好，尽管不如您提出的更改存在。

```
using ImpromptuInterface.Dynamic; 
```

...

```
var f = ImpromptuGet.Create<IFoo>(new{ 
                Foo = "foo",
                Print = ReturnVoid.Arguments(() => Console.WriteLine(Foo))
            }); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-03T21:06:16.983

除了具有只读属性外，不能使匿名类型做任何事情。

引用[C# 编程指南（匿名类型）](http://msdn.microsoft.com/en-us/library/bb397696.aspx)：

> “匿名类型是由一个或多个公共只读属性组成的类类型。不允许使用其他类型的类成员，例如方法或事件。匿名类型不能转换为除对象之外的任何接口或类型。”

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T21:02:08.677

只要我们发布一个接口愿望清单，我真的很想能够告诉编译器一个类在类定义之外实现了一个接口——即使在一个单独的程序集中也是如此。

例如，假设我正在开发一个从不同存档格式中提取文件的程序。我希望能够从不同的库中提取现有的实现——比如 SharpZipLib 和商业 PGP 实现——并使用相同的代码来使用这两个库，而无需创建新的类。例如，然后我可以在通用约束中使用来自任一来源的类型。

另一种用途是告诉编译器`System.Xml.Serialization.XmlSerializer`实现了`System.Runtime.Serialization.IFormatter`接口（它已经实现了，但编译器不知道）。

这也可以用来实现您的请求，只是不能自动实现。您仍然必须明确告诉编译器。不确定语法的外观，因为您仍然必须在某处手动映射方法和属性，这意味着很多冗长的内容。也许类似于扩展方法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-26T16:59:38.333

你可以在 Java 中有类似[匿名类的东西：](http://docstore.mik.ua/orelly/java-ent/jnut/ch03_12.htm)

```
using System; 

class Program { 
  static void Main() { 
    var f = new IFoo() {  
      public String Foo { get { return "foo"; } } 
      public void Print() { Console.WriteLine(Foo); }
    }; 
  } 
} 

interface IFoo { 
  String Foo { get; set; } 
  void Print(); 
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-12-28T04:04:21.143

这不是很酷吗。内联匿名类：

```
List<Student>.Distinct(new IEqualityComparer<Student>() 
{ 
    public override bool Equals(Student x, Student y)
    {
        return x.Id == y.Id;
    }

    public override int GetHashCode(Student obj)
    {
        return obj.Id.GetHashCode();
    }
}) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-11-14T09:16:38.277

我要把这个扔在这里。我前段时间写过，但 IIRC 可以正常工作。

首先是一个辅助函数来获取 a`MethodInfo`并返回`Type`一个匹配的`Func`or `Action`。不幸的是，每个参数数量都需要一个分支，而我显然停在了三个。

```
static Type GenerateFuncOrAction(MethodInfo method)
{
    var typeParams = method.GetParameters().Select(p => p.ParameterType).ToArray();
    if (method.ReturnType == typeof(void))
    {
        if (typeParams.Length == 0)
        {
            return typeof(Action);
        }
        else if (typeParams.Length == 1)
        {
            return typeof(Action<>).MakeGenericType(typeParams);
        }
        else if (typeParams.Length == 2)
        {
            return typeof(Action<,>).MakeGenericType(typeParams);
        }
        else if (typeParams.Length == 3)
        {
            return typeof(Action<,,>).MakeGenericType(typeParams);
        }
        throw new ArgumentException("Only written up to 3 type parameters");
    }
    else
    {
        if (typeParams.Length == 0)
        {
            return typeof(Func<>).MakeGenericType(typeParams.Concat(new[] { method.ReturnType }).ToArray());
        }
        else if (typeParams.Length == 1)
        {
            return typeof(Func<,>).MakeGenericType(typeParams.Concat(new[] { method.ReturnType }).ToArray());
        }
        else if (typeParams.Length == 2)
        {
            return typeof(Func<,,>).MakeGenericType(typeParams.Concat(new[] { method.ReturnType }).ToArray());
        }
        else if (typeParams.Length == 3)
        {
            return typeof(Func<,,,>).MakeGenericType(typeParams.Concat(new[] { method.ReturnType }).ToArray());
        }
        throw new ArgumentException("Only written up to 3 type parameters");
    }
} 
```

现在该方法将接口作为通用参数并返回`Type`实现接口的 a 并具有一个构造函数（需要通过 调用`Activator.CreateInstance`）为每个方法/getter/setter采用`Func`or 。`Action`不过，您需要知道将它们放入构造函数的正确顺序。或者（注释掉的代码）它可以生成一个 DLL，然后您可以直接引用和使用该类型。

```
static Type GenerateInterfaceImplementation<TInterface>()
{
    var interfaceType = typeof(TInterface);
    var funcTypes = interfaceType.GetMethods().Select(GenerateFuncOrAction).ToArray();

    AssemblyName aName =
        new AssemblyName("Dynamic" + interfaceType.Name + "WrapperAssembly");
    var assBuilder = AppDomain.CurrentDomain.DefineDynamicAssembly(
            aName,
            AssemblyBuilderAccess.Run/*AndSave*/); // to get a DLL

    var modBuilder = assBuilder.DefineDynamicModule(aName.Name/*, aName.Name + ".dll"*/); // to get a DLL

    TypeBuilder typeBuilder = modBuilder.DefineType(
        "Dynamic" + interfaceType.Name + "Wrapper",
            TypeAttributes.Public);

    // Define a constructor taking the same parameters as this method.
    var ctrBuilder = typeBuilder.DefineConstructor(
        MethodAttributes.Public | MethodAttributes.HideBySig |
            MethodAttributes.SpecialName | MethodAttributes.RTSpecialName,
        CallingConventions.Standard,
        funcTypes);

    // Start building the constructor.
    var ctrGenerator = ctrBuilder.GetILGenerator();
    ctrGenerator.Emit(OpCodes.Ldarg_0);
    ctrGenerator.Emit(
        OpCodes.Call,
        typeof(object).GetConstructor(Type.EmptyTypes));

    // For each interface method, we add a field to hold the supplied
    // delegate, code to store it in the constructor, and an
    // implementation that calls the delegate.
    byte methodIndex = 0;
    foreach (var interfaceMethod in interfaceType.GetMethods())
    {
        ctrBuilder.DefineParameter(
            methodIndex + 1,
            ParameterAttributes.None,
            "del_" + interfaceMethod.Name);

        var delegateField = typeBuilder.DefineField(
            "del_" + interfaceMethod.Name,
            funcTypes[methodIndex],
            FieldAttributes.Private);

        ctrGenerator.Emit(OpCodes.Ldarg_0);
        ctrGenerator.Emit(OpCodes.Ldarg_S, methodIndex + 1);
        ctrGenerator.Emit(OpCodes.Stfld, delegateField);

        var metBuilder = typeBuilder.DefineMethod(
            interfaceMethod.Name,
            MethodAttributes.Public | MethodAttributes.Virtual |
                MethodAttributes.Final | MethodAttributes.HideBySig |
                MethodAttributes.NewSlot,
            interfaceMethod.ReturnType,
            interfaceMethod.GetParameters()
                .Select(p => p.ParameterType).ToArray());

        var metGenerator = metBuilder.GetILGenerator();
        metGenerator.Emit(OpCodes.Ldarg_0);
        metGenerator.Emit(OpCodes.Ldfld, delegateField);

        // Generate code to load each parameter.
        byte paramIndex = 1;
        foreach (var param in interfaceMethod.GetParameters())
        {
            metGenerator.Emit(OpCodes.Ldarg_S, paramIndex);
            paramIndex++;
        }
        metGenerator.EmitCall(
            OpCodes.Callvirt,
            funcTypes[methodIndex].GetMethod("Invoke"),
            null);

        metGenerator.Emit(OpCodes.Ret);
        methodIndex++;
    }

    ctrGenerator.Emit(OpCodes.Ret);

    // Add interface implementation and finish creating.
    typeBuilder.AddInterfaceImplementation(interfaceType);
    var wrapperType = typeBuilder.CreateType();
    //assBuilder.Save(aName.Name + ".dll"); // to get a DLL

    return wrapperType;
} 
```

您可以将其用作例如

```
public interface ITest
{
    void M1();
    string M2(int m2, string n2);
    string prop { get; set; }

    event test BoopBooped;
}

Type it = GenerateInterfaceImplementation<ITest>();
ITest instance = (ITest)Activator.CreateInstance(it,
    new Action(() => {Console.WriteLine("M1 called"); return;}),
    new Func<int, string, string>((i, s) => "M2 gives " + s + i.ToString()),
    new Func<String>(() => "prop value"),
    new Action<string>(s => {Console.WriteLine("prop set to " + s);}),
    new Action<test>(eh => {Console.WriteLine(eh("handler added"));}),
    new Action<test>(eh => {Console.WriteLine(eh("handler removed"));}));

// or with the generated DLL
ITest instance = new DynamicITestWrapper(
    // parameters as before but you can see the signature
    ); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-03T22:09:12.847

有趣的想法，我有点担心，即使可以做到，它也可能会令人困惑。例如，当使用非平凡的 setter 和 getter 定义属性时，或者如果声明类型还包含一个名为 Foo 的属性，如何消除 Foo 的歧义。

我想知道这在更动态的语言中是否会更容易，甚至在 C# 4.0 中使用动态类型和 DLR 是否会更容易？

也许今天在 C# 中，一些意图可以通过 lambdas 来实现：

```
void Main() {
    var foo = new Foo();
    foo.Bar = "bar";
    foo.Print = () => Console.WriteLine(foo.Bar);
    foo.Print();
}

class Foo : IFoo {
    public String Bar { get; set; }    
    public Action Print {get;set;}
} 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-02-03T21:00:53.153

目前这是不可能的。

这与简单地将 IFoo 改为具体类有什么区别？似乎这可能是更好的选择。

需要什么？一个新的编译器和大量检查以确保它们不会破坏其他功能。就个人而言，我认为要求开发人员只创建他们的类的具体版本会更容易。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2011-02-01T10:09:11.883

我通过“new IFoo(){...}”sintax 在 Java 中使用了 Amonimous 类，当您必须快速实现一个简单的接口时，它既实用又容易。

**作为一个示例，在只使用一次的****遗留**对象上以这种方式实现 IDisposable 会很好，而不是派生一个新类来实现它。

 **# cocoa - NSShowAllViews 和 NSShowAllDrawing 是否适用于 Xcode 3、OS X 10.5.6？

> ID：508855
> 
> 赞同：2
> 
> 时间：2009-02-03T20:52:31.737
> 
> 标签：cocoa, xcode, macos

我正在尝试启用这些调试首选项（NSShowAllViews、NSShowAllDrawing），如下所示：http:
[//developer.apple.com/technotes/tn2004/tn2124.html#SECAPPKITVIEWS](http://developer.apple.com/technotes/tn2004/tn2124.html#SECAPPKITVIEWS)

使用这种方法：http: [//developer.apple.com/technotes/tn2004/tn2124.html#FIGXCODEENV](http://developer.apple.com/technotes/tn2004/tn2124.html#FIGXCODEENV)

这些功能是否存在于 Xcode 3 和 OS X 10.5.6 中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T21:44:55.967

可执行编辑器中的环境变量列表存在于 Xcode 3 中，是的。

它不起作用的原因是那些不是环境变量。它们是偏好，你必须这样设置它们。

您可以通过添加一些参数从 Xcode 的可执行编辑器中做到这一点：

*   `-NSShowAllViews`
*   `YES`
*   `-NSShowAllDrawing`
*   `YES`

这会将这些偏好设置在 中`NSArgumentDomain`，这是非持久的。

# sql - 使用 SQL/WCF/Silverlight 进行多租户

> ID：508861
> 
> 赞同：0
> 
> 时间：2009-02-03T20:54:38.533
> 
> 标签：sql, sql-server, wcf, silverlight, saas

我们正在构建一个将作为 SaaS 提供的 Silverlight 应用程序。最终产品是连接到 WCF 服务的 Silverlight 客户端。由于客户端的数量可能很大，因此更新需要很容易，最好是可以一次性更新所有实例。

之前没有实施多租户，我正在寻找有关如何实现的意见

*   轻松升级
*   数据安全
*   可扩展性

[msdn](http://msdn.microsoft.com/en-us/library/aa479086.aspx)上列出了要考虑的三种不同模型

1.  单独的数据库。这不容易维护，因为所有模式更改都必须单独应用于每个客户的数据库。还有其他缺点吗？专业人士是数据分离和安全性。这也允许对每个客户进行轻微修改（这可能比它的价值更麻烦！）
2.  共享数据库，单独的模式。TenantID 列被添加到每个表中。确保每个客户都获得正确的数据具有潜在的危险。易于维护且可很好地扩展（？）。
3.  共享数据库，单独的模式。类似于第一个模型，但每个客户在数据库中都有自己的一组表。很难为单个客户恢复备份。可维护性在其他方面类似于模型 1 (?)。

关于这个主题的文章有什么建议吗？有人用 Silverlight SaaS 应用探索过类似的东西吗？在客户端我需要考虑什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T21:39:51.673

取决于应用类型和数据规模。每一个都有败笔。

1a）单独的数据库+ WCF /客户端的单个实例。保持一切同步将是一个挑战。您如何同时升级 X 台数据库服务器，如果其中一台出现故障并且现在不同步并且与客户端/WCF 层不兼容怎么办？

1b）“筒仓”，为每个客户单独的 DB/WCF/Client。您没有同步问题，但您确实有管理每一层的许多不同实例的开销。此外，您将不得不查看 SQL 许可，我不记得单独的 SQL 实例是否单独许可（$$$）。即使您可以安装任意数量的实例，多个实例的开销在某个点之后也不会是微不足道的。

3) 与 1a/b 基本相同的问题，除了许可。

2) 最佳升级/管理方案。您是对的，维护数据隔离是一个巨大的问题（1a 在技术上在更高级别上分享了这个问题）。另一个问题是，如果您的应用程序是数据密集型的，则您必须担心数据的可伸缩性。例如，如果每个客户都预计拥有数千万/亿行数据。然后，由于总客户群数量，您将开始遇到个别客户的问题和查询性能。客户对自己的数据量造成的减速更加宽容。由于其他 99 个客户端数据很大，因此被告知其速度很慢通常是不行的。

除非您知道一个事实，否则您将从一开始就处理大量数据，我现在可能会选择 #2，并开始考虑集群或在将来需要时迁移到 1a/b 设置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T22:32:45.700

我们还有一个 SaaS 产品，我们使用解决方案 #2（Shared DB/Shared Schema with TenandId）。Share DB / Same schema for all需要考虑的一些事项：

1.  如上所述，如果您不小心，一个租户的大量数据可能会影响其他租户的性能；对于初学者来说，正确/仔细地索引您的表，并且永远不要执行强制表扫描的查询。监控查询性能和至少计划/设计，以便以后能够根据对您的域有意义的一些标准对您的数据库进行分区。

2.  数据分离非常非常重要，您不希望最终将一条数据显示给属于其他租户的某个租户。每个查询都必须有一个 WHERE TenandId = ... 在其中，您应该能够在开发期间验证/强制执行此操作。

3.  架构的可扩展性是解决方案 1 和 3 可能为您提供的东西，但您可以通过设计一种方法来扩展与您的域中有意义的文档/表相关联的字段（即表的元数据）来解决它msdn文章提到）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-09T03:16:49.943

像 Apprenda 的 SaaSGrid 这样提供开箱即用架构的解决方案呢？它们让您在部署和维护时而不是在设计时做出数据库决策。他们似乎积极地转换和管理数据层，并提供升级引擎。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-09-24T03:02:45.797

我有类似的情况，但我的解决方案是两者兼得。

数据在哪里以及如何放置数据是租户的问题。作为租户，我当然不希望我的数据被共享，我希望我的数据被隔离、安全并且我可以随时获取。

它可能共享的某些数据，例如：公司列表。所以数据库应该是全局和租户数据库，只要确保锁定操作租户数据库模式，以及一次更新所有租户数据库的过程。

无论如何，SaaS 模型将所有内容作为服务器/Web 服务交付，因此无论数据库应作为服务提供给客户端，然后仅由客户端 GUI 呈现。

谢谢

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-04T05:15:49.427

现有的答案很好。您应该深入研究升级和管理多个数据库的问题。在不了解特定应用程序的情况下，拥有多个数据库可能会更容易，并且不必支付跟踪 TenantID 的额外费用。这可能最终不是正确的决定，但您当然应该警惕数据共享的开发成本。

# emacs - 在 Emacs 中如何重新映射键？

> ID：508874
> 
> 赞同：7
> 
> 时间：2009-02-03T20:58:17.013
> 
> 标签：emacs, key, remap

当我在 emacs 窗口中时，我正在寻找一种方法来切换我的控制键和大写锁定键，但是当我转到任何其他程序（如 Firefox）时，我希望能够对新窗口使用普通控制按钮，标签等。

附加信息：我正在使用 Ubuntu，但所有系统的答案都很好，因为其他人可能想知道如何在他们的系统上执行此操作。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-04T03:47:00.027

Emacs 从未真正看到 CapsLock 键码（无论如何都在 X 下），因此您无法在 Lisp 中重新映射键。请查看此页面以获取详细信息：

[http://www.emacswiki.org/emacs/MovingTheCtrlKey](http://www.emacswiki.org/emacs/MovingTheCtrlKey)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-03T22:44:09.170

[在使用自动热键](http://www.autohotkey.com/)的Windows上，您可以通过将这段代码放入默认脚本中来实现此目的：

```
#IfWinActive, emacs@      
    CapsLock::Control
#IfWinActive 
```

Auto Hot Key 是一个非常方便的实用程序，它也是像 GPL 中的免费软件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T22:09:34.157

对于全局重新映射键，有 xmodmap。xkeycaps 是一个交互式工具。您可以控制两个键。

由于您只想为 Emacs 重新映射键（我觉得这有点不明智），您需要在 Emacs 内部寻找解决方案。这应该是可能的，因为您可以重新绑定所有键，但是如果无法交换修饰符，则交换所有键可能太乏味了。

我个人将 CapsLock 映射到 Compose，以键入各种有趣的字符，如 ä、ß、å、þ、«、-、...

# java - 回复：大 XML 文件

> ID：508878
> 
> 赞同：5
> 
> 时间：2009-02-03T20:59:13.657
> 
> 标签：java, xml, memory, sax

[Big XML File](https://stackoverflow.com/questions/504689/big-xml-file/504795)的后续问题：

首先非常感谢您的回答。之后……我做错了什么？这是我使用 SAX 的课程：

```
public class SAXParserXML extends DefaultHandler {
  public static void ParcourXML() {

      DefaultHandler handler = new SAXParserXML();
      SAXParserFactory factory = SAXParserFactory.newInstance();
      try {
          String URI = "dblp.xml";
          SAXParser saxParser = factory.newSAXParser();
          saxParser.parse(URI,handler);
      } catch (Throwable t) {
     t.printStackTrace ();
       }
  }

  public void startElement (String namespaceURI,String simpleName,String qualifiedName,Attributes attrs) throws SAXException {
  }
  public void endElement (String namespaceURI,String simpleName,String qualifiedName) throws SAXException {

  }
} 
```

你可以看到我对我的 XML 文件没有做任何事情，但它给出了这个错误：

```
java.lang.OutOfMemoryError: Java heap space
    at com.sun.org.apache.xerces.internal.util.XMLStringBuffer.append(Unknown Source)
    at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.refresh(Unknown Source)
    at com.sun.org.apache.xerces.internal.impl.XMLEntityScanner.invokeListeners(Unknown Source)
    at com.sun.org.apache.xerces.internal.impl.XMLEntityScanner.peekChar(Unknown Source)
    at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(Unknown Source)
    at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(Unknown Source)
    at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)
    at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(Unknown Source)
    at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(Unknown Source)
    at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(Unknown Source)
    at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(Unknown Source)
    at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(Unknown Source)
    at javax.xml.parsers.SAXParser.parse(Unknown Source)
    at javax.xml.parsers.SAXParser.parse(Unknown Source)
    at SAXParserXML.ParcourXML(SAXParserXML.java:30)
    at Main.main(Main.java:28) 
```

我也尝试了 Stax……同样的错误……我该怎么办？我还将 Java 堆大小增加到 1260M

```
java -Xmx1260M SAXParserXML 
```

XML 文件具有以下形式：

```
<dblp> 
   <incollection> 
      <author>... </author> 
      .... 
      <author>... </author> 
      #other tags-i'm interested only by <author>#
      ... 
   </incollection> 
   <incollection> 
   # the same thing# 
   </incollection> 
   .... 
</dblp> 
```

您可以找到原始文件：[http ://dblp.uni-trier.de/xml/](http://dblp.uni-trier.de/xml/)

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-03T21:22:16.700

Java 1.6有一个[错误](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6536111)，它显示了完全相同的堆栈跟踪，目前尚未修复。较新的 Xerces 版本似乎没问题。

对于这么大的文档，仍然包含大量结构，您可以考虑使用拉解析，即解析部分结构，例如使用[StAX](http://stax.codehaus.org/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T22:43:22.917

好吧，给定：

```
public class Main {

    /**
     * @param args the command line arguments
     */
    public static void main(String argv[]) {
        Writer out;

        // Use an instance of ourselves as the SAX event handler
        Echo handler = new Echo();
        // Use the default (non-validating) parser
        SAXParserFactory factory = SAXParserFactory.newInstance();
        try {
            // Set up output stream
            out = new OutputStreamWriter(System.out, "UTF8");
            // Parse the input 
            SAXParser saxParser = factory.newSAXParser();
            saxParser.parse(new File("/tmp/dblp.xml"), handler);
        } catch (Throwable t) {
            t.printStackTrace();
        }
        System.out.println("Incollections = " + handler.cnt);
        System.exit(0);
    }

    static class Echo extends DefaultHandler {
        public int cnt = 0;
        @Override
        public void startElement(String namespaceURI,
                String sName, // simple name
                String qName, // qualified name
                Attributes attrs)
                throws SAXException {
            if (qName.equals("incollection")) {
                cnt = cnt + 1;
            }
        }
    }
} 
```

这在 Java 5 下对我有用，但在 Java 6 下我确实得到了 OOM。

我这样运行它：

```
java -DentityExpansLimit=512000 -jar xmltest.jar 
```

它打印：

```
Incollections = 8353 
```

哪个方便：

```
grep "<incollection" /tmp/dblp.xml | wc -l
8353 
```

所以，仅供参考，数据点等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T21:22:23.360

您的代码中的 HTML 实体似乎存在问题，即`&eacute;`第一个块中的“Jos”。至少我的浏览器在我打开文件时告诉我它有问题，并`XMLEntityScanner`显示在堆栈跟踪中。我不是 XML 专家，但实际上 HTML 实体是否通常不是为 XML 定义的？

**编辑**是的，就是这样。根据[Wikipedia](http://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references)`&eacute;` ， HTML DTD 中定义了类似的实体；XML 只有极少数的预定义实体。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T21:43:56.797

我不知道正确的术语，但是您的 XML 有多“深”？例如，您示例中的“作者”标签深度为 2 个元素。如果您的标签非常深，也许这就是您遇到内存问题的原因？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-31T18:27:20.240

听起来XML文件中的文本段（或CDATA、处理指令或注释）之一很长，解析器不会将其拆分为多个段。或者可能是解析器无法正确解析 DOCTYPE 声明：如果是这样，它可能会尝试读取所有 xml 内容，就好像它是 DTD 子集的一部分一样。

但这只是猜测。您提到您已经尝试过 Stax：哪个实现？JDK 1.6 随 Sun Sjsxp 一起提供。但是您也可以尝试 Woodstox ( [http://woodstox.codehaus.org](http://woodstox.codehaus.org) )，它通常以更强大的方式处理事情。因此，如果您不使用 Woodstox，您可以看到会发生什么。除非您强制文本合并（非默认），否则它会将文本段拆分为更小的块。

哦，以防万一您使用 Stax 参考实现（[http://stax.codehaus.org](http://stax.codehaus.org)）进行测试；不幸的是，它很容易出错。所以这可能会导致问题。Sjsxp 和 Woodstox 都是 Stax 的更好选择。

# string - 规范化 Prolog 原子中的空格字符

> ID：508887
> 
> 赞同：3
> 
> 时间：2009-02-03T21:02:37.817
> 
> 标签：string, prolog, whitespace

在 Prolog 原子中规范化空白字符（空格、换行符、制表符）的最佳方法是什么，例如在 SWI-Prolog 中。即我想有一个规则：

```
normalize_space_in_atom(+Atom1, -Atom2) 
```

这样`Atom2`

*   任何空白字符序列都变成了一个空格
*   以非空格开头
*   以非空格结尾

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T21:29:19.963

SWI Prolog 提供 normalize_space/2，因此您可以如下定义谓词：

```
normalize_space_in_atom(A1,A2) :- normalize_space(atom(A2),A1). 
```

我已经用 SWI Prolog 5.7.5 进行了尝试，它似乎可以工作。如果您愿意，可以添加更多错误处理。

# .net - 单个 WCF 服务中的多个基地址

> ID：508892
> 
> 赞同：8
> 
> 时间：2009-02-03T21:04:27.720
> 
> 标签：.net, wcf

我有一个环境，其中托管在同一台服务器上的多个站点将使用单个服务进行调用。例如：

[http://domain1.com/Api/Service.svc](http://domain1.com/Api/Service.svc)

[http://domain2.com/Api/Service.svc](http://domain2.com/Api/Service.svc)

Api 应用程序已设置为每个站点中的虚拟目录映射到相同的物理目录，因此源仅位于一个位置。问题是 WCF 不喜欢为其服务端点设置多个基地址。为了让服务完全正常工作，我必须添加一个基地址前缀过滤器：

```
<serviceHostingEnvironment>      
  <baseAddressPrefixFilters>        
    <add prefix="http://domain1.com/Api" />
    <!--<add prefix="http://domain2.com/Api" />-->
  </baseAddressPrefixFilters>
</serviceHostingEnvironment> 
```

但是，这仅适用于 domain1，因为您只允许使用一个 baseAddressPrefixFilter （如果您只允许使用一个，则不应将其称为 baseAddressPrefixFilter **）**。我尝试构建一个自定义 ServiceHostFactory 来解决它，但是在激活过程中调用 ServiceHostFactory 之前我遇到了过滤器问题。

关于如何让单一服务​​在这样的 2 个域上工作的任何想法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-03T22:12:56.753

好的，将整个 URL 放入端点地址是我没有想到的，所以这让我有所了解。使用自定义 ServiceHostFactory 后，它适用于 domain1，但不适用于 domain2。我收到了一条以前从未见过的新错误消息：

“没有协议绑定与给定地址匹配' [http://domain2.com/Api/Poll.svc/soap](http://domain2.com/Api/Poll.svc/soap) '。协议绑定在 IIS 或 WAS 配置中的站点级别进行配置。”

**更新：**

好的，我想通了（终于！）。我可以在服务定义中添加一个主机节点，并避免在每个端点中使用绝对 url。我还删除了 BaseAddressPrefixFilter，但在解决方案中保留了自定义 ServiceHostFactory。

```
 <service name="Poll">
    <host>
      <baseAddresses>
        <add baseAddress="http://domain1.com/Api"/>
        <add baseAddress="http://domain2.com/Api"/>
      </baseAddresses>
    </host>
    <endpoint address="soap" binding="basicHttpBinding" bindingConfiguration="soapBinding"
      contract="IPoll" />
    <endpoint address="mex" binding="mexHttpBinding" contract="IMetadataExchange" />        
  </service> 
```

我担心我将不得不为每个绑定为每个域编写一个端点，这将需要管理很多多余的配置。这个解决方案很棒，因为我不必这样做，它更简洁一点。

作为参考，这是我的 ServiceHostFactory 类。它非常简单，但它是必需的。一旦你有了这个，你还必须修改 .svc 文件的标记以包含工厂：Factory="Api.ServiceHostFactory"

```
 public class MyServiceHostFactory : System.ServiceModel.Activation.ServiceHostFactory
{
    protected override ServiceHost CreateServiceHost(Type serviceType, Uri[] baseAddresses)
    {                        
        ServiceHost host;

        host = new ServiceHost(serviceType, baseAddresses[0]);

        return host;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T21:08:06.650

IIRC，你*可以*有不同的前缀——但每个协议只有一个——所以你可以有一个 tcp 前缀，也许还有一个 https 前缀（需要检查那个）。但是，您还应该能够提供服务的完整地址，而不是使用基地址和相对部分？不过，您可能需要多个端点。

# objective-c - 大约 2 年前，你希望你知道哪些 Cocoa/Core Foundation 辅助函数？

> ID：508894
> 
> 赞同：13
> 
> 时间：2009-02-03T21:05:29.637
> 
> 标签：objective-c, cocoa

我刚刚在 NSGeometry.h 中发现了 NSRect 辅助函数（即 NSMidX、NSMaxX 等......）

这些会使一些重复的编码变得容易得多。我知道 NSMakeRect、NSMouseInRect、NSOffsetRect 和许多其他的，但不知何故错过了帮助重新计算 NSRect 几何的函数。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-04T06:21:49.310

我发现 NSStringFrom*() 在记录 CGRect、CGPoint 等结构时很有用。

[您可以在 Apple 的Foundation Functions Reference](http://web.archive.org/web/20170506162910/https://developer.apple.com/reference/foundation/foundation_functions "基础函数参考")（Wayback Machine 链接）中找到全面的概述。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-06-06T08:39:13.040

辅助函数绘制具有左盖、填充和右盖的三部分图像。自定义按钮的理想选择

```
void NSDrawThreePartImage(NSRect frame,
    NSImage *startCap,
    NSImage *centerFill,
    NSImage *endCap,
    BOOL vertical,
    NSCompositingOperation op,
    CGFloat alphaFraction,
    BOOL flipped
); 
```

还要寻找**NSDrawNinePartImage**

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-03T23:48:56.450

这是我希望我在大约 6 个月前就知道的。我正在创建我们的第一个 iPhone 应用程序，我想使用 UIWebView 控制器创建一个基于 HTML 的简单帮助文件。

但是，我不知道如何嵌入存储在 Bundle 中的本地图像，并且我不希望用户必须访问 Internet 才能从服务器获取图像。

我几乎不知道我可以执行以下操作来从 Main Bundle 中获取图像

```
NSString *bundlePath = [[NSBundle mainBundle] bundlePath];
NSURL *bundleBaseURL = [NSURL fileURLWithPath: bundlePath];

[webView loadHTMLString:htmlContent baseURL: bundleBaseURL]; 
```

HTML 中的 Image 然后可以直接调用本地图像。

```
<img src="yourImageFromTheMainBundle.jpg" /> 
```

我不知道我可以将 baseURL 设置为 Bundle 的位置。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-04T15:06:43.620

NSPathUtilities.h 中的大部分内容。两年前我确实知道它，但当我第一次发现它时，我希望我能在两年前看到它。:-)

在某些时候，我浪费了很多时间，因为我不知道[NSCountedSet](https://developer.apple.com/documentation/foundation/nscountedset?language=objc)，并且把我的基于字典的替换弄得一团糟。我知道有几个案例，人们做了同样的事情，因为他们根本不知道[NSSet](https://developer.apple.com/documentation/foundation/nsset?language=objc)。另一个很好的“隐藏”集合是[CFBinaryHeap](https://developer.apple.com/documentation/corefoundation/cfbinaryheap?language=objc)，它实现了优先级队列，但没有 NS 等价物。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-04T17:27:46.440

我记得的一个

```
+ (NSBezierPath *)bezierPathWithRoundedRect:(NSRect)rect xRadius:(CGFloat)xRadius yRadius:(CGFloat)yRadius 
```

当然，弄清楚如何手动绘制圆角矩形是一个很好的练习。还有一些我现在已经习惯了。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-04T14:54:23.037

从图案图像创建颜色

```
[UIColor colorWithPatternImage:[UIImage imageNamed:@"mypattern.png"]]; 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-04T14:48:07.483

这是一个快捷方式，而不是我错过的库调用，但它符合线程的精神。

我经常使用的一种快捷方式是在 NSLog 调用中使用内联格式语句。

```
 NSLog(@"x=%@", [someobject className]); 
```

而不是更冗长

```
 NSLog([NSString stringWithFormat:@"x=%@", [someobject classname]]); 
```

# c# - 在 C# 中实现类似 C++ 模板的行为

> ID：508901
> 
> 赞同：1
> 
> 时间：2009-02-03T21:08:38.960
> 
> 标签：c#, templates

我在一个与语言无关的类中有一个作业，其中一部分是使用模板化函数，比如

```
 T functionName(T &param1[], T &param2[]){
        // do stuff
    } 
```

我想用 C# 编写这个程序，但我遇到了一个问题。

如何在 C# 中完成这项工作：

```
<pre><code>
T functionName(ref List<T> param1, ref List<U> param2){
    // do stuff
}
</code></pre> 
```

?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T21:10:50.950

如果你打算 param2 是`List<U>`

```
T functionName<T,U>(ref List<T> param1, ref List<U> param2) 
```

除此以外：

```
T functionName<T>(ref List<T> param1, ref List<T> param2) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T21:13:36.577

您有两个涵盖泛型的答案……顺便说一句：C# 需要不需要`ref`，因为您已经只传递了引用（`List<T>`是引用类型的对象）。仅当`ref`您在方法内分配新列表并希望客户端看到重新分配时才需要。没有`ref`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T21:10:51.857

尝试这样的事情（注意**`<T,U>`**函数名后面的）：

```
T functionName<T,U>(ref List<T> param1, ref List<U> param2){
    // do stuff
} 
```

# return-value - 将返回代码从子脚本发送回父脚本

> ID：508903
> 
> 赞同：-1
> 
> 时间：2009-02-03T21:09:05.743
> 
> 标签：return-value

当找不到 FTP 文件时，我的子脚本可以创建 rc=110。父脚本设置错误处理 RC=1。我希望将错误处理设置为在子脚本中创建的 RC。有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T21:18:06.210

什么操作系统？在 linux 中，您可以使用 | 使用标准输入/输出转发参数。（管道）

```
./script | ./binaryName 
```

这会将 ./script 的输出转发为 ./binaryName 的输入并在您的主目录中：

```
int main(int argc, char **argv){
//Don't use argv[0]!
char* yourOutput = argv[1];
return 0;
} 
```

我刚刚意识到你的“父母”也是一个脚本。这是什么语言？我使用过的所有语言都有一种引起争论的方式，就像我刚刚在 C++ 中向您展示的那样。

# webserver - 便携式 USB 网络服务器

> ID：508909
> 
> 赞同：5
> 
> 时间：2009-02-03T21:11:16.677
> 
> 标签：webserver, portable-applications

我有一个我正在处理的项目，这将需要一个网络服务器。网络服务器将用于使用移动设备远程控制演示。

我看到那里有很多选择，我想知道是否有人可以提供一些建议。

我的标准包括：

*   便携式，适合 USB 密钥

*   易于运行。用户只需单击一个图标，或者理想情况下它会包含一个自动运行命令。

*   开源。我更喜欢根据 GPL 或类似许可获得许可的东西。

*   运行动态服务器端语言。我看到大多数都有 PHP 可以完美运行，但我对其他语言持开放态度。

*   如果可能的话，跨平台。

现在我倾向于 XAMPP，但我很想听听一些建议。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-03T21:14:27.293

[XAMPP](http://www.apachefriends.org/en/xampp.html)非常适合这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T21:28:57.327

我推荐[XAMPP](http://www.apachefriends.org/en/xampp.html)，所以我认为你在正确的轨道上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T21:42:08.983

没有用过这个，但看起来它就在你的小巷里：

[http://www.blackdot.be/?inc=apache/httpserveronusb](http://www.blackdot.be/?inc=apache/httpserveronusb)

默认支持 perl + php。

来自页面：如果你是一名网络开发人员，我相信你曾经有过这样的经历：“如果我现在有一个方便的网络服务器就好了！”

那么 USB 上的 HTTP Server 适合您！USB 上的 HTTP 服务器是一个完全配置的 Web 服务器，可从您的 USB 密钥运行。即插即用！它可用于向客户展示网站、与您的朋友共享文件（这两种方式都归功于 DAV）或只是给人们留下深刻印象但表现得非常怪异！

你很特别吗？你依赖异国情调的第 3 方模块吗？只需将它们放在模块文件夹中并编辑配置文件！

特征：

*   管理应用
*   阿帕奇 2.2.11
    *   mod_deflate
    *   mod_ssl
*   mod_security
*   mod_perl
*   PHP 5.2.8
*   活动状态 Perl 5.10

要求：

*   Windows 2000、Windows XP 或 Windows 2003
*   256mb USB 密钥

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-09-19T16:49:24.223

我对 XAMPP Lite 或 USBWebserver 不满意。目前运行良好的是[Server2Go](http://server2go-web.de)。我永远无法运行 XAMPP，USBWebserver 也不允许我安装 Drupal 或 Wordpress。

使用 Server2Go，我能够在 USB 闪存驱动器上安装 Drupal 7，但是，只能使用 SQLite。我确实需要转到 php 文件夹并将 production-php.ini 文件复制并重命名为 php.ini。需要设置 php.ini 设置才能识别 MySQL DB。不过，出于开发目的，它与 SQLite 运行良好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T21:31:43.607

[LAMPPIX](http://lamppix.tinowagner.com/) - 看起来不是最新的，但应该可以完成这项工作。

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2009-02-03T22:26:36.930

我建议使用 Apache，它非常轻量级并且拥有你需要的一切（PHP）。

# .net - .NET 中机器的域名？

> ID：508911
> 
> 赞同：31
> 
> 时间：2009-02-03T21:11:51.183
> 
> 标签：.net, windows, dns

必须有一个简单的方法来做到这一点，我不敢相信没有。我已经通过网络进行了扫描，发现有 20 种不同的方法可以找到当前用户所在的域，但没有一种方法可以获取当前机器的域（或工作组）。

在非托管 c++ 中，这是通过以下方式检索的：

```
WKSTA_INFO_100 *buf;
NetWkstaGetInfo(NULL, 100, (LPBYTE*)buf);
domain_name = pBuf->wki100_langroup; 
```

如果有办法在托管 C# 中本地获取相同的信息，有人可以帮助我吗？

EDIT1：**伙计们，请阅读这个问题。我不是在寻找用户域名。**

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-02-03T21:27:36.877

要获取运行程序的系统的当前域，您可以使用 [System.DirectoryServices.ActiveDirectory.Domain](http://msdn.microsoft.com/en-us/library/system.directoryservices.activedirectory.domain.aspx)。

```
Domain domain = Domain.GetComputerDomain();
Console.WriteLine( domain.Name ); 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2015-02-26T19:31:56.673

我从事一个用户可以在任何地方的项目；域机器上的非域用户，非域机器上的用户，不直接连接到第三方网络上的域等，所以依赖 AD 已经是一个非启动器。

**System.Net.NetworkInformation.IPGlobalProperties.GetIPGlobalProperties().DomainName**在所有这些条件下都更加可靠。

[http://blogs.msdn.com/b/trobbins/archive/2006/01/04/509347.aspx](http://blogs.msdn.com/b/trobbins/archive/2006/01/04/509347.aspx)

[https://msdn.microsoft.com/en-us/library/system.net.networkinformation.ipglobalproperties.domainname(v=vs.110).aspx?cs-save-lang=1&cs-lang=cpp#code-snippet -2](https://msdn.microsoft.com/en-us/library/system.net.networkinformation.ipglobalproperties.domainname(v=vs.110).aspx?cs-save-lang=1&cs-lang=cpp#code-snippet-2)

```
Imports System.DirectoryServices
Imports System.Net.NetworkInformation

Public Class Form1

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Try
            MsgBox("Domain: " & ActiveDirectory.Domain.GetComputerDomain.Name)
        Catch ex As Exception
            MsgBox(ex.GetType.ToString & ": " & ex.Message)
        End Try
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Try
            MsgBox("Domain: " & IPGlobalProperties.GetIPGlobalProperties().DomainName)
        Catch ex As Exception
            MsgBox(ex.GetType.ToString & ": " & ex.Message)
        End Try
    End Sub

End Class 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-08-09T03:53:23.923

使用**GetCurrentDomain与****Environment.UserDomainName**相同，如果您的程序作为非域用户在域计算机上运行，​​则该方法将无法正常工作。我使用了以下代码：

```
try
{
    return System.DirectoryServices.ActiveDirectory.Domain.GetComputerDomain().Name;
}
catch (Exception)
{
    return Environment.UserDomainName;
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-03T21:15:51.067

System.Environment.UserDomainName

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-22T18:26:13.887

如果不想给 System.DirectoryServices 添加依赖，也可以直接调用 [NetGetJoinInformation](http://www.pinvoke.net/default.aspx/netapi32/NetGetJoinInformation.html) API。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-01-16T16:39:44.660

[System.DirectoryServices.ActiveDirectory.Domain.GetComputerDomain()](https://docs.microsoft.com/en-us/dotnet/api/system.directoryservices.activedirectory.domain.getcomputerdomain)包装[了 DsGetDcName](https://docs.microsoft.com/en-us/windows/win32/api/dsgetdc/nf-dsgetdc-dsgetdcnamew)，即使机器不属于域，它也会在网络中搜索域控制器。（见[备注](https://docs.microsoft.com/en-us/windows/win32/api/dsgetdc/nf-dsgetdc-dsgetdcnamew#remarks)）

作为[NetGetJoinInformation](https://docs.microsoft.com/en-us/windows/win32/api/lmjoin/nf-lmjoin-netgetjoininformation)的替代方法，您可以使用带有[COMPUTER_NAME_FORMAT标志的](https://docs.microsoft.com/en-us/windows/win32/api/sysinfoapi/ne-sysinfoapi-computer_name_format)[GetComputerNameEx](https://www.pinvoke.net/default.aspx/kernel32.getcomputernameex)来获取完整的 DNS 域名。`.ComputerNameDnsDomain`

（如果不是域的一部分，它仍然返回 true，但结果字符串将为空。）

# c# - NHibernate 会话 ObjectDisposedException

> ID：508938
> 
> 赞同：3
> 
> 时间：2009-02-03T21:17:18.253
> 
> 标签：c#, nhibernate, objectdisposedexception

有没有办法验证 NHibernate 是否已经处理了 Session？

我在 Session 上有一个包装类，它有自己的 Finalizer 和 IDispoable 实现，但是如果 Session 在我自己在我的类中处理之前被处置，我最终会收到 ObjectDisposedException。

我真的不想用

```
try {
...
}
catch (ObjectDisposedException) { } 
```

但我不确定其他任何方式。Session.IsOpen 和 Session.IsActive 属性似乎没有为我提供任何可靠的信息来确认会话已被处理。

如需完整源代码，您可以在[Assembla](http://code.assembla.com/MarisicDotNet/subversion/nodes/StructuredWeb/StructuredWeb/Repository/NHibernateDataAccess/Conversation/Conversation.cs)上查看。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-04T21:25:34.197

好的，只是看看你的代码。我不知道这是否正是问题所在，但是您正在从对话处理方法调用 End()，该方法又尝试重新连接并处理会话。如果您在此之前明确调用 End()，您将得到你得到什么，避免那个电话。我认为您不应该担心在会话处理之前回滚事务，因为这是隐式完成的。只是快速浏览了一下，但我想我真的很喜欢你的实现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T22:18:19.973

我一直认为 NHibernate 的最佳实践是“每个请求的会话”，这意味着它应该只存在于“使用”范围内。

```
using(Session session = new Session())
{
} 
```

我建议尝试阻止两个人处理会话/对话。如果您控制会话的创建，则可以将其包装在您自己的 ISession impl 中，执行它自己的 IsAlreadyDisposed() 检查以防止异常。尽管如此，考虑到努力与“预期异常”和原始代码看起来并没有那么糟糕。

我还建议注意您的终结器实施。“Session.Is().InTransaction()”进入 Session->Transaction 并且在终结者轮到它时会话可能为空。不能保证在终结时导航托管关系。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-04T20:33:02.680

“这是我见过的最荒谬的事情之一，它的 Open 属性即使在处置后仍然保持真实”

为什么您已经处置的对象会包含有关其状态的可靠信息？您不应该尝试使用已处置的会话，我也不知道 nhibernate 在哪里处置您的会话，您确定不是自己处置吗？

# c# - 如何在代码中绑定嵌套对象或主从绑定？

> ID：508940
> 
> 赞同：3
> 
> 时间：2009-02-03T21:17:40.657
> 
> 标签：c#, .net, wpf, binding, master-detail

我有一个三个嵌套类，节目、季节和剧集，其中一个节目有季节，而季节有剧集。

我想绑定两个列表框，以便第一个列出季节，第二个列出该季节的剧集。

我怎样才能做到这一点？我更喜欢在代码中而不是 xaml 中进行设置，但如果您知道如何使用 xaml 进行设置，总比没有好。

一个简化的 xaml：

```
<Window>
  <Label name="Showname" />
  <ListBox name="Seasons" />
  <ListBox name="Episodes" />
</Window> 
```

和一些相关代码：

```
public partial class Window1 : Window
{
  public Data.Show show { get; set; }
  public Window1()
  {
    this.DataContex = show;

    //Bind shows name to label
    Binding bindName = new Binding("Name");
    ShowName.SetBinding(Label.ContentProperty, bindName);

    //Bind shows seasons to first listbox
    Binding bindSeasons = new Binding("Seasons");
    Seasons.SetBinding(ListBox.ItemsSourceProperty, bindSeasons);
    Seasons.DisplayMemberPath = "SeasonNumber";
    Seasons.IsSyncronizedWithCurrentItem = true;

    //Bind current seasons episodes to second listbox
    Binding bindEpisodes = new Binding("?????");
    Episodes.SetBinding(ListBox.ItemsSourceProperty, bindEpisodes);
    Episodes.DisplayMemberPath = "EpisodeTitle";
  }
} 
```

有人知道如何绑定第二个列表框吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-03T21:20:55.813

编辑：添加更多细节。

好的，假设您有一个 Show 对象。这有一个季节的集合。每个季节都有一个情节集合。然后，您可以让整个控件的 DataContext 成为 Show 对象。

*   将您的 TextBlock 绑定到节目的名称。文本="{绑定名称"}
*   将季节列表框的 ItemsSource 绑定到 Seasons 集合。ItemsSource="{Binding Seasons}" IsSynchronizedWithCurrentItem="True"
*   将情节列表框的 ItemsSource 绑定到当前季节的情节集合。ItemsSource="{Binding Seasons/Episodes}"。

假设您的 Window 的 DataContext 是 Show 对象，则 XAML 将是：

```
<Window>
   <TextBlock Text="{Binding Name}" />
   <ListBox ItemsSource="{Binding Seasons}" IsSynchronizedWithCurrentItem="True" />
   <ListBox ItemsSource="{Binding Seasons/Episodes}" />   
</Window> 
```

所以你的 UI 元素并不需要名字。此外，将其转换为代码非常容易，而且您走在正确的道路上。您的代码的主要问题是您在列表框并不真正需要它时命名了它们。

假设 Season 对象有一个名为 Episodes 的属性，它是 Episode 对象的集合，我认为是：

```
 Binding bindEpisodes = new Binding("Seasons/Episodes"); 
```

# asp.net - 在不创建 Web 应用程序的情况下向子文件夹添加身份验证

> ID：508950
> 
> 赞同：2
> 
> 时间：2009-02-03T21:21:16.530
> 
> 标签：asp.net, iis-6

我们有一个现有的可公开访问的 Web 应用程序，其中包含用户控件、数据访问库、图形等。我们希望创建一个新的网站安全部分，以访问一些已经存在的资源。

最初，我们将站点的新部分创建为一个虚拟目录，（我们希望）允许我们访问父站点的资源。我们将适当的位置信息添加到基本 web.config（身份验证和授权），但我们继续看到以下错误“解析器错误消息：使用注册为 allowDefinition='MachineToApplication' 的部分超出应用程序级别是错误的。这个错误可能是由未在 IIS 中配置为应用程序的虚拟目录引起的。”

为了响应该错误，我们将目录创建为新应用程序。这允许我们正确地进行身份验证，但缺点是无法访问父目录中的任何资源（因为它超出了应用程序范围）。

有什么方法可以保护网站的新部分，同时利用现有资源？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T21:31:17.273

在站点根目录的 web.config 文件中，如果添加：

```
<location path="relativePathToDir">
        <system.web>
            <authorization>
                <deny users="?"/>
            </authorization>
        </system.web>
    </location> 
```

这对我使用 FormsAuthentication 有用，如果未通过身份验证，用户将被重定向到默认登录页面

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-03-22T00:15:21.537

我输入了一个摘要，因为许多人在子文件夹身份验证方面面临同样的情况。

子文件夹授权

1.  ASP.NET 只能为一个应用程序提供一种身份验证模式。
2.  不同的应用程序不能在它们之间共享资源。

设想

假设主页不应提示登录对话框。它应该让用户在没有任何登录的情况下通过。但是，在同一个应用程序中，可能在不同的文件夹中，另一个页面需要使用用户网络登录 ID 来检查用户对数据库表的权限。默认情况下，IE 将所有只有主机名的网站视为 Intranet。根据其默认的 Intranet 设置，如果使用 Windows 身份验证，它将不会提示登录对话框并将用户登录名和密码传递给应用程序。然而，棘手的是，如果应用程序有一个实际的域，IE 会认为它是一个 Internet 站点，如果使用 Windows 身份验证，它会提示登录名和密码。

**不使用 Windows 身份验证提示 Internet 站点登录对话框的唯一方法是在 IIS 中也打开匿名身份验证。**但是，您将无法捕获登录信息，因为匿名优先于 Windows 身份验证。好消息是有办法解决这个问题。如果应用程序子文件夹需要捕获登录信息，则需要覆盖 web.config 中 Location 元素中的父授权。

1 在 IIS 中，按如下方式配置身份验证：

*   启用匿名身份验证，
*   启用 Windows 身份验证

2 在 Web.Config 中添加以下内容。

```
<authentication mode="Windows" />
  <authorization>
   <allow users="*" />
</authorization>

<!-- secured is the relative subfolder name. deny anonymous user, so only the authenticated login will pass through -->
<location path="secured" allowOverride="true">
  <system.web>
    <authorization>        
        <deny users="?" />
    </authorization>
  </system.web>
</location> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T21:32:02.453

删除应用程序，然后将其添加到顶级 web.config：

```
<configuration>
    <system.web>
        <!-- applies application wide -->
    </system.web>

    <location path="securedirectory" allowOverride="false">
        <system.web>
            <!-- applies only to the path specified -->
        </system.web>
    </location>

</configuration> 
```

[MSDN 参考](http://msdn.microsoft.com/en-us/library/b6x6shw7.aspx)

# mysql - mysql根据IP和子网掩码广播地址

> ID：508958
> 
> 赞同：1
> 
> 时间：2009-02-03T21:23:18.587
> 
> 标签：mysql, subnet

我有以下两列：

```
选择 b.ip_address 作为 IP，b.mask 作为接口 b 的掩码，其中 b.ip_address = 167804290；
+-----------+------------+
| 知识产权 | 面膜 |
+-----------+------------+
| 167804290 | 4294967168 |
+-----------+------------+

```

实际 IP 地址及其子网掩码在哪里

```
选择 INET_NTOA(b.ip_address) 作为 IP，INET_NTOA(b.mask) 作为接口 b 的掩码，其中 b.ip_address = 167804290；

+--------------+------------------+
| 知识产权 | 面膜 |
+--------------+------------------+
| 10.0.125.130 | 255.255.255.128 |
+--------------+------------------+
一组中的 1 行（0.00 秒）

```

我正在尝试使用 mysql 找到一种方法来获取实际的广播范围，在这种情况下是`10.0.125.255`or `167804415`，但我看不到它。我得到的最接近的是

```
从接口 b 中选择 INET_NTOA(b.ip_address+(POWER(2,32)- b.mask - 1)) 其中 b.ip_address = 167804290；
+-------------------------------------------------- --+
| INET_NTOA(b.ip_address+(POWER(2,32)- b.mask - 1)) |
+-------------------------------------------------- --+
| 10.0.126.1 |
+-------------------------------------------------- --+

```

唯一的问题是，这是假设该列`ip_address`是子网的开始`10.0.125.128`

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T21:52:00.133

广播地址是子网掩码的补码，与 IP 地址进行或运算。

```
SELECT INET_NTOA( ~b.mask & 0xffffffff | b.ip_address) 
FROM interfaces b 
WHERE b.ip_address = 167804290; 
```

（你必须用 " `& 0xffffffff`" 屏蔽，因为在 MySQL 中，按位补码运算符返回一个 64 位值。）

# php - 真正破坏 PHP 会话？

> ID：508959
> 
> 赞同：19
> 
> 时间：2009-02-03T21:23:36.743
> 
> 标签：php, session

我听到了关于这个话题的不同反应，那么破坏 PHP 会话的可靠方法是什么？

```
session_start();
if(isset($_SESSION['foo'])) {
   unset($_SESSION['foo'];
   ...
}
session_destroy(); 
```

在最简单的情况下，这足以真正终止用户和服务器之间的会话吗？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-02-03T21:50:53.477

要销毁会话，您应该采取以下步骤：

*   删除会话数据
*   使会话 ID 无效

为此，我会使用这个：

```
session_start();
// resets the session data for the rest of the runtime
$_SESSION = array();
// sends as Set-Cookie to invalidate the session cookie
if (isset($_COOKIE[session_name()])) { 
    $params = session_get_cookie_params();
    setcookie(session_name(), '', 1, $params['path'], $params['domain'], $params['secure'], isset($params['httponly']));
}
session_destroy(); 
```

为了确保会话 ID 无效，您应该只允许由脚本启动的会话 ID。所以设置一个标志并检查它是否被设置：

```
session_start();
if (!isset($_SESSION['CREATED'])) {
    // invalidate old session data and ID
    session_regenerate_id(true);
    $_SESSION['CREATED'] = time();
} 
```

此外，您可以使用此时间戳定期交换会话 ID 以缩短其生命周期：

```
if (time() - $_SESSION['CREATED'] > ini_get('session.gc_maxlifetime')) {
    session_regenerate_id(true);
    $_SESSION['CREATED'] = time();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T21:29:58.183

PHP 手册解决了这个问题。

您需要终止会话并删除会话 cookie（如果您正在使用 cookie）。

请参阅此页面（尤其是第一个示例）：

[http://us2.php.net/manual/en/function.session-destroy.php](http://us2.php.net/manual/en/function.session-destroy.php)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T21:27:32.977

在我创建的一个使用 PHP 会话的站点中，我从未真正销毁会话。

问题是您几乎必须调用`session_start()`来检查您的`$_SESSION`变量，此时，您瞧，您已经创建了另一个会话。

因此，在我的网站上，我只是确保*每个*页面都调用`session_start()`，然后只确保`unset()`会话状态的那些部分在用户注销时很重要。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2018-12-02T15:35:40.897

```
$_SESSION = [];
@unset($_COOKIE[session_name()]);
session_destroy(); 
```

# google-app-engine - Google App Engine 数据存储区中不精确查询的良好模式是什么？

> ID：508960
> 
> 赞同：3
> 
> 时间：2009-02-03T21:24:44.993
> 
> 标签：google-app-engine, gql, google-cloud-datastore

Google App Engine 数据存储区查询语言 (gql) 不提供不精确的运算符，例如“LIKE”，甚至不区分大小写。可以通过存储字段的小写版本来解决区分大小写的问题。但是如果我想搜索一个人但我不确定名字的拼写怎么办？是否有处理这种情况的公认模式？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-04T00:36:30.117

从文档中引用：

提示：查询过滤器没有明确的方式来匹配字符串值的一部分，但您可以使用不等式过滤器伪造前缀匹配：

```
db.GqlQuery("SELECT * FROM MyModel WHERE prop >= :1 AND prop < :2", "abc", u"abc" + u"\ufffd") 
```

这将每个 MyModel 实体与以字符 abc 开头的字符串属性 prop 匹配。unicode 字符串 u"\ufffd" 表示最大可能的 Unicode 字符。当属性值在索引中排序时，落在此范围内的值是所有以给定前缀开头的值。

[http://code.google.com/appengine/docs/python/datastore/queriesandindexes.html](http://code.google.com/appengine/docs/python/datastore/queriesandindexes.html)

另一种选择是 SearchableModel，但是，我不相信它支持部分匹配。

[http://billkatz.com/2008/8/A-SearchableModel-for-App-Engine](http://billkatz.com/2008/8/A-SearchableModel-for-App-Engine)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T07:27:42.120

您可以在数据存储中存储名称的 soundex [http://effbot.org/librarybook/soundex.htm](http://effbot.org/librarybook/soundex.htm)版本。然后，要查询一个名称，对查询进行 soundex，然后进行查找。

# cobol - COBOL 编程入门有哪些好的资源？

> ID：508961
> 
> 赞同：7
> 
> 时间：2009-02-03T21:25:37.240
> 
> 标签：cobol

我正在考虑学习COBOL。我应该从哪里开始？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-03T21:27:15.737

我从这个优秀的[教程](http://www.csis.ul.ie/COBOL/)开始。

[有一个名为OpenCOBOL](http://www.opencobol.org/)的开源 COBOL 编译器，您可以使用它来完成练习。

和一个 COBOL[门户](http://www.cobolportal.com/index.asp?bhcp=1)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T21:31:32.080

我在 Y2K 期间做过 Cobol，Cobol 是最容易的部分，噩梦是 JCL 或作业控制语言来运行你的 Cobol 程序，真是一场灾难！

我真的真的很想知道为什么你甚至想学习 Cobol

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-08-04T08:35:21.543

请参阅 Shelly Cashman Foremam 的《结构化 COBOL 编程，第二版》一书。我研究了这本书，它真的很有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T21:53:44.750

IBM i5/OS 信息中心链接：

[http://publib.boulder.ibm.com/infocenter/systems/scope/i5os/index.jsp?topic=/rzahg/rzahgcobol.htm](http://publib.boulder.ibm.com/infocenter/systems/scope/i5os/index.jsp?topic=/rzahg/rzahgcobol.htm)

我对这种语言知之甚少，所以我无法告诉您有多少语言信息是特定于 IBM 的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-09T15:53:03.637

还有：

[http://www.amazon.com/Sams-Teach-Yourself-COBOL-Hours/dp/0672314533/ref=sr_1_1?ie=UTF8&s=books&qid=1234194482&sr=8-1](https://rads.stackoverflow.com/amzn/click/com/0672314533)说它带有免费的富士通编译器据我所知，不再可供下载

和

[http://www.amazon.com/Sams-Teach-Yourself-COBOL-Days/dp/0672317885/ref=sr_1_4?ie=UTF8&s=books&qid=1234194482&sr=8-4](https://rads.stackoverflow.com/amzn/click/com/0672317885)

此外，Murach 的书应该非常好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-06-08T13:37:22.677

查看简单的[COBOL 教程](http://mainframeopenbook.com/Content/COBOL/Tutorial.html)和一些[COBOL 示例程序](http://mainframeopenbook.com/Content/COBOL/Samples.html)

# asp.net-mvc - 使用 MVC 框架 RC1 更新断开连接的 LINQ 对象

> ID：508965
> 
> 赞同：5
> 
> 时间：2009-02-03T21:27:20.747
> 
> 标签：asp.net-mvc, linq-to-sql

这有点过时，但我有一个客户对象返回到我的控制器。我只想将此对象重新连接回数据库，这可能吗？我知道有一个datacontext.customers.insertonsubmit(customer)，但是有没有等效的datacontext.customers.updateonsubmit(customer)？？？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T22:11:18.443

这就是我不喜欢 LINQ-to-SQL 的地方。

如果您在同一范围内查询和更新，它通常可以正常工作，但是如果您获取一个对象，缓存它，然后稍后尝试更新它，您就不能。

这是文档中的内容：

> 将 Attach 方法用于已在一个 DataContext 中创建并序列化到客户端，然后反序列化以执行更新或删除操作的实体。因为新的 DataContext 无法跟踪断开连接实体的原始值，所以客户端负责提供这些值。在此版本的 Attach 中，假定实体处于其原始值状态。调用此方法后，您可以更新其字段，例如使用从客户端发送的附加数据。
> 
> 不要尝试附加未通过序列化分离的实体。尚未序列化的实体仍保持与延迟加载器的关联，如果实体被第二个数据上下文跟踪，可能会导致意外结果。

恕我直言有点模棱两可，特别是关于“序列化”和“反序列化”的确切含义。

另外，有趣的是，这里是关于 DataContext 对象的说明：

> 通常，DataContext 实例旨在持续一个“工作单元”，但是您的应用程序定义了该术语。DataContext 是轻量级的，创建起来并不昂贵。典型的 LINQ to SQL 应用程序在方法范围内创建 DataContext 实例，或者将其作为表示一组相关数据库操作的逻辑集的短期类的成员。

So, DataContexts are intended to be tightly scoped - and yet to use Attach(), you have to use the same DataContext that queried the object. I'm assuming/hoping we're all completely misunderstanding what Attach() is really intended to be used for.

What I've had to do in situations like this is re-query the object I needed to update to get a fresh copy, and then do the update.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T22:02:24.997

您从表单发布的客户将没有实体键，因此可能无法很好地附加，而且您可能不会在表单上提供客户的每个字段，因此可能不会设置所有字段。

我建议使用 TryUpdateModel 方法，在您的操作中，您必须再次从数据库中获取客户并使用表单的发布变量更新它。

```
public ActionResult MySaveAction(int id, FormCollection form)
{
    Customer updateCustomer = _Repository.GetCustomer(id);

    TryUpdateModel(updateCustomer, "Customer", form);

    _Repository.Save(updateCustomer);
} 
```

当然，您必须添加所有自己的异常处理和验证，但这是一般的想法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T21:35:24.240

您想在数据上下文的客户表上使用 attach 方法。

```
datacontext.customers.Attach(customer); 
```

将其重新连接到数据上下文。然后您可以使用`SubmitChanges()`更新数据库中的值。

**编辑**：这仅适用于通过序列化与原始数据上下文分离的实体。如果您不介意对数据库的额外调用，您可以使用 ASP.NET MVC 中的惯用方法再次检索对象并按照 @Odd 的建议通过 UpdateModel 或 TryUpdateModel 应用您的更改。

# python - 如何用 Python 覆盖文件中间的一些字节？

> ID：508983
> 
> 赞同：24
> 
> 时间：2009-02-03T21:31:53.733
> 
> 标签：python, file, patch

我希望能够使用 Python 覆盖文件中给定偏移量的一些字节。

我的尝试惨遭失败并导致：

*   覆盖偏移处的字节，但也会在之后截断文件（文件模式=“w”或“w+”）
*   在文件末尾附加字节（文件模式=“a”或“a+”）

是否可以通过 Python 以可移植的方式实现这一目标？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-02-03T21:39:57.193

尝试这个：

```
fh = open("filename.ext", "r+b")
fh.seek(offset)
fh.write(bytes)
fh.close() 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-03T21:39:43.357

根据[这个 python 页面](http://www.sthurlow.com/python/lesson10/)，您可以键入 file.seek 来寻找特定的偏移量。然后你可以写任何你想要的。

为避免截断文件，您可以使用“a+”打开它，然后寻找正确的偏移量。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-03T21:44:25.127

非常低效，但我现在不知道任何其他方式，**它不会覆盖**中间的字节（就像 Ben Blanks 所做的那样）：

```
a=file('/tmp/test123','r+')
s=a.read()
a.seek(0)
a.write(s[:3]+'xxx'+s[3:])
a.close() 
```

将在偏移量 3 处写入“xxx”：`123456789 --> 123xxx456789`

# version-control - 更改 CVS Tortoise 合并中的“Yours”和“Mine”名称

> ID：508985
> 
> 赞同：4
> 
> 时间：2009-02-03T21:32:27.617
> 
> 标签：version-control, merge, cvs, tortoisecvs

我使用 Tortoise 与 CVS 交互以进行源代码控制。合并时，它会显示文件的差异，分别称为 HD 上的文件“Yours”和存储库中的文件“Mine”。或者也许我有倒退。正如你所看到的，命名法让我感到困惑。然后我还必须尝试记住要合并到哪个。

是否有更改该命名方案的设置？也许是“OnHD”和“FinalInRep”。

**更新 1**

马克戴维森，按照你的规定改变你和我的

> 我还没有测试它，但去
> 
> 1.  TortoiseCVS-首选项
> 2.  工具选项卡
> 3.  双向合并参数
> 
> 因为它目前已经设置了“%mine”“%yours”，所以您可能可以将它们更改为其他内容，但尚未对其进行测试。

更改我的差异工具查找的路径，而不是 CVS 所称的文件。因此，它不会改变 CVS 显示的内容，它会破坏我的合并工具。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T21:53:49.383

我还没有测试它，但去

1.  TortoiseCVS-首选项
2.  工具选项卡
3.  双向合并参数

因为它目前已经设置了“%mine”“%yours”，所以您可能可以将它们更改为其他内容，但尚未对其进行测试。

# asp.net - 如何注册嵌套列表视图

> ID：508992
> 
> 赞同：0
> 
> 时间：2009-02-03T21:34:21.777
> 
> 标签：asp.net, ajax.net

有嵌套的列表视图，我想在第二个列表视图中向脚本管理器注册一个按钮，以更新母版页内的更新面板？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T21:39:56.493

如果它是一个按钮，您可以在代码隐藏中附加它，否则使用 ListView.FindControl，如果它是按钮列表，您可能希望将列表视图包装在单独的更新面板中，然后在 ListView 手动调用 Update() 上的 itemcommand 事件在原始更新面板上

# asp.net - Asp.Net、DropDownList、AutoPostBack 和 Google Chrome

> ID：508994
> 
> 赞同：12
> 
> 时间：2009-02-03T21:34:34.053
> 
> 标签：asp.net, drop-down-menu, google-chrome, autopostback

我有一个简单的 asp.net 页面（框架 3.5）和一个带有一系列下拉列表的 UpdatePanel，我想异步填充。在所有主流浏览器（Opera、Safari、IE6、IE7、FF3）中一切正常，但在 Chrome 中却不行。

Chrome 似乎忽略了必须发出异步请求的 SelectedIndexChanged 事件。

任何人都知道一个简单的解决方法吗？谢谢！

编辑：更多信息

正如我对 Adam Lassek 所说，更新面板在单击其中的 asp:Button 后刷新，但它不适用于下拉菜单的`SelectedIndexChanged`事件。

更新面板设置如下：

```
<asp:UpdatePanel ID="updPanel" runat="server" UpdateMode="Always" ChildrenAsTriggers="true"> 
```

没有指定触发器，并且下拉菜单有集合`AutoPostBack="true"`

**更新：（**和重新标记）

经过几次尝试，我发现这不是 UpdatePanel 的问题，但似乎下拉菜单的 AutoPostback 无法正常工作，即使在没有 ScriptManager 和 UpdatePanel 的页面中也是如此......我确定这是一个问题只涉及这个项目，因为如果我从头开始一个新的网站并复制它的结构，在 Chrome 中工作正常......我正在尝试逐步删除原始项目中的所有其他内容，以找到确切的内容问题。

如果有人在此期间有一些想法......

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-10T11:48:47.233

已知与**Ajax.NET**和**Chrome** & **Safari 3**不兼容。

小而快速的测试可能具有欺骗性，因为它看起来可以与现有的 Ajax.NET 库一起正常工作。这是因为它成功地执行了**第一个**Ajax 请求并在请求结束时失败，所以只有当您尝试执行**第二个**Ajax 操作时，您才会注意到它失败了。如果您在页面上放置了**UpdateProgress**控件，您会注意到在第一次请求之后您的**UpdateProgress**控件不会消失。

幸运的是，有一个答案！

最近有一篇很棒的帖子详细介绍了您可以在此处找到的操作：

[http://blog.turlov.com/2009/01/aspnet-ajax-compatibility-patch-for.html](http://blog.turlov.com/2009/01/aspnet-ajax-compatibility-patch-for.html)

它的一般要点是 Chrome 和 Safari 3 在其 userAgent 字符串中将自己报告为**WebKit**。

您需要添加一些 javascript 来帮助 Ajax.NET 框架识别基于 WebKit 的浏览器，如下所示：

```
if (typeof(Sys.Browser.WebKit) == "undefined") {
    Sys.Browser.WebKit = {};
}

if (navigator.userAgent.indexOf("WebKit/") > -1 ) {
    Sys.Browser.agent = Sys.Browser.WebKit;
    Sys.Browser.version = 
        parseFloat(navigator.userAgent.match(/WebKit\/(\d+(\.\d+)?)/)[1]);
    Sys.Browser.name = "WebKit";
} 
```

您需要将其添加到 javascript 文件并在**ScriptManager**中引用它：

```
<asp:ScriptManager ID="ScriptManager1" runat="server">
    <Scripts>
        <asp:ScriptReference Path="~/assets/javascript/WebKit.js" />
    </Scripts>
</asp:ScriptManager> 
```

请注意，您可以将**WebKit.js**保存在程序集中并通过使用类似于以下的 ScriptReference 标记来引用它：

```
<asp:ScriptReference Assembly="Scripts" Name="Scripts.webkit.js" /> 
```

一旦你完成了所有这些，如果可能的话，停止使用 WebForms 和 Ajax.NET 并使用 MVC 和 jQuery :)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-04T00:04:46.747

发生这种情况是因为 MicrosoftAjax.js 进行浏览器检测，并且它错误地将 Chrome 检测为 Safari。为了解决此问题，您需要进行以下更改：

添加新的浏览器类型

```
Sys.Browser = {};
Sys.Browser.InternetExplorer = {};
Sys.Browser.Firefox = {};
Sys.Browser.Safari = {};
Sys.Browser.Opera = {};
Sys.Browser.Chrome = {}; 
```

更新 if-then 逻辑以搜索 Chrome

```
else if (navigator.userAgent.indexOf(' Firefox/') > -1) {
    Sys.Browser.agent = Sys.Browser.Firefox;
    Sys.Browser.version = parseFloat(navigator.userAgent.match(/ Firefox\/(\d+\.\d+)/)[1]);
    Sys.Browser.name = 'Firefox';
    Sys.Browser.hasDebuggerStatement = true;
}

else if (navigator.userAgent.indexOf(' Chrome/') > -1) {
    Sys.Browser.agent = Sys.Browser.Chrome;
    Sys.Browser.version = parseFloat(navigator.userAgent.match(/ Chrome\/(\d+\.\d+)/)[1]);
    Sys.Browser.name = 'Chrome';
    Sys.Browser.hasDebuggerStatement = true;
}
else if (navigator.userAgent.indexOf(' AppleWebKit/') > -1) {
    Sys.Browser.agent = Sys.Browser.Safari;
    Sys.Browser.version = parseFloat(navigator.userAgent.match(/ AppleWebKit\/(\d+(\.\d+)?)/)[1]);
    Sys.Browser.name = 'Safari'; 
```

请务必将 Chrome 检查放在 Safari 之前。如果您需要帮助将框架脚本替换为您的自定义版本，[请阅读此](http://aspadvice.com/blogs/joteke/archive/2007/02/16/Replace-_2200_Framework_2200_-scripts-in-ASP.NET-Ajax.aspx)。

**更新：**

我创建了一个测试页面并在其上放置了以下控件：

```
<asp:ScriptManager ID="scriptManager1" runat="server" />
<asp:UpdatePanel ID="panel1" runat="server" ChildrenAsTriggers="true">
  <ContentTemplate>
    <asp:DropDownList ID="ddlTest" runat="server" AutoPostBack="true">
      <asp:ListItem Value="0" Text="Item 1" />
      <asp:ListItem Value="1" Text="Item 2" />
    </asp:DropDownList>
    <asp:Literal ID="litTest" runat="server" />
  </ContentTemplate>
</asp:UpdatePanel> 
```

并在后面编写了以下代码：

```
protected override void OnInit(EventArgs e)
{
    ddlTest.SelectedIndexChanged += new EventHandler(ddlTest_SelectedIndexChanged);
    base.OnInit(e);
}

void ddlTest_SelectedIndexChanged(object sender, EventArgs e)
{
    litTest.Text = "Selected: " + ddlTest.SelectedItem.Text;
} 
```

Updatepanel 在 Chrome 中运行良好，无需修改 Ajax 库。所以，我认为是其他原因导致了这个问题。您将需要通过消除过程来隔离问题的原因。从像这个例子这样简单的事情开始，一次完成你所拥有的作品。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-12T18:04:04.717

使用 MVC 和 jQuery 代替 WebForms 和 ASP.NET AJAX 不是一个合适的建议。人们应该了解可供选择的技术和方法的所有优缺点。

首先，MVC 是一种设计模式，与提到的特定框架无关。您可以使用 WebFroms 轻松实现 MVC 模式。ASP.NET 和 WebForms 有许多不同的 MVC 实现。

其次，jQuery 是一个很棒的 JavaScript 库，它不允许与服务器端 ASP.NET 功能进行任何集成，也不会利用它，这与 ASP.NET 3.5+ 标配并充分利用 ASP 的 ASP.NET AJAX 框架相反。 NET 特性，如服务器端标记、ScriptManager 控件、服务器端脚本组合、本地化和全球化等。

第三，jQuery 可以很容易地与 ASP.NET 和 ASP.NET AJAX 框架结合使用，从而增强客户端编程。Microsoft 宣布 jQuery 将与下一个 ASP.NET 4.0 一起提供，现在您只需手动将其添加到您的项目中即可。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T22:22:57.100

我今天刚刚遇到了一个类似的问题（虽然我没有使用 Ajax），并找到了解决方法。请参阅[此博客文章](http://weblogs.asp.net/stefansedich/archive/2008/11/04/bug-with-latest-google-chrome-and-asp-net-validation.aspx)的第三条评论。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-01T02:06:09.013

我也有同样的问题。我在 ajax 回发中有一个下拉菜单，需要在所选索引更改时进行更新。它也适用于新项目中的基本页面。

添加其他答案中提到的 Webkit 脚本后，我仍然遇到相同的问题，并且在 Chrome 中运行 javascript 调试器时出现此错误：

> 未捕获的异常 ReferenceError: 未定义 evt

**更新：解决方案**

我发现在我的情况下，它是一个 CustomValidator 干扰了事件处理程序。将 EnableClientScript 设置为 false 可解决此问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-19T03:55:18.087

## 您可以查看解决方案

[http://dotnetguts.blogspot.com/2009/05/dropdownlist-autopostback-problem-with.html](http://dotnetguts.blogspot.com/2009/05/dropdownlist-autopostback-problem-with.html)

# jquery - jquery 可以在 iphone 的 safari 上运行吗？

> ID：508995
> 
> 赞同：6
> 
> 时间：2009-02-03T21:34:49.687
> 
> 标签：jquery, iphone, plugins, safari

我正在一个网站上工作，我使用 slimbox2 插件（类似于 lightbox）为 jquery 生成照片放大。

该插件适用于我尝试过的所有浏览器，但 iPhone 上的 Safari 除外。它在 Safari for Windows 上确实可以正常工作，但在 iphone 上存在两个问题：

*   页面其余部分的变暗仅发生在页面顶部，大约是视口的高度（假设页面的顶部 400 像素），下面的所有内容都保持原样。
*   较大的图像本身恰好位于页面的中间，而不是视口的中间。

我在这里的某个地方读到了 jquery 应该可以在 iphone 上正常工作，但是由于定位和淡入淡出似乎是基本的 jquery 功能，我认为这可能并不完全正确。当然也可以是插件...

所以我的问题是：jquery 真的在 iphone 上工作吗，如果没有，有人知道如何让它工作吗？

非常感谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T22:56:45.777

jQuery 在 iPhone 上运行良好。移动 Safari 是与桌面相同的基于标准的浏览器。实际上，在某些 CSS 规则采用方面更好。任何类型的 JavaScript 都可以正常运行，只要它适合 iPhone 的 UI 差异（例如，没有鼠标悬停）。

我认为这个问题最好表述为“Slimbox2 是否可以与 Mobile Safari 一起使用？”

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-09-14T21:27:03.473

我知道这已经有一年半的历史了，但如果这对其他人有帮助的话，那就去吧：

我的猜测是，这可能是您的插件`position:fixed`用于创建叠加层（您提到的“页面变暗”）以及较大图像本身的容器的问题。在 Mobile Safari 上对 position:fixed 进行网络搜索将为您提供有关此主题的大量进一步阅读！

似乎因为 Mobile Safari 将“视口”视为*整个页面*而不仅仅是可见部分，因此 position:fixed 往往无法像我们预期的那样工作。我在另一个 jQuery 插件上遇到了同样的问题，它为我创建了一个“模态”窗口，症状与你描述的非常相似。

我目前正在尝试通过（A）消除位置：固定并更改为位置：绝对，同时（B）根据主体的整个高度和窗口的“scrollTop”jquery属性手动设置高度和“顶部”来解决这个问题。我认为一些好的旧浏览器嗅探在这里可能会有所帮助，因为到目前为止，只有这个浏览器才真正需要这种“hack”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-03T21:40:31.233

堆栈溢出适用于 iPhone，根据 Jeff 在早期播客之一中的说法，堆栈溢出使用 jQuery，所以是的，jQuery 适用于 iPhone。

这可能是 Safari 中的错误。在苹果机器上试一试，看看它是否也能在那里工作。***************