# StackOverflow 问答 000385000-000385999

# c++ - 为什么在 C++ 中声明枚举时使用 typedef？

> ID：385023
> 
> 赞同：203
> 
> 时间：2008-12-21T22:02:00.807
> 
> 标签：c++, enums, typedef

我已经好几年没有写过任何 C++ 了，现在我正试图重新开始使用它。然后我遇到了这个并考虑放弃：

```
typedef enum TokenType
{
    blah1   = 0x00000000,
    blah2   = 0X01000000,
    blah3   = 0X02000000
} TokenType; 
```

这是什么？为什么在`typedef`这里使用关键字？为什么该名称`TokenType`在此声明中出现两次？语义与此有何不同：

```
enum TokenType
{
    blah1 = 0x00000000,
    blah2=0x01000000,
    blah3=0x02000000
}; 
```

* * *

## 回答 #1

> 赞同：168
> 
> 时间：2008-12-21T22:05:29.147

在 C 中，以第一种方式声明枚举允许您像这样使用它：

```
TokenType my_type; 
```

如果您使用第二种样式，您将被迫像这样声明您的变量：

```
enum TokenType my_type; 
```

正如其他人所提到的，这在 C++ 中没有什么不同。我的猜测是写这篇文章的人本质上是一个 C 程序员，或者你正在将 C 代码编译为 C++。无论哪种方式，它都不会影响代码的行为。

* * *

## 回答 #2

> 赞同：109
> 
> 时间：2008-12-21T22:07:02.387

It's a C heritage, in C, if you do :

```
enum TokenType
{
    blah1   = 0x00000000,
    blah2   = 0X01000000,
    blah3   = 0X02000000
}; 
```

you'll have to use it doing something like :

```
enum TokenType foo; 
```

But if you do this :

```
typedef enum e_TokenType
{
    blah1   = 0x00000000,
    blah2   = 0X01000000,
    blah3   = 0X02000000
} TokenType; 
```

You'll be able to declare :

```
TokenType foo; 
```

But in C++, you can use only the former definition and use it as if it were in a C typedef.

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-12-21T22:12:54.047

You do not need to do it. In C (not C++) you were required to use *enum Enumname* to refer to a data element of the enumerated type. To simplify it you were allowed to *typedef* it to a single name data type.

```
typedef enum MyEnum { 
  //...
} MyEnum; 
```

allowed functions taking a parameter of the enum to be defined as

```
void f( MyEnum x ) 
```

instead of the longer

```
void f( enum MyEnum x ) 
```

Note that the name of the typename does not need to be equal to the name of the enum. The same happens with structs.

In C++, on the other hand, it is not required, as enums, classes and structs can be accessed directly as types by their names.

```
// C++
enum MyEnum {
   // ...
};
void f( MyEnum x ); // Correct C++, Error in C 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2012-02-10T02:08:49.660

在 C 中，这是一种很好的风格，因为您可以将类型更改为除枚举之外的其他内容。

```
typedef enum e_TokenType
{
    blah1   = 0x00000000,
    blah2   = 0X01000000,
    blah3   = 0X02000000
} TokenType;

foo(enum e_TokenType token);  /* this can only be passed as an enum */

foo(TokenType token); /* TokenType can be defined to something else later
                         without changing this declaration */ 
```

在 C++ 中，您可以定义枚举，以便将其编译为 C++ 或 C。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2017-06-27T06:08:53.920

有人说 C 没有名称空间，但这在技术上是不正确的。它有三个：

1.  标签（`enum`、`union`和`struct`）
2.  标签
3.  （其他一切）

`typedef enum { } XYZ;`声明一个匿名枚举并将其导入到名为 的全局命名空间中`XYZ`。

`typedef enum ABC { } XYZ;``ABC`声明一个在标签命名空间中命名的枚举，然后将其作为`XYZ`.

有些人不想打扰单独的名称空间，所以他们 typedef 一切。其他人从不 typedef 因为他们想要命名空间。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-12-21T22:03:59.260

来自 C 的延期。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-08-30T18:29:31.927

这有点老了，但无论如何，我希望你会喜欢我即将输入的链接，因为我在今年早些时候遇到它时很欣赏它。

[在](https://mpark.github.io/programming/2016/05/12/typedef-literacy/)这里。当我必须掌握一些讨厌的 typedef 时，我应该引用我脑海中始终存在的解释：

> 在变量声明中，引入的名称是相应类型的实例。[...]但是，当`typedef`关键字在声明之前时，引入的名称是相应类型的别名

正如许多人之前所说，没有必要在**C++**中使用 typedef 来声明枚举。但这就是 typedef 语法的解释！我希望它有所帮助（可能不是 OP，因为它已经快 10 年了，但是任何正在努力理解这类事情的人）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-10-18T15:11:39.120

“为什么”问题的实际答案（这个旧问题的现有答案令人惊讶地忽略了这个问题）是这个`enum`声明可能位于一个头文件中，该文件旨在作为 C 和 C++ 代码交叉编译（即包含在 C 和 C++ 实现文件中）。编写此类头文件的艺术依赖于作者选择在两种语言中具有适当兼容含义的语言特征的能力。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-11-02T12:27:51.023

在一些 C 代码样式指南中，据说 typedef 版本是“清晰”和“简单”的首选。我不同意，因为 typedef 混淆了声明对象的真实性质。实际上，我不使用 typedef，因为在声明 C 变量时，我想清楚对象实际上是什么。这种选择有助于我自己更快地记住一段旧代码的实际作用，并在将来维护代码时帮助其他人。

# iphone - 是否可以只保存属性列表对象的修改部分？

> ID：385035
> 
> 赞同：1
> 
> 时间：2008-12-21T22:05:34.980
> 
> 标签：iphone, cocoa

可以将整个字典写入属性列表对象，但我想通过仅写出属性列表中已修改的部分来提高应用程序的效率。

假设我在根节点下有一个包含多个字典的属性列表。我想修改一本字典并保存它，但没有必要编写整个属性列表（包括未修改的字典）。有没有办法解决这个问题？谢谢你！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-21T23:08:01.860

There is no way to do what you want. However, you should be aware that CoreFoundation has been highly optimized for reading/writing plist files. You should not even begin to worry about something like this until it shows up in profiling as a bottleneck.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T22:12:10.007

If you are talking about writing the dictionary to a file, I don't think there is a way to get around saving the entire thing.

Changing one item could change the length of the file, which would change the positions of everything else in the file, so there would be no way to write only the changed items.

The only reason I could see for wanting to do this would be if you have an enormous file that changes often and takes a long time to write. If that is the case, perhaps you should split the property list up into smaller, more manageable sections that can be read and written individually.

# c++ - 是否存在“最终”构造在 C++ 中有用的情况？

> ID：385039
> 
> 赞同：6
> 
> 时间：2008-12-21T22:05:56.370
> 
> 标签：c++, raii, finally

Bjarne Stroustrup 在他的[C++ Style and Technique FAQ](http://www.research.att.com/~bs/bs_faq2.html#finally)中写道，强调我的：

> ***因为 C++ 支持几乎总是更好***的替代方案：“资源获取即初始化”技术（TC++PL3 第 14.4 节）。基本思想是用一个本地对象来表示一个资源，这样本地对象的析构函数就会释放资源。这样，程序员就不会忘记释放资源。例如：
> 
> ```
> class File_handle {
>     FILE* p;
> public:
>     File_handle(const char* n, const char* a)
>         { p = fopen(n,a); if (p==0) throw Open_error(errno); }
>     File_handle(FILE* pp)
>         { p = pp; if (p==0) throw Open_error(errno); }
> 
>     ~File_handle() { fclose(p); }
> 
>     operator FILE*() { return p; }
> 
>     // ...
> };
> 
> void f(const char* fn)
> {
>     File_handle f(fn,"rw"); // open fn for reading and writing
>     // use file through f
> } 
> ```
> 
> 在一个系统中，我们需要为每个资源创建一个“资源句柄”类。但是，我们不必为每次获取资源都有一个“finally”子句。在现实系统中，资源获取远多于资源种类，因此“资源获取即初始化”技术导致的代码比使用“finally”构造更少。

请注意，Bjarne 写的是“几乎总是更好”而不是“总是更好”。现在我的问题是：在什么情况下`finally`构造比在 C++ 中使用替代构造 (RAII) 更好？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-21T22:33:32.913

它们之间的区别在于析构函数通过将清理解决方案与所使用的类型相关联来强调对清理解决方案的重用，而 try/finally 则强调一次性清理例程。因此，当您有与使用点相关的唯一一次性清理要求时，try/finally 会更方便，而不是与您正在使用的类型相关联的可重用清理解决方案。

我没有尝试过（几个月没有下载最近的 gcc），但它应该是真的：在语言中添加 lambdas 后，C++ 现在可以有效地等效于`finally`，只需编写一个名为`try_finally`. 明显的用法：

```
try_finally([]
{
    // attempt to do things in here, perhaps throwing...
},
[]
{
    // this always runs, even if the above block throws...
} 
```

当然，你必须写 try_ `finally`，但只有一次，然后你就可以开始了。Lambda 支持新的控制结构。

就像是：

```
template <class TTry, class TFinally>
void try_finally(const TTry &tr, const TFinally &fi)
{
    try
    {
        tr();
    }
    catch (...)
    {
        fi();
        throw;
    }

    fi();
} 
```

GC 的存在与对 try/finally 而不是析构函数的偏好之间根本没有联系。C++/CLI 有析构函数和 GC。它们是正交的选择。Try/finally 和析构函数是对同一问题的稍微不同的解决方案，都是确定性的，需要不可替代的资源。

C++ 函数对象强调可重用性，但使一次性匿名函数很痛苦。通过添加 lambda，匿名代码块现在很容易制作，这避免了 C++ 传统上强调通过命名类型表达的“强制可重用性”。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-21T22:19:34.610

finally 与 C 代码连接时会更好。必须将现有的 C 功能包装在 RAII 中可能会很痛苦。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-21T22:31:46.177

我能想到 finally 块会“更好”的唯一原因是它需要更少的代码来完成同样的事情。例如，如果你有一个资源，由于某种原因不使用 RAII，你要么需要编写一个类来包装资源并在析构函数中释放它，要么使用 finally 块（如果它存在）。

比较：

```
class RAII_Wrapper
{
    Resource *resource;

public:
    RAII_Wrapper() : resource(aquire_resource()) {}

    ~RAII_Wrapper() {
        free_resource(resource);
        delete resource;
    }

    Resource *getResource() const {
        return resource;
    }
};

void Process()
{
    RAII_Resource wrapper;
    do_something(wrapper.resource);
} 
```

相对：

```
void Process()
{
    try {
        Resource *resource = aquire_resource();
        do_something(resource);
    }
    finally {
        free_resource(resource);
        delete resource;
    }
} 
```

大多数人（包括我）仍然认为第一个版本更好，因为它不会强迫您使用 try...finally 块。您还只需要编写一次类，而不是在每个使用资源的函数中重复代码。

**编辑：**就像提到的 litb 一样，您应该使用 auto_ptr 而不是手动删除指针，这将简化这两种情况。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-22T14:45:25.383

我认为[作用域守卫](http://www.ddj.com/cpp/184403758)在处理最终处理良好的一次性案例方面做得很好，同时在更一般的意义上更好，因为它可以很好地处理多个流路径。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-01-05T13:21:03.920

我发现的主要用途`finally`是在处理 C 代码时，正如其他人指出的那样，C 资源可能只在代码中使用一次或两次，并且不值得包装到符合 RAII 的结构中。也就是说，使用 lambdas，通过 dtor 调用我们在函数本身中指定的函数对象来调用一些自定义逻辑似乎很容易。

我发现的另一个用例是异国杂项代码，无论我们处于正常还是异常执行路径，都应该执行，例如打印时间戳或无论如何退出函数。这是一个非常罕见的情况，但对我来说，仅仅为它提供一个语言特性似乎有点过头了，而且现在使用 lambdas 仍然很容易，而不必为此编写一个单独的类。

在大多数情况下，我现在发现它的用例非常有限，而这些用例似乎并不能真正证明对语言进行如此大的改变是合理的。不过，我的小梦想是通过某种方式在对象的 dtor 内部判断该对象是通过正常执行路径还是异常执行路径被破坏。

这将简化作用域保护，不再需要`commit/dismiss`调用来接受更改，而不会在作用域保护被破坏时自动回滚。这个想法是允许这样做的：

```
ScopeGuard guard(...);

// Cause external side effects.
...

// If we managed to reach this point without facing an exception,
// dismiss/commit the changes so that the guard won't undo them
// on destruction.
guard.dismiss(); 
```

简单地变成这样：

```
ScopeGuard guard(...);

// Cause external side effects.
... 
```

我总是发现解除范围守卫的必要性有点尴尬而且容易出错，因为我有时忘记解除它们只是为了让它们撤消所有更改，让我摸不着头脑为什么我的手术似乎什么也没做，直到我意识到，*“哎呀，我忘了解散范围守卫。”* . 这是一件小事，但大多数情况下，我会发现消除显式范围保护解除的需要更加优雅，如果他们可以在析构函数中判断它们是否通过正常执行路径被销毁（此时点应该保留副作用）或特殊的（此时应该撤消副作用）。

这是最次要的事情，但在异常安全最难的领域中正确处理：回滚外部副作用。当涉及到正确地破坏本地资源时，我不能对 C++ 要求更多。它已经非常适合该目的。但是，在任何一开始就允许它们发生的语言中，回滚外部副作用总是很困难的，而且任何一点点帮助都可以让这种情况变得更容易，我总是很感激。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-21T23:19:11.383

**六个答案后编辑。**

这个如何：

```
class Exception : public Exception { public: virtual bool isException() { return true; } };
class NoException : public Exception { public: bool isException() { return false; } };

Object *myObject = 0;

try
{
  try
  {
    myObject = new Object(); // Create an object (Might throw exception)
  }
  catch (Exception &e)
  {
    // Do something with exception (Might throw if unhandled)
  }

  throw NoException();
}
catch (Exception &e)
{
  delete myObject;

  if (e.isException()) throw e;
} 
```

# sql - SQL Server 相当于 MySQL 的 NOW()？

> ID：385042
> 
> 赞同：216
> 
> 时间：2008-12-21T22:06:34.370
> 
> 标签：sql, sql-server

我是一名从事 SQL Server 项目的 MySQL 人员，试图获取一个日期时间字段来显示当前时间。在 MySQL 中，我会使用 NOW() 但它不接受。

```
INSERT INTO timelog (datetime_filed) VALUES (NOW()) 
```

* * *

## 回答 #1

> 赞同：241
> 
> 时间：2008-12-21T22:12:15.217

`getdate()`或`getutcdate()`。

* * *

## 回答 #2

> 赞同：82
> 
> 时间：2008-12-22T01:36:45.927

```
getdate() 
```

是直接等价的，*但您应该始终使用 UTC 日期时间*

```
getutcdate() 
```

您的应用程序是否跨时区运行 - 否则您将面临在春季/秋季转换时搞砸日期数学的风险

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2013-08-01T11:07:02.610

[`SYSDATETIME()`](http://msdn.microsoft.com/en-us/library/bb630353.aspx)和[`SYSUTCDATETIME()`](https://msdn.microsoft.com/en-us/library/bb630387.aspx)

是[DateTime2](http://msdn.microsoft.com/en-us/library/bb677335.aspx)的等价物

[`GetDate()`](http://technet.microsoft.com/en-us/library/ms188383.aspx)和[`GetUTCDate()`](http://technet.microsoft.com/en-us/library/ms178635.aspx)

它返回一个[DateTime](http://msdn.microsoft.com/en-us/library/ms187819.aspx)。

[DateTime2](http://msdn.microsoft.com/en-us/library/bb677335.aspx)现在是在 SQL Server 2008+ 中存储日期和时间的首选方法。请参阅以下[StackOverflow 帖子](https://stackoverflow.com/questions/1334143/sql-server-datetime2-vs-datetime)。

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2008-12-21T23:07:52.220

如果您想更符合 ANSI 标准，您也可以使用`CURRENT_TIMESTAMP`（尽管如果您在数据库供应商之间移植代码，那将是您最不必担心的问题）。它与幕后完全一样`GetDate()`（有关更多信息，请参阅[此问题](https://stackoverflow.com/questions/186572/retriving-date-in-sql-server-currenttimestamp-vs-getdate)）。

但是，没有 ANSI 等效项`GetUTCDate()`，如果您的应用程序在多个时区运行，您可能应该使用它...

# php - 圆形匹配。PHP/MySql

> ID：385052
> 
> 赞同：7
> 
> 时间：2008-12-21T22:12:26.403
> 
> 标签：php, mysql

嗨，我需要一些关于 php.ini 中以下场景的帮助。我有一个用户数据库，每个用户都有一个 ID、have_card 和 want_card。我知道如何进行直接匹配（一个用户与另一个用户进行交易）。但是，如果没有直接匹配但存在循环交换，例如：

用户 #1 有卡 A 想要卡 B

用户 #2 有卡 B 想要卡 C

用户 #3 有卡 C 想要卡 A

在这种情况下，两个用户之间没有直接匹配。但如果：

用户 #1 将他的卡交给用户 #3

用户 #3 将他的卡交给用户 #2

用户 #2 将他的卡交给用户 #1

皆大欢喜。

我必须开始的所有信息都是用户 #1 我如何找到用户 #2 和用户 #3？

感谢大家的回答。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-21T23:22:17.527

[有趣的是，我在BoardGameGeek Maths Trade](http://www.boardgamegeek.com/thread/93555)遇到了类似的事情。基本上，每个人都指定他们要么想要一个游戏，要么拥有一个游戏，并且算法最大化交易，包括循环依赖。

这正是你想要的。

以下是[TradeMaximizer 工作原理的说明](http://www.boardgamegeek.com/wiki/page/TradeMaximizer)。它使用[Dijkstra 算法](http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm)和[倾斜堆](http://en.wikipedia.org/wiki/Skew_heap)来找到最小匹配解决方案（即较小的圆比较大的圆更可取）。

当然这是在 Java 中创建的，但算法是通用的，您可以根据需要重新创建它，特别是在您了解它在做什么以及为什么之后。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T22:19:21.850

我会这样做：创建一个这样的递归算法：

1 拿一个用户，看看他想要什么

2 找到另一个拥有自己想要的用户的用户

```
- if user two wants, what user one has, everything is fine an we're done
- if not, continue 
```

3 找到另一个拥有用户二想要的东西的用户

```
- if user three wants, what user one has, everything is fine and we're done
- if not, continue ... 
```

...等等，但是您应该限制递归级别以防止无休止的搜索。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T22:38:25.897

也许是这样：

寻找可能的第一个匹配项（拥有用户#1 想要的卡的用户）

```
select name from user where has in (select wants from user where name = '1'); 
```

遍历这些匹配项并尝试找到丢失的链接：

```
select name from user where name in (select name from user where has in (select wants from user where name = <match>)); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-21T23:20:17.827

这是一个具有挑战性的场景。不久前，我不得不为一个图书交换应用程序构建它，并且使用白板我能够更轻松地查看并解决问题。

我所做的是在查询中多次使用同一个表，只是使用了不同的名称。

在我的场景中，需要的书籍与用户拥有的书籍位于单独的表中。希望您能够看到此查询中的逻辑：

```
$query = "SELECT 
        A.Owner_ID as Owner_1, C.Owner_ID as Owner_2, E.Owner_ID as Owner_3 
    FROM
        E_User_Books_Have as A, E_User_Books_Have as C, E_User_Books_Have as E,
        E_User_Books_Needed as B, E_User_Books_Needed as D,E_User_Books_Needed as F

    WHERE 
        A.Book_ID=D.Book_ID AND
        C.Book_ID=F.Book_ID AND
        E.Book_ID=B.Book_ID AND 
        A.Owner_ID='$ME' AND B.Owner_ID='$ME' AND A.ID='$ID'AND 
        C.Owner_ID=D.Owner_ID AND  
        E.Owner_ID=F.Owner_ID AND
        C.Owner_ID!='$ME' AND
        E.Owner_ID!='$ME'"; 
```

# c++ - 如何在不占用 CPU 的情况下进行大量处理？

> ID：385060
> 
> 赞同：1
> 
> 时间：2008-12-21T22:15:17.067
> 
> 标签：c++, ruby, memory, cpu, scaling

我知道问题标题不是最好的。让我解释。

我进行了大量的文本处理，将自然语言转换为 xml。这些文本文件上传速度相当快并被放入队列中。从那里它们被一个接一个地拉到后台工作程序中，该工作程序调用我们的解析器（使用 boost spirit）将文本转换为 xml 并将相关部分加载到我们的数据库中。

解析器一次可以做大约 100 个。我在后台工作人员上有限速器，现在只经常轮询我们的队列，因此它的执行速度不那么快。我现在不能抛出一个以上的后台工作人员，因为我的 http 请求开始下降——后台工作人员和网络服务器存在于同一台机器上，我*相信*这是因为 cpu 使用率达到 80-95%，尽管我们也可以使用更多的内存。

我需要更好地扩展它。你会怎么做呢？

在回答几个问题时：

*   我们使用亚马逊网络服务，因此购买廉价的额外硬件与生成一个新的亚马逊实例有点不同——也许有人做了一些代码来自动生成负载量的实例？

*   我们确实有一个 http 服务器，它只是将我们的文件塞入一个队列，所以它受到影响的唯一原因是因为 cpu 正忙于处理大量与解析相关的东西

*   我已经对我们的后台工作人员进行了速率限制，尽管我们没有在解析器本身中使用它

*   我还没有尝试过，但我过去使用过它——我需要为此写下一些基准

*   解析器与 Web 服务器完全分离——我们有 nginx/merb 作为我们的 Web/应用程序服务器和一个调用 c++ 的 rake 任务作为我们的后台工作者——但它们确实存在于同一台机器上

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-21T22:35:14.047

也许只是将后台工作人员置于较低的调度优先级（例如使用[nice](http://en.wikipedia.org/wiki/Nice_(Unix))）会有所帮助。这意味着您的服务器可以在需要时处理请求，但是当它不忙时，您可以全力以赴进行文本处理。

我认为它会给你带来比任意错开后台工作人员更多的好处。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-21T22:27:51.287

我会买几台便宜的电脑，然后对它们进行文本处理。正如 Jeff 在他的[最新帖子](http://www.codinghorror.com/blog/archives/001198.html)中所说，“始终尝试通过投入更快的硬件来**解决性能问题。”**

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-21T22:36:52.000

我不确定我是否完全按照你的问题，但听起来你有一个 HTTP 引擎来提供工作待处理队列。正确的？后台线程正在接受这些队列请求并完成繁重的工作，对吗？

因此，听起来后台进程受计算限制，而前台进程本质上受 I/O 限制……或者至少受新工作提交率的限制。

优化此类进程的最佳方法是将后台进程设置为低于前台进程的优先级。这可确保后台进程始终有工作要做。然后，您将进程之间的队列深度设置为向上，使其大小限制为您希望一次待处理的最大工作量。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-21T22:49:30.197

如果您有此功能，我已经完成的一件事是将这些解析服务移至云托管服务。

我已经将我的一些分布式服务（搜索引擎、群发电子邮件、错误日志记录）从我的主计算机移到了云计算服务上，这对我们的主 Web 服务器来说是一个极好的负载。

此外，云计算变得更加便宜并且几乎可以无限扩展。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-04T12:07:06.870

我不明白为什么你会担心你的 CPU 是 100%。如果一项工作需要完成，并且不受 IO 限制，那么您的 CPU*应该*是 100%。

剩下的是：

*   您是否有足够的 CPU 在可用时间内完成所有需要完成的工作？

如果不是，您需要更多的机器、更快的 CPU 或更高效的 CPU 算法。前两种选择可能比第三种便宜 - 取决于您企业的规模！

*   是否有一些工作需要比其他工作更具响应性？

听起来好像有。听起来您希望 HTTP 服务器具有响应性，而解析器作业可以按照自己的速度完成（只要队列清空速度快于填充速度）。正如其他人指出的那样，nice 告诉操作系统分配低优先级进程，在高优先级进程获得所需的 CPU 周期后“剩余”（尽管它并不像那样黑白分明）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-21T22:33:23.223

我假设您有多个线程，每个线程属于两个组之一

*   下载文本文件的 A 组
*   将文本转换为 xml 的组 B

如果您认为 B 组限制了您的吞吐量，我会将其线程设置为较低的优先级。如果有足够的工作，CPU 仍然会 100% 使用，但不会影响下载。

如果我的上述假设是正确的，那么您还应该使用多核和多 cpu 机器，因为您的性能应该随着更多 CPU 很好地扩展。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-21T22:38:48.657

我会把解析器放在自己的机器上。这样它就不会影响Web服务器。

如果您没有购买另一台机器的预算，则使用虚拟化（如果您的 Web 服务器托管在 Ubuntu 或 CentOS 上， [OpenVZ](http://wiki.openvz.org/Main_Page)很酷）来限制解析器的 CPU 配额。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-21T22:55:08.483

如果您在处理中断请求时遇到问题，您可以尝试提高 CPU 绑定任务的友好度。然后是 HTTP 服务器的好处。基本上，尝试使用系统的调度程序来发挥自己的优势，不要将所有任务视为平等。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-21T23:39:31.687

我不知道您使用的是什么操作系统，但它们中的大多数都具有指定线程/进程优先级的功能。只要解析器进程的优先级低于 HTTP 进程，*应该*没问题。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-02T19:49:38.977

永远不要忘记电费/托管价格。尝试使用探查器查找代码中的瓶颈。如果您从未这样做过，我相信您可以将 CPU 消耗降低到 25-50%

# objective-c - 在 Objective-C 中使用 NSAttributedString 处理字符串

> ID：385061
> 
> 赞同：1
> 
> 时间：2008-12-21T22:17:33.957
> 
> 标签：objective-c, cocoa, string

我有一个 NSAttributedString`s`和一个整数`i`，我想要一个函数，它接受`s`并`i`返回一个新的 NSAttributedString，它`i`前面有一个（字符串化） `s`。

它看起来像是 , 和 的某种组合`-stringWithFormat:`，`-initWithString:`并且`-insertAttributedString:`会这样做，但是如果没有很多卷积和临时变量，我很难将它拼凑在一起。

更一般地说，关于理解 NSAttributedString 和 NSMutableAttributedString 的指南的指针会很棒。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-21T23:50:38.467

我想我找到了另一种方法：

```
// convert it to a mutable string
NSMutableAttributedString *newString;
newString = [[NSMutableAttributedString alloc] initWithAttributedString:old];

// create string containing the number
NSString *numberString = [NSString stringWithFormat:@"%i", i];

// append the number to the new string
[newString replaceCharactersInRange:NSMakeRange([newString length] - 1, 0) 
                         withString:numberString]; 
```

我认为这很有效，因为[Apple 的文档](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/Foundation/Classes/NSMutableAttributedString_Class/Reference/Reference.html#//apple_ref/occ/instm/NSMutableAttributedString/replaceCharactersInRange:withString:)说：

> **- (void)replaceCharactersInRange:(NSRange)aRange withString:(NSString *)aString**
> 
> 新字符从 aRange 继承第一个替换字符的属性。如果 aRange 的长度为 0，则新字符继承 aRange 前面的字符的属性（如果有的话），否则继承 aRange 后面的字符的属性。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-21T22:43:32.067

此处的指针：[属性字符串编程指南](http://developer.apple.com/documentation/Cocoa/Conceptual/AttributedStrings/AttributedStrings.html)

简短的回答是使用 NSMutableAttributedString——因为它继承自 NSAttributedString，你可以在任何你使用（不可变的）NSAttributedString 的地方使用它。

新创建的 NSMAS 可以使用 setAttributedString: 方法获取 NSAS 的内容和属性。然后，您可以随意替换CharactersInRange: 或 deleteCharactersInRange: 或 insertAttributedString: atIndex: 到您心中的内容。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-22T00:29:49.933

感谢 adium 开发人员的 IRC 频道上的友好人士。它需要一个`NSAttributedString s`和一个整数`i`。

```
return [[[NSMutableAttributedString alloc] 
         initWithString:[NSString stringWithFormat:@"%i %@", i, [s string]]]
        autorelease]; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-08-26T19:34:11.183

如果您有多个属性字符串要放在另一个属性字符串中，您可以使用我写的这个类别：

但是，您必须将 NULL 作为函数的最后一个参数传递，否则它将崩溃到 va_list 对检测大小的限制。

[attributedString stringWithFormat:attrFormat, attrArg1, attrArg2, NULL];

```
@implementation NSAttributedString(stringWithFormat)

+(NSAttributedString*)stringWithFormat:(NSAttributedString*)format, ...{
    va_list args;
    va_start(args, format);

    NSMutableAttributedString *mutableAttributedString = (NSMutableAttributedString*)[format mutableCopy];
    NSString *mutableString = [mutableAttributedString string];

    while (true) {
        NSAttributedString *arg = va_arg(args, NSAttributedString*);
        if (!arg) {
            break;
        }
        NSRange rangeOfStringToBeReplaced = [mutableString rangeOfString:@"%@"];
        [mutableAttributedString replaceCharactersInRange:rangeOfStringToBeReplaced withAttributedString:arg];
    }

    va_end(args);

    return mutableAttributedString;
}
@end 
```

# web-crawler - 如何保护/监控您的网站不被恶意用户抓取

> ID：385069
> 
> 赞同：2
> 
> 时间：2008-12-21T22:25:16.097
> 
> 标签：web-crawler, screen-scraping, monitoring

情况：

*   内容受用户名/密码保护的网站（并非全部受控，因为他们可以是试用/测试用户）
*   由于用户名/密码限制，普通搜索引擎无法获取
*   恶意用户仍然可以登录并将会话 cookie 传递给“wget -r”或其他东西。

问题是什么是监控此类活动并对其做出响应的最佳解决方案（考虑到网站政策是不允许抓取/抓取的）

我可以想到一些选择：

1.  设置一些流量监控解决方案来限制给定用户/IP 的请求数量。
2.  与第一点相关：自动屏蔽部分用户代理
3.  （邪恶:)）设置一个隐藏链接，当访问该链接时会注销用户并禁用他的帐户。（大概普通用户不会访问它，因为他不会看到它来点击它，但机器人会抓取所有链接。）

对于第 1 点，您是否知道已经实施的良好解决方案？有什么经验吗？一个问题是，对于非常活跃的人类用户，可能会出现一些误报。

对于第 3 点：你认为这真的很邪恶吗？或者你看到它有任何可能的问题吗？

也接受其他建议。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-21T23:18:07.033

我不会推荐自动锁定，不是因为它们必然是邪恶的，而是因为它们向恶意用户提供他们触发传感器的即时反馈，并让他们知道不要对他们签署的下一个帐户做同样的事情跟上。

并且用户代理阻止可能不会很有帮助，因为显然用户代理很容易伪造。

您可能做的最好的事情就是监控，但是如果您检测到恶意行为，您仍然必须询问您将要做什么。只要您拥有不受控制的访问权限，您锁定的任何人都可以使用不同的身份再次注册。我不知道您需要什么样的信息才能获得一个帐户，但例如，只需一个姓名和电子邮件地址，对任何人来说都不会成为太大的障碍。

这是典型的 DRM 问题——如果任何人都可以看到信息，那么任何人都可以用它做任何他们想做的事情。你可以让它变得困难，但最终如果有人真的下定决心，你就无法阻止他们，而且你可能会干扰合法用户并损害你的业务。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-21T22:39:00.997

第1点有你自己提到的问题。此外，它也无助于网站的较慢爬网，或者如果确实如此，那么对于合法的重度用户来说可能会更糟。

您可以将第 2 点转过来，只允许您信任的用户代理。当然，这对伪造标准用户代理的工具没有帮助。

第 3 点的一个变体就是向网站所有者发送通知，然后他们可以决定如何处理该用户。

同样，对于我对第 2 点的变体，您可以将其设为更柔和的操作，并通知某人正在使用奇怪的用户代理访问该站点。

*编辑：相关，当我访问我自己的不公开的 URL 时，我曾经遇到过一个奇怪的问题（我只是在登台一个我没有在任何地方宣布或链接的网站）。尽管除了我之外没有人应该知道这个 URL，但突然间我注意到日志中有点击。当我找到它时，我发现它来自某个内容过滤网站。原来我的移动 ISP 使用了第三方来阻止内容，它拦截了我自己的请求——因为它不知道该站点，然后它获取了我试图访问的页面，并且（我假设）做了一些关键字分析为了决定是否阻止。这种事情可能是您需要提防的尾端情况。*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T23:17:16.130

取决于我们谈论的是哪种恶意用户。

如果他们知道如何使用 wget，他们可能每次都可以设置 Tor 并获取新 IP，慢慢复制您拥有的所有内容。我认为您无法在不给您的（付费？）用户带来不便的情况下阻止这种情况。

它与游戏、音乐、视频上的 DRM 相同。如果最终用户应该看到某些东西，您就无法保护它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T01:25:40.443

简短的回答：它不能可靠地完成。

您可以通过简单地阻止在某个时间范围内导致一定数量的点击的 IP 地址来走很长的路（一些网络服务器支持这个开箱即用，其他需要一些模块，或者您可以通过解析您的日志文件来做到这一点，例如使用 iptables )，但您需要注意不要阻止主要的搜索引擎爬虫和大型 ISP 的代理。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T22:45:16.570

选项 3 的问题是，一旦爬虫弄清楚发生了什么，自动注销将是微不足道的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-21T22:53:19.393

@frankodwyer：

*   只有受信任的用户代理不起作用，尤其要考虑被插件或 .net 版本修改的 IE 用户代理字符串。有太多的可能性，它可以被伪造。
*   第 3 点的变化。通知管理员可能会起作用，但如果管理员不经常监控日志，这将意味着不确定的延迟。

@格雷格休吉尔：

*   自动注销也会禁用用户帐户。至少必须创建一个新帐户，留下更多的痕迹，如电子邮件地址和其他信息。

随机更改 3\. 的 logout/disable-url 会很有趣，但不知道我将如何实现它:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-21T23:20:53.347

[http://recaptcha.net](http://recaptcha.net)

每次有人登录或注册时。也许你可以每十次显示一个验证码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-21T23:34:11.853

添加评论：

*   我知道您无法完全保护普通用户应该能够看到的东西。我一直在问题的双方:)
*   从开发人员的角度来看，您认为花费时间与受保护案例的最佳比例是多少？我猜一些简单的用户代理检查会删除一半或更多的潜在爬虫，我知道你可以花几个月的时间来开发以防止最后 1%

同样，从服务提供商的角度来看，我也很感兴趣一个用户（爬虫）不会为其他用户消耗 cpu/带宽，所以您可以指出任何好的带宽/请求限制器吗？

回复评论：平台规范：基于在 JBoss AS 上运行的 JBoss Seam 的应用程序。但是前面有一个apache2。（在 Linux 上运行）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-07T08:59:25.530

Apache 有一些 IP 带宽限制模块 AFAIK，对于我自己的包含大量数字内容的大型 Java/JSP 应用程序，我推出了自己的 servlet 过滤器来做同样的事情（并限制来自一个 IP 块的同时连接等）。

我同意上面的评论，最好是微妙的，这样恶意用户就无法判断他们是否/何时触发了您的警报，因此他们不知道采取规避行动。在我的情况下，我的服务器似乎变得缓慢、不稳定和不可靠（所以那里没有改变）......

Rgds

达蒙

# .net - VS.NET 2003 和 VS.NET 2008 共存

> ID：385077
> 
> 赞同：1
> 
> 时间：2008-12-21T22:32:39.637
> 
> 标签：.net, visual-studio-2008, visual-studio-2003

我正在将 VS2003 项目 (.NET 1.1) 转换为 VS2008 (.NET 2.0) 并且已经转换了所有 C# (很容易)。我得到了一台新机器，并在 VS2008 上进行了 C# 转换。由于一些内存保护问题，我们有一个 C++ 层不能在 .NET 2.0 下工作。

C++ 层相当古老，是几年前由一些分包商编写的——它的代码不是很好......

我的旧机器安装了带有我们的 C/C++ 层（与 Visibroker 对话）的 VS 2003，当该机器上的硬盘崩溃时，我还没有完成 C 部分的转换。

我没有时间修复 C++ 位的 .NET 2.0 转换，所以仍然需要在 VS 2003 下构建。

问题是：我可以在VS2008**之后安装VS 2003吗？**会把事情搞砸吗？由于公司政策，不能将其安装在 VM 中。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-21T23:06:56.073

前段时间我遇到了同样的情况，并在已经安装了 VS 2008 的（虚拟）PC 上安装了 VS 2003。不幸的是，我不记得在安装 VS 2003 后是否对 VS 2008 安装进行了“修复”，但我认为它确实有效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-21T23:56:04.493

我上周不得不这样做。在 2008 之后安装 2003 就可以了。唯一似乎搞砸了的是，现在所有的 VS 图标看起来都像 Windows 中的旧 2003 图标。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T23:03:59.090

我同时运行了 vs2003 和 vs2008。我相信在 2008 年之后安装 2003 的最坏情况是需要重新安装 2008。

我会继续尝试，但除非我有大部分时间去做，否则我不会开始。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-05T14:51:14.833

在 2008 之后安装 vs.net 2003 就可以了，唯一的问题是 vs.net 版本自动检查器可能不起作用。例如，如果你在 2003 之后安装 2008，如果你双击一个项目文件或解决方案文件，将打开正确版本的 vs.net，根据它的实际版本。但如果反过来，.net 2003 版本检查器将覆盖 2008，如果双击旧版本的项目文件，它将无法打开 vs.net2008。只需重新安装 2008 即可解决此问题。

# debugging - 你很久没发现的最愚蠢的 bug 是什么？

> ID：385082
> 
> 赞同：6
> 
> 时间：2008-12-21T22:34:20.773
> 
> 标签：debugging, language-agnostic

我正在从事一个行为不端的项目，由于某些原因，即使应该有异常也没有抛出。在内心深处，我发现了这种错误处理：

```
try {
    m.invoke(parentObject, paramObj);
} catch (IllegalArgumentException e) {
    new CaseLibException(e);
} catch (IllegalAccessException e) {
    new CaseLibException(e);
} catch (InvocationTargetException e) {
    new CaseLibException(e);
} 
```

我的大脑意识到几个例外被包裹在另一个例外中，所以这还不错。但我不得不偶然发现这段代码至少 3 次才能看到缺少什么......

你找不到的最愚蠢的错误是什么？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-21T23:17:10.780

我修复了一个错误，该错误导致应用程序每天下午 6:12 崩溃。

原来有人将自一天开始以来的秒数存储在一个 16 位整数中。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-21T22:45:35.697

在 C/C++ 中（我最近学到的）

```
if (x = 0) {
...
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-22T01:14:00.560

```
 I=1 
```

单行 Fortran 根本不起作用。

经过几个小时无果而终的调试后，我忍住了自尊，和我的伙伴一起完成了代码。

来到那一行时，我说，“现在我们增加下标。”

“嗯？” 他说。

那时我意识到我正在阅读我的意图：

```
 I=I+1 
```

而不是我写的。

请记住，下次你被卡住并且无法弄清楚出了什么问题时。

不要让你的骄傲阻止你吸引第二双眼睛。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-22T00:14:18.123

一旦我编写了一个函数来将日期时间字符串解析为另一种格式。在其中我有一个解析月份值的 switch/case 语句，它看起来像这样：

```
case month of:
  01: return "Jan"; break;
  02: return "Feb"; break;

  ... etc ...

  09: return "Sep"; break;
  11: return "Nov"; break;
  12: return "Dec"; break;
end; 
```

由于某种原因，我错过了十月...

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-22T00:27:01.637

```
for i = 0 to ( list.Length - 1 ) do
  begin
  DoSomething( 1 );
  end; 
```

试着在凌晨 3 点用一个小字体的破显示器上找到*它！*;)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-21T22:37:36.273

实际上并没有在 main 开始附近初始化一些堆栈变量。这东西会自动归零，*几乎*总是如此。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-21T22:40:46.300

我的大多数愚蠢的错误都不是真正的错误。它们是糟糕的数据以及我对这些数据的假设。

我花了几个小时试图在代码中找到一个没有错误的错误——我正在调试一段旧代码，或者我认为我的测试数据集是什么……但事实并非如此。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-21T22:55:07.563

不知道这是否是最愚蠢的，但我曾经写过的最糟糕的一个是我编写了一些部分依赖于一天中的时间的访问控制例程（因此你可以编写诸如“这只能在工作日期间的工作日访问”之类的规则工作时间'）。

我已经完成了代码并运行了所有测试，一切正常。然后我回家，在下一个工作日来，运行了我所有的测试，但都失败了。我一生都无法弄清楚为什么会发生这种情况，因为代码和所有测试都完全没有改变。

结果发现夏令时开始了，而我的代码没有处理这个问题。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-21T23:19:07.843

当我对花括号语言的经验少得多时，我曾经写过一些类似的东西：

```
if (expr);
    stmt; 
```

它在嵌入式系统中，所以我的调试器和 printf 无能为力。它只是让音频听起来很糟糕。我把它归结为性能不佳，并花了一天左右的时间对其进行优化。粗略计算表明性能不是问题。

从那天起，我总是戴上大括号。这让我想用 Python 写东西，如果不是为了其他语言的话。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-21T23:41:37.830

很久以前，在我高中的 CS 时代，我在（我认为）Turbo Pascal 中实现了一个二叉树。其中一个操作没有完全正确地处理它的指针并最终覆盖了部分代码段（啊，DOS编程的乐趣）。无论如何，它总是最终覆盖了我输入的所有调试代码，使 IF 语句看起来像是在撒谎，打印语句没有发生等等，但所有这些都奇迹般地没有崩溃，并且几乎不可能知道发生了什么。

最终，我通过一个汇编级调试器运行它，并在函数中间的指令开始更改时发现了问题......

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-21T22:42:22.567

有一次，当我做一些与数学编程相关的作业时，我花了几个小时才弄清楚我在需要 * 的地方有一个 +。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-21T23:09:28.957

我正在使用 flex/bison 编写解析器。一个特性是不断折叠优化，即将 20 + 2 替换为 22，但是我的解析器将其替换为 4。

作为词法分析器的一部分，我有一个符号表。我使用带有 strncpy 的线性搜索来搜索现有条目。但是，对于 strncpy 中的长度参数，我在符号表中的字符串上使用了 strlen。这不是一个聪明的主意，因为如果符号表中的条目小于添加的条目，它将不正确地匹配。例如，添加“20”将匹配“2”，因为只比较第一个字符。因此，当我的解析器查找“20”的符号时，它得到“2”。我花了几个小时才弄清楚为什么我的 20 多岁变成了 2 多岁。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-21T23:12:49.837

这不是我的错误，但我在场。我和妻子在大学时一起上过 Java 课。她在人类学，我在金融，但不知何故，我们最终进入了 Java。我爱它。

她花了整整一个晚上试图制作一个“该死的程序在屏幕上画出一个愚蠢的 $%^&*( 房子”，但就是做不到。因为固执，她拒绝了我的任何帮助，直到她绝望的最后一刻 (2,凌晨 3 点？）。我快速浏览了一下，发现她始终使用“O”（字母 o）而不是“0”（零）。

第二天她就退学了。

就个人而言，我有一些常见的愚蠢错误。我最喜欢的是：

美元符号 + function_name 使用相同的迭代 ($i) 而不是已经循环的 $i 迭代循环随机“`”，因为我的手滑了而在某处发生

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-22T00:16:20.490

***另外，我们怎么能忘记复制和粘贴***的邪恶引入的错误！

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-22T00:28:58.310

我曾经在调试一个多线程程序，但是可以禁用多线程。该程序会随机出现段错误，但仅在启用多线程的情况下。在尝试隔离所有可能的竞争条件后，我意识到唯一的问题是我正在写超出数组界限。在单线程模式下，内存分配器可预测地分配内存，因此在该数组正上方的地址处的数据在被覆盖时不再需要，因此该错误没有任何症状。在多线程模式下，这些地址的数据是其他线程拥有的数据。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-12-22T00:30:38.073

不是我最糟糕的，而是最近的一个三元运算符邪恶的例子：

为什么 columnCSV 总是为空的，让我难过一阵子：

```
foreach(Column column in Table.Columns)
{
    columnsCSV += string.IsNullOrEmpty(columnsCSV) ? "" : "," + column.Name;
} 
```

本来应该

```
foreach(Column column in Table.Columns)
{
    columnsCSV += (string.IsNullOrEmpty(columnsCSV) ? "" : ",") + column.Name;
} 
```

PS请忽略'缺少StringBuilder'的邪恶。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-12-22T00:50:19.627

在过去，当我们在卡片上编写代码时，我工作了三天，试图弄清楚为什么我的批处理作业不起作用。我终于对每三行进行了 PRINT 声明，但我没有看到任何一个。

然后我意识到有一个 JCL 错误使我的程序无法加载到适当的数据集中（认为“没有进入路径”）所以我一直在运行相同的旧图像，一遍又一遍，而不是新编译的一个。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-12-22T01:23:16.767

对于一个会让你疯狂地试图弄清楚发生了什么的错误，这是怎么回事：

```
#if CONFIG_SETTING == 1
#define SOME_MACRO( x) doSomething( x);
#else
#define SOME_MACRO( x) // don't do it in retail
#endif

void foo( int a, int b) 
{
    if (a < b) SOME_MACRO( a);

    alwaysCallThisFcn();

    // ...
} 
```

因此，如果 CONFIG_SETTING 为 1，则 foo() 编译为：

```
void foo( int a, int b) 
{
    if (a < b) doSomething( a);; // note: the second 
                                 // semi-colon has no effect
    alwaysCallThisFcn();

    // ...
} 
```

否则，它被编译为：

```
void foo( int a, int b) 
{
    if (a < b)
        alwaysCallThisFcn();   // now alwaysCallThisFcn() is 
                               //   called conditionally

    // ...
} 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2013-05-31T18:58:20.323

我最愚蠢的错误是：

```
 if(a=!0) 
```

代替：

```
 if(a!=0) 
```

我花了大约 4 个小时才发现问题，因为编译器简直疯了！想通的时候差点死掉！

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-12-21T23:26:12.290

为什么，我从来没有在我的生活中产生过错误！

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-12-21T23:53:03.330

我无法告诉您我遇到的具体错误，但我可以告诉您至少涉及以下其中一项：

*   假设某事有效
*   假设数据正确
*   一个错字
*   A = 而不是 ==
*   我应该重构的东西

实际上，这是我所有错误的原因列表；）

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-12-22T00:30:41.210

} 而有时 ）

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-10-22T10:26:24.750

这是我早期的愚蠢错误之一。

我们有一个现有项目要处理，其中**`WebMethod`**有用 C# 编写的

```
switch (option) {
case "one" :
  //ToDos
  break;
case "two" :
  //ToDos
  break;
case "three" :
  //ToDos
  break;
} 
```

而从clientCode（通过ajax）我们收到以下内容**`option`**

```
One
Two
Three 
```

大约 30 到 40 分钟后，我不明白问题出在哪里。

我把它修好了

```
 switch (option.ToLower()) { 
```

# java - 在 tomcat webapp 中跟踪内存使用情况

> ID：385088
> 
> 赞同：4
> 
> 时间：2008-12-21T22:38:57.083
> 
> 标签：java, memory

是否有任何好的工具可用于跟踪 tomcat java webapp 中的内存使用情况？我正在寻找可以按类或包分类的东西。

谢谢，J

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T08:02:16.930

我使用 Netbeans IDE，它能够分析任何类型的 Java 项目，包括 webapps。在 Netbeans 中设置好项目后，您只需单击 Profile 并回答几个简单的问题。

创建一个新项目并将现有代码导入其中非常容易。

你可以在这里看到这个截图：[http ://profiler.netbeans.org/](http://profiler.netbeans.org/)

您可以从这里下载 Netbeans：http: [//www.netbeans.org/](http://www.netbeans.org/)

VisualVM 也可能适合您。还有许多可用的插件。自 JDK 6 更新 7 以来，VisualVM 一直随 JDK 一起提供。您可以在此处查看：[https ://visualvm.dev.java.net/](https://visualvm.dev.java.net/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-21T23:28:10.320

[jconsole](http://java.sun.com/j2se/1.5.0/docs/guide/management/jconsole.html#memory)可以为您提供汇总统计信息。我过去在负载测试时使用它来推断加载类的大小（通过注意加载大量对象时的前后使用情况。）请注意，在触发垃圾收集之前，使用情况一直在上升，所以你会需要在计算中考虑瞬态对象。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-21T23:49:52.883

[试试JRockit Mission Control](http://www.oracle.com/technetwork/middleware/jrockit/overview/index-090630.html)附带的 Memory Leak Detector 。它可以向您显示堆上最常见的类类型以及它们的增长量。

[![替代文字](https://i.stack.imgur.com/QatDw.gif)](https://i.stack.imgur.com/QatDw.gif)
[（来源：[oracle.com](http://download.oracle.com/docs/cd/E11035_01/jrockit/intro/wwimages/memleak2.gif)）]

您还可以通过运行 JROCKIT_HOME\bin 目录中可用的 jrmcd 命令从命令行获取统计信息。例如，

> `jrcmd <pid> print_object_summary`

会给你

```
31.8% 3198k    41907   -137k [C
11.9% 1196k      300     +0k [B
11.4% 1151k    49118     +6k java/lang/String
 6.1% 612k     5604     +0k java/lang/Class
 4.3% 431k     2388     +0k [I
 3.5% 353k    15097     +0k java/util/HashMap$Entry
 ... 
```

它可以免费用于开发和评估。

# samba - Samba 共享驱动器在启动时不会自动验证

> ID：385095
> 
> 赞同：3
> 
> 时间：2008-12-21T22:42:03.333
> 
> 标签：samba

我在用于开发的 FreeBSD 机器上有一个 samba 网络共享。

我将它设置为我的 WinXP 机器上的共享驱动器，它工作正常。

但是，如果我重新启动 xp 框，在我单击它并输入密码之前将无法访问共享驱动器，即使我已将其设置为使用正确的用户名和密码并在启动时连接。

有谁知道可能是什么问题？如有必要，我可以获取版本数据等，但我想暂时将其挂在那里，看看它是否可能是一个常见的 samba 问题。

谢谢！

编辑：

非常抱歉！我以为我说过我有 XP Pro。我实际上将身份验证存储在映射驱动器中，其中显示“使用用户进行身份验证”。我还使用与 xp 登录相同的用户名作为 samba 共享用户名，但密码不同。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-27T04:41:56.877

两个选项：在 Samba 共享上设置登录名/密码，使其与您用于登录 Windows XP 的用户名/密码相同。或者也可以将您的 XP Home 设置为手动存储凭据：

MANUAL 密钥按以下方式创建：

1.  启动控制面板中的存储用户名和密码工具。
2.  单击添加。
3.  在框中键入适当的信息：

    *   服务器：使用主机名、FQDN、通配符等。
    *   用户名：域\用户名；机器\用户名；UPN。
    *   密码：输入密码。

至于“WinXP Home 无法像 XP Pro 那样存储网络共享的登录凭据。” 这是不正确的：

DYNAMIC 键的创建方式如下：

1.  用户尝试连接到 \\server\share。
2.  尝试使用用户的登录凭据。如果这些无法访问，则会提示存储的用户名和密码。
3.  成功连接后，或者如果在返回的错误消息上单击“取消”，则将凭据放入“存储的用户名和密码”中。

欲了解更多信息，请参阅：

[存储的用户名和密码的行为 - 文章 ID：281660](http://support.microsoft.com/kb/281660)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T12:58:32.590

要在启动时强制进行身份验证，请运行“net use”（例如，通过在启动文件夹中放置一个链接）。IE：

```
NET USE \\computer\share "password" /USER:user 
```

这将验证您对 Samba 服务器的身份并使其可以使用它，而无需先单击它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T13:15:16.737

WinXP Home 无法像 XP Pro 那样存储网络共享的登录凭据。

根据 Cd-MaN 的响应 - 创建一个包含相关`NET USE`命令的批处理文件，并将该批处理文件的快捷方式放在您的启动菜单项中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-28T20:19:13.207

让它在启动时映射，你可以把它放在一个批处理文件中

```
@echo off
NET USE \\computer\share "password" /USER:user 
```

将其隐藏在某处...我也找不到从网络使用字符串中获取文字凭据的方法..

然后进入 Start->Run->Regedit 并找到这个键

```
\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run 
```

从那里，您可以添加对该批处理文件的调用，以便它在启动时运行....

右键单击所有值并选择

新->字符串值

将其命名为非描述性名称，然后通过右键单击它进行修改，然后将批处理文件的路径放入值数据字段中

* * *

我还设置了一个 samba 共享驱动器，通过将计算机上的登录凭据与 samba 共享上使用的凭据匹配，在启动时自动映射……它可能是 Novell 特有的，但试一试

# javascript - 如何使用 Javascript 解析 @import 样式表

> ID：385098
> 
> 赞同：10
> 
> 时间：2008-12-21T22:43:55.370
> 
> 标签：javascript, css

我正在尝试使用`document.styleSheets`数组读取样式表中的 CSS 选择器。它适用于`<link>`and`<style>`标记，但是当我`@import`在 a中使用它时`<style>`，它不会显示在数组中 - 仅作为 cssRule （Safari 3 和 FF 3 中的样式为“未定义”）。

那么：如何解析 @imported 文件中的 css？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-21T22:47:19.810

假设我们的文档在第一个样式表中包含 @import-rule 作为第一条规则，下面是符合标准的浏览器的代码

```
document.styleSheets[0].cssRules[0].styleSheet.cssRules; 
```

以及我们深受喜爱的 IE 的特例

```
document.styleSheets[0].imports[0].rules; 
```

[如果您在 quirksmode.org](http://www.quirksmode.org/dom/w3c_css.html#access)上阅读了我已经链接到的页面，然后`@import`使用循环遍历 -rule的属性，您自己可以很容易地弄清楚这一点`for..in`- 这就是我所做的......

**PS：**我还不能评论其他答案，但如果可以的话，我会适当地嘲笑你；）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-22T11:39:37.460

> 检查这个页面 - 它进一步链接到 quirksmode.org 上的这个页面。

谢谢，但我已经尝试过了...... Quirksmode 示例从不解析嵌入@import 的样式表。

如果我有这个 HTML/CSS：

```
<link rel="stylesheet" type="text/css" href="css/test1.css" />

<style type="text/css">

    @import url('css/test2.css');

    div {
        color: blue;
    }

</style> 
```

...然后 document.styleSheets.length 为 2（链接标签和样式标签）。通过 @import 链接的 CSS 文件将作为

```
document.styleSheets[1].cssRules[0]. 
```

换句话说，一个 CSS 规则。这也可以在您提到的[Quirksmode页面上看到，Christoph。](http://www.quirksmode.org/dom/changess.html)我可以得到它的 cssText ("@import url('css/test2.css');") 但我不知道如何解析文件中的 CSS (test2.css) ...

如果我在这里完全错过了一些明显的东西，请随意嘲笑我...... :)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-29T14:36:04.523

Excellent page with lots of stylesheet parsing info: [http://www.howtocreate.co.uk/tutorials/javascript/domstylesheets](http://www.howtocreate.co.uk/tutorials/javascript/domstylesheets)

# php - 解析在引号括起来的文本中包含逗号的 csv 数据

> ID：385099
> 
> 赞同：2
> 
> 时间：2008-12-21T22:44:32.547
> 
> 标签：php, csv, parsing, import, double-quotes

我正在构建一个从 excel .csv 文件中提取数据并应用各种级别的格式化、移动和映射的应用程序。除了清理数据的一个障碍外，大多数事情都已经弄清楚了。以下是 Excel 中的数据示例：

1.  伟大的表演，伟大的表演，57744 环湖路，纽约，纽约
2.  "GUASTAVINO'S, INC",GUASTAVINO'S,8250 WESTHEIMER RD,NEW YORK,NY
3.  克拉克斯集团有限责任公司，雨果的青蛙酒吧，915 3RD AVE，芝加哥，IL
4.  TRIOMPHE RESTAURANT CORP,"GEORGE'S,JEAN",1309 E PUTNAM AVE,NEW YORK,NY

由于第 3 行的第 2 行和第 4 行，我不能直接做explode()。这两行都有一个“字符串，字符串”，我无法控制数据导出，只是在导入时进行清理。

我尝试了一些非优雅的选项，它正在消磨处理时间。谁能想到一个优雅的解决方案？

我不能使用 MySQL IMPORT 功能，不幸的是它必须通过 PHP 处理。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-21T22:52:38.317

您也可以尝试执行 SQL 语句：

```
LOAD DATA INFILE 'mydata.csv'
  FIELDS TERMINATED BY ','
  OPTIONALLY ENCLOSED BY '"'; 
```

我听说你使用 PHP，但你可以从 PHP 运行上面的语句。或者您的意思是输入是读取 CSV 产生的流，而不是 CSV 文件？不幸的是 LOAD DATA INFILE 需要一个文件名，它不能接受标准输入。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-22T01:07:42.990

我看到你的问题已经回答了。但是，如果您想将文件读入 PHP 以供使用，则可以使用[fgetcsv](http://no2.php.net/manual/en/function.fgetcsv.php)。

# oslo - Oslo 的 Intellipad：如何设置 3 列 MGrammarMode？

> ID：385102
> 
> 赞同：4
> 
> 时间：2008-12-21T22:45:41.797
> 
> 标签：oslo, mgrammar, m, intellipad

我一直在将 Oslo 用于 MSchema。效果很好。我可以为数据库设计编写一个 M Schema，它生成 T-SQL 以使用 PK、FK、检查完整性等构建整个数据库。我已经设置了一个 .bat 文件来将 .m 编译成 .mx 然后加载它进入数据库，然后在我的项目中运行 SqlMetal，并在 30 秒内继续我的更改。我喜欢它。

好的，现在我要进入 mGrammar。我不太确定如何将它整合到我的应用程序中，但我会弄清楚的。我首先需要的是设置 Intellipad 给我输入/语法/输出三联。我难住了。我想不出任何方法来设置它。是的，我可能可以使用 song.mg 项目并重命名它，但这并不能让我深入了解它是如何工作的。有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T06:42:14.580

以下是您必须采取的步骤

1.  打开“Intellipad（启用样本）”
2.  文件->打开你的 DSL 文件（Example.song）
3.  CTRL+SHIFT+D，输入“SetMode('MGMode')”
4.  从菜单：MGrammar Mode->Tree Preview
5.  选择您的语法文件 (Song.mg)

这将打开三个预览视图。左侧窗口是您的示例代码，中间是您的语法，右侧是您的输出的树结构。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-31T04:15:14.540

正如@Just-in-case 所说，但如果您只是：

(1) CTRL-SHIFT-T

（2）打开MG文件

即，来自实验室文档：

*   从开始菜单或输入以下命令（从“c:\Program Files\Microsoft Oslo SDK 1.0\Bin”）打开 Intellipad（已启用示例）：

"c:\program files\Microsoft Oslo SDK 1.0\bin\Intellipad\ipad.exe" /c:ipad-vs-samples.xaml

注意：“ipad-vs-samples.xaml”是启用附加功能的配置，包括我们将要使用的动态解析编辑模式。

*   在 Intellipad 中，使用 CONTROL-SHIFT-T 以动态解析器​​模式打开 Intellipad。

    3.  选择 IntroToM\Example02-MovieDSL\begin 文件夹中的 Movies.mg 文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-12T19:56:14.930

您可能已经体验过，MSchema 和 MGrammar 还没有很好地集成。在此处阅读更多相关信息：http: [//tinyfinger.blogspot.com/2009/01/mgrammar-mschema-example.html](http://tinyfinger.blogspot.com/2009/01/mgrammar-mschema-example.html)

# c# - MSDataSetGenerator xml 文档警告

> ID：385112
> 
> 赞同：0
> 
> 时间：2008-12-21T22:51:27.743
> 
> 标签：c#, .net

我在打开错误和打开 XML 文档时使用处理警告进行编码。我有一个类型化的数据集，它会生成 500 多个被视为错误的警告。我无法控制此代码，因为它是由 MSDataSetGenerator 自动生成的。

他们是一种仅针对数据集文件关闭警告的方法吗？

关闭 XML 文档对我来说不是一个选项，因为项目中有其他类。

关闭将警告视为错误将使其能够构建。但是同一项目中其他代码生成的任何警告都将无法找到并且会被遗漏。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T23:22:29.053

请阅读这个：

[http://msdn.microsoft.com/en-us/library/441722ys(VS.80).aspx](http://msdn.microsoft.com/en-us/library/441722ys(VS.80).aspx)

当然，每次生成数据集代码的自定义工具执行时，您都必须添加要忽略的警告列表...

高温高压

科尔比非洲

# .net - 引用子文件夹中的私有 .net 程序集

> ID：385129
> 
> 赞同：2
> 
> 时间：2008-12-21T23:06:20.537
> 
> 标签：.net, compact-framework, build-process, assemblies

在 Visual Studio 2008 中，我可以添加项目引用并将 Copy Local 属性设置为 true。结果，引用的程序集将被复制到构建主程序集的同一文件夹中。

但是，如果我想将所有引用的程序集放在主程序集附近的子文件夹中怎么办？

像这样的东西：

```
..
myApp.exe
Libs
  myLib1.dll
  myLib2.dll
Data
  myDatabase.sqlite 
```

PS：这是针对 .NET Compact Framework 3.5 构建的智能设备应用程序

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T23:14:11.613

对于框架的其他版本，您将执行以下操作：

[http://msdn.microsoft.com/en-us/library/twy1dw1e.aspx](http://msdn.microsoft.com/en-us/library/twy1dw1e.aspx)

对于紧凑型，我建议阅读以下内容：

[http://blogs.msdn.com/stevenpr/archive/2005/01/05/347353.aspx](http://blogs.msdn.com/stevenpr/archive/2005/01/05/347353.aspx)

高温高压

科尔比非洲

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-21T23:08:05.293

您可以关闭“复制本地”设置，然后在引用的项目上设置构建操作，以在每次构建后将 dll 复制到您的 Libs 文件夹。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T23:09:46.053

您可以在 VS 中添加前/后构建事件命令（在项目属性 ->“构建事件”下）将文件复制到您需要的位置。

# encoding - proper/best type for storing latitude and longitude

> ID：385132
> 
> 赞同：73
> 
> 时间：2008-12-21T23:07:48.850
> 
> 标签：encoding, types, latitude-longitude

In a system level programming language like C, C++ or D, what is the best type/encoding for storing latitude and longitude?

The options I see are:

*   IEEE-754 FP as degrees or radians
*   degrees or radians stored as a fixed point value in an 32 or 64 bit int
*   mapping of an integer range to the degree range: -> `deg = (360/2^32)*val`
*   degrees, minutes, seconds and fractional seconds stored as bit fields in an int
*   a struct of some kind.

The easy solution (FP) has the major down side that it has highly non uniform resolution (somewhere in England it can measure in microns, over in Japan, it can't). Also this has all the issues of FP comparison and whatnot. The other options require extra effort in different parts of the data's life cycle. (generation, presentation, calculations etc.)

One interesting option is a floating precision type that where as the Latitude increase it gets more bits and the Longitude gets less (as they get closer together towards the poles).

Related questions that don't quite cover this:

*   [What is the ideal data type to use when storing latitude / longitudes in a MySQL](https://stackoverflow.com/questions/159255/)
*   [Working with latitude/longitude values in Java](https://stackoverflow.com/questions/120283/)

* * *

BTW: 32 bits gives you an E/W resolution at the equator of about 0.3 in. This is close to the scale that high grade GPS setups can work at (IIRC they can get down to about 0.5 in in some modes).

OTOH if the 32 bits is uniformly distributed over the earth's surface, you can index squares of about 344m on a side, 5 Bytes give 21m, 6B->1.3m and 8B->5mm.

I don't have a specific use in mind right now but have worked with this kind of thing before and expect to again, at some point.

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-12-21T23:13:54.110

The easiest way is just to store it as a float/double in degrees. Positive for N and E, negative for S and W. Just remember that minutes and seconds are out of 60 (so 31 45'N is 31.75). Its easy to understand what the values are by looking at them and, where necessary, conversion to radians is trivial.

Calculations on latitudes and longitudes such as the [Great Circle](https://stackoverflow.com/questions/365826/calculate-distance-between-2-gps-coordinates) distance between two coordinates rely heavily on trigonometric functions, which typically use doubles. Any other format is going to rely on another implementation of sine, cosine, atan2 and square root, at a minimum. Arbitrary precision numbers (eg BigDecimal in Java) won't work for this. Something like the int where 2^32 is spread uniformly is going to have similar issues.

The point of uniformity has come up in several comments. On this I shall simply note that the Earth, with respect to longitude, isn't uniform. One arc-second longitude at the Arctic Circle is a shorter distance than at the Equator. Double precision floats give sub-millimetre precision anywhere on Earth. Is this not sufficient? If not, why not?

It'd also be worth noting what you want to do with that information as the types of calculations you require will have an impact on what storage format you use.

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-12-21T23:15:24.573

Longitudes and latitudes are not generally known to any greater precision than a 32-bit float. So if you're concerned about storage space, you can use floats. But in general it's more convenient to work with numbers as doubles.

Radians are more convenient for theoretical math. (For example, the derivative of sine is cosine only when you use radians.) But degrees are typically more familiar and easier for people to interpret, so you might want to stick with degrees.

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2012-01-30T03:39:46.460

[根据这篇关于Decimal Degrees](http://en.wikipedia.org/wiki/Decimal_degrees)的维基百科文章，精度为 8 的 Decimal 表示应该绰绰有余。

```
0 decimal places, 1.0 = 111 km
...
7 decimal places, 0.0000001 = 1.11 cm
8 decimal places, 0.00000001 = 1.11 mm 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2015-12-15T09:33:18.847

[http://www.esri.com/news/arcuser/0400/wdside.html](http://www.esri.com/news/arcuser/0400/wdside.html)
*在赤道，经度角秒大约等于纬度角秒，即 1/60 海里（或 101.27英尺或 30.87 米）。*

32 位浮点数包含 23 位显式数据。
180 * 3600 需要 log2(648000) = 19.305634287546711769425914064259 位数据。请注意，符号位是单独存储的，因此我们只需要计算 180 度。
如果将值 648000 标准化为 2 的某个幂，则适用以下计算。
从 23 中减去 log2(648000) 的位后，我们剩下的额外 3.694365712453288230574085935741 位用于亚秒级数据。
即每秒 2 ^ 3.694365712453288230574085935741 = 12.945382716049382716049382716053 份。
因此，浮点数据类型在赤道处可以具有 30.87 / 12.945382716049382716049382716053 ~= 2.38 米的精度。

如果您将 180 度值归一化为 2 的某个幂，则上述计算是精确的。否则假设亚度精度存储在小数点之后，浮点表示将物理上使用所有 8 位作为度数部分。这为亚度精度留下了 15 位。然后 15 - log2(3600) 使 3.1862188087829629413518832531256 位用于亚秒级数据，或 3.3914794921875 ~= 3.39 米的赤道精度。这比标准化所能提供的大约少一米。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-21T23:31:51.780

Might the problems you mentioned with floating point values become an issue? If the answer is no, I'd suggest just using the radians value in double precision - you'll need it if you'll be doing trigonometric calculations anyway.

If there might be an issue with precision loss when using doubles or you won't be doing trigonometry, I'd suggest your solution of mapping to an integer range - this will give you the best resolution, can easily be converted to whatever display format you're locale will be using and - after choosing an appropriate 0-meridian - can be used to convert to floating point values of high precision.

**PS:** I've always wondered why there seems to be no one who uses geocentric spherical coordinates - they should be reasonably close to the geographical coordinates, and won't require all this fancy math on spheroids to do computations; for fun, I wanted to convert Gauss-Krüger-Koordinaten (which are in use by the German Katasteramt) to GPS coordinates - let me tell you, that was ugly: one uses the Bessel ellipsoid, the other WGS84, and the Gauss-Krüger mapping itself is pretty crazy on it's own...

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-10-21T03:58:47.703

什么编码是“最好的”实际上取决于您的目标/要求。

如果您正在执行算术，浮点纬度，经度通常很方便。其他时候笛卡尔坐标（即x，y，z）可能更方便。例如，如果您只关心地球表面上的点，则可以使用[n-vector](https://en.wikipedia.org/wiki/N-vector)。

至于长期存储，IEEE 浮点将浪费位用于您不关心的范围（对于纬度/经度）或在笛卡尔坐标的情况下您可能不关心的精度（除非您希望在原点有非常好的精度无论出于何种原因）。您当然可以将任一类型的坐标映射到您喜欢的大小的整数，这样整个整数范围就可以覆盖您关心的分辨率下您感兴趣的范围。

当然，除了在编码中不浪费比特之外，还有其他事情需要考虑。例如，（Geohashes）[https://en.wikipedia.org/wiki/Geohash] 有一个很好的特性，即在同一区域很容易找到其他 geohashes。（大多数将具有相同的前缀，您可以计算其他的前缀。）不幸的是，它们在赤道附近和两极附近保持相同的经度精度。我目前正在使用 64 位 geohashes 进行存储，它在赤道处提供大约 3 m 的分辨率。

[Maidenhead Locator System](https://en.wikipedia.org/wiki/Maidenhead_Locator_System)具有一些类似的特征，但似乎更适合于在人类之间交流位置而不是存储在计算机上。（存储 MLS 字符串会浪费大量位用于一些相当微不足道的错误检测。）

我发现确实以不同方式处理两极的一个系统是[军事网格参考系统](https://en.wikipedia.org/wiki/Military_grid_reference_system)，尽管它似乎也更面向人类通信。（从或转换为纬度/经度似乎很痛苦。）

根据您确切想要的内容，您可以使用类似于两极附近的[通用极坐标系的东西，以及比世界其他地方的](https://en.wikipedia.org/wiki/Universal_polar_stereographic_coordinate_system)[UTM](https://en.wikipedia.org/wiki/Universal_transverse_Mercator)在计算上更合理的东西，并且最多使用一位来指示两个系统中的哪一个你正在使用。我最多说一点，因为您关心的大多数点不太可能在两极附近。例如，您可以使用“半位”，说 11 表示使用极坐标系统，而 00、01 和 10 表示使用其他系统，并且是表示的一部分。

对不起，这有点长，但我想保存我最近学到的东西。遗憾的是，我还没有找到任何标准、理智和有效的方法来以统一的精度表示地球上的一个点。

编辑：我发现另一种方法看起来更像你想要的，因为它更直接地利用了靠近两极的经度所需的较低精度。事实证明，有很多关于存储法线向量的研究。[Encoding Normal Vectors using Optimized Spherical Coordinates](http://faculty.cs.tamu.edu/schaefer/research/normalCompression.pdf)描述了这样一种系统，用于在保持最低精度的同时对法线向量进行编码，但它也可以用于地理坐标。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2018-12-15T19:24:59.263

好问题！

我知道这个问题现在已经有 9 年了，我只知道你正在寻找的答案的一部分，但我刚来这里有一个类似的问题，自从提出这个问题以来，很多事情都发生了变化，例如可用的硬件和 GPS . 我经常在处理不同类型应用程序中不同类型 GPS 的固件中使用这个主题，并且已经忘记了我为我使用过的不同应用程序制定“最佳设计”所花费的时间（和天数）或发达。

与往常一样，不同的解决方案将提供收益和成本，最终，“最佳设计”始终是收益和成本与系统要求的“最佳匹配”。当我问同样的问题时，我必须考虑以下几点：

CPU时间成本

如果 CPU 没有内置的浮点协处理器（许多微控制器就是这种情况），那么处理“float”、“double”和“long double”可能会非常昂贵。例如，对于我经常使用的一个 16 位微控制器，使用“双”值的乘法需要 326 个 CPU 时钟周期，而除法需要 1193 个时钟周期。非常贵！

准确性权衡

在赤道，一个'float'（IEEE-754 32位浮点值），需要表示一个有符号度数，假设能表示7个“干净”的有效十进制数字，一个最低有效十进制数字的变化（例如从 179.9999 到 180.0000）将代表大约 11.12 米的距离。这可能满足也可能不满足硬系统精度要求。而“双”（表示 15 个“干净”的有效十进制数字，因此从 179.999999999999 变为 180.000000000000）表示大约 0.00011 毫米。

输入精度限制

如果您正在处理来自 GPS 的输入，您将获得多少位的真实准确度，以及您需要保留多少位？

开发时间成本

IEEE-754 64 位双精度值（'double'）和 32 位单精度值（'float'）在 C 语言中处理起来非常方便，因为几乎每个 C 编译器都附带了这两种数学库，并且通常非常可靠。如果您的 CPU 带有硬件浮点处理器，这是一个简单的选择。

RAM 和存储成本

如果您必须将大量这些值保存在 RAM（或存储，例如 MYSQL）中，可用 RAM（和存储空间）可能会影响解决方案的可操作性。

可用数据与所需数据

我在写这篇文章时处理的一个例子（我来这里回答这个问题的原因）是我正在处理一个 u-blox M8 GPS，它能够给我二进制 GPS 信息（节省翻译 ASCII NMEA 的 CPU 开销句子）。在这种二进制格式（称为“UBX 协议”）中，纬度和经度表示为带符号的 32 位整数，该表示能够表示（在赤道处）低至约 1.11 厘米的精度。例如，-105.0269805 度经度表示为 -1050269805（使用所有 32 位），一个 LSb 变化表示任何地方的纬度变化约 1.11 厘米，赤道经度变化 1.11 厘米（高纬度地区更小，与余弦成正比）纬度）。此 GPS 所在的应用程序执行导航任务，这（已经存在且经过良好测试的代码）需要' 双'数据类型。不幸的是，将这个整数转换为 IEEE-754 64 位“双精度”并不容易，只需将整数的基数 2 位移动到“双精度”的内部表示位，因为要执行的小数移位是以 10 为底的十进制移位。如果它是一个以 2 为底的十进制移位，那么整数的以 2 为底的位可以移动到“双”的位域中，而只需要很少的翻译。但唉，这不是我有符号整数的情况。因此，在没有硬件浮点处理器的 CPU 上进行乘法运算将花费我：326 个 CPU 时钟周期。仅通过将整数的 base-2 位移动到“double”的内部表示位中就无法轻松完成，因为要执行的十进制移位是 base-10 十进制移位。如果它是一个以 2 为底的十进制移位，那么整数的以 2 为底的位可以移动到“双”的位字段中，而只需要很少的翻译。但唉，这不是我有符号整数的情况。因此，在没有硬件浮点处理器的 CPU 上进行乘法运算将花费我：326 个 CPU 时钟周期。仅通过将整数的 base-2 位移动到“double”的内部表示位中就无法轻松完成，因为要执行的十进制移位是 base-10 十进制移位。如果它是一个以 2 为底的十进制移位，那么整数的以 2 为底的位可以移动到“双”的位字段中，而只需要很少的翻译。但唉，这不是我有符号整数的情况。因此，在没有硬件浮点处理器的 CPU 上进行乘法运算将花费我：326 个 CPU 时钟周期。但唉，这不是我有符号整数的情况。因此，在没有硬件浮点处理器的 CPU 上进行乘法运算将花费我：326 个 CPU 时钟周期。但唉，这不是我有符号整数的情况。因此，在没有硬件浮点处理器的 CPU 上进行乘法运算将花费我：326 个 CPU 时钟周期。

```
double   ldLatitude;
int32_t  li32LatFromGps;
ldLatitude = (double)li32LatFromGps * 0.0000001; 
```

请注意，此乘法是在此基础上选择的：

```
ldLatitude = (double)li32LatFromGps / 10000000.0; 
```

因为在我正在处理的 CPU 上，“双”乘法比“双”除法快 3.6 倍。这就是微控制器世界的生活。:-)

如果导航任务可以直接使用 32 位有符号整数来完成，那将是非常棒的（如果我能在周末抽出时间的话，将来可能会如此）！那么就不需要转换了……但是用这样一个整数做导航任务会不会花费更多？CPU成本，可能效率更高。开发时间成本？这是另一个问题，尤其是在已经使用 IEEE-754 64 位“双”值的经过充分测试的系统的情况下！另外，已经存在提供地图数据的软件（使用“双”度值），该软件也必须转换为使用有符号整数——这不是一夜之间的任务！

一个非常有趣的选择是使用原始纬度/经度整数直接（不进行平移）表示“矩形”（实际上是梯形，在两极处变成三角形）的近似值之间的交点。在赤道，这些矩形的东西尺寸约为 1.11 厘米，南北尺寸约为 1.11 厘米，而在纬度，例如英国伦敦，尺寸约为东西尺寸 0.69 厘米，南北尺寸约为 1.11 厘米。这可能不容易处理，也可能不容易处理，这取决于应用程序需要什么。

无论如何，我希望这些想法和讨论能帮助其他正在关注这个主题的人，为他们的系统寻找“最佳设计”。

亲切的问候，维克

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-21T23:36:44.627

0.3 inch resolution is getting down to the point where earthquakes over a few years make a difference. You may want to reconsider why you believe you need such fine resolution worldwide.

Some of the spreading centres in the Pacific Ocean change by as much as [15 cm/year](http://www.mhhe.com/earthsci/geology/mcconnell/pte/pt.htm).

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-01-19T19:23:17.290

一个 Java 程序，用于计算将 lat/long 值转换为 Float/Double 的最大舍入误差（以米为单位）：

```
import java.util.*;
import java.lang.*;
import com.javadocmd.simplelatlng.*;
import com.javadocmd.simplelatlng.util.*;

public class MaxError {
  public static void main(String[] args) {
    Float flng = 180f;
    Float flat = 0f;
    LatLng fpos = new LatLng(flat, flng);
    double flatprime = Float.intBitsToFloat(Float.floatToIntBits(flat) ^ 1);
    double flngprime = Float.intBitsToFloat(Float.floatToIntBits(flng) ^ 1);
    LatLng fposprime = new LatLng(flatprime, flngprime);

    double fdistanceM = LatLngTool.distance(fpos, fposprime, LengthUnit.METER);
    System.out.println("Float max error (meters): " + fdistanceM);

    Double dlng = 180d;
    Double dlat = 0d;
    LatLng dpos = new LatLng(dlat, dlng);
    double dlatprime = Double.longBitsToDouble(Double.doubleToLongBits(dlat) ^ 1);
    double dlngprime = Double.longBitsToDouble(Double.doubleToLongBits(dlng) ^ 1);
    LatLng dposprime = new LatLng(dlatprime, dlngprime);

    double ddistanceM = LatLngTool.distance(dpos, dposprime, LengthUnit.METER);
    System.out.println("Double max error (meters): " + ddistanceM);
  }
} 
```

输出：

```
Float max error (meters): 1.7791213425235692
Double max error (meters): 0.11119508289500799 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-10-01T06:13:50.023

如果“存储”是指“保存在记忆中”，那么真正的问题是：你打算如何处理它们？

我怀疑在这些坐标做任何有趣的事情之前，它们会通过 math.h 中的函数以弧度的形式汇集。除非您计划实现相当多的超越函数，这些函数在打包到位字段中的 Deg/Min/Secs 上运行。

那么，为什么不让事情变得简单，并按照您的要求将它们存储在 IEEE-754 度或弧度中呢？

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-02-22T17:08:17.233

以下代码将 WGS84 坐标无损地打包成一个无符号长整数（即 8 个字节）：

```
using System;
using System.Collections.Generic;
using System.Text;

namespace Utils
{
    /// <summary>
    /// Lossless conversion of OSM coordinates to a simple long.
    /// </summary>
    unsafe class CoordinateStore
    {
        private readonly double _lat, _lon;
        private readonly long _encoded;

        public CoordinateStore(double lon,double lat)
        {
            // Ensure valid lat/lon
            if (lon < -180.0) lon = 180.0+(lon+180.0); else if (lon > 180.0) lon = -180.0 + (lon-180.0);
            if (lat < -90.0) lat = 90.0 + (lat + 90.0); else if (lat > 90.0) lat = -90.0 + (lat - 90.0);

            _lon = lon; _lat = lat;

            // Move to 0..(180/90)
            var dlon = (decimal)lon + 180m;
            var dlat = (decimal)lat + 90m;

            // Calculate grid
            var grid = (((int)dlat) * 360) + ((int)dlon);

            // Get local offset
            var ilon = (uint)((dlon - (int)(dlon))*10000000m);
            var ilat = (uint)((dlat - (int)(dlat))*10000000m);

            var encoded = new byte[8];
            fixed (byte* pEncoded = &encoded[0])
            {
                ((ushort*)pEncoded)[0] = (ushort) grid;
                ((ushort*)pEncoded)[1] = (ushort)(ilon&0xFFFF);
                ((ushort*)pEncoded)[2] = (ushort)(ilat&0xFFFF);
                pEncoded[6] = (byte)((ilon >> 16)&0xFF);
                pEncoded[7] = (byte)((ilat >> 16)&0xFF);

                _encoded = ((long*) pEncoded)[0];
            }
        }

        public CoordinateStore(long source)
        {
            // Extract grid and local offset
            int grid;
            decimal ilon, ilat;
            var encoded = new byte[8];
            fixed(byte *pEncoded = &encoded[0])
            {
                ((long*) pEncoded)[0] = source;
                grid = ((ushort*) pEncoded)[0];
                ilon = ((ushort*)pEncoded)[1] + (((uint)pEncoded[6]) << 16);
                ilat = ((ushort*)pEncoded)[2] + (((uint)pEncoded[7]) << 16);
            }

            // Recalculate 0..(180/90) coordinates
            var dlon = (uint)(grid % 360) + (ilon / 10000000m);
            var dlat = (uint)(grid / 360) + (ilat / 10000000m);

            // Returns to WGS84
            _lon = (double)(dlon - 180m);
            _lat = (double)(dlat - 90m);
        }

        public double Lon { get { return _lon; } }
        public double Lat { get { return _lat; } }
        public long   Encoded { get { return _encoded; } }

        public static long PackCoord(double lon,double lat)
        {
            return (new CoordinateStore(lon, lat)).Encoded;
        }
        public static KeyValuePair<double, double> UnPackCoord(long coord)
        {
            var tmp = new CoordinateStore(coord);
            return new KeyValuePair<double, double>(tmp.Lat,tmp.Lon);
        }
    }
} 
```

来源：[http ://www.dupuis.me/node/35](http://www.dupuis.me/node/35)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-04-24T12:53:33.100

正如@Roland Pihlakas 已经指出的那样，这取决于您使用坐标的精度。

我只是建议另一种观点：

*   地球的赤道周长（周长）为 40.000 公里；
*   这等于 40M 米，即 40 亿厘米；
*   32 位变量包含 2^32 或约 42 亿个不同的值，这比所提到的周长中的厘米数多一点。
*   这意味着，如果我们为纬度和经度选择 32 位整数值，它将允许我们以 < 1 厘米的精度定位地球上的一个点。
*   使用浮点值：
    *   `float32`包含 23 个有效位 => ~4.7 米精度
    *   `float64`包含 52 个有效位 => < 1 mm 精度

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-04-17T07:35:04.283

您可以使用`decimal`数据类型：

```
CREATE TABLE IF NOT EXISTS `map` (
  `latitude` decimal(18,15) DEFAULT NULL,
  `longitude` decimal(18,15) DEFAULT NULL 
); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-10-03T15:42:19.587

在自己寻找答案后遇到这个问题后，这是基于一些先例的另一种可能的方案。

网络工作组 RFC 3825 为 DHCP（即在网络上分发 IP 地址的系统）提出了基于坐标的地理位置选项。见[https://tools.ietf.org/rfc/rfc3825.txt](https://tools.ietf.org/rfc/rfc3825.txt)

在该方案中，纬度和经度以度为单位编码，具有定点值，其中前 9 位是有符号度，25 位是小数度，6 位用于精度。精度位的值表示被认为是准确的 25 个小数位的数量（例如，通过消费者 GPS 与高精度测量员 GPS 收集的坐标）。使用 WGS84，精度为 8 位十进制数字，无论您在地球上的哪个位置，都可以达到大约一毫米。

正如其他一些人所发布的那样，浮点编码确实不适合这种类型的事情。是的，它可以表示非常多的小数位数，但准确性要么被忽略，要么必须在其他地方处理。例如，打印具有全浮点精度的浮点数或双精度数会导致带有十进制数字的数字不太可能是远程准确的。同样，简单地输出具有 8 或 10 位精度的浮点数或双精度数，根据浮点数的计算方式，很多都不是源值的真实表示（例如，为什么 1.2-1.0 不等于 0.2 使用浮点算术） .

有关为什么您应该关心坐标系精度的幽默示例，请参阅[https://xkcd.com/2170/](https://xkcd.com/2170/)。

当然，RFC 3825 中使用的 40 位编码在 32 或 64 位世界中几乎不方便，但这种风格可以很容易地扩展到 64 位数字，其中 9 位用于有符号度，6 位用于精度，保留 49 位作为小数部分。这会产生 15 位十进制数字的精度，这基本上比任何人都需要的多（参见幽默示例）。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-06-13T12:07:14.937

最小尺寸的最佳精度是 int32。

存储 7 个小数位（1.11 厘米误差）经度双精度数为您提供 +/-1.800.000.000 的数字，非常适合存储在 int32 中，您只需将双精度数乘以 10M 即可

int32_t lng = (int32_t)(double_lng * 10000000);

解释（[维基百科](https://en.wikipedia.org/wiki/Decimal_degrees)）

赤道被划分为 360 度经度，因此赤道处的每一度代表 111,319.5 米（111.32 公里）。然而，当一个人从赤道向极点移动时，经度的一个度数乘以纬度的余弦，距离减小，在极点接近零。赤道处 1 厘米精度所需的小数位数为 7。如果您需要将 180º 和 7 位小数存储在整数中，则结果将是 1.800.000.000 数字，该数字在 32 位整数范围内。

正如您在 Google 地图中看到的，当您单击任何位置时，Golge 会为您提供适合 32 位整数的 6 位小数浮点数。

比较：

1.  vs 双 -> 半尺寸
2.  vs float -> Float 没有足够的精度
3.  与 24 位建议：任何 32 位或 64 位处理器都无法寻址 24 位，您必须获取三个字节然后转换为 int32 或加倍然后操作，丢失了很多 cicles 和许多代码行

# wpf - 将单个样式应用于多个控件（并调整每种样式）

> ID：385141
> 
> 赞同：3
> 
> 时间：2008-12-21T23:10:35.053
> 
> 标签：wpf, controls, styles

我有一个使用自定义样式的 WPF 应用程序。其中我有一组按钮，每个按钮都有一个自定义背景图像。对于每个按钮，我提供了一个正常的和鼠标按下的图像。有没有一种简单的方法可以使用单一样式（并根据具体情况自定义每个按钮）？

目前我正在为每个按钮创建一种新样式，这肯定不是最好的方法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-22T17:36:40.390

对于仅 XAML 的解决方案，您可以考虑：-

我假设您正在使用控件模板作为您的样式的一部分，如下所示：-

```
<Style x:Key="MyButtonStyle" TargetType="{x:Type Button}">
  <Setter Property="Template">
    <Setter.Value>
      <ControlTemplate TargetType="{x:Type Button}">
        <Image x:Name="img" Style="{DynamicResource NormalImage}"/>
        <ControlTemplate.Triggers>
          <Trigger Property="IsEnabled" Value="false">
            <Setter Property="Source" TargetName="img" Value="Images\DisabledImage.png"/>
          </Trigger>
        </ControlTemplate.Triggers>
      </ControlTemplate>
    </Setter.Value>
  </Setter>
</Style> 
```

我已经在这里删除了控制模板，你的可能更复杂

现在，如果您在与上述样式相同的区域中添加以下样式，那么这将指定用于默认情况的图像

```
<Style x:Key="NormalImage" TargetType="{x:Type Image}">
  <Setter Property="Source" Value="Images/DeafultImage.png"/>
</Style> 
```

当您需要使用按钮时，您可以在 XAML 中进一步执行以下操作：-

```
<Button Style="{DynamicResource MyButtonStyle}" >
  <Button.Resources>
    <Style x:Key="NormalImage" TargetType="{x:Type Image}">
      <Setter Property="Source" Value="Images/OverrideImage.png"/>
    </Style>
  </Button.Resources>
</Button> 
```

它并不漂亮，但仍然允许主样式，并且比使用多种样式更短且重复更少。

它的工作方式是首先在按钮的资源（通常为空）中搜索资源名称“NormalImage”，然后是父容器，一直到页面/窗口资源，再到应用程序资源。第一场比赛获胜，因此在这种情况下，引用 OverrideImage.png 的名为“NormalImage”的本地定义样式将在与引用 DefaultImage.png 的名称相同的窗口/页面/容器级别资源之前选择

## 进一步减少文本量

如果所有按钮或大多数按钮都将使用此样式，则从样式定义中删除 x:Key="MyButtonStyle"。这样，WPF 将在范围内的所有按钮上使用样式，而无需显式指定样式。然后，您可以使用 style="{x:null}" 明确地不使用默认样式。因此：-

```
<Window.Resources>
  <Style x:Key="NormalImage" TargetType="{x:Type Image}">
    <Setter Property="Source" Value="Images/DeafultImage.png"/>
  </Style>

  <Style TargetType="{x:Type Button}">
    <Setter Property="Template">
            ...
    </Setter>
  </Style>
</Window.Resources>

<Button >
  <Button.Resources>
    <Style x:Key="NormalImage" TargetType="{x:Type Image}">
      <Setter Property="Source" Value="Images/OverrideImage.png"/>
    </Style>
  </Button.Resources>
</Button>

<Button Style="{x:null}>Normal Button</Button> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T06:35:10.863

您可以在 ResourceDictionary 中创建样式，然后将该字典合并到您的控件资源中。如果您给样式一个键，那么您可以将任何按钮绑定到该样式。

例如：

```
<Style x:Key="imageButton" ControlType="{x:Type Button}">
    ...
</Style>

<Button Style="{DynamicResource imageButton}" /> 
```

# php - 一段我不太确定的 PHP 代码

> ID：385150
> 
> 赞同：1
> 
> 时间：2008-12-21T23:14:44.577
> 
> 标签：php

我这里有一段 PHP 代码，它删除一个目录和其中的所有文件（如果存在）。但是，我不太确定，在我看来，它也会删除所有子地图，然后删除其中的文件等等......

我基本上想给出可选的真/假参数来选择是否删除子目录。或者制作两个功能会更好吗？第一个完全清空文件夹，第二个删除文件夹及其中的所有内容。

这是代码：

```
function delete_directory($dirname) {
   if (is_dir($dirname)) {
     $dir_handle = opendir($dirname);
     if (!$dir_handle) return false;
     while($file = readdir($dir_handle)) {
       if ($file != "." && $file != "..") {
         if (!is_dir($dirname."/".$file)){
         @unlink($dirname."/".$file);
       }else {
         delete_directory($dirname.'/'.$file);
         }
       }
     }
     closedir($dir_handle);
   }
   @rmdir($dirname) or die("Could not remove directory.");
   return true;
 } 
```

我基本上想知道的是：这里会出现什么问题？是否存在这段代码会严重搞砸的情况？我已经用 Netbeans 调试了几个小时，并尝试了很多不同的场景。现在我有点卡住了，想知道 StackoverFlow 的人是否能找到代码中的缺陷？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-21T23:23:01.580

> 我基本上想知道的是：这里会出现什么问题？是否存在这段代码会严重搞砸的情况？

如果目录包含指向其他地方的符号链接，则会遵循它（除非我弄错了 - 你应该检查一下）。这可能会导致一场野火，你基本上会消灭整个文件系统。您可能希望防止这种情况，使用[`realpath`](http://www.php.net/realpath)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-22T03:15:36.807

正如其他人所说：

```
 if ($file != "." && $file != "..") { 
```

应该

```
 if ($file != "." && $file != ".." && !is_link($file)) { 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-22T01:24:22.460

即使参数是指向目录的符号链接，PHP is_dir 也会返回 true，这非常危险。因此，只需在第一个 if 语句中添加一个 !is_link 测试就可以使它更安全。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-21T23:23:42.717

> 我基本上想给和可选的真/假参数来选择是否删除子目录。

如果不删除子目录，则不能删除父目录（因为它必须先为空）。如果你构建你的 delete_directory 函数，这样它有时只会删除一个目录，那么你就是在寻找问题。

如果您需要删除目录及其子目录中的所有文件，那么我会为此创建一个函数，调用它`deleteDirectoryFiles()`或其他东西。然后该`deleteDirectory`函数可以调用它，然后只清理空目录。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-21T23:31:59.127

会出什么问题？许多年前，我写了一个函数来做这样的事情（递归删除一个临时工作目录）。但是，开发过程中的一个错误导致它删除了我的整个源代码目录！在我知道什么是源代码控制之前很久，我的备份已经过时，所以我不得不使用 DOS Norton Utilities 尽我所能来取消删除我的源代码。

总是非常非常仔细地测试这样的功能。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-29T10:11:25.330

我尝试使用此代码，但它丢失了树中的文件并且无法删除目录。

我换了

```
while($file = readdir($dir_handle)) 
```

和

```
while(false !== ($file = readdir($dir_handle))) 
```

根据 PHP[建议](http://uk3.php.net/manual/en/function.readdir.php)并修复它。

正如其他人提到的，我还使用了以下内容：

```
if ($file != "." && $file != ".." && !is_link($file)) { 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-21T23:30:27.557

我会提供一个可选的“级别”参数，如果您只想删除一定数量的级别，则可以限制您想要深入的级别。

另一个想法是有一个“filesonly”标志，允许您保留目录结构但删除所有文件。

# c - 如何将 GUI 改造为现有的 C 程序？

> ID：385156
> 
> 赞同：12
> 
> 时间：2008-12-21T23:17:32.310
> 
> 标签：c, user-interface, tcl

我一直在做一个移植旧的 solaris CL 程序以在 Linux 上运行的项目，除了一些不相关的硬件问题，这已经完成了。现在我想要一个图形用户界面，因此用户可以在带有下拉列表和复选框的各种选项中进行选择，以及一些不受限制的选项的文本输入区域，例如文件名。（该程序是一个内部工具，用于运行一些光谱扫描仪并将结果存储为 CSV 文件。它处理所有这些选项，运行扫描仪并处理信息并以指定的文件名存储它；我只是想要比 CL 更好用的东西。 )

我唯一一次看到这样的事情是一个 PyGTK+ GUI，它带有用于 C 代码的 python 绑定（我认为就是这样；那是我第一个学期的合作，我不太了解！）。这比我现在想了解的要多一点。有没有相对简单的方法来做到这一点？当我用谷歌搜索时，我发现了 SWIG（[http://www.swig.org/index.php](http://www.swig.org/index.php)）；这是一个好方法吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-21T23:22:22.423

这听起来正是[Tcl/Tk](http://www.tcl.tk/)的设计目的。它有一个非常简单的 C API，允许您使用回调注册命令。如果您在 Tcl 程序中使用该命令，它将调用回调并提供一种机制来在 Tcl 列表（本机数据结构）和 ARGV 样式的 char* 数组之间转换参数。

它专门设计用于轻松将这种包装器改进为命令行驱动的 C 程序。您还可以使用多种其他模式来连接解释器，并且很容易作为脚本语言嵌入到程序中。从内存中，可用的接口机制是：

*   在 Tcl 解释器中注册命令
*   在您的程序中嵌入 Tcl 解释器并将 Tcl 用作嵌入式脚本语言（可能包括命令注册和程序回调）
*   使用全双工管道生成一个进程并通过标准输入/标准输出发送命令（您还可以将事件处理程序附加到数据可用时调用的管道）
*   较少的 Tcl 特定机制，例如 fork/exec 或通过套接字连接。

Ousterhout 的书[Tcl and the TK Toolkit](https://rads.stackoverflow.com/amzn/click/com/020163337X)有点过时，但对 C API 有很好的指导。Welch's [Practical Programming in Tcl/Tk](https://rads.stackoverflow.com/amzn/click/com/0130385603)是另一本经典的 Tcl/Tk 书籍，更新更频繁。互联网上还有[其他几本书](http://www.amazon.com/s/ref=nb_ss_gw?url=search-alias%3Daps&field-keywords=tcl%2Ftk)和相当多的电子资源。一些好的起点是：[Tcl 教程](http://www.tcl.tk/man/tcl8.5/tutorial/tcltutorial.html)、[TK 教程](http://www.tkdocs.com/)、[Tcl 倡导站点](http://www.tcl.tk/about/)（可能值得仔细阅读以帮助您决定是否要走这条路）、[Tcl/Tk Wiki](http://wiki.tcl.tk/)，当然还有[Stackoverflow](https://stackoverflow.com/questions/tagged/tcl)。

TK 会给你一个简单的图形用户界面，并且很容易学习编程——如果有点简单的话。如果您花一些时间来[调整外观](https://stackoverflow.com/questions/349409/why-are-tk-guis-considered-ugly#349792)或使用诸如[Tile](http://tktable.sourceforge.net/tile/)之类的主题引擎，它就不像以前那么[难看了。](https://stackoverflow.com/questions/349409/why-are-tk-guis-considered-ugly)

正如 Norman Ramsey[指出的 (+1)](https://stackoverflow.com/questions/385156/how-do-i-retrofit-a-gui-to-an-existing-c-program#385550)，另一个使用简单 C API 的替代方案是[Lua。](http://www.lua.org/) 两者都有优点和缺点。Tcl 的主要优势是简单和干净集成的 TK 工具包以及来自第三方库（例如[Tix](http://sourceforge.net/projects/tixlibrary/)）的良好、成熟的支持支持。Lua 的主要优势在于语言要好得多，但没有标准的 GUI 工具包，因此 UI 没有那么好集成。Lua 对解释器中的线程也有更好的支持，从一开始就是为此而设计的。但是，如果您正在包装一个遗留的 C/unix 应用程序，这不太可能是一个重要的特性。

WXWidgets 比 TK 复杂得多，并且承载更多运行时包袱，但具有更丰富的功能集。

如果你有真正的理由认为你的脚本项目会发展成一个更大的应用程序，你可能会考虑 Lua。然而，在更大的范围内，您将进入一个实质性的开发项目，[Python](http://www.python.org)或[Ruby](http://www.ruby-lang.org/en/)开始成为可行的选择。随着项目变得越来越大，C 代码库将占整个项目的一小部分，第三方库支持将成为更大的考虑因素。

如果您使用 Tcl 并发现您的项目获得了自己的生命，请考虑嵌入 Tcl 解释器并将应用程序重新转换为插件 API，人们可以将自己的脚本挂接到其中。额外的功能可以作为脚本完成，并且可能会交给第三方进行维护。具有内置脚本语言的系统的优点之一是您个人不必实现功能。人们可以用脚本语言编写自己的扩展或让第三方为他们做。

SWIG 旨在生成围绕库的包装器。它解析头文件并生成一个粘合层，以目标语言呈现本机 API。要使用它，您必须将程序重构为库。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-22T04:20:24.770

正如其他人所说，Tcl/Tk 是一个不错的选择。确实**存在超出 Tcl 语言的风险，但是****Tk 窗口工具包的强大功能和简单性**可以减轻这种风险。

我会考虑的另一个选择是[wxlua](http://wxlua.sourceforge.net/)。原因是**[Lua](http://www.lua.org)是一种你*不会*长大**的语言。您可能还更喜欢 wxlua，因为它是基于[wxwidgets](http://www.wxwidgets.org/)的，它可以为您的 GUI 提供**原生的外观和感觉**。最初的 Tk 有一个相当奇怪和非常非本地的外观和感觉，但现在情况好多了，所以这个理由可能没有太大的说服力。您可能会查看这两个 GUI 工具包，看看有什么吸引人的地方。您可能更喜欢 Lua 的最后一个原因是**它更容易将用户定义的数据类型公开**给 GUI 和脚本。

我不会考虑诸如 Python 和 Gtk+ 之类的替代方案，因为存在所有替代方案，**只有 Tcl 和 Lua 从一开始就被设计为与 C 程序结合**。

您还**询问 SWIG**。虽然它表面上很有吸引力，但我建议避免它。Tcl 和 Lua 都有**非常简单的 C API ，如果您****学会自己使用本机 API**而不是让 SWIG 为您生成代码，您将学到更多、更好地理解并更好地控制您的应用程序。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-22T04:00:35.450

我必须第二个 Tcl/Tk。我对用 Fortran/C/C++ 编写的遗留程序做了同样的事情。由于在 Tcl/Tk 中编写 DSL 非常简单，我最终只是为程序添加了一个选项，以输出 DSL（本质上是用 procs 编写的 Tcl 命令），以便 tk 程序进行 eval。我已经为一个在 tk 画布上制作相当复杂的图形动画的程序完成了此操作，该程序可以选择在大约 4 小时内将部分动画保存为 mpeg。人们大吃一惊。它也是完全便携的。Tcl/Tk 具有用于编写 GUI 应用程序的简单而复杂的事件驱动工具（在其简单性方面仍然无与伦比）。您可以使用简单管道与遗留程序交互，只要它可以从标准输入读取并写入标准输出。

这种方法的巨大优势是您不需要将任何 GUI 或其他库与您的遗留程序链接，这有时是不可能的。GUI 和遗留程序可以完全解耦。

那是大约 10 年前的事了。从那时起，Tk 已经发展/改进了很多，并获得了原生的外观和感觉能力。

过去的主要缺点是打包标准单独的 Tcl/Tk 程序，现在也基本解决了。

**编辑：** DSL 代表 Tcl 解释器的[“域特定语言”](http://en.wikipedia.org/wiki/Domain-specific_programming_language) 扩展，它们表现为新的语言关键字。Tcl 具有相当基本的语法，因此这种机制为扩展语言提供了很大的空间。使用 Tcl 执行此操作的应用程序的一个很好的示例是[Expect。](http://expect.nist.gov/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-21T23:20:43.440

我以前使用 tcl/tk 来包装较小的 CLI 程序，而且它通常可以很好地开始。

tcl/tk 是一种脚本语言/包，它将调用和解析 CLI 输出，因此您不必编写新*程序*

[tcl/tk](http://tcl.tk/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-21T23:23:05.060

Tcl/Tk 怎么样 .. 大量的资源 .. 像[这样](http://wiki.tcl.tk/3474)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-21T23:20:36.063

既然你已经熟悉 PyGTK，为什么不使用[Gtk+](http://www.gtk.org/)呢？毕竟，PyGTK 只是围绕 Gtk+ 的绑定，它是用 C 编写的。

它也是跨平台的。因此，如果您使用[GLib](http://library.gnome.org/devel/glib/) ，您的应用程序几乎可以在任何地方运行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-21T23:23:38.130

任何工具包或框架都可以解决您的问题，因为您请求的 UI 充当命令行可执行文件的包装器。您可以选择 C#、MFC、VB6，任何您想要的工具。基于 .NET 的语言（例如 C#）对于命令行 UI 包装器来说非常容易。如果你想用 C++ 来做，wxWidgets、Qt 或 Ultimate++ 可以帮助你。

如果你知道如何用 C 编程，你可以用普通的 Win32 API 来做，尽管你必须管理一些在 C++ 框架中自动处理的事情。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-21T23:24:32.793

我认为[MGUI](http://web.tiscali.it/morello/MGui/)是您可以使用的东西！

> MGui（MORELLO 图形用户界面）是一个用 ANSI C 编写的跨平台图形用户界面，还通过框架库提供 C++ API。它由一个库组成，包括所有典型的 GUI 对象，如菜单、按钮、可编辑字段、列表等……和一个代码生成工具（MGui Designer），它允许用户使用鼠标创建和维护应用程序窗口布局。
> 
> MGui 可以在不了解主机系统图形 API 的情况下为 Windows 3.1、Windows 95/98/NT、Unix X-Window、DOS（Borland、Watcom 和 DJGPP）创建应用程序。您可以简单地使用 MGui Designer 代码生成器来创建窗口布局，并编写代码以与创建的对象进行交互。
> 
> 就其特性而言，MGui 对任何想要实现多平台应用的人都非常有用，完全不需要 GUI 移植。它非常适合在基于 DOS 的嵌入式系统中以实模式和 DPMI 使用。

顺便说[一下，这](http://www.thefreecountry.com/sourcecode/gui.shtml)是一个很好的库列表。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-21T23:27:31.930

您可以使用任何您喜欢的工具包（tcl/tk 或您熟悉的任何其他具有 GUI 功能的脚本语言），但建议将原始程序保留为 CLI 程序（然后您的 GUI 在从用户那里收集选项后运行） ） 很好。无需进入 C 绑定等。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-21T23:30:07.963

如果您的程序中需要文本模式的 UI，[TxWin](http://svn.netlabs.org/txwin)是一个不错的选择。

另一个，[TVision](http://tvision.sourceforge.net/)是 gool ol' Borland TurboVision 的克隆。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-22T16:44:50.433

在不推荐特定库或 GUI 工具包的情况下，请注意大多数 GUI 工作在“事件驱动”模型上。

这意味着大多数时候应用程序都在做这样的事情：

1.  等待事件（例如键盘输入、定时器到期等）
2.  根据该事件调用一些用户指定的函数
3.  循环回到步骤 1。

如果调用的函数花费大量时间，它会使您的程序无响应。

解决这个问题意味着要么让你的 GUI 在另一个线程中处理，要么让长期存在的函数偶尔让步以检查用户是否试图中止它们。

# sql-server - Generic Data Access functions

> ID：385178
> 
> 赞同：0
> 
> 时间：2008-12-21T23:27:13.130
> 
> 标签：sql-server, function, oledb, data-access

What is the best way to code the following generic data access functions (ADO.NET, C# or VB, SQLServer or OLEDB)

1.  Execute SQL on a connection
2.  Open a DataReader
3.  Open a DataSet (any ideas on this one?)

Such that I can call these functions from anywhere in my program. I'm not interested in Data Access patterns or Data Access layers unless they directly apply to these functions. (i.e. a pattern to automatically close the connection or the reader/dataset)

Examples of use

```
ExecuteSQL("UPDATE tblTest SET x = 5 WHERE [ID] = 4")

Using rdr As OleDb.OleDbDataReader = OpenReader("SELECT * FROM tblExecute")
  While rdr.Read()

  End While
End Using

```

Example functions

```
    Public Function ExecuteSQL(ByVal strSQL As String) As Boolean
        Using cn As New OleDb.OleDbConnection(strConn)
            cn.Open()
            Using cmd As New OleDb.OleDbCommand(strSQL, cn)
                Return cmd.ExecuteNonQuery() > 0
            End Using
        End Using
        Return False
    End Function

    Public Function OpenReader(ByVal strSQL As String) As OleDb.OleDbDataReader
        Dim cn As New OleDb.OleDbConnection(strConn)
        cn.Open()
        If cn.State = ConnectionState.Open Then
            Dim cmd As New OleDb.OleDbCommand(strSQL, cn)
            Return cmd.ExecuteReader(CommandBehavior.CloseConnection)
        Else
            Throw New Exception("Unable to connect to database.")
        End If
    End Function

```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T23:33:36.817

Here's my [Fill](http://www.madprops.org/blog/another-idbcommand-extension-fill/) method which, given a generic list and a lambda, populates the list with objects read from an IDataReader:

```
public static void Fill<T>(this IDbCommand cmd,
    IList<T> list, Func<IDataReader, T> rowConverter)
{
    using (var rdr = cmd.ExecuteReader())
    {
        while (rdr.Read())
        {
            list.Add(rowConverter(rdr));
        }
    }
} 
```

You use it like this:

```
// var cmd = new SqlCommand(...);
// var things = new List<Thing>();
cmd.Fill(things, r => new Thing { ID = r.GetInt32(0), Name = r.GetString(1) }); 
```

Really handy to be able to wrap up that ExecuteReader and Read loop in one line like that.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T23:34:28.657

If that's all you want then the code you have posted is essentially sufficient. As for what is best ... Well, I suggest using one of those "Data Access patterns." But this does work and there's not much more to be said. You add other functions for ExecuteScalar and so forth if you'd like.

You're basically just using strings, if you are concatenating or building your SQL then that is very bad. If you are doing that you should really be use Parameterized queries and extending your functions to use parameter collections and the like.

# flash - ActionScript 3 出现问题，无法正常工作，我不知道为什么，flash CS4

> ID：385184
> 
> 赞同：0
> 
> 时间：2008-12-21T23:29:53.937
> 
> 标签：flash, actionscript-3, actionscript, adobe, flash-cs4

我对 ActionScript 3 很陌生，我在 adobe TV 上关注了这个教程。但我不让它工作。问题是当我单击按钮时我希望框向左/向右移动，但没有任何反应。

您可以在此处下载 .fla 文件：

[http://www.habitats.no/files/AC3.zip](http://www.habitats.no/files/AC3.zip)

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T01:45:34.303

您需要命名您的实例。单击舞台上的一个影片剪辑并打开属性窗口，您应该会看到`instance name`. 您对其进行编码的方式，实例名称应与剪辑名称相同，即`mc_box`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-24T12:39:36.447

你必须给你的对象命名，例如你有：

1.  Button - 您必须将 Button 的名称放在按钮的面板属性中 - myBtn（实例名称字段中的按钮名称）；

2.  Box - 您必须将 Box 的名称放在 Box 的面板属性中（即 movieClip） - myBox（实例名称字段中 Box 的名称）；

并在操作中编写此代码：

```
myBtn.addEventListener(MouseEvent.CLICK, moveBox);
function moveBox(event):void
{
    Box.x+=25;
}

// addEventListener - Registers an event listener for the target event. 
```

调用`AddEventListener ()`时报了两个参数：

*   应响应应用程序的事件；
*   对此事件作出反应的函数。

# smtp - 为什么有 MX 记录？

> ID：385193
> 
> 赞同：17
> 
> 时间：2008-12-21T23:34:24.117
> 
> 标签：smtp, dns, mx-record

我之前[问过一个关于 MX 记录的问题](https://stackoverflow.com/questions/322659/sendmail-and-mx-records-when-mail-server-is-not-on-web-host)（并感谢我从 SO'ers 那里得到的深思熟虑的回答）。既然这个问题已经解决了，我想退后一步，问一开始为什么会有 MX 记录。

具体来说：为什么SMTP会受到DNS的特殊对待？

我们没有 HTTP 的 HX 记录或 FTP 的 FX 记录。似乎所有其他 Internet 协议都与 DNS 的 A 记录相处得很好。事实上，[关于 MX 记录的 Wikipedia 文章](http://en.wikipedia.org/wiki/MX_record)指出，当前的 SMTP 规范说，如果接收方不存在 MX 记录，则服务器应该使用 A 记录。它还提到了 SMTP 在 DNS 之前的世界中所做的一些调整，但那是 25 年前的事了。我们真的需要 MX 记录了吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-12-22T00:57:52.310

`MX`使用记录是因为 SMTP 流量需要`user@domain`以不同方式路由到该域的其他流量，并且`SRV`尚未发明记录。

`http://example.com/`您可以在没有前缀的情况下在浏览器中键入`www`并且仍然可以访问所需网站的现代约定实际上有点奇怪。为了更详细地解释，请考虑通常如何设置区域以实现这种无前缀访问：

```
$ORIGIN example.com
@        IN A   192.168.1.1
         IN MX mail.example.com
www      IN A  192.168.1.1
mail     IN A  192.168.1.2 
```

因此，`example.com`无论使用何种协议，任何发往该 IP 地址的流量都会流向该 IP 地址（除非是使用 MX 记录的电子邮件）。

在实践中，最好让*所有*应用程序都使用`SRV`记录，然后我们可以一起取消应用程序特定的前缀，并将 A 记录用于它们的真正目的——特别是将真实*主机名*映射到 IP 地址。

如果以这种方式使用 SRV 记录，则区域文件将如下所示：

```
$ORIGIN example.com
_http._tcp IN SRV 0 0 80 www.example.com
_smtp._tcp IN SRV 0 0 25 mail.example.com
www        IN A 192.168.1.1
mail       IN A 192.168.1.2 
```

这种假设域中的主要记录实际上是用于 HTTP 服务的，这也是 Verisign 的[SiteFinder](http://en.wikipedia.org/wiki/Site_Finder) “服务”引起与 2003 年（简要）引入时一样多的问题`A`的部分原因。通过拦截所有 DNS记录查找未知域并返回他们自己的地址之一，威瑞信打破了各种协议，这些协议假设如果 DNS 查找失败，他们可以故障转移到其他地址数据库机制。`A`

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-21T23:39:10.113

MX 记录背后的主要目的是能够指定机器来处理整个域的特定协议，并指定备份邮件服务器（具有不同的优先级）。这样，如果一台服务器出现故障，您仍然可以访问将电子邮件发送到该域的下一个服务器。纯 A 记录也不能做到这一点，它直接将全名映射到主机。

正如弗兰克指出的那样，现在可以使用[SRV 记录](https://www.rfc-editor.org/rfc/rfc2782)（日期为 8 年前，而不是 25 年）来完成。那时还没有很多其他标准协议可以大规模使用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T23:37:29.647

> 似乎所有其他 Internet 协议都与 DNS 的 A 记录相处得很好。

好吧，SRV 记录类型适用于那些。

如果今天正在编写 SMTP，它可能会使用它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-22T00:05:33.430

除了允许指定备份交换器之外，请注意并非每个域都有自己的邮件服务器，因此有必要能够指定存在于另一个域上的邮件服务器作为交换邮件的授权，以便管理和系统消息处理可以传递给邮政主管、根或 DNS WHOIS 记录中列出的任何技术/管理联系人，即使它们在当前域中不存在。

对于 ftp 和 http，您只是不需要它，因为这些服务不会像 MX 那样启动出站连接，也不会被视为官方联系点。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-22T00:21:55.703

永远不要忽视“历史原因”的解释。早在 80 年代初期，SMTP 几乎是唯一一个必须可用于映射整个站点的公开协议——DNS 查找是使用许多系统上的通用 HOSTS 文件完成的。

# java - 限制对 Spring MVC 控制器的访问——一次 N 个会话

> ID：385195
> 
> 赞同：6
> 
> 时间：2008-12-21T23:35:20.963
> 
> 标签：java, multithreading, spring, session, controller

我们已授权商业产品（在此上下文中不重要的产品），该产品受并发用户数量的限制。用户通过 Spring Controller 访问该产品。

我们有该产品的 N 个许可证，如果 N+1 个用户访问它，他们会收到一条关于需要购买更多许可证的令人讨厌的错误消息。我想确保用户看不到这条消息，并且希望对产品的请求只是“排队”，而不是让 N+1 用户实际访问它。当然，他们更愿意我购买许可证，因此他们的工具不会让我们在本地执行此操作。

代替能够控制该工具，我想将与控制器的并发会话数限制为永远不会超过 N。其他人可以等待。

我们正在使用 Spring MVC。

有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-22T06:59:10.443

你需要的是一个对象池。查看 Apache Commons Pool [http://commons.apache.org/pool](http://commons.apache.org/pool)

在应用程序启动时，您应该创建一个带有许可证或商业库对象的对象池（不确定它们具有什么样的公共接口）。

```
public class CommercialObjectFactory extends BasePoolableObjectFactory { 
    // for makeObject we'll simply return a new commercial object
    @Override
    public Object makeObject() { 
        return new CommercialObject(); 
    } 
}

GenericObjectPool pool = new GenericObjectPool(new CommercialObjectFactory());

// The size of pool in our case it is N
pool.setMaxActive(N) 
// We want to wait if the pool is exhausted
pool.setWhenExhaustedAction(GenericObjectPool.WHEN_EXHAUSTED_BLOCK) 
```

当您需要代码中的商业对象时。

```
CommercialObject obj = null;
try { 
    obj = (CommercialObject)pool.borrowObject();

    // use the commerical object the way you to use it.
    // ....

} finally { 
    // be nice return the borrwed object
    try {
        if(obj != null) {
            pool.returnObject(obj);
        }
    } catch(Exception e) {
        // ignored
    }
} 
```

如果这不是您想要的，那么您将需要提供有关您的商业图书馆的更多详细信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T19:21:41.497

Spring has a org.springframework.aop.interceptor.ConcurrencyThrottleInterceptor that can be used via AOP (or the underlying code can be used standalone). That might be a lighter weight approach than using a object pool.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-26T23:22:55.040

我正在考虑使用 SessionListener 在创建会话时增加计数，并在会话无效或超时时减少计数，以及保护对 URL 的调用的方面。但是一个将这两个想法明显结合在一起的设计让我望而却步。

# php - 大型项目没有 PHP？为什么不？

> ID：385203
> 
> 赞同：64
> 
> 时间：2008-12-21T23:42:14.583
> 
> 标签：php, scalability, projects

我读过一些帖子，其中有人说（不建议、不讨论、不提供）PHP 不应该用于大型项目。

作为一名主要的 PHP 开发人员，我问了两个问题：

1.  什么定义了“大型项目”？
2.  为什么不？使用PHP有哪些陷阱

我经营着一个小型开发团队，从经验中我知道质量构建、组织、文档、评论和封装是我们的首要任务。我们能够使用我们自己的框架和方法开发伟大的项目，但如果我在浪费时间，我仍然不想进一步投资。

想法？

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2008-12-22T00:21:43.973

我真的很讨厌人们直截了当地说 PHP 是一种糟糕的语言，因为您可以编写将表示与逻辑混合在一起的代码，或者它允许您进行 SQL 注入。**这与语言无关，那是开发人员。**

PHP 已证明自己具有高度可扩展性：Wikipedia 是 Internet 上最大和最受欢迎的站点之一，它运行 PHP。说够了？

有很多工具/库可以为您提供工作框架，从而减少有人编写糟糕、难以维护的代码的可能性：参见 CakePHP、Symfony、PDO、Smarty 等。

它受到了不好的评价，因为它是一种进入门槛非常低的语言：它是免费的，你可以获得非常便宜的 PHP 托管，**[文档是最好](https://stackoverflow.com/questions/181421/who-has-the-best-documentation-you-have-ever-seen-language-framework-cms-who-ha#181457)**的，网上有很多教程，而且它做了很多事情非常容易（例如：打开一个 URL 并获取文件的内容：）`file('http://www.google.com');`。这意味着很多新手都选择了它，并用它制作了很多非常狡猾的网站，但无论你选择什么语言作为你的第一个，这都会发生。

使用一个可靠的 ORM 框架（关于 SO 有大约 30 个关于哪个是最好的问题），它会对你很好。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-12-21T23:58:13.380

很多说不使用它的人实际上是在说不要使用 PHP 4。归根结底是这样

**你可以用任何语言编写好的代码**

和

**你可以用任何语言编写糟糕的代码**

PHP 经常可以使自己成为纠结的意大利面条代码库，并使您的“应用程序”实际上只是一系列脚本（参见 Moodle 以获得一个很好的例子......）

我认为很多“不要将 PHP 用于大的东西”来自 PHP 的原始目的：模板语言。我可以理解，但是有很多项目证明你可以做到（Drupal、mediawiki、Facebook）。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-12-22T00:00:51.597

没有理由不能将 PHP 用于大型项目。毕竟，Facebook 是建立在 PHP 之上的。但是会有问题，但是任何大型项目都会有问题。

使 PHP 如此普及的原因在于入门门槛低和托管成本低。它作为 Apache 扩展运行，您几乎可以开始编码。如果您使用更多的企业平台，例如 .Net 或 Java，它们的进入门槛要高得多，但它们也带有许多基础设施来帮助您制作可扩展的应用程序。

例如，PHP 中的数据库抽象是（恕我直言）可悲的。它是特定于供应商的。使用 MySQL，人们倾向于执行以下操作：

```
function get_users($surname) {
  mysql_query("select * from users where surname = '$surname'");
  ...
} 
```

这很糟糕，有几个原因：

*   它没有充分利用查询缓存；
*   它不处理字符转义（当然，可以这样做，`mysql_escape_string()`但你会惊讶于人们不这样做的频率）；和
*   以允许 SQL 注入攻击的方式进行编码是相当容易的。

出于上述所有原因，我个人更喜欢 mysqli，但它有自己的问题：即使用 LONGTEXT 字段会使 mysql 崩溃，并且至少从 2005 年开始就已经完成，但仍然没有修复（是的，我和其他几个人提出了一个错误）。

将此与 Java（我更熟悉）相比，JPA 或 Ibatis 是更好的 ORM 解决方案，具有更高的启动成本，但它们会在企业规模上为您提供帮助。

所以你不会被禁止在 PHP 上做大型项目。更难的是，您必须自己做越来越多的工作才能复制其他平台为您提供的功能。

话虽如此，PHP + memcached/APC + beanstalkd 有很长的路要走。

哦，那是另一个问题：PHP 并不真正支持后台处理或线程。您需要其他东西（或独立脚本）。如果您正在使用其他东西，为什么不将它也用于 Web 内容（例如 Java、Ruby、.Net 等）？

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-12-22T00:00:19.023

由于[我链接的问题](https://stackoverflow.com/questions/309300/what-makes-php-a-good-language)已被删除，我将在此处放置一些问题：

## 问题

* * *

我在另一个问题线程中发表了一个诙谐的评论，称 PHP 是一种糟糕的语言，但它却像疯了一样被否决了。显然这里有很多人喜欢 PHP。

所以我真的很好奇。我错过了什么？是什么让 PHP 成为一门好语言？

以下是我不喜欢它的原因：

*   PHP 的内置函数和库函数的命名不一致。可预测的命名模式在任何设计中都很重要。

*   PHP 的内置函数的参数顺序不一致，例如 array_map 与 array_filter 在简单的情况下很烦人，并引发各种意外行为或更糟。

*   PHP 开发人员不断弃用内置函数和低级功能。一个很好的例子是当他们弃用函数的传递引用时。这对任何做函数回调的人来说都是一场噩梦。

*   重新设计时缺乏考虑。上述弃用在许多情况下消除了为函数提供默认关键字值的能力。他们在 PHP 5 中修复了这个问题，但他们弃用了 PHP 4 中的传递引用！

*   名称空间执行不佳（以前根本没有名称空间）。既然名称空间已经存在，那么我们使用什么作为解引用字符呢？反斜杠！普遍用于转义的字符，即使在 PHP 中也是如此！

*   过于宽泛的隐式类型转换会导致错误。我对浮点到整数或再次返回的隐式转换没有问题。但是 PHP（我上次检查过的）会很乐意尝试神奇地将数组转换为整数。

*   递归性能差。递归是用任何语言编写的一种根本上重要的工具。它可以使复杂的算法变得简单得多。支持不佳是不可原谅的。

*   函数不区分大小写。我不知道他们在想什么。编程语言是一种为计算机和代码阅读者指定行为而没有歧义的方法。不区分大小写会带来很多歧义。

*   PHP 鼓励（实际上要求）处理与表示的耦合。是的，您可以编写不这样做的 PHP，但实际上以不正确的方式（从合理的设计角度）编写代码更容易。

*   没有缓存，PHP 的性能非常糟糕。有人出售 PHP 的商业缓存产品吗？哦，看，PHP 的设计者就是这样做的。

最糟糕的是，PHP 让人们相信设计 Web 应用程序很容易。它确实使所涉及的大部分工作变得容易得多。但事实是，设计一个既安全又高效的 Web 应用程序是一项非常艰巨的任务。

通过说服这么多人从事编程，PHP 教会了一整群程序员坏习惯和坏设计。它使他们能够访问他们缺乏安全使用理解的能力。这导致了 PHP 不安全的声誉。

（但是，我很乐意承认 PHP 并不比任何其他 Web 编程语言更安全。）

我对 PHP 缺少什么？我看到了一种有机生长、管理不善的语言混乱局面，它正在孕育出可怜的程序员。

所以说服我，否则！

* * *

## 评分最高的答案

* * *

我会尽力回应你的每一个要点

> PHP 的内置函数和库函数的命名不一致。可预测的命名模式在任何设计中都很重要。

我既喜欢又讨厌这个话题。因为从本质上讲，这个问题是正确的。为什么有些双字函数用下划线分割，有些则没有？为什么 needle 和 haystack 参数有时会在参数签名中交换位置？这太荒谬了。但归根结底……这真的重要吗？我的带有智能感知和 php.net 的 IDE 只需单击浏览器即可，这很简单，没什么大不了的。它对 PHP 作为一种语言有负面影响吗？是的。它会妨碍我成为一名有效的程序员的能力吗？不。

> PHP 开发人员不断弃用内置函数和低级功能。一个很好的例子是当他们弃用函数的传递引用时。这对任何做函数回调的人来说都是一场噩梦。

就个人而言，我认为这不是一个好点。弃用对于一门语言的发展来说是必要的，尤其是像 PHP 一样有缺陷的语言。PHP 因“轻松成为一名糟糕的程序员*”而受到很多抨击，但与此同时，当 PHP 团队试图从语言中删除愚蠢的结构时，例如调用时传递-参考。消除调用时间传递引用是他们做过的最好的举措之一。对于新手开发人员来说，没有比使用此“功能”更容易的方法了。

> 重新设计时缺乏考虑。上述弃用在许多情况下消除了为函数提供默认关键字值的能力。他们在 PHP 5 中修复了这个问题，但他们弃用了 PHP 4 中的传递引用！

我不认为普遍缺乏考虑，我认为你只是被这种特殊的变化刺痛了，嘴里一直有酸味。语言变化通常提前几个月甚至几年就知道了。为从 4 迁移到 5 提供了迁移指南，并且版本差异记录在手册中。调用时传递引用是一个可怕的“功能”，并没有给开发人员任何他们无法通过其他方式获得的表达能力。我很高兴它消失了（以及其他诸如魔术引号之类的废话）

> 名称空间执行不佳（以前根本没有名称空间）。既然名称空间已经存在，那么我们使用什么作为解引用字符呢？反斜杠！普遍用于转义的字符，即使在 PHP 中也是如此！

对此我五味杂陈。我的一部分认为“谁在乎，字符转义无论如何在字符串之外没有任何意义”，而我的一部分认为“他们肯定可以使用更好的东西”。但他们可以吗？我不知道，我不是 Zend 解析器的开发人员。直到 5.3 版本的 PHP 根本没有命名空间，这是一个巨大的疏忽吗？是的，一点没错。

> 过于宽泛的隐式类型转换会导致错误。我对浮点到整数或再次返回的隐式转换没有问题。但是 PHP（我上次检查过的）会很乐意尝试神奇地将数组转换为整数。

我认为可以不同意 PHP 如何做到这一点，但不同意它使语言“坏”。但是问我，我有多想坐在这个话题上，争论弱类型和强类型。（PS 我根本不知道*）*记录在案：当参数的类型很重要并且无法通过强制解决时，PHP 将发出 E_WARNING 级别的错误。

> 递归性能差。递归是用任何语言编写的一种根本上重要的工具。它可以使复杂的算法变得简单得多。支持不佳是不可原谅的。

PHP 是用于 Web 的 DSL。我已经全职工作了 8 年，并且可能使用了 4 或 5 次递归，通常用于某种类型的烦人目录或 XML 遍历。这不是 Web 开发经常需要的模式。我不是在为缓慢的性能辩解，但这是一个学术问题，而不是生产问题。如果您需要真正强大的递归性能，那么 PHP 已经不适合您了。

> 函数不区分大小写。我不知道他们在想什么。编程语言是一种为计算机和代码阅读者指定行为而没有歧义的方法。不区分大小写会带来很多歧义。

我完全 100% 同意这一点。

> PHP 鼓励（实际上要求）处理与表示的耦合。是的，您可以编写不这样做的 PHP，但实际上以不正确的方式（从合理的设计角度）编写代码更容易。

*嗯，这个话题听起来非常熟悉……

但说真的，我发现人们会抱怨一种绝对 100% 允许你实现任何你想要的输出系统的语言（仅 PHP 模板系统的庞大数量和风格就说明了这一点）——或者——跳过所有这些开销和直接输出就好了。这并不会使 PHP 变得糟糕。这是使 PHP 变得更好的部分原因。

> 没有缓存，PHP 的性能非常糟糕。有人出售 PHP 的商业缓存产品吗？哦，看，PHP 的设计者就是这样做的。

您是指字节码缓存（如加速器）还是输出缓存？

如果是前者，那我真的不知道我对这个话题有多在意。加速器免费且易于运行。我们可以争论为什么它不是语言的一部分，但最后，我认为这并不重要。

如果您在谈论输出缓存，那么我不知道该对您说什么。任何具有大量流量的 Web 项目都需要缓存（例如，种子播客 #27）。*这根本*不是 PHP 特有的问题。

总之，我认为您认为 PHP 是一种非常学术化的“坏”语言。在您之前的帖子中，您可能被像我这样使用 PHP 来“完成工作”的人否决了。

* * *

## 第二个评分最高的答案

* * *

您的所有批评（以及更多批评）都是有效的。你被允许甚至被期望讨厌 PHP。

但是，话又说回来，它有一些好处：

*   无处不在
*   快速（尤其是使用操作码缓存）
*   庞大的社区（以及出色的文档）
*   作品

最后，您可以通过编写用任何其他语言编写的好代码来克服许多（如果不是全部的话）缺点。你可以用 PHP 编写可靠、安全和好闻的代码，与许多替代方案相比，它运行速度更快，更容易托管和扩展。

* * *

## 第三个评分最高的答案

* * *

> 我对 PHP 缺少什么？我看到了一种有机生长、管理不善的语言混乱局面，它正在孕育出可怜的程序员。

简单的。事实上，糟糕的程序员对他们的语言非常防御。;) PHP 很容易学习，比替代品容易得多，而且一旦你学会了它，它就不是很明显了 1) PHP 有什么问题，2) 替代品如何更好，以及 3) 如何切换到，以及学习，选择之一。

也许事实上，人们有什么选择？ASP？这本身就有很多问题，从无法在大多数网络服务器（Apache）上运行，到一些荒谬和过度设计的设计选择（webforms？Viewstate？AJAX，你的异步“请求被拦截并按*顺序*运行？ ) Ruby on Rails？嗯，也许，除了有多少网络服务器再次支持它？目前还不是很容易接近。而且速度很慢。所以也许 PHP 的“优势”真的是没有*好的*替代品存在。至少这就是为什么我尽可能远离所有 Web 编程。PHP 很烂，而且我也不太热衷于任何替代方案。

PHP 有很多基本问题，甚至都不好笑。从缺乏 unicode 支持，到许多经常导致意外安全漏洞的隐式类型转换，到完全混合表示和......其他所有内容，或者到不使用的默认数据库模块（最后我检查过）参数化查询。我们正在谈论一种为两件事而设计的语言，数据库访问和生成 HTML，这两者都很糟糕。

这只是一个令人讨厌的混乱，一种由没有资格或能力设计语言的人设计的语言。;)

* * *

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-22T00:07:21.287

对我来说，PHP 最糟糕的罪过是表示与业务逻辑的耦合。并不是说您不能以更好的方式编写它，而是它不鼓励您这样做，如果有的话，它鼓励您不要这样做。

大量的安全漏洞也与 PHP 站点有关。我无法证明它是不成比例的（毕竟很多网站都是用 PHP 编写的），但我怀疑它是。如果我是对的，那么由于安全漏洞是一类错误，我怀疑 PHP 网站总体上也倾向于更多错误。

（顺便说一句，我不认为指向几个大型网站并说他们设法用 PHP 做到这一点是反对这一点的任何论据。这有点像说香烟不会致癌，因为你的隔壁邻居吸烟并活到100岁。）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-22T00:36:26.517

看看这个类似的问题 - [PHP 可以处理企业级网站以及 Java](https://stackoverflow.com/questions/130869/can-php-handle-enterprise-level-sites-as-well-as-java)

Recapping - Facebook、Wikipedia、Yahoo.com、Digg、Flickr 和许多其他大型网站都在 PHP 上运行。如果您曾经接近于制作那种水准的东西，您仍然可以放心，您可以使用 PHP 实现目标。

您的应用程序的可维护性、可扩展性、可靠性、安全性和性能如何完全取决于您，并且与语言无关。虽然支持 PHP，但它有非常方便的工具来构建 Web 应用程序。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-22T00:38:54.110

对我来说，谈到大型甚至大型项目，它（主要）归结为一个词：**依赖关系**。

脚本语言的问题就像世界上的每一件事一样：最大的优势同时也是最大的劣势。

最大的优势是编码免费且快速。只需编写一个脚本，它就会达到它的目的。无需冗长，只需编写代码。

在某种程度上，最大的缺点是检查这个脚本是否不会干扰其他脚本。或者更好：更改其他人依赖的旧脚本。您确定所有依赖项都按您的意愿工作吗？

这对于“正常”网页生成来说是不正确的，无论正常在这里是什么意思。但是我们有一个产品依赖于大约 500k 行源代码，为客户定制的代码也包含额外的 100k 行代码。而且我非常高兴编译器检查所​​有依赖项并警告/错误我以防我做错了什么（比如，在这里说最低级别，错误输入变量或方法调用）。

我认为这一点以及其他语言本质上提供更易于使用的“企业”功能（即用于“银行用途”的应用程序服务器）的事实归结为为什么许多人看不到大型 PHP（或更好：巨大）项目。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-21T23:47:33.637

我们公司使用 PHP 运行了几个大型网站，并且没有遇到与语言相关的问题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-10-02T01:33:50.443

PHP 语言的构造对我来说还不够好。例如，函数的名称。使用多种方法以一种语言命名函数不是最佳实践。下划线（function_name）、单词粘在一起（functionname）等之间的混合。我的意思是，这真是一团糟。有太多的功能非常相似或做同样的事情，但他们的名字是如此混乱。这不是好的编程语言的特征。

在大型部署中，语言必须足够简单和具体才能编写。PHP 省略的一些东西，比如变量类型的声明，在以后变得非常难以理解和处理。

另一点是不断添加功能和取消其他一些功能。它假设在 PHP 5 中添加 OOP 将使程序员的事情变得更容易，但是向后兼容性的考虑呢？

这种编程语言之所以如此，主要原因在于它的起源：个人主页。它不是为大型部署而设计的。

我知道要使这种语言成为企业级语言需要付出很大的努力，而就我个人而言，我正在等待一种足够好的开源服务器端编程语言；但在这一天到来之前，桥下会流很多水。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-22T06:04:24.563

这些都是很好的答案。

我是个新手。我只写了 5 年代码，但我直接支持和管理 85 个小型到大型网站，我会告诉你，网站关闭一天可能会被起诉，这对你的学习欲望有很大帮助如何制作更好的代码。

很高兴听到成熟的开发人员分享他们对此事的看法。我不认为 PHP 是最好的，但似乎我对“最佳实践”的投资得到了很好的服务。

谢谢大家！

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-05-29T07:10:55.120

见：[http ://www.ukuug.org/events/linux2002/papers/html/php/](http://www.ukuug.org/events/linux2002/papers/html/php/)

# .net - 从平面数据库结果集中填充对象层次结构的最佳实践？

> ID：385205
> 
> 赞同：2
> 
> 时间：2008-12-21T23:43:31.710
> 
> 标签：.net, data-structures

**这是从平面列表生成树**的经常出现的问题。我发现自己依赖于下面描述的两级方法。如果有人提出更好的方法，可以很容易地扩展到多个级别，我将不胜感激。

描述：

*   结果集是平面的并且包含对 parentId 的引用
*   根项的 parentId 为 null 或为零。在示例代码中，FromDb.ParseInt 将通过将 DBNull 转换为零来处理它。

```
 using (SqlDataReader reader = command.ExecuteReader())
{
    List<ParentDataObject> results = new List<ParentDataObject>();
    ParentDataObject parent = new ParentDataObject();
    ParentDataObject previousParent = null;
    while (reader.Read())
    {
        parent.Id = FromDb.ParseInt(reader["ParentId"]);

        // Parent-level
        if (previousParent == null || parent.Id != previousParent.Id)
        {
            if (previousParent != null)
            {
                results.Add(previousParent); // save previously processed ParentDataObject
            }
            parent = new ParentDataObject();
            // Fill parent object with data...
        }
        // Child-level
        ChildDataObject child = new ChildDataObject;
        // Fill child with data...
        parent.Children.Add(child);
        previousParentId = currentParentId;
    }
    // add last parent to results
    if (previousParent != null)
        results.Add(previousParent);
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T00:57:22.980

这样的事情怎么样？（伪代码）

```
class HierarchicalObject
{
    int ID;
    List<HierarchicalObject> Children;
    // Other fields
}

...

var roots = new List<HierarchicalObject>();
var index = new Dictionary<int, HierarchicalObject>();

while (reader.Read())
{
    HierarchicalObject current = new HierarchicalObject();

    // fill in data from record

    int parentID = (int)reader["ParentID"];

    if (parentID != 0)
    {
        index[parentID].Children.Add(current);
    }
    else
    {
        roots.Add(current);
    }

    index.Add(current.ID, current);   
}

// roots now contains list of root objects; throw out index 
```

这假设您的所有对象都是同质的，而不是具有单独的父/子类，并且排序是这样的，您不会在读取父级之前读取子级......但它应该适用于多个级别，您可以根据需要进行调整。

（如果第二个假设不成立，您可以先将所有记录读入索引，然后再通过索引返回并修复根和子。）

# process-management - What measurements to you use to improve your processes?

> ID：385213
> 
> 赞同：9
> 
> 时间：2008-12-21T23:51:14.660
> 
> 标签：process-management, kpi

This question was originally asking 'What KPIs do you use to in a software development organisation'. Unfortunately it seems that *KPI* is a four-letter word, and the immediate assumption is that KPIs are always mis-used (maybe they are?).

So, I've hopefully improved the question to get at the underlying goals which I originally thought KPIs were useful for. Assuming you have some process for how you (or your organisation) develops software. Secondly assume, that you (or your team) wants to become better at developing and delivery software. Finally, assume that one of the ways to improve is by refining your process.

Given all this, how do you know if your process refinements are having a positive impact? If these are *KPIs*, or [SMART goals]([http://en.wikipedia.org/wiki/SMART_(project_management)](http://en.wikipedia.org/wiki/SMART_(project_management)) please provide individual, or groups, of KPIs/SMART goals that you have found the be effective. If it is some other mechanism please explain what it is. Finally, I guess, if you don't think that improving processes is a useful thing, I guess you can explain that too.

The areas of improvement I think would be useful are: quality, timeliness of releases, productivity, flexibility. If there are other aspects of an individual or team of developers, then that would be interesting to know.

Clarifying notes:

The question is not about how to best adapt or change a process, or what a good process improvement process is (be it Kaizen, retrospectives, etc). Nor is it about root-cause analysis or other approaches used to determine what specific aspects of a process should be improved.

The use of measures to determine if process improvement has been achieved, should not be confused with ongoing, as it happens, process improvement. (That is a good thing, but it isn't what the question is about!)

The *process* could be anything; scrum, agile, extreme, waterfall, ad-hoc. This question isn't about which process is best for certain types of software development, rather it is how to improve that process over time.

Obviously the specific metric will depend on the process that is involved, and the perceived problem that is trying to be improved. This question is simply designed to get examples of metrics used, which would obviously span a number of different processes and improvement areas.

The metric need not be something that is used *all the time*, for example, it could just be used while testing if a process change works. (For example, it could be too expensive - time or money wise - to measure and track at all times, so you just track it will tweaking the process).

It is taken as a given that if implemented poorly, the use of metrics can have a detrimental effect as developers game the system or otherwise. It is assumed that the person implementing the process change is aware of this problem and has taken effective steps to mitigate it.

All software organisations are different and how they fit into their company, so will have different specific things expected of them within the company, however I would think that product quality, productivity, flexibility and timeliness of releases are applicable to most if not all organisations. (With obviously different emphasis depending on the specific organisation.)

This question has nothing to do with *source lines of code*! In particular, I am not interested in measuring programmer productivity, especially in terms of SLOCs or # of bugs fixed, or any other naive measurements. I'm interested in higher-level way a team or individual measures their improvement. I am not interested in using a single KPI to measure anyone's performance. I **am** interested in using a range of KPIs to measure and improve my team's software development processes.

I know of horror stories about KPIs being misused and being ineffective (you don't need to search very hard to find them), but I can't believe that no-one out there tries to continually improve their processes, so there must be some good examples of KPIs out there.

I know all about the drawbacks of simplistic metrics that are applied to individual software programmers. I am really hoping to get examples of KPIs or alternative strategies that people have found as useful, rather than all the reasons why I shouldn't be using KPIs.

I'm mostly interested in processes and performance related to a development organisation within a larger company, as opposed to a software development company as a whole. For example, a software company should ensure that the products have the right features for the market, but generally that is product management's role, rather than engineering. And yes, there is a complete other discussion as to why and to what extent engineers should be involved in product management, but that is a separate discussion.

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-22T00:26:49.190

When I hear Key Performance Indicator I get a little worried because usually the next thing done is to link performance to reward and then you can get unstuck very quickly. I am always reminded of the software firm that decided on a reward system around bug fixing - the testers would be rewarded for finding bugs and the developers rewarded for fixing bugs. Development ground to a halt as an instant black market formed around the insertion, detection and correction of bugs.

Your organisational KPIs should be customer focussed. Depending on the type of software product you are making, you can measure it in the following ways:

*   Sales - Is your product meeting customer requirements? You may be able to measure this in terms of the ratio of software presentations to sales or visits to your web site's purchase page to actual purchases
*   Quality - Is your software understandable and reliable? How many support calls per customer do you get per day? Are the questions about how to do something or errors?
*   Customer satisfaction - How satisfied are your customers with your product? Survey your customers and find out what you could be doing to increase their satisfaction then survey them again later to find out if you've improved. (Don't annoy your customers by asking a lot of questions or doing it too frequently)

Yes, these indicators seem to have nothing to do with the base level software metrics like bugs found and lines of code produced. However, the problem with bugs found is then you have to grade the severity of the bugs, and refactoring will often reduce your lines of code. Timeliness only matters if you are meeting your customer's expectations of timely delivery.

Concentrate on the business goals. If you have customers buying your software, they don't need a lot of support to use it and they are happy, then your software organisation is successful. No measure of bugs detected, schedule slips or anything else will matter if you don't have those three things in place.

If your software project is like the majority out there, it will be late, over budget, ship with less features than anticipated and have bugs. Don't beat yourself up over these things, deal with them and move on. Yes, you need bug databases, source control, testing and a way of measuring project velocity but in the end if you don't meet the business outcomes then you can't be successful, regardless of how polished and shiny your code is and how few bugs it has.

**Update** to try to address the revised question

KPIs as you desire to use them are difficult when delivering an intangible product that is also often a moving target. Will your KPIs used this year on an accounting system have the same meaning next year when you are implementing a document management system?

Let's take as an example a profession where KPIs are used widely - lawyers. Measuring lawyers uses KPIs such as: average billed hours worked per day; hours billed per month; age of debtors ledger; average age of unbilled work; percent of billed fees written off; and so on. You should notice a trend here - all these KPIs relate to willingness (or not) of clients to pay for the services rendered. This is the final arbiter of success and is why I suggested (above) some ways you could use this type of measurement as KPIs for your software business.

When you try to get down to having KPIs that don't relate to your client's willingness to pay for the value you are providing, then we get down to problems with what we are measuring, how you are measuring it and what differences there are in the measurement or what is being measured this year as opposed to last year.

"Dollars paid by clients" has a fixed value year to year - arbitrary metrics like "bugs in software", "timeliness of release" and "flexibility" don't have a fixed value and an increase in the KPI may not have a direct relationship to the underlying value that is meant to be measured by the KPI, such as "more bugs means lower quality".

For example, after the [Columbia disaster](http://en.wikipedia.org/wiki/Space_Shuttle_Columbia_disaster), I recall the investigation team came up with several hundred recommendations and items to be investigated. Did these newly discovered "bugs" mean the space shuttle suddenly had a lot less quality? Actually, after the investigation the space shuttle had more quality. So a KPI around bugs can easily be distorted by an extensive QA session and more bugs reported may actually mean your software has higher quality.

Productivity in terms of timeliness of releases is easily distorted by commercial factors, such as a client throwing money at you to do some custom development for them. Your release schedule will slip but your business will improve.

As for flexibility, I can't even hazard a guess at how you would measure something so intangible.

About the only measurement I can think of that has value this side of the client's wallet is [project velocity](http://extremeprogramming.org/rules/velocity.html) - how much did we estimate we would do last iteration/cycle/release and how much did we actually get done? Then plug this figure into the time available for the next iteration/cycle/release to estimate how much you will probably be able to get done this time. You can display the time remaining in a [burn down chart](http://www.mountaingoatsoftware.com/release-burndown) or similar during the iteration.

The rest comes down to process which I don't think you can pin down to KPIs. All you can do is make sure your developers know what everyone is doing (daily developer meetings), your extended team gets input (weekly or fortnightly team meetings), you understand what worked last time and what didn't (retrospectives) and above all you have transparent effective communication.

Unfortunately, I don't think there are any magic KPIs like you are after (but don't overlook the relevance of getting money from clients as a KPI).

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-22T00:47:44.140

By far the best single indicator is "tested functionality delivered and accepted". In the Agile world, we usually measure "functionality" in terms of "user stories" but it can be in any convenient form as long as it's measuring actual functionality delivered and tested, acceptable to the customer.

The usual other measures, like SLOC, SLOC/staff-hour, etc, fail because of Charlie's First Law of Management, which is:

> People will deliver whatever they're being rewarded to deliver.

Set up your measures as SLOC, and you'll get lots of SLOC. Use SLOC/hr, you'll get lots of SLOC/ht. Give them bonuses for working overtime, you'll get lots of overtime.

Oh, and remember the correlary, too:

> What people are delivering is what they think will be rewarding to deliver.

If you're not getting what you want, ask why it's rewarding to do the stuff that's getting done.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-29T19:04:38.163

Benno, I'm answering your comment but didn't have enough characters there for the answer.

This depends on the problem you are solving. For instance suppose the issue is that the time from when the developer checks in the code until it is actually placed in production seems too long. Then you would get a baseline measurement of how long it is taking. then you would put in your change and then measure for a period of time to see if it now takes less time. You might also check something like the number of times the solution was determined not to work and sent back for rework before and after as well to make sure that the solution is not faster but lower quality.

Now the problem in IT with these measurements is that it may take quite some time to accumulate enough data as some problems do not re-occur frequently. In this case you may have to start by relying on subjective data until you can accumulate enough data to know if the change was good or not. But do not ask if something is an improvement until the users have gotten used to it. The first week or two of a new process, you will meet resistance to change and thus will get bad subjective results if you ask too early.

Another thing to be wary of is that if people know you are measuring something, they will be afraid that their personal performance is being measured and thus will game the system to get good results. It is often best if you can take measurements based on some system already in place (we have a a system that manages requests for software changes, we could query the database to find out historically how many requests missed the deadline, how many we reopened after being closed or are related to past requests etc., what the time differential between developer finishing and code being moved to production etc. are). You may also have to consider eliminating severe outliers, especially if the time spans the time period of both the old and new system. For instance we have one request that has been in Qa for over a 100 days not becasue it is bad but because QA has an avaliability problem and this one is lowest priority so it keeps getting bumped for higher prioroity work. This time would not be valuable in measuring the improvement of time, becasue the factor making the time so long isn't the process you are trying to fix. If you graph the data, you will easily see the outliers that might need excluding.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T00:54:55.717

Basing your KPIs around Cost, Quality & Schedule would be a good start. Consider what are the attributes for each of those you want to measure.

Being able to split each of these measures to show the cost of bugs would be useful - lots of bug fix effort late in the project means cost/schedule blowout. Being able to profile which parts of the codebase are buggy could help in targeting additional testing & possible code re-writes - typically 80% of the bugs will come from 20% of the code. Knowing where that is will allow your team to focus better.

**EDIT**: Look at measures like Cost of Quality (CoQ) and Cost of Poor Quality (CoPQ).

Measures like productivity are always hard to quantify - for example, using LOC/day leads to a debate about what exactly is a line of code? It can also lead to silly code formatting to "boost" productivity if the developers don't understand why these things are being tracked or perceive them as personal measurements. Even if LOC/day is not measured at the developer level, you can still get team rivalry leading to the same result.

EDIT: There are some good discussions to be found on Steve McConnell's [Construx](http://blogs.construx.com/) website. [Yes, that's the Steve McConnell of Code Complete fame]

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T05:45:59.077

No process is going to help you improve what you do except actually getting everyone together and figuring out what is working and what isn't working. For the team I'm currently leading, we do this through a series of Retrospectives (of which I'd highly recommend [this book](http://www.pragprog.com/titles/dlret)). The teams generally know what parts they want to improve - the trick is giving them the empowerment to actually measure and improve those things.

Yes, you certainly still need someone looking at a Macro level. If you look at an organization like Toyota, they have a Chief Engineer who straddles that line between business and production (for a good explanation, see Scott Bellware's [blog post](http://blog.scottbellware.com/2008/12/chief-engineer.html)). In our organization we have someone similar - my boss was one of the initial developers of our product nearly 20 years ago, and stays highly active in the tech side, but is heavily invested in the customer side as well. My job is also to look at the teams as a whole to suggest improvements.

To measure, we first make sure that any improvements we strive for are things our teams can actually change, and then use something akin to the [SMART goals](http://en.wikipedia.org/wiki/SMART_(project_management)) so that any improvements are measurable. We have a [Big, Visible Wall](http://www.xprogramming.com/xpmag/BigVisibleCharts.htm) which we post the notes from the retrospective on. This happens to also be where we hold our daily stand-ups, so it gives us focus on what is going on.

For rolling up statistics to our executive meetings, we focus on code delivery - not lines of code delivered. I purposely kicked the team off measuring in [nebulous units](http://martinfowler.com/bliki/XpVelocity.html) meaning that we don't report up that we worked x number of hours, or days, or whatever. What they do see is a trending chart of how well we are delivering our features and how we are improving. We'll also include interesting tidbits when the team feels they want to share it.

The best part about all of this is that we can try things for a month, and then reevaluate it just 4 weeks later. This creates a much lower barrier to entry for trying new things, since the team knows that if it is impacting them, we'll either cancel it immediately, or we'll reevaluate and find better ways at the next retrospective.

The bad part is that it isn't exactly what you are looking for. There isn't one metric or set of metrics we continually follow. We watch trends at all times, and measure the ones that we think are interesting - but only for a little bit, and only when the team is setting out to achieve a specific goal because of them. But in general, I'm quite happy with how it works, and I've seen a marked improvement in the involvement of the teams in improving the process. We aren't quite [Kaizen](http://en.wikipedia.org/wiki/Kaizen), but we're getting better every day.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-23T18:59:34.700

I did process improvement professionally for 14 years. Here is my advice, stop trying to quantify and start talking to people. Measurement works fine for a specific problem (once you know the problem, you have a better idea what to measure) and for repeatble processes like manufacturing. Your people know exactly where the problem areas are, so do your customers and users (from a very different perspective). Flow chart (use industrial engineering symbols not computer programming symbols) out the actual process for areas where there are concerns(not what we pretend the process is, you will need to observe as well as ask questions). Once you see the whole flow of the process look for delays, areas where the work is duplicated, areas where there is unnecessary process (usually due to adding more steps to the process to account for human error, thus creating many more potential areas for human error). Question the need for each step and whether there is a better way to do each step. Test potential changes and see if in fact they are an imporvement (way too many times they make the situation worse not better). Do not under any circumstances only talk to managers when getting a feel for problems or when flow charting. You will not get a true picture and will thus solve the wrong problem.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-27T10:09:31.397

Understanding waste and value-stream mapping will show you where you need to make improvements, and from that knowledge, you will learn what you need to measure. Principles of Lean and Kanban apply here. Understanding waste and it's effects on producing software will start you down the specific path to betterment that is inevitably specific to your organization. You can't take a cookie-cutter approach. Read (or listen to) "The Goal" and "Lean Thinking" for more on this really amazing and eye-opening perspective of what's wrong and how to fix it.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-22T02:18:20.697

The best use for Key Performance Indicators is for **driving** (or steering, if your prefer). For *course-corrections in real-time*.

(See [Dashboards are for Driving](http://www.codeproject.com/KB/architecture/DashboardsAreForDriving.aspx) for more blather about this sub-topic. Caveat: I am the author of the blathering article.)

So, the question back to you is: are you trying to evaluate performance *after the fact*, when it is *too late to do anything about it*, or are you trying to find KPIs that can help you *stay on course*?

If the former, any metric your organization cares about (bug count, ship-date slippage, lines of code with comments, customer return percentages, etc.) will be fine. Measure away and good luck getting any better in between shipping products and upgrades ;-)

If the latter, choose [velocity](http://extremeprogramming.org/rules/velocity.html). Assuming you are using test-driven development (TDD) of course.

EDIT: so it's the former. Well, here's why you are probably out of luck:

Suppose that you decide that "quality" is best quantified by measuring the number of bugs reported by customers as your post-process KPI. Let's assume that you are using TDD, and say that your team delivers Product #1 in 6 months, and after 6 months in the field you find that you have 10 customer-reported bugs. So now what, exactly, are you going to do to improve your process? Test more? Test specifically for more things like the causes of the bugs that were reported? It seems to me that you would already be testing, and when bugs are discovered - whether by the customer or not - you add a regression test for the specific bug and additional unit tests to make sure that there are no more similar bugs. In other words, *your post-process improvement response will be no different than your in-process improvement response*, so this KPI is really of no significant help in improving your process. The point is that the way you improve your process remains the same regardless of whether the bugs are discovered 6 months after release or two days into coding. So while this might be a shiny KPI to put on a manager's wall or a departmental newsletter, it really will not change your process-improvement mechanisms. (And beware of putting too much stock in this KPI because it can be wildly influenced by factors beyond your control!). In short, *knowing the number of bugs does not help you improve*.

(There is another danger here, one commonly found not just in business but also in the military, and that is the illusion that the post-mortem analysis revealed valuable information, so the lessons learned post-mortem are vigorously applied to the next project, *which is probably not the same as the last project*. This is known as "fighting the last war".)

Suppose the number of customer returns/refunds is your KPI of choice for "quality" - if this number is 5, what does this tell you? The specific reasons why customers requested a refund may be some indication of quality problems ("too slow", "doesn't interface with XYZ system", etc.), but the mere *number* of such incidents tell you nothing. A variance against an expected return percentage might tell you if quality was improving, but again *the number does not help you improve*. You need more information than the number can give you.

So for "timeliness of releases" what measurement would be appropriate? Number of days of ship-date slippage? Percent overrun based on original estimates? *It doesn't matter*, because again *the numbers do not help you improve*.

If you can measure "productivity" after the product is done then you can probably measure it while the product is being developed (e.g. velocity), the difference is that productivity less than expected during development can be improved immediately, while an overall productivity number measured after development is completed is too gross, too averaged, to be of any use. One could only guess at why it was lower than expected 6 months later...

I have no idea how one might measure "flexibility", that sounds like marketing jargon ;-)

I hope I haven't pounded this nail too hard or too far, but I don't think that there is anything *useful* that you can measure after-the-fact that you cannot measure *while in progress*. And there are a lot of after-the-fact measurements that are useless without knowing the causes.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-07T15:55:59.200

You can get lot of ideas about KPIs and Examples of [Dashboards](http://www.dashboardzone.com) at [http://www.dashboardzone.com](http://www.dashboardzone.com)

It has kpis by industry and functional areas.

# asp.net-mvc - 使用 ASP.NET MVC 将 Json 返回到 jQuery

> ID：385219
> 
> 赞同：0
> 
> 时间：2008-12-21T23:57:37.423
> 
> 标签：asp.net-mvc, json

我有这个代码..

```
 Models.Person p = new testmvc.Models.Person { Firstname = "yongeks", Lastname = "ucab" };

        Models.Person p2 = new testmvc.Models.Person { Firstname = "lyn", Lastname = "torreon" };

        string q = JavaScriptConvert.SerializeObject(new String[] { JavaScriptConvert.SerializeObject(p), JavaScriptConvert.SerializeObject(p2) });

        Console.WriteLine(q);

        return q; 
```

我需要将此代码解析为jquery ..使用json请求..有人可以帮助我..

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-22T00:14:21.413

只需使用控制器的 Json 方法将类型序列化并返回一个 JsonResult：

```
Models.Person p2 = new testmvc.Models.Person { Firstname = "lyn", Lastname = "torreon" };
return Json( p2 ); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-22T13:32:31.367

我喜欢使用[Newtonsoft](http://james.newtonking.com/projects/json-net.aspx) json 库。它允许您更好地控制 json 序列化过程，因此您可以指定如何处理空值等

例如

```
 JsonNetResult jsonNetResult = new JsonNetResult();
  jsonNetResult.Formatting = Newtonsoft.Json.Formatting.Indented;
  jsonNetResult.SerializerSettings.NullValueHandling = Newtonsoft.Json.NullValueHandling.Ignore;
  jsonNetResult.Data = nodes
  return jsonNetResult; 
```

# javascript - Windows 小工具和 Jquery

> ID：385220
> 
> 赞同：9
> 
> 时间：2008-12-21T23:57:50.043
> 
> 标签：javascript, jquery, windows-desktop-gadgets

我正在创建一个 Vista 小工具，但我无法让 JQuery 工作。我尝试了一些非常简单的调用，例如：

```
$(function() {
      $('a').click(function() {
          $('#box').html("test");
      });
}); 
```

我知道你可以使用 JavaScript，所以你不能使用库对我来说没有多大意义。

有谁知道有没有例子？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-22T00:52:49.323

[这](http://arsecandle.org/twadget/)是一个用 jquery 完成的 vista 小部件。可能会帮助你。

上面的链接已失效 - 这是另一个[https://code.google.com/archive/p/timetablegadget/source/default/source](https://code.google.com/archive/p/timetablegadget/source/default/source)

# unix - 当我在 UNIX 提示符下运行“我是谁”时，“tty”和“ttys”代表什么？

> ID：385237
> 
> 赞同：2
> 
> 时间：2008-12-22T00:18:58.720
> 
> 标签：unix

我知道这是一个简单的问题，我只是好奇。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T00:22:49.057

[电传打字机](http://en.wikipedia.org/wiki/Teletype)。

当 Unix 刚被开发出来时，计算机的内置显示器相当罕见。I/O 是通过向另一个设备发送字符来完成的。电传打字机是这些设备中最古老和最成熟的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T00:23:43.640

TeleTYPE（S 是“串行”）。

提示：谷歌很有用。

# c# - 跨方法使用对象

> ID：385238
> 
> 赞同：1
> 
> 时间：2008-12-22T00:20:01.573
> 
> 标签：c#, methods, oop

> 再次编辑：我想我现在明白了。那么我需要做的就是使用我希望能够访问的类的当前类冒号？人：学生，或人：老师，对吗？

我目前正在尝试学习面向对象编程的来龙去脉。目前我有一个新对象，如下所示：

```
class student
{
    int grade; //0 - 100 as opposed to the characters A, B, C, etc.
    string teacher; //For the teacher of the class the student is in.

}

class teacher
{ 
    int courseAverage;
    string name; 
    //teacher.name would correspond to the teacher in the student class.
}

class Program
{
    student Jim;
    Jim = new student();
    teacher John;
    John = new teacher();
}

static void grades()
{
    Jim.grade = 100;
}

static void teacher()
{
    Jim.teacher = "John Smith";
}

static void average()
{
    int average; //For the sake of simplicity I'll leave the average at an int.
    average = (Jim.grade + Sue.grade + Sally.grade + Robert.grade) / 4;
    /*A loop would be set before the average variable to 
    ensure that only students of John would be counted in this.*/

}

static void teacheraverage()
{
    John.courseAverage = average;//from the average method.
} 
```

> 编辑：
> 
> 我想做的是修改另一个类的信息。但是，我想在程序类中以一种方法修改来自 Jim 学生的信息。一种计算具有给定教师的学生的平均成绩的方法。
> 
> 此外，我在这些中使用静态的唯一原因是因为这是我设法跨方法访问变量的唯一方法。我尝试使用静态方法跨类使用方法，但没有成功。还有另一种方法可以做到这一点吗？

我想以多种方法使用 Jim 学生。一个决定吉姆的成绩，另一个决定老师。在这种情况下，我想使用不同的方法，以便我可以了解它是如何完成的。

好吧，看来我的理解不正确。我将尝试类方法中的方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T00:34:07.193

由于您使用的是 C#，并且假设您使用的是 .NET 3.5，您的类可能看起来像这样：

```
public class Student
{
    public int Grade { get; set; }
    public string Teacher { get; set; }
} 
```

Grade 和 Teacher 是自动属性，大致相当于 Java 中的 getter 和 setter，即方法。C# 中的属性本质上是获取和设置类的本地成员的快捷方式。

您对上述类的使用如下所示：

```
public class Program
{
    // creates a new Student object with the properties Grade and Teacher set.
    Student s = new Student() { Grade = 100, Teacher = "John Smith" }

    Console.Write(s.Grade); // outputs 100
    Console.Write(s.Teacher); // outputs John Smith
} 
```

这是你要找的吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-22T00:28:54.317

好吧，至少三种方式。

1.  制作Student类的成绩和教师方法：

* * *

```
public class Student
{
    int grade; //0 - 100 as opposed to the characters A, B, C, etc.
    string teacher; //For the teacher of the class the student is in.

    public void SetGrades()
    {
        grade = 100;
    }

    public void SetTeacher()
    {
        teacher = "John Smith";
    }
}

class Program
{
    public static void Main()
    {
        Student Jim;
        Jim = new Student();
        Jim.SetTeacher();
        Jim.SetGrades();
    }
} 
```

或 2\. 将学生传递给方法：

* * *

```
class Program
{
    public static void Main()
    {
        Student Jim;
        Jim = new Student();
        grades(Jim);
        teacher(Jim);
    }

    static void grades(Student student)
    {
        student.grade = 100;
    }

    static void teacher(Student student)
    {
        student.teacher = "John Smith";
    }
} 
```

或 3\. 在 Program 类中使用 Jim 作为变量，因此您实际上不必将它传递给任何东西

* * *

```
class Program
{
    static Student Jim;

    public static void Main()
    {
        Jim = new Student();
        grades();
        teacher();
    }

    static void grades()
    {
        Jim.grade = 100;
    }

    static void teacher()
    {
        Jim.teacher = "John Smith";
    }
} 
```

* * *

请注意，在所有示例中，我让 Student 类的名称中包含一个大写的 S，以将其与参数和您可能拥有的任何局部变量区分开来。

了解这些差异很重要。

在第一个解决方案中，您要求对象本身设置成绩和教师。如果这些是你经常做的操作，它们可能属于类本身，而不是外部的操作。

在第二个解决方案中，您绕过学生。这使您可以轻松地与多个学生一起工作，因为代码没有硬连线以与单个对象一起工作。

在第三种解决方案中，您不必传递任何内容，但您的代码现在被锁定为一次只能与一个学生一起工作，在 Jim 字段中。

就我个人而言，我会制定第一个解决方案的变体，只是在设置什么等级和哪个老师方面更加灵活。可能使用属性（您还应该更多地研究。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T02:02:17.610

[lassevk](https://stackoverflow.com/questions/385238/using-objects-across-methods#385247)很好地*回答*了您的问题 - 基本上，您如何通过多种方法访问名为 Jim 的 Student 实例。

不过，我想指出的是，您正在这里编写程序代码。并不是说这一定有什么问题——只是你在这里并没有真正“得到”OO。

一个 2 分钟的 OO 方式的快速示例：

```
class Student {
   public string Name { get; private set; }

   public Student(string name) {
      if (string.IsNullOrEmpty(name)) throw new ArgumentException();
      this.Name = name;
   }
}

class Teacher {
   public string Name { get; private set; }

   public List<Course> Courses { get; private set; }

   public Grade GetAverageCourseGrade() {
       int totalCourseGrade;
       foreach (Course course in this.Courses) {
          totalCourseGrade += course.GetAverageGrade().Value;
       }
       return new Grade(totalCourseGrade / this.Courses.Count);
   }

   public Teacher(string name) {
       if (string.IsNullOrEmpty(name)) throw new ArgumentException();
       this.Name = name;
       this.Courses = new List<Course>();
   }
}

class Course {
   public string Name { get; private set; }

   public IEnumerable<Student, Grade> StudentGrades { get; private set; }

   public Grade GetAverageGrade() {
      int totalGrade;
      // could use LINQ, but I'll make it slightly more explicit
      foreach (KeyValuePair<Student, Grade> studentGrade in this.StudentGrades) {
         Grade grade = kvp.Value;
         totalGrade += grade.Value;
      }
      return new Grade(totalGrade / this.StudentGrades.Count());
   }

   public Course(string name) {
       if (string.IsNullOrEmpty(name)) throw new ArgumentException();
       this.Name = name;
       this.StudentGrades = new Dictionary<Student, Grade>();
   }
}

class Grade {
   public int Value { get; private set; }

   public char Letter { 
       get {
          switch (this.Value / 10) {
             case 10: case 9:
               return 'A';
             case 8:
               return 'B';
             case 7:
               return 'C';
             case 6:
               return 'D';
             default:
               return 'F';
          }
       }
   }

   public Grade(int value) {
      if (value < 0 || value > 100) throw new ArgumentOutOfRangeException();
      this.Value = value;
   }
}

class Program {
   static int Main(string[] args) {
      Teacher john = new Teacher("John Smith");

      Course cs101 = new Course("Computer Science 101");
      john.Courses.Add(cs101);

      Student mark = new Student("Mark Brackett");
      Student xesaniel = new Student("Xesaniel");

      cs101.Students.Add(mark, new Grade(90));
      cs101.Students.Add(xesaniel, new Grade(95));

      Console.WriteLine(john.GetAverageCourseGrade());
   }
} 
```

那里有很多仪式和噪音，但重要的是教师和课程知道如何计算自己的平均成绩并验证/执行自己的内部状态。Main 方法实际上只负责协调设置和类之间的任何交互。

从技术上讲，这里的很多关系都是双向的——例如，一个老师有很多课程，而一个课程只有一个老师。但是，双向关系可以是一个 PITA 来管理 - 这里没有令人信服的理由。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T20:27:58.797

您仍然错过了关键点：一个*类*将数据*与其方法相关联。* 因此，设置 Jim 的老师的方法是 Student 类的一部分，设置 Jim 的成绩的方法也是如此。

首先用自然语言来思考它。“Jim 是一名学生；学生有姓名、学生证号和班级。班级有教师和教室。学生在学期末收到每个班级的成绩。”

所以我们有一个班级学生。学生，当您从它创建一个对象时，需要学生姓名和学生 ID，因此“构造函数”需要具有名称字符串和学生 ID（也称为字符串）来初始化它。我不懂C#，所以我会用大括号制作一个伪代码......

```
class Student {
    String name;
    String studentID;
    Course crsList = List<Course>; // "list of courses."
    Student(String name, String studentID ){
        // Make a new student, the "constructor"
        this.name = name;
        this.studentID = studentID;
    }
    addCourse(Course c){
        // Add a course to the student's list
        this.crsList.append(c); // Adds c to end of crsList
    }
} 
```

这表示“学生有姓名和 ID，我们可以将课程添加到他们的课程集合中。”

```
class Teacher {
    String name;
    Course crsList = List<Course>;
    Teacher(String name){
        this.name = name;
    }
    // ... more methods here.
} 
```

但是我们观察到老师和学生都是这样的人，所以我们“重构”了这个把共同的部分放在一起

```
class Person {
    String name;
    Person(String name){
        this.name = name;
    }
    // ... more methods
} 
```

现在我们改变老师和学生，所以我们说

```
class Student : Person {
    String studentID;
    Student(String name, String studentID){
        // Now we need to initialize the Person part
        super(name);
        // and the special Student part
        this.studentID = studentID;
    }
} 
```

现在说“学生是一种具有额外学生 ID 的人，我们可以向其添加课程。”

您将继续为 Teach 定义“addClass”，*但作为 Teacher 类的一部分*。为什么？因为为教师添加课程与为学生添加课程意味着不同。您将向学生添加一个方法，该方法接受课程和成绩，找到课程并以某种方式分配他的成绩。（小测验：成绩是课程的一部分还是学生的一部分？）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T00:37:07.250

好吧，这里有一个基本的误解。 *您的方法与类相关联。* 您所拥有的基本上是带有一些使用它们的功能的结构；没错，但根本不是 OO。

你真正想要的是这样的（希望是好的说明性伪代码）：

```
class Person
  name : String
  Person(namearg: String) -- your constructor
    name = namearg;
  end
end

class Student :: Person -- read :: as "is a kind of"
  Student(namearg : String)
    super(namearg) -- calls the Person ctor
  end
  -- more stuff will go in here
end
-- Teacher looks much the same

class Course
  courseName : String
  teacher : Teacher
  students : list of Student
  Course(namearg : string)
    courseName = namearg 
  end
  addStudent(s : student)
    students.append(s) -- add student to the end of the list
  end
  -- and so on.
end 
```

关键是一个类知道关于它所描述的事物的一切：它使用的数据和可以执行的操作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T02:04:35.467

您的模型过于简单且未指定。但是让我们暂时忽略它;-)

在下面的示例中，我也忽略了属性的细节并存根构造函数，以免混淆主要的建模问题

学生和老师都是人（正如查理马丁和其他人指出的那样）

```
//people have names
public class Person
{
    public Person(string _name)
    {
        Name = _name;
    }
    public string Name;
} 
```

学生是一个人，有一个年级和一个老师

```
//students are people with a grade and a teacher
public class Student : Person
{
    public Student(string _name, int _grade, 
        Teacher _teacher) : base(_name)
    {
        Grade = _grade;
        Teacher = _teacher;
        Teacher.Students.Add(this);  //add to the teacher's collection
    }
    public int Grade;
    public Teacher Teacher;
} 
```

教师是人，具有课程平均成绩和一组学生。

```
public class Teacher : Person
{
    public Teacher(string _name) : base(_name)
    {
    }
    public int CourseAverage;
    public IList<Student> Students = new List<Student>();
    public void ComputeAverageGrade()
    {
        int sum = 0;
        foreach(Student s in Students)
        {
            sum += s.Grade;
        }
        CourseAverage = sum / Students.Count;
    }
} 
```

在您的示例中，您有一些学生并计算平均成绩

```
public class Program
{
    public static void Main(string [] args)
    {
        Teacher JohnSmith = new Teacher("John Smith");

        Student Jim = new Student("Jim",100,JohnSmith);
        Student Sue = new Student("Sue",90,JohnSmith);
        Student Sally = new Student("Sally",70,JohnSmith);
        Student Robert = new Student("Robert",100,JohnSmith);

        //add our resident overachiever
        Student JonSkeet = new Student("Jon Skeet",150,JohnSmith);

        JohnSmith.ComputeAverageGrade();

        Console.WriteLine("Course Average for " + JohnSmith.Name + " is " +
            JohnSmith.CourseAverage.ToString());
    }
} 
```

在更现实的模型中，每个学生可能会学习不止一门课程，而每位教师可能会教不止一门课程，因此您需要对课程进行建模。课程仅在一个学期或一个季度等期间存在。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-22T02:06:01.470

尝试将类视为制造机器的蓝图。对象是一台机器。当你使用它时，你并不关心它在内部是如何工作的。您只需使用外部的各种控制杆和开关来控制它，以及告诉您答案的 LED 等等。这对你来说是一个“黑匣子”。

杠杆和开关是方法和属性。它们公开了用于与对象交互的“用户界面”。

方法内的代码是内部的。它的工作原理是一个*秘密*。这使对象更易于使用（如果设计得当）。最终存储信息的字段也是秘密。它们不能被类方法之外的代码直接访问。

```
public class Student
{
    // Notice how these details are private
    private List<Subjects> _subjects = new List<Subjects>();
    private DateTime _started;

    // A property that only has a 'getter' because the value shouldn't be modified
    public DateTime Started
    {
        get { return _started; }
    }

    // Methods carry out actions. This one calls on to a method in another object.
    public void Enroll(Subject s)
    {
        if (_subjects.Contains(s))
            throw new Exception("Already studying that course");

        s.RegisterStudent(this);
        _subjects.Add(s); 
    }

    public void Flunk(Subject s)
    {
        if (!_subjects.Contains(s))
            throw new Exception("Can't flunk that subject, not studying it");

        s.RemoveStudent(this);
        _subjects.Remove(s);
    }
} 
```

如果您遵循这种方法，那么您将走上面向对象的道路。你还有很多有趣的东西要学——异常安全、滥用继承、松耦合……

# unix - 当我在命令提示符下键入 $SHELL 命令时，除了输出 shell 之外，它还有什么作用？

> ID：385253
> 
> 赞同：2
> 
> 时间：2008-12-22T00:32:30.147
> 
> 标签：unix

我知道这应该输出我正在使用的 shell 类型，我认为它确实如此，因为它输出“bash-3.2”，但它并没有完全做到这一点，因为它实际上将我的提示更改为“bash- 3.2 美元”。还有什么事情？当我执行 Ctrl+D 时，我会回到原来的提示。这是启动 bash shell 吗？我想通过打开一个终端窗口（我在 Mac OS X 中），我正在打开一个 shell 程序。

我尝试用 Google 搜索，但我无法为 $SHELL 获得任何好的结果。顺便说一句，我如何让 Google 在我的搜索中包含“$”？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-22T00:43:32.430

是的，当您打开终端窗口时，您正在启动一个 shell。

shell 程序的名称存储在`$SHELL`变量中。在命令行中简单地运行“ `$SHELL`”会使用该变量中的值，然后将其解释为一个命令——它运行一个新的 shell。当您退出该外壳时，您将返回到它离开的外壳。

有点像当你在办公桌前做某事时，你的老板给你丢了一些新工作，所以你在做这件新事情的时候暂停原来的工作，然后你可以从中断的地方继续工作。重新完成新任务。:-)

这个新的 shell 不是登录 shell，所以它使用默认提示而不是 shell 登录配置文件中指定的提示。

`$SHELL`当您需要从另一个程序中运行命令时很有用。例如，如果您在文本编辑器中并且想要插入 shell 命令的输出，则编辑器通过您的`$SHELL`环境变量知道要运行哪个 shell 程序。

* * *

Rob Kennedy 评论了这个`$SHLVL`变量。这表明您在贝壳中的“深度”。例如，当您登录时，“ `echo $SHLVL`”会打印 1。如果您打开一个新的 shell，同样的命令会打印 2。退出该子 shell 并返回您的登录 shell 后，该命令会再次打印 1。这有点超出你的要求，它的用途更深奥，但它有点有趣。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-22T00:41:28.490

所有 $SHELL 都是包含 shell 名称的宏或 shell 变量。所以当你输入

```
$ $SHELL 
```

该行立即扩展到

```
$ bash-3.2 
```

在您的系统上是 bash 可执行文件的名称。所以它运行可执行文件。

如果您只想查看变量中的内容，请键入

```
$ echo $SHELL 
```

它只是将参数复制到标准输出。

您也可以创建自己的变量，例如，

```
$ FRED="My name is Fred" 
```

之后

```
$ echo $FRED 
```

将打印

```
$ echo FRED
My name is Fred. 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-04-05T09:07:24.420

其他答案已正确指出这`SHELL`是一个包含*shell 程序*名称的变量——但他们没有指定它指的是哪个 shell。答案之一犯了一个常见的误解，即`SHELL`变量表示当前正在使用的外壳。不是这种情况。

它实际上是系统登录进程为用户设置的**默认登录shell**的环境变量。在 Unix 系统中，这通常配置在`/etc/passwd`- 除非使用 NIS、LDAP、Active Directory 或其他一些身份验证机制。

[来自环境变量](http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap08.html#tag_08_03)的 POSIX 2008 部分

> 贝壳
> 
> 该变量应代表用户首选的命令语言解释器的路径名。

来自 Bash 手册中关于[Bash 变量的部分](https://www.gnu.org/software/bash/manual/html_node/Bash-Variables.html#Bash-Variables)

> 贝壳
> 
> shell 的完整路径名保存在此环境变量中。如果在 shell 启动时未设置，Bash 会为其分配当前用户登录 shell 的完整路径名。

### 典型用途

它被使用

*   具有 shell 转义功能的程序允许从程序内部运行 shell 命令，例如，文本编辑器，如 Vim。

*   GNU Screen 来确定在打开新窗口时应该将哪个 shell 作为默认 shell 运行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T00:43:50.870

$SHELL 本身不是命令；它是一个变量，存储您当前正在运行的 shell 的名称

`echo $SHELL`在命令提示符下尝试

你会得到这样的东西

```
/bin/bash 
```

所以当你打字时你真正在做什么

> $壳牌

是

> /bin/bash

这就是为什么你得到一个新的外壳

# ajax - 新 Web 应用程序的最佳工具包（奇怪的要求）

> ID：385254
> 
> 赞同：2
> 
> 时间：2008-12-22T00:33:00.067
> 
> 标签：ajax, web-applications

我需要编写一个新的应用程序，并且没有任何新技术、框架或语言的经验。以下是要求：

*   HTML 前端（最好是跨浏览器友好的）
*   Web 可部署，但理想情况下还希望能够在桌面上独立安装
*   SQL Server 数据库
*   理想情况下，希望使用带有小部件的良好（且简单）AJAX 工具包
*   理想情况下，希望能够用 ASP.Net 编写，但以后（或同时）也可以用 Java 编写。这是一个大问题，因为我不想重写整个事情。有没有我可以使用的工具包让这个跨平台需求变得更容易？

非常感谢所有建议和意见。谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T03:46:38.897

我建议查看 Adob​​e Flex/AIR。Flex 被部署为 Flash 应用程序，并且在所有浏览器中看起来都一样，AIR 采用它并添加了桌面集成和部署功能以及离线支持和本地 SQLite 数据库。您还可以使用 HTML + Javascript 编写 AIR 应用程序（作为 Web 应用程序运行），但仍然可以访问所有桌面功能，就像它被部署为 AIR 应用程序一样。后端也可以是 .NET WebServices。

下面是作为 AIR 客户端应用程序运行的 AJAX 应用程序的[示例。](http://jackslocum.com/blog/2008/02/14/air-docs/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T00:39:12.813

ASP.NET。如果您想要一个独立的应用程序，请通过 Web 服务（或类似服务）公开您的所有业务逻辑，并拥有一个单独的前端应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T01:03:26.150

这些要求是一项艰巨的任务。我想我们都喜欢一个允许我们开发具有所有这些功能的跨浏览器、多平台应用程序的单一系统。如果您包含应用程序的一般功能，将会有所帮助。您选择平台的方向很大程度上取决于需求，其中不仅包括功能，还包括性能、持续开发、支持成本和其他因素。

我同意 moobaa 的观点，即跨平台开发最好使用 SOA 架构来完成。将您的所有业务逻辑集中在 XML Web 服务中，并为您想要定位的平台开发前端。这可能会影响性能，但会限制您必须进行的并发开发量。有一些 C# 到 Java 的转换器，但我不能保证它们的有效性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T01:06:57.703

[ruby on rails](http://rubyonrails.org/)可以满足您的大部分要求，但是它不会直接为您提供桌面部署（除非您也可以使用基于浏览器的客户端）。

我应该补充一点，你需要学习 ruby​​，但这并不像听起来那么痛苦。花一点时间看一下网站和例子，你会明白的。

（即将推出的替代方案是 groovy 和 grails，它们向后兼容 java，对您来说学习曲线可能更少）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T01:19:13.873

您可以随时使用 ASP.NET 并在以后创建基于 Mono 的跨平台前端应用程序，并使用 Web 服务来允许应用程序使用后端中的逻辑。

所以：

**[ 网络 ]**

ASP.NET MVC（带有 .net 3.5 sp1 的 Windows）

用于 ASP.NET MVC 的 ASP.NET AJAX（带有 .net 3.5 sp1 的 Windows）

XHTML 和 CSS 2 实现跨浏览器兼容性

**[ 桌面 ]**

C#（与 Mono 的跨平台）

爪哇

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-04-12T23:11:09.207

Ruby on Rails。它不仅简单，而且还具有可访问后备的 AJAX。

# python - 如何在 HTTP 请求中发送带有 urllib2 的自定义标头？

> ID：385262
> 
> 赞同：67
> 
> 时间：2008-12-22T00:39:53.047
> 
> 标签：python, header, urllib2

使用 urllib2.urlopen(..) 时，我想在我的请求中发送一个自定义的“Accept”标头。我怎么做？

* * *

## 回答 #1

> 赞同：131
> 
> 时间：2008-12-22T02:29:01.813

不完全的。创建`Request`对象实际上并不发送请求，并且 Request 对象没有`Read()`方法。（另外：`read()`是小写的。）您需要做的就是将`Request`作为第一个参数传递给`urlopen()`它，这将给您您的响应。

```
import urllib2
request = urllib2.Request("http://www.google.com", headers={"Accept" : "text/html"})
contents = urllib2.urlopen(request).read() 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2015-08-15T15:51:41.410

我通常使用：

```
import urllib2

request_headers = {
"Accept-Language": "en-US,en;q=0.5",
"User-Agent": "Mozilla/5.0 (Windows NT 10.0; WOW64; rv:40.0) Gecko/20100101 Firefox/40.0",
"Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
"Referer": "http://thewebsite.com",
"Connection": "keep-alive" 
}

request = urllib2.Request("https://thewebsite.com", headers=request_headers)
response = urllib2.urlopen(request).read()
print(response) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-05-24T12:50:28.703

除了已经提到的其他解决方案之外，您还可以使用`add_header`方法。

所以提供的示例 py @pantsgolem 将是：

```
import urllib2
request = urllib2.Request("http://www.google.com")

request.add_header('Accept','text/html')

##Show the header having the key 'Accept'
request.get_header('Accept')

response = urllib2.urlopen(request)
response.read() 
```

# html - 确定不再需要哪些源文件的最佳方法是什么？

> ID：385266
> 
> 赞同：2
> 
> 时间：2008-12-22T00:44:57.093
> 
> 标签：html, ruby-on-rails, ruby, web-applications, maintenance

我现在负责一个 Rails 应用程序，该应用程序以非常快速和肮脏的方式构建。它有许多未使用的视图文件（html 模板）。它还有许多未使用的 css 文件。

确定不再需要哪些文件以便删除它们的最佳方法是什么？

我正在寻找一个通用的解决方案，而不是一个特定于 Rails 的解决方案，但是一个 Ruby/Rails-only 的解决方案肯定会受到欢迎。

只是为了让事情开始，我有一个（我不是特别喜欢）确定使用哪些视图的想法如下：

1.  编写一个脚本，将一行代码插入每个视图文件的顶部。这行代码会将视图的名称附加到某种日志中。
2.  递归地 wget 整个站点
3.  浏览日志并删除重复项 - 然后我们有一个使用的视图列表
4.  删除日志中未列出的视图

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-22T00:56:22.657

如果您使用的是类 Unix 系统：

确保带有页面的分区在启用访问时间 (atime) 的情况下挂载。在 linux 上，使用 relatime 或 noatime 挂载对您没有帮助。）

选择当前时间。

运行网络服务器几天。

识别 atime 早于先前选取的时间的文件。它们没有被使用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-22T12:53:40.087

与任何重构一样，从编写测试开始，一旦有了这些，您可以一次删除一个文件并在测试失败时撤消，或者使用[rcov](http://eigenclass.org/hiki/rcov)查看正在使用的文件。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-22T18:51:00.287

Krusty.ar 是正确的，也是最好的方法。

就个人而言，我会编写一些集成测试，从高层次检查所有功能。然后与 rcov 一起使用，你会得到一些非常可读的输出，它会告诉你哪些文件的使用率为 0%。

然后您可以开始删除，或开始编写单元/功能测试以提高安全性。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-22T00:58:30.593

您可以使用网络服务器日志来枚举为您的脚本提供的所有面向客户端的资源。

根据操作系统，还可以监视（使用过滤器）在执行页面时加载了哪些文件。在 Windows 上有[FileMon](http://technet.microsoft.com/en-us/sysinternals/bb896642.aspx)，对于 BSD/OSX 有[fs_usage](http://developer.apple.com/DOCUMENTATION/Darwin/Reference/ManPages/man1/fs_usage.1.html)，Linux 有 dnotify 和[inotify](http://manpages.unixforum.co.uk/man-pages/linux/suse-linux-10.1/7/inotify-man-page.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-25T10:14:05.493

你最好的选择是在测试中变得如此流利，以至于你可以 100% 依赖于你自己的测试。换句话说，如果您可以删除一个文件，并且测试仍然通过，您应该能够假设任何东西都不需要这个文件，因为您应该对应用程序中的所有内容进行测试。

# javascript - Asp.Net MVC 中的 JQuery UI 日期选择器

> ID：385269
> 
> 赞同：14
> 
> 时间：2008-12-22T00:48:26.417
> 
> 标签：javascript, jquery, html, asp.net-mvc, jquery-ui

我试图`JQuery UI`在一个`Asp.Net MVC`网站上使用一些小部件，但没有运气。

例如来自[jQuery UI 功能演示](http://ui.jquery.com/repository/tags/latest/demos/functional/#ui.datepicker)的基本日期选择器。

我创建了一个简单的 MVC 项目并添加了脚本引用，`Site.Master`如下所示：

```
<script src="../../Scripts/jquery-1.2.6.min.js" type="text/javascript"></script>
<script src="../../Scripts/jquery-ui-personalized-1.5.3.min.js" type="text/javascript"></script>
<link href="../../Content/Site.css" rel="stylesheet" type="text/css" />
<link href="../../Content/ui.datepicker.css" rel="stylesheet" type="text/css" />" 
```

在`Index.aspx`文件中，我清除了所有默认内容并添加了以下内容：

```
<script type="text/javascript">
    $("#basics").datepicker();     
</script>  
<input type="text" size="10" value="click here" id="basics"/> 
```

核心 jQuery 工作正常。有什么线索吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-22T01:04:32.937

确保在加载 DOM 后调用您的初始化程序：

```
$(document).ready(function() {
    $("#basics").datepicker();
}); 
```

[jQuery 就绪事件](http://docs.jquery.com/Events/ready#fn)：

> 通过使用此方法，您的绑定函数将在 DOM 准备好被读取和操作的那一刻被调用，也就是 99.99% 的 JavaScript 代码需要运行的时候。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-01-26T09:07:12.007

我在这里用 MVC 3 写了一篇文章：http: [//blogs.msdn.com/b/stuartleeks/archive/2011/01/25/asp-net-mvc-3-integrating-with-the -jquery-ui-date-picker-and-adding-a-jquery-validate-date-range-validator.aspx](http://blogs.msdn.com/b/stuartleeks/archive/2011/01/25/asp-net-mvc-3-integrating-with-the-jquery-ui-date-picker-and-adding-a-jquery-validate-date-range-validator.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-22T01:01:35.530

看起来您正在执行页面加载时的内联 JavaScript。在这种情况下，`#basics`选择器将无法定位输入，`id="basics"`因为它尚未被解析并呈现到文档正文中。

`script`您的解决方案可能就像将代码中的元素移动到元素之后的位置一样简单`input`。

更好的是，订阅文档就绪或文档加载事件并在该事件的处理程序中执行 jQuery 代码。

```
$(document).ready(function() {
    $("#basics").datepicker();
}); 
```

这样做有很多好处。您可以确定整个 DOM 已准备好使用，并且不依赖于源代码的顺序，这意味着您将来可以将 JavaScript 移动到外部文件以利用客户端的各种缓存机制.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-04-25T04:37:28.973

您在页面的哪个位置加载脚本以及在哪里调用 datepicker 初始化？

这是一个使用 jQuery 速记文档就绪和 css 选择器来更轻松地初始化 datePickers 的示例。

这是示例输入框的剃须刀代码（注意“datefield”css 类）

```
<div class="form-group">
    @Html.LabelFor(m => m.DateOfBirth, new { @class = "col-md-2 control-label" })
    <div class="col-md-10">
        @Html.TextBoxFor(m => m.DateOfBirth, new { @class = "form-control datefield" })
    </div>
</div> 
```

这是通过 css 选择器初始化任何日期选择器所需的 javascript

```
$(function () {
    $(".datefield").datepicker();
}); 
```

我在 github 上整理了一个详细说明细节的教程和一个示例 ASP.NET MVC5 解决方案

[http://prestoasp.net/using-the-jquery-datepicker-with-asp-net-mvc/](http://prestoasp.net/using-the-jquery-datepicker-with-asp-net-mvc/) [https://github.com/fredo007/i6technology/tree/master/InsuranceSales](https://github.com/fredo007/i6technology/tree/master/InsuranceSales)

# .net - 慢选择单节点

> ID：385272
> 
> 赞同：3
> 
> 时间：2008-12-22T00:53:44.080
> 
> 标签：.net, xml, performance, .net-3.5

我有一个简单的结构化 XML 文件，如下所示：

```
<ttest ID="ttest00001", NickName="map00001"/>
<ttest ID="ttest00002", NickName="map00002"/>
<ttest ID="ttest00003", NickName="map00003"/>
<ttest ID="ttest00004", NickName="map00004"/> 
```

..... 这个 xml 文件可以在 2.5MB 左右。

在我的源代码中，我将有一个循环来获取昵称

在每个循环中，我都有这样的事情：

```
nickNameLoopNum = MyXmlDoc.SelectSingleNode("//ttest[@ID=' + testloopNum + "']").Attributes["NickName"].Value 
```

这条单行将花费我 30 到 40 毫秒。

我搜索了一些旧文章（可追溯到 2002 年）说，使用某种编译的“xpath”可以帮助解决这种情况，但那是 5 年前的事了。我想知道有没有一种现代的做法可以让它更快？（我使用的是 .NET 3.5）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-22T15:45:59.897

**在 XPath 表达式中使用 " `//`" 缩写会导致效率低下**，因为它会导致搜索整个 XML 文档。`//`反复使用 ' ' 会使这种低效率倍增。

**该问题的一种有效解决方案**`NickName`是通过仅评估一个 XPath 表达式来获得所有 " " 属性节点：

   **`ttest/@NickName`**

其中上下文节点是所有“ `ttest`”元素的父节点。

**C# 代码**将如下所示：

```
 int n = 15;
    XmlDocument doc = new XmlDocument();
    doc.Load("MyFile.xml");

    XmlNodeList nodeList;
    XmlNode top = doc.DocumentElement;
    nodeList =
        top.SelectNodes("ttest/@NickName");

    // Get the N-th NickName, can be done in a loop for
    // all n in a range

    string nickName = nodeList[n].Value; 
```

这里我们假设“ttest”元素是 xml 文档顶部元素的子元素。

**总而言之**，提出了一种有效的解决方案，它只对 XPath 表达式求值一次，并将所有结果放在一个方便的 IEnumerable 对象（可用作数组）中，以便及时访问任何需要的项目`O(c)`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-22T01:32:27.917

您已经在使用 XPath（“//ttest...”），这是访问 doc 节点的最慢方式，因为“//”语法在整个 doc 中看起来。

尝试类似...

```
foreach (XMLNode node in MyXmlDoc.ChildNodes) {
    ...
} 
```

相反，不需要 xpath，它应该更快。（隐含假设它是一个没有嵌套的“平面”xml 文件。如果是这样，你很快就会递归我的小伙子）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-07T10:48:37.533

回答 Dimitre

实际上......选择整个节点比只选择属性要快。

我有一个单元测试对下面的代码进行基准测试，并且（令人惊讶地）选择完整节点并处理属性比选择属性并立即获取值更快。

将其放入 10000 次迭代循环并交换注释以测试每种方式。

```
 //XmlNodeList nodeList = document.SelectNodes("test/@NickName");
            XmlNodeList nodeList = document.SelectNodes("test");
            foreach (XmlNode node in nodeList)
            {
                //string nickName = node.Value;
                string nickName = ((XmlAttribute)node.Attributes.GetNamedItem("NickName")).Value;

            }
```

我知道违反直觉，但是....你必须衡量！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T01:06:52.493

在这种情况下，您可能需要考虑将 XML 文件中的昵称读入一个数组（如果您的测试 ID 真的只是顺序整数）或字典（如果不是），然后使用它来定位每个昵称，而不是尝试做一堆 XPath 查询。这样，您可能会在查找时获得更好的性能。

编辑：像这样的东西（伪代码）

```
var nicknames = new Dictionary<string, string>();

foreach (XmlNode node in MyXmlDoc.ChildNodes)
{
    if (node is XmlElement)
    {
        nicknames.Add(node.Attributes["ID"], node.Attributes["NickName"]);
    }
}

...

nickNameLoopNum = nicknames[testLoopNum]; 
```

# mysql - MYSQL - 无法连接到 'localhost' 上的 MYSQL 服务器 (10061)

> ID：385292
> 
> 赞同：9
> 
> 时间：2008-12-22T01:12:12.420
> 
> 标签：mysql, mysql-error-2003

我在我的 PC 上安装了 wamp 服务器（它没有 Internet 或 Intranet 连接，Windows XP -OS）。但是当我访问 MYSQL 这个错误弹出。你能告诉我如何解决这个错误吗？非常感谢您。

无法连接到 'localhost' 上的 MYSQL 服务器 (10061)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-22T03:07:38.570

从命令行（开始/运行/键入 cmd，按确定），键入：

```
telnet localhost 3306 
```

如果 MySQL 正在运行，您将看到 mysql 版本（和一些垃圾）。

要查看服务是否正在运行，请键入：

```
sc query mysql 
```

如果它正在运行，您会看到如下内容：

```
SERVICE_NAME: mysql
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 4  RUNNING
                                (STOPPABLE,PAUSABLE,ACCEPTS_SHUTDOWN)
        WIN32_EXIT_CODE    : 0  (0x0)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x0 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-22T02:56:03.677

要检查 MySQL 是否正在运行，如果它作为服务安装，您可以转到开始 -> 控制面板 -> 管理工具 -> 服务（我可能在这些路径上有点偏离，我是 OS X / Linux用户），然后在该列表中查找 MySQL。看看它是启动还是停止。

然后，如果您真的想要，您可以进行端口扫描并确定该端口是否打开。网上有各种各样的免费工具可以扫描你的 IP 并告诉你哪些端口是开放的，哪些端口正在监听它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T03:05:29.213

除非您在安装过程中做了什么，否则我相信该端口将是标准的，并且安装后该服务将不会运行。

MySQL 提供了几个用于管理服务器的 GUI 工具：[http://dev.mysql.com/downloads/gui-tools/5.0.html](http://dev.mysql.com/downloads/gui-tools/5.0.html) 其中一个工具是“MySQL System Tray Monitor”，它将检测正在运行的服务，并允许您轻松停止和启动服务器。您还可以查看“MySQL”的服务列表以查看该服务是否处于活动状态。

如果服务正在运行但您仍然无法连接，则需要确保 Windows 防火墙没有阻止对该端口的访问。如果您的防火墙未配置为在阻止程序时通知您（检查 Windows 防火墙控制面板，它可能没有通知您它已检测到该程序）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T01:14:03.167

确保它正在运行，检查 my.cnf 是否确实在侦听正确的 IP ( 127.0.0.1 )，并确保连接到正确的端口。

尝试使用telnet进行调试，看看问题出在哪里，可能mysql没有启动，或者监听不同的端口。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-12-19T11:48:22.097

尝试将 mysql 端口 3300 更改为“3306”

# c++ - 带有 int 参数的 C++ 重载运算符 <（与不保证为 int 的类型相比）

> ID：385298
> 
> 赞同：1
> 
> 时间：2008-12-22T01:14:27.860
> 
> 标签：c++, templates

我想重载运算符 < 和 > 以允许在 BST 中搜索 int 值（其设计目的不是存储整数而是单词）。

对于那些想知道为什么首先要完成此重载的人，请检查[C++ 我坚持用正确的值填充此 BST](https://stackoverflow.com/questions/384587/c-im-stuck-filling-this-bst-with-its-proper-values)

我需要两个搜索功能才能正确填写字典中的单词，然后定义其同义词/反义词。

这是搜索功能：

```
//--- Definition of findId()
template <typename DataType>
DataType& BST<DataType>::findId(const int id ) const
{
   typename BST<DataType>::BinNodePointer locptr = myRoot;

   typename BST<DataType>::BinNodePointer parent =0;

   bool found = false;
   while (!found && locptr != 0)
   {
      if (locptr->data > id)       // descend left
        locptr = locptr->left;

      else if (locptr->data < id)  // descend right       
        locptr = locptr->right;

      else                           // item found
        found = true;
   }
   return found ? locptr->data : NULL;
} 
```

到目前为止我的尝试..

```
template <typename DataType>
bool BST<DataType>::operator >(const int anotherId)const
{
     typename BST<DataType>::BinNodePointer locptr;
     //undefined pointer, what should I make it point at?         

     return (locptr->data > anotherId);

} 
```

整个模板：

```
#include <iostream>
#include <iomanip>
#include <stdlib.h>

#ifndef BINARY_SEARCH_TREE
#define BINARY_SEARCH_TREE

template <typename DataType>
class BST
{
 public:
  /***** Function Members *****/
  BST();

  bool empty() const;

  DataType& findId (const int id)const;

  bool operator >(const int anotherId)const;

  bool operator < (const int anotherId)const;

  bool search(const DataType & item) const;

  void insert(const DataType & item);

  void remove(const DataType & item);

  void inorder(std::ostream & out) const;

  void graph(std::ostream & out) const;

  private:
  /***** Node class *****/
  class BinNode 
  {
   public:
    DataType data;
    BinNode * left;
    BinNode * right;

    // BinNode constructors
    // Default -- data part is default DataType value; both links are null.
    BinNode()
    : left(0), right(0)
    {}

    // Explicit Value -- data part contains item; both links are null.
    BinNode(DataType item)
    : data(item), left(0), right(0)
    {}

}; //end inner class

typedef BinNode * BinNodePointer; 

  /***** Private Function Members *****/
  void search2(const DataType & item, bool & found,
               BinNodePointer & locptr, BinNodePointer & parent) const;
 /*------------------------------------------------------------------------
   Locate a node containing item and its parent.

   Precondition:  None.
   Postcondition: locptr points to node containing item or is null if 
       not found, and parent points to its parent.#include <iostream>
 ------------------------------------------------------------------------*/

  void inorderAux(std::ostream & out, 
                  BST<DataType>::BinNodePointer subtreePtr) const;
  /*------------------------------------------------------------------------
    Inorder traversal auxiliary function.

    Precondition:  ostream out is open; subtreePtr points to a subtree 
        of this BST.
    Postcondition: Subtree with root pointed to by subtreePtr has been
        output to out.
 ------------------------------------------------------------------------*/

  void graphAux(std::ostream & out, int indent,
                      BST<DataType>::BinNodePointer subtreeRoot) const;
  /*------------------------------------------------------------------------
    Graph auxiliary function.

    Precondition:  ostream out is open; subtreePtr points to a subtree 
        of this BST.
    Postcondition: Graphical representation of subtree with root pointed 
        to by subtreePtr has been output to out, indented indent spaces.
 ------------------------------------------------------------------------*/

 /***** Data Members *****/
  BinNodePointer myRoot; 

}; // end of class template declaration

//--- Definition of constructor
template <typename DataType>
inline BST<DataType>::BST()
: myRoot(0)
{}

//--- Definition of empty()
template <typename DataType>
inline bool BST<DataType>::empty() const
{ return myRoot == 0; }

//--- Definition of findId()
template <typename DataType>
DataType& BST<DataType>::findId(const int id ) const
{
   typename BST<DataType>::BinNodePointer locptr = myRoot;

   typename BST<DataType>::BinNodePointer parent =0;

   bool found = false;
   while (!found && locptr != 0)
   {
      if (locptr->data > id)       // descend left
        locptr = locptr->left;

      else if (locptr->data < id)  // descend right       
        locptr = locptr->right;

      else                           // item found
        found = true;
   }
   return found ? locptr->data : NULL;
}

template <typename DataType>
bool BST<DataType>::operator >(const int anotherId)const
{
     typename BST<DataType>::BinNodePointer locptr;

     return (locptr->data > anotherId);

} 

template <typename DataType>
bool BST<DataType>::operator < (const int anotherId)const
{
     typename BST<DataType>::BinNodePointer locptr;

     return (locptr->data < anotherId);

} 

//--- Definition of search()
template <typename DataType>
bool BST<DataType>::search(const DataType & item) const
{
   typename BST<DataType>::BinNodePointer locptr = myRoot;

   typename BST<DataType>::BinNodePointer parent =0;

/*   BST<DataType>::BinNodePointer locptr = myRoot;
   parent = 0; */ //falta el typename en la declaracion original

   bool found = false;
   while (!found && locptr != 0)
   {
      if (item < locptr->data)       // descend left
        locptr = locptr->left;
      else if (locptr->data < item)  // descend right
        locptr = locptr->right;
      else                           // item found
        found = true;
   }
   return found;
}

//--- Definition of insert()
template <typename DataType>
inline void BST<DataType>::insert(const DataType & item)
{
   typename BST<DataType>::BinNodePointer 
        locptr = myRoot,   // search pointer
        parent = 0;        // pointer to parent of current node
   bool found = false;     // indicates if item already in BST
   while (!found && locptr != 0)
   {
      parent = locptr;
      if (item < locptr->data)       // descend left
         locptr = locptr->left;
      else if (locptr->data < item)  // descend right
         locptr = locptr->right;
      else                           // item found
         found = true;
   }
   if (!found)
   {                                 // construct node containing item

      locptr = new typename BST<DataType>::BinNode(item);  
      if (parent == 0)               // empty tree
         myRoot = locptr;
      else if (item < parent->data )  // insert to left of parent
         parent->left = locptr;
      else                           // insert to right of parent
         parent->right = locptr;
   }
   else
      std::cout << "Item already in the tree\n";
}

//--- Definition of remove()
template <typename DataType>
void BST<DataType>::remove(const DataType & item)
{
   bool found;                      // signals if item is found
   typename BST<DataType>::BinNodePointer 
      x,                            // points to node to be deleted
      parent;                       //    "    " parent of x and xSucc
   search2(item, found, x, parent);

   if (!found)
   {
      std::cout << "Item not in the BST\n";
      return;
   }
   //else
   if (x->left != 0 && x->right != 0)
   {                                // node has 2 children
      // Find x's inorder successor and its parent
      typename BST<DataType>::BinNodePointer xSucc = x->right;
      parent = x;
      while (xSucc->left != 0)       // descend left
      {
         parent = xSucc;
         xSucc = xSucc->left;
      }

     // Move contents of xSucc to x and change x 
     // to point to successor, which will be removed.
     x->data = xSucc->data;
     x = xSucc;
   } // end if node has 2 children

   // Now proceed with case where node has 0 or 2 child
   typename BST<DataType>::BinNodePointer 
      subtree = x->left;             // pointer to a subtree of x
   if (subtree == 0)
      subtree = x->right;
   if (parent == 0)                  // root being removed
      myRoot = subtree;
   else if (parent->left == x)       // left child of parent
      parent->left = subtree; 
   else                              // right child of parent
      parent->right = subtree;
   delete x;
}

//--- Definition of inorder()
template <typename DataType>
inline void BST<DataType>::inorder(std::ostream & out) const
{ 
   inorderAux(out, myRoot); 
}

//--- Definition of graph()
template <typename DataType>
inline void BST<DataType>::graph(std::ostream & out) const
{ graphAux(out, 0, myRoot); }

//--- Definition of search2()
template <typename DataType>
void BST<DataType>::search2(const DataType & item, bool & found,
                            BST<DataType>::BinNodePointer & locptr, 
                            BST<DataType>::BinNodePointer & parent) const
{
   locptr = myRoot;
   parent = 0;
   found = false;
   while (!found && locptr != 0)
   {
      if (item < locptr->data)       // descend left
      {
         parent = locptr;
         locptr = locptr->left;
      }
      else if (locptr->data < item)  // descend right
      {
         parent = locptr;
         locptr = locptr->right;
      }
      else                           // item found
         found = true;
   }
}
//--- Definition of inorderAux()
template <typename DataType>
void BST<DataType>::inorderAux(std::ostream & out, 
                               BST<DataType>::BinNodePointer subtreeRoot) const
{
   if (subtreeRoot != 0)
   {
      inorderAux(out, subtreeRoot->left);    // L operation
      out << subtreeRoot->data << "  ";      // V operation
      inorderAux(out, subtreeRoot->right);   // R operation
   }
}

//--- Definition of graphAux()

template <typename DataType>
void BST<DataType>::graphAux(std::ostream & out, int indent, 
                             BST<DataType>::BinNodePointer subtreeRoot) const
{
  if (subtreeRoot != 0)
    {
      graphAux(out, indent + 8, subtreeRoot->right);
      out << std::setw(indent) << " " << subtreeRoot->data << std::endl;
      graphAux(out, indent + 8, subtreeRoot->left);
    }
}

#endif 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T02:43:14.563

在这种情况下，我不太确定为什么要重载 > 和 <，但也许我不太明白这个问题。看起来您打算拥有几种不同类型的树节点，所有这些都继承自`DataType`. 如果是这种情况，只需向`DataType`基类添加一个 const 成员函数：

```
class DataType
{
    private:
        mutable int internalID;
        // ...
    public:
        const int id() const { return internalID; }
        // ...
        virtual ~DataType();
};
```

现在，在您的`findID`循环中，您可以简单地使用：

```
 while (!found && locptr != 0)
{
    if (locptr->data.id() > id)
    {
        locptr = locptr->left;
    }
    else if (locptr->data.id() < id)
    {
        locptr = locptr->right;
    }
    else
    {
        found = true;
    }
} 
```

而且您不必经历运算符重载的所有不必要的麻烦。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T04:06:21.273

运算符重载在这里实际上没有意义。

成员函数

```
bool BST<DataType>::operator >(const int anotherId)const; 
```

基本上意味着将整棵树与一个 int 进行比较，这不是我认为你的目标。您可能希望确保为数据类型定义了 < ，然后还添加到节点类中，例如

```
template<typename type>
friend bool operator>(const BST<type>::node&, BST<type>::const node&); 
```

至少我的两分钱。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T01:29:12.700

我认为您需要阅读以下内容：http: [//www.devarticles.com/c/a/Cplusplus/Operator-Overloading-in-C-plus/](http://www.devarticles.com/c/a/Cplusplus/Operator-Overloading-in-C-plus/)

[http://www.java2s.com/Tutorial/Cpp/0200__Operator-Overloading/Catalog0200__Operator-Overloading.htm](http://www.java2s.com/Tutorial/Cpp/0200__Operator-Overloading/Catalog0200__Operator-Overloading.htm)

# asp.net - 如何进行自定义 asp.net 路由（对控制器进行硬编码）

> ID：385300
> 
> 赞同：0
> 
> 时间：2008-12-22T01:18:08.603
> 
> 标签：asp.net, asp.net-mvc, routing

我正在尝试为以下网址创建路线： www.mysite.com/user/username www.mysite.com/user/username/pictures

我尝试使用以下代码执行此操作：

```
routes.MapRoute(
            "UserProfile",
            "user/{sn}/{action}",
            new { controller = "User", action = "Index", sn = "" }
        ); 
```

因此，如果未指定操作，则转到索引操作。

但是，它不起作用，我不确定我做错了什么。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T07:22:14.483

看起来你的代码是正确的。

规则的顺序很重要。尝试将此置于所有其他规则之上。如果它会干扰其他规则，您应该为最佳匹配提供一些约束。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-18T19:07:49.617

我同意maxnk，代码看起来是正确的，它可能只是一个订购的东西。我建议查看 Phil Haack 写的 Route Debugger：http: [//haacked.com/archive/2008/03/13/url-routing-debugger.aspx](http://haacked.com/archive/2008/03/13/url-routing-debugger.aspx)。对于这些棘手的路由排序问题非常有用

# algorithm - 计算交叉点的高效数学算法

> ID：385305
> 
> 赞同：40
> 
> 时间：2008-12-22T01:20:50.033
> 
> 标签：algorithm, math, performance, intersection, lines

对于我正在开发的游戏，我需要一种可以计算交叉点的算法。我已经解决了这个问题，但是我这样做的方式真的很讨厌，我希望这里有人可能有一个更优雅的解决方案。

一对点表示在它们之间绘制的线的端点。给定两对点，绘制的线是否相交，如果相交，在什么点？

因此，例如调用 (Ax, Ay)-(Bx, By) 和 (Cx, Cy)-(Dx, Dy) 行

谁能想到解决方案？任何语言的解决方案都可以。

**编辑：**我应该更清楚一点，如果交点超出线段的长度，算法必须返回 false。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-12-22T09:42:12.157

已经在这里的大多数答案似乎都遵循以下一般思想：

1.  找到通过给定点的两条直线的交点。
2.  确定交点是否属于两条线段。

但是当不经常发生交叉时，更好的方法可能是反转这些步骤：

1.  *以y = ax + b*（通过 A、B 的线）和*y = cx + d*（通过 C、D的线）的形式表达直线
2.  查看 C 和 D 是否在*y = ax+b***的同一侧**
**   查看 A 和 B 是否在*y = cx+d***的同一侧****   如果上面的答案都是**no**，那么就有**一个**交集。否则没有交集。*   找到交叉点，如果有的话。**

 **注意：要执行第 2 步，只需检查 (Cy - a(Cx) - b) 和 (Dy - a(Dx) - b) 是否具有相同的符号。步骤 3 类似。第 5 步只是两个方程的标准数学运算。

此外，如果您需要将每个线段与 (n-1) 个其他线段进行比较，则为所有线预先计算步骤 1 可以节省您的时间。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-22T02:29:05.183

如果你有机会真的应该看看碰撞检测圣经，“实时碰撞检测”如果你打算做任何不平凡的事情。我不是专业的游戏程序员，我理解并可以轻松应用其中的概念。

[![在此处输入图像描述](https://i.stack.imgur.com/G71dG.jpg)](https://i.stack.imgur.com/G71dG.jpg)

[亚马逊 - 实时碰撞检测](https://rads.stackoverflow.com/amzn/click/com/1558607323)

基本上，无论如何做一组线交叉测试都是昂贵的。您所做的是在复杂的多边形上使用边界框（轴对齐或定向）之类的东西。这将允许您快速对每个“对象”之间的碰撞进行最坏情况 O(N^2) 检查。然后，您可以通过仅检查彼此靠近的对象的交叉点来使用空间树（二进制分区或四叉树）进一步加快速度。

这使您可以修剪许多许多碰撞测试。最好的优化是什么都不做。只有在边界框之间发生碰撞时，您才会进行昂贵的线交叉以确定对象是否真的相交。这使您可以在保持合理速度的同时增加对象的数量。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-12-22T01:45:40.403

```
float x12 = x1 - x2;
float x34 = x3 - x4;
float y12 = y1 - y2;
float y34 = y3 - y4;

float c = x12 * y34 - y12 * x34;

if (fabs(c) < 0.01)
{
  // No intersection
  return false;
}
else
{
  // Intersection
  float a = x1 * y2 - y1 * x2;
  float b = x3 * y4 - y3 * x4;

  float x = (a * x34 - b * x12) / c;
  float y = (a * y34 - b * y12) / c;

  return true;
} 
```

公式取自：
[线-线交点 - 维基百科](http://en.wikipedia.org/wiki/Line-line_intersection)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-22T01:30:05.740

```
public struct PointD
{
    public double X { get; set; }
    public double Y { get; set; }
}

/// <summary>
/// Find the intersection point between two lines.
/// </summary>
/// <param name="IntersectPoint">The intersection point. A <see cref="Esteem.Geometry.PointD">PointD</see> structure.</param>
/// <param name="L1StartPoint">The starting point of first line. A PointD structure.</param>
/// <param name="L1EndPoint">The end point of first line. A PointD structure.</param>
/// <param name="L2StartPoint">The starting point of second line. A PointD structure.</param>
/// <param name="L2EndPoint">The end point of second line. A PointD structure.</param>
/// <param name="L1IntersectPos">The intersection position at first line.</param>
/// <param name="L2IntersectPos">The intersection position at second line.</param>
/// <returns>Returns a boolean. True if there is intersection, false otherwise.</returns>
/// <remarks>The formula is taken from comp.graphics.algorithms Frequently Asked Questions.</remarks>
public static bool LineIntersect(out PointD IntersectPoint, PointD L1StartPoint, PointD L1EndPoint, PointD L2StartPoint, PointD L2EndPoint, out double L1IntersectPos, out double L2IntersectPos) 
{
    IntersectPoint = new PointD();
    double ay_cy, ax_cx, px, py;
    double dx_cx = L2EndPoint.X - L2StartPoint.X,
        dy_cy = L2EndPoint.Y - L2StartPoint.Y,
        bx_ax = L1EndPoint.X - L1StartPoint.X,
        by_ay = L1EndPoint.Y - L1StartPoint.Y;

    double de = (bx_ax) * (dy_cy) - (by_ay) * (dx_cx);
    //double tor = 1.0E-10;     //tolerance

    L1IntersectPos = 0;      L2IntersectPos = 0;
    if (Math.Abs(de)<0.01)
        return false;
    //if (de > -tor && de < tor) return false; //line is in parallel

    ax_cx = L1StartPoint.X - L2StartPoint.X;
    ay_cy = L1StartPoint.Y - L2StartPoint.Y;
    double r = ((ay_cy) * (dx_cx) - (ax_cx) * (dy_cy)) / de;
    double s = ((ay_cy) * (bx_ax) - (ax_cx) * (by_ay)) / de;
    px = L1StartPoint.X + r * (bx_ax);
    py = L1StartPoint.Y + r * (by_ay);

    IntersectPoint.X = px;  //return the intersection point
    IntersectPoint.Y = py;  //return the intersection position
    L1IntersectPos = r;      L2IntersectPos = s;

    return true; //indicate there is intersection
} 
```

要检查交点是否不超出线的原始长度，只需确保`0<r<1`和`0<s<1`

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-22T01:45:06.333

一个可以节省大量时间的简单优化是在进入交点计算之前检查线的轴对齐边界框。
如果边界框完全不相交，那么您可以确定没有交集。
当然，这取决于您拥有的数据。如果在您进行的每一次检查中都很有可能出现交叉点，那么您可能会发现自己在浪费时间进行始终正确的检查。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-22T09:09:55.840

[下面是我在MathWorld](http://mathworld.wolfram.com/Line-LineIntersection.html)中描述的线交点。对于一般碰撞检测/交叉点，您可能需要查看[分离轴定理](http://en.wikipedia.org/wiki/Separating_Axis_Theorem)。我发现这个关于 SAT 的[教程非常有用。](http://www.harveycartel.org/metanet/tutorials/tutorialA.html)

```
 /// <summary>
    /// Returns the intersection point of the given lines. 
    /// Returns Empty if the lines do not intersect.
    /// Source: http://mathworld.wolfram.com/Line-LineIntersection.html
    /// </summary>
    public static PointF LineIntersection(PointF v1, PointF v2, PointF v3, PointF v4)
    {
        float tolerance = 0.000001f;

        float a = Det2(v1.X - v2.X, v1.Y - v2.Y, v3.X - v4.X, v3.Y - v4.Y);
        if (Math.Abs(a) < float.Epsilon) return PointF.Empty; // Lines are parallel

        float d1 = Det2(v1.X, v1.Y, v2.X, v2.Y);
        float d2 = Det2(v3.X, v3.Y, v4.X, v4.Y);
        float x = Det2(d1, v1.X - v2.X, d2, v3.X - v4.X) / a;
        float y = Det2(d1, v1.Y - v2.Y, d2, v3.Y - v4.Y) / a;

        if (x < Math.Min(v1.X, v2.X) - tolerance || x > Math.Max(v1.X, v2.X) + tolerance) return PointF.Empty;
        if (y < Math.Min(v1.Y, v2.Y) - tolerance || y > Math.Max(v1.Y, v2.Y) + tolerance) return PointF.Empty;
        if (x < Math.Min(v3.X, v4.X) - tolerance || x > Math.Max(v3.X, v4.X) + tolerance) return PointF.Empty;
        if (y < Math.Min(v3.Y, v4.Y) - tolerance || y > Math.Max(v3.Y, v4.Y) + tolerance) return PointF.Empty;

        return new PointF(x, y);
    }

    /// <summary>
    /// Returns the determinant of the 2x2 matrix defined as
    /// <list>
    /// <item>| x1 x2 |</item>
    /// <item>| y1 y2 |</item>
    /// </list>
    /// </summary>
    public static float Det2(float x1, float x2, float y1, float y2)
    {
        return (x1 * y2 - y1 * x2);
    } 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-12-29T12:36:10.093

（我会将此作为评论，除非我还没有弄清楚如何这样做。）

我想补充一点，作为边界框测试的替代/补充，您还可以测试线的中点之间的距离是否大于线的组合长度的一半。如果是这样，这些线不可能相交。

想象每条线的最小封闭圆，然后测试圆相交。这允许预计算（至少对于静态线和保留其长度的线）和排除许多潜在交叉点的有效方法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-22T02:29:46.913

好吧，数学和标量产品可以提供帮助。
- 假设您要使线段 [AB] 和 [CD]
相交 - 假设线的交点是 M

当且仅当
Vector(AB) 时，M 在段 [ÅB] 内。向量(AM) >= 0
和
向量(AB) 。向量(MB) >= 0

点“。”在哪里 表示标量积： u 。v = ux * vx + uy * vy

所以，你的算法是： - 当且仅当下面的 4 eq 为真 Vector(AB)时
，找到 M
- M 在两个段内。
向量(AM) >= 0
向量(AB) 。向量(MB) >= 0
向量(CD) 。向量(CM) >= 0
向量(CD)。向量(MD) >= 0

希望这可以帮助

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-06-09T19:25:52.930

```
private function Loop(e:Event):void
{
    var x12:Number = Ball1.x - Ball2.x;
    var x34:Number = Ball3.x - Ball4.x;
    var y12:Number = Ball1.y - Ball2.y;
    var y34:Number = Ball3.y - Ball4.y;

    // Det
    var c:Number = x12 * y34 - y12 * x34;

    if (Math.abs(c) < 0.01)
    {
        Circle.visible = false;
    }
    else
    {
        var a:Number = Ball1.x * Ball2.y - Ball1.y * Ball2.x;
        var b:Number = Ball3.x * Ball4.y - Ball3.y * Ball4.x;
        var px:Number = (a * x34 - b * x12) / c;
        var py:Number = (a * y34 - b * y12) / c;

        var Btwn12x:Boolean = (px >= Math.min(Ball1.x, Ball2.x)) && (px <= Math.max(Ball1.x, Ball2.x));
        var Btwn12y:Boolean = (py >= Math.min(Ball1.y, Ball2.y)) && (py <= Math.max(Ball1.y, Ball2.y));
        var Btwn34x:Boolean = (px >= Math.min(Ball3.x, Ball4.x)) && (px <= Math.max(Ball3.x, Ball4.x));
        var Btwn34y:Boolean = (py >= Math.min(Ball3.y, Ball4.y)) && (py <= Math.max(Ball3.y, Ball4.y));

        var Btwn12:Boolean = Btwn12x && Btwn12y;
        var Btwn34:Boolean = Btwn34x && Btwn34y;

        if(Btwn12 && Btwn34)
        {
            Circle.visible = true;
            Circle.x = px;
            Circle.y = py;
        }
        else
        {
            Circle.visible = false;
        }
    }
} 
```

# php - 夏令时的PHP日期问题

> ID：385306
> 
> 赞同：0
> 
> 时间：2008-12-22T01:20:55.600
> 
> 标签：php, mysql, date, dst

我在一些 PHP 代码中出现了一个非常奇怪的错误。该页面正在管理课程中的学生注册。页面上是学生的课程表，每一行都有多个日期：他们注册的时间、完成的时间、通过评估的时间以及领取证书的时间。

表格数据由 PHP 生成（从 DB 中提取数据），Javascript 实际渲染表格。PHP 的输出是 JS 代码，看起来像这样：

```
var e = new Enrolment();
e.contactId = 5801;
e.enrolId = 14834;
e.courseId = 3;
e.dateEnrolled = new Date(1219672800000);
e.dateCompleted = new Date(-1000);  // magic value meaning they haven't completed.
e.resultDate = new Date(1223647200000);
e.certDate = new Date(1223560800000);
e.result = 95;
e.passed = true;
enrolments[14834] = e; 
```

在数据库中，所有日期字段都存储为`DATE`（不是`DATETIME`）字段。

错误是日期显示为休息一天。我怀疑这与服务器位于有夏令时的区域有很大关系，而这里没有（意味着服务器时间关闭一小时）。这解释了很多，尤其是数据准备和渲染是如何在两个不同的时区完成的。即：服务器告诉客户端此人在 8 月 15 日午夜完成，客户端将其解释为 14 日晚上 11 点，因此显示为 8 月 14 日。

但这是令人困惑的部分：它只对 resultDate 和 certDate 字段这样做！我已将数据复制到本地服务器，并发现生产服务器实际上只是为这两个字段发送了不同的时间戳（一个相差 1 小时），而 dateEnrolled 字段是相同的。

这是使用数据库中完全相同的代码和数据的输出：

```
// local server (timezone GMT+1000)
e.dateEnrolled = new Date(1219672800000);   // 26 Aug 2008 00:00 +10:00
e.dateCompleted = new Date(-1000);
e.resultDate = new Date(1223647200000);     // 11 Oct 2008 00:00 +10:00
e.certDate = new Date(1223560800000);       // 10 Oct 2008 00:00 +10:00

// production server (timezone GMT+1100)
e.dateEnrolled = new Date(1219672800000);   // 26 Aug 2008 00:00 +10:00
e.dateCompleted = new Date(-1000);
e.resultDate = new Date(1223643600000);     // 10 Oct 2008 23:00 +10:00 **
e.certDate = new Date(1223557200000);       // 09 Oct 2008 23:00 +10:00 ** 
```

我可以理解这是否是夏令时未考虑的问题，但请注意 dateEnrolled 是如何相同的？

将 MySQL 日期转换为 unix 时间戳的 PHP 代码如下：

```
list ($year, $month, $day) = explode ('-', $mysqlDT);
$timestamp = mktime (0,0,0, $month, $day, $year); 
```

关于如何解决这个问题的任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T03:05:01.850

那是因为您使用特定于语言环境的 mktime。也就是说，它将把它转换为从 00:00:00 1970-1-1 GMT 开始的秒数，并且在一个时区偏移 1 小时。

您还应该记住，javascript 确实使用与浏览器相同的时区，而不是网页。

```
e.resultDate = new Date(year, month - 1, day); 
```

这将确保每个时区的每个观众的日期都是相同的。

或者您可以使用 gmmktime 并在 Date 中使用 UTC 方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T01:33:44.390

好的，我刚刚弄清楚为什么它搞砸了一个约会，而不是另一个。夏时制在八月没有生效。*掌心*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T01:34:30.130

1.  始终以 GMT/UTC 存储日期/日期时间
2.  好好看看检索这些值的查询，正在调整的有什么不同吗？
3.  如果不是，它们都是时间戳还是日期或日期时间？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T01:39:41.680

这很可能是夏令时问题。它只为 resultDate 和 certDate 这样做的原因是 dateEnrolled 是在 8 月，夏令时通常在 9 月下旬或 10 月初开始/结束。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T02:29:45.773

使用 apache.conf、.htaccess 或 ini_set() 将 date.timezone ini 设置设置为应用程序的时区。

# python - 从浮动中删除尾随 '.0'

> ID：385325
> 
> 赞同：54
> 
> 时间：2008-12-22T01:33:33.547
> 
> 标签：python

我正在寻找一种将数字转换为字符串格式的方法，删除任何多余的 '.0'

输入数据是浮点数和字符串的混合。期望的输出：

0 --> '0'

0.0 --> '0'

0.1 --> '0.1'

1.0 --> '1'

我想出了以下生成器表达式，但我想知道是否有更快的方法：

```
(str(i).rstrip('.0') if i else '0' for i in lst) 
```

真值检查是为了防止 0 成为空字符串。

编辑：我现在或多或少可以接受的解决方案是：

```
('%d'%i if i == int(i) else '%s'%i for i in lst) 
```

在 python 中没有优雅的方法来处理这个（相当简单的）案例，这似乎很奇怪。

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2012-08-22T19:23:16.697

参见[PEP 3101](http://www.python.org/dev/peps/pep-3101/)：

```
'g' - 通用格式。这会将数字打印为定点
      数字，除非数字太大，在这种情况下
      它切换到“e”指数符号。

```

旧式（非首选）：

```
>>> "%g" % float(10)
'10' 
```

新风格：

```
>>> '{0:g}'.format(float(21))
'21' 
```

新风格3.6+：

```
>>> f'{float(21):g}'
'21' 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-22T02:18:07.560

`rstrip`不会做你想做的事，它会删除你给它的*任何*字符而不是后缀：

```
>>> '30000.0'.rstrip('.0')
'3' 
```

实际上，只是`'%g' % i` 会做你想做的事。编辑：正如罗伯特在他的评论中指出的那样，这不适用于大量数字，因为它使用 %g 的默认精度，即 6 个有效数字。

由于`str(i)`使用 12 位有效数字，我认为这将起作用：

```
>>> numbers = [ 0.0, 1.0, 0.1, 123456.7 ]
>>> ['%.12g' % n for n in numbers]
['1', '0', '0.1', '123456.7'] 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-30T10:16:19.773

```
>>> x = '1.0'
>>> int(float(x))
1
>>> x = 1
>>> int(float(x))
1 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-12-22T01:56:28.213

```
def floatstrip(x):
    if x == int(x):
        return str(int(x))
    else:
        return str(x) 
```

但请注意，在我的系统 0.10000000000000001 上，Python 将 0.1 表示为不精确的浮点数。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-12-22T02:25:58.373

```
(str(i)[-2:] == '.0' and str(i)[:-2] or str(i) for i in ...) 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2013-08-22T14:34:28.053

这么多丑陋……</p>

我个人最喜欢的是将`float`不需要是 a `float`（= 当它们实际上是整数时）的 s 转换为`int`，从而删除现在无用的尾随`0`

`(int(i) if i.is_integer() else i for i in lst)`

然后就可以正常打印了。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2013-06-06T03:24:24.337

`float`将具有整数值的a 打印为`int`：

```
format = "%d" if f.is_integer() else "%s"
print(format % f) 
```

[例子](http://ideone.com/eaUpLj)

```
 0.0 -> 0
             0.1 -> 0.1
            10.0 -> 10
      12345678.9 -> 12345678.9
     123456789.0 -> 123456789
12345678912345.0 -> 12345678912345
12345678912345.6 -> 1.23456789123e+13
  1.000000000001 -> 1.0 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-12-22T03:37:18.663

如果您只关心小数点后 1 位的精度（如您的示例中所示），您可以这样做：

```
("%.1f" % i).replace(".0", "") 
```

这会将数字转换为小数点后 1 位的字符串，如果为零，则将其删除：

```
>>> ("%.1f" % 0).replace(".0", "")
'0'
>>> ("%.1f" % 0.0).replace(".0", "")
'0'
>>> ("%.1f" % 0.1).replace(".0", "")
'0.1'
>>> ("%.1f" % 1.0).replace(".0", "")
'1'
>>> ("%.1f" % 3000.0).replace(".0", "")
'3000'
>>> ("%.1f" % 1.0000001).replace(".0", "")
'1' 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-22T01:59:23.980

```
from decimal import Decimal
'%g' % (Decimal(str(x))) 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-22T01:53:00.200

使用 Python 的[字符串格式化](http://docs.python.org/library/stdtypes.html#string-formatting)（在 Python 3.0 中使用[str.format() ）：](http://docs.python.org/library/stdtypes.html#str.format)

```
from decimal import Decimal

def format_number(i):
    return '%g' % (Decimal(str(i))) 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2017-06-27T12:23:33.413

以下代码将按原样转换变量 no 的内容，即`45.60`。如果你使用`str`输出将是`45.6`

```
no = 45.60

strNo = "%.2f" %no 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-10-24T03:23:32.873

```
str(x)[-2:] == '.0' and int(x) or x 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-22T02:21:37.243

```
>>> '%g' % 0
'0'
>>> '%g' % 0.0
'0'
>>> '%g' % 0.1
'0.1'
>>> '%g' % 1.0
'1' 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-11-05T16:43:59.620

FWIW，使用 Jinja2，其中 var = 10.3

`{{ var|round|int }}`将发出整数`10`

`round(method='floor')`并且`round(method='ceil')`也可用。

所以 var2 = 10.9 `{{ var|round(method='floor')|int }}`仍然会发出整数`10`

精度也可以使用函数的关键字参数来`precision=0`控制`round`。

参考：http: [//jinja.pocoo.org/docs/dev/templates/#round](http://jinja.pocoo.org/docs/dev/templates/#round)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-07-07T02:10:47.597

我正在处理来自 json 字典的值（由 API 返回）。以上所有内容都没有帮助我，所以我由自己的辅助函数构建。它截断所有尾随零。

我希望它可以帮助那里的人

```
def remove_zeros(num):
    nums = list(num)
    indexes = (list(reversed(range(len(nums)))))
    for i in indexes:
        if nums[i] == '0':
            del nums[-1]
        else:
            break
    return "".join(nums)

num = "0.000000363000"
print(remove_zeros(num)) 
```

印刷 ：

```
 0.000000363 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-12-22T02:23:35.427

如果需要，请使用 0 精度并添加一个句点。例如“%.0f.”

```
>>> print "%.0f."%1.0
1.
>>> 
```

# shell - vim 中的什么设置抵消了 smartindent 拒绝在 shell 脚本中缩进 # 注释？

> ID：385327
> 
> 赞同：27
> 
> 时间：2008-12-22T01:33:47.417
> 
> 标签：shell, vim, auto-indent

我最近开始使用 vim 7（以前是 vim 6）和`smartindent`设置。在大多数情况下，它运行良好，尽管我习惯于在左大括号后键入一个制表符，以至于它几乎适得其反。

然而，有一种疯狂的行为。编辑 shell 脚本时，我尝试在当前缩进级别创建注释，但`smartindent`与此无关。它坚持评论必须处于 0 级（无缩进）。更糟糕的是，它破坏了右移（' `>>`' 和朋友），因此它们不起作用。这是彻底的不服从，我想知道解决它的最佳方法是什么？

（我也不热衷于在之后`smartindent`缩进的想法。）`then``if`

首选解决方案将节省我手动抨击 - 我很懒惰。一种选择是“在编辑 shell 脚本时关闭`smartindent`（其余部分保持开启）”。另一种选择是关于如何找到控制脚本`smartindent`以及编辑什么以更改我不喜欢的特性的指南。最后一个选项（我不需要关于如何做的建议 - 只是暗示这是恢复理智的最佳或唯一方法）是不`smartindent`设置。

[我在“ （PHP和）烦人的vim unindent rules](https://stackoverflow.com/questions/313359/annoying-vim-unindent-rules) ”上看到了一个模糊相关的问题；它没有为我提供直接的答案，尽管其中`cindent`提到的相关项目实际上可能是答案的一部分。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-22T01:41:15.060

找到缩进文件，（例如 /usr/share/vim/vim71/indent/sh.vim 在我的系统上）

这一行看起来像问题：

```
setlocal indentkeys-=:,0#

```

也许您可以在 .vimrc 中修复此问题，或手动加载自定义缩进文件。

编辑：它看起来比我想象的要复杂，但可能在缩进文件中专门设置了一些您需要修复的内容。

第二次编辑：看起来我完全错了，看看：

[输入哈希后恢复缩进](http://vim.wikia.com/wiki/Restoring_indent_after_typing_hash)

或者

[howto-configure-vim-to-not-put-comments-at-the-beginning-of-lines-while-editing](https://stackoverflow.com/questions/354097/howto-configure-vim-to-not-put-comments-at-the-beginning-of-lines-while-editing)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-22T07:01:01.873

好吧，在探索了一些选项之后，包括使用 ' `:set cindent`' 而不是 ' `:set smartindent`'，我最终恢复到只使用 ' `:set autoindent`'。可能有一些方法可以让这些东西完全按照我的意愿工作，但它足够混乱和繁琐，以至于我不会被打扰。在过去的 20 多年里，我一直工作得很好，我认为它的不当行为超过了`autoindent`提供的额外花里胡哨的好处。`smartindent`

谢谢你，胡安，你的帮助。信不信由你，它确实有帮助——很多。

不过，在跟进此问题时，我还发现了其他一些简洁的命令：

```
>i}
>a} 
```

这些右移您所在的代码块。' `i`' 版本缩进正文而不是右大括号（我的首选样式），而 ' `a`' 版本缩进右大括号（工作所需的版本）。

`%`此外，您可以在 shell 执行的命令中将限定符应用于“ ”：

```
:make %:r.o 
```

这将在当前文件名（即' `%:r`'）的'root'上运行make，然后是' `.o`'。或者，换句话说，如果我正在编辑`somefile.c`，这将执行`make somefile.o`。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-12T17:44:09.440

在 .vimrc 中添加以下行

文件类型缩进

（它将根据文件类型设置正确的缩进模式）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-22T13:54:52.190

我有同样的问题很长一段时间，直到我意识到如果在你的 vimrc 中设置了“filetype indent on”，autoindent 和 smartindent 都是不必要的 - 'filetype indent on' 使用 indent/sh.vim（或任何语言）文件在你的 vim 目录中找出缩进规则，并且 autoindent 和 smartindent 都会干扰它。

我没有用 sh 测试过这个，但是当我切换时 perl 突然开始正常运行。

旁注：Juan 的重定向“在输入哈希后恢复缩进”不是一个好的解决方案 - 虽然它确实在一种情况下纠正了问题（输入代码），但它不会改变编辑器认为*应该*缩进的方式，所以重新缩进（视觉 = 或正常 ==）会将其推回左侧。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-02-24T04:47:45.447

上一个答案建议：

:inoremap #X^H#

非常好。这是 ":help smartindent" 的 VIM 文档建议的答案。请注意，使用 CTRL-V CTRL-H 输入 ^H。文档中的相关部分如下。

```
 When typing '#' as the first character in a new line, the indent for
    that line is removed, the '#' is put in the first column.  The indent
    is restored for the next line.  If you don't want this, use this
    mapping: ":inoremap # X^H#", where ^H is entered with CTRL-V CTRL-H.
    When using the ">>" command, lines starting with '#' are not shifted
    right. 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-22T07:33:00.780

我的 .vimrc 中有以下几行，但我没有发现问题。

```
set smartindent
inoremap # X^H# 
```

我曾经在这两行之后*设置了自动缩进，但它似乎没有效果。*

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-25T01:16:50.397

是的，这*很*烦人。smartindent 仅适用于类似 C 的语言。查看我如何根据语言启用适当的缩进： [http ://www.pixelbeat.org/settings/.vimrc](http://www.pixelbeat.org/settings/.vimrc)

# java - Java/JSP 图片上传。在哪里保存这些图像文件？

> ID：385332
> 
> 赞同：5
> 
> 时间：2008-12-22T01:36:34.773
> 
> 标签：java, jsp, file-upload, stripes

我正在编写一个简单的应用程序，让用户上传图像。上传后，用户可以标记或删除它们。

我想出了如何上传文件并在文件上传后保存它们。我正在跟踪保存图像的全局路径。在数据库中，我保留有关图像的元数据，例如文件名、标签等。

我正在使用 Java/JSP（特别是 Stripes 框架，但我的问题是通用的）。

我的问题是这些图像文件上传后我应该保存在哪里？

现在，我在 Tomcat 服务器上部署了两个 Web 应用程序。一个主要的网络应用程序和另一个是我上传图像的地方。

但这不起作用，因为在我重新部署/重新启动 Tomcat 之前，我无法在主应用程序中看到上传的图像。

似乎 Tomcat 不会自动选择新上传的图像。

有没有人有任何解决方案？

这是一个简单的项目，所以我不想将它们存储在数据库中或将 Apache 用于图像。对于这个小项目来说，这太复杂了。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T01:49:06.560

绝对不要将图像存储在数据库中，但您会希望将图像路径存储在数据库中。这将允许您将图像存储在几乎任何地方。

由于您正在使用两个 tomcat 应用程序，因此最好的选择可能是将图像存储在任一应用程序之外并将图像流式传输回给用户，而不是让 tomcat 管理文件。否则，我会问您为什么要尝试使用两个 Web 应用程序来执行此操作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-22T02:05:45.807

但是，将上传的图像存储在 web-app 目录中并不是一个明智的做法，而且您知道这一点。

顺便说一句，你可能想看看这个[stackoverflow 线程](https://stackoverflow.com/questions/348363/what-is-the-best-practice-for-storing-uploaded-images)，最近讨论了在哪里存储图像。它可能无法解决您的问题，但肯定会让您对自己正在做的事情更有信心。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-22T04:54:59.553

我已经以不同的方式解决了这个问题。

首先，不可移植的方式是 Glassfish（我也相信 Tomcat）允许您将外部目录映射到 webapps 层次结构。这非常有效，并且完全符合您的要求。它使您可以将图像存储在远离您的 web 应用程序的外部目录中，但仍然可以提供它们。

然而，这种技术是不可移植的。

我以便携方式完成它的方法是创建一个过滤器。

您将过滤器放置在明显的地方，例如“/images”。

过滤器的作用是：

*   它在 webapp 的一个特殊目录中检查图像（或任何东西，它适用于任何静态资源）。对于我们的示例，我们将使用 URL“/webapp/images”。

*   如果文件不存在，我们会将文件从您的外部位置复制到 webapp 中的适当位置。所以，假设最需要的 url 是“/images/banner.gif”。并且您的文件存储在“/home/app/images”的磁盘上。所以，我们的源文件是“/home/app/images/banner.gif”。然后我们将它复制到 webapp 树中我们想要的位置。我们为此使用“ServletContext.getRealPath”。因此，目标将是“ServletContext.get RealPath("/webapp/images/banner.gif")。只需将源复制到目标即可。

*   如果文件已经存在或现在存在，只需转发到 /webapp/images/banner.gif 中的实际图像。

实际上，您最终会在您的 webapps 部署树中拥有一个文件缓存。不利的一面是它是一个缓存，因此需要对其进行维护（即，您应该检查原始文件是否比您的缓存新，如果源被删除，请确保删除，等等）。此外，它会复制您的资源，因此您的图像最终会消耗两倍的磁盘空间。最后，还有启动时的初始复制成本。

但是，它确实有效，并且它使您不必使用自己的代码提供静态资源。（这是第 3 个解决方案，映射一个过滤器/servlet 以拦截 URL 并简单地自己流式传输。）

我会查看 Tomcat 中的构造（假设它存在）来为您进行映射。我知道它存在于 Glassfish 中。（谷歌 Alternatedocroot for Glassfish 看看它是如何工作的。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T02:00:19.017

我正在使用两个 Web 应用程序来避免过度写入上传的图像，以防我重新部署一个新的主应用程序 war 文件。

但是正如您提到的，除了通过 Servlet 或其他方式流式传输它们之外别无选择，我想我可以将它们保留在 tomcat 目录之外。

我想避免编写这个 Streaming Servlet。在编写流 servlet 时，项目太小而无法处理所有混乱（如正确的内容类型、404 等）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T03:46:29.863

```
import java.io.BufferedInputStream;
import java.io.BufferedOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Image streaming Servlet.
 */
public class ImageDisplayServlet extends HttpServlet {
    private static final long serialVersionUID = 1L;

    /**
     * @see HttpServlet#HttpServlet()
     */
    public ImageDisplayServlet() {
        super();
    }

    /**
     * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
     */
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String relativePath = trimToEmpty(request.getPathInfo());

        // Make sure no one try to screw with us. 
        // This is important as user can literally access any file if we are not careful
        if(isXSSAttack(relativePath) == false) {
            String pathToFile = this.getServletContext().getRealPath(request.getPathInfo());
            File file = new File(pathToFile);

            System.out.println("Looking for file " + file.getAbsolutePath());

            // show a 404 page
            if(!file.exists() || !file.isFile()) {
                httpError(404, response);
            } else {
                try {
                    streamImageFile(file, response);
                } catch(Exception e) {
                    // Tell the user there was some internal server error.\
                    // 500 - Internal server error.
                    httpError(500, response);
                    e.printStackTrace();
                }
            }
        } else {
            // what to do if i think it is a XSS attack ?!?
        }
    }

    private void streamImageFile(File file, HttpServletResponse response) {
        // find the right MIME type and set it as content type
        response.setContentType(getContentType(file));
        BufferedInputStream bis = null;
        BufferedOutputStream bos = null;
        try {
            response.setContentLength((int) file.length());

            // Use Buffered Stream for reading/writing.
            bis = new BufferedInputStream(new FileInputStream(file));
            bos = new BufferedOutputStream(response.getOutputStream());

            byte[] buff = new byte[(int) file.length()];
            int bytesRead;

            // Simple read/write loop.
            while (-1 != (bytesRead = bis.read(buff, 0, buff.length))) {
                bos.write(buff, 0, bytesRead);
            }
        } catch (Exception e) {

            throw new RuntimeException(e);
        } finally {
            if (bis != null) {
                try {
                    bis.close();
                } catch (IOException e) {
                    e.printStackTrace();
                    // To late to do anything about it now, we may have already sent some data to user.
                }
            }
            if (bos != null) {
                try {
                    bos.close();
                } catch (IOException e) {
                    e.printStackTrace();
                    // To late to do anything about it now, we may have already sent some data to user.
                }
            }
        } 
    }

    private String getContentType(File file) {
        if(file.getName().length() > 0) {
            String[] parts = file.getName().split("\\.");
            if(parts.length > 0) {
                // only last part interests me
                String extention = parts[parts.length - 1];
                if(extention.equalsIgnoreCase("jpg")) {
                    return "image/jpg";
                } else if(extention.equalsIgnoreCase("gif")) {
                    return "image/gif"; 
                } else if(extention.equalsIgnoreCase("png")) {
                    return "image/png";
                }
            }
        }
        throw new RuntimeException("Can not find content type for the file " +  file.getAbsolutePath());
    }

    private String trimToEmpty(String pathInfo) {
        if(pathInfo == null) {
            return "";
        } else {
            return pathInfo.trim();
        }
    }

    private void httpError(int statusCode, HttpServletResponse response) {
        try {
            response.setStatus(statusCode);
            response.setContentType("text/html");
            PrintWriter writer = response.getWriter();
            writer.append("<html><body><h1>Error Code: " + statusCode + "</h1><body></html>");
            writer.flush();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    private boolean isXSSAttack(String path) {
        boolean xss = false;
        // Split on the bases of know file separator
        String[] parts = path.split("/|\\\\");

        // Now verify that no part contains anything harmful
        for(String part : parts) {
            // No double dots .. 
            // No colons :
            // No semicolons ;
            if(part.trim().contains("..") || part.trim().contains(":") || part.trim().contains(";")) {
                // Fire in the hole!
                xss = true;
                break;
            }
        }
        return xss;
    }

    /**
     * @see HttpServlet#doPost(Ht/promotions/some.jpgtpServletRequest request, HttpServletResponse response)
     */
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        doGet(request, response);
    }
} 
```

好的，这是我快速编写的一个可以流式传输图像的 Servlet：

**以下是限制和已知问题列表：**

*   小心使用 XSS 漏洞
*   非生产准备使用作为参考
*   图像需要在 web 应用程序目录中。可以很容易改变但我太懒了（项目太小不值得）
*   仅流式传输 jpg、gif 或 png 文件。

**用法：**

假设您将这个名为图像的 Web 应用程序部署为单独的应用程序。

[http://www.example.com/images/promotions/promo.jpg](http://www.example.com/images/promotions/promo.jpg)

表示在此图像 Web 应用程序中应该有一个带有图像“promo.jpg”的“促销”目录。

PS：不要问我为什么要做这个 Servlet Container 唯一的解决方案，这很糟糕。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T03:47:50.453

```
 <servlet>
    <description></description>
    <display-name>ImageDisplayServlet</display-name>
    <servlet-name>ImageDisplayServlet</servlet-name>
    <servlet-class>com.example.images.ImageDisplayServlet</servlet-class>
  </servlet>
  <servlet-mapping>
    <servlet-name>ImageDisplayServlet</servlet-name>
    <url-pattern>/*</url-pattern>
  </servlet-mapping> 
```

哦，你像上面一样配置你的 Servlet 以获得最佳效果：P

# php - 如何在大型项目中使用 PHP？

> ID：385335
> 
> 赞同：25
> 
> 时间：2008-12-22T01:37:44.897
> 
> 标签：php

有人问过这个问题：[大型项目没有 PHP 吗？为什么不？](https://stackoverflow.com/questions/385203/no-php-for-large-projects-why-not) 这是一个反复出现的主题，PHP 开发人员——出于某种原因——被迫为[PHP 辩护](https://stackoverflow.com/questions/309300/defend-php-convince-me-it-isnt-horrible)。

所有这些问题都是有效的，并且有一些回应，但这让我思考。基于您可以用任何语言编写好代码和用任何语言编写坏代码的原则，我认为值得提出积极而不是消极的问题。而不是**为什么你不能**，我想问**你如何**将 PHP 用于大型项目。

那么，如何编写大型、复杂、可扩展、安全且健壮的 PHP 应用程序？

编辑：虽然我明白组织方面很重要，但它们适用于**任何**大型项目。我在这里主要针对的是技术指导以及如何处理常见的可扩展性问题。使用像 APC 这样的操作码缓存是一个明显的开始。集群感知会话将是另一个。这就是我要说的。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-22T01:45:31.947

在大多数情况下，php 的问题不在于语言。问题来自低门槛和缺乏任何基础设施来避免常见的编程问题或安全问题的耦合。它是一种语言，就其本身而言，非常快速和肮脏。尽管如此，它对于大型 Web 应用程序仍然具有许多优势。您只需要知道如何添加某种级别的基础架构以避免许多常见的 Web 编程错误。请参阅 -开发人员在[构建公共网站](https://stackoverflow.com/questions/72394/what-should-a-developer-know-before-building-a-public-web-site)以寻求帮助[*之前*](https://stackoverflow.com/questions/72394/what-should-a-developer-know-before-building-a-public-web-site)[应该知道什么。](https://stackoverflow.com/questions/72394/what-should-a-developer-know-before-building-a-public-web-site)

 *您需要了解 php 可能使您的 Web 应用程序不安全或有问题的原因，并学会缓解这些问题。您应该了解如何使用 php 安全地访问您的数据库。您应该了解如何避免 SQL 注入。您应该了解诸如 register_globals 之类的邪恶事物以及为什么永远不应该使用它们。简而言之，在潜入现实世界的大型网络应用程序之前，您应该对您的工具**做足功课。**

一旦你受过教育，归根结底你可能想要构建一个框架或使用一个预先存在的框架来缓解这些问题。流行的框架包括 PEAR 和 Zend。

此外，有用的问题可能会有所帮助：

*   [每个php程序员都应该知道什么？](https://stackoverflow.com/questions/306497/what-should-every-php-programmer-know)
*   [开发人员在建立公共网站*之前*应该知道什么](https://stackoverflow.com/questions/72394/what-should-a-developer-know-before-building-a-public-web-site)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-22T01:51:45.337

在大型项目中使用 PHP 与使用任何其他语言没有什么不同。[您需要编写可维护](http://www.php.net/zend-engine-2.php)和[可扩展](http://framework.zend.com/)源代码的经验和知识。您需要了解[安全隐患](http://phpsec.org/projects/guide/)和[性能问题](http://ilia.ws/files/phptek2007_performance.pdf)。您需要研究过您的[问题领域](http://en.wikipedia.org/wiki/Problem_domain)并熟悉它。

最后，与任何其他语言一样 - 您需要的是[高质量](http://www.joelonsoftware.com/items/2005/01/27.html)且[积极进取的](http://www.google.com/intl/en/jobs/)开发人员。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-07-03T14:03:22.593

我知道，这有点过时了，但是，我仍然会尝试回答...使用[Haxe](http://haxe.org) /PHP ...我可以深入研究细节...但是如果您查看语言，它的功能和PHP API 被封装成相当一致的东西的好方法，你很快就会看到 PHP 的问题是什么......而且，你最终拥有 Haxe 的所有好处......

**编辑：**这是一个严肃的答案...... Haxe / PHP自动解决了标记为答案的帖子中提到的很多问题......

*   register_globals 已关闭...您通过[php.Web获取参数](http://haxe.org/api/php/web)
*   对数据库使用[SPOD](http://haxe.org/doc/neko/spod)层（与 php 相同的 API）会自动处理转义（并会自动提供您的模型（并且[templo](http://lib.haxe.org/p/templo)是一个非常好的模板引擎，因此应该对您的视图有所帮助））
*   拥有一种类型化的语言，您更有可能编写更好的代码……加上泛型和枚举等语言功能非常强大……而且 Haxe 中有很多编译时魔法也很有趣……更多强大的语言总是能很好地解决复杂的问题......

如果你想使用其他 PHP 框架，你只需要编写外部类，一切都会按预期工作......

我认为 Haxe 是对“大型”、“复杂”、“安全”和“强大”的一个很好的回答……可扩展性当然不是来自 Haxe 本身……但是，如果你查看 haxelib，那么你发现很多东西，这将有助于可扩展性......例如[memcached](http://lib.haxe.org/p/memcached)（您必须在 memcached.Connection 中将 neko.net.Socket 更改为 php.net.Socket）......

如果你真的想使用 PHP 语言，而不仅仅是平台，Haxe 当然不会帮助你......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-22T01:43:53.263

您可以在任何其他语言或任何其他环境中做任何事情。

项目开发有几个简单的步骤：

*   **组织**；在开始编程之前，您需要组织所有内容，完成文档、uml 图和其他前期工作。

*   **结构**；在开始编码之前和开始之后，您需要关注结构，这意味着您始终需要正确地完成它，而不是做任何 spagetthi 解决方案。保持代码简单且注释良好。

这两点很简单，适用于所有开发领域，尽管语言不同。保持简单和有据可查，你会发现用 PHP 开发大型 Web 应用程序就像用 ASP.NET、Ruby 或其他任何东西一样容易。

但是，当我们进入开发阶段时，您需要获得一个好的 IDE，使用一个好的数据库，使用一个 repo。，获得一个 MVC / 模板系统，虽然这在“结构”部分中运行。

顺便说一句，将应用程序分成不同的层：DLF（数据、逻辑、前端）。至少使用这三层，你会发现开发会很容易。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T22:52:46.600

使用模型-视图-控制器框架。据说，是的。并且，每个零件至少有一名工程师。

模型：您的 DBA 应该编写模型代码。不应该允许其他人编写 SQL 语句。

视图：最了解 CSS 和 Javascript 的人应该做视图部分。他/她应该编写最少的 PHP 代码，他是使用 PHP 变量的人。

控制器：她是真正的 PHP 编码器，也是后端服务器工程师，希望无论是否使用其他脚本语言。

# c# - 有没有办法从静态方法访问缓存或会话？

> ID：385345
> 
> 赞同：19
> 
> 时间：2008-12-22T01:41:38.413
> 
> 标签：c#, asp.net, jquery, ajax, dynamic

您将如何从 jQuery ajax 调用访问缓存？

我正在使用 jquery 进行一些数据验证和快速数据访问。我有一个静态网络方法，jquery 通过 json 调用它来返回一个值。我不想每次都调用数据库，所以我想缓存我正在访问的数据，但我无法确定如何从 javascript 或静态方法中调用 asp.net 缓存。

我想将页面对象发送到静态方法，这将允许我访问 page.cache，但不知道如何。除此之外，也许是一种从 javascript 本身访问缓存的方法？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-22T02:10:27.310

`System.Web.HttpContext.Current.Cache`

每个应用程序域共享缓存 - 而不是每个页面。Page 只是有一个[方便的 Page.Cache 属性](http://msdn.microsoft.com/en-us/library/system.web.ui.page.cache.aspx)来获取当前的 Cache，这意味着您可以只从页面中的方法执行 Cache["key"] 。

正如您所注意到的，如果您使用的是静态方法 - 那么您就没有 Page 实例，也没有 Page.Cache 属性。因此，您需要使用[HttpContext.Cache](http://msdn.microsoft.com/en-us/library/system.web.httpcontext.cache.aspx)。但是，等等 - 你也没有 HttpContext 实例！没关系，当前执行的实例存储在[HttpContext.Current](http://msdn.microsoft.com/en-us/library/system.web.httpcontext.current.aspx)的静态属性中。

所以 - 回答你的问题 - 在静态方法中，使用 HttpContext.Current.Cache。顺便说一句，您还可以从那里访问[请求](http://msdn.microsoft.com/en-us/library/system.web.httpcontext.request.aspx)和[响应](http://msdn.microsoft.com/en-us/library/system.web.httpcontext.response.aspx)属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T01:56:10.397

如果你真的想这样做，我认为调用 PageMethod 可能是你能做的最好的事情：

[http://encosia.com/2008/05/29/using-jquery-to-directly-call-aspnet-ajax-page-methods/](http://encosia.com/2008/05/29/using-jquery-to-directly-call-aspnet-ajax-page-methods/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T01:47:42.897

Javascript 是客户端，缓存在服务器端，因此您需要对 asp.net 应用程序中的一个方法进行回调，该方法返回缓存的内容。

ASP.NET Cache API 真的很不错，你可以使用 Cache["Key"] 来获取你喜欢的缓存内容。在这里阅读更多：http: [//msdn.microsoft.com/en-us/library/ms972379.aspx](http://msdn.microsoft.com/en-us/library/ms972379.aspx)

# silverlight-2.0 - Silverlight 中的中间 ado.net 数据服务

> ID：385347
> 
> 赞同：1
> 
> 时间：2008-12-22T01:42:12.110
> 
> 标签：silverlight-2.0, wcf-data-services

我们将 Silverlight 2 与 ADO.NET 数据服务一起使用，并测试 silverlight 页面，我们在同一域中使用了一个运行良好的服务。然后我们决定尝试使用代理或中间服务（与 Silverlight 应用程序位于同一域中），它基本上只是显示位于另一个域中的服务（通过使用在另一个域中的服务的服务引用中生成的类作为在我们的本地服务中公开的类型并创建一个将 Uri 设置为指向的构造函数。我们想这样做是因为我们希望我们的 silverlight 服务器位于 DMZ 中，而我们的服务位于内部域上，因为我们也将服务用于内部应用程序，这似乎是一种绕过跨域的方式Silverlight 的限制。

当我们使用以下查询时，这可以正常工作：

```
var questions = (from q in context.Question
                            select q) 
```

但是，一旦我们尝试使用 expand ，如下所示：

```
var questions = (from q in context.Question.Expand("Answers")
                            select q) 
```

我们得到一个例外说明：

只能在上次投影后指定查询选项（orderby、where、take、skip）。

堆栈跟踪在哪里：

在 System.Data.Services.WebUtil.GetRequestEnumerator(IEnumerable enumerable) 在 System.Data.Services.DataService `1.SerializeResponseBody(RequestDescription description, IDataService dataService) at System.Data.Services.DataService`1.HandleNonBatchRequest(RequestDescription description) 在 System.Data.Services.DataService`1.HandleRequest()

有人对这背后的原因有什么建议吗？这当然适用于内部服务，但我认为由于查询是可组合的，这也适用于代理服务......

任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T04:41:13.217

我们设法通过在客户端使用 LoadProperty 方法解决了这个问题。这样我们检索所有问题，然后调用 LoadProperty("Answers") 和问题。

# oop - 有哪些不同类型的封装？

> ID：385361
> 
> 赞同：5
> 
> 时间：2008-12-22T01:54:20.527
> 
> 标签：oop, encapsulation

有哪些不同类型的封装？

我认为这基本上是指诸如抽象、多态性和继承之类的核心 OO 概念是否正确？

我对封装的理解是它是一种隐藏数据/功能的方法，但我从来没有真正将多态性或继承视为一种封装形式，尽管我可以看到多态性如何被视为封装，因为它可以隐藏你对象的确切类型正在与之互动。

那么，您会说仅此而已，还是我缺少一些核心概念？

*编辑*我刚刚在评论中注意到有人提到它可能指的是私有/公共方法，也许我对这个问题的思考太多并期待一个比实际更复杂的答案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T02:10:16.017

你想太多我觉得。

[http://en.wikipedia.org/wiki/Information_hiding](http://en.wikipedia.org/wiki/Information_hiding)

**摘自这篇文章**：

计算机科学中的信息隐藏是在计算机程序中隐藏最有可能发生变化的设计决策的原则，从而在设计决策发生变化时保护程序的其他部分免受更改。保护包括提供一个稳定的接口，该接口将程序的其余部分与实现（最有可能改变的细节）隔离开来。

一种常见的封装形式是使用属性来隐藏私有数据字段。一种更常见的形式是使用 OO 将软件的复杂性封装到具有角色和职责的良好划分的类中。这是 OO 的关键租户，因为它从单一的程序设计风格转变为更加结构化的风格，努力隐藏所有不相关的信息，除了与您正在处理的特定任务有关的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T02:26:28.043

我的观点和理解是，封装（封装）一词是为了展示而捕捉事物本质的艺术/科学。事实上，根据定义——封装就是将某物打包或封装在另一个容器中。因此，封装一词意味着将您尝试实现的内容的本质并将其包装成有用的形式，以便在必要时可以重用。

因此，为了解释这一点，这意味着将材料打包成一种以后会更有用的形式。

所以真的......按照你认为合适的方式解释这个。我认为它采用了一堆算法和实用程序，并创建了一个可以在其他项目中用作 API 的类结构。这种封装的代码可以被继承和/或扩展，以使其可用于修改目的，而无需更改 API 的基本本质。

因此，抽象、多态和继承不是封装的形式，而是扩展和修改封装代码的形式。

不同形式的封装意味着对属性、方法、字段和类的修饰符——即公共、私有、静态、虚拟（在 C# 中）。其他一切（即重载、覆盖、阴影）都是对该封装的修改或扩展。

您可以将修改后的代码视为封装，然后可以进一步继承/抽象/扩展，但要扩展的*包*是封装的产品。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T02:30:49.580

封装不仅仅是简单的信息隐藏。这是它的一个方面。它与模块的接口有关。接口提供了两个非常重要的功能：封装和抽象。

> 抽象是指模块的客户端不需要知道比接口中的内容更多的信息。

和

> 封装是指模块的客户端无法了解接口中的内容。

（ Perdita Stevens的*Using UML*中的两个定义）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-30T09:16:37.243

封装由国际标准化组织的国际标准定义：“信息技术 – 开放分布式处理”，ISO/IEC 10746, 1998。

它是根据更原始的定义来定义的：

实体：任何具体或抽象的感兴趣的事物。

对象：实体的模型。一个对象的特征在于它的行为，双重地，它的状态。

（对象的）行为：行为的集合，对何时可能发生具有一组约束。

接口：对象行为的抽象，由该对象的交互的子集以及它们何时可能发生的一组约束组成。

封装：对象中包含的信息只能通过对象支持的接口的交互来访问的属性。

ISO 没有定义不同类型的封装。

其他帖子提到了信息隐藏。ISO 没有在信息隐藏方面明确定义封装，尽管它似乎是隐含的，请参阅[http://www.edmundkirwan.com/pub/上的“封装理论基础”](http://www.edmundkirwan.com/pub/)

埃德。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T02:14:40.610

由于封装只是指“信息隐藏”，所以我想很多东西都可以归类为封装。然而，我倾向于将封装视为“实现隐藏”，换句话说，它是我用来在我编写的任何内容与我编写的任何客户端之间创建松散耦合的工具。

因此，我倾向于务实地相信，封装是任何范式或最佳实践，它允许我向任何客户呈现干净、可靠的界面。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T04:19:23.777

通常，该词的用法与它所说的非常接近。当你包含它时，你封装了一些东西，不要让任何交易松散。考虑它的最佳方式是，您将某物放入一个黑匣子中，再也没有人可以看到细节。该框隐藏了所有内容，在其位置提供了一些其他不相关的界面。

信息隐藏只是封装的一个方面，因为除了数据之外，您还可以隐藏代码本身的任何细节。封装系统的一部分的目的是从整体中消除那一点复杂性，从而更容易理解单独的细节（双方）。[更多的？](http://theprogrammersparadox.blogspot.com/2008/01/abstraction-and-encapsulation.html)

保罗。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-06-26T06:12:54.427

“封装的候选定义：

*   在物理上将相关的操作或事物组合在一起。
*   状态或数据的看门人。
*   隐藏实施。”

来源：[封装定义](http://c2.com/cgi/wiki?EncapsulationDefinition)

实现封装有两个部分/方式：

*   > 首先，封装是一种将相关数据和行为封装成一个单元的技术，即操作（行为）的物理分组

例如：-

```
class Person {
    String name;
    int age;

    void talk() {
    }

    void think() {
    }

    void work() {
    }

    void play() {
    }
} 
```

*   > 其次，封装是一种保护数据不被外界滥用的技术，称为“信息隐藏”或“数据隐藏”。

例如：-

```
class Person {
    private String name;
    private int age;

    public String getName() {
        return name;
    }

    public String getAge() {
        return age;
    }
} 
```

来源：[What is Encapsulation in Java - The WHAT, WHY and HOW](http://www.codejava.net/java-core/the-java-language/what-is-encapsulation-in-java-the-what-why-and-how)，**剧透作者以接口为例，这是不正确的。接口用于抽象**

# http - 浏览器的“F5”和“Ctrl + F5”刷新会产生什么请求？

> ID：385367
> 
> 赞同：410
> 
> 时间：2008-12-22T02:00:08.720
> 
> 标签：http, browser, caching, cross-browser, refresh

网络浏览器中的操作`F5`和`Ctrl`触发是否有标准？`F5`

我曾经在 IE6 和 Firefox 2.x 中做过实验。`F5` 刷新将触发带有标头的 HTTP 请求发送到服务器，`If-Modified-Since`而`Ctrl`+`F5`将没有这样的标头。在我的理解中，`F5` 将尝试尽可能多地利用缓存内容，而`Ctrl`+`F5`旨在放弃所有缓存内容并再次从服务器检索所有内容。

但是今天，我注意到在一些最新的浏览器（Chrome、IE8）中，它不再以这种方式工作了。`F5`和`Ctrl`+都`F5`发送`If-Modified-Since`标头。

那么这应该如何工作，或者（如果没有标准）主要浏览器在实现这些刷新功能方面有何不同？

* * *

## 回答 #1

> 赞同：530
> 
> 时间：2008-12-22T03:40:59.173

这取决于浏览器，但它们的行为方式相似。

`F5`通常只有在页面被修改时才会更新页面。现代浏览器发送`Cache-Control: max-age=0`通知任何缓存资源被认为是新鲜的最长时间，相对于请求的时间。

`CTRL`-`F5`用于强制更新，忽略任何缓存。现代浏览器发送`Cache-Control: no-cache`和`Pragma: No-cache`

如果我没记错的话，Netscape 是第一个通过在按下-`Pragma: No-cache`时添加对缓存控制的支持的浏览器。`CTRL``F5`

```
┌───────────┬──────────────┬─────┬─────────────────┬──────────────────────────────┐
│ Version 4 │      F5      │  R  │      CLICK      │ Legend:                      │
│2021 MAY 19├──┬──┬──┬──┬──┼──┬──┼──┬──┬──┬──┬──┬──┤ C = Cache-Control: no-cache  │
│           │  │S │C │A │A │C │C │  │S │C │A │A │C │ I = If-Modified-Since        │
│           │  │H │T │L │L │T │T │  │H │T │L │L │T │ M = Cache-Control: max-age=0 │
│           │  │I │R │T │T │R │R │  │I │R │T │T │R │ N = Not tested               │
│           │  │F │L │  │G │L │L │  │F │L │  │G │L │ P = Pragma: No-cache         │
│           │  │T │  │  │R │  │+ │  │T │  │  │R │+ │ - = ignored                  │
│           │  │  │  │  │  │  │S │  │  │  │  │  │S │                              │
│           │  │  │  │  │  │  │H │  │  │  │  │  │H │ With 'CLICK' I refer to a    │
│           │  │  │  │  │  │  │I │  │  │  │  │  │I │ mouse click on the browsers  │
│           │  │  │  │  │  │  │F │  │  │  │  │  │F │ refresh-icon.                │
│           │  │  │  │  │  │  │T │  │  │  │  │  │T │                              │
│           │  │  │  │  │  │  │  │  │  │  │  │  │  │ 1: Version 3.0.6 sends I     │
├───────────┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┤    and C, but 3.1.6 opens    │
│Brave 1.24 │M │CP│CP│- │- │M │CP│M │CP│CP│M │CP│CP│    the page in a new tab,    │
├───────────┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┤    making a normal request   │
│Chrome 1   │MI│MI│MI│- │- │MI│- │MI│MI│MI│MI│MI│N │    with only I.              │
│Chrome 6   │MI│CP│CP│- │- │MI│CP│MI│CP│CP│MI│- │N │ 2: Version 10.62 does        │
│Chrome 90  │M │CP│CP│- │- │M │CP│M │CP│CP│M │CP│CP│    nothing. 9.61 might do C  │
├───────────┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┤    unless it was a typo in   │
│Edge 90    │M │CP│CP│- │- │M │CP│M │CP│CP│M │CP│CP│    my old table.             │
├───────────┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┤ 3: Opens the currernt tab in │
│Firefox 3.x│MI│- │CP│- │- │MI│CP│MI│CP│1 │M │MI│N │    a new tab, but does not   │
│Firefox 89 │M │- │CP│- │M │M │CP│M │CP│3 │M │M │3 │    refresh the page if it is │
├───────────┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┤    cached in the browser.    │
│MSIE 8, 7  │I │- │C │- │I │I │  │I │I │C │I │I │N │                              │
├───────────┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┼──┤                              │
│Opera 10, 9│C │- │- │2 │- │C │- │C │C │C │C │- │N │                              │
│Opera 76   │M │CP│CP│- │- │M │- │M │CP│CP│M │CP│CP│                              │
├───────────┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──────────────────────────────┤
│                    https://stackoverflow.com/a/385491/36866                     │
└─────────────────────────────────────────────────────────────────────────────────┘ 
```

**关于 Chrome 6.0.472 的注意事项**：如果您执行强制重新加载（如`CTRL`- `F5`），它的行为就像 url 在内部被标记为始终执行强制重新加载。如果您转到地址栏并按 Enter，则该标志将被清除。

* * *

## 回答 #2

> 赞同：330
> 
> 时间：2008-12-22T02:10:55.297

一般来说：

`F5`即使内容发生更改，也可能会为您提供相同的页面，因为它可能会从缓存中加载页面。但是`Ctrl`+`F5`强制刷新缓存，并且会保证如果内容改变，你会得到新的内容。

* * *

## 回答 #3

> 赞同：69
> 
> 时间：2012-03-12T16:59:02.580

我已经实现了跨浏览器兼容页面来测试[浏览器的刷新行为](https://web.archive.org/web/20130111203313/http://podlipensky.com/2012/03/behind-refresh-button/)（这里是[源代码](https://github.com/podlipensky/RefreshButton/)）并获得类似于@some的结果，但对于现代浏览器：

![在此处输入图像描述](https://i.stack.imgur.com/vDrr1.png)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-07-22T08:47:31.597

至少在 Firefox (v3.5) 中，缓存似乎被*禁用*而不是简单地清除。如果一个页面上有同一个图像的多个实例，它将被多次传输。`img`随后通过 Ajax/JavaScript 添加的标签也是如此。

因此，如果您想知道为什么浏览器会在您的自动刷新 Ajax 站点上不断下载同一个小图标几百次，那是因为您最初使用`CTRL`-加载了该页面`F5`。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-10-12T00:31:44.390

根据页面是否有焦点，IE7/8/9 的行为似乎有所不同。

如果单击页面并单击`CTRL`+ `F5`，则请求标头中包含“Cache-Control: no-cache”。如果您单击位置/地址栏，然后按`CTRL`+`F5`它不是。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-06T07:26:53.940

当用户按下`F5`新请求时，尽管新请求会发送到 Web 服务器并获得对请求的响应。但是当响应头被解析时，它会检查浏览器缓存中的所需信息。如果缓存中所需的信息尚未过期，则该信息将从缓存本身中恢复。

当用户点击时`CTRL`——`F5`即使这样，新请求也会发送到 Web 服务器并得到响应。但是这次解析响应头时，它不会检查缓存中的任何所需信息，并且仅将所有更新的信息带入服务器。

# c++ - 不知从何而来的用户断点

> ID：385370
> 
> 赞同：7
> 
> 时间：2008-12-22T02:01:11.247
> 
> 标签：c++, debugging, visual-c++, visual-c++-6

我正在调试的 MS VC++ 6.0 中有一些代码。出于某种原因，在我试图删除一些动态分配的内存的某个时刻，它中断了，我收到一个弹出消息框，上面写着“从代码中调用的用户断点”.. 然后弹出反汇编窗口，我看

```
*memory address* int      3 
```

奇怪的是，在我调用这样的汇编指令的代码中没有任何地方（我认为 asm int 3 是 x86 的硬件中断命令？）..

是什么原因造成的？

编辑：回答：我的代码是“离开数组的末端”，但仅在 Visual Studio 调试标记的位置中使用 0xFDFDFDFD，称为 NoMan'sLand 围栏。我认为它也称为 Off-by-一个错误..这个数组与我在发生错误时释放内存的点无关。这使得它更难被发现.. :(

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-22T02:02:46.033

您可能在调试堆例程中遇到了发现堆损坏的代码。

当您点击 Int 3 时，调用堆栈是什么样的？

编辑：根据您评论中的堆栈跟踪，该例程`_CrtIsValidHeapPointer()`说被释放的指针是错误的。下面是 MSVC 的 DBGHEAP.C 源代码的片段：

```
 /*
     * If this ASSERT fails, a bad pointer has been passed in. It may be
     * totally bogus, or it may have been allocated from another heap.
     * The pointer MUST come from the 'local' heap.
     */
    _ASSERTE(_CrtIsValidHeapPointer(pUserData)); 
```

`pUserData`将是您要删除的指针的值。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-22T02:13:16.540

> （我认为 asm int 3 是 x86 的硬件中断命令？

**这是。**它被称为**“硬件断点”**。如果您在项目源代码中使用 VS 调试器，它就像一个断点（但在代码中）。从 vs2005 开始，如果您的应用程序在没有任何调试器的情况下启动，应用程序将简单地崩溃，就像它启动了一个非托管异常一样。

在很多公司中，有一个简单的宏用于在代码中添加断点。在某些（困难和罕见的）情况下，这可以替换断言和异常：

```
#define BREAKPOINT __asm { int 3; }

BREAKPOINT; 
```

看 ：

*   [http://msdn.microsoft.com/en-us/library/45yd4tzz(VS.80).aspx](http://msdn.microsoft.com/en-us/library/45yd4tzz(VS.80).aspx)
*   [http://www.highprogrammer.com/alan/windev/visualstudio.html](http://www.highprogrammer.com/alan/windev/visualstudio.html)

所以我建议寻找一些执行此操作的宏或对象，或者它可能出现在您没有代码的模块（dll/lib）中？

# c# - 如何终止挂起的 APM 操作

> ID：385381
> 
> 赞同：2
> 
> 时间：2008-12-22T02:09:43.990
> 
> 标签：c#, .net, asynchronous

如果您有待处理的操作，例如

```
stream.BeginRead(_buffer, 0, _buffer.Length, _asyncCallbackRead, this); 
```

然后关闭流提供程序，例如

```
serialPort.Close(); 
```

不出所料，您会导致异常。

在关闭端口之前，是否有一种首选方法可以取消挂起的 APM 操作？

* * *

科尔比的回答不是我希望的答案，但他至少关闭了一条毫无结果的询问途径。

很高兴我找到了解决方案。

对于每个流，我在一个类中维护各种状态信息`DeviceSession`。这个类有一个方法`ReadStream`提供`AsyncCallback`处理传入数据的实现。

请注意，`_asyncCallbackRead`以下划线开头的所有其他变量都是在 DeviceSession 的构造函数中分配的类私有成员。

构造函数还提供对 的初始调用`_stream.BeginRead`。

```
void ReadStream(IAsyncResult ar)
{
  if (IsOpen) 
    try
    {
      DevicePacket packet;
      int cbRead = _stream.EndRead(ar);
      _endOfValidData += cbRead;
      while ((packet = GetPacket()) != null)
        CommandStrategy.Process(this, packet);
      _stream.BeginRead(_buffer, _endOfValidData, 
        _buffer.Length - _endOfValidData, 
        _asyncCallbackRead, null);
    }
    catch (Exception ex)
    {
      Trace.TraceError("{0}\r\n{1}", ex.Message, ex.StackTrace);
      _restart(_streamProvider, _deviceId);
    }
} 
```

请注意，我没有费心设置`ar.AsyncState`. 因为回调委托引用了特定的 DeviceSession 实例的方法，所以详细的强类型上下文信息（包含在此 DeviceSession 实例的成员中）*自动*在范围内。这就是拥有会话对象的意义所在。

回到中止侦听器的主题，关闭流提供程序会触发回调，但尝试调用 EndRead 会导致`IOException`.

通常，此类异常表示需要重新启动侦听器的故障，并且希望通过重新启动流提供程序并重新创建会话来做出响应。由于缺乏可靠的独立于流提供者的方式来确定提供者是否出现故障或用户是否正在尝试重新启动连接（例如将新设备插入端口），这使情况变得复杂。

诀窍是在 中添加更多上下文 ( `IsOpen`) 以`DeviceSession`指示会话是打开还是已关闭，并使用它来顺利完成`ReadStream`.

If `IsOpen`is `true`then an`IOException`表示需要恢复的故障。如果`IsOpen`是`false`故意引发故障，则无需采取任何措施。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-10-06T05:39:33.720

*[受到Richter's CLR via C#中关于APM的章节的启发，我决定看看SO在这个主题上有什么好东西，我发现了这个问题。我认为彼得在这里有一个很好的问题并做了一些研究——这就是结果]*

Jeffrey Richter 在 CLR 中通过 C#（第 27 章）讨论了他的 AsyncEnumerator 类，该类（据说）消除了对 APM 编程的大部分痛苦。这个类的特性之一（他免费提供的[Power Threading Libary](http://wintellect.com/powerthreading.aspx)的一部分）是取消异步操作的能力。

该课程可以从上面的链接下载。该页面还包括一​​个指向 Yahoo Group Richter 的链接，该链接旨在为该库提供有限的支持。

他在这些 MSDN 文章中介绍了该库：

[使用 AsyncEnumerator 简化 APM](http://msdn.microsoft.com/en-us/magazine/cc546608.aspx)
[更多 AsyncEnumerator 功能](http://msdn.microsoft.com/en-us/magazine/cc721613.aspx#id0390081)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T02:54:01.560

框架不直接支持这一点。最好的办法是编写一个生成线程的包装器，并使用事件之类的同步原语来发出取消请求的信号。

高温高压

科尔比非洲

# python - Python 3 移植工作流程？

> ID：385394
> 
> 赞同：5
> 
> 时间：2008-12-22T02:18:22.677
> 
> 标签：python, python-3.x, porting

我有一个小项目我想尝试移植到 Python 3 - 我该怎么做？

`python2.6 -3`我已经使用（主要是删除调用）使代码在没有警告的情况下运行`.has_key()`，但我不确定使用 2to3 工具的最佳方法。

> 使用 2to3 工具将此源代码转换为 3.0 语法。不要手动编辑输出！

运行`2to3 something.py`输出一个差异，它本身没有用。使用该`--write`标志会覆盖 something.py 并创建备份.. 似乎我必须这样做..

```
2to3 something.py
python3.0 something.py
mv something.py.bak something.py
vim something.py
# repeat 
```

..这有点绕 - 理想情况下我可以做类似..

```
mv something.py py2.6_something.py # once

2to3 py2.6_something.py --write-file something.py
vim py2.6_something.py
# repeat 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T02:22:23.153

啊哈，您可以将 2to3 输出通过管道传输到`patch`命令，该命令可以将修改后的文件写入新文件：

```
mv something.py py2.6_something.py
2to3 py2.6_something.py | patch -o something.py 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T17:55:55.437

2.x 应该是您积极开发的代码库，因此 2to3 应该真正在分支或临时目录中运行。我不确定您为什么要将 2.x 和 3.x 版本放在同一个目录中。distutils 有一个 build_2to3 脚本，它将在 3.0 安装上运行 2to3。

# java - Maven 替代品？

> ID：385401
> 
> 赞同：5
> 
> 时间：2008-12-22T02:24:27.580
> 
> 标签：java, maven-2, build, continuous-integration

作为 Maven Java 构建工具集的替代品，您有什么建议？只是简单的 Ant 脚本？缺点？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-06T07:43:21.550

无论如何，这取决于您使用什么。马文一号？马文2？当与 Ant 任务和一些自制的 Java 插件结合使用时，我发现 Maven 2 有很好的文档记录，并且非常强大。

有一些 Ant 任务可以使用来自 Ant 的 Maven 功能：[http](http://maven.apache.org/ant-tasks/index.html) ://maven.apache.org/ant-tasks/index.html 。因此，您实际上并不需要编写自己的“库”。

您可以从 Maven 调用 Ant：[http](http://maven.apache.org/plugins/maven-antrun-plugin/) ://maven.apache.org/plugins/maven-antrun-plugin/ 。

您还可以使用 Groovy 编写脚本，例如： http: [//groovy.codehaus.org/GMaven+-+Executing+Groovy+Code](http://groovy.codehaus.org/GMaven+-+Executing+Groovy+Code)。

或者只是为您需要的自定义位编写 Java 代码：[http](http://maven.apache.org/guides/plugin/guide-java-plugin-development.html) ://maven.apache.org/guides/plugin/guide-java-plugin-development.html 。

当你可以做到时，没有理由不混合搭配;）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-22T03:45:53.173

虽然我喜欢 Maven 的**想法**，但我总是发现自己在为除了最简单的配置之外的任何东西而奋斗。它的架构是基于插件的，插件的质量差异很大。文档充其量是粗略的；有一半的时间我不知道我正在阅读的文档是针对 Maven 1 还是 2。您多久不得不求助于使用`maven-ant-plugin`来做一些基本的事情？

我已经使用[Apache Ivy](http://ant.apache.org/ivy/)大约一年了，我对它非常满意。虽然有一点学习曲线。但是有一个活跃的邮件列表，作者反应非常好。

我最终做的是编写一个包含一些简单 Ant 目标的“库”，例如“resolve”、“compile”、“install”等，这些目标希望事物位于标准 Maven 位置（例如`src/main/java`），然后`<import>`是目标进入我的各种项目。通过这种方式，您可以获得两全其美的优势——Maven 风格的配置，以及 Ant 的所有功能。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-22T02:43:16.123

我喜欢将 Ant 与[Ivy](http://ant.apache.org/ivy/)一起使用。Ivy 使用 Maven 存储库来获取库依赖项，而无需强制您更改整个构建系统以适应 Maven。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-22T03:41:40.497

我一直在为我的一些项目使用[buildr](http://incubator.apache.org/buildr/)。非常简洁易读的构建脚本（无 xml），它使用 maven repos（只需付出微不足道的努力，maven 1 和 maven 2）。

我一直在为一些项目寻找一些 post-maven1 的东西，而 m2 并不是那么吸引人。Maven 已经让所有的 m1 用户都忙得不可开交，他们需要重做他们所有的构建系统（据我所知，我的一些用户无法用 m2 表示）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-31T23:00:50.883

我真的很喜欢使用 ant4eclipse——你可以像往常一样在 eclipse 中设置你的项目依赖，你可以编写一个单一的 ant 脚本，以正确的顺序构建所有项目。

对于第三方库，您可以设置一个包含（并导出）所有 jar 的单个 Eclipse 项目[我不推荐这样做]，或者为每个第三方库设置一个单独的项目，导出 jar。[我推荐后者 b/c 你可以跟踪项目->第三方部门并在需要时升级部件。]

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T17:14:49.637

如果我期望我的构建中有复杂的构建目标，我会选择 buildr。好处是，您根本不依赖任何特定的库。你拥有 Ruby 的所有 API 来做任何你想做的事；与 Ivy 不同，在这种情况下，您仍然与 ANT 绑定。如果您想将库依赖引入到已经建立的基于 ANT 的构建机制中，该构建机制会执行您想要执行的所有操作，那么迁移到 Ivy 的努力是值得的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-23T04:56:03.967

Maven 至少有三个不同的部分：存储库、独立于实现的生命周期和默认项目的约定。使用 Ivy 仅提供存储库。

我没有使用过它，但我认为[easyant](http://easyant.abrm.info/trac)旨在更完整地替代Maven。它使用 Ivy 作为存储库，但随后添加了约定和标准模块。

# javascript - 基于原型的面向对象。黄金三镖客？

> ID：385403
> 
> 赞同：10
> 
> 时间：2008-12-22T02:25:02.243
> 
> 标签：javascript, python, language-agnostic, lua, oop

我来自面向对象语言的课程，最近我一直在学习那些花哨的动态语言（JavaScript、Python 和 Lua），我想要一些关于如何在这些语言中使用 OO 的技巧。了解这种方法的缺陷和缺点以及与传统 OO 相比的优势将很有用。

我得到的一般概念是，基于原型的 OO 基本上是使用对象进行编程，但没有关于如何使用它们的标准，而在普通 OO 中，有一种固定的预定义方式来制作和使用对象。

总而言之，这种方法的优点、缺点和丑陋的部分是什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-22T04:34:49.813

基于原型的 OO 不适合静态类型检查，有些人可能认为这是一件坏事或丑陋的事情。基于原型的 OO*确实*具有创建新对象的标准方法，即**克隆和修改现有对象**。还可以建工厂等等。

我认为人们最喜欢（“好”）的是基于原型的 OO 非常**轻巧且灵活**，提供了**非常高的功率重量比**。

有关**如何使用基于原型的 OO 的提示**，一个很好的起点是关于[The Power of Simplicity](http://research.sun.com/self/papers/self-power.html)的原始 Self 论文。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-22T03:15:34.387

为了节省带宽，这里是[我关于“如何在 JavaScript 中模拟“类”？（有或没有第三方库）”的答案](https://stackoverflow.com/questions/355848/what-is-the-best-way-to-emulate-classes-in-javascript-with-or-without-a-framewo#356343)的链接。它包含更多参考资料和示例。

简短的回答：JavaScript 原型[OO](http://en.wikipedia.org/wiki/Object-orientation)的核心是委托。在这种 OOP 风格中，同一个“类”的不同对象可以将方法和属性的处理委托给同一个原型（通常是第三个对象）：

```
var foo = {
    property: 42,
    inc: function(){
        ++this.counter;
    },
    dec: function(){
        --this.counter;
    }
};
// Note: foo does not define `counter`. 
```

让我们为以 foo 作为原型的对象创建一个构造函数。实际上，所有未处理的都将委托给 foo。

```
var Bar = function(){
    this.counter = 0;
};
Bar.prototype = foo;  // This is how we set up the delegation.

// Some people refer to Bar (a constructor function) as "class".

var bar = new Bar();

console.log(bar.counter);  // 0 --- Comes from bar itself
console.log(bar.property); // 42 --- Not defined in bar, comes from foo

bar.inc();  // Not defined in bar => delegated to foo
bar.inc();
bar.dec();  // Not defined in bar => delegated to foo
// Note: foo.inc() and foo.dec() are called but this === bar
// that is why bar is modified, not foo.

console.log(bar.counter);  // 1 --- Comes from bar itself 
```

让我们`inc()`直接在 bar 上定义：

```
bar.inc = function(){
    this.counter = 42;
};

bar.inc();  // Defined in bar => calling it directly.
            // foo.inc() is not even called.
console.log(bar.counter);  // 42 --- Comes from bar 
```

设置单一继承链：

```
var Baz = function(){
    this.counter = 99;
};
Baz.protype = new Bar();

var baz = new Baz();

console.log(baz.counter); // 99
baz.inc();
console.log(baz.counter); // 100

console.log(baz instanceof Baz);    // true
console.log(baz instanceof Bar);    // true
console.log(baz instanceof Object); // true 
```

整齐，嗯？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-03T00:50:41.713

在担心如何在 JavaScript 中模拟基于类的继承之前，请快速阅读*[JavaScript 中的原型继承](http://javascript.crockford.com/prototypal.html)*。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-18T10:31:26.690

经典继承在灵活性方面存在固有缺陷，因为我们说“这个对象属于这种类型，没有其他类型”。一些语言引入了多重继承来缓解这种情况，但多重继承有其自身的缺陷，因此纯组合优于继承（在静态类型语言中，继承是运行时而不是编译时机制）的好处变得很明显。

将组合的概念提升到这个“纯”级别，我们可以完全消除经典继承以及静态类型。通过在运行时组合对象并将它们用作蓝图（原型方法），我们无需担心通过继承过于紧密地装箱对象，也无需为多重继承方法中固有的问题而负担。

所以原型意味着更灵活的模块开发。

当然，说不用静态类型就很容易开发是另一回事。海事组织，它不是。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T02:31:15.880

好的，首先，原型模型在现实中并没有什么不同。Smalltalk 使用类似的方案。该类是具有类方法的对象。

从类POV来看，一个类实际上是具有相同数据、所有相同方法的对象的等价类；您可以将向原型添加方法视为创建新子类。

实现很简单，但是很难进行有效的类型检查。

# linux - 在shell中获取程序执行时间

> ID：385408
> 
> 赞同：428
> 
> 时间：2008-12-22T02:27:41.067
> 
> 标签：linux, bash, shell

我想在几个不同的条件下在 linux shell 中执行一些东西，并且能够输出每次执行的执行时间。

我知道我可以编写一个 perl 或 python 脚本来做到这一点，但是有没有办法在 shell 中做到这一点？（恰好是bash）

* * *

## 回答 #1

> 赞同：556
> 
> 时间：2008-12-22T02:31:17.440

使用内置`time`关键字：

```
$帮助时间

时间：时间 [-p] 管道
    执行 PIPELINE 并打印实时的摘要，用户 CPU 时间，
    以及在它终止时执行 PIPELINE 所花费的系统 CPU 时间。
    返回状态为PIPELINE的返回状态。`-p' 选项
    以稍微不同的格式打印时序摘要。这使用
    TIMEFORMAT 变量的值作为输出格式。

```

例子：

```
$ time sleep 2 
```

```
实际0m2.009s
用户 0m0.000s
系统 0m0.004s

```

* * *

## 回答 #2

> 赞同：130
> 
> 时间：2008-12-22T02:35:53.407

您可以获得比内置的 bash 更详细的信息`time`（即Robert Gamble 提到的[time(1) ）。](https://web.archive.org/web/20150511041226/http://unixhelp.ed.ac.uk/CGI/man-cgi?time)通常这是`/usr/bin/time`.

^(编者注：为确保您调用的是*外部实用程序* `time`而不是 shell 的`time` *关键字*，请将其调用为`/usr/bin/time`. `time`是[POSIX 授权的实用程序](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/time.html)，但它需要支持的唯一选项是`-p`. 特定平台实现特定的非标准扩展：`-v`与*GNU*的`time`实用程序一起使用，如下所示（问题标记为[linux](/questions/tagged/linux "显示标记为“linux”的问题")）；BSD/macOS 实现用于`-l`产生类似的输出 - 请参阅`man 1 time`.)

详细输出示例：

```
$ /usr/bin/time -v sleep 1
       Command being timed: "sleep 1"
       User time (seconds): 0.00
       System time (seconds): 0.00
       Percent of CPU this job got: 1%
       Elapsed (wall clock) time (h:mm:ss or m:ss): 0:01.05
       Average shared text size (kbytes): 0
       Average unshared data size (kbytes): 0
       Average stack size (kbytes): 0
       Average total size (kbytes): 0
       Maximum resident set size (kbytes): 0
       Average resident set size (kbytes): 0
       Major (requiring I/O) page faults: 0
       Minor (reclaiming a frame) page faults: 210
       Voluntary context switches: 2
       Involuntary context switches: 1
       Swaps: 0
       File system inputs: 0
       File system outputs: 0
       Socket messages sent: 0
       Socket messages received: 0
       Signals delivered: 0
       Page size (bytes): 4096
       Exit status: 0 
```

* * *

## 回答 #3

> 赞同：87
> 
> 时间：2013-07-12T09:30:40.873

```
#!/bin/bash
START=$(date +%s)
# do something
# start your script work here
ls -R /etc > /tmp/x
rm -f /tmp/x
# your logic ends here
END=$(date +%s)
DIFF=$(( $END - $START ))
echo "It took $DIFF seconds" 
```

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2016-10-07T20:01:19.797

对于逐行增量测量，请尝试[gnomon](https://github.com/paypal/gnomon)。

> 一个命令行实用程序，有点像 moreutils 的 ts，用于将时间戳信息添加到另一个命令的标准输出中。对于需要长时间运行的历史记录的长期运行流程很有用。

您还可以使用`--high`and/or`--medium`选项指定以秒为单位的长度阈值，超过该阈值时 gnomon 将以红色或黄色突出显示时间戳。你也可以做一些其他的事情。

[![例子](https://i.stack.imgur.com/lhuCw.gif)](https://i.stack.imgur.com/lhuCw.gif)

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2015-08-28T13:48:31.030

如果您想要更高的精度，请使用`%N`with `date`（并`bc`用于 diff，因为`$(())`只处理整数）。

这是如何做到的：

```
start=$(date +%s.%N)
# do some stuff here
dur=$(echo "$(date +%s.%N) - $start" | bc)

printf "Execution time: %.6f seconds" $dur 
```

例子：

```
start=$(date +%s.%N); \
  sleep 0.1s; \
  dur=$(echo "$(date +%s.%N) - $start" | bc); \
  printf "Execution time: %.6f seconds\n" $dur 
```

结果：

```
Execution time: 0.104623 seconds 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2008-12-22T03:56:39.127

如果您打算稍后使用时间进行计算，请了解如何使用`-f`选项`/usr/bin/time`来输出节省时间的*代码*。这是我最近用来获取和排序整个类学生程序的执行时间的一些代码：

```
fmt="run { date = '$(date)', user = '$who', test = '$test', host = '$(hostname)', times = { user = %U, system = %S, elapsed = %e } }"
/usr/bin/time -f "$fmt" -o $timefile command args... 
```

我后来连接了所有`$timefile`文件并将输出通过管道传输到[Lua 解释器](http://www.lua.org/)。你可以用 Python 或 bash 或任何你喜欢的语法来做同样的事情。我喜欢这种技术。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2017-08-20T16:56:38.690

如果您只需要精确到秒，您可以使用内置`$SECONDS`变量，它计算 shell 已运行的秒数。

```
while true; do
    start=$SECONDS
    some_long_running_command
    duration=$(( SECONDS - start ))
    echo "This run took $duration seconds"
    if some_condition; then break; fi
done 
```

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2017-01-18T20:48:52.610

您可以使用`time`和*subshel​​l* `()`：

```
time (
  for (( i=1; i<10000; i++ )); do
    echo 1 >/dev/null
  done
) 
```

或在同一个外壳中`{}`：

```
time {
  for (( i=1; i<10000; i++ )); do
    echo 1 >/dev/null
  done
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-10-20T05:19:11.703

方法是

```
$ > g++ -lpthread perform.c -o per
$ > time ./per 
```

输出是>>

```
real    0m0.014s
user    0m0.010s
sys     0m0.002s 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-12-24T10:01:26.743

一种可能简单的方法（可能无法满足不同用户的需求）是使用 shell PROMPT。它是一种简单的解决方案，在某些情况下很有用。您可以使用 bash 提示功能，如下例所示：

```
导出 PS1='[\t \u@\h]\$'
```

上述命令将导致将 shell 提示符更改为：

```
[HH:MM:SS 用户名@主机名]$
```

每次运行命令（或按回车键）返回到 shell 提示符时，提示符都会显示当前时间。

**注意：**
**1)**请注意，如果您在输入下一条命令之前等待了一段时间，那么需要考虑这个时间，即 shell 提示符中显示的时间是显示 shell 提示符时的时间戳，而不是您输入命令时的时间戳。一些用户选择在准备好下一个命令之前按 Enter 键以获取带有新时间戳的新提示。
**2)**还有其他可用的选项和修饰符可用于更改 bash 提示符，请参阅 ( man bash ) 了解更多详细信息。

# data-visualization - 用于学习的可视化数据收集

> ID：385419
> 
> 赞同：0
> 
> 时间：2008-12-22T02:31:57.860
> 
> 标签：data-visualization

我刚刚开始对可视化产生兴趣，我想知道我可以从哪里获得一些数据，最好是真实世界，看看我可以从中得出什么查询和图形。创建一些漂亮的数据表示形式更像是一种个人练习。

看到[这个](http://abeautifulwww.com/2007/05/20/visualizing-the-power-struggle-in-wikipedia/)后，我想知道数据来自哪里以及维基百科还能做什么。无论如何我可以从维基百科获取数据吗？

另外，有没有好书推荐？我不相信亚马逊网站上的用户评论 :-)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T02:38:39.830

[您可以从http://download.wikimedia.org](http://download.wikimedia.org)下载原始 Wikipedia 数据。可用数据有许多不同的视图。英语 Wikipedia 是迄今为止最大的数据库，目前还没有完整的转储可用，但正在进行中。可能需要几个月的时间才能完成并可供下载。

最近的一个是 18 GB 压缩，未压缩到 2.5 TB 左右。

一本很棒的书是Edward Tufte[的《定量信息的视觉显示》 。](http://www.edwardtufte.com/tufte/books_vdqi)

# php - PHP中的变量监视

> ID：385420
> 
> 赞同：4
> 
> 时间：2008-12-22T02:34:13.410
> 
> 标签：php, watch

PHP 是否有能力观察变量（或对象属性）并在其值更改时运行函数，类似于[Gecko 的 Javascript`watch`函数](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Global_Objects/Object/Watch)？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T03:01:10.297

[XDebug](http://www.xdebug.org/) *可能*有这个，但我不确定。

如果您尝试调试对象上的成员变量，则可以使用重载：

```
public function __set($var, $val)
{
    if ($var == 'interesting') {
        echo "$var set to: ";
        var_dump($val);
    }
    $this->$var = $val;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T11:55:33.153

当在 Eclipse 之类的 IDE 旁边使用 XDebug 时，这是可能的。

# ios - 了解 EAGLView

> ID：385428
> 
> 赞同：1
> 
> 时间：2008-12-22T02:40:28.640
> 
> 标签：ios, objective-c

我正在查看来自苹果 iphone 示例代码的 EAGLView 文件，并试图了解 EAGLViewDelegate 协议是如何工作的。

问题：

`didResizeEAGLSurfaceForView`这个函数是如何被调用的？我没有看到它的任何实现？

EAGLView.h

```
@protocol EAGLViewDelegate <NSObject>
- (void) didResizeEAGLSurfaceForView:(EAGLView*)view; 
   //Called whenever the EAGL surface has been resized
@end

@interface EAGLView : UIView
{
  @private
    id<EAGLViewDelegate>    _delegate;
}

@property(assign) id<EAGLViewDelegate> delegate; 
```

* * *

EAGLView.m

```
@implementation EAGLView

@synthesize 
    delegate      = _delegate, 

//......
@end 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T02:36:21.580

我假设您指的是 CrashLanding、GLGravity 或 GLPaint 示例，因为这些示例是我可以使用此协议找到的唯一示例。didResizeEAGLSurfaceForView: 方法在 MyEAGLView -_createSurface 方法中被调用。但是，该方法没有在任何地方实现，因为在任何这些示例中都没有为 MyEAGLView 设置委托。

所以不，我不认为你缺少任何东西。这看起来像残留的代码。

# php - Visual Studio 中的 PHP

> ID：385437
> 
> 赞同：0
> 
> 时间：2008-12-22T02:47:33.553
> 
> 标签：php, visual-studio, phalanger

我目前正在使用 Visual Studio 作为我的 IDE 来开发 PHP。我已经安装了 Phalanger Visutal Studio 集成来获取 PHP 项目等，但我希望 VS 能够识别 PHP 开始和结束标记，如标准 ASP 标记。

即，当我`<% %`在 html 编辑器中键入 > 时，我希望 PHP 标记的行为相同`<? ?>`

我摆弄了“标签特定选项”并创建了一个名为？的标签，但它显示结束标签错误，比如`<? /?>`

可以做到吗？

干杯

蒂姆

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-22T03:05:50.023

你可以试试[Vs.php](http://www.jcxsoftware.com/vs.php)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-03-26T23:58:09.037

你也可以试试[PHP Tools for Visual Studio](http://www.devsense.com/products/php-tools)。现在的 Phalanger 集成也建立在它之上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T02:52:46.290

我想我真的不认为 Visual Studio 是编写 PHP 代码的好地方，但也许这只是我。我更愿意使用 DreamWeaver，甚至是 Notepad++（免费），它会进行语法高亮等等。

您是否有特定原因要使用 Visual Studio for PHP？通常 VS 适用于 Microsoft 语言，如 C#、VB、C++、.NET 等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T04:05:23.803

是否有某些特定原因必须使用 VS？如果没有，我强烈建议您尝试使用带有 PDP、Netbeans 或 Aptana 的 Eclipse。这三个都是优秀的*免费*PHP IDE，可扩展并提供专门为 PHP 开发量身定制的版本。

我确实在 .Net 中工作，并且同意 VS 是一个出色的 IDE，但上面列出的替代方案同样具有丰富的功能，并且更适合用 PHP 编码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-01-26T16:27:49.400

在您的 VS 标准版或更高版本上使用 VS.php

# sql - SQL 编号列 - MySQL

> ID：385441
> 
> 赞同：5
> 
> 时间：2008-12-22T02:53:46.803
> 
> 标签：sql, mysql

这是一个sql新手问题。

基本上，我想要一个额外的列与我的选择语句一起返回以对行进行编号。我正在使用mysql。

例如：

```
select * from friends

David
Steve
Joe 
```

获取的语法是什么：

```
1  David
2  Steve
3  Joe 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-22T03:04:03.023

来自： http: [//markmal.blogspot.com/2006/04/oracle-like-rownum-in-mysql.html](http://markmal.blogspot.com/2006/04/oracle-like-rownum-in-mysql.html)

```
SELECT @rownum:=@rownum+1 rownum, t.*FROM (SELECT @rownum:=0) r, mytable t; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T02:58:07.200

在 SQL Server 2005 及更高版本中，您可以使用[Row_Number](http://msdn.microsoft.com/en-us/library/ms186734.aspx)函数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T04:10:05.823

如果您正在开发一些应用程序，最好从结果集或数据集或您用来保存结果的任何容器中获取记录数。基本思想是在您的代码中执行此操作。否则，保罗解决方案将适用于您的情况。

在 MySql 中，没有像我们在 Oracle 中拥有的 ROWNUM 那样的东西，也没有我们在 MS SQL Server 中拥有的 Row_Number()，也没有任何其他变体。

**编辑：**

通过在您的代码中执行此操作，您无需更改您的 SQL 语句，如果底层数据库发生更改，正是因为这个原因。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T02:58:12.923

我将在存储过程中执行此操作

```
CREATE TABLE #Foo (
        [FooId] [int] IDENTITY(1,1) NOT NULL,
        [Name] varchar(255)
)

SELECT *
FROM Friends
INTO #Foo

SELECT *
FROM #Foo 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T03:40:15.507

您可能已经从收到的不同回复中猜到了，答案取决于您使用的 DBMS。但是，答案通常涉及 ROWNUM 或该拼写的变体。

标准的 SQL 答案可能是 ROW_NUMBER() - @YonahW 提到的；它作为一个窗口函数工作，并非在所有 DBMS 中都可用。

# wcf - WCF RESTful POST

> ID：385451
> 
> 赞同：2
> 
> 时间：2008-12-22T03:02:24.103
> 
> 标签：wcf, rest

我有这样声明的 WCF RESTFul 服务：

```
[ServiceContract]
public interface IGasPriceService
{
    [OperationContract]
    [WebGet
        (ResponseFormat = WebMessageFormat.Xml,
        BodyStyle = WebMessageBodyStyle.Bare,
        UriTemplate = "/GetGasPrice/For/ZipCode/{zipCode}"
        )]
    GasPriceData GetPriceData(string zipCode);

    [OperationContract]
    [WebGet
        (RequestFormat = WebMessageFormat.Xml,
        ResponseFormat = WebMessageFormat.Xml,
        BodyStyle = WebMessageBodyStyle.Bare,
        UriTemplate = "/GetGasPrice/For/City/{city}"
        )]
    GasPriceData GetPriceDataForCity(string city);

    [OperationContract]
    [WebInvoke
        (Method = "POST",
        RequestFormat = WebMessageFormat.Xml,
        UriTemplate = "/SetGasPrice/For/ZipCode/{zipCode}/Price/{price}"
        )]
    void SetPriceDataForZipCode(string zipCode, string price);
} 
```

GetPriceData 和 GetPriceDataforCity 方法有效，但 SetPriceDataForZipCode 无效。任何人都可以让我知道为什么这不起作用。

当我发出如下请求时：

[http://localhost:7002/SetGasPrice/For/ZipCode/45678/7.80](http://localhost:7002/SetGasPrice/For/ZipCode/45678/7.80)

我得到的信息是：

```
EndPoint Not Found 
```

任何想法如何解决这一问题？

* * *

我把它改成

[http://localhost:7002/SetGasPrice/For/ZipCode/54568/5.788](http://localhost:7002/SetGasPrice/For/ZipCode/54568/5.788)

和

```
 [OperationContract]
    [WebInvoke
        (Method = "POST",
        RequestFormat = WebMessageFormat.Xml,
        UriTemplate = "/SetGasPrice/For/ZipCode/{zipCode}/{price}"
        )]
    void SetPriceDataForZipCode(string zipCode, string price); 
```

这给了我信息：

不允许的方法。

任何想法如何解决这个问题？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T03:06:46.573

您的网址必须是：

```
 http://localhost:7002/SetGasPrice/For/ZipCode/45678/Price/7.80 
```

或者您需要将模板更改为：

```
"/SetGasPrice/For/ZipCode/{zipCode}/{price}" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T04:31:46.330

尝试

```
UriTemplate = "/SetGasPrice/For/ZipCode/{zipCode}/{dollars}.{cents}" 
```

# dll - 存储和引用 DLL 库的最佳实践？

> ID：385469
> 
> 赞同：27
> 
> 时间：2008-12-22T03:21:02.723
> 
> 标签：dll, version-control

通常，我团队中的开发人员会创建一个新的 Visual Studio 项目并在其本地机器上的某处引用一个 DLL（例如，C:\mydlls\homersimpson\test.dll）。然后，当我从源代码控制存储库中获取项目时，我无法构建项目，因为我的机器上的完全相同位置没有引用的 dll。

存储和引用共享库的最佳实践是什么？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-22T03:37:07.870

我通常在我的项目中创建一个 lib 文件夹，其中放置了引用的 dll。然后我将引用指向 lib 文件夹中的 dll。这样，每个开发人员都可以在从源代码管理中检索后构建项目。

如果它是内部构建的项目，您还可以将该项目添加到您的解决方案中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-22T03:34:52.430

如果程序集不在 GAC 中，请创建一个名为 dependencies 的目录并在其中添加所有程序集。文件夹和程序集被添加到源代码管理中。规则是，给定源代码控制中的任何项目，构建所需的只是进行签出并构建项目（或运行一些也签入项目的工具）。

如果您将文件夹添加到解决方案并将程序集添加到解决方案文件夹，这也会为开发人员提供一个视觉提示，指示存在哪些外部依赖项......所有依赖项都在该目录中。相对路径确保 Visual Studio 可以毫无问题地找到引用。

对于拥有 20 多个项目的大型解决方案，这让生活变得更加轻松！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-22T03:28:25.720

我期望的最佳实践是让您的 SC 存储库为您包含并强制执行引用对象的相对位置（通常通过共享路径），因此您不会直接处理此问题。原始开发人员应检查此信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T03:38:57.273

如果您将实际的 DLL 签入到源代码管理中，那么您可以通过相对路径引用它们，并且所有开发人员在下次更新项目时将自动获取任何依赖项。

通过完整路径添加 DLL 引用将是开发人员错误，就像通过完整路径添加源文件将是错误一样。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T04:49:50.767

**经验法则**：如果项目不是解决方案的一部分，请从解决方案的源代码控制树下的源代码控制 /binshare 或 /lib 目录引用已发布的 dll。所有外部依赖项都应该有版本化的 DLL，这些 DLL 位于 /binshare 目录中。

我了解您的同事在方便方面所做的事情。但是，该开发人员的方法与正确的配置/构建管理截然相反。

示例：如果您在应用程序中使用 MS 数据应用程序块作为依赖项，您应该引用正确发布的二进制文件，而不是从 MS 的开发源主干获取最新的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-02-23T23:04:48.300

我认为这种方法与我认为的最佳实践完全相反。我认为将第三方二进制文件排除在源存储库之外并通过构建过程中的 Maven 存储库之类的方式引用它们会是一种更好的方法。将 dll 放入源存储库会不必要地膨胀存储库的内容，并导致获取项目的时间比必要的要长得多。它还通过不按名称引用版本，而是通过引用存储在项目 lib 文件夹中的特定版本的 dll 来隐含对第三方二进制文件版本的独立管理。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-11-30T09:19:17.700

为什么不设置私有 NuGet 提要？这样，依赖项（NuGet 存储库）只有一个副本，并且多个项目可以引用它。依赖项的多个版本可以共存，如果需要，每个项目可以引用不同的版本。此外，TFS Build 可以在构建时恢复包。

配置 VS：[https ://www.visualstudio.com/en-us/docs/package/nuget/consume](https://www.visualstudio.com/en-us/docs/package/nuget/consume)

# c# - 如何限制并发进程数？

> ID：385497
> 
> 赞同：2
> 
> 时间：2008-12-22T03:44:39.163
> 
> 标签：c#

我的情况如下：

1.  我有一个只能启动固定次数（少于 50 次）的应用程序。
2.  由于业务需要，不允许使用单独的中央流程来管理其他流程。（即，如果一个只涉及应用程序进程的好解决方案仍然可以接受）
3.  我正在使用 C# 开发应用程序，因此首选托管解决方案。
4.  我必须处理“意外”情况，例如可以使用 TaskManager 终止进程。

我正在考虑使用系统范围互斥锁的解决方案。但是，它不能很好地在“意外”情况下幸存下来，因为它会留下“被遗弃的”互斥体。如果这是一个好方法，请问“忽略”放弃的互斥锁有什么问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T03:49:34.460

一种方法是查询进程列表并计算当前活动的实例数。另一种更复杂的方法是广播 UDP 并计算响应的数量。我已将此模式用于与作业处理器相关的分布式场景。

高温高压

科尔比非洲

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T04:06:43.473

您可以使用共享内存段并在每次打开应用程序时增加计数，并在应用程序关闭时减少计数。一种更简单的方法可能是使用您在问题中提到的进程间信号量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T06:14:42.293

当进程通过“意外”事件终止时，例如任务管理器进程终止，它应该抛出 ThreadAbortException。您真的应该尝试将您的互斥锁包含在某种 try / finally 中，这将允许您在线程中止时释放它。

我不是 100% 确定这是真的，但应该有某种方法来应对这种情况。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T06:22:25.040

扩展进程列表方法，使用带有*C#的*[WMI.NET](http://msdn.microsoft.com/en-us/library/bb404655.aspx)可能如下所示：

 *```
using System;
using System.Collections.Generic;
using System.Collections.Specialized;
using System.Text;
using System.Management;

namespace WmiProc
{
    class Program
    {
        static void Main(string[] args)
        {
            ManagementScope ms = new System.Management.ManagementScope(
                @"\\myserver\root\cimv2");

            var oq = new System.Management.ObjectQuery(
                "SELECT * FROM Win32_Process where Name='myprocname'");
            ManagementObjectSearcher query1 = new ManagementObjectSearcher(ms, oq);
            ManagementObjectCollection procsCollection = query1.Get();
            Console.WriteLine("process count:{0}", procsCollection.Count);
        }
    }
} 
```

编辑：开始时间会有一些分离，因此不太可能让太多进程同时运行。您必须测试环境中的特定行为。

也许您可以定期检查来自单独（长期运行）进程的进程计数，并根据某些标准（例如最新）终止多余的进程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-07-09T20:50:13.600

我无法向上述答案添加评论，但通过阅读上述答案和评论，您似乎应该能够将互斥锁与流程实例检查结合起来。

```
// You can use any System wide mutual exclusion mechanism here
bool waitAndLockMutex();
void unlockMutex();

// returns the number of processes who use the specified command
int getProcessCount();

void main() {
    try {
        waitAndLockMutex();
        if (getProcessCount() > MAX_ALLOWED)
            return;

        doUsualWork();

    } finally {
        unlockMutex();
    }
} 
```

请注意，上述代码仅用于说明目的，声明函数调用的主体可以使用 .NET 轻松编写

编辑：

如果您不想走计算感兴趣进程的路线，可以使用全局互斥锁。不确定 .NET 是否公开了这一点。但要点是您可以获取所有互斥锁直到 MAX，并且在此过程中，如果您获得尚未创建或已放弃的互斥锁，那么您继续让进程启动，否则退出说超过最大计数

```
void main() {
    for (int i = 0; i < MAX; ++i) {
        int status = TryToAcquireMutex("mutex" + i);
        continue if (status == locked);
        if (status == success || status == WAIT_ABANDONED) {
            doUsusalWork();
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T09:32:59.663

好吧，您可以使用命名互斥体实例。

为互斥体使用个人命名方案，请求此名称并检查已创建具有此名称的互斥体的结果。

如果您使用带有增量元素的命名方案，您可以尝试所有互斥锁名称升序您的增量元素，并像这样计算创建了多少互斥锁。

仍然需要在处理已释放的互斥锁方面进行一些改进，但这似乎微不足道。

```
class Program
{
    private static Mutex mutex = null;

    static void Main(string[] args)
    {
        AppDomain.CurrentDomain.ProcessExit += new EventHandler(CurrentDomain_ProcessExit);

        int count = Program.CheckInstanceCount();
        Console.WriteLine("This is instance {0} running.", count);
        Console.Read();
    }

    static void CurrentDomain_ProcessExit(object sender, EventArgs e)
    {
        Program.mutex.ReleaseMutex();
        Program.mutex.Close();
    }

    private static int CheckInstanceCount()
    {
        int result = 0;
        bool created = false;

        for (int i = 0; i < 50; i++)
        {
            /* try to create a mutex with this name, 
             * if it does exist, another instance 
             * of this program is running
             */
            mutex = new Mutex(true, string.Concat(AppDomain.CurrentDomain.FriendlyName, i.ToString()), out created);
            if (created)
            {
                // this instance is instance #i currently running
                result = i;
                break;
            }
        }
        return result;
    }
} 
```

# optimization - 什么时候优化还为时过早？

> ID：385506
> 
> 赞同：87
> 
> 时间：2008-12-22T03:50:10.650
> 
> 标签：optimization, premature-optimization

正如高德纳所说，

> 我们应该忘记小的效率，比如大约 97% 的时间：过早优化是万恶之源。

这是 Stack Overflow 对“哪个是最有效的循环机制”、“SQL 优化技术？”等问题的回答中经常出现的问题。（[等等](http://www.google.com/search?q=site%3Astackoverflow.com+%22premature+optimization%22)）。这些优化提示问题的标准答案是分析您的代码并首先查看它是否有问题，如果不是，则不需要您的新技术。

我的问题是，如果一种特定的技术不同但不是特别模糊或混淆，那真的可以被认为是过早的优化吗？

这是 Randall Hyde 的一篇相关文章，名为*[The Fallacy of Premature Optimization](http://ubiquity.acm.org/article.cfm?id=1513451)*。

* * *

## 回答 #1

> 赞同：113
> 
> 时间：2008-12-22T04:06:56.453

Don Knuth 发起了*[文学编程](http://www.literateprogramming.com/)*运动，因为他认为**计算机代码最重要的功能是将程序员的意图传达给人类读者**。任何以性能为名使代码更难理解的编码实践都是过早的优化。

以优化的名义引入的某些成语已经变得如此流行，以至于**每个人都理解它们**并且它们已经成为*预期*，而不是为时过早。例子包括

*   在 C 中使用**指针算术而不是数组表示法**，包括使用这样的习语

    ```
    for (p = q; p < lim; p++) 
    ```

*   **将全局变量重新绑定到**Lua 中的局部变量，如

    ```
    local table, io, string, math
        = table, io, string, math 
    ```

除了这些习语，**走捷径后果自负**。

所有优化都为时过早，除非

*   **一个程序太慢了**（很多人忘记了这部分）。

*   你有一个**测量**（配置文件或类似的）表明**优化可以改善事情**。

（也可以针对内存进行优化。）

直接回答问题：

*   如果您的“不同”技术**使程序更难理解**，那么**它就是过早的优化**。

* * *

**编辑**：作为对评论的回应，**使用快速排序而不是像插入排序这样更简单的算法是****每个人都理解和期望的习语**的另一个例子。（尽管如果您编写自己的排序例程而不是使用库排序例程，希望您有一个*很好*的理由。）

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-12-22T09:06:01.747

恕我直言，90% 的优化应该发生在设计阶段，基于感知的当前，更重要的是，未来的需求。如果您因为应用程序无法扩展到所需的负载而不得不取出分析器，那么您已经太晚了，IMO 将浪费大量时间和精力，而无法纠正问题。

通常，唯一值得的优化是那些在速度方面为您带来数量级的性能改进，或者在存储或带宽方面的乘数。这些类型的优化通常与算法选择和存储策略有关，并且极难逆转到现有代码中。它们可能会影响您实现系统的语言的决定。

所以我的建议是，尽早优化，根据您的要求，而不是您的代码，并着眼于您的应用程序可能的延长寿命。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2008-12-22T05:13:15.040

如果你还没有分析过，那还为时过早。

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2008-12-22T04:02:10.020

> 我的问题是，如果一种特定的技术不同但不是特别模糊或混淆，那真的可以被认为是过早的优化吗？

嗯...所以你手头有两种技术，成本相同（使用、阅读、修改的努力相同），一种更有效。不，在这种情况下，使用更有效的方法不会为时过早。

中断您的代码编写以寻找常见编程结构/库例程的替代方案，即使您知道您正在编写的内容的相对速度实际上并不重要，但可能会有更有效的版本挂在某个地方。 ..*这*还为时过早。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-11-23T22:27:53.930

这是我在避免过早优化的整个概念中看到的问题。

说和做之间有脱节。

我做了很多性能调优，从原本设计良好的代码中挤出大量因素，似乎没有过早优化。 [这是一个例子。](https://stackoverflow.com/questions/926266/performance-optimization-strategies-of-last-resort/927773#927773)

在几乎所有情况下，性能欠佳的原因都是我所说的**泛泛性**，即使用抽象的多层类和彻底的面向对象设计，其中简单的概念不太*优雅*，但完全足够了。

而在讲授这些抽象设计概念的教材中，比如通知驱动的架构、信息隐藏等，只要简单地设置一个对象的布尔属性就可以产生无限的活动连锁反应，给出的理由是什么？***效率***。

*那么，这是否是过早的优化？*

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-12-22T09:46:34.690

首先，让代码工作。其次，验证代码是否正确。第三，要快。

在第 3 阶段之前完成的任何代码*更改*都为时过早。我不完全确定如何对之前做出的设计选择进行分类（比如使用非常适合的数据结构），但我更倾向于使用易于编程的抽象，而不是那些性能良好的抽象，直到我在一个阶段，我可以开始使用分析并拥有一个正确的（虽然通常很慢）参考实现来比较结果。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-12-22T16:20:21.340

从数据库的角度来看，在设计阶段不考虑优化设计充其量是鲁莽的。数据库不容易重构。一旦它们设计不佳（这是一个不考虑优化的设计，无论您如何试图隐藏过早优化的废话），几乎永远无法从中恢复，因为数据库对整个系统的运行。考虑到您所期望的情况的最佳代码，正确设计的成本要低得多，而不是等到有一百万用户并且人们因为您在整个应用程序中使用游标而尖叫。其他优化，例如使用 sargeable 代码、选择看起来最好的索引等，只有在设计时才有意义。快速和肮脏被称为是有原因的。因为它永远不能很好地工作，所以不要用快速来代替好的代码。同样坦率地说，当您了解数据库中的性能调优时，您可以编写更有可能在相同时间内或更少时间内执行良好的代码，而不是编写性能不佳的代码。不花时间去学习什么是好的数据库设计是开发人员的懒惰，而不是最佳实践。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-12-22T13:04:07.553

您似乎在谈论的是优化，例如使用基于散列的查找容器与索引容器（如数组），此时将完成大量键查找。这*不是*过早的优化，而是您应该在设计阶段决定的事情。

Knuth 规则所涉及的优化类型是最小化最常见代码路径的长度，优化运行最多的代码，例如在汇编中重写或简化代码，使其不那么通用。但是，除非您确定代码的哪些部分需要这种优化，否则这样做是没有用的，并且优化会（可能？）使代码更难理解或维护，因此“过早的优化是万恶之源”。

Knuth 还说，改变程序使用的算法和解决问题的方法总是比优化更好。例如，虽然稍作调整可能会使您的优化速度提高 10%，但从根本上改变程序的工作方式可能会使其速度提高 10 倍。

回应在这个问题上发布的许多其他评论：算法选择！=优化

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-12-22T04:05:36.987

格言的要点是，*通常*，优化是复杂而复杂的。*通常*，架构师/设计师/程序员/维护人员需要清晰简洁的代码才能了解正在发生的事情。

如果特定优化清晰简洁，请随意尝试（但请返回并检查该优化是否有效）。关键是在整个开发过程中保持代码清晰和简洁，直到性能的好处超过编写和维护优化的成本。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-12-22T05:43:54.400

我尝试仅在确认性能问题时进行优化。

我对过早优化的定义是“将精力浪费在未知的性能问题上”。绝对有优化的时间和地点。但是，诀窍是仅在对应用程序性能重要且额外成本超过性能损失的地方花费额外成本。

在编写代码（或数据库查询）时，我努力编写“高效”代码（即，以合理的最简单逻辑快速且完全执行其预期功能的代码。）请注意，“高效”代码不一定与“优​​化”代码相同代码。优化通常会在代码中引入额外的复杂性，从而增加该代码的开发和维护成本。

我的建议：尝试仅在可以量化收益时才支付优化成本。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-12-22T09:17:13.707

编程时，许多参数至关重要。其中包括：

*   可读性
*   可维护性
*   复杂
*   鲁棒性
*   正确性
*   表现
*   开发时间

优化（追求性能）通常以牺牲其他参数为代价，并且必须与这些领域的“损失”相平衡。

当您可以选择性能良好的知名算法时，预先“优化”的成本通常是可以接受的。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-12-24T21:07:12.617

优化可以发生在不同的粒度级别，从非常高的级别到非常低的级别：

1.  从良好的架构、松耦合、模块化等开始。

2.  为问题选择正确的数据结构和算法。

3.  优化内存，尝试在缓存中容纳更多代码/数据。内存子系统比 CPU 慢 10 到 100 倍，如果您的数据被分页到磁盘，它会慢 1000 到 10,000 倍。与优化单个指令相比，对内存消耗保持谨慎更有可能带来重大收益。

4.  在每个函数中，适当地使用流控制语句。（将不可变表达式移到循环体之外。将最常见的值放在开关/案例中，等等）

5.  在每个语句中，使用产生正确结果的最有效的表达式。（乘法与移位等）

挑剔是使用除法表达式还是移位表达式*不一定是*过早的优化。如果你没有首先优化架构、数据结构、算法、内存占用和流量控制，那还为时过早。

当然，如果您不定义目标性能阈值，*任何优化都为时过早。*

在大多数情况下，要么：

A）您可以通过执行高级优化来达到目标​​性能阈值，因此不必摆弄表达式。

或者

B) 即使在执行了所有可能的优化之后，您也不会达到您的目标性能阈值，并且低级优化在性能上没有产生足够的差异来证明可读性的损失是合理的。

以我的经验，大多数优化问题都可以在架构/设计或数据结构/算法级别解决。经常（尽管不总是）需要优化内存占用。但是很少需要优化流控制和表达逻辑。在那些确实有必要的情况下，它很少是足够的。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-12-22T08:08:09.023

诺曼的回答非常好。不知何故，你经常做一些“过早的优化”，实际上是最佳实践，因为众所周知，这样做是完全低效的。

例如，要添加到 Norman 的列表：

*   在 Java（或 C# 等）中使用 StringBuilder 连接而不是 String + String（在循环中）；
*   避免像 C 一样循环：（`for (i = 0; i < strlen(str); i++)`因为这里的 strlen 是一个每次遍历字符串的函数调用，在每个循环上调用）；
*   似乎在大多数 JavaScript 实现中，它也更快，`for (i = 0 l = str.length; i < l; i++)`并且仍然可读，所以没问题。

等等。但是这种微优化绝不应该以牺牲代码的可读性为代价。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-12-22T13:14:46.893

对于极端情况，应该保留使用分析器的需要。项目的工程师应该知道性能瓶颈在哪里。

我认为“过早的优化”是非常主观的。

如果我正在编写一些代码并且我*知道*我应该使用哈希表，那么我会这样做。我不会以某种有缺陷的方式实现它，然后等待一个月或一年后有人遇到问题时收到错误报告。

重新设计比从一开始就以明显的方式优化设计成本更高。

显然，第一次会错过一些小事情，但这些很少是关键的设计决策。

因此：不优化设计本身就是 IMO 的代码气味。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2017-12-22T04:52:01.507

值得注意的是，Knuth 的原始引述来自他撰写的一篇论文，该论文提倡`goto`在精心挑选和测量的区域中使用作为消除热点的一种方式。`goto`他的引用是他添加的一个警告，以证明他使用以加速这些关键循环的理由。

> [...] 再次，如果 n 的平均值约为 20，并且如果搜索例程在程序中执行大约一百万次左右，这将显着节省整体运行速度。这种循环优化 [使用**`gotos`**] 不难学习，而且正如我所说，它们只适用于程序的一小部分，但它们通常会产生大量节省。[...]

并继续：

> 当今许多软件工程师所共有的传统智慧要求忽略小规模的效率。但我相信这只是对他们看到的一分钱一磅的愚蠢程序员所实施的滥用行为的过度反应，他们无法调试或维护他们的“优化”程序。在已建立的工程学科中，12% 的改进很容易获得，但绝不会被认为是微不足道的；我相信同样的观点应该在软件工程中占上风。当然，我不会费心在一次性工作上进行这样的优化，但是当涉及到准备质量程序的问题时，我不想将自己限制在拒绝我这种效率的工具[即，**`goto`** 在这种情况下的陈述]。

请记住他如何在引号中使用“优化”（该软件可能实际上效率不高）。另请注意，他不仅批评了这些“一分钱一分货”的程序员，还批评了那些建议您始终忽略小的低效率的人。最后，到经常被引用的部分：

> 毫无疑问，效率的圣杯会导致滥用。程序员浪费大量时间来思考或担心程序中非关键部分的速度，而在考虑调试和维护时，这些提高效率的尝试实际上会产生强烈的负面影响。我们应该忘记小的效率，比如说 97% 的时间；过早的优化是万恶之源。

...然后更多地了解分析工具的重要性：

> 对程序的哪些部分真正关键做出先验判断通常是错误的，因为一直使用测量工具的程序员的普遍经验是，他们的直觉猜测失败了。在使用这些工具七年之后，我确信从现在开始编写的所有编译器都应该设计为向所有程序员提供反馈，表明他们程序的哪些部分成本最高；事实上，这个反馈应该是自动提供的，除非它被特别关闭。

人们到处都在滥用他的引用，当他的整篇论文都在提倡微优化时，经常暗示微优化还为时过早！他批评的一群人回应了这种“传统智慧”，因为他总是忽略小事的效率，他们经常滥用他的引言，该引述最初是针对那些不鼓励所有形式的微优化的类型的人。 .

然而，当经验丰富的手持分析器使用时，它是支持*适当应用微优化的引用。*今天的类比等价物可能是，*“人们不应该盲目地优化他们的软件，但是自定义内存分配器在应用于关键领域以提高引用的局部性时会产生巨大的影响”，*或者，“*使用SoA rep 真的很难维护，你不应该到处使用它，但是如果由有经验和有指导的人适当地应用，它会更快地消耗内存。* ”

每当您尝试像 Knuth 上面所宣传的那样推广精心应用的微优化时，最好加入免责声明，以阻止新手过于兴奋和盲目地尝试优化，例如重写他们的整个软件以使用`goto`. 这部分是他正在做的。他的引述实际上是一个大免责声明的一部分，就像骑摩托车跳过燃烧的火坑的人可能会添加一个免责声明，即业余爱好者不应该在家里尝试这个，同时批评那些在没有适当知识和设备的情况下尝试并受伤的人.

他认为“过早的优化”是那些实际上不知道自己在做什么的人所应用的优化：不知道优化是否真的需要，没有使用适当的工具进行衡量，也许不了解优化的本质他们的编译器或计算机架构，最重要的是，是“一分钱一磅的傻瓜”，这意味着他们忽略了优化（节省数百万美元）的大好机会，试图捏捏便士，而在创建代码的同时，他们无法做到更有效地调试和维护。

如果您不属于“一分钱一磅的愚蠢”类别，那么即使您使用 a`goto`来加速关键循环（这不太可能） ，您也不会过早按照 Knuth 的标准进行优化对当今的优化器有很大帮助，但如果确实如此，并且在真正关键的领域，那么您就不会过早地进行优化）。如果您实际上将您正在做的任何事情应用到真正需要的领域并且他们真正从中受益，那么您在 Knuth 眼中就做得很好。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-12-22T04:06:38.933

对我来说，过早的优化意味着在你拥有一个工作系统之前，在你真正分析它并知道瓶颈在哪里之前，尝试提高你的代码效率。即使在那之后，在许多情况下，可读性和可维护性也应该先于优化。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-12-22T04:36:32.260

我不认为公认的最佳实践是过早的优化。更多的是关于根据使用场景在潜在性能问题的假设上花费时间。一个很好的例子：如果你花了一周时间试图优化一个对象的反射，在你证明它是一个瓶颈之前你过早地优化了。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-12-22T05:50:56.210

除非您发现由于用户或业务需要而需要提高应用程序的性能，否则几乎没有理由担心优化。即便如此，在你分析你的代码之前不要做任何事情。然后攻击最耗时的部分。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-12-22T05:37:24.007

我的看法是，如果您在不知道在不同情况下可以获得多少性能的情况下优化某些东西，那么这就是过早的优化。代码的目标应该是让人类更容易阅读。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-12-22T11:43:22.367

正如我在类似问题上发布的那样，优化规则是：

**1）不要优化**

**2）（仅供专家）稍后优化**

什么时候优化还为时过早？通常。

异常可能在您的设计中，或者在大量使用的封装良好的代码中。在过去，我研究过一些时间关键代码（一个 RSA 实现），其中查看编译器生成的汇编器并在内部循环中删除一条不必要的指令可以提高 30% 的速度。但是，使用更复杂的算法所带来的加速比这要高出几个数量级。

优化时要问自己的另一个问题是*“我是否在做相当于优化 300 波特调制解调器的工作？”* . 换句话说，摩尔定律是否会在不久之后使您的优化变得无关紧要。只需在问题上投入更多硬件，就可以解决许多缩放问题。

最后但同样重要的是，在程序运行太慢之前进行优化还为时过早。如果它是您正在谈论的 Web 应用程序，您可以在负载下运行它以查看瓶颈在哪里 - 但您可能会遇到与大多数其他站点相同的扩展问题，并且将应用相同的解决方案。

*编辑：顺便说一句，关于链接的文章，我会质疑所做的许多假设。首先，摩尔定律在 90 年代停止工作是不正确的。其次，用户的时间比程序员的时间更有价值这一点并不明显。大多数用户（至少可以说）无论如何都不会疯狂地使用每个可用的 CPU 周期，他们可能正在等待网络做某事。另外，当程序员的时间从实现其他事情上转移到用户打电话时程序所做的事情上，这会产生机会成本。任何比这更长的时间通常都不是优化，而是错误修复。*

# agile - Scrum 敏捷和 RUP 之间有什么关系？

> ID：385511
> 
> 赞同：13
> 
> 时间：2008-12-22T03:56:57.127
> 
> 标签：agile, scrum, rup, rational-unified-process

[RUP 与 Scrum 的对话](http://www-128.ibm.com/developerworks/rational/library/feb05/krebs/)

敏捷与 RUP 之间存在关系。实际上，我认为敏捷开发是一种 RUP。在上面来自 IBM 的文章中，您可以看到他们正在将模型拟合到 RUP。

有人对这三个有趣概念之间的关系有任何**实际的解释吗？**

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-14T14:04:09.653

敏捷是 XP、Scrum、Crystal、DSDM、FDD 等方法的总称，它们具有[共同的原则](http://agilemanifesto.org/principles.html)。[Unified Process](http://en.wikipedia.org/wiki/Unified_Process)是一个可以用来描述开发过程的框架，RUP[是](http://en.wikipedia.org/wiki/IBM_Rational_Unified_Process)一个基于 Rational 工具的 UP 实例。UP 早于大多数敏捷方法，可能会或可能不会被视为敏捷。它们的共同点是敏捷方法和 UP 都是**迭代和增量开发**(IID) 方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-11-15T20:18:44.063

RUP 是一个全面的迭代和增量过程模板。您创建一个“开发案例”，告知您在开发流程实例中需要哪些流程组件。然后，您从 RUP 中提取所需的过程组件，例如从菜单中挑选项目。

“敏捷”是一个概括性术语，它描述了基于以下命题的过程集：软件开发是一个*学习*过程而不是一个定义的过程，并且大多数重要的工件和实践都会阻碍学习过程。

SCRUM 是一个特定的敏捷项目管理过程。它没有规定如何实际设计和开发正在构建的系统。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-22T17:41:40.160

敏捷是一种软件开发方法：

（引自[敏捷联盟](http://www.agilealliance.org/home)网站）

> **[什么是敏捷软件开发](http://www.agilealliance.org/show/2)？**
> 
> 在 1990 年代后期，几种方法开始受到越来越多的公众关注。每个人都有旧观念、新观念和转变的旧观念的不同组合。但他们都强调程序员团队和业务专家之间的密切合作；面对面交流（比书面文件更有效）；频繁交付新的可部署业务价值；紧密的、自组织的团队；以及编写代码和团队的方法，以使不可避免的需求流失不是危机。

Scrum 和 RUP 是可以实现敏捷软件开发的特定软件开发方法。这些方法（以及其他方法，例如 XP）并不相互排斥，并且可以以多种方式组合以定制适合特定项目的敏捷过程。这是一篇[很好的文章](http://www.agilealliance.org/show/1194)，描述了如何组合这些方法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-22T19:41:33.773

敏捷和 RUP 是分开发展的，RUP 在 UML 的基础上，现在 IBM 正试图赶上敏捷浪潮，因为 RUP 没有 [更多] 大的嗡嗡声。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-12-03T13:45:19.593

好吧，RUP 是实践的“汤”……你应该定制它来喝你“自己”的汤……否则它会“杀死”你的项目……

*   在敏捷项目管理中，实践改编自复杂自适应动态系统理论……它与“人”有一种温柔的接触……RUP 对项目管理的“人件”并没有多说……
*   敏捷方法谈论“紧急”架构... RUP 以架构为中心的地方... 希望您首先建立稳定的架构。

但是您可以以敏捷的方式应用 RUP...或者您可以从中获取/窃取许多技术实践（汤增量/食谱）...

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-22T04:52:08.827

它们都是看起来相似的迭代模型，但它们都有很大的不同。RUP 是组织和团队的框架，而 Scrum 是为具有严格指导方针的产品团队而设计的。

我建议您阅读以下内容： [SCRUM](http://en.wikipedia.org/wiki/Scrum_%28development%29) [RUP](http://en.wikipedia.org/wiki/IBM_Rational_Unified_Process)

# linq - LINQ - 更新空整数数据字段

> ID：385512
> 
> 赞同：0
> 
> 时间：2008-12-22T03:57:57.780
> 
> 标签：linq, null, linq-to-entities, field

当我设置时，我有一个数据类型为`int?`price 的字段并允许 null

```
book.price = null; 
```

和更新，它不会被保存，也不会抛出任何异常，当我改变值#null时，就可以了。我想将其设置为空。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-22T04:19:58.767

确保该字段在数据库中可以为空，并在 dbml 中反映。为确保重新生成表的 dbml。（从 dbml 中删除表并再次添加）

我只能说它对我们有用，所以这很奇怪。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T06:59:40.407

我不知道我理解这个问题，这部分不清楚：

> “当我改变值 #null 时，没关系”

你确定打电话

```
db.SaveChanges(); 
```

（其中 [db] 是您的 Entites 对象的名称）这是我经常犯的一个简单错误：P

# iphone - 缺少 AVFoundation.framework

> ID：385530
> 
> 赞同：7
> 
> 时间：2008-12-22T04:07:26.903
> 
> 标签：iphone, cocoa-touch

`AVFoundation.framework`不是文档所说的位置。我安装了 iPhone SDK 2.2（从未安装过以前的 sdk 版本），但在下面找不到该文件夹`/System/Library/Frameworks`

我确实在下面找到了

```
 /Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS2.2.sdk/System/Library/Frameworks/ 
```

文件夹，但如果我从该位置添加它，那么编译器将找不到头文件。我尝试将整个`AVFoundation.framework`文件夹复制到`/System/Library/Framework`，但仍然找不到头文件。

如何使用`AVFoundation`课程？

谢谢，亚历克斯

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-22T09:01:47.807

我在我的代码中使用了 AVFoundation 类，并以与您相同的方式添加它。由于某些未知原因，您无法浏览标头，但是将其放在您的类头文件中编译就好了：

```
#import <AVFoundation/AVAudioPlayer.h> 
```

我已经提交了我的应用程序并获得了批准，所以我认为这种方法没有任何问题。XCode 中的 AVFoundation 引用仍然是红色的，但它似乎工作正常。删除框架引用会导致编译错误，所以它肯定需要存在。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-24T07:02:36.297

我遇到了各种各样的问题，直到我意识到我也必须将“活动可执行文件”更改为“iPhone Simulator 2.2”。这是我采取的步骤：

将`AVFoundation`框架添加到您的项目中。按住 Ctrl 键单击 Frameworks 文件夹并选择“**添加现有框架**”。" " 中的默认框架目录`/System/Frameworks`可能不包含新的 AVFoundation 框架文件，因此您需要深入 iPhone SDK 目录才能找到该文件。我在`/Developer/Platforms/iPhoneSimulator.platform/developer/SDKs/iPhoneSimulator2.2.sdk/System/Library/Framework`. （是的，就是这么深！！）。

现在从您的 XCode 中，选择您的 Active SDK 为“Simulator - iPhone OS 2.2”，然后选择您的“Active Executable”为“iPhone Simulator (2.2)”

这为我解决了问题。希望你的也是同样的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-03-16T09:30:52.017

我在以下位置找到了我的：

/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS3.0.sdk/System/Library/Frameworks

# php - 向 PHP 核心添加函数

> ID：385531
> 
> 赞同：2
> 
> 时间：2008-12-22T04:08:01.443
> 
> 标签：php, deployment, pear, pecl

我有几个我写的函数，我经常在我的服务器上使用，有没有办法可以将它们添加到核心中，这样我就不必从外部文件中包含它们？

我正在运行 PHP5

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-22T04:11:19.250

您可以将您的库添加为[PEAR](http://pear.php.net/)扩展。然后您可以将它添加到您的[本地 PEAR 存储库](http://kuziel.info/log/archives/2006/04/01/Installation-of-local-PEAR-repository)。Pear 被添加到 php.ini 中的默认包含路径中。然后你可以在你的机器上使用“pear install myextension”。

如果这些是您在 php（php 扩展）中使用的 C 函数，那么您可以使用[PECL](http://pecl.php.net/)执行类似的操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T04:11:28.517

我以前做过这个。这是一个相当复杂的过程，但还不错。zend.com 上的这篇文章应该会告诉您您需要知道的一切：

[http://devzone.zend.com/303/extension-writing-part-i-introduction-to-php-and-zend/](http://devzone.zend.com/303/extension-writing-part-i-introduction-to-php-and-zend/)

编辑：我应该补充一点，有更好的方法来实现你想要做的事情的本质。请记住，这样做会进一步弄乱 PHP（已经非常混乱）的命名空间。您最好只制作一个全局包含文件，其中包含您最常用的所有功能，您可以在任何需要的地方包含这些功能。

编辑2：重读你原来的问题后，你说你不想那样做，但我仍然认为这可能是最好的方法。但祝你在扩展路线上好运。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-06-15T08:26:04.863

如果您希望您的功能始终可用，但不包含它，请执行以下操作：

在 php 文件中创建函数。

在您的 php.ini 中搜索选项“auto_prepend_file”并将您的 php 文件添加到该行，如下所示： auto_prepend_file = "/path/to/my_superglobal_function.php"

或者，如果你写的时候没有这样的路径： auto_prepend_file = "my_superglobal_function.php" 它会在你的 php.ini 中的 include_path 中查找文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T04:46:10.507

为什么在您需要的地方包含文件如此困难？

我想[auto_prepend_file](http://www.php.net/manual/en/ini.core.php#ini.auto-prepend-file) PHP.ini 指令可以工作。但是真的不推荐。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T07:07:54.980

如果你有[autoload](http://no.php.net/manual/en/language.oop5.autoload.php)，你可以将函数作为类的静态方法移动，比如 My_Functions。

或者要将其划分为更多文件，您可以使用 My_Functions_Math。然后你只需要加载你需要的功能。使用自动加载，您不必担心包含文件。

你不能自动加载命名空间函数，所以如果你想使用自动加载函数必须是类中的静态方法。但是您可以使用命名空间来更轻松地在将来替换类和/或缩短长类名。例子：

```
use My\Functions\Math as Math;
Math::calcThis($i); 
```

# java - 如何配置 JPA 以在 Maven 中进行测试

> ID：385532
> 
> 赞同：69
> 
> 时间：2008-12-22T04:08:44.653
> 
> 标签：java, testing, maven-2, jpa, integration-testing

有没有办法在 Maven 项目中设置第二个 persistence.xml 文件，以便它用于测试而不是用于部署的普通文件？

我尝试将 persistence.xml 放入 src/test/resources/META-INF，它被复制到 target/test-classes/META-INF，但似乎是 target/classes/META-INF（来自 src/main 的副本/resources) 得到首选，尽管`mvn -X test`以正确的顺序列出类路径条目：

```
[DEBUG] Test Classpath :
[DEBUG]   /home/uqpbecke/dev/NetBeansProjects/UserManager/target/test-classes
[DEBUG]   /home/uqpbecke/dev/NetBeansProjects/UserManager/target/classes
[DEBUG]   /home/uqpbecke/.m2/repository/junit/junit/4.5/junit-4.5.jar
... 
```

我希望能够针对简单的 hsqldb 配置运行测试，而无需更改 JPA 配置的部署版本，最好是在项目签出后直接进行，无需进行任何本地调整。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-07-24T20:01:13.787

以下将适用于 Maven 2.1+（在此之前，测试和包之间没有可以将执行绑定到的阶段）。

您可以在测试期间使用 maven-antrun-plugin 将 persistence.xml 替换为测试版本，然后在项目打包之前恢复正确的版本。

此示例假设生产版本为 src/main/resources/META-INF/persistence.xml，测试版本为 src/test/resources/META-INF/persistence.xml，因此它们将被复制到 target/classes/META -INF 和 target/test-classes/META-INF 分别。

将其封装到 mojo 中会更优雅，但由于您只是在复制文件，这似乎有点矫枉过正。

```
<plugin>
  <artifactId>maven-antrun-plugin</artifactId>
  <version>1.3</version>
  <executions>
    <execution>
      <id>copy-test-persistence</id>
      <phase>process-test-resources</phase>
      <configuration>
        <tasks>
          <!--backup the "proper" persistence.xml-->
          <copy file="${project.build.outputDirectory}/META-INF/persistence.xml" tofile="${project.build.outputDirectory}/META-INF/persistence.xml.proper"/>
          <!--replace the "proper" persistence.xml with the "test" version-->
          <copy file="${project.build.testOutputDirectory}/META-INF/persistence.xml" tofile="${project.build.outputDirectory}/META-INF/persistence.xml"/>
        </tasks>
      </configuration>
      <goals>
        <goal>run</goal>
      </goals>
    </execution>
    <execution>
      <id>restore-persistence</id>
      <phase>prepare-package</phase>
      <configuration>
        <tasks>
          <!--restore the "proper" persistence.xml-->
          <copy file="${project.build.outputDirectory}/META-INF/persistence.xml.proper" tofile="${project.build.outputDirectory}/META-INF/persistence.xml"/>
        </tasks>
      </configuration>
      <goals>
        <goal>run</goal>
      </goals>
    </execution>
  </executions>
</plugin> 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2010-06-01T11:55:40.120

在 EE6/CDI/JPA 项目中，`src/test/resources/META-INF/persistence.xml`无需任何进一步配置即可正常进行测试。

在 Spring 中使用 JPA 时，以下在用于测试的应用程序上下文中起作用：

```
<bean id="entityManagerFactory"
    class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
    <property name="dataSource" ref="dataSource" />
    <!--
        JPA requires META-INF/persistence.xml, but somehow prefers the one
        in classes/META-INF over the one in test-classes/META-INF. Spring
        to the rescue, as it allows for setting things differently, like by
        referring to "classpath:persistence-TEST.xml". Or, simply referring
        to "META-INF/persistence.xml" makes JPA use the test version too: 
    -->
    <property name="persistenceXmlLocation" value="META-INF/persistence.xml" />

    <!-- As defined in /src/test/resources/META-INF/persistence.xml -->
    <property name="persistenceUnitName" value="myTestPersistenceUnit" />
    <property name="jpaVendorAdapter">
        <bean
            class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter">
        </bean>
    </property>
</bean> 
```

在这里，`/src/test/resources/META-INF/persistence.xml`（复制到`target/test-classes`）将优先于`/src/main/resources/META-INF/persistence.xml`（复制到`target/classes`）。

不幸的是，`persistence.xml`文件的位置也决定了所谓的“[持久化单元的根](http://docs.oracle.com/javaee/6/tutorial/doc/bnbqw.html#bnbrj)”，它决定了扫描哪些类来查找`@Entity`注释。因此， using`/src/test/resources/META-INF/persistence.xml`将扫描 中的类`target/test-classes`，而不是中的类`target/classes`（需要测试的类将存在的地方）。

因此，为了测试，需要显式添加`<class>`条目到`persistence.xml`, 以避免`java.lang.IllegalArgumentException: Not an entity: class ...`. `<class>`可以通过使用不同的文件名来避免对条目的需要，例如`persistence-TEST.xml`，并将该文件放在与常规`persistence.xml`文件完全相同的文件夹中。然后，您的测试文件夹中的 Spring 上下文可以仅引用`<property name="persistenceXmlLocation" value="META-INF/persistence-TEST.xml" />`，Spring 会在`src/main`.

作为一种替代方案，人们可​​能能够`persistence.xml`为实际应用程序和测试保持相同，并且只在`src/main`. 大多数配置（例如驱动程序、方言和可选凭据）都可以在 Spring 上下文中完成。`hibernate.hbm2ddl.auto`还可以[在上下文中传递](https://stackoverflow.com/questions/8975577/hibernatejpavendoradapters-generateddl-doesnt-alter-tables/8975724#8975724)诸如此类的设置：

```
<bean id="dataSource"
    class="org.springframework.jdbc.datasource.DriverManagerDataSource">
    <!-- For example: com.mysql.jdbc.Driver or org.h2.Driver -->
    <property name="driverClassName" value="#{myConfig['db.driver']}" />
    <!-- For example: jdbc:mysql://localhost:3306/myDbName or 
        jdbc:h2:mem:test;DB_CLOSE_DELAY=-1 -->
    <property name="url" value="#{myConfig['db.url']}" />
    <!-- Ignored for H2 -->
    <property name="username" value="#{myConfig['db.username']}" />
    <property name="password" value="#{myConfig['db.password']}" />
</bean>

<bean id="jpaAdaptor"
    class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter">
    <!-- For example: org.hibernate.dialect.MySQL5Dialect or 
        org.hibernate.dialect.H2Dialect -->
    <property name="databasePlatform" value="#{myConfig['db.dialect']}" />
</bean>

<bean id="entityManagerFactory"
    class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
    <property name="dataSource" ref="dataSource" />
    <property name="jpaVendorAdapter" ref="jpaAdapter" />
    <property name="jpaProperties">
        <props>
            <!-- For example: validate, update, create or create-drop -->
            <prop key="hibernate.hbm2ddl.auto">#{myConfig['db.ddl']}</prop>
            <prop key="hibernate.show_sql">#{myConfig['db.showSql']}</prop>
            <prop key="hibernate.format_sql">true</prop>
        </props>
    </property>
</bean> 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-12-22T05:34:30.427

似乎多个 persistence.xml 文件是 JPA 的一个普遍问题，只能通过类加载技巧来解决。

对我有用的一种解决方法是在一个 persistence.xml 文件中定义多个持久性单元，然后确保您的部署和测试代码使用不同的绑定（在 Spring 中，您可以在实体管理器工厂上设置“persistenceUnitName”属性）。它会使用测试配置污染您的部署文件，但如果您不介意它可以正常工作。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2015-12-06T08:52:44.007

为测试添加一个persistance.xml：`/src/test/resources/META-INF/persistence.xml` 正如@Arjan 所说，这将改变[持久性单元的根](http://docs.oracle.com/javaee/6/tutorial/doc/bnbqw.html#bnbrj)，实体类将在目标/测试类中进行扫描。要处理这个问题，请将**jar-file**元素添加到这个 persistence.xml：

/src/test/resources/META-INF/persistence.xml

```
<persistence xmlns="http://java.sun.com/xml/ns/persistence"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd"
             version="2.0">
    <persistence-unit name="com.some.project">
        <provider>org.hibernate.jpa.HibernatePersistenceProvider</provider>
        <jar-file>${project.basedir}/target/classes</jar-file>
        <properties>
            <property name="javax.persistence.jdbc.url" value="jdbc:postgresql://localhost:5432/test_database" />
            <property name="javax.persistence.jdbc.driver" value="org.postgresql.Driver" />
            <property name="javax.persistence.jdbc.user" value="user" />
            <property name="javax.persistence.jdbc.password" value="..." />
        </properties>
    </persistence-unit>
</persistence> 
```

然后，将测试资源过滤添加到您的 pom.xml：

```
<project>
    ...
    <build>
        ...
        <testResources>
            <testResource>
                <directory>src/test/resources</directory>
                <filtering>true</filtering>
            </testResource>
        </testResources>
        ...
    </build>
...
</project> 
```

这将起作用，因为**jar-file**可以定位到目录，而不仅仅是 jar 文件。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-03-31T15:38:41.453

我尝试了 ClassLoaderProxy 方法，但问题是 JPA 注释的类没有被休眠作为持久类处理。

所以决定在不使用persistence.xml的情况下尝试一下。优点是 maven 构建和 Eclipse JUnit 测试无需修改即可工作。

我有一个用于 JUnit 测试的持久支持类。

```
public class PersistenceTestSupport {

    protected EntityManager em;
    protected EntityTransaction et;

    /**
     * Setup the the {@code EntityManager} and {@code EntityTransaction} for
     * local junit testing.
     */
    public void setup() {

        Properties props = new Properties();
        props.put("hibernate.hbm2ddl.auto", "create-drop");
        props.put("hibernate.dialect", "org.hibernate.dialect.MySQLDialect");
        props.put("hibernate.connection.url", "jdbc:mysql://localhost/db_name");
        props.put("hibernate.connection.driver_class", "com.mysql.jdbc.Driver");
        props.put("hibernate.connection.username", "user");
        props.put("hibernate.connection.password", "****");

        Ejb3Configuration cfg = new Ejb3Configuration();
        em = cfg.addProperties(props)
            .addAnnotatedClass(Class1.class)
            .addAnnotatedClass(Class2.class)
            ...
                    .addAnnotatedClass(Classn.class)
            .buildEntityManagerFactory()
            .createEntityManager();

        et = em.getTransaction();
    }
} 
```

我的测试类只是扩展 PersistenceTestSupport 并在 TestCase.setup() 中调用 setup()。

唯一的缺点是使持久类保持最新，但对于 JUnit 测试，这对我来说是可以接受的。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-12-11T18:50:28.533

我更喜欢使用不同的 persistence.xml 进行测试和生产作为 Rich Seller[帖子](https://stackoverflow.com/questions/385532/how-to-configure-jpa-for-testing-in-maven/1179876#1179876)的解决方案（谢谢！！）。

但需要改变：

```
<copy file="${project.build.outputDirectory}/META-INF/persistence.xml.proper" tofile="${project.build.outputDirectory}/META-INF/persistence.xml"/> 
```

为了：

```
<move file="${project.build.outputDirectory}/META-INF/persistence.xml.proper" tofile="${project.build.outputDirectory}/META-INF/persistence.xml" overwrite="true"/> 
```

为了persistence.xml.proper没有嵌入.jar文件

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-11-04T11:11:51.467

这个答案可能听起来很傻，但我正在寻找一种方法，让我通过`Run As`->从 eclipse 运行这些测试`JUnit Test`。我是这样做的：

```
@BeforeClass
public static void setUp() throws IOException {
    Files.copy(new File("target/test-classes/META-INF/persistence.xml"), new File("target/classes/META-INF/persistence.xml"));
    // ...
} 
```

我只是将 test/persistence.xml 复制到 classes/persistence.xml。这行得通。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-22T04:18:39.750

保留两个persistence.xml 文件的副本。一个用于测试，另一个用于正常构建。

默认生命周期将 build persistence.xml 复制到 src/test/resources/META-INF

创建一个单独的配置文件，运行时会将测试持久性.xml 复制到 src/test/resources/META-INF

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-06-22T10:41:56.680

Persistence.xml 用作搜索实体类的起点，除非您明确列出所有类并添加 . 因此，如果你想用另一个文件覆盖这个文件，比如从 src/test/resources，你必须在第二个 persistence.xml 中指定每个实体类，否则将找不到实体类。

另一种解决方案是使用 maven-resources-plugin（'copy-resources' 目标）覆盖文件。但是你必须覆盖它两次，一次用于测试（例如阶段过程测试类），一次用于真正的打包（阶段'准备包'）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2016-02-23T14:13:29.027

这是 Rich Seller 答案的扩展，通过正确处理 Hibernate 在类路径上查找多个 persistence.xml 文件和预测试状态恢复。

# 设置：

创建一个用于部署/打包的持久性文件和一个用于测试的持久性文件：

*   src/main/resources/persistence.xml

*   src/ **test** / resources /persistence- **testing.xml**

在您的 pom.xml 中将其添加到插件部分：

```
 <plugin>
            <artifactId>maven-antrun-plugin</artifactId>
            <version>1.3</version>
            <executions>
                <execution>
                    <id>copy-test-persistence</id>
                    <phase>process-test-resources</phase>
                    <configuration>
                        <tasks>
                            <echo>renaming deployment persistence.xml</echo>
                            <move file="${project.build.outputDirectory}/META-INF/persistence.xml" tofile="${project.build.outputDirectory}/META-INF/persistence.xml.proper"/>
                            <echo>replacing deployment persistence.xml with test version</echo>
                            <copy file="${project.build.testOutputDirectory}/META-INF/persistence-testing.xml" tofile="${project.build.outputDirectory}/META-INF/persistence.xml" overwrite="true"/>
                        </tasks>
                    </configuration>
                    <goals>
                        <goal>run</goal>
                    </goals>
                </execution>
                <execution>
                    <id>restore-persistence</id>
                    <phase>prepare-package</phase>
                    <configuration>
                        <tasks>
                            <echo>restoring the deployment persistence.xml</echo>
                            <move file="${project.build.outputDirectory}/META-INF/persistence.xml.proper" tofile="${project.build.outputDirectory}/META-INF/persistence.xml" overwrite="true"/>
                        </tasks>
                    </configuration>
                    <goals>
                        <goal>run</goal>
                    </goals>
                </execution>
            </executions>
        </plugin> 
```

# 优于其他解决方案的优势

*   无需额外的 Java 代码
*   类路径上只有一个 persistence.xml
*   构建和测试都按预期工作
*   描述控制台上的输出（回声）
*   对于包装，状态是 100% 恢复的。没有剩余文件

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-06-28T13:13:43.987

使用 OpenEJB 时，persistence.xml 可以用*备用描述符*覆盖：http : [//tomee.apache.org/alternate-descriptors.html](http://tomee.apache.org/alternate-descriptors.html)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-07-21T12:02:20.120

我正在尝试做同样的事情。我有一个适合我的解决方案 - 你的可能会有所不同（你可能不喜欢这个解决方案......它有点低级）。

我在网上看到一篇文章，他们使用自定义类加载器来做类似的事情，这给了我灵感。如果有人可以看到如何改进，那么欢迎提出建议。对于部署，我依赖于 EntityManager 的容器注入，但对于测试，我使用以下代码自己创建它：

```
final Thread currentThread = Thread.currentThread();
final ClassLoader saveClassLoader = currentThread.getContextClassLoader();
currentThread.setContextClassLoader(new ClassLoaderProxy(saveClassLoader));

EntityManagerFactory emFactory = Persistence.createEntityManagerFactory("test");
em = emFactory.createEntityManager(); 
```

然后 ClassLoaderProxy 将尽可能小，只需将 META-INF/persistence.xml 的请求重定向到 META-INF/test-persist.xml：

```
public class ClassLoaderProxy extends ClassLoader {

    public ClassLoaderProxy(final ClassLoader parent) {
        super();
    }

    @Override
    public Enumeration<URL> getResources(final String name) throws IOException {
        if (!"META-INF/persistence.xml".equals(name)) {
            return super.getResources(name);
        } else {
            System.out.println("Redirecting persistence.xml to test-persist.xml");
            return super.getResources("META-INF/test-persist.xml");
        }
    }
} 
```

只是为了解释一下：

1.  有两个persistence.xml 文件（一个名为persistence.xml 用于测试外部，一个名为test-persist.xml 用于测试）。
2.  自定义类加载器*仅对*单元测试有效（部署一切正常）
3.  自定义类加载器将对“META-INF/persistence.xml”的请求重定向到测试版本（“META-INF/test-persist.xml”）。

我最初遇到了一些问题，因为 Hibernate 会（以某种方式）恢复到用于加载 Hibernate 的类加载器（至少我认为这是正在发生的事情）。我发现将 ClassLoader 切换代码（第一个块）作为静态块放在您的测试用例中，它将在 Hibernate 之前加载，但是根据您的单元测试结构，您可能还需要将相同的代码放在其他地方（呸）。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-05-08T15:01:52.853

另一种方法是使用单独的 persistence.xml 进行测试（test/../META-INF/persistence.xml 但覆盖扫描仪如下：-

测试 persistence.xml 需要包含

`<property name="hibernate.ejb.resource_scanner" value = "...TestScanner" />`

新类 TestScanner 的代码如下。

```
import java.lang.annotation.Annotation;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.Set;
import org.hibernate.ejb.packaging.NamedInputStream;
import org.hibernate.ejb.packaging.NativeScanner;

public class TestScanner extends NativeScanner
{

@Override
public Set <Class <?> > 
getClassesInJar (URL jar, Set <Class <? extends Annotation> > annotations)
{  return super.getClassesInJar (getUpdatedURL (jar), annotations); }

@Override
public Set <NamedInputStream> 
getFilesInJar (URL jar, Set <String> patterns)
{  return super.getFilesInJar (getUpdatedURL (jar), patterns); }

@Override
public Set <Package> 
getPackagesInJar (URL jar, Set <Class <? extends Annotation> > annotations)
{  return super.getPackagesInJar (getUpdatedURL (jar), annotations); }

private URL getUpdatedURL (URL url)
{
  String oldURL = url.toExternalForm ();
  String newURL = oldURL.replaceAll ("test-classes", "classes");
  URL result;
  try {
    result = newURL.equals (oldURL) ? url : new URL (newURL);
  } catch (MalformedURLException e)
  {  // Whatever  }
  return result;
}

} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-04-19T08:38:11.067

此用例的另一种选择是添加多个持久性单元，一个用于生产，另一个用于测试并相应地注入 EntityManagerFactory。

将两个持久性单元放入实际项目的 persistence.xml 中，并让您的测试用例注入正确的 EntityManager。下面的示例说明了如何使用 guice 来做到这一点。请注意，为了完整起见，我留下了一些 mockito 模拟，mockito 特定代码已相应标记，不需要注入。

```
public class HibernateTestDatabaseProvider extends AbstractModule {
    private static final ThreadLocal<EntityManager> ENTITYMANAGER_CACHE = new ThreadLocal<>();

    @Override
    public void configure() {
    }

    @Provides
    @Singleton
    public EntityManagerFactory provideEntityManagerFactory() {
        return Persistence.createEntityManagerFactory("my.test.persistence.unit");
    }

    @Provides
    public CriteriaBuilder provideCriteriaBuilder(EntityManagerFactory entityManagerFactory) {
        return entityManagerFactory.getCriteriaBuilder();
    }

    @Provides
    public EntityManager provideEntityManager(EntityManagerFactory entityManagerFactory) {
        EntityManager entityManager = ENTITYMANAGER_CACHE.get();
        if (entityManager == null) {
            // prevent commits on the database, requires mockito. Not relevant for this answer
            entityManager = spy(entityManagerFactory.createEntityManager());

            EntityTransaction et = spy(entityManager.getTransaction());
            when(entityManager.getTransaction()).thenReturn(et);
            doNothing().when(et).commit();

            ENTITYMANAGER_CACHE.set(entityManager);
        }
        return entityManager;
    }
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-09-21T06:35:40.733

用它的persistence.xml将测试放在自己的maven项目中

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-10-01T14:11:39.967

我建议使用不同的 Maven 配置文件，您可以在其中过滤 database.proprerties 文件并为每个配置文件设置一个 database.properties。

这样您就不必保留除 .properties 之外的任何其他配置文件的副本。

```
<properties>
    <!-- Used to locate the profile specific configuration file. -->
    <build.profile.id>default</build.profile.id>
    <!-- Only unit tests are run by default. -->
    <skip.integration.tests>true</skip.integration.tests>
    <skip.unit.tests>false</skip.unit.tests>
    <integration.test.files>**/*IT.java</integration.test.files>
</properties>
<profiles>
    <profile>
        <id>default</id>
        <activation>
            <activeByDefault>true</activeByDefault>
        </activation>
        <properties>
            <!--
                Specifies the build profile id, which is used to find out the correct properties file.
                This is not actually necessary for this example, but it can be used for other purposes.
            -->
            <build.profile.id>default</build.profile.id>
            <skip.integration.tests>true</skip.integration.tests>
            <skip.unit.tests>false</skip.unit.tests>
        </properties>
        <build>
            <filters>
                <!--
                    Specifies path to the properties file, which contains profile specific
                    configuration. In this case, the configuration file should be the default spring/database.properties file
                -->
                <filter>src/main/resources/META-INF/spring/database.properties</filter>
            </filters>
            <resources>
                <!--
                    Placeholders found from files located in the configured resource directories are replaced
                    with values found from the profile specific configuration files.
                -->
                <resource>
                    <filtering>true</filtering>
                    <directory>src/main/resources</directory>
                    <!--
                        You can also include only specific files found from the configured directory or
                        exclude files. This can be done by uncommenting following sections and adding
                        the configuration under includes and excludes tags.
                    -->
                    <!--
                    <includes>
                        <include></include>
                    </includes>
                    <excludes>
                        <exclude></exclude>
                    </excludes>
                    -->
                </resource>
            </resources>
        </build>
    </profile>
    <profile>
        <id>integration</id>
        <properties>
            <!--
                Specifies the build profile id, which is used to find out the correct properties file.
                This is not actually necessary for this example, but it can be used for other purposes.
            -->
            <build.profile.id>integration</build.profile.id>
            <skip.integration.tests>false</skip.integration.tests>
            <skip.unit.tests>true</skip.unit.tests>
        </properties>
        <build>
            <filters>
                <!--
                    Specifies path to the properties file, which contains profile specific
                    configuration. In this case, the configuration file is searched
                    from spring/profiles/it/ directory.
                -->
                <filter>src/main/resources/META-INF/spring/profiles/${build.profile.id}/database.properties</filter>
            </filters>
            <resources>
                <!--
                    Placeholders found from files located in the configured resource directories are replaced
                    with values found from the profile specific configuration files.
                -->
                <resource>
                    <filtering>true</filtering>
                    <directory>src/main/resources</directory>
                    <!--
                        You can also include only specific files found from the configured directory or
                        exclude files. This can be done by uncommenting following sections and adding
                        the configuration under includes and excludes tags.
                    -->
                    <!--
                    <includes>
                        <include></include>
                    </includes>
                    <excludes>
                        <exclude></exclude>
                    </excludes>
                    -->
                </resource>
            </resources>
        </build>
    </profile>
</profiles> 
```

借助用于单元测试的surefire和用于集成测试的failsfe，您就完成了。

```
 <plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-surefire-plugin</artifactId>
    <version>2.12</version>
    <configuration>
        <junitArtifactName>org.junit:com.springsource.org.junit</junitArtifactName>
        <!--see: https://issuetracker.springsource.com/browse/EBR-220-->
        <printSummary>false</printSummary>
        <redirectTestOutputToFile>true</redirectTestOutputToFile>
        <!-- Skips unit tests if the value of skip.unit.tests property is true -->
        <skipTests>${skip.unit.tests}</skipTests>
        <!-- Excludes integration tests when unit tests are run. -->
        <excludes>
            <exclude>${integration.test.files}</exclude>
        </excludes>
    </configuration>
</plugin>

<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-failsafe-plugin</artifactId>
    <version>2.12</version>
    <configuration>
        <!-- Skips integration tests if the value of skip.integration.tests property is true -->
        <skipTests>${skip.integration.tests}</skipTests>
        <includes>
            <include>${integration.test.files}</include>
        </includes>
        <forkMode>once</forkMode>
        <!--
                            <reuseForks>false</reuseForks>
                            <forkCount>1</forkCount>
        -->
    </configuration>
    <executions>
        <execution>
            <id>integration-test</id>
            <goals>
                <goal>integration-test</goal>
            </goals>
        </execution>
        <execution>
            <id>verify</id>
            <goals>
                <goal>verify</goal>
            </goals>
        </execution>
    </executions>
</plugin> 
```

现在您只需要`mvn test`进行单元测试和`mvn verify -Pintegration`集成测试。显然，您应该在指定的（在配置文件上）路径（或其他地方并更改路径）中创建 database.properties 文件

基于参考：[http ://www.petrikainulainen.net/programming/tips-and-tricks/creating-profile-specific-configuration-files-with-maven/](http://www.petrikainulainen.net/programming/tips-and-tricks/creating-profile-specific-configuration-files-with-maven/)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-09-13T10:55:59.787

我发现了 2 种可能性，而无需更改类加载器/使用其他 Maven 插件/配置文件/复制覆盖文件。

TL;DR：**检查提供者名称**。

起初，我开始以编程方式构建 entityManagerFactory，如下所示：[create entity manager programmatically without persistence file](https://stackoverflow.com/questions/29434121/create-entity-manager-programmatically-without-persistence-file#answer-42372934)。

所以我做了非常相似的事情：

```
 @BeforeClass
    public static void prepare() {
        Map<String, Object> configOverrides = new HashMap<>();
        configOverrides.put("hibernate.connection.driver_class", "org.h2.Driver");
        configOverrides.put("hibernate.connection.url", "jdbc:h2:mem:test;DB_CLOSE_DELAY=-1");
        configOverrides.put("hibernate.connection.username", "sa");
        configOverrides.put("hibernate.connection.password", "sa");
        configOverrides.put("hibernate.dialect", "org.hibernate.dialect.H2Dialect");
        configOverrides.put("hibernate.show_sql", "true");
        configOverrides.put("hibernate.hbm2ddl.auto", "validate");
        factory = new HibernatePersistence().createContainerEntityManagerFactory(
                new CustomPersistenceUnitInfo(), configOverrides
        );
        //factory = Persistence.createEntityManagerFactory("test");
        assertNotNull(factory);
    }
...
    private static class CustomPersistenceUnitInfo implements PersistenceUnitInfo {

        @Override
        public String getPersistenceUnitName() {
            return "test";
        }

        @Override
        public String getPersistenceProviderClassName() {
            return "org.hibernate.jpa.HibernatePersistenceProvider";
 // <------------note here: this is wrong!
        }

        @Override
        public PersistenceUnitTransactionType getTransactionType() {
            return PersistenceUnitTransactionType.RESOURCE_LOCAL;
        }

        @Override
        public DataSource getJtaDataSource() {
            return null;
        }

        @Override
        public DataSource getNonJtaDataSource() {
            return null;
        }

        @Override
        public List<String> getMappingFileNames() {
            return Collections.emptyList();
        }

        @Override
        public List<URL> getJarFileUrls() {
            try {
                return Collections.list(this.getClass()
                        .getClassLoader()
                        .getResources(""));
            } catch (IOException e) {
                throw new UncheckedIOException(e);
            }
        }

        @Override
        public URL getPersistenceUnitRootUrl() {
            return null;
        }

        @Override
        public List<String> getManagedClassNames() {
            return Arrays.asList(
                    "com.app.Entity1",
                    "com.app.Entity2"
            );
        }

        @Override
        public boolean excludeUnlistedClasses() {
            return true;
        }

        @Override
        public SharedCacheMode getSharedCacheMode() {
            return null;
        }

        @Override
        public ValidationMode getValidationMode() {
            return null;
        }

        @Override
        public Properties getProperties() {
            return null;
        }

        @Override
        public String getPersistenceXMLSchemaVersion() {
            return null;
        }

        @Override
        public ClassLoader getClassLoader() {
            return null;
        }

        @Override
        public void addTransformer(final ClassTransformer classTransformer) {

        }

        @Override
        public ClassLoader getNewTempClassLoader() {
            return null;
        }
    } 
```

但是后来，我发现它仍然返回`null`。为什么？

然后我发现我在使用`com.hibernate.ejb.HibernatePersistence`class的时候，provider应该不是`com.hibernate.jpa.HibernatePersistenceProvider`，而是`com.hibernate.ejb.HibernatePersistence`。`HibernatePersistenceProvider`即使在主persistence.xml中，IDEA“Open Class”也找不到该类。

在`Ejb3Configuration.class`我发现：

```
 integration = integration != null ? Collections.unmodifiableMap(integration) : CollectionHelper.EMPTY_MAP;
        String provider = (String)integration.get("javax.persistence.provider");
        if (provider == null) {
            provider = info.getPersistenceProviderClassName();
        }

        if (provider != null && !provider.trim().startsWith(IMPLEMENTATION_NAME)) { // private static final String IMPLEMENTATION_NAME = HibernatePersistence.class.getName(); which, is, "com.hibernate.ejb.HibernatePersistence"
            LOG.requiredDifferentProvider(provider);
            return null;
        } else { 
```

所以我回到了第一个解决方案`persistence.xml`，并更改了提供者名称，现在它可以工作了。似乎即使 main 中的提供者是`jpa.xxx`，在测试中也不是。

因此，总而言之，要检查 3 件事：

*   在 Maven 中打开`-X`以检查是否`maven-resources-plugin`真的复制了你的`src/test/resources/META-INF/persistence.xml`（`target/test-classes`我认为这永远不会失败）
*   检查是否`hibernate-entitymanager`在您的类路径中（您可以使用**`mvn dependency:tree -Dincludes=org.hibernate:hibernate-entitymanager`**.
*   检查提供商的名称，最重要的一个。应该是`org.hibernate.ejb.HibernatePersistence`。

```
<persistence version="2.0"
             xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd">
    <persistence-unit name="test" transaction-type="RESOURCE_LOCAL">
        <provider>org.hibernate.ejb.HibernatePersistence</provider>
        <class>com.app.model.Company</class>
        ... 
```

# linux - 是否有充分的理由不利用 makefile 顶部的 '#!/bin/make -f' 来提供可执行的 makefile？

> ID：385539
> 
> 赞同：4
> 
> 时间：2008-12-22T04:12:13.180
> 
> 标签：linux, unix, shell, makefile

主要是为了我的娱乐，我`makefile`在我的`$HOME/bin`目录中创建了一个名为`rebuild.mk`，并使其可执行，文件的第一行读取：

```
#!/bin/make -f
#
# Comments on what the makefile is for

...

all: ${SCRIPTS} ${LINKS} ...

... 
```

我现在可以输入：

```
rebuild.mk 
```

这会导致`make`执行。

除此以外，不永久利用此功能的原因是什么：

*   makefile 绑定到单个目录，因此它确实不适合我的主`bin`目录。

有没有人见过以前被利用的把戏？

* * *

收集一些评论，并提供更多背景信息。

1.  Norman Ramsey 报告说这种技术被用于 Debian。这很有趣。谢谢你。
2.  我同意输入“make”更习惯用语。
3.  但是，这种情况（以前未说明）是我的 $HOME/bin 目录中已经有一个跨平台的主 makefile，它是目录中 500 多个命令的主要维护工具。
4.  但是，在一台特定的机器上（仅），我想添加一个生成文件来构建一组特殊的工具。因此，这些工具得到了一个特殊的 makefile，我`rebuild.mk`为这个问题调用了它（它在我的机器上有另一个名字）。
5.  我确实可以`make -f rebuild.mk`通过使用 ' `rebuild.mk`' 来节省键入 ' ' 的时间。
6.  `make`跨平台修复实用程序的位置是有问题的。
7.  该`#!/usr/bin/env make -f`技术可能会奏效，尽管我相信官方的交战规则是该行必须少于 32 个字符，并且命令可能只有一个参数。
8.  @dF 评论说该技术可能会阻止您传递要制作的参数。无论如何，这在我的 Solaris 机器上不是问题。我测试的三个不同版本的“make”（Sun、GNU、我的）都得到了我输入的额外命令行参数，包括选项（我的自制版本上的“-u”）和目标“someprogram”和宏 CC ='cc' WFLAGS=-v（使用不同的编译器并取消 Sun 编译器不理解的 GCC 警告标志）。

### 我不会提倡将其作为一种通用技术。

如前所述，这主要是为了我的消遣。我可以为这项特殊的工作保留它；我不太可能在分布式工作中使用它。如果我这样做了，我会提供并应用一个' `fixin`'脚本来修复解释器的路径名；事实上，我已经在我的机器上这样做了。该脚本是 Camel 书第一版（Larry Wall 的“Programming Perl”）的遗物。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T04:19:57.050

对于一般可分发的 Makefile 来说，这样做的一个问题是，`make`跨平台的位置并不总是一致的。此外，某些系统可能需要备用名称，例如`gmake`.

当然，人们总是可以手动运行适当的命令，但这违背了使 Makefile 可执行的整个目的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-22T04:36:25.753

我以前在每个 Debian 软件包的文件中都**看到过这个技巧。**`debian/rules`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-22T04:26:55.337

为了解决`make`不总是在同一个地方的问题（例如在我的系统上`/usr/bin`），您可以使用

```
#!/usr/bin/env make -f 
```

如果您使用的是类 UNIX 系统。

另一个问题是，通过这种方式使用 Makefile，您无法覆盖变量，例如`make CFLAGS=...`.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-22T04:24:04.607

“make”比“./Makefile”短，所以我不认为你在买任何东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T04:22:10.353

我不这样做的原因是键入“make”对于构建基于 Makefile 的项目更为惯用。想象一下，如果您构建的每个项目都必须搜索某人创建的不同名称的 makefile，而不仅仅是键入“make && make install”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T11:13:42.237

您也可以为此使用 shell 别名。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-03-15T05:48:36.043

我们可以换一种方式来看待这个问题：设计一种语言，如果你不给它一个固定的文件名，它的解释器会寻找一个固定的文件名，这是一个好主意吗？如果在没有脚本名称的情况下`python`查找怎么办？`Pythonfile`;)

您不需要这样的机制来制定基于已知名称的约定。示例：Autoconf 的`./configure`脚本。

# operating-system - 自定义应用程序启动

> ID：385541
> 
> 赞同：2
> 
> 时间：2008-12-22T04:15:05.423
> 
> 标签：operating-system

有什么方法可以修复启动任何应用程序（如 Internet Explorer 或任何其他应用程序）的时间。所以如果我没有错过我的工作时间表。

例如：如果每天晚上我希望我的资源管理器自动打开某个页面，

可能吗 ？？？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T04:23:50.583

控制面板中的调度程序。我每天都会为我们所需的时间表执行此操作。

控制面板->计划任务->添加计划任务

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T04:29:25.020

如果您需要一种方法来自动执行某项任务，您可以使用[AutoIT](http://www.autoitscript.com/AutoIt/)或[AutoHotkey](http://www.autohotkey.com)来自动执行它，并使用 Windows 内置的调度程序（开始 > 程序 > 附件 > 系统工具 > 计划任务）每天自动运行它。

# java - Java 如何选择调用哪个重载函数？

> ID：385551
> 
> 赞同：10
> 
> 时间：2008-12-22T04:20:46.457
> 
> 标签：java, inheritance, programming-languages, function

这是一个纯粹的理论问题。

给定三个简单的类：

```
class Base {
}

class Sub extends Base {
}    

class SubSub extends Sub {
} 
```

还有一个旨在对这些类进行操作的函数：

```
public static void doSomething(Base b) {
  System.out.println("BASE CALLED");
}
public static void doSomething(Sub b) {
  System.out.println("SUB CALLED");
} 
```

似乎以下代码：

```
SubSub ss = new SubSub();
doSomething(ss); 
```

可能会合法地导致打印 BASE CALLED 或 SUB CALLED，因为 SubSub 可以同时转换为这两者。事实上，删除函数的 Sub 版本会导致打印 BASE CALLED。实际发生的是打印了“SUB CALLED”。这似乎意味着调用哪个函数不取决于定义函数的顺序，因为首先调用了基本版本。

Java 是否只查看函数的所有不同版本并选择需要最小遍历继承堆栈的版本？这是标准化的吗？它是否写在任何文档中？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-22T05:14:35.987

[可以在 Java 语言规范 (JLS) 的第 15.12.2.5 部分](http://java.sun.com/docs/books/jls/third_edition/html/expressions.html#301183)中找到正式规范。由于泛型，这非常复杂，因此您可能希望查看[JLS 第一版的同一部分](http://java.sun.com/docs/books/jls/first_edition/html/15.doc.html#18428)。

它基本上说编译器试图找到一个版本的方法，其中所有参数（包括调用该方法的对象）都是最具体的。如果不存在这样的方法（例如，因为您有`method(Base, Sub)`and`method(Sub, Base)`但没有`method(Sub, Sub)`），则编译失败。

请注意，方法的实际选择取决于实例方法的目标对象的动态类型，而不是参数。您的示例在实例级别上仍然可以正常工作。

您应该能够通过强制转换或重新声明`ss`. 如果声明的变量类型与签名完全匹配，那么对于编译器和维护程序员来说一切都是清楚的。只要声明的类型匹配，您是否随后分配更具体的类型并不重要。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T04:31:08.040

据我所知，Java 和 C++ 在编译时根据它们可以做出的最具体的匹配来做出这个决定（因为这些是不可动态分派的静态函数）。如果您的静态类型是 SubSub 并且您有一个采用 SubSub 的重载，那么这就是将被调用的重载。我很确定这两种标准都适用。

如果您有 Base 的引用或指针，即使它包含 Sub 或 SubSub，您也会匹配使用 Base 的版本，因为在编译时，这是编译器拥有的唯一保证。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T04:51:38.140

当您重载静态方法时，它会调用在调用该方法的类中立即定义的方法。但是，如果调用类中没有定义任何方法，那么它将调用从其直接父类继承的方法。

在您的情况下，有两个重载方法都可以接受 SubSub 作为参数。编译器检查最具体的匹配并继续它。但最具体的匹配通常是类型层次结构中最低的。

**已编辑**

删除了冲突的语句。处于同一类型层次结构级别的类中的两个方法不能处于模棱两可的状态以供编译器选择。这种歧义只有在多重继承的情况下才有可能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-07-19T21:12:56.017

Java 动态绑定方法（在运行时，取决于对象实例类型，而不是引用类型），但仅在一个方法签名的上下文中。Java 静态绑定方法签名（在编译时）。
**换句话说**，Java 决定在编译时应该调用什么方法（签名）（基于静态引用的重载）。在运行时，Java 将采用该签名，在对象类型层次结构中找到适当的对象，并在该动态绑定的对象上执行该方法。

**重载->什么**（编译时的方法签名）
**覆盖->从哪里**（运行时类型层次结构中的对象）

# c++ - C++ 如何选择调用哪个重载函数？

> ID：385556
> 
> 赞同：5
> 
> 时间：2008-12-22T04:26:39.830
> 
> 标签：c++, inheritance, programming-languages, function, multiple-inheritance

假设我有三个课程：

```
class X{};
class Y{};
class Both : public X, public Y {}; 
```

我的意思是说我有两个类，然后是第三个类，它扩展了两者（多重继承）。

现在说我在另一个类中定义了一个函数：

```
void doIt(X *arg) { }
void doIt(Y *arg) { } 
```

我用两者的实例调用这个函数：

```
doIt(new Both()); 
```

这会导致编译时错误，说明函数调用不明确。

除了这种情况，C++ 编译器在哪些情况下判断调用不明确并抛出错误（如果有）？编译器如何确定这些情况是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-22T04:33:36.507

很简单：如果它不明确，那么编译器会给你一个错误，迫使你做出选择。在您的代码段中，您将得到一个不同的错误，因为 of 的类型`new Both()`是指向 的指针`Both`，而两个重载都`doIt()`按值接受其参数（即它们不接受指针）。如果您更改`doIt()`为分别采用类型`X*`和参数`Y*`，编译器会给您一个关于模棱两可的函数调用的错误。

如果要显式调用其中一个，请适当地转换参数：

```
void doIt(X *arg) { }
void doIt(Y *arg) { }
Both *both = new Both;
doIt((X*)both);  // calls doIt(X*)
doIt((Y*)both);  // calls doIt(Y*)
delete both; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-22T04:32:37.493

我用 gcc 得到这个错误：

```
jeremy@jeremy-desktop:~/Desktop$ g++ -o test test.cpp
test.cpp: In function ‘int main(int, char**)’:
test.cpp:18: error: call of overloaded ‘doIt(Both&)’ is ambiguous
test.cpp:7: note: candidates are: void doIt(X)
test.cpp:11: note:                 void doIt(Y) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-27T06:28:15.447

这是使用的完美示例`boost::implicit_cast`：

```
void doIt(X *arg) { }
void doIt(Y *arg) { }

doIt(boost::implicit_cast<X*>(new Both)); 
```

与其他解决方案（包括 static_cast）不同，如果无法从`Both*`to 进行隐式转换，则转换将失败`X*`。这是通过一个技巧完成的，最好用一个简单的例子来展示：

```
X * implicit_conversion(X *b) { return b; } 
```

就是这样`boost::implicit_cast`，只是它是一个告诉它类型的模板`b`。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-22T05:48:56.917

编译器进行深度搜索，而不是选择重载的广度搜索。完整的答案在[Herb Sutter 出色的 C++](http://www.gotw.ca/publications/xc++.htm)中，不幸的是我手头没有这本书。

编辑：现在拿到手头的书它被称为深度优先规则被称为[“接口原则”](http://www.gotw.ca/publications/mill02.htm)：

> 接口原则 对于类 X，所有函数，包括自由函数，（a）“提及”X 和（b）“提供”X 在逻辑上都是 X 的一部分，因为它们构成 X 的接口的一部分.

但是有一个称为[“Koenig Lookup”](http://en.wikipedia.org/wiki/Argument_dependent_name_lookup)的次要规则，这使事情变得更加困难。

> 引用：“（简化）：如果你提供一个类类型的函数参数（这里是 x，类型 A::X），那么为了查找正确的函数名，编译器会考虑在包含参数的类型” *-Herb Sutter, Exceptional C++, p120*

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T05:07:20.947

您需要明确地将您的论点转换为 x 或 y

做（新两者（））；

所以加...

(X *) 或 (Y *)

像...

doIt((X *)new Both());

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T04:33:51.030

AFAIK C++ 编译器将始终选择它可以在编译时确定的最接近和最具体的匹配。

但是，如果您的对象是从两者派生的，我认为编译器应该给您一个错误或至少一个非常严重的警告。声明顺序应该无关紧要，因为这是关于子类型关系，并且第一个对象不是比另一个对象“更多的子类型”。

# python - 提取浮点/双精度值

> ID：385558
> 
> 赞同：28
> 
> 时间：2008-12-22T04:28:01.637
> 
> 标签：python, regex

如何使用正则表达式从字符串中提取双精度值。

```
import re

pattr = re.compile(???)    
x = pattr.match("4.5") 
```

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-12-22T04:56:22.420

来自的正则表达式[`perldoc perlretut`](http://perldoc.perl.org/perlretut.html#Building-a-regexp)：

```
import re
re_float = re.compile("""(?x)
   ^
      [+-]?\ *      # first, match an optional sign *and space*
      (             # then match integers or f.p. mantissas:
          \d+       # start out with a ...
          (
              \.\d* # mantissa of the form a.b or a.
          )?        # ? takes care of integers of the form a
         |\.\d+     # mantissa of the form .b
      )
      ([eE][+-]?\d+)?  # finally, optionally match an exponent
   $""")
m = re_float.match("4.5")
print m.group(0)
# -> 4.5 
```

要从更大的字符串中提取数字：

```
s = """4.5 abc -4.5 abc - 4.5 abc + .1e10 abc . abc 1.01e-2 abc 
       1.01e-.2 abc 123 abc .123"""
print re.findall(r"[+-]? *(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?", s)
# -> ['4.5', '-4.5', '- 4.5', '+ .1e10', ' 1.01e-2',
#     '       1.01', '-.2', ' 123', ' .123'] 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-12-22T12:41:31.187

这是简单的方法。不要将正则表达式用于内置类型。

```
try:
    x = float( someString )
except ValueError, e:
    # someString was NOT floating-point, what now? 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2015-03-03T13:01:36.227

对于解析 int 和 float（点分隔符）值：

```
re.findall( r'\d+\.*\d*', 'some 12 12.3 0 any text 0.8' ) 
```

结果：

```
['12', '12.3', '0', '0.8'] 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-08T11:33:59.850

一个浮点数作为蛮力的正则表达式。JF Sebastian 版本的差异较小：

```
import re
if __name__ == '__main__':
  x = str(1.000e-123)
  reFloat = r'(^[+-]?\d+(?:\.\d+)?(?:[eE][+-]\d+)?$)'
  print re.match(reFloat,x)

>>> <_sre.SRE_Match object at 0x0054D3E0> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-12-02T13:10:18.893

请注意，这些答案都没有涵盖有趣的边缘情况，例如“inf”、“NaN”、“-iNf”、“-NaN”、“1e-1_2_3_4_5_6”等。

（受 Eric 在此处[检查字符串是否可以在 Python 中转换为浮点数](https://stackoverflow.com/questions/736043/checking-if-a-string-can-be-converted-to-float-in-python)的回答启发）

# asp.net-mvc - Asp.Net MVC - “动态”路由的最佳方法

> ID：385570
> 
> 赞同：10
> 
> 时间：2008-12-22T04:34:32.467
> 
> 标签：asp.net-mvc, routing, routes

我正在尝试提出一种创建“动态”路由的方法。我的意思是，确切地说，我希望能够为每个命中分配控制器和路线的操作，而不是直接映射它。

例如，一个路由可能看起来像这样“路径/{object}”，当该路径被命中时，将执行查找以提供适当的控制器/动作来调用。

我已经尝试发现创建自定义路由处理程序的机制，但目前文档/可发现性有点阴暗（我知道，它的测试版 - 我不会再期待了）。虽然，我不确定这是否是最好的方法，也许是控制器工厂，甚至是执行所有映射的默认控制器/动作可能是最好的路线（没有双关语）。

任何意见，将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-07-14T13:32:25.893

您始终可以使用全部语法（我不知道名称是否正确）。

路线： `routeTable.MapRoute( "Path", "{*path}", new { controller = "Pages", action = "Path" });`

控制器动作定义为： `public ActionResult Path(string path)`

在控制器的操作中，您将有一条路径，因此只需将其溢出并进行分析。

要调用另一个控制器，您可以使用 RedirectToAction （我认为这是更合适的方法）。使用重定向，您可以为其设置永久重定向。或使用类似的东西：

```
 internal class MVCTransferResult : RedirectResult
    {
        public MVCTransferResult(string url) : base(url) 
        {
        }
        public MVCTransferResult(object routeValues) 
                : base(GetRouteURL(routeValues))
        {
        }

        private static string GetRouteURL(object routeValues)
        {
            UrlHelper url = new UrlHelper(
                new RequestContext(
                        new HttpContextWrapper(HttpContext.Current),
                        new RouteData()),
                        RouteTable.Routes);
            return url.RouteUrl(routeValues);
        }

        public override void ExecuteResult(ControllerContext context)
        {
            var httpContext = HttpContext.Current;

            // ASP.NET MVC 3.0
            if (context.Controller.TempData != null &&
                context.Controller.TempData.Count() > 0)
            {
                throw new ApplicationException(
                     "TempData won't work with Server.TransferRequest!");
            }
            // change to false to pass query string parameters 
            // if you have already processed them
            httpContext.Server.TransferRequest(Url, true);

            // ASP.NET MVC 2.0
            //httpContext.RewritePath(Url, false);
            //IHttpHandler httpHandler = new MvcHttpHandler();
            //httpHandler.ProcessRequest(HttpContext.Current);
        }
    } 
```

但是，此方法需要在 IIS 上运行，或者 IIS Express Casinni 不支持 Server.Transfer 方法

# python - Python 中的类型转换

> ID：385572
> 
> 赞同：24
> 
> 时间：2008-12-22T04:35:18.190
> 
> 标签：python, string, int, bit, casting

我需要将 Python 中的字符串转换为其他类型，例如无符号和有符号 8、16、32 和 64 位整数、双精度、浮点数和字符串。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-12-22T04:44:48.280

您可以使用以下函数将字符串转换为 32 位有符号整数`int`：

```
str = "1234"
i = int(str)  // i is a 32-bit integer 
```

如果字符串不代表整数，则会出现`ValueError`异常。但是请注意，如果字符串确实表示一个整数，但该整数不适合 32 位有符号整数，那么您实际上会得到一个类型的对象`long`。

然后，您可以通过一些简单的数学将其转换为其他宽度和符号：

```
s8 = (i + 2**7) % 2**8 - 2**7      // convert to signed 8-bit
u8 = i % 2**8                      // convert to unsigned 8-bit
s16 = (i + 2**15) % 2**16 - 2**15  // convert to signed 16-bit
u16 = i % 2**16                    // convert to unsigned 16-bit
s32 = (i + 2**31) % 2**32 - 2**31  // convert to signed 32-bit
u32 = i % 2**32                    // convert to unsigned 32-bit
s64 = (i + 2**63) % 2**64 - 2**63  // convert to signed 64-bit
u64 = i % 2**64                    // convert to unsigned 64-bit 
```

您可以使用以下函数将字符串转换为浮点数`float`：

```
f = float("3.14159") 
```

Python 浮点数是其他语言所指的`double`，即它们是 64 位的。Python 中没有 32 位浮点数。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-22T12:15:11.537

以下类型——在大多数情况下——首先在 Python 中不存在。在 Python 中，字符串被转换为整数、长整数或浮点数，因为这就是全部。

您首先要求进行与 Python 无关的转换。这是您要求的类型列表及其 Python 等效项。

*   无符号和有符号 int 8 位，**int**
*   无符号和有符号 int 16 位，**int**
*   无符号和有符号整数 32 位，无符号：**long**，有符号**整数**
*   无符号和有符号 int 64 位， **长**

*   双， **浮动**

*   漂浮，**漂浮**
*   字符串， **这是你必须开始的**

我不知道以下是什么，所以我不知道 Python 等价物。

*   无符号和有符号 8 位，
*   无符号和有符号 16 位，
*   无符号和有符号 32 位，
*   无符号和有符号 64 位。

您已经拥有所有重要的转换`int()`：`long()`和`float()`。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-22T04:42:51.573

Python 只有一种`int`类型。要将字符串转换为`int`，请`int()`像这样使用：

```
>>> str = '123'
>>> num = int(str)
>>> num
123 
```

**编辑：**也转换为浮动，`float()`以完全相同的方式使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T16:22:34.143

如果没有更多信息，我认为这不一定能很好地回答。正如其他人所说，python 中的整数只有 int 和 long ——该语言不遵循低级编程语言的位宽和符号原型。

如果您完全在 python 中操作，那么您可能问错了问题。可能有更好的方法来做你需要的事情。

如果您正在与例如 C 代码或通过网络进行互操作，那么有**很多**方法可以做到这一点，看起来您之前帖子的答案非常方便地涵盖了该途径。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-02-05T15:42:07.887

我刚才遇到了一个问题，我有一个值作为 16 位有符号二进制补码从 modbus 传递。我需要将其转换为签名号码。我最终写了这个，这似乎工作正常。

```
# convert a 32 bit (prob) integer as though it was 
# a 16 bit 2's complement signed one
def conv_s16(i):
    if (i & 0x8000):
        s16 = -(((~i) & 0xFFFF) + 1)
    else:
        s16 = i
    return s16 
```

# vbscript - 使用 QTP 在通用文件夹中创建通用文件

> ID：385575
> 
> 赞同：-1
> 
> 时间：2008-12-22T04:36:30.370
> 
> 标签：vbscript, qtp

我通过从 DataTable 中获取名称创建了一个通用文件夹：

```
Dim fso
Set fso = CreateObject("Scripting.FileSystemObject")
strdata = Datatable.Value("Column name", "Sheet")
fso.CreateFolder "C:\Documents and Settings\schoudar\Desktop\" & strdata 
```

直到这我成功了，但现在我想在这个文件夹中保存一个文件，当我不这样做时，文件夹名称会改变。的迭代。所以我尝试了`CaptureBitmap`文件：

```
Browser("Browser").CaptureBitmap "C:\Documents and Settings\Desktop\ & strdata\filename.bmp" 
```

但它不起作用，所以请帮帮我。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-22T13:28:58.067

你遇到了什么错误？

只是一个猜测，修复引号和字符串附加：

```
Browser("Browser").CaptureBitmap "C:\Documents and Settings\Desktop\" & strdata & "\filename.bmp" 
```

# video - 作为开发人员，哪些演讲/视频吸引了您？

> ID：385586
> 
> 赞同：3
> 
> 时间：2008-12-22T04:47:33.033
> 
> 标签：video, computer-science

作为开发人员，哪些演讲/视频吸引了您？

我真的很喜欢 Clay Shirky 的演讲：
[http](http://www.youtube.com/watch?v=Xe1TZaElTAs)
://www.youtube.com/watch?v=Xe1TZaElTAs 以及 David 的 Startup School 演讲：
[http ://www.omnisio.com/startupschool08/david-heinemeier-hansson-在-startup-school-08](http://www.omnisio.com/startupschool08/david-heinemeier-hansson-at-startup-school-08)

你推荐哪些？如果可能，请提供链接和简短描述。

编辑：我知道有一个线程[什么是很棒的与编程相关的在线讲座/视频？](https://stackoverflow.com/questions/282534/what-are-great-programming-related-online-talks-videos)..但我正在寻找更一般的，而不是专门针对编程的谈话/视频。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-31T13:12:50.557

[来自 Googleplex](http://video.google.com/googleplex.html)的 Google视频通常很吸引人 - 有很多很棒的选择，我不想单独列出任何一个。

技术讲座非常适合各种不同的技术。主题还包括“时事、科学、工程、人文、商业、法律、娱乐、医学和艺术”！

此外，他们还有 Authors@Google 部分，其中包括杰出的演讲者“分享他们的想法”关于各种事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T04:53:10.213

Lawrence Lessig 曾经就软件开发和开源领域的知识产权发表过精彩的演讲。虽然不直接适用于日常开发技能，但我发现它很吸引人。我在 2003 年的 OOPSLA 会议上看到了它，但我相信他在许多其他场所也做过类似的演讲，也许它已经被录制了。他还写了一本很棒的书，名为《密码：与网络空间的其他法则》。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T21:56:29.597

[14 rules for website performance](http://video.yahoo.com/watch/1040890/3880720).

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-30T21:50:01.730

I liked quite a few of the TED talks, e.g. the one on OLPC.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-14T23:46:26.313

“如何将您的网站从 1 增加到 100 万用户”。Kevin Rose 在 FOWA 2009 上的精彩演讲

[http://vimeo.com/6905398](http://vimeo.com/6905398)

# computer-science - 讲座以 MP3/播客的形式提供？

> ID：385588
> 
> 赞同：23
> 
> 时间：2008-12-22T04:50:59.640
> 
> 标签：computer-science, podcast

有没有特别好的大学讲座可以在线下载为 MP3（或其他音频格式）？我特别有兴趣听到一些我在工程学位上没有上过的更高级的课程，比如编译器、操作系统、人工智能、密码学等。

还有一个关于[CS 视频讲座](https://stackoverflow.com/questions/119238/what-are-your-favorite-cs-video-lectures)的问题，但我想在我的 MP3 播放器上听讲座。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-22T04:56:30.690

[加州大学伯克利分校](http://webcast.berkeley.edu/courses.php)提供讲座的音频版本。如果您从所有类的未过滤列表中选择一个类，您可以订阅推送 .aac 文件的提要。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-22T05:00:49.743

麻省理工学院 OpenCourseWare 上的算法简介：

[http://ocw.mit.edu/OcwWeb/Electrical-Engineering-and-Computer-Science/6-046JFall-2005/LectureNotes/index.htm](http://ocw.mit.edu/OcwWeb/Electrical-Engineering-and-Computer-Science/6-046JFall-2005/LectureNotes/index.htm)

真的，麻省理工学院的开放式课程。

编辑：另外，如果你去iTunes Store点击左边的“iTunes U”，你会看到iTunes U，这是学术机构发布的*免费音频和视频讲座的集合。*没有*太多*深入的 CS 讲座，但如果你对“计算机科学”或类似的东西进行 Power Search，你会发现一些 CS 和 CE 主题。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-22T04:59:10.153

[斯坦福工程无处不在](http://see.stanford.edu/SEE/Courses.aspx)（也在 iTunes 上）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-22T07:00:48.613

如果您不介意更多学术资源，软件工程广播 ( [http://www.se-radio.net/](http://www.se-radio.net/) ) 很棒。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T09:47:38.980

大约在[CUDA](http://www.nvidia.com/object/cuda_home.html#)刚问世的时候，[这一系列讲座](http://courses.ece.uiuc.edu/ece498/al1/)就在 NVIDIA 的网站上提供。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-31T12:54:11.920

[有哪些好的技术播客？](https://stackoverflow.com/questions/1644/what-good-technology-podcasts-are-out-there)是一个类似的，非常受欢迎的问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-02T18:05:16.197

我尝试了一些（包括这里提到的），并且非常遗憾地我必须说可能没有值得听的。讲座本身非常好，但材料不适合只听 - 讲师不断参考他们的白板图纸，幻灯片等。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-12-10T20:39:48.100

我可以推荐伯克利的课程“[物理C10](http://muller.lbl.gov/teaching/Physics10/PffP.html) ”。更非正式的名称是未来总统物理学 (PffP)。它既内容丰富又有趣。

最新一期的 RSS 提要，音频版本：[2009 年秋季](http://webcast.berkeley.edu/media/common/rss/Letters_and_Science_C70V__001__Physics_C10__001_Fall_2009_Audio__webcast.rss)。它是 MP4 格式；早些年它是 MP3 格式的。

# vb.net - 如何使用 vb.net 隐藏/取消隐藏 MS Access DB 表单

> ID：385605
> 
> 赞同：0
> 
> 时间：2008-12-22T05:04:37.320
> 
> 标签：vb.net, ms-access

如果 Access DB 中的表单设置为隐藏。那么如何取消隐藏呢？这样我们就可以使用 vb.net 以编程方式操作表单。

谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T10:16:49.247

我无法在 VBA 中使用 .net：

```
Sub FormHidden()
Dim frm

    For Each frm In CurrentProject.AllForms
        SetHiddenAttribute acForm, frm.Name, False
    Next
End Sub 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T03:34:00.023

Remou 提供的代码应该适用于在 Access UI 中取消隐藏属性已更改为 HIDDEN 的表单。

在 VBA 中，为了简化 Remou 的示例，应该是：

```
SetHiddenAttribute acForm, "MyHiddenForm", False 
```

您可能需要从 VB.NET 自动化 Access 以完成此操作，但 SetHiddenAttribute 是顶级 Access 应用程序对象的方法，因此使用起来应该相当简单。名为常量 acForm 的 VBA 的值是 2，因此您可能必须按字面意思称呼它，如下所示：

```
app.Application.SetHiddenAttribute 2, "MyHiddenForm", False 
```

其中 app 对象已被初始化为 Access 应用程序。不知道这是如何在 VB.NET 中完成的，但在 VBA 中会是这样的：

```
Set app = CreateObject("Access.Application") 
```

我不确定正确的语法是 app.Application.SetHiddenAttribute 还是只是 app.SetHiddenAttribute，但您可以轻松尝试其中任何一种。

但请记住，是雷姆给出了正确答案。我只是在猜测如何让它在我什至不使用的编程环境中工作！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T05:52:40.093

表单是否具有 Visible 属性？您可以设置为 true 以使表单可见。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T03:58:04.583

您的意思是表单已打开但不可见，还是表单的元属性设置为不可见？后者是您不应该做的事情，因为设置为可见关闭的项目将在下次压缩数据库时被删除。

# internet-explorer - Websphere Portal 生成的 url 长于 2k

> ID：385614
> 
> 赞同：0
> 
> 时间：2008-12-22T05:13:28.690
> 
> 标签：internet-explorer, websphere, portal

我们有一个数据输入 portlet，它偶尔会生成超过 Internet Explorer 强制执行的 2k 限制的 url。

有什么方法可以阻止生成这些过长的 url 而不会丢失功能？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-22T14:31:41.527

你能用 POST 代替 GET 吗？如果不是，那么长 URL 指向什么？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-05T20:40:40.140

您使用的是哪个版本的 WebSphere Portal？

新的 Portal 6.1 有一个名为“Friendly URLs”的功能，旨在缓解其中的一些问题。我还没有机会研究它（我们仍在努力实现 6.0），但它可能对你有用。

也可以看看：

[有没有可以生成友好 URL 的 Portal 产品？](https://stackoverflow.com/questions/334987/are-there-any-portal-products-that-can-generate-friendly-urls)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-16T07:18:08.663

答案似乎是升级或确保页面足够简单而不会触发问题。

# php - 如何使用 PHP 对电子邮件地址进行模糊处理，以免垃圾邮件发送者轻松获取它们？

> ID：385620
> 
> 赞同：2
> 
> 时间：2008-12-22T05:26:47.273
> 
> 标签：php, regex, spam-prevention, email-spam

我正在使用 PHP 编程，并希望创建具有电子邮件地址的网页，这些电子邮件地址很容易被人类阅读，但不容易被垃圾邮件发送者收集。电子邮件地址来自用户输入，我想我可以使用正则表达式来识别地址，但我不清楚我应该如何替换电子邮件地址或用什么替换，以防止大多数自动垃圾邮件机器人收获它们。

这是一个想法：（伪代码）

```
(email)@(domain.com) $1<span class="remove">DELETE</span>$2

.remove {
   display: none;
} 
```

希望机器人会在 span 标签上绊倒。

最后，我正在寻找一种不会干扰`mailto:`标签内的电子邮件地址的解决方案。

**如何** [防止阻止机器人收集电子邮件地址？](https://stackoverflow.com/questions/311555/how-can-i-prevent-prevent-bots-from-collecting-e-mail-addresses#311629 "如何防止阻止机器人收集电子邮件地址？")哪些[方法可以保护网站上的电子邮件免受垃圾邮件机器人的侵害？](https://stackoverflow.com/questions/308772/what-are-some-ways-to-protect-emails-on-websites-from-spambots#309147 "有哪些方法可以保护网站上的电子邮件免受垃圾邮件机器人的侵害？")也许还有一些其他人......

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-22T06:22:53.463

## 使用[GD](http://in2.php.net/gd)并创建您的电子邮件 ID 的图像

您可以使用[PHP GD 库](http://in2.php.net/gd)轻松创建任何给定文本的图像。

示例代码如下所示，

```
<?php
  header("Content-type: image/png");
  $im = @imagecreate(110, 20)or die("Cannot Initialize new GD image stream");
  $background_color = imagecolorallocate($im, 0, 0, 0);
  $text_color = imagecolorallocate($im, 255, 255, 255);
  imagestring($im, 1, 5, 5,  "anything@domain.com", $text_color);
  imagepng($im);
  imagedestroy($im);
?> 
```

**好处：**

*   垃圾邮件发送者不能只捕获它，除非他们使用 OCR：p
*   非常低的开销，使用 PNG/GIF 格式
*   可以为任何文本动态创建

**缺点：**

*   无法点击邮件，作为链接
*   不能与 TTS 引擎一起使用，这是视觉障碍者的 -ve。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-22T07:17:34.070

您也可以使用 CSS 对其进行混淆...

```
<span class="email-encrypt">moc.liamelgoog@avynnib<span class="email-decrypt-message">(Reverse this text to get my Email address)</span></span>

/*Decrypt Email */
.email-encrypt {
    unicode-bidi:bidi-override;
    direction: rtl;
}
.email-encrypt .email-decrypt-message {
    display:none;
} 
```

编辑：这里，源中的电子邮件地址是相反的——CSS 语句的作用是将电子邮件地址恢复为其原始形式。我希望这是有道理的。

但我不确定这有多有效 - 有许多机器人模拟浏览器环境。我想我最好说类似的东西 - 我的电子邮件是 binnyva，googlemail。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-22T05:58:49.393

一种选择：[javascript 电子邮件混淆](http://www.google.com/search?hl=en&q=javascript+email+obfuscation&aq=f&oq=)，以及禁用 javascript 时的图像

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T07:51:36.593

上面的技巧（使用 CSS）几乎肯定不会奏效。我不知道机器人是否会费心看 CSS，事实上我不完全确定它们是否阅读 HTML，它们可能只是匹配某些正则表达式上的整个页面。

另一方面，这使得用垃圾邮件陷阱毒化他们的列表变得非常容易。如果您希望特定地址接收垃圾邮件（并且仅限垃圾邮件）来训练您的过滤器，您可以将电子邮件地址放在普通用户无法看到或点击的页面中，只有垃圾邮件机器人。

事实上，做一个实验——用不同类型的链接写一些不同的电子邮件地址，看看他们收到了多少垃圾邮件。

几个月前，我在我的网站上使用正常链接进行了尝试，在陷阱开始接收垃圾邮件之前花了大约三周时间。

# c++ - OpenGL中的绘制顺序

> ID：385629
> 
> 赞同：4
> 
> 时间：2008-12-22T05:42:06.340
> 
> 标签：c++, opengl

我正在渲染一个包含一些位图文本的 OpenGL 场景。我的理解是，我画东西的顺序将决定哪些物品在上面。

然而，我的位图文本，即使我是最后画的，也不在最上面！

例如，我正在绘制：

1) 背景
2) 按钮
3) 文字

都在相同的 z 深度。按钮在背景之上，但文本是不可见的。我改变了文本的 z 深度，我可以看到它，但是我还有其他问题。

我正在使用 Nehe 教程中的位图文本方法。

如何在不更改 z 深度的情况下使文本可见？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-22T05:53:55.207

您可以通过简单地禁用 z-test

```
 glDisable (GL_DEPTH_TEST);  // or something related.. 
```

如果这样做，您的文本基元的 Z 将被忽略。原语的绘制顺序与您调用 gl 函数的顺序相同。

另一种方法是通过 glPolygonOffset 设置一些恒定的 z 偏移量（不推荐）或将深度比较模式设置为 GL_LESS_EQUAL （EQUAL 是重要的）。这样可以确保以相同深度绘制的图元彼此叠加。

希望有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-29T16:30:05.120

您还可以使用 glDepthFunc (GL_ALWAYS)。

# python - 美国格式的电话号码到 Python 中的链接

> ID：385632
> 
> 赞同：2
> 
> 时间：2008-12-22T05:44:41.060
> 
> 标签：python, regex, mobile-website, phone-number

我正在编写一段代码来将电话号码转换为手机的链接——我知道了，但感觉真的很脏。

```
import re
from string import digits

PHONE_RE = re.compile('([(]{0,1}[2-9]\d{2}[)]{0,1}[-_. ]{0,1}[2-9]\d{2}[-_. ]{0,1}\d{4})')

def numbers2links(s):
    result = ""
    last_match_index = 0
    for match in PHONE_RE.finditer(s):
          raw_number = match.group()
          number = ''.join(d for d in raw_number if d in digits)
          call = '<a href="tel:%s">%s</a>' % (number, raw_number)
          result += s[last_match_index:match.start()] + call
          last_match_index = match.end()
    result += s[last_match_index:]
    return result

>>> numbers2links("Ghost Busters at (555) 423-2368! How about this one: 555 456 7890! 555-456-7893 is where its at.")
'Ghost Busters at <a href="tel:5554232368">(555) 423-2368</a>! How about this one: <a href="tel:5554567890">555 456 7890</a>! <a href="tel:5554567893">555-456-7893</a> is where its at.' 
```

无论如何我可以重组正则表达式或我用来使这个更清洁的正则表达式方法吗？

**更新**

澄清一下，我的问题不在于我的正则表达式的正确性——我意识到它是有限的。相反，我想知道是否有人对在链接中替换电话号码的方法有任何评论 - 无论如何我可以使用`re.replace`或类似的东西来代替我拥有的字符串黑客？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T19:26:03.587

不错的第一次尝试:) 我认为这个版本更具可读性（并且可能快一点）。这里要注意的关键是[re.sub](http://docs.python.org/library/re.html#module-contents)的使用。让我们远离讨厌的匹配索引...

```
import re

PHONE_RE = re.compile('([(]{0,1}[2-9]\d{2}[)]{0,1}[-_. ]{0,1}[2-9]\d{2}[-_.  ]{0,1}\d{4})')
NON_NUMERIC = re.compile('\D')

def numbers2links(s):

   def makelink(mo):
      raw_number = mo.group()
      number = NON_NUMERIC.sub("", raw_number)
      return '<a href="tel:%s">%s</a>' % (number, raw_number)

   return PHONE_RE.sub(makelink, s)

print numbers2links("Ghost Busters at (555) 423-2368! How about this one: 555 456 7890! 555-456-7893 is where its at.") 
```

注意：在我的实践中，我没有注意到像我正在使用的两个这样的简单正则表达式的预编译有太多的加速，即使你使用它们数千次。re 模块可能有某种内部缓存 - 没有费心阅读源代码和检查。

另外，我替换了您检查每个字符以查看它是否`string.digits`包含在另一个字符中的方法，`re.sub()`因为我认为我的版本更具可读性，而不是因为我确定它的性能更好（尽管它可能）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T06:37:28.287

为什么不重复使用其他人的工作——例如来自[RegExpLib.com](http://regexlib.com/REDetails.aspx?regexp_id=458)的工作？

我的第二个建议是记住除了美国之外还有其他国家，其中不少国家都有电话 ;-) 在您的软件开发过程中请不要忘记我们。

此外，还有电话号码格式的标准；国际电联的[E.123](http://en.wikipedia.org/wiki/E.123)。我对标准的回忆是，它所描述的内容与流行的用法不太匹配。

编辑：我混淆了 G.123 和 E.123。哎呀。道具[Bortzmeyer](https://stackoverflow.com/users/15625/bortzmeyer)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T08:55:16.840

您的正则表达式仅解析特定格式，这不是国际标准。如果您将自己限制在一个国家，它可能会奏效。

否则，国际标准是[ITU E.123](http://www.itu.int/rec/T-REC-E.123/en)：“国家和国际电话号码、电子邮件地址和 Web 地址的符号”

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T09:41:01.817

首先，使用单个正则表达式可靠地捕获电话号码是出了名的困难，而且很可能是不可能的。并非每个国家/地区都有像美国一样狭窄的“电话号码”定义即使在美国，事情也比看起来更复杂（来自[维基百科关于北美编号计划](http://en.wikipedia.org/wiki/North_American_Numbering_Plan)的文章）：

*   A) 国家代码：可选前缀（“1”或“+1”或“001”）
    *   `((00|\+)?1)?`
*   B) 编号计划区号 (NPA)：不能以 1 开头，数字 2 不能是 9
    *   `[2-9][0-8][0-9]`
*   C) 交换代码（NXX）：不能以 1 开头，不能以“11”结尾，可选括号
    *   `\(?[2-9](00|[2-9]{2})\)?`
*   D）站号：四位数字，不能都是0（我想）
    *   `(?!0{4})\d{4}`
*   E) 一个可选的扩展可能会跟随
    *   `([x#-]\d+)?`
*   S) 数字的部分由空格、破折号、点（或不）分隔
    *   `[. -]?`

因此，美国的基本正则表达式将是：

```
((00|\+)?1[. -]?)?\(?[2-9][0-8][0-9]\)?[. -]?[2-9](00|[2-9]{2})[. -]?(?!0{4})\d{4}([. -]?[x#-]\d+)?
| A       |S   |  |   B                | S   |   C             | S  |  D           | S  |  E      | 
```

这只是针对美国相对微不足道的编号计划，即使在那里也肯定没有涵盖所有细微之处。如果你想让它变得可靠，你必须为所有预期的输入语言开发一个类似的野兽。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T05:57:05.917

一些可以在不真正改变功能的情况下清理现有正则表达式的东西：

将 {0,1} 替换为 ?，将 [(] 替换为 (，[)] 替换为 )。你也可以把你的 [2-9] 设为 \d ，这样你就可以让这些模式成为最后一部分的 \d{3} 和 \d{4} 。我怀疑它真的会增加误报率。

# iis-6 - SSLv3 和 TLS1.0 之间有区别吗？

> ID：385634
> 
> 赞同：22
> 
> 时间：2008-12-22T05:47:07.157
> 
> 标签：iis-6, ssl

SSLv3 和 TLSv1 之间有区别吗？IIS6.0 如何控制启用 HTTPS 的网站使用哪种类型的安全性？

MS说有一个层次结构，在建立连接之前协商安全和加密级别。这个层次结构是什么？

SSLv3 在 Windows Server 2003 上是否默认在 IIS6.0 中可用？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-22T06:19:20.367

SSLv3 和 TLSv1 不一样，但是 TLSv1 是基于 SSLv3 的。

这是一个向后兼容的协议，它提供了一种根据客户端和服务器之间发生的“握手”来确定使用哪个版本的方法。

在这里阅读更多（这有助于我更好地理解它）：[http ://en.wikipedia.org/wiki/Secure_Sockets_Layer](http://en.wikipedia.org/wiki/Secure_Sockets_Layer)

# sql - 使用 SQL 获取每小时统计信息

> ID：385656
> 
> 赞同：3
> 
> 时间：2008-12-22T06:11:06.983
> 
> 标签：sql, oracle, oracle10g, report

我们有一个表，名称为*“employeeReg”*，其中包含字段

```
employeeNo | employeeName | Registered_on 
```

这里*Registered_on*是一个时间戳。

我们需要在几天内按小时进行注册。例如。

> 08 年 1 月 1 日 : 12 - 01 PM : 1592 注册
> 
> 08 Jan 01 : 01 - 02 PM : 1020 注册

有人可以建议对此进行查询。

* * *

我们使用 Oracle 10gR2 作为我们的数据库服务器。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-22T06:33:08.637

[这与关于每天有多个条目时如何获取每天的最新记录的](https://stackoverflow.com/questions/384142/how-to-get-latest-record-for-each-day-when-there-are-multiple-entries-per-day)问题密切相关，但略有不同。（*与很多很多 SQL 问题有一个共同点 - 最初没有给出表名！*）

基本技术将是找到一个函数，该函数将格式化不同的 Registered_on 值，以便将特定小时内的所有条目组合在一起。这大概可以完成，`TO_CHAR()`因为我们正在处理 Oracle（MySQL 不支持这一点）。

```
SELECT TO_CHAR(Registered_on, "YYYY-MM-DD HH24") AS TimeSlot,
       COUNT(*) AS Registrations
    FROM EmployeeReg
    GROUP BY 1
    ORDER BY 1; 
```

您也许可以用 TimeSlot 或`TO_CHAR()`表达式替换“1”条目；但是，出于向后兼容性的原因，这很可能会像编写的那样工作（但我无法在 Oracle 上为您验证 - 在 IBM Informix Dynamic Server 上使用`EXTEND(Registered_on, YEAR TO HOUR)`代替 的等效项可以正常工作`TO_CHAR()`）。

如果您随后决定在没有条目的情况下希望在几个小时内出现零，那么您将需要创建一个您确实希望报告的所有小时的列表，并且您需要对该列表进行 LEFT OUTER JOIN 结果从这个查询。困难的部分是生成正确的列表——不同的 DBMS 有不同的方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T11:09:52.543

**用:)**实现了我想要的****

 **```
SELECT TO_CHAR(a.registered_on, 'DD-MON-YYYY HH24') AS TimeSlot,
       COUNT(*) AS Registrations
    FROM EmployeeReg a
    Group By TO_CHAR(a.registered_on, 'DD-MON-YYYY HH24'); 
```

# asp.net - 动态 asp.net 用户控件中的事件处理

> ID：385658
> 
> 赞同：0
> 
> 时间：2008-12-22T06:18:18.247
> 
> 标签：asp.net, events, dynamic, controls, delegates

我有一个页面，我想在其中动态添加 asp.net 用户控件。场景是我们希望在控件的特定事件上，它会自行处理并在页面中加载另一个控件。

我无法解决如何做到这一点？

有人有好的想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-22T06:28:58.333

Webforms 还是 ASP.NET MVC？我会假设网络表单...

尝试使用 CompositeControl。如果涉及数据绑定，您可以使用 DataBoundCompositeControl。在 CreateCHildren 方法中，您可以动态创建控件并将它们添加到子集合中。下面是一个我创建过的相当复杂的 DataBoundCompositeControl 的示例（在内部子控件上进行事件处理）：

[脚手架控制](http://www.codeplex.com/NBusiness/SourceControl/changeset/view/45016#308876)

这实际上是一件很难做到的事情。只要记住每次都重建所有子控件并存储控件的状态，以便您可以正确地重新创建所有内容。

您将在回发时重建所有内容两次（并且在第一次 GET 上重建一次）。一次将控件重新创建到以前的状态，第二次处理数据绑定和事件处理后的更改。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-27T16:00:37.073

让我们假设这种情况：

*   您有一个购物车页面。
*   装运控制已加载。
*   用户单击下一步按钮。

--- 回传 ---

1.  购物车页面已加载
2.  装运控制已加载。
3.  事件“点击”由装运控制处理。
4.  出货控制被处置。
5.  支付控制已加载。

您可以在 Session 实例中存储一个变量来确定需要加载哪个控件。

在购物车页面的 PageInit 中检索 Session 变量并加载相应的控件（步骤 1 和 2）。确保在 PageInit 中执行此操作，以便 ASP.NET 触发事件。

然后在装运控件的事件处理程序中更新 Session 变量（步骤 3）。

在购物车页面的 Page_LoadComplete 中，您处理装运控件（第 4 步）并加载付款控件（第 5 步）。

Scott Mitchell 写了一篇关于这种情况的精彩文章：http: [//scottonwriting.net/sowBlog/posts/3962.aspx](http://scottonwriting.net/sowBlog/posts/3962.aspx)

# c++ - 如何在 win32 中为 RichEdit 设置回调机制

> ID：385660
> 
> 赞同：0
> 
> 时间：2008-12-22T06:19:58.307
> 
> 标签：c++, winapi, ipc, callback, richedit

**在win32中，我如何为我自己没有创建的RichEdit设置回调机制？**

**第1部分**

[我正在阅读另一个应用程序 GUI 中的 textedit 字段](https://stackoverflow.com/questions/352236/reading-from-a-text-field-in-another-applications-window)。这现在工作得很好，除了第一次阅读后我只想获取新的或修改的行。在 GTK+ 或 Qt 中，我只需在字段更改时编辑的某些信号上安装回调，但它在 Win32 上如何工作？

我的 MSDN 搜索结果没有任何用处，可能是因为我不知道要搜索的确切术语。textedit 的类是[RichText20W](http://msdn.microsoft.com/en-us/netframework/bb787877(VS.85).aspx)，它有一些可能以某种方式使用的[消息](http://msdn.microsoft.com/en-us/netframework/bb774366(VS.85).aspx)，尽管那篇文章只是讨论了将它们用于类的父级。

**第2部分**

另外，*如果*没有这样的“文本更改，这里是新插入的文本”回调立即返回新内容，我需要一些方法来轻松检测新内容。从我的头顶：

1.  在我们阅读的文本块的末尾有一个标记，并且只在它和结尾之间阅读。
2.  存储我们之前读过的内容，并在第二次阅读后，从后者中删除重复的部分以获取新插入的内容。

选项 2 可能不可行，因为 textedit 可以包含任意数量的文本。标记部分听起来可行，但再一次，我微弱的 Win32 技能和可怕的 Win32 函数名称使我无法找到正确的方法。

*请注意，对于我**不**拥有且未创建的文本编辑器，所有这些都必须是可行的，它们属于第三方进程。*

**高度赞赏 C++ 中的代码示例。**

*免责声明*

显然，如果有更好的方法，请告诉我。根据我之前使用 GTK+/Qt 的经验，我只假设回调是可行的方法。随意告诉我路径:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T18:48:51.243

Win32 控件不适用于您可以订阅的特定于消息的回调。他们只是在发生某些事情时向其父窗口发送消息，在本例中为 EN_UPDATE、EN_CHANGE 等等。即使是这些事件也不会告诉你什么文本发生了变化。他们只告诉你它*确实*改变了。

您可以将父级子类化，但 SetWindowLongPtr 的文档明确表示您“不应子类化由另一个进程创建的窗口类”。使用钩子可能会发生这样的事情，但我还没有充分使用它们来确定你实际上是如何做到的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-19T21:11:15.910

我意识到这是一篇旧文章，但[这篇](http://www.codeproject.com/KB/macros/Extended_Outlook_Textbox.aspx)文章似乎在做类似的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T09:25:13.640

根据 Joel 的回答，我不再寻找回调，而是创建了一个小类，将自身（不是通过真正的 API 挂钩）连接到 Richedit 并每秒轮询一次内容长度，以及自上次轮询以来它是否已更改，它会询问内容，将其与先前已知的内容进行比较，并使用更改的内容发出信号。

为此目的，这似乎可以正常工作，但是如果有人仍然知道更好的方法（通过 API 挂钩或其他方式进行的一些真实且经过测试的方法），请发布。

# emacs - 如何突出显示 Emacs 缓冲区中所有出现的单词？

> ID：385661
> 
> 赞同：85
> 
> 时间：2008-12-22T06:20:39.567
> 
> 标签：emacs, highlighting

Notepad++ 有一个方便的功能：如果您在文本中选择一个词（不一定是关键字），该词会在整个文本中突出显示。这也可以在 Emacs 中完成吗？如果是这样，怎么办？

它不一定必须像 Notepad++ 一样工作（即，通过选择）；理想情况下，我想设置一个键绑定，使光标下所有出现的单词都被突出显示。

如果突出显示是永久性的，那就太好了，即，将点从突出显示的单词移开不应*导致*突出显示被删除。

此外，如果有一种解决方案可以在高亮之间导航（使用自定义键绑定），那将很有用。

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2009-01-09T04:11:12.427

`hi-lock`建议很好。`M-x`不过，我认为使用这些版本更容易：

`M-x` `highlight-regexp` `RET` `<REGEXP>`

`M-x` `highlight-phrase` `RET` `<REGEXP>`

`highlight-phrase`只是`highlight-regexp`忽略大小写并转换正则表达式中的空格以匹配任意空格的糖。便利。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-12-23T00:50:53.773

[也许http://nschum.de/src/emacs/highlight-symbol/](http://nschum.de/src/emacs/highlight-symbol/)上的highlight-symbol.el是您正在寻找的：

![替代文字](https://nschum.de/src/emacs/highlight-symbol/highlight-symbol.png)

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2008-12-22T08:53:30.727

键入`C-s`，然后键入当前单词或类型`C-w`。作为奖励，您现在可以`C-s`再次点击以搜索该单词。

这称为*增量搜索*。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2011-04-28T08:59:45.943

我用的是idle-highlight

[http://www.emacswiki.org/emacs/IdleHighlight](http://www.emacswiki.org/emacs/IdleHighlight)

> Mx idle-highlight 设置一个空闲计时器，它突出显示该点下单词缓冲区中的所有出现。

要为所有编程模式启用它，请在`~/.emacs.d/init.el`：

```
;; highlight words
(add-hook 'prog-mode-hook (lambda () (idle-highlight-mode t))) 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-12-22T06:39:10.997

[Light-symbol](http://www.emacsblog.org/2007/04/17/quick-tip-light-symbol-mode/)将突出显示任何符号点结束。

或者，您可以使用[发生](http://emacslife.blogspot.com/2007/05/occur.html)，它列出了与正则表达式匹配的所有行。快速查看类中的所有函数很有用。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2019-04-22T23:26:00.833

没有人提到[`symbol-overlay`mode](https://github.com/wolray/symbol-overlay/)。它基本上是一个更好的重写`highlight-symbol-mode`。“更好”如中，缺少原始高亮符号的错误*（例如，临时高亮卡住，或临时高亮在突出显示的单词内移动而消失；或无法突出显示符号等`*`）*，更好地集成和维护。请参阅其自述文件的“优势”段落。

您可以像往常一样安装它，使用`M-x``package-install` *（确保事先使用更新包列表`package-list-packages`）*。作为参考，我在底部附加了用于启用该模式并禁用一些您可能想要或可能不想要的更高级功能的代码。

> Notepad++ 有一个方便的功能：如果您在文本中选择一个词（不一定是关键字），该词会在整个文本中突出显示。这也可以在 Emacs 中完成吗？如果是这样，怎么办？

启用`overlay-symbol`后，屏幕上将显示您在超时后放置光标的每个单词的出现次数*（默认超时为 0.5 秒，可以使用`symbol-overlay-idle-time`变量进行配置）*。如果一个词没有突出显示，这意味着屏幕上只有一个匹配项*（您将光标放在的那个）*，因此无需突出显示它。

> 如果突出显示是永久性的，那就太好了，即，将点从突出显示的单词移开不应导致突出显示被删除。

要永久突出光标下的单词，有一个功能`symbol-overlay-put`。要取消突出显示，请再次调用它。

在我的配置示例中，它绑定到`Logo`+```键。

* * *

```
(require 'symbol-overlay)
(defun enable-symbol-overlay-mode ()
  (unless (or (minibufferp)
              (derived-mode-p 'magit-mode)
              (derived-mode-p 'xref--xref-buffer-mode))
    (symbol-overlay-mode t)))
(define-global-minor-mode global-symbol-overlay-mode ;; name of the new global mode
  symbol-overlay-mode                                ;; name of the minor mode
  enable-symbol-overlay-mode)
(global-symbol-overlay-mode)                         ;; enable it
(global-set-key (kbd "s-`") 'symbol-overlay-put)
(setq symbol-overlay-ignore-functions nil)           ;; don't ignore keywords in various languages
(setq symbol-overlay-map (make-sparse-keymap))       ;; disable special cmds on overlays 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-12-22T06:37:27.193

这可能不如你希望的那么好，但如果你把

```
(global-hi-lock-mode 1) 
```

在您的`.emacs`文件中，您可以键入`C-x w h REGEX <RET> <RET>`以突出显示所有出现的`REGEX`，并`C-x w r REGEX <RET>`再次取消突出显示它们。再一次，没有你想的那么优雅，但它会起作用。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2013-08-22T16:09:22.717

试试[http://www.emacswiki.org/emacs/msearch.el](http://www.emacswiki.org/emacs/msearch.el) 用光标选择的文本的所有出现都会突出显示。您必须拖动要突出显示的字符串。这使您能够轻松更改选择而不更改突出显示。

如果要保留字符串的突出显示，可以将其冻结。

您可以将一个缓冲区奴役到另一个缓冲区。在主缓冲区中选择的文本也将在从缓冲区中突出显示。这对于比较缓冲区很有用。当您在另一个缓冲区中调查文本时，它也可用于在一个缓冲区中记笔记。您可以在注释缓冲区中有一组关键字。拖动这样的关键字，它在调查文本中的出现将被突出显示。

我用这个东西很多年了。我最近添加了冷冻。所以，也许有些东西坏了。如果是这种情况，请在 [http://www.emacswiki.org/emacs/msearch](http://www.emacswiki.org/emacs/msearch)或此处给我留言。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-12-22T06:37:38.863

检查[交互式突出显示](https://www.gnu.org/software/emacs/manual/html_node/emacs/Highlight-Interactively.html)

应该：

`C`-`x` `w` `h`字`<RET>` `<RET>`

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-09-05T06:38:39.737

库中的命令[`highlight.el`](http://www.emacswiki.org/emacs-en/download/highlight.el) 允许您（取消）突出显示匹配正则表达式（在本例中为符号）的文本，使用覆盖或文本属性。您可以在事件之间循环。突出显示可以是暂时的或持久的。[（更多信息）](http://www.emacswiki.org/emacs/HighLight)。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-10-31T03:45:30.290

试试[iedit](https://github.com/victorhge/iedit)。它突出显示该单词，并让您轻松编辑所有出现的单词。通过额外的击键（C-'），它会隐藏所有没有该单词的行。非常便利！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-02-20T18:46:54.783

这可能不会突出显示，但会在您无需键入的情况下搜索单词...

当你找到你想搜索的单词时，CS，然后用 CW 阅读完整的单词，然后你可以 CS，它会搜索它。在我的 Emacs 中，它还突出显示了文档中的所有实例。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-10-23T12:55:34.397

这个包在 Melpa 作品中可用，您也可以自定义高亮样式。

[https://github.com/ignacy/idle-highlight-in-visible-buffers-mode](https://github.com/ignacy/idle-highlight-in-visible-buffers-mode)

# database - 测试数据生成器/生成可靠、非重复但不真实的数据库样本数据的最快途径？

> ID：385667
> 
> 赞同：0
> 
> 时间：2008-12-22T06:30:06.523
> 
> 标签：database, testing, sample-data

我需要为客户建立一个远程数据库的快速可行性测试/概念验证，其中将填充大多数典型的公司和人员数据（姓名、地址等）；150K 左右的记录。这里提到的示例数据库很有帮助：

[我在哪里可以找到可以在多个数据库引擎中使用的具有通用格式数据的示例数据库？](https://stackoverflow.com/questions/57068/good-databases-with-sample-data)

...但是，我也希望能够在不太典型的数据集上轻松生成这样的样本数据。有人对现成（或离线）解决方案有任何建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T06:42:32.067

对于 SQL Server，有一个很好的解决方案：[RedGate SQL Data Generator](http://www.red-gate.com/Products/SQL_Data_Generator/)。它并不便宜，但它的工作非常好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T06:41:23.253

我找不到一个好的现成的，所以我们基于一些简单的概念构建了一个。如果您没有找到任何好的答案，请告诉我，我将分享您需要的结构和任何文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T06:49:21.133

[在这里](https://stackoverflow.com/questions/19162/php-script-to-populate-mysql-tables)查看我对这个早期问题的回答。

不确定您使用的是什么数据库，但希望它证明是有用的。我自己还没有使用过这个工具，但是当我通过链接时，我听到了更多好的报告。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-02T00:46:18.800

这次为了我的特定需求（在这种情况下主要是“人”），我最终以 25 美元的价格购买了 Fake Name Generator 的 100 万个假名 CSV 文件。对于我需要的数据量来说，这似乎是最快/最简单的路线。如果您的需求相似，值得检查：

[http://www.fakenamegenerator.com/](http://www.fakenamegenerator.com/)

[http://www.fakenamegenerator.com/order.php](http://www.fakenamegenerator.com/order.php)

# data-visualization - c++中的多线程科学数据可视化

> ID：385677
> 
> 赞同：2
> 
> 时间：2008-12-22T06:40:02.477
> 
> 标签：data-visualization

我有一个从传感器生成数据向量的过程。我在 IA-32 上使用 Intel Integrated Performance Primitives v5.3 update 3 for Windows 来进一步处理它以进行一些计算。我想知道是否有任何 c++ 库它允许在数据采集期间将向量绘制为直方图/条形图。我可以编写多线程代码，但需要有关 C++ 中绘图函数可用性的信息。这件事在 MATLAB 中很简单，但我想用 c++ 来做。

欢迎提出建议！！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-22T07:22:22.300

您可以尝试以下方法之一：

*   [条形图](http://www.codeproject.com/KB/miscctrl/CBarChart.aspx)
*   [科学的图表控制](http://www.codeproject.com/KB/miscctrl/xgraph.aspx)
*   [高速图表控制](http://www.codeproject.com/KB/miscctrl/High-speedCharting.aspx)
*   [VTK](http://www.vtk.org/)
*   [图表总监](http://www.advsofteng.com/)
*   [图表库](http://www.gigasoft.com/)
*   [图表](http://www.fred.net/brv/chart/)
*   [卡纳克图表库](http://www.int.com/products/2d/carnac/chart_component.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T21:22:36.470

如上所述，VTK 是一个开源 C++ 可视化库。更重要的是，它是按设计并行化的。它会尝试使用你能给它的任何硬件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T07:50:34.550

我使用 OpenInventor 进行科学可视化。它可能（在某些方面）是旧 SGI 时代的遗物，但它仍然受到支持并且运行良好。关于绘图和其他科学可视化，请查看 Mercury 的 MeshViz 和其他扩展：

*   [Mercury（以前称为 TGS）OpenInventor](http://www.tgs.com/)或[Coin](http://www.coin3d.org/)，双许可（GPL + 商业）替代方案
*   [MeshViz 扩展](http://www.tgs.com/products/oiv_mesh_viz_overview.asp)

它有图表，矢量可视化等。它非常全面。

它不是免费的，但他们提供试用许可证，因此您可以确定它是否适合您的需求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-24T18:55:00.640

[MathGL](http://mathgl.sourceforge.net/)绘图函数可以在单独的线程中执行，并且可以在用户端进行并行化。

# c# - 如何知道已请求哪个图像 C#,ASP.Net

> ID：385681
> 
> 赞同：0
> 
> 时间：2008-12-22T06:44:51.377
> 
> 标签：c#, asp.net

我正在开发一个网络应用程序。这将生成一个指向我服务器上图像的随机链接。像 - [http://dummy.com/Images/Image1.jpg?id=19234](http://dummy.com/Images/Image1.jpg?id=19234)

在这里，任何人都可以在他们的网站上使用这个链接，现在我只想知道有多少网站正在使用我的链接，而没有任何人点击这些链接。

可以使用 HTTPModule 完成吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T06:49:48.650

这和谷歌搜索一样简单吗？搜索

```
link:http://dummy.com/Images/Image1.jpg?id=19234 
```

如果您想以编程方式执行此操作，则需要使用 Google API。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T10:30:09.767

使用 HttpHandler 时遇到的问题是，它通常只会启动由 ASP.Net 引擎处理的请求——图像请求通常由 IIS 处理，而不通过处理程序。

您的网络日志应该能够告诉您服务器上任何给定项目的引用者是谁 - 假设您拥有它们，并且您有一些东西可以处理它们 - 这将比使用 Google 更准确。

展望未来，我过去这样做的一种方法是让 HttpHandler 生成图像（实现 IHttpHandler）。

这会将图像作为流返回（将内容类型设置为“image/jpeg”），并且您可以添加进一步的处理（例如记录请求（引用者）的来源等）。

我在 HttpHandler 中发现的限制是某些服务（例如 PBBS）需要图像链接才能具有图像扩展名 - 我通过使用 ASP.Net 页面处理所有 404 来解决这个问题，该页面检查 .jpg 扩展名要求。如果它找到一个，而不是返回通常的 404 页面，它会返回重新请求的图像。不过，您需要在 IIS 中配置 404 处理程序，因为 web.config 错误处理程序仅适用于 ASP.Net 请求（Web 服务和 .aspx 类型的页面）。

示例处理程序：

```
// Sample from the ASP.Net Personal Web Site Starter Kit
public class Handler : IHttpHandler
{
    public bool IsReusable
    {
        get { return true; }
    }

    public void ProcessRequest(HttpContext context)
    {
        // Set up the response settings
        context.Response.ContentType = "image/jpeg";
        context.Response.Cache.SetCacheability(HttpCacheability.Public);
        context.Response.BufferOutput = false;

        // QueryString parameters are available here:
        // context.Request.QueryString["QueryStringKey"]

        // You can also access the Referrer object, and log the requests here.

        Stream stream;
        // Read your image into the stream, either from file system or DB
        if (stream == null)
        {
            stream = PhotoManager.GetPhoto();
        }

        // Write image stream to the response stream
        const int buffersize = 1024 * 16;
        var buffer = new byte[buffersize];
        int count = stream.Read(buffer, 0, buffersize);
        while (count > 0)
        {
            context.Response.OutputStream.Write(buffer, 0, count);
            count = stream.Read(buffer, 0, buffersize);
        }
    }
} 
```

您可以在 404 页面中有类似的代码（或者更好的是，将主图像流代码重构为共享类），检查图像扩展是否存在，并以这种方式呈现图像（再次设置内容类型， ETC）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T07:47:47.707

异想天开是对的。请参阅[http://code.google.com/intl/en/apis/ajaxsearch/documentation/#fonje_snippets](http://code.google.com/intl/en/apis/ajaxsearch/documentation/#fonje_snippets)或 Google 的 API。他们提供了 PHP 和 Java 的示例，但也有用于 ASP.NET ( [http://www.asp.net/ajax/](http://www.asp.net/ajax/) ) 的 AJAX 框架，我相信 C# 也是如此。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T10:43:33.297

**您可以将您的图像扩展名更改为 aspx 扩展名**（[http://dummy.com/Images/Image1.aspx?id=19234](http://dummy.com/Images/Image1.aspx?id=19234)），这没有问题，因为这个页面唯一会做 Response.OutputStream 的图片。也就是说，它类似于 jpg，但优点是您可以处理一些其他代码。

在这个 aspx 中（在输出图像之前），我们会询问 http_referer，如果此注册表不存在，它将存储在数据表中。

例如，如果您想限制对图像的访问，这非常有用。如果他们未登录，您可以添加一些逻辑来禁止。

# c# - System.Runtime.InteropServices.ComTypes.IStream 到 System.IO.Stream

> ID：385684
> 
> 赞同：2
> 
> 时间：2008-12-22T06:47:49.403
> 
> 标签：c#, .net, com, interop, pinvoke

在 .NET 3.0 项目中，我需要通过 P/Invoke 进行一些调用（特别是对像 PTConvertPrintTicketToDevMode() 这样的 PrintTicket Provider 函数）。

该框架具有 COM IStream 接口的托管定义： [System.Runtime.InteropServices.ComTypes.IStream](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.comtypes.istream_members.aspx "System.Runtime.InteropServices.ComTypes.IStream")

我需要它作为 System.IO.Stream，以便我可以轻松地将 .NET 类（如 XmlDocument）与这些导入函数的输出一起使用。但是，除了一次读取和写入一个字节块数据之外，我看不到将它来回转换为[System.IO.Stream的更痛苦的方法。](http://msdn.microsoft.com/en-us/library/system.io.stream_members.aspx "System.IO.Stream")对于一项看起来很常见的任务来说，这似乎太笨拙了。

还是我走错了路？

我将[PTConvertPrintTicketToDevMode](http://msdn.microsoft.com/en-us/library/ms536106(VS.85).aspx "PTConvertPrintTicketToDevMode") () 导入为：

```
 [DllImport("prntvpt.dll")]
    public static extern int 
    PTConvertPrintTicketToDevMode(IntPtr hProvider, 
                                  IStream pPrintTicket,
                                  EDefaultDevmodeType baseDevmodeType,
                                  EPrintTicketScope scope,
                                  IntPtr pcbDevmode,
                                  out IntPtr ppDevmode,
                                  [MarshalAs(UnmanagedType.BStr)]out String pbstrErrorMessage); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T07:22:54.043

这不是很简单（即框架中没有内置的方法），但想法是实现一个实现 System.Runtime.InteropServices.ComTypes.IStream 的类。这是带有代码的文章。文章没有实现Write方法，不过应该还要10分钟才能写完。看看这个。[http://www.sturmnet.org/blog/archives/2005/03/03/cds-csharp-extractor](http://www.sturmnet.org/blog/archives/2005/03/03/cds-csharp-extractor)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T00:05:54.220

您不需要 PInvoke，.Net 中的[PrintTicketConverter](http://msdn.microsoft.com/en-us/library/system.printing.interop.printticketconverter.convertprinttickettodevmode.aspx)类型已经为您执行此操作

# c# - 是和否值的枚举的好名字是什么

> ID：385688
> 
> 赞同：10
> 
> 时间：2008-12-22T06:57:32.630
> 
> 标签：c#, coding-style, naming-conventions, naming

# 背景

在我正在编写的 C# 命令行应用程序中，一些参数具有“yes”和“no”作为可能值。

我使用如下所示的 Enum 类型存储他们的输入。

```
enum YesNo
{
     Yes,
     No
} 
```

这很好 - 代码有效。那里没问题。

注意：是的，我可以将这些存储为 bool（这就是它过去的工作方式）。我的设计选择是明确说明用户做出的 Yes/No 选择，因为他们会在其他上下文中看到这个打印，我希望它更明显地选择是什么。

# 我的问题

*   有一个名为“YesNo”的枚举似乎很奇怪 - 对于“是”和“否”值的枚举更好的名称有什么建议。

# 所以最后

我在 StackOverflow 的早期就问过这个问题。这不是假问题——我确实遇到过这种情况。我只是觉得用它看看社区会做什么会很好。因为它是，我承认一个有点奇怪的问题。

首先，感谢所有花时间回复的人。我试图用一个深思熟虑的结论来回报。

对答案的评论

**切换到 bool**。我理解你的动机，但我觉得我需要指出**二元**选择（我的意思是在任何两个值之间进行选择 - 活着/死去，已婚/未婚等）与**布尔**选择不同真假。我们发现程序员在是/否和真/假之间切换很容易——这很公平。如果在这种情况下我的选择是例如“Democrat”或“Replication”（我知道这是人为的例子），那么您会看到混淆或至少尴尬的可能性。我确实认为 bool 选项在这种情况下是有效的，但更少所以在其他二元选择中。

**本地化**- 重点。在我的具体情况下，这并不重要 - 这不是而且永远不会被本地化，但对于其他情况，这是需要考虑的事情。

**超过三个选项**- 事实上，后来我不得不添加第三个值来表示用户的有效（在我的应用程序中）条件，特别是*没有*做出选择。

有很多好的评论，谢谢大家！

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-12-22T07:07:24.403

您说您不想使用 bool ，因为它将被打印出来供用户查看其他内容。这表明问题不在于*storage*，而在于*display*。无论如何将真/假呈现为是/否，但没有必要为它创建一个全新的类型。

编辑：除了建议您首先不要使用枚举之外，我强烈建议您如果*确实*使用枚举，请更改顺序或使用显式值。如果您最终将值视为整数，那么 Yes=0, No=1 将非常令人困惑。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-22T12:35:29.390

我建议您使用一个名称来指示设置为是或否的值。

例如

```
 public enum Married
{
    YES,
    NO
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-22T07:03:32.290

看到用于布尔值的枚举，我会感到困惑。你说：

> 注意：是的，我可以将这些存储为 bool（这就是它过去的工作方式）。我的设计选择是明确用户做出的是/否选择，因为他们会
> 在其他内容中看到这个打印，我希望它更明显选择是什么。

我看不出“是”或“否”比“真”或“假”更“明确”。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-22T07:05:59.600

ResponseEnum 或 EResponse 或 UserResponse 取决于您的约定。

我不会将自己限制为仅是或否，因为将来您可能还想添加需要不确定响应的功能。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-22T10:19:51.300

我想称之为：

```
enum Boolean
{
     Yes,
     No
} 
```

不，等等，已经有一个内置的布尔类型可以使用。

如果您在这里使用枚举的唯一原因是因为可以方便地转换到您想要向用户显示的字符串/从字符串转换，那么当您做更复杂的事情时，您将在轨道上被咬得很厉害。模型与视图的分离将为您提供良好的服务。阅读 MVC 和/或 MVVM 模式。

我可能还建议使用一些自定义属性的简单布尔值来定义显示字符串来代替“true”和“false”可能就足够了。然后，您可以编写自己的 to/from 字符串方法来查找您的自定义属性。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-22T07:00:27.100

*   是 否
*   选择
*   二元选择

或者只使用布尔值。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-22T10:26:01.977

我根本不会使用枚举，只需滚动您自己的类型转换器并使用布尔值。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-22T07:10:50.293

我认为YesNo很好。考虑诸如“MB_OK”和“MB_YESNO”之类的东西......我知道它不是一种类型，但任何不言自明的东西都应该没问题。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-22T07:12:13.240

除了是/否之外，是否还有其他选项。对于只有 2 个选项坚持使用布尔值。尝试单独修改显示区域

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-22T07:52:48.243

（幽默——*请*不要把这当回事……）

我很惊讶没有人提出这个建议：

```
public enum UserWtf
{
    No,
    Yes,
    FileNotFound
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-22T12:30:09.790

我想显示布尔值存在问题。最好创建存储布尔值的简单包装器，以便您将它们显示为是/否或真/假。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-22T06:59:23.437

EUserAction ?

您将其描述为一些用户操作。不过，您也可以更具体。该名称允许将来进行一些其他选择。（名称应该是选择的目的，而不是选择的目的）

但是，对于您的另一个微妙的问题：

> *因为他们会在其他情况下看到这个打印，我希望它更明显的选择是什么。*

用户看到什么并不重要。数据模型可能与您呈现给用户的内容大不相同。一个布尔值就足够了。未来是否有可能采取更多行动？

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-22T07:19:17.407

我阅读了您更新的解释，但我仍然觉得这是一个糟糕的选择。布尔值正是为此目的而存在的。您有责任确保在“他们将在其他内容中看到此内容”时输出适当的文本*。*这可能很简单：

Console.WriteLine(_("使用 Foo:") + (useFoo ? _("Yes") : _("No")));

同时仍然完全支持本地化。useFoo 当然是一个参数，告诉函数它是否正在使用 foo。:)

_ 是 gettext 函数 ( [http://www.gnu.org/software/gettext/](http://www.gnu.org/software/gettext/) ) 的缩写，可用于 C# ( [http://www.gnu.org/software/automake/manual/gettext/C_0023 .html](http://www.gnu.org/software/automake/manual/gettext/C_0023.html)）。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-02-01T04:54:06.047

当我需要这样的东西时，我会使用 Flag 这个词，如`Flag.Yes`,`MarriedFlag.No`等。

何时有用的示例：您知道今天只有 Yes 和 No 值，但您怀疑将来可能会有其他值（例如 Maybe）。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-22T07:54:11.877

除非除了 Yes 和 No 之外还有其他值，否则我看不到这个枚举的意义。那只是一个布尔值。并且制作一个枚举，这样您就不必输入是或否似乎有点愚蠢。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-22T19:13:45.700

使用 bool，结合 bool.TrueString 和 bool.FalseString 进行显示。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-11-23T11:30:28.753

我将 OptionalBinaryFilter 用于：

是的，不，所有

但是如果你只有 Yes 和 No，似乎更适合在成员中使用 Boolean。

# asp.net - ASP.NET：上传文件时出现间歇性“拒绝访问”错误

> ID：385705
> 
> 赞同：0
> 
> 时间：2008-12-22T07:14:34.077
> 
> 标签：asp.net, iis

我有一个 .NET 程序将图像上传到网络服务器。我正在使用 ASP.NET 文件上传控件来执行此操作。该程序在我的本地环境中运行正常，但是当我在网络服务器上运行它时，我收到以下错误：

```
>     System.UnauthorizedAccessException:
> Access to the path
> '\\fsvs02\target03\352972\352974\www.mysite.com\web\content\Images\TempStorage\tempImage.jpg'
> is denied.
>        at System.IO.__Error.WinIOError(Int32
> errorCode, String maybeFullPath)
>        at System.IO.FileStream.Init(String path,
> FileMode mode, FileAccess access,
> Int32 rights, Boolean useRights,
> FileShare share, Int32 bufferSize,
> FileOptions options,
> SECURITY_ATTRIBUTES secAttrs, String
> msgPath, Boolean bFromProxy)
>        at System.IO.FileStream..ctor(String
> path, FileMode mode)
>        at System.Web.HttpPostedFile.SaveAs(String
> filename)
>        at uploadimage.UploadImage() 
```

快速谷歌搜索确认这是一个权限问题；但由于它只是间歇性地发生，我没有诊断如何修复它的计划。

我的问题是：我应该怎么做才能诊断和解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T23:20:26.407

您是否将文件上传到每个用户的相同文件名（从错误消息中可以看出是这种情况）？如果是这样，那么它可能就像 Ady 所说的那样。相反，请使用 Path.GetTempFileName 为您的临时文件生成一个文件名，该文件名不会与已经存在的文件冲突。确保完成后移动或删除文件，否则临时文件将填满硬盘。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T08:01:05.527

检查问题是否仅在您将文件复制到生产环境而不是上传文件时出现。复制的文件可能具有更严格的权限，拒绝访问您的应用程序运行的进程。当您尝试通过上传另一个同名文件来覆盖此类文件时，会引发上述异常。

解决方案是仅通过您的应用程序直接上传文件，并将所需的权限直接设置为您从测试环境复制的文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T08:46:29.460

这也可能意味着该文件已被另一个进程锁定。例如，同时上传两个同名文件。或者另一个进程正在使用您尝试覆盖的文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T08:59:52.460

没有提到的是您的 Web 应用程序是公共 Internet 还是私有 Intranet，并且使用*Windows 身份验证*？在这种情况下，可能是用户被授权（通过 NTFS 权限）上传到该文件夹​​，而其他用户则没有。它们通过其用户帐户而不是匿名 NETWORK SERVICE 或用于 IIS 应用程序池的其他帐户进行身份验证。

# unix - 在 unix“查找”中包含软链接文件夹

> ID：385707
> 
> 赞同：3
> 
> 时间：2008-12-22T07:17:06.537
> 
> 标签：unix, find, symlink

如何告诉 unix“查找”在其递归搜索中包含软链接的文件夹？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-22T07:21:03.580

-L。这会导致它遵循所有符号链接（我假设这就是您所说的软链接）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T08:19:46.833

有趣 - 我以前没有遇到过' `-L`'（或相反的' `-H`'）。您也可以使用 ' `-follow`' 来完成相同的工作。它可以内置到表达式中（它总是评估为真），因此您可以使用它比使用 ' `-L`' 更微妙。但是，我不会太担心这种微妙之处 - ' `-L`' 更简单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-31T03:54:30.837

在以下位置找到有关 unix find 命令的更多信息

[http://scripterworld.blogspot.com/2009/07/unix-find-command-with-examples-and.html](http://scripterworld.blogspot.com/2009/07/unix-find-command-with-examples-and.html)

# .net - 为记录目的捕获事件

> ID：385709
> 
> 赞同：1
> 
> 时间：2008-12-22T07:19:05.957
> 
> 标签：.net, aop

启动应用程序时，我需要知道某些方法何时被触发。如何使用属性和 AOP 技术做到这一点？

最简单的方法是在事件方法中记录时间，例如：

```
private void Page_load()
{
  DateTime dt = DateTime.Now;
} 
```

并将日期时间保存到数据库中。但这绝对是不可取的，因为这样做会留下很多横切功能，使维护工作更加困难。我正在考虑使用属性来解决这个问题。PostSharp 在这里似乎是一个很好的候选者，因为它可以拦截方法调用并执行您想要的任何预处理和后处理。但显然缺少的一件事是，如果我不编写大量自定义代码，它就无法处理事件。

有没有可以自然处理事件的框架？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T09:55:18.933

[Postsharp](http://www.postsharp.org/)可能会在这里为您提供帮助

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T07:49:42.493

您不需要为要像这样记录的每个事件都使用单独的方法。

编写一个方法来进行日志记录：

```
public static void LogEventRaised(string event)
{
    ...
} 
```

然后使用匿名方法订阅事件：

```
Load += delegate { LogEventRaised("Load") }; 
```

是的，它是命令式的而不是声明式的，并且重复事件名称 - 但它仍然非常紧凑。您*可以*使用反射将处理程序附加到*所有*事件，但这可能是矫枉过正。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T09:41:32.207

[Spring](http://springframework.net/overview.html)框架有一个提供日志支持的面向方面编程模块。

# vb.net - 为什么使用 TryCast 而不是 DirectCast？

> ID：385714
> 
> 赞同：26
> 
> 时间：2008-12-22T07:21:28.477
> 
> 标签：vb.net, casting

当我尝试转换`Object obj`为 Type`T`时，如果无法转换，则有问题。

在我投射对象之后，我将寻找使用投射对象的工作。

相反，我希望在我将要投射它的地方得到一个异常，而不是说我将在哪里使用该对象。

`DirectCast`从这个意义上说，使用而不是更好`TryCast`？还是我错过了使用的其他一些意义`TryCast`？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-12-22T07:32:53.370

（对于 C# 开发人员，`TryCast`类似于“as”，`DirectCast`相当于正常的强制转换。正如 Mike 在评论中指出的那样，“as”适用于可为空的值类型，但`TryCast`不是。）

如果该值确实应该是 a `T`，那么`DirectCast`确实是正确的方法-它会快速失败，并带有适当的错误。

`TryCast`当目标是“错误”类型是合法的时是合适的。例如，要获取容器中的所有 Button 控件，您可以遍历控件集合并*尝试*将每个控件强制转换为 Button。如果它有效，你就用它做点什么——如果它不起作用，你就继续。（使用 LINQ，您可以仅用`OfType`于此目的，但您明白我的意思......）

以我的经验，直接铸造比`TryCast`使用泛型更合适——尽管我发现自己铸造的频率比以前少了很多。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-22T07:33:03.870

两者之间的唯一区别是，`TryCast`如果失败，a 将返回 null，而 a`DirectCast`将抛出异常。

这些对你如何处理你的程序有影响。如果不正确的转换（例如，将用户输入的文本输入框转换为数字类型）的可能性很高，我个人更喜欢不必抛出异常。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-30T21:37:04.393

我认为其他人已经提到了你应该和不应该执行“安全强制转换”的时间（在这种情况下，你可以确保在冒着异常风险之前强制转换成功）。如果您的程序确实需要执行安全转换，那么该`TryCast`方法可以为您和程序节省一些工作。

直到今天我才知道这个`TryCast()`函数，我觉得使用安全铸造的“坏”方法就像个傻瓜。

如果您不了解该`TryCast()`功能，那么您最终可能会得到以下结果：

```
'' wasteful, the TypeOf and DirectCast calls are redundant
If TypeOf obj Is SomeClass Then
    someObj = DirectCast(obj, SomeClass)
    '' More code
End If 
```

问题是这种方法实际上执行了两次强制转换（从技术上讲，我认为它们实际上是类型检查）。使用`TryCast`并检查结果是否为 Nothing 消除了第二次演员表并节省了不必要的工作。

```
'' efficient, only one cast is ever performed and there are no InvalidCastExceptions thrown
someObj = TryCast(obj, SomeClass)
If someObj IsNot Nothing Then
    '' More code
End If 
```

遵循此模式可以避免处理昂贵的异常，并有效地转换为正确的类型。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T08:13:01.027

如果您的设计要求传递给您的对象**必须**是 T 类型，则断言（如在 Debug.Assert 中）该转换在调试构建中成功并运行详尽的单元测试以证明您的实现遵循您的设计。

随着您的设计经过验证和测试，您可以执行直接铸造，因为它知道它永远不会失败。

# unit-testing - 你如何处理失败的单元测试？

> ID：385730
> 
> 赞同：3
> 
> 时间：2008-12-22T07:33:25.037
> 
> 标签：unit-testing, nunit, failing-tests

我在一个解决方案文件中有许多项目，它们为它们编写了单元测试，我想将它们设置为由我们的持续集成服务器运行。但是，由于许多测试写得不好并且没有定期运行，所以很多测试都失败了。

我目前没有时间修复所有测试，但我确实相信运行现有测试是有价值的。处理失败的单元测试的最佳方法是什么？

我目前正在做的是将每个失败的测试标记为显式并留下 TODO 评论。

```
[Test, Explicit] //TODO: Rewrite this test because it fails 
```

有没有更好的方法来做到这一点？或者我应该先修复所有测试，然后再将它们包含在 CIS 运行的测试中？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-22T08:01:31.783

由于您有一个正在运行的自动构建（带有测试失败通知！），这听起来像是每天 5 次的时间（来自 ubuntu 社区）：

在每个失败的测试方法中插入以下（伪代码）：

```
if  ( DateTime.now < new DateTime(2008, 12, 24, 11, 00, 00)) return; 
```

您每插入 5 次此声明，您就会提前一个工作日。将一天中的时间设置在您可能有时间修复测试的某个时间。

当工作日到来时，你修复它或删除它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-22T07:37:07.027

好吧，在 NUnit 中，您可以选择使用 ignore 属性忽略测试：

```
[Test, Ignore("Test needs rewrite")] 
```

不过，就个人而言，我对此类测试做了两件事：

*   如果我不理解测试，或者测试过时/与当前规格不同步，请删除它们
*   如果修复是微不足道的，则将其重构为正确的规范

从您所写的内容中收集，我怀疑许多失败的测试*已经*过时并且可能一开始可能不相关，所以我认为删除它们会很好。

无论如何都没有人理解的测试是没有意义的。

**更新**：[Oren Eini](http://ayende.com/Blog)有一篇博文，概述了我对激活旧的、失败的测试的大部分感受：

[测试本身没有价值：我最成功的项目没有任何测试](http://ayende.com/Blog/archive/2008/12/21/the-tests-has-no-value-by-themselves-my-most-successful.aspx)

去引用：

> 测试是一种工具，在将其应用于项目之前，应根据通常的指标评估其使用情况。不使用测试的原因有很多，但大多数都归结为：“它们给过程增加了摩擦”。

如果改造旧的、失败的测试会增加流程的摩擦，那么可能根本不值得更新它们。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-22T08:12:45.193

我不同意只删除测试的想法。如果它看起来应该可以工作，但它没有，这是重要的信息。如果一个测试基本上没问题，但是有一些环境因素导致它失败（例如读取一个现在位于不同位置的本地文件），那么当你有时间修复它时，它可以很容易地再次提供价值。然而：

*   添加注释解释测试失败的原因 如果这是由于其他地方的错误，错误 ID 等很有用。确保您提供足够的信息，以便在一年后返回。
*   有一些工具（它可能非常简单——grep！）每周生成一份报告，这样你就不会忘记测试。
*   如果可能的话，找到一些定期自动运行被忽略的测试的方法，只是为了检查它们是否仍然失败。失败并神奇地开始工作的测试可以提供非常重要的信息（当然，结合源历史记录）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-22T09:02:09.617

> 我目前没有时间修复所有测试

我认为你在这里有一些落后的东西......

如果您真的认为测试有价值，那么我建议您没有时间**不**修复它们。现在，他们告诉你软件要么没有做它应该做的事情，要么测试正在检查不再适用的东西。无论哪种方式，这都表明该过程在某个地方被破坏了。

所以，特别是考虑到一年中的时间，除非你有月末或年终问题，否则我会花时间清理我的测试或代码，或两者兼而有之。

说真的，如果你不听他们告诉你的话，进行测试有什么意义呢？如果您不能相信持续集成的功能，为什么还要麻烦运行它呢？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T08:08:40.067

您在设置运行所有测试的持续集成服务器方面做得很好。

但是禁用测试有什么用呢？它们就像注释掉的代码。死测试。正如乔恩所说：让它们运行或删除它们。如果像你说的那样写得不好，通常最好写新的。

但是你什么时候有时间修复它们？测试是唯一的安全网，软件开发人员在进一步发展时拥有。**您需要花时间，否则您将在以后付款。**但也许编写新测试需要更少的时间......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T08:12:40.683

你会如何处理其他一些积累了技术债务的代码？

如果进行 TDD（先测试），单元测试会为您做两件事。一是帮助设计具有低耦合和高内聚的对象。这些测试不再为你做傻事。第二，允许您在不改变行为的情况下重构代码。

听起来你失败的测试现在是机会成本。换句话说，不再为您的项目增加价值。只是花费你金钱和时间。看看你花时间想知道如何处理它们？测试不再有效。

恕我直言，我会删除测试。它们不再覆盖代码，因此如果您重构代码，测试不会保护行为。这就像您的代码中的注释已更改，但注释从未更新。

如果您确实删除了测试，您将需要将测试所涵盖的代码视为“遗留”（Feather 的定义）。

# flash - 流式传输电影的最佳方式

> ID：385732
> 
> 赞同：0
> 
> 时间：2008-12-22T07:35:18.840
> 
> 标签：flash, xhtml, video, streaming

我正在尝试在我拥有的备用 PC 上为我所有的音乐和视频文件做一个前端，但遇到了一些障碍。我最初想使用 Flash 媒体播放器播放电影（avi、mpeg、flv 等），但经过一番搜索后，似乎 Flash 只能播放 flv。显然，我不想将整个硬盘驱动器转换为 flv#s。

我能找到的唯一其他选择是以下代码......

```
<object classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" codebase="http://www.apple.com/qtactivex/qtplugin.cab" height="195" width="340" name="CRUNKCinema" align="left">
    <param name="src" value="/path/to/video.avi">
    <param name="autoplay" value="true">
    <param name="controller" value="true">
    <embed height="195" width="340" align="left" src="/path/to/video.avi" autoplay="true" controller="true"></embed>
</object> 
```

但这似乎很断断续续，有时视频根本无法加载。此外，使用此选项似乎没有任何缓冲。

有人可以为我的问题提出更好的解决方案吗？谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T08:19:48.127

为什么要重新发明轮子？看看[XBMC](http://xbmc.org/)或[boxee](http://www.boxee.tv/)。

编辑：如今，对于大多数媒体播放器，您还可以直接共享您的库，以便其他媒体播放器可以看到它。或者只是将媒体目录导出为网络共享并将其导入您在另一台电脑上使用的媒体播放器（但是根据我的经验，SMB 不太适合流式传输，除非通过以太网）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T12:40:58.100

如果您想在网络浏览器中播放这些文件，那么将它们全部转换为 FLV（或 MP4，或任何适合您的文件）实际上可能是最好的选择。[（ MediaCoder](http://mediacoder.sourceforge.net/)之类的东西可以使这变得可行。）无论您做什么，您的一些视频都可能使用未处理的编解码器（如果不是文件格式）。

但是，如果您只是想让视频在 PC 上播放，不一定要在浏览器中播放，那么常规桌面应用程序（如 VLC）可以在不转换的情况下解决问题，正如 Frank 建议的那样，如果您尝试使用流行的媒体盒之一您可能会发现它们已经完成了您计划的所有应用程序以及更多其他应用程序。:D

# hosting - 如何从域名中找到托管服务提供商？

> ID：385735
> 
> 赞同：9
> 
> 时间：2008-12-22T07:37:15.670
> 
> 标签：hosting, dns, reverse-dns

我正在寻找一种可靠的服务，该服务具有良好的托管服务提供商与域名数据库。我猜一些私人托管的域无法解析到特定的托管服务提供商（可能只是到 ISP）。

我使用过 webhosting.info（他们的强大 whois 和高级 whois），它曾经提供过更早的托管信息（不确定），但现在不再提供了。我查看了 domaintools.com，但在他们的工具中找不到类似的东西。

我想我可以在域上做一个反向 IP 并转到 arin.net 并获取组织名称。但是寻找可以进行批量查找的免费（或付费服务）或您推荐或使用的任何反向 dns 工具。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2011-05-11T02:13:16.493

大多数网站使用托管公司提供的 DNS 服务器，但您可以使用任何其他 DNS 服务器来解析您的域名。所以通过IP地址分配数据查找是最好的方法。

这是一个为您做的网站：

[http://www.whoishostingthis.com/](http://www.whoishostingthis.com/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T07:40:02.357

如果您有权访问 Linux 机器，则可以在 IP 地址上使用 jwhois。因此，您需要将主机名解析为 IP 地址（如果您想使用 shell 脚本，您可以使用 ping 来完成）然后 jwhois IP 地址，这将（通常）自动在 ARIN / APNIC 中查找/ 视情况而定。它不是 100% 准确的，但它几乎总是有效的。

或者，您可以购买对[GeoIP 数据库](http://www.maxmind.com/app/ip-location)的访问权。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-25T04:06:51.100

我去[www.domaintools.com](http://www.domaintools.com)并在 Whois 查找中输入域名。

当他们的 Whois 记录出现时，查看名称服务器。它告诉您托管公司是谁，并且作为额外的奖励，还告诉您该主机的域数量。

我不知道他们是否有任何批量服务。我一次只需要一个查找。

# c# - NHibernate.Spatial 和 Sql 2008 地理类型

> ID：385757
> 
> 赞同：13
> 
> 时间：2008-12-22T08:01:28.647
> 
> 标签：c#, nhibernate, sql-server-2008, spatial, geography

我目前正在处理一个必须处理 sql server 2008 地理类型的项目。由于项目的大部分使用 NHibernate 作为 ORM，我想知道使用/扩展 NHibernate.Spatial 这种类型需要做多少工作（据我所知，Nh Spatial 仅支持几何类型）。顺便提一句。还有其他支持这种 sql 类型的 .net ORM 吗？谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-30T10:04:15.977

我不具体了解空间，但您始终可以扩展 NHibernate 以处理您的自定义类型，这非常简单（请参阅[NHibernate 自定义映射类型](http://blogs.msdn.com/howard_dierking/archive/2007/04/23/nhibernate-custom-mapping-types.aspx)）但问题是您必须向 NHibernate 解释如何处理地理类型（请参阅命名空间 NHibernate.Type) 告诉 NH 如何将值来回转换为 SQL。

这可能不是世界上最简单的事情，但可以做到，很多人可能会在[nhuser](http://groups.google.com/group/nhusers)中帮助你，你肯定会学到很多关于 OR/M 内部工作的知识。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-10T19:59:23.833

一月份我在 NHUsers 中问过同样的问题。NHSpatial 对地理类型的支持有限。检查下面 NHUsers 的线程，您可以在某些地理应用程序中“某种程度上”使用几何类型。

[http://groups.google.com/group/nhcdevs/browse_thread/thread/752b046c0ce959b0/9596204d0dd0ff47?q=#9596204d0dd0ff47](http://groups.google.com/group/nhcdevs/browse_thread/thread/752b046c0ce959b0/9596204d0dd0ff47?q=#9596204d0dd0ff47)

另请参阅 Ricardo 在小组中发布到 Isaac Kunen 博客的链接，该链接给出了 SQL 中最近邻问题的一个有趣示例。

所以基本上，答案是：没有 NHSpatial 不支持地理，但您可以将几何类型用于一些基本的地理问题（例如两点之间的距离）。但您最好运行原生 SQL 查询来获得 SQL Server 2008 地理类型的全部功能。

# c# - C# 的 C++ FQA 模拟

> ID：385762
> 
> 赞同：6
> 
> 时间：2008-12-22T08:05:25.630
> 
> 标签：c#

我发现[C++ FQA Lite](http://yosefk.com/c++fqa/)非常有启发性，并希望阅读更多批评。你能给我推荐一些类似但关于 C# 的东西吗？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T09:10:14.703

我不认为有这样的文件。C++ FQA 中提到的大多数问题与 C#（和其他语言）无关。

您可能想阅读[.NET 开发人员的常见编程错误以避免](https://stackoverflow.com/questions/380819/common-programming-mistakes-for-net-developers-to-avoid).

# mysql - 电子商务网站的自定义产品属性

> ID：385769
> 
> 赞同：1
> 
> 时间：2008-12-22T08:08:45.980
> 
> 标签：mysql, database, database-design

我正在为电子商务网站使用 MySQL 5 创建数据库。我希望数据库尽可能灵活，以便网站所有者可以为各种类型的产品添加自定义属性。例如，他们的产品可以有 4 种衬衫尺码和每种尺码 3 种颜色，或者有 6 种衬衫尺码、每种尺码 4 种颜色以及可能有第 3 个属性的产品。

我遇到的问题是他们应该能够根据产品的各种属性控制产品的数量，而不是产品本身。公司可能有一种产品有 25 种款式和颜色的库存，但有 13 种不同尺寸和颜色组合的库存。

有没有关于如何在 MySQL 数据库中构造它的好解决方案？目前我有一个表，将存储产品 ID、数量和属性将使用逗号分隔的“键：值”语法连接到 1 个字段中。

这是我第一次尝试创建这样的系统。任何信息/帮助将不胜感激。如果您需要更多信息，我也可以提供。

* * *

我真的很感激这个建议。但是要执行这种“派生项目”方法，我是否需要为每种类型的产品创建不同的数据库表，因为产品可能具有与之关联的可变属性？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T08:13:38.013

最简单的解决方案显然是让每个衬衫颜色组合成为一个完全独立的项目，并放弃属性概念。我相信这就是大多数真实商店的运作方式。当您考虑“基础”项目多久更改一次时，这是有道理的。

如果这是不可接受的，您可以有一个 DerivedItem 表，其中每一行都是一个单独的派生项，它具有对 BaseItem 表中的基本项的引用。这将以更复杂的设计为代价消除一些冗余。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T09:11:37.320

我会选择产品和衍生产品，或者您可能想要的任何名称。

如果您愿意，您仍然可以在这些上添加属性。

然后，您可以在产品表（描述等）和派生产品上不同的属性（颜色、尺寸、价格等）上放置通用属性。

最好将属性实现为一个单独的表，在派生属性上带有一个外键，用于诸如颜色之类的东西。这消除了用户输入“深蓝色”和“蓝色（深）”之类的内容并期望您的系统神奇地知道它们是相同颜色的机会......！

# silverlight-2.0 - 在 Silverlight 的列表框中访问父数据上下文

> ID：385784
> 
> 赞同：24
> 
> 时间：2008-12-22T08:25:10.020
> 
> 标签：silverlight-2.0

在 Silverlight 2 中，我使用了一个用户控件，它继承了它所嵌入的页面的数据上下文。此数据上下文包含问题文本、问题类型和答案集合。在用户控件中有一个列表框，它绑定到答案集合。如下所示：

```
<ListBox DataContext="{Binding}" x:Name="AnswerListBox" ItemContainerStyle="{StaticResource QuestionStyle}" Grid.Row="1" Width="Auto" Grid.Column="2" ItemsSource="{Binding Path=AnswerList}" BorderBrush="{x:Null}" /> 
```

此列表框具有关联的样式，以单选按钮或复选框的形式显示答案（我想根据问题类型隐藏或显示）：

```
<Style TargetType="ListBoxItem" x:Key="QuestionStyle">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">                      
                        <StackPanel Background="Transparent" >
                            <RadioButton Visibility="{Binding Path=QuestionType, Converter={StaticResource QuestionTypeConverter}, ConverterParameter='RadioButtonStyle'}" Height="auto" Margin="0,0,0,10"  IsChecked="{TemplateBinding IsSelected}" IsHitTestVisible="False" Content="{Binding Path=AnswerText}">
                            </RadioButton>
                            <CheckBox Visibility="{Binding Path=QuestionType, Converter={StaticResource QuestionTypeConverter}, ConverterParameter='CheckBoxStyle'}" Height="auto" Margin="0,0,0,10" Content="{Binding Path=AnswerText}">
                            </CheckBox>
                        </StackPanel>                                                
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style> 
```

所以我的问题是：如何访问父数据上下文以获取 QuestionType（因为这是用户控件数据上下文本身的属性，而不是 AnswerList 中 AnswerItem 的属性）？

或者，是否有更好的方法可以根据绑定值在 xaml 中动态切换样式？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2010-01-11T08:52:52.097

在 Silverlight 3 及更高版本中，您可以使用 Element 到 Element 绑定并指向控件 DataContext，然后在我的示例中指向其 Threshold 属性。

所以首先命名您的控件（例如在我的示例中它的 x:Name="control"）

```
<UserControl x:Class="SomeApp.Views.MainPageView" x:Name="control" > 
```

然后在您的 ListBox ItemTemplate 中的此控件内，您可以像这样访问父 DataContext：

```
 <ListBox ItemsSource="{Binding Path=SomeItems}" >
        <ListBox.ItemTemplate>
        <DataTemplate>
            <StackPanel Orientation="Horizontal">
            <TextBlock Text="{Binding ElementName=control, Path=DataContext.Threshold}"/>
            </StackPanel>
        </DataTemplate>
       </ListBox.ItemTemplate>         
       </ListBox> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-04T03:20:44.260

我一直在与类似的问题作斗争。我的包含一个为每个列表项显示的组合框。顶级 DataContext 绑定到我的视图模型（MVVM），如下所示：

```
class ViewModel{
    ObservableCollection<ComboboxListItemType> DataForTheComboBoxList;
    ObservableCollection<MyDataType> DataForTheListBox;
    ...
} 
```

由于组合框位于列表框的 ItemTemplate (=DataTemplate) 内，因此每个列表项的 DataContext 都设置为 DataForTheListBox 中的相应项，因此组合框无法再从顶级 DataContext 中看到它所需的 DataForTheComboBoxList。

我的（肮脏、丑陋的）解决方法涉及在列表中的每个项目上设置完整的组合框列表，因此它对该列表项中的 DataContext 可见。

首先，您为列表框数据类型创建一个部分类。（通常这将来自服务引用，因此您不能直接触摸生成的代码而不会丢失它）。此部分类包含一个新属性，该属性引用您的组合框列表项类型：

```
public partial class MyDataType
{
    private ObservableCollection<ComboboxListItemType> m_AllComboboxItems;
    public ObservableCollection<ComboboxListItemType> AllComboboxItems
    {
        get { return m_AllComboboxItems; }
        set
        {
            if (m_AllComboboxItems != value)
            {
                m_AllComboboxItems = value;
                RaisePropertyChanged("AllComboboxItems");
            }
        }
    }
} 
```

接下来，您必须在 DataForTheListBox 集合中的每个元素上设置此属性

```
// in ViewModel class
foreach(var x in this.DataForTheListBox)
{
    x.AllComboboxItems = this.DataForTheComboBoxList;
} 
```

然后回到你的 XAML：

```
<DataTemplate x:Key="ListBoxItemTemplate">
    ...
    <Combobox
        ItemsSource="{Binding AllComboboxItems}"
        SelectedItem="{Binding CurrentBlah}"/>
</DataTemplate> 
```

不要忘记，要让组合框正确显示当前项，选定的项必须引用组合框的 ItemsSource 中的*实际*项。如果您从具有代表组合框项目的 ID 或对象的 Web 服务获取数据，则必须重新引用它们以指向实际集合。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T00:21:25.013

使用 silverlight 可以做的非常酷的事情之一是使用 Tag 属性来存储对它所绑定的对象的引用。

首先，在你的类中，声明一个这样的属性

```
public IMyObject Current 
{
  get {return this;}
} 
```

然后在引发事件的控件上，您可以获得对该对象的引用

```
var fe= (FrameworkElement) sender;
var src = fe.Tag as IMyObject; 
```

所以现在我有了对象，一个对象引用它的父对象是合理的，所以你绑定到

```
Current.Parent.QuestionType 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-19T01:37:31.630

如果您尝试使用 DataForm 执行此操作，则 Roboblob 显示的相同方法不起作用。

[这个问题可能有一些有用的信息](https://stackoverflow.com/questions/3024131/help-binding-combobox-within-dataform-to-view-model-property-outside-dataforms-c)

# windows - 以编程方式在登录时启动应用程序

> ID：385793
> 
> 赞同：5
> 
> 时间：2008-12-22T08:32:26.917
> 
> 标签：windows

在 Windows 登录时以编程方式启动应用程序的最佳方式是什么？我知道你可以通过在开始菜单的启动文件夹中添加一个项目来做到这一点，但我想在我的应用程序中有一个选项来关闭和打开它。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-22T08:37:08.683

这就是你在 C# 中可以做到的方式：

```
Registry.SetValue(@"HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run",
          "MyStartUp",
          @"C:\StartUpApp.exe"); 
```

您基本上需要添加一个注册表项。上面的一个在启动时起作用。还有几个。我建议您下载像[Autoruns](http://technet.microsoft.com/en-us/sysinternals/bb963902.aspx)这样的工具来查看所有可能的位置。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T08:46:06.653

将您的程序安装为 Windows 服务怎么样？服务可以在“禁用”、“手动”和“自动”之间切换，您可以从代码中（甚至从 Java 应用程序）访问服务并操作其状态。

只是一个想法。

尤瓦尔=8-)

# c# - 同步框架：我可以只同步我的表的一个子集吗？

> ID：385796
> 
> 赞同：1
> 
> 时间：2008-12-22T08:37:05.893
> 
> 标签：c#, microsoft-sync-framework

使用同步框架同步数据的常规代码片段是这样的：

```
LocalDBSyncAgent syncAgent = new LocalDBSyncAgent();
Microsoft.Synchronization.Data.SyncStatistics syncStats = syncAgent.Synchronize(); 
```

任何人都知道同步我的表子集的方法。注意不是每个表中的数据，而是决定哪些表将参与同步。

谢谢爱丽儿

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T15:26:28.297

是的，你绝对可以。

为要同步的每个表创建一个 SyncTable，并将其添加到 SyncAgent 中的 Configuration.SyncTables。

我发现Bill Ryan 的[这篇文章很有启发性。](http://msmvps.com/blogs/williamryan/archive/2007/11/13/filtering-data-ado-net-synchronization-services.aspx)他介绍了如何过滤每个表中的数据，但其中有一些东西可以满足您的需求。

比尔瑞恩的样本：

```
public class SampleSyncAgent : Microsoft.Synchronization.SyncAgent
 {

     public SampleSyncAgent()
     {

         SqlCeClientSyncProvider clientSyncProvider = new SqlCeClientSyncProvider(Properties.Settings.Default.ClientConnString, true);
         this.LocalProvider = clientSyncProvider;
              clientSyncProvider.ChangesApplied += new EventHandler<ChangesAppliedEventArgs>(clientSyncProvider_ChangesApplied);    

         this.RemoteProvider = new SampleServerSyncProvider();    

         SyncTable customerSyncTable = new SyncTable("Customer");
         customerSyncTable.CreationOption = TableCreationOption.DropExistingOrCreateNewTable;
         customerSyncTable.SyncDirection = SyncDirection.DownloadOnly;**

         this.Configuration.SyncTables.Add(customerSyncTable);
         this.Configuration.SyncParameters.Add(new SyncParameter("@CustomerName", "Sharp Bikes"));
     }

} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-02T21:39:35.423

Sync Framework 2.0 中有一些新的与数据库相关的同步提供程序 - 与以前可用的同步提供程序相比，它们具有许多优点（请参阅[此处](http://msdn.microsoft.com/en-us/library/dd918848(SQL.105).aspx)的比较提供程序类型）。有了这些，您可以通过构建一个包含 DbSyncTableDescriptions 的 DbSyncScopeDescription 来指定应该同步的表子集，该 DbSyncTableDescriptions 仅适用于您希望同步的那些表。

您在上面说过您对过滤数据不感兴趣，但在这里可能值得一提的是 DbSyncScopeDescription 还包含过滤信息。

# linq-to-sql - 在 LINQ to SQL 查询中监视/提高性能的技术

> ID：385804
> 
> 赞同：2
> 
> 时间：2008-12-22T08:47:25.560
> 
> 标签：linq-to-sql, performance

我有一个网页时间过长，需要对其进行优化。因为不知情的优化是魔鬼，我需要知道到底是什么让我失望。快速浏览一下，我发现它可能是最有可能导致问题的[LINQ to SQL查询。](http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_SQL_.28formerly_called_DLINQ.29)

在这种情况下，固定性能问题的技术是什么？您是否遇到过 LINQ to SQL 不擅长并因此应该避免的特定事情？

如果需要，我可以提供有关构建查询的代码的更多详细信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T09:03:14.780

您可以使用[LINQ to SQL](http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_SQL_.28formerly_called_DLINQ.29)调试可视化工具；Scott Guthrie 有一篇很好的博文，*[LINQ to SQL Debug Visualizer](http://weblogs.asp.net/scottgu/archive/2007/07/31/linq-to-sql-debug-visualizer.aspx)*。

另一个可以为您提供有价值信息的应用程序是 SQL Profiler。查看*[Introduction to SQL Profiler](http://www.developer.com/db/article.php/3482216)*，它应该可以帮助您入门。

我有几个性能问题。我在每个 LINQ 语句之前和之后添加了大量带有当前时间的 TimeSpan 对象。我添加了一些断点，以查看所有这些 TimeSpan 之间的差异。在 Watch 窗口中，您可以即时计算差异并立即查看痛点所在的位置。在我的情况下，它原来是对在错误时间调用的扩展方法的调用。

此外，InsertOnSubmit 和 SubmitChanges 可能会导致延迟。因为我的客户不必等待，所以我将插入放在不同的线程上。

# c# - 使用 Linq to SQL 正确递增值

> ID：385809
> 
> 赞同：2
> 
> 时间：2008-12-22T08:53:03.020
> 
> 标签：c#, linq-to-sql, auto-increment

我有一个我无法控制的 MS SQL 表，我需要写入。该表有一个不会自动递增的 int 主键。我不能使用存储过程，我想使用 Linq to SQL，因为它使其他处理变得非常容易。

我目前的解决方案是读取最后一个值，增加它，尝试使用它，如果我遇到冲突，再次增加它并重试。

沿着这些思路：

```
var newEntity = new Log()
{
    ID = dc.Logs.Max(l => l.ID) + 1,
    Note = "Test"       
};

dc.Logs.InsertOnSubmit(newEntity);

const int maxRetries = 10;
int retries = 0;

bool success = false;
while (!success && retries < maxRetries)
{               
    try
    {                                                           
        dc.SubmitChanges();
        success = true;
    }
    catch (SqlException)
    {
        retries++;
        newEntity.ID = dc.Logs.Max(l => l.ID);                  
    }
}           
if (retries >= maxRetries)
{
    throw new Exception("Bummer...");
} 
```

有没有人有更好的解决方案？

编辑：感谢[Jon](https://stackoverflow.com/questions/385809/correctly-incrementing-values-using-linq-to-sql#385814)，我简化了最大 ID 计算。我仍然处于 SQL 思维模式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T08:56:02.233

这看起来是一种获得最大 ID 的昂贵方法。你是否已经尝试过

```
var maxId = dc.Logs.Max(s => s.ID); 
```

? 也许由于某种原因它不起作用，但我真的*希望*它......

（不可否认，SQL Server 对此进行了适当的优化。）

除此之外，对我来说它看起来还可以（很臭，但必然如此） - 但我不是这方面的专家......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T09:19:13.467

您没有说明您的应用程序是否是唯一插入表格的应用程序。如果是，那么我会在应用程序/webapp 启动后立即获取最大值，并在每次需要下一个 ID 时使用 Interlocked.Increment （或者如果可以排除可能的竞争条件，则简单添加）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T09:23:14.613

[您可以使用TransactionScope](http://msdn.microsoft.com/en-us/library/system.transactions.transactionscope.aspx)类将整个操作放入事务中，如下所示：

```
using  (TransactionScope scope = new TransactionScope()){
   var maxId = dc.Logs.Max(s => s.ID); 
   var newEntity = new Log(){        
       ID = maxId,        
       Note = "Test"           
   };
   dc.Logs.InsertOnSubmit(newEntity);
   dc.SubmitChanges();
   scope.Complete();
} 
```

通过将最大 ID 的检索和新记录的插入放在同一个事务中，您应该能够完成插入，而不必以您的方式重试。

使用这种方法可能会遇到的一个问题是事务死锁，尤其是在表被大量使用的情况下。做测试看看你是否需要额外的错误处理。

PS 我在我的代码中包含了 Jon Skeet 的代码以获取最大 ID，因为我很确定它会正常工作。:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-02T11:39:54.923

使 id 字段自动递增并让服务器处理 id 生成。

否则会遇到liggett78所说的问题。没有什么能阻止另一个线程在读取和提交该线程的最大 id 之间读取相同的 id。

# java - Java：Applet 中调用方法的顺序是什么？

> ID：385824
> 
> 赞同：-1
> 
> 时间：2008-12-22T09:04:18.210
> 
> 标签：java, applet

在所有这些方法中，正在运行什么以及以什么顺序运行？我想第一个要问的问题是先运行什么？

**为什么 th.start() 会启动 run()？**

```
import java.applet.*;
import java.awt.*;

import javax.swing.JFrame;

public class BallApplet extends Applet implements Runnable {
    int x_pos = 10;
    int y_pos = 100;
    int radius = 20;

    private Image dbImage;
    private Graphics dbG;

    public void init() {
        // setBackground(Color.BLUE);
    }

    public void start() {
        Thread th = new Thread (this);
        th.start();
    }
    public void stop() {}
    public void destroy() {}

    public void run() {
        // 20 second delay per frame refresh (animation doesn't
        // need to be perfectly continuous)     
        Thread.currentThread().setPriority(Thread.MIN_PRIORITY);

        while (true) {
            x_pos++;
            repaint();
            try {
                Thread.sleep(20);
            }
            catch (InterruptedException ex) {
                System.out.println("Caught!");
            }
            Thread.currentThread().setPriority(Thread.MAX_PRIORITY);
        }
    }
    public void update(Graphics g) {
        // implements double buffering
        // drawing on doublebufferImage, note the dbG=dbImage.getGraphics(), so everything dbG.whatever() is
        //      drawing on the Image's graphics which is later drawn with g.drawImage()

        // initialize buffer
        if (dbImage == null) {
            dbImage = createImage (this.getSize().width, this.getSize().height);
            dbG = dbImage.getGraphics();
        }

        // clear screen in background
        dbG.setColor(getBackground());  // gets background color
        dbG.fillRect(0, 0, this.getSize().width, this.getSize().height);

        // draw elements in background
        dbG.setColor(getForeground());
        paint(dbG);

        // draw image on the screen
        g.drawImage(dbImage, 0, 0, this); 
    }
    public void paint(Graphics g) {
        g.setColor(Color.RED);
        g.fillOval(x_pos-radius, y_pos-radius, 2*radius, 2*radius);
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-22T09:12:01.173

`init()`和`start()`方法首先被调用。

这反过来会创建一个并启动该线程，这会导致调用`Thread`此类的方法。`run()`

`paint()`如果 Swing 检测到需要重绘小程序，则该方法由 Swing 在 GUI 事件处理线程中独立调用。

我注意到该类的 main`run()`方法也反复调用`repaint()`. 这明确告诉 GUI 线程调用`update()`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-22T09:11:23.607

浏览器或 Applet 查看器首先调用

*   init() 方法通知这个小程序它已被加载到系统中。
*   然后在调用 init start() 方法之后。有关更多信息，请参阅 Applet 类文档。
*   在 start() 方法中调用了 th.start()。这意味着 start() 线程执行
*   这将导致 run() 被调用

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-22T09:23:44.613

从[The Java Tutorials](http://java.sun.com/docs/books/tutorial/index.html)[的 Applet 生命周期](http://java.sun.com/docs/books/tutorial/deployment/applet/lifeCycle.html)部分，按顺序调用 的以下方法：`Applet`

1.  `init()`
2.  `start()`
3.  `stop()`
4.  `destroy()`

另外，代码实现了[`Runnable`](http://java.sun.com/javase/6/docs/api/java/lang/Runnable.html)接口，所以`BallApplet`'`run()`方法也是在调用方法运行一个新的`Thread`（这里是被调用的）之后执行的。（调用该方法会启动一个新线程并调用其方法。）`th``th.start()``Thread.start()``run()`

The Java Tutorials 中的[定义和启动线程](http://java.sun.com/docs/books/tutorial/essential/concurrency/runthread.html)`Runnable`部分提供了有关在 Java 中启动线程以及`Thread`如何启动线程的更多信息。

该`run()`方法包含对 的调用`repaint()`，这是一个应用程序触发的更新，它将调用`BallApplet`'`update(Graphics g)`方法。此外，系统触发的重绘会触发该`paint(Graphics g)`方法。

有关在 AWT 中重新绘制的更多信息，请参阅[在 AWT 和 Swing 中绘制](http://java.sun.com/products/jfc/tsc/articles/painting/index.html)。有关系统和应用程序触发的绘画的信息，请参阅[系统触发与应用程序触发的绘画](http://java.sun.com/products/jfc/tsc/articles/painting/index.html#triggers)部分。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T09:21:49.717

请参阅[Thread.start()](http://java.sun.com/javase/6/docs/api/java/lang/Thread.html#start())。

```
public void start() 
```

> 使该线程开始执行；Java 虚拟机调用`run` 该线程的方法。
> 
> 结果是两个线程同时运行：当前线程（从对 start 方法的调用返回）和另一个线程（执行其 run 方法）。
> 
> 多次启动一个线程是不合法的。特别是，线程一旦完成执行就可能不会重新启动。

# asp.net - 在 Internet 上为 ASP.NET 进行远程调试时未命中断点

> ID：385826
> 
> 赞同：11
> 
> 时间：2008-12-22T09:07:47.250
> 
> 标签：asp.net, debugging

我在通过 Internet 访问的 Window 2003 服务器上进行了远程调试。我的 XP 开发盒上安装了 VS 2008 SP1。

我在远程服务器上启动了该站点并附加到远程服务器上的所有 w3wp.exe 进程。我注意到 .dll 没有加载符号文件。当我尝试从本地计算机加载相应的 .pdb 文件时，它说文件不匹配。我没有选中“要求源文件与原始版本完全匹配”。远程服务器上的程序集与我的开发箱上的程序集相同。该站点和 .dll 已从 dev boc 复制到远程服务器，此后代码没有更改。所以我知道 .dll 和 .pdb 文件应该匹配，或者至少我需要强制匹配。

问题：

1.  如何加载 .pdb 文件？我知道除非加载符号文件，否则断点不会触发。我注意到远程服务器上的“临时 ASP.NET 文件”文件夹中不存在 .pdb 文件。.dll 可以。

2.  在 VS 中开始远程调试的正确顺序是什么？（远程设置完成，我可以看到远程进程）。在 VS 中，我将起始页作为远程站点的 url。我开始时没有调试，然后附加到遥控器上的 w3wp.exe(s)。这就是全部吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T10:50:41.690

您正在运行一个网站或一个 Web 应用程序（它是一个已编译的项目，您为其部署 DLL，还是您部署的 aspx 和 aspx.cs 文件的集合）？

如果是 Web 应用程序，您是部署发布版本还是调试版本？在“调试”发布版本时，您将无法命中断点，因为代码已经过大量优化。

您是否在 web.config 编译部分设置了“debug=true”？如果不是，那么调试将很困难。

最后，我在远程调试时使用的步骤是：

1.  部署文件的最新调试版本
2.  远程服务器上的请求页面以启动/重新启动应用程序
3.  确保 VS 远程调试监视器已在远程服务器上启动并运行
4.  在 VS 中，转到工具（或调试）| 附加到进程...，确保在限定符中选择远程服务器，并为正确的应用程序池选择 w3wp.exe 等。
5.  请求将触发断点的页面。
6.  调试！

如果断点是空的（细红色圆圈而不是填充的圆盘），我会经常检查 VS 中的 Stack 窗口以查看已加载和未加载的内容。

# php - PHP中的简单网页布局和模板

> ID：385837
> 
> 赞同：7
> 
> 时间：2008-12-22T09:18:28.837
> 
> 标签：php, html, templates

过去，我在 ASP.NET 中编写网站只是为了通过母版页（布局）和用户控件（部分）获得可重用的模板。我说的是那些没有比模板中的简单变量替换更复杂的代码的网站——我只是用它来保持我的 HTML 井井有条。能够在一个文件中定义页面的基本布局，然后为每个单独的页面填充漏洞，重新使用一些常用位作为用户控件，这真是太好了。

但是，我宁愿不继续使用 Windows 托管，所以我想用 PHP 编写静态页面，它可以在任何地方运行。过去，我为自己编写了一个穷人的 PHP 用户控件，它只是解包一个数组并包含一个模板，但这很笨拙，仍然需要我将 PHP 包含在我的所有页面中。我觉得 Smarty 或 PHP 的其他大型模板语言之一对于组织一些“静态”页面来说太过分了。

我考虑过只在 Ruby on Rails 中做页面，因为我真的很喜欢 HAML/SASS 和布局/部分模型，但是拥有一个用于静态内容的完整 Rails 应用程序似乎很愚蠢。但我还没有发现任何在 PHP 中看起来恰到好处的东西。任何 PHP 大师都可以推荐什么吗？我想要比“包含”更复杂的东西，但我真的不需要太多。也就是说，可以给我布局/部分和 HAML/SASS 的东西就是天堂。我看过[phammable](http://phammable.org/)但它看起来并没有解决布局/部分问题。

再说一次，我不是在寻找像 Smarty 那样复杂的东西，我也不想要一个完整的 CMS。我只想要一些能让我正确模块化我网站的 HTML 的东西。我们在这里谈论的不仅仅是静态 HTML。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-31T04:49:53.723

[Zend_View](http://framework.zend.com/manual/en/zend.view.html)支持布局、部分和占位符。还检查了一种名为[Dwoo](http://dwoo.org)的新模板语言，它类似于 Smarty，但也从 Django 模板中汲取了一些想法。最后，[Calypso](http://www.beberlei.de/calypso/)，它是 PHP 的 Django 模板语言克隆

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-06-24T14:58:25.377

如果您正在寻找简单的东西，我会推荐[PHP Template Inheritance](http://phpti.com/)。然后你可以继续直接用php编写代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T09:59:35.337

我建议你看看 Drupal 及其块模板模型。我认为这正是你所需要的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-31T03:23:43.323

[Stacey](http://staceyapp.com/)是关于我正在寻找的关于静态站点的简单 PHP 模板库的内容。在 Ruby 方面，有[StaticMatic](http://staticmatic.rubyforge.org/)，它甚至不需要服务器上的 Ruby 支持，因为它会生成整个静态站点。非常好（特别是因为它使用了 HAML），但你根本不能有任何动态元素。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-11-28T20:23:31.907

> 我只想要一些能让我正确模块化我网站的 HTML 的东西。

看看[http://code.google.com/p/hoduli/](http://code.google.com/p/hoduli/)

使用这个简单的工具，您将能够这样编写：

```
<h:define name="header">
  some header contents
</h:define>

...

<h:header />

<h:include file="middle_part.php" />

<h:footer>
  some ...
</h:footer> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T20:47:49.770

据我了解，您不想要一个完整的 cms，也不需要像 Smarty 这样的过度杀伤的模板引擎。Php 是一个模板系统，如果你想对其进行适当的模块化，这取决于你。

但我明白，你的 html 之间的那些 php 标签看起来并不漂亮。（虽然使用短标签可以最大限度地减少这种情况......）

您始终可以使用[PEAR 模板系统](http://pear.php.net/package/HTML_Template_IT)，它在大多数 php 安装中默认可用。

我还推荐[CodeIgniter](http://codeigniter.com/) MCV 框架，因为它真的很轻量级。您可以选择自动加载哪些库。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-19T11:15:41.407

大约六个月前，我开始使用 Zend 框架。我已经习惯了使用布局和局部，并且从来不想在没有它的情况下回去创建网站。但对于小型站点，采埃孚实在是太笨重了。将 ZF 用于可以在 HTML 中完成的站点是多余的。

查看[EuropaPHP](http://europaphp.org/)。它是一个超轻量级、基于 PHP 的布局框架。作为一个框架，它是全新的，但到目前为止，我非常喜欢它！它允许我使用布局，并且不需要庞大的库和严格的规则来获得相同的结果。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-12-22T10:01:59.480

也许你应该看看一些内容管理系统。[Drupal](http://drupal.org/)在 PHP 中很有名。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-12-22T11:57:24.473

[Drupal](http://drupal.org/)确实是一个简单且可扩展的 CMS。有一个学习曲线，但它的优点是开箱即用，可以随着您的需求而增长，并且社区对所编写代码的质量非常严格（尽管我个人发现某些模块获得了小二功能开心）。

他们有一个简单的 Zen 主题精简版，可以让你创建你想要使用的 HTML。花在学习这个 CMS 上的时间是值得的，尤其是当 PHP 已经是你的母语时。

# asp.net - 使用 NGEN 有帮助吗？

> ID：385841
> 
> 赞同：18
> 
> 时间：2008-12-22T09:19:22.470
> 
> 标签：asp.net, jit, ngen

当我们知道 NGEN 不会发生太大变化时，使用 ASP.NET 应用程序会更好吗？还是 JIT 足够好？

我问的唯一原因是因为[Jeffrey Richter 在 2002 年的这篇文章](http://www.codeguru.com/columns/experts/article.php/c4651)说：

> 而且，当然，微软正在努力改进 CLR 及其 JIT 编译器，以便它运行得更快，生成更优化的代码，并更有效地使用内存。这些改进需要时间。对于迫不及待的开发人员，.NET Framework 可再发行组件包括一个名为 NGen.exe 的实用程序。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-22T09:24:14.440

NGen 只会帮助启动时间——它不会使代码执行得比 JITting 之后更快。事实上，我相信有一些优化是 NGen*没有*做的，但 JIT 做了。

所以，主要问题是：你有启动时间的问题吗？我不知道 ASP.NET 应用程序的启动时间有多少是 JITting 与其他成本，顺便说一句......您可能应该查看 JIT 的 Performance Manager 图表来告诉您它真正花费了多少时间.

（就可用性而言，拥有多台服务器以便您可以进行滚动重启比使用 NGENed Web 应用程序的单台服务器给您带来更多好处。）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-06-02T05:06:37.707

NGen 不是用于 ASP.NET 的方法——在 bin 文件夹中创建 .dll 不是最后一步——它们会使用应用到`C:\Windows\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files`文件夹的 web/maching.config 设置再次编译。要减少初始加载时间，请使用 Publish Website Tool 或 aspnet_compiler.exe 而不是 NGen

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-21T20:13:22.170

我不确定 NGEN 的主要好处是单独启动时间 - 如果应用程序遭受高 ' **% Time in JIT** ' 的困扰，这被列为潜在的补救措施：http: [//msdn.microsoft.com/en -us/library/dd264972(VS.100).aspx](http://msdn.microsoft.com/en-us/library/dd264972(VS.100).aspx)。

该讨论与一个不同的问题密切相关，即[JIT 的机器代码如何被缓存](https://stackoverflow.com/questions/1591073/high-fluctuating-time-in-jit-on-precompiled-asp-net-website)和重用？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-28T21:59:19.563

今晚我正在调查这个并遇到以下情况：

公共语言运行时无法将您使用 NGEN 创建的图像加载到共享应用程序域中。因为 ASP.NET 标准程序集是共享的，然后被加载到共享的应用程序域中，所以您不能使用 Ngen.exe 将它们安装到本地计算机上的本机图像缓存中。 [http://support.microsoft.com/kb/331979](http://support.microsoft.com/kb/331979)

不确定这是否只是指从 ASP.net 应用程序或应用程序本身引用的程序集？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-06-12T15:41:03.107

是的，这个 youtube 视频实际演示[了 NGEN.exe 性能调整视频](http://www.youtube.com/watch?v=17AtWvLMFrU)

但是要注意检查，检查然后实施。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-08-02T00:10:26.187

NGen 有助于缩短启动时间。例如，[Entity Framework 文档](http://msdn.microsoft.com/en-us/data/dn582034)说明了运行 NGen 的好处：

> 经验观察表明，EF 运行时程序集的本机映像可以将应用程序启动时间缩短 1 到 3 秒。

上下文只是实体框架程序集。NGenning 其他程序集将提供额外的加速。

# iphone - CALayers 会阻止底层视图中的触摸事件吗？

> ID：385853
> 
> 赞同：0
> 
> 时间：2008-12-22T09:25:33.173
> 
> 标签：iphone, cocoa-touch, core-animation

我有一个包含多个子视图的视图的应用程序。子视图没有实现任何 touchesbegins 逻辑。Superview 实现了所有的 touchesbegins 逻辑，并在每个子视图被触摸时分别操作它（由命中测试确定）。

从那以后，我一直在将我的子视图转换为图层。我现在的问题是，如果我触摸一个层，超级层的托管视图永远不会调用 touchesbegins 方法。但是，如果我触摸背景，就会触发 touchesbegin 方法。

我从文档中了解到图层无法处理事件，如果是这样，为什么它会阻止事件到托管视图？

感谢您的帮助，无法解决这个问题。

-科里

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T22:22:58.657

我发现了问题...我正在发布使用 [CALayer 层] 创建的子层。既然我无法控制它们，我就不应该管理它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T13:01:16.420

CALayers 不应该阻止触摸事件。您的`userInteractionEnabled`标志是否设置在托管视图中（听起来像是，如果您有一些接触）？它是否在 UIScrollView 内，它可能正在做自己的触摸处理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-02T04:26:01.020

你的 touchesBegan 方法在哪个类？我遇到了类似的问题，因为我的 touchesBegan 方法位于 UIView 子类中。将该方法移动到 UIViewController 子类后，我的问题得到了解决。

尝试这样做。

# web-services - RPC 伪装成 REST 是个坏主意吗？

> ID：385861
> 
> 赞同：8
> 
> 时间：2008-12-22T09:34:17.853
> 
> 标签：web-services, rest, rpc

我们的整个系统是围绕 REST 设计的，现在正在考虑如何在不使用 URL 中的动词的情况下将意图非常明确的 RPC 流程映射到 RESTful 资源。当内容列表在其他地方被修改时，我们的远程过程调用用于重建我们的搜索索引。

我们正在考虑做的是这样的：

发布 /index_updates

`<indexUpdate><contentId>123</contentId></indexUpdate>`

这本身没有问题，但气味是这个已创建的资源不返回新创建资源的 URL，例如 /index_updates/1234，然后我们可以使用 GET 访问它。

我们使用的索引引擎确实有一个日志机制，所以理论上我们可以返回一个指向 index_update 资源的 URL，以便允许 GET 检索资源，但老实说，我们对资源不感兴趣，因为这是只不过是伪装的 RPC。

所以我的问题是 RESTful 是否以结构或意图来表达。我觉得我所概述的结构是宁静的，但意图却不是。

有没有人有意见或建议？

谢谢，

克里斯

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T09:43:33.263

为工作使用正确的工具。在这种情况下，似乎正确的工具是纯粹的远程过程调用，没有理由假装它是 REST。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T15:43:39.827

您可能从 POST /index_updates 调用返回新资源标识符的一个原因是监视操作的状态。

> POST /index_updates
> <contentId>123</contentId>

```
201 Created
Location: /index_updates/a9283b734e 
```

> 获取 /index_jobs/a9283b734e

```
 <index_update><percent_complete>89</percent_complete></index_update> 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-12-22T19:25:05.053

这显然是一个主观领域，但 GET PUT POST DELETE 是一个足够丰富的词汇来描述任何事情。当我去非英语的亚洲国家时，我只是指指点点，他们知道我的意思，因为我不会说这种语言......**但**很难真正与某人进行愉快的交谈......

将 RPC 伪装成 REST 并不是一个坏主意，因为这就是整个练习。就我个人而言，我认为 SOAP 受到了抨击和憎恨，而事实上它有很多优点（以及 HTTP 压缩、HTTP/SSL 和 cookie，还有更多的优点）......而且你的应用程序确实暴露了客户端调用的方法。为什么要将它翻译成 REST？我从来没有被说服过。SOAP 允许您使用我们熟悉和喜爱的编程接口语言。

**但是要回答您的问题，**将 RPC 伪装成 REST 是不是一个坏主意？不。将 RPC 伪装成 REST 并转换为四个基本操作是事情的本质。不管你认为这很酷还是不酷是另一回事。

# visual-studio - 解决方案文件的修改权限

> ID：385874
> 
> 赞同：16
> 
> 时间：2008-12-22T09:42:45.027
> 
> 标签：visual-studio, tfs, project-conversion

我有在 VS2005 中开发的项目解决方案。它绑定到 TFS（Team Foundation Server）。我想将解决方案转换为 VS2008 版本，保持绑定不变，但是在转换时出现错误。

错误信息：

> 解决方案文件“ *C:\abc\abc.sln* ”无法转换，因为它无法修改。要转换解决方案，请更改解决方案文件的权限以允许修改并重新打开它”

我需要什么权限？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-12-22T09:55:38.340

确保 sln 解决方案文件未标记为**只读**。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-22T09:51:20.237

如果我正确解释了您的问题，您应该检查您当前的 Windows 帐户是否具有修改解决方案文件 (.sln)的**NTFS（文件系统）权限。**检查 Windows 资源管理器中的安全设置，右键单击该文件以确保您具有对其的写入权限。

我还会检查文件是否**没有写保护**（Windows 资源管理器中文件属性的复选框）。

# sql-server - SSRS 中的定时订阅计划发送重复的电子邮件

> ID：385890
> 
> 赞同：1
> 
> 时间：2008-12-22T09:51:32.823
> 
> 标签：sql-server, iis, reporting-services, smtp

我在 SSRS 报告管理器 2008 中创建了一次性订阅。但是，我不断收到订阅发送的重复电子邮件。每封电子邮件之间的间隔约为 30 分钟。

我检查了 SQL 代理作业，看起来 SQL 代理作业已正确创建。它只运行一次，然后清除下一次运行时间。

我还通过测试代码检查了本地机器上的 SMTP 服务。SMTP 可以很好地用于没有重复的测试电子邮件。所以我想这可能是 SSRS 中的问题。关于我可以在哪里查看的任何建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-07T08:29:56.760

更新这个问题。

当我启用报告服务日志时，问题再也不会发生。

在配置文件中添加以下内容。

```
<system.diagnostics>
    <switches>
      <add name="DefaultTraceSwitch" value="3" />
    </switches>   </system.diagnostics>

<RStrace>
                  <add name="FileName" value="ReportServerService_" />
                  <add name="FileSizeLimitMb" value="32" />
                  <add name="KeepFilesForDays" value="5" />
                  <add name="Prefix" value="tid, time" />
                  <add name="TraceListeners" value="debugwindow, file" />
                  <add name="TraceFileMode" value="unique" />
                  <add name="HttpTraceFileName" value="ReportServerService_HTTP_" />
                  <add name="HttpTraceSwitches" value="date,time, clientip,username,serverip,serverport,host,method,uristem,uriquery,protocolstatus,bytesreceived,timetaken,protocolversion,useragent,cookiereceived,cookiesent,referrer" />
                  <add name="Components" value="all:3,http:4" />
  </RStrace> 
```

但是，如果我们删除配置部分，我们不确定问题是否也消失了。我们不想保留日志，因为它增长得很快。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T16:55:28.757

我会尽量确保没有创造额外的工作。也许在报表服务器数据库中四处寻找，看看是否有某种备用计划记录 - 但很难理解它如何不会出现在 UI 中。

您是否删除了订阅并重新创建了它？

# .net - 安装 3.5 后卸载 .NET Framework 2.0 和 1.0 是否安全？

> ID：385893
> 
> 赞同：16
> 
> 时间：2008-12-22T09:52:31.060
> 
> 标签：.net, windows, visual-studio-2008, memory

我是 Windows 开发的新手，我有一个问题。我正在使用带有 Boot Camp 的 Mac 在双启动中运行 Windows，但我有一个非常小的 Windows 分区（10 GB，因为 Boot Camp 因磁盘使用而出现更大的分区失败）。安装 Visual Studio 2008 后，我不断收到磁盘空间不足的警告，因此我想释放一些空间。我可以从控制面板看到我安装了多个 .NET Framework 版本（1.0、2.0、3.5，各种服务包）。我想知道自从我安装了 3.5 后，我是否可以安全地删除其他的。

谢谢你。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-12-22T09:55:39.977

可以删除 1.1 框架，但**不能删除 2.0 框架**

这是因为**.NET 3.5 框架是 2.0 框架的扩展，而不是单独**的 .NET 框架。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-22T09:57:12.690

除了说明 3.5 依赖于 2.0 的其他（正确）答案外，出于兼容性原因，我建议您不要删除 1.1。MS 在使 2.0 向后兼容方面做得很好，但不是 100%。在 1.1 上编写和测试的任何应用程序都比在 2.0 上更可能在此上工作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-22T10:17:19.870

.NET Framework 3.5 是对 .NET Framework 2.0 和 3.0 的附加更新，因此您不应删除它们。

如果您相当确定您不需要 Framework 1.x 并且相当肯定任何 1.1 应用程序在 2.0 下都可以正常运行，那么您可以卸载它。

如果你在你的 bootcamp 分区上运行 Vista，你可以试试 Scott Hanselmans 指南来释放磁盘空间：

[http://www.hanselman.com/blog/GuideToFreeingUpDiskSpaceUnderWindowsVista.aspx](http://www.hanselman.com/blog/GuideToFreeingUpDiskSpaceUnderWindowsVista.aspx)

此时他的网站（异常）似乎处于离线状态，但当我使用它时，我设法释放了笔记本电脑上 30GB 的磁盘空间。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T09:54:31.290

3.5 包括 2.0，所以我认为你不能删除那个。您可以删除 1.x，但我认为它并没有占用太多空间。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T11:42:02.430

我还建议不要删除任何 .NET 版本。将它们全部安装为您提供了一个没有任何兼容性问题的平台。但是，如果您真的不需要 1.1，并且您想绝对确定所有不必要的文件都已删除，您可以卸载所有内容（1.1、2.0、3.5），然后重新安装 3.5。之后，您将拥有 2.0 和 3.5 的干净版本（我认为还有一些 3.0 文件）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T09:56:08.090

安装 .NET 3.5 后卸载 1.x 是安全的，除非您仍有需要它的程序。

至于 .NET 2.0，不建议删除它，原因是 3.5 建立在 2.0 之上。如果你的机器上有 IIS，你肯定无法摆脱它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-22T10:44:41.673

试试[CCleaner](http://www.ccleaner.com/)之类的东西或周围的许多工具可以减少您的磁盘使用量。甚至还有一些应用程序也可以减少 Windows 安装的占用空间。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-22T14:57:40.257

如前所述，您可以删除 1.1 或 1.0。如果您遇到需要这些程序的程序，您可以重新安装它们。但是，对于在 1.1 下构建的 ASP.NET 应用程序，您可以将它们重新指向 2.0，并且由于保留了已弃用的方法，它“应该”仍然运行。

# django - Django 模型命名约定

> ID：385895
> 
> 赞同：32
> 
> 时间：2008-12-22T09:53:34.130
> 
> 标签：django, django-models, naming-conventions

Django 模型类的首选命名约定是什么？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-12-22T11:42:45.877

Django 模型只是 Python 类，因此[PEP-8](http://www.python.org/dev/peps/pep-0008/)中详述的 Python 命名约定适用。

例如：

1.  人
2.  类别
3.  邮政编码

如果 Django 在创建相应的表时未能正确地复数类名，您可以通过在内部 META 类中设置自定义的*verbose_name_plural字段来轻松地覆盖复数。*例如：

```
class Story(models.Model):
    ...

    class Meta:
        verbose_name_plural = "stories" 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-22T10:32:05.927

据我所知，这个想法是类名应该是单数的，并且应该使用不带空格的 SentenceCase。所以你会有这样的名字：

```
Person
TelephoneNumber 
```

然后 Django 管理工具知道如何将它们复数。不适用于以下名称：

```
Category 
```

它被多元化为类别，但我们开始了......

除此之外，只需给它起一个对您有意义的名称，并简明扼要地总结该类的含义。

本

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2019-07-19T07:21:38.143

在大多数编程语言中，人们更喜欢给对象/模型起一个单一的名称，因为这些模型也由数据库系统中的表表示。极简主义每次都是一个不错的选择，以避免将来出现一些意义冲突。

举例说明； [https://stackoverflow.com/a/5841297/2643226](https://stackoverflow.com/a/5841297/2643226)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-03-25T19:54:32.200

另外，当你需要一个以上的Model的相关对象时，可以使用_set属性。例子：

```
class ProcessRoom(models.Model):
...
    plant = models.ForeignKey("Plant", verbose_name='planta', on_delete=models.CASCADE) 
```

然后，相关对象将是：

```
plant = Plant.object.get(id=1)
process_rooms = plant.processroom_set.all 
```

# java - Java 客户端使用 Openssl 和客户端身份验证连接到服务器

> ID：385907
> 
> 赞同：3
> 
> 时间：2008-12-22T10:01:14.320
> 
> 标签：java, ssl, openssl

我必须编写一个 Java 客户端来连接到 SSL 服务器。服务器使用 openssl 证书，并配置为进行客户端身份验证。

我似乎无法在网上找到任何有用的资源来帮助我（谁对 openssl 和 SSL 一无所知）了解谁来实现我的客户端。

帮助！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-22T22:44:05.917

这里的转折是您正在使用客户端身份验证，因此您需要一个私钥和一个证书来识别您自己。您通过在初始化 SSLContext 时指定 KeyManagers 将其提供给 JSSE。

## 可定制的设置

以下是基本步骤。JSSE API 在 Java 6 中得到了显着改进，但我会坚持使用 Java 5，以防你被困在那个版本上。

```
KeyStore tks = KeyStore.getInstance(KeyStore.getDefaultType());
tks.load(...); /* Load the trust key store with root CAs. */
TrustManagerFactory tmf = 
  TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());
tmf.init(tks);
KeyStore iks = KeyStore.getInstance(KeyStore.getDefaultType());
iks.load(...); /* Load the identity key store with your key/cert. */
KeyManagerFactory kmf = 
  KeyManagerFactory.getInstance(KeyManagerFactory.getDefaultAlgorithm());
kmf.init(iks, password);
SSLContext ctx = SSLContext.getInstance("TLS");
ctx.init(kmf.getKeyManagers(), tmf.getTrustManagers(), null);
SocketFactory factory = ctx.getSocketFactory();
Socket socket = factory.createSocket(host, port); 
```

## 系统配置

使用提供程序时，可以使用另一种“零配置”方案`SunJSSE`。我相信许多其他供应商（如 IBM）都遵循了相同的模式，并且也会发挥作用。该机制使用[系统属性，](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/System.html#getProperties())[JSSE 参考指南](http://java.sun.com/j2se/1.5.0/docs/guide/security/jsse/JSSERefGuide.html#InstallationAndCustomization)中有详细描述。

对于客户端身份验证，[重要的属性](http://java.sun.com/j2se/1.5.0/docs/guide/security/jsse/JSSERefGuide.html#CustomizingStores)是`javax.net.ssl.keyStore`和`javax.net.ssl.keyStorePassword`。这些值应该分别是用户密钥存储的路径和该密钥存储的“密钥条目”的密码。

使用这些属性时，您可以创建一个支持客户端身份验证的新 SSLSocket，如下所示：

```
SocketFactory factory = SSLSocketFactory.getDefault();
Socket socket = factory.createSocket(host, port); 
```

由于您使用的是 "default" `SSLSocketFactory`，这取决于系统范围的属性，因此在 JVM 中创建的所有套接字都将使用相同的证书进行身份验证。如果您需要更多控制，则必须使用上面的“可自定义设置”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T12:44:57.873

Java 在标准 API 中包含 SSL 支持。查看 1.5.0 javadoc 中的这些类：

[SSLSocket](http://java.sun.com/j2se/1.5.0/docs/api/javax/net/ssl/SSLSocket.html)如果你自己做通讯逻辑。

[HttpsURLConnection](http://java.sun.com/j2se/1.5.0/docs/api/javax/net/ssl/HttpsURLConnection.html)如果服务器端使用 HTTP

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T10:21:08.913

你可以使用httpclient。看看这个[SSL 指南](http://hc.apache.org/httpclient-3.x/sslguide.html)。

# jquery - 即兴插件不起作用

> ID：385909
> 
> 赞同：0
> 
> 时间：2008-12-22T10:04:14.233
> 
> 标签：jquery, plugins, impromptu

我喜欢有一个需要显示选项列表的弹出模式对话框（如单选按钮选择事件）。但我不知道我错过了什么！当 Impromtu 中没有嵌入 HTML 标签时，它可以正常工作。我是否将其包含在 CSS 中？

```
<html>
    <head>
        <LINK REL=StyleSheet HREF="examples.css" TITLE="Contemporary" TYPE="text/css">
        <script src="jquery-1.2.6.js" type="text/javascript"></script>
        <script src="impromptu.1.6.js" type="text/javascript"></script>
        <script>
            $(document).ready(function(){                
               $.prompt( '<input type="radio" name="group1" value="Milk"> Milk<br>',{ opacity: 0.2 });                
            });            
        </script>
    <body>
    </body>
</html> 
```

当我运行它时，弹出对话框中没有显示单选按钮。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T11:23:39.707

您告诉 Impromtu 的只是在弹出窗口中显示一条消息“牛奶”。您还没有给它任何单选按钮标记来显示。

你需要的是这样的：

```
$(document).ready(function(){ 
        $.prompt( '<input type="radio" value="1">Milk</input>',{ opacity: 0.2 }); 
}); 
```

# silverlight-2.0 - Sharepoint 中的 Silverlight WebPart

> ID：385910
> 
> 赞同：0
> 
> 时间：2008-12-22T10:05:57.227
> 
> 标签：silverlight-2.0

我是 Silverlight 2.0 的新手，实际上我正在尝试在 Sharepoint 2007 中将 Silverlight 部署为 webpart。

我已经完成了以下安装：

1.  VS 2008 与 SP1
2.  Silverlight 2.0 SDK 和 exe
3.  VS 2008 的 Silverlight 工具
4.  苔藓植物 2007

我已经创建了示例 Silverlight 应用程序并从解决方案的 bin 目录中获取了 xap 文件。

然后我编写了一个标准的 Sharepoint webpart，其中引用了dll`Web.Extensions`和`Microsoft.Silverlight`dll：

```
using System;
using System.Runtime.InteropServices;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Serialization;
using System.Web.UI.SilverlightControls;
using Microsoft.SharePoint;
using Microsoft.SharePoint.WebControls;
using Microsoft.SharePoint.WebPartPages;

namespace SLWeb_Part1
{
    [Guid("c890f832-05d2-4724-ae25-5f34c827c6c2")]
    public class SLWeb_Part1 : System.Web.UI.WebControls.WebParts.WebPart
    {
        public SLWeb_Part1()
        {
        }

        [WebBrowsable(true),
        Personalizable(PersonalizationScope.User),
        WebDescription("Location of the Silverlight XAP package"),
        WebDisplayName("XAP Location")]
        public string XAPSource { get; set; }

        [WebBrowsable(true),
        Personalizable(PersonalizationScope.User),
        WebDescription("Silverlight Controld ID "),
        WebDisplayName("Control ID")]
        public string ControlID { get; set; }

        protected override void OnLoad(EventArgs e)
        {
            base.OnLoad(e);
            ScriptManager scriptManager = ScriptManager.GetCurrent(this.Page);
            if (scriptManager == null)
            {
                scriptManager = new ScriptManager();
                this.Controls.Add(scriptManager);
            }
        }

        protected override void CreateChildControls()
        {
            base.CreateChildControls();

            Silverlight sl = new Silverlight();
            sl.Source = XAPSource;
            sl.ID = ControlID;
            sl.Width = new Unit(400);
            sl.Height = new Unit(400);

            this.Controls.Add(sl);
        }
    } 
```

我也将其部署到了 Sharepoint 站点，然后我在 Sharepoint 站点的`web.config`文件中创建了一个条目，以包含 Silverlight 和 Web.Extension 程序集，如下所示：

```
<add assembly="System.Web.Silverlight, Version=2.0.5.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" /> 
```

然后我`application/x-silverlight-app`在 IIS 中包含了 Web 应用程序的 MIME 类型。

做完这一切之后……我可以像往常一样浏览网站，但是我看不到 Silverlight 组件正在运行……而且它也没有抛出任何错误……

谁能帮我尽快解决这个问题？我错过了配置中的任何步骤吗？

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T22:33:51.303

通过确保为 ASP.NET AJAX 正确配置了我的 SharePoint web.config，我能够解决我的问题。默认情况下未正确设置。有关如何执行此操作的详细信息，请参阅此站点：

[将 ASP.NET AJAX 与 SharePoint 集成](http://aspalliance.com/1719_Integrating_ASPNET_Ajax_WebPart_with_SharePoint_30.5)

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T10:13:54.263

您最好的起点是通读 u2u 上的 Silverlight for SharePoint 蓝图 - [http://www.codeplex.com/SL4SP](http://www.codeplex.com/SL4SP)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T19:16:24.220

在关注 Toms 的帖子后，如果使用 .net 3.5，请将 webconfig system.web.extensions 值从 1.06... 更改为 3.5.0.0

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T21:24:42.863

我正在尝试做同样的事情并遇到同样的问题。我已经追踪到我认为是 ScriptManager 的问题。

在一个普通的 ASPX 页面（我的 Silverlight 工作正常）中，ScriptManager 似乎将它添加到页面中：

```
<script src="/ScriptResource.axd?d=Un3ROg6ZO8lU8fUlhDz-soUWbkyxgh5pk-teueIPxbpft-XX1Z5TrN4P3iF-wiGinTLoxOt5mA420kQULjqoDnUjO5gjwu0sPPlLgxOq-5g1&amp;t=ffffffff888edfb1" type="text/javascript">
</script>
<script type="text/javascript"> 
//<![CDATA[
if (typeof(Sys) === 'undefined') throw new Error('ASP.NET Ajax client-side framework failed to load.');
//]]>
</script> 
```

但是，我的 WebPart 添加的 ScriptManager 不会将此代码添加到页面中。因此，当浏览器到达以下尝试加载 Silverlight 的代码时，它会因为未定义 Sys 对象而失败。

```
<script type="text/javascript"> 
//<![CDATA[
Sys.UI.Silverlight.Control.createObject('Xaml1_parent', '\u003cobject type="application/x-silverlight-2" id="Xaml1" style="height:100%;width:500px;">\r\n\t\u003cparam name="MinRuntimeVersion" value="2.0.31005.0">\r\n\r\n\t\u003c/param>\u003ca href="http://go2.microsoft.com/fwlink/?LinkID=114576&amp;v=2.0">\u003cimg src="http://go2.microsoft.com/fwlink/?LinkID=108181" alt="Get Microsoft Silverlight" style="border-width:0;" />\u003c/a>\r\n\u003c/object>');
//]]>
</script> 
```

希望这至少有助于推动讨论。

# ruby - Ruby：Object.to_a 替换

> ID：385912
> 
> 赞同：27
> 
> 时间：2008-12-22T10:06:09.130
> 
> 标签：ruby

我需要将传入的参数（单个对象或集合）转换为数组。我不知道论据是什么。如果它已经是一个数组，我想离开它，否则从它创建一个单元素数组。我希望**同时****允许`method(:objs => obj)``method(:objs => [obj1, obj2])`**

这似乎是最好的方法（Array#to_a 返回 self）：

```
arg = arg.to_a 
```

但是 ruby​​ 文档说**`Object#to_a`很快就会过时**。有没有方便的更换？

还有比这更简洁的吗？

```
arg = arg.respond_to?(:to_a) ? arg.to_a : [arg] 
```

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-12-22T16:41:24.213

使用方法[Kernel#Array](http://www.ruby-doc.org/core/classes/Kernel.html#M005989)：

```
Array([1,2,3]) #=> [1, 2, 3]
Array(123) #=> [123] 
```

是的，起初它可能看起来像一个类，但这实际上是一个以大写字母开头的方法。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2011-07-22T18:12:53.523

哇，有人刚刚死灵了一个非常古老的线程。:-O 但是由于我还没有看到它，为了完整起见，我将添加另一种方法：

```
arg = [*arg] 
```

如果它已经是一个数组（从而删除一层嵌套），这将释放参数，否则创建一个单参数数组：

```
arg = [1,2,3]
[*arg] #=> [1, 2, 3]
arg = 1
[*arg] #=> [1] 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-22T10:22:22.280

它似乎只[`Object.to_a`](http://ruby-doc.org/core-1.8.7/classes/Object.html#M000628)被弃用，删除默认值`to_a`并强制每个类定义自己的（例如，[`Hash.to_a`](http://ruby-doc.org/core-1.8.7/classes/Hash.html#M000153)）。

```
self.to_a       #=> -:1: warning: default `to_a' will be obsolete
"hello".to_a    #=> ["hello"]
Time.new.to_a   #=> [39, 54, 8, 9, 4, 2003, 3, 99, true, "CDT"]

h = { "c" => 300, "a" => 100, "d" => 400, "c" => 300  }
h.to_a   #=> [["a", 100], ["c", 300], ["d", 400]] 
```

如果您的论点是 的实例`Object`，请尝试：

```
Hash.new(obj).to_a 
```

* * *

@Daniel [对奥利维尔*的评论]：关键是我不知道论点是什么。如果它已经是一个数组，我想离开它，否则创建一个单元素数组。*

如果是这种情况，请尝试：

```
obj = [obj] if !obj.is_a?(Array) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-22T12:18:06.040

如果更适合问题，您可以采用鸭子类型方法，列出您需要的所有方法，并检查对象是否已经拥有它们，如果没有，请将其设为数组：

```
[:[], :each, :etc...].all? { |m| obj.respond_to? m } ? obj : [obj] 
```

优点是您让对象有机会为索引访问实现它自己的语义。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-22T16:41:24.027

我经常这样做，并且总是使用：

```
arg = [arg] unless arg.is_a?(Array) 
```

虽然如果你知道你永远不会将数组作为单独的参数传递，你也可以这样做：

```
arg = [arg].flatten 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-22T15:55:17.210

我不确定这是否有帮助，但我经常需要的不是 arg 是一个数组，而是 arg 响应每个数组。

```
arg = [arg] unless arg.respond_to? :each 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-22T10:18:00.120

那么 Array.new(1, arg) 呢？

# c# - 为什么 C# 中不包含 Java“抛出”子句（在方法声明中）？

> ID：385913
> 
> 赞同：23
> 
> 时间：2008-12-22T10:06:27.333
> 
> 标签：c#, java, exception, programming-languages

为什么 C# 中不包含 Java“抛出”子句（在方法声明中）？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-22T10:09:09.340

Anders Hejlsberg（首席 C# 架构师）在这次采访中解释了这一点：

[http://www.artima.com/intv/handcuffs.html](http://www.artima.com/intv/handcuffs.html)

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-12-22T10:16:23.307

（除了帕特里克有些明确的答案。）

Java 中的检查异常是一个非常有争议的问题。我曾经很喜欢它们，在编写 C# 时非常想念它们。感觉就像我在没有安全带的情况下开车。现在，它们惹恼了我……因为虽然它们在理论上听起来是个好主意，但它们*确实*给我带来了很多悲伤，但没有提供太多切实的好处。我不记得*曾经*在 C# 代码中遇到过检查异常可以拯救我的错误。这并不是说它不会发生，但它没有发生在我身上。

令人讨厌的是，在某些方面它仍然感觉 C# 过于松懈——但 Java 的方法并不完全正确。好像有更好的解决方案等待被发现，Java 的尝试是一个很好的实验，但它并没有完全奏效。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-22T11:16:02.530

我认为检查异常作为一种语言特性，暴露了微软和 Sun 之间的一些文化差异。

在大多数情况下，微软是一家客户公司。他们制作的大多数软件，以及他们的开发堆栈的目标，都是客户端软件。

是的，是的，我知道微软生产服务器软件。然而，就收入而言，Office 和 Windows 比 Windows Server 和 Exchange 大得多。

我认为可以公平地说大多数用 .NET 编写的软件（使用 VB 6 更是如此）是客户端软件。当然，其中很大一部分是运行在 Web 服务器上的 Web 软件，但其中大部分实际上是……“客户端类型的 Web 应用程序”。我想说大多数网络应用程序更像“Word”，然后它们就像 Exchange。

是的，我知道有 WCF 和 SOAP 服务以及类似的东西，但这些通常只是“客户端”类型的东西的“中间件”。

另一方面，Sun 主要是一家服务器公司。他们的软件在用户界面方面并不是最好的（这在 Unix 上并不是一个小问题......只是 Solaris.. Mac OS X 基于 unix，它有一个惊人的用户界面，两者之间的区别是 Sun 真的不像 Apple 那样关心 UI）。他们甚至出售瘦客户端，试图将所有内容推送到服务器上。

所以......无论如何......微软主要是客户公司，而Sun主要是服务器公司。

当您编写服务器软件时，可靠性是一件大事。它超大。如果电子邮件服务器崩溃，人们就收不到电子邮件，业务就会陷入停顿。因此，确保服务器能够智能地处理可能发生的大多数错误是销售电子邮件服务器的重要组成部分。

带客户端软件。可靠性很重要，但远没有服务器软件那么重要。只要大多数主线场景有效，人们就会很高兴。在许多情况下，可以忽略或一般处理疯狂的边缘场景。

超级可靠的一个关键是确保您处理所有可能发生的边缘情况。如果我们无法打开数据库文件，因为它被另一个进程锁定，或者我们没有读取它的权限，会发生什么？如果内存或磁盘空间不足怎么办？如果在运行此程序时断电会怎样？

对于非常高的可靠性要求，检查异常可能会有所帮助。如果有一个你没有预料到的场景，并且你对你的业务很重要，你可以预料到一切，那么让编译器告诉你......“嘿，你没有处理 RocketFuelExhaustedException”会很有帮助。

因此，我认为受检异常源于 Sun 作为服务器供应商的观点。

对于微软来说，作为一家向客户端软件开发人员销售开发工具的客户公司，检查异常当然是非常恼人的事情，会妨碍实际工作的完成。

无论如何，那是我的 0.02 美元...

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-22T10:17:43.647

主要原因是 C# 设计者决定不使用“检查异常”。这意味着开发人员不必在 try-catch 块中包含异常抛出子句。人们认为这仅对小规模应用程序有帮助，而对更大的项目没有真正的好处。此外，检查异常实际上被开发人员滥用，他们经常使用空的 catch 块。由于没有检查异常，因此没有理由声明可以引发哪些异常的方法。

“检查异常”的使用与否是一个有争议的话题，但大多数人似乎都同意没有必要使用它们。Spring 是 Java 中一个突出的框架，它将检查的异常转换为运行时异常。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T13:42:22.480

异常显然是“异常”事件。在 .net 的范例中，永远不应该发生异常（这就是为什么你有像`TryParse`, ... 这样的方法），所以被迫处理无论如何都不应该发生的事件是没有意义的。

# wxwidgets - wxWidgets : 非阻塞复制到 FTP

> ID：385916
> 
> 赞同：0
> 
> 时间：2008-12-22T10:10:03.427
> 
> 标签：wxwidgets

我想使用 wxFTP 将文件复制到 FTP 服务器，但我想在不阻塞 UI 的情况下执行此操作，并且更好，同时显示进度条。我可以在没有额外线程的情况下做到这一点吗？

我正在使用 wxLua，但我可以采用任何语言编写的解决方案，只要它使用 wxWidgets 绑定即可。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T00:05:45.467

尝试使用**wx.lib.delayedresult**。它在 wxPython 中可用，但也可能在您的 wxWidgets 库中。它创建单独的工作线程，并使用一个 *消费者*函数调用，该函数在工作线程完成工作后调用。很实用的东西。

有关详细信息，请参阅[wxPython 文档](http://www.wxpython.org/docs/api/wx.lib.delayedresult-module.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T10:23:08.237

为此启动自己的线程有什么问题？

您可以定期检查流`canRead()`方法（可能通过计时器或在事件循环中）并且仅在它返回 true 时读取，但它可能比仅仅启动一个单独的线程要复杂得多。

# .net - 如何映射以从 Nhibernate 的主表中获取值？

> ID：385919
> 
> 赞同：0
> 
> 时间：2008-12-22T10:12:32.113
> 
> 标签：.net, nhibernate, fluent-nhibernate, nhibernate-mapping

当我尝试从映射文件中的主表中获取值时，我遇到了一个问题。

我的桌子：

```
CREATE TABLE Customer
(
    [CustomerId] INT PRIMARY KEY,
    [FullName] NVARCHAR(50) NOT NULL
)

CREATE TABLE CustomerOrder
(
    [CustomerOrderId] INT PRIMARY KEY,
    [CustomerId] INT,
    [TransactionDate] DATETIME
) 
```

我的课程：

```
public class CustomerOrder
{
    public class Id {get; set;}
    public class CustomerName {get; set;}
    public class TransactionDate {get; set;}
}
... 
```

如何获取 FullName 值并映射到 CustomerOrder 流畅接口映射类中的 CustomerName 属性？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-22T11:53:59.537

你不会的，真的。更好的设计是拥有一个 Customer 属性，它是 Customer 类的一个实例。

```
public class CustomerOrder
{
  public int Id { get; set; }
  public Customer Customer { get; set; }
}

public class CustomerOrderMap : ClassMap<CustomerOrder>
{
  public CustomerOrderMap()
  {
    Id(x => x.Id);
    References(x => x.Customer);
  }
} 
```

然后您可以像这样使用它：

```
customerOrder.Customer.FullName 
```

如果你真的想拥有一个`CustomerName`属性，你可以在`CustomerOrder`.

```
public string CustomerName
{
  get { return Customer.FullName; }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T12:21:10.980

如果您想使用 Fluent-NHibernate 将一个类映射到多个表，您可以使用“WithTable”方法。

```
 public CustomerOrderMap()
    {
        Id(x => x.Id);
        Map(x => x.TransactionDate);

        WithTable("Customer", m =>
        {
            // Use .TheColumnNameIs since the property name is different from the column name
            m.Map(x => x.CustomerName)
                .TheColumnNameIs("FullName");
        });
    } 
```

# java - Eclipse Testrunner 中带有名称的 ParameterizedTest

> ID：385925
> 
> 赞同：9
> 
> 时间：2008-12-22T10:16:19.123
> 
> 标签：java, eclipse, unit-testing, junit, parameterized-unit-test

当您使用 Eclipse TestRunner 运行 JUnit 4 ParameterizedTest 时，图形表示相当愚蠢：对于每个测试，您都有一个名为`[0]`,`[1]`等的节点。是否可以给测试`[0]`,`[1]`等明确命名？为测试实施一种`toString`方法似乎没有帮助。

（这是 JUnit 测试的后续问题，[具有动态数量的测试](https://stackoverflow.com/questions/358802/junit-test-with-dynamic-number-of-tests)。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T11:57:42.103

我认为 jUnit 4 中没有*内置*任何东西可以做到这一点。

我已经实施了一个解决方案。`Parameterized`我已经基于现有的类构建了自己的类：

```
public class MyParameterized extends TestClassRunner {
    @Retention(RetentionPolicy.RUNTIME)
    @Target(ElementType.METHOD)
    public static @interface Parameters {
    }

    @Retention(RetentionPolicy.RUNTIME)
    @Target(ElementType.METHOD)
    public static @interface Name {
    }

    public static Collection<Object[]> eachOne(Object... params) {
        List<Object[]> results = new ArrayList<Object[]>();
        for (Object param : params)
            results.add(new Object[] { param });
        return results;
    }

    // TODO: single-class this extension

    private static class TestClassRunnerForParameters extends TestClassMethodsRunner {
        private final Object[] fParameters;

        private final Class<?> fTestClass;

        private Object instance;

        private final int fParameterSetNumber;

        private final Constructor<?> fConstructor;

        private TestClassRunnerForParameters(Class<?> klass, Object[] parameters, int i) throws Exception {
            super(klass);
            fTestClass = klass;
            fParameters = parameters;
            fParameterSetNumber = i;
            fConstructor = getOnlyConstructor();
            instance = fConstructor.newInstance(fParameters);
        }

        @Override
        protected Object createTest() throws Exception {
            return instance;
        }

        @Override
        protected String getName() {
            String name = null;
            try {
                Method m = getNameMethod();
                if (m != null)
                    name = (String) m.invoke(instance);
            } catch (Exception e) {
            }
            return String.format("[%s]", (name == null ? fParameterSetNumber : name));
        }

        @Override
        protected String testName(final Method method) {
            String name = null;
            try {
                Method m = getNameMethod();
                if (m != null)
                    name = (String) m.invoke(instance);
            } catch (Exception e) {
            }
            return String.format("%s[%s]", method.getName(), (name == null ? fParameterSetNumber : name));
        }

        private Constructor<?> getOnlyConstructor() {
            Constructor<?>[] constructors = getTestClass().getConstructors();
            assertEquals(1, constructors.length);
            return constructors[0];
        }

        private Method getNameMethod() throws Exception {
            for (Method each : fTestClass.getMethods()) {
                if (Modifier.isPublic((each.getModifiers()))) {
                    Annotation[] annotations = each.getAnnotations();
                    for (Annotation annotation : annotations) {
                        if (annotation.annotationType() == Name.class) {
                            if (each.getReturnType().equals(String.class))
                                return each;
                            else
                                throw new Exception("Name annotated method doesn't return an object of type String.");
                        }
                    }
                }
            }
            return null;
        }
    }

    // TODO: I think this now eagerly reads parameters, which was never the
    // point.

    public static class RunAllParameterMethods extends CompositeRunner {
        private final Class<?> fKlass;

        public RunAllParameterMethods(Class<?> klass) throws Exception {
            super(klass.getName());
            fKlass = klass;
            int i = 0;
            for (final Object each : getParametersList()) {
                if (each instanceof Object[])
                    super.add(new TestClassRunnerForParameters(klass, (Object[]) each, i++));
                else
                    throw new Exception(String.format("%s.%s() must return a Collection of arrays.", fKlass.getName(), getParametersMethod().getName()));
            }
        }

        private Collection<?> getParametersList() throws IllegalAccessException, InvocationTargetException, Exception {
            return (Collection<?>) getParametersMethod().invoke(null);
        }

        private Method getParametersMethod() throws Exception {
            for (Method each : fKlass.getMethods()) {
                if (Modifier.isStatic(each.getModifiers())) {
                    Annotation[] annotations = each.getAnnotations();
                    for (Annotation annotation : annotations) {
                        if (annotation.annotationType() == Parameters.class)
                            return each;
                    }
                }
            }
            throw new Exception("No public static parameters method on class " + getName());
        }
    }

    public MyParameterized(final Class<?> klass) throws Exception {
        super(klass, new RunAllParameterMethods(klass));
    }

    @Override
    protected void validate(MethodValidator methodValidator) {
        methodValidator.validateStaticMethods();
        methodValidator.validateInstanceMethods();
    }

} 
```

**像这样使用：**

```
@RunWith(MyParameterized.class)
public class ParameterizedTest {
    private File file;
    public ParameterizedTest(File file) {
        this.file = file;
    }

    @Test
    public void test1() throws Exception {}

    @Test
    public void test2() throws Exception {}

    @Name
    public String getName() {
        return "coolFile:" + file.getName();
    }

    @Parameters
    public static Collection<Object[]> data() {
        // load the files as you want
        Object[] fileArg1 = new Object[] { new File("path1") };
        Object[] fileArg2 = new Object[] { new File("path2") };

        Collection<Object[]> data = new ArrayList<Object[]>();
        data.add(fileArg1);
        data.add(fileArg2);
        return data;
    }
} 
```

这意味着我更早地实例化了测试类。我希望这不会导致任何错误......我想我应该测试测试:)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-12-05T17:23:46.827

JUnit4 现在[允许为 Parameterized annotation 指定 name 属性](https://github.com/junit-team/junit/wiki/Parameterized-tests)，以便您可以从参数的 index 和 toString 方法指定命名模式。例如：

```
@Parameters(name = "{index}: fib({0})={1}")
public static Iterable<Object[]> data() {
    return Arrays.asList(new Object[][] { { 0, 0 }, { 1, 1 }, { 2, 1 },
            { 3, 2 }, { 4, 3 }, { 5, 5 }, { 6, 8 } });
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-10-29T07:54:02.680

一个无代码但不是那么舒服的解决方案是传递足够的上下文信息来识别断言消息中的测试。您仍然会看到 testXY[0] failed 但详细消息会告诉您那是哪一个。

```
assertEquals("Not the expected decision for the senator " + this.currentSenatorName + " and the law " + this.votedLaw, 
expectedVote, actualVote); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-05-20T21:23:36.540

如果您使用[JUnitParams 库](https://github.com/Pragmatists/JUnitParams)（正如我在[这里所描述](https://stackoverflow.com/a/30360402/1064325)的），参数化测试将使用它们的字符串化参数作为它们自己的默认测试名称。

此外，[您可以在他们的示例中看到](https://github.com/Pragmatists/JUnitParams/blob/master/src/test/java/junitparams/usage/Samples_of_Usage_Test.java)，JUnitParams 还允许您使用以下方式自定义测试名称`@TestCaseName`：

> ```
> @Test
> @Parameters({ "1,1", "2,2", "3,6" })
> @TestCaseName("factorial({0}) = {1}")
> public void custom_names_for_test_case(int argument, int result) { } 
> ```
> 
> * * *
> 
> ```
> @Test
> @Parameters({ "value1, value2", "value3, value4" })
> @TestCaseName("[{index}] {method}: {params}")
> public void predefined_macro_for_test_case_name(String param1, String param2) { } 
> ```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-05T15:07:26.380

没有任何迹象表明此功能已经实现或将要实现。我会要求这个功能，因为它很好。

# mfc - 如何显示无模式对话框并立即在其中显示信息？

> ID：385928
> 
> 赞同：6
> 
> 时间：2008-12-22T10:16:42.430
> 
> 标签：mfc, dialog, modeless

我想在屏幕上显示一个无模式对话框并在其中显示一些信息。

但是，如果我按以下方式使用它，它会出现一些问题：

```
function()
{
showdialog(XXX).
//heavy work.
update the dialog..
//heavy work.
update the dialog...
} 
```

似乎显示了对话框，但它没有在其中绘制任何信息。它仅在功能结束时绘制所有信息。

如何修改无模式对话框以便立即显示信息？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-22T10:49:44.393

您可以做几件事。

**(1)**您可以从**CDialog::OnInitDialog**方法内部向对话框**发布**一条消息，然后在该发布消息的消息处理程序中处理长函数。这样，对话框将首先显示，然后长函数将运行。

 ****(2)**第二种选择是确保消息循环获得一些处理时间。因此，如果您的长函数是某种循环，只需偶尔调用**ProcessMessages**以确保消息队列保持为空：

```
void ProcessMessages()
{
    MSG msg;
    CWinApp* pApp = AfxGetApp();
    while (PeekMessage(&msg, NULL, 0, 0, PM_NOREMOVE))
    {
        pApp->PumpMessage();
    }
} 
```

**编辑：**在这种情况下当然可以使用线程，但这样做并不总是没有风险和复杂性。

使用带有**GUI**的线程意味着必须处理多个消息队列，这意味着使用诸如**PostThreadMessage**之类的 API ，并且引入了一组需要警惕的新问题。

有关此类问题的示例，请参阅此链接：

[http://msdn.microsoft.com/en-us/library/ms644946(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms644946(VS.85).aspx)

在哪里 说：

> PostThreadMessage 发送的消息与窗口无关。作为一般规则，与窗口无关的消息不能由 DispatchMessage 函数分派。因此，如果接收线程处于模式循环中（如 MessageBox 或 DialogBox 所使用的），则消息将丢失。要在模态循环中拦截线程消息，请使用线程特定的钩子。

[我在Zeus IDE](http://www.zeusedit.com)中使用进程消息方法，它可以很好地确保 GUI 保持对用户的响应。它还具有非常容易实现的优点。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-23T14:14:41.640

在 OnInitDialog 中，启动一个工作线程来执行计算。从工作线程发布用户消息以更新对话框。

由于以下几个原因，这优于 ProcessMessages 实现：

*   进行计算的代码可以从不属于它的 UI 代码中分离出来。

*   在执行实际计算时，UI 保持响应。ProcessMessages 允许在单个计算函数期间进行多次 UI 更新，但在实际计算过程中 UI 仍然会被阻塞。

对话框代码：

```
#define WM_NEW_COUNT (WM_USER + 0x101)

BEGIN_MESSAGE_MAP()
    ON_MESSAGE(WM_NEW_COUNT, OnNewCount)
END_MESSAGE_MAP()

BOOL CMyDialog::OnInitDialog()
{
    CWinThread* pThread = AfxBeginThread(MyCountFunc, this->GetSafeHwnd());
    return TRUE;
}

LRESULT CMyDialog::OnNewCount(WPARAM wParam, LPARAM)
{
    int newCount = (int)wParam;

    // m_count is DDX member, e.g. for label
    m_count = newCount;

    UpdateData(FALSE);

    return 0;
} 
```

* * *

工作线程：

```
UINT MyCountFunc(LPVOID lParam)
{
    HWND hDialogWnd = (HWND)lParam;

    for (int i=0; i < 100; ++i)
    {
        PostMessage(hDialogWnd, WM_NEW_COUNT, i, NULL);
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-22T12:44:30.667

根据经验，不应将繁重的计算放在 GUI 线程中。由于它是无模式对话框，因此对话框将不拥有消息循环。ProcessMessage() 解决方案将起作用，但 IMO 不是正确的方法。我的建议是：1）在 OnInitDialog() 中生成一个新线程 2）当有趣的事情发生时，让单独的线程向对话框发布消息。这些有趣的事情之一是工作已经完成。

但是请注意，这意味着您需要执行正确的同步。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-24T04:36:28.123

不要试图一次完成繁重的工作。让对话框在 OnInitDialog 的 WM_APP 范围内发布消息。WM_APP 处理程序可以完成部分繁重的工作，然后执行另一个 PostMessage 并返回。通过这种方式，您允许消息泵在您的处理块之间处理窗口消息。

# c# - 未从 HttpHandler 写入日志文件

> ID：385945
> 
> 赞同：3
> 
> 时间：2008-12-22T10:26:49.540
> 
> 标签：c#, asp.net, ihttphandler

我想捕获所有发送到`*.jpg`我服务器上文件的请求。为此，我创建了一个 HttpHandler，其代码如下：

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Web;
using System.IO;
using System.Globalization;

namespace MyHandler
{
    public class NewHandler : IHttpHandler
    {
        public NewHandler()
        {}

        public void ProcessRequest(System.Web.HttpContext ctx)
        {
            HttpRequest req = ctx.Request;
            string path = req.PhysicalPath;
            string extension = null;

            string contentType = null;           
            extension = Path.GetExtension(path).ToLower();

            switch (extension)
            {
                case ".gif":
                    contentType = "image/gif";
                    break;
                case ".jpg":
                    contentType = "image/jpeg";
                    break;
                case ".png":
                    contentType = "image/png";
                    break;
                default:
                    throw new NotSupportedException("Unrecognized image type.");
            } 

            if (!File.Exists(path))
            {
                ctx.Response.Status = "Image not found";
                ctx.Response.StatusCode = 404;
            }
            else
            {
                ctx.Response.Write("The page request is " + ctx.Request.RawUrl.ToString());
                StreamWriter sw = new StreamWriter(@"C:\requestLog.txt", true);
                sw.WriteLine("Page requested at " + DateTime.Now.ToString() 
                               + ctx.Request.RawUrl); sw.Close();

                ctx.Response.StatusCode = 200;
                ctx.Response.ContentType = contentType;
                ctx.Response.WriteFile(path);
            }
        }

        public bool IsReusable{get {return true;}}
    }
} 
```

在编译它并将其添加到我的 Web 应用程序的`Bin`目录中作为参考后，我在我的`web.config`文件中添加了以下内容：

```
<system.web>
    <httpHandlers>
      <add verb="*" path="*.jpg" type="MyHandler.NewHandler,MyHandler"/>
    </httpHandlers>
</system.web> 
```

然后我还修改了 IIS 设置`Home Directory -> Application Configuration`并添加`aspnet_isapi.dll`了`.jpg`扩展。

在处理程序中，我尝试在 C 驱动器中创建的日志文件中写入一些内容，但它没有写入日志文件，我无法找到错误。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T10:33:06.267

```
<httpHandlers>
   <add verb="" path=".jpg" type="MyHandler.NewHandler,MyHandler"/>
</httpHandlers> 
```

这只是stackoverflow的布局问题还是您省略了星号（*）：

```
<httpHandlers>
   <add verb="*" path="*.jpg" type="MyHandler.NewHandler,MyHandler"/>
</httpHandlers> 
```

如果它没有丢失星号，我会尝试在 Firefox 上的[Firebug](http://getfirebug.com/)中查看“网络”选项卡（或使用[Fiddler](http://www.fiddlertool.com/) - http 调试代理）。您从调用中得到什么 HTTP 响应代码？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T10:30:46.443

运行您的应用程序的用户是否有权访问 C:\？通常情况**并非**如此。允许应用程序上下文访问根目录会带来很大的安全风险。

而是创建一个特定目录，例如 c:\logs，并为 ASP.NET 应用程序池的用户帐户单独授予对该目录的完全权限。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-07-23T13:39:35.393

检查您的权限。

你没有从我这里听到这个，但是让“每个人”完全控制你的 C: 然后运行你的测试，看看是否创建了日志文件。（鼠标右键单击 C:、属性、安全选项卡等...）

完成后不要忘记删除权限。

授予“所有人”完全控制权只是测试您是否遇到权限问题。如果属实，那么您可以正确修复它。

完成后不要忘记删除权限。

# winforms - 如果异常处理应该集中处理，WinForm 组件的设计是否存在缺陷？

> ID：385949
> 
> 赞同：1
> 
> 时间：2008-12-22T10:30:40.373
> 
> 标签：winforms, architecture, exception-handling, widget

或者任何其他将 gui 小部件作为第一个调用端口的设计，未处理的异常会杀死应用程序？

我们都想要一个主要的：“抓住所有”以节省面子（尽管在大多数情况下，这不应该具有“继续”功能），但是不可能使用作为第一个调用端口的 gui 小部件轻松实现一个。这个设计有缺陷还是我在某个地方漏掉了一个技巧？

我之所以问这个问题是因为我正在阅读该语言的设计者的[一篇文章](http://www.artima.com/intv/handcuffs2.html)，他说异常处理应该是集中的，而我首先想到的是 WinForm 事件机制，这变得很困难。

WinForm/GUI 团队是在听他的，还是到那时可能为时已晚？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-22T10:50:21.600

您可以在 Application.Run 周围放置一个 try/catch，并处理 Application.ThreadException。在处理程序中，您可以记录异常并退出。

除了上述之外，我通常会在对业务层的所有调用（以及对客户端层中的外部资源的所有访问，例如导出到文件）的所有调用中放置一个异常处理程序，这些调用会显示错误但不退出应用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T10:34:27.340

你知道[Application.ThreadException](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.threadexception.aspx)吗？我并不是说它一定是最好的答案，但它至少*是一个*答案......

# http - curl-loader 是否支持 HTTP 1.0？

> ID：385955
> 
> 赞同：0
> 
> 时间：2008-12-22T10:33:32.850
> 
> 标签：http, testing

我正在使用 curl-loader 编写一个自动化测试程序，以将计算的请求发送到客户端。我需要知道 curl-loader 是否支持 HTTP 1.0，以便为测试用例编写代码。如果它支持它，我想知道如何使用它。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T10:56:34.547

我通过在他们的邮件列表中询问找到了答案。到目前为止，它似乎不支持 HTTP 1.0，但他们提出了一个可能带来支持的小改动。
更改尚未生效，因此到目前为止，实际上还没有对 HTTP 1.0 的支持。

# xml - 我在哪里可以获得 VS2K8 附带的“自定义工具”代码生成器列表？

> ID：385956
> 
> 赞同：2
> 
> 时间：2008-12-22T10:33:53.550
> 
> 标签：xml, visual-studio-2008, code-generation

我已经使用了相当多的 MSDataSetGenerator，但它会引起很多痛苦，因为 XMLSerializer 很少在输出上工作。SDK 附带有其他代码生成器吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-03-30T14:59:15.107

查看 HKLM\SOFTWARE\Microsoft\VisualStudio\9.0\Generators 中的注册表。子文件夹表示特定语言，即 {FAE04EC1-301F-11D3-BF4B-00C04F79EFBC} 代表 C# 语言。

每个生成器都有一个指向 HKLM\SOFTWARE\Microsoft\VisualStudio\9.0\CLSID 文件夹的 CLSID。

# ruby-on-rails - 将整数值列转换为字符串表示的最佳实践

> ID：385959
> 
> 赞同：3
> 
> 时间：2008-12-22T10:35:57.260
> 
> 标签：ruby-on-rails

假设您有如下模型：

```
class Stock < ActiveRecord::Base
  # Positions
  BUY = 1
  SELL = 2
end 
```

在该类中，作为整数类型的属性，称为“位置”，可以保存上述任何值。将这些整数值转换为人类可读字符串的 Rails 最佳实践是什么？

a) 使用辅助方法，但随后您必须确保使辅助方法和模型保持同步

```
def stock_position_to_s(position)
  case position
  when Stock::BUY
    'buy'
  when Stock::SELL
    'sell'
  end
  ''
end 
```

b) 在模型中创建一个方法，这会破坏干净的 MVC 方法。

```
class Stock < ActiveRecord::Base
  def position_as_string
    ...snip
  end
end 
```

c) 在 Rails 2.2 中使用新的 I18N 的新方法？

只是好奇其他人在数据库中有一个整数列需要输出为用户友好的字符串时在做什么。

谢谢，肯尼

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T10:44:16.773

对我来说听起来像是属于视图的东西，因为它是一个演示问题。

如果它被广泛使用，那么在用于 DRY 目的的辅助方法中，如果需要，请使用 I18N。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-23T15:41:07.423

试试这样的东西

```
class Stock < ActiveRecord::Base
  @@positions => {"Buy" => 1, "Sell" => 2}
  cattr_reader :positions

  validates_inclusion_of :position,  :in => positions.values
end 
```

它允许您将位置保存为整数，以及轻松使用选择助手。

当然，观点仍然是个问题。您可能想要使用帮助程序或`position_name`为此目的创建方法

```
class Stock < ActiveRecord::Base
  @@positions => {"Buy" => 1, "Sell" => 2}
  cattr_reader :positions

  validates_inclusion_of :position,  :in => positions.values

  def position_name
    positions.index(position)
  end
end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-28T13:24:47.967

不久前我写了一个可能有帮助的插件。看到[这个](http://github.com/fjfish/has_lookup_extension/tree/master)。它允许您定义列表并为您提供以 _str 结尾的好方法以用于显示目的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-23T09:40:45.733

@Derek P。这是我第一次使用的实现，虽然它确实有效，但它有点打破了 MVC 隐喻，因为模型现在在其类中定义了视图相关信息。控制器中的字符串是一回事，但模型中的字符串（在我看来）绝对违背了干净 MVC 的精神。

如果你想开始本地化，它也不起作用，所以虽然这是我最初使用的方法，但我不认为这是未来开发的方法（绝对不是在 I18N 世界中。）

感谢您的输入。

真诚的，肯尼

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T10:53:25.023

应用程序是否有充分的理由以编程方式将整数转换为人类可读的字符串？

我会制作具有位置整数属性和名称属性的位置对象。

然后你可以做

```
stock.position.name 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T02:24:53.740

@HermanD：出于多种原因，我认为将值存储在整数列而不是字符串列中要好得多。

1.  它节省了数据库空间。
2.  比字符串更容易/更快地索引整数。
3.  您不会将人类可读的字符串硬编码为数据库中的值。（如果客户说“购买”应该变成“购买”会发生什么？现在 UI 到处都显示“购买”，但您需要继续在数据库中设置“购买”。）

因此，如果您将某些值作为整数存储在数据库中，那么在某些时候，您将需要将它们作为字符串显示给用户，我认为您可以做到这一点的唯一方法是以编程方式。

您可以将此信息移动到另一个对象中，但恕我直言，我会说这是矫枉过正。然后，您必须添加另一个数据库表。添加另一个“管理”部分，用于添加、删除和重命名这些值等等。更不用说，如果您有多个列，在需要此行为的不同模型中，您要么必须创建大量这些对象（例如：stock_positions、stock_actions、transaction_kinds 等），要么必须设计它通常足以使用多态关联。最后，如果职位名称是硬编码的，那么您将无法在以后轻松本地化它。

@frankodwyer：我不得不同意使用辅助方法可能是最好的方法。我希望他们可能是一种“更巧妙”的方式来做到这一点，但它看起来不像。目前，我认为最好的方法是创建一个新的辅助模块，可能是 StringsHelper 之类的东西，并在其中填充一堆用于将模型常量转换为字符串的方法。这样，如果将来需要，我可以使用助手中的所有 I18N 内容来提取本地化字符串。烦人的部分是，如果有人需要向模型列添加新值，那么他们还必须在帮助程序中添加一个检查。不是 100% DRY，但我想“足够接近”......

感谢你们两位的投入。

肯尼

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-23T02:40:11.337

为什么不使用本机数据结构的属性？例子：

class Stock < ActiveRecord::Base ACTIONS = [nil,'buy','sell'] end

然后你可以使用 Stock::ACTIONS[1] #=> 'buy' 或 Stock::ACTIONS[2] #=> 'sell' 来获取它们

或者，您可以使用哈希 {:buy => 1, :sell => 2} 并将其作为 Stock::ACTIONS[:buy] #=> 1 访问

你明白了。

# javascript - JavaScript - 确定属性是否已定义并设置为“未定义”或未定义

> ID：385960
> 
> 赞同：40
> 
> 时间：2008-12-22T10:35:59.803
> 
> 标签：javascript, object, properties, undefined

假设我有以下代码：

```
function One() {}
One.prototype.x = undefined;

function Two() {}

var o = new One();
var t = new Two(); 
```

`o.x`并且`t.x`都将评估为`undefined`. `o.hasOwnProperty('x')`并且`t.hasOwnProperty('x')`都将返回false；也是如此`propertyIsEnumerable`。两个问题：

*   有没有办法告诉 ox 已定义并设置为`undefined`？
*   有任何理由吗？（两者在语义上应该是等价的吗？）

一个小警告：执行 (for propName in o) 循环将产生 'x' 作为字符串之一，而在 t 中执行不会 - 因此它们在内部的表示方式存在差异（至少在 Chrome 中）。

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-12-22T10:50:09.853

比您的方法稍微简单的方法是使用[Javascript in 运算符](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Operators/Special_Operators/in_Operator)

```
alert('x' in o); // true
alert('x' in t); // false 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-22T10:57:46.497

object.hasOwnProperty(name) 仅对同一对象中的对象返回 true，对其他所有对象（包括原型中的属性）返回 false。

```
function x() {
  this.another=undefined;
};

x.prototype.something=1;
x.prototype.nothing=undefined;
y = new x;

y.hasOwnProperty("something"); //false
y.hasOwnProperty("nothing"); //false
y.hasOwnProperty("another"); //true

"someting" in y; //true
"another" in y; //true 
```

此外，删除属性的唯一方法是使用删除。将其设置为未定义不要删除它。

正确的做法是像[roborg](https://stackoverflow.com/users/24181/)所说的那样使用**in 。**

更新： **undefined**是一个原始值，请参阅[ECMAScript 语言规范](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf)第 4.3.2 和 4.3.9 节。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-22T11:24:40.187

Ach，其中一个用于反模式线程。

**`undefined`不是关键字。**

当您分配 write 时，您正在为它分配您尚未定义`var foo = undefined;`的符号的值，因此您将获得的值是. 如果您分配了它，您将产生完全相同的结果，或者`undefined``"undefined"``UnDeFiNeD``NotFineAtAll``_qwertyuiop`

为什么会如此可怕？除了它会导致对正在发生的事情的错误理解之外，如果你碰巧加载了一个库或雇佣了一个编写的开发人员会发生什么`var undefined = true;`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T10:40:50.493

像这样的东西？

```
function isDefined(var){
   return (typeof(window[var]) == 'undefined') ? false : true;
} 
```

或者..

```
function isDefined(var){
   return (window.var === undefined) ? false : true;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T10:45:22.827

不，我不认为等于的变量`undefined`应该被识别为“已定义”。

直接将其设置为等于`undefined`只是一种删除它的懒惰方式——与使用`delete`关键字相反。我相信这只是意味着垃圾收集没有对变量/属性产生影响。

* * *

[**编辑**]

关于您对`hasOwnProperty`and的评论`propertyIsEnumerable`，原型方法/属性既不是对象自己的，也不是可枚举的。

```
Object.prototype.foo = 'something';

var o = {bar: 'anything'};
o.hasOwnProperty('foo');  //=> false
o.hasOwnProperty('bar');  //=> true

Object.prototype.hasOwnProperty('foo');  //=> true 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T10:39:20.060

一种方法是：

```
var definedProperties = [];
for (var prop in o) definedProperties.push(prop);

if (o.x === undefined && contains(prop, 'x')) {
    //x is defined, but set to undefined
} 
```

where`contains`只检查数组中的任何元素是否为`'x'`. 这是唯一的方法吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-22T10:39:23.743

您可以尝试在 One.x 上放置手表，但这只会在未定义时告诉您。

# c# - 奇怪的c#溢出错误

> ID：385966
> 
> 赞同：7
> 
> 时间：2008-12-22T10:41:59.057
> 
> 标签：c#, overflow, long-integer

有人能解释一下变量a溢出的原因吗？请注意，b 大于 a。

```
static void Main(string[] args)
{
     int i = 2;    
     long a = 1024 * 1024 * 1024 * i;
     long b = 12345678901234567;
     System.Console.WriteLine("{0}", a);
     System.Console.WriteLine("{0}", b);
     System.Console.WriteLine("{0}", long.MaxValue);
}

-2147483648
 12345678901234567
 9223372036854775807
 Press any key to continue . . . 
```

谢谢！

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-22T10:44:58.443

RHS 是一个*int*乘法，因为表达式的每个部分都是一个 int。仅仅因为它被分配给 long 并不意味着它是用 long 算术执行的。

将其更改为：

```
long a = 1024L * 1024 * 1024 * i; 
```

它会起作用的。（不同的是第一个 1024 末尾的 L。）

# iphone - ExtAudioFileOpenUrl 给出 EXC_BAD_ACCESS

> ID：385968
> 
> 赞同：0
> 
> 时间：2008-12-22T10:42:53.750
> 
> 标签：iphone, cocoa-touch, core-audio

我使用 iPhone SDK 创建了一个示例应用程序，它使用 AudioToolBox 框架中的 ExtAudioFileOpenURL。我的应用程序文件夹中有一个 test.mp3 音频文件。当我尝试使用这个 API 打开这个音频文件时，我收到了 EXEC_BAD_ACCESS。我不知道为什么。

这是一个代码片段：

```
NSArray *arr = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);
NSString *str = [arr objectAtIndex:0];
NSString * temp = [NSString stringWithFormat:@"%@/test.mp3", str];
CFURLRef url = CFURLCreateWithFileSystemPath(kCFAllocatorDefault, (CFStringRef)temp, kCFURLPOSIXPathStyle, false);
//AudioFileID fileID ;
//AudioFileOpenURL(url, 0X01, kAudioFileCAFType, &fileID);
ExtAudioFileRef audioFileRef = NULL;
ExtAudioFileOpenURL(url, &audioFileRef); 
```

当我尝试 ExtAudioFileOpenURL 时，我得到 EXC_BAD_ACCESS。我认为这是因为传递的 URL 无效。但是当我尝试 AudioFileOpenURL 时，它可以很好地确保我的 URL 是有效的。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-08-01T17:44:28.000

我写这个是为了解释 EXC_BAD_ACCESS

[http://www.loufranco.com/blog/files/Understanding-EXC_BAD_ACCESS.html](http://www.loufranco.com/blog/files/Understanding-EXC_BAD_ACCESS.html)

基本上，您（可能）要么向解除分配的对象发送消息，要么以某种方式破坏堆。当一个无害的调用引发 EXC_BAD_ACCESS 时，它几乎总是内存损坏。

您永远不会在此代码中调用 release 或 dealloc，因此此代码不太可能导致将消息发送到已释放的对象。

因此，可能导致 EXC_BAD_ACCESS 的任何原因都发生在此代码之前。您可以通过将此代码移到应用程序的早期阶段来证明这一点——它可能会起作用。如果不是，那么您确实需要真正检查此代码，但如果它有效，那么它介于这些点之间。

找到损坏的最有效方法可能是启用 Malloc 调试，然后按照我的博客中的说明使用调试器查找导致损坏堆的行。

# f# - F# 会成为主流语言吗？

> ID：385973
> 
> 赞同：8
> 
> 时间：2008-12-22T10:45:07.710
> 
> 标签：f#

我对 F# 提供的东西非常感兴趣，并且非常渴望开始基于时间的投资来学习它。然而，F# 工作是否会开始实现，还是会是一种浪费的投资？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-22T19:52:58.383

冒着引发一场激烈战争的风险，我喜欢将 F# 视为一个更好的 OCaml，具有更少的陷阱和更好的库。我不觉得很难相信 F# 会吸引大部分 OCaml 社区跨入 .NET Land。

（这种策略似乎与微软试图用 J# 吸引 Java 开发人员时使用的方法非常相似，结果证明是失败的。让我们希望 F# 不会以同样的方式失败。）

至少根据我的经验，.NET 软件商店倾向于使用 VB.NET 和 C#，而排除所有其他语言。VB.NET 和 C# 尤其畅销，因为：

*   他们有非常完善的 RAD 和 GUI 支持。F# GUI 需要手工编写，这使得该语言不适合开发大型、复杂的用户界面。

*   现有的文档是用 C# 和 VB.NET 编写的，使新手程序员在学习 .NET BCL 的同时更容易学习 C# 和 VB.NET。F#程序员需要脑补C#/VB.NET，所以至少懂C#已经是学习F#的先决条件了。

*   VB.NET/C# 借鉴了 Java 和 C++ 建立的熟悉的命令式编程风格。函数式编程远远超出主流，这减缓了程序员从命令式语言到 F# 的交叉。

至少，我对 F# 持乐观态度。它有一些你在其他语言中看不到的东西：

*   它在博客中有大量媒体曝光，我在最近参加的 5 次 .NET 会议中看到了 F# 演示。

*   我虔诚地关注编程博客，看起来整个编程社区已经对基于锁的多线程方法感到沮丧。多线程中的可变状态是一个杀手，这促使许多程序员使用不可变数据结构切换到无锁风格。F# 中的不变性比 C# 更自然，F# 中的异步工作流使多线程代码非常容易推理。

*   F#在某些任务上确实比 C# 更好*。*例如，在 100% 的情况下，任何涉及将 XML 或源代码转换为抽象语法的事情在 F# 中都容易几个数量级。

*   随着每一个新的发展，C# 变得越来越“功能化”。这有助于将函数式编程更多地带入主流并被广泛接受。虽然您可以以函数式风格编写 C#，但大多数人发现它非常笨拙，尤其是在涉及大量泛型类型时。就好像功能特性是事后才添加的——使用 F# 等真正的函数式语言编写函数式风格更容易。

*   最重要的是，F# 不仅仅是另一个具有不同语法的 C# 克隆。我的公司使用 F# 来补充我们现有的 C# 代码库，因为它提供了一组全新的工具，而这些工具在 C# 中并不容易获得。

If F# goes mainstream, I imagine it'll be used in the way mentioned in the final bulletpoint, as a companion language to C# and VB.NET. People aren't going to adopt F# because its a superior alternative to C#/VB.NET, people will use F# when they grow out of the One True Language™ / "everything looks like a nail" approach to writing software.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-22T11:05:17.077

它将成为 Visual Studio 10 的一部分，所以知道它不会有什么坏处

[看到这个](http://blogs.msdn.com/dsyme/archive/2008/12/10/fsharp-to-ship-as-part-of-visual-studio-2010.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-22T11:26:37.313

我怀疑函数式编程语言是否会非常流行。但是，F# 很容易成为最成功的函数式语言。它背后有一个庞大的库（即 .NET CLR），它与非常流行的语言（C#、VB 等）无缝集成，不久它将在世界上最流行的 IDE（Visual Studio）中得到支持。

我看不出花时间学习 F# 会浪费多少时间。您始终可以从 C# 调用 F# 组件。此外，您可以学习一种新的编程思维方式，无论您使用哪种语言，都可以随身携带。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T20:05:21.307

There are a few sectors where it is (or OCaml) is quite common - such as finance, or other statistical analysis. However, I severely doubt that it is suddlenly going to leap to the fore for mainstream code. One of the bigger issues here is that since C# gets more functional (and hopefully with better immutability in C# 5.0), it has less and less to distinguish it from the regular .NET languages like C#.

See also [here](https://stackoverflow.com/questions/169812/) and [here](https://stackoverflow.com/questions/386076).

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-04T23:01:09.543

I looked at it last year, and It's on my list of Languages to truly get into this year. So I'd say it's definitely becoming mainstream.

I'm talking in the Microsoft developer world primarily.

# c - C 代码中的错误处理

> ID：385975
> 
> 赞同：171
> 
> 时间：2008-12-22T10:46:04.057
> 
> 标签：c, error-handling

在 C 库中以一致的方式处理错误时，您认为“最佳实践”是什么？

我一直在考虑两种方法：

总是返回错误代码。一个典型的函数如下所示：

```
MYAPI_ERROR getObjectSize(MYAPIHandle h, int* returnedSize); 
```

始终提供错误指针方法：

```
int getObjectSize(MYAPIHandle h, MYAPI_ERROR* returnedError); 
```

当使用第一种方法时，可以编写这样的代码，其中错误处理检查直接放在函数调用上：

```
int size;
if(getObjectSize(h, &size) != MYAPI_SUCCESS) {
  // Error handling
} 
```

这看起来比这里的错误处理代码更好。

```
MYAPIError error;
int size;
size = getObjectSize(h, &error);
if(error != MYAPI_SUCCESS) {
    // Error handling
} 
```

但是，我认为使用返回值来返回数据会使代码更具可读性，很明显，在第二个示例中，size 变量中写入了一些内容。

您对为什么我应该更喜欢这些方法中的任何一种或可能将它们混合或使用其他方法有任何想法吗？我不喜欢全局错误状态，因为它往往会使多线程使用库的方式更加痛苦。

编辑：只要不涉及异常，C++ 的具体想法也会很有趣，因为目前这不是我的选择......

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2008-12-22T19:39:58.690

我已经使用了这两种方法，它们都对我很好。无论我使用哪一个，我总是尝试应用这个原则：

*如果唯一可能的错误是程序员错误，请不要返回错误代码，在函数内部使用断言。*

验证输入的断言清楚地传达了函数的期望，而过多的错误检查会混淆程序逻辑。决定如何处理所有各种错误情况确实会使设计复杂化。如果你可以坚持程序员永远不会传递一个空指针，为什么还要弄清楚 functionX 应该如何处理一个空指针呢？

* * *

## 回答 #2

> 赞同：80
> 
> 时间：2008-12-22T11:01:46.427

我喜欢错误作为返回值的方式。如果您正在设计 api，并且希望尽可能轻松地使用您的库，请考虑以下添加：

*   将所有可能的错误状态存储在一个类型定义的枚举中，并在您的库中使用它。不要只返回整数或更糟，将整数或不同的枚举与返回码混合。

*   提供一个函数，将错误转换为人类可读的东西。可以很简单。只是错误枚举输入， const char* 输出。

*   我知道这个想法使多线程的使用有点困难，但如果应用程序程序员可以设置一个全局错误回调，那就太好了。这样，他们将能够在 bug-hunt 会话期间将断点放入回调中。

希望能帮助到你。

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2016-12-09T00:54:10.413

CMU 的 CERT 提供了一组不错[的幻灯片](https://resources.sei.cmu.edu/asset_files/Presentation/2016_017_101_484207.pdf)，其中包含有关何时使用每种常见 C（和 C++）错误处理技术的建议。最好的幻灯片之一是这个决策树：

[![错误处理决策树](https://i.stack.imgur.com/L8wQq.png)](https://i.stack.imgur.com/L8wQq.png)

我个人会改变关于这个流程图的两件事。

首先，我要澄清的是，有时对象应该使用返回值来指示错误。如果一个函数只从对象中提取数据但不改变对象，那么对象本身的完整性没有风险，使用返回值指示错误更合适。

其次，在 C++ 中使用异常并不*总是合适的。*异常是好的，因为它们可以减少用于错误处理的源代码量，它们大多不影响函数签名，并且它们可以非常灵活地传递调用堆栈上的哪些数据。另一方面，由于以下几个原因，例外可能不是正确的选择：

1.  C++ 异常具有非常特殊的语义。如果您不想要这些语义，那么 C++ 异常是一个糟糕的选择。异常必须在抛出后立即处理，并且设计倾向于错误需要将调用堆栈展开几级的情况。

2.  抛出异常的 C++ 函数以后不能被包装成不抛出异常，至少在不支付异常的全部成本的情况下是这样。可以包装返回错误代码的函数以引发 C++ 异常，从而使其更加灵活。C++`new`通过提供非抛出变体来实现这一点。

3.  C++ 异常相对昂贵，但是对于合理使用异常的程序来说，这个缺点大多被夸大了。程序根本不应该在关注性能的代码路径上抛出异常。程序报告错误和退出的速度有多快并不重要。

4.  有时 C++ 异常不可用。要么它们在一个 C++ 实现中实际上不可用，要么一个人的代码指南禁止它们。

* * *

由于最初的问题是关于多线程上下文的，我认为本地错误指示器技术（在[SirDarius](https://stackoverflow.com/users/393701/sirdarius)的[回答](https://stackoverflow.com/a/14551626/)中描述的内容）在原始答案中被低估了。它是线程安全的，不会强制调用者立即处理错误，并且可以捆绑描述错误的任意数据。缺点是它必须由一个对象持有（或者我想以某种方式与外部关联）并且可以说比返回代码更容易忽略。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-12-23T05:38:20.230

每当我创建一个库时，我都会使用第一种方法。使用 typedef 的枚举作为返回码有几个优点。

*   如果函数返回更复杂的输出，例如数组及其长度，则无需创建任意结构即可返回。

    ```
    rc = func(..., int **return_array, size_t *array_length); 
    ```

*   它允许简单、标准化的错误处理。

    ```
    if ((rc = func(...)) != API_SUCCESS) {
       /* Error Handling */
    } 
    ```

*   它允许在库函数中进行简单的错误处理。

    ```
    /* Check for valid arguments */
    if (NULL == return_array || NULL == array_length)
        return API_INVALID_ARGS; 
    ```

*   使用 typedef 的枚举还允许枚举名称在调试器中可见。这样可以更轻松地进行调试，而无需经常查阅头文件。具有将此枚举转换为字符串的函数也很有帮助。

无论使用何种方法，最重要的问题是保持一致。这适用于函数和参数命名、参数排序和错误处理。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2016-07-21T12:39:12.547

返回错误代码是 C 中错误处理的常用方法。

但最近我们也尝试了传出错误指针方法。

与返回值方法相比，它有一些优点：

*   您可以将返回值用于更有意义的目的。

*   必须写出错误参数会提醒您处理错误或传播错误。（你永远不会忘记检查 的返回值`fclose`，不是吗？）

*   如果您使用错误指针，则可以在调用函数时将其传递下去。如果任何功能设置它，该值不会丢失。

*   通过在错误变量上设置数据断点，您可以捕获错误首先发生的位置。通过设置条件断点，您也可以捕获特定错误。

*   它可以更轻松地自动检查您是否处理所有错误。代码约定可能会强制您将错误指针称为 as`err`并且它必须是最后一个参数。所以脚本可以匹配字符串`err);`然后检查它是否跟在`if (*err`. 实际上，在实践中，我们制作了一个名为`CER`(check err return) 和`CEG`(check err goto) 的宏。因此，当我们只想返回错误时，您不需要总是输入它，并且可以减少视觉混乱。

不过，并非我们代码中的所有函数都有这个传出参数。这个传出参数的东西用于通常会引发异常的情况。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2011-04-19T19:08:02.773

使用[setjmp](http://en.wikibooks.org/wiki/C_Programming/Coroutines#setjmp)。

[http://en.wikipedia.org/wiki/Setjmp.h](http://en.wikipedia.org/wiki/Setjmp.h)

[http://aszt.inf.elte.hu/~gsd/halado_cpp/ch02s03.html](http://aszt.inf.elte.hu/~gsd/halado_cpp/ch02s03.html)

[http://www.di.unipi.it/~nids/docs/longjump_try_trow_catch.html](http://www.di.unipi.it/~nids/docs/longjump_try_trow_catch.html)

```
#include <setjmp.h>
#include <stdio.h>

jmp_buf x;

void f()
{
    longjmp(x,5); // throw 5;
}

int main()
{
    // output of this program is 5.

    int i = 0;

    if ( (i = setjmp(x)) == 0 )// try{
    {
        f();
    } // } --> end of try{
    else // catch(i){
    {
        switch( i )
        {
        case  1:
        case  2:
        default: fprintf( stdout, "error code = %d\n", i); break;
        }
    } // } --> end of catch(i){
    return 0;
} 
```

* * *

```
#include <stdio.h>
#include <setjmp.h>

#define TRY do{ jmp_buf ex_buf__; if( !setjmp(ex_buf__) ){
#define CATCH } else {
#define ETRY } }while(0)
#define THROW longjmp(ex_buf__, 1)

int
main(int argc, char** argv)
{
   TRY
   {
      printf("In Try Statement\n");
      THROW;
      printf("I do not appear\n");
   }
   CATCH
   {
      printf("Got Exception!\n");
   }
   ETRY;

   return 0;
} 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2019-12-06T23:08:10.583

这是一个简单的程序来演示[Nils Pipenbrinck 的答案](https://stackoverflow.com/questions/385975/error-handling-in-c-code/386001#386001)的前 2 个项目符号。

他的前两颗子弹是：

> *   将所有可能的错误状态存储在一个类型定义的枚举中，并在您的库中使用它。不要只返回整数或更糟，将整数或不同的枚举与返回码混合。
>     
>     
> *   提供一个函数，将错误转换为人类可读的东西。可以很简单。只是错误枚举输入， const char* 输出。

假设您编写了一个名为`mymodule`. **首先，在 mymodule.h 中，定义基于枚举的错误代码，并编写一些与这些代码相对应的错误字符串。**在这里，我使用了一个 C 字符串数组 ( `char *`)，它仅在您的第一个基于枚举的错误代码的值为 0 并且您此后不操作数字时才有效。*如果您确实使用带有间隙或其他起始值的错误代码编号，您只需从使用映射的 C 字符串数组（如下所示）更改为使用使用 switch 语句或 if / else if 语句的函数从枚举错误代码映射到可打印的 C 字符串（我没有演示）。*这是你的选择。

**我的模块.h**

```
/// @brief Error codes for library "mymodule"
typedef enum mymodule_error_e
{
    /// No error
    MYMODULE_ERROR_OK = 0,

    /// Invalid arguments (ex: NULL pointer where a valid pointer is required)
    MYMODULE_ERROR_INVARG,

    /// Out of memory (RAM)
    MYMODULE_ERROR_NOMEM,

    /// Make up your error codes as you see fit
    MYMODULE_ERROR_MYERROR, 

    // etc etc

    /// Total # of errors in this list (NOT AN ACTUAL ERROR CODE);
    /// NOTE: that for this to work, it assumes your first error code is value 0 and you let it naturally 
    /// increment from there, as is done above, without explicitly altering any error values above
    MYMODULE_ERROR_COUNT,
} mymodule_error_t;

// Array of strings to map enum error types to printable strings
// - see important NOTE above!
const char* const MYMODULE_ERROR_STRS[] = 
{
    "MYMODULE_ERROR_OK",
    "MYMODULE_ERROR_INVARG",
    "MYMODULE_ERROR_NOMEM",
    "MYMODULE_ERROR_MYERROR",
};

// To get a printable error string
const char* mymodule_error_str(mymodule_error_t err);

// Other functions in mymodule
mymodule_error_t mymodule_func1(void);
mymodule_error_t mymodule_func2(void);
mymodule_error_t mymodule_func3(void); 
```

mymodule.c 包含我的映射函数，用于从枚举错误代码映射到可打印的 C 字符串：

**我的模块.c**

```
#include <stdio.h>

/// @brief      Function to get a printable string from an enum error type
/// @param[in]  err     a valid error code for this module
/// @return     A printable C string corresponding to the error code input above, or NULL if an invalid error code
///             was passed in
const char* mymodule_error_str(mymodule_error_t err)
{
    const char* err_str = NULL;

    // Ensure error codes are within the valid array index range
    if (err >= MYMODULE_ERROR_COUNT)
    {
        goto done;
    }

    err_str = MYMODULE_ERROR_STRS[err];

done:
    return err_str;
}

// Let's just make some empty dummy functions to return some errors; fill these in as appropriate for your 
// library module

mymodule_error_t mymodule_func1(void)
{
    return MYMODULE_ERROR_OK;
}

mymodule_error_t mymodule_func2(void)
{
    return MYMODULE_ERROR_INVARG;
}

mymodule_error_t mymodule_func3(void)
{
    return MYMODULE_ERROR_MYERROR;
} 
```

main.c 包含一个测试程序来演示调用一些函数并从中打印一些错误代码：

**主程序**

```
#include <stdio.h>

int main()
{
    printf("Demonstration of enum-based error codes in C (or C++)\n");

    printf("err code from mymodule_func1() = %s\n", mymodule_error_str(mymodule_func1()));
    printf("err code from mymodule_func2() = %s\n", mymodule_error_str(mymodule_func2()));
    printf("err code from mymodule_func3() = %s\n", mymodule_error_str(mymodule_func3()));

    return 0;
} 
```

输出：

> 在 C（或 C++）中演示基于枚举的错误
> 代码来自 mymodule_func1() 的错误代码 = MYMODULE_ERROR_OK
> 来自 mymodule_func2() 的
> 错误代码 = MYMODULE_ERROR_INVARG 来自 mymodule_func3() 的错误代码 = MYMODULE_ERROR_MYERROR

# 参考：

您可以在此处自己运行此代码：[https](https://onlinegdb.com/ByEbKLupS) ://onlinegdb.com/ByEbKLupS 。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-12-22T11:00:07.413

我个人更喜欢前一种方法（返回错误指示器）。

如有必要，返回结果应仅表明发生了错误，并使用另一个函数来找出确切的错误。

在您的 getSize() 示例中，我认为大小必须始终为零或正数，因此返回负数结果可能表示错误，就像 UNIX 系统调用一样。

我想不出我使用过的任何库都适用于后一种方法，其中错误对象作为指针传入。 `stdio`等都带有返回值。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-12-22T11:12:26.267

UNIX 方法与您的第二个建议最相似。返回结果或单个“出错”值。例如，open 将在成功时返回文件描述符，或在失败时返回 -1。在失败时，它还设置`errno`一个外部全局整数来指示发生了*哪个*失败。

值得一提的是，Cocoa 也采用了类似的方法。许多方法返回 BOOL，并接受一个`NSError **`参数，因此在失败时它们会设置错误并返回 NO。然后错误处理如下所示：

```
NSError *error = nil;
if ([myThing doThingError: &error] == NO)
{
  // error handling
} 
```

这介于您的两个选项之间:-)。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2011-08-08T14:05:28.583

当我编写程序时，在初始化期间，我通常会分离一个线程来处理错误，并为错误初始化一个特殊的结构，包括一个锁。然后，当我检测到错误时，通过返回值，我将异常中的信息输入到结构中并向异常处理线程发送 SIGIO，然后查看是否无法继续执行。如果我不能，我会向异常线程发送一个 SIGURG，它会优雅地停止程序。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-12-22T11:00:53.217

我过去做过很多 C 编程。我真的很欣赏错误代码的返回值。但是它有几个可能的陷阱：

*   重复的错误编号，这可以通过全局 errors.h 文件解决。
*   忘记检查错误代码，这应该通过提示和长时间的调试来解决。但最终你会学到（或者你会知道其他人会做调试）。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2010-09-24T03:43:51.987

我最近也在思考这个问题，并[为 C 编写了一些宏，它们](http://higherlogics.blogspot.com/2010/09/high-level-constructs-for-low-level-c.html)使用纯本地返回值来模拟 try-catch-finally 语义。希望你觉得它有用。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2013-01-27T20:03:01.183

这是一种我认为很有趣的方法，但需要一些纪律。

这假设句柄类型变量是操作所有 API 函数的实例。

这个想法是句柄后面的结构将先前的错误存储为带有必要数据（代码，消息...）的结构，并且为用户提供了一个返回指向此错误对象的指针的函数。每个操作都会更新指向的对象，因此用户甚至可以在不调用函数的情况下检查其状态。与 errno 模式相反，错误代码不是全局的，这使得方法线程安全，只要正确使用每个句柄。

例子：

```
MyHandle * h = MyApiCreateHandle();

/* first call checks for pointer nullity, since we cannot retrieve error code
   on a NULL pointer */
if (h == NULL)
     return 0; 

/* from here h is a valid handle */

/* get a pointer to the error struct that will be updated with each call */
MyApiError * err = MyApiGetError(h);

MyApiFileDescriptor * fd = MyApiOpenFile("/path/to/file.ext");

/* we want to know what can go wrong */
if (err->code != MyApi_ERROR_OK) {
    fprintf(stderr, "(%d) %s\n", err->code, err->message);
    MyApiDestroy(h);
    return 0;
}

MyApiRecord record;

/* here the API could refuse to execute the operation if the previous one
   yielded an error, and eventually close the file descriptor itself if
   the error is not recoverable */
MyApiReadFileRecord(h, &record, sizeof(record));

/* we want to know what can go wrong, here using a macro checking for failure */
if (MyApi_FAILED(err)) {
    fprintf(stderr, "(%d) %s\n", err->code, err->message);
    MyApiDestroy(h);
    return 0;
} 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-12-22T11:07:33.890

我绝对更喜欢第一个解决方案：

```
int size;
if(getObjectSize(h, &size) != MYAPI_SUCCESS) {
  // Error handling
} 
```

我会稍微修改它，以：

```
int size;
MYAPIError rc;

rc = getObjectSize(h, &size)
if ( rc != MYAPI_SUCCESS) {
  // Error handling
} 
```

此外，即使当前函数范围允许您这样做，我也永远不会将合法的返回值与错误混合，您永远不知道函数实现将来会采用哪种方式。

如果我们已经讨论过错误处理，我建议将`goto Error;`其作为错误处理代码，除非`undo`可以调用某些函数来正确处理错误处理。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2008-12-22T11:09:50.670

第一种方法更好恕我直言：

*   以这种方式编写函数更容易。当您在函数中间发现错误时，您只需返回一个错误值。在第二种方法中，您需要将错误值分配给其中一个参数，然后返回一些东西....但是您会返回什么 - 您没有正确的值并且您没有返回错误值。
*   它更受欢迎，因此更容易理解和维护

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2018-05-20T01:33:11.610

我多次遇到此问答，并希望提供更全面的答案。我认为考虑这个问题的最好方法是*如何*将错误返回给调用者，以及*你*返回的内容。

## 如何

有 3 种方法可以从函数返回信息：

1.  返回值
2.  输出参数
3.  Out of Band，包括非本地 goto (setjmp/longjmp)、文件或全局范围变量、文件系统等。

### 返回值

您只能返回值是单个对象，但是，它可以是任意复杂的。下面是一个错误返回函数的例子：

```
 enum error hold_my_beer(); 
```

返回值的一个好处是它允许链接调用以减少侵入性的错误处理：

```
 !hold_my_beer() &&
  !hold_my_cigarette() &&
  !hold_my_pants() ||
  abort(); 
```

这不仅与可读性有关，而且还可以允许以统一的方式处理此类函数指针的数组。

### 输出参数

您可以通过参数返回多个对象，但最佳实践确实建议将参数总数保持在较低水平（例如，<=4）：

```
void look_ma(enum error *e, char *what_broke);

enum error e;
look_ma(e);
if(e == FURNITURE) {
  reorder(what_broke);
} else if(e == SELF) {
  tell_doctor(what_broke);
} 
```

### 带外

使用 setjmp() 可以定义一个位置以及如何处理一个 int 值，然后通过 longjmp() 将控制权转移到该位置。请参阅[C 中 setjmp 和 longjmp 的实际用法](https://stackoverflow.com/questions/14685406/practical-usage-of-setjmp-and-longjmp-in-c#14685524)。

## 什么

1.  指标
2.  代码
3.  目的
4.  打回来

### 指标

错误指示器仅告诉您存在问题，但没有说明所述问题的性质：

```
struct foo *f = foo_init();
if(!f) {
  /// handle the absence of foo
} 
```

这是函数传达错误状态的最不强大的方式，但是，如果调用者无论如何都无法以分级方式响应错误，则它是完美的。

### 代码

错误代码告诉调用者问题的性质，并可能允许适当的响应（来自上述）。它可以是返回值，也可以是错误参数上面的 look_ma() 示例。

### 目的

使用错误对象，调用者可以被告知任意复杂的问题。例如，错误代码和合适的人类可读消息。它还可以通知调用者在处理集合时出现了多个错误，或者每个项目都有错误：

```
struct collection friends;
enum error *e = malloc(c.size * sizeof(enum error));
...
ask_for_favor(friends, reason);
for(int i = 0; i < c.size; i++) {
   if(reason[i] == NOT_FOUND) find(friends[i]);
} 
```

当然，您也可以根据需要动态（重新）分配它，而不是预先分配错误数组。

### 打回来

回调是处理错误最有效的方法，因为您可以告诉函数当出现问题时您希望看到什么行为。可以将回调参数添加到每个函数，或者如果自定义 ui 仅需要每个结构实例，如下所示：

```
 struct foo {
    ...
    void (error_handler)(char *);
 };

 void default_error_handler(char *message) { 
    assert(f);
    printf("%s", message);
 }

 void foo_set_error_handler(struct foo *f, void (*eh)(char *)) {
    assert(f);
    f->error_handler = eh;
 }

 struct foo *foo_init() {
    struct foo *f = malloc(sizeof(struct foo));
    foo_set_error_handler(f, default_error_handler);
    return f;
 }

 struct foo *f = foo_init();
 foo_something(); 
```

回调的一个有趣的好处是它可以被调用多次，或者在没有错误的情况下根本不调用它，在这种情况下，快乐路径上没有开销。

然而，控制倒置。调用代码不知道回调是否被调用。因此，也可以使用指标。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2017-07-08T21:10:44.967

您可以做的不是返回错误，从而禁止您使用函数返回数据，而是使用*包装器*作为返回类型：

```
typedef struct {
    enum {SUCCESS, ERROR} status;
    union {
        int errCode;
        MyType value;
    } ret;
} MyTypeWrapper; 
```

然后，在被调用函数中：

```
MyTypeWrapper MYAPIFunction(MYAPIHandle h) {
    MyTypeWrapper wrapper;
    // [...]
    // If there is an error somewhere:
    wrapper.status = ERROR;
    wrapper.ret.errCode = MY_ERROR_CODE;

    // Everything went well:
    wrapper.status = SUCCESS;
    wrapper.ret.value = myProcessedData;
    return wrapper;
} 
```

请注意，使用以下方法，包装器将具有 MyType 的大小加上一个字节（在大多数编译器上），这是非常有利可图的；当您调用您的函数（或在您提供的两种方法中）时*，您不必在堆栈上推送另一个参数。*`returnedSize``returnedError`

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-12-22T11:59:56.933

除了已经说过的，在返回错误代码之前，在返回错误时触发断言或类似的诊断，因为这将使跟踪变得更加容易。我这样做的方法是有一个自定义的断言，它仍然在发布时被编译，但只有在软件处于诊断模式时才会被触发，并且可以选择以静默方式向日志文件报告或在屏幕上暂停。

我个人将错误代码返回为负整数，**no_error**为零，但它确实给您留下了可能的以下错误

```
if (MyFunc())
 DoSomething(); 
```

另一种方法是始终将失败返回为零，并使用 LastError() 函数提供实际错误的详细信息。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-12-22T12:26:19.800

编辑：如果您只需要访问最后一个错误，并且您不在多线程环境中工作。

你可以只返回真/假（或者某种#define，如果你在C中工作并且不支持布尔变量），并且有一个全局错误缓冲区来保存最后一个错误：

```
int getObjectSize(MYAPIHandle h, int* returnedSize);
MYAPI_ERROR LastError;
MYAPI_ERROR* getLastError() {return LastError;};
#define FUNC_SUCCESS 1
#define FUNC_FAIL 0

if(getObjectSize(h, &size) != FUNC_SUCCESS ) {
    MYAPI_ERROR* error = getLastError();
    // error handling
} 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-12-22T15:40:15.477

第二种方法让编译器生成更优化的代码，因为当将变量的地址传递给函数时，编译器在随后调用其他函数期间无法将其值保留在寄存器中。完成代码通常只使用一次，就在调用之后，而从调用返回的“真实”数据可能会更频繁地使用

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2011-11-19T13:50:19.340

我更喜欢使用以下技术在 C 中进行错误处理：

> ```
> struct lnode *insert(char *data, int len, struct lnode *list) {
>     struct lnode *p, *q;
>     uint8_t good;
>     struct {
>             uint8_t alloc_node : 1;
>             uint8_t alloc_str : 1;
>     } cleanup = { 0, 0 };
> 
>    // allocate node.
>     p = (struct lnode *)malloc(sizeof(struct lnode));
>     good = cleanup.alloc_node = (p != NULL);
> 
>    // good? then allocate str
>     if (good) {
>             p->str = (char *)malloc(sizeof(char)*len);
>             good = cleanup.alloc_str = (p->str != NULL);
>     }
> 
>    // good? copy data
>     if(good) {
>             memcpy ( p->str, data, len );
>     }
> 
>    // still good? insert in list
>     if(good) {
>             if(NULL == list) {
>                     p->next = NULL;
>                     list = p;
>             } else {
>                     q = list;
>                     while(q->next != NULL && good) {
>                             // duplicate found--not good
>                             good = (strcmp(q->str,p->str) != 0);
>                             q = q->next;
>                     }
>                     if (good) {
>                             p->next = q->next;
>                             q->next = p;
>                     }
>             }
>     }
> 
>    // not-good? cleanup.
>     if(!good) {
>             if(cleanup.alloc_str)   free(p->str);
>             if(cleanup.alloc_node)  free(p);
>     }
> 
>    // good? return list or else return NULL
>     return (good ? list : NULL);
> } 
> ```

来源： http: [//blog.staila.com/ ?p=114](http://blog.staila.com/?p=114)

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2018-03-01T20:00:04.923

除了其他很好的答案，我建议您尝试将错误标志和错误代码分开，以便在每次调用时保存一行，即：

```
if( !doit(a, b, c, &errcode) )
{   (* handle *)
    (* thine  *)
    (* error  *)
} 
```

当你有很多错误检查时，这个小小的简化真的很有帮助。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2022-01-10T21:01:00.283

我已经看到 C 中的函数在错误报告中使用了五种主要方法：

*   返回值不报错码或无返回值
*   仅作为错误代码的返回值
*   返回值是有效值或错误代码值
*   返回值指示错误，以某种方式获取错误代码，可能带有错误上下文信息
*   返回带有错误代码的值的函数参数，可能带有错误上下文信息

除了函数错误返回机制的选择外，还要考虑错误码助记符，并确保错误码助记符不会与其他正在使用的错误码助记符发生冲突。通常，这需要使用三字母前缀方法来命名助记符，用`#define`、`enum`或来定义它们`const static int`。请参阅此讨论[“静态常量”与“#define”与“枚举”](https://stackoverflow.com/questions/1674032/static-const-vs-define-vs-enum)

一旦检测到错误，就会有几种不同的结果，这可能是函数如何提供错误代码和错误信息的考虑因素。这些结果实际上分为两个阵营，可恢复的错误和不可恢复的错误：

*   记录系统状态然后中止
*   等待并重试失败的操作
*   通知一个人并请求帮助
*   在降级状态下继续执行

根据错误的上下文，错误类型可能会使用多个这些结果。例如，由于文件不存在而导致文件打开失败，可以使用不同的文件名重试或通知用户并请求帮助或在降级状态下继续执行。

**五种主要方法的详细信息**

某些函数不提供错误代码。这些功能要么不能失败，要么如果它们失败，它们就会默默地失败。此类函数的一个示例是各种`is`字符测试函数，例如`isdigit()`指示字符值是否为数字。字符值可以是或不是数字或字母字符。与该函数类似`strcmp()`，比较两个字符串会产生一个值，该值指示在整理序列中哪一个高于另一个，如果它们不同的话。

在某些情况下，不需要错误代码，因为指示失败的值是有效结果。例如，`strchr()`如果在要扫描的字符串中找到或未找到，则标准库中的函数返回指向搜索字符的指针`NULL`。在这种情况下，找不到字符是一个有效且有用的指示符。使用的函数`strchr()`可能要求搜索的字符不在字符串中才能成功，并且找到该字符是错误条件。

其他函数不返回错误代码，而是通过外部机制报告错误。这被标准库中的大多数数学库函数使用，这些函数要求用户将`errno`值设置为零，调用函数，然后检查 的值`errno`是否仍然为零。许多数学函数的输出值范围不允许使用特殊的返回值来指示错误，并且它们的接口中没有错误报告参数。

一些函数执行一个操作并返回一个错误代码值，其中一个可能的错误代码值指示成功，其余的值范围指示错误代码。例如，如果成功，函数可能返回值 0，或者指示错误的正或负非零值，返回的值是错误代码。

一些函数可以执行一个动作，如果成功则返回一个有效值范围内的值，或者返回一个指示错误代码的无效值范围内的值。一种简单的方法是对有效值使用正值 (0, 1, 2, ...)，对允许检查的错误代码使用负值，例如`if(status < 0) return error;`.

一些函数返回一个有效值或一个无效值，指示一个需要通过某种方式获取错误代码的额外步骤的错误。例如，该`fopen()`函数要么返回一个指向`FILE`对象的指针，要么返回一个无效的指针值，`NULL`并设置`errno`为指示失败原因的错误代码。许多返回值以引用资源的 Windows API 函数也`HANDLE`可能返回值，`INVALID_HANDLE_VALUE`并且该函数`GetLastError()`用于获取错误代码。OPOS 控制对象标准要求 OPOS 控制对象提供两个功能，`GetResultCode()`以及`GetResultCodeExtended()`允许在 COM 对象方法调用失败的情况下检索错误状态信息。

在其他 API 中使用相同的方法，这些 API 使用句柄或对资源的引用，其中存在一系列有效值，其中一个或多个值超出该范围，用于指示错误。然后提供一种机制来获取额外的错误信息，例如错误代码。

类似的方法用于返回布尔值`true`以指示函数成功或`false`指示错误的函数。然后，程序员必须检查其他数据以确定错误代码，例如`GetLastError()`使用 Windows API。

一些函数有一个指针参数，其中包含调用函数的内存区域地址，以提供错误代码或错误信息。这种方法真正闪耀的地方是，除了简单的错误代码之外，还有额外的错误上下文信息有助于查明错误。例如，JSON 字符串解析函数不仅可能返回错误代码，而且还可能返回指向 JSON 字符串中解析失败的位置的指针。

我还看到了函数返回错误指示符的函数，例如带有用于错误信息的参数的布尔值。我记得错误信息参数在某些情况下可能`NULL`表明调用者不想知道失败的细节。

这种返回错误代码或错误信息的方法在我的经验中似乎并不常见，尽管出于某种原因，我认为我不时看到它在 Windows API 中使用，或者可能与 XML 解析器一起使用。

**多线程的注意事项**

`errno`当使用通过诸如检查全局或使用诸如函数之类的机制的附加错误代码访问的方法时，`GetLastError()`存在跨多个线程共享全局的问题。

现代编译器和库通过使用线程本地存储来处理这个问题，以确保每个线程都有自己的存储，不被其他线程共享。但是，仍然存在多个函数共享同一线程本地存储位置以存储状态信息的问题，这可能需要一些调整。例如，使用多个文件的函数可能需要解决所有可能失败的调用在同一线程中`fopen()`共享一个的问题。`errno`

如果 API 使用某种类型的句柄或引用，则可以将错误代码存储为特定于句柄的。该`fopen()`函数可以包装在另一个执行 的函数中`fopen()`，然后设置一个 API 控制块，其中包含 的`FILE *`返回`fopen()`值和 的值`errno`。

**我喜欢的方法**

我的偏好是将错误代码作为函数返回值返回，以便我可以在调用时检查它或将其保存以备后用。在大多数情况下，错误是需要立即处理的，这就是我更喜欢这种方法的原因。

我对函数使用的一种方法是让函数返回一个简单的`struct`，它包含两个成员，一个状态码和返回值。例如：

```
struct FuncRet {
   short  sStatus;  // status or error code
   double dValue;   // calculated value
};

struct FuncRet Func(double dInput)
{
    struct FuncRet = {0, 0};  // sStatus == 0 indicates success

    // calculate return value FuncRet.dValue and set
    // status code FuncRet.sStatus in the event of an error.

    return FuncRet;
}

//  ... source code before using our function.

{
    struct FuncRet s;

    if ((s = Func(aDble)).sStatus == 0) {
        // do things with the valid value s.dValue
    } else {
        // error so deal with the error reported in s.sStatus
    }
} 
```

这使我可以立即检查错误。由于返回的数据很复杂，许多函数最终也返回了一个状态而没有返回实际值。该函数可以修改一个或多个参数，但该函数不返回状态码以外的值。

# .net - 受限用户应用程序崩溃

> ID：385976
> 
> 赞同：2
> 
> 时间：2008-12-22T10:46:12.590
> 
> 标签：.net, windows

我有一个 WPF 应用程序，可以在 XP 下以管理员身份正常运行。

当我作为受限用户运行时，应用程序根本没有运行，我得到了半秒钟的沙漏，然后什么也没有。

在受限用户帐户下运行时，我应该从哪里着手确定应用程序的哪一部分导致它崩溃？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-22T10:52:02.530

我通常启动[ProcMon](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)并观察打开/读取/写入哪些注册表/文件。ProcMon 还显示操作是成功还是失败。这有助于我查明前 80% 的问题。

通常的问题是尝试写入 \Windows、\Program Files 和 HKLM 注册表配置单元。

这里的一个很好的资源[是非管理员博客](http://blogs.msdn.com/aaron_margosis/default.aspx)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-22T10:54:49.220

尝试记录您应用程序的第一步。在静态 main 中创建一个 try/Catch 块，它捕获每个异常并将其打印到日志文件中。

您也应该查看事件日志。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-22T11:04:32.710

检查受限帐户是否对您的应用程序正在使用的 dll 或程序集具有足够的权限。要解决此问题，您需要授予该帐户对所有必需程序集的执行权限。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T10:52:35.197

1.  将日志代码添加到您的应用程序。看看它在哪里崩溃/挂起
2.  启动“eventvwr”，看看系统日志中有没有什么奇怪的东西
3.  尝试以普通用户的身份进行开发/调试

# expect - 期望脚本的问题

> ID：385980
> 
> 赞同：1
> 
> 时间：2008-12-22T10:50:06.733
> 
> 标签：expect, passwd, getch

我正在尝试创建一个脚本以非交互式方式更新密码。它在我的笔记本电脑上工作，但在我的服务器上失败。两者都使用 Etch 运行相同的配置。

这是脚本：

```
#!/usr/bin/expect -f
# Change user passwd
set timeout 30
strace 4
set password [lindex $argv 1]
set old_password [lindex $argv 2]

spawn passwd [lindex $argv 0]
sleep 1
expect "(current) UNIX password: $"
send "$old_password\r"
expect "Enter new UNIX password: $"
send "$password\r"
expect "Retype new UNIX password: $"
send "$password\r"
expect eof 
```

在服务器上，输出如下所示：

```
myuser@server:~$  /home/myuser/adm/chpasswd myuser NewPasswd OldPasswd
 2    lindex $argv 0
 1  set username [lindex $argv 0]
 2    lindex $argv 1
 1  set password [lindex $argv 1]
 2    lindex $argv 2
 1  set old_password [lindex $argv 2]
 1  spawn passwd $username
spawn passwd myuser
 1  sleep 1
 1  expect "(current) UNIX password: $"
Changing password for myuser
(current) UNIX password:  1  send "$old_password\r"
 1  expect "Enter new UNIX password: $"
OldPasswd
Enter new UNIX password:  1  send "$password\r"
 1  expect "Retype new UNIX password: $"
NewPasswd
 1  send "$password\r"
 1  expect eof
Retype new UNIX password:  1  exit 0 
```

所以不起作用，因为这对夫妇期望发送似乎不同步。

但奇怪的是，在我的笔记本电脑上它可以工作：

```
test@mars:/home/test/adm$ ./chpasswd test NewPasswd OldPasswd
 2    lindex $argv 1
 1  set password [lindex $argv 1]
 2    lindex $argv 2
 1  set old_password [lindex $argv 2]
 2    lindex $argv 0
 1  spawn passwd [lindex $argv 0]
spawn passwd test
 1  sleep 1
 1  expect "(current) UNIX password: $"
Changing password for test
(current) UNIX password:  1  send "$old_password\r"
 1  expect "Enter new UNIX password: $"
OldPasswd
Enter new UNIX password:  1  send "$password\r"
 1  expect "Retype new UNIX password: $"
NewPasswd
Retype new UNIX password:  1  send "$password\r"
 1  expect eof
NewPasswd
passwd: password updated successfully
 1  exit 0 
```

任何想法为什么它在服务器上出错？谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-22T11:08:16.913

也许服务器上的密码策略不同？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-30T13:22:22.090

这是一个老问题，但无论如何......

尝试将“exp_internal 1”添加到您的脚本中。这将为您提供有关您的期望不匹配的原因的更多详细信息。

为您的期望命令使用“-re”选项。您正在使用 '$' 来锚定模式，但 expect 的默认匹配是 -glob ，其中 '$' 并不特殊。

# postgresql - 使用 %ROWTYPE 在 postgres 函数中循环数据时出现问题

> ID：385985
> 
> 赞同：1
> 
> 时间：2008-12-22T10:51:35.090
> 
> 标签：postgresql, function, rowtype

我正在尝试在 postgres 中创建一个函数，该函数从一个表中检索数据并输入到另一个表中。我正在使用 %ROWTYPE 类型来存储 select 语句中的临时数据，然后使用 insert 语句对其进行迭代，但没有成功！以下是我的代码：

```
CREATE OR REPLACE FUNCTION rm_stock_take_add (icompany character varying, idate character varying) 
  RETURNS character varying AS

$BODY$

DECLARE

    loc_result    CHAR(50);

    -- Declaring a counter to increment for the index
    counter INTEGER;

    -- Declare a variable to hold rows from the stock table.
    row_data rm_stock%ROWTYPE;

BEGIN

     -- Iterate through the results of a query.
    FOR row_data IN 
    SELECT *
    FROM rm_stock 
    --WHERE company = icompany 
    ORDER BY company, rm_sto_code, rm_col_code  

        LOOP

      counter := counter + 1;
/*       
          INSERT INTO rm_stock_take
          ( 
           "stock_ind", "company", "rm_stock_code", "rm_col_code", "rm_dye_lot_num", "rm_take_date", "rm_quantity_theo"
          )
          VALUES 
          ( 
           counter, icompany, row_data.rm_sto_code, row_data.rm_col_code, row_data.rm_dye_lot_num, idate,
               row_data.rm_sto_on_hand_excl
          );

*/      
       END LOOP;

   RETURN counter :: character varying;

END;
$BODY$
 LANGUAGE 'plpgsql'VOLATILE;
ALTER FUNCTION rm_stock_take_add(icompany character varying, idate character varying) OWNER TO postgres; 
```

好的，所以目前我只是试图通过使用计数器来计算循环数量并返回该数字来查看函数是否正在循环，但它还没有返回任何内容。我无法在网上或任何地方找到有关此类程序的大量信息，如果有人可以帮助或指导我走向正确的方向，将不胜感激！

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-22T12:32:33.047

搞定了...

如果其他人遇到同样的问题，这里是供将来参考的代码！

```
CREATE OR REPLACE FUNCTION rm_stock_take_add(icompany character varying, idate character varying)
  RETURNS character varying AS
$BODY$

DECLARE
    loc_result CHAR(50);
    counter INTEGER = 1;
    row_data RECORD;

BEGIN
    FOR row_data IN SELECT rm_sto_code, rm_col_code, rm_dye_lot_num, rm_sto_on_hand_excl
    FROM rm_stock 
    WHERE company = icompany 
    ORDER BY company, rm_sto_code, rm_col_code  

    LOOP         
          INSERT INTO rm_stock_take
          ( 
               "stock_ind", "company", "rm_stock_code", "rm_col_code", "rm_dye_lot_num", "rm_take_date", "rm_quantity_theo"
          )
          VALUES 
          ( 
               counter, icompany, row_data.rm_sto_code, row_data.rm_col_code, row_data.rm_dye_lot_num, idate,
               row_data.rm_sto_on_hand_excl
          );   
          counter := counter + 1;

    END LOOP;

    loc_result := 'success';  
    RETURN loc_result ;
END;
$BODY$
  LANGUAGE 'plpgsql' VOLATILE;
ALTER FUNCTION rm_stock_take_add(icompany character varying, idate character varying) OWNER TO postgres; 
```

# asp.net-mvc - 在 asp.net-mvc 中缓存

> ID：385986
> 
> 赞同：82
> 
> 时间：2008-12-22T10:51:48.070
> 
> 标签：asp.net-mvc, caching

我想在我的 asp.net-mvc 站点中缓存我最繁重的数据库操作。在我的研究中我发现

*   Phil 博客上的[甜甜圈缓存](http://haacked.com/archive/2008/11/05/donut-caching-in-asp.net-mvc.aspx)
*   Kazi 博客上的[缓存/压缩过滤器](http://weblogs.asp.net/rashid/archive/2008/03/28/asp-net-mvc-action-filter-caching-and-compression.aspx)
*   Scott Hansleman 关于他们如何在 SO 中缓存内容的播客。

但我觉得我还没有得到它。
我希望能够根据几个 par 缓存我的 POST 请求。这些pars在一个对象中。所以我想缓存以下请求的结果：

```
public ActionResult AdvancedSearch(SearchBag searchBag) 
```

其中 searchBag 是一个包含（一堆）可选搜索参数的对象。我的观点本身很轻（应该如此），但数据访问可能相当耗时，具体取决于搜索包中填写了哪些字段。

我觉得我应该缓存在我的数据层上，而不是缓存在我的操作上。
我应该如何在 OutputCache 属性中使用 VaryByParam？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-12-23T04:25:40.220

我也喜欢缓存在模型或数据层中。这隔离了与从控制器/表示中检索数据有关的一切。您可以从企业库访问 ASP.NET 缓存`System.Web.HttpContext.Current.Cache`或使用缓存应用程序块。根据查询的参数为缓存数据创建密钥。确保在更新数据时使缓存无效。

* * *

## 回答 #2

> 赞同：66
> 
> 时间：2009-02-07T02:24:06.383

或者您可以独立于 HttpContext.Current 并从 HttpRuntime.Cache 访问 Cache :)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-07T05:51:03.470

通常，OutputCaching 可能是最快速和最有效的，但前提是它满足您的要求。如果它是错误的，那么快速高效是没有意义的！;)

在这种情况下，听起来数据层的缓存是正确的，因为您有复杂的缓存需求。有时，如果控制缓存输出的参数集很简单，您可以将两者结合起来。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-11-21T10:11:13.110

您可以使用类似这样的输出缓存

```
[OutputCache(Duration = 10, VaryByParam = "empID")]
      public ActionResult GetEmployeeDetail(int empID)
      {
          Employee e = new Employee();
          return Content(e.getEmployeeDetails(empID));
      } 
```

或者您可以使用缓存配置文件在网络配置中设置它

```
<caching>
<outputCacheSettings>
    <outputCacheProfiles>
        <add name="Admin" 

        duration="86420" varyByParam="none"/>
    </outputCacheProfiles>
</outputCacheSettings>
</caching>

and use this tag
[OutputCache(CacheProfile="Admin")] 
```********