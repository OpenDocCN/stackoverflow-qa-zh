# StackOverflow 问答 000307000-000307999

# flash - 舞台上的矢量形状出现在动态文本字段上

> ID：307000
> 
> 赞同：0
> 
> 时间：2008-11-20T21:56:35.310
> 
> 标签：flash, actionscript-3, actionscript, flash-cs3

这个主题几乎解释了这一切。我从一个包含整个舞台的位图的 MovieClip 的第一帧开始。

然后，当用户单击一个按钮时，它会转到第二帧，并且舞台上会出现一个矢量形状，覆盖图像的一部分。同时，通过代码，我在舞台上放置了一个输入Textfield。

问题是，动态创建的文本字段出现在矢量形状（在舞台上绘制）下！这似乎是 ActionScript 3 的新问题，因为我在 Flash CS3 和 ActionScript 2 中没有这个问题。

我尝试将文本字段放在不同的图层上，但无济于事。如何让文本字段出现在矢量形状上？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-21T10:03:42.707

将矢量形状放入影片剪辑中。然后调用：

```
setChildIndex(myTextField, numChildren - 1); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T19:00:13.607

我已经试过了。像这样古怪的东西让我无法将我的框架迁移到 AS 3。

我已经确定问题出在 Flash 渲染舞台上的内容的方式上。当调用`some_mc.play();`将新对象引入舞台时——同时以编程方式将其他对象放置在舞台上——手动放置在舞台上的对象将始终直接呈现在任何以编程方式创建的对象之上。这可能不是每个人的经历，但这就是我所看到的。

我的解决方案：调用`some_mc.play();`，等待 10 毫秒，然后将其他对象放在舞台上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-28T22:46:21.607

您可以尝试通过代码添加矢量形状，然后添加文本字段。

```
var vectorShape:Sprite = new Sprite();  
addChild(vectorShape);

var textField:TextField = new textField();  
addChild(textField); 
```

这会将矢量形状放在文本字段下方。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T02:53:34.097

It sounds like your trouble arises because the design-time vector and the runtime text field come into existence in the same frame, so it's a timing issue where they appear and when you can move them.

The easiest thing might be to avoid this problem. One way would be to create an empty movie clip (on the stage, at design time) to be a holder for the text field, layer it wherever you want, and create the text inside of it at runtime. Another solution would be to create either the vector or the text field (or both) in frame 1, but keep it/them invisible until necessary.

# c# - 在 WPF 中更改光标有时有效，有时无效

> ID：307004
> 
> 赞同：127
> 
> 时间：2008-11-20T21:57:17.867
> 
> 标签：c#, wpf

在我的几个用户控件上，我使用

```
this.Cursor = Cursors.Wait; 
```

当我点击某物时。

现在我想在 WPF 页面上单击按钮做同样的事情。当我将鼠标悬停在我的按钮上时，光标会变成一只手，但是当我单击它时，它不会变成等待光标。我想知道这是否与它是一个按钮有关，或者因为这是一个页面而不是用户控件？这似乎是一种奇怪的行为。

* * *

## 回答 #1

> 赞同：218
> 
> 时间：2008-11-20T22:03:55.593

仅当光标位于特定页面/用户控件上方时，您是否需要光标成为“等待”光标？如果没有，我建议使用[Mouse.OverrideCursor](http://msdn.microsoft.com/en-us/library/system.windows.input.mouse.overridecursor.aspx)：

```
Mouse.OverrideCursor = Cursors.Wait;
try
{
    // do stuff
}
finally
{
    Mouse.OverrideCursor = null;
} 
```

这会覆盖您的应用程序的光标，而不仅仅是其 UI 的一部分，因此您所描述的问题就会消失。

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2009-03-24T00:04:14.100

我们在应用程序中执行此操作的一种方法是使用 IDisposable，然后使用`using(){}`块来确保光标在完成后被重置。

```
public class OverrideCursor : IDisposable
{

  public OverrideCursor(Cursor changeToCursor)
  {
    Mouse.OverrideCursor = changeToCursor;
  }

  #region IDisposable Members

  public void Dispose()
  {
    Mouse.OverrideCursor = null;
  }

  #endregion
} 
```

然后在您的代码中：

```
using (OverrideCursor cursor = new OverrideCursor(Cursors.Wait))
{
  // Do work...
} 
```

覆盖将在以下任一情况下结束：到达 using 语句的末尾或；如果抛出异常并且控制在语句结束之前离开语句块。

**更新**

要防止光标闪烁，您可以执行以下操作：

```
public class OverrideCursor : IDisposable
{
  static Stack<Cursor> s_Stack = new Stack<Cursor>();

  public OverrideCursor(Cursor changeToCursor)
  {
    s_Stack.Push(changeToCursor);

    if (Mouse.OverrideCursor != changeToCursor)
      Mouse.OverrideCursor = changeToCursor;
  }

  public void Dispose()
  {
    s_Stack.Pop();

    Cursor cursor = s_Stack.Count > 0 ? s_Stack.Peek() : null;

    if (cursor != Mouse.OverrideCursor)
      Mouse.OverrideCursor = cursor;
  }

} 
```

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2010-05-18T14:17:04.013

您可以在按钮上使用数据触发器（带有视图模型）来启用等待光标。

```
<Button x:Name="NextButton"
        Content="Go"
        Command="{Binding GoCommand }">
    <Button.Style>
         <Style TargetType="{x:Type Button}">
             <Setter Property="Cursor" Value="Arrow"/>
             <Style.Triggers>
                 <DataTrigger Binding="{Binding Path=IsWorking}" Value="True">
                     <Setter Property="Cursor" Value="Wait"/>
                 </DataTrigger>
             </Style.Triggers>
         </Style>
    </Button.Style>
</Button> 
```

这是视图模型中的代码：

```
public class MainViewModel : ViewModelBase
{
   // most code removed for this example

   public MainViewModel()
   {
      GoCommand = new DelegateCommand<object>(OnGoCommand, CanGoCommand);
   }

   // flag used by data binding trigger
   private bool _isWorking = false;
   public bool IsWorking
   {
      get { return _isWorking; }
      set
      {
         _isWorking = value;
         OnPropertyChanged("IsWorking");
      }
   }

   // button click event gets processed here
   public ICommand GoCommand { get; private set; }
   private void OnGoCommand(object obj)
   {
      if ( _selectedCustomer != null )
      {
         // wait cursor ON
         IsWorking = true;
         _ds = OrdersManager.LoadToDataSet(_selectedCustomer.ID);
         OnPropertyChanged("GridData");

         // wait cursor off
         IsWorking = false;
      }
   }
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2013-07-08T14:11:45.930

如果您的应用程序使用异步内容并且您正在摆弄鼠标的光标，您可能只想在主 UI 线程中执行此操作。您可以为此使用应用程序的 Dispatcher 线程：

```
Application.Current.Dispatcher.Invoke(() =>
{
    // The check is required to prevent cursor flickering
    if (Mouse.OverrideCursor != cursor)
        Mouse.OverrideCursor = cursor;
}); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-03-19T01:22:59.103

以下对我有用：

```
ForceCursor = true;
Cursor = Cursors.Wait; 
```

# linux - 捕获到 /dev/tty 的直接重定向

> ID：307006
> 
> 赞同：6
> 
> 时间：2008-11-20T21:58:08.537
> 
> 标签：linux, terminal, tty

我正在为将文本直接发送到 /dev/tty 的程序开发应用程序控制器。

这是一个生产应用程序控制器，它必须能够捕获到终端的所有文本。一般来说，这不是问题。我们只是重定向标准输出和标准错误。这个特殊的应用程序直接调用 echo 并将结果重定向到 /dev/tty ( `echo "some text" > /dev/tty`)。通过我的应用程序控制器重定向无法捕获文本。

我确实有此应用程序的源代码，但无法修改它，也不再维护它。关于如何捕获和/或丢弃输出的任何想法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-20T23:51:23.533

```
 screen -D -m yourEvilProgram 
```

应该管用。自从我使用它以来已经过了很多时间，但是如果您需要读取它的一些输出，甚至可以使用一些套接字来读取它。

[*添加*：两个链接，[Rackaid](http://www.rackaid.com/resources/linux-tutorials/general-tutorials/using-screen/)和[Pixelbeat ，以及](http://www.pixelbeat.org/lkdb/screen.html)[GNU](http://www.gnu.org/software/screen/)的主页]

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-09-11T09:39:52.210

控制此类应用程序的经典解决方案是[Expect](http://wiki.tcl.tk/201)，它设置伪终端、记录日志并从脚本驱动受控应用程序。它附带了许多示例脚本，因此您可能只需要调整一个来满足您的需求。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-11-01T21:34:44.623

这就是我在 python 中所做的

```
import pty, os

pid, fd = pty.fork()
if pid == 0: # In the child process execute another command
    os.execv('./my-progr', [''])
    print "Execv never returns :-)"
else:
    while True:
        try:
            print os.read(fd,65536),
        except OSError:
            break 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-21T01:13:00.610

我不能完全确定`screen`@flolo 提到的程序是否会满足您的需求。可能，但我不确定是否有内置的日志记录工具，这似乎是您需要的。

可能已经有一个程序可以满足您的需要。我会提名[`sudosh`](http://sourceforge.net/projects/sudosh/)为一种可能性。

如果您最终需要编写自己的，您可能需要使用伪 tty (pty) 并让您的应用程序控制器位于用户的真实终端连接和 pty 设备之间，在那里它可以记录您需要的任何内容它记录。这不是微不足道的。[您可以在 Rochkind 的“ Advanced UNIX Programming, 2nd Edn](https://rads.stackoverflow.com/amzn/click/com/0131411543) ”一书中找到有关这方面的信息，毫无疑问还有其他类似的书籍（Stevens 的“Advanced Programming in the UNIX Environment”一书可能是候选者，但我没有副本验证）。

# search - 快速过滤器列表

> ID：307011
> 
> 赞同：1
> 
> 时间：2008-11-20T22:00:18.407
> 
> 标签：search, list, filter

每个人都熟悉这个功能。如果您打开 Outlook 通讯簿并开始输入姓名，搜索框下方的列表会立即过滤为仅包含与您的查询匹配的项目。当您浏览类型时，.NET Reflector 具有类似的功能......您开始输入，并且无论您正在浏览的底层程序集有多大，它几乎都是瞬时的。

我一直想知道这里的秘方是什么。怎么这么快？我想如果数据存在于内存中，或者需要从某个外部源（即数据库、搜索某个文件等）获取它们，也会有不同的算法。

我不确定这是否相关，但如果有资源，我特别感兴趣的是如何使用 WinForms 做到这一点......但如果你知道一般资源，我也对这些感兴趣:-)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T22:14:18.783

[trie数据结构最常见的用途是什么？](https://stackoverflow.com/questions/296618/what-is-the-most-common-use-of-the-trie-data-structure)

Trie 基本上是一种用于存储大量相似字符串的树结构，它提供了对字符串的快速查找（如哈希表）并允许您按字母顺序迭代它们。

图片来自：[http](http://en.wikipedia.org/wiki/Trie) ://en.wikipedia.org/wiki/Trie ：
![替代文字](https://upload.wikimedia.org/wikipedia/commons/thumb/b/be/Trie_example.svg/250px-Trie_example.svg.png)

在这种情况下，Trie 存储字符串：
i
in
inn
to
tea
ten

对于您输入的任何前缀（例如，“t”或“te”），您可以轻松查找以该前缀开头的所有单词。更重要的是，查找取决于字符串的长度，而不是 Trie 中存储了多少字符串。阅读我引用的维基百科文章以了解更多信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T22:51:35.463

该过程称为全文索引/搜索。

如果您想为此使用算法和数据结构，我建议您阅读[Programming Collective Intelligence](http://oreilly.com/catalog/9780596529321/)以获得对该领域的良好介绍，如果您只是想要功能，我会推荐[lucene](http://lucene.apache.org/)。

# c# - 如何过滤除某个白名单之外的所有 HTML 标签？

> ID：307013
> 
> 赞同：37
> 
> 时间：2008-11-20T22:00:37.720
> 
> 标签：c#, html, vb.net, regex

这适用于 .NET。IgnoreCase 已设置并且 MultiLine 未设置。

通常我在正则表达式方面表现不错，也许我的咖啡因含量很低......

允许用户输入 HTML 编码的实体（<lt;、<amp; 等），并使用以下 HTML 标签：

```
u, i, b, h3, h4, br, a, img 
```

允许自动关闭 <br/> 和 <img/>，有或没有额外的空间，但不是必需的。

我想要：

1.  去除上面列出的所有开始和结束 HTML 标记。
2.  从剩余的标签中删除属性，*除了*锚点可以有一个 href。

到目前为止，我的搜索模式（替换为空字符串）：

```
<(?!i|b|h3|h4|a|img|/i|/b|/h3|/h4|/a|/img)[^>]+> 
```

这*似乎*剥离了我想要的所有开始和结束标签，但存在三个问题：

1.  必须包含每个允许标签的结束标签版本是丑陋的。
2.  属性存活。这可以在一次更换中发生吗？
3.  以允许的标签名称开头的标签会漏掉*。*例如，“<abbrev>”和“<iframe>”。

以下建议的模式不会去除没有属性的标签。

```
</?(?!i|b|h3|h4|a|img)\b[^>]*> 
```

如下所述，“>”在属性值中是合法的，但可以肯定地说我不会支持它。此外，无需担心 CDATA 块等问题。只是一点HTML。

漏洞的答案是迄今为止最好的答案，谢谢！这是他的模式（希望 PRE 对我更好）：

```
static string SanitizeHtml(string html)
{
    string acceptable = "script|link|title";
    string stringPattern = @"</?(?(?=" + acceptable + @")notag|[a-zA-Z0-9]+)(?:\s[a-zA-Z0-9\-]+=?(?:([""']?).*?\1?)?)*\s*/?>";
    return Regex.Replace(html, stringPattern, "sausage");
} 
```

我认为仍然可以对这个答案进行一些小调整：

1.  我认为这可以修改为捕获简单的 HTML 注释（那些本身不包含标签的注释），方法是在“可接受的”变量中添加“！--”并对表达式的末尾进行小幅更改以允许可选的尾随“\s--”。

2.  我认为如果属性之间有多个空白字符（例如：具有换行符和属性之间的制表符的重格式 HTML），这会中断。

**编辑 2009-07-23：**这是我使用的最终解决方案（在 VB.NET 中）：

```
 Dim AcceptableTags As String = "i|b|u|sup|sub|ol|ul|li|br|h2|h3|h4|h5|span|div|p|a|img|blockquote"
 Dim WhiteListPattern As String = "</?(?(?=" & AcceptableTags & _
      ")notag|[a-zA-Z0-9]+)(?:\s[a-zA-Z0-9\-]+=?(?:([""']?).*?\1?)?)*\s*/?>"
 html = Regex.Replace(html, WhiteListPattern, "", RegExOptions.Compiled) 
```

需要注意的是，A 标签的 HREF 属性仍然会被清除，这并不理想。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-11-24T23:19:06.250

这是我为此任务编写的函数：

```
static string SanitizeHtml(string html)
{
    string acceptable = "script|link|title";
    string stringPattern = @"</?(?(?=" + acceptable + @")notag|[a-zA-Z0-9]+)(?:\s[a-zA-Z0-9\-]+=?(?:(["",']?).*?\1?)?)*\s*/?>";
    return Regex.Replace(html, stringPattern, "sausage");
} 
```

编辑：出于某种原因，我将先前答案的更正作为单独的答案发布，因此我将它们合并在这里。

我会稍微解释一下正则表达式，因为它有点长。

第一部分匹配一个左括号和 0 或 1 个斜杠（如果它是关闭标签）。

接下来，您会看到一个向前看的 if-then 构造。(?(?=SomeTag)then|else) 我正在检查字符串的下一部分是否是可接受的标签之一。您可以看到我将正则表达式字符串与可接受的变量连接起来，该变量是由竖线分隔的可接受的标签名称，以便任何术语都匹配。如果匹配，您可以看到我输入了“notag”这个词，因为没有标签可以匹配它，如果可以接受，我想不理会它。否则，我会转到 else 部分，我匹配任何标签名称 [az,AZ,0-9]+

接下来，我想匹配 0 个或多个属性，我假设它们的格式为 attribute="value"。所以现在我将这个部分分组代表一个属性，但我使用 ?: 来防止这个组被捕获以提高速度： (?:\s[az,AZ,0-9,-]+=?(?:([" ",']?). *?\1?))*

在这里，我从标记和属性名称之间的空格字符开始，然后匹配属性名称：[az,AZ,0-9,-]+

接下来我匹配一个等号，然后是引号。我对引用进行分组，以便将其捕获，稍后我可以进行反向引用 \1 以匹配相同类型的引用。在这两个引号之间，您可以看到我使用句点来匹配任何内容，但是我使用惰性版本 *? 而不是贪婪的版本 * 以便它只匹配将结束该值的下一个引号。

接下来，我们在用括号括起来的组之后放一个 *，以便它匹配多个属性/值组合（或不匹配）。最后，我们将一些空格与 \s 以及 0 或 1 个结束斜杠在 xml 样式的自闭合标签的标签中匹配。

你可以看到我正在用香肠替换标签，因为我很饿，但你也可以用空字符串替换它们来清除它们。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-20T22:20:59.973

这是关于 html 标签过滤的一个很好的工作示例：

[清理 HTML](http://web.archive.org/web/20100901160940/http://refactormycode.com/codes/333-sanitize-html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-20T22:07:56.160

属性是使用正则表达式尝试处理 HTML 的主要问题。考虑潜在属性的绝对数量，它们中的大多数是可选的，它们可以以任何顺序出现的事实，以及“>”是引用属性值中的合法字符的事实。当您开始尝试将所有这些考虑在内时，您需要处理这一切的正则表达式将很快变得难以管理。

相反，我要做的是使用基于事件的 HTML 解析器，或者为您提供可以遍历的 DOM 树的解析器。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-16T20:59:51.050

我刚刚注意到当前的解决方案允许以任何可接受的标签*开头的标签。*因此，如果“b”是可接受的标签，“blink”也是。没什么大不了的，但是如果您对如何过滤 HTML 很严格，则需要考虑一些事情。您当然不希望允许“s”作为可接受的标签，因为它会允许“脚本”。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T10:34:45.110

添加单词边界 \b 不起作用的原因是您没有将它放在前瞻中。因此， \b 将在 < 之后尝试，如果 < 开始 HTML 标记，它将始终匹配。

像这样把它放在前瞻中：

```
<(?!/?(i|b|h3|h4|a|img)\b)[^>]+> 
```

这也显示了如何将 / 放在标签列表之前，而不是每个标签。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-07-15T18:28:19.837

[HtmlRuleSanitizer](https://github.com/Vereyon/HtmlRuleSanitizer/blob/master/Web.HtmlSanitizer/HtmlSanitizer.cs)构建在 HTML Agility Pack 之上，并具有用于清理标签的简单语法。

该方法`HtmlSanitizer.SimpleHtml5Sanitizer()`会生成一个包含我需要的所有东西的消毒剂，但这里有一个更动态的方法：

```
public static string GetLimitedHtml(string value)
{
    var sanitizer = HtmlSanitizer.SimpleHtml5Sanitizer();
    var allowed = new string[] {"br", "h1", "h2", "h3", "h4", "h5", "h6", "small", "strike", "strong", "b"};
    foreach (var tag in allowed)
    {
        sanitizer.Tag(tag);
    }

    return sanitizer.Sanitize(value);
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-24T23:10:00.607

我想我最初打算让这些值是可选的，但没有坚持下去，因为我可以看到我`?`在等号之后添加了一个并将匹配的值部分分组。让我们在该组之后添加一个`?`（用胡萝卜标记）以使其在比赛中也是可选的。我现在不在我的编译器旁，但看看这是否有效：

```
@"</?(?(?=" + acceptable + @")notag|[a-z,A-Z,0-9]+)(?:\s[a-z,A-Z,0-9,\-]+=?(?:(["",']?).*?\1?)?)*\s*/?>";
                                                                                             ^ 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-11-05T10:28:38.110

```
 /// <summary>
    /// Trims the ignoring spacified tags
    /// </summary>
    /// <param name="text">the text from which html is to be removed</param>
    /// <param name="isRemoveScript">specify if you want to remove scripts</param>
    /// <param name="ignorableTags">specify the tags that are to be ignored while stripping</param>
    /// <returns>Stripped Text</returns>
    public static string StripHtml(string text, bool isRemoveScript, params string[] ignorableTags)
    {
        if (!string.IsNullOrEmpty(text))
        {
            text = text.Replace("&lt;", "<");
            text = text.Replace("&gt;", ">");
            string ignorePattern = null;

            if (isRemoveScript)
            {
                text = Regex.Replace(text, "<script[^<]*</script>", string.Empty, RegexOptions.IgnoreCase);
            }
            if (!ignorableTags.Contains("style"))
            {
                text = Regex.Replace(text, "<style[^<]*</style>", string.Empty, RegexOptions.IgnoreCase);
            }
            foreach (string tag in ignorableTags)
            {
                //the character b spoils the regex so replace it with strong
                if (tag.Equals("b"))
                {
                    text = text.Replace("<b>", "<strong>");
                    text = text.Replace("</b>", "</strong>");
                    if (ignorableTags.Contains("strong"))
                    {
                        ignorePattern = string.Format("{0}(?!strong)(?!/strong)", ignorePattern);
                    }
                }
                else
                {
                    //Create ignore pattern fo the tags to ignore
                    ignorePattern = string.Format("{0}(?!{1})(?!/{1})", ignorePattern, tag);
                }

            }
            //finally add the ignore pattern into regex <[^<]*> which is used to match all html tags
            ignorePattern = string.Format(@"<{0}[^<]*>", ignorePattern);
            text = Regex.Replace(text, ignorePattern, "", RegexOptions.IgnoreCase);
        }

        return text;
    } 
```

# c# - C# 使用命名实例连接到 SQL 服务器？

> ID：307014
> 
> 赞同：2
> 
> 时间：2008-11-20T22:01:51.400
> 
> 标签：c#, sql

我的一个客户告诉我，我为他们制作的程序不会连接到命名实例的 SQL 服务器，我有一个没有命名实例的标准 SQL 服务器，所以我想知道如何测试它。命名实例连接字符串如下所示，如果我的代码失败，反斜杠可以是吗？

Driver={SQL Native Client};Server=myServerName\theInstanceName;Database=myDataBase;

我的代码如下：

```
sqlServer=s.Substring(keyword.Length,s.Length-keyword.Length);
FormODBC formODBC=new FormODBC(this);
formODBC.SetSqlServer(sqlServer,dbUsername,dbPassword,database,table);
formODBC.ReadData(); 
```

我应该如何处理反斜杠，因为我怀疑这可能是问题所在？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T19:22:48.663

另外，请记住反斜杠是 C# 字符串中的转义字符。如果您的实例名称包含在字符串变量中，请确保您执行以下任一操作：

```
string server = "myServer\\myInstance"; 
```

或者

```
string server = @"myServer\myInstance"; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-20T22:16:59.123

我们有带有命名实例的 SQL 服务器。示例：myservername\sql2005。反斜杠很好，在连接字符串中，服务器名称将是“myservername\sql2005”，可以 100% 正常工作。您可以在同一台服务器上有一个“常规实例”，将是“myservername”

PS 只是对您的函数进行单元测试，使连接字符串返回“myservername\sql2005”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T19:31:52.170

答案是确保您的连接字符串是可配置的，并将其设置为：

数据源=localhost\msexpress；数据库=dbname；trusted_connection=true；

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T22:22:50.093

偶尔也会出现 SQL Express 版本的情况，其中名称为 MyServerName\SQLEXPRESS。这可能会使某些人绊倒，因为他们不会想到以这种方式指定服务器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-20T22:24:04.427

您可以将连接字符串提取到配置文件（请注意，这不一定安全 - 这将取决于他们的 SQL 安全服务器的设置方式以及您的应用程序正在运行的帐户） - 然后您的客户端可以添加适当的连接部署时将其服务器的字符串添加到应用程序的配置中。

笔记：

*   您可以通过将 .txt 文件重命名为 .udl 文件并运行直到可以连接到您/他们的服务器来创建连接字符串。
*   您的未命名实例实际上可以通过名称访问 - 安装 SQL 服务器的机器名称

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-20T22:08:44.117

Scott，冒着明显的风险，您是否尝试过在自己的开发环境中设置命名实例？我实际上并不知道您的问题的答案，但我个人从未遇到过测试直接失败的场景无济于事的解决方案。至少，您应该能够获得更好的调试信息，以准确了解失败的原因。祝你好运解决这个问题。

问候，克里斯

# linux - 如何包含管道 | 在我的 linux 中找到 -exec 命令？

> ID：307015
> 
> 赞同：250
> 
> 时间：2008-11-20T22:01:52.163
> 
> 标签：linux, command-line

这是行不通的。这可以在find中完成吗？还是我需要 xargs？

```
find -name 'file_*' -follow -type f -exec zcat {} \| agrep -dEOE 'grep' \; 
```

* * *

## 回答 #1

> 赞同：338
> 
> 时间：2008-11-20T22:40:41.150

解决方法很简单：通过 sh 执行

```
... -exec sh -c "zcat {} | agrep -dEOE 'grep' " \; 
```

* * *

## 回答 #2

> 赞同：158
> 
> 时间：2008-11-20T22:42:22.287

将管道符号解释为运行多个进程并将一个进程的输出通过管道传输到另一个进程的输入的指令的工作是 shell（/bin/sh 或等效项）的职责。

在您的示例中，您可以选择使用顶级外壳来执行管道，如下所示：

```
find -name 'file_*' -follow -type f -exec zcat {} \; | agrep -dEOE 'grep' 
```

就效率而言，此结果需要调用一次 find、多次调用 zcat 和一次调用 agrep。

这将导致仅生成一个 agrep 进程，该进程将处理由多次调用 zcat 产生的所有输出。

如果你出于某种原因想要多次调用 agrep，你可以这样做：

```
find . -name 'file_*' -follow -type f \
    -printf "zcat %p | agrep -dEOE 'grep'\n" | sh 
```

这会使用管道构造一个命令列表来执行，然后将这些命令发送到一个新的 shell 以实际执行。（省略最后的“| sh”是调试或执行这样的命令行干运行的好方法。）

就效率而言，此结果需要调用一次 find、一次调用 sh、多次调用 zcat 和多次调用 agrep。

就命令调用次数而言，最有效的解决方案是 Paul Tomblin 的建议：

```
find . -name "file_*" -follow -type f -print0 | xargs -0 zcat | agrep -dEOE 'grep' 
```

...这需要一次 find 调用，一次 xargs 调用，几次 zcat 调用和一次 agrep 调用。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-11-20T22:04:46.760

```
find . -name "file_*" -follow -type f -print0 | xargs -0 zcat | agrep -dEOE 'grep' 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2010-09-18T12:01:05.237

您还可以通过管道连接到一个`while`循环，该循环可以对定位的文件执行多项操作`find`。因此，这是一个用于在`jar`包含大量文件的文件夹中查找给定 java 类文件的`jar`档案

```
find /usr/lib/eclipse/plugins -type f -name \*.jar | while read jar; do echo $jar; jar tf $jar | fgrep IObservableList ; done 
```

关键是`while`循环包含多个引用传入文件名的命令，这些命令用分号分隔，这些命令可以包括管道。因此，在该示例中，我回显了匹配文件的名称，然后列出了归档过滤中给定类名的内容。输出如下所示：

/usr/lib/eclipse/plugins/org.eclipse.core.contenttype.source_3.4.1.R35x_v20090826-0451.jar /usr/lib/eclipse/plugins/org.eclipse.core.databinding.observable_1.2.0.M20090902-0800 .jar org/eclipse/core/databinding/observable/list/ **IObservableList** .class /usr/lib/eclipse/plugins/org.eclipse.search.source_3.5.1.r351_v20090708-0800.jar /usr/lib/eclipse/plugins/ org.eclipse.jdt.apt.core.source_3.3.202.R35x_v20091130-2300.jar /usr/lib/eclipse/plugins/org.eclipse.cvs.source_1.0.400.v201002111343.jar /usr/lib/eclipse/plugins/ org.eclipse.help.appserver_3.1.400.v20090429_1800.jar

在我的 bash shell (xubuntu10.04/xfce) 中，它确实使匹配的类名加粗，因为`fgrep`突出显示匹配的字符串；这使得扫描数百个`jar`已搜索文件的列表并轻松查看任何匹配项变得非常容易。

在 Windows 上，您可以执行相同的操作：

```
for /R %j in (*.jar) do @echo %j & @jar tf %j | findstr IObservableList 
```

请注意，在 Windows 上，命令分隔符是 '&' 而不是 ';' 并且“@”会抑制命令的回显，以提供整洁的输出，就像上面的 linux find 输出一样；虽然`findstr`不是使匹配的字符串加粗，所以你必须更仔细地查看输出才能看到匹配的类名。事实证明，windows 的“for”命令知道很多技巧，比如循环遍历文本文件……

请享用

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2019-11-28T06:24:46.770

我发现运行字符串 shell 命令 (sh -c) 效果最好，例如：

```
find -name 'file_*' -follow -type f -exec bash -c "zcat \"{}\" | agrep -dEOE 'grep'" \; 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2019-10-16T11:15:06.090

如果您正在寻找一个简单的替代方案，可以使用循环来完成：

```
for i in $(find -name 'file_*' -follow -type f); do
  zcat $i | agrep -dEOE 'grep'
done 
```

或者，更一般和易于理解的形式：

```
for i in $(YOUR_FIND_COMMAND); do
  YOUR_EXEC_COMMAND_AND_PIPES
done 
```

并将 YOUR_EXEC_COMMAND_AND_PIPES 中的任何 {} 替换为 $i

# installation - 是否可以注册异步可插入协议用户特定注册表？

> ID：307016
> 
> 赞同：0
> 
> 时间：2008-11-20T22:01:58.357
> 
> 标签：installation, registry, pluggableprotocol

有关异步可插拔协议，请参阅[http://msdn.microsoft.com/en-us/library/aa767916(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa767916(VS.85).aspx)。

我们目前可以使用它，但是它需要我们写入 HKey_Class_Root。为了尝试允许非管理员安装，如果我们可以通过写入 HKey_Current_User 来实现相同的目标，那就太好了。简单地更改注册表位置似乎不起作用，我想知道是否有可能

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-24T16:20:30.277

弄清楚了，每台机器的位置如下： HKCR\CLSID{DLL-GUID} 但每个用户的位置是： HKCU\Software\Classes\CLSID{DLL-GUID}

# mysql - MySQL 连接问题

> ID：307019
> 
> 赞同：1
> 
> 时间：2008-11-20T22:03:06.827
> 
> 标签：mysql, join

以下查询为我返回了奇怪的结果：

```
SELECT
    `Statistics`.`StatisticID`,
    COUNT(`Votes`.`StatisticID`) AS `Score`,
    COUNT(`Views`.`StatisticID`) AS `Views`,
    COUNT(`Comments`.`StatisticID`) AS `Comments`
FROM `Statistics`
LEFT JOIN `Votes` ON `Votes`.`StatisticID` = `Statistics`.`StatisticID`
LEFT JOIN `Views` ON `Views`.`StatisticID` = `Statistics`.`StatisticID`
LEFT JOIN `Comments` ON `Comments`.`StatisticID` = `Statistics`.`StatisticID`
GROUP BY `Statistics`.`StatisticID`
LIMIT 0, 10 
```

我在如下表结构上查询这个：

（仅与 相关的数据`Statistics.StatisticID = 8`）

### 投票

```
StatisticID
    8 
```

### 意见

```
StatisticID
    8
    8 
```

### 评论

```
StatisticID
    8
    8
    8
    8
    8 
```

现在，如果我运行此查询，我会得到以下结果集：

```
StatisticID    Score    Views   Comments
     8           5        5        5 
```

我知道 5 来自哪里——评论的数量——如果我把评论声明拿出来，这很有效。任何人都可以调试它，因为这超出了我的能力范围（我对 SQL 比较陌生）。

谢谢，罗斯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-20T22:34:11.880

像这样加入时，您将复制数据的次数与您在其他表中找到的数学行一样多。这很好，如果每个表中只有 1 个对应的行。

在没有分组的情况下运行此查询，您将了解为什么在所有方面都得到相同的结果。然而，我猜你会得到 10 作为每个字段的计数 (1*2*5) 如果你想解决这个问题，你需要为每个计数调用一个子选择。

```
选择
    s.`StatisticID`,
    (SELECT COUNT(*) FROM Votes WHERE Votes.StatisticID = s.StatisticID) 作为分数，
    (SELECT COUNT(*) FROM Views WHERE Views.StatisticID = s.StatisticID) 作为视图，
    (SELECT COUNT(*) FROM Comments WHERE Comments.StatisticID = s.StatisticID) 作为评论，
FROM `Statistics` s
限制 0, 10

```

如果外部结果很大，则存在某些性能问题。您可以通过加入其中一个表来对其进行一些优化，但是我不确定查询解析器是否足够聪明，只能为每个分组项目运行 1 次。希望它会。否则，您可以将其拆分为不同的查询。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-20T23:40:16.943

假设您在投票/视图/评论中有一个 id 字段或类似字段：

```
SELECT
    `Statistics`.`StatisticID`,
    COUNT(DISTINCT `Votes`.`VoteID`) AS `Score`,
    COUNT(DISTINCT `Views`.`ViewID`) AS `Views`,
    COUNT(DISTINCT `Comments`.`CommentID`) AS `Comments`
FROM `Statistics`
LEFT JOIN `Votes` ON `Votes`.`StatisticID` = `Statistics`.`StatisticID`
LEFT JOIN `Views` ON `Views`.`StatisticID` = `Statistics`.`StatisticID`
LEFT JOIN `Comments` ON `Comments`.`StatisticID` = `Statistics`.`StatisticID`
GROUP BY `Statistics`.`StatisticID`
LIMIT 0, 10 
```

没有测试它，但认为它应该工作。（我们必须使用不同的字段，因为 statisticID 在给定组中总是相同的......）

# silverlight - 如何重新架构 ASP.NET 应用程序的 Hibernate DAO 层以将其移动到 Silverlight？

> ID：307022
> 
> 赞同：0
> 
> 时间：2008-11-20T22:04:43.920
> 
> 标签：silverlight, architecture, orm, domain-driven-design, lazy-loading

最后尝试得到这个答案。

我有一个简单的 ASP.NET 应用程序，它使用 Hibernate 进行数据访问。GUI 可以调用客户对象上的方法，例如“CalculateTotalSumOfOrders()”。延迟加载（即使它不是最佳的）对我有用，当在域对象中引用 Orders 和 OrderLines 集合时，它们将自动从数据库中获取。

现在让我们假设我正在将同一个应用程序重写为 Silverlight，因为它看起来比 ASP.NET 更好。我不再能够进行延迟加载或数据访问，因为 Silverlight 客户端在浏览器中运行。如何在不考虑使用何种服务将数据导入 Silverlight 客户端的情况下解决此问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-22T04:33:34.357

One option that would support Silverlight and Windows clients would be the new [ADO.NET Data Services](http://msdn.microsoft.com/en-us/data/bb931106.aspx) in .NET 3.5 SP1\. These are a set of services that expose your database schema through a WCF interface. You can then retrieve the data from Silverlight or a Windows Client using a WCF client.

As @McWafflestix has said, you won't be able to do lazy loading any more, but in my opinion that's a good thing because retrieving data is now a much more "expensive" operation.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T13:07:16.393

支持所有这些平台的最佳选择是使用 Web 服务。您可以选择许多不同的风格，.NET 2.0 Web 服务 (ASMX)、WCF、REST，如果您使用 Silverlight，您可能需要考虑使用[此处](http://blogs.msdn.com/swiss_dpe_team/archive/2008/03/17/silverlight-2-beta1-wcf-linq-to-sql-a-powerfull-combination.aspx)演示的 WCF + LINQ to SQL 。该组合还可用于 ASP.NET（如果在 .NET 3.5 上运行）和 Windows 桌面应用程序（同样是 .NET 3.5）。

此外，您可能会对名为 InterLinq 的开源项目感兴趣，基本上它允许您在客户端构建 LINQ to SQL 查询，然后通过 WCF 将它们传输到执行查询并返回结果的服务器。可以在[这里](http://www.codeplex.com/interlinq)找到。我过去曾尝试过它，并且效果很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T22:08:02.433

您正在尝试使用与数据库交互并进行延迟加载的服务器端应用程序，并将其转换为客户端应用程序而无需大量工作？对不起，它只是行不通。您需要的是对您的应用程序进行重大重新架构。

对不起...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-12T12:57:52.380

*

> “没关系，因为我来得还早。你将如何重新架构它以最小的开销支持 ASP.NET、silverlight 和 Windows 客户端？”

*

我知道我会在过期后回答这个问题，无论如何。我建议你使用 MVP 设计模式；这将帮助您构建多个“视图”以使用您的模型。为了确保您支持 Windows 客户端，您必须使用服务层（阅读 WCF）公开您的业务层。

# java - Java 中 MacOS X 的本机 Swing 菜单栏支持

> ID：307024
> 
> 赞同：17
> 
> 时间：2008-11-20T22:05:26.587
> 
> 标签：java, swing, macos

突出的链接是[http://www.devdaily.com/blog/post/jfc-swing/handling-main-mac-menu-in-swing-application/](http://www.devdaily.com/blog/post/jfc-swing/handling-main-mac-menu-in-swing-application/)但是 Mac OS X 下的菜单栏显示为包名称而不是应用程序名称。我使用上面链接中的代码没有任何运气，所以我不确定最近的 Mac OS 版本是否有任何变化。

这是一个摘录：

> ```
> public RootGUI() {
>     super("Hello");
>     JMenuBar menuBar = new JMenuBar();
>     JMenu file = new JMenu("File");
>     JMenuItem item = new JMenuItem("Woah");
>     file.add(item);
>     menuBar.add(file);
>     setJMenuBar(menuBar);
>     setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
>     setSize(100, 100);
>     pack();
>     setVisible(true);
> } 
> ```

```
public static void main(String[] args) {
    javax.swing.SwingUtilities.invokeLater(new Runnable() {
        public void run() {
            try {
                System.setProperty("apple.laf.useScreenMenuBar", "true");
                System.setProperty("com.apple.mrj.application.apple.menu.about.name", "Test");
                UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
                new RootGUI();
            }
            catch(ClassNotFoundException e) {
                System.out.println("ClassNotFoundException: " + e.getMessage());
            }
            catch(InstantiationException e) {
                System.out.println("InstantiationException: " + e.getMessage());
            }
            catch(IllegalAccessException e) {
                System.out.println("IllegalAccessException: " + e.getMessage());
            }
            catch(UnsupportedLookAndFeelException e) {
                System.out.println("UnsupportedLookAndFeelException: " + e.getMessage());
            }

        }
    });
} 
```

菜单栏上的第一个菜单项应显示为“测试”，不幸的是，情况并非如此。另一方面，文件菜单工作正常。有任何想法吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-21T23:50:05.783

@Kezzer

我想我明白发生了什么。如果您将 main() 方法放在*不同的类*中，那么一切正常。所以你需要类似的东西：

```
public class RootGUILauncher {
  public static void main(String[] args) {
    try {
                System.setProperty("apple.laf.useScreenMenuBar", "true");
                System.setProperty("com.apple.mrj.application.apple.menu.about.name", "Test");
                UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
        }
        catch(ClassNotFoundException e) {
                System.out.println("ClassNotFoundException: " + e.getMessage());
        }
        catch(InstantiationException e) {
                System.out.println("InstantiationException: " + e.getMessage());
        }
        catch(IllegalAccessException e) {
                System.out.println("IllegalAccessException: " + e.getMessage());
        }
        catch(UnsupportedLookAndFeelException e) {
                System.out.println("UnsupportedLookAndFeelException: " + e.getMessage());
        }
        javax.swing.SwingUtilities.invokeLater(new Runnable() {
        public void run() {
            new RootGUI();
        }
    });
} 
```

然后将您的 RootGUI 类放在不同的文件中。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-20T23:35:19.107

您需要在主线程中设置“com.apple.mrj.application.apple.menu.about.name”系统属性，而不是在 Swing 线程中（换句话说，只需将其设为程序的第一行即可）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-21T05:51:55.490

据我了解，您想重命名 os x 菜单栏上显示的应用程序菜单。好吧，我没有找到系统属性，但我找到了一个命令行选项：

```
-Xdock:name="YourNameHere" 
```

这对我有用。

顺便说一句：系统属性 com.apple.mrj.application.apple.menu.about.name 用于重命名应用程序菜单中的 about 菜单项，而不是菜单栏本身

在此处查看[此链接](http://www.oracle.com/technetwork/articles/javase/javatomac-140486.html)（[旧链接](http://java.sun.com/developer/technicalArticles/JavaLP/JavaToMac/)可能在 sun-oracle-aquisition 之后的某个时间被删除）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-22T20:22:13.840

您还可以在构建应用程序时使用[Macify](http://simplericity.com/2007/10/02/1191336060000.html)，这样您就无需更改任何代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T17:56:02.847

如果您想交付一个看起来在 Mac OS X 上原生的应用程序，一个重要的部分是交付一个应用程序包。在应用程序包中，您将能够提供属性列表文件以解决此问题。

一些官方信息：[Mac OS X 的 Java 开发指南](http://developer.apple.com/documentation/Java/Conceptual/Java14Development/07-NativePlatformIntegration/NativePlatformIntegration.html#//apple_ref/doc/uid/TP40001909-SW1)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-02-09T02:17:21.903

如果您要启动多个 JFrame 并使用 mac 菜单，则其中一个 JFrame 可能会用具有不同菜单结构的 JFrame 替换您想要的 JFrame。我不确定您是否可以为多个 JFrame 共享一个 JMenuBar，但您可以创建一个所有框架都实例化的应用程序范围的菜单栏。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-10-03T14:32:07.573

对于任何有兴趣的人，虽然这个问题已经 6 岁了，但我也遇到了同样的问题。Swing 菜单不显示在 mac 本机栏中。我找到了一个更简单、更直接的解决方案......只需在 JFrame 中添加一个 Java.awt 菜单组件而不是 JMenu，它就会自动显示在本机菜单栏中！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-04-23T23:28:00.410

谈论迟到，但我可以确认（令人惊讶）

`System.setProperty("apple.laf.useScreenMenuBar", "true");`

...然后在 JFrame 上设置一个 JMenuBar 工作，将菜单栏放在 macOS 首选的顶部。

`jFrame.setJMenuBar(jMenuBar);`

...在 macOS Big Sur (11.2.3) 和 JDK 16 上运行。

# sql - 这是在关系数据库中对地址信息建模的好方法吗？

> ID：307027
> 
> 赞同：27
> 
> 时间：2008-11-20T22:05:54.027
> 
> 标签：sql, database-design, rdbms

我想知道这是否是一个好的设计。我有许多需要地址信息的表格（例如街道、邮政编码/邮编、国家、传真、电子邮件）。有时同一个地址会重复多次。例如，可以针对供应商存储地址，然后在发送给他们的每个采购订单上存储地址。然后供应商可以更改他们的地址，任何后续的采购订单都应该有新的地址。它比这更复杂，但这是一个示例要求。

选项 1 将所有地址列作为属性放在各个表上。在创建 PO 时将详细信息从供应商复制到 PO。可能存储多个副本

选项 2 创建单独的地址表。有一个从供应商和采购订单表到地址表的外键。只允许在地址表上插入和删除，因为更新可能会超出您的预期。然后我会有一些计划任务，从地址表中删除任何不再被任何东西引用的行，因此不会留下未使用的行。也许对地址表中的所有非 pk 列也有一个唯一约束，以停止重复。

我倾向于选项2。有更好的方法吗？

编辑：我必须保持采购订单上的地址与发送时的地址相同。另外，我建议的情况要复杂一些，因为可能有送货地址和帐单地址（还有一堆其他包含地址信息的表）。

一段时间后，我将根据日期批量删除旧的采购订单。正是在这之后，我打算对任何不再被任何东西引用的地址记录进行垃圾收集（否则感觉就像我正在创建泄漏）。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-11-20T22:28:21.080

实际上，我将此作为我的面试问题之一。以下是一个很好的起点：

```
Addresses
---------
AddressId (PK)
Street1
... (etc) 
```

和

```
AddressTypes
------------
AddressTypeId
AddressTypeName 
```

和

```
UserAddresses (substitute "Company", "Account", whatever for Users)
-------------
UserId
AddressTypeId
AddressId 
```

这样，您的地址完全不知道它们是如何被使用的，并且您的实体（用户、帐户）也不直接了解地址的任何信息。这完全取决于您创建的链接表（在这种情况下为 UserAddresses，但您可以做任何适合您的模型的事情）。

对于一个潜在的大型数据库，有一条有点矛盾的建议：继续在您的实体上直接放置一个“主”地址（在本例中为 Users 表中）以及一个“HasMoreAddresses”字段。与仅使用上面的简洁设计相比，这似乎很棘手，但可以简化典型用例的编码，并且非规范化可以对性能产生很大影响。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-20T22:28:57.180

选项2，毫无疑问。

一些重要的事情要记住：当地址相互链接时向用户指示是设计的一个重要方面。即公司地址与送货地址相同；如果他们想更改送货地址，他们是否也想更改公司地址，还是他们想指定一个新的装卸码头？这种东西，以及向用户呈现这些信息并以这种粒度改变事物的能力是非常重要的。这对于更新也很重要；为用户提供“拆分”条目的粒度。并不是说这种 UI 很容易设计；事实上，这是一个婊子。但这真的很重要；几乎肯定会导致您的用户非常沮丧和恼火。

还; 我强烈建议保留旧地址数据；不要运行一个进程来清理它。除非您有一个非常繁忙的数据库，否则您的数据库软件将能够处理多余的数据。真的。我看到的关于数据库的一个常见错误是试图过度优化。你确实想优化你的查询，但你不想优化你未使用的数据。（同样，如果您的数据库活动非常高，您可能需要一些东西来执行此操作，但几乎可以肯定的是，您的数据库在表中仍有多余数据的情况下可以正常工作。）在大多数情况下，它实际上更有利简单地让您的数据库增长而不是尝试优化它。（从表中删除零星数据不会导致数据库大小显着减少，

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-20T22:11:57.057

您想保留采购订单上最初的地址的历史记录吗？

如果是，则使用选项 1，否则将其存储在供应商表中并将每个采购订单链接到供应商。

顺便说一句：糟糕的数据库设计的一个明确迹象是需要自动化作业来保持数据“清理”或同步。以这种方式衡量，选项 2 可能是个坏主意

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-20T22:28:22.203

我想我同意JohnFx ..

关于（蜗牛）邮件地址的另一件事，因为你想包括国家，我假设你想在国际上运送/邮寄，请保留地址字段主要是自由格式的文本。当挪威没有邮政编码时，必须编一个 5 位数的邮政编码真的很烦人，我们有 4 位数的邮政编码。

最好的领域是：

*   名称/公司
*   地址（多行文本区域）
*   国家

这应该是相当全球化的，如果美国邮政系统需要特定格式的邮政编码，那么也包括它，但除非选择美国作为国家，否则它是可选的。每个人都知道如何在他们的国家格式化地址，所以只要你保留换行符就可以了......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-20T22:27:48.943

为什么地址表上的任何行都会变为未使用？使用它们的采购订单肯定还会指向它们吗？

在我看来，停止重复应该是优先事项，因此不需要进行任何清理。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T22:29:02.920

在订单的情况下，如果订单已发送，您将永远不想更新地址，因为个人（或公司）地址已更改。如果订单有问题，您需要记录实际发送订单的位置。

地址表是个好主意。对其进行唯一约束，使同一实体不能有重复的地址。您可能仍然会得到它们，因为用户可能会添加另一个而不是查找它们，并且如果它们拼写稍有不同（St. 而不是 Street），则唯一约束不会阻止这种情况。将创建订单时的数据复制到订单中。这是您需要多个记录的一种情况，因为您需要历史记录来记录您发送的内容。只允许对表进行插入和删除对我来说毫无意义，因为它们并不比更新更安全，并且涉及到数据库的更多工作。一次调用数据库即可完成更新。如果您的想法中的地址发生变化，那么您必须先删除旧地址，然后插入新地址。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-03T18:24:14.983

我已经看到每个使用选项 1 的系统都陷入数据质量问题。5 年后，所有地址的 30% 将不再是最新的。

# makefile - makefile调用makefile错误

> ID：307030
> 
> 赞同：0
> 
> 时间：2008-11-20T22:07:01.547
> 
> 标签：makefile, multiple-makefiles

我有一个有效的品牌，我有平台代码，并且喜欢文件夹中每个操作系统的几个品牌。现在我有一个可以工作的makefile。我将它重命名为 Makefile.ws 并在 Makefile 中写了这个

```
all:
    make -f Makefile.w32

clean:
    make -f Makefile.w32 clean 
```

我运行它并收到此错误

```
> "make" 
make -f Makefile.w32
make[1]: Entering directory `/c/nightly/test'
make -f Makefile.w32
make[3]: Makefile.w32: No such file or directory
make[3]: *** No rule to make target `Makefile.w32'.  Stop.
make[2]: *** [all] Error 2
make[1]: *** [build] Error 2
make[1]: Leaving directory `/c/nightly/test'
"make": *** [all] Error 2 
```

奇怪的是，清洁工作完美。然后我决定写“make -f Makefile.w32 mingw32”，但它不能正常工作。事实上，它创建了一个名为 mingw32 的文件夹，我认为这很奇怪。

至于 mingw32 规则，我只是复制我怀疑是用于构建的主要/正常规则的构建

```
$(BUILD):
    @[ -d $@ ] || mkdir -p $@
    @make --no-print-directory -C $(BUILD) -f $(CURDIR)/Makefile

mingw32:
    @[ -d $@ ] || mkdir -p $@
    @make --no-print-directory -C $(BUILD) -f $(CURDIR)/Makefile 
```

完整的 .w32 源代码在这里 [http://pastie.org/320035](http://pastie.org/320035)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T22:18:40.553

首先，你在运行什么品牌？Cygwin 或 MinGW，还是别的什么？

```
make -f Makefile.w32
make[1]: Entering directory `/c/nightly/test'
make -f Makefile.w32 
make[3]: Makefile.w32: No such file or directory 
```

“进入目录”是一个提示。为什么进入/c/nightly/test？那里有 Makefile.w32 吗？

至于创建目录“mingw32”，规则

```
mingw32:
        @[ -d $@ ] || mkdir -p $@
        ... 
```

正是这样做的。如果“mingw32”不存在，它会创建它。

如果您有一个更简短的示例并清楚地说明您想要完成什么以及您期望发生什么，那么帮助您会更容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T22:18:01.320

您是否尝试过使用

`$(MAKE) -f ...`

代替

`make -f ...`?

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T22:22:45.680

我想我在你的第二个例子中看到了问题。应该更改 mingw32 行，使其不包含 $(BUILD) 变量：

```
mingw32:
    @[ -d $@ ] || mkdir -p $@
    @make --no-print-directory -C mingw32 -f $(CURDIR)/Makefile
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T22:24:16.517

1.  很明显，他创建了目录，您在给定的 2 条规则中的第一个命令，包括一个带有对象名称的 mkdir，即 build 或 mingw32
2.  之后他切换到当前目录（即根本没有 cd）并执行 Makefile。但是正如您所写，您将 Makefile 重命名为 Makefile.ws，因此您当然会收到 File-Not-Found-error。

从这些问题中，我只能建议您看一下简短的介绍，甚至更好的制作手册。

# python - save() 函数中的 Django 外键访问

> ID：307038
> 
> 赞同：5
> 
> 时间：2008-11-20T22:10:21.243
> 
> 标签：python, django, django-models

这是我的代码：

```
class Publisher(models.Model):
    name = models.CharField(
            max_length = 200,
            unique = True,
    )

    url = models.URLField()

    def __unicode__(self):
        return self.name

    def save(self):
        pass

class Item(models.Model):
    publisher = models.ForeignKey(Publisher)

    name = models.CharField(
            max_length = 200,
    )

    code = models.CharField(
            max_length = 10,
    )

    def __unicode__(self):
        return self.name 
```

我希望能够从发布者保存功能访问每个项目。我怎样才能做到这一点？

例如，我想`code`在保存 Publisher 时将文本附加到与此 Publisher 关联的每个 Item 的字段。

**编辑**：当我尝试实施第一个解决方案时，我收到错误“'Publisher' object has no attribute 'item_set'”。显然我无法以这种方式访问​​它。还有其他线索吗？

**编辑 2**：我发现发生的问题是，当我创建一个新的 Publisher 对象时，我添加了内联项目。因此，当尝试保存发布者并访问项目时，它们不存在。

有没有办法解决？！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-20T22:25:09.730

您应该能够执行以下操作：

```
def save(self, **kwargs):
    super(Publisher, self).save(**kwargs)

    for item in self.item_set.all():
        item.code = "%s - whatever" % item.code 
```

I don't really like what you're doing here, this isn't a good way to relate `Item` to `Publisher`. What is it you're after in the end?

# ruby-on-rails - Rails 最佳实践问题：应该将共享代码放在哪里以及如何加载？

> ID：307041
> 
> 赞同：3
> 
> 时间：2008-11-20T22:11:55.903
> 
> 标签：ruby-on-rails, ruby, loading, shared

为了提供完整的示例，我一直关注的 Rails 书籍和网页都坚持非常简单的项目。我正在远离小型项目应用程序，进入非浏览器客户端领域，需要决定将所有相关方共享的代码放在哪里。

非浏览器客户端是在任何可以连接到数据库的机器上运行的脚本。浏览器客户端将命令写入数据库，脚本会检查并决定要做什么。完成后，脚本将其结果写回。该脚本不是由 RoR 服务器启动的，但可以访问其目录结构。

共享代码的最佳存放位置是哪里，RoR 加载程序将如何处理它？有问题的代码并不真正属于模型，否则我会把它放在那里并完成它。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-20T22:17:34.503

我会将共享代码放在 Rails 项目的`/lib`目录中，并考虑将其设为自定义 Rake 任务。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T19:19:56.517

这实际上取决于您使用此共享代码的程度。如果你在任何地方都使用它，那么将它扔到 lib 文件夹中（正如这里已经说明的那样）。如果您只在几个地方使用它，您可能需要考虑用它制作一个插件并仅在使用它的地方加载它。只加载你需要的东西很好（我喜欢 merb 的原因之一）。

# c# - 在 C# 中搜索图形库以绘制地震数据

> ID：307043
> 
> 赞同：1
> 
> 时间：2008-11-20T22:12:30.927
> 
> 标签：c#, graphics

我正在寻找可以绘制地震数据的图形库；这是垂直绘制的大量曲线，并为您提供如下形状：

[替代文字 http://img237.imageshack.us/my.php?image=seismicdataxb2.png](http://img237.imageshack.us/my.php?image=seismicdataxb2.png)

我需要它能够：

1）用鼠标选择每条曲线并返回一个值，告诉我我选择了哪条曲线。

2) 用多个值标记刻度。

提前谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T18:00:37.580

您是否考虑过创建 WPF 应用程序？这可能会给你你需要的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-01-25T01:21:32.667

抱歉，我知道的老问题；但是 INT 为这类事情出售了一系列可视化库（包括 .NET）：

[http://www.int.com/](http://www.int.com/)

他们的 C++ 库也是跨平台的：我曾经为一家在 X Windows 和 MS Windows 中使用它们的公司工作。在当时（大约 2000 年），这是一件大事。

# security - 如何在 Windows Server 2003 中记录文件夹权限？

> ID：307047
> 
> 赞同：1
> 
> 时间：2008-11-20T22:13:46.790
> 
> 标签：security, permissions, windows-server-2003, directory

我管理一小组 Windows Server 2003 计算机。其中一台服务器的性能与其他服务器不同。

我希望我没有像其他人一样设置文件夹和共享权限。

我希望能够创建一个包含来自每个服务器的共享和文件夹权限的文本文档，这样我就可以使用 DIFF 工具来查看差异。

我已经查看了 XCACLS 和 Systinterals AccessChk 和 AccessEnum，但没有找到解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T00:46:04.297

[从http://www.somarsoft.com/](http://www.somarsoft.com/)查看 DumpSec ，它可以列出文件系统、注册表、打印机和共享的权限。

# apache-flex - 有谁知道 salesforce.com 上的跨域策略文件是否已更改？

> ID：307048
> 
> 赞同：1
> 
> 时间：2008-11-20T22:14:10.127
> 
> 标签：apache-flex, crossdomain.xml, salesforce

突然，我的 Flex 应用程序无法再通过其 API 连接到 salesforce.com，我遇到了安全沙箱违规行为。登录凭据是正确的，我已经通过不同的方式尝试过它们，并且我在下面对它们进行了混淆。

这在今天早些时候工作得很好，从那以后我就没有编码了。

其他人遇到过这个或知道发生了什么吗？

这是返回给我的应用程序的异常

```
Method name is: login
'A997F86A-36E9-DDDC-EC6B-BBEE23101466' producer connected.
'A997F86A-36E9-DDDC-EC6B-BBEE23101466' producer sending message 'B89E5879-D7F7-E91E-2082-BBEE231054DD'
'direct_http_channel' channel sending message:
(mx.messaging.messages::HTTPRequestMessage)#0
  body = "<se:Envelope xmlns:se="http://schemas.xmlsoap.org/soap/envelope/"><se:Header xmlns:sfns="urn:partner.soap.sforce.com"/><se:Body><login xmlns="urn:partner.soap.sforce.com" xmlns:ns1="sobject.partner.soap.sforce.com"><username>simon.palmer@***.com</username><password>***</password></login></se:Body></se:Envelope>"
  clientId = (null)
  contentType = "text/xml; charset=UTF-8"
  destination = "DefaultHTTPS"
  headers = (Object)#1
  httpHeaders = (Object)#2
    Accept = "text/xml"
    SOAPAction = """"
    X-Salesforce-No-500-SC = "true"
  messageId = "B89E5879-D7F7-E91E-2082-BBEE231054DD"
  method = "POST"
  recordHeaders = false
  timestamp = 0
  timeToLive = 0
  url = "https://www.salesforce.com/services/Soap/u/11.0"
Method name is: login
*** Security Sandbox Violation ***
Connection to https://www.salesforce.com/services/Soap/u/11.0 halted - not permitted from https://localhost/pm_server/pm/pm-debug.swf
'A997F86A-36E9-DDDC-EC6B-BBEE23101466' producer acknowledge of 'B89E5879-D7F7-E91E-2082-BBEE231054DD'.
'A997F86A-36E9-DDDC-EC6B-BBEE23101466' producer fault for 'B89E5879-D7F7-E91E-2082-BBEE231054DD'.
Comunication Error : Channel.Security.Error : Security error accessing url : Destination: DefaultHTTPS
Error: Request for resource at https://www.salesforce.com/services/Soap/u/11.0 by requestor from https://localhost/pm_server/pm/pm-debug.swf is denied due to lack of policy file permissions. 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-27T18:38:18.080

You have to make sure to load the policy from the /services tree, the default policy at the root won't help you. You need to load this policy [https://www.salesforce.com/services/crossdomain.xml](https://www.salesforce.com/services/crossdomain.xml)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-04T02:48:24.377

解决这个问题的方法是设置服务器协议和url如下：

```
apex = new Connection();    
apex.serverUrl = "https://na3.salesforce.com/services/Soap/u/14.0";
apex.protocol = "https"; 
```

但是，这似乎会造成用户被锁定的次要问题，因此无法连接的问题仍然存在。

**更新：** salesforce.com 已经承认了一个错误。请参阅我的[其他相关帖子](https://stackoverflow.com/questions/339487/login-error-connecting-to-salesforcecom-from-flex)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T03:41:40.840

您最近升级到 Flash Player 10 了吗？Flash player 10 在一定程度上改变了策略文件的工作方式，需要更新 crossdomain.xml 文件来解决这个问题。简而言之，Salesforce.com 可能还没有为用户升级到 Flash Player 10 做好准备。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T03:49:18.137

我正在将文件从 flex 上传到 Google 文档。一切都在本地文件中运行，但是，当我们在 Salesforce（沙盒）中将 SWF 文件作为 S-control 上传时，连接到 Google 时会出现错误。请看下面的错误：

```
Error:[FaultEvent fault=[RPC Fault faultString="Security error accessing url"
faultCode="Channel.Security.Error" faultDetail="Destination: DefaultHTTPS"] 
messageId="1F812836-1318-B845-AC01-F51AB1D11518" type="fault" bubbles=false 
cancelable=true eventPhase=2] 
```

我们尝试了以下解决方案，但似乎没有任何效果： FLEX： - 在 bin-debug 文件夹中添加 crossdomain.xml：以下是跨域策略的内容。

```
<?xml version="1.0"?>
<!DOCTYPE cross-domain-policy SYSTEM "http://www.macromedia.com/xml/dtds/cross-domain-policy.dtd">
<cross-domain-policy>
     <allow-access-from domain="*" secure="false" />
<allow-http-request-headers-from domain="*" headers="*" secure="false" />
</cross-domain-policy> 
```

*   在初始化中使用了 flash.system.security.allowinsecuredomain/allowdomain(“*”)。
*   还尝试将 connection.protocol 设置为 http Salesforce：
*   在远程站点设置中禁用协议安全 o 设置 -> 管理设置 -> 安全控制 -> 远程站点设置  URL：[http ://www.google.com.ph](http://www.google.com.ph)

与 Salesforce 的连接没有问题，但在上传页面初始化时，安全错误将专门出现在 onErrorFault 函数中。以下是代码片段：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" layout="vertical" width="534" height="462" verticalScrollPolicy="off" horizontalScrollPolicy="off"
creationComplete="init()" showCloseButton="true" close="{this.closeWindow(event)}" roundedBottomCorners="true">
<mx:Script>
<![CDATA[

private function init():void{
        Security.allowInsecureDomain("*");
        //<salesforce:Connection id="apex" sendRequest="sendRequestListener(event)" serverUrl="http://www.salesforce.com/services/Soap/u/10.0" protocol="http"/>   
        RESTProxyTest();
        send_data();
        arrAddedFiles = new Array();
        this.uploadGrid.dataProvider= this.acFiles; 
        this.title = "Attachment: "+this.selectedTimeSheetDetail.Project.label;
}

public function RESTProxyTest():void
    {
        _conn = new NetConnection();
        _conn.addEventListener(AsyncErrorEvent.ASYNC_ERROR, doAsyncError);
        _conn.addEventListener(IOErrorEvent.IO_ERROR, doIOError);
        _conn.addEventListener(SecurityErrorEvent.SECURITY_ERROR, doSecurityError);
        _conn.addEventListener(NetStatusEvent.NET_STATUS, doNetStatus);
        _conn.objectEncoding = ObjectEncoding.AMF3;

        _conn.connect(_url);
        _responder = new Responder(onResult, onFault);  

    }

private function send_data():void {
        userRequest.url = getLoginURL();
        userRequest.addEventListener(ResultEvent.RESULT, httpResult);
        userRequest.addEventListener(FaultEvent.FAULT, onErrorFault); 
        userRequest.send();
    } 

private function onErrorFault(obj:FaultEvent):void
    {
        Alert.show("Error:"+obj.toString());
    }

private function httpResult(obj:ResultEvent):void
    {
        trace(obj.toString());

        var result:String = obj.result as String;       
        var pos:int = result.lastIndexOf("Auth=");
        var auth:String = result.substr(pos + 5);
        txtAuth.text = StringUtil.trim(auth);
        placeCall();
    }

protected function placeCall():void
    {
        trace("placeCall");
        var headers:Array = ["Authorization: " + "GoogleLogin auth=" + StringUtil.trim(txtAuth.text)];
        var postVars:Array = [];         
        var uri:String = "http://docs.google.com/feeds/documents/private/full?showfolders=true"; 
        _conn.call("RESTProxy.request", _responder, uri, "get", new Array(), postVars, headers);
    }

private function getLoginURL():String
    {
        var url:String = 'https://www.google.com/accounts/ClientLogin?accountType=HOSTED_OR_GOOGLE&' +
        'Email=' + this.session.config.gmail + '&' +
        'Passwd=' + this.session.config.password + '&service=writely'; 

        return url;
    }   
]]>
</mx:Script>

<mx:HTTPService id="userRequest" useProxy="false" method="POST" contentType="application/x-www-form-urlencoded" showBusyCursor="true"/> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-16T16:30:34.617

我解决了访问 Flash Player 配置面板的问题（我只是在开发环境中推荐它），在“全局安全”选项卡中，选择始终允许。

问候。

# delphi - “出口”命名约定——它是如何工作的？

> ID：307056
> 
> 赞同：0
> 
> 时间：2008-11-20T22:16:27.487
> 
> 标签：delphi, naming-conventions, pe-exports

哪些规则适用于最终出现在 PE（可移植可执行文件）的导出部分的名称？粗略地说，我看到名字以“_”下划线开头，一个“？” 问号或“@”符号。这些是什么意思，名字的其余部分呢？

另外-如何将命名约定反转为更有用的东西？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-20T22:20:43.810

我认为您指的是“dll名称修改”

[名称修改](http://cplus.about.com/gi/dynamic/offsite.htm?zi=1/XJ&sdn=cplus&cdn=compute&tm=4&gps=352_1578_1062_840&f=00&su=p284.9.336.ip_p504.1.336.ip_&tt=2&bt=1&bts=0&zu=http%3A//theory.uwinnipeg.ca/gnu/gcc/gxxint_15.html)

它用于确保导出名称是唯一的

您可以指定一个 .def 文件，以便以后使用

简单地说，.def 文件只是一个包含以下结构的文本文件

```
LIBRARY "MyDll"

EXPORTS
    exportFunction1 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-24T21:55:01.570

另一件事：Jcl 包含另一个非常有用的函数来解码这些符号。你可以在 JclPeImage 中找到它；它被称为 PeUnmangleName - 它是 UndecorateSymbolNameA/W WinAPI 的扩展。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T22:20:32.813

在问这个问题之前，我应该再看一会儿——因为我刚刚找到了答案：

它被称为'name mangling'，这里有一个解释一下它的链接：[http ://en.wikipedia.org/wiki/Name_mangling](http://en.wikipedia.org/wiki/Name_mangling)

很抱歉打扰你；干杯!

# winapi - 使用 CreateFileMapping 在页面文件中分配页面的目的是什么？

> ID：307060
> 
> 赞同：5
> 
> 时间：2008-11-20T22:17:28.217
> 
> 标签：winapi, memory

函数[CreateFileMapping](http://msdn.microsoft.com/en-us/library/aa366537(VS.85).aspx)可用于在页面文件中分配空间（如果第一个参数是`INVALID_HANDLE_VALUE`）。分配的空间稍后可以被内存映射到进程虚拟地址空间。

为什么我要这样做而不是只使用[VirtualAlloc](http://msdn.microsoft.com/en-us/library/aa366887(VS.85).aspx)？

似乎这两个功能几乎都做同样的事情。VirtualAlloc 分配的内存可能会在某些时候被推送到页面文件。为什么我需要一个 API 来专门要求我的页面首先被分配到那里？我为什么要关心我的私人页面的位置？

它只是向操作系统提示我预期的内存使用模式吗？（即，前者暗示更积极地换出这些页面。）

或者它只是在 32 位进程上处理非常大的数据集时的一种方便方法？（即，我可以使用 CreateFileMapping 进行 >4Gb 分配，然后根据需要内存映射更小的空间块。使用页面文件可以节省我手动管理自己的文件集以“交换”到的工作。）

PS。这个问题是由我最近阅读的一篇文章引发的：http: [//blogs.technet.com/markrussinovich/archive/2008/11/17/3155406.aspx](http://blogs.technet.com/markrussinovich/archive/2008/11/17/3155406.aspx)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-20T22:27:25.980

从 CreateFileMappingFunction：

```
A single file mapping object can be shared by multiple processes. 
```

虚拟内存可以跨多个进程共享吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T22:33:26.327

一个原因是在不同进程之间共享内存。不同的进程只知道映射对象的名称就可以通过页面文件进行通信。这比创建真实文件和进行通信更可取。当然，可能还有其他用例。有关详细信息，您可以参考 MSDN 上的[Using a File Mapping for IPC](http://msdn.microsoft.com/en-us/library/aa365574(VS.85).aspx#base.using_a_file_mapping_for_ipc)。

# salesforce - 有谁知道一个好的 salesforce.com SOQL 资源？

> ID：307066
> 
> 赞同：-1
> 
> 时间：2008-11-20T22:18:40.507
> 
> 标签：salesforce, soql

我一直在寻找一份关于 salesforce.com 的 SOQL 查询语言的体面指南和他们的表的架构，但我找不到任何体面的东西。有谁知道我将如何获取文档？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-20T22:34:02.753

我有一本关于这个主题的好书坐在我的办公桌上，不幸的是我现在在家。明天早上（英国）上班后，我将编辑此答案以提供详细信息。

这本书名为[force.com Cookbook](http://wiki.apexdevnet.com/events/cookbook/registration.php)，由 Salesforce 自己出版。它可以在该链接上免费获得。以下是章节标题：

*   入门
*   开发按需应用程序
*   编写 S-Control 的最佳实践
*   编写 Apex 的最佳实践
*   搜索和查询数据
*   提高数据质量
*   自定义按钮和链接
*   自定义 Salesforce 页面和字段
*   与其他服务集成
*   编写 Web 控件和客户端应用程序
*   调试 S-Control 和 Apex
*   为 AppExchange 打包应用程序
*   开始使用 VisualForce

这本书有几十个 SOQL 示例和讨论，实际上有些地方代码太重了。但是我学到了很多好东西。

有关您的特定 Salesforce 架构的原始详细信息（每一个都是自定义的），您应该查看为您生成的 WSDL。我还使用了[这里](http://blogs.salesforce.com/ask_wendy/2007/02/view_your_sfdc_.html)显示的几个应用程序。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-27T18:32:20.493

Salesforce.com Web Services API Docs 包含 SOQL 的参考文档，有很多示例。

[SOQL 参考](http://www.salesforce.com/us/developer/docs/api/index_Left.htm#StartTopic=Content/sforce_api_calls_soql.htm)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-03T17:26:50.183

在我针对 Salesforce API 开发自定义解决方案期间，sforce Explorer 对我在后台破译 Salesforce 数据库表、自定义对象和 SOQL（包括示例）有很大帮助；[http://sforce.sourceforge.net/](http://sforce.sourceforge.net/)

与 SQL Server Enterprise 或较新的 Management Studio 工具相比，它实际上是一个很小的应用程序。它有助于去除很多晦涩难懂的东西。

您将需要 Salesforce 开发人员帐户或具有 API 访问权限（和令牌）的企业帐户才能登录和使用 sforce Explorer

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-19T21:46:14.367

如果您有任何关于 SOQL 的具体问题未在此处得到解答，您可以查看开发人员讨论板，网址为：http: [//community.salesforce.com/sforce ?category.id=developers](http://community.salesforce.com/sforce?category.id=developers)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-03T16:41:03.617

现在“设置” UI 中内置了一个模式浏览器 - 请参阅[http://blogs.developerforce.com/developer-relations/2011/10/an-erd-is-worth-a-thousand-words-schema- builder-in-winter-12.html](http://blogs.developerforce.com/developer-relations/2011/10/an-erd-is-worth-a-thousand-words-schema-builder-in-winter-12.html)。

# ruby - 如何在 Ruby 中生成子进程？

> ID：307070
> 
> 赞同：40
> 
> 时间：2008-11-20T22:19:37.293
> 
> 标签：ruby

我想将主进程中的代码块卸载到子进程以使其同时运行。我还想要生成子进程的 PID，以便在必要时监视并杀死它。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-11-20T22:31:29.453

除了 Chris 的出色回答外，记得打电话`Process.wait`给你的主人以收割你的子进程，否则你会留下僵尸。

评论中要求的示例：

```
pid = Process.fork do
  puts "child, pid #{Process.pid} sleeping..."
  sleep 5
  puts "child exiting"
end

puts "parent, pid #{Process.pid}, waiting on child pid #{pid}"
Process.wait
puts "parent exiting" 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-11-20T22:23:21.170

您可以使用`fork`内核方法。这是一个例子：

```
#!/usr/bin/env ruby
puts "This is the master process."

child_pid = fork do
  puts "This is the child process"
  exit
end

puts "The PID of the child process is #{child_pid}" 
```

该`fork`方法返回它派生的进程的 PID，并执行传递的块中的任何代码。像常规的 Ruby 块一样，它保留了父进程的绑定。

制作你的分叉进程是个好主意`exit`。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-10-07T22:42:31.097

在 1.9 中，您可以使用 Process.spawn 命令。另请参阅[http://en.wikibooks.org/wiki/Ruby_Programming/Running_Multiple_Processes](http://en.wikibooks.org/wiki/Ruby_Programming/Running_Multiple_Processes)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-21T10:08:37.767

如果您乐于使用线程，而不是进程，那么这样的东西*可能*会更适合多个分支：

```
def doit(x)
    sleep(rand(10))
    puts "Done... #{x}"
end

thingstodo = ["a","b","c","d","e","f","g"]
tasklist = []

# Set the threads going

thingstodo.each { |thing|
    task = Thread.new(thing) { |this| doit(this) } 
    tasklist << task
} 

# Wait for the threads to finish

tasklist.each { |task|
    task.join
} 
```

请参阅下面关于 Ruby 执行模型及其限制的 John Topley 的出色评论和参考。

* * *

刚刚编辑以纠正一个明显的错误（没有分配任务），并遵循@（Jason King）的建议。

# java - 使用双重检查习语重置延迟加载的字段

> ID：307073
> 
> 赞同：5
> 
> 时间：2008-11-20T22:20:17.150
> 
> 标签：java, thread-safety, locking, double-checked-locking

考虑“实例字段延迟初始化的双重检查习惯用法”：

> ```
> // Effective Java 中的第 71 条复制自这次对 Bloch 的采访。
> 私有易失性 FieldType 字段；
> 字段类型 getField() {
>     字段类型结果 = 字段；
>     if (result == null) { // 第一次检查（无锁定）
>         同步（这个）{
>             结果=字段；
>             if (result == null) // 第二次检查（带锁）
>                 字段 = 结果 = 计算字段值（）；
>         }
>     }
>      返回结果；
> }
> ```

我希望能够以安全的方式重置该字段（在我的情况下，强制它从数据库中再次加载）。我假设我们可以通过使用重置方法来做到这一点：

> ```
> 无效重置（）{
>    字段=空；
> }
> ```

这是重置字段的标准方法吗？安全吗？有什么陷阱吗？我之所以问，是因为 Bloch 就双重检查延迟加载给出了以下警告：“这个习语非常快，但也很复杂和微妙，所以不要试图以任何方式修改它。只需复制和粘贴——通常不是一个好主意，但在这里很合适。”

提前感谢来自喜马拉雅山的普拉亚。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-20T23:01:17.490

是的，这是线程安全的。

同步块是为了防止多个线程不必要地调用`computeFieldValue()`. 由于`field`是 volatile 的，因此`reset`和中的访问`getField`都是有序的。

如果第一次检查不为空，`getField`则完成；`result`被退回。

否则，将获取锁，不包括可能将该字段设置为非空但允许任何线程设置`field`为空的任何其他线程。如果任何线程确实设置`field`为 null，则不应更改任何内容；这就是使线程进入同步块的条件。如果另一个线程在当前线程检查后已经获得了锁，并将该字段设置为非空值，则第二次检查将检测到这一点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-20T22:37:28.800

我认为这应该是安全的，但这只是因为您将该字段存储在局部变量中。完成此操作后，即使另一个线程在中途重置字段的值，局部变量引用也无法神奇地更改为 null。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T22:55:53.413

只要重置方法是`reset()`上面列出的方法，这似乎就可以工作。但是，如果该`reset()`方法实例化了一个新对象（如下所示），您最终会不会返回与您预期不同的东西？

```
void reset() {
    field = new FieldType();
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T13:06:45.237

我想这取决于线程安全的确切含义。

您最终可能会遇到一种情况，即在一秒钟后使用第一个实例。这可能没问题，也可能不行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-01-23T10:41:31.953

我认为 reset() 方法不正确。如果你阅读第 71 条，你会发现：

> 这段代码可能看起来有点复杂。特别是，对局部变量结果的需求可能不清楚。这个变量的作用是确保该字段 在已经初始化的常见情况下**只读取一次。**

延迟初始化并不认为该**字段**可能会更改。如果这些运算符之间的字段将设置为空：

`FieldType result = field;
if (result == null) { // First check (no locking)`

getField() 提供不正确的结果。

# azure - 有没有办法在中等信任环境中写入内存流？

> ID：307081
> 
> 赞同：0
> 
> 时间：2008-11-20T22:21:33.433
> 
> 标签：azure

我正在开发 Microsoft Azure 的早期版本，但无法写入内存流。不断收到异常。我通过使用不同的技术来解决这个问题来实现我的最终目标，但是我想知道是否有办法做到这一点。鉴于 Azure 是一个共享基础架构，我无法更改安全级别。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T22:25:36.720

写入 MemoryStream 不应该有任何中等信任问题。你怎么写？有什么例外？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T22:05:41.127

I will try to reproduce it. I was doing it on the dev fabric of window's azure. Simply wanted to serialize an object to memory.

# c++ - 清理 STL 列表/指针向量

> ID：307082
> 
> 赞同：50
> 
> 时间：2008-11-20T22:21:51.187
> 
> 标签：c++, list, vector, stl

你能想出的最短的 C++ 块是什么来安全地清理 a `std::vector`or `std::list`of 指针？（假设您必须在指针上调用 delete ？）

```
list<Foo*> foo_list; 
```

我宁愿不使用 Boost 或用智能指针包装我的指针。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-11-20T22:50:23.237

使用`std::list<T*>`：

```
while(!foo.empty()) delete foo.front(), foo.pop_front(); 
```

使用`std::vector<T*>`：

```
while(!bar.empty()) delete bar.back(), bar.pop_back(); 
```

不知道为什么我拿了上面的而`front`不是上面的。我想这是感觉它更快。但实际上两者都是恒定的时间:)。无论如何将其包装成一个函数并玩得开心：`back``std::list`

```
template<typename Container>
void delete_them(Container& c) { while(!c.empty()) delete c.back(), c.pop_back(); } 
```

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2008-11-21T00:06:05.457

既然我们在这里放弃了挑战……“最短的 C++ 块”

```
static bool deleteAll( Foo * theElement ) { delete theElement; return true; }

foo_list . remove_if ( deleteAll ); 
```

我认为我们可以相信提出 STL 的人拥有高效的算法。为什么要重新发明轮子？

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2008-11-20T22:29:59.673

```
for(list<Foo*>::const_iterator it = foo_list.begin(); it != foo_list.end(); ++it)
{
    delete *it;
} 
foo_list.clear(); 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2014-02-12T22:04:31.250

如果你允许 C++11，你可以做一个非常简短的 Douglas Leeder 的回答：

```
for(auto &it:foo_list) delete it; foo_list.clear(); 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-11-20T23:14:26.247

依赖容器外部的代码来删除指针真的很危险。例如，当容器由于抛出异常而被破坏时会发生什么？

我知道你说你不喜欢 boost，但请考虑[boost 指针容器](http://www.boost.org/doc/libs/1_37_0/libs/ptr_container/doc/ptr_container.html)。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-11-20T22:23:46.567

```
template< typename T >
struct delete_ptr : public std::unary_function<T,bool>
{
   bool operator()(T*pT) const { delete pT; return true; }
};

std::for_each(foo_list.begin(), foo_list.end(), delete_ptr<Foo>()); 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-11-20T22:30:26.677

为了简洁起见，我不确定仿函数方法是否会获胜。

```
for( list<Foo*>::iterator i = foo_list.begin(); i != foo_list.end(); ++i )
    delete *i; 
```

不过，我通常会建议不要这样做。通常，将指针包装在智能指针中或使用专门的指针容器会更加健壮。有很多方法可以从列表中删除项目（各种风格的`erase`, `clear`，列表的破坏，通过迭代器分配到列表中，等等）。你能保证全部抓到吗？

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-04-30T11:33:49.770

当您的列表使用 RAII 超出范围或调用 list::clear() 时，以下 hack 将删除指针。

```
template <typename T>
class Deleter {
public:
  Deleter(T* pointer) : pointer_(pointer) { }
  Deleter(const Deleter& deleter) {
    Deleter* d = const_cast<Deleter*>(&deleter);
    pointer_ = d->pointer_;
    d->pointer_ = 0;
  }
  ~Deleter() { delete pointer_; }
  T* pointer_;
}; 
```

例子：

```
std::list<Deleter<Foo> > foo_list;
foo_list.push_back(new Foo());
foo_list.clear(); 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-11-20T23:19:01.323

至少对于一个列表，迭代和删除，然后在最后调用 clear 有点无效，因为它涉及遍历列表两次，而实际上只需要执行一次。这是一个更好的方法：

```
for (list<Foo*>::iterator i = foo_list.begin(), e = foo_list.end(); i != e; )
{
    list<Foo*>::iterator tmp(i++);
    delete *tmp;
    foo_list.erase(tmp);
} 
```

也就是说，您的编译器可能足够聪明，可以循环组合两者，这取决于 list::clear 的实现方式。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2010-04-19T20:34:30.303

[实际上，我相信 STD 库以分配器类](http://www.cplusplus.com/reference/std/memory/allocator/)的形式提供了一种直接管理内存的方法

您可以扩展基本分配器的 deallocate() 方法以自动删除任何容器的成员。

我/认为/这是它的用途类型。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2014-04-10T06:32:46.813

```
for(list<Foo*>::const_iterator it = foo_list.begin(); it != foo_list.end(); it++)
{
    delete *it;
} 
foo_list.clear(); 
```

您不想这样做有一个小原因 - 您实际上是在列表上迭代两次。

std::list<>::clear 的复杂度是线性的；它在循环中一次删除和销毁一个元素。

考虑到上述情况，我认为最简单易读的解决方案是：

```
while(!foo_list.empty())
{
    delete foo_list.front();
    foo_list.pop_front();
} 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2014-09-16T11:30:16.510

从 C++11 开始：

```
std::vector<Type*> v;
...
std::for_each(v.begin(), v.end(), std::default_delete<Type>()); 
```

或者，如果您正在编写模板代码并希望避免指定具体类型：

```
std::for_each(v.begin(), v.end(),
    std::default_delete<std::remove_pointer<decltype(v)::value_type>::type>()); 
```

其中（C++14 起）可以缩写为：

```
std::for_each(v.begin(), v.end(),
    std::default_delete<std::remove_pointer_t<decltype(v)::value_type>>()); 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-12-05T16:01:55.640

```
void remove(Foo* foo) { delete foo; }
....
for_each( foo_list.begin(), foo_list.end(), remove ); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-20T22:30:30.670

```
for (list<Foo*>::const_iterator i = foo_list.begin(), e = foo_list.end(); i != e; ++i)
    delete *i;
foo_list.clear(); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-07-02T18:53:04.227

这似乎是最干净的 imo，但是您的 c++ 版本必须支持这种类型的迭代（我相信包括或在 c++0x 之前的任何东西都可以使用）：

```
for (Object *i : container) delete i;    
container.clear(); 
```

# javascript - 使用 JavaScript 以编程方式将光标从一页移动到另一页

> ID：307083
> 
> 赞同：1
> 
> 时间：2008-11-20T22:22:03.560
> 
> 标签：javascript, focus, mouse, move

我在屏幕上有 2 个页面（实际上更多，因为它是一种带有几帧的专有 Web 应用程序，我实际上无法弄清楚整个结构）

我在页面中输入搜索条件，按键盘上的“Enter”，执行搜索，另一个视图填充数据。在第二个视图上有一个“确认”按钮，用户必须单击它。

我希望用户按键盘上的“Enter”并执行“确认”。

如果我单击第二个视图上的一个字段并按“Enter”，则会执行“确认”，因此只需将鼠标的焦点从第一页移动到另一页。

我怎样才能以编程方式实现这一目标？

我试过以下

```
<SCRIPT FOR=window event=onload language="JScript">
    var focusField = "<%= controller->component_id %>" + '_' + 'NUMBER';
    document.getElementById(focusField).focus();
</SCRIPT> 
```

光标仍在第一页的输入字段中。

```
<SCRIPT FOR=window event=onload language="JScript">
    var focusField = "<%= controller->component_id %>" + '_' + 'NUMBER';
    alert(document.getElementById(focusField).value);
    document.getElementById(focusField).focus();
</SCRIPT> 
```

显示该字段的值，以便代码通过那里

光标仍在第一页的输入字段中

```
<SCRIPT FOR=window event=onload language="JScript">
    var focusField = "<%= controller->component_id %>" + '_' + 'NUMBER';
    document.getElementById(focusField).focus();
    alert('1');
    alert('2');
</SCRIPT> 
```

光标仍在第一页的输入字段中

```
<SCRIPT FOR=window event=onload language="JScript">
    var focusField = "<%= controller->component_id %>" + '_' + 'NUMBER';
    alert('1');
    document.getElementById(focusField).focus();
    alert('2');
</SCRIPT> 
```

并且光标以某种方式“奇迹般地”“移出”输入字段并且“Enter”在第二页上起作用！

为什么 ？

当然，这不是一个解决方案，但我想知道为什么使用警报（但 2 不是 1）可以达到我移动鼠标焦点的目的。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T00:29:35.673

我找到了让它工作的方法

```
<SCRIPT FOR=window event=onload language="JScript">

function setFocus()
    {
    var focusField = "<%= controller->component_id %>" + '_' + 'CUSTOMER_STRUCT.BP_NUMBER';
    document.getElementById(focusField).focus();
    }

  window.setTimeout('setFocus()', 40);//1,10,20,30 do not work

</SCRIPT> 
```

对此有何解释？

它适用于我的桌面。难道它不能在其他工作站上工作（即间隔必须更高）？

# .net-3.5 - System.Speech.Synthesis 安装备用语言声音

> ID：307084
> 
> 赞同：3
> 
> 时间：2008-11-20T22:22:21.577
> 
> 标签：.net-3.5, text-to-speech, sapi

.net framework 3.5（或 vista）为我提供了与 Speech.Synthesis api 一起使用的英语语音（我认为是 David）。我需要一个法语语音才能与我正在为我的孩子构建的法语听写练习应用程序一起使用，以提高他们的法语拼写。该 api 允许我在创建语音时更改文化，但默认的英语语音无法正确发音法语单词。

我一直无法找到从 Microsoft 下载法语语音的任何方法。这可能吗？我确实从 Cepstral 下载了一个 Demo 商业声音，但它被削弱了，使其无法使用（即使用于测试）。我不想买任何东西，因为这个练习只是为了好玩。

我曾希望无需求助于商业专业声音就可以轻松获得替代语言的声音。有没有免费的替代品？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-06-30T17:38:50.407

不幸的是，没有免费的法语 SAPI 5 兼容语音。[Microsoft](http://activex.microsoft.com/activex/controls/agent2/lhttsfrf.exe)提供了一个兼容法语 SAPI 4 的语音（从 L&H 获得许可），但它不适用于 .NET 框架。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-10-04T09:36:48.427

我从来没有尝试过，但我发现了这个：[http ://espeak.sourceforge.net/](http://espeak.sourceforge.net/)

希望它会有所帮助

# php - PHP编码标准

> ID：307089
> 
> 赞同：10
> 
> 时间：2008-11-20T22:23:24.413
> 
> 标签：php, coding-style

我一直在寻找一些关于如何布局 PHP 代码的指南。我找到了一些很好的参考资料，例如：

[http://www.dagbladet.no/development/phpcodingstandard/](http://www.dagbladet.no/development/phpcodingstandard/)

[这个](https://stackoverflow.com/questions/5214/whats-a-good-standard-code-layout-for-a-php-application)关于SO的问题。

然而，这些都没有完全解决我特别想知道的问题，即 HTML 和 PHP 的集成。例如：

1.  是否可以有一个以 HTML 标记开头并且只在需要的地方插入 PHP 的 PHP 文件？或者你应该只有一段包含所有内容的 PHP 代码？
2.  如果你有一段 PHP 代码，中间是一组`echo`'s，只输出固定的 HTML 位，那么脱离 PHP 并直接放入 HTML 会更好吗？
3.  函数应该全部定义在专用的 PHP 文件中，还是可以在文件顶部定义一堆函数并稍后在同一个文件中调用它们？

可能还有其他问题我想问，但实际上我正在寻找某人向我指出某种在线资源，该资源提供有关如何将 HTML 和 PHP 组合在一起的一般概念的指导。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-20T22:28:53.763

结合编程代码和输出数据（包括 HTML）恕我直言是一个非常糟糕的主意。我认识的大多数 PHP 大师都使用[Smarty](http://www.smarty.net/)之类的模板引擎来帮助将两者分开。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-20T22:40:29.653

这些东西真的没有一个单一的通用标准。从这个意义上说，大多数语言比 PHP 更具限制性。

在后来的几年中，出现了许多所谓的框架，其中包括为从命名到放置文件的位置以及代码应遵循的样式等所有内容定义一组规则。周围有几个框架，所以你不能真正选择一个并将其称为标准。然而，大多数框架都有一个共性子集。例如，大多数遵循[PEAR 编码标准](http://pear.php.net/manual/en/standards.php)的一些变体。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-20T22:42:12.300

我通常会尝试遵循语言核心库设置的标准....哦等等。

认真地通过 - 您应该尝试在任何 Web 应用程序中遵循[MVC 模式](http://en.wikipedia.org/wiki/Model-view-controller)，因为无论语言如何，它都是非常标准的做法。在 PHP 中，这可以通过将`index.php`其视为您的控制器并按文件分离数据逻辑和表示以一种快速而简单的方式来实现。这个小步骤至少可以让您在选择时将代码移动到功能齐全的框架中。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-20T22:42:36.933

尽可能使用模板引擎。如果您还没有学习过，或者不想要开销（这是最小的），请使用导致您拥有快速而肮脏的模板的做法：

*   不显示任何内容的函数在显示内容的文件中没有位置。
*   打印变量，而不是 HTML。每当输出 HTML 时，跳出 PHP 并使用打印语句编写 HTML 以处理所需的任何小细节（表单的操作、控件的 ID 等）。
*   请记住，当您包含一个打破 PHP 以打印内容的文件时，将被视为与您在主文件中执行此操作相同。因此，您可以创建仅包含 PHP 文件的简单模板，这些文件将在正确的位置打印变量。您的 index.php（或其他）完成所有实际工作，但所有显示均由辅助“模板”完成。

许多 PHP 教程混合了逻辑和显示代码。我花了好几年的时间才改掉鼓励我的坏习惯。根据我的经验，你不能在 PHP 中过多地分离事物，如果你不反对它，熵会将你拉向混合代码。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-08-11T20:05:45.820

编码标准应该不仅仅是如何布局你的语法，但遗憾的是它们在 PHP 中往往是这样的。

FWIW，[phc](http://phpcompiler.org)将以 Zend 样式漂亮地打印您的代码。

# c# - 加入共享一个公共列但没有外键的 NHibernate 类

> ID：307094
> 
> 赞同：1
> 
> 时间：2008-11-20T22:24:16.253
> 
> 标签：c#, nhibernate, nhibernate-mapping

我有几个表要映射到类。表格如下所示：

```
Asset
---------
AssetId
AssetName

Product
---------
ProductId
ProductName
AssetId

Disposal
---------
DisposalId
AssetId
DisposalDate 
```

基本上我想要做的是将 Product Table 加入 AssetId 上的 Disposal 表，以便我的 Product 具有由资产连接的 Disposal 集合。我已经定义了以下映射，但 NHibernate (1.2) 似乎忽略了包中定义的键列，并选择通过 ProductId 将 Product 表连接到 Disposal 表（即 Product.ProductId = Disposal.AssetId）。我不确定这是否是一个错误，或者我是否没有正确定义它，但如果有人有办法做到这一点，我会非常感激。

```
 <class name="Product" table="Product" lazy="false">
    <id name="ProductId" column="ProductId" type="int">
      <generator class="native" />
    </id>
    <property name="ProductName" column="ProductName"/>
    <bag name="Disposals" fetch="join" >
      <key column="AssetId" foreign-key="AssetId/>
      <many-to-many class="Disposal"/>
    </bag>
  </class> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T16:13:39.730

您是否已将您的处置映射到产品？

您的架构并不唯一地将处置与产品相关联。处置只能与资产相关，而不能与产品相关。

您的架构对我说，资产有很多产品，而资产有很多处置。没有什么说处置是针对特定产品的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T08:11:31.377

干净的方式：

```
 <class name="Product" table="Product" lazy="false">
    <id name="ProductId" column="ProductId" type="int">
      <generator class="native" />
    </id>
    <property name="ProductName" column="ProductName"/>
    <many-to-one name name="Asset" class="Asset" column="AssetId" />
  </class>

  <class name="Asset">
    <id name="AssetId" >
      <generator class="native" />
    </id>
    <property name="AssetName" />
    <bag name="Disposals">
      <key column="AssetId" />
      <many-to-many class="Disposal" />
    </bag>
  </class> 
```

foreign-key 用于 DDL，我认为是 schema 导出生成的外键约束的名称。

您可以尝试 property-ref，但不完全确定它是否有效：

```
 <class name="Product" table="Product" lazy="false">
    <id name="ProductId" column="ProductId" type="int">
      <generator class="native" />
    </id>
    <property name="ProductName" column="ProductName"/>
    <property name="AssetId" />
    <bag name="Disposals" fetch="join" >
      <key column="AssetId" property-ref="AssetId/>
      <one-to-many class="Disposal"/>
    </bag>
  </class> 
```

# css - 将两个表格列中的内容保留在相应表格列的顶部

> ID：307096
> 
> 赞同：0
> 
> 时间：2008-11-20T22:24:22.477
> 
> 标签：css

在基于 CSS 的布局中使用表格时，我注意到如果我有一个有 4 列的表格（侧面 2 列用于间距小，中间 2 列用于内容），当我在两者之一中键入内容时中间的列，它会留在顶部，这是完美的。

但是，如果我在另一个中间列中键入内容，然后按回车，则另一个中间内容中的内容会下降。

这意味着我永远不能在两列中键入内容，同时将两列中的内容粘在表格列的顶部（屋顶）。我已经尝试了一切，有没有办法可以做到这一点？如果我不能这样做，我的内容看起来很不稳定，因为它在两列中不水平，因此不专业。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T22:49:21.663

我相信解决方案是创建一个将文本与表格单元格顶部对齐的规则。

```
td {
  vertical-align:top;
} 
```

作为替代方案，您可以使用列组和列来指定不同列的垂直对齐方式。一个例子：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Table Columns Alignments</title>
</head>

<body>
    <table>
        <colgroup>
            <col valign="bottom"/>
            <col />
            <col valign="top"/>
        </colgroup>
        <tbody>
            <tr>
                <td>aligned to bottom</td>
                <td>no special<br/>alignment<br/><p>here</p></td>
                <td>aligned to top</td>
            </tr>
        </tbody>
    </table>
</body>
</html> 
```

但是，浏览器对此的支持并不是全面的，所以 YMMV。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T22:27:20.943

我不确定我是否完全理解了这个问题，但你可以看看[vertical-align css property](http://www.w3schools.com/Css/pr_pos_vertical-align.asp)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T23:02:20.513

由于无论如何您都在使用表格进行布局，这有点邪恶，但有时是必要的，而且通常更快更便宜，那么在表格单元格标记中设置 valign="top" 怎么样？

这不是一个 CSS 解决方案，而是从过去糟糕的表格布局中经过验证的方法。

# asp.net - “不支持关键字：” ASP .NET 中的错误

> ID：307098
> 
> 赞同：11
> 
> 时间：2008-11-20T22:24:40.463
> 
> 标签：asp.net, ado.net

我得到一个不支持的关键字：'192.168.1.1;initial catalog'。尝试执行此操作时出错

`Dim cn As New SqlConnection(str)`

其中 str 是以 '192.168.1.1;initial catalog' 开头的连接字符串 ...我没有在连接字符串中指定提供程序

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-20T22:28:41.063

您需要提供格式正确的连接字符串，例如：

```
Dim str As String
str = "Data Source=myServerAddress;Initial Catalog=myDataBase;User Id=myUsername;Password=myPassword;"

Dim cn As New SqlConnection(str) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-20T22:29:08.880

您必须使用关键字“数据源”或“服务器”指定数据库。这是一个例子：

```
Data Source=myServerAddress;Initial Catalog=myDataBase;Integrated Security=SSPI; 
```

# visual-studio-2008 - Visual Studio Shell 和 F#（无效许可证）

> ID：307113
> 
> 赞同：2
> 
> 时间：2008-11-20T22:28:26.540
> 
> 标签：visual-studio-2008, f#, visual-studio-shell

有没有人有安装**Visual Studio 隔离 Shell**并将其与***F#***一起使用的经验？

它安装成功，但是当我单击**devenv.exe**时，它​​会打开 VS，但给我错误*"Invalid License Data. Reinstall is required"*。我已经这样做了很多次，但无济于事。

谷歌搜索这个问题，我发现**devenv.exe**不应该直接在这种隔离模式下工作，而是应该有另一个以 VS Shell 为目标的自定义可执行文件。这对于我下载并运行良好的**IronPython** **Studio**来说似乎是正确的。

***但是，我不敢相信F#***没有类似的东西。非常感谢您对此事的任何意见。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-20T22:32:06.283

F# 需要 VS*集成*Shell。

也可以看看

[https://stackoverflow.com/questions/196765/what-is-the-minimum-list-of-tools-required-to-work-on-f-does-express-edition-wo](https://stackoverflow.com/questions/196765/what-is-the-minimum-list-of-tools-required-to-work-on-f-does-express-edition-wo)

# linux - 如何在 Bash 中导出变量

> ID：307120
> 
> 赞同：10
> 
> 时间：2008-11-20T22:29:12.313
> 
> 标签：linux, bash, sysadmin

我需要从当前范围之外可用的 Bash 脚本设置系统环境变量。所以你通常会像这样导出环境变量：

```
export MY_VAR=/opt/my_var 
```

但是我需要环境变量在系统级别可用。这可能吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-20T22:37:57.207

不是真的——一旦你在子进程中运行，你就不能影响你的父进程。

有两种可能：

1.  获取脚本而不是运行它（参见[source](https://en.wikipedia.org/wiki/Dot_(command)#Source) [.](http://www.gnu.org/software/bash/manual/bashref.html#Bourne-Shell-Builtins)）：

    ```
    source {script} 
    ```

2.  让脚本输出导出命令，并评估：

    ```
    eval `bash {script}` 
    ```

    *或者*：

    ```
    eval "$(bash script.sh)" 
    ```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-20T22:55:01.823

这是我知道做你想做的唯一方法：

在 foo.sh 中，你有：

```
#!/bin/bash
echo MYVAR=abc123 
```

而当你想获取变量的值时，你必须执行以下操作：

```
$ eval "$(foo.sh)"  # assuming foo.sh is in your $PATH
$ echo $MYVAR #==> abc123 
```

根据您想做什么以及如何做，可以使用[Douglas Leeder](https://stackoverflow.com/questions/307120/how-to-export-a-variable-in-bash/307145#307145)关于使用[source](https://en.wikipedia.org/wiki/Dot_(command)#Source)的建议，但它将获取整个文件、函数和所有内容。使用 eval，只会评估得到回显的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T00:29:47.217

*在文件/etc/profile*中设置变量（如果需要，创建文件）。这实际上将使该变量可用于每个 Bash 进程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-06-17T17:24:54.350

当我在该`root`帐户下工作并希望例如在运行 X 的普通用户下打开 X 可执行文件时。
我需要设置`DISPLAY`环境变量...

```
env -i DISPLAY=:0 prog_that_need_xwindows arg1 arg2 
```

# sql - 您可以在表格用户定义的函数中使用 WITH 语句吗

> ID：307122
> 
> 赞同：2
> 
> 时间：2008-11-20T22:30:00.547
> 
> 标签：sql, sql-server-2005, tsql

我有以下 UDF 代码，但消息出错：

> 消息 156，级别 15，状态 1，过程 CalendarTable，第 39 行关键字“OPTION”附近的语法不正确。

是因为我的 WITH 语句，因为我可以在存储过程中运行相同的代码吗？

```
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:      Anthony Main
-- Create date: 18/11/08
-- Description: Produce Table of Dates for Month
-- =============================================
CREATE FUNCTION CalendarTable
(   
    @StartDate DATETIME,
    @EndDate DATETIME
)
RETURNS TABLE 
AS
RETURN 
(
    with    MyCalendar as
            (
            select  cast(@StartDate as datetime) DateValue
            union   all
            select  DateValue + 1
            from    MyCalendar   
            where   DateValue + 1 <= @EndDate
            )

    select  DateValue
    ,       datepart(dy, DateValue) [day of year]
    ,       datename(dw, DateValue) [day]
    ,       datepart(dw, DateValue-1) [day of week]
    ,       datepart(dd, DateValue) [day of month]
    ,       datepart(ww, DateValue) [week]
    ,       datepart(mm, DateValue) [month]
    ,       datename(mm, DateValue) [month]
    ,       datepart(qq, DateValue) [quarter]
    ,       datepart(yy, DateValue) [year]
    ,       datepart(HH, DateValue) [HOUR]
    ,       datepart(MI, DateValue) [MIN]
    ,       datepart(SS, DateValue) [SEC]
    ,       datepart(MS, DateValue) [MILLISECOND]
    from    MyCalendar
    OPTION  (MAXRECURSION 0)
)
GO 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T00:25:40.423

据我所知，UDF 中不允许使用 OPTION MAXRECURSION。[connect.microsoft.com](http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=124653)上有一个 与该问题相关的项目。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-26T02:09:08.653

不，您不能使用 OPTION 关键字。

来自文档：“MAXRECURSION 可用于防止格式不正确的递归 CTE 进入无限循环。以下示例有意创建无限循环并使用 MAXRECURSION 提示将递归级别的数量限制为两个。”

如果您解释要查询的内容（您希望最终结果是什么样的），我们可以编写一个不需要递归的更好的 SQL 语句。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T22:42:22.223

你在这里缺少一个右括号吗？（"AS RETURN (" 的右括号

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T02:13:58.923

您不能在 UDF 中使用 OPTION。此外，由于 UDF 通常被大量调用，因此使用 Numbers 表生成日期范围可能更有意义（您在表中放入几千个数字 - 例如从 1 到 1,000,000）并生成日期范围表在UDF中。

这是使用此类实用程序表（通常称为数字表或数据透视表）的[一组良好技术的链接。](http://web.archive.org/web/20150411042510/http://sqlserver2000.databases.aspfaq.com/why-should-i-consider-using-an-auxiliary-numbers-table.html)

# objective-c - 如何将 id 转换为浮点数？

> ID：307128
> 
> 赞同：17
> 
> 时间：2008-11-20T22:31:33.773
> 
> 标签：objective-c, macos, casting

我在使用此代码时遇到问题：

```
NSRect itemFrame;
id item;
// code to assign item goes here.
itemFrame.origin.y -= [item respondsToSelector:@selector(selectedHeight)] ? [item selectedHeight]   : [self defaultSelectedHeight]; 
```

这是有问题的位：

```
[item selectedHeight] 
```

编译器假设返回类型是 id。我虽然添加演员可以解决这个问题：

```
(float)[item selectedHeight] 
```

但它不起作用。

我究竟做错了什么？（我怀疑问题与解析与 id 相关的指针有关，但我找不到任何相关文档）。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-11-20T22:38:18.767

你想要`[[item selectedHeight] floatValue]`，假设 selectedHeight 返回一个`NSNumber`.

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-10-19T14:53:58.043

我知道下面的代码适用于 iOS 6 SDK。我假设**obj**对象包含一个浮点值。

```
id obj;
float fVal;

fVal = [obj floatValue]; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T22:38:10.280

您需要查看`selectedHeight`方法的声明。问题是该方法返回了一个指向对象（id）的指针，或者您没有`item`在包含代码片段的文件中导入头文件，因此 Xcode 默认假定它是一个指针。

您不能将指针强制转换为浮点数，因为它们基本上是不兼容的类型。一旦你把你的声明理顺了，虽然你应该没问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-20T22:39:10.763

当多个类声明具有相同名称的方法时，编译器会做出这种假设，这些方法返回不同的类型。由于您的“item”变量被键入为“id”，编译器不知道它将在运行时将消息发送到这些类中的哪一个，并选择一个。

为避免此问题，您可以通过使用特定类型而不是通用“id”声明它来通知编译器“item”是哪个类的实例：

```
SomeItemClass *item; 
```

您也可以通过不声明返回不同类型的同名方法来避免它。

# regex - 我需要一个正则表达式来匹配一般 URL

> ID：307141
> 
> 赞同：0
> 
> 时间：2008-11-20T22:36:38.210
> 
> 标签：regex, url, string-matching

我需要使用任何协议（http、https、shttp、ftp、svn、mysql 和我不知道的东西）测试通用 URL。

我的第一关是这样的：

```
\w+://(\w+\.)+[\w+](/[\w]+)(\?[-A-Z0-9+&@#/%=~_|!:,.;]*)? 
```

（[PCRE](http://perldoc.perl.org/perlre.html)和[.NET](http://msdn.microsoft.com/en-us/library/hs600312.aspx)所以没什么可看中的）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-20T22:48:46.157

根据[RFC2396](http://www.faqs.org/rfcs/rfc2396.html)：

```
^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))? 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-20T22:37:17.180

将该 RegEx 添加为 wiki 答案：

```
[\w+-]+://([a-zA-Z0-9]+\.)+[[a-zA-Z0-9]+](/[%\w]+)(\?[-A-Z0-9+&@#/%=~_|!:,.;]*)? 
```

选项 2（重新 CMS）

```
^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))? 
```

但这对于任何理智的东西来说都是松懈的，以使其更具限制性并与其他事物区分开来。

```
proto      ://  name      : pass      @  server    :port      /path     ? args
^([^:/?#]+)://(([^/?#@:]+(:[^/?#@:]+)?@)?[^/?#@:]+(:[0-9]+)?)(/[^?#]*)(\?([^#]*))? 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-03-29T18:13:25.907

我是从一个稍微不同的方向来的。我想模拟 gchats 匹配`something.co.uk`和链接它的能力。所以我使用了一个正则表达式，它查找 a`.`没有后面的句点或两边的空格，然后抓住它周围的所有东西，直到它碰到空格。它确实匹配 URI 末尾的句点，但我稍后会取消它。因此，如果您更喜欢误报而不是错过一些潜力，这可能是一个选择

```
url_re = re.compile(r"""
           [^\s]             # not whitespace
           [a-zA-Z0-9:/\-]+  # the protocol and domain name
           \.(?!\.)          # A literal '.' not followed by another
           [\w\-\./\?=&%~#]+ # country and path components
           [^\s]             # not whitespace""", re.VERBOSE) 

url_re.findall('http://thereisnothing.com/a/path adn some text www.google.com/?=query#%20 https://somewhere.com other-countries.co.nz. ellipsis... is also a great place to buy. But try text-hello.com ftp://something.com')

['http://thereisnothing.com/a/path',
 'www.google.com/?=query#%20',
 'https://somewhere.com',
 'other-countries.co.nz.',
 'text-hello.com',
 'ftp://something.com'] 
```

# performance - Vim 滚动缓慢

> ID：307148
> 
> 赞同：48
> 
> 时间：2008-11-20T22:38:36.647
> 
> 标签：performance, vim, scroll

当我滚动时，Vim 动作缓慢。当我连续按 j/k 时，光标会跳过一些行。

我正在使用 xterm 和 urxvt。在这两个 vim 中都是这样的。

这发生在本地，无论是小文件还是大文件。我确实使用 Control + F/B 他们工作得很好。

编辑：小文件中的 ttyfast 起到了作用，但在更大的文件中是一样的。在没有自定义的情况下运行时一切正常。

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2008-12-18T19:42:02.967

[`:set lazyredraw`](https://vimhelp.org/options.txt.html#%27lazyredraw%27)将缓冲屏幕更新而不是一直更新。我通常在进行复杂的宏播放时启用它。在这里可能会帮助你。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-11-20T22:45:21.203

您是否尝试过“ttyfast”选项？看：

```
:help 'ttyfast' 
```

寻求帮助，并且：

```
:set ttyfast 
```

启用它。

另外，你用的是什么版本？您是否在没有自定义的情况下尝试过此操作，以查看您设置的内容是否存在干扰？

像这样运行它以省略任何 vimrc 设置和插件：

```
vim -u NONE 
```

编辑：如果删除自定义修复它。迭代地删除事物，直到行为返回。首先将其缩小到 vimrc 问题或插件。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2015-12-03T20:09:24.927

只有在使用带有 syntastic 的 pylint.vim 插件时，我才会遇到这个问题。我能找到的唯一有用的（除了禁用语法检查器）是禁用突出显示当前行：

```
:set cul! 
```

这大大加快了我的滚动速度。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2015-12-08T15:09:03.377

### Vim 上的正则表达式重新计算错误

根据您使用的 Vim 版本，您可能会受到正则表达式重新计算错误的影响，其主要罪魁祸首似乎是突出显示光标行并显示相对行号：

```
set relativenumber
set cursorline 
```

网络上到处都是报告此问题的线程（[此处](https://github.com/chrishunt/dot-files/issues/5)、[此处](https://github.com/vim/vim/issues/282)和[此处](https://github.com/vim-ruby/vim-ruby/issues/243)）。如果还使用语法高亮，这个问题似乎会更加严重。

就我个人而言，我只是`relativenumber`通过将其添加到我的 vimrc 来禁用我的缓慢滚动问题：

```
set number 
```

* * *

### 我的 Vim

我的 Vim 是 Debian 7.9 上的 vim-nox 软件包版本 2:7.3.547-7 提供的。`:version`在 Vim 中键入会产生：

> VIM - Vi IMproved 7.4（2013 年 8 月 10 日，2014 年 12 月 11 日 03:17:52 编译）
> 
> 包含的补丁：1-488

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-04-11T17:30:40.473

如果其他建议不起作用，则可能是您的终端有问题。我在 Ubuntu 上的 gnome-terminal 滚动速度比使用相同文件的 PuTTY 慢得多。

如果您使用的是 Ubuntu 的默认 gnome-terminal，您可能需要尝试另一个终端程序。urxvt 都为我工作（终结者有类似的问题）：

```
$ sudo apt-get install rxvt-unicode
$ urxvt 
```

主要的缺点是它看起来不太好。你可以试试[这里](http://www.saltycrane.com/blog/2009/11/how-make-urxvt-look-gnome-terminal/)的建议让它看起来更好一点

参考：

*   [带有大型终端的 Vim 中的慢速选项卡切换](https://stackoverflow.com/questions/2864084/slow-tab-switching-in-vim-with-large-terminal)
*   [GNOME 3 中的 GNOME 终端非常慢 [AskUbuntu]](https://askubuntu.com/questions/71664/the-gnome-terminal-is-very-slow-in-gnome-3)

编辑：似乎对我来说真正的解决方案可能是在使用 vim 时停止全屏显示我的终端。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2021-05-19T03:45:13.590

迟到的答案，但以上并没有帮助我。

首先，找出确切的问题是什么，而不是胡乱地禁用随机的东西。Vim 有一个超级漂亮的分析器。

```
:help prof 
```

会让你开始，但我做到了

```
:prof start ~/vim_profile
:prof func *
:prof file * 
```

然后做了一堆超级慢的滚动。然后，

```
:prof exit 
```

然后，您可以查看 vim_profile 并确切了解问题所在。在我的情况下，这是我通过添加修复的 matchparen

```
set noshowmatch 
```

到 .vimrc，但对你来说可能会有所不同。

顺便说一句，在我对 vim 本身进行了调整之后，我能够通过使用不同的终端（iTerm2 或 Alacritty）而不是内置终端来进一步提高性能。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-04-17T22:40:59.277

禁用括号突出显示后，我的滚动已修复。在 ~/.vimrc 中放：

```
let loaded_matchparen = 1 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-03-05T15:46:37.750

还要检查您的静默映射。`j`如果您有以, `k`,开头的映射`h`，`l`那么这也可能导致暂时滞后。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-12-28T01:18:31.403

我在 Raspberry Pi 1 上运行 vim。禁用这一行加快了我的速度：

```
set foldmethod=syntax  "slow! 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-10-13T18:25:24.907

我带着类似的滚动问题来到这里。我真的不想完全关闭语法高亮，所以我禁用了“set cursorcolumn”和“set cursorline”，我的滚动变得更快了。

# sql - 通过在 ms-sql 中的表中添加一个名为 recordversion 的时间戳列，我可以获得什么？

> ID：307152
> 
> 赞同：1
> 
> 时间：2008-11-20T22:40:32.913
> 
> 标签：sql, sql-server, tsql, timestamp

通过在 ms-sql 中的表中添加一个名为 recordversion 的时间戳列，我可以获得什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-20T22:45:12.310

您可以使用该列来确保您的用户不会覆盖其他用户的数据。

假设用户 A 拉起记录 1，同时用户 B 拉起记录 1。用户 A 编辑记录并保存它。5 分钟后，用户 B 编辑记录 - 但不知道用户 A 的更改。当他保存他的更改时，您在 update where 子句中使用 recordversion 列，这将防止用户 B 覆盖用户 A 所做的事情。您可以检测到这种无效条件并抛出某种数据过期错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T22:44:32.640

没有什么我知道的，或者谷歌似乎很快就能找到。

通过使用该名称作为列，您不会获得任何固有的东西。当然，您可以创建一个列并按照下一个响应中的说明进行记录版本控制，但列名没有什么特别之处。您可以随意调用该列并进行版本控制，并且您可以调用任何列 RecordVersion 并且不会发生任何特殊情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T23:15:52.013

另外，请记住，如果您想跟踪数据，最好将这四列添加到每个表中：

```
CreatedBy(varchar) | CreatedOn(date) | ModifiedBy(varchar) | ModifiedOn(date) 
```

虽然它不会为您提供完整的历史记录，但它可以让您知道创建条目的人员和时间，以及上次修改条目的人员和时间。这 4 列创建了非常强大的跟踪能力，而不会给您的数据库带来任何严重的开销。

显然，您可以创建一个完整的日志记录系统来跟踪每个更改并为您提供完整的历史记录，但这不是我认为您提出的问题的解决方案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-25T18:56:51.163

时间戳主要用于复制。我还成功地使用它来确定自上次向客户端提要以来数据是否已更新（当我需要发送增量提要时），因此仅挑选出自那时以来已更改的记录。这确实需要在您运行报告时使用另一个表来存储时间戳的值（在 varbinary 字段中），以便您可以在下次运行时使用它进行比较。

如果您认为时间戳记录了上次更新的日期或时间，它不会这样做，您需要 dateTime 字段和约束（获取原始日期时间）和触发器（更新）来存储该信息。

# .net - 在数据库中维护与客户端软件枚举匹配的 id

> ID：307160
> 
> 赞同：2
> 
> 时间：2008-11-20T22:41:52.957
> 
> 标签：.net, sql-server

假设我在一个名为 TransactionType 的 sql server 2000 数据库中有一个表：

```
CREATE TABLE [dbo].[TransactionType](
    [ID] [int] NOT NULL,
    [Description] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
 CONSTRAINT [PK_TransactionType] PRIMARY KEY CLUSTERED 
(
    [ID] ASC
) ON [PRIMARY]
) ON [PRIMARY] 
```

然后，我有一个事务表，其中有一列名为 TransactionTypeID，与 TransactionType 表的 ID 列无关。

我的 .net 客户端应用程序负责插入事务记录并指定事务类型。我的第一个想法是定义一个枚举，将枚举转换为整数并将该值传递给数据库。问题在于，有人可能会进入数据库并更改 TransactionType 表中的一个 ID，从而使数据库中的 ID 与客户端应用程序枚举中的 ID 不同步。

所以，在我冗长的解释之后，我的问题是，是否有其他人用来解决这个问题的设计模式/技术？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T23:08:03.527

您可能会考虑使用与子表松散绑定（未强制执行）的编码系统。假设它是一种颜色，您的子表可能如下所示。

```
ID  | Name
------------
GRN | Green
PURP| Purple
YELL| Yellow
RED | Red 
```

现在您有了一个 ID，如果您在没有加入的情况下显示，它对人类非常有用，如果您需要更准确/详细的“名称”值，您可以加入或检索它。所以很明显，当您查看父条目（假设它是水果）时，您不需要执行连接。此外，从来没有一个很好的理由来更改 ID

```
ID | Name   | Color
-----------------
 1 | Banana | YELL
 2 | Apple  | RED
 3 | Cherry | RED 
```

请记住，如果您计划添加大量子类型，则不应使用此系统，但如果您只有一打，它可能是一个不错的捷径。如果您计划拥有大量“水果”，这也不是一个好主意，因为 CHAR/VARCHAR 不是存放数据的有效方法。但是对于 99% 的数据库，这种方法会很好。

# javascript - JavaScript 的最大整数值是多少，一个数字在不损失精度的情况下可以达到多少？

> ID：307179
> 
> 赞同：1053
> 
> 时间：2008-11-20T22:47:54.100
> 
> 标签：javascript, math, browser, cross-browser

这是由语言定义的吗？有定义的最大值吗？不同浏览器有区别吗？

* * *

## 回答 #1

> 赞同：950
> 
> 时间：2008-11-20T22:53:40.780

JavaScript 有两种数字类型：[`Number`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)和[`BigInt`](https://developer.mozilla.org/en-US/docs/Glossary/BigInt).

最常用的数字类型`Number`是 64 位浮点[IEEE 754](https://en.wikipedia.org/wiki/IEEE_754)数字。

该类型的最大精确整数值为[`Number.MAX_SAFE_INTEGER`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/MAX_SAFE_INTEGER)，即：

*   2 ^(53) -1，或
*   +/- 9,007,199,254,740,991，或
*   九千万亿 七万亿 一百九千九十亿 七十四万九百九十一

换个角度来看：1 万亿字节是 PB（或 1000 TB）。

在这种情况下，“安全”是指准确表示整数并正确比较它们的能力。

[从规范：](https://www.ecma-international.org/ecma-262/10.0/index.html#sec-ecmascript-language-types-number-type)

> 请注意，所有大小不大于 2 ^(53)的正整数和负整数都可以在`Number`类型中表示（实际上，整数 0 有两种表示形式，+0 和 -0）。

要安全地使用大于此的整数，您需要使用[`BigInt`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/BigInt)没有上限的 。

请注意，按位运算符和移位运算符对 32 位整数进行操作，因此在这种情况下，最大安全整数为 2 ^(31) -1 或 2,147,483,647。

```
const log = console.log
var x = 9007199254740992
var y = -x
log(x == x + 1) // true !
log(y == y - 1) // also true !

// Arithmetic operators work, but bitwise/shifts only operate on int32:
log(x / 2)      // 4503599627370496
log(x >> 1)     // 0
log(x | 1)      // 1
```

* * *

关于数字 9,007,199,254,740,992 主题的技术说明：此值有一个精确的 IEEE-754 表示，您可以从变量中分配和读取此值，因此对于小于或等于整数域中*非常仔细*选择的应用程序这个值，你可以把它当作一个最大值。

在一般情况下，您必须将此 IEEE-754 值视为不精确，因为它是对逻辑值 9,007,199,254,740,992 还是 9,007,199,254,740,993 进行编码是不明确的。

* * *

## 回答 #2

> 赞同：483
> 
> 时间：2008-11-20T22:52:19.940

**>= ES6：**

```
Number.MIN_SAFE_INTEGER;
Number.MAX_SAFE_INTEGER; 
```

**<= ES5**

从[参考](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/MAX_VALUE)：

```
Number.MAX_VALUE;
Number.MIN_VALUE; 
```

```
console.log('MIN_VALUE', Number.MIN_VALUE);
console.log('MAX_VALUE', Number.MAX_VALUE);

console.log('MIN_SAFE_INTEGER', Number.MIN_SAFE_INTEGER); //ES6
console.log('MAX_SAFE_INTEGER', Number.MAX_SAFE_INTEGER); //ES6
```

* * *

## 回答 #3

> 赞同：118
> 
> 时间：2010-12-07T10:40:37.050

它是 2 ^(53) == 9 007 199 254 740 992。这是因为`Number`s 以浮点形式存储在 52 位尾数中。

最小值为 -2 ^(53)。

这使得一些有趣的事情发生

```
Math.pow(2, 53) == Math.pow(2, 53) + 1
>> true 
```

而且也可能很危险:)

```
var MAX_INT = Math.pow(2, 53); // 9 007 199 254 740 992
for (var i = MAX_INT; i < MAX_INT + 2; ++i) {
    // infinite loop
} 
```

[进一步阅读：[http ://blog.vjeux.com/2010/javascript/javascript-max_int-number-limits.html](http://blog.vjeux.com/2010/javascript/javascript-max_int-number-limits.html)]

* * *

## 回答 #4

> 赞同：65
> 
> 时间：2012-01-20T21:42:27.110

在 JavaScript 中，有一个数字叫做`Infinity`.

例子：

```
(Infinity>100)
=> true

// Also worth noting
Infinity - 1 == Infinity
=> true

Math.pow(2,1024) === Infinity
=> true 
```

对于有关此主题的某些问题，这可能就足够了。

* * *

## 回答 #5

> 赞同：41
> 
> 时间：2012-07-24T21:30:53.543

[Jimmy 的回答](https://stackoverflow.com/a/307200/508537)正确地将连续的 JavaScript 整数谱表示为**-9007199254740992**到**9007199254740992**包括在内（对不起 9007199254740993，你可能认为你是 9007199254740993，但你错了！ *下面或[jsfiddle](http://jsfiddle.net/briguy37/LRY3u/)*中的演示）。

```
console.log(9007199254740993);
```

但是，没有答案可以以编程方式找到/证明这一点（除了 CoolAJ86 在[他的答案](https://stackoverflow.com/a/7179733/508537)中提到的将在 28.56 年内完成的那个；），所以这里有一种更有效的方法（准确地说，它更有效大约 28.559999999968312 年:)，以及一个[测试小提琴](http://jsfiddle.net/briguy37/P4twR/)：

```
/**
 * Checks if adding/subtracting one to/from a number yields the correct result.
 *
 * @param number The number to test
 * @return true if you can add/subtract 1, false otherwise.
 */
var canAddSubtractOneFromNumber = function(number) {
    var numMinusOne = number - 1;
    var numPlusOne = number + 1;

    return ((number - numMinusOne) === 1) && ((number - numPlusOne) === -1);
}

//Find the highest number
var highestNumber = 3; //Start with an integer 1 or higher

//Get a number higher than the valid integer range
while (canAddSubtractOneFromNumber(highestNumber)) {
    highestNumber *= 2;
}

//Find the lowest number you can't add/subtract 1 from
var numToSubtract = highestNumber / 4;
while (numToSubtract >= 1) {
    while (!canAddSubtractOneFromNumber(highestNumber - numToSubtract)) {
        highestNumber = highestNumber - numToSubtract;
    }

    numToSubtract /= 2;
}        

//And there was much rejoicing.  Yay.    
console.log('HighestNumber = ' + highestNumber);
```

* * *

## 回答 #6

> 赞同：35
> 
> 时间：2018-03-11T09:43:37.050

许多较早的答案表明，验证***9,007,199,254,740,991***是最大和安全的整数`9007199254740992 === 9007199254740992 + 1`是**正确的。**

 **但是如果我们继续做积累呢：

```
input: 9007199254740992 + 1  output: 9007199254740992  // expected: 9007199254740993
input: 9007199254740992 + 2  output: 9007199254740994  // expected: 9007199254740994
input: 9007199254740992 + 3  output: 9007199254740996  // expected: 9007199254740995
input: 9007199254740992 + 4  output: 9007199254740996  // expected: 9007199254740996 
```

我们可以看到，在大于***9,007,199,254,740,992***的数字中，只有偶数可以**表示**。

这是一个解释**双精度 64 位二进制格式**如何工作的条目。让我们看看如何使用这种二进制格式保存（表示）***9,007,199,254,740,992 。***

使用简短版本从***4,503,599,627,370,496***进行演示：

```
 1 . 0000 ---- 0000  *  2^52            =>  1  0000 ---- 0000\.  
     |-- 52 bits --|    |exponent part|        |-- 52 bits --| 
```

在箭头的左侧，我们有**位值 1**和一个相邻的**小数点**。通过消耗左边的指数部分，小数点向右移动了 52 步。小数点在末尾结束，我们得到纯二进制的 4503599627370496。

现在让我们继续用 1 递增小数部分，直到所有位都设置为 1，这等于十进制的***9,007,199,254,740,991***。

```
 1 . 0000 ---- 0000  *  2^52  =>  1  0000 ---- 0000\.  
                       (+1)
  1 . 0000 ---- 0001  *  2^52  =>  1  0000 ---- 0001\.  
                       (+1)
  1 . 0000 ---- 0010  *  2^52  =>  1  0000 ---- 0010\.  
                       (+1)
                        . 
                        .
                        .
  1 . 1111 ---- 1111  *  2^52  =>  1  1111 ---- 1111\. 
```

因为 64 位双精度格式严格为小数部分分配 52 位，如果我们再加 1，就没有更多位可用，所以我们可以做的就是将所有位设置回 0，并操作指数部分：

```
 ┏━━▶ This bit is implicit and persistent.
  ┃        
  1 . 1111 ---- 1111  *  2^52      =>  1  1111 ---- 1111\. 
     |-- 52 bits --|                     |-- 52 bits --|

                          (+1)

  1 . 0000 ---- 0000  *  2^52 * 2  =>  1  0000 ---- 0000\. * 2  
     |-- 52 bits --|                     |-- 52 bits --|
                                      (By consuming the 2^52, radix
                                       point has no way to go, but
                                       there is still one 2 left in
                                       exponent part)
  =>  1 . 0000 ---- 0000  *  2^53 
         |-- 52 bits --| 
```

现在我们得到 ***9,007,199,254,740,992***，对于大于它的数字，格式只能处理 2 的增量，因为小数部分的每个增量 1 最终都会乘以指数部分的左 2。这就是为什么当数字大于***9,007,199,254,740,992*****时，双精度 64 位二进制格式**不能保存奇数：

 **```
 (consume 2^52 to move radix point to the end)
  1 . 0000 ---- 0001  *  2^53  =>  1  0000 ---- 0001\.  *  2
     |-- 52 bits --|                 |-- 52 bits --| 
```

按照这种模式，当数字大于 9,007,199,254,740,992 * 2 = 18,014,398,509,481,984 时，只能保留 4 倍的分数：

```
input: 18014398509481984 + 1  output: 18014398509481984  // expected: 18014398509481985
input: 18014398509481984 + 2  output: 18014398509481984  // expected: 18014398509481986
input: 18014398509481984 + 3  output: 18014398509481984  // expected: 18014398509481987
input: 18014398509481984 + 4  output: 18014398509481988  // expected: 18014398509481988 
```

[ ***2 251 799 813 685 248*** , ***4 503 599 627 370 496***）之间的数字怎么样？

```
 1 . 0000 ---- 0001  *  2^51  =>  1 0000 ---- 000.1
     |-- 52 bits --|                |-- 52 bits  --| 
```

二进制中的值0.1正好是2^-1 (=1/2) (=0.5) 所以当数字小于***4,503,599,627,370,496*** (2^52)时，有一位可以表示**整数的1/2倍**：

```
input: 4503599627370495.5   output: 4503599627370495.5  
input: 4503599627370495.75  output: 4503599627370495.5 
```

小于***2,251,799,813,685,248*** (2^51)

```
input: 2251799813685246.75   output: 2251799813685246.8  // expected: 2251799813685246.75 
input: 2251799813685246.25   output: 2251799813685246.2  // expected: 2251799813685246.25 
input: 2251799813685246.5    output: 2251799813685246.5
/**
   Please note that if you try this yourself and, say, log 
   these numbers to the console, they will get rounded. JavaScript
   rounds if the number of digits exceed 17\. The value 
   is internally held correctly:
*/

input: 2251799813685246.25.toString(2) 
output: "111111111111111111111111111111111111111111111111110.01"
input: 2251799813685246.75.toString(2) 
output: "111111111111111111111111111111111111111111111111110.11"
input: 2251799813685246.78.toString(2)   
output: "111111111111111111111111111111111111111111111111110.11" 
```

**指数部分**的可用范围是多少？格式分配给它的 11 位。

来自[维基百科](https://en.wikipedia.org/wiki/Double-precision_floating-point_format)（更多细节，去那里）

[![IEEE 754 双浮点格式.svg](https://upload.wikimedia.org/wikipedia/commons/thumb/a/a9/IEEE_754_Double_Floating_Point_Format.svg/1200px-IEEE_754_Double_Floating_Point_Format.svg.png)](https://commons.wikimedia.org/wiki/File:IEEE_754_Double_Floating_Point_Format.svg#/media/File:IEEE_754_Double_Floating_Point_Format.svg)

因此，要使指数部分为 2^52，我们需要设置 e = 1075。

* * *

## 回答 #7

> 赞同：34
> 
> 时间：2011-08-24T17:29:35.787

# 为了安全

```
var MAX_INT = 4294967295; 
```

# 推理

`x + 1 === x`我想我会很聪明，用更务实的方法找到价值。

我的机器每秒只能计数 1000 万次左右......所以我会在 28.56 年后回复明确的答案。

如果你不能等那么久，我愿意打赌

*   您的大多数循环不会运行 28.56 年
*   `9007199254740992 === Math.pow(2, 53) + 1`足够证明
*   你应该坚持`4294967295`哪个是`Math.pow(2,32) - 1`为了避免预期的位移问题

发现`x + 1 === x`：

```
(function () {
  "use strict";

  var x = 0
    , start = new Date().valueOf()
    ;

  while (x + 1 != x) {
    if (!(x % 10000000)) {
      console.log(x);
    }

    x += 1
  }

  console.log(x, new Date().valueOf() - start);
}()); 
```

* * *

## 回答 #8

> 赞同：30
> 
> 时间：2011-07-17T07:13:26.450

简短的回答是“视情况而定”。</p>

如果您在任何地方使用位运算符（或者如果您指的是数组的长度），则范围是：

未签名：`0…(-1>>>0)`

签：`(-(-1>>>1)-1)…(-1>>>1)`

（碰巧按位运算符和数组的最大长度被限制为 32 位整数。）

如果您不使用按位运算符或使用数组长度：

签：`(-Math.pow(2,53))…(+Math.pow(2,53))`

这些限制是由“数字”类型的内部表示所施加的，它通常对应于 IEEE 754 双精度浮点表示。（注意，与典型的有符号整数不同，由于内部表示的特性，负极限的大小与正极限的大小相同，实际上包括*负*0！）

* * *

## 回答 #9

> 赞同：29
> 
> 时间：2014-03-31T05:52:35.737

ECMAScript 6：

```
Number.MAX_SAFE_INTEGER = Math.pow(2, 53)-1;
Number.MIN_SAFE_INTEGER = -Number.MAX_SAFE_INTEGER; 
```

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2013-10-05T16:53:03.953

其他人可能已经给出了通用答案，但我认为给出快速确定它的方法是个好主意：

```
for (var x = 2; x + 1 !== x; x *= 2);
console.log(x); 
```

在 Chrome 30 中，它在不到一毫秒的时间内给了我 9007199254740992。

它将测试 2 的幂，以找出哪一个在“加”1 时等于他自己。

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2012-05-15T07:53:12.297

您要用于按位运算的任何内容都必须介于 0x80000000（-2147483648 或 -2^31）和 0x7fffffff（2147483647 或 2^31 - 1）之间。

控制台会告诉你 0x80000000 等于 +2147483648，但 0x80000000 & 0x80000000 等于 -2147483648。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2010-06-20T12:17:15.407

尝试：

```
maxInt = -1 >>> 1 
```

在 Firefox 3.6 中，它是 2^31 - 1。

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2018-12-28T11:19:23.483

JavaScript 在 ECMAScript 2020 中获得了一种新的数据类型：`BigInt`. 它引入了具有“n”后缀的数字文字并允许任意精度：

```
var a = 123456789012345678901012345678901n; 
```

当然，当这样的大整数（可能是无意的）强制转换为数字数据类型时，精度仍然会丢失。

而且，显然，由于内存有限，总是存在精度限制，并且为了分配必要的内存和对如此大的数字执行算术，需要花费时间。

例如，一个十万十进制数字的生成，在完成之前将需要一个明显的延迟：

```
console.log(BigInt("1".padEnd(100000,"0")) + 1n) 
```

...但它有效。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-11-20T23:21:38.540

我用公式做了一个简单的测试，X-(X+1)=-1，XI 的最大值可以在 Safari、Opera 和 Firefox 上工作（在 OS X 上测试）是 9e15。这是我用于测试的代码：

```
javascript: alert(9e15-(9e15+1)); 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2014-09-25T14:29:12.320

我这样写：

```
var max_int = 0x20000000000000;
var min_int = -0x20000000000000;
(max_int + 1) === 0x20000000000000;  //true
(max_int - 1) < 0x20000000000000;    //true 
```

与 int32 相同

```
var max_int32 =  0x80000000;
var min_int32 = -0x80000000; 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2018-07-18T09:29:25.727

# 让我们找到[源头](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/MAX_SAFE_INTEGER)

## 描述

> 该`MAX_SAFE_INTEGER`常数的值为`9007199254740991`（9,007,199,254,740,991 或 ~9 万亿）。该数字背后的原因是 JavaScript 使用[IEEE 754](https://en.wikipedia.org/wiki/IEEE_754)中指定的[双精度浮点格式数字](https://en.wikipedia.org/wiki/Double-precision_floating-point_format)，并且只能安全地表示 和 之间的数字。`-(2^53 - 1)``2^53 - 1`
> 
> 在这种情况下，安全是指准确表示整数并正确比较它们的能力。例如，`Number.MAX_SAFE_INTEGER + 1 === Number.MAX_SAFE_INTEGER + 2`将评估为真，这在数学上是不正确的。有关详细信息，请参阅[Number.isSafeInteger()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isSafeInteger)。
> 
> 因为`MAX_SAFE_INTEGER`它是[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)的静态属性，所以您始终将其用作`Number.MAX_SAFE_INTEGER`，而不是用作您创建的[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)对象的属性。

## 浏览器兼容性

[![在此处输入图像描述](https://i.stack.imgur.com/jmCpa.png)](https://i.stack.imgur.com/jmCpa.png)

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2018-12-19T21:47:10.430

在 JavaScript 中，数字的表示是`2^53 - 1`.

**但是**,[`Bitwise operation`是基于 计算的`32 bits ( 4 bytes )`，这意味着如果您超过 32 位移位，您将开始丢失位。](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2012-01-10T01:05:22.770

在谷歌浏览器内置的javascript中，你可以到大约2^1024之前的数字称为无穷大。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2022-03-02T09:29:20.887

**如何找到最大整数值**

```
console.log(2 ** 53 - 1);
console.log(Number.MAX_SAFE_INTEGER); 
```

> 输出：9007199254740993

[![在此处输入图像描述](https://i.stack.imgur.com/NwlSl.png)](https://i.stack.imgur.com/NwlSl.png)

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2016-12-24T18:34:55.520

斯卡托写道：

> 您要用于按位运算的任何内容都必须介于 0x80000000（-2147483648 或 -2^31）和 0x7fffffff（2147483647 或 2^31 - 1）之间。
> 
> 控制台会告诉你 0x80000000 等于 +2147483648，但 0x80000000 & 0x80000000 等于 -2147483648

十六进制是无符号的正值，所以 0x80000000 = 2147483648 - 这在数学上是正确的。如果要使其成为有符号值，则必须右移：0x80000000 >> 0 = -2147483648。你也可以写 1 << 31 。

* * *

## 回答 #21

> 赞同：-7
> 
> 时间：2008-11-20T23:00:13.607

Firefox 3 似乎没有大量数字的问题。

1e+200 * 1e+100 将计算精细到 1e+300。

Safari似乎也没有问题。（作为记录，如果其他人决定对此进行测试，则这是在 Mac 上。）

除非我在一天中的这个时候失去了理智，否则这比 64 位整数要大得多。

* * *

## 回答 #22

> 赞同：-7
> 
> 时间：2013-03-21T21:50:45.247

Node.js 和 Google Chrome 似乎都在使用 1024 位浮点值，所以：

```
Number.MAX_VALUE = 1.7976931348623157e+308 
```

# .net - 测试语法正确的路径

> ID：307183
> 
> 赞同：1
> 
> 时间：2008-11-20T22:48:51.663
> 
> 标签：.net, filepath, string-matching

在 .NET 中是否有一个函数可以测试字符串在语法上是否是正确的路径？我特别不希望它测试路径是否确实存在。

我目前对此的看法是一个正则表达式：

```
([a-zA-Z]:|\\)?\\?([^/\\:*?"<>|]+[/\\])*[^/\\:*?"<>|]* 
```

火柴：

```
c:\
bbbb
\\bob/john\
..\..\ 
```

拒绝：

```
xy:
c:\\bob 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-20T22:57:07.700

我相信 System.IO.Path.GetFullPath(path) 如果它不是语法正确的路径而不检查它是否存在，它将引发异常。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-20T22:52:37.367

我建议为此使用正则表达式，因为您特别不想测试路径是否存在。

这是[谷歌帮助我挖掘](http://regexlib.com/REDetails.aspx?regexp_id=425)的东西：

```
RegEx="^([a-zA-Z]\:|\\\\[^\/\\:*?"<>|]+\\[^\/\\:*?"<>|]+)(\\[^\/\\:*?"<>|]+)+(\.[^\/\\:*?"<>|]+)$" 
```

您可以将此与 System.IO.Path.GetInvalidPathChars() 方法结合使用，并使正则表达式动态排除所有无效字符。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T22:54:08.797

您也许可以使用 System.IO.Path 和 GetInvalidPathChars() 函数？

# windows - 从 Windows 脚本中的命名环境变量中删除引号

> ID：307198
> 
> 赞同：58
> 
> 时间：2008-11-20T22:53:06.570
> 
> 标签：windows, batch-file, scripting, environment-variables, quotes

我想将 URL 前缀存储在 Windows 环境变量中。查询字符串中的 & 符号使这很麻烦。

例如：我有一个 URL 前缀，`http://example.com?foo=1&bar=`想通过为`bar`参数提供一个值来创建一个完整的 URL。然后我想使用“开始”命令启动该 URL。

在 SET 操作的值周围添加引号很容易：

```
set myvar="http://example.com?foo=1&bar=" 
```

Windows 在实际值中包含引号（感谢 Windows！）：

```
echo %myvar%
"http://example.com?foo=1&bar=true" 
```

我知道我可以使用波浪号从批处理文件参数中去除引号：

```
echo %~1 
```

但是，我似乎无法对命名变量执行此操作：

```
echo %~myvar%
%~myvar% 
```

完成此操作的语法是什么？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-12-19T00:12:52.140

回声 %myvar:"=%

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-11-20T23:03:00.340

这不是环境变量的限制，而是命令 shell。

将整个作业用引号括起来：

```
set "myvar=http://example.com?foo=1&bar=" 
```

虽然如果你试图回应这一点，它会抱怨，因为 shell 会在那里看到一个中断。

您可以通过将 var 名称括在引号中来回显它：

```
echo "%myvar%" 
```

或者更好，只需使用 set 命令查看内容：

```
set myvar 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2013-03-02T13:14:42.587

虽然已经有几个很好的答案，但删除引号的另一种方法是使用一个简单的子例程：

```
:unquote
  set %1=%~2
  goto :EOF 
```

这是一个完整的使用示例：

```
@echo off
setlocal ENABLEDELAYEDEXPANSION ENABLEEXTENSIONS

set words="Two words"
call :unquote words %words%
echo %words%

set quoted="Now is the time"
call :unquote unquoted %quoted%
echo %unquoted%

set word=NoQuoteTest
call :unquote word %word%
echo %word%

goto :EOF

:unquote
  set %1=%~2
  goto :EOF 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2011-12-27T04:05:40.303

这有效

```
for %a in (%myvar%) do set myvar=%~a 
```

如果我想打印一个包含和不带引号的＆符号的变量，我也会使用它。

```
for %a in ("fish & chips") do echo %~a 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-10-12T15:38:36.687

要从变量中仅删除开始和结束引号：

```
SET myvar=###%myvar%###
SET myvar=%myvar:"###=%
SET myvar=%myvar:###"=%
SET myvar=%myvar:###=% 
```

这假设您的值中没有 ###" 或 "###，并且如果变量为 NULL 则不起作用。

此方法的功劳归功于[http://ss64.com/nt/syntax-esc.html](http://ss64.com/nt/syntax-esc.html)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-05-10T12:11:35.760

使用延迟的环境变量扩展并使用 !var:~1,-1! 删除引号：

```
@echo off
setlocal enabledelayedexpansion
set myvar="http://example.com?foo=1&bar="
set myvarWithoutQuotes=!myvar:~1,-1!
echo !myvarWithoutQuotes! 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-09-27T20:50:12.797

使用多个变量来做到这一点：

```
set myvar="http://example.com?foo=1&bar="

set bar=true

set launch=%testvar:,-1%%bar%"

start iexplore %launch% 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-11-24T17:05:31.547

```
@echo off
set "myvar=http://example.com?foo=1&bar="
setlocal EnableDelayedExpansion
echo !myvar! 
```

这是因为变量包含特殊的 shell 字符。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-11-20T23:00:06.850

我认为应该这样做：

```
for /f "tokens=*" %i in (%myvar%) do set %myvar%=%~i 
```

但你不需要这个，

```
set myvar="http://example.com?foo=1&bar="
start "" %myvar% 
```

也可以，您只需要为启动命令提供一个标题。

# php - 为多种语言进行语法颜色解析的PHP函数？

> ID：307210
> 
> 赞同：0
> 
> 时间：2008-11-20T22:57:37.840
> 
> 标签：php, syntax-highlighting

我正在做一个 PHP 站点，它以各种语言（C#、PHP、Perl、Ruby 等）显示代码示例。是否有任何 PHP 函数可以为这些语言和其他语言添加语法着色？

如果没有，我至少想找到一个为 PHP 代码进行语法着色的内置 PHP 函数，再也找不到它了。谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-20T23:00:54.917

为什么不在客户端进行语法着色？

使用[prettify.js](http://code.google.com/p/google-code-prettify/)，它非常通用，Google Code 和 StackOverflow 都使用它！

检查支持语言的[测试页面。](http://google-code-prettify.googlecode.com/svn/trunk/tests/prettify_test.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-20T23:01:01.093

实际上，您最好用 javascript 对其进行格式化。有一些成熟的 javascript 语法颜色。

*   [突出显示.js](http://softwaremaniacs.org/soft/highlight/en/)
*   [谷歌荧光笔](http://code.google.com/p/syntaxhighlighter/)
*   [美化](http://code.google.com/p/google-code-prettify/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T23:02:24.273

要突出显示 PHP，请使用[highlight_string()](http://php.net/highlight_string)。（这也适用于其他语言。）

**编辑：**此函数要求字符串以 PHP 开始标记开头。我在我的网站上为解决这个问题所做的是将类似的东西传递`"<?php\n$code\n?>"`给 highlight_string() 函数，然后使用正则表达式去除我添加的开始和结束标签。这种方法非常适合突出显示 C/C++ 、Scheme 和 Java（以及没有`<?php ?>`标签的 PHP。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T23:13:57.137

正如已经提到的，Google prettify.js 非常好，但如果你想在服务器上用 PHP 做，你可以试试看[Pear Text Highlighter](http://pear.php.net/package/Text_Highlighter)

# windows-vista - 在 Vista 客户端上安装后的 SQL Compact 问题

> ID：307215
> 
> 赞同：1
> 
> 时间：2008-11-20T22:59:52.017
> 
> 标签：windows-vista, sql-server-ce

我正在尝试运行在 XP 上安装时通常可以运行的应用程序，但在 Vista 上安装时却无法运行。我正在安装作为安装一部分包含的 .NET 3.5 SP1 和 SQL Compact 3.5 的先决条件，但我仍然遇到此异常：

无法加载 DLL 'sqlceme35.dll'：找不到指定的模块。（来自 HRESULT 的异常：0x8007007E）

任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T23:24:23.510

您运行的是 32 位还是 64 位的 Vista？由于 CE CE 的引擎是原生的，因此每个引擎都有单独的二进制文件，您必须确保使用正确的二进制文件。

# javascript - 如何模仿 ASP.NET AjaxOptions 委托函数？

> ID：307220
> 
> 赞同：1
> 
> 时间：2008-11-20T23:00:17.850
> 
> 标签：javascript, asp.net-mvc, json, asp.net-ajax

在使用`Ajax.BeginForm()`助手时`ASP.Net MVC`，我可以传递具有不同功能名称的选项，例如一个运行`OnBegin`，一个用于`OnSuccess`等。这些如何“在幕后”工作？

我问的原因是我正在扩展它以提供一个`JQuery`基于替代的方法，我需要弄清楚如何从在`JSON`字符串中指定方法名称到实际调用它们。

该类`AjaxOptions`有一个用于序列化的方法，其中它以以下方式包装方法名称（在此示例中，`AjaxOptions` `OnSuccess`属性设置为`mySuccessFunction(p)`：

```
onSuccess: Function.createDelegate(this, mySuccessFunction(p))
```

我已经制作了自己的`JQueryAjaxOptions`类，它以相同的方式序列化（但有一些额外的选项可用）。因此，我在发布表单的方法中可用的是上述属性作为 json 对象的一部分，我需要能够调用该函数。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T23:49:01.090

我找到了我的问题的答案：

它真正归结为是执行包含在字符串变量中的一行代码。这可以使用 'eval(x)' 语法轻松完成。以下示例适用于 onSuccess 属性：

```
评估（设置。onSuccess）
```

有时你只需要再往后想一步就可以意识到你想要做什么，以及它是多么容易=）

# concurrency - Java中的不可变bean

> ID：307232
> 
> 赞同：5
> 
> 时间：2008-11-20T23:03:06.097
> 
> 标签：concurrency, javabeans, immutability

我很好奇为 java bean 提供不变性的可能性（这里的 bean 是指具有为成员提供 getter 和 setter 的空构造函数的类）。显然，这些类不是不可变的，它们用于从数据层传输值，这似乎是一个真正的问题。

StackOverflow 中提到了一种解决此问题的方法，称为“C# 中的不可变对象模式”，其中对象在完全构建后被冻结。我有另一种方法，真的很想听听人们对此的看法。

该模式涉及两个类 Immutable 和 Mutable，其中 Mutable 和 Immutable 都实现了一个提供非可变 bean 方法的接口。

例如

```
public interface DateBean {
    public Date getDate();
    public DateBean getImmutableInstance();
    public DateBean getMutableInstance();
}

public class ImmutableDate implements DateBean {
    private Date date;

ImmutableDate(Date date) {
    this.date = new Date(date.getTime());
}

public Date getDate() {
    return new Date(date.getTime());
}

    public DateBean getImmutableInstance() {
        return this;
    }

    public DateBean getMutableInstance() {
        MutableDate dateBean = new MutableDate();
        dateBean.setDate(getDate());
        return dateBean;
    }
}

public class MutableDate implements DateBean {
    private Date date;

public Date getDate() {
    return date;
}

public void setDate(Date date) {
    this.date = date;
}

public DateBean getImmutableInstance() {
    return new ImmutableDate(this.date);
}

    public DateBean getMutableInstance() {
        MutableDate dateBean = new MutableDate();
        dateBean.setDate(getDate());
        return dateBean;
    }
} 
```

这种方法允许使用反射（通过通常的约定）构建 bean，并且还允许我们在最近的机会转换为不可变的变体。不幸的是，每个 bean 显然有大量的样板。

我很想听听其他人对这个问题的看法。（我很抱歉没有提供一个好的问题，可以回答而不是讨论:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-20T23:27:57.827

一些评论（不一定有问题）：

1.  Date 类本身是可变的，因此您可以正确复制它以保护不变性，但我个人更喜欢在构造函数中转换为 long 并在 getter 中返回一个新的 Date(longValue)。
2.  您的两个 getWhateverInstance() 方法都返回 DateBean ，这将需要强制转换，更改接口以返回特定类型可能是一个想法。
3.  说了这么多，我倾向于只拥有两个类，一个是可变的，一个是不可变的，如果合适的话，共享一个通用（即仅获取）接口。如果你认为会有很多来回转换，那么为这两个类添加一个复制构造函数。
4.  我更喜欢不可变类将字段声明为**final**以使编译器也强制执行不可变性。

例如

```
public interface DateBean {
    public Date getDate();
}

public class ImmutableDate implements DateBean {
    private final long date;

    ImmutableDate(long date) {
       this.date = date;
    }

    ImmutableDate(Date date) {
       this(date.getTime());
    }

    ImmutableDate(DateBean bean) {
       this(bean.getDate());
    }

    public Date getDate() {
         return new Date(date);
    }
}

public class MutableDate implements DateBean {
    private long date;

    MutableDate() {}

    MutableDate(long date) {
       this.date = date;
    }

    MutableDate(Date date) {
       this(date.getTime());
    }

    MutableDate(DateBean bean) {
       this(bean.getDate());
    }

    public Date getDate() {
        return new Date(date);
    }

    public void setDate(Date date) {
        this.date = date.getTime();
    }

} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T21:31:47.000

我想我会使用委托模式 - 使用必须在构造函数中指定的单个 DateBean 成员创建一个 ImmutableDate 类：

```
public class ImmutableDate implements DateBean
{
   private DateBean delegate;

   public ImmutableDate(DateBean d)
   {
      this.delegate = d;
   }

   public Date getDate()
   {
      return delegate.getDate();
   }
} 
```

如果我需要强制 DateBean d 具有不变性，我只需在其上使用 new ImmutableDate(d) 即可。我本可以很聪明，并确保我没有委派代表，但你明白了。这避免了客户端试图将其转换为可变的问题。这很像 JDK 对 Collections.unmodifiableMap() 等所做的。（然而，在这些情况下，突变函数仍然必须实现，并且被编码为抛出运行时异常。如果你有一个没有突变体）。

再一次，它是乏味的样板代码，但它是像 Eclipse 这样的优秀 IDE 只需单击几下鼠标即可自动为您生成的东西。

如果这是您最终对很多域对象所做的事情，您可能需要考虑使用动态代理，甚至可能是 AOP。然后为任何对象构建代理，委托所有 get 方法，并根据需要捕获或忽略 set 方法，这将相对容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T23:29:38.867

我使用接口和强制转换来控制 bean 的可变性。我认为没有充分的理由使用 和 之类的方法使我的域对象复杂`getImmutableInstance()`化`getMutableInstance()`。

为什么不直接使用继承和抽象呢？例如

```
public interface User{

  long getId();

  String getName();

  int getAge();

}

public interface MutableUser extends User{

  void setName(String name);

  void setAge(int age);

} 
```

以下是代码的客户端将执行的操作：

```
public void validateUser(User user){
  if(user.getName() == null) ...
}

public void updateUserAge(MutableUser user, int age){
  user.setAge(age);
} 
```

它回答了你的问题吗？

yc

# javascript - 如何重现：脚本错误，“对象不支持此属性或方法。”

> ID：307236
> 
> 赞同：-4
> 
> 时间：2008-11-20T23:05:07.433
> 
> 标签：javascript, html, internet-explorer

谁能给我一个可以重现此错误的脚本（HTML/CSS/Javascript）`IE 7.0`？我正在尝试在我收到此警告但无法完全找到问题的页面中修复此错误。行号也与源不匹配。

我认为更好的方法是创建一个错误，然后逐步处理它，而不是做出一些疯狂的猜测！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T00:44:07.983

正如 Shog 所说，当您尝试在没有该方法的对象上调用方法时会发生该错误。

这通常是由于对象为 null 而您期望它不为 null 造成的。

```
var myEl = document.getElementById('myElement');
myEl.appendChild(...) 
```

如果“#myElement”元素不存在，上述示例将导致该错误。

如果它只发生在 IE 而不是 Firefox 上，很可能是因为您使用的是 IE 不支持的方法。

解决方案？您可以尝试脚本调试器，但我自己从未发现它有用。最可靠但速度极慢的方法是 alert() 调试。在您的代码中的战略点，使用独特的消息发出警报。在某些时候 IE 会抛出一个错误，所以你会知道这个错误介于你看到的最后一个警报和下一个没有看到的警报之间。

```
function myFunc() {
    alert('a');
    var myEl = document.getElementById('myElement');
    myEl.appendChild(something);
    alert('b');
    // more code
} 
```

如果你运行它并且你看到'a'而不是'b'你知道它在某个地方之间。恐怕这只是 IE 中 javascript 的可悲状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T00:18:17.910

> 我认为更好的方法是创建一个错误，然后逐步处理它，而不是做出一些疯狂的猜测！

你会错的。有无数种情况可能会产生您所看到的错误。这意味着您正在尝试调用未定义的方法。例如：

```
var blah = {};
blah.methodWhichDoesntExist(); // <-- error 
```

这可能是由于拼写错误、某些其他组件中未检测到的故障或伽马射线在您保存后立即在您的 HTML 中不断翻转位的结果。如果不知道更多关于你在做什么，很难更具体。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-20T23:10:20.747

如果你让你的代码遵循 jslint.com 的规则，它就会消失。它还将指出问题在代码中的确切位置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T23:12:06.063

对于 IE，下载[Microsoft Script Debugger](http://www.microsoft.com/downloads/details.aspx?FamilyID=2f465be0-94fd-4569-b3c4-dffdf19ccd99&displaylang=en)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-16T16:05:04.490

我刚刚通过使用 IE8 并将其切换到 IE7 模式修复了一个类似的错误。然后，您会收到更具体的错误消息，告诉您哪个文件的哪一行失败。

之后设置一个断点，使代码在有问题的行之前停止（F12 进入调试器工具，然后从“脚本”下拉列表中选择所需的 JS 文件并单击行号左侧。单击“开始调试” ' 使其使用断点）。

正如其他人指出的那样，这个错误可能有很多原因，但就我而言，我在同一页面上有两个 ID，一个大写，一个不大写。getElementById() 弄错了。只有IE7抱怨。

# asp.net - 有不同的主题 - 如果相同的主机地址有 www。和一个没有 www 的版本。

> ID：307237
> 
> 赞同：0
> 
> 时间：2008-11-20T23:05:07.480
> 
> 标签：asp.net

我的网站有一组主题，可用于来自不同 url 的不同请求。因此，如果 url = www.xyz.com 我加载不同的主题，而不是 www.abc.com。

但是，我尝试了一个名为 www.abc.com 的主题和一个名为 abc.com 的主题，在我的 webform 代码隐藏中，我有一个`preinit page`事件显示如果`url.contains(abc.com)`，则加载主题 abc.com，如果`url.contains(www.abc.com)`，则加载主题 www.abc .com（有效主题）。

重新开始，根据url是否有www，拥有和调用主题的最佳方式是什么。与否，但同一个主机。那么我怎样才能为 abc.com 和 www.abc.com 设置单独的主题，然后在 url 为 www.abc.com 时加载后者，而当 url 显然是 abc.com 时加载前者？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-20T23:25:54.867

不完全确定您在这里追求什么，但是如果您按该顺序测试 url，并使用 else，那么看起来第一种情况总是正确的，所以首先测试更具体的情况（www）。

还建议您查看 url.StartsWith 的测试，并包括您可能期望的协议变体，因为您永远不知道这些字符串是否会在一两年内出现在 url 的其他地方，并且您的主题切换器可能会停止在职的。

然后你可以交换母版页来改变你的主题，或者如果你正在使用 App_Theme 东西，做一些切换。我自己总是觉得 aspnet 主题有点笨拙。

# c++ - COM 端口上的 Win32 重叠读取文件返回 ERROR_OPERATION_ABORTED

> ID：307243
> 
> 赞同：3
> 
> 时间：2008-11-20T23:07:14.247
> 
> 标签：c++, winapi, serial-port

好的，一个适合蜂巢思维的人......

我的代码 - 直到今天 - 在许多系统上运行得很好，并且部署在许多站点上。它涉及线程从串行端口读取和写入数据。

尝试检查新设备时，我的代码在 ReadFile 之后调用 GetOverlappedResult 时出现 995 ERROR_OPERATION_ABORTED 错误。有时读取会起作用，有时我会收到此错误。只需忽略错误并重试即可 - 令人惊讶的是 - 不会丢失任何数据。不需要 ClearCommError。

这是片段。

```
if (!ReadFile(handle,&c,1,&read, &olap))
    {
        if (GetLastError() != ERROR_IO_PENDING)
        {
            logger().log_api(LOG_ERROR,"ser_rx_char:ReadFile");
            throw Exception("ser_rx_char:ReadFile");
        }
    }

    WaitForSingleObjectEx(r_event, INFINITE, true);  // alertable, so, thread can be closed correctly.

    if (GetOverlappedResult(handle,&olap,&read, TRUE) != 0)
    {
        if (read != 1)
            throw Exception("ser_rx_char: no data");

        logger().log(LOG_VERBOSE,"read char %d ( read = %d) ",c, read);
    }
    else
    {
        DWORD err = GetLastError();
        if (err != 995)   //Filters our ERROR_OPERATION_ABORTED
        {
            logger().log_api(LOG_ERROR,"ser_rx_char: GetOverlappedResult");
            throw Exception("ser_rx_char:GetOverlappedResult");
        }
    } 
```

我的第一个猜测是归咎于我之前没有使用过的 COM 端口驱动程序（它是 Blackmagic Decklink 上的 RS422 端口，仅供参考），但这感觉像是在逃避。

哦，还有 Vista SP1 Business 32 位，为我的罪过。

在我把它归结为“别人的问题”之前，有没有人知道可能导致这种情况的原因？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-20T23:27:19.277

您如何在 ReadFile 之前设置 OVERLAPPED 结构？- 我总是将它们归零（显然 hEvent 除外），这可能是部分迷信，但我有一种感觉，它在过去给我带来了问题。

恐怕责怪驱动程序（如果它不是 MS 而不仅仅是参考的微小调整）并非完全不切实际。编写一个 COM 驱动程序是一件非常复杂的事情，测试它的困难在于每个编写的应用程序使用串行端口和它们的 IOCTL 略有不同。

另一个常见问题是不设置整个端口 - 例如不调用 SetCommTimeouts 或 SetupComm。我不知道你是否犯了这种错误，但是我遇到过一些人说他们没有使用超时，而实际上他们的意思是他们没有调用 SetCommTimeouts 所以他们正在使用它们但没有一个概念他们将要做什么...

这种东西对于 3rd-party COM 驱动程序来说可能是谋杀，因为人们经常使用 MS 驱动程序摆脱任何旧的废话，而且它并不总是与其他设备相同。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T19:34:39.327

除了将 OVERLAPPED 归零之外，您还可以检查如何设置 olap.hEvent，也就是说，您对 CreateEvent 的参数是什么？如果您正在创建一个预先发出信号的事件（即 CreateEvent 的第三个参数为 TRUE），我希望立即返回。另外，不要忘记，如果您将 manualReset（CreateEvent 的第二个参数）指定为 FALSE，GetOverlappedResult() 将有助于为您清除事件 - 这可能解释了为什么它第二次起作用。

无法从您的代码段中真正分辨出这些是否会影响您 - 希望这会有所帮助。

# outlook - 在用户的个人表单库中安装自定义 Outlook 2003 表单

> ID：307246
> 
> 赞同：0
> 
> 时间：2008-11-20T23:09:09.033
> 
> 标签：outlook, ms-office, vsto

我们已经开发了一个基于 ipmNote 的自定义 Outlook 2003 表单。我需要一种方法将其推送给组织中的所有其他用户。同时，我们还将安装一个使用 VSTO 构建的自定义插件，因此我们可以将表单安装作为其中的一部分。

目前我无法使用组织表单库，因为交换管理员不想打开公用文件夹。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-21T02:49:19.900

为什么需要它出现在用户的个人表单库中？如果将其发布给公司中的每个人，您通常会将其发布到 Exchange Server 上的组织表单库。

当您的用户第一次打开表单时，它会被下拉到他们的本地计算机并存储在他们的文档和设置中的应用程序文件夹中。

查看[http://www.outlookcode.com/article.aspx?id=34](http://www.outlookcode.com/article.aspx?id=34)以获取一些有用的信息

# nhibernate - 我如何在 HQL 中表达这一点

> ID：307247
> 
> 赞同：3
> 
> 时间：2008-11-20T23:09:15.133
> 
> 标签：nhibernate, hibernate, hql

我已经被这个查询困住了一段时间了。SQL 返回我想要的结果，但我不知道如何用 HQL 表达查询。

这是**SQL**：

```
select      thread.ThreadId,
            thread.Title,
            thread.CreatedOn, 
            thread.ViewCount,
            thread.CreatedBy,
            thread.ForumId 

from Threads thread 
where 
    (thread.ThreadId in(select post.ThreadId from Posts post 
    where (post.CreatedBy=2 )))

AND

(2!=(select TOP 1 post2.CreatedBy from Posts post2 
        where (post2.ThreadId=thread.ThreadId ) ORDER BY post2.CreatedOn DESC)) 
```

我想我需要使用 DetachedCriteria 来创建相关的子查询，但我遇到了真正的问题。

这是**我**到目前为止的位置：

```
DetachedCriteria latestPostInThread = DetachedCriteria.For(typeof (ForumPost), 
                    "post2")
            .Add(Expression.EqProperty("post2.ThreadId", "post.ThreadId"))
            .AddOrder(Order.Desc("CreatedOn"))
            .SetFirstResult(0)
            .SetMaxResults(1); 
```

对于主要**查询**：

```
ICriteria critMain = CreateCriteria(typeof (ForumPost), "post")
            .Add(Expression.Eq("CreatedBy",user.ID))
            .Add(Subqueries.Ne("CreatedBy", latestPostInThread)); 
```

这显然是不正确的 - 我需要从 latestPostInThread 获取 userId 才能将其用作我的子查询，但我完全被难住了。

任何帮助将不胜感激！我不愿意回退到 SQL，因为我确信在 nHibernate 中实现并不是特别困难。

# project-management - Scrum Master 如何“管理”失控的产品负责人？

> ID：307248
> 
> 赞同：5
> 
> 时间：2008-11-20T23:09:23.963
> 
> 标签：project-management, scrum, methodology

我是 Scrum 新手，虽然我了解 Sprint 背后的团队概念，但我想仍然需要一个团队的监护人，以尽量减少不熟悉软件开发的产品负责人的干扰。你的成功是什么，你经历过哪些恐怖故事？

更新：

我正在寻找实现业务流程的编码与为客户创建适当的架构之间的平衡。如果产品负责人来自业务部门，则必须指导应该在数据模型上花费多少时间等。

定义：

我所说的“失控”产品负责人通常是指业务部门中的某个人，他们积极设定时间框架，但没有真正的技术能力来创建该估计。通常这个人会说：“在下周与运营委员会的下一次会议之前，我需要这些屏幕，所以首先优先考虑这些工作产品。我们将在与运营部交谈后处理数据库。”

每个人都很好的答案。谢谢你的好意见。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-21T06:19:17.760

Scrum 中明确定义了职责——产品负责人定义待办事项并确定它们的优先级，开发人员承诺他们在 Sprint 中可以做多少。

因此，产品负责人根本无权设定估算值。当然，他仍然可以说他在特定的时间点需要一些东西——这很容易发生。但是*能*不能做到，还是要开发商说了算。如果不能，他们必须共同研究如何更改范围或采取其他措施以尽可能最好地满足 PO 的需求。

现在，在这种情况下，SM 应该如何行动，这在很大程度上取决于具体情况。不过，我宁愿看到他促进 PO 和团队之间的良好关系和沟通文化，也不愿让他*保护*团队免受 PO 的影响。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T02:49:56.590

“必须有关于应该在数据模型上花费多少时间等的指导。”

对。这就是优先级的全部意义所在。你定义工作，你优先考虑。你按照优先级工作。

什么会失控？

1.  在完成任何工作之前重新定义工作？

2.  在工作完成之前重新定义优先级？

解决方法是一样的。将工作分解成更小的部分，以便在有机会做出改变之前完成一些事情。

如果您的冲刺时间很短（2 周），就不可能失控。如果您进行稍微实用的 4 周冲刺，那么您遇到麻烦的可能性很小。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-21T06:47:17.220

产品负责人应该是保护您免受模棱两可或多变的客户要求的人。

产品所有者不得给出估算值。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-09-15T19:51:30.377

我不认为这是一个“失控”的问题。

> “在下周与运营委员会的下一次会议之前，我需要这些屏幕，所以首先优先考虑这些工作产品。我们将在与运营部门交谈后处理数据库。”

这句话*本身*并没有什么本质上的错误。如果您的应用程序被正确抽象，那么您的数据库无论如何都是独立的。UI 的主要问题首先是更多的心理问题：非开发人员会认为如果他们看到屏幕并在事情“慢下来”时发疯，他们就会认为大部分工作已经完成。但是，我认为您的真正问题可能是：

您标记为产品负责人的人没有拥有产品，因此没有承担足够的责任。

产品是*整个*事物，而不仅仅是“功能需求”（借用术语）。您的 SM 需要坐下来，并坚持 PO 不需要试图推迟了解需要完成的幕后工作的范围。一旦您的 PO 开始着眼于整个范围，那么他们实际上可以成为您在更广泛的利益相关者社区中的代表。

最终，您的 SM 负责执行流程。他们应该这样做。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-20T23:22:29.660

我在两家不同的商店使用过敏捷，两次都运行良好。我看不出任何失控的东西会如何破坏系统。在 sprint 之前，你计划好你将要做的所有任务，并猜测它们需要多长时间（总是四舍五入）。然后，您可以大致计算出在您的 sprint 期间可以完成多少工作。

大多数商店使用 4 周的冲刺，每天 6.5 小时的工作时间。设置 sprint 后，您不会引入新任务，只有潜入 sprint 的计划外工作会修复您正在添加的功能中的错误，当然这应该包含在您的估计时间中。

如果您想要更具体的答案，您需要定义“失控”产品所有者的意思。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-20T23:24:45.570

我有两件事要说。

你可能有某种类型的研发经理（不一定是 Scrum Master），也不是产品负责人）。

这个人可以而且应该（我认为）“保护”开发人员。当我们有这样一个人时，我们就处于这种情况，而且效果很好。例如，他帮助我们在积压工作中获得了非功能性的东西。

现在我们没有这个人了。我们的经理是 Scrum Master。他在保护我们方面也做得很好。虽然......这里的问题是通用 scrum master 没有官方权力，所以他不能说“你不会这么压他们”，但如果他看到团队需要帮助，他当然可以而且应该说。

团队本身和产品负责人也随着时间的推移而发展，因此他们开始更加关心彼此。产品负责人理解团队何时不承诺更多或说“我们现在需要一些时间来处理非功能性的东西”。

但话又说回来 - 如果有一个单独的研发经理，其主要职责是照顾开发人员，那当然很好......那么我认为它会更加平衡......

我们还有支持部门借用开发人员来完成支持任务。有时很难就该客户或该客户将要做什么或不做什么达成一致（因为支持需要这一切）。对于这种情况，研发经理 - 也是一个非常好的主意..

理想情况下，我喜欢这个想法完全精简，这样开发人员就不需要经理或盾牌……但我不知道它是否以及如何运作……:)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-21T03:21:32.283

我同意 S. Lott 的观点。短冲刺更好。简短的用户故事可以提供帮助。我们尝试将我们的用户故事限制在最多 2 到 4 天。

1.  确保您的所有用户故事都定义明确并且所有者同意他们。

2.  sprint 开始后，坚持不能将新任务添加到当前 sprint 中，但它们可以在下一个 sprint 中具有高优先级。更短的冲刺使这更容易。

3.  此外，为了消除人为的最后期限的强加，您真的不应该在可能的情况下从当前的 sprint 直到下一个 sprint 的开始交付项目。

敏捷开发最难的部分是纪律。一旦你有一个纪律严明的团队和 scrum master，用户就会习惯它，事情就会变得更加顺利。我不确定您是否使用任何软件进行项目管理，但看看 Rally。在过去一年左右的时间里，他们取得了一些重大改进。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-21T07:28:52.877

在迭代期间不应更改迭代（Scrum 中的 Sprint）范围。这就是为什么一次只计划一个迭代。正如 S. Lott 指出的那样，迭代越短，产品负责人就能越早计划新事物。

Scrum Master 的角色是将团队与这种压力隔离开来，并告诉产品负责人新的请求必须等待下一次迭代。

现在 Product Owner 的角色是最大化团队生产的工作的价值，所以如果有一个新的最高优先级项目，它不能等待当前迭代结束，仍然可以替换**具有相似估计**的项目而且**还没有开始**。这应该是例外，而不是规则。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-09-15T19:25:29.630

坚持明确定义的参与规则，那么您（SM）可以花时间领导您的团队。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-03-26T22:29:45.207

敏捷团队由开发人员、业务分析师、测试人员、DBA、Scrum master 和产品负责人组成。**所有人都作为一个基于功能的团队工作**。

敏捷方法可以帮助企业加快产品开发速度。产品所有者可以定义优先级并更改其优先级。实际上，它是一个 Scrum 团队，他们估计它包括（SME、开发人员、设计师、测试人员……每个人）。每个团队成员对产品和交付用户故事所需的工作都有不同的看法，一个 sprint 包括大和小的用户故事。如果 Scrum 团队觉得它不能在 sprint 中完成，那么它需要分成用户故事的一小部分，并根据开发它所涉及的堆栈跟踪进行估计。

即如果产品负责人（PO）希望特定的用户故事需要首先完成，但如果该故事包含多个更改（即前端和后端，包括数据库）并且无法在一个 sprint 中完成，Scrum 团队可以遵循以下关键规则：

**关键要素**：

*   根据堆栈轨迹划分子用户故事
*   估计与此相关的每个用户故事
*   Scrum master 应该根据团队当前的团队速度通知产品负责人完成此用户故事的时间表
*   产品负责人应该足够成熟，能够理解时间表，因为它无法在冲刺中完成。
*   如果 Still PO 有优先级的问题，他/她可以咨询 Scrum Master/Coach。

    乍一看，敏捷更多的是帮助业务，但需要注意它不会使 Scrum 团队超载。因为它是迭代开发的常规过程。

# javascript - 如何使用 Javascript（或 Rails）在 POST 之前重新格式化表单输入？

> ID：307250
> 
> 赞同：0
> 
> 时间：2008-11-20T23:11:19.247
> 
> 标签：javascript, forms, post

我的表单中有一个标有“姓名”的字段，其中包含名字和姓氏。

我们现有的动态服务器（表单被发布到的）需要两个单独的字段（名字、姓氏）。

在将表单发布到服务器之前，我可以使用 Javascript 将用户输入拆分为两个单独的变量吗？我该怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T23:27:25.423

您不应尽可能依赖客户端解析。如果您将此表单发送到您无法修改的应用程序，请使用上面提到的 Javascript 方法，因为您无法控制它（但是为什么不只有名字和姓氏字段）。但是，如果您是后端应用程序的控制器，请在那里执行所有按摩和数据验证。

Javascript 应该只用于增强 UI 体验，而不是执行导入数据操作，如果将 Javascript 用于这些重要任务，它可能是一个安全漏洞和故障点。

此外，在操作名称时，请记住您将获得的所有不同类型的格式，例如：

```
John Smith Jr
Dr John Smith
John Smith Esq.
John Smith IV
John A Smith 
```

所以要小心，按摩名字是一件很杂乱的事情，公众随便输入什么，最起码加个小标签，要求他们只输入“名字和姓氏”，并祈祷一切顺利。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T23:17:22.307

你可以这样做：

```
var yourForm = document.getElementById('yourFormId');
yourform.onsubmit = new function()
{
    var nameBox = document.getElementById('nameBox');
    var fname = document.createElement('INPUT');
    var lname = document.createElement('INPUT');
    fname.type = 'HIDDEN';
    lname.type = 'HIDDEN';
    fname.name = 'fname';
    lname.name = 'lname';

    var tokens = nameBox.value.split(' ');

    // Note there are a million ways to break this parser, demonstration only
    fname.value = tokens[0];
    lname.value = tokens[1];

    yourForm.appendChild(fname);
    yourForm.appendChild(lname);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T23:17:38.923

如果需要在客户端处理，使用[Javascript split方法](http://www.w3schools.com/jsref/jsref_split.asp)解析name字段值。然后将这两个名称附加到表单的 url 或创建几个隐藏字段。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-20T23:46:42.653

我会在服务器端进行处理，以确保传递的数据与发布的数据准确无误。以编程方式拆分名称相对容易，但问题是如何定义分隔符。大多数人会同意在任何有空格字符的地方拆分它，但是如果他们输入三个单词的名字，例如**Don Juan DiMarco**怎么办？如果您决定根据空格拆分名称，则必须确定如何分配名字和姓氏。

```
$arrNames = preg_split('/\s+/', $_POST['name']); 
```

以上将为您（在 PHP 中）提供一个由空格分隔的值数组。**在字符串Don Juan DiMarco**上运行它会给你一个像这样的数组：

```
Array([0] => "Don", [1] => "Juan", [2] => "DiMarco") 
```

从那里你必须确定哪些是名字，哪些是中间名，哪些是姓氏。如果你输入了 4 或 5 个名字，那就更难了，这对于某些文化来说是完全现实的。所有这些都是猜测，这就是为什么我建议在前端简单地添加一个姓氏输入字段。这将消除关于哪个名字是名字和哪个名字是姓氏的所有猜测工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-30T01:56:24.033

对我来说，只有一个字段的原因是为了表单简单，这将获得更高的转化率。

让 PHP 将名称拆分为名字和姓氏，然后让 PHP 将表单重新提交到另一台服务器可能有点棘手......

# php - Zend Framework 翻译工具在哪里使用

> ID：307273
> 
> 赞同：6
> 
> 时间：2008-11-20T23:21:55.857
> 
> 标签：php, zend-framework, localization, translation

我设置了整个 MVC 模型并将 HTML 视图用作模板。但是我在那里有德语字符串，我想在某个时候翻译成其他语言。

做这个的最好方式是什么？我知道我必须使用 Zend_Translate，但是我是否必须为视图模板中的每个单词实现一个对翻译函数的调用？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-21T08:15:44.280

首先，我建议使用完整的短语作为翻译的基础。对于单词，您总是会遇到语言在句子结构方面不一致的问题。

然后您必须选择可用的 Zend_Transalate 适配器之一：Array、Csv、Gettext、Ini、Tbx、Tmx、Qt、Xliff 或 XmlTm。它们中的大多数都是用于存储翻译信息的行业标准的适配器，因此如果您选择 Array、Csv 或 Ini 作为开始和易用性就足够了。请参见[49.2.1。](http://framework.zend.com/manual/en/zend.translate.adapter.html)如何在 Zend Framework 手册中[决定使用哪个翻译适配器。](http://framework.zend.com/manual/en/zend.translate.adapter.html)

```
// setup your translation
$translate = new Zend_Translate('csv', '/my/path/source-de.csv', 'de');
$translate->addTranslation('/my/path/source-en.csv', 'en');
// add the translation adapter to the registry
Zend_Registry::set('Zend_Translate', $translate); 
```

由于有一个`Zend_View_Helper_Translate`将标准化`Zend_Registry`条目`Zend_Translate`作为默认翻译源访问，因此您可以在视图中使用以下内容：

```
[...]
<title><?php echo this->translate('Title'); ?></title>
[...]
<p>You can also do <?php echo $this->translate('Hello %1$s', $this->userName); ?></p>
[...] 
```

请注意，这只是`Zend_Translate`对该组件提供的功能的简短介绍，绝不是完整的介绍。例如，关于确定翻译适配器将使用的语言环境有很多话要说。

我建议您阅读 Zend Framework 手册中的以下内容，因为本地化可能是一个复杂的问题，`Zend_Translate`无法在此处完整描述：

*   [53.4.1.13。翻译助手](http://framework.zend.com/manual/en/zend.view.helpers.html#zend.view.helpers.initial.translate)
*   [第 49 章 Zend_Translate](http://framework.zend.com/manual/en/zend.translate.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T09:06:10.497

不，您不必翻译每个单词。这种意义上的翻译理念更像是一种信息翻译理念。

在我目前的项目中，我们进行两种类型的翻译。当它只是一个简短的文本时，为了便于阅读，我们直接将其输入到源代码中。

IE

```
<?=$this->translate('Add');?>
<?=$this->translate('Delete');?>
<?=$this->translate('Are you sure you want to delete %1$s?', $thing);?> 
```

但是如果消息比较长，我们通常会按照一个标准来给翻译系统做标记：

```
<?=$this->translate('controller-action_form-information');?> 
```

这个想法是您可以在翻译工具中用很长的文本替换它，并保持视图脚本整洁。

# asp.net - log4net - 希望为每个 Web 应用程序用户创建一个日志文件

> ID：307279
> 
> 赞同：3
> 
> 时间：2008-11-20T23:26:04.850
> 
> 标签：asp.net, log4net

我们在我们的 Asp.Net Web 应用程序中使用 log4net（替换 nLog）。nLog 有一个有用的特性，它允许我们为每个用户创建一个日志文件——这有助于组织和定位日志语句。

有人对如何使用 log4net 执行此操作有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-20T23:35:59.087

与其记录到文件，不如考虑记录到数据库表，并将用户 ID 作为记录数据的一部分。通过这种方式，您可以根据用户（或多个用户）对表进行选择，并且只查看他们的数据。可能还想记录会话 ID，以简化基于会话的查询。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-09-01T10:27:25.953

在 global.asax 文件的 session_start 事件处理程序中以编程方式实例化一个新的 RollingFileAppender。这样，您可以为每个用户获取一个不同的文件，例如将文件命名为 [username]myapp.log 。我知道，这是一个老问题，但对某人来说总是很方便:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T00:51:57.063

一种方法是编写自己的附加程序，例如从 RollingFileAppender 派生

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-12-19T06:07:21.253

我只是登录到一个文件，然后当我想查看特定用户的会话时，使用一个不错的日志查看程序（如[LogExpert ）按用户名等进行过滤。](http://www.log-expert.de/)

![在此处输入图像描述](https://i.stack.imgur.com/9T6xS.jpg)

# haskell - Haskell 函数定义和缓存数组

> ID：307287
> 
> 赞同：11
> 
> 时间：2008-11-20T23:31:13.310
> 
> 标签：haskell, memoization

我有一个关于在 Haskell 中使用数组实现缓存（记忆）的问题。以下模式有效：

```
f = (fA !)
  where fA = listArray... 
```

但这不是（程序的速度表明每次调用或其他东西都会重新创建数组）：

```
f n = (fA ! n)
  where fA = listArray... 
```

在 where 子句之外（在“全局范围”中）定义 fA 也适用于任一模式。

我希望有人能指出我对上述两种模式之间区别的技术解释。

请注意，我使用的是最新的 GHC，我不确定这只是编译器的特性还是语言本身的一部分。

编辑： ！用于数组访问，所以 fA ！5 表示 C++ 语法中的 fA[5]。我对 Haskell 的理解是 (fA !) n 将与 (fA ! n) 相同......而且对我来说写“fn = fA ! n”（不带括号）会更传统。无论如何，无论我如何括号，我都会得到相同的行为。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-21T12:01:39.350

Haskell 标准未指定行为差异。它所要说的是功能是相同的（在给定相同输入的情况下将产生相同的输出）。

然而，在这种情况下，有一种简单的方法可以预测大多数编译器所遵循的时间和内存性能。我再次强调这不是必需的，只是大多数编译器都会这样做。

首先将您的两个示例重写为纯 lambda 表达式，扩展该部分：

```
f = let fA = listArray ... in \n -> fA ! n
f' = \n -> let fA = listArray ... in fA ! n 
```

编译器使用 let 绑定来指示共享。保证是在给定的环境中（一组局部变量，lambda body，类似的东西），不带参数的 let 绑定的右侧最多会被评估一次。前者 fA 的环境是整个程序，因为它不在任何 lambda 下，而后者的环境较小，因为它在 lambda 下。

这意味着在后者中，*可以*对每个不同的 n 评估一次 fA，而在前者中这是被禁止的。

即使使用多参数函数，我们也可以看到这种模式的效果：

```
g x y = (a ! y) where a = [ x ^ y' | y' <- [0..] ]
g' x = (\y -> a ! y) where a = [ x ^ y' | y' <- [0..] ] 
```

然后在：

```
let k = g 2 in k 100 + k 100 
```

我们可能会多次计算 2^100，但在：

```
let k = g' 2 in k 100 + k 100 
```

我们只会计算一次。

如果您正在使用 memoization，我建议在 Hackage 上使用 data-memocombinators，它是一个包含不同形状的 memo 表的库，因此您不必自己动手。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-21T00:26:28.237

找出发生了什么的最好方法是告诉编译器输出它的中间表示`-v4`。输出内容繁多且有点难以阅读，但应该可以让您准确找出生成代码的差异，以及编译器是如何到达那里的。

您可能会注意到`fA`在您的第一个示例中它被移到了函数之外（到“全局范围”）。在您的第二个示例中，它可能不是（这意味着它将在每次调用时重新创建）。

它没有被移出函数的一个可能原因是编译器认为它取决于`n`. `n`在您的工作示例中，没有`fA`依赖。

但我认为编译器`fA`在第二个示例中避免移动到外部的原因是因为它试图避免空间泄漏。考虑一下如果`fA`不是您的数组，而是一个无限列表（您在其上使用了`!!`运算符）会发生什么。想象一下，您曾经用大数字（例如`f 10000`）调用它，后来只用小数字（`f 2`, `f 3`, `f 12`...）调用它。先前调用的 10000 个元素仍在内存中，浪费空间。因此，为避免这种情况，`fA`每次调用函数时编译器都会再次创建。

避免空间泄漏可能不会在您的第一个示例中发生，因为在这种情况下`f`实际上只调用一次，返回一个闭包（我们现在处于纯函数和命令世界的前沿，所以事情变得更加微妙） . 这个闭包替换了原来的函数，它永远不会被再次调用，所以`fA`只被调用一次（因此优化器可以随意将它移到函数之外）。在您的第二个示例中，`f`不会被闭包替换（因为它的值取决于参数），因此将再次被调用。

如果您想尝试了解更多内容（这将有助于阅读`-v4`输出），您可以查看[Spineless Tagless G-Machine](http://research.microsoft.com/~simonpj/Papers/spineless-tagless-gmachine.ps.gz)论文（[citeseer 链接](http://citeseer.ist.psu.edu/peytonjones92implementing.html)）。

至于你的最后一个问题，我认为这是编译器的特性（但我可能是错的）。但是，如果所有编译器都做同样的事情，即使它不是语言的一部分，我也不会感到惊讶。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T19:02:21.810

很酷，感谢您的回答，这对您有很大帮助，我一定会查看 Hackage 上的 data-memocombinators。来自 C++-heavy 背景，我一直在努力理解 Haskell 将用给定程序做什么（主要是在复杂性方面），这些教程似乎没有涉及。

# web-services - 一组 Web 服务的一个日志文件和一个错误处理程序 - 可能吗？

> ID：307289
> 
> 赞同：0
> 
> 时间：2008-11-20T23:32:52.510
> 
> 标签：web-services, logging, error-handling, log4net

我们有一组 Web 服务，这也是我们的内部 API。它们完美地共享一个通用的 web.config 文件。

有没有办法让 log4net 为整个站点创建一个日志，为所有站点创建一个日志？并有共同的错误处理程序？我认为他们都是独立的虚拟目录，独立的应用程序......的问题？

但是同样...他们共享相同的 web.config 文件并且工作正常...他们可以以某种方式共享 global.asax 或其他什么吗？不能让它工作...

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-12T21:21:12.587

从 log4net 的[常见问题解答](http://logging.apache.org/log4net/release/faq.html)：

> 如何让多个进程登录到同一个文件？
> 
> 默认情况下，FileAppender 在记录时对日志文件持有独占写入锁。这可以防止其他进程写入文件。FileAppender 可以配置为使用不同的锁定模型 MinimalLock，它仅在写入日志时获取写入锁。这允许多个进程交错写入同一个文件，尽管会降低性能。有关 MinimalLock 配置的示例，请参阅 FileAppender 配置示例。
> 
> 虽然 MinimalLock 模型可用于交叉写入单个文件，但它可能不是最佳解决方案，尤其是在从多台机器进行日志记录时。或者，您可能有一个或多个进程记录到 RemotingAppenders。使用 RemoteLoggingServerPlugin（或 IRemoteLoggingSink），进程可以接收所有事件并将它们记录到单个日志文件中。

如果没有额外的配置，log4net 会对文件设置一个排他锁。使用他们的 MinimalLock 设置，您可以“希望”获得共享日志记录。换句话说，您的里程可能会有所不同。

作为建议的替代策略，由于您有一个带有 Web 服务的内部 API，请考虑一种 Web 服务方法，该方法在后台实现单个私有静态记录器并将条目添加到日志中。您可以从要实现日志记录的其他 Web 方法调用日志记录 Web 方法（如果性能很关键，则异步调用）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T00:05:11.837

他们都在同一个项目中吗？他们是 ASMX 服务吗？如果是这样，您可以将它们放在同一个虚拟目录中，应该没有问题。

# algorithm - 谷歌“你的意思是什么？” 算法工作？

> ID：307291
> 
> 赞同：457
> 
> 时间：2008-11-20T23:34:51.913
> 
> 标签：algorithm, machine-learning, nlp, spell-checking, text-search

我一直在为投资组合管理工具开发一个内部网站。有很多文本数据、公司名称等。一些搜索引擎能够非常快速地响应“您的意思是：xxxx”的查询，这给我留下了深刻的印象。

我需要能够智能地接受用户查询，并且不仅可以使用原始搜索结果进行响应，还可以使用“您的意思是吗？” 当有一个很可能的替代答案等时的响应

[我在[ASP.NET](http://en.wikipedia.org/wiki/ASP.NET)中开发（VB - 不要反对我！）]

更新：好的，如果没有数百万“未付费用户”，我怎么能模仿呢？

*   为每个“已知”或“正确”术语生成拼写错误并执行查找？
*   其他一些更优雅的方法？

* * *

## 回答 #1

> 赞同：384
> 
> 时间：2008-11-20T23:58:45.657

这是直接来自源的解释（几乎）

## **[搜索 101！](http://www.youtube.com/watch?v=syKY8CrHkck#t=22m03s)**

22:03 分

值得一看！

基本上，根据谷歌前首席技术官 Douglas Merrill 的说法，它是这样的：

1）你在谷歌写了一个（拼错的）词

2）你没有找到你想要的（不要点击任何结果）

3) 你意识到你拼错了这个词，所以你在搜索框中重写了这个词。

4）你找到你想要的（你点击第一个链接）

这种模式乘以数百万倍，显示了最常见的拼写错误和最“常见”的更正。

这样，谷歌几乎可以立即提供每种语言的拼写纠正。

这也意味着如果一夜之间每个人都开始拼写“晚上”，谷歌会建议这个词。

**编辑**

@ThomasRutter：道格拉斯将其描述为“统计机器学习”。

他们知道谁更正了查询，因为他们知道哪个查询来自哪个用户（使用 cookie）

如果用户执行查询，并且只有 10% 的用户点击了一个结果，而 90% 的用户返回并输入另一个查询（使用更正的单词），而这次 90% 的用户点击了一个结果，那么他们就知道他们找到了一个修正。

他们还可以知道这些是否是两个不同的“相关”查询，因为他们拥有所显示的所有链接的信息。

此外，他们现在将上下文包含在拼写检查中，因此他们甚至可以根据上下文建议不同的单词。

请参阅此[google wave](http://www.youtube.com/watch?v=v_UyVmITiYQ#t=44m06s) (@44m 06s) 演示，该演示显示了如何考虑上下文以自动更正拼写。

[这里](http://www.youtube.com/watch?v=Sx3Fpw0XCXk)解释了自然语言处理是如何工作的。

最后，这是一个很棒的演示，展示了在混合中添加自动[机器翻译](http://www.youtube.com/watch?v=v_UyVmITiYQ#t=1h12m47s)(@1h 12m 47s) 可以做什么。

[我已经在视频中添加了分钟和秒的锚点以直接跳到内容，如果它们不起作用，请尝试重新加载页面或手动滚动到标记处。]

* * *

## 回答 #2

> 赞同：110
> 
> 时间：2008-11-20T23:41:37.517

前段时间我发现了这篇文章：[**如何编写拼写校正器**](http://www.norvig.com/spell-correct.html)，由[Peter Norvig](https://en.wikipedia.org/wiki/Peter_Norvig)（Google Inc. 研究总监）撰写。

这是一本关于“拼写更正”主题的有趣读物。这些示例是用 Python 编写的，但它清晰易懂，我认为该算法可以很容易地翻译成其他语言。

下面是对该算法的简短描述。该算法包括两个步骤，准备和单词检查。

**第一步：准备——建立词库**

最好是您可以使用实际的搜索词及其出现。如果您没有这样的大量文本，则可以改用。计算每个单词的出现次数（流行度）。

**步骤 2\. 单词检查 - 查找与所检查的单词相似的单词**

类似意味着编辑距离较低（通常为 0-1 或 0-2）。编辑距离是将一个单词转换为另一个单词所需的最小插入/删除/更改/交换次数。

从上一步中选择最流行的单词并建议将其作为更正（如果不是单词本身）。

* * *

## 回答 #3

> 赞同：60
> 
> 时间：2008-11-21T00:55:31.750

关于“你的意思是”算法的理论，你可以参考信息检索导论的第 3 章。它可以免费[在线](http://nlp.stanford.edu/IR-book/pdf/irbookonlinereading.pdf)获得。[第 3.3 节](http://nlp.stanford.edu/IR-book/html/htmledition/spelling-correction-1.html)（第 52 页）准确回答了您的问题。并且要专门回答您的更新，您只需要一个单词字典就可以了（包括数百万用户）。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-11-20T23:45:57.930

嗯......我认为谷歌使用他们庞大的数据语料库（互联网）来做一些严肃的 NLP（自然语言处理）。

例如，他们拥有来自整个互联网的大量数据，以至于他们可以计算出三个单词序列（称为三元组）出现的**次数**。因此，如果他们看到类似“pink frugr concert”这样的句子，他们可以看到它的点击率很少，然后在他们的语料库中找到最有可能的“pink * Concert”。

不过，他们显然只是对 Davide Gualano 所说的话做了一个变体，所以一定要阅读那个链接。谷歌当然会使用它所知道的所有网页作为语料库，因此它的算法特别有效。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-11-20T23:57:13.430

我的猜测是，他们结合了[Levenshtein 距离](http://en.wikipedia.org/wiki/Levenshtein_distance)算法和他们收集的有关运行搜索的大量数据。他们可以从输入的搜索字符串中提取一组 Levenshtein 距离最短的搜索，然后选择结果最多的搜索。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-04-16T18:07:37.297

通常，生产拼写校正器使用几种方法来提供拼写建议。有些是：

*   决定一种方法来确定是否需要进行拼写更正。这些可能包括结果不足、结果不够具体或不够准确（根据某种衡量标准）等。然后：

*   使用大量文本或字典，其中所有或大部分已知拼写正确。这些很容易在网上找到，比如[LingPipe](http://alias-i.com/lingpipe/)。然后，要确定最佳建议，您需要根据几个度量来寻找最接近匹配的单词。最直观的是相似字符。通过研究和实验表明，两个或三个字符序列匹配效果更好。（二元组和三元组）。为了进一步改善结果，请在单词开头或结尾的匹配项上权衡更高的分数。出于性能原因，将所有这些单词索引为 trigrams 或 bigrams，以便在执行查找时转换为 n-gram，并通过 hashtable 或 trie 进行查找。

*   根据字符位置使用与潜在键盘错误相关的启发式方法。所以“hwllo”应该是“hello”，因为“w”接近“e”。

*   使用语音键（Soundex、Metaphone）来索引单词并查找可能的更正。在实践中，这通常会返回比使用 n-gram 索引更差的结果，如上所述。

*   在每种情况下，您都必须从列表中选择最佳校正。这可能是距离度量，例如 levenshtein、键盘度量等。

*   对于多词短语，只有一个词可能拼写错误，在这种情况下，您可以使用剩余的词作为上下文来确定最佳匹配。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-10-04T18:07:10.097

使用[Levenshtein distance](http://en.wikipedia.org/wiki/Levenshtein_distance)，然后创建一个度量树（或 Slim 树）来索引单词。然后运行 ​​1-Nearest Neighbor 查询，您就得到了结果。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-11-21T01:17:17.153

谷歌显然建议具有最佳结果的查询，而不是那些拼写正确的查询。但是在这种情况下，可能拼写更正器会更可行，当然，您可以根据返回结果的好坏程度为每个查询存储一些值。

所以，

1.  您需要一本字典（英文或基于您的数据）

2.  使用您的字典生成一个单词格子并计算转换的概率。

3.  添加解码器以使用您的格子计算最小误差距离。当然，在计算距离时应该注意插入和删除。有趣的是，QWERTY 键盘可以最大限度地提高距离，如果你敲击彼此靠近的键。（cae 会转动汽车，cay 会变成猫）

4.  返回具有最小距离的单词。

5.  然后您可以将其与您的查询数据库进行比较，并检查其他紧密匹配是否有更好的结果。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2014-03-12T06:29:58.800

这是[我找到的最佳答案](http://norvig.com/spell-correct.html)，由 Google 的研究总监 Peter Norvig 实施和描述的拼写校正器。

如果你想了解更多关于这背后的理论，你可以阅读[他的书章节](http://norvig.com/ngrams/ch14.pdf)。

该算法的思想基于统计机器学习。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-11-20T23:45:25.513

作为一个猜测......它可以

1.  搜索单词
2.  如果找不到，请使用一些算法来尝试“猜测”这个词。

可能是来自人工智能的东西，比如 Hopfield 网络或反向传播网络，或者是其他东西“识别指纹”，恢复损坏的数据，或者 Davide 已经提到的拼写更正......

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-11-20T23:46:48.410

几年前我在这方面看到了一些东西，所以可能从那以后发生了变化，但显然他们是通过分析他们在短时间内提交非常相似查询的相同用户的日志来开始的，并根据用户的纠正方式使用机器学习他们自己。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-11-20T23:48:43.913

简单的。他们有**大量**的数据。他们有每个可能的术语的统计数据，基于它被查询的频率，以及它的哪些变体通常会产生用户点击的结果......所以，当他们看到你为搜索词输入了一个频繁的拼写错误时，他们会继续并提出建议更常见的答案。

实际上，如果拼写错误实际上是最常见的搜索词，那么算法会将其视为正确的词。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-11-21T00:57:36.257

关于您的问题如何在没有大量数据的情况下模仿行为 - 为什么不使用谷歌收集的大量数据？[下载拼写错误单词](http://www.google.com/search?hl=en&q=missqelled)的 google 搜索结果并在 HTML 中搜索“您的意思是：”。

我想现在这叫做混搭:-)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2017-06-08T04:53:15.867

除了上面的答案，如果你想自己快速实现一些东西，这里有一个建议——

### 算法

[您可以在GitHub](https://github.com/amarjeetanandsingh/spell_correct)上找到该算法的实现和详细文档。

*   使用比较器创建优先级队列。
*   创建一个 Ternay 搜索树并插入所有英文单词（来自[Norvig 的帖子](http://norvig.com/mayzner.html)）及其频率。
*   开始遍历 TST，对于 TST 中遇到的每个单词，从 input_word计算其 Levenshtein Distance( **LD )**
*   如果 LD ≤ 3，则将其放入优先队列。
*   最后从优先队列中提取 10 个单词并显示。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-07-13T11:49:50.450

你的意思是说拼写检查？如果它是拼写检查器而不是整个短语，那么我有一个关于拼写检查的链接，该算法是在 python 中开发的。检查[此链接](http://norvig.com/spell-correct.html)

同时，我还在从事包括使用文本搜索数据库的项目。我想这会解决你的问题

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2012-03-06T20:29:54.907

这是一个老问题，我很惊讶没有人建议使用 Apache Solr 的 OP。

Apache Solr 是一个全文搜索引擎，除了许多其他功能外，它还提供拼写检查或查询建议。从[文档](https://wiki.apache.org/solr/SpellCheckComponent)中：

> 默认情况下，Lucene 拼写检查器首先根据字符串距离计算的分数对建议进行排序，然后根据索引中建议的频率（如果可用）对建议进行排序。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-09-07T11:24:45.377

有一种特定的数据结构——*三元搜索树*——自然支持部分匹配和近邻匹配。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2008-11-21T01:05:37.253

最简单的方法是谷歌动态编程。

这是一种从信息检索中借来的算法，并在现代生物信息学中大量使用，以查看两个基因序列的相似程度。

最优解使用动态规划和递归。

这是一个非常解决的问题，有很多解决方案。只需搜索一下，直到找到一些开源代码。

# c# - 如何使用 AppDomain 限制静态类的范围以进行线程安全使用？

> ID：307292
> 
> 赞同：7
> 
> 时间：2008-11-20T23:34:59.980
> 
> 标签：c#, thread-safety, biztalk, appdomain

我被一个架构不佳的解决方案所困扰。它不是线程安全的！

我在解决方案中有几个共享的类和成员，在开发过程中一切都很酷......
BizTalk 击沉了我的战舰。

我们正在使用自定义 BizTalk 适配器来调用我的程序集。适配器正在调用我的代码并并行运行，所以我假设它在同一个 AppDomain 下使用多个线程。

我想做的是让我的代码在它自己的 AppDomain 下运行，这样我遇到的共享问题就不会相互混淆。

我有一个非常简单的类，BizTalk 适配器正在实例化然后运行 ​​Process() 方法。

我想在我的 Process() 方法中创建一个新的 AppDomain，因此每次 BizTalk 旋转另一个线程时，它都会有自己的静态类和方法版本。

BizTalkAdapter 代码：

```
 // this is inside the BizTalkAdapter and it is calling the Loader class //
  private void SendMessage(IBaseMessage message, TransactionalTransmitProperties properties)
    {

        Stream strm = message.BodyPart.GetOriginalDataStream();
        string connectionString = properties.ConnectionString;
        string msgFileName = message.Context.Read("ReceivedFileName", "http://schemas.microsoft.com/BizTalk/2003/file-properties") as string;

        Loader loader = new Loader(strm, msgFileName, connectionString);
        loader.Process();

        EventLog.WriteEntry("Loader", "Successfully processed: " + msgFileName);

    } 
```

这是 BizTalk 调用类：

```
public class Loader
{

    private string connectionString;
    private string fileName;
    private Stream stream;
    private DataFile dataFile;

    public Loader(Stream stream, string fileName, string connectionString)
    {
        this.connectionString = connectionString;
        this.fileName = fileName;
        this.stream = stream;
    }  

    public void Process()
    {

        //*****  Create AppDomain HERE *****
        // run following code entirely under that domain
        dataFile = new DataFile(aredStream, fileName, connectionString);
        dataFile.ParseFile();
        dataFile.Save();
        // get rid of the AppDomain here...

    }

} 
```

仅供参考：Loader 类与 dataFile 类位于单独的 DLL 中。

任何帮助，将不胜感激。我将继续致力于使代码线程安全，但我觉得这可能是“简单”的答案。

如果有人有其他想法，请提出。

谢谢你，
基思

> 只是为了完整性。
> 
> 我确实发现，如果我在“传输高级选项”对话框中将发送适配器标记为“有序交付”，我就能够避免我遇到的多线程问题。
> 
> 我认为这是我的问题的另一个可能答案，但不一定是这个问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T04:15:03.860

使用应用程序域，您可以执行以下操作：

```
public class Loader
{

    private string connectionString;
    private string fileName;
    private Stream stream;
    private DataFile dataFile;

    public Loader(Stream stream, string fileName, string connectionString)
    {
        this.connectionString = connectionString;
        this.fileName = fileName;
        this.stream = stream;
    }  

    public void Process()
    {
        //*****  Create AppDomain HERE *****
        string threadID = Thread.CurrentThread.ManagedThreadId.ToString();
        AppDomain appDomain = AppDomain.CreateDomain(threadID);

        DataFile dataFile = 
            (DataFile) appDomain.CreateInstanceAndUnwrap(
                        "<DataFile AssemblyName>", 
                        "DataFile", 
                        true, 
                        BindingFlags.Default,
                        null,
                        new object[] 
                        { 
                            aredstream, 
                            filename, 
                            connectionString 
                        },
                        null,
                        null,
                        null);
        dataFile.ParseFile();
        dataFile.Save();

        appDomain.Unload(threadID);       
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T05:28:11.140

就线程安全而言，究竟哪一点是痛苦的？我看不到任何静态或单例——而且似乎有合适的“新”对象……我是瞎了吗？

那么你看到的症状是什么...

AppDomain 的答案将（相对）慢。作为中间件支持的系统的一部分，这可能没问题（即“相对”在同一个球场中）。

如果您在某处*确实*有一些静态状态，则有时有效的另一个选项是 [ThreadStatic] - 运行时将其解释为“此静态字段对每个线程都是唯一的”。不过，您需要小心初始化 - 线程 A 上的静态构造函数可能会分配一个字段，但随后线程 B 会看到 null/0/等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T23:41:44.367

为什么不直接锁定要按顺序执行的代码呢？这将是一个瓶颈，但它应该在多线程环境中工作。

```
public class Loader
{
    private static object SyncRoot = new object();
    private string connectionString;
    private string fileName;
    private Stream stream;
    private DataFile dataFile;

    public Loader(Stream stream, string fileName, string connectionString)
    {
        this.connectionString = connectionString;
        this.fileName = fileName;
        this.stream = stream;
    }  

    public void Process()
    {

        lock(SyncRoot) {
            dataFile = new DataFile(aredStream, fileName, connectionString);
            dataFile.ParseFile();
           dataFile.Save();
        }

    }

} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T17:16:18.433

如果您有相互冲突的共享静态，那么您可能想尝试向它们添加 [ThreadStatic] 属性。这将使它们成为每个线程的本地。这可能会在短期内解决您的问题。一个正确的解决方案是简单地将你的东西重新架构为线程安全的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-22T00:31:59.367

只是为了完整性。

我确实发现，如果我在“传输高级选项”对话框中将发送适配器标记为“有序交付”，我就能够避免我遇到的多线程问题。

我认为这是我的问题的另一个可能答案，但不一定是这个问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-28T11:52:21.473

为每个呼叫创建和拆除一个 appdomain - 我认为您不担心这个的性能吗？

理想情况下，您应该将调用的代码更改为线程安全的。

# html - IE 无法正确呈现标签

> ID：307294
> 
> 赞同：1
> 
> 时间：2008-11-20T23:35:36.000
> 
> 标签：html, css, internet-explorer

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-20T23:38:25.510

您可能还想设置已访问链接的样式。

而且，我认为你不应该使用`*{...}`

它在 FF3 中运行良好。

改为：

```
#main A:link, A:Visited {

COLOR: #437fda;

BORDER-BOTTOM: #437fda 1px dashed;

TEXT-DECORATION: none

} 
```

并改变：

```
* {

PADDING-RIGHT: 0px;

PADDING-LEFT: 0px;

PADDING-BOTTOM: 0px;

MARGIN: 0px;

PADDING-TOP: 0px;

FONT-FAMILY: "trebuchet ms", Arial, Helvetica, sans-serif

} 
```

为了

```
body {

PADDING-RIGHT: 0px;

PADDING-LEFT: 0px;

PADDING-BOTTOM: 0px;

MARGIN: 0px;

PADDING-TOP: 0px;

FONT-FAMILY: "trebuchet ms", Arial, Helvetica, sans-serif

} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T23:40:01.000

我怀疑这是因为链接是内联元素。你可以使用显示：块吗？

```
#main A:link {
    ...
    display:block
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-20T23:41:57.657

你应该先验证它。
你有 html 和 xhtml 的混合体，html 标记之外的元标记，没有所需类型属性的样式标记，仅举几例，这只会给你一个痛苦的世界。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-20T23:40:47.473

尝试使用 just `#main a`，并添加单独的 a:visited 和 a:hover 选择器，如果您想以不同的方式设置它们。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-20T23:47:04.120

它是

```
#main a {
color:#437fda; 
border-bottom: 1px solid #437fda;
text-decoration:none;
}

#main a:visited {
color:#437fda; 
border-bottom: 1px solid #437fda;
text-decoration:none;
} 
```

# mysql - 如何将 SQL Server SMALLDATETIME 转换为 Unix 时间戳？

> ID：307304
> 
> 赞同：3
> 
> 时间：2008-11-20T23:40:30.263
> 
> 标签：mysql, sql-server, timestamp, smalldatetime

如何将 SQL Server SMALLDATETIME 转换为 Unix 时间戳？

日期在 MS Access DB 中存储为 CAST(0x96040474 AS SmallDateTime)。数据被转储到 SQL，我希望将这些时间转换为 MySQL 的 Unix Timestamps。

谢谢 AO

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T00:31:45.637

选择日期差异（ss，'1/1/1970'，your_date_here）

例如

选择 datediff(ss, '1/1/1970', cast('1/1/1989' as smalldatetime))

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T02:15:59.047

来自*SQL Server 2005 联机丛书*，“Transact SQL 参考”

> 数据库引擎将`smalldatetime`值存储为两个 2 字节整数。前 2 个字节存储 1900 年 1 月 1 日之后的天数。其他 2 个字节存储自午夜以来的分钟数。

因此，您似乎需要将十六进制值拆分为两个整数，并将基准日期从 1900/01/01 转换为 1970/01/01 基准日期，然后将另一个整数作为午夜过后的整数分钟。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-31T19:43:19.727

PHP 的 strtotime() 函数将使用 smalldatetime 作为参数。

# python - 用 Python 播放声音

> ID：307305
> 
> 赞同：111
> 
> 时间：2008-11-20T23:40:34.367
> 
> 标签：python, audio, platform-independent

在 Python 中播放声音文件（.wav）的最简单方法是什么？最简单的意思是最独立的平台和需要最少的依赖项。pygame 当然是一种选择，但对于声音来说似乎有点过分了。

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2008-11-22T18:43:24.250

对于 Windows，您可以使用 winsound。它内置

```
import winsound

winsound.PlaySound('sound.wav', winsound.SND_FILENAME) 
```

您应该能够在 linux 上使用 ossaudiodev：

```
from wave import open as waveOpen
from ossaudiodev import open as ossOpen
s = waveOpen('tada.wav','rb')
(nc,sw,fr,nf,comptype, compname) = s.getparams( )
dsp = ossOpen('/dev/dsp','w')
try:
  from ossaudiodev import AFMT_S16_NE
except ImportError:
  from sys import byteorder
  if byteorder == "little":
    AFMT_S16_NE = ossaudiodev.AFMT_S16_LE
  else:
    AFMT_S16_NE = ossaudiodev.AFMT_S16_BE
dsp.setparameters(AFMT_S16_NE, nc, fr)
data = s.readframes(nf)
s.close()
dsp.write(data)
dsp.close() 
```

（ossaudiodev 的学分：Bill Dandreta [http://mail.python.org/pipermail/python-list/2004-October/288905.html](http://mail.python.org/pipermail/python-list/2004-October/288905.html)）

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-11-21T01:11:05.450

[Snack Sound Toolkit](http://www.speech.kth.se/snack/)可以播放 wav、au 和 mp3 文件。

```
s = Sound() 
s.read('sound.wav') 
s.play() 
```

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2013-07-31T18:53:10.837

这看起来很荒谬且牵强，但您始终可以使用 Windows（或您喜欢的任何操作系统）为您管理声音！

```
import os
os.system("start C:/thepathyouwant/file") 
```

简单，没有扩展，有点慢和垃圾，但工作。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-11-21T22:13:55.777

绝对为此使用[Pyglet 。](http://pyglet.org)这是一个大包，但它是纯python，没有扩展模块。这肯定是最容易部署的。它也有很好的格式和编解码器支持。

```
import pyglet

music = pyglet.resource.media('music.mp3')
music.play()

pyglet.app.run() 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2011-09-29T05:42:59.457

在 play() 命令添加 10 秒左右的延迟后，它会起作用

```
import pygame

import time

pygame.init()

pygame.mixer.music.load("test.wav")

pygame.mixer.music.play()

time.sleep(10) 
```

这也播放 .mp3 文件。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-11-20T23:45:33.937

pyMedia 的声音示例[就是这样](http://pymedia.org/tut/play_wav.html)做的。这应该是你所需要的。

```
import time, wave, pymedia.audio.sound as sound
f= wave.open( 'YOUR FILE NAME', 'rb' )
sampleRate= f.getframerate()
channels= f.getnchannels()
format= sound.AFMT_S16_LE
snd= sound.Output( sampleRate, channels, format )
s= f.readframes( 300000 )
snd.play( s ) 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-12-05T12:52:49.377

我喜欢 pygame，下面的命令应该可以工作：

```
pygame.init()
pygame.mixer.Sound('sound.wav').play() 
```

但它不在我的任何一台计算机上，并且在该主题上的帮助有限。编辑：我知道为什么 pygame 声音对我不起作用，它没有正确加载大多数声音，当我加载它们时，“长度”属性为 ~0.0002。也许使用 mygame 以外的其他东西加载它们会让它更普遍。

使用 pyglet 我得到一个资源未找到错误使用上面的示例，文件的相对路径和完整路径。

使用`pyglet.media.load()`而不是`pyglet.resource.media()`让我加载文件。

但`sound.play()`只播放文件的第一部分，除非我运行`pyglet.app.run()`它会阻止其他所有内容......

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-12-05T14:53:21.387

wxPython 支持在 Windows 和 Unix 上播放 wav 文件——我不确定这是否包括 Mac。然而，据我所知，它只支持 wav 文件 - 它不支持其他常见格式，如 mp3 或 ogg。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-03-10T14:35:44.150

我刚刚发布了一个简单的围绕 sox 的 python 包装器，它将用 Python 播放声音。它很容易安装，因为您需要 Python 2.6 或更高版本、sox（对于大多数架构来说很容易获得二进制文件）和包装器（[https://github.com/standarddeviant/sound4python](https://github.com/standarddeviant/sound4python)）。如果你没有 sox，去这里：http: [//sourceforge.net/projects/sox/files/sox/](http://sourceforge.net/projects/sox/files/sox/)

您可以通过以下方式播放音频：

```
from sound4python import sound
import random
a = []
for idx in xrange(1*16000):
    a.append(random.randint(-16384,16384))
sound(a) 
```

请记住，播放音频实际涉及的唯一部分就是这些：

```
from sound4python import sound
...
sound(a) 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-04-02T15:46:35.533

对于 Linux 用户，如果需要低级 pcm 数据操作，请尝试[alsaaudio](http://pyalsaaudio.sourceforge.net/index.html)模块。包内也有一个 playwav.py 示例。

# iphone - 在 iPhone 上保存数据的最佳方法

> ID：307313
> 
> 赞同：29
> 
> 时间：2008-11-20T23:44:06.077
> 
> 标签：iphone, objective-c

我正在编写一个 iPhone 应用程序，需要保存我的应用程序的状态（5K 左右）。

我主要担心的是数据在升级过程中仍然存在。我使用的一些应用程序显然出错了，我不想这样做！

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-11-21T03:16:21.950

为了保存状态，NSUserDefaults 是要走的路。我相信大多数（如果不是全部）在升级后删除应用程序数据的实例是由于 AppStore 上的问题造成的。它们可能与数据格式更改有关，但如果您只使用 NSUserDefaults 和标准 plist 可存储对象（NSString、NSDictionary、NSNumber、NSArray、NSNumber 和原语），您应该是安全的。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-03-12T22:32:38.130

有一种简单的方法可以做到这一点来保存：

```
NSUserDefaults *prefs = [NSUserDefaults standardUserDefaults];
[prefs setObject:@"TextToSave" forKey:@"keyToFindText"]; 
```

装载：

```
NSUserDefaults *prefs = [NSUserDefaults standardUserDefaults];
NSString *textToLoad = [prefs stringForKey:@"keyToFindText"]; 
```

重要的是您不要在`NSUserDefaults`. 如果你这样做，就有可能在苹果审查方面遇到麻烦。

通常，用户默认值用于存储短键和偏好，例如用户音量级别、是否要使用游戏中心或发送崩溃日志。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-21T04:42:58.860

这真的取决于你在做什么和你的需求。

如果是少量数据，NSUserDefaults 是一个很好的选择。您还可以将字典或数组保存到您的应用程序文档文件夹中，然后在启动时重新加载该文件。

SQLite 很好，但除非你有很多数据要查询，否则仅仅保存状态就有点过头了。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-21T03:08:30.143

我使用 sqlite 存储所有应用程序数据和首选项。为确保更新不会擦除数据，请确保 sqlite 文件存储在应用程序的 Documents 目录中，该目录不会被升级覆盖。Apple提供的一些示例代码（我认为是“SQLite Books”）具有处理此问题的代码。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-03-15T21:11:05.277

对于少量数据，NSUserDefaults 是一个完美的解决方案，如果您需要对数据进行临时查询，那么 sqlite 是您的最佳选择。这两种解决方案非常适合在设备上存储数据，如果您需要更大的灵活性和功能，您可以考虑远程数据，即 Web 服务和服务器数据库。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-02-06T16:37:44.780

[这](https://stackoverflow.com/questions/4911688/setting-up-a-plist-to-store-application-data-not-settings-for-an-iphone-game)是一个讨论链接，它提供了一个很好的示例，说明如何访问您的数据以及在某些情况下哪种类型的存储方案更有益。@Ben Gottlieb 的解决方案是目标，我只是认为这个问题会增加一个额外的资源。希望这可以帮助！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-21T00:01:47.180

保存状态（数据、应用程序信息等）的最常见方法是使用[Sqlite3](http://www.sqlite.org/)。我不确定更新将如何擦除它，但更新过程可能会覆盖数据文件。

另一种选择是使用 UserPrefs (NSUserDefaults)。同样，我不确定它的最大大小，或者即使它是否适合您需要保留的数据。

# php - 在 PHP 块中使用 die() 后如何显示静态 HTML？

> ID：307322
> 
> 赞同：1
> 
> 时间：2008-11-20T23:47:21.763
> 
> 标签：php, die

假设我有一些这样的代码：

```
<html>
<head><title>Title</title></head>
<body>

<?php
if (!$someCondition){
  die();
}
else{
  #Do something
}
?>
</body>
<html> 
```

我希望这段代码的目的很简单。如果满足某个条件（即无法连接到数据库），那么程序应该死掉，否则它应该执行。我的问题是在执行 die() 函数时出现的。它停在那里**，**只将前三行发送到浏览器，而不是最后两行。

有没有我可以使用的函数来代替 die() 以便 php 块将停止执行，但仍然发送静态 HTML 文本？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-20T23:58:59.870

将您的程序逻辑与表示分离。阅读有关 MVC、模板的信息。

最简单的形式是这样的：

```
<?php
function logic() {
    if (!$someCondition) {
        return 'display_empty_page';
    } else {
        return 'display_other_stuff';
    }
}

presentation(logic()); 
```

* * *

对于其他`die()`不可避免的情况（例如致命错误或第 3 方代码死亡），存在涉及输出处理程序的 hack：

```
ob_start('myhandler'); 
function myhandler($page) {return $page.' extra markup';}
die(); 
```

尽管我建议仅将其用于诊断/调试目的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T00:03:28.300

您应该将页眉和页脚分离到单独的文件和函数中。这使得 UI 更容易维护，并保持渲染视图的一致性。将其与使用[异常处理](http://us.php.net/Exceptions)结合起来，您就很成功了。

```
<?php

printHeader(); // outputs the html header
try
{
    if (some condition)
    {
        throw new Exception("It Died...");
    }
    // More processing here that should not execute if the above condition is true
    // ...
}
catch (Exception e)
{
    echo $e->getMessage();
}
printFooter(); // outputs the html footer

?> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T00:14:03.770

将静态文本的参数传递给 die。

例如改变这个：

```
<html>
<head><title>Title</title></head>
<body>

<?php
if (!$someCondition){
  die();
}
else{
  #Do something
}
?>
</body>
<html> 
```

对此：

```
<html>
<head><title>Title</title></head>
<body>

<?php
if (!$someCondition){
  die("OMG RED ALERT!!!!</body></html>");
}
else{
  #Do something
}
?>
</body>
<html> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-20T23:53:30.020

我可能会使用例外。将所有内容包装在一个 try/catch 块中，然后在数据库故障等错误条件下抛出一个新异常。你可以在 catch 块中什么都不做（比如一个空的 die() 方法），但是在这里向用户显示一条错误消息会更好。

如果你不熟悉它们或者你需要复习自 PHP4 以来的变化，这里有一个关于 PHP5 异常处理的[非常好的指南。](http://www.andreashalter.ch/phpug/20040115/index.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-20T23:48:54.680

一种有效但不完全是我正在寻找的方法是替换`die()`为`die("</body></html>")`. 如果要返回的文本比这更复杂，则可以将其存储在变量中。还有什么比这更好的吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T23:55:37.427

`die()`可能不是你想要的。为什么不换

```
if (!$someCondition) { 
    die();
} else {
    /* do stuff */
} 
```

和

```
if ($someCondition) {
    /* do stuff */
} else {
    /* output error message/redirect/output nothing/whatever */
} 
```

或抛出/捕获异常？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-21T00:18:43.760

您是否考虑过使用[`register_shutdown_function`](http://us3.php.net/manual/en/function.register-shutdown-function.php)(php.net) 来完成页面加载？它应该能够处理`die()`和`exit()`。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-21T00:53:06.513

如果您查看[PHP 文档](http://www.php.net/die)，您会看到“等效于 exit()”——即调用它会终止您的程序，并且实际上并没有给您太多做任何事情的机会。即使在 ZF 之外，当应用程序 die()s 时，您也无能为力。解决方案是使用异常。

未捕获的异常本质上与 die() 相同（生成的堆栈跟踪除外）。异常为您提供的是将其放入 try/catch 块中的能力，使您有机会更正错误并继续执行程序（或显示友好的错误消息并生成日志）。假设您正在使用 Zend_Controller_Front，您可以查看[Zend Framework Quickstart](http://framework.zend.com/docs/quickstart)以了解他们如何创建一个默认错误处理程序，该处理程序将捕获未捕获的异常并显示适当的错误消息。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-21T02:10:15.283

如果您正在使用 PHP4，或者只是不想打扰异常，那么您可以使用这种技术：

```
<html>
<head><title>Title</title></head>
<body>

<?php
do {
    if (!$someCondition){
          break;
    } else {
          #Do something
    }
} while (0);
?>
</body>
<html> 
```

.. 虽然有些人似乎很反对使用这种风格，但适当地评论说，我认为它没有任何问题。我想说这比在每个 die() 语句中复制“页脚”代码要好得多。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-06-24T13:50:57.823

```
<html>
<head><title>Title</title></head>
<body>

<?php
if (!$someCondition){
header ("location:error_page.php?erro_message='This error occured'");

  die();
}
else{
  #Do something
}
?>
</body>
<html> 
```

### error_page.php

```
header
echo $_GET[$error_message];
footer 
```

# java - DOM 类 API，用于在 Java 中使用 XQuery

> ID：307329
> 
> 赞同：1
> 
> 时间：2008-11-20T23:51:34.907
> 
> 标签：java, xquery

是否有一些用于从 XQuery 字符串创建对象模型的开源 Java API（最好不是 GPL）？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-18T13:15:29.160

Saxon 中有一个非常快速和强大的实现：http: [//www.saxonica.com/index.html](http://www.saxonica.com/index.html)

我在生产代码中多次使用它，它非常好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T20:44:18.870

[http://code.google.com/p/xqpretty/](http://code.google.com/p/xqpretty/) 是具有 Apache 2.0 许可证的基于 ANTLR 的实现

它不完全是一个对象模型，而是产生了一个完整的 AST。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T07:46:00.613

[http://www.gnu.org/software/qexo/](http://www.gnu.org/software/qexo/)

高温高压

# asp.net-mvc - 覆盖 System.Web.Mvc.ViewMasterPage，在哪里调用从缓存中抓取？

> ID：307332
> 
> 赞同：0
> 
> 时间：2008-11-20T23:54:36.163
> 
> 标签：asp.net-mvc, inheritance, master-pages

我需要从 HttpCONtext.Items 请求缓存中获取一个值，我应该在哪里执行此操作？

是否有我应该覆盖的特定事件或构造函数？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T02:09:35.330

ViewMasterPage 是 Control 的子类；你应该能够在正常的页面事件周期中得到它：

```
namespace MvcDemo.Views.Shared {
    public partial class Site : System.Web.Mvc.ViewMasterPage {
        protected override void OnLoad(EventArgs e) {
            string nowWhat = Context.Items["nowWhat"] as string;
            base.OnLoad(e);
        }
    }
} 
```

# .net - 代码隐藏中的 ITemplate 和 DataGrid 列

> ID：307333
> 
> 赞同：7
> 
> 时间：2008-11-20T23:55:19.470
> 
> 标签：.net, asp.net, datagrid, itemplate

我有一种情况，我需要使用数据网格并在 PageInit 中动态添加列，因为网格有一些必须处理的条件请求。我很容易使用 BoundColumns 和 ButtonColumns，这些都很容易。问题在于通过代码创建 TemplateColumn。我已经找到了有关创建自定义类的示例，该自定义类通过创建使用 ITemplate 实现的类来动态添加控件。这行得通，但是，我正在努力解决如何对元素进行数据绑定。

在我的网格中，我会使用 <%= DataBinder.Eval(Container.DataItem, "MyValue") %> 或类似的，但这不是一个选项。ITemplate 中的容器也没有数据项属性，所以我不能在那里绑定。任何人都有可能有帮助的建议或链接，我只是在谷歌中找不到合适的东西。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-21T02:58:07.323

您可以将事件处理程序附加到您在 ITemplate.InstantiateIn 中创建的控件的 DataBinding 事件，如[本 MSDN 文章](http://msdn.microsoft.com/en-us/library/system.web.ui.control.databinding.aspx)中所述。发送者将是控件，而 NamingContainer 属性将是 DataGridItem，它具有对 DataItem 的引用，您可以使用它来获取所需的任何数据。

# dom - Safari 中带有按钮的 DOM 问题

> ID：307334
> 
> 赞同：1
> 
> 时间：2008-11-20T23:55:25.447
> 
> 标签：dom, button, safari, back

我想知道是否有人以前见过这个问题。

我在网页上有两个按钮。当我离开页面并点击后退按钮返回时，一个按钮的值被放置在另一个按钮的值中。

例如

```
<input class="SmallData" type="submit" id="logButton" value="Log In" tabindex="93"></input>

<input class="btn" type="submit" id="acBtn" value="Detailed Quote"></input> 
```

当我回到页面详细报价替换登录例如

```
<input class="SmallData" type="submit" id="logButton" value="Detailed Quote" tabindex="93"></input> 
```

没有 JavaScript 导致这种情况发生。我查看源代码，一切看起来都很好，但我检查了 DOM，我可以看到存在不同的值。

是否有关于 web kit 如何处理使用后退按钮时损坏的 dom？

谢谢，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-12T13:49:55.467

尝试给每个输入元素一个 name="some_unique_name" 属性——看看这是否有助于 Safari 区分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-22T01:10:45.730

可能是因为有两个提交按钮...？

只是我的“随机”建议...... :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T01:22:51.293

检查 Chrome 中是否发生同样的事情（如果您可以访问 Windows 框），看看它是 WebKit 问题还是 Safari 本身。

# python - 为 python 独立可执行文件创建插件

> ID：307338
> 
> 赞同：5
> 
> 时间：2008-11-20T23:55:52.607
> 
> 标签：python, plugins, py2exe, pyinstaller

如何为使用 pyInstaller、py2exe 或类似工具创建的独立可执行文件创建一个好的插件引擎？

我没有使用 py2exe 的经验，但是 pyInstaller 使用导入钩子从它的压缩存储库中导入包。当然，我可以动态导入另一个使用 pyInstaller 创建的压缩存储库并执行代码——这可能是一个简单的插件引擎。

当插件（这是动态导入的）使用原始存储库中不存在的库（从未导入）时会出现问题。这是因为导入钩子用于原始应用程序并在原始存储库中搜索包 - 而不是后来导入的包（插件包存储库）。

有没有简单的方法来解决这个问题？也许存在这样的引擎？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T01:17:47.730

编译为exe时，您将遇到此问题。

我能想到的允许用户使用他们的插件访问以使用任何 python 库的唯一选择是将所有库包含在 exe 包中。

将支持的库限制为一个子集并将其列在文档中可能是个好主意。由你决定。

我只用过py2exe。

**在 py2exe 中，您可以指定在setup.py**文件中搜索时未找到的库。

这是一个示例：

```
from distutils.core import setup
import py2exe

setup (name = "script2compile",
       console=['script2compile.pyw'],
       version = "1.4",
       author = "me",
       author_email="somemail@me.com",
       url="myurl.com",
       windows = [{
                    "script":"script2compile.pyw",
                    "icon_resources":[(1,"./ICONS/app.ico")]  # Icon file to use for display
                 }],
       # put packages/libraries to include in the "packages" list
       options = {"py2exe":{"packages": [   "pickle",
                                            "csv",
                                            "Tkconstants",
                                            "Tkinter",
                                            "tkFileDialog",
                                            "pyexpat",
                                            "xml.dom.minidom",
                                            "win32pdh",
                                            "win32pdhutil",
                                            "win32api",
                                            "win32con",
                                            "subprocess", 
                                        ]}} 

       )

import win32pdh
import win32pdhutil
import win32api 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-05T13:49:24.507

PyInstaller*确实*有一个用于处理隐藏导入的插件系统，并附带了其中的几个。请参阅网页（[http://www.pyinstaller.org](http://www.pyinstaller.org)），其中显示：

> PyInstaller 的主要目标是与开箱即用的第 3 方包兼容。这意味着，使用 PyInstaller，使外部包工作所需的所有技巧都已集成在 PyInstaller 本身中，因此无需用户干预。您永远不需要在 wiki 中寻找技巧并对您的文件或设置脚本应用自定义修改。查看我们的 SupportedPackages 兼容性列表。

# c++ - 转发声明一个标准容器？

> ID：307343
> 
> 赞同：50
> 
> 时间：2008-11-20T23:58:32.180
> 
> 标签：c++, header, c++-standard-library

是否可以在头文件中转发声明标准容器？例如，采用以下代码：

```
#include <vector>

class Foo
{
private:
    std::vector<int> container_;
    ...
}; 
```

我希望能够做这样的事情：

```
namespace std
{
    template <typename T> class vector;
}

class Foo
{
private:
    std::vector<int> container_;
    ...
}; 
```

这可以做到吗？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-11-21T00:30:37.357

`vector`在命名空间中声明`std`是**未定义的行为**。因此，您的代码可能有效，但也可能无效，并且编译器没有义务告诉您您的尝试何时无效。这是一场赌博，我不知道避免包含标准 C++ 标头是否值得。

请参阅以下 comp.std.c++.moderated 讨论：

[向前声明 std::vector。有效，但它是否符合法律和标准？](http://groups.google.com/group/comp.lang.c++.moderated/browse_thread/thread/5c12858c636ab833/6cd57590509ad6b4)

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-11-21T00:00:07.247

我不这么认为，因为编译器无法知道要为对象分配多少空间`container_`。充其量你可以这样做：

```
std::vector<int> *container_; 
```

并在构造函数中新建它，因为编译器知道指针的大小。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-10-13T10:16:21.067

除了其他人所说的之外，您可能会发现知道有一种被认可的方式来前向声明 iostream 和一些相关模板是很有用的： header `<iosfwd>`。如果标准有更多这样的标题，那将会很有用。

# mfc - 如何绘制 32 位 alpha 通道位图？

> ID：307348
> 
> 赞同：11
> 
> 时间：2008-11-20T23:59:39.803
> 
> 标签：mfc, alphablending, bmp

我需要创建一个自定义控件来显示带有 alpha 通道的 bmp 图像。背景可以用不同的颜色绘制，图像有阴影，所以我需要真正“绘制”阿尔法通道。

有人知道怎么做吗？

如果可能的话，我还希望使用 alpha 通道信息创建一个蒙版，以了解鼠标是点击了图像还是透明区域。

任何形式的帮助将不胜感激！

谢谢。

已编辑（JDePedro）：正如你们中的一些人所建议的那样，我一直在尝试使用 alpha blend 来绘制带有 alpha 通道的位图。这只是我实施的一个测试，我从资源中加载 32 位位图，并尝试使用 AlphaBlend 函数对其进行绘制：

```
void CAlphaDlg::OnPaint()
{
    CClientDC dc(this);
    CDC  dcMem;
    dcMem.CreateCompatibleDC(&dc);

    CBitmap bitmap;
    bitmap.LoadBitmap(IDB_BITMAP);

    BITMAP BitMap;
    bitmap.GetBitmap(&BitMap);
    int nWidth = BitMap.bmWidth;
    int nHeight = BitMap.bmHeight;
    CBitmap *pOldBitmap = dcMem.SelectObject(&bitmap);

    BLENDFUNCTION m_bf;
    m_bf.BlendOp = AC_SRC_OVER;
    m_bf.BlendFlags = 0;
    m_bf.SourceConstantAlpha = 255;
    m_bf.AlphaFormat = AC_SRC_ALPHA;
    AlphaBlend(dc.GetSafeHdc(), 100, 100, nWidth, nHeight, dcMem.GetSafeHdc(), 0, 0,nWidth, nHeight,m_bf); 

    dcMem.SelectObject(pOldBitmap);

    CDialog::OnPaint();
} 
```

这只是一个测试，所以我将代码放在对话框的 OnPaint 中（我还尝试了 CDC 对象的 AlphaBlend 函数）。

不透明区域被正确绘制，但在位图应该透明的地方我得到白色。

有什么帮助？？？

这是一个屏幕截图..它不容易看到，但蓝色圆圈周围有一个白色矩形： [alt text http://img385.imageshack.us/img385/7965/alphamh8.png](http://img385.imageshack.us/img385/7965/alphamh8.png)

行。我得到了它！我必须为 alpha 值预乘每个像素。有人可以建议优化的方法吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2013-06-19T08:55:25.073

对于未来的谷歌用户，这是一个有效的预乘函数。请注意，这是从[http://www.viksoe.dk/code/alphatut1.htm 获取](http://www.viksoe.dk/code/alphatut1.htm)的。

```
inline void PremultiplyBitmapAlpha(HDC hDC, HBITMAP hBmp)
{
   BITMAP bm = { 0 };
   GetObject(hBmp, sizeof(bm), &bm);
   BITMAPINFO* bmi = (BITMAPINFO*) _alloca(sizeof(BITMAPINFOHEADER) + (256 * sizeof(RGBQUAD)));
   ::ZeroMemory(bmi, sizeof(BITMAPINFOHEADER) + (256 * sizeof(RGBQUAD)));
   bmi->bmiHeader.biSize = sizeof(BITMAPINFOHEADER);
   BOOL bRes = ::GetDIBits(hDC, hBmp, 0, bm.bmHeight, NULL, bmi, DIB_RGB_COLORS);
   if( !bRes || bmi->bmiHeader.biBitCount != 32 ) return;
   LPBYTE pBitData = (LPBYTE) ::LocalAlloc(LPTR, bm.bmWidth * bm.bmHeight * sizeof(DWORD));
   if( pBitData == NULL ) return;
   LPBYTE pData = pBitData;
   ::GetDIBits(hDC, hBmp, 0, bm.bmHeight, pData, bmi, DIB_RGB_COLORS);
   for( int y = 0; y < bm.bmHeight; y++ ) {
      for( int x = 0; x < bm.bmWidth; x++ ) {
         pData[0] = (BYTE)((DWORD)pData[0] * pData[3] / 255);
         pData[1] = (BYTE)((DWORD)pData[1] * pData[3] / 255);
         pData[2] = (BYTE)((DWORD)pData[2] * pData[3] / 255);
         pData += 4;
      }
   }
   ::SetDIBits(hDC, hBmp, 0, bm.bmHeight, pBitData, bmi, DIB_RGB_COLORS);
   ::LocalFree(pBitData);
} 
```

那么你的 OnPaint 变成：

```
void MyButton::OnPaint()
{
    CPaintDC dc(this);

    CRect rect(0, 0, 16, 16);

    static bool pmdone = false;
    if (!pmdone) {
        PremultiplyBitmapAlpha(dc, m_Image);
        pmdone = true;
    }

    BLENDFUNCTION bf;
    bf.BlendOp = AC_SRC_OVER;
    bf.BlendFlags = 0;
    bf.SourceConstantAlpha = 255;
    bf.AlphaFormat = AC_SRC_ALPHA;

    HDC src_dc = m_Image.GetDC();
    ::AlphaBlend(dc, rect.left, rect.top, 16, 16, src_dc, 0, 0, 16, 16, bf);
    m_Image.ReleaseDC();
} 
```

以及图像的加载（在您的控件的构造函数中）：

```
if ((HBITMAP)m_Image == NULL) {
    m_Image.LoadFromResource(::AfxGetResourceHandle(), IDB_RESOURCE_OF_32_BPP_BITMAP);
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-21T18:06:28.553

我通常这样做的方式是通过 DIBSection - 一个与设备无关的位图，您可以直接修改其像素。不幸的是，没有任何 MFC 支持 DIBSection：您必须使用 Win32 函数 CreateDIBSection() 才能使用它。

首先将位图加载为 32 位 RGBA（即每个像素四个字节：一个红色、一个绿色、一个蓝色和一个用于 Alpha 通道）。在控件中，创建一个适当大小的 DIBSection。然后，在绘画程序中

*   将位图数据复制到 DIBSection 的位图数据中，使用 alpha 通道字节将位图图像与背景颜色混合。
*   创建一个设备上下文并在其中选择 DIBSection。
*   使用 BitBlt() 从新设备上下文复制到绘制设备上下文。

您可以简单地通过查看 Alpha 通道值来创建一个给定原始位图数据的蒙版 - 我不确定您在这里问什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T00:13:03.943

您需要对背景颜色进行[Alpha 混合](http://en.wikipedia.org/wiki/Alpha_Blend)，然后取出 Alpha 通道以将其绘制到控件上。

alpha 通道应该是图像的每 4 个字节。您可以直接将它用于您的掩码，或者您可以将每 4 个字节复制到一个新的掩码图像。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T23:39:24.840

[使用AlphaBlend 功能](http://msdn.microsoft.com/en-us/library/ms532324(VS.85).aspx)绘制它非常容易。

至于您的掩码，您需要[获取位](http://msdn.microsoft.com/en-us/library/ms532334(VS.85).aspx)图的位并检查您感兴趣的每个像素的 alpha 通道字节。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-02T10:15:34.570

将 RGB 通道与 alpha 通道预乘的优化方法是设置一个包含计算乘法结果的 [256][256] 数组。第一个维度是 alpha 值，第二个维度是 R/G/B 值，数组中的值是您需要的预乘值。

正确设置此数组后，您可以像这样计算所需的值：

```
R = multiplicationLookup[alpha][R];
G = multiplicationLookup[alpha][G];
B = multiplicationLookup[alpha][B]; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-19T07:02:24.523

您走在正确的轨道上，但需要解决两件事。

首先使用 ::LoadImage( .. LR_CREATEDIBSECTION ..) 而不是 CBitmap::LoadBitmap。第二，您必须将位图中每个像素的 RGB 值“预乘”到它们各自的 A 值。这是 AlphaBlend 功能的要求，请参阅[此 MSDN 页面](http://msdn.microsoft.com/en-us/library/aa452889.aspx)上的 AlphaFormat 说明。吨

[lpng](http://www.swapped.cc/code/lpng)有一个可以对 DIB 数据进行预乘的工作代码。

# c++ - g ++未定义对typeinfo的引用

> ID：307352
> 
> 赞同：253
> 
> 时间：2008-11-21T00:02:18.893
> 
> 标签：c++, linker, g++

我刚刚遇到以下错误（并在网上找到了解决方案，但堆栈溢出中不存在）：

> (.gnu.linkonce.[stuff]): 未定义引用 [method] [object file]:(.gnu.linkonce.[stuff]): 未定义引用 `typeinfo for [classname]'

为什么会出现这些“未定义的 typeinfo 引用”链接器错误之一？

（如果您能解释幕后发生的事情，则可以加分。）

* * *

## 回答 #1

> 赞同：258
> 
> 时间：2008-11-21T00:42:20.030

一个可能的原因是因为您声明了一个虚函数而没有定义它。

当您声明它而不在同一编译单元中定义它时，您表示它是在其他地方定义的 - 这意味着链接器阶段将尝试在其他编译单元（或库）之一中找到它。

定义虚函数的一个例子是：

```
virtual void fn() { /* insert code here */ } 
```

在这种情况下，您将定义附加到声明中，这意味着链接器以后不需要解析它。

线

```
virtual void fn(); 
```

声明`fn()`而不定义它，并将导致您询问的错误消息。

它与代码非常相似：

```
extern int i;
int *pi = &i; 
```

这表明整数`i`是在另一个编译单元中声明的，必须在链接时解析（否则`pi`不能设置为它的地址）。

* * *

## 回答 #2

> 赞同：166
> 
> 时间：2010-11-15T13:37:04.407

当您混合`-fno-rtti`和`-frtti`编码时，也会发生这种情况。然后，您需要确保在代码`type_info`中访问的任何类都使用. 当您创建类的对象、使用等时，可能会发生这种访问。`-frtti``-frtti``dynamic_cast`

[[来源](http://web.archive.org/web/20100503172629/http://www.pubbs.net/201004/gcc/25970-linker-error-undefined-reference-to-typeinfo-for-a-with-no-rtti-option.html)]

* * *

## 回答 #3

> 赞同：68
> 
> 时间：2008-11-21T00:17:04.637

当声明的（非纯）虚函数缺少主体时会发生这种情况。在您的类定义中，类似于：

```
virtual void foo(); 
```

应该定义（内联或在链接的源文件中）：

```
virtual void foo() {} 
```

或声明为纯虚拟：

```
virtual void foo() = 0; 
```

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2008-11-21T01:34:41.003

引用[gcc 手册](http://gcc.gnu.org/onlinedocs/gcc/Vague-Linkage.html)：

> 对于多态类（具有虚函数的类），type_info 对象与 vtable 一起写出 [...] 对于所有其他类型，我们在使用时写出 type_info 对象：当将 `typeid' 应用于表达式时，抛出一个对象，或者在 catch 子句或异常规范中引用一个类型。

在同一页面上稍早一点：

> 如果该类声明了任何非内联、非纯虚函数，则选择第一个作为该类的“关键方法”，并且 vtable 仅在定义关键方法的翻译单元中发出。

因此，正如其他答案已经提到的那样，当“关键方法”缺少其定义时，就会发生此错误。

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2010-06-25T00:24:15.497

如果您将一个 .so 链接到另一个，还有一种可能性是在 gcc 或 g++ 中使用“-fvisibility=hidden”进行编译。如果两个 .so 文件都是用“-fvisibility=hidden”构建的，并且关键方法与另一个虚函数的实现不在同一个 .so 中，则后者将看不到前者的 vtable 或 typeinfo。对于链接器来说，这看起来像是一个未实现的虚函数（如在 paxdiablo 和 cdleary 的答案中）。

在这种情况下，您必须对基类的可见性进行例外处理

```
__attribute__ ((visibility("default"))) 
```

在类声明中。例如，

```
class __attribute__ ((visibility("default"))) boom{
    virtual void stick();
} 
```

当然，另一种解决方案是不使用“-fvisibility=hidden”。这确实使编译器和链接器变得复杂，可能会损害代码性能。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2008-11-21T00:49:40.577

前面的答案是正确的，但是这个错误也可能是由于试图在*没有*虚函数的类的对象上使用 typeid 引起的。C++ RTTI 需要一个 vtable，因此您希望对其执行类型识别的类至少需要一个虚函数。

如果您希望类型信息在您并不真正需要任何虚函数的类上工作，请将析构函数设为虚函数。

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2015-12-01T23:01:01.640

我只是在这个错误上花了几个小时，虽然这里的其他答案帮助我了解发生了什么，但它们并没有解决我的特定问题。

我正在开发一个同时使用`clang++`和编译的项目`g++`。我使用 没有链接问题`clang++`，但`undefined reference to 'typeinfo for`使用`g++`.

**重要的一点：**将订单事项与`g++`. 如果您以不正确的顺序列出要链接的库，则可能会出现`typeinfo`错误。

有关使用/链接订单的更多详细信息，请参阅[此 SO 问题](https://stackoverflow.com/questions/45135/why-does-the-order-in-which-libraries-are-linked-sometimes-cause-errors-in-gcc)。`gcc``g++`

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2011-06-11T01:35:19.770

处理 RTTI 和非 RTTI 库的代码的可能解决方案：

a) 使用 -frtti 或 -fno-rtti 重新编译所有内容
b) 如果 a) 不适合您，请尝试以下操作：

假设 libfoo 是在没有 RTTI 的情况下构建的。您的代码使用 libfoo 并使用 RTTI 进行编译。如果您在 libfoo 中使用具有虚拟对象的类 (Foo)，您可能会遇到链接时错误，提示：缺少类 Foo 的类型信息。

定义另一个没有虚拟的类（例如 FooAdapter），并将调用转发给您使用的 Foo。

在不使用 RTTI 且仅依赖于 libfoo 符号的小型静态库中编译 FooAdapter。为它提供一个标头并在您的代码（使用 RTTI）中使用它。由于 FooAdapter 没有虚函数，它不会有任何类型信息，您将能够链接您的二进制文件。如果你使用了很多来自 libfoo 的不同类，这个解决方案可能不方便，但它是一个开始。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2011-04-19T22:59:30.273

在基类（抽象基类）中，您声明了一个虚拟析构函数，并且由于您不能将析构函数声明为纯虚函数，因此您必须在抽象类中定义它，只是一个虚拟定义，如 virtual ~base( ) { } 会做，或者在任何派生类中。

如果你不这样做，你将在链接时得到一个“未定义的符号”。由于 VMT 具有匹配 NULL 的所有纯虚函数的条目，因为它根据派生类中的实现更新表。但对于非纯虚函数，需要在链接时定义，以便更新VMT表。

使用 c++filt 来对符号进行分解。像 $c++filt _ZTIN10storageapi8BaseHostE 将输出类似“typeinfo for storageapi::BaseHost”的内容。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2014-05-13T20:15:09.310

与上面讨论的 RTTI、NO-RTTI 类似，如果您使用 dynamic_cast 并且未能包含包含类实现的目标代码，也会出现此问题。

我在 Cygwin 上构建然后将代码移植到 Linux 时遇到了这个问题。在这两种情况下，make 文件、目录结构甚至 gcc 版本（4.8.2）都是相同的，但代码在 Cygwin 上链接和操作正确，但在 Linux 上链接失败。Red Hat Cygwin 显然对编译器/链接器进行了修改，以避免目标代码链接要求。

Linux 链接器错误消息正确地将我引导至 dynamic_cast 行，但此论坛中较早的消息让我寻找缺少的函数实现而不是实际问题：缺少目标代码。我的解决方法是在基类和派生类中替换一个虚类型函数，例如 virtual int isSpecialType()，而不是使用 dynamic_cast。这种技术避免了为了使 dynamic_cast 正常工作而链接对象实现代码的要求。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2014-12-15T23:56:13.823

我刚才遇到了很多这样的错误。发生的事情是我将一个仅包含头文件的类拆分为一个头文件和一个 cpp 文件。但是，我没有更新我的构建系统，所以 cpp 文件没有被编译。在简单地对标头中声明但未实现的函数的未定义引用中，我得到了很多这些类型信息错误。

解决方案是重新运行构建系统来编译和链接新的 cpp 文件。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2016-03-31T07:08:56.693

就我而言，我使用了带有头文件和so文件的第三方库。我子类化了一个类，当我尝试实例化我的子类时发生了这样的链接错误。

正如@sergiy 所提到的，知道这可能是“rtti”的问题，我设法通过**将构造函数实现放入单独的.cpp 文件并将“-fno-rtti”编译标志应用于文件**来解决它。它运作良好。

由于我仍然不太清楚此链接错误的内部原因，因此我不确定我的解决方案是否通用。但是，我认为在尝试@francois 提到的适配器方式之前值得一试。当然，如果所有源代码都可用（在我的情况下不是），最好尽可能使用“-frtti”重新编译。

还有一件事，如果您选择尝试我的解决方案，请尝试使单独的文件尽可能简单，并且不要使用 C++ 的一些花哨功能。特别注意提升相关的事情，因为它很大程度上取决于rtti。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2020-02-27T14:32:42.133

在我的例子中，它是一个接口类中的一个虚函数，它没有被定义为一个纯虚函数。

```
class IInterface
{
public:
  virtual void Foo() = 0;
} 
```

我忘了**`= 0`**一点。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2016-08-25T22:06:28.407

当我的界面（具有所有纯虚函数）需要另外一个功能并且我忘记将其“设为空”时，我遇到了同样的错误。

我有

`class ICommProvider { public: /** * @brief If connection is established, it sends the message into the server. * @param[in] msg - message to be send * @return 0 if success, error otherwise */ virtual int vaSend(const std::string &msg) = 0; /** * @brief If connection is established, it is waiting will server response back. * @param[out] msg is the message received from server * @return 0 if success, error otherwise */ virtual int vaReceive(std::string &msg) = 0; virtual int vaSendRaw(const char *buff, int bufflen) = 0; virtual int vaReceiveRaw(char *buff, int bufflen) = 0; /** * @bief Closes current connection (if needed) after serving * @return 0 if success, error otherwise */ virtual int vaClose(); };`

最后的 vaClose 不是虚拟的，所以编译后不知道从哪里获得它的实现，因此感到困惑。我的信息是：

> ...TCPClient.o:(.rodata+0x38): 未定义对“ICommProvider 的类型信息”的引用

简单的改变

```
virtual int vaClose(); 
```

到

```
virtual int vaClose() = 0; 
```

解决了这个问题。希望能帮助到你

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2016-03-18T23:57:56.233

我遇到了一种罕见的情况，但这可能会对其他类似情况的朋友有所帮助。我必须使用 gcc 4.4.7 在旧系统上工作。我必须编译支持c++11或更高版本的代码，所以我构建了最新版本的gcc 5.3.0。在构建我的代码并链接到依赖项时，如果依赖项是使用较旧的编译器构建的，那么即使我使用 -L/path/to/lib -llibname 明确定义了链接路径，也会出现“未定义的引用”错误。一些包，如 boost 和使用 cmake 构建的项目通常倾向于使用较旧的编译器，它们通常会导致此类问题。您必须走很长的路才能确保他们使用较新的编译器。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2018-10-10T04:48:30.480

在我的情况下，即使我有 dynamic_cast 调用，这纯粹是一个库依赖问题。在 makefile 中添加足够的依赖项后，这个问题就消失了。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2021-09-02T16:14:17.433

有了这个错误消息，G++ 的链接器告诉您，它无法在需要时为给定类组装完整的静态类型信息描述符。正如许多人已经指出的那样，这很可能是由于缺少虚函数的定义。

然而，坏事是，错误消息的顺序可能是违反直觉的，“对 typeinfo 的未定义引用”出现*在*对缺失虚拟定义的未定义引用之前。这是我刚刚经历的一个例子：

```
/usr/bin/ld: module.o:(.data.rel.ro+0x10): undefined reference to `typeinfo for type_xxx'
/usr/bin/ld: module.o:(.data.rel.ro+0x28): undefined reference to `typeinfo for type_xxx'
/usr/bin/ld: module.o:(.data.rel.ro+0x40): undefined reference to `typeinfo for type_xxx'
/usr/bin/ld: module.o:(.data.rel.ro+0x150): undefined reference to `type_xxx::has_property(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&)' 
```

因此，缺少的定义`type_xxx::has_property(const std::string&)`仅报告为第四个错误。因此，*有时*跳过那些人们不理解的错误消息并首先处理那些易于理解的错误消息是值得的。因为在这种情况下，添加缺少的定义也可以解决未定义类型信息引用的问题。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2018-09-18T16:42:08.920

检查您的依赖项是否在没有`-f-nortti`.

对于某些项目，您必须明确设置它，例如在 RocksDB 中：

```
USE_RTTI=1 make shared_lib -j4 
```

# maintenance - The Neglected Stakeholder a.k.a the System Administrator

> ID：307353
> 
> 赞同：8
> 
> 时间：2008-11-21T00:03:24.073
> 
> 标签：maintenance, requirements, system-administration

Some time ago I came to realize that almost every customer project that I have been working on so far has neglected an important group of stakeholders: the system administrators.

These silent heroes are usually only involved at the end of a project and are left with an executable black box of bits that they have to install, support, and maintain for years to come. Whenever an issue occurs with this black box they have to find a way to resolve it using whatever random piece of information and tool support made available to them by the black box or the underlying platform, and if this is not sufficient then they have to improvise.

If they had been involved as a stakeholder in the project from the beginning they would have had a chance to predict potential problems and inform the project team about it. But reality is different and even though I as a developer would love to involve the system administrator as an extra stakeholder, external factors may prevent this from happening.

In these situations I would like to help our silent heroes as good as I can. So my question is:

**What would a system administrator wish from us developers when we develop the systems they will have to maintain?**

If you are a system administrator **please tell a war story** about a difficult problem you once had and what developers could have done to make it easier for you to solve it.

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-21T00:35:40.543

Various things, including (but unlikely to be limited to) these, which are not in priority order:

*   No requirement to use privileged install
*   Option to use privileged install
*   Option for distributed install (so it can be installed on a server and used on other machines)
*   Clean uninstall
*   Sensible upgrade patterns
*   Option to choose install location
*   Minimal dependencies on other software
*   Minimal scattering of data around the system (don't dump stuff in /etc, /usr/lib, /var/adm, ...)
*   No ever-growing logs
*   Silent install
*   Scripted install
*   Online documentation (on machine - as well as on internet)
*   Man pages perhaps
*   Easy to configure
*   Easy to make accessible to end users
*   No security risks
*   No special users or groups (or limited number - at most one special user, one special group is a target, though not always attainable)
*   Either no 'phone home' functionality or only if explicitly configured (must not be default)
*   Good logging of diagnostics when there is a problem
*   Good tech support available if there is a problem
*   No requirement to get activation code during install
*   No requirement to reboot the machine after an install
*   Ability to parallel run old and new versions

A lot depends on what the software is and how it is used. The requirements for a GUI program that works on Windows, Linux and MacOS X are radically different from the requirements for a network daemon - but the goal should still be stable, reliable, easily managed software.

Bear in mind that there are big differences between software prepared by an in-house department for use within one company and software prepared for use by customers external to the company that develops the software.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-23T23:02:56.737

When a problem inevitably occurs, pay attention to what the sysadmin says and believe him. Don't just dismiss it out of hand if it doesn't fit with your initial assessment.

War story: Back about 6 years ago, I was sysadminning for a smallish manufacturing company and they decided to buy some software to handle scheduling of preventive maintenance on their equipment. One of its features was importing maintenance requests from email, but we had occasional problems with errors talking to the mail server during this process and I was eventually called in to take a look at it during a phone call with the developer. The conversation involved multiple iterations of

> Developer: I've never heard of anyone having that kind of trouble talking to the mail server. It has to be a firewall issue.
> 
> Me: I'm logged into the firewall, running a packet sniffer, and watching your app's traffic pass through without any problems. It's getting through the firewall just fine.
> 
> Developer: No, no - it has to be a firewall issue.

(In the end, it turned out that the problem was that the app opened a POP3 connection, read all the mail, waited for the user to schedule the tasks, then sent a POP command to delete the mail after all requests had been scheduled. If the user took more than 15 minutes to do the scheduling, the POP connection timed out and the app wasn't able to recover, so it died instead. And then the user had to repeat the scheduling, meaning it would probably take long enough to time out again...)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T00:24:45.480

System administrators generally want the following:

*   Transparency into the system's operation. So some sort of GUI that shows system settings and perhaps a history of system problems, as well as lists of what the system has processed correctly.
*   A clear context-sensitive escalation path for problems. By this I mean that each problem type has some notes about fixing, and a person or team who can be contacted if the problem can't be fixed quickly and escalation is required.
*   To be proactive, i.e. able to inform end-users about a system problem before an end-user informs him. So some sort of immediate alerting for any system problem where that's feasible,
*   Not to be flooded by alerts. So once an alert has arrived, no more alerts for the same problem; just another message when the system is operational again.
*   Detailed logging using something like the event log (in Windows) for deeper investigation of a problem.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-21T20:48:30.893

I think a combination of the following:

1) Threshold of capacity -> What machines does it take to run this software and what metrics should be used to determine when this number may change, e.g. going from 2 to 3 database servers or going from 10 to 15 webservers. How beefy does the hardware need to be and does one part matter more than another, e.g. does CPU matter more than RAM, what about hard drive configuration and space?

2) Cookbook style troubleshooting -> If something goes wrong how easily can this be categorized into code, data, or network error.

3) Diagram of environments -> What does the dev, test and production instances of this software look like? Are there these and possibly other environments running right now?

4) Maintenance -> Are there log files to parse into reports, weekly error logs to send around, or some kind of housekeeping to do with the software, e.g. reboot the server weekly.

5) Security -> Are there accounts to be created and managed and a security policy to outline who has what level of authority on the system.

Those would be the main ones that come to my mind.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T00:06:21.273

That the system just works so that he can go home to kids.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-21T00:27:03.760

Every project have 'Capacity planning' along with its system architecture. System administrators should be involved in the Capacity Planning process as well as in the final review of the System Architecture. This will help him a better understand the system and be prepared for the deployment and support.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-21T01:10:09.303

Well-documented dependencies that come packaged with the software, if my home admin experiences are anything to go by.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-21T21:17:40.570

Well, more a horror than a war time story: maintaining an application that for no apparent reason demands to be ran under an administrator user account.

A few random things I think would be nice to have in an application:

*   Meaningful command line arguments
*   Some sort of scripting capabilities (if appropriate)
*   Any kind of progress indicator for long running operations
*   Error logging
*   Consistent UI

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-23T21:54:06.627

**Easy package maintenance!**

It should be brain-dead simple to install and upgrade the software, and that goes for dependencies as well. If there are a lot of dependencies and sub-dependencies, and you aren't inclined to master the nuances of each Operating System's package management methodology, it would be nice to offer a package version with all the requisite dependencies bundled together into a giant tarball. Run the script, chuck it all into /usr/local/yourproject, and tell them where is the startup/shutdown/restart script.

# asp.net-mvc - 如何将 ViewPage 呈现为字符串？

> ID：307356
> 
> 赞同：2
> 
> 时间：2008-11-21T00:04:28.970
> 
> 标签：asp.net-mvc, vb.net

我尝试使用 ASP.NET MVC 实现简单的 ViewPage 缓存，但是当它具有母版页时，我无法让页面正确呈现到自定义 HtmlTextWriter 中。

我尝试过覆盖渲染。如果我只是简单地调用基本实现，那么一切都会正确呈现。如果我渲染给我自己的作家然后写那个字符串，那么页面内容就会被打乱。

```
Imports System.IO

Public Class CachedViewPage
Inherits System.Web.Mvc.ViewPage

Protected Overrides Sub Render(ByVal writer As HtmlTextWriter)
    'MyBase.Render(writer)
    'Return

    Dim stringView As String
    Using sw As New StringWriter
        Using w As New HtmlTextWriter(sw)
            MyBase.Render(w)
        End Using
        stringView = sw.ToString()
    End Using
    writer.Write(stringView)
End Sub

End Class 
```

MasterPage、ViewPage 和 HtmlTextWriter 之间似乎存在联系。

我应该如何正确将此 ViewPage 呈现为字符串？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T08:51:53.927

您知道 ASP.NET MVC 提供的内置缓存吗？使用框架提供的内容可能更合适。

这是一个很好的概述；[ASP.NET MVC 中的甜甜圈缓存](http://haacked.com/archive/2008/11/05/donut-caching-in-asp.net-mvc.aspx)

据我所知，如果不开发或使用替代视图引擎，就不可能将视图的输出作为字符串（也许如果您覆盖母版页中的渲染？）。

如果您有兴趣看一下， [MVC Contrib](http://www.codeplex.com/MVCContrib/Wiki/View.aspx?title=Documentation&referringTitle=Home)中有一些替代视图引擎可用。

# .net - 最佳试跑者？（单元测试，.NET）

> ID：307357
> 
> 赞同：18
> 
> 时间：2008-11-21T00:04:31.853
> 
> 标签：.net, unit-testing, mbunit

我正在使用 MBUnit 框架进行单元测试并寻找一个好的测试运行器。

MbUnit 的跑步者速度很快，但缺少很多东西，例如

*   您不能设置执行路径
*   每次跑步都会倒塌所有的树木，这让我发疯
*   几乎所有其他测试运行器都提供了许多额外的安静可爱的功能

我使用了 Zanebug，但是：

*   不再得到适当的支持，一种死项目
*   我认为它与最新的 MBUnit 不兼容，因为它一直在我身上崩溃
*   有很多奇怪的错误

加里奥

*   不知道为什么总是在启动时崩溃，（Vista x64）
*   我让它在另一个设置中运行，它比 MBUnit GUI 慢 6 倍，而且我有很多测试，

测试驱动的 .NET 插件

*   这是一个很棒的小工具，但仅用于测试一个或单元测试，不提供良好的或 VS.NET 独立的 GUI

我对任何其他与 VS 2008 一起使用或独立于 VS 2008 的免费测试运行器持开放态度

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-21T00:33:16.413

我真的很喜欢 NUnit。现在我更喜欢它了，因为我可以在 IDE 中使用它和 ReSharper，这让我可以非常快速地快速测试一个方法。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-21T08:41:40.827

查看[TestDriven](http://testdriven.net/)，它在 Visual Studio 中添加了右键单击单元测试功能。您可以右键单击方法、类、文件、项目或解决方案，以运行适当的单元测试。您还可以调试、运行代码覆盖率、使用一些更流行的分析器等。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-12-11T04:49:39.743

Gallio 包括 ReSharper 支持。我们也在努力提高性能。

不确定您尝试了哪个版本的 Icarus，但我没有看到它在 x64 上启动时崩溃。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-02-05T13:30:24.420

不是免费的，但我现在非常喜欢 CodeRush 测试运行器。它与 VS 很好地集成，支持许多框架，如果它不支持你的框架，它是可扩展的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-07-19T16:02:25.970

我们使用 IronPython 编写 .NET 测试，这意味着我们可以使用 Python 标准库模块“unittest”编写所有测试。这样做的好处是运行测试是一个命令。我们以前使用巡航控制之类的，但后来用大约十行 Python 代码代替了它。这适用于单元测试和功能测试。显然，这并不适合所有人，但有些人可能会发现这是一条富有成效的道路。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-21T01:02:24.530

我不知道 ReSharper 是否内置了对 MBUnit 的支持，但内置的测试运行器非常棒。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-21T01:04:40.190

我正在使用 resharper 在 IDE 中运行单个测试，但使用 nunit-console 运行所有测试以提高速度。

# c++ - C++ 问题：“从 C:\C++\CRP.OBJ 引用的错误外部 'C::C()'”

> ID：307362
> 
> 赞同：1
> 
> 时间：2008-11-21T00:06:47.483
> 
> 标签：c++, linker, unresolved-external

我试图得到这个：

```
//C.h
#ifndef C_H
#define C_H
#include "c.h"

class C
{
    public:
        C();
        int function(int, int);
};
#endif 
```

定义如下：

```
//c.cpp
#include "c.h"
C::C()
{
}
int C::function(int a, int b)
{
    return a * b;
} 
```

在这方面工作：

```
//crp.cpp
#include <iostream>
#include "c.h"

void main(void)
{
    C a;
    std::cout << a.function(1, 2);
} 
```

但我得到两个错误

错误：从 C:\C++\CRP.OBJ 引用的未解析的外部“C::C()”

错误：从 C:\C++\CRP.OBJ 引用的未解析的外部 'C::function(int, int)'

我真的被困住了。帮助诉非常感谢！

编辑：

谢谢您的回复，

我正在通过命令行使用用于 Win32 的 Borland C++ 5.5.1，我实际上并不确定链接器是什么，这是我第一次尝试这样做。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T00:14:38.387

看起来您的链接阶段正在尝试仅从 crp.obj，而**不是**crp.obj 和 c.obj 创建可执行文件。

你是怎么编译的？它应该类似于（在 Borland 的情况下，如编辑中所述）：

```
bcc32 -ecrp.exe crp.cpp c.cpp 
```

您也不需要 ch 中的包含行，唯一停止无限包含循环的是包含保护。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T00:14:26.607

链接程序时，需要同时链接 c.obj 文件和 crp.obj 文件。您看到的错误是因为只有 crp.obj 文件用于链接。

你用的是什么编译器？如果您使用的是 VisualStudio 之类的东西，那么如果 c.cpp 和 crp.cpp 都在同一个项目中，它应该可以工作。如果您使用命令行来构建，那么您需要链接这两个文件，例如

gcc -o crp.exe c.cpp crp.cpp

为 gcc

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T00:12:57.390

您使用的是哪个编译器/开发环境？这是来自命令行还是IDE？

您需要确保编译 c.cpp 并告诉链接器将 c.obj 与 crp.obj 一起包含以创建可执行文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T00:13:49.840

嗯...您使用哪个编译器/链接器？提供给链接器的参数？这些文件是同一个项目的一部分吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T00:17:21.783

谢谢您的回复，

我正在通过命令行使用用于 Win32 的 Borland C++ 5.5.1，我实际上并不确定链接器是什么，这是我第一次尝试这样做。

编辑：

** 这是我之前在 Windows 命令提示符中尝试过的：

```
C:\c++>bcc32 crp 
```

**这是结果：

```
Borland C++ 5.5.1 for Win32 Copyright (c) 1993, 2000 Borland

crp.cpp:

Turbo Incremental Link 5.00 Copyright (c) 1997, 2000 Borland

Error: Unresolved external 'C::C()' referenced from C:\C++\CRP.OBJ

Error: Unresolved external 'C::function(int, int)' referenced from C:\C++\CRP.OBJ 
```

** 然后我尝试了这个：

```
bcc32 -ecrp.exe crp.cpp c.cpp 
```

**正如 Pax Diablo 建议的那样，得到了这个：

```
C:\c++>bcc32 -ecrp.exe crp.cpp c.cpp

Borland C++ 5.5.1 for Win32 Copyright (c) 1993, 2000 Borland

crp.cpp:

c.cpp:

Turbo Incremental Link 5.00 Copyright (c) 1997, 2000 Borland 
```

**但是在尝试再次编译 crp.cpp 时，我遇到了与以前相同的错误：

```
C:\c++>bcc32 crp

Borland C++ 5.5.1 for Win32 Copyright (c) 1993, 2000 Borland

crp.cpp:

Turbo Incremental Link 5.00 Copyright (c) 1997, 2000 Borland

Error: Unresolved external 'C::C()' referenced from C:\C++\CRP.OBJ

Error: Unresolved external 'C::function(int, int)' referenced from C:\C++\CRP.OBJ 
```

编辑：哎呀！试图再次以错误的方式编译它对我来说非常愚蠢。它现在可以工作了。因此，正如 Pax Diablo 最初建议的那样，解决方案是像这样编译 crp.cpp：

```
 bcc32 -ecrp.exe crp.cpp c.cpp 
```

问题已解决，感谢所有回复的人！

# unit-testing - 如何在 MbUnit 中设置执行路径？

> ID：307363
> 
> 赞同：2
> 
> 时间：2008-11-21T00:06:57.090
> 
> 标签：unit-testing, mbunit

有没有办法为测试的DLL设置执行路径，以便在MbUnit将文件复制到临时文件夹而不使用依赖注入时找到资源文件夹？

尝试将这些额外文件作为内容并将行为设置为复制不起作用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-11T22:11:48.220

如果您从命令行、NAnt 或 MSBuild 运行这些测试，您可以指定应用程序基目录和工作目录参数。

使用 Gallio Icarus 或 ReSharper 集成可以使用类似的机制。

# javascript - JavaScript & IE7 - 为什么我的 *.onload = function() { } 不会触发？

> ID：307364
> 
> 赞同：1
> 
> 时间：2008-11-21T00:07:46.373
> 
> 标签：javascript, xhtml, internet-explorer-7

我有一个画廊，我很快就为一个小网站编写了代码，在 Firefox 3 和 Safari 3 下运行良好。但是当我在我最好的老朋友 IE7 上进行测试时，它似乎没有触发 imageVar.onload = function() { // code here }.. 我想用它来停止加载效果并加载图像。

请记住...

*   我知道缩略图只是较大图像的缩小版本。当客户最终确定图像时，我将创建适当的缩略图。
*   这是我第一次尝试在大多数情况下摆脱程序化 JavaScript。所以请放轻松，请让我知道我的代码哪里糟糕！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-21T00:26:15.710

为了成功使用 Image.onload，您必须在设置 src 属性之前注册事件处理程序方法。

**本题相关信息：**

**[用于图像加载的 Javascript 回调](https://stackoverflow.com/questions/280049/javascript-callback-for-knowing-when-an-image-is-loading#280087)**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T00:23:58.897

由于实现差异，跨浏览器事件支持并不那么简单。由于您在站点上使用 jQuery，因此最好使用它的事件方法来规范浏览器支持：

代替：

```
 window.load = function(){ 
      //actions to be performed on window load
 }

 imageViewer.image.onload = function(){ 
     //actions to be performed on image load
 } 
```

做：

```
$(window).load(function(){ 
    //actions to be performed on window load
});

 $(imageViewer.image).load(function(){ 
      //actions to be performed on image load
 }); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T00:28:06.970

只是为了添加 Eran 的建议以使用 jQuery 的内置事件处理程序，您可以在加载文档并创建 DOM 但在下载图像之前运行代码：

```
$(document).ready(function(){
   //your code
}); 
```

# c# - .NET 中损坏的电子邮件附件

> ID：307365
> 
> 赞同：7
> 
> 时间：2008-11-21T00:08:32.440
> 
> 标签：c#, .net, smtp

我正在尝试将 PDF 附件附加到使用 System.Net.Mail 发送的电子邮件中。添加附件的部分如下所示：

```
using (MemoryStream pdfStream = new MemoryStream())
{
    pdfStream.Write(pdfData, 0, pdfData.Length);

    Attachment a = new Attachment(pdfStream, 
        string.Format("Receipt_{0}_{1}.pdf", jobId, DateTime.UtcNow.ToString("yyyyMMddHHmm")));

    msg.Attachments.Add(a);

    SmtpClient smtp = new SmtpClient(serverName, port);
    smtp.Credentials = new NetworkCredential(fromEmailName, fromEmailPassword);
    smtp.Send(msg);
} 
```

问题是附件在另一端被损坏。[我在这里](http://www.systemwebmail.com/faq/4.4.8.aspx)找到了一些关于这个问题的讨论，但是该页面上提到的解决方案使用了 System.Web.Mail.MailAttachment，它在 .NET 2.0 中已过时。

我尝试更改 Attachment 类中的 TransferEncoding（替换 MailAttachment），但没有运气。有没有人在 .NET 2.0 上解决了这个问题？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-21T00:27:15.130

您是否尝试过`pdfStream.Seek(0,SeekOrigin.Begin)`在创建附件之前将流重置为开头？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T03:24:39.097

您是否检查以确保 pdfData 数组中的 PDF 文档尚未损坏？尝试将其写入文件然后打开它。

干杯
凯夫

# eclipse - Eclipse CDT 项目路径无效

> ID：307367
> 
> 赞同：44
> 
> 时间：2008-11-21T00:09:51.687
> 
> 标签：eclipse, eclipse-cdt

我有一个使用 makefile 构建的 C 项目，Eclipse 不断警告“无效的项目路径：重复的路径条目”，但我不知道它到底想让我做什么。我想禁用此警告并继续我的生活。

我的应用程序编译并运行良好，除此之外没有任何警告。作为一个尽职尽责的开发人员，我热衷于解决这个问题，所以我拥有只有干净构建才能带来的温暖模糊。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2012-06-01T18:36:27.140

这对我来说适用于 Eclipse 3.7.2 和 CDT 8.0.2：

1.  打开项目属性 | C/C++ 构建 | 发现选项。
2.  单击立即清除已发现条目的按钮：。
3.  重建。

这似乎是 CDT 8 中的一个新功能。多年来，我一直有这个“无效的项目路径：重复的路径条目”问题，这显然是新提供的解决方案。

在这样做之前，C/C++ General | 下有重复的路径。路径和符号 | 包括选项卡。我无法摆脱这些。它们仅在选中 Show built-in values 时出现，因此它们显然是以某种方式生成的。完成上述操作后，它们被替换为没有重复的集合。唯一的区别是相同的设置出现在 Assembly、GNU C 和 GNU C++ 下。以前它们是不同的集合。例如，Assembly 的那些是空的。

到目前为止，问题还没有回来。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-01-05T19:23:24.647

这个问题是一个真正的痛苦处理。它工作得不是很好。

这适用于 Eclipse 3.4.1 / CDT 5.0.1

据我所知，当您在 CDT 中创建“C/C++ 项目”时，它会尝试自动检测您的包含路径。好主意，但实施起来很糟糕。

如果您删除或重命名一个目录，旧目录将被保留。如果重命名项目，旧目录将保留。当 Eclipse 找不到那个旧目录时，它会给你那个警告。

我的解决方案是完全关闭自动发现并手动管理我的包含路径。您需要此包含路径列表，用于 ctrl-click（自动导航到定义/函数/文件/等）和遮蔽 #define 块。它从这个列表中建立索引。

这是您需要做的：在项目资源管理器中右键单击您的项目并转到属性。转到 C/C++ Build -> Discovery Options 取消选中“自动发现路径和符号”

现在转到 C/C++ General -> Paths and Symbols 您将在 Includes 选项卡下看到 Assembly、C 和 C++ 语言以及相应的自动发现的包含目录。转到所有 3 种语言并删除所有内容。打开您的 makefile 并将您的包含转录成相应的语言。项目重命名仍会导致索引器中断。${project_name} 和其他全局变量似乎不起作用。如果您遇到问题，请使用“工作区”按钮浏览到您想要包含的目录，因为这似乎总是有效，但手动输入却不行。点击应用，然后确定。右键单击您的项目，转到 index->​​rebuild 重新启动 eclipse。

这应该永远解决问题。任何时候由于#define 或#ifdef 块而不正确地遮盖了某些内容，这是因为该文件列表已过时。如果您在#include 行上获得“未解决的包含”，您也会知道该列表已过时。

Doug Schaefer，希望谷歌索引这个，你找到你的名字，然后你修复这个糟糕的实现。=)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-04-23T19:28:38.890

我发现这个错误报告可以帮助我解决问题。我已经移动了一些包含路径并且无法摆脱旧路径。

> 我也看到过这个问题，旧路径永远不会被删除。要手动修复文件，您需要移动/删除 ${workspace}/.metadata/.plugins/org.eclipse.cdt.make.core 下的 ${projectname}.sc 文件

[https://bugs.eclipse.org/bugs/show_bug.cgi?id=206372](https://bugs.eclipse.org/bugs/show_bug.cgi?id=206372)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2015-04-10T04:27:48.620

使用 Eclipse Luna 和 CDT 8.5

我解决了这个问题

1.  打开项目属性 | C/C++ 通用 | 路径和符号
2.  查看 Source Location 选项卡，我已经重命名了一个目录，并且它没有在此列表中更新。
3.  重建

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-10-05T02:35:59.257

在这里，我刚刚找到了另一种自动重新检测路径的方法：

1.  打开“工作区设置 -> C/C++ -> 构建 -> 设置 -> 发现”
2.  找到“CDT 内置编译器设置 [Shard]”
3.  单击右侧的“清除条目”和“重置”按钮
4.  重建项目并完成

希望这会有所帮助。

参考：http: [//qing.blog.sina.com.cn/1802712302/6b7334ee33004def.html](http://qing.blog.sina.com.cn/1802712302/6b7334ee33004def.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-21T00:42:52.027

这似乎是 CDT 中的一个错误。

如果你真的想摆脱它，你应该尝试摆脱项目路径中的空格；这是在错误的搜索结果中提出的。如果这不起作用，您可以尝试打开 .cproject 文件 - 这是所有 CDT 设置所在的位置 - 并检查包含重复条目的实际路径。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-09-06T17:15:08.303

您应该检查您是否手动定义了 eclipse 可以从您的 makefile 中找出的符号。我有一个项目，它有一个手动编写的 makefile，通过删除我手动添加到 C/C++ General -> Paths and Symbols -> Symbols 的符号解决了这个问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-08-23T09:50:08.880

无需删除人员`.metadata`，只需删除位于 *C/C++ General* -> *Paths and Symbols* -> *Symbols*中的所有路径，然后使用单击按钮替换它们，但不要手动提供路径

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-01-14T06:12:12.257

这是 Eclipse 4.4 的最新答案（它没有发现选项）。

删除项目的`infoPath`文件。Eclipse 或 ADT 插件（不确定是哪个）将重新创建它，并使用正确的路径填充它。

您可以在 中找到该项目的`infoPath`文件`<Eclipse workspace>/.metadata/.plugins/com.android.ide.eclipse.ndk/<project>.pathInfo`。

我*认为*Eclipse 或 ADT 插件从两个地方确定新路径：（1）在 Eclipse 首选项下设置的 NDK 目录，以及（2）`Application.mk`. 所有这些路径都成为 Eclipse 下的“内置”路径。

另请参阅[如何更改指向已删除的 android-ndk-r9 安装的内置 C/C++ 路径？](https://stackoverflow.com/q/27898114/608639)

# c++ - VC7 中的 strtok_s 等价物是什么？

> ID：307369
> 
> 赞同：0
> 
> 时间：2008-11-21T00:10:04.697
> 
> 标签：c++, visual-c++

strtok_s 函数存在于 vc8 中，但不存在于 vc7 中。那么在 vc7 中，什么是相当于 strtok_s 的函数（或代码）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T00:35:45.583

看看[这个 MSDN 页面](http://msdn.microsoft.com/en-us/library/ftsafwz3(VS.80).aspx)。

据我所知，安全性增强 a) 通过使用“上下文”参数使[strtok](http://msdn.microsoft.com/en-us/library/2c8d19sb(VS.80).aspx) () 可重入（并且线程安全），以及 b) 使其可以安全地与 NULL 指针一起使用。（在我链接的页面上的表格中列出了 NULL 参数情况下的实际行为。）

至于 VC7 替代方案，您必须自己编写（或导入）一个。NULL 安全性在外部很容易实现，您只需要注意不要在预期没有的地方传递 NULL 字符串；但就重入而言， strtok() 无法处理。

看看[这个](https://stackoverflow.com/questions/206014/is-there-a-tokenizer-strtok-replacement-function-somewhere-in-cstl-closed)和[这个](https://stackoverflow.com/questions/206014/is-there-a-tokenizer-strtok-replacement-function-somewhere-in-cstl-closed)问题。我相信 POSIX 还提供了 strtok() 的可重入版本，称为 strtok_r(); 你可以搜索它。自己编写一个实现也是一个很好的（和简短的）练习。不应该超过 10 行代码。

# c# - 如果我使用架构，如何提高 DataSet.ReadXml 的性能？

> ID：307370
> 
> 赞同：1
> 
> 时间：2008-11-21T00:10:31.360
> 
> 标签：c#, performance, ado.net, dataset, readxml

我有一个 ADO 数据集，我通过 ReadXml 从其 XML 文件加载。数据和模式位于不同的文件中。

现在，加载这个 DataSet 需要将近 13 秒。如果我不读取 DataSet 的架构并让 ReadXml 推断架构，我可以将其缩短到 700 毫秒，但是生成的 DataSet 不包含任何约束。

我试过这样做：

```
Console.WriteLine("Reading dataset with external schema.");
ds.ReadXmlSchema(xsdPath);
Console.WriteLine("Reading the schema took {0} milliseconds.", sw.ElapsedMilliseconds);
foreach (DataTable dt in ds.Tables)
{
   dt.BeginLoadData();
}
ds.ReadXml(xmlPath);
Console.WriteLine("ReadXml completed after {0} milliseconds.", sw.ElapsedMilliseconds);
foreach (DataTable dt in ds.Tables)
{
   dt.EndLoadData();
}
Console.WriteLine("Process complete at {0} milliseconds.", sw.ElapsedMilliseconds); 
```

当我这样做时，读取架构需要 27 毫秒，读取数据集需要 12000 多毫秒。这是我在所有 DataTables 上调用 EndLoadData*之前报告的时间。*

这不是一个庞大的数据量——大约 1.5mb，没有嵌套关系，所有的表都包含两到三列 6-30 个字符。如果我预先阅读架构，我唯一能想到的不同之处在于架构包含所有唯一约束。但是 BeginLoadData 应该关闭约束（以及更改通知等）。所以这不应该在这里适用。（是的，我尝试将 EnforceConstraints 设置为 false。）

我已经阅读了许多关于人们通过首先读取架构而不是让对象推断架构来改善 DataSets 加载时间的报告。在我的例子中，推断架构的过程比明确提供架构快约 20 倍。

这让我有点疯狂。这个 DataSet 的模式是由元信息生成的，我很想编写一个方法来以编程方式创建它，并使用 XmlReader 对其进行反序列化。但我宁愿不这样做。

我错过了什么？我还能做些什么来提高这里的速度？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-06-01T20:15:11.810

我将尝试为您提供将数据存储在纯文本文件和 xml 文件中的性能比较。

第一个函数创建两个文件：一个包含 1000000 条纯文本记录的文件和一个包含 1000000 条（相同数据）记录的 xml 文件。首先，您必须注意文件大小的差异：~64MB（纯文本）与~102MB（xml文件）。

```
void create_files()
    {
        //create text file with data
        StreamWriter sr = new StreamWriter("plain_text.txt");

        for(int i=0;i<1000000;i++)
        {
            sr.WriteLine(i.ToString() + "<SEP>" + "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaabbbbbbbbbbbbbbbbbb" + i.ToString());
        }

        sr.Flush();
        sr.Close();

        //create xml file with data
        DataSet ds = new DataSet("DS1");

        DataTable dt = new DataTable("T1");

        DataColumn c1 = new DataColumn("c1", typeof(int));
        DataColumn c2 = new DataColumn("c2", typeof(string));

        dt.Columns.Add(c1);
        dt.Columns.Add(c2);

        ds.Tables.Add(dt);

        DataRow dr;

        for(int j=0; j< 1000000; j++)
        {
            dr = dt.NewRow();
            dr[0]=j;
            dr[1] = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaabbbbbbbbbbbbbbbbbb" + j.ToString();
            dt.Rows.Add(dr);
        }

        ds.WriteXml("xml_text.xml");

    } 
```

第二个函数读取这两个文件：首先它将纯文本读取到字典中（只是为了模拟使用它的真实世界），然后读取 XML 文件。这两个步骤都以毫秒为单位（并将结果写入控制台）：

*开始将文本文件读入内存
文本文件在 7628 毫秒内加载到内存中
开始将 XML 文件读
入内存 在 21018 毫秒内将 XML 文件加载到内存中*

```
void read_files()
    {

        //timers
        Stopwatch stw = new Stopwatch();
        long milliseconds;

        //read text file in a dictionary

        Debug.WriteLine("Start read Text file into memory");

        stw.Start();
        milliseconds = 0;

        StreamReader sr = new StreamReader("plain_text.txt");
        Dictionary<int, string> dict = new Dictionary<int, string>(1000000);
        string line;
        string[] sep = new string[]{"<SEP>"};
        string [] arValues;
        while (sr.EndOfStream!=true) 
        {
            line = sr.ReadLine();
            arValues = line.Split(sep,StringSplitOptions.None);
            dict.Add(Convert.ToInt32(arValues[0]),arValues[1]);
        }

        stw.Stop();
        milliseconds = stw.ElapsedMilliseconds;

        Debug.WriteLine("Text file loaded into memory in " + milliseconds.ToString() + " milliseconds" );

        //create xml structure
        DataSet ds = new DataSet("DS1");

        DataTable dt = new DataTable("T1");

        DataColumn c1 = new DataColumn("c1", typeof(int));
        DataColumn c2 = new DataColumn("c2", typeof(string));

        dt.Columns.Add(c1);
        dt.Columns.Add(c2);

        ds.Tables.Add(dt);

        //read xml file

        Debug.WriteLine("Start read XML file into memory");

        stw.Restart();
        milliseconds = 0;

        ds.ReadXml("xml_text.xml");

        stw.Stop();
        milliseconds = stw.ElapsedMilliseconds;

        Debug.WriteLine("XML file loaded into memory in " + milliseconds.ToString() + " milliseconds");

    } 
```

结论：XML 文件大小几乎是文本文件大小的两倍，加载速度比文本文件慢三倍。

XML 处理比纯文本更方便（因为抽象级别），但它更消耗 CPU/磁盘。

因此，如果您有小文件并且从性能的角度来看是可以接受的，那么 XML 数据集就更好了。但是，如果您需要性能，我不知道 XML 数据集（使用任何可用的方法）是否比纯文本文件更快。基本上，它从第一个原因开始：XML 文件更大，因为它有更多的标签。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-03T02:39:09.170

确切地说，这不是一个答案（尽管总比没有好，这是我到目前为止所得到的），但是在解决这个问题很长时间之后，我发现当我的程序不在 Visual Studio 中运行时，它完全不存在。

我之前没有提到的，这使得这更加神秘的是，当我将一个不同的（但相当大的）XML 文档加载到 DataSet 中时，程序运行得很好。我现在想知道我的一个数据集是否附加了某种元信息，Visual Studio 在运行时检查而另一个没有。我不知道。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-25T04:06:05.960

另一个要尝试的维度是在没有模式的情况下读取数据集，然后将其[***合并***](http://msdn.microsoft.com/en-us/library/06t089d7.aspx)到启用了约束的类型化数据集中。这样，它在构建用于强制约束的索引时就拥有所有数据——也许它会更有效？

来自[MSDN](http://msdn.microsoft.com/en-us/library/06t089d7.aspx)：

> Merge 方法通常在涉及验证更改、协调错误、使用更改更新数据源以及最后刷新现有 DataSet 的一系列过程结束时调用

.

# visual-studio - 如何让 Visual Studio 负载测试代理使用服务器的第二个 CPU

> ID：307382
> 
> 赞同：0
> 
> 时间：2008-11-21T00:17:07.273
> 
> 标签：visual-studio, visual-studio-2008, stress-testing

我正在我们的一台服务器上使用代理运行 Visual Studio 负载测试。这台服务器有两个 CPU，我有一个测试代理使用这两个 CPU 的许可证。我的问题是如何配置测试代理服务以使用第二个 cpu？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-26T16:43:11.070

在多核计算机上运行负载测试时，负载生成受到以下限制：

如果计算机正在运行 Visual Studio Team System 测试版或 Visual Studio Team System，则负载生成仅限于一个内核。

如果计算机正在运行 Visual Studio Team System Test Load Agent，则负载生成不受限制；它在所有内核和处理器上运行。

# html - 需要快速验证 HTML 标签的正确嵌套的方法

> ID：307389
> 
> 赞同：4
> 
> 时间：2008-11-21T00:21:35.550
> 
> 标签：html

是否有一个 firefox 插件或类似的东西可以用来验证我的 html 输出是否有正确的关闭标签？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T00:25:47.473

您可以在线使用[W3 HTML Validator](http://validator.w3.org/)或[HTML Tidy](http://infohound.net/tidy/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T00:28:46.063

我用这个小家伙[Html Validator](https://addons.mozilla.org/en-US/firefox/addon/249)。我喜欢他。它产生的错误可帮助您找到嵌套问题（以及其他问题）。我不知道只检查嵌套问题的验证器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T00:32:54.357

如果您要检查的只是您的标签是否正确嵌套和关闭（而不是所有图像都有`alt`等），那么您只想检查它的 XML 格式正确。

通过这个验证器[http://www.validome.org/xml/](http://www.validome.org/xml/)运行它并勾选“仅格式良好”复选框。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T00:37:48.277

最好是安装 web 开发者标签： [https ://addons.mozilla.org/en-US/firefox/addon/60](https://addons.mozilla.org/en-US/firefox/addon/60)

在那里你可以找到验证器和许多其他东西的链接。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T00:57:30.517

我已经使用 Web 开发者插件很长时间了。

```
https://addons.mozilla.org/en-US/firefox/addon/60 
```

它在工具菜单中有一个 HTML 验证器链接。

# c# - 在 C# 中模拟 IDispatchEx

> ID：307390
> 
> 赞同：0
> 
> 时间：2008-11-21T00:22:04.283
> 
> 标签：c#, design-patterns, visitor-pattern

C# 3.0 扩展方法向基类型添加扩展，使得在该类型的所有*实例*上调用该方法都是合法的。

现在，我知道的 JavaScript 实现了 IDispatchEx，通过它可以将方法添加到特定实例。

那么如何将一组方法添加到 C# 类的“实例”中呢？我知道这是动态与静态语言的圣战领域。:) 让我澄清一下我的意图不是那样。

我只是希望能够根据实现该接口的类向接口添加一组事件。

我能够使用泛型做到这一点

```
inteface ISample<T> { T SupportedEvents; }  

class Sample : ISample<UIWidgetEvent>   {   }  
class Sample2 : ISample<NonVisualUIWidget> { }

class UIWidgetEvent { public EventHandler Clicked; }  
class NonVisualUIWidget {public EventHandler Expired;}

class TestSample
{  
    public void Test()
    {  
        new Sample().SupportedEvents.Clicked += ...
        new Sample2().SupportedEvents.Expired += ...
    }  
} 
```

然后我不喜欢`SupportedEvents`我想说

```
new Sample().Clicked +=... 
```

然后我认为 JavaScript（我知道`C#`不是`JS`:)）... AND `IDispatchEx`, `IL Weaving`,`Reflection.Emit`等等等等，并认为可能有办法做到这一点... [设计时支持会很好，但我可以没有]

是的，我可能可以用访客模式来做这个“实例增强”。[不确定我是否可以得到合成糖]

评论？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T21:05:03.010

好吧，您可以为您的“新”方法创建一个 DynamicMethod 实例，但是在运行时将它们静态附加到现有实例是行不通的，因为它根本无法编译。

您*可能*（我还没有尝试过）能够将操作码发送到内存中的程序集中，但这与您所能获得的“语法上的甜蜜”相去甚远（将涉及大量反射和 InvokeMember 调用，我会认为）

也可能值得研究扩展方法 - 尽管我从未尝试通过扩展方法附加事件或类似事件的方法......而且它们只是 3.5，所以这可能会限制你。

最好看的“纯 C#”实现可能与您已经通过通用/接口设置获得的非常相似......

老实说，如果您正在寻找像这样具有真正“动态支持”的东西，我会用支持 DLR 的语言（如 IronPython）来做这种事情，并从您的 C# 东西中调用它。

# asp.net - 单击确定或取消时防止隐藏 ModalPopupExtender

> ID：307391
> 
> 赞同：0
> 
> 时间：2008-11-21T00:22:28.807
> 
> 标签：asp.net, javascript, ajax

我`ModalPopupExtender`在页面上使用 ASP.NET，并希望在用户在某些情况下按下确定按钮时防止对话框隐藏。但我似乎找不到办法。

我正在寻找的是这样的

```
ajax:ModalPopupExtender
...
OnOkScript="return confirm('You sure?')"
... 
```

如果确认为假，则模式对话框不会消失。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T00:50:14.523

根据我对您的具体情况的理解，您不会连接按钮，只需连接一个脚本来处理条件，然后您可以通过 JS 将其关闭。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-24T13:29:29.297

以下 JavaScript 函数将允许您实现此目的：

```
function conditionalHide(clientID)
{
    if (confirm('You sure?'))
    {
        $find(clientID).hide();
    }
} 
```

`Page_Load`如果您的页面出现，您可以将其连接到您的 asp:Button 控件

```
protected void Page_Load(object sender, EventArgs e)
{
    if (!IsPostBack)
    {
        btnOK.OnClientClick = string.Format("conditionalHide('{0}'); return false;",
            panPopup_ModalPopupExtender.ClientID);
    }
} 
```

一些注意事项：

*   `panPopup_ModalPopupExtender`是你的 ModalPopupExtender
*   `return false;`防止用户单击按钮时发生回发
*   您可以对 ModalPopupExtender 进行硬编码`ClientID`，但这会带来（额外的）维护问题。显示的方法是我发现减轻这种开销的最佳方法

# javascript - 如何在 jQuery UI 中将多个可排序列表相互连接？

> ID：307411
> 
> 赞同：33
> 
> 时间：2008-11-21T00:32:36.057
> 
> 标签：javascript, jquery, ajax, jquery-ui, jquery-ui-sortable

我是 jQuery 的新手，我完全在使用 jQuery UI 的`sortable`.

我正在尝试整理一个页面以方便对项目进行分组和排序。

我的页面有一个组列表，每个组都包含一个项目列表。我希望允许用户能够执行以下操作：

> 1.  重新排序组
> 2.  重新排序组内的项目
> 3.  在组之间移动项目

前两个要求没有问题。我能够很好地对它们进行分类。问题来自第三个要求。我只是无法将这些列表相互连接。一些代码可能会有所帮助。这是标记。

```
<ul id="groupsList" class="groupsList">  
  <li id="group1" class="group">Group 1  
    <ul id="groupItems1" class="itemsList">  
      <li id="item1-1" class="item">Item 1.1</li>  
      <li id="item1-2" class="item">Item 1.2</li>  
    </ul>  
  </li>
  <li id="group2" class="group">Group 2  
    <ul id="groupItems2" class="itemsList">  
      <li id="item2-1" class="item">Item 2.1</li>  
      <li id="item2-2" class="item">Item 2.2</li>  
    </ul>  
  </li>
  <li id="group3" class="group">Group 3  
    <ul id="groupItems3" class="itemsList">  
      <li id="item3-1" class="item">Item 3.1</li>  
      <li id="item3-2" class="item">Item 3.2</li>  
    </ul>  
  </li>
</ul> 
```

我能够通过将`$('#groupsList').sortable({});`和`$('.itemsList').sortable({});`放入来对列表进行排序`document ready function`。我尝试使用该`connectWith`选项`sortable`使其工作，但我失败了。我想做的是让每个`groupItemsX`列表都连接到每个`groupItemsX`列表，但它本身除外。我该怎么做？

* * *

我在想我需要特别不将列表连接到自身，而不是存在某种循环引用。当然，我没有使用 Excel，但似乎这可能会导致某种永无止境的递归，从而导致堆栈溢出或其他问题。唔。对不起双关语。忍不住自己。

无论如何，我试图做这样的事情，但它不起作用：

```
$('.groupsList').sortable(); // worked great  
$('.groupsList').each( function () {  
    $(this).sortable( {  
        connectWith: ['.groupsList':not('#'+ $(this).attr('id') )];  
    });  
}); 
```

我确定我已经完全破坏了那里的语法，我想这就是我必须首先提出这个问题的原因。将当前项目从列表中过滤出来是否有必要或有帮助？

Adam 和 JimmyP 提供的两个答案都在 IE 中工作（尽管它们在 FireFox 中的行为非常奇怪，当您尝试重新排序时会覆盖列表项）。我会接受你的一个答案并对另一个投票，但如果你对过滤有想法/建议，我想听听。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-21T23:05:17.670

你能包括你使用的语法`connectWith`吗？您是否将其他组的列表放在括号内（即使它是选择器）？那是：

```
...sortable({connectWith:['.group'], ... } 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-11-22T09:53:05.443

这应该有效：

```
$('#groupsList').sortable();
$('.itemsList').sortable({
    connectWith: $('.itemsList')
}); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-06-05T12:14:54.397

```
 $(function() {
            $( "#groupItems1, #groupItems2, #groupItems3" ).sortable({
                connectWith: ".itemsList"
            }).disableSelection();
        }); 
```

这对你来说一切都会好起来的！在这里为我做同样的事情。您的 HTML 无需更改。

# sql-server - 如何通过防火墙配置 SQL Server 2005 复制？

> ID：307422
> 
> 赞同：2
> 
> 时间：2008-11-21T00:41:21.017
> 
> 标签：sql-server, sql-server-2005, replication, firewall

您需要为 SQL Server 2005 事务复制打开哪些端口或通信模式？主从在地理上是分开的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T01:07:20.963

确保您启用了加密，否则您的复制数据可能会被介于两者之间的任何人嗅探。更好的解决方案是在您的两个位置之间设置 VPN 以从 SQL Server 卸载加密并提供更好的安全性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T00:46:08.633

我相信 TCP 端口 1433 是典型的，尽管它可以由发布者定义

[这是一篇不错的文章。](http://www.replicationanswers.com/InternetArticle.asp)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-21T00:59:51.853

（不是答案）

我后悔在 SQL Server 7 天内使用 SQL 复制。根据我对 SQL Server 2005 的了解，这些工具变得越来越不可用。

如果我处于您的位置，我会研究某种形式的事务服务器，它支持复制并将其设置为您的应用程序和数据库之间的中间层。

# coldfusion - 在子目录中扩展 application.cfc

> ID：307423
> 
> 赞同：13
> 
> 时间：2008-11-21T00:41:28.613
> 
> 标签：coldfusion, cfc, application.cfc

我有以下两个文件，并希望第二个文件扩展第一个文件：

1.  wwwroot\site\application.cfc
2.  wwwroot\site\dir\application.cfc

但是，当我去为第二个文件声明组件时，我不确定在扩展属性中放置什么。 **我的问题是几个开发站点（具有共享的 SVN 存储库）在同一个 ColdFusion 实例上运行**，所以我不能像这样在 CF 管理员中创建一个映射：

```
<cfcomponent extends="site.application"> 
```

但是，ColdFusion 不喜欢：

```
<cfcomponent extends="..application"> 
```

或任何动态输入，例如：

```
<cfcomponent extends="#expandpath('..').#application"> 
```

创建运行时映射（[如这里](https://stackoverflow.com/questions/287187/extend-a-cfc-using-a-relative-path)）似乎也不可能。在基础 application.cfc 中创建它是没有用的，因为在声明继承 cfc 时该代码尚未执行；而且我无法在定义继承组件之前创建映射，因为还没有应用程序可以附加它。

有什么方法可以引用父目录来完成我的扩展？

编辑澄清：由于上面的粗体文本，ApplicationProxy 解决方案不起作用。现在，作为一种解决方法，我们只是不将 \dir\application.cfc 检入 SVN，以便每个开发人员都可以保留扩展他/她自己的根 application.cfc 的版本。显然，这并不理想。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-21T00:49:57.020

Sean Corfield 有[一篇博客文章解释了如何扩展根 Application.cfc](http://corfield.org/blog/index.cfm/do/blog.entry/entry/Extending_Your_Root_Applicationcfc)。

以下是从该条目复制的相关信息。

* * *

这是您的根 CFC /Application.cfc：

```
<cfcomponent>

    <cfset this.name = "cf7app" />
    <cfset this.sessionmanagement = true />

</cfcomponent> 
```

这是您的代理 CFC /ApplicationProxy.cfc：

```
<cfcomponent extends="Application">
</cfcomponent> 
```

它完全是空的，仅用于为您的根目录/Application.cfc 创建一个别名。这是您的子目录 CFC /app/Application.cfc：

```
<cfcomponent extends="ApplicationProxy">

    <cffunction name="onSessionStart">
        <cfoutput><p>app.Application.onSessionStart()</p></cfoutput>
        <cfset session.counter = 0 />
    </cffunction>

    <cffunction name="onRequestStart">
        <cfoutput><p>app.Application.onRequestStart()</p></cfoutput>
        <cfdump label="application" var="#application#"/>
    </cffunction>

</cfcomponent> 
```

* * *

*每个*站点的根目录都应该有自己的主应用程序：

```
/site1/Application.cfc
/site2/Application.cfc
/site3/Application.cfc 
```

所有这些应用程序都是独立的单个应用程序，它们之间没有任何共享。

如果这些单独的站点中的任何一个需要有子应用程序，那么应该在 Master 旁边有 ApplicationProxy.cfc，

```
e.g.
/site1/ApplicationProxy.cfc
/site2/ApplicationProxy.cfc 
```

然后，对于每个子应用程序，您都有一个扩展代理的子应用程序：

```
e.g.
/site1/subA/Application.cfc
/site1/subB/Application.cfc
/site2/subA/Application.cfc 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T21:42:32.640

以下代码对我有用。我注意到的一件事是 application.cfc 似乎被缓存了，因此对父应用程序 cfc 的更改可能不会被反映。我通过对子应用程序 cfc 进行微不足道的更改来解决这个问题。

```
<cfcomponent output="false">
        <cfset variables.higherPath = ReReplace(GetMetaData(this).name,"\.[^\.]+\.[^\.]+$","") />
        <cfset variables.extendApp = CreateObject("component", "#variables.higherPath#.Application") />

        <cfloop item="variables.key" collection="#variables.extendApp#">
            <cfif IsCustomFunction(variables.extendApp[variables.key])>
                <cfset super[variables.key] = variables.extendApp[variables.key]>
            <cfelse>
                <cfset this[variables.key] = variables.extendApp[variables.key] >
            </cfif>
        </cfloop>
        <cffunction name="onApplicationStart" output="false">
            <cfset super.onApplicationStart() />
        </cffunction> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-03-08T16:50:16.250

我知道这是一个老话题，但我找到了一种不使用 CF 管理员映射的方法（这似乎在我的测试中有效）。

您可以通过使用扩展的相对路径在您的子 Application.cfc 中添加每个应用程序的映射来做到这一点：

```
<cfcomponent extends="cms.Application" output="false">
<cfset this.mappings["/cms"] = expandPath(getDirectoryFromPath(getCurrentTemplatePath()) & "../../../../")>
<cflog text="#getMetadata(this).extends.path#">
</cfcomponent> 
```

是的，它感觉有点hacky，但它似乎工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-01-30T12:05:08.790

爱德华等人，我在下面的帖子中提到了您的评论。见[https://gregoryalexander.com/blog/2021/1/30/Extending-Applicationcfcs-using-mappings-and-proxies](https://gregoryalexander.com/blog/2021/1/30/Extending-Applicationcfcs-using-mappings-and-proxies)

您绝对可以使用映射扩展 cfc。我必须自己做。

我在 ColdFusion 中必须处理的最令人沮丧的事情之一是尝试创建一个对公众开放的外部应用程序，并且必须使用子文件夹中的应用程序来保护该站点的一部分并从基础扩展逻辑应用程序.cfc。我将向您介绍开发人员用来解决此问题的当前方法，并向您展示如何在可能存在使用虚拟目录的托管服务提供商时额外使用映射。

这是一篇相当长的文章，如果您想跳转到精简摘要，请向下滚动到本页底部。

很多年前，我第一次尝试执行此操作时，无论尝试什么都收到以下消息：“找不到 ColdFusion 组件或接口 xxx”。简而言之，使用这种方法的问题是root和子文件夹同名，即Application.cfc，ColdFusion无法正确识别要扩展什么组件，最后经过一番认真的调查，有人想出了一个想法，创建一个proxy.cfc，驻留在同一个目录下根目录作为根 Application.cfc，子文件夹中的 Application.cfc 扩展了一个空的 proxy.cfc，该 proxy.cfc 扩展了根 cfc，如下所示：

根目录：Application.cfc 这个根 Application.cfc 没有扩展任何东西

同样在根目录中： Proxy.cfc Proxy.cfc 有以下代码，它本质上是空的。Proxy.cfc 唯一要做的就是扩展同一目录中的 Application.cfc：

子目录，例如名为 admin 的文件夹。此子目录有另一个 Application.cfc。假设这个组件负责保护应用程序并具有登录逻辑和调试设置等功能。此 Application.cfc 将扩展 Proxy.cfc 以获得根目录中 Application.cfc 的方法和属性，如下所示：

这种方法是天赐之物，并且在博客上广为流传。Ben Nadel 发表了许多非常有用的帖子，我将在本文底部分享这些帖子。

除非您在托管域或使用虚拟目录的服务器上，否则这非常有效。在这种情况下，我们是在我们开始的同一条船上。现在我们又回到了“找不到 ColdFusion 组件或接口 xxx”的地狱！

虽然这个棘手的问题有一个解决方案，但我们还需要使用映射！

不能使用映射来扩展组件是一个常见的误称。我不太确定这种误解最初是从哪里来的，但事实证明这是不正确的。在某些情况下，我们必须使用映射来解决一些烦人的问题，比如这里。

该特定站点由 hostek.com 托管。他们是一家很好的公司，但是由于目录结构，我的网站所在的服务器有一些特点。在这里，当我使用 Proxy.cfc 方法将逻辑从基本 Application.cfc 扩展到管理文件夹中的 Application.cfc 时，我收到可怕的“找不到...组件”错误。当我第一次看到它时，我很沮丧，不再想这个，所以我转向了 ColdFusion CFC 映射。映射告诉 ColdFusion 在哪里可以找到文件以及文件关系是什么。

让我们回顾一下刚才讨论的 CFC 结构。例如，想象以下目录结构：

根目录：即[www.gregoryalexander.com/](http://www.gregoryalexander.com/) 子目录：[www.gregoryalexander.com/admin/](http://www.gregoryalexander.com/admin/)

如前所述，我们在根目录中有 Application.cfc 和 Proxy.cfc，在“admin”子目录中有 Application.cfc。Proxy.cfc 扩展了也在根目录中的 Application.cfc，并且子目录 (admin) 中的 Application.cfc 扩展了根目录中的 Proxy.cfc。

根目录：包含 Application.cfc 和 Proxy.cfc（扩展了根 Application.cfc）。子目录：Application.cfc（扩展 Proxy.cfc）。

现在我们还需要在根 Application.cfc 中添加以下映射。此映射逻辑应靠近根 Application.cfc 的顶部，并且不应位于任何 Application.cfc 事件处理程序（onApplicationStart、onApplicationRequest 等）中。此映射代码不需要位于根 Application.cfc 以外的任何其他位置：

我使用 rootCfc 来识别根目录中的 Application.cfc，而 adminCfc 适用于 admin 目录中的 Application。这些变量可以任意命名。请注意，adminCfc 映射末尾的“/admin”字符串指向“admin”文件夹，该文件夹是一个子目录。

现在我们在根 Application.cfc 中有映射，我们需要将它们应用到位于子目录的 Application.cfc 中的 extends 语句。在 /admin/Application.cfc 模板中使用：

/admin/Application.cfc

当然，rootCfc 告诉子目录中的 Application.cfc 在根目录中查找 Proxy.cfc 模板。与其他“扩展”语句一样，您无需在 Proxy 末尾指定“.cfc”。

您不需要在根 Proxy.cfc 或 Application.cfc 模板中使用此“扩展”映射。他们已经可以找到彼此，因为他们都在同一个根目录中。

/代理.cfc

总结 为了绝对清楚起见： root Application.cfc 包含映射逻辑。具有根目录和子目录的映射。不使用“扩展”语句

root Proxy.cfm 一个简单的 'extends="Administrator" 就可以了。没有映射逻辑。

子目录 Application.cfc extends 语句必须是文件夹的映射变量名称（rootCfc），一个点（.），最后是不带 .cfc 前缀的 Proxy.cfc 模板名称（Proxy）

我很抱歉如此冗长。我在写这篇文章时让自己很恼火——但在我试图解决这个问题时却没有那么恼火！

小心！

# c# - 如何序列化为 dateTime

> ID：307433
> 
> 赞同：4
> 
> 时间：2008-11-21T00:45:07.590
> 
> 标签：c#, datetime, .net-2.0, xml-serialization

努力获取任何时区的日期时间。我正在使用 DateTimeOffset、一个字符串和一个 XmlElement 属性。当我这样做时，我收到以下错误：

> [InvalidOperationException：'dateTime' 是 XmlElementAttribute.DataType 属性的无效值。dateTime 无法转换为 System.String。]
> System.Xml.Serialization.XmlReflectionImporter.ImportTypeMapping(TypeModel model, String ns, ImportContext context, String dataType, XmlAttributes a, Boolean repeats, Boolean openModel, RecursionLimiter limiter) +450
> 
> [InvalidOperationException：反映类型“System.String”时出现错误。]
> System.Xml.Serialization.XmlReflectionImporter.ImportTypeMapping（TypeModel 模型，字符串 ns，ImportContext 上下文，字符串数据类型，XmlAttributes a，布尔重复，布尔 openModel，RecursionLimiter 限制器） +1621
> System.Xml.Serialization.XmlReflectionImporter.ImportAccessorMapping（MemberMapping 访问器，FieldModel 模型，XmlAttributes a，String ns，Type choiceIdentifierType，Boolean rpc，Boolean openModel，RecursionLimiter 限制器）+8750
> System.Xml.Serialization.XmlReflectionImporter.ImportFieldMapping（StructModel parent , FieldModel 模型, XmlAttributes a, String ns, RecursionLimiter 限制器) +139
> System.Xml.Serialization.XmlReflectionImporter.InitializeStructMembers（StructMapping 映射，StructModel 模型，Boolean openModel，String typeName，RecursionLimiter 限制器）+1273
> 
> [InvalidOperationException：反映属性'creationTimeX'的错误。] ...

代码：

```
 [System.Xml.Serialization.XmlElement(ElementName = "creationTime",
      DataType="dateTime")]
 public string creationTimeX
    {
        get
        {
            return this.creationTimeField.ToString("yyyy-MM-ddTHH:mm:sszzz");
        }
        set
        {
            DateTimeOffset.TryParse(value, out this.creationTimeField);
        }
    }

[System.Xml.Serialization.XmlIgnoreAttribute()]
public System.DateTimeOffset creationTime
{
    get {
        return this.creationTimeField;
    }
    set {
        this.creationTimeField = value;
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-02-21T15:09:10.733

这对我有用

```
private const string DateTimeOffsetFormatString = "yyyy-MM-ddTHH:mm:sszzz";
private DateTimeOffset eventTimeField;

[System.Xml.Serialization.XmlElementAttribute(Form = System.Xml.Schema.XmlSchemaForm.Unqualified, Order = 0)]
public string eventTime
{
    get { return eventTimeField.ToString(DateTimeOffsetFormatString); }
    set { eventTimeField = DateTimeOffset.Parse(value); }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T01:20:46.177

看看这个关于序列化日期和 UTC 的 StackOverflow 问题：

[.Net framework 3.5/SQL Server 2008 中 DateTime 序列化的最佳实践](https://stackoverflow.com/questions/65164/best-practices-for-datetime-serialization-in-net-framework-35sql-server-2008)

不需要创建一个特殊的属性来完成序列化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T20:54:46.730

我建议您将 DateTime 序列化为 long （这是实现在内部用于存储实际值的内容）。

您可以使用`DateTime.Ticks`它来获取该值，它有一个构造函数，该构造函数需要很长时间（`Int64`）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-04-10T11:07:40.600

使用 XmlConvert.ToDateTimeOffset() 和 .ToString() 方法在 XmlSerializer 变通方法属性中正确序列化和反序列化 DateTimeOffset。

此处的 Microsoft Connect 文章中的完整示例，并确认不幸的是 Microsoft 不会修复此疏忽（XmlSerializer 应该本机支持它作为任何原始类型）：

[https://connect.microsoft.com/VisualStudio/feedback/details/288349/datetimeoffset-is-not-serialized-by-a-xmlserializer](https://connect.microsoft.com/VisualStudio/feedback/details/288349/datetimeoffset-is-not-serialized-by-a-xmlserializer)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T00:53:20.540

属性的数据类型`creationTimeX`是字符串，而 XmlSerialization 数据类型是`DateTime`。这就是为什么你得到那个例外。

您可以通过将数据类型更改为`DateTime`.

此外，对于任何时区的当前时间问题，您必须对其应用`DateTime.Now.ToUniveralTime()`并应用适当的 DateTimeFormat 模式。

[http://msdn.microsoft.com/en-us/library/k494fzbf.aspx](http://msdn.microsoft.com/en-us/library/k494fzbf.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-02-13T21:28:41.810

`UDateTime`这是 2019 年，我从这个[gist](https://gist.github.com/EntranceJew/f329f1c6a0c35ac51763455f76b5eb95)中找到了一个很棒的自定义类型和属性抽屉的单一脚本

```
using System;
#if UNITY_EDITOR
using UnityEditor;
#endif
using UnityEngine;

// we have to use UDateTime instead of DateTime on our classes
// we still typically need to either cast this to a DateTime or read the DateTime field directly
[System.Serializable]
public class UDateTime : ISerializationCallbackReceiver {
    [HideInInspector] public DateTime dateTime;

    // if you don't want to use the PropertyDrawer then remove HideInInspector here
    [HideInInspector] [SerializeField] private string _dateTime;

    public static implicit operator DateTime(UDateTime udt) {
        return (udt.dateTime);
    }

    public static implicit operator UDateTime(DateTime dt) {
        return new UDateTime() {dateTime = dt};
    }

    public void OnAfterDeserialize() {
        DateTime.TryParse(_dateTime, out dateTime);
    }

    public void OnBeforeSerialize() {
        _dateTime = dateTime.ToString();
    }
}

// if we implement this PropertyDrawer then we keep the label next to the text field
#if UNITY_EDITOR
[CustomPropertyDrawer(typeof(UDateTime))]
public class UDateTimeDrawer : PropertyDrawer {
    // Draw the property inside the given rect
    public override void OnGUI(Rect position, SerializedProperty property, GUIContent label) {
        // Using BeginProperty / EndProperty on the parent property means that
        // prefab override logic works on the entire property.
        EditorGUI.BeginProperty(position, label, property);

        // Draw label
        position = EditorGUI.PrefixLabel(position, GUIUtility.GetControlID(FocusType.Passive), label);

        // Don't make child fields be indented
        var indent = EditorGUI.indentLevel;
        EditorGUI.indentLevel = 0;

        // Calculate rects
        Rect amountRect = new Rect(position.x, position.y, position.width, position.height);

        // Draw fields - passs GUIContent.none to each so they are drawn without labels
        EditorGUI.PropertyField(amountRect, property.FindPropertyRelative("_dateTime"), GUIContent.none);

        // Set indent back to what it was
        EditorGUI.indentLevel = indent;

        EditorGUI.EndProperty();
    }
}
#endif 
```

# jquery - JavaScript 库 - 并排比较

> ID：307436
> 
> 赞同：0
> 
> 时间：2008-11-21T00:46:55.123
> 
> 标签：jquery, frameworks, comparison

微软[最近宣布](http://weblogs.asp.net/scottgu/archive/2008/09/28/jquery-and-microsoft.aspx "最近宣布")，他们认可[jQuery](http://jquery.com)作为“官方”支持的 JavaScript 库。

我当然不会争辩说 jQuery 是一个很棒的框架。事实上，我刚买了[这本书](https://rads.stackoverflow.com/amzn/click/com/1933988355)。但我很想知道为什么。

具体来说，我很想知道我们的 Web 开发人员是否可以期望 jQuery 成为现有的 JavaScript 框架，或者它是否只是像任何其他开发工具一样提供差异化​​点。与 Mootools 或 Prototype 相比，采用 jQuery 的优点是什么？我是否可以期待一场类似于浏览器之战的“JavaScript 库”之战，因为各个框架相互争夺市场主导地位，还是有更好的框架来解决特定问题？

我意识到，与开发世界中的任何事情一样，会有一些人对他们喜欢的图书馆有一种宗教狂热，所以请：在回答这个话题时，互相玩得很好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T01:14:20.280

至于为什么 MS 支持 jQuery，最好问问 ScottGu。

似乎 jQuery 正在成为许多人选择的 js 锤子，而且发生得越多，对其他库的喜爱就越少。

就个人而言，我发现它具有很好的功能平衡，并且允许我以最少的麻烦完成大多数事情，并且与开发的任何其他方面一样，坚持你所知道的如果可行的话，它通常更容易、更便宜.

对于需要非常流畅的动画的东西，我曾经发现 mootools 更流畅一些，但至少有 8 个月以来我不得不用这么多的眼睛糖果做任何事情，所以我的测试可能已经过时了。

对于 ajax 小部件 fest，dojo 或 yui 或 extJS 可能会提供更多功能，但会牺牲库的大小和复杂性。

所以，对不起，如果这有点含糊，但就像其他任何事情一样，它归结为什么是适合这项工作的工具，作为一种通用工具，jQuery 通常会为我赢得胜利，但这在很大程度上取决于工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T09:12:37.677

【深深的主观呼吸】

*   最近几次我与 dojo 合作时，团队集体发现它非常沉重、缓慢、在某些地方存在缺陷（当时 iirc 的 $ 函数中有一个模糊的故障），而且它的自举实际上使它的轮廓相当使用不好。它在工程方面有很多值得喜欢的地方，并且在小部件方面扩展它是中等容易的，尽管我实际上不喜欢它的小部件实现，因为膨胀和一些弱 OO。最终我选择在这些天避免它。

*   我一直对 mootools 动画印象深刻，恕我直言，它远远领先于其他任何东西，但此时我个人使用它也有几个月了，我从未发现库的其余部分对我有多大用处。

*   我发现 jQuery 被夸大*了*，但作为一个框架，它似乎确实优于 dojo，尽管 iirc 再次存在根深蒂固的缺陷。它有相当多的扩展，但没有小部件/组件，并且可以干净地降级。

*   无论如何，GWT 是利基市场，我根本不信任它。基本上，我拒绝 google 的自动化软件可以写出比我更好的 js 的假设 :)

不过要说清楚，我是一个傲慢的草皮，我已经这样做了一段时间，所以我不得不说除了动画（太多的数学，没有足够的时间，只使用 mootools）我正在使用我自己的代码。AJAX 并不难。我更喜欢并更信任我的基于 $esque CSS/Xpath 的选择器。我在适合我的设计方法中更清晰地实现了组件/小部件。最终我拥有绝对的控制权。

对于标准知识很重要的新手和团队，我会推荐 jquery/mootools（甚至 yui）。对于任何从事长期项目或有权力*、时间和技能*来摆脱它的人，我建议你自己动手，并在你看到它们的地方随意窃取好想法。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T08:24:00.537

强化 Sean 所说的，似乎 jQuery 比其他 JS 框架有更多的质量，随时可用的库。这也是推动更多开发人员使用它的一个因素。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T09:02:25.717

对我来说，社区支持使 jQuery 成为一个不错的选择，但如上所述，如果您确实需要一个围绕 ui-widgets 构建的站点，我不会使用 jQuery（目前）。jQuery-ui 框架还处于起步阶段，远远落后于 yui 和 extjs 之类的框架，它将迎头赶上，但需要时间。但是我相信 95% 的 Web 应用程序需求都可以通过 jQuery 得到满足。它带有一个很棒的选择器引擎，还有很好的 dom 操作/ajax 和简单的效果。所有这些加上它的库大小、插件可用性、易用性和支持使它成为一个可靠的选择。MS 发布 jQuery 的决定只会增强其在社区中的噪音并增加 ui 框架的进展。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-12T09:52:34.370

我个人认为，jQuery 受欢迎的真正原因是它比其他成熟的框架更不具有侵入性。您不需要在 JavaScript 中完成整个应用程序（就像 ExtJS 一样），也不需要像在 YUI 中那样处理整个框架。

请不要误会我的意思：我认为 ExtJS 和 YUI 都是很棒的库——它们对于带有插件的 jQuery 非常适合的小型项目来说太胖了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-06-18T20:03:14.953

另一个值得一看的库是 extjs（现在是[Sencha](http://www.sencha.com/)）。他们有最好的小部件恕我直言。

# linux - 以原子方式移动目录

> ID：307437
> 
> 赞同：45
> 
> 时间：2008-11-21T00:48:58.723
> 
> 标签：linux, bash, atomic

我在同一个父目录中有两个目录。调用父目录**base**和子目录**alpha**和**bravo**。我想用**bravo替换****alpha**。最简单的方法是：

 **```
rm -rf alpha
mv bravo alpha 
```

mv 命令是原子的，但 rm -rf 不是。bash 中是否有一种简单的方法可以用**bravo原子地替换****alpha**？如果没有，有没有复杂的方法？

 **附录：

顺便说一句，如果目录在短时间内不存在，这不是一个无法克服的问题。只有一个地方会尝试访问 alpha，它会在执行任何关键操作之前检查 alpha 是否存在。如果不是，它会给出错误消息。但如果有办法做到这一点，那就太好了。:) 也许有一些方法可以直接修改 inode，或者什么......

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2012-06-04T19:15:48.490

最终的解决方案是结合符号链接和重命名方法：

```
mkdir alpha_real
ln -s alpha_real alpha

# now use "alpha"

mkdir beta_real
ln -s beta_real tmp 

# atomically rename "tmp" to "alpha"
# use -T to actually replace "alpha" instead of moving *into* "alpha"
mv -T tmp alpha 
```

当然，访问 alpha 的应用程序必须能够处理路径中更改的符号链接。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-11-21T01:28:28.877

如果您使用符号链接，您可以这样做：

假设 alpha 是指向目录 alpha_1 的符号链接，并且您希望将符号链接切换为指向 alpha_2。这是切换之前的样子：

```
$ ls -l
lrwxrwxrwx alpha -> alpha_1
drwxr-xr-x alpha_1
drwxr-xr-x alpha_2 
```

要使 alpha 引用 alpha_2，请使用 ln -nsf：

```
$ ln -nsf alpha_2 alpha
$ ls -l
lrwxrwxrwx alpha -> alpha_2
drwxr-xr-x alpha_1
drwxr-xr-x alpha_2 
```

现在您可以删除旧目录：

```
$ rm -rf alpha_1 
```

请注意，这实际上不是一个完全原子操作，但它确实发生得非常快，因为“ln”命令既取消链接，然后立即重新创建符号链接。您可以使用 strace 验证此行为：

```
$ strace ln -nsf alpha_2 alpha
...
symlink("alpha_2", "alpha")             = -1 EEXIST (File exists)
unlink("alpha")                         = 0
symlink("alpha_2", "alpha")             = 0
... 
```

您可以根据需要重复此过程：例如，当您有新版本时，alpha_3：

```
$ ln -nsf alpha_3 alpha
$ rm -rf alpha_2 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2013-07-05T15:55:16.367

在这里选择大卫的解决方案，它是完全原子的......你遇到的唯一问题是`-T`选项`mv`是非 POSIX，因此某些 POSIX 操作系统可能不支持它（FreeBSD、Solaris 等...... .http [://pubs.opengroup.org/onlinepubs/9699919799/utilities/mv.html](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/mv.html) )。稍作修改，这种方法可以改变为完全原子的，并且可以在所有 POSIX 操作系统中移植：

```
mkdir -p tmp/real_dir1 tmp/real_dir2
touch tmp/real_dir1/a tmp/real_dir2/a
# start with ./target_dir pointing to tmp/real_dir1
ln -s tmp/real_dir1 target_dir
# create a symlink named target_dir in tmp, pointing to real_dir2
ln -sf tmp/real_dir2 tmp/target_dir
# atomically mv it into ./ replacing ./target_dir
mv tmp/target_dir ./ 
```

例如通过：[http ://axiscorps.wordpress.com/2013/07/03/atomically-replacing-files-and-directories/](http://axialcorps.wordpress.com/2013/07/03/atomically-replacing-files-and-directories/)

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2018-05-15T15:05:25.273

从 Linux 3.15 开始，新的`renameat2`系统调用可以原子地交换同一文件系统上的两条路径。然而，它甚至还没有一个 glibc 包装器，更不用说使用 coreutils 方法来访问它了。所以它看起来像这样：

```
int dirfd = open(".../base", O_PATH | O_DIRECTORY | O_CLOEXEC);
syscall(SYS_renameat2, dirfd, "alpha", dirfd, "bravo", RENAME_EXCHANGE);
close(dirfd);
system("rm -rf alpha"); 
```

（当然，您应该进行适当的错误处理等 - 请参阅[此要点](https://gist.github.com/eatnumber1/f97ac7dad7b1f5a9721f)以获得更复杂的`renameat2`包装器。）

也就是说 - 其他人提到的符号链接解决方案更容易和可移植，所以除非`bravo`已经存在并且您*必须*自动更新它，否则请改用符号链接。

* * *

2020 年更新：自 2018 年 8 月 1 日发布的 glibc 2.28（Debian Stretch，Fedora 29）以来，此系统调用的 glibc 包装器可用。不过，它仍然无法通过 coreutils 访问。

```
int dirfd = open(".../base", O_PATH | O_DIRECTORY | O_CLOEXEC);
renameat2(dirfd, "alpha", dirfd, "bravo", RENAME_EXCHANGE);
close(dirfd);
system("rm -rf alpha"); 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-11-21T01:33:45.230

使用单独的、有保证的原子操作来充当信号量。

因此，如果创建和删除文件操作是原子的：

1）创建一个名为“信号量”的文件。

2）当且仅当成功（与现有文件不冲突）时，执行操作（进程 alpha 或移动目录，具体取决于进程）

3）rm信号量。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-11-21T00:51:57.017

如果您的意思是跨两个操作的原子，我不这么认为。最接近的是：

```
mv alpha delta
mv bravo alpha
rm -rf delta 
```

但这仍然会有一个不存在 alpha 的小窗口。

为了尽量减少任何尝试使用 alpha 的可能性，而它不存在，你可以（如果你有权限）：

```
nice --20 ( mv alpha delta ; mv bravo alpha )
rm -rf delta 
```

`mv`这将在操作发生时大大提高您的流程优先级。

如果，正如您在附录中所说，只有一个地方检查 alpha 并且如果它不存在则出错，您可以将该代码更改为不立即出错，但在短时间内重试（两次`mv`操作轻松亚秒） - 除非您**非常**频繁地更换 alpha，否则这些重试应该可以缓解任何问题。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-11-07T23:00:18.477

[SQLite](http://www.sqlite.org/)文档第3 版中的[*文件锁定和并发*](http://www.sqlite.org/lockingv3.html)部分对其升级锁定协议进行了很好的描述，以控制并发读取、独占写入和崩溃后的回滚。其中一些想法适用于此。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2014-01-06T21:50:52.983

这应该可以解决问题：

```
mkdir bravo_dir alpha_dir
ln -s bravo_dir bravo
ln -s alpha_dir alpha
mv -fT bravo alpha 
```

strace mv -fT bravo alpha 显示：

```
rename("bravo", "alpha") 
```

这对我来说看起来很原子。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-21T01:19:56.977

即使您直接访问 inode，仍然无法在用户空间中以原子方式交换 inode 值。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-21T04:17:12.390

担心操作的原子性是没有意义的。问题是，其他任务对 alpha 的访问无论如何都不是原子的。

Oddthinking 的信号量方法是唯一可行的方法。

如果您无法修改其他任务，那么您必须确保在替换之前它没有运行。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-21T00:51:34.287

我不相信有任何原子方式可以做到这一点。你最好的选择是做这样的事情：

```
mv alpha delme
mv bravo alpha
rm -rf delme 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-21T03:38:51.237

需要记住的是，如果您的进程在此移动/删除发生时打开了任何处于 alpha 阶段的文件，则该进程不会注意到，并且当文件关闭并最终删除时，写入的任何数据都将丢失。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-11-16T14:48:00.087

mv 和 ln 可用于原子操作。我使用 ln(1) 以原子方式部署 Web 应用程序。

替换符号链接的正确方法是使用 ln -nsf

```
ln -nsf <target> <link_name> 
```

例如

```
$ mkdir dir1
$ mkdir dir2
$ ln -s dir1 mylink
$ ls -l mylink
lrwxrwxrwx  1 phil phil 4 Nov 16 14:45 mylink -> dir1
$ ln -nsf dir2 mylink
$ ls -l mylink
lrwxrwxrwx  1 phil phil 4 Nov 16 14:46 mylink -> dir2 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-01-12T20:09:16.507

`Z`也可以使用以下前缀（此处）一次替换整个部分内容`unionfs-fuse`：

```
# mkdir a b c Z
# touch a/1 b/2 c/3
# ln -s a X
# ln -s b Y
# unionfs X=RW:Y=RW Z
# shopt -s globstar
# file **
a:   directory
a/1: empty
b:   directory
b/2: empty
c:   directory
c/3: empty
X:   symbolic link to a
Y:   symbolic link to b
Z:   directory
Z/1: empty
Z/2: empty
# ln -sfn c Y
# file **/*
a:   directory
a/1: empty
b:   directory
b/2: empty
c:   directory
c/3: empty
X:   symbolic link to a
X/1: empty
Y:   symbolic link to c
Y/3: empty
Z:   directory
Z/1: empty
Z/3: empty
# fusermount -u Z
# rm -r a b c X Y Z 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-11-01T15:24:07.210

`mount --bind bravo alpha`应该在 Linux 上执行此操作

它会隐藏 alpha 的内容，但如果您想清除它，您可以将父文件系统绑定到其他位置。

如果文件系统是 NFS 导出的，您可能需要确保导出选项允许跨越文件系统边界并在服务器上执行绑定挂载。

您还需要注意在 alpha 目录或子目录（例如 cwd）上具有打开句柄的进程。

其他 *nix 可能有类似的技巧，但它不是标准化的。

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2008-11-21T04:44:07.250

你为什么不做类似的事情：

```
rm -rf alpha/*
mv bravo/* alpha/
rm -rf bravo/ 
```

这意味着alpha 中的所有内容都被销毁*，* alpha*永远不会*被删除，并且所有内容都会被移动。

# mysql - 如何判断 MySQL 表的最后更新时间？

> ID：307438
> 
> 赞同：198
> 
> 时间：2008-11-21T00:48:59.003
> 
> 标签：mysql, sql

在我页面的页脚中，我想添加类似“上次更新 xx/xx/200x”的内容，此日期是某个 mySQL 表的最后一次更新时间。

最好的方法是什么？是否有检索上次更新日期的功能？每次我需要这个值时都应该访问数据库吗？

* * *

## 回答 #1

> 赞同：314
> 
> 时间：2008-11-21T01:06:42.150

在更高版本的 MySQL 中，您可以使用`information_schema`数据库来告诉您何时更新了另一个表：

```
SELECT UPDATE_TIME
FROM   information_schema.tables
WHERE  TABLE_SCHEMA = 'dbname'
   AND TABLE_NAME = 'tabname' 
```

这当然意味着打开与数据库的连接。

* * *

另一种选择是在 MySQL 表更新时“触摸”特定文件：

关于数据库更新：

*   `O_RDRW`以模式打开您的时间戳文件
*   `close`又来了

或者

*   使用[`touch()`](http://us3.php.net/manual/en/function.touch.php)PHP 等效`utimes()`函数来更改文件时间戳。

页面显示：

*   用于`stat()`回读文件修改时间。

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2013-08-22T00:29:28.493

我很惊讶没有人建议跟踪每行的最后更新时间：

```
mysql> CREATE TABLE foo (
  id INT PRIMARY KEY
  x INT,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP 
                     ON UPDATE CURRENT_TIMESTAMP,
  KEY (updated_at)
);

mysql> INSERT INTO foo VALUES (1, NOW() - INTERVAL 3 DAY), (2, NOW());

mysql> SELECT * FROM foo;
+----+------+---------------------+
| id | x    | updated_at          |
+----+------+---------------------+
|  1 | NULL | 2013-08-18 03:26:28 |
|  2 | NULL | 2013-08-21 03:26:28 |
+----+------+---------------------+

mysql> UPDATE foo SET x = 1234 WHERE id = 1; 
```

即使我们在 UPDATE 中没有提到它，这也会更新时间戳。

```
mysql> SELECT * FROM foo;
+----+------+---------------------+
| id | x    | updated_at          |
+----+------+---------------------+
|  1 | 1235 | 2013-08-21 03:30:20 | <-- this row has been updated
|  2 | NULL | 2013-08-21 03:26:28 |
+----+------+---------------------+ 
```

现在您可以查询 MAX()：

```
mysql> SELECT MAX(updated_at) FROM foo;
+---------------------+
| MAX(updated_at)     |
+---------------------+
| 2013-08-21 03:30:20 |
+---------------------+ 
```

诚然，这需要更多存储空间（TIMESTAMP 每行 4 个字节）。
但这**适用于**MySQL 5.7.15 版本之前的 InnoDB 表，但`INFORMATION_SCHEMA.TABLES.UPDATE_TIME`不适用。

* * *

## 回答 #3

> 赞同：61
> 
> 时间：2010-07-12T10:16:37.123

我没有 information_schema 数据库，使用 mysql 版本 4.1.16，所以在这种情况下你可以查询这个：

```
SHOW TABLE STATUS FROM your_database LIKE 'your_table'; 
```

它将返回这些列：

```
| 姓名 | 引擎 | 版本 | 行格式 | 行 | 平均行长度
| 数据长度 | 最大数据长度 | 索引长度 | 数据免费 | 自动增量
| 创建时间 | 更新时间         | 检查时间 | 整理         
| 校验和 | 创建选项 | 评论 |

```

如您所见，有一个名为“ **Update_time ”的列显示了****your_table**的最后更新时间。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2016-04-14T21:17:20.027

最简单的方法是检查磁盘上表文件的时间戳。例如，您可以检查下您的数据目录

```
cd /var/lib/mysql/<mydatabase>
ls -lhtr *.ibd 
```

这应该首先为您提供所有表的列表，其中包含上次修改最旧时间的表。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2013-01-08T11:53:36.143

对于最近的表更改列表，请使用：

```
SELECT UPDATE_TIME, TABLE_SCHEMA, TABLE_NAME
FROM information_schema.tables
ORDER BY UPDATE_TIME DESC, TABLE_SCHEMA, TABLE_NAME 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-02-16T08:25:29.160

我将创建一个触发器来捕获所有更新/插入/删除并在自定义表中写入时间戳，例如 tablename | 时间戳

只是因为我不喜欢直接读取数据库服务器内部系统表的想法

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2018-05-17T10:05:38.297

尽管有一个公认的答案，但我认为这不是正确的答案。这是实现所需功能的最简单方法，但即使已在 InnoDB 中启用（实际上文档告诉您仍然应该获得 NULL ...），如果您阅读 MySQL[文档](https://dev.mysql.com/doc/refman/8.0/en/tables-table.html)，即使在当前版本（8.0）中使用 UPDATE_TIME 也是不是正确的选择，因为：

> 当服务器重新启动或从 InnoDB 数据字典缓存中逐出表时，时间戳不会保留。

如果我理解正确（现在无法在服务器上验证它），时间戳会在服务器重启后重置。

至于真正的（而且，成本很高）的解决方案，你有 Bill Karwin 的CURRENT_TIMESTAMP[解决方案](https://stackoverflow.com/a/18369829/639956)，我想提出一个不同的解决方案，它基于触发器（我正在使用那个）。

您首先创建一个单独的表（或者您可能有一些其他可用于此目的的表），它将像存储全局变量（此处为时间戳）一样工作。您需要存储两个字段 - 表名（或您希望在此处保留为表 id 的任何值）和时间戳。拥有它之后，您应该使用此表 id + 开始日期对其进行初始化（NOW() 是一个不错的选择:)）。

现在，您移动到要观察的表并在插入/更新/删除之后使用此或类似过程添加触发器：

```
CREATE PROCEDURE `timestamp_update` ()
BEGIN
    UPDATE `SCHEMA_NAME`.`TIMESTAMPS_TABLE_NAME`
    SET `timestamp_column`=DATE_FORMAT(NOW(), '%Y-%m-%d %T')
    WHERE `table_name_column`='TABLE_NAME';
END 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-09-20T13:37:13.390

操作系统级别分析：

查找数据库在磁盘上的存储位置：

```
grep datadir /etc/my.cnf
datadir=/var/lib/mysql 
```

检查最近的修改

```
cd /var/lib/mysql/{db_name}
ls -lrt 
```

应该适用于所有数据库类型。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-12-12T13:16:09.483

a）它将显示所有表格以及最后更新日期

```
SHOW TABLE STATUS FROM db_name; 
```

然后，您可以进一步要求特定表：

```
SHOW TABLE STATUS FROM db_name like 'table_name'; 
```

b) 与上面的示例一样，您不能在“Update_time”上使用排序，但使用 SELECT 您可以：

```
SELECT * FROM information_schema.tables WHERE TABLE_SCHEMA='db_name' ORDER BY UPDATE_TIME DESC; 
```

进一步询问特定表格：

```
SELECT * FROM information_schema.tables WHERE TABLE_SCHEMA='db_name' AND table_name='table_name' ORDER BY UPDATE_TIME DESC'; 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-10-15T21:57:14.960

我让它在本地工作，但不是在我的公共网站的共享主机上（我认为是版权问题）。

```
SELECT last_update FROM mysql.innodb_table_stats WHERE table_name = 'yourTblName';

'2020-10-09 08:25:10' 
```

> MySQL 5.7.20-登录 Win 8.1

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-02-13T07:18:19.193

只需从文件系统中获取修改的文件日期。用我的语言是：

```
 tbl_updated = file.update_time(
        "C:\ProgramData\MySQL\MySQL Server 5.5\data\mydb\person.frm") 
```

输出：

```
1/25/2013 06:04:10 AM 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-08-22T00:02:23.190

如果您运行的是 Linux，您可以使用 inotify 查看表或数据库目录。inotify 可从 PHP、node.js、perl 获得，我怀疑大多数其他语言。当然，您必须安装 inotify 或让您的 ISP 安装它。很多ISP不会。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-09-30T13:35:05.437

不确定这是否有任何兴趣。在 mysql 和客户端之间使用 mysqlproxy，并使用 lua 脚本根据有趣的表更改更新 memcached 中的键值 UPDATE、DELETE、INSERT 是我最近所做的解决方案。如果包装器支持 php 中的钩子或触发器，这可能会更容易。到目前为止，没有一个包装器这样做。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-11-12T16:52:38.850

我在 phpMyAdmin 中按名称创建了一个列：update-at 并从我的代码（nodejs）中的 Date() 方法获取当前时间。对于表中的每次更改，此列都包含更改时间。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-11-09T14:49:33.497

和其他人一样，但为了节省时间，我使用了一些条件：

```
SELECT
  UPDATE_TIME,
  TABLE_SCHEMA,
  TABLE_NAME
FROM
  information_schema.tables
WHERE
  1 = 1
  AND UPDATE_TIME > '2021-11-09 00:00:00'
  AND TABLE_SCHEMA = 'db_name_here'
  AND TABLE_NAME not in ('table_name_here',)
ORDER BY
  UPDATE_TIME DESC,
  TABLE_SCHEMA,
  TABLE_NAME; 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2010-09-09T12:07:30.030

这就是我所做的，我希望它有所帮助。

```
<?php
    mysql_connect("localhost", "USER", "PASSWORD") or die(mysql_error());
    mysql_select_db("information_schema") or die(mysql_error());
    $query1 = "SELECT `UPDATE_TIME` FROM `TABLES` WHERE
        `TABLE_SCHEMA` LIKE 'DataBaseName' AND `TABLE_NAME` LIKE 'TableName'";
    $result1 = mysql_query($query1) or die(mysql_error());
    while($row = mysql_fetch_array($result1)) {
        echo "<strong>1r tr.: </strong>".$row['UPDATE_TIME'];
    }
?> 
```

* * *

## 回答 #17

> 赞同：-9
> 
> 时间：2008-11-21T00:56:48.643

当查询不可用时，将查询缓存在全局变量中。

创建一个网页以在更新时强制重新加载缓存。

在部署脚本中添加对重新加载页面的调用。

# performance - 快速找到图像中最近的非黑色像素

> ID：307445
> 
> 赞同：9
> 
> 时间：2008-11-21T00:50:32.120
> 
> 标签：performance, graphics, 2d, pixel

我有一个随机且稀疏地散布着像素的 2D 图像。
给定图像上的一个点，我需要找到到不在背景颜色（黑色）中的最近像素的距离。
最快的方法是什么？

我能想出的唯一方法是为像素构建一个 kd-tree。但我真的很想避免如此昂贵的预处理。此外，似乎 kd-tree 给了我比我需要的更多。我只需要与某物的距离，我不在乎这东西是什么。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-26T13:44:08.533

就个人而言，我会忽略MusiGenesis 关于查找表的建议。

计算像素之间的距离**并不**昂贵，特别是对于这个初始测试，您不需要实际距离，因此无需取平方根。您可以使用距离^2，即：

```
r^2 = dx^2 + dy^2 
```

此外，如果您一次向外移动一个像素，请记住：

```
(n + 1)^2 = n^2 + 2n + 1 
```

或者如果*nx*是当前值而*ox*是之前的值：

```
 nx^2  = ox^2 + 2ox + 1
          = ox^2 + 2(nx - 1) + 1
          = ox^2 + 2nx - 1
=>  nx^2 += 2nx - 1 
```

很容易看出这是如何工作的：

```
1^2 =  0 + 2*1 - 1 =  1
2^2 =  1 + 2*2 - 1 =  4
3^2 =  4 + 2*3 - 1 =  9
4^2 =  9 + 2*4 - 1 = 16
5^2 = 16 + 2*5 - 1 = 25
etc... 
```

因此，在每次迭代中，您因此只需要保留一些中间变量：

```
int dx2 = 0, dy2, r2;
for (dx = 1; dx < w; ++dx) {  // ignoring bounds checks
   dx2 += (dx << 1) - 1;
   dy2 = 0;
   for (dy = 1; dy < h; ++dy) {
       dy2 += (dy << 1) - 1;
       r2 = dx2 + dy2;
       // do tests here
   }
} 
```

多田！r^2 计算仅使用位移、加法和减法:)

当然，在任何体面的现代 CPU 上计算 r^2 = dx*dx + dy*dy 可能和这个一样快......

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-21T01:22:56.877

正如Pyro 所说，搜索一个正方形的周长，从原始点一次移动一个像素（即一次将宽度和高度增加两个像素）。当你击中一个非黑色像素时，你计算距离（这是你的第一个昂贵的计算），然后继续向外搜索，直到你的框的宽度是到第一个找到的点的距离的两倍（超出这个的任何点都不可能更近比你原来找到的像素）。保存您在此部分中找到的所有非黑点，然后计算它们的每个距离，看看它们是否比您的原始点更近。

在理想的查找中，您只需进行一次昂贵的距离计算。

**更新**：因为您在这里计算像素到像素的距离（而不是任意精度的浮点位置），您可以通过使用预先计算的查找表（只是一个高宽数组）来显着加快该算法的速度给你距离作为*x*和*y*的函数。一个 100x100 的数组基本上要花费 40K 的内存并覆盖原始点周围的 200x200 方格，并且为您节省了为找到的每个彩色像素进行昂贵的距离计算（无论是毕达哥拉斯还是矩阵代数）的成本。这个数组甚至可以预先计算并作为资源嵌入到您的应用程序中，以节省您的初始计算时间（这可能是严重的矫枉过正）。

**更新 2**：此外，还有一些方法可以优化搜索正方形周长。您的搜索应该从与轴相交的四个点开始，并且一次向角落移动一个像素（您有 8 个移动的搜索点，这很容易使这比它的价值更麻烦，这取决于您的应用程序的要求）。一旦您找到一个彩色像素，就无需继续向角落移动，因为其余点都离原点更远。

在找到第一个像素之后，您可以使用查找表进一步将所需的额外搜索区域限制为最小，以确保每个搜索点都比找到的点更近（再次从轴开始，并在达到距离限制时停止）。如果您必须即时计算每个距离，那么第二次优化可能会太昂贵而无法使用。

如果最近的像素在 200x200 框内（或适用于您的数据的任何大小），您将仅在由像素包围的圆圈内搜索，仅进行查找和 <> 比较。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T01:15:01.103

您没有指定要如何测量距离。我将假设 L1（直线），因为它更容易；可能这些想法可以针对 L2（欧几里得）进行修改。

如果您只对相对较少的像素执行此操作，则只需从源像素以螺旋状向外搜索，直到找到非黑色像素。

如果您要为许多/全部执行此操作，那么如何：构建一个图像大小的二维数组，其中每个单元存储到最近的非黑色像素的距离（以及如果需要，该像素的坐标）。进行四行扫描：从左到右、从右到左、从下到上和从上到下。考虑从左到右扫过；扫描时，保留一维列，其中包含每行中看到的最后一个非黑色像素，并用到该像素的距离和/或坐标标记二维数组中的每个单元格。O(n^2)。

或者，kd 树是矫枉过正的。你可以使用四叉树。只比我的线扫描更难编码，更多的内存（但不到两倍），并且可能更快。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T00:59:11.307

搜索“最近邻搜索”，Google 中的前两个链接应该对您有所帮助。

如果您只为每张图像 1 个像素执行此操作，我认为您最好的选择只是线性搜索，每次向外 1 个像素宽度的框。如果您的搜索框是方形的，则您无法获取找到的第一个点。你必须要小心

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T01:05:10.953

是的，最近邻搜索很好，但不能保证您会找到“最近”。每次移出一个像素将产生方形搜索 - 对角线将比水平/垂直更远。如果这很重要，您将需要验证 - 继续扩展，直到绝对水平距离大于“找到”像素，然后计算所有已定位的非黑色像素的距离。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-08-01T10:22:39.783

好的，这听起来很有趣。我做了一个 c++ 版本的解决方案，我不知道这是否对你有帮助。我认为它工作得足够快，因为它在 800*600 矩阵上几乎是即时的。如果你有问题，就问吧。

对不起，我犯了任何错误，这是一个 10 分钟的代码......这是一个迭代版本（我也打算制作一个递归版本，但我改变了主意）。可以通过不将任何点添加到距起点比 min_dist 更远的点数组中来改进该算法，但这涉及为每个像素（尽管它是颜色）计算距起点的距离。

希望有帮助

```
//(c++ version)
#include<iostream>
#include<cmath>
#include<ctime>
using namespace std;
//ITERATIVE VERSION

//picture witdh&height
#define width 800
#define height 600
//indexex
int i,j;

//initial point coordinates
int x,y;
//variables to work with the array
int p,u;
//minimum dist
double min_dist=2000000000;
//array for memorising the points added
struct point{
  int x;
  int y;
} points[width*height];
double dist;
bool viz[width][height];
// direction vectors, used for adding adjacent points in the "points" array.
int dx[8]={1,1,0,-1,-1,-1,0,1};
int dy[8]={0,1,1,1,0,-1,-1,-1};
int k,nX,nY;
//we will generate an image with white&black pixels (0&1)
bool image[width-1][height-1];
int main(){
    srand(time(0));
    //generate the random pic
    for(i=1;i<=width-1;i++)
        for(j=1;j<=height-1;j++)
            if(rand()%10001<=9999) //9999/10000 chances of generating a black pixel
            image[i][j]=0;
            else image[i][j]=1;
    //random coordinates for starting x&y
    x=rand()%width;
    y=rand()%height;
    p=1;u=1;
    points[1].x=x;
    points[1].y=y;
    while(p<=u){
        for(k=0;k<=7;k++){
          nX=points[p].x+dx[k];
          nY=points[p].y+dy[k];
          //nX&nY are the coordinates for the next point
          //if we haven't added the point yet
          //also check if the point is valid
          if(nX>0&&nY>0&&nX<width&&nY<height)
          if(viz[nX][nY] == 0 ){
              //mark it as added
              viz[nX][nY]=1;
              //add it in the array
              u++;
              points[u].x=nX;
              points[u].y=nY;
              //if it's not black
              if(image[nX][nY]!=0){
              //calculate the distance
              dist=(x-nX)*(x-nX) + (y-nY)*(y-nY);
              dist=sqrt(dist);
              //if the dist is shorter than the minimum, we save it
              if(dist<min_dist)
                  min_dist=dist;
                  //you could save the coordinates of the point that has
                  //the minimum distance too, like sX=nX;, sY=nY;
              }
            }
        }
        p++;
}
    cout<<"Minimum dist:"<<min_dist<<"\n";
return 0;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-07-19T02:11:42.780

我确信这可以做得更好，但是这里有一些代码可以搜索围绕中心像素的正方形的周长，首先检查中心并移向角落。如果未找到像素，则扩展周长（半径），直到达到半径限制或找到像素。第一个实现是一个循环，围绕中心点做一个简单的螺旋，但如上所述，它没有找到绝对最近的像素。SomeBigObjCStruct 在循环内的创建非常慢 - 从循环中删除它就足够好了，并且使用了螺旋方法。但无论如何，这里是这个实现 - 请注意，几乎没有进行任何测试。

这一切都是通过整数加减法完成的。

```
- (SomeBigObjCStruct *)nearestWalkablePoint:(SomeBigObjCStruct)point {    

typedef struct _testPoint { // using the IYMapPoint object here is very slow
    int x;
    int y;
} testPoint;

// see if the point supplied is walkable
testPoint centre;
centre.x = point.x;
centre.y = point.y;

NSMutableData *map = [self getWalkingMapDataForLevelId:point.levelId];

// check point for walkable (case radius = 0)
if(testThePoint(centre.x, centre.y, map) != 0) // bullseye
    return point;

// radius is the distance from the location of point. A square is checked on each iteration, radius units from point.
// The point with y=0 or x=0 distance is checked first, i.e. the centre of the side of the square. A cursor variable
// is used to move along the side of the square looking for a walkable point. This proceeds until a walkable point
// is found or the side is exhausted. Sides are checked until radius is exhausted at which point the search fails.
int radius = 1;

BOOL leftWithinMap = YES, rightWithinMap = YES, upWithinMap = YES, downWithinMap = YES;

testPoint leftCentre, upCentre, rightCentre, downCentre;
testPoint leftUp, leftDown, rightUp, rightDown;
testPoint upLeft, upRight, downLeft, downRight;

leftCentre = rightCentre = upCentre = downCentre = centre;

int foundX = -1;
int foundY = -1;

while(radius < 1000) {

    // radius increases. move centres outward
    if(leftWithinMap == YES) {

        leftCentre.x -= 1; // move left

        if(leftCentre.x < 0) {

            leftWithinMap = NO;
        }
    }

    if(rightWithinMap == YES) {

        rightCentre.x += 1; // move right

        if(!(rightCentre.x < kIYMapWidth)) {

            rightWithinMap = NO;
        }
    }

    if(upWithinMap == YES) {

        upCentre.y -= 1; // move up

        if(upCentre.y < 0) {

            upWithinMap = NO;
        }
    }

    if(downWithinMap == YES) {

        downCentre.y += 1; // move down

        if(!(downCentre.y < kIYMapHeight)) {

            downWithinMap = NO;
        }
    }

    // set up cursor values for checking along the sides of the square
    leftUp = leftDown = leftCentre;
    leftUp.y -= 1;
    leftDown.y += 1;
    rightUp = rightDown = rightCentre;
    rightUp.y -= 1;
    rightDown.y += 1;
    upRight = upLeft = upCentre;
    upRight.x += 1;
    upLeft.x -= 1;
    downRight = downLeft = downCentre;
    downRight.x += 1;
    downLeft.x -= 1;

    // check centres
    if(testThePoint(leftCentre.x, leftCentre.y, map) != 0) {

        foundX = leftCentre.x;
        foundY = leftCentre.y;
        break;
    }
    if(testThePoint(rightCentre.x, rightCentre.y, map) != 0) {

        foundX = rightCentre.x;
        foundY = rightCentre.y;
        break;
    }
    if(testThePoint(upCentre.x, upCentre.y, map) != 0) {

        foundX = upCentre.x;
        foundY = upCentre.y;
        break;
    }
    if(testThePoint(downCentre.x, downCentre.y, map) != 0) {

        foundX = downCentre.x;
        foundY = downCentre.y;
        break;
    }

    int i;

    for(i = 0; i < radius; i++) {

        if(leftWithinMap == YES) {
            // LEFT Side - stop short of top/bottom rows because up/down horizontal cursors check that line
            // if cursor position is within map
            if(i < radius - 1) {

                if(leftUp.y > 0) {
                    // check it
                    if(testThePoint(leftUp.x, leftUp.y, map) != 0) {
                        foundX = leftUp.x;
                        foundY = leftUp.y;
                        break;
                    }
                    leftUp.y -= 1; // moving up
                }
                if(leftDown.y < kIYMapHeight) {
                    // check it
                    if(testThePoint(leftDown.x, leftDown.y, map) != 0) {
                        foundX = leftDown.x;
                        foundY = leftDown.y;
                        break;
                    }
                    leftDown.y += 1; // moving down
                }
            }
        }

        if(rightWithinMap == YES) {
            // RIGHT Side
            if(i < radius - 1) {

                if(rightUp.y > 0) {

                    if(testThePoint(rightUp.x, rightUp.y, map) != 0) {
                        foundX = rightUp.x;
                        foundY = rightUp.y;
                        break;
                    }
                    rightUp.y -= 1; // moving up
                }
                if(rightDown.y < kIYMapHeight) {

                    if(testThePoint(rightDown.x, rightDown.y, map) != 0) {
                        foundX = rightDown.x;
                        foundY = rightDown.y;
                        break;
                    }
                    rightDown.y += 1; // moving down
                }
            }
        }

        if(upWithinMap == YES) {
            // UP Side
            if(upRight.x < kIYMapWidth) {

                if(testThePoint(upRight.x, upRight.y, map) != 0) {
                    foundX = upRight.x;
                    foundY = upRight.y;
                    break;
                }
                upRight.x += 1; // moving right
            }
            if(upLeft.x > 0) {

                if(testThePoint(upLeft.x, upLeft.y, map) != 0) {
                    foundX = upLeft.x;
                    foundY = upLeft.y;
                    break;
                }
                upLeft.y -= 1; // moving left
            }
        }

        if(downWithinMap == YES) {
            // DOWN Side
            if(downRight.x < kIYMapWidth) {

                if(testThePoint(downRight.x, downRight.y, map) != 0) {
                    foundX = downRight.x;
                    foundY = downRight.y;
                    break;
                }
                downRight.x += 1; // moving right
            }
            if(downLeft.x > 0) {

                if(testThePoint(upLeft.x, upLeft.y, map) != 0) {
                    foundX = downLeft.x;
                    foundY = downLeft.y;
                    break;
                }
                downLeft.y -= 1; // moving left
            }
        }
    }

    if(foundX != -1 && foundY != -1) {
        break;
    }

    radius++;
}

// build the return object
if(foundX != -1 && foundY != -1) {

    SomeBigObjCStruct *foundPoint = [SomeBigObjCStruct mapPointWithX:foundX Y:foundY levelId:point.levelId];
    foundPoint.z = [self zWithLevelId:point.levelId];
    return foundPoint;
}
return nil; 
```

}

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-05-08T09:55:56.280

您可以结合多种方式来加快速度。

*   加速像素查找的一种方法是使用我所说的空间查找图。它基本上是该块中像素的下采样图（例如 8x8 像素，但它是一种折衷）。值可以是“无像素设置”“部分像素设置”“所有像素设置”。这样，一次读取就可以判断一个块/单元是满的、部分满的还是空的。
*   围绕中心扫描一个框/矩形可能并不理想，因为有很多像素/单元格很远。我使用圆形绘图算法（Bresenham）来减少开销。
*   读取原始像素值可以在水平批次中进行，例如一个字节（对于 8x8 或其倍数的单元格大小）、dword 或 long。这应该再次给你一个严重的加速。
*   您还可以使用多个级别的“空间查找图”，这又是一种权衡。

对于距离计算，可以使用提到的查找表，但它是（缓存）带宽与计算速度的权衡（例如，我不知道它在 GPU 上的表现如何）。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-11-21T02:24:09.873

我会做一个简单的查找表 - 对于每个像素，预先计算到最近的非黑色像素的距离，并将值存储在与相应像素相同的偏移量中。当然，这样你将需要更多的内存。

# security - 如何加密我的网站流量？

> ID：307448
> 
> 赞同：1
> 
> 时间：2008-11-21T00:51:42.820
> 
> 标签：security, encryption, ssl

加密我的网络流量的最简单的免费方法是什么？我希望能够在不以明文形式发送密码的情况下登录我的网络服务器上的网站。

**编辑：**我的网络服务器在 LAMP 堆栈上运行，虽然它是一个共享主机，所以我没有 root。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T00:57:05.603

获取 X.509 证书（例如，生成您自己的证书，或从[StartSSL](http://www.startssl.com/)免费获取），并使用它来设置 SSL — 一项特定于服务器的配置任务。

如果您无法在 Web 服务器中配置新的侦听器，那么这并不是一个好的选择。从理论上讲，您可以使用一些 JavaScript 加密库（例如[JavaScrypt](http://www.fourmilab.ch/javascrypt/) ）进行一些黑客攻击，并提出一些安全的东西。我玩弄了几个选项，但我对它的了解还不够，无法想出任何我有信心的东西。

我不知道你的情况，但如果是我，我会考虑换一个主人。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T00:54:10.210

https

使用自签名证书。

告诉我们您的网络服务器软件以获得详细的实施说明！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T16:30:51.460

由于您没有 root，因此最好的办法是联系您的托管服务提供商，看看他们能为您做什么。您可能已经使用自认证密钥获得了SSL 访问权限（尝试使用[https://yourdomain.com ）。](https://yourdomain.com)

您应该能够说服他们为您安装[StartSSL](http://www.startssl.com)密钥。这为您提供了 SSL 加密，并且浏览器不会抱怨它没有由有效的证书颁发机构签名。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T00:58:23.837

如上所述，发布您自己的认证是免费的，但是更多地了解您的环境可能会为您提供更具体的答案。你在运行 IIS 吗？您将登录哪些需要加密的内容？您是否在后端使用 Windows 服务器？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T19:53:08.010

使用[摘要式身份验证](http://en.wikipedia.org/wiki/Digest_access_authentication)。由于您使用的是 LAMP，因此您可以在 Apache 上使用[mod_auth_digest](http://httpd.apache.org/docs/2.2/mod/mod_auth_digest.html)对其进行配置。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-20T21:21:24.773

由于您正在尝试降低成本，因此任何 ssl 解决方案都可能不是一种选择。

首先，它需要一个收费的签名证书，免费的证书并不总是包含在所有网络浏览器中。

其次，为了能够使用 ssl 证书，您的服务器 ip 必须专用于您。在每个便宜的网络托管选项中都不是这种情况。未来有一些技术可以在一个 ip 上托管多个启用 ssl 的站点，但它还没有出现。

如前所述，摘要式身份验证是一种不需要 ssl 证书或专用 IP 的选项。这是一种身份验证方法，即使通信中的其他所有内容都不受保护，也不会泄露您的密码。在 Apache 中，这可以通过特定的 .htaccess 文件应用于各个目录。我将在[mod_auth_digest](http://httpd.apache.org/docs/2.2/mod/mod_auth_digest.html "mod_auth_digest")上重复上一个链接。这个通常已经安装在大多数服务器上，因此您不必询问您的网络托管服务提供商。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-20T21:42:25.043

您并不总是需要 root 访问权限来设置 Apache 以使用 SSL，但您可能需要修改配置文件，这可以通过您的提供程序接口完成，或者通过 shell 帐户通过文件完成。无论哪种方式，您都需要服务器证书；要么是自签名的，来自像 Verisign 这样的大公司，要么是像[cacert.org](http://www.cacert.org/ "cacert.org")这样的较小的免费网站之一。正如其他人所指出的，这确实需要您的服务器或服务器上的实例的专用 IP。

我会首先推荐 SSL，但 mod_auth_digest 不是一个糟糕的备份主意。

# database - 观察者与触发器

> ID：307463
> 
> 赞同：3
> 
> 时间：2008-11-21T00:57:37.830
> 
> 标签：database, design-patterns

普遍的共识是什么？

如果您需要在给定操作后更改数据库，您是否使用观察者模式并让框架/应用程序为您处理更新？或者您是否绕过应用程序并将更新委托给数据库触发器？

显然触发器更快，但值得吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T01:06:34.163

当我们使用 LINQ2SQL 时，这个任务很容易通过重写 SubmitChanges() 方法来完成。我们的主要目标是在我们的表中进行审计。代码如下：

```
 /// <summary>
    /// Sends changes that were made to retrieved objects to the underlying database, 
    /// and specifies the action to be taken if the submission fails.
    /// NOTE: Handling this event to easily perform Audit tasks whenever a table gets updated.
    /// </summary>
    /// <param name="failureMode">The action to be taken if the submission fails. 
    /// Valid arguments are as follows:<see cref="F:System.Data.Linq.ConflictMode.FailOnFirstConflict"/>
    /// <see cref="F:System.Data.Linq.ConflictMode.ContinueOnConflict"/></param>
    public override void SubmitChanges(System.Data.Linq.ConflictMode failureMode)
    {
        //Updates
        for (int changeCounter = 0; changeCounter < this.GetChangeSet().Updates.Count; changeCounter++)
        {
            object modifiedEntity = this.GetChangeSet().Updates[changeCounter];
            SetAuditStamp(this, modifiedEntity, ChangeType.Update);
        }

        //Inserts
        for (int changeCounter = 0; changeCounter < this.GetChangeSet().Inserts.Count; changeCounter++)
        {
            object modifiedEntity = this.GetChangeSet().Inserts[changeCounter];
            SetAuditStamp(this, modifiedEntity, ChangeType.Insert);
        }
        base.SubmitChanges(failureMode); 
```

我们特别不喜欢使用触发器，因为它们总是隐藏在您的数据库中，并且很难解决可能发生的问题......将其放入您的代码中，您只需要开始调试它以找出失败的原因例如 ...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T01:10:35.903

我使用触发器，但触发器通常是特定于数据库的。如果您计划支持多个数据库服务器，那么一定要找到一种在代码中覆盖它的方法。如果您确定您将使用特定的数据库服务器，那么您的数据完整性会因为您的触发器而爱上您。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T10:06:16.163

除非您支持多个 DBMS，否则您的框架在未来 5 年内（比如说）比您选择的 DBMS 更有可能发生变化。此外，将来可能需要支持其他形式的输入，例如网页或移动设备。将这些动作放入数据库触发器意味着无论触发它们的应用程序如何，都将执行这些动作。

# errno - 扔，返回还是错误？

> ID：307471
> 
> 赞同：3
> 
> 时间：2008-11-21T01:02:09.397
> 
> 标签：errno

我正在创建一个系统。我想知道的是，如果一个味精不受支持，它应该怎么做？我应该说不受支持的味精吗？我应该返回 0 还是 -1？或者我应该设置一个 errno (base->errno_)。有些消息我不关心是否有错误（例如 setBorderColour）。其他我会（添加文本或如果我创建保存 cmd 则可能保存）。

我想知道 1) 快速编码 2) 调试 3) 扩展和维护的最佳方法是什么。我可能会进行第三次调试，它很难调试 ATM，但那是因为有很多我没有填写的缺失代码。实际的错误并不难纠正。让用户知道有错误的最佳方法是什么？

该系统的工作原理与此类似，但并不完全相同。这是 C 风格，mycode 有一堆内联函数，将 settext(const char*text){ 包装到 msg(this, esettext, text)

```
Base base2, base;
base = get_root();
base2 = msg(base, create, BASE_TYPE);
msg(base2, setText, "my text");
const char *p = (const char *)msg(base2, getText); 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-21T01:14:11.293

通常，如果它是 C++，则更喜欢异常，除非性能至关重要，或者除非您可能在不支持异常的环境（例如嵌入式平台）中运行。到目前为止，异常是调试的最佳选择，因为它们在发生时非常明显并且被忽略。此外，例外是自我记录的。它们有自己的类型名称，通常包含解释错误的消息。返回代码和 errno 需要单独的代码定义和某种带外方式来传达代码在任何给定上下文中的含义（例如手册页、注释）。

对于快速编码，返回代码可能更容易，因为它们不涉及潜在地定义您自己的异常类型，而且错误检查代码通常不像异常那样冗长。但当然，最大的风险是，默默地忽略错误返回码要容易得多，导致问题在发生后很久才被注意到，使调试和维护成为一场噩梦。

尽量避免使用 errno，因为它本身很容易出错。它是全局的，所以你永远不知道是谁在重置它，而且它绝对*不是*线程安全的。

**编辑：**我刚刚意识到你的意思是一个 errno 成员变量，而不是 C 风格的 errno。更好的是它不是全局的，但是您仍然需要额外的构造来使其线程安全（如果您的应用程序是多线程的），并且它保留了返回码的所有问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T03:33:25.147

返回错误代码需要纪律，因为必须明确检查错误代码然后传递。我们编写了一个使用这种方法的大型基于 C 的系统，并且花了一些时间来消除所有“丢失”的错误。我们最终开发了一些技术来解决这个问题（例如将错误代码存储在线程全局位置并在顶层检查以查看返回的错误代码是否与保存的错误代码匹配）。

异常处理更容易快速编写代码，因为如果您正在编写代码并且不确定如何处理错误，您可以让它向上传播（假设您没有使用必须处理检查异常的 Java） . 它更适合调试，因为您可以获得异常发生位置的堆栈跟踪（并且因为您可以构建顶级异常处理程序来捕获应该在其他地方捕获的问题）。这对维护更好，因为如果你做对了，你会更快地收到问题通知。

但是，异常处理存在一些设计问题，如果弄错了，情况会更糟。简而言之，如果您正在编写不知道如何处理异常的代码，您应该让它向上传播。太多的编码人员捕获错误只是为了转换异常然后重新抛出它，导致意大利面条式异常代码有时会丢失有关问题原始原因的信息。这假设您在顶层（入口点）有异常处理程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T01:05:13.387

就个人而言，在输出图形方面，我觉得无声失败很好。它只会让你的照片出错。

无论如何，图形错误非常容易发现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T03:58:02.647

就个人而言，如果它是纯“C”，我会在您的 Base 结构中添加一个 errno。如果这是 C++，我会抛出异常。

这取决于这些错误的“致命”程度。用户真的需要看到错误，还是为了其他开发者的熏陶？

为了可维护性，您需要清楚地记录可能发生的错误并包括错误处理的清晰示例。

# c++ - Windows 上本机 C++ 应用程序中的自动死代码检测？

> ID：307478
> 
> 赞同：12
> 
> 时间：2008-11-21T01:05:04.010
> 
> 标签：c++, windows, visual-studio-2005, code-coverage, dead-code

## 背景

在几年的时间里，我有一个用原生 C++ 编写的应用程序，大约 60 KLOC。有许多死掉的函数和类（可能有 10-15% 类似于下面提出的基于 Unix 的类似问题）。我们最近开始对所有新代码进行单元测试，并尽可能将其应用于修改后的代码。但是，我会制作一个 SWAG，我们目前的测试覆盖率不到 5%。

## 假设/约束

方法和/或工具必须支持：

*   本机（即非托管）C++
*   视窗
*   视觉工作室 2005
*   不得要求用户提供测试用例进行覆盖。（例如不能依赖单元测试来生成代码覆盖率）

如果这些方法支持的不仅仅是这些要求，那就太好了。

**注意：**我们目前使用 Visual Studio 2005 的专业版，而不是 Team System。因此，使用 Team System 可能是一个*有效*的建议（我不知道，我从未使用过它）但是我希望它不是*唯一*的解决方案。

## 为什么使用单元测试进行代码覆盖是有问题的

我相信通用工具不可能在任何零误报的任意应用程序中找到所有死的（例如无法访问的代码）（我认为这相当于停机问题）。但是，我也相信通用工具有可能找到许多类型的死代码，这些代码很可能实际上是死的，例如在代码中永远不会被其他任何东西引用的类或函数。

通过使用单元测试来提供这种覆盖率，您不再使用通用算法，从而增加了您可以检测到的死代码的百分比以及任何命中都不是误报的概率。相反，使用单元测试可能会导致误报，因为单元测试本身可能是执行给定代码的唯一方法。理想情况下，我会进行回归测试，使用所有外部可用的方法、API、用户控件等，这将作为代码覆盖率分析的基线测量，以排除某些方法是误报。然而遗憾的是，我目前没有这个自动化测试。

但是，由于我拥有如此庞大的代码库和如此低的测试用例覆盖率，因此我正在寻找可以提供帮助的东西，而无需花费大量时间来编写测试用例。

## 问题

**您如何使用 Visual Studio 2005 开发环境在 Windows 平台上的本机 C++ 应用程序中以自动或半自动方式检测死代码？**

## 也可以看看

[遗留 C/C++ 项目中的死代码检测](https://stackoverflow.com/questions/229069/dead-code-detection-in-legacy-cc-project) [我想告诉 VC++ 编译器编译所有代码。可以做到吗？](https://stackoverflow.com/questions/104952/i-want-tell-the-vc-compiler-to-compile-all-code-can-it-be-done)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-21T09:34:30.317

要求链接器删除未引用的对象 (/OPT:REF)。如果您使用函数级链接和详细的链接器输出，链接器输出将列出它可以证明未使用的每个函数。此列表可能远未完成，但您已经拥有所需的工具。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T01:17:18.633

我们使用[Bullseye](http://www.bullseye.com/coverage.html)，我可以推荐它。它不需要从单元测试环境中运行，尽管这是我们所做的。

* * *

## 回答 #3

> 赞同：-4
> 
> 时间：2008-11-21T01:50:31.873

针对您的单元测试套件使用代码覆盖率工具。

# php - php中的简短唯一ID

> ID：307486
> 
> 赞同：50
> 
> 时间：2008-11-21T01:05:57.847
> 
> 标签：php, uniqueidentifier, unique-index

我想创建一个唯一的 id，但`uniqid()`正在提供类似`'492607b0ee414'`. 我想要的是类似于 tinyurl 给出的东西：`'64k8ra'`。越短越好。唯一的要求是它不应该有一个明显的顺序，并且它应该看起来比看似随机的数字序列更漂亮。字母优于数字，理想情况下不会大小写混合。由于条目的数量不会那么多（最多 10000 个左右），因此碰撞的风险并不是一个很大的因素。

任何建议表示赞赏。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-11-21T03:46:41.657

制作一个返回给定长度的随机字母的小函数：

```
<?php
function generate_random_letters($length) {
    $random = '';
    for ($i = 0; $i < $length; $i++) {
        $random .= chr(rand(ord('a'), ord('z')));
    }
    return $random;
} 
```

然后你会想要调用它，直到它是唯一的，在伪代码中取决于你存储该信息的位置：

```
do {
    $unique = generate_random_letters(6);
} while (is_in_table($unique));
add_to_table($unique); 
```

您可能还想确保这些字母不会在字典中构成单词。可以是整个英文词典，也可以只是一个坏词词典，以避免客户发现不好的东西。

编辑：我还要添加这个只有当你打算使用它时才有意义，因为它不是用于大量项目，因为你得到的冲突越多，这可能会变得非常慢（在表中获得一个 ID）。当然，您需要一个索引表，并且您需要调整 ID 中的字母数量以避免冲突。在这种情况下，使用 6 个字母，您将拥有 26^6 = 308915776 个可能的唯一 ID（减去坏词），这足以满足您 10000 个的需求。

编辑：如果您想要字母和数字的组合，您可以使用以下代码：

```
$random .= rand(0, 1) ? rand(0, 9) : chr(rand(ord('a'), ord('z'))); 
```

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2010-08-21T12:32:35.700

@ [gen_uuid()](https://stackoverflow.com/a/1516430/4061501)来自gord。

preg_replace 有一些讨厌的 utf-8 问题，导致 uid 有时包含“+”或“/”。为了解决这个问题，您必须明确地将模式设为 utf-8

```
function gen_uuid($len=8) {

    $hex = md5("yourSaltHere" . uniqid("", true));

    $pack = pack('H*', $hex);
    $tmp =  base64_encode($pack);

    $uid = preg_replace("#(*UTF8)[^A-Za-z0-9]#", "", $tmp);

    $len = max(4, min(128, $len));

    while (strlen($uid) < $len)
        $uid .= gen_uuid(22);

    return substr($uid, 0, $len);
} 
```

我花了很长时间才找到它，也许它可以避免其他人头疼

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2014-03-14T15:15:19.553

你可以用更少的代码来实现：

```
function gen_uid($l=10){
    return substr(str_shuffle("0123456789abcdefghijklmnopqrstuvwxyz"), 0, $l);
} 
```

结果（示例）：

*   cjnp56brdy
*   9d5uv84zfa
*   ih162lryez
*   ri4ocf6tkj
*   xj04s83egi

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-11-21T01:47:39.510

有两种方法可以获得一个可靠的唯一 ID：让它变长且可变，以致发生冲突的机会非常小（如 GUID）或将所有生成的 ID 存储在一个表中以供查找（在内存或数据库中）或文件）在生成时验证唯一性。

如果您真的在问如何在没有某种重复检查的情况下生成这样一个短密钥并保证其唯一性，那么答案是，您不能。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-10-04T13:39:57.710

这是我用于任意长度的随机 base62 的例程...

调用`gen_uuid()`返回字符串等`WJX0u0jV, E9EMaZ3P`。

默认情况下，这会返回 8 位数字，因此空间为 64^8 或大约 10^14，这通常足以使碰撞非常罕见。

对于更大或更小的字符串，根据需要传入 $len。长度没有限制，因为我会追加直到满足 [最多 128 个字符的安全限制，可以删除]。

*请注意，在*md5 [或 sha1，如果您愿意]中使用随机盐，因此它不容易被逆向工程。

我在网络上没有找到任何可靠的 base62 转换，因此这种从 base64 结果中剥离字符的方法。

在 BSD 许可下自由使用，享受，

[戈德](http://quantblog.wordpress.com)

```
function gen_uuid($len=8)
{
    $hex = md5("your_random_salt_here_31415" . uniqid("", true));

    $pack = pack('H*', $hex);

    $uid = base64_encode($pack);        // max 22 chars

    $uid = ereg_replace("[^A-Za-z0-9]", "", $uid);    // mixed case
    //$uid = ereg_replace("[^A-Z0-9]", "", strtoupper($uid));    // uppercase only

    if ($len<4)
        $len=4;
    if ($len>128)
        $len=128;                       // prevent silliness, can remove

    while (strlen($uid)<$len)
        $uid = $uid . gen_uuid(22);     // append until length achieved

    return substr($uid, 0, $len);
} 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2010-01-21T22:31:37.170

非常简单的解决方案：

使用以下命令创建唯一 ID：

```
$id = 100;
base_convert($id, 10, 36); 
```

再次获取原始值：

```
intval($str,36); 
```

不能因为它来自另一个堆栈溢出页面而对此表示赞赏，但我认为该解决方案非常优雅和令人敬畏，值得将其复制到该线程以供参考。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-11-21T09:58:07.507

如果您想来回转换它，您可以使用 Id 并将其转换为 base-36 数字。可用于任何具有整数 id 的表。

```
function toUId($baseId, $multiplier = 1) {
    return base_convert($baseId * $multiplier, 10, 36);
}
function fromUId($uid, $multiplier = 1) {
    return (int) base_convert($uid, 36, 10) / $multiplier;
}

echo toUId(10000, 11111);
1u5h0w
echo fromUId('1u5h0w', 11111);
10000 
```

聪明的人可能可以通过足够多的 id 示例来解决这个问题。不要让这种默默无闻取代安全性。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2012-02-08T05:15:06.177

我想出了一个我认为非常酷的解决方案，无需进行唯一性检查。我想我会分享给任何未来的访客。

计数器是保证唯一性的一种非常简单的方法，或者如果您使用数据库，主键也可以保证唯一性。问题是它看起来很糟糕并且可能很脆弱。所以我把这个序列和一个密码混在一起。由于密码可以反转，我知道每个 id 都是唯一的，同时仍然显得随机。

它是 python 而不是 php，但我在这里上传了代码： [https ://github.com/adecker89/Tiny-Unique-Identifiers](https://github.com/adecker89/Tiny-Unique-Identifiers)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-21T02:11:40.333

字母很漂亮，数字很丑。您想要随机字符串，但不想要“丑陋”的随机字符串？

创建一个随机数并以*alpha 样式*( *base-26* ) 打印它，就像航空公司提供的预订“数字”一样。

据我所知，PHP 中没有内置通用的基本转换函数，因此您需要自己编写代码。

另一种选择：使用`uniqid()`和摆脱数字。

```
function strip_digits_from_string($string) {
    return preg_replace('/[0-9]/', '', $string);
} 
```

或者用字母替换它们：

```
function replace_digits_with_letters($string) {
    return strtr($string, '0123456789', 'abcdefghij');
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-02-26T10:08:43.200

你也可以这样做：

```
public static function generateCode($length = 6)
    {
        $az = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
        $azr = rand(0, 51);
        $azs = substr($az, $azr, 10);
        $stamp = hash('sha256', time());
        $mt = hash('sha256', mt_rand(5, 20));
        $alpha = hash('sha256', $azs);
        $hash = str_shuffle($stamp . $mt . $alpha);
        $code = ucfirst(substr($hash, $azr, $length));
        return $code;
    } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-09-24T17:04:47.887

你可以做到这一点，*而不需要*像循环、字符串连接或多次调用 rand() 这样的不干净/昂贵的东西，以一种干净且易于阅读的方式。此外，最好使用`mt_rand()`：

```
function createRandomString($length)
{
    $random = mt_rand(0, (1 << ($length << 2)) - 1);
    return dechex($random);
} 
```

如果您在任何情况下都需要字符串具有确切的长度，只需用零填充十六进制数：

```
function createRandomString($length)
{
    $random = mt_rand(0, (1 << ($length << 2)) - 1);
    $number = dechex($random);
    return str_pad($number, $length, '0', STR_PAD_LEFT);
} 
```

“理论上的倒退”是，您仅限于 PHP 的能力——但在这种情况下，这更像是一个哲学问题；）无论如何，让我们来看看：

*   PHP 在它可以表示为十六进制数字方面受到限制，就像这样。这`$length <= 8` *至少*在 32 位系统上，PHP 对此的限制应该是 4.294.967.295 。
*   PHP 的随机数生成器也有一个最大值。`mt_rand()` *至少*在32 位系统上，它应该是 2.147.483.647
*   所以理论上你只能使用 2.147.483.647 个 ID。

回到主题 - 直觉`do { (generate ID) } while { (id is not uniqe) } (insert id)`有一个缺点和一个可能的缺陷，可能会让你直接陷入黑暗......

**缺点：**验证是悲观的。这样做*总是*需要检查数据库。拥有足够的密钥空间（例如 10k 条目的长度为 5）不太可能经常导致冲突，因为仅尝试存储数据并仅在 UNIQUE KEY 错误的情况下重试可能会消耗更少的资源*。*

**缺陷：** *用户 A*检索到一个被验证为尚未被使用的 ID。然后代码将尝试插入数据。但与此同时，*用户 B*进入了相同的循环，不幸的是检索到了相同的随机数，因为*用户 A*尚未存储，并且此 ID 仍然空闲。现在系统存储*User B*或*User A*，当尝试存储第二个用户时，同时已经有另一个用户 - 具有相同的 ID。

在任何情况下，您都需要处理该异常，并且需要使用新创建的 ID 重新尝试插入。在保持悲观检查循环（您需要重新输入）的同时添加这个将导致非常丑陋且难以遵循的代码。*幸运的是，解决这个问题的方法与解决问题的方法相同：一开始*就去做，然后尝试存储数据。如果出现 UNIQUE KEY 错误，只需使用新 ID 重试即可。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-02-20T13:39:06.317

看看这篇文章

*   [使用 PHP 创建短 ID - 像 Youtube 或 TinyURL](http://kvz.io/blog/2009/06/10/create-short-ids-with-php-like-youtube-or-tinyurl)

它解释了如何从您的 bdd id 生成简短的唯一 id，就像 youtube 一样。

实际上，文章中的函数与[php 函数 base_convert](http://php.net/manual/fr/function.base-convert.php)非常相关，它将一个数字从一个基数转换为另一个数（但最多只能达到 36 个基数）。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-10-29T15:41:45.753

10 个字符：

```
substr(uniqid(),-10); 
```

5个二进制字符：

```
hex2bin( substr(uniqid(),-10) ); 
```

8 个 base64 字符：

```
base64_encode( hex2bin( substr(uniqid(),-10) ) ); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-15T16:26:06.670

```
function rand_str($len = 12, $type = '111', $add = null) {
    $rand = ($type[0] == '1'  ? 'abcdefghijklmnpqrstuvwxyz' : '') .
            ($type[1] == '1'  ? 'ABCDEFGHIJKLMNPQRSTUVWXYZ' : '') .
            ($type[2] == '1'  ? '123456789'                 : '') .
            (strlen($add) > 0 ? $add                        : '');

    if(empty($rand)) $rand = sha1( uniqid(mt_rand(), true) . uniqid( uniqid(mt_rand(), true), true) );

    return substr(str_shuffle( str_repeat($rand, 2) ), 0, $len);
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-08-07T09:11:28.460

如果您喜欢更长版本的唯一 ID，请使用：
$uniqueid = sha1(md5(time()));

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2014-08-04T19:28:22.867

迄今为止的最佳答案：[给定唯一数据库 ID 的最小唯一“类似哈希”字符串 - PHP 解决方案，不需要第三方库。](http://www.tonymarston.net/php-mysql/converter.html)

这是代码：

```
<?php
/*
THE FOLLOWING CODE WILL PRINT:
A database_id value of 200 maps to 5K
A database_id value of 1 maps to 1
A database_id value of 1987645 maps to 16LOD
*/
$database_id = 200;
$base36value = dec2string($database_id, 36);
echo "A database_id value of 200 maps to $base36value\n";
$database_id = 1;
$base36value = dec2string($database_id, 36);
echo "A database_id value of 1 maps to $base36value\n";
$database_id = 1987645;
$base36value = dec2string($database_id, 36);
echo "A database_id value of 1987645 maps to $base36value\n";

// HERE'S THE FUNCTION THAT DOES THE HEAVY LIFTING...
function dec2string ($decimal, $base)
// convert a decimal number into a string using $base
{
    //DebugBreak();
   global $error;
   $string = null;

   $base = (int)$base;
   if ($base < 2 | $base > 36 | $base == 10) {
      echo 'BASE must be in the range 2-9 or 11-36';
      exit;
   } // if

   // maximum character string is 36 characters
   $charset = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';

   // strip off excess characters (anything beyond $base)
   $charset = substr($charset, 0, $base);

   if (!ereg('(^[0-9]{1,50}$)', trim($decimal))) {
      $error['dec_input'] = 'Value must be a positive integer with < 50 digits';
      return false;
   } // if

   do {
      // get remainder after dividing by BASE
      $remainder = bcmod($decimal, $base);

      $char      = substr($charset, $remainder, 1);   // get CHAR from array
      $string    = "$char$string";                    // prepend to output

      //$decimal   = ($decimal - $remainder) / $base;
      $decimal   = bcdiv(bcsub($decimal, $remainder), $base);

   } while ($decimal > 0);

   return $string;

}

?> 
```

# python - python中的函数指针

> ID：307494
> 
> 赞同：5
> 
> 时间：2008-11-21T01:09:28.307
> 
> 标签：python, function-pointers

我想做类似以下的事情：

```
def add(a, b):
    #some code

def subtract(a, b):
    #some code

operations = [add, subtract]
operations[0]( 5,3)
operations[1](5,3) 
```

在python中，是否可以分配函数指针之类的东西？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-11-21T01:30:33.960

你试过了吗？你写的和写的完全一样。函数是 Python 中的一等对象。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-21T02:14:12.483

Python 没有所谓的指针，但您的代码可以按照编写的方式工作。函数是一等对象，分配给名称，并用作任何其他值。

您可以使用它来实现策略模式，例如：

```
def the_simple_way(a, b):
    # blah blah

def the_complicated_way(a, b):
    # blah blah

def foo(way):
    if way == 'complicated':
        doit = the_complicated_way
    else:
        doit = the_simple_way

    doit(a, b) 
```

或查找表：

```
def do_add(a, b):
    return a+b

def do_sub(a, b):
    return a-b

handlers = {
    'add': do_add,
    'sub': do_sub,
}

print handlers[op](a, b) 
```

您甚至可以获取绑定到对象的方法：

```
o = MyObject()
f = o.method
f(1, 2) # same as o.method(1, 2) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T05:23:18.690

请注意，大多数 Python 运算符已经在[operator](http://docs.python.org/library/operator.html)模块中具有等效功能。

# security - 是否存在防止 cookie 被盗的方法？

> ID：307495
> 
> 赞同：8
> 
> 时间：2008-11-21T01:10:00.770
> 
> 标签：security, authentication, cookies

在 Web 2.0 应用程序中，许多用户通常希望保持登录状态（“记住我”标志），另一方面，他们的 cookie 可以访问非常私密的数据。有没有办法防止直接从计算机或通过嗅探窃取 cookie 的人使用 cookie 访问用户数据？始终 HTTPS 不是一个选项。

谢谢，伯恩德

[编辑] 将 IP 地址连接到 cookie 也不是一个选项。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-04T22:26:30.407

KISS - 只需使用会话，以便您使用已由您选择的服务器端脚本语言自动创建的 ID。这已经够难猜了。然后，如果它被盗，将访问者的 IP 地址和用户代理存储在会话中（确保永远不会输出），并且仅**当***已存储*的IP 地址和用户代理与找到的匹配时才认为会话有效远程客户端。

在这种情况下，攻击者必须做以下三件事：

1.  窃取受害者的cookies
2.  欺骗正确的IP地址
3.  欺骗正确的用户代理

它还有助于确保攻击者不知道他/她为了正确接管受害者的会话而必须做的所有事情。IE：他们可能假设只需要 cookie，然后失败了......并且必须通过非常长时间的反复试验来弄清楚其他所有事情。通过这种方式，您可以通过默默无闻和困难获得安全性，具体取决于攻击者的技能和他/她对系统的现有知识。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-21T01:50:58.910

Bernd——通过标准 HTTP 完成的任何事情的问题在于它是纯文本的；任何人都可以伪造任何东西。IP 欺骗比单纯的 cookie 窃取更具挑战性，因此与 IP 绑定往往是人们所做的事情。就像您说的那样，这在高度动态的环境中效果不佳。

我能想到的唯一最安全的方法是使用 HTTPS 放置和验证“永久”cookie，然后放置（在同一个 HTTPS 会话中）一个短期会话 cookie。其余的通信可以通过常规 HTTP 完成，使用会话 cookie 进行身份验证。

这样，在支持加密（仅握手）中使用的资源更少，永久 cookie 不会暴露——它仅在加密下传输——并且窃取会话 cookie 的风险有限，因为该 cookie 将很快过期。

话虽如此——不要让用户在包含真正敏感数据的网站上点击“记住我”！这就是为什么银行不这样做的原因。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-21T01:56:58.647

关于在数据库中存储复杂的 cookie id 和关联的 IP——您实际上不必这样做。如果你有一个密钥 K，用你的 K 加密用户的 ip 就足够了，并将结果 {IP}K 作为 cookie。只要您的密钥是安全的（并且密码没有被破坏——但如果发生这种情况，我们就会遇到更大的问题），这是安全的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-11-15T04:13:51.317

也许使用会话 ID 和令牌（基于 IP、盐和会话 ID 的哈希），每个请求都重新生成（使用快速哈希算法）会是一个好方法吗？我将会话数据存储在数据库中（当前），这意味着每个请求都有两个查询开销。它是这样工作的：

1.  选择 SID 和 TOK 匹配的位置。
2.  验证基于当前客户端生成的令牌与数据库中的令牌是否匹配。
3.  将数据反序列化为属性。
4.  脚本等发生。
5.  序列化更新的数据，重新生成 SID/TOK，并更新数据库，其中 SID/TOK = 旧的 sid 和 tok，更新的数据和新的 sid 和 tok。将 cookie 设置为新的 SID 和 TOK。

通过这种方式，首先 cookie 绑定到我基于令牌的任何内容（在本例中为远程地址），如果它被盗并且客户端数据被欺骗，那么 cookie 无论如何只对一个请求有用 - 到 cookie 是拦截了，没用。

我能看到的唯一可察觉的弱点是，如果攻击者在真人可以发出另一个请求之前设法获取 cookie、欺骗并使用它。有几种方法可以解决这个问题，我需要考虑。开销是两次查询并生成两次令牌哈希（一次用于验证，一次用于替换）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T01:12:35.023

将一个不起眼的 ID cookie 存储到本地服务器数据库中。根据 cookie 中提供的 ID 进行服务器端数据库查找。一定要使 ID 足够复杂以至于不容易被猜到。将 ID 映射到用户的 IP 地址。如果他们的 IP 发生变化，则强制他们重新登录，并创建一个新 ID。

在第二次阅读时，听起来您想要双手被绑住的高度安全性。用户必须选择保持登录状态，从而增加他/她的风险。您可以从应用程序和服务器的角度实现世界上所有的安全性，但是如果用户忘记了他们的笔记本电脑在 Tim Horton（加拿大星巴克）的桌子上，那么这对您没有任何好处。

让用户选择他们是否保持登录状态，并警告他们他们的信息有风险。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-21T01:43:45.197

在饼干罐上盖上盖子。

撇开玩笑不谈，最好的选择已经说明 - 使 cookie 成为一个不起眼的 ID，并将其与服务器端的 IP 地址查找相关联。由于您编辑说您不能将其绑定到 IP 地址，因此留下了晦涩的 ID 部分。您的选择受到 cookie 的限制——您在客户端上放置东西的那一刻，它就会成为一种风险。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-21T16:13:09.013

Bernd - 你说将IP地址连接到cookie不是一个选项，我假设这是b / c用户可以通过DHCP连接，因此每次都可以使用不同的IP。您是否考虑过将 cookie 绑定到 DNS 主机名？您可以使用私钥加密 cookie，并将其存储在用户的盒子中。然后每当他们进来时，检查 cookie，取消加密，然后检查用户当前的 DNS 主机名与 cookie 中的主机名。如果匹配，则允许他们进入。如果不匹配，则不允许自动登录。

仅供参考 - 在 ASP.Net 中，要获取用户框的 DNS 主机名，只需查看

```
Page.Request.UserHostName 
```

# parsing - 一个好的ocaml解析器？

> ID：307499
> 
> 赞同：13
> 
> 时间：2008-11-21T01:10:39.427
> 
> 标签：parsing, ocaml, parsec

我正在寻找一个好的 ocaml 解析库，它不是 flex/bison 的衍生物。理想情况下，我想要一个类似于秒差距的单子组合库，但我找不到任何东西。

我会使用haskell，但是为haskell 进行llvm 绑定证明比我最初想象的更烦人。

干杯，

杜安

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-21T06:12:12.470

[这是一个图书馆](http://ocaml-batteries-team.github.com/batteries-included/hdoc/BatParserCo.html)，通过谷歌。（这也提出了[this](http://osp.janestreet.com/files/pcl.pdf)和[this](http://caml.inria.fr/cgi-bin/hump.en.cgi?sort=0&browse=96)，其中列出了几个听起来更相关的库。）

当我在 ML 中编写组合器解析器时，由于值限制和急切求值，它使用起来相当麻烦，这迫使您对语法规则进行 eta 扩展。不过，据说 Ocaml 对价值限制更加放松——也许你会免于一些痛苦。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-21T15:06:55.683

在 OCaml 世界中，[基于流的解析器](http://www.ffconsultancy.com/ocaml/benefits/parsing.html)和[Camlp4](http://brion.inria.fr/gallium/index.php/Full_parser_tutorial)是接下来两个最常见的替代方案。两者都在之前的[OCaml Journal](http://www.ffconsultancy.com/products/ocaml_journal/?so)文章中进行了详细描述。

在 OCaml 中，Monadic 解析器组合器相对较少，主要是因为有几个更高级别且效率更高的库可用。

# javascript - 如何在 jQuery 中选择单个元素？

> ID：307500
> 
> 赞同：34
> 
> 时间：2008-11-21T01:10:52.220
> 
> 标签：javascript, jquery

我有一个看起来像这样的表结构：

```
<table>
 <tr id="row1">
   <td>
     <div>row 1 content1</div>
   </td>
   <td>
     <div>row 1 content2</div>
   </td>
   <td>
     <div>row 1 content3</div>
   </td>
 </tr>
 <tr id="row2">
   <td>
     <div>row 2 content1</div>
   </td>
   <td>
     <div>row 2 content2</div>
   </td>
   <td>
     <div>row 2 content3</div>
   </td>
 </tr>
 <tr id="row3">
   <td>
     <div>row 3 content1</div>
   </td>
   <td>
     <div>row 3 content2</div>
   </td>
   <td>
     <div>row 3 content3</div>
   </td>
 </tr>
</table> 
```

使用 jQuery 我试图在第三行的第二个单元格中选择 DIV。我尝试了以下（除其他外）：

```
var d = $('#row3').children(':eq(1)').children(':eq(0)'); 
```

我得到的是一个带有单个元素的数组（我之后的 DIV），然后我必须使用 d[0] 访问。为什么 jQuery 返回单个元素数组，我认为使用上面的选择器会直接返回 DIV 元素？

* * *

**[@Shog9](https://stackoverflow.com/questions/307500/how-do-i-select-an-element-in-jquery#307509)** - 呃……好吧，我脑子里的灯刚刚亮了，我现在明白了。干杯。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2012-07-05T13:35:48.683

如果你更喜欢保留一个 jQuery 对象，你可以改写：

```
$("selector").first().val() 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-11-21T01:14:19.607

jQuery 总是返回一组元素。有时，集合是空的。有时，它只包含一个元素。这样做的好处是，无论匹配多少元素，您都可以编写代码以相同的方式工作：

```
$("selector").each(function()
{
   this.style.backgroundColor = "red";
}); 
```

乐趣！

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2011-06-07T17:34:00.317

如果你发现你知道你只会处理一个元素并且只会返回一个元素，你总是可以选择数组的零索引。

```
$("selector")[0].value 
```

它很脏，而且总体上打破了 jQuery 的惯例……但你“可以”这样做。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2015-07-21T18:14:38.917

> $("选择器").eq(5)

这将返回一个只有第 5 个项目的第一类 jquery 数组。即，我可以对返回值执行 jquery 函数。

在这里找到答案： [https ://forum.jquery.com/topic/jquery-class-selectors-referencing-individual-elements](https://forum.jquery.com/topic/jquery-class-selectors-referencing-individual-elements)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-04-04T14:53:18.517

有几个选项可以做到这一点：

“在下面的片段中选择几个 Div 元素中的第一个并将其颜色更改为粉红色”

`<div>Div 1</div> <div class="highlight">Div 2</div> <div id="third">Div 3</div> <div class="highlight">Div 4</div>`

这里我们可以通过以下方式选择第一个Div：

1) `$("div").first().css("color","pink");`
2) `$("div:first").css("color","pink");`
3)`$("div:first-of-type").css("color","pink");`

请注意，2 是一个 jQuery 构造，而不是本机 css 构造，因此性能可能会稍差一些。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-09-13T19:10:33.217

这适用于 jQuery 3.4.1：

`$($('li')[0]).css('color', 'blue');`

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2015-07-31T09:57:11.077

要直接获取 div，试试这个

```
$divElement = $('#row3 td div');
```

# linux - 在 Linux 中，“top”命令中的所有值是什么意思？

> ID：307502
> 
> 赞同：62
> 
> 时间：2008-11-21T01:11:22.033
> 
> 标签：linux, command-line, top-command

当您运行`top`并查看所有正在运行的进程时，我一直想知道一切的真正含义。例如，正在运行的进程的所有各种单字母状态代码（R = Running，S = Sleeping，等等...）

我在哪里可以找到这个？

* * *

## 回答 #1

> 赞同：130
> 
> 时间：2008-11-21T01:26:37.117

[手册页](https://www.man7.org/linux/man-pages/man1/top.1.html)说明了状态代码映射到什么，但没有说明它们的实际含义。从`top`手册页：

```
'D' = uninterruptible sleep
'R' = running
'S' = sleeping
'T' = traced or stopped
'Z' = zombie 
```

“R”是最简单的；该进程已准备好运行，并且将在轮到使用 CPU 时运行。

'S' 和 'D' 是两种睡眠状态，进程正在等待某些事情发生。不同之处在于“S”可以被信号中断，而“D”不能（通常在进程等待磁盘时看到）。

'T' 是进程停止的状态，通常通过`SIGSTOP`或`SIGTSTP`。它也可以由调试器 ( `ptrace`) 停止。当您看到该状态时，通常是因为您使用`Ctrl`+`Z`将命令置于后台。

“Z”是进程死亡的状态（它已经完成了执行），唯一剩下的就是在内核上描述它的结构。它正在等待其父进程检索其退出代码，仅此而已。在它的父进程用完它后，它就会消失。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-11-21T01:13:04.150

您可以使用以下命令[`man top`](https://www.man7.org/linux/man-pages/man1/top.1.html)查找状态：

```
D = uninterruptible sleep
I = idle
R = running
S = sleeping
T = stopped by job control signal
t = stopped by debugger during trace
Z = zombie 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2020-11-05T22:04:31.720

程序喜欢`top`并`ps`从内核本身获取这些值。您可以在此处的源代码中找到它的定义：

[https://github.com/torvalds/linux/blob/3950e975431bc914f7e81b8f2a2dbdf2064acb0f/fs/proc/array.c#L129-L143](https://github.com/torvalds/linux/blob/3950e975431bc914f7e81b8f2a2dbdf2064acb0f/fs/proc/array.c#L129-L143)

```
static const char * const task_state_array[] = {

    /* states in TASK_REPORT: */
    "R (running)",      /* 0x00 */
    "S (sleeping)",     /* 0x01 */
    "D (disk sleep)",   /* 0x02 */
    "T (stopped)",      /* 0x04 */
    "t (tracing stop)", /* 0x08 */
    "X (dead)",     /* 0x10 */
    "Z (zombie)",       /* 0x20 */
    "P (parked)",       /* 0x40 */

    /* states beyond TASK_REPORT: */
    "I (idle)",     /* 0x80 */
}; 
```

有关更多信息，请参阅此问题：[https ://unix.stackexchange.com/q/462098/79648](https://unix.stackexchange.com/q/462098/79648)

# bash - 检查环境变量是否在 Unix shell 脚本中设置的简洁方法是什么？

> ID：307503
> 
> 赞同：513
> 
> 时间：2008-11-21T01:11:27.913
> 
> 标签：bash, unix, shell

我有一些 Unix shell 脚本，我需要在开始做事之前检查是否设置了某些环境变量，所以我做了这样的事情：

```
if [ -z "$STATE" ]; then
    echo "Need to set STATE"
    exit 1
fi  

if [ -z "$DEST" ]; then
    echo "Need to set DEST"
    exit 1
fi 
```

这是很多打字。是否有更优雅的习惯用法来检查是否设置了一组环境变量？

编辑：我应该提到这些变量没有有意义的默认值 - 如果任何未设置，脚本应该出错。

* * *

## 回答 #1

> 赞同：605
> 
> 时间：2008-11-21T03:25:31.200

### 参数扩展

显而易见的答案是使用一种特殊形式的参数扩展：

```
: ${STATE?"Need to set STATE"}
: ${DEST:?"Need to set DEST non-empty"} 
```

或者，更好（参见下面的“双引号位置”部分）：

```
: "${STATE?Need to set STATE}"
: "${DEST:?Need to set DEST non-empty}" 
```

第一个变体（仅使用`?`）需要设置 STATE，但 STATE="" （一个空字符串）是可以的——不完全是你想要的，而是替代的和旧的表示法。

第二个变体（使用`:?`）需要设置 DEST 且非空。

如果您不提供任何消息，shell 将提供默认消息。

该`${var?}`构造可移植回版本 7 UNIX 和 Bourne Shell（1978 年左右）。该`${var:?}`构造稍微更新一些：我认为它在 1981 年左右出现在 System III UNIX 中，但在此之前它可能已经出现在 PWB UNIX 中。因此它存在于 Korn Shell 和 POSIX shell 中，包括特别是 Bash。

它通常记录在 shell 手册页中名为[Parameter Expansion](http://www.gnu.org/software/bash/manual/bash.html#Shell-Parameter-Expansion)的部分中。例如，`bash`手册说：

> ```
> ${parameter:?word} 
> ```
> 
> 如果为 Null 或未设置，则显示错误。如果 parameter 为 null 或未设置，则 word 的扩展（或如果 word 不存在，则将显示消息）写入标准错误，并且 shell，如果它不是交互式的，则退出。否则，参数的值被替换。

### 结肠指挥部

我可能应该补充一点，冒号命令只是对其参数进行评估，然后成功。它是原始的 shell 注释符号（在 ' `#`' 到行尾之前）。很长一段时间以来，Bourne shell 脚本都以冒号作为第一个字符。C Shell 将读取一个脚本并使用第一个字符来确定它是用于 C Shell（一个 ' `#`' 散列）还是 Bourne shell（一个 ' `:`' 冒号）。然后内核参与进来，增加了对' `#!/path/to/program`'的支持，Bourne shell 得到了' `#`'注释，冒号约定被搁置了。但是如果你遇到一个以冒号开头的脚本，现在你就会知道为什么了。

* * *

### 双引号的位置

[blong](https://stackoverflow.com/users/320399/blong)在[评论](https://stackoverflow.com/questions/307503/whats-the-best-way-to-check-that-environment-variables-are-set-in-unix-shellscr/307735?noredirect=1#comment53771660_307735)中问道：

> 对这个讨论有什么想法吗？[https://github.com/koalaman/shellcheck/issues/380#issuecomment-145872749](https://github.com/koalaman/shellcheck/issues/380#issuecomment-145872749)

讨论的要点是：

> …但是，当我`shellcheck`（使用版本 0.4.1）时，我收到以下消息：
> 
> ```
> In script.sh line 13:
> : ${FOO:?"The environment variable 'FOO' must be set and non-empty"}
>   ^-- SC2086: Double quote to prevent globbing and word splitting. 
> ```
> 
> 在这种情况下我应该做什么有什么建议吗？

简短的回答是“按照`shellcheck`建议做”：

```
: "${STATE?Need to set STATE}"
: "${DEST:?Need to set DEST non-empty}" 
```

为了说明原因，请研究以下内容。请注意，该`:`命令不会回显其参数（但 shell 会评估参数）。我们想查看参数，所以下面的代码使用`printf "%s\n"`.`:`

```
$ mkdir junk
$ cd junk
$ > abc
$ > def
$ > ghi
$ 
$ x="*"
$ printf "%s\n" ${x:?You must set x}    # Careless; not recommended
abc
def
ghi
$ unset x
$ printf "%s\n" ${x:?You must set x}    # Careless; not recommended
bash: x: You must set x
$ printf "%s\n" "${x:?You must set x}"  # Careful: should be used
bash: x: You must set x
$ x="*"
$ printf "%s\n" "${x:?You must set x}"  # Careful: should be used
*
$ printf "%s\n" ${x:?"You must set x"}  # Not quite careful enough
abc
def
ghi
$ x=
$ printf "%s\n" ${x:?"You must set x"}  # Not quite careful enough
bash: x: You must set x
$ unset x
$ printf "%s\n" ${x:?"You must set x"}  # Not quite careful enough
bash: x: You must set x
$ 
```

请注意，当整个表达式不在双引号中时，如何将 in 的值`$x`先扩展为文件名列表，然后再扩展为文件名列表。`*`这是`shellcheck`建议应该解决的问题。我还没有验证它不反对表达式用双引号括起来的形式，但这是一个合理的假设，它可以。

* * *

## 回答 #2

> 赞同：143
> 
> 时间：2008-11-21T01:32:16.653

试试这个：

```
[ -z "$STATE" ] && echo "Need to set STATE" && exit 1; 
```

* * *

## 回答 #3

> 赞同：56
> 
> 时间：2008-11-21T01:45:52.710

您的问题取决于您使用的外壳。

Bourne shell 对您所追求的东西的影响很小。

但...

它确实有效，几乎无处不在。

试着远离 csh。与 Bourne shell 相比，它添加的花里胡哨很有用，但它现在真的吱吱作响。如果您不相信我，请尝试在 csh 中分离出 STDERR！（-：

这里有两种可能。上面的例子，即使用：

```
${MyVariable:=SomeDefault} 
```

第一次您需要参考 $MyVariable。这需要环境。var MyVariable，如果当前未设置，则将 SomeDefault 的值分配给变量以供以后使用。

您还可以：

```
${MyVariable:-SomeDefault} 
```

它只是用 SomeDefault 代替您使用此构造的变量。它不会将值 SomeDefault 赋给变量，在遇到此语句后，MyVariable 的值仍将为 null。

* * *

## 回答 #4

> 赞同：53
> 
> 时间：2011-10-26T15:21:34.573

当然，最简单的方法是将`-u`开关添加到 shebang（脚本顶部的行），假设您正在使用`bash`：

`#!/bin/sh -u`

如果任何未绑定的变量潜伏在其中，这将导致脚本退出。

* * *

## 回答 #5

> 赞同：40
> 
> 时间：2008-11-21T01:24:33.410

```
${MyVariable:=SomeDefault} 
```

如果`MyVariable`设置且不为空，它将重置变量值（= 没有任何反应）。
否则，`MyVariable`设置为`SomeDefault`。

以上将尝试执行`${MyVariable}`，所以如果您只想设置变量，请执行以下操作：

```
MyVariable=${MyVariable:=SomeDefault} 
```

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2014-10-11T17:39:10.560

**在我看来，#!/bin/sh**的最简单和最兼容的检查是：

```
if [ "$MYVAR" = "" ]
then
   echo "Does not exist"
else
   echo "Exists"
fi 
```

同样，这适用于 /bin/sh，并且在旧的 Solaris 系统上也兼容。

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2016-09-21T15:56:07.930

`bash`4.2 引入了`-v`测试名称是否设置为*任何*值的运算符，即使是空字符串。

```
$ unset a
$ b=
$ c=
$ [[ -v a ]] && echo "a is set"
$ [[ -v b ]] && echo "b is set"
b is set
$ [[ -v c ]] && echo "c is set"
c is set 
```

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2008-11-21T02:24:27.750

我一直用：

```
if [ "x$STATE" == "x" ]; then echo "Need to set State"; exit 1; fi 
```

恐怕没有那么简洁。

在 CSH 下你有 $?STATE。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2017-06-22T18:33:48.567

对于像我这样的未来人，我想更进一步并参数化 var 名称，这样我就可以遍历一个可变大小的变量名称列表：

```
#!/bin/bash
declare -a vars=(NAME GITLAB_URL GITLAB_TOKEN)

for var_name in "${vars[@]}"
do
  if [ -z "$(eval "echo \$$var_name")" ]; then
    echo "Missing environment variable $var_name"
    exit 1
  fi
done 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-05-16T05:05:02.510

我们可以编写一个很好的断言来一次检查一堆变量：

```
#
# assert if variables are set (to a non-empty string)
# if any variable is not set, exit 1 (when -f option is set) or return 1 otherwise
#
# Usage: assert_var_not_null [-f] variable ...
#
function assert_var_not_null() {
  local fatal var num_null=0
  [[ "$1" = "-f" ]] && { shift; fatal=1; }
  for var in "$@"; do
    [[ -z "${!var}" ]] &&
      printf '%s\n' "Variable '$var' not set" >&2 &&
      ((num_null++))
  done

  if ((num_null > 0)); then
    [[ "$fatal" ]] && exit 1
    return 1
  fi
  return 0
} 
```

示例调用：

```
one=1 two=2
assert_var_not_null one two
echo test 1: return_code=$?
assert_var_not_null one two three
echo test 2: return_code=$?
assert_var_not_null -f one two three
echo test 3: return_code=$? # this code shouldn't execute 
```

输出：

```
test 1: return_code=0
Variable 'three' not set
test 2: return_code=1
Variable 'three' not set 
```

* * *

更多这样的断言：[https ://github.com/codeforester/base/blob/master/lib/assertions.sh](https://github.com/codeforester/base/blob/master/lib/assertions.sh)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-01-12T02:14:46.053

这也可以是一种方式：

```
if (set -u; : $HOME) 2> /dev/null
...
... 
```

[http://unstableme.blogspot.com/2007/02/checks-whether-envvar-is-set-or-not.html](http://unstableme.blogspot.com/2007/02/checks-whether-envvar-is-set-or-not.html)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2017-03-09T14:04:22.553

上述解决方案都不适用于我的目的，部分原因是我在开始漫长的过程之前检查了环境中需要设置的开放式变量列表。我最终得到了这个：

```
mapfile -t arr < variables.txt

EXITCODE=0

for i in "${arr[@]}"
do
   ISSET=$(env | grep ^${i}= | wc -l)
   if [ "${ISSET}" = "0" ];
   then
      EXITCODE=-1
      echo "ENV variable $i is required."
   fi
done

exit ${EXITCODE} 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2017-10-28T13:00:44.230

我倾向于在登录 shell 中加载函数，而不是使用外部 shell 脚本。我使用这样的东西作为辅助函数来检查环境变量而不是任何设置变量：

```
is_this_an_env_variable ()
    local var="$1"
    if env |grep -q "^$var"; then
       return 0
    else
       return 1
    fi
 } 
```

* * *

## 回答 #14

> 赞同：-7
> 
> 时间：2010-05-14T06:08:23.197

`$?`语法非常简洁：

```
if [ $?BLAH == 1 ]; then 
    echo "Exists"; 
else 
    echo "Does not exist"; 
fi 
```

# c# - 如何使用通用扩展方法中的字符串列名在 IQueryable 上应用 OrderBy？

> ID：307512
> 
> 赞同：89
> 
> 时间：2008-11-21T01:15:44.067
> 
> 标签：c#, .net, linq, entity-framework, expression-trees

```
public static IQueryable<TResult> ApplySortFilter<T, TResult>(this IQueryable<T> query, string columnName)
  where T : EntityObject
{
  var param = Expression.Parameter(typeof(T), "o");
  var body = Expression.PropertyOrField(param,columnName);

  var sortExpression = Expression.Lambda(body, param);
  return query.OrderBy(sortExpression);
} 
```

因为 OrderBy 的类型不是从 sortExpression 推断出来的，所以我需要在运行时指定如下内容：

```
var sortExpression = Expression.Lambda<T, TSortColumn>(body, param); 
```

或者

```
return query.OrderBy<T, TSortColumn>(sortExpression); 
```

但是我认为这是不可能的，因为 TSortColumn 只能在运行时确定。

有没有解决的办法？

* * *

## 回答 #1

> 赞同：118
> 
> 时间：2008-11-21T02:01:15.160

我们在 LINQ to SQL 项目中做了类似的事情（不是 100% 相同，而是类似）。这是代码：

```
public static IQueryable<T> OrderBy<T>(this IQueryable<T> source, string ordering, params object[] values) {
    var type = typeof(T);
    var property = type.GetProperty(ordering);
    var parameter = Expression.Parameter(type, "p");
    var propertyAccess = Expression.MakeMemberAccess(parameter, property);
    var orderByExp = Expression.Lambda(propertyAccess, parameter);
    MethodCallExpression resultExp = Expression.Call(typeof(Queryable), "OrderBy", new Type[] { type, property.PropertyType }, source.Expression, Expression.Quote(orderByExp));
    return source.Provider.CreateQuery<T>(resultExp);
} 
```

我们实际上并没有使用泛型，我们有一个已知的类，但它应该适用于泛型（我已将泛型占位符放在它应该在的位置）。

**编辑：**对于降序，传入`OrderByDescending`而不是“OrderBy”：

```
MethodCallExpression resultExp = Expression.Call(typeof(Queryable), "OrderByDescending", new Type[] { type, property.PropertyType }, source.Expression, Expression.Quote(orderByExp)); 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-05-12T16:17:50.620

您还可以使用动态 Linq

信息在这里 [http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)

C#在这里下载 [http://msdn.microsoft.com/en-us/vcsharp/bb894665.aspx](http://msdn.microsoft.com/en-us/vcsharp/bb894665.aspx)

然后只需添加 using Linq.Dynamic; 你会自动获得 2 个额外的扩展方法，可以像这样使用

```
return query.OrderBy("StringColumnName"); 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-21T14:00:03.277

我已经扩展了您的功能以添加对子属性的支持。

```
private static LambdaExpression GenerateSelector<TEntity>(String propertyName, out Type resultType) where TEntity : class
{
    // Create a parameter to pass into the Lambda expression (Entity => Entity.OrderByField).
    var parameter = Expression.Parameter(typeof(TEntity), "Entity");
    //  create the selector part, but support child properties
    PropertyInfo property;
    Expression propertyAccess;
    if (propertyName.Contains('.'))
    {
            // support to be sorted on child fields.
            String[] childProperties = propertyName.Split('.');
            property = typeof(TEntity).GetProperty(childProperties[0]);
            propertyAccess = Expression.MakeMemberAccess(parameter, property);
            for (int i = 1; i < childProperties.Length; i++)
            {
                    property = property.PropertyType.GetProperty(childProperties[i]);
                    propertyAccess = Expression.MakeMemberAccess(propertyAccess, property);
            }
    }
    else
    {
            property = typeof(TEntity).GetProperty(propertyName);
            propertyAccess = Expression.MakeMemberAccess(parameter, property);
    }
    resultType = property.PropertyType;                     
    // Create the order by expression.
    return Expression.Lambda(propertyAccess, parameter);
}

private static MethodCallExpression GenerateMethodCall<TEntity>(IQueryable<TEntity> source, string methodName, String fieldName) where TEntity : class
{
    Type type = typeof(TEntity);
    Type selectorResultType;
    LambdaExpression selector = GenerateSelector<TEntity>(fieldName, out selectorResultType);
    MethodCallExpression resultExp = Expression.Call(typeof(Queryable), methodName,
                                    new Type[] { type, selectorResultType },
                                    source.Expression, Expression.Quote(selector));
    return resultExp;
} 
```

您可以使用以下功能：

```
GenerateMethodCall<TEntity>(source, "OrderByDescending", fieldName); 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-11-03T20:56:06.550

我将您的想法用于 OrderBy 的扩展方法。但在“多对多”的情况下，我会出错。例如，您有表 Site、Customer 和 Customer_site。对于给定的站点，我想按客户名称和 OrderBy 扩展名排序（当我通过“site.customer”时，客户是导航属性）我在行中遇到错误：propertyAccess = Expression.MakeMemberAccess(propertyAccess, property);

这就是我使用的（带有一些增强功能:-)）：

```
public static IQueryable<TEntity> OrderBy<TEntity>(this IQueryable<TEntity> source, string orderByValues) where TEntity : class
{
  IQueryable<TEntity> returnValue = null;

  string orderPair = orderByValues.Trim().Split(',')[0];
  string command = orderPair.ToUpper().Contains("DESC") ? "OrderByDescending" : "OrderBy";

  var type = typeof(TEntity);
  var parameter = Expression.Parameter(type, "p");

  string propertyName = (orderPair.Split(' ')[0]).Trim();

  System.Reflection.PropertyInfo property;
  MemberExpression propertyAccess;

  if (propertyName.Contains('.'))
  {
    // support to be sorted on child fields. 
    String[] childProperties = propertyName.Split('.');
    property = typeof(TEntity).GetProperty(childProperties[0]);
    propertyAccess = Expression.MakeMemberAccess(parameter, property);

    for (int i = 1; i < childProperties.Length; i++)
    {
      Type t = property.PropertyType;
      if (!t.IsGenericType)
      {
        property = t.GetProperty(childProperties[i]);
      }
      else
      {
        property = t.GetGenericArguments().First().GetProperty(childProperties[i]);
      }

      propertyAccess = Expression.MakeMemberAccess(propertyAccess, property);
    }
  }
  else
  {
    property = type.GetProperty(propertyName);
    propertyAccess = Expression.MakeMemberAccess(parameter, property);
  }

  var orderByExpression = Expression.Lambda(propertyAccess, parameter);

  var resultExpression = Expression.Call(typeof(Queryable), command, new Type[] { type, property.PropertyType },

  source.Expression, Expression.Quote(orderByExpression));

  returnValue = source.Provider.CreateQuery<TEntity>(resultExpression);

  if (orderByValues.Trim().Split(',').Count() > 1)
  {
    // remove first item
    string newSearchForWords = orderByValues.ToString().Remove(0, orderByValues.ToString().IndexOf(',') + 1);
    return source.OrderBy(newSearchForWords);
  }

  return returnValue;
} 
```

问候

斯洛博丹

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-21T02:00:41.107

似乎[这](http://msdn.microsoft.com/en-us/library/bb882637.aspx)是这样做的方法，现在验证一下：

```
// ***** OrderBy(company => company) *****
// Create an expression tree that represents the expression
// 'whereCallExpression.OrderBy(company => company)'
MethodCallExpression orderByCallExpression = Expression.Call(
    typeof(Queryable),
    "OrderBy",
    new Type[] { queryableData.ElementType, queryableData.ElementType },
    whereCallExpression,
    Expression.Lambda<Func<string, string>>(pe, new ParameterExpression[] { pe }));
// ***** End OrderBy ***** 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-02-12T17:42:17.800

如果你能够添加“System.Linq.Dynamic”包那么，太简单了，没有任何复杂性，

来自 NuGet 包管理器的第一个 insatll 包“System.Linq.Dynamic”，然后根据需要尝试如下，

前任：

```
public IQueryable<TEntity> GetWithInclude(Expression<Func<TEntity, bool>> predicate,
                    List<string> sortBy, int pageNo, int pageSize = 12, params string[] include)
        {
            try
            {
                var numberOfRecordsToSkip = pageNo * pageSize;
                var dynamic = DbSet.AsQueryable();

                foreach (var s in include)
                {
                    dynamic.Include(s);
                }
                 return dynamic.OrderBy("CreatedDate").Skip(numberOfRecordsToSkip).Take(pageSize);

            }
            catch (Exception e)
            {
                throw new Exception(e.Message);
            }
        } 
```

希望这会有所帮助

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-05-04T13:01:41.290

我稍微修复了这段代码：[https ://stackoverflow.com/a/1670085/5852630](https://stackoverflow.com/a/1670085/5852630)

此代码适用于顺序排序：首先执行“OrderBy”，然后执行“ThenBy”（不是“OrderBy”！）

```
public static IQueryable<TEntity> OrderBy<TEntity>(this IQueryable<TEntity> source, string orderByValues) where TEntity : class
{
    IQueryable<TEntity> returnValue = null;

    string[] orderPairs = orderByValues.Trim().Split(',');

    Expression resultExpression = source.Expression;

    string strAsc = "OrderBy";
    string strDesc = "OrderByDescending";

    foreach (string orderPair in orderPairs)
    {
        if (string.IsNullOrWhiteSpace(orderPair))
            continue;

        string[] orderPairArr = orderPair.Trim().Split(' ');

        string propertyName = orderPairArr[0].Trim();
        string orderNarrow = orderPairArr.Length > 1 ? orderPairArr[1].Trim() : string.Empty;

        string command = orderNarrow.ToUpper().Contains("DESC") ? strDesc : strAsc;

        Type type = typeof(TEntity);
        ParameterExpression parameter = Expression.Parameter(type, "p");

        System.Reflection.PropertyInfo property;
        Expression propertyAccess;

        if (propertyName.Contains('.'))
        {
            // support to be sorted on child fields. 
            String[] childProperties = propertyName.Split('.');
            property = typeof(TEntity).GetProperty(childProperties[0]);
            propertyAccess = Expression.MakeMemberAccess(parameter, property);

            for (int i = 1; i < childProperties.Length; i++)
            {
                Type t = property.PropertyType;
                if (!t.IsGenericType)
                {
                    property = t.GetProperty(childProperties[i]);
                }
                else
                {
                    property = t.GetGenericArguments().First().GetProperty(childProperties[i]);
                }

                propertyAccess = Expression.MakeMemberAccess(propertyAccess, property);
            }
        }
        else
        {
            property = type.GetProperty(propertyName);
            propertyAccess = Expression.MakeMemberAccess(parameter, property);
        }

        if (property.PropertyType == typeof(object))
        {
            propertyAccess = Expression.Call(propertyAccess, "ToString", null);
        }

        LambdaExpression orderByExpression = Expression.Lambda(propertyAccess, parameter);

        resultExpression = Expression.Call(typeof(Queryable), command, new Type[] { type, property.PropertyType == typeof(object) ? typeof(string) : property.PropertyType },
            resultExpression, Expression.Quote(orderByExpression));

        strAsc = "ThenBy";
        strDesc = "ThenByDescending";
    }

    returnValue = source.Provider.CreateQuery<TEntity>(resultExpression);

    return returnValue;
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-10-04T19:28:21.947

这是我对[@Davy Landman](https://stackoverflow.com/users/11098/davy-landman)答案的改编（我想要一个扩展方法），我简化了一点。

```
public static IQueryable<T> SortBy<T>(this IQueryable<T> source, 
                                      String propertyName, 
                                      WebControls.SortDirection direction)
    {
        if (source == null) throw new ArgumentNullException("source");
        if (String.IsNullOrEmpty(propertyName)) return source;

        // Create a parameter to pass into the Lambda expression
        //(Entity => Entity.OrderByField).
        var parameter = Expression.Parameter(typeof(T), "Entity");

        //  create the selector part, but support child properties (it works without . too)
        String[] childProperties = propertyName.Split('.');
        MemberExpression property = Expression.Property(parameter, childProperties[0]);
        for (int i = 1; i < childProperties.Length; i++)
        {
            property = Expression.Property(property, childProperties[i]);
        }

        LambdaExpression selector = Expression.Lambda(property, parameter);

        string methodName = (direction > 0) ? "OrderByDescending" : "OrderBy";

        MethodCallExpression resultExp = Expression.Call(typeof(Queryable), methodName,
                                        new Type[] { source.ElementType, property.Type },
                                        source.Expression, Expression.Quote(selector));

        return source.Provider.CreateQuery<T>(resultExp);
    } 
```

它可以这样使用：

```
gridview1.DataSource = DbContext.TB_CARS.SortBy("model", SortDirection.Descending);
//OR
gridview1.DataSource = DbContext.TB_CARS.SortBy("owner.first_name", 0); 
```

# controls - 服务器控件的自定义智能感知？

> ID：307514
> 
> 赞同：3
> 
> 时间：2008-11-21T01:17:17.120
> 
> 标签：controls, intellisense

您能否对 Visual Studio 进行编程/配置，以便为您自己的服务器控件生成自定义智能感知。

例如，你能做到这一点吗：

[替代文字 http://www.yart.com.au/test/vs.gif](http://www.yart.com.au/test/vs.gif)

对于您自己的标签，例如：

```
<MyCompany:MyTag ... 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T01:55:24.860

您应该免费获得它（控制的默认行为）。当您键入自定义控件时，引用是否全部到位？

有一个属性可以从智能感知中隐藏属性：

```
[EditorBrowsableAttribute (EditorBrowsableState.Never)] 
```

使用 description 属性来提供额外的帮助：

```
[Description("My extra helpful description")] 
```

还有一些其他属性会影响智能感知和您可能想要查找的属性资源管理器......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T01:40:39.413

Bluevision 有一个不错的 Visual Studio 插件可以为您执行此操作。上次看的时候是免费的。（是的，它仍然是免费的！）

*   IntellisenseAttribute 类允许您指定将为其生成智能感知符号的成员。

*   当您无权访问源代码时，能够为程序集生成默认智能感知符号。

*   NEW 直接插入 IDE，以便在构建过程中自动生成智能感知。

*   支持两种视觉视图：完整模式和皮肤模式。

*   完整的源代码。

*   自由！

[http://www.bluevisionsoftware.com/WebSite/ProductsAndServicesInfo.aspx?ID=9](http://www.bluevisionsoftware.com/WebSite/ProductsAndServicesInfo.aspx?ID=9)

# c++ - 你能在 C++ 中保护嵌套类吗？

> ID：307524
> 
> 赞同：5
> 
> 时间：2008-11-21T01:23:46.280
> 
> 标签：c++, class, nested, protected

我有一个类，只有特定类层次结构中的类才真正需要。我想知道是否可以将类嵌套在最高类的受保护部分并让所有其他类自动继承它？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-21T01:30:00.277

“继承”是一个错误的词，因为它在 C++ 中有一个非常具体的定义，你不是这个意思，但是你可以这样做。这是合法的：

```
 class A {
   protected:
   class Nested { };
 };

 class B : public A {
   private:
   Nested n;
 }; 
```

不在 A 中的代码或从 A 派生的代码无法访问或实例化 A::Nested。

# flash - 为什么补间随机停止？

> ID：307531
> 
> 赞同：2
> 
> 时间：2008-11-21T01:27:28.660
> 
> 标签：flash, actionscript-3

使用如下代码，有时子控件会正确完成动画，有时它们会在中间的随机位置停止。为什么它们不能正常工作？

```
var t:Tween;
t = new Tween(child1,"x",Elastic.easeOut,0,100,2,true);
t = new Tween(child1,"y", Elastic.easeOut,0,100,2,true);
t = new Tween(child2,"x",Strong.easeOut,300,400,1,true);
t = new Tween(child2,"y", Strong.easeOut,300,400,1,true); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T14:34:49.743

此外，请尝试使用免费/开源补间引擎，而不是使用 Flash 打包的引擎。两个非常流行的是[TweenLite](http://blog.greensock.com/tweenliteas3/)和[Tweener](http://code.google.com/p/tweener/)。它们提供更高的性能和更多的功能/选项。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T01:29:05.553

每个补间必须分配给全局范围内的单独变量。以下代码的行为可靠：

```
var t1:Tween = new Tween(child1,"x",Elastic.easeOut,0,100,2,true);
var t2:Tween = new Tween(child1,"y", Elastic.easeOut,0,100,2,true);
var t3:Tween = new Tween(child2,"x",Strong.easeOut,300,400,1,true);
var t4:Tween = new Tween(child2,"y", Strong.easeOut,300,400,1,true); 
```

看起来，当一个变量被重用时，不再引用的补间可能会被垃圾收集或以其他方式在其工作中间停止。

如果您使用单独的变量但在函数的局部范围内而不是在框架的全局范围内声明它们，则可能会出现同样的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-03-20T20:36:56.710

您还可以在类的范围内创建一个数组，然后将补间推入该数组。虽然这可能会导致数组中的补间永远不会被垃圾收集，即使在它们完成之后，您可能希望在您知道所有补间都已完成的点处自己清空数组。

# javascript - 如何通过 JavaScript 通过 TCP 套接字进行通信？

> ID：307539
> 
> 赞同：24
> 
> 时间：2008-11-21T01:31:56.297
> 
> 标签：javascript, ajax, user-interface, sockets

我正在考虑 AJAX 应用程序必须轮询更新的限制有多大，而理想的情况是 javascript 能够建立与服务器的真正双向连接。我想知道是否有某种方法可以将 javascript 与可以建立 tcp 连接的浏览器插件集成，以便我可以将数据传入和传出浏览器插件。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2011-07-09T02:12:57.753

[WebSockets](http://en.wikipedia.org/wiki/WebSockets)就是为了解决这个问题而设计的。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-21T01:42:58.847

这是具有类似方法的实现：

*   [套接字](http://sly.w3m.hu/socketjs)

它使用 Java Applet 并将其 API 桥接到 JavaScript，有趣...

这里还有一个：

*   [jSocket](http://code.google.com/p/jsocket/)

这是一个 Actionscript 3 Socket API 的封装，桥接到 JavaScript...

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-07-28T21:58:41.607

您可以使用[node.js](http://nodejs.org/)框架的[socket.io](http://socket.io/)包，该包可以通过[npm](http://npmjs.org/)（一个节点包管理器）安装。

更详细的[用法](http://socket.io/#how-to-use)。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-21T02:19:06.123

[jSocket](http://code.google.com/p/jsocket/wiki/Introduction)和[Stream](http://stream.stormtide.ca/)是利用 Flash 的内置 XML 套接字的两个选项，尽管它们似乎都不是生产就绪的。我倾向于使用基于 Flash 的解决方案而不是 Java，因为浏览器渗透率[更高](http://www.realchat.com/blog/java-vs-flash/)，并且通常提供更好的用户体验（加载时间和稳定性）。

# xml - 用于 XML 编辑的 InfoPath 的替代方法是什么？

> ID：307541
> 
> 赞同：0
> 
> 时间：2008-11-21T01:32:20.710
> 
> 标签：xml, infopath

我们正在考虑为我们的非技术用户提供一种方法来编辑 XML 并将其传递给我们现有的 XML 输入功能。我记得 InfoPath 将其数据保存为 XML，并再次查看了它。它允许您基于 XSD（XML 模式）定义表单，然后允许用户在不知道它是 XML 文件的情况下编辑 XML，这种方式非常棒。由于 InfoPath 的输入约束，生成的 XML 可以完美验证。

一个问题是我们不能假设我们的用户群会安装 MS InfoPath。

是否有另一种自动生成表单的方法，允许用户轻松编辑 XML？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T01:40:11.723

您可以将表单托管到 Sharepoint。InfoPath Forms Services 是一种基于 Microsoft Windows SharePoint Services 3.0 构建的服务器技术，作为 ASP.NET 2.0 版应用程序。它使用户能够使用 Web 浏览器来填写 Microsoft Office InfoPath 2007 表单，而不是使用 Office InfoPath 2007 客户端程序，或者除了使用 Office InfoPath 2007 客户端程序之外。

[http://msdn.microsoft.com/en-us/library/ms540731.aspx](http://msdn.microsoft.com/en-us/library/ms540731.aspx)

当然还有其他方法是在任何技术中基于 XML 创建自定义表单并为用户提供表单

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T01:36:20.360

Altova，XML Spy 背后的人，为任何给定的 XML 模式（以及 iirc 的 DTD）提供了某种自动输入表单生成器。

[http://www.altova.com/](http://www.altova.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-25T23:36:41.427

另外两个建议（我不知道您正在设计什么用户/环境）：

*   使用带有内容控件的 Word 2007 作为表单编辑器。输入内容控件的数据存储在 DOCX 文档内的单独 XML 文件中，该文件只是一个 zip 存档。

*   Adobe 表格。使用 Adob​​e Reader 用户可以填写和提交 PDF 表格。阅读器可以将数据提交或保存为 XML（使用自定义模式）。

与 InfoPath 相比，上述两个客户端都很普遍，并且为许多用户所熟悉，但您的决定当然取决于我的其他因素。因此，请仅将此作为两个建议。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-25T23:50:54.453

一种非常可定制的方法是提供一个 WPF UI，它将数据绑定到 XML。在 WPF 中想出一个 XML 设计器不应该花费很多精力。

当然，这假设您有资源/人员来做这件事。

[如果您有兴趣，请查看此示例](http://blogs.msdn.com/wpfsdk/archive/2008/11/25/a-datagrid-sample-using-xml-data.aspx)

# c# - 你在 C# 中使用“this”运算符吗？

> ID：307558
> 
> 赞同：2
> 
> 时间：2008-11-21T01:41:19.897
> 
> 标签：c#, .net, programming-languages

### 重复帖子，请参阅：[您何时使用“this”关键字？](https://stackoverflow.com/questions/23250/when-do-you-use-the-this-keyword)

* * *

在我工作的几乎每个项目中，都会使用“This”运算符，当我开始开发时，我被告知这是一个好习惯。这真的有必要吗？它会给你更多的可读性吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-21T01:49:22.750

像 Resharper 这样的工具有一个内置提示说“冗余限定符”，但我不同意它并迅速禁用该规则。

我总是使用 this 限定符，因为它让我一眼就知道引用是属性/字段还是静态类引用，例如：

```
public class MyClass {
    public int Foo { get; set; }
}

public MyClass MyRef { get; } 
```

或者

```
public static class MyRef {
   public static int Foo { get; set; }
} 
```

所以：

```
void method() {
   MyRef.Foo = 4; // might be either
}

void method() {
   this.MyRef.Foo = 4; // definitely property/field
} 
```

只是我的2c。

-Oisin

# git - 如何将单个文件的版本从一个 Git 分支复制到另一个？

> ID：307579
> 
> 赞同：1173
> 
> 时间：2008-11-21T01:50:37.240
> 
> 标签：git, git-branch, branching-and-merging

我有两个完全合并在一起的分支。

但是，合并完成后，我意识到一个文件已被合并弄乱了（其他人做了自动格式化，gah），在另一个分支中更改为新版本会更容易，并且然后在将它带入我的分支后重新插入我的一行更改。

那么在 Git 中最简单的方法是什么？

* * *

## 回答 #1

> 赞同：1979
> 
> 时间：2008-11-21T04:31:21.363

从您希望文件结束的分支运行它：

```
git checkout otherbranch myfile.txt 
```

一般公式：

```
git checkout <commit_hash> <relative_path_to_file_or_dir>
git checkout <remote_name>/<branch_name> <file_or_dir> 
```

一些注释（来自评论）：

*   使用提交哈希，您可以从任何提交中提取文件
*   这适用于文件和目录
*   覆盖文件`myfile.txt`并`mydir`
*   通配符不起作用，但相对路径可以
*   可以指定多个路径

替代：

```
git show commit_id:path/to/file > path/to/file 
```

* * *

## 回答 #2

> 赞同：121
> 
> 时间：2020-03-25T18:52:53.250

我会使用[`git restore`](https://git-scm.com/docs/git-restore)（自 Git 2.23 起可用）：

`git restore --source otherbranch path/to/myfile.txt`

* * *

为什么比其他选择更好？

*   默认情况下`git restore`只修改工作目录中的文件。

`git checkout otherbranch -- path/to/myfile.txt`将文件复制到工作目录（磁盘上的文件），但也复制到暂存区。这与您手动复制此文件并`git add`在其上执行的效果相似。`git restore`默认情况下仅更改工作目录。

要获得与您相同的结果，`git checkout otherbranch -- path/to/myfile.txt`您可以编写`git restore --source otherbranch --staged --worktree path/to/myfile.txt`

*   默认情况下`git restore`，当其他分支中缺少文件时，从工作目录中删除文件

`git restore`可用于恢复整个文件夹`git restore --source otherbranch path/to/dir`。您可以执行类似的操作，`git checkout`但`git restore`默认情况下会删除`otherbranch`. 获取`git checkout`行为使用`--overlay`选项。

例如，如果文件`otherbranch`少于当前工作目录中的文件（并且这些文件被*跟踪*），则没有`--overlay`选项`git restore`将删除它们。但这是很好的默认行为，您很可能希望目录状态“与 in 相同`otherbranch`”，而不是“与 in 相同，`otherbranch`但带有我当前分支的其他文件”。

要获得与您相同的结果，`git checkout otherbranch -- path/to/dir`您可以编写`git restore --source otherbranch --staged --worktree --overlay path/to/dir`

*   `git restore`不使用 shell 重定向来创建文件（Powershell 唯一的问题）

`git show otherbranch:path/to/myfile.txt > path/to/myfile.txt`使用标准外壳重定向。如果您使用 PowerShell，那么文本编码可能会出现问题，或者如果它是[二进制](https://github.com/PowerShell/PowerShell/issues/1908)文件，您可能会得到损坏的文件。`git restore`更改文件全部由可执行`git`文件完成。

* * *

## 回答 #3

> 赞同：91
> 
> 时间：2011-08-17T20:38:03.420

我最终在类似的搜索中遇到了这个问题。就我而言，我希望将另一个分支中的文件提取到与文件原始位置不同的当前工作目录中。[答案](http://www.mail-archive.com/git-users@googlegroups.com/msg00256.html)：

```
git show TREEISH:path/to/file > path/to/local/file 
```

* * *

## 回答 #4

> 赞同：52
> 
> 时间：2010-03-06T14:30:51.000

使用*结帐*命令：

```
 git diff --stat "$branch"
  git checkout --merge "$branch" "$file"
  git diff --stat "$branch" 
```

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2017-06-29T08:47:44.953

1.  确保您在需要文件副本的分支中。

    例如：我想要master中的子分支文件，所以你需要checkout或者应该在master中`git checkout master`

2.  现在从 sub 分支中单独检查特定文件到*master*，

    ```
     git checkout sub_branch file_path/my_file.ext 
    ```

    这`sub_branch`意味着您拥有该文件的位置，后跟您需要复制的文件名。

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2015-06-06T21:29:37.257

按照[madlep 的回答](https://stackoverflow.com/questions/307579/how-do-i-copy-a-version-of-a-single-file-from-one-git-branch-to-another/307872#307872)，您也可以使用目录 blob 从另一个分支复制一个目录。

```
git checkout other-branch app/** 
```

至于 OP 的问题，如果您只更改了一个文件，这将正常工作。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2019-05-08T17:00:40.077

请注意，在接受的答案中，第一个选项从另一个分支**暂存**整个文件（就像`git add ...`已经执行过的一样），第二个选项只会导致复制文件，但不会暂存更改（就像你有只是手动编辑了文件并且有显着的差异）。

[Git 从另一个分支复制文件而不暂存它](https://stackoverflow.com/questions/56029523/git-copy-file-from-another-branch-without-staging-it)

**变更阶段**（例如`git add filename)`：

```
$ git checkout directory/somefile.php feature-B

$ git status
On branch feature-A
Your branch is up-to-date with 'origin/feature-A'.
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

        modified:   directory/somefile.php 
```

**未完成的更改**（未暂存或提交）：

```
$ git show feature-B:directory/somefile.php > directory/somefile.php

$ git status
On branch feature-A
Your branch is up-to-date with 'origin/feature-A'.
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

        modified:   directory/somefile.php

no changes added to commit (use "git add" and/or "git commit -a") 
```

# ruby-on-rails - 带有多个外键的 Rails 模型 has_many

> ID：307581
> 
> 赞同：51
> 
> 时间：2008-11-21T01:51:25.477
> 
> 标签：ruby-on-rails, ruby, model, has-many

Rails 相对较新，并尝试使用具有名称、性别、father_id 和 mother_id（2 个父母）的单个 Person 模型来建模一个非常简单的家庭“树”。下面基本上是我想做的，但显然我不能在 has_many 中重复 :children （第一个被覆盖）。

```
class Person < ActiveRecord::Base
  belongs_to :father, :class_name => 'Person'
  belongs_to :mother, :class_name => 'Person'
  has_many :children, :class_name => 'Person', :foreign_key => 'mother_id'
  has_many :children, :class_name => 'Person', :foreign_key => 'father_id'
end 
```

有没有一种简单的方法可以将 has_many 与 2 个外键一起使用，或者根据对象的性别更改外键？还是有另一种/更好的方法？

谢谢！

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-11-21T03:22:34.887

在 IRC 上找到了一个似乎有效的简单答案（感谢 Radar）：

```
class Person < ActiveRecord::Base
  belongs_to :father, :class_name => 'Person'
  belongs_to :mother, :class_name => 'Person'
  has_many :children_of_father, :class_name => 'Person', :foreign_key => 'father_id'
  has_many :children_of_mother, :class_name => 'Person', :foreign_key => 'mother_id'
  def children
     children_of_mother + children_of_father
  end
end 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2014-08-16T18:10:48.007

为了改进[Kenzie](https://stackoverflow.com/users/13636/kenzie)的答案，您可以通过如下定义来实现 ActiveRecord 关系`Person#children`：

```
def children
   children_of_mother.merge(children_of_father)
end 
```

有关更多详细信息，请参阅[此答案](https://stackoverflow.com/a/9540911)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-03-27T14:13:30.043

在 Person 模型上使用 named_scopes 执行以下操作：

```
class Person < ActiveRecord::Base

    def children
      Person.with_parent(id)
    end

    named_scope :with_parent, lambda{ |pid| 

       { :conditions=>["father_id = ? or mother_id=?", pid, pid]}
    }
 end 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-21T02:44:13.887

我相信您可以使用 :has_one 实现您想要的关系。

```
class Person < ActiveRecord::Base
  has_one :father, :class_name => 'Person', :foreign_key => 'father_id'
  has_one :mother, :class_name => 'Person', :foreign_key => 'mother_id'
  has_many :children, :class_name => 'Person'
end 
```

我会在下班后确认并编辑这个答案；)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-05-08T20:33:35.127

我更喜欢使用范围来解决这个问题。像这样：

```
class Person < ActiveRecord::Base
  belongs_to :father, :class_name => 'Person'
  belongs_to :mother, :class_name => 'Person'
  has_many :children_of_father, :class_name => 'Person', :foreign_key => 'father_id'
  has_many :children_of_mother, :class_name => 'Person', :foreign_key => 'mother_id'

  scope :children_for, lambda {|father_id, mother_id| where('father_id = ? AND mother_id = ?', father_id, mother_id) }
end 
```

这个技巧可以在没有使用实例的情况下轻松获取孩子：

```
Person.children_for father_id, mother_id 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-11-04T16:56:20.910

我对 Rails (3.2) 中的关联和（多个）外键的回答[：如何在模型中描述它们，并编写迁移](https://stackoverflow.com/a/40427001/5678119)只适合你！

至于你的代码，这是我的修改

```
class Person < ActiveRecord::Base
  belongs_to :father, :class_name => 'Person'
  belongs_to :mother, :class_name => 'Person'
  has_many :children, ->(person) { unscope(where: :person_id).where("father_id = ? OR mother_id = ?", person.id, person.id) }, class_name: 'Person'
end 
```

那么有什么问题吗？

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-12-12T09:07:02.587

不是对上述一般问题的解决方案（“具有多个外键的has_many”），但是，鉴于一个人可以是母亲或父亲，但不能同时是两者，我会添加一`gender`列并使用

```
 has_many :children_of_father, :class_name => 'Person', :foreign_key => 'father_id'
  has_many :children_of_mother, :class_name => 'Person', :foreign_key => 'mother_id'
  def children
    gender == "male" ? children_of_father : children_of_mother
  end 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2016-06-07T20:05:10.423

我一直在寻找相同的功能，如果您不想返回数组而是 a `ActiveRecord::AssociationRelation`，则可以使用`<<`而不是`+`. （[参见 ActiveRecord 文档](http://edgeapi.rubyonrails.org/classes/ActiveRecord/Associations/CollectionProxy.html#method-i-3C-3C)）

```
class Person < ActiveRecord::Base
  belongs_to :father, :class_name => 'Person'
  belongs_to :mother, :class_name => 'Person'

  has_many :children_of_father, :class_name => 'Person', :foreign_key => 'father_id'
  has_many :children_of_mother, :class_name => 'Person', :foreign_key => 'mother_id'

  def children
     children_of_mother << children_of_father
  end
end 
```

# c# - DateTime.Now 的更新频率如何？还是有更精确的 API 来获取当前时间？

> ID：307582
> 
> 赞同：29
> 
> 时间：2008-11-21T01:51:56.240
> 
> 标签：c#, .net, datetime, real-time

我有代码在循环中运行，它根据当前时间保存状态。有时这可能只是相隔几毫秒，但出于某种原因，DateTime.Now 似乎总是会返回至少相隔 10 毫秒的值，即使它只是在 2 或 3 毫秒之后。这提出了一个主要问题，因为我正在保存的状态取决于它被保存的时间（例如记录一些东西）

我的测试代码以 10 毫秒的间隔返回每个值：

```
public static void Main()
{
    var dt1 = DateTime.Now;
    System.Threading.Thread.Sleep(2);
    var dt2 = DateTime.Now;

    // On my machine the values will be at least 10 ms apart
    Console.WriteLine("First: {0}, Second: {1}", dt1.Millisecond, dt2.Millisecond);
} 
```

关于如何将当前时间精确到毫秒的另一种解决方案？

有人建议看一下秒表类。尽管 Stopwatch 类非常准确，但它并不能告诉我当前时间，这是我保存程序状态所需要的。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2011-02-10T21:23:50.900

奇怪的是，您的代码在我的 Win7 下的四核上运行得非常好，几乎每次都产生恰好相隔 2 毫秒的值。

所以我做了一个更彻底的测试。这是我的示例输出`Thread.Sleep(1)`。`DateTime.UtcNow`该代码在循环中打印连续调用之间的毫秒数：

![睡觉 1](https://i.stack.imgur.com/CH3tV.png)

每行包含 100 个字符，因此代表“干净运行”的 100 毫秒时间。所以这个屏幕大约覆盖了 2 秒。最长抢占4ms；此外，有一段时间持续大约 1 秒，而每次迭代恰好需要 1 毫秒。这几乎是实时的操作系统质量！¹ :)

所以我又试了一次，`Thread.Sleep(2)`这次：

![睡觉 2](https://i.stack.imgur.com/jP2FF.png)

再次，几乎完美的结果。这次每行有 200 毫秒长，并且有一个运行将近 3 秒的时间，其中的间隔只有 2 毫秒。

自然，接下来要看的是`DateTime.UtcNow`我机器上的实际分辨率。这是一次完全不睡觉的跑步；`.`如果`UtcNow`根本没有更改*，*则打印a ：

![不睡觉](https://i.stack.imgur.com/1KQFk.png)

最后，在产生上述结果的同一台机器上调查时间戳相差 15 毫秒的奇怪案例时，我遇到了以下奇怪的事件：

![在此处输入图像描述](https://i.stack.imgur.com/3Fui7.png) ![在此处输入图像描述](https://i.stack.imgur.com/RkaLZ.png)

Windows API 中有一个叫做 的函数[`timeBeginPeriod`](http://msdn.microsoft.com/en-gb/library/windows/desktop/dd757624%28v=vs.85%29.aspx)，应用程序可以使用它来临时增加定时器频率，所以这大概就是这里发生的事情。计时器分辨率的详细文档可通过[Hardware Dev Center Archive](http://msdn.microsoft.com/en-US/library/windows/hardware/dn550976)获得，特别是[Timer-Resolution.docx](http://download.microsoft.com/download/3/0/2/3027D574-C433-412A-A8B6-5E0A75D5B237/Timer-Resolution.docx)（一个 Word 文件）。

结论：

*   `DateTime.UtcNow` **可以**有比 15ms 高得多的分辨率
*   `Thread.Sleep(1)` **可以**睡正好 1ms
*   在我的机器上，`UtcNow`一次增长正好 1 毫秒（给出或取舍入误差 - 反射器显示 中有一个除法`UtcNow`）。
*   当一切都基于 15.6 毫秒时，该过程可以切换到低分辨率模式，以及动态切换到具有 1 毫秒切片的高分辨率模式。

这是代码：

```
static void Main(string[] args)
{
    Console.BufferWidth = Console.WindowWidth = 100;
    Console.WindowHeight = 20;
    long lastticks = 0;
    while (true)
    {
        long diff = DateTime.UtcNow.Ticks - lastticks;
        if (diff == 0)
            Console.Write(".");
        else
            switch (diff)
            {
                case 10000: case 10001: case 10002: Console.ForegroundColor=ConsoleColor.Red; Console.Write("1"); break;
                case 20000: case 20001: case 20002: Console.ForegroundColor=ConsoleColor.Green; Console.Write("2"); break;
                case 30000: case 30001: case 30002: Console.ForegroundColor=ConsoleColor.Yellow; Console.Write("3"); break;
                default: Console.Write("[{0:0.###}]", diff / 10000.0); break;
            }
        Console.ForegroundColor = ConsoleColor.Gray;
        lastticks += diff;
    }
} 
```

事实证明，存在一个可以改变计时器分辨率的未记录函数。我没有调查细节，但我想我会在这里发布一个链接：[`NtSetTimerResolution`](http://undocumented.ntinternals.net/UserMode/Undocumented%20Functions/Time/NtSetTimerResolution.html).

¹[当然，我特别确定操作系统尽可能空闲，并且有四个相当强大的 CPU 内核可供使用。如果我将所有四个内核都加载到 100%，那么情况就会完全改变，到处都是长时间的抢占。]

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-21T02:22:32.433

DateTime 在处理毫秒时的问题根本不是由于 DateTime 类，而是与 CPU 滴答和线程片有关。本质上，当调度程序暂停操作以允许其他线程执行时，它必须至少等待 1 个时间片才能恢复，这在现代 Windows 操作系统上约为 15 毫秒。因此，任何小于 15 毫秒精度的暂停尝试都会导致意外结果。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T01:58:43.450

如果您在执行任何操作之前对当前时间进行快照，您可以将秒表添加到您存储的时间，不是吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T01:59:49.780

你应该问自己是否真的需要准确的时间，或者只是足够接近的时间加上一个递增的整数。

您可以通过在诸如互斥锁、选择、轮询、WaitFor* 等等待事件之后获取 now() 来做好事，然后在其中添加一个序列号，可能在纳秒范围内或任何有空间的地方。

您还可以使用 rdtsc 机器指令（一些库为此提供 API 包装器，不确定在 C# 或 Java 中执行此操作）从 CPU 获得便​​宜的时间并将其与 time from now() 结合起来。rdtsc 的问题在于，在具有速度扩展的系统上，您永远无法确定它会做什么。它也很快环绕。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-03-05T00:41:47.033

我用来 100% 准确完成这项任务的只是一个计时器控件和一个标签。

代码不需要太多解释，相当简单。全局变量：

```
int timer = 0; 
```

这是滴答事件：

```
private void timeOfDay_Tick(object sender, EventArgs e)
    {

        timeOfDay.Enabled = false;
        timer++;

        if (timer <= 1)
        {
            timeOfDay.Interval = 1000;
            timeOfDay.Enabled = true;             
            lblTime.Text = "Time: " + DateTime.Now.ToString("h:mm:ss tt");                  
            timer = 0;
        }

} 
```

这是表单加载：

```
private void DriverAssignment_Load(object sender, EventArgs e)
    {

        timeOfDay.Interval= 1;
        timeOfDay.Enabled = true;

} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-02-05T13:57:00.097

在回答您关于更精确 API 的问题的第二部分时，AnotherUser 的[评论](https://msdn.microsoft.com/en-us/library/hh706895(v=vs.85).aspx)将我引向此解决方案，该解决方案在我的场景中克服了 DateTime.Now 精度问题：

```
static FileTime time;        

public static DateTime Now()
{
    GetSystemTimePreciseAsFileTime(out time);
    var newTime = (ulong)time.dwHighDateTime << (8 * 4) | time.dwLowDateTime;
    var newTimeSigned = Convert.ToInt64(newTime);
    return new DateTime(newTimeSigned).AddYears(1600).ToLocalTime();
}        

public struct FileTime
{
    public uint dwLowDateTime;
    public uint dwHighDateTime;
}

[DllImport("Kernel32.dll")]
public static extern void GetSystemTimePreciseAsFileTime(out FileTime lpSystemTimeAsFileTime); 
```

在我自己的基准测试中，迭代 1M，它平均返回 3 个滴答声，而 DateTime.Now 为 2 个滴答声。

为什么 1600 不在我的管辖范围内，但我用它来获取正确的年份。

编辑：这仍然是win10的问题。任何有兴趣的人都可以证明这一点：

```
void Main()
{
   for (int i = 0; i < 100; i++)
   {        
       Console.WriteLine(Now().ToString("yyyy-MM-dd HH:mm:ss.fffffff"));
       Console.WriteLine(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss.fffffff"));
       Console.WriteLine();
   }    
}
// include the code above 
```

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2008-11-21T01:57:50.363

您可以使用 DateTime.Now.Ticks，阅读[MSDN上的文章](http://msdn.microsoft.com/en-us/library/system.datetime.ticks.aspx)

> “一个滴答声代表一百纳秒或百万分之一秒。”

# c++ - C++中的时差

> ID：307596
> 
> 赞同：34
> 
> 时间：2008-11-21T01:59:34.197
> 
> 标签：c++, time

有谁知道如何以毫秒为单位计算 C++ 中的时间差？我用过[`difftime`](http://linux.die.net/man/3/difftime)，但它对我要测量的东西没有足够的精度。

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2011-02-11T22:09:22.350

我知道这是一个老问题，但是 C++0x 有一个更新的答案。有一个名为的新标头`<chrono>`，其中包含现代实用程序。示例使用：

```
#include <iostream>
#include <thread>
#include <chrono>

int main()
{
    typedef std::chrono::high_resolution_clock Clock;
    typedef std::chrono::milliseconds milliseconds;
    Clock::time_point t0 = Clock::now();
    std::this_thread::sleep_for(milliseconds(50));
    Clock::time_point t1 = Clock::now();
    milliseconds ms = std::chrono::duration_cast<milliseconds>(t1 - t0);
    std::cout << ms.count() << "ms\n";
}

50ms 
```

更多信息可以在这里找到：

[http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2661.htm](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2661.htm)

现在还有`<chrono>`.

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-11-21T02:04:46.370

您必须使用更具体的时间结构之一，timeval（微秒分辨率）或 timespec（纳秒分辨率），但您可以相当容易地手动完成：

```
#include <time.h>

int diff_ms(timeval t1, timeval t2)
{
    return (((t1.tv_sec - t2.tv_sec) * 1000000) + 
            (t1.tv_usec - t2.tv_usec))/1000;
} 
```

如果时间差非常大（或者如果您有 16 位整数），这显然会出现整数溢出问题，但这可能不是常见的情况。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-22T23:53:11.487

如果您使用的是 win32 FILETIME 是您可以获得的最准确的：包含一个 64 位值，表示自 1601 年 1 月 1 日 (UTC) 以来 100 纳秒间隔的数量。

因此，如果您想以毫秒为单位计算两次之间的差异，请执行以下操作：

```
UINT64 getTime()
{
    SYSTEMTIME st;
    GetSystemTime(&st);

    FILETIME ft;
    SystemTimeToFileTime(&st, &ft);  // converts to file time format
    ULARGE_INTEGER ui;
    ui.LowPart=ft.dwLowDateTime;
    ui.HighPart=ft.dwHighDateTime;

    return ui.QuadPart;
}

int _tmain(int argc, TCHAR* argv[], TCHAR* envp[])
{
    //! Start counting time
    UINT64   start, finish;

    start=getTime();

    //do something...

    //! Stop counting elapsed time
    finish = getTime();

    //now you can calculate the difference any way that you want
    //in seconds:
    _tprintf(_T("Time elapsed executing this code: %.03f seconds."), (((float)(finish-start))/((float)10000))/1000 );
    //or in miliseconds
    _tprintf(_T("Time elapsed executing this code: %I64d seconds."), (finish-start)/10000 );
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-21T02:05:28.740

时钟功能为您提供了一个毫秒计时器，但它不是最好的。它的真正分辨率将取决于您的系统。你可以试试

```
#include <time.h>

int clo = clock();
//do stuff
cout << (clock() - clo) << endl; 
```

看看你的结果如何。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-21T02:03:19.417

您可以使用它[`gettimeofday`](http://www.manpagez.com/man/2/gettimeofday/)来获取自纪元以来的微秒数。gettimeofday() 返回的值的秒段与 time() 返回的值相同，可以强制转换为 time_t 并在 difftime 中使用。一毫秒是 1000 微秒。

使用 difftime 后，自己计算微秒字段中的差异。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-21T02:52:23.467

[您可以从Boost.Date_Time](http://www.boost.org/doc/libs/1_37_0/doc/html/date_time/posix_time.html#date_time.posix_time.time_duration)获得微秒和纳秒的精度。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-21T02:27:10.803

如果您正在寻找进行基准测试，您可能希望在 SO 上查看讨论该主题的[其他一些](https://stackoverflow.com/questions/305615/timers-to-measure-latency) [线程。](https://stackoverflow.com/questions/275004/c-timer-function-to-provide-time-in-nano-seconds)

此外，请确保您了解准确度和精度之间的区别。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-21T02:44:17.243

我认为您将不得不使用特定于平台的东西。希望没关系？例如。在 Windows 上，看看`QueryPerformanceCounter()`哪个会给你比毫秒更好的东西。

# c++ - 异常如何在 C++ 中工作（在幕后）

> ID：307610
> 
> 赞同：126
> 
> 时间：2008-11-21T02:06:03.433
> 
> 标签：c++, performance, exception, throw, try-catch

我一直看到人们说异常很慢，但我从来没有看到任何证据。因此，我不会问是否存在，而是会问异常在幕后是如何工作的，这样我就可以决定何时使用它们以及它们是否很慢。

据我所知，异常与多次返回相同，只是它还会在每次返回后检查是否需要再进行一次或停止。它如何检查何时停止返回？我猜有第二个堆栈保存异常的类型和堆栈位置，然后它会返回直到它到达那里。我还猜测第二个堆栈被触摸的唯一一次是在一次投掷和每次尝试/接球时。AFAICT 使用返回码实现类似行为将花费相同的时间。但这只是猜测，所以我想知道到底发生了什么。

异常如何真正起作用？

* * *

## 回答 #1

> 赞同：115
> 
> 时间：2008-11-21T03:16:53.590

我没有猜测，而是决定用一小段 C++ 代码和一个有点旧的 Linux 安装来实际查看生成的代码。

```
class MyException
{
public:
    MyException() { }
    ~MyException() { }
};

void my_throwing_function(bool throwit)
{
    if (throwit)
        throw MyException();
}

void another_function();
void log(unsigned count);

void my_catching_function()
{
    log(0);
    try
    {
        log(1);
        another_function();
        log(2);
    }
    catch (const MyException& e)
    {
        log(3);
    }
    log(4);
} 
```

我用 编译它`g++ -m32 -W -Wall -O3 -save-temps -c`，并查看生成的程序集文件。

```
 .file   "foo.cpp"
    .section    .text._ZN11MyExceptionD1Ev,"axG",@progbits,_ZN11MyExceptionD1Ev,comdat
    .align 2
    .p2align 4,,15
    .weak   _ZN11MyExceptionD1Ev
    .type   _ZN11MyExceptionD1Ev, @function
_ZN11MyExceptionD1Ev:
.LFB7:
    pushl   %ebp
.LCFI0:
    movl    %esp, %ebp
.LCFI1:
    popl    %ebp
    ret
.LFE7:
    .size   _ZN11MyExceptionD1Ev, .-_ZN11MyExceptionD1Ev 
```

`_ZN11MyExceptionD1Ev`是`MyException::~MyException()`，所以编译器决定它需要析构函数的非内联副本。

```
.globl __gxx_personality_v0
.globl _Unwind_Resume
    .text
    .align 2
    .p2align 4,,15
.globl _Z20my_catching_functionv
    .type   _Z20my_catching_functionv, @function
_Z20my_catching_functionv:
.LFB9:
    pushl   %ebp
.LCFI2:
    movl    %esp, %ebp
.LCFI3:
    pushl   %ebx
.LCFI4:
    subl    $20, %esp
.LCFI5:
    movl    $0, (%esp)
.LEHB0:
    call    _Z3logj
.LEHE0:
    movl    $1, (%esp)
.LEHB1:
    call    _Z3logj
    call    _Z16another_functionv
    movl    $2, (%esp)
    call    _Z3logj
.LEHE1:
.L5:
    movl    $4, (%esp)
.LEHB2:
    call    _Z3logj
    addl    $20, %esp
    popl    %ebx
    popl    %ebp
    ret
.L12:
    subl    $1, %edx
    movl    %eax, %ebx
    je  .L16
.L14:
    movl    %ebx, (%esp)
    call    _Unwind_Resume
.LEHE2:
.L16:
.L6:
    movl    %eax, (%esp)
    call    __cxa_begin_catch
    movl    $3, (%esp)
.LEHB3:
    call    _Z3logj
.LEHE3:
    call    __cxa_end_catch
    .p2align 4,,3
    jmp .L5
.L11:
.L8:
    movl    %eax, %ebx
    .p2align 4,,6
    call    __cxa_end_catch
    .p2align 4,,6
    jmp .L14
.LFE9:
    .size   _Z20my_catching_functionv, .-_Z20my_catching_functionv
    .section    .gcc_except_table,"a",@progbits
    .align 4
.LLSDA9:
    .byte   0xff
    .byte   0x0
    .uleb128 .LLSDATT9-.LLSDATTD9
.LLSDATTD9:
    .byte   0x1
    .uleb128 .LLSDACSE9-.LLSDACSB9
.LLSDACSB9:
    .uleb128 .LEHB0-.LFB9
    .uleb128 .LEHE0-.LEHB0
    .uleb128 0x0
    .uleb128 0x0
    .uleb128 .LEHB1-.LFB9
    .uleb128 .LEHE1-.LEHB1
    .uleb128 .L12-.LFB9
    .uleb128 0x1
    .uleb128 .LEHB2-.LFB9
    .uleb128 .LEHE2-.LEHB2
    .uleb128 0x0
    .uleb128 0x0
    .uleb128 .LEHB3-.LFB9
    .uleb128 .LEHE3-.LEHB3
    .uleb128 .L11-.LFB9
    .uleb128 0x0
.LLSDACSE9:
    .byte   0x1
    .byte   0x0
    .align 4
    .long   _ZTI11MyException
.LLSDATT9: 
```

惊喜！正常的代码路径上根本没有额外的指令。相反，编译器生成了额外的离线修复代码块，通过函数末尾的表引用（实际上放在可执行文件的单独部分中）。`_ZTI11MyException`所有工作都由标准库在这些表 ( is )的基础上在幕后完成`typeinfo for MyException`。

好的，这对我来说并不意外，我已经知道这个编译器是如何做到的。继续汇编输出：

```
 .text
    .align 2
    .p2align 4,,15
.globl _Z20my_throwing_functionb
    .type   _Z20my_throwing_functionb, @function
_Z20my_throwing_functionb:
.LFB8:
    pushl   %ebp
.LCFI6:
    movl    %esp, %ebp
.LCFI7:
    subl    $24, %esp
.LCFI8:
    cmpb    $0, 8(%ebp)
    jne .L21
    leave
    ret
.L21:
    movl    $1, (%esp)
    call    __cxa_allocate_exception
    movl    $_ZN11MyExceptionD1Ev, 8(%esp)
    movl    $_ZTI11MyException, 4(%esp)
    movl    %eax, (%esp)
    call    __cxa_throw
.LFE8:
    .size   _Z20my_throwing_functionb, .-_Z20my_throwing_functionb 
```

在这里，我们看到了引发异常的代码。虽然仅仅因为可能会抛出异常而没有额外的开销，但在实际抛出和捕获异常时显然有很多开销。其中大部分都隐藏在 中`__cxa_throw`，它必须：

*   在异常表的帮助下遍历堆栈，直到找到该异常的处理程序。
*   展开堆栈，直到它到达该处理程序。
*   实际上调用处理程序。

将其与简单地返回一个值的成本进行比较，您就会明白为什么异常应该只用于异常返回。

最后，汇编文件的其余部分：

```
 .weak   _ZTI11MyException
    .section    .rodata._ZTI11MyException,"aG",@progbits,_ZTI11MyException,comdat
    .align 4
    .type   _ZTI11MyException, @object
    .size   _ZTI11MyException, 8
_ZTI11MyException:
    .long   _ZTVN10__cxxabiv117__class_type_infoE+8
    .long   _ZTS11MyException
    .weak   _ZTS11MyException
    .section    .rodata._ZTS11MyException,"aG",@progbits,_ZTS11MyException,comdat
    .type   _ZTS11MyException, @object
    .size   _ZTS11MyException, 14
_ZTS11MyException:
    .string "11MyException" 
```

类型信息数据。

```
 .section    .eh_frame,"a",@progbits
.Lframe1:
    .long   .LECIE1-.LSCIE1
.LSCIE1:
    .long   0x0
    .byte   0x1
    .string "zPL"
    .uleb128 0x1
    .sleb128 -4
    .byte   0x8
    .uleb128 0x6
    .byte   0x0
    .long   __gxx_personality_v0
    .byte   0x0
    .byte   0xc
    .uleb128 0x4
    .uleb128 0x4
    .byte   0x88
    .uleb128 0x1
    .align 4
.LECIE1:
.LSFDE3:
    .long   .LEFDE3-.LASFDE3
.LASFDE3:
    .long   .LASFDE3-.Lframe1
    .long   .LFB9
    .long   .LFE9-.LFB9
    .uleb128 0x4
    .long   .LLSDA9
    .byte   0x4
    .long   .LCFI2-.LFB9
    .byte   0xe
    .uleb128 0x8
    .byte   0x85
    .uleb128 0x2
    .byte   0x4
    .long   .LCFI3-.LCFI2
    .byte   0xd
    .uleb128 0x5
    .byte   0x4
    .long   .LCFI5-.LCFI3
    .byte   0x83
    .uleb128 0x3
    .align 4
.LEFDE3:
.LSFDE5:
    .long   .LEFDE5-.LASFDE5
.LASFDE5:
    .long   .LASFDE5-.Lframe1
    .long   .LFB8
    .long   .LFE8-.LFB8
    .uleb128 0x4
    .long   0x0
    .byte   0x4
    .long   .LCFI6-.LFB8
    .byte   0xe
    .uleb128 0x8
    .byte   0x85
    .uleb128 0x2
    .byte   0x4
    .long   .LCFI7-.LCFI6
    .byte   0xd
    .uleb128 0x5
    .align 4
.LEFDE5:
    .ident  "GCC: (GNU) 4.1.2 (Ubuntu 4.1.2-0ubuntu4)"
    .section    .note.GNU-stack,"",@progbits 
```

更多异常处理表，以及各种额外信息。

因此，至少对于 Linux 上的 GCC 来说，结论是：无论是否抛出异常，成本都是额外的空间（用于处理程序和表），加上在抛出异常时解析表和执行处理程序的额外成本。如果您使用异常而不是错误代码，并且错误很少见，则可以*更快*，因为您不再需要测试错误的开销。

如果您想了解更多信息，特别是所有`__cxa_`功能的作用，请参阅它们来自的原始规范：

*   [安腾 C++ ABI](http://www.codesourcery.com/public/cxx-abi/)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-21T03:21:44.890

在过去，异常缓慢**是**真的。
在大多数现代编译器中，这不再适用。

注意：仅仅因为我们有异常并不意味着我们也不使用错误代码。当错误可以在本地处理时使用错误代码。当错误需要更多上下文来纠正使用异常时：我在这里写得更有说服力：[指导您的异常处理策略的原则是什么？](https://stackoverflow.com/questions/106586/what-are-the-principles-guiding-your-exception-handling-policy#106749)

当没有使用异常时，异常处理代码的成本几乎为零。

当抛出异常时，会完成一些工作。
但是您必须将此与返回错误代码的成本进行比较，并一直检查它们以回到可以处理错误的位置。编写和维护都更耗时。

新手也有一个问题：
尽管 Exception 对象应该很小，但有些人在里面放了很多东西。然后你有复制异常对象的成本。解决方案有两个：

*   不要在你的异常中添加额外的东西。
*   通过 const 引用捕获。

在我看来，我敢打赌，带有异常的相同代码要么更有效，要么至少与没有异常的代码相当（但有所有额外的代码来检查函数错误结果）。请记住，您并没有免费获得任何东西，编译器正在生成您应该首先编写的代码来检查错误代码（通常编译器比人类更有效率）。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-21T02:13:07.540

您可以通过多种方式实现异常，但通常它们将依赖于操作系统的一些底层支持。在 Windows 上，这是结构化的异常处理机制。

对 Code Project 的详细信息进行了不错的讨论：[C++ 编译器如何实现异常处理](http://www.codeproject.com/KB/cpp/exceptionhandler.aspx)

发生异常的开销是因为编译器必须生成代码来跟踪如果异常传播到该范围之外，则必须在每个堆栈帧（或更准确地说是范围）中销毁哪些对象。如果一个函数在堆栈上没有需要调用析构函数的局部变量，那么它不应该有异常处理的性能损失。

使用返回码一次只能展开一层堆栈，而如果在中间堆栈帧中没有任何事情可做，则异常处理机制可以在一次操作中向下跳回堆栈的更远。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-21T02:17:27.640

Matt Pietrek 写了一篇关于[Win32 结构化异常处理](https://web.archive.org/web/20081210154057/http://www.microsoft.com/msj/0197/exception/exception.aspx)的优秀文章。虽然这篇文章最初写于 1997 年，但它仍然适用于今天（但当然只适用于 Windows）。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-21T02:23:26.473

[本文](http://www.gamearchitect.net/Articles/ExceptionsAndErrorCodes.html)研究了这个问题，基本上发现在实践中异常存在运行时成本，尽管如果不抛出异常，成本相当低。好文章，推荐。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-21T02:18:26.170

几年前，我的一个朋友写了一点 Visual C++ 如何处理异常。

[http://www.xyzw.de/c160.html](http://www.xyzw.de/c160.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-21T02:23:05.773

所有好的答案。

此外，请考虑调试将“if 检查”作为方法顶部的门而不是允许代码抛出异常的代码是多么容易。

我的座右铭是编写有效的代码很容易。最重要的是为下一个查看它的人编写代码。在某些情况下，9 个月后就是你了，你不想诅咒你的名字！

# java - 从 XML 模式 (xsd) 生成 XML 实例

> ID：307616
> 
> 赞同：14
> 
> 时间：2008-11-21T02:11:17.590
> 
> 标签：java, python, xml, xsd

我想知道是否有一种方法可以自动从 XSD 模式生成 XML 文件，因为我有数据和标签。我想在 python/java 中执行此操作。这似乎很有可能，但我找不到任何允许我这样做的库。我正在寻找一个相当快速的解决方案..有什么想法吗？

> 另请参阅：[how-to-generate-sample-xml-documents-from-their-dtd-or-xsd](https://stackoverflow.com/questions/17106/how-to-generate-sample-xml-documents-from-their-dtd-or-xsd/730208#730208)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-21T02:26:01.647

查看[pyXSD](http://pyxsd.org/)以了解类似于 JAXB 的 Python 工具。

XSD 用于创建 Python 类。Python 对象用于发出 XML。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-03T15:59:06.083

Microsoft 已发布“文档生成器”工具作为示例。 [这是一篇](http://msdn.microsoft.com/en-us/library/aa302296.aspx)详细描述示例应用程序的架构和操作的文章。

如果您只想使用文档生成工具，[请单击此处](http://download.microsoft.com/download/0/A/2/0A2B9B6C-33B8-4B9D-BE0B-077F5CF46820/XmlSampleGenerator.msi)并安装 MSI。它不需要编程。

免费。源是可用的。需要 .NET Framework 才能运行。仅适用于 XSD。（不是放松 NG 或 DTD）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T18:30:15.790

我推荐两种方法：

1.  [Xstream](http://xstream.codehaus.org/) - 它让您通过定义 Java 文件并在项目上放置 Java 注释或仅定义别名来生成 XML 文件。这很容易，但不是全自动的；

2.  [XMLBeans](http://xmlbeans.apache.org/) - 这些工具让您可以从 XML 模式定义 (xsd) 生成 Java 文件，以便您可以使用类似 JavaBeans 的方法调用来导入、操作、创建和导出 XML 文件。

问候，路易斯

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T02:15:42.557

[JAXB](http://java.sun.com/developer/technicalArticles/WebServices/jaxb/)非常适合从 xsd 生成类。

[Ibatis](http://en.wikipedia.org/wiki/IBATIS)非常适合将数据放入类中。

您可以使用 Ibatis 提供数据并自动创建类，然后使用 JAXB 将类编组为 XML 文件！请注意，如果您不打算一遍又一遍地这样做，那将是一个很大的努力。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-01T08:12:23.870

为此，我使用 Exchanger XML Editor。您可以在以下网址免费下载多个操作系统：[http ://www.exchangerxml.com/](http://www.exchangerxml.com/)

该选项位于菜单“架构”->“架构实例生成”中。

# .net - .NET (web) 处理完所有事件后如何执行一些代码？

> ID：307618
> 
> 赞同：2
> 
> 时间：2008-11-21T02:11:41.583
> 
> 标签：.net, asp.net

我有这个在 Page_Load 中绘制表格的 .NET Web 应用程序。

然后，它处理事件，这应该改变在 Page_Load 中绘制的表格。这是非常低效的。

有没有办法在处理完所有事件后执行代码（绘制表格）？（而不是在 Page_Load 中进行）

先感谢您。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-21T02:35:58.383

您需要处理在控件事件之后但在呈现页面之前发生的事件，例如[LoadComplete](http://msdn.microsoft.com/en-us/library/system.web.ui.page.loadcomplete.aspx)或[PreRender](http://msdn.microsoft.com/en-us/library/system.web.ui.control.prerender.aspx)。

查看[ASP.NET 页面生命周期概述](http://msdn.microsoft.com/en-us/library/ms178472.aspx)了解更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T02:12:55.840

查看页面生命周期中的 OnPreRender 事件。

-Oisin

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T02:36:25.947

您还可以将代码放入间隔为 1 的 Timer 滴答事件中，该事件将在所有事件之后触发。

# c# - JSON - 斜杠和应用程序类型..重构

> ID：307619
> 
> 赞同：0
> 
> 时间：2008-11-21T02:12:07.197
> 
> 标签：c#, php, json, refactoring

我的代码有效（是的！）将 json 发送到服务器。如果有任何关于重构的想法，我将不胜感激

1) 我的 C# 代码将此 json 发送到服务器

{\"firstName\":\"Bill\",\"lastName\":\"Gates\",\"email\":\"asdf@hotmail.com\",\"deviceUUID\":\"abcdefghijklmnopqrstuvwxyz \"}

我必须摆脱服务器端的斜线......不好。

2）我正在使用 application/x-www-form-urlencoded 并且可能想要使用 application/json

```
Person p = new Person();
            p.firstName = "Bill";
            p.lastName = "Gates";
            p.email = "asdf@hotmail.com";
            p.deviceUUID = "abcdefghijklmnopqrstuvwxyz";

            HttpWebRequest request = (HttpWebRequest)WebRequest.Create(targetUri + "newuser.php");
            request.Method = "POST";
            request.ContentType = "application/x-www-form-urlencoded";
            //TODO request.ContentType = "application/json";

            JavaScriptSerializer serializer = new JavaScriptSerializer();
            string s = serializer.Serialize(p);
            textBox3.Text = s;

            string postData = "json=" + HttpUtility.UrlEncode(s);

            byte[] byteArray = Encoding.ASCII.GetBytes(postData);

            request.ContentLength = byteArray.Length;
            Stream dataStream = request.GetRequestStream();
            dataStream.Write(byteArray, 0, byteArray.Length);
            dataStream.Close ();

            WebResponse response = request.GetResponse();
            //textBox4.Text = (((HttpWebResponse)response).StatusDescription);
            dataStream = response.GetResponseStream ();

            StreamReader reader = new StreamReader(dataStream);
            string responseFromServer = reader.ReadToEnd ();
            textBox4.Text += responseFromServer;

            reader.Close ();
            dataStream.Close ();
            response.Close (); 
```

服务器上的 PHP 代码：

```
$inbound = $_POST['json'];

// this strips out the \
$stripped = stripslashes($inbound);

$json_object = json_decode($stripped);
echo $json_object->{'firstName'};
echo $json_object->{'lastName'};
echo $json_object->{'email'};
echo $json_object->{'deviceUUID'}; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T02:37:46.630

你确定你有那些斜线吗？这是 C# 对字符串进行编码以供显示的调试器视图，但来自 JavaScriptSerializer 的实际值在标识符中没有任何斜杠。唯一被转义的是 JSON 值内容......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T03:16:40.000

我发现这很容易使用： http: [//james.newtonking.com/archive/2008/02/11/linq-to-json-beta.aspx](http://james.newtonking.com/archive/2008/02/11/linq-to-json-beta.aspx)和[http://james.newtonking.com/projects/json-net .aspx](http://james.newtonking.com/projects/json-net.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T02:56:49.043

好主意...我已经检查了 VS 并在 textBox3.Text = s; 上设置断点时 然后将鼠标悬停在上一行 s 上。它显示了这一点：

s = "{\"firstName\":\"Bill\",\"lastName\":\"Gates\",\"email\":\"asdf@hotmail.com\",\"deviceUUID\": \"abcdefghijklmnopqrstuvwxyz\"}"

所以，我也检查了 PHP 方面：

```
$inbound = $_POST['json'];
var_dump($inbound); 
```

> string(124) "{\"firstName\":\"Bill\",\"lastName\":\"Gates\",\"email\":\"asdf@hotmail.com\",\"deviceUUID\ ":\"abcdefghijklmnopqrstuvwxyz\"}"

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T03:27:33.707

JSON.NET 非常棒，值得一试——它比 JavaScriptSerializer 做得更好，但我知道 JavaScriptSerializer（和任何其他 JSON 序列化器）不会输出带有斜杠的标识符。这将是无效的 JSON。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T04:36:30.027

知道了

有2个问题：

PHP 服务器正在转义传入的数据，所以我不得不使用stripslashes。

[http://nz.php.net/magic_quotes](http://nz.php.net/magic_quotes)

同样悬停在 VS 中的属性上显示斜线，但

```
Debug.Write(s); 
```

显示：

```
[{
  "categoryid": "1",
  "name": "funny",
  "serverimageid": "1",
  "dateuploaded": "2008-11-17 16:16:41",
  "enabled": "\u0001"
}, {
  "categoryid": "2",
  "name": "happy",
  "serverimageid": "2",
  "dateuploaded": "2008-11-17 16:17:00",
  "enabled": "\u0001"
}, {
  "categoryid": "3",
  "name": "sad",
  "serverimageid": "3",
  "dateuploaded": "2008-11-16 16:17:13",
  "enabled": "\u0001"
}] 
```

谢谢大家。

# php - RSS 提要中的 utf-8 和 htmlentities

> ID：307623
> 
> 赞同：10
> 
> 时间：2008-11-21T02:15:41.433
> 
> 标签：php, utf-8, rss

我正在用 PHP 编写一些 RSS 提要并遇到字符编码问题。我应该在 htmlentities() 编码之前还是之后使用 utf8_encode()？例如，我在描述元素中同时包含 & 和中文字符，我不确定哪些是正确的：

```
$output = utf8_encode(htmlentities($source)); or
$output = htmlentities(utf8_encode($source)); 
```

为什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-21T02:28:48.537

将字符集传递给 htmlentities 函数很重要，因为默认值为 ISO-8859-1：

```
utf8_encode(htmlentities($source,ENT_COMPAT,'utf-8')); 
```

您应该首先应用 htmlentities 以允许 utf8_encode 正确编码实体。

（编辑：我改变了我之前的观点，根据评论顺序并不重要。这段代码已经过测试并且运行良好）。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-01-26T09:58:09.697

首先：该[`utf8_encode`函数](http://docs.php.net/utf8_encode)将 ISO 8859-1 转换为 UTF-8。所以你只需要这个函数，如果你的输入编码/字符集是 ISO 8859-1。但是你为什么不首先使用 UTF-8 呢？

第二：你不需要[`htmlentities`](http://docs.php.net/htmlentities)。您只需要[`htmlspecialchars`](http://docs.php.net/htmlspecialchars)通过字符引用替换特殊字符。`htmlentities`将替换可以直接使用 UTF-8 编码的“太多”字符。重要的是您也使用`ENT_QUOTES`引号样式来替换单引号。

所以我的建议：

```
// if your input encoding is ISO 8859-1
htmlspecialchars(utf8_encode($string), ENT_QUOTES)

// if your input encoding is UTF-8
htmlspecialchars($string, ENT_QUOTES, 'UTF-8') 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-26T21:39:27.807

不要使用`htmlentities()`！

只需使用 UTF-8 字符。只需确保在 HTTP 标头 ( `Content-Type:application/xml;charset=UTF-8`) 中声明提要的编码，否则在提要本身中使用`<?xml version="1.0" encoding="UTF-8"?>`第一行。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-26T07:21:31.977

忘记 htmlentities 并使用 CDATA 部分可能更容易。它适用于标题部分，它似乎不支持 Firefox 的 RSS 查看器中的编码 HTML 字符：

```
<title><![CDATA[News & Updates  " > » ☂ ☺ ☹ ☃  Test!]]></title> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T02:20:25.107

你想做的`$output = htmlentities(utf8_encode($source));`。这是因为您希望首先将您的国际字符转换为正确的 UTF8，然后将与号（可能还有一些 UTF-8 字符）转换为 HTML 实体。如果你先做实体，那么一些国际字符可能无法正确处理。

如果您的任何国际字符都不会被 utf8_encode 更改，那么您调用它们的顺序无关紧要。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-23T00:14:24.537

经过反复试验，我终于找到了一种方法，可以通过 xml 文件将字符串从 utf8 编码的数据库值正确显示到 html 页面：

```
$output = '<![CDATA['.utf8_encode(htmlentities($string)).']]>'; 
```

我希望这可以帮助别人。

# sql - 如何在 SQL 2000/2005 上设置与 Oracle 数据库的链接服务器？

> ID：307636
> 
> 赞同：21
> 
> 时间：2008-11-21T02:24:51.697
> 
> 标签：sql, sql-server, oracle

我能够创建并执行一个 DTS 包，将表从远程 Oracle 数据库复制到本地 SQL 服务器，但希望将与 Oracle 数据库的连接设置为链接服务器。

DTS 包当前使用具有以下属性的*Microsoft OLE DB Provider for Oracle ：*

*   数据源：`SERVER=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=10.1.3.42)(PORT=1521))(CONNECT_DATA=(SERVICE_NAME=acc)));uid=*UserName*;pwd=*UserPassword*;`
*   密码：用户*密码*
*   用户 ID：*用户名*
*   允许保存密码：true

如何使用上面定义的数据源将链接服务器设置为 Oracle 数据库？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-11-25T21:53:24.037

我能够将链接服务器设置到远程 Oracle 数据库，这最终是一个多步骤过程：

1.  在 SQL Server 上安装 Oracle ODBC 驱动程序。
2.  在 SQL Server 上为 Oracle 数据库创建系统 DSN。
3.  使用系统 DSN 在 SQL 服务器上创建链接服务器。

**步骤 1：在服务器上安装 Oracle ODBC 驱动程序**

一种。下载必要的[Oracle Instant Client](http://www.oracle.com/technology/software/tech/oci/instantclient/htdocs/winsoft.html)软件包：Basic、ODBC 和 SQL*Plus（可选）

湾。将包解压缩到 SQL 服务器上的本地目录，通常是`C:\Oracle`. 这应该会产生一个 [directory] ​​like `C:\Oracle\instantclient_10_2`，这将是本答案其余部分中引用的 [directory] ​​的值。

C。**`tnsnames.ora`**在包含以下内容的即时客户端 [目录] 中创建一个名为的文本文件：

```
OracleTnsName = 
(
  DESCRIPTION=
  (
    ADDRESS = (PROTOCOL=TCP)(HOST=10.1.3.42)(PORT=1521)
  )
  (
    CONNECT_DATA = (SERVICE_NAME=acc)
  )
) 
```

注意：实际`HOST`的`PORT`、 和`SERVICE_NAME`将根据您建立连接的 Oracle 服务器而有所不同。通常可以使用*侦听*器下的 Oracle 网络客户端工具找到此信息。

可以是您要分配给 Oracle 数据源的`OracleTnsName`任何名称，并将在设置系统 DSN 时使用。如果需要，您还可以使用上述语法在同一个[tnsnames.ora](http://www.orafaq.com/wiki/Tnsnames.ora)文件中定义多个 TNS 名称。

d。将 [目录] 添加到系统**`PATH`**环境变量中。

e. 创建一个名为**`TNS_Admin`**[directory]​​的新系统环境变量

F。执行该**`[directory]\odbc_install.exe`**实用程序以安装 Oracle ODBC 驱动程序。

G。建议您重新启动 SQL 服务器，但可能没有必要。此外，您可能希望为此目录授予 SQL 服务器和 SQL 代理用户身份的安全权限。

**步骤 2：创建使用 Oracle ODBC 驱动程序的系统 DNS**

一种。打开*ODBC 数据源管理器*工具。[ 管理工具 --> 数据源 (ODBC) ]

湾。选择系统 DSN 选项卡，然后选择添加按钮。

C。在驱动程序列表中，选择*Oracle in instantclient {version}*。（例如，“instantclient 10_2 中的 Oracle”），然后选择“完成”按钮。

d。指定以下内容：

*   `Data Source Name`: {系统 DSN 名称}
*   `Description`: {留空/空}
*   `TNS Service Name`：应该有`OracleTnsName`你在**`tnsnames.ora`**列出的文件中定义的，选择它作为值。
*   *用户 ID*：{Oracle 用户名}

e. 选择测试连接按钮。系统应提示您提供 {Oracle 用户密码}。如果一切顺利，测试就会成功。

**第 3 步：在 SQL 中创建链接服务器到 Oracle 数据库**

在 SQL Server 中打开一个查询窗口并执行以下命令：

```
EXEC sp_addlinkedserver 
     @server        = '{Linked Server Name}'
    ,@srvproduct    = '{System DSN Name}'
    ,@provider      = 'MSDASQL'
    ,@datasrc       = '{System DSN Name}'

EXEC sp_addlinkedsrvlogin 
     @rmtsrvname    = '{Linked Server Name}'
    ,@useself       = 'False'
    ,@locallogin    = NULL
    ,@rmtuser       = '{Oracle User Name}'
    ,@rmtpassword   = '{Oracle User Password}' 
```

注意：`{Linked Server Name}`可以是您在引用 Oracle 服务器时要使用的任何内容，但`{System DNS Name}` **必须**与您之前创建的系统 DSN 的名称相匹配。

`{Oracle User Name}`应该与系统 DSN 使用的用户 ID 相同，并且应该`{Oracle User Password}`与您用于成功测试 ODBC 连接的相同。有关解决 Oracle 链接服务器问题的信息，请参阅[KB 280106](http://support.microsoft.com/kb/280106)。

**查询 Oracle 链接服务器**

您可以使用[OPENQUERY](http://msdn.microsoft.com/en-us/library/ms188427.aspx)在 Oracle 链接服务器上执行传递查询，但请注意，对于非常大的记录集，如果在传递查询中`ORA-01652`指定子句，您可能会收到错误消息。`ORDER BY`将`ORDER BY`子句从传递查询移动到外部选择语句为我解决了这个问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-13T17:03:39.880

我有同样的问题。我和微软通了几个小时的电话，他们没有解决办法。这些“连接超时”设置都没有帮助我。

为了解决这个问题，我创建了一个运行 proc 的 DTS 作业，它每两分钟只更新一行、一列的时间。然后我在 SQL Server 和 Oracle 之间设置了一个复制，计划每 3 分钟将单个单元更改从 SQL 复制到 Oracle。它使连接保持活力！

# sharepoint - 将 SharePoint 列表数据提取到单独的 SQL Server 表的最简单方法是什么？

> ID：307640
> 
> 赞同：8
> 
> 时间：2008-11-21T02:27:49.133
> 
> 标签：sharepoint, etl, sharepoint-api

**已编辑：将提取的 SharePoint 列表数据**~~抓取~~到单独的 SQL Server 表 的最简单方法是什么？一种情况：您处于无法控制 SharePoint Server 后面的 SQL Server 的工作环境中，因此您不能只从*UserData*表中提取数据。

是否有任何实用程序可用于安排夜间提取？

Microsoft 是否计划在此处对“SharePoint 4”进行任何改进？

**2009 年 1 月 6 日更新：**
[http](http://connectionstrings.com/sharepoint)
://connectionstrings.com/sharepoint 对于未安装 Office 的服务器，您需要：
[此下载](http://www.microsoft.com/downloads/details.aspx?familyid=7554F536-8C28-4598-9B72-EF94E038C891&displaylang=en)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T16:47:50.810

有一个 SSIS SharePoint 任务可用于获取常规数据流的数据信息：http: [//www.codeplex.com/SQLSrvIntegrationSrv](http://www.codeplex.com/SQLSrvIntegrationSrv)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T12:12:17.830

刮痧？就像屏幕抓取一样？你是认真的吗？;)

2 个选项

SharePoint 对象模型 - [http://msdn.microsoft.com/en-us/library/ms441339.aspx](http://msdn.microsoft.com/en-us/library/ms441339.aspx)

SharePoint Web 服务 - [http://msdn.microsoft.com/en-us/library/ms479390.aspx](http://msdn.microsoft.com/en-us/library/ms479390.aspx) 特别是[Lists Web 服务](http://msdn.microsoft.com/en-us/library/lists.lists_members.aspx)

Web 服务是 Excel/Access 与 SharePoint 通信以与其列表集成的方式。

事实上，一点谷歌 foo 给出了这两个结果：-

[将 SQL Reporting Services 连接到 SharePoint 列表](http://www.sharepointblogs.com/dwise/archive/2007/11/28/connecting-sql-reporting-services-to-a-sharepoint-list-redux.aspx)

[使用 SQL Server 2005 Reporting Services 访问 SharePoint 列表项](http://rockstarguys.com/blogs/colin/archive/2006/11/10/accessing-sharepoint-list-items-with-sql-server-2005-reporting-services.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-20T10:12:22.507

2 分钟的答案是使用 Simego ( [http://www.simego.com](http://www.simego.com) ) 的 Data Synchronization Studio，只需将其指向您的列表和数据库，它就会同步所有更改。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-11-29T07:56:41.363

有一个用于 MOSS 2007/2010 和 WSS 3.0/4.0 的 ADO.NET 适配器，其名称为用于 Microsoft SharePoint 的 Camelot .NET 连接器。它使您能够使用 SharePoint 作为数据层，通过标准 SQL 语言查询 SharePoint 中的列表。

除了连接器之外，还有大量可用的开源工具和实用程序，例如用于将数据导出为各种格式（XML、MySQL、..）的 webpart、Joomla 插件、同步服务等。

有关详细信息和观看网络广播，请[访问 http://www.bendsoft.com](http://www.bendsoft.com)。BendSoft 目前正在寻找 Beta 测试人员并鼓励来自社区的所有反馈。

**例子：**

选择 * 从`My Custom SharePoint List`

INSERT INTO Calendar (EventDate,EndDate,Title,Location) VALUES ('2010-11-04 08:00:00','2010-11-04 10:00:00','Morning meeting with Leia','Starbucks' )

`Corp Images`从哪里删除`Image Name`= 'marketing.jpg'

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-11-04T08:05:18.333

我已经用一步一步的截图程序写了一篇关于这个的完整文章。它不使用任何第三方组件，仅使用 SQL BI Tools 和 Sharepoint。看看这里

[http://macaalay.com/2013/11/01/how-to-archive-sharepoint-list-items-to-sql-server/](http://macaalay.com/2013/11/01/how-to-archive-sharepoint-list-items-to-sql-server/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-21T19:41:17.097

正如 Ryan 所说，我还建议使用对象模型/Web 服务将数据存储到单独的 SQL 数据库中。我认为最好的方法是编写一个事件处理程序，它至少会触发并复制用户插入/更新的数据。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-03T18:03:29.287

关于您对“SharePoint 4”的查询，比尔·盖茨在 2008 年 SharePoint 会议上[发表了一些评论](http://technicallead.wordpress.com/2008/10/08/sharepoint-2009-improvements-to-lists-architecture/)。他建议使用 SharePoint 数据丰富 SQL 表，并继续提到其他一些可能很酷的事情。在我们开始看到 WSS4 / MOSS 14 的测试版之前，很难说他的确切含义以及它是否会在未来帮助解决您的问题。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-06-17T19:45:49.867

我会使用 simego 软件，但我没有钱，也许 15 天试用就足够了！

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-07-01T17:31:31.237

如果您安装了 MOSS，则可以从 Sharepoint 管理中心设置业务数据目录，以自动为您同步数据。这是一个非常强大的产品，包含在 MOSS 中。当客户启用它时，我喜欢它，因此我可以利用它。

但有些人不这样做，而对于我自己，我发现如果他们没有运行 BDC 并且不可用，他们不可避免地不会给开发人员很多 SQL Server 的权利，所以 SSIS 通常是不可能的（但也许这只是我）。没问题; 对于那些我将整合一个轻量级的 EXE，它在一个计划任务上运行，该任务查询 Lists.asmx 并将更改推送到 SQL Server 表。对于一个没有删除任何内容的简单列表来说，这是相当琐碎的事情。获得 Visual Studio 2008、CAML Builder，并为美好时光做好准备。Lists.asmx 结果有点好笑，因为列表行的每个字段都是具有很多属性的单个节点，没有子节点......像这样的事情在我脑海中浮现......只要记住编码时...

<z:row ows_Id="1" ows_Field1="A1" ows_Field2="B1"/> <z:row ows_Id="1" ows_Field1="A2" ows_Field2="B2"/>

复制列表中的项目被删除，或者在 SP 列表之间存在父/子关系时，代码中的复杂性会发生。你会认为我有一些代码可以发送给你，但我没有费心整理一些我可以重复使用的东西。

我敢肯定还有其他方法可以处理它，但是到目前为止，计划任务 EXE 对我来说多年来对于多个应用程序都是可靠的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-04-02T13:33:24.590

我写了一些代码来实现它，你可以在这里找到它

[从 moss 2007 中提取数据](http://netrsc.blogspot.com/2010/04/extract-data-from-moss-2007-sharepoint.html)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-21T02:37:23.357

根据您需要插入的数据的确切性质，可能只使用自动生成的 RSS 提要来获取您想要的信息，一个过程将需要读取 rss 并制定查询。

否则，控制台应用程序/服务可以使用对象模型来做同样的事情，但可以更好地控制字段信息。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-03T00:40:06.680

我希望这样的事情更容易做到。不需要 SSIS 的东西被归结为一个控制台工具，它读取源/目标/地图信息的 xml 配置文件。

[http://blogs.officezealot.com/mtblog/archive/2008/06/03/importing-list-data-into-sql.aspx](http://blogs.officezealot.com/mtblog/archive/2008/06/03/importing-list-data-into-sql.aspx)

# c# - 进程终止后清理 AppBar

> ID：307643
> 
> 赞同：4
> 
> 时间：2008-11-21T02:30:55.477
> 
> 标签：c#, .net, appbar

我写了一个应用程序桌面工具栏（又名 AppBar），它工作得很好，除了如果我终止进程，AppBar 代码永远没有机会通过发送 ABM_REMOVE 来清理。问题是这基本上把用户的桌面搞砸了。AppBar 是使用互操作代码在 .NET 中编写的。

有谁知道清理这个资源的方法，即使是在 TaskManager 杀死进程的情况下？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-25T19:45:48.943

当一个进程从任务管理器中被杀死时，该应用程序中不会引发任何事件。通常使用单独的帮助应用程序来侦听您的进程的 Win32_ProcessStopTrace 事件。您可以使用 WqlEventQuery，它是 System.Management 的一部分。

这是来自[MegaSolutions 帖子](http://www.megasolutions.net/cSharp/Trapping-process-starting-ending_-65911.aspx)的一些示例代码。

```
using System;
using System.Collections.Generic; 
using System.Text; 
using System.Management; 

class ProcessObserver : IDisposable 
{ 
    ManagementEventWatcher m_processStartEvent = null; 
    ManagementEventWatcher m_processStopEvent = null; 

    public ProcessObserver(string processName, EventArrivedEventHandler onStart, EventArrivedEventHandler onStop) 
    { 
        WqlEventQuery startQuery = new WqlEventQuery("Win32_ProcessStartTrace", String.Format("ProcessName='{0}'", processName)); 
        m_processStartEvent = new ManagementEventWatcher(startQuery); 

        WqlEventQuery stopQuery = new WqlEventQuery("Win32_ProcessStopTrace", String.Format("ProcessName='{0}'", processName)); 
        m_processStopEvent = new ManagementEventWatcher(stopQuery); 

        if (onStart != null) 
            m_processStartEvent.EventArrived += onStart; 

        if (onStop != null) 
            m_processStopEvent.EventArrived += onStop; 
    } 

    public void Start() 
    { 
        m_processStartEvent.Start(); 
        m_processStopEvent.Start(); 
    } 

    public void Dispose() 
    { 
        m_processStartEvent.Dispose(); 
        m_processStopEvent.Dispose(); 
    } 
} 
```

# php - 如何从 PHP 中的数组中删除重复值

> ID：307650
> 
> 赞同：203
> 
> 时间：2008-11-21T02:37:15.243
> 
> 标签：php, arrays, duplicate-data

如何从 PHP 中的数组中删除重复值？

* * *

## 回答 #1

> 赞同：325
> 
> 时间：2008-11-21T02:39:33.040

使用[array_unique()](http://php.net/array_unique)。

例子：

```
$array = array(1, 2, 2, 3);
$array = array_unique($array); // Array is now (1, 2, 3) 
```

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2017-02-15T13:49:33.147

采用`array_values(array_unique($array));`

`array_unique`: 用于唯一数组 `array_values`: 用于重新索引

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2011-12-06T11:23:46.753

```
//Find duplicates 

$arr = array( 
    'unique', 
    'duplicate', 
    'distinct', 
    'justone', 
    'three3', 
    'duplicate', 
    'three3', 
    'three3', 
    'onlyone' 
);

$unique = array_unique($arr); 
$dupes = array_diff_key( $arr, $unique ); 
    // array( 5=>'duplicate', 6=>'three3' 7=>'three3' )

// count duplicates

array_count_values($dupes); // array( 'duplicate'=>1, 'three3'=>2 ) 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2017-01-12T18:57:41.117

唯一对我有用的是：

```
$array = array_unique($array, SORT_REGULAR); 
```

编辑：`SORT_REGULAR`保持与原始数组相同的顺序。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2018-02-12T21:05:16.120

```
$result = array();
foreach ($array as $key => $value){
  if(!in_array($value, $result))
    $result[$key]=$value;
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-05-13T22:57:48.290

有时`array_unique()`不是这样，如果您想**获得唯一且重复的项目**...

```
$unique=array("","A1","","A2","","A1","");
$duplicated=array();

foreach($unique as $k=>$v) {

if( ($kt=array_search($v,$unique))!==false and $k!=$kt )
 { unset($unique[$kt]);  $duplicated[]=$v; }

}

sort($unique); // optional
sort($duplicated); // optional 
```

结果在

```
array ( 0 => '', 1 => 'A1', 2 => 'A2', ) /* $unique */

array ( 0 => '', 1 => '', 2 => '', 3 => 'A1', ) /* $duplicated */ 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-06-29T08:55:58.013

我们可以创建这种类型的数组来使用最后一个值将被更新为列或键值，我们将从数组中获得唯一值......

```
$array = array (1,3,4,2,1,7,4,9,7,5,9);
    $data=array();
    foreach($array as $value ){

        $data[$value]= $value;

    }

    array_keys($data);
    OR
    array_values($data); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2019-04-10T12:38:40.680

```
$a = array(1, 2, 3, 4); 
$b = array(1, 6, 5, 2, 9); 
$c = array_merge($a, $b);
$unique = array_keys(array_flip($c));
print_r($unique); 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-08-18T12:41:25.453

`explode(",", implode(",", array_unique(explode(",", $YOUR_ARRAY))));`

这将处理键关联并序列化生成的新数组的键:-)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2016-07-25T01:57:36.860

根据数组的大小，我发现

```
$array = array_values( array_flip( array_flip( $array ) ) ); 
```

可以比 array_unique 更快。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2018-06-05T08:33:32.307

可以有多种方法来执行这些操作，如下所示

```
//first method
$filter = array_map("unserialize", array_unique(array_map("serialize", $arr)));

//second method
$array = array_unique($arr, SORT_REGULAR); 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2021-07-07T20:53:17.943

我们可以很容易地使用`arrar_unique($array);`删除重复元素 **，但是这种方法的问题是元素的索引不按顺序，如果以后在其他地方使用会导致问题。**

**采用**

```
$arr = array_unique($arr);
$arr = array_values($arr);
print_r($arr); 
```

**或者**

```
$arr = array_flip($arr);
$arr = array_flip($arr);
$arr = array_values($arr);
print_r($arr); 
```

第一次翻转，翻转键值对，从而将元素与相似的键（最初是值）组合起来。

第二次翻转以还原所有键值对。最后`array_value()`用从 0 开始的键设置每个值。

*注意：不可用于具有预定义键值对的关联数组*

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-08-09T09:53:20.767

这是一个很好的方法。可能想确保它的输出再次返回一个数组。现在您只显示最后一个唯一值。

试试这个：

```
$arrDuplicate = array ("","",1,3,"",5);

foreach (array_unique($arrDuplicate) as $v){
  if($v != "") { $arrRemoved[] = $v; }
}
print_r ($arrRemoved); 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-06-15T05:42:08.237

```
 if (@!in_array($classified->category,$arr)){        
                                    $arr[] = $classified->category;
                                 ?>

            <?php } endwhile; wp_reset_query(); ?> 
```

第一次检查数组中的值并发现相同的值忽略它

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-02-12T20:39:32.333

从 PHP 中的关联数组中删除重复值。

```
$arrDup = Array ('0' => 'aaa-aaa' , 'SKU' => 'aaa-aaa' , '1' => '12/1/1' , 'date' => '12/1/1' , '2' => '1.15' , 'cost' => '1.15' );

foreach($arrDup as $k =>  $v){
  if(!( isset ($hold[$v])))
      $hold[$v]=1;
  else
      unset($arrDup[$k]);
} 
```

数组（[0] => aaa-aaa [1] => 12/1/1 [2] => 1.15）

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2018-10-01T12:59:42.223

如果您关心性能并且有简单的数组，请使用：

```
array_keys(array_flip($array)); 
```

它比array_unique 快很多倍。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-11-14T09:09:27.740

```
$arrDuplicate = array ("","",1,3,"",5);
 foreach(array_unique($arrDuplicate) as $v){
  if($v != "" ){$arrRemoved = $v;  }}
print_r($arrRemoved); 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2014-04-01T09:47:00.943

试试这个简短而甜蜜的代码 -

```
$array = array (1,4,2,1,7,4,9,7,5,9);
$unique = array();

foreach($array as $v){
  isset($k[$v]) || ($k[$v]=1) && $unique[] = $v;
  }

var_dump($unique); 
```

**输出 -**

```
array(6) {
  [0]=>
  int(1)
  [1]=>
  int(4)
  [2]=>
  int(2)
  [3]=>
  int(7)
  [4]=>
  int(9)
  [5]=>
  int(5)
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-07-27T06:45:09.927

可以通过函数来​​完成，我做了三个函数重复返回数组中重复的值。

第二个函数single只返回那些在数组中不重复的单一的值，第三个和完整的函数返回所有值但不重复，如果任何值重复，则将其转换为single；

```
function duplicate($arr) {
    $duplicate;
    $count = array_count_values($arr);
    foreach($arr as $key => $value) {
        if ($count[$value] > 1) {
            $duplicate[$value] = $value;
        }
    }
    return $duplicate;
}
function single($arr) {
    $single;
    $count = array_count_values($arr);
    foreach($arr as $key => $value) {
        if ($count[$value] == 1) {
            $single[$value] = $value;
        }
    }
    return $single;
}
function full($arr, $arry) {
    $full = $arr + $arry;
    sort($full);
    return $full;
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-01-24T08:35:07.053

```
<?php
$arr1 = [1,1,2,3,4,5,6,3,1,3,5,3,20];    
print_r(arr_unique($arr1));

function arr_unique($arr) {
  sort($arr);
  $curr = $arr[0];
  $uni_arr[] = $arr[0];
  for($i=0; $i<count($arr);$i++){
      if($curr != $arr[$i]) {
        $uni_arr[] = $arr[$i];
        $curr = $arr[$i];
      }
  }
  return $uni_arr;
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2018-12-04T07:31:21.980

在这里，我创建了第二个空数组并使用`for`循环与第一个数组重复。它将运行与第一个数组的计数一样多的时间。然后将数组的位置与第一个数组进行比较，并使用`in_array`. 如果没有，那么它将将该项目添加到第二个数组中`array_push`。

```
$a = array(1,2,3,1,3,4,5);
$count = count($a);
$b = [];
for($i=0; $i<$count; $i++){
    if(!in_array($a[$i], $b)){
        array_push($b, $a[$i]);
    }
}
print_r ($b); 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-03-14T19:05:11.850

array_unique() 函数的替代方法..

使用蛮力算法

```
//[1] 这是我们的包含重复项的数组

$matches = ["jorge","melvin","chelsy","melvin","jorge","smith"];

//[2] 新数组的容器，没有任何重复项

$arr = [];

//[3] 获取复制数组的长度并将其设置为用于 for 循环的 var len

$len = count($matches);

//[4] 如果匹配数组 key($i) 当前循环迭代不可用
//[4] 数组 $arr 然后推送匹配项的当前迭代键值[$i]
//[4] 到数组 arr.

对于($i=0;$i

`if(array_search($matches[$i], $arr) === false){

    array_push($arr,$matches[$i]);
}
}

//print the array $arr.
print_r($arr);

//Result: Array
(
[0] => jorge
[1] => melvin
[2] => chelsy
[3] => smith
)` 
```

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2012-11-05T11:11:13.880

```
function arrayUnique($myArray)
{
    $newArray = Array();
    if (is_array($myArray))
    {
        foreach($myArray as $key=>$val)
        {
            if (is_array($val))
            {
                $val2 = arrayUnique($val);
            }
            else
            {
                $val2 = $val;
                $newArray=array_unique($myArray);
                $newArray=deleteEmpty($newArray);
                break;
            }
            if (!empty($val2))
            {
                $newArray[$key] = $val2;
            }
        }
    }
    return ($newArray);
}

function deleteEmpty($myArray)
{
    $retArray= Array();
    foreach($myArray as $key=>$val)
    {
        if (($key<>"") && ($val<>""))
        {
            $retArray[$key] = $val;
        }
    }
    return $retArray;
} 
```

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2021-01-01T06:01:33.527

```
<?php
$a=array("1"=>"302","2"=>"302","3"=>"276","4"=>"301","5"=>"302");
print_r(array_values(array_unique($a)));
?>//`output -> Array ( [0] => 302 [1] => 276 [2] => 301 )` 
```

* * *

## 回答 #25

> 赞同：-2
> 
> 时间：2019-07-05T13:23:18.900

```
$array = array("a" => "moon", "star", "b" => "moon", "star", "sky");

// Deleting the duplicate items
$result = array_unique($array);
print_r($result); 
```

参考：[演示](https://www.tutorialrepublic.com/codelab.php?topic=php&file=remove-duplicate-elements-from-an-array)

* * *

## 回答 #26

> 赞同：-3
> 
> 时间：2010-03-07T17:31:45.737

我没有使用任何功能就做到了。

```
$arr = array("1", "2", "3", "4", "5", "4", "2", "1");

$len = count($arr);
for ($i = 0; $i < $len; $i++) {
  $temp = $arr[$i];
  $j = $i;
  for ($k = 0; $k < $len; $k++) {
    if ($k != $j) {
      if ($temp == $arr[$k]) {
        echo $temp."<br>";
        $arr[$k]=" ";
      }
    }
  }
}

for ($i = 0; $i < $len; $i++) {
  echo $arr[$i] . " <br><br>";
} 
```

# macos - 您如何开发应用程序来在 Cocoa 中绘制、编辑和保存 UML 模型？

> ID：307653
> 
> 赞同：1
> 
> 时间：2008-11-21T02:38:04.167
> 
> 标签：macos, cocoa

单个 UML 图形状是 NSView 子类还是 NSBezierPaths？图表是如何创建和管理的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T13:13:04.917

一种方法是：

*   创建基于文档的应用程序
*   为最终用户将能够在画布中绘制的不同对象设计模型类，所有对象都共享一个抽象超类
*   在您的 CanvasView 类中，实现 drawRect 并让它调用 NSDocument 子类，或者对于更精细的类，它是 viewcontroller，以获取所有应该以正确顺序绘制的对象来绘制它们。
*   对于这些对象中的每一个，从 CanvasView 的 drawRect: 实现中调用 drawInteriorInView:rect: 方法或它们都已实现的类似方法。

这种细粒度设计的优势在于，如果您发现需要这样做，您可以决定用直接的 CoreGraphics 调用替换 NSBezierPath 绘图，而无需完全重新构建应用程序。

典型的 Cocoa 控件，例如 tableView，实现了一堆不同的绘图方法，一个用于背景，一个用于网格线等等。所有这些都从视图的 drawRect: 中调用（如果适用）。

或者你当然可以看看[GCDrawKit](http://apptree.net/drawkitmain.htm)，它似乎有一个非常实用的实现。特别是查看它附带的示例应用程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T03:45:54.967

你看过 OmniGraffle 吗？它可能会满足您的需求。

[非编程相关的答案...]

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T04:01:52.733

您是否查看过 /Developer/Examples/AppKit 中的 Sketch 示例项目？它应该让你至少走到你要去的地方的一半。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-21T04:40:34.607

您通常会从一个 NSView 子类开始来表示您的“画布”并处理绘图和鼠标/键盘事件。您可能会在绘图方法中使用 NSBezierPath 来填充和勾勒形状。根据绘图代码的复杂程度，您可能会将所有内容都放在您的 NSView 子类中，或者创建一个 NSCell 子类，这会从 NSView 中提取一些工作。在任何一种情况下，您都希望定义数据源协议（或创建绑定）以从数据模型中表示 UML 项的对象向 NSView 提供数据。

Core Animation 也值得考虑，虽然我会从 NSView 开始，至少对于一个简单的原型。

# c# - 使用 LINQ-to-SQL 从事务内部回滚存储过程调用？

> ID：307656
> 
> 赞同：11
> 
> 时间：2008-11-21T02:39:54.443
> 
> 标签：c#, sql-server, linq, linq-to-sql, stored-procedures

我有一个与 SQL Server 数据库一起运行的 C#.net winform 程序。我正在使用 LINQ-to-SQL。是否可以使用 LINQ-to-SQL 在我的程序内的事务中回滚对一个或多个存储过程的调用？

最初我认为在存储过程中管理事务是有意义的，但如果我需要回滚多个存储过程调用作为单个事务的一部分，则需要在我的 C# 程序中完成。

有人可以向我指出如何执行此操作的代码片段或提供对替代方案的一些见解吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-21T05:17:36.263

另一种选择`DbTransaction`是[`TransactionScope`](http://msdn.microsoft.com/en-us/library/system.transactions.transactionscope(VS.85).aspx)——这提供了一个更简单的编程模型，并且可以扩展到多个同时的数据库和其他提要（通过 DTC）——但代价是连接上的少量开销。它曾经有更多的开销，但在 SQL2005 等下它将使用“LTM”，直到你开始跨越多个连接 - 所以单个操作通常非常便宜：

```
using (TransactionScope tran = new TransactionScope())
using (FooDataContext ctx = new FooDataContext())
{
    // your work with ctx
    // ...
    // other work involving connections etc
    // ...
    tran.Complete();
} 
```

非常简单；-p 您还应该能够使事务更细化（仅通过几个查询）或更简单地包含。大多数现有代码将自动加入事务范围，从而非常容易改造现有代码。

有关 TransactionScope（以及 .NET 中的一般事务）的更多信息，请参见[此处](https://stackoverflow.com/questions/224689)。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-11-21T02:55:13.007

虽然我没有使用存储过程，但你可以有类似的东西：

```
 public Response<SomeObject> SaveSomething(Object yourObject)
    {
        DbTransaction dbTransaction = null;
        try
        {
            using (DataContext context = new DataContext())
            {
                    //Creates a new DB transaction
                    if (context.Connection.State == System.Data.ConnectionState.Closed)
                    {
                        context.Connection.Open();
                    }
                    dbTransaction = context.Connection.BeginTransaction(System.Data.IsolationLevel.Serializable);
                    context.Transaction = dbTransaction;

         context.SaveYourObject(yourObject);
                    //Commit the transaction
                    dbTransaction.Commit();
                    response.ResponseObject = yourObject;
                    response.Messages.AddSuccessfulSave("Saved!");
                }
            }
        }
        catch (ChangeConflictException cex)
        {
            if (dbTransaction != null) dbTransaction.Rollback();
            response.Errors.AddConcurrencyError();
            response.IsSuccessful = false;
        }
        catch (SqlException sqlEx)
        {
            if (dbTransaction != null) dbTransaction.Rollback();
            if (sqlEx.Class == 14 && (sqlEx.Number == 2601 || sqlEx.Number == 2627)) //Duplicated key
            {
                response.Errors.Add(new Error
                {
                    Name = "Duplicate item",
                    Description = "This object already exists."
                });
                ExceptionPolicy.HandleException(sqlEx, SERVICE_EXCEPTION_POLICY);
                response.IsSuccessful = false;
            }
            else //other SQL errors
            {
                response.Errors.AddSavingError("Your object", yourObjectId);
                ExceptionPolicy.HandleException(sqlEx, SERVICE_EXCEPTION_POLICY);
                response.IsSuccessful = false;
            }
        } 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-05-21T11:02:54.733

```
private string RollBack_fn()
{
    int sal = 0;
    OracleConnection myconn = new OracleConnection(ConfigurationManager.AppSettings["con"].ToString());
    cmd = new OracleCommand("SP_student_MAST", myconn);
    cmd.CommandType = CommandType.StoredProcedure;
    OracleParameter param1 = null, param2 = null, param3 = null, param4 = null, param5 = null;

    try
    {
        myconn.Open();
       trans = myconn.BeginTransaction();
        cmd.Transaction = trans;
        //param1 = new OracleParameter("pSNo", OracleType.VarChar, 5);
        //param1.Value ="";
        //cmd.Parameters.Add(param1);

        param2 = new OracleParameter("pSName", OracleType.VarChar, 10);
       // param2.Value = "Saravanan";
        param2.Value = TextBox1.Text;
        cmd.Parameters.Add(param2);

        param3 = new OracleParameter("pENo", OracleType.VarChar,5);
        param3.Value = TextBox2.Text;
        cmd.Parameters.Add(param3);

        param4 = new OracleParameter("pEName", OracleType.VarChar,10);
       // param4.Value = "Sangeetha";
        param4.Value = TextBox3.Text;
        cmd.Parameters.Add(param4);

        param5 = new OracleParameter("pSENo", OracleType.Char, 5);
        param5.Value = "";
        cmd.Parameters.Add(param5);
        sal = cmd.ExecuteNonQuery();
        trans.Commit();
        Response.Write("Record Saved");
        myconn.Close();
       // rollbackvalue = 0;
    }
    catch (Exception ex)
    {
        Response.Write("Not saved.RollBacked");
        trans.Rollback();
        //rollbackvalue = 1;
    }
    string cs = Convert.ToString(sal);
    return cs;

} 
```

# excel - 在类调试中引发的错误就像在属性调用中引发的一样

> ID：307657
> 
> 赞同：4
> 
> 时间：2008-11-21T02:40:55.330
> 
> 标签：excel, excel-2000, vba

我（不幸的是）在 Excel 2000 VBA 中开发应用程序。我相信我已经发现在自定义类属性、函数或子调试中引发的任何错误就好像在调用该属性的 VBA 代码中引发错误一样。也就是说，VBE 调试器不会将我带到 Class 属性中发生错误的位置，而是将我带到第一次输入属性的位置（例如，从 Module Sub 或 Function）。这使得开发除最浅的 OO Excel 2000 VBA 代码，因为我必须逐行遍历每个 Class 方法以发现导致错误的指令。

我是否遗漏了什么，或者这是我必须在 Excel 2000 中处理的已知错误？这个问题是在 2003 年还是 2007 年解决的？

示例代码：

```
'''''''''''''''
'In Module1:

Public Sub TestSub1()
    Dim testClass As Class1
    Dim testVariant As Variant
    Set testClass = New Class1
    testVariant = testClass.Property1 'Debugger takes me here...
End Sub

''''''''''''''
' In Class1

Property Get Property1() As Variant
    Err.Raise 666, , "Excel 2000 VBA Sux!" 'But error is actually thrown here.
End Property 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T09:30:45.970

对于 Office 2003，当调试器配置为在未处理的错误（默认配置）时中断时，您将获得此行为。

如果您希望它在 Err.Raise 行中断，您需要将其配置为在所有错误上中断（工具/选项/常规/错误捕获/所有错误中断）。

我相信 Office 2000 也是如此，但没有要检查的副本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T17:38:34.943

这个页面是 VBA 中错误处理的一个很好的资源：

*   [Microsoft Access、VBA 和 Visual Basic 6 的错误处理和调试提示和技术](http://www.fmsinc.com/TPapers/vbacode/Debug.asp)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T02:54:14.493

这个“功能”在 Excel 2003 中是相同的，如果它在 2007 年有所不同，我会感到惊讶。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-10-18T15:09:59.797

在 Excel 2010 中仍然如此 - 这就是我遇到这种行为的地方。

引用[Chip Pearson 的网站](http://www.cpearson.com/excel/BreakInClassModule.aspx)：

> 除了 Break In Class Module 之外，绝对没有理由使用错误捕获设置。

他对错误模式之间区别的描述：

> 在测试和运行代码时，您有三种错误捕获模式。第一个是 Break On All Errors。如果发生任何错误，这将导致调试器打开，无论您在代码中可能有任何 On Error 处理。第二个选项是 Break On Unhandled Errors。如果错误不是由现有的 On Error 指令处理，这将导致调试器打开。这是最常用的选项，也是默认设置。第三个选项，Break In Class Module 是最重要和最少使用的。它不是默认的错误捕获模式，因此您必须手动设置它。
> 
> Break In Class Module 是最重要的，因为它会导致调试器在目标模块中实际导致问题的代码行上中断。Break In Class Module 设置位于“工具”菜单上的“选项”对话框中。它位于“选项”对话框的“常规”选项卡上，如下所示。

# windows - 如何将脚本的输出复制到 Windows 剪贴板？

> ID：307658
> 
> 赞同：5
> 
> 时间：2008-11-21T02:42:40.990
> 
> 标签：windows, perl, scripting, batch-file, clipboard

我发现自己正在运行脚本并将这些运行的输出复制粘贴到电子邮件或其他一些文档中。有没有一种方法可以使复制到剪贴板的步骤成为脚本本身的一部分？我的大部分脚本都是 Perl 或 bat 文件，我在 Windows 上工作。

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-21T03:00:43.560

您可以使用一个[名为 clip.exe](http://www.labnol.org/software/tutorials/copy-dos-command-line-output-clipboard-clip-exe/2506/)的实用程序。只需将脚本或任何其他命令的输出通过管道传输到 clip.exe 中（首先，将其放在路径中的某个位置。如果您没有通常的位置放置这些实用程序，则可以将其转储到您通常运行的目录中你的脚本来自，或者我知道有人`c:\Windows\system32`在紧要关头使用......）：

```
somescript.bat | clip 
```

然后粘贴。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T02:48:01.727

在 Perl 中，安装和使用[Win32::Clipboard](http://www.xav.com/perl/site/lib/Win32/Clipboard.html)模块

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T02:46:56.893

不确定剪贴板，但您可以将输出通过管道传输到文本文件，但可以执行以下操作：

```
somescript.bat > output.txt 
```

# wpf - 绑定到 UserControl 中的元素

> ID：307664
> 
> 赞同：1
> 
> 时间：2008-11-21T02:45:12.123
> 
> 标签：wpf, xaml, binding, user-controls, actualwidth

假设我有一个像下面这样的用户控件，我如何`ActualWidth`从控件外部将某些东西绑定到“G1”网格的？

```
<UserControl x:Class="Blah">
  <WrapPanel>
    <Grid x:Name="G1">
      ...
    </Grid>
    <Grid>
      ...
    </Grid>
  </WrapPanel>
</UserControl> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T10:40:35.940

如果您的意思是在控件之外，而不是作为控件的内容，则可以`ElementName`在 Binding 中使用，如下所示：

```
{Binding ElementName=G1, Path=ActualWidth} 
```

如果您的意思是在另一个 Xaml 文件中的控件之外，那么如果您的控件在另一个控件的范围内，则可以尝试使用 Path 属性：

```
{Binding ElementName=ParentControl, Path=G1.ActualWidth} 
```

但是我建议不要使用这种设计，因为您可能有一天会更改 G1 的名称，并且您永远不会知道任何可能会破坏的绑定。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T02:52:57.583

如果要绑定到使用此用户控件的外部控件，请`DependencyProperty`在后面的 UserControl 代码中声明 a，然后将 G1 绑定到该属性。并将外部控件的属性绑定到 UserControl 的`DependencyProperty`. 这就像一个 2 级间接。

# ruby-on-rails - foo_url(mock_foo) 有时在 rspec 测试中不起作用

> ID：307669
> 
> 赞同：1
> 
> 时间：2008-11-21T02:47:24.380
> 
> 标签：ruby-on-rails, ruby, rspec

我正在尝试为访问模型组的控制器编写 rspec 测试。

```
@request.env['HTTP_REFERER'] = group_url(@mock_group) ### 第 49 行

```

我明白了：

```
'ActsController 中的 NoMethodError 响应创建应重定向到：back'
当你没想到时，你有一个 nil 对象！
评估 nil.rewrite 时发生错误
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/base.rb:621:in `url_for'
(eval):17:in `group_url'
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/test_process.rb:464:in `send!'
/Library/Ruby/Gems/1.8/gems/actionpack-2.1.0/lib/action_controller/test_process.rb:464:in `method_missing'

```

url_for 中的这一行是问题所在；特别是@url 为零。

```
@url.rewrite(rewrite_options(options))

```

似乎 @url 在这里初始化：

```
def initialize_current_url
  @url = UrlRewriter.new(request, params.clone)
结尾

```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T19:39:12.167

发生这种情况是因为 url_for 依赖于在请求处理期间初始化的内容。我假设您的测试看起来像这样：

```
it "should do whatever when referrer is group thing" do
  @request.env["HTTP_REFERER"] = url_for(@mock_group)
  get :some_action
  "something".should == "something"
end 
```

url_for 失败，因为它发生在获取之前。解决问题的最简单方法是在测试中对 URL 进行硬编码（即更改`url\_for(@mock\_group)`为`"http://test.host/group/1"`）。另一个选项是在调用 url_for 之前弄清楚如何让 @controller 初始化 @url。我想我以前做过，但是我没有代码了，它涉及到挖掘 action_controller 的代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-26T21:06:32.990

看这个。我认为这是相关的。

[http://jakescruggs.blogspot.com/2008/11/if-you-use-mocha-and-rspec-then-read.html](http://jakescruggs.blogspot.com/2008/11/if-you-use-mocha-and-rspec-then-read.html)

# php - 如何从 PHP 中的多维数组中删除重复值

> ID：307674
> 
> 赞同：347
> 
> 时间：2008-11-21T02:50:30.757
> 
> 标签：php, arrays, duplicate-data

如何从 PHP 中的多维数组中删除重复值？

示例数组：

```
Array
(
    [0] => Array
    (
        [0] => abc
        [1] => def
    )

    [1] => Array
    (
        [0] => ghi
        [1] => jkl
    )

    [2] => Array
    (
        [0] => mno
        [1] => pql
    )

    [3] => Array
    (
        [0] => abc
        [1] => def
    )

    [4] => Array
    (
        [0] => ghi
        [1] => jkl
    )

    [5] => Array
    (
        [0] => mno
        [1] => pql
    )

) 
```

* * *

## 回答 #1

> 赞同：704
> 
> 时间：2009-06-03T18:12:23.430

这是另一种方式。不保存中间变量。

我们使用它来对来自各种重叠查询的结果进行重复数据删除。

```
$input = array_map("unserialize", array_unique(array_map("serialize", $input))); 
```

* * *

## 回答 #2

> 赞同：281
> 
> 时间：2013-08-22T07:01:44.983

从 5.2.9 开始，[`array_unique()`](https://secure.php.net/manual/en/function.array-unique.php)如果您`SORT_REGULAR`像这样使用标志，则可以使用：

```
array_unique($array, SORT_REGULAR); 
```

这使得函数比较元素是否相等，就好像`$a == $b`正在使用一样，这非常适合您的情况。

**输出**

```
Array
(
    [0] => Array
        (
            [0] => abc
            [1] => def
        )

    [1] => Array
        (
            [0] => ghi
            [1] => jkl
        )

    [2] => Array
        (
            [0] => mno
            [1] => pql
        )

) 
```

但请记住，[文档](https://secure.php.net/manual/en/function.array-unique.php#refsect1-function.array-unique-notes)指出：

> `array_unique()`不适用于多维数组。

* * *

## 回答 #3

> 赞同：67
> 
> 时间：2012-05-09T10:48:18.713

我遇到了类似的问题，但我找到了一个 100% 可行的解决方案。

```
<?php
    function super_unique($array,$key)
    {
       $temp_array = [];
       foreach ($array as &$v) {
           if (!isset($temp_array[$v[$key]]))
           $temp_array[$v[$key]] =& $v;
       }
       $array = array_values($temp_array);
       return $array;

    }

$arr="";
$arr[0]['id']=0;
$arr[0]['titel']="ABC";
$arr[1]['id']=1;
$arr[1]['titel']="DEF";
$arr[2]['id']=2;
$arr[2]['titel']="ABC";
$arr[3]['id']=3;
$arr[3]['titel']="XYZ";

echo "<pre>";
print_r($arr);
echo "unique*********************<br/>";
print_r(super_unique($arr,'titel'));

?> 
```

* * *

## 回答 #4

> 赞同：56
> 
> 时间：2008-11-21T14:36:55.963

其他方式。也将保留密钥。

```
function array_unique_multidimensional($input)
{
    $serialized = array_map('serialize', $input);
    $unique = array_unique($serialized);
    return array_intersect_key($input, $unique);
} 
```

* * *

## 回答 #5

> 赞同：31
> 
> 时间：2018-02-23T06:34:59.953

```
Array
(
    [0] => Array
        (
            [id] => 1
            [name] => john
        )

    [1] => Array
        (
            [id] => 2
            [name] => smith
        )

    [2] => Array
        (
            [id] => 3
            [name] => john
        )

    [3] => Array
        (
            [id] => 4
            [name] => robert
        )

)

$temp = array_unique(array_column($array, 'name'));
$unique_arr = array_intersect_key($array, $temp); 
```

这将从数组中删除重复的名称。按键唯一

* * *

## 回答 #6

> 赞同：25
> 
> 时间：2016-05-20T22:14:52.483

如果“删除重复项”的意思是“删除重复项，但保留一个”，则解决方案可能是先`array_unique(...)`在“标识符列”上应用，然后在原始数组中删除所有已从列数组中删除的键：

```
$array = [
    [
        'id' => '123',
        'foo' => 'aaa',
        'bar' => 'bbb'
    ],
    [
        'id' => '123',
        'foo' => 'ccc',
        'bar' => 'ddd'
    ],
    [
        'id' => '567',
        'foo' => 'eee',
        'bar' => 'fff'
    ]
];

$ids = array_column($array, 'id');
$ids = array_unique($ids);
$array = array_filter($array, function ($key, $value) use ($ids) {
    return in_array($value, array_keys($ids));
}, ARRAY_FILTER_USE_BOTH); 
```

结果是：

```
Array
(
    [0] => Array
        (
            [id] => 123
            [foo] => aaa
            [bar] => bbb
        )

    [2] => Array
        (
            [id] => 567
            [foo] => eee
            [bar] => fff
        )

) 
```

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2008-11-21T03:07:40.563

用户对[array_unique()](http://php.net/array_unique)文档的评论对此有很多解决方案。这是其中之一：

> **kenrbnsn 在 rbnsn dot com**
> 27-Sep-2005 12:09
> 
> 另一个用于多维数组的 Array_Unique。我只在二维数组上对此进行了测试，但它可能会被推广到更多，或者使用递归。
> 
> 此函数使用 serialize、array_unique 和 unserialize 函数来完成这项工作。
> 
> ```
>  function multi_unique($array) {
>     foreach ($array as $k=>$na)
>         $new[$k] = serialize($na);
>     $uniq = array_unique($new);
>     foreach($uniq as $k=>$ser)
>         $new1[$k] = unserialize($ser);
>     return ($new1);
> }
> ```

这是来自[http://ca3.php.net/manual/en/function.array-unique.php#57202](http://ca3.php.net/manual/en/function.array-unique.php#57202)。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2020-10-09T18:07:20.970

我试过这个来删除重复项。

```
$array = array_map("unserialize", array_unique(array_map("serialize", $array))); 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-11-08T07:17:22.437

如果您需要消除特定键上的重复项，例如 mysqli id，这里有一个简单的功能

```
function search_array_compact($data,$key){
    $compact = [];
    foreach($data as $row){
        if(!in_array($row[$key],$compact)){
            $compact[] = $row;
        }
    }
    return $compact;
} 
```

**奖励积分** 您可以传递一个键数组并添加一个外部 foreach，但每个附加键会慢 2 倍。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-01-19T13:22:42.137

唯一多维数组的一种非常简单且合乎逻辑的方法如下，

如果你有这样的数组：

```
Array
(
    [Key1] => Array
        (
            [0] => Value1
            [1] => Value2
            [2] => Value1
            [3] => Value3
            [4] => Value1
        )
    [Key2] => Array
        (
            [0] => Value1
            [1] => Value2
            [2] => Value1
            [3] => Value3
            [4] => Value4
        )
) 
```

用来`foreach`解决这个问题：

```
foreach($array as $k=>$v){
    $unique=array_unique($v);
    $array[$k]=$unique;
} 
```

它会给你以下结果：

```
Array
(
    [Key1] => Array
        (
            [0] => Value1
            [1] => Value2
            [3] => Value3
        )
    [Key2] => Array
        (
            [0] => Value1
            [1] => Value2
            [3] => Value3
            [4] => Value4
        )
) 
```

如果你想重新排列键的顺序，

```
foreach($array as $k=>$v){
    $unique= array_values(array_unique($v));
    $array[$k]=$unique;
} 
```

此操作将为您提供如下排列的键值：

```
Array
(
    [Key1] => Array
        (
            [0] => Value1
            [1] => Value2
            [2] => Value3
        )
    [Key2] => Array
        (
            [0] => Value1
            [1] => Value2
            [2] => Value3
            [3] => Value4
        )
) 
```

我希望这会清除一切。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-08-07T18:45:40.760

如果你有这样的数组：

（用户是数组的名称）

```
Array=>
 [0] => (array)
   'user' => 'john'
   'age' => '23'
 [1] => (array)
  'user' => 'jane'
  'age' => '20'
 [2]=> (array)
  'user' => 'john'
  'age' => '23' 
```

并且您想删除重复项...然后：

```
$serialized = array();
for ($i=0; $i < sizeof($users); $i++) { 
  $test = in_array($users['user'], $serialized);
    if ($test == false) {
      $serialized[] = $users['user'];
    }
 } 
```

可以是一个解决方案：P

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2016-09-01T11:29:33.810

很多人问我如何制作唯一的多维数组。我参考了您的评论，这对我有帮助。

首先，感谢@jeromegamez @daveilers 的解决方案。但是每次我给出答案时，他们都会问我“序列化”和“反序列化”是如何工作的。这就是为什么我想和你分享这个的原因，以便帮助更多的人理解这背后的概念。

我正在解释为什么我们在步骤中使用“序列化”和“反序列化”：

**第一步：将多维数组转换为一维数组**

要将多维数组转换为一维数组，首先要生成数组内部所有元素（包括嵌套数组）的字节流表示。serialize() 函数可以生成一个值的字节流表示。要生成所有元素的字节流表示，请在 array_map() 函数中调用 serialize() 函数作为回调函数。无论多维数组有多少层，结果都将是一个一维数组。

**第 2 步：使值独一无二**

要使这个一维数组唯一，请使用 array_unique() 函数。

**第 3 步：将其还原为多维数组**

虽然数组现在是唯一的，但值看起来像字节流表示。要将其恢复为多维数组，请使用 unserialize() 函数。

```
$input = array_map("unserialize", array_unique(array_map("serialize", $input))); 
```

再次感谢这一切。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-06-19T19:44:11.730

一个易于阅读的解决方案，可能不是最有效的：

```
function arrayUnique($myArray){
    if(!is_array($myArray))
        return $myArray;

    foreach ($myArray as &$myvalue){
        $myvalue=serialize($myvalue);
    }

    $myArray=array_unique($myArray);

    foreach ($myArray as &$myvalue){
        $myvalue=unserialize($myvalue);
    }

    return $myArray;

} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-04-18T19:01:05.647

正如人们所说`array_unique()`的非常慢，这是我用于一级多维数组的片段。

```
$serialized_array = array_map("serialize", $input);

foreach ($serialized_array as $key => $val) {
     $result[$val] = true;
}

$output = array_map("unserialize", (array_keys($result))); 
```

参考第一个用户`array_unique()` [在 php.net 中贡献的功能页面注释](http://php.net/array_unique)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-11-06T23:04:48.500

序列化和唯一的替代方案

```
$test = [
    ['abc','def'],
    ['ghi','jkl'],
    ['mno','pql'],
    ['abc','def'],
    ['ghi','jkl'],
    ['mno','pql'],
];

$result = array_reduce(
    $test,
    function($carry,$item){
        if(!in_array($item,$carry)) {
            array_push($carry,$item);
        }
        return $carry;
    },
    []
);

var_dump($result);

/*
 php unique.php
array(3) {
    [0] =>
        array(2) {
            [0] =>
                string(3) "abc"
            [1] =>
                string(3) "def"
        }
    [1] =>
        array(2) {
            [0] =>
                string(3) "ghi"
            [1] =>
                string(3) "jkl"
        }
    [2] =>
        array(2) {
              [0] =>
                  string(3) "mno"
              [1] =>
                  string(3) "pql"
        }
} 
```

*/

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-11-29T17:08:48.070

如果你有这样的数组

```
data = array
(
[0] => array
(
    [subject] => a
    [object] => c
),
[1] => array
(
    [subject] => b
    [object] => d
),
[2] => array
(
    [subject] => d
    [object] => b
),
[3] => array
(
    [subject] => d
    [object] => c
),
[4] => array
(
    [subject] => c
    [object] => a
),
[5] => array
(
    [subject] => c
    [object] => d
)
) 
```

你想得到这样的数组：

```
data = array
(
[0] => array
(
    [subject] => a
    [object] => c
),
[1] => array
(
    [subject] => b
    [object] => d
),
[2] => array
(
    [subject] => d
    [object] => c
)
) 
```

或者

```
data = array
(
[0] => array
(
    [subject] => d
    [object] => b
),
[1] => array
(
    [subject] => c
    [object] => a
),
[2] => array
(
    [subject] => c
    [object] => d
)
) 
```

以下代码可以提供帮助

```
 $data1 = array();
    $data1 = $data;
    for($q=0;$q<count($data);$q++)
    {
            for($p=0;$p<count($data1);$p++)
            {
                    if (($data[$q]["subject"] == $data1[$p]["object"]) && ($data[$q]["object"] == $data1[$p]["subject"]))
                    {
                            $data1[$p]["subject"] = $data[$q]["subject"];
                            $data1[$p]["object"] = $data[$q]["object"];
                    }
            }
    }
    $data1 = array_values(array_map("unserialize", array_unique(array_map("serialize", $data1))));
    $data = $data1; 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-03-05T14:04:48.637

我对这个问题进行了很多思考，并确定最佳解决方案应该遵循两个规则。

1.  为了可扩展性，就地修改阵列；不复制到新数组
2.  为了性能，每个比较应该只进行一次

考虑到这一点并考虑到 PHP 的所有怪癖，下面是我想出的解决方案。与其他一些答案不同，它能够根据您想要的任何键删除元素。输入数组应为数字键。

```
$count_array = count($input);
for ($i = 0; $i < $count_array; $i++) {
    if (isset($input[$i])) {
        for ($j = $i+1; $j < $count_array; $j++) {
            if (isset($input[$j])) {
                //this is where you do your comparison for dupes
                if ($input[$i]['checksum'] == $input[$j]['checksum']) {
                    unset($input[$j]);
                }
            }
        }
    }
} 
```

唯一的缺点是迭代完成时键不按顺序排列。如果您随后只使用 foreach 循环，这不是问题，但如果您需要使用 for 循环，您可以`$input = array_values($input);`在上面放置以重新编号键。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2020-02-14T11:01:54.377

根据标记为正确的答案，添加我的答案。添加的小代码只是为了重置索引-

```
$input = array_values(array_map("unserialize", array_unique(array_map("serialize", $inputArray)))); 
```

# version-control - 是否可以在 TFS 中实现预先测试的提交？

> ID：307676
> 
> 赞同：0
> 
> 时间：2008-11-21T02:52:50.813
> 
> 标签：version-control, tfs, teamcity

我对 TeamCity 中预测试提交的想法很感兴趣（即在允许签入之前验证它们不会破坏构建），我想知道是否有任何方法可以在 TFS 中实现这一点。看起来 TeamCity 可以作为后备存储与 TFS 版本控制接口，但我当然更喜欢免费的解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T09:26:58.147

在 TFS 中存在[签入策略](http://msdn.microsoft.com/en-us/library/ms181281(VS.80).aspx)的概念，您可以在其中执行代码并在允许签入发生之前验证签入。但是 - 您所追求的听起来更像是“门控签入”的概念，其中在签入提交到主代码库之前在中央构建服务器上尝试构建。查看 CodePlex 上的[BuddyBuild](http://www.codeplex.com/BuddyBuild)项目，以在当前版本的 TFS 中添加该功能。

在 TFS 2010 中，门控签入构建将成为开箱即用的功能。

# javascript - 使用 jQuery，在上传前限制文件大小

> ID：307679
> 
> 赞同：50
> 
> 时间：2008-11-21T02:54:04.727
> 
> 标签：javascript, jquery, image, jquery-plugins, upload

在 PHP 上，他们有办法在上传之后限制文件大小，而不是在上传之前。我使用[Malsup jQuery Form Plugin](http://malsup.com/jquery/form/)进行表单发布，它支持图像文件发布。

我想知道是否有一个限制，我可以设置多少字节可以通过该 AJAX 流到达服务器？这可以让我检查文件大小并在文件太大时返回错误。

通过在客户端执行此操作，它会阻止那些从宾得拍摄 10MB 照片并尝试上传的新手。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2012-02-02T02:23:07.030

这是我在一个非常相似的问题中的答案的副本：[如何使用 jQuery 检查文件输入大小？](https://stackoverflow.com/questions/1601455/check-file-input-size-with-jquery/3937404#3937404)

* * *

您实际上无权访问文件系统（例如读取和写入本地文件）。但是，由于 HTML5 文件 API 规范，您确实可以访问一些文件属性，文件大小就是其中之一。

对于这个 HTML：

```
<input type="file" id="myFile" /> 
```

尝试以下操作：

```
//binds to onchange event of your input field
$('#myFile').bind('change', function() {
  //this.files[0].size gets the size of your file.
  alert(this.files[0].size);
}); 
```

由于它是 HTML5 规范的一部分，它只适用于现代浏览器（IE 需要 v10），我[在这里](http://felipe.sabino.me/javascript/2012/01/30/javascipt-checking-the-file-size/)添加了更多详细信息和有关您应该知道的其他文件信息的链接：http: [//felipe.sabino.me/javascript /2012/01/30/javascipt-checking-the-file-size/](http://felipe.sabino.me/javascript/2012/01/30/javascipt-checking-the-file-size/)

* * *

**旧浏览器支持**

请注意，旧浏览器将返回`null`上一次调用的值`this.files`，因此访问`this.files[0]`会引发异常，您应该在使用之前[检查文件 API 支持](https://stackoverflow.com/a/20550591/429521)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-21T02:59:16.713

除非您使用 flash、activex 或 java 上传器，否则我认为这是不可能的。

出于安全原因，在上传之前或上传期间，不允许 ajax / javascript 访问文件流或文件属性。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-03-26T19:22:53.653

我以这种方式尝试过，我在 IE* 和 Mozilla 3.6.16 中得到了结果，没有检查旧版本。

```
<img id="myImage" src="" style="display:none;"><br>
<button onclick="findSize();">Image Size</button>
<input type="file" id="loadfile" />
<input type="button" value="find size" onclick="findSize()" />
<script type="text/javascript">
function findSize() {
    if ( $.browser.msie ) {
       var a = document.getElementById('loadfile').value;
           $('#myImage').attr('src',a);
           var imgbytes = document.getElementById('myImage').size;
           var imgkbytes = Math.round(parseInt(imgbytes)/1024);
           alert(imgkbytes+' KB');
    }else {
           var fileInput = $("#loadfile")[0];
           var imgbytes = fileInput.files[0].fileSize; // Size returned in bytes.
           var imgkbytes = Math.round(parseInt(imgbytes)/1024);
                   alert(imgkbytes+' KB');
     }
}    
</script> 
```

还添加 Jquery 库。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-21T03:31:44.120

我遇到了同样的问题。您必须使用 ActiveX 或 Flash（或 Java）。好处是它不必是侵入性的。我有一个简单的 ActiveX 方法，它将返回要上传文件的大小。

如果你使用 Flash，你甚至可以做一些花哨的 js/css 来定制上传体验——只使用 Flash（作为 1x1“电影”）来访问它的文件上传功能。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-21T04:27:04.680

我发现 Apache2（您可能还想检查 Apache 1.5）有一种方法可以在上传之前通过将其放入 .htaccess 文件中来限制它：

限制请求体 2097152

这在文件上传时将其限制为 2 兆字节（2 * 1024 * 1024）（如果我正确地进行了字节数学运算）。

请注意，当您执行此操作时，当您在表单发布或获取请求上超过此限制时，Apache 错误日志将生成此条目：

```
Requested content-length of 4000107 is larger than the configured limit of 2097152 
```

它还将在 Web 浏览器中显示此消息：

```
<h1>Request Entity Too Large</h1> 
```

因此，如果您正在使用 Malsup jQuery 表单插件之类的东西进行 AJAX 表单发布，您可以像这样捕获 H1 响应并显示错误结果。

顺便说一句，返回的错误号是 413。因此，您可以在 .htaccess 文件中使用指令，例如...

```
Redirect 413 413.html 
```

...并提供更优雅的错误结果。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2014-09-09T06:05:02.750

```
 $(".jq_fileUploader").change(function () {
    var fileSize = this.files[0];
    var sizeInMb = fileSize.size/1024;
    var sizeLimit= 1024*10;
    if (sizeInMb > sizeLimit) {

    }
    else {

    }
  }); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-10-30T21:31:32.640

正如其他人所说，由于 JavaScript 的安全模型，仅使用 JavaScript 是不可能的。

如果可以的话，我会推荐以下解决方案之一。两者都使用 Flash 组件进行客户端验证；但是，使用 Javascript/jQuery 进行连接。两者都工作得很好，可以与任何服务器端技术一起使用。

[http://www.uploadify.com/](http://www.uploadify.com/)

[http://swfupload.org/](http://swfupload.org/)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-08-06T11:13:22.757

试试下面的代码：

```
var sizeInKB = input.files[0].size/1024; //Normally files are in bytes but for KB divide by 1024 and so on
var sizeLimit= 30;

if (sizeInKB >= sizeLimit) {
    alert("Max file size 30KB");
    return false;
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-07-14T03:11:46.133

无法在客户端验证图像大小、宽度或高度。您需要将此文件上传到服务器并使用 PHP 来验证所有这些信息。PHP具有特殊功能，例如：`getimagesize()`

```
list($width, $height, $type, $attr) = getimagesize("img/flag.jpg");
echo "<img src=\"img/flag.jpg\" $attr alt=\"getimagesize() example\" />"; 
```

# iphone - 保存/加载 iphone 游戏数据的最佳方法

> ID：307681
> 
> 赞同：2
> 
> 时间：2008-11-21T02:54:35.770
> 
> 标签：iphone, cocoa-touch, archiving

我正在开发一款益智游戏，游戏引擎拥有复杂的对象层次结构，从游戏角色到矢量再到过渡动画。根据游戏状态，它们可能加起来从 10 到 1000（在极端情况下）。我一直在推迟这一刻，直到我不得不着手保存和加载所有这些烂摊子，因为我没有这方面的经验，但现在我担心的那一刻即将到来。

为此使用 NSKeyedArchiver 是个好主意吗？它的概念似乎很强大。这样我就可以重建对象状态，但这是否包括已保存对象之间的指针？它在性能方面的表现如何？系统是否有时间在应用程序终止时将所有这些对象保存在磁盘上？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T03:25:26.660

NSKeyedArchiver 非常强大，但它不会让您保留对象之间的链接（除非您在取消归档后自己添加它们）。如果您可以/需要以原子方式存储整个数据集，那么 NSKeyedArchiver 可能是要走的路，但如果有任何比父子关系更复杂的事情，您将需要进行一些“重新水化”。

我们有一个复杂的数据对象层次结构，我们将它们存储到 SQLite 数据库中，并在提取它们时重新连接它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-16T03:58:50.587

我选择了 NSKeyedArchiver，它确实维护对象之间的引用。请参见此处：[归档互连对象的简单方法](https://stackoverflow.com/questions/1085316/easy-way-to-archive-interlinked-objects)

# sharepoint - 使用 Active Directory 对 Sharepoint 进行身份验证？

> ID：307684
> 
> 赞同：2
> 
> 时间：2008-11-21T02:57:29.167
> 
> 标签：sharepoint, active-directory

只需使用 find 一种简单的方法让 AD 验证为 Sharepoint 站点的登录名。这相当快速和简单的开始？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T03:30:10.067

对于 SharePoint 2007，请参阅这篇[文章](http://technet.microsoft.com/en-us/library/cc262350.aspx)。您可能希望将其设置为使用 NTLM 进行 Windows 集成身份验证。获得身份验证工作可能并不太难，以您希望的方式设置您的站点并使用权限/授权工作可能不是。取决于您的网站有多复杂。我没有直接参与，但我知道我们花了几个月的时间来建立我们的内部网并消除错误。

我的一项建议是使用 AD 组或包含 AD 组而不是个人的 SharePoint 组来控制访问。当个人离开时清理 AD 组成员身份比追踪您授予他们个人访问权限的所有位置（包括 SharePoint 组中的成员身份）要容易得多。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T07:06:54.280

在安装 SharePoint 之前，您需要您的服务器成为域的一部分。

如果这样做，默认配置将是 AD 身份验证。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-24T15:16:33.947

这是对 SharePoint 安全链接的体面讨论

[http://blogs.msdn.com/joelo/archive/2007/06/29/sharepoint-groups-permissions-site-security-and-depreciated-site-groups.aspx](http://blogs.msdn.com/joelo/archive/2007/06/29/sharepoint-groups-permissions-site-security-and-depreciated-site-groups.aspx)

本质上，您需要将用户添加到适当的 SharePoint 组。站点的默认值通常为 xxx_Visitor、xxx_Members 和 xxx_Owners，每个组的安全权限都在增加。

您可以将 AD 域添加到这些组，也可以添加单个 AD 用户

# windows - 2.0 等效的 WCF 服务

> ID：307685
> 
> 赞同：0
> 
> 时间：2008-11-21T02:57:56.293
> 
> 标签：windows, wcf, service

在 Windows 服务中托管 WCF 服务主机似乎是与正在运行的 Windows 服务进行通信的一种非常简单的方法……如果您正在运行 3.0/3.5。

如果这就是您所坚持的，那么从 2.0 框架中获得相同类型的东西的最简单方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T03:09:58.923

您可以托管[远程](http://msdn.microsoft.com/en-us/library/kwdt6w2k(VS.80).aspx)服务。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T03:36:22.753

IIS 中托管的[ASMX Web 服务](http://support.microsoft.com/default.aspx/kb/308359)

# c# - 如何从 C# 中的 URL 下载文件？

> ID：307688
> 
> 赞同：428
> 
> 时间：2008-11-21T02:59:18.710
> 
> 标签：c#, file, url

从 URL 路径下载文件的简单方法是什么？

* * *

## 回答 #1

> 赞同：568
> 
> 时间：2008-11-21T10:12:33.390

```
using (var client = new WebClient())
{
    client.DownloadFile("http://example.com/file/song/a.mpeg", "a.mpeg");
} 
```

* * *

## 回答 #2

> 赞同：228
> 
> 时间：2015-03-21T16:39:23.750

包括这个命名空间

```
using System.Net; 
```

**异步**下载并放置一个**ProgressBar**以在 UI 线程本身内显示下载状态

```
private void BtnDownload_Click(object sender, RoutedEventArgs e)
{
    using (WebClient wc = new WebClient())
    {
        wc.DownloadProgressChanged += wc_DownloadProgressChanged;
        wc.DownloadFileAsync (
            // Param1 = Link of file
            new System.Uri("http://www.sayka.com/downloads/front_view.jpg"),
            // Param2 = Path to save
            "D:\\Images\\front_view.jpg"
        );
    }
}
// Event to track the progress
void wc_DownloadProgressChanged(object sender, DownloadProgressChangedEventArgs e)
{
    progressBar.Value = e.ProgressPercentage;
} 
```

* * *

## 回答 #3

> 赞同：89
> 
> 时间：2008-11-21T03:04:59.993

使用[`System.Net.WebClient.DownloadFile`](http://msdn.microsoft.com/en-us/library/ez801hhe.aspx)：

```
string remoteUri = "http://www.contoso.com/library/homepage/images/";
string fileName = "ms-banner.gif", myStringWebResource = null;

// Create a new WebClient instance.
using (WebClient myWebClient = new WebClient())
{
    myStringWebResource = remoteUri + fileName;
    // Download the Web resource and save it into the current filesystem folder.
    myWebClient.DownloadFile(myStringWebResource, fileName);        
} 
```

* * *

## 回答 #4

> 赞同：47
> 
> 时间：2013-06-29T16:14:37.833

```
using System.Net;

WebClient webClient = new WebClient();
webClient.DownloadFile("http://mysite.com/myfile.txt", @"c:\myfile.txt"); 
```

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2016-03-11T09:11:48.067

**完成课程以在将状态打印到控制台时下载文件。**

```
using System;
using System.ComponentModel;
using System.IO;
using System.Net;
using System.Threading;

class FileDownloader
{
    private readonly string _url;
    private readonly string _fullPathWhereToSave;
    private bool _result = false;
    private readonly SemaphoreSlim _semaphore = new SemaphoreSlim(0);

    public FileDownloader(string url, string fullPathWhereToSave)
    {
        if (string.IsNullOrEmpty(url)) throw new ArgumentNullException("url");
        if (string.IsNullOrEmpty(fullPathWhereToSave)) throw new ArgumentNullException("fullPathWhereToSave");

        this._url = url;
        this._fullPathWhereToSave = fullPathWhereToSave;
    }

    public bool StartDownload(int timeout)
    {
        try
        {
            System.IO.Directory.CreateDirectory(Path.GetDirectoryName(_fullPathWhereToSave));

            if (File.Exists(_fullPathWhereToSave))
            {
                File.Delete(_fullPathWhereToSave);
            }
            using (WebClient client = new WebClient())
            {
                var ur = new Uri(_url);
                // client.Credentials = new NetworkCredential("username", "password");
                client.DownloadProgressChanged += WebClientDownloadProgressChanged;
                client.DownloadFileCompleted += WebClientDownloadCompleted;
                Console.WriteLine(@"Downloading file:");
                client.DownloadFileAsync(ur, _fullPathWhereToSave);
                _semaphore.Wait(timeout);
                return _result && File.Exists(_fullPathWhereToSave);
            }
        }
        catch (Exception e)
        {
            Console.WriteLine("Was not able to download file!");
            Console.Write(e);
            return false;
        }
        finally
        {
            this._semaphore.Dispose();
        }
    }

    private void WebClientDownloadProgressChanged(object sender, DownloadProgressChangedEventArgs e)
    {
        Console.Write("\r     -->    {0}%.", e.ProgressPercentage);
    }

    private void WebClientDownloadCompleted(object sender, AsyncCompletedEventArgs args)
    {
        _result = !args.Cancelled;
        if (!_result)
        {
            Console.Write(args.Error.ToString());
        }
        Console.WriteLine(Environment.NewLine + "Download finished!");
        _semaphore.Release();
    }

    public static bool DownloadFile(string url, string fullPathWhereToSave, int timeoutInMilliSec)
    {
        return new FileDownloader(url, fullPathWhereToSave).StartDownload(timeoutInMilliSec);
    }
} 
```

**用法：**

```
static void Main(string[] args)
{
    var success = FileDownloader.DownloadFile(fileUrl, fullPathWhereToSave, timeoutInMilliSec);
    Console.WriteLine("Done  - success: " + success);
    Console.ReadLine();
} 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2018-01-11T11:20:31.703

尝试使用这个：

```
private void downloadFile(string url)
{
     string file = System.IO.Path.GetFileName(url);
     WebClient cln = new WebClient();
     cln.DownloadFile(url, file);
} 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2014-06-16T06:02:06.783

您也可以在 WebClient 类中使用 DownloadFileAsync 方法。它将具有指定 URI 的资源下载到本地文件。此方法也不会阻塞调用线程。

样本：

```
 webClient.DownloadFileAsync(new Uri("http://www.example.com/file/test.jpg"), "test.jpg"); 
```

**了解更多信息：**

[http://csharpexamples.com/download-files-synchronous-asynchronous-url-c/](http://csharpexamples.com/download-files-synchronous-asynchronous-url-c/)

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2016-02-15T18:32:19.347

检查网络连接，`GetIsNetworkAvailable()`以避免在未连接到网络时创建空文件。

```
if (System.Net.NetworkInformation.NetworkInterface.GetIsNetworkAvailable())
{
    using (System.Net.WebClient client = new System.Net.WebClient())
    {                        
          client.DownloadFileAsync(new Uri("http://www.examplesite.com/test.txt"),
          "D:\\test.txt");
    }                  
} 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2017-10-30T14:07:49.753

下面的代码包含使用原始名称下载文件的逻辑

```
private string DownloadFile(string url)
    {

        HttpWebRequest request = (HttpWebRequest)HttpWebRequest.Create(url);
        string filename = "";
        string destinationpath = Environment;
        if (!Directory.Exists(destinationpath))
        {
            Directory.CreateDirectory(destinationpath);
        }
        using (HttpWebResponse response = (HttpWebResponse)request.GetResponseAsync().Result)
        {
            string path = response.Headers["Content-Disposition"];
            if (string.IsNullOrWhiteSpace(path))
            {
                var uri = new Uri(url);
                filename = Path.GetFileName(uri.LocalPath);
            }
            else
            {
                ContentDisposition contentDisposition = new ContentDisposition(path);
                filename = contentDisposition.FileName;

            }

            var responseStream = response.GetResponseStream();
            using (var fileStream = File.Create(System.IO.Path.Combine(destinationpath, filename)))
            {
                responseStream.CopyTo(fileStream);
            }
        }

        return Path.Combine(destinationpath, filename);
    } 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2021-04-23T06:56:01.023

WebClient 已过时

如果要下载到文件，请避免先使用`ResponseHeadersRead`以下方式读取内存：

```
static public async Task HttpDownloadFileAsync(HttpClient httpClient, string url, string fileToWriteTo) {
  using HttpResponseMessage response = await httpClient.GetAsync(url, HttpCompletionOption.ResponseHeadersRead);
  using Stream streamToReadFrom = await response.Content.ReadAsStreamAsync(); 
  using Stream streamToWriteTo = File.Open(fileToWriteTo, FileMode.Create); 
  await streamToReadFrom.CopyToAsync(streamToWriteTo);
} 
```

上面的代码更像是一个大纲，添加正确的错误/异常处理不是微不足道的，进度报告也不是微不足道的，处置也是如此。

我想出了一组 C# 9.0 扩展类`DownoadFileAsync`，`GetToStringAsync`和`PostToStringAsync`

```
namespace System.Net.Http {

  // HttpResponse is in one of 3 states:
  // - ResponseMessageInfo is object && ResponseMessageInfo.IsSuccessStatusCode -> success, inspect ResponseMessageInfo for StatusCode etc
  // - ResponseMessageInfo is object && !ResponseMessageInfo.IsSuccessStatusCode -> failure, inspect ResponseMessageInfo for StatusCode, ReasonPhrase etc
  // - ResponseMessageInfo is null -> exception, inspect ExceptionInfo fields
  public record HttpResponse {

    // copies of HttpRequestMessage and HttpResponseMessage which do not have the content and do not need to be disposed
    public record HttpRequestMessageInfo(HttpRequestHeaders Headers, HttpMethod Method, HttpRequestOptions Options, Uri? RequestUri, Version Version, HttpVersionPolicy VersionPolicy);
    public record HttpResponseMessageInfo(HttpResponseHeaders Headers, bool IsSuccessStatusCode, string? ReasonPhrase, HttpRequestMessageInfo RequestMessage, HttpStatusCode StatusCode, HttpResponseHeaders TrailingHeaders, Version Version);

    // holds Http exception information
    public record HttpExceptionInfo(HttpRequestMessageInfo HttpRequestMessage, string ErrorMessage, WebExceptionStatus? WebExceptionStatus);

    // if ResponseMessageInfo is null ExceptionInfo is not and vice versa
    public HttpResponseMessageInfo? ResponseMessageInfo { get; init; }
    public HttpExceptionInfo? ExceptionInfo { get; init; }

    public HttpResponse(HttpRequestMessage requestMessage, HttpResponseMessage responseMessage) {
      var requestMessageInfo = new HttpRequestMessageInfo(requestMessage.Headers, requestMessage.Method, requestMessage.Options, requestMessage.RequestUri, requestMessage.Version, requestMessage.VersionPolicy);
      ResponseMessageInfo = new(responseMessage.Headers, responseMessage.IsSuccessStatusCode, responseMessage.ReasonPhrase, requestMessageInfo, responseMessage.StatusCode, responseMessage.TrailingHeaders, responseMessage.Version);
      ExceptionInfo = null;
    }

    public HttpResponse(HttpRequestMessage requestMessage, Exception exception) {
      ResponseMessageInfo = null;
      var requestMessageInfo = new HttpRequestMessageInfo(requestMessage.Headers, requestMessage.Method, requestMessage.Options, requestMessage.RequestUri, requestMessage.Version, requestMessage.VersionPolicy);

      if (exception is WebException ex1 && ex1.Status == WebExceptionStatus.ProtocolError) {
        using HttpWebResponse? httpResponse = (HttpWebResponse?)ex1.Response;
        ExceptionInfo = new(requestMessageInfo, httpResponse?.StatusDescription ?? "", ex1.Status);
      } 
      else if (exception is WebException ex2) ExceptionInfo = new(requestMessageInfo, ex2.FullMessage(), ex2.Status);
      else if (exception is TaskCanceledException ex3 && ex3.InnerException is TimeoutException) ExceptionInfo = new(requestMessageInfo, ex3.InnerException.FullMessage(), WebExceptionStatus.Timeout);
      else if (exception is TaskCanceledException ex4) ExceptionInfo = new(requestMessageInfo, ex4.FullMessage(), WebExceptionStatus.RequestCanceled);
      else ExceptionInfo = new(requestMessageInfo, exception.FullMessage(), null);
    }

    public override string ToString() {
      if (ResponseMessageInfo is object) {
        var msg = ResponseMessageInfo.IsSuccessStatusCode ? "Success" : "Failure";
        msg += $" {Enum.GetName(typeof(HttpStatusCode), ResponseMessageInfo.StatusCode)}";
        if (ResponseMessageInfo.ReasonPhrase is object) msg += $" {ResponseMessageInfo.ReasonPhrase}";
        return msg;

      } else if (ExceptionInfo is object) {
        var msg = "Failure";
        msg += $" {ExceptionInfo.ErrorMessage}";
        if (ExceptionInfo.WebExceptionStatus is object) msg += $" {Enum.GetName(typeof(WebExceptionStatus), ExceptionInfo.WebExceptionStatus)}";
        return msg;
      }
      return "NA"; // never reach here
    }
  }

  public static class ExtensionMethods {

    // progressCallback recieves (bytesRecieved, percent, speedKbSec) and can return false to cancell download
    public static async Task<(bool success, HttpResponse httpResponse)> DownloadFileAsync(this HttpClient httpClient, Uri requestUri, string fileToWriteTo, CancellationTokenSource? cts = null, Func<long, int, float, bool>? progressCallback = null) {
      var httpRequestMessage = new HttpRequestMessage { Method = HttpMethod.Get, RequestUri = requestUri };
      var created = false;

      try {
        var cancellationToken = cts?.Token ?? default;

        using HttpResponseMessage httpResponseMessage = await httpClient.SendAsync(httpRequestMessage, HttpCompletionOption.ResponseHeadersRead, cancellationToken);
        if (!httpResponseMessage.IsSuccessStatusCode) return (false, new(httpRequestMessage, httpResponseMessage));
        var contentLength = httpResponseMessage.Content.Headers.ContentLength;

        using Stream streamToReadFrom = await httpResponseMessage.Content.ReadAsStreamAsync();
        using Stream streamToWriteTo = File.Open(fileToWriteTo, FileMode.Create);
        created = true;

        var buffer = new byte[81920]; 
        var bytesRecieved = (long)0;
        var stopwatch = Stopwatch.StartNew();
        int bytesInBuffer;
        while ((bytesInBuffer = await streamToReadFrom.ReadAsync(buffer, cancellationToken)) != 0) {
          await streamToWriteTo.WriteAsync(buffer.AsMemory(0, bytesInBuffer), cancellationToken);
          bytesRecieved += bytesInBuffer;
          if (progressCallback is object) {
            var percent = contentLength is object && contentLength != 0 ? (int)Math.Floor(bytesRecieved / (float)contentLength * 100.0) : 0;
            var speedKbSec = (float)((bytesRecieved / 1024.0) / (stopwatch.ElapsedMilliseconds / 1000.0));
            var proceed = progressCallback(bytesRecieved, percent, speedKbSec);
            if (!proceed) {
              httpResponseMessage.ReasonPhrase = "Callback cancelled download";
              httpResponseMessage.StatusCode = HttpStatusCode.PartialContent;
              return (false, new(httpRequestMessage, httpResponseMessage));
            }
          }
        }

        return (true, new(httpRequestMessage, httpResponseMessage));
      }
      catch (Exception ex) {
        if (created) try { File.Delete(fileToWriteTo); } catch { };
        return (false, new(httpRequestMessage, ex));
      }
    }

    public static async Task<(string? ResponseAsString, HttpResponse httpResponse)> GetToStringAsync(this HttpClient httpClient, Uri requestUri, CancellationTokenSource? cts = null) {
      var httpRequestMessage = new HttpRequestMessage { Method = HttpMethod.Get, RequestUri = requestUri };
      try {
        var cancellationToken = cts?.Token ?? default;
        using var httpResponseMessage = await httpClient.SendAsync(httpRequestMessage, cancellationToken);
        if (!httpResponseMessage.IsSuccessStatusCode) return (null, new(httpRequestMessage, httpResponseMessage));

        var responseAsString = await httpResponseMessage.Content.ReadAsStringAsync();
        return (responseAsString, new(httpRequestMessage, httpResponseMessage));
      }
      catch (Exception ex) {
        return (null, new(httpRequestMessage, ex)); ;
      }
    }

    public static async Task<(string? ResponseAsString, HttpResponse httpResponse)> PostToStringAsync(this HttpClient httpClient, Uri requestUri, HttpContent postBuffer, CancellationTokenSource? cts = null) {
      var httpRequestMessage = new HttpRequestMessage { Method = HttpMethod.Post, RequestUri = requestUri, Content = postBuffer };
      try {
        var cancellationToken = cts?.Token ?? default;
        using var httpResponseMessage = await httpClient.SendAsync(httpRequestMessage, cancellationToken);
        if (!httpResponseMessage.IsSuccessStatusCode) return (null, new(httpRequestMessage, httpResponseMessage));

        var responseAsString = await httpResponseMessage.Content.ReadAsStringAsync();
        return (responseAsString, new(httpRequestMessage, httpResponseMessage));
      }
      catch (Exception ex) {
        return (null, new(httpRequestMessage, ex));
      }
    }

  }
}

namespace System {
  public static class ExtensionMethods {
    public static string FullMessage(this Exception ex) {
      if (ex is AggregateException aex) return aex.InnerExceptions.Aggregate("[ ", (total, next) => $"{total}[{next.FullMessage()}] ") + "]";
      var msg = ex.Message.Replace(", see inner exception.", "").Trim();
      var innerMsg = ex.InnerException?.FullMessage();
      if (innerMsg is object && innerMsg!=msg) msg = $"{msg} [ {innerMsg} ]";
      return msg;
    }
  }
} 
```

要使用：

```
// download to file
var lastPercent = 0;
bool progressCallback(long bytesRecieved, int percent, float speedKbSec) {
  if (percent > lastPercent) {
    lastPercent = percent;
    Log($"Downloading... {percent}% {speedKbSec/1024.0:0.00}Mbps");
  }
  return true;
}

var (success, httpResponse) = await httpClient.DownloadFileAsync(
  new(myUrlString), 
  localFileName, 
  null, // CancellationTokenSource 
  progressCallback
);

if (success) {
  // file downloaded to localFile, httpResponse.ResponseMessageInfo contain 
  // extra information ie headers and status code

} else {
  Log(httpResponse.ToString()); // human friendly error information
  // if httpResponse.ResponseMessageInfo is object then server refused the request - 
  // examine httpResponse.ResponseMessageInfo.HttpStatusCode etc
  // else we had a Http exception - examine httpResponse.ExceptionInfo 
}

// Http get
var (responseAsString, httpResponse) = await httpClient.GetToStringAsync(url);
if (responseAsString is object) {
  // responseAsString contains the string response from the server

} else {
  // as for DownloadFileAsync
}

// http post
var postBuffer = new StringContent(jsonInString, System.Text.Encoding.UTF8, "application/x-www-form-urlencoded");
var (responseAsString, httpResponse) = await httpClient.PostToStringAsync(url, postBuffer);

if (responseAsString is object) {
  // responseAsString contains the string response from the server

} else {
  Log(httpResponse.ToString()); // human friendly error informaiton
  // as for DownloadFileAsync
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2019-09-23T10:36:53.433

根据我的研究，我发现这[`WebClient.DownloadFileAsync`](https://docs.microsoft.com/en-us/dotnet/api/system.net.webclient.downloadfile)是下载文件的最佳方式。它在`System.Net`命名空间中可用，它也支持 .net 核心。

这是下载文件的示例代码。

```
using System;
using System.IO;
using System.Net;
using System.ComponentModel;

public class Program
{
    public static void Main()
    {
        new Program().Download("ftp://localhost/test.zip");
    }
    public void Download(string remoteUri)
    {
        string FilePath = Directory.GetCurrentDirectory() + "/tepdownload/" + Path.GetFileName(remoteUri); // path where download file to be saved, with filename, here I have taken file name from supplied remote url
        using (WebClient client = new WebClient())
        {
            try
            {
                if (!Directory.Exists("tepdownload"))
                {
                    Directory.CreateDirectory("tepdownload");
                }
                Uri uri = new Uri(remoteUri);
                //password username of your file server eg. ftp username and password
                client.Credentials = new NetworkCredential("username", "password");
                //delegate method, which will be called after file download has been complete.
                client.DownloadFileCompleted += new AsyncCompletedEventHandler(Extract);
                //delegate method for progress notification handler.
                client.DownloadProgressChanged += new DownloadProgressChangedEventHandler(ProgessChanged);
                // uri is the remote url where filed needs to be downloaded, and FilePath is the location where file to be saved
                client.DownloadFileAsync(uri, FilePath);
            }
            catch (Exception)
            {
                throw;
            }
        }
    }
    public void Extract(object sender, AsyncCompletedEventArgs e)
    {
        Console.WriteLine("File has been downloaded.");
    }
    public void ProgessChanged(object sender, DownloadProgressChangedEventArgs e)
    {
        Console.WriteLine($"Download status: {e.ProgressPercentage}%.");
    }
} 
```

上面的代码文件将被下载`tepdownload`到项目目录的文件夹中。请阅读代码中的注释以了解上述代码的作用。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-08-11T14:11:04.850

您可能需要在文件下载期间了解状态并更新 ProgressBar，或在发出请求之前使用凭据。

这是一个涵盖这些选项的示例。已使用**Lambda 表示法**和**字符串插值：**

```
using System.Net;
// ...

using (WebClient client = new WebClient()) {
    Uri ur = new Uri("http://remotehost.do/images/img.jpg");

    //client.Credentials = new NetworkCredential("username", "password");
    String credentials = Convert.ToBase64String(Encoding.ASCII.GetBytes("Username" + ":" + "MyNewPassword"));
    client.Headers[HttpRequestHeader.Authorization] = $"Basic {credentials}";

    client.DownloadProgressChanged += (o, e) =>
    {
        Console.WriteLine($"Download status: {e.ProgressPercentage}%.");

        // updating the UI
        Dispatcher.Invoke(() => {
            progressBar.Value = e.ProgressPercentage;
        });
    };

    client.DownloadDataCompleted += (o, e) => 
    {
        Console.WriteLine("Download finished!");
    };

    client.DownloadFileAsync(ur, @"C:\path\newImage.jpg");
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-04-19T19:47:17.197

如果您需要设置**标头**和**Cookie**来下载文件，您需要做的事情稍有不同。这是一个*例子*......

```
// Pass in the HTTPGET URL, Full Path w/Filename, and a populated Cookie Container (optional)
private async Task DownloadFileRequiringHeadersAndCookies(string getUrl, string fullPath, CookieContainer cookieContainer, CancellationToken cancellationToken)
{
    cookieContainer ??= new CookieContainer();  // TODO: FILL ME AND PASS ME IN

    using (var handler = new HttpClientHandler()
    {
        UseCookies = true,
        CookieContainer = cookieContainer, // This will, both, use the cookies passed in, and update/create cookies from the response
        ServerCertificateCustomValidationCallback = (message, cert, chain, errors) => true, // use only if it gets angry about the SSL endpoints
        AllowAutoRedirect = true,
    })
    {
        using (var client = new HttpClient(handler))
        {
            SetHeaders(client);

            using (var response = await client.GetAsync(getUrl, cancellationToken))
            {
                if (response.IsSuccessStatusCode)
                {
                    var bytes = await response.Content.ReadAsByteArrayAsync(cancellationToken);
                    await File.WriteAllBytesAsync(fullPath, bytes, cancellationToken); // This overwrites the file
                }
                else
                {
                    // TODO: HANDLE ME
                    throw new FileNotFoundException();
                }
            }
        }
    }
} 
```

而且，要添加您需要的标题...

```
private void SetHeaders(HttpClient client)
{
    // TODO: SET ME
    client.DefaultRequestHeaders.Connection.Add("keep-alive");
    client.DefaultRequestHeaders.Add("User-Agent", "Mozilla/5.0 (Windows NT 10.0; Win64; x64) ...");
    client.DefaultRequestHeaders.Add("Accept", "text/html,application/xhtml+xml,application/xml;q=0.9, ...");
    client.DefaultRequestHeaders.AcceptEncoding.Add(new StringWithQualityHeaderValue("gzip"));
    client.DefaultRequestHeaders.AcceptEncoding.Add(new StringWithQualityHeaderValue("deflate"));
    client.DefaultRequestHeaders.AcceptLanguage.Add(new StringWithQualityHeaderValue("en-US"));
    client.DefaultRequestHeaders.AcceptLanguage.Add(new StringWithQualityHeaderValue("en", .9));
    ...
} 
```

**旁白：**您可以通过以下方式填充 CookieContainer：

1.  循环遍历先前响应的 cookie。
    *   此响应可能来自 HttpAgilityPack、WebClient 或 Puppeteer（很多选项）
2.  手动输入（来自配置值或硬编码值）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-05-23T13:32:38.763

```
static void Main(string[] args)
        {
            DownloadFileAsync().GetAwaiter();

            Console.WriteLine("File was downloaded");
            Console.Read();
        }

        private static async Task DownloadFileAsync()
        {
            WebClient client = new WebClient();
            await client.DownloadFileTaskAsync(new Uri("http://somesite.com/myfile.txt"), "mytxtFile.txt");
        } 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2022-02-22T22:56:43.547

在 .NET Core MVC 中，有时您可以简单地执行以下操作：

```
public async Task<ActionResult> DownloadUrl(string url) {
    return Redirect(url);
} 
```

这可能假设您尝试下载的 MIME 类型设置为可由浏览器下载（例如 .mp4），因此它不会尝试重定向到网页。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-10-28T10:03:53.480

这是我的解决方案，效果很好：

```
public static void DownloadFile(string url, string pathToSaveFile)
        {
            ServicePointManager.SecurityProtocol = SecurityProtocolType.Tls12;
            // or: ServicePointManager.SecurityProtocol = (SecurityProtocolType)3072;

            using (WebDownload client = new WebDownload())
            {
                client.Headers["User-Agent"] = "User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36";
                client.DownloadFile(new Uri(url), pathToSaveFile);
            }
        }

    public class WebDownload : WebClient
        {
            protected override WebRequest GetWebRequest(Uri address)
            {
                HttpWebRequest request = (HttpWebRequest)base.GetWebRequest(address);
                if (request != null)
                {
                    request.AutomaticDecompression = DecompressionMethods.GZip | DecompressionMethods.Deflate;
                }
                return request;
            }
        } 
```

# c - 如何在 C 中打开和使用套接字？

> ID：307692
> 
> 赞同：17
> 
> 时间：2008-11-21T03:02:33.163
> 
> 标签：c, sockets, network-programming

我想知道用 C 编程语言打开套接字并将数据写入套接字以进行网络编程的最简单和最有效的方法。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-11-21T03:09:01.373

你是对的，在 C 中使用套接字有一个困难的语法。相比之下，Java 和 Python 等后来的语言使它变得轻而易举。我发现在 C 中进行套接字编程的最佳教程是[Beej 的网络编程指南](http://beej.us/guide/bgnet/html/multi/index.html)。*我建议您从头开始以获得良好的概述，但如果您现在*只需要让一些代码工作，您可以跳到标题为“[客户端-服务器背景](http://beej.us/guide/bgnet/html/multi/clientserver.html)”的部分。

祝你好运！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-21T03:21:33.143

您没有提及您在哪个平台上，但 Stevens 的[Unix Network Programming](http://www.kohala.com/start/unpv12e.html)副本将是您书架上的一个很好的补充。大多数操作系统使用套接字、绑定、连接等来实现伯克利套接字。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-02-28T09:59:49.460

**POSIX 7 最小可运行客户端服务器 TCP 示例**

在 LAN 中安装两台计算机，例如您的家庭 WiFi 网络。

在一台计算机上运行服务器：

```
./server.out 
```

获取服务器计算机的 IP `ifconfig`，例如`192.168.0.10`。

在另一台计算机上，运行：

```
./client.out 192.168.0.10 
```

现在在客户端键入行，服务器将返回它们以 1 递增（ROT-1 密码）。

**服务器.c**

```
#define _XOPEN_SOURCE 700

#include <stdbool.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include <arpa/inet.h>
#include <netdb.h> /* getprotobyname */
#include <netinet/in.h>
#include <sys/socket.h>
#include <unistd.h>

int main(int argc, char **argv) {
    char buffer[BUFSIZ];
    char protoname[] = "tcp";
    struct protoent *protoent;
    int enable = 1;
    int i;
    int newline_found = 0;
    int server_sockfd, client_sockfd;
    socklen_t client_len;
    ssize_t nbytes_read;
    struct sockaddr_in client_address, server_address;
    unsigned short server_port = 12345u;

    if (argc > 1) {
        server_port = strtol(argv[1], NULL, 10);
    }

    protoent = getprotobyname(protoname);
    if (protoent == NULL) {
        perror("getprotobyname");
        exit(EXIT_FAILURE);
    }

    server_sockfd = socket(
        AF_INET,
        SOCK_STREAM,
        protoent->p_proto
        /* 0 */
    );
    if (server_sockfd == -1) {
        perror("socket");
        exit(EXIT_FAILURE);
    }

    if (setsockopt(server_sockfd, SOL_SOCKET, SO_REUSEADDR, &enable, sizeof(enable)) < 0) {
        perror("setsockopt(SO_REUSEADDR) failed");
        exit(EXIT_FAILURE);
    }

    server_address.sin_family = AF_INET;
    server_address.sin_addr.s_addr = htonl(INADDR_ANY);
    server_address.sin_port = htons(server_port);
    if (bind(
            server_sockfd,
            (struct sockaddr*)&server_address,
            sizeof(server_address)
        ) == -1
    ) {
        perror("bind");
        exit(EXIT_FAILURE);
    }

    if (listen(server_sockfd, 5) == -1) {
        perror("listen");
        exit(EXIT_FAILURE);
    }
    fprintf(stderr, "listening on port %d\n", server_port);

    while (1) {
        client_len = sizeof(client_address);
        client_sockfd = accept(
            server_sockfd,
            (struct sockaddr*)&client_address,
            &client_len
        );
        while ((nbytes_read = read(client_sockfd, buffer, BUFSIZ)) > 0) {
            printf("received:\n");
            write(STDOUT_FILENO, buffer, nbytes_read);
            if (buffer[nbytes_read - 1] == '\n')
                newline_found;
            for (i = 0; i < nbytes_read - 1; i++)
                buffer[i]++;
            write(client_sockfd, buffer, nbytes_read);
            if (newline_found)
                break;
        }
        close(client_sockfd);
    }
    return EXIT_SUCCESS;
} 
```

**客户端.c**

```
#define _XOPEN_SOURCE 700

#include <assert.h>
#include <stdbool.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include <arpa/inet.h>
#include <netdb.h> /* getprotobyname */
#include <netinet/in.h>
#include <sys/socket.h>
#include <unistd.h>

int main(int argc, char **argv) {
    char buffer[BUFSIZ];
    char protoname[] = "tcp";
    struct protoent *protoent;
    char *server_hostname = "127.0.0.1";
    char *user_input = NULL;
    in_addr_t in_addr;
    in_addr_t server_addr;
    int sockfd;
    size_t getline_buffer = 0;
    ssize_t nbytes_read, i, user_input_len;
    struct hostent *hostent;
    /* This is the struct used by INet addresses. */
    struct sockaddr_in sockaddr_in;
    unsigned short server_port = 12345;

    if (argc > 1) {
        server_hostname = argv[1];
        if (argc > 2) {
            server_port = strtol(argv[2], NULL, 10);
        }
    }

    /* Get socket. */
    protoent = getprotobyname(protoname);
    if (protoent == NULL) {
        perror("getprotobyname");
        exit(EXIT_FAILURE);
    }
    sockfd = socket(AF_INET, SOCK_STREAM, protoent->p_proto);
    if (sockfd == -1) {
        perror("socket");
        exit(EXIT_FAILURE);
    }

    /* Prepare sockaddr_in. */
    hostent = gethostbyname(server_hostname);
    if (hostent == NULL) {
        fprintf(stderr, "error: gethostbyname(\"%s\")\n", server_hostname);
        exit(EXIT_FAILURE);
    }
    in_addr = inet_addr(inet_ntoa(*(struct in_addr*)*(hostent->h_addr_list)));
    if (in_addr == (in_addr_t)-1) {
        fprintf(stderr, "error: inet_addr(\"%s\")\n", *(hostent->h_addr_list));
        exit(EXIT_FAILURE);
    }
    sockaddr_in.sin_addr.s_addr = in_addr;
    sockaddr_in.sin_family = AF_INET;
    sockaddr_in.sin_port = htons(server_port);

    /* Do the actual connection. */
    if (connect(sockfd, (struct sockaddr*)&sockaddr_in, sizeof(sockaddr_in)) == -1) {
        perror("connect");
        return EXIT_FAILURE;
    }
    while (1) {
        fprintf(stderr, "enter string (empty to quit):\n");
        user_input_len = getline(&user_input, &getline_buffer, stdin);
        if (user_input_len == -1) {
            perror("getline");
            exit(EXIT_FAILURE);
        }
        if (user_input_len == 1) {
            close(sockfd);
            break;
        }
        if (write(sockfd, user_input, user_input_len) == -1) {
            perror("write");
            exit(EXIT_FAILURE);
        }
        while ((nbytes_read = read(sockfd, buffer, BUFSIZ)) > 0) {
            write(STDOUT_FILENO, buffer, nbytes_read);
            if (buffer[nbytes_read - 1] == '\n') {
                fflush(stdout);
                break;
            }
        }
    }
    free(user_input);

    exit(EXIT_SUCCESS);
} 
```

[在带有 Makefile 的 GitHub 上](https://github.com/cirosantilli/cpp-cheat/tree/f31150c42331407fd434a7e912ca64642710fea2/posix/socket/inet)。在 Ubuntu 15.10 上测试。

**消息长度**

客户端和服务器上的`read`调用都在 while 循环中运行。

就像从文件中读取一样，操作系统可能会任意拆分消息以加快处理速度，例如，一个数据包可能比另一个数据包更早到达。

因此协议必须指定消息停止位置的约定。常用方法包括：

*   带有长度指示符的标头（例如 HTTP `Content-Length`）
*   终止消息的唯一字符串。这里我们使用`\n`.
*   服务器关闭连接：HTTP 允许[https://stackoverflow.com/a/25586633/895245](https://stackoverflow.com/a/25586633/895245)。当然有限，因为下一条消息需要重新连接。

**下一步**

这个例子是有限的，因为：

*   服务器一次只能处理一个客户端连接
*   通讯简单同步。例如：在 P2P 聊天应用程序上，服务器（其他人）可以随时发送消息。

解决这些问题需要线程和可能的其他调用，例如`poll`.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-21T07:07:25.137

除非您编写网络守护程序，否则 C 中的大多数网络都可以通过使用适当的库在比直接使用套接字更高的级别上完成。

例如，如果您只想使用 HTTP 检索文件，请使用[Neon](http://www.webdav.org/neon/)或[libcurl](http://curl.haxx.se/libcurl/)。它会更简单，它会处于更高的级别，并且您将拥有免费的 SSL、IPv6 等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T03:07:11.940

从基本套接字读取和写入并不比读取和写入普通文件更难（只需使用 recv 代替 read，如果 write 则使用 send 代替）。当您需要打开套接字时，事情会变得有些棘手。其原因是因为使用套接字（TCP、UDP 等）进行通信的方式有很多种。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-25T15:20:21.427

我通常用 C++ 编写，但你可以在我写的“如何避免十大套接字编程错误”的白皮书中找到一些用处 - 忽略使用 ACE 工具包的建议（因为它需要 C++），但要注意套接字论文中的错误——它们很容易犯，也很难找到，尤其是对于初学者。 [http://www.riverrace.com/sockets10.htm](http://www.riverace.com/sockets10.htm)

# iphone - 算法：保持 NSDictionary 中键/值对的计数

> ID：307695
> 
> 赞同：1
> 
> 时间：2008-11-21T03:04:36.017
> 
> 标签：iphone, c, objective-c, cocoa, algorithm

作为 Cocoa 的新手，并且可能不知道已经将这个功能整齐地包装在 OO 类中的所有可用的潜在类，这里有一个算法查询。`NSDictionary`计算特定键在多个实例数组中出现的次数的最佳选择是什么？

本质上，我的数据结构（在本例中为 an `NSArray`）可能在任何给定时间包含多个`NSDictionary`实例，每个实例具有相同的键，可能具有不同的值。一些值重复。我希望能够知道特定键/值出现了多少次。例子：

```
{
  foo => 1,
  bar => 2
}
{
  foo => 1,
  bar => 3
}
{
  foo => 2,
  bar => 1
} 
```

在这种情况下，我感兴趣的是`foo=>1`发生了 2 次并`foo=>2`发生了 1 次。正在构建一个`NSCountedSet`最好的方法来解决这个问题吗？也许是一个 C 链表？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T03:30:09.707

您可能需要重新考虑如何构建数据。我会在添加到 NSArray 时跟踪这样的事情，而不是在以后尝试发现它。您可以创建一个新类来处理添加和删除数据，以便您可以保留自己的数据计数。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T04:09:24.870

```
NSDictionary * dict1 = [[NSDictionary alloc] initWithObjectsAndKeys:
                        [NSNumber numberWithInt:1], @"foo",
                        [NSNumber numberWithInt:2], @"bar", nil];
NSDictionary * dict2 = [[NSDictionary alloc] initWithObjectsAndKeys:
                        [NSNumber numberWithInt:1], @"foo",
                        [NSNumber numberWithInt:3], @"bar", nil];
NSDictionary * dict3 = [[NSDictionary alloc] initWithObjectsAndKeys:
                        [NSNumber numberWithInt:2], @"foo",
                        [NSNumber numberWithInt:1], @"bar", nil];
NSArray * arrayOfDictionaries = [[NSArray alloc] initWithObjects:
                                 dict1, dict2, dict3, nil];

// count all keys in an array of dictionaries (arrayOfDictionaries):

NSMutableDictionary * countKeys = [[NSMutableDictionary alloc] initWithCapacity:0];
NSCountedSet * counts = [[NSCountedSet alloc] initWithCapacity:0];

NSArray * keys;
NSString * pairString;
NSString * countKey;
for (NSDictionary * dictionary in arrayOfDictionaries)
{
    keys = [dictionary allKeys];
    for (NSString * key in keys)
    {
        pairString = [NSString stringWithFormat:@"%@->%@", key, [dictionary valueForKey:key]];
        if ([countKeys valueForKey:pairString] == nil)
        {
            [countKeys setValue:[NSString stringWithString:pairString] forKey:pairString];
        }
        countKey = [countKeys valueForKey:pairString];
        { [counts addObject:countKey]; }
    }
}

NSLog(@"%@", counts);

[counts release];
[countKeys release];

[arrayOfDictionaries release];
[dict1 release];
[dict2 release];
[dict3 release];
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T04:49:22.950

```
NSCountedSet *keyCounts = [NSCountedSet set];
for (NSDictionary *dict in myDictionaries)
    [keyCounts unionSet:[NSSet setWithArray:[dict allKeys]]]; 
```

# api - Microsoft SkyDrive 是否有 API？

> ID：307696
> 
> 赞同：35
> 
> 时间：2008-11-21T03:04:58.060
> 
> 标签：api, documentation, storage, onedrive

因此，[最近有消息称微软 Skydrive 将被撞到](http://lifehacker.com/5094242/skydrive-will-upgrade-to-25gb-of-online-storage)每个帐户 25GB 的存储空间，有人知道 SkyDrive 是否有 API 吗？

（如果是这样，文档在哪里？）

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2011-10-03T18:08:02.143

SkyDrive（重命名为“OneDrive”）具有官方 API。详情可前往[OneDrive 开发者中心](https://dev.onedrive.com/)。

[您还可以在 GitHub 上找到](https://github.com/OneDrive)使用 OneDrive API 的代码示例以及 SDK 的源代码

# language-agnostic - 你们中有多少人向标准委员会做出了贡献/提供了反馈？

> ID：307703
> 
> 赞同：3
> 
> 时间：2008-11-21T03:08:33.060
> 
> 标签：language-agnostic, standards

好的，作为程序员，我们都遵循编程标准（如 W3 标准或 C++ 标准等），我们中的许多人认为这些标准是“神圣的”，而且许多经验丰富的程序员在被问及有关标准时可以背诵他们选择的标准他们专业领域的问题。顺便说一句，您可以在 SO 上看到很多最后一个案例！

但是我认为大多数程序员没有意识到这些标准是由人类委员会决定的，而我们的标准实际上是生活标准，根据反馈（HTML5.0、Perl6.0、C++）不断变化以满足当前需求0x) 等等...

现在，我最近的个人作案方式是阅读即将出台的将影响我的标准，如果我有顾虑，我不会咆哮，我会邮寄给联盟，解释我的顾虑和建议。很多时候我得到了积极的回应，其他时候我得到了很好的解释为什么它不能完成，当然其他时候我只是被忽略了:) 但是我知道我尝试过，并努力使标准更好。

所以我想知道我是否是某种标准狂，或者这种行为在其他 SO 用户中是否常见？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T03:44:24.360

怪物 ;-）

[以一种好的方式]

[我早在 1990 年代就曾在 OMG OO 设计标准委员会任职，所以我想这也让我有点怪异 ;-)]

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T03:50:31.930

作为标准委员会（C#、CLI）的前杰出成员，我个人非常感谢公众对该标准的投入。事实上，我们曾多次发布临时标准草案，并在正式批准之前引起了公众的注意。

这一切都是为了获得一双新的眼睛——从事标准工作的人有时会变得麻木并掩盖一些最简单的错误。

也就是说，您必须在回答公众批评与实际完成标准之间取得平衡。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T21:54:38.263

我不时向标准委员会提交意见。我注意到，当评论和他们的讨论在某处公开时，我更加感激并愿意这样做。尽管如此，我还是向只写输入点提交了评论，并且偶尔很高兴收到回复，通常是很久以后，关于我的评论的处置。

作为几个标准制定委员会的现任成员，我可以告诉您，外部评论和反馈很受重视。还有一些组织，例如 OASIS，外部评论的重要性及其负责任的处置是运营 TC 规则的一部分。

外部反馈让我们知道有人在关注并关心工作。我知道，当我们不公开迅速地做出回应时，我们也会让人们失望。我还意识到，对于涉及本质上是功能请求的提案的反馈，我们通常不受所考虑范围的限制，特别是是否有人愿意（或已经拥有）实现所请求的功能。

在任何情况下，对标准制定和澄清过程的反馈都非常有价值。（如果您提供输入所付出的努力没有得到重视，那通常很容易检测到。）这与提交您正在使用的软件的错误和功能请求没有太大区别。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T03:54:46.663

Perl 既没有标准也没有委员会，但我不时参加邮件列表（称为[p5p](http://lists.cpan.org/showlist.cgi?name=perl5-porters)），它的许多作者和维护者在其中相互交流，我写了一篇文章（[README.macosx](http://perldoc.perl.org/perlmacosx.html)） Perl 文档的一部分。

很久以前，在很远的一个网站上，当 W3C 就 CSS 提案草案的第一版征求反馈意见时，我做出了[回应。](http://lists.w3.org/Archives/Public/www-style/1996Nov/0013.html)有趣的是，我的建议，即读者指定的 !important 规则应该覆盖作者指定的 !important 规则，CSS1 没有遵循，但它最终在 CSS2 中被采用*。*

# .net - 默认为项目中的所有页面添加公共命名空间引用

> ID：307706
> 
> 赞同：1
> 
> 时间：2008-11-21T03:11:25.207
> 
> 标签：.net, visual-studio

有没有什么简单的方法可以为我在项目中创建的每个类添加一个 using 语句而无需编写

```
using SomeNamespace; 
```

在每个文件中？

[编辑] 我可以添加一个我意识到的模板，但我正在谈论为现有项目中的每个文件执行此操作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T03:22:56.820

转到“我的项目”>“参考”选项卡 >“导入的命名空间”部分。检查您希望在每个页面上可用的任何命名空间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T21:41:52.673

在您的“使用系统”项目中查找/替换；使用“使用系统；使用 SomeNamespace；” 会让你快速到达那里。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T03:14:05.857

我相信您可以执行以下操作：

```
<system.web>
        <pages>
              <namespaces>
                    <add namespace="System.IO" />
                    <add namespace="System.Text"/>
                    <add namespace="Westwind.Tools"/>
              </namespaces>
        </pages>
</system.web> 
```

[http://www.west-wind.com/WebLog/posts/2287.aspx](http://www.west-wind.com/WebLog/posts/2287.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T03:33:17.720

请注意，web.config 设置仅适用于页面标记内的代码，而不适用于 CodeFile/CodeBehind 页面中的代码，因此这并不是真正的解决方案。

另一种方法是使用您想要的正确设置创建一个空页面 - 命名空间，可能还有一个公共基类等，然后从中创建一个页面模板。

签出文件 | 导出模板...

它非常简单，可让您准确创建所需的内容。适用于大多数文件类型以及可以模板化的整个项目（这是一个词吗？:-}）...

# silverlight - 如何强制 Firefox 不缓存或重新下载 Silverlight XAP 文件？

> ID：307709
> 
> 赞同：50
> 
> 时间：2008-11-21T03:12:20.027
> 
> 标签：silverlight, firefox

使用 Silverlight 时，我注意到 Firefox 会缓存 XAP 文件，因此如果我进行更新，用户可能会卡在使用过时的版本。有没有办法强制浏览器每次都重新下载 XAP 文件，或者只在发布更新后强制它？或者 Silverlight 配置中是否有阻止浏览器完全缓存 XAP 文件的设置？

谢谢，杰夫

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-09-24T01:41:06.817

查询字符串完美运行，但我不会使用*DateTime.Now*，因为它会强制用户每次都重新下载应用程序。相反，我们使用以下内容：

```
protected void Page_Load(object sender, EventArgs e)
{
    var versionNumber = Assembly.GetExecutingAssembly().GetName().Version.ToString();
    this.myApp.Source += "?" + versionNumber;
} 
```

这样，您所要做的就是增加*AssemblyInfo.cs*文件中的版本号。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-09-02T13:23:31.970

最简单的方法：

```
<param name="source" value="ClientBin/App.xap?<%= DateTime.Now.Ticks %>" /> 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-12-10T17:39:44.440

这就是我在 php 中所做的。您读取 xap 文件的日期/时间，并将其作为参数附加到下载链接。这样，浏览器将新文件版本视为新链接，因此不在其缓存中。

```
<?php $fdate = date("dHis",filemtime("MyApp.xap")) ?>

<param name="source" value="MyApp.xap?=<?php echo $fdate ?>"/> 
```

简单而且有效。此外，当没有更新可供下载时，浏览器会继续正确缓存。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-06-10T16:43:08.970

对我来说，最好的答案来自[Chris Cairns](https://stackoverflow.com/questions/307709/how-do-you-force-firefox-to-not-cache-or-re-download-a-silverlight-xap-file/4032381#4032381)。我只是稍微调整了一下，调用 ToString 和 GetHashCode，为时间戳生成一个 ID：

```
<param name="source" value="ClientBin/App.xap?<%= System.IO.File.GetLastWriteTime(Server.MapPath("ClientBin/App.xap")).ToString().GetHashCode()%>" /> 
```

工作得很好！

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-11-21T14:57:19.213

您可能会发现[面向 Web 作者和网站管理员的缓存教程](http://www.mnot.net/cache_docs/)很有帮助。本文档讨论了客户端和服务器交互的不同缓存（浏览器、代理、网关）以及如何控制缓存。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-21T03:49:59.887

您可以发送 HTTP 标头以防止其缓存：

```
Cache-control: no-cache
Pragma: no-cache 
```

如何执行此操作取决于您使用的 Web 服务器。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-10-27T10:48:08.330

为 XAP 添加时间戳对我有用（我在 javascript 中添加了 SL 控件，但这也可以很容易地内联完成）：

```
var appTimestamp = '<%= System.IO.File.GetLastWriteTime(Server.MapPath("ClientBin/MyApp.xap")) %>';
var source = 'ClientBin/MyApp.xap?appTimestamp=' + appTimestamp; 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-11-08T04:26:45.580

这经过测试和工作：

把这个：

```
<%
    const string sourceValue = @"ClientBin/MyXapFile.xap";
    string param;

    if(System.Diagnostics.Debugger.IsAttached)
        param = "<param name=\"source\" value=\"" + sourceValue + "\" />";
    else
    {
        var xappath = HttpContext.Current.Server.MapPath(@"") + @"\" + sourceValue;
        var xapCreationDate = System.IO.File.GetLastWriteTime(xappath);

        param = "<param name=\"source\" value=\"" + sourceValue + "?ignore="
        + xapCreationDate + "\" />";
    }
    Response.Write(param);
%> 
```

而不是这个：

```
<param name="source" value="ClientBin/MyXapFile.xap" /> 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-07-10T00:28:49.487

另一种解决方案是附加 XAP 文件的版本而不是时间戳。时间戳每次都会改变（也可以关闭缓存）。要让它仅在 XAP 更新时进行更改，需要从 XAP 文件中获取一些信息。我还在研究我可以使用什么，也许是 XAP 文件的最后修改日期戳？

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-02-01T18:47:05.847

您可以在 object 标记中附加源 URL 以及 XAP 文件的最后写入日期。检查我[博客上](http://codeblog.larsholm.net/2010/02/avoid-incorrect-caching-of-silverlight-xap-file/)的代码。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-05-28T09:02:03.440

我通过结合上述建议来实现这一点：

1.  将元标记缓存控制/编译指示 http-equiv 属性设置为“无缓存”
2.  使用 ASP.NET 页面来承载 silverlight 控件（而不是 html 页面）
3.  在后面的代码中设置 ASP.NET Silverlight 控件的 Source 属性，将时间戳附加到 .xap url 例如

    Silverlight1.Source = "ClientBin/MyApplication.xap?" + DateTime.Now.ToString("dd-MM-yy-HH:mm:ss");

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-09-01T17:25:50.723

我使用[这个解决方案](http://codeblog.larsholm.net/2010/02/avoid-incorrect-caching-of-silverlight-xap-file/)

```
<object id="Xaml1" data="data:application/x-silverlight-2," type="application/x-silverlight-2"
width="100%" height="100%">
<%––&lt;param name="source" value="ClientBin/SilverlightApp.xap"/>––%>
<%
string orgSourceValue = @"ClientBin/SilverlightApp.xap";
string param;
if (System.Diagnostics.Debugger.IsAttached)
param = "<param name=\"source\" value=\"" + orgSourceValue + "\" />";
else
{
string xappath = HttpContext.Current.Server.MapPath(@"") + @"\" + orgSourceValue;
DateTime xapCreationDate = System.IO.File.GetLastWriteTime(xappath);
param = "<param name=\"source\" value=\"" + orgSourceValue + "?ignore="
+ xapCreationDate.ToString() + "\" />";
}
Response.Write(param);
%>
<param name="onError" value="onSilverlightError" 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-21T23:13:59.507

一个超级简单的想法：只需在 url 中添加一个假的查询字符串。

```
<param name="source" value="app.xap?r12345"/> 
```

大多数服务器应该忽略它并正常服务器文件 - 取决于您的服务器。如果您真的很聪明，您可以使托管页面动态化并自动将滴答计数或日期时间字符串附加到查询字符串。这可确保您在需要时获得缓存，但在发生更改时强制下载。

理想情况下，您的服务器应该为您执行此操作。但如果不是...

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-21T20:12:29.203

我们也处于同样的情况，我们想要控制 .XAP 文件何时下载到浏览器。

您可能想要了解的一种方法是使用 Silverlight 隔离存储作为“缓存”来存储您的 .XAP 文件。

查看此博客：[作为 Silverlight 对象缓存的独立存储](http://timheuer.com/blog/archive/2008/09/24/silverlight-isolated-storage-caching.aspx)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-26T11:54:56.070

我遇到了这个问题，所以现在当我启动一个新应用程序时，我将程序集版本设置为 0.0.0.1，并在每次部署时将其更新为一个，似乎已经为我解决了。然后在发布时将其设置回 1.0.0.0。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-01-23T05:12:36.600

到目前为止，我发现的唯一解决方案是，一旦出现问题，就是清除 Firefox 缓存。

更好的解决方案会更好。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2010-05-26T05:22:01.983

查询字符串的想法在 Silverlight 4 中对我不起作用。服务器似乎缓存了该死的 xap（尽管不是 aspx 文件）。在 SL4 中有效的解决方案是转到您的 Silverlight 项目的属性，转到程序集信息并输入一个版本。

# java - 在 Java 1.5 中，将文件从客户端传输到服务器的最佳方法是什么？

> ID：307718
> 
> 赞同：3
> 
> 时间：2008-11-21T03:17:14.757
> 
> 标签：java, html, jsp, struts

在 Java 1.5 中，将文件从客户端传输到服务器的最佳方法是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-21T03:25:55.473

我会使用[Apache Commons HttpClient](http://hc.apache.org/httpclient-3.x/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T16:05:20.200

我会使用[URLConnection](http://java.sun.com/j2se/1.5.0/docs/api/java/net/URLConnection.html)。

# security - 斯科特·汉塞尔曼 (Scott Hanselman) 的节目 #135 是否有过多的止咳糖浆？

> ID：307722
> 
> 赞同：6
> 
> 时间：2008-11-21T03:21:44.703
> 
> 标签：security, architecture

所以这个问题最终会变得技术性的——但首先查看与 Atwood （等人）的[Hanselminutes](http://www.hanselminutes.com/default.aspx?showID=153)，Scott 基本上邀请开发人员尝试破解这个网站。这是一个声音。我首先想到（当然是大声说出来，因为当你大声思考时，戴着耳机你会得到人们最好的凝视）“他要么刚从香港下飞机，没有提供餐饮服务，要么因为驾驶山猫而被罚了太多止咳糖浆。”</p>

所以问题是，如果这样的网站可以在一个盒子上生存，它是否需要多个防火墙、一个 DMZ 和一个拿着大棒的肛门前银行家？换句话说，我们是否仅仅因为他们告诉我们而追逐安全架构的圣杯？

免责声明：我喜欢 Scott Hanselman，并且是他的另一层抽象理论的忠实粉丝。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-21T18:33:16.640

是的，我同意我的偏执狂可能占了我的上风。我认为抱怨 Jeff 缺乏单独的开发和登台机器更有用……不确定我是否有胃口直接投入生产。;)

不过，说真的，忘记事物的硬件方面，我应该更多地谈论威胁建模。然而，Jeff 似乎对此处理得很好，并且在发现漏洞时会尽快堵塞漏洞。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T05:34:19.257

我真的很喜欢这个播客，并发现听到像 Jeff 这样享有盛誉的人分享我们许多人面临的同样的业务/成本驱动的现实，我感到很耳目一新。我经常发现书籍/播客/演示文稿有点乌托邦。

让它发挥作用仍然是主要目标。漂亮的代码、完美的抽象、NSA 级别的安全性——这些都是崇高的目标，但过分关注这些东西会导致项目过早破产。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T04:10:27.117

好吧，这并不是说这个网站*没有* [被破解](http://www.codinghorror.com/blog/archives/001167.html)。所以是的，追求更好的安全性可能是值得的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T05:05:04.820

在一个大机器上运行站点的另一个与安全无关的问题是缺乏冗余。有任意数量的单点故障，无论是在单个服务器中还是在一个数据中心中。

我假设服务提供商已经准备好为他们的客户更换热备件，并且有多个互联网连接，但仍然......

[Scott Hanselman](http://stackoverflow.com/users/6380/scott-hanselman)也可能会加入，因为他也使用该网站。

# version-control - 非常小的团体或个人的网上商店版本控制？

> ID：307728
> 
> 赞同：1
> 
> 时间：2008-11-21T03:22:40.783
> 
> 标签：version-control

对于非常小的团队或个人开发人员，是否有一种源代码控制工具，它是一种 Web 服务或基于 Web 的应用程序，且无需或只需很少的成本？

理想情况下，它将与 Microsoft 开发一起使用。IDE 集成会很棒，但连接到 Web 服务的 Windows 应用程序也足够了。

你会认为这样的产品有市场价值吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-21T03:28:25.873

如果你开源项目，GitHub 是免费的，个人计划每月只需 7 美元。 [http://github.com/plans](http://github.com/plans)

不过，我对可能的 IDE 集成知之甚少。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T03:28:48.870

我推荐[Unfuddle.com](http://unfuddle.com/)用于 subversion 或[Github](http://github.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-28T23:11:53.050

这个网站上曾经有[BeanStalk](http://beanstalkapp.com/)的广告。单个存储库/3 个用户免费。有一些工具可以将 SVN 与 IDE 集成 - 试试[VisualSVN](http://www.visualsvn.com/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-29T00:59:05.730

我推荐[Codespaces](http://www.codespaces.com/)。它有一个免费计划，下一个计划只需 3 美元/月。它带有项目规划和一堆好东西。看截图页面，挺好看的。

# python - 为什么类的新实例与其他实例共享成员？

> ID：307729
> 
> 赞同：2
> 
> 时间：2008-11-21T03:22:53.670
> 
> 标签：python, scope, mutable

```
class Ball:
  a = []
  def __init__(self):
    pass

  def add(self,thing):
    self.a.append(thing)

  def size(self):
    print len(self.a)

for i in range(3):
  foo = Ball()
  foo.add(1)
  foo.add(2)
  foo.size() 
```

我希望回报：

```
2
2
2 
```

但我得到：

```
2
4
6 
```

为什么是这样？我发现通过在**init**中执行 a=[] ，我可以绕过这种行为，但我不太清楚为什么。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T03:27:46.577

*多哈*

我才知道为什么。

在上述情况下，a 是类属性，而不是数据属性——所有 Balls() 共享这些属性。注释掉 a=[] 并将其放入**init**块意味着它是一个数据属性。（而且，那时我无法使用 foo.a 访问它，无论如何我都不应该这样做。）看起来类属性就像类的静态属性一样，它们被所有实例共享。

哇。

不过有一个问题：CodeCompletion 很烂。在 foo 类中，我不能做 self.(variable)，因为它不是自动定义的——它是由函数定义的。我可以定义一个类变量并用数据变量替换它吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T03:47:25.070

您可能想要做的是：

```
class Ball:
  def __init__(self):
    self.a = [] 
```

如果你使用 just `a = []`，它会在函数中创建一个局部变量，`__init__`当函数返回时它会消失。分配给`self.a`它使其成为您所追求的实例变量。

对于半相关的问题，请参阅如何[更改未来调用者的默认参数值](https://stackoverflow.com/questions/146329/what-is-the-worst-gotcha-youve-experienced#147877)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T11:20:14.313

“我可以定义一个类变量并用数据变量替换它吗？”

不，它们是不同的东西。一个类变量只存在一次——在类中。

你可以——为了巧妙地完成代码——从一些类变量开始，然后在你编写完你的类之后删除这些代码行。但每次你忘记做那件事，什么好事都不会发生。

更好的是尝试不同的 IDE。 [Komodo Edit](http://www.activestate.com/store/download.aspx?prdGUID=20f4ed15-6684-4118-a78b-d37ff4058c5f)的代码完成似乎是明智的。

如果你有这么多的变量名称很长以至于代码完成实际上很有帮助，也许你应该让你的类更小或使用更短的名称。严重地。

我发现当你到达一个代码完成比烦人更有帮助的地方时，你已经超过了“把它全部放在我的大脑中”的复杂性阈值。如果这门课不适合我的大脑，那就太复杂了。

# .net - 未为动态创建的控件触发事件处理程序

> ID：307737
> 
> 赞同：9
> 
> 时间：2008-11-21T03:26:04.630
> 
> 标签：.net, asp.net, events

我在动态创建的 TextBox 中遇到了这个问题。

在 PageLoad 中创建 TextBox 时，会触发它的 TextChanged 事件。
但是当我动态删除并重新创建 TextBox 时，TextChanged 没有被触发。

这是代码：

**.aspx 文件**

```
<body>
    <form id="form1" runat="server">
    <div>

    <asp:Table ID="Table1" runat="server">
      <asp:TableRow>
        <asp:TableCell ColumnSpan="2">Fixed content</asp:TableCell>
      </asp:TableRow>
    </asp:Table>   
    </form>
</body> 
```

**.cs 文件**

```
public partial class test : System.Web.UI.Page
{
  string myText = "a";

  protected void Page_Load(object sender, EventArgs e)
  {
    WriteRows();
  }

  private void WriteRows()
  {
    TableRow tr = new TableRow();

    TableCell tc = new TableCell();
    TextBox txt = new TextBox();
    txt.Text = myText;
    txt.TextChanged += new EventHandler(txt_TextChanged); // Assign event handler
    tc.Controls.Add(txt);
    tr.Controls.Add(tc);

    tc = new TableCell();
    tc.Text = txt.Text;
    tr.Controls.Add(tc);

    Table1.Controls.AddAt(1, tr);
  }

  private void txt_TextChanged(object sender, EventArgs e)
  {
    myText = ((TextBox)sender).Text;
    RedrawTable(); // Delete the row (incl. the TextBox) and rewrite it
  }

  private void RedrawTable()
  {
    Table1.Controls.RemoveAt(1);
    WriteRows();
  }
} 
```

有没有人有解决方案，以便始终触发事件？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-21T15:44:19.073

事件处理由 ASP.NET 通过匹配控件的 ID 和请求参数来完成。在您的情况下，在 txtTextChanged() 期间创建的 TextBox 将具有自动 ID，因为您没有指定任何显式 ID。该 ID 将在文本更改事件期间发回。

在页面加载事件之后，ASP.NET 将尝试找到具有该 ID 的控件来为其触发事件。显然 ASP.NET 将无法找到匹配项，因为在 Page_Load() 期间创建的 TextBox 不同并且具有不同的 ID。

要解决这个问题：为您的文本框指定一个显式 ID：

```
TextBox txt = new TextBox();
txt.Text = myText;
txt.ID = "txtBox"; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T09:20:10.250

尝试在 Page_Init() 方法中创建控件...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T06:05:28.070

要触发回发事件，应该触发事件的控件需要在回发生命周期中*具有相同的 ID*和*相同的数据。*

如果您有静态控件（在您的 aspx/ascx/master 中定义）并打开了视图状态，那么它们将自动重新创建。

如果您不想使用视图状态或使用动态控件，则需要*在每个 page_load 上*对控件进行数据绑定，以便控件及时启动并运行以触发事件（在 Page_load 之后发生）

如果您更改父控件或页面的 ID，您可能会不小心丢弃视图状态自动绑定，因为控件 ID 包含祖先 ID。我认为您应该安全地这样做，只要您在 Page_Init 中执行此操作（在设置视图状态之前）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-22T23:10:11.700

在 Page_Init 中重新创建动态创建的控件。如果在 Page_Load 中重新创建控件，您将无法访问控件的视图状态数据（视图状态在 PreLoad 中加载，发生在 Page_Load 之前）。

另外，不要忘记为控件分配一个 ID。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T04:05:44.380

我有一个类似的问题。我认为问题在于动态创建的控件不会保持在视图状态并且不会在回发中存活。这是从我的代码中提取的评论，描述了我提出的解决方案（它可能不是唯一的，但它对我有用）。

此页面用于动态定义网格。用户单击复选框以指示要在网格中包含哪些字段。这个页面的逻辑做了两个基本的事情：

(1) 它维护保存在 ViewState 中的 GridDefinition 对象。(2) 它在每次回发时从 ViewState 中的 GridDefinition 重构以编程方式添加的控件（基本上是表对象中的所有内容）。动态添加的控件不会在 ViewState 的回发中重新创建。事实上，我发现如果您不重新创建控件，它们的事件将不会触发。显然：

```
 "The process that matches controls to posted values occurs 
       after page_load completes, so it has to occur just like this 
       if you are to use this way." 
```

当我得到一个指示数据发生某些更改的控制事件时，我必须在存储在 ViewState 中的 GridDefinition 对象中反映该更改。这样，在 NEXT 回发时，可以正确地重新创建控件（例如，指示网格列标题文本的文本框）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-21T04:13:57.420

当我研究这个问题时，它是在动态菜单的背景下，有一堆谷歌的回应，一起让我通过它（因为这是一个足够普遍的要求，我猜。）我没有答案的摘要，但它可能是一个有用的起点（即 google for Dynamic Menus .NET）。这个网站上也有几个问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-21T04:23:55.467

...作为另一个建议，在 Page_Load 之后绑定事件是不是太晚了？因此他们不会在回发时被解雇。也许有什么要检查的..

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-21T06:16:20.293

再次提醒我为什么要避免使用 asp - 对我来说，这似乎是一个抽象级别太多了。但是通过与 javascript 的类比，您是否有可能在事件中得到多个处理程序？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-05-28T08:56:03.937

您在下面给出完整代码的答案：

```
string myText = "a";

protected void Page_Load(object sender, EventArgs e)
{
    WriteRows();
}

private void WriteRows()
{
    TableRow tr = new TableRow();

    TableCell tc = new TableCell();
    TextBox txt = new TextBox();
    txt.Text = myText;

    txt.ID = "txt1";

    txt.TextChanged += new EventHandler(txt_TextChanged); // Assign event handler

    txt.AutoPostBack = true;

    tc.Controls.Add(txt);
    tr.Controls.Add(tc);

    tc = new TableCell();
    tc.Text = txt.Text;
    tr.Controls.Add(tc);

   Table1.Controls.AddAt(0,tr);

}

private void txt_TextChanged(object sender, EventArgs e)
{
    myText = ((TextBox)sender).Text;
    RedrawTable(); // Delete the row (incl. the TextBox) and rewrite it
}

private void RedrawTable()
{
    Table1.Controls.RemoveAt(0);
    WriteRows();
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-11-13T21:04:20.453

您只需为文本框分配一个 ID 属性。它应该可以解决您的问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-07-29T07:11:18.960

我有同样的问题，在我的情况下 txt.AutoPostBack = true 是我错过的。默认为假，容易忘记。

# asp.net-mvc - 在 MVC 中，什么时候使用 <%= %> 和 <% %>？

> ID：307740
> 
> 赞同：8
> 
> 时间：2008-11-21T03:27:41.007
> 
> 标签：asp.net-mvc

在asp.net mvc中，我们什么时候使用：

和

我们是否需要放置一个 ; （冒号） ？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-21T03:36:17.387

`<%= %>`将包含的命令的输出（字符串）呈现给响应。 `<% %>`在视图中包装可执行语句（逻辑）以控制执行的内容。您不在`<%= %>`块中使用分号，但可能在`<% %>`取决于包含的语句中。

字符串渲染：

`<%= Html.Encode( Model. Property ) %>`

代码块：

`<% Html.RenderPartial( "ViewName" ); %>`

**编辑：**这是参考的[链接。](http://msdn.microsoft.com/en-us/library/k6xeyd4z.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T04:14:26.030

`<%="something" %>`只是一个捷径`Response.Write("something")`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T11:52:20.133

当您调用一些返回字符串的 HtmlHelper 方法时使用例如： 当您调用一些无效的 HtmlHelper 方法时使用：

# sql - Facebook 中的新闻提要数据库设计

> ID：307748
> 
> 赞同：10
> 
> 时间：2008-11-21T03:31:27.240
> 
> 标签：sql, database, database-design

如何使新闻提要“友好”的数据库设计，以便将所有项目（查询）放入新闻提要中不会非常昂贵？我能想到的唯一方法是联合几乎每个表（代表组、笔记、朋友等）并获取日期等，这似乎是为每个用户运行一个非常昂贵的查询，而且由于每个人都不同，因此很难缓存类似的东西。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-21T03:57:30.807

首先，考虑做一个性能原型来检查你对联合太昂贵的预感。您可能过早地优化了一些不是问题的东西。

如果这是一个真正的问题，请考虑一个纯粹为保存事件源数据而设计的表，该表必须与其他表并行更新。

例如，当您创建注释记录时，还要在事件表中创建一个事件记录，其中包含日期、描述和所涉及的用户。

考虑基于 UserId（或 UserId 和 Date）索引 Event 表。还可以考虑在不再需要时清除旧数据。

这不是一个规范化的模式，但如果获取事件提要是一种频繁的操作，它可能会更快。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T23:58:20.440

UNION = 昂贵，因为完整的结果集受制于 DISTINCT 操作。UNION ALL = 更便宜，因为它实际上是多个查询，每个查询的结果都附加在一起。

这取决于数据量或课程。

效率的主要驱动力是联合在一起的单个查询，但是没有理由为什么从 10 个表中的每一个表中选择最近的（比如）10 条记录应该花费不到一秒钟的时间。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-07T23:23:33.240

没有模式很难回答这个问题，但我的直觉是，涉及 10 个或更多正确索引的表的 UNION 什么都不是：
典型的 LAMP 应用程序，如 wordpress 或 PHPBB，每次浏览量运行超过 10 个查询而没有问题。所以不用担心。

# asp.net - request.params 项目在回发后消失

> ID：307753
> 
> 赞同：2
> 
> 时间：2008-11-21T03:35:37.450
> 
> 标签：asp.net, parameters, request

我有一个具有请求项的 ASP.net 应用程序，该请求项在多次回发后消失。回发仅用于验证和 ajax 调用。会话没有重置，因为我在 params 集合中仍然有大约 60 个项目。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-02-21T17:15:15.747

是否可能正在消失的值通过表单 POST 添加到集合中，并且后续调用正在发出 GET 请求（通过 AJAX 等）？params 集合与“会话”对象的不同之处在于它存在于当前 HttpRequest 的上下文中。

# c# - 关于构造/格式化 LINQ to XML 查询的最佳方式的建议？

> ID：307757
> 
> 赞同：5
> 
> 时间：2008-11-21T03:37:01.690
> 
> 标签：c#, xml, linq, linq-to-xml

我已经编写了一个 LINQ to XML 查询，它可以满足我的要求，但它看起来很丑。我想知道，你们如何以一种看起来不那么花哨的方式格式化以下查询？

抱歉，如果我的示例有点冗长。

我正在查询的 XML 文档具有以下结构：

```
<?xml version="1.0" encoding="iso-8859-1"?>
<newsitem itemid="1" id="root" date="1996-08-20" xml:lang="en">
    <title>A title</title>
    <headline>A headline</headline>
    <dateline>A dateline</dateline>
    <text>
        Some text
    </text>
    <metadata>
        <codes class="">
            <code code="">
                <editdetail attribution=""/>
            </code>
        </codes>
        <dc element="dc.date.created" value=""/>
        <dc element="dc.publisher" value=""/>
        <dc element="dc.date.published" value=""/>
        <dc element="dc.source" value=""/>
        <dc element="dc.creator.location" value=""/>
        <dc element="dc.creator.location.country.name" value=""/>
        <dc element="dc.source" value=""/>
    </metadata>
</newsitem> 
```

以及相应的 LINQ 查询：

```
XElement dummy = new XElement("dummy");
var query = from article in newsdoc.Elements("newsitem").DefaultIfEmpty(dummy)
            select new
            {
                NewsItemID = (int)article.Attribute("itemid"),
                Date = (DateTime)article.Attribute("date"),
                Title = (string)article.Element("title"),
                Headline = (string)article.Element("headline"),
                ByLine = (string)article.Element("byline"),
                DateLine = (string)article.Element("dateline"),
                NewsText = (string)article.Element("text"),
                Publisher = (string)article.Elements("metadata").Elements("dc").Where(x => (string)x.Attribute("element") == "dc.publisher").Attributes("value").DefaultIfEmpty().ElementAt(0),
                DatePublished = (DateTime)article.Elements("metadata").Elements("dc").Where(x => (string)x.Attribute("element") == "dc.date.published").Attributes("value").DefaultIfEmpty().ElementAt(0),
                Source = (string)article.Elements("metadata").Elements("dc").Where(x => (string)x.Attribute("element") == "dc.source").Attributes("value").DefaultIfEmpty().ElementAt(0),
                CreatorLocation = (string)article.Elements("metadata").Elements("dc").Where(x => (string)x.Attribute("element") == "dc.creator.location").Attributes("value").DefaultIfEmpty().ElementAt(0),
                CreatorLocationCountryName = (string)article.Elements("metadata").Elements("dc").Where(x => (string)x.Attribute("element") == "dc.creator.location.country.name").Attributes("value").DefaultIfEmpty().ElementAt(0),
                Codes = article.Elements("metadata").Elements("codes").Elements("code").Attributes("code").DefaultIfEmpty()
            }; 
```

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T05:01:26.217

主要的“丑陋”是底部的东西。我可能会添加一个扩展方法（或只是一个实用方法） - 比如：

```
 public static XAttribute GetMetadata(this XElement parent, string key)
    {
        return parent.Elements("metadata").Elements("dc")
                 .FirstOrDefault(x => x.Attribute("element").Value == key)
                 .Attribute("value");
    } 
```

那么你应该能够使用类似的东西：

```
Publisher = (string)article.GetMetadata("dc.publisher"); 
```

（未选中）

# delphi - 有什么方法可以限制 CodeCentral Web Service 返回的项目数量

> ID：307759
> 
> 赞同：2
> 
> 时间：2008-11-21T03:37:59.130
> 
> 标签：delphi, service

我正在从 CodeGear 网站为 CodeCentral Web 服务构建 Web 客户端。

我需要限制 CodeGear Web 服务的搜索操作返回的项目数，比如每页 10 个。这样我可以最大限度地减少网页的加载。

我只是不知道该怎么做。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T05:38:11.010

对不起，我不知道手头的答案。

我建议您联系 CodeGear 的 John Kaster。他会知道这一切的来龙去脉。我没有看到他在这里发帖。通常电子邮件是 [first initial][last name]@codegear.com。您也可以尝试在[开发者网络/CodeCentral 论坛上发帖](https://forums.codegear.com/forum.jspa?forumID=8)，我想 John 和他的团队将对此进行监控。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T05:53:05.833

你是对的。CodeCentral 页面上的搜索表单将最大条目数列为一个选项（“显示”选项），但不允许您选择该选项。并且尝试各种明显的参数值是行不通的。

我还没有尝试过，但是如果您研究 CodeCentral Expert，可能会对您有所帮助，这是一个帮助从 Delphi 和 C++ Builder 中搜索 CodeCentral 网站的软件包：http: [//dn.codegear.com/article/23023](http://dn.codegear.com/article/23023)

该软件包似乎很旧，因为该页面上的评论可以追溯到 2000 年，因此不能保证它可以与新站点一起使用。但是，通过archive.org 进行检查，CodeCentral 搜索页面似乎多年来一直保持不变，并且搜索页面，甚至缺少的“显示”选项，在这段时间里都没有改变。

即使包不起作用，也可能包会为您提供调用其搜索所需的正确参数。

否则，您必须按照之前的回答发送电子邮件。

# visual-studio-2005 - 我在 VS 2005 中的 ActiveX DLL 项目模板在哪里？

> ID：307763
> 
> 赞同：1
> 
> 时间：2008-11-21T03:40:44.010
> 
> 标签：visual-studio-2005, vb6, templates, activex

在 VB6 中，ActiveX DLL 被列为项目模板，但在 VS 2005+ 中没有这样的东西。我的旧 ActiveX DLL 模板在哪里？提前谢谢了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T13:25:03.317

几个概念；.NET 程序集在功能上等同于 .NET 语言中的 ActiveX DLL。.NET 类和方法可以用在不同上下文中具有不同含义的属性进行修饰。通过使用各种属性分配正确的 GUID，可以将 .NET 程序集转换为 ActiveX/COM DLL（或 OCX）。

[此处](http://support.microsoft.com/kb/817248)是设置 .NET 程序集使用 COM 的基本概述。

请注意，谷歌搜索应该包括 VB6 .NET 和 COM（不是 ActiveX）。COM 产生更多的点击，因为它是 ActiveX 术语背后的基础技术。

我链接的 MSDN 文章显示了 .NET 类的基本 COM 设置。这里的属性是 ComClass Attribute。

```
<ComClass(ComClass1.ClassId, ComClass1.InterfaceId, ComClass1.EventsId)> _
Public Class ComClass1

#Region "COM GUIDs"
    ' These  GUIDs provide the COM identity for this class 
    ' and its COM interfaces. If you change them, existing 
    ' clients will no longer be able to access the class.
    Public Const ClassId As String = "6DB79AF2-F661-44AC-8458-62B06BFDD9E4"
    Public Const InterfaceId As String = "EDED909C-9271-4670-BA32-109AE917B1D7"
    Public Const EventsId As String = "17C731B8-CE61-4B5F-B114-10F3E46153AC"
#End Region

    ' A creatable COM class must have a Public Sub New() 
    ' without parameters. Otherwise, the class will not be 
    ' registered in the COM registry and cannot be created 
    ' through CreateObject.
    Public Sub New()
        MyBase.New()
    End Sub

End Class 
```

如果您尝试用 .NET 程序集替换现有的 COM DLL 或 OCX，还有其他一些特别有用的属性。最后，.NET 有许多不同的向导可以帮助您处理繁琐的细节。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T04:01:49.083

试试这个： http: [//msmvps.com/blogs/pauldomag/archive/2006/08/16/107758.aspx](http://msmvps.com/blogs/pauldomag/archive/2006/08/16/107758.aspx)

它概述了如何创建一个 activex 控件并在网页中使用它。据我所知，实际上没有“ActiveX”项目模板，因为 .NET 的做法不同。但是，您可以使您的 .Net 控件对 COM 世界可见，如上面的文章所示。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-16T21:34:30.230

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-22T18:16:22.463

你的问题不是很清楚，但如果你想能够在 VB6（或其他一些 com 环境）中使用在 VS2005 中创建的东西，你想看看[Interop Forms Toolkit](http://msdn.microsoft.com/en-us/vbasic/bb419144.aspx)。这极大地简化了 VB6 和 VS2005 之间的互操作。现在，如果您真的想分发这些应用程序，安装您创建的应用程序会变得更有趣（提示：不要使用 GAC，将 .Net dll 安装在与应用程序可执行文件相同的目录中，并学习使用 RegAsm。）

如果您稍微描述一下您想要将 ActiveX.dll 用于什么（项目库或用户控件）以及您想要使用它的环境，可以给出更多建议。

# c++ - 如何检查对象的类型是否是 C++ 中的特定子类？

> ID：307765
> 
> 赞同：98
> 
> 时间：2008-11-21T03:41:51.010
> 
> 标签：c++, class, subclass, identification

我正在考虑使用的思路，`typeid()`但我不知道如何询问该类型是否是另一个类的子类（顺便说一下，它是抽象的）

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2008-11-21T04:01:30.380

```
class Base
{
  public: virtual ~Base() {}
};

class D1: public Base {};

class D2: public Base {};

int main(int argc,char* argv[]);
{
  D1   d1;
  D2   d2;

  Base*  x = (argc > 2)?&d1:&d2;

  if (dynamic_cast<D2*>(x) == nullptr)
  {
    std::cout << "NOT A D2" << std::endl;
  }
  if (dynamic_cast<D1*>(x) == nullptr)
  {
    std::cout << "NOT A D1" << std::endl;
  }
} 
```

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-11-21T03:57:27.000

你真的不应该。如果您的程序需要知道对象是什么类，那通常表明存在设计缺陷。看看你是否可以使用虚函数获得你想要的行为。此外，有关您正在尝试做的事情的更多信息会有所帮助。

我假设你有这样的情况：

```
class Base;
class A : public Base {...};
class B : public Base {...};

void foo(Base *p)
{
  if(/* p is A */) /* do X */
  else /* do Y */
} 
```

如果这是您所拥有的，请尝试执行以下操作：

```
class Base
{
  virtual void bar() = 0;
};

class A : public Base
{
  void bar() {/* do X */}
};

class B : public Base
{
  void bar() {/* do Y */}
};

void foo(Base *p)
{
  p->bar();
} 
```

**编辑：**由于关于这个答案的争论在这么多年后仍在继续，我想我应该提供一些参考资料。如果你有一个基类的指针或引用，并且你的代码需要知道对象的派生类，那么它就违反了[Liskov 替换原则](https://en.wikipedia.org/wiki/Liskov_substitution_principle)。[Bob 大叔](http://www.objectmentor.com/omTeam/martin_r.html)将此称为“[对面向对象设计的诅咒](http://www.objectmentor.com/resources/articles/lsp.pdf)”。

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2008-11-21T04:05:46.517

您可以使用`dynamic_cast`（至少对于多态类型）来做到这一点。

实际上，再想一想——你无法判断它是否是特定的类型`dynamic_cast`——但你可以判断它是那个类型还是它的任何子类。

```
template <class DstType, class SrcType>
bool IsType(const SrcType* src)
{
  return dynamic_cast<const DstType*>(src) != nullptr;
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2019-07-10T19:39:58.993

下面的代码演示了 3 种不同的方法：

*   虚函数
*   类型标识
*   dynamic_cast

```
#include <iostream>
#include <typeinfo>
#include <typeindex>

enum class Type {Base, A, B};

class Base {
public:
    virtual ~Base() = default;
    virtual Type type() const {
        return Type::Base;
    }
};

class A : public Base {
    Type type() const override {
        return Type::A;
    }
};

class B : public Base {
    Type type() const override {
        return Type::B;
    }
};

int main()
{
    const char *typemsg;
    A a;
    B b;
    Base *base = &a;             // = &b;    !!!!!!!!!!!!!!!!!
    Base &bbb = *base;

    // below you can replace    base    with  &bbb    and get the same results

    // USING virtual function
    // ======================
    // classes need to be in your control
    switch(base->type()) {
    case Type::A:
        typemsg = "type A";
        break;
    case Type::B:
        typemsg = "type B";
        break;
    default:
        typemsg = "unknown";
    }
    std::cout << typemsg << std::endl;

    // USING typeid
    // ======================
    // needs RTTI. under gcc, avoid -fno-rtti
    std::type_index ti(typeid(*base));
    if (ti == std::type_index(typeid(A))) {
        typemsg = "type A";
    } else if (ti == std::type_index(typeid(B))) {
        typemsg = "type B";
    } else {
        typemsg = "unknown";
    }
    std::cout << typemsg << std::endl;

    // USING dynamic_cast
    // ======================
    // needs RTTI. under gcc, avoid -fno-rtti
    if (dynamic_cast</*const*/ A*>(base)) {
        typemsg = "type A";
    } else if (dynamic_cast</*const*/ B*>(base)) {
        typemsg = "type B";
    } else {
        typemsg = "unknown";
    }
    std::cout << typemsg << std::endl;
} 
```

上面的程序打印了这个：

```
type A
type A
type A 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-21T04:49:14.400

`dynamic_cast`可以确定该类型是否在继承层次结构中的任何位置包含目标类型（是的，这是一个鲜为人知的功能，如果从and`B`继承，它可以将 an直接变成 a ）。可以确定对象的确切类型。但是，这些都应该非常谨慎地使用。正如已经提到的，您应该始终避免动态类型识别，因为它表明存在设计缺陷。（另外，如果您知道该对象肯定是目标类型，您可以使用. 进行向下转换。Boost 提供了 a将在调试模式下进行向下转换，而在发布模式下它只会使用 a ）。`A``C``A*``C*``typeid()``static_cast``polymorphic_downcast``dynamic_cast``assert``static_cast`

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-11-21T16:43:50.340

我不知道我是否正确理解了您的问题，所以让我用我自己的话重述一下...

问题：给定类`B`和`D`，确定是否`D`是 的子类`B`（反之亦然？）

解决方案：使用一些模板魔法！好的，您需要认真看看 LOKI，这是一个由传说中的 C++ 作者 Andrei Alexandrescu 制作的优秀模板元编程库。

更具体地说，在您的源代码中下载[LOKI](http://loki-lib.sourceforge.net/index.php?n=Main.HomePage)`TypeManip.h`并从中包含标头，然后使用`SuperSubclass`类模板，如下所示：

```
if(SuperSubClass<B,D>::value)
{
...
} 
```

根据文档，`SuperSubClass<B,D>::value`如果`B`是 的公共基础`D`，或者如果`B`和`D`是相同类型的别名，则为真。

即要么`D`是 的子类，`B`要么`D`与 相同`B`。

我希望这有帮助。

**编辑：**

请注意，与某些使用 的方法不同，评估`SuperSubClass<B,D>::value`发生在编译时`dynamic_cast`，因此在运行时使用此系统不会受到任何惩罚。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-12-19T21:31:12.200

我不同意您永远不想在 C++ 中检查对象的类型。如果你能避免它，我同意你应该这样做。说你在任何情况下都不应该这样做是太过分了。你可以用很多语言来做这件事，它可以让你的生活更轻松。例如，Howard Pinsley 在他关于 C# 的帖子中向我们展示了如何做到这一点。

我用 Qt 框架做了很多工作。一般来说，我按照他们做事的方式（至少在他们的框架中工作时）对我的工作进行建模。QObject 类是所有 Qt 对象的基类。该类具有函数 isWidgetType() 和 isWindowType() 作为快速子类检查。那么为什么不能检查你自己的派生类，这在本质上是可比的？这是从其他一些帖子中衍生出来的 QObject：

```
class MyQObject : public QObject
{
public:
    MyQObject( QObject *parent = 0 ) : QObject( parent ){}
    ~MyQObject(){}

    static bool isThisType( const QObject *qObj )
    { return ( dynamic_cast<const MyQObject*>(qObj) != NULL ); }
}; 
```

然后当你传递一个指向 QObject 的指针时，你可以通过调用静态成员函数来检查它是否指向你的派生类：

```
if( MyQObject::isThisType( qObjPtr ) ) qDebug() << "This is a MyQObject!"; 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2017-05-26T17:00:59.740

```
#include <stdio.h>
#include <iostream.h>

class Base
{
  public: virtual ~Base() {}

  template<typename T>
  bool isA() {
    return (dynamic_cast<T*>(this) != NULL);
  }
};

class D1: public Base {};
class D2: public Base {};
class D22: public D2 {};

int main(int argc,char* argv[]);
{
  D1*   d1  = new D1();
  D2*   d2  = new D2();
  D22*  d22 = new D22();

  Base*  x = d22;

  if( x->isA<D22>() )
  {
    std::cout << "IS A D22" << std::endl;
  }
  if( x->isA<D2>() )
  {
    std::cout << "IS A D2" << std::endl;
  }
  if( x->isA<D1>() )
  {
    std::cout << "IS A D1" << std::endl;
  }
  if(x->isA<Base>() )
  {
    std::cout << "IS A Base" << std::endl;
  }
} 
```

结果：

```
IS A D22
IS A D2
IS A Base 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-06-06T22:31:34.963

> 我在考虑使用`typeid()`...

嗯，是的，可以通过比较来完成：`typeid().name()`. 如果我们采用已经描述的情况，其中：

```
class Base;
class A : public Base {...};
class B : public Base {...};

void foo(Base *p)
{
  if(/* p is A */) /* do X */
  else /* do Y */
} 
```

一个可能的实现`foo(Base *p)`是：

```
#include <typeinfo>

void foo(Base *p)
{
    if(typeid(*p) == typeid(A))
    {
        // the pointer is pointing to the derived class A
    }  
    else if (typeid(*p).name() == typeid(B).name()) 
    {
        // the pointer is pointing to the derived class B
    }
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2021-06-07T06:04:08.643

我在这里看到了一些很好的答案，我看到了一些愚蠢的回应。

“试图查询对象的类型是一个设计缺陷”。这意味着Java instanceof 和C# 是关键字是设计缺陷。这些是不评价多态性的人的反应。如果您有一个接口，则该接口是由另一个实现更多功能的接口派生的。如果您需要这些额外的功能，您必须首先检查您是否有这样的接口。甚至微软的 COM API 也使用了这种设计。

那么在如何推断一个对象是否是一个类的实例方面，已经给出了很多很好的答案

*   类型标识
*   具有虚类型函数
*   动态演员表

is_base_of 与多态无关。

并且让每个虚函数定义自己的类型方法是不必要的，因为它是多余的。每个虚拟类已经有一个指向它的虚拟表的指针。

```
class Base
{
 void *p_virtual_table = BASE_VIRTUAL_TABLE;
}

class Derived : Base
{
 void *p_virtual_table = DERIVED_VIRTUAL_TABLE;
}

void *BASE_VIRTUAL_TABLE[n];
void *DERIVED_VIRTUAL_TABLE[n]; 
```

这里的重点是虚拟表的地址是固定的，一个简单的比较将决定一个虚拟对象是否是一个虚拟类的实例。

由于 cpp 没有为我们提供访问虚拟表的标准方法，因此很难手动进行这些比较。但是 cpp 抽象机在推断虚拟对象的确切实例时绝对没有问题。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-21T03:55:55.040

除非您使用 RTTI，否则您只能在编译时使用模板执行此操作。

它允许您使用 typeid 函数，该函数将产生一个指向 type_info 结构的指针，该结构包含有关类型的信息。

[在维基百科](http://en.wikipedia.org/wiki/Run-time_type_information)上阅读它

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-12-20T13:16:26.117

您可以使用**模板**（或**SFINAE**（替换失败不是错误））来完成。例子：

```
#include <iostream>

class base
{
public:
    virtual ~base() = default;
};

template <
    class type,
    class = decltype(
        static_cast<base*>(static_cast<type*>(0))
    )
>
bool check(type)
{
    return true;
}

bool check(...)
{
    return false;
}

class child : public base
{
public:
    virtual ~child() = default;
};

class grandchild : public child {};

int main()
{
    std::cout << std::boolalpha;

    std::cout << "base:       " << check(base())       << '\n';
    std::cout << "child:      " << check(child())      << '\n';
    std::cout << "grandchild: " << check(grandchild()) << '\n';
    std::cout << "int:        " << check(int())        << '\n';

    std::cout << std::flush;
} 
```

输出：

```
base:       true
child:      true
grandchild: true
int:        false 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-21T03:49:24.663

在 c# 中，您可以简单地说：

```
if (myObj is Car) {

} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-11-04T21:00:14.243

作为多个其他答案的衍生（包括我之前发布的答案！），这里有一个宏可以提供帮助：

```
#define isInstance( ptr, clazz ) (dynamic_cast<const clazz*>(ptr) != NULL) 
```

# asp.net - 从网站转换为 Web 应用程序项目后编译错误

> ID：307766
> 
> 赞同：2
> 
> 时间：2008-11-21T03:43:28.887
> 
> 标签：asp.net, asp.net-ajax, ajaxcontroltoolkit, web-site-project, web-application-project

[我正在尝试将网站转换为 Web 应用程序项目模型，但我遇到了编译错误，我在将网站项目转换为 Web 应用程序项目中](http://msdn.microsoft.com/en-us/library/aa983476.aspx)找到的指导似乎并未涵盖这些错误。

问题是作为子控件嵌入在 Ajax 控件工具包的 TabContainer/TabPanel 的 ContentTemplate 中的标准 ASP.NET 控件不再对页面可见（并导致编译错误）。似乎它们只能通过调用 FindControl 来引用，而当项目是网站时，它们可以在页面的代码隐藏文件中作为属性直接访问。

不幸的是，我们有很多使用 TabContainer 的 Web 表单，并且将所有对子控件的引用从简单的属性引用转换为 FindControl 调用将非常繁琐。

在研究这个问题时，我发现[单实例模板](http://www.nikhilk.net/SingleInstanceTemplates.aspx)中一个名为 TemplateInstance 的属性的引用似乎很有希望，但我知道这适用于控件设计者，而不是控件用户。任何帮助将非常感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-21T20:13:00.560

我想我会再补充一点。该问题并非特定于 Ajax Control Toolkit 的 TabContainer。事实上，我有一个 FormView 控件，并且 ItemTemplate 中的所有子控件不再被编译器识别为页面的属性，并导致编译错误。我不敢相信我必须更改所有这些属性引用以在整个表单中调用 findcontrol ，因为我从 Web 站点移动到 Web 应用程序项目。:-(

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-11T20:24:25.463

我很想知道您解决此问题的最终决定是什么。

阅读您的帖子，与我自己当前的网络应用程序转换研究相比，我决定冒险并推荐您访问[此](http://msdn.microsoft.com/en-us/magazine/cc163675.aspx)页面，希望它可以帮助您了解代码隐藏文件在转换和编译时会发生什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-22T18:43:58.563

您是否通过“转换为 Web 应用程序...”为所有控件生成了设计器文件？

# asp.net-mvc - ASP.NET MVC 站点中的 RESTful “杂项”页面？

> ID：307772
> 
> 赞同：1
> 
> 时间：2008-11-21T03:46:22.110
> 
> 标签：asp.net-mvc, rest

想象一下，我们在 ASP.NET MVC 中做这个 StackOverflow 站点（有趣的是，因为它是......）。我们必须发展观点：

*   关于本站
*   常问问题
*   隐私政策
*   404页
*   错误页面
*   ETC...

现在，因为我们想要保持这种 RESTful 风格，因为我们正在尝试增加我们的 RESTafarian Geek-fro，所以我们是否将它们放入一个名为 .. (eeks... er..) MiscellaneousController 或 FrameworkController 或 Controller ..每个人都有自己的行动方法......

或者

我们是否每个都有一个控制器，并且这些控制器中的每一个都有它自己的索引操作。

现在，从技术上讲，我知道你可以做到这一点。所以这不是关于如何在技术上做到这一点的问题。如果保持良好且嬉皮的 RESTful 方式，则更多的是关于正确的实践。

想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T03:52:13.063

如果我理解正确，“REST”将来自您的路由而不是您的控制器。

如果您的意思是根据 MVC 编程技术应该采用哪种方式，我会很想创建一个带有“通用”或“索引”方法的 MiscController，该方法采用 id/topic 参数，然后呈现页面。

这是因为所有这些页面的操作都是相同的——渲染一些通用内容。

通过这种方式，他们都可以使用相同的视图，并且可能只是从数据库中读取显示文本。

如果您要对每个部分有不同的视图，我会为每个部分使用不同的操作。

我倾向于为任何站点“段”或分组功能使用新控制器，并为每个可能的视图或执行操作使用一个操作。

# c# - 如何在 c# 中列出 .zip 文件夹的内容？

> ID：307774
> 
> 赞同：31
> 
> 时间：2008-11-21T03:47:00.843
> 
> 标签：c#, list, directory, zip

如何在 C# 中列出压缩文件夹的内容？例如，如何知道压缩文件夹中包含多少项目，它们的名称是什么？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2014-02-13T23:28:30.037

.NET 4.5 或更高版本最终具有使用该类处理通用 zip 文件的内置功能`System.IO.Compression.ZipArchive`( [http://msdn.microsoft.com/en-us/library/system.io.compression.ziparchive%28v=vs.110% 29.aspx](http://msdn.microsoft.com/en-us/library/system.io.compression.ziparchive%28v=vs.110%29.aspx) ) 在汇编 System.IO.Compression 中。不需要任何 3rd 方库。

```
string zipPath = @"c:\example\start.zip";
using (ZipArchive archive = ZipFile.OpenRead(zipPath))
{
    foreach (ZipArchiveEntry entry in archive.Entries)
    {
        Console.WriteLine(entry.FullName);
    }
} 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-11-21T03:53:47.070

[DotNetZip](http://www.codeplex.com/DotNetZip) - .NET 语言中的 Zip 文件操作

DotNetZip 是一个小型、易于使用的类库，用于处理 .zip 文件。它可以使用 VB.NET、C#、任何 .NET 语言编写的 .NET 应用程序轻松创建、读取和更新 zip 文件。

读取 zip 的示例代码：

```
using (var zip = ZipFile.Read(PathToZipFolder))
{
    int totalEntries = zip.Entries.Count; 
    foreach (ZipEntry e in zip.Entries)
    {
        e.FileName ...
        e.CompressedSize ...
        e.LastModified...
    }
} 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-11-21T04:03:09.843

如果您使用的是 .Net Framework 3.0 或更高版本，请查看[System.IO.Packaging 命名空间](http://msdn.microsoft.com/en-us/library/system.io.packaging.aspx "MSDN - System.IO.Packaging 命名空间")。这将消除您对外部库的依赖。

具体检查[ZipPackage 类](http://msdn.microsoft.com/en-us/library/system.io.packaging.zippackage.aspx "MSDN - ZipPackage 类")。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-11-21T03:49:16.487

检查[SharpZipLib](http://icsharpcode.net/OpenSource/SharpZipLib)

```
ZipInputStream inStream = new ZipInputStream(File.OpenRead(fileName));

while (inStream.GetNextEntry())
{

     ZipEntry entry = inStream.GetNextEntry();
     //write out your entry's filename
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-01-04T04:24:15.743

Ick - 使用 J# 运行时的代码太可怕了！而且我不同意这是最好的方法 - J# 现在不支持了。它是一个巨大的运行时，如果你想要的只是 ZIP 支持。

这个怎么样 - 它使用[DotNetZip](http://www.codeplex.com/DotNetZip)（免费，MS-公共许可证）

```
using (ZipFile zip = ZipFile.Read(zipfile) )
{
    bool header = true;
    foreach (ZipEntry e in zip)
    {
        if (header)
        {
            System.Console.WriteLine("Zipfile: {0}", zip.Name);
            if ((zip.Comment != null) && (zip.Comment != ""))
                System.Console.WriteLine("Comment: {0}", zip.Comment);

            System.Console.WriteLine("\n{1,-22} {2,9}  {3,5}   {4,9}  {5,3} {6,8} {0}",
                                     "Filename", "Modified", "Size", "Ratio", "Packed", "pw?", "CRC");
            System.Console.WriteLine(new System.String('-', 80));
            header = false;
        }

        System.Console.WriteLine("{1,-22} {2,9} {3,5:F0}%   {4,9}  {5,3} {6:X8} {0}",
                                 e.FileName,
                                 e.LastModified.ToString("yyyy-MM-dd HH:mm:ss"),
                                 e.UncompressedSize,
                                 e.CompressionRatio,
                                 e.CompressedSize,
                                 (e.UsesEncryption) ? "Y" : "N",
                                 e.Crc32);

        if ((e.Comment != null) && (e.Comment != ""))
            System.Console.WriteLine("  Comment: {0}", e.Comment);
    }
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-21T04:58:11.387

我在这里相对较新，所以也许我不明白发生了什么。:-) 此线程目前有 4 个答案，其中两个最佳答案已被否决。（Percewg 的和 cxfx 的） pearcewg 指出的文章很重要，因为它阐明了 SharpZipLib 的一些许可问题。我们最近评估了几个 .Net 压缩库，发现 DotNetZip 是目前最好的替代方案。

**非常简短的总结：**

*   System.IO.Packaging 比 DotNetZip 慢得多。

*   SharpZipLib 是 GPL - 见文章。

因此，对于初学者来说，我对这两个答案投了赞成票。

金。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-04-09T11:34:07.173

如果您像我一样不想使用外部组件，这里是我昨晚使用 .NET 的 ZipPackage 类开发的一些代码。

```
var zipFilePath = "c:\\myfile.zip";
var tempFolderPath = "c:\\unzipped";

using (Package package = ZipPackage.Open(zipFilePath, FileMode.Open, FileAccess.Read))
{
    foreach (PackagePart part in package.GetParts())
    {
        var target = Path.GetFullPath(Path.Combine(tempFolderPath, part.Uri.OriginalString.TrimStart('/')));
        var targetDir = target.Remove(target.LastIndexOf('\\'));

        if (!Directory.Exists(targetDir))
            Directory.CreateDirectory(targetDir);

        using (Stream source = part.GetStream(FileMode.Open, FileAccess.Read))
        {
            source.CopyTo(File.OpenWrite(target));
        }
    }
} 
```

注意事项：

*   ZIP 存档的根目录中必须有一个 [Content_Types].xml 文件。这对我的要求来说不是问题，因为我将控制通过此代码提取的任何 ZIP 文件的压缩。有关 [Content_Types].xml 文件的更多信息，请参阅：[A New Standard For Packaging Your Data](http://msdn.microsoft.com/en-us/magazine/cc163372.aspx) 在文章的图 13 下方有一个示例文件。

*   此代码使用 .NET 4.0 中的 Stream.CopyTo 方法

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-21T17:29:22.917

最好的方法是使用 .NET 内置的 J# zip 功能，如 MSDN 中所示：http: [//msdn.microsoft.com/en-us/magazine/cc164129.aspx](http://msdn.microsoft.com/en-us/magazine/cc164129.aspx)。在此链接中，有一个应用程序读取和写入 zip 文件的完整工作示例。对于列出 zip 文件（在本例中为 Silverlight .xap 应用程序包）内容的具体示例，代码可能如下所示：

```
 ZipFile package = new ZipFile(packagePath);
java.util.Enumeration entries = package.entries();
//We have to use Java enumerators because we
//use java.util.zip for reading the .zip files
while ( entries.hasMoreElements() )
{
    ZipEntry entry = (ZipEntry) entries.nextElement();

    if (!entry.isDirectory())
    {
        string name = entry.getName();
        Console.WriteLine("File: " + name + ", size: " + entry.getSize() + ", compressed size: " + entry.getCompressedSize());
    }
    else
    {
        // Handle directories...
    }                        
} 
```

艾兹曼有一个正确的指针，但有[问题](http://https://silverlight.net/forums/p/11394/36407.aspx)。具体来说，您可能会发现打开 zip 文件的问题，但如果您打算*只*创建 pacakges，这是一个有效的解决方案。ZipPackage 实现了抽象的 Package 类并允许对 zip 文件进行操作。在 MSDN 中有一个如何做到这一点的示例：http: [//msdn.microsoft.com/en-us/library/ms771414.aspx](http://msdn.microsoft.com/en-us/library/ms771414.aspx)。大致代码如下所示：

```
 string packageRelationshipType = @"http://schemas.microsoft.com/opc/2006/sample/document";
            string resourceRelationshipType = @"http://schemas.microsoft.com/opc/2006/sample/required-resource";
            // Open the Package.
            // ('using' statement insures that 'package' is
            //  closed and disposed when it goes out of scope.)
            foreach (string packagePath in downloadedFiles)
            {
                Logger.Warning("Analyzing " + packagePath);
                using (Package package = Package.Open(packagePath, FileMode.Open, FileAccess.Read))
                {
                    Logger.OutPut("package opened");
                    PackagePart documentPart = null;
                    PackagePart resourcePart = null;

                    // Get the Package Relationships and look for
                    //   the Document part based on the RelationshipType
                    Uri uriDocumentTarget = null;
                    foreach (PackageRelationship relationship in
                        package.GetRelationshipsByType(packageRelationshipType))
                    {
                        // Resolve the Relationship Target Uri
                        //   so the Document Part can be retrieved.
                        uriDocumentTarget = PackUriHelper.ResolvePartUri(
                            new Uri("/", UriKind.Relative), relationship.TargetUri);

                        // Open the Document Part, write the contents to a file.
                        documentPart = package.GetPart(uriDocumentTarget);
                        //ExtractPart(documentPart, targetDirectory);
                        string stringPart = documentPart.Uri.ToString().TrimStart('/');
                        Logger.OutPut("  Got: " + stringPart);
                    }

                    // Get the Document part's Relationships,
                    //   and look for required resources.
                    Uri uriResourceTarget = null;
                    foreach (PackageRelationship relationship in
                        documentPart.GetRelationshipsByType(
                                                resourceRelationshipType))
                    {
                        // Resolve the Relationship Target Uri
                        //   so the Resource Part can be retrieved.
                        uriResourceTarget = PackUriHelper.ResolvePartUri(
                            documentPart.Uri, relationship.TargetUri);

                        // Open the Resource Part and write the contents to a file.
                        resourcePart = package.GetPart(uriResourceTarget);

                        //ExtractPart(resourcePart, targetDirectory);
                        string stringPart = resourcePart.Uri.ToString().TrimStart('/');
                        Logger.OutPut("  Got: " + stringPart);
                    }

                }
            } 
```

最好的方法似乎是使用 J#，如 MSDN 所示：http: [//msdn.microsoft.com/en-us/magazine/cc164129.aspx](http://msdn.microsoft.com/en-us/magazine/cc164129.aspx)

有指向更多具有不同许可证的 c# .zip 库的指针，如本文中的 SharpNetZip 和 DotNetZip：[如何在 c# 中从未压缩的 zip 中读取文件？](https://stackoverflow.com/questions/265549/how-to-read-files-from-uncompressed-zip-in-c). 由于许可证要求，它们可能不适合。

# javascript - 如何在 JavaScript 匿名函数中声明时使用变量的值？

> ID：307777
> 
> 赞同：3
> 
> 时间：2008-11-21T03:48:40.700
> 
> 标签：javascript, jquery, closures

这是一个非常基本的问题，但是......

我有一些这样的代码

```
var arr = Array('blah.jpg','ha.jpg');
for (var i=0; i<array.length; i++)
{
    $('div#blah' + i).click(function() {
           $('img').attr('src', arr[i]); });
} 
```

这应该绑定 div`id="blah0"`以在单击时将所有图像更改为`'blah.jpg'`。同样，单击 div`id ="blah1"`应将所有图像更改为`'ha.jpg'`.

但是，匿名函数不起作用，因为它将在执行时使用 'i' 的值，即 2。这意味着单击任一 div 将尝试将所有图像设置为 arr[2] - 不存在元素（有趣的是没有在我的机器上抛出 JS 错误，但那是另一个故事......）。

如何在声明时使用“i”的值创建匿名函数？

作为一个更简单的例子：

```
for (var i=0; i<10; i++)
{
    $('div#blah'+i).click(function() {
       alert(i)); });
} 
```

当我单击“blah0”时，这应该显示“0”，当我单击“blah1”时显示“1”等。

但是，默认情况下，无论我点击哪个“blah”，它都会显示“10”。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-21T03:55:44.960

在函数中声明一个新变量，该变量创建一个新的单击处理程序，该处理程序将 i 的当前值作为参数：

```
function makeClickHandler(arr, local_i) {
    return function() {
        $('img').attr('src', arr[local_i]);
    };
}

var arr = Array('blah.jpg','ha.jpg');
for (var i=0; i<array.length; i++)
{
    $('div#blah' + i).click(makeClickHandler(arr, i));
} 
```

该函数的每个实例都有自己的 local_i 副本，每次都不会更改。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T04:53:06.203

在这种特殊情况下，您应该使用闭包：

```
for (var i=0; i<10; i++)
{
    (function(j){
        $('div#blah'+j).click(function() { alert(j)); });
    })(i);        
} 
```

`(function(){ /* code */ })()`表示一个自执行函数，这意味着它将在循环中立即使用和评估 i 的值，而不是在点击时。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T03:53:24.543

在循环中再添加 1 个变量，并在闭包中使用它后将其递增。

```
 var j = 0;
for (var i=0; i<array.length; i++)
{
    $('div#blah' + j).click(function() {
           $('img').attr('src', arr[i]); });

    j++;
} 

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T04:03:04.680

到目前为止我有这个答案，但有点破解：

```
var arr = Array('blah.jpg','ha.jpg');
for (var i=0; i<array.length; i++)
{
    eval("$('div#blah' + i).click(function() { $('img').attr('src', arr[" + i + "]); })");
} 
```

还：

```
for (var i=0; i<10; i++)
{
    eval("$('div#blah'+i).click(function() { alert(" + i + ")); });");
} 
```

# ruby - 通过 RStakeout 运行 RSpec 时如何启用颜色？

> ID：307783
> 
> 赞同：2
> 
> 时间：2008-11-21T03:51:06.750
> 
> 标签：ruby, rspec

使用 topfunky 的[RStakeout](http://nubyonrails.com/articles/automation-with-rstakeout)时，命令结果中的颜色`spec`会丢失。即使添加`--color`标志也会发生这种情况。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-12-14T04:13:32.617

我能够`--tty`在我的 .rspec 文件中使用它（使用 Rails 3.0.3 和 rspec 2.3）。我认为它`--autotest`适用于旧版本的 2.0。经过一个小时的搜索，在这里找到了它 - [https://github.com/tomas-stefano/infinity_test](https://github.com/tomas-stefano/infinity_test)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T03:53:49.257

您必须将环境变量设置`AUTOTEST`为 true。Spec 检测它是否正在由进程运行，如果是则禁用颜色（以使输出更易于解析）。

在 bash 中设置环境变量：

```
export AUTOTEST=true 
```

或在鱼中：

```
set -x AUTOTEST true 
```

（-x 导出变量）

# php - 如何在目录中的每个文件中将 'php3' 替换为 'php'

> ID：307796
> 
> 赞同：1
> 
> 时间：2008-11-21T03:58:27.577
> 
> 标签：php, regex, string, bash, replace

希望是一个不错的简单的。

我有一个 php3 网站，我想在 php 5.2 上运行

首先，我只想将当前“index.php3”_within_each_file_（递归）的所有引用更改为“index.php”，然后继续担心全局变量等。

K. 去吧！

:)

更新：非常感谢！我意识到我的问题错过了引用在网站的每个文件中的事实，我想在所有文件/文件夹中递归地执行此操作。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-21T06:29:37.863

```
find -type f -exec perl -pi -e 's/\bindex\.php3\b/index.php/g' {} \; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T04:05:23.770

怎么样：

```
for file in *.php3
do
    sed 's/\.php3/.php/g' $file > ${file%3}
done 
```

for/do/done 循环依次处理每个 .php3 文件，编辑文件并将每个字符串替换`.php3`为`.php`，并将文件从 something.php3 复制到 something.php。

*为修改后的问题添加：*

```
for file in $(find . -type f -name '*.php3' -print)
do
    sed 's/\.php3/.php/g' $file > ${file%3}
done 
```

' `-print`' 现在通常可以省略，但从历史上看，很多机器时间被忘记添加它的人浪费了，因为最初（POSIX 之前）没有默认操作。

这个片段是关于对原始代码进行最简单的修改以执行扩展任务，但不一定是最好的方法 - 它在处理任何文件之前预先生成整个文件列表。您可以改为使用：

```
find . -type f -name '*.php3' -print |
while read file
do
    sed 's/\.php3/.php/g' $file > ${file%3}
done 
```

但是，如果文件名或路径名可以包含空格或换行符或其他此类字符，则两个修订版本都可能会遇到问题。为避免此类问题，您必须更加努力——使用 Perl 或 (GNU find + xargs) 或其他一些技术。如果你头脑清醒，你就可以避免这些问题。如果您继承了一个不太健全的设置，那么您可能需要更深入地研究 Unix 文件名处理的奥秘。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T04:04:07.720

`sed -i 's/php3/php/g' *`

假设您使用的是类 unix 操作系统。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T05:49:16.730

要递归地执行此操作，请使用 Jonathan 的答案，但替换`find . -type f`*.php3。请注意，反引号很重要，您可以将任何目录替换为“。” （即当前目录）。这是一个在进程中重命名文件的版本 (*.php3 -> *.php)。

```
#!/bin/bash
for file in `find . -type f`
do
    sed 's/\.php3/\.php/g' $file > ${file//3/}
    rm $file
done 
```

# c# - 如何在 .NET 中每小时（或每小时特定时间间隔）引发一个事件？

> ID：307798
> 
> 赞同：31
> 
> 时间：2008-11-21T03:59:15.717
> 
> 标签：c#, .net, scheduled-tasks

我正在开发一个小型网络爬虫，它将在系统托盘中运行并每小时整点爬取一个网站。

让 .NET 每小时或其他间隔引发事件以执行某些任务的最佳方法是什么。例如，我想根据时间每 20 分钟运行一次活动。该活动将在以下地点提出：

```
00:20
00:40
01:00
01:20
01:40 
```

等等。我能想到的最好方法是在线程上创建一个循环，不断检查时间是否可以被给定的时间间隔整除，如果达到时间则引发回调事件。我觉得必须有更好的方法。

我会使用 a`Timer`但我更喜欢遵循按小时运行的“时间表”或类似的东西。

如果没有在 Windows 任务计划程序中设置我的应用程序，这可能吗？

**更新：**
我正在添加我的算法来计算计时器的时间间隔。此方法采用“ `minute`”参数，即计时器应触发滴答的时间。例如，如果 " `minute`" 参数为 20，则计时器将按上面时间表中的间隔计时。

```
int CalculateTimerInterval(int minute)
{
    if (minute <= 0)
        minute = 60;
    DateTime now = DateTime.Now;

    DateTime future = now.AddMinutes((minute - (now.Minute % minute))).AddSeconds(now.Second * -1).AddMilliseconds(now.Millisecond * -1);

    TimeSpan interval = future - now;

    return (int)interval.TotalMilliseconds;
} 
```

这段代码的使用如下：

```
static System.Windows.Forms.Timer t;
const int CHECK_INTERVAL = 20;

static void Main()
{
    t = new System.Windows.Forms.Timer();
    t.Interval = CalculateTimerInterval(CHECK_INTERVAL);
    t.Tick += new EventHandler(t_Tick);
    t.Start();
}

static void t_Tick(object sender, EventArgs e)
{
    t.Interval = CalculateTimerInterval(CHECK_INTERVAL);
} 
```

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-11-21T04:01:53.560

[系统.计时器.计时器](http://msdn.microsoft.com/en-us/library/system.timers.timer.interval.aspx)。如果您想在一天中的特定时间跑步，您将需要计算距离下一次跑步还有多长时间，并将其设置为您的时间间隔。

这只是基本的想法。根据您需要的精确程度，您可以做得更多。

```
int minutes = DateTime.Now.Minute;
int adjust = 10 - (minutes % 10);
timer.Interval = adjust * 60 * 1000; 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-21T04:03:34.587

您可以从 Quartz.net [http://quartznet.sourceforge.net/获得帮助](http://quartznet.sourceforge.net/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-21T06:35:56.540

这是一个使用线程计时和异步调用的轻量级系统示例。

我知道有一些缺点，但我喜欢在启动长时间运行的进程（如计划的后端服务）时使用它而不是计时器。由于它在计时器线程中内联运行，因此您不必担心它会在原始调用完成之前再次启动。这可以扩展很多，使其使用日期时间数组作为触发时间，或者为其添加更多功能。我相信你们中的一些人知道一些更好的方法。

```
 public Form1()
    {
        InitializeComponent();

        //some fake data, obviously you would have your own.
        DateTime someStart = DateTime.Now.AddMinutes(1);
        TimeSpan someInterval = TimeSpan.FromMinutes(2);

        //sample call
        StartTimer(someStart,someInterval,doSomething);
    }

    //just a fake function to call
    private bool doSomething()
    {
        DialogResult keepGoing = MessageBox.Show("Hey, I did something! Keep Going?","Something!",MessageBoxButtons.YesNo);
        return (keepGoing == DialogResult.Yes);
    }

    //The following is the actual guts.. and can be transplanted to an actual class.
    private delegate void voidFunc<P1,P2,P3>(P1 p1,P2 p2,P3 p3);
    public void StartTimer(DateTime startTime, TimeSpan interval, Func<bool> action)
    {
        voidFunc<DateTime,TimeSpan,Func<bool>> Timer = TimedThread;
        Timer.BeginInvoke(startTime,interval,action,null,null);
    }

    private void TimedThread(DateTime startTime, TimeSpan interval, Func<bool> action)
    {
        bool keepRunning = true;
        DateTime NextExecute = startTime;
        while(keepRunning)
        {
            if (DateTime.Now > NextExecute)
            {
                keepRunning = action.Invoke();
                NextExecute = NextExecute.Add(interval);
            }
            //could parameterize resolution.
            Thread.Sleep(1000);
        }            
    } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-03T23:26:34.893

另一种策略是记录进程运行的最后时间，并确定自该时间以来您所需的时间间隔是否已过。在此策略中，如果经过的时间等于或大于所需的时间间隔，您将编写要触发的事件。通过这种方式，您可以处理如果计算机因某种原因停机时可能会错过长时间间隔（例如，每天一次）的情况。

例如：

*   lastRunDateTime = 2009 年 5 月 2 日晚上 8 点
*   我想每 24 小时运行一次我的进程
*   在计时器事件中，检查自上次运行进程以来是否经过了 24 小时或更长时间。
*   如果是，请运行该过程，通过向其添加所需的时间间隔来更新 lastRunDateTime（在这种情况下为 24 小时，但无论您需要它是什么）

显然，为了在系统关闭后恢复，您需要将 lastRunDateTime 存储在某个文件或数据库中，以便程序可以在恢复时从中断处继续。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-21T04:00:26.277

System.Windows.Forms.Timer（或 System.Timers.Timer）

但是既然现在你说你不想使用定时器，你可以在另一个线程上运行一个轻量级的等待进程（检查时间，睡眠几秒钟，再次检查时间......）或制作一个引发事件的组件（使用轻量级等待过程）在某些预定时间或间隔

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-10-15T09:47:04.787

以下应该可以解决问题。

```
static void Main(string[] Args)
{
   try
   {
       MainAsync().GetAwaiter().GetResult();
   }
   catch (Exception ex)
   {
       Console.WriteLine(ex.Message);
   }
}

static async Task MainAsync()
{
    CancellationTokenSource tokenSource = new CancellationTokenSource();

    // Start the timed event here
    StartAsync(tokenSource.Token);

    Console.ReadKey();

    tokenSource.Cancel();
    tokenSource.Dispose();
}

public Task StartAsync(CancellationToken cancellationToken)
{
    var nextRunTime = new DateTime();

    switch (DateTime.Now.AddSeconds(1) < DateTime.Today.AddHours(12)) // add a second to current time to account for time needed to setup the task.
{
    case true:
        nextRunTime = DateTime.Today.AddHours(12); // Run at midday today.
        break;
    case false:
        nextRunTime = DateTime.Today.AddDays(1).AddHours(12); // Run at midday tomorrow.
        break;
    }

    var firstInterval = nextRunTime.Subtract(DateTime.Now);

    Action action = () =>
    {
        // Run the task at the first interval, then run the task again at midday every day.  
        _timer = new Timer(
        EventMethod,
        null,
        firstInterval,
        DateTime.Today.AddDays(1).AddHours(12).Subtract(DateTime.Now)
        );
    };

    // no need to await this call here because this task is scheduled to run later.
    Task.Run(action);
    return Task.CompletedTask;
}

private async void EventMethod(object state)
{
    // do work
} 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2011-09-26T12:28:29.857

我的目标是每晚 03:00 左右运行导入。

这是我的方法，使用 System.Timers.Timer：

```
private Timer _timer;
private Int32 _hours = 0;
private Int32 _runAt = 3;

protected override void OnStart(string[] args)
{
    _hours = (24 - (DateTime.Now.Hour + 1)) + _runAt;
    _timer = new Timer();
    _timer.Interval = _hours * 60 * 60 * 1000;
    _timer.Elapsed += new ElapsedEventHandler(Tick);
    _timer.Start();
}

void Tick(object sender, ElapsedEventArgs e)
{
    if (_hours != 24)
    {
        _hours = 24;
        _timer.Interval = _hours * 60 * 60 * 1000;
    }

    RunImport();
} 
```

# .net - WCF 2.0 中的新功能总结？

> ID：307809
> 
> 赞同：0
> 
> 时间：2008-11-21T04:02:57.007
> 
> 标签：.net, wcf, visual-studio-2010, xmpp

WCF 2.0/VS2010 中的新功能是否有很好的参考或摘要列表？

我正在尝试为一个项目提出理由建议，从 Jabber 迁移到 WCF。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T07:22:56.603

没有特别回答您的问题，但 WCF 2.0 不会在很长一段时间内发布，所以我会根据当前的 WCF 版本进行评估。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-06T20:22:25.027

[http://www.aspnetpro.com/articles/2009/04/asp200904mb_f/asp200904mb_f.asp](http://www.aspnetpro.com/articles/2009/04/asp200904mb_f/asp200904mb_f.asp)

# iis - 使用 global.asax 有哪些替代方法？

> ID：307821
> 
> 赞同：5
> 
> 时间：2008-11-21T04:08:15.327
> 
> 标签：iis, login, global-asax

我在 IIS 中使用我自己的自定义身份验证，并且我希望服务器在*每次*加载页面时（无论是什么类型的文件）都首先检查 Application 变量，以查看用户是否经过身份验证并有权查看该站点。在 global.asax 中，这可能是：

```
void Application_Start(Object Sender, EventArgs e)
{
  if(Application["username"] == null)
  {
    Response.redirect("login.aspx");
  }
} 
```

问题是这个站点有多个子根。也就是说，[http://example.com/site1是与](http://example.com/site1)[http://example.com/site2](http://example.com/site2) 完全不同的网站。因此，我希望说 Application_Start 函数在 site1 上工作但不影响 site2。

如果 global.asax 可以在目录级别进行自定义，那么这将不是问题。*但由于每台服务器*只有一个 global.asax，我无法实现此解决方案。

global.asax 有哪些替代方案？或者每个目录的 global.asax 会有所不同吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-21T04:08:51.190

# HttpModules 是 global.asax 的替代品

（另见[https://www.codeguru.com/csharp/.net/net_asp/article.php/c19389/HTTP-Handlers-and-HTTP-Modules-in-ASPNET.htm](https://www.codeguru.com/csharp/.net/net_asp/article.php/c19389/HTTP-Handlers-and-HTTP-Modules-in-ASPNET.htm)
[http://codebetter.com/blogs /karlseguin/archive/2006/06/12/146356.aspx](http://codebetter.com/blogs/karlseguin/archive/2006/06/12/146356.aspx)）

HttpModules 在 web.config 中注册；方便地，*它*可以在目录级别进行自定义。所以每个目录都可以有自己独特的一组模块（在较低的目录中继承）。所有模块都具有与 global.asax 中相同的功能。

基本上，每个页面请求在到达实际页面代码本身之前都会通过*每个注册模块。*无论它是哪种请求，都会发生这种情况：

```
“page.aspx” “page.html”
    | |
( | 模块 1 | )
( | 模块 2 | )
( | 模块 3 | )
    维维
(处理程序 1) (处理程序 2)

```

（（更好的图片和描述可以在[https://www.codeguru.com/csharp/.net/net_asp/article.php/c19389/HTTP-Handlers-and-HTTP-Modules-in-ASPNET.htm](https://www.codeguru.com/csharp/.net/net_asp/article.php/c19389/HTTP-Handlers-and-HTTP-Modules-in-ASPNET.htm) ))

那么你需要做的就是将你的代码定义为一个模块而不是 global.asax 。如果用户未通过身份验证，则：`response.redirect("login.aspx")`将停止控制到达处理程序并解析/返回/运行请求的页面。

它比这要复杂一些，因此可以在 codeguru 网站上找到更好的描述/教程。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T06:34:59.477

我很确定一旦一个人登录，您的代码将允许所有人访问 - 可能不是您想要的。

根据[http://msdn.microsoft.com/en-us/library/ms178473.aspx](http://msdn.microsoft.com/en-us/library/ms178473.aspx)：

“在请求 ASP.NET 应用程序中的第一个资源（例如页面）时调用。Application_Start方法在**应用**程序的生命周期中**仅调用一次”**

此外，根据[http://support.microsoft.com/kb/307598#1](http://support.microsoft.com/kb/307598#1) “应用程序状态变量实际上是每个 ASP.NET 应用程序的全局变量。”

我建议您使用内置的 Membership API 并使用 web.config 文件限制访问。

如果您愿意使用 Membership API 而不是滚动您自己的身份验证机制，则可以使用 web.config 检查用户是否有权访问特定文件夹。您还可以相对简单地让用户登录一个站点，然后通过共享身份验证票证自动登录到其他站点——前提是它们都在同一个根域上。

有关共享身份验证票证，请参阅：http: [//msdn.microsoft.com/en-us/library/ms998288.aspx](http://msdn.microsoft.com/en-us/library/ms998288.aspx)和[http://www.netomatix.com/development/singlesignon.aspx](http://www.netomatix.com/development/singlesignon.aspx)

关于如何使用 web.config 来限制访问： [http ://www.devhood.com/Tutorials/tutorial_details.aspx?tutorial_id=85](http://www.devhood.com/Tutorials/tutorial_details.aspx?tutorial_id=85)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-10T09:03:03.537

实际上，我相信每个 asp.net 应用程序只有一个 global.asax。如果您希望 example.com/subsite1 成为与 example.com/subsite2 不同的应用程序，您可以在 IIS 中创建两个不同的应用程序。因此，它们将在完全不同的应用程序域中运行（尽管它们可能在同一个进程中（aspnet_wp.exe 或 w3wp.exe），甚至共享应用程序池）。因此，如果它们是不同的应用程序，它们也应该拥有独立的 global.asax 文件。

将目录转换为应用程序。打开IIS->找到目录/子站点，右键单击->属性->主目录选项卡->单击“创建”。

有关应用程序域和工作进程的更多信息，请考虑[阅读此博客条目](http://blog.tylerholmes.com/2008/12/application-domains-revisited.html)。希望有帮助。

# java - 使用 Betwixt 时出现 CyclicalReferenceException

> ID：307823
> 
> 赞同：6
> 
> 时间：2008-11-21T04:09:10.020
> 
> 标签：java, reference, cyclic-reference, betwixt

我的休眠域模型中有循环引用，这导致 Betwixt 失败。我不想更改我的域模型。

如何更改 Betwixt 以忽略周期性参考？

# git - 你如何修复一个错误的合并，并将你好的提交重播到一个固定的合并上？

> ID：307828
> 
> 赞同：422
> 
> 时间：2008-11-21T04:11:21.420
> 
> 标签：git, git-filter-branch, git-rewrite-history, git-rm

几次提交前，我不小心将一个不需要的文件（`filename.orig`在解决合并时）提交到我的存储库，直到现在我才注意到它。我想从存储库历史记录中完全删除该文件。

是否可以重写`filename.orig`从未添加到存储库中的更改历史记录？

* * *

## 回答 #1

> 赞同：306
> 
> 时间：2008-11-21T13:02:21.957

**如果您的情况不是问题中描述的情况，请不要使用此食谱。这个秘籍是为了修复一个错误的合并，并将你好的提交重播到一个固定的合并上。**

虽然`filter-branch`会做你想做的事，但这是一个相当复杂的命令，我可能会选择使用`git rebase`. 这可能是个人喜好。`filter-branch`可以在一个稍微复杂一点的命令中完成，而`rebase`解决方案是一次执行等效的逻辑操作。

试试下面的食谱：

```
# create and check out a temporary branch at the location of the bad merge
git checkout -b tmpfix <sha1-of-merge>

# remove the incorrectly added file
git rm somefile.orig

# commit the amended merge
git commit --amend

# go back to the master branch
git checkout master

# replant the master branch onto the corrected merge
git rebase tmpfix

# delete the temporary branch
git branch -d tmpfix 
```

（请注意，您实际上并不需要临时分支，您可以使用“分离的 HEAD”执行此操作，但您需要记下由`git commit --amend`步骤生成的提交 ID 以提供给`git rebase`命令，而不是使用临时分支姓名。）

* * *

## 回答 #2

> 赞同：222
> 
> 时间：2014-04-20T23:10:53.043

# 简介：您有 5 个可用的解决方案

原始海报说：

> 我不小心将一个不需要的文件提交到我的存储库几次提交前...我想从存储库历史记录中完全删除该文件。
> 
> 是否可以重写`filename.orig`从未添加到存储库中的更改历史记录？

有许多不同的方法可以从 git 中完全删除文件的历史记录：

1.  修改提交。
2.  硬重置（可能加上变基）。
3.  非交互式变基。
4.  交互式变基。
5.  过滤分支。

在原始海报的情况下，修改提交本身并不是一个真正的选择，因为他之后做了几个额外的提交，但为了完整起见，我也会解释如何去做，对于任何想要的人修改他们之前的提交。

**请注意，所有这些解决方案都涉及以另一种方式*更改/重写*历史记录/提交，因此任何拥有旧提交副本的人都必须做额外的工作才能将他们的历史记录与新的历史记录重新同步。**

* * *

# 解决方案 1：修改提交

如果您不小心在之前的提交中进行了更改（例如添加文件），并且您不希望该更改的历史记录不再存在，那么您可以简单地修改之前的提交以从中删除文件：

```
git rm <file>
git commit --amend --no-edit 
```

* * *

# 解决方案 2：硬重置（可能加上变基）

与解决方案 #1 一样，如果您只是想摆脱以前的提交，那么您还可以选择简单地对其父项进行硬重置：

```
git reset --hard HEAD^ 
```

该命令会将您的分支硬重置为之前的^第一个父提交。

***但是***，如果像原始海报一样，您在要撤消更改的提交之后进行了多次提交，您仍然可以使用硬重置来修改它，但这样做也涉及使用变基。以下是您可以用来修改历史上更早的提交的步骤：

```
# Create a new branch at the commit you want to amend
git checkout -b temp <commit>

# Amend the commit
git rm <file>
git commit --amend --no-edit

# Rebase your previous branch onto this new commit, starting from the old-commit
git rebase --preserve-merges --onto temp <old-commit> master

# Verify your changes
git diff master@{1} 
```

* * *

# 解决方案 3：非交互式变基

如果您只想从历史记录中完全删除提交，这将起作用：

```
# Create a new branch at the parent-commit of the commit that you want to remove
git branch temp <parent-commit>

# Rebase onto the parent-commit, starting from the commit-to-remove
git rebase --preserve-merges --onto temp <commit-to-remove> master

# Or use `-p` insteda of the longer `--preserve-merges`
git rebase -p --onto temp <commit-to-remove> master

# Verify your changes
git diff master@{1} 
```

* * *

# 解决方案 4：交互式变基

此解决方案将允许您完成与解决方案 #2 和 #3 相同的事情，即修改或删除比您之前的提交更早的历史提交，因此您选择使用哪种解决方案取决于您。出于性能原因，交互式变基不太适合对数百个提交进行变基，因此在这种情况下，我会使用非交互式变基或过滤器分支解决方案（见下文）。

要开始交互式变基，请使用以下命令：

```
git rebase --interactive <commit-to-amend-or-remove>~

# Or `-i` instead of the longer `--interactive`
git rebase -i <commit-to-amend-or-remove>~ 
```

这将导致 git 将提交历史回退到您要修改或删除的提交的父级。然后它将以相反的顺序为您提供一个重新提交的列表，其中包含 git 设置使用的任何编辑器（默认情况下是 Vim）：

```
pick 00ddaac Add symlinks for executables
pick 03fa071 Set `push.default` to `simple`
pick 7668f34 Modify Bash config to use Homebrew recommended PATH
pick 475593a Add global .gitignore file for OS X
pick 1b7f496 Add alias for Dr Java to Bash config (OS X) 
```

您要修改或删除的提交将位于此列表的顶部。要删除它，只需在列表中删除它的行。^(否则，将第一)行的“pick”替换为“edit” ，如下所示：

```
edit 00ddaac Add symlinks for executables
pick 03fa071 Set `push.default` to `simple` 
```

接下来，输入`git rebase --continue`。如果您选择完全删除提交，那么您需要做的就是这一切（除了验证，请参阅此解决方案的最后一步）。另一方面，如果您想修改提交，那么 git 将重新应用提交，然后暂停变基。

```
Stopped at 00ddaacab0a85d9989217dd9fe9e1b317ed069ac... Add symlinks
You can amend the commit now, with

        git commit --amend

Once you are satisfied with your changes, run

        git rebase --continue 
```

此时，您可以删除文件并修改提交，然后继续 rebase：

```
git rm <file>
git commit --amend --no-edit
git rebase --continue 
```

就是这样。作为最后一步，无论您是修改了提交还是完全删除了它，最好通过在变基之前将其与分支的状态进行比较来验证您的分支是否没有进行其他意外更改：

```
git diff master@{1} 
```

* * *

# 解决方案 5：过滤分支

最后，如果您想从历史中完全清除文件存在的所有痕迹，则此解决方案是最好的，并且其他解决方案都不能胜任这项任务。

```
git filter-branch --index-filter \
'git rm --cached --ignore-unmatch <file>' 
```

`<file>`从根提交开始，这将从所有提交中删除。相反，如果您只想重写提交范围`HEAD~5..HEAD`，那么您可以将其作为附加参数传递给，[如此答案](https://stackoverflow.com/a/646694/456814)`filter-branch`中所指出的 ：

```
git filter-branch --index-filter \
'git rm --cached --ignore-unmatch <file>' HEAD~5..HEAD 
```

同样，在`filter-branch`完成之后，通常最好通过在过滤操作之前将您的分支与之前的状态进行比较来验证是否没有其他意外更改：

```
git diff master@{1} 
```

* * *

### 过滤器分支替代品：BFG Repo Cleaner

我听说[BFG Repo Cleaner](https://stackoverflow.com/a/15729420/456814)工具的运行速度比 快`git filter-branch`，因此您可能也想将其作为一个选项进行检查。**[它甚至在filter-branch 文档](http://jk.gs/git-filter-branch.html#_notes)****中正式提到作为一种可行的替代方案：**

> *git-filter-branch 允许您对 Git 历史记录进行复杂的 shell 脚本重写，但如果您只是删除不需要的数据*（如大文件或密码），则可能不需要这种灵活性。对于这些操作，您可能需要考虑[BFG Repo-Cleaner](http://rtyley.github.io/bfg-repo-cleaner/)，它是 git-filter-branch 的基于 JVM 的替代方案，对于这些用例通常至少快 10-50 倍，并且具有完全不同的特性：
> 
> *   任何特定版本的文件都会被清理*一次*。与 git-filter-branch 不同，BFG 不会让您有机会根据文件在历史记录中提交的位置或时间来不同地处理文件。这个约束提供了 BFG 的核心性能优势，并且非常适合清理坏数据的任务——你不关心坏数据*在哪里*，你只想让它*消失*。
>     
>     
> *   默认情况下，BFG 充分利用多核机器，并行清理提交文件树。git-filter-branch 按顺序清理提交（即以单线程方式），尽管*可以* 在针对每个提交执行的脚本中编写包含它们自己的并行性的过滤器。
>     
>     
> *   [命令选项](http://rtyley.github.io/bfg-repo-cleaner/#examples)比 git-filter 分支更具限制性，并且仅用于删除不需要的数据的任务，例如：`--strip-blobs-bigger-than 1M`.

# 其他资源

1.  [Pro Git § 6.4 Git 工具 - 重写历史](http://git-scm.com/book/en/Git-Tools-Rewriting-History)。
2.  [git-filter-branch(1) 手册页](http://jk.gs/git-filter-branch.html)。
3.  [git-commit(1) 手册页](http://jk.gs/git-commit.html)。
4.  [git-reset(1) 手册页](http://jk.gs/git-reset.html)。
5.  [git-rebase(1) 手册页](http://jk.gs/git-rebase.html)。
6.  [BFG Repo Cleaner](http://rtyley.github.io/bfg-repo-cleaner/)（另请参阅[创建者本人的这个答案](https://stackoverflow.com/a/15729420/456814)）。

* * *

## 回答 #3

> 赞同：121
> 
> 时间：2009-03-14T20:44:57.617

如果您此后没有提交任何内容，只需`git rm`文件和`git commit --amend`.

如果你有

```
git filter-branch \
--index-filter 'git rm --cached --ignore-unmatch path/to/file/filename.orig' merge-point..HEAD 
```

将经历从`merge-point`to 的每次更改`HEAD`，删除 filename.orig 并重写更改。Using`--ignore-unmatch`意味着如果由于某种原因 filename.orig 在更改中丢失，该命令不会失败。这是[git-filter-branch 手册页](http://git-scm.com/docs/git-filter-branch)中示例部分的推荐方法。

Windows 用户注意事项：文件路径**必须**使用正斜杠

* * *

## 回答 #4

> 赞同：50
> 
> 时间：2010-02-04T05:52:43.073

这是最好的方法：http:
[//github.com/guides/completely-remove-a-file-from-all-revisions](http://github.com/guides/completely-remove-a-file-from-all-revisions)

请务必先备份文件的副本。

**编辑**

不幸的是， [Neon](https://stackoverflow.com/users/309261/neon)的编辑在审核期间被拒绝了。
请参阅下面的 Neons 帖子，它可能包含有用的信息！

* * *

例如删除所有`*.gz`意外提交到 git 存储库的文件：

```
$ du -sh .git ==> e.g. 100M
$ git filter-branch --index-filter 'git rm --cached --ignore-unmatch *.gz' HEAD
$ git push origin master --force
$ rm -rf .git/refs/original/
$ git reflog expire --expire=now --all
$ git gc --prune=now
$ git gc --aggressive --prune=now 
```

那仍然对我不起作用？（我目前在 git 版本 1.7.6.1）

```
$ du -sh .git ==> e.g. 100M 
```

不知道为什么，因为我只有一个主分支。无论如何，我终于通过推入一个新的空且裸露的 git 存储库来真正清理我的 git 存储库，例如

```
$ git init --bare /path/to/newcleanrepo.git
$ git push /path/to/newcleanrepo.git master
$ du -sh /path/to/newcleanrepo.git ==> e.g. 5M 
```

*（是的！）*

然后我将它克隆到一个新目录并将它的 .git 文件夹移到这个目录中。例如

```
$ mv .git ../large_dot_git
$ git clone /path/to/newcleanrepo.git ../tmpdir
$ mv ../tmpdir/.git .
$ du -sh .git ==> e.g. 5M 
```

*（是的！终于清理干净了！）*

确认一切正常后，您可以删除`../large_dot_git`and`../tmpdir`目录（可能在几周或几个月后，以防万一......）

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2013-03-31T12:35:49.690

重写 Git 历史记录需要更改所有受影响的提交 ID，因此从事该项目的每个人都需要删除他们的旧副本，并在清理历史记录后进行新的克隆。给它带来不便的人越多，你就越需要有充分的理由去做——你多余的文件并没有真正造成问题，但如果*你*只是在处理项目，你不妨清理一下 Git 历史记录到！

为了使其尽可能简单，我建议使用[BFG Repo-Cleaner](http://rtyley.github.com/bfg-repo-cleaner/)，这是一种更简单、更快的替代方案，`git-filter-branch`专门用于从 Git 历史记录中删除文件。它使您的生活更轻松的一种方法是它实际上默认处理*所有*引用（所有标签、分支等），但它的速度也快了[10 到 50 倍](https://docs.google.com/spreadsheet/ccc?key=0AsR1d5Zpes8HdER3VGU1a3dOcmVHMmtzT2dsS2xNenc)。

您应该仔细按照此处的步骤操作：[http](http://rtyley.github.com/bfg-repo-cleaner/#usage) ://rtyley.github.com/bfg-repo-cleaner/#usage - 但核心位是这样的：下载[BFG jar](http://rtyley.github.com/bfg-repo-cleaner/#download)（需要 Java 6 或更高版本）并运行此命令：

```
$ java -jar bfg.jar --delete-files filename.orig my-repo.git 
```

将扫描您的整个存储库历史记录，并删除任何名为`filename.orig`（不在您的[*最新*提交中）的文件。](http://rtyley.github.com/bfg-repo-cleaner/#protected-commits)这比使用`git-filter-branch`做同样的事情要容易得多！

*全面披露：我是 BFG Repo-Cleaner 的作者。*

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2016-06-10T06:35:50.640

```
You should probably clone your repository first.

Remove your file from all branches history:
git filter-branch --tree-filter 'rm -f filename.orig' -- --all

Remove your file just from the current branch:
git filter-branch --tree-filter 'rm -f filename.orig' -- --HEAD    

Lastly you should run to remove empty commits:
git filter-branch -f --prune-empty -- --all 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-10-16T13:10:21.617

只是为了将它添加到 Charles Bailey 的解决方案中，我只是使用 git rebase -i 从早期提交中删除不需要的文件，它就像一个魅力。步骤：

```
# Pick your commit with 'e'
$ git rebase -i

# Perform as many removes as necessary
$ git rm project/code/file.txt

# amend the commit
$ git commit --amend

# continue with rebase
$ git rebase --continue 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2016-05-17T02:26:14.967

我发现的最简单的方法是`leontalbot`（作为评论）建议的，这是[Anoopjohn 发布的帖子](http://www.zyxware.com/articles/4027/how-to-delete-files-permanently-from-your-local-and-remote-git-repositories)。我认为它值得拥有自己的空间作为答案：

（我将其转换为 bash 脚本）

```
#!/bin/bash
if [[ $1 == "" ]]; then
    echo "Usage: $0 FILE_OR_DIR [remote]";
    echo "FILE_OR_DIR: the file or directory you want to remove from history"
    echo "if 'remote' argument is set, it will also push to remote repository."
    exit;
fi
FOLDERNAME_OR_FILENAME=$1;

#The important part starts here: ------------------------

git filter-branch -f --index-filter "git rm -rf --cached --ignore-unmatch $FOLDERNAME_OR_FILENAME" -- --all
rm -rf .git/refs/original/
git reflog expire --expire=now --all
git gc --prune=now
git gc --aggressive --prune=now

if [[ $2 == "remote" ]]; then
    git push --all --force
fi
echo "Done." 
```

所有学分都归`Annopjohn`和`leontalbot`用于指出。

**笔记**

请注意，该脚本不包括验证，因此请确保您不会犯错误，并且您有备份以防万一出现问题。它对我有用，但它可能不适用于您的情况。谨慎使用（如果您想知道发生了什么，请点击链接）。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2017-01-30T12:54:26.640

绝对`git filter-branch`是要走的路。

遗憾的是，这不足以`filename.orig`从您的 repo 中完全删除，因为它仍然可以被标签、reflog 条目、遥控器等引用。

我建议也删除所有这些引用，然后调用垃圾收集器。您可以使用[该](https://ownyourbits.com/2017/01/18/completely-remove-a-file-from-a-git-repository-with-git-forget-blob/)`git forget-blob`网站上的脚本一步完成所有这些操作。

`git forget-blob filename.orig`

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-03-29T15:40:36.120

如果这是您要清理的最新提交，我尝试使用 git 版本 2.14.3 (Apple Git-98)：

```
touch empty
git init
git add empty
git commit -m init

# 92K   .git
du -hs .git

dd if=/dev/random of=./random bs=1m count=5
git add random
git commit -m mistake

# 5.1M  .git
du -hs .git

git reset --hard HEAD^
git reflog expire --expire=now --all
git gc --prune=now

# 92K   .git
du -hs .git 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-11-21T10:26:19.447

这就是[`git filter-branch`](http://git-scm.com/docs/git-filter-branch)设计的目的。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-09-03T04:00:45.910

您还可以使用：

`git reset HEAD file/path`

# layout - 我可以从 Crystal Reports 的公式中强制显示字体吗？

> ID：307830
> 
> 赞同：0
> 
> 时间：2008-11-21T04:12:03.757
> 
> 标签：layout, crystal-reports

我有一份包含很多公式的报告，这些公式将单词“TRUE”翻译成“X”，将“FALSE”翻译成空格。

我使用这些在复选框中添加“X”。

有时我的复选框后面有文字。为了避免向左和向右轻微移动，我以固定宽度的字体打印“X”和“”。手动设置每个字段的字体非常繁琐。

有没有办法从公式内部指定显示字体？

像这样的东西会很好：

```
DisplayFontName = "Courier New";  //wishful thinking
DisplayFontSize = 8;  //wishful thinking

//this is the code I'm currently using
if Uppercase({table.somefield}) = "TRUE" then "X"
else " " 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-24T13:50:06.557

不，这是不可能的。公式的上下文是仅为其设置公式的属性。您不能访问整个对象的属性，例如字段。也许您可以考虑使用公式抑制的两个图像，具体取决于您的字段值。然后你会摆脱字体问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T04:32:43.530

据我记得，您可以使用公式字段设置字体，您可以在其中编写

if Uppercase({table.somefield}) = "TRUE" then "Courier New"

# iis - 在 IIS 中，“应用程序”和“会话”有什么区别？

> ID：307831
> 
> 赞同：5
> 
> 时间：2008-11-21T04:12:46.207
> 
> 标签：iis, session, session-state, application-state

会话是每个浏览器的（通过 cookie 确定），但是“应用程序”何时开始和结束，以及 IIS 如何知道请求何时是同一“应用程序”实例的一部分（如果不是通过 cookie 完成与会话相同）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-21T04:16:29.413

“应用程序”范围是全球性的，对网站的每个请求都共享相同的应用程序。存储在应用程序中的任何内容对**所有**用户都是可见的。应用程序在向网站发出第一个请求时启动，并在 IIS 停止网站时结束（例如，当 IIS 本身关闭时，或者当网站有一段时间没有被访问时）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T04:29:55.640

应用程序在第一次部署在网络服务器上时被称为启动，并且可供用户访问。每次取消部署或服务器关闭时，应用程序都会结束。

第二部分尚不清楚，但假设用于确定应用程序，每个应用程序都有一个根，该根对于部署在 web /app 服务器上的所有应用程序都是唯一的。所以服务器可以从被请求的 URL 中找出来。

因此，每个请求都被视为独立的，并且必须使用会话、cookie 等一些机制来将单个请求组合为单个用户会话的一部分。

# iphone - 加载应用程序的最佳方式，就像它在终止时处于其先前状态一样

> ID：307832
> 
> 赞同：3
> 
> 时间：2008-11-21T04:13:54.753
> 
> 标签：iphone, cocoa-touch, state

我想学习重新加载应用程序状态的最佳实践，这样当我的应用程序启动时，它应该在再次打开时自动加载“正确”的视图/子视图。

在我的特殊情况下，我的应用程序有一堆视图控制器，每个控制器都负责一个 UITableView。我希望我的应用程序在再次打开时“跳转”到表视图层次结构中的正确节点。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-21T04:38:03.830

基于 Marc 所说，假设您有一个基本视图控制器，然后是一个或多个级别的“向下钻取”，使用`[navigationController pushViewController: viewController animated: NO]`. 然后，当用户点击后退按钮时，他们将看到预加载的前一个视图控制器。一个很好的例子是“联系人”应用程序，它预加载组视图控制器，然后在其上推送当前组的视图控制器（通常是“所有联系人”）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T13:37:47.237

检查 Apple 的 DrillDownSave 示例应用程序：

> “演示如何在向下钻取列表样式的用户界面中恢复用户的当前位置，并在重新启动应用程序时恢复该位置。”

[http://developer.apple.com/iphone/library/samplecode/DrillDownSave](http://developer.apple.com/iphone/library/samplecode/DrillDownSave)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T04:27:20.687

您需要将标识符与每个视图控制器相关联，并在当前视图更改时将该值保存到用户默认值。下次启动时，读取该值，您将知道最初需要加载哪个视图控制器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-21T07:01:56.563

我已经发布[了一个小图书馆](http://code.google.com/p/iphone-statefulness/)来帮助做这些事情。我已经在我在 App Store 上发布的应用程序中使用它，它比手动为每个视图实现 NSCoder 更流畅：P

# iphone - 如何在运行时添加 UIButton

> ID：307845
> 
> 赞同：16
> 
> 时间：2008-11-21T04:18:39.330
> 
> 标签：iphone, cocoa-touch

我正在尝试`UIButton`在运行时添加一个，但是它不可见。我究竟做错了什么？

```
- (id)initWithFrame:(CGRect)frame {
    if (self = [super initWithFrame:frame]) {
        UIButton *btn = [[UIButton buttonWithType:UIButtonTypeRoundedRect] retain];
        btn.frame = CGRectMake(0, 0, 100, 25);
        btn.backgroundColor = [UIColor clearColor];
        [btn setTitle:@"Play" forState:UIControlStateNormal];
        [btn addTarget:self action:@selector(buttonClick:)
        forControlEvents:UIControlEventTouchUpInside];
        btn.center = self.center;
        [self addSubview:btn];
    }
    return self;
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-21T04:39:57.197

首先，确保正在调用 initWithFrame: 方法。如果您的视图位于 Nib 中，则改为调用 initWithCoder:。

其次，按钮是唯一的子视图（从您的代码看起来是这样，但您永远不知道）。该按钮可以隐藏在另一个子视图后面。如果需要，请调用 bringSubviewToFront:。

最后，视图本身是否可见？是否足够大以显示按钮？给定您的示例，如果视图宽度小于 100 像素，则该按钮将不会显示，因为它将被视图的边界剪裁。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-08T08:37:21.090

您必须释放`btn`并删除“：”在`buttonClick`：

```
UIButton *btn= [[UIButton buttonWithType:UIButtonTypeRoundedRect] retain];
btn.frame = CGRectMake(0, 0, 100, 25);
btn.backgroundColor = [UIColor clearColor];
[btn setTitle:@"Play" forState:UIControlStateNormal];
[btn addTarget:self action:@selector(buttonClick) forControlEvents:UIControlEventTouchUpInside];
[self.view addSubview:btn]; 
[btn release]; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-04T15:34:37.933

如果它仍然不起作用，请尝试删除选择器名称末尾的 :：@selector(buttonClick)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-10-31T21:25:17.523

您不需要保留 UIButton 因为它由 [self.view addSubview:btn];

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-19T17:16:42.173

首先检查您的代码是否正在执行 initwithFrame 方法。因为如果您从笔尖加载视图，即使用

```
NSArray *xibviews = [[NSBundle mainBundle] loadNibNamed: @"MySubview" owner: mySubview options: NULL];
MySubview *msView = [xibviews objectAtIndex: 0];
[self.view addSubview:msView]; 
```

那么 initWithFrame 部分将不会被执行。所以请检查一次。

# java - ejb3-persistence.jar 源码

> ID：307848
> 
> 赞同：14
> 
> 时间：2008-11-21T04:21:08.997
> 
> 标签：java, jpa, open-source, persistence

好吧，我一定是脑残了，因为我找不到Sun的persistence.jar或JBoss的ejb3-persistence.jar JPA包的java源。它们*是*开源的，不是吗？

我浏览了整个 java.sun.com 站点以及 GlassFish wiki，但都是空的。

我想要一个 src.zip 或 Sun 随 Java JDK 一起提供的文件夹。

当然，我*真的*不必*拥有*它，但我觉得偶尔浏览一下源代码很有趣。它有时可以帮助我调试我的代码。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-02T16:18:34.087

我刚刚在[http://www.mvnrepository.com](http://www.mvnrepository.com)上搜索了持久性 API

[http://mirrors.ibiblio.org/pub/mirrors/maven2/javax/persistence/persistence-api/1.0/persistence-api-1.0-sources.jar](http://mirrors.ibiblio.org/pub/mirrors/maven2/javax/persistence/persistence-api/1.0/persistence-api-1.0-sources.jar)

也可在 java.net maven 1 存储库 [http://download.java.net/maven/1/javax.persistence/java-sources/](http://download.java.net/maven/1/javax.persistence/java-sources/)

有关实现，请参阅休眠实体管理器、openjpa、eclipse toplink、glassfish 持久性......

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-03-18T11:19:04.493

我在这里找到了 1.0.2 GA 版本：http: [//grepcode.com/snapshot/repository.jboss.com/maven2/org.hibernate/ejb3-persistence/1.0.2.GA](http://grepcode.com/snapshot/repository.jboss.com/maven2/org.hibernate/ejb3-persistence/1.0.2.GA)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-30T20:21:39.247

ejb3-persistence.jar 包含 JPA API (javax.persistance.*) 实现，它被指定为 EJB 3.0 JSR 220 规范的一部分（即将推出的 JPA 规范是 JSR 317，它现在​​与 EJB 3.1 规范分开）

参考实现是 Glassfish 中包含的，我相信 JBoss 中使用的是 Hibernate 实现，因此您应该能够在那里找到源代码。您可以自由使用许可证满足您需要的许可证（如果您需要重新分发），尽管我相信它们都是可重新分发的。对于 Apache 风格的许可证，我推荐 Apache OpenEJB.org 项目（由 Apache Geronimo 项目提供）使用的许可证。

您可以在此处浏览源代码： [https ://github.com/apache/geronimo-specs/tree/trunk/geronimo-jpa_2.2_spec/src/main/java/javax/persistence](https://github.com/apache/geronimo-specs/tree/trunk/geronimo-jpa_2.2_spec/src/main/java/javax/persistence)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-07-14T22:17:05.760

Jboss 源可以从[http://www.jboss.org/jbossas/downloads/](http://www.jboss.org/jbossas/downloads/)
下载 例如，ejb3-persistence-sources.jar 可以在
[http://sourceforge.net/projects/jboss/files/JBoss/找到JBoss-5.1.0.GA/jboss-5.1.0.GA-src.tar.gz/下载](http://sourceforge.net/projects/jboss/files/JBoss/JBoss-5.1.0.GA/jboss-5.1.0.GA-src.tar.gz/download)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-06T08:12:57.140

如果您正在寻找的只是在 eclipse 中附加的东西，那么您应该只需要一个 SVN 结帐，尽管我意识到这并不是您正在寻找的答案。jboss 的 JPA API 的源代码可以在[http://anonsvn.jboss.org/repos/hibernate/jpa-api/](http://anonsvn.jboss.org/repos/hibernate/jpa-api/)中找到- 查看 jboss 版本中包含的 hibernate 版本的标签，您可以附加生成的文件夹，就像使用源代码的 zip 文件一样。

# java - 尝试提交更改时出现 Cayenne 空指针错误

> ID：307849
> 
> 赞同：1
> 
> 时间：2008-11-21T04:21:52.460
> 
> 标签：java, orm, apache-cayenne

我正在运行以下代码，当我尝试使用 Cayenne 作为我的 ORM 提交我的更改时出错。代码粘贴在下面，并在 context.commitChanges(); 行上显示错误。输出消息粘贴在代码下方。任何有关解决此问题的帮助将不胜感激。

```
导入 org.apache.cayenne.access.DataContext；
导入 java.util.*；

导入 com.jared.*；
公共类主要{

    公共静态无效主要（字符串[]参数）{
        数据上下文上下文 = DataContext.createDataContext();
        股票 theStock=(Stocks) context.createAndRegisterNewObject(Stocks.class);
theStock.setAsk(3.4);
theStock.setAvgdailyvolume(323849);
theStock .setBid(5.29);
theStock.setChange(-1.22);
theStock.setDayhigh(9.21);
theStock.setDaylow(2.11);
theStock.setLasttradeprice(5.11);
theStock.setLasttradesize(3827);
theStock.setOpen(6.21);
theStock.setPriorclose(4.21);
theStock.setShortratio(1.1);
theStock.setSymbol("^SP%");
theStock.setVolume(28193);
theStock.setLasttradedate(新日期());
    context.commitChanges();
    System.out.println("完成数据库");
    }
}

```

```
2008 年 11 月 20 日晚上 11:20:37 org.apache.cayenne.conf.RuntimeLoadDelegate 开始加载
INFO：开始配置加载。
2008 年 11 月 20 日晚上 11:20:37 org.apache.cayenne.conf.RuntimeLoadDelegate shouldLoadDataDomain
信息：加载域：股票
2008 年 11 月 20 日晚上 11:20:37 org.apache.cayenne.conf.RuntimeLoadDelegate loadDataMap
信息：已加载。
2008 年 11 月 20 日晚上 11:20:37 org.apache.cayenne.conf.RuntimeLoadDelegate shouldLoadDataNode
信息：加载。
2008 年 11 月 20 日晚上 11:20:37 org.apache.cayenne.conf.RuntimeLoadDelegate shouldLoadDataNode
信息：使用工厂：org.apache.cayenne.conf.DriverDataSourceFactory
2008 年 11 月 20 日晚上 11:20:37 org.apache.cayenne.conf.DriverDataSourceFactory 加载
信息：从“stocksNode.driver.xml”加载驱动程序信息。
2008 年 11 月 20 日晚上 11:20:37 org.apache.cayenne.conf.DriverDataSourceFactory$DriverHandler 初始化
INFO：加载驱动程序 org.hsqldb.jdbcDriver
2008 年 11 月 20 日晚上 11:20:37 org.apache.cayenne.conf.DriverDataSourceFactory$LoginHandler 初始化
INFO：加载用户名和密码。
2008 年 11 月 20 日晚上 11:20:37 org.apache.cayenne.access.QueryLogger logPoolCreated
信息：创建的连接池：jdbc:hsqldb:file:/hsqldb/data/stocks
    驱动类：org.hsqldb.jdbcDriver
    分钟。池中的连接数：1
    最大限度。池中的连接数：1
2008 年 11 月 20 日晚上 11:20:37 org.apache.cayenne.conf.RuntimeLoadDelegate shouldLoadDataNode
INFO：加载的数据源。
2008 年 11 月 20 日晚上 11:20:37 org.apache.cayenne.conf.RuntimeLoadDelegate initAdapter
INFO：没有设置适配器，使用自动适配器。
2008 年 11 月 20 日晚上 11:20:37 org.apache.cayenne.conf.RuntimeLoadDelegate finishedLoading
INFO：在 203 毫秒内完成配置加载。
线程“主”org.apache.cayenne.CayenneRuntimeException 中的异常：[v.3.0M4 May 18 2008 16:32:02] 提交异常
    在 org.apache.cayenne.access.DataContext.flushToParent(DataContext.java:1192)
    在 org.apache.cayenne.access.DataContext.commitChanges(DataContext.java:1066)
    在 Main.main(Main.java:24)
引起：java.lang.NullPointerException
    在 org.apache.cayenne.access.DataDomainInsertBucket.createPermIds(DataDomainInsertBucket.java:101)
    在 org.apache.cayenne.access.DataDomainInsertBucket.appendQueriesInternal(DataDomainInsertBucket.java:76)
    在 org.apache.cayenne.access.DataDomainSyncBucket.appendQueries(DataDomainSyncBucket.java:80)
    在 org.apache.cayenne.access.DataDomainFlushAction.preprocess（DataDomainFlushAction.java:183）
    在 org.apache.cayenne.access.DataDomainFlushAction.flush(DataDomainFlushAction.java:135)
    在 org.apache.cayenne.access.DataDomain.onSyncFlush(DataDomain.java:821)
    在 org.apache.cayenne.access.DataDomain$2.transform(DataDomain.java:788)
    在 org.apache.cayenne.access.DataDomain.runInTransaction（DataDomain.java:847）
    在 org.apache.cayenne.access.DataDomain.onSync(DataDomain.java:785)
    在 org.apache.cayenne.access.DataContext.flushToParent(DataContext.java:1164)
    ... 2 更多

```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-22T07:31:56.867

用户名密码？

> ClientConnection connection = new HessianConnection(" [http://localhost:8080/cayenne-service](http://localhost:8080/cayenne-service) ", "cayenne-user", "secret",
> null);

# c - VS2008 缺少 C/C++ 头文件

> ID：307855
> 
> 赞同：2
> 
> 时间：2008-11-21T04:23:58.070
> 
> 标签：c, visual-studio, visual-studio-2008

所以，我正在用 C 语言进行一些网络编程，看起来我缺少一堆标准的 C/C++ 头文件。例如，`sys/socket.h`不存在。其他一些也丢失了，例如`netdb.h`, 和`unistd.h`。我需要安装一个包才能在 Windows 上安装这些包吗？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T04:28:09.030

这些都不是标准的 c 或 c++ 头文件。在 Windows 上，套接字定义在 winsock2.h 中

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T04:52:36.080

所有这些头文件都来自 POSIX，而不是 ANSI C 或 ISO C++。如果不安装某种兼容层（如 Cygwin）或将您的应用程序移植到 Windows API 或使用一些宏和包装器来映射类似的功能（即`#define strtok_r strtok_s`），您将无法在 Windows 中找到它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T04:46:39.117

你可能找不到它，因为它是一个常用的 linux 头文件。如果你真的想要它，你可以在 linux-libc-dev 中找到它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T05:07:37.343

正如其他人所说，您正在使用 POSIX 标头和 Socket 定义。查看 MSDN 以了解在 Windows 上定义的标头和结构：http: [//msdn.microsoft.com/en-us/library/ms740506.aspx](http://msdn.microsoft.com/en-us/library/ms740506.aspx)。这些调用几乎相同，但这将为您提供所有 microsoft 特定的语法。

# iphone - 如何重置 UITableView 的滚动位置？

> ID：307857
> 
> 赞同：18
> 
> 时间：2008-11-21T04:24:27.180
> 
> 标签：iphone, cocoa-touch, uitableview, scroll

我想完全重置 UITableView 的滚动位置，以便每次打开它时，它都会显示最顶部的项目。换句话说，我想每次打开表格视图时都将其滚动到顶部。

我尝试使用以下代码，但看起来我误解了文档：

```
- (void)viewWillAppear:(BOOL)animated {
    [tableView scrollToNearestSelectedRowAtScrollPosition:UITableViewScrollPositionTop animated:NO];
} 
```

这是错误的方法吗？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-11-21T05:25:34.140

August 得到了 UITableView 特有的方法。另一种方法是：

```
[tableView scrollRectToVisible:CGRectMake(0, 0, 1, 1) animated:NO]; 
```

该方法在 UITableView 的父类 UIScrollView 中定义。上面的示例告诉它滚动到 0,0 处的 1x1 框 - 换句话说，左上角。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-21T05:06:47.220

您正在使用的方法滚动到（正如方法名称所暗示的）最近的选定行。在许多情况下，这不会是第一行。相反，您想使用

```
scrollToRowAtIndexPath:atScrollPosition:animated: 
```

或者

```
selectRowAtIndexPath:animated:scrollPosition: 
```

您在其中使用要滚动到的行的索引路径。第二种方法实际上选择了一行，第一种方法只是滚动到它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-05-03T17:56:51.037

我最终做的是：

斯威夫特 4

```
self.tableView.contentOffset = CGPoint.zero
DispatchQueue.main.async {
    self.tableView.reloadData()
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-03-30T12:30:46.083

迅速：

```
self.tableView.scrollRectToVisible(CGRect.zero, animated: false) 
```

# makefile - 有没有办法在不运行 ./configure 的情况下创建 Makefile？

> ID：307859
> 
> 赞同：1
> 
> 时间：2008-11-21T04:26:08.347
> 
> 标签：makefile, configure

我想跳过测试并创建一个（默认）Makefile。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T04:44:49.200

当然你可以手动编写一个makefile。快速谷歌搜索显示了很多教程。[这个](http://mrbook.org/tutorials/make/)看起来很有希望。

对于悬崖笔记版本，该示例归结为：

```
CC=g++
CFLAGS=-c -Wall
LDFLAGS=
SOURCES=main.cpp hello.cpp
OBJECTS=$(SOURCES:.cpp=.o)
EXECUTABLE=hello

all: $(SOURCES) $(EXECUTABLE)

$(EXECUTABLE): $(OBJECTS) 
    $(CC) $(LDFLAGS) $(OBJECTS) -o $@

.cpp.o:
    $(CC) $(CFLAGS) $< -o $@ 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T08:24:43.873

你为什么要第二次猜测作者的辛勤工作？人们生成配置脚本不是为了好玩——他们生成配置脚本是因为确定在*您的*系统上编译程序的正确方法是困难的，而且运行`./configure`比所有替代方法都容易。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-21T06:29:25.213

如果你碰巧在使用 Perl，总有好的 ol'

```
use ExtUtils::MakeMaker;

WriteMakefile(
    'NAME' => 'Foo::Bar',
    'DISTNAME' => 'Foo-Bar',
    'EXE_FILES' => ["foobar.sh"],
    'VERSION_FROM' => 'lib/Foo/Bar.pm',
    ); 
```

但是，您的问题有点短，如果您只是构建**现有**项目，您可能会发现无法跳过配置。

# c# - 从 DetailsView 插入模式将图像上传到数据库

> ID：307874
> 
> 赞同：1
> 
> 时间：2008-11-21T04:32:09.333
> 
> 标签：c#, asp.net, file-upload, detailsview, sqldatasource

我正在尝试通过在 Edit Item 模板中包含 UploadFile 控件的 DetailsView 将图像上传到数据库。

我有一个存储过程，它处理上传到需要两个参数的 SQLServer DB：AuthorName，varchar(20) 和 AuthorImage，varbin(20)。

DetailsView 与 SQLDataSource：Authors 相关联。Authors 数据源具有作为插入命令的存储过程。

我可以在 ItemInserting 事件期间从 UploadFile 控件中获取二进制数据，但我不知道如何将字节数组附加到 AuthorImage 参数。

任何和所有的帮助表示赞赏，如果可能的话，请用 C# 回答。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-21T09:36:09.830

在 asp.net 上，您可以找到处理您的问题的“个人站点入门工具包”。你可以在[asp.net上找到它](http://www.asp.net/downloads/starter-kits/personal/)

# jquery - jQuery可拖动表格元素

> ID：307882
> 
> 赞同：29
> 
> 时间：2008-11-21T04:39:28.663
> 
> 标签：jquery, css, drag-and-drop, html-table

jQuery 的`draggable`功能似乎不适用于表格（在 FF3 或 Safari 中）。很难想象这*将*如何工作，所以它没有发挥作用也就不足为奇了。

```
<html>
  <style type='text/css'>
    div.table { display: table; }
    div.row { display: table-row; }
    div.cell { display: table-cell; }
  </style>
  <script src="http://code.jquery.com/jquery-latest.js"></script>
  <script src="http://dev.jquery.com/view/tags/ui/latest/ui/ui.core.js"></script>
  <script src="http://dev.jquery.com/view/tags/ui/latest/ui/ui.draggable.js"></script>
  <script>
  $(document).ready(function(){
    $(".row").draggable();
  });
  </script>
  <body>
    <div class='table'>
      <div class='row'>
        <div class='cell'>Foo</div>
        <div class='cell'>Bar</div>
      </div>
      <div class='row'>
        <div class='cell'>Spam</div>
        <div class='cell'>Eggs</div>
      </div>
    </div>
    <table>
      <tr class'row'><td>Foo</td><td>Bar</td></tr>
      <tr class='row'><td>Spam</td><td>Eggs</td></tr>
    </table>
  </body>
</html> 
```

我想知道 a) 是否有任何具体原因导致这不起作用（从 w3c/HTML 规范的角度来看）和 b) 获取可拖动表格行的正确方法是什么。

由于边框折叠和行高算法，我喜欢真正的表格——任何可以做这些事情的替代方案都可以正常工作。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2010-02-09T19:25:45.083

也有一种方法可以使用 JQuery UI 使表格行可拖动。您需要做的就是将 helper 选项设置为返回一个新 div 的函数，其中包含一个表格，该表格将承载您拖动的行，例如：

```
helper: function(event){
return $('<div class="drag-cart-item"><table></table></div>').find('table').append($(event.target).closest('tr').clone()).end();
}, 
```

感谢大卫彼得森的提示：[http ://blog.petersendidit.com/post/drag-table-row-to-a-div-with-jquery/](http://blog.petersendidit.com/post/drag-table-row-to-a-div-with-jquery/)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-11-21T05:08:32.427

如果你有真正的表格数据，你应该坚持使用表格。

如果你想*在*表格中拖动行，这个**[JQuery +“可拖动行表”库](http://www.isocra.com/2008/02/table-drag-and-drop-jquery-plugin/)**在 FireFox3 中完美运行

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2012-04-18T13:07:06.590

以防万一有人犯我犯的同样错误：

如果您希望能够通过拖动来对表格中的 TR 重新排序，那么 .sortable 是您所需要的，而不是 .draggable

只有我？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-05-06T00:32:53.060

这有点晚了，但今天我发现**[html5 拖放 API](https://developer.mozilla.org/en-US/docs/DragDrop/Drag_and_Drop)**可以很好地与`<tr>`元素配合使用。您需要做的就是启用它`<tr draggable="true">`并注册事件

```
dragstart
drag
dragenter
dragleave
dragover
drop
dragend 
```

我发现这篇文章很有帮助[http://www.html5rocks.com/en/tutorials/dnd/basics/](http://www.html5rocks.com/en/tutorials/dnd/basics/)

!!请注意，此 html5 API 中存在一个缺陷，即当您将鼠标悬停在子元素上时，即使您只对父元素感兴趣，也会触发该事件。希望 html5rocks 的人能尽快修复它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-08-23T13:12:31.040

我通过使用带有以下内容的 JqueryUI 完成了这项工作：

```
$(function() {
  $(".sortable").sortable({
    revert: true
  });
});
```

```
table td {
  border: solid 1px black;
}
table {
  border-collapse: collapse;
}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
<table>
  <tbody class="sortable">
    <tr>
      <td>1</td>
      <td>One</td>
      <td>some text</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Two</td>
      <td>some text</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Three</td>
      <td>some text</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Four</td>
      <td>some text</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Five</td>
      <td>some text</td>
    </tr>
    <tr>
      <td>6</td>
      <td>Six</td>
      <td>some text</td>
    </tr>
  </tbody>
</table>
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-01-20T12:57:47.090

也可以设置 css `tr.ui-draggable-dragging {display: block}`- 这样可以拖动行，但是，它们的坐标计算不佳。我还没有找到解决这个问题的好方法。

# hosting - 我需要一个 LAMP 堆栈 *with memcache* -- 哪个网络主机？

> ID：307888
> 
> 赞同：1
> 
> 时间：2008-11-21T04:44:38.590
> 
> 标签：hosting, lamp, memcached

我是一名 PHP 开发人员，我已经做了一些我想要推送的东西。

它需要内存缓存，而且我预计会有相当多的流量，至少在发布时是这样，所以我希望它很快。

我在编程方面真的很棒，但是在设置托管东西时（除了普通的共享托管）我缺乏经验。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T04:57:18.190

[Joyent](http://joyent.com/accelerator/pricing/)可能是您的一个很好的解决方案。老实说，将 memcache 添加到 LAMP 堆栈非常容易，您应该能够相对轻松地做到这一点。找到一个好的 VPS 提供商（linode 和 slicehost 非常好，我会在没有我的推荐代码的情况下推荐它们），你应该能够 apt-get install memcache。

但是，要获得更具体的答案，您确实需要量化“相当数量的流量”将是多少。对于某些人来说，一秒钟的打击是巨大的，对于某些人来说，300 h/s 是小菜一碟。

如果您需要帮助，请给我发电子邮件，我很乐意提供帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-25T08:09:36.540

我肯定会考虑使用 linode。

# asp.net - ASP.NET 母版页中的 Google 搜索代码

> ID：307891
> 
> 赞同：1
> 
> 时间：2008-11-21T04:45:45.983
> 
> 标签：asp.net, user-controls, master-pages

我正在尝试将以下 Google 生成的搜索框代码放入网站的母版页中：

```
<form action="http://www.google.com/cse" id="cse-search-box">
  <div>
    <input type="hidden" name="cx" value="partner-pub-xxxxxxxxxx:u3qsil-l6ut" />
    <input type="hidden" name="ie" value="ISO-8859-1" />
    <input type="text" name="q" size="31" />
    <input type="submit" name="sa" value="Search" />
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en"></script> 
```

我相信这个问题与表单标签有关。我已经尝试将此代码放在用户控件中并将其嵌入到母版页中，但还没有运气......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T04:57:24.477

您是否有一个“form runat=server”环绕着您的用户控件的放置位置？
那会引起问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T04:58:16.567

ASP.NET 喜欢用 Form 标签包围整个页面，并且不能嵌套表单标签……所以将它移到 <form runat="Server"> 标签之外就可以了。

# scheme - 如何清除 Scheme 中的内部列表？

> ID：307892
> 
> 赞同：0
> 
> 时间：2008-11-21T04:46:01.943
> 
> 标签：scheme

我有以下代码，并想添加一条“清除消息”，从内部列表中删除所有存储的数字。我该怎么做？

```
 (define (make-stat)
      (let ((values (list)))
        (lambda (op . args)
          (cond ((eq? op 'add)            
                 (set! values (cons (car args) values)))
                ((eq? op 'mean)
                 (if (null? values) 
                     (error "can't take mean of empty data set")
                     (mean values)))
                ((eq? op 'variance)
                 (if (null? values)
                     (error "can't take variance of empty data set")
                     (variance values)))
                (else (error "unknown op" op)))))) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T04:56:34.183

做

```
((eq? op 'clear)
 (set! values '())) 
```

不行？我想我不明白你的绊脚石在哪里。

# c++ - Visual Studio 中的复杂构建

> ID：307900
> 
> 赞同：7
> 
> 时间：2008-11-21T04:50:51.700
> 
> 标签：c++, c, windows, visual-studio, build

我有一些事情在 Visual Studio 中找不到执行的好方法：

1.  预构建步骤调用一个代码生成器，该生成器生成一些稍后编译的源文件。这可以通过在项目中添加空白文件（稍后将其替换为真实生成的文件）在有限程度上解决，但如果我不知道名称和/或自动生成的源文件的数量，它就不起作用。我可以很容易地在`GNU make`使用中解决它`$(wildcard generated/*.c)`。如何使用 Visual Studio 做类似的事情？

2.  如果不需要修改文件（`"make"`行为），我可以阻止预构建/构建后事件运行吗？当前的解决方法是编写一个为我检查时间戳的包装器脚本，它可以工作，但有点笨拙。

3.  找到安装在 VS 之外的外部库和头文件的好方法是什么？在 *nix 的情况下，它们通常会安装在系统路径中，或者使用`autoconf`. 我想我可以在项目设置中使用用户定义的宏指定路径，但是在哪里放置这些宏以便可以轻松找到和调整它们的好地方？

为了清楚起见，我知道存在更好的 Windows 构建系统（`CMake`, `SCons`），但它们通常会自己生成 VS 项目文件，我需要将此项目集成到现有的 VS 构建系统中，所以我希望我只有普通的 VS项目文件，而不是生成的文件。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-21T05:56:53.280

1.  如果您需要 make 行为并且习惯了它，您可以创建[Visual Studio Makefile 项目](http://msdn.microsoft.com/en-us/library/txcwa2xx(VS.80).aspx)并将它们包含在您的项目中。

2.  如果您想要不那么笨重，您可以编写 Visual Studio[宏](http://visualstudiohacks.com/articles/general/customize-your-project-build-process/)和自定义构建事件，并将它们绑定到特定的构建回调/挂钩。

3.  您可以尝试类似[workspacewhiz](http://workspacewhiz.com/SolutionBuildEnvironmentReadme.html)的方法，它可以让您以可以签入的文件格式为您的项目设置环境变量。然后用户可以在本地更改它们。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-20T01:09:00.027

我已经解决了这个确切的问题，并且确实使用自定义构建规则让它工作。

但这总是很痛苦，而且效果不佳。我放弃了 Visual Studio，转而使用 cygwin 的 Makefile 系统。现在好多了。

cl.exe 是 VS 编译器的名称。

更新：我最近改用cmake，它本身就有问题，而cmake可以生成Visual Studio的解决方案。这似乎运作良好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T07:04:45.780

特别是对于#3，我使用属性页来指定第 3 方库位置设置（包括路径、链接路径等）。您可以使用父级或更高级别属性表中的用户宏来指定库本身的起点（如果它们位于公共根位置），然后使用基本路径宏为每个库定义单独的表。它不是自动的，但很容易维护，并且每个开发人员都可以在必要时拥有不同的根目录（它在我们的环境中）。

这种方法的一个缺点是，以这种方式构建的包含路径不包含在 Visual Studio 的搜索路径中（除非您在 VS 的项目和目录设置中复制定义）。我在 PDC08 上与一些 MS 人员谈过为 VS2010 修复此问题，并总体改进界面，但他们没有做出可靠的承诺。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T06:30:06.710

**(1)**。我不知道一个简单的答案，但有一些解决方法：

1a。如果生成文件的内容没有冲突（即没有通用的静态标识符等），您可以向项目添加单个文件，例如 AllGeneratedFiles.c，并修改您的生成器以附加 #include "generated/file. c" 到这个文件，当它产生生成/file.c 时。

1b。或者，您可以为生成的文件创建一个单独的基于 makefile 的项目并使用 nmake 构建它们。

**(2)**。使用自定义构建规则而不是构建后事件。您可以通过右键单击解决方案资源管理器中的项目名称并选择自定义构建规则来添加自定义构建规则。

**(3)**。没有标准的方法可以做到这一点。它必须在每个项目的基础上进行定义。一种方法是使用环境变量来定位外部依赖项。然后，您可以在项目属性中使用这些环境变量。添加一个 readme.txt 描述所需的工具和库以及用户必须设置的相应环境变量，并且任何人都应该很容易设置。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-04T21:28:27.997

根据您正在尝试执行的操作，您有时可以通过使用自定义构建步骤并正确设置依赖项来获得一些运气。将所有生成的代码放入自己的项目中，然后让您的主项目依赖它可能会有所帮助。

# visual-studio-2008 - 如何停止使用 TestDriven.NET 进入 .NET 源代码？

> ID：307901
> 
> 赞同：2
> 
> 时间：2008-11-21T04:52:20.777
> 
> 标签：visual-studio-2008, unit-testing, debugging, testdriven.net

我刚开始使用 TestDriven.NET 来调试我的测试，这是我的设置

测试驱动.NET 2.17
VS 2008 SP1
Windows XP

我遇到的问题是它不断进入 .NET Framework 源代码的异常。我检查了工具 > 选项 > 调试，并且未选中“启用 .NET Framework 源单步执行”，并且选中了“仅启用我的代码（仅限托管）”。

我右键单击测试用例并使用 TD.NET 运行调试。

那么，我该如何关闭它，所以它不会进入 .NET Framework 源代码？

谢谢，雷。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T06:05:12.937

吹走您的 .NET Framework 符号并将您的符号路径更改为奇怪的东西，因此调试器无法单步执行它

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T12:01:16.700

如果您仅在发生异常时介入，则解决方案更简单：转到 Debug -> Exceptions 并取消选中所有复选框。

# .net - VMR9Allocator (DirectShow .NET + SlimDX)

> ID：307924
> 
> 赞同：1
> 
> 时间：2008-11-21T05:07:14.160
> 
> 标签：.net, directx, directshow, slimdx

我试图用 SlimDX 而不是 MDX 转换和运行 DirectShow .NET 的 VMR9Allocator 示例。当它到达这条线时我得到了一个例外

```
return vmrSurfaceAllocatorNotify.SetD3DDevice(unmanagedDevice, hMonitor) 
```

在 Allocator.cs 的 AdviseNotify 方法中。

例外是

> 不支持这样的接口

, hr 回报是

> 0x80004002

.

该示例在 MDX 上运行良好，而且我的 SlimDx 也可以正常工作，因为我已经使用它编写了另一个 3d 应用程序，工作正常。

我似乎无法找出问题所在，谷歌搜索也没有帮助。显然没有多少人使用这种组合，而且我能找到的也不是真正遇到这个问题。

注意：两周前我在 gamedev.net 上问过同样的问题，到目前为止还没有答案。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-24T07:43:51.240

我自己解决了这个问题。它是由使用 DirectX 的调试运行时引起的。切换到零售运行时不会引发错误。另一个微软陷阱

# c++ - vc6和vc7中的CString有什么区别？

> ID：307928
> 
> 赞同：1
> 
> 时间：2008-11-21T05:09:42.877
> 
> 标签：c++, visual-c++-6, cstring

vc6和vc7中的CString有什么区别？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T05:43:54.633

CString 在 VC7 中从 MFC 中删除，以便它可以在 MFC 和 ATL 项目中使用。架构完全改变了：

*   在 VC6 中，CString 没有基类。在 VC7 中，基类是 CStringT<TCHAR>，它派生自 CSimpleStringT<TCHAR>。
*   在 VC7 中，您还可以为显式 char 和 wchar_t 字符串获得 CStringA 和 CStringW。

我不知道它们之间的任何行为差异，但文档在 VC6 中更容易使用。这些方法分散在 VC7 的基类之间。

# sql - 用于解析 SQL 参数的正则表达式

> ID：307929
> 
> 赞同：6
> 
> 时间：2008-11-21T05:09:54.593
> 
> 标签：sql, regex

如果我有一个查询，例如`SELECT * from authors where name = @name_param`，是否有一个正则表达式来解析参数名称（特别是“name_param”）？

谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-21T05:24:14.767

这很棘手，因为参数也可能出现在带引号的字符串中。

```
SELECT * FROM authors WHERE name = @name_param 
  AND string = 'don\'t use @name_param'; 
```

正则表达式如何知道使用第一个`@name_param`而不是第二个？

这是一个可以解决的问题，但是用一个正则表达式来解决是不切实际的。我必须在 Zend_Db 中处理这个问题，我所做的是首先去除所有带引号的字符串和分隔标识符，然后您可以对其余部分使用正则表达式。

你可以看到代码，因为它是开源的。见函数`_stripQuoted()`和`_parseParameters()`。

[https://github.com/zendframework/zf1/blob/136735e776f520b081cd374012852cb88cef9a88/library/Zend/Db/Statement.php#L200](https://github.com/zendframework/zf1/blob/136735e776f520b081cd374012852cb88cef9a88/library/Zend/Db/Statement.php#L200) [https://github.com/zendframework/zf1/blob/136735e776f520b081cd374012852cb88/dStatementce/ .php#L140](https://github.com/zendframework/zf1/blob/136735e776f520b081cd374012852cb88cef9a88/library/Zend/Db/Statement.php#L140)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-21T08:12:24.287

鉴于您没有带引号的字符串或带有参数的注释，所需的正则表达式将非常简单：

```
@([_a-zA-Z]+)       /* match group 1 contains the name only */ 
```

我[同意比尔·卡尔文的建议](https://stackoverflow.com/questions/307929/regex-for-parsing-sql-parameters#307957)要谨慎，因为我知道天真的方法有其陷阱。但是如果你知道你处理的数据，这个正则表达式就是你所需要的。

# windows-vista - 在 Vista 中更改 MAC 地址 - Broadcom 适配器

> ID：307932
> 
> 赞同：0
> 
> 时间：2008-11-21T05:10:42.953
> 
> 标签：windows-vista, networking, mac-address, broadcom

有没有一种方法可以覆盖默认的 mac 地址/在 Vista 机器上为 Broadcom 适配器设置新的 mac 地址？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T06:12:05.373

不能说你的具体情况，但我之前使用[过这里](http://ayaz.wordpress.com/2007/11/24/spoofing-mac-address-i-be-very-bad/)提到的两个工具之一来欺骗/更改 Windows Vista 上以太网适配器的 MAC 地址。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T06:07:21.513

可能不会——虽然这在 Linux 中很容易 :)

# winforms - MVC 与观察者模式

> ID：307933
> 
> 赞同：3
> 
> 时间：2008-11-21T05:11:27.040
> 
> 标签：winforms, model-view-controller, design-patterns, observer-pattern

我最近在 StackoverFlow 上问了一个关于 MVC 的问题：[可以在桌面应用程序开发中使用 MVC 设计模式/架构模式吗？](https://stackoverflow.com/questions/305988/can-the-mvc-design-pattern-architectual-pattern-be-used-in-desktop-application)

根据提供的答案，我开始研究如何在 Windows 窗体应用程序中实现这一点。我遇到了以下 CodeProject 文章： http: [//www.codeproject.com/KB/cs/model_view_controller.aspx](http://www.codeproject.com/KB/cs/model_view_controller.aspx)

在文章下方的评论中，某些用户认为（尽管这是一篇好文章）它实际上是观察者模式。**首先，但不太重要的问题是，是否有人同意或不同意这一点，为什么？**

关于第二个也是更重要的问题：我正在尝试在 .NET 中构建一个小型任务列表程序。它会非常小，希望很快。**一般来说，对于这样的项目，什么是更好的架构？观察者模式还是 MVC 模式？还是另一种模式？**

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-22T00:58:50.297

通常 mvc 中的模型（[http://en.wikipedia.org/wiki/Model-view-controller](http://en.wikipedia.org/wiki/Model-view-controller)）是可观察的/主题（[http://en.wikipedia.org/wiki/Observer_pattern#Subject](http://en.wikipedia.org/wiki/Observer_pattern#Subject)），而意见是观察者（[http://en.wikipedia.org/wiki/Observer_pattern#Observer](http://en.wikipedia.org/wiki/Observer_pattern#Observer)）。另请参阅：[http ://webcourse.cs.technion.ac.il/234321/Winter2005-2006/ho/WCFiles/08-Design-Patterns.ppt 中的 mvc](http://webcourse.cs.technion.ac.il/234321/Winter2005-2006/ho/WCFiles/08-Design-Patterns.ppt)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T06:09:54.723

*（这篇文章不是 MVC AFAIK 的示例，原因很简单，因为没有控制器。如果你问我，它更接近 .net 数据绑定。）*
MVC 不是观察者模式。MVC 关注关注点分离。模型、视图和控制器都做一项工作，并信任其他人做他们的工作。在某种程度上，控制器“指导”视图并告诉它如何对更改做出反应（纯 MVC）。控制器还与模型进行适当的交互（其职责是封装数据并执行约束/规则）。在 MVC 中，控制器是所有活动的起点——用户输入首先由控制器接收。但是也有像 MVP 这样的变体，其中用户输入首先由视图接收，然后推送/与演示者同步。

观察者模式是你想要观察另一个对象状态变化的地方。所以你可以说 .net 事件遵循观察者模式

如果它真的很小，忘记模式，只需编写代码而不用担心架构......遵循良好设计的启发式/原则

*   [http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod](http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod)
*   [http://mmiika.wordpress.com/oo-design-principles/](http://mmiika.wordpress.com/oo-design-principles/)

如果您遇到设计问题或者它开始变得一团糟，那么请引入模式营。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T05:54:18.483

我同意这篇文章不是 MVC。它更多的是观察者模式的实现。.NET 中的观察者模式可以通过使用事件来实现，本文就是这种情况。

MVC 需要一个控制器类来控制对来自模型或视图的请求执行什么操作。应用 MVC 是一种非常好的编程实践，因为它极大地促进了关注点分离。使用 mvc，您将拥有一个更简洁、更可扩展和更可测试的应用程序。还有一点需要注意，您仍然可以将观察者模式应用于 MVC 应用程序。他们不会互相矛盾。

===========

回答您的第二个问题：哪种模式最好？我认为你处理软件开发的方式是相当错误的。你不应该太担心这些事情，直到你遇到问题。例如，如果这个对象改变状态，我需要这些其他对象对其做出反应，因此我将实现一个观察者模式。

如果我是你，我会先从模特方面开始，然后从那里拿东西。

# asp.net - IIS、Asp.NET 管道和并发

> ID：307936
> 
> 赞同：2
> 
> 时间：2008-11-21T05:13:03.120
> 
> 标签：asp.net, iis-7, concurrency, pipeline

我想知道 Web 应用程序中的并发性实际上是如何工作的。我已经阅读了几篇文章，据我了解，HttpApplication 的多个实例将同时工作。现在，我创建了一个简单的 Web 应用程序来测试并发性并将以下内容放入 global.asax：

```
protected void Application_BeginRequest(object sender, EventArgs e)
{
    Response.Write("Request started: " + DateTime.Now);
    System.Threading.Thread.Sleep(10000);
    Response.Write("<br />");
    Response.Write("Request ended: " + DateTime.Now);
    Response.End();
} 
```

我期望如果我几乎同时在多个浏览器选项卡中浏览到 Web 应用程序根目录，它们会同时启动和停止。然而，他们似乎没有。第二个标签开始时间与第一个结束时间相同。然后，我通过在 httpmodule 或 default.aspx page_load 中使用相同的代码进行测试，并得到了相同的结果。

这里发生了什么？为什么不并行处理请求？

**编辑：**我主要将我的理解放在两篇文章中：

[http://msdn.microsoft.com/en-us/magazine/cc188942.aspx](http://msdn.microsoft.com/en-us/magazine/cc188942.aspx)说“如果针对同一应用程序的多个请求同时到达，将使用多个 HttpApplication 对象。”

并且[http://www.code-magazine.com/article.aspx?quickid=0511061&page=5](http://www.code-magazine.com/article.aspx?quickid=0511061&page=5)有一个 aspx 页面的示例，它基本上按照我的测试进行，并带有评论“模拟慢速请求，因此我们可以并排看到多个请求。” 在 Thread.Sleep 调用旁边

我可能完全误解了某些东西……但是什么？

[http://www.code-magazine.com/article.aspx?quickid=0511061&page=5](http://www.code-magazine.com/article.aspx?quickid=0511061&page=5)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-21T06:26:53.300

每个到达的请求都被路由到一个单独的 HttpApplication 对象。HttpApplication 对象要么从头开始创建，要么从池中分配。创建的 HttpApplication 对象的最大数量受可用线程的最大数量限制。在 ASP.NET 1.x 中，我认为默认值是 20 左右。在 ASP.NET 2.0 下，此限制是动态管理的。

您需要创建足够多的请求来耗尽 ASP.NET 线程池，然后才能看到您的应用程序开始步履蹒跚。

代码文章中的评论的意思并不是他的代码成为服务器的瓶颈，他使用它作为一种能够并排查看多个请求的状态的方式，例如不同的线程 ID。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-21T06:14:58.940

呵呵。问题是谷歌浏览器。我在其中打开了两个选项卡，似乎当它们指向相同的 url 时，请求按顺序发送，一个接一个完成！

不过感谢您的想法！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T05:51:21.327

为什么不修改示例以打印线程 ID？这将告诉您是否有多个线程同时为请求提供服务。我敢打赌。

# java - 对于不存在的文件，file.delete() 是否返回 true 或 false？

> ID：307939
> 
> 赞同：10
> 
> 时间：2008-11-21T05:14:43.290
> 
> 标签：java, file

在 java 中，`file.delete()`return`true`或`false`where`File file`指的是不存在的文件吗？

我意识到这是一个基本问题，很容易通过测试，但我得到了奇怪的结果，希望得到确认。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-21T05:20:23.387

从[http://java.sun.com/j2se/1.5.0/docs/api/java/io/File.html#delete()](http://java.sun.com/j2se/1.5.0/docs/api/java/io/File.html#delete())：

返回：当且仅当文件或目录被成功删除时为真；否则为假

因此，它应该为不存在的文件返回 false。以下测试证实了这一点：

```
import java.io.File;

public class FileTest
{
    public static void main(String[] args)
    {
        File file = new File("non-existent file");

        boolean result = file.delete();
        System.out.println(result);
    }
}
```

编译并运行此代码会产生错误。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-21T05:20:17.647

这不会导致 FileNotFoundException 吗？

编辑：

事实上，它确实会导致错误：

```
import java.io.File;

public class FileDoesNotExistTest {

  public static void main( String[] args ) {
    final boolean result = new File( "test" ).delete();
    System.out.println( "result: |" + result + "|" );
  }
} 
```

印刷`false`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T05:19:52.107

官方javadoc：

```
Deletes the file or directory denoted by this abstract pathname. If this pathname denotes a directory, then the directory must be empty in order to be deleted.

Returns:
    true if and only if the file or directory is successfully deleted; false otherwise 
Throws:
    SecurityException - If a security manager exists and its SecurityManager.checkDelete(java.lang.String) method denies delete access to the file 
```

所以，假的。

# mysql - 如何从 Perl MySQL DBI 句柄中获取数据库名称？

> ID：307941
> 
> 赞同：5
> 
> 时间：2008-11-21T05:14:51.883
> 
> 标签：mysql, perl, dbi

我已经使用 Perl DBI 连接到 MySQL 数据库。我想知道我连接到哪个数据库。

我不认为我可以使用：

```
$dbh->{Name} 
```

因为我调用[`USE new_database`](http://dev.mysql.com/doc/refman/5.0/en/use.html)并且`$dbh->{Name}`只报告我最初连接的数据库。

有什么技巧还是我需要跟踪数据库名称？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-21T05:37:41.493

尝试只执行查询

```
select DATABASE(); 
```

据我所知，DBH 可以访问您最初连接的 DSN，但在您进行更改后无法访问。（切换数据库可能有更好的方法。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-01-08T14:10:54.957

`$dbh->{Name}`从您的数据库句柄返回数据库名称。

如果您在连接 dbh 后连接到另一个 db，使用 mysql 查询“USE db_name”，并且您没有设置新的 perl DBI db 句柄，当然，$dbh->{Name} 将返回您之前连接的第一个...这不是自发的一代。

因此，一旦设置了数据库句柄，就获取连接的数据库名称 - 对于 DBI mysql：

```
sub get_dbname {  
    my ($dbh) = @_;  
    my $connected_db = $dbh->{name};  
    $connected_db =~ s/^dbname=([^;].*);host.*$/$1/;  
    return $connected_db;  
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T05:35:21.890

你可以问mysql：

```
($dbname) = (each %{$dbh->selectrow_hashref("show tables")}) =~ /^Tables_in_(.*)/; 
```

更新：显然 select DATABASE() 是一种更好的方法:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T05:40:08.090

当您创建连接对象时，它是针对某个数据库的。无论如何，在 DBI 的情况下。我不相信执行 SQL`USE database_name`会影响您的连接实例。也许连接对象有一个 select_db（我的 DBI 生锈）函数，或者您必须创建一个到新数据库的新连接，以便连接实例正确报告它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T07:25:04.413

FWIW - 可能不多 - DBD::Informix 跟踪当前数据库，如果您执行 CREATE DATABASE 等操作，该数据库可能会发生变化。该`$dbh->{Name}`属性由 DBI 规范指定为在建立句柄时使用的名称。因此，有一个特定于 Informix 的属性`$dbh->{ix_DatabaseName}`提供实际的当前数据库名称。见：`perldoc DBD::Informix`。

您可以考虑请求 DBD::MySQL 的维护者添加一个类似的属性。

# tsql - 如何有条件地在 Sybase (TSQL) 中创建表？

> ID：307942
> 
> 赞同：14
> 
> 时间：2008-11-21T05:15:09.857
> 
> 标签：tsql, conditional, ddl, sap-ase

好的，所以 Sybase (12.5.4) 将让我执行以下操作来 DROP 一个表（如果它已经存在）：

```
IF EXISTS (
    SELECT 1
    FROM sysobjects
    WHERE name = 'a_table'
    AND type = 'U'
)
DROP TABLE a_table
GO 
```

但是如果我尝试对表创建做同样的事情，我总是会收到表已经存在的警告，因为它继续尝试创建我的表并忽略了条件语句。只需尝试运行以下语句两次，您就会明白我的意思：

```
IF NOT EXISTS (
    SELECT 1
    FROM sysobjects
    WHERE name = 'a_table'
    AND type = 'U'
)
CREATE TABLE a_table (
    col1 int not null,
    col2 int null
)
GO 
```

运行以上会产生以下错误：

> *SQL Server 错误（localhost）错误：2714 at Line:7 消息：数据库中已经有一个名为“a_table”的对象。*

这有什么关系？！

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-21T05:49:55.620

到目前为止，我想出的唯一解决方法是立即执行：

```
IF NOT EXISTS (
    SELECT 1
    FROM sysobjects
    WHERE name = 'a_table'
    AND type = 'U'
)
EXECUTE("CREATE TABLE a_table (
    col1 int not null,
    col2 int null
)")
GO 
```

像魅力一样工作，感觉像一个肮脏的黑客。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-12-22T16:32:10.967

除了打电话别无他`create table`法`execute("create table ...")`

SYBASE 手册说：

> 当 create table 命令出现在 if...else 块或 while 循环中时， Adaptive Server 在确定条件是否为真之前为表创建模式。如果表已经存在，这可能会导致错误。为避免这种情况，请确保数据库中不存在同名视图或使用执行语句，如下所示：

```
if not exists
    (select * from sysobjects where name="my table")
begin
execute "create table mytable(x int)"
end 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-21T17:18:04.343

我没有对此进行测试，但您可以尝试将 create table 语句移动到 sproc 中。然后，您可以根据现有的 if 语句有条件地调用该存储过程。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-06-12T17:23:15.563

在 char @variable 中分配“CREATE TABLE”语句，然后执行 EXEC(@variable)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-02-21T15:05:32.383

如果您想始终创建表，但有条件地删除它，您可以使用：

```
IF(SELECT count(*) FROM sysobjects WHERE name="tableNameWithoutUserPart") > 0
    DROP TABLE tableNameWithUserPart
GO

CREATE TABLE tableNameWithUserPart ... 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-11-02T10:21:24.403

不需要解决方法；）

根据文档：

```
CREATE [ GLOBAL TEMPORARY ] TABLE [ IF NOT EXISTS ] [ owner.]table-name
( { column-definition | table-constraint | pctfree }, ... )
[ { IN | ON } dbspace-name ]
[ ENCRYPTED ]
[ ON COMMIT { DELETE | PRESERVE } ROWS
   | NOT TRANSACTIONAL ]
[ AT location-string ]
[ SHARE BY ALL ] 
```

只需使用如果不存在。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-11-21T05:24:33.970

```
IF object_id('a_table') IS NULL
BEGIN
    CREATE TABLE a_table (
        col1 int not null,
        col2 int null
    ) 
END 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2015-01-16T15:36:47.007

这在使用**Sybase Anywhere 10.01**进行测试时有效：

```
if not exists(select * from SysColumns where tname = 'AAA') then create table DBA.AAA(  UNIQUEID integer not null ) END IF ; 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-12-01T17:20:39.313

尝试使用开始和结束。

IF NOT EXISTS (SELECT Count(1) FROM sysobjects WHERE name = 'a_table' AND type = 'U') **BEGIN** CREATE TABLE a_table ( col1 int not null, col2 int null ) **END** GO

# bash - 如何从 Microsoft FTP 服务器删除超过 N 周的文件

> ID：307951
> 
> 赞同：1
> 
> 时间：2008-11-21T05:19:29.940
> 
> 标签：bash, scripting, ftp

我运行一个 OpenSuse 服务器，它每晚将压缩的源代码备份上传到 Microsoft FTP 服务器。我已经编写了一个 Bash 脚本，它通过一个 cron 作业来执行此操作。

我想删除早于某个日期的备份文件。我怎么能这样做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T05:29:01.763

*下面删除以dir*为根的目录树下所有最后修改时间在 11 月 1 日之前的文件：

```
find dir -type f \! -newermt 2008-11-01 -exec rm '{}' \+ 
```

日期/时间格式应为 ISO 8601；我不知道是否接受其他格式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T06:19:15.560

您可以使用 delete 或 mdelete FTP 命令删除 FTP 服务器上的文件。我不知道选择旧文件作为服务器端操作的方法，因此一种选择是执行 FTP ls 以获取服务器上的文件列表，然后解析输出以获取那些文件早于您指定的日期。然后使用 FTP 命令删除每一个。

如果您有所有文件的本地副本，那么使用 find 在本地生成文件列表然后从服务器一次删除一个可能更容易。

如果您对 FTP 服务器有一定的控制权，那么使用 rysnc 代替 FTP 可能会更容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-09T18:11:48.977

不幸的是，从 FTP 服务器删除旧文件并不像运行 find 那样简单。-mtime +30 -delete 因为通常您无法通过 shell 访问您的 FTP 空间。一切都必须通过 FTP 完成。

[这里](http://www.nervous.it/2009/08/delete-old-files-from-ftp-server/)有一个简单的 perl 脚本可以解决问题。它需要`Net::FTP`模块。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-03T05:08:46.947

```
/*******************************************************************************************
* Author: Kevin Osborne
* This java app aims to delete non-empty directories from an FTP server that are older than 
* 45 days, the 45 can be changed to whatever.  I believe it's recursive, but I've only tried
* with 3 levels deep, so I can't guarantee anything beyond that, but it worked for my needs 
* and hopefully it will for yours, too.
*
* It uses ftp4j, which I found to be incredibly simple to use, though limited in some ways.
* feel free to use it, I hope it helps. ftp4j can be downloaded as a jar file here:
* http://www.sauronsoftware.it/projects/ftp4j/ just include it in your IDE.
*******************************************************************************************/

package siabackupmanager;

import java.util.Calendar.*;
import java.util.*;
import it.sauronsoftware.ftp4j.*;

public class SIABackupManager {

   // @SuppressWarnings("static-access")
    public static void main(String[] args) {
    if (args.length != 3) {
        System.out.println("Usage: java -jar SIABackupManager.jar HOST USERNAME PASSWORD");
        System.exit(0);
    }
    try {
        FTPClient client = new FTPClient();
        String hostname = args[0];
        String username = args[1];
        String password = args[2];

        client.connect(hostname);
        client.login(username, password);

        FTPFile[] fileArray = client.list();

        for (int i = 0; i < fileArray.length; i++) {

            FTPFile file = fileArray[i];
            if (file.getType() == FTPFile.TYPE_DIRECTORY) {

                java.util.Date modifiedDate = file.getModifiedDate();
                Date purgeDate = new Date();
                Calendar cal = Calendar.getInstance();
                cal.add(Calendar.DATE, -45);
                purgeDate = cal.getTime();

                if (modifiedDate.before(purgeDate)) {

                        String dirName = file.getName();
                        deleteDir(client, dirName);
                        client.changeDirectoryUp();
                        client.deleteDirectory(dirName);
                }
            }
        }
     } catch(Exception ex) { System.out.println("FTP error: " + ex.getMessage()); }
  }

  public static void deleteDir(FTPClient client, String dir) {
        try {
            client.changeDirectory(dir);
            FTPFile[] fileArray = client.list();
            for (int i = 0; i < fileArray.length; i++) {
                FTPFile file = fileArray[i];
                if (file.getType() == FTPFile.TYPE_FILE) {
                    String fileName = file.getName();
                    client.deleteFile(fileName);
                }
            }
            for (int i = 0; i < fileArray.length; i++) {
                FTPFile file = fileArray[i];
                if (file.getType() == FTPFile.TYPE_DIRECTORY) {
                    String dirName = file.getName();
                    deleteDir(client, dirName);
                    client.changeDirectoryUp();
                    String currentDir = client.currentDirectory();
                    client.deleteDirectory(dirName);
                }
            }
         } catch (Exception ex) { System.out.println("deleteDir error: " + ex.getMessage()); }
    }
} 
```

# .net - 面试程序示例

> ID：307955
> 
> 赞同：1
> 
> 时间：2008-11-21T05:21:57.160
> 
> 标签：.net

关于编程工作的面试中会提出哪些问题，有几个话题，但没有一个真正谈论一些公司想要的小问题：示例程序。

我的问题是基于我上次的工作申请，我被要求**创建一个简单的程序**并将其发送给他们。

好吧，这提出了几个问题：

*   我应该写什么样的程序？
*   我应该实施什么？
*   我应该用什么来炫耀技术的东西？

**最重要**的是（是审查代码的那个人的几个用户）公司期望什么？

我目前的想法是**使用 XML 文件创建一个简单的博客**来存储数据，如果需要，构建一个带有添加/编辑/删除功能的简单 ASP.NET 页面，并创建一个窗口窗体以及一个命令行应用程序照着做。

**我不**应该避免的事情：

*   注释所有代码
*   使用区域划分代码
*   创建与“博客”一起使用的类对象

我应该：

*   使用接口？
*   使用`virtual`和覆盖某些方法（`myBlog.ShowPost()`例如）？
*   应用任何设计模式？
*   使用助手/实用程序类？
*   使用 DAL 和 BLL？

我应该如何“运输”...

*   使用 MSI（证明我可以创建好的安装程序）
*   只需将代码作为 Visual Studio 项目发送

非常感谢任何关于简单程序的想法，以及代码中应该包含的内容：)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T05:25:00.803

问客户他们想要什么，不要猜测

你写了一个 xml-blog 程序，他们说“这很好，但我们在这里做桌面开发”

你编写了一个优化的非关系并行数据库，他们说“这很好，但我们在这里制作金融网络应用程序”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-21T05:54:08.827

利用这个机会向他们展示你知道如何对待客户。开始讨论什么是重要的，他们希望如何交付，时间表是什么，他们是否需要文档等等。

如果他们不想给你任何特定的问题来解决，试着写一个与他们的主要产品领域相关的程序。或者至少坚持使用他们使用的一些技术。

确保您交付给他们的任何内容都足够完整，并且包含源代码和部署包。确保您有足够好的文档，以便技术人员能够通过最多两个三个简单的步骤成功构建您的程序。使部署包足够简单，以便非技术人员可以快速运行您的程序。它不必是 MSI，一个复制所有文件的批处理文件就足够了，只要它是一个命令。

确保您的代码组织良好并带有注释。避免编写晦涩的代码技巧和不必要的优化。找到一组好的编码指南（SO 有几个关于该主题的主题）并坚持下去。

避免突击队模式。:-) 使用你觉得舒服的设计模式。在适当的情况下使用接口、继承、抽象和适当的架构层。

换句话说，编写代码以使技能比您低的程序员能够理解和维护它。

只要您确保他们知道这一点，在您的程序中使用外部代码就可以了。清楚任何代码来自哪里以及它是根据什么许可证发布的。

附带说明一下，为您的代码添加一个许可证，禁止出于商业目的重新发布或重用。

以上所有这些听起来有点太复杂了，但这就是专业开发人员所做的——他们不只是编写代码，而是交付产品。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-24T17:24:17.090

对我来说，这听起来很可疑。他们希望你免费为他们编写一个完整的示例应用程序，看看他们是否想雇用你？这是永久职位还是咨询工作？

我不会这样做的。在我看来，如果你并不绝望，那么你最好把时间花在申请其他面试更合适的公司上。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-24T17:18:06.917

我建议的简单程序：

1) 查看重构中给出的关于电影租赁示例的示例，该示例涉及客户、电影和租赁，可以指定一定长度以显示他们可以做什么。

2) FizzBu​​zz 是另一个在各个地方都在谈论的简单程序思想。

3) 一些简单的字符串函数，例如反转字符串或对于给定的整数返回有多少个 1 位。

不要忘记您应该记录诸如算法的复杂性（时间和空间）、您在代码中做出的假设、您为验证代码所做的测试以及可能有助于任何开发人员的通用 README继承代码。

# jsp - JSP/Servlet 中的倒数计时器

> ID：307964
> 
> 赞同：2
> 
> 时间：2008-11-21T05:28:32.293
> 
> 标签：jsp, servlets, timer

我正在使用 servlets/jsp 开发在线考试。我需要在问题页面中添加一个倒计时 (hh/mm/ss) 计时器，以结束考试并重定向到结果页面。

我完成了除计时器之外的所有其他功能。

有人可以提供一些帮助。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T05:41:19.303

您是否尝试过 JavaScript 解决方案。自己写很容易。网上也有很多例子，比如[这个](http://javascript.internet.com/time-date/countdown-timer.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-20T13:42:40.850

```
<html>
<%@page session="false" %>
<%
HttpSession s=request.getSession(false);

if(s==null) { %>

    <jsp:forward page="/Expired" />
<% } %>
<% String duration=(String)s.getAttribute("duration"); %>
<% int a=Integer.parseInt(duration); %>
<head><title></title>
<script type="text/javascript">
var cmin=<%= a %>;
var total=cmin*60;
cmin=cmin-1;
var ctr=0;
var dom=document.getElementById("kulu");
function ram(){
var dom=document.getElementById("kulu");
dom.value=(cmin)+"minutes"+(total%60)+"seconds";
<% String t=(String)s.getAttribute("over"); %>
var tt=<%= t %>
if(tt=="false"){ram1();}
total=total-1;ctr++;
if(ctr==60){ctr=0;cmin=cmin-1;}
if(total==0){
ram1();}
setTimeout("ram()", 1000);
              }
function ram1(){

window.location.replace("/hcl/TTimeUp.jsp");

                }
</script>
</head>
<body background="image/background.gif" onload="ram()"><center>
<form name="form1">
<input type="text" id="kulu"/>
</form>
</center>
</body>
</html> 
```

# asp.net - ASP.NET 将属性传递给动态生成的用户控件

> ID：307967
> 
> 赞同：0
> 
> 时间：2008-11-21T05:31:03.943
> 
> 标签：asp.net, user-controls

我正在努力做一些事情，我敢肯定，应该很容易。我已经在后端和 winforms 代码中生活了很长时间，并且我正在构建我一年多以来的第一个 ASP.NET 页面，所以对于任何noobishness 深表歉意

我在页面上的用户控件中。

在此用户控件（父控件）上，我需要在表中嵌入 0 .. n 个子用户控件，其中每个子用户控件代表父用户控件上列表框中的一行。

在子用户控件上，我有一些需要设置的属性，例如它所代表的列表框中项目的 id。

在我看来，我可以

*   在代码隐藏中循环遍历此列表框，并尝试将表格行和子用户控件动态插入现有标记中，并设置对象的属性，这是我尚未完成的工作 - 添加的控件只是不出现
*   使用老式 ASP 技巧循环遍历 <% %> 标记内的列表框中的项目，并嵌入我的 <uc:ChildUserControl runat="server" > 标记，但我无法在 ChildUserControl 上设置所需的属性（我已经尝试了一些东西，但主要问题是我不能在服务器控件中使用 <% %>）
*   做一些我目前无法做到的事情

任何想法都会受到欢迎

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T05:47:16.780

转发器控件绑定到与列表框相同的数据源？

# emacs - 当前版本的 Emacs calc 在哪里？

> ID：307968
> 
> 赞同：2
> 
> 时间：2008-11-21T05:31:09.620
> 
> 标签：emacs, elisp, calc

通过重新安装 Cygwin，我丢失了 Dave Gillespie 的 calc.el 安装。它不包含在 Emacs 的默认 Cygwin 安装中。现在谁被认为是主维护者？2.02f 版仍然是最新的吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T05:53:42.570

在 Emacs CVS 树中。请参阅[calc 页面](http://www.gnu.org/software/emacs/calc.html)和[Emacs 项目页面](http://savannah.gnu.org/projects/emacs/)。calc 子树的根在[这里](http://cvs.savannah.gnu.org/viewvc/emacs/lisp/calc/?root=emacs)，您可以通过键入获取最新版本

```
cvs -d:pserver:anonymous@cvs.sv.gnu.org:/sources/emacs co emacs/lisp/calc 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-21T07:11:27.467

感谢 Jouni 明确表示 GNU 确实维护 Emacs Calc，我发现有一个 Cygwin 安装的 Emacs 确实包含 Calc。必要的步骤是强制 Cygwin 安装程序安装 Emacs 22.1-3 而不是默认的 21.2-13。我已向 cygwin@cygwin.com 邮件列表发送了一份报告以修复此问题。

# iphone - 是否可以通过 iPhone API 获得下载使用统计信息？

> ID：307969
> 
> 赞同：1
> 
> 时间：2008-11-21T05:31:16.593
> 
> 标签：iphone

你是我最后的希望stackoverflowers。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-21T05:49:26.573

不，这在 iPhone 上是不可能的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-23T21:59:11.467

不。

您需要通过 iTunes Connect 网站进行此操作

# sql - 什么 SQL 查询向我显示了 Informix 上的视图使用的表和索引？

> ID：307983
> 
> 赞同：1
> 
> 时间：2008-11-21T05:47:34.953
> 
> 标签：sql, informix

什么 SQL 查询向我显示了 Informix 上的视图使用的表和索引？

我知道如何在 SYS_VIEWS 中找到视图的“原始创建语句”，但这需要人脑扫描/探索该选择。我相信一旦确定了表格，我就可以找到它们是否被索引。

背景：我需要确保某些关键视图指向当前（例如，在“重组”之后）表。我经常看到指向旧备份表的视图，这些表不再被索引，并且需要很长时间才能查询。

我需要定期识别这些查询并“提醒”调优 DBA 重建视图/索引。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-21T07:19:35.737

该表`sysdepend`记录了视图依赖项。这些列是：

*   btabid - 基表 ID 号
*   btype - 通常 T 代表表格或 V 代表视图
*   dtabid - 从属表 ID 号
*   dtype - 通常 T 代表表格或 V 代表视图

因此，对于带有 tabid N 的给定视图，您可以编写：

```
SELECT b.owner, b.tabname, d.*
    FROM "informix".systables b, "informix".sysdepend d
    WHERE d.dtabid = N
      AND d.btabid = b.tabid; 
```

如果您只知道视图名称，那么如果您的数据库是 MODE ANSI 数据库，您可能有多个表具有相同的表名（或本例中的视图名）但每个表都有不同的所有者，那么确定视图的 tabid 会非常棘手。但是，在通常情况下（非 ANSI 数据库，或唯一的表/视图名称），查询很简单：

```
SELECT b.owner, b.tabname, d.*
    FROM "informix".systables b, "informix".sysdepend d
    WHERE d.dtabid = (SELECT v.tabid FROM "informix".systables v
                         WHERE v.tabname = "viewname"
                     )
      AND d.btabid = b.tabid; 
```

该问题询问视图使用的索引。视图本身不使用索引；查询引擎在处理查询时使用索引，但使用的索引可能会根据总查询而改变 - 因此这两个查询可能会使用不同的索引：

```
SELECT * FROM SomeView;

SELECT * FROM SomeView
    WHERE Column1 BETWEEN 12 AND 314; 
```

将使用的索引不会记录在系统目录中的任何位置；它们在准备语句时动态重新确定。

该问题还指出：

> 背景：我需要确保某些关键视图指向当前（例如，在“重组”之后）表。我经常看到指向旧备份表的视图，这些表不再被索引，并且需要很长时间才能查询。

How do you do your reorganization? Do you create a new table with the desired structure, copy the data from old to new, then rename old, rename new? That probably would be the explanation - the table renaming reworks the views that reference the table. What form of reorganization are you doing? Can you use a different technique? A classic standby is to use ALTER INDEX *indexname* TO CLUSTER (after altering it to NOT CLUSTER if it was already clustered). This rebuilds the table and the indexes - without the views breaking. Alternatively, you can consider an ALTER FRAGMENT operation.

保留旧桌子似乎也有点奇怪。这表明您的重组更多是丢弃旧数据的问题。也许您应该按日期范围对表格进行分段，以便在片段达到“使用寿命结束”日期时分离片段。删除表也会删除依赖它的视图，确保您使用新表名重建视图。

因此，另一种选择是简单地确保重组删除并重新创建视图。

> 我需要定期识别这些查询并“提醒”调优 DBA 重建视图/索引。

令人担忧……这应该只是完成重组的标准程序的一部分。基本上，您在该过程中有一个错误要报告 - 它不能确保视图完全可操作。

# c# - 动态声明一个泛型类型实例

> ID：307984
> 
> 赞同：30
> 
> 时间：2008-11-21T05:47:38.963
> 
> 标签：c#, .net, generics

是否可以在设计时不知道类型的情况下声明泛型的实例？

例子：

```
Int i = 1;
List<typeof(i)> list = new List<typeof(i)>(); 
```

i 的类型可以是任何东西，而不是必须这样做：

```
List<int> list = new List<int(); 
```

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-11-21T06:24:44.753

如果您在编译时不知道类型，但您想要实际类型（即 not `List<object>`）*并且*您不在具有适当类型参数的泛型方法/类型中，那么您必须使用反射。

为了使反射更简单，我有时会在自己的代码中引入一个新的泛型类型或方法，所以我可以通过反射来调用它，但之后只使用普通的泛型。例如：

```
object x = GetObjectFromSomewhere();
// I want to create a List<?> containing the existing
// object, but strongly typed to the "right" type depending
// on the type of the value of x
MethodInfo method = GetType().GetMethod("BuildListHelper");
method = method.MakeGenericMethod(new Type[] { x.GetType() });
object list = method.Invoke(this, new object[] { x });

// Later

public IList<T> BuildListHelper<T>(T item)
{
    List<T> list = new List<T>();
    list.Add(item);
    return list;
} 
```

当然，如果你不知道类型，你以后不能对列表做很多事情......这就是为什么这种事情经常掉下来的原因。但并非总是如此 - 我曾多次使用上述类似的东西，其中类型系统并不能让我静态地表达我需要的所有内容。

编辑：请注意，尽管我在上面的代码中调用 Type.GetMethod，但如果您要执行很多次，您可能只想调用一次 - 毕竟，该方法不会改变。您可以将其设为静态（在上述情况下可以），并且您可能也希望将其设为私有。为了简化示例代码中的 GetMethod 调用，我将其保留为公共实例方法 - 否则您需要指定适当的绑定标志。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-21T05:59:51.403

我认为你能做的最好的事情是这样的：

```
static void Main(string[] args)
{
    int i = 1;
    var thelist = CreateList(i);
}

public static List<T> CreateList<T>(T t)
{
    return new List<T>();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-21T06:05:54.637

如果您在设计时不知道类型，我会说您有一个 OBJECTS 列表（所有其他类型的基类）。

```
List<object> list = new List<object>(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T06:10:37.420

您也可以使用 Activator.CreateInstance。示例代码片段：

```
public class BaseRepository<T> where T : DataContext
{
   protected T _dc;

   public BaseRepository(string connectionString)
   {
      _dc = (T) Activator.CreateInstance(typeof(T), connectionString);
   }

   public void SubmitChanges()
   {
      _dc.SubmitChanges();
   }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T18:32:25.427

如果您仍想键入 .Add()、.Remove()、执行 foreach 等，您可以将 List 视为常规的“旧”System.Collections.IList，因为这个接口幸运地由 List<T> 实现。

而且由于该问题的所有其他已发布答案几乎都显示了动态创建 List<T> 实例的所有其他可能方式，因此我将展示最后一种方法。我个人在创建泛型实例时使用此方法，当我在编译时对类型一无所知，并且类型必须作为字符串传递时，可能来自应用程序配置文件。在这个例子中，为了简单起见，T 是 System.String，但它可以是任何东西：

```
Type T = typeof ( string ); // replace with actual T
string typeName = string.Format (
  "System.Collections.Generic.List`1[[{0}]], mscorlib", T.AssemblyQualifiedName );

IList list = Activator.CreateInstance ( Type.GetType ( typeName ) )
  as IList;

System.Diagnostics.Debug.Assert ( list != null ); //

list.Add ( "string 1" ); // new T
list.Add ( "string 2" ); // new T
foreach ( object item in list )
{
  Console.WriteLine ( "item: {0}", item );
} 
```********