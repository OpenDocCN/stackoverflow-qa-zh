# StackOverflow 问答 000354000-000354999

# mysql - Mysql选择不在表中的位置

> ID：354002
> 
> 赞同：54
> 
> 时间：2008-12-09T19:52:13.540
> 
> 标签：mysql, join, not-exists

我有 2 个具有相同主键的表（A 和 B）。我想选择 A 中而不是 B 中的所有行。以下工作：

```
select * from A where not exists (select * from B where A.pk=B.pk); 
```

但是它似乎很糟糕（A 中只有 100k 行约 2 秒，B 中少 3-10k 行）

有没有更好的方法来运行它？也许作为左连接？

```
select * from A left join B on A.x=B.y where B.y is null; 
```

根据我的数据，这似乎运行得稍微快一些（~10%），但总的来说呢？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-12-09T20:09:52.587

我认为你的最后陈述是最好的方法。你也可以试试

```
SELECT A.*    
from A left join B on 
    A.x = B.y
    where B.y is null 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-12-09T20:47:39.530

我使用第二个示例格式的查询。连接通常比相关子查询更具可扩展性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-27T14:52:17.600

我还使用带有“table2.id 为空”类型标准的左连接。

当然似乎比嵌套查询选项更有效。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-28T21:58:20.243

连接通常更快（在 MySQL 中），但如果您发现它仍然移动缓慢，您还应该考虑您的索引方案。通常，任何设置为外键的字段（使用 INNODB）都已经设置了索引。如果您使用的是 MYISAM，请确保 ON 语句中的所有列都已编入索引，并考虑将 WHERE 子句中的所有列添加到索引的末尾，以使其成为覆盖索引。这使引擎可以访问索引中所需的所有数据，而无需再次返回原始数据。请记住，这将影响插入/更新/删除的速度，但可以显着提高查询速度。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2015-12-14T10:25:24.850

这对我帮助很大。`Joins`总是比子查询更快地给出结果：

```
SELECT tbl1.id FROM tbl1 t1
LEFT OUTER JOIN tbl2 t2 ON t1.id = t2.id 
WHERE t1.id>=100 AND t2.id IS NULL ; 
```

# c# - 使用进程调用可执行文件间歇性崩溃

> ID：354004
> 
> 赞同：2
> 
> 时间：2008-12-09T19:53:05.567
> 
> 标签：c#, executable

我在 C# 中调用一个可执行文件。当可执行文件运行时，它会写出到控制台，以便 C# 代码获取控制台输出并将其写入文本文件。当崩溃发生时，会发生几件事。

1）文本文件的输出没有完全写出。2）可执行进程似乎完全运行通过，因为它生成报告就像成功运行一样。

我怀疑这次崩溃的原因是因为我是如何写出文件的。

更新：-至于崩溃，出现一个对话框，说“经理遇到问题需要关闭。对于给您带来的不便，我们深表歉意。” 然后它有一个确定按钮。当您单击“确定”时，会出现一个对话框，询问我是否要再次启动管理器。

*   调用可执行文件的管理器应用程序是单线程的。可执行文件可以多线程运行。

以下是通话的一小段：

```
 // Set up process to redirect standard output and standard error to
  // a file.
     process.StartInfo.UseShellExecute = false;
     process.StartInfo.RedirectStandardOutput = true;
     process.StartInfo.RedirectStandardError = true;
     FileInfo ofi = new FileInfo(outputPath);
     FileStream ofs = ofi.OpenWrite();
     StreamWriter sw = new StreamWriter(ofs);
     WriteToTextWriterEventHandler wtsweh = new WriteToTextWriterEventHandler(sw);
     DataReceivedEventHandler handler = wtsweh.HandleDataReceived;
     process.OutputDataReceived += handler;
     process.ErrorDataReceived += handler;
     //

     statusAcceptor.ReportStatus("Running process.");
     process.Start();
     process.BeginOutputReadLine();
     process.BeginErrorReadLine();

     statusAcceptor.ReportStatus("Waiting for process to complete.");
     process.WaitForExit();
     int processExitCode = process.ExitCode;
     process.Close();
     sw.Close();

  // 
  private class WriteToTextWriterEventHandler
  {
      private TextWriter tw;

      public WriteToTextWriterEventHandler(TextWriter tw)
      {
          this.tw = tw;
      }

      public void HandleDataReceived(object sendingProcess,
         DataReceivedEventArgs outLine)
      {
          // Collect the sort command output.
          if (!String.IsNullOrEmpty(outLine.Data))
          {
              tw.Write(Environment.NewLine + outLine.Data);
          }
      }
  } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T20:05:10.193

您遇到的崩溃是什么？.Net 异常？

文件未完全写入可能是因为您没有将流刷新到文件中然后关闭它。

我认为您对标准输出和错误输出消息使用相同的流可能是一个问题。这可能会导致并发问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T22:27:39.937

尝试在 tw.Write 之后添加刷新。这应该会导致生成完整的输出直到出现故障点，其中可能包括来自可执行文件的错误消息（如果那是什么崩溃了？）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T04:11:55.077

如果您将调试器附加到崩溃进程，您将确切知道它崩溃的原因。这是调试崩溃的详细教程：http: [//blogs.msdn.com/kirillosenkov/archive/2008/12/07/how-to-debug-crashes-and-hangs.aspx](http://blogs.msdn.com/kirillosenkov/archive/2008/12/07/how-to-debug-crashes-and-hangs.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T13:26:16.113

它可能在您的处理程序中。您应该放入逻辑来处理流处理程序抛出的异常，并且应该放入一种机制以确保在对进程调用 close 之前正确关闭流处理程序。由于事件处理程序和 process.close 的时间问题，这样的问题很难确定，因此其他海报无法重现它并不让我感到惊讶。但我已经看到它在行动。问题是 EventHandler 一直处于活动状态，直到通过调用 cancelErrorRead 或 cancelOutputRead 将其关闭或进程退出。好吧，如果它仍然忙于从进程的最后刷新一些输出，而主线程使其进入 Process.Close...BOOM

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T22:38:42.770

我已经用许多不同的可执行文件测试了你的代码，但无法让它按照你描述的方式崩溃。也许这是您正在执行的过程的问题？

# asp.net - 真是愚蠢的ATM...为什么我不能引用Master.FindControl？

> ID：354005
> 
> 赞同：0
> 
> 时间：2008-12-09T19:53:27.517
> 
> 标签：asp.net, master-pages

**`oPanel = CType(Master.FindControl("panelSearch"), Panel)`**

**`theMaster.master.vb`**此代码驻留在我的母版页的后端（

它所驻留的功能是共享的，我只是不记得我一生需要做什么才能完成这项工作。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T20:01:52.603

删除`Shared`编写此代码的方法上的修饰符。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T20:00:16.380

您无法从共享函数访问页面的 Master 属性。您必须先使该函数成为实例函数（删除 Shared 关键字），然后才能使用 Master 属性。

# sql - SQL 字符字段连接（不使用 CONCAT() 或 +）

> ID：354006
> 
> 赞同：6
> 
> 时间：2008-12-09T19:54:14.037
> 
> 标签：sql, string, informix, concatenation, concat

我正在尝试将 3 个 [char(32)] 字段：

title1
title2
title3 连接

到一个字段中，但问题是我使用的是旧版本的 SQL，它不支持 CONCAT() 子例程或 + 运算符

* * *

例如：
CONCAT(title1, title2, title3)
(title1 + title2 + title3)

不工作！！！！

还有其他方法吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-09T19:58:20.067

没关系...我想通了...

它的

（标题1 || 标题2 || 标题3）

# sql - 需要在 SQL Server 中加速这个查询

> ID：354008
> 
> 赞同：1
> 
> 时间：2008-12-09T19:54:27.860
> 
> 标签：sql, sql-server, performance, tsql, outer-join

```
SELECT pe.prodtree_element_id prodID, pe.prodtree_element_name_s, li.line_name, av2.value
    FROM prodtree_element pe
    LEFT JOIN prodtree_link pl
        ON pe.prodtree_element_id = pl.to_prodtree_node_id
    LEFT JOIN line li
        ON pe.line_code = li.line_code
    INNER JOIN attribute_values av
        ON av.attribute_definition_id = #statusCode# 
    LEFT JOIN attribute_values av2
        ON pe.prodtree_element_id = av.prodtree_element_id
    WHERE pe.prodtree_element_func_type <> 'WIZARD'
        AND pe.prodtree_element_topo_type = 'NODE' 
```

“#statusCode#”是与属性定义表中的 id 匹配的静态 id（为了参数，假设为 22）。问题是，查询在任何理智的时间内完成都会遇到很大的麻烦。更大的问题是，我有点需要它早点完成，但是它必须收回的记录数量巨大（大约 30-50,000）。我需要来自多个表的数据，这就是它开始变慢的地方。这只是我需要的一部分，我还需要与当前“prodtree_elment_id”匹配的整个其他表的数据。

我正在使用 ColdFusion，但即使直接在 SQL Server 2005 中运行查询也会为该查询创建 15-30 分钟的等待时间（如果它甚至完成）。是否有任何可以想象的方法来加快这个查询最多需要 5 分钟或更短的时间？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-09T20:05:59.380

```
INNER JOIN attribute_values av
    ON av.attribute_definition_id = #statusCode# 
LEFT JOIN attribute_values av2
    ON pe.prodtree_element_id = av.prodtree_element_id 
```

这就是问题。pe 和 av 之间有一个交叉连接，然后是交叉连接上的一个外连接。你很幸运，只需要 30 分钟 :-)

我想你想要这个：

```
SELECT pe.prodtree_element_id prodID, pe.prodtree_element_name_s, li.line_name, av2.value
FROM prodtree_element pe
LEFT JOIN prodtree_link pl
    ON pe.prodtree_element_id = pl.to_prodtree_node_id
LEFT JOIN line li
    ON pe.line_code = li.line_code
--replacement
LEFT JOIN
attribute_values av 
         ON pe.prodtree_element_id = av.prodtree_element_id AND
         av.attribute_definition_id = #statusCode# 
--end replacement
WHERE pe.prodtree_element_func_type <> 'WIZARD'
    AND pe.prodtree_element_topo_type = 'NODE' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T20:01:13.790

在不知道 DDL 的情况下，很难测试。30-50K 行仍然只需要几秒钟。

尝试切换 where 子句的顺序。你可能应该已经实现了这个

```
 INNER JOIN attribute_values av
        ON av.attribute_definition_id = #statusCode# 
```

在 where 子句中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T20:03:57.980

我建议的第一件事是你通过企业管理器中的 sql 优化器实用程序运行它，前提是你已经安装了它。它通常建议索引和类似的东西，这可能会对查询速度产生积极影响。

其他要考虑的事情是拆分查询。乍一看，您似乎正在阅读所有具有与您提供的值匹配的特定属性的产品元素（或类似的东西）。我建议也许：

```
select * from [bigLongjoin to producttree_element]
where prodtree_element_id
in(
select prodtree_element_id from 
  attribute_values where attribute_definition_id = #statusCode#) 
```

在显示查询计划的企业管理器中运行它也可能会显示瓶颈在哪里

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T20:06:29.800

通过良好的优化，您可以在几秒钟内搜索数百万条记录。尽管 StingyJack 在不了解 DDL 的情况下是正确的，但任何查询的优化都是困难的。

优化查询时要做的事情是查看执行计划。嵌套循环等很糟糕。还要确保您也被完全索引。你没有提到有问题的表的索引。如果没有索引，30 - 50k 行可能需要一段时间才能进行这么多的连接。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T20:07:20.330

如果您可以映射以下内容，请确保您的所有 ID 都是索引：

```
pe.prodtree_element_func_type <> 'WIZARD'
        AND pe.prodtree_element_topo_type = 'NODE' 
```

成为类似的东西

```
pe.prodtree_element_func_type_ID <> 1
            AND pe.prodtree_element_topo_type_ID = 2 
```

为了减少需要更多时间来完成的字符串比较

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T20:15:44.757

```
SELECT pe.prodtree_element_id prodID, pe.prodtree_element_name_s, li.line_name, av2.value
    FROM prodtree_element pe
    LEFT JOIN prodtree_link pl
        ON (pe.prodtree_element_id = pl.to_prodtree_node_id)
    LEFT JOIN line li
        ON (pe.line_code = li.line_code)
    LEFT JOIN attribute_values av2
        ON (pe.prodtree_element_id IN (SELECT av.prodtree_element_id FROM attribute_values av WHERE av.attribute_definition_id = #statusCode#))
    WHERE pe.prodtree_element_func_type <> 'WIZARD'
        AND pe.prodtree_element_topo_type = 'NODE' 
```

我认为 gbn 做到了。即使您将 INNER JOIN 限制为 attribute_values 到特定值，它仍然根本没有连接到您的主表或其关系。因此，即使您从查询中获得结果，我的猜测是太多了。

根据您的意图以及您的数据在 attribute_values 表中的方式，他的查询或我的查询可能会更快。

# sql - 如何根据表名在 SQL 中进行联接？

> ID：354010
> 
> 赞同：0
> 
> 时间：2008-12-09T19:54:48.357
> 
> 标签：sql, syntax, join

好的，所以我们有一堆这样命名的表：

```
training_data_001
training_data_002
training_data_003
training_data_004
training_data_005 
```

然后为了找到那些我们查看另一个表中的字段的字段，我们将其命名为 master.training_type。

无论如何，我想知道是否有人知道用这种数据进行基于奇怪表名的连接的方法。像这样的东西：

```
SELECT foo FROM master WHERE id = ? 
INNER JOIN training_data_${master.training_type}
ON foo.id = training_data_${master.training_type}.foo_id 
```

我知道我可以在客户端执行此操作，但最好让数据库执行此操作。

另请注意：它是 SQL Server。

**更新**：我决定只在客户端做。总之谢谢大家。

谢谢！

-fREW

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T19:57:09.180

您只能使用动态 SQL 读取 master.training_type 来构建一个字符串，然后使用`EXEC (@stringvar)`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T20:43:11.503

分区视图是一种可能的方法。由于您只选择 foo 列，您真的只是通过 INNER JOIN 检查训练表中是否存在一行？此外，您似乎正在尝试在联接中使用 foo 作为别名，但在您的 SELECT 子句中没有以这种方式设置。结果，我在这里猜测您真正想要什么。

另一个问题......训练表集是静态的吗？您是否期望能够添加具有新后缀编号的新表并使其正常工作？

另一种可能的解决方案：

```
SELECT
     foo
FROM
     dbo.master m
WHERE
     (training_type = '001' AND EXISTS (SELECT * FROM dbo.training_data_001 WHERE foo_id = m.id)) OR
     (training_type = '002' AND EXISTS (SELECT * FROM dbo.training_data_002 WHERE foo_id = m.id)) OR
     (training_type = '003' AND EXISTS (SELECT * FROM dbo.training_data_003 WHERE foo_id = m.id)) OR
     (training_type = '004' AND EXISTS (SELECT * FROM dbo.training_data_004 WHERE foo_id = m.id)) OR
     (training_type = '005' AND EXISTS (SELECT * FROM dbo.training_data_005 WHERE foo_id = m.id)) 
```

如果你真的想从训练数据表中返回列，那么你可以使用类似的东西：

```
SELECT
     m.id,
     COALESCE(t1.my_col, t2.my_col, t3.my_col, t4.my_col, t5.my_col) AS my_col
FROM
     dbo.master m
LEFT OUTER JOIN dbo.training_data_001 t1 ON m.training_type = '001' AND t1.foo_id = m.id
LEFT OUTER JOIN dbo.training_data_002 t1 ON m.training_type = '002' AND t2.foo_id = m.id
LEFT OUTER JOIN dbo.training_data_003 t1 ON m.training_type = '003' AND t3.foo_id = m.id
LEFT OUTER JOIN dbo.training_data_004 t1 ON m.training_type = '004' AND t4.foo_id = m.id
LEFT OUTER JOIN dbo.training_data_005 t1 ON m.training_type = '005' AND t5.foo_id = m.id 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T19:57:31.143

您只能在存储过程中使用动态 SQL 来执行此操作。如果您出于安全或其他原因不想即时执行此操作，还可以通过代码生成提前生成视图或存储过程。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T20:03:54.033

如果表都是相同的结构，则跨表创建[分区视图并连接视图。](http://msdn.microsoft.com/en-us/library/aa933141(SQL.80).aspx)您需要对列（可能是日期）进行检查约束，以便查询优化器可以进行分区消除。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-09T20:22:34.277

做这样的事情：

```
create view training_data_all as
select '001' as training_type, * from training_data_001
union all
select '002' as training_type, * from training_data_002
union all
select '003' as training_type, * from training_data_003
union all
select '004' as training_type, * from training_data_004
union all
select '005' as training_type, * from training_data_005 
```

然后只需选择并加入到/从它：

```
SELECT foo FROM master WHERE id = ? 
INNER JOIN training_data_all
ON foo.id = training_data_all.foo_id
WHERE training_data_all.training_type = ${master.training_type} 
```

如果表列表随着时间的推移而增长/缩小，您可以通过对系统表进行一些查找来根据存在的表动态编写相同的视图。

但是，这些都不是很有效。您能否以某个固定的时间间隔将此数据 ETL 到一个组合表中？

# javascript - 用 div 用 javascript 绘图

> ID：354014
> 
> 赞同：2
> 
> 时间：2008-12-09T19:57:20.490
> 
> 标签：javascript, drawing, html

在我学习 javascript 的过程中（这似乎是我最近对 ​​SO 提出的问题）我发现了这个用于绘图的 API [http://www.c-point.com/javascript_vector_draw.htm](http://www.c-point.com/javascript_vector_draw.htm)

与此同时，我一直在用图形做一些实验，这些实验往往会影响要绘制的东西的数量。这家伙正在用 div 绘图，图像的每个正方形部分都是一个 div。您可以通过在页面上检查他的示例来轻松检查它。

他去制作 div 1px/1px 来绘制一个像素

现在我要问的是：

这是最好的方法吗？当一幅画更精致时，它似乎很重。你会推荐哪些其他方法？

这个[Javascript 绘图库？](https://stackoverflow.com/questions/96486/javascript-drawing-library)已经有几个指向库的链接，所以不需要在这里放任何链接。

我在这里看到了关于绘图的其他问题。我只是想知道用 div 绘制到哪一点并不可怕！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T20:09:53.553

对于矢量绘图，像[Raphael](http://raphaeljs.com/)这样的库在 SVG 和 VML 上提供了一致的 API。

对于光栅绘图，您可以将 <canvas> 用于支持画布的浏览器。

对于 IE，您将默认使用 DIVS 或让您的绘图 API 使用 silverlight（如果可用）。请注意，为了提高效率，div 不应为 1px x 1px，而应根据您绘制的形状的需要而定。20 个相同颜色的 1 像素 div 应该是 1 个 20 像素宽的 div。通常，您不会与 div 方法进行非常互动，因为您的目标浏览器 (IE) 的 DOM 访问速度很慢

**编辑：**链接库确实做了 div 优化。

对于纯 HTML 解决方案（无 SVG/VML/canvas），您[使用 css 和自定义边框宽度：](http://infimum.dk/HTML/slantinfo.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T22:04:11.420

不，这是最糟糕的方法，在出现 SVG 或画布元素之前就已经详细说明了......这会非常占用内存并且非常慢。一个有趣、有趣的 hack，但在现实世界中并不真正可用。

除了其他线程中提到的库之外，我还看到了使用 sprite 制作的游戏，即画布/SVG/VML。一些图像绝对定位。还有一个很棒的 hack ，使用[5k JavaScript 编码第一人称 3D 射击游戏](http://www.wolf5k.com/ "Wolfenstein 5K - 一个有趣的 5k JavaScript 第一人称 3D 射击游戏")，使用动态生成 XBM 图像。但是对这种图像格式的支持已从最新版本的 Windows 中删除...... :-(

想一想，你也可以使用“data:image/png;base64”协议制作图片，但是编码会很慢，IE浏览器会被淘汰。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T01:12:42.240

在开始弄乱 1px div 之前，请查看 dojox.gfx：[docs](http://docs.dojocampus.org/dojox/gfx)、[tests](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/gfx/tests/)、[demos](http://archive.dojotoolkit.org/nightly/dojotoolkit/dojox/gfx/demos/)（最后两个链接指向测试服务器上为调试而非生产优化的夜间快照）。

它使用原生图形：SVG、VML、Silverlight 或 Canvas — 涵盖所有主要浏览器（IE、Firefox、Safari/Webkit、Opera）的客户端上可用的任何图形。

# oop - 如何在 OO 中建模

> ID：354019
> 
> 赞同：2
> 
> 时间：2008-12-09T19:58:39.690
> 
> 标签：oop

我有一个类似这样的 UI 对话框：您必须从列表中选择一本书。或者，您可以从列表中选择发布者（另一个类），也可以将发布者名称作为字符串输入。

我认为这给了我 3 种类型作为对话框的输出。

1.  书
2.  与出版商一起预订
3.  带有出版商字符串的书

您将如何在对象中对此进行建模？在我看来，拥有一个书籍基类，然后是出版商和出版商名称的两个子类是正确的选择。是否有任何替代方案，也许有利于提供更好模型的组合？

* * *

我会试着解释一下。一本书不需要有出版商。发布者对象与作为字符串输入的发布者名称不同。

您必须
从现有列表中选择一本书

您可以选择以下之一
- 从现有列表中选择出版商或
- 您可以输入出版商名称或
- 您可以不填写有关出版商的任何信息

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T20:01:41.417

第二个是我的方法。

我将有一个 Publisher 类，它有一个名为 Name 的属性，以及描述发布者所需的任何其他属性。

然后，我将有一个带有属性的 book 类来描述它，以及一个 Publisher 类型的属性。

如果用户以字符串形式输入新的发布者，则创建一个新的发布者对象。

如果用户没有输入发布者，则将该属性保留为空。这将满足该书没有出版商的条件。或者，您可以使用名称为“无发布者”的发布者，但我认为这太过分了，无法避免空值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T20:19:11.180

从 OO 的角度来看，在这种情况下，HAS-A 关系比 IS-A 关系更好地解决了这个问题。一本书 HAS-A 出版商 (1:1) 和出版商 HAS-A 它出版的书籍列表 (1:many)。创建一个包含对 Publisher 的引用的 Book 类和一个包含对 Books 的引用列表的 Publisher 类。此外，Publisher HAS-A 字符串可用于定位特定的发布者

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T20:21:45.447

我必须不同意最后一段中的这种说法：

> 在我看来，拥有一个书籍基类，然后是出版商和出版商名称的两个子类是正确的选择。

子类用于表示“is-a-kind-of”关系。（老旧的刻板印象是 Fruit 类，Apple 和 Orange 作为子类。）更现实的例子是具有 Employee 类的工资系统，该类由 HourlyEmployee 和 SalariedEmployee 类专门化。在每种情况下，子类都代表超类中的特定类别。

相反，出版商不是一种书。更好的模型是有一个 Book 类和一个 Publisher 类，它们之间具有多对一的关系（一本书有一个出版商，但一个出版商可能生产多本书）。

一本书有许多潜在的属性，例如标题、ISBN、出版商和作者；出版商的潜在属性包括企业名称和地址（可能是多个地址）以及已出版书籍的列表。

根据您尝试建模的内容，您可能还需要一个 Author 类，但这超出了您原始问题的范围。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T20:12:55.183

我不会创建一个 Publisher 类来继承 Book，因为 Publisher 不是一本书，它是*关于*一本书的元数据信息。圣经虽然会继承书。

我的建议是在 Book 上创建一个 Publisher 属性。此发布者可以是 IPublishInformation 类型，字符串发布者可以使用 NamedPublisher{string Name} 类，实现 IPublishInformation。

反正这是我的想法！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-09T20:50:13.707

> 我会试着解释一下。一本书不需要有出版商。发布者对象与作为字符串输入的发布者名称不同。
> 
> 您必须从现有列表中选择一本书
> 
> 您可以选择以下之一 - 从现有列表中选择出版商或 - 您可以输入出版商名称或 - 您可以不填写有关出版商的任何信息

仍然需要自定义结果对象。现在您拥有三个字段，一个 Book 对象、一个 Publisher 对象和一个 Publisher String。然后，您将它传递给可以智能处理它的代码。您可以添加方法来满足自定义处理需求。但归根结底，它是那个对话的特殊结果，不应该是书籍或出版商或任何其他对象的某个子字段。

如果这本书什么都不是，你知道你犯了一个错误，因为你需要一本书。您还需要处理 Publisher Object 和 Publisher_String 的四种组合。这向我表明你需要一个类来专门处理结果。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T20:15:49.377

我认为仅基于此对话很难做出设计决策。例如，您是从一组现有书籍中挑选的吗？在这种情况下，如果用户输入了一个不存在的发布者怎么办？在这种情况下，您可能根本不想返回任何 Book 类的实例，而是引发某种异常。

您的案例中的所有书籍都有出版商吗？如果是这样，那么我同意@Bob，您可以创建一个 Publisher 类，并让 Book 类包含一个 Publisher 对象的实例。如果只有一些书有 Publisher，那么您可以使用您描述的继承模型，但我会将选项 2 和 3 合并为一个选择（再次使用 Publisher 对象），因为否则您最终可能会得到相同的两个实例book 是不同类型的对象（用户以字符串形式输入出版商，一次从列表中选择）。

——菲尔

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-09T20:35:04.143

如果您假设 Books 可以有多个出版商。然后我将返回一个带有两个属性的 BookSelectonResult。一组为一本书，另一组为选定的出版商。这个答案还假设您有一个书类、一个出版商类和一个集合类。

对话框的重点是返回用户选择的内容。这是一个独特的“东西”，因此值得拥有自己的课程。如果您所做的只是返回一本书或单个出版商，那么直接使用原始类就可以了。但是在这里，您在结果中有多种可能性，因此需要一个独特的结果类。

另一个考虑因素是这个对话有多微不足道？例如选择一个文件名来打开一本书。文件名存在转瞬即逝，您想要的是将书存储在您的系统中。选择书籍和出版商的结果相同。如果您已经有另一个对象来保存结果（例如签出列表），那么我建议不要打扰任何特殊的方法或类。将对话框捆绑到 Command 对象中，并在对话框类的成员中返回结果。然后将结果处理到最终存储的位置。

在我的 CAM 软件中，我经常使用操作配置选项的对话框来执行此操作，而不是使用我精心设计的模型-视图-演示器架构。我可以摆脱这种情况的原因是，当用户单击项目或执行操作时，UI 控制器会执行一个 Command 对象，然后该对象会操纵模型。一切都通过我的设置中的命令对象。因此，对于琐碎的对话框，我只是将它们与使用对话框的命令对象捆绑在一起，而不是创建整个 MVP 层。

最终，这是一个判断电话。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-09T21:00:04.747

试试这个（C#）：

```
Class Book
{
   public string Name;
   public List<Publisher> publishers = new List<Publishers>;

   Book()
   {
      // Load publishers array with relevant instances of Publisher class...
   }
}

Class Books
{
   private List<Book> books = new List<Book>;
   public Books()
   {
      // Load books array with all books...
   }

   public List<Book> GetBook (string publisher)
   {
      List<Book> retVal = new List<Book>;
      foreach (Book item in books)
      {
         if (item.Publisher.Name == publisher)
         {
            retVal.Add(item);
         }
      }
   }

   public List<Book> GetBook (Publisher publisher)
   {
      List<Book> retVal = new List<Book>;
      foreach (Book item in books)
      {
         if (item.Publisher.Name == publisher.Name)
         {
            retVal.Add(item);
         }
      }
   }
}

Class Publisher
{
   public string Name;
} 
```

# mysql - 大型 MySQL 表

> ID：354020
> 
> 赞同：3
> 
> 时间：2008-12-09T19:58:57.477
> 
> 标签：mysql, database-design, large-data-volumes

对于我正在开发的 Web 应用程序，我需要存储大量记录。每条记录将包含一个主键和一个（短）字符串值。我希望有大约 100GB 的可用存储空间，并希望能够全部使用。

记录会被频繁地插入、删除和读取，我必须使用 MySQL 数据库。数据完整性并不重要，但性能才是。我可能会遇到哪些问题和陷阱，以及哪种存储引擎最适合该任务？

非常感谢，J

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-25T21:23:37.183

无论您使用哪种解决方案，因为您说您的数据库将是大量写入，您需要确保整个表不会在写入时锁定。这排除了一些人建议的 MyISAM。MyISAM 将在更新、删除或插入时锁定表。这意味着任何想要从表中读取的客户端都必须等待写入完成。不知道 INSERT LOW PRIORITY 做了什么，可能是一些围绕表锁定的 hack :-)

如果您只是必须使用 MySQL，您将需要 InnoDB，它不会锁定写入。我不知道 MySQL 是如何处理 VACUUM 的 InnoDB 表的（InnoDB 是像 PostgreSQL 一样的 MVCC，因此需要清理）......但是如果您进行大量更新或删除，则必须考虑到这一点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-10T16:07:21.873

这完全取决于您的应用程序正在生成的读/写模式，以及您想要获得的准确度级别。例如，如果您并不真正关心让所有最后插入的行立即可用，请考虑使用 INSERT LOW PRIORITY 可以帮助 SELECT。如果文本大小相对较小，您可以使用固定的 CHAR 类型，这将有助于索引很多并减少 SELECT 的时间如果您的应用程序生成大量更新，您会更喜欢 InnoDB 存储引擎，它允许在更新（与 myISAM 上的所有表相比）。另一方面，它更占用 CPU，所以如果您不使用事务并且您的更新模式相对较小，请考虑使用 myISAM

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T20:05:46.353

如果您正在使用索引（即使您没有使用），您也可能会遇到缩放问题。您可以尝试分区以尝试减少这些影响。

在我自己的项目中，完整性并不重要，但性能也很重要。我们所做的是放宽所有事务要求、放宽磁盘同步要求和提交批量插入，我们确实提高了写入速度。

此外，请确保您自己进行测试以调整内存大小。我相信 MySQL 有几种不同类型的缓存，您可以配置它们的大小。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T20:16:41.887

你肯定想使用 MyISAM 作为存储引擎。但是你说你期望 100 GB，它只包含一个短字符串值。您肯定希望使用 64 位 int 作为您的身份/主键。

但我真正的问题是。您是否使用它来存储来自网站的会话信息？如果是这样，您想使用 memcache 而不是 MySQL。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T20:20:39.133

大型 MySQL 查询使我的四核/8GB Ram DB 服务器崩溃...

解决方案是使用 PostgresSQL（如果你负担得起的话，SQL Server）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-21T13:47:51.850

如果“短字符串”位于固定长度的列中，那么您的情况会好得多，这样表就有固定长度的行。那时，带有 MyISAM 的 MySQL 将为您非常有效地运行。为 Key Buffer 分配尽可能多的内存，以便内存中的大部分索引。您的目标应该是对磁盘进行一次随机访问以检索一行——在给定 100GB 数据和 8GB 内存的情况下，您不能做得比这更好。您不应该期望每秒实现超过几百个这样的查询，因为这是磁盘可以执行的所有随机访问。

您可能对我的 MySQL 自定义存储引擎（[在此处](http://blog.coldlogic.com/categories/coldstore/)描述）感兴趣。它管理内存的方式与 MyISAM 不同，尽管您的应用程序的配置文件并不完全是我的引擎优化的目标。

# sql-server - 如何在 SQL Server 2005 中授予对 sysprocesses 的有限访问权限？

> ID：354021
> 
> 赞同：0
> 
> 时间：2008-12-09T19:59:11.717
> 
> 标签：sql-server, security, tsql, stored-procedures, database-permissions

我正在实施一些基本的 SQL Server 监控来监视过度阻塞。

我有一个如下所示的存储过程：

```
CREATE PROCEDURE [dbo].[bsp_GetBlockedProcessCount]
AS
BEGIN
    SET NOCOUNT ON;

    DECLARE @count INT

    SELECT @count = COUNT(*)
    FROM master.dbo.sysprocesses WITH (NOLOCK)
    WHERE blocked > 0

    RETURN @count
END 
```

当我在管理员上下文中执行此操作时，我得到了正确的答案。当我在具有有限权限的用户（即网络服务器）的上下文中执行此操作时，无论真实答案如何，我都会得到零。

我可以想到一些解决方案，但我对其中任何一个都不满意：

1.  我可以向用户授予 VIEW SERVER STATE 权限，但这比该用户应该拥有的权限多得多：

    ```
    GRANT VIEW SERVER STATE TO [Webserver] 
    ```

2.  从 SQL 作业运行 proc 并将结果放在某处以供网络服务器获取，但这很混乱且复杂。

3.  不要尝试从网络服务器调用它！

我确信有更好的解决方案。有什么建议么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-09T20:21:50.190

我很高兴我不知道第一手的答案:) 但我玩过 EXECUTE AS 和 REVERT 在用户之间切换

但这里有 2 个很好的链接可以开始

使用 REVERT 子句在 SQL Server 中切换存储过程执行上下文

摘要：您将用户授予 IMPERSONATE 作为 DBA，然后在之后恢复

[http://www.mssqltips.com/tip.asp?tip=1579](http://www.mssqltips.com/tip.asp?tip=1579)

通过存储过程授予权限

摘要：我懒得看全文

[http://www.sommarskog.se/grantperm.html](http://www.sommarskog.se/grantperm.html)

# sql-server - Sql Server 死锁对象 ID 太大

> ID：354035
> 
> 赞同：10
> 
> 时间：2008-12-09T20:02:48.980
> 
> 标签：sql-server, deadlock

我正在尝试跟踪我们的 SQL 2005 数据库（64 位）中发生的死锁。我们目前没有启用快照隔离。

我打开了 tf-1204 并收到了下面的输出。

从这个输出中，我能够确定节点 1 是一个存储过程，它选择数据并且只修改 #temp 表中的值。

节点 2 是另一个存储过程，它对单行数据执行基于简单主键的更新。

我无法确定的是这里争用的实际资源。10:72057594060734464 和 10:72057594038910976 的 Keys 允许我确定数据库，但是无法使用 object_name 解析这些对象 ID。事实上，它们应该是 int 值，所以我不确定这些大数字是从哪里来的。

在研究这个问题时，我也能够从对象 ID 的活动监视器中获得类似的值。

如何解析这些对象标识符？

这是死锁 tf-1204 输出：

```
2008-12-05 07:48:28.19 spid4s ----------------------------------
2008-12-05 07:48:28.19 spid4s 开始死锁搜索 634
2008-12-05 07:48:28.19 spid4s 目标资源所有者：
2008-12-05 07:48:28.19 spid4s ResType:LockOwner Stype:'OR'Xdes:0x00000000813B8700 模式:X SPID:77 BatchID:0 ECID:0 TaskProxy:(0x00000000CE6D8598) 值:0x1043f980
2008-12-05 07:48:28.19 spid4s 0：插入新节点：节点：1 ResType：LockOwner Stype：'OR'Xdes：0x00000000813B8700 模式：X SPID：77 BatchID：0 ECID：0 TaskProxy：（0x00000000CE6D8598）值： 0x1043f980
2008-12-05 07:48:28.19 spid4s 1:SearchOR 考虑新的拦截器 - 任务：0000000000EC5198，工人 00000000C89881C0
2008-12-05 07:48:28.19 spid4s 2：插入新节点：节点：2 ResType：LockOwner Stype：'OR'Xdes：0x00000000808F1A80 模式：S SPID：79 BatchID：0 ECID：0 TaskProxy：（0x0000000129E82598）值： 0x1063d000
2008-12-05 07:48:28.19 spid4s 3:SearchOR 考虑新的拦截器 - 任务：0000000000C3FC18，工人 00000000F847C1C0
2008-12-05 07:48:28.19 spid4s 4:InsertKnown Cycle found between old res owner: [ ResType:LockOwner Stype:'OR'Xdes:0x00000000813B8700 模式:X SPID:77 BatchID:0 ECID:0 TaskProxy:(0x00000000CE6D8598)值：0x1043f980] 和新资源所有者 [ResType:LockOwner Stype:'OR'Xdes:0x00000000813B8700 模式：X SPID:77 BatchID:0 ECID:0 TaskProxy:(0x00000000CE6D8598) 值:0x1043f980]
2008-12-05 07:48:28.19 spid4s 4:InsertKnown 搜索结果：发现死锁（阻塞所有者在堆栈上）
2008-12-05 07:48:28.19 spid4s 3:SearchOR 搜索结果：发现死锁（循环在此级别或之前）
2008-12-05 07:48:28.19 spid4s 1:SearchOR 搜索结果：发现死锁（循环在此级别或之前）
2008-12-05 07:48:28.19 spid4s      
2008-12-05 07:48:28.19 spid4s 遇到死锁循环 .... 验证循环
2008-12-05 07:48:28.19 spid4s 0：插入新节点：节点：1 ResType：LockOwner Stype：'OR'Xdes：0x00000000813B8700 模式：X SPID：77 BatchID：0 ECID：0 TaskProxy：（0x00000000CE6D8598）值： 0x1043f980 成本：(0/1544)
2008-12-05 07:48:28.19 spid4s 1:SearchOR 考虑新的拦截器 - 任务：0000000000EC5198，工人 00000000C89881C0
2008-12-05 07:48:28.19 spid4s 2：插入新节点：节点：2 ResType：LockOwner Stype：'OR'Xdes：0x00000000808F1A80 模式：S SPID：79 BatchID：0 ECID：0 TaskProxy：（0x0000000129E82598）值： 0x1063d000 成本：(0/0)
2008-12-05 07:48:28.19 spid4s 3:SearchOR 考虑新的拦截器 - 任务：0000000000C3FC18，工人 00000000F847C1C0
2008-12-05 07:48:28.19 spid4s 4:InsertKnown Cycle found between old res owner: [ ResType:LockOwner Stype:'OR'Xdes:0x00000000813B8700 模式:X SPID:77 BatchID:0 ECID:0 TaskProxy:(0x00000000CE6D8598)值：0x1043f980 成本：（0/1544）] 和新资源所有者 [ ResType：LockOwner Stype：'OR'Xdes：0x00000000813B8700 模式：X SPID：77 BatchID：0 ECID：0 TaskProxy：（0x00000000CE6D8598）值：0x1043f980 成本：（ 0/1544)]
2008-12-05 07:48:28.19 spid4s 4:InsertKnown 搜索结果：发现死锁（阻塞所有者在堆栈上）
2008-12-05 07:48:28.19 spid4s 3:SearchOR 搜索结果：发现死锁（循环在此级别或之前）
2008-12-05 07:48:28.19 spid4s 1:SearchOR 搜索结果：发现死锁（循环在此级别或之前）
2008-12-05 07:48:28.19 spid4s 遇到死锁 .... 打印死锁信息
2008-12-05 07:48:28.19 spid4s 等待图
2008-12-05 07:48:28.19 spid4s      
2008-12-05 07:48:28.19 spid4s 节点：1

2008-12-05 07:48:28.19 spid4s 密钥：10:72057594060734464（c80089667602）CleanCnt：3 模式：S 标志：0x0
2008-12-05 07:48:28.19 spid4s 授予列表 1：
2008-12-05 07:48:28.19 spid4s 所有者：0x000000011063CDC0 模式：S Flg：0x0 参考：1 寿命：00000000 SPID：79 ECID：0 XactLockInfo：0x00000000808F1AB8
2008-12-05 07:48:28.19 spid4s SPID: 79 ECID: 0 语句类型: INSERT Line #: 220
2008-12-05 07:48:28.19 spid4s 输入缓冲区：RPC 事件：过程 [数据库 ID = 10 对象 ID = 1751794144]
2008-12-05 07:48:28.19 spid4s 请求者：
2008-12-05 07:48:28.19 spid4s ResType:LockOwner Stype:'OR'Xdes:0x00000000813B8700 模式:X SPID:77 BatchID:0 ECID:0 TaskProxy:(0x00000000CE6D8598) 值:0x1043f980 成本:(0/1544)
2008-12-05 07:48:28.19 spid4s      
2008-12-05 07:48:28.19 spid4s 节点：2

2008-12-05 07:48:28.19 spid4s 密钥：10:72057594038910976 (0c0092f62b82) CleanCnt:2 模式：X 标志：0x0
2008-12-05 07:48:28.19 spid4s 授予列表 0：
2008-12-05 07:48:28.19 spid4s 所有者：0x000000011043F300 模式：X Flg：0x0 参考：0 寿命：02000000 SPID：77 ECID：0 XactLockInfo：0x00000000813B8738
2008-12-05 07:48:28.19 spid4s SPID：77 ECID：0 语句类型：更新行号：23
2008-12-05 07:48:28.19 spid4s 输入缓冲区：RPC 事件：过程 [数据库 ID = 10 对象 ID = 1791462302]
2008-12-05 07:48:28.19 spid4s 请求者：
2008-12-05 07:48:28.19 spid4s ResType:LockOwner Stype:'OR'Xdes:0x00000000808F1A80 模式:S SPID:79 BatchID:0 ECID:0 TaskProxy:(0x0000000129E82598) 值:0x1063d000 成本:(0/0)
2008-12-05 07:48:28.19 spid4s      
2008-12-05 07:48:28.19 spid4s 受害者资源所有者：
2008-12-05 07:48:28.19 spid4s ResType:LockOwner Stype:'OR'Xdes:0x00000000808F1A80 模式:S SPID:79 BatchID:0 ECID:0 TaskProxy:(0x0000000129E82598) 值:0x1063d000 成本:(0/0)
2008-12-05 07:48:28.19 spid4s 结束死锁搜索 634 ... 发现死锁。
2008-12-05 07:48:28.19 spid4s ----------------------------------

```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-09T22:28:03.913

这些 ID 实际上指的是 sys.partitions 中的 hobts（堆或二叉树）。在数据库 10 中尝试以下查询，您会发现哪个对象和哪个索引受到影响。

```
SELECT hobt_id, object_name(p.[object_id]), index_id 
FROM sys.partitions p 
WHERE hobt_id = 72057594060734464 
```

# windows - 如何以编程方式找出哪台计算机是 Windows 中的域控制器？

> ID：354037
> 
> 赞同：105
> 
> 时间：2008-12-09T20:03:26.360
> 
> 标签：windows, networking

我正在寻找一种方法来确定域控制器的名称/IP 地址对于客户端计算机连接到的给定域是什么。

在我们公司，我们有很多用于测试的小型网络，其中大多数都有自己的小域。例如，域之一被命名为“TESTLAB”。我有一个 Windows XP 工作站，它是 TESTLAB 域的成员，我正在尝试找出域控制器的名称，以便我可以去查看为域定义了哪些用户。在我们的实验室中，混合了 Windows Server 2000 和 Windows Server 2003（实际上可能是几个 NT 4 服务器），因此很高兴找到一个对两者都适用的解决方案。

在网上看了一下，貌似有各种实用程序，比如 Windows Power Shell 或 nltest，但这些都需要您下载并安装其他实用程序。我希望找到一种无需安装任何其他东西即可找到域控制器的方法。

**编辑**如果我想编写一个程序来查找域控制器或当前域中的用户，我将如何去做？

* * *

## 回答 #1

> 赞同：255
> 
> 时间：2008-12-09T20:55:51.963

用最简单的编程语言：DOS批处理

```
echo %LOGONSERVER% 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2015-10-01T10:16:17.860

在 Windows 上的 cmd 中，键入以下命令：

```
nltest /dclist:{domainname} 
```

它列出了特定域中的所有域控制器

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-12-09T20:30:33.060

在 C#/.NET 3.5 中，您可以编写一个小程序来执行以下操作：

```
using (PrincipalContext context = new PrincipalContext(ContextType.Domain))
{
    string controller = context.ConnectedServer;
    Console.WriteLine( "Domain Controller:" + controller );
} 
```

这将列出当前域中的所有用户：

```
using (PrincipalContext context = new PrincipalContext(ContextType.Domain))
{
    using (UserPrincipal searchPrincipal = new UserPrincipal(context))
    {
       using (PrincipalSearcher searcher = new PrincipalSearcher(searchPrincipal))
       {
           foreach (UserPrincipal principal in searcher.FindAll())
           {
               Console.WriteLine( principal.SamAccountName);
           }
       }
    }
} 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2015-02-23T21:55:11.440

从命令行查询 loginserver 环境变量。

C:> 设置 L

登录服务器='\'\DCNAME

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2013-01-04T02:46:13.310

`gpresult`在 Windows 命令提示符下运行。您将获得有关当前域、当前用户、用户和计算机安全组、组策略名称、Active Directory 专有名称等的大量信息。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2018-03-06T09:30:58.837

在 Powershell 中：`$env:logonserver`

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-11-13T13:30:39.440

`DomainController`要在您的机器不属于的域中检索信息，您需要更多的东西。

```
 DirectoryContext domainContext =  new DirectoryContext(DirectoryContextType.Domain, "targetDomainName", "validUserInDomain", "validUserPassword");

  var domain = System.DirectoryServices.ActiveDirectory.Domain.GetDomain(domainContext);
  var controller = domain.FindDomainController(); 
```

# python - 如何检查字符串是否为数字（浮点数）？

> ID：354038
> 
> 赞同：1833
> 
> 时间：2008-12-09T20:03:42.113
> 
> 标签：python, casting, floating-point, type-conversion

检查字符串是否可以在 Python 中表示为数字的最佳方法是什么？

我目前拥有的功能是：

```
def is_number(s):
    try:
        float(s)
        return True
    except ValueError:
        return False 
```

这不仅丑陋和缓慢，而且看起来很笨重。但是，我还没有找到更好的方法，因为`float()`在 main 函数中调用更糟糕。

* * *

## 回答 #1

> 赞同：1708
> 
> 时间：2008-12-09T20:15:18.377

如果您正在寻找解析（正，无符号）整数而不是浮点数，您可以使用该[`isdigit()`](https://docs.python.org/2/library/stdtypes.html#str.isdigit "str.isdigit")函数来处理字符串对象。

```
>>> a = "03523"
>>> a.isdigit()
True
>>> b = "963spam"
>>> b.isdigit()
False 
```

字符串方法 -`isdigit()`​​ : [Python2](https://docs.python.org/2/library/stdtypes.html#string-methods "字符串方法") , [Python3](https://docs.python.org/3/library/stdtypes.html#string-methods)

还有一些关于 Unicode 字符串的东西，我对 Unicode 不太熟悉 [- 是十进制/十进制](https://docs.python.org/2/library/stdtypes.html#unicode.isnumeric "unicode.isnumeric")

* * *

## 回答 #2

> 赞同：764
> 
> 时间：2008-12-09T20:30:48.800

> 这不仅丑陋而且缓慢

我对两者都有争议。

正则表达式或其他字符串解析方法会更丑陋且更慢。

我不确定有什么比上述更快。它调用函数并返回。Try/Catch 不会引入太多开销，因为最常见的异常是在没有大量搜索堆栈帧的情况下捕获的。

问题是任何数值转换函数都有两种结果

*   一个数字，如果该数字有效
*   一个状态码（例如，通过 errno）或异常表明没有有效的数字可以被解析。

C（例如）以多种方式解决了这个问题。Python 清楚而明确地列出了它。

我认为你这样做的代码是完美的。

* * *

## 回答 #3

> 赞同：256
> 
> 时间：2014-05-13T19:28:03.887

**TL;DR**最好的解决方案是`s.replace('.','',1).isdigit()`

我做了一些[基准](http://nbviewer.ipython.org/github/rasbt/One-Python-benchmark-per-day/blob/master/ipython_nbs/day6_string_is_number.ipynb?create=1)比较不同的方法

```
def is_number_tryexcept(s):
    """ Returns True is string is a number. """
    try:
        float(s)
        return True
    except ValueError:
        return False

import re    
def is_number_regex(s):
    """ Returns True is string is a number. """
    if re.match("^\d+?\.\d+?$", s) is None:
        return s.isdigit()
    return True

def is_number_repl_isdigit(s):
    """ Returns True is string is a number. """
    return s.replace('.','',1).isdigit() 
```

如果字符串不是数字，则 except-block 非常慢。但更重要的是，try-except 方法是唯一能正确处理科学记数法的方法。

```
funcs = [
          is_number_tryexcept, 
          is_number_regex,
          is_number_repl_isdigit
          ]

a_float = '.1234'

print('Float notation ".1234" is not supported by:')
for f in funcs:
    if not f(a_float):
        print('\t -', f.__name__) 
```

浮点表示法“.1234”不受以下支持：
- is_number_regex

```
scientific1 = '1.000000e+50'
scientific2 = '1e50'

print('Scientific notation "1.000000e+50" is not supported by:')
for f in funcs:
    if not f(scientific1):
        print('\t -', f.__name__)

print('Scientific notation "1e50" is not supported by:')
for f in funcs:
    if not f(scientific2):
        print('\t -', f.__name__) 
```

科学记数法“1.000000e+50”不支持：
- is_number_regex
- is_number_repl_isdigit
科学记数法“1e50”不支持：
- is_number_regex
- is_number_repl_isdigit

## 编辑：基准测试结果

```
import timeit

test_cases = ['1.12345', '1.12.345', 'abc12345', '12345']
times_n = {f.__name__:[] for f in funcs}

for t in test_cases:
    for f in funcs:
        f = f.__name__
        times_n[f].append(min(timeit.Timer('%s(t)' %f, 
                      'from __main__ import %s, t' %f)
                              .repeat(repeat=3, number=1000000))) 
```

测试了以下功能

```
from re import match as re_match
from re import compile as re_compile

def is_number_tryexcept(s):
    """ Returns True is string is a number. """
    try:
        float(s)
        return True
    except ValueError:
        return False

def is_number_regex(s):
    """ Returns True is string is a number. """
    if re_match("^\d+?\.\d+?$", s) is None:
        return s.isdigit()
    return True

comp = re_compile("^\d+?\.\d+?$")    

def compiled_regex(s):
    """ Returns True is string is a number. """
    if comp.match(s) is None:
        return s.isdigit()
    return True

def is_number_repl_isdigit(s):
    """ Returns True is string is a number. """
    return s.replace('.','',1).isdigit() 
```

[![在此处输入图像描述](https://i.stack.imgur.com/DFoK6.png)](https://i.stack.imgur.com/DFoK6.png)

* * *

## 回答 #4

> 赞同：78
> 
> 时间：2010-09-01T14:06:08.107

您可能需要考虑一个例外：字符串 'NaN'

如果您希望 is_number 为“NaN”返回 FALSE，则此代码将不起作用，因为 Python 会将其转换为非数字的数字表示（讨论身份问题）：

```
>>> float('NaN')
nan 
```

否则，我实际上应该感谢您提供我现在广泛使用的代码。:)

G。

* * *

## 回答 #5

> 赞同：65
> 
> 时间：2012-05-25T22:22:32.990

这个怎么样：

```
'3.14'.replace('.','',1).isdigit() 
```

仅当有一个或没有“。”时才会返回 true。在数字串中。

```
'3.14.5'.replace('.','',1).isdigit() 
```

将返回 false

编辑：刚刚看到另一条评论......可以`.replace(badstuff,'',maxnum_badstuff)`为其他情况添加一个。如果您传递的是盐而不是任意调味品（参考：[xkcd#974](http://xkcd.com/974/)），这会很好：P

* * *

## 回答 #6

> 赞同：47
> 
> 时间：2010-07-26T13:10:15.373

在 Alfe 指出您不需要单独检查浮点数后更新，因为复杂的句柄：

```
def is_number(s):
    try:
        complex(s) # for int, long, float and complex
    except ValueError:
        return False

    return True 
```

* * *

之前说过：在一些罕见的情况下你可能还需要检查复数（例如 1+2i），它不能用浮点数表示：

```
def is_number(s):
    try:
        float(s) # for int, long and float
    except ValueError:
        try:
            complex(s) # for complex
        except ValueError:
            return False

    return True 
```

* * *

## 回答 #7

> 赞同：43
> 
> 时间：2008-12-11T04:56:26.047

> 这不仅丑陋而且缓慢，而且看起来很笨重。

可能需要一些时间来适应，但这是 Python 的做法。正如已经指出的那样，替代方案更糟。但是以这种方式做事还有另一个优点：多态性。

鸭子打字背后的核心思想是“如果它像鸭子一样走路和说话，那么它就是鸭子”。如果您决定需要对字符串进行子类化，以便更改确定某些内容是否可以转换为浮点数的方式，该怎么办？或者，如果您决定完全测试其他对象怎么办？你可以做这些事情而不必改变上面的代码。

其他语言通过使用接口来解决这些问题。我将保存对另一个线程更好的解决方案的分析。不过，关键是 python 绝对是等式的鸭子类型，如果你打算在 Python 中进行大量编程，你可能不得不习惯这样的语法（但这并不意味着你当然必须喜欢它）。

您可能需要考虑的另一件事：与许多其他语言相比，Python 在抛出和捕获异常方面非常快（例如，比 .Net 快 30 倍）。哎呀，语言本身甚至会抛出异常来传达非异常的正常程序条件（每次使用 for 循环时）。因此，在您注意到一个重大问题之前，我不会太担心这段代码的性能方面。

* * *

## 回答 #8

> 赞同：31
> 
> 时间：2015-09-08T08:42:14.193

为了`int`使用这个：

```
>>> "1221323".isdigit()
True 
```

但是因为`float`我们需要一些技巧;-)。每个浮点数都有一个点...

```
>>> "12.34".isdigit()
False
>>> "12.34".replace('.','',1).isdigit()
True
>>> "12.3.4".replace('.','',1).isdigit()
False 
```

同样对于负数只需添加`lstrip()`：

```
>>> '-12'.lstrip('-')
'12' 
```

现在我们得到了一个通用的方法：

```
>>> '-12.34'.lstrip('-').replace('.','',1).isdigit()
True
>>> '.-234'.lstrip('-').replace('.','',1).isdigit()
False 
```

* * *

## 回答 #9

> 赞同：23
> 
> 时间：2018-02-11T08:34:28.830

该答案提供了具有示例功能的分步指南，以查找字符串是：

*   *正整数*
*   *正/负 - 整数/浮点数*
*   *检查数字时如何丢弃“NaN”（不是数字）字符串？*

## 检查字符串是否为*正*整数

您可以使用[**`str.isdigit()`**](https://docs.python.org/2/library/stdtypes.html#str.isdigit)来检查给定的字符串是否为*正*整数。

样本结果：

```
# For digit
>>> '1'.isdigit()
True
>>> '1'.isalpha()
False 
```

## 检查字符串为正/负 - 整数/浮点

`str.isdigit()``False`如果字符串是*负数*或浮点数，则返回。例如：

```
# returns `False` for float
>>> '123.3'.isdigit()
False
# returns `False` for negative number
>>> '-123'.isdigit()
False 
```

如果您还想**检查*负*整数 和[`float`](https://docs.python.org/3/library/functions.html#float)**，那么您可以编写一个自定义函数来检查它：

```
def is_number(n):
    try:
        float(n)   # Type-casting the string to `float`.
                   # If string is not a valid `float`, 
                   # it'll raise `ValueError` exception
    except ValueError:
        return False
    return True 
```

样品运行：

```
>>> is_number('123')    # positive integer number
True

>>> is_number('123.4')  # positive float number
True

>>> is_number('-123')   # negative integer number
True

>>> is_number('-123.4') # negative `float` number
True

>>> is_number('abc')    # `False` for "some random" string
False 
```

## 在检查数字时丢弃“NaN”（不是数字）字符串

上述函数将返回`True`“NAN”（非数字）字符串，因为对于 Python，它是表示它不是数字的有效浮点数。例如：

```
>>> is_number('NaN')
True 
```

为了检查数字是否为“NaN”，您可以使用[**`math.isnan()`**](https://docs.python.org/2/library/math.html#math.isnan)：

```
>>> import math
>>> nan_num = float('nan')

>>> math.isnan(nan_num)
True 
```

或者，如果您不想导入其他库来检查它，那么您可以简单地通过使用`==`. `False`当`nan`float 与自身进行比较时， Python 返回。例如：

```
# `nan_num` variable is taken from above example
>>> nan_num == nan_num
False 
```

因此，上面的**函数`is_number`可以更新为返回`False`为`"NaN"`**：

```
def is_number(n):
    is_number = True
    try:
        num = float(n)
        # check for "nan" floats
        is_number = num == num   # or use `math.isnan(num)`
    except ValueError:
        is_number = False
    return is_number 
```

样品运行：

```
>>> is_number('Nan')   # not a number "Nan" string
False

>>> is_number('nan')   # not a number string "nan" with all lower cased
False

>>> is_number('123')   # positive integer
True

>>> is_number('-123')  # negative integer
True

>>> is_number('-1.12') # negative `float`
True

>>> is_number('abc')   # "some random" string
False 
```

***PS：每次检查的每个操作都取决于号码的类型，都会带来额外的开销。选择`is_number`适合您要求的功能版本。***

* * *

## 回答 #10

> 赞同：17
> 
> 时间：2014-08-14T03:34:08.403

对于非数字字符串，`try: except:`实际上比正则表达式慢。对于有效数字的字符串，正则表达式速度较慢。因此，适当的方法取决于您的输入。

[如果您发现自己处于性能绑定状态，您可以使用一个名为fastnumbers](https://pypi.org/project/fastnumbers)的新第三方模块，该模块提供一个名为[isfloat](http://fastnumbers.readthedocs.io/en/master/api.html#fastnumbers.isfloat)的函数。完全公开，我是作者。我已将其结果包含在下面的时间安排中。

* * *

```
from __future__ import print_function
import timeit

prep_base = '''\
x = 'invalid'
y = '5402'
z = '4.754e3'
'''

prep_try_method = '''\
def is_number_try(val):
    try:
        float(val)
        return True
    except ValueError:
        return False

'''

prep_re_method = '''\
import re
float_match = re.compile(r'[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?$').match
def is_number_re(val):
    return bool(float_match(val))

'''

fn_method = '''\
from fastnumbers import isfloat

'''

print('Try with non-number strings', timeit.timeit('is_number_try(x)',
    prep_base + prep_try_method), 'seconds')
print('Try with integer strings', timeit.timeit('is_number_try(y)',
    prep_base + prep_try_method), 'seconds')
print('Try with float strings', timeit.timeit('is_number_try(z)',
    prep_base + prep_try_method), 'seconds')
print()
print('Regex with non-number strings', timeit.timeit('is_number_re(x)',
    prep_base + prep_re_method), 'seconds')
print('Regex with integer strings', timeit.timeit('is_number_re(y)',
    prep_base + prep_re_method), 'seconds')
print('Regex with float strings', timeit.timeit('is_number_re(z)',
    prep_base + prep_re_method), 'seconds')
print()
print('fastnumbers with non-number strings', timeit.timeit('isfloat(x)',
    prep_base + 'from fastnumbers import isfloat'), 'seconds')
print('fastnumbers with integer strings', timeit.timeit('isfloat(y)',
    prep_base + 'from fastnumbers import isfloat'), 'seconds')
print('fastnumbers with float strings', timeit.timeit('isfloat(z)',
    prep_base + 'from fastnumbers import isfloat'), 'seconds')
print() 
```

* * *

```
Try with non-number strings 2.39108395576 seconds
Try with integer strings 0.375686168671 seconds
Try with float strings 0.369210958481 seconds

Regex with non-number strings 0.748660802841 seconds
Regex with integer strings 1.02021503448 seconds
Regex with float strings 1.08564686775 seconds

fastnumbers with non-number strings 0.174362897873 seconds
fastnumbers with integer strings 0.179651021957 seconds
fastnumbers with float strings 0.20222902298 seconds 
```

如你看到的

*   `try: except:`对于数字输入来说速度很快，但对于无效输入来说非常慢
*   当输入无效时，正则表达式非常有效
*   `fastnumbers`在这两种情况下都获胜

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2012-02-18T01:35:32.540

## 只是模仿 C#

**在 C# 中有两个不同的函数可以处理标量值的解析：**

*   Float.Parse()
*   Float.TryParse()

**浮动.解析（）：**

```
def parse(string):
    try:
        return float(string)
    except Exception:
        throw TypeError 
```

*注意：如果您想知道为什么我将异常更改为 TypeError，[请参阅文档](http://docs.python.org/library/exceptions.html)。*

**float.try_parse():**

```
def try_parse(string, fail=None):
    try:
        return float(string)
    except Exception:
        return fail; 
```

*注意：您不想返回布尔值“False”，因为它仍然是一种值类型。没有更好，因为它表示失败。当然，如果您想要不同的东西，您可以将失败参数更改为您想要的任何内容。*

要扩展 float 以包含“parse()”和“try_parse()”，您需要对“float”类进行猴子补丁以添加这些方法。

如果你想尊重预先存在的功能，代码应该是这样的：

```
def monkey_patch():
    if(!hasattr(float, 'parse')):
        float.parse = parse
    if(!hasattr(float, 'try_parse')):
        float.try_parse = try_parse 
```

*旁注：我个人更喜欢称它为 Monkey Punching，因为当我这样做时感觉就像我在滥用语言，但 YMMV。*

**用法：**

```
float.parse('giggity') // throws TypeException
float.parse('54.3') // returns the scalar value 54.3
float.tryParse('twank') // returns None
float.tryParse('32.2') // returns the scalar value 32.2 
```

*伟大的圣人 Pythonas 对教廷 Sharpisus 说：“你能做的任何事我都能做得更好；我能做的任何事都比你更好。”*

* * *

## 回答 #12

> 赞同：14
> 
> 时间：2016-01-05T15:21:27.610

我知道这是特别古老的，但我会添加一个答案，我相信它涵盖了最高投票答案中缺少的信息，这对任何发现此问题的人来说都非常有价值：

对于以下每种方法，如果您需要接受任何输入，请将它们与计数连接起来。（假设我们使用整数的声音定义而不是 0-255 等）

`x.isdigit()` 适用于检查 x 是否为整数。

`x.replace('-','').isdigit()` 适用于检查 x 是否为负数。（检查 - 在第一个位置）

`x.replace('.','').isdigit()` 适用于检查 x 是否为小数。

`x.replace(':','').isdigit()` 适用于检查 x 是否为比率。

`x.replace('/','',1).isdigit()` 适用于检查 x 是否为分数。

* * *

## 回答 #13

> 赞同：12
> 
> 时间：2008-12-09T20:31:49.967

转换为 float 并捕获 ValueError 可能是最快的方法，因为 float() 就是专门为此而设计的。任何其他需要字符串解析（正则表达式等）的东西都可能会更慢，因为它没有针对此操作进行调整。我的 0.02 美元。

* * *

## 回答 #14

> 赞同：11
> 
> 时间：2013-03-04T16:12:38.673

您可以使用 Unicode 字符串，它们有一种方法可以满足您的需求：

```
>>> s = u"345"
>>> s.isnumeric()
True 
```

或者：

```
>>> s = "345"
>>> u = unicode(s)
>>> u.isnumeric()
True 
```

[http://www.tutorialspoint.com/python/string_isnumeric.htm](http://www.tutorialspoint.com/python/string_isnumeric.htm)

[http://docs.python.org/2/howto/unicode.html](http://docs.python.org/2/howto/unicode.html)

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2012-03-23T16:10:09.420

因此，综上所述，检查 Nan、无穷大和复数（似乎它们是用 j 指定的，而不是 i，即 1+2j），结果是：

```
def is_number(s):
    try:
        n=str(float(s))
        if n == "nan" or n=="inf" or n=="-inf" : return False
    except ValueError:
        try:
            complex(s) # for complex
        except ValueError:
            return False
    return True 
```

* * *

## 回答 #16

> 赞同：9
> 
> 时间：2013-01-16T06:09:37.350

我想看看哪种方法最快。`check_replace`总体而言，该函数给出了最好和最一致的结果。该`check_exception`函数给出了最快的结果，但前提是没有引发异常 - 这意味着它的代码是最有效的，但引发异常的开销非常大。

请注意，检查是否成功转换是唯一准确的方法，例如，这适用于`check_exception`但其他两个测试函数将返回 False 以获得有效的浮点数：

```
huge_number = float('1e+100') 
```

这是基准代码：

```
import time, re, random, string

ITERATIONS = 10000000

class Timer:    
    def __enter__(self):
        self.start = time.clock()
        return self
    def __exit__(self, *args):
        self.end = time.clock()
        self.interval = self.end - self.start

def check_regexp(x):
    return re.compile("^\d*\.?\d*$").match(x) is not None

def check_replace(x):
    return x.replace('.','',1).isdigit()

def check_exception(s):
    try:
        float(s)
        return True
    except ValueError:
        return False

to_check = [check_regexp, check_replace, check_exception]

print('preparing data...')
good_numbers = [
    str(random.random() / random.random()) 
    for x in range(ITERATIONS)]

bad_numbers = ['.' + x for x in good_numbers]

strings = [
    ''.join(random.choice(string.ascii_uppercase + string.digits) for _ in range(random.randint(1,10)))
    for x in range(ITERATIONS)]

print('running test...')
for func in to_check:
    with Timer() as t:
        for x in good_numbers:
            res = func(x)
    print('%s with good floats: %s' % (func.__name__, t.interval))
    with Timer() as t:
        for x in bad_numbers:
            res = func(x)
    print('%s with bad floats: %s' % (func.__name__, t.interval))
    with Timer() as t:
        for x in strings:
            res = func(x)
    print('%s with strings: %s' % (func.__name__, t.interval)) 
```

以下是在 2017 MacBook Pro 13 上使用 Python 2.7.10 的结果：

```
check_regexp with good floats: 12.688639
check_regexp with bad floats: 11.624862
check_regexp with strings: 11.349414
check_replace with good floats: 4.419841
check_replace with bad floats: 4.294909
check_replace with strings: 4.086358
check_exception with good floats: 3.276668
check_exception with bad floats: 13.843092
check_exception with strings: 15.786169 
```

以下是 Python 3.6.5 在 2017 MacBook Pro 13 上的结果：

```
check_regexp with good floats: 13.472906000000009
check_regexp with bad floats: 12.977665000000016
check_regexp with strings: 12.417542999999995
check_replace with good floats: 6.011045999999993
check_replace with bad floats: 4.849356
check_replace with strings: 4.282754000000011
check_exception with good floats: 6.039081999999979
check_exception with bad floats: 9.322753000000006
check_exception with strings: 9.952595000000002 
```

以下是 PyPy 2.7.13 在 2017 MacBook Pro 13 上的结果：

```
check_regexp with good floats: 2.693217
check_regexp with bad floats: 2.744819
check_regexp with strings: 2.532414
check_replace with good floats: 0.604367
check_replace with bad floats: 0.538169
check_replace with strings: 0.598664
check_exception with good floats: 1.944103
check_exception with bad floats: 2.449182
check_exception with strings: 2.200056 
```

* * *

## 回答 #17

> 赞同：9
> 
> 时间：2018-10-06T07:23:24.067

输入可能如下：

`a="50"` `b=50` `c=50.1` `d="50.1"`

* * *

## **1-一般输入：**

这个函数的输入可以是一切！

查找给定变量是否为数字。数字字符串由可选的符号、任意位数、可选的小数部分和可选的指数部分组成。因此 +0123.45e6 是一个有效的数值。不允许使用十六进制（例如 0xf4c3b00c）和二进制（例如 0b10100111001）表示法。

**is_numeric**函数

```
import ast
import numbers              
def is_numeric(obj):
    if isinstance(obj, numbers.Number):
        return True
    elif isinstance(obj, str):
        nodes = list(ast.walk(ast.parse(obj)))[1:]
        if not isinstance(nodes[0], ast.Expr):
            return False
        if not isinstance(nodes[-1], ast.Num):
            return False
        nodes = nodes[1:-1]
        for i in range(len(nodes)):
            #if used + or - in digit :
            if i % 2 == 0:
                if not isinstance(nodes[i], ast.UnaryOp):
                    return False
            else:
                if not isinstance(nodes[i], (ast.USub, ast.UAdd)):
                    return False
        return True
    else:
        return False 
```

测试：

```
>>> is_numeric("54")
True
>>> is_numeric("54.545")
True
>>> is_numeric("0x45")
True 
```

**is_float**函数

查找给定变量是否为浮点数。浮点字符串由可选符号、任意数量的数字、...

```
import ast

def is_float(obj):
    if isinstance(obj, float):
        return True
    if isinstance(obj, int):
        return False
    elif isinstance(obj, str):
        nodes = list(ast.walk(ast.parse(obj)))[1:]
        if not isinstance(nodes[0], ast.Expr):
            return False
        if not isinstance(nodes[-1], ast.Num):
            return False
        if not isinstance(nodes[-1].n, float):
            return False
        nodes = nodes[1:-1]
        for i in range(len(nodes)):
            if i % 2 == 0:
                if not isinstance(nodes[i], ast.UnaryOp):
                    return False
            else:
                if not isinstance(nodes[i], (ast.USub, ast.UAdd)):
                    return False
        return True
    else:
        return False 
```

测试：

```
>>> is_float("5.4")
True
>>> is_float("5")
False
>>> is_float(5)
False
>>> is_float("5")
False
>>> is_float("+5.4")
True 
```

什么是[ast](https://docs.python.org/2/library/ast.html)？

* * *

## 2-如果您确信变量内容是**String**：

使用[str.isdigit()](https://docs.python.org/2/library/stdtypes.html#str.isdigit)方法

```
>>> a=454
>>> a.isdigit()
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
AttributeError: 'int' object has no attribute 'isdigit'
>>> a="454"
>>> a.isdigit()
True 
```

* * *

## 3-数字输入：

**检测int值：**

```
>>> isinstance("54", int)
False
>>> isinstance(54, int)
True
>>> 
```

**检测浮动：**

```
>>> isinstance("45.1", float)
False
>>> isinstance(45.1, float)
True 
```

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2020-04-15T21:48:48.523

**[`str.isnumeric()`](https://docs.python.org/3/library/stdtypes.html#str.isnumeric)**

> `True`如果字符串中的所有字符都是数字字符，并且至少有一个字符，则返回，`False`否则。数字字符包括数字字符，以及所有具有 Unicode 数值属性的字符，例如 U+2155、VULGAR FRACTION ONE FIFTH。形式上，数字字符是具有属性值 Numeric_Type=Digit、Numeric_Type=Decimal 或 Numeric_Type=Numeric 的字符。

**[`str.isdecimal()`](https://docs.python.org/3/library/stdtypes.html#str.isdecimal)**

> `True`如果字符串中的所有字符都是十进制字符并且至少有一个字符，则返回，`False`否则。十进制字符是可用于形成以 10 为底的数字的字符，例如 U+0660、ARABIC-INDIC DIGIT ZERO。形式上，十进制字符是 Unicode 通用类别“Nd”中的字符。

两者都可用于 Python 3.0 中的字符串类型。

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2020-12-06T03:31:53.750

在浮点数的最一般情况下，人们希望处理整数和小数。我们以字符串`"1.1"`为例。

我会尝试以下方法之一：

**1.> [非数字（）](https://docs.python.org/3/library/stdtypes.html)**

```
word = "1.1"

"".join(word.split(".")).isnumeric()
>>> True 
```

**2.> [isdigit()](https://docs.python.org/3/library/stdtypes.html)**

```
word = "1.1"

"".join(word.split(".")).isdigit()
>>> True 
```

**3.> [isdecimal()](https://docs.python.org/3/library/stdtypes.html)**

```
word = "1.1"

"".join(word.split(".")).isdecimal()
>>> True 
```

**速度：**

► 所有上述方法都具有相似的速度。

```
%timeit "".join(word.split(".")).isnumeric()
>>> 257 ns ± 12 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)

%timeit "".join(word.split(".")).isdigit()
>>> 252 ns ± 11 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)

%timeit "".join(word.split(".")).isdecimal()
>>> 244 ns ± 7.17 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each) 
```

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2014-07-03T17:12:27.923

我需要确定一个字符串是否转换为基本类型（float、int、str、bool）。在互联网上找不到任何东西后，我创建了这个：

```
def str_to_type (s):
    """ Get possible cast type for a string

    Parameters
    ----------
    s : string

    Returns
    -------
    float,int,str,bool : type
        Depending on what it can be cast to

    """    
    try:                
        f = float(s)        
        if "." not in s:
            return int
        return float
    except ValueError:
        value = s.upper()
        if value == "TRUE" or value == "FALSE":
            return bool
        return type(s) 
```

例子

```
str_to_type("true") # bool
str_to_type("6.0") # float
str_to_type("6") # int
str_to_type("6abc") # str
str_to_type(u"6abc") # unicode 
```

您可以捕获类型并使用它

```
s = "6.0"
type_ = str_to_type(s) # float
f = type_(s) 
```

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2019-05-10T21:15:01.920

我认为您的解决方案很好，但是有*一个*正确的正则表达式实现。

对于这些我认为不合理的答案，似乎确实有很多正则表达式讨厌，正则表达式可以相当干净、正确和快速。这真的取决于你想要做什么。最初的问题是如何“检查字符串是否可以表示为数字（浮点数）”（根据您的标题）。据推测，一旦您检查了数字/浮点值是否有效，您就会想使用它，在这种情况下，您的 try/except 很有意义。但是，如果出于某种原因，您只想验证*字符串*是否为*数字*那么正则表达式也可以正常工作，但很难正确。我认为到目前为止，大多数正则表达式的答案，例如，没有正确解析没有整数部分（例如“.7”）的字符串，就python而言这是一个浮点数。在不需要小数部分的单个正则表达式中检查这有点棘手。我已经包含了两个正则表达式来显示这一点。

它确实提出了一个有趣的问题，即“数字”是什么。您是否包含在 python 中作为浮点数有效的“inf”？或者您是否包含“数字”但可能无法在 python 中表示的数字（例如大于浮点最大值的数字）。

解析数字的方式也有歧义。例如，“--20”呢？这是一个“数字”吗？这是代表“20”的合法方式吗？Python 会让你执行 "var = --20" 并将其设置为 20（虽然这实际上是因为它把它视为一个表达式），但 float("--20") 不起作用。

无论如何，在没有更多信息的情况下，这是一个正则表达式，我相信它涵盖了所有整数和浮点数*，因为 python 解析它们*。

```
# Doesn't properly handle floats missing the integer part, such as ".7"
SIMPLE_FLOAT_REGEXP = re.compile(r'^[-+]?[0-9]+\.?[0-9]+([eE][-+]?[0-9]+)?$')
# Example "-12.34E+56"      # sign (-)
                            #     integer (12)
                            #           mantissa (34)
                            #                    exponent (E+56)

# Should handle all floats
FLOAT_REGEXP = re.compile(r'^[-+]?([0-9]+|[0-9]*\.[0-9]+)([eE][-+]?[0-9]+)?$')
# Example "-12.34E+56"      # sign (-)
                            #     integer (12)
                            #           OR
                            #             int/mantissa (12.34)
                            #                            exponent (E+56)

def is_float(str):
  return True if FLOAT_REGEXP.match(str) else False 
```

一些示例测试值：

```
True  <- +42
True  <- +42.42
False <- +42.42.22
True  <- +42.42e22
True  <- +42.42E-22
False <- +42.42e-22.8
True  <- .42
False <- 42nope 
```

在@ron-reiter 的[答案](https://stackoverflow.com/a/14352314/1795483)中运行基准测试代码表明，这个正则表达式实际上比普通正则表达式更快，并且在处理错误值方面比异常快得多，这是有道理的。结果：

```
check_regexp with good floats: 18.001921
check_regexp with bad floats: 17.861423
check_regexp with strings: 17.558862
check_correct_regexp with good floats: 11.04428
check_correct_regexp with bad floats: 8.71211
check_correct_regexp with strings: 8.144161
check_replace with good floats: 6.020597
check_replace with bad floats: 5.343049
check_replace with strings: 5.091642
check_exception with good floats: 5.201605
check_exception with bad floats: 23.921864
check_exception with strings: 23.755481 
```

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2010-10-12T07:43:19.860

我做了一些速度测试。假设如果字符串**可能**是数字，则*try/except*策略是最快的。如果字符串**不太可能**是数字**并且**您对**整数**检查感兴趣，则值得做一些测试（isdigit plus heading '-'）。如果您有兴趣检查浮点数，则必须使用*try/except*代码来进行转义。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2013-07-29T14:08:23.137

RyanN 建议

> 如果要为 NaN 和 Inf 返回 False，请将行更改为 x = float(s); 返回 (x == x) 和 (x - 1 != x)。这应该为除 Inf 和 NaN 之外的所有浮点数返回 True

但这并不完全有效，因为对于足够大的浮点数，`x-1 == x`返回 true。例如，`2.0**54 - 1 == 2.0**54`

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2018-12-16T07:12:18.193

此代码处理指数、浮点数和整数，但不使用正则表达式。

```
return True if str1.lstrip('-').replace('.','',1).isdigit() or float(str1) else False 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2014-11-09T14:06:38.993

我正在研究一个导致我进入这个线程的问题，即如何以最直观的方式将数据集合转换为字符串和数字。在阅读了原始代码后，我意识到我需要的内容在两个方面有所不同：

1 - 如果字符串表示整数，我想要一个整数结果

2 - 我希望将数字或字符串结果粘贴到数据结构中

所以我修改了原始代码来产生这个衍生物：

```
def string_or_number(s):
    try:
        z = int(s)
        return z
    except ValueError:
        try:
            z = float(s)
            return z
        except ValueError:
            return s 
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2018-08-02T11:06:14.207

```
import re
def is_number(num):
    pattern = re.compile(r'^[-+]?[-0-9]\d*\.\d*|[-+]?\.?[0-9]\d*$')
    result = pattern.match(num)
    if result:
        return True
    else:
        return False

​&gt;>>: is_number('1')
True

>>>: is_number('111')
True

>>>: is_number('11.1')
True

>>>: is_number('-11.1')
True

>>>: is_number('inf')
False

>>>: is_number('-inf')
False 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2009-07-16T17:45:12.710

这是我的简单方法。假设我正在循环一些字符串，如果它们是数字，我想将它们添加到数组中。

```
try:
    myvar.append( float(string_to_check) )
except:
    continue 
```

如果结果是数字，则将 myvar.apppend 替换为您想要对字符串执行的任何操作。这个想法是尝试使用 float() 操作并使用返回的错误来确定字符串是否为数字。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2016-10-15T21:11:09.410

我也使用了您提到的函数，但很快我注意到字符串为“Nan”、“Inf”及其变体被视为数字。所以我建议你改进你的函数版本，这将在这些类型的输入上返回 false 并且不会失败“1e3”变体：

```
def is_float(text):
    try:
        float(text)
        # check for nan/infinity etc.
        if text.isalpha():
            return False
        return True
    except ValueError:
        return False 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2019-08-15T22:18:39.407

用户辅助功能：

```
def if_ok(fn, string):
  try:
    return fn(string)
  except Exception as e:
    return None 
```

然后

```
if_ok(int, my_str) or if_ok(float, my_str) or if_ok(complex, my_str)
is_number = lambda s: any([if_ok(fn, s) for fn in (int, float, complex)]) 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2021-08-14T06:24:35.223

我知道我迟到了，但找到了一个不在这里的解决方案：这个解决方案遵循Python中的[EAFP 原则](https://docs.python.org/3.5/glossary.html#term-eafp)

```
def get_number_from_string(value):
    try:
        int_value = int(value)
        return int_value

    except ValueError:
        return float(value) 
```

解释：

如果字符串中的值为 a`float`并且我首先尝试将其解析为 a `int`，它将抛出 a `ValueError`。因此，我捕获了该错误并将值解析为`float`并返回。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2013-05-24T21:36:36.950

您可以通过返回比 True 和 False 更有用的值来以有用的方式概括异常技术。例如，此函数将引号放在字符串中，但不考虑数字。这正是我需要一个快速而肮脏的过滤器来为 R 定义一些变量。

```
import sys

def fix_quotes(s):
    try:
        float(s)
        return s
    except ValueError:
        return '"{0}"'.format(s)

for line in sys.stdin:
    input = line.split()
    print input[0], '<- c(', ','.join(fix_quotes(c) for c in input[1:]), ')' 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2015-05-30T17:12:56.333

试试这个。

```
 def is_number(var):
    try:
       if var == int(var):
            return True
    except Exception:
        return False 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2020-04-03T14:39:42.333

```
def is_float(s):
    if s is None:
        return False

    if len(s) == 0:
        return False

    digits_count = 0
    dots_count = 0
    signs_count = 0

    for c in s:
        if '0' <= c <= '9':
            digits_count += 1
        elif c == '.':
            dots_count += 1
        elif c == '-' or c == '+':
            signs_count += 1
        else:
            return False

    if digits_count == 0:
        return False

    if dots_count > 1:
        return False

    if signs_count > 1:
        return False

    return True 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2021-02-22T03:13:18.383

对于僵尸线程帖子感到抱歉 - 只是想完善代码以确保完整性......

```
# is_number() function - Uses re = regex library
# Should handle all normal and complex numbers
# Does not accept trailing spaces. 
# Note: accepts both engineering "j" and math "i" but only the imaginary part "+bi" of a complex number a+bi
# Also accepts inf or NaN
# Thanks to the earlier responders for most the regex fu

import re

ISNUM_REGEXP = re.compile(r'^[-+]?([0-9]+|[0-9]*\.[0-9]+)([eE][-+]?[0-9]+)?[ij]?$')

def is_number(str):
#change order if you have a lot of NaN or inf to parse
    if ISNUM_REGEXP.match(str) or str == "NaN" or str == "inf": 
        return True 
    else:
        return False
# A couple test numbers
# +42.42e-42j
# -42.42E+42i

print('Is it a number?', is_number(input('Gimme any number: '))) 
```

给我任何号码：+42.42e-42j

是数字吗？真的

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2021-07-16T14:23:19.923

对于我非常简单且非常常见的用例：`is this human written string with keyboard a number`？

我通读了大多数答案，最终得到：

```
def isNumeric(string):
    result = True
    try:
        x = float(string)
       result = (x == x) and (x - 1 != x)
    except ValueError:
        result = False
    return result 
```

它将返回 False`(+-)NaN`和`(+-)inf`。

你可以在这里查看：[https ://trinket.io/python/ce32c0e54e](https://trinket.io/python/ce32c0e54e)

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2022-01-05T18:20:32.803

一种快速简单的选择是检查数据类型：

```
def is_number(value):
    return type(value) in [int, float] 
```

或者，如果您想测试字符串的值是否为数字：

```
def isNumber (value):
    return True if type(value) in [int, float] else str(value).replace('.','',1).isdigit() 
```

测试：

```
>>> isNumber(1)
True

>>> isNumber(1/3)
True

>>> isNumber(1.3)
True

>>> isNumber('1.3')
True

>>> isNumber('s1.3')
False 
```

* * *

## 回答 #37

> 赞同：-2
> 
> 时间：2018-03-18T00:18:41.150

我有一个类似的问题。我不想定义 isNumber 函数，而是想将字符串列表转换为浮点数，用高级术语来说是：

```
[ float(s) for s in list if isFloat(s)] 
```

这是因为我们无法真正将 float(s) 与 isFloat(s) 函数分开：这两个结果应该由同一个函数返回。此外，如果 float(s) 失败，则整个过程都会失败，而不仅仅是忽略有故障的元素。另外，“0”是一个有效数字，应该包含在列表中。过滤掉不良元素时，一定不要排除0。

因此，上述理解必须以某种方式修改为：

*   如果列表中的任何元素无法转换，请忽略它并且不要抛出异常
*   避免为每个元素多次调用 float(s)（一个用于转换，另一个用于测试）
*   如果转换后的值为 0，它仍应出现在最终列表中

我提出了一个受 C# 的 Nullable 数值类型启发的解决方案。这些类型在内部由一个结构体表示，该结构体具有数值并添加一个布尔值，指示该值是否有效：

```
def tryParseFloat(s):
    try:
        return(float(s), True)
    except:
        return(None, False)

tupleList = [tryParseFloat(x) for x in list]
floats = [v for v,b in tupleList if b] 
```

* * *

## 回答 #38

> 赞同：-3
> 
> 时间：2017-02-24T11:11:51.287

使用以下它处理所有情况： -

```
import re
a=re.match('((\d+[\.]\d*$)|(\.)\d+$)' ,  '2.3') 
a=re.match('((\d+[\.]\d*$)|(\.)\d+$)' ,  '2.')
a=re.match('((\d+[\.]\d*$)|(\.)\d+$)' ,  '.3')
a=re.match('((\d+[\.]\d*$)|(\.)\d+$)' ,  '2.3sd')
a=re.match('((\d+[\.]\d*$)|(\.)\d+$)' ,  '2.3') 
```

# regex - 什么是“最好的”美国货币 RegEx？

> ID：354044
> 
> 赞同：67
> 
> 时间：2008-12-09T20:05:33.437
> 
> 标签：regex, currency

快速搜索货币正则表达式会带来[很多结果](https://regexlib.com/Search.aspx?k=currency&c=-1&m=-1&ps=20)。

我在选择一个时遇到的问题是，如果不测试所有边缘情况，就很难验证正则表达式。有没有人有经过*彻底测试*的美元正则表达式？

我唯一的要求是匹配的字符串是美国货币并解析为`System.Decimal`：

```
[ws][sign][digits,]digits[.fractional-digits][ws]

方括号（[ 和 ]）中的元素是可选的。
下表描述了每个元素。

元素描述
ws 可选的空格。
标志 可选标志。
数字 范围从 0 到 9 的数字序列。
, 特定于文化的千位分隔符。
. 特定于文化的小数点符号。
小数位数 范围从 0 到 9 的数字序列。

```

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2008-12-09T20:57:54.487

这里有一些来自 Regex Buddy 制造商的东西。这些来自图书馆，所以我相信它们已经过彻底的测试。

数字：货币金额（必须为美分）可选千位分隔符；强制两位数小数

```
Match; JGsoft:
^[+-]?[0-9]{1,3}(?:,?[0-9]{3})*\.[0-9]{2}$ 
```

数字：货币金额（美分可选）可选千位分隔符；可选的两位小数

```
Match; JGsoft:
^[+-]?[0-9]{1,3}(?:,?[0-9]{3})*(?:\.[0-9]{2})?$ 
```

数字：货币金额 US & EU（美分可选） 可以使用美式 123,456.78 表示法和欧式 123.456,78 表示法。可选的千位分隔符；可选的两位小数

```
Match; JGsoft:
^[+-]?[0-9]{1,3}(?:[0-9]*(?:[.,][0-9]{2})?|(?:,[0-9]{3})*(?:\.[0-9]{2})?|(?:\.[0-9]{3})*(?:,[0-9]{2})?)$ 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-12-09T21:20:00.260

我在 www.RegExLib.com 的 Kirk Fuller、Gregg Durishan 上在线找到了这个正则表达式

在过去的几年里，我一直在成功地使用它。

```
"^\$?\-?([1-9]{1}[0-9]{0,2}(\,\d{3})*(\.\d{0,2})?|[1-9]{1}\d{0,}(\.\d{0,2})?|0(\.\d{0,2})?|(\.\d{1,2}))$|^\-?\$?([1-9]{1}\d{0,2}(\,\d{3})*(\.\d{0,2})?|[1-9]{1}\d{0,}(\.\d{0,2})?|0(\.\d{0,2})?|(\.\d{1,2}))$|^\(\$?([1-9]{1}\d{0,2}(\,\d{3})*(\.\d{0,2})?|[1-9]{1}\d{0,}(\.\d{0,2})?|0(\.\d{0,2})?|(\.\d{1,2}))\)$" 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-09T21:52:01.990

根本没有经过彻底测试（我只是写了它！），但似乎表现正确：

```
^-?(?:0|[1-9]\d{0,2}(?:,?\d{3})*)(?:\.\d+)?$ 
```

测试集：

```
0
1
33
555
4,656
4656
99,785
125,944
7,994,169
7994169
0.00
1.0
33.78795
555.12
4,656.489
99,785.01
125,944.100
-7,994,169
-7994169.23 // Borderline...

Wrong:
000
01
3,3
5.
555,
,656
99,78,5
1,25,944
--7,994,169
0.0,0
.10
33.787,95
4.656.489
99.785,01
1-125,944.1
-7,994E169 
```

注意：您的 System.Decimal 取决于语言环境，很难在正则表达式中制作，除非在构建它时。我假设数字按三分组，即使在某些文化（语言环境）中存在不同的规则。
在它周围添加空格是微不足道的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-01-05T17:15:13.767

如果您想考虑人为错误，您可以在匹配货币时使正则表达式更加宽容。我使用了 Keng 的第二个不错的正则表达式，并使它更健壮地解释了拼写错误。

```
\$\ ?[+-]?[0-9]{1,3}(?:,?[0-9])*(?:\.[0-9]{1,2})? 
```

这将匹配任何这些正确或损坏的货币数字，但不会在空格后的末尾拾取额外的垃圾：

```
$46,48382
$4,648,382
$ 4,648,382
$4,648,382.20
$4,648,382.2
$4,6483,82.20
$46,48382 70.25PD
$ 46,48382 70.25PD 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-12-15T19:16:44.267

Keng 的答案是完美的，我只想补充一点，以使用 1 或 2 位小数（第三版）：

```
"^[+-]?[0-9]{1,3}(?:[0-9]*(?:[.,][0-9]{1})?|(?:,[0-9]{3})*(?:\.[0-9]{1,2})?|(?:\.[0-9]{3})*(?:,[0-9]{1,2})?)$ 
```

[网络小提琴： https](https://dotnetfiddle.net/1mUpX2) ://dotnetfiddle.net/1mUpX2

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-06-12T02:54:49.760

这个问题已经有几年了，所以我想给出一个更新的答案。

我使用了[jQuery InputMask](https://github.com/RobinHerbots/jquery.inputmask)，它对于输入/格式屏蔽（例如电话号码等）非常有效，但根据我的经验，它对于货币的效果并不好。

对于货币，我强烈推荐[autoNumeric](https://github.com/BobKnothe/autoNumeric) jQuery 插件。它维护得很好，他们基本上“想到了一切”我想要的货币。

我实际上结合使用这两个插件来格式化电话号码、数字格式（ISBN 等）以及货币（主要是美元）。

请记住，这`jquery.inputmask`主要是关于控制值的格式，而`autoNumeric`具体是关于控制货币的格式。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2020-08-04T15:10:24.347

[![正则表达式](https://i.stack.imgur.com/BzJTR.png)](https://i.stack.imgur.com/BzJTR.png)

`/^[-]?[$]\d{1,3}(?:,?\d{3})*\.\d{2}$/`是我想出的 - 我看到了类似的答案，但我只是使用`\d`而不是`[0-9]`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-08-25T06:57:22.013

我也在研究这个，并得出结论，最好根据当前的文化构建正则表达式。我们可以使用

```
CurrencyPositivePattern 
CurrencyGroupSeparator
CurrencyDecimalSeparator 
```

的属性`NumberFormatInfo`来获得所需的格式。

编辑：像这样

```
NumberFormatInfo nfi = CultureInfo.CurrentCulture.NumberFormat;
      // Assign needed property values to variables.
      string currencySymbol = nfi.CurrencySymbol;
      bool symbolPrecedesIfPositive = nfi.CurrencyPositivePattern % 2 == 0;
      string groupSeparator = nfi.CurrencyGroupSeparator;
      string decimalSeparator = nfi.CurrencyDecimalSeparator;

      // Form regular expression pattern.
      string pattern = Regex.Escape( symbolPrecedesIfPositive ? currencySymbol : "") + 
                       @"\s*[-+]?" + "([0-9]{0,3}(" + groupSeparator + "[0-9]{3})*(" + 
                       Regex.Escape(decimalSeparator) + "[0-9]+)?)" + 
                       (! symbolPrecedesIfPositive ? currencySymbol : ""); 
```

参考 - [http://msdn.microsoft.com/en-us/library/hs600312.aspx](http://msdn.microsoft.com/en-us/library/hs600312.aspx)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-11-29T13:15:35.520

我正在使用以下正则表达式进行货币验证：

```
^-?0*(?:\d+(?!,)(?:\.\d{1,2})?|(?:\d{1,3}(?:,\d{3})*(?:\.\d{1,2})?))$ 
```

您还可以允许可选的前导美元符号：

```
^\$?-?0*(?:\d+(?!,)(?:\.\d{1,2})?|(?:\d{1,3}(?:,\d{3})*(?:\.\d{1,2})?))$ 
```

您可以通过添加轻松添加括号测试而不是符号

```
\( and \) 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-12-12T17:35:01.287

我在这方面取得了成功（从上面的一些正则表达式中获取点点滴滴）。最多只能处理数千个，但扩展它应该不会太难

```
case class CurrencyValue(dollars:Int,cents:Int)
def cents = """[\.\,]""".r ~> """\d{0,2}""".r ^^ {
  _.toInt
}
def dollarAmount: Parser[Int] = """[1-9]{1}[0-9]{0,2}""".r ~ opt( """[\.\,]""".r ~> """\d{3}""".r) ^^ {
  case x ~ Some(y) => x.toInt * 1000 + y.toInt
  case x ~ None => x.toInt
}
def usCurrencyParser = """(\$\s*)?""".r ~> dollarAmount ~ opt(cents) <~ opt( """(?i)dollars?""".r) ^^ {
  case d ~ Some(change) => CurrencyValue(d, change)
  case d ~ None => CurrencyValue(d, 0)
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-07-07T21:41:50.493

这就是我使用的：

**没有前导 + 或 -**

```
^\$\d{1,3}\.[0-9]{2}$|^\$(\d{1,3},)+\d{3}\.[0-9]{2}$ 
```

**带有可选的前导 + 或 -**

```
^[+-]?\$\d{1,3}\.[0-9]{2}$|^[+-]?\$(\d{1,3},)+\d{3}\.[0-9]{2}$ 
```

网络小提琴： [https ://jsfiddle.net/compsult/9of63cwk/12/](https://jsfiddle.net/compsult/9of63cwk/12/)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-06-29T00:49:34.570

使用 Leandro 的答案，我`^(?:[$]|)`在开头添加了一个美元符号

```
^(?:[$]|)[+-]?[0-9]{1,3}(?:[0-9]*(?:[.,][0-9]{1})?|(?:,[0-9]{3})*(?:\.[0-9]{1,2})?|(?:\.[0-9]{3})*(?:,[0-9]{1,2})?)$ 
```

*这匹配*

```
136,402.99
25.27
0.33
$584.56
1
00.2
3,254,546.00
$3,254,546.00
00.01
-0.25
+0.85
+100,052.00 
```

*不匹配*

```
11124.52
234223425.345
234.
.5234
a
a.23
32.a
a.a
z548,452.22
u66.36 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-12-08T16:18:14.203

这个如何？更短更优雅

```
(?:\,|\.?\d)* 
```

# java - 轻量级 Java 十进制类

> ID：354045
> 
> 赞同：14
> 
> 时间：2008-12-09T20:05:45.323
> 
> 标签：java, decimal

我正在考虑为 BigDecimal 编写两个有限精度的替代方案，即 DecimalInt 和 DecimalLong。这些将能够处理 int 和 long 的实际范围内的数字，具有任意数量的小数位，可以以可变和不可变的形式创建。我的计划是让 DecimalInt 支持 +/-999,999,999 到 +/- 0.999999999 和 DecimalLong 相同，但最多支持 18 位数字。

这将通过将 DecimalInt 的十进制数字计数值 0-9 和 DecimalLong 的 0-18 与存储为缩放的 int 或 long 的实际值一起维护来完成。通常用于小数位数，例如货币和股票价格，通常为 2-4 位小数。

基本要求是 (a) 精简足迹（2 个类，加上 OverflowException），以及 (b) 完全支持所有基本操作以及所有有意义的数学。

谷歌搜索结果没有返回任何明显的命中——它们似乎都与任意小数有关。

我的问题是：这已经完成了吗？这是否有隐藏的微妙之处，这就是为什么它还没有完成？有没有人听说过 Java 支持像 DotNet 的十进制类型的传闻。

编辑：这与 BigDecimal 不同，因为它应该（a）不处理整数数组的效率要高得多，并且（b）它不会包装 BigInteger，因此它也会更精简内存，并且(c) 它将有一个可变选项，因此在那里它也会更快。总而言之 - 像“我想存储银行余额而不需要 BigDecimal 的开销和 double 的不准确性”这样的简单用例的开销更少。

编辑：我打算使用 int 或 long 进行所有数学运算，以避免经典问题：1586.60-708.75=877.8499999999999 而不是 877.85

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-11T10:39:45.230

我强烈怀疑没有这样做的原因是 BigDecimal 和 BigInteger 的开销并不像您想象的那么相关，并且避免它不值得付出努力和以某种微妙的方式出错的风险。

以您的示例为例：对于任何金融应用程序，保存几十个字节都不是问题，而且精度有限，会破坏交易（美国的股票价格通常为 2-4 位数，但如果您想与新兴市场打交道，你会遇到通货膨胀失控的货币，15 位数的总和可以为你买半条面包）。

基本上，这听起来像是另一种过早优化的情况。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-23T23:03:13.630

大多数特别关心舍入错误的人使用 BigDecimal 和 BigInteger，它们在大多数情况下都表现得很好。

但是，在性能更为关键的情况下，使用带舍入的 double 可以完成这项工作。新手经常忘记这一点，但你不能在没有明智的回合的情况下获得双重结果并期望得到明智的答案。

在绝大多数情况下，您只需要四舍五入即可。

```
System.out.printf("%.2f%n", 1586.60-708.75); 
```

印刷

```
877.85 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T14:38:26.763

如果您正在寻找一个固定的、小数位数的小数位数来处理货币，那么这通常是通过持有整数（必要时长）美分或百分之一美分来完成的。

如果您正在处理金钱，那么您将需要注意如何处理舍入。如果要审核您的计算，则有一些关于如何完成此类事情的规则。另外我假设您知道某些操作无法精确完成（除法是明显的例子）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T20:31:18.503

如果您的重点是便携式设备，请查看[Real](http://real-java.sourceforge.net/Real.html)。Real 允许将数字的[精度](http://real-java.sourceforge.net/javadoc/index.html)设置为 0 到 16。它是为 MIDP 手机设计的。

同样有趣的是，看看[建设性的 reals](http://www.hpl.hp.com/personal/Hans_Boehm/new_crcalc/CRCalc.html)图书馆。虽然它不是轻量级的。

参考下面的评论，您不能使用[Apache Commons 数学库](http://commons.apache.org/math/userguide/fraction.html)来处理分数吗？有什么不可行的原因吗？

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-09T22:43:45.287

在我看来，如果您想要任意精度，那么您将需要未定义的位数来表示尾数。这意味着尾数需要某种数组分配策略。你可以在这里制作你自己的，但是 BigInteger 做得相当有效并且它有效

您需要指定您需要表示的最小（非零）值是什么。这将是 10^-(2^n)，其中 n+1 是您分配给指数的位数。使用 BigDecimal，这是 10^-(2^31)。您可以使用任意大小的指数，但该范围对任何人都应该足够了。

因此，您需要一个无界整数尾数来为您提供任意精度和一个固定大小的指数，具体取决于您希望最小可表示值是什么。本质上这是 BigDecimal；唯一的变化是您将使用一些较小的对象，而不是 BigDecimal 使用的 int。我怀疑节省空间是否值得。我认为 BigDecimal 会做你需要的事情，几乎不会比你自己制作的任何解决方案更多的内存使用量。

当然，您可以选择所需的最大有效数字数；那么你需要固定大小的尾数和指数存储，而这要少得多。只需使用固定数量的 long 作为尾数。

# perl - 如何使用 Win32:API 将指针传递给 DLL？

> ID：354050
> 
> 赞同：2
> 
> 时间：2008-12-09T20:06:45.760
> 
> 标签：perl, winapi, dll, pointers

我正在尝试将 3 个指针传递给 DLL 函数。我有：

```
{

$代码=1；
$len=100;
$str=" " x $len;

$function = new Win32::API(DLLNAME,'dllfunction','PPP','V');

$function->Call($code,$str,$len);

}

```

DLL 定义为`void dllfunction(int* a, char* str, int* len);`DLL 将修改三个指针所指向的所有变量。

但是，当我运行它时，我会出现段错误。[Win32::API](http://search.cpan.org/dist/Win32-API)的文档指定我应该使用实际变量名而不是 Perl 变量引用。谁能告诉我我错过了什么？谢谢。

*更多信息：

我`printf()`在DLL中添加了打印出三个指针的地址，并`printf`在Perl中打印出三个变量的引用。我得到以下信息

DLL：代码 = 0x10107458 错误 = 0x10046b50 str = 0x10107460

Perl：代码 = 0x101311b8 错误 = 0x101312a8 str = 0x10131230

知道为什么 DLL 得到错误的地址吗？

****更多信息

经过多次调试，我发现从 DLL 函数返回时会发生这种情况。我添加了 printf("done\n"); 作为这个 DLL 函数的最后一行，它确实输出，然后程序段错误。我猜它发生在 Win32::API 中？有没有人经历过这个？

此外，我可以从 DLL 访问所有三个变量的初始变量。所以指针是正确传递的，但由于某种原因，它在从 DLL 返回时会导致段错误。尝试将新数据复制到 Perl 变量中时可能会出现段错误？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T22:30:27.717

啊！！我想到了。

问题是这个

> 5.  并且您可以选择指定调用约定，默认为“__stdcall”，或者您可以指定“_cdecl”。

dll 函数是用 extern "C" __declspec(dllexport) 导出的，所以我想也许我应该使用 '_cdecl' 标志。

Win32::API('dll','dllfunction','PPP','V','_cdecl');

作品！

感谢大家。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T21:09:31.810

好的，我按照亚当的链接[到此页面](http://search.cpan.org/~acalpini/Win32-API-0.41/API.pm#CALLING_AN_IMPORTED_FUNCTION)。据此，调用应该是：

```
$function->Call(code, $str, len) 
```

示例代码使用了一个带有 LPSTR（本质上是 char*）参数的函数，并且它使用了您所期望的变量，但这里有点：

> 对于指针，您必须使用变量名（没有 Perl 引用，只是一个普通的变量名）。

似乎表明我在这篇文章中列出的代码*应该可以*工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T20:31:53.010

IANAPH，但我认为您需要使用[参考](http://www.troubleshooters.com/codecorn/littperl/perlsub.htm#References)，如下所示：

```
$function->Call(\$code, \$str, \$len) 
```

我最不确定的是 $str - 它*可能*不需要参考。段错误几乎肯定来自试图写入内存地址 1（或 100，取决于它首先尝试写入）的 DLL。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T22:08:26.997

我不是 Windows 程序员，但看到：

> 对于指针，您必须使用变量名

对我来说意味着变量名，而不是变量本身。这行得通吗？

```
$function->Call('code', 'str', 'len'); 
```

或者可能

```
$function->Call('$code', '$str', '$len'); 
```

顺便说一句，我不希望内存地址是相同的。`Win32::API`将需要将 Perl 数据元素转换为 Windows 可以理解的东西，我严重怀疑它们会占用相同的物理内存空间。

# jquery - jquery $.post 在 Firefox 中不起作用

> ID：354057
> 
> 赞同：4
> 
> 时间：2008-12-09T20:09:44.957
> 
> 标签：jquery, internet-explorer, firefox

我乞求使用jquery。我有以下适用于 IE7 但不适用于 FF 3.0.4 的调用。但是，如果我将其更改`null`为`{}`它可以正常工作。null 对于这种情况无效，我很幸运它在 IE 中工作，或者这是 jquery 的错误。

```
$.post("complexitybar.ashx?a=init&vc=" + validationCode, null, loadInitialValues, "json"); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-09T20:20:54.327

尝试[`$.get()`](http://docs.jquery.com/Ajax/jQuery.get)查询字符串请求：

```
$.get('complexitybar.ashx?a=init&vc=...') 
```

POST 请求期望 URL 和键值对是分开的：

```
$.post('complexitybar.ashx', 'a=init&vc=...') 
```

对于 POST 请求，键值对作为内容数据而不是 URI 的一部分发送。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T20:17:22.837

由于您尝试传递`null`给的参数[应该](http://docs.jquery.com/Ajax/jQuery.post)代表您要传递给您发布到的 url 的键值对数据，因此使用空对象 ( `{}`)可能更有意义`null`。

`null`如果您正在考虑诸如 Java 之类的语言，则不会像您期望的那样对待它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T06:49:57.917

尝试使用 $.ajajx 方法 "POST" 会更好

# flash - Flash Catalyst 所需的 Flash Player

> ID：354061
> 
> 赞同：0
> 
> 时间：2008-12-09T20:10:06.907
> 
> 标签：flash, apache-flex, flashcatalyst

我知道 Flash Catalyst 仍处于测试阶段，但我正在努力向前看。我们的很多用户都在 Intranet 上，其 IT 人员需要大量时间来升级用户计算机上的 Flash Player。现在大多数用户都在使用 Flash Player 9。

所以我的问题是，使用 Flash Catalyst 创建的 SWF 文件是否需要 Flash Player 10？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-10T15:44:45.257

催化剂所基于的 Flex 4 Gumbo 材料目前需要 Flash 9。但催化剂可能距离出货还有一年的时间。事情很有可能会改变。特别是如果 Catalyst 构建为使用 Flash 10 中的新字体渲染系统。

此外，这意味着使用催化剂构建的应用程序可能需要 18 个月左右的时间。

# c# - 如何使用带有 SqlRoleProvider 的 Windows 身份验证为新用户设置默认角色？

> ID：354068
> 
> 赞同：1
> 
> 时间：2008-12-09T20:13:44.060
> 
> 标签：c#, asp.net, security, windows-authentication

我有一个应用程序，它分别使用 Windows 身份验证和 SqlRoleProvider 进行用户身份验证和角色管理。它适用于我作为默认值添加到数据库中的测试用户。该应用程序要求用户登录（使用 Windows 凭据），然后才能将此内部应用程序用作基本“用户”。如果需要将用户添加到高级角色，管理员将在首次登录后负责此操作。

话虽如此，当他们第一次登录时，我如何将用户添加到默认角色？从逻辑上讲，我知道我需要调用 Roles.IsUserInRole() ，如果不是，则添加它们；但是，我会在哪里做呢？我无法在 Global.asax 中找到要使用的事件。

谢谢

**编辑：** 为了稍微扩展一下场景，由于需要编写新的提供程序以允许将连接字符串存储在 web.config 之外，我没有使用完整的会员提供程序系统。我没有使用任何形式的注册或登录页面，而是让 IIS 中的 Windows 集成身份验证处理身份验证方面，而我增强的 SqlRoleProvider 管理用户角色。对于我通过硬编码测试设置角色的用户，该系统运行良好。我只是在寻找一种添加新用户（将由 IIS 进行身份验证）以立即添加到默认“用户”角色的方法。我想我找到了；但是，出于性能原因，我现在正在研究使其不会在每次请求时触发的方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T20:51:49.117

在挖掘和玩更多之后，我能够找到解决方案。我将以下代码添加到我的 Global.asax 文件中，它正在实现我所希望的。

```
protected void WindowsAuthentication_OnAuthenticate(object sender, WindowsAuthenticationEventArgs e)
{
    if (!Roles.IsUserInRole(e.Identity.Name, "Users"))
    {
        Roles.AddUsersToRole(new string[] { e.Identity.Name }, "Users");
    }
} 
```

我很担心，因为此代码会随每个页面请求触发。有没有更好的方法来限制这种情况发生？我应该将此代码添加到登录页面的 page_load 事件而不是 Global.asax 吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T20:23:23.277

在获取用户后，我会直接向用户添加默认角色。

像这样的东西：

```
user = Membership.GetUser()
if (user != null)
{
  // default role 
  string[] defaultRoles = {"MyRole"};

  AddUsersToRoles(user, defaultRoles); 

} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T21:08:49.160

为什么登录或注册时不放呢？

登录时，处理该事件并将其放入。每次登录时检查。

# sql - SQL JOIN - WHERE 子句与 ON 子句

> ID：354070
> 
> 赞同：829
> 
> 时间：2008-12-09T20:14:52.187
> 
> 标签：sql, join, where-clause, on-clause

看完后，这*不是*[Explicit vs Implicit SQL Joins](https://stackoverflow.com/questions/44917/explicit-vs-implicit-sql-joins)的重复。答案可能相关（甚至相同），但**问题**不同。

* * *

有什么区别，每个应该做什么？

如果我正确理解了理论，查询优化器应该能够互换使用两者。

* * *

## 回答 #1

> 赞同：1042
> 
> 时间：2008-12-09T20:21:10.613

它们不是同一件事。

考虑以下查询：

```
SELECT *
FROM Orders
LEFT JOIN OrderLines ON OrderLines.OrderID=Orders.ID
WHERE Orders.ID = 12345 
```

和

```
SELECT *
FROM Orders
LEFT JOIN OrderLines ON OrderLines.OrderID=Orders.ID 
    AND Orders.ID = 12345 
```

第一个将为 order number 返回一个订单及其行（如果有）`12345`。第二个将返回所有订单，但只有订单`12345`将有与之关联的任何行。

使用`INNER JOIN`，子句实际上是*等效*的。然而，仅仅因为它们在功能上是相同的，因为它们产生相同的结果，并不意味着这两种从句具有相同的语义。

* * *

## 回答 #2

> 赞同：548
> 
> 时间：2014-01-07T20:54:43.167

*   对于内部连接无关紧要

*   外连接的事项

    一种。`WHERE`子句：加入**后**。加入后将过滤记录。

    湾。`ON`子句 -**在**加入之前。加入前将过滤记录（来自右表）。这可能最终在结果中为 null（因为 OUTER join）。

**示例**：考虑下表：

1.  文件：

    | ID | 姓名 |
    | --- | --- |
    | 1 | 文件1 |
    | 2 | 文档2 |
    | 3 | 文件3 |
    | 4 | 文件4 |
    | 5 | 文件5 |

2.  下载：

    | ID | 文档 ID | 用户名 |
    | --- | --- | --- |
    | 1 | 1 | 桑迪普 |
    | 2 | 1 | 西米 |
    | 3 | 2 | 桑迪普 |
    | 4 | 2 | 雷亚 |
    | 5 | 3 | 西米 |

a) 内部`WHERE`子句：

```
 SELECT documents.name, downloads.id
     FROM documents
     LEFT OUTER JOIN downloads
       ON documents.id = downloads.document_id
     WHERE username = 'sandeep' 
```

对于上述查询，中间连接表将如下所示。

| id（来自文档） | 姓名 | id（来自下载） | 文档 ID | 用户名 |
| --- | --- | --- | --- | --- |
| 1 | 文件1 | 1 | 1 | 桑迪普 |
| 1 | 文件1 | 2 | 1 | 西米 |
| 2 | 文档2 | 3 | 2 | 桑迪普 |
| 2 | 文档2 | 4 | 2 | 雷亚 |
| 3 | 文件3 | 5 | 3 | 西米 |
| 4 | 文件4 | 空值 | 空值 | 空值 |
| 5 | 文件5 | 空值 | 空值 | 空值 |

应用该`WHERE`子句并选择列出的属性后，结果将是：

| 姓名 | ID |
| --- | --- |
| 文件1 | 1 |
| 文档2 | 3 |

b) 内部`JOIN`条款

```
 SELECT documents.name, downloads.id
   FROM documents
     LEFT OUTER JOIN downloads
       ON documents.id = downloads.document_id
         AND username = 'sandeep' 
```

对于上述查询，中间连接表将如下所示。

| id（来自文档） | 姓名 | id（来自下载） | 文档 ID | 用户名 |
| --- | --- | --- | --- | --- |
| 1 | 文件1 | 1 | 1 | 桑迪普 |
| 2 | 文档2 | 3 | 2 | 桑迪普 |
| 3 | 文件3 | 空值 | 空值 | 空值 |
| 4 | 文件4 | 空值 | 空值 | 空值 |
| 5 | 文件5 | 空值 | 空值 | 空值 |

请注意`documents`，不匹配两个条件的行是如何填充`NULL`值的。

选择列出的属性后，结果将是：

| 姓名 | ID |
| --- | --- |
| 文件1 | 1 |
| 文档2 | 3 |
| 文件3 | 空值 |
| 文件4 | 空值 |
| 文件5 | 空值 |

* * *

## 回答 #3

> 赞同：154
> 
> 时间：2008-12-09T20:21:28.227

在`INNER JOIN`s 上它们是可以互换的，优化器会随意重新排列它们。

在`OUTER JOIN`s 上，它们不一定可以互换，这取决于它们依赖于连接的哪一侧。

我根据可读性将它们放在任何一个地方。

* * *

## 回答 #4

> 赞同：64
> 
> 时间：2008-12-09T20:57:01.303

我这样做的方式是：

*   如果您正在`ON`执行`INNER JOIN`. 因此，不要在 ON 子句中添加任何 WHERE 条件，将它们放在`WHERE`子句中。

*   如果您正在执行 a `LEFT JOIN`，请将任何 WHERE 条件添加到联接***右侧***`ON`表的子句中。这是必须的，因为添加引用连接右侧的 WHERE 子句会将连接转换为 INNER JOIN。

     *例外情况是当您查找不在特定表中的记录时。您可以通过这种方式将 RIGHT JOIN 表中的唯一标识符（永远不是 NULL）的引用添加到 WHERE 子句中`WHERE t2.idfield IS NULL`：因此，您应该引用连接右侧的表的唯一时间是查找那些不在表中的记录。* 

 ** * *

## 回答 #5

> 赞同：33
> 
> 时间：2008-12-09T20:20:19.087

在内部连接中，它们的含义相同。但是，根据您是否将连接条件放在 WHERE 与 ON 子句中，您将在外连接中得到不同的结果。看看[这个相关的问题](https://stackoverflow.com/questions/219046/help-with-a-where-on-a-left-join-sql-query)和[这个答案](https://stackoverflow.com/questions/219046/help-with-a-where-on-a-left-join-sql-query#219053)（由我）。

我认为养成始终将连接条件放在 ON 子句中的习惯是最有意义的（除非它是外连接并且您确实希望在 where 子句中使用它），因为它使阅读您的查询的任何人都更清楚连接表的条件是什么，它还有助于防止 WHERE 子句长达数十行。

* * *

## 回答 #6

> 赞同：28
> 
> 时间：2014-05-25T14:20:50.203

## 表关系

考虑到我们有以下`post`和`post_comment`表格：

[![post 和 post_comment 表](https://i.stack.imgur.com/YjnW7.png)](https://i.stack.imgur.com/YjnW7.png)

有以下`post`记录：

```
| id | title     |
|----|-----------|
| 1  | Java      |
| 2  | Hibernate |
| 3  | JPA       | 
```

并且`post_comment`具有以下三行：

```
| id | review    | post_id |
|----|-----------|---------|
| 1  | Good      | 1       |
| 2  | Excellent | 1       |
| 3  | Awesome   | 2       | 
```

## SQL 内连接

SQL JOIN 子句允许您关联属于不同表的行。例如，[CROSS JOIN](https://vladmihalcea.com/sql-cross-join/)将创建一个笛卡尔积，其中包含两个连接表之间所有可能的行组合。

虽然 CROSS JOIN 在某些情况下很有用，但大多数时候，您希望根据特定条件连接表。而且，这就是 INNER JOIN 发挥作用的地方。

SQL INNER JOIN 允许我们根据通过 ON 子句指定的条件过滤连接两个表的笛卡尔积。

## SQL INNER JOIN - 在“始终为真”条件下

如果您提供“始终为真”条件，则 INNER JOIN 不会过滤连接的记录，结果集将包含两个连接表的笛卡尔积。

例如，如果我们执行以下 SQL INNER JOIN 查询：

```
SELECT
   p.id AS "p.id",
   pc.id AS "pc.id"
FROM post p
INNER JOIN post_comment pc ON 1 = 1 
```

我们将得到所有的组合`post`和`post_comment`记录：

```
| p.id    | pc.id      |
|---------|------------|
| 1       | 1          |
| 1       | 2          |
| 1       | 3          |
| 2       | 1          |
| 2       | 2          |
| 2       | 3          |
| 3       | 1          |
| 3       | 2          |
| 3       | 3          | 
```

因此，如果 ON 子句条件为“始终为真”，则 INNER JOIN 就等同于 CROSS JOIN 查询：

```
SELECT
   p.id AS "p.id",
   pc.id AS "pc.id"
FROM post p
CROSS JOIN post_comment
WHERE 1 = 1
ORDER BY p.id, pc.id 
```

## SQL INNER JOIN - ON“总是假”条件

另一方面，如果 ON 子句条件为“始终为假”，则所有连接的记录都将被过滤掉，结果集将为空。

因此，如果我们执行以下 SQL INNER JOIN 查询：

```
SELECT
   p.id AS "p.id",
   pc.id AS "pc.id"
FROM post p
INNER JOIN post_comment pc ON 1 = 0
ORDER BY p.id, pc.id 
```

我们不会得到任何结果：

```
| p.id    | pc.id      |
|---------|------------| 
```

这是因为上面的查询等价于下面的 CROSS JOIN 查询：

```
SELECT
   p.id AS "p.id",
   pc.id AS "pc.id"
FROM post p
CROSS JOIN post_comment
WHERE 1 = 0
ORDER BY p.id, pc.id 
```

## SQL INNER JOIN - 使用外键和主键列的 ON 子句

最常见的 ON 子句条件是子表中的外键列与父表中的主键列匹配的条件，如以下查询所示：

```
SELECT
   p.id AS "p.id",
   pc.post_id AS "pc.post_id",
   pc.id AS "pc.id",
   p.title AS "p.title",
   pc.review  AS "pc.review"
FROM post p
INNER JOIN post_comment pc ON pc.post_id = p.id
ORDER BY p.id, pc.id 
```

在执行上述 SQL INNER JOIN 查询时，我们得到以下结果集：

```
| p.id    | pc.post_id | pc.id      | p.title    | pc.review |
|---------|------------|------------|------------|-----------|
| 1       | 1          | 1          | Java       | Good      |
| 1       | 1          | 2          | Java       | Excellent |
| 2       | 2          | 3          | Hibernate  | Awesome   | 
```

因此，只有符合 ON 子句条件的记录才会包含在查询结果集中。在我们的例子中，结果集包含所有`post`以及它们的`post_comment`记录。`post`没有关联的行`post_comment`被排除，因为它们不能满足 ON 子句条件。

同样，上面的 SQL INNER JOIN 查询等价于下面的 CROSS JOIN 查询：

```
SELECT
   p.id AS "p.id",
   pc.post_id AS "pc.post_id",
   pc.id AS "pc.id",
   p.title AS "p.title",
   pc.review  AS "pc.review"
FROM post p, post_comment pc
WHERE pc.post_id = p.id 
```

未命中的行是满足 WHERE 子句的行，只有这些记录才会包含在结果集中。这是可视化 INNER JOIN 子句如何工作的最佳方式。

```
| p.id | pc.post_id | pc.id | p.title | 电脑评论 |
|--------|------------|--------|-----------|--------- --|
| 1 | 1 | 1 | 爪哇 | 好 |
| 1 | 1 | 2 | 爪哇 | 优秀 |
| 1 | 2 | 3 | 爪哇 | 真棒| 
| 2 | 1 | 1 | 休眠 | 好 | 
| 2 | 1 | 2 | 休眠 | 优秀 |
| 2 | 2 | 3 | 休眠 | 真棒|
| 3 | 1 | 1 | JPA | 好 | 
| 3 | 1 | 2 | JPA | 优秀 | 
| 3 | 2 | 3 | JPA | 真棒|

```

## 结论

INNER JOIN 语句可以重写为 CROSS JOIN，其 WHERE 子句与您在 INNER JOIN 查询的 ON 子句中使用的条件匹配。

> 并不是说这仅适用于 INNER JOIN，不适用于 OUTER JOIN。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2016-03-13T06:31:29.217

当涉及到左连接时，***where 子句***与***on 子句***之间存在很大差异。

这是示例：

```
mysql> desc t1; 
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| id    | int(11)     | NO   |     | NULL    |       |
| fid   | int(11)     | NO   |     | NULL    |       |
| v     | varchar(20) | NO   |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+ 
```

fid 是表 t2 的 id。

```
mysql> desc t2;
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| id    | int(11)     | NO   |     | NULL    |       |
| v     | varchar(10) | NO   |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
2 rows in set (0.00 sec) 
```

**查询“on 子句”：**

```
mysql> SELECT * FROM `t1` left join t2 on fid = t2.id AND t1.v = 'K' 
    -> ;
+----+-----+---+------+------+
| id | fid | v | id   | v    |
+----+-----+---+------+------+
|  1 |   1 | H | NULL | NULL |
|  2 |   1 | B | NULL | NULL |
|  3 |   2 | H | NULL | NULL |
|  4 |   7 | K | NULL | NULL |
|  5 |   5 | L | NULL | NULL |
+----+-----+---+------+------+
5 rows in set (0.00 sec) 
```

**查询“where子句”：**

```
mysql> SELECT * FROM `t1` left join t2 on fid = t2.id where t1.v = 'K';
+----+-----+---+------+------+
| id | fid | v | id   | v    |
+----+-----+---+------+------+
|  4 |   7 | K | NULL | NULL |
+----+-----+---+------+------+
1 row in set (0.00 sec) 
```

很明显，第一个查询返回来自 t1 的记录和来自 t2 的相关行，如果有的话，对于行 t1.v = 'K'。

第二个查询从 t1 返回行，但仅对于 t1.v = 'K' 将有任何关联的行。

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2019-04-12T10:03:00.340

让我们考虑这些表：

一种

```
id | SomeData 
```

乙

```
id | id_A | SomeOtherData 
```

`id_A`作为表的外键`A`

编写此查询：

```
SELECT *
FROM A
LEFT JOIN B
ON A.id = B.id_A; 
```

将提供此结果：

```
/ : part of the result
                                       B
                      +---------------------------------+
            A         |                                 |
+---------------------+-------+                         |
|/////////////////////|///////|                         |
|/////////////////////|///////|                         |
|/////////////////////|///////|                         |
|/////////////////////|///////|                         |
|/////////////////////+-------+-------------------------+
|/////////////////////////////|
+-----------------------------+ 
```

在 A 中但不在 B 中的内容意味着 B 存在空值。

* * *

现在，让我们考虑 中的特定部分`B.id_A`，并从之前的结果中突出显示它：

```
/ : part of the result
* : part of the result with the specific B.id_A
                                       B
                      +---------------------------------+
            A         |                                 |
+---------------------+-------+                         |
|/////////////////////|///////|                         |
|/////////////////////|///////|                         |
|/////////////////////+---+///|                         |
|/////////////////////|***|///|                         |
|/////////////////////+---+---+-------------------------+
|/////////////////////////////|
+-----------------------------+ 
```

* * *

编写此查询：

```
SELECT *
FROM A
LEFT JOIN B
ON A.id = B.id_A
AND B.id_A = SpecificPart; 
```

将提供此结果：

```
/ : part of the result
* : part of the result with the specific B.id_A
                                       B
                      +---------------------------------+
            A         |                                 |
+---------------------+-------+                         |
|/////////////////////|       |                         |
|/////////////////////|       |                         |
|/////////////////////+---+   |                         |
|/////////////////////|***|   |                         |
|/////////////////////+---+---+-------------------------+
|/////////////////////////////|
+-----------------------------+ 
```

因为这会在内部联接中删除不在其中的值`B.id_A = SpecificPart`

* * *

现在，让我们将查询更改为：

```
SELECT *
FROM A
LEFT JOIN B
ON A.id = B.id_A
WHERE B.id_A = SpecificPart; 
```

结果现在是：

```
/ : part of the result
* : part of the result with the specific B.id_A
                                       B
                      +---------------------------------+
            A         |                                 |
+---------------------+-------+                         |
|                     |       |                         |
|                     |       |                         |
|                     +---+   |                         |
|                     |***|   |                         |
|                     +---+---+-------------------------+
|                             |
+-----------------------------+ 
```

因为整个结果都被过滤掉了`B.id_A = SpecificPart`，`B.id_A IS NULL`所以在*A 中没有在 B 中的部分*

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2008-12-09T20:21:36.713

就优化器而言，是否使用 ON 或 WHERE 定义连接子句应该没有区别。

但是，恕我直言，我认为在执行连接时使用 ON 子句要清楚得多。这样，您就有了查询的特定部分，该部分指示如何处理连接，而不是与其余的 WHERE 子句混合。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2019-04-29T23:17:48.683

您是要加入数据还是过滤数据？

为了可读性，将这些用例分别隔离到 ON 和 WHERE 是最有意义的。

*   在 ON 中加入数据
*   在 WHERE 中过滤数据

读取 WHERE 子句中存在 JOIN 条件和过滤条件的查询会变得非常困难。

性能方面您应该看不到差异，尽管不同类型的 SQL 有时会以不同方式处理查询计划，因此值得尝试`¯\_(ツ)_/¯`（请注意缓存会影响查询速度）

同样正如其他人所指出的，如果您使用外连接，如果您将过滤条件放在 ON 子句中，则会得到不同的结果，因为它只影响其中一个表。

我在这里写了一篇更深入的文章： [https ://dataschool.com/learn/difference-between-where-and-on-in-sql](https://dataschool.com/learn/difference-between-where-and-on-in-sql)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-02-05T10:57:46.477

在 SQL 中，'WHERE' 和 'ON' 子句是一种条件语句，但它们之间的主要区别是，'Where' 子句在 Select/Update 语句中用于指定条件，而 'ON' 子句用于联接，在联接表之前验证或检查目标表和源表中的记录是否匹配

**例如： - 'WHERE'**

```
SELECT * FROM employee WHERE employee_id=101 
```

**例如： - '开'**

*有两个表employee 和employee_details，匹配的列是employee_id。*

```
SELECT * FROM employee 
INNER JOIN employee_details 
ON employee.employee_id = employee_details.employee_id 
```

希望我已经回答了你的问题。恢复任何澄清。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-01-07T03:49:04.017

我认为这是连接序列效应。在左上连接的情况下，SQL 先做左连接，再做 where 过滤。在较弱的情况下，先找到 Orders.ID=12345，然后再加入。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-05-16T22:40:07.833

对于内部连接，`WHERE`可以`ON`互换使用。事实上，可以`ON`在相关子查询中使用。例如：

```
update mytable
set myscore=100
where exists (
select 1 from table1
inner join table2
on (table2.key = mytable.key)
inner join table3
on (table3.key = table2.key and table3.key = table1.key)
...
) 
```

这（恕我直言）对人类来说是完全混乱的，而且很容易忘记链接`table1`到任何东西（因为“驱动程序”表没有“开”子句），但它是合法的。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-12-12T21:10:14.643

为了获得更好的性能，表应该有一个特殊的索引列用于 JOINS 。

因此，如果您条件的列不是那些索引列之一，那么我怀疑最好将其保留在 WHERE 中。

所以你 JOIN 使用索引列，然后在 JOIN 之后在无索引列上运行条件。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-02-16T05:29:45.450

通常，一旦两个表已经连接，过滤就会在 WHERE 子句中处理。有可能，但您可能希望在加入其中一个或两个表之前对其进行过滤。即，where 子句适用于整个结果集，而 on 子句仅适用于相关连接。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-04-09T13:37:42.380

[*我认为这种区别可以通过SQL 中操作的逻辑顺序*](https://blog.jooq.org/2016/12/09/a-beginners-guide-to-the-true-order-of-sql-operations/)来最好地解释，即简化：

*   `FROM`（包括连接）
*   `WHERE`
*   `GROUP BY`
*   聚合
*   `HAVING`
*   `WINDOW`
*   `SELECT`
*   `DISTINCT`
*   `UNION`, `INTERSECT`,`EXCEPT`
*   `ORDER BY`
*   `OFFSET`
*   `FETCH`

连接不是 select 语句的子句，而是`FROM`. 因此，在逻辑处理到达子句时，`ON`属于相应运算符的所有子句在*逻辑上*`JOIN`“已经发生” 。这意味着在 a 的情况下，例如，在应用子句时，外连接的语义已经发生。*`WHERE``LEFT JOIN``WHERE`*

 *[我在这篇博文中更深入地解释了以下示例](https://blog.jooq.org/2019/04/09/the-difference-between-sqls-join-on-clause-and-the-where-clause/)。运行此查询时：

```
SELECT a.actor_id, a.first_name, a.last_name, count(fa.film_id)
FROM actor a
LEFT JOIN film_actor fa ON a.actor_id = fa.actor_id
WHERE film_id < 10
GROUP BY a.actor_id, a.first_name, a.last_name
ORDER BY count(fa.film_id) ASC; 
```

`LEFT JOIN`确实没有任何有用的效果，因为即使演员没有在电影中演出，演员也会被过滤，因为它会`FILM_ID`被过滤，`NULL`并且`WHERE`子句会过滤这样的一行。结果是这样的：

```
ACTOR_ID  FIRST_NAME  LAST_NAME  COUNT
--------------------------------------
194       MERYL       ALLEN      1
198       MARY        KEITEL     1
30        SANDRA      PECK       1
85        MINNIE      ZELLWEGER  1
123       JULIANNE    DENCH      1 
```

即就像我们在内部加入了两个表一样。如果我们在`ON`子句中移动过滤谓词，它现在成为外连接的条件：

```
SELECT a.actor_id, a.first_name, a.last_name, count(fa.film_id)
FROM actor a
LEFT JOIN film_actor fa ON a.actor_id = fa.actor_id
  AND film_id < 10
GROUP BY a.actor_id, a.first_name, a.last_name
ORDER BY count(fa.film_id) ASC; 
```

这意味着结果将包含没有任何电影的演员，或者没有任何电影`FILM_ID < 10`

```
ACTOR_ID  FIRST_NAME  LAST_NAME     COUNT
-----------------------------------------
3         ED          CHASE         0
4         JENNIFER    DAVIS         0
5         JOHNNY      LOLLOBRIGIDA  0
6         BETTE       NICHOLSON     0
...
1         PENELOPE    GUINESS       1
200       THORA       TEMPLE        1
2         NICK        WAHLBERG      1
198       MARY        KEITEL        1 
```

### 简而言之

总是把你的谓词放在最合乎逻辑的地方。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-11-14T17:42:25.397

从字面上看，它们**是等价的。**

在大多数开源数据库中（最著名的例子，在*MySql*和*postgresql*中），查询计划是出现在*关系数据库管理系统中的访问路径选择中的经典算法的变体（Selinger 等人，1979 年）*。在这种方法中，条件有两种类型

*   引用单个表的条件（用于过滤）
*   引用两个表的条​​件（视为*连接条件*，无论*它们出现在哪里*）

特别是在 MySql 中，您可以通过跟踪优化器*看到自己*`join .. on`的条件*在解析过程中*被等效`where`条件替换。在 postgresql 中也会发生类似的事情（虽然无法通过日志查看，但您必须阅读源描述）。

无论如何，重点是，两种语法变体之间的差异在解析/查询重写阶段*丢失*了，甚至没有到达查询计划和执行阶段。因此，毫无疑问它们在性能方面是否相同，**它们在到达执行阶段之前就变得相同了**。

您可以使用`explain`, 来验证它们是否产生相同的计划。例如，在 postgres 中，**计划将包含一个`join`子句，即使您没有在`join..on`任何地方使用该语法**。

> Oracle 和 SQL Server 不是开源的，但据我所知，它们是基于等价规则的（类似于关系代数中的规则），并且它们在两种情况下也产生相同的执行计划。

> 显然，这两种语法风格对于外连接来说*是不*等价的，对于那些你必须使用`join ... on`语法的人

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-01-21T13:23:37.043

关于你的问题，

只要您的服务器可以获取它，内部连接上的“on”或“where”都是相同的：

```
select * from a inner join b on a.c = b.c 
```

和

```
select * from a inner join b where a.c = b.c 
```

并非所有口译员都知道的“where”选项，因此可能应该避免使用。当然，“on”子句更加清晰。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-06-09T01:44:34.183

为了添加到 Joel Coehoorn 的响应中，我将添加一些特定于 sqlite 的优化信息（其他 SQL 风格可能表现不同）。在原始示例中，左连接具有不同的结果，具体取决于您使用`JOIN ON ... WHERE`或`JOIN ON ... AND`。这是一个稍微修改的示例来说明：

```
SELECT *
FROM Orders
LEFT JOIN OrderLines ON Orders.ID = OrderLines.OrderID
    WHERE Orders.Username = OrderLines.Username 
```

相对

```
SELECT *
FROM Orders
LEFT JOIN OrderLines ON Orders.ID = OrderLines.OrderID 
    AND Orders.Username = OrderLines.Username 
```

现在，原始答案指出，如果您使用普通内连接而不是左连接，则两个查询的结果将相同，但执行计划会有所不同。我最近意识到两者之间的语义差异在于前者*强制*查询优化器使用与子句关联的索引`ON`，而后者允许优化器选择`ON ... AND`子句中的任何索引，这取决于它认为最适合的方式。

有时，优化器会猜错，您会想要强制执行某个执行计划。在这种情况下，假设 SQLite 优化器错误地得出执行此连接的最快方法是使用索引 on 的结论，而`Orders.Username`您从经验测试中知道索引 on`Orders.ID`会更快地传递您的查询。

在这种情况下，前一种`JOIN ON ... WHERE`语法本质上允许您*强制*对参数进行主连接操作，只有在主连接完成后才执行`ID`辅助过滤。`Username`相比之下，`JOIN ON ... AND`语法允许优化器选择是否在`Orders.ID`or上使用索引`Orders.Username`，理论上它可能会选择最终速度较慢的那个。

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2021-06-06T15:17:45.923

一种。WHERE 子句：加入后，会过滤记录。

湾。ON 子句 - 在加入之前，将过滤记录（来自右表）。

* * *

## 回答 #21

> 赞同：-5
> 
> 时间：2010-04-26T07:53:50.890

这是我的解决方案。

```
SELECT song_ID,songs.fullname, singers.fullname
FROM music JOIN songs ON songs.ID = music.song_ID  
JOIN singers ON singers.ID = music.singer_ID
GROUP BY songs.fullname 
```

你*必须拥有*它`GROUP BY`才能让它工作。

希望这有帮助。

# maven-2 - 可用的 Maven 配置文件

> ID：354081
> 
> 赞同：2
> 
> 时间：2008-12-09T20:18:34.033
> 
> 标签：maven-2, profile

是否有一种简单的方法可以确定（最好是从命令行）可用于特定项目的配置文件。我有一个大型的多模块项目，我正在努力解决。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-09T22:08:35.733

[leeand00](https://stackoverflow.com/questions/354081/available-maven-profiles#354360)让我走上了正确的道路。我正在寻找的是[帮助：所有配置文件](http://maven.apache.org/plugins/maven-help-plugin/all-profiles-mojo.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T21:50:44.223

[http://maven.apache.org/guides/introduction/introduction-to-profiles.html](http://maven.apache.org/guides/introduction/introduction-to-profiles.html)

查看标题： **如何判断哪些配置文件在构建期间有效？**

另一种方法是使用 grep 或 XPath 搜索所有节点。

在 xpath 中，它将是 [code]\profile\id[/code]

在 grep 中，它变得更加冒险，因为您必须假设标签位于标签后面的行上。

# resources - 您还去哪些其他网站解决编码问题？

> ID：354082
> 
> 赞同：-4
> 
> 时间：2008-12-09T20:18:44.067
> 
> 标签：resources, reference

这个网站很好，但我想知道还有什么其他资源。我想这可能与语言有关，但总的来说，我还没有找到任何其他具有丰富的一般编程知识的网站，我可以在其中发布问题并且有人会实际回答。特别是当您发布某种跨越多种技术的问题或问题时。此外，我无法告诉你有多少次有人问过与我相同（或非常相似）的问题，我找到了一个谷歌链接，指向那个该死的“专家交流”网站，他们隐藏了答案。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-09T20:26:54.440

通常，谷歌。我正在寻找的 95% 的内容通常以前都被问过。我最终登陆了各种博客。我从来没有意识到有多少开发博客真的在那里。我以前更喜欢 Usenet 来提问和回答，但这只是显示我的年龄。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-09T20:23:24.057

一般是codeproject，或者只是简单的谷歌搜索。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-09T20:24:58.360

[http://www.google.com](http://www.google.com)和这个。StackOverflow 已被证明是我的武器库中的一个很好的工具。开始了一份新工作（主要从事数据库方面的工作），我开始依赖这个网站，但谷歌是我经常使用的另一个网站。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-09T20:28:45.560

对于 dotNet 问题，您无法击败[http://www.searchdotnet.com/default.aspx](http://www.searchdotnet.com/default.aspx) 由 Dan Appleman 维护的自定义 google 搜索。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-09T20:22:30.797

SQLServerCentral 非常适合 DB 的东西

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-09T20:27:39.790

当我第一次开始开发 FF 扩展时，我大量使用（虽然主要是作为一个潜伏者）[Mozillazine 论坛](http://forums.mozillazine.org/)。伟大的人，伟大的知识。

关于专家交流，我不想说显而易见的，但只要你来自谷歌，他们的答案就一直在页面底部。这就是您所说的“隐藏答案”，对吗？我相信 Chrome 并没有那样工作，但他们现在似乎也认出了 Chrome 的用户代理。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-09T20:29:21.470

我倾向于不在网站上问很多问题，但我会在 Code Project 上回答它们。那是一个非常好的网站，我的一些其他 CP 朋友来这里回答问题 - 事实上，他们是让我首先进入 SO 的人。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-09T20:30:36.647

[谷歌代码搜索](http://google.com/codesearch)通常很有用。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-09T21:42:31.587

我几乎总是从谷歌开始。有时我直接去代码项目。他们倾向于提供带有示例代码的冗长教程。当我刚接触 ASP 和 ASP.NET 时，我使用了[http://www.4guysfromrolla.com/](http://www.4guysfromrolla.com/)，但我不再需要它了。但这些对我有用，只是因为我想问的问题已经（被其他人）问过并且（幸运地）也得到了回答。

我对新闻组的运气并不好，主要是因为发帖量太高，除非你的问题在最初的几个小时内得到回答，否则它很快就会被推到没有人再看到它的地方。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-09T21:52:53.283

我不时使用[专家交流。](http://www.experts-exchange.com)不要让网站欺骗您，个人帐户是免费的。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-09T21:59:01.150

老实说，堆栈溢出。除此之外，无论谷歌带我去哪里。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-08-31T07:32:35.277

我在进行网络搜索时经常遇到专家交流，并且在发生这种情况时通常会用粗话吓唬同事。但是，这是我使用的一个技巧：

为 Firefox 安装 Web 开发人员（插件）。当您运气不好需要专家交流的答案时，请完全禁用 CSS。他们使用 CSS 来隐藏答案，禁用它会给你一些纯文本。如果有问题，您可以搜索“已接受的解决方案”来解决问题。

顺便说一句，我非常高兴支持 SO，因为采用完全不同的方法使问答和知识可访问且免费。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-09T20:27:52.923

Google、Google Code Search 和“Google Groups”、Clusty 在结果太多时缩小范围，有时 Yahoo 可以找到其他或更新的结果。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-09T21:48:28.517

[http://www.tek-tips.com/index.cfm](http://www.tek-tips.com/index.cfm)

[http://lessthandot.com/](http://lessthandot.com/)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-09T22:06:39.200

我是一名 .Net 开发人员，这里列出了一些我经常用来获取编码信息的网站。

**论坛**

[http://stackoverflow.com](http://stackoverflow.com)

[http://forums.asp.net/](http://forums.asp.net/)

[http://forums.msdn.microsoft.com/](http://forums.msdn.microsoft.com/)

**代码示例和信息**

[http://www.codeproject.com](http://www.codeproject.com)

[http://www.searchdotnet.com](http://www.searchdotnet.com)

[http://www.w3schools.com/](http://www.w3schools.com/)

[http://www.codeplex.com/](http://www.codeplex.com/)

[http://code.msdn.microsoft.com/](http://code.msdn.microsoft.com/)

[http://channel9.msdn.com/](http://channel9.msdn.com/)

[http://www.dnrtv.com/](http://www.dnrtv.com/)

[http://www.asp.net/ajax/](http://www.asp.net/ajax/)

**杂志：**

[http://msdn.microsoft.com/magazine/default.aspx](http://msdn.microsoft.com/magazine/default.aspx)

[http://www.code-magazine.com/](http://www.code-magazine.com/)

**博客：**

[http://weblogs.asp.net/Scottgu/](http://weblogs.asp.net/Scottgu/)

[http://www.hanselman.com/blog/](http://www.hanselman.com/blog/)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-09T22:11:18.910

我发现使用您正在使用的工具的邮件列表很有帮助（如果您的问题是针对特定工具的）。邮件列表往往有一个直接参与该工具的社区，并且通常也会从工具开发人员自己那里获得回复，这非常有用。

邮件列表通常也会在网络上编入索引，因此您不必订阅。[Nabble](http://www.nabble.com/)就是这样的索引站点之一。

# silverlight - Silverlight - listbox.ItemTemplate 的动态绑定

> ID：354087
> 
> 赞同：3
> 
> 时间：2008-12-09T20:19:47.403
> 
> 标签：silverlight, binding

我有这个：

```
<ListBox x:Name="PART_lstAttributes" Grid.Row="1" Style="{StaticResource GlossyBlackListBox}">
  <ListBox.ItemTemplate>
    <DataTemplate>
       <StackPanel>
          <TextBlock x:Name="txtAttributeName" Text="{Binding AttributeName}"></TextBlock>
       </StackPanel>
    </DataTemplate>                                
  </ListBox.ItemTemplate>
</ListBox> 
```

请注意，这个绑定到我的集合的“AttributeName”属性。我想做的是以编程方式将“AttributeName”更改为其他内容。这可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T06:08:39.570

以下解决方案将在没有属性显式绑定的情况下工作，假设您的数据项是一个字符串或启用 ToString。

```
 <DataTemplate>
   <StackPanel>
      <TextBlock x:Name="txtAttributeName" Text="{Binding}"></TextBlock>
   </StackPanel>
</DataTemplate> 
```

# python - 如何配置vim在编辑python文件时不在行首添加注释

> ID：354097
> 
> 赞同：53
> 
> 时间：2008-12-09T20:21:40.597
> 
> 标签：python, vim

当我在编辑 python 文件时在 Vim 的空行上以插入模式添加 # 时，vim 将 # 移动到行的开头，但我希望将 # 插入到我输入它的选项卡级别。

例如，在 vim 中编写时

```
for i in range(10):
    # 
```

# 不会留在我输入的位置。

它像这样被 vim 移动。

```
for i in range(10):
# 
```

有谁知道 vim 中的配置项会改变这一点？

如果有帮助，我正在使用 Ubuntu 8.10。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-09T22:07:18.463

我在这里找到了答案[http://vim.wikia.com/wiki/Restoring_indent_after_typing_hash](http://vim.wikia.com/wiki/Restoring_indent_after_typing_hash)

似乎 vim smartindent 选项是问题的原因。上面引用的页面描述了工作轮次，但在阅读了 vim 本身的 smartindent 中的帮助 (:help smartindent) 之后，我决定尝试使用 cindent 而不是 smartindent。

我换了

```
set smartindent 
```

和

```
set cindent 
```

在我的 .vimrc 文件中

到目前为止，它运行良好。

此更改还修复了 '<<' 和 '>>' 用于缩进包含 python 注释的可视块的行为。

在 smartindent 和 cindent (:help smartindent 和 :help cindent) 的 vim 帮助中有更多关于缩进的配置选项和信息。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-04-22T14:07:40.117

@PolyThinker 虽然我看到很多对这个问题的回答，但在我看来这不是一个好的解决方案。编辑器仍然认为它应该一直向左缩进 - 通过在以哈希开头的行上推 == 来检查这一点，或者推 = 同时突出显示带有注释的代码块以重新缩进。

我强烈推荐, 并从你的 vimrc`filetype indent on`中删除`set smartindent`and `set autoindent`(or ) 行。`set cindent`其他人（显然是 David Bustos）为我们编写了一个完整的缩进解析器。它位于 $VIMDIRECTORY/indent/python.vim。

（Paul 的`cindent`解决方案可能适用于 python，但`filetype indent on`更普遍有用。）

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-12-22T07:27:50.633

我的 .vimrc 中有以下几行，似乎默认安装在我的 Ubuntu 8.10 中

```
set smartindent
inoremap # X^H#
set autoindent 
```

而且我没有观察到这个问题。也许你可以试试这个。（注意^H要按Ctrl-V Ctrl-H输入）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-05-15T15:57:17.883

我对 # 取消缩进的解决方案：

如果您使用 cindent，请认识到它是为 C 和 C++ 编码而设计的。在这里，# 表示您正在创建 #DEFINE 或 #MACRO()，因此行为是正确的。但是对于其他 # 是注释的语言，这很烦人。

以下对我有用：

```
" cindent       enable specific indenting for C code
" set cin       nocin
set cin

" cinkeys       The default cinkeys causes leading # to unindent to column 0.
"               To prevent this, remove the 0# from the definition.
" set cinkeys=0{,0},0),:,0#,!^F,o,O,e - default
set cinkeys=0{,0},0),:,!^F,o,O,e 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-22T02:13:59.847

这是由“智能”功能引起的。如果你`:set smartindent`的 .vimrc 中有你需要删除它。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-09-20T05:07:08.137

其他一些答案很有用，但没有一个足以阻止 Vim 在 '#' 是第一个字符时重新缩进一行。PolyThinker 的回答对我不起作用，但它提供了一个线索，即“#”可以重新映射为“插入一个字符，然后 #，然后删除多余的字符并将光标放在它应该在的位置”。这是执行此操作的映射：

```
inoremap # X#<left><backspace><right> 
```

这是必需的，因为无论选项如何设置，vim 的语法包似乎都将 '#' 视为特殊字符。我希望以“#”开头的行与以任何其他字符开头的行相同。我找到的最可靠的解决方案是上面的映射，它实际上确实改变了行的第一个字符。

Note: I've found this mapping causes problems after running `I#<esc>` then pressing "." to redo the previous insertion. I haven't found a solution yet.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-09T21:18:38.047

我的 Vim 配置没有这样做。你可以试试这个链接提供的 python.vim 脚本：http: [//www.vim.org/scripts/script.php? script_id=790](http://www.vim.org/scripts/script.php?script_id=790)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-06-04T18:38:23.800

我删除`set smartindent`了，`~/.vimrc`但它仍然没有禁用 smartindent。当我打开一个 .py 文件并运行`:set smartindent?`它时，显示`smartindent`.

事实证明，在`~/.vimrc`这条线的更下方：

```
autocmd BufRead *.py set smartindent cinwords=if,elif,else,for,while,try,except,finally,def,class
                         ^^^^^^^^^^^ 
```

一旦我从该行中删除了“smartindent”，然后 smartindent 最终被禁用，我的评论再次正确缩进。

# javascript - indexOf() 和 search() 有什么区别？

> ID：354110
> 
> 赞同：197
> 
> 时间：2008-12-09T20:25:00.323
> 
> 标签：javascript, string

作为 JavaScript 的新手，我无法辨别何时使用其中的每一个。

谁能帮我澄清一下？

* * *

## 回答 #1

> 赞同：227
> 
> 时间：2008-12-09T20:29:29.380

如果您需要正则表达式，请使用`search()`. 否则，`indexOf()`会更快。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2008-12-09T20:28:40.503

[`indexOf`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/indexOf)用于普通子字符串，[`search`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/search)用于正则表达式。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-12-09T20:31:40.497

搜索功能（[这里的一个描述](http://www.tizag.com/javascriptT/javascript-string-search.php)）采用正则表达式，它允许您匹配更复杂的模式、不区分大小写的字符串等，而 indexOf（[这里的一个描述](http://www.tizag.com/javascriptT/javascript-string-indexOf.php)）只匹配文字字符串。但是， indexOf 也允许您指定起始索引。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2019-04-22T12:15:44.210

**indexOf() 和 search()**

*   **两者共同**

    i) 返回第一次出现的搜索值

    ii) 如果未找到匹配项，则返回 -1

    ```
    let str='Book is booked for delivery'
    str.indexOf('b')   // returns position 8
    str.search('b')    // returns position 8 
    ```

* * *

*   **特殊的 indexOf()**

    i）您可以将起始搜索位置作为第二个参数

    ```
    str.indexOf('k')   // 3
    str.indexOf('k',4) // 11 (it start search from 4th position) 
    ```

* * *

*   **在 search() 中特别**

搜索值可以是正则表达式

```
str.search('book') // 8
str.search(/book/i)  // 0   ( /i =case-insensitive   (Book == book) 
```

[参考](https://www.w3schools.com/jsref/jsref_search.asp)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-12-09T20:30:09.143

我认为主要区别在于搜索接受正则表达式。

检查此参考：

*   [搜索](http://www.w3schools.com/jsref/jsref_search.asp)
*   [指数](http://www.w3schools.com/jsref/jsref_indexof.asp)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-09-05T14:20:54.940

IndexOf() - 它接受字符串文字或字符串对象，但**不**接受正则表达式。它还接受一个从零开始的整数值来开始搜索，例如：

1.  "babyelephant".indexOf("e"); // 给你 4
2.  "babyelephant".indexOf("e",5); // 当搜索从第 6 个位置或第 5 个索引开始时，给你 6。
3.  var m= /e/; “小象”.indexOf(m); //给出-1，因为它不接受正则表达式。

Search() - 接受字符串文字或字符串对象和正则表达式。但它不接受开始搜索的索引。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-09T20:32:53.227

搜索发现它与正则表达式匹配，但没有偏移量。IndexOf 使用文字进行匹配，但有一个偏移量。

[指数](http://www.tizag.com/javascriptT/javascript-string-indexOf.php)

[搜索](http://www.tizag.com/javascriptT/javascript-string-search.php)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2015-12-15T07:02:38.847

如果没有[正则表达式，则](http://www.w3schools.com/js/js_regexp.asp)[indexOf](http://www.w3schools.com/jsref/jsref_indexof.asp)和[search](http://www.w3schools.com/jsref/jsref_search.asp)之间没有实际区别。

下面的例子给出了一个现场[演示](http://jsfiddle.net/xameeramir/e6q1679k/)：

```
function FromSearch() {

  var str = document.getElementById("demo").innerText;
  var n = str.search("difference");
  document.getElementById("Location").innerHTML = n;
}

function FromindexOf() {
  var str = document.getElementById("demo").innerText;
  var n = str.indexOf("difference");
  document.getElementById("Location").innerHTML = n;
}
```

```
<p id="demo">Without a <a href='http://www.w3schools.com/js/js_regexp.asp'>regex</a>, there is no practical difference between <a href='http://www.w3schools.com/jsref/jsref_indexof.asp'>indexOf</a> and <a href='http://www.w3schools.com/jsref/jsref_search.asp'>search</a>
</p>

<button onclick="FromSearch()">From search</button>

<button onclick="FromindexOf()">From indexOf</button>

<p>Location of difference in the above sentence is:</p>

<mark id="Location"></mark>
```

# c# - 如何在分布式 .Net 应用程序中一次只能让一个用户访问资源（屏幕）？

> ID：354113
> 
> 赞同：1
> 
> 时间：2008-12-09T20:26:16.953
> 
> 标签：c#, .net, concurrency, distributed-lock

我有一个基于客户端服务器的 Windows 窗体应用程序，它只需要管理员屏幕。管理员功能需要以这样一种方式实现，即在任何给定时间只有一个管理员可以访问该屏幕。Windows 窗体客户端应用程序使用 .NET Remoting 与服务器对话。并且服务器端分布在多台机器上。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T20:31:29.110

这可以通过使用数据库表最容易地完成。通常，数据库已经具有容错性，并且是用于共享锁方案的安全资源。只需有一个锁定表，其中包含有关锁定资源的一些信息，谁拥有它，何时等。

您还可以使用市场上的各种“状态服务器”之一来存储锁定状态。但是，这会引入一个故障点，除非您投资于一种较新的分布式状态技术。

但是，您确实在为进一步的问题做好准备。您需要一个屏幕来允许强制解锁、查看谁拥有锁等。您最好看看为什么真的需要这个锁。是技术需求还是业务需求？您可以更轻松、更干净地实现悲观数据更新方案，从而改善用户体验。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T20:33:35.703

您需要在服务器上维护一个静态成员，以指示窗口当前是否正在使用中。**在设置值时使用lock()**函数确保它是线程安全的。然后，您可以在显示管理屏幕之前检查该值。

就服务器端而言，您提到它存在于多台 PC 上。这是一种作为一个虚拟服务器运行的负载平衡拓扑吗？如果是这样，您可能需要将值保存在数据库中。以与 ASP.Net 保持**Session State**相同的方式来考虑它。我可以存在于服务器上，但如果有服务器场，它可以移动到 SQL Server 以供所有服务器使用。

# c# - 泛型的默认值

> ID：354136
> 
> 赞同：18
> 
> 时间：2008-12-09T20:32:41.243
> 
> 标签：c#, .net, vb.net, generics

如何在 VB 中为泛型创建默认值？在 C# 中我可以调用：

```
T variable = default(T); 
```

1.  我如何在VB中做到这一点？
2.  如果这只是返回 null (C#) 或什么都没有 (vb) 那么值类型会发生什么？
3.  有没有办法为自定义类型指定默认值是什么？例如，如果我希望默认值等同于在我的类上调用无参数构造函数怎么办。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-12-09T20:34:18.073

## 问题一：

```
Dim variable As T
' or '
Dim variable As T = Nothing
' or '
Dim variable As New T() 
```

请注意，后者仅在您`Structure`为泛型类型指定约束时才有效（对于引用类型，`New T()`在 VB 中执行的操作与`default(T)`在 C# 中不同）。

## 问题2：

对于值类型，结构的所有成员都被“清空”，即所有引用类型成员都设置为`null`( `Nothing`)，而所有值类型又被清空。

不，因为`string`是引用类型，它不会*导致*其他`""`答案中建议的字符串。

## 问题 3：

不，没有办法指定这一点。Stack Overflow 上已经有一些关于此的主题，例如[这里](https://stackoverflow.com/questions/333829/why-cant-i-define-a-default-constructor-for-a-struct-in-net)。乔恩发布了一个[很好的解释](https://stackoverflow.com/questions/333829/why-cant-i-define-a-default-constructor-for-a-struct-in-net#333840)为什么会这样。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-12-18T16:14:08.217

实际上，人们这样做的正确方法是将`null`( `Nothing`) 类型转换为您的泛型类型，如下所示：

```
Dim tmpObj As T = CType(Nothing, T) 
```

如果要返回泛型的默认值，只需返回`CType(Nothing, T)`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T21:12:33.833

不是真正的 VB 人，我在康拉德让我直截了当的原始答案中犯了一些错误。原始答案如下，但我想根据 Konrad 的输入更新我的答案以使其正确。

正如 Konrad 所说，`default(T)`实际上`Nothing`对于值类型和引用类型都是等价的。正确的 VB 代码应如下所示，在这种情况下，您将获得与我在 C# 代码中获得的完全相同的行为：

```
Function ReturnSomething(Of T)() As T
    Return Nothing
End Function

Function DoSomething(Of T)()
    Dim x as T = Nothing;
    If x = Nothing Then
        Console.WriteLine("x is default.")
    Else
        Console.WriteLine("x has a value.")
    End If 
```

* * *

## 原始（错误）答案

看起来没有 VB 等价于`default(T)`. 但是根据[这篇文章](http://blog.somecreativity.com/2008/04/16/on-assigning-null-to-value-types-in-vbnet/)，与 C# 不同，if`T`是值类型，在 VB 中，您仍然可以使用`Nothing`在大多数情况下语义相同的值。

如果您需要在代码中测试它，那么您在`Nothing`使用通常使用的地方会遇到问题的大地方是。`default(T)`考虑以下 C# 代码：

```
T ReturnSomething<T>()
{
    return default(T);
}

void DoSomething<T>()
{
    T x = default(T);
    if(x == default(T))
        Console.WriteLine("x is default.");
    else
        Console.WriteLine("x has a value.");
} 
```

像这样翻译成VB：

```
Function ReturnSomething(Of T)() As T
    Return Nothing
End Function

Function DoSomething(Of T)()
    Dim x as T = Nothing;
    If x Is Nothing Then
        Console.WriteLine("x is default.")
    Else
        Console.WriteLine("x has a value.")
    End If
End Function 
```

如果是引用类型，则两个版本对和`T`的行为完全相同。但是，如果是一个值类型，对于任何一种语言都将完全一样，但会打印“x 是默认值”。在 C# 版本中，但“x 有值”。在 VB 版本中。`ReturnSomething``DoSomething``T``ReturnSomething``DoSomething`

# javascript - 检测窗口中呈现的 div 以实现类似 Google-Reader 的自动标记为已读？

> ID：354139
> 
> 赞同：11
> 
> 时间：2008-12-09T20:33:44.847
> 
> 标签：javascript, jquery, scroll

当使用 Google Reader 并在“扩展”视图中浏览 RSS 条目时，一旦在屏幕上显示了一定百分比的 div，条目将自动标记为“已读”（在谷歌读者）。因此，当我逐行向下滚动时，javascript 代码可以确定 a) 条目正在可见窗口中呈现 b) 一定数量是可见的，当满足这些条件时，状态切换为读取.

有谁知道该功能是如何实现的？具体来说，这里有没有人知道如何判断一个 div 是否已经滚动到视图中，以及有多少 div 是可见的？

顺便说一句，我正在使用 jQuery，所以如果有人有任何 jQuery 特定的示例，他们将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-15T04:51:44.450

真正的诀窍是跟踪滚动条在包含您的项目的元素中的位置。这是我曾经编写的一些代码：http: [//pastebin.com/f4a329cd9](http://pastebin.com/f4a329cd9)

您可以看到，当您滚动它时，它会改变焦点。您只需要向处理每个焦点更改的函数添加更多处理程序代码。它可以双向滚动，也可以通过在滚动条上单击鼠标右键，简单的鼠标跟踪不会给你（尽管在这种情况下，因为示例元素都是相同的大小，具有相同的文本，很难说它确实滚动了）。另一个问题是当容器触底时该怎么办。我现在的解决方案只适用于FF。如果你想让它在 IE 中看起来不错，你将不得不使用一个与背景融为一体的虚拟元素，就像我在代码中注释掉的那个一样。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-28T06:53:12.633

我刚遇到这个，因为我需要同样的东西，它看起来非常有用：

[http://www.appelsiini.net/projects/viewport](http://www.appelsiini.net/projects/viewport)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T20:43:11.613

根据我的经验，只有当我将鼠标悬停或单击时，Reader 才会将某些内容标记为已读。假设当您滚动时，您的鼠标位于 div 上（滚动时我倾向于将鼠标放在屏幕的右边缘），这可能解释了它仅在显示某个百分比时才被标记的外观。

不过，我可能（而且很可能）错了。我只知道在阅读器中滚动浏览我的项目的行为并没有标记它们。我必须确保鼠标在滚动时鼠标悬停在它们上方。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-13T23:36:03.107

dom 和 javascript 可让您计算元素与其父元素的偏移量。要计算与窗口的偏移量，您需要使用递归并爬到顶部窗口，并将其与窗口的大小进行比较。由于跨浏览器问题和 iframe，它变得更加复杂。

据我所知，原型提供了一种简单的`viewportOffset`方法，可以为您完成大部分工作。您还可以检查 和 的`getOffsetParent`来源`scrollTo`。我不了解 jquery，但我希望它能够提供类似的方法。

我的猜测是谷歌阅读器中的脚本只是超时运行，可能每秒几次，或者可能是响应滚动事件。在这两种情况下，我确信它是自适应的（超时根据用户滚动的速度等而变化），并且它足够聪明，不会成为资源占用（即，不要只检查所有 div文件）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-10-03T13:20:08.157

为了计算一个元素是否可见，你可以创建这样一个函数（信用在这里[https://stackoverflow.com/a/22480938/825240](https://stackoverflow.com/a/22480938/825240)）：

```
function isScrolledIntoView(element) {
  var elementTop = element.getBoundingRect().top;
  var elementBottom = element.getBoundingRect().bottom;

  var isVisible = (elementTop <= window.innerHeight) && (elementBottom >= 0);
  return isVisible;
} 
```

您可以通过计算是否已读取元素来根据您的情况自定义该函数：

```
function isRead(element) {
  var elementTop = element.getBoundingRect().top;
  var elementBottom = element.getBoundingRect().bottom;
  var elementHeight = elementBottom - elementTop;

  // if 75% of the document has been scrolled, we'll assume it's been read
  var readIfPercentage = 0.75;

  // an element has been read if the top has been scrolled up out of view
  // and at least 75% of the element is no longer visible
  var isRead = (elementTop < 0 && Math.abs(elementTop) / elementHeight >= readIfPercentage);
  return isRead;
} 
```

然后你可以调用上面的函数，传入一个 DOM 节点作为元素：

```
isScrolledIntoView(document.getElementById('targetDiv');
//or
isRead(document.getElementById('targetDiv'); 
```

您可以通过创建滚动侦听器将它们联系在一起（jQuery 使这非常容易）：

```
function setScrollListener() {

  var scrollEventHandler = function() {
    if (isRead(document.getElementById('article'))) {
      // set article to 'read'
    }
  }

  // on scroll, fire the event handler
  $(document).scroll(scrollEventHandler);
} 
```

值得注意的是，如果你想解绑滚动监听，比如文章都读完了，不再需要监听滚动，可以在scrollEventHandler中调用解绑函数。它很简单：

```
function unbindScrollEventHandler() {
  $(document).unbind('scroll', scrollEventHandler);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-05-28T19:11:58.047

你可以试试这个，关键是元素必须对内部身体更多可见并满足可见比例（在本例中为0.85）。

```
isRead(element) {
   let rect = element.getBoundingClientRect();
   const visibleRatio = 0.85;
   let elementRatio = (window.innerHeight - Math.abs(rect.top))/rect.height;
   let isRead = (rect.top >= 0) && (elementRatio >= visibleRatio);
   return isRead; 
} 
```

# language-agnostic - 如何将 XML 从一种模式转换为另一种模式？

> ID：354141
> 
> 赞同：1
> 
> 时间：2008-12-09T20:34:09.027
> 
> 标签：language-agnostic, xsd, translation

我想将具有特定架构的 xml 文档翻译成另一个架构。我知道旧模式和新模式......

我打算使用 python 的 xml.dom 库，并逐行翻译。

关于如何去做的任何想法？其他语言的任何工具或库可能会使这更容易/更有效。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-09T20:43:04.110

您可以制作一个 XSLT 来为您完成这项工作。XSLT 专门设计用于将 XML 数据转换为其他一些基于文本的格式，包括 XML。有关 XSLT 的更多信息，我推荐 [W3 Schools](http://www.w3schools.com/xsl/default.asp)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T20:44:09.007

这就是 XSLT 的设计目的。由于您知道这两种模式，因此您编写了一个 XSLT 工作表，该工作表获取原始文档并将其转换为新模式。如果存在从旧模式到新模式的一对一映射，则特别容易。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-20T03:58:55.800

XSLT 是“推荐”的方式。但是，如果您熟悉 python，则可以使用 python xml dom 更快地完成此操作。不过学习 XSLT 是个好主意。我必须自己做这件事，我会用 perl 做。

# asp.net-mvc - 解决方案结构和Restful ASP.NET MVC

> ID：354147
> 
> 赞同：1
> 
> 时间：2008-12-09T20:35:40.520
> 
> 标签：asp.net-mvc, rest

在制作一个宁静的 ASP.NET MVC 应用程序时，我想知道在我的解决方案中构建项目的最佳方式。按照惯例，控制器与视图位于同一个项目中。但是，如果我有几个不同的表示层访问我的 RESTful 控制器，将我的控制器放在比我的视图更低的层（项目）中会更好吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T22:11:55.430

据我了解，MVC 控制器是页面行为和数据访问的抽象，但仍与它们驱动的视图耦合。我想您可以将 MVC 控制器从项目中撤出，但您可能会因为必须使控制器所做的一切都变得通用而扼杀了删除重复代码的好处。

编辑：您的问题与此问题几乎[相同](https://stackoverflow.com/questions/352295/how-should-i-structure-a-simple-aspnet-mvc-app)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-15T23:04:23.823

听起来您正在使用 MVC 控制器来构建服务层，以供体系结构中的各种其他组件调用。

我会考虑将该代码移至“服务”项目，并可能使用 WCF 来构建服务。

# winapi - 如何在 Windows 中按名称获取文件时间？

> ID：354151
> 
> 赞同：2
> 
> 时间：2008-12-09T20:37:46.117
> 
> 标签：winapi, windows-mobile, filetime

Windows 有[GetFileTime](http://msdn.microsoft.com/en-us/library/ms724320(VS.85).aspx) API，它允许通过打开文件句柄获取文件时间信息。我想知道的是，是否可以通过文件名获取此信息而无需显式打开文件。如果可能，它是否也适用于 Windows Mobile 平台？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T20:48:05.550

如果您使用 dwFileAccess 值为零调用 CreateFile，它“[指定设备查询访问对象。应用程序可以查询设备属性而不访问设备。](http://msdn.microsoft.com/en-us/library/ms923949.aspx) ”不知道为什么他们从较新版本的文档中删除了那些真正有用的文本位，因为在 FSD 中的实施仍然相同。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T20:41:49.807

如果您想坚持使用 Windows API，一种可能性是使用[FindFirstFile 。](http://msdn.microsoft.com/en-us/library/aa364418(VS.85).aspx)它也[可用于 Windows CE](http://msdn.microsoft.com/en-us/library/ms960605.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T20:40:52.977

GetFileTime 可用于所有版本的 Windows CE。如果没有 Win32 中的有效文件句柄，您不太可能找到完成此操作的方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T20:19:47.730

只是关于在 WinCE 文件上使用文件时间的注释：

引用[WinCE GetFileTime上的 MSDN 文档](http://msdn.microsoft.com/en-us/library/ms908309.aspx)

> Windows CE 对象存储为所有三个参数返回相同的时间。通常，文件系统驱动程序会改变它们支持此功能的方式。

我发现在我尝试过的所有设备上都是如此。

# c# - 具有内置功能的第 3 方活动目录组件

> ID：354154
> 
> 赞同：0
> 
> 时间：2008-12-09T20:38:48.503
> 
> 标签：c#, asp.net, active-directory

我还没有弄清楚活动目录，所以我希望你们可以推荐一些 3rd 方组件，这些组件将为我完成所有内置方法:)

我通常使用权限/角色表构建自己的用户表，但希望添加活动目录作为选项，以便您可以利用已经在 Windows 服务器上设置的用户。

.NET 组件

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T20:43:08.213

您没有指定语言。这是.NET的一个：

[http://www.dotnetactivedirectory.com/](http://www.dotnetactivedirectory.com/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T21:24:34.387

如果您使用的是 .NET 3.5，则可以使用[System.DirectoryServices.AccountManagement](http://msdn.microsoft.com/en-us/library/system.directoryservices.accountmanagement.aspx)命名空间来简化 AD 操作。

# asp.net - 基于 HTTP 或 SQL Server 的 sql 注入解决方案

> ID：354161
> 
> 赞同：1
> 
> 时间：2008-12-09T20:41:59.650
> 
> 标签：asp.net, sql-server-2005, sql-injection

我正在使用 SQL Server 2005 和 Windows Server 2000，想知道在我支持我的代码时是否有任何“自动”方法来阻止 SQL 注入攻击。

有人建议有以下方法：

1.  放入某种 ISAPI 或 HTTP 模块，用于过滤请求帖子和查询字符串以查找面向注入的符号，并在请求到达应用程序之前使请求失败。这些解决方案中的大多数特定于 IIS 6 或更高版本。我跑5。
2.  保证每个命令对象一次只运行一个 SQL 命令。

我的配置还有其他想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T20:49:34.440

一般来说，没有自动的解决方案来防止 SQL 注入。SQL 注入是应用程序故障，而不是数据库故障。

解决方案是让您对执行将应用程序数据插入查询的 SQL 的所有情况进行代码审查。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T20:56:00.637

这个建议的解决方案：

> 保证每个命令对象一次只运行一个 SQL 命令。

实际上并不能防止注射。例如，攻击者可以注入登录查询以在没有凭据的情况下登录。考虑：

```
"SELECT COUNT(*) FROM Users WHERE UserId = '{0}' AND PassHash = '{1}'" 
```

可以使用以下 UserId 注入此模板：

```
' OR 1=1 -- 
```

产量：

```
"SELECT COUNT(*) FROM Users WHERE UserId = '' OR 1=1 --' AND PassHash = 'sdfklahsdlg'" 
```

集中精力消除代码中的漏洞。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T21:08:46.587

确保所有数据库调用都使用存储过程或参数化查询。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T21:34:20.793

当我在我的服务器上进行大量注入攻击尝试时，我担心它们会占用不必要的资源。我用 c# 编写（被黑！）了一个 HttpModule，它可以过滤掉大多数 xss 和 sql 注入攻击。代码粘贴在下面，以及使网站使用它所需的配置部分。它应该放在一个项目中并编译为 WebSecurityFilter.dll，然后应该由 Web 项目引用（或以其他方式放在 bin 目录中）。

这仅适用于 asp.net，因此希望您的网站是基于 asp.net 的（我确实在评论中询问过，但没有得到答复）。

Web 配置部分（将其添加到 <system.web> 的 <httpModules> 部分：

```
 <add name="SecurityHttpModule" type="WebSecurityFilter.SecurityHttpModule, WebSecurityFilter" /> 
```

模块代码（SecurityHttpModule.cs）：

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Web;
using System.Text.RegularExpressions;

namespace WebSecurityFilter
{
    class SecurityHttpModule : IHttpModule
    {
        class RegexWithDesc : Regex
        {
            string _errorText;

            public string ErrorText
            {
                get { return _errorText; }
            }

            public RegexWithDesc(string regex, RegexOptions options, string errorText)
                :base(regex, options)
            {
                _errorText = errorText;
            }
        }
        /// <summary>
        /// error text displayed when security violation is detected
        /// </summary>
        private string _errorhtml =
        @"<!DOCTYPE html PUBLIC ""-//W3C//DTD XHTML 1.1//EN"" ""http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"">" +
        @"<html xmlns=""http://www.w3.org/1999/xhtml"" >" +
        @"<body style=""background:black;"">" +
        @"<table style=""width:100%"" >" +
        @"<tr><td align=""center"">" +
        @"<div style=""border:3px solid red;text-align:center;width:95%;color:red;padding:10px;text-decoration:blink;"">" +
        @"SECURITY VIOLATION" +
        @"<br/>" +
        //@"<br/>" +
        //@"go away" +
        //@"<br/>" +
        @"<br/>" +
        @"{0}" +
        @"<br/>" +
        @"</div>" +
        @"</td></tr>" +
        @"</table>" +
        @"</body>" +
        @"</html>";

        // regex for default checks
        // http://www.securityfocus.com/infocus/1768
        static RegexOptions _defaultRegexOptions = RegexOptions.Compiled | RegexOptions.IgnoreCase | RegexOptions.IgnorePatternWhitespace;

        RegexWithDesc[] _regexCollection = new RegexWithDesc[] 
        { 
            new RegexWithDesc(@"((¼|<)[^\n]+(>|¾)*)|javascript|unescape", _defaultRegexOptions, "XSS 1"), //3.3
            // new RegexWithDesc(@"(\')|(\-\-)", _defaultRegexOptions, "SQL 1"), //2.1
            new RegexWithDesc(@"(=)[^\n]*(\'|(\-\-)|(;))", _defaultRegexOptions, "SQL 2"),    //2.2
            //new RegexWithDesc(@"\w*(\')(or)", _defaultRegexOptions, "SQL 3"),  //2.3
            new RegexWithDesc(@"(\')\s*(or|union|insert|delete|drop|update|create|(declare\s+@\w+))", _defaultRegexOptions, "SQL 4"),   //2.4
            new RegexWithDesc(@"exec(((\s|\+)+(s|x)p\w+)|(\s@))", _defaultRegexOptions, "SQL 5")    //2.5
        };
        #region IHttpModule Members

        public void Dispose()
        {
           // nothing to do
        }

        public void Init(HttpApplication context)
        {
            context.BeginRequest += new EventHandler(context_BeginRequest);
        }

        void context_BeginRequest(object sender, EventArgs e)
        {
            try
            {
                List<string> toCheck = new List<string>();
                foreach (string key in HttpContext.Current.ApplicationInstance.Request.QueryString.AllKeys)
                {
                    toCheck.Add(HttpContext.Current.ApplicationInstance.Request[key]);
                }
                foreach (string key in HttpContext.Current.ApplicationInstance.Request.Form.AllKeys)
                {
                    toCheck.Add(HttpContext.Current.ApplicationInstance.Request.Form[key]);
                }
                foreach (RegexWithDesc regex in _regexCollection)
                {
                    foreach (string param in toCheck)
                    {
                        string dp = HttpUtility.UrlDecode(param);
                        if (regex.IsMatch(dp))
                        {
                            HttpContext.Current.ApplicationInstance.Response.Write(string.Format(_errorhtml, regex.ErrorText));
                            HttpContext.Current.ApplicationInstance.CompleteRequest();
                            return;
                        }
                    }
                }

            }
            catch (System.Threading.ThreadAbortException x)
            {
                throw;
            }
            catch (Exception ex)
            {
                HttpContext.Current.ApplicationInstance.Response.Write(string.Format(_errorhtml, "Attack Vector Detected"));
                HttpContext.Current.ApplicationInstance.Response.Write(string.Format(_errorhtml, ex.GetType().ToString()));
                HttpContext.Current.ApplicationInstance.CompleteRequest();
                return;
            }
        }

        #endregion
    }
} 
```

希望一切都格式化好...

今天晚上，我将尝试以 zip 的形式发布指向完整项目的链接。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-07T12:27:47.390

始终清理用户输入

1.  如果您不允许 ' 您将立即采取某种方式使您的代码更安全
2.  如果您的查询需要一个整数，请确保输入是一个整数。ETC

# postgresql - 防止在 PostgreSQL 中对专有名词进行词干处理？

> ID：354167
> 
> 赞同：3
> 
> 时间：2008-12-09T20:43:22.097
> 
> 标签：postgresql

PostgreSQL 全文搜索引擎热衷于[将标记词根化为词位，也减少了专有名词。](http://www.postgresql.org/docs/current/interactive/textsearch-intro.html)例如：

```
essais=> select to_tsquery('english', 'bortzmeyer');
to_tsquery 
------------
'bortzmey'

essais=> select to_tsquery('english', 'balling');
to_tsquery 
------------
'ball'
(1 row) 
```

至少对于第一个，我确定它不在英语词典中！避免这种虚假词干的更好方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-09T21:12:25.830

词干算法的重点*不是*将每个单词简化为适当的词干。目标是将相似的单词减少为常见的词干形式。目标通常不是得到一个可以呈现给用户的词：即使“balling”和“ball”都会产生“kjebnkkekaa”，算法是正确的，因为它仍然认为“balling”和“ball”通常是相关的一样的东西。

另请注意，没有任何词干算法是绝对完美的，有关更多信息，[请查看 Porter Stemming 算法](http://tartarus.org/~martin/PorterStemmer/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T21:21:48.963

这是由于[此处](http://www.postgresql.org/docs/current/interactive/textsearch-debugging.html)解释的 Snowball 词干分析器。基本上，您需要禁用 Snowball 词干分析器并仅使用 iSpell 或其他词典之一，但这也会降低词典中未包含的单词的词干提取效率。

# spring - Struts 和 Spring 在一起？

> ID：354171
> 
> 赞同：2
> 
> 时间：2008-12-09T20:44:14.357
> 
> 标签：spring, struts, service, actionform

我对 Struts 和 Spring 都很陌生。我需要知道如何在 Struts ActionForm 中访问 Spring Service。即使是正确方向的指针也将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T22:03:36.413

从 struts 1 ActionForm 类中，您将需要：

```
WebApplicationContextUtils.getRequiredWebApplicationContext(servletContext).getBean("yourService"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T20:54:48.500

通常，您将 spring contextloader 侦听器添加到您的 web xml。

```
<listener>
 <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
</listener> 
```

然后你添加

```
<constant name="struts.objectFactory" value="spring"/> 
```

到你的 struts.xml。

然后在你的行动课上你可以说：

```
class MyAction {
  @Autowired MyService service;
   ....
} 
```

这就是struts2 的全部内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-25T14:01:02.253

您使用的是 Struts 1 还是 2？

如果您使用的是 Struts 1，那么有几种方法可以做到这一点。我更喜欢使用 org.springframework.web.struts.DelegatingActionProxy 来实现。您需要在类路径中有 spring-webmvc-struts.jar。

struts-config.xml：

```
 <action path="/faq" type="org.springframework.web.struts.DelegatingActionProxy" name="faqForm" parameter="method">
        <forward name="List" path="faq.list" />
    </action> 
```

应用程序上下文.xml：

```
<bean name="/faq" class="com.mypackage.FAQAction" autowire="byType" /> 
```

我发现这种技术是最优雅的，它不会影响不使用 spring 的旧代码。

至少还有两种方法可以将支柱 1 与弹簧集成在一起。ibm developerworks 上有一篇文章解释了不同解决方案的优缺点，谷歌“Get a better handle on Struts actions, with Spring”（像我这样的新手不允许包含链接）。

# asp.net - 始终拥有 ID 财产有什么好处吗？

> ID：354181
> 
> 赞同：2
> 
> 时间：2008-12-09T20:46:12.560
> 
> 标签：asp.net

在 asp.net 中包含或不包含 id 属性有什么好处？对于这个问题，假设我们需要 ID 没有程序原因。（我们不是在后面的代码中操作控件，也不是在客户端上）。

我个人的偏好是仅当我有理由操纵控件并且需要能够引用它时才包含 Id 属性。所以我发现自己总是删除 Image1 Label1 等...

# 到目前为止的答案：

1.  保留它们可以帮助辅助技术。
2.  保留它们可以帮助测试套件
3.  删除它们可能会对带宽产生影响
4.  删除它们可以让你的智能感知更清洁（刚刚添加了这个）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T20:55:29.640

取自[MSDN](http://msdn.microsoft.com/en-us/library/system.web.ui.control.id.aspx) ( [http://msdn.microsoft.com/en-us/library/system.web.ui.control.id.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.control.id.aspx) )

> “在服务器控件上设置此属性 (ID) 可让您以编程方式访问服务器控件的属性、事件和方法。Web 开发人员可以通过在 ASP.NET 服务器的开始标记中声明 ID 属性来设置此属性控件。如果未以声明方式或编程方式为服务器控件指定此属性，则可以通过其父控件的 Controls 属性获取对该控件的引用。

所以看起来 ID 属性是为通过代码访问控件而提供的。但是，您仍然可以通过代码访问没有 ID 属性的控件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T21:04:20.573

拥有 ID 属性对于使用 Quick Test Pro 等工具测试您的页面很有用。它们对于使用屏幕阅读工具浏览的盲人用户也很有用。

有一个很好的 Hanselminutes 播客对此进行了讨论： [http ://www.hanselminutes.com/default.aspx?showID=143](http://www.hanselminutes.com/default.aspx?showID=143)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T21:00:48.893

诚然，ID 存在的唯一原因是获取单个对象的句柄，但删除 VisualStudio 为您创建的自动分配 ID 绝对没有任何好处。

您永远不知道什么时候可以使用 ID，因此我至少建议您保留默认值（如果没有别的）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T21:40:22.620

基本上，当您想从服务器端引用控件时，您将需要 id。您执行的大多数绑定任务都在服务器端。这包括绑定到 GridView 控件。将消息分配给标签控件等。

如果您没有在后面的代码中使用控件，那么您可以省略 id。但我总是建议为所有控件提供有意义的 ID。

如果您不分配 id 并添加一个 ID 为“Button1”的控件，那么会有一个变化，这将与已添加的没有 id 的按钮发生冲突。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T21:53:47.273

手动编写 HTML 时，除非需要，否则我不会在任何内容上包含 ID。对于高负载站点，如果不存在，则**使用的带宽较少。**考虑到人们通过大量工作从 CSS 和 JS 文件中删除空格和注释（通常在构建时），我会考虑删除未使用的 ID 标签以进入同一条船。另外，如果没有 ID，我会假设浏览器的 DOM 构建工作要做的更少。这一切都增加了更快的页面传输和渲染时间，从长远来看，这加起来了！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T22:55:47.383

These ID's on server controls also help when you are trying to see the generated code on the browser (which you need to do at times, at least I do). For example some text box I call tbLastName would be converted to something like ctl001_tbLastName

# c - 从 FORTRAN 调用 C 代码

> ID：354182
> 
> 赞同：0
> 
> 时间：2008-12-09T20:46:35.477
> 
> 标签：c, fortran

鉴于 Microsoft FORTRAN 5.1 和 Microsoft C/C++ 14.0，以及该版本 FORTRAN 附带的链接器（必须用于其他依赖项），我如何创建 C 函数并从 FORTRAN 应用程序调用它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T23:37:21.917

MSDN 上有一篇文章，这里有示例代码： [FORTRAN calls to C](http://msdn.microsoft.com/en-us/library/aa279034(VS.60).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T13:19:04.570

你有两个选择。
1）我可以举例说明

FORTRAN

```
program ftest
use iso_c_bindings
implicit none
interface
function saythis(a) ! should be subroutine if saythis returns void
import :: c_ptr
type(c_ptr), value :: a
end function saythis
end interface

character(len=80), target :: str
type(c_ptr) cstr
integer :: r

str='Hello World From Fortran' // C_NULL_CHAR
cstr=c_loc(str(1:1))
r=saythis(cstr) 
```

C/C++

```
#ifdef __cpluscplus
#include &ltl;cstdio&gt;
using namespace std;
#else
#inlcude &lt;stdio.h&gt;
#endif

#ifdef __GNUC__
#define FORT(func) func ## _
#else
#define FORT(func) __stdcall func ## _
#endif

#ifdef __cpluscplus
extern "C" {
#endif
__declspec(dllexport) int FORT(sayit)(char* c)
{
return printf("%s\n",c);
}

#ifdef __cpluscplus
}
#endif 
```

这适用于 / gcc 工具链。您必须对 DLL 和 fortran 目标代码进行转储，以查看名称是否正确匹配。
另一种方式类似：

```
//This is for gcc toolchain
//you'll have to find the symbol conversion yourself
//I think that Visual Studio converts fortran names
//to ALL CAPS so instead of func => _func you'll need func => FUNC 
```

FORTRAN

```
program ftest
integer aa,bb,cc
common/vari/aa,bb,cc

aa=7
bb=11
cc=0
call dosomething
call dosomethingelse(aa,bb,cc) 
```

C/C++

```
#ifdef __cplusplus
extern "C" {
#endif
int _dosomething();
int _dosomethingelse(int*,int*,int*); //all fortran is pass by reference
struct { int aa,bb,cc; } vari;
#ifdef __cplusplus
}
#endif

//function def's go here
//struct vari should be the same memory as common/vari block 
```

编译命令

```
$>g++ -c ctest.c <br/>
$>gfortran -c ftest.f90 <br/>
$>gfortran *.o -lstdc++ -o test_prog <br/> 
```

希望这可以帮助

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-31T17:06:50.293

也许迟到总比没有好。我记得在 Visual Studio 1 中使用过 ms fortran 5.1。我不确定哪个 Visual Studio 14.0 相当于，但我认为它是相对较新的，而不是 13 岁。我认为这种组合不是入门的，因为 5.1 是 Windows 3 的 16 位编译器。

# asp.net - 如何通过外部页面链接到 ASP:DetailsView 的插入模式

> ID：354188
> 
> 赞同：1
> 
> 时间：2008-12-09T20:48:08.513
> 
> 标签：asp.net, web-applications, asp.net-2.0, detailsview

与许多 ASP.NET 文档和示例不同，我在一个页面上创建一个 gridview 列表，它链接到第二个页面以进行编辑/更新视图，在 GET 字符串中发送记录的 ID。

在我的编辑/更新视图中，我使用 ASP:DetailsView 来查看、编辑和插入记录。所有这一切都很好。

在`detailsView`页面上，我让它自动生成一个`new record`链接，该链接使用回发来显示要填写的空白插入表单。

唯一的问题是，我不知道如何从外部页面链接到`insert`视图。`DetailsView`我错过了什么吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T07:14:15.757

我可能误解了你的问题，但是......

我不相信您可以“链接到插入视图”，但是您可以做的是在页面加载后以编程方式更改 DetailsView 的模式。记得先检查传入的 ID 是否有值。

例如：

```
If Not idValue Is Nothing Then   
    yourDetailsViewName.ChangeMode(DetailsViewMode.Insert)
End If 
```

查看 MSDN 页面了解更多信息：
[DetailsView.ChangeMode 方法](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.detailsview.changemode.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-12T04:30:15.460

我只是想跟进并说，即使我没有找到链接到特定页面状态的方法，我确实发现了 dataview 的 DefaultMode 参数，它至少允许您选择初始状态。

因此： DefaultMode="Insert"

至少让您选择插入模式作为默认值。

# mysql - MYSQL安装问题

> ID：354194
> 
> 赞同：3
> 
> 时间：2008-12-09T20:49:45.283
> 
> 标签：mysql, ruby-on-rails, macos, installation

在我的 mac 上通过终端升级了一些 gem 之后，我创建了一个由 mysql 数据库备份的新 rails 项目。启动应用程序后，会出现常规欢迎登机页面。

这就是问题所在 - 我尝试单击标题为“关于您的应用程序环境”的链接，我在浏览器中收到以下输出：

```
MissingSourceFile in Rails/infoController#properties
no such file to load -- mysql 
```

我也在终端收到这个输出

```
The bundled mysql.rb driver has been removed from Rails 2.2\. Please install the mysql gem and try again: gem install mysql.
Processing Rails::InfoController#properties (for 127.0.0.1 at 2008-12-09 20:41:41) [GET]
Processing Rails::InfoController#properties (for 127.0.0.1 at 2008-12-09 20:41:41) [GET]
MissingSourceFile (no such file to load -- mysql):
... 
```

正如它所说，我在停止应用程序后尝试发出“gem install mysql”，却被这句我无法理解的行话所打招呼：

```
WARNING:  Installing to ~/.gem since /Library/Ruby/Gems/1.8 and
      /usr/bin aren't both writable.
WARNING:  You don't have /Users/mymac/.gem/ruby/1.8/bin in your PATH,
      gem executables will not run.
Building native extensions.  This could take a while...
ERROR:  Error installing mysql:
    ERROR: Failed to build gem native extension.

/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/bin/ruby extconf.rb install mysql
checking for mysql_query() in -lmysqlclient... no
checking for main() in -lm... yes
checking for mysql_query() in -lmysqlclient... no
checking for main() in -lz... yes
checking for mysql_query() in -lmysqlclient... no
checking for main() in -lsocket... no
checking for mysql_query() in -lmysqlclient... no
checking for main() in -lnsl... no
checking for mysql_query() in -lmysqlclient... no
*** extconf.rb failed ***
Could not create Makefile due to some reason, probably lack of
necessary libraries and/or headers.  Check the mkmf.log file for more
details.  You may need configuration options.

Provided configuration options:
    --with-opt-dir
    --without-opt-dir
    --with-opt-include
    --without-opt-include=${opt-dir}/include
    --with-opt-lib
    --without-opt-lib=${opt-dir}/lib
    --with-make-prog
    --without-make-prog
    --srcdir=.
    --curdir
    --ruby=/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/bin/ruby
    --with-mysql-config
    --without-mysql-config
    --with-mysql-dir
    --without-mysql-dir
    --with-mysql-include
    --without-mysql-include=${mysql-dir}/include
    --with-mysql-lib
    --without-mysql-lib=${mysql-dir}/lib
    --with-mysqlclientlib
    --without-mysqlclientlib
    --with-mlib
    --without-mlib
    --with-mysqlclientlib
    --without-mysqlclientlib
    --with-zlib
    --without-zlib
    --with-mysqlclientlib
    --without-mysqlclientlib
    --with-socketlib
    --without-socketlib
    --with-mysqlclientlib
    --without-mysqlclientlib
    --with-nsllib
    --without-nsllib
    --with-mysqlclientlib
    --without-mysqlclientlib

Gem files will remain installed in /Users/mymac/.gem/ruby/1.8/gems/mysql-2.7 for inspection.
Results logged to /Users/mymac/.gem/ruby/1.8/gems/mysql-2.7/gem_make.out 
```

显然我的 mysql 安装有问题，因为我也尝试运行 rake 命令来创建数据库，这提示了我以下内容。

```
!!! The bundled mysql.rb driver has been removed from Rails 2.2\. Please install the mysql gem and try again: gem install mysql.
rake aborted!
no such file to load -- mysql

(See full trace by running task with --trace) 
```

但是，当我在命令行运行“mysql --version”时，mysql 已安装！

```
mysql  Ver 14.12 Distrib 5.0.67, for apple-darwin9.4.0 (i686) using readline 5.1 
```

我也尝试发出“sudo gem install mysql”，但这也无济于事：

```
sudo gem install mysql
Password:
Building native extensions.  This could take a while...
ERROR:  Error installing mysql:
    ERROR: Failed to build gem native extension.

/System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/bin/ruby extconf.rb install mysql
checking for mysql_query() in -lmysqlclient... no
checking for main() in -lm... yes
checking for mysql_query() in -lmysqlclient... no
checking for main() in -lz... yes
checking for mysql_query() in -lmysqlclient... no
checking for main() in -lsocket... no
checking for mysql_query() in -lmysqlclient... no
checking for main() in -lnsl... no
checking for mysql_query() in -lmysqlclient... no

Gem files will remain installed in /Library/Ruby/Gems/1.8/gems/mysql-2.7 for inspection.
Results logged to /Library/Ruby/Gems/1.8/gems/mysql-2.7/gem_make.out 
```

我还尝试按照bradheintz的指示发出“sudo gem install mysql --with-mysql-config=/usr/local/mysql/bin/mysql_config”，它似乎已经安装好，但是在尝试查看应用程序环境之后再次，没有出现 ajaxy 下拉菜单，rails 应用程序完全停止！下面的输出是在应用程序决定对我死去之前打印出来的，哈哈。

```
dyld: lazy symbol binding failed: Symbol not found: _mysql_init
  Referenced from: /Library/Ruby/Gems/1.8/gems/mysql-2.7/lib/mysql.bundle
  Expected in: dynamic lookup

dyld: Symbol not found: _mysql_init
  Referenced from: /Library/Ruby/Gems/1.8/gems/mysql-2.7/lib/mysql.bundle
  Expected in: dynamic lookup

Trace/BPT trap 
```

如果有人能理解这里发生了什么，以及如何解决这个问题，我将非常感激:)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-09T20:51:24.140

问题是 MySQL gem 构建本地扩展，并且需要特定于系统的信息，了解在哪里可以找到某些库。您必须在命令行上提供此信息。

看看[这个页面](http://forums.mysql.com/read.php?116,204740,204740 "Mysql Gem 安装说明")- 重要的一点（无论如何对我有用）是：

> `sudo gem install mysql -- --with-mysql-config=/usr/local/mysql/bin/mysql_config`

当然，请务必为您自己的系统替换正确的路径。

另外，坚持`gem install`通过`sudo`.

更大的问题是 gem 软件没有提供任何反馈，因为您不能`gem install mysql`像使用其他所有 gem 那样做（实际上，曾经能够使用 MySQL gem）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T05:09:17.567

尝试仅强制构建 32 位版本（假设您使用的是 Intel Mac，`-V`with gem 应该为您提供更详细的输出）

```
sudo env ARCHFLAGS="-arch i386" gem install -V mysql -- --with-mysql-config=/usr/local/sql32/bin/mysql_config 
```

此博客文章中的更多信息：http: [//blog.pastie.org/2008/10/mysql-64-bit-ruby-32-bit-friends-again.html](http://blog.pastie.org/2008/10/mysql-64-bit-ruby-32-bit-friends-again.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T06:37:56.780

上次我看到这个错误是在我尝试安装 mysql/ruby 适配器时。在 Mac 上将 rails 升级到 rails 1.2.2 后我遇到了同样的错误，因为 1.2.2 默认删除了 mysql gem。

我上次发现的原因是缺少 mysql 客户端或库。以 Redhat 为例，你可以到这个链接，安装 mysql 客户端和库。 [http://dev.mysql.com/downloads/mysql/5.0.html#linux-rhel5-x86-32bit-rpms](http://dev.mysql.com/downloads/mysql/5.0.html#linux-rhel5-x86-32bit-rpms)

让我知道结果。

乔

# c# - .NET 中 AJAX 和 ViewState 的行为不一致

> ID：354195
> 
> 赞同：2
> 
> 时间：2008-12-09T20:50:02.147
> 
> 标签：c#, .net, ajax, updatepanel, viewstate

我发现点击浏览器上的“刷新”按钮会暂时搞砸 UpdatePanel 中控件的 ViewState。

这是我的情况：我制作了一个自定义 WebControl，将值存储在 ViewState 中。我将此控件放在 UpdatePanel 中。当我点击浏览器上的“刷新”按钮时，它会暂时清除 ViewState 中的值。然而，在下一次回发时，我点击“刷新”之前 ViewState 中的值神奇地重新出现。

这种行为搞砸了我的网络控制。在我点击“刷新”后，控件返回到其初始状态，因为 ViewState 为空且 IsPostBack 设置为 false。但是，当我单击 WebControl 中的一个回发控件时，WebControl 将使用与我点击“刷新”之前 ViewState 中相同的值重新加载。

奇怪的是，这只发生在我使用 AJAX 时。当我的控件在 UpdatePanel 之外时，Firefox 会给我它的标准消息，“要显示此页面，Firefox 必须发送将重复之前执行的任何操作（例如搜索或订单确认）的信息（重新发送）（取消） 。” 这很好，因为至少行为是一致的。但是，我绝对必须为这个项目使用 AJAX。

所以这就是我想做的——我想让“刷新”行为保持一致。如果点击“刷新”完全不影响 ViewState，那将是最好的。但是，如果它必须清除 ViewState，那很好，只要 ViewState STAYS 清除即可。这些东西都没有价值消失和重新出现。

哦，是的，这是我的示例代码：

```
using System;
using System.Data;
using System.Configuration;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;

namespace TestControls
{
    public class TestControl : WebControl
    {
        int _clickCount;
        bool _mustUpdate;

        protected override void LoadViewState(object savedState)
        {
            base.LoadViewState(savedState);

            _clickCount = ((int)ViewState["clickCount"]);
            _mustUpdate = ((bool)ViewState["mustUpdate"]);
        }

        protected override void OnLoad(EventArgs e)
        {
            base.OnLoad(e);

            Controls.Clear();
            ControlCreator();
        }

        private void ControlCreator()
        {
            Label tempLabel = new Label();
            LiteralControl tempLiteral = new LiteralControl("<br/><br/>");
            LinkButton tempLink = new LinkButton();

            tempLink.ID = "testLink";
            tempLink.Text = "Click me!";
            tempLink.Click += new EventHandler(tempLink_Click);

            tempLabel.ID = "testLabel";
            tempLabel.Text = _clickCount.ToString();

            Controls.Add(tempLabel);
            Controls.Add(tempLiteral);
            Controls.Add(tempLink);
        }

        void tempLink_Click(object sender, EventArgs e)
        {
            _clickCount++;
            _mustUpdate = true;
        }

        protected override void OnPreRender(EventArgs e)
        {
            base.OnPreRender(e);

            if (_mustUpdate)
            {
                Controls.Clear();
                ControlCreator();

                _mustUpdate = false;
            }
        }

        protected override object SaveViewState()
        {
            ViewState["clickCount"] = _clickCount;
            ViewState["mustUpdate"] = _mustUpdate;

            return base.SaveViewState();
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T23:27:23.933

尝试以下...

```
 protected override void LoadViewState(object savedState)
    {
        if (savedState != null)
        {
            object[] myState = (object[])savedState;

            if (myState[0] != null) base.LoadViewState(myState[0]);
            if (myState[1] != null) _clickCount = ((int)myState[1]);
            if (myState[2] != null) _mustUpdate = ((bool)myState[2]);
        }
    }

    protected override object SaveViewState()
    {
        object[] allStates = new object[3];

        allStates[0] = base.SaveViewState();
        allStates[1] = _clickCount;
        allStates[2] = _mustUpdate;

        return allStates;
    } 
```

上面的代码基本上是从 MSDN的[Control.LoadViewState Method](http://msdn.microsoft.com/en-us/library/system.web.ui.control.loadviewstate.aspx)和 [Control.SaveViewState Method派生出来的。](http://msdn.microsoft.com/en-us/library/system.web.ui.control.saveviewstate.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-12T13:19:42.043

我刚刚重新阅读了您的问题，并意识到我错过了一些东西...

**您正在点击*浏览器*刷新按钮！**

这是一个问题吗？**是的！**

当您点击浏览器上的刷新按钮时会发生什么？它刷新当前页面。如果有回发，它将重新发送帖子数据。

就页面而言，AJAX 回调可能会更新 ViewState，但点击浏览器刷新按钮将重新发布旧的 ViewState。

有一个财富是关于这个问题的讨论，你可以谷歌。

一个非常简单的想法是也许将信息存储在会话状态中。当然，那也可能有它自己的问题。但它可能会实现您的直接目标。

擦除回发历史（以防止重新发布）的提示是再次重定向回同一页面。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T23:32:40.210

您的 ViewState 没有被保存。SaveViewState 覆盖用于保存 OBJECTS，而不是用于将内容放入 ViewState 包中。ViewState 包已经超出了将内容标记为脏的程度，并且您所做的更改将不会被保留。您需要创建一个对象数组来加载/查看 ViewState 信息。

做 BlackMael 展示的事情。

# asp.net - ASP.Net 是一种适用于高负载站点的技术吗？

> ID：354201
> 
> 赞同：13
> 
> 时间：2008-12-09T20:54:10.967
> 
> 标签：asp.net

这就是问题......你认为 ASP.Net 是一种适合高负载网站的技术吗？你知道任何流行的网站——当然除了stackoverflow——是用这种技术构建的吗？谢谢。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-12-09T20:55:13.477

MySpace、Orkut、ASP.NET 论坛、Microsoft.com、...

ASP.NET 具有出色的缓存和负载平衡功能，使其适用于高负载网站。

它也是一个非常灵活、精心设计的框架。如果您不喜欢它的一部分，或者认为它对您的高负载应用程序的性能要求很高，您可以丢弃该层并用您自己的替换它。如果你不喜欢 WebControls 和 Pages 因为它的开销，你可以写你自己`HttpHandler`的 s.

基本上，我认为 ASP.NET MVC 将成为高负载和自定义网站的更好平台，因为它可以进行更多的手动调整（相对于试图抽象出生成的 HTML 的 ASP.NET 页面，这是有充分理由的）并且可以更好地与 AJAX 应用程序配合使用。WebControls 和 ViewState 是通常面临批评的两个部分，在 MVC 中几乎消失了。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-09T21:05:32.660

ASP.NET 在“Web 2.0”世界中名声不佳。MySpace 拥有超过 5000 万用户，我称之为“高负载”。

我认为，就像任何其他 Web 技术一样，该工具的功能掌握在为其创建的开发人员手中。如果 ASP.NET 开发人员忽略缓存和负载平衡，应用程序将无法处理负载，这也不是 ASP.NET 的错。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-09T20:56:48.387

Monster.com、newegg、大多数新闻网站等等！

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-09T21:06:47.167

除了上述答案之外，[The Code Project](http://www.codeproject.com/)也是一个 ASP.NET 站点。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-09T21:10:43.523

答案是“是的，也许”。能应付吗？明确地。ASP.NET 有很多特性。有很多功能，在一个网站上有很多事情可以做得很差。大型站点需要仔细的设计考虑和规划，以确保它在水平和垂直方向上都是可扩展的。很有可能，如果您只是从臀部射击并在服务器端进行任何实际处理，您最终会陷入一个受伤的世界。

我们喜欢 .NET Framework，并对它的灵活性和强大功能感到兴奋 - ASP.NET，无论是由 C# 还是 VB.NET 支持，都是一个稳定且功能丰富的平台。有关性能问题的更多细节，我强烈推荐 Microsoft 的[改进 .NET 应用程序性能和可扩展性](http://msdn.microsoft.com/en-us/library/ms998530.aspx)。您还可以[下载](http://www.microsoft.com/downloads/details.aspx?familyid=8A2E454D-F30E-4E72-B531-75384A0F1C47&displaylang=en)完全免费的内容电子书。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-09T21:08:20.907

ASP.NET 对于高负载站点来说绝对是一个很好的平台，但要警惕那些“Ajax”扩展。他们假装进行部分页面回发，但他们拥有整页回发的所有负载。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-10T07:52:32.963

当人们询问 ASP.NET 站点是否可以处理大流量时，我经常将他们推荐给很多人。该站点具有大量流量，并在少数服务器上运行。它以在两台服务器上运行多年而闻名——一台用于提供图像，另一台用于处理其他一切。

# vb.net - VB.NET队列处理问题

> ID：354204
> 
> 赞同：0
> 
> 时间：2008-12-09T20:54:36.053
> 
> 标签：vb.net, queue

我需要一个处理队列的 VB.NET Forms 应用程序。它基本上需要每 30 秒 ping 一次 Web 服务，然后将文档加载到文档管理系统中（如果有要加载的话）。

我将如何实现这一点？使用循环？我需要查看线程吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T21:14:17.260

如果您已经在使用 Web 服务，那么您可能希望保持服务的类似线程的行为，并减少复杂性。

否则，只需使用 Timer 对象，或者如果可能的话，使用 FileSystemWatcher 作为触发器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T20:58:19.790

你是如何定义队列的。您可以使用多线程（即创建一个线程池实例）并让线程池弹出队列中的对象。

但是，如果您在队列对象中有类似文件搜索的内容，那么显然您希望第一个 que 对象在开始第二个之前完成（也就是说，如果它们使用相同的文件）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T21:36:24.563

使用 System.Windows.Forms.Timer，设置为 30000 毫秒间隔（30 秒）

使用[System.Collections.Generic queue](http://msdn.microsoft.com/en-us/library/7977ey2c.aspx?ppud=4)，使用 Enqueue 初始化

让 timer-elapsed 方法使用 Dequeue 从队列中获取下一个元素（可能是 Web 服务 url）并处理它

粗糙，但有效

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-07T12:40:19.993

在这里获取它[http://www.codeddefiner.com/vbnet/vbnetQueue.aspx](http://www.codedefiner.com/vbnet/vbnetQueue.aspx)

# sql-server - SSRS 加密密钥同时在两台机器上丢失

> ID：354209
> 
> 赞同：0
> 
> 时间：2008-12-09T20:55:40.323
> 
> 标签：sql-server, reporting-services

在我店里的两台不同机器上安装了两次 SSRS 2005 似乎同时丢失了它们的加密密钥。这些是运行 SQL Server 2005 开发版的开发人员机器，所以我希望这里有人对此有解释。昨天，两台机器开始报错：

“报表服务器无法解密用于访问报表服务器数据库中敏感或加密数据的对称密钥。您必须还原备份密钥或删除所有加密内容。”

这两台机器过去也都“丢失”了密钥，恢复它们可以解决问题。然而，奇怪的是他们俩同时“丢失”了钥匙，而且似乎每两个月左右就会发生一次。有谁知道为什么会这样？以下是有关安装的一些信息：

> SQL Server 类型：SQL Server 2005 开发者版
> 
> 内部版本号：3282（累积更新 9）
> 
> Reporting Services 帐户：网络服务

谢谢...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-12T18:04:41.313

您的 Windows 密码更改策略是什么？对于网络服务，这应该不相关

如果用户帐户或其他工作站参数更改（例如安装 SID），则密钥将失效。有人试图更改 RS 服务帐户吗？机器名称会改变吗？

# performance - 许多相同键的最有效排序算法？

> ID：354221
> 
> 赞同：8
> 
> 时间：2008-12-09T21:00:07.477
> 
> 标签：performance, algorithm, optimization, sorting, hash

给定以下条件，将相同项目组合在数组中的最有效算法是什么：

1.  几乎所有的项目都重复了好几次。
2.  这些项目不一定是整数或任何其他类似简单的东西。键的范围甚至都没有很好的定义，更不用说很小了。事实上，键可以是任意结构。这排除了最简单的计数排序形式。
3.  我们关心渐近和非渐近性质，有时 n 可能很小。然而，当 n 很小时，性能仍然很重要，因为这个函数可能会在数百万个小数据集上循环调用数百万次。这排除了任何昂贵的散列函数或使用需要执行大量内存分配的复杂数据结构。
4.  只要将所有相同的项目组合在一起，数据就可以按任意顺序排序。

如果这令人困惑，这里有一个示例，假设这样的函数名为 groupIdentical：

```
uint[] foo = [1,2,3,2,1,5,4,5];
uint[] bar = groupIdentical(foo);
// One possibile correct value for bar:
// bar == [2,2,1,1,3,4,5,5].
// Another possible correct answer:
// bar == [1,1,2,2,5,5,4,3]. 
```

但是，提醒一下，我们不能假设数据是由整数组成的。

编辑：谢谢你的答案。我对散列的主要问题是散列表经常执行内存分配。我最终做的是编写自己的哈希表，该哈希表使用我可以解决这个问题的区域分配器。效果很好。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-09T21:04:19.620

我认为你可以只散列对象，因为真正的顺序并不重要，只有分组。相同的对象最终将分组在同一个存储桶中。这是假设您感兴趣的每种类型都有自己的哈希函数，或者您可以定义自己的并重载它（将每种类型作为不同 hashCode 函数定义的参数）。

为了避免数据类型之间的冲突（例如，字符串不会与双精度数在同一个桶中结束），您需要将数据类型编码到哈希中。因此，例如，如果您有一个 32 位哈希，那么前 5 位可能会编码数据类型，因此您可以在同一个哈希映射中拥有 32 种不同的类型。

编辑：让我补充一点，我建议使用自定义哈希映射的原因是因为我不知道有一个会公开足够的内部实现，以便您从每个存储桶中获取值。可能有这样一个我不知道的实现。有很多事情我不知道。:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T22:17:41.017

您在这里寻找的神奇词是*multiset*（或*bag*）。这根本不是一种排序，因为只要将具有相同键的所有元素组合在一起，您就不会关心顺序。有几种可用的罐头实现，具体取决于您使用的语言，但总的来说，上面的散列版本是渐近最优的，我相信：`insert()`是恒定时间，因为您可以在*O(1)*中计算散列并将碰撞插入附加到*O(1)*时间内的列表；*您可以在O(1)*时间内从 bin 中检索一个元素，只需抓取 bin 中的第一个元素；因此，您可以在*O(n)*时间内收集所有这些，因为您检索*n*每个元素的*O(1)*元素。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-09T21:10:52.993

当有大量已排序的数据运行时（例如，在您的示例中，相同的对象），如 python 的内置排序（cf [timsort](http://svn.python.org/projects/python/trunk/Objects/listsort.txt) ），疾驰的合并排序具有良好的预期性能 - 您将跳过 O(log( N)) 每次合并工作。如果您的数据集非常大（这称为“外部”排序），您还可以在多个 CPU 和磁盘上分布合并排序。然而，这将是最坏的情况 O(Nlog(N))。

唯一比 Nlog(N) 更快的排序是计数排序，它利用了键的一些共同属性。要使用线性时间排序（哈希表或基数/桶排序），您必须对结构进行哈希处理以生成某种数字键。

基数排序会多次遍历键，因此它的预期时间会比哈希表方法长；而且，由于您不关心字典顺序，因此哈希表解决方案对您来说听起来更好，如果您有能力对键进行哈希处理。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T21:14:11.567

当有大量重复项时，[3 路快速排序表现非常好。](http://www.sorting-algorithms.com/quick-sort-3-way)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-09T21:16:47.130

我认为散列到桶中将是最好的解决方案，假设有一个保留 operator= 映射的散列（0.0 可能不会散列到同一事物 -0.0，但它们可能是“相等的”）。假设您只有一个等于和小于运算符，您可以实现一个基本的快速排序算法，选择第一个元素作为枢轴，并将小于放在一个组中，将大于另一个组，然后重复每个组的过程。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T21:16:04.060

如果您知道可能值的范围，并且它很小，您可以这样做：（伪代码）

```
uint[] bucket = new int[10];
foreach(uint val in foo) {
    ++bucket[val];
}

uint bar_i = 0;
uint[] bar = new int[foo.length];
foreach(int val = 0; val < 10; val++) {
    uint occurrences = bucket[val];
    for(int i=0; i < occurrences; i++) {
        bar[bar_i++] = val;
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-09T21:19:37.563

我认为，由于您有不想复制太多的任意对象，您可以只使用引用或指针进行排序，如果需要，然后按顺序复制对象。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-09T21:36:24.657

也许是 R+B 或 AVL 树？再说一遍 - 它最终仍然是 O(NlogN)。还不如使用 heapsort - 不会更糟，也没有额外的内存使用......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-10T07:16:03.770

性能阶为 O( n ( n-1) / 2 ) 的简单算法如下：

1.  假设输入数组名为 Input，大小为 n。
2.  为具有相同大小的返回数组分配内存，命名为 Result
3.  为名为 Visited 的大小相同的布尔数组分配内存，并将所有 Visted 设置为 false
4.  假设有一个名为 Equals 的 Equal 函数，如果两个项目相等则返回 true，否则返回 false。
5.  假设数组索引从 1 到 n
6.  请参阅下面的伪 C 代码：

```
function groupIdentical(Input) 
{
    k=1;
    for i=1 to n 
    {
        Visited[i]=false ;
    }

    for i=1 to n
    {
        if( !Visited(i) )
        {   
            Result[k++]=Input[i];
            for j= (i+1) to n
            {
                if( Equals(i,j) )
                {
                    Result[k++]=Input[j];
                    Visited[j]=true;
                }   
            }
        }
    }
    return Result;
} 
```

# sql - 在 Firebird 中结合 UNION ALL 和 ORDER BY

> ID：354224
> 
> 赞同：16
> 
> 时间：2008-12-09T21:00:58.940
> 
> 标签：sql, database, database-design, firebird

这是我第一次尝试回答我自己的问题，因为有人可能会遇到这个问题，所以它可能会有所帮助。使用 Firebird，我想使用 UNION ALL 组合两个查询的结果，然后对给定列的结果输出进行排序。就像是：

```
(select C1, C2, C3 from T1)
union all 
(select C1, C2, C3 from T2)
order by C3 
```

括号来自其他数据库的有效语法，并且需要确保 UNION ALL 的参数（定义为在表上工作的操作 - 即*无序*的记录集）不会尝试单独排序。但是我无法让这种语法在 Firebird 中工作 - 怎么做？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-12-09T21:08:04.620

```
SELECT C1, C2, C3
FROM (
    select C1, C2, C3 from T1
    union all 
    select C1, C2, C3 from T2
)
order by C3 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-09T22:18:00.173

字段名称不需要相同。这就是为什么您不能在 order by 中使用字段名称的原因。
您可以改用字段索引。如：

```
(select C1, C2, C3 from T1)
union all 
(select C7, C8, C9 from T2)
order by 3 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2015-06-23T15:15:12.237

怎么样：

```
select C1, C2, C3 from T1
union all 
select C1, C2, C3 from T2
order by 2 
```

至少在较新的 Firebird 版本中，如果您按“编号”而不是使用别名进行订购，它可以工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T14:48:14.843

在 Firebird 1.5 中，这对我有用

```
create view V1 (C1, C2, C3) as
  select C1, C2, C3 from T1
  union all 
  select C1, C2, C3 from T2 
```

进而

```
select C1, C2, C3 from V1 order by C3 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-09T21:02:06.317

在视图中执行 UNION ALL（没有 ORDER BY 子句），然后使用 ORDER BY 从视图中进行选择。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-04-17T21:59:44.487

移动`order by`到查询尾部对输出数据网格**没有影响。**

```
select * from (
    select first 1
        C1
    from T1
    order by id desc
)
union all
select * from (
    select first 1
        C1
    from T2
    order by id desc
)
```

# c# - SqlDataSource 和 Oracle DataProvider 我似乎无法将 sqlDataprovider 与 odp.net 一起使用

> ID：354226
> 
> 赞同：0
> 
> 时间：2008-12-09T21:02:42.417
> 
> 标签：c#, asp.net, oracle, odp.net

我希望能够针对 oracle 存储过程运行我的 SqlDataProvider。我可以使用 Microsoft 的 Oracle Provider，但这不允许我调用存储过程。有没有人能让这个工作？我特别希望能够使用声明性数据绑定。我已经能够以编程方式创建一个 DataTable，但我想在 .aspx 中以声明方式执行此操作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-14T11:40:43.580

System.Data 命名空间中的 SqlDataProvider、SqlConnection 和其他以 Sql 为前缀的类几乎普遍指的是 SQL-Server 特定的实现。但是，可以使用 Microsoft 发布的 System.Data.oracleClient 库调用存储过程。

请确保在构造 OracleCommand 时传入 CommandType。**存储过程**。否则，数据库引擎将默认为“表直接”访问，并且由于它找不到具有存储过程名称的表，因此它会失败。

这是一些关于如何在幕后工作的示例代码：

```
using (OracleConnection conn = new OracleConnection("connection string here"))
{
    conn.Open();

    OracleCommand command = conn.CreateCommand();
    command.CommandType = CommandType.StoredProcedure;

    command.CommandText = "DATABASE_NAME_HERE.SPROC_NAME_HERE";
    // Call command.Parameters.Add to add your parameters.

    using (OracleReader reader = command.ExecuteReader())
    {
        while(reader.Read())
        {
            // Process each row
        }
    }

} 
```

使用 ASP .NET 时，您可以使用 SqlDataSource 访问 oracle 客户端，其连接字符串定义如下：

```
<add name="OracleConnectionString"
  connectionString="Data Source=YourServer;Persist 
    Security Info=True;Password="******";User ID=User1"
  providerName="System.Data.OracleClient" /> 
```

请注意，我们在那里有 OracleClient 位。然后在 SqlDataSource 上将其上的 Select **CommandType**设置为ASPX 页面中的 StoredProcedure，其余的工作几乎与 SQL Server 类似（实际上，您实际上必须这样做才能调用 SQL Server 版本）。

结果看起来有点像：

```
 <asp:SqlDataSource ID="SqlDataSource1" runat="server" ConnectionString="<%$ ConnectionStrings:OracleConnectionString %>"
            ProviderName="<%$ ConnectionStrings:OracleConnectionString.ProviderName %>" SelectCommand='TEST_ONE' SelectCommandType="StoredProcedure" ></asp:SqlDataSource> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-03-08T18:05:45.147

Here are the steps to return a table-like select statement::

1) You should return a cursor for the select, then add in the parameters io_cursor IN OUT CURSOR

2) When you Consume it add ANOTHER parameter

```
<asp:Parameter Name="io_cursor" Direction="Output" /> 
```

3) Add event procedure for 'selecting' event

4) protected void SqlDataSource1_Selecting (object sender, SqlDataSourceSelectingEventArgs e) { ((System.Data.OracleClient.OracleParameter)e.Command.Parameters[0]).OracleType = System.Data.OracleClient.OracleType.Cursor; }

Now it would work fine.

# database - 200 亿行/月 - Hbase / Hive / Greenplum / 什么？

> ID：354231
> 
> 赞同：31
> 
> 时间：2008-12-09T21:05:14.923
> 
> 标签：database, mapreduce, data-warehouse, greenplum, vldb

我想利用您的智慧为数据仓库系统找到正确的解决方案。这里有一些细节可以更好地理解问题：

数据以星型结构组织，具有一个 BIG 事实和约 15 个维度。
每月 20B 个事实行
10 个维度，百行（有点层次）
5 个维度，数千行
2 个维度，约 200K 行
2 个大维度，50M-100M 行

针对此数据库运行两个典型查询

**dimq 中的顶级成员：**

```
select    top X dimq, count(id) 
from      fact 
where     dim1 = x and dim2 = y and dim3 = z 
group by  dimq 
order by  count(id) desc 
```

**针对元组的措施：**

```
select    count(distinct dis1), count (distinct dis2), count(dim1), count(dim2),...
from      fact 
where     dim1 = x and dim2 = y and dim3 = z 
```

**问题：**

1.  执行此类查询的最佳平台是什么

2.  需要什么样的硬件

3.  它可以托管在哪里（EC2？）

    （请暂时忽略导入和加载问题）

Tnx，
哈盖。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-12-09T21:49:01.247

我不能强调这一点：*获得与现成的报告工具配合得很好的东西。*

每月 200 亿行将您置于 VLDB 领域，因此您需要分区。低基数维度也表明位图索引将是性能上的胜利。

*   忘记云系统（[Hive](http://hadoop.apache.org/hive/)、 [Hbase](http://hadoop.apache.org/hbase/)），直到它们拥有成熟的 SQL 支持。对于数据仓库应用程序，您需要与传统报告工具配合使用的东西。否则，您会发现自己永远陷入编写和维护临时报告程序的困境。

*   数据量可以通过 Oracle 等更传统的 DBMS 进行管理——我知道一家[主要的欧洲电信公司](http://www.telecomitalia.com/)每天将 600GB 的数据加载到[Oracle](http://www.oracle.com)数据库中。在所有其他条件相同的情况下，这比您的数据量大两个数量级，因此[共享磁盘架构](http://www.databasecolumn.com/2007/10/database-parallelism-choices.html)仍然为您提供空间。[像Netezza](http://www.netezza.com)或[Teradata](http://www.teradata.com)这样的无 [共享](http://en.wikipedia.org/wiki/Shared_nothing_architecture)架构 可能会更快，但这些卷的水平并没有超出传统的共享磁盘系统。但请记住，这些系统都非常昂贵。

*   还要记住 MapReduce[不是一种有效的查询选择算法](http://highscalability.com/database-people-hating-mapreduce)。从根本上说，它是一种分布式蛮力计算的机制。Greenplum 确实有一个 MapReduce 后端，但是一个专门构建的无共享引擎将更加高效，并且可以用更少的硬件完成更多的工作。

我对此的看法是，Teradata 或 Netezza 可能是这项工作的理想工具，但绝对是最昂贵的。 [Oracle](http://www.oracle.com)、[Sybase IQ](http://www.sybase.com/products/datawarehousing/sybaseiq)甚至[SQL Server](http://msdn.microsoft.com/en-us/sqlserver/default.aspx)也可以处理所涉及的数据量，但速度会慢一些——它们是共享磁盘架构，但仍然可以管理这种数据量。有关 Oracle 和 SQL Server 中 VLDB 相关特性的简要介绍，请参阅[这篇文章](https://stackoverflow.com/questions/126188/ms-sql-server-and-oracle-which-one-is-better-in-terms-of-scalability#126267)，并记住 Oracle 刚刚还引入了[Exadata 存储平台](http://www.oracle.com/solutions/business_intelligence/exadata.html)。

我的备份数据包容量计划建议每月大约 3-5 TB，包括 Oracle 或 SQL Server 的索引。尽管在 Oracle 上索引叶具有 16 字节的 ROWID 而在 SQL Server 上具有 6 字节的页面引用，但 Oracle 上的位图索引可能更少。

Sybase IQ 广泛使用位图索引并针对数据仓库查询进行了优化。虽然是共享磁盘架构，但它对于这种类型的查询非常有效（IIRC 它是原始的面向列的架构）。这可能比 Oracle 或 SQL Server 更好，因为它专门用于此类工作。

Greenplum 可能是一个更便宜的选择，但我从未真正使用过它，所以我无法评论它在实践中的效果如何。

如果您有 10 个只有几百行的维度，请考虑将它们合并为一个[垃圾维度](http://www.dmreview.com/news/1027074-1.html)，这将通过将十个键合并为一个来缩小您的事实表。您仍然可以在垃圾维度上实现层次结构，这将使事实表的大小减少 1/2 或更多，并消除索引对磁盘的大量使用。

我强烈建议您使用与合理横截面的报告工具配合得很好的东西。 *这意味着一个 SQL 前端。*[Crystal Reports](http://www.businessobjects.com/product/catalog/crystalreports/) 等商业系统允许具有更容易获得的 SQL 技能集的人员完成报告和分析。开源世界也产生了[BIRT](http://www.eclipse.org/birt/phoenix/)、[Jasper Reports](http://www.jaspersoft.com/JasperSoft_JasperReports.html?utm_source=google&utm_medium=cpc&utm_content=JasperReports&utm_campaign=JasperReportsSearchjasperreports)和[Pentaho。](http://www.pentaho.com). Hive 或 HBase 让您从事构建自定义前端的业务，除非您乐于在接下来的 5 年中用 Python 编写自定义报告格式化程序，否则您*真的不想要它。*

最后，将其托管在您可以轻松从生产系统获取快速数据馈送的地方。这可能意味着您在自己的数据中心拥有自己的硬件。该系统将受 I/O 限制；它对大量数据进行简单处理。这意味着您将需要具有快速磁盘子系统的机器。云提供商往往不支持这种类型的硬件，因为它比这些机构传统上使用的一次性 1U 盒子类型贵一个数量级。快速磁盘 I/O 不是云架构的优势。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-20T00:50:31.873

I have had great success with [vertica](http://www.vertica.com/). I am currently loading anywhere between 200 million to 1 billion rows in a day - averaging about 9 billons row a month - though I have gone as high as 17 billion in a month. I have close to 21 dimensions and the queries run blazingly fast. We moved on from the older system when we simply didn't have the windows of time to do the dataload.

we did a very exhaustive trial and study of different solutions - and practically looked at everything on the market. While both Teradata and Netezza would have suited us, they were simply too expensive for us. Vertica beat them both on the price/performance ratio. It is by the way a columnar database.

We have about 80 users now - and it is expected to grow to about 900 by the end of next year when we start rolling out completely.

We are extensively using ASP.NET/dundas/reporting services for reports. It also plays nice with third party reporting solutions - though we haven't tried it.

By the way what are you going to use for dataload ? We are using [informatica](http://www.informatica.com) and have been very pleased with it. SSIS drove us up the wall.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-10-01T09:23:33.043

使用 HBase 和 jasperserver hbase 报告插件，可以创建体面的报告。可以在 HBase 中创建低延迟 OLAP。这将与 SQL 一样工作。Jasperserver HBase 插件提供 Hbase 查询语言，它是一个扩展的 Hbase 扫描命令。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-01-25T16:22:36.840

我很好奇你最后选择了什么。你的问题是 2008 年底的问题。今天情况有所不同，HBase、Greenplum、pig 等提供类似 SQL 的访问权限。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-20T00:17:04.187

阅读 Monash 的网站：[http](http://www.dbms2.com/) ://www.dbms2.com/他撰写有关大型数据库的文章。

也许您可以使用 Oracle Exadata（[http://www.oracle.com/solutions/business_intelligence/exadata.html](http://www.oracle.com/solutions/business_intelligence/exadata.html)和 [http://kevinclosson.wordpress.com/exadata-posts/](http://kevinclosson.wordpress.com/exadata-posts/)）或者您可以使用 Hadoop。Hadoop是免费的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-12T13:42:38.237

NXC，你确定每天有 6000 亿行吗？即使一行只有一个字节，也就是每天 600 GB 的数据。假设每行 100 字节更合理，我们谈论的是每天 60 TB 的数据，每月 1.8 PB。我真的怀疑是否有人通过 Oracle 抽取了这么多数据。

[其他消息来源](http://www.dbms2.com/2008/09/04/data-warehouse-sizes-issues/ "其他来源")似乎证实，当数据量达到 2 位 TB 数字时，Oracle 变得非常难以处理。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-11T13:41:20.200

少量用户的替代方案是（beowulf）集群。20K 可以为您购买 50 个网络机，每个网络机 500G。这大约是3KW的峰值功率。或 4 个月的云存储。

# sql-server - 如何为开发目的复制共享的 MSSQL 2005 数据库？

> ID：354232
> 
> 赞同：1
> 
> 时间：2008-12-09T21:05:15.750
> 
> 标签：sql-server, replication, shared-hosting, mirroring

为了开发目的，我想直接在集成服务器上复制 MSSQL 2005 db（通过共享托管提供商托管）。MSSQL 服务器提供了很多执行数据复制的方法，但我不确定它们中的任何一种是否与典型的共享托管环境兼容。

这个想法是每天更新一次数据库，如果可以增量完成会更好。知道如何进行吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T21:31:39.237

有几种方法可以做到这一点。

1.  使用 SQL Server 2005 的复制功能，但如果 SQL 代理没有破坏或有任何权限限制，它会失败 - 最喜欢发生在共享主机上。

2.  使用 SQL Server 备份/恢复：问题通常是您无法访问具有共享主机的数据库服务器文件系统。

3.  在开发服务器上复制数据库模式，然后做一个DTS传输数据，你可以保存DTS包（如果需要甚至可以手动编辑它）并在开发机器中设置一个计划任务，它会每天自动同步数据库，它可能不是增量的，取决于您的数据库设计/架构。

选项 3 似乎需要更多的工作，但实际上它很容易设置，从长远来看会为您节省大量时间。

我也想听到任何其他建议。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T21:42:07.003

这实际上取决于托管环境的设置方式

我曾经有工作到主机：在 SQL Server 上备份 SQL DB，复制到 Web/FTP 服务器内部：FTP 下载备份文件，在 SQL Server 上恢复

这并不好玩，但是一旦设置好，它大部分时间都可以工作

如果远程 SQL Server 很容易访问，您可以设置 SQL 复制，每天使用快照复制（基本上安排备份和恢复）

我现在有一个使用快照复制从服务器数据库复制到我计算机自己的 SQL Server 的数据库（我是通过向导完成的）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T21:18:44.037

试试 SQL Server Publishing Wizard 1.2，它包含在 VS 2008 中。或者在这里下载 1.1 版本：

[http://www.microsoft.com/downloads/details.aspx?familyid=56E5B1C5-BF17-42E0-A410-371A838E570A&displaylang=en](http://www.microsoft.com/downloads/details.aspx?familyid=56E5B1C5-BF17-42E0-A410-371A838E570A&displaylang=en)

# linq-to-sql - LINQ-to-SQL CompiledQuery.Compile() 与更新、删除、插入？

> ID：354245
> 
> 赞同：7
> 
> 时间：2008-12-09T21:08:42.297
> 
> 标签：linq-to-sql, precompiled

全部，

因此，我已将 LINQ-to-SQL 中的所有选择查询转换为使用 CompiledQueries 来加快速度。到目前为止，对于选择语句来说效果很好，但我无法弄清楚如何预编译插入、更新或删除语句。

当然，当您在 LINQ-to-SQL 中插入、删除或更新时，您必须使用对象模型。但显然它在生成查询的过程中的某个地方，可以很好地预编译并存储在静态成员中。

这可能吗？未预编译时，更新、删除和插入的 LINQ 性能如何？我可以看到它比选择要快得多，因为它们在下面做的事情要简单得多，而且“动态”更少……

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-09T21:46:17.587

有一个很大的不同。Linq-To-SQL 选择查询可以是大型复杂的表达式树。这些可能需要一些时间“编译”。在这种情况下，合并到一些可以针对 SQL Server 运行的 T-SQL。因此，缓存操作的结果以便可以重复使用是有意义的。

然而，其他删除、更新和插入都是简单的操作，不需要将表达式树转换为 T-SQL（LINQ 本身就是关于查询的）。不幸的是，我们被训练将执行这些其他操作的 SQL 代码视为“查询”，我们实际上并没有询问任何信息。

这些操作仅由 DataContext 而非 LINQ 定义，因此执行这些功能的代码已经编译。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-10T06:03:29.923

我认为三个唯一的插入对于能够编译和重用是有意义的，因为删除非常简单（从表中删除键...）并且更新只更新已更改的字段，因此每次更新操作都会有所不同。

[]亚眠

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T11:43:48.130

L2S 使用“sp_executeSQL”，因此在您第一次运行它后，它将在存储过程执行计划缓存中。随后的运行（相同的查询 - 不同的参数）将重用缓存中的编译计划。因此，您所要求的将由 SQL Server“在幕后”自动处理。

# caching - 用于编译的 RAM 驱动器 - 有这样的事情吗？

> ID：354254
> 
> 赞同：55
> 
> 时间：2008-12-09T21:11:43.227
> 
> 标签：caching, compilation, directory, ramdrive

~~[Stack Overflow 上的一个问题的答案](https://stackoverflow.com/questions/354160/what-do-you-do-while-your-codes-compiling#354176)~~ **（见下文）**让我想到了一个很棒的小软件，它对世界各地的编码人员来说都是无价的。

我在想象 RAM 驱动器软件，但有一个关键的区别 - 它会镜像我硬盘驱动器上的真实文件夹。更具体地说 - 包含我当前正在处理的项目的文件夹。这样，任何构建几乎都是瞬时的（或者至少快几个数量级）。RAM 驱动器将仅使用空闲资源在后台将其内容与硬盘驱动器同步。

快速的谷歌搜索什么也没发现，但也许我只是不知道如何谷歌。也许有人知道这样的软件？最好是免费的，但合理的费用也可以。

**补充：**已经提出了一些我一开始就放弃的解决方案。它们将是（无特定顺序）：

*   **购买更快的硬盘驱动器（可能是[SSD](http://en.wikipedia.org/wiki/Solid-state_drive)或 10K RPM）。**我不想要硬件解决方案。不仅软件有可能变得更便宜（免费软件，有人吗？），而且它还可以用于硬件修改即使不是不可能的情况下也不受欢迎的环境 - 例如，在办公室。
*   **让 OS/HDD 进行缓存 - 它更清楚如何使用您的空闲 RAM。**OS/HDD 具有通用缓存算法，可以缓存所有内容并尝试预测未来最需要哪些数据。他们不知道对我来说优先级是我的项目文件夹。众所周知，它们并没有真正缓存它。;)
*   **周围有很多 RAM 驱动器；使用其中之一。**对不起，那将是鲁莽的。只要有一点空闲时间，我就需要将我的数据同步回 HDD。在电源故障的情况下，我可以忍受失去最后五分钟的工作，但不是自上次签到以来的所有工作。

**补充 2：**一个想法出现了 - 使用普通的 RAM 驱动器加上一个后台文件夹同步器（但我的意思是**background**）。有没有这样的事情？

**补充3：**有趣。我刚刚在工作中试用了一个简单的 RAM 驱动器。重建时间从 ~14 秒下降到 ~7 秒（还不错），但增量构建仍然在 ~5 秒 - 就像在 HDD 上一样。任何想法为什么？它使用`aspnet_compiler`和`aspnet_merge`。也许他们对其他地方的其他临时文件做了一些事情？

**添加了 4：**哦，不错的新答案集！:) 好的，我为所有反对者提供了更多信息。:)

产生这个想法的主要原因之一不是上述软件（构建时间为 14 秒），而是我当时无法访问的另一个软件。这个另一个应用程序有一个 100 MB 的代码库，它的完整构建大约需要 5 分钟。啊，是的，它在[Delphi 5](http://en.wikipedia.org/wiki/Embarcadero_Delphi)中，所以编译器不是太先进。:) 将源放在 RAM 驱动器上会产生很大的不同。我想不到一分钟就知道了。我没有量过。因此，对于所有那些说操作系统可以更好地缓存内容的人——我不敢苟同。

**相关问题：**

> [用于加速 IDE 的 RAM 磁盘](https://stackoverflow.com/questions/501718/ram-disk-for-speed-up-ide)

**第一个链接的注意事项：** 它链接的问题已被删除，因为它是重复的。它问：

> 编译代码时你在做什么？

[我链接到的Dmitri Nesteruk](https://stackoverflow.com/users/9476/dmitri-nesteruk)的答案是：

> 我几乎立即编译。部分原因是我的项目很小，部分原因是使用了 RAM 磁盘。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-09T22:58:59.560

在 Linux 中（您从未提及您使用的是哪个操作系统，因此这*可能*是相关的）您可以从 RAM 创建块设备并像任何其他块设备（即 HDD）一样安装它们。

然后，您可以创建在启动/关闭时以及定期复制到该驱动器和从该驱动器复制的脚本。

例如，您可以将其设置为拥有`~/code`和`~/code-real`。您的 RAM 块`~/code`在启动时安装，然后`~/code-real`（在标准硬盘上）中的所有内容都会被复制。关机时，所有内容都将被复制（[rsync](http://en.wikipedia.org/wiki/Rsync)会更快）`~/code`从`~/code-real`. 您可能还希望该脚本定期运行，因此在电源故障等情况下您不会丢失太多工作。

我不再这样做了（当 9.5 测试版运行缓慢时，我将它用于[Opera ，不再需要了）。](http://en.wikipedia.org/wiki/Opera_%28web_browser%29)

[这是在 Linux 中创建 RAM 磁盘的方法。](http://www.vanemery.com/Linux/Ramdisk/ramdisk.html)

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-27T04:03:35.140

我很惊讶有多少人建议操作系统在确定缓存需求方面比在这种特殊情况下做得更好。虽然我没有为编译执行此操作，但我确实为类似的过程执行了此操作，最终我使用了带有脚本的 RAM 磁盘来自动同步。

在这种情况下，我想我会使用现代源代码控制系统。在每次编译时，它会自动检查源代码（如果需要，沿着实验分支），以便每次编译都会导致数据被保存。

要开始开发，请启动 RAM 磁盘并拉出当前基线。进行编辑、编译、编辑、编译等 - 一直在为您保存编辑。

高兴时进行最后检查，您甚至不必使用常规硬盘驱动器。

但是有一些后台同步器可以使事情自动化——问题是它们也不会针对编程进行优化，并且可能需要偶尔进行完整的目录和文件扫描以捕捉更改。源代码控制系统正是为此目的而设计的，因此即使它存在于您的构建设置中，它也可能会降低开销。

请记住，在断电的情况下，后台同步任务是未定义的。如果出现问题，您最终将不得不弄清楚哪些已保存，哪些未保存。使用定义的保存点（在每次编译时，或手动强制），您会很清楚它至少处于您认为可以编译它的状态。使用[VCS](https://en.wikipedia.org/wiki/Revision_control)，您可以轻松地将其与之前的代码进行比较，并查看您已经应用了哪些更改。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-10T00:28:48.023

请参阅*[使用 tmpfs 加速emerge](https://wiki.gentoo.org/wiki/Speeding_up_emerge_with_tmpfs)*（[Gentoo Linux](https://en.wikipedia.org/wiki/Gentoo_Linux) wiki）。

在 Gentoo 下使用 RAM 驱动器加速编译是许多年前编写的操作指南的主题。它提供了一个具体的例子来说明已经做了什么。要点是所有源文件和构建中间文件都被重定向到 RAM 磁盘进行编译，而最终的二进制文件被定向到硬盘驱动器进行安装。

此外，我建议您探索在硬盘驱动器上维护您的源代码，但`git push`您的最新源代码更改为驻留在 RAM 磁盘上的克隆存储库。编译克隆。使用您喜欢的脚本来复制创建的二进制文件。

我希望这会有所帮助。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-10-25T23:00:42.823

使用[https://wiki.archlinux.org/index.php/Ramdisk](https://wiki.archlinux.org/index.php/Ramdisk)制作 RAM 盘。

然后我编写了这些脚本来将目录移入和移出 RAM 磁盘。在移动到 RAM 磁盘之前，在[tar](http://en.wikipedia.org/wiki/Tar_%28computing%29)文件中进行备份。这样做的好处是路径保持不变，因此您的所有配置文件都不需要更改。完成后，使用`uramdir`恢复磁盘。

编辑：添加了 C 代码，它将运行在后台间隔内给出的任何命令。如果有任何更改，我将发送它`tar`以`--update`更新存档。

我相信这种通用解决方案胜过为非常简单的事情制定独特的解决方案。吻

**确保将路径更改为 rdbackupd**

### 内存目录

```
#!/bin/bash

# May need some error checking for bad input.

# Convert relative path to absolute
# /bin/pwd gets real path without symbolic link on my system and pwd
# keeps symbolic link. You may need to change it to suit your needs.
somedir=`cd $1; /bin/pwd`;
somedirparent=`dirname $somedir`

# Backup directory
/bin/tar cf $somedir.tar $somedir

# Copy, tried move like https://wiki.archlinux.org/index.php/Ramdisk
# suggests, but I got an error.
mkdir -p /mnt/ramdisk$somedir
/bin/cp -r  $somedir /mnt/ramdisk$somedirparent

# Remove  directory
/bin/rm -r $somedir

# Create symbolic link. It needs to be in parent of given folder.
/bin/ln -s /mnt/ramdisk$somedir $somedirparent

#Run updater
~/bin/rdbackupd "/bin/tar -uf $somedir.tar $somedir" & 
```

### 乌拉姆迪尔

```
#!/bin/bash

#Convert relative path to absolute
#somepath would probably make more sense
# pwd and not /bin/pwd so we get a symbolic path.
somedir=`cd $1; pwd`;

# Remove symbolic link
rm $somedir

# Copy dir back
/bin/cp -r /mnt/ramdisk$somedir $somedir

# Remove from ramdisk
/bin/rm -r /mnt/ramdisk$somedir

# Stop
killall rdbackupd 
```

rdbackupd.cpp

```
#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <signal.h>
#include <sys/time.h>

struct itimerval it;
char* command;

void update_archive(int sig)
{
    system(command);
}

int main(int argc, char**argv)
{
    it.it_value.tv_sec     = 1;   // Start right now
    it.it_value.tv_usec    = 0;
    it.it_interval.tv_sec  = 60;  // Run every 60 seconds
    it.it_interval.tv_usec = 0;

    if (argc < 2)
    {
        printf("rdbackupd: Need command to run\n");
        return 1;
    }
    command = argv[1];

    signal(SIGALRM, update_archive);
    setitimer(ITIMER_REAL, &it, NULL); // Start

    while(true);

    return 0;
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-09T21:32:27.910

几年前我们曾经为[4GL](https://en.wikipedia.org/wiki/Fourth-generation_programming_language)宏编译器这样做；如果您将宏库和支持库以及您的代码放在 RAM 磁盘上，编译应用程序（在 80286 上）将从 20 分钟缩短到 30 秒。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-09T21:41:05.663

我没有你要找的东西，但我现在正在使用[Ramdisk](http://www.mydigitallife.info/2007/05/27/free-ramdisk-for-windows-vista-xp-2000-and-2003-server/)和[DRAM ramdisk](http://www.acard.com.tw/english/fb01-product.jsp?prod_no=ANS-9010&type1_title=%20Solid%20State%20Drive&idno_no=270)的组合。由于这是 Windows，我对核心内存有 3 GB 的硬限制，这意味着我不能为 RAM 磁盘使用太多内存。9010 上额外的 4 GB 真的很震撼。我让我的 IDE 将其所有临时内容存储在固态 RAM 磁盘和[Maven](http://en.wikipedia.org/wiki/Apache_Maven)存储库上。DRAM RAM 磁盘具有闪存卡的备用电池。这听起来像是一个广告，但它确实是一个很好的设置。

DRAM 磁盘具有双 SATA-300 端口，并且在大多数测试中平均寻道时间为 0.0 毫秒；) 圣诞袜有什么用吗？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-09T23:31:22.320

1.  **轮廓。** 确保您对每个选项都进行了良好的测量。您甚至可以购买您已经拒绝的东西，对其进行测量，然后将其退回，因此您知道您正在使用良好的数据。

2.  **获得大量内存。**2 GB DIMM 非常便宜；4 GB DIMM 的价格略高于 100 美元/个，但与几年前计算机部件的成本相比，这仍然不是很多钱。无论您最终使用的是 RAM 磁盘还是只是让操作系统完成它的工作，这都会有所帮助。如果您运行的是 32 位 Windows，则需要切换到 64 位才能使用超过 3 GB 左右的容量。

3.  **Live Mesh**可以从您的本地 RAM 驱动器同步到云端或另一台计算机，为您提供最新的备份。

4.  **仅移动编译器输出。**将源代码保存在真实的物理磁盘上，但直接在 RAM 驱动器上创建 .obj、.dll 和 .exe 文件。

5.  **考虑一个[DVCS](https://en.wikipedia.org/wiki/Distributed_revision_control)。** 从真实驱动器克隆到 RAM 驱动器上的新存储库。经常将您的更改“推送”回父级，例如每次所有测试都通过时。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-03-11T06:31:57.507

是的，我遇到了同样的问题。在没有结果的谷歌搜索之后，我刚刚编写了一个 Windows 服务，用于延迟备份 RAM 驱动器（实际上 - 任何文件夹，因为 RAM 驱动器可以安装到例如桌面）。

[http://bitbucket.org/xkip/transparentbackup](http://bitbucket.org/xkip/transparentbackup) 您可以指定全面扫描的时间间隔（默认为 5 分钟）。以及只扫描通知文件的时间间隔（默认 30 秒）。扫描使用“存档”属性检测更改的文件（操作系统会重置该文件，专门用于存档目的）。仅备份以这种方式修改的文件。

该服务会留下一个特殊的标记文件，以确保目标备份正是源的备份。如果源为空且不包含标记文件，则服务会从备份执行自动恢复。因此，您可以轻松地销毁 RAM 驱动器并通过自动数据恢复再次创建它。最好使用能够在系统启动时创建分区的 RAM 驱动器，以使其透明地工作。

我最近检测到的另一个解决方案是[SuperSpeed SuperCache](http://www.superspeed.com/desktop/supercache.php)。

这家公司也有一个 RAM 磁盘，但那是另一个软件。SuperCache 允许您使用额外的 RAM 进行块级缓存（它与文件缓存非常不同），以及另一个选项 - 将您的驱动器完全镜像到 RAM。在任何情况下，您都可以指定将脏块放回硬盘驱动器的频率，像在 RAM 驱动器上一样进行写入，但镜像场景也像从 RAM 驱动器一样进行读取。您可以创建一个小分区，例如 2 GB（使用 Windows）并将整个分区映射到 RAM。

关于该解决方案的一件有趣且非常有用的事情 - 您可以随时更改缓存和镜像选项，只需单击两下即可。例如，如果您希望将 2 GB 的内存用于游戏或虚拟机 - 您可以立即停止镜像并释放内存。即使打开的文件句柄也不会中断 - 分区继续工作，但作为通常的驱动器。

编辑：我还强烈建议您将 TEMP 文件夹移动到 te RAM 驱动器，因为编译器通常会使用 temp 进行大量工作。就我而言，它又给了我 30% 的编译速度。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-09T21:38:06.137

您的操作系统会在运行时将内容缓存在内存中。RAM 磁盘可能看起来更快，但那是因为您没有考虑“复制到 RAMDisk”和“从 RAMDisk 复制”时间。将 RAM 专用于固定大小的 ramdisk 只会减少可用于缓存的内存。操作系统更清楚需要在 RAM 中存储什么。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-11-09T19:33:03.637

我有同样的想法并做了一些研究。我发现以下工具可以满足您的需求：

*   [VSuite 内存盘](http://www.romexsoftware.com/en-us/vsuite-ramdisk/)
*   [DiskBoost](http://www.everstrike.com/ramdisk/)

但是，第二个我根本无法在 64 位 Windows 7 上工作，而且目前似乎没有得到维护。

另一方面，VSuite RAM 磁盘运行良好。[不幸的是，与现有的SSD](http://en.wikipedia.org/wiki/Solid-state_drive)磁盘相比，我无法衡量任何显着的性能提升。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-10T00:06:34.433

我想知道您是否可以构建类似软件 RAID 1 的东西，其中您有一个物理磁盘/分区作为成员，还有一块 RAM 作为成员。

我打赌通过一些调整和一些非常奇怪的配置可以让 Linux 做到这一点。不过，我不相信这值得付出努力。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-27T05:31:20.233

> 周围有很多 RAMDrive，请使用其中之一。对不起，那将是鲁莽的。

仅当您完全在 RAM 磁盘中工作时，这很愚蠢..

伪 shell 脚本，ramMake：

```
# setup locations
$ramdrive = /Volumes/ramspace
$project = $HOME/code/someproject

# ..create ram drive..

# sync project directory to RAM drive
rsync -av $project $ramdrive

# build
cd $ramdrive
make

#optional, copy the built data to the project directory:
rsync $ramdrive/build $project/build 
```

也就是说，您的编译器可以在没有其他脚本的情况下执行此操作。只需将您的构建输出位置更改为 RAM 磁盘，例如在 Xcode 中，它位于 Preferences、Building、“Place Build Products in:”和“Place Intermediate Build Files在：”。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-27T04:29:41.693

即使在单核机器上也可能超级有益的是并行制造。磁盘[I/O](http://en.wikipedia.org/wiki/Input/output)在构建过程中是一个相当大的因素。每个 CPU 内核生成两个编译器实例实际上可以提高性能。由于一个编译器实例在 I/O 上阻塞，另一个通常可以跳转到编译的 CPU 密集部分。

你需要确保你有 RAM 来支持这个（在现代工作站上不应该是问题），否则你最终会交换，这会破坏目的。

在[GNU make](https://en.wikipedia.org/wiki/Make_%28software%29#Derivatives)上，您可以使用`-j[n]`where`[n]`是同时产生的进程数。在尝试之前确保你有你的依赖树，否则结果可能是不可预测的。

另一个真正有用的工具（在并行制作方式中）是[distcc](https://en.wikipedia.org/wiki/Distcc)。它适用于 GCC（如果您可以使用 GCC 或具有类似命令行界面的东西）。distcc 实际上通过伪装成编译器并在远程服务器上生成任务来分解编译任务。调用它的方式与调用 GCC 的方式相同，并利用 make 的 -j[n] 选项调用许多 distcc 进程。

在我之前的一份工作中，我们有一段时间几乎每天都在构建一个相当密集的 Linux 操作系统。添加几个专用的构建机器并将 distcc 放在几个工作站上以接受编译作业使我们能够将构建时间从半天缩短到 60 分钟以下，以完成完整的 OS + 用户空间构建。

还有很多其他工具可以加速现有的编译。您可能想要调查的不仅仅是创建 RAM 磁盘；由于操作系统正在使用 RAM 进行磁盘缓存，因此看起来它的收益很小。操作系统设计人员花费大量时间为大多数工作负载正确缓存；他们（集体）比你聪明，所以我不想尝试比他们做得更好。

如果您为 RAM 磁盘咀嚼 RAM，则操作系统用于缓存数据和运行代码的工作 RAM 较少 -> 您最终会得到更多的交换和更差的磁盘性能（注意：您应该在完全丢弃之前配置此选项它）。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-08-02T10:08:00.753

我对这个问题的最终解决方案是 vmtouch：[https](https://hoytech.com/vmtouch/) ://hoytech.com/vmtouch/ 这个工具将当前文件夹锁定到（ram）缓存中，vmtouch 守护进程进入后台。

```
sudo vmtouch -d -L ./ 
```

把它放在 shell rc 中以便快速访问：

```
alias cacheThis = 'sudo vmtouch -d -L ./' 
```

我找了一个现成的脚本很长一段时间，因为我不想浪费很多时间来编写自己的 ramdisk-rsync-script。我敢肯定我会错过一些边缘情况，如果涉及到重要代码，那将是非常不愉快的。而且我从不喜欢投票方式。

Vmtouch 似乎是完美的解决方案。此外，它不会像固定大小的 ramdisk 那样浪费内存。我没有做基准测试，因为我的 1Gig 源+构建文件夹的 90% 已经被缓存，但至少感觉更快；）

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-27T05:16:45.917

我脑子里冒出的一些想法：

使用 Sysinternals 的[Process Monitor](http://en.wikipedia.org/wiki/Process_Monitor)（不是[Process Explorer](https://en.wikipedia.org/wiki/Process_Explorer)）来检查构建过程中发生的事情 -`%temp%`例如，这将让您查看是否使用了（请记住，响应文件可能是使用 FILE_ATTRIBUTE_TEMPORARY 创建的，如果可能的话，它应该防止磁盘写入，尽管）。我已经将我的移动`%TEMP%`到一个 RAM 磁盘，这通常会给我带来轻微的加速。

获取支持自动加载/保存磁盘映像的 RAM 磁盘，因此您不必使用启动脚本来执行此操作。单个磁盘映像的顺序读/写比同步许多小文件要快。

将您经常使用的/大型头文件放在 RAM 磁盘上，并覆盖您的编译器标准路径以使用 RAM 驱动器副本。不过，在首次构建之后，它可能不会*有太大的改进，因为操作系统会缓存标准头文件。*

将源文件保存在硬盘上，并同步到 RAM 磁盘 -**而不是相反**。查看[MirrorFolder](http://www.techsoftpl.com/backup/index.php)以在文件夹之间进行实时同步 - 它通过过滤器驱动程序实现这一点，因此仅同步必要的内容（并且仅进行更改 - 4 KB 写入 2 GB 文件只会导致 4 KB 写入目标文件夹）。弄清楚如何从 RAM 驱动器构建您的[IDE](http://en.wikipedia.org/wiki/Integrated_development_environment)，尽管源文件在您的硬盘上……并记住，对于大型项目，您需要一个**大**的RAM 驱动器。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-09T21:16:15.760

这听起来像是您的操作系统和/或硬盘驱动器会自动为您处理的磁盘缓存（诚然，性能会有所不同）。

我的建议是，如果您不喜欢驱动器的速度，请购买纯粹用于编译目的的高速驱动器。减少您的劳动，您可能会找到解决编译问题的方法。

自从最初提出这个问题以来，与 SSD 相比，旋转硬盘已成为可怜的乌龟。它们与您可以从 Newegg 或 Amazon 购买的 SKU 中最初请求的 RAM 磁盘非常接近。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-09-27T21:36:58.297

您导致的磁盘减速主要是写入，也可能是由于病毒扫描程序。操作系统之间的差异也很大。

考虑到写入最慢的想法，我很想设置一个构建，其中中间（例如，`.o`文件）和二进制文件将输出到不同的位置，例如 RAM 驱动器。

然后，您可以将此 bin/intermediate 文件夹链接到更快的媒体（使用[符号链接](http://en.wikipedia.org/wiki/Symbolic_link)或[NTFS 连接点](https://en.wikipedia.org/wiki/NTFS_junction_point)）。

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2009-03-27T03:51:19.630

正如 James Curran 所说，事实上大多数程序都遵循引用的局部性定律，频繁的代码和数据页计数将随着时间的推移而缩小到 OS 磁盘缓存可管理的大小。

RAM 磁盘在构建具有诸如愚蠢缓存（Win 3.x、Win 95、DOS）等限制的操作系统时很有用。RAM 磁盘的优势几乎为零，如果您分配大量 RAM，它将占用系统缓存管理器可用的内存，从而损害整体系统性能。经验法则是：让你的内核去做。这与“内存碎片整理”或“优化器”程序相同：它们实际上会强制页面超出缓存（因此您最终会获得更多 RAM），但会导致系统在加载程序时随着时间的推移执行大量页面错误开始请求被分页的代码/数据。

所以为了获得更高的性能，获得一个快速的磁盘 I/O 硬件子系统，也许是 RAID、更快的 CPU、更好的芯片组（没有 VIA！）、更多的物理 RAM 等等。

# perl - 是否有解析嵌套括号的 CPAN 模块？

> ID：354263
> 
> 赞同：6
> 
> 时间：2008-12-09T21:15:26.883
> 
> 标签：perl, cpan

是否有可以读取这样的字符串的 CPAN 模块：

```
"[[<asdf>, <foo>], (abc, def, ghi), ({'jkl'})]" 
```

...并将其解析为某种易于行走和打印的树结构？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-09T22:23:59.273

[我认为您可以在Text::Balanced](http://search.cpan.org/dist/Text-Balanced/)之上构建，这将为您完成很多繁重的工作。不过，您仍然需要构建一个树形结构。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-10T01:20:16.780

Perl 5.10 的正则表达式可以处理这样的平衡结构。请参阅[perlre](http://perldoc.perl.org/perlre.html)`(?PARNO) (?-PARNO) (?+PARNO) (?R) (?0)`中的部分。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T22:37:13.647

[Perl 6](http://dev.perl.org/perl6/doc/design/apo/A05.html)将有内置的工具来帮助支持这一点。在此期间，Text::Balanced（如 Dave Rolsky 所述）可能是首选模块。请注意，它也是由 Damian Conway 编写的（由 Bill Karwin 推荐）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T21:28:46.607

[Damian Conway 的 Parse::RecDescent](http://search.cpan.org/perldoc?Parse::RecDescent)

我没有使用过这个，但可以肯定的是 Damian Conway 编写的 Perl 模块值得使用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T21:58:02.040

如果字符串与[Data Dumper](http://perldoc.perl.org/Data/Dumper.html)格式相同，则可以`eval`-ed 回到原始结构。

# java - 在 Java 正则表达式中否定文字字符串

> ID：354264
> 
> 赞同：4
> 
> 时间：2008-12-09T21:15:42.547
> 
> 标签：java, regex

所以正则表达式似乎匹配最长的匹配。例如：

```
public static void main(String[] args) {
    String s = "ClarkRalphKentGuyGreenGardnerClarkSupermanKent";
    Pattern p = Pattern.compile("Clark.*Kent", Pattern.CASE_INSENSITIVE);
    Matcher myMatcher = p.matcher(s);
    int i = 1;
    while (myMatcher.find()) {
        System.out.println(i++ + ". " + myMatcher.group());
    }
} 
```

生成输出

1.  克拉克拉尔夫肯特盖伊格林加德纳克拉克超人肯特

我想要这个输出

1.  克拉克拉尔夫肯特
2.  克拉克超人肯特

我一直在尝试像这样的模式：

```
 Pattern p = Pattern.compile("Clark[^((Kent)*)]Kent", Pattern.CASE_INSENSITIVE); 
```

这不起作用，但你明白我想说什么。我想要从 Clark 到 Kent 的字符串，其中不包含任何出现的 Kent。

这个字符串：

克拉克拉尔夫肯特盖伊格林加德纳布鲁斯蝙蝠侠肯特

应该产生输出

1.  克拉克拉尔夫肯特

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-09T21:25:48.393

贪婪与不情愿是你的朋友。

尝试：`Clark.+?Kent`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T21:27:38.030

你想要一个“不情愿”而不是“贪婪”的量词。简单地放一个？在你的 * 应该做的伎俩之后。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-09T21:38:23.250

当您尝试时`"Clark[^((Kent)*)]Kent"`，我认为您想要零宽度`"Clark((?!Kent).)*Kent"`的[负前瞻](http://perldoc.perl.org/perlre.html#Extended-Patterns)（向下滚动到“Look-Around Assertions”标题）。

括号指定字符匹配与模式匹配。因此，正则表达式试图找到一个不在`(, K, e, n, t, ), *`.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-09T21:27:34.287

使用不情愿的`?`后缀：`Clark.*?Kent` 量词`?`, `*`,`+`后面可以跟`?`以表示它们应该尽快停止。

看[http://perldoc.perl.org/perlre.html](http://perldoc.perl.org/perlre.html)

# excel - 无法在 Excel 数据透视表中显示度量差异

> ID：354277
> 
> 赞同：0
> 
> 时间：2008-12-09T21:20:06.330
> 
> 标签：excel, ssas, pivot-table, variance

我试图在 Excel (2007) 中显示从一天到下一天的度量差异，方法是将值字段设置设置为“Difference From”，Base field = day 和 Base item = previous。如果我的基础数据是 SSAS 多维数据集，则为每个单元格显示的值为 #N/A。如果我的基础数据是另一个工作表上的一组记录（并且我使用它来创建数据透视表），则该值会正确显示。两个数据集是相同的。

我需要创建一个计算多维数据集字段还是我遗漏了什么？

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T15:15:45.893

我最终使用了一个计算出来的立方体字段，如下所示：

> ([当前日期].[日期].CurrentMember, [Measures].[Volume]) - ([Current Day].[Day].CurrentMember.Lag(1), [Measures].[Volume])

# html - CSS display:inline property with list-style-image: property on 标签

> ID：354288
> 
> 赞同：20
> 
> 时间：2008-12-09T21:25:00.530
> 
> 标签：html, css

我在使用 CSS 的`display:inline`属性和标签`list-style-image:`上的属性时遇到问题。`<li>`基本上，我想输出以下内容：

```
* Link 1  * Link 2 
```

其中`*`代表一个图像。

我正在使用以下 HTML 代码：

```
<ol class="widgets">
    <li class="l1">Link 1</li>
    <li class="l2">Link 2</li>
</ol> 
```

使用以下 CSS 设置样式：

```
ol.widgets { list-style-type:none; }

ol.widgets li { display:inline;
                margin-left:10px; }

ol.widgets li.l1 { list-style-image:url(image1.gif); }

ol.widgets li.l2 { list-style-image:url(image2.gif); } 
```

问题是当列表项内联显示时，与列表项关联的图像不会出现。如果我取出标签上的属性，它们*确实会出现。*`display:inline``<li>`

即使列表项内联显示，有没有办法让图像显示出来，或者那是不可能的？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-12-09T21:30:24.357

尝试使用`float: left`(或`right`) 而不是`display: inline`. 内联显示取代了列表项显示，这是添加项目符号的原因。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-09T21:33:00.157

您希望列表项彼此相邻排列，但不是真正的内联元素。所以改为浮动它们：

```
ol.widgets li { 
    float: left;
    margin-left: 10px;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-07-10T15:02:46.723

我有类似的问题，我使用 css ":before" 解决。代码看起来像这样：

```
.widgets li:before{
    content:"• ";
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-09T21:38:13.127

如果你查看CSS 规范中[的 'display' 属性](http://www.w3.org/TR/CSS2/visuren.html#display-prop)，你会发现 'list-item' 是一个专门的显示类型。当您将项目设置为“内联”时，您将替换默认显示类型的列表项，并且[标记特别是列表项类型的一部分](http://www.w3.org/TR/CSS2/generate.html#lists)。

上面的答案建议浮动，但我已经尝试过了，但它不起作用（至少在 Chrome 上）。[根据规范](http://www.w3.org/TR/CSS2/visuren.html#float-position)，如果您将框设置为向左或向右浮动，“‘显示’将被忽略，除非它的值为‘无’。” 我认为这意味着一旦您浮动元素，“列表项”的默认显示类型就消失了（带上标记）。

编辑：是的，我想我错了。请参阅顶部条目。:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-07-05T11:43:35.610

你想要样式图像和导航到彼此然后像这样使用

```
ol.widgets ul
{
list-style-image:url('some-img.gif');
}
ol.widgets ul li
{
float:left;
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-09T21:44:31.990

我建议不要使用`list-style-image`，因为它在不同浏览器中的行为完全不同，尤其是图像位置

相反，你可以使用这样的东西

```
ol.widgets,
ol.widgets li { list-style: none; }
ol.widgets li { padding-left: 20px; backgroud: transparent ("image") no-repeat x y; } 
```

它适用于所有浏览器，并且会在不同的浏览器中为您提供相同的结果。

# ruby-on-rails - 在 Rails 迁移中，为 :limit 指定的整数代表什么？

> ID：354305
> 
> 赞同：20
> 
> 时间：2008-12-09T21:33:01.840
> 
> 标签：ruby-on-rails

在 Rails Migrations 中，为整数的 :limit 参数指定的数字代表什么？是字节数还是位数？

即，如果我要指定以下内容：

```
t.integer :coefficient, :limit => 2 
```

这是否意味着 SQL 数据库将为每个整数保留两个字节，或者每个整数不能超过两位？我假设它意味着字节，但我并不肯定。

谢谢！

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-09T21:38:14.810

根据[文档](http://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/TableDefinition.html#M001735)，它是和列的字符数以及`:string`和`:text`列的字节数。`:binary``:integer`

# regex - 正则表达式：用 '...' 替换 15 号之后的所有字符

> ID：354309
> 
> 赞同：2
> 
> 时间：2008-12-09T21:35:32.990
> 
> 标签：regex

我正在尝试在 linux 中使用“sed”进行一些简单的格式化操作，我需要使用正则表达式在第 15 个字符之后修剪字符串，并在末尾附加一个“...”。像这样的东西：

```
before: this is a long string that needs to be shortened
after: this is a long ... 
```

谁能告诉我如何把它写成一个正则表达式，如果可能的话解释它是如何工作的，以便我可以更好地学习正则表达式？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-09T21:38:22.250

以下对我有用：

```
echo "This is a test with more than 15 characters" | sed "s/\(.\{15\}\).\+$/\1…/" 
```

这里发生的是我们匹配任何字符 ( `.`) 15 次 ( `{15}`)。我们捕获括号内匹配的文本。以下部分 ( `.+$`) 匹配所有其余部分，直到行尾。我们用括号 ( `\1`) 中捕获的任何内容替换它，然后是双曲省略号。

为了满足`sed`的正则表达式方言（BRE），我们必须转义一些字符。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-09T21:46:29.160

Konrand Rudolph 的回答的解释，因为你要求解释（啊，当我写这个时，Konrad 也添加了他自己的解释！）

```
 sed "s/\(.\{15\}\).+$/\1…/"

\( 
```

开始一个组 - 要求正则表达式引擎记住括号内的内容，并将第一个这样的组分配给 \1，第二个分配给 \2 等等。我们在这里只需要 \1

```
. 
```

匹配任何东西...

```
\{15\} 
```

... 15 次。

```
\) 
```

结束组。所以 \1 将包含前 15 个字符

```
 .+ 
```

再次匹配任何东西。+ 表示“一次或多次”，因此将匹配我们上面匹配的 15 个字符以外的字符，...

```
 $ 
```

...直到行尾

现在对于替换位：

```
\1 
```

替换为 \1 的内容

```
... 
```

和三个点。

完毕！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-09T21:39:07.053

使用 Perl 正则表达式：

```
$ echo 'this is a long string that needs to be shortened' \
| perl -pe 's/^(.{15}).+/$1.../'
this is a long ... 
```

考虑正则表达式的最简单方法是将其视为需要匹配的模式。在这种情况下，模式从行首开始：

```
^ 
```

（请注意，这`/`是一个任意分隔符。可以使用其他字符。）`^`是表示正则表达式中行首的符号。接下来正则表达式匹配任何字符：

```
^. 
```

A`.`是任何字符的正则表达式符号。但我们要匹配前 15 个字符：

```
^.{15} 
```

有几种不同的修饰符表示重复。最常见的是`*`表示 0 或更多。A`+`表示 1 个或多个。 `{15}`显然正好代表 15。（`{...}`符号更通用。所以`*`可以写出来`{0,}`，`+`与 相同`{1,}`。）现在我们需要捕获前 15 个字符，以便我们以后可以使用它们：

```
^(.{15}) 
```

`(`和之间的所有内容都`)`被捕获并放置在一个称为`$1`（或有时`\1`）的特殊变量中。捕获的第二个块将被放入`$2`，依此类推。最后，您需要匹配到行尾，以便可以丢弃该部分：

```
^(.{15}).+ 
```

我最初使用`*`，但正如另一个人指出的那样，当字符串长度正好为 15 个字符时，这可能不是想要的：

```
$ echo 'this is a long ' \
| perl -pe 's/^(.{15}).*/$1.../'
this is a long ... 
```

`+`如果没有第 16^个字符要替换，则使用 a表示模式将不匹配。

语句的后半部分是打印出来的：

```
$1... 
```

使用了我们之前捕获的`$1`变量，并且点是`.`替换这一侧的文字 s。通常，除了正则表达式变量之外的所有内容都是替换语句右侧的文字。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T21:42:59.137

在 perl 中，您可以编写`s/(.{15}).*/$1.../`. 我不确定 sed 是否可以使用 {15} 表示法，但如果不能，`s/\(...............\).*/\1.../`（组中有 15 个点）。

`(`我永远不记得在 sed 中分组时是否需要逃跑。`\(`我刚试过，你确实需要`\)`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T04:06:38.800

您真的想在第 15 个字符之后删除所有内容，或者您​​是否试图强加 15 个字符的最大长度？如果字符串长度为 16 个字符怎么办？到目前为止提出的所有解决方案都将去掉一个多余的字符，只用*三个*点替换它。（我知道 Konrad 和 Paul 使用了省略号字符，但 OP 在示例中使用了三个点；我们应该对此作出裁决。）

如果要将字符串修剪到最大长度为 15 ，*包括三个点*，您可以这样做：

```
s/^\(.\{12\}\).\{3\}.\+$/\1.../ 
```

它仍然只在超过 15 个字符时才匹配，但是它会删除第 12 个字符之后的所有内容，以便为点腾出空间。

# git - 为什么运行“git branch -r”时显示“origin/HEAD”？

> ID：354312
> 
> 赞同：177
> 
> 时间：2008-12-09T21:36:29.323
> 
> 标签：git, version-control, github

当您运行时，`git branch -r`为什么会列出火焰`origin/HEAD`？例如，GitHub 上有一个远程仓库，比如有两个分支：master 和 awesome-feature。如果我`git clone`抓住它然后进入我的新目录并列出分支，我会看到：

```
$ git branch -r
origin/HEAD
origin/master
origin/awesome-feature 
```

或者它的顺序是什么（alpha？我假装这个例子来保持无辜回购的身份秘密）。那么有什么`HEAD`业务呢？`push`他们`HEAD`推的时候是最后一个被指的人吗？这不总是他们`push`编的吗？`HEAD`走来走去……我为什么要在乎别人`HEAD`在另一台机器上指着什么？

我只是在处理远程跟踪等问题，所以这是一个挥之不去的困惑。谢谢！

编辑：我的印象是专用远程存储库（例如 GitHub，没有人会 ssh 进入并处理该代码，但只能拉或推等）没有也不应该有 HEAD，因为基本上，没有工作副本。不是这样吗？

* * *

## 回答 #1

> 赞同：156
> 
> 时间：2011-07-27T02:14:35.170

**@robinst**是正确的。

在 git 中，您可以选择默认签出哪个分支（即当您克隆时）。默认情况下，`origin/HEAD`将指向那个。

在 GitHub 上，您可以在 GitHub 存储库的管理员设置中[更改此设置。](https://github.com/blog/421-pick-your-default-branch)您也可以从命令行通过

```
git remote set-head origin trunk 
```

或通过完全删除它

```
git remote set-head origin -d 
```

[例子](https://github.com/apache/ant)。查看“切换分支”下拉菜单。`trunk`被检查，所以`origin/HEAD`如下`trunk`。

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2010-05-21T15:08:06.400

裸存储库可以具有 HEAD 的原因是因为它确定了在克隆存储库后最初签出的分支。

通常，HEAD 指向 master，这是人们克隆存储库时签出的分支。将其设置为另一个分支（通过在裸存储库中编辑 HEAD）会导致该分支在克隆时被检出。

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2009-07-30T10:14:46.923

> 我的印象是专用的远程存储库（例如 GitHub，没有人会 ssh 进入并处理该代码，但只能拉或推等）没有也不应该有 HEAD，因为基本上没有工作复制。不是这样吗？

我和你说的印象一模一样。

我什至无法删除从 github 克隆的 origin/HEAD 远程跟踪分支

```
git branch -d -r origin/HEAD 
```

这没有效果。

有人能告诉我如何删除那个 origin/HEAD 远程跟踪分支吗？

## 更新

虽然我没有发现为什么从 github 克隆时会创建 origin/HEAD，但我找到了一种删除它的方法。

新版git提供

```
git remote set-head <name> -d 
```

删除远程跟踪分支的无用 HEAD 指针。

我们还可以通过使用将愚蠢的默认名称“origin”更改为我们想要的任何内容

```
git remote rename origin <new_name> 
```

希望这能有所帮助。:)

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-12-10T18:27:42.277

你说得对，当它们“裸露”时，即当它们没有工作目录时，**推送到专用远程存储库会更好。**Git 的架构设计用于通过补丁或`pull`( `fetch`) 进行更新，这在分布式 VCS 中是有意义的。正如文档在某处所说，推送到当前已签出的分支可能会导致**"unexpected results"**。

HEAD 是有效存储库要求的一部分。[Git 存储库布局](http://kernel.org/pub/software/scm/git/docs/v1.6.0.5/gitrepository-layout.html)部分说：

```
HEAD

A symref (see glossary) to the refs/heads/ namespace describing the currently active  
branch. It does not mean much if the repository is not associated with any working tree  
(i.e. a bare repository), but a valid git repository must have the HEAD file; some  
porcelains may use it to guess the designated "default" branch of the repository  
(usually master). It is legal if the named branch name does not (yet) exist. 
```

所以你会看到 HEAD 作为分支列表的一部分，即使“它没有多大意义......”

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-05-07T22:53:41.707

如果“origin”是远程存储库，则 origin/HEAD 标识该远程存储库上的默认分支。

例子：

```
$ git remote show
origin
$ git remote show origin
* remote origin
  Fetch URL: git@github.com:walkerh/pipe-o-matic.git
  Push  URL: git@github.com:walkerh/pipe-o-matic.git
  HEAD branch: master
  Remote branch:
    master tracked
  Local branch configured for 'git pull':
    master merges with remote master
  Local ref configured for 'git push':
    master pushes to master (fast-forwardable) 
```

请注意显示“HEAD 分支：master”的行。这是远程存储库让客户端知道默认签出哪个分支的地方。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-10T00:43:42.610

总是有一个 HEAD**指向**远程 repo 上当前签出的分支（可能是也可能不是 master）。即使是远程存储库也有当前的分支。通常它是主人，我想不出有什么理由要改变它，但它是可以改变的。

* * *

## 回答 #7

> 赞同：-14
> 
> 时间：2008-12-09T23:30:34.677

我的猜测是有人推了一个分支并称之为 HEAD：

```
git push origin HEAD 
```

# asp.net - 在 ASP.Net RangeValidator 脚本执行之前删除“$”

> ID：354313
> 
> 赞同：1
> 
> 时间：2008-12-09T21:37:40.723
> 
> 标签：asp.net, currency, rangevalidator

如何强制输入的 onchange 脚本在 RangeValidator 的脚本 *之前运行？*

当用户输入美元符号或逗号时，我想防止验证失败。

```
function cleanUp(str) {
    re = /^\$|,/g;
    return str.replace(re, ""); // remove "$" and ","
}

<input type="text" id="salary" runat="server"
onchange="this.value=cleanUp(this.value)" />

<asp:RangeValidator ID="salaryValidator" 
    runat="server" ErrorMessage="Invalid Number"
    ControlToValidate="salary" Type="Double" /> 
```

**更新：**
我决定使用 CustomValidator 来检查范围并使用货币 RegEx。谢谢迈克尔·尼斯克恩。

```
function IsCurrency(sender, args) {
    var input = args.Value;

    // Check for currency formatting.
    // Expression is from http://regexlib.com/REDetails.aspx?regexp_id=70
    re = /^\$?([0-9]{1,3},([0-9]{3},)*[0-9]{3}|[0-9]+)(.[0-9][0-9])?$/;
    isCurrency = input.match(re);

    if (isCurrency) {
        // Convert the string to a number.
        var number = parseFloat(CleanUp(input));
        if (number != NaN) {
            // Check the range.
            var min = 0;
            var max = 1000000;
            if (min <= number && max >= number) {
                // Input is valid.
                args.IsValid = true;
                return;
            }
        }
    }

    // Input is not valid if we reach this point.
    args.IsValid = false;
    return;
}

function CleanUp(number) {
    re = /^\$|,/g;
    return number.replace(re, ""); // remove "$" and ","
}       

<input type="text" id="salary" runat="server" />

<asp:CustomValidator ID="saleryValidator" ControlToValidate="salary" runat="server" 
ErrorMessage="Invalid Number" ClientValidationFunction="IsCurrency" /> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T22:09:39.800

您是否尝试过使用 CustomerValidator 控件并将 JS 清理方法和 RangeValidator 方法的功能结合起来。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-03-04T00:02:53.293

我认为我可以改进这一点。这使得逗号和美分数字是可选的：

```
^\$?([0-9]{1,3},?([0-9]{3},?)*[0-9]{3}|[0-9]+)(\.[0-9]{0,2})?$ 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T21:55:40.173

有一种方法可以通过注册脚本来做到这一点；但是为什么不使用正则表达式验证器来确保输入正确呢？

此外，范围验证器在字段 onBlur js 事件上执行，而不是在更改时执行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-17T23:45:55.723

刚刚注意到你有一个'。对于小数点，但这意味着正则表达式将接受该位置的任何字符。你应该使用`\.`那个小数点。

```
/^\$?([0-9]{1,3},([0-9]{3},)*[0-9]{3}|[0-9]+)(\.[0-9][0-9])?$/ 
```

# html - 在非格式良好的 HTML 中使用 XPath 查找节点（或靠近它）

> ID：354322
> 
> 赞同：4
> 
> 时间：2008-12-09T21:39:38.787
> 
> 标签：html, xpath, non-well-formed

我正在使用 XPath 在模板中定位一个节点（或接近它的东西），该模板具有大约 10 级深度的非格式良好的 HTML。（不，我没有写这个 HTML ......但我的任务是挖掘它。）

我似乎能够使用 Firefox 的 XPartner 附加组件检索相关元素的 XPath；但是它只给了我在实时站点中的位置，而不是在给我的模板中。（模板来自非标准的服务器端脚本语言；阅读内部构建的语言）

您知道有没有特别擅长处理非格式良好的 HTML 的 XPath 工具。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-10T02:21:20.793

**XPath 表达式不能针对非格式良好的 XML 文档进行评估**，这正是所描述的情况。

可以通过两个链接的步骤来执行此操作，第一个是将 HTML 转换为格式良好的 XML，然后是第二个 - 应用 XPath 表达式。

因此，这个问题可以更准确地表述为“如何将 HTML 转换为 XML，以便可以针对它评估 XPath 表达式”。

这里有两个很好的工具：

1.  **[TagSoup](http://home.ccil.org/~cowan/XML/tagsoup/)是一个开源程序**，是一个基于 Java 和 SAX 的工具，由[**John Cowan**](http://home.ccil.org/~cowan/)开发。这是一个用 Java 编写的符合 SAX 的解析器，它不是解析格式良好或有效的 XML，而是解析在野外发现的 HTML：糟糕、肮脏和野蛮，尽管通常很不短。TagSoup 是为那些必须使用某种看似合理的应用程序设计来处理这些东西的人设计的。通过提供 SAX 接口，它允许将标准 XML 工具应用于甚至最糟糕的 HTML。TagSoup 还包括一个命令行处理器，它可以读取 HTML 文件，并且可以生成干净的 HTML 或与 XHTML 非常接近的格式良好的 XML。Taggle 是 TagSoup 的商业 C++ 端口。

2.  **[SgmlReader](http://code.msdn.microsoft.com/SgmlReader)**是微软的[**Chris Lovett**](http://www.lovettsoftware.com/)开发的一个工具。SgmlReader 是任何 SGML 文档（包括对 HTML 的内置支持）的 XmlReader API。还提供了一个命令行实用程序，用于输出格式良好的 XML 结果。下载包含独立可执行文件和完整源代码的 zip 文件： [**SgmlReader.zip**](http://code.msdn.microsoft.com/SgmlReader/Release/ProjectReleases.aspx?ReleaseId=1442)

3.  [**由David Carlisle**](http://dpcarlisle.blogspot.com/)编写**[的纯 XSLT 2.0 HTML 解析器](http://www.dcarlisle.demon.co.uk/htmlparse.xsl)**。阅读它的代码对我们每个人来说都是一个很好的学习练习。

从描述：

"d:htmlparse(string) d:htmlparse(string,namespace,html-mode)

一种参数形式等价于) d:htmlparse(string,' [http://ww.w3.org/1999/xhtml](http://ww.w3.org/1999/xhtml) ',true()))

使用一些内置的启发式方法将字符串解析为 HTML 和/或 XML 以）控制元素的隐含打开和关闭。

它没有完整的 HTML DTD 知识，但有完整的空元素列表和完整的实体定义列表。HTML 实体，以及十进制和十六进制字符引用都被接受。请注意，即使 html-mode=false()，也可以识别 html-entities。

元素名称是小写的（如果 html-mode 为 true()）并放置在由命名空间参数指定的命名空间中（可能是 "" 表示无命名空间，除非输入有明确的命名空间声明，在这种情况下，这些将被尊重.

如果 html-mode=true()"，属性名称是小写的

[**在此处**](http://www.dcarlisle.demon.co.uk/htmlparse.xsl)阅读更详细的说明。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T22:40:11.393

XPath 不能直接用于 HTML。XPath 与 HTML 的交互取决于将 HTML 解析为呈现树的任何软件/库。这可能有助于适当地指导您的搜索。

# unicode - I18n 和非 US-ASCII、Latin1 或 Win1252 的密码

> ID：354323
> 
> 赞同：3
> 
> 时间：2008-12-09T21:39:38.847
> 
> 标签：unicode, utf-8, internationalization, passwords

当用户输入最能以 Unicode 或其他非拉丁字符编码表示的内容时，您如何处理服务密码？

具体来说，您可以使用西里尔密码作为 Oracle 的密码吗？如果密码以 UTF-8 格式提供，您如何根据 Windows 身份验证机制验证用户密码？

我对如何在我们的代码中处理这个问题有一些想法，但我正在寻求其他人的建议，以确保我们的方向是正确的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T10:08:18.197

编码本身不应该对加密造成问题，大多数算法都对字节而不是字符进行操作。唯一可能出现问题的是：如果密码中使用了外来（非 ASCII）字符，则使用不同的编码加密相同的密码可能会产生不同的值。不过，将密码转换为固定编码（如 UTF8）应该可以解决这个问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T15:02:52.393

您可能会遇到身份验证机制长度限制的问题。

例如，如果系统指定最大长度为 12 字节，这很容易被 utf-8 中的五个汉字超过，这不是问题，因为四个汉字应该有足够的熵，但是，你需要小心错误信息。

如果身份验证机制强制执行诸如“大写、小写、标点符号和数字字符中的至少一个”之类的规则，则可能会出现其他问题 - 几种语言没有大写/小写字符，并且在 unicode 中定义了许多本地字符说话者会认为是数字，但可能不会被执行不力的规则识别为数字。

# c++ - 任何人都知道一个好的 Windows 常量列表在哪里

> ID：354329
> 
> 赞同：-2
> 
> 时间：2008-12-09T21:41:17.830
> 
> 标签：c++, mfc, constants, visual-c++-6, numerical

我正在尝试将无效值设置为 -1.. 但我不喜欢幻数.. 任何人都知道在哪里可以找到一组公共常量。我在 VS6 (ish) 中工作。

我正在尝试从网络中读取文件，我需要一个错误的文件总大小值，所以我知道我是否得到了有效的信息。0 是有效的大小，所以我不能使用它。

哈珀谢尔比击中了头上的钉子……只是一个小拇指。他提到了win32常量..这正是我在想的..现在找到一个链接:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T21:46:13.140

```
#define BAD_VALUE -1 
```

编辑：最初的问题没有上下文。修改后的问题表明您想要一个无效的文件大小，因此正在寻找 win32 常量。看看[windows.h](http://en.wikipedia.org/wiki/Windows.h)我认为你寻找的常量可能在[windows.h](http://en.wikipedia.org/wiki/Windows.h)或其子包含之一中。grep 你的 Windows 包含目录 ;-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T21:46:55.137

如果 -1 是系统中返回值的无效值，则应在内部定义它：

```
const int INVALID_FOO = -1 
```

除非需要 C 兼容性，在这种情况下

```
#define INVALID_FOO -1 
```

将是首选。如果它是标准 MFC 或 Windows 资源，请使用 INVALID_HANDLE 或其他 Win32 定义的常量之一。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T23:46:19.387

您想使用自己的幻数 -1 伪装成 Windows 常量。这是非常具有误导性的。

假设我碰巧知道 INVALID_HANDLE 为 0。可以用 INVALID_HANDLE 初始化我的指针吗？

```
char *myMessage = INVALID_HANDLE; 
```

这对你有什么影响？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T00:19:41.770

在 VS 中，创建一个新的 windows 控制台应用程序项目。进入项目设置并打开浏览支持。创建一个 C++ 文件并将其添加到项目中。类型：

```
#include <windows.h>
void main(void) {} 
```

到文件中。编译它。现在在文件中输入 INVALID_FILE_SIZE。右键单击它并转到 INVALID_FILE_SIZE 的定义。VS 将打开许多包含已定义值的 Windows 头文件之一。享受。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T04:27:21.600

首先，您应该使用 unsigned int 作为文件大小，因为文件大小永远不会是负数。现在无效的文件大小通常是最大 int，因此在使用 32 位无符号整数的情况下，它将是 0xFFFFFFFF

IE

```
const unsigned int INVALID_FILESIZE = 0xFFFFFFFF; 
```

此外，如果这是在 Windows 上，windows.h 定义了无效的文件大小（INVALID_FILE_SIZE）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-08-12T12:21:54.080

如果您想使用 WinApi 使用的常量，请查看 WinError.h、WinUser.h 和 WinNT.h 文件。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-09T21:47:05.027

一般认为 0 和 1（正负）可以直接使用。

事实上，使用变量可能会让你的代码更加混乱。

更新：好的，你在我写完答案后更新了你的问题。如果您以算术方式使用“-1”，则只需“-1”即可。如果您返回错误代码（并且代码恰好是 -1），那么您应该使用 const。

```
 const int INVALID_VALUE = -1; 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-12-09T23:53:53.943

```
If bytes_read < 0
    // error
EndIf 
```

# graph-theory - 如何判断两个节点是否相连？

> ID：354330
> 
> 赞同：22
> 
> 时间：2008-12-09T21:41:17.940
> 
> 标签：graph-theory

我担心这可能正在解决 NP-Complete 问题。我希望有人可以给我一个关于它是否存在的答案。我正在寻找更多的答案，而不仅仅是是或否。我想知道为什么。如果你可以说，“这基本上是这个问题'x'，它是/不是NP-Complete。（维基百科链接）”

（不，这不是作业）

有没有办法确定两个点是否连接在任意无向图上。例如，以下

```
Well
  |
  |
  A
  |
  +--B--+--C--+--D--+
  |     |     |     |
  |     |     |     |
  E     F     G     H
  |     |     |     |
  |     |     |     |
  +--J--+--K--+--L--+
                    |
                    |
                    M
                    |
                    |
                  House 
```

点 A 到 M（没有“I”）是可以打开或关闭的控制点（如天然气管道中的阀门）。'+' 是节点（如管道 T），我猜 Well 和 House 也是节点。

我想知道我是否关闭了任意控制点（例如C），井和房子是否仍然连接（其他控制点也可能关闭）。例如，如果 B、K 和 D 关闭，我们仍然有一条通过 AEJFCGLM 的路径，关闭 C 将断开 Well 和 House。当然; 如果只是 D 被关闭，则仅关闭 C 不会断开 House。

另一种说法是，C 是桥/切边/地峡吗？

我可以将每个控制点视为图表上的权重（0 表示打开或 1 表示关闭）；然后找到 Well 和 House 之间的最短路径（结果 >= 1 表示它们已断开连接。我也可以通过多种方法短路算法以找到最短路径（例如，一旦到达 1 就丢弃路径，停止搜索一旦我们有任何连接井和房子的路径等）。当然，我也可以人为地限制在放弃之前要检查多少跳。

以前一定有人分类过这种问题，我只是漏掉了名字。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-12-09T21:52:03.673

您的描述似乎表明您只对两个节点是否连接感兴趣，而不是找到最短路径。

查找两个节点是否连接相对容易：

```
Create two sets of nodes:  toDoSet and doneSet
Add the source node to the toDoSet 
while (toDoSet is not empty) {
  Remove the first element from toDoSet
  Add it to doneSet
  foreach (node reachable from the removed node) {
    if (the node equals the destination node) {
       return success
    }
    if (the node is not in doneSet) {
       add it to toDoSet 
    }
  }
}

return failure. 
```

如果你对 toDoSet 和 doneSet 使用哈希表或类似的东西，我相信这是一个线性算法。

请注意，此算法基本上是标记和清除垃圾收集的标记部分。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-09T21:45:46.200

请参阅[http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm](http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm)，您可以一站式解决所有与图形相关的问题。我相信您的问题实际上可以在二次时间内解决。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-09T22:08:28.540

你不需要 Dijkstra 的算法来解决这个问题，因为它使用了一个不需要的堆，并为你的复杂性引入了 log(N) 的因子。这只是广度优先搜索 - 不要将闭合边作为边。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-09T21:51:06.843

找到最短路径的问题不是 NP 完全的。它被称为最短路径问题（本来就足够了），并且有一些[算法](http://en.wikipedia.org/wiki/Shortest_path_problem#Algorithms)可以解决它的许多不同变体。

确定两个节点是否连接的问题也不是 NP 完全的。您可以使用从任一节点开始的深度优先搜索来确定它是否连接到另一个节点。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-09T21:43:24.283

不是NP完全的，用一个众所周知的解决方案解决 - [Dijkstra's Algorithm](http://en.wikipedia.org/wiki/Dijkstra's_algorithm)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-09T21:49:28.703

对我来说，您似乎正在寻找解决方案，但我可能误解了这个问题。如果您确实如您所说，并将闭合边 1 作为权重，则可以应用 Dijkstra 的算法[http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm](http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm)。这应该可以解决您在 O(E*lg(V)) 中的问题

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-09T22:23:19.180

假设您有一个邻接矩阵：

```
bool[,] adj = new bool[n, n]; 
```

如果 i 和 j 之间存在开放路径并且 bool[i,i] = false，则 bool[i,j] = true。

```
public bool pathExists(int[,] adj, int start, int end)
{
  List<int> visited = new List<int>();
  List<int> inprocess = new List<int>();
  inprocess.Add(start);

  while(inprocess.Count > 0)
  {
    int cur = inprocess[0];
    inprocess.RemoveAt(0);
    if(cur == end)
      return true;
    if(visited.Contains(cur))
      continue;
    visited.Add(cur);
    for(int i = 0; i < adj.Length; i++)
      if(adj[cur, i] && !visited.Contains(i) && !inprocess.Contains(i))
        inprocess.Add(i);
  }
  return false;
} 
```

这是上述算法的递归版本（用 Ruby 编写）：

```
def connected? from, to, edges
  return true if from == to
  return true if edges.include?([from, to])
  return true if edges.include?([to, from])

  adjacent = edges.find_all { |e| e.include? from }
                  .flatten
                  .reject { |e| e == from }

  return adjacent.map do |a|
    connected? a, to, edges.reject { |e| e.include? from }
  end.any?
end 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-12-17T03:14:12.600

如果您只需要确定是否连接了 2 个节点，则可以使用集合代替，这比图形算法更快。

1.  将整个图形拆分为边。将每条边添加到集合中。
2.  在下一次迭代中，在您在步骤 2 中创建的边的 2 个外部节点之间绘制边。这意味着将新节点（及其对应的集合）添加到原始边缘所在的集合中。（基本上设置合并）
3.  重复 2 直到您要查找的 2 个节点在同一个集合中。您还需要在步骤 1 之后进行检查（以防 2 个节点相邻）。

起初，您的节点将在其集合中，

```
o   o1   o   o   o   o   o   o2
 \ /     \ /     \ /     \ /
 o o     o o     o o     o o
   \     /         \     /
   o o o o         o o o o 
      \               /
       o o1 o o o o o o2 
```

随着算法的进展和合并集合，它相对地减半输入。

在上面的示例中，我正在查看 o1 和 o2 之间是否存在路径。在合并所有边缘后，我才在最后找到了这条路径。一些图表可能有单独的组件（断开连接），这意味着您将无法在最后拥有一组。在这种情况下，您可以使用此算法来测试连通性，甚至计算图中的组件数量。组件数是算法完成时您能够获得的集合数。

一个可能的图表（对于上面的树）：

```
o-o1-o-o-o2
  |    |
  o    o
       |
       o 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-12T14:11:09.913

Dijkstra 是矫枉过正！！只需使用 A 中的广度优先搜索来搜索您想要到达的节点。如果找不到，则说明未连接。每次搜索的复杂度为 O(nm)，低于 Dijkstra。

有点相关的是最大流量/最小切割问题。查一下，可能和你的问题有关。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-09-03T13:36:47.267

我看到您已经得到答案，它绝对不是 NP-Complete，这也是一个非常古老的问题。

但是，我将提出另一种解决问题的方法。您可以为此使用不相交集。在大多数情况下，对于给定的场景，该方法将比进行图遍历（这包括大量测试的**恒定时间）产生更好的时间。**但是，如果使用按等级联合或路径压缩，则构建图可能需要大量时间。

[您可以在此处](https://en.wikipedia.org/wiki/Disjoint-set_data_structure)阅读有关数据结构的信息。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2016-11-14T06:34:30.823

如果您只需要查找一个节点是否连接到另一个节点，那么任何图形最短路径算法都将是多余的。[JGraphT](http://jgrapht.org/)是一个很好的 Java 库。它的用法很简单，下面是一个整数图的例子：

```
public void loadGraph() {
    // first we create a new undirected graph of Integers
    UndirectedGraph<Integer, DefaultEdge> graph = new SimpleGraph<>(DefaultEdge.class);

    // then we add some nodes
    graph.addVertex(1);
    graph.addVertex(2);
    graph.addVertex(3);
    graph.addVertex(4);
    graph.addVertex(5);
    graph.addVertex(6);
    graph.addVertex(7);
    graph.addVertex(8);
    graph.addVertex(9);
    graph.addVertex(10);
    graph.addVertex(11);
    graph.addVertex(12);
    graph.addVertex(13);
    graph.addVertex(14);
    graph.addVertex(15);
    graph.addVertex(16);

    // then we connect the nodes
    graph.addEdge(1, 2);
    graph.addEdge(2, 3);
    graph.addEdge(3, 4);
    graph.addEdge(3, 5);
    graph.addEdge(5, 6);
    graph.addEdge(6, 7);
    graph.addEdge(7, 8);
    graph.addEdge(8, 9);
    graph.addEdge(9, 10);
    graph.addEdge(10, 11);
    graph.addEdge(11, 12);
    graph.addEdge(13, 14);
    graph.addEdge(14, 15);
    graph.addEdge(15, 16);

    // finally we use ConnectivityInspector to check nodes connectivity
    ConnectivityInspector<Integer, DefaultEdge> inspector = new ConnectivityInspector<>(graph);

    debug(inspector, 1, 2);
    debug(inspector, 1, 4);
    debug(inspector, 1, 3);
    debug(inspector, 1, 12);
    debug(inspector, 16, 5);
}

private void debug(ConnectivityInspector<Integer, DefaultEdge> inspector, Integer n1, Integer n2) {
    System.out.println(String.format("are [%s] and [%s] connected? [%s]", n1, n2, inspector.pathExists(n1, n2)));
} 
```

该库还提供了所有最短路径算法。

# open-source - 如何找到开源项目的合作者？

> ID：354336
> 
> 赞同：8
> 
> 时间：2008-12-09T21:43:45.907
> 
> 标签：open-source, collaboration

我有几个我编写的小型开源项目。我所有寻找合作者的尝试（在 sourceforge.net 和 codeplex 上查看）都失败了——我要么找不到任何人，要么找到了不感兴趣或没有贡献任何东西的人。因此出现了一个问题：我如何以及在哪里可以找到可以合作的人（在开源的东西上）？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-09T22:02:18.427

简短的回答是：很棒。

如果你的软件真的解决了一个痛点并且很好地解决了它，人们会通过 SourceForge/GitHub/等、谷歌和口耳相传自己来解决它（假设你有合理的推广量）。如果您吸引了大量需要您的软件功能并需要它具有新功能的人，那么合作者就会来。

另外：保持活跃。如果您在 6 个月内没有更新您的代码，或者如果您在 SourceForge 上的页面显示您的软件已经处于 Alpha 版一年，那么很多人会忽略它并继续下一个搜索结果。将软件放到可供其他人使用的地方，并对其进行维护。

关于开源的事情是它确实必须有机地发展——没有人得到报酬，没有人受到被解雇的威胁——人们必须*关心你的软件*，它才能发展到超出你所能做的范围。你永远不会通过征求合作者（或者无论如何，好的合作者）来获得他们 - 只有通过制作一个优秀的程序员会觉得有趣的东西。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T21:50:01.150

我认为只有这样的方法：

*   构建人们经常使用的东西，潜在用户数量也应该很大
*   保持更新并保持用户群

一段时间后，人们应该开始破解您的工具，然后加入开发。但在该工具获得相当大的普及之前，我认为很难期望人们加入该项目。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-04-18T10:57:25.710

有一个寻找合作者的网站： http: [//collabfinder.com/](http://collabfinder.com/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T21:52:07.747

问问自己，“这个项目将受益的一组人”是否包括你自己以外的人。在该集合中找到也可以编码的人。例如，我正在编写一个让飞行员受益的项目。所以我向飞行员寻求帮助——其中一些是编码员。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-09T21:59:46.437

作为贡献者，我正在寻找：

*   一个积极发展的成熟项目
*   我感兴趣的东西
*   有很多机会添加对我来说听起来很有趣的功能
*   一个支持性的用户/开发者社区，即使它是一个
*   发布几次迭代以证明它不会死

确保你的项目看起来不像是柠檬，迎合用户并尽可能地建立基础，我认为他们会从木制品中冒出来。

贡献者的主要途径是用户，然后确保您对开发人员友好，并且您应该发现自己有一群乐于助人的人帮助您。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-08-14T18:49:12.737

[如果您正在寻找设计师和/或开发人员， http://www.builditwith.me](http://www.builditwith.me)也是一个选择

# auto-increment - JavaDB：是否可以更改现有表的自动增量偏移量？

> ID：354349
> 
> 赞同：1
> 
> 时间：2008-12-09T21:47:06.197
> 
> 标签：auto-increment, javadb

是否可以使用 JavaDB 更改预先存在的表上的自动增量偏移量？

我遇到了一个问题，即插入新记录通常（但并非总是）失败，并出现抱怨使用现有键（我的自动增量列）的错误。为了填充这个数据库，我从另一个数据库 (MySQL) 中提取了一个转储文件，并使用 JavaDB 存储过程将它们全部插入到相应的 JavaDB 表中。我的理论是插入这些记录会复制 MySQL 表中的现有 ID。现在，自动增量功能正在分发现有的 ID。我认为明确地将偏移量设置为某个较高的数字将允许自动增量再次工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-11-19T13:18:56.297

即使这不是问题的直接答案：使用 MySQL，你可以做一个

```
ALTER TABLE my_little_table AUTO_INCREMENT =2000 
```

设置自动增量值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T22:42:20.280

我不知道如何直接更改偏移量，但我设法通过以下方式解决了这个问题：

1.  将增量金额更改为 X（在我的情况下为 100 万）。
2.  插入一个虚拟记录。
3.  将增量减少回 1。
4.  删除虚拟记录。

我使用此 SQL 语句来更改增量金额：

```
ALTER TABLE tbl ALTER COLUMN col SET INCREMENT BY x 
```

# c# - 如何处理 StructureMap 的 ObjectFactory 中的每个实例对象？

> ID：354354
> 
> 赞同：3
> 
> 时间：2008-12-09T21:49:13.150
> 
> 标签：c#, inversion-of-control, structuremap, ioc-container

我在我的项目中使用 StructureMap，当应用程序完成运行时，我需要在 ObjectFactory 中实现 IDisposable 的所有 Singleton 实例上调用 Dispose() 方法。

我无论如何都找不到通过 StructureMap API 来做这件事。

我的另一个想法是获取每个实例的引用并自己调用它，但我不知道如何循环遍历所有实例。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-01T17:15:47.490

PS：您可能对 Autofac IoC 容器的确定性[处理](http://code.google.com/p/autofac/)[感兴趣](http://code.google.com/p/autofac/wiki/DeterministicDisposal)

> Autofac 可以保证组件的处理方式是可预测的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-27T18:55:42.937

我在另一个问题中找到了答案：[StructureMap Disposing Container](https://stackoverflow.com/questions/5443623/structuremap-disposing-container)

```
ObjectFactory.Container.Dispose(); 
```

# html - 渲染后突出显示页面上的文本

> ID：354368
> 
> 赞同：2
> 
> 时间：2008-12-09T21:52:16.327
> 
> 标签：html, ajax, parsing, ajaxcontroltoolkit

我有一个应用程序，允许用户在多个字段中搜索字符串，当他们查看详细记录时，他们希望突出显示所有出现的字符串。

详细信息表单由 Labels 和 ListViews 组成，其中大部分位于 TabPanels 内部（来自 AJAX Control Toolkit）。我想避免使用蛮力手动解析每个值以在显示之前添加突出显示的标签。

有没有办法加载我的表单然后解析 HTML？还有其他方法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T22:11:18.940

JavaScript 和 JQuery 怎么样？ [http://plugins.jquery.com/project/highlight](http://plugins.jquery.com/project/highlight)

我刚刚尝试了那个插件并且它有效。您可以指定要突出显示的标签和单词。

```
<script language="javascript" type="text/javascript" src="js/jquery-1.2.6.min.js"></script>
<script language="javascript" type="text/javascript" src="js/jquery.highlight-2.pack.js"></script>
<script language="javascript" type="text/javascript">
$(document).ready( function () {
    $('p').each(function() { $.highlight(this, 'LOREM'); });
});
</script>
<style type="text/css">
    .highlight { background-color: yellow }
</style>

..
..
..
    <p>
    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi gravida risus elementum tortor. Duis mattis, est et volutpat cursus, mi mi ornare tortor, sed fringilla nibh erat sed eros. In nec orci vel velit scelerisque ultrices. Nunc auctor elit. Proin orci ligula, luctus a, venenatis sit amet, laoreet a, mauris. Suspendisse sem nibh, interdum eu, vestibulum non, semper vel, mauris. In quis leo suscipit risus semper pretium. Cras interdum iaculis dui. Etiam vel ipsum eu sapien dapibus sagittis. Donec lobortis, lectus et placerat euismod, quam dui porttitor sem, sed fermentum eros quam ac ipsum. Ut eu augue. Nullam lacinia dictum neque. Nullam eros. Phasellus sem nisi, feugiat nec, consectetur vel, ullamcorper at, nisl. Aenean quam risus, ullamcorper a, ultricies ut, posuere ac, quam. Vestibulum sed lectus ac orci fermentum viverra. Sed aliquam. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos.
    </p> 
```

# asp.net - GridView - 在空数据源上显示标题

> ID：354369
> 
> 赞同：81
> 
> 时间：2008-12-09T21:52:20.990
> 
> 标签：asp.net, gridview, header

在 C# 中，即使数据源为空，我如何仍然显示 gridview 的标题。

我不会自动生成列，因为它们都是预定义的。

目前我正在做的事情如下。

从存储过程中取回一个DataTable，然后设置gridview的DataSource，然后调用DataBind()。

当我有数据时这很好用，但是当没有返回任何行时，我只会得到一个网格应该在的空白点。

**编辑：感谢所有 .NET 4+ 属性。我在 .NET 3.5 天时问过这个问题。这现在容易多了。:)**

* * *

## 回答 #1

> 赞同：143
> 
> 时间：2011-02-17T19:13:28.223

ASP.Net 4.0 添加了布尔`ShowHeaderWhenEmpty`属性。

[http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.showheaderwhenempty.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.showheaderwhenempty.aspx)

* * *

```
<asp:GridView runat="server" ID="GridView1" ShowHeaderWhenEmpty="true" AutoGenerateColumns="false">
    <Columns>
        <asp:BoundField HeaderText="First Name" DataField="FirstName" />
        <asp:BoundField HeaderText="Last Name" DataField="LastName" />
    </Columns>
</asp:GridView> 
```

注意：除非使用 null 以外的值调用 DataBind()，否则不会出现标头。

```
GridView1.DataSource = New List(Of String)
GridView1.DataBind() 
```

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-12-09T21:59:50.087

发布此内容后，我确实想出了一种可行的方法。但是，我不认为这是处理此问题的最佳方法。有更好的建议吗？

```
//Check to see if we get rows back, if we do just bind.

if (dtFunding.Rows.Count != 0)
{
    grdFunding.DataSource = dtFunding;
    grdFunding.DataBind();
}
else
{
  //Other wise add a emtpy "New Row" to the datatable and then hide it after binding.

     dtFunding.Rows.Add(dtFunding.NewRow());
     grdFunding.DataSource = dtFunding;
     grdFunding.DataBind();
     grdFunding.Rows[0].Visible = false;
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-07-14T21:05:12.647

我只是在解决这个问题，这些解决方案都不适合我。我无法使用该属性，因为我正在使用在标题中提供过滤器的自定义字段动态`EmptyDataTemplate`创建我的。`GridView`我无法使用发布的示例 almny，因为我使用的是`ObjectDataSource`s 而不是`DataSet`or `DataTable`。但是，我发现[这个答案](https://stackoverflow.com/questions/940234/show-header-footer-when-gridview-is-blank-vb-net/940356#940356)发布在另一个 StackOverflow 问题上，该问题链接到[这个优雅的解决方案](https://web.archive.org/web/20161114032518/http://blogs.claritycon.com:80/blog/2006/02/displaying-gridview-when-no-data-exists/)，我能够针对我的特定情况进行工作。它涉及覆盖 的`CreateChildControls`方法`GridView`来创建相同的标题行，如果有真实数据则会创建。我认为它值得在这里发布，其他人可能会在类似的修复中找到它。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-07-10T15:28:32.100

如果您使用的是 ASP.NET 3.5 及更低版本，并且您的问题像我的一样相对简单，您可以从 SQL 查询中返回一个空行。

```
if not exists (select RepId, startdate,enddate from RepTable where RepID= 10)
     select null RepID,null StartDate,null EndDate
else
     select RepId, startdate,enddate from RepTable where RepID= 10 
```

此解决方案不需要任何 C# 代码或 ASP.NET 代码

1.  确保将空列转换为适当的名称，否则它将不起作用。
2.  必须包含 Else 块，这与中的查询相同`if not exists (query part)`
3.  在我的情况下，如果我使用@RepID 而不是 10。它映射到 gridview 之外的 DropDownList 框。

每次我更改下拉菜单以选择不同的代表时，Gridview 都会更新。如果未找到记录，则显示空行。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-12-20T11:21:28.963

放`"<asp:GridView AutoGenerateColumns="false" ShowHeaderWhenEmpty="true""`

`showheaderwhenEmpty`财产

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-09T22:07:01.880

如果您使用的是 .NET 3.5，您可以使用 HeaderTemplate 属性以编程方式设置头部或使用 ListView。

就个人而言，如果可能的话，我更喜欢 ListView 而不是 GridView 和 DetailsView，它可以让你更好地控制你的 html。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-06-29T10:24:45.370

您可以将 ownertableview 的 ShowHeadersWhenNoRecords 属性设置为 true。aspx：

```
<asp:GridView ID="RadGrid2" runat="server" >       
<MasterTableView ShowHeadersWhenNoRecords="true"  > 
```

此外，当 GridView 的数据源为空时（没有记录时），您可以尝试如下设置： c#:

```
 if (GridView1.DataSource == null)  
  {  
        GridView1.DataSource = new string[] { };  
  } 
  GridView1.DataBind(); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-04-18T13:25:42.450

将此属性添加到您的网格视图： ShowHeaderWhenEmpty="True" 它可能有助于检查

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-06-13T17:53:30.190

我找到了一个非常简单的解决方案。我只是创建了两个 GridView。第一个 GridView 调用了一个 DataSource，其查询旨在不返回任何行。它只包含以下内容：

```
 <Columns>
        <asp:TemplateField HeaderStyle-HorizontalAlign="Left">
            <HeaderTemplate>

               <asp:Label ID="lbl0" etc.>  </asp:Label>
               <asp:Label ID="lbl1" etc.>  </asp:Label>

            </HeaderTemplate>
        </asp:TemplateField>
    </Columns> 
```

然后我创建了一个具有以下特征的 div，并在其中放置了一个带有 ShowHeader="false" 的 GridView，以便顶行与所有其他行的大小相同。

```
<div style="overflow: auto; height: 29.5em; width: 100%">
    <asp:GridView ID="Rollup" runat="server" ShowHeader="false" DataSourceID="ObjectDataSource">
        <Columns>
            <asp:TemplateField HeaderStyle-HorizontalAlign="Left">
                <ItemTemplate>

               <asp:Label ID="lbl0" etc.>  </asp:Label>
               <asp:Label ID="lbl1" etc.>  </asp:Label>

                </ItemTemplate>
            </asp:TemplateField>
        </Columns>
    </asp:GridView>
</div> 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-09-06T08:31:06.477

```
<asp:GridView ID="grdGroup"  EmptyDataText="No Records Found" ShowHeaderWhenEmpty="True" runat="server"> 
```

这是带有 EmptyDataText 和 ShowHeaderWhenEmpty 的 Gridview 的基本示例

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-02-27T15:23:48.140

只需添加 ShowHeaderWhenEmpty 属性并将其设置为 true

这个解决方案对我有用

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-01-24T17:32:27.987

我正在使用 asp sqlDataSource。当我将 CancelSelectOnNullParameter 设置为 false 时，它​​对我有用，如下所示：

`<asp:SqlDataSource ID="SqlData1" runat="server" ConnectionString="" SelectCommand="myStoredProcedure" SelectCommandType="StoredProcedure" CancelSelectOnNullParameter="False"> </asp:SqlDataSource>`

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2015-07-08T08:43:44.783

```
<asp:GridView ID="gvEmployee" runat="server"    
                 AutoGenerateColumns="False" ShowHeaderWhenEmpty=”True”&gt;  
                    <Columns>  
                        <asp:BoundField DataField="Id" HeaderText="Id" />  
                        <asp:BoundField DataField="Name" HeaderText="Name" />  
                        <asp:BoundField DataField="Designation" HeaderText="Designation" />  
                        <asp:BoundField DataField="Salary" HeaderText="Salary"  />  
                    </Columns>  
                    <EmptyDataTemplate>No Record Available</EmptyDataTemplate>  
                </asp:GridView>  

in CS Page

gvEmployee.DataSource = dt;  
gvEmployee.DataBind(); 
```

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2012-09-21T17:40:00.650

你可以使用`EmptyDataText`如下图：

```
<asp:GridView ID="_gridView" RunAt="server" AutoGenerateColumns="false"
          EmptyDataText="No entries found."> 
```

它不显示标题，它会呈现您的消息“未找到条目”。反而。

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2015-07-08T08:47:21.617

```
 <asp:GridView ID="gvEmployee" runat="server"    
                     AutoGenerateColumns="False" ShowHeaderWhenEmpty=”True”&gt;  
                        <Columns>  
                            <asp:BoundField DataField="Id" HeaderText="Id" />  
                            <asp:BoundField DataField="Name" HeaderText="Name" />  
                            <asp:BoundField DataField="Designation" HeaderText="Designation" />  
                            <asp:BoundField DataField="Salary" HeaderText="Salary"  />  
                        </Columns>  
                        <EmptyDataTemplate>No Record Available</EmptyDataTemplate>  
                    </asp:GridView>  

    in CS Page

    gvEmployee.DataSource = dt;  
    gvEmployee.DataBind();  

Help.. see that link:
http://www.c-sharpcorner.com/UploadFile/d0e913/how-to-display-the-empty-gridview-in-case-of-no-records-in-d/ 
```

* * *

## 回答 #16

> 赞同：-3
> 
> 时间：2008-12-09T22:34:04.557

使用如下所示的 EmptyDataTemplate。当您的 DataSource 没有记录时，您将看到带有标题的网格，以及 EmptyDataTemplate 标记内的文字文本或 HTML。

```
<asp:GridView ID="gvResults" AutoGenerateColumns="False" HeaderStyle-CssClass="tableheader" runat="server">
    <EmptyDataTemplate>
        <asp:Label ID="lblEmptySearch" runat="server">No Results Found</asp:Label>
    </EmptyDataTemplate>
    <Columns>
        <asp:BoundField DataField="ItemId" HeaderText="ID" />
        <asp:BoundField DataField="Description" HeaderText="Description" />
        ...
    </Columns>
</asp:GridView> 
```

# python - 将 SOAP 标头添加到 SOAPpy 请求

> ID：354370
> 
> 赞同：0
> 
> 时间：2008-12-09T21:52:26.483
> 
> 标签：python, soappy

有谁知道如何做到这一点？我需要添加表单的标题：

值1 值2

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-29T21:29:56.967

正如问题所表达的那样，很难猜测意图（甚至预期的语义）是什么。要设置标题，请尝试以下操作：

```
import SOAPpy
headers = SOAPpy.Types.headerType()
headers.value1 = value2 
```

或者

```
[...]
headers.foo = value1
headers.bar = value2 
```

# visual-studio-2008 - 在类库 (C#/.NET) 中使用 Web 引用

> ID：354374
> 
> 赞同：8
> 
> 时间：2008-12-09T21:55:23.077
> 
> 标签：visual-studio-2008, web-services

我有一个将类库用于业务层功能（数据库访问等）的项目。Web 应用程序位于此之上。我有一个我想在类库中调用的 Web 服务。每次我向类库添加“服务引用”（我使用的是 VS2008）时，一切似乎都正常。Web 服务的名称是“EmployeeService”。但是，当我尝试从代码中访问它时，智能感知为我提供了以下选项：

'员工服务肥皂'

'EmployeeServiceSoapChannel'

'EmployeeServiceSoapClient'

还有很多“...请求”

'...请求正文'

'...RequestResponse' 类型。

即使我写了它，我也无法访问我的 EmployeeService 类，编译器会抱怨。有任何想法吗？谢谢你的帮助...

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-09T22:09:52.017

真的吗？我会试试的。VS2008/.NET 3.5 一定改变了，对吧？我知道过去不是这样的。

编辑：我终于想通了。我将参考添加为“服务参考”而不是“网络参考”。我想服务参考是 .NET 3.5 中的新功能，它与经典的 Web 参考有点不同。VS2008 没有给我添加网络参考的选项。我不得不进入服务参考的高级属性并添加一个 Web 参考。一旦我这样做了，它就会给我两个选项（一个是添加服务引用，另一个是添加 Web 引用），如图。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-09T22:07:40.150

您应该使用`EmployeeServiceSoapClient`来访问该服务。Service 类本身位于服务器上。

# multithreading - Mac OS X 进程和线程有何不同？

> ID：354376
> 
> 赞同：1
> 
> 时间：2008-12-09T21:55:44.977
> 
> 标签：multithreading, macos, operating-system

在我的 Mac OS X 活动监视器中，它列出了每个应用程序的每个“进程”ID。它将多个进程链接到一个线程，例如 iTunes 和 Finder 目前都列在线程 7 下。我了解线程和进程的方式让我认为这应该是相反的方式。我了解到一个进程有一个或多个线程。有人可以尝试为我解决这个问题。他们所说的这些过程会被认为是轻量级过程吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T22:05:33.337

我不是 OS X 用户，但从我们的好朋友 Google 先生找到的屏幕截图看来，这表明该进程创建的线程数。所以 iTunes 和 Finder 都运行 7 个线程。

# redhat - GNU_LIBC_VERSION 和 GNU_NPTL_VERSION 有什么区别？

> ID：354384
> 
> 赞同：1
> 
> 时间：2008-12-09T21:57:18.360
> 
> 标签：redhat, ssl, nptl

注意这两个 RedHat Linux 系统配置设置：

```
$ getconf GNU_LIBC_VERSION
glibc 2.3.4

$ getconf GNU_LIBPTHREAD_VERSION
NPTL 2.3.4 
```

我看到它们对应于一些 TLS 库：

```
/lib/tls/libc-2.3.4.so
/lib/tls/libm-2.3.4.so
/lib/tls/libpthread-2.3.4.so
/lib/tls/librt-2.3.4.so 
```

我想链接这些库而不是`/usr/lib`等价物。我有几个问题：

1.  我在 RedHat 和 Debian 上看到过这个。它是否存在于所有 GNU Linux 发行版中？
2.  有什么`GNU_LIBC_VERSION`不同的情况`GNU_LIBPTHREAD_VERSION`吗？
3.  这些变量是否可以安全地用于识别中的共享库`/lib/tls`？我想在 Makefile 中自动执行此操作，而不是硬编码一个神奇的 glibc/pthread 版本号。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T22:12:28.297

[最初在 Linux 上实现 pThreads的 NPTL 项目](http://en.wikipedia.org/wiki/Native_POSIX_Thread_Library)是一个单独的项目，最初添加了内核支持并提供了自己的库。

当它足够稳定时，它被合并到 glibc 中。我会假设这两个版本在所有合理的最新安装上都是相同的。

在 Ubuntu 8.10 上，输出是这样的：

```
$ getconf GNU_LIBC_VERSION
glibc 2.8.90
$ getconf GNU_LIBPTHREAD_VERSION
NPTL 2.8.90

```

# cocoa-touch - 导航栏中的多个标签

> ID：354385
> 
> 赞同：3
> 
> 时间：2008-12-09T21:57:19.170
> 
> 标签：cocoa-touch

我想在 iPhone 上创建一个类似于“正在播放”页面的视图，并在导航栏中有 3 行文本。

我能找到的唯一方法是：

```
UINavigationBar *bar = [self.navigationController navigationBar];   
label = [[UILabel alloc] initWithFrame:CGRectMake(60, 2, 200, 14)];
label.tag = SONG_TAG;
label.backgroundColor = [UIColor clearColor];
label.font = [UIFont boldSystemFontOfSize:14];
label.adjustsFontSizeToFitWidth = NO;
label.textAlignment = UITextAlignmentCenter;
label.textColor = [UIColor whiteColor];
label.highlightedTextColor = [UIColor blackColor];
[bar addSubview:label];
[label release];

//Create album label
label = [[UILabel alloc] initWithFrame:CGRectMake(60, 17, 200, 12)];
label.tag = ALBUM_TAG;
label.backgroundColor = [UIColor clearColor];
label.font = [UIFont systemFontOfSize:12];
label.adjustsFontSizeToFitWidth = NO;
label.textAlignment = UITextAlignmentCenter;
label.highlightedTextColor = [UIColor blackColor];
label.textColor = HEXCOLOR(0xA5A5A5ff);
[bar addSubview:label];
[label release];

//Create artist label
label = [[UILabel alloc] initWithFrame:CGRectMake(60, 30, 200, 12)];
label.tag = ARTIST_TAG;
label.backgroundColor = [UIColor clearColor];
label.font = [UIFont systemFontOfSize:12];
label.adjustsFontSizeToFitWidth = NO;
label.textAlignment = UITextAlignmentCenter;
label.highlightedTextColor = [UIColor blackColor];
label.textColor = HEXCOLOR(0xA5A5A5ff);
[bar addSubview:label];
[label release]; 
```

问题是我必须在视图更改时删除它们。所以，在 -viewWillDisappear 我有：

```
UILabel *label;
label = (UILabel *)[self.navigationController.navigationBar viewWithTag:SONG_TAG];
[label removeFromSuperview];
label = (UILabel *)[self.navigationController.navigationBar viewWithTag:ALBUM_TAG];
[label removeFromSuperview];
label = (UILabel *)[self.navigationController.navigationBar viewWithTag:ARTIST_TAG];
[label removeFromSuperview]; 
```

我认为这样做的方法是制作一个包含 3 个标签的自定义视图，并将其添加到标题视图中。（这里有一个问题 - 您只能将 1 个标签或视图添加到导航栏上的标题视图点）

```
self.navigationItem.titleView = newViewIMadeWithThreeLabels 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-12-20T21:37:02.577

下面的 UIView 代码对我来说没问题，你有两次使用相同的标签标签，可能是你的崩溃原因。

```
UIView *btn = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 320, 60)];

UILabel *label;
label = [[UILabel alloc] initWithFrame:CGRectMake(0, 10, 200, 16)];
label.tag = 1;
label.backgroundColor = [UIColor clearColor];
label.font = [UIFont boldSystemFontOfSize:16];
label.adjustsFontSizeToFitWidth = NO;
label.textAlignment = UITextAlignmentCenter;
label.textColor = [UIColor blackColor];
label.text = @"first line";
label.highlightedTextColor = [UIColor blackColor];
[btn addSubview:label];
[label release];

label = [[UILabel alloc] initWithFrame:CGRectMake(0, 30, 200, 16)];
label.tag = 2;
label.backgroundColor = [UIColor clearColor];
label.font = [UIFont boldSystemFontOfSize:16];
label.adjustsFontSizeToFitWidth = NO;
label.textAlignment = UITextAlignmentCenter;
label.textColor = [UIColor blackColor];
label.text = @"second line";
label.highlightedTextColor = [UIColor blackColor];
[btn addSubview:label];
[label release];

self.navigationItem.titleView = btn; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T22:10:46.040

您可以尝试创建一个标签位置正确的 UIViewController，然后实例化它，例如 UIViewControllerSubclass *sub = [[UIViewControllerSubclass alloc] init];

在 UIViewController 子类中，您必须在 loadView 委托方法中构建视图并将每个标签的视图附加到视图控制器的视图，如 [[self view] addSubview:label];

然后像这样附加它的视图：

self.navigationItem.titleView = sub.view;

那可能行得通。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T14:34:38.707

您后来在帖子中的建议是正确的。创建一个包含 3 个标签的 UIView 并将其设置为 titleView。请不要尝试将子视图直接添加到 UINavigationBar。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-14T12:13:11.023

```
UINavigationBar *bar = [self.navigationController navigationBar];
CGFloat navBarHeight = 70.0f;    
CGRect frame = CGRectMake(0.0f, 0.0f, 320.0f, navBarHeight);
[bar setFrame:frame];
UILabel *label;
label = [[UILabel alloc] initWithFrame:CGRectMake(0, 10, 320, 10)];
label.tag = 1;
label.backgroundColor = [UIColor clearColor];
label.font = [UIFont boldSystemFontOfSize:12];
label.adjustsFontSizeToFitWidth = NO;
label.textAlignment = UITextAlignmentCenter;
label.textColor = [UIColor blackColor];
label.text = @"Set the details for this event.";
label.highlightedTextColor = [UIColor blackColor];
[bar addSubview:label];
[label release];
[bar release]; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-23T21:29:39.980

今天我遇到了同样的问题，我就是这样做的。

1.  我在位置 0,0 创建了一个大小为 320*44 的 UIView - 您可以根据您的要求拥有不同的视图大小。

2.  为名为 navigationBarTitleView 的自定义视图创建一个 IBOutlet - 与您的视图建立必要的连接

3.  在 viewWillAppear 内使用以下代码将子视图添加到 navgiationBar：或 viewDidAppear：

    [[[self navigationController] navigationBar] addSubview:navigationBarTitleView];

4.  当您在导航控制器上推送此视图时，请从超级视图中删除 navigationBarTitleView。

    [navigationBarTitleView removeFromSuperview];

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-15T22:46:42.160

我尝试添加整个视图。但是，每当我在 loadView 委托中添加子视图（如标签）时，应用程序都会崩溃。我并不擅长调试完全崩溃，所以我发现使用按钮要简单得多。我还没有发现任何副作用...

```
UIButton *btn = [UIButton buttonWithType:UIButtonTypeRoundedRect];
btn.frame = CGRectMake(0, 0, 320, 60);

UILabel *label;
label = [[UILabel alloc] initWithFrame:CGRectMake(0, 10, 200, 16)];
label.tag = SONG_TAG;
label.backgroundColor = [UIColor clearColor];
label.font = [UIFont boldSystemFontOfSize:16];
label.adjustsFontSizeToFitWidth = NO;
label.textAlignment = UITextAlignmentCenter;
label.textColor = [UIColor blackColor];
label.text = @"first line";
label.highlightedTextColor = [UIColor blackColor];
[btn addSubview:label];
[label release];

label = [[UILabel alloc] initWithFrame:CGRectMake(0, 30, 200, 16)];
label.tag = SONG_TAG;
label.backgroundColor = [UIColor clearColor];
label.font = [UIFont boldSystemFontOfSize:16];
label.adjustsFontSizeToFitWidth = NO;
label.textAlignment = UITextAlignmentCenter;
label.textColor = [UIColor blackColor];
label.text = @"second line";
label.highlightedTextColor = [UIColor blackColor];
[btn addSubview:label];
[label release];

self.navigationItem.titleView = btn; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-09-25T18:07:21.203

一个更简洁的方法就是`enum`你的标签：

```
enum {
  SONG_TAG,
  ALBUM_TAG,
  ARTIST_TAG
}; 
```

你的代码应该可以工作。

# c# - 有没有办法在 Windows Mobile 上捕获发送键并让它拨打特定号码？

> ID：354386
> 
> 赞同：1
> 
> 时间：2008-12-09T21:57:33.553
> 
> 标签：c#, windows-mobile, compact-framework, key

我有一个使用紧凑框架 (NETCF) 的 Windows Mobile 应用程序，我想响应某人按下发送键并让电话拨打我的应用程序中选择的号码。有没有办法使用紧凑的框架来捕获发送密钥？我看过几篇关于捕获密钥的文章，但我还没有找到包含“发送”密钥的文章。

**更新**：

我发现一篇文章将 SetWindowsHookEx 描述为 Windows Mobile 上未记录的 API。如果是这种情况，那么我真的不想使用它。

[Windows Mobile 上的 SetWindowsHookEx](http://blogs.msdn.com/raffael/archive/2008/05/12/setwindowshookex-on-windows-mobile.aspx)

经过更多搜索后，我发现“发送”键在 Windows Mobile 术语中称为“通话”键。然后，我找到了一篇关于使用 SHCMBM_OVERRIDEKEY 消息来指示操作系统在用户按下 Talk 键时向我的应用程序发送 WM_HOTKEY 消息的博客文章。

[Jason Fuller 关于使用“谈话”按钮的博客文章](http://blogs.msdn.com/windowsmobile/archive/2005/09/02/460327.aspx)

博客文章和它指向的文档似乎正是我正在寻找的。我找不到一个可行的例子，而且我发现很多人无法让它发挥作用。看起来智能手机不支持 VK_TTALK。我很想听听有人在智能手机和 PocketPC 手机上实际使用此功能。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-16T19:57:31.240

我可以确认使用 SHCMBM_OVERRIDEKEY 在 PPC 和 SP 设备上都有效。我已经在 WM5 PPC、WM5 SP、WM6 PPC、WM6 SP 上对其进行了测试。我还没有尝试过 WM6.1 或 WM6.5，但我有点假设它们可以工作，因为 WM6 工作。

另外，您可能还需要在通话期间支持 DTMF 吗？

由于我正在编写 LAP dll，因此我遵循了以下页面，您可能会发现它很有用： [LAP 实施问题](http://msdn.microsoft.com/en-us/library/aa923659.aspx)

这些示例是用 C 语言编写的，因此您必须将它们翻译成 C#。

要为特定窗口设置“谈话”键的陷印，您需要执行以下操作：

```
SendMessage(SHFindMenuBar(window_hwnd), 
            SHCMBM_OVERRIDEKEY, 
            VK_TTALK, 
            MAKELPARAM((SHMBOF_NODEFAULT|SHMBOF_NOTIFY), (SHMBOF_NODEFAULT|SHMBOF_NOTIFY)); 
```

您可以随时打开/关闭陷阱。要关闭陷阱也很容易：

```
SendMessage(SHFindMenuBar(window_hwnd), 
            SHCMBM_OVERRIDEKEY, 
            VK_TTALK, 
            MAKELPARAM(0, (SHMBOF_NODEFAULT|SHMBOF_NOTIFY)); 
```

要检测何时按下“谈话”键，您需要在窗口 proc 上捕获 WM_HOTKEY 窗口消息：

```
case WM_HOTKEY:
    switch(HIWORD(lParam))
    {
    case VK_TTALK:
        // make ph call
        break;
    }
    return TRUE; 
```

要拨打电话，您需要使用“PhoneMakeCall”API：

```
#include <phone.h>

void MakePhoneCall(const wchar_t* number)
{
    PHONEMAKECALLINFO call;
    memset(&call, 0x0, sizeof(PHONEMAKECALLINFO));
    call.cbSize = sizeof(PHONEMAKECALLINFO);
    call.dwFlags = PMCF_DEFAULT;
    call.pszDestAddress = number;
    PhoneMakeCall(&call);
} 
```

[要在通话期间支持 DTMF，您需要使用SNAPI](http://msdn.microsoft.com/en-us/library/aa455748.aspx)跟踪电话（我相信有一个 C# 库可以帮助您解决[SystemProperty](http://msdn.microsoft.com/en-us/library/microsoft.windowsmobile.status.systemproperty.aspx)）。

开始通话后的设置：

```
 #include <snapi.h>
  RegistryNotifyWindow(SN_PHONEACTIVECALLCOUNT_ROOT, SN_PHONEACTIVECALLCOUNT_PATH, SN_PHONEACTIVECALLCOUNT_VALUE, window_hwnd, callback_window_msg_number /*e.g. WM_APP */, 0, NULL, &phone_call_notify_handle); 
```

当呼叫计数发生变化时，您将通过您提供的窗口消息被回叫。您需要阅读注册表并检查调用计数是否降至零。如果确实如此，您需要关闭 SNAPI 句柄：

```
RegistryCloseNotification(phone_call_notify_handle); 
```

在通话中使用用户按下的键向 cprog 应用程序发送消息：

```
#define WM_CPROG_SEND_VKEY_DTMF (WM_APP+3) // Sends the DTMF tone(s) through to the current call (converting from VKEY to DTMF chars)

  BOOL PhoneSendDTMF(UINT uvKey)
  {
    BOOL bRet = FALSE;
    static HWND s_hwndCProg = NULL;
    TCHAR chDTMF = MapVKeyToChar(uvKey);

    // Attempt to find the cprog window (MSCprog).
    // Try to keep this window handle cached.
    if(NULL == s_hwndCProg || !IsWindow(s_hwndCProg))
    {
      s_hwndCProg = FindWindow(TEXT("MSCprog"), NULL);
    }

    // Send WM_CPROG_SEND_VKEY_DTMF to the CProg window.
    if(NULL != s_hwndCProg)
    {
      bRet = BOOLIFY(PostMessage(s_hwndCProg,
                              WM_CPROG_SEND_VKEY_DTMF, (WPARAM)chDTMF, 0));
    }

    return bRet;
  } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T22:10:04.480

您可以通过 keyhook 捕捉世界中的所有键（除了桌面上的 CTRL+ALT+DEL）：

[static extern IntPtr SetWindowsHookEx(HookType hook, HookProc callback, IntPtr hMod, uint dwThreadId);](http://www.pinvoke.net/default.aspx/user32/SetWindowsHookEx.html)

您可以通过 coredll.dll（而不是 user32）在 CE 中使用它（或其他覆盖之一）。

但是，这不在 .NET Compact Framework 中，需要 P/Invoke。“免费”按键的最大乐趣是 Form.KeyPreview = true; 并且只为您提供在表单聚焦时被击中的键，有时在处理具有特殊键的设备时（可能例如您的“发送”键，因为我在 Intermec 上的“Application1”键有类似的情况）不久前的单位）。

然而，还有一个很棒的替代方案，我相信[OpenNETCF](http://www.opennetcf.com/) [要么已经使用，要么很快就会使用 keyhook](http://blog.opennetcf.com/ctacke/2008/09/03/KeyboardHookingInSDFVNext.aspx)（通过上面的 WinAPI 调用）来展示令人愉快的托管包装器。喜悦！

[如果这还没有准备好，那么有大量文章和代码在展示如何通过 Google 使用它，所以在最坏的情况下，如果你执行这样](http://www.google.co.uk/search?q=SetWindowsHookEx+compact+framework+c%23&ie=utf-8&oe=utf-8&aq=t&rls=org.mozilla:en-US:official&client=firefox-a)的搜索，你应该能够找到一些东西。也许是[这样](http://blog.opennetcf.com/ayakhnin/CategoryView,category,Compact%20Framework.aspx)的？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-13T08:30:32.270

[不使用指定的PhoneMakeCall](http://msdn.microsoft.com/en-us/library/aa446543.aspx)背后有什么特别的原因吗？它适用于 Smartphone 和 Windows Mobile 6 Professional。

编辑：我有点误读了这个问题。我现在看到您想要**捕获**Send 事件。不过，我让我的答案留下来供参考。

# java - 为什么`index = index++`不增加`index`？

> ID：354393
> 
> 赞同：0
> 
> 时间：2008-12-09T22:00:25.920
> 
> 标签：java

** Dup：[X = X++ 有什么区别；与 X++;?](https://stackoverflow.com/questions/226002/whats-the-difference-between-x-x-vs-x) **

所以，即使我知道你永远不会在代码中真正做到这一点，我仍然很好奇：

```
public static void main(String[] args) {
    int index = 0;
    System.out.println(index);   // 0
    index++;
    System.out.println(index);   // 1
    index = index++;
    System.out.println(index);   // 1
    System.out.println(index++); // 1
    System.out.println(index);   // 2
} 
```

请注意，第三个`sysout`仍然是`1`. 在我看来，该行的`index = index++;`意思是“将索引设置为索引，然后将索引增加 1”，同样的方式`System.out.println(index++);`意味着“将索引传递给 println 方法，然后将索引增加 1”。

然而，情况并非如此。谁能解释发生了什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-09T22:01:36.353

这是一个重复的问题。

**编辑：**我似乎找不到原件 :P 哦，好吧

a = a++ 使用后增量，您的编译器将其解释为：

```
a = function() {
   var old_value = a;
   a++;
   return old_value;
} 
```

**编辑 2：** [X = X++; 之间有什么区别？与 X++;?](https://stackoverflow.com/questions/226002/whats-the-difference-between-x-x-vs-x)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T22:04:06.147

`value++;`是后增量。

```
int firtValue = 9;
int secondValue = firstValue++; 
```

firstValue 现在是 10，但 secondValue 是 9，这是 firstValue 增加之前的值。

现在有了预增量：

```
int firtValue = 9;
int secondValue = ++firstValue; 
```

firstValue 和 secondValue 现在为 10，fistValue 递增，然后将其值分配给 secondValue。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T22:02:30.987

赋值发生在对表达式求值之后。所以 index++ 的值为 0，尽管作为副作用，索引会增加。然后将值（0）分配给索引。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T22:04:48.627

后增量运算符`index++`增加变量，但返回其旧值，因此

```
int i = 5;
System.out.println(i++); 
```

将打印 5 但 i 现在等于 6。

如果要在增量操作后返回值，请使用`++index`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-09T22:05:17.283

我从来没有尝试过这样的事情，但我愿意让分配发生在增量之后。

因此，就编译器而言，真正发生的是：

1.  评估指数
2.  保留 index 的值以备后用
3.  增加索引的值
4.  分配索引的旧值，从而消除增量。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T22:06:20.603

您必须查看评估事物的顺序。

在下面的声明中

指数=指数++；

发生了三件事 1) 因为它是 index++，所以 index 的值是确定的 2) index 增加了，3) 在第一步中确定的值然后分配给等式左侧的变量

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-09T22:04:50.670

[这个](https://stackoverflow.com/questions/226002/whats-the-difference-between-x-x-vs-x)问题的答案应该会有所帮助。后增量确实会更新 index 的值，但它会返回更新前的值。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-12-09T22:06:19.713

有关后缀评估规则的信息，请参见[http://java.sun.com/docs/books/jls/second_edition/html/typesValues.doc.html](http://java.sun.com/docs/books/jls/second_edition/html/typesValues.doc.html "类型和值")。

另请参阅[http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#39438](http://java.sun.com/docs/books/jls/second_edition/html/expressions.doc.html#39438 "表达式")了解信息。

# c# - iSeries 的 XML Web 服务

> ID：354399
> 
> 赞同：0
> 
> 时间：2008-12-09T22:01:36.993
> 
> 标签：c#, asp.net, xml, ibm-midrange

我需要从一个 aspx 页面中的 DB2 数据库中提取项目数量，然后在数量更改后进行更新。我想创建一个将发送 XML 数据然后解析回我的页面的 Web 服务。寻找任何人可能尝试过的任何好的参考或示例。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-11T04:16:39.373

除非有其他原因，否则我建议使用 C# 为您生成 Web 服务。C# 中的 XML 比 RPG 中的过程要好得多。

# objective-c - 在 cocos2d iPhone 中转换和设置图层/场景

> ID：354400
> 
> 赞同：6
> 
> 时间：2008-12-09T22:02:13.717
> 
> 标签：objective-c, iphone, cocos2d-iphone

我希望在两个级别之间设置一个过渡（在一个级别完成后，使用 cocos2d 的平滑过渡之一过渡到下一个级别）。在我的 GameLayer 实现中，我设置了方法来执行诸如 [self buildLevel: 3] 之类的操作来构建游戏场。我需要做什么来实例化新的 GameLayer 或 Layer 节点或 GameScene 或 Scene 节点才能执行以下操作：

GameLayer * nextLevelLayer;

[nextLevelLayer buildLevel: 4];

... 在 3 级和 4 级之间进行过渡

也许我在对Objective C的完全误解中布置了我的代码。我假设你不能在init代码中设置一个新的GameLayer，因为它会挂起，不断地创建新的节点。我的 GameLayer 的初始化代码中可能有太多的游戏场设置代码，你们通常如何处理它？您是否在为游戏的主循环安排选择器之前设置了一个标志，然后如果设置了标志，则在游戏的主循环中设置关卡，或者有更好的方法吗？

提前致谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-11T15:02:31.753

对于那些可能关心的人，这就是我最终做的事情：

```
GameScene * gs = [GameScene node];
[[Director sharedDirector] runScene: gs];
[[Director sharedDirector] replaceScene: [ShrinkGrowTransition transitionWithDuration:0.5 scene: gs]]; 
```

这是在关卡完成后在 GameLayer 实现中完成的。

# winforms - View & Presenter 应该在哪里诞生

> ID：354407
> 
> 赞同：5
> 
> 时间：2008-12-09T22:04:18.190
> 
> 标签：winforms, webforms, mvp

我现在完全理解 MVP 模式，但我仍然很难看到视图和演示者的实例化位置。我已经看到了一些演示者在视图中更新的示例，但这是正确的。在阅读了 Jeremy Miller 关于 View 和 Presenter 之间通信的博客文章后，他在 Presenter 上有一个功能，可以将 Presenter 附加到视图。

那么我的问题是：应该在哪里创建视图和演示者？也在winforms和webforms中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T22:15:08.730

在 web 表单中，页面由请求实例化。由于页面是视图并且您无法控制执行顺序，因此视图必须向演示者注册自身

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T22:28:05.677

在 Winforms 中，我根据需要实例化视图（例如：在`main`方法中，或在另一个演示者的方法中，但在任何地方都有意义）。然后视图创建​​并注册一个新的演示者实例。

这使得让多个视图使用相同的演示者逻辑变得容易，并且使我的视图的用户免受我使用 MVP 的特定架构决策的影响。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-01-17T23:15:05.757

首先是好问题。其次，它可能并不重要。我个人的偏好是几乎总是在视图中连接演示者和视图。

比较这个场景：

```
public class SomePresenter
{
    public ShowContactView(IContactView view)
    {
        IContact model = new Contact();
        new ContactPresenter(model, view);
        view.Show();
    }
} 

public class AnotherPresenter
{
    public ShowContactView(IContactView view)
    {
        IContact model = new Contact();
        new ContactPresenter(model, view);
        view.Show();
    }
} 

public class YetAnotherPresenter
{
    public ShowContactView(IContactView view)
    {
        IContact model = new Contact();
        new ContactPresenter(model, view);
        view.Show();
    }
} 

public partial class ContactView : Form, IContactView
{    
    public ContactView()
    {
        InitializeComponent();
    }
} 
```

对此：

```
public class SomePresenter
{
    public ShowContactView(IContactView view)
    {
        view.Show();
    }
} 

public class AnotherPresenter
{
    public ShowContactView(IContactView view)
    {
        view.Show();
    }
} 

public class YetAnotherPresenter
{
    public ShowContactView(IContactView view)
    {
        view.Show();
    }
} 

public partial class ContactView : Form, IContactView
{    
    public ContactView()
    {
        InitializeComponent();

        new ContactPresenter(new Contact(), this);
    }
} 
```

如您所见，后者的代码重复要少得多。当然这是愚蠢的重复，或者您可以说您可以将通用功能移动到共享功能，但您明白了，这只是一个示例。那时您将在应用程序的多个部分实例化相同的视图。

此外，View 知道 Presenter 的好处是你只需要在你的 View 项目中引用 Presenter，这样你就可以在不同的 UI 应用程序中重复使用同一个 Presenter。否则，您将需要在 Presenter 中引用每个 View 项目。

**但更重要的是看看不同的模型如何适合你的情况。**老实说，[甚至还有更多的可能性。请参阅这个重复的问题。](https://stackoverflow.com/questions/6248992/does-presenter-in-model-view-presenter-create-views)

# .net - .NET WinForms ComboBox、相同的项目和 SelectedIndexChanged 事件

> ID：354408
> 
> 赞同：5
> 
> 时间：2008-12-09T22:04:28.690
> 
> 标签：.net, vb.net, winforms

似乎当您有一个 WinForms .NET 应用程序和一个 ComboBox（设置为“DropDown”样式），并且 ComboBox 中有多个相同的项目时，就会发生奇怪的事情。具体来说，所选项目的索引可以在*不*触发 SelectedIndexChanged 事件的情况下更改。

当然，这会导致大量混乱和奇怪的、晦涩的错误，这就是我最近一直在努力解决的问题。

这是一个简单的示例，您可以使用它来了解我在说什么：

*   制作一个新的 .NET WinForms 项目（我使用 VB.NET，但可以随意翻译——它很简单）。
*   将一个 ComboBox、一个按钮和一个 TextBox（设置 MultiLine=True）放到窗体上。
*   使用以下代码加载具有 3 个相同项目的 ComboBox，并在 SelectedIndexChanged 事件触发时打印一些状态消息，并查看当前选择的索引是什么（通过按钮）：

```
Private Sub ComboBox1_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ComboBox1.SelectedIndexChanged
        TextBox1.Text = TextBox1.Text & vbNewLine & "ComboBox SelectedIndexChanged event fired." & vbNewLine & _
            "SelectedIndex is: " & ComboBox1.SelectedIndex
    End Sub

    Private Sub Form1_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        ComboBox1.Items.Add("John Doe")
        ComboBox1.Items.Add("John Doe")
        ComboBox1.Items.Add("John Doe")

    End Sub

    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
        TextBox1.Text = TextBox1.Text & vbNewLine & _
        "Button clicked." & vbNewLine & _
        "SelectedIndex is: " & ComboBox1.SelectedIndex
    End Sub
```

运行项目并从 ComboBox 中选择一个项目（例如，中间的项目）。然后，单击组合框的下拉箭头，但不要选择任何内容。单击按钮（默认为 Button1）并查看其内容。

除非我失去理智，否则您应该看到以下内容：

```
触发 ComboBox SelectedIndexChanged 事件。
SelectedIndex 为：1
按钮单击。
SelectedIndex 为：0
```

换句话说，SELECTED INDEX 已更改但未触发 SelectedIndexChanged 事件！

仅当 ComboBox 中的项目相同时才会发生这种情况。如果它们不同，则不会发生这种情况。（如果 ComboBox 的“DropDown”样式设置为“DropDownList”，也不会发生这种情况。）

我怀疑这可能是 .NET 框架本身的一个错误，而不是我可以修复的问题，但是如果其他人有任何想法在这里做什么（或者我可能做错了什么！），请插话！我无法解释这种行为或解决它（我希望 SelectedIndex 保持不变，除非，你知道，你实际上通过选择其他东西来改变它！）

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-10T03:29:49.170

.NET Framework 实际上并不跟踪组合框下拉列表的选定索引；这是由 Windows API 在内部处理的。因此，.NET 依赖于 Windows API 在选定索引更改时通过发送到组合框的窗口句柄的通知消息来通知它，以便它可以反过来触发 SelectedIndexChanged 事件。

不幸的是，事实证明，.NET 监视的特定通知消息（`CBN_SELCHANGE`准确地说）并未涵盖所选索引可能更改的所有可能情况。具体来说，`CBN_SELCHANGE`仅当用户单击或使用箭头键选择下拉列表中的项目时，才会由 Windows API 发送。但是，在 DropDown 样式的组合框中，打开组合框的行为会导致 Windows 查看组合框编辑部分中的文本，在项目列表中搜索匹配项，如果找到匹配项，则会自动选择匹配项（或第一个匹配项，如果有多个匹配项）。这可以更改所选索引，但不会发送`CBN_SELCHANGE`通知消息，因此 .NET 忽略了它已更改并且不会触发 SelectedIndexChanged 事件的事实。

Windows 在下拉式组合框中完成所有这些操作，因为用户不必在下拉列表中选择某些内容；他们可以输入任何他们想要的内容。因此，每次打开组合框时，它都会假定用户可能已经更改了文本并尝试与列表中的内容重新同步（如果可以）。

在您的情况下，当您第二次打开组合框时，它正在重新同步并选择编辑部分中文本的第一个匹配项，即“John Doe”#0，并将选定的索引更改为 0 而没有.NET 意识到这一点。

所以它基本上是 .NET Framework 中的一个错误。不幸的是，没有完美的解决方法——您无法让 Windows 不进行重新同步，并且在重新同步发生后不会立即触发事件，您可以在其中获取新的选定索引。（DropDown 事件实际上是在重新同步发生之前触发的，因此它不会看到新的索引。）您能做的最好的事情是处理 DropDownClosed 事件，假设索引可能在那个时候发生了变化，并采取相应的行动.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-30T06:54:16.250

Eric 的回答非常彻底，但令我惊讶的是它并没有以“......但实际上，你应该问自己为什么要使用重复项填充组合框”。.Net 框架错误无疑已被允许存在，因为当您按预期使用控件时，允许用户从列表中选择一个项目，您不会遇到此错误。

用户如何区分相同的条目？为什么他们会选择一个而不是另一个？不同的项目有不同的含义吗？如果是这样，那么重复条目是不明确的，这总是糟糕的可用性设计。如果没有，那么你不应该有重复的项目。

我能想到的唯一可能有意义的情况是，当您有一个包含多组相关项目的大型列表时，其中一个或多个项目在逻辑上适合多个组，因此您希望在两个部分中都显示它。

我猜你的设计没有考虑到可能有多个相同的条目，并且这个遗漏会产生比这个问题更重要的其他可用性影响。当然，我知道你可能正在做一些我没有想到的事情，在这种情况下你正在做的事情完全有意义，在这种情况下，你可以随意忽略我的评论。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-28T20:38:22.037

在某些情况下，列表中的重复项不仅有效，而且是可取的。请考虑按下“打开文件”按钮时在 Visual Studio 中看到的 OpenFileDialog 组合框。这将显示一个组合框，其中包含“我的电脑”、“桌面”、“我的文档”等项目。对于文件夹名称，列表中只有短名称。不显示完整路径。因此，一个文件夹很可能与其后代之一具有相同的（短）名称。

所以想象以下文件夹结构：

```
C:\
C:\A
C:\A\B
C:\A\B\A 
```

一个完全有效的结构。在我的实现中，我将 DataSource 属性设置为对象的 BindingList。对象的ValueMember为全文件名，DisplayMember为短文件名。组合框应显示：

```
C:\
    A
        B
            A 
```

完美的用户界面设计。缩进表明文件夹的嵌套。

但是，当我将组合框的 SelectedValue 设置为“C:\A\B\A”时，选择了错误的项目。应选择的项目是列表中的最后一项（第 4 项），而是选择了第 2 项（索引 1）。并且设置 SelectedIndex=3 不会按预期运行。同样，第二个项目被选中，而不是最后一个。

这里似乎发生的是，当设置 SelectedValue 或 SelectedIndex 时，值正在使用 DisplayMember 属性进行转换，并且控件正在从头到尾搜索匹配项。它应该使用 ValueMember 属性进行搜索。示例代码如下。感谢有人能确认这是一个错误，或者我做错了什么。

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Windows.Forms;

namespace ComboBoxTest
{
   public partial class Form1 : Form
   {
      public Form1()
      {
         InitializeComponent();
      }

      private void Form1_Load(object sender, EventArgs e)
      {
         if (DesignMode)
            return;

         BindingList<CBItem> items = new BindingList<CBItem>();
         items.Add(new CBItem("A", @"C:\A"));
         items.Add(new CBItem("B", @"C:\A\B"));
         items.Add(new CBItem("A", @"C:\A\B\A"));

         comboBox.DisplayMember = "DisplayValue";
         comboBox.ValueMember = "RealValue";
         comboBox.DataSource = items;

         comboBox.SelectedValue = @"C:\A\B\A";
      }
   }

   class CBItem
   {
      public CBItem(string displayValue, string realValue)
      {
         _displayValue = displayValue;
         _realValue = realValue;
      }

      private readonly string _displayValue, _realValue;

      public string DisplayValue { get { return _displayValue; } }
      public string RealValue { get { return _realValue; } }
   }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-28T10:15:03.700

如果您输入的自由文本与第一个字符不完全匹配，则在没有相同项目的情况下会出现类似的问题。如果用户没有打开下拉菜单，则不会发生重新同步，并且所选索引为 -1，如预期的那样。（不选择其中一项是用户打算做的）现在用户关闭对话框并再次打开它。作为程序员，您可以使用用户输入的文本恢复组合框，并且文本会自动完成到项目部分匹配，而无需触发事件。如果用户关闭对话框，则文本已更改，恕不另行通知。如果文本与任何项目都不匹配，则不会发生此问题。

# validation - 用于验证 XML 的 XSD 文件

> ID：354414
> 
> 赞同：1
> 
> 时间：2008-12-09T22:05:45.893
> 
> 标签：validation, xsd

任何人都可以帮助我构建一个 XSD 文件来验证这样的 XML：

```
[test]
[a/]
[b/]
[a/]
[b/]
[/test]

[test]
[a/]
[a/]
[b/]
[/test] 
```

基本上，我可以拥有任意数量的`<a>`和/或`<b>`节点而无需任何其他规则（不能使用`<xs:sequence>`）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T02:09:01.923

**如果您有很多a**或**b**节点，它不会很快，但这可以验证您所描述的内容。

```
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:element name="test">
    <xs:complexType>
      <xs:sequence>
        <xs:choice maxOccurs="unbounded">
          <xs:element name="a"/>
          <xs:element name="b"/>
        </xs:choice>
      </xs:sequence>
    </xs:complexType>
  </xs:element>
</xs:schema> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T22:21:29.543

如果您粘贴示例 XML，我们可以为您提供更好的帮助。但是，[Microsoft 有一个 XSD 代码生成器](https://stackoverflow.com/questions/288236/xsd-code-generator)，它基于您作为参数传入的 XML 文件生成 XSD。

# asp.net-mvc - ASP.NET MVC Beta 项目无法在子文件夹中正确创建控制器测试

> ID：354415
> 
> 赞同：0
> 
> 时间：2008-12-09T22:06:14.067
> 
> 标签：asp.net-mvc, visual-studio-2008, unit-testing

我正在使用安装了 TestDriven.Net 的 VS2008 Team Suite、ASP.NET MVC Beta。当我从模板创建项目时，它还创建了一个“测试”项目，并将 AccountController 的一些控制器测试放在该项目内的文件夹中。我添加了其他控制器和相关测试。但是，当我右键单击控制器中的方法并使用“创建单元测试”对话框时，它无法在项目的现有测试类中创建单元测试存根。它在测试项目的根目录创建一个同名的新测试类文件，但不插入测试存根。如果我将控制器测试从测试项目中的控制器文件夹上移一级，它工作正常。

有其他人看到这种行为还是与我的特定设置有关？我不会注意到，但该项目将测试隔离在一个单独的文件夹中，我认为这是一个好主意。现在我正在尝试使用它，我要么必须手动创建新测试，要么撤消隔离。如果只是我，关于在哪里调整行为以解决它的任何想法？

我`Visual C# test project`在选项中选择了默认值，其中`Unit Test`包含的唯一文件。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-10T14:11:53.650

我刚刚尝试使用我已经创建的控制器来执行此操作。控制器单元测试类是在（测试）项目的根目录中创建的。当我为该类的另一个操作创建测试时，在同一个类中创建了第二个测试。

我没有看到单独的文件夹，这个测试类是在测试项目的根目录中创建的。

抱歉，这没有更多帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-25T18:22:13.967

作为 Codeplex 上的错误提交。

# nhibernate - NHibernate.Caches.MemCache web.config 用于缓存过期时间

> ID：354419
> 
> 赞同：1
> 
> 时间：2008-12-09T22:06:52.473
> 
> 标签：nhibernate, web-config, memcached

我正在迁移到 Nhibernate 2.0 GA，但在 memcached 提供程序中设置缓存过期时遇到了一些麻烦。

我在 NHibernate.Caches.MemCache 源中看到有一个过期属性和一个 300 秒的默认值。

缓存区域也有属性，但配置部分处理程序似乎没有映射它们。

是否有其他方式设置缓存过期时间不是特定于提供者的——

这是功能性网络配置部分（显然没有过期设置）。

```
<memcache>
    <memcached host="127.0.0.1" port="11211"/>
    <!-- or multiples -->
</memcache>

<hibernate-configuration xmlns="urn:nhibernate-configuration-2.2">
    <session-factory>
        <property name="show_sql">true</property>
        <property name="connection.provider" >NHibernate.Connection.DriverConnectionProvider</property>
        <property name="dialect">NHibernate.Dialect.MsSql2000Dialect</property>
        <property name="connection.driver_class">NHibernate.Driver.SqlClientDriver</property>
                <!--    <property name="hibernate.cache.provider_class" value="NHibernate.Caches.MemCache.MemCacheProvider,NHibernate.Caches.MemCache" /> -->
        <property name="connection.connection_string">Data Source=stage2.ripple6.com;Initial Catalog=r6stage;User Id=sa;Password=mworld7650;Application Name=Hibernate;</property>
        <property name="connection.isolation">ReadCommitted</property>
        <property name="cache.use_second_level_cache">true</property>
        <property name="cache.provider_class">NHibernate.Caches.MemCache.MemCacheProvider,NHibernate.Caches.MemCache</property>
        <property name="default_schema" >r6stage.dbo</property>
    </session-factory>

</hibernate-configuration> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-05-09T06:26:15.530

使用 default_expiration。

```
<property name="default_expiration" >YOUR_INTERVAL_IN_SECONDS</property> 
```

我在源代码中看到默认过期值设置为 300 秒。但是你可以通过在 NHibernate 配置文件中设置 default_expiration 属性来覆盖这个值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-12T15:22:32.170

据我了解，缓存到期时间是特定于提供商的，因为某些缓存提供商不支持这一点。此外，这意味着您不会遇到值 60 在某些情况下表示一小时而在其他情况下表示一分钟的情况。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-14T19:59:50.600

使用过期。

```
<property name="expiration" >YOUR_INTERVAL_IN_SECONDS</property> 
```

之后，当您运行带有日志记录的应用程序时，您可以看到：

```
NHibernate.Caches.MemCache.MemCacheClient: 20:57:55,762 DEBUG MemCacheClient:0 - using expiration of YOUR_INTERVAL_IN_SECONDS seconds 
```

# python - ** 在 Python 中是如何实现的？

> ID：354421
> 
> 赞同：11
> 
> 时间：2008-12-09T22:07:10.743
> 
> 标签：python

我想知道在哪里可以找到显示运算符 ** 如何在 Python 中实现的源代码。有人可以指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-09T23:33:18.243

python 语法定义（使用[pgen 从中](http://www.python.org/dev/peps/pep-0269/)生成解析器），查找“power”：[Gramar/Gramar](http://svn.python.org/view/python/trunk/Grammar/Grammar?rev=65872&view=markup)

python ast，寻找'ast_for_power'：[Python/ast.c](http://svn.python.org/view/python/trunk/Python/ast.c?rev=67590&view=markup)

python eval循环，寻找'BINARY_POWER'：[Python/ceval.c](http://svn.python.org/view/python/trunk/Python/ceval.c?rev=67666&view=markup)

它调用 PyNumber_Power （在[Objects/abstract.c](http://svn.python.org/view/python/trunk/Objects/abstract.c?rev=66043&view=markup)中实现）：

```
PyObject *
PyNumber_Power(PyObject *v, PyObject *w, PyObject *z)
{
    return ternary_op(v, w, z, NB_SLOT(nb_power), "** or pow()");
} 
```

本质上，调用**pow**插槽。对于 long 对象（3.0 中唯一的默认整数类型），这在 long_pow 函数[Objects/longobject.c](http://svn.python.org/view/python/trunk/Objects/longobject.c?rev=65518&view=markup)中实现，对于 int 对象（在 2.x 分支中），它在 int_pow 函数[Object/intobject.c中实现](http://svn.python.org/view/python/trunk/Objects/intobject.c?rev=64753&view=markup)

如果您深入研究 long_pow，您可以看到在审查参数并进行一些设置之后，可以在此处看到求幂的核心：

```
if (Py_SIZE(b) <= FIVEARY_CUTOFF) {
    /* Left-to-right binary exponentiation (HAC Algorithm 14.79) */
    /* http://www.cacr.math.uwaterloo.ca/hac/about/chap14.pdf    */
    for (i = Py_SIZE(b) - 1; i >= 0; --i) {
        digit bi = b->ob_digit[i];

        for (j = 1 << (PyLong_SHIFT-1); j != 0; j >>= 1) {
            MULT(z, z, z)
            if (bi & j)
                MULT(z, a, z)
        }
    }
}
else {
    /* Left-to-right 5-ary exponentiation (HAC Algorithm 14.82) */
    Py_INCREF(z);   /* still holds 1L */
    table[0] = z;
    for (i = 1; i < 32; ++i)
        MULT(table[i-1], a, table[i])

    for (i = Py_SIZE(b) - 1; i >= 0; --i) {
        const digit bi = b->ob_digit[i];

        for (j = PyLong_SHIFT - 5; j >= 0; j -= 5) {
            const int index = (bi >> j) & 0x1f;
            for (k = 0; k < 5; ++k)
                MULT(z, z, z)
            if (index)
                MULT(z, table[index], z)
        }
    }
} 
```

它使用了[应用密码学手册](http://www.cacr.math.uwaterloo.ca/hac/)[第 14.6 章](http://www.cacr.math.uwaterloo.ca/hac/about/chap14.pdf)中讨论的算法，该章描述了任意精度算术的有效取幂算法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T23:32:22.897

有两种不同的实现，一种用于 int（3.0 中为 long）对象，另一种用于 float 对象。

float pow 是 Python 源代码的 Objects/floatobject.c 文件中定义的 float_pow(PyObject *v, PyObject *w, PyObject *z) 函数。此函数从 C stdlib 的 math.h 调用 pow()

int pow 有自己的实现，是 Python 源代码的 Objects/intobject.c（longobject.c for 3.0）中定义的函数 int_pow(PyIntObject *v, PyIntObject *w, PyIntObject *z)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T23:47:28.497

我认为 caseysrandomthoughts 在函数定义中询问星号。

您可以在此 Python 文档页面找到答案：http: [//docs.python.org/tutorial/controlflow.html#more-on-defining-functions](http://docs.python.org/tutorial/controlflow.html#more-on-defining-functions)

当存在 **name 形式的最终形式参数时，它会接收包含所有关键字参数的字典，除了与形式参数相对应的那些。

我已经在 python doc 的其他地方播下了对这些东西的描述，但我不记得了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T22:10:08.210

这是运营商的权力

[python.org doc - 电源运算符](http://www.python.org/doc/2.5.2/ref/power.html)

编辑：哦，该死，代码，对。希望链接仍然有帮助。从我的部分草率阅读

# vb6 - 找不到对象/模块：从 VB6 应用程序到 Win2003 服务器的 RDS

> ID：354428
> 
> 赞同：0
> 
> 时间：2008-12-09T22:08:39.383
> 
> 标签：vb6, windows-server-2003, rds

我有一个用 VB6 编写并在 Windows 2000 服务器上运行的相当旧的应用程序 EXE，它使用 RDS（远程数据服务）来访问在 Windows 2003 服务器上运行的业务对象 DLL（也用 VB6 编写）。DLL 从未在此服务器上运行（我们正在将组件从旧的 W2K 服务器上移出），但它已注册并定义为 W2k+3 服务器上的组件。

调用 DLL 的具体代码是：

```
Private m_rdsDS As RDS.DataSpace
Dim oARImport As Object

Set oARImport = m_rdsDS.CreateObject("ARBatches.BL_ARBatches", txtWebServer)
MsgBox oARImport.AddBatches(m_vConnParms, arbParseString, LinesFromFile) 
```

CreateObject 似乎工作正常，但调用 AddBatches 方法会引发错误号 8209“Internet 服务器错误：找不到对象/模块”。我倾向于认为问题的根源存在权限问题，但如果是这种情况，为什么不说“你没有权限”？

我真的很想重写整个应用程序，但“他们”不会让我这样做。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-06T23:11:54.407

花了很多调试，但我终于自己解决了这个问题。“找不到对象/模块”问题原来是 MSADC 尚未以可以找到 ARBatches 对象的方式在服务器上运行的问题。

# c++ - 寻找类似 C++ STL 的向量类但使用堆栈存储

> ID：354442
> 
> 赞同：72
> 
> 时间：2008-12-09T22:15:21.210
> 
> 标签：c++, data-structures, stl, vector

在我写我自己的之前，我会问你们所有人。

我正在寻找一个几乎完全像 STL 向量但将数据存储到堆栈上的数组中的 C++ 类。某种 STL 分配器类也可以工作，但我试图避免任何类型的堆，甚至是静态分配的每线程堆（尽管其中一个是我的第二选择）。堆栈更有效。

它几乎需要替换当前使用向量的代码。

对于我自己要写的东西，我在想这样的事情：

```
char buffer[4096];
stack_vector<match_item> matches(buffer, sizeof(buffer)); 
```

或者该类可以在内部分配缓冲区空间。然后它看起来像：

```
stack_vector<match_item, 256> matches; 
```

我在想如果空间用完它会抛出 std::bad_alloc ，尽管这不应该发生。

**更新**

使用 Chromium 的 stack_container.h 效果很好！

我自己没想过这样做的原因是我一直忽略了 STL 集合构造函数的分配器对象参数。我曾多次使用模板参数来做静态池，但我从未见过代码或编写过任何实际使用对象参数的代码。我学到了一些新东西。很酷！

代码有点混乱，出于某种原因，GCC 迫使我将分配器声明为实际项目，而不是将其构造为向量的分配器参数。它来自这样的事情：

```
typedef std::pair< const char *, const char * > comp_list_item;
typedef std::vector< comp_list_item > comp_list_type;

comp_list_type match_list;
match_list.reserve(32); 
```

对此：

```
static const size_t comp_list_alloc_size = 128;
typedef std::pair< const char *, const char * > comp_list_item;
typedef StackAllocator< comp_list_item, comp_list_alloc_size > comp_list_alloc_type;
typedef std::vector< comp_list_item, comp_list_alloc_type > comp_list_type;

comp_list_alloc_type::Source match_list_buffer;
comp_list_alloc_type match_list_alloc( &match_list_buffer );
comp_list_type match_list( match_list_alloc );
match_list.reserve( comp_list_alloc_size ); 
```

每当我宣布一个新的时，我都必须重复这一点。但它就像我想要的那样工作。

我注意到 stack_container.h 定义了一个 StackVector，我尝试使用它。但它没有从 vector 继承或定义相同的方法，因此它不是一个直接替代品。我不想使用向量重写所有代码，所以我放弃了它。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-12-09T22:27:00.920

您不必编写全新的容器类。您可以坚持使用您的 STL 容器，但更改例如的第二个参数，以便`std::vector`为其提供从堆栈缓冲区分配的自定义分配器。铬作者为此编写了一个分配器：

[https://chromium.googlesource.com/chromium/chromium/+/master/base/stack_container.h](https://chromium.googlesource.com/chromium/chromium/+/master/base/stack_container.h)

它通过在你说它有多大的地方分配一个缓冲区来工作。您创建容器并调用`container.reserve(buffer_size);`. 如果溢出该大小，分配器将自动从堆中获取元素（因为它是从 派生的`std::allocator`，在这种情况下它将只使用标准分配器的设施）。我还没有尝试过，但它看起来像是来自谷歌，所以我认为值得一试。

用法是这样的：

```
StackVector<int, 128> s;
s->push_back(42); // overloaded operator->
s->push_back(43);

// to get the real std::vector. 
StackVector<int, 128>::ContainerType & v = s.container();
std::cout << v[0] << " " << v[1] << std::endl; 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2014-01-16T13:23:13.270

看来[boost::static_vector](http://www.boost.org/doc/libs/1_55_0/doc/html/container/non_standard_containers.html#container.non_standard_containers.static_vector)是您正在搜索的内容。从文档中：

> static_vector 是向量和数组的混合体：和向量一样，它是一个序列容器，具有可以改变大小的连续存储，以及静态分配、低开销和固定容量的数组。static_vector 基于 Adam Wulkiewicz 和 Andrew Hundt 的高性能 varray 类。
> 
> static_vector 中的元素数量可以动态变化，直至达到固定容量，因为元素存储在对象本身中，类似于数组。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-12-10T01:18:56.987

您可能想要查看的一些选项：

Matthew Wilson（Imperfect C++ 的作者）的 STLSoft 有一个`auto_buffer`模板类，它将默认数组放在堆栈上，但如果它增长大于堆栈分配，则会从堆中获取内存。我喜欢这个类——如果你知道你的容器大小通常会受到一个相当低的限制，那么你就会获得本地堆栈分配数组的速度。但是，对于需要更多内存的极端情况，它仍然可以正常工作。

[http://www.stlsoft.org/doc-1.9/classstlsoft_1_1auto__buffer.html](http://www.stlsoft.org/doc-1.9/classstlsoft_1_1auto__buffer.html)

请注意，我自己使用的实现不是 STLSoft 的，而是大量借鉴的实现。

`alloca()`“The Lazy Programmer”为实现用于存储的容器做了一篇文章。我不是这种技术的粉丝，但如果它是你想要的，我会让你自己决定：

[http://tlzprgmr.wordpress.com/2008/04/02/c-how-to-create-variable-length-arrays-on-the-stack/](http://the-lazy-programmer.com/blog/?p=24)

然后，`boost::array`它没有前两个的动态调整大小行为，但为您提供了更多的`vector`接口，而不仅仅是使用指针作为通过内置数组获得的迭代器（即，您得到`begin()`, `end()`,`size()`等）：

[http://www.boost.org/doc/libs/1_37_0/doc/html/boost/array.html](http://www.boost.org/doc/libs/1_37_0/doc/html/boost/array.html)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-07-29T11:20:15.903

如果速度很重要，我会看到运行时间

*   4 ns int[10]，栈上的固定大小
*   40 纳秒`<vector>`
*   1300 纳秒`<stlsoft/containers/pod_vector.hpp>`

对于下面的一个愚蠢的测试——只有 2 push，v[0] v[1]，2 pop，在一个平台上，mac ppc，gcc-4.2 -O3 而已。（我不知道苹果是否优化了他们的 stl。）

不要接受任何你没有伪造过的时间。当然，每种使用模式都是不同的。尽管如此，因素 > 2 让我感到惊讶。

（如果内存、内存访问是运行时的主要因素，那么各种实现中的所有额外内存是什么？）

```
#include <stlsoft/containers/pod_vector.hpp>
#include <stdio.h>
using namespace std;

int main( int argc, char* argv[] )
{
        // times for 2 push, v[0] v[1], 2 pop, mac g4 ppc gcc-4.2 -O3 --
    // Vecint10 v;  // stack int[10]: 4 ns
    vector<int> v;  // 40 ns
    // stlsoft::pod_vector<int> v;  // 1300 ns
    // stlsoft::pod_vector<int, std::allocator<int>, 64> v;

    int n = (argv[1] ? atoi( argv[1] ) : 10) * 1000000;
    int sum = 0;

    while( --n >= 0 ){
        v.push_back( n );
        v.push_back( n );
        sum += v[0] + v[1];
        v.pop_back();
        v.pop_back();
    }
    printf( "sum: %d\n", sum );

} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-09T22:18:30.813

您可以将自己的分配器用于 std::vector 并让它分配基于堆栈的存储块，类似于您的示例。分配器类是模板的第二部分。

编辑：我从来没有尝试过这个，查看文档进一步让我相信你不能编写自己的分配器。我还在研究它。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-09T22:39:40.613

tr1::array 部分符合您的描述。它缺少诸如 push___back() 之类的东西，但作为起点可能值得一看。包装它并向“back”添加索引以支持 push_back() 等应该相当容易。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-09T22:25:10.660

为什么特别想*入栈*？如果你有一个 alloca() 的实现，你可以使用它而不是 malloc() 来构建一个类分配器，但是你使用静态分配数组的想法更好：它在大多数架构上都一样快，而你不需要你搞砸的风险堆栈腐败。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-05-13T20:00:24.230

您可能正在使用 Qt。然后你可能想去`QVarLengthArray`（[docs](http://qt-project.org/doc/qt-4.8/qvarlengtharray.html)）。它基本上位于`std::vector`和之间`std::array`，静态分配一定数量并在必要时回退到堆分配。

不过，如果我使用它，我更喜欢增强版。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-04-21T08:50:48.023

Boost有这个。它称为[small_vector](http://www.boost.org/doc/libs/1_60_0/doc/html/container/non_standard_containers.html#container.non_standard_containers.small_vector)

> small_vector 是一个类向量容器，针对包含少量元素的情况进行了优化。它包含一些就地预分配的元素，这允许它在实际元素数量低于预分配阈值时避免使用动态存储分配。small_vector 的灵感来自 LLVM 的 SmallVector 容器。与 static_vector 不同，small_vector 的容量可以增长到超出初始预分配容量。
> 
> small_vector 可转换为 small_vector_base，这是一种独立于预分配元素计数的类型，允许不需要在该 N 参数上模板化的客户端代码。small_vector 继承了所有 vector 的成员函数，因此它支持所有标准功能，如 emplacement、有状态分配器等。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-03-07T13:27:26.493

如果您想在堆栈上分配但不想在编译时预先定义最大大小，您可以使用[StackVector](https://github.com/mathusummut/StackVector)，一个可以像这样使用的小型实现：

```
new_stack_vector(Type, name, size) 
```

其中`Type`是向量中元素的类型，是向量`name`的变量名，是向量`size`中允许的最大元素数。

**`size`可以是变量，不需要是编译时常量！:D**

例子：

```
new_stack_vector(int, vec, 100); //like vector<int> vec; vec.reserve(100); but on the stack :)
vec.push_back(10); //added "10" as the first item in the vector 
```

...就这样！

*免责声明：一般来说，永远不要在堆栈上使用非常大的数组大小。像你不应该使用`int var[9999999]`，你同样不应该使用`new_stack_vector(int, vec, 9999999)`！负责任地使用。*

# winforms - 从最小化恢复 WindowState

> ID：354445
> 
> 赞同：41
> 
> 时间：2008-12-09T22:16:11.833
> 
> 标签：winforms

有没有一种简单的方法可以将最小化的形式恢复到以前的状态，正常或最大化？我期待与单击任务栏（或右键单击并选择恢复）相同的功能。

到目前为止，我有这个，但如果表单之前最大化，它仍然会作为普通窗口返回。

```
if (docView.WindowState == FormWindowState.Minimized)
    docView.WindowState = FormWindowState.Normal; 
```

我是否必须处理表单中的状态更改才能记住以前的状态？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2010-04-27T21:20:51.187

我使用以下扩展方法：

```
using System.Runtime.InteropServices;

namespace System.Windows.Forms
{
    public static class Extensions
    {
        [DllImport( "user32.dll" )]
        private static extern int ShowWindow( IntPtr hWnd, uint Msg );

        private const uint SW_RESTORE = 0x09;

        public static void Restore( this Form form )
        {
            if (form.WindowState == FormWindowState.Minimized)
            {
                ShowWindow(form.Handle, SW_RESTORE);
            }
        }
    }
} 
```

然后调用`form.Restore()`我的代码。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2015-02-24T13:26:14.343

将表单恢复到正常状态的最简单方法是：

```
if (MyForm.WindowState == FormWindowState.Minimized)
{
    MyForm.WindowState = FormWindowState.Normal;
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-09T22:31:46.077

您可以像这样模拟单击任务栏按钮：

```
SendMessage(docView.Handle, WM_SYSCOMMAND, SC_RESTORE, 0); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-09-09T10:55:21.153

对我来说，上面的代码不起作用。

但最后我找到了工作代码。这里是：

```
CxImports.ManagedWindowPlacement placement = new CxImports.ManagedWindowPlacement();
CxImports.GetWindowPlacement(Convert.ToUInt32(Handle.ToInt64()), placement);

if (placement.flags == CxImports.WPF_RESTORETOMAXIMIZED)
    WindowState = FormWindowState.Maximized;
else
    WindowState = FormWindowState.Normal; 
```

我想，您可以通过简单的谷歌搜索找到所有需要的“导入”功能。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2018-07-07T00:35:53.607

如果有人想知道如何使用其他应用程序窗口执行此操作，此代码适用于我：

```
 public void UnMinimize(IntPtr handle)
    {
        WINDOWPLACEMENT WinPlacement = new WINDOWPLACEMENT();
        GetWindowPlacement(handle, out WinPlacement);
        if(WinPlacement.flags.HasFlag(WINDOWPLACEMENT.Flags.WPF_RESTORETOMAXIMIZED))
        {
            ShowWindow(handle, (int)SW_MAXIMIZE);
        }
        else
        {
            ShowWindow(handle, (int)SW_RESTORE);
        }
    } 
```

东西在这里：

```
[StructLayout(LayoutKind.Sequential)]
public struct RECT
{
    public Int32 Left;
    public Int32 Top;
    public Int32 Right;
    public Int32 Bottom;
}

public struct POINT
{
    public int x;
    public int y;
}

public struct WINDOWPLACEMENT
{

    [Flags]
    public enum Flags : uint
    {
        WPF_ASYNCWINDOWPLACEMENT = 0x0004,
        WPF_RESTORETOMAXIMIZED = 0x0002,
        WPF_SETMINPOSITION = 0x0001
    }

    /// <summary>
    /// The length of the structure, in bytes. Before calling the GetWindowPlacement or SetWindowPlacement functions, set this member to sizeof(WINDOWPLACEMENT).
    /// </summary>
    public uint length;
    /// <summary>
    /// The flags that control the position of the minimized window and the method by which the window is restored. This member can be one or more of the following values.
    /// </summary>
    /// 
    public Flags flags;//uint flags;
                       /// <summary>
                       /// The current show state of the window. This member can be one of the following values.
                       /// </summary>
    public uint showCmd;
    /// <summary>
    /// The coordinates of the window's upper-left corner when the window is minimized.
    /// </summary>
    public POINT ptMinPosition;
    /// <summary>
    /// The coordinates of the window's upper-left corner when the window is maximized.
    /// </summary>
    public POINT ptMaxPosition;
    /// <summary>
    /// The window's coordinates when the window is in the restored position.
    /// </summary>
    public RECT rcNormalPosition;
}

public class UnMinimizeClass
{
    [DllImport("user32.dll")]
    public static extern bool GetWindowPlacement(IntPtr hWnd, out WINDOWPLACEMENT lpwndpl);

    [DllImport("user32.dll")]
    public static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);

    const int SW_MAXIMIZE = 3;
    const int SW_RESTORE = 9;

    public static void UnMinimize(IntPtr handle)
    {
        WINDOWPLACEMENT WinPlacement = new WINDOWPLACEMENT();
        GetWindowPlacement(handle, out WinPlacement);
        if (WinPlacement.flags.HasFlag(WINDOWPLACEMENT.Flags.WPF_RESTORETOMAXIMIZED))
        {
            ShowWindow(handle, SW_MAXIMIZE);
        }
        else
        {
            ShowWindow(handle, (int)SW_RESTORE);
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-01-13T15:41:04.863

使用`MainWindow.WindowState = WindowState.Normal;`还不够

下一种方法适用于我的 WPF 应用程序：

```
MainWindow.WindowState = WindowState.Normal;
MainWindow.Show();
MainWindow.Activate(); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-09-27T15:47:05.673

```
 [DllImport("user32.dll")] [return: MarshalAs(UnmanagedType.Bool)] public static extern bool GetWindowRect(IntPtr hWnd, ref wndRect lpRect);
    [DllImport("user32.dll")] public static extern bool IsWindowVisible(IntPtr hWnd);
    [DllImport("user32.dll")] public static extern bool EnumWindows(WNDENUMPROC lpEnumFunc, int lParam);//用来遍历所有窗口 
    [DllImport("user32.dll")] public static extern int GetWindowTextW(IntPtr hWnd, [MarshalAs(UnmanagedType.LPWStr)]StringBuilder lpString, int nMaxCount);//获取窗口Text 
    [DllImport("user32.dll")] public static extern int GetClassNameW(IntPtr hWnd, [MarshalAs(UnmanagedType.LPWStr)]StringBuilder lpString, int nMaxCount);//获取窗口类名 

    public static List<wndInfo> GetAllDesktopWindows(bool? isVisitable_)
    {
        //用来保存窗口对象
        List<wndInfo> wndList = new List<wndInfo>();

        //enum all desktop windows 
        EnumWindows(delegate (IntPtr hWnd, int lParam)
        {
            wndInfo wnd = new wndInfo();
            StringBuilder sb = new StringBuilder(256);
            //get hwnd 
            wnd.hWnd = hWnd;
            if (isVisitable_ == null || IsWindowVisible(wnd.hWnd) == isVisitable_)
            {
                //get window name  
                GetWindowTextW(hWnd, sb, sb.Capacity);
                wnd.szWindowName = sb.ToString();

                //get window class 
                GetClassNameW(hWnd, sb, sb.Capacity);
                wnd.szClassName = sb.ToString();

                wndList.Add(wnd);
            }
            return true;

        }, 0);

        return wndList;
    }

    private void Btn_Test5_Click(object sender, RoutedEventArgs e)
    {
        var ws = WSys.GetAllDesktopWindows(true);
        foreach (var w in ws)
        {
            if (w.szWindowName == "计算器")
            {
                WSys.ShowWindow(w.hWnd, 5);
                WSys.ShowWindow(w.hWnd, 9);
                Log.WriteLine(w.szWindowName);
            }
        }
    } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-02-22T09:39:41.870

我刚刚添加了一篇文章来概括@Mesmo 给出的解决方案。如果未创建实例，它将创建实例，如果实例已从应用程序中的任何位置创建，则恢复并聚焦表单。我的要求是我不想为应用程序中的某些功能打开多个表单。

**实用程序类：**

```
public static class Utilities
{
  [DllImport("user32.dll")]
  private static extern int ShowWindow(IntPtr hWnd, uint Msg);

  private const uint SW_RESTORE = 0x09;

  public static void Restore(this Form form)
  {
    if (form.WindowState == FormWindowState.Minimized)
    {
      ShowWindow(form.Handle, SW_RESTORE);
    }
  }

  public static void CreateOrRestoreForm<T>() where T: Form
  {
    Form form = Application.OpenForms.OfType<T>().FirstOrDefault();

    if (form == null)
    {
      form = Activator.CreateInstance<T>();
      form.Show();
    }
    else
    {
      form.Restore();
      form.Focus();
    }
  }
} 
```

**用法：**

```
Utilities.CreateOrRestoreForm<AboutForm>(); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-08-31T16:29:23.080

如果您不想使用任何 PInvoke 或 API 技巧，这很简单并且有效。跟踪表单何时调整大小，忽略何时最小化。

```
 FormWindowState _PreviousWindowState;

    private void TestForm_Resize(object sender, EventArgs e)
    {
        if (WindowState != FormWindowState.Minimized)
            _PreviousWindowState = WindowState;
    } 
```

稍后当您想要恢复它时 - 例如，如果单击托盘图标：

```
 private void Tray_MouseClick(object sender, MouseEventArgs e)
    {
        Activate();
        if (WindowState == FormWindowState.Minimized)
            WindowState = _PreviousWindowState; // former glory
    } 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2016-09-15T09:04:54.900

上面的代码在所有情况下都不太适合我

检查标志后，我还必须检查 showcmd=3 如果是这样最大化，否则恢复

# ms-access - 访问查询到没有列名的 txt 文件。

> ID：354446
> 
> 赞同：2
> 
> 时间：2008-12-09T22:16:59.320
> 
> 标签：ms-access, export

我有一个访问查询，它创建一些输出，3 列名为例如*A*、*B*和*C*。

我想创建一个函数，我可以在其中自动将此查询输出到没有标题行的文本文件。我目前正在将文件输出到 excel 然后打开文件并删除第一行。然后，用户必须从 excel 转换为文本。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-10T00:15:54.633

您可以使用 TransferText 方法：

```
DoCmd.TransferText acExportDelim,,"myQuery", "D:\temp\myquery.txt" 
```

# .net - 在 VB.NET 中获取 .NET Framework 版本

> ID：354449
> 
> 赞同：3
> 
> 时间：2008-12-09T22:17:28.663
> 
> 标签：.net, vb.net, version

任何人都知道获取运行我的网络应用程序的 .Net 版本的代码`<%= %>`或代码吗？`Response.Write()`

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-09T22:21:03.820

`System.Environment.Version`会给你的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T07:51:14.580

```
System.Runtime.InteropServices.RuntimeEnvironment.GetSystemVersion 
```

# c# - 通过服务器端 asp.net 代码将对象传递给 silverlight

> ID：354453
> 
> 赞同：2
> 
> 时间：2008-12-09T22:18:17.087
> 
> 标签：c#, asp.net, silverlight

是否可以通过 asp.net 服务器端代码将对象（可序列化类或其他方式）传递给 Silverlight 控件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T22:25:08.787

好吧，这将涉及序列化。请记住——您的 Silverlight 客户端与服务器断开连接，就像浏览器与服务器断开连接一样。

[这里](http://www.silverlightshow.net/items/JSON-serialization-and-deserialization-in-Silverlight.aspx)有一篇很棒的文章，介绍了与 Silverlight 之间的 JSON 序列化。以下是文章的摘要：

让我们先简要介绍一下 JSON 是什么。它代表Java **S** **cript** Object **Notation ，****用作**XML的替代品。下面是一个 JSON 文件的简单示例：

 ******`{"FirstName":"Martin","LastName":"Mihaylov"}`对于单个对象

和

`[{"FirstName":"Martin","LastName":"Mihaylov"},{"FirstName":"Emil","LastName":"Stoychev"}]`对于多个对象。

它看起来像一个数组。根据被序列化的对象，它可能看起来非常复杂。

## 序列化

为了使用 DataContractJsonSerializer 可序列化，我们必须设置一个 [DataContract] 属性。序列化将使用的属性必须具有 [DataMember] 属性。注意：要使用这些属性，请添加对 System.Runtime.Serialization 的引用；

```
[DataContract]
public class Person
{

    [DataMember]
    public string FirstName
    {
        get;
        set;
    }

    [DataMember]
    public string LastName
    {
        get;
        set;
    }

} 
```

现在我们准备开始序列化。让我们创建一个将我们的对象作为参数并返回 JSON 格式的字符串的方法：

```
public static string SerializeToJsonString(object objectToSerialize)
{
    using (MemoryStream ms = new MemoryStream())
    {
        DataContractJsonSerializer serializer =
        new DataContractJsonSerializer(objectToSerialize.GetType());
        serializer.WriteObject(ms, objectToSerialize);
        ms.Position = 0;

        using (StreamReader reader = new StreamReader(ms))
        {
            return reader.ReadToEnd();
        }

    }

} 
```

## 反序列化

```
public static T Deserialize<T>(string jsonString)
{

    using (MemoryStream ms = new MemoryStream(Encoding.Unicode.GetBytes(jsonString)))
    {

        DataContractJsonSerializer serializer = new DataContractJsonSerializer(typeof(T));

        return (T)serializer.ReadObject(ms);

    }

} 
```

这是客户端代码的样子：

```
List<Person> persons = Deserialize<List<Person>>( jsonString ); 
```

# release - Web 服务的发布/部署/维护过程

> ID：354454
> 
> 赞同：2
> 
> 时间：2008-12-09T22:18:25.807
> 
> 标签：release, system-administration

我正在研究 24x7x365 Web 服务环境中的一些非脆性发布过程技术。将代码从开发环境发布到关键生产环境的一些您最喜欢的方法是什么？这不仅包括代码更改，还包括数据库架构更改。让我们假设一切都已经过测试并在开发环境的生态系统中获得好评。

您接下来采取哪些步骤将其简化为生产？将流量重定向到停机集群并运行一些自动化脚本？如果是这样，你的脚本是做什么的？如果不是脚本，你喜欢什么样的套路？

只寻找技术见解。请不要“给客户足够的警告”类型的回复。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T22:44:08.857

我认为有几个原则对确保很重要：

1.  仅从源代码控制系统（专用分支或主线上的标签）发布。不可能直接从工作目录释放。
2.  使推送到生产和推送到登台过程完全自动化（包括模式更新）
3.  手头有自动回滚脚本，如果有任何问题，不要害怕使用它。
4.  所有数据库模式更改都使用增量前滚/回滚工具（如 ActiveRecord 或 Liquibase）完成。需要完整的数据库还原应该很少见。
5.  （对于非常大的集群）进行滚动升级；使用两个负载均衡器，一个用于版本 N 版本，一个用于 N+1 版本。随着其他节点加入 N+1 组，持续测试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T23:13:42.217

丹尼斯轩尼诗写了一个很好的总结。至于工具，看看[Capistrano](http://www.capify.org/)。

# sql - NHibernate 的 BuildSchema 有多好？

> ID：354467
> 
> 赞同：2
> 
> 时间：2008-12-09T22:24:27.867
> 
> 标签：sql, nhibernate

我最近一直在研究 NHibernate，并试图了解其中的细节。我在几篇文章中注意到的一件事是使用 BuildSchema 来创建可测试的数据库。

特定示例使用 SqlLite 作为数据库。可以信任 BuildSchema 来创建您的数据库，还是最好以标准方式创建您自己的数据库架构？在我使用 SQL Server Management Studio 的情况下。

**更新：** 这两个答案似乎都给出了有效的建议，我不会说这个问题有一个“答案”，所以我不会将一个特别的答案标记为最终答案。但是，我已经投票支持你们两个人的建议。

总体思路似乎是在数据库设计确定之前在早期开发中使用 BuildSchema，然后在使用版本控制时继续创建/更改 SQL 脚本。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T22:59:17.097

在项目开始时，让 BuildSchema 生成模式可能是可行的，但是一旦你启动并运行了一些临界质量（或者如果你已经向其他人发布了任何东西），你需要协调代码中的更改与更改架构。这不适用于 buildschema 方法。

在我们的项目中，我们为每个需要更改数据库的变更集创建升级和降级脚本。我们没有自动化该过程，但这种做法允许开发人员通过运行增量更改脚本来获取当前版本，并通过运行降级脚本返回到以前的版本。

每个脚本都是它自己的文件，并且可能包含对 DDL 和/或 DML 的多个更改以迁移数据等。

我们只有在发生与以前版本不兼容的更改时才真正使用降级（这些在我们的项目中很少见）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T03:07:28.857

为了尽可能接近领域驱动的设计方法，我在开发过程中使用 NHibernate 来构建我的模式。一旦应用程序达到一定程度的稳定性（域模型流失已大大减慢）或达到里程碑版本，我就会切换到 K. Scott Allen 在他的博客上讨论的方法。

[K. Scott Allen 关于数据库模式版本控制](http://odetocode.com/Blogs/scott/archive/2008/02/03/11746.aspx)的博客文章

Ash Tewari 已经实现了一个使用 NHibernate 的更改脚本管理系统，该系统基于 Allen 的博客文章。

Ash Tewari 的 [DbUpdater](http://www.tewari.info/dbupdater/)

# .net - .NET 安全性如何真正发挥作用？

> ID：354472
> 
> 赞同：1
> 
> 时间：2008-12-09T22:25:45.667
> 
> 标签：.net, security, file-permissions

我刚看到这个问题：

[了解 .NET 的“SecurityAction”权限参数](https://stackoverflow.com/questions/353968/understanding-nets-securityaction-parameter-for-permissions)

我有一个问题。使用以下代码：

```
private void button1_Click(object sender, EventArgs e)
{
    Layer1();
    MessageBox.Show("OK");
}

private void Layer1()
{
    try
    {
        Layer2();
    }
    catch (SecurityException)
    {
        MessageBox.Show("Caught");
    }
    Layer2b();
}

private void Layer2()
{
    new System.Security.Permissions.FileIOPermission(PermissionState.Unrestricted).Deny();
    GC.Collect();
    Layer3();
}

private void Layer2b()
{
    Layer3();
}

[FileIOPermission(SecurityAction.LinkDemand, Write=@"C:\temp")]
private void Layer3()
{
    using (FileStream stream = new FileStream(@"C:\temp\test.txt", FileMode.Create))
    {
    }
} 
```

为什么代码会在调用时产生安全异常`Layer2`？如何处理权限对象，我想垃圾收集器会销毁该对象，因为我没有对它的活动引用，但是代码说*Caught*，然后*OK*，所以很明显权限拒绝是有效的用于通过 Layer2 的呼叫。

是什么赋予了？我错过了什么？当谈到 .NET 中的安全/权限系统时，我承认自己是一个完全的初学者，所以如果这个问题真的很基本，请原谅我。

像这样的安全许可/拒绝会标记堆栈还是什么？否则，为什么对 Layer2b 无效？很明显，它是同一个线程，虽然它没有被垃圾收集杀死，但它在某个时候会被删除/销毁/清除。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T22:39:26.933

在 CodeAccessPermission 上调用 .Deny() 将导致 .NET 安全运行时在当前堆栈帧的安全对象上为该权限设置拒绝标志。因此，即使您在调用 .Deny() 之后调用 GC.Collect()，也没关系，权限将保持有效。权限对象只是 .NET 安全运行时部分在某个时间点（堆栈帧）的状态表示。

只需使用 .NET Reflector 即可了解更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T22:36:29.327

乍一看，我猜想权限对象仍然在范围内，因为它是在方法内部定义的，所以在 Layer2 方法完成后它就超出了范围，从而允许您的应用程序的最后一行运行。

正如接受的答案所指出的，这是因为它在当前堆栈的范围内，与标准对象范围相关，您只是不管理引用。这是最好的记忆方式

# javascript - jQuery UI：加载 HTML 标记的最佳方式？

> ID：354473
> 
> 赞同：2
> 
> 时间：2008-12-09T22:25:47.507
> 
> 标签：javascript, jquery, jquery-ui, jquery-ui-plugins

为自定义 jQuery UI 小部件加载 HTML 标记的最佳方式是什么？

到目前为止，我已经看到了使用字符串（即`$(...).wrap('<div></div>')`）简单地创建的元素，这对于简单的事情来说是很好的。但是，这使得以后对更复杂的元素进行修改变得极其困难。

这似乎是一个相当普遍的问题，但我也知道 jQuery UI 库足够新，因此可能没有广泛接受的解决方案。有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T22:49:44.760

这是一件非常整洁的事情：

```
var newDiv = $("<div></div>"); //Create a new element and save a reference
newDiv.attr("id","someid").appendTo("body"); 
```

这样，您正在创建一个元素，并将其引用存储在一个变量中，以供以后使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-21T22:45:22.777

如果您有大量复杂的 HTML，并且不想处理 JavaScript 代码中的硬编码字符串，您可以将其放在单独的 HTML 文件中并使用[Ajax 加载功能](http://docs.jquery.com/Ajax/load)。

它是可链接的，因此您可以加载 HTML 文件（整个文件或选定的片段），将其注入您当前的 DOM，然后继续前进。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-21T22:19:38.227

很多时候，对于非常复杂的模板，我只会将 html 块作为字符串存储在 JSON 对象中以供以后访问……例如：

```
var temp = {
  header : "<div class='foo'><h3>{HEADER}</h3></div>",
  content : "<div class='bar'><p>{COPY}</p></div>"
} 
```

然后在事情恢复时对那些进行一些替换。这样，标记与加载数据的逻辑有些分离，因此交换模板等可以更快一些。

```
var text = "I am the header text";
var head = new String(temp.header);
$(target).append(head.replace("{HEADER}",text)); 
```

无论如何，这种方法对我来说非常适用于 AJAX 小部件和类似的东西，设计可能会彻底改变。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-01-27T22:46:33.240

一种流行的、有效的方法是将所有附加标记（以后可能需要的）输出到页面底部的脚本标记中，这样浏览器就不会呈现标记。

```
<script type="text/template" id="template-example">
    <!-- All of your markup here -->
    <% // do some JavaScript in here... %>
    <%= echo_this_variable %>
</script> 
```

然后，您可以使用 jQuery 获取您的标记...

```
var markup = $('#template-example').html(); 
```

并使用模板引擎解析我投入其中的那些 JS 示例，例如[Underscore.js](http://underscorejs.org/#template)中的那个（我推荐），或者这个答案中的 jQuery 之一：[jQuery 模板引擎](https://stackoverflow.com/questions/170168/jquery-templating-engines)

玩得开心！

# html - HTML 到 Excel：如何告诉 Excel 将列视为数字？

> ID：354476
> 
> 赞同：20
> 
> 时间：2008-12-09T22:26:14.963
> 
> 标签：html, excel, formatting, numbers, formulas

在 Excel 中打开 HTML 时，我需要实现以下目标`(Response.contentType="application/vnd.ms-excel")`：

*   强制 Excel 将 td 单元格的内容视为数字
*   进行上述操作，以便任何后续用户输入的公式都适用于这些单元格（打开电子表格时）

到目前为止，我成功地添加`style="vnd.ms-excel.numberformat:0.00"`了有问题的 td 单元格。当我在 Excel 中右键单击它们时，单元格的内容正确显示为数字，但是公式不起作用。

如果成功，该技术将非常有用，因为用户可以根据自定义要求使用适当的公式对任何 Web Excel 报告进行增强。提前致谢。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-12-09T23:06:43.400

如果向页面添加 CSS 类：

```
.num {
  mso-number-format:General;
}
.date {
  mso-number-format:"Short Date";
} 
```

并在你的TD上打那些课程，它有效吗？

```
<td class="num">34</td>
<td class="num">17.0</td>
<td class="date">12/17/2008</td> <!-- if you are playing with dates too --> 
```

***更新：*** [@Aaron 的其他格式选项](http://cosicimiento.blogspot.com/2008/11/styling-excel-cells-with-mso-number.html)。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-07-22T15:34:24.113

以下是 Excel 格式列表：[使用 mso-number-format 设置 Excel 单元格样式](http://cosicimiento.blogspot.com/2008/11/styling-excel-cells-with-mso-number.html)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-09T23:04:21.517

最好的技巧是用你需要的所有颜色/（条件）格式/公式来模拟一个 Excel 电子表格。

保持尽可能简单，只是最少的行等。

然后将 Excel 电子表格保存为“作为 Xml 电子表格”

然后你有一个模板来通过 Xml 构建一个电子表格。

我通常会清理从 Excel 工作簿保存的原始 Xml 中的样式。删除重复项并重命名它们。

然后，只需使用您拥有的任何数据源进行填充即可。

我不知道您要编码的环境是什么，但是在带有 LINQ 和 Xml Literals 的 VB.NET 中，这是一项非常简单的任务。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-10-03T13:17:45.353

如果您使用 a 添加它，有时它不起作用，`css class`在这种情况下尝试使用 in`Style`到您的`TD`. 我这样做是为了将一列格式化为文本。像这样

```
 style="mso-number-format:\@;" 
```

对你来说，就像

```
 mso-number-format:General 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-07-22T03:45:27.653

我无法在 Excel 2010 中获得此页面上的任何答案。我最终使用了它。

```
<td x:num>123</td>
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-10T18:42:49.937

更新：您还需要从包含数字或货币信息的 td 单元格中删除不间断空格 (nbsp's)，以使公式在 Excel 中的这些单元格上工作。所以问题就解决了。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2020-08-09T05:39:54.880

```
mso-number-format:0         NO Decimals
mso-number-format:"\#\,\#\#0\.000" 3 Decimals 
mso-number-format:"mm\/dd\/yy" Thousand comma with 3 decimals  
mso-number-format:"mmmm\\ d\\\,\\ yyyy" Date7 
mso-number-format:"m\/d\/yy\\ h\:mm\\ AM\/PM" Date9 
```

文本栏

```
"<td style=\"mso-number-format:'\@'\">" 
```

或者

```
<td style="mso-number-format:'\@'"> 
```

# c# - 确定路径字符串是本地机器还是远程机器的方法

> ID：354477
> 
> 赞同：35
> 
> 时间：2008-12-09T22:26:20.237
> 
> 标签：c#, .net, uri, unc

使用 C# 或其他 .NET 语言确定文件路径字符串是在本地计算机上还是在远程服务器上的最佳方法是什么？

可以使用以下方法确定路径字符串是否为 UNC：

```
new Uri(path).IsUnc 
```

这对于以 C:\ 或其他驱动器号开头的路径非常有用，但路径如下：

```
\\machinename\sharename\directory
\\10.12.34.56\sharename\directory 
```

...两者都指本地计算机 - 这些是 UNC 路径，但仍然是本地的。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2010-12-13T18:45:55.637

我就是这样做的。

```
 public static bool IsLocal(DirectoryInfo dir)
    {
        foreach (DriveInfo d in DriveInfo.GetDrives())
        {
            if (string.Compare(dir.Root.FullName, d.Name, StringComparison.OrdinalIgnoreCase) == 0) //[drweb86] Fix for different case.
            {
                return (d.DriveType != DriveType.Network);
            }
        }
         throw new DriveNotFoundException();
    } 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-09T23:12:03.233

不知道是否有更有效的方法可以做到这一点，但它似乎对我有用：

```
 IPAddress[] host;
    IPAddress[] local;
    bool isLocal = false;

    host = Dns.GetHostAddresses(uri.Host);
    local = Dns.GetHostAddresses(Dns.GetHostName());

    foreach (IPAddress hostAddress in host)
    {
        if (IPAddress.IsLoopback(hostAddress))
        {
            isLocal = true;
            break;
        }
        else
        {
            foreach (IPAddress localAddress in local)
            {
                if (hostAddress.Equals(localAddress))
                {
                    isLocal = true;
                    break;
                }
            }

            if (isLocal)
            {
                break;
            }
        }
    } 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2011-09-01T09:18:23.670

.NET 3.5 版本的 Eric 的答案，额外检查主机是否存在：

```
 private bool IsLocalHost(string input)
    {
        IPAddress[] host;
        //get host addresses
        try { host = Dns.GetHostAddresses(input); }
        catch (Exception) { return false; }
        //get local adresses
        IPAddress[] local = Dns.GetHostAddresses(Dns.GetHostName()); 
        //check if local
        return host.Any(hostAddress => IPAddress.IsLoopback(hostAddress) || local.Contains(hostAddress));
    } 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2013-12-19T01:19:42.497

以下应该适用于映射驱动器和 UNC 路径。

```
private static bool IsLocalPath(String path)
{
    if (!PathIsUNC(path))
    {
        return !PathIsNetworkPath(path);
    }

    Uri uri = new Uri(path);
    return IsLocalHost(uri.Host); // Refer to David's answer
}

[DllImport("Shlwapi.dll")]
[return: MarshalAs(UnmanagedType.Bool)]
static extern bool PathIsNetworkPath(String pszPath);

[DllImport("Shlwapi.dll")]
[return: MarshalAs(UnmanagedType.Bool)]
static extern bool PathIsUNC(String pszPath); 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-02-19T16:08:11.943

以下是我解决类似需求的方法。

```
 internal static bool IsFileRemote(string path)
    {
            if (String.IsNullOrEmpty(path))
            {
                return false;
            }
            if (new Uri(path).IsUnc)
            {
                return true;
            }
            if (new DriveInfo(path).DriveType == DriveType.Network)
            {
                return true;
            }
            return false;
    } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T23:00:02.570

我不知道有一种方法可以检查。但是，您可以将 Uri 的`Host`属性与本地主机名或 IP 地址进行比较。

您可以使用以下方法获取本地机器名称：

```
string hostName = System.Net.Dns.GetHostName() 
```

然后，您可以通过将该字符串传递到以下位置来获取 IP 地址数组：

```
System.Net.IPAddress[] addresses = System.Net.Dns.GetHostAddresses(hostName); 
```

打开 Uri 的`HostNameType`属性，可能是`UriHostNameType.Dns`或`UriHostNameType.IPv4`，以匹配名称或 IP 地址。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-11-06T11:10:57.260

也许

```
var isLocal = Dns.GetHostName() == _host || Dns.GetHostEntry(Dns.GetHostName()).AddressList.Any(i => i.ToString().Equals(_host)); 
```

# multiple-monitors - 有没有办法将宽屏显示器分成两个或多个虚拟显示器？

> ID：354488
> 
> 赞同：68
> 
> 时间：2008-12-09T22:30:34.813
> 
> 标签：multiple-monitors

像大多数开发人员一样，我已经爱上了双显示器。我不会详述他们善良的所有原因；只是把它当作一个给定的。

然而，它们并不完美。您似乎永远无法将它们排列成“恰到好处”。你总是以轻微有趣的角度结束显示器。当然，挡板总是碍事。这是使用相同的显示器。使用不同的显示器时问题会更严重——VMWare 的多显示器功能甚至无法使用不同分辨率的显示器。

当您使用多个监视器时，其中一个将成为您的主要焦点监视器。您的注意力可能会从一台显示器转移到另一台显示器，但在任何时候，您通常只专注于一台显示器。这也有例外（WinDiff、Excel），但通常是这种情况。我建议拥有一个具有多个小型显示器所有优点的大型显示器将是一个更好的解决方案。

宽屏显示器很棒，但很难有效地利用所有空间。如果您正在编写代码，您通常在窗口的左侧工作。如果在宽屏显示器上最大化编辑器，窗口的右侧将是一片白色的海洋。WinSplit Revolution 之类的程序将有助于组织您的窗口，但这实际上只是解决症状，而不是问题。即使使用 WinSplit Revolution，当您最大化一个窗口时，它也会占据整个屏幕。您不能将窗口锁定到屏幕的特定部分。

这就是虚拟监视器的用武之地。

真正好的是位于现有驱动程序之上的视频驱动程序，但允许将单个监视器虚拟化为多个监视器。控制面板会将您的单个物理监视器视为两个或多个虚拟监视器。该软件甚至可以支持虚拟边框来强调正在发生的事情，或者您可以选择无缝模式。像 WinSplit Revolution 和 UltraMon 这样的程序仍然可以工作。这个虚拟视频驱动程序可以让您将您的物理显示器分割成任意数量的虚拟显示器。

有人知道这样的软件是否存在吗？如果没有，是否有任何崭露头角的 Windows 显示驱动程序大师愿意接受挑战？

我不追求无数可用的虚拟桌面/窗口管理器程序。我对这些程序感到沮丧。起初它们看起来不错，但它们通常有一些奇怪的行为，并且不能很好地与其他程序（例如 WinSplit Revolution）一起使用。

我要实物！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-09T22:47:53.110

[gridmove 能帮](http://jgpaiva.donationcoders.com/gridmove.html)上忙吗？

在大屏幕上非常方便的工具...

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T22:40:13.983

我将[WinSplit Revolution](http://www.winsplit-revolution.com/)用于键盘排列功能，并使用[bblean](http://bb4win.sourceforge.net/bblean/)作为 Explorer 的替代品。它内置了多个工作区功能，它允许您完全自定义它想要的外观。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T15:31:00.327

据我了解，您可以使用微软管理窗口。按住控制并在任务栏中选择多个窗口，然后右键单击它并以任何您想要的方式平铺。我一直在寻找的是一种将物理显示器实际分成两部分的方法。因此，您不仅可以运行窗口化程序（explorer、firefox 等），还可以运行全屏程序，例如游戏或电影或您想要的任何其他程序。这对于修复全屏程序中的错误非常有用。我厌倦了这些“windows mangagers”，只需单击并将其拖动到您想要的位置即可。我不是强迫症，因为它排列得恰到好处。我只想将显示器分成两部分。有这么难问吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-10T22:07:30.303

看来你想要一个窗口管理*器。*问题是找到一个有效的。

[我在 Linux ( dwm](http://www.suckless.org/dwm/) )中使用平铺窗口管理器，它似乎完全符合您的要求，而且它有多个工作区，这是我最初认为您想要的。

平铺窗口管理器没有“最大化”窗口的概念。所有窗口都占用了分配给它们的全部空间，并且它们从不重叠。当屏幕上只有一个窗口时，它会进入全屏状态。打开另一个窗口，它会在第一个窗口旁边打开，而第一个窗口会自动调整大小以仅占据屏幕的一部分。在 dwm 中，它们之间的分割可以通过击键进行调整。额外的窗口每个都占用屏幕上自己分配的空间，并且任何现有的窗口都会根据您选择的特定布局重新调整大小以适应它们。

工作区使用“标签”；任何窗口都可以有一个或多个标签，您可以选择一次查看具有一个或多个特定标签集的任何窗口。因此，您可以隐藏不想看到的窗口，让其他窗口占用更多空间。

不幸的是，我在 Windows 上尝试过的几个平铺插件也无法在任何地方使用。尽管 dwm 对某些使用 SDI 风格界面（如 Gimp 或 Pidgin）的应用程序有一些怪癖（您可以将窗口设置为平铺布局上方的“浮动”以解决此问题），但我从来没有对我的位置感到困惑就像我在 Windows 上尝试过的一些窗口管理器一样，窗口是或将窗口从屏幕上推开。如果有人知道在 Windows 上实际运行的具有等效功能的东西，我很想知道它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T15:42:39.473

我发现唯一存在的软件是 [Matrox PowerDesk](http://www.matrox.com/graphics/en/products/multi_display_software/powerdesk/)。除其他外，它还允许您将监视器拆分为 2 个虚拟桌面。你必须有一个兼容的matrox视频卡。它还具有许多其他多显示器功能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T22:36:40.153

只使用虚拟桌面怎么样？您可以将窗口分布在多个工作区中。像[Virtual Dimension](http://virt-dimension.sourceforge.net/)这样的东西应该可以为您提供大部分功能。我一直在 Linux 上使用虚拟桌面，它是多显示器的下一个最佳选择。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-12T10:54:09.853

现在，我正在使用[twinsplay 并排](http://www.twinsplay.com)组织我的窗口。

我之前尝试过 Winsplit，但我无法让它工作，因为默认热键（Ctrl-Alt-Left、Ctrl-Alt-Right）与用于旋转我的屏幕和设置不同热键的显卡热键发生冲突只是没有工作. Twinsplay 开箱即用。

twinsplay 的另一个好处是它还允许我保存和恢复 Windows“会话”——所以我可以在晚上关闭计算机之前保存我的工作环境（eclipse、total commands、visual studio、msdn、outlook、firefox）和然后在早上迅速回到它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-10T22:41:50.907

下一版本的 Windows (Windows 7) 将能够将窗口捕捉到屏幕的左半部分或右半部分。现在没有帮助，但这是值得期待的。

[http://arstechnica.com/news.ars/post/20081028-first-look-at-windows-7.html](http://arstechnica.com/news.ars/post/20081028-first-look-at-windows-7.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-07-02T19:36:12.353

可能还有其他潜在的解决方案（我仍在寻找），但到目前为止，在我寻找相同功能的过程中，我只找到了[http://www.maxivista.com/](http://www.maxivista.com/)。据我所知，它只支持双显示器，而不是多显示器。

# emacs - 防止自动更改默认目录

> ID：354490
> 
> 赞同：15
> 
> 时间：2008-12-09T22:31:15.890
> 
> 标签：emacs

根据[Emacs 文档](http://www.gnu.org/software/emacs/manual/html_node/emacs/File-Names.html)，每次打开文件时，Emacs 都会更改`default-directory`到包含该文件的目录。

然后，如果光标在该缓冲区中并且您（例如）启动了 SLIME，它将`default-directory`用作 SLIME 的当前工作目录。如果您尝试打开一个新文件，它会以`default-directory`您的起点打开该文件。

我希望能够`M-x cd`或以其他方式`cd`访问一个目录，然后永远不要让 Emacs 将我当前的工作目录更改为除该目录之外的任何内容，直到我另有说明。我希望这在所有缓冲区中都是全局的，因此每当我在做涉及当前工作目录的事情时，无论我的光标现在在哪里，我都知道它的设置。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-09T23:50:37.960

你可以尝试使用这样的东西：

```
(add-hook 'find-file-hook
          (lambda ()
            (setq default-directory command-line-default-directory))) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-17T21:59:03.923

另一种变体是将*默认目录*绑定到目录局部变量中的必要目录，例如在您的一个父目录中的 .dir-locals.el 文件中，绑定到以下内容：

```
((nil . ((default-directory . "~/.emacs.d/")))) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-18T18:55:48.720

这是迄今为止我想出的最好的，可悲的是：

```
(defun find-file-save-directory ()
    (interactive)
    (setq saved-default-directory default-directory)
    (ido-find-file)
    (setq default-directory saved-default-directory))
(global-set-key "\C-x\C-f" 'find-file-save-directory) 
```

只要`default-directory`在 I 之前正确设置，它就可以工作`C-x C-f`。我将接受 jurta 的回答，因为它为我指明了一个有用的方向。

# visual-studio-2008 - “代理类需要 WebServiceBindingAttribute”

> ID：354503
> 
> 赞同：13
> 
> 时间：2008-12-09T22:37:31.883
> 
> 标签：visual-studio-2008, web-services

我正在开发一个对 WebService 进行异步调用的应用程序。

我添加了一个代理类来进行异步调用。代码编译并正常运行，但是每当我尝试在解决方案资源管理器（Visual Studio 2008）中双击代理类时，我都会看到一个页面

为防止在加载设计器之前可能丢失数据，必须解决以下错误： 代理类需要 WebServiceBindingAttribute。

我的代理类已经这样定义了

```
namespace AsyncCaller
{
    [WebServiceBindingAttribute(Name = "AsyncRequestSoap", Namespace = "http://tempuri.org/")]
    public class AsyncCallerProxy : SoapHttpClientProtocol
    {
        public AsyncCallerProxy()
        {
            this.Url = "http://localhost/MyAsyncService/AsyncService.asmx";
        } 
```

所以我看不到错误的原因。

这是一个非常小的问题，因为我仍然可以运行该应用程序，但我很好奇。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-10T18:46:17.407

同样的问题..
只需使用以下属性装饰您的代理类

[System.ComponentModel.DesignerCategoryAttribute("code")]

摆脱无用的设计模式。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2011-12-07T17:42:37.283

在项目的属性中。在构建选项卡中。选择“生成序列化程序集：”以关闭。

# unix - 如何区分具有完整上下文的两个文件？

> ID：354526
> 
> 赞同：33
> 
> 时间：2008-12-09T22:45:39.980
> 
> 标签：unix, command-line, diff

我有两个文件略有不同。一个正常`diff`的会告诉我文件之间的差异。使用`-c`或`-u`我可以为每个大块添加一定量的上下文。我可以传递哪些选项`diff`来查看更改旁边的每条未更改的行，并将差异作为一个单一的大块来获取？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-09T23:14:13.040

您还可以覆盖差异格式化行为以获得所需的行为，而无需使用并排模式：

```
diff --new-line-format='+%L' --old-line-format='-%L' --unchanged-line-format=' %L' file1 file2 
```

此命令会将完整文件显示为上下文，并且格式最接近`diff -u file1 file2`

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-12-09T22:58:03.823

使用“-y”选项进行完整的并排输出

差异 -y 文件 1 文件 2

会给你输出类似

```
* Lorem ipsum dolor sit amet, consectetuer adipiscing elit.     * Lorem ipsum dolor sit amet, consectetuer adipiscing elit.
* Praesent fringilla facilisis pede.                            * Praesent fringilla facilisis pede.
* Nulla sit amet tellus id massa luctus pellentesque.           * Nulla sit amet tellus id massa luctus pellentesque.
* Pellentesque a neque nec elit aliquam congue.                 * Pellentesque a neque nec elit aliquam congue.
* Quisque rhoncus ultricies elit.                               * Quisque rhoncus ultricies elit.
* Pellentesque laoreet urna id arcu.                            * Pellentesque laoreet urna id arcu.
* Aenean non erat et elit egestas dictum.                       * Aenean non erat et elit egestas dictum.
* Proin ornare sem eget nulla.                                  * Proin ornare sem eget nulla.
* Phasellus placerat convallis elit.                            * Phasellus placerat convallis elit.
* Donec ultricies metus non purus.                              * Donec ultricies metus non purus.
* Sed vel enim et nunc accumsan egestas.                        * Sed vel enim et nunc accumsan egestas.
* Cras eget elit in purus luctus ornare.                        * Cras eget elit in purus luctus ornare.
* In pharetra ligula sodales pede.                            <
* Morbi consectetuer mi vitae sem.                              * Morbi consectetuer mi vitae sem.
* Donec sollicitudin pretium erat.                              * Donec sollicitudin pretium erat.
* Cras facilisis nunc sed leo.                                  * Cras facilisis nunc sed leo.
* Nunc varius ante sed nisi.                                    * Nunc varius ante sed nisi.
                                                              > THIS SHOULDN'T BE HERE
                                                              > THIS SHOULDN'T EITHER!
* Aenean in quam sagittis est ornare ultricies.                 * Aenean in quam sagittis est ornare ultricies.
* Etiam dignissim scelerisque velit.                            * Etiam dignissim scelerisque velit.
* Mauris porta fringilla sapien.                                * Mauris porta fringilla sapien.
* Proin vitae nisl vitae mauris viverra tempor.                 * Proin vitae nisl vitae mauris viverra tempor.
* Maecenas quis arcu sed lorem mollis bibendum.                 * Maecenas quis arcu sed lorem mollis bibendum.
* Morbi sed turpis non risus molestie posuere.                | * Morbi sed non risus molestie posuere.
* Curabitur id magna in nulla commodo tristique.                * Curabitur id magna in nulla commodo tristique.
* Praesent quis nulla vel augue faucibus viverra.             | * Praesent quis nulla BAD vel augue faucibus viverra.
* Sed interdum libero.                                        | * Sed lacinia interdum libero.
                                                              > ANOTHER ADDITION
* Donec ultricies posuere arcu.                                 * Donec ultricies posuere arcu.
* Etiam interdum auctor mi.                                     * Etiam interdum auctor mi. 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2017-11-29T06:55:58.503

解决方案是设置一个大于文件本身的上下文大小（-U 参数）：

```
diff -U 1000000 file1.txt file2.txt 
```

# .net - 敏捷开发和 ESB

> ID：354539
> 
> 赞同：1
> 
> 时间：2008-12-09T22:51:06.753
> 
> 标签：.net, ruby-on-rails, business-logic, esb, middleware

我正在努力将我们的企业技术范式转变为敏捷开发。这是一个艰难的过程，但我们快到了！:)

我们有用于数据库管理的遗留系统（以前是 Access，现在移植到 .NET 和 MS SQL），我们正在为我们的未来愿景开发一个框架。我们希望尽可能多地迁移到网络。但我们希望将当前系统与“即将推出”的系统集成。我们不会重叠任务和功能。

我的愿景是将我们用户的所有联系信息移动到不同的数据库，将这些“配置文件”链接回 MS SQL 以获取他们的历史和会计信息。我们会将所有会计系统保留在桌面应用程序上，但我们将添加更多功能，这些功能将严重依赖于 Web，尤其是 Ruby on Rails。

我想问题是：为什么是 ESB？有没有一种方法可以创建 SOA，而无需对复杂的 ESB 系统进行狂热的操作。无论如何，整个想法是亲吻。是否可以以允许桌面/Web/移动作为接口的方式创建 SOA，将功能保留在业务逻辑上（当然，某些功能必须在接口上实现，但要保持在最低限度）。ESB 甚至符合敏捷哲学吗？我阅读和研究它们的次数越多，我就越不这么认为！：/

感谢您的输入！如果您需要我澄清，请提出几个问题，我会尽力做到这一点！:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-09T23:24:49.150

一旦框架/基础设施到位，ESB 就非常适合敏捷。你会发现可以分块创建新系统，新的部分和旧的系统并行运行一段时间，然后逐渐关闭系统的旧部分，直到只剩下新的系统，没有人会永远知道区别

一个基本的 SOA 只定义服务而不是应用程序；ESB 管理通道中的服务以隐藏端点，使升级和替换更加“敏捷”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T10:40:16.823

我很快就学会了回避“ESB”这个词，因为它非常过载并且对不同的人意味着不同的东西（有时对同一个人来说不同的东西:-)）

当然，关键是问问自己你真正需要什么。

将您的数据库包装为服务可能是一个明智的选择，尤其是如果您有多个客户端来处理这些数据；您将不得不花费大量时间来考虑您的合同和范围，但敏捷可以在这里提供很大帮助。

现在的问题是如何调用这些服务，我认为您需要权衡客户端和服务更改的可能性以及您的系统将如何发展。

服务总线有助于从其客户端（可以是其他服务）屏蔽服务，并且这种“屏蔽”可以中继到位置、协议、格式、代码等。某些形式的服务总线还可以维护行程（需要打电话，什么时候），但我通常不喜欢这个主意。

所以-我认为，您首先需要问自己的问题是您需要从什么开始以及您希望进行多少前期投资（并且可以证明是合理的）

例如，如果最初您对更点对点的方法感到满意，您的客户可以直接调用该服务；在稍后阶段，随着服务的发展，您可以引入“中间人”来代理请求和响应（是的 - 如果您愿意，您可以将其称为 ESB）。

或者，您可以从一个基本的“中间人”开始，这样客户就不会直接调用服务，而只是拥有您需要的功能，并以需求形式扩展它的功能；它很可能从一个简单的转发机器开始。

理想情况下，您将构建在具有许多内置功能的产品之上；如果您在 MS 堆栈上，BizTalk Server 是一个很好的匹配（但有它的学习曲线）

所以 - 如果这不是一个非常具体的答案，请道歉 - 但我想我的主要观点是“ESB”不一定是矫枉过正，它只是归结为你希望在第一天拥有的东西，以及敏捷（和 SOA ) 绝对有帮助，因为它允许你逐渐进化，而不是像大爆炸一样。

（如果以上任何内容完全是胡说八道，或者只是有点不清楚，那是因为家里有一个新出生的孩子睡眠不足！道歉:-)）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T23:41:01.817

整个迁移是让我接触到 ESB 的原因……但是 ESB 的整个想法似乎很复杂，无法解决涉及大约 30,000 个配置文件的问题！我们正处于指数​​级增长的边缘（达到几百万个配置文件），也许开始一条新的道路是最好的。将位于 MySQL DB 上的条目链接到存储在 MS SQL DB 上的数据有多容易？我显然不想要复式输入，但是可能有比“整个” ESB 更敏捷的方式......我确实理解带有 ESB 的 SOA 在升级和替换方面可能非常敏捷，但它会是吗？矫枉过正？:)

# ruby - How do I dump an object's fields to the console?

> ID：354547
> 
> 赞同：298
> 
> 时间：2008-12-09T22:55:24.420
> 
> 标签：ruby, printf-debugging

When I'm running a simple Ruby script, what's the easiest way to dump an object's fields to the console?

I'm looking for something similar to PHP's `print_r()` that will work with arrays as well.

* * *

## 回答 #1

> 赞同：462
> 
> 时间：2008-12-09T23:08:27.030

Possibly:

```
puts variable.inspect 
```

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2008-12-09T23:33:06.140

You might find a use for the `methods` method which returns an array of methods for an object. It's not the same as `print_r`, but still useful at times.

```
>> "Hello".methods.sort
=> ["%", "*", "+", "<", "<<", "<=", "<=>", "==", "===", "=~", ">", ">=", "[]", "[]=", "__id__", "__send__", "all?", "any?", "between?", "capitalize", "capitalize!", "casecmp", "center", "chomp", "chomp!", "chop", "chop!", "class", "clone", "collect", "concat", "count", "crypt", "delete", "delete!", "detect", "display", "downcase", "downcase!", "dump", "dup", "each", "each_byte", "each_line", "each_with_index", "empty?", "entries", "eql?", "equal?", "extend", "find", "find_all", "freeze", "frozen?", "grep", "gsub", "gsub!", "hash", "hex", "id", "include?", "index", "inject", "insert", "inspect", "instance_eval", "instance_of?", "instance_variable_defined?", "instance_variable_get", "instance_variable_set", "instance_variables", "intern", "is_a?", "is_binary_data?", "is_complex_yaml?", "kind_of?", "length", "ljust", "lstrip", "lstrip!", "map", "match", "max", "member?", "method", "methods", "min", "next", "next!", "nil?", "object_id", "oct", "partition", "private_methods", "protected_methods", "public_methods", "reject", "replace", "respond_to?", "reverse", "reverse!", "rindex", "rjust", "rstrip", "rstrip!", "scan", "select", "send", "singleton_methods", "size", "slice", "slice!", "sort", "sort_by", "split", "squeeze", "squeeze!", "strip", "strip!", "sub", "sub!", "succ", "succ!", "sum", "swapcase", "swapcase!", "taguri", "taguri=", "taint", "tainted?", "to_a", "to_f", "to_i", "to_s", "to_str", "to_sym", "to_yaml", "to_yaml_properties", "to_yaml_style", "tr", "tr!", "tr_s", "tr_s!", "type", "unpack", "untaint", "upcase", "upcase!", "upto", "zip"] 
```

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2009-10-06T23:54:29.557

The `to_yaml` method seems to be useful sometimes:

```
$foo = {:name => "Clem", :age => 43}

puts $foo.to_yaml 
```

returns

```
--- 
:age: 43
:name: Clem 
```

(Does this depend on some `YAML` module being loaded? Or would that typically be available?)

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2008-12-10T03:34:19.567

```
p object 
```

[Ruby doc for `p`.](http://www.ruby-doc.org/core/Kernel.html#method-i-p)

> [`p(*args) public`](http://apidock.com/ruby/Kernel/p)
> 
> For each object, directly writes obj.inspect followed by a newline to the program’s standard output.

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2013-01-14T15:23:24.493

If you're looking for just the instance variables in the object, this might be useful:

```
obj.instance_variables.each do |var|
  puts [var, obj.instance_variable_get(var).inspect].join(":")
end 
```

or as a one-liner for copy and pasting:

```
obj.instance_variables.each{ |var| puts [var, obj.instance_variable_get(var).inspect].join(":")} 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2010-08-20T09:55:49.170

puts foo.to_json

might come in handy since the json module is loaded by default

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2016-11-17T08:26:35.447

If you want to print an already **indented JSON**:

```
require 'json'
...
puts JSON.pretty_generate(JSON.parse(object.to_json)) 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2017-07-21T13:53:05.997

I came across this thread because I was looking for something similar. I like the responses and they gave me some ideas so I tested the .to_hash method and worked really well for the use case too. soo:

`object.to_hash`

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-06-03T21:56:41.547

```
object.attribute_names

# => ["id", "name", "email", "created_at", "updated_at", "password_digest", "remember_token", "admin", "marketing_permissions", "terms_and_conditions", "disable", "black_list", "zero_cost", "password_reset_token", "password_reset_sent_at"]

object.attributes.values

# => [1, "tom", "tom@tom.com", Tue, 02 Jun 2015 00:16:03 UTC +00:00, Tue, 02 Jun 2015 00:22:35 UTC +00:00, "$2a$10$gUTr3lpHzXvCDhVvizo8Gu/MxiTrazOWmOQqJXMW8gFLvwDftF9Lm", "2dd1829c9fb3af2a36a970acda0efe5c1d471199", true, nil, nil, nil, nil, nil, nil, nil] 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-04-21T03:38:53.553

pp File.stat('/tmp')

```
#<File::Stat
 dev=0x1000004,
 ino=71426291,
 mode=041777 (directory rwxrwxrwt),
 nlink=15,
 uid=0 (root),
 gid=0 (wheel),
 rdev=0x0 (0, 0),
 size=480,
 blksize=4096,
 blocks=0,
 atime=2021-04-20 17:50:33.062419819 +0800 (1618912233),
 mtime=2021-04-21 11:35:32.808546288 +0800 (1618976132),
 ctime=2021-04-21 11:35:32.808546288 +0800 (1618976132)> 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-06-25T06:02:32.193

I'm using own solution to print and debug variables is [https://github.com/igorkasyanchuk/wrapped_print](https://github.com/igorkasyanchuk/wrapped_print)

you can simply call `user.wp` to see in the logs a value of this variable

instead of:

```
puts "-"*10
puts user.inspect
puts "-"*10 
```

# language-agnostic - 如何触发一个功能一次，而且只有一次......？

> ID：354556
> 
> 赞同：6
> 
> 时间：2008-12-09T22:59:23.197
> 
> 标签：language-agnostic, loops, boolean

我经常只想触发某个函数一次，但我需要从另一个重复调用的函数中触发它。例如，拍摄某物的快照以备后用。我通常通过设置一个全局布尔值来做到这一点。

我想知道我这样做的方式是否实际上是最好的方式？

我似乎记得读过全局变量不好，全局布尔变量更糟！

无论如何，这就是我通常只完成一次触发某个方法的方式：

在我最初的一组变量中......

```
private var myStatus:Boolean = false; 
```

然后，在经常调用的函数中......

```
if (!myStatus) {
    doMyFunction();
    myStatus = true;
} 
```

对我来说这似乎很合乎逻辑，但这是*正确的*吗？

**更新**：好吧，根据我从您的答案中学到的知识，我现在不是检查全局布尔变量，而是首先检查 XML 节点是否存在（在写入磁盘之前，我将图像存储在 XML 结构中），并且，如果不是，那么我将使用 base64 编码的图像数据附加一个新节点。我仍然设置了一个布尔标志，以便稍后我可以在需要时用用户编辑的图像数据覆盖空白图像。它完美地工作。感谢大家的帮助！

我现在也对在某些情况下使用该特定（线程不安全）系统感到更自在。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-09T23:17:57.307

当你调用一个函数时，它应该做你期望它对你给它的参数做的事情。如果你以完全相同的方式调用一个函数两次，你应该期望该函数给你相同的结果或做同样的事情。

将这种调用一次的依赖项移至多次调用您的函数的逻辑可能会更好。如果您只需要调用一次该函数，则只需调用一次。或者，将不同的参数传递给函数以表明您正在做不同的事情。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-09T23:06:15.867

这真的取决于你的意思。如果您的代码将从多个线程中调用，那么您就有一个竞争条件，这可能意味着它`doMyFunction`可能被多次调用。这是因为不止一个线程可以检查`myStatus`，看到它是假的，然后调用`doMyFunction`。您可以通过首先设置变量来稍微改善这种情况：

```
if (!myStatus) {
    myStatus = true;
    doMyFunction();
} 
```

但这只会缩小问题的窗口，并不能消除它。

要消除竞争条件，您需要一个锁。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-09T23:09:57.760

在 C/C++ 中，您通常可以保留这样一个事实，即 doMyFunction() 仅通过使用静态变量封装一次，如下所示：

```
void doMyFunction() {
     // gets called only once.
     // side effects go here.
}

void functionThatGetsCalledALot() {
    static bool called = false;
    if (!called) {
        doMyFunction();
        called = true;
    }
    // do more stuff
} 
```

这避免了使用全局变量，但具有相同的效果，并且静态变量在其相关的地方被声明，所以很清楚发生了什么。请注意，这不是线程安全的，因此如果您有线程，则需要一个锁。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-09T23:09:41.507

它不是线程安全的。这对您来说可能无关紧要，但您确实说过“与语言无关”：您可能不想在 Java 的通用库中使用这种模式。

这是一个很难以与语言无关的方式回答的问题，因为可用的替代方案在很大程度上取决于语言。例如，在 POSIX 上，如果您需要线程安全，您可以使用 pthread_once。在 C 中，您有静态局部变量来将该布尔值排除在全局范围之外。在任何 OO 语言中，如果您正在拍摄“某物”的快照以供以后使用，那么可能有一个与“某物”（或快照）相对应的合适对象，它可以存储标志。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T23:02:28.493

我认为您的方法没有任何问题。请记住，并不总是“正确”的事情......肯定有错误的事情，但正确的事情可能是主观的，也可能取决于系统的要求。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T23:06:13.527

我没有看到任何其他方式。关于如何改进这一点，唯一想到的是 - 线程安全。但这仅在您有多个线程调用该函数时才需要。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-10T20:01:27.937

在 Perl 5.10 或更高版本中，您将使用`state`变量。

```
use 5.010;

sub test{
  state $once = 1;

  if( $once ){
    $once = undef;
    say 'first';
  } else {
    say 'not first';
  }
}

test for 1..5; 
```

输出

```
第一的
不是第一
不是第一
不是第一
不是第一

```

# groovy - Groovlet + Tomcat：导入库时“无法解析类”

> ID：354559
> 
> 赞同：2
> 
> 时间：2008-12-09T23:00:31.040
> 
> 标签：groovy, groovlet

我在导入库类的 tomcat 中运行 groovy servlet (groovlet) 时遇到了一些麻烦。当我不导入任何东西时，groovlet 可以正常工作，但是如果我确实导入了我希望在类路径上的东西（我可以在常规 servlet 中成功导入同一个类），我会看到以下错误：

```
groovy.util.ScriptException: Could not parse scriptName: /MyGroovlet.groovy
java.lang.RuntimeException: groovy.util.ScriptException: Could not parse scriptName: /MyGroovlet.groovy
    at groovy.servlet.GroovyServlet$1.call(GroovyServlet.java:123)
...
Caused by: org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed, /MyGroovlet.groovy: 1: unable to resolve class com.mycompany.mypackage.MyLibraryClass
 @ line 1, column 1. 
```

`MyLibraryClass`包含is in的 jar`shared/lib`由 tomcat 通过以下 in 加载`catalina.properties`：

```
shared.loader=...,${catalina.base}/shared/lib/*.jar,... 
```

我的 groovlet 是按照我的应用程序的[用户指南](http://groovy.codehaus.org/Groovlets)中的描述进行映射的`web.xml`：

```
<servlet>
    <servlet-name>GroovyServlet</servlet-name>
    <servlet-class>groovy.servlet.GroovyServlet</servlet-class>
</servlet>
<servlet-mapping>
    <servlet-name>GroovyServlet</servlet-name>
    <url-pattern>*.groovy</url-pattern>
</servlet-mapping> 
```

这是 groovlet 的代码`MyGroovlet.groovy`：

```
import com.mycompany.mypackage.MyLibraryClass
MyLibraryClass.someStaticMethod() 
```

`WEB-INF/groovy/MyGroovlet.groovy`根据[GroovyServlet API](http://groovy.codehaus.org/api/groovy/servlet/GroovyServlet.html) ，我的 groovlet 被部署到。

当我访问 时`http://localhost:8080/myapplication/MyGroovlet.groovy`，前面描述的错误会写入我的应用程序日志。

有什么方法需要我显式声明 GroovyServlet 的运行时类路径？我尝试将库 jar 移动到几个地方，包括`WEB-INF/lib`并将实际`MyLibraryClass.class`文件移动到`WEB-INF/classes`，但没有运气。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-25T01:50:19.143

我正在为 Eclipse 使用 Groovy 插件。在 war 文件中导出 Groovlets 也可以。

当我导出基于 Groovlet 的应用程序时，这个有用的插件会将 .groovy 文件放入 /WEB-INF/classes 目录（在类路径中）。当我在我的 Tomcat 服务器中部署战争文件时它可以工作。

希望这会有所帮助。

问候。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-30T05:34:09.033

我犯的一个愚蠢的错误是，我需要在加载我复制到 WEB-INF/lib 的 jar 之前重新加载 webapp（即重新启动整个 Tomcat 服务器，或者只从 Tomcat 管理器重新加载特定的应用程序）。在 Tomcat/webapps/ 目录中动态编辑 .groovy 文件并看到页面的更新立即让我觉得一切都会自动加载，但对于 jars 则不然。直到我意识到发生了什么事，这才令人抓狂。

# javascript - 什么是 Javascript 语言文件的好的 Delphi 词法分析器/解析器？

> ID：354563
> 
> 赞同：5
> 
> 时间：2008-12-09T23:01:09.073
> 
> 标签：javascript, delphi, parsing, lexer

*背景*

我希望能够在 Delphi 应用程序中解析 Javascript 源代码。我需要能够识别源代码中的变量和函数，以便通过以后的代码对代码进行更改。我知道我可能需要为此目的使用词法分析器，但使用我找到的词法分析器（[Dyaclexx](http://www.grendelproject.nl/dyacclex/)）运气不佳。

*问题*

是否有合适的免费软件或开源 delphi 解析器/词法分析器已经具有 Javascript 的令牌集，或者可以轻松地为此目的进行修改而没有太多麻烦？

如果没有这样的工具可用，那么学习为此目的编写自己的词法分析器的最佳方法是什么？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-10T06:16:01.317

对于词法分析器，您可以查看[Synedit 的](http://synedit.sourceforge.net/)Javascript 荧光笔源代码。Synedit 上下文中的荧光笔是一个带有特殊钩子的词法分析器，用于为编辑器组件提供高亮显示。修剪这些钩子并获得一个简单的词法分析器是一项微不足道的工作。

在学习如何构建词法分析器时，Synedit 编辑器也可以派上用场，因为它有助于实时直观地测试你的词法分析器。您可以查看演示或在邮件列表中询问更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-11T11:42:56.710

我认为您应该使用 GoldParser ( [http://www.devincook.com/goldparser](http://www.devincook.com/goldparser) ) 在 Delphi 代码中生成完整的 JS 解析器。GoldParser 虽然是免费软件。

# c# - 从 DataTable 写入时如何指定 XML 输出的格式？

> ID：354568
> 
> 赞同：3
> 
> 时间：2008-12-09T23:03:19.897
> 
> 标签：c#, ado.net, xsd

在 C# 中，我使用 dataTable.WriteXml(filePath) 从 DataTable 创建 XML 文件，并获得以下信息：

```
<?xml version="1.0" encoding="utf-8" ?>
<ExperienceProfiles>
  <ExperienceProfile>
    <Col1>blah</Col1>
    <Col2>4ed397bf-a4d5-4ace-9d44-8c1a5cdb0f34</Col2>
  </ExperienceProfile>
</ExperienceProfiles> 
```

我怎样才能让它以以下格式编写 XML？：

```
<?xml version="1.0" encoding="utf-8" ?>
<ExperienceProfiles>
  <ExperienceProfile Col1="blah"
    Col2="blah" ></ExperienceProfile>
</ExperienceProfiles> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T23:30:16.037

您想要的是某种方式告诉 DataSet 您的数据的预期格式。您很幸运，DataSet 仅支持此功能。

在写出 XML 之前，您需要为您的数据创建一个 XML 模式并将其加载到 DataSet 中。在模式中将 Col1 和 Col2 定义为 ExperienceProfile 元素的属性，DataSet 将知道格式化输出文档以满足模式中指定的要求。

如果您对创建模式不满意，可以按照您希望的格式创建 XML 文件的示例，然后查看框架中的 XmlSchemaInference 类。此类可用于自动生成架构，您可能需要稍微调整输出，但如果您不熟悉 XSD，它会有所帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-09-22T08:59:25.967

您可以使用数据表列的 ColumnMapping 功能。.

```
column.ColumnMapping = MappingType.Attribute 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T23:18:39.273

> 简短的回答：你不能，使用 DataTable 的 WriteXml 方法。
> 
> 长答案（不是很长）：自己动手。

如上所述撤回我的答案:)

# delphi - 使用 Rad Studio 2007 在 vcl.net 应用程序中读取代理详细信息

> ID：354586
> 
> 赞同：3
> 
> 时间：2008-12-09T23:12:17.210
> 
> 标签：delphi, proxy, delphi-2007

如何从 vcl.net 应用程序（Rad Studio 2007）读取代理详细信息（地址和端口）？听说过 InternetGetProxyInfo。但是在任何地方都没有找到详细信息。

谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-06T21:57:13.993

只是提供一个想法。我从来没有找到其他方法:(

```
procedure TfrmProxy.sbtnGetIEProxyClick(Sender: TObject);

  function GetHTTPProxy(const str: String): String;
  var
    ts: TStringList;
    i: Integer;
  begin
    ts := TStringList.Create;
    try
      ts.Text := StringReplace(str, ';', #13#10, [rfReplaceAll]);
      if ts.Count = 1 then
        Result := ts[0]
      else
      begin
        for i := 0 to ts.Count-1 do
        begin
          if pos(UpperCase('http'), uppercase(ts[i])) > 0 then
          begin
            Result := Copy(ts[i], 6, length(ts[i]));
            Exit;
          end;
        end;
      end;
    finally
      ts.Free;
    end;
  end;

var
  Reg: TRegistry;
  str: String;
begin
  Reg := TRegistry.Create;
  try
    Reg.RootKey := HKEY_CURRENT_USER;
    if Reg.KeyExists('Software\Microsoft\Windows\CurrentVersion\Internet Settings') then
    begin
      Reg.OpenKeyReadOnly('Software\Microsoft\Windows\CurrentVersion\Internet Settings');
      chxUseProxy.Checked := Reg.ReadInteger('ProxyEnable') <> 0;
      if chxUseProxy.Checked then
      begin
        str := Reg.ReadString('ProxyServer');
        str := GetHTTPProxy(str);
        ledtProxyHost.Text := Copy(str, 0, pos(':', str)-1);
        ledtProxyPort.Text := Copy(str, pos(':', str)+1, length(str));
      end;
      Reg.CloseKey;
    end;
  finally
    Reg.Free;
  end;
end; 
```

# c# - 优化字符串连接的聚合

> ID：354587
> 
> 赞同：19
> 
> 时间：2008-12-09T23:12:48.630
> 
> 标签：c#, optimization, linq-to-objects

**更新**- 对于那些有幽默感的人，您可以假设 Aggregate 仍然会产生正常结果，无论传递给它的函数是什么，包括在被优化的情况下。

我编写了这个程序来构建一长串从 0 到 19999 的整数，用逗号分隔。

```
using System;
using System.Linq;
using System.Diagnostics;

namespace ConsoleApplication5
{
    class Program
    {
        static void Main(string[] args)
        {
            const int size = 20000;

            Stopwatch stopwatch = new Stopwatch();

            stopwatch.Start();
            Enumerable.Range(0, size).Select(n => n.ToString()).Aggregate((a, b) => a + ", " + b);
            stopwatch.Stop();

            Console.WriteLine(stopwatch.ElapsedMilliseconds + "ms");
        }
    }
} 
```

当我运行它时，它说：

```
5116ms 
```

超过五秒，太可怕了。当然这是因为每次循环都会复制整个字符串。

但是，如果做出评论中指出的一个非常小的改变呢？

```
using System;
using System.Linq;
using System.Diagnostics;

namespace ConsoleApplication5
{
    using MakeAggregateGoFaster;  // <---- inserted this

    class Program
    {
        static void Main(string[] args)
        {
            const int size = 20000;

            Stopwatch stopwatch = new Stopwatch();

            stopwatch.Start();
            Enumerable.Range(0, size).Select(n => n.ToString()).Aggregate((a, b) => a + ", " + b);
            stopwatch.Stop();

            Console.WriteLine(stopwatch.ElapsedMilliseconds + "ms");
        }
    }
} 
```

现在当我运行它时，它说：

```
42ms 
```

速度提高 100 倍以上。

### 问题

MakeAggregateGoFaster 命名空间中有什么？

**更新 2：** [在这里写下我的答案](http://incrediblejourneysintotheknown.blogspot.com/2008/12/optimizing-aggregate-for-string.html)。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-01-14T17:18:03.437

为什么不使用其他形式的聚合之一？

```
Enumerable.Range(0, size ).Aggregate(new StringBuilder(),
        (a, b) => a.Append(", " + b.ToString()),
        (a) => a.Remove(0,2).ToString()); 
```

您可以为种子指定任何类型，在第一个 lambda 函数中执行所需的任何格式或自定义调用，然后在第二个 lambda 函数中自定义输出类型。内置功能已经提供了您需要的灵活性。我的跑步从 1444 毫秒到 6 毫秒。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-09T23:30:24.210

您正在使用命名空间 MakeAggregateGoFaster 中自己的扩展方法“覆盖” System.Linq.Aggregate。

也许专门研究`IEnumerable<string>`和使用 StringBuilder？

也许用 a`Expression<Func<string, string, string>>`而不是 a`Func<string, string, string>`这样它就可以分析表达式树并编译一些使用 StringBuilder 而不是直接调用函数的代码？

只是猜测。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-09T23:16:41.100

没有回答问题，但我认为这里的标准模式是使用 StringBuilder 或 string.Join：

```
string.Join(", ",Enumerable.Range(0, size).Select(n => n.ToString()).ToArray()) 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-09T23:35:02.360

我问它是否是一个谜题的原因是因为一个谜题可以在不同程度上牺牲稳健性，只要它满足所述问题的字母。考虑到这一点，这里是：

解决方案 1（立即运行，问题未验证）：

```
public static string Aggregate(this IEnumerable<string> l, Func<string, string, string> f) {
     return "";
} 
```

解决方案 2（运行速度与问题所需的速度差不多，但完全忽略了委托）：

```
public static string Aggregate(this IEnumerable<string> l, Func<string, string, string> f) {
    StringBuilder sb = new StringBuilder();
    foreach (string item in l)
        sb.Append(", ").Append(item);
    return sb.Remove(0,2).ToString();
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-09T23:15:35.487

好吧，这将完全取决于 MageAggregateGoFaster 命名空间中的代码，不是吗？

此命名空间不是 .NET 运行时的一部分，因此您已经链接了一些自定义代码。

就我个人而言，我认为识别字符串连接或类似的东西，并建立一个列表或类似的东西，然后分配一个大的 StringBuilder 并使用 Append。

一个肮脏的解决方案是：

```
namespace MakeAggregateGoFaster
{
    public static class Extensions
    {
        public static String Aggregate(this IEnumerable<String> source, Func<String, String, String> fn)
        {
            StringBuilder sb = new StringBuilder();
            foreach (String s in source)
            {
                if (sb.Length > 0)
                    sb.Append(", ");
                sb.Append(s);
            }

            return sb.ToString();
        }
    }
} 
```

很脏，因为这段代码在执行您所说的程序体验时，根本不使用函数委托。但是，它将在我的计算机上将执行时间从大约 2800 毫秒降低到 11 毫秒，并且仍然产生相同的结果。

现在，下一次，也许你应该问一个真正的问题，而不是仅仅*看我是多么聪明*的胸膛？

# find - 如何在 cvs 中查找一个人的所有提交（文件和评论）

> ID：354599
> 
> 赞同：19
> 
> 时间：2008-12-09T23:17:56.683
> 
> 标签：find, cvs

希望在 cvs 中获取用户的所有文件列表（提交评论也不错）。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-15T09:42:40.367

使用以下命令列出特定用户的所有提交：

```
cvs -q log -N -S -wuser dir/ 
```

`-N`不要列出标签。
`-S`如果没有选择修订，则不要打印名称/标题。
`-w[logins]`仅列出由指定登录名签入的修订。

小心！开关的顺序很重要。

如需更多选项和帮助，请使用：

```
cvs -H log 
```

（上面的开关列表取自该命令的输出）。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-09T23:28:48.737

```
cvs log -t -wJellyJoe 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-04-30T09:06:22.340

```
cvs history -u user -c -D 2009-01-20
cvs history -u user -l -c -D 2009-01-20 
```

第一行查看用户自指定日期以来的所有更改 第二行仅列出最后一次更改，因此您只能获取每个文件一次，即使它已更改多次。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-23T20:08:26.090

```
cvs history -a -c  -D 2009-01-20 
```

审查自 2009-01-20 以来所有用户的所有提交

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-09T23:31:05.410

这是一个快速的 oneliner，它将为您提供每个文件的列表，然后是该用户的更改以及该用户的第一行评论。

```
cvs log | egrep -A 1 'Working file|username' 
```

输出将如下所示：

```
Working file: bin/scriptname
head: 1.14
--
date: 2008/01/01 15:15:30;  author: username; state: Exp; lines +3 -2
First line of checkin comment will appear here. 
```

这是一个又快又脏的单班轮，所以 YMMV。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-17T14:26:06.820

您还可以使用外部工具，例如[ViewVC](http://www.viewvc.org/)，它允许您使用 Web 表单输入查询。输出也在网络浏览器中很好地格式化。

# c++ - Asp.Net AJAX UpdatePanel后如何获取文档CDHtmlDialog

> ID：354607
> 
> 赞同：1
> 
> 时间：2008-12-09T23:25:47.743
> 
> 标签：c++, ajax, mfc

当我们的 CDHtmlDialog 中显示的页面执行 Asp.Net AJAX UpdatePanel 时，我们会收到一个导航事件，但之后的所有内容似乎都丢失了。我们不再有文档或在页面上获得任何鼠标事件。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-02T17:34:50.777

看起来我以未注册用户的身份发布了原始帖子，所以我认为我无法编辑它。我们能够解决最初的问题，但它在不同的上下文中再次出现（真的开始讨厌 CDHTMLDialog）。

**以下是问题的原因：** Javascript 调用导致 Navigate 事件，并且 CDHtmlDialog::OnBeforeNavigate 被调用并断开连接并删除 IHTMLDocument2。不幸的是，它不是真正的导航，因为页面从未改变。这意味着 CDHtmlDialog::OnNavigateComplete 永远不会被调用来取回文档。

更糟糕的是，当我覆盖 CDHtmlDialog::OnBeforeNavigate 时，我发现 URL 字符串不可读（错误）？

**最简单（最好？）的解决方案：** 我们需要拦截 Before Navigate 事件，如果 URL 不是 javascript 操作，则仅调用 CDHtmlDialog 的 _OnBeforeNavigate2：

```
BEGIN_EVENTSINK_MAP(CMyHTMLDlg, CDHtmlDialog)
    ON_EVENT(CMyHTMLDlg, AFX_IDC_BROWSER, DISPID_BEFORENAVIGATE2, OnBeforeNavigate2, VTS_DISPATCH VTS_VARIANT VTS_VARIANT VTS_VARIANT VTS_VARIANT VTS_VARIANT VTS_PBOOL)
END_EVENTSINK_MAP()

void CMyHTMLDlg::OnBeforeNavigate2(LPDISPATCH pDisp, VARIANT* URL,VARIANT* Flags, VARIANT* TargetFrameName, VARIANT* PostData,VARIANT* Headers, BOOL* Cancel)
{

    ...

    if (URL != NULL)
    {
        // Check if navigation is to a folder..
        CString url = CString(*URL);

        if(url.Left(11) != _T("javascript:"))
        {
            _OnBeforeNavigate2(pDisp, URL, Flags, TargetFrameName, PostData, Headers, (BOOL*)Cancel);
            // If dynamic linking MFC then the above handler doesn't exist. Need to call OnBeforeNavigate direct. 
            // This is from a code site, and it compiles, but I've never tested it to see if it works.
            //CDHtmlDialog::OnBeforeNavigate(pDisp,(LPCSTR)URL);
        }
    }
} 
```

其中大部分是设置 CDHtmlDialog 子类的标准，实际上非常简单，但我花了一些时间才弄清楚如何处理 JavaScript。不幸的是，如果 JavaScript 对页面本身进行动态更改，我不确定这将如何工作。

**几点注意事项：**

*   如果此处需要完全取消导航，则设置 *Cancel = TRUE 并且不要调用 _OnBeforeNavigate2。这里要小心，因为这也会取消任何 JavaScript 操作。
*   直到我看到[源代码](http://sslsnap02.tamu.edu/EXCHANGE/A/VS.net2003/VSPROD1/Program%20Files/Microsoft%20Visual%20Studio%20.NET%202003/Vc7/atlmfc/src/mfc/dlgdhtml.cpp)才清楚，但是 CDHtmlDialog::_OnBeforeNavigate2 只是调用了 CDHtmlDialog::OnBeforeNavigate。

# objective-c - 在 ObjectiveC 和 Cocoa 中以编程方式创建彩色气泡/圆圈

> ID：354610
> 
> 赞同：15
> 
> 时间：2008-12-09T23:28:11.127
> 
> 标签：objective-c, cocoa, drawing

谁能指导我以正确的方式以编程方式构建彩色气泡/圆圈？

我不能使用图像，因为我需要它能够根据用户交互成为任何颜色。

我的想法可能是制作一个白色的圆圈图像，然后在其上叠加一种颜色。但是我不确定这是否可行，或者如何真正去做。

如果有人能指出我正确的方向，我将不胜感激。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-12-10T00:02:08.513

在 Cocoa 中绘制东西有几个步骤。

首先，您需要一个用于定义您将要绘制的对象的路径。在此处查看[绘制基本形状](http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CocoaDrawingGuide/Paths/Paths.html#//apple_ref/doc/uid/TP40003290-CH206-BBCHFJJG)，了解在 Cocoa 中创建路径的指南。您最感兴趣的是将“appendBezierPathWithOvalInRect”消息发送到“NSBezierPath”对象，这需要一个矩形来限制您要绘制的圆。

此代码将在坐标 10,10 处创建一个 10x10 的圆：

```
NSRect rect = NSMakeRect(10, 10, 10, 10);
NSBezierPath* circlePath = [NSBezierPath bezierPath];
[circlePath appendBezierPathWithOvalInRect: rect]; 
```

一旦你有了你的路径，你就想为当前的绘图上下文设置颜色。有描边和填充两种颜色；stroke 是路径的轮廓，fill 是内部颜色。要设置颜色，您将“set”发送到“NSColor”对象。

这将描边设置为黑色，将填充设置为红色：

```
[[NSColor blackColor] setStroke];
[[NSColor redColor] setFill]; 
```

现在您有了路径并且设置了颜色，只需填充路径然后绘制它：

```
[path stroke];
[path fill]; 
```

所有这些都需要在图形上下文中完成，比如在视图的 drawRect 中。所有这些与图形上下文一起看起来像这样：

```
- (void)drawRect:(NSRect)rect
{
    // Get the graphics context that we are currently executing under
    NSGraphicsContext* gc = [NSGraphicsContext currentContext];

    // Save the current graphics context settings
    [gc saveGraphicsState];

    // Set the color in the current graphics context for future draw operations
    [[NSColor blackColor] setStroke];
    [[NSColor redColor] setFill];

    // Create our circle path
    NSRect rect = NSMakeRect(10, 10, 10, 10);
    NSBezierPath* circlePath = [NSBezierPath bezierPath];
    [circlePath appendBezierPathWithOvalInRect: rect];

    // Outline and fill the path
    [circlePath stroke];
    [circlePath fill];

    // Restore the context to what it was before we messed with it
    [gc restoreGraphicsState];
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2012-12-09T08:42:06.537

您可以使用简单的参数`UIView`来创建**完美**的圆`radius`：

```
// Add framework CoreGraphics.framework
#import <QuartzCore/QuartzCore.h>

-(UIView *)circleWithColor:(UIColor *)color radius:(int)radius {
    UIView *circle = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 2 * radius, 2 * radius)];
    circle.backgroundColor = color;
    circle.layer.cornerRadius = radius;
    circle.layer.masksToBounds = YES;
    return circle;
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-09T23:40:23.923

创建一个将 NSColor 作为 ivar 保存的 NSView 子类。在 drawRect 方法中，使用视图的边界创建一个适当大小的 NSBezierPath。然后设置颜色`[myColor set]`并填充路径`[myPath fill]`。你可以做的还有很多，比如设置透明度、边框等等，但除非你有特定的问题，否则我会把它留给文档。

要使用 NSView 子类，只需将视图对象拖到您的 nib 上，然后在 IB 的检查器中的自定义类中选择您的子类的名称。您还需要在控制器中为其设置一个插座，以便您可以根据需要更改颜色。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-10-11T11:09:32.113

```
 CGContextRef c = UIGraphicsGetCurrentContext();
    CGContextSetRGBFillColor(c, 40, 0, 255, 0.1);
    CGContextSetRGBStrokeColor(c, 0, 40, 255, 0.5);

   // Draw a green solid circle
    CGContextSetRGBFillColor(c, 0, 255, 0, 1);
    CGContextFillEllipseInRect(c, CGRectMake(100, 100, 25, 25)); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-09T23:46:18.327

从苹果下载草图。[http://developer.apple.com/library/mac/#samplecode/Sketch](http://developer.apple.com/library/mac/#samplecode/Sketch)

它可以做更多的事情，但其中之一就是画圈。

# c++ - 将位图转换为字节数组

> ID：354613
> 
> 赞同：6
> 
> 时间：2008-12-09T23:29:40.343
> 
> 标签：c++, windows, bitmap, bytearray

在没有 .net 框架的情况下，如何在 C++ 中将位图转换为字节数组？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T23:32:05.627

如果您使用的是 Windows，则可以使用[`GetDIBits`](http://msdn.microsoft.com/en-us/library/ms532334(VS.85).aspx)来检索位图数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T00:17:10.387

如果您的位图是与设备无关的位图，您可以使用 GetObject 并传入 BITMAP 来访问像素数据。这避免了制作像素数据的副本。

# iphone - 如何检查值类型？

> ID：354639
> 
> 赞同：2
> 
> 时间：2008-12-09T23:41:05.123
> 
> 标签：iphone, c, objective-c, cocoa-touch

如何在运行时检查值的类型？

我想知道我在哪里创建双打。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T01:42:02.853

如果您使用的是 Objective-C 类，则`[myObject isKindOfClass: [InterestingClass class]]`可以进行测试。如果您使用的是原始类型（您的问题，引用“双”类型，建议），那么您不能。但是，除非您正在做一些非常时髦的事情，否则编译器可以告诉您原始类型何时匹配或不匹配，以及何时不匹配将隐式提升到所需类型。

了解更多关于您要解决的特定问题是有益的，因为解决方案可能根本不涉及检测双打的创建:-)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T01:33:00.187

除了极少数例外，您永远不需要在运行时检查类型。类型化变量只能保存其分配的类型，类型提升是在编译时确定的。

# algorithm - 安排数量

> ID：354640
> 
> 赞同：4
> 
> 时间：2008-12-09T23:41:15.060
> 
> 标签：algorithm, math

假设我们有*n 个*元素，*a* [1]，*a* [2]，...，*a* [n]，排列成一个圆圈。也就是说，*a* [2]在*a* [1]和*a* [3]之间，*a* [3]在*a* [2]和*a* [4]之间，*a* [*n*]在*a* [*n* -1]和*a* [1]之间，等等。

每个元素可以取值 1 或 0。如果对应*的 a* [*i*]的值不同，则两种排列方式不同。例如，当*n* =3 时，(1, 0, 0) 和 (0, 1, 0) 是不同的排列，即使它们在旋转或反射下可能是同构的。

因为有*n 个*元素，每个元素可以取两个值，所以排列的总数是 2 ^(*n*)。

**这是问题：**

有多少种排列是可能的，使得没有两个相邻元素的值都为 1？如果有帮助，请仅考虑*n* > 3 的情况。

我在这里问有几个原因：

1.  这是在我解决编程问题时出现的
2.  听起来这个问题可能会受益于布尔逻辑/位算术
3.  也许没有封闭的解决方案。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-10T00:00:45.943

让我们首先问一个问题“有多少个长度为 n 的 0-1 序列没有两个连续的 1？” 假设答案是 A(n)。我们有 A(0)=1（空序列），A(1) = 2（“0”和“1”），以及 A(2)=3（“00”，“01”和“10”，但是不是“11”）。

为了更容易编写递归，我们将 A(n) 计算为两个数字的总和：
B(n)，以 0 结尾的序列的数量，
C(n)，这样的数量以 1 结尾的序列。

然后 B(n) = A(n-1) （取任何长度为 n-1 的序列，并附加一个 0）
和 C(n) = B(n-1) （因为如果你在位置 n 有一个 1 ，你必须在 n-1 处有一个 0。）
这给出 A(n) = B(n) + C(n) = A(n-1) + B(n-1) = A(n-1) +一个（n-2）。现在应该很熟悉了:-)

A(n) 就是斐波那契数 F [n+2]，其中斐波那契数列由
F [0] =0、F [1] =1 和 F [n+2] = F [n+1] +F [n]定义，其中 n ≥ 0。

现在回答你的问题。[我们将分别计算1] =0 和[1] =1的排列数。对于前者，a [2] … a [n]可以是任何序列（没有连续的 1），所以数字是 A(n-1)=F [n+1]。对于后者，我们必须有a [2] =0，然后a [3] …a [n]是任何没有*以0 结尾的*连续1 的序列，即B(n-2)=A(n-3)=F [n- 1] .

所以**答案是 F [n+1] + F [n-1]。**

[实际上，我们可以比那个答案更进一步。请注意，如果您将答案称为
G(n)=F [n+1] +F [n-1]，则
G(n+1)=F [n+2] +F [n]和
G(n+2)=F [n+ 3] +F [n+1]，所以即使 G(n) 也满足与斐波那契数列相同的递归！[实际上，类斐波那契序列的任何线性组合都将满足相同的递归，所以这并不令人惊讶。] 所以另一种计算答案的方法是使用：
G(2)=3
G(3)=4
G(对于 n≥4，n)=G(n-1)+G(n-2)。]

现在您还可以使用[封闭形式](http://mathworld.wolfram.com/BinetsFibonacciNumberFormula.html)F [n] =(α ^n -β ^n )/(α-β) （其中 α 和 β 为 (1±√5)/2，x ² -x-1= 0)，得到
**G(n) = ((1+√5)/2) ^n + ((1-√5)/2) ^n。**
[您可以忽略第二项，因为对于大 n，它非常接近于 0，实际上对于所有 n≥2，G(n) 是**最接近 ((1+√5)/2) ^n**的整数。]

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T00:14:26.163

我决定编写一个小脚本来尝试一下：

```
#!/usr/bin/python
import sys

# thx google 
bstr_pos = lambda n: n>0 and bstr_pos(n>>1)+str(n&1) or ""

def arrangements(n):
    count = 0
    for v in range(0, pow(2,n)-1):
        bin = bstr_pos(v).rjust(n, '0')
        if not ( bin.find("11")!=-1 or ( bin[0]=='1' and bin[-1]=='1' ) ):
            count += 1
            print bin
    print "Total = " + str(count)

arrangements(int(sys.argv[1])) 
```

运行 5 次，总共给了我 11 种可能性，分别为 00000、00001、00010、00100、00101、01000、01001、01010、10000、10010、10100。

PS - 请原谅上面代码中的 not() 。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T00:16:43.820

把我天真的剧本混在一起。缓存部分结果的机会很多，但是对于小 n 来说它运行得足够快，我没有打扰。

```
def arcCombinations(n, lastDigitMustBeZero):
    """Takes the length of the remaining arc of the circle, and computes
       the number of legal combinations.
       The last digit may be restricted to 0 (because the first digit is a 1)"""

    if n == 1: 
        if lastDigitMustBeZero:
            return 1 # only legal answer is 0
        else:
            return 2 # could be 1 or 0.
    elif n == 2:
        if lastDigitMustBeZero:
            return 2 # could be 00 or 10
        else:
            return 3 # could be 10, 01 or 00
    else:
        # Could be a 1, in which case next item is a zero.
        return (
            arcCombinations(n-2, lastDigitMustBeZero) # If it starts 10
            + arcCombinations(n-1, lastDigitMustBeZero) # If it starts 0
            )

def circleCombinations(n):
    """Computes the number of legal combinations for a given circle size."""

    # Handle case where it starts with 0 or with 1.
    total = (
            arcCombinations(n-1,True) # Number of combinations where first digit is a 1.
            +
            arcCombinations(n-1,False) # Number of combinations where first digit is a 0.
        )
    return total

print circleCombinations(13) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T00:38:17.553

[这个问题与Zeckendorf 表示](http://en.wikipedia.org/wiki/Zeckendorf%27s_theorem)非常相似。由于循环约束，我找不到应用 Zeckendorf 定理的明显方法，但斐波那契数显然在这个问题中非常普遍。

# security - .NET Web 应用程序的应用程序安全审计？

> ID：354644
> 
> 赞同：3
> 
> 时间：2008-12-09T23:44:58.267
> 
> 标签：security, web-applications

有人对 .NET Web 应用程序的安全审计有什么建议吗？

我对所有选项都感兴趣。我希望能够对我的应用程序进行不可知的安全风险调查。

编辑：

澄清一下，该系统的设计考虑了安全性。环境的设置考虑了安全性。我想要一个独立的安全措施，而不是 - “是的，它很安全”......让某人审计 1M+ 行代码的成本可能比开发成本更高。看起来还没有一个好的自动化/廉价方法。感谢您的建议。

审计的重点是独立验证团队实施的安全性。

顺便说一句 - 有几种自动黑客/探测工具可以探测应用程序/网络服务器，但我有点担心它们是否是蠕虫......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-15T15:40:14.360

**最好的事情：**

*   聘请安全人员进行源代码分析
*   聘请安全人员/渗透测试公司进行黑盒分析的第二个最佳做法

**以下工具将有所帮助：**

*   静态分析工具 Fortify / Ounce Labs - 代码审查
*   考虑 HP WebInspects 的安全对象（VS.NET 插件）等解决方案
*   购买黑盒应用程序扫描仪，例如 Netsparker、Appscan、WebInspect、Hailstorm、Acunetix 或[Netsparker的免费版本](http://www.mavitunasecurity.com/communityedition/)

聘请一些安全专家是一个更好的主意（虽然会花费更多），因为他们不仅会发现自动化工具可能会发现的注入和技术问题，而且还会发现所有逻辑问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T20:36:08.727

在您的情况下，任何人都可以使用以下选项：

1.  代码审查，
2.  使用工具对代码库进行静态分析，
3.  在运行时动态分析应用程序。

Mitchel 已经指出了 Fortify 的使用。事实上，Fortify 有两个产品涵盖静态和动态分析领域 - [SCA](http://www.fortify.com/products/detect/in_development.jsp)（静态分析工具，用于开发）和[PTA](http://www.fortify.com/products/detect/in_testing.jsp)（在测试期间执行测试用例时执行应用程序分析）。

但是，没有任何工具是完美的，您最终可能会出现误报（代码库的片段虽然不易受到攻击，但会被标记）和误报。只有代码审查才能解决此类问题。代码审查很昂贵 - 不是您组织中的每个人都能够用安全专家的眼睛审查代码。

首先，可以从 OWASP 开始。强烈建议在学习[OWASP 开发指南](http://www.owasp.org/index.php/Category:OWASP_Guide_Project)之前了解[安全性背后的原则](http://www.owasp.org/index.php/Category:Principle)（3.0 正在草稿中；2.0 可以被认为是稳定的）。最后，您可以准备执行[代码库的第一次扫描](http://www.owasp.org/index.php/First_sweep_of_the_code_base)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T00:28:31.767

我开始对我们的内部应用程序做的第一件事是使用 Fortify 之类的工具对您的代码库进行安全分析。

否则，您可能会考虑使用专门从事安全性的第三方公司的服务，让他们测试您的应用程序

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-15T15:32:34.237

测试和静态分析是查找安全漏洞的一种非常糟糕的方法，如果您在整个设计和实现过程中都没有考虑到安全性，那么它确实是一种不得已的方法。

问题是您现在正试图列举您的应用程序可能失败的所有方式，并否认这些方式（通过修补），而不是试图指定您的应用程序应该做什么，并阻止所有不是这样的事情（通过防御性编程）。由于您的应用程序可能有无数种出错的方式，并且只有少数几件事情要做，因此您应该采取“默认拒绝”的方法并只允许好的东西。

换句话说，无论它们如何出现，构建控件以防止所有类型的典型漏洞（例如，参见其他答案中提到的 OWASP）都比寻找特定的错误更容易和更有效您的代码的某些版本具有。您应该尝试证明存在良好的控制（可以做到），而不是没有坏的东西（不能）。

如果您让某人审查您的设计和安全要求（您究竟要保护什么？），并且可以完全访问代码和所有细节，那将比某种黑盒测试更有价值。因为如果你的设计是错误的，那么你实现它的好坏就无关紧要了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-15T15:59:09.393

我们已经使用[Telus](http://www.telus.com/security/)为我们进行了几次渗透测试，结果给我们留下了深刻的印象。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-16T23:51:09.490

May I recommend you contact [Artec Group](http://www.artecgroup.net/), [Security Compass](http://www.securitycompass.com/) and [Veracode](http://www.veracode.com/) and check out their offerings...

# objective-c - 如何使用 NSBrowser 中所选单元格的路径更新 NSPathControl

> ID：354650
> 
> 赞同：6
> 
> 时间：2008-12-09T23:47:54.657
> 
> 标签：objective-c, cocoa, cocoa-bindings, key-value-observing

我需要使用 NSBrowser 中当前选择的路径来更新 NSPathControl，但是当路径从 NSBrowser 发生更改时，我无法找出获取通知的方法。执行此操作的理想方法只是观察 NSBrowser 中的路径键路径，但这使得 KVO 只能观察`<key>`返回 void 消息且没有更新的 set 方法（setPath 返回 bool 成功值）。

I also tried observing the selectedCell key path, but I'm not getting notifications when the selection there is changed.

还有其他一些我想念的非常明显的方法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-10T03:28:26.303

[由Cocoa Dev](http://cocoadev.com/forums/comments.php?DiscussionID=600&page=1#Item_1)的 Rob Keniger 提供：

> 您是否查看过 /Developer/Examples 中的 SimpleBrowser 示例？它显示了如何在用户更改当前选择时获取当前选择，基本上只需设置 NSBrowser 的操作。

这确实是做到这一点的方法。只需在您的控制器中实现一个方法`- (void)browserClicked:`，并将其映射到`NSBrowser`'s `action`in interface builder，每次选择在该方法内发生变化时，您希望发生的任何事情，例如

```
- (void)browserClicked:(id)browser {
    self.pathToSelectedCell = [browser path]; // NSPathControl is bound to pathToSelectedCell
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T00:03:08.950

我刚刚签入了 IB，看起来 NSBrowser 有一个选择索引路径绑定（一个 NSIndexPath 对象数组），您可以使用 KVO 对其进行监控。这很奇怪，但我在文档中没有看到任何提及，所以你可能需要做一些研究，看看你是否应该或不应该使用它，即使它似乎有效。如果是这样，在您的 KVO 观察方法中，您将找到浏览器的当前路径，并将其转换为路径控件可以使用的 NSURL。

如果这不起作用，还有委托方法`- (BOOL)browser:(NSBrowser *)sender selectRow:(NSInteger)row inColumn:(NSInteger)column`和`- (BOOL)browser:(NSBrowser *)sender selectCellWithString:(NSString *)title inColumn:(NSInteger)column`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-03-06T18:43:43.343

从 10.6 开始，可以通过使用委托回调找出哪些项目被选中，如下所示：

```
- (NSIndexSet *)browser:(NSBrowser *)browser selectionIndexesForProposedSelection:(NSIndexSet *)proposedSelectionIndexes inColumn:(NSInteger)column
{
    NSLog(@"New first item of the new selection is at index %@", [proposedSelectionIndexes firstIndex]);
    // Do something with the selected index or indicies
    return proposedSelectionIndexes; // Allow the selection to occur by not changing this
} 
```

# vba - 导入/导出关系

> ID：354651
> 
> 赞同：4
> 
> 时间：2008-12-09T23:48:01.380
> 
> 标签：vba, ms-access, table-relationships

我有几个具有确切表结构的 mdb 文件。我必须将主表的主键从自动编号更改为所有编号，这意味着我必须：

1.  删除主表的所有关系
2.  更改主表
3.  再次创建关系，...为所有表。

有没有办法从一个文件中导出关系并将它们导入到所有其他文件中？

我确信这可以通过一些宏/vb 代码来完成。有人有我可以使用的例子吗？

谢谢。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-10T02:40:34.700

不是一个完整的解决方案，但这可能会让你继续......

以下函数将打印出所有关系的元数据。将其更改为以您喜欢的任何格式（CSV、制表符分隔、XML 等）保存到文件：

```
Function PrintRelationships()
    For Each rel In CurrentDb.Relations
        With rel
            Debug.Print "Name: " & .Name
            Debug.Print "Attributes: " & .Attributes
            Debug.Print "Table: " & .Table
            Debug.Print "ForeignTable: " & .ForeignTable

            Debug.Print "Fields:"
            For Each fld In .Fields
                Debug.Print "Field: " & fld.Name
            Next
        End With
    Next
End Function 
```

此函数将删除数据库中的所有关系：

```
Function DropRelationships()
    With CurrentDb
        For Each rel In .Relations
            .Relations.Delete Name:=rel.Name
        Next
    End With
End Function 
```

此函数将创建一个关系。您必须遍历保存的关系数据文件。

```
Function CreateRelationships()
    With CurrentDb
        Set rel = .CreateRelation(Name:="[rel.Name]", Table:="[rel.Table]", ForeignTable:="[rel.FireignTable]", Attributes:=[rel.Attributes])
        rel.Fields.Append rel.CreateField("[fld.Name for relation]")
        rel.Fields("[fld.Name for relation]").ForeignName = "[fld.Name for relation]"
        .Relations.Append rel
    End With
End Function 
```

由于时间限制，错误处理和 IO 被省略（必须让孩子上床睡觉）。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2016-02-16T16:18:36.160

根据@Patrick Cuff 的回答，我创建了一对脚本：一个导出到 xml，另一个读取这个 xml 并将其解析到数据库中

# 用于将关系从 MsAccess 导出到 XML 的 VBScript

```
'supply the Access Application object into this function and path to file to which the output should be written
Function ExportRelationships(oApplication, sExportpath)
 Dim relDoc, myObj
 Set relDoc = CreateObject("Microsoft.XMLDOM")
 relDoc.appendChild relDoc.createElement("Relations") 'create root xml element

 'loop though all the relations
 For Each myObj In oApplication.CurrentDb.Relations
  If Not Left(myObj.Name, 4) = "MSys" Then 'exclude system relations
   Dim relName, relAttrib, relTable, relFoTable, fld

   relDoc.childNodes(0).appendChild relDoc.createElement("Relation")

   Set relName = relDoc.createElement("Name")
   relName.Text = myObj.Name
   relDoc.childNodes(0).lastChild.appendChild relName

   Set relAttrib = relDoc.createElement("Attributes")
   relAttrib.Text = myObj.Attributes
   relDoc.childNodes(0).lastChild.appendChild relAttrib

   Set relTable = relDoc.createElement("Table")
   relTable.Text = myObj.Table
   relDoc.childNodes(0).lastChild.appendChild relTable

   Set relFoTable = relDoc.createElement("ForeignTable")
   relFoTable.Text = myObj.ForeignTable
   relDoc.childNodes(0).lastChild.appendChild relFoTable

   'in case the relationship works with more fields
   For Each fld In myObj.Fields
    Dim lf, ff
    relDoc.childNodes(0).lastChild.appendChild relDoc.createElement("Field")

    Set lf = relDoc.createElement("Name")
    lf.Text = fld.Name
    relDoc.childNodes(0).lastChild.lastChild.appendChild lf

    Set ff = relDoc.createElement("ForeignName")
    ff.Text = fld.ForeignName
    relDoc.childNodes(0).lastChild.lastChild.appendChild ff
   Next
  End If
 Next
 relDoc.insertBefore relDoc.createProcessingInstruction("xml","version='1.0'"), relDoc.childNodes(0)
 relDoc.Save sExportpath
End Function 
```

# 用于从 XML 将关系导入 MsAccess 的 VBScript

```
'supply the Access Application object into this function and path to file from which the input should be read
Function ImportRelationships(oApplication, sImportpath)
 Dim relDoc, myObj
 Set relDoc = CreateObject("Microsoft.XMLDOM")
 relDoc.Load(sImportpath)
 Dim xmlRel, xmlField, accessRel, relTable, relName, relFTable, relAttr, i

 'loop through every Relation node inside .xml file
 For Each xmlRel in relDoc.selectNodes("/Relations/Relation")
  relName = xmlRel.selectSingleNode("Name").Text
  relTable = xmlRel.selectSingleNode("Table").Text
  relFTable = xmlRel.selectSingleNode("ForeignTable").Text
  relAttr = xmlRel.selectSingleNode("Attributes").Text

  'remove any possible conflicting relations or indexes
  On Error Resume next
  oApplication.CurrentDb.Relations.Delete (relName)
  oApplication.CurrentDb.TableDefs(relTable).Indexes.Delete(relName)
  oApplication.CurrentDb.TableDefs(relFTable).Indexes.Delete(relName)
  On Error Goto 0

  'create the relationship object
  Set accessRel = oApplication.CurrentDb.CreateRelation(relName, relTable, relFTable, relAttr)

  'in case the relationship works with more fields
  For Each xmlField In xmlRel.selectNodes("Field")
   accessRel.Fields.Append accessRel.CreateField(xmlField.selectSingleNode("Name").Text)
   accessRel.Fields(xmlField.selectSingleNode("Name").Text).ForeignName = xmlField.selectSingleNode("ForeignName").Text
  Next

  'and finally append the newly created relationship to the database
  oApplication.CurrentDb.Relations.Append accessRel
 Next
End Function 
```

### 笔记

只是为了澄清预期传递给*oApplication*参数的内容

```
Set oApplication = CreateObject("Access.Application")
oApplication.NewCurrentDatabase path   'new database
oApplication.OpenCurrentDatabase path  'existing database 
```

如果您从 VBA 而不是 VBScript 运行它，您可以在使用*oApplication的代码中的任何地方删除参数和常规**Application*对象。

 ** * *

我开始处理这段代码，因为我需要在一个非常复杂的 MsAccess 项目上实现版本控制。[这篇文章](https://stackoverflow.com/questions/187506/how-do-you-use-version-control-with-access-development)让我感动，关于如何导出/导入 MsAccess 项目的其他部分也有一些很好的建议。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T04:27:35.593

我突然想到，您可以使用在任何更改之前所做的文件备份来恢复索引和关系。这里有一些注意事项。

```
Sub RunExamples()
Dim strCopyMDB As String
Dim fs As FileSystemObject
Dim blnFound As Boolean
Dim i

' This code is not intended for general users, it is sample code built '
' around the OP '
'You will need a reference to the Microsoft DAO 3.x Object Library '
'This line causes an error, but it will run '
'It is not suitable for anything other than saving a little time '
'when setting up a new database '
Application.References.AddFromFile ("C:\Program Files\Common Files\Microsoft Shared\DAO\dao360.dll")

'You must first create a back-up copy '
Set fs = CreateObject("Scripting.FileSystemObject")

strCopyMDB = CurrentProject.Path & "\c.mdb"
blnFound = fs.FileExists(strCopyMDB)

i = 0
Do While blnFound
    strCopyMDB = CurrentProject.Path & "\c" & i & ".mdb"
    blnFound = fs.FileExists(strCopyMDB)
Loop

fs.CopyFile CurrentProject.FullName, strCopyMDB

ChangeTables
AddIndexesFromBU strCopyMDB
AddRelationsFromBU strCopyMDB
End Sub  

Sub ChangeTables()
Dim db As Database
Dim tdf As DAO.TableDef
Dim rel As DAO.Relation
Dim fld As DAO.Field
Dim ndx As DAO.Index
Dim i

    Set db = CurrentDb
    'In order to programmatically change an autonumber, '
    'it is necessary to delete any relationships that '
    'depend on it. '  
    'When deleting from a collection, it is best '
    'to iterate backwards. '
    For i = db.Relations.Count - 1 To 0 Step -1
        db.Relations.Delete db.Relations(i).Name
    Next

    'The indexes must also be deleted or the '
    'number cannot be changed. '
    For Each tdf In db.TableDefs
        If Left(tdf.Name, 4) <> "Msys" Then
            For i = tdf.Indexes.Count - 1 To 0 Step -1
                tdf.Indexes.Delete tdf.Indexes(i).Name
            Next

            tdf.Indexes.Refresh

            For Each fld In tdf.Fields
                'If the field is an autonumber, '
                'use code supplied by MS to change the type '
                If (fld.Attributes And dbAutoIncrField) Then

                    AlterFieldType tdf.Name, fld.Name, "Long"

                End If
            Next
        End If

    Next
End Sub

Sub AddIndexesFromBU(MDBBU)
Dim db As Database
Dim dbBU As Database
Dim tdf As DAO.TableDef
Dim tdfBU As DAO.TableDef
Dim ndx As DAO.Index
Dim ndxBU As DAO.Index
Dim i

Set db = CurrentDb
'This is the back-up made before starting '
Set dbBU = OpenDatabase(MDBBU)

    For Each tdfBU In dbBU.TableDefs
        'Skip system tables '
        If Left(tdfBU.Name, 4) <> "Msys" Then
            For i = tdfBU.Indexes.Count - 1 To 0 Step -1
                'Get each index from the back-up '
                Set ndxBU = tdfBU.Indexes(i)
                Set tdf = db.TableDefs(tdfBU.Name)
                Set ndx = tdf.CreateIndex(ndxBU.Name)
                ndx.Fields = ndxBU.Fields
                ndx.IgnoreNulls = ndxBU.IgnoreNulls
                ndx.Primary = ndxBU.Primary
                ndx.Required = ndxBU.Required
                ndx.Unique = ndxBU.Unique

                ' and add it to the current db '
                tdf.Indexes.Append ndx
            Next

            tdf.Indexes.Refresh
        End If
    Next

End Sub

Sub AddRelationsFromBU(MDBBU)
Dim db As Database
Dim dbBU As Database
Dim rel As DAO.Relation
Dim fld As DAO.Field
Dim relBU As DAO.Relation
Dim i, j, f

On Error GoTo ErrTrap

    Set db = CurrentDb
    'The back-up again '
    Set dbBU = OpenDatabase(MDBBU)

    For i = dbBU.Relations.Count - 1 To 0 Step -1
        'Get each relationship from bu '
        Set relBU = dbBU.Relations(i)
        Debug.Print relBU.Name
        Set rel = db.CreateRelation(relBU.Name, relBU.Table, relBU.ForeignTable, relBU.Attributes)
        For j = 0 To relBU.Fields.Count - 1
            f = relBU.Fields(j).Name
            rel.Fields.Append rel.CreateField(f)
            rel.Fields(f).ForeignName = relBU.Fields(j).ForeignName
        Next
        'For some relationships, I am getting error'
        '3284 Index already exists, which I will try'
        'and track down tomorrow, I hope'
        'EDIT: Apparently this is due to Access creating hidden indexes
        'and tracking these down would take quite a bit of effort
        'more information can be found in this link:
        'http://groups.google.ie/group/microsoft.public.access/browse_thread/thread/ca58ce291bdc62df?hl=en&ie=UTF-8&q=create+relation+3284+Index+already+exists
        'It is an occasional problem, so I've added an error trap

         'Add the relationship to the current db'
         db.Relations.Append rel
    Next
ExitHere:
    Exit Sub

ErrTrap:
    If Err.Number = 3284 Then
        Debug.Print relBU.Name, relBU.Table, relBU.ForeignTable, relBU.Attributes
        Resume Next
    Else
        'this is not a user sub, so may as well ... '
        Stop

End If
End Sub

Sub AlterFieldType(TblName As String, FieldName As String, _
    NewDataType As String)
'http://support.microsoft.com/kb/128016'

    Dim db As Database
    Dim qdf As QueryDef
    Set db = CurrentDb()

    ' Create a dummy QueryDef object.'
    Set qdf = db.CreateQueryDef("", "Select * from PROD1")

    ' Add a temporary field to the table.'
    qdf.SQL = "ALTER TABLE [" & TblName & "] ADD COLUMN AlterTempField " & NewDataType
    qdf.Execute

    ' Copy the data from old field into the new field.'
    qdf.SQL = "UPDATE DISTINCTROW [" & TblName _
        & "] SET AlterTempField = [" & FieldName & "]"
    qdf.Execute

    ' Delete the old field.'
    qdf.SQL = "ALTER TABLE [" & TblName & "] DROP COLUMN [" _
       & FieldName & "]"
    qdf.Execute

    ' Rename the temporary field to the old field's name.'
    db.TableDefs("[" & TblName & "]").Fields("AlterTempField").Name = FieldName

End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-16T07:10:21.903

感谢您的代码片段。为了摆脱你的 3284 错误，我改变了一些东西。如果您从示例 mdb 复制所有索引，然后尝试放置关系，则会引发异常，因为当您放置关系时，它不希望为关系提供索引，它会放置自己的索引。我遵循的步骤是（假设 target.mdb 和 source.mdb）：

1.  `target.mdb`在 target.mdb 中运行此代码，通过调用 ChangeTables删除所有索引和关系
2.  调用`AddIndexesFromBU`source.mdb 并使用条件
    If `ndxBU.Unique`Then `tdf.Indexes.Append ndx` End If 这将只放置唯一索引
3.  调用 AddRelationsFromBU`source.mdb`并放置所有关系
4.  再次调用 AddIndexesFromBU source.mdb 并将条件更改为 If not `ndxBU.Unique`Then

我还在 AddIndexesFromBU 中添加了与 AddRelationsFromBU 相同的错误陷阱，并在 if ans else 中继续下一步

这对我有用。

# asp.net - 关闭 ASP.NET 和 AJAX 应用程序的浏览器窗口

> ID：354653
> 
> 赞同：1
> 
> 时间：2008-12-09T23:49:02.363
> 
> 标签：asp.net, javascript, asp.net-ajax

在服务器端执行后关闭 AJAX ASP.NET 应用程序的浏览器窗口的最佳方法是什么。

我找到了这个[解决方案](https://stackoverflow.com/questions/250450/aspnet-ajax-close-window-after-ajax-call)，但对于我想要完成的事情来说似乎有点复杂。或者这是完成我的任务的最佳方式。

**更新：**按下按钮后我必须关闭窗口

**更新1：**我尝试了另一个SO问题的解决方案，但它对我不起作用。

```
<asp:Button ID="btnMyButton" runat="server" onClick="btnMyButton_Click" />

protected void btnMyButton_Click(object sender, EventArgs e)
{
} 
```

* * *

我在我的页面中使用了以下代码，但弹出“您正在查看的网页正在尝试关闭窗口”模块窗口。

```
if (ScriptManager.GetCurrent(this).IsInAsyncPostBack)
            ScriptManager.RegisterStartupScript(upApproveRequest, typeof(string), "closeWindow", "window.close();", true); 
```

有什么办法可以防止这种情况？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-09-10T14:36:52.817

实际上，您可以通过在按钮单击事件中放置以下代码来做到这一点。

```
protected void btnMyButton_Click(object sender, ImageClickEventArgs e)
{
    // Update database
    bool success = Presenter.DoDatabaseStuff();

    if (success)
    {
        // Close window after success
        const string javaScript = "<script language=javascript>window.top.close();</script>";
        if (!ClientScript.IsStartupScriptRegistered("CloseMyWindow"))
        {
            ClientScript.RegisterStartupScript(GetType(),"CloseMyWindow", javaScript);
        }
    }
    else
    {
        // Display failure result
        result_msg_area.Visible = true;
        lblError.Text = "An error occurred!";                
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T02:23:16.967

不，未经用户同意，无法关闭浏览器窗口。您可以将他们从他们的应用程序中注销，但您不能强行关闭浏览器窗口。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-02-14T19:43:13.947

为避免脚本警告，您可以使用以下命令：

```
window.open('', '_self', '');window.close(); 
```

所以：

```
if (ScriptManager.GetCurrent(this).IsInAsyncPostBack)
        ScriptManager.RegisterStartupScript(upApproveRequest, typeof(string), "closeWindow", "window.open('', '_self', '');window.close();", true); 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-12-09T23:53:45.253

差不多就是这样。你可以使用`ScriptManager.RegisterStartupScript(...)`

# ruby-on-rails - Rails ActiveSupport 时间解析？

> ID：354657
> 
> 赞同：31
> 
> 时间：2008-12-09T23:52:56.287
> 
> 标签：ruby-on-rails, ruby, parsing, time, activesupport

[Rails 的 ActiveSupport 模块用许多方法扩展了内置的 ruby​​ Time 类。](http://api.rubyonrails.com/classes/ActiveSupport/CoreExtensions/Time/Conversions.html)

值得注意的是，有一种`to_formatted_s`方法可以让您编写`Time.now.to_formatted_s(:db)`以获取数据库格式的字符串，而不必`strftime`到处编写难看的格式字符串。

我的问题是，有没有办法倒退？

类似的东西`Time.parse_formatted_s(:db)`会解析数据库格式的字符串，返回一个新的时间对象。这似乎是 rails 应该提供的东西，但如果是，我找不到它。

我只是找不到它，还是我需要自己写？

谢谢

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-09-24T21:24:27.000

毕竟，看起来 ActiveSupport 确实提供了您正在寻找的解析方法（我也在寻找）！— 至少如果您尝试解析的字符串是标准的、ISO-8601 格式的（`:db`格式）日期。

如果您尝试解析的日期已经在您当地的时区，那真的很容易！

```
 > Time.zone.parse('2009-09-24 08:28:43')
=> Thu, 24 Sep 2009 08:28:43 PDT -07:00

 > Time.zone.parse('2009-09-24 08:28:43').class
=> ActiveSupport::TimeWithZone 
```

然后可以轻松地将时区感知时间转换为 UTC

```
 > Time.zone.parse('2009-09-24 08:28:43').utc
=> 2009-09-24 15:28:43 UTC 
```

或其他时区：

```
 > ActiveSupport::TimeZone.us_zones.map(&:name)
=> ["Hawaii", "Alaska", "Pacific Time (US & Canada)", "Arizona", "Mountain Time (US & Canada)", "Central Time (US & Canada)", "Eastern Time (US & Canada)", "Indiana (East)"]

 > Time.zone.parse('2009-09-24 08:28:43').utc.in_time_zone('Eastern Time (US & Canada)')
=> Thu, 24 Sep 2009 11:28:43 EDT -04:00 
```

另一方面，如果您尝试解析的日期字符串采用 UTC 格式，则看起来没有任何方法可以将其*直接*解析为 TimeWithZone，但我能够首先使用 DateTime.strptime 解决这个问题...

如果您尝试解析的日期是 UTC，并且您希望它保持为 UTC，您可以使用：

```
 > DateTime.strptime('2009-09-24 08:28:43', '%Y-%m-%d %H:%M:%S').to_time
=> 2009-09-24 08:28:43 UTC 
```

如果您尝试解析的日期是 UTC，并且您希望将其转换为您的默认时区，您可以使用：

```
 > DateTime.strptime('2009-09-24 08:28:43', '%Y-%m-%d %H:%M:%S').to_time.in_time_zone
=> Thu, 24 Sep 2009 01:28:43 PDT -07:00 
```

看起来它甚至可以解析其他格式，例如 Time#to_s 产生的奇怪格式：

```
irb -> Time.zone.parse('Wed, 23 Sep 2009 02:18:08').to_s(:db)
    => "2009-09-23 09:18:08"

irb -> Time.zone.parse('Wed, 23 Sep 2009 02:18:08 EDT').to_s(:db)
    => "2009-09-23 06:18:08" 
```

我很感动。

[以下是来自 [ http://api.rubyonrails.org/classes/ActiveSupport/TimeWithZone.html][1]](http://api.rubyonrails.org/classes/ActiveSupport/TimeWithZone.html][1])的更多示例：

```
 Time.zone = 'Eastern Time (US & Canada)'        # => 'Eastern Time (US & Canada)'
  Time.zone.local(2007, 2, 10, 15, 30, 45)        # => Sat, 10 Feb 2007 15:30:45 EST -05:00
  Time.zone.parse('2007-02-10 15:30:45')          # => Sat, 10 Feb 2007 15:30:45 EST -05:00
  Time.zone.at(1170361845)                        # => Sat, 10 Feb 2007 15:30:45 EST -05:00
  Time.zone.now                                   # => Sun, 18 May 2008 13:07:55 EDT -04:00
  Time.utc(2007, 2, 10, 20, 30, 45).in_time_zone  # => Sat, 10 Feb 2007 15:30:45 EST -05:00 
```

更多文档链接供参考：

*   [http://api.rubyonrails.org/classes/ActiveSupport/TimeWithZone.html](http://api.rubyonrails.org/classes/ActiveSupport/TimeWithZone.html)
*   [http://api.rubyonrails.org/classes/ActiveSupport/TimeZone.html](http://api.rubyonrails.org/classes/ActiveSupport/TimeZone.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-08-05T16:17:58.093

```
ActiveSupport::TimeZone.new('UTC').parse('2009-09-23 09:18:08')
=> Wed, 23 Sep 2009 09:18:08 UTC +00:00 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-02-07T06:36:47.767

Rails 5 终于提供了`strptime`！

```
value = '1999-12-31 14:00:00'
format = '%Y-%m-%d %H:%M:%S'
Time.zone.strptime(value, format)
# => Fri, 31 Dec 1999 14:00:00 HST -10:00

ActiveSupport::TimeZone.all.sample.strptime(value, format)
# => Fri, 31 Dec 1999 14:00:00 GST +04:00 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-05-17T22:37:33.473

我也遇到了这个问题，以上答案都没有让我满意。理想情况下，可以使用`ActiveSupport::TimeZone`like并以任意格式`Time`调用它并取回正确的对象。 不存在所以我创建了这个猴子补丁：`.strptime``TimeZone``ActiveSupport::TimeZone.strptime`

```
 class ActiveSupport::TimeZone
    def strptime(str, fmt, now = self.now)
      date_parts = Date._strptime(str, fmt)
      return if date_parts.blank?
      time = Time.strptime(str, fmt, now) rescue DateTime.strptime(str, fmt, now)
      if date_parts[:offset].nil?
        ActiveSupport::TimeWithZone.new(nil, self, time)
      else
        time.in_time_zone(self)
      end
    end
  end 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-25T01:40:15.317

```
>> "2009-09-24".to_date
=> Thu, 24 Sep 2009
>> "9/24/2009".to_date
=> Thu, 24 Sep 2009 
```

除非您的日期采用某种奇怪的格式，否则效果很好。

# java - 在 Vista 上双击执行 Jar

> ID：354664
> 
> 赞同：9
> 
> 时间：2008-12-09T23:55:44.360
> 
> 标签：java, windows-vista, executable-jar

这几乎让我失败了。

在 XP 和更早版本的 Windows 上，您可以自定义 Open With 文件类型以包含 java - jar "myjar.jar"，但在 Vista 上，此功能似乎已被删除。我当然可以创建一个 .bat 文件来启动我的应用程序，但是是否可以让 Vista 根据需要执行一个 .jar 文件？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-10T03:28:56.600

您可以使用 2 个实用程序从命令行执行此操作。

第一个，ASSOC，用于创建文件关联。要验证是否为 JAR 类型定义了一个：

```
>assoc .jar
.jar=jarfile 
```

如果找不到，则使用以下命令创建它：

```
>assoc .jar=jarfile 
```

下一步是定义关联。这是通过 FTYPE 完成的。

要验证是否已定义，请键入

```
>ftype jarfile
jarfile="C:\Program Files\Java\jre1.5.0_10\bin\javaw.exe" -jar "%1" %* 
```

再次，如果没有找到或使用了错误的 JRE，请使用 FTYPE 修复问题

```
>ftype jarfile="C:\Program Files\Java\jre1.5.0_10\bin\javaw.exe" -jar "%1" %* 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T00:00:13.870

使用软件 JarFix >= 1.1.0 。包括 Vista 支持，它“恢复”了 .jar 关联！

例如在这里下载：http: [//www.softpedia.com/get/Others/Miscellaneous/Jarfix.shtml](http://www.softpedia.com/get/Others/Miscellaneous/Jarfix.shtml)

# c# - 在 Page PreRender 使用 c# 获取对下拉框的引用

> ID：354666
> 
> 赞同：0
> 
> 时间：2008-12-09T23:56:16.200
> 
> 标签：c#, dropdownbox

我想在加载期间从后面的 c# 代码向我的 aspx 页面上的下拉框添加选项。我不知道如何获得对控件的引用。我有一些在用户更改下拉框时触发的 c# 代码。在那里，我得到了对下拉列表的引用：

```
DropDownBox ddb = (DropDownBox)info.Toolbar.ToolbarItems.Find("ID"); 
```

但是，如果我尝试它，那将不起作用

```
protected void Page_PreRender(object sender, EventArgs e)
    { 
```

在我的 aspx.cs 上

我错过了什么？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T00:17:18.500

如果您希望在回发时从视图状态中自动选择下拉列表中的选定项目，您需要在 Page_PreLoad 触发时将所有项目都包含在下拉列表中。为此，您需要将代码放入 Page_Init 中，此时控件已创建，但视图状态尚未注入其中。

在此处查看[ASP.NET 页面生命周期概述](http://msdn.microsoft.com/en-us/library/ms178472.aspx)，了解有关页面生命周期的信息。

我看到您的下拉列表位于父容器中，如果无法获取对控件的引用，您可能需要在使用 Find() 之前调用 info.EnsureChildControls()。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T00:03:47.713

PreRender 即将结束页面生命周期。您确定要在那里进行更改吗？听起来您应该在最初绑定或更改其选择时更改下拉列表中的项目。

[http://codebetter.com/blogs//images/codebetter_com/raymond.lewallen/89/o_aspNet_Page_LifeCycle.jpg](http://codebetter.com/blogs//images/codebetter_com/raymond.lewallen/89/o_aspNet_Page_LifeCycle.jpg)

# sql - Mysql查询以获取给定项目编号的2个最新信息

> ID：354669
> 
> 赞同：3
> 
> 时间：2008-12-09T23:58:28.163
> 
> 标签：sql, mysql

我的数据库中有以下属性。

> 统计 id、设备名称、值、时间戳。

对于给定的统计数据，我想找到每个唯一设备的 2 个最新时间戳和对应值。

我正在尝试类似的东西

试验 1)

```
select statistic, devicename, value, timestamp
from X_STATSVALUE
where statistic=19
order by orgtime DESC limit 2; 
```

这给了我前 2 个时间戳，但不是每个设备。

试验 2)

```
select statistic, devicename, value, timestamp
from X_STATSVALUE as x 
where x.statistic=241
  and (select count(*)
       from X_STATSVALUE as y
       where y.statistic=x.statistic
         and y.device=x.device
         and y.timestamp > x.timestamp) <=1; 
```

但这也不太好用..

基本上，对于给定的统计数据，我想要每个设备的 2 个最新时间戳和值。任何帮助都非常感谢 :)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T00:12:12.393

这就是我解决此类问题的方法：

```
SELECT x.statistic, x.devicename, x.value, x.timestamp
FROM X_STATSVALUE AS x
  LEFT OUTER JOIN X_STATSVALUE AS x2
    ON (x.statistic = x2.statistic 
    AND x.devicename = x2.devicename 
    AND x.timestamp < x2.timestamp)
GROUP BY x.statistic, x.devicename
HAVING COUNT(*) < 2; 
```

换句话说，显示的行使得具有相同`statistic`和`devicename`和更大（更新）的其他行少于两行`timestamp`。

我假设`timestamp`对于给定的统计信息和设备名称，列中不会有重复项。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T08:38:49.437

尝试类似：

```
SELECT DISTINCT x.statistic, x.devicename, x.value, x.timestamp
FROM X_STATSVALUE AS x
WHERE x.timestamp IN (SELECT timestamp
                      FROM X_STATSVALUE
                      WHERE devicename = x.devicename AND statistic = x.statistic
                      ORDER BY timestamp LIMIT 2) 
```

（虽然可能不适用于旧的 MySQL）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T09:22:54.717

我在我的系统上使用像您这样的演示表测试了以下查询，它可以工作。我考虑过 orgtime 而不是时间戳.. 你也可以这样做（只需更改名称）

```
 select t1.statistic, devicename, value, timestamp from X_STATSVALUE as t1 

    inner join 

    ( select statistic, max(orgtime) as orgtime from X_STATSVALUE group by statistic ) 
as t2 

    on t1.statistic = t2.statistic and t1.orgtime = t2.orgtime

    UNION

    select tb1.statistic, tb1.devicename, tb1.value, tb1.timestamp
    from X_STATSVALUE as tb1 inner join 

    ( select statistic, max(orgtime) as orgtime from X_STATSVALUE  WHERE statistic+orgtime not in 
    (select t1.statistic+t1.orgtime from X_STATSVALUE as t1 inner join 
    ( select statistic, max(orgtime) as orgtime from X_STATSVALUE group by statistic ) 
as t2 on t1.statistic = t2.statistic and t1.orgtime = t2.orgtime
    ) group by statistic 
    ) 

    as tb2 on tb1.statistic = tb2.statistic and tb1.orgtime = tb2.orgtime 
```

# reverse-engineering - 您是否曾经使用过代码虚拟器或 vmprotect 来防止逆向工程？

> ID：354676
> 
> 赞同：16
> 
> 时间：2008-12-10T00:01:02.197
> 
> 标签：reverse-engineering, cracking

我知道没有办法完全保护我们的代码。我也知道，如果用户想要破解我们的应用程序，那么他或她就不会购买我们的应用程序。我也知道最好改进我们的应用程序......而不是害怕反破解技术。我也知道没有商业工具可以保护我们的应用程序……我也知道……

行。足够。我什么都听到了。我真的认为增加一点保护不会受到伤害。

所以....你曾经使用过 oreans 或 vmprotect 的代码虚拟化器吗？我听说它们有时会被某些防病毒软件检测为病毒。

在购买之前我应该​​知道的任何经验。我知道它创建了一些虚拟机并混淆了一些代码，以便更难发现我们注册程序的弱点。

有什么我应该知道的警告吗？

谢谢。任何意见，将不胜感激。

捷豹

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-04T11:48:30.697

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-10T10:01:09.257

不幸的是，受 VM 保护的软件比传统的打包软件更容易受到误报的影响。这样做的原因是，由于 AV 保护非常复杂，因此 AV 软件通常无法分析受保护的代码，并且可能依赖于模式库，或者可能对受其无法分析的系统保护的任何文件发出一般警告。如果您的首要任务是消除误报，我建议选择一种广泛使用的保护解决方案，例如 AsProtect（尽管 Oreans 的产品也变得非常流行）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-10T06:37:50.663

软件 VM 保护如今非常流行，尤其是现在小公司和独立软件开发人员可以以可承受的价格获得它。与非 VM 技术相比，破解也需要相当多的努力——包装器通常具有其他保护具有的标准反调试技巧，以及 VM 保护。由于虚拟机是在每次构建时随机生成的，因此破解者需要分析 VM 指令集并将受保护的代码反向工程回机器代码。

VM 保护的主要缺点是，如果它被过度使用（用于保护代码的过多部分），它会大大降低您的应用程序的速度——因此您只需要保护关键部分（注册检查等）。它也不适用于某些应用程序类型 - 它可能不适用于用于注入的 DLL 以及设备驱动程序。

我还听说 StrongBit EXECryptor 是一个不错的保护包，价格合理。（我不隶属于该公司，也不保证任何质量，这只是口耳相传，值得一试IMO）。

# vector - 使用 epsilon 值来确定游戏中的球是否不动？

> ID：354680
> 
> 赞同：3
> 
> 时间：2008-12-10T00:02:52.863
> 
> 标签：vector, physics, epsilon

我有球在四处弹跳，每次它们碰撞时，它们的速度矢量都会因恢复系数而减小。

现在我的球的 CoR 是 .80 。因此，在多次反弹后，我的球“停止”滚动，因为它们的速度变得非常小。

在哪个阶段检查速度值是否足够小以简单地将其称为零是合适的（所以我没有球对它们的微速度做出反应的疯狂抖动）。我之前在一些论坛上读过，人们有时会使用一个 epsilon 常数，一些很小的数字并检查它。

我是否应该定义一个 epsilon 常量并执行以下操作：

```
if Math.abs(velocity.x) < epsilon then velocity.x = 0 
```

每次我更新球的速度和位置？这是一般的做法吗？将它放在我的 x 和 y 的 Vector 类设置器中是否合理？或者当我计算速度时我应该在我的矢量类之外做它。

另外，如果我使用浮点数作为速度向量，那么合理的 epsilon 值是多少？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T00:23:54.397

epsilon 的合理值将取决于系统的约束。如果您以图形方式表示球，那么您的 epsilon 可能对应于每秒 0.1 像素的速度（确保您的停止概念与用户对屏幕对象停止的体验相匹配）。如果您正在进行物理模拟，您需要将其调整到您尝试测量系统的准确度。

至于您检查的频率 - 这也取决于。如果您正在实时模拟某些东西，那么额外的检查可能会很昂贵，并且您需要每 10 次更新或每秒检查一次或其他东西。或者性能可能不是问题，您可以检查每个更新。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T00:43:55.247

代替 IsStillMoving 函数的 epsilon，也许您可​​以使用 UpdatePosition 函数，根据其速度在逐个对象的基础上进行调度。

我会做这样的事情（在我自己的make-it-as-you-go伪代码中）：

```
void UpdatePosition(Ball b) {

   TimeStamp now = Clock.GetTime();
   float secondsSinceLastUpdate = now.TimeSince(b.LastUpdate).InSeconds;

   Point3D oldPosition = b.Position;
   Point3D newPosition = CalculatePosition(b.Position, b.Velocity, interval);
   b.MoveTo(newPosition);

   float epsilonOfAccuracy = 0.5; // Accurate to one half-pixel
   float pixelDistance = Camera.PixelDistance(oldPosition, newPosition);
   float fps = System.CurrentFramesPerSecond;
   float secondsToMoveOnePixel = (pixelDistance * secondsSinceLastUpdate) / fps;
   float nextUpdateInterval = secondsToMoveOnePixel / epsilonOfAccuracy;

   b.SetNextUpdateAt(now + nextUpdateInterval);
} 
```

快速移动的球会在每一帧上更新。移动较慢的球可能每五或十帧更新一次。已经停止（或几乎停止）的球只会很少更新。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T00:14:32.593

IMO 你的 epsilon 方法很好。我只是尝试看看游戏中的动画看起来或感觉自然。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T00:49:39.307

Epsilon 本质上是最小的增量。不幸的是，计算机有不同的“最小”增量，具体取决于浮点表示。我会非常小心（甚至可能比我为安全考虑的计算值更高）玩弄它，特别是如果我希望代码是可移植的。

您可能想要编写一个函数来计算浮点数的最小增量，而不是使用魔法值。

# lisp - 与项目 euler 72 (lisp) 有关的奇怪问题

> ID：354685
> 
> 赞同：5
> 
> 时间：2008-12-10T00:03:50.930
> 
> 标签：lisp, common-lisp

我认识到输出中有一个明显的模式，我只是想知道为什么当我尝试运行任何 > 52 的东西时 lispbox 的 REPL 会中止。此外，任何关于改进代码的建议都非常受欢迎。^-^

```
(defun count-reduced-fractions (n d sum)
  (setf g (gcd n d))
  (if (equal 1 d)
      (return-from count-reduced-fractions sum)
      (if (zerop n)
          (if (= 1 g)
              (count-reduced-fractions (1- d) (1- d) (1+ sum))
              (count-reduced-fractions (1- d) (1- d) sum))
          (if (= 1 g)
              (count-reduced-fractions (1- n) d (1+ sum))
              (count-reduced-fractions (1- n) d sum))))) 
```

我打电话时得到的一切

`(count-reduced-fractions 53 53 0)`

是

> ;评估中止

这对我来说没有多大意义，考虑到它会在低于此的所有数字上运行（并返回准确的结果），而且我可以（如果我愿意）在我的头脑中、纸上或一行上做 53一次在 lisp 中。我什至测试了许多大于 53 的不同数字，以确保它不是特定于 53。没有任何效果。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-10T00:21:53.403

此行为暗示缺少尾调用优化，因此您的递归会破坏堆栈。一个可能的原因是您声明了调试优化。

顺便说一句，您不需要显式调用`return-from`. 由于`sum`是自评估符号，您可以更改此行

```
(return-from count-reduced-fractions sum)
```

至

```
sum
```

*编辑：*建议更改的解释：“sum”评估为它自己的值，它成为“if”语句的返回值，它（因为这是 defun 中的最后一条语句）成为函数的返回值。

*编辑：*声明的优化说明：您可以将以下内容添加到顶层：

```
(declaim (optimize (speed 3)
                   (debug 0)))
```

或使用相同的，但使用`declare`而不是`declaim`作为函数中的第一条语句。如果不起作用，您也可以尝试 (space 3) 和 (safety 0)。

尾调用优化是指将直接返回返回值的函数调用翻译成栈上的帧替换（而不是堆叠起来），有效地将递归函数调用“扁平化”为循环，消除递归函数调用。这使调试变得更加困难，因为在您期望它们的地方没有函数调用。您不知道错误发生在递归中的“深度”程度（就像您从一开始就编写了一个循环一样）。您的环境可能会做出一些您必须覆盖以启用 TCO 的默认声明。

*编辑：*只是重新审视这个问题，什么是`g`？我认为你实际上想要

```
(let ((g (gcd n d)))
  ;; ...
  ) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-10T00:11:24.157

我的猜测是 lispbox 有一个内置的堆栈深度限制。由于 Common Lisp 不保证尾递归函数使用常量堆栈空间，因此每次调用 count-reduced-fractions 都可能在堆栈上添加另一层。

顺便说一句，SBCL 运行这个算法没有问题。

```
* (count-reduced-fractions 53 53 0)
881

* (count-reduced-fractions 100 100 0)
3043 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T00:15:44.773

作为风格问题，您可以将 d 和 sum 设为可选。

```
(defun test (n &optional (d n) (sum 0)) .. ) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T00:10:53.050

可能是堆栈溢出（呵呵）。

# java - 如何在java中评价一个连接四个游戏的情况

> ID：354689
> 
> 赞同：0
> 
> 时间：2008-12-10T00:05:34.107
> 
> 标签：java, artificial-intelligence, evaluation-function

我正在尝试为“获得四个”游戏编写一个简单的 AI。基本的游戏原理已经完成，所以我可以扔不同颜色的硬币，它们相互堆叠并填充一个 2D Array 等等。到目前为止，这是该方法的样子：

```
public int insert(int x, int color)  //0 = empty, 1=player1 2=player2" 
```

X 是水平坐标，因为 y 坐标取决于阵列中已经有多少石头，我认为这个想法很明显。

现在的问题是我必须对特定的游戏情况进行评分，因此找出在特定情况下我可以连续获得多少新对、三胞胎和可能的 4 个，然后为每种情况赋予特定值。有了这些值，我可以设置一个“游戏树”，然后决定下一步哪个动作最好（稍后实施 Alpha-Beta-Pruning）。我目前的问题是我想不出一种有效的方法来在 java 方法中实现对当前游戏情况的评级。
任何想法将不胜感激！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-10T00:27:10.147

我猜这是一个家庭作业，你的意思是你想写评估函数，不知道用什么技巧？

游戏英文叫“Connect 4”，所以你可以google一下“connect 4评估功能”。

你可以找到足够多的人讨论启发式。

请不要复制实际的源代码，这是一个重要的练习:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T10:04:52.230

Connect 4 的搜索空间不是很大。对于一个简单的实现，尽管运行需要一段时间（可能需要数十分钟），但执行极小极大搜索，直到有人获胜或游戏结束。指定 +1 或 -1 表示一名玩家或另一名玩家获胜，0 表示平局。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T18:33:11.703

胡说。搜索空间很大。如果你想这样做，你需要使用一个预定义的表。

# wpf - 通过 C# 在 WPF 中显示位图图像

> ID：354691
> 
> 赞同：1
> 
> 时间：2008-12-10T00:07:55.320
> 
> 标签：wpf, icons, bitmapimage

我想做的事情很简单，但我很难让它发挥作用。我看到了一些类似的帖子，但我仍然有疑问。

我有一个名为 mnuA 的 MenuItem 对象。我想要的只是在 C# 中以编程方式设置图标属性。我试过以下

a)`mnuA.Icon = new BitmapImage{UriSource = new Uri(@"c:\icons\A.png")};` 结果：我没有显示实际的图标，而是获得了类名 ( `System.Windows.Media.Imaging.BitmapImage`)

b）`mnuA.Icon = new BitmapImage(new Uri(@"c:\icons\A.png"));` 结果：我没有显示实际的图标，而是获得了图像的路径（`file:///c:/icons/A.png`）

我究竟做错了什么？对于这样简单的事情，我真的需要一个转换器类吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-10T00:42:28.790

试试这个：

```
Image img = new Image();
img.Source = new BitmapImage(new Uri(@"c:\icons\A.png"));
mnuA.Icon = img; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T00:43:42.940

可能是一个很长的镜头，但尝试类似：

> Uri u = 新的 Uri(...); mnuA.Icon = new BitmapImage(u);

它发生的事情似乎是您的图标正在转换为字符串。

# geolocation - 将多播传送到几个不同的地理位置

> ID：354695
> 
> 赞同：2
> 
> 时间：2008-12-10T00:12:09.773
> 
> 标签：geolocation, messaging, amqp, multicast, pgm-protocol

我需要在应用程序中使用一个基于逻辑 PGM 的多播地址，同时启用这样的应用程序“无缝”运行在几个不同的地理位置（例如美国/欧洲/澳大利亚）。

应用程序的吞吐量很大（每天有几百万条商业消息）和延迟要求很高，需要大量小但非常频繁地发送消息。由于某些外部延迟限制，Classic Atom pub 无法在此处工作。

我想出了几个连接这些数据中心的选项，但找不到最好的一个。我考虑过的选项是：1）通过VPN转发多播消息（VPN可以处理这么大的负载）。2) 将所有多播消息转换为“包装消息”并通过 AMQP 转发。3) 编写专门的内部网关，通过 TCP 将多播消息传送到其他两个位置。4）任何其他解决方案

我更喜欢选项 1，因为它不需要开发人员编写额外的代码。但恐怕它不会是可靠的连接。

申请此类连接是否有任何规则？

对于上述限制，关于地理配置的最佳网络配置是什么。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-29T21:12:55.173

只是想打个招呼:)

至于话题，我们在WAN上多播的经验不多，但是，我的感觉是PGM + WAN + 大量数据会导致重传风暴。VPN 不会让这个问题消失，因为*所有*澳大利亚的接收者在遇到丢失的数据包时都会将 NACKS 发送到欧洲等。

PGM 规范确实允许用于消息传递的节点的树结构，因此理论上您可以在接收端放置一个节点，然后在本地重新多播数据。但是，我不确定这种功能是否适用于 PGM 的 MS 实现。或者，您可以在接收端放置一个支持 PGM 的 Cisco 路由器来为您处理此问题。

在任何情况下，我的偏好是将数据转换为 TCP 流，通过 WAN 传递，然后将其转换回另一端的 PGM。必须编写一些代码，但不会出现令人讨厌的意外。

马丁·S。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-10T10:31:32.230

在 CohesiveFT，当我们设计“VPN-Cubed”产品以在一个 VPN 中将多个云连接到我们自己的防火墙后面的服务器时，我们遇到了一个非常相似的问题。我们希望能够运行使用多播相互通信的应用程序，但例如，Amazon EC2 不支持多播，原因应该是相当明显的，如果您考虑到整个数据中心的网络风暴的可能性。我们还希望使用互联网在广泛的节点联盟中路由流量。

无需过多详细介绍，该解决方案涉及将隧道与标准路由协议（如 BGP）和 VPN 的开放技术相结合。我们使用 RabbitMQ AMQP 以 pubsub 样式传递消息，而无需物理多播。这意味着您可以在广域子网上伪造多播，甚至跨域和防火墙，只要您位于 VPN-Cubed 安全港中。它之所以有效，是因为它是此处技术说明中所述的“网络覆盖”：[http ://blog.elasticserver.com/2008/12/vpn-cubed-technical-overview.html](http://blog.elasticserver.com/2008/12/vpn-cubed-technical-overview.html)

我并不打算真正为您提供具体的解决方案，但我确实希望这个答案能让您有信心尝试其中的一些方法。

干杯，亚历克西斯

# java - Java 在遍历大型目录时性能不佳是否有解决方法？

> ID：354703
> 
> 赞同：23
> 
> 时间：2008-12-10T00:14:34.510
> 
> 标签：java, performance, directory-walk

我正在尝试一次处理一个通过网络存储的文件。由于缓冲不是问题，因此读取文件很快。我遇到的问题只是列出文件夹中的目录。在许多文件夹中，每个文件夹至少有 10k 个文件。

性能超级慢，因为 File.list() 返回一个数组而不是一个可迭代的。Java 开始收集文件夹中的所有名称，并在返回之前将其打包到一个数组中。

这个错误条目是[http://bugs.sun.com/view_bug.do;jsessionid=db7fcf25bcce13541c4289edeb4?bug_id=4285834](http://bugs.sun.com/view_bug.do;jsessionid=db7fcf25bcce13541c4289edeb4?bug_id=4285834)并且没有解决方法。他们只是说这已为 JDK7 修复。

几个问题：

1.  有人有解决这个性能瓶颈的方法吗？
2.  我在努力实现不可能吗？即使它只是迭代目录，性能仍然会很差吗？
3.  我可以使用具有此功能的 beta JDK7 构建，而无需在其上构建我的整个项目吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-10T00:57:17.247

虽然它不是很漂亮，但我通过在启动我的应用程序之前将 dir/ls 的输出管道传输到文件并传入文件名来解决此类问题。

如果您需要在应用程序中执行此操作，您可以只使用 system.exec()，但这会产生一些麻烦。

您询问。第一种形式将非常快，第二种形式也应该很快。

确保每行执行一项（裸、无装饰、无图形）、完整路径和所选命令的递归选项。

编辑：

只需 30 分钟即可获得目录列表，哇。

令我震惊的是，如果您使用 exec()，您可以将其标准输出重定向到管道中，而不是将其写入文件。

如果您这样做了，您应该立即开始获取文件并能够在命令完成之前开始处理。

交互实际上可能会减慢速度，但也许不会——你可以试一试。

哇，我刚刚为您找到了 .exec 命令的语法并遇到了这个，可能正是您想要的（它使用 exec 和“ls”列出了一个目录并将结果通过管道传输到您的程序中进行处理）： [好链接在回程中](http://web.archive.org/web/20080912133319/http://java.sun.com/developer/JDCTechTips/2003/tt0304.html)（Jörg 在评论中提供了替换Oracle 打破的 Sun 的这个[）](http://java.sun.com/developer/JDCTechTips/2003/tt0304.html "这个断开的链接在这里")

无论如何，这个想法很简单，但正确编写代码很烦人。我会从互联网上窃取一些代码并破解它们--brb

```
/**
 * 注意：仅将此作为最后的手段！它特定于 Windows 甚至
 * 那不是一个好的解决方案，但它应该很快。
 *
 * 要使用它，扩展 FileProcessor 并使用列表调用 processFiles("...")
 * 选项，如果您希望它们像 /s... 我强烈推荐 /b
 *
 * 覆盖 processFile 并且它将为每一行输出调用一次。
 */
导入java.io.*；

公共抽象类 FileProcessor
{
   公共无效进程文件（字符串 dirOptions）
   {
      处理 theProcess = null;
      BufferedReader inStream = null;

      // 调用 Hello 类
      尝试
      {
          theProcess = Runtime.getRuntime().exec("cmd /c dir " + dirOptions);
      }
      捕获（IOException e）
      {
         System.err.println("exec() 方法出错");
         e.printStackTrace();  
      }

      // 从被调用程序的标准输出流中读取
      尝试
      {
         inStream = 新的 BufferedReader(
                                新的 InputStreamReader( theProcess.getInputStream() ));  
         processFile(inStream.readLine());
      }
      捕获（IOException e）
      {
         System.err.println("inStream.readLine() 出错");
         e.printStackTrace();  
      }

   } // 结束方法
   /** 覆盖这个方法——每个文件都会调用一次 */
   公共抽象无效进程文件（字符串文件名）；

} // 结束类

```

感谢[IBM的代码捐赠者](http://publib.boulder.ibm.com/infocenter/iseries/v5r3/index.jsp?topic=/rzaha/jvlngex1.htm "IBM")

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2013-10-22T14:20:45.590

如何使用 File.list(FilenameFilter filter) 方法并实现 FilenameFilter.accept(File dir, String name) 来处理每个文件并返回 false。

我在 Linux vm 上为包含 10K+ 个文件的目录运行了这个，它花费了不到 10 秒。

```
import java.io.File;  
import java.io.FilenameFilter;

public class Temp {
    private static void processFile(File dir, String name) {
        File file = new File(dir, name);
        System.out.println("processing file " + file.getName());
    }

    private static void forEachFile(File dir) {
        String [] ignore = dir.list(new FilenameFilter() {
            public boolean accept(File dir, String name) {
                processFile(dir, name);
                return false;
            }
        });
    }

    public static void main(String[] args) {
        long before, after;
        File dot = new File(".");
        before = System.currentTimeMillis();
        forEachFile(dot);
        after = System.currentTimeMillis();
        System.out.println("after call, delta is " + (after - before));
    }  
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-10T00:36:42.407

另一种方法是通过不同的协议提供文件。据我了解，您为此使用 SMB，而 java 只是试图将它们列为常规文件。

这里的问题可能不仅仅是java（当您使用Microsoft Explorer x:\shared 打开该目录时它的行为如何）根据我的经验，它也需要相当多的时间。

您可以将协议更改为 HTTP 之类的协议，仅用于获取文件名。这样，您可以通过 http 检索文件列表（10k 行不应太多）并让服务器处理文件列表。这将非常快，因为它将使用本地资源（服务器中的资源）运行

然后，当您拥有列表时，您可以完全按照您现在正在做的方式处理它们。

关键是在节点的另一边有一个辅助机制。

这可行吗？

今天：

```
File [] content = new File("X:\\remote\\dir").listFiles();

for ( File f : content ) {
    process( f );
} 
```

建议的：

```
String [] content = fetchViaHttpTheListNameOf("x:\\remote\\dir");

for ( String fileName : content ) {
    process( new File( fileName ) );
} 
```

http 服务器可能是一个非常小而简单的文件。

如果这是您现在拥有的方式，那么您正在做的是将所有 10k 文件信息获取到您的客户端计算机（我不知道该信息有多少），而您只需要文件名以供以后处理.

如果现在处理速度非常快，它可能会放慢一点。这是因为预取的信息不再可用。

试试看。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-10T00:22:43.370

一个不可移植的解决方案是对操作系统进行本地调用并流式传输结果。

**对于 Linux**

您可以查看类似[readdir](http://linux.die.net/man/3/readdir)的内容。您可以像链表一样遍历目录结构并批量或单独返回结果。

**对于 Windows**

[在 Windows 中，使用FindFirstFile](http://msdn.microsoft.com/en-us/library/aa364418(VS.85).aspx)和[FindNextFile](http://msdn.microsoft.com/en-us/library/aa364428(VS.85).aspx) api的行为将非常相似。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-10T08:49:35.593

我怀疑问题与您引用的错误报告有关。问题在于“仅”内存使用，但不一定是速度。如果您有足够的内存，则该错误与您的问题无关。

您应该衡量您的问题是否与内存有关。打开您的垃圾收集器日志并使用例如[gcviewer](http://www.tagtraum.com/gcviewer.html)来分析您的内存使用情况。

我怀疑它与导致问题的 SMB 协议有关。您可以尝试用另一种语言编写测试，看看它是否更快，或者您可以尝试通过其他方法获取文件名列表，例如在另一篇文章中描述的here。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-10T12:26:09.167

如果您最终需要处理所有文件，那么在 String[] 上使用 Iterable 不会给您带来任何优势，因为您仍然必须去获取整个文件列表。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-01-27T17:30:10.217

如果您使用的是 Java 1.5 或 1.6，则在 Windows 上输出“dir”命令并解析标准输出流是一种完全可以接受的方法。我过去曾使用这种方法来处理网络驱动器，它通常比等待本机 java.io.File listFiles() 方法返回要快得多。

当然，JNI 调用应该比使用“dir”命令更快并且可能更安全。以下 JNI 代码可用于使用 Windows API 检索文件/目录列表。该函数可以很容易地重构为一个新类，因此调用者可以增量检索文件路径（即一次获取一个路径）。例如，您可以重构代码，以便在构造函数中调用 FindFirstFileW，并使用单独的方法来调用 FindNextFileW。

```
JNIEXPORT jstring JNICALL Java_javaxt_io_File_GetFiles(JNIEnv *env, jclass, jstring directory)
{
    HANDLE hFind;
    try {

      //Convert jstring to wstring
        const jchar *_directory = env->GetStringChars(directory, 0);
        jsize x = env->GetStringLength(directory);
        wstring path;  //L"C:\\temp\\*";
        path.assign(_directory, _directory + x);
        env->ReleaseStringChars(directory, _directory);

        if (x<2){
            jclass exceptionClass = env->FindClass("java/lang/Exception");
            env->ThrowNew(exceptionClass, "Invalid path, less than 2 characters long.");
        }

        wstringstream ss;
        BOOL bContinue = TRUE;
        WIN32_FIND_DATAW data;
        hFind = FindFirstFileW(path.c_str(), &data);
        if (INVALID_HANDLE_VALUE == hFind){
            jclass exceptionClass = env->FindClass("java/lang/Exception");
            env->ThrowNew(exceptionClass, "FindFirstFileW returned invalid handle.");
        }

        //HANDLE hStdOut = GetStdHandle(STD_OUTPUT_HANDLE);
        //DWORD dwBytesWritten;

        // If we have no error, loop thru the files in this dir
        while (hFind && bContinue){

          /*
          //Debug Print Statment. DO NOT DELETE! cout and wcout do not print unicode correctly.
            WriteConsole(hStdOut, data.cFileName, (DWORD)_tcslen(data.cFileName), &dwBytesWritten, NULL);
            WriteConsole(hStdOut, L"\n", 1, &dwBytesWritten, NULL);
            */

          //Check if this entry is a directory
            if (data.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY){
                // Make sure this dir is not . or ..
                if (wstring(data.cFileName) != L"." &&
                    wstring(data.cFileName) != L"..")
                {   
                    ss << wstring(data.cFileName) << L"\\" << L"\n";
                }
            }
            else{
                ss << wstring(data.cFileName) << L"\n";
            }
            bContinue = FindNextFileW(hFind, &data);
        }   
        FindClose(hFind); // Free the dir structure

        wstring cstr = ss.str();
        int len = cstr.size();
        //WriteConsole(hStdOut, cstr.c_str(), len, &dwBytesWritten, NULL);
        //WriteConsole(hStdOut, L"\n", 1, &dwBytesWritten, NULL);
        jchar* raw = new jchar[len];
        memcpy(raw, cstr.c_str(), len*sizeof(wchar_t));
        jstring result = env->NewString(raw, len);
        delete[] raw;
        return result;
    }
    catch(...){
        FindClose(hFind);
        jclass exceptionClass = env->FindClass("java/lang/Exception");
        env->ThrowNew(exceptionClass, "Exception occured.");
    }

    return NULL;
} 
```

信用： [https ://sites.google.com/site/jozsefbekes/Home/windows-programming/miscellaneous-functions](https://sites.google.com/site/jozsefbekes/Home/windows-programming/miscellaneous-functions)

即使采用这种方法，仍然可以提高效率。如果将路径序列化为 java.io.File，则会对性能造成巨大影响——尤其是当路径表示网络驱动器上的文件时。我不知道 Sun/Oracle 在幕后做了什么，但如果您需要文件路径以外的其他文件属性（例如大小、mod 日期等），我发现以下 JNI 函数比实例化 java 快得多.io.File 对象在网络上的路径。

```
JNIEXPORT jlongArray JNICALL Java_javaxt_io_File_GetFileAttributesEx(JNIEnv *env, jclass, jstring filename)
{   

  //Convert jstring to wstring
    const jchar *_filename = env->GetStringChars(filename, 0);
    jsize len = env->GetStringLength(filename);
    wstring path;
    path.assign(_filename, _filename + len);
    env->ReleaseStringChars(filename, _filename);

  //Get attributes
    WIN32_FILE_ATTRIBUTE_DATA fileAttrs;
    BOOL result = GetFileAttributesExW(path.c_str(), GetFileExInfoStandard, &fileAttrs);
    if (!result) {
        jclass exceptionClass = env->FindClass("java/lang/Exception");
        env->ThrowNew(exceptionClass, "Exception Occurred");
    }

  //Create an array to store the WIN32_FILE_ATTRIBUTE_DATA
    jlong buffer[6];
    buffer[0] = fileAttrs.dwFileAttributes;
    buffer[1] = date2int(fileAttrs.ftCreationTime);
    buffer[2] = date2int(fileAttrs.ftLastAccessTime);
    buffer[3] = date2int(fileAttrs.ftLastWriteTime);
    buffer[4] = fileAttrs.nFileSizeHigh;
    buffer[5] = fileAttrs.nFileSizeLow;

    jlongArray jLongArray = env->NewLongArray(6);
    env->SetLongArrayRegion(jLongArray, 0, 6, buffer);
    return jLongArray;
} 
```

[您可以在javaxt-core](http://www.javaxt.com/)库中找到这种基于 JNI 方法的完整工作示例。在我使用 Java 1.6.0_38 和 Windows 主机访问 Windows 共享的测试中，我发现这种 JNI 方法比调用 java.io.File listFiles() 或使用“dir”命令快大约 10 倍。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-10T12:18:16.267

我想知道为什么一个目录中有 10k 个文件。一些文件系统不能很好地处理这么多文件。文件系统有特定的限制，例如每个目录的最大文件数量和子目录的最大级别数量。

我用迭代器解决方案解决了类似的问题。

我需要递归遍历巨大的目录和几级目录树。

我尝试了 Apache commons io 的 FileUtils.iterateFiles()。但它通过将所有文件添加到 List 中然后返回 List.iterator() 来实现迭代器。这对记忆非常不利。

所以我更喜欢这样写：

```
private static class SequentialIterator implements Iterator<File> {
    private DirectoryStack dir = null;
    private File current = null;
    private long limit;
    private FileFilter filter = null;

    public SequentialIterator(String path, long limit, FileFilter ff) {
        current = new File(path);
        this.limit = limit;
        filter = ff;
        dir = DirectoryStack.getNewStack(current);
    }

    public boolean hasNext() {
        while(walkOver());
        return isMore && (limit > count || limit < 0) && dir.getCurrent() != null;
    }

    private long count = 0;

    public File next() {
        File aux = dir.getCurrent();
        dir.advancePostition();
        count++;
        return aux;
    }

    private boolean walkOver() {
        if (dir.isOutOfDirListRange()) {
            if (dir.isCantGoParent()) {
                isMore = false;
                return false;
            } else {
                dir.goToParent();
                dir.advancePostition();
                return true;
            }
        } else {
            if (dir.isCurrentDirectory()) {
                if (dir.isDirectoryEmpty()) {
                    dir.advancePostition();
                } else {
                    dir.goIntoDir();
                }
                return true;
            } else {
                if (filter.accept(dir.getCurrent())) {
                    return false;
                } else {
                    dir.advancePostition();
                    return true;
                }
            }
        }
    }

    private boolean isMore = true;

    public void remove() {
        throw new UnsupportedOperationException();
    }

} 
```

请注意，迭代器会停止迭代的文件数量，并且它也有一个 FileFilter。

DirectoryStack 是：

```
public class DirectoryStack {
    private class Element{
        private File files[] = null;
        private int currentPointer;
        public Element(File current) {
            currentPointer = 0;
            if (current.exists()) {
                if(current.isDirectory()){
                    files = current.listFiles();
                    Set<File> set = new TreeSet<File>();
                    for (int i = 0; i < files.length; i++) {
                        File file = files[i];
                        set.add(file);
                    }
                    set.toArray(files);
                }else{
                    throw new IllegalArgumentException("File current must be directory");
                }
            } else {
                throw new IllegalArgumentException("File current not exist");
            }

        }
        public String toString(){
            return "current="+getCurrent().toString();
        }
        public int getCurrentPointer() {
            return currentPointer;
        }
        public void setCurrentPointer(int currentPointer) {
            this.currentPointer = currentPointer;
        }
        public File[] getFiles() {
            return files;
        }
        public File getCurrent(){
            File ret = null;
            try{
                ret = getFiles()[getCurrentPointer()];
            }catch (Exception e){
            }
            return ret;
        }
        public boolean isDirectoryEmpty(){
            return !(getFiles().length>0);
        }
        public Element advancePointer(){
            setCurrentPointer(getCurrentPointer()+1);
            return this;
        }
    }
    private DirectoryStack(File first){
        getStack().push(new Element(first));
    }
    public static DirectoryStack getNewStack(File first){
        return new DirectoryStack(first);
    }
    public String toString(){
        String ret = "stack:\n";
        int i = 0;
        for (Element elem : stack) {
            ret += "nivel " + i++ + elem.toString()+"\n";
        }
        return ret;
    }
    private Stack<Element> stack=null;
    private Stack<Element> getStack(){
        if(stack==null){
            stack = new Stack<Element>();
        }
        return stack;
    }
    public File getCurrent(){
        return getStack().peek().getCurrent();
    }
    public boolean isDirectoryEmpty(){
        return getStack().peek().isDirectoryEmpty();
    }
    public DirectoryStack downLevel(){
        getStack().pop();
        return this;
    }
    public DirectoryStack goToParent(){
        return downLevel();
    }
    public DirectoryStack goIntoDir(){
        return upLevel();
    }
    public DirectoryStack upLevel(){
        if(isCurrentNotNull())
            getStack().push(new Element(getCurrent()));
        return this;
    }
    public DirectoryStack advancePostition(){
        getStack().peek().advancePointer();
        return this;
    }
    public File[] peekDirectory(){
        return getStack().peek().getFiles();
    }
    public boolean isLastFileOfDirectory(){
        return getStack().peek().getFiles().length <= getStack().peek().getCurrentPointer();
    }
    public boolean gotMoreLevels() {
        return getStack().size()>0;
    }
    public boolean gotMoreInCurrentLevel() {
        return getStack().peek().getFiles().length > getStack().peek().getCurrentPointer()+1;
    }
    public boolean isRoot() {
        return !(getStack().size()>1);
    }
    public boolean isCurrentNotNull() {
        if(!getStack().isEmpty()){
            int currentPointer = getStack().peek().getCurrentPointer();
            int maxFiles = getStack().peek().getFiles().length;
            return currentPointer < maxFiles;
        }else{
            return false;
        }
    }
    public boolean isCurrentDirectory() {
        return getStack().peek().getCurrent().isDirectory();
    }
    public boolean isLastFromDirList() {
        return getStack().peek().getCurrentPointer() == (getStack().peek().getFiles().length-1);
    }
    public boolean isCantGoParent() {
        return !(getStack().size()>1);
    }
    public boolean isOutOfDirListRange() {
        return getStack().peek().getFiles().length <= getStack().peek().getCurrentPointer();
    }

} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-01T07:56:31.117

使用 Iterable 并不意味着文件将流式传输给您。事实上，它通常是相反的。因此，数组通常比 Iterable 更快。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-01T08:06:41.153

您确定这是由于 Java 造成的，而不仅仅是一个目录中有 10k 个条目的一般问题，尤其是在网络上？

您是否尝试过使用 win32 findfirst/findnext 函数编写一个概念验证程序以在 C 中执行相同的操作，以查看它是否更快？

我不知道 SMB 的来龙去脉，但我强烈怀疑列表中的每个文件都需要往返 - 这不会很快，尤其是在具有中等延迟的网络上。

在一个数组中有 10k 个字符串听起来也不应该对现代 Java VM 征税太多。

# wpf - AdornerDecorator 和制表位问题

> ID：354717
> 
> 赞同：3
> 
> 时间：2008-12-10T00:20:33.720
> 
> 标签：wpf, validation, xaml, tabstop, adornerdecorator

我正在使用 IDataErrorInfo 来验证和指示文本框中的错误。我发现我必须为文本框和 adornerdecorator 标记一次。

我有一个错误模板：

```
<ControlTemplate x:Key="ErrorTemplate">
        <StackPanel KeyboardNavigation.IsTabStop="False" >
        <Border KeyboardNavigation.IsTabStop="False"  BorderBrush="Red" BorderThickness="1" Padding="2" CornerRadius="2">
            <AdornedElementPlaceholder KeyboardNavigation.IsTabStop="False" />
        </Border>
        </StackPanel>                
    </ControlTemplate> 
```

一个文本框模板：

```
<Style x:Key="TextBoxInError" TargetType="{x:Type TextBox}">
        <Setter Property="KeyboardNavigation.TabNavigation" Value="None"/>
        <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
        <Setter Property="Margin" Value="0,5,0,5"/>
        <Setter Property="AllowDrop" Value="true"/>
        <Setter Property="HorizontalContentAlignment" Value="left"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type TextBox}">
                    <Grid  KeyboardNavigation.IsTabStop="False" >
                        <Border  KeyboardNavigation.IsTabStop="False" x:Name="Border" Background="{DynamicResource WindowBackgroundBrush}" BorderBrush="{DynamicResource SolidBorderBrush}" BorderThickness="1" Padding="2" CornerRadius="2">
                            <ScrollViewer IsTabStop="False" Margin="0" x:Name="PART_ContentHost" Style="{DynamicResource SimpleScrollViewer}" Background="{TemplateBinding Background}"/>
                        </Border>
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="Validation.HasError" Value="true">
                            <Setter Property="ToolTip" Value="{Binding RelativeSource={RelativeSource Self}, Path=(Validation.Errors), Converter={StaticResource errorConverter}}"/>
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="false">
                            <Setter Property="Foreground" Value="Gray"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style> 
```

并声明一个这样的文本框：

```
<AdornerDecorator  KeyboardNavigation.IsTabStop="False" >
<TextBox Margin="5,5,5,3" x:Name="txtName" IsEnabled="{Binding EditMode}" Validation.ErrorTemplate="{StaticResource ErrorTemplate}"
 Text="{Binding ApplicationName, Mode=TwoWay, ValidatesOnExceptions=True, NotifyOnValidationError=True, ValidatesOnDataErrors=True}" 
 Height="25" MaxLength="50" MaxLines="1" Style="{StaticResource TextBoxInError}"/>
 </AdornerDecorator> 
```

如果装饰器是上面的一个文本框，那么我点击一次以离开文本框，一次离开“装饰”（似乎）然后盒子必须依次返回所有“装饰品”。当在装饰中切换时，焦点位于控件模板中定义的红色边框上。

有任何想法吗？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-10T08:39:42.773

将此添加到窗口的资源部分：

```
<Style TargetType="{x:Type Control}">
    <Setter Property="Focusable" Value="False"/>
</Style> 
```

有关更多信息，请查看我的博客：[http ://www.nbdtech.com/blog/archive/2008/05/25/WPF-Problems-with-Keyboard-Focus-When-Using-Validation.aspx](http://www.nbdtech.com/blog/archive/2008/05/25/WPF-Problems-with-Keyboard-Focus-When-Using-Validation.aspx)

# javascript - 使用 JavaScript 或 jQuery 检测哪个表单输入具有焦点

> ID：354718
> 
> 赞同：31
> 
> 时间：2008-12-10T00:21:07.307
> 
> 标签：javascript, jquery, focus, forms

您如何使用 JavaScript 或 jQuery 检测哪个表单输入具有焦点？

从一个函数中，我希望能够确定哪个表单输入具有焦点。我希望能够在直接的 JavaScript 和/或 jQuery 中做到这一点。

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2010-12-15T22:02:13.187

`document.activeElement`，它在IE中已经支持很久了，最新版本的FF和chrome也支持它。如果没有焦点，则返回`document.body`对象。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-10T01:36:26.530

我不确定这是否是最有效的方法，但您可以尝试：

```
var selectedInput = null;
$(function() {
    $('input, textarea, select').focus(function() {
        selectedInput = this;
    }).blur(function(){
        selectedInput = null;
    });
}); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-10T00:49:49.713

如果您只想在获得焦点时更改特定表单字段的 CSS，您可以使用 CSS ":focus" 选择器。为了与不支持此功能的 IE6 兼容，您可以使用[IE7](http://dean.edwards.name/IE7/)库。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-08-30T16:55:09.793

Otherwise, you could use the onfocus and onblur events.

something like:

```
<input type="text" onfocus="txtfocus=1" onblur="txtfocus=0" /> 
```

and then have something like this in your javascript

```
if (txtfocus==1)
{
//Whatever code you want to run
}

if (txtfocus==0)
{
//Something else here
} 
```

But that would just be my way of doing it, and it might not be extremely practical if you have, say 10 inputs :)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-22T03:07:38.167

I would do it this way: I used a function that would return a 1 if the ID of the element it was sent was one that would trigger my event, and all others would return a 0, and the "if" statement would then just fall-through and not do anything:

```
function getSender(field) {
    switch (field.id) {
        case "someID":
        case "someOtherID":
            return 1;
        break;
        default:
            return 0;
    }
}

function doSomething(elem) {
    if (getSender(elem) == 1) {
       // do your stuff
    }
  /*  else {
       // do something else
    }  */
} 
```

HTML Markup:

```
<input id="someID" onfocus="doSomething(this)" />
<input id="someOtherID" onfocus="doSomething(this)" />
<input id="someOtherGodForsakenID" onfocus="doSomething(this)" /> 
```

The first two will do the event in doSomething, the last one won't (or will do the else clause if uncommented).

-Tom

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-07-31T18:46:45.373

Here's a solution for text/password/textarea (not sure if I forgot others that can get focus, but they could be easily added by modifying the if clauses... an improvement could be made on the design by putting the if's body in it's own function to determine suitable inputs that can get focus).

Assuming that you can rely on the user sporting a browser that is not pre-historic (http://www.caniuse.com/#feat=dataset):

```
 <script>
        //The selector to get the text/password/textarea input that has focus is: jQuery('[data-selected=true]')
        jQuery(document).ready(function() {
            jQuery('body').bind({'focusin': function(Event){
                var Target = jQuery(Event.target);
                if(Target.is(':text')||Target.is(':password')||Target.is('textarea'))
                {
                    Target.attr('data-selected', 'true');
                }
            }, 'focusout': function(Event){
                var Target = jQuery(Event.target);
                if(Target.is(':text')||Target.is(':password')||Target.is('textarea'))
                {
                    Target.attr('data-selected', 'false');
                }
            }});
        });
    </script> 
```

For pre-historic browsers, you can use the uglier:

```
 <script>
        //The selector to get the text/password/textarea input that has focus is: jQuery('[name='+jQuery('body').data('Selected_input')+']')
        jQuery(document).ready(function() {
            jQuery('body').bind({'focusin': function(Event){
                var Target = jQuery(Event.target);
                if(Target.is(':text')||Target.is(':password')||target.is('textarea'))
                {
                    jQuery('body').data('Selected_input', Target.attr('name'));
                }
            }, 'focusout': function(Event){
                var Target = jQuery(Event.target);
                if(Target.is(':text')||Target.is(':password')||target.is('textarea'))
                {
                    jQuery('body').data('Selected_input', null);
                }
            }});
        });
    </script> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-03-21T02:44:02.390

尝试

```
window.getSelection().getRangeAt(0).startContainer 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-03-26T13:47:56.580

You only need one listener if you use event bubbling (and bind it to the document); one per form is reasonable, though:

```
var selectedInput = null;
$(function() {
    $('form').on('focus', 'input, textarea, select', function() {
        selectedInput = this;
     }).on('blur', 'input, textarea, select', function() {
        selectedInput = null;
    });
}); 
```

(Maybe you should move the selectedInput variable to the form.)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-06-18T13:44:16.093

You can use this

```
<input type="text" onfocus="myFunction()"> 
```

It triggers the function when the input is focused.

# sql - SQL Server rand() 聚合

> ID：354723
> 
> 赞同：1
> 
> 时间：2008-12-10T00:22:52.747
> 
> 标签：sql, sql-server, geo

**问题：**坐标纬度/经度表。两行可能具有相同的坐标。我们想要一个返回一组具有唯一坐标的行（在返回的集合内）的查询。请注意，这`distinct`是不可用的，因为我需要返回根据定义不同的 id 列。这种作品（`@maxcount`是我们需要的行数，`intid`是唯一的 int id 列）：

```
select top (@maxcount) max(intid)
from Documents d
group by d.geoLng, d.geoLat 
```

不幸的是，对于给定的坐标，它总是会返回同一行，这对我的使用来说有点遗憾。如果我们有一个`rand()`可以使用的聚合来代替`max()`......请注意，您不能使用`max()`由`newid()`.

有任何想法吗？（这里有更多背景知识，如果您有兴趣：[http](http://www.itu.dk/~friism/blog/?p=121) ://www.itu.dk/~friism/blog/?p=121 ）

更新：[这里的完整解决方案](http://www.itu.dk/~friism/blog/?p=213)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T02:42:54.460

您可能可以通过 ROW_NUMBER 函数在 lat 和 long 中使用 CTE，然后对它使用 rand()。就像是：

```
WITH cte AS
(
    SELECT
        intID,
        ROW_NUMBER() OVER
            (
                PARTITION BY geoLat, geoLng
                ORDER BY NEWID()
            ) AS row_num,
        COUNT(intID) OVER (PARTITION BY geoLat, geoLng) AS TotalCount
    FROM
        dbo.Documents
)
SELECT TOP (@maxcount)
    intID, RAND(intID)
FROM
    cte
WHERE
    row_num = 1 + FLOOR(RAND() * TotalCount) 
```

这将始终返回第一组 lat 和 lngs，我无法使顺序随机。也许有人可以继续使用这种方法。不过，它会在匹配的 lat 和 lng 组合中为您提供一个随机行。

如果以后有更多时间，我会尝试绕过最后一个障碍。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T11:29:50.530

这对你不起作用？

```
select top (@maxcount) *
from 
(
    select max(intid) as id from Documents d group by d.geoLng, d.geoLat
) t 
order by newid() 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T00:30:41.327

您从哪里得到 DISTINCT 仅适用于一列的想法？无论如何，您也可以使用 GROUP BY 子句。

# regex - 需要在此 Reg Ex 中测试“\\”（反斜杠）

> ID：354724
> 
> 赞同：0
> 
> 时间：2008-12-10T00:23:09.937
> 
> 标签：regex

目前我使用这个reg ex：

```
"\bI([ ]{1,2})([a-zA-Z]|\d){2,13}\b" 
```

刚刚引起我注意的是，我使用它的文本可能包含“ `\`”（反斜杠）。如何将其添加到表达式中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T00:26:56.233

`|\\`在组内添加，`\d`例如之后。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T00:36:16.277

如果您还允许在第二个捕获寄存器中使用下划线字符，并且您愿意使用元字符，则可以简化此表达式。这改变了这一点：

```
([a-zA-Z]|\d){2,13} 
```

进入这个...

```
([\w]{2,13}) 
```

你也可以用这个添加一个反斜杠字符的测试......

```
([\w\x5c]{2,13}) 
```

根据您的个人喜好，这使得正则表达式更容易吸引眼球。

```
"\bI([\x20]{1,2})([\w\x5c]{2,13})\b" 
```

也可以看看：

*   [WP元字符](http://en.wikipedia.org/wiki/Regular_expression#POSIX_Basic_Regular_Expressions)
*   [元字符](http://www.regular-expressions.info/quickstart.html)
*   [速记字符类](http://www.regular-expressions.info/charclass.html#shorthand)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T01:37:31.300

@slavy13 和 @dreftymac 都为您提供了带有指针的基本解决方案，但是......

*   您可以`\d`在字符类中使用来表示数字。
*   您不需要将空白放入字符类中以匹配它（为了清楚起见，可能除外，尽管这值得商榷）。
*   您可以`[:alpha:]`在字符类中使用来表示字母字符、`[:digit:]`数字和`[:alnum:]`字母数字（特别是不包括下划线，与 不同`\w`）。请注意，这些字符类可能意味着比您预期的更多的字符；想想重音字符和非阿拉伯数字，尤其是在 Unicode 中。
*   如果要捕获空格后的全部信息，则需要在捕获括号内进行重复。

对比这两个单行代码的行为：

```
perl -n -e 'print "$2\n" if m/\bI( {1,2})([a-zA-Z\d\\]){2,13}\b/'

perl -n -e 'print "$2\n" if m/\bI( {1,2})([a-zA-Z\d\\]{2,13})\b/' 
```

给定输入行“ `I a123`”，第一个打印“3”，第二个打印“a123”。显然，如果您想要的只是字符串第二部分的最后一个字符，那么原始表达式就可以了。但是，这不太可能是要求。（显然，如果您只对全部内容感兴趣，那么使用 ' `$&`' 会为您提供匹配的文本，但它会对效率产生负面影响。）

我可能会使用这个正则表达式，因为它对我来说似乎最清楚：

```
m/\bI( {1,2})([[:alnum:]\\]{2,13})\b/ 
```

是时候强制插入了：阅读 Jeff Friedl 的“[掌握正则表达式](http://oreilly.com/catalog/9780596002893/index.html)”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T04:44:25.137

正如我在对 slavy 帖子的评论中指出的那样，`\\`->`\b`作为反斜杠不是单词字符。所以我的建议是

```
/\bI([ ]{1,2})([\p{IsAlnum}\\]{2,13})(?:[^\w\\]|$)/ 
```

我假设你想捕捉整个 2-13 个字符，而不仅仅是第一个适用的字符，所以我调整了我的 RE。

如果引擎支持并且您不想使用它，您可以将最后一次捕获设为*前瞻。*那看起来像：

```
/\bI([ ]{1,2})([\p{IsAlnum}\\]{2,13})(?=[^\w\\]|$)/ 
```

# wcf - 在 WCF Web 编程模型中，如何编写带有一组查询字符串参数（即同名）的操作协定？

> ID：354727
> 
> 赞同：13
> 
> 时间：2008-12-10T00:24:23.507
> 
> 标签：wcf, web-services, rest, contract, operation-contract

使用 WCF Web 编程模型，可以像这样指定操作协定：

```
[OperationContract]
[WebGet(ResponseFormat = WebMessageFormat.Xml, UriTemplate = "SomeRequest?qs1={qs1}&qs2={qs2}")]
XElement SomeRequest1(string qs1, string qs2); 
```

现在，如果我们必须创建一个接受具有相同名称的参数数组的合约（在本例中**为 qs1**），合约就像这样......

```
[OperationContract]
[WebGet(ResponseFormat = WebMessageFormat.Xml, UriTemplate = "SomeRequest?qs1={qs1}&qs1={qs2}")]
 XElement SomeRequest2(string qs1, string qs2); 
```

当我们调用该方法时，我们会在运行时收到错误消息：

> 查询字符串必须具有具有唯一名称的“名称=值”对。请注意，名称不区分大小写。有关更多详细信息，请参阅 UriTemplate 的文档。

如何定义一个 HTTP 服务来公开具有一组参数的资源，而不使用松散的接口？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-12-10T01:21:01.350

我已经实现了一个简单的自定义 QueryStringConverter 以便您可以将 qs1 设为 string[] 然后将查询字符串变量以逗号分隔（例如[http://server/service/SomeRequest?qs1=val1,val2,val3,val4](http://server/service/SomeRequest?qs1=val1,val2,val3,val4)）

```
[OperationContract]
[WebGet(ResponseFormat = WebMessageFormat.Xml,
        UriTemplate = "SomeRequest?qs1={qs1}")]
XElement SomeRequest2(string[] qs1); 
```

首先，您需要一个继承自 WebHttpBehavior 的类，以便我们可以注入我们的自定义 QueryStringConverter：

```
public class CustomHttpBehavior : System.ServiceModel.Description.WebHttpBehavior
{
    protected override System.ServiceModel.Dispatcher.QueryStringConverter GetQueryStringConverter(System.ServiceModel.Description.OperationDescription operationDescription)
    {
        return new CustomQueryStringConverter();
    }
} 
```

然后是处理 string[] 参数的 CustomQueryStringConverter：

```
public class CustomQueryStringConverter : System.ServiceModel.Dispatcher.QueryStringConverter
{
    public override bool CanConvert(Type type)
    {
        if (type == typeof(string[]))
        {
            return true;
        }

        return base.CanConvert(type);
    }

    public override object ConvertStringToValue(string parameter, Type parameterType)
    {
        if (parameterType == typeof(string[]))
        {
            string[] parms = parameter.Split(',');
            return parms;
        }

        return base.ConvertStringToValue(parameter, parameterType);
    }

    public override string ConvertValueToString(object parameter, Type parameterType)
    {
        if (parameterType == typeof(string[]))
        {
            string valstring = string.Join(",", parameter as string[]);
            return valstring;
        }

        return base.ConvertValueToString(parameter, parameterType);
    }
} 
```

您需要做的最后一件事是创建行为配置扩展，以便运行时可以获取 CustomWebHttpBehavior 的实例：

```
public class CustomHttpBehaviorExtensionElement : System.ServiceModel.Configuration.BehaviorExtensionElement
{
    protected override object CreateBehavior()
    {
        return new CustomHttpBehavior();
    }

    public override Type BehaviorType
    {
        get { return typeof(CustomHttpBehavior); }
    }
} 
```

现在我们将元素添加到我们的配置扩展中，以便使用我们的 CustomWebHttpBehavior，我们使用该扩展的名称而不是`<webHttp />`我们的行为：

```
 <system.serviceModel>
   <services>
     <service name="NameSpace.ServiceClass">
       <endpoint address="" behaviorConfiguration="MyServiceBehavior"
        binding="webHttpBinding" contract="NameSpace.ServiceClass" />
     </service>
   </services>
  <behaviors>
   <endpointBehaviors>
    <behavior name="MyServiceBehavior">
      <customWebHttp/>
    </behavior>
   </endpointBehaviors>
  </behaviors>
  <extensions>
    <behaviorExtensions>
      <add name="customWebHttp" type="NameSpace.CustomHttpBehaviorExtensionElement, MyAssemblyName" />
    </behaviorExtensions>
  </extensions>
  <serviceHostingEnvironment aspNetCompatibilityEnabled="true" />
 </system.serviceModel> 
```

您现在还可以扩展您的 CustomQueryStringConverter 以处理默认类型不处理的其他类型，例如可为空的值类型。

注意：在 microsoft connect 中记录了一个与此代码直接相关的错误。在您尝试查询转换不同类型的几乎所有情况下，该代码实际上并不适用。

[http://connect.microsoft.com/VisualStudio/feedback/details/616486/bug-with-getquerystringconverter-not-being-called-by-webservicehost#tabs](http://connect.microsoft.com/VisualStudio/feedback/details/616486/bug-with-getquerystringconverter-not-being-called-by-webservicehost#tabs)

请确保在浪费时间创建无法正常工作的自定义 REST 查询字符串转换器之前仔细阅读此内容。（适用于 Framework 4.0 及以下版本）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-10T23:12:24.230

要回复您对我的其他答案的评论：

您可以在查询字符串的末尾执行通配符参数，例如

```
[WebGet(ResponseFormat = WebMessageFormat.Xml,
        UriTemplate = "SomeRequest?qs1={*qs1}")]
XElement SomeRequest2(string qs1); 
```

这样 qs1 字符串参数将是 qs1= 之后的整个原始查询字符串，然后您可以在代码中手动解析它。

QueryStringConverter 依赖于查询字符串的格式，因此如果不重写 QueryStringConverter 而不是我们在另一个答案中所做的小覆盖，就不可能完全按照您的意愿做事。

来自 MSDN：

通配符段必须遵循以下规则：

*   每个模板字符串最多可以有一个命名通配符段。
*   命名通配符段必须出现在路径的最右侧段。
*   命名通配符段不能与同一模板字符串中的匿名通配符段共存。
*   命名通配符段的名称必须是唯一的。
*   命名通配符段不能有默认值。
*   命名通配符段不能以“/”结尾。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-24T10:02:57.543

请注意，在 WCF 3.5 中，您必须在以下位置指定完整的限定程序集名称：

```
 <extensions>
    <behaviorExtensions>
      <add name="customWebHttp" type="NameSpace.CustomHttpBehaviorExtensionElement, MyAssemblyName, NOT SUFFICIENT HERE" />
    </behaviorExtensions>
  </extensions> 
```

就像这样：SampleService.CustomBehavior，SampleService，**Version=1.0.0.0，Culture=neutral，PublicKeyToken=null**

否则你会得到异常：

> 配置错误
> 描述：处理服务此请求所需的配置文件期间发生错误。请查看下面的具体错误详细信息并适当地修改您的配置文件。
> 
> 解析器错误消息：配置中的元素无效。扩展名“CustomWebHttp”未在 system.serviceModel/extensions/behaviorExtensions 的集合中注册。

# c# - C# 中的标记云

> ID：354738
> 
> 赞同：15
> 
> 时间：2008-12-10T00:34:12.943
> 
> 标签：c#, tag-cloud

我正在制作一个小型**C#**应用程序，并想从简单的纯文本中提取**标签云。**有没有可以为我做到这一点的功能？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-10T00:54:27.457

在我看来，构建标签云是一个两部分的过程：

首先，您需要拆分并计算您的代币。根据文档的结构以及编写的语言，这可能就像计算空格分隔的单词一样简单。然而，这是一种非常幼稚的方法，因为像 the、of、a 等这样的词将具有最大的字数，并且作为标签不是很有用。我建议实施某种单词黑名单，以排除最常见和无意义的标签。

以 (tag, count) 方式获得结果后，您可以使用类似于以下代码的内容：

（Searches 是 SearchRecordEntity 的列表，SearchRecordEntity 保存标签及其计数，SearchTagElement 是 SearchRecordEntity 的具有 TagCategory 属性的子类，ProcessedTags 是保存结果的 SearchTagElements 列表）

```
double max = Searches.Max(x => (double)x.Count);
List<SearchTagElement> processedTags = new List<SearchTagElement>();

foreach (SearchRecordEntity sd in Searches)
{
    var element = new SearchTagElement();                    

    double count = (double)sd.Count;
    double percent = (count / max) * 100;                    

    if (percent < 20)
    {
        element.TagCategory = "smallestTag";
    }
    else if (percent < 40)
    {
        element.TagCategory = "smallTag";
    }
    else if (percent < 60)
    {
        element.TagCategory = "mediumTag";
    }
    else if (percent < 80)
    {
        element.TagCategory = "largeTag";
    }
    else
    {
        element.TagCategory = "largestTag";
    }

    processedTags.Add(element);
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-06-10T12:10:07.447

我真的会推荐使用[http://thetagcloud.codeplex.com/](http://thetagcloud.codeplex.com/)。这是一个非常干净的实现，负责标签的分组、计数和渲染。它还提供过滤功能。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-02-08T14:03:58.867

看看[http://sourcecodecloud.codeplex.com/](http://sourcecodecloud.codeplex.com/) ![在此处输入图像描述](https://i.stack.imgur.com/nwHME.png)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-10T00:47:24.990

这是一个[ASP.NET Cloud 控件](http://www.codeproject.com/KB/aspnet/cloud.aspx)，它至少可以帮助您入门，包括完整的源代码。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-10T01:21:51.207

你可能想看看[WordCloud](http://www.codeproject.com/KB/recipes/wordcloud.aspx)，CodeProject 上的一个项目。它包括 430 个停止词（如`the`、`an`、`a`等）并使用 Porter 词干算法，该算法将词减少到它们的词根，以便“词干词干”都被视为同一词的 1 次出现。

这一切都在 C# 中 - 你唯一需要做的就是修改它以输出 HTML 而不是它创建的可视化。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-08-21T11:21:58.853

看看这个。它对我有用。示例文件夹下有一个名为 WebExample 的项目，可以帮助您解决此问题。 [https://github.com/chrisdavies/Sparc.TagCloud](https://github.com/chrisdavies/Sparc.TagCloud)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-06-19T12:18:21.520

看看这个算法的答案：

[实现类似 Wordle 的词云的算法](https://stackoverflow.com/questions/342687/algorithm-to-implement-a-word-cloud-like-wordle)

答案中提到的“DisOrganizer”可以满足您的目的。稍作改动，您就可以让这个“Disorganizer”以您想要的方式提供图像。PS：代码是用C#写的[https://github.com/chandru9279/zasz.me/blob/master/zasz.me/](https://github.com/chandru9279/zasz.me/blob/master/zasz.me/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-10T01:17:48.127

您可以在某种集合或数据库表中存储一个类别及其拥有的项目数量。

从中，您可以获得某个类别的计数并具有一定的界限。所以你的参数是类别，你的返回值是一个计数。

因此，如果计数 >10 & <20，则将 .CSS 样式应用于具有一定大小的链接。

您可以将这些计数作为键存储在集合中，然后获取键与您的返回值匹配的值（如上所述）。

我手头没有这个过程的源代码，但是你也找不到一个简单的函数来为你做这一切。一个控件，是的（如上所述）。

这是一种非常传统的方法，也是我在杂志教程等中看到的标准方法，也是我想到的第一种方法（不一定是最好的）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-10T00:44:01.207

我不确定这是否正是您要寻找的，但它可能会帮助您入门：

计算词频的 LINQ（在 VB 中，但我现在正在转换为 C#）

```
Dim Words = "Hello World ))))) This is a test Hello World"
Dim CountTheWords = From str In Words.Split(" ") _
                    Where Char.IsLetter(str) _
                    Group By str Into Count() 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2012-06-13T19:52:42.893

从给定源（文本文件和其他源）中提取关键字并将 TagCloud 显示为缩放用户界面 (ZUI) 的可缩放[标签云生成器](http://www.tansharp.com/tag-cloud.aspx)

# html - 为什么要在 HTML 中使用容器 div？

> ID：354739
> 
> 赞同：78
> 
> 时间：2008-12-10T00:34:27.467
> 
> 标签：html, css

我注意到一种常见的技术是将通用容器 div 放在 body 标记的根目录中：

```
<html>
  <head>
    ...
  </head>
  <body>
    <div id="container">
      ...
    </div>
  </body>
</html> 
```

这样做有正当理由吗？为什么css不能只引用body标签？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-12-10T00:40:29.980

容器 div，有时是内容 div，几乎总是用于允许更复杂的 CSS 样式。body 标签在某些方面是特殊的。浏览器不会把它当作一个普通的 div；它的位置和尺寸与浏览器窗口相关联。

但是容器 div 只是一个 div，您可以使用边距和边框对其进行样式设置。你可以给它一个固定的宽度，你可以用`margin-left: auto; margin-right: auto`.

另外，内容，例如版权声明，可以放在容器 div 的外部，但不能放在 body 的外部，允许内容位于边界的外部。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-10T00:38:19.797

此方法使您可以更灵活地设置整个内容的样式。有效地创建两个您可以设置样式的容器。用作背景的 HTML Body 标记，以及包含您的内容的容器 id 的 div。

然后，这允许您在页面内定位您的内容，同时设置背景或其他效果的样式而不会出现问题。将其视为内容的“框架”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-01-30T14:03:24.350

我知道这是一个老问题，但我自己重新设计网站时遇到了这个问题。特洛伊达尔马索让我思考。他提出了一个很好的观点。所以，我开始看看我是否可以在没有容器 div 的情况下让它工作。

当我设置身体的宽度时，我可以。在我的情况下为 960px。

这是我使用的 CSS：

```
html {
  text-align:center;
}

body {
  margin: 0 auto;
  width: 960px;
} 
```

这很好地将具有固定宽度的内联块居中。

希望这对任何人都有用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-10T00:44:42.703

对我来说最常见的原因是：

1.  布局可以有固定宽度（是的，我知道，我为喜欢固定宽度的设计师做了很多工作），并且
2.  所以布局可以通过应用 text-align: center 到 body 然后 margin: auto 到容器 div 的左边和右边来居中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-06-17T21:44:57.767

某些浏览器（<cough> Internet Explorer）不支持 body 的某些属性，尤其`width`是`max-width`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-06-17T21:30:55.007

这是前端编码人员犯下的最大坏习惯之一。

我上面的所有答案都是错误的。正文确实需要宽度、边距、边框等，并且应该充当您的初始容器。html 元素应按预期充当您的背景“画布”。在我做过的几十个网站中，我只需要使用一次容器 div。

我愿意让这些使用容器 div 的相同编码人员也在 div 内的 div 中乱扔他们的标记——在其他任何地方。

不要这样做。谨慎使用 div 并以精益标记为目标。

-=-=- 更新 - 不确定 SO 有什么问题，因为我可以从 5 年前编辑这个答案，但我无法回复评论，因为它说我需要 50 Rep 才能这样做。因此，我将在此处收到的回复中添加我的答案。-=-=-

在我回答多年后，我才发现这一点，并看到有一些后续回复。而且，你肯定是在开玩笑吧？

您为我的域找到的已安装占位符站点，我从未声称是我的标记或样式，甚至在我的帖子中提到过，它显然是一个基本的 CMS 安装，没有一个字的内容（它在主页上说了这么多）。那不是我的标记和样式。那是 Silverstripe 的默认模板。我不相信它。不过，这可能是我能想到的需要容器 div 的仅有的两个示例之一。

示例 1：设计用于容纳未知数的通用模板。在这种情况下，您会看到一个默认的 CMS 模板，该模板在 div 中包含 div 在 div 中。

惊恐的事件。

示例 2：使页脚正确清除的三列布局（我认为这可能是我需要一个容器 div 的场景，因为那是几年前的事，所以很难记住。）

我刚刚为我的域构建（甚至还没有完成）一个主题并开始加载内容。对于这个易于实现的语义标记示例，请单击链接。

[http://www.bitbeyond.com](http://www.bitbeyond.com)

坦率地说，我很困惑人们认为你实际上需要一个容器 div 并从一个容器 div 开始，甚至在尝试只是一个身体之前。主体，正如我听说 CSS 规范的原始作者之一曾经解释过的那样，旨在作为“初始容器”。

应根据需要添加标记，而不是因为这只是您所看到的方式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-09-16T21:35:23.157

div 标签用于设置网页样式，使其在视觉上吸引网站的用户或观众。在 html 中使用 container-div 将使网站看起来更专业和有吸引力，因此更多的人会想要浏览您的页面。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-09-28T08:44:38.787

出色地，

容器 div 非常好，因为如果您希望站点居中，您不能仅使用 body 或 html 来实现...但是您可以使用 div。为什么是容器？它通常被使用，只是因为代码本身必须是干净和可读的。这就是容器......它包含所有网站，以防你想弄乱它:)

祝你好运

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2017-02-04T20:41:14.547

大多数浏览器默认采用网页大小。因此，有时页面在不同的浏览器中显示的效果不同。因此，通过使用用户可以更改特定的 HTML 元素。例如，用户可以添加特定 HTML 标签的边距、大小、宽度、高度等。

# java - JAVA Swing GUI Components howto RTL view？

> ID：354745
> 
> 赞同：6
> 
> 时间：2008-12-10T00:37:42.903
> 
> 标签：java, swing, right-to-left

如何从 NetBeans 桌面应用程序为阿拉伯语制作我的 Java Swing GUI 组件 [从右到左]？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-10T01:17:11.233

难道你只需要使用：

```
Component.setComponentOrientation( ComponentOrientation.RIGHT_TO_LEFT ) 
```

我相信swing组件都已经支持RTL了，不是吗？

不过，不确定您将如何/在哪里对 netbeans 执行此操作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-10T17:58:42.210

的呼唤

```
 Component.setComponentOrientation( ComponentOrientation.RIGHT_TO_LEFT ) 
```

应该做的伎俩。但请务必在布局中使用 SwingConstants LEADING 和 TRAILING 而不是 LEFT 和 RIGHT。GridBagConstraints.LINE_START 或 LINE_END 而不是 WEST 或 EAST 也是如此，可能还有一些我忘记提及的类似情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T00:51:51.767

您可以使用对齐，但如果您的文本中嵌入了英文字母或数字，则无法处理复杂性。

最好使用某种样式的文本小部件，甚至是嵌入式 HTML/富文本查看器。

我不认为标准的 JLabels 可以处理复杂性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-08-10T08:42:26.640

如果您在 contentPane 内的面板中有组件，则可以使用它

```
 Component[] component = contentPane.getComponents();
    for(int i=0; i<component.length; i++){
        component[i].applyComponentOrientation(ComponentOrientation.RIGHT_TO_LEFT);
        Component[] cp = ((Container) component[i]).getComponents();
        for(int j=0; j<cp.length; j++){
            try{
                ((Component) ((JComboBox) cp[j]).getRenderer()).applyComponentOrientation(ComponentOrientation.RIGHT_TO_LEFT);
            }catch(Exception e){
                continue;

            }
        }
    } 
```

# python - 如何获取在 Django 中引用特定外键的记录数？

> ID：354755
> 
> 赞同：2
> 
> 时间：2008-12-10T00:43:29.383
> 
> 标签：python, django, django-models

我正在 Django 中开发一个博客应用程序。当然，我已经建立了模型，因此有帖子和评论，并且特定的帖子可能有很多评论；因此， Post 是 Comments 模型中的 ForeignKey。

给定一个 Post 对象，是否有一种简单的方法（理想情况下，通过方法调用）来找出有多少评论属于该 Post？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-10T00:49:16.623

```
Comments.objects.filter(post=post).count() 
```

或者：

```
post.comment_set.count() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T09:47:32.920

您可以将字段 CommentCount 添加到您的 Post 模型，并在 pre_save、pre_delete 信号中更新它。数据库很难在每次视图调用时计算评论数，并且查询的数量会增加。

# mysql - 常见的 MySQL 字段及其适当的数据类型

> ID：354763
> 
> 赞同：119
> 
> 时间：2008-12-10T00:48:19.730
> 
> 标签：mysql, database, types

我正在建立一个非常小的 MySQL 数据库，用于存储名字、姓氏、电子邮件和电话号码，并且正在努力为每个字段找到“完美”的数据类型。我知道没有完美的答案，但对于这些常用字段必须有某种通用约定。例如，我已经确定一个未格式化的美国电话号码太大而无法存储为 unsigned int，它必须至少是一个 bigint。

因为我确信其他人可能会觉得这很有用，所以我不想将我的问题仅限于我上面提到的领域。

哪些数据类型适用于常见的数据库字段？电话号码、电子邮件和地址等字段？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-12-10T00:57:35.423

有人会发布比这更好的答案，但只是想说明我个人永远不会在任何整数字段中存储电话号码，主要是因为：

1.  你不需要用它做任何算术运算，并且
2.  迟早有人会尝试（做类似的事情）在他们的区号周围加上括号。

但总的来说，我似乎几乎只使用：

*   INT(11) 表示任何 ID 或引用另一个 ID
*   时间戳的 DATETIME
*   VARCHAR(255) 用于保证少于 255 个字符的任何内容（页面标题、名称等）
*   几乎所有其他内容的文本。

当然也有例外，但我发现这涵盖了大多数可能性。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2009-12-28T23:40:58.780

以下是我使用的一些常见数据类型（虽然我不是专业人士）：

```
| Column           | Data type     | Note
| ---------------- | ------------- | -------------------------------------
| id               | INTEGER       | AUTO_INCREMENT, UNSIGNED                                                          |  
| uuid             | CHAR(36)      | or CHAR(16) binary                                                                |  
| title            | VARCHAR(255)  |                                                                                   |  
| full name        | VARCHAR(70)   |                                                                                   |  
| gender           | TINYINT       | UNSIGNED                                                                          |  
| description      | TINYTEXT      | often may not be enough, use TEXT 
                                     instead          
| post body        | TEXT          |                                                                                   |  
| email            | VARCHAR(255)  |                                                                                   |  
| url              | VARCHAR(2083) | MySQL version < 5.0.3 - use TEXT                                                  |  
| salt             | CHAR(x)       | randomly generated string, usually of 
                                     fixed length (x)    
| digest (md5)     | CHAR(32)      |                                                                                   |  
| phone number     | VARCHAR(20)   |                                                                                   |  
| US zip code      | CHAR(5)       | Use CHAR(10) if you store extended 
                                     codes      
| US/Canada p.code | CHAR(6)       |                                                                                   |  
| file path        | VARCHAR(255)  |                                                                                   |  
| 5-star rating    | DECIMAL(3,2)  | UNSIGNED                                                                          |  
| price            | DECIMAL(10,2) | UNSIGNED                                                                          |  
| date (creation)  | DATE/DATETIME | usually displayed as initial date of 
                                     a post                                       |  
| date (tracking)  | TIMESTAMP     | can be used for tracking changes in a 
                                     post                                        |  
| tags, categories | TINYTEXT      | comma separated values *                                                          |  
| status           | TINYINT(1)    | 1 – published, 0 – unpublished, … You 
                                     can also use ENUM for human-readable 
                                     values
| json data        | JSON          | or LONGTEXT 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-12-10T01:01:54.977

根据我的经验，名字/姓氏字段应至少包含 48 个字符——有些国家（如马来西亚或印度）的完整名称很长。

您应该**始终**将电话号码和邮政编码视为文本，而不是数字。给出的正常原因是邮政编码以 0 开头，在某些国家/地区，电话号码也可以以 0 开头。但真正的原因是它们不是*数字*——它们是碰巧组成的*标识符*数字（这忽略了加拿大等邮政编码中有字母的国家）。因此，将它们存储在文本字段中。

在 MySQL 中，您可以将 VARCHAR 字段用于此类信息。虽然这听起来很懒惰，但这意味着您不必太在意正确的最小尺寸。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-12-10T01:08:17.147

由于您要处理可变长度的数据（姓名、电子邮件地址），因此您可能希望使用 VARCHAR。VARCHAR 字段占用的空间量为`[field length]`+ 1 个字节，最大长度为 255，因此我不会太担心试图找到一个完美的大小。看看您想象的最长长度可能是什么，然后将其加倍并将其设置为您的 VARCHAR 限制。那就是说……：

我通常将电子邮件字段设置为 VARCHAR(100) - 我还没有提出问题。我设置为 VARCHAR(50) 的名称。

正如其他人所说，电话号码和邮政编码实际上不是数值，它们是包含数字 0-9（有时更多！）的字符串，因此您应该将它们视为字符串。VARCHAR(20) 应该足够了。

请注意，如果您要将电话号码存储为整数，许多系统会假定以 0 开头的数字是八进制（以 8 为基数）数字！因此，完全有效的电话号码“0731602412”将作为十进制数字“124192010”放入您的数据库！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-02-26T05:13:07.990

我正在做同样的事情，这就是我所做的。

我为姓名、地址、电子邮件和号码使用了单独的表，每个表都有一个 NameID 列，该列是除 Name 表之外的所有内容的外键，它是主聚集键。我使用 MainName 和 FirstName 而不是 LastName 和 FirstName 来允许业务条目和个人条目，但您可能不需要这样做。

NameID 列在所有表中都是一个 smallint，因为我相当确定我不会输入超过 32000 个条目。几乎所有其他内容都是 varchar(n)，范围从 20 到 200，具体取决于您要存储的内容（生日、评论、电子邮件、非常长的名字）。这真的取决于你存储什么样的东西。

数字表是我偏离的地方。我将它设置为有五个列，分别标记为 NameID、Phone#、CountryCode、Extension 和 PhoneType。我已经讨论过 NameID。Phone# 是 varchar(12)，其检查约束如下所示： CHECK (Phone# like '[0-9][0-9][0-9]-[0-9][0-9][0 -9]-[0-9][0-9][0-9][0-9]')。这样可以确保只有我想要的内容才能进入数据库并且数据保持非常一致。我将扩展名和国家/地区代码称为可为空的 smallint，但如果您愿意，它们也可以是 varchar。PhoneType 是 varchar(20) 并且不能为空。

希望这可以帮助！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-02-13T18:37:03.247

### 任何表 ID

用途：`INT(11)`。

[MySQL 索引](https://dev.mysql.com/doc/refman/8.0/en/create-index.html)将能够以最快的速度解析 int 列表。

### 任何安全

使用：`BINARY(x)`或`BLOB(x)`。

您可以将安全令牌等以十六进制形式直接存储在 BINARY(x) 或 BLOB(x) 中。要从`binary`-type 中检索，请使用`SELECT HEX(field)...`或`SELECT ... WHERE field = UNHEX("ABCD....")`。

### 任何日期

使用：`DATETIME`、`DATE`或`TIME`。

`DATETIME`如果您需要同时存储日期和时间（而不是一对字段），请始终使用，因为`DATETIME`索引更适合 MySQL 中的日期比较。

### 任何真假

使用：（`BIT(1)`仅限 MySQL 8。）否则，使用`BOOLEAN(1)`.

`BOOLEAN`实际上只是 的别名`TINYINT(1)`，它实际上存储了 0 到 255（不完全是真/假，是吗？）。

### 任何你想调用 `SUM()`、`MAX()` 或类似函数的东西

用途：`INT(11)`。

VARCHAR 或其他类型的字段不适用于`SUM()`等函数。

### 超过 1,000 个字符

用途：文本。

最大限制为 65,535。

### 超过 65,535 个字符

用途：中文本。

最大限制为 16,777,215。

### 超过 16,777,215 个字符

用途：长文本。

最大限制为 4,294,967,295。

### 名字，姓氏

使用：`VARCHAR(255)`。

UTF-8 字符可以占用每个可见字符三个字符，并且某些文化不区分名字和姓氏。*此外，文化可能对哪个名字是第一个*和哪个名字是*最后一个*存在分歧。您应该将这些字段命名`Person.GivenName`为`Person.FamilyName`.

### 电子邮件地址

使用：`VARCHAR(256)`。

电子邮件路径的定义是在 1982 年的[RFC821中设置的。电子邮件的最大限制是在 2001 年的](https://www.rfc-editor.org/rfc/rfc821)[RFC2821](https://www.rfc-editor.org/rfc/rfc5321)中设置的，而这些限制在 2008 年的 RFC5321 中保持不变[。](https://www.rfc-editor.org/rfc/rfc2821)（参见第 4.5.3.1 节。大小限制和最小值。） 2004 年发布的[RFC3696](https://www.rfc-editor.org/rfc/rfc3696)错误地将电子邮件地址限制引用为字符，但这是一个“仅限信息”的 RFC，根据其介绍明确“定义无标准”，因此请忽略它。`320`

### 电话

用途：`VARCHAR(255)`。

您永远不知道电话号码何时会以“1800...”、“1-800”或“1-(800)”的形式出现，或者以“ext. 42”或“问苏珊”。

### 邮政编码

用途：`VARCHAR(10)`。

您将获得类似`12345`或的数据`12345-6789`。使用验证来清理此输入。

### 网址

用途：`VARCHAR(2000)`。

官方标准支持的 URL 比这长得多，但很少有现代浏览器支持 URL 超过 2,000 个字符。请参阅[此答案：不同浏览器中 URL 的最大长度是多少？](https://stackoverflow.com/a/417184/2430549)

### 价格

用途：`DECIMAL(11,2)`。

它上升到11。

# .net - 使用异常处理应用程序块将异常记录到数据库的示例 sql

> ID：354764
> 
> 赞同：0
> 
> 时间：2008-12-10T00:48:36.877
> 
> 标签：.net, sql, sql-server, logging, enterprise-library

任何人都可以提供（或指向我）使用企业库异常处理应用程序块（EHAB）记录异常的示例 sql 代码吗？即，我希望结构和过程的标准 CREATE TABLE 和 CREATE PROCEDURE 语句将记录的异常存储在 SQL Server 数据库中。

此外，任何人都可以描述应用程序块如何调用过程 [WriteLogStoredProcedureName] 和 [AddCategoryStoredProcedureName] （例如，它们应该具有哪些参数以及它们是如何设置的）或文档在哪里？

（注意：我使用的是 Enterprise Library 3.1 - 2007 年 5 月，因为我使用的是 .net 2.0）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-23T12:27:19.990

[WriteLogStoredProcedureName] 的默认值为“WriteLog”。[addCategoryStoredProcName] 的默认值为“AddCategory”。

安装 Enterprise Library，您将获得脚本“C:\EntLib3Src\App Blocks\Src\Logging\TraceListeners\Database\Scripts\LoggingDatabase.sql”。执行此脚本后，您将准备好“记录”数据库，其中包含所有必需的存储过程和表。

# html - 创建用于编辑电子邮件模板的 html 所见即所得编辑器

> ID：354769
> 
> 赞同：15
> 
> 时间：2008-12-10T00:49:48.247
> 
> 标签：html, email, wysiwyg

我正在开发的（基于网络的）软件需要一种让用户能够自定义电子邮件模板的方法。

我熟悉 TinyMCE 等人。基于网络的所见即所得编辑器。然而，他们努力生成有效的 (x)html 标记，并大量使用样式表。所有这些都不会在电子邮件客户端中很好地呈现（是的，我在看着你……outlook 2007）。

有人知道可以配置为生成电子邮件友好的html吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T01:05:34.610

你可以看看 livepipe [http://livepipe.net/control](http://livepipe.net/control)

该页面中的 TextArea 选项卡有一个非常简单的所见即所得编辑器，可能适合您的需要。它基于 javascript 并使用 Prototype 框架。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T02:10:28.567

您可能想查看[fckeditor](http://www.fckeditor.net/)，因为它支持模板。您可以创建几个电子邮件友好的模板，并让用户从其中一个开始。

# asp.net - 什么会使回调请求挂起？

> ID：354774
> 
> 赞同：2
> 
> 时间：2008-12-10T00:53:40.377
> 
> 标签：asp.net, asp.net-ajax, ajaxcontroltoolkit

我正在开发一个使用 asp.net ajax 控制工具包的项目，我所有的回调请求都挂起，直到请求超时。当我单步执行代码时，我的所有代码都会执行，然后就会发生挂起。现在我正在寻找可能发生这种情况的可能原因。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T01:55:18.863

如果请求花费大量时间，则客户端 AJAX 请求可能在您的服务器端代码完成之前超时。此时客户端已断开连接，服务器无法再与其通信。您是否可以考虑将客户端的超时值增加到非常大的值以消除这种可能性？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T01:03:08.843

防火墙还是NAT？网络上的某些东西可能会阻止回电给您。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T01:58:50.727

检查您提供的回调地址是否对服务器有效。例如，服务器可能无法翻译某些主机名或 DNS 条目。

# c# - 我在哪里可以找到一个好的示例 ASP.NET 数据库驱动的 Web 应用程序？

> ID：354775
> 
> 赞同：9
> 
> 时间：2008-12-10T00:53:54.807
> 
> 标签：c#, asp.net, database

我想学习在创建数据库驱动的 Web 应用程序时采用的最佳实践。我更喜欢从例子中学习。什么是一个很好的示例应用程序，我可以下载并运行它来学习：

我在寻找：

1.  应该用 C# 编写（最好）
2.  应包含复杂的数据库设计（父子关系等）
3.  应该为 ASP.net 网站以及数据库设计实施最佳实践。
4.  最好使用Oracle。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-10T01:25:56.130

如果您不想担心编写[DAL](http://en.wikipedia.org/wiki/Data_access_layer)（数据访问层），那么我建议您查看[Nhibernate](http://www.nhibernate.org)。[这里](http://www.beansoftware.com/asp.net-tutorials/nhibernate-log4net.aspx)、[这里](http://www.hibernate.org/363.html)和[这里](https://stackoverflow.com/questions/259409/database-and-orm-choice-for-an-small-medium-size-net-application#259551)都有它和 ASP.NET 的示例。这是一个[仅包含 Oracle](http://www.oracle.com/technology/tech/windows/odpnet/index.html)和 ASP.NET 的示例。

如果您正在寻找没有像 NHibernate 这样的对象关系映射器的示例 ASP.NET 应用程序，请试试[这个](http://www.asp.net/Learn/data-access/)。

此外，在更高层次上，您正在寻找[N 层 ASP.NET 应用程序设计](http://www.developerfusion.com/article/3058/boosting-your-net-application-performance/2/)。[这里](http://www.c-sharpcorner.com/UploadFile/tavanover/NTierDevelopmentWithNetP311282005073236AM/NTierDevelopmentWithNetP3.aspx)、[这里](http://www.developerfusion.com/article/3058/boosting-your-net-application-performance/2/)和[这里](http://msdn.microsoft.com/en-us/library/ms978384.aspx)都有很好的教程。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-12T13:13:48.030

[ASP.NET Starter](http://www.asp.net/community/projects/) Kits中有很多示例。我真的很喜欢[BlogEngine.NET](http://www.asp.net/downloads/starter-kits/blog-engine/)应用程序。对于高端基础知识（嗯......“高端基础知识”......矛盾？）[BeerHouse E-Commerce 应用程序](http://www.asp.net/downloads/starter-kits/the-beer-house/)很棒。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T01:01:07.943

对于 1 到 3，我建议下载一些 ASP.NET 入门工具包。我不确定他们是否与 Oracle 合作。

一些更大的框架也是很好的开始，比如 DotNetNuke。他们充分利用了最佳实践。

[http://www.asp.net/community/projects/](http://www.asp.net/community/projects/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-10T01:06:28.900

对于 Oracle，使用 System.Data.OracleClient 查找示例。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T01:45:56.137

用我的 iPhone 写这个，非常抱歉。

查看 rob conrey 的 MVC 店面视频和源代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-07-16T02:10:51.207

在我看来，最佳实践将规定以下内容：

1.  为您的数据访问层使用 ORM。理想情况下，这应该在一个单独的项目中，以便可以根据需要进行更改。
2.  应该使用 MVC。如果您使用 WebForms，那么您肯定会发现您的业务逻辑和显示逻辑混合在一起。
3.  与学习编写代码分开学习数据库设计。
4.  继续回顾面向对象的设计基础。
5.  Take time to learn design patterns. Not to become a slave to "The Gang of Four" but so that you can take advantage of proven patterns to solve common problems.

# .net - 使用 ObjectDataSource 或 SqlDataSource 时在 ASP.Net 中使用 DetailsView

> ID：354782
> 
> 赞同：0
> 
> 时间：2008-12-10T00:58:42.847
> 
> 标签：.net, asp.net, database, dataview

如何在 Asp.NET 中使用 DetailsView 控件？

1.  您如何将标签更改为数据库字段名称以外的名称？
2.  您如何对用户隐藏某些字段？（您需要查询，因为它们是身份字段 - row-id，您不希望用户看到）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T01:02:13.510

您将需要配置控件的设置，看看[这个 DetailVIew 示例](http://www.dotnetjohn.com/articles.aspx?articleid=158)，它显示了如何将项目设置为只读等。

# c# - 如何在 Windows Mobile 设备中访问 SMS 消息

> ID：354792
> 
> 赞同：2
> 
> 时间：2008-12-10T01:03:56.423
> 
> 标签：c#, windows-mobile, compact-framework, embedded, pocketpc

我正在寻找一个代码，该代码将允许访问存储在带有 Windows Mobile 的 Pocket PC 设备中的 SMS 消息，以便我可以将它们下载/备份到 Windows PC。

任何人都知道如何做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T01:08:43.357

您可以先查看[文档](http://msdn.microsoft.com/en-us/library/ms839381.aspx)，了解如何构建支持 SMS 的应用程序来为您公开 API。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T01:13:43.860

你需要使用 COM，代码不是很短，但是有人为它写了一个包装器

[http://www.codeproject.com/KB/mobile/PocketPCandSmartphone.aspx](http://www.codeproject.com/KB/mobile/PocketPCandSmartphone.aspx)

[http://sourceforge.net/projects/mapidotnet](http://sourceforge.net/projects/mapidotnet)

或者，如果您有预算 [http://inthehand.com/content/Mobile.aspx](http://inthehand.com/content/Mobile.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-12T14:18:27.447

从来没有玩过它，但程序集 Microsoft.WindowsMo​​bile.PocketOutlook.dll 包含类 SmsAccount 和 SmsMessage。看看[这个文档](http://msdn.microsoft.com/en-us/library/microsoft.windowsmobile.pocketoutlook.aspx)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-12T14:22:20.933

查看这个命名空间：[Microsoft.WindowsMo​​bile.PocketOutlook.MessageInterception](http://msdn.microsoft.com/en-us/library/microsoft.windowsmobile.pocketoutlook.messageinterception.aspx)

关注 MessageInterceptor 类及其 MessageReceived 事件。MessageCondition 也是。

# c# - DetailsView 和父子表 - 插入行

> ID：354794
> 
> 赞同：1
> 
> 时间：2008-12-10T01:05:30.913
> 
> 标签：c#, .net, database, binding

当您有父子表并且您希望使用 DetailsView 来编辑数据时，您如何使用 SqlDataSource 来做到这一点？

例如，如果您有一个 Person 和一个 Employee 表（其中一个员工是子表，而 Person 是父表 - 一个员工派生自一个人）。人员 P_ID 名字 姓氏 DOB 员工 E_ID P_ID EmployeedID 职务 HireDate

*   SQL 语句返回雇员的所有信息（名字和姓氏、出生日期、雇员ID、职务、雇用日期）。
*   用户应该能够使用单个 DetailsView 来编辑和插入员工，而不是 2 DetailsView（一个用于 Person，另一个用于员工）
*   插入时，应先创建人员记录，然后创建分配给员工的ID）

那么如何做到这一点呢？1\. 使用 SQLDataSource 2\. 使用 DataSet

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-12T08:24:24.223

这是否回答了您的问题：http: [//msdn.microsoft.com/en-us/library/aa581796.aspx](http://msdn.microsoft.com/en-us/library/aa581796.aspx)？

# eclipse - 从 Eclipse 中的 asyncExec 中获取返回值的最佳方法是什么？

> ID：354796
> 
> 赞同：7
> 
> 时间：2008-12-10T01:05:56.437
> 
> 标签：eclipse, eclipse-plugin, anonymous-class

我正在编写 Eclipse 插件，并且经常遇到正在运行的 Job 需要暂停片刻，在 UI 线程上异步运行某些东西，然后恢复的情况。

所以我的代码通常看起来像：

```
Display display = Display.getDefault();
display.syncExec(new Runnable() {
    public void run() {
                // Do some calculation
                // How do I return a value from here?
    }
});
// I want to be able to use the calculation result here! 
```

一种方法是让整个 Job 类都有一些字段。另一个是使用自定义类（而不是匿名的，并使用其结果数据字段等。最好和最优雅的方法是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-10T04:34:58.120

我认为上面的 Container 是“正确”的选择。它也可以被泛化以实现类型安全。在这种情况下的快速选择是最终的数组习语。诀窍是从 Runnable 引用的任何局部变量都必须是最终的，因此不能修改。因此，您可以使用单元素数组，其中数组是最终的，但可以修改数组的元素：

```
final Object[] result = new Object[1];
Display display = Display.getDefault();
display.syncExec(new Runnable()
{
  public void run()
  {
    result[0] = "foo";
  }
}
System.out.println(result[0]); 
```

同样，对于那些您有一个匿名类并且您希望在不定义特定 Container 类的情况下给它一个放置结果的地方的情况，这是“快速”的解决方案。

**更新** 在我考虑了一下之后，我意识到这对于回调在同一个线程中的侦听器和访问者类型的使用效果很好。但是，在这种情况下，Runnable 在不同的线程中执行，因此不能保证您在 syncExec 返回后实际看到结果。正确的解决方案是使用 AtomicReference：

```
final AtomicReference<Object> result = new AtomicReference<Object>();
Display display = Display.getDefault();
display.syncExec(new Runnable()
{
  public void run()
  {
    result.set("foo");
  }
}
System.out.println(result.get()); 
```

保证对 AtomicReference 值的更改对所有线程都是可见的，就像它被声明为 volatile 一样。这在[此处](http://java.sun.com/javase/6/docs/api/java/util/concurrent/atomic/package-summary.html)进行了详细描述。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-10T14:17:06.150

您可能不应该假设异步`Runnable`将在`asyncExec`调用返回时完成。

在这种情况下，您正在考虑将结果推送到侦听器/回调中（可能是命令模式），或者如果您确实希望稍后在相同的方法中使用结果，使用类似`java.util.concurrent.Future`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T03:55:50.150

好吧，如果它是同步的，那么您可以在该方法之外拥有某种类型的值持有者`run()`。

经典的是：

```
final Container container = new Container();
Display display = Display.getDefault();
display.syncExec(new Runnable()
{
  public void run()
  {
    container.setValue("foo");
  }
}
System.out.println(container.getValue()); 
```

容器只是：

```
public class Container {
  private Object value;
  public Object getValue() {
    return value;
  }
  public void setValue(Object o) {
    value = o;
  }
} 
```

这当然是搞笑和狡猾的（更狡猾的是创建一个新的列表，然后设置和获取第一个元素）但是`syncExec`方法阻塞所以没有什么不好的。

除非有人稍后回来并成功`asyncExec()`..

# html - 图像和动态布局

> ID：354799
> 
> 赞同：1
> 
> 时间：2008-12-10T01:07:25.170
> 
> 标签：html, css, elasticlayout

我正在使用基于 em 的布局的网站上工作（因此当用户增加或减少字体大小时，它可以优雅地拉伸和压缩）。这个网站有一个应该在所有页面上显示的标题。我在所有页面中都有一个“标题”div，站点范围的 css 文件包含以下代码：

```
#header
{
    width: 50em;
    height: 6em;
    margin-bottom: .5em;
    background: url("/IMAGES/header.png");
} 
```

问题是这并没有真正优雅地伸展。当文本大小增加时，高度和宽度会发生变化，但**图像大小不会增加；它只是重复*.*

**我怎样才能让我的图像拉伸和挤压，而不是重复或被切断？** （如果可能的话，我想要一个基于 css 的解决方案……我已经有了一些 html 的想法）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-10T01:13:36.607

我发现的唯一方法是：

*   将#header 的背景设置为标题图像的bgcolor。
*   在#header中放置新的div
*   将标题图像拆分为 2
*   将新图像的左半部分设置为 #header 背景左对齐
*   将新图像的右半部分设置为 #header.div 背景对齐右

当然，这仅适用于适当的图像。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T01:14:20.927

我很确定您无法更改背景图像的缩放比例。如果你的 header.png 文件被包含为`img`标签，那么你可以将它的高度和宽度设置为数字，`ems`浏览器会调整它的大小（通常让它看起来像废话）。

还要记住，现在几乎所有的现代浏览器都会进行页面缩放，这将在不过多改变布局的情况下放大所有内容。也许告诉您的用户使用该功能？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T01:14:34.843

没有办法使用 css 来拉伸背景图像。您将不得不使用 javascript 或类似的东西。但是，如果您有不需要重复的图像（例如混合到背景中），您可以执行以下操作：

```
background-position: center center;
background-repeat: no-repeat; 
```

附录：该位置具有以下格式： <top|center|bottom|xpos> <left|center|right|ypos> 其中 xpos 和 ypos 可以以常规方式给出（em、px、% 等...） .

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T01:21:30.740

@Pianosaurus，我认为您的想法可能是最简单的，尽管有限。简单地说，不要拉伸图像，但要确保它在未拉伸时看起来不错（居中，不要让它重复）。此外，如果您在标题图像的边缘使用大量填充，则缩小页面大小也不会导致如此大的问题。

# apache-flex - Flex 本地化：刷新 DataProvider 值

> ID：354811
> 
> 赞同：4
> 
> 时间：2008-12-10T01:16:24.200
> 
> 标签：apache-flex, localization

我有一个带有 DataProvider 设置的 ToggleButtonBar，如下所示：

```
 <mx:ToggleButtonBar itemClick="clickHandler(event);" selectedIndex="0">
    <mx:dataProvider>
        <mx:String>{resourceManager.getString('dashboard','daily')}</mx:String>
        <mx:String>{resourceManager.getString('dashboard','monthly')}</mx:String>
        <mx:String>{resourceManager.getString('dashboard','quarterly')}</mx:String>
        <mx:String>{resourceManager.getString('dashboard','yearly')}</mx:String>
    </mx:dataProvider>
   </mx:ToggleButtonBar> 
```

要将语言环境切换为中文，我有一个带有此处理程序的组合框：

```
resourceManager.localeChain = "zh_CN"; 
```

我的问题是，在区域设置更改时，虽然屏幕上所有其他控件的标签会为新的区域设置动态重新加载，但`dataProvider`值不会刷新。我可以在代码中手动重置它们，但有更清洁的解决方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-11T18:29:20.853

我会将您的数据提供者的数据抽象为一个可绑定变量，然后在您更改本地变量时重置数据提供者。

```
<mx:Script>
    <![CDATA[
        [Bindable]
        myArray:Array = new Array(
              [resourceManager.getString('dashboard','daily')]
            , [resourceManager.getString('dashboard','monthly')]
            , [{resourceManager.getString('dashboard','quarterly')]
            , [resourceManager.getString('dashboard','yearly')]);

    ]]>
</mx:Script>

<mx:ToggleButtonBar itemClick="clickHandler(event);" 
selectedIndex="0" id="myToggleButtonBar" dataprovider="{myArray}" /> 
```

然后你可以说

```
myToggleButtonBar.dataProvider = myArray; 
```

在你交换当地人之后，它应该可以工作。

免责声明，我的代码中可能有一些小错误，我显然无法对其进行测试，而且我现在没有可用的 flex builder 来检查我的语法，所以我希望我没有犯任何拼写错误。但这应该让你进入球场。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T11:52:42.590

也许如果您将 getter 绑定到自定义事件，例如：“langChange”

```
[Bindable("langChange")]
public function get dataProviderToggleB():ArrayCollection
{
    var arr :ArrayCollection = new ArrayCollection();

    arr.addItem(resourceManager.getString('dashboard','daily'));
    arr.addItem(resourceManager.getString('dashboard','monthly'));

    return arr; 
} 
```

并在您的“resourceManager.localeChain”设置器中调度：

```
dispatchEvent(new Event("langChange")); 
```

你可以这样使用：

```
<mx:ToggleButtonBar dataProvider="{dataProviderToggleB} itemClick="clickHandler(event);" selectedIndex="0"> 
```

我希望这会对你有所帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-09T15:57:55.383

您应该在数组中保留 'daily', ... 并使用 labelFunction 来翻译标签。当资源管理器发送更改事件时，您应该执行 combo.labelFunction = labelFunction

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-02-03T11:38:50.353

诀窍是在 dataProvider 数组中的每个元素周围添加括号，这样才能正确解析它。请注意，这也正确绑定到 flex 中的区域设置更改，不需要自定义事件调度。

```
<mx:ToggleButtonBar itemClick="clickHandler(event);" selectedIndex="0" 
  dataProvider="{[ (resourceManager.getString('dashboard','daily')),
                   (resourceManager.getString('dashboard','monthly')),
                   (resourceManager.getString('dashboard','quarterly')), 
                   (resourceManager.getString('dashboard','yearly')) ]}">
</mx:ToggleButtonBar> 
```

# javascript - 打包 Javascripts - 值得吗？

> ID：354814
> 
> 赞同：4
> 
> 时间：2008-12-10T01:16:59.987
> 
> 标签：javascript

如果打包的 Javascript 节省了 20kb 的下载大小，但解包时性能受到影响，那么除了混淆代码之外，还有什么好处吗？

我把它做成了一个社区维基，因为它可能对一些讨论开放。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T01:23:56.680

与常规代码相比，打包的 javascript 代码通常不需要更长的时间来执行。大多数代码打包器会缩短变量、函数名并使用许多技巧来缩小源代码。生成的源代码是完全可执行的！您可以通过在运行时使用 firebug 查看它来验证这一点。您将看到压缩代码以其最小化形式执行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T01:23:18.723

简短的回答是的，因为客户端机器的解包时间比传输速度快，而且互联网也是超载的，所以任何对改善事情的贡献都会受到匿名的赞赏，还请记住，大多数客户端都会缓存这些东西，而且越大文件越多，它就越有可能从客户端缓存中清除自身或其他内容，尤其是在移动设备中

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T03:05:53.027

据推测，打包的 JavaScript 对服务器发送（稍微）更有效率，而解包费用由客户端承担。

如果两种情况下的用户体验相同，我会选择打包的 JS。

任何时候您都可以将一些工作推送给客户端而不会产生负面的用户体验，那就去做吧，并获得分布式计算的好处。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T01:51:09.590

雅虎 YSlow 的人建议同时使用 minifier 和 gzip 压缩。

minifier 将去除空格、缩短变量名等。这样您就可以使用适当的缩进和变量名进行编码，以便其他开发人员能够理解您的代码。

gzip 压缩可能更有价值。

* * *

## 回答 #5

> 赞同：-6
> 
> 时间：2008-12-10T01:25:09.297

问题是，为什么打包会节省 20kB？您应该调查使您的“正常”javascript 更小。通过在运算符周围放置空格或使用非常长的变量和函数名称是否显着提高了代码的可读性？我在任何 Web 内容、脚本或页面或 CSS 上看到的最严重的带宽浪费是使用空格缩进。如果必须缩进，请使用制表符或单个空格。没有什么比连续一百行开头有 20 多个空格更浪费的了。

# dns - 所有注册的域都必须分配有域名服务器吗？

> ID：354835
> 
> 赞同：1
> 
> 时间：2008-12-10T01:27:04.147
> 
> 标签：dns

如果我只是想知道一个域名是否被保留；使用此命令是否足以查看是否有任何域名服务器出现，在这种情况下它被保留？

```
host -t NS example.com 
```

这比访问[http://www.internic.net/whois.html](http://www.internic.net/whois.html)并键入 example.com 来获得更详细的结果要快得多，反正我对此并不感兴趣。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T01:39:02.373

绝对不。

一位过去的雇主注册 theirname.biz 仅用于内部网络：它在面向内的网络 DNS 服务器上有 DNS 条目，但在 Internet 上没有。

我不确定这个技巧是否特别重要，但是“imap.theirname.biz”比“imap”的优势在于，如果你同时连接到多个网络，它是明确的（当然，在没有故意犯规的情况下)，因此您可以使用他们所有的内部 DNS 解析器。与“imap.theirname.com”相比的另一个优势在于，一旦您了解了约定，就会立即发现它是私人服务器，因此您无法连接到它的原因是您忘记连接 VPN。可能还有其他我不知道的好处：我是一名编码员，而不是一名 IT 技术人员......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T01:29:20.723

注册域不一定需要 NS 记录。whois 服务是您最可靠的选择。

请注意，大多数 Unix 系统和 Mac OS X 都有一个非常快速使用的“whois”命令行程序：

```
whois stackoverflow.com 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T15:52:06.600

各种 TLD 对是否提供名称服务器有不同的要求。例如，“.de”确实要求名称服务器启动并运行并正确配置，然后才能允许域注册继续进行。

不过，DNS 的技术标准并不要求它，事实上，核心 DNS 规范中没有任何内容将名称的*注册*与其在 DNS 中的后续*操作联系在一起。*

因此，使用`whois`可能是最可靠的方法，但需要注意的是，您需要一个足够聪明的 whois 客户端来确定要与哪个服务器对话以处理相关域。

*也就是说，检查适当的 NS 记录是检查域是否*已注册的一个很好的捷径，你不能用缺少这样的记录来证明它*不是*！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T01:30:33.000

我不相信您必须有一个指向您的域的 DNS。即使您必须设置 DNS，也无法保证充当 DNS 服务器的机器没有关闭。

# c# - unityContainer，子容器注入

> ID：354836
> 
> 赞同：2
> 
> 时间：2008-12-10T01:27:21.057
> 
> 标签：c#, unity-container, code-injection

我对 Unity 应用程序块很陌生，并且在尝试实现以下内容时有点卡住。我有一个父子容器。当我解析子容器的新实例时，我想使用 CreateChildContainer 方法将新的 UnityContainer 注入到构造函数中。

```
public class RootContainer
{
    private IUnityContainer _container;

    public RootContainer()
    {
        _container = new UnityContainer();
        _container.RegisterType<IChildContainer, ChildContainer>();
    }
}

public interface IChildContainer { }

public class ChildContainer : IChildContainer
{
    private IUnityContainer _container;

    /* I want to inject the parent.CreateChildContainer() into this constructor */
    public ChildContainer(IUnityContainer container)
    {
        _container = container;
    }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-10T13:51:44.453

我看到的最简单的解决方案是为 ChildContainer 的构造函数提供父容器并在 ctor 中调用 CreateChildContainer() 方法：

```
public class ChildContainer2 : IChildContainer
{
    private IUnityContainer _container;

    public ChildContainer(IUnityContainer parent)
    {
        _container = parent.CreateChildContainer();
    }

    public IUnityContainer Container { get { return _container; } }
} 
```

但是为什么要让子容器成为服务呢？如果您的应用程序中的每个组件在需要时都自行创建一个子容器，那不是更好吗？

# java - Java 中的日志记录是怎么回事？

> ID：354837
> 
> 赞同：117
> 
> 时间：2008-12-10T01:27:31.150
> 
> 标签：java, logging, log4j, logback, slf4j

为什么要使用以下软件包之一而不是另一个？

*   Java 日志记录
*   公共记录
*   日志4j
*   SLF4j
*   回溯

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2008-12-10T01:50:10.060

按 api 出现的时间顺序（据我所知）：

*   Log4j，因为大多数人都使用它（根据我的经验）
*   Commons Logging，因为开源项目使用它（因此它们可以与集成解决方案中使用的任何日志框架集成）；如果您是 API/Framework/OSS 并且您依赖于使用 Commons Logging 的其他包，则尤其有效。
*   Commons Logging，因为您不想“锁定”到特定的日志记录框架（因此您锁定了 Commons Logging 为您提供的内容） - 我认为决定使用这一点作为原因是不明智的。
*   Java 日志记录，因为您不想添加额外的 jar。
*   SLF4j 因为它比 Commons Logging 更新并提供参数化日志记录：

* * *

```
logger.debug("The entry is {}.", entry);
//which expands effectively to
if (logger.isDebugEnabled()){
    // Note that it's actually *more* efficient than this - see Huxi's comment below...
    logger.debug("The entry is " + entry + "."); 
} 
```

*   Logback 因为它比 log4j 更新，并且再次支持参数化日志记录，因为它直接实现了 SLF4j
*   SLF4j/Logback 因为它是由做 log4j 的同一个人编写的，所以他做得更好（根据[Ken G - 谢谢。在查看](https://stackoverflow.com/questions/354837/whats-up-with-logging-in-java#356038)[他们早期的新闻帖子](http://www.slf4j.org/news.html)时似乎很合适）
*   SLF4j，因为他们还发布了一个 log4j 适配器，因此您不必在旧代码中“切换” log4j - 只需让 log4j.properties 使用 SLF4j 及其配置

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-03-11T21:26:48.120

我发现 Java 中的日志记录令人困惑、不一致、记录不充分，而且特别随意。此外，这些日志框架之间存在大量相似性，导致重复工作，并且对您实际所处的日志环境感到困惑。特别是，如果您在一个严肃的 Java Web 应用程序堆栈中工作，您通常会处于*多*一次记录环境；（例如hibernate 可以使用log4j 和tomcat java.util.logging）。Apache commons 旨在连接不同的日志框架，但实际上只是增加了更多的复杂性。如果你不提前知道这一点，那是完全令人困惑的。为什么我的日志消息没有打印到控制台等？哦，因为我正在查看 Tomcat 日志，而不是 log4j。再增加一层复杂性，应用程序服务器可能具有可能无法识别特定 Web 应用程序的本地配置的全局日志记录配置。最后，所有这些日志框架都太复杂了。用 Java 登录一直是一团混乱，让像我这样的开发人员感到沮丧和困惑。

Java 的早期版本没有导致这种情况的内置日志框架。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-06-03T04:01:03.423

有一个重要的点之前没有提到：

SLF4J（以及作为日志后端的 Logback 和 LOG4J）支持所谓的映射诊断上下文（MDC，请参阅[javadoc](http://slf4j.org/apidocs/org/slf4j/MDC.html)和[文档](http://logback.qos.ch/manual/mdc.html)）。

这本质上是一个线程本地 Map<String,String> ，您可以使用它向日志事件添加额外的上下文信息。MDC 的当前状态附加到每个事件。

如果您将用户名和请求的 URL（在 webapp 的情况下）等内容放入其中，这将非常有用。例如，这可以使用过滤器自动完成。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-12-10T13:30:10.597

另请参阅问题的答案[记录错误的最佳做法是什么？](https://stackoverflow.com/questions/296150/what-are-the-best-practices-to-log-an-error)， 尤其：

*   Commons Logging 存在一些潜在的类加载问题。

*   Log4J 和 SLF4J 是由同一个人开发的，从 Log4J 实践中发现的问题中学习。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-10T07:15:55.503

在我们公司的项目中，我们使用 LOG4j，它非常易于使用，就像 Stephen 在他的示例中展示的那样。我们还为 LOG4j 编写了自己的模式类，因此您可以创建自己的输出文件模式。您可以描述您的日志文件的外观。可以增强原始 log4j 类。

您可以在 log4j.properties 文件中更改所有 LOG4j 属性，因此您可以为不同的项目使用不同的文件。

Java 日志记录不是我最喜欢的，但这可能是因为我从一开始就使用 log4j。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-11T13:48:50.047

[Commons Logging 概述](http://commons.apache.org/logging/)给出了它存在的原因：当您无法控制底层日志记录框架时，从库代码进行日志记录。对于将链接到外部应用程序的各种 Apache 项目非常重要。也许对于您可以完全控制的内部 IT 项目来说并不那么重要。

也就是说，我写信给 Commons Logging，我认识的许多其他开发人员也是如此。原因是为了尽量减少心理负担：您可以更改项目或工作，而不必学习新框架（假设新工作/项目也使用 CL，和/或您可以说服他们转向它）。

此外，围绕您使用的任何框架创建自己的包装器都有一些价值。[如此处](http://www.kdgregory.com/index.php?page=java.logging)所述，我喜欢使用 LogWrapper 对象来提供自定义字符串化（重要），并尽量减少日志语句的视觉混乱（不太重要）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-10T04:00:46.333

通常我会默认使用 Log4J。

如果我不介意对 Java 1.4 的依赖，我会使用 Java Logging，但我仍然会优先使用 Log4J。

如果我要增强已经使用过的东西，我会使用 Commons Logging。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-10T04:02:16.440

我建议创建一个可以写入任何日志框架的精简日志外观，此时支持引擎的选择几乎成为一个有争议的问题。

# php - 将美国日期格式转换为 ANSI SQL 日期格式 (YYYY-mm-dd)

> ID：354838
> 
> 赞同：3
> 
> 时间：2008-12-10T01:28:40.820
> 
> 标签：php, mysql, date

我想将用户提交的日期格式 (mm/dd/yyyy) 转换为 MySQL 日期格式 (YYYY-mm-dd)。提交是通过一个简单的 PHP 表单直接到 MySQL 数据库。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-10T01:30:43.827

```
$mysql_date = date('Y-m-d H:i:s', strtotime($user_date)); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-01-08T02:54:00.847

另一个方法，这次在 SQL 端是在你的 sql 查询中使用 convert 方法：

```
 CONVERT(VARCHAR(11),$user_date,111)

    //e.g.
    SELECT CONVERT(VARCHAR(11),DATEFIELD,111) AS DATE
    //or
    SET DATEFIELD = CONVERT(VARCHAR(11),'".$user_date."',111) 
```

请参阅：[http](http://www.w3schools.com/sql/func_convert.asp) ://www.w3schools.com/sql/func_convert.asp - 末尾的数字更改日期格式的类型，111 返回：2006/12/30。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-01-30T02:17:10.880

PHP 5.2 的另一种方法

```
$datetime = new DateTime($user_date);
echo $datetime->format('Y-m-d H:i:s'); 
```

[DateTime](http://www.php.net/manual/en/book.datetime.php)是 Y38k 和时区友好。

# apache-flex - Adobe Flex/AIR：滚动子组件，而不是整个窗口

> ID：354840
> 
> 赞同：5
> 
> 时间：2008-12-10T01:29:23.160
> 
> 标签：apache-flex, layout, air, scrollbars

我正在使用 Adob​​e Flex 和 AIR 开发一个应用程序，我一直在努力寻找解决滚动问题的方法。

我的主应用程序窗口的基本结构（大大简化）是这样的：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:WindowedApplication xmlns:mx="http://www.adobe.com/2006/mxml"
   paddingTop="0" paddingRight="0" paddingBottom="0" paddingLeft="0"
   width="800" height="600" layout="vertical" verticalAlign="top" 
>
   <mx:VBox id="MainContainer" width="100%" height="100%">
      <mx:Panel id="Toolbars" width="100%" height="25" />
      <mx:HDividedBox width="100%" height="100%" >
         <mx:Panel id="Navigation" minWidth="200" height="100%" />
         <mx:VBox id="MainContent" width="100%">
            <mx:Panel width="100%" height="200" />
            <mx:Panel width="100%" height="200" />
            <mx:Panel width="100%" height="200" />
            <mx:Panel width="100%" height="200" />
            <mx:Panel width="100%" height="200" />
         </mx:VBox>
         <mx:Panel id="HelpContent" minWidth="200" height="100%" />
      </mx:HDividedBox>
      <mx:Panel id="FooterContent" width="100%" height="25" />
   </mx:VBox>
</mx:WindowedApplication> 
```

问题是“MainContent”框可能包含一个巨大的子组件列表，并且该长列表的存在导致垂直滚动条出现在 GUI 的最高级别，围绕“MainContainer” vbox。

它看起来很傻，在整个应用程序窗口周围都有滚动条。

我正在寻找的解决方案是滚动条仅应用于“MainContent”vbox（以及导航和帮助内容面板，如果它们的内容超出窗口边界）。

我在 StackOverflow 上找到了一个[相关问题](https://stackoverflow.com/questions/245292/best-way-to-size-containers-in-flex-to-obey-only-parent-containers-explicit-dim)，该问题的解决方案是在父容器上使用“autoLayout”和“verticalScrollPolicy”属性。

因此，我尝试将 autoLayout="false" 和 verticalScrollPolicy="off" 属性添加到所有父容器，并将 verticalScrollPolicy="on" 属性添加到“MainContent”vbox。但是该实验的最终结果是内容只是从主容器中剪切出来的（并且在 MainContent vbox 中添加了一个没有拇指的无用滚动条）。

有谁知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-11T22:40:44.463

HBox 或 VBox 将尽可能努力地在没有滚动条的情况下显示其内容。如果内容太大而无法容纳在可用范围内，这会强制父容器（通常一直到主应用程序）成为必须滚动的容器。

在幕后，HBox 或 VBox 在其 measure() 函数中设置 measureMinWidth 和 measureMinHeight 属性以匹配其子项所需的尺寸。父容器将尊重该建议，并且滚动任务在显示列表中向上移动。

hasseg 的解决方案在许多情况下都有效，因为它会阻止容器进行测量，但它有点 hacky。在不为容器构建替换子类的情况下，您可以执行以下操作。在要滚动的容器实例上，**将 minWidth 或 minHeight 设置为 0**。这将优先于该容器的measuredMinWidth 或measuredMinHeight 属性，允许父级将实际大小设置为更易于管理的值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T12:24:19.530

找到了解决方案。

看起来阻止 VBox 积极扩展其垂直空间（并迫使其父级增长滚动条）的唯一方法是将 VBox 包装在 Canvas 中。

[这里](http://dusbabek.net/?p=50)有一个方便的小组件，称为 ScrollableVBox，它在处理一些簿记问题的同时执行解决方法（例如向 VBox 添加和删除子项，将它们传递给 Cavas 包装器）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T12:32:45.207

您的问题看起来很像我前段时间遇到的问题。我从[这个讨论](http://www.nabble.com/-flex_india%3A3318--Size-layout-issues-with-respect-to-parent-containers-tc12882767.html)中找到了答案：只需禁用`measure()`.`Box`

这是一个非常简单的解决方法，在我的情况下非常有效，并且没有造成任何“附带损害”。您的结果可能会有所不同。

```
package whatever
{
    import mx.containers.Box;

    /**
    * A Box that has no measure() implementation.
    * 
    * <p>
    * See http://old.nabble.com/-flex_india%3A3318--Size-layout-issues-with-respect-to-parent-containers-to12882767.html
   *  for more info.
    * </p>
    */
    public class NonMeasuredBox extends Box
    {
        /**
        * Constructor
        */
        public function NonMeasuredBox():void
        {
            super();
        }

        override protected function measure():void { /* disabled */ }
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-26T09:38:30.847

不要将 VBox 包装在 Canvas 中，而是将您想要滚动条的 VBox 的 minHeight 属性设置为 0。

# c# - 将 XAML ObjectDataProvider 转换为 C#

> ID：354842
> 
> 赞同：2
> 
> 时间：2008-12-10T01:30:04.093
> 
> 标签：c#, wpf, xaml, objectdataprovider

我想在我的 C# 代码而不是我的 XAML 中创建我的 ObjectDataProvider。

我想知道如何将此 XAML 更改为等效的 C#。XAML 由 Microsoft Expression Blend 2 生成，因此可以安全地忽略 d: 命名空间。

```
<ObjectDataProvider x:Key="FooSourceDS" ObjectType="{x:Type myNS:FooSource}" d:IsDataSource="True"/> 
```

myNS 是一个引用我的 CLR 对象的命名空间。

我对在 C# 中指定 ObjectType 感到困惑：

```
ObjectDataProvider FooSourceDS = new ObjectDataProvider();
FooSourceDS.ObjectType = myNamespace.FooSource; 
```

Intellisence 正确地将 FooSource 识别为 ObjectType 正在寻找的“类型”，不是吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-10T01:44:31.083

这是你需要的吗？

```
FooSourceDS.ObjectType = typeof(myNamespace.FooSource) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-10T01:44:36.873

您的问题的答案是@Bryan 写的，但是请交叉检查您是否需要在代码杠杆上使用 ObjectDataProvider。ObjectDataProvider 只是为绑定实例化特定类的一种 XAML 方式。但是如果你想用 C# 编写代码，那么你真的不需要 ObjectDataProvider。只需创建一个 FooSource 的实例并使用它。

# c# - 什么构成昂贵的方法或资源？

> ID：354845
> 
> 赞同：1
> 
> 时间：2008-12-10T01:32:07.023
> 
> 标签：c#

经常提到异常是昂贵的，.NET 中的各种方法也很昂贵。

究竟是什么构成了 .NET 中昂贵的方法？

是处理方法所花费的时间吗？EG 我使用 WebClient 对象（这不是异步的）获得了网页的响应流，当获得响应并将其分配给变量时，需要一段时间才能逐步完成这行代码。也许是因为网页本身是图形密集型和大型的。要查看所用时间，我知道我可以使用秒表或计时器（两者之间存在细微差别，我不记得了）。

还是占用的资源？如果是这样，查看方法所需资源的最佳方式是什么？我知道我可以使用其中一种 GC 方法或分析器。还有哪些其他方法？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-10T01:44:48.040

昂贵是程度和背景的问题。

我从事图像处理工作，我认为分工很昂贵。就我而言，任何最终在一个循环中执行 2 到 500 万次的操作都会加起来。这可能是 1/8 秒和 1/32 秒之间的差异。1/8 秒的 UI 时间对于动态显示来说是很多的。1/32 是可以接受的。

在其他情况下，它可能是对大型 JPEG 图像进行完全解码并将它们缩小，而不是利用同样编码在同一文件中的 2 个缩小版本的功能。

在网页时间中，它可能是页面加载时的服务器点击次数。明白了吗？

上下文就是一切。

如果资源稀缺并导致其他事情等待，则资源被认为是昂贵的。如果您有 1 个非 RAID 磁盘，则如果两个进程在整个地方弹头，则您在访问上付出了沉重的代价，因此严重依赖驱动器和操作系统中的缓存。

您的打印机是一种非常昂贵的资源，尤其是在缺纸时，因此需要排队。

与其他语言功能相比，异常是昂贵的。静态方法调用很便宜。普通方法调用稍微贵一些。虚拟方法调用稍微贵一些。例外的成本要高得多。

例如，你可以抱怨 C# 没有类型强的多态返回类型，我可以说 - 哦不，它确实 - 只是抛出你的结果并在另一边捕获正确的类型。然后我会因为提出这个建议而被笑出房间。与返回（很少的指令）相比，异常可能会导致数十到数百个，具体取决于上下文。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T02:48:47.197

是的，当人们谈论昂贵的功能时，他们通常指的是执行时间。（调用它的代价是你的线程被阻塞 X 微秒直到函数调用完成，毕竟）

当然，就资源使用而言，它也可能很昂贵，但通常人们指的是执行时间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T01:35:38.810

答案是您有两种类型的昂贵操作。

我个人使用 RedGate 的 ANTs Profiler 来监控应用程序事件的时间和内存方面以及成本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T03:59:48.330

我同意 plint，但我想补充一点，昂贵通常意味着某事花费的时间或资源比您预期的要多，或者在给定情况下比您需要的资源多。一般来说，如果有一个使用更少cpu或更合适的资源的替代方案，那么某些东西是昂贵的。

例如，异常被认为是昂贵的，因为构建堆栈跟踪需要大量的时钟周期。因此，将异常用作流控制机制是一个非常糟糕的主意。因此，如果您正在解析自定义数据格式并且格式错误，那么返回一个带有故障状态和字符串的对象（格式错误的数据第 6 行，位置 3）可能会更好，而不是抛出 MalformedDataException。

但是，是的，昂贵是程度和视角的问题。对于 CPU 设计人员来说，缓存未命中是灾难性的。对 plint 来说，除法是昂贵的。对我来说，硬盘访问很昂贵。

# regex - 查找第二个字符的正则表达式是 Alpha 后跟 1 个数字

> ID：354853
> 
> 赞同：-4
> 
> 时间：2008-12-10T01:40:22.107
> 
> 标签：regex

查找第二个字符的正则表达式是最多 5 个 Alpha 的 Alpha，后跟 1 个数字。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T15:27:00.283

我没有成功实施上述任何解决方案，可能是我对需求的糟糕解释。我确实在不使用正则表达式的代码中解决了它。感谢所有花时间提供帮助的人。对于那些认为这是家庭作业的人来说，事实并非如此。

这是一些示例数据。

需要这个

I INDY2 ' INDY VECTOR DP FOR FILING '041802 REM 59268640 I JODUB3 ' AIRWAY FOR JODUB SID '051205 CLW 59268649

不需要这个

I J149 ' GDK 59265224 I APE074 ' 43092 REF 59265777

这就是我在代码中测试的方式。

```
Dim IsSidStar As Boolean = False
        If aAirways.Name.Length > 2 Then
            Dim a2ndChar As Char = aAirways.Name(1)
            Dim alastChar As Char = aAirways.Name(aAirways.Name.ToString.Length - 1)
            Dim a2ndlastChar As Char = aAirways.Name(aAirways.Name.ToString.Length - 2)

            If Char.IsLetter(a2ndChar) = True AndAlso Char.IsNumber(alastChar) = True AndAlso Char.IsNumber(a2ndlastChar) = False Then
                IsSidStar = True
            End If
        End If 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T01:48:04.713

```
.\w{1,5}\d 
```

任何字符，后跟 1 到 5 个字母，然后是 1 个数字

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T01:53:26.917

复核...

*   第二个字符是字母
*   最多 5 个后续 alpha（即，总共 1 - 6 个 alpha）
*   最终数字

是的？

假设第一个字符无关紧要：

```
/.[A-Za-z]{1,6}\d/ 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-10T02:43:52.353

这应该可以解决问题。正则表达式语言是.Net实现

^.[a-zA-Z]{1,5}\d$

分解

*   ^ 强制匹配从文本的开头开始
*   . 将匹配任何东西
*   `[a-zA-Z`] `{1,5`} 将匹配任何字符 az 至少一次但不超过五次。因为前面的“。” 这意味着匹配将从第二个字符开始
*   \d 匹配单个数字
*   $ 匹配文本的结尾

# java - 这里的任何人都有使用gcj的CNI for java外部库的经验吗？

> ID：354854
> 
> 赞同：2
> 
> 时间：2008-12-10T01:41:47.503
> 
> 标签：java, gcj

一段时间以来，我一直对在桌面应用程序上做一些工作很感兴趣，而我最精通的语言是 Java。由于希望能够编译为本机可执行文件，是否有人愿意分享有关使用 gcj 编译和 CNI 库的经验？我希望使用本机工具包，而不仅仅是 Swing/SWT。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-05T23:59:03.143

由于 Eclipse 已成功本地编译（请参阅[http://www.linuxjournal.com/article/7413](http://www.linuxjournal.com/article/7413)），我会说这是可能的。

我使用 GCJ 将 Java 代码嵌入到 C++ 应用程序中，但我不会将它用于 UI 应用程序。我会在那里使用纯 Java（可能基于 Eclipse RCP），因为那是我有经验的地方。

体验愉快！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-02T06:19:54.437

我没有使用 gcj 来编译为本机可执行文件，但是对于与本机库的接口，我发现[JNA](https://github.com/twall/jna/)是一种非常好的方法，因为您根本不需要编写任何本机代码来进行本机调用。请注意，这样做确实会导致性能损失，因此如果您在可能成为性能问题的紧密循环中调用本机代码，则它可能不是一个选择。

# java - Swing JButton：文本上方的图标

> ID：354866
> 
> 赞同：35
> 
> 时间：2008-12-10T01:48:26.317
> 
> 标签：java, swing, jbutton

如何在 Swing 中使用文本上方的图标创建 JButton？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-12-10T01:53:49.990

这样做：

```
 button.setVerticalTextPosition(SwingConstants.BOTTOM);
    button.setHorizontalTextPosition(SwingConstants.CENTER); 

```

# c# - 如何使用 DMProcessConfigXML 来配置我的 Windows Mobile 设备？

> ID：354869
> 
> 赞同：0
> 
> 时间：2008-12-10T01:50:52.507
> 
> 标签：c#, .net, windows-mobile, pinvoke

我想创建一个 C# 程序来配置 Windows Mobile 设备。我在一个名为[DMProcessConfigXML](http://msdn.microsoft.com/en-us/library/ms852998.aspx)的函数上找到了 MSDN 文档，但没有关于如何使用该函数的说明。

如何在我的 Windows Mobile 应用程序中使用此功能？我怀疑这与使用 pinvoke 有关。

谢谢，
保罗

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-13T21:18:05.287

从托管代码中，您可以调用 Microsoft.WindowsMo​​bile.Configuration 命名空间中的 ConfigurationManager.ProcessConfiguration。[msdn](http://msdn.microsoft.com/en-us/library/microsoft.windowsmobile.configuration.configurationmanager.processconfiguration.aspx) 这里是示例代码：

```
XmlDocument configDoc = new XmlDocument();
configDoc.LoadXml(
    "<wap-provisioningdoc>"+
    "<characteristic type=\"BrowserFavorite\">"+
    "<characteristic type=\"Microsoft\">"+
    "<parm name=\"URL\" value=\"http://www.microsoft.com\"/>"+
    "</characteristic>"+
    "</characteristic>"+
    "</wap-provisioningdoc>"
    );
ConfigurationManager.ProcessConfiguration(configDoc, false); 
```

无需 P/Invoke。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T07:52:30.357

我查看了 MSDN，确实可用的信息很少。我做了一些谷歌搜索，我找到了这个[例子](http://cowo.supersized.org/archives/14-Example-usage-of-DMProcessConfigXML-on-WinCE-5.0.html)。还有这个关于 CF 开源供应应用程序的[博客条目。](http://blogs.msdn.com/andrewarnottms/archive/tags/provisioning/default.aspx)

大多数可用的示例都是用 C++ 编写的。如果你想从 C# 调用它，你需要使用 pinvoke。[pinvoke.net](http://pinvoke.net/)是一个很好的资源。[在这里](http://pinvoke.net/default.aspx/aygshell.DMProcessConfigXML)您可以找到您需要的签名。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T08:11:10.773

发送到 DMProcessConfigXML 的答案在 MSDN 中，但它们不是很容易理解。您需要查看[Configuration Service Providers](http://msdn.microsoft.com/en-us/library/ms889540.aspx)文档。

基本上，你给它 XML 来查询或设置某种系统参数，它会返回 XML 作为结果。设备上几乎所有东西都有服务提供商。您必须具体说明您想要什么，然后我可以在您想要的文档和示例中指出您。

例如，您可以使用它来[查询注册表值](http://msdn.microsoft.com/en-us/library/aa455949.aspx)

你给它 XML：

```
<wap-provisioningdoc>
   <characteristic type="Registry">
      <characteristic type="HKCU\ControlPanel\Home">
         <parm-query name="Timeout"/>
      </characteristic>
   </characteristic>
</wap-provisioningdoc> 
```

结果 XML 应类似于：

```
<wap-provisioningdoc>
   <characteristic type="Registry">
      <characteristic type="HKCU\ControlPanel\Home">
         <parm name="Timeout" value="10000"/>
      </characteristic>
   </characteristic>
</wap-provisioningdoc> 
```

这是一个简单的例子，你可以做很多其他的事情，比如设置网络设置，设置邮件帐户等等。

此外，新版本的 WM 添加了更多 CSP。例如 WM6.1 添加了[设备加密配置服务提供程序](http://msdn.microsoft.com/en-us/library/cc514982.aspx)来查询/启用/禁用 WM6.1 设备上的完整设备加密。

更新：我复制了错误的例子！！DMProcessConfigXml 使用 OMA 客户端配置 XML 而非 OMA DM 配置 XML。

# oracle - 在 Oracle 9i 中显示外键关系

> ID：354870
> 
> 赞同：3
> 
> 时间：2008-12-10T01:50:55.020
> 
> 标签：oracle

oracle 9i 中是否有显示表的外键以及这些外键引用的表的命令？

我正在搜索，没有找到任何东西，但我找到了一个与 MySql 一起使用的等效命令，即 SHOW CREATE TABLE

在 oracle 的 SQL 中是否有等效的命令？

感谢您的回复，但是我认为像 MySql 那样做这件事的方法很短。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-10T02:48:14.607

这是另一个答案：该`dbms_metadata`包有一个函数可以返回表定义的 DDL。

```
SELECT dbms_metadata.get_ddl('TABLE', '<table>', '<schema>') FROM dual; 
```

自 Oracle 9.2 以来，该软件包显然已可用

[http://download-west.oracle.com/docs/cd/B10501_01/appdev.920/a96612/d_metada.htm#1656](http://download-west.oracle.com/docs/cd/B10501_01/appdev.920/a96612/d_metada.htm#1656)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T02:36:02.993

您可以首先列出表的所有约束以及其他表上的任何引用约束：

```
SELECT
     acc.table_name
    ,acc.column_name
    ,acc.constraint_name
    ,ac.r_constraint_name AS referenced_constraint
FROM all_cons_columns acc
INNER JOIN all_constraints ac ON (acc.constraint_name = ac.constraint_name)
WHERE acc.table_name = UPPER('your_table_here'); 
```

如果您对约束有合理的命名约定，则应该可以识别哪些是外键，通常使用“FK”前缀/后缀。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T02:34:12.450

这可能会做你想做的事，它使用 Oracle 系统视图。但是，我没有方便的 Oracle 实例来测试它。

```
SELECT fk.owner, fk.constraint_name, fk.table_name, fc.column_name,
  pk.owner, pk.constraint_name, pk.table_name, pc.column_name
FROM all_constraints fk
 JOIN all_cons_columns fc ON (fk.owner = fc.owner AND fk.constraint_name = fc.constraint_name)
 JOIN (all_constraints pk
   JOIN all_cons_columns pc ON (pk.owner = pc.owner AND pk.constraint_name = pc.constraint_name)) 
 ON (fk.r_owner = pk.owner AND fk.r_constraint_name = pk.constraint_name
   AND fc.position = pc.position)
WHERE fk.constraint_type = 'R' AND pk.constraint_type IN ('P', 'U')
  AND fk.owner = '<schema>' AND fk.table_name = '<table>'; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-08T22:05:19.880

如果您将来需要外键的DDL，那么这里是提前的答案:)

```
select 
  DBMS_METADATA.GET_DEPENDENT_DDL('REF_CONSTRAINT' ,atb.table_name, atb.owner) 
from 
  all_tables atb, all_constraints ac
where 
  atb.owner = ac.owner and
  ac.constraint_type = 'R' and
  ac.table_name = atb.table_name and
  atb.owner = 'YOURSCHEMA'; 
```

# java - 递归地反转Java中的链表

> ID：354875
> 
> 赞同：107
> 
> 时间：2008-12-10T01:51:58.620
> 
> 标签：java, data-structures, recursion, linked-list

一段时间以来，我一直在为一个班级从事 Java 项目。它是一个链表的实现（这里称为`AddressList`，包含称为 的简单节点`ListNode`）。问题是一切都必须使用递归算法来完成。我能够在没有一种方法的情况下做得很好：`public AddressList reverse()`

列表节点：

```
public class ListNode{
  public String data;
  public ListNode next;
} 
```

现在我的`reverse`函数只是调用一个辅助函数，它接受一个参数来允许递归。

```
public AddressList reverse(){
  return new AddressList(this.reverse(this.head));
} 
```

我的辅助函数具有`private ListNode reverse(ListNode current)`.

目前，我让它使用堆栈迭代地工作，但这不是规范所要求的。我在 C 中找到了一种算法，它可以递归地反转并手动将其转换为 Java 代码，并且它可以工作，但我不了解它。

编辑：没关系，我在此期间想通了。

```
private AddressList reverse(ListNode current, AddressList reversedList){
  if(current == null) 
      return reversedList;
  reversedList.addToFront(current.getData());
  return this.reverse(current.getNext(), reversedList);
} 
```

当我在这里时，有人发现这条路线有什么问题吗？

* * *

## 回答 #1

> 赞同：329
> 
> 时间：2008-12-10T02:28:55.003

一个回复中有代码说明了这一点，但您可能会发现从下到上开始更容易，通过询问和回答小问题（这是 The Little Lisper 中的方法）：

1.  null（空列表）的反面是什么？空值。
2.  一个元素列表的反面是什么？元素。
3.  n 元素列表的反面是什么？列表其余部分的倒数，后跟第一个元素。

* * *

```
public ListNode Reverse(ListNode list)
{
    if (list == null) return null; // first question

    if (list.next == null) return list; // second question

    // third question - in Lisp this is easy, but we don't have cons
    // so we grab the second element (which will be the last after we reverse it)

    ListNode secondElem = list.next;

    // bug fix - need to unlink list from the rest or you will get a cycle
    list.next = null;

    // then we reverse everything from the second element on
    ListNode reverseRest = Reverse(secondElem);

    // then we join the two lists
    secondElem.next = list;

    return reverseRest;
} 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-12-10T02:08:12.707

我在一次采访中被问到这个问题，我很生气，因为我有点紧张，所以我摸索着这个问题。

这应该反转一个单链表，用 reverse(head,NULL); 调用。所以如果这是你的清单：

```
1->2->3->4->5->空
它会变成：
5->4->3->2->1->空
```

```
 //Takes as parameters a node in a linked list, and p, the previous node in that list
    //returns the head of the new list
    Node reverse(Node n,Node p){   
        if(n==null) return null;
        if(n.next==null){ //if this is the end of the list, then this is the new head
            n.next=p;
            return n;
        }
        Node r=reverse(n.next,n);  //call reverse for the next node, 
                                      //using yourself as the previous node
        n.next=p;                     //Set your next node to be the previous node 
        return r;                     //Return the head of the new list
    } 
```

编辑：我对此做了 6 次编辑，表明它对我来说仍然有点棘手，哈哈

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-08-09T16:52:16.003

我完成了一半（直到 null，以及 plinth 建议的一个节点），但在进行递归调用后丢失了轨道。但是，在阅读了 plinth 的帖子后，我想到了以下内容：

```
Node reverse(Node head) {
  // if head is null or only one node, it's reverse of itself.
  if ( (head==null) || (head.next == null) ) return head;

  // reverse the sub-list leaving the head node.
  Node reverse = reverse(head.next);

  // head.next still points to the last element of reversed sub-list.
  // so move the head to end.
  head.next.next = head;

  // point last node to nil, (get rid of cycles)
  head.next = null;
  return reverse;
} 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2011-09-15T03:05:38.177

这是另一个递归解决方案。它在递归函数中的代码比其他一些函数少，所以它可能会快一点。这是 C#，但我相信 Java 会非常相似。

```
class Node<T>
{
    Node<T> next;
    public T data;
}

class LinkedList<T>
{
    Node<T> head = null;

    public void Reverse()
    {
        if (head != null)
            head = RecursiveReverse(null, head);
    }

    private Node<T> RecursiveReverse(Node<T> prev, Node<T> curr)
    {
        Node<T> next = curr.next;
        curr.next = prev;
        return (next == null) ? curr : RecursiveReverse(curr, next);
    }
} 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-12-10T13:40:55.880

该算法将需要在以下模型上工作，

*   跟踪头部
*   递归到链表末尾
*   反向联动

结构：

```
Head    
|    
1-->2-->3-->4-->N-->null

null-->1-->2-->3-->4-->N<--null

null-->1-->2-->3-->4<--N<--null

null-->1-->2-->3<--4<--N<--null

null-->1-->2<--3<--4<--N<--null

null-->1<--2<--3<--4<--N<--null

null<--1<--2<--3<--4<--N
                       |
                       Head 
```

代码：

```
public ListNode reverse(ListNode toBeNextNode, ListNode currentNode)
{               
        ListNode currentHead = currentNode; // keep track of the head

        if ((currentNode==null ||currentNode.next==null )&& toBeNextNode ==null)return currentHead; // ignore for size 0 & 1

        if (currentNode.next!=null)currentHead = reverse(currentNode, currentNode.next); // travarse till end recursively

        currentNode.next = toBeNextNode; // reverse link

        return currentHead;
} 
```

输出：

```
head-->12345

head-->54321 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-03-04T02:26:06.300

我认为这是更清洁的解决方案，类似于 LISP

```
// Example:
// reverse0(1->2->3, null) => 
//      reverse0(2->3, 1) => 
//          reverse0(3, 2->1) => reverse0(null, 3->2->1)
// once the first argument is null, return the second arg
// which is nothing but the reveresed list.

Link reverse0(Link f, Link n) {
    if (f != null) {
        Link t = new Link(f.data1, f.data2); 
        t.nextLink = n;                      
        f = f.nextLink;             // assuming first had n elements before, 
                                    // now it has (n-1) elements
        reverse0(f, t);
    }
    return n;
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2010-06-20T15:19:18.617

我知道这是一篇旧文章，但大多数答案都不是尾递归的，即它们在从递归调用返回后执行一些操作，因此不是最有效的。

这是一个尾递归版本：

```
public Node reverse(Node previous, Node current) {
    if(previous == null)
        return null;
    if(previous.equals(head))
        previous.setNext(null);
    if(current == null) {    // end of list
        head = previous;
        return head;
    } else {
                    Node temp = current.getNext();
        current.setNext(previous);
        reverse(current, temp);
    }
    return null;    //should never reach here.
} 
```

致电：

```
Node newHead = reverse(head, head.getNext()); 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-09-16T08:49:48.207

```
无效反向（节点1，节点2）{
如果（node1.next！=null）
      反向（node1.next，node1）；
   节点1.next=节点2；
}
将此方法称为 reverse(start,null);

```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2011-07-10T16:39:23.100

```
public Node reverseListRecursive(Node curr)
{
    if(curr == null){//Base case
        return head;
    }
    else{
        (reverseListRecursive(curr.next)).next = (curr);
    }
    return curr;
} 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2013-12-29T07:08:40.623

```
public void reverse() {
    head = reverseNodes(null, head);
}

private Node reverseNodes(Node prevNode, Node currentNode) {
    if (currentNode == null)
        return prevNode;
    Node nextNode = currentNode.next;
    currentNode.next = prevNode;
    return reverseNodes(currentNode, nextNode);
} 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-02-28T17:52:49.107

```
public static ListNode recRev(ListNode curr){

    if(curr.next == null){
        return curr;
    }
    ListNode head = recRev(curr.next);
    curr.next.next = curr;
    curr.next = null;

    // propogate the head value
    return head;

} 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2013-10-09T18:24:31.750

通过递归算法反转。

```
public ListNode reverse(ListNode head) {
    if (head == null || head.next == null) return head;    
    ListNode rHead = reverse(head.next);
    rHead.next = head;
    head = null;
    return rHead;
} 
```

通过迭代

```
public ListNode reverse(ListNode head) {
    if (head == null || head.next == null) return head;    
    ListNode prev = null;
    ListNode cur = head
    ListNode next = head.next;
    while (next != null) {
        cur.next = prev;
        prev = cur;
        cur = next;
        next = next.next;
    }
    return cur;
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2014-01-18T12:08:03.233

该解决方案表明不需要任何参数。

```
/**
 * Reverse the list
 * @return reference to the new list head
 */
public LinkNode reverse() {
    if (next == null) {
        return this; // Return the old tail of the list as the new head
    }
    LinkNode oldTail = next.reverse(); // Recurse to find the old tail
    next.next = this; // The old next node now points back to this node
    next = null; // Make sure old head has no next
    return oldTail; // Return the old tail all the way back to the top
} 
```

这是支持代码，以证明这是有效的：

```
public class LinkNode {
    private char name;
    private LinkNode next;

    /**
     * Return a linked list of nodes, whose names are characters from the given string
     * @param str node names
     */
    public LinkNode(String str) {
        if ((str == null) || (str.length() == 0)) {
            throw new IllegalArgumentException("LinkNode constructor arg: " + str);
        }
        name = str.charAt(0);
        if (str.length() > 1) {
            next = new LinkNode(str.substring(1));
        }
    }

    public String toString() {
        return name + ((next == null) ? "" : next.toString());
    }

    public static void main(String[] args) {
        LinkNode head = new LinkNode("abc");
        System.out.println(head);
        System.out.println(head.reverse());
    }
} 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-06-09T14:06:11.380

这是一个简单的迭代方法：

```
public static Node reverse(Node root) {
    if (root == null || root.next == null) {
        return root;
    }

    Node curr, prev, next;
    curr = root; prev = next = null;
    while (curr != null) {
        next = curr.next;
        curr.next = prev;

        prev = curr;
        curr = next;
    }
    return prev;
} 
```

这是一种递归方法：

```
public static Node reverseR(Node node) {
    if (node == null || node.next == null) {
        return node;
    }

    Node next = node.next;
    node.next = null;

    Node remaining = reverseR(next);
    next.next = node;
    return remaining;
} 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2014-10-10T05:43:08.813

由于 Java 总是传值，所以在 Java 中递归地反转链表，确保在递归结束时返回“新头”（反转后的头节点）。

```
static ListNode reverseR(ListNode head) {
    if (head == null || head.next == null) {
        return head;
    }

    ListNode first = head;
    ListNode rest = head.next;

    // reverse the rest of the list recursively
    head = reverseR(rest);

    // fix the first node after recursion
    first.next.next = first;
    first.next = null;

    return head;
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-05-05T06:00:54.200

PointZeroTwo 在 Java 中得到了优雅的答案和相同的答案......

```
public void reverseList(){
    if(head!=null){
        head = reverseListNodes(null , head);
    }
}

private Node reverseListNodes(Node parent , Node child ){
    Node next = child.next;
    child.next = parent;
    return (next==null)?child:reverseListNodes(child, next);
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-04-08T17:02:19.140

```
public class Singlelinkedlist {
  public static void main(String[] args) {
    Elem list  = new Elem();
    Reverse(list); //list is populate some  where or some how
  }

  //this  is the part you should be concerned with the function/Method has only 3 lines

  public static void Reverse(Elem e){
    if (e!=null)
      if(e.next !=null )
        Reverse(e.next);
    //System.out.println(e.data);
  }
}

class Elem {
  public Elem next;    // Link to next element in the list.
  public String data;  // Reference to the data.
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-05-01T14:14:57.207

```
public Node reverseRec(Node prev, Node curr) {
    if (curr == null) return null;  

    if (curr.next == null) {
        curr.next = prev;
        return curr;

    } else {
        Node temp = curr.next; 
        curr.next = prev;
        return reverseRec(curr, temp);
    }               
} 
```

调用使用：head = reverseRec(null, head);

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2013-05-11T16:35:30.227

其他人所做的，在其他帖子中是一个内容游戏，我所做的是一个链表游戏，它反转了链表的成员而不是成员的价值。

```
Public LinkedList reverse(LinkedList List)
{
       if(List == null)
               return null;
       if(List.next() == null)
              return List;
       LinkedList temp = this.reverse( List.next() );
       return temp.setNext( List );
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2013-07-11T21:47:25.757

```
package com.mypackage;
class list{

    node first;    
    node last;

    list(){
    first=null;
    last=null;
}

/*returns true if first is null*/
public boolean isEmpty(){
    return first==null;
}
/*Method for insertion*/

public void insert(int value){

    if(isEmpty()){
        first=last=new node(value);
        last.next=null;
    }
    else{
        node temp=new node(value);
        last.next=temp;
        last=temp;
        last.next=null;
    }

}
/*simple traversal from beginning*/
public void traverse(){
    node t=first;
    while(!isEmpty() && t!=null){
        t.printval();
        t= t.next;
    }
}
/*static method for creating a reversed linked list*/
public static void reverse(node n,list l1){

    if(n.next!=null)
        reverse(n.next,l1);/*will traverse to the very end*/
    l1.insert(n.value);/*every stack frame will do insertion now*/

}
/*private inner class node*/
private class node{
    int value;
    node next;
    node(int value){
        this.value=value;
    }
    void printval(){
        System.out.print(value+" ");
    }
}

 } 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-07-13T14:13:42.997

解决方案是：

```
package basic;

import custom.ds.nodes.Node;

public class RevLinkedList {

private static Node<Integer> first = null;

public static void main(String[] args) {
    Node<Integer> f = new Node<Integer>();
    Node<Integer> s = new Node<Integer>();
    Node<Integer> t = new Node<Integer>();
    Node<Integer> fo = new Node<Integer>();
    f.setNext(s);
    s.setNext(t);
    t.setNext(fo);
    fo.setNext(null);

    f.setItem(1);
    s.setItem(2);
    t.setItem(3);
    fo.setItem(4);
    Node<Integer> curr = f;
    display(curr);
    revLL(null, f);
    display(first);
}

public static void display(Node<Integer> curr) {
    while (curr.getNext() != null) {
        System.out.println(curr.getItem());
        System.out.println(curr.getNext());
        curr = curr.getNext();
    }
}

public static void revLL(Node<Integer> pn, Node<Integer> cn) {
    while (cn.getNext() != null) {
        revLL(cn, cn.getNext());
        break;
    }
    if (cn.getNext() == null) {
        first = cn;
    }
    cn.setNext(pn);
} 
```

}

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-08-25T12:32:53.023

```
static void reverseList(){

if(head!=null||head.next!=null){
ListNode tail=head;//head points to tail

ListNode Second=head.next;
ListNode Third=Second.next;
tail.next=null;//tail previous head is poiniting null
Second.next=tail;
ListNode current=Third;
ListNode prev=Second;
if(Third.next!=null){

    while(current!=null){
    ListNode    next=current.next;
        current.next=prev;
        prev=current;
        current=next;
    }
    }
head=prev;//new head
}
}
class ListNode{
    public int data;
    public ListNode next;
    public int getData() {
        return data;
    }

    public ListNode(int data) {
        super();
        this.data = data;
        this.next=null;
    }

    public ListNode(int data, ListNode next) {
        super();
        this.data = data;
        this.next = next;
    }

    public void setData(int data) {
        this.data = data;
    }
    public ListNode getNext() {
        return next;
    }
    public void setNext(ListNode next) {
        this.next = next;
    }

} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2014-08-29T13:23:36.300

```
private Node ReverseList(Node current, Node previous)
    {
        if (current == null) return null;
        Node originalNext = current.next;
        current.next = previous;
        if (originalNext == null) return current;
        return ReverseList(originalNext, current);
    } 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-09-27T04:23:47.497

```
//this function reverses the linked list
public Node reverseList(Node p) {
    if(head == null){
        return null;
    }
    //make the last node as head
    if(p.next == null){
        head.next = null;
        head = p;
        return p;
    }
    //traverse to the last node, then reverse the pointers by assigning the 2nd last node to last node and so on..
    return reverseList(p.next).next = p;
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2015-10-25T14:51:55.177

```
//Recursive solution
class SLL
{
   int data;
   SLL next;
}

SLL reverse(SLL head)
{
  //base case - 0 or 1 elements
  if(head == null || head.next == null) return head;

  SLL temp = reverse(head.next);
  head.next.next = head;
  head.next = null;
  return temp;
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2016-02-21T03:00:46.697

受[一篇](https://www.google.com/search?q=avl%20swift&oq=avl%20swift&aqs=chrome..69i57j69i60l5.1086j0j4&sourceid=chrome&es_sm=119&ie=UTF-8)讨论递归数据结构的不可变实现的文章的启发，我使用 Swift 组合了一个替代解决方案。

领先的答案通过突出以下主题来记录解决方案：

1.  nil（空列表）的反面是什么？
    *   在这里没关系，因为我们在 Swift 中有 nil 保护。
2.  一个元素列表的反面是什么？
    *   元素本身
3.  n 元素列表的反面是什么？
    *   第二个元素的倒数，后跟第一个元素。

我已经在下面的解决方案中指出了这些。

```
/**
 Node is a class that stores an arbitrary value of generic type T 
 and a pointer to another Node of the same time.  This is a recursive 
 data structure representative of a member of a unidirectional linked
 list.
 */
public class Node<T> {
    public let value: T
    public let next: Node<T>?

    public init(value: T, next: Node<T>?) {
        self.value = value
        self.next = next
    }

    public func reversedList() -> Node<T> {
        if let next = self.next {
            // 3\. The reverse of the second element on followed by the first element.
            return next.reversedList() + value
        } else {
            // 2\. Reverse of a one element list is itself
            return self
        }
    }
}

/**
 @return Returns a newly created Node consisting of the lhs list appended with rhs value.
 */
public func +<T>(lhs: Node<T>, rhs: T) -> Node<T> {
    let tail: Node<T>?
    if let next = lhs.next {
        // The new tail is created recursively, as long as there is a next node.
        tail = next + rhs
    } else {
        // If there is not a next node, create a new tail node to append
        tail = Node<T>(value: rhs, next: nil)
    }
    // Return a newly created Node consisting of the lhs list appended with rhs value.
    return Node<T>(value: lhs.value, next: tail)
} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2016-06-08T06:08:16.483

使用递归反转链表。这个想法是通过反转链接来调整链接。

```
 public ListNode reverseR(ListNode p) {

       //Base condition, Once you reach the last node,return p                                           
        if (p == null || p.next == null) { 
            return p;
        }
       //Go on making the recursive call till reach the last node,now head points to the last node

        ListNode head  = reverseR(p.next);  //Head points to the last node

       //Here, p points to the last but one node(previous node),  q points to the last   node. Then next next step is to adjust the links
        ListNode q = p.next; 

       //Last node link points to the P (last but one node)
        q.next = p; 
       //Set the last but node (previous node) next to null
        p.next = null; 
        return head; //Head points to the last node
    } 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2017-05-26T06:02:09.873

```
public void reverseLinkedList(Node node){
    if(node==null){
        return;
    }

    reverseLinkedList(node.next);
    Node temp = node.next;
    node.next=node.prev;
    node.prev=temp;
    return;
} 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2021-12-04T04:15:27.083

javascript中的解决方案（递归）：

```
function reverse_linked_list_1(node){
    function reverse_linked_list_1(node, result){
        return node ? reverse_linked_list_1(node.next, {data: node.data, next: result}) : result;
    }
    return reverse_linked_list_1(node, null);
} 
```

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2013-10-26T05:25:20.880

```
public void reverse(){
    if(isEmpty()){
    return;
     }
     Node<T> revHead = new Node<T>();
     this.reverse(head.next, revHead);
     this.head = revHead;
}

private Node<T> reverse(Node<T> node, Node<T> revHead){
    if(node.next == null){
       revHead.next = node;
       return node;
     }
     Node<T> reverse = this.reverse(node.next, revHead);
     reverse.next = node;
     node.next = null;
     return node;
} 
```

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2014-01-09T03:20:42.710

如果有人正在寻找 Scala 实现，这里是一个参考：

```
scala> import scala.collection.mutable.LinkedList
import scala.collection.mutable.LinkedList

scala> def reverseLinkedList[A](ll: LinkedList[A]): LinkedList[A] =
         ll.foldLeft(LinkedList.empty[A])((accumulator, nextElement) => nextElement +: accumulator)
reverseLinkedList: [A](ll: scala.collection.mutable.LinkedList[A])scala.collection.mutable.LinkedList[A]

scala> reverseLinkedList(LinkedList("a", "b", "c"))
res0: scala.collection.mutable.LinkedList[java.lang.String] = LinkedList(c, b, a)

scala> reverseLinkedList(LinkedList("1", "2", "3"))
res1: scala.collection.mutable.LinkedList[java.lang.String] = LinkedList(3, 2, 1) 
```

* * *

## 回答 #32

> 赞同：-1
> 
> 时间：2015-09-28T07:13:33.940

这就是我们在 Opal 中执行此操作的方式 - 一种纯函数式编程语言。而且，恕我直言 - 递归地这样做只有在这种情况下才有意义。

```
List Reverse(List l)
{
    if (IsEmpty(l) || Size(l) == 1) return l;
    return reverse(rest(l))::first(l);
} 
```

rest(l) 返回一个列表，它是没有第一个节点的原始列表。first(l) 返回第一个元素。:: 是一个连接运算符。

* * *

## 回答 #33

> 赞同：-3
> 
> 时间：2016-08-22T03:14:07.273

这是用于链接列表的 C# 版本的 Reverse。

```
 public void Reverse()
    {
        Node currentNode, nextNode=null, prevNode=null;
        currentNode = head;
        while(currentNode!=null)
        {
            nextNode = currentNode.next;
            currentNode.next = prevNode;
            prevNode = currentNode;
            currentNode = nextNode;
        }
        head = prevNode;
    } 
```

# python - 从函数返回多个值的最佳方法？

> ID：354883
> 
> 赞同：1179
> 
> 时间：2008-12-10T01:55:50.733
> 
> 标签：python, coding-style, return, return-value

在支持它的语言中返回多个值的规范方法通常是[tupling](https://stackoverflow.com/questions/38508/whats-the-best-way-to-return-multiple-values-from-a-function-in-python)。

### 选项：使用元组

考虑这个简单的例子：

```
def f(x):
  y0 = x + 1
  y1 = x * 3
  y2 = y0 ** y3
  return (y0, y1, y2) 
```

但是，随着返回值数量的增加，这很快就会出现问题。如果要返回四个或五个值怎么办？当然，您可以继续对它们进行元组处理，但很容易忘记哪个值在哪里。在任何你想收到它们的地方打开它们也相当难看。

### 选项：使用字典

下一个合乎逻辑的步骤似乎是引入某种“记录符号”。在 Python 中，最明显的方法是通过`dict`.

考虑以下：

```
def g(x):
  y0 = x + 1
  y1 = x * 3
  y2 = y0 ** y3
  return {'y0': y0, 'y1': y1 ,'y2': y2} 
```

（为了清楚起见，y0、y1 和 y2 只是作为抽象标识符。正如所指出的，在实践中你会使用有意义的标识符。）

现在，我们有了一种机制，可以将返回对象的特定成员投影出来。例如，

```
result['y0'] 
```

### 选项：使用类

但是，还有另一种选择。我们可以改为返回一个专门的结构。我已经在 Python 的上下文中构建了这个框架，但我确信它也适用于其他语言。事实上，如果您使用 C 语言工作，这很可能是您唯一的选择。开始：

```
class ReturnValue:
  def __init__(self, y0, y1, y2):
     self.y0 = y0
     self.y1 = y1
     self.y2 = y2

def g(x):
  y0 = x + 1
  y1 = x * 3
  y2 = y0 ** y3
  return ReturnValue(y0, y1, y2) 
```

在 Python 中，前两个在管道方面可能非常相似——毕竟`{ y0, y1, y2 }`只是最终`__dict__`成为`ReturnValue`.

Python 还为微小对象提供了一项附加功能，即`__slots__`属性。类可以表示为：

```
class ReturnValue(object):
  __slots__ = ["y0", "y1", "y2"]
  def __init__(self, y0, y1, y2):
     self.y0 = y0
     self.y1 = y1
     self.y2 = y2 
```

来自[Python 参考手册](http://www.network-theory.co.uk/docs/pylang/__slots__.html)：

> 该`__slots__`声明采用一系列实例变量，并在每个实例中保留足够的空间来保存每个变量的值。`__dict__`因为不是为每个实例创建空间，所以节省了空间。

### 选项：使用[数据类](https://docs.python.org/3/library/dataclasses.html)（Python 3.7+）

使用 Python 3.7 的新数据类，返回一个带有自动添加的特殊方法、键入和其他有用工具的类：

```
@dataclass
class Returnvalue:
    y0: int
    y1: float
    y3: int

def total_cost(x):
    y0 = x + 1
    y1 = x * 3
    y2 = y0 ** y3
    return ReturnValue(y0, y1, y2) 
```

### 选项：使用列表

我忽略的另一个建议来自蜥蜴比尔：

```
def h(x):
  result = [x + 1]
  result.append(x * 3)
  result.append(y0 ** y3)
  return result 
```

这是我最不喜欢的方法。我想我因接触 Haskell 而受到污染，但混合类型列表的想法一直让我感到不舒服。在这个特定的例子中，列表是 -not-mixed 类型，但可以想象它可能是。

据我所知，以这种方式使用的列表实际上对元组没有任何好处。Python 中列表和元组之间唯一真正的区别是列表是[可变](http://docs.python.org/library/stdtypes.html#typesseq-mutable)的，而元组不是。

我个人倾向于继承函数式编程的约定：对任意数量的相同类型的元素使用列表，对固定数量的预定类型的元素使用元组。

# 问题

在冗长的序言之后，不可避免的问题来了。哪种方法（您认为）最好？

* * *

## 回答 #1

> 赞同：676
> 
> 时间：2008-12-10T16:36:01.830

为此，在 2.6 中添加了[命名元组。](http://docs.python.org/library/collections.html#namedtuple-factory-function-for-tuples-with-named-fields)另请参阅[os.stat](http://docs.python.org/library/os.html#os.stat)以获取类似的内置示例。

```
>>> import collections
>>> Point = collections.namedtuple('Point', ['x', 'y'])
>>> p = Point(1, y=2)
>>> p.x, p.y
1 2
>>> p[0], p[1]
1 2 
```

在最新版本的 Python 3（我认为是 3.6+）中，新`typing`库获得了[`NamedTuple`](https://docs.python.org/3/library/typing.html#typing.NamedTuple)使命名元组更易于创建和更强大的类。继承自`typing.NamedTuple`允许您使用文档字符串、默认值和类型注释。

示例（来自文档）：

```
class Employee(NamedTuple):  # inherit from typing.NamedTuple
    name: str
    id: int = 3  # default value

employee = Employee('Guido')
assert employee.id == 3 
```

* * *

## 回答 #2

> 赞同：256
> 
> 时间：2008-12-10T02:22:28.700

对于小型项目，我发现使用元组最容易。当这变得太难以管理时（而不是之前），我开始将事物分组到逻辑结构中，但是我认为您建议使用字典和`ReturnValue`对象是错误的（或过于简单化）。

返回带有键`"y0"`, `"y1"`,`"y2"`等的字典与元组相比没有任何优势。返回具有属性, ,等的`ReturnValue`实例也不比元组提供任何优势。如果你想去任何地方，你需要开始命名，无论如何你都可以使用元组来做到这一点：`.y0``.y1``.y2`

```
def get_image_data(filename):
    [snip]
    return size, (format, version, compression), (width,height)

size, type, dimensions = get_image_data(x) 
```

恕我直言，除了元组之外唯一的好技术是返回具有适当方法和属性的真实对象，就像你从`re.match()`or得到的一样`open(file)`。

* * *

## 回答 #3

> 赞同：229
> 
> 时间：2016-04-14T20:08:13.553

许多答案表明您需要返回某种集合，例如字典或列表。您可以省略额外的语法，只写出返回值，以逗号分隔。注意：这在技术上返回一个元组。

```
def f():
    return True, False
x, y = f()
print(x)
print(y) 
```

给出：

```
True
False 
```

* * *

## 回答 #4

> 赞同：79
> 
> 时间：2008-12-10T02:42:05.273

我投票给字典。

我发现如果我创建一个返回超过 2-3 个变量的函数，我会将它们折叠在字典中。否则我往往会忘记我返回的顺序和内容。

此外，引入“特殊”结构会使您的代码更难遵循。（其他人将不得不搜索代码以找出它是什么）

如果您担心类型查找，请使用描述性字典键，例如“x 值列表”。

```
def g(x):
  y0 = x + 1
  y1 = x * 3
  y2 = y0 ** y3
  return {'y0':y0, 'y1':y1 ,'y2':y2 } 
```

* * *

## 回答 #5

> 赞同：41
> 
> 时间：2014-02-23T15:26:30.960

另一种选择是使用生成器：

```
>>> def f(x):
        y0 = x + 1
        yield y0
        yield x * 3
        yield y0 ** 4

>>> a, b, c = f(5)
>>> a
6
>>> b
15
>>> c
1296 
```

尽管恕我直言，元组通常是最好的，除非返回的值是类封装的候选对象。

* * *

## 回答 #6

> 赞同：38
> 
> 时间：2008-12-10T02:00:49.897

我更喜欢：

```
def g(x):
  y0 = x + 1
  y1 = x * 3
  y2 = y0 ** y3
  return {'y0':y0, 'y1':y1 ,'y2':y2 } 
```

似乎其他一切都只是做同样事情的额外代码。

* * *

## 回答 #7

> 赞同：31
> 
> 时间：2008-12-10T02:40:43.343

当元组感觉“自然”时，我更喜欢使用元组；坐标是一个典型的例子，其中单独的对象可以独立存在，例如在单轴缩放计算中，并且顺序很重要。注意：如果我可以对项目进行排序或洗牌而不会对组的含义产生不利影响，那么我可能不应该使用元组。

仅当分组对象并不总是相同时，我才使用字典作为返回值。考虑可选的电子邮件标题。

对于其余的情况，如果分组对象在组内具有内在含义，或者需要一个具有自己方法的成熟对象，我使用一个类。

* * *

## 回答 #8

> 赞同：29
> 
> 时间：2015-01-21T20:57:30.077

```
>>> def func():
...    return [1,2,3]
...
>>> a,b,c = func()
>>> a
1
>>> b
2
>>> c
3 
```

* * *

## 回答 #9

> 赞同：24
> 
> 时间：2008-12-10T02:15:34.297

通常，“专门结构”实际上是对象的合理当前状态，具有自己的方法。

```
class Some3SpaceThing(object):
  def __init__(self,x):
    self.g(x)
  def g(self,x):
    self.y0 = x + 1
    self.y1 = x * 3
    self.y2 = y0 ** y3

r = Some3SpaceThing( x )
r.y0
r.y1
r.y2 
```

我喜欢尽可能找到匿名结构的名称。有意义的名字使事情更清楚。

* * *

## 回答 #10

> 赞同：20
> 
> 时间：2008-12-10T03:51:47.130

+1 关于 S.Lott 对命名容器类的建议。

对于 Python 2.6 及更高版本，[命名元组](http://docs.python.org/library/collections.html#collections.namedtuple)提供了一种轻松创建这些容器类的有用方法，其结果是“轻量级且不需要比常规元组更多的内存”。

* * *

## 回答 #11

> 赞同：20
> 
> 时间：2013-08-13T20:18:55.797

Python 的元组、字典和对象为程序员提供了小型数据结构（“事物”）的形式和便利之间的平滑折衷。对我来说，如何表示事物的选择主要取决于我将如何使用该结构。`struct`在 C++ 中，用于纯数据项和具有方法的对象是一种通用约定`class`，即使您可以合法地将方法放在`struct`; 我的习惯在 Python 中是类似的，使用`dict`和`tuple`代替`struct`.

对于坐标集，我将使用 a`tuple`而不是点`class`或 a `dict`（请注意，您可以使用 a`tuple`作为字典键，因此`dict`s 构成了很好的稀疏多维数组）。

如果我要迭代一个事物列表，我更喜欢`tuple`在迭代中解包 s：

```
for score,id,name in scoreAllTheThings():
    if score > goodScoreThreshold:
        print "%6.3f #%6d %s"%(score,id,name) 
```

...因为对象版本阅读起来更加混乱：

```
for entry in scoreAllTheThings():
    if entry.score > goodScoreThreshold:
        print "%6.3f #%6d %s"%(entry.score,entry.id,entry.name) 
```

......更不用说`dict`.

```
for entry in scoreAllTheThings():
    if entry['score'] > goodScoreThreshold:
        print "%6.3f #%6d %s"%(entry['score'],entry['id'],entry['name']) 
```

如果该事物被广泛使用，并且您发现自己在代码中的多个位置对其进行了类似的重要操作，那么通常值得将其设为具有适当方法的类对象。

最后，如果我要与非 Python 系统组件交换数据，我通常会将它们保存在 a 中，`dict`因为它最适合 JSON 序列化。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2018-08-29T19:30:23.887

“最佳”是一个部分主观的决定。在可以接受不可变的一般情况下，将元组用于小返回集。当不需要可变性时，元组总是比列表更可取。

对于更复杂的返回值，或者对于形式很有价值的情况（即高价值代码），命名元组更好。对于最复杂的情​​况，对象通常是最好的。然而，真正重要的是情况。如果返回一个对象是有意义的，因为这是您在函数末尾自然拥有的（例如工厂模式），那么返回该对象。

正如智者所说：

> 过早的优化是编程中万恶（或至少是大部分）的根源。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-12-10T02:02:37.117

在像 Python 这样的语言中，我通常会使用字典，因为与创建新类相比，它涉及的开销更少。

但是，如果我发现自己不断地返回相同的变量集，那么这可能涉及一个新的类，我将把它排除在外。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2017-10-30T14:01:00.783

我会使用 dict 从函数传递和返回值：

使用 form 中定义的变量[形式](https://en.wikipedia.org/wiki/Form_(document))。

```
form = {
    'level': 0,
    'points': 0,
    'game': {
        'name': ''
    }
}

def test(form):
    form['game']['name'] = 'My game!'
    form['level'] = 2

    return form

>>> print(test(form))
{u'game': {u'name': u'My game!'}, u'points': 0, u'level': 2} 
```

这对我和处理单元来说是最有效的方式。

您只需传入一个指针并返回一个指针。

每当您对代码进行更改时，您都不必更改函数的（数千个）参数。

# oop - 在任何情况下，“获取”或“计算”操作的副作用是合法的吗？

> ID：354886
> 
> 赞同：4
> 
> 时间：2008-12-10T01:57:41.527
> 
> 标签：oop, side-effects

我刚刚完成了一个奇怪的 UI 效果的六个小时的调试会话，我发现我最喜欢的框架实现的一个名为“getVisibleRegion”的接口函数禁用了一些 UI 功能（并且显然忘记了恢复它）。

我已经向框架提交了一个错误，但这让我想到了适当的设计：在什么情况下对一个名称暗示仅仅是计算/获取操作的操作产生任何副作用是合法的？

对于那些对实际细节感兴趣的人：我有一个关于我的插件不断破坏 Eclipse 的代码折叠导致折叠栏消失并且无法“展开”或查看折叠代码的错误的报告。我将其追溯到对 ITextViewer 上的 getVisibleRegion() 的调用，该 ITextViewer 的类型表示源代码查看器。现在，ITextViewer 的文档确实声明“实现 ITextViewerExtension5 的查看器可能被迫更改显示的输入文档的部分，以履行此合同”。然而，实际的实现有点*过于*宽松了，只是永久禁用了投影（折叠），永远不会把它带回来。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-10T02:08:31.067

我能想到的最大原因是缓存结果。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-10T01:58:27.017

我会说没有。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-10T02:07:37.433

这可能是一种极端情况，它甚至不能算作副作用，但如果计算结果缓存在对象中，那么这是可以接受的。即便如此，它不应该对调用者产生影响。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-10T02:17:55.540

我会说只有当副作用非常明显时才会发生。这是一个简单的例子：

```
 MakeMyLifeEasyObject mmleo = new MakeMyLifeEasyObject(x, y, z, default, 12, something);

  Object uniqueObjectOne = mmleo.getNewUniqueObject();
  Object uniqueObjectTwo = mmleo.getNewUniqueObject();

  System.out.println(uniqueObjectOne.getId() == uniqueObjectTwo.getId()); // Prints "false" 
```

现在在我的理论中，MakeMyLifeEasyObject 有一些内部计数器（如数据库表上的主键）。get 有一个副作用。我也可以想出这样的想法：

```
 Object thing = list.getNextObjectAndRemoveFromList(); 
```

那也是有道理的。

现在需要注意的是，在这两种情况下，**最好重命名方法**。

第一个可能会更好，如 createNewUniqueObject()，而第二个不同的名称（在本例中为 pop()）会更好。

当它不是我上面给出的一些半人为的例子时，我会说如果值需要很长时间才能创建或可能会被使用很多并且需要，那么应该发生的唯一副作用是创建/更新一些缓存被加速。

这方面的一个例子是一个包含一堆字符串的对象。您有一个方法 getThingToPrint() 需要将一堆连接在一起。你可以在调用时创建一个缓存，这将是一个副作用。当您更新事物所基于的字符串之一时，该集合将使缓存无效（或更新它）。

和你描述的一样吗？绝对听起来像一个错误。我想不出一个好主意的情况。如果这是预期的行为而不是错误，那么应该将其重命名为其他名称（即 disableThingAndGetVisibleRegion()）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T02:02:53.030

obj.getBusyDoingStuff()

# html - Firefox 不会显示图像！

> ID：354888
> 
> 赞同：3
> 
> 时间：2008-12-10T01:58:34.287
> 
> 标签：html, css, firefox

这对我来说很有趣……这张图片在 Safari 中显示得非常好，但在 Firefox 中却完全没有！以下是相关代码：

```
<div id="ad">
    <p>Advertisment</p>
    <img src="/ADS/fakead1.gif" />
</div> 
```

使用 CSS：

```
#ad{color: #666;}
#ad p{
    font-size: .5em;
    text-align: center;
    padding: 0;
    margin: 0;
}

#ad img{
    width: 9em;
    padding: .5em;
    margin: 0;
} 
```

为什么这段代码会导致 Firefox 简单地*忽略*图像？（同样，它与 Safari 完美配合。）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-10T02:01:30.147

哇，我没那么聪明...

AdBlock Plus 比我想象的更聪明！我需要将 div 名称更改为比“ad”（！）不那么明显的名称

我早该知道。

智者的话：如果您希望您的广告通过，请用克林贡语命名 div。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T02:03:14.433

它在这里对我有用。我想说的只是你的广告拦截

# filesystemwatcher - C# FileSystemWatcher 没有捕获 Perforce 还原

> ID：354891
> 
> 赞同：1
> 
> 时间：2008-12-10T02:00:39.523
> 
> 标签：filesystemwatcher

C# FileSystemWatcher 不会捕获 Perforce 还原。修改同一个文件时它工作正常。这会导致问题，因为还原会更改文件，但 FileSystemWatcher 不会收到通知。

你如何观察 Perforce 恢复？

谢谢你。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T07:14:57.330

In addition to checking the NotifyFilters, make sure you're attaching handlers to all of the events that the FileSystemWatcher has. FileSystemWatcher has events for Changed, Created, Deleted and Renamed.

If you're only attaching to the Changed event and not catching any events, then it sounds like Perforce might be deleting and recreating the file. If this is the case, add handlers to the Deleted and Changed events.

The [NotifyFilters documentation](http://msdn.microsoft.com/en-us/library/system.io.notifyfilters.aspx) on msdn has example code showing handling for all of the events.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T02:59:28.810

您是否正确设置了 NotifyFilters？从 FileSystemWatcher 帮助...

> 您可以在目录或文件中观察多种类型的更改。例如，您可以观察属性、LastWrite 日期和时间或文件或目录大小的变化。这是通过将 NotifyFilter 属性设置为 NotifyFilters 值之一来完成的。

Perforce 恢复也可能恢复到以前的 LastWrite 时间，如果您只是在寻找*更新*的时间戳，则不会触发更新。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T05:10:55.973

我怀疑 Perforce 报告会从临时文件中复制一份，所以它实际上并没有写入文件，而是复制到一个新文件中并删除了前一个文件。因此，由于文件没有被“写入”，因此您不会收到通知。虽然它对你没有帮助:(

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T03:04:23.810

我尝试了来自 CodeProject 的示例可执行文件，它似乎可以工作，一定是我的代码很糟糕......

# ruby-on-rails - 对相同类型的多个项目使用“参考”

> ID：354900
> 
> 赞同：2
> 
> 时间：2008-12-10T02:04:27.143
> 
> 标签：ruby-on-rails

所以我正在自学 Ruby on Rails，具有 PHP 背景。我写了一个草率的概念验证 PHP 应用程序，名为“ [2NDP](http://rezich.com/storybored) ”。我想在 Ruby on Rails 中重新创建它（但更基本、更干净、界面更好），所以我可以学习一些的基础知识。

2NDP 是一个网站，您基本上可以在其中编写自己的“选择自己的冒险”书籍，但可以与其他人合作。我使用 PHP/MySQL 进行这项工作的方式是，我有一个故事表和一个页面表。这些页面将属于故事（显然），但每个页面将通过具有四个单独的列来引用最多四个其他页面，一个用于可以引用的每个可能的页面 ID。

所以现在在我的 RoR 应用程序中，我有“故事”，这些“故事”有与之关联的“页面”。我需要一种让页面相互引用的方法，但每页引用多个引用的可能性（一个页面最多可以引用四个其他页面）。

我真的很喜欢 RoR 的“引用”功能，但是有什么方法可以优雅地实现这种系统吗？请记住，我唯一的 RoR 经验是浏览四个教程，并且我正在尝试通过“现实生活中的应用程序”重新应用我所学的知识。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T08:42:58.680

与其有四个单独的列，一个单独的连接表可能更合适。例如：

页面 -> 链接页面 -> 页面

然后你可以通过关系创建一个[has_many 。](http://wiki.rubyonrails.org/rails/pages/Beginner+Howto+on+has_many+:through)

```
class Pages < ActiveRecord::Base
  has_many :linked_pages
  has_many :pages, :through => :linked_pages
end

class LinkedPages < ActiveRecord::Base
  belongs_to :pages, :class_name => "Pages", :foreign_key => "page_id"
  belongs_to :linked_pages, :class_name => "Pages", :foreign_key => "linked_id" 
end 
```

然后在使用 Page 对象时，您可以简单地说：

```
my_page.pages 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-12T02:30:00.633

Hates_, that was helpful, but if anyone needs a more in-depth explanation about this sort of thing, [read about it here](http://blog.hasmanythrough.com/2007/10/30/self-referential-has-many-through).

# c++ - 在资源管理器中打开

> ID：354902
> 
> 赞同：9
> 
> 时间：2008-12-10T02:05:57.763
> 
> 标签：c++, windows, explorer

如何通过 C++ 中的代码在资源管理器中打开路径。我用谷歌搜索，除了系统命令之外找不到任何东西，但是，我不希望它阻止或显示控制台窗口。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-10T02:18:38.347

您可能正在寻找[`ShellExecute()`](http://msdn.microsoft.com/en-us/library/bb762153(VS.85).aspx). `shellapi.h`它使用“动作动词”、路径和可选参数调用。在您的情况下，这将需要“打开”或“探索”，如下所示：

```
ShellExecuteA(NULL, "open", "C:\\", NULL, NULL, SW_SHOWDEFAULT); 
```

这将在 C: 处打开一个未附加的资源管理器窗口。ShellExecute() 将提供与在“运行”对话框中输入命令基本相同的操作。它还将处理 URL，因此以下将打开用户的默认浏览器：

```
ShellExecuteA(NULL, "open", "http://www.google.com", NULL, NULL, SW_SHOWDEFAULT); 
```

尽管请务必注意文档中关于 ShellExecute 依赖于 COM 的注释（尽管您的代码不必担心任何 COM 对象本身）。

```
CoInitializeEx(NULL, COINIT_APARTMENTTHREADED | COINIT_DISABLE_OLE1DDE) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T02:15:20.663

这不显示命令窗口，只是打开目录。

```
 system("explorer C:\\"); 

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-05-19T14:47:27.917

我现在正在使用 VS2017，使用如下工作：

```
ShellExecute(NULL, L"open", L"YourFolderPath\\YourFile.xxx", NULL, NULL, SW_RESTORE); 
```

还参考[ShellExecute 在 C++ 中打开一个 .exe](https://stackoverflow.com/questions/46558259/shellexecute-to-open-an-exe-in-c)

# foreach - foreach 和 map 有区别吗？

> ID：354909
> 
> 赞同：234
> 
> 时间：2008-12-10T02:09:29.117
> 
> 标签：foreach, language-agnostic, computer-science, map-function

好吧，这更像是一个计算机科学问题，而不是基于特定语言的问题，但是 map 操作和 foreach 操作之间有区别吗？还是它们只是同一事物的不同名称？

* * *

## 回答 #1

> 赞同：311
> 
> 时间：2008-12-10T02:14:53.393

不同的。

foreach 迭代一个列表并对每个列表成员**执行**一些具有副作用的操作（例如将每个成员保存到数据库中）

map 遍历一个列表，**转换**该列表的每个成员，并返回另一个与转换后的成员大小相同的列表（例如将字符串列表转换为大写）

* * *

## 回答 #2

> 赞同：138
> 
> 时间：2008-12-10T02:15:31.193

它们之间的重要区别是将`map`所有结果累积到一个集合中，而`foreach`什么也不返回。`map`当您想使用函数转换元素集合时通常使用它，而`foreach`只需为每个元素执行一个操作。

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2010-05-28T21:52:37.243

简而言之，`foreach`用于对元素集合的每个元素应用操作，而`map`用于将一个集合转换为另一个集合。

`foreach`和之间有两个显着差异`map`。

1.  `foreach`对其应用的操作没有概念上的限制，除了可能接受一个元素作为参数。也就是说，该操作可能什么都不做，可能有副作用，可能返回一个值，也可能不返回一个值。所有`foreach`关心的是遍历元素集合，并对每个元素应用操作。

    `map`另一方面，它确实对操作有限制：它期望操作返回一个元素，并且可能还接受一个元素作为参数。该`map`操作遍历元素集合，对每个元素应用该操作，最后将每次调用该操作的结果存储到另一个集合中。换句话说，`map` *将*一个集合转换为另一个集合。

2.  `foreach`适用于单个元素集合。这是输入集合。

    `map`使用两个元素集合：输入集合和输出集合。

将这两种算法联系起来并没有错：实际上，您可以分层查看这两种算法，`map`其中`foreach`. 也就是说，您可以使用`foreach`并让操作转换其参数并将其插入另一个集合。因此，`foreach`算法是算法的抽象、概括`map`。事实上，因为`foreach`它的操作没有限制，我们可以肯定地说这`foreach`是最简单的循环机制，它可以做任何循环可以做的事情。`map`以及其他更专业的算法是否具有表现力：如果您希望将一个集合映射（或转换）到另一个集合，`map`那么使用`foreach`.

我们可以进一步扩展这个讨论，并考虑`copy`算法：一个克隆集合的循环。该算法也是该算法的一种特殊化`foreach`。您可以定义一个操作，给定一个元素，将相同的元素插入另一个集合。如果您使用`foreach`该操作，您实际上执行了`copy`算法，尽管清晰度、表达性或明确性有所降低。让我们更进一步：我们可以说它`map`是 的一个特化`copy`，它本身就是 的一个特化`foreach`。`map`可能会*更改*它迭代的任何元素。如果`map`不更改任何元素，则它只是*复制*元素，并使用*复制*会更清楚地表达意图。

算法本身可能有`foreach`也可能没有返回值，具体取决于语言。例如，在 C++ 中，`foreach`返回它最初收到的操作。这个想法是操作可能有一个状态，并且您可能希望该操作返回以检查它是如何在元素上演变的。`map`也可能返回值，也可能不返回值。在 C++`transform`中（此处的等价物`map`）碰巧将迭代器返回到输出容器（集合）的末尾。在 Ruby 中， 的返回值`map`是输出序列（集合）。因此，算法的返回值实际上是一个实现细节；它们的效果可能是也可能不是它们返回的效果。

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2013-01-29T10:56:29.540

## `Array.protototype.map`方法 &`Array.protototype.forEach`都非常相似。

运行以下代码：[http ://labs.codecademy.com/bw1/6#:workspace](http://labs.codecademy.com/bw1/6#:workspace)

```
var arr = [1, 2, 3, 4, 5];

arr.map(function(val, ind, arr){
    console.log("arr[" + ind + "]: " + Math.pow(val,2));
});

console.log();

arr.forEach(function(val, ind, arr){
    console.log("arr[" + ind + "]: " + Math.pow(val,2));
}); 
```

**他们给出了准确的结果。**

```
arr[0]: 1
arr[1]: 4
arr[2]: 9
arr[3]: 16
arr[4]: 25

arr[0]: 1
arr[1]: 4
arr[2]: 9
arr[3]: 16
arr[4]: 25 
```

## 但是，当您运行以下代码时，就会出现转折：-

*在这里，我只是简单地分配了 map 和 forEach 方法的返回值的结果。*

```
var arr = [1, 2, 3, 4, 5];

var ar1 = arr.map(function(val, ind, arr){
    console.log("arr[" + ind + "]: " + Math.pow(val,2));
    return val;
});

console.log();
console.log(ar1);
console.log();

var ar2 = arr.forEach(function(val, ind, arr){
    console.log("arr[" + ind + "]: " + Math.pow(val,2));
    return val;
});

console.log();
console.log(ar2);
console.log(); 
```

**现在结果有点棘手！**

```
arr[0]: 1
arr[1]: 4
arr[2]: 9
arr[3]: 16
arr[4]: 25

[ 1, 2, 3, 4, 5 ]

arr[0]: 1
arr[1]: 4
arr[2]: 9
arr[3]: 16
arr[4]: 25

undefined 
```

# 结论

`Array.prototype.map`返回一个数组但`Array.prototype.forEach`不返回。因此，您可以在传递给 map 方法的回调函数中操作返回的数组，然后将其返回。

`Array.prototype.forEach`只遍历给定的数组，这样你就可以在遍历数组的同时做你的事情。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-12-10T02:59:54.957

最“明显”的区别是 map 将结果累积到一个新的集合中，而 foreach 仅针对执行本身进行。

但是还有一些额外的假设：由于 map 的“目的”是新的值列表，因此执行顺序并不重要。事实上，一些执行环境会生成并行代码，甚至引入一些 memoizing 以避免调用重复值，或者引入惰性，以完全避免调用一些。

另一方面，foreach 是专门针对副作用而调用的；因此顺序很重要，通常不能并行化。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2014-07-29T08:01:11.443

**简短的回答：** `map`并且`forEach`是不同的。此外，非正式地说，`map`是 的严格超集`forEach`。

**长答案：**`forEach`首先，让我们对and进行一行描述`map`：

*   `forEach`遍历所有元素，在每个元素上调用提供的函数。
*   `map`遍历所有元素，在每个元素上调用提供的函数，并通过记住每个函数调用的结果来生成一个转换后的数组。

在许多语言中，`forEach`通常称为 just `each`。以下讨论仅使用 JavaScript 作为参考。它真的可以是任何其他语言。

现在，让我们使用这些功能中的每一个。

### 使用`forEach`：

**任务 1：**编写一个函数`printSquares`，它接受一个数字数组`arr`，并打印其中每个元素的平方。

**解决方案1：**

```
var printSquares = function (arr) {
    arr.forEach(function (n) {
        console.log(n * n);
    });
}; 
```

### 使用`map`：

**任务 2：**编写一个函数`selfDot`，它接受一个数字数组`arr`，并返回一个数组，其中每个元素都是 中对应元素的平方`arr`。

旁白：在这里，用俚语来说，我们正在尝试对输入数组进行平方。正式地说，我们正在尝试计算它与自身的点积。

**解决方案2：**

```
var selfDot = function (arr) {
    return arr.map(function (n) {
        return n * n;
    });
}; 
```

### `map`的超集是怎样的`forEach`？

您可以使用`map`来解决两个任务**Task 1**和**Task 2**。但是，您不能用于`forEach`解决**Task 2**。

在**解决方案 1**中，如果您简单地替换`forEach`为`map`，该解决方案仍然有效。但是，在**解决方案 2**中，替换`map`为`forEach`会破坏您以前工作的解决方案。

### 实施`forEach`方面`map`：

实现优势的另一种方式`map`是在实施`forEach`方面`map`。由于我们是优秀的程序员，我们不会沉迷于命名空间污染。我们会打电话给我们的`forEach`，只是`each`。

```
Array.prototype.each = function (func) {
    this.map(func);
}; 
```

现在，如果你不喜欢`prototype`胡说八道，那就去吧：

```
var each = function (arr, func) {
    arr.map(func); // Or map(arr, func);
}; 
```

### 所以，嗯..为什么`forEach`甚至存在？

答案是效率。如果您对将一个数组转换为另一个数组不感兴趣，为什么要计算转换后的数组？只是为了倾倒吗？当然不是！如果您不想要转换，则不应该进行转换。

因此，虽然 map 可用于解决**Task 1**，但它可能不应该。因为每个人都是合适的人选。

* * *

### 原答案：

虽然我在很大程度上同意@madlep 的回答，但我想指出这`map()`是一个**严格的超**集`forEach()`.

是的，`map()`通常用于创建新数组。但是，它**也**可用于更改当前数组。

这是一个例子：

```
var a = [0, 1, 2, 3, 4], b = null;
b = a.map(function (x) { a[x] = 'What!!'; return x*x; });
console.log(b); // logs [0, 1, 4, 9, 16] 
console.log(a); // logs ["What!!", "What!!", "What!!", "What!!", "What!!"] 
```

在上面的示例中，`a`方便地设置`a[i] === i`为`i < a.length`. 即便如此，它也展示了`map()`.

[下面是官方的介绍`map()`](http://www.ecma-international.org/ecma-262/5.1/#sec-15.4.4.19)。请注意，`map()`甚至可能会更改调用它的数组！冰雹`map()`。

希望这有帮助。

* * *

2015 年 11 月 10 日编辑：添加了详细说明。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-05-13T07:56:27.977

这是 Scala 中使用列表的示例：map 返回列表，foreach 不返回任何内容。

```
def map(f: Int ⇒ Int): List[Int]
def foreach(f: Int ⇒ Unit): Unit 
```

因此 map 返回将函数 f 应用于每个列表元素的列表：

```
scala> val list = List(1, 2, 3)
list: List[Int] = List(1, 2, 3)

scala> list map (x => x * 2)
res0: List[Int] = List(2, 4, 6) 
```

Foreach 只是将 f 应用于每个元素：

```
scala> var sum = 0
sum: Int = 0

scala> list foreach (sum += _)

scala> sum
res2: Int = 6 // res1 is empty 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-10T02:19:28.393

如果您特别谈论 Javascript，则不同之处在于它`map`是一个循环函数，而`forEach`它是一个迭代器。

`map`当您想要对列表的每个成员应用操作并将结果作为新列表返回时使用，而不影响原始列表。

`forEach`当您想根据列表的每个元素做某事*时*使用。例如，您可能正在向页面添加内容。本质上，当您想要“副作用”时，它非常有用。

其他区别：`forEach`什么都不返回（因为它实际上是一个控制流函数），并且传入的函数获取对索引和整个列表的引用，而 map 返回新列表并且只传入当前元素。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-03-11T13:10:41.077

ForEach 尝试在 RDD 的每个元素上应用一个函数，例如写入 db 等，而不返回任何内容。

但是在`map()`rdd 的元素上应用了一些函数并返回 rdd。因此，当您运行以下方法时，它不会在第 3 行失败，但是在应用 foreach 后收集 rdd 时，它将失败并抛出一个错误，上面写着

> <module> 中的文件“<stdin>”，第 5 行
> 
> AttributeError：“NoneType”对象没有“收集”属性

```
nums = sc.parallelize([1,2,3,4,5,6,7,8,9,10])
num2 = nums.map(lambda x: x+2)
print ("num2",num2.collect())
num3 = nums.foreach(lambda x : x*x)
print ("num3",num3.collect()) 
```

# asp.net-mvc - Asp.Net MVC 路由：在 URL 中包含单个元素的最佳方式？

> ID：354927
> 
> 赞同：1
> 
> 时间：2008-12-10T02:21:37.810
> 
> 标签：asp.net-mvc, routing, seo

我将以 SO 网站为例。要转到问题列表，网址是 www.stackoverflow.com/questions。在幕后，这是一个控制器（其名称未知）和它的一个动作。假设这是**controller=home**和**action=questions**。

如何防止用户输入 www.stackoverflow.com/home/questions **，**这会导致相同的页面，并会降低页面的排名，就 SEO 而言**。**是否需要重定向来解决这个问题？是否需要一些特殊的路由规则来处理这种情况？还有什么？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T14:32:13.407

在[PDC 的 Phil Haack 的演讲中](http://haacked.com/archive/2008/09/15/stackoverflow-at-pdc.aspx)，Jeff 展示了 Stack Overflow 的一些源代码。他展示的其中包括一些路线注册的代码。他在控制器中有这些，我不清楚他是否使用默认路由。例如，如果没有默认路由，您就不必担心 /home/questions。

至于/questions/index，是的，永久重定向是要走的路。您不会因为永久重定向而受到任何搜索引擎惩罚。

另一种消除 /home/questions 的方法是使用路由约束。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T14:38:53.940

您想使用以下路线。您只需创建一条新路由，从而消除控制器在路由中的需要，这真的很容易。您创建一个仅包含操作的模板字符串，并将控制器默认为您要使用的控制器，例如“Home”。

```
routes.MapRoute(
    "MyRoute",
    "{action}",
    new { controller = "Home", action = (string)null },
    new { action = "[a-zA-z_]+" }
); 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T02:24:05.200

我假设控制器是`questions`，动作是`index`，即路由处理程序定义的默认动作。因此，该页面没有替代路径。

# gdi+ - GDI+到GDI之间转换的奇怪问题：Bitmap和HBitmap

> ID：354933
> 
> 赞同：1
> 
> 时间：2008-12-10T02:25:10.800
> 
> 标签：gdi+, bitmap, gdi, hbitmap

我想将 gdi+ Bitmap 转换为 gdi 对象 HBitmap。

我正在使用以下方法：

```
 Bitmap* img = new Bitmap(XXX);
            // lots of codes...
    HBITMAP temp;
    Color color;
    img->GetHBITMAP(color, &temp); 
```

img 对象正在对话框上绘制。当这部分方法被调用时，奇怪的事情发生了！窗口中显示的img改变了！它变得更清晰或更锐利。我的问题是会发生什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T07:10:05.000

位图像素格式可能是原因。您是否在 Bitmap 构造函数中明确指定它？

```
Gdiplus::Bitmap bmp(WIDTH, HEIGHT, PixelFormat24bppRGB); 
```

尝试确保您使用的所有像素格式都相同。

另一个原因可能是 `Gdiplus::Graphics`代码中插值模式的差异。该属性决定了如何调整图像大小、如何绘制线条等。

```
m_pViewPortImage = new Gdiplus::Bitmap(
    observedWidth,
    observedHeight,
    PixelFormat24bppRGB
);

Gdiplus::Graphics gr(m_pViewPortImage);
gr.SetInterpolationMode(Gdiplus::InterpolationModeHighQualityBicubic); 
```

# apache-flex - Flex - 2032：仅在 IE 中出现流错误

> ID：354936
> 
> 赞同：1
> 
> 时间：2008-12-10T02:28:11.573
> 
> 标签：apache-flex, flash, httpservice

响应在 IE 中返回“201 Created”的 POST 请求，我从 Flash 收到 2032 流错误（Firefox 工作正常）。由于 Flash 不提供对 HTTP 状态的访问，我无法判断它实际上已经成功。正在使用 HTTPService 发出请求。

有什么建议么？有没有其他人看过这个？

谢谢，亚历克斯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-01T02:53:47.997

我在我的 Flex on Rails 应用程序中找到了解决此问题的方法。我在 IE 中看到了同样的问题——我在 Rails 中的 development.log 给出了 201 消息，但这导致了返回给 Flex 的错误。*我在 Tony Hillerson 和 Daniel Wanja 合着的一本名为Flex On Rails*的新书中找到了参考资料，第 1 页。31\. 它涉及捕获 201 错误和更改标题。这是我的 ApplicationController 文件：

```
 class ApplicationController < ActionController::Base
  helper :all # include all helpers, all the time
  include AuthenticatedSystem
  before_filter :login_required

  after_filter :flex_error_handling
  def flex_error_handling
    response.headers['Status'] = interpret_status(200) if response.headers['Status'] == interpret_status(422)
    response.headers['Status'] = interpret_status(200) if response.headers['Status'] == interpret_status(201)
  end
  def rescue_action_in_public(exception)
    render_exception(exception)

  end
  def rescue_action_locally(exception)
    render_exception(exception)
  end
    rescue_from ActiveRecord::RecordNotFound, :with => :render_exception
  def render_exception(exception)
    render :text => "<errors><error>#{exception}</error></errors>", :status => 200
  end
end 
```

将 422 状态消息更改为 200 的操作是 Hillerman/Wanja 将 2032 Stream Error 更改为更友好的内容的原始建议的一部分，以便将无效记录错误发送回 Flex UI。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T07:14:17.597

Try using a debug proxy to take a peek at the traffic, I like [Charles](http://www.charlesproxy.com/).

# delphi - Class Helpers 应该用于开发新代码吗？

> ID：354940
> 
> 赞同：10
> 
> 时间：2008-12-10T02:31:24.967
> 
> 标签：delphi, oop, class-helpers

为了将 VCL/RTL 映射到 .NET 对象层次结构，Delphi 8 引入了 Class Helpers。它们允许将方法注入现有类，而无需覆盖该类或修改原始类。后来的 Delphi 版本发现类助手得到了改进，它们被移植到 Win32。

在帮助中它说“它们不应该被视为开发新代码时使用的设计工具。”

Class Helpers 违反了传统的 OOP，但我认为这并不会使它们成为一件坏事。这个警告是否合理？

开发新代码时应该使用类助手吗？

您在开发新代码时使用它们吗？

为什么或者为什么不？

根据[Malcolm 的评论](https://stackoverflow.com/questions/354940/should-class-helpers-be-used-in-developing-new-code#355086)：新代码意味着日常应用程序开发，其中您有一些 3rd 方库、一些现有代码，然后是您正在编写的代码。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-10T04:32:14.803

取决于您所说的“新代码”是什么意思。

它们与您新开发的类并不真正相关，因此在这种情况下，不，它们可能不应该使用。

但是即使在一个全新的项目中，您可能仍然需要修改一个您无法通过其他方式更改的现有类（vcl 类、第三方类等）。在这种情况下，当然，我会说继续。

他们本身并不邪恶。与大多数其他事物一样，您只需要了解它们的工作原理并在适当的环境中使用它们。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-10T10:05:56.500

在将类助手作为花哨代码的新工具之前，我认为您必须了解限制是包含。只能为一个类提供一个类助手。那么，如果您为您的类提供类帮助器，并且您的类派生自某个其他人为其提供了类帮助器的公共类，将会发生什么？

CodeGear 将类帮助器作为“黑客”引入以防止破坏事物，而不是作为一个很酷的设计功能。当您设计代码时，请在没有类助手的情况下进行设计。我知道你可以。在处理您可以控制的现有代码时，请使用重构。如果没有其他办法，请寻求班级帮手。

无论如何，这就是我的看法...

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-10T07:02:59.677

微软基于 LINQ 主要围绕他们的扩展方法。鉴于此，如果可以改进您的代码，您应该在新代码中使用 Class Helpers。请参阅[类助手有什么好的用途？](https://stackoverflow.com/questions/253399/what-are-good-uses-for-class-helpers)一些好的用途。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-10T13:33:34.833

我经常使用它们。我使用远程对象，那里的对象是由 RO 引擎创建的，所以你不能在不从它们下降的情况下添加它们，然后再进行其他一些乱七八糟的事情。类助手意味着我可以像对待任何其他对象一样对待它们。虽然一个类只能有一个助手，但您可以下降助手类，以便获得继承的行为。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-10T03:14:38.390

抱歉，暂时不能成为明显的队长：如果 Delphi 内部人员自己声明“不应将它们视为开发新代码时使用的设计工具”，那么根据定义，它们不应该被使用。它们只是为了自己的目的而扩展 VCL。还有谁会给你一个比写它的人更好的理由？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-10T15:08:46.250

我同意 Vegar 的观点：将班级助手作为紧急工具。当您知道它们是在规定时间内完成工作的唯一方法时。稍后，如果有时间，请删除它们。

我曾经忘记了一个参数化的事情，如果 Delphi 2006 中不存在类助手，那将花费大量的时间..... 使用类助手，需要 6 个小时才能使 thigs 正常工作。但是，这是一种紧急情况——类助手是一种晦涩难懂的语言特性，它给新开发人员遵循程序流程带来了困难。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-11T00:52:30.253

也许您可以使用的一个好方法是（就像我使用的那样）：

1.  **始终优先考虑继承**而不是类助手，只有在不能选择继承时才使用它们。
2.  优先**使用类助手而不是裸全局方法**。
3.  如果您需要的不仅仅是一个单元的扩展功能，请尝试其他的东西（**比如类包装器**）。

.Net Extensions 方法太相似了，并且出于完全相同的原因创建和支持：**制作基类的扩展（而不是**在 Delphi.Net 中进行升级而不是尝试使 Delphi 本机代码成为一种选择）与.Net代码“兼容” - 恕我直言，这太雄心勃勃了）

无论如何， Delphi 类助手在某些情况下**仍然是一个相当不错的工具。**

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-10T02:36:29.170

这些听起来像 C# 扩展方法。我想说，虽然当您无法修改需要扩展功能的类时，像这样的扩展方法很有用，但它们是设计您自己的代码的糟糕方法。在设计自己的代码时，您希望所有功能尽可能位于同一个代码文件中，而不是分散在不同的类中。我会说将它们用于它们的目的——基本上作为装饰器来为封闭的类添加新功能——并且不要在设计你自己的代码时使用它们。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-10T06:45:44.783

我发现自己越来越多地将它们用作设计结构。

我使用它们的情况：

*   在客户端/服务器设置中，我使用类助手扩展共享基类，以提供仅限服务器或客户端的功能。
*   用方便的工具功能补充 VCL/RTL 类（和其他第三方代码）。
*   当类不共享相同的继承树时解决差异（例如，使用帮助器可以具有通用的 Count 和 Items 属性）。

事实上，我希望 Delphi 能够接受同一个基类的多个助手——如果我没记错的话，我什至已经为此提出了请求。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-10T08:14:25.227

我发现[这篇文章](http://www.gotw.ca/publications/mill02.htm)很有趣。它处理 C++，但主要思想与语言无关。主要要点是，即使在 OOP 环境中，全局例程有时也比方法更可取。从这个角度来看，对类助手的需求较少。

# subsonic - 如何获得更多从亚音速查询我的数据源的方法

> ID：354941
> 
> 赞同：0
> 
> 时间：2008-12-10T02:32:07.930
> 
> 标签：subsonic

在下面的链接中，Linq-To-Sql 生成了一系列方法来根据各种实际需求（例如最近的主题等）获取数据。

如何让 Subsonic 为我生成一组类，这些类将以这种方式从我的数据源中查询并返回数据？我得到的课程实际上只是呈现 CRUD 操作。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-04T10:51:12.950

我使用 SubSonic 的方式是按照您希望数据格式化的方式创建视图，然后使用 SubSonic 检索它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-04T19:13:03.103

我在这里看不到链接，但总的来说，我会说你可以使用 SubSonic 3，就像使用 Linq to Sql 一样。这是一些示例代码：

[http://subsonicproject.com/docs/Linq_Select_Queries](http://subsonicproject.com/docs/Linq_Select_Queries)

除此之外，我需要更具体的例子。

# .net - 您可以将列表框中的选定项目绑定到 WPF 中的单独对象吗？

> ID：354942
> 
> 赞同：3
> 
> 时间：2008-12-10T02:32:32.343
> 
> 标签：.net, wpf, data-binding, xaml

如果我有两个对象，一个是项目列表，另一个具有存储另一个列表的选定项目的属性，是否可以通过 WPF 中的绑定来更新选定项目？

假设我有这两个数据结构：

```
public class MyDataList
{
    public ObservableCollection<Guid> Data { get; set; }
}

public class MyDataStructure
{
    public Guid ChosenItem { get; set; }
} 
```

是否可以将 Listbox 绑定到两个对象的实例，以便通过 ListBox 的选定项设置 ChosenItem 属性？

编辑：为了让事情更清楚一点，可能有许多 MyDataStructure 实例，每个实例都有一个从 MyDataList 中选择的项目。数据列表对所有实例都是通用的，我需要一种方法来选择一个项目并将该选择存储在 MyDataStructure 中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T04:12:32.923

我相信你应该能够做到这一点（确保声明本地命名空间）：

```
<Window.Resources>
    <local:MyDataStructure x:Key="mds1" />
</Window.Resources>    
<ListBox ItemsSource="{Binding Data}" SelectedValue="{Binding Source={StaticResource mds1} Path=ChosenItem}"/> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T03:27:29.410

将这两个属性放在一个类中（只是为了简化解决方案）并使代码为属性更改事件做好准备

```
 public class MyDataList : INotifyPropertyChanged
{
    private Guid _choosen;

    public ObservableCollection<Guid> Data { get; set; }

    public Guid ChosenItem {
        get
        {
            return _choosen;
        }
        set 
        {
            _choosen = value;
            PropertyChanged(this, new PropertyChangedEventArgs("ChosenItem"));
        } 
    }

    public event PropertyChangedEventHandler PropertyChanged;
} 
```

创建此类的实例并绑定到 ListBox 的 DataContext 现在编写 ListBox XAML 代码，如下所示。SelectedValue 绑定在这里起到了作用。

```
<ListBox ItemsSource="{Binding Data}" SelectedValue="{Binding Path=ChosenItem}" x:Name="listBox"/> 
```

# c# - 在以下字符串中获取表名的最有效方法

> ID：354945
> 
> 赞同：1
> 
> 时间：2008-12-10T02:35:44.460
> 
> 标签：c#, string

在这种情况下，获取模式 + 表名的最有效方法是什么：

选择 [t0].[Id], [t0].[CODE] AS [arg0], [t0].[DESC] AS [arg1] FROM [SchemaName].[TableName] AS [t0] WHERE ([t0]. [ID] <> @p0)

结果需要是：“SchemaName.TableName” ....

我正在使用 C#。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T02:44:41.337

我的猜测是使用 Substrings 进行一些好的旧字符串解析。一些代码：

```
 string q = @"SELECT [t0].[Id], [t0].[CODE] AS [arg0], [t0].[DESC] AS [arg1] FROM [SchemaName].[TableName] AS [t0] WHERE ([t0].[Id] <> @p0)";
            int fromIndex = q.IndexOf("FROM")+5;
            int asIndex = q.IndexOf("AS",fromIndex);
            q = q.Substring(fromIndex, asIndex - fromIndex); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T03:03:09.320

或者您可以使用正则表达式：

```
string data = "SELECT [t0].[Id], [t0].[CODE] AS [arg0], [t0].[DESC] AS [arg1] FROM [SchemaName].[TableName] AS [t0] WHERE ([t0].[Id] <> @p0)";
Regex re = new Regex(@"FROM ((\[\w+\]\.?){2}) AS");
Match m = re.Match(data);
if (m.Success){ Console.WriteLine(m.Groups[1]); } 
```

或者，如果您不想包含括号：

```
string data = "SELECT [t0].[Id], [t0].[CODE] AS [arg0], [t0].[DESC] AS [arg1] FROM [SchemaName].[TableName] AS [t0] WHERE ([t0].[Id] <> @p0)";
Regex re = new Regex(@"FROM \[(\w+)\]\.\[(\w+)\]\ AS");
Match m = re.Match(data);
if (m.Success){ Console.WriteLine("{0}.{1}", m.Groups[1], m.Groups[2]); } 
```

# vhdl - 如何使 Quartus II 编译更快

> ID：354962
> 
> 赞同：7
> 
> 时间：2008-12-10T02:46:29.320
> 
> 标签：vhdl, quartus

我正在使用 Altera Quartus 2 做一个定制的 8 位处理器，在我的笔记本电脑上编译需要很长时间。我只使用模拟并将我的处理器制作成原理图（框图）和 VHDL。现在编译大约需要 10 分钟，这很痛苦，因为我更多地处于项目的调试阶段，我必须修复内部时序并进行大量非常小的更改以查看会发生什么。

我实际上并没有把它放在FPGA上，所以我需要“fitter”和“assembler”的编译阶段吗？

我可以更改一个 lpm_ram_dq 的内存文件的内容并在模拟中测试它而不重新编译吗？

总之，有人知道如何让它编译得更快吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2017-10-26T21:43:15.200

如果您不关心完全优化您的结果而只想获得悲观估计或进行比较，一些有用的标志可以使 Quartus 合成更快。

```
set_global_assignment  -name PHYSICAL_SYNTHESIS_EFFORT  FAST 
```

> 指定物理综合应使用的编译时间方面的工作量。快速使用较少的编译时间，但可能会降低物理综合能够实现的性能增益。

```
set_global_assignment  -name FITTER_EFFORT              FAST_FIT 
```

> Fast Fit 减少了优化工作以减少编译时间，这可能会降低设计性能。

而不是`execute_flow -compile`, 使用：

```
execute_flow -implement 
```

> 运行编译到路由阶段并在之后跳过所有时间密集型算法的选项。

在与 Intel/Altera 工程师的一次会议上，使用`-implement`它被认为比 快 20% `-compile`，并且在迭代时序收敛结果时被推荐使用。

您还可以尝试以下方法：

```
set_global_assignment  -name SYNTHESIS_EFFORT           FAST 
```

*注意：*这有以下警告，尽管我倾向于在某些设计中看到总体上更快的运行。

> 设置为 Fast 时，省略了一些步骤以更快地完成合成；但是，可能会有一些性能和资源成本。Altera 建议仅在运行早期时序估计时将此选项设置为 Fast。**运行“快速”综合产生的网表对 Fitter 来说稍微难以布线，从而使整个拟合过程变慢**，这抵消了“快速”综合所带来的任何性能提升。

**编辑：**

以下设置会影响您的时间，但它们也有助于显着缩短编译时间，尤其是在较新的 Stratix 10/Agilex 设计上：

```
set_global_assignment -name OPTIMIZATION_MODE          "AGGRESSIVE COMPILE TIME"
set_global_assignment -name ALLOW_REGISTER_RETIMING    "OFF"
set_global_assignment -name HYPER_RETIMER_FAST_FORWARD "OFF" 
```

您还可以使用以下命令关闭时序分析：

```
set_global_assignment -name TIMEQUEST_MULTICORNER_ANALYSIS "OFF" 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-17T18:42:41.637

按重要性递减顺序。

*   更多内存。32 位操作系统为 4 GB。有些设计需要更多，并且需要 64 位操作系统。
*   不要过度约束设计。
*   更改编译选项以不那么努力。那在 assignments> settings> Fitter Settings>Fast Fit (or Auto Fit)
*   8.1 支持多核。
*   分层编译帮助，特别是如果您有同一个块的多个实例。

2分钟真的很短，我同意之前的海报。一个单一的门将需要很长时间。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T18:11:43.337

一些事情：

*   如果您不将其放在 FPGA 上，为什么要使用 Quartus 进行编译？只需使用 Modelsim 或 ActiveHDL 或您拥有的任何模拟器对其进行模拟。
*   2 分钟是一个**非常**短的编译时间。真的 ：-）
*   试试 Quartus 8，它比 7 和更早版本快得多
*   要检查您的代码是否正确合成并查看网表，您确实不需要 fitter 和 assembler 步骤

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-04T11:40:04.437

如果您只需要在 Quartus 中进行仿真，则不必运行完整的编译。如果按 Ctrl-K，则仅执行分析和详细说明。quartus 模拟器应该为你做这件事。

其他几个人提到的 OTH：10 分钟非常短的编译时间。对于真正的设计，让它运行至少一个小时并不罕见。

# java - 在 Java 中，什么时候应该使用“Object o”而不是泛型？

> ID：354967
> 
> 赞同：11
> 
> 时间：2008-12-10T02:48:39.787
> 
> 标签：java, generics

例如，我可以写以下任何一种：

```
class example <T>
{
    ...

    public void insert (T data)
    {
        ...
    }
} 
```

或者

```
class example
{
    ...

    public void insert (Object o)
    {
        ...
    }
} 
```

两者在性能方面有显着差异吗？使用泛型我可以限制参数的类型，而使用第二种方法我想在创建对象时没有必要定义它的类型。

另外，使用第二种方法，我基本上可以在课堂上插入任何东西，对吧？而对于泛型，类中的每个元素都将属于同一类型。

还有什么我想念的吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-10T02:54:29.680

编写后者的唯一原因是您必须针对较早的 JVM。泛型是通过类型擦除实现的，因此它们没有运行时影响 - 仅添加了编译时检查，这将改进您的代码。

当然，如果您需要一个包含任何旧对象的集合，或者几个没有共同超类的混合，您需要普通的 Object 变体（但是您的类仍然可以是通用的并用 new ...<对象>）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-10T02:55:23.187

我认为你几乎钉了它。没有性能差异。编译代码时，泛型被合理化（[Type Erasure](http://java.sun.com/docs/books/tutorial/java/generics/erasure.html)），并且在运行时不再存在。他们只是在需要时添加强制转换并按照您的说明进行类型检查。Neal Gafter 对它们的工作方式、泛型的当前问题以及如何在下一版本的 Java 中解决它们进行了很好的概述：http: [//gafter.blogspot.com/2006/11/reified-generics-for- java.html](http://gafter.blogspot.com/2006/11/reified-generics-for-java.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-10T03:06:34.680

应该没有性能差异。

但是，Java 不提供参数变化，因此在某些情况下，您将不得不使用 Objects 来覆盖 pre-generics 函数，例如 equals、compareTo 等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-10T11:32:39.913

关于性能，我同意上面的人。

关于你的这一点

“另外，使用第二种方法，我基本上可以在类中插入任何东西，对吧？而使用泛型，类中的每个元素都将属于同一类型。”

泛型的另一个优点是对示例实例本身的分配进行类型检查。

例如，假设您有一个 Example e1 of 和另一个 Example e2 of ，类型安全将得到维护，您将永远无法做到 e1=e2;

而对于对象示例，这是可能的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-10T09:37:16.137

我不得不使用“对象”而不是泛型的一些遭遇是强迫而不是选择。在使用前通用代码或围绕前通用 api 构建的库时，几乎没有选择。例如，动态代理 Proxy.newProxy() 返回 Object 类型。传递通用上下文（上下文可以是任何东西）是另一个实例。我的一些朋友认为这与非泛型一样好。就性能而言，考虑到类型擦除，不应该有任何开销。

# sql - 为什么 SQL 标准不提供指定 FD 而非超级键的方法？

> ID：354972
> 
> 赞同：3
> 
> 时间：2008-12-10T02:53:20.993
> 
> 标签：sql, database, database-design

在我看来，您可能希望声明其他功能依赖项（当然除了超级键），但 SQL 并没有提供简单的方法来做到这一点。为什么是这样？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T03:27:46.367

我不知道“为什么”SQL 委员会按照他们的方式设计它的第一手答案，但我认为 SQL 的设计者只想要一个普通表中的一个主键。3NF 数据库设计中的所有其他列在功能上都依赖于该键，并且仅依赖于该键。

您可以从功能依赖项派生键，同样您可以从超级键派生功能依赖项。但前提是它们以逻辑对称的方式正确声明。

如果您可以*同时*声明键和 FD，那么就有可能声明一个与自身发生逻辑冲突的表，这会破坏规范化。

语言最好只提供一种机制，以避免模棱两可的声明。

# ruby-on-rails - 如何告诉 ActiveScaffold 始终在列表视图中显示搜索表单？

> ID：354976
> 
> 赞同：2
> 
> 时间：2008-12-10T02:55:25.183
> 
> 标签：ruby-on-rails, activescaffold

ActiveScaffold 列表视图有一个搜索表单，当用户单击搜索链接时，该表单会通过 ajax 加载。我希望在用户打开列表页面时默认显示表单。

我想出了一种在页面加载时触发 ajax 调用的方法，但我想知道是否有办法让 ActiveScaffold 自动呈现表单。是否有我可以覆盖的模板或方法？我已经查看了代码，但至少对我来说没有什么明显的。

更新：

srboisvert 的回答启发了我更好地了解。

诀窍是使用模板覆盖来重构以下内容：list.rhtml、_list_header.rhtml、_search.rhtml，以便搜索表单部分呈现内联。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-03T21:10:57.247

有一种方法可以让它自动呈现：

active_scaffold :model 做 |config| config.list.always_show_search = true 结束

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T11:29:10.047

我目前手头没有一个活跃的脚手架项目，但这是我想弄清楚的方法。

我会使用安装了 firebug 的 firefox，并查看单击链接时调用的内容。然后我会去看看那个 javascript 以及它正在生成什么。然后，我将在源代码中搜索对于搜索框 ajax 而言相当独特的代码或组合的任何部分。之后，它应该很容易在没有 ajaxyness 的情况下剪切和过去。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-08T18:45:13.787

选项

`config.list.always_show_search = true`

工作正常，但仅在具体控制器上。在 AS set_default 块中使用时会引发异常。有人知道更好的解决方案，然后将其包含在每个控制器中（除了覆盖方便但版本更新复杂的模板）

# sql - SQL Server 2005 中的大规模交叉连接

> ID：354981
> 
> 赞同：2
> 
> 时间：2008-12-10T03:01:29.820
> 
> 标签：sql, sql-server, sql-server-2005, performance, cross-join

我正在移植一个创建`CROSS JOIN`两个表的 MASSIVE 的进程。结果表包含 15m 条记录（看起来该过程与 2600 行表和 12000 行表进行 30m 交叉连接，然后进行一些必须将其分成两半的分组）。行相对较窄 - 只有 6 列。它已经运行了5个小时，没有完成的迹象。我只是注意到已知商品和我对交叉连接的期望之间的计数差异，所以我的输出没有分组或重复数据删除，这将使决赛桌减半 - 但这似乎仍然不会完成任何时间很快。

首先，如果可能的话，我将寻求从流程中消除该表 - 显然它可以通过单独加入两个表来替换，但现在我无法看到它使用的其他任何地方。

但是鉴于现有的流程可以做到（在更短的时间内，在功能不太强大的机器上，使用 FOCUS 语言），是否有任何选项可以提高`CROSS JOIN`SQL Server（2005）中大 s 的性能（硬件不是真正的选项，这个盒子是 64 位 8 路 32 GB RAM）？

细节：

它是在 FOCUS 中以这种方式编写的（我试图产生相同的输出，它是 SQL 中的 CROSS JOIN）：

```
JOIN CLEAR *
DEFINE FILE COSTCENT
  WBLANK/A1 = ' ';
  END
TABLE FILE COSTCENT
  BY WBLANK BY CC_COSTCENT
  ON TABLE HOLD AS TEMPCC FORMAT FOCUS
  END

DEFINE FILE JOINGLAC
  WBLANK/A1 = ' ';
  END
TABLE FILE JOINGLAC
  BY WBLANK BY ACCOUNT_NO BY LI_LNTM
  ON TABLE HOLD AS TEMPAC FORMAT FOCUS INDEX WBLANK

JOIN CLEAR *
JOIN WBLANK IN TEMPCC TO ALL WBLANK IN TEMPAC
DEFINE FILE TEMPCC
  CA_JCCAC/A16=EDIT(CC_COSTCENT)|EDIT(ACCOUNT_NO);
  END
TABLE FILE TEMPCC
  BY CA_JCCAC BY CC_COSTCENT AS COST CENTER BY ACCOUNT_NO
  BY LI_LNTM
  ON TABLE HOLD AS TEMPCCAC
  END 
```

所以所需的输出实际上是一个 CROSS JOIN （它从每一侧加入一个空白列）。

在 SQL 中：

```
CREATE TABLE [COSTCENT](
       [COST_CTR_NUM] [int] NOT NULL,
       [CC_CNM] [varchar](40) NULL,
       [CC_DEPT] [varchar](7) NULL,
       [CC_ALSRC] [varchar](6) NULL,
       [CC_HIER_CODE] [varchar](20) NULL,
 CONSTRAINT [PK_LOOKUP_GL_COST_CTR] PRIMARY KEY NONCLUSTERED
(
       [ID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY
= OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

CREATE TABLE [JOINGLAC](
       [ACCOUNT_NO] [int] NULL,
       [LI_LNTM] [int] NULL,
       [PR_PRODUCT] [varchar](5) NULL,
       [PR_GROUP] [varchar](1) NULL,
       [AC_NAME_LONG] [varchar](40) NULL,
       [LI_NM_LONG] [varchar](30) NULL,
       [LI_INC] [int] NULL,
       [LI_MULT] [int] NULL,
       [LI_ANLZ] [int] NULL,
       [LI_TYPE] [varchar](2) NULL,
       [PR_SORT] [varchar](2) NULL,
       [PR_NM] [varchar](26) NULL,
       [PZ_SORT] [varchar](2) NULL,
       [PZNAME] [varchar](26) NULL,
       [WANLZ] [varchar](3) NULL,
       [OPMLNTM] [int] NULL,
       [PS_GROUP] [varchar](5) NULL,
       [PS_SORT] [varchar](2) NULL,
       [PS_NAME] [varchar](26) NULL,
       [PT_GROUP] [varchar](5) NULL,
       [PT_SORT] [varchar](2) NULL,
       [PT_NAME] [varchar](26) NULL
) ON [PRIMARY]

CREATE TABLE [JOINCCAC](
       [CA_JCCAC] [varchar](16) NOT NULL,
       [CA_COSTCENT] [int] NOT NULL,
       [CA_GLACCOUNT] [int] NOT NULL,
       [CA_LNTM] [int] NOT NULL,
       [CA_UNIT] [varchar](6) NOT NULL,
 CONSTRAINT [PK_JOINCCAC_KNOWN_GOOD] PRIMARY KEY CLUSTERED
(
       [CA_JCCAC] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY
= OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY] 
```

使用 SQL 代码：

```
INSERT  INTO [JOINCCAC]
       (
        [CA_JCCAC]
       ,[CA_COSTCENT]
       ,[CA_GLACCOUNT]
       ,[CA_LNTM]
       ,[CA_UNIT]
       )
       SELECT  Util.PADLEFT(CONVERT(varchar, CC.COST_CTR_NUM), '0',
                                     7)
               + Util.PADLEFT(CONVERT(varchar, GL.ACCOUNT_NO), '0',
                                       9) AS CC_JCCAC
              ,CC.COST_CTR_NUM AS CA_COSTCENT
              ,GL.ACCOUNT_NO % 900000000 AS CA_GLACCOUNT
              ,GL.LI_LNTM AS CA_LNTM
              ,udf_BUPDEF(GL.ACCOUNT_NO, CC.COST_CTR_NUM, GL.LI_LNTM, 'N') AS CA_UNIT
       FROM   JOINGLAC AS GL
       CROSS JOIN COSTCENT AS CC 
```

根据随后如何使用此表，它应该能够从流程中消除，只需加入用于构建它的两个原始表即可。但是，这是一个非常大的移植工作，我可能有一段时间找不到表的用法，所以我想知道是否有任何技巧可以`CROSS JOIN`及时 ing 像这样的大表（特别是考虑到现有的流程in FOCUS 能够更快地做到这一点）。这样我就可以验证我构建替换查询的正确性，然后用视图或其他方式将其分解。

我还在考虑将 UDF 和字符串操作分解并首先执行 CROSS JOIN 以稍微分解该过程。

**到目前为止的结果：**

事实证明，UDF 确实对性能有很大贡献（负面）。但是 15m 行交叉连接和 30m 行交叉连接之间似乎也存在很大差异。我没有 SHOWPLAN 权限（嘘），所以我无法判断它使用的计划在更改索引后是更好还是更差。我还没有重构它，但我希望整个表很快就会消失。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T05:41:09.967

检查该查询显示仅使用了一个表中的一列，并且仅使用了另一表中的两列。由于使用的列数非常少，因此可以通过覆盖索引轻松增强此查询：

```
CREATE INDEX COSTCENTCoverCross ON COSTCENT(COST_CTR_NUM)
CREATE INDEX JOINGLACCoverCross ON JOINGLAC(ACCOUNT_NO, LI_LNTM) 
```

以下是我进一步优化的问题：

当您将查询放入查询分析器并点击“显示估计的执行计划”按钮时，它将显示它将要做什么的图形表示。

连接类型：那里应该有一个嵌套循环连接。（其他选项是合并连接和哈希连接）。如果您看到嵌套循环，则可以。如果您看到合并连接或哈希连接，请告诉我们。

表格访问顺序：一直到顶部并一直滚动到右侧。第一步应该是访问一个表。那是哪个表，使用什么方法（索引扫描，聚集索引扫描）？使用什么方法访问另一个表？

并行性：您应该在计划中的几乎所有图标上看到锯齿状的小箭头，表明正在使用并行性。如果你看不到这一点，那就是一个大问题！

udf_BUPDEF 与我有关。它是否从其他表中读取？Util.PADLEFT 不太关心我，但仍然.. 它是什么？如果它不是数据库对象，请考虑改用它：

```
RIGHT('z00000000000000000000000000' + columnName, 7) 
```

JOINCCAC 上是否有任何触发器？索引呢？使用这么大的插入，您将希望删除该表上的所有触发器和索引。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-10T06:00:25.060

继续其他人的说法，包含在 select 中使用的查询的 DB 函数总是使我的查询非常慢。在我的脑海中，我相信我在 45 秒内运行了一个查询，然后我删除了这个函数，然后结果是 0 秒 :)

所以检查 udf_BUPDEF 没有做任何查询。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-10T05:08:24.730

分解查询，使其成为一个简单的交叉连接。

```
 SELECT  CC.COST_CTR_NUM, GL.ACCOUNT_NO
              ,CC.COST_CTR_NUM AS CA_COSTCENT
              ,GL.ACCOUNT_NO AS CA_GLACCOUNT
              ,GL.LI_LNTM AS CA_LNTM
-- I don't know what is BUPDEF doing? but remove it from the query for time being
--              ,udf_BUPDEF(GL.ACCOUNT_NO, CC.COST_CTR_NUM, GL.LI_LNTM, 'N') AS CA_UNIT
       FROM   JOINGLAC AS GL
       CROSS JOIN COSTCENT AS CC 

```

看看简单的交叉连接有多好？（没有应用任何功能）

# entity-framework - ADO.NET 实体：从 3 个表中获取数据

> ID：354993
> 
> 赞同：3
> 
> 时间：2008-12-10T03:12:51.670
> 
> 标签：entity-framework, ado.net

我有以下表结构：

```
Table: Plant
 PlantID: Primary Key
 PlantName: String

Table: Party
 PartyID: Primary Key
 PartyName: String
 PlantID: link to Plant table

Table: Customer
 PartyID: Primary Key, link to Party
 CustomerCode: String 
```

我想要具有以下字段的客户实体对象：

```
 PartyID: Primary Key
 CustomerCode: String
 PartyName: String
 PlantName: String 
```

我在使用 PlantName 字段时遇到问题（它是从 Plant 表中带来的，我将 Customer 与 Party 和 Party 与 Plant 关联起来但是我无法将 Customer 与 Plant 关联起来（因为它没有关联）我无法将 Plant 表添加到映射，当我这样做时 - 我收到以下错误：

```
Error 3024: Problem in Mapping Fragment starting at line 352: Must specify mapping for all key properties (CustomerSet.PartyID) of the EntitySet CustomerSet 
```

删除植物协会的作品。非常感谢任何提示或方向。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T13:01:00.907

您可以通过使用实体对象上的引用路径来获取这些字段。

要获取 PartyName，请使用以下语法： `Customer.Party.PartyName`

要获取 PlantName，请使用以下语法： `Customer.Party.Plant.PlantName`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-06T22:51:43.000

您可以使用公共部分类扩展 Customer 实体：

```
public partial class Customer
{
  public string PartyName
  {
    get { return Party.PartyName; }
    set { Party.PartyName = value; }
  }

  public string PlantName
  {
    get { return Party.Plant.PlantName; }
    set { Party.Plant.PlantName = value; }
  }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-06T22:42:07.063

经过一番研究，我在 MSDN 上看到了这个[帖子](http://social.msdn.microsoft.com/forums/en-US/adodotnetentityframework/thread/010baca7-0d40-49a6-8fb3-466fb22471ac/)，上面说你可以创建一个只读实体，这足以让你不能单独使用它，但它会变得更糟。您还将失去根据数据库架构动态更新*所有模型的能力。*

# svn - 如何从我的 subversion 主机帐户创建转储文件？

> ID：354994
> 
> 赞同：6
> 
> 时间：2008-12-10T03:13:30.687
> 
> 标签：svn

我将我的 SVN 存储库托管在某个地方。我想搬到别人家。如何创建存储库的转储，以便将其导入新主机？这就是我一直看到的：svnadmin dump /path/to/repos > repos.dump

我的存储库是托管的，所以它不是本地的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-10T14:56:59.753

您还可以使用[svnsync](http://svnbook.red-bean.com/en/1.5/svn.ref.svnsync.c.help.html)创建存储库的副本。

这需要在目标存储库上添加一个 pre-revprop-change 挂钩（并且需要在您的托管服务提供商处使用 Subversion 1.4 或更新的存储库）。

将存储库 svnsync 到您管理的系统后，如果需要转储文件（或仅使用同步到存储库），可以使用 svnadmin 转储本地副本。

[2011 年更新：] 从 Subversion 1.7 开始，有一个名为的工具`svnrdump`，您可以使用该工具从远程存储库中一步创建转储文件。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-10T03:19:49.410

svnadmin dump 是[迁移存储库](http://svnbook.red-bean.com/en/1.1/ch05s03.html#svn-ch-5-sect-3.5)的推荐方法，但您需要 shell 访问权限才能执行此操作，否则您必须联系您的托管服务提供商并要求他们为您执行完整的存储库转储。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-20T17:08:22.120

听起来你需要一个[远程 SVN 转储命令](http://rsvndump.sourceforge.net/)。我没有使用它，但它声称可以做你想做的事。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-12-06T11:54:59.040

一些托管存储库提供订购 SVN 转储文件的方法，包括在价格中或按月支付额外费用。如果他们不这样做，您可以随时进行 svnsync，而无需涉及托管公司。

Take a look at your destination provider's import capabilities as well. At [ProjectLocker](http://www.projectlocker.com), we support import of a remote repository that is visible over the Internet if you provide the URL to the source repository and your credentials. I don't believe we are the only host to do this. That capability saves you the trouble of learning svnsync, and you can focus on moving your code and getting back to writing software.

# asp.net - 如何停止执行进入 UserControls PageLoad 方法？

> ID：354998
> 
> 赞同：1
> 
> 时间：2008-12-10T03:15:54.927
> 
> 标签：asp.net, webusercontrol

我有一个 MasterPage，我的 Usercontrol 在 div 中。

我可以将 visible=false 设置为 UserControl 和包含的 div，这可以正常工作。但是 UserControl 的 Page_Load 总是被命中。

这是设计使然，还是我错过了如何停止进入 UserControl 的 Page_Load 方法的页面执行。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T03:37:32.463

当您将 UserControl 添加到页面时，它将在每次执行页面时被实例化并添加到 Page.Controls 集合中。当您将 Visible 设置为 false 时，它​​基本上只是缩短了控件 html 的呈现，因此它不会显示在页面上。

如果您的控件在“Page_Load”中执行了一些昂贵的操作，我将关闭 Visible 属性以规避该操作。

如果控件从未创建，你怎么能告诉它是不可见的？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T01:47:50.807

您不能停止执行进入用户控件的 PageLoad 事件方法。

@joshperry 建议使用 Visible 属性来确定是否在代码中进行耗时的操作是一个不错的选择。

另一个选项是完成 OnPreRender 事件方法中的耗时选项。*********