# StackOverflow 问答 000159000-000159999

# c++ - C++ 枚举中的最大值和最小值

> ID：159006
> 
> 赞同：86
> 
> 时间：2008-10-01T18:27:26.500
> 
> 标签：c++, enums

有没有办法在 c++ 中找到枚举的最大和最小定义值？

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2008-10-01T18:30:33.747

不，没有办法找到 C++ 中任何枚举的最大和最小定义值。当需要此类信息时，定义 Last 和 First 值通常是一种很好的做法。例如，

```
enum MyPretendEnum
{
   Apples,
   Oranges,
   Pears,
   Bananas,
   First = Apples,
   Last = Bananas
}; 
```

不需要为`First`和之间的每个值命名值`Last`。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-10-01T18:32:01.137

不，不在标准 C++ 中。您可以手动完成：

```
enum Name
{
   val0,
   val1,
   val2,
   num_values
}; 
```

`num_values`将包含枚举中值的数量。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-01T18:39:40.200

不，C 或 C++ 中的枚举只是一个常量列表。没有更高的结构可以保存这些信息。

通常当我需要这种信息时，我会在枚举中包含一个最大值和最小值，如下所示：

```
enum {
  eAaa = 1,
  eBbb,
  eCccc,
  eMin = eAaaa,
  eMax = eCccc
} 
```

有关这如何有用的一些示例，请参阅此网页：[愚蠢的枚举技巧](http://www.edm2.com/0405/enumeration.html)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-02T08:25:26.453

```
 enum My_enum
    {
       FIRST_VALUE = 0,

       MY_VALUE1,
       MY_VALUE2,
       ...
       MY_VALUEN,

       LAST_VALUE
    }; 
```

定义后，My_enum::LAST_VALUE== N+1

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2021-05-21T18:24:14.457

尽管接受的答案正确地指出没有标准化的方法来获取元素的`min`和`max`值`enum`，但在较新版本的 gcc (>= 9.0) 中至少有一种可能的方法，它允许这样写：

```
enum class Fruits { Apples, Oranges, Pears, Bananas };

int main() {
    std::cout << "Min value for Fruits is " << EnumMin<Fruits>::value << std::endl; // 0
    std::cout << "Max value for Fruits is " << EnumMax<Fruits>::value << std::endl; // 3
    std::cout << "Name: " << getName<Fruits, static_cast<Fruits>(0)>().cStr() << std::endl; // Apples
    std::cout << "Name: " << getName<Fruits, static_cast<Fruits>(3)>().cStr() << std::endl; // Bananas
    std::cout << "Name: " << getName<Fruits, static_cast<Fruits>(99)>().cStr() << std::endl; // (Fruits)99
} 
```

这无需任何自定义特征或提示即可工作。

*这是一个非常粗略的概念证明，我相信它可以进一步扩展，这只是为了表明这在今天是可能的。*

*此代码段在 C++14 中编译，并进行了一些调整，它肯定也可以在 C++11 中运行，但我认为这在 C++11 之前的版本中是不可能的*

**警告**：这可能会在未来的编译器版本中中断。

[现场演示](https://godbolt.org/z/4fvGYe7vM)

* * *

## 回答 #6

> 赞同：-6
> 
> 时间：2010-10-23T18:35:56.323

你甚至不需要它们，我所做的只是我说，例如，如果你有：

```
enum Name{val0,val1,val2}; 
```

如果您有 switch 语句并检查是否达到最后一个值，请执行以下操作：

```
if(selectedOption>=val0 && selectedOption<=val2){

   //code
} 
```

# jquery - 使用 jquery 和经典 asp 在服务器端生成 HTML 文档

> ID：159011
> 
> 赞同：1
> 
> 时间：2008-10-01T18:28:55.560
> 
> 标签：jquery, dom, asp-classic, server-side

这是我的问题，

是否有可能，知道经典的 asp 支持服务器端 javascript，能够生成“服务器端 HTML”以发送到客户端，如 Response.write $(page).html()

当然，使用 jQuery 来做这件事会很棒，因为它很容易解析复杂的结构并操纵它们。

我能想到的唯一会阻止我这样做的问题是，经典的 asp 只公开 3 个对象（响应、服务器、请求），而且它们都没有像 jQuery 一直使用的那样提供“dom 构建工具”。我们怎么可能创建一个空白文档对象？

**编辑**：我必须同意你的观点，这绝对不是一个好主意。让我解释一下为什么我们需要它。

我实际上正在将各种 JSON 提要转换为复杂的，有时是 HTML 中的嵌套报告。客户端它工作得非常好，即使是复杂的集合和长的报告。

但是，我们的一些客户希望使用 EXCEL 等工具访问“格式化”报告（使用已耗尽任何 javascript 的 webquery）。因此，在这种特殊情况下，我需要能够响应。编写 jQuery 工作的 .html() 内容。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-03T10:43:26.230

在这种情况下，我使用 XML DOM 作为浏览器中的 HTML DOM 的代理。

jQuery 可以操作 XML DOM，但是 jQuery 期望窗口出现在其上下文中。有可能欺骗 jQuery（或对其进行调整）以便它可以在服务器端工作，但它可能非常脆弱。

就我个人而言，我只是使用一个小型的辅助函数库，使操作 XML DOM 变得不那么痛苦，例如：-

```
function XmlWrapper(elem) { this.element = elem; }
XmlWrapper.prototype.addChild = function(name) {
    var elem = this.element.ownerDocument.createElement(name);
    return new XmlWrapper(this.element.appendChild(elem));
} 
```

现在您的页面代码可以执行以下操作：-

```
var dom = Server.CreateObject("MSXML2.DOMDocument.3.0");
dom.loadXML("<html />");
var html = XmlWapper(dom.documentElement);

var head = html.addChild("head");
var body = html.addChild("body");

var tHead = body.addChild("table").addChild("tHead"); 
```

当您创建“原始”操作 DOM 的代码时，您将看到可以重构为 XmlWrapper 类的方法的模式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T18:47:30.960

是的，有可能。不，它根本不会很快，我看不出有任何理由这样做，因为 jQuery 通常用于做只与客户端相关的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T21:15:57.250

我不得不问你这样做的可能原因是什么？如果您想在服务器端构建 DOM 文档而不是编写 HTML 输出，则更有可能是某种可以与 ASP 交互的 XML 库。jQuery 用于客户端的东西，而服务器端的 Javascript 存在它不是一个常见的用例。

# wpf - WPF 中的 Dispatcher 对象有什么用？

> ID：159015
> 
> 赞同：23
> 
> 时间：2008-10-01T18:29:46.463
> 
> 标签：wpf, dispatcher

WPF 中的 Dispatcher 对象有什么用？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2010-11-19T14:47:39.860

几乎每个 WPF 元素都具有线程关联性。这意味着只能从创建该元素的线程访问此类元素。为此，需要线程亲和性的每个元素最终都派生自 DispatcherObject 类。此类提供一个名为 Dispatcher 的属性，该属性返回与 WPF 元素关联的 Dispatcher 对象。

Dispatcher 类用于在其附加的线程上执行工作。它有一个工作项队列，负责在调度程序线程上执行工作项。

您可以在以下链接中找到有关该主题的更多详细信息：http: [//blogs.microsoft.co.il/blogs/arik/archive/2010/08/12/wpf-inside-out-dispatcher.aspx](http://blogs.microsoft.co.il/blogs/arik/archive/2010/08/12/wpf-inside-out-dispatcher.aspx)

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-01T18:31:13.357

调度程序通常用于调用另一个线程上的调用。例如，如果您有一个后台线程正在工作，并且您需要更新 UI 线程，则需要一个调度程序来执行此操作。

# c# - C#中的命名字符串格式化

> ID：159017
> 
> 赞同：155
> 
> 时间：2008-10-01T18:30:04.637
> 
> 标签：c#, .net-3.5, string-formatting

有没有办法按名称而不是 C# 中的位置来格式化字符串？

在 python 中，我可以做类似这个例子的事情（无耻地从[这里](http://docs.python.org/lib/typesseq-strings.html)偷走）：

```
>>> print '%(language)s has %(#)03d quote types.' % \
      {'language': "Python", "#": 2}
Python has 002 quote types. 
```

有没有办法在 C# 中做到这一点？比如说：

```
String.Format("{some_variable}: {some_other_variable}", ...); 
```

能够使用变量名来做到这一点会很好，但字典也是可以接受的。

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2008-10-01T18:49:49.443

没有用于处理此问题的内置方法。

[这是一种方法](http://mo.notono.us/2008/07/c-stringinject-format-strings-by-key.html)

```
string myString = "{foo} is {bar} and {yadi} is {yada}".Inject(o); 
```

[这是另一个](http://james.newtonking.com/archive/2008/03/29/formatwith-2-0-string-formatting-with-named-variables.aspx)

```
Status.Text = "{UserName} last logged in at {LastLoginDate}".FormatWith(user); 
```

[第三种改进方法部分基于上述两种方法](http://haacked.com/archive/2009/01/04/fun-with-named-formats-string-parsing-and-edge-cases.aspx)，来自 Phil Haack

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-01-05T04:32:05.320

我有一个刚刚发布到我的博客的实现：http: [//haacked.com/archive/2009/01/04/fun-with-named-formats-string-parsing-and-edge-cases.aspx](http://haacked.com/archive/2009/01/04/fun-with-named-formats-string-parsing-and-edge-cases.aspx)

它解决了这些其他实现与大括号转义有关的一些问题。该帖子有详细信息。它也做 DataBinder.Eval 的事情，但仍然非常快。

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2014-12-01T12:55:32.267

# 在 C# 6.0 和 Visual Basic 14 中添加了内[插字符串](https://msdn.microsoft.com/en-us/library/dn961160.aspx)

两者都是通过**Visual Studio 2015中的新****Roslyn**编译器引入的。

 ***   **C# 6.0：**

    `return "\{someVariable} and also \{someOtherVariable}"`或者
    `return $"{someVariable} and also {someOtherVariable}"`

    *   来源：[C#6.0 中的新功能](http://channel9.msdn.com/Events/Visual-Studio/Connect-event-2014/116)

*   **VB 14：**

    `return $"{someVariable} and also {someOtherVariable}"`

    *   来源：[VB 14 中的新功能](http://channel9.msdn.com/Events/Visual-Studio/Connect-event-2014/113)

值得注意的功能（在 Visual Studio 2015 IDE 中）：

*   **支持语法着色**- 字符串中包含的变量被突出显示
*   **支持重构**- 重命名时，字符串中包含的变量也会被重命名
*   实际上不仅支持变量名，还支持**表达式**- 例如，不仅`{index}`有效，而且`{(index + 1).ToString().Trim()}`

享受！（&点击VS中的“发送微笑”）

* * *

## 回答 #4

> 赞同：39
> 
> 时间：2010-11-02T11:21:19.983

你也可以像这样使用匿名类型：

```
 public string Format(string input, object p)
    {
        foreach (PropertyDescriptor prop in TypeDescriptor.GetProperties(p))
            input = input.Replace("{" + prop.Name + "}", (prop.GetValue(p) ?? "(null)").ToString());

        return input;
    } 
```

当然，如果您还想解析格式，则需要更多代码，但您可以使用此函数格式化字符串，例如：

```
Format("test {first} and {another}", new { first = "something", another = "something else" }) 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-10-01T19:01:41.753

似乎没有开箱即用的方法。[`IFormatProvider`](http://msdn.microsoft.com/en-us/library/system.iformatprovider.aspx)不过，实现您自己的链接到`IDictionary`for 值的方法看起来是可行的。

```
var Stuff = new Dictionary<string, object> {
   { "language", "Python" },
   { "#", 2 }
};
var Formatter = new DictionaryFormatProvider();

// Interpret {0:x} where {0}=IDictionary and "x" is hash key
Console.WriteLine string.Format(Formatter, "{0:language} has {0:#} quote types", Stuff); 
```

输出：

```
Python 有 2 种引用类型
```

需要注意的是，您不能 mix `FormatProviders`，因此不能同时使用花哨的文本格式。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-10-01T19:22:08.740

框架本身不提供执行此操作的方法，但您可以查看 Scott Hanselman 的[这篇文章](http://www.hanselman.com/blog/ASmarterOrPureEvilToStringWithExtensionMethods.aspx)。示例用法：

```
Person p = new Person();  
string foo = p.ToString("{Money:C} {LastName}, {ScottName} {BirthDate}");  
Assert.AreEqual("$3.43 Hanselman, {ScottName} 1/22/1974 12:00:00 AM", foo); 
```

[James Newton-King 的这段代码](http://james.newtonking.com/archive/2008/03/29/formatwith-2-0-string-formatting-with-named-variables.aspx)是相似的，并且适用于子属性和索引，

```
string foo = "Top result for {Name} was {Results[0].Name}".FormatWith(student)); 
```

James 的代码依赖*System.Web.UI.DataBinder*来解析字符串，并且需要引用 System.Web，这在非 Web 应用程序中有些人不喜欢这样做。

编辑：哦，如果您没有准备好具有属性的对象，它们可以很好地与匿名类型一起使用：

```
string name = ...;
DateTime date = ...;
string foo = "{Name} - {Birthday}".FormatWith(new { Name = name, Birthday = date }); 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-01-05T15:38:33.010

请参阅[https://stackoverflow.com/questions/271398?page=2#358259](https://stackoverflow.com/questions/271398?page=2#358259)

使用链接到的扩展，您可以这样写：

```
var str = "{foo} {bar} {baz}".Format(foo=>"foo", bar=>2, baz=>new object()); 
```

你会得到`"foo 2 System.Object`“。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-01T18:32:36.550

我认为你会得到最接近的是索引格式：

```
String.Format("{0} has {1} quote types.", "C#", "1"); 
```

还有 String.Replace()，如果您愿意分多个步骤进行操作并相信您不会在字符串的其他任何地方找到您的“变量”：

```
string MyString = "{language} has {n} quote types.";
MyString = MyString.Replace("{language}", "C#").Replace("{n}", "1"); 
```

扩展它以使用列表：

```
List<KeyValuePair<string, string>> replacements = GetFormatDictionary();  
foreach (KeyValuePair<string, string> item in replacements)
{
    MyString = MyString.Replace(item.Key, item.Value);
} 
```

您也可以通过 Dictionary<string, string> 迭代它的 .Keys 集合来做到这一点，但是通过使用 List<KeyValuePair<string, string>> 我们可以利用 List 的 .ForEach() 方法并将其压缩回单线：

```
replacements.ForEach(delegate(KeyValuePair<string,string>) item) { MyString = MyString.Replace(item.Key, item.Value);}); 
```

lambda 会更简单，但我仍在使用 .Net 2.0。另请注意，.Replace() 迭代使用时性能并不出色，因为 .Net 中的字符串是不可变的。此外，这需要`MyString`以委托可以访问的方式定义变量，因此它还不完美。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-04-19T17:37:48.753

我的开源库[Regextra](https://github.com/amageed/regextra)支持命名格式（除其他外）。它目前面向 .NET 4.0+，可在[NuGet](https://www.nuget.org/packages/Regextra/)上使用。我还有一篇关于它的介绍性博客文章：[Regextra：帮助您减少（问题）{2}](http://softwareninjaneer.com/blog/introducing-regextra/)。

命名格式化位支持：

*   基本格式
*   嵌套属性格式
*   字典格式
*   转义分隔符
*   标准/自定义/IFormatProvider 字符串格式

例子：

```
var order = new
{
    Description = "Widget",
    OrderDate = DateTime.Now,
    Details = new
    {
        UnitPrice = 1500
    }
};

string template = "We just shipped your order of '{Description}', placed on {OrderDate:d}. Your {{credit}} card will be billed {Details.UnitPrice:C}.";

string result = Template.Format(template, order);
// or use the extension: template.FormatTemplate(order); 
```

结果：

> 我们刚刚发货了您在 2014 年 2 月 28 日下的“小部件”订单。您的 {credit} 卡将被收取 1,500.00 美元的费用。

查看项目的 GitHub 链接（上图）和 wiki 以获取其他示例。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-05-04T06:56:44.703

```
private static Regex s_NamedFormatRegex = new Regex(@"\{(?!\{)(?<key>[\w]+)(:(?<fmt>(\{\{|\}\}|[^\{\}])*)?)?\}", RegexOptions.Compiled);

public static StringBuilder AppendNamedFormat(this StringBuilder builder,IFormatProvider provider, string format, IDictionary<string, object> args)
{
    if (builder == null) throw new ArgumentNullException("builder");
    var str = s_NamedFormatRegex.Replace(format, (mt) => {
        string key = mt.Groups["key"].Value;
        string fmt = mt.Groups["fmt"].Value;
        object value = null;
        if (args.TryGetValue(key,out value)) {
            return string.Format(provider, "{0:" + fmt + "}", value);
        } else {
            return mt.Value;
        }
    });
    builder.Append(str);
    return builder;
}

public static StringBuilder AppendNamedFormat(this StringBuilder builder, string format, IDictionary<string, object> args)
{
    if (builder == null) throw new ArgumentNullException("builder");
    return builder.AppendNamedFormat(null, format, args);
} 
```

例子：

```
var builder = new StringBuilder();
builder.AppendNamedFormat(
@"你好,{Name},今天是{Date:yyyy/MM/dd}, 这是你第{LoginTimes}次登录，积分{Score:{{ 0.00 }}}",
new Dictionary<string, object>() { 
    { "Name", "wayjet" },
    { "LoginTimes",18 },
    { "Score", 100.4 },
    { "Date",DateTime.Now }
}); 
```

输出：你好，wayjet，今天是2011-05-04，这是你第18次登录，积分{ 100.40 }

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-09-22T05:53:17.297

检查这个：

```
public static string StringFormat(string format, object source)
{
    var matches = Regex.Matches(format, @"\{(.+?)\}");
    List<string> keys = (from Match matche in matches select matche.Groups[1].Value).ToList();

    return keys.Aggregate(
        format,
        (current, key) =>
        {
            int colonIndex = key.IndexOf(':');
            return current.Replace(
                "{" + key + "}",
                colonIndex > 0
                    ? DataBinder.Eval(source, key.Substring(0, colonIndex), "{0:" + key.Substring(colonIndex + 1) + "}")
                    : DataBinder.Eval(source, key).ToString());
        });
} 
```

样本：

```
string format = "{foo} is a {bar} is a {baz} is a {qux:#.#} is a really big {fizzle}";
var o = new { foo = 123, bar = true, baz = "this is a test", qux = 123.45, fizzle = DateTime.Now };
Console.WriteLine(StringFormat(format, o)); 
```

与其他解决方案相比，性能相当不错。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-01T18:33:37.953

我怀疑这是否可能。首先想到的是如何访问局部变量名？

然而，可能有一些巧妙的方法使用 LINQ 和 Lambda 表达式来做到这一点。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-01-29T18:51:11.760

这是我不久前做的一个。它使用带有单个参数的 Format 方法扩展 String。好处是它会使用标准的 string.Format，如果你提供一个简单的参数，比如 int，但如果你使用匿名类型，它也可以工作。

示例用法：

```
"The {Name} family has {Children} children".Format(new { Children = 4, Name = "Smith" }) 
```

将导致“史密斯一家有 4 个孩子”。

它不会做疯狂的绑定东西，比如数组和索引器。但它是超级简单和高性能。

```
 public static class AdvancedFormatString
{

    /// <summary>
    /// An advanced version of string.Format.  If you pass a primitive object (string, int, etc), it acts like the regular string.Format.  If you pass an anonmymous type, you can name the paramters by property name.
    /// </summary>
    /// <param name="formatString"></param>
    /// <param name="arg"></param>
    /// <returns></returns>
    /// <example>
    /// "The {Name} family has {Children} children".Format(new { Children = 4, Name = "Smith" })
    /// 
    /// results in 
    /// "This Smith family has 4 children
    /// </example>
    public static string Format(this string formatString, object arg, IFormatProvider format = null)
    {
        if (arg == null)
            return formatString;

        var type = arg.GetType();
        if (Type.GetTypeCode(type) != TypeCode.Object || type.IsPrimitive)
            return string.Format(format, formatString, arg);

        var properties = TypeDescriptor.GetProperties(arg);
        return formatString.Format((property) =>
            {
                var value = properties[property].GetValue(arg);
                return Convert.ToString(value, format);
            });
    }

    public static string Format(this string formatString, Func<string, string> formatFragmentHandler)
    {
        if (string.IsNullOrEmpty(formatString))
            return formatString;
        Fragment[] fragments = GetParsedFragments(formatString);
        if (fragments == null || fragments.Length == 0)
            return formatString;

        return string.Join(string.Empty, fragments.Select(fragment =>
            {
                if (fragment.Type == FragmentType.Literal)
                    return fragment.Value;
                else
                    return formatFragmentHandler(fragment.Value);
            }).ToArray());
    }

    private static Fragment[] GetParsedFragments(string formatString)
    {
        Fragment[] fragments;
        if ( parsedStrings.TryGetValue(formatString, out fragments) )
        {
            return fragments;
        }
        lock (parsedStringsLock)
        {
            if ( !parsedStrings.TryGetValue(formatString, out fragments) )
            {
                fragments = Parse(formatString);
                parsedStrings.Add(formatString, fragments);
            }
        }
        return fragments;
    }

    private static Object parsedStringsLock = new Object();
    private static Dictionary<string,Fragment[]> parsedStrings = new Dictionary<string,Fragment[]>(StringComparer.Ordinal);

    const char OpeningDelimiter = '{';
    const char ClosingDelimiter = '}';

    /// <summary>
    /// Parses the given format string into a list of fragments.
    /// </summary>
    /// <param name="format"></param>
    /// <returns></returns>
    static Fragment[] Parse(string format)
    {
        int lastCharIndex = format.Length - 1;
        int currFragEndIndex;
        Fragment currFrag = ParseFragment(format, 0, out currFragEndIndex);

        if (currFragEndIndex == lastCharIndex)
        {
            return new Fragment[] { currFrag };
        }

        List<Fragment> fragments = new List<Fragment>();
        while (true)
        {
            fragments.Add(currFrag);
            if (currFragEndIndex == lastCharIndex)
            {
                break;
            }
            currFrag = ParseFragment(format, currFragEndIndex + 1, out currFragEndIndex);
        }
        return fragments.ToArray();

    }

    /// <summary>
    /// Finds the next delimiter from the starting index.
    /// </summary>
    static Fragment ParseFragment(string format, int startIndex, out int fragmentEndIndex)
    {
        bool foundEscapedDelimiter = false;
        FragmentType type = FragmentType.Literal;

        int numChars = format.Length;
        for (int i = startIndex; i < numChars; i++)
        {
            char currChar = format[i];
            bool isOpenBrace = currChar == OpeningDelimiter;
            bool isCloseBrace = isOpenBrace ? false : currChar == ClosingDelimiter;

            if (!isOpenBrace && !isCloseBrace)
            {
                continue;
            }
            else if (i < (numChars - 1) && format[i + 1] == currChar)
            {//{{ or }}
                i++;
                foundEscapedDelimiter = true;
            }
            else if (isOpenBrace)
            {
                if (i == startIndex)
                {
                    type = FragmentType.FormatItem;
                }
                else
                {

                    if (type == FragmentType.FormatItem)
                        throw new FormatException("Two consequtive unescaped { format item openers were found.  Either close the first or escape any literals with another {.");

                    //curr character is the opening of a new format item.  so we close this literal out
                    string literal = format.Substring(startIndex, i - startIndex);
                    if (foundEscapedDelimiter)
                        literal = ReplaceEscapes(literal);

                    fragmentEndIndex = i - 1;
                    return new Fragment(FragmentType.Literal, literal);
                }
            }
            else
            {//close bracket
                if (i == startIndex || type == FragmentType.Literal)
                    throw new FormatException("A } closing brace existed without an opening { brace.");

                string formatItem = format.Substring(startIndex + 1, i - startIndex - 1);
                if (foundEscapedDelimiter)
                    formatItem = ReplaceEscapes(formatItem);//a format item with a { or } in its name is crazy but it could be done
                fragmentEndIndex = i;
                return new Fragment(FragmentType.FormatItem, formatItem);
            }
        }

        if (type == FragmentType.FormatItem)
            throw new FormatException("A format item was opened with { but was never closed.");

        fragmentEndIndex = numChars - 1;
        string literalValue = format.Substring(startIndex);
        if (foundEscapedDelimiter)
            literalValue = ReplaceEscapes(literalValue);

        return new Fragment(FragmentType.Literal, literalValue);

    }

    /// <summary>
    /// Replaces escaped brackets, turning '{{' and '}}' into '{' and '}', respectively.
    /// </summary>
    /// <param name="value"></param>
    /// <returns></returns>
    static string ReplaceEscapes(string value)
    {
        return value.Replace("{{", "{").Replace("}}", "}");
    }

    private enum FragmentType
    {
        Literal,
        FormatItem
    }

    private class Fragment
    {

        public Fragment(FragmentType type, string value)
        {
            Type = type;
            Value = value;
        }

        public FragmentType Type
        {
            get;
            private set;
        }

        /// <summary>
        /// The literal value, or the name of the fragment, depending on fragment type.
        /// </summary>
        public string Value
        {
            get;
            private set;
        }

    }

} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-02-26T23:50:11.840

这是任何对象的简单方法：

```
 using System.Text.RegularExpressions;
    using System.ComponentModel;

    public static string StringWithFormat(string format, object args)
    {
        Regex r = new Regex(@"\{([A-Za-z0-9_]+)\}");

        MatchCollection m = r.Matches(format);

        var properties = TypeDescriptor.GetProperties(args);

        foreach (Match item in m)
        {
            try
            {
                string propertyName = item.Groups[1].Value;
                format = format.Replace(item.Value, properties[propertyName].GetValue(args).ToString());
            }
            catch
            {
                throw new FormatException("The format string is not valid");
            }
        }

        return format;
    } 
```

以及如何使用它：

```
 DateTime date = DateTime.Now;
 string dateString = StringWithFormat("{Month}/{Day}/{Year}", date); 
```

输出：2/27/2012

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-05-14T21:06:47.200

我实现了这是一个简单的类，它复制了 String.Format 的功能（使用类时除外）。您可以使用字典或类型来定义字段。

[https://github.com/SergueiFedorov/NamedFormatString](https://github.com/SergueiFedorov/NamedFormatString)

C# 6.0 正在将此功能添加到语言规范中，以便`NamedFormatString`向后兼容。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-11-19T11:10:36.933

我以与现有解决方案略有不同的方式解决了这个问题。它完成了命名项目替换的核心（不是某些人所做的反射位）。它非常快速和简单......这是我的解决方案：

```
/// <summary>
/// Formats a string with named format items given a template dictionary of the items values to use.
/// </summary>
public class StringTemplateFormatter
{
    private readonly IFormatProvider _formatProvider;

    /// <summary>
    /// Constructs the formatter with the specified <see cref="IFormatProvider"/>.
    /// This is defaulted to <see cref="CultureInfo.CurrentCulture">CultureInfo.CurrentCulture</see> if none is provided.
    /// </summary>
    /// <param name="formatProvider"></param>
    public StringTemplateFormatter(IFormatProvider formatProvider = null)
    {
        _formatProvider = formatProvider ?? CultureInfo.CurrentCulture;
    }

    /// <summary>
    /// Formats a string with named format items given a template dictionary of the items values to use.
    /// </summary>
    /// <param name="text">The text template</param>
    /// <param name="templateValues">The named values to use as replacements in the formatted string.</param>
    /// <returns>The resultant text string with the template values replaced.</returns>
    public string FormatTemplate(string text, Dictionary<string, object> templateValues)
    {
        var formattableString = text;
        var values = new List<object>();
        foreach (KeyValuePair<string, object> value in templateValues)
        {
            var index = values.Count;
            formattableString = ReplaceFormattableItem(formattableString, value.Key, index);
            values.Add(value.Value);
        }
        return String.Format(_formatProvider, formattableString, values.ToArray());
    }

    /// <summary>
    /// Convert named string template item to numbered string template item that can be accepted by <see cref="string.Format(string,object[])">String.Format</see>
    /// </summary>
    /// <param name="formattableString">The string containing the named format item</param>
    /// <param name="itemName">The name of the format item</param>
    /// <param name="index">The index to use for the item value</param>
    /// <returns>The formattable string with the named item substituted with the numbered format item.</returns>
    private static string ReplaceFormattableItem(string formattableString, string itemName, int index)
    {
        return formattableString
            .Replace("{" + itemName + "}", "{" + index + "}")
            .Replace("{" + itemName + ",", "{" + index + ",")
            .Replace("{" + itemName + ":", "{" + index + ":");
    }
} 
```

它以下列方式使用：

```
 [Test]
    public void FormatTemplate_GivenANamedGuid_FormattedWithB_ShouldFormatCorrectly()
    {
        // Arrange
        var template = "My guid {MyGuid:B} is awesome!";
        var templateValues = new Dictionary<string, object> { { "MyGuid", new Guid("{A4D2A7F1-421C-4A1D-9CB2-9C2E70B05E19}") } };
        var sut = new StringTemplateFormatter();
        // Act
        var result = sut.FormatTemplate(template, templateValues);
        //Assert
        Assert.That(result, Is.EqualTo("My guid {a4d2a7f1-421c-4a1d-9cb2-9c2e70b05e19} is awesome!"));
    } 
```

希望有人觉得这很有用！

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-02-23T03:08:16.933

即使接受的答案给出了一些很好的例子，.Inject 以及一些 Haack 例子都不能处理转义。许多人还严重依赖 Regex（较慢）或 DataBinder.Eval，这在 .NET Core 和其他一些环境中不可用。

考虑到这一点，我编写了一个简单的基于状态机的解析器，它通过字符流式传输`StringBuilder`，逐个字符地写入输出。它被实现为`String`扩展方法，并且可以将 a`Dictionary<string, object>`或`object`with 参数作为输入（使用反射）。

当输入包含不平衡的大括号和/或其他错误时，它处理无限级别`{{{escaping}}}`和抛出。`FormatException`

```
public static class StringExtension {
    /// <summary>
    /// Extension method that replaces keys in a string with the values of matching object properties.
    /// </summary>
    /// <param name="formatString">The format string, containing keys like {foo} and {foo:SomeFormat}.</param>
    /// <param name="injectionObject">The object whose properties should be injected in the string</param>
    /// <returns>A version of the formatString string with keys replaced by (formatted) key values.</returns>
    public static string FormatWith(this string formatString, object injectionObject) {
        return formatString.FormatWith(GetPropertiesDictionary(injectionObject));
    }

    /// <summary>
    /// Extension method that replaces keys in a string with the values of matching dictionary entries.
    /// </summary>
    /// <param name="formatString">The format string, containing keys like {foo} and {foo:SomeFormat}.</param>
    /// <param name="dictionary">An <see cref="IDictionary"/> with keys and values to inject into the string</param>
    /// <returns>A version of the formatString string with dictionary keys replaced by (formatted) key values.</returns>
    public static string FormatWith(this string formatString, IDictionary<string, object> dictionary) {
        char openBraceChar = '{';
        char closeBraceChar = '}';

        return FormatWith(formatString, dictionary, openBraceChar, closeBraceChar);
    }
        /// <summary>
        /// Extension method that replaces keys in a string with the values of matching dictionary entries.
        /// </summary>
        /// <param name="formatString">The format string, containing keys like {foo} and {foo:SomeFormat}.</param>
        /// <param name="dictionary">An <see cref="IDictionary"/> with keys and values to inject into the string</param>
        /// <returns>A version of the formatString string with dictionary keys replaced by (formatted) key values.</returns>
    public static string FormatWith(this string formatString, IDictionary<string, object> dictionary, char openBraceChar, char closeBraceChar) {
        string result = formatString;
        if (dictionary == null || formatString == null)
            return result;

        // start the state machine!

        // ballpark output string as two times the length of the input string for performance (avoids reallocating the buffer as often).
        StringBuilder outputString = new StringBuilder(formatString.Length * 2);
        StringBuilder currentKey = new StringBuilder();

        bool insideBraces = false;

        int index = 0;
        while (index < formatString.Length) {
            if (!insideBraces) {
                // currently not inside a pair of braces in the format string
                if (formatString[index] == openBraceChar) {
                    // check if the brace is escaped
                    if (index < formatString.Length - 1 && formatString[index + 1] == openBraceChar) {
                        // add a brace to the output string
                        outputString.Append(openBraceChar);
                        // skip over braces
                        index += 2;
                        continue;
                    }
                    else {
                        // not an escaped brace, set state to inside brace
                        insideBraces = true;
                        index++;
                        continue;
                    }
                }
                else if (formatString[index] == closeBraceChar) {
                    // handle case where closing brace is encountered outside braces
                    if (index < formatString.Length - 1 && formatString[index + 1] == closeBraceChar) {
                        // this is an escaped closing brace, this is okay
                        // add a closing brace to the output string
                        outputString.Append(closeBraceChar);
                        // skip over braces
                        index += 2;
                        continue;
                    }
                    else {
                        // this is an unescaped closing brace outside of braces.
                        // throw a format exception
                        throw new FormatException($"Unmatched closing brace at position {index}");
                    }
                }
                else {
                    // the character has no special meaning, add it to the output string
                    outputString.Append(formatString[index]);
                    // move onto next character
                    index++;
                    continue;
                }
            }
            else {
                // currently inside a pair of braces in the format string
                // found an opening brace
                if (formatString[index] == openBraceChar) {
                    // check if the brace is escaped
                    if (index < formatString.Length - 1 && formatString[index + 1] == openBraceChar) {
                        // there are escaped braces within the key
                        // this is illegal, throw a format exception
                        throw new FormatException($"Illegal escaped opening braces within a parameter - index: {index}");
                    }
                    else {
                        // not an escaped brace, we have an unexpected opening brace within a pair of braces
                        throw new FormatException($"Unexpected opening brace inside a parameter - index: {index}");
                    }
                }
                else if (formatString[index] == closeBraceChar) {
                    // handle case where closing brace is encountered inside braces
                    // don't attempt to check for escaped braces here - always assume the first brace closes the braces
                    // since we cannot have escaped braces within parameters.

                    // set the state to be outside of any braces
                    insideBraces = false;

                    // jump over brace
                    index++;

                    // at this stage, a key is stored in current key that represents the text between the two braces
                    // do a lookup on this key
                    string key = currentKey.ToString();
                    // clear the stringbuilder for the key
                    currentKey.Clear();

                    object outObject;

                    if (!dictionary.TryGetValue(key, out outObject)) {
                        // the key was not found as a possible replacement, throw exception
                        throw new FormatException($"The parameter \"{key}\" was not present in the lookup dictionary");
                    }

                    // we now have the replacement value, add the value to the output string
                    outputString.Append(outObject);

                    // jump to next state
                    continue;
                } // if }
                else {
                    // character has no special meaning, add it to the current key
                    currentKey.Append(formatString[index]);
                    // move onto next character
                    index++;
                    continue;
                } // else
            } // if inside brace
        } // while

        // after the loop, if all braces were balanced, we should be outside all braces
        // if we're not, the input string was misformatted.
        if (insideBraces) {
            throw new FormatException("The format string ended before the parameter was closed.");
        }

        return outputString.ToString();
    }

    /// <summary>
    /// Creates a Dictionary from an objects properties, with the Key being the property's
    /// name and the Value being the properties value (of type object)
    /// </summary>
    /// <param name="properties">An object who's properties will be used</param>
    /// <returns>A <see cref="Dictionary"/> of property values </returns>
    private static Dictionary<string, object> GetPropertiesDictionary(object properties) {
        Dictionary<string, object> values = null;
        if (properties != null) {
            values = new Dictionary<string, object>();
            PropertyDescriptorCollection props = TypeDescriptor.GetProperties(properties);
            foreach (PropertyDescriptor prop in props) {
                values.Add(prop.Name, prop.GetValue(properties));
            }
        }
        return values;
    }
} 
```

最终，所有的逻辑都归结为 10 个主要状态 - 因为当状态机在括号外并且同样在括号内时，下一个字符是左大括号、转义左大括号、闭大括号、转义闭大括号，或者一个普通的角色。随着循环的进行，这些条件中的每一个都会单独处理，将字符添加到 output`StringBuffer`或 key `StringBuffer`。当参数关闭时，键`StringBuffer`的值用于在字典中查找参数的值，然后将其推入输出`StringBuffer`。`StringBuffer`最后，返回输出的值。

* * *

## 回答 #18

> 赞同：-6
> 
> 时间：2008-10-01T18:42:34.827

```
string language = "Python";
int numquotes = 2;
string output = language + " has "+ numquotes + " language types."; 
```

编辑：我应该说的是，“不，我不相信 C# 支持你想要做的事情。这与你将得到的一样接近。”

# c++ - C++ 枚举是有符号的还是无符号的？

> ID：159034
> 
> 赞同：112
> 
> 时间：2008-10-01T18:33:03.960
> 
> 标签：c++, enums

C++ 枚举是有符号的还是无符号的？通过扩展来验证输入是否安全，通过检查它是否 <= 您的最大值，并忽略 >= 您的最小值（假设您从 0 开始并递增 1）？

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2008-10-01T19:31:25.397

让我们去源头。以下是 C++03 标准 (ISO/IEC 14882:2003) 文档在 7.2-5（枚举声明）中所说的内容：

> 枚举的底层类型是一个整数类型，可以表示枚举中定义的所有枚举值。使用哪种整数类型作为枚举的基础类型由实现定义，除非基础类型不得大于 int，除非枚举数的值不能适合 int 或 unsigned int。

简而言之，您的编译器可以进行选择（显然，如果您的某些枚举值有负数，它将被签名）。

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2008-10-01T18:38:27.567

您不应该依赖任何特定的表示。阅读以下[链接](http://www.parashift.com/c++-faq-lite/newbie.html#faq-29.19)。此外，该标准说它是实现定义的，哪个整数类型用作枚举的基础类型，除了它不应大于 int，除非某些值不能适合 int 或 unsigned int。

简而言之：您不能依赖已签名或未签名的枚举。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-10-01T18:48:09.133

你不应该依赖他们被签名或未签名。如果要使它们显式签名或未签名，可以使用以下内容：

```
enum X : signed int { ... };    // signed enum
enum Y : unsigned int { ... };  // unsigned enum 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-10-02T19:10:15.250

你不应该依赖它被签名或未签名。根据标准，实现定义了哪个整数类型用作枚举的基础类型。但是，在大多数实现中，它是有符号整数。

在 C++0x中将添加[强类型枚举](http://en.wikipedia.org/wiki/C%2B%2B0x#Strongly_typed_enumerations)，这将允许您指定枚举的类型，例如：

```
enum X : signed int { ... };    // signed enum
enum Y : unsigned int { ... };  // unsigned enum 
```

即使是现在，也可以通过使用枚举作为变量或参数类型来实现一些简单的验证，如下所示：

```
enum Fruit { Apple, Banana };

enum Fruit fruitVariable = Banana;  // Okay, Banana is a member of the Fruit enum
fruitVariable = 1;  // Error, 1 is not a member of enum Fruit
                    // even though it has the same value as banana. 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-07-17T12:29:41.767

即使是一些旧的答案也得到了 44 票，我倾向于不同意所有这些。简而言之，我认为我们不应该关心`underlying type`枚举的 。

首先，C++03 Enum 类型是它自己的独特类型，没有符号的概念。从 C++03 标准开始`dcl.enum`

```
7.2 Enumeration declarations 
5 Each enumeration defines a type that is different from all other types.... 
```

因此，当我们讨论枚举类型的符号时，例如使用`<`运算符比较 2 个枚举操作数时，我们实际上是在讨论将枚举类型隐式转换为某种整数类型。**重要的是这种整数类型的符号**。并且在将 enum 转换为整数类型时，此语句适用：

```
9 The value of an enumerator or an object of an enumeration type is converted to an integer by integral promotion (4.5). 
```

而且，显然，枚举的底层类型与 Integral Promotion 无关。由于标准定义了这样的积分促销：

```
4.5 Integral promotions conv.prom
.. An rvalue of an enumeration type (7.2) can be converted to an rvalue of the first of the following types that can represent all the values of the enumeration
(i.e. the values in the range bmin to bmax as described in 7.2: int, unsigned int, long, or unsigned long. 
```

因此，一个枚举类型是否成为`signed int`或`unsigned int`取决于是否`signed int`可以包含已定义枚举数的所有值，而不是枚举的基础类型。

请参阅我的相关问题 [Sign of C++ Enum Type Incorrect After Converting to Integral Type](https://stackoverflow.com/questions/24802322/sign-of-c-enum-type-incorrect-after-converting-to-integral-type)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-01T18:37:55.243

编译器可以决定枚举是有符号还是无符号。

验证枚举的另一种方法是将枚举本身用作变量类型。例如：

```
enum Fruit
{
    Apple = 0,
    Banana,
    Pineapple,
    Orange,
    Kumquat
};

enum Fruit fruitVariable = Banana;  // Okay, Banana is a member of the Fruit enum
fruitVariable = 1;  // Error, 1 is not a member of enum Fruit even though it has the same value as banana. 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-01T19:05:15.957

将来，在 C++0x 中，[强类型枚举](http://en.wikipedia.org/wiki/C%2B%2B0x#Strongly_typed_enumerations)将可用并具有几个优点（例如类型安全、显式底层类型或显式范围）。这样您就可以更好地确定类型的符号。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-03T17:46:03.183

除了其他人已经说过的关于有符号/无符号的内容之外，以下是标准对枚举类型范围的说明：

7.2(6)：“对于其中 e(min) 是最小枚举数且 e(max) 是最大枚举数的枚举，枚举的值是 b(min) 到 b(max) 范围内的基础类型的值)，其中 b(min) 和 b(max) 分别是可以存储 e(min) 和 e(max) 的最小位域的最小值和最大值。可以定义具有未定义值的枚举由它的任何一个调查员。”

例如：

```
enum { A = 1, B = 4}; 
```

定义一个枚举类型，其中 e(min) 为 1，e(max) 为 4。如果基础类型是有符号整数，则所需的最小位域有 4 位，如果实现中的整数是二进制补码，则有效范围枚举是 -8 到 7。如果基础类型是无符号的，则它有 3 位，范围是 0 到 7。如果您关心，请检查您的编译器文档（例如，如果您想将除枚举数之外的整数值转换为枚举类型，那么您需要知道该值是否在枚举范围内 - 如果不是，则生成的枚举值未指定）。

这些值是否是函数的有效输入可能与它们是否是枚举类型的有效值不同。你的检查代码可能担心的是前者而不是后者，所以在这个例子中至少应该检查 >=A 和 <=B。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-02-07T11:33:12.307

**`std::is_signed<std::underlying_type`使用+ scoped enums default to检查它`int`**

[https://en.cppreference.com/w/cpp/language/enum](https://en.cppreference.com/w/cpp/language/enum)暗示：

主文件

```
#include <cassert>
#include <iostream>
#include <type_traits>

enum Unscoped {};
enum class ScopedDefault {};
enum class ScopedExplicit : long {};

int main() {
    // Implementation defined, let's find out.
    std::cout << std::is_signed<std::underlying_type<Unscoped>>() << std::endl;

    // Guaranteed. Scoped defaults to int.
    assert((std::is_same<std::underlying_type<ScopedDefault>::type, int>()));

    // Guaranteed. We set it ourselves.
    assert((std::is_same<std::underlying_type<ScopedExplicit>::type, long>()));
} 
```

[GitHub 上游](https://github.com/cirosantilli/cpp-cheat/blob/bf6e5193294fb5fd32b769b665dd1152838ccf80/cpp/enum_signed.cpp).

编译并运行：

```
g++ -std=c++17 -Wall -Wextra -pedantic-errors -o main main.cpp
./main 
```

输出：

```
0 
```

在 Ubuntu 16.04、GCC 6.4.0 上测试。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-09-07T12:54:46.057

虽然上面的一些答案可以说是正确的，但它们并没有回答我的实际问题。编译器 (gcc 9.3.0) 发出警告：

```
enum FOO_STATUS {
    STATUS_ERROR = (1 << 31)
}; 
```

使用时发出警告：

```
unsigned status = foo_status_get();
if (STATUS_ERROR == status) { 
```

（除了这个代码不正确的事实......不要问。）

当被正确询问时，编译器不会发出错误。

```
enum FOO_STATUS {
    STATUS_ERROR = (1U << 31)
}; 
```

请注意，这`1U`会使表达式无符号。

# sql-server - 如何使用 T-SQL 临时禁用外键约束？

> ID：159038
> 
> 赞同：897
> 
> 时间：2008-10-01T18:33:43.630
> 
> 标签：sql-server, tsql, foreign-keys, constraints

SQL Server 是否支持禁用和启用外键约束？或者是我唯一的选择**`drop`**，然后**重新`create`**约束？

* * *

## 回答 #1

> 赞同：1203
> 
> 时间：2008-10-02T08:50:21.667

如果要禁用数据库中的所有约束，只需运行以下代码：

```
-- disable all constraints
EXEC sp_MSforeachtable "ALTER TABLE ? NOCHECK CONSTRAINT all" 
```

要重新打开它们，请运行：（打印当然是可选的，它只是列出表格）

```
-- enable all constraints
exec sp_MSforeachtable @command1="print '?'", @command2="ALTER TABLE ? WITH CHECK CHECK CONSTRAINT all" 
```

在将数据从一个数据库填充到另一个数据库时，我发现它很有用。这是比放弃约束更好的方法。正如您所提到的，在删除数据库中的所有数据并重新填充它（例如在测试环境中）时，它会派上用场。

如果您要删除所有数据，您可能会发现[此解决方案](https://stackoverflow.com/questions/155246/how-do-you-truncate-all-tables-in-a-database-using-tsql#156813)很有帮助。

有时禁用所有触发器也很方便，您可以在[此处](https://stackoverflow.com/questions/123558/sql-server-2005-t-sql-to-temporarily-disable-a-trigger#123966)查看完整的解决方案。

* * *

## 回答 #2

> 赞同：433
> 
> 时间：2008-10-01T18:37:38.487

（从[http://www.sqljunkies.com/WebLog/roman/archive/2005/01/30/7037.aspx](http://www.sqljunkies.com/WebLog/roman/archive/2005/01/30/7037.aspx)复制， [现在存档在 Wayback Machine 中](https://web.archive.org/web/20060901043621/http://www.sqljunkies.com/WebLog/roman/archive/2005/01/30/7037.aspx)）

> 外键约束和检查约束对于执行数据完整性和业务规则非常有用。在某些情况下，暂时关闭它们很有用，因为它们的行为要么是不需要的，要么弊大于利。我有时会在从外部源加载数据期间禁用对表的约束检查，或者当我需要编写一个表删除/重新创建脚本并将数据重新加载回表中时。我通常在不希望耗时过程失败的情况下这样做，因为数百万行中的一或几行包含错误数据。但是一旦过程完成，我总是会重新打开约束，并且在某些情况下，我会对导入的数据运行数据完整性检查。

> 如果禁用外键约束，您将能够插入父表中不存在的值。如果禁用检查约束，您将能够将值放入列中，就好像检查约束不存在一样。以下是一些禁用和启用表约束的示例：

> ```
>  -- Disable all table constraints
>    ALTER TABLE MyTable NOCHECK CONSTRAINT ALL
> 
>    -- Enable all table constraints
>    ALTER TABLE MyTable WITH CHECK CHECK CONSTRAINT ALL
>     
>    -- Disable single constraint
>    
>    ALTER TABLE MyTable NOCHECK CONSTRAINT MyConstraint
>    
>    -- Enable single constraint
>    ALTER TABLE MyTable WITH CHECK CHECK CONSTRAINT MyConstraint 
> ```

* * *

## 回答 #3

> 赞同：50
> 
> 时间：2012-04-03T20:06:49.153

要禁用约束，您可以`ALTER`使用[NOCHECK](https://docs.microsoft.com/en-us/sql/relational-databases/tables/disable-check-constraints-with-insert-and-update-statements)

```
ALTER TABLE [TABLE_NAME] NOCHECK CONSTRAINT [ALL|CONSTRAINT_NAME] 
```

为了使您必须使用 double [CHECK](https://docs.microsoft.com/en-us/sql/relational-databases/tables/unique-constraints-and-check-constraints)：

```
ALTER TABLE [TABLE_NAME] WITH CHECK CHECK CONSTRAINT [ALL|CONSTRAINT_NAME] 
```

*   启用时 注意双重**CHECK CHECK 。**
*   ALL 表示表中的所有约束。

完成后，如果您需要检查状态，请使用此脚本列出约束状态。将非常有帮助：

```
 SELECT (CASE 
        WHEN OBJECTPROPERTY(CONSTID, 'CNSTISDISABLED') = 0 THEN 'ENABLED'
        ELSE 'DISABLED'
        END) AS STATUS,
        OBJECT_NAME(CONSTID) AS CONSTRAINT_NAME,
        OBJECT_NAME(FKEYID) AS TABLE_NAME,
        COL_NAME(FKEYID, FKEY) AS COLUMN_NAME,
        OBJECT_NAME(RKEYID) AS REFERENCED_TABLE_NAME,
        COL_NAME(RKEYID, RKEY) AS REFERENCED_COLUMN_NAME
   FROM SYSFOREIGNKEYS
ORDER BY TABLE_NAME, CONSTRAINT_NAME,REFERENCED_TABLE_NAME, KEYNO 
```

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2013-06-03T22:00:20.630

您最好的选择是 DROP 和 CREATE 外键约束。

我在这篇文章中没有找到“按原样”对我有用的示例，如果外键引用不同的模式，一个将不起作用，如果外键引用多个列，另一个将不起作用。此脚本同时考虑每个外键的多个模式和多个列。

这是生成“ADD CONSTRAINT”语句的脚本，对于多个列，它将用逗号分隔它们（**确保在执行 DROP 语句之前保存此输出**）：

```
PRINT N'-- CREATE FOREIGN KEY CONSTRAINTS --';

SET NOCOUNT ON;
SELECT '
PRINT N''Creating '+ const.const_name +'...''
GO
ALTER TABLE ' + const.parent_obj + '
    ADD CONSTRAINT ' + const.const_name + ' FOREIGN KEY (
            ' + const.parent_col_csv + '
            ) REFERENCES ' + const.ref_obj + '(' + const.ref_col_csv + ')
GO'
FROM (
    SELECT QUOTENAME(fk.NAME) AS [const_name]
        ,QUOTENAME(schParent.NAME) + '.' + QUOTENAME(OBJECT_name(fkc.parent_object_id)) AS [parent_obj]
        ,STUFF((
                SELECT ',' + QUOTENAME(COL_NAME(fcP.parent_object_id, fcp.parent_column_id))
                FROM sys.foreign_key_columns AS fcP
                WHERE fcp.constraint_object_id = fk.object_id
                FOR XML path('')
                ), 1, 1, '') AS [parent_col_csv]
        ,QUOTENAME(schRef.NAME) + '.' + QUOTENAME(OBJECT_NAME(fkc.referenced_object_id)) AS [ref_obj]
        ,STUFF((
                SELECT ',' + QUOTENAME(COL_NAME(fcR.referenced_object_id, fcR.referenced_column_id))
                FROM sys.foreign_key_columns AS fcR
                WHERE fcR.constraint_object_id = fk.object_id
                FOR XML path('')
                ), 1, 1, '') AS [ref_col_csv]
    FROM sys.foreign_key_columns AS fkc
    INNER JOIN sys.foreign_keys AS fk ON fk.object_id = fkc.constraint_object_id
    INNER JOIN sys.objects AS oParent ON oParent.object_id = fkc.parent_object_id
    INNER JOIN sys.schemas AS schParent ON schParent.schema_id = oParent.schema_id
    INNER JOIN sys.objects AS oRef ON oRef.object_id = fkc.referenced_object_id
    INNER JOIN sys.schemas AS schRef ON schRef.schema_id = oRef.schema_id
    GROUP BY fkc.parent_object_id
        ,fkc.referenced_object_id
        ,fk.NAME
        ,fk.object_id
        ,schParent.NAME
        ,schRef.NAME
    ) AS const
ORDER BY const.const_name 
```

这是生成“DROP CONSTRAINT”语句的脚本：

```
PRINT N'-- DROP FOREIGN KEY CONSTRAINTS --';

SET NOCOUNT ON;

SELECT '
PRINT N''Dropping ' + fk.NAME + '...''
GO
ALTER TABLE [' + sch.NAME + '].[' + OBJECT_NAME(fk.parent_object_id) + ']' + ' DROP  CONSTRAINT ' + '[' + fk.NAME + ']
GO'
FROM sys.foreign_keys AS fk
INNER JOIN sys.schemas AS sch ON sch.schema_id = fk.schema_id
ORDER BY fk.NAME 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-10-02T11:01:40.277

SQL-92 标准允许将一个约束声明为 DEFERRABLE，以便它可以在事务范围内（隐式或显式）延迟。遗憾的是，SQL Server 仍然缺少这个 SQL-92 功能。

对我来说，将约束更改为 NOCHECK 类似于动态更改数据库结构——当然是删除约束——并且需要避免一些事情（例如，用户需要增加权限）。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2012-02-26T10:24:04.583

```
 --Drop and Recreate Foreign Key Constraints

SET NOCOUNT ON

DECLARE @table TABLE(
   RowId INT PRIMARY KEY IDENTITY(1, 1),
   ForeignKeyConstraintName NVARCHAR(200),
   ForeignKeyConstraintTableSchema NVARCHAR(200),
   ForeignKeyConstraintTableName NVARCHAR(200),
   ForeignKeyConstraintColumnName NVARCHAR(200),
   PrimaryKeyConstraintName NVARCHAR(200),
   PrimaryKeyConstraintTableSchema NVARCHAR(200),
   PrimaryKeyConstraintTableName NVARCHAR(200),
   PrimaryKeyConstraintColumnName NVARCHAR(200)    
)

INSERT INTO @table(ForeignKeyConstraintName, ForeignKeyConstraintTableSchema, ForeignKeyConstraintTableName, ForeignKeyConstraintColumnName)
SELECT 
   U.CONSTRAINT_NAME, 
   U.TABLE_SCHEMA, 
   U.TABLE_NAME, 
   U.COLUMN_NAME 
FROM 
   INFORMATION_SCHEMA.KEY_COLUMN_USAGE U
      INNER JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS C
         ON U.CONSTRAINT_NAME = C.CONSTRAINT_NAME
WHERE
   C.CONSTRAINT_TYPE = 'FOREIGN KEY'

UPDATE @table SET
   PrimaryKeyConstraintName = UNIQUE_CONSTRAINT_NAME
FROM 
   @table T
      INNER JOIN INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS R
         ON T.ForeignKeyConstraintName = R.CONSTRAINT_NAME

UPDATE @table SET
   PrimaryKeyConstraintTableSchema  = TABLE_SCHEMA,
   PrimaryKeyConstraintTableName  = TABLE_NAME
FROM @table T
   INNER JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS C
      ON T.PrimaryKeyConstraintName = C.CONSTRAINT_NAME

UPDATE @table SET
   PrimaryKeyConstraintColumnName = COLUMN_NAME
FROM @table T
   INNER JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE U
      ON T.PrimaryKeyConstraintName = U.CONSTRAINT_NAME

--SELECT * FROM @table

--DROP CONSTRAINT:
SELECT
   '
   ALTER TABLE [' + ForeignKeyConstraintTableSchema + '].[' + ForeignKeyConstraintTableName + '] 
   DROP CONSTRAINT ' + ForeignKeyConstraintName + '

   GO'
FROM
   @table

--ADD CONSTRAINT:
SELECT
   '
   ALTER TABLE [' + ForeignKeyConstraintTableSchema + '].[' + ForeignKeyConstraintTableName + '] 
   ADD CONSTRAINT ' + ForeignKeyConstraintName + ' FOREIGN KEY(' + ForeignKeyConstraintColumnName + ') REFERENCES [' + PrimaryKeyConstraintTableSchema + '].[' + PrimaryKeyConstraintTableName + '](' + PrimaryKeyConstraintColumnName + ')

   GO'
FROM
   @table

GO 
```

* * *

我同意你的看法，哈姆林。当您使用 SSIS 传输数据或想要复制数据时，似乎很有必要暂时禁用或删除外键约束，然后重新启用或重新创建它们。在这些情况下，参照完整性不是问题，因为它已经在源数据库中维护。因此，您可以放心。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2012-02-28T09:04:54.160

```
SET NOCOUNT ON

DECLARE @table TABLE(
   RowId INT PRIMARY KEY IDENTITY(1, 1),
   ForeignKeyConstraintName NVARCHAR(200),
   ForeignKeyConstraintTableSchema NVARCHAR(200),
   ForeignKeyConstraintTableName NVARCHAR(200),
   ForeignKeyConstraintColumnName NVARCHAR(200),
   PrimaryKeyConstraintName NVARCHAR(200),
   PrimaryKeyConstraintTableSchema NVARCHAR(200),
   PrimaryKeyConstraintTableName NVARCHAR(200),
   PrimaryKeyConstraintColumnName NVARCHAR(200),
   UpdateRule NVARCHAR(100),
   DeleteRule NVARCHAR(100)   
)

INSERT INTO @table(ForeignKeyConstraintName, ForeignKeyConstraintTableSchema, ForeignKeyConstraintTableName, ForeignKeyConstraintColumnName)
SELECT 
   U.CONSTRAINT_NAME, 
   U.TABLE_SCHEMA, 
   U.TABLE_NAME, 
   U.COLUMN_NAME
FROM 
   INFORMATION_SCHEMA.KEY_COLUMN_USAGE U
      INNER JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS C
         ON U.CONSTRAINT_NAME = C.CONSTRAINT_NAME
WHERE
   C.CONSTRAINT_TYPE = 'FOREIGN KEY'

UPDATE @table SET
   T.PrimaryKeyConstraintName = R.UNIQUE_CONSTRAINT_NAME,
   T.UpdateRule = R.UPDATE_RULE,
   T.DeleteRule = R.DELETE_RULE
FROM 
   @table T
      INNER JOIN INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS R
         ON T.ForeignKeyConstraintName = R.CONSTRAINT_NAME

UPDATE @table SET
   PrimaryKeyConstraintTableSchema  = TABLE_SCHEMA,
   PrimaryKeyConstraintTableName  = TABLE_NAME
FROM @table T
   INNER JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS C
      ON T.PrimaryKeyConstraintName = C.CONSTRAINT_NAME

UPDATE @table SET
   PrimaryKeyConstraintColumnName = COLUMN_NAME
FROM @table T
   INNER JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE U
      ON T.PrimaryKeyConstraintName = U.CONSTRAINT_NAME

--SELECT * FROM @table

SELECT '
BEGIN TRANSACTION
BEGIN TRY'

--DROP CONSTRAINT:
SELECT
   '
 ALTER TABLE [' + ForeignKeyConstraintTableSchema + '].[' + ForeignKeyConstraintTableName + '] 
 DROP CONSTRAINT ' + ForeignKeyConstraintName + '
   '
FROM
   @table

SELECT '
END TRY

BEGIN CATCH
   ROLLBACK TRANSACTION
   RAISERROR(''Operation failed.'', 16, 1)
END CATCH

IF(@@TRANCOUNT != 0)
BEGIN
   COMMIT TRANSACTION
   RAISERROR(''Operation completed successfully.'', 10, 1)
END
'

--ADD CONSTRAINT:
SELECT '
BEGIN TRANSACTION
BEGIN TRY'

SELECT
   '
   ALTER TABLE [' + ForeignKeyConstraintTableSchema + '].[' + ForeignKeyConstraintTableName + '] 
   ADD CONSTRAINT ' + ForeignKeyConstraintName + ' FOREIGN KEY(' + ForeignKeyConstraintColumnName + ') REFERENCES [' + PrimaryKeyConstraintTableSchema + '].[' + PrimaryKeyConstraintTableName + '](' + PrimaryKeyConstraintColumnName + ') ON UPDATE ' + UpdateRule + ' ON DELETE ' + DeleteRule + '
   '
FROM
   @table

SELECT '
END TRY

BEGIN CATCH
   ROLLBACK TRANSACTION
   RAISERROR(''Operation failed.'', 16, 1)
END CATCH

IF(@@TRANCOUNT != 0)
BEGIN
   COMMIT TRANSACTION
   RAISERROR(''Operation completed successfully.'', 10, 1)
END'

GO 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2016-02-16T08:16:22.413

**`WITH CHECK CHECK`几乎可以肯定是必需的！**

在一些答案和评论中提出了这一点，但我觉得再次提出这一点很重要。

使用以下命令 (no) 重新启用约束`WITH CHECK`将有一些[严重的缺点](https://msdn.microsoft.com/en-us/library/ms190273.aspx)。

```
ALTER TABLE MyTable CHECK CONSTRAINT MyConstraint; 
```

> 带支票 | 带NOCHECK
> 
> 指定是否针对新添加或重新启用的 FOREIGN KEY 或 CHECK 约束验证表中的数据。如果未指定，则假定 WITH CHECK 用于新约束，而 WITH NOCHECK 假定用于重新启用的约束。
> 
> 如果您不想针对现有数据验证新的 CHECK 或 FOREIGN KEY 约束，请使用 WITH NOCHECK。我们不建议这样做，除非在极少数情况下。新约束将在以后的所有数据更新中进行评估。在添加约束时由 WITH NOCHECK 抑制的任何约束违规都可能导致将来的更新失败，如果它们使用不符合约束的数据更新行。
> 
> 查询优化器不考虑用 NOCHECK 定义的约束。在使用 ALTER TABLE table WITH CHECK CHECK CONSTRAINT ALL 重新启用这些约束之前，它们将被忽略。

**注意：** WITH NOCHECK 是重新启用约束的默认设置。我不得不想为什么...

1.  在执行此命令期间不会评估表中的现有数据 - 成功完成并不能保证表中的数据根据​​约束是有效的。
2.  在无效记录的下一次更新期间，将评估约束并将失败 - 导致可能与所做的实际更新无关的错误。
3.  依赖约束来确保数据有效的应用程序逻辑可能会失败。
4.  查询优化器不会使用以这种方式启用的任何约束。

[sys.foreign_keys](https://msdn.microsoft.com/en-us/library/ms189807.aspx)系统视图提供了对该问题的一些可见性。请注意，它有一个`is_disabled`和一个`is_not_trusted`列。`is_disabled`指示是否将针对约束验证未来的数据操作操作。`is_not_trusted`指示当前表中的所有数据是否已针对约束进行了验证。

```
ALTER TABLE MyTable WITH CHECK CHECK CONSTRAINT MyConstraint; 
```

你的约束值得信任吗？找出...

```
SELECT * FROM sys.foreign_keys WHERE is_not_trusted = 1; 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2015-06-19T19:13:29.403

第一篇文章:)

对于 OP，kristof 的解决方案将起作用，除非在大删除时存在大量数据和事务日志气球问题。此外，即使有备用的 tlog 存储，由于删除写入到 tlog，对于具有数亿行的表，该操作可能需要很长时间。

我经常使用一系列游标来截断和重新加载我们一个庞大的生产数据库的大型副本。设计的解决方案考虑了多个模式、多个外键列，最重要的是可以存储在 SSIS 中使用。

它涉及创建三个临时表（真实表）以容纳 DROP、CREATE 和 CHECK FK 脚本，创建这些脚本并将其插入表中，然后循环遍历表并执行它们。附带的脚本分为四个部分：1.）在三个临时（真实）表中创建和存储脚本，2.）通过游标逐个执行 drop FK 脚本，3.）使用 sp_MSforeachtable 截断所有除了我们的三个临时表和 4.) 执行创建 FK 并在 ETL SSIS 包末尾检查 FK 脚本。

在 SSIS 的执行 SQL 任务中运行脚本创建部分。在第二个执行 SQL 任务中运行“执行删除 FK 脚本”部分。将截断脚本放在第三个 Execute SQL 任务中，然后在控制流结束时将 CREATE 和 CHECK 脚本附加到最终的 Execute SQL 任务（或两个如果需要）中之前执行您需要执行的任何其他 ETL 过程。

事实证明，当重新应用外键失败时，将脚本存储在真实表中是非常宝贵的，因为您可以从 sync_CreateFK 中选择 *，复制/粘贴到您的查询窗口中，一次运行一个，并在您完成后修复数据问题找到那些失败/仍然无法重新申请的。

如果脚本失败，请不要再次重新运行脚本，而不要确保在执行此操作之前重新应用所有外键/检查，否则您很可能会丢失一些创建并检查 fk 脚本，因为我们的登台表被删除并且在创建要执行的脚本之前重新创建。

```
----------------------------------------------------------------------------
1)
/*
Author:         Denmach
DateCreated:    2014-04-23
Purpose:        Generates SQL statements to DROP, ADD, and CHECK existing constraints for a 
                database.  Stores scripts in tables on target database for execution.  Executes
                those stored scripts via independent cursors. 
DateModified:
ModifiedBy
Comments:       This will eliminate deletes and the T-log ballooning associated with it.
*/

DECLARE @schema_name SYSNAME; 
DECLARE @table_name SYSNAME; 
DECLARE @constraint_name SYSNAME; 
DECLARE @constraint_object_id INT; 
DECLARE @referenced_object_name SYSNAME; 
DECLARE @is_disabled BIT; 
DECLARE @is_not_for_replication BIT; 
DECLARE @is_not_trusted BIT; 
DECLARE @delete_referential_action TINYINT; 
DECLARE @update_referential_action TINYINT; 
DECLARE @tsql NVARCHAR(4000); 
DECLARE @tsql2 NVARCHAR(4000); 
DECLARE @fkCol SYSNAME; 
DECLARE @pkCol SYSNAME; 
DECLARE @col1 BIT; 
DECLARE @action CHAR(6);  
DECLARE @referenced_schema_name SYSNAME;

--------------------------------Generate scripts to drop all foreign keys in a database --------------------------------

IF OBJECT_ID('dbo.sync_dropFK') IS NOT NULL
DROP TABLE sync_dropFK

CREATE TABLE sync_dropFK
    (
    ID INT IDENTITY (1,1) NOT NULL
    , Script NVARCHAR(4000)
    )

DECLARE FKcursor CURSOR FOR

    SELECT 
        OBJECT_SCHEMA_NAME(parent_object_id)
        , OBJECT_NAME(parent_object_id)
        , name
    FROM 
        sys.foreign_keys WITH (NOLOCK)
    ORDER BY 
        1,2;

OPEN FKcursor;

FETCH NEXT FROM FKcursor INTO 
    @schema_name
    , @table_name
    , @constraint_name

WHILE @@FETCH_STATUS = 0

BEGIN
        SET @tsql = 'ALTER TABLE '
                + QUOTENAME(@schema_name) 
                + '.' 
                + QUOTENAME(@table_name)
                + ' DROP CONSTRAINT ' 
                + QUOTENAME(@constraint_name) 
                + ';';
    --PRINT @tsql;
    INSERT sync_dropFK  (
                        Script
                        )
                        VALUES (
                                @tsql
                                )   

    FETCH NEXT FROM FKcursor INTO 
    @schema_name
    , @table_name
    , @constraint_name
    ;

END;

CLOSE FKcursor;

DEALLOCATE FKcursor;

---------------Generate scripts to create all existing foreign keys in a database --------------------------------
----------------------------------------------------------------------------------------------------------
IF OBJECT_ID('dbo.sync_createFK') IS NOT NULL
DROP TABLE sync_createFK

CREATE TABLE sync_createFK
    (
    ID INT IDENTITY (1,1) NOT NULL
    , Script NVARCHAR(4000)
    )

IF OBJECT_ID('dbo.sync_createCHECK') IS NOT NULL
DROP TABLE sync_createCHECK

CREATE TABLE sync_createCHECK
    (
    ID INT IDENTITY (1,1) NOT NULL
    , Script NVARCHAR(4000)
    )   

DECLARE FKcursor CURSOR FOR

     SELECT 
        OBJECT_SCHEMA_NAME(parent_object_id)
        , OBJECT_NAME(parent_object_id)
        , name
        , OBJECT_NAME(referenced_object_id)
        , OBJECT_ID
        , is_disabled
        , is_not_for_replication
        , is_not_trusted
        , delete_referential_action
        , update_referential_action
        , OBJECT_SCHEMA_NAME(referenced_object_id)

    FROM 
        sys.foreign_keys WITH (NOLOCK)

    ORDER BY 
        1,2;

OPEN FKcursor;

FETCH NEXT FROM FKcursor INTO 
    @schema_name
    , @table_name
    , @constraint_name
    , @referenced_object_name
    , @constraint_object_id
    , @is_disabled
    , @is_not_for_replication
    , @is_not_trusted
    , @delete_referential_action
    , @update_referential_action
    , @referenced_schema_name;

WHILE @@FETCH_STATUS = 0

BEGIN

        BEGIN
            SET @tsql = 'ALTER TABLE '
                        + QUOTENAME(@schema_name) 
                        + '.' 
                        + QUOTENAME(@table_name)
                        +   CASE 
                                @is_not_trusted
                                WHEN 0 THEN ' WITH CHECK '
                                ELSE ' WITH NOCHECK '
                            END
                        + ' ADD CONSTRAINT ' 
                        + QUOTENAME(@constraint_name)
                        + ' FOREIGN KEY (';

        SET @tsql2 = '';

        DECLARE ColumnCursor CURSOR FOR 

            SELECT 
                COL_NAME(fk.parent_object_id
                , fkc.parent_column_id)
                , COL_NAME(fk.referenced_object_id
                , fkc.referenced_column_id)

            FROM 
                sys.foreign_keys fk WITH (NOLOCK)
                INNER JOIN sys.foreign_key_columns fkc WITH (NOLOCK) ON fk.[object_id] = fkc.constraint_object_id

            WHERE 
                fkc.constraint_object_id = @constraint_object_id

            ORDER BY 
                fkc.constraint_column_id;

        OPEN ColumnCursor;

        SET @col1 = 1;

        FETCH NEXT FROM ColumnCursor INTO @fkCol, @pkCol;

        WHILE @@FETCH_STATUS = 0

        BEGIN
            IF (@col1 = 1)
                SET @col1 = 0;
            ELSE
            BEGIN
                SET @tsql = @tsql + ',';
                SET @tsql2 = @tsql2 + ',';
            END;

            SET @tsql = @tsql + QUOTENAME(@fkCol);
            SET @tsql2 = @tsql2 + QUOTENAME(@pkCol);
            --PRINT '@tsql = ' + @tsql 
            --PRINT '@tsql2 = ' + @tsql2
            FETCH NEXT FROM ColumnCursor INTO @fkCol, @pkCol;
            --PRINT 'FK Column ' + @fkCol
            --PRINT 'PK Column ' + @pkCol 
        END;

        CLOSE ColumnCursor;
        DEALLOCATE ColumnCursor;

        SET @tsql = @tsql + ' ) REFERENCES ' 
                    + QUOTENAME(@referenced_schema_name) 
                    + '.' 
                    + QUOTENAME(@referenced_object_name)
                    + ' (' 
                    + @tsql2 + ')';

        SET @tsql = @tsql
                    + ' ON UPDATE ' 
                    + 
                        CASE @update_referential_action
                            WHEN 0 THEN 'NO ACTION '
                            WHEN 1 THEN 'CASCADE '
                            WHEN 2 THEN 'SET NULL '
                                ELSE 'SET DEFAULT '
                        END

                    + ' ON DELETE ' 
                    + 
                        CASE @delete_referential_action
                            WHEN 0 THEN 'NO ACTION '
                            WHEN 1 THEN 'CASCADE '
                            WHEN 2 THEN 'SET NULL '
                                ELSE 'SET DEFAULT '
                        END

                    + 
                    CASE @is_not_for_replication
                        WHEN 1 THEN ' NOT FOR REPLICATION '
                            ELSE ''
                    END
                    + ';';

        END;

    --  PRINT @tsql
        INSERT sync_createFK    
                        (
                        Script
                        )
                        VALUES (
                                @tsql
                                )

-------------------Generate CHECK CONSTRAINT scripts for a database ------------------------------
----------------------------------------------------------------------------------------------------------

        BEGIN

        SET @tsql = 'ALTER TABLE '
                    + QUOTENAME(@schema_name) 
                    + '.' 
                    + QUOTENAME(@table_name)
                    + 
                        CASE @is_disabled
                            WHEN 0 THEN ' CHECK '
                                ELSE ' NOCHECK '
                        END
                    + 'CONSTRAINT ' 
                    + QUOTENAME(@constraint_name)
                    + ';';
        --PRINT @tsql;
        INSERT sync_createCHECK 
                        (
                        Script
                        )
                        VALUES (
                                @tsql
                                )   
        END;

    FETCH NEXT FROM FKcursor INTO 
    @schema_name
    , @table_name
    , @constraint_name
    , @referenced_object_name
    , @constraint_object_id
    , @is_disabled
    , @is_not_for_replication
    , @is_not_trusted
    , @delete_referential_action
    , @update_referential_action
    , @referenced_schema_name;

END;

CLOSE FKcursor;

DEALLOCATE FKcursor;

--SELECT * FROM sync_DropFK
--SELECT * FROM sync_CreateFK
--SELECT * FROM sync_CreateCHECK
---------------------------------------------------------------------------
2.)
-----------------------------------------------------------------------------------------------------------------
----------------------------execute Drop FK Scripts --------------------------------------------------

DECLARE @scriptD NVARCHAR(4000)

DECLARE DropFKCursor CURSOR FOR
    SELECT Script 
    FROM sync_dropFK WITH (NOLOCK)

OPEN DropFKCursor

FETCH NEXT FROM DropFKCursor
INTO @scriptD

WHILE @@FETCH_STATUS = 0
BEGIN
--PRINT @scriptD
EXEC (@scriptD)
FETCH NEXT FROM DropFKCursor
INTO @scriptD
END
CLOSE DropFKCursor
DEALLOCATE DropFKCursor
--------------------------------------------------------------------------------
3.) 

------------------------------------------------------------------------------------------------------------------
----------------------------Truncate all tables in the database other than our staging tables --------------------
------------------------------------------------------------------------------------------------------------------

EXEC sp_MSforeachtable 'IF OBJECT_ID(''?'') NOT IN 
(
ISNULL(OBJECT_ID(''dbo.sync_createCHECK''),0),
ISNULL(OBJECT_ID(''dbo.sync_createFK''),0),
ISNULL(OBJECT_ID(''dbo.sync_dropFK''),0)
)
BEGIN TRY
 TRUNCATE TABLE ?
END TRY
BEGIN CATCH
 PRINT ''Truncation failed on''+ ? +''
END CATCH;' 
GO
-------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------
----------------------------execute Create FK Scripts and CHECK CONSTRAINT Scripts---------------
----------------------------tack me at the end of the ETL in a SQL task-------------------------
-------------------------------------------------------------------------------------------------
DECLARE @scriptC NVARCHAR(4000)

DECLARE CreateFKCursor CURSOR FOR
    SELECT Script 
    FROM sync_createFK WITH (NOLOCK)

OPEN CreateFKCursor

FETCH NEXT FROM CreateFKCursor
INTO @scriptC

WHILE @@FETCH_STATUS = 0
BEGIN
--PRINT @scriptC
EXEC (@scriptC)
FETCH NEXT FROM CreateFKCursor
INTO @scriptC
END
CLOSE CreateFKCursor
DEALLOCATE CreateFKCursor
-------------------------------------------------------------------------------------------------
DECLARE @scriptCh NVARCHAR(4000)

DECLARE CreateCHECKCursor CURSOR FOR
    SELECT Script 
    FROM sync_createCHECK WITH (NOLOCK)

OPEN CreateCHECKCursor

FETCH NEXT FROM CreateCHECKCursor
INTO @scriptCh

WHILE @@FETCH_STATUS = 0
BEGIN
--PRINT @scriptCh
EXEC (@scriptCh)
FETCH NEXT FROM CreateCHECKCursor
INTO @scriptCh
END
CLOSE CreateCHECKCursor
DEALLOCATE CreateCHECKCursor 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2014-02-14T06:31:22.693

找到约束

```
SELECT * 
FROM sys.foreign_keys
WHERE referenced_object_id = object_id('TABLE_NAME') 
```

执行这个SQL生成的SQL

```
SELECT 
    'ALTER TABLE ' +  OBJECT_SCHEMA_NAME(parent_object_id) +
    '.[' + OBJECT_NAME(parent_object_id) + 
    '] DROP CONSTRAINT ' + name
FROM sys.foreign_keys
WHERE referenced_object_id = object_id('TABLE_NAME') 
```

西夫韦。

**注意：添加了删除约束的解决方案，以便可以删除或修改表而不会出现任何约束错误。**

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2017-02-06T14:57:09.120

标记为“905”的答案看起来不错，但不起作用。

以下为我工作。**不能**禁用任何主键、唯一键或默认约束。事实上，如果 'sp_helpconstraint'' 在 status_enabled 中显示 'n/a' - 意味着它**不能**被启用/禁用。

-- 生成脚本以禁用

```
select 'ALTER TABLE ' + object_name(id) + ' NOCHECK CONSTRAINT [' + object_name(constid) + ']'
from sys.sysconstraints 
where status & 0x4813 = 0x813 order by object_name(id) 
```

-- 生成脚本以启用

```
select 'ALTER TABLE ' + object_name(id) + ' CHECK CONSTRAINT [' + object_name(constid) + ']'
from sys.sysconstraints 
where status & 0x4813 = 0x813 order by object_name(id) 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2017-03-24T16:28:26.697

您实际上应该能够像暂时禁用其他约束一样禁用外键约束：

```
Alter table MyTable nocheck constraint FK_ForeignKeyConstraintName 
```

只需确保您在约束名称中列出的第一个表上禁用约束。例如，如果我的外键约束是 FK_LocationsEmployeesLocationIdEmployeeId，我想使用以下内容：

```
Alter table Locations nocheck constraint FK_LocationsEmployeesLocationIdEmployeeId 
```

即使违反此约束会产生一个错误，不一定将该表声明为冲突的来源。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2016-05-16T09:49:49.860

右键单击表设计并转到关系并在左侧窗格中选择外键，在右侧窗格中，将强制外键约束设置为“是”（启用外键约束）或“否”（以禁用它）。 [![在此处输入图像描述](https://i.stack.imgur.com/QEg4B.png)](https://i.stack.imgur.com/QEg4B.png)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-04-03T15:47:36.177

如果你有兴趣，我有一个更有用的版本。我从这里提取了一些代码，该网站的链接不再有效。我对其进行了修改，以允许将一组表放入存储过程中，并在执行所有这些语句之前填充 drop、truncate、add 语句。这使您可以控制决定哪些表需要截断。

```
/****** Object:  UserDefinedTableType [util].[typ_objects_for_managing]    Script Date: 03/04/2016 16:42:55 ******/
CREATE TYPE [util].[typ_objects_for_managing] AS TABLE(
    [schema] [sysname] NOT NULL,
    [object] [sysname] NOT NULL
)
GO

create procedure [util].[truncate_table_with_constraints]
@objects_for_managing util.typ_objects_for_managing readonly

--@schema sysname
--,@table sysname

as 
--select
--    @table = 'TABLE',
--    @schema = 'SCHEMA'

declare @exec_table as table (ordinal int identity (1,1), statement nvarchar(4000), primary key (ordinal));

--print '/*Drop Foreign Key Statements for ['+@schema+'].['+@table+']*/'

insert into @exec_table (statement)
select
          'ALTER TABLE ['+SCHEMA_NAME(o.schema_id)+'].['+ o.name+'] DROP CONSTRAINT ['+fk.name+']'
from sys.foreign_keys fk
inner join sys.objects o
          on fk.parent_object_id = o.object_id
where 
exists ( 
select * from @objects_for_managing chk 
where 
chk.[schema] = SCHEMA_NAME(o.schema_id)  
and 
chk.[object] = o.name
) 
;
          --o.name = @table and
          --SCHEMA_NAME(o.schema_id)  = @schema

insert into @exec_table (statement) 
select
'TRUNCATE TABLE ' + src.[schema] + '.' + src.[object] 
from @objects_for_managing src
; 

--print '/*Create Foreign Key Statements for ['+@schema+'].['+@table+']*/'
insert into @exec_table (statement)
select 'ALTER TABLE ['+SCHEMA_NAME(o.schema_id)+'].['+o.name+'] ADD CONSTRAINT ['+fk.name+'] FOREIGN KEY (['+c.name+']) 
REFERENCES ['+SCHEMA_NAME(refob.schema_id)+'].['+refob.name+'](['+refcol.name+'])'
from sys.foreign_key_columns fkc
inner join sys.foreign_keys fk
          on fkc.constraint_object_id = fk.object_id
inner join sys.objects o
          on fk.parent_object_id = o.object_id
inner join sys.columns c
          on      fkc.parent_column_id = c.column_id and
                   o.object_id = c.object_id
inner join sys.objects refob
          on fkc.referenced_object_id = refob.object_id
inner join sys.columns refcol
          on fkc.referenced_column_id = refcol.column_id and
                   fkc.referenced_object_id = refcol.object_id
where 
exists ( 
select * from @objects_for_managing chk 
where 
chk.[schema] = SCHEMA_NAME(o.schema_id)  
and 
chk.[object] = o.name
) 
;

          --o.name = @table and
          --SCHEMA_NAME(o.schema_id)  = @schema

declare @looper int , @total_records int, @sql_exec nvarchar(4000)

select @looper = 1, @total_records = count(*) from @exec_table; 

while @looper <= @total_records 
begin

select @sql_exec = (select statement from @exec_table where ordinal =@looper)
exec sp_executesql @sql_exec 
print @sql_exec 
set @looper = @looper + 1
end 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2016-09-15T11:57:35.590

一个脚本来统治它们：这将 truncate 和 delete 命令与 sp_MSforeachtable 结合起来，这样您就可以避免删除和重新创建约束 - 只需指定需要删除而不是截断的表，为了我的目的，我已经包含了一个额外的模式过滤器测量（在 2008r2 中测试）

```
declare @schema nvarchar(max) = 'and Schema_Id=Schema_id(''Value'')'
declare @deletiontables nvarchar(max) = '(''TableA'',''TableB'')'
declare @truncateclause nvarchar(max) = @schema + ' and o.Name not in ' +  + @deletiontables;
declare @deleteclause nvarchar(max) = @schema + ' and o.Name in ' + @deletiontables;        

exec sp_MSforeachtable 'alter table ? nocheck constraint all', @whereand=@schema
exec sp_MSforeachtable 'truncate table ?', @whereand=@truncateclause
exec sp_MSforeachtable 'delete from ?', @whereand=@deleteclause
exec sp_MSforeachtable 'alter table ? with check check constraint all', @whereand=@schema 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2018-08-02T05:15:48.983

您可以暂时禁用表上的约束，进行工作，然后重新构建它们。

这是一个简单的方法来做到这一点......

禁用所有索引，包括主键，这将禁用所有外键，然后仅重新启用主键，以便您可以使用它们...

```
DECLARE @sql AS NVARCHAR(max)=''
select @sql = @sql +
    'ALTER INDEX ALL ON [' + t.[name] + '] DISABLE;'+CHAR(13)
from  
    sys.tables t
where type='u'

select @sql = @sql +
    'ALTER INDEX ' + i.[name] + ' ON [' + t.[name] + '] REBUILD;'+CHAR(13)
from  
    sys.key_constraints i
join
    sys.tables t on i.parent_object_id=t.object_id
where
    i.type='PK'

exec dbo.sp_executesql @sql;
go 
```

[做一些事情，比如加载数据]

然后重新启用并重建索引...

```
DECLARE @sql AS NVARCHAR(max)=''
select @sql = @sql +
    'ALTER INDEX ALL ON [' + t.[name] + '] REBUILD;'+CHAR(13)
from  
    sys.tables t
where type='u'

exec dbo.sp_executesql @sql;
go 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2022-02-21T09:40:13.783

您可以使用以下命令轻松关闭 CONSTRAINT：ALTER TABLE TableName NOCHECK CONSTRAINT ALL

完成事务后，不要忘记使用以下命令再次打开它们：ALTER TABLE TableName CHECK CONSTRAINT ALL

# programming-languages - 芥末之类的网络编程语言

> ID：159039
> 
> 赞同：3
> 
> 时间：2008-10-01T18:33:56.673
> 
> 标签：programming-languages

有没有像 Fog Creek 的 Wasabi 一样功能的开源或商业网络编程语言？就像您用这种父语言编写 Web 应用程序一样，然后它会编译为 Linux 主机的 php 和 Windows 主机的 ASP.NET。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T21:27:50.513

[Haxe](http://haxe.org/)是我见过的最接近的，但它只能编译为 PHP（和 mod_neko），而不是 ASP。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T22:17:44.060

[Genexus](http://www.genexus.com/)是一个可以做到这一点的商业开发工具。它可以生成其他几种语言。它面向数据库应用程序，它从其内部语言生成数据库模式和查询。

也就是说，我已经使用它了，我不喜欢它。它非常有问题，而且它的编程语言非常古老。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-30T22:30:23.627

在您打扰之前，请考虑一下它是否真的值得。

支持一个平台多种配置已经够糟糕的了；你真的需要同时支持 ASP.NET 和 PHP 吗？如果您正在编写内部应用程序，那么您可能希望尽可能少地使用技术。如果您正在编写要销售的软件，那么如果您的产品需要特定的平台真的有问题吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T20:50:38.653

据我所知，Fog Creek 不得不开发 Wasabi，因为没有这样的工具。有一些工具包试图移植，但据我所知，没有一个工具包可以编译为 ASP 或 PHP（除了 Wasabi）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-30T22:42:11.357

人们表现得好像乔尔对芥末发疯了，但我认为如果你把所有的部分放在一起，那是完全有道理的。

1.  FogBugz 最初是用 VB 编写的。
2.  Joel 讨厌丢掉工作代码来重新开始。
3.  Joel 面临着 MS 和 Apache w/PHP 服务器之间的服务器市场分裂。

鉴于这种情况，说“好的，那么，我们将只编写一个 VB 到 PHP 的翻译器”是一个理性的决定。

一旦你迈出了这一步，你会说，“好吧，既然我们这里基本上有一个编译器，为什么不使用我们想要的微软从未添加到 VB 的功能来扩展它呢？”

多亏了 Wasabi，必须编写两次的代码（或者更多，考虑到一些重复的服务器/JavaScript 代码）只编写一次。

多目标开发非常普遍。当您无法指定目标环境时，这就是现实。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-31T05:03:07.117

选择一个真正成熟的应用服务器平台，比如 Java。它到处跑...

# oop - 我们放在方法声明上方的文档的正确术语是什么？

> ID：159059
> 
> 赞同：1
> 
> 时间：2008-10-01T18:36:41.580
> 
> 标签：oop, terminology, javadoc

我正在写一份白皮书，并意识到我不确定我们在定义声明之前作为注释块放置的那种内部文档的官方术语是什么。

最终成为 JavaDoc 成员文档的相同内容。

这不仅仅是内部文档，我不确定“标题文档”是否是一个好词。

请注意，我正在寻找一个通用术语，而不是特定于特定语言的术语（例如，Java/Perl）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-20T20:15:42.563

这称为**方法规范**或**过程规范**。也就是说，它指定了过程的行为而不是实现细节。一些教科书将其称为方法的合同，但这可能有点模棱两可。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T18:47:38.777

在我的组织中，我们将其称为方法或函数 doc-comment。函数级文档可能是使用更广泛的术语。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T18:49:32.967

我总是称它为方法（或函数）注释，以区别于类或文件注释。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T18:39:14.240

它通常被专业地称为“要求条款”或“保险条款”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T00:09:47.940

我称之为代码注释，就这么简单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-20T20:28:40.557

我通常将其称为“内联文档”。对我来说，这就是它的意义所在——您的文档*在*源代码中，因此文档更有可能与代码保持同步。

(This is no guarantee, of course, but it does encourage programmers to eat their vegetables. It means the developer can change the documentation *at the same time* and *in the same place* the behavior changes, rather than after the fact and in another place.)

# c# - Windows 服务与 Windows 窗体在同一进程中

> ID：159076
> 
> 赞同：6
> 
> 时间：2008-10-01T18:38:42.417
> 
> 标签：c#, windows, windows-services

我有 ac# 应用程序，它作为 Windows 服务运行，控制套接字连接和其他东西。此外，还有另一个 Windows 窗体应用程序来控制和配置此服务（带有启动、停止、显示配置参数的表单的系统托盘）。

我正在使用 .net 远程处理进行 IPC，这很好，但现在我想显示一些真实的流量和其他报告，远程处理无法满足我的性能要求。所以我想将这两个应用程序合二为一。

这是问题所在：

当我从 Windows 服务启动表单时，什么也没发生。谷歌搜索我发现我必须右键单击该服务，转到登录并选中“允许服务与桌面交互”选项。因为我不想让我的用户这样做，所以我在安装期间再次进行了一些代码谷歌搜索以在用户的​​ regedit 中设置此选项。问题是即使设置了这个选项，它也不起作用。我必须打开服务的登录选项（已选中），取消选中并再次检查。

**那么，如何解决呢？在同一进程中拥有带有系统托盘控件的 Windows 服务的最佳方式是什么，可供任何登录用户使用？**

更新：感谢到目前为止的评论，伙计们。我同意使用 IPC 更好，而且我知道混合 Windows 服务和用户界面是不好的。尽管如此，我想知道如何做到这一点。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-01T18:40:03.863

使用您选择的技术进行通信的两个独立进程。带有 UI 的服务是个**坏主意**。不要走这条路——你会后悔的。

通过一个简单的套接字连接进行服务通信，我取得了非常好的结果 - 很好地记录您的服务协议，使其尽可能简单，这将比您想象的要容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T18:41:24.063

在实践中，您不应该将您的服务与管理 UI 结合起来。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T18:41:37.840

我同意格雷格的观点。也许您可以检查不同的 IPC 机制。也许使用套接字和您自己的协议。或者，如果您的服务控制应用程序只能控制本地机器上的服务，您可以使用命名管道（甚至更快）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-23T12:51:50.433

这是一种混合服务和表单的方法

[http://www.codeproject.com/KB/system/SystemTrayIconInSvc.aspx](http://www.codeproject.com/KB/system/SystemTrayIconInSvc.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-11-24T15:02:14.007

[我从这篇文章](http://msdn.microsoft.com/en-us/library/aa394418%28VS.85%29.aspx)中知道了如何做到这一点（单击方法表中的“更改”链接）。

```
string wmiPath = "Win32_Service.Name='" + SERVICE_NAME + "'";
using (ManagementObject service = new ManagementObject(wmiPath))
{
    object[] parameters = new object[11];
    parameters[5] = true;  // Enable desktop interaction
    service.InvokeMethod("Change", parameters);
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-03-18T21:19:44.320

我有几个步骤的解决方案，这是计划

1.  我们不会使用 Windows 窗体创建服务项目，而是创建一个包含 Windows 服务项目、Windows 窗体项目和设置项目的 Visual Studio 解决方案。

2.  这个想法是拥有一个数据库或文件或任何您喜欢存储数据的数据，您将在其中存储 Windows 服务将始终用于运行的参数。因此，您的 Windows 服务和您的 Windows 窗体应用程序应该能够从中修改和检索数据。

3.  到您的 Windows 应用程序的主窗体，在窗体上拖放一个 NotifyIcon，在属性选项卡中，浏览并选择一个 .ico 图像（您可以在 Visual Studio 中创建一个，但这是您可以在 google 上获得的另一个主题或联系我) 当您运行应用程序并且主窗体处于活动状态或显示时，它将显示在系统托盘中，试一试，运行应用程序。

4.  将它们都添加为解决方案的设置项目中的输出。要将项目添加到设置项目，它们必须位于同一解决方案中。右键单击解决方案资源管理器中的设置项目，突出显示添加，然后选择项目输出，添加 windows 服务和 windows 窗体输出，您将在设置项目下的解决方案资源管理器中看到它们。

5.  添加 Windows 服务比这更进一步，但这也是另一个话题 google it

6.  为 Windows 应用程序创建快捷方式并将其添加到启动文件夹也是谷歌或联系我的另一个主题。

    注意以不显示关闭按钮并且表单变为 Me.visible = false 的方式对表单进行编程，双击系统托盘中的图标是设置 me.visible=true 的唯一方法。计算机启动，您的 Windows 窗体应用程序也已启动，并且可见立即设置为 false，但由于它有一个带有图标图像的 notifyicon，它将显示在系统托盘中并双击它使窗体可见以编辑您的设置正在为服务存储，该服务也会自动启动，因为您会在设置项目中设置服务时设置它。我的邮件是 iamjavademon@gmail.com 以便使用屏幕截图更好地说明并详细解释

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-21T12:49:43.307

这非常简单——您需要创建一个线程来执行应用程序事件。像这样（带有 CLR 的 C++ 的源代码，但您可以在 C# 中实现）：

```
ref class RunWindow{
public:
    static void MakeWindow(Object^ data)
    {
        Application::EnableVisualStyles();
        Application::SetCompatibleTextRenderingDefault(false); 

        Application::Run(gcnew TMainForm());
    };
}; 
```

并在 main 中创建线程

```
int main(array<System::String ^> ^args)
{
    bool bService = RunAsService(L"SimpleServiceWithIconInTrayAndWindow");

    if (bService)
    {

        System::Threading::Thread ^thread = gcnew System::Threading::Thread(gcnew ParameterizedThreadStart(RunWindow::MakeWindow));
        thread->Start();

        ServiceBase::Run(gcnew simpleWinService());
        Application::Exit();
    }
    else
    {
        Application::EnableVisualStyles();
        Application::SetCompatibleTextRenderingDefault(false); 

        // Create the main window and run it
        Application::Run(gcnew TMainForm());
    }

    return 0;
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-08T03:02:22.833

交互式服务的主要问题是：

*   安全性 - 其他进程可以通过其消息泵向它发送消息，从而获得对 SYSTEM/LOCAL 进程的访问权限。

*   不完整 - 交互式服务永远不会看到 shell 消息，因此它不能与通知区域图标交互。

我们经常使用 TCP 和 UDP 连接将信息从服务传递给其他 exe，在某些情况下，还包括 MSMQ。

# ruby-on-rails - Composite primary keys versus unique object ID field

> ID：159087
> 
> 赞同：71
> 
> 时间：2008-10-01T18:40:33.473
> 
> 标签：ruby-on-rails, database, design-patterns, database-design

I inherited a database built with the idea that composite keys are much more ideal than using a unique object ID field and that when building a database, a single unique ID should ***never*** be used as a primary key. Because I was building a Rails front-end for this database, I ran into difficulties getting it to conform to the Rails conventions (though it was possible using custom views and a few additional gems to handle composite keys).

The reasoning behind this specific schema design from the person who wrote it had to do with how the database handles ID fields in a non-efficient manner and when it's building indexes, tree sorts are flawed. This explanation lacked any depth and I'm still trying to wrap my head around the concept (I'm familiar with using composite keys, but not 100% of the time).

Can anyone offer opinions or add any greater depth to this topic?

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2008-10-01T22:38:55.007

Most of the commonly used engines (MS SQL Server, Oracle, DB2, MySQL, etc.) would not experience noticeable issues using a surrogate key system. Some may even experience a performance boost from the use of a surrogate, but performance issues are highly platform-specific.

In general terms, the natural key (and by extension, composite key) verses surrogate key debate has a long history with no likely “right answer” in sight.

The arguments for natural keys (singular or composite) usually include some the following:

1) **They are already available in the data model.** Most entities being modeled already include one or more attributes or combinations of attributes that meet the needs of a key for the purposes of creating relations. Adding an additional attribute to each table incorporates an unnecessary redundancy.

2) **They eliminate the need for certain joins.** For example, if you have customers with customer codes, and invoices with invoice numbers (both of which are "natural" keys), and you want to retrieve all the invoice numbers for a specific customer code, you can simply use `"SELECT InvoiceNumber FROM Invoice WHERE CustomerCode = 'XYZ123'"`. In the classic surrogate key approach, the SQL would look something like this: `"SELECT Invoice.InvoiceNumber FROM Invoice INNER JOIN Customer ON Invoice.CustomerID = Customer.CustomerID WHERE Customer.CustomerCode = 'XYZ123'"`.

3) **They contribute to a more universally-applicable approach to data modeling.** With natural keys, the same design can be used largely unchanged between different SQL engines. Many surrogate key approaches use specific SQL engine techniques for key generation, thus requiring more specialization of the data model to implement on different platforms.

Arguments for surrogate keys tend to revolve around issues that are SQL engine specific:

1) **They enable easier changes to attributes when business requirements/rules change.** This is because they allow the data attributes to be isolated to a single table. This is primarily an issue for SQL engines that do not efficiently implement standard SQL constructs such as DOMAINs. When an attribute is defined by a DOMAIN statement, changes to the attribute can be performed schema-wide using an ALTER DOMAIN statement. Different SQL engines have different performance characteristics for altering a domain, and some SQL engines do not implement DOMAINS at all, so data modelers compensate for these situations by adding surrogate keys to improve the ability to make changes to attributes.

2) **They enable easier implementations of concurrency than natural keys.** In the natural key case, if two users are concurrently working with the same information set, such as a customer row, and one of the users modifies the natural key value, then an update by the second user will fail because the customer code they are updating no longer exists in the database. In the surrogate key case, the update will process successfully because immutable ID values are used to identify the rows in the database, not mutable customer codes. However, it is not always desirable to allow the second update – if the customer code changed it is possible that the second user should not be allowed to proceed with their change because the actual “identity” of the row has changed – the second user may be updating the wrong row. Neither surrogate keys nor natural keys, by themselves, address this issue. Comprehensive concurrency solutions have to be addressed outside of the implementation of the key.

3) **They perform better than natural keys.** Performance is most directly affected by the SQL engine. The same database schema implemented on the same hardware using different SQL engines will often have dramatically different performance characteristics, due to the SQL engines data storage and retrieval mechanisms. Some SQL engines closely approximate flat-file systems, where data is actually stored redundantly when the same attribute, such as a Customer Code, appears in multiple places in the database schema. This redundant storage by the SQL engine can cause performance issues when changes need to be made to the data or schema. Other SQL engines provide a better separation between the data model and the storage/retrieval system, allowing for quicker changes of data and schema.

4) **Surrogate keys function better with certain data access libraries and GUI frameworks.** Due to the homogeneous nature of most surrogate key designs (example: all relational keys are integers), data access libraries, ORMs, and GUI frameworks can work with the information without needing special knowledge of the data. Natural keys, due to their heterogeneous nature (different data types, size etc.), do not work as well with automated or semi-automated toolkits and libraries. For specialized scenarios, such as embedded SQL databases, designing the database with a specific toolkit in mind may be acceptable. In other scenarios, databases are enterprise information resources, accessed concurrently by multiple platforms, applications, report systems, and devices, and therefore do not function as well when designed with a focus on any particular library or framework. In addition, databases designed to work with specific toolkits become a liability when the next great toolkit is introduced.

I tend to fall on the side of natural keys (obviously), but I am not fanatical about it. Due to the environment I work in, where any given database I help design may be used by a variety of applications, I use natural keys for the majority of the data modeling, and rarely introduce surrogates. However, I don’t go out of my way to try to re-implement existing databases that use surrogates. Surrogate-key systems work just fine – no need to change something that is already functioning well.

There are some excellent resources discussing the merits of each approach:

[http://www.google.com/search?q=natural+key+surrogate+key](http://www.google.com/search?q=natural+key+surrogate+key)

[http://www.agiledata.org/essays/keys.html](http://www.agiledata.org/essays/keys.html)

[http://www.informationweek.com/news/software/bi/201806814](http://www.informationweek.com/news/software/bi/201806814)

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-10-01T19:05:54.100

I've been developing database applications for 15 years and I have yet to come across a case where a non-surrogate key was a better choice than a surrogate key.

I'm not saying that such a case does not exist, I'm just saying when you factor in the practical issues of actually developing an application that accesses the database, usually the benefits of a surrogate key start to overwhelm the theoretical purity of non-surrogate keys.

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-10-01T19:16:19.440

the primary key should be *constant and meaningless*; non-surrogate keys usually fail one or both requirements, eventually

*   if the key is not constant, you have a future update issue that can get quite complicated

*   if the key is not meaningless, then it is more likely to change, i.e. not be constant; see above

take a simple, common example: a table of Inventory items. It may be tempting to make the item number (sku number, barcode, part code, or whatever) the primary key, but then a year later *all the item numbers change* and you're left with a very messy update-the-whole-database problem...

EDIT: there's an additional issue that is more practical than philosophical. In many cases you're going to find a particular row somehow, then later update it or find it again (or both). With composite keys there is more data to keep track of and more contraints in the WHERE clause for the re-find or update (or delete). It is also possible that one of the key segments may have changed in the meantime!. With a surrogate key, there is always only one value to retain (the surrogate ID) and by definition it cannot change, which simplifies the situation significantly.

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-01T18:53:37.827

It **sounds** like the person who created the database is on the natural keys side of the great natural keys vs. surrogate keys debate.

I've never heard of any problems with btrees on ID fields, but I also haven't studied it in any great depth...

I fall on the surrogate key side: You have less repetition when using a surrogate key, because you're only repeating a single value in the other tables. Since humans rarely join tables by hand, we don't care if it's a number or not. Also, since there's only one fixed-size column to look up in the index, it's safe to assume surrogates have a faster lookup time by primary key as well.

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-01T18:46:05.130

Using 'unique (object) ID' fields simplifies joins, but you should aim to have the other (possibly composite) key still unique -- do NOT relax the not-null constraints and DO maintain the unique constraint.

If the DBMS can't handle unique integers effectively, it has big problems. However, using both a 'unique (object) ID' and the other key does use more space (for the indexes) than just the other key, and has two indexes to update on each insert operation. So it isn't a freebie -- but as long as you maintain the original key, too, then you'll be OK. If you eliminate the other key, you are breaking the design of your system; all hell will break loose eventually (and you might or might not spot that hell broke loose).

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-02T20:12:56.473

I basically am a member of the surrogate key team, and even if I appreciate and understand arguments such as the ones presented here by JeremyDWill, I am still looking for the case where "natural" key is better than surrogate ...

Other posts dealing with this issue usually refer to relational database theory and database performance. Another interesting argument, always forgotten in this case, is related to **table normalisation** and **code productivity**:

each time I create a table, shall I lose time

1.  identifying its primary key and its physical characteristics (type, size)
2.  remembering these characteristics each time I want to refer to it in my code?
3.  explaining my PK choice to other developers in the team?

My answer is no to all of these questions:

1.  I have no time to lose trying to identify "the best Primary Key" when dealing with a list of persons.
2.  I do not want to remember that the Primary Key of my "`computer`" table is a 64 characters long string (does Windows accepts that many characters for a computer name?).
3.  I don't want to explain my choice to other developers, where one of them will finally say "Yeah man, but consider that you have to manage computers over different domains? Does this 64 characters string allow you to store the domain name + the computer name?".

So I've been working for the last five years with a very basic rule: each table (let's call it '`myTable`') has its first field called '`id_MyTable`' which is of uniqueIdentifier type. Even if this table supports a "many-to-many" relation, such as a '`ComputerUser`' table, where the combination of '`id_Computer`' and '`id_User`' forms a very acceptable Primary Key, I prefer to create this '`id_ComputerUser`' field being a uniqueIdentifier, just to stick to the rule.

The major advantage is that you don't have to care animore about the use of Primary Key and/or Foreign Key within your code. Once you have the table name, you know the PK name and type. Once you know which links are implemented in your data model, you'll know the name of available foreign keys in the table.

I am not sure that my rule is the best one. But it is a very efficient one!

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-21T20:33:13.730

A practical approach to developing a new architecture is one that utilizes surrogate keys for tables that will contain thousands of multi-column highly unique records and composite keys for short descriptionary tables. I usually find that the colleges dictate the use of surrogate keys while the real world programmers prefer composite keys. You really need to apply the right type of primary key to the table - not just one way or the other.

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-01T18:55:51.457

using natural keys makes a nightmare using any automatic ORM as persistence layer. Also, foreign keys on multiple column tend to overlap one another and this will give further problem when navigating and updating the relationship in a OO way.

Still you could transform the natural key in an unique constrain and add an auto generated id; this doesn't remove the problem with the foreign keys, though, those will have to be changed by hand; hopefully multiple columns and overlapping constraints will be a minority of all the relationship, so you could concentrate on refactoring where it matter most.

natural pk have their motivation and usages scenario and are not a bad thing(tm), they just tend to not get along well with ORM.

my feeling is that as any other concepts, natural keys and table normalization should be used when sensible and not as blind design constraints

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-01T19:29:18.113

I'm going to be short and sweet here: Composite primary keys are not good these days. Add in surrogate arbitrary keys if you can and maintain the current key schemes via unique constraints. ORM is happy, you're happy, original programmer not-so-happy but unless he's your boss then he can just deal with it.

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-01T19:22:09.660

Composite keys can be good - they may affect performance - but they are not the only answer, in much the same way that a unique (surrogate) key isn't the only answer.

What concerns me is the vagueness in the reasoning for choosing composite keys. More often than not vagueness about anything technical indicates a lack of understanding - maybe following someone else's guidelines, in a book or article....

There is nothing wrong with a single unique ID - infact if you've got an application connected to a database server and you can choose which database you're using it will all be good, and you can pretty much do anything with your keys and not really suffer too badly.

There has been, and will be, a lot written about this, because there is no single answer. There are methods and approaches that need to be applied carefully in a skilled manner.

I've had lots of problems with ID's being provided automatically by the database - and I avoid them wherever possible, but still use them occasionally.

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-01T20:09:46.223

> ... how the database handles ID fields in a non-efficient manner and when it's building indexes, tree sorts are flawed ...

This was almost certainly nonsense, but may have related to the issue of index block contention when assigning incrementing numbers to a PK at a high rate from different sessions. If so then the REVERSE KEY index is there to help, albeit at the expense of a larger index size due to a change in block-split algorithm. [http://download.oracle.com/docs/cd/B19306_01/server.102/b14220/schema.htm#sthref998](http://download.oracle.com/docs/cd/B19306_01/server.102/b14220/schema.htm#sthref998)

Go synthetic, particularly if it aids more rapid development with your toolset.

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-04-21T07:06:47.007

I am not a experienced one but still i m in favor of Using primary key as id here is the explanation using an example..

The format of external data may change over time. For example, you might think that the ISBN of a book would make a good primary key in a table of books. After all, ISBNs are unique. But as this particular book is being written, the publishing industry in the United States is gearing up for a major change as additional digits are added to all ISBNs. If we’d used the ISBN as the primary key in a table of books, we’d have to update each row to reflect this change. But then we’d have another problem. There’ll be other tables in the database that reference rows in the books table via the primary key. We can’t change the key in the books table unless we first go through and update all of these references. And that will involve dropping foreign key constraints, updating tables, updating the books table, and finally reestablishing the constraints. All in all, this is something of a pain. The problems go away if we use our own internal value as a primary key. No third party can come along and arbitrarily tell us to change our schema—we control our own keyspace. And if something such as the ISBN does need to change, it can change without affecting any of the existing relationships in the database. In effect, we’ve decoupled the knitting together of rows from the external representation of data in those rows.

Although the explanation is quite bookish but i think it explains the things in a simpler way.

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-02T08:42:11.813

@JeremyDWill

Thank you for providing some much-needed balance to the debate. In particular, thanks for the info on `DOMAIN`s.

I actually use surrogate keys system-wide for the sake of consistency, but there *are* tradeoffs involved. The most common cause for me to curse using surrogate keys is when I have a lookup table with a short list of canonical values—I'd use less space and all my queries would be shorter/easier/faster if I had just made the values the PK instead of having to join to the table.

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-24T15:03:11.353

You can do both - since any big company database is likely to be used by several applications, including human DBAs running one-off queries and data imports, designing it purely for the benefit of ORM systems is not always practical or desirable.

What I tend to do these days is to add a "RowID" property to each table - this field is a GUID, and so unique to each row. This is NOT the primary key - that is a natural key (if possible). However, any ORM layers working on top of this database can use the RowID to identify their derived objects.

Thus you might have:

```
CREATE TABLE dbo.Invoice (
  CustomerId varchar(10),
  CustomerOrderNo varchar(10),
  InvoiceAmount money not null,
  Comments nvarchar(4000),
  RowId uniqueidentifier not null default(newid()),

  primary key(CustomerId, CustomerOrderNo)
)

```

So your DBA is happy, your ORM architect is happy, and your database integrity is preserved!

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-06-08T15:52:05.040

I just wanted to add something here that I don't ever see covered when discussing auto-generated integer identity fields with relational databases (because I see them a lot), and that is, it's base type can an will overflow at some point.

Now I'm not trying to say this automatically makes composite ids the way to go, but it's just a matter of fact that even though more data could be logically added to a table (which is still unique), the single auto-generated integer identity could prevent this from happening.

Yes I realize that for most situations it's unlikely, and using a 64bit integer gives you lots of headroom, and realistically the database probably should have been designed differently if an overflow like this ever occurred.

But that doesn't prevent someone from doing it... a table using a single auto-generated 32bit integer as it's identity, which is expected to store all transactions at a global level for a particular fast-food company, is going fail as soon as it tries to insert it's 2,147,483,648th transaction (and that is a completely feasible scenario).

It's just something to note, that people tend to gloss over or just ignore entirely. If any table is going to be inserted into with regularity, considerations should be made to just how often and how much data will accumulate over time, and whether or not an integer based identifier should even be used.

# wpf - 依赖属性和数据绑定？

> ID：159088
> 
> 赞同：7
> 
> 时间：2008-10-01T18:40:42.130
> 
> 标签：wpf, data-binding

在 WPF 中：

有人可以解释一下 DependencyProperty 和 Databinding 之间的关系吗？

我的代码中有一个属性，我想成为我的数据绑定的来源。如果我想将此对象绑定到 XAML 上的文本框，那么 DependencyProperty（或它）何时发挥作用。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-01T19:24:52.337

绑定中的目标必须始终是 a `DependencyProperty`，但任何属性（甚至是普通属性）都可以是源。

普通属性的问题是绑定只会获取一次值，之后不会更改，因为普通源属性中缺少更改通知。

要提供该更改通知而不将其设置为`DependencyProperty`，可以：

1.  在定义属性的类上实现`INotifyPropertyChanged`。

2.  创建一个事件。（向后兼容性。）*`PropertyName`*`Changed`

WPF 将与第一选择更好地工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2021-04-15T06:58:10.187

## *什么是 DependencyProperty？*

**DependencyProperty**类是隐藏在 .Net Framework WPF 深处的最重要的设计基础之一。

此类受`sealed`.NET Framework 的保护。此属性与一维通用属性的不同之处在于，它不仅存储字段值，而且还利用了类中提供的各种功能。最重要的是，数据绑定有一个完整的基础。您还可以在绑定某些内容时发送通知。

[DependencyProperty](https://github.com/devncore/dependencyproperty#what-is-the-dependencyproperty)
[Wpf Xaml 绑定](https://github.com/devncore/wpf-xaml-binding#datacontext-is-always-the-reference-point-for-binding)

这已经是一个迟到的答案，但我将介绍我的研究结果。

# .net - XDocument 和 BOM（字节顺序标记）问题

> ID：159097
> 
> 赞同：5
> 
> 时间：2008-10-01T18:42:41.893
> 
> 标签：.net, xml, linq-to-xml

有没有办法在没有 BOM 的情况下输出 XDocument 的内容？使用 Flash 读取输出时，会导致错误。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-01T19:07:26.920

如果您使用 XmlWriter 编写 XML，则可以将 Encoding 设置为已初始化的编码以省略 BOM。

EG：System.Text.UTF8Encoding 的构造函数采用布尔值来指定是否需要 BOM，因此：

```
XmlWriter writer = XmlWriter.Create("foo.xml");
writer.Settings.Encoding = new System.Text.UTF8Encoding(false);
myXDocument.WriteTo(writer); 
```

将创建一个使用 UTF-8 编码且没有字节顺序标记的 XmlWriter。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-06-24T08:22:16.020

对 Chris Wenham 的回答稍加修改。

一旦创建了 XmlWriter 就不能修改编码，但是可以在创建 XmlWriter 时使用 XmlWriterSettings 设置它

```
XmlWriterSettings settings = new XmlWriterSettings();
settings.Encoding = new System.Text.UTF8Encoding(false); 

XmlWriter writer = XmlWriter.Create("foo.xml", settings); 
myXDocument.WriteTo(writer); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-27T11:08:59.687

我无法在上面添加评论，但如果有人使用 Chris Wenham 的建议，请记住处置作者！我花了一些时间想知道为什么我的输出被截断，这就是原因。

建议`using(XmlWriter...) {...}`更改 Chris 的建议

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T19:29:16.757

一种帖子的组合，可能是这样的：

```
 MemoryStream ms = new MemoryStream();
StreamWriter writer = new StreamWriter(ms, new UTF8Encoding(false));
xmlDocument.Save(writer); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T19:58:57.223

如前所述，这个问题有难闻的气味。

根据[此支持说明](http://www.adobe.com/support/flash/languages/unicode_in_flmx/unicode_in_flmx09.html)，Flash 使用 BOM 来消除 UTF-16BE 和 UTF-16LE 之间的歧义，这是理所当然的。所以你不应该从 Flash 中得到错误：XDocument 生成 UTF16 编码的格式良好的 XML，Macromedia 声称 Flash 可以读取 UTF16 编码的格式良好的 XML。

这让我怀疑无论您遇到什么问题，它都可能不是由 BOM 引起的。如果是我，我会更多地挖掘，并期望实际问题出在其他地方。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T19:00:13.300

您可能可以在输出上使用 System.Text.Encoding.Convert() ；就像要尝试的东西，而不是我测试过的东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T19:03:37.210

将其转换为字符串，然后自己删除标记。

# c# - 是否可以在 C# 程序中使用 C++ .lib 文件？

> ID：159103
> 
> 赞同：6
> 
> 时间：2008-10-01T18:44:43.213
> 
> 标签：c#, c++

是否可以在 C# 程序中使用 C++ .lib 文件？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-01T18:50:10.160

有很多方法。阅读 MSDN 中的“互操作”。

一种方法是将 lib 公开为 DLL，然后使用 pinvoke 从 C# 项目中调用这些函数。但是，这将您限制在 C 风格的界面中。

如果您的接口更复杂（例如面向对象），您可以创建一个 C++/CLI 层，将 lib 的类结构暴露给您的 C# 程序。这意味着您必须创建一个托管 C++（或现在称为 C++/CLI）的项目；然后在托管代码中设计一个接口，该接口将通过调用本机 C++（即您的库）来实现。

另一种方法是使用 COM 接口包装您的库。但是COM很痛苦，所以我不会...

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-01T18:48:55.153

不是直接的。您可以创建一个使用 lib 的 C++/CLI 程序集，然后从 C# 访问它，或者您可以将 lib 包装为 DLL。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T18:57:01.517

您需要的是一个围绕您正在使用的本机 C/C++ 库的托管包装器 (C++/CLI)。

如果您正在寻找任何 C++/CLI 书籍，我会推荐 Nishant Sivakumar 的[C++/CLI in Action](https://rads.stackoverflow.com/amzn/click/com/1932394818)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T18:53:47.717

已经回答包装它，但这里有一个[例子](http://geeklit.blogspot.com/2006/08/calling-c-lib-from-c.html)。祝你好运！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-01T22:36:43.810

我会看一下[swig](http://www.swig.org/)，我们使用它来对我们的项目产生良好的效果，以将我们的 C++ API 暴露给其他语言平台。

这是一个维护良好的项目，它有效地围绕您的 C++ 库构建了一个瘦包装器，它可以允许诸如 C# 之类的语言直接与您的本机代码进行通信 - 省去了您必须实现（和调试）胶水代码的麻烦。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T18:46:09.777

不可以。您只能使用来自 C# 程序的完整 .dll。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T19:25:18.967

这取决于，您对这种情况有任何限制吗？

如果你有一个lib文件，应该可以先编译成DLL文件，其次在DLL接口中暴露你要调用的函数，第三，使用C#原生方法调用它们（看看pinvoke.net关于如何做到这一点）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-23T18:50:49.423

你不能使用 lib，但就像其他人所说的，如果你将它包装到一个 dll 中，你可以使用它。

swig 可以获取 .lib 的标头，如果它们不太复杂，它可以为您生成 dll，然后您可以使用 c# 中的 pinvoke 调用该 dll，这也将由 swig 生成。

如果你的库很复杂并且到处都有引用计数的智能指针，你应该找到一个替代方案。

# php - 哪种类型的输入最不容易受到攻击？

> ID：159114
> 
> 赞同：1
> 
> 时间：2008-10-01T18:47:30.773
> 
> 标签：php, html, forum, bbcode, security

哪种类型的输入最不容易受到跨站点脚本 (XSS) 和 SQL 注入攻击。

PHP、HTML、BBCode 等。我需要知道我正在帮助朋友建立的论坛。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T19:20:52.253

*（我刚刚在评论中发布了这个，但似乎有些人认为选择列表、单选按钮等不需要清理。）*

不要指望单选按钮是安全的。您仍然应该清理服务器上的数据。人们可以在他们的本地机器上创建一个 html 页面，并创建一个与您的单选按钮同名的文本框，然后将这些数据发回。

更高级的用户可以使用[WebScarab](http://www.owasp.org/index.php/Category:OWASP_WebScarab_Project)之类的代理，并在将参数发送回服务器时对其进行调整。

一个好的经验法则是*始终*使用参数化 SQL 语句，并*始终*在将用户生成的数据放入 HTML 之前对其进行转义。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T18:48:35.030

我们需要更多地了解您的情况。脆弱怎么办？你应该经常做的一些事情：

*   在将字符串存储到数据库之前转义字符串以防止 SQL 注入
*   当从未知来源将字符串打印回用户时，HTML 编码字符串，以防止恶意 html/javascript

我永远不会执行用户提供的 php。BBCode/UBBCode 很好，因为它们被转换为语义正确的 html，尽管您可能想查看与格式错误的图像标签相关的 XSS 漏洞。如果您允许 HTML 输入，您可以将某些元素列入白名单，但这将是一种容易出错的复杂方法。因此，鉴于上述所有情况，我会说使用一个好的现成的**BBCode**库将是你最好的选择。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T19:16:22.983

他们都不是。服务器上预期的所有数据都可以由具有知识和动机的人操作。您希望人们使用的浏览器和表单只是将数据提交到服务器/脚本的几种有效方式之一。

请熟悉 XSS 主题及相关问题

*   [http://shiflett.org/articles/input-filtering](http://shiflett.org/articles/input-filtering)
*   [http://shiflett.org/blog/2007/mar/allowing-html-and-preventing-xss](http://shiflett.org/blog/2007/mar/allowing-html-and-preventing-xss)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T19:08:12.877

任何类型的布尔值。

您甚至可以很容易地过滤无效输入。

;-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T18:51:30.140

有很多 BB 代码解析器可以清理 HTML 等的输入。如果没有可用的软件包，那么您可以查看其中一个开源论坛软件包以获取指导。

BB 代码很有意义，因为它是论坛的“标准”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T19:02:03.547

最不容易受到攻击的输入是“非输入”。

你在问正确的问题吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-05-28T21:57:28.727

为了 Odin 的缘故，请不要清理输入。不要害怕用户在您的表单中输入他们想要的任何内容。

用户输入本身并不是不安全的。接受的答案导致了像我的银行这样的网络界面，O'Reilly 先生无法在其中开设账户，因为他的名字中有一个非法字符。不安全的始终是您使用用户输入的方式。

避免 SQL 注入的正确方法是使用准备好的语句。如果您的数据库抽象层不允许您使用这些，请严格使用正确的转义函数（myslq_escape 等）。防止 XSS 攻击的正确方法绝不是像 striptags() 这样的东西。转义一切 - 在 PHP 中，您正在寻找类似 htmlentities() 的东西，但这取决于您是将字符串输出为 HTML 文本、HTML 属性还是 Javascript 等的一部分。使用正确的工具对于正确的上下文。永远不要将用户的输入直接打印到页面上。

最后，看看 Web 应用程序的 10 大漏洞，并采取正确的措施加以防范。[http://www.applicure.com/blog/owasp-top-10-2010](http://www.applicure.com/blog/owasp-top-10-2010)

# regex - 如何在正则表达式中匹配多行中的任何字符？

> ID：159118
> 
> 赞同：476
> 
> 时间：2008-10-01T18:48:22.160
> 
> 标签：regex, multiline

例如，这个正则表达式

```
(.*)<FooBar> 
```

将匹配：

```
abcde<FooBar> 
```

但是如何让它跨多行匹配？

```
abcde
fghij<FooBar> 
```

* * *

## 回答 #1

> 赞同：532
> 
> 时间：2008-10-01T18:52:27.110

试试这个：

```
((.|\n)*)<FooBar> 
```

它基本上说“任何字符或换行符”重复零次或多次。

* * *

## 回答 #2

> 赞同：287
> 
> 时间：2008-10-01T18:52:18.033

这取决于语言，但应该有一个可以添加到正则表达式模式的修饰符。在 PHP 中是：

```
/(.*)<FooBar>/s 
```

最后的**s**使点匹配*所有*字符，包括换行符。

* * *

## 回答 #3

> 赞同：147
> 
> 时间：2017-08-31T12:47:20.463

问题是，`.`模式可以匹配*任何*字符吗？答案因发动机而异。主要区别在于该模式是由 POSIX 还是非 POSIX 正则表达式库使用。

关于[lua-patterns](/questions/tagged/lua-patterns "显示标记为“lua 模式”的问题")的特别说明：它们不被视为正则表达式，但`.`匹配那里的任何字符，与基于 POSIX 的引擎相同。

[关于matlab](/questions/tagged/matlab "显示标记为“matlab”的问题")和[octave](/questions/tagged/octave "显示标记为“八度”的问题")的另一个说明：`.`默认情况下匹配任何字符（[演示](https://ideone.com/OkH7Mh)）：（`str = "abcde\n fghij<Foobar>"; expression = '(.*)<Foobar>*'; [tokens,matches] = regexp(str,expression,'tokens','match');`包含`tokens`一个`abcde\n fghij`项目）。

此外，在所有[boost](/questions/tagged/boost "显示标记为“提升”的问题")的正则表达式语法中，点默认匹配换行符。`regex_constants::no_mod_m`Boost 的 ECMAScript 语法允许您使用( [source](http://www.regular-expressions.info/dot.html) )将其关闭。

至于[oracle](/questions/tagged/oracle "显示标记为“oracle”的问题")（它基于 POSIX），请使用[选项`n`（](https://docs.oracle.com/cd/B19306_01/server.102/b14200/functions130.htm) demo [）](http://rextester.com/WEQF2051)：`select regexp_substr('abcde' || chr(10) ||' fghij<Foobar>', '(.*)<Foobar>', 1, 1, 'n', 1) as results from dual`

**基于 POSIX 的引擎**：

A`.`已经匹配换行符，因此不需要使用任何修饰符，请参阅[bash](/questions/tagged/bash "显示标记为“bash”的问题") ( [demo](https://ideone.com/d1XTpR) )。

[tcl](/questions/tagged/tcl "显示标记为“tcl”的问题") ( [demo](https://ideone.com/ORmscd) ), postgresql [(](/questions/tagged/postgresql "显示标记为“postgresql”的问题") demo [)](http://rextester.com/FWXM76553) , [r](/questions/tagged/r "显示标记为“r”的问题") (TRE, base R default engine with no `perl=TRUE`, 对于 base R with `perl=TRUE`or *stringr* / *stringi*模式，使用`(?s)`inline 修饰符) ( [demo](https://ideone.com/A1kIU4) ) 也`.`以同样的方式处理。

*但是*，大多数基于 POSIX 的工具会逐行处理输入。因此，`.`仅因为它们不在范围内而与换行符不匹配。以下是一些如何覆盖它的示例：

*   [sed](/questions/tagged/sed "显示标记为“sed”的问题") - 有多种解决方法。最精确但不是很安全的方法是`sed 'H;1h;$!d;x; s/\(.*\)><Foobar>/\1/'`（`H;1h;$!d;x;`将文件吞入内存）。如果必须包含整行，`sed '/start_pattern/,/end_pattern/d' file`（从开头删除将包含匹配行结束）或`sed '/start_pattern/,/end_pattern/{{//!d;};}' file`（排除匹配行）可以考虑。
*   [perl](/questions/tagged/perl "显示标记为“perl”的问题") - `perl -0pe 's/(.*)<FooBar>/$1/gs' <<< "$str"`（`-0`将整个文件啜饮到内存中，`-p`在应用给出的脚本后打印文件`-e`）。请注意， using`-000pe`将 slurp 文件并激活“段落模式”，其中 Perl 使用连续的换行符 ( `\n\n`) 作为记录分隔符。
*   [gnu-grep](/questions/tagged/gnu-grep "显示标记为“gnu-grep”的问题") - `grep -Poz '(?si)abc\K.*?(?=<Foobar>)' file`. 这里，`z`启用文件 slurping，`(?s)`启用模式的 DOTALL 模式`.`，`(?i)`启用不区分大小写模式，`\K`省略到目前为止匹配的文本，`*?`是一个惰性量词，`(?=<Foobar>)`匹配之前的位置`<Foobar>`。
*   [pcregrep](/questions/tagged/pcregrep "显示标记为“pcregrep”的问题") - `pcregrep -Mi "(?si)abc\K.*?(?=<Foobar>)" file`（`M`在此处启用文件 slurping）。Note`pcregrep`对于 macOS`grep`用户来说是一个很好的解决方案。

[见演示](https://ideone.com/J7n00M)。

**非基于 POSIX 的引擎**：

*   [php](/questions/tagged/php "显示标记为“php”的问题") -使用`s`修饰符[PCRE_DOTALL 修饰符](http://php.net/manual/en/reference.pcre.pattern.modifiers.php)：（[演示](https://ideone.com/QyLjnm)`preg_match('~(.*)<Foobar>~s', $s, $m)`）

*   [c#](/questions/tagged/c%23 "显示标记为“c#”的问题") - 使用`RegexOptions.Singleline`标志（[演示](https://ideone.com/agPd94)）：
    - `var result = Regex.Match(s, @"(.*)<Foobar>", RegexOptions.Singleline).Groups[1].Value;`
    -`var result = Regex.Match(s, @"(?s)(.*)<Foobar>").Groups[1].Value;`

*   [powershell](/questions/tagged/powershell "显示标记为“powershell”的问题") - 使用`(?s)`内联选项：`$s = "abcde`nfghij<FooBar>"; $s -match "(?s)(.*)<Foobar>"; $matches[1]`

*   [perl](/questions/tagged/perl "显示标记为“perl”的问题") - 使用`s`修饰符（或`(?s)`开头的内联版本）（[demo](https://ideone.com/nsYpjE)）：`/(.*)<FooBar>/s`

*   [python](/questions/tagged/python "显示标记为“python”的问题") - 使用`re.DOTALL`(or `re.S`) 标志或`(?s)`内联修饰符 ( [demo](https://ideone.com/A21CXy) ): `m = re.search(r"(.*)<FooBar>", s, flags=re.S)`(然后`if m:`, `print(m.group(1))`)

*   [java](/questions/tagged/java "显示标记为“java”的问题") - 使用`Pattern.DOTALL`修饰符（或内联`(?s)`标志）（[演示](https://ideone.com/Oq1j8Z)）：`Pattern.compile("(.*)<FooBar>", Pattern.DOTALL)`

*   [groovy](/questions/tagged/groovy "显示标记为“groovy”的问题") - 使用`(?s)`模式内修饰符（[演示](https://ideone.com/2wmACW)）：`regex = /(?s)(.*)<FooBar>/`

*   [scala](/questions/tagged/scala "显示标记为“scala”的问题") - 使用`(?s)`修饰符（[演示](https://ideone.com/faL4xJ)）：`"(?s)(.*)<Foobar>".r.findAllIn("abcde\n fghij<Foobar>").matchData foreach { m => println(m.group(1)) }`

*   [javascript](/questions/tagged/javascript "显示标记为“javascript”的问题") - 使用`[^]`或解决方法`[\d\D]`// `[\w\W]`（[演示](https://jsfiddle.net/36c6rt7o/3/)）`[\s\S]`：`s.match(/([\s\S]*)<FooBar>/)[1]`

*   [c++](/questions/tagged/c%2b%2b "显示标记为“c++”的问题") ( `std::regex`) 使用`[\s\S]`或 JavaScript 变通办法 ( [demo](https://ideone.com/2xC4ih) )：`regex rex(R"(([\s\S]*)<FooBar>)");`

*   [vba](/questions/tagged/vba "显示标记为“vba”的问题") [vbscript](/questions/tagged/vbscript "显示标记为“vbscript”的问题") - 使用与 JavaScript 相同的方法，`([\s\S]*)<Foobar>`. （**注意**：对象的`MultiLine`属性[`RegExp`](https://docs.microsoft.com/en-us/previous-versions//yab2dx62%28v%3Dvs.85%29)有时被错误地认为是允许`.`跨换行符匹配的选项，而实际上，它只会更改`^`and行为以匹配*行*`$`的开始/结束而不是*字符串*，这与 JavaScript 中的相同正则表达式）行为。）

***   [ruby](/questions/tagged/ruby "显示标记为“红宝石”的问题") - 使用[`/m` *MULTILINE*修饰符](https://ruby-doc.org/core-2.4.0/Regexp.html#class-Regexp-label-Options)（[演示](https://ideone.com/hSj5M2)）：`s[/(.*)<Foobar>/m, 1]`

    *   [r](/questions/tagged/r "显示标记为“r”的问题") [tre](/questions/tagged/tre "显示标记为“tre”的问题") [base-r](/questions/tagged/base-r "显示标记为“base-r”的问题") - Base R PCRE 正则表达式 -使用`(?s)`：（[演示](https://ideone.com/mCKN8U)）`regmatches(x, regexec("(?s)(.*)<FooBar>",x, perl=TRUE))[[1]][2]`

    *   [r](/questions/tagged/r "显示标记为“r”的问题") [icu](/questions/tagged/icu "显示标记为“icu”的问题") [stringr](/questions/tagged/stringr "显示标记为“stringr”的问题") [stringi](/questions/tagged/stringi "显示标记为“stringi”的问题") -由 ICU 正则表达式引擎驱动的输入`stringr`/正则表达式函数。`stringi`也可以使用`(?s)`：（[演示](https://rextester.com/MBJG33973)`stringr::str_match(x, "(?s)(.*)<FooBar>")[,2]`）

    *   [go](/questions/tagged/go "显示标记为“开始”的问题") - 在开始时使用 inline 修饰符`(?s)`（[demo](https://play.golang.org/p/Xqproig3jZ)）：`re: = regexp.MustCompile(`(?s)(.*)<FooBar>`)`

    *   [swift](/questions/tagged/swift "显示标记为“迅速”的问题") - 使用[`dotMatchesLineSeparators`](https://developer.apple.com/documentation/foundation/nsregularexpression.options/1412529-dotmatcheslineseparators)或（更容易）将`(?s)`内联修饰符传递给模式：`let rx = "(?s)(.*)<Foobar>"`

    *   [objective-c](/questions/tagged/objective-c "显示标记为“objective-c”的问题") - 与 Swift 相同。`(?s)`工作最简单，但这里是如何[使用该选项](https://ideone.com/C6RP37)：`NSRegularExpression* regex = [NSRegularExpression regularExpressionWithPattern:pattern options:NSRegularExpressionDotMatchesLineSeparators error:&regexError];`

    *   [re2](/questions/tagged/re2 "显示标记为“re2”的问题")，[google-apps-script](/questions/tagged/google-apps-script "显示标记为“google-apps-script”的问题") - 使用`(?s)`修饰符（[演示](https://docs.google.com/spreadsheets/d/1kn6Bb4TTjXT27Yfqwi3Z9K6YQVQxqHIBYoAAa1B4NsA/edit#gid=0)）：（`"(?s)(.*)<Foobar>"`在 Google 电子表格中，`=REGEXEXTRACT(A2,"(?s)(.*)<Foobar>")`）** 

 ****注意事项`(?s)`**：

在大多数非 POSIX 引擎中，`(?s)`内联修饰符（或嵌入标志选项）可用于强制`.`匹配换行符。

如果放置在模式的开头，则`(?s)`更改模式中所有`.`的行为。如果s`(?s)`放在开头之后的某个位置，则只有`.`位于其右侧的 s 会受到影响，*除非*这是传递给 Python 的`re`. 在 Python`re`中，无论`(?s)`位置如何，整个模式`.`都会受到影响。使用`(?s)`停止效果`(?-s)`。修改后的组可用于仅影响正则表达式模式的指定范围（例如，`Delim1(?s:.*?)\nDelim2.*`将在换行符之间进行第一个`.*?`匹配，而第二个`.*`将仅匹配该行的其余部分）。

**POSIX 注释**：

在非 POSIX 正则表达式引擎中，要匹配任何字符，可以使用 // 构造`[\s\S]`。`[\d\D]``[\w\W]`

在 POSIX 中，`[\s\S]`不匹配任何字符（如在 JavaScript 或任何非 POSIX 引擎中），因为括号表达式内不支持正则表达式转义序列。`[\s\S]`被解析为匹配单个字符的括号表达式，`\`或`s`或`S`。

* * *

## 回答 #4

> 赞同：72
> 
> 时间：2011-11-25T13:16:55.893

如果您使用的是 Eclipse 搜索，您可以启用“DOTALL”选项来制作 '.' 匹配任何字符，包括行分隔符：只需在搜索字符串的开头添加“(?s)”。例子：

```
(?s).*<FooBar> 
```

* * *

## 回答 #5

> 赞同：42
> 
> 时间：2011-07-30T13:03:56.440

在许多正则表达式方言中，`/[\S\s]*<Foobar>/`会做你想做的事。[来源](http://www.regular-expressions.info/dot.html)

* * *

## 回答 #6

> 赞同：39
> 
> 时间：2012-07-19T17:59:45.447

`([\s\S]*)<FooBar>`

点匹配除换行符 (\r\n) 之外的所有内容。所以使用 \s\S，它将匹配所有字符。

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2012-08-03T07:52:16.613

在[Ruby](https://stackoverflow.com/questions/tagged/ruby)中，您可以使用 ' `m`' 选项（多行）：

```
/YOUR_REGEXP/m 
```

有关更多信息，请参阅*ruby​​-doc.org*上[的 Regexp 文档。](http://www.ruby-doc.org/core-1.9.3/Regexp.html)

 ** * *

## 回答 #8

> 赞同：15
> 
> 时间：2018-08-06T07:48:29.453

我们也可以使用

```
(.*?\n)*? 
```

匹配所有内容，包括换行符而不贪心。

这将使新行可选

```
(.*?|\n)*? 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2008-10-01T18:52:28.233

`"."`通常不匹配换行符。大多数正则表达式引擎允许您添加`S`- 标志（也称为`DOTALL`and `SINGLELINE`）以`"."`匹配换行符。如果失败，您可以执行类似`[\S\s]`.

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2013-01-03T11:32:13.277

对于 Eclipse，以下表达式有效：

> 富
> 
> 贾达哈达酒吧"

正则表达式：

```
Foo[\S\s]{1,10}.*Bar* 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-10-01T18:54:07.980

采用：

```
/(.*)<FooBar>/s 
```

导致点 ( . `s`) 匹配回车。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-10-02T03:31:26.990

请注意，这`(.|\n)*`可能比（例如）`[\s\S]*`（如果您的语言的正则表达式支持此类转义）和查找如何指定使 . 也匹配换行符。或者您可以使用 POSIXy 替代方案，例如`[[:space:][:^space:]]*`.

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2010-04-13T00:42:03.950

使用 RegexOptions.Singleline。它改变了`.`包含换行符的含义。

```
Regex.Replace(content, searchText, replaceText, RegexOptions.Singleline); 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2013-06-03T06:22:19.503

在基于 Java 的正则表达式中，您可以使用`[\s\S]`.

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-10-01T18:52:56.220

通常，`.`不匹配换行符，因此请尝试`((.|\n)*)<foobar>`.

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2012-04-04T11:00:26.493

## 解决方案：

使用模式修饰符`sU`将在 PHP 中获得所需的匹配。

## 例子：

```
preg_match('/(.*)/sU', $content, $match); 
```

## 资料来源：

*   *[模式修饰符](http://php.net/manual/en/reference.pcre.pattern.modifiers.php)*

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-10-01T18:49:42.033

在语言中使用的上下文中，正则表达式作用于字符串，而不是行。所以你应该能够正常使用正则表达式，假设输入字符串有多行。

在这种情况下，给定的正则表达式将匹配整个字符串，因为存在“<FooBar>”。根据正则表达式实现的具体情况，$1 值（从“(.*)”获得）将是“fghij”或“abcde\nfghij”。正如其他人所说，某些实现允许您控制是否“。” 将匹配换行符，给你选择。

基于行的正则表达式通常用于 egrep 之类的命令行。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-03-26T14:57:08.103

我遇到了同样的问题，并以可能不是最好的方式解决了它，但它确实有效。在进行真正的比赛之前，我替换了所有换行符：

```
mystring = Regex.Replace(mystring, "\r\n", "") 
```

我正在处理 HTML，所以在这种情况下，换行符对我来说并不重要。

我尝试了上面的所有建议，但没有运气。我正在使用 .NET 3.5 仅供参考。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2019-02-27T12:50:43.143

在 JavaScript 中，您可以使用 [^]* 搜索零到无限字符，包括换行符。

```
$("#find_and_replace").click(function() {
  var text = $("#textarea").val();
  search_term = new RegExp("[^]*<Foobar>", "gi");;
  replace_term = "Replacement term";
  var new_text = text.replace(search_term, replace_term);
  $("#textarea").val(new_text);
});
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<button id="find_and_replace">Find and replace</button>
<br>
<textarea ID="textarea">abcde
fghij&lt;Foobar&gt;</textarea>
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2020-08-28T16:21:39.570

尝试：`.*\n*.*<FooBar>`假设您也允许空白换行符。因为您允许任何字符，包括之前的任何内容`<FooBar>`。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2022-01-29T02:28:34.463

在记事本++中，您可以使用它

```
<table (.|\r\n)*</table> 
```

它将匹配整个表从

行和列

您可以使用以下方法使其变得贪婪，这样它将匹配第一个、第二个等表，而不是一次全部匹配

```
<table (.|\r\n)*?</table> 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2011-01-18T09:31:21.063

我想在 Java中匹配一个特定的*if块：*

```
 ...
   ...
   if(isTrue){
       doAction();

   }
...
...
} 
```

如果我使用正则表达式

```
if \(isTrue(.|\n)*} 
```

它包括方法块的右大括号，所以我使用了

```
if \(!isTrue([^}.]|\n)*} 
```

从通配符匹配中排除右大括号。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2012-04-21T20:05:32.873

通常，我们必须使用分布在子字符串前面的行中的几个关键字来修改子字符串。考虑一个 XML 元素：

```
<TASK>
  <UID>21</UID>
  <Name>Architectural design</Name>
  <PercentComplete>81</PercentComplete>
</TASK> 
```

假设我们想将 81 修改为其他值，比如 40。首先确定`.UID.21..UID.`，然后跳过包括`\n`until在内的所有字符`.PercentCompleted.`。正则表达式模式和替换规范是：

```
String hw = new String("<TASK>\n  <UID>21</UID>\n  <Name>Architectural design</Name>\n  <PercentComplete>81</PercentComplete>\n</TASK>");
String pattern = new String ("(<UID>21</UID>)((.|\n)*?)(<PercentComplete>)(\\d+)(</PercentComplete>)");
String replaceSpec = new String ("$1$2$440$6");
// Note that the group (<PercentComplete>) is $4 and the group ((.|\n)*?) is $2.

String iw = hw.replaceFirst(pattern, replaceSpec);
System.out.println(iw);

<TASK>
  <UID>21</UID>
  <Name>Architectural design</Name>
  <PercentComplete>40</PercentComplete>
</TASK> 
```

子群`(.|\n)`可能是缺失的群`$3`。如果我们让它不被捕获，`(?:.|\n)`那么`$3`就是 `(<PercentComplete>)`。所以模式和`replaceSpec`也可以是：

```
pattern = new String("(<UID>21</UID>)((?:.|\n)*?)(<PercentComplete>)(\\d+)(</PercentComplete>)");
replaceSpec = new String("$1$2$340$5") 
```

并且更换工作正常。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2019-07-05T14:12:02.540

通常在 PowerShell 中搜索三个连续的行，它看起来像：

```
$file = Get-Content file.txt -raw

$pattern = 'lineone\r\nlinetwo\r\nlinethree\r\n'     # "Windows" text
$pattern = 'lineone\nlinetwo\nlinethree\n'           # "Unix" text
$pattern = 'lineone\r?\nlinetwo\r?\nlinethree\r?\n'  # Both

$file -match $pattern

# output
True 
```

奇怪的是，这将是提示符下的 Unix 文本，但文件中的 Windows 文本：

```
$pattern = 'lineone
linetwo
linethree
' 
```

这是一种打印行尾的方法：

```
'lineone
linetwo
linethree
' -replace "`r",'\r' -replace "`n",'\n'

# Output
lineone\nlinetwo\nlinethree\n 
```

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2019-10-06T19:41:28.093

### 选项1

一种方法是使用`s`标志（就像接受的答案一样）：

```
/(.*)<FooBar>/s 
```

### [演示 1](https://regex101.com/r/U9Ryj9/1/)

### 选项 2

第二种方法是使用`m`(multiline) 标志和以下任何模式：

```
/([\s\S]*)<FooBar>/m 
```

或者

```
/([\d\D]*)<FooBar>/m 
```

或者

```
/([\w\W]*)<FooBar>/m 
```

### [演示 2](https://regex101.com/r/nUjqW8/1/)

### 正则表达式电路

[jex.im](https://jex.im/regulex/#!flags=&re=%5E(a%7Cb)*%3F%24)可视化正则表达式：

[![在此处输入图像描述](https://i.stack.imgur.com/ZmEYX.png)](https://i.stack.imgur.com/ZmEYX.png)

# visual-studio - DLL 版本和 Visual Studio 附加到进程

> ID：159135
> 
> 赞同：0
> 
> 时间：2008-10-01T18:51:24.243
> 
> 标签：visual-studio, dll, reporting-services

我正在尝试使用 VS 的附加到进程工具来调试我正在为 Sql Server Reporting Services 开发的加载项。

当我将项目 debug/bin 目录中的 dll 和 pdb 复制到 ReportServer/bin 目录时，我可以通过附加到进程来正确调试它。但是，如果我使用我的 msbuild 脚本并将这些 dll 和 pdb 复制到 ReportServer/bin 目录，我会得到错误的版本。

1)**如何检查 dll 的当前版本/判断 dll 是否与另一个版本不兼容？**

2)**我如何知道 ReportServer 进程加载了哪些 dll/版本？**

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T04:13:30.023

我对 Sql Server Reporting Services 一无所知，但是

1) 您可以使用 ildasm.exe 检查 DLL 的版本

2) 当您使用 VS 'attach to process' 时，在 'Modules' 窗口中它会显示所有已加载程序集的版本号

# python - 获取 MAC 地址

> ID：159137
> 
> 赞同：125
> 
> 时间：2008-10-01T18:51:36.880
> 
> 标签：python, windows, linux, networking

我需要一种在运行时确定计算机 MAC 地址的跨平台方法。对于 Windows，可以使用“wmi”模块，在 Linux 下我能找到的唯一方法是运行 ifconfig 并在其输出中运行正则表达式。我不喜欢使用只能在一个操作系统上运行的包，并且解析另一个程序的输出似乎不是很优雅，更不用说容易出错了。

有谁知道获取 MAC 地址的跨平台方法（windows 和 linux）方法？如果没有，有没有人知道比我上面列出的更优雅的方法？

* * *

## 回答 #1

> 赞同：178
> 
> 时间：2008-10-01T19:06:30.667

Python 2.5 包含一个 uuid 实现，它（至少在一个版本中）需要 mac 地址。您可以轻松地将 mac 查找功能导入到您自己的代码中：

```
from uuid import getnode as get_mac
mac = get_mac() 
```

返回值为 48 位整数的 mac 地址。

* * *

## 回答 #2

> 赞同：92
> 
> 时间：2011-01-25T01:57:17.207

Linux 下此问题的纯 python 解决方案，用于获取特定本地接口的 MAC，最初由 vishnubob 作为评论发布，并由 Ben Mackey 在[此 activestate 配方中改进](http://code.activestate.com/recipes/439094-get-the-ip-address-associated-with-a-network-inter/)

```
#!/usr/bin/python

import fcntl, socket, struct

def getHwAddr(ifname):
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    info = fcntl.ioctl(s.fileno(), 0x8927,  struct.pack('256s', ifname[:15]))
    return ':'.join(['%02x' % ord(char) for char in info[18:24]])

print getHwAddr('eth0') 
```

这是 Python 3 兼容的代码：

```
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import fcntl
import socket
import struct

def getHwAddr(ifname):
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    info = fcntl.ioctl(s.fileno(), 0x8927,  struct.pack('256s', bytes(ifname, 'utf-8')[:15]))
    return ':'.join('%02x' % b for b in info[18:24])

def main():
    print(getHwAddr('enp0s8'))

if __name__ == "__main__":
    main() 
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2008-10-01T18:55:14.093

netifaces 是一个很好的模块，用于获取 mac 地址（和其他地址）。它是跨平台的，比使用套接字或 uuid 更有意义。

```
>>> import netifaces
>>> netifaces.interfaces()
['lo', 'eth0', 'tun2']

>>> netifaces.ifaddresses('eth0')[netifaces.AF_LINK]
[{'addr': '08:00:27:50:f2:51', 'broadcast': 'ff:ff:ff:ff:ff:ff'}] 
```

* * *

*   [pypi位置](https://pypi.python.org/pypi/netifaces)

*   [很好的网络介绍](http://alastairs-place.net/projects/netifaces/)

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2015-08-18T19:16:50.347

有时我们有不止一个网络接口。

找出特定接口的mac地址的简单方法是：

```
def getmac(interface):

  try:
    mac = open('/sys/class/net/'+interface+'/address').readline()
  except:
    mac = "00:00:00:00:00:00"

  return mac[0:17] 
```

调用方法很简单

```
myMAC = getmac("wlan0") 
```

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2008-10-02T03:49:54.743

您应该注意的另一件事是，它`uuid.getnode()`可以通过返回一个随机的 48 位数字来伪造 MAC 地址，这可能不是您所期望的。此外，没有明确的迹象表明 MAC 地址已被伪造，但您可以通过调用`getnode()`两次并查看结果是否变化来检测它。如果两个调用都返回相同的值，则您拥有 MAC 地址，否则您将获得伪造的地址。

```
>>> print uuid.getnode.__doc__
Get the hardware address as a 48-bit positive integer.

    The first time this runs, it may launch a separate program, which could
    be quite slow.  If all attempts to obtain the hardware address fail, we
    choose a random 48-bit number with its eighth bit set to 1 as recommended
    in RFC 4122. 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2013-08-03T10:40:10.100

使用我的回答：[https ://stackoverflow.com/a/18031868/2362361](https://stackoverflow.com/a/18031868/2362361)

重要的是要知道您想要 MAC 用于哪个接口，因为可以存在许多接口（蓝牙、多个 nic 等）。

当您知道需要 MAC 的 iface 的 IP 时，这可以完成工作，使用`netifaces`（在 PyPI 中可用）：

```
import netifaces as nif
def mac_for_ip(ip):
    'Returns a list of MACs for interfaces that have given IP, returns None if not found'
    for i in nif.interfaces():
        addrs = nif.ifaddresses(i)
        try:
            if_mac = addrs[nif.AF_LINK][0]['addr']
            if_ip = addrs[nif.AF_INET][0]['addr']
        except IndexError, KeyError: #ignore ifaces that dont have MAC or IP
            if_mac = if_ip = None
        if if_ip == ip:
            return if_mac
    return None 
```

测试：

```
>>> mac_for_ip('169.254.90.191')
'2c:41:38:0a:94:8b' 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2016-12-10T14:53:26.537

您可以使用跨平台的 psutil 执行此操作：

```
import psutil
nics = psutil.net_if_addrs()
print [j.address for j in nics[i] for i in nics if i!="lo" and j.family==17] 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-01T22:09:58.370

请注意，您可以使用条件导入在 python 中构建自己的跨平台库。例如

```
import platform
if platform.system() == 'Linux':
  import LinuxMac
  mac_address = LinuxMac.get_mac_address()
elif platform.system() == 'Windows':
  # etc 
```

这将允许您使用 os.system 调用或特定于平台的库。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2018-08-02T06:28:03.050

如果您不介意依赖依赖，跨平台的[getmac包将适用于此。](https://github.com/GhostofGoes/getmac "获取马克")它适用于 Python 2.7+ 和 3.4+。它将尝试许多不同的方法，直到获得地址或返回 None。

```
from getmac import get_mac_address
eth_mac = get_mac_address(interface="eth0")
win_mac = get_mac_address(interface="Ethernet 3")
ip_mac = get_mac_address(ip="192.168.0.1")
ip6_mac = get_mac_address(ip6="::1")
host_mac = get_mac_address(hostname="localhost")
updated_mac = get_mac_address(ip="10.0.0.1", network_request=True) 
```

免责声明：我是包的作者。

更新（2019 年 1 月 14 日）：该包现在仅支持 Python 2.7+ 和 3.4+。如果您需要使用较旧的 Python（2.5、2.6、3.2、3.3），您仍然可以使用较旧版本的包。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-10-04T13:49:23.857

要获取`eth0`接口 MAC 地址，

```
import psutil

nics = psutil.net_if_addrs()['eth0']

for interface in nics:
   if interface.family == 17:
      print(interface.address) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-01T19:02:33.810

我不知道统一的方式，但这里有一些你可能会觉得有用的东西：

[http://www.codeguru.com/Cpp/IN/network/networkinformation/article.php/c5451](http://www.codeguru.com/Cpp/I-N/network/networkinformation/article.php/c5451)

在这种情况下，我要做的是将它们包装成一个函数，并根据操作系统运行正确的命令，根据需要进行解析并仅返回您想要格式化的 MAC 地址。它当然都是一样的，除了你只需要做一次，而且从主代码看起来更干净。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2013-07-26T14:46:26.107

对于 Linux，让我介绍一个 shell 脚本，它将显示 mac 地址并允许更改它（MAC 嗅探）。

```
 ifconfig eth0 | grep HWaddr |cut -dH -f2|cut -d\  -f2
 00:26:6c:df:c3:95 
```

削减争论可能会有所不同（我不是专家）尝试：

```
ifconfig etho | grep HWaddr
eth0      Link encap:Ethernet  HWaddr 00:26:6c:df:c3:95 
```

要更改 MAC，我们可以这样做：

```
ifconfig eth0 down
ifconfig eth0 hw ether 00:80:48:BA:d1:30
ifconfig eth0 up 
```

将 mac 地址更改为 00:80:48:BA:d1:30 （暂时，将在重新启动时恢复为实际地址）。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2019-01-28T10:19:18.863

或者，

```
import uuid
mac_id=(':'.join(['{:02x}'.format((uuid.getnode() >> ele) & 0xff) 
```

* * *

## 回答 #14

> 赞同：-9
> 
> 时间：2008-10-01T19:12:56.313

对于 Linux，您可以使用 SIOCGIFHWADDR ioctl 检索 MAC 地址。

```
struct ifreq    ifr;
uint8_t         macaddr[6];

if ((s = socket(AF_INET, SOCK_DGRAM, IPPROTO_IP)) < 0)
    return -1;

strcpy(ifr.ifr_name, "eth0");

if (ioctl(s, SIOCGIFHWADDR, (void *)&ifr) == 0) {
    if (ifr.ifr_hwaddr.sa_family == ARPHRD_ETHER) {
        memcpy(macaddr, ifr.ifr_hwaddr.sa_data, 6);
        return 0;
... etc ... 
```

您已将问题标记为“python”。我不知道现有的 Python 模块可以获取此信息。您可以使用[ctypes](http://pypi.python.org/pypi/ctypes/1.0.2)直接调用 ioctl。

# version-control - 分支当前更改然后在 TFS 中“回滚”

> ID：159138
> 
> 赞同：2
> 
> 时间：2008-10-01T18:51:42.260
> 
> 标签：version-control, tfs

我有一个特定的变更集，我想将我的开发分支“回滚”到，但我想在该特定变更集之后获取所有更改并将它们放入新分支。这在 TFS 中可能吗？如果是这样，我怎么能做这样的事情？

谢谢，戴夫

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T18:59:27.327

嗯.. 最简单的方法就是照你说的做。

将现有代码分支到新位置。然后获取您想要的变更集，签出项目，然后重新签入变更集。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-06T15:42:52.837

如果您安装了 Team Foundation Power Tools，则可以使用命令 tfpt rollback 在您的客户端中创建一个变更集，该变更集将负责回滚。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T19:14:02.597

我最终在我想要的变更集上进行了分支，将其命名为 Development-stable，然后将 Development 重命名为 Development-experimental，然后将 Development-stable 重命名为 Development。

# groovy - Groovy 执行 shell 命令

> ID：159148
> 
> 赞同：199
> 
> 时间：2008-10-01T18:54:39.320
> 
> 标签：groovy

Groovy 添加了使执行 shell 相当容易的`execute`方法；`String`

```
println "ls".execute().text 
```

但如果发生错误，则没有结果输出。 **有没有一种简单的方法可以同时输出标准错误和标准？** （除了创建一堆代码；创建两个线程来读取两个输入流，然后使用父流等待它们完成然后将字符串转换回文本？）

有类似的东西会很好；

```
 def x = shellDo("ls /tmp/NoFile")
 println "out: ${x.out} err:${x.err}" 
```

* * *

## 回答 #1

> 赞同：251
> 
> 时间：2008-10-01T19:20:26.123

好的，自己解决了；

```
def sout = new StringBuilder(), serr = new StringBuilder()
def proc = 'ls /badDir'.execute()
proc.consumeProcessOutput(sout, serr)
proc.waitForOrKill(1000)
println "out> $sout\nerr> $serr" 
```

显示：

`out> err> ls: cannot access /badDir: No such file or directory`

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2008-10-01T19:16:06.960

`"ls".execute()`返回一个`Process`对象，这就是为什么`"ls".execute().text`有效。您应该能够仅读取错误流以确定是否有任何错误。

有一个额外的方法`Process`允许您传递 a`StringBuffer`来检索文本：`consumeProcessErrorStream(StringBuffer error)`.

例子：

```
def proc = "ls".execute()
def b = new StringBuffer()
proc.consumeProcessErrorStream(b)

println proc.text
println b.toString() 
```

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2012-09-04T20:06:40.313

```
// a wrapper closure around executing a string                                  
// can take either a string or a list of strings (for arguments with spaces)    
// prints all output, complains and halts on error                              
def runCommand = { strList ->
  assert ( strList instanceof String ||
           ( strList instanceof List && strList.each{ it instanceof String } ) \
)
  def proc = strList.execute()
  proc.in.eachLine { line -> println line }
  proc.out.close()
  proc.waitFor()

  print "[INFO] ( "
  if(strList instanceof List) {
    strList.each { print "${it} " }
  } else {
    print strList
  }
  println " )"

  if (proc.exitValue()) {
    println "gave the following error: "
    println "[ERROR] ${proc.getErrorStream()}"
  }
  assert !proc.exitValue()
} 
```

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2017-02-09T01:40:48.237

我觉得这更惯用：

```
def proc = "ls foo.txt doesnotexist.txt".execute()
assert proc.in.text == "foo.txt\n"
assert proc.err.text == "ls: doesnotexist.txt: No such file or directory\n" 
```

正如另一篇文章提到的，这些是阻塞调用，但由于我们想要处理输出，这可能是必要的。

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2014-08-16T06:08:39.850

要在上面提供的答案中添加一个更重要的信息 -

对于一个进程

```
def proc = command.execute(); 
```

总是尝试使用

```
def outputStream = new StringBuffer();
proc.waitForProcessOutput(outputStream, System.err)
//proc.waitForProcessOutput(System.out, System.err) 
```

而不是

```
def output = proc.in.text; 
```

在 groovy 中执行命令后捕获输出，因为后者是阻塞调用（[原因是 SO 问题](https://stackoverflow.com/questions/25300550/difference-in-collecting-output-of-executing-external-command-in-groovy)）。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2016-09-22T03:09:58.100

```
def exec = { encoding, execPath, execStr, execCommands ->

def outputCatcher = new ByteArrayOutputStream()
def errorCatcher = new ByteArrayOutputStream()

def proc = execStr.execute(null, new File(execPath))
def inputCatcher = proc.outputStream

execCommands.each { cm ->
    inputCatcher.write(cm.getBytes(encoding))
    inputCatcher.flush()
}

proc.consumeProcessOutput(outputCatcher, errorCatcher)
proc.waitFor()

return [new String(outputCatcher.toByteArray(), encoding), new String(errorCatcher.toByteArray(), encoding)]

}

def out = exec("cp866", "C:\\Test", "cmd", ["cd..\n", "dir\n", "exit\n"])

println "OUT:\n" + out[0]
println "ERR:\n" + out[1] 
```

* * *

## 回答 #7

> 赞同：-5
> 
> 时间：2017-07-13T02:55:19.307

```
command = "ls *"

def execute_state=sh(returnStdout: true, script: command) 
```

但如果命令失败，进程将终止

# svn - 从远程 SVN 存储库签出到远程位置？

> ID：159152
> 
> 赞同：3
> 
> 时间：2008-10-01T18:56:19.817
> 
> 标签：svn, ssh

SVN 有没有办法从远程存储库签出到另一个远程位置，而不是我的本地文件系统？就像是：

```
svn co http://myrepository/svn/project ssh me@otherlocation.net:/var/www/project 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T20:07:17.650

我认为你可以这样做：

```
ssh me@other.net 'svn co http://repository/svn/project /var/www/project' 
```

这利用了 ssh 允许您远程执行命令的事实。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T18:58:49.077

没有。如果要复制存储库，请查看[svnsync](http://svn.collab.net/repos/svn/trunk/notes/svnsync.txt)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T19:02:38.413

您可以将 Subversion 与[SSHFS](http://fuse.sourceforge.net/sshfs.html "SSHFS")一起使用。

# sql-server - Sql 05 快递管理工作室对比标准

> ID：159154
> 
> 赞同：0
> 
> 时间：2008-10-01T18:57:25.180
> 
> 标签：sql-server, ssms

免费的sql express 05管理工作室和正版有什么区别？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T19:26:30.307

Management Studio Express 无法管理以下内容：

*   SQL Server 分析服务
*   集成服务
*   通知服务
*   报告服务
*   SQL Server 代理
*   SQL Server 2005 移动版

（来自[此页面。](http://www.microsoft.com/DownLoads/details.aspx?familyid=C243A5AE-4BD1-4E3D-94B8-5A0F62BF7796&displaylang=en)查看**概述**部分中的**注释**。）

 **这些都是 SQL Server Express 不支持的所有功能。

另请注意，完整版 SQL Management Studio 包含在 SQL Server 2005 中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T19:04:27.877

[请参阅http://www.microsoft.com/sql/prodinfo/features/compare-features.mspx](http://www.microsoft.com/sql/prodinfo/features/compare-features.mspx)上的“SQL Server 2005 功能比较”

# windows - DTCPing 和 DTCTester 有什么区别？

> ID：159173
> 
> 赞同：7
> 
> 时间：2008-10-01T19:03:03.047
> 
> 标签：windows, transactions, msdtc

我以前用过 DTCTester 来诊断 MSDTC 问题。但是，我只是注意到 DTCPing 似乎在做同样的事情。这两者有什么区别？

据我目前所知，DTCPing 需要在客户端和服务器机器上运行，而 DTCTester 只需要从客户端运行。还有其他区别吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-06T14:30:34.800

在安装 BizTalk Server 时测试 DTC 设置非常常见，因此来自 BTS 文档，所以 - 来自[http://msdn.microsoft.com/en-us/library/aa561924.aspx](http://msdn.microsoft.com/en-us/library/aa561924.aspx)

> 如果 SQL Server 安装在其中一台计算机上，则使用 DTCTester 实用程序验证两台计算机之间的事务支持。DTCTester 实用程序使用 ODBC 来验证对 SQL Server 数据库的事务支持。有关 DTCTester 的更多信息，请参阅如何使用 DTCTester 工具。
> 
> 如果两台计算机上均未安装 SQL Server，则使用 DTCPing 验证两台计算机之间的事务支持。DTCPing 工具必须在客户端和服务器计算机上都运行，并且当两台计算机上都没有安装 SQL Server 时，它是 DTCTester 实用程序的一个很好的替代方法。有关 DTCPing 的详细信息，请参阅如何解决 MS DTC 防火墙问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-03-11T20:15:58.677

这不是对这个问题的直接回答——而是需要注意的重要一点。

1.  在开始测试之前，**DTCPing** windows 应用程序应该在两个服务器中都打开。

2.  根据[如何使用**DTCTester**工具](http://support.microsoft.com/en-us/kb/293799)

> 通过控制面板中的 ODBC 实用程序为您的 SQL Server创建一个**ODBC 数据源。**

**参考：**

1.  [MSDTC 问题](https://social.msdn.microsoft.com/Forums/en-US/138d744b-9c37-40e7-bc7a-7dcd46936bfa/msdtc-problems?forum=windowstransactionsprogramming)
2.  [MSDTC 通过防火墙到带有 RPC 的 SQL 集群](http://www.lewisroberts.com/2009/08/16/msdtc-through-a-firewall-to-an-sql-cluster-with-rpc/comment-page-1/)
3.  [使用 DTCPing 工具解决 MSDTC 问题](http://blogs.msdn.com/b/distributedservices/archive/2008/11/12/troubleshooting-msdtc-issues-with-the-dtcping-tool.aspx)

# javascript - 如何在 JavaScript 中将像素转换为打印的英寸？

> ID：159183
> 
> 赞同：4
> 
> 时间：2008-10-01T19:05:03.447
> 
> 标签：javascript, css, printing

我想调整 SPAN 元素样式的字体大小，直到 SPAN 的文本在纸上打印时为 7.5 英寸宽，但 JavaScript 仅以像素为单位报告 SPAN 的 clientWidth 属性。

```
<span id="test">123456</span> 
```

进而：

```
#test {
  font-size:1.2in; /* adjust this for yourself until printout measures 7.5in wide */
} 
```

进而：

```
console.log(document.getElementById('test').clientWidth); 
```

我已经在一台机器上通过实验确定它使用大约 90 DPI 作为转换因子，因为上面的代码记录大约 675，至少在 Firefox 3 下是这样。

这个数字在不同的浏览器、打印机、屏幕等配置下不一定相同。

那么，如何找到浏览器使用的 DPI？我可以调用什么来在我的系统上恢复“90”？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T19:57:27.843

总结一下：

这不是您可以使用 HTML 解决的问题。除了[CSS2 打印属性](http://www.w3schools.com/css/css_ref_print.asp)之外，浏览器没有定义或预期的打印方式。

首先，[像素（在 CSS 中）不一定与像素（在屏幕上）的大小相同](http://webkit.org/blog/57/css-units/)，因此某个值对您有效并不意味着它会转化为其他设置。

其次，用户可以使用页面缩放等功能更改文本大小。

第三，由于没有明确的方式来布置用于打印目的的网页，因此每个浏览器的做法都不同。只需在 Firefox 和 IE 中打印预览内容，然后查看差异。

第四，打印带来了一大堆其他变量，例如打印机的 DPI、纸张尺寸。此外，大多数打印机驱动程序都支持用户在浏览器从未看到*的打印对话框中设置*的输出缩放。

最后，很可能因为打印不是 HTML 的目标，网络浏览器的“打印引擎”（在我见过的所有浏览器中）与它的其余部分是断开的。您的 javascript 无法与打印引擎“对话”，反之亦然，因此“浏览器用于打印预览的 DPI 编号”不会以任何方式公开。

我推荐一个PDF文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T19:07:06.203

> 我已经在一台机器上通过实验确定它使用大约 90 DPI 作为转换因子，因为上面的代码记录大约 675，至少在 Firefox 3 下是这样。
> 
> 1）这在每台机器/浏览器上都一样吗？

当然不。每个屏幕分辨率/打印机/打印设置组合都会有所不同。除非您使用 em 而不是像素，否则确实有办法知道打印尺寸是多少。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T19:08:43.703

1.  不
2.  你不

这实际上也因屏幕分辨率设置而变得更加复杂。

祝你好运。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T19:42:28.613

我认为这可以满足您的要求。但我同意其他海报，HTML 并不真正适合这种事情。无论如何，希望你觉得这很有用。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Untitled Document</title>
<style type="text/css">
#container {width: 7in; border: solid 1px red;}
#span {display: table-cell; width: 1px; border: solid 1px blue; font-size: 12px;}
</style>
<script language="javascript" type="text/javascript">
function resizeText() {
  var container = document.getElementById("container");
    var span = document.getElementById("span");

    var containerWidth = container.clientWidth;
  var spanWidth = span.clientWidth; 
    var nAttempts = 900;
    var i=1;
    var font_size = 12;

    while ( spanWidth < containerWidth && i < nAttempts ) {
      span.style.fontSize = font_size+"px";

        spanWidth = span.clientWidth;

        font_size++;
      i++;
    }       
}
</script>
</head>

<body>
<div id="container">
<span id="span">test</span>
</div>
<a href="javascript:resizeText();">resize text</a>
</body>
</html> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T19:08:39.710

网络不是印刷材料的好媒介。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T19:33:47.993

正如其他答案所表明的那样，从网络打印是一件棘手的事情。这是不可预测的，遗憾的是并非所有浏览器和配置的反应都相同。

但是，我会向您指出这个方向：

您可以将 CSS 附加到专门用于打印的文档，如下所示

```
<link rel="stylesheet" type="text/css" href="print.css" media="print" /> 
```

这样，您可以将页面的打印输出格式化为单独的样式表，并保留常规样式表以在屏幕上显示。我以前这样做过，效果不错——尽管它需要进行相当多的调整以确保打印的文档以您想要的方式出现。

一篇关于网络打印主题的有趣文章：

[A List Apart - 准备打印](http://www.alistapart.com/stories/goingtoprint/)

W3C 关于 CSS 打印配置文件的一些信息：

[W3C - CSS 打印配置文件](http://www.w3.org/TR/css-print/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T19:11:32.573

如果您正在生成旨在以特定方式显示的内容，您可能希望查看旨在打印的格式，例如 PDF。HTML/CSS 旨在适应屏幕尺寸、分辨率、颜色深度等的不同配置。这并不是说一个盒子应该正好是 7.5 英寸宽。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T19:35:01.207

你有没有尝试过

```
@media print { #test { width: 7in; }} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T20:37:52.817

这是我从 Orion Edwards（尤其是 webkit.org 的链接）和 Bill 的帖子中学到的内容的合并答案。

似乎答案实际上总是 96 DPI，尽管您可以自由运行以下（诚然草率）代码，如果您得到不同的答案，我很想听听：

```
var bob = document.body.appendChild(document.createElement('div'));
bob.innerHTML = "<div id='jake' style='width:1in'>j</div>";
alert(document.getElementById('jake').clientWidth); 
```

正如 webkit.org 文章所说，这个数字是相当标准的，并且不受您的打印机或平台的影响，因为它们使用不同的 DPI。

即使不是，使用上面的代码你也可以找到你需要的答案。然后你可以在你的 JavaScript 中使用 DPI，像 Bill 那样限制 clientWidth，结合使用英寸的 CSS，只要用户没有像 Orion Edwards 提到的那样做任何时髦的缩放，就可以正确打印出来——或者至少，在那之后，这取决于用户，他们可能想要做一些程序员没有想到的事情，比如在 11x17 纸上打印出程序员设计成适合 8.5x11 的东西，但它仍然会即使在那时，也可以为用户想要的东西“正常工作”。

# java - Eclipse RCP Toolbar buttons with the Eclipse Look

> ID：159190
> 
> 赞同：1
> 
> 时间：2008-10-01T19:05:47.843
> 
> 标签：java, eclipse, swt, rcp

In Eclipse, its easy to specify buttons for your toolbar using the ActionSets extension point. However, when I need to specify some items programmatically, I can't get the same look. I don't believe that the framework is using native buttons for these, but so far, I can't find the right recipe to match the Eclipse look. I wanted to see if anyone has found the right snippet to duplicate this functionality in code.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-13T14:43:47.197

It's difficult to tell from your question, but it sounds like you may be attempting to add a ControlContribution to the toolbar and returning a Button. This would make the button on the toolbar appear like a native button like you seem to be describing. This would look something like this:

```
IToolBarManager toolBarManager = actionBars.getToolBarManager();
toolBarManager.add(new ControlContribution("Toggle Chart") {
    @Override
    protected Control createControl(Composite parent)
    {
        Button button = new Button(parent, SWT.PUSH);
        button.addSelectionListener(new SelectionAdapter() {
        @Override
        public void widgetSelected(SelectionEvent e) {
                // Perform action
            }
        });
     }
}); 
```

Instead you should add an Action to the toolbar. This will create a button on the toolbar that matches the standard eclipse toolbar buttons. This would look something like this:

```
Action myAction = new Action("", imageDesc) {
    @Override
    public void run() {
        // Perform action
    }
};

IToolBarManager toolBarManager = actionBars.getToolBarManager();
toolBarManager.add(myAction); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-17T12:46:36.827

Could you perhaps put in an extract of the code you have for adding actions programmatically to the toolbar? I assume you do this in an **ApplicationActionBarAdvisor** class? Their should be no difference in the look of buttons you add declaratively vs those you add programatically.

# timeout - timeout error when on an ad hoc network

> ID：159214
> 
> 赞同：1
> 
> 时间：2008-10-01T19:09:40.953
> 
> 标签：timeout, wininet, adhoc

I am doing an InternetConnect (Wininet) to an FTP server that happens to be running on an iPhone. When the user is on a normal WiFi network it works fine for him. When he has an ad hoc network with his iPhone he gets an ERROR_INTERNET_TIMEOUT. I presume this is some kind of routing problem. I am curious as to why this gets ERROR_INTERNET_TIMEOUT and not ERROR_INTERNET_CANNOT_CONNECT. Most users, if they are blocked by, for example, a firewall, will get ERROR_INTERNET_CANNOT_CONNECT.

I don't understand enough about low-level TCP/IP to understand what kind of situation would cause a timeout error instead of a connect error. I'm really more intellectually curious in understanding this than I am in actually solving the user's problem. ;-) Can anyone explain what is happening with the network packets (the more detailed the better)?

edit: note that, as far as I know, the user doesn't have an outgoing firewall enabled, it's not a firewall issue. I think it's some kind of routing issue. I have seen similar issues when a user is connected a VPN and their routing is set up incorrectly and all packets go to their work instead of the iPhone. I want to know what's going on with the packets in this situation: the socket connects but at the next step (whatever that is) they can't communicate.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T19:12:27.563

Firewalls these days choose to not respond at all to packets that they deem suspicious, this is to prevent port scanners from detecting that there is a machine at the IP. So that could be what is happening in your case, the firewall may simply be dropping the packet and causing a timeout rather than a failure to connect error.

# iphone - How do I create a bundle of reusable code in Xcode?

> ID：159221
> 
> 赞同：20
> 
> 时间：2008-10-01T19:11:14.977
> 
> 标签：iphone, xcode, bundle

I am developing an iPhone app and have to parse xml files in order to put them into a database. I will also be using those same xml parsers in my app so users can import their own data. I was wondering how I can extract those xml parsers into a bundle or a library so I can use them both in my iPhone app and in a command line app where I just populate a sqlite3 database.

Thanks in advance!

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-01T19:57:51.883

Create a static library project, then use the interproject dependency feature of Xcode to build them in the correct order and link the app with the static library. You'll need to have a common build directory set for all the projects for this to work correctly (at least you did around Xcode 3.0, didn't check if this is still a problem with 3.1).

You can set the build directory from the target or project's build settings (in the Get Info pane). To create an interpoject dependency:

*   Drag the library project into the application project's Files & Groups pane.
*   Set up target dependency in the application target's Get Info pane. Make it dependent on the library's target.
*   Drag the library product in the application target's Link With Libraries step. You can find the library product by expanding the library project within the app project's Files & Groups (click the arrow).

Sounds more complicated than it is. It isn't much.

(Small extras: yes, you need a common build folder as indicated in the [Xcode Project Management Guide](http://developer.apple.com/documentation/DeveloperTools/Conceptual/XcodeProjectManagement/070-Building_Products/chapter_8_section_2.html#//apple_ref/doc/uid/TP40002693-SW10), and the [Xcode Build System Guide](http://developer.apple.com/documentation/DeveloperTools/Conceptual/XcodeBuildSystem/index.html) can help you "get" Xcode's build system, which -- at the cost of starting a religion war -- I think is one of the most flexible and simple build systems out there.)

# eclipse - 任何人都可以推荐一个使用 Eclipse 设置 Hibernate3 的好参考吗？

> ID：159227
> 
> 赞同：2
> 
> 时间：2008-10-01T19:11:53.680
> 
> 标签：eclipse, hibernate

我看过一些 Eclipse 和 Hibernate 教程，而 Hibernate2 的教程非常好，非常直观。最近，我尝试使用 Eclipse 插件设置 Hibernate3，但无法让 Hibernate 工具正常工作，除了将 jar 文件从插件目录物理移动到我的 lib 目录之外（我不应该这样做！）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T19:53:46.340

我不确定您是否仍然需要回答您的问题，但我们自己的 stackoverflow 网站可能[有您正在寻找的解决方案](https://stackoverflow.com/questions/351640/how-to-install-hibernate-tools-in-eclipse#352429)。

如果这不能完全回答您的问题，那么这可能会解决问题：[“Hibernate and Eclipse Integration](http://www.hibernate.org/311.html)。

从链接的休眠网站：

> 在Hibernate插件（需要好友加载）的MANIFEST.MF文件中，比如org.hibernate.eclipse，添加一行：
> 
> Eclipse-BuddyPolicy：已注册
> 
> 在插件项目或 RCP 项目的 MANIFEST.MF 文件中，添加以下行：
> 
> Eclipse-RegisterBuddy:org.hibernate.eclipse
> 
> 注意语法很重要——我们的插件愿意被 hibernate 库看到，使用 Eclipse-RegisterBuddy，并且 Hibernate 正在使用 Eclipse-BuddyPolicy 注册自己。虽然在 Eclipse 帮助中明确说明了这一点（回想起来！），但确保语法准确无误是至关重要的。
> 
> 最后，如果您使用 HibernateUtil 作为 Hibernate 的主要入口点，那么在您的插件启动方法中添加以下行：
> 
> Class.forName("myPlugin.HibernateUtil"); //完整的类名应该放在这里
> 
> 这可行 - 假设 hibernate.cfg.xml 在插件的 src 目录中，并且在类路径中。

希望这可以帮助你。

# c# - Visual Studio 2008：有没有办法在 C# 中打开类名/方法名下拉菜单？（就像 VB.Net 一样）

> ID：159237
> 
> 赞同：1
> 
> 时间：2008-10-01T19:13:16.407
> 
> 标签：c#, vb.net, visual-studio-2008

我在 C# 中的 .Net 3.5sp1 中为 ASP.Net 解决方案工作，我想知道是否有任何方法可以在 VB.Net 顶部的文本编辑器中打开类名和方法名下拉菜单. 这是我真正怀念的 VB 中为数不多的几件事之一。

编辑：另外，有没有办法让下拉列表中填充可能的事件？

例如（页面事件）| （声明）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T19:16:07.867

去：

```
Tools -> Options -> Text Editor -> C# -> General -> Navigation Bar 
```

确保它被单击，并且应该在代码顶部显示一些内容，其中包含文件中列出的所有类和方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T19:16:58.957

在 Visual Studio 2008（可能还有更早的版本）中：

工具 -> 选项 -> 文本编辑器 -> C#(*) -> 常规 -> 导航栏

(*) 或您喜欢的编辑器语言

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T19:20:30.553

尝试

[工具]->[选项]->[文本编辑器]->[C#]->[常规]->[勾选“导航栏]

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T19:20:16.123

请注意，在光标位于命名空间/类中之前，不会填写列表

# c++ - RAII vs. exceptions

> ID：159240
> 
> 赞同：51
> 
> 时间：2008-10-01T19:14:04.780
> 
> 标签：c++, exception, raii, destructor

The more we use RAII in C++, the more we find ourselves with destructors that do non-trivial deallocation. Now, deallocation (finalization, however you want to call it) can fail, in which case exceptions are really the only way to let anybody upstairs know of our deallocation problem. But then again, throwing-destructors are a bad idea because of the possibility of exceptions being thrown during stack unwinding. `std::uncaught_exception()` lets you know when that happens, but not much more, so aside from letting you log a message before termination there's not much you can do, unless you're willing to leave your program in an undefined state, where some stuff is deallocated/finalized and some not.

One approach is to have no-throw destructors. But in many cases that just hides a real error. Our destructor might, for example, be closing some RAII-managed DB connections as a result of some exception being thrown, and those DB connections might fail to close. This doesn't necessarily mean we're ok with the program terminating at this point. On the other hand, logging and tracing these errors isn't really a solution for every case; otherwise we would have had no need for exceptions to begin with. With no-throw destructors we also find ourselves having to create "reset()" functions that are supposed to be called before destruction - but that just defeats the whole purpose of RAII.

Another approach is just to [let the program terminate](http://www.kolpackov.net/projects/c++/eh/dtor-1.xhtml), as it's the most predictable thing you can do.

Some people suggest chaining exceptions, so that more than one error can be handled at a time. But I honestly never actually seen that done in C++ and I've no idea how to implement such a thing.

So it's either RAII or exceptions. Isn't it? I'm leaning toward no-throw destructors; mainly because it keeps things simple(r). But I really hope there's a better solution, because, as I said, the more we use RAII, the more we find ourselves using dtors that do non-trivial things.

**Appendix**

I'm adding links to interesting on-topic articles and discussions I've found:

*   [Throwing Destructors](http://www.kolpackov.net/projects/c++/eh/dtor-1.xhtml)
*   StackOverflow discussion on the [problems with SEH](https://stackoverflow.com/questions/164372/is-there-a-good-way-around-the-problems-of-structured-exception-handling-try-ex)
*   StackOverflow discussion on [throwing-destructors](https://stackoverflow.com/questions/130117/throwing-exceptions-out-of-a-destructor#130123) (thanks, Martin York)
*   [Joel on Exceptions](http://www.joelonsoftware.com/items/2003/10/13.html)
*   [SEH Considered Harmful](http://blogs.msdn.com/larryosterman/archive/2004/09/10/228068.aspx)
*   [CLR Exception Handling](http://bartdesmet.net/blogs/bart/archive/2006/04/04/clr-exception-handling-from-a-to-z-everything-you-didn-t-want-to-know-about-try-catch-finally-fault-filter.aspx) which also touches on exception chaining
*   [Herb Sutter on std::uncaught_exception](http://www.gotw.ca/gotw/047.htm) and why it's not as useful as you think
*   [Historical discussion](http://www.cpptalk.net/1-vt12438.html?postdays=0&postorder=asc&start=0) on the matter with interesting participants (long!)
*   Stroustrup explaining [RAII](http://www.research.att.com/~bs/bs_faq2.html#finally)
*   Andrei Alexandrescu's [Scope Guard](http://www.ddj.com/cpp/184403758)

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-01T19:19:26.033

You **SHOULD NOT** throw an exception out of a destructor.

Note: Updated to refeclt changes in the standard:

In C++03
If an exception is already propagating then the application will terminate.

In C++11
If the destructor is `noexcept` (the default) then the application will terminate.

**The Following is based on C++11**

If an exception escapes a `noexcept` function it is implementation defined if the stack is even unwound.

**The Following is based on C++03**

By terminate I mean stop immediately. Stack unwinding stops. No more destructors are called. All bad stuff. See the discussion here.

[throwing exceptions out of a destructor](https://stackoverflow.com/questions/130117/throwing-exceptions-out-of-a-destructor#130123)

I don't follow (as in disagree with) your logic that this causes the destructor to get more complicated.
With the correct usage of smart pointers this actually makes the destructor simpler as everything now becomes automatic. Each class tides up its own little piece of the puzzle. No brain surgery or rocket science here. Another Big win for RAII.

As for the possibility of std::uncaught_exception() I point you at [Herb Sutters article about why it does not work](http://www.gotw.ca/gotw/047.htm)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-01T22:09:08.667

From the original question:

> Now, deallocation (finalization, however you want to call it) can fail, in which case exceptions are really the only way to let anybody upstairs know of our deallocation problem

Failure to cleanup a resource either indicates:

1.  Programmer error, in which case, you should log the failure, followed by notifying the user or terminating the application, depending on application scenario. For example, freeing an allocation that has already been freed.

2.  Allocator bug or design flaw. Consult the documentation. Chances are the error is probably there to help diagnose programmer errors. See item 1 above.

3.  Otherwise unrecoverable adverse condition that can be continued.

For example, the C++ free store has a no-fail operator delete. Other APIs (such as Win32) provide error codes, but will only fail due to programmer error or hardware fault, with errors indicating conditions like heap corruption, or double free, etc.

As for unrecoverable adverse conditions, take the DB connection. If closing the connection failed because the connection was dropped -- cool, you're done. Don't throw! A dropped connection (should) result in a closed connection, so there's no need to do anything else. If anything, log a trace message to help diagnose usage issues. Example:

```
class DBCon{
public:
  DBCon() { 
    handle = fooOpenDBConnection();
  }
  ~DBCon() {
    int err = fooCloseDBConnection();
    if(err){
      if(err == E_fooConnectionDropped){
        // do nothing.  must have timed out
      } else if(fooIsCriticalError(err)){
        // critical errors aren't recoverable.  log, save 
        //  restart information, and die
        std::clog << "critical DB error: " << err << "\n";
        save_recovery_information();
        std::terminate();
      } else {
        // log, in case we need to gather this info in the future,
        //  but continue normally.
        std::clog << "non-critical DB error: " << err << "\n";
      }
    }
    // done!
  }
}; 
```

None of these conditions justify attempting a second kind of unwind. Either the program can continue normally (including exception unwind, if unwind is in progress), or it dies here and now.

**Edit-Add**

If you *really* want to be able to keep some sort of link to those DB connections that can't close -- perhaps they failed to close due to intermittent conditions, and you'd like to retry later -- then you can always defer cleanup:

```
vector<DBHandle> to_be_closed_later;  // startup reserves space

DBCon::~DBCon(){
  int err = fooCloseDBConnection();
  if(err){
    ..
    else if( fooIsRetryableError(err) ){
      try{
        to_be_closed.push_back(handle);
      } catch (const bad_alloc&){
        std::clog << "could not close connection, err " << err << "\n"
      }
    }
  }
} 
```

Very not pretty, but it might get the job done for you.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-07-09T09:43:35.467

你在看两件事：

1.  RAII，它保证在退出范围时清理资源。
2.  完成一个操作并确定它是否成功。

RAII 承诺它将完成该操作（释放内存、关闭试图刷新它的文件、结束试图提交它的事务）。但是因为它是自动发生的，程序员不需要做任何事情，它不会告诉程序员它“尝试”的那些操作是否成功。

异常是报告某事失败的一种方式，但正如您所说，C++ 语言有一个限制，这意味着它们不适合从析构函数 [*] 中执行此操作。返回值是另一种方式，但更明显的是析构函数也不能使用它们。

因此，如果您想知道您的数据是否已写入磁盘，则不能使用 RAII。它并没有“破坏 RAII 的全部目的”，因为 RAII 仍然会尝试编写它，并且它仍然会释放与文件句柄（DB 事务等）相关的资源。它确实限制了 RAII 的功能——它不会告诉您数据是否已写入，因此您需要一个`close()`可以返回值和/或抛出异常的函数。

[*] 这也是一个很自然的限制，存在于其他语言中。如果您认为 RAII 析构函数应该抛出异常来表示“出现问题！”，那么当已经发生异常时，必须发生一些*事情*，即“甚至在此之前还有其他事情出错了！”。我知道使用异常的语言不允许同时出现两个异常-语言和语法根本不允许。如果 RAII 是做你想做的事，那么异常本身需要重新定义，这样一个线程一次有不止一件事情出错，两个异常向外传播和调用两个处理程序是有意义的，一个来处理每个。

其他语言允许第二个异常掩盖第一个异常，例如，如果一个`finally`块在 Java 中抛出。C++ 几乎说第二个必须被抑制，否则`terminate`称为（在某种意义上抑制两者）。在这两种情况下，较高的堆栈级别都不会通知这两个故障。有点不幸的是，在 C++ 中，您无法可靠地判断另一个异常是否是一个太多（`uncaught_exception`不会告诉您，它会告诉您一些不同的东西），因此您甚至无法抛出存在的情况在飞行中已经*不是*一个例外。但即使你能在那种情况下做到这一点，你仍然会被塞满在一个多一个是太多的情况下。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-16T21:51:22.670

当我向一位同事解释异常/RAII 概念时，这让我想起了一个问题：“嘿，如果计算机关闭，我可以抛出什么异常？”

无论如何，我同意 Martin York 的回答[RAII vs. exceptions](https://stackoverflow.com/questions/159240/raii-vs-exceptions#159259)

## 异常和析构函数是怎么回事？

许多 C++ 特性依赖于非抛出的析构函数。

事实上，RAII 的整个概念及其与代码分支（返回、抛出等）的合作是基于释放不会失败的事实。同样，当您想为对象提供高异常保证时，某些函数不应该失败（例如 std::swap）。

并不是说你不能通过析构函数抛出异常。只是该语言甚至不会尝试支持这种行为。

## 如果被授权会发生什么？

只是为了好玩，我试着想象它......

如果你的析构函数无法释放你的资源，你会怎么做？您的对象可能已损坏一半，您会从“外部”捕获该信息做什么？再试一次？（如果是，那么为什么不从析构函数中再次尝试？...）

也就是说，如果您仍然可以访问半破坏的对象：如果您的对象在堆栈上（这是 RAII 工作的基本方式）怎么办？如何访问其范围之外的对象？

## 在异常中发送资源？

您唯一的希望是在异常中发送资源的“句柄”并希望代码中的代码，嗯......再次尝试释放它（见上文）？

现在，想象一些有趣的事情：

```
 void doSomething()
 {
    try
    {
       MyResource A, B, C, D, E ;

       // do something with A, B, C, D and E

       // Now we quit the scope...
       // destruction of E, then D, then C, then B and then A
    }
    catch(const MyResourceException & e)
    {
       // Do something with the exception...
    }
 } 
```

现在，让我们想象由于某种原因 D 的析构函数未能释放资源。您对其进行编码以发送异常，该异常将被 catch 捕获。一切都很顺利：你可以按照你想要的方式处理失败（你将如何以建设性的方式仍然让我望而却步，但是，现在这不是问题）。

但...

## 在 MULTIPLE 异常中发送 MULTIPLE 资源？

现在，如果 ~D 可以失败，那么 ~C 也可以。以及~B和~A。

通过这个简单的示例，您有 4 个析构函数在“同一时刻”失败（退出范围）。您需要的不是具有一个异常的捕获，而是具有一系列异常的捕获（希望为此生成的代码不会……呃……抛出）。

```
 catch(const std::vector<MyResourceException> & e)
    {
       // Do something with the vector of exceptions...
       // Let's hope if was not caused by an out-of-memory problem
    } 
```

让我们重新开始（*我喜欢这首音乐...*）：抛出的每个异常都是不同的（*因为原因不同：请记住，在 C++ 中，异常不必从 std::exception 派生*）。现在，您需要同时处理四个异常。你如何编写 catch 子句按照它们的类型和抛出的顺序来处理这四个异常？

如果您有多个相同类型的异常，由多个失败的释放引发怎么办？如果在分配数组的异常数组的内存时，您的程序内存不足并且，呃......抛出内存不足异常怎么办？

您确定要花时间解决此类问题，而不是花时间弄清楚释放失败的原因或如何以其他方式对其做出反应吗？

显然，C++ 设计者没有看到可行的解决方案，只是在那里减少了损失。

## 问题不在于 RAII 与异常...

不，问题是有时，事情可能会失败得如此之多，以至于无能为力。

只要满足某些条件，RAII 就可以很好地处理异常。其中：*析构函数不会抛出*. **您所看到的反对只是结合两个“名称”的单一模式的一个极端情况：异常*和*RAII**

*如果析构函数出现问题，我们必须接受失败，并挽救可以挽救的东西*：“DB连接未能被释放？对不起，让我们至少避免这种内存泄漏并关闭这个文件。”

虽然异常模式是（应该是）C++ 中的主要错误处理，但它并不是唯一的。当 C++ 异常不是解决方案时，您应该使用其他错误/日志机制来处理异常（双关语）情况。

因为您刚刚遇到了语言中的一堵墙，一堵我知道或听说过的其他语言都没有正确穿过而没有倒塌的墙（C# 尝试是值得的，而 Java 的尝试仍然是一个伤害我的笑话...我什至不会谈论在同样的问题上以同样的沉默方式失败的脚本语言）。

**但最终，无论您编写多少代码，您都不会受到用户关闭计算机的保护**。

你能做的最好的，你已经写好了。我自己的偏好是使用抛出 finalize 方法，非抛出析构函数清理未手动完成的资源，以及日志/消息框（如果可能）来警告析构函数中的失败。

也许你没有进行正确的决斗。而不是“RAII vs. Exception”，它应该是“***试图释放资源与绝对不想被释放的资源，即使受到破坏的威胁***”

:-)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-05T13:47:20.217

我要问的一件事是，忽略终止等问题，如果您的程序由于正常破坏或异常破坏而无法关闭其数据库连接，您认为适当的响应是什么。

您似乎排除了“仅记录”并且不愿意终止，那么您认为最好的做法是什么？

我认为，如果我们对这个问题有答案，那么我们就会更好地了解如何进行。

对我来说，没有什么策略特别明显。除此之外，我真的不知道关闭数据库连接抛出意味着什么。如果 close() 抛出，连接的状态是什么？它是关闭的、仍然开放的还是不确定的？如果它是不确定的，有没有办法让程序恢复到已知状态？

析构函数失败意味着无法撤消对象的创建；将程序返回到已知（安全）状态的唯一方法是拆除整个过程并重新开始。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-05T14:06:50.957

你的破坏可能失败的原因是什么？为什么不在实际破坏之前处理这些？

例如，关闭数据库连接可能是因为：

*   交易进行中。（检查 std::uncaught_exception() - 如果为 true，则回滚，否则提交 - 这些是最可能需要的操作，除非您在实际关闭连接之前有另外说明的策略。）
*   连接断开。（检测并忽略。服务器会自动回滚。）
*   其他数据库错误。（记录下来，以便我们可以调查并可能在将来适当地处理。这可能是检测和忽略。同时，尝试回滚并再次断开连接并忽略所有错误。）

如果我正确理解 RAII（我可能不会），那么重点就是它的范围。因此，无论如何，您并不希望交易持续时间比对象长。因此，在我看来，您希望尽可能确保关闭是合理的。RAII 并没有使它变得独一无二——即使根本没有对象（比如在 C 中），您仍然会尝试捕获所有错误条件并尽可能地处理它们（有时会忽略它们）。RAII 所做的只是强制您将所有代码放在一个地方，无论有多少函数使用该资源类型。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T19:33:01.833

您可以通过检查来判断当前是否存在正在运行的异常（例如，我们在执行堆栈展开的 throw 和 catch 块之间，可能正在复制异常对象或类似情况）

```
bool std::uncaught_exception() 
```

如果它返回 true，此时抛出将终止程序，如果不是，则抛出是安全的（或至少与以往一样安全）。这在 ISO 14882（C++ 标准）的第 15.2 和 15.5.3 节中进行了讨论。

这并没有回答在清理异常时遇到错误时该怎么做的问题，但确实没有任何好的答案。但是，如果您在后一种情况下等待执行不同的操作（例如 log&ignore 它），它确实可以让您区分正常退出和异常退出，而不是简单地恐慌。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-09-29T11:32:09.300

*如果在最终确定*过程中确实需要处理一些错误，则不应该在析构函数中完成。相反，应使用返回错误代码或可能抛出的单独函数。要重用代码，您可以在析构函数中调用此函数，但不能让异常泄漏。

正如一些人提到的，这并不是真正的资源释放，而是退出期间的资源提交。正如其他人提到的，如果在强制关机期间保存失败，您该怎么办？可能没有完全令人满意的答案，但我建议采用以下方法之一：

*   只允许失败和损失发生
*   将未保存的部分保存到其他地方并允许稍后进行恢复（如果这也不起作用，请参阅另一种方法）

如果您不喜欢这两种方法中的任何一种，请让您的用户明确保存。告诉他们在关机期间不要依赖自动保存。

# .net - .net 框架版本要求用于 MS Sync 框架

> ID：159242
> 
> 赞同：0
> 
> 时间：2008-10-01T19:15:15.793
> 
> 标签：.net, microsoft-sync-framework

谁能告诉我最近发布的 MS Sync 框架（用于支持偶尔连接的应用程序）需要哪个版本的 .NET 框架（CLR 和 BCL）？

它被列为 ADO.NET v2.0 的 Sync Framework V1，但其列出的要求都没有说明支持它所需的 .NET fx 版本。

有没有人有这方面的经验...？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T20:04:25.660

ADO.NET 2.0 的同步服务需要服务器上的 ADO.NET 2.0。同步服务需要用于桌面客户端的 ADO.NET 2.0 或用于设备客户端的 .NET Compact Framework 2.0 Service Pack 2。

因此，您应该拥有 .net framework 2.0 或更高版本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T19:31:09.810

我很确定它适用于 2.0 及更高版本。请记住，3.5 和 3.0 仍在 2.0 CLR 上运行。您可以在 Sync 命名空间中获得 Sync 所需的一切，我认为这些不依赖于任何 3.0 或 3.5 语言功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T19:20:03.083

如果它指定 ADO.NET 2.0，那么您至少需要 .NET 2.0。ADO.NET 在 1.1 和 2.0 之间发生了很大变化

# linux - Linux 中的音高识别

> ID：159251
> 
> 赞同：3
> 
> 时间：2008-10-01T19:16:35.290
> 
> 标签：linux, audio, pitch-tracking

是否有任何免费软件工具或组合可以让我识别录制的演唱会的音高？

这个想法是在时间线上显示某种带有当前音高的图表以及标准音符（C3、C#3、D 等）的标记。我不需要音高校正，也不需要实时完成。

我知道曾经有一个 Rosegarden 插件可以做到这一点，但它已经丢失了。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T19:27:32.720

结帐[大胆](http://audacity.sourceforge.net/)。它来自一个进行音乐音高分析的项目。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T19:26:59.367

不完全是您正在寻找的东西，但与 Singstar 相似的 Ultrastar-NG 至少可以做到这样。 [http://ultrastar-ng.sourceforge.net/](http://ultrastar-ng.sourceforge.net/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T19:36:31.093

我不知道有什么内置的软件包。如果你有兴趣写这样的东西，你会想看看[Discrete Fourier Transforms](http://en.wikipedia.org/wiki/Discrete_Fourier_transform)。这会将时间序列样本转换为频率集合。但这使您无法获得有关各种频率何时出现的信息，因此您必须进行窗口傅里叶变换，窗口具有您想要的任何时间分辨率。然而，增加时间分辨率会降低频率分辨率。

最简单的做法是找出任何窗口中最大的频率分量并将其称为频率。但是真正的音乐（a）有和弦，（b）有泛音和低音。此外，唱歌经常有“颤音”，歌手在音乐标记的理论音高附近改变实际音高。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-03T09:15:50.680

[Praat](http://www.fon.hum.uva.nl/praat/)至少会对复杂的声音进行自动音高估计。虽然我不知道它是否可以按照您的要求标记标准注释。

抢

# javascript - UpdatePanel 更新后如何执行操作？

> ID：159252
> 
> 赞同：3
> 
> 时间：2008-10-01T19:16:48.847
> 
> 标签：javascript, asp.net-ajax, updatepanel

当我在 UpdatePanel（不是 ASP.NET 控件）中有一个带有一些 JavaScript 事件的常规文本框时，在 UpdatePanel 更新后我的事件就消失了。有没有办法在更新后重新附加我的活动？（最好不要将我的事件内联）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T19:36:32.717

您可以使用[PageRequestManager](http://www.asp.net/AJAX/documentation/live/ClientReference/Sys.WebForms/PageRequestManagerClass/default.aspx)类的[endRequest](http://www.asp.net/AJAX/documentation/live/ClientReference/Sys.WebForms/PageRequestManagerClass/PageRequestManagerEndRequestEvent.aspx)事件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T19:19:27.467

您可以`setInterval()`在文档加载时循环搜索更新面板中的元素，如果它没有事件，它可以重新附加它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T19:45:20.307

事件消失了，因为您的文本框是 DOM 中的一个新元素（在 UpdatePanel 刷新之后）。正如[korchev 所说](https://stackoverflow.com/questions/159252/how-do-i-perform-an-action-after-an-updatepanel-updates#159330)，使用 endRequest 事件重新附加事件处理程序。

# mysql - 在 MySQL 数据库中存储纬度/经度时使用的理想数据类型是什么？

> ID：159255
> 
> 赞同：467
> 
> 时间：2008-10-01T19:18:13.960
> 
> 标签：mysql, database-design, maps, mapping, latitude-longitude

请记住，我将在纬度/经度对上执行计算，哪种数据类型最适合与 MySQL 数据库一起使用？

* * *

## 回答 #1

> 赞同：170
> 
> 时间：2008-10-01T19:21:04.983

将 MySQL 的[空间扩展](https://dev.mysql.com/doc/refman/8.0/en/spatial-types.html)与 GIS 结合使用。

* * *

## 回答 #2

> 赞同：167
> 
> 时间：2014-08-04T13:46:49.403

基本上，这取决于您的位置所需的精度。使用 DOUBLE，您将获得 3.5nm 的精度。DECIMAL(8,6)/(9,6) 下降到 16 厘米。FLOAT 为 1.7m...

这个非常有趣的表有一个更完整的列表： http: [//mysql.rjweb.org/doc.php/latlng](http://mysql.rjweb.org/doc.php/latlng)：

```
Datatype               Bytes            Resolution

Deg*100 (SMALLINT)     4      1570 m    1.0 mi  Cities
DECIMAL(4,2)/(5,2)     5      1570 m    1.0 mi  Cities
SMALLINT scaled        4       682 m    0.4 mi  Cities
Deg*10000 (MEDIUMINT)  6        16 m     52 ft  Houses/Businesses
DECIMAL(6,4)/(7,4)     7        16 m     52 ft  Houses/Businesses
MEDIUMINT scaled       6       2.7 m    8.8 ft
FLOAT                  8       1.7 m    5.6 ft
DECIMAL(8,6)/(9,6)     9        16cm    1/2 ft  Friends in a mall
Deg*10000000 (INT)     8        16mm    5/8 in  Marbles
DOUBLE                16       3.5nm     ...    Fleas on a dog 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：157
> 
> 时间：2011-05-13T15:18:40.140

Google 为带有 Google Maps 的示例“Store Locator”应用程序提供了一个从头到尾的 PHP/MySQL 解决方案。在此示例中，它们将 lat/lng 值存储为“Float”，长度为“10,6”

[http://code.google.com/apis/maps/articles/phpsqlsearch.html](http://code.google.com/apis/maps/articles/phpsqlsearch.html)

* * *

## 回答 #4

> 赞同：76
> 
> 时间：2008-10-02T15:41:53.927

MySQL 的 Spatial Extensions 是最佳选择，因为您可以使用空间运算符和索引的完整列表。空间索引将允许您非常快速地执行基于距离的计算。请记住，从 6.0 开始，空间扩展仍然不完整。我不是在贬低 MySQL Spatial，只是让你在你在这方面走得太远之前知道其中的陷阱。

如果您严格处理点并且只处理 DISTANCE 函数，这很好。如果您需要使用多边形、线或缓冲点进行任何计算，除非您使用“相关”运算符，否则空间运算符不会提供准确的结果。[请参阅21.5.6](http://dev.mysql.com/doc/refman/6.0/en/functions-that-test-spatial-relationships-between-geometries.html)顶部的警告。包含、内部或相交等关系使用的是 MBR，而不是确切的几何形状（即，椭圆被视为矩形）。

此外，MySQL Spatial 中的距离与您的第一个几何图形的单位相同。这意味着如果您使用十进制度，那么您的距离测量值是十进制度。当您远离赤道时，这将很难获得准确的结果。

* * *

## 回答 #5

> 赞同：73
> 
> 时间：2008-10-01T19:37:02.667

当我为从 ARINC424 构建的导航数据库执行此操作时，我进行了大量测试并回顾代码，我使用了 DECIMAL(18,12)（实际上是 NUMERIC(18,12)，因为它是 firebird）。

浮点数和双精度数不那么精确，可能会导致舍入错误，这可能是一件非常糟糕的事情。我不记得我是否发现任何有问题的真实数据 - 但我相当肯定无法准确存储在浮点数或双精度数中可能会导致问题

关键是，当使用度数或弧度时，我们知道值的范围——小数部分需要最多的数字。

[MySQL Spatial Extensions](http://dev.mysql.com/doc/refman/5.0/en/spatial-extensions.html)是一个不错的选择，因为它们遵循[OpenGIS Geometry Model](http://dev.mysql.com/doc/refman/5.0/en/opengis-geometry-model.html)。我没有使用它们，因为我需要保持我的数据库可移植。

* * *

## 回答 #6

> 赞同：44
> 
> 时间：2015-06-15T19:41:11.317

取决于您需要的精度。

```
Datatype           Bytes       resolution
------------------ -----  --------------------------------
Deg*100 (SMALLINT)     4  1570 m    1.0 mi  Cities
DECIMAL(4,2)/(5,2)     5  1570 m    1.0 mi  Cities
SMALLINT scaled        4   682 m    0.4 mi  Cities
Deg*10000 (MEDIUMINT)  6    16 m     52 ft  Houses/Businesses
DECIMAL(6,4)/(7,4)     7    16 m     52 ft  Houses/Businesses
MEDIUMINT scaled       6   2.7 m    8.8 ft
FLOAT                  8   1.7 m    5.6 ft
DECIMAL(8,6)/(9,6)     9    16cm    1/2 ft  Friends in a mall
Deg*10000000 (INT)     8    16mm    5/8 in  Marbles
DOUBLE                16   3.5nm     ...    Fleas on a dog 
```

来自：http: [//mysql.rjweb.org/doc.php/latlng](http://mysql.rjweb.org/doc.php/latlng)

总结一下：

*   最精确的可用选项是`DOUBLE`。
*   最常见的使用类型是`DECIMAL(8,6)/(9,6)`.

从[MySQL 5.7](https://dev.mysql.com/doc/relnotes/mysql/5.7/en/)开始，考虑使用[空间数据类型](https://dev.mysql.com/doc/refman/5.7/en/spatial-datatypes.html)(SDT)，专门[`POINT`](https://dev.mysql.com/doc/refman/5.7/en/gis-class-point.html)用于存储单个坐标。在 5.7 之前，SDT 不支持索引（表类型为 MyISAM 时，5.6 除外）。

笔记：

*   使用`POINT`类时，存储坐标的参数顺序必须是`POINT(latitude, longitude)`.
*   [创建空间索引](https://dev.mysql.com/doc/refman/5.7/en/creating-spatial-indexes.html)有一种特殊的语法。
*   使用 SDT 的最大好处是您可以访问[空间分析功能](http://dev.mysql.com/doc/refman/5.7/en/spatial-function-reference.html)，例如计算两点之间的距离 ( [`ST_Distance`](http://dev.mysql.com/doc/refman/5.7/en/spatial-relation-functions-object-shapes.html#function_st-distance)) 并确定一个点是否包含在另一个区域内 ( [`ST_Contains`](http://dev.mysql.com/doc/refman/5.7/en/spatial-relation-functions-object-shapes.html#function_st-contains))。

* * *

## 回答 #7

> 赞同：36
> 
> 时间：2013-09-28T11:30:00.370

根据这篇 wiki 文章 [http://en.wikipedia.org/wiki/Decimal_degrees#Accuracy，MySQL](http://en.wikipedia.org/wiki/Decimal_degrees#Accuracy) 中的适当数据类型是 Decimal(9,6)，用于将经度和纬度存储在单独的字段中。

* * *

## 回答 #8

> 赞同：24
> 
> 时间：2015-01-13T16:30:51.147

用于`DECIMAL(8,6)`纬度（90 到 -90 度）和`DECIMAL(9,6)`经度（180 到 -180 度）。6 位小数适用于大多数应用程序。两者都应该“签名”以允许负值。

* * *

## 回答 #9

> 赞同：22
> 
> 时间：2016-07-22T00:13:35.057

无需走太远，根据谷歌地图，lat 和 lng 最好是 FLOAT(10,6)。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-10-19T01:45:25.267

我们在 oracle 数据库中将纬度/经度 X 1,000,000 存储为 NUMBERS 以避免双精度数的舍入错误。

考虑到小数点后 6 位的纬度/经度精度为 10 厘米，这就是我们所需要的。许多其他数据库也将 lat/long 存储到小数点后 6 位。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2015-11-26T14:47:06.403

在一个完全不同和更简单的角度来看：

*   如果您依靠 Google 来显示您的地图、标记、多边形等等，那么就让 Google 来完成计算吧！
*   您在服务器上保存资源，只需将纬度和经度一起存储为单个字符串 ( `VARCHAR`)，例如：“ [-0000.0000001,-0000.000000000000001](https://www.google.com/maps/search/-0000.0000001,-0000.0000001) ”（长度为 35，如果一个数字有超过 7 个十进制数字，则四舍五入）；
*   如果 Google 为每个数字返回超过 7 个十进制数字，则无论如何您都可以将该数据存储在您的字符串中，以防万一您想[在将来检测到一些逃跑或微生物](https://stackoverflow.com/a/25120203/1326147)；
*   您可以使用他们的[距离矩阵](https://developers.google.com/maps/documentation/javascript/distancematrix)或[几何库](https://developers.google.com/maps/documentation/javascript/geometry)来计算距离或[检测某些区域](https://developers.google.com/maps/documentation/javascript/geometry#containsLocation)中的点，调用如下所示：`google.maps.geometry.poly.containsLocation(latLng, bermudaTrianglePolygon))`
*   您可以使用大量使用 Google Maps API 的“服务器端”API（在[Python](https://github.com/googlemaps/google-maps-services-python)、[Ruby on Rails](http://www.sitepoint.com/use-google-maps-rails/)、[PHP](https://github.com/egeloen/ivory-google-map)、[CodeIgniter](http://biostall.com/codeigniter-google-maps-v3-api-library)、[Laravel](https://github.com/bradcornford/Googlmapper)、[Yii](http://www.yiiframework.com/extension/egmap/)、[Zend Framework](https://github.com/cderue/GoogleMaps)等中）。

这样，您就不必担心索引编号以及与可能破坏坐标的数据类型相关的所有其他问题。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2018-08-13T23:06:32.697

**TL;博士**

如果您不在 NASA / 军队工作并且不制造飞机导航系统，请使用 FLOAT(8,5)。

* * *

要完全回答您的问题，您需要考虑几件事：

**格式**

*   **度 分 秒**: 40° 26′ 46″ N 79° 58′ 56″ W
*   **度十进制分钟**：40° 26.767′ N 79° 58.933′ W
*   **十进制度 1** : 40.446° N 79.982° W
*   **十进制度 2** : -32.60875, 21.27812
*   其他一些自制格式？没有人禁止您制作自己的以家为中心的坐标系并将其存储为与您家的航向和距离。这对于您正在处理的某些特定问题可能是有意义的。

所以答案的第一部分是 - 您可以以*应用程序使用的格式*存储坐标，以避免不断地来回转换并进行更简单的 SQL 查询。

很可能您使用 Google Maps 或 OSM 来显示您的数据，而 GMaps 使用“十进制度 2”格式。因此，以相同格式存储坐标会更容易。

**精确**

然后，您想定义所需的精度。当然，您可以存储诸如“-32.608697550570334,21.278081997935146”之类的坐标，但是您在导航到该点时是否关心过毫米？如果你不是在 NASA 工作，也不是在做卫星、火箭或飞机的轨迹，那么几米的精度应该没问题。

常用格式是点后 5 位数字，精度为 50 厘米。

*示例：X,21.278081* **8**和 X,21.278081 **9**之间有 1cm 的距离。因此，点后的 7 位数字为您提供 1/2 厘米的精度，而点后的 5 位数字将为您提供 1/2 米的精度（因为不同点之间的最小距离为 1m，因此舍入误差不能超过一半）。对于大多数民用目的，这应该足够了。

十进制分钟格式（40° 26.767′ N 79° 58.933′ W）为您提供与点后 5 位数字完全相同的精度

**节省空间的存储**

如果您选择了十进制格式，那么您的坐标是一对 (-32.60875, 21.27812)。显然，2 x（符号 1 位，度数 2 位，指数 5 位）就足够了。

所以在这里我想从评论中支持 **Alix Axel**说谷歌建议将它存储在 FLOAT(10,6) 中真的是额外的，因为你不需要 4 位数字作为主要部分（因为符号是分开的并且纬度是有限的90，经度限制为 180）。您可以轻松地将 FLOAT(8,5) 用于 1/2m 精度或 FLOAT(9,6) 用于 50/2cm 精度。或者您甚至可以将 lat 和 long 存储在单独的类型中，因为 FLOAT(7,5) 足以存储 lat。请参阅 MySQL 浮点类型[参考](https://dev.mysql.com/doc/refman/8.0/en/floating-point-types.html)。它们中的任何一个都将像普通的 FLOAT 并且无论如何都等于 4 个字节。

现在空间通常不是问题，但是如果您出于某种原因想要真正优化存储（免责声明：不要进行预优化），您可以压缩 lat(不超过 91 000 个值 + 符号) + long(no超过 181 000 个值 + 符号）到​​ 21 位，*明显小于*2xFLOAT（8 字节 == 64 位）

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2013-04-03T08:05:56.000

虽然它不是所有操作的最佳选择，但如果您正在制作地图图块或使用只有一个投影的大量标记（点）（例如墨卡托，如谷歌地图和许多其他滑动地图框架所期望的），我发现了什么我称“大坐标系”非常非常方便。基本上，您以某种方式放大存储 x 和 y 像素坐标——我使用缩放级别 23。这有几个好处：

*   您对墨卡托像素进行一次昂贵的 lat/lng 转换，而不是每次处理该点时
*   从给定缩放级别的记录中获取平铺坐标需要右移一次。
*   从记录中获取像素坐标需要一次右移和一次按位与。
*   移位非常轻量级，可以在 SQL 中执行，这意味着您可以执行 DISTINCT 以每个像素位置仅返回一条记录，这将减少后端返回的记录数，这意味着更少的处理前端。

我在最近的一篇博文中谈到了这一切：http: [//blog.webfoot.com/2013/03/12/optimizing-map-tile-generation/](http://blog.webfoot.com/2013/03/12/optimizing-map-tile-generation/)

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2010-07-23T12:37:42.333

根据您的应用程序，我建议使用 FLOAT(9,6)

空间键将为您提供更多功能，但在生产基准测试中，浮点数比空间键快得多。（平均 0,01 VS 0,001）

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2012-12-19T11:14:15.553

MySQL 对所有浮点数使用双精度...所以使用双精度类型。在大多数情况下，使用浮点数会导致不可预测的舍入值

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2019-01-22T12:06:30.223

1.  纬度范围从 -90 到 +90（度），因此 DECIMAL(10, 8) 可以

2.  经度范围从 -180 到 +180（度），因此您需要 DECIMAL(11, 8)。

注意：第一个数字是存储的总位数，第二个是小数点后的数字。

简而言之：`lat DECIMAL(10, 8) NOT NULL, lng DECIMAL(11, 8) NOT NULL`

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-12-29T18:31:31.570

PostGIS 中的空间函数比 MySQL 空间函数中的函数更实用（即不受 BBOX 操作的限制）。看看：[链接文本](http://postgis.refractions.net/)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-11-07T15:30:37.087

我建议您对 SQL Server 使用 Float 数据类型。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2020-11-19T12:04:55.310

存储 Lat Long 值的理想数据类型是 decimal(9,6)

这是大约 10 厘米的精度，同时仅使用 5 个字节的存储空间。

例如 CAST(123.456789 作为十进制 (9,6))

* * *

## 回答 #20

> 赞同：-2
> 
> 时间：2008-10-01T19:23:07.350

Lat Long 计算需要精度，因此请使用某种类型的小数类型并使精度至少比您将存储的数字高 2 以执行数学计算。我不知道我的 sql 数据类型，但在 SQL Server 中，人们经常使用浮点数或实数而不是十进制数并遇到麻烦，因为这些是估计数字而不是真实数字。所以只要确保你使用的数据类型是真正的十进制类型而不是浮点十进制类型，你应该没问题。

* * *

## 回答 #21

> 赞同：-4
> 
> 时间：2008-10-01T19:21:22.970

A`[FLOAT](http://dev.mysql.com/doc/refman/5.1/en/numeric-type-overview.htm)`应该为您提供所需的所有精度，并且对于比较函数来说比将每个坐标存储为字符串等更好。

如果您的 MySQL 版本早于 5.0.3，您可能需要注意某些[浮点比较错误](http://dev.mysql.com/doc/refman/4.1/en/problems-with-float.html)。

> 在 MySQL 5.0.3 之前，DECIMAL 列以精确的精度存储值，因为它们表示为字符串，但 DECIMAL 值的计算是使用浮点运算完成的。从 5.0.3 开始，MySQL 以 64 位十进制数字的精度执行 DECIMAL 操作，这应该解决涉及 DECIMAL 列时最常见的不准确问题

# javascript - Javascript 中的跨浏览器 Flash 检测

> ID：159261
> 
> 赞同：97
> 
> 时间：2008-10-01T19:19:30.867
> 
> 标签：javascript, flash, cross-browser

有没有人有一个脚本示例可以在 IE/Firefox 上可靠地工作，以检测浏览器是否能够显示嵌入的 Flash 内容。我说可靠是因为我知道它不可能 100% 的时间。

* * *

## 回答 #1

> 赞同：110
> 
> 时间：2010-12-30T19:29:15.793

我同意[马克斯·斯图尔特](https://stackoverflow.com/questions/159261/cross-browser-flash-detection-in-javascript/159374#159374)的观点。 [SWFObject](https://github.com/swfobject/swfobject)是要走的路。我想用一个代码示例来补充他的答案。这应该让你开始：

确保您已包含该`swfobject.js`文件（在[此处](https://github.com/swfobject/swfobject/releases)获取）：

```
<script type="text/javascript" src="swfobject.js"></script> 
```

然后像这样使用它：

```
if(swfobject.hasFlashPlayerVersion("9.0.115"))
{
    alert("You have the minimum required flash version (or newer)");
}
else
{
    alert("You do not have the minimum required flash version");
} 
```

用您需要的任何最低闪存版本替换“9.0.115”。我选择 9.0.115 作为示例，因为这是添加了 h.264 支持的版本。

如果访问者没有 flash，它会报告一个 flash 版本“0.0.0”，所以如果你只是想知道他们是否有 flash，使用：

```
if(swfobject.hasFlashPlayerVersion("1"))
{
    alert("You have flash!");
}
else
{
    alert("You do not flash :-(");
} 
```

* * *

## 回答 #2

> 赞同：94
> 
> 时间：2008-10-01T19:44:52.307

[SWFObject](https://github.com/swfobject/swfobject)非常可靠。我已经使用它很长一段时间没有麻烦了。

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2011-03-01T19:14:50.767

我知道这是一个旧帖子，但我一直在寻找一段时间，并没有找到任何东西。
我已经实现了[JavaScript Flash 检测库](http://www.featureblend.com/javascript-flash-detection-library.html)。它工作得很好，并记录在案以供快速使用。它确实花了我2分钟。这是我在标题中编写的代码：

```
<script src="Scripts/flash_detect.js"></script>
<script type="text/javascript"> 
 if (!FlashDetect.installed) {
    alert("Flash is required to enjoy this site.");         
 } else {
    alert("Flash is installed on your Web browser.");
 }
</script> 
```

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2012-03-26T01:41:59.583

您可以使用[闭包编译器](http://closure-compiler.appspot.com/home)生成一个小的跨浏览器闪存检测：

```
// ==ClosureCompiler==
// @compilation_level ADVANCED_OPTIMIZATIONS
// @output_file_name default.js
// @formatting pretty_print
// @use_closure_library true
// ==/ClosureCompiler==

// ADD YOUR CODE HERE
goog.require('goog.userAgent.flash');
if (goog.userAgent.flash.HAS_FLASH) {
    alert('flash version: '+goog.userAgent.flash.VERSION);
}else{
    alert('no flash found');
} 
```

这导致以下“编译”代码：

```
var a = !1,
    b = "";

function c(d) {
    d = d.match(/[\d]+/g);
    d.length = 3;
    return d.join(".")
}
if (navigator.plugins && navigator.plugins.length) {
    var e = navigator.plugins["Shockwave Flash"];
    e && (a = !0, e.description && (b = c(e.description)));
    navigator.plugins["Shockwave Flash 2.0"] && (a = !0, b = "2.0.0.11")
} else {
    if (navigator.mimeTypes && navigator.mimeTypes.length) {
        var f = navigator.mimeTypes["application/x-shockwave-flash"];
        (a = f && f.enabledPlugin) && (b = c(f.enabledPlugin.description))
    } else {
        try {
            var g = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7"),
                a = !0,
                b = c(g.GetVariable("$version"))
        } catch (h) {
            try {
                g = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"), a = !0, b = "6.0.21"
            } catch (i) {
                try {
                    g = new ActiveXObject("ShockwaveFlash.ShockwaveFlash"), a = !0, b = c(g.GetVariable("$version"))
                } catch (j) {}
            }
        }
    }
}
var k = b;
a ? alert("flash version: " + k) : alert("no flash found"); 
```

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2012-10-15T19:03:47.780

我用过的最低版本（不检查版本，只检查 Flash 插件）：

```
var hasFlash = function() {
    return (typeof navigator.plugins == "undefined" || navigator.plugins.length == 0) ? !!(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")) : navigator.plugins["Shockwave Flash"];
}; 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-02T04:08:50.517

Carl Yestrau 的 JavaScript Flash 检测库，在这里：

[http://www.featureblend.com/javascript-flash-detection-library.html](http://www.featureblend.com/javascript-flash-detection-library.html)

...可能是您正在寻找的。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-10-01T19:28:27.383

也许 adobe 的 Flash 播放器检测工具包在这里会有所帮助？

[http://www.adobe.com/products/flashplayer/download/detection_kit/](http://www.adobe.com/products/flashplayer/download/detection_kit/)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-10-14T03:01:19.457

在 Web 文档中检测和嵌入 Flash 是一项非常困难的任务。

我对 SWFObject 和 Adob​​e 的解决方案生成的质量和不符合标准的标记感到非常失望。此外，我的测试发现 Adob​​e 的自动更新程序不一致且不可靠。

[JavaScript Flash 检测库 (Flash Detect)](http://featureblend.com/javascript-flash-detection-library.html)和[JavaScript Flash HTML 生成器库 (Flash TML)](http://featureblend.com/javascript-flash-html-generator-library.html)是一种清晰、可维护且符合标准的标记解决方案。

-“卢克阅读了源代码！”

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2013-03-02T11:37:34.787

一个线性`isFlashExists`变量的代码：

```
<script type='text/javascript'
    src='//ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js'> </script>

<script type='text/javascript'>
   var isFlashExists = swfobject.hasFlashPlayerVersion('1') ? true : false ;
   if (isFlashExists) {
    alert ('flash exists');
   } else {
    alert ('NO flash');
   }
</script> 
```

请注意，还有这样的替代方案：`swfobject.getFlashPlayerVersion();`

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-01T22:08:34.817

[在http://whatsmy.browsersize.com](http://whatsmy.browsersize.com)查看源代码（第 14-120 行）。

[这是jsbin 上仅](http://jsbin.com/aqubiq/4/edit)用于**Flash 检测**的抽象跨浏览器代码，适用于：FF/IE/Safari/Opera/Chrome。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-10-03T10:10:00.547

关于什么：

```
var hasFlash = function() {
    var flash = false;
    try{
        if(new ActiveXObject('ShockwaveFlash.ShockwaveFlash')){
            flash=true;
        }
    }catch(e){
        if(navigator.mimeTypes ['application/x-shockwave-flash'] !== undefined){
            flash=true;
        }
    }
    return flash;
}; 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2014-03-30T00:54:57.650

如果您对纯 Javascript 解决方案感兴趣，这是我从[Brett](http://www.blangdon.com/writing/about/detect-flash-with-javascript/)复制的一个：

```
function detectflash(){
    if (navigator.plugins != null && navigator.plugins.length > 0){
        return navigator.plugins["Shockwave Flash"] && true;
    }
    if(~navigator.userAgent.toLowerCase().indexOf("webtv")){
        return true;
    }
    if(~navigator.appVersion.indexOf("MSIE") && !~navigator.userAgent.indexOf("Opera")){
        try{
            return new ActiveXObject("ShockwaveFlash.ShockwaveFlash") && true;
        } catch(e){}
    }
    return false;
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-03-11T19:17:18.267

如果您只是想检查是否启用了 flash，这应该足够了。

```
function testFlash() {

    var support = false;

    //IE only
    if("ActiveXObject" in window) {

        try{
            support = !!(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"));
        }catch(e){
            support = false;
        }

    //W3C, better support in legacy browser
    } else {

        support = !!navigator.mimeTypes['application/x-shockwave-flash'];

    }

    return support;

} 
```

注意：避免勾选**enabledPlugin**，部分手机浏览器有点击开启 flash 插件，会触发误报。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-07-11T15:57:52.187

要创建符合标准的 Flash 对象（但是使用 JavaScript），我建议您查看

不显眼的闪光物体 (UFO)

[http://www.bobbyvandersluis.com/ufo/index.html](http://www.bobbyvandersluis.com/ufo/index.html)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-04-23T07:31:30.157

创建了一个小`.swf`的重定向。如果浏览器启用了 Flash，它将重定向。

```
package com.play48.modules.standalone.util;

import flash.net.URLRequest;

class Redirect {

static function main() {

    flash.Lib.getURL(new URLRequest("http://play48.com/flash.html"), "_self");

}

} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-04-04T00:46:50.583

使用 Google Closure 编译器 goog.require('goog.userAgent.flash') 库我创建了这 2 个函数。

**布尔 hasFlash()**

如果浏览器有 flash，则返回。

```
function hasFlash(){
    var b = !1;
    function c(a) {if (a = a.match(/[\d]+/g)) {a.length = 3;}}
    (function() {
    if (navigator.plugins && navigator.plugins.length) {
        var a = navigator.plugins["Shockwave Flash"];
        if (a && (b = !0, a.description)) {c(a.description);return;}
        if (navigator.plugins["Shockwave Flash 2.0"]) {b = !0;return;}
    }
    if (navigator.mimeTypes && navigator.mimeTypes.length && (a = navigator.mimeTypes["application/x-shockwave-flash"], b = !(!a || !a.enabledPlugin))) {c(a.enabledPlugin.description);return;}
    if ("undefined" != typeof ActiveXObject) {
        try {
            var d = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");b = !0;c(d.GetVariable("$version"));return;
        } catch (e) {}
        try {
            d = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");b = !0;
            return;
        } catch (e) {}
        try {
            d = new ActiveXObject("ShockwaveFlash.ShockwaveFlash"), b = !0, c(d.GetVariable("$version"));
        } catch (e) {}
    }
    })();
    return b;
} 
```

**boolean isFlashVersion(版本)**

如果 flash 版本大于提供的版本，则返回

```
function isFlashVersion(version) {
    var e = String.prototype.trim ? function(a) {return a.trim()} : function(a) {return /^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};
    function f(a, b) {return a < b ? -1 : a > b ? 1 : 0};
    var h = !1,l = "";
    function m(a) {a = a.match(/[\d]+/g);if (!a) {return ""}a.length = 3;return a.join(".")}
    (function() {
        if (navigator.plugins && navigator.plugins.length) {
            var a = navigator.plugins["Shockwave Flash"];
            if (a && (h = !0, a.description)) {l = m(a.description);return}
            if (navigator.plugins["Shockwave Flash 2.0"]) {h = !0;l = "2.0.0.11";return}
        }
        if (navigator.mimeTypes && navigator.mimeTypes.length && (a = navigator.mimeTypes["application/x-shockwave-flash"], h = !(!a || !a.enabledPlugin))) {l = m(a.enabledPlugin.description);return}
        if ("undefined" != typeof ActiveXObject) {
            try {
                var b = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");h = !0;l = m(b.GetVariable("$version"));return
            } catch (g) {}
            try {
                b = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");h = !0;l = "6.0.21";return
            } catch (g) {}
            try {
                b = new ActiveXObject("ShockwaveFlash.ShockwaveFlash"), h = !0, l = m(b.GetVariable("$version"))
            } catch (g) {}
        }
    })();
    var n = l;
    return (function(a) {
        var b = 0,g = e(String(n)).split(".");
        a = e(String(a)).split(".");
        for (var p = Math.max(g.length, a.length), k = 0; 0 == b && k < p; k++) {
            var c = g[k] || "",d = a[k] || "";
            do {
                c = /(\d*)(\D*)(.*)/.exec(c) || ["", "", "", ""];d = /(\d*)(\D*)(.*)/.exec(d) || ["", "", "", ""];
                if (0 == c[0].length && 0 == d[0].length) {break}
                b = f(0 == c[1].length ? 0 : parseInt(c[1], 10), 0 == d[1].length ? 0 : parseInt(d[1], 10)) || f(0 == c[2].length, 0 == d[2].length) || f(c[2], d[2]);c = c[3];d = d[3]
            } while (0 == b);
        }
        return 0 <= b
    })(version)
} 
```

# delphi - 寻求一种方法让“悬停按钮”展开一个部分

> ID：159262
> 
> 赞同：2
> 
> 时间：2008-10-01T19:19:49.417
> 
> 标签：delphi, components

我有一个流程面板，我在运行时根据他们是否选择显示所有项目向它添加额外的项目。这一切都很好；扩展由工具栏按钮控制。

问题是我们希望用户能够将鼠标移到“+”号上以展开该部分。

![替代文字](https://i.stack.imgur.com/TRHTG.gif)

最初我查看了 TSpeedButton (OnMouseEnter)，但即使它是“平面”，焦点矩形仍然显示，因此字形没有居中。这个解决方案的主要问题是它的外观。

然后我看着制作 TImage 的后代。这有点“非常规”，但它会起作用。在 OnMouseEnter 或 OnClick 中，它会切换一个内部布尔“扩展”标志，然后从资源中加载适当的图片。我不喜欢这样的非常规解决方案。

我需要将它添加到几个不同的屏幕，所以我可能谨慎地为此拥有/构建一个组件。我有 JVCL，但我没有看到任何合适的副手。

感谢您的意见/帮助！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-02T05:56:21.960

我一直很喜欢[ModelMaker Code Explorer](http://www.modelmakertools.com/code-explorer/index.html)使用的方法。

例如，当您添加新方法时，一些很少使用的东西会折叠显示（下图中的“选项和指令”）。

[![替代文字](https://i.stack.imgur.com/E6mre.png)](https://i.stack.imgur.com/E6mre.png)
[（来源：[17slon.com](http://17slon.com/krama/expand-mmx-1.png)）]

当您将鼠标悬停在文本上时，您会注意到它实际上是一个平面按钮。（除了它不是——我相信 Gerrit 在这里做了一些定制的绘画魔法）。

[![替代文字](https://i.stack.imgur.com/8OLTX.png)](https://i.stack.imgur.com/8OLTX.png)
[（来源：[17slon.com](http://17slon.com/krama/expand-mmx-2.png)）]

单击此按钮时，将出现一个面板。按钮仍然存在，但带有新图像。您可以单击它来关闭面板。

[![替代文字](https://i.stack.imgur.com/dPr72.png)](https://i.stack.imgur.com/dPr72.png)
[（来源：[17slon.com](http://17slon.com/krama/expand-mmx-3.png)）]

此切换按钮的状态在会话之间保留。IOW，即使您重新启动 Delphi，下次您调用“添加方法”时，“选项和指令”面板也会与您上次离开时​​完全一样。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T22:37:32.217

> 我不喜欢这样的非常规解决方案。

在过去的几年里，我对非传统的*UI*解决方案产生了一点怀疑——这就是你在这里创造的东西。为什么不直接使用用户实际必须*点击*的按钮？这似乎在我使用的软件中更为常见，无论是 MS Office 还是编程实用程序。另外，我会让按钮稍微大一些：在屏幕截图中，它看起来真的是一个很小的东西，你必须用鼠标光标定位。哦，好吧，如果我用你根本没有要求的建议来打扰你，为什么不给它“>>”作为标题而不是“+”呢？如果你也给它一个带有助记符的文本标题，它实际上是可以通过键盘访问的。所有这些都应该使您的 UI 更好、更直观。我猜。

对于没有回答您的问题，我深表歉意，但我希望您能花 2 分钟时间思考您的用户是否真的更喜欢这个解决方案 :-)

祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T21:48:15.050

实际上，我认为在这种情况下使用 TImage 是非常传统的。我看到很多人建议使用 TImage，但无论是 TButton 还是它的任何伙伴都没有对开发人员试图做的任何事情进行适当的控制。

你试过 TBitBtn 吗？我认为当您摆脱文本时，它会以您与之关联的任何图像为中心。我刚刚签入了我在这台机器上安装的所有 Delphi 6，它有 MouseMove 事件。

# apache-flex - 在 Flash 中，当 e4x 语句存储在字符串中时，我将如何运行该语句？

> ID：159266
> 
> 赞同：3
> 
> 时间：2008-10-01T19:20:09.807
> 
> 标签：apache-flex, flash, actionscript-3

所以我有这样的事情：

```
var xmlStatement:String = "xmlObject.node[3].@thisValue"; 
```

我必须使用什么神秘函数才能执行 xmlStatement 并从该 xmlObject 获取 thisValue？像....

```
var attribute:String = mysteryFunction(xmlStatement); 
```

PS 我知道 eval() 适用于 actionscript2，我需要 as3 解决方案。:)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T19:37:34.180

不幸的是，这在 ActionScript 3 中是不可能的。但这可能是一个解决方案： http: [//blog.betabong.com/2008/09/23/e4x-string-parser/](http://blog.betabong.com/2008/09/23/e4x-string-parser/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-07T12:53:41.493

对于您的示例，它将是： var attribute : String = String( E4X.evaluate( XMLList(xmlobject) , 'node[3].@thisValue' ) );

# iphone - OCUnit 和 OCMock 可以在 iPhone SDK 上工作吗？

> ID：159280
> 
> 赞同：19
> 
> 时间：2008-10-01T19:22:46.337
> 
> 标签：iphone, objective-c, cocoa, unit-testing, mocking

我根本无法让它工作，我想知道我是在浪费时间，还是我只是愚蠢！

抱歉，我现在没有确切的错误。但我只想知道它是否有效！

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-03T16:45:15.320

我不知道 OCUnit 是否适用于 iPhone，但Google Code 提供了一个[iPhoneUnitTesting框架。](http://code.google.com/p/google-toolbox-for-mac/wiki/iPhoneUnitTesting)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-14T19:01:11.787

Colin Barrett 有一篇关于[OCMock 和 iPhone](http://iamthewalr.us/blog/2008/11/10/ocmock-and-the-iphone/)的博客文章。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-14T16:43:29.553

不太确定 OCMock，但 OCUnit 支持现在包含在 iPhone 2.2 SDK 中。

[您可以从Stanford iPhone Application Programming CS193P](http://www.stanford.edu/class/cs193p/cgi-bin/index.php) Lecture 19下载示例应用程序。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-18T15:30:31.067

Sen:te（框架的创建者）解释了如何在 iPhone 项目中使用 OCUnit：[http](http://www.sente.ch/s/?p=535&lang=en) ://www.sente.ch/s/?p=535&lang=en 。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-03T19:31:27.073

我为 iPhone 应用程序创建了一些 OCUnit 测试，但为了运行测试，我必须为 Mac OS X 而不是 iPhone OS 编译，并且来回切换很痛苦。

谷[歌框架](http://code.google.com/p/google-toolbox-for-mac/wiki/iPhoneUnitTesting)更干净，他们可以在模拟器或设备上运行测试。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-16T14:44:38.617

我挂断了同样的事情。[我终于在米奇的世界](http://mitchellhashimoto.com/using-ocmock-with-xcode-3-in-leopard/)上找到了答案，然后在[我的网站](http://codeforfun.wordpress.com/2008/10/16/ocmock-works-in-an-iphone-project/)上重新发布了解决方案。快速解决方法是将 OCMock.framework 文件夹添加到 /Library/frameworks 并从那里引用它。无论出于何种原因，XCode 都不想将其自然框架之外的文件夹添加到路径中。直到我发现更多，这是我们能做的最好的。

-悬崖

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-12-28T23:01:27.227

在编写 OCUnit 在 iPhone 上“正常工作”时。Apple 正在提供开箱即用的模板。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-12-05T17:31:49.347

看看[这里](http://blog.carbonfive.com/2009/05/testing/custom-xcode-template-for-iphone-development)。你会找到一个可以使用的 Xcode 模板，它已经为你准备好了 OCUnit 和 OCMock。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-12-29T14:09:56.947

您可能对这个集成 OCMock 和 gh-unit 的项目感兴趣（基于 Google 工具包）

[单元测试](http://github.com/JohannesRudolph/gh-unit)

# java - Java RMI：客户端安全策略

> ID：159282
> 
> 赞同：2
> 
> 时间：2008-10-01T19:23:14.307
> 
> 标签：java, security, rmi

```
grant {
    permission java.security.AllPermission;
}; 
```

这行得通。

```
grant file:///- {
    permission java.security.AllPermission;
}; 
```

这不起作用。有人可以向我解释为什么吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T13:59:08.133

语法应该是：

```
授予 codeBase "file:///-" {
   ...
};
```

请参阅[文档](http://java.sun.com/javase/6/docs/technotes/guides/security/PolicyFiles.html)。注意分号。

为代码分配权限时要非常小心。

您确定代码库应该是文件 URL（正常用于开发，不适用于生产......）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T21:14:33.183

The directive "grant { permission }" means grant the permission to all code no matter where it came from. In other words, when there is no codebase specified, the code could be loaded from the network or the file system.

The second directive (if it worked) would only apply to the local file system. It would be specifying all files (recursively) on the local file system. I'm not sure that "file:///" is a valid URL by itself. I know that `file:///tmp/-` works.

# apache - 如何为 Apache Velocity 创建自定义指令

> ID：159292
> 
> 赞同：6
> 
> 时间：2008-10-01T19:26:39.713
> 
> 标签：apache, velocity

我正在使用 Apache 的 Velocity 模板引擎，我想创建一个自定义指令。也就是说，我希望能够编写“#doMyThing()”并让它调用我编写的一些 java 代码以生成文本。

我知道我可以通过添加一行来注册自定义指令

```
userdirective=my.package.here.MyDirectiveName 
```

到我的velocity.properties 文件。而且我知道我可以通过扩展[Directive 类来编写这样的类](http://svn.apache.org/repos/asf/velocity/engine/trunk/velocity-engine-core/src/main/java/org/apache/velocity/runtime/directive/Directive.java)。我不知道*如何*扩展 Directive 类——新指令作者的某种文档。例如，我想知道我的 getType() 方法是返回“BLOCK”还是“LINE”，并且我想知道我的 setLocation() 方法应该做什么？

有没有比“[使用源代码，卢克](http://www.catb.org/jargon/html/U/UTSL.html)”更好的文档？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-09-10T18:57:51.333

我整理了[一篇](http://www.sergiy.ca/how-to-create-custom-directives-for-apache-velocity/)关于编写自定义速度指令（和工具）的小文章。也许有人会发现它很有用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-07-09T20:47:55.913

还试图提出一个自定义指令。根本找不到任何文档，所以我查看了一些用户创建的指令：[If​​NullDirective](http://wiki.apache.org/velocity/IfNullDirective)（一个不错且简单的指令）、[MergeDirective](https://web.archive.org/web/20071009224557/http://wiki.apache.org:80/velocity/MergeDirective)以及速度内置指令。

这是我返回压缩内容的简单块指令（带有一些指令安装说明的完整项目位于[此处](http://code.google.com/p/htmlcompressor/)）：

```
import java.io.IOException;
import java.io.StringWriter;
import java.io.Writer;

import org.apache.velocity.context.InternalContextAdapter;
import org.apache.velocity.exception.MethodInvocationException;
import org.apache.velocity.exception.ParseErrorException;
import org.apache.velocity.exception.ResourceNotFoundException;
import org.apache.velocity.exception.TemplateInitException;
import org.apache.velocity.runtime.RuntimeServices;
import org.apache.velocity.runtime.directive.Directive;
import org.apache.velocity.runtime.parser.node.Node;
import org.apache.velocity.runtime.log.Log;

import com.googlecode.htmlcompressor.compressor.HtmlCompressor;

/**
 * Velocity directive that compresses an HTML content within #compressHtml ... #end block.
 */
public class HtmlCompressorDirective extends Directive {

    private static final HtmlCompressor htmlCompressor = new HtmlCompressor();

    private Log log;

    public String getName() {
        return "compressHtml";
    }

    public int getType() {
        return BLOCK;
    }

    @Override
    public void init(RuntimeServices rs, InternalContextAdapter context, Node node) throws TemplateInitException {
        super.init(rs, context, node);
        log = rs.getLog();

        //set compressor properties
        htmlCompressor.setEnabled(rs.getBoolean("userdirective.compressHtml.enabled", true));
        htmlCompressor.setRemoveComments(rs.getBoolean("userdirective.compressHtml.removeComments", true));
    }

    public boolean render(InternalContextAdapter context, Writer writer, Node node) 
            throws IOException, ResourceNotFoundException, ParseErrorException, MethodInvocationException {

        //render content to a variable
        StringWriter content = new StringWriter();
        node.jjtGetChild(0).render(context, content);

        //compress
        try {
            writer.write(htmlCompressor.compress(content.toString()));
        } catch (Exception e) {
            writer.write(content.toString());
            String msg = "Failed to compress content: "+content.toString();
            log.error(msg, e);
            throw new RuntimeException(msg, e);

        }
        return true;

    }

} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-08-09T16:20:06.067

在 Velocity wiki 上，有一个演示文稿和示例代码，来自我发表的名为“ [Hacking Velocity](https://wiki.apache.org/velocity/HackingVelocity) ”的演讲。它包括一个自定义指令的示例。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-17T22:52:59.723

块指令总是接受一个主体，并且在模板中使用时必须以 #end 结尾。例如 #foreach( $i in $foo ) 这有一个主体！＃结尾

行指令没有正文或#end。例如#parse('foo.vtl')

您根本不需要同时使用 setLocation() 。解析器使用它。

还有什么我可以帮忙的细节吗？

另外，您是否考虑过使用“工具”方法？即使您不使用 VelocityTools 来自动使您的工具可用等等，您也可以创建一个工具类来执行您想要的操作，将其放在上下文中，或者有一个您调用的方法来生成内容，或者只是拥有它toString() 方法生成内容。例如 $tool.doMyThing() 或只是 $myThing

指令最适合需要处理 Velocity 内部（访问 InternalContextAdapter 或实际节点）的情况。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-18T14:20:25.190

在velocity v1.6 之前，我有一个#blockset($v)#end 指令来处理多行#set($v)，但是这个函数现在由#define 指令处理。自定义块指令对于现代 IDE 来说是个难题，因为它们无法正确解析结构，假设与 #userBlockDirective 关联的 #end 是额外的，并且会将整个文件涂成红色。如果可能，应避免使用它们。

我从速度源代码中复制了类似的内容并创建了一个“blockset”（多行）指令。

```
import org.apache.velocity.runtime.directive.Directive;
import org.apache.velocity.runtime.RuntimeServices;
import org.apache.velocity.runtime.parser.node.Node;
import org.apache.velocity.context.InternalContextAdapter;
import org.apache.velocity.exception.MethodInvocationException;
import org.apache.velocity.exception.ResourceNotFoundException;
import org.apache.velocity.exception.ParseErrorException;
import org.apache.velocity.exception.TemplateInitException;

import java.io.Writer;
import java.io.IOException;
import java.io.StringWriter;

public class BlockSetDirective extends Directive {
    private String blockKey;

    /**
     * Return name of this directive.
     */
    public String getName() {
        return "blockset";
    }

    /**
     * Return type of this directive.
     */
    public int getType() {
        return BLOCK;
    }

    /**
     * simple init - get the blockKey
     */
    public void init( RuntimeServices rs, InternalContextAdapter context,
                      Node node )
        throws TemplateInitException {
        super.init( rs, context, node );
        /*
         * first token is the name of the block. I don't even check the format,
         * just assume it looks like this: $block_name. Should check if it has
         * a '$' or not like macros.
         */
        blockKey = node.jjtGetChild( 0 ).getFirstToken().image.substring( 1 );
    }

    /**
     * Renders node to internal string writer and stores in the context at the
     * specified context variable
     */
    public boolean render( InternalContextAdapter context, Writer writer,
                           Node node )
        throws IOException, MethodInvocationException,
        ResourceNotFoundException, ParseErrorException {
        StringWriter sw = new StringWriter(256);
        boolean b = node.jjtGetChild( 1 ).render( context, sw );
        context.put( blockKey, sw.toString() );
        return b;
    }

} 
```

# c# - 如何防止 C# 中的继承者调用基本构造函数？

> ID：159296
> 
> 赞同：28
> 
> 时间：2008-10-01T19:28:25.463
> 
> 标签：c#, oop, inheritance, proxy, constructor

我有一个（写得不好）基类，我想将它包装在一个代理对象中。基类类似于以下内容：

```
public class BaseClass : SomeOtherBase 
{
   public BaseClass() {}

   public BaseClass(int someValue) {}

   //...more code, not important here
} 
```

而且，我的代理类似于：

```
public BaseClassProxy : BaseClass
{
  public BaseClassProxy(bool fakeOut){}
} 
```

如果没有“fakeOut”构造函数，则预计会调用基本构造函数。但是，有了它，我希望它不会被调用。无论哪种方式，我要么需要一种不调用任何基类构造函数的方法，要么需要某种其他方法来有效地代理这个（邪恶的）类。

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2008-10-01T22:20:24.817

有一种方法可以在不调用*任何*实例构造函数的情况下创建对象。

在您继续之前，请确保您想以这种方式进行操作。99% 的情况下这是错误的解决方案。

这就是你的做法：

```
FormatterServices.GetUninitializedObject(typeof(MyClass)); 
```

调用它来代替对象的构造函数。它将创建并返回一个实例，而无需调用任何构造函数或字段初始值设定项。

当您在 WCF 中反序列化对象时，它使用此方法来创建对象。发生这种情况时，构造函数甚至字段初始值设定项都不会运行。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-10-01T19:35:06.977

如果没有显式调用基类中的任何构造函数，则将隐式调用无参数构造函数。没有办法解决它，如果没有调用构造函数，就无法实例化一个类。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-01T19:34:52.080

必须调用至少 1 个 ctor。我看到的唯一解决办法就是收容。将类放在内部或引用其他类。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-01T19:38:27.860

我不相信你可以绕过调用构造函数。但你可以这样做：

```
public class BaseClass : SomeOtherBase 
{
   public BaseClass() {}

   protected virtual void Setup()
   {
   }
}

public BaseClassProxy : BaseClass
{
   bool _fakeOut;
   protected BaseClassProxy(bool fakeOut)
   {
        _fakeOut = fakeOut;
        Setup();
   }

   public override void Setup()
   {
       if(_fakeOut)
       {
            base.Setup();
       }
       //Your other constructor code
   }
} 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-01T19:53:46.323

如果您想要**不**调用两个基类构造函数中的任何一个，则无法执行此操作。

C# 类构造函数必须调用基类构造函数。如果你不明确地调用一个，***base()*是隐含的**。在您的示例中，如果您未指定要调用哪个基类构造函数，则与以下内容相同：

```
public BaseClassProxy : BaseClass
{
    public BaseClassProxy() : base() { }
} 
```

如果您更喜欢使用其他基类构造函数，您可以使用：

```
public BaseClassProxy : BaseClass
{
    public BaseClassProxy() : base(someIntValue) { }
} 
```

无论哪种方式，**都将**显式或隐式调用两者之一。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T19:35:12.547

我害怕不调用构造函数不是选项。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-01T19:35:32.857

当您创建 BaseClassProxy 对象时，它需要创建其基类的实例，因此您需要调用基类构造函数，您可以选择调用哪个，例如：

```
public BaseClassProxy (bool fakeOut) : base (10) {} 
```

调用第二个构造函数而不是第一个构造函数

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T19:58:29.357

我最终做了这样的事情：

```
public class BaseClassProxy : BaseClass 
{
   public BaseClass BaseClass { get; private set; }

   public virtual int MethodINeedToOverride(){}
   public virtual string PropertyINeedToOverride() { get; protected set; }
} 
```

这让我了解了基类的一些不良做法。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-11-21T11:37:24.410

构造函数本质上是公共的。不要使用构造函数并使用另一个构造函数并将其设为私有。因此您将创建一个没有参数的实例并调用该函数来构造您的对象实例。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-03-29T20:11:24.543

**好吧，对于一个类继承另一个类的构造函数的问题，这是一个丑陋的解决方案，我不想让它们中的一些工作。**我希望避免在我的课堂上使用它，但这里是：

**这是我的类构造函数：**

```
public MyClass();
{
   throw new Exception("Error: Must call constructor with parameters.");
} 
```

**好的，现在你被警告说它很丑。请不要抱怨！**

我想至少从我的主构造函数中强制使用最小参数，而不允许继承的没有参数的基本构造函数。

**我也相信，如果您创建一个构造函数并且不将 : base() 放在它之后，它将不会调用基类构造函数。**而且，如果您为基类中的所有构造函数创建构造函数，并在主类中为它们提供完全相同的参数，则它不会通过。但如果基类中有很多构造函数，这可能会很乏味！

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-07-15T06:17:18.410

可以在不调用无参数构造函数的情况下创建对象（参见上面的答案）。但是我使用这样的代码来创建一个基类和一个继承类，在其中我可以选择是否执行基类的init。

```
public class MyClass_Base
{
    public MyClass_Base() 
    {
        /// Don't call the InitClass() when the object is inherited
        /// !!! CAUTION: The inherited constructor must call InitClass() itself when init is needed !!!
        if (this.GetType().IsSubclassOf(typeof(MyClass_Base)) == false)
        {
            this.InitClass();
        }
    }

    protected void InitClass()
    {
        // The init stuff
    }
}

public class MyClass : MyClass_Base
{
    public MyClass(bool callBaseClassInit)
    {
        if(callBaseClassInit == true)
            base.InitClass();
    }
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-10-01T07:42:29.987

这是我对问题的解决方案

```
using System;

public class Program
{
    public static void Main()
    {
        Console.WriteLine(new Child().Test);
    }

    public class Child : Parent {
        public Child() : base(false) {
            //No Parent Constructor called
        }
    }
    public class Parent {
        public int Test {get;set;}
        public Parent()
        {
            Test = 5;
        }
        public Parent(bool NoBase){
            //Don't do anything
        }
    }
} 
```

一个简单优雅的解决方案。您可以根据需要进行更改。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-01-16T18:16:18.887

我的另一个简单解决方案：

```
class parent
{
    public parent()
    {
        //code for all children

        if (this.GetType() == typeof(child1))
        {
            //code only for objects of class "child1"
        }
        else
        {
            //code for objects of other child classes
        }
    }
}

class child1 : parent
{
    public child1()
    {}
}

// class child2: parent ... child3 : parent ... e.t.c 
```

# c++ - 你如何为 x64 编译静态 pthread-win32 库？

> ID：159298
> 
> 赞同：5
> 
> 时间：2008-10-01T19:28:40.597
> 
> 标签：c++, c, windows, 64-bit, pthreads

看起来已经做了一些工作来使[pthread-win32](http://sourceware.org/pthreads-win32/)与 x64 一起工作，但没有构建说明。我尝试使用 Visual Studio x64 交叉工具命令提示符进行简单构建，但是当我尝试从 x64 应用程序链接到 lib 时，它看不到任何函数导出。似乎它仍在将 lib 编译为 x86 或其他东西。

我什至尝试在适当的地方将 /MACHINE 添加到 makefile 中，但这没有帮助。有没有人让这个工作？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2013-05-06T13:06:43.153

对我来说，我只使用 64 位 windows 编译器（在这种特殊情况下为 mingw-w64 交叉编译器）然后 make (with2.9.1) 像：

```
$ make clean GC-static 
```

然后我如何安装它以供使用（当然，其中一些可能不需要），

```
cp libpthreadGC2.a $mingw_w64_x86_64_prefix/lib/libpthread.a
cp pthread.h sched.h semaphore.h $mingw_w64_x86_64_prefix/include 
```

然后要使用它，您必须定义它（例如 ffmpeg 配置行以使用它）：

```
--extra-cflags=-DPTW32_STATIC_LIB 
```

无论如何，这是一种方式。

另一种方法是执行相同操作，然后修改 *.h 文件并从标头中删除对 dllexport 的所有引用（或在标头中手动定义 DPTW32_STATIC_LIB）。

前任：

```
 sed 's/ __declspec (dllexport)//g;s/ __declspec (dllimport)//g' 
```

（参考：zeranoe 构建脚本）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2020-08-05T13:21:23.410

您可以在[此处使用](https://docs.microsoft.com/en-us/cpp/build/vcpkg?view=vs-2019)**vcpkg** 。这是 C++ 的 Windows 包管理器。它支持 pthread 构建以及其他开源库。

我想使用静态 pthread 库。当我下载 pthread 时，我得到了 dll(pthread.dll) 并导入了 lib(pthread.lib)，即我不能只使用 pthread.lib，我必须使用 pthread.dll 文件。

所以使用 vcpkg 我已经构建了静态库。我可以在没有任何 dll 依赖项的情况下使用它

使用“vcpkg”，您可以构建静态库和动态库

**您可以使用以下步骤**

下面我添加了所有 DLL (x86|x64) 和 LIB (x86|x64) 案例的步骤。您可以根据需要构建它。

从 git 目录[vcpkg git repo克隆 vcpkg](https://github.com/Microsoft/vcpkg.)

从您克隆 vcpkg 的目录运行以下命令 - 这将安装 vcpkg

```
bootstrap - vcpkg.bat 
```

通过运行以下命令检查库的可用性

```
vcpkg search pthread 
```

这将在下面显示结果

```
mbedtls[pthreads]                     Multi-threading support
pthread              3.0.0            empty package, linking to other port
pthreads             3.0.0-6          pthreads for windows 
```

如您所见，它支持 Windows 的 pthread

**1 .Building Dynamic Library with import lib (DLL)**

**构建 x86 DLL**

```
vcpkg install pthreads:x86-windows 
```

**它将在.\vcpkg\installed\x86-windows**中构建 dll 和导入库，从这里复制**lib**并**包含**，您可以使用它们

**构建 x64 DLL**

```
vcpkg install pthreads:x64-windows 
```

**它将在.\vcpkg\installed\x64-windows**中构建 dll 和导入库，从这里复制**lib**和**包含**文件夹。

**2.构建静态库（LIB）**

**构建 x86 LIB**

```
vcpkg install pthreads:x86-windows-static 
```

**它将在.\vcpkg\installed\x86-windows-static**中构建 dll 并导入库， 从此处复制**lib**并**包含**，您可以使用它们

**构建 x64 LIB**

```
vcpkg install pthreads:x64-windows-static 
```

**它将在.\vcpkg\installed\x64-windows-static**中构建 dll 并导入库， 从此处复制**lib**和**包含**文件夹。

**注意：** 尝试使用管理员权限

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T13:29:29.437

在正式发布之前，您似乎必须查看 CVS 头才能获得该库的 2.9 版。2.9 版包含所有 x64 补丁，但如果您尝试从命令行编译静态库，仍然会遇到问题。

我知道的唯一解决方法是使用 DLL 而不是静态链接 LIB。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-07-29T20:41:18.000

这是我的做法（VS2015）。也应该适用于较旧的 Visual Studio。

1) 从 SourceForge 下载发行版 .zip
2) 解压到一个干净的文件夹 - 应该看到“pthreads.2”
3) 打开 Visual Studio 命令提示符，导航到“pthreads.2”。4）运行“nmake”，没有参数。它会生成一条帮助消息，列出您可以使用“nmake”来构建它的所有合法命令。有关更多信息，请参阅“pthreads.2\FAQ”文件，该文件解释了它们的 3 种不同风格的“清理”处理。

我建议只构建“VC”和“VC-debug”（也许是静态的）。“真正的”pthreads 是 POSIX 平台（如 Linux）上的 C 系统库，因此只有这些组合才能在 Windows 上为您提供与在 Linux、FreeBSD 等平台上完全相同的 C 错误行为。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T22:32:03.370

[此消息](http://sources.redhat.com/ml/pthreads-win32/2007/msg00008.html)可能会有所帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-01-04T12:22:40.867

要扩展 kgriffs 答案，必须再做两件事才能实际构建 64 位 DLL 而不是 32 位 DLL。

首先通过 CVS 下载最新的 pthreads（建议[在这里](https://www.man42.net/blog/2011/09/pthread-w32-for-windows-64-bit/)）

1) 使用 64 位构建工具 - 通过在命令行中加载正确的 VC 环境设置来实现（更多信息在[这里](https://msdn.microsoft.com/en-us/library/x4d2c09s.aspx)）：

`C:\Program Files (x86)\Microsoft Visual Studio 11.0\VC\vcvarsall.bat amd64`

（将 11.0 更改为您使用的任何版本）

2）因为它写在pthreads Makefile中：

> TARGET_CPU 是由 SDK 提供的 Visual Studio 命令提示符设置的环境变量（VS 2010 Express plus SDK 7.1） PLATFORM 是可以在 VS 2013 Express x64 交叉开发环境中设置的环境变量

这意味着，如果不是由 vcvars 完成（在我的情况下不是），您需要设置 TARGET_CPU 或 PLATFORM（以防我同时设置它们）：

`set TARGET_CPU=x64 set PLATFORM=x64`

3）现在是最后一步：

`nmake clean VC nmake clean VC-debug`

这将生成一个 64 位的 DLL 文件（以及正确的导入库和 PDB）。我可以验证它是否适用于 Visual Studio 2012。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-06-22T00:29:44.070

我成功地将“pthread-win32”替换为“pthreads4w” [https://sourceforge.net/projects/pthreads4w/](https://sourceforge.net/projects/pthreads4w/)`nmake` ，并使用控制台命令在 MSVC2019 中为 x64 目标编译。甚至静态链接。

# .net - 运行时可调用包装器 (RCW) 范围 - 进程或应用程序域？

> ID：159313
> 
> 赞同：6
> 
> 时间：2008-10-01T19:32:50.960
> 
> 标签：.net, com, interop, marshalling, appdomain

引用非托管 COM 对象时，运行时可调用包装器 (RCW) 的范围是什么？根据文档：

> 运行时为每个 COM 对象只创建一个 RCW，无论该对象上存在多少引用。

如果我不得不“猜测”——这个解释应该是“每个进程一个”，但真的是这样吗？任何额外的文档都将非常受欢迎。

我的应用程序在它自己的应用程序域中运行（它是 Outlook 插件），我想知道如果我在循环中使用 Marshal.ReleaseComObject(x) 直到它的计数达到 0（如推荐的那样）会发生什么。它会释放来自其他插件的引用（在同一 Outlook 进程中的其他应用程序域中运行）吗？

编辑：完美 - 现在混乱更大了。基于 2 个答案（来自 Lette 和 Ilya），我们有 2 个不同的答案。官方[MSDN 文档](http://msdn.microsoft.com/en-us/library/8bwh56xe(VS.80).aspx)说每个进程（对于版本 2.0+），但是对于版本来说它缺少这句话[。1.1 的文档](http://msdn.microsoft.com/en-us/library/8bwh56xe(VS.71).aspx)。

同时，在 Mason Bendixen 的文章中，它说它是 per appdomain。

由于他的文章很旧（2007 年 4 月），我已经给他发了一封电子邮件，要求澄清，但如果其他人必须添加一些东西，请做。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T15:59:28.097

> 在托管中，我们有一个每个应用程序域缓存将规范 IUnknowns 映射回 RCW。当 IUnknown 进入系统时（通过编组调用、通过激活、作为方法调用的返回参数等），我们检查缓存以查看 COM 对象是否已经存在 RCW。如果存在映射，则返回对现有 RCW 的引用。否则会创建一个新的 RCW 并添加一个缓存映射。

来自[梅森的博客](http://blogs.msdn.com/mbend/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-04T13:48:33.473

Ilya 引用的 Mason Bendixen 博客文章是正确的：RCW 的范围仅限于 AppDomain，而不是流程。我只能猜测[Runtime Callable Wrapper (MSDN 2.0)](http://msdn.microsoft.com/en-us/library/8bwh56xe(VS.80).aspx)文章是“随便”说的。那篇文章在一般意义上不一定是不正确的，因为最典型的是只使用单个 AppDomain 执行，但那句话在技术上并不准确。

至于你的具体问题：

> “我想知道如果我在循环中使用 Marshal.ReleaseComObject(x) 直到它的计数达到 0（如推荐的那样）会发生什么。它会释放来自其他插件的引用（在同一 Outlook 进程中的其他应用程序域中运行）？ ？”

答案取决于您如何设置加载项。一般来说，如果你不采取预防措施，那么答案是肯定的，它会影响在同一个 AppDomain 中运行的其他加载项中的引用。但是，既然您声明您是从一个单独的 AppDomain 运行的，那么，不，它不会。

有一个[COM Shim 向导版本 2.3.1](http://www.microsoft.com/downloads/details.aspx?FamilyID=3e43bf08-5008-4bb6-aa85-93c1d902470e&DisplayLang=en)，您可以使用它来隔离您的加载项。COM Shim 向导的文档可以在这里找到：[Isolating Microsoft Office Extensions with the COM Shim Wizard Version 2.3.1](http://msdn.microsoft.com/en-us/library/bb508939.aspx)。

COM Shim 向导使用反射来构建一个自定义的 COM 前端加载器，该加载器将加载项程序集加载到单独的 AppDomain 中。这在两个方面创造了安全性：

(1) 通过使用单独的自定义 COM 入口点，Microsoft Office 可以正确地将您的加载项与所有其他加载项分开识别。否则，默认情况下，所有加载项都共享相同的默认 mscoree.dll 加载程序。共享同一个加载器的问题是，如果任何加载项发生崩溃，那么 mscoree.dll 将被 Microsoft Office 识别为问题的根源，并且下次不会自动加载它。您可以手动重新开启，但下次您的加载项不会因为别人加载项的问题而自动加载！

(2) 通过在单独的 AppDomain 中加载程序集，运行时可调用包装器 (RCW) 与加载到同一进程中的其他加载项隔离。在这种情况下，如果您调用 Marshal.ReleaseComObject(object) 或 Marshal.FinalReleaseComObject(object)，那么您不会影响其他任何人的加载项。更重要的是，如果任何其他加载项进行此类调用，那么您的加载项将受到保护，不会被损坏。:-)

使用 COM Shim 向导的缺点是，在单独的 AppDomain 之外进行操作会产生额外的编组开销。我不认为这对于 Microsoft Outlook 加载项应该很明显。然而，对于一些对对象模型有大量调用的密集例程来说，这可能是一个因素，例如 Microsoft Excel 加载项有时就是这种情况。

您声明您已经从一个单独的 AppDomain 运行您的加载项。如果这是真的，那么您已经与其他 AppDomain 的 Marshal.ReleaseComObject(object) 和 Marshal.FinalReleaseComObject(object) 调用隔离开来。（顺便说一句，我很好奇你是如何做到这一点的......你是在明确创建自己的 AppDomain 吗？Visual Studio 中的默认加载项模板*不在*单独的 AppDomain 中运行，而是使用 mscoree.dll 加载。）

如果您正在创建自己的 AppDomain，则您的代码是隔离的，但它的身份可能不会与其他加载项分开，但是，因为您的加载项仍将共享默认的 mscoree.dll 加载程序，除非您使用其他方式来解决这个问题。

我希望这有帮助...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T15:56:02.283

根据相同的文档：

> 运行时为每个对象的**每个进程**维护一个 RCW 。

我认为我们可以安全地假设*object* = *instance*，因此如果 addins/AppDomains 不包含对同一实例的引用，则调用`ReleaseComObject`不会释放对在其他地方创建的实例的引用。

编辑：文档的措辞可能是错误的，[如其他地方所述](https://stackoverflow.com/questions/159313/runtime-callable-wrapper-rcw-scope-process-or-application-domain#170360)。如果是这样，因为您的加载项在单独的 AppDomain 中运行，所以您很幸运。即使不同的加载项引用相同的实例（例如 Outlook 中的消息对象），`ReleaseComObject`在您的 AppDomain 中调用也不会导致其他 AppDomain 中的 RCW 丢失对该实例的引用。

# c# - 什么时候应该覆盖 OnEvent 而不是在继承时订阅事件

> ID：159317
> 
> 赞同：14
> 
> 时间：2008-10-01T19:33:49.647
> 
> 标签：c#, .net, overriding

什么时候应该做以下事情？

```
class Foo : Control
{
    protected override void OnClick(EventArgs e)
    {
        // new code here
    }
} 
```

与此相反？

```
class Foo : Control
{
    public Foo()
    {
        this.Click += new EventHandler(Clicked);
    }

    private void Clicked(object sender, EventArgs e)
    {
        // code
    }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-01T19:37:05.443

覆盖而不是附加委托会产生更高效的代码，因此通常建议您尽可能始终这样做。有关详细信息，请参阅[此 MSDN 文章](http://msdn.microsoft.com/en-us/library/wkzf914z(VS.71).aspx)。这是一个相关的报价：

> 受保护的 OnEventName 方法还允许派生类在不附加委托的情况下覆盖事件。派生类必须始终调用基类的 OnEventName 方法，以确保注册的委托接收事件。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-01T19:38:38.623

该事件适用于外部订阅者。当您派生某些控件时，请始终覆盖 OnEvent 方法，而不是订阅事件。这样，您可以确定何时调用您的代码，因为实际事件是在您调用 base.OnEvent() 时触发的，您可以在代码之前、代码之后、代码中间或不在代码中调用它全部。然后，您还可以对事件的返回值做出反应（即 EventArgs 对象中更改的属性）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T22:25:57.473

Be aware that (at least in .NET 2.0) I have found a few places in the framework (specifically in the DataTable class) where the OnFoo method is *only called* when the corresponding Foo event has been handled! This contravenes the framework design guidelines but we're stuck with it.

I've gotten around it by handling the event with a dummy handler somewhere in the class, eg:

```
public class MyDataTable : DataTable
{
    public override void EndInit()
    {
        base.EndInit();
        this.TableNewRow += delegate(object sender, DataTableNewRowEventArgs e) { };
    }

    protected override void OnTableNewRow(DataTableNewRowEventArgs e)
    {
        base.OnTableNewRow(e);
        // your code here
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T19:40:00.710

订阅事件的目的是让控件监视不同控件上的事件。对于监视您自己的事件 OnClick 很好。但是请注意，Control.OnClick 会处理触发那些订阅的事件，因此请务必在您的覆盖中调用它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T19:38:53.053

如果您像 Kent Boogaart 评论一样覆盖，您需要小心回调 base.OnClick 以允许调用事件订阅

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T19:39:43.003

继承的类不应该订阅它自己的事件，或者它的基类的事件。

现在，如果一个类中有另一个不同的类的实例，那么它可以使用该类的事件，并确定它是否应该引发它自己的事件。

例如，我最近推出了一个 MRU List 课程。其中有许多 ToolStripMenuItem 控件，我使用了它们的单击事件。在那个点击事件被消耗之后，我然后提出了我班级的事件。（[请参阅此处的源代码](http://docs.google.com/Doc?id=dgrd4n99_319f2wfcfgn)）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-09-19T21:09:59.387

值得注意的是，在某些极端情况下，它仅适用于处理程序而不适用于 OnEvent 覆盖。一个这样的例子——

[为什么在 WPF 中删除 StartupUri 时不应用样式？](https://stackoverflow.com/questions/58017438/why-style-is-not-applied-when-im-removing-startupuri-in-wpf)

# perl - 从我的 SVN 提交后挂钩对 OnTime 的 SOAP 调用有什么问题？

> ID：159331
> 
> 赞同：1
> 
> 时间：2008-10-01T19:36:41.000
> 
> 标签：perl, svn, post-commit, ontime

我的 Subversion 存储库位于 Linux 服务器上，而我的 OnTime 2007 系统位于 Windows 2003 服务器上。我有一个启动两个 Perl 脚本的提交后挂钩脚本。一个人发送一封电子邮件——效果很好。另一个应该将来自 SVN 提交的详细信息写入 OnTime 跟踪系统的 Notes 部分。

我在 Perl 脚本中有很多调试语句，因此我可以看到提交的详细信息被准确检索。问题是将它们写入 OnTime。我正在使用 SOAP 传递详细信息，但它不起作用。代码是：

```
$service = SOAP::Lite->uii(URI)
$service->proxy(URL_to_OnTime)
$service->on_action(sub{URI . UpdateDefectNotes})
$method = SOAP::Data->name(UpdateDefectNotes)->attr({xmlns=>URI})
$response = $service->call($method => $defectid,$name,$revisionid,$notes) 
```

我得到的响应代码是`1`，但我不知道这是成功还是失败。我所知道的是 OnTime 中的 Notes 部分`defectid`没有更新。

任何人都可以帮忙吗？

南希

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T20:15:23.573

添加它以显示 XML 请求/响应。

```
$service->on_debug( sub { print @_ } ); 
```

# c++ - C++ 编译时表达式作为数组大小

> ID：159339
> 
> 赞同：1
> 
> 时间：2008-10-01T19:38:08.937
> 
> 标签：c++, arrays

我不确定该术语是否实际上是“数组加法”。

我试图了解以下行的作用：

```
int var[2 + 1] = {2, 1}; 
```

那和 有什么不同`int var[3]`？

我已经使用 Java 好几年了，所以如果使用 Java 友好的词语来解释我将不胜感激。

编辑：非常感谢所有帮助过我的人，奥卡姆剃刀原则适用于此。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-01T19:46:39.087

这没有什么不同。C++ 允许在数组声明的下标中使用表达式（甚至是非常量表达式）（有一些限制；除了多维数组的初始下标之外的任何内容都必须是常量）。

```
整数变量[]；// 非法的
int var[] = {2,1}; // 自动调整为 2
int var[3] = {2,1}; // 等价于 {2,1,0}：任何未指定的都为零
整数变量[3]；// 然而，没有初始化器，没有任何东西被初始化为零
```

也许您正在阅读的代码写入`2 + 1`而不是`3`提醒尾随`0`是有意的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T19:41:20.783

> 那和 有什么不同`int var[3]`？

无论如何我都看不到。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T19:41:48.443

它与`int var[3]`. 编译器将在编译期间评估`2 + 1`并替换它`3`。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T19:42:34.137

`var[2 + 1]`与 没有什么不同`var[3]`。作者可能想强调 var 数组将包含 2 个数据项和一个终止零。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T19:42:44.027

没有什么不同；它是`int var[3]`。

有人在写数组时可能会这样写他们的数组`char`，以便为​​ terminating 增加空间`0`。

```
char four[4 + 1] = "1234"; 
```

`int`使用数组似乎没有任何意义。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T19:43:33.667

这将创建一个由 3 个整数组成的数组。
`2 + 1`你是对的，将它表示为或没有区别`3`，只要该值是编译时常量即可。

右侧`=`是初始化列表，它告诉编译器如何填充数组。第一个值是`2`，第二个`1`和第三个是`0`因为没有指定更多值。

零填充仅在您使用初始化列表时发生。否则，无法保证数组具有任何特定值。

我已经看到使用 char 数组完成此操作，以强调它`char`是为字符串终止符保留的，但从不为`int`数组保留。

# activereports - 如何解决 ActiveReports 中的“找不到 DataMember”问题

> ID：159351
> 
> 赞同：1
> 
> 时间：2008-10-01T19:40:19.290
> 
> 标签：activereports

ActiveReports 似乎是一个强大而灵活的工具，但如果你在任何地方出错，你就会得到一个异常“找不到数据成员。请检查你的数据源和数据成员属性”。

没有迹象表明哪个数据源/数据成员有问题或问题出在哪个子报表上，但 Active Reports 必须知道这一点！

堆栈跟踪没有用，因为在从 Active Reports 自身生成的代码的深处调用 report.run() 方法后会引发错误。

除了一个接一个地注释掉一个子报表并依次检查所有字段之外，还有其他人有解决方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-07-28T18:37:46.377

我在尝试将原始数据集传递给报告时遇到了同样的错误，如下所示：

...

`Dim rpt as New ActiveReport`

`With rpt`

`.DataSource = _data`

`.Run()`

`End With`

...

我在数据集中指定了一个表，错误就消失了。

...

`.DataSource = _data.Tables(0)`

...`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T16:06:37.680

不幸的是，我不知道如何立即判断该错误来自哪个子报告。事实上，当您使用子报表时，应该改进该错误消息。我会将它报告给 ActiveReports 开发团队。

# c# - 为什么我们不能声明 var a = new List 在课堂上？

> ID：159359
> 
> 赞同：5
> 
> 时间：2008-10-01T19:42:11.187
> 
> 标签：c#

我知道我们不能在类级别做到这一点，但在方法级别我们总是可以做到这一点。

```
var myList=new List<string> // or something else like this 
```

这个问题出现在我的脑海中，因为无论我们在哪里声明这样的变量。我们总是在表达式的 RHS 处提供类型信息。所以编译器不需要做类型猜测。（如果我错了，请纠正我）。

所以问题仍然存在为什么不在类级别，而在方法级别允许

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-17T09:07:04.273

实现此功能存在技术问题。常见情况看起来很简单，但更棘手的情况（例如，字段引用链或循环中的其他字段，包含匿名类型的表达式）则不然。

有关深入解释，请参阅 Eric Lippert 的博客：[为什么字段上没有 var？](http://blogs.msdn.com/ericlippert/archive/2009/01/26/why-no-var-on-fields.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-01T19:48:46.523

编译器家伙只是没有实现支持。

这完全是编译器的魔法，编译器实际上并没有在 IL 中放入“在运行时找出类型”的内容，它知道类型并将其构建在其中，因此它也可以为成员做到这一点。

它只是没有。

我很确定，如果您询问 C# 编译器团队的实际编译器人员，您会得到一些官方的信息，但这里没有发生任何魔法，应该可以对成员字段做同样的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T20:30:23.070

该`var`关键字是专门为支持匿名类型而发明的。您通常不会在类级别声明匿名类型，因此它没有实现。

您的示例语句

```
var myList=new List<string> 
```

不是如何使用关键字的一个很好的例子，`var`因为它不是用于预期目的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T20:34:46.087

它不像在方法中实现**var**那样简单，因为您还必须考虑不同的修饰符和属性，如下所示：

```
[MyAttribute()] protected internal readonly var list = new List<T>(); 
```

我真正喜欢的是类型推断的**const**！

```
public const notFoundStatus = 404; // int 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-04-08T05:51:18.913

通用通行证列表类型

```
class Class1
{
    public void genmethod<T>(T i,int Count)
    {

        List<string> list = i as List<string>;

        for (int j = 0; j < Count; j++)
        {
            Console.WriteLine(list[j]);
        }
    }
    static void Main(string[] args)
    {
        Class1 c = new Class1();
        c.genmethod<string>("str",0);
        List<string> l = new List<string>();
        l.Add("a");
        l.Add("b");
        l.Add("c");
        l.Add("d");
        c.genmethod<List<string>>(l,l.Count);

        Console.WriteLine("abc");
        Console.ReadLine();
    }
} 
```

# silverlight - 标准 .Net 2 dll 是否与 silverlight 2.0 运行时兼容？

> ID：159362
> 
> 赞同：3
> 
> 时间：2008-10-01T19:42:29.923
> 
> 标签：silverlight, compatibility

如果我避免引用 silverlight 2.0 运行时中不存在的程序集，我使用 VS2008 创建的 .Net 2.0 库 dll 是否可以在**不重新编译**或其他更改的情况下与 silverlight 一起使用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T19:52:52.737

不，您仍然需要针对程序集的 Silverlight 版本重新编译。您可以将这些文件“作为链接”添加到 Silverlight 类库项目中，在两个项目之间共享同一个文件，这样您至少不必担心不同步。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-04T20:15:41.993

除了在一个项目中创建文件并将它们作为链接添加到另一个项目中之外，您可能仍然会遇到桌面 API 和 Silverlight API 之间的 API 差异。您可以使用#if 块解决这些代码差异，即

```
#if SILVERLIGHT
/* some code */
#else // WPF
/* some other code */
#endif 
```

# c# - 生成的代理类中不包含属性

> ID：159373
> 
> 赞同：2
> 
> 时间：2008-10-01T19:44:44.800
> 
> 标签：c#, xml, wcf, xml-serialization

使用 .Net 3.0 和 VS2005。

有问题的对象从 WCF 服务中使用，然后序列化回 XML 以用于旧版 API。因此，不是序列化 TestObject，而是序列化缺少 [XmlRoot] 属性的 .TestObject；但是，子元素的所有 [Xml*] 属性都在生成的代理代码中，因此它们工作得很好。所以所有子元素都可以正常工作，但封闭元素却没有，因为 [XmlRoot] 属性未包含在生成的代理代码中。包含 [XmlRoot] 属性的原始对象可以手动进行很好的序列化。

**我可以让代理代码包含 [XmlRoot] 属性，以便生成的代理类也正确序列化吗？** 如果我不能这样做，我怀疑我将不得不使用 [XmlType] 但这会导致轻微的破坏，需要我更改其他组件，所以我更喜欢前者。我还想避免手动编辑自动生成的代理类。

这是一些示例代码（我已将客户端和服务包含在同一个应用程序中，因为这既快速又用于测试目的。注释掉服务引用代码并在运行应用程序时添加服务引用，然后取消注释服务代码并运行.)

```
namespace SerializationTest {  
  class Program {  
    static void Main( string[] args ) {  

        Type serviceType = typeof( TestService );  
        using (ServiceHost host = new ServiceHost(   
            serviceType,   
            new Uri[] {   
                new Uri( "http://localhost:8080/" )  
            }  

        ))
        {

            ServiceMetadataBehavior behaviour = new ServiceMetadataBehavior();  
            behaviour.HttpGetEnabled = true;  
            host.Description.Behaviors.Add( behaviour );  

            host.AddServiceEndpoint( serviceType, new BasicHttpBinding(), "TestService" );  
            host.AddServiceEndpoint( typeof( IMetadataExchange ), new BasicHttpBinding(), "MEX" );  

            host.Open();  

            TestServiceClient client = new TestServiceClient();  
            localhost.TestObject to = client.GetObject();  

            String XmlizedString = null;  
            using (MemoryStream memoryStream = new MemoryStream()) {
                XmlSerializer xs = new XmlSerializer( typeof( localhost.TestObject ) );  
                using (XmlWriter xmlWriter = XmlWriter.Create(memoryStream)) {
                    xs.Serialize( xmlWriter, to );  
                    memoryStream = (MemoryStream)xmlWriter.BaseStream;  
                    XmlizedString = Encoding.UTF8.GetString( memoryStream.ToArray() );  
                    Console.WriteLine( XmlizedString );  
                }    
            }    
        }

        Console.ReadKey();  
    }  
}  

[Serializable]  
[XmlRoot( "SomethingElse" )]  
public class TestObject {  

    private bool _worked;  

    public TestObject() { Worked = true; }  

    [XmlAttribute( AttributeName = "AttributeWorked" )]  
    public bool Worked {  
        get { return _worked; }  
        set { _worked = value; }  
    }  
}  

[ServiceContract]  
public class TestService {  

    [OperationContract]  
    [XmlSerializerFormat]  
    public TestObject GetObject() {  
        return new TestObject();  
    }  
  }  
} 
```

这是生成的 Xml。

```
<?xml version="1.0" encoding="utf-8"?>
<TestObject xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" AttributeWorked="true" /> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-23T08:56:39.243

**== 如果 ==**

这仅适用于`XmlRoot`属性。`XmlSerializer`有一个构造函数，您可以在其中指定属性`XmlRoot`。

感谢 csgero 指出它。他的评论应该是解决方案。

```
XmlSerializer Constructor (Type, XmlRootAttribute) 
```

> 初始化该类的新实例， `XmlSerializer`该类可以将指定类型的对象序列化为 XML 文档，并将 XML 文档反序列化为指定类型的对象。它还指定用作 XML 根元素的类。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-10-07T03:48:32.437

我找到了提供解决这种情况的方法的人：

[Matevz Gacnik 的博客](http://www.request-response.com/blog/PermaLink,guid,efa4e231-ddf1-48f4-9a26-54363e799d42.aspx)

使用这种方法`XmlAttributeOverrides`，我写了以下内容：

```
 private static XmlSerializer GetOverridedSerializer()
    {
        // set overrides for TestObject element
        XmlAttributes attrsTestObject = new XmlAttributes();
        XmlRootAttribute rootTestObject = new XmlRootAttribute("SomethingElse");
        attrsTestObject.XmlRoot = rootTestObject;

       // create overrider
       XmlAttributeOverrides xOver = new XmlAttributeOverrides();
       xOver.Add(typeof(localhost.TestObject), attrsTestObject);

       XmlSerializer xSer = new XmlSerializer(typeof(localhost.TestObject), xOver);
       return xSer;
    } 
```

只需将该方法放在`Program`示例的类中，然后替换以下行`Main()`：

```
 //XmlSerializer xs = new XmlSerializer(typeof(localhost.TestObject));
        XmlSerializer xs = GetOverridedSerializer(); 
```

然后运行看看结果。

这是我得到的：

```
<?xml version="1.0" encoding="utf-8"?><SomethingElse xmlns:xsi="http://www.w3.o
rg/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" Attribu
teWorked="true" /> 
```

# asp.net - ReportViewer 控件和 Ajax UpdatePanel

> ID：159391
> 
> 赞同：4
> 
> 时间：2008-10-01T19:47:08.807
> 
> 标签：asp.net, ajax, updatepanel, reportviewer

你们有没有人找到让 Microsoft Report Viewer Control (Web) 在 Ajax UpdatePanel 中工作的方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T20:34:51.187

唯一的方法是在 iirc 中创建一个带有报告的 iframe。然而，[这个帖子里](http://forums.asp.net/p/1044194/1460759.aspx)有个家伙声称他有办法用一些代码来修复它。尽管我什至没有尝试过，因为我从来不需要在更新面板中显示我的任何报告。我倾向于将我的报告保留在任何 ajax 应用程序之外，例如，当请求报告时，我将打开一个仅包含报告的新窗口。无论如何，我的用户更喜欢这样。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-04-20T08:34:31.940

我通过使用修复了这个错误

Microsoft Report Viewer 2010 Redistributable Package 来自：

[http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=a941c6b2-64dd-4d03-9ca7-4017a0d164fd](http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=a941c6b2-64dd-4d03-9ca7-4017a0d164fd)

然后更改网络配置如下

从

```
 <assemblies>                <add assembly="System.Core, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />                <add assembly="System.Data.DataSetExtensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />                <add assembly="System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />                <add assembly="System.Xml.Linq, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />                <add assembly="Microsoft.ReportViewer.WebForms, Version=9.0.0.0, Culture=neutral, PublicKeyToken=B03F5F7F11D50A3A" />                <add assembly="Microsoft.ReportViewer.Common, Version=9.0.0.0, Culture=neutral, PublicKeyToken=B03F5F7F11D50A3A" />            </assemblies>
        <assemblies>

            <add assembly="Microsoft.ReportViewer.WebForms, Version=9.0.0.0, Culture=neutral, PublicKeyToken=B03F5F7F11D50A3A" />

            <add assembly="Microsoft.ReportViewer.Common, Version=9.0.0.0, Culture=neutral, PublicKeyToken=B03F5F7F11D50A3A" />

        </assemblies> 
```

到

```
 <assemblies>

    <add assembly="Microsoft.ReportViewer.WebForms, Version=10.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />

    <add assembly="Microsoft.ReportViewer.Common, Version=10.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />

  </assemblies> 
```

将此添加到运行时

```
<assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">

  <dependentAssembly>

    <assemblyIdentity name="Microsoft.ReportViewer.WebForms" publicKeyToken="b03f5f7f11d50a3a"/>

    <bindingRedirect oldVersion="9.0.0.0-9.1.0.0" newVersion="10.0.0.0"/>

  </dependentAssembly>

</assemblyBinding> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T20:26:13.313

从来没有真正尝试过，但我确信控制不会立即起作用。我很确定它需要加载一些额外的 Javascript，因为它增加了很多复杂性，所以您可能需要在更新面板之前加载它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-20T13:06:57.053

我还可以确认上一篇文章中提到的最新版本（2010）更正了问题。它还消除了显式设置 AsyncRendering=False 的需要：我提到这一点是因为网络上的其他建议说要在该属性上设置该值

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-02-02T19:44:54.883

这是一个例子：

```
<asp:Button ID="Button1" runat="server" OnClick="ViewReport_Clicked" Text="View Report" SkinID="ButtonA" />
<asp:UpdatePanel ID="TFD_UP" runat="server">
    <ContentTemplate>
        <rsweb:ReportViewer ID="ReportViewer1" runat="server" SizeToReportContent="True"
            Height="202px" Width="935px" Font-Names="Verdana" Font-Size="8pt" InteractiveDeviceInfos="(Collection)"
            WaitMessageFont-Names="Verdana" WaitMessageFont-Size="14pt" Visible="false">
            <LocalReport ReportPath="Reports\Report4.rdlc">
                <DataSources>
                    <rsweb:ReportDataSource DataSourceId="SqlDataSourceArchiSpecs" Name="Proc_TechFilesDownloadsDataSetParent" />
                </DataSources>
            </LocalReport>
        </rsweb:ReportViewer>
        <asp:SqlDataSource ID="SqlDataSourceArchiSpecs" runat="server" ConnectionString="<%$ ConnectionStrings:ArchiSpecsDBConnectionString %>"
            SelectCommand="PROC_TECHNICALFILES_DOWNLOAD_DETAILS" SelectCommandType="StoredProcedure">
            <SelectParameters>
                <asp:Parameter Name="supId" Type="Int32" />
                <asp:Parameter Name="startDate" Type="DateTime" />
                <asp:Parameter Name="endDate" Type="DateTime" />
            </SelectParameters>
        </asp:SqlDataSource>
    </ContentTemplate>
    <Triggers>
        <asp:AsyncPostBackTrigger ControlID="Button1" EventName="Click" />
    </Triggers>
</asp:UpdatePanel> 
```

# php - 如何在 PHP 中解析 A pache 的错误日志？

> ID：159393
> 
> 赞同：18
> 
> 时间：2008-10-01T19:47:13.517
> 
> 标签：php, apache, error-log

我想创建一个脚本来解析或理解 apache 的错误日志，以查看最近的错误是什么。我想知道那里是否有人这样做或有任何想法从哪里开始？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-01T20:03:01.433

首先要考虑以下几点：

1.  首先，您的 PHP 用户可能无法访问 Apache 的日志文件。
2.  其次，PHP 和 Apache 不会告诉你所说的日志文件在哪里，
3.  最后，Apache 日志文件可能会变得非常大。

但是，如果这些都不适用，您可以使用正常的文件读取命令来执行此操作。获得最后一个错误的最简单方法是

```
$contents = @file('/path/to/error.log', FILE_SKIP_EMPTY_LINES);
if (is_array($contents)) {
    echo end($contents);
}
unset($contents); 
```

可能有一种更好的方法可以做到这一点，它不会占用内存，但我将把它作为练习留给读者。

最后一条评论：PHP 还有一个 ini 设置，可以将 PHP 错误重定向到日志文件：`error_log = /path/to/error.log`

您可以使用 php_flag 表示法在 httpd.conf 或 .htaccess 文件（如果您可以访问）中设置它：

```
php_flag error_log /web/mysite/logs/error.log 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-02T18:32:17.993

对于其他寻找示例脚本的人，我将一些东西放在一起，它具有基础知识：

```
<?php
exec('tail /usr/local/apache/logs/error_log', $output);
?>
<Table border="1">
    <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Client</th>
        <th>Message</th>
    </tr>
<?
    foreach($output as $line) {
        // sample line: [Wed Oct 01 15:07:23 2008] [error] [client 76.246.51.127] PHP 99\. Debugger->handleError() /home/gsmcms/public_html/central/cake/libs/debugger.php:0
        preg_match('~^\[(.*?)\]~', $line, $date);
        if(empty($date[1])) {
            continue;
        }
        preg_match('~\] \[([a-z]*?)\] \[~', $line, $type);
        preg_match('~\] \[client ([0-9\.]*)\]~', $line, $client);
        preg_match('~\] (.*)$~', $line, $message);
        ?>
    <tr>
        <td><?=$date[1]?></td>
        <td><?=$type[1]?></td>
        <td><?=$client[1]?></td>
        <td><?=$message[1]?></td>
    </tr>
        <?
    }
?>
</table> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T20:03:58.127

有成堆的 php 脚本可以做到这一点，只需在谷歌上搜索示例即可。如果你想自己动手，它并不比读取任何其他文件更复杂。只需确保您知道日志文件的位置（在 httpd.conf 文件中定义）和[日志文件](http://httpd.apache.org/docs/2.0/logs.html)的格式。格式也在 httpd.conf 中定义

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-12-21T03:43:50.350

这是一个小型类，可以轻松地从大文件的背面读取多个字符，而不会导致内存过载。测试设置让你看到它在蚕食自己。

```
BigFile.php
<?php
$run_test = true;
$test_file = 'BigFile.php';

class BigFile
{
private $file_handle;

/**
 * 
 * Load the file from a filepath 
 * @param string $path_to_file
 * @throws Exception if path cannot be read from
 */
public function __construct( $path_to_log )
{
    if( is_readable($path_to_log) )
    {
        $this->file_handle = fopen( $path_to_log, 'r');
    }
    else
    {
        throw new Exception("The file path to the file is not valid");
    } 
}

/**
 * 
 * 'Finish your breakfast' - Jay Z's homme Strict
 */
public function __destruct()
{
    fclose($this->file_handle); 
}

/**
 * 
 * Returns a number of characters from the end of a file w/o loading the entire file into memory
 * @param integer $number_of_characters_to_get
 * @return string $characters
 */
public function getFromEnd( $number_of_characters_to_get )
{
    $offset = -1*$number_of_characters_to_get;
    $text = "";

    fseek( $this->file_handle, $offset , SEEK_END);

    while(!feof($this->file_handle))
    {
        $text .= fgets($this->file_handle);
    }

    return $text;
}
}

if( $run_test )
{
$number_of_characters_to_get =  100000; 
$bf = new BigFile($test_file);
$text = $bf->getFromEnd( $number_of_characters_to_get );
echo "$test_file has the following $number_of_characters_to_get characters at the end: 
    <br/> <pre>$text</pre>";
}

?> 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-12-09T20:37:56.053

你试过 biterScripting 吗？我是系统管理员，我一直在用它来解析日志。它是univx 风格的脚本。biterScripting.com -> 免费下载。

# eclipse - Are there any user interface prototyping tools for Eclipse?

> ID：159422
> 
> 赞同：9
> 
> 时间：2008-10-01T19:54:38.180
> 
> 标签：eclipse, ide, user-interface, prototyping

I am looking into designing new features for Eclipse-based programming tools, from the requirements/ideas perspective. To really do this quickly, I would like to sketch UI elements without having to code things -- my concern is with the concepts and ideas right now, not the possible later realization. Are there any such graphical sketching tools for Eclipse?

(on a side note, I should also note that I find Eclipse a better idea every day, in the way that you can combine partial systems from very many different sources into a single environment. It really is the future of IDEs, especially for embedded systems. It used to pretty horrible pre-Eclipse-3.0, but now it does seem to work)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-18T20:47:16.560

[WireframeSketcher](http://wireframesketcher.com)是一种工具，可帮助为桌面、Web 和移动应用程序快速创建线框、模型和原型。它既可以作为**独立**版本，也可以作为 Eclipse IDE 的**插件**。它具有一些独特的功能，例如故事板、组件、链接和矢量 PDF 导出。支持的 IDE 包括 Aptana、Flash Builder、Zend Studio 和 Rational Application Developer。

[![WireframeSketcher 样机示例](https://i.stack.imgur.com/3R4rh.png)](https://i.stack.imgur.com/3R4rh.png)
[（来源：[wireframesketcher.com](http://wireframesketcher.com/samples/Website.png)）]

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T20:37:44.207

Incidentally, NetBeans is known for having a really good GUI editor (Matisse), but I realize that you weren't asking about NetBeans :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T06:37:35.450

这确实是 Eclipse 特有的：它是当今通用 IDE 的首选平台，我正在寻找对它的扩展。目标编程语言更可能是原始汇编程序和 C，而不是其他任何东西——操作系统、驱动程序、系统级调试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T19:56:37.737

I've tried the [Visual Editor Project](http://www.eclipse.org/vep/WebContent/main.php) before, but in the past it crashed my instance of Eclipse, and I haven't visited it since.

[Jigloo](http://www.ibm.com/developerworks/edu/os-dw-os-eclipse-jigloo.html) is a new one that I'd like to try out soon.

# scripting - awk 脚本帮助 - 逻辑问题

> ID：159423
> 
> 赞同：2
> 
> 时间：2008-10-01T19:55:43.637
> 
> 标签：scripting, awk, logic

我目前正在编写一个简单的 .sh 脚本来解析 Exim 日志文件中匹配“o”的字符串。目前，在查看 output.txt 时，每行（606 行）上都打印一个 0。我猜我的逻辑是错误的，因为 awk 不会抛出任何错误。

这是我的代码（针对连接和计数器问题进行了更新）。编辑：我已经从 dmckee 的答案中采用了一些新代码，我现在正在使用旧代码来支持简单性。

```
awk '/o'\''/ {
         line = "> ";
         for(i = 20; i <= 33; i++) {
           line = line " " $i;
         }
         print line;
    }' /var/log/exim/main.log > output.txt 
```

有任何想法吗？

编辑：为了清楚起见，我在电子邮件地址中使用“o”，因为 ' 是电子邮件地址中的非法字符（在我们的数据库中，仅以 o' 为前缀的名称出现）。

编辑 2：根据评论请求，这里是一些所需输出的经过消毒的样本：

```
[xxx.xxx.xxx.xxx] kathleen.o'toole@domain.com <kathleen.o'toole@domain.com> routing defer (-51): retry time not reached

[xxx.xxx.xxx.xxx] julie.o'brien@domain.com <julie.o'brien@domain.com> routing defer (-51): retry time not reached

[xxx.xxx.xxx.xxx] james.o'dell@domain.com <james.o'dell@domain.com> routing defer (-51): retry time not reached

[xxx.xxx.xxx.xxx] daniel_o'leary@domain.com <aniel_o'leary@domain.com> routing defer (-51): retry time not reached 
```

我在循环中从 20 开始的原因是因为第 20 个字段之前的所有内容都只是标准日志信息，我在这里不需要这些信息。我所需要的只是该解决方案的 IP 及其他所有内容（每个 550 错误的消息对于每个正在使用的邮件服务器都不同。我正在编译一个常见的列表）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T20:02:50.950

`+`表示 awk 中的数值加法。如果要连接，只需将常量和/或表达式用空格分隔即可。

所以这

```
line += " " + $i 
```

应该成为

```
line = line " " $i 
```

编辑：如果*exim*日志文件（我更喜欢 Postfix :) 由一个空格分隔，以下不是更简单：

```
grep -F o\' /var/log/exim/main.log | cut -d\  -f20-33 >output.txt 
```

?

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T20:17:17.860

这里不需要 grep。让 awk 为您选择匹配行（并根据 ΤZΩΤZΙΟΥ 修复您的串联错误）：

```
awk '/o'\''/ {
             line = "> ";
             for(i = 20; i <= 33; i++) {
               line = line " " $i;
             }
             print line;
        }' /var/log/exim/main.log > output.txt 
```

当然，如果你像上面那样在提示符下这样做，你最终需要一些奇怪的转义。它在脚本中更干净......

* * *

编辑：在第一遍我错过了 += 问题......

还假设您在上面给出的行是部分的，因为它只有 13 个字段（默认情况下，字段以空格分隔）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T20:30:42.867

“'”在当地并不违法。从[RFC2821](http://www.ietf.org/rfc/rfc2821.txt)，第 4.1.2 节：

```
Local-part = Dot-string / Quoted-string

Dot-string = Atom *("." Atom)

Atom = 1*atext 
```

2821 进一步参考[了 RFC2822](http://www.ietf.org/rfc/rfc2822.txt)以获取非本地定义的元素，因此：

```
atext           =       ALPHA / DIGIT / ; Any character except controls,
                        "!" / "#" /     ;  SP, and specials.
                        "$" / "%" /     ;  Used for atoms
                        "&" / "'" /
                        "*" / "+" /
                        "-" / "/" /
                        "=" / "?" /
                        "^" / "_" /
                        "`" / "{" /
                        "|" / "}" /
                        "~" 
```

换句话说，“'”是一个完全合法的不带引号的字符，在本地电子邮件中具有。**现在，它在您的网站上**可能不合法，但您不是这么说的。

很抱歉没有直接讨论主题，但我想更正您的断言。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T21:01:22.403

关闭任务，更简单：python。

```
import fileinput
for line in fileinput.input():
    if "'" in line:
        fields = line.split(' ')
        print "> ", ' '.join( fields[20:34] ) 
```

# quickbooks - Quickbooks XML 和商家服务的 ReceivePayment Pending

> ID：159431
> 
> 赞同：0
> 
> 时间：2008-10-01T19:57:51.447
> 
> 标签：quickbooks, qbxml

在 Quickbooks SDK 手册中，有一节叫做“使用 ReceivePayment 进行信用卡授权和捕获”。它读...

> **使用 ReceivePayment 进行信用卡授权和捕获**
> 
> 如果公司订阅了 QBMS，您可以记录一个 ReceivePaymentAdd，它基本上是一个待处理的交易。也就是说，在这种用法中，您希望将 QBMS 授权事务保存到 QuickBooks 中。因此，ReceivePaymentAdd 包含一个 CreditCardTxnInfo 聚合，其 CreditCardTxnType 为 Authorization。QuickBooks 将其保存为待处理事务。稍后，当授权费用被捕获成为 QBMS 中的实际费用时，您可以通过修改该 ReceivePayment (ReceivePaymentMod) 将该费用记录到 QuickBooks 中。ReceivePaymentMod 将有一个 CreditCardTxnInfoMod，其中包含来自 QBMS 捕获交易的数据，CreditCardTxnType 为 Capture。QuickBooks 会自动删除待处理状态并记录交易。

我的问题是，**您实际上如何使用 QBXML 做到这一点？**

现在，我有一个 VB.NET 应用程序可以将发票发送到 quickbooks，但是用户必须切换到 quickbooks，然后单击“客户 -> 接收付款”以从他们的信用卡中收取费用（使用 Quickbooks Merchant Services）。以某种方式自动执行此操作会非常好，也许通过向 Quickbooks 发送 XML 消息来收取卡费用？）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-25T14:41:38.400

我不太清楚你的意思......我会接近它的方式是：

*   使用 QBMS XML API 对卡片进行授权
*   将收款和授权推送到 QuickBooks

*   准备就绪后，使用 QBMS API 为卡充电

*   发出 ReceivePaymentMod 以在 QuickBooks 中记录捕获

据我所知，没有办法告诉 QuickBooks 自己进行捕获。但是您可以使用 QBMS API 进行捕获。

# c++ - 在 C/C++(ms) 中将 char[] 转换为 tchar[] 的最简单方法是什么？

> ID：159442
> 
> 赞同：18
> 
> 时间：2008-10-01T20:00:12.127
> 
> 标签：c++, c, string, char, tchar

这似乎是一个漂亮的垒球问题，但我总是很难查找这个函数，因为关于 char 和 tchar 的引用似乎有很多变化。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-01T20:22:38.173

最简单的方法是使用转换宏：

*   CW2A
*   CA2W
*   ETC...

[MSDN](http://msdn.microsoft.com/en-us/library/87zae4a3(VS.71).aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-01T20:03:52.493

TCHAR 是 char 或 wchar_t（宽字符）的 Microsoft 特定类型定义。

转换为 char 取决于它实际上是其中的哪一个。如果 TCHAR 实际上是一个字符，那么你可以做一个简单的转换，但如果它真的是一个 wchar_t，你需要一个例程来在字符集之间进行转换。查看函数 MultiByteToWideChar()

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-01T20:05:22.943

[MultiByteToWideChar](http://msdn.microsoft.com/en-us/library/dd319072(v=vs.85).aspx)，但也请参阅[“MultiByteToWideChar 的一些问题”](http://archives.miloush.net/michkap/archive/2005/04/19/409566.html)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-01T20:09:49.063

这篇文章中也有一些答案，特别是如果您正在寻找跨平台解决方案：

[UTF8 到/从 STL 中的宽字符转换](https://stackoverflow.com/questions/148403/utf8-tofrom-wide-char-conversion-in-stl)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-01T20:25:09.620

> > 虽然在这种特殊情况下，我认为 TChar 是一个宽字符，但如果不是，我只需要进行转换。我必须以某种方式检查。

```
if (sizeof(TCHAR) != sizeof(wchar_t))
{  .... } 
```

很酷的一点是equals的大小都是常量，这意味着编译器将处理（并删除）if()，如果它们相等，则删除大括号内的所有内容

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-10-27T03:32:22.977

这是将 _TCHAR * argv[] 复制到 char * argn[] 的 CPP 代码。

[http://www.wincli.com/?p=72](http://www.wincli.com/?p=72)

如果您在 Windows 上采用旧代码，只需使用代码中提到的定义作为可选。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-05-31T08:28:48.240

您可以在代码中添加条件

ifdef _UNICODE

{ //DO LIKE TCHAR IS WIDE CHAR } ELSE { //DO LIKE TCHAR IS CHAR }

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-01-26T17:41:29.670

我意识到这是一个旧线程，但它没有让我得到“正确”的答案，所以现在添加它。

现在看来这样做的方法是使用 TEXT 宏。msdn 上的 FindFirstFile 示例指出了这一点。 [http://msdn.microsoft.com/en-us/library/windows/desktop/aa364418%28v=vs.85%29.aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/aa364418%28v=vs.85%29.aspx)

# sql - 数据透视表和连接列

> ID：159456
> 
> 赞同：15
> 
> 时间：2008-10-01T20:03:57.720
> 
> 标签：sql, sql-server, database, pivot

我有一个格式如下的数据库：

```
 ID    TYPE   SUBTYPE    COUNT   MONTH
 1      A      Z          1       7/1/2008
 1      A      Z          3       7/1/2008
 2      B      C          2       7/2/2008
 1      A      Z          3       7/2/2008 
```

我可以使用 SQL 将其转换为：

```
ID    A_Z   B_C   MONTH
1     4     0     7/1/2008
2     0     2     7/2/2008
1     0     3     7/2/2008 
```

因此，`TYPE`,`SUBTYPE`被连接到新列中，并在和匹配`COUNT`的地方求和。`ID``MONTH`

任何提示将不胜感激。这在 SQL 中是否可行，还是我应该手动编程？

数据库是 SQL Server 2005。

假设有 100 个`TYPES`等`SUBTYPES`，“A”和“Z”不应该是硬编码的，而是动态生成的。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-10-01T21:18:37.820

SQL Server 2005 提供了一个非常有用的 PIVOT 和 UNPIVOT 运算符，它允许您使用 PIVOT 和一些代码生成/动态 SQL 使此代码免维护

```
/*
CREATE TABLE [dbo].[stackoverflow_159456](
    [ID] [int] NOT NULL,
    [TYPE] [char](1) NOT NULL,
    [SUBTYPE] [char](1) NOT NULL,
    [COUNT] [int] NOT NULL,
    [MONTH] [datetime] NOT NULL
) ON [PRIMARY]
*/

DECLARE @sql AS varchar(max)
DECLARE @pivot_list AS varchar(max) -- Leave NULL for COALESCE technique
DECLARE @select_list AS varchar(max) -- Leave NULL for COALESCE technique

SELECT @pivot_list = COALESCE(@pivot_list + ', ', '') + '[' + PIVOT_CODE + ']'
        ,@select_list = COALESCE(@select_list + ', ', '') + 'ISNULL([' + PIVOT_CODE + '], 0) AS [' + PIVOT_CODE + ']'
FROM (
    SELECT DISTINCT [TYPE] + '_' + SUBTYPE AS PIVOT_CODE
    FROM stackoverflow_159456
) AS PIVOT_CODES

SET @sql = '
;WITH p AS (
    SELECT ID, [MONTH], [TYPE] + ''_'' + SUBTYPE AS PIVOT_CODE, SUM([COUNT]) AS [COUNT]
    FROM stackoverflow_159456
    GROUP BY ID, [MONTH], [TYPE] + ''_'' + SUBTYPE
)
SELECT ID, [MONTH], ' + @select_list + '
FROM p
PIVOT (
    SUM([COUNT])
    FOR PIVOT_CODE IN (
        ' + @pivot_list + '
    )
) AS pvt
'

EXEC (@sql) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-01T20:12:55.217

```
select id,
sum(case when type = 'A' and subtype = 'Z' then [count] else 0 end) as A_Z,
sum(case when type = 'B' and subtype = 'C' then [count] else 0 end) as B_C,
month
from tbl_why_would_u_do_this
group by id, month 
```

您比我们的营销团队更能改变需求！如果您希望它是动态的，则需要依靠存储过程。

# amazon-s3 - 使用亚马逊云服务器/应用程序/工具进行编程的经验和技巧？

> ID：159459
> 
> 赞同：8
> 
> 时间：2008-10-01T20:04:35.923
> 
> 标签：amazon-s3, amazon-ec2, amazon-web-services, cloud

我们正在研究开发一种使用亚马逊云工具（EC2、SQS 等）的产品，我很好奇使用这些技术的人有什么技巧/陷阱/指针。

请给一个小费/每个帖子。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-02T01:47:18.127

Mozilla 的 Elasticfox 插件让很多 EC2 的工作变得更容易。可以在以下位置找到它：[适用于 Amazon EC2 的 Elasticfox Firefox 扩展](http://developer.amazonwebservices.com/connect/entry.jspa?externalID=609)。此页面包含专门用于下载 Elasticfox 插件以及相关 Sourceforge 项目的链接。很值得使用...

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-02T01:29:36.237

[在Right Scale](http://rightscale.com)获取开发者帐户。对于讨厌记住那些愚蠢的命令和论点的人来说，它是免费的，而且是天赐之物。如果你只使用亚马逊提供的工具，你就是在抛弃你的人权。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T22:09:06.717

需要掌握的一个重要概念：您的 EC2 实例在运行时所依赖的文件系统*不是持久的。*有一些可用的工具/服务可以让您挂载由 S3 存储支持的文件系统，或者您可以从实例上传到 S3 或其他存储服务，但是当实例关闭时，关联的文件系统就不再存在了。

至于工具，我发现亚马逊的工具很棒，但如果你走这条路，你可能应该对命令行感到满意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-02T01:01:23.730

我们对我工作的 EC2 感兴趣。我们不关心网络服务或企业的东西，只关心大量的物理数据处理，使用 python。这个 EC2 的东西让我一头雾水，大多数文档都面向商业应用程序并使用 C# 或 Java，但这张幻灯片对我来说很清楚，尤其是对于使用 python：[http ://www.datawrangling.com/pycon-2008-elasticwulf-幻灯片](http://www.datawrangling.com/pycon-2008-elasticwulf-slides)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T01:52:05.450

至于[SimpleDB](http://aws.amazon.com/simpledb/)，它的查询语言非常有限，而且非常严格。如果您计划进行大量复杂查询，则必须先坐下来思考如何组织数据以使这些查询成为可能。缺少但可能会添加的一件事是计算给定查询结果的能力，很像 SQL 的 COUNT。

性能还可以，但我认为延迟可能有点高。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-15T12:35:43.523

为了管理您的 EC2 实例等，Amazon 还提供了 - 几天前的测试版 - 管理控制台，它具有与 Elasticfox Firefox 插件类似的功能，但它是一个纯 Web 控制台。

[https://console.aws.amazon.com](https://console.aws.amazon.com)

# java - JPA - 未知的实体 bean 类

> ID：159469
> 
> 赞同：6
> 
> 时间：2008-10-01T20:07:43.747
> 
> 标签：java, netbeans, jpa, glassfish

希望我能正确解释这个问题。我有 3 个类处理我的实体。

```
@MappedSuperclass
public abstract class Swab implements ISwab {
...
    private Collection<SwabAccounts> accounts;
...
}

@Entity
@Table(name="switches")
@DiscriminatorColumn(name="type")
@DiscriminatorValue(value="DMS500")
public class DmsSwab extends Swab implements ISwab, Serializable {
...
    private ObjectPool pool;
...
    @Transient 
    public ObjectPool getPool(){
        return pool;
    }
...
}

@Entity(name="swab_accounts")
public class SwabAccounts implements Serializable {
    private static final long serialVersionUID = 1L;

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private int swab_account_id;
    private int swab_id;
...
} 
```

在 EJB 中，查询正在以这种方式进行

```
 DmsSwab dms = em.find(DmsSwab.class, 2);
    List<Swab> s = new ArrayList<Swab>(1);
    s.add(dms); 
```

我的 persistence.xml 看起来像这样：

```
<?xml version="1.0" encoding="UTF-8"?>
<persistence version="1.0" xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd">
  <persistence-unit name="dflow-pu" transaction-type="RESOURCE_LOCAL">
    <provider>oracle.toplink.essentials.PersistenceProvider</provider>
    <class>com.dcom.sap.dms.DmsSwab</class>
    <class>com.dcom.sap.jpa.SwabAccounts</class>
    <properties>
      <property name="toplink.jdbc.user" value="dflow"/>
      <property name="toplink.jdbc.password" value="dflow"/>
      <property name="toplink.jdbc.url" value="jdbc:mysql://itcd-400447:3306/dflow"/>
      <property name="toplink.jdbc.driver" value="com.mysql.jdbc.Driver"/>
    </properties>
  </persistence-unit>
</persistence> 
```

我收到此错误：

```
java.lang.IllegalArgumentException: Unknown entity bean class: class com.dcom.sap.dms.DmsSwab, please verify that this class has been marked with the @Entity annotation.
com.dcom.sap.SwabException: java.lang.IllegalArgumentException: Unknown entity bean class: class com.dcom.sap.dms.DmsSwab, please verify that this class has been marked with the @Entity annotation.
Caused by: java.lang.IllegalArgumentException: Unknown entity bean class: class com.dcom.sap.dms.DmsSwab, please verify that this class has been marked with the @Entity annotation.
        at oracle.toplink.essentials.internal.ejb.cmp3.base.EntityManagerImpl.findInternal(EntityManagerImpl.java:306)
        at oracle.toplink.essentials.internal.ejb.cmp3.EntityManagerImpl.find(EntityManagerImpl.java:148) 
```

我正在使用附带的 glassfish 版本运行 netbeans 6.1。mysql 5.0。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-07-23T06:11:06.737

在persistence.xml中的class标签中定义这个实体

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T15:13:16.350

根据错误消息和我从您的代码中得出的结论，错误似乎在persistence.xml 文件中，您能再详细一点吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-28T02:40:22.493

我有同样的错误，补充上面的信息，我的情况是 ClassLoader 问题。我的应用程序有三个文件。一个依赖于 app-lib.jar（包含 pojo 和数据库实体的库）的 ejb-module.jar 和一个依赖于 app-lib.jar 的 web-module.war。

在部署中，app-lib.jar 被 glassfish 加载了两次。谷歌搜索，我发现我应该将 app-lib.jar 复制到 glassfish 域中的“共享”库中。我已将 postgresql.jar 复制到“domain-dir/lib”，将 app-lib.jar 复制到“domain-dir/lib/applibs”。完成它，该应用程序就像一个魅力。

使用的解释可以在这里找到：http: [//docs.oracle.com/cd/E19798-01/821-1752/beade/index.html](http://docs.oracle.com/cd/E19798-01/821-1752/beade/index.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-04-25T19:08:47.473

我解决了这个问题，在我的 Web 应用程序中创建了一个 ContextListener，在销毁上下文时调用实体管理器工厂的关闭，：

```
public void contextDestroyed(ServletContextEvent servletContextEvent) {
    try {
        logger.info("contextDestroyed...");
        LifeCycleManager lifeCycleManager = ServiceLocator.getLifeCycleManager();
        lifeCycleManager.closeEntityManagerFactory();

    } catch (Exception e) {
        logger.error(e.getMessage(), e);
    }
} 
```

我还创建了一个名为 LifeCycleManager 的 bean，并在其中调用 DAO 方法来关闭实体管理器工厂：

```
public void closeEntityManagerFactory() throws BusinessException {
        logger.info("closeEntityManager");
        try {
            logger.info("closing entity manager factory...");
            genericDAO.closeEntityManagerFactory();
            logger.info("Entity manager factiry closed");
        } catch (Exception e) {
            throw new BusinessException(BusinessErrorCode.CODIGO_EJEMPLO_01, Severity.ERROR);
        }
    } 
```

DAO 内部：

...

```
@Autowired
private EntityManagerFactory entityManagerFactory; 
```

...

```
public void closeEntityManagerFactory() {
        logger.info("closing entity manager factory");
        getEntityManagerFactory().close();
        logger.info("entity manager factory closed");   
    } 
```

每次我从我的 Eclipse 环境部署更改时都使用它，会调用销毁上下文。希望对大家有所帮助，我的环境是 WebLogic Server 11gR1 和 JPA 1.0。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-07-17T04:59:27.123

当马里奥在这里提到**EntityManagerFactory**时，他是对的。

两个都：

> **java.lang.IllegalArgumentException** : 未知的实体 bean 类...

和

> **java.lang.IllegalStateException** : 此 Web 容器尚未启动...

当您多次重新部署 Web 应用程序但未正确关闭**EntityManagerFactory**时，会发生这些异常。

按照[此指令](https://www.deadcoderising.com/execute-code-on-webapp-startup-and-shutdown-using-servletcontextlistener/#:%7E:text=ServletContextListener%20is%20an%20interface%20that,filters%20and%20servlets%20are%20initialized.)注册**ServletContextListener**和[此指令](https://stackoverflow.com/a/44519903/5819521)以正确关闭**EntityManagerFactory**。

# wpf - 将 Expander 重置为默认折叠行为

> ID：159470
> 
> 赞同：2
> 
> 时间：2008-10-01T20:08:00.020
> 
> 标签：wpf, expander

我在[Resizer](http://kentb.blogspot.com/2007/04/resizer-wpf-control.html)（带有调整大小抓手的 ContentControl）中使用了扩展器，当控件最初出现时，它会正确展开/折叠。一旦我调整它的大小，Expander 将不会正确折叠，如下所述。我在我的应用程序上运行了 Snoop，但我没有看到 Expander 或其组件上设置的任何高度。

我将如何说服 Expander 再次正确折叠？或者修改 Resizer 以不让 Expander 悲伤也可以。

扩展器文档说：

> "要使 Expander 正常工作，当 ExpandDirection 属性设置为 Down 或 Up 时，不要在 Expander 控件上指定 Height。类似地，当 ExpandDirection 属性设置为 Left 或 Right 时，不要在 Expander 控件上指定 Width。当您在 Expander 控件上设置展开内容显示方向的大小时，由 size 参数定义的区域将显示为带有边框。该区域即使在窗口折叠时也会显示。设置大小展开的窗口，在 Expander 控件的内容或包含内容的 ScrollViewer 上设置大小尺寸。”

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T20:34:44.277

我通过在 Expander 中移动 Resizer 解决了这个问题，但是我在其他地方遇到了 Expander 问题，所以如果有人有它，我仍然希望得到答案。

谢谢

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-08T17:24:26.923

从那以后我没有机会模拟这个特定的问题，但我最近发现将 Height 或 Width 设置为 Double.NaN 会将其重置为其默认的自由奔放的行为。

具有讽刺意味的是，这是来自阅读我最初使用的 Resizer 控件的代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-12-14T16:41:35.380

回答这个问题有点晚（2 年以上），但是，嘿，迟到总比没有好，对吧？

无论如何，我遇到了这个确切的问题，并且能够通过一些代码隐藏来解决它以保存和重置列宽。

我有一个 3 列网格，第一列中有一些内容，第二列中有 GridSplitter，第三列中有 Expander。看起来正在发生的事情是，在移动 GridSplitter 后，包含 Expander 的列的宽度从 Auto 更改为固定大小。这会导致 Expander 不再按预期折叠。

因此，我添加了一个私有变量和两个事件处理程序：

```
 private GridLength _columnWidth;

    private void Expander_Expanded (object sender, RoutedEventArgs e)
    {
        // restore column fixed size saved in Collapse event
        Column2.Width = _columnWidth;
    }

    private void Expander_Collapsed (object sender, RoutedEventArgs e)
    {
        // save current column width so we can restore when expander is expanded
        _columnWidth = Column2.Width;

        // reset column width to auto so the expander will collapse properly
        Column2.Width = GridLength.Auto;
    } 
```

当 Expander 折叠时，我保存 Column2 的固定宽度（在后台某处从 Auto 自动更改），然后将宽度重置为 Auto。

然后，当展开器展开时，我将列恢复为固定宽度，使其展开到与折叠前相同的宽度。

这是供参考的 XAML：

```
<Grid>
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="2*" />
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition x:Name="Column2" Width="Auto" />
    </Grid.ColumnDefinitions>
    <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">
        <!-- some content goes here -->
    </ScrollViewer>
    <GridSplitter HorizontalAlignment="Right" VerticalAlignment="Stretch"
         Grid.Column="1" ResizeBehavior="PreviousAndNext" Width="5"
         Background="Black" />
    <Expander Grid.Column="2" ExpandDirection="Left"
         IsExpanded="True" Style="{StaticResource LeftExpander}"
         Expanded="Expander_Expanded" Collapsed="Expander_Collapsed">
        <Grid>
            <TextBox TextWrapping="Wrap" Height="Auto" Margin="0 5 5 5" />
        </Grid>
    </Expander>
</Grid> 
```

# javascript - 网站检查用户是否安装了客户端应用程序的最佳方法是什么？

> ID：159476
> 
> 赞同：2
> 
> 时间：2008-10-01T20:09:46.927
> 
> 标签：javascript, html, flash, installation, client

假设我有一个网站，如果客户端已安装并登录到桌面应用程序，效果会更好。我希望能够做两件事：

*   如果他们尚未安装应用程序，请更改网站（以便他们轻松找到安装程序的链接）
*   如果他们在几台机器上安装了应用程序，请确定他们正在从哪台机器上浏览

我想要在 Windows 和 OSX 上运行的东西，在任何主要浏览器上。Linux 是一个奖励。

一些想法：

*   网站可以检测您是否安装了 Flash。它是如何工作的，它可以用于我的两个目标吗？
*   我可以让客户端在 localhost 上提供 HTTP 并执行一些 javascript 请求来获取本地 ID 吗？我知道谷歌桌面搜索曾经做过类似的事情。这是标准做法吗？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T20:20:26.353

您可以从您的桌面应用程序注册一个协议（请参阅[此](http://www.nextbigleap.com/blog/development/want-to-run-a-desktop-application-using-your-own-protocol-eg-mylovelprotocol/)）。例如，这可用于使用来自网站的任意数据打开您的桌面应用程序。然后你可以让你的桌面应用程序向你的网络服务器发送一个 HTTP 请求，告诉它你在哪台机器上。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T20:16:40.217

您可以拥有一个可以与应用程序通信的浏览器插件（用于 IE 的 activex 或用于其余浏览器的 Netscape 插件）。当网页加载时，它可以尝试实例化插件，如果成功，它可以将其用作应用程序的代理。如果失败，则说明应用程序未安装或插件被用户明确禁用。无论哪种方式，您的网站都应该相应地降低其功能。

**更新**：忘记回答您的问题：

1.  Flash 正是这样做的。Flash 是由网页创建的浏览器插件。
2.  您可以在应用程序/插件安装时生成机器 ID，并且您的插件可以在创建时将该机器 ID 传递给网页。

**关于使用本地网络服务器的主题**：

我会远离拥有本地网络服务器，主要是出于安全考虑。需要做大量工作才能确保您的本地网络服务器被充分锁定，并且没有其他恶意网站可以利用的 XSS 漏洞使其代表他们做事。

另外，拥有一个网络服务器意味着它必须作为系统范围的进程运行，或者如果它作为用户运行，您可以让网站只与一个用户的应用程序实例交互，即使可以登录多个用户并同时运行它。

谷歌桌面搜索遭受了 XSS 安全漏洞（尽管他们修复了它）和只有一个用户能够在机器上使用它的限制（我不知道他们是否修复了这个问题，尽管他们很有可能做到了） .

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T20:20:28.087

> > 网站可以检测您是否安装了 Flash。

实际上，我相信浏览器可以检测您是否安装了浏览器的Flash插件，并且网页可以提供浏览器可以选择的“已安装”和“已卸载”选项。

否则，您正在寻求一种方法，通过在网页中放置一些代码，能够分析用户的家用计算机，并将它学到的内容报告给您的网站。

你能说**主要安全漏洞**吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T20:17:24.177

如果您可以为桌面应用程序选择开发环境，请查看 Adob​​e 的 AIR。它允许您使用 html/javascript、Flash 或 Flex 开发桌面应用程序。

它具有 API 调用，您可以从基于浏览器的 flash 应用程序中使用，以查看是否安装了基于桌面的 AIR 应用程序、版本等。您甚至可以启动它并将参数从 Web 应用程序传递到桌面应用程序。

[http://www.rogue-development.com/blog2/2008/03/interacting-with-an-air-app-from-a-browser-based-app/](http://www.rogue-development.com/blog2/2008/03/interacting-with-an-air-app-from-a-browser-based-app/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T20:21:41.453

> 网站可以检测您是否安装了 Flash。它是如何工作的，它可以用于我的两个目标吗？

这很简单，您的浏览器会尝试渲染一些其他文件，使用某些特定格式，例如 flash `.swf`，而我的浏览器没有找到安装，然后将开始下载，或者您将获得下载该程序的选项。Flash 也用`AC_RunActiveContent.js`请看一下这个js，人们通常把这个放在他们的网页上

```
if (AC_FL_RunContent == 0) {
    alert("This page requires AC_RunActiveContent.js.");
} else {
    AC_FL_RunContent( 'codebase','http://download.macromedia.com/pub/shockwave cabs/flash swflash.cab#version=8,0,0,0','width','981','height','635','id','build5','align','middle','src','build5','quality','high','bgcolor','#ffffff','name','build5','allowscriptaccess','sameDomain','allowfullscreen','false','pluginspage','http://www.macromedia.com/go/getflashplayer','movie','build5' ); //end AC code
} 
```

# css - 无法让 CSS Sticky 页脚工作。我究竟做错了什么？

> ID：159487
> 
> 赞同：4
> 
> 时间：2008-10-01T20:12:54.907
> 
> 标签：css, footer, sticky

好吧，这是我在这里的第一篇文章，真的很喜欢这个网站。

我已经开始了一个非常基本的（丑陋的罪恶）网站，由于某种原因，我无法让 CSS Sticky 页脚为 FireFox 工作。IE 工作，但 FF 显示它在页面的一半。

网址是[http://dev.aipoker.co.uk](http://dev.aipoker.co.uk)

我知道我应该在 FF 中开发并在 IE 中修复错误，所以我猜我可能实际上犯了一个错误，并且它在 IE 中可以工作，但在其他地方没有。

任何人都可以帮助我摆脱痛苦吗？

谢谢，伙计们。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-01T20:30:14.380

我用这样的代码取得了成功：

```
footer { 
  display: block; 
  position: absolute; 
  width: 100%; 
  bottom: 0px; 
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T20:16:47.767

试试这个[，](http://boagworld.com/dev/fixed-footers-without-javascript/)它在 Firefox 上运行良好。

顺便说一句，如果您还没有收听 Boagworld 的播客，您应该收听。这个棒极了！:)

干杯。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T20:50:14.037

我能看到的最小变化是：

*   将页脚部分移动到正文内
*   在 body 和 footerSection 上设置绝对位置
*   在 footerSection 上设置底部 = 0px

最终在您的脑海中会出现这样的情况：

```
<style type="text/css">
  #body, #footerSection { position: absolute; }
  #footerSection { bottom: 0px; }
</style>

<div id="body">
   ...
   <div id="footerSection">
      ...
   </div>
</div> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-04-04T17:20:51.417

这是**您需要了解**的有关仅 CSS 粘性页脚和粘性导航的所有信息：

贴在页面底部

```
Position: absolute;
top:auto;
bottom: 0; 
```

贴在屏幕底部

```
Position: fixed;
top:auto;
bottom:0; 
```

任何问题，这可能是由于您放置 html 代码的位置（不要将页脚作为子元素，除非它粘在内容包装器上）或重叠的 CSS。

您可以通过翻转自动和顶部将相同的技术应用于粘性导航。它是跨浏览器兼容的（来自 IE7 及更高版本的内存），包括手机。

# javascript - Scriptaculous 可排序矩阵

> ID：159491
> 
> 赞同：2
> 
> 时间：2008-10-01T20:14:43.433
> 
> 标签：javascript, sorting, scriptaculous

我正在尝试使用 scriptaculous javascript 库创建一个可排序的图像矩阵，5x5，但我无法使其工作。

我正在尝试使用表格，但无法将其链接`<td>`到可排序对象。

你们有什么提示或文档我可以通过它来创建吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T20:29:51.620

使用浮动 DIV，而不是表格。

1）在你的样式表中为你的盒子创建一个类。

```
.boxes {
  float:left;
  width:150px;
  height:150px;
  border:1px solid #cccccc
} 
```

2）为您的盒子制作一个容器。并把盒子放进去。

```
<div id='container' style='width:750px;height:750px;'>
<div id='box1' class='boxes'></div>
...etc
</div> 
```

3）让你的排序

```
Sortable.create('container',{tag:'div'}) 
```

有一个这种类型的演示可用[here](http://github.com/madrobby/scriptaculous/wikis/puzzle-demo)。

如果您需要更多帮助，请给我留言。

# user-interface - 哪些语言有好的 GUI API/Designer？

> ID：159492
> 
> 赞同：6
> 
> 时间：2008-10-01T20:14:45.930
> 
> 标签：user-interface, gui-designer

一段时间以来，我一直想精通一门新语言。我想学习几种语言，但能够创建（应用程序）GUI 对我来说非常重要。我在 C# 中工作，所以我已经非常习惯于 GUI 设计器。

我很想在 C++ 或 Java 方面做得更好（我对这两者都有少量经验）。其他语言也可能很有趣。我真的需要能够相当容易地制作一个 GUI。

那么什么（非.net）语言具有设计 GUI 的真正好方法？

这个问题的扩展可能是最常见的 GUI API/设计器是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-01T20:19:11.817

我建议你看看德尔福。它是一个带有良好 IDE 和良好社区的 object pascal！

看看[www.codegear.com](http://www.codegear.com)

CodeGear 也有一个 C++ IDE，所以你可以拥有这个包并在 Delphi 和 C++ 中动手！

希望他的帮助

冰山

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-01T20:22:53.243

我同意 pmlarocque 的观点，如果使用 Java，您应该使用 NetBeans。它确实使 GUI 设计变得容易。

顺便说一句，我还推荐铅笔和纸。多年来，这确实帮助了我，开始绘制你想要的草图，然后在 IDE 中复制它。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-01T20:29:34.647

For GUI in C++ you should look C++ Builder, you can get [Turbo C++](http://turboexplorer.com) Explorer for free

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-01T20:19:08.417

我可以推荐[Flex](http://flex.org/)吗？Flex Builder 有一个非常好的 GUI 设计器。
对于 Java，[NetBeans](http://www.netbeans.org/)和[Eclipse](http://www.eclipse.org/downloads/) IDE 都是不错的选择。要在 Java 中设计 GUI，您可以使用[SWT](http://en.wikipedia.org/wiki/Standard_Widget_Toolkit)、[AWT](http://en.wikipedia.org/wiki/Abstract_Windowing_Toolkit)或[Swing](http://en.wikipedia.org/wiki/Swing_(Java))小部件工具包。

我听说有些人在 NetBeans 上运行 SWT 项目时遇到了问题。但是，NetBeans 带有一个内置的用于 Swing 的 GUI Builder，这是一个非常强大的小部件工具包。当然，还有一个用于 Eclipse 的[插件，](http://eclipse-plugins.info/eclipse/plugin_details.jsp?id=374)它允许您构建 Swing GUI，所以它基本上归结为您喜欢哪个 IDE...

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-01T20:26:01.707

I use both Visual Studio and Delphi, and the Delphi GUI editor is significantly better. It is worth a try. They make a [free version](http://www.turboexplorer.com/delphi).

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-11-12T01:35:32.900

跨平台的 Qt GUI 框架（主要用于 C++）随[Qt Designer](http://doc.trolltech.com/4.3/designer-manual.html)一起提供。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-01T20:24:52.117

NetBeans 有一个很棒的 Swing GUI Builder（以前称为 Project Matisse）。这是针对 Java 的，我认为它是由 Sun 发起的，但它是一个开源项目。与 Eclipse 非常相似，但由于这个 GUI 构建器，我发现了 NetBeans 的优势。

查看： http: [//www.netbeans.org/features/java/swing.html](http://www.netbeans.org/features/java/swing.html)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-27T22:24:33.753

Interface Builder 和 Qt Designer 是迄今为止我用过的最好的 GUI 设计工具。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-01T22:45:57.657

Not as big as it used to be, but Powerbuilder.

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-01T22:53:24.987

[Visual Dataflex](http://www.visualdataflex.com/ "Visual Dataflex") has a decent GUI editor. It's a nice solution for building "database-agnostic" database applications.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-01T20:30:03.633

WPF/Silverlight: [Expression](http://www.microsoft.com/expression) Blend

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-19T14:06:06.757

好吧，我有两个选择： 使用 Cocoa GUI 框架的*Mac*上的**Objective-C** ，或使用 Swing API 的**Java**（*Mac、Linux、MS-Windows ）。*

 ****如果您想在面向 Apple Macintosh、iPhone 或 iPod Touch 的 Mac OS X 操作系统的 Objective-C 中进行编程，那么与 Xcode IDE（开发包的一部分）捆绑在一起的 Interface Builder 非常好。

当然，您需要一台 Mac 才能使用它。如果您已经有一台 Linux 或 Windows PC，那么您可能有一台显示器、USB 鼠标和 USB 键盘。所以你可以花 599 美元买一台 Mac Mini，然后把它们连接起来。

开发人员捆绑包是免费的。获得 Mac 后，只需访问[developer.apple.com](http://developer.apple.com/)并注册免费的开​​发者工具即可。

如果您打算成为一名专业开发人员，那么您可能想在获得 Macintosh 之前去那里看看是否注册为 Pro 并购买 Macintosh 以及该交易下的东西是否会为您带来更多收益。

Apple 的这个 Interface Builder 非常有名。NeXT 计算机以其快速创建应用程序的方式而享有盛誉。华尔街金融公司、政府机构和研究类型——加上相当数量的第三方商业软件开发商——使用它来非常快速地创建 GUI 应用程序。

顺便说一下，Apple 的 Cocoa 框架的名称曾经是 Next Step。当苹果从史蒂夫乔布斯手中收购 NeXT 时，他们将其更名为 Next Step Cocoa。然而，这些课程仍然以 NS 作为其传统的小神器开始。

人们喜欢 Interface Builder 的地方在于它有一个非常好的布局管理器，它可以让你将 UI 对象“连接”到其他对象，使后者成为“目标”。以这种方式将它们连接在一起会创建一个“连接”。

到目前为止，这听起来很平淡，我知道。但是，当您开始这样做时，它会变得令人兴奋。您可以在设计器中设计实际可运行的 GUI，并在编写任何代码之前实际运行它。编写代码可以让您逐步充实用户界面，其行为多于 UI 刺激响应行为。

无论如何，这个想法是你可以非常快速地制作一个原型，根据这个具体的 GUI 从某人那里获得反馈——然后用 Objective-C 编程来填充细节。

用 Next Step (Cocoa) 创建的最著名的东西是万维网 (WWW)。你可能听说过。嗯，世界上第一个 Web 浏览器是由 CERN 的 Tim Berniers-Lee 于 1989 年使用 Next Step 创建的，该浏览器在前一年（1988 年）刚刚问世。

他说他喜欢 Next Step，因为它让他能够非常快速地创建自己的网络浏览器。更令人印象深刻的是，他的网络浏览器不仅允许用户*查看*网页——他的浏览器还允许用户**编辑**他们查看的网页。

如果你想用 Java 编程，NetBeans 有一个非常好的 Swing GUI 设计器。

它内置在 NetBeans 中。GUI 设计器非常易于使用，并且似乎拥有一整套功能。我自己不喜欢的是它将注释部分放在您无法编辑的代码中。JBuilder 没有加入那些恼人的评论/限制，但 JBuilder 这些天几乎已经从场景中消失了。

NetBeans 的另一个缺点是它会创建一个与您正在编辑的 GUI 类同名的 .form 文件。Java 代码重构工具，除了 NetBeans，不会知道这个文件。因此，如果您手动移动该类所属的包（或重命名该类） - 或使用 Eclipse 或其他程序来执行此操作 - 您将会遇到问题。您需要确保使用 NetBeans 移动/重命名您的类。

Eclipse 有一个实验性插件形式的插件，这对于几年前名为 VE（可视化编辑器）的 GUI 设计师来说是一个不错的开始。但是，VE 似乎在几年内没有更新。

我真的很喜欢 Java 程序的真正可移植性。带有 GUI 的 Java 程序也不例外。

我建议采用 Java 作为您的新语言并使用 NetBeans 作为您的第一个 IDE，因为您喜欢使用所见即所得编辑器进行 GUI 程序设计。

后来，我建议你也学习 Eclipse。这样，您将受益于其更强大的代码编辑/重构功能。

您不必在两个 IDE 之间做出非此即彼的选择。有一些警告，就像我给出的那样 - 你可以同时使用两者。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-27T22:21:37.613

使用 Microsoft Expression Blend 来布局您的 GUI。

WPF...

之前，我使用的是 Qt Designer。第一次开始使用 Expression Blend，我就爱上了它。比 Qt Designer 更容易使用。

如果您的应用程序需要高性能，请使用一些本机代码语言（如 C++）作为后端。

如果没有，请坚持使用 C# 或 Python。

请记住，这不仅仅是您使用的工具，而是它作为一个*整体的工作方式*

不同语言/供应商的太多组合有时只会让你想把头发拉到我们的！

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-01T20:18:13.677

Netbeans IDE for Java 作为一个可爱的 GUI 设计器。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-01T20:25:04.407

[wxGlade](http://wxglade.sourceforge.net/)是一个 GUI 设计器，可以生成 Python、C++、Perl 或 Lisp，并使用[wxWidgets](http://wxwidgets.org/)库。它是免费的。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-01T20:25:45.763

Java Netbeans 很好，而且由于 java 在语法上与 c# 相当接近，它可能会带来轻松的学习体验

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-11-27T22:28:09.753

适用于 Java 的 IntelliJ IDEA

[http://www.jetbrains.com/idea/features/gui_builder.html](http://www.jetbrains.com/idea/features/gui_builder.html)

这是一个视频：

[http://www.javalobby.org/eps/intellij_ui_designer/](http://www.javalobby.org/eps/intellij_ui_designer/)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-03-06T21:36:52.897

既然你提到你使用 C++，我推荐 MatDeck（[https://labdeck.com/comparison/](https://labdeck.com/comparison/)）。他们在其独特的代码中提供了一个 GUI 设计器。他们的代码基于 C++（它被称为 MatDeck C++ 风格的代码），并且由于它专门用于他们的软件，因此运行所需的代码要少得多。它们提供更多功能，并且是成熟的软件。他们还有一个完整的页面来比较他们的代码（[https://labdeck.com/python/c-style-script/](https://labdeck.com/python/c-style-script/)）。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-05-08T05:59:29.423

# 瓦丁

![](https://upload.wikimedia.org/wikipedia/commons/a/ad/Vaadin-logo-hi.png)

[您可以在服务器端仅使用Java](https://en.wikipedia.org/wiki/Java_%28programming_language%29)编写面向业务的桌面样式 Web 应用程序，但在 Web 浏览器中使用 Web 标准客户端自动呈现。

[Vaadin 框架](https://vaadin.com/framework)提供了让您在布局中定义所需字段、标签、按钮和其他小部件的魔力，所有这些都使用纯 Java 。通过利用[GWT](https://en.wikipedia.org/wiki/Google_Web_Toolkit)技术，Vaadin 在运行时将您的 Java 代码转换为内容，以便在用户的 Web 浏览器中显示。[您的应用程序使用HTTP](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol)、[HTTP/2](https://en.wikipedia.org/wiki/HTTP/2)、[HTML](https://en.wikipedia.org/wiki/HTML)、[HTML5](https://en.wikipedia.org/wiki/HTML5)、[CSS](https://en.wikipedia.org/wiki/Cascading_Style_Sheets)、[DOM](https://en.wikipedia.org/wiki/Document_Object_Model)、[JavaScript](https://en.wikipedia.org/wiki/JavaScript)、[WebSocket](https://en.wikipedia.org/wiki/WebSocket)、[Push](https://en.wikipedia.org/wiki/Push_technology)的所有 Web 优点呈现，等等……但对 Java 程序员来说是透明的。所有这些转变都是在幕后完成的。作为一名 Vaadin 程序员，我所处理的只是 Java 编码。

[![在此处输入图像描述](https://i.stack.imgur.com/ymWUG.png)](https://i.stack.imgur.com/ymWUG.png)

我更喜欢使用[文档齐全的 API](https://vaadin.com/docs/-/part/framework/introduction/intro-overview.html)以编程方式为用户界面[布局](https://vaadin.com/docs/-/part/framework/layout/layout-overview.html)表单和[小部件的内容。](https://vaadin.com/docs/-/part/framework/components/components-overview.html)您可以使用开源框架免费执行此操作。

或者，您可以使用他们的商业产品[*Vaadin Designer*](https://vaadin.com/designer)作为可视化拖放布局编辑器工具。

尝试现场[采样器](https://demo.vaadin.com/sampler/)和[其他演示](https://vaadin.com/demo)，例如[Reindeer 演示](https://demo.vaadin.com/ReindeerTheme)。

# wpf - 设置 ListBox 的滚动条位置

> ID：159506
> 
> 赞同：10
> 
> 时间：2008-10-01T20:18:58.463
> 
> 标签：wpf, listbox, scrollviewer

我可以以编程方式设置 WPF ListBox 滚动条的位置吗？默认情况下，我希望它位于中心。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-06-12T16:08:00.273

要在 ListBox 中移动垂直滚动条，请执行以下操作：

1.  命名您的列表框 (x:Name="myListBox")
2.  为窗口添加 Loaded 事件 (Loaded="Window_Loaded")
3.  使用方法实现 Loaded 事件：ScrollToVerticalOffset

这是一个工作示例：

XAML：

```
<Window x:Class="ListBoxScrollPosition.Views.MainView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  Loaded="Window_Loaded"
  Title="Main Window" Height="100" Width="200">
  <DockPanel>
    <Grid>
      <ListBox x:Name="myListBox">
        <ListBoxItem>Zamboni</ListBoxItem>
        <ListBoxItem>Zamboni</ListBoxItem>
        <ListBoxItem>Zamboni</ListBoxItem>
        <ListBoxItem>Zamboni</ListBoxItem>
        <ListBoxItem>Zamboni</ListBoxItem>
        <ListBoxItem>Zamboni</ListBoxItem>
        <ListBoxItem>Zamboni</ListBoxItem>
        <ListBoxItem>Zamboni</ListBoxItem>
        <ListBoxItem>Zamboni</ListBoxItem>
        <ListBoxItem>Zamboni</ListBoxItem>
        <ListBoxItem>Zamboni</ListBoxItem>
        <ListBoxItem>Zamboni</ListBoxItem>
      </ListBox>
    </Grid>
  </DockPanel>
</Window> 
```

C＃

```
private void Window_Loaded(object sender, RoutedEventArgs e)
{
  // Get the border of the listview (first child of a listview)
  Decorator border = VisualTreeHelper.GetChild(myListBox, 0) as Decorator;
  if (border != null)
  {
    // Get scrollviewer
    ScrollViewer scrollViewer = border.Child as ScrollViewer;
    if (scrollViewer != null)
    {
      // center the Scroll Viewer...
      double center = scrollViewer.ScrollableHeight / 2.0;
      scrollViewer.ScrollToVerticalOffset(center);
    }
  }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T20:31:52.287

```
Dim cnt as Integer = myListBox.Items.Count
Dim midPoint as Integer = cnt\2
myListBox.ScrollIntoView(myListBox.Items(midPoint)) 
```

或者

```
myListBox.SelectedIndex = midPoint 
```

这取决于您是否想要刚刚显示或选择的中间项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-06-25T20:12:29.127

我刚刚更改了 Zamboni 的一些代码并添加了位置计算。

```
var border = VisualTreeHelper.GetChild(list, 0) as Decorator;
if (border == null) return;
var scrollViewer = border.Child as ScrollViewer;
if (scrollViewer == null) return;
scrollViewer.ScrollToVerticalOffset((scrollViewer.ScrollableHeight/list.Items.Count)*
                                    (list.Items.IndexOf(list.SelectedItem) + 1)); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-12-05T03:06:00.040

我有一个名为 MusicList 的 ListView。MusicList 在播放音乐后自动移动到下一个元素。我为 Player.Ended 事件创建了一个事件处理程序，如下所示（a la Zamboni）：

```
 if (MusicList.HasItems)
    {
        Decorator border = VisualTreeHelper.GetChild(MusicList, 0) as Decorator;
        if (border != null)
        {
            ScrollViewer scrollViewer = border.Child as ScrollViewer;
            if (scrollViewer != null)
            {
                MusicList.ScrollIntoView(MusicList.SelectedItem);
            }
        }
    } 
```

您会在底部看到下一个元素。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-01T20:23:30.247

我不认为 ListBoxes 有，但 ListViews 有[EnsureVisible](http://msdn.microsoft.com/en-us/library/system.windows.forms.listview.ensurevisible.aspx)方法，可以将滚动条移动到所需的位置，以确保显示项目。

# .net - 松散 XAML 的限制是什么？

> ID：159512
> 
> 赞同：3
> 
> 时间：2008-10-01T20:20:07.010
> 
> 标签：.net, wpf, data-binding, xaml, seo

我一直在试验 WPF 并在 Web 浏览器中呈现严格的 XAML 标记，也称为松散 XAML（[在此处](http://blogs.msdn.com/tims/archive/2005/09/21/472659.aspx)和[此处](http://michaelbraude.com/index.php?XML/Projects/XAMLXSLT/XAMLXSLT_page1.xml)进行解释）。

我觉得它对显示静态内容最有用。但是，似乎也可以绑定到 XML 数据提供者。

松散的 XAML 文件不使用应用程序编译，这会产生以下限制：

*   他们不允许外部程序集
*   不使用类、代码隐藏（或任何 C#）
*   没有双向数据绑定

还有哪些额外限制？

*   我还没有找到一种将数据绑定到数据库提供程序（SQL Server）的方法
*   客户端计算机上是否需要 .NET Framework 才能在浏览器中呈现 XAML？
*   搜索引擎是否能够询问 Loose XAML 以适当地对页面进行排名？

编辑：我试图将 XML 数据提供程序绑定到 Web 服务（使用[这个](http://developer.yahoo.com/dotnet/howto-wpf_xaml.html)简单的示例）并且没有成功。这些发现使我进一步研究，发现不支持：“XMLDataProvider 被设计为只读的（换句话说，它不提供提交更改的能力），并且它不能处理可能来自其他来源（如数据库记录、Web 服务消息等）的 XML 数据。” -Matthew MacDonald，*专业 WPF*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T21:11:50.897

在 IE 中查看松散的 XAML 页面至少需要 framework 3.0。您甚至可以通过在用户代理字符串中查找“.NET CLR 3.0”来在您的站点上检查它。

数据库连接（如果可能的话）不会直接在松散的 XAML 中完成，因为需要过程代码来打开连接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-02T09:29:57.003

AFAIK 不可能在 XAML 中定义连接字符串。所以你不能访问你的 SQL 数据库。

注意：可以使用 XmlDataProvider 将数据绑定到 Web 服务。所以这可能是您可以通过...发送数据的一种方式

编辑：顺便说一句，我找到[了沙盒环境的功能列表，](http://scorbs.com/2006/11/09/wpf-internet-sandbox-feature-list-xbaps-loose-xaml)当使用 XBAP 和松散的 XAML 时，您的应用程序正在其中运行。它有点过时了，但可能大多数限制仍然适用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T23:18:58.100

我在托管动态语言运行时 (DLR) 和允许将脚本嵌入 XAML 方面做了大量工作。我现在觉得 Loose XAML 不是二等公民，因为我可以处理事件、编写值转换器、运行 Python/Ruby/JScript 来执行诸如连接到 SQL 服务器之类的事情。

查看我的[博客](http://www.thinkbottomup.com.au/site/blog/Embedding_DLR_Scripts_in_XAML_Part_1)，看看这个方向是否适合你。

我使用附加属性动态加载程序集——一旦加载，您可以以通常的方式引用程序集中的类。

所以，也回答这个问题，Loose XAML 有很多开箱即用的限制（比如不能将事件路由到事件处理程序），但是这些可以通过一些工作来克服。

我只将 XAML/WPF 用于桌面应用程序。希望其他人能够回答您浏览器特定的问题。

我有一个库，我在商业工作中使用 DLR 托管和在 XAML 中嵌入 DLR 脚本，我一直想将它变成受支持的产品。如果您对此感兴趣，请务必告诉我。

# .net - 如何使用 .NET 2 System.Configuration.Install 检测更新？

> ID：159513
> 
> 赞同：4
> 
> 时间：2008-10-01T20:20:14.077
> 
> 标签：.net, visual-studio, installation

我为我的安装程序创建了一个派生自 System.Configuration.Install 的类。
但是当我尝试更新应用程序时，正在调用 Uninstall() 中的代码。
如何检测到用户正在尝试更新而不是卸载？

也许[这篇文章](http://www.microsoft.com/communities/newsgroups/en-us/default.aspx?dg=microsoft.public.dotnet.languages.csharp&tid=a018d064-8bb8-441d-bccc-f5ce2cc665eb&cat=&lang=&cr=&sloc=&p=1)比我解释得更好：

> 我的问题归结为：当用户执行更新时（即，当他们已经安装了 MyAppVer1.msi 时双击 MyAppVer2.msi）首先调用我的 Installer 中的 Uninstall 方法，但我没有明显的属性可以从中检查方法来检测正在执行更新，以便我可以适当地分支我的代码。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-03T17:54:49.187

在你的安装项目中有一个设置会默认“卸载”以前的版本，关闭这个标志，你就不用担心了！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T20:32:12.113

Blind guess here, but I'd start out by checking the [Installer.Context](http://msdn.microsoft.com/en-us/library/system.configuration.install.installer.context.aspx) property for a [parameter](http://msdn.microsoft.com/en-us/library/system.configuration.install.installcontext.parameters.aspx). If that's no help, there may be something in the savedState parameter passed to [Uninstall](http://msdn.microsoft.com/en-us/library/system.configuration.install.installer.uninstall.aspx).

Last chance would be to [prompt the user](http://msdn.microsoft.com/en-us/library/068e5k1w.aspx), and set the child installers as appropiate.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T20:38:19.913

The deployment project that ships with Visual Studio is SEVERELY underpowered to deal with anything beyond the simpiliest scenarios.

In your case, you'll need to do one of the following:

1.  Figure out a way to set a flag prior to the original MSI being uninstalled, which you can check in the installer class.
2.  Prompt the user visually in the installer class.
3.  Redesign your install/uninstall logic to not be dependant on the situation in which the uninstaller was called.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T18:20:47.327

有什么不能使用 WIX 的原因吗，它可以更有效地处理这类事情，看看升级教程，[这里](http://www.tramontana.co.hu/wix/lesson4.php)

# windows - 文本编辑器打开大（巨型，巨大，大）文本文件

> ID：159521
> 
> 赞同：1022
> 
> 时间：2008-10-01T20:22:35.133
> 
> 标签：windows, xml, editor, text-editor, large-files

我的意思是 100+ MB 大；这样的文本文件可以推动编辑的信封。

我需要查看一个大的 XML 文件，但如果编辑器有问题，我就不能。

有什么建议么？

* * *

## 回答 #1

> 赞同：1553
> 
> 时间：2008-10-01T20:25:19.993

免费只读查看器：

*   [**大文本文件查看器**](https://web.archive.org/web/20140908181354fw_/http://swiftgear.com/ltfviewer/features.html)(Windows) – 完全可定制的主题（颜色、字体、自动换行、标签大小）。支持水平和垂直拆分视图。还支持文件跟踪和正则表达式搜索。非常快速、简单，并且可执行文件很小。
*   [**klogg**](https://klogg.filimonov.dev/) (Windows, macOS, Linux) – 一个维护的[glogg 分支](https://glogg.bonnefon.org/description.html)。它的主要特点是正则表达式搜索。它支持监视文件更改（如`tail`）、书签、使用不同颜色突出显示模式，并且内置了严重的优化。但从 UI 的角度来看，它相当小。
*   [**LogExpert**](https://github.com/zarunbal/LogExpert) (Windows) – “. 的 GUI 替代品`tail`” 它实际上是一个日志文件分析器，而不是一个大文件查看器，在一次测试中，它需要 10 秒和 700 MB 的 RAM 来加载一个 250 MB 的文件。但它的杀手级功能是分栏器（解析 CSV、JSONL 等格式的日志并以电子表格格式显示）和荧光笔（以特定颜色显示带有特定单词的行）。还支持文件跟踪、选项卡、多文件、书签、搜索、插件和外部工具。
*   [**Lister**](https://www.ghisler.com/lister/) (Windows) – 非常小且极简。它是一个可执行文件，只有 500 KB，但它仍然支持搜索（使用正则表达式）、打印、十六进制编辑器模式和设置。

免费编辑：

*   您的常规编辑器或 IDE。现代编辑器可以处理惊人的大文件。特别是[**Vim**](https://neovim.io/) (Windows, macOS, Linux), [**Emacs**](https://www.gnu.org/software/emacs/) (Windows, macOS, Linux), [**Notepad++**](https://notepad-plus-plus.org/) (Windows), [**Sublime Text**](https://www.sublimetext.com/) (Windows, macOS, Linux), 和[**VS Code**](https://code.visualstudio.com/) (Windows, macOS, Linux) 支持大 (~ 4 GB) 文件，假设您有 RAM。
*   [**大文件编辑器**](https://www.liquid-technologies.com/large-file-editor)(Windows) – 打开和编辑 TB+ 文件，支持 Unicode，使用很少的内存，具有 XML 特定的功能，并包括二进制模式。
*   [**GigaEdit**](https://heliwave.github.io/GigaEdit.html) (Windows) – 支持搜索、字符统计和字体自定义。但它有问题——对于大文件，它只允许覆盖字符，而不是插入它们；它不尊重 LF 作为行终止符，只有 CRLF；而且很慢。

内置程序（无需安装）：

*   [**less**](https://en.wikipedia.org/wiki/Less_(Unix)) (macOS, Linux) – 传统的 Unix 命令行分页工具。让您查看几乎任何大小的文本文件。也可以安装在 Windows 上。
*   [**记事本**](https://en.wikipedia.org/wiki/Microsoft_Notepad)(Windows) – 适合大文件，尤其是关闭自动换行。
*   [**MORE**](https://ss64.com/nt/more.html) (Windows) – 这是指 Windows`MORE`，而不是 Unix`more`。一个控制台程序，允许您一次查看一个屏幕的文件。

网络浏览器：

*   [**readfileonline.com**](https://www.readfileonline.com/) – 另一个 HTML5 大文件查看器。支持搜索。

付费编辑/观众：

*   [**010 编辑器**](https://www.sweetscape.com/010editor/)（Windows、macOS、Linux）– 打开巨型（最大 50 GB）文件。
*   [**SlickEdit**](https://www.slickedit.com/products/slickedit)（Windows、macOS、Linux）——打开大文件。
*   [**UltraEdit**](https://www.ultraedit.com/) (Windows, macOS, Linux) – 打开超过 6 GB 的文件，但必须更改配置才能实用：菜单 » 高级 » 配置 » 文件处理 » 临时文件 » 打开没有临时文件的文件...
*   [**EmEditor**](https://www.emeditor.com/) (Windows) - 可以很好地处理非常大的文本文件（官方最高可达 248 GB，但根据一份报告，最高可达 900 GB）。
*   [**BssEditor**](https://www.bergstreiser.com/bsseditor) (Windows) - 处理大文件和很长的行。不需要安装。免费用于非商业用途。
*   [**loxx**](https://www.mommos-software.com/index.php/loxx) (Windows) – 支持文件跟踪、突出显示、行号、大文件、正则表达式、多个文件和视图等等。免费版不能：处理正则表达式、过滤文件、同步时间戳和保存更改的文件。

* * *

## 回答 #2

> 赞同：207
> 
> 时间：2009-08-27T20:25:59.390

# 技巧和窍门

## 较少的

您为什么使用*编辑器*来*查看*（大）文件？

在 *nix 或[Cygwin](http://en.wikipedia.org/wiki/Cygwin)下，只需使用[less](http://linux.die.net/man/1/less)。（有一句名言——“少即是多，或多或少”——因为“less”取代了早期的 Unix 命令“more”，另外还可以向上滚动。）在 less 下搜索和导航非常类似于Vim，但没有交换文件并且使用的 RAM 很少。

GNU less 有一个 Win32 端口。请参阅上面答案的“更少”部分。

## Perl

Perl 非常适合快速编写脚本，它的`..`（范围触发器）运算符提供了一个很好的选择机制来限制你必须涉足的杂物。

例如：

```
$ perl -n -e 'print if ( 1000000 .. 2000000)' humongo.txt | less 
```

这将提取从 100 万行到 200 万行的所有内容，并允许您手动筛选输出。

另一个例子：

```
$ perl -n -e 'print if ( /regex one/ .. /regex two/)' humongo.txt | less 
```

当“正则表达式一”找到某些东西时，它开始打印，并在“正则表达式二”找到有趣块的结尾时停止。它可能会找到多个块。筛选输出...

## 日志解析器

这是您可以使用的另一个有用的工具。引用[维基百科的文章](https://en.wikipedia.org/wiki/Logparser)：

> **logparser**是一个灵活的命令行实用程序，最初由 Microsoft 员工 Gabriele Giuseppini 编写，用于自动测试 IIS 日志记录。它旨在与 Windows 操作系统一起使用，并包含在 IIS 6.0 资源工具包工具中。logparser 的默认行为类似于“数据处理管道”，通过在命令行上获取 SQL 表达式，并输出包含 SQL 表达式匹配的行。
> 
> Microsoft describes Logparser as a powerful, versatile tool that provides universal query access to text-based data such as log files, XML files and CSV files, as well as key data sources on the Windows operating system such as the Event Log, the Registry, the file system, and Active Directory. The results of the input query can be custom-formatted in text based output, or they can be persisted to more specialty targets like SQL, SYSLOG, or a chart.

Example usage:

```
C:\>logparser.exe -i:textline -o:tsv "select Index, Text from 'c:\path\to\file.log' where line > 1000 and line < 2000"
C:\>logparser.exe -i:textline -o:tsv "select Index, Text from 'c:\path\to\file.log' where line like '%pattern%'" 
```

## The relativity of sizes

100 MB isn't too big. 3 GB is getting kind of big. I used to work at a print & mail facility that created about 2% of U.S. first class mail. One of the systems for which I was the tech lead accounted for about 15+% of the pieces of mail. We had some big files to debug here and there.

## And more...

随时在此处添加更多工具和信息。这个答案是社区维基是有原因的！我们都需要更多关于处理大量数据的建议......

# asp.net - 为什么我在调用 Response.Redirect() 时收到“发送 HTTP 标头后无法重定向”？

> ID：159523
> 
> 赞同：87
> 
> 时间：2008-10-01T20:22:48.533
> 
> 标签：asp.net, http-headers, response.redirect, httpexception

当我打电话时，`Response.Redirect(someUrl)`我得到以下 HttpException：

> 发送 HTTP 标头后无法重定向。

为什么我会得到这个？我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2008-10-01T20:25:23.097

根据 MSDN 文档`Response.Redirect(string url)`，当“在发送 HTTP 标头后尝试重定向”时，它将抛出 HttpException。由于`Response.Redirect(string url)`使用 Http“位置”响应标头（[http://en.wikipedia.org/wiki/HTTP_headers#Responses](http://en.wikipedia.org/wiki/HTTP_headers#Responses)），调用它会导致标头被发送到客户端。这意味着如果您第二次调用它，或者如果您在以其他方式发送标头之后调用它，您将获得 HttpException。

防止多次调用 Response.Redirect() 的一种方法是`Response.IsRequestBeingRedirected`在调用之前检查属性 (bool)。

```
// Causes headers to be sent to the client (Http "Location" response header)
Response.Redirect("http://www.stackoverflow.com");
if (!Response.IsRequestBeingRedirected)
    // Will not be called
    Response.Redirect("http://www.google.com"); 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-01T20:27:04.810

一旦您向客户端发送任何内容，HTTP 标头就已经发送。调用的`Response.Redirect()`工作原理是在标头中发送特殊信息，使浏览器请求不同的 URL。

由于标头已经发送，asp.net 不能做你想做的（修改标头）

您可以通过以下方式解决此问题：a) 在执行任何其他操作之前执行重定向，或者 b) 在执行其他操作之前尝试使用`Response.Buffer = true`，以确保在整个页面执行完成之前不会将输出发送到客户端。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-01T20:24:38.293

仅当 HTTP 消息中的第一行是“”时，才会发生重定向`HTTP/1.x 3xx Redirect Reason`。

如果您已经调用`Response.Write()`或设置了一些标头，那么重定向为时已晚。您可以尝试`Response.Headers.Clear()`在重定向之前拨打电话，看看是否有帮助。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-01T09:27:54.740

只需检查您是否将缓冲选项设置为 false（默认情况下为 true）。为了 response.redirect 工作，

1.  缓冲应该是真的，
2.  您不应该使用超过默认缓冲区大小的 response.write 发送更多数据（在这种情况下，它将自行刷新导致发送标头），因此不允许您重定向。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-03-23T08:45:38.290

使用 `return RedirectPermanent(myUrl)`为我工作

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-11-02T04:21:16.437

您也可以使用下面提到的代码

```
Response.Write("<script type='text/javascript'>"); Response.Write("window.location = '" + redirect url + "'</script>");Response.Flush(); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-01-14T03:07:52.227

对此有一个简单的答案：在发送标题之前，您已经输出了其他内容，例如文本或与页面输出相关的任何内容。这会影响您收到该错误的原因。

只需检查您的代码以获取可能的输出，或者您可以将标题放在您的方法之上，以便首先发送。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-02-18T21:29:08.137

如果您在发送标头后尝试重定向（例如，如果您从部分生成的页面执行错误重定向），您可以发送一些客户端 Javascript（location.replace 或 location.href 等）重定向到您想要的任何 URL。当然，这取决于已经发送了哪些 HTML。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-01-08T12:02:55.290

我的问题通过添加异常处理程序来处理“发送 HTTP 标头后无法重定向”得到解决。这个错误如下代码所示

```
catch (System.Threading.ThreadAbortException)
        {
            // To Handle HTTP Exception "Cannot redirect after HTTP headers have been sent".
        }
        catch (Exception e)
        {//Here you can put your context.response.redirect("page.aspx");} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-10-31T16:43:21.973

我解决了这个问题： Response.RedirectToRoute("CultureEnabled", RouteData.Values); 而不是 Response.Redirect。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-10-13T12:27:42.440

确保不要像在重定向部分之前那样使用`Response`s' 方法。`Response.Flush();`

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-07-25T10:27:19.753

**发送 HTTP 标头后错误** 无法重定向。

System.Web.HttpException (0x80004005)：发送 HTTP 标头后无法重定向。

**建议**

如果我们使用 asp.net mvc 并在同一个控制器上工作并重定向到不同的 Action 那么你不需要写..
**Response.Redirect("ActionName","ControllerName");**
最好只使用
**return RedirectToAction("ActionName");**
或
返回视图（“视图名称”）；

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-01T09:07:35.867

重定向功能可能通过使用“刷新”http 标头（也可能使用 30X 代码）来工作。一旦标头已发送到客户端，服务器就无法附加该重定向命令，为时已晚。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-04-01T05:16:07.533

如果您在发送 HTTP 标头后无法重定向，请尝试以下代码。

```
HttpContext.Current.Server.ClearError();
// Response.Headers.Clear();
HttpContext.Current.Response.Redirect("/Home/Login",false); 
```

* * *

## 回答 #15

> 赞同：-3
> 
> 时间：2017-12-28T16:31:13.460

有两种方法可以解决此问题：

1.  只需在您的 （如果方法签名不是“void”，您当然必须返回该“类型”）`return`之后添加一条语句，如下所示：`Response.Redirect(someUrl);`

    Response.Redirect("Login.aspx");

    返回;

请注意，返回允许服务器执行重定向...没有它，服务器希望继续执行您的其余代码...

2.  在`Response.Redirect(someUrl)`引发异常的方法中创建最后执行的语句。将您的替换`Response.Redirect(someUrl)`为名为“someUrl”的字符串变量，并将其设置为重定向位置...如下：

`//......some code`

```
string someUrl = String.Empty 
```

.....一些逻辑

```
if (x=y)
{
    // comment (original location of Response.Redirect("Login.aspx");)
    someUrl = "Login.aspx";
} 
```

......更多代码

// 将您的 Response.Redirect 移动到 HERE（方法结束）：

```
Response.Redirect(someUrl);
return; 
```

# sql-server - 如何让 SQL Profiler 监控触发器执行

> ID：159526
> 
> 赞同：61
> 
> 时间：2008-10-01T20:23:57.937
> 
> 标签：sql-server, sql-server-2005, sql-server-profiler

我有一个 SQL Server Profiler 的跟踪设置来监视在数据库上执行的 SQL。我最近发现跟踪中不包含触发器执行。在查看跟踪的可用事件后，我看不到任何看起来它们会包含触发器执行的内容。有谁知道如何设置跟踪来监控触发器的执行？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-10-02T09:45:48.087

存储过程： - SP:StmtStarting - SP:StmtCompleted

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2010-05-25T02:47:19.910

在 SQL Server Profiler 2008 中，启动/配置跟踪时，转到“事件选择”选项卡，单击“显示所有事件”复选框，然后在“存储过程”部分下的列表中选择 SP:StmtStarting 和 SP：要包含在跟踪中的 StmtCompleted 事件。

# python - Nginx + fastcgi truncation problem

> ID：159541
> 
> 赞同：11
> 
> 时间：2008-10-01T20:26:12.800
> 
> 标签：python, django, nginx, fastcgi

I'm running a Django site using the fastcgi interface to nginx. However, some pages are being served truncated (i.e. the page source just stops, sometimes in the middle of a tag). How do I fix this (let me know what extra information is needed, and I'll post it)

Details:

I'm using flup, and spawning the fastcgi server with the following command:

```
python ./manage.py runfcgi umask=000 maxchildren=5 maxspare=1 minspare=0 method=prefork socket=/path/to/runfiles/django.sock pidfile=/path/to/runfiles/django.pid 
```

The nginx config is as follows:

```
# search and replace this: {project_location}
pid /path/to/runfiles/nginx.pid;
worker_processes  2;
error_log /path/to/runfiles/error_log;
events {
    worker_connections  1024;
    use epoll;
}
http {
    # default nginx location
    include        /etc/nginx/mime.types;
    default_type    application/octet-stream;
    log_format main
        '$remote_addr - $remote_user [$time_local] '
            '"$request" $status $bytes_sent '
        '"$http_referer" "$http_user_agent" '
        '"$gzip_ratio"';
    client_header_timeout  3m;
    client_body_timeout    3m;
    send_timeout           3m;
    connection_pool_size        256;
    client_header_buffer_size    1k;
    large_client_header_buffers    4 2k;
    request_pool_size        4k;
    output_buffers   4 32k;
    postpone_output  1460;
    sendfile        on;
    tcp_nopush             on;
    keepalive_timeout      75 20;
    tcp_nodelay            on;
    client_max_body_size       10m;
    client_body_buffer_size    256k;
    proxy_connect_timeout      90;
    proxy_send_timeout         90;
    proxy_read_timeout         90;
    client_body_temp_path      /path/to/runfiles/client_body_temp;
    proxy_temp_path            /path/to/runfiles/proxy_temp;
    fastcgi_temp_path            /path/to/runfiles/fastcgi_temp;
    gzip on;
    gzip_min_length  1100;
    gzip_buffers     4 32k;
    gzip_types       text/plain text/html application/x-javascript text/xml text/css;
    ignore_invalid_headers    on;
    server {
        listen 80;
        server_name alpha2.sonyalabs.com;
        index index.html;
        root   /path/to/django-root/static;
        # static resources
        location ~* ^/static/.*$
        {
        root   /path/to/django-root;
                expires 30d;
                break;
        }
        location / {
            # host and port to fastcgi server
            fastcgi_pass unix:/path/to/runfiles/django.sock;
            fastcgi_param PATH_INFO $fastcgi_script_name;
            fastcgi_param REQUEST_METHOD $request_method;
            fastcgi_param QUERY_STRING $query_string;
            fastcgi_param CONTENT_TYPE $content_type;
            fastcgi_param CONTENT_LENGTH $content_length;
            fastcgi_pass_header Authorization;
            fastcgi_intercept_errors off;
        }
        location /403.html {
                root   /usr/local/nginx;
                access_log   off;
        }
        location /401.html {
                root   /usr/local/nginx;
                access_log   off;
        }
        location /404.html {
                root   /usr/local/nginx;
                access_log   off;
        }
        location = /_.gif {
                    empty_gif;
                access_log   off;
        }
            access_log    /path/to/runfiles/localhost.access_log main;
            error_log    /path/to/runfiles/localhost.error_log;
        }
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2011-03-07T10:54:59.563

我在 nginx 上运行 Nagios 时遇到了同样的问题。我在谷歌搜索答案时偶然发现了您的问题，并阅读了“权限被拒绝”相关的答案，这让我印象深刻（也许它会对您有所帮助）：

*   Nginx error.log 报告：

    2011/03/07 11:36:02 [crit] 30977#0: *225952 open() "/var/lib/nginx/fastcgi/2/65/0000002652" 失败（13：权限被拒绝）

*   所以我只是跑了# chown -R www-data:www-data /var/lib/nginx/fastcgi

*   固定的 ！（感谢您的间接帮助）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-12-23T04:37:11.697

检查错误日志以了解写入`.../nginx/tmp/...`文件的“权限被拒绝”错误。Nginx 可以正常工作，除非它需要临时空间，这通常发生在 32K 边界。如果您发现这些错误，请确保 tmp 目录可由 nginx 运行的用户写入。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T21:21:52.243

您正在使用什么 fastcgi 界面以及如何使用。是扑腾吗？如果是，请粘贴您生成服务器的方式以及它如何连接到 nginx。如果没有这些信息，它只是在猜测可能会出现什么问题。

可能出现的问题：

*   nginx 有问题。至少 lighttpd 有可怕的 fastcgi 错误，我不怀疑 nginx 是否也有一些:)
*   Django 在内部系统中因未正确捕获的回溯而死亡，并关闭了您无法从客户端看到的 fastcgi 服务器。在这种情况下，包装 fastcgi 服务器应用程序调用并尝试/排除它以打印异常。

但是服务器日志和配置会很棒。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-23T20:00:22.547

尝试提高“gzip_buffers”可能会有所帮助。

见这里： [http ://blog.leetsoft.com/2007/7/25/nginx-gzip-ssl](http://blog.leetsoft.com/2007/7/25/nginx-gzip-ssl)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-05-17T15:17:05.467

FastCGI 不应为此负责。

我使用 nginx/gunicorn 遇到了完全相同的问题。将响应大小减少到小于 32k（在特定情况下使用`spaceless`模板中的标签）解决了这个问题。

正如 dwc 所说，由于 nginx 使用地址空间的方式，这可能是一个硬限制。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-23T16:11:04.953

我在我的网络主机（Webfaction）和本地 Ubuntu 开发服务器上运行与此非常相似的配置，我没有看到任何问题。我猜这是导致此问题的超时或缓冲区已满。

您可以发布nginx错误日志的输出吗？另外你使用的是什么版本的nginx？

作为旁注，可能值得查看[django-logging](http://code.google.com/p/django-logging/wiki/Overview)以了解您的 fastcgi 进程在做什么。

# algorithm - 麻将 - 排列瓷砖以确保至少有一条通往胜利的道路，无论布局如何

> ID：159547
> 
> 赞同：10
> 
> 时间：2008-10-01T20:28:21.343
> 
> 标签：algorithm, mahjong

无论使用哪种布局，有没有什么好的方法来分配瓷砖，以便您可以向用户保证，在游戏开始时，至少存在一条完成拼图并赢得游戏的途径?

显然，根据用户的动作，他们可以切断自己的胜利。我只想能够总是告诉用户，如果他们玩得好，这个谜题是可以赢的。

如果您在游戏开始时随机放置瓷砖，则用户可能会移动一些动作而无法再移动。一个谜题至少可以解决的知识应该让它更有趣。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-01T20:29:29.500

将所有瓷砖反向放置（即从中间开始布置板，锻炼）

为了进一步逗弄玩家，您可以以非常高的速度明显地做到这一点。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-01T20:30:13.537

反过来玩游戏。

在您可以将它们滑入堆中的地方，一对对地随机放置碎片。你需要一种方法来*知道*你可以在哪里放置碎片，以便最终得到一个与某些预设模式匹配的堆，但无论如何你都需要它。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-12-16T02:16:17.497

我知道这是一个老问题，但我自己解决问题时遇到了这个问题。这里没有一个答案是非常完美的，其中一些有复杂的警告或将打破病态布局。这是我的解决方案：

用未标记的瓷砖解决棋盘（向前，而不是向后）。一次移除两个空闲的瓷砖。将您删除的每一对推入“匹配对”堆栈。通常，这就是您需要做的所有事情。

如果您遇到死胡同（numFreeTiles == 1），只需重置您的生成器 :) 我发现我通常不会遇到死胡同，并且到目前为止 10 次左右的最大重试次数为 3我尝试过的布局。一旦我重试了 8 次，我就放弃了，只是随机分配其余的图块。这使我可以使用相同的生成器来设置棋盘和随机播放功能，即使玩家搞砸了并进入了 100% 无法解决的状态。

当您遇到死胡同时，另一种解决方案是退出（弹出堆栈，替换板上的瓷砖），直到您可以采取不同的路径。通过确保匹配将删除原始阻挡瓷砖的对来采取不同的路径。

不幸的是，根据董事会的不同，这可能会永远循环。如果您最终删除了一条类似于“无出口”道路的对，其中所有后续“道路”都是死胡同，并且有多个死胡同，那么您的算法将永远不会完成。我不知道是否有可能在这种情况下设计一个电路板，但如果是这样，仍然有一个解决方案。

为了解决这个更大的问题，将每个可能的棋盘状态视为 DAG 中的一个节点，每个选定的对都是该图上的一条边。进行随机遍历，直到找到深度为 72 的叶节点。跟踪您的遍历历史，这样您就不会重复下降。

由于死角比我使用的布局中的第一次尝试解决方案更罕见，因此立即想到的是混合解决方案。首先尝试用最少的内存来解决它（将选定的对存储在堆栈中）。一旦你遇到了第一个死胡同，在访问每个节点时降级为进行完整的标记/边缘生成（可能的惰性评估）。

不过，我对图论的研究很少，所以也许对 DAG 随机遍历/搜索问题有更好的解决方案:)

编辑：你实际上可以使用我的任何解决方案来反向生成板，ala 2008 年 10 月 13 日的帖子。你仍然有同样的警告，因为你仍然可能会陷入死胡同。但是，反向生成棋盘具有更复杂的规则。例如，如果您没有从中间的第一部分开始至少一些行，例如在带有 1 个长行的布局中，那么您肯定会失败您的设置。在正解生成器中选择完全随机（合法）的第一步更有可能导致可解的棋盘。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-01T20:31:18.137

我唯一能想到的就是将棋子成对放置，就像一种反向麻将纸牌游戏。因此，在放置瓷砖的任何时候，棋盘都应该看起来像是在真实游戏的中间（即没有瓷砖漂浮在其他瓷砖上方 3 层）。

如果棋子在反向游戏中成对放置，则应始终产生至少一条正向路径来解决游戏。

我很想听听其他想法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T21:42:01.837

我相信最好的答案已经被推高了：通过“反向”解决它来创建一个集合 - 即从一个空白板开始，然后在某处添加一对，在可解决的位置添加另一对，等等......

如果您更喜欢“大爆炸”方法（在开始时随机生成整个集合），是一个非常有*男子气概*的开发人员，或者今天只是觉得自虐，您可以表示您可以从给定集合中取出的所有对以及它们如何依赖通过有向图相互连接。

从那里，您只需要获得该集合的传递闭包，并确定是否至少有一个从至少一个初始合法对到所需结束的路径（没有剩余的瓦片对）。

实施此解决方案留给读者作为练习：D

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T07:49:19.720

这是我在实现中使用的规则。

在构建堆时，对于一对中的每个品格，分别找到一个单元格（位置），它们是：

*   已填充较低级别的所有单元格
*   考虑到第一个品格是否已经装上，第二个品格的位置不会首先阻塞
*   这两个地方都在已经构建的堆的“边缘”：
    *   EITHER 在左侧或右侧至少有一个邻居
    *   或者它是连续第一个烦恼（左右的所有单元格都是递归自由的）

这些规则并不能保证构建总是成功 - 它有时会留下最后 2 个空闲单元自阻塞，并且应该重试构建（或至少最后几个烦恼）在实践中，“乌龟”构建不超过 6 次重试。

大多数现有游戏似乎都将第一排（“第一排”）音品限制在中间的某个位置。这提供了更方便的配置，当非常长的行的边缘没有音品时，一直到最后一个玩家移动。但是，“中间”对于不同的配置是不同的。

祝你好运 ：）

PS如果您发现可以一次性构建可解堆的算法 - 请告诉我。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-28T07:16:36.213

您在游戏中有 144 个图块，144 个图块中的每一个都有一个阻止列表..（堆栈顶部的图块有一个空的块列表）

所有有效的移动都要求它们的“current__vertical_Block_list”为空。这可以是一个 144x144 的矩阵，所以 20k 的内存加上一个 LEFT 和 RIGHT 块列表，每个也是 20k。

从 (remaning_tiles) A​​ND ((empty CURRENT VERTICAL BLOCK LIST) and ((empty CURRENT LEFT BLOCK LIST) OR (empty CURRENT RIGHT BLOCK LIST))) 生成有效的移动表

从有效移动表中随机选择 2 个图块，记录它们更新（当前表 Vert、左和右），将移除的图块记录到堆栈

现在我们有一个构成有效游戏的动作列表。为 72 个动作中的每一个分配匹配的瓷砖类型。

对于具有挑战性的游戏，跟踪每个图块何时可用。找到具有 (early early early late) 和 (late late late early early) 的集合，因为它是空白的，你会发现 1 EE 1 LL 和 2 LE 块.. 在 2 LE 块中，找到一个 EARLY 可以阻止任何其他 EARLY （除了右挡住左边的棋子）
一旦你得到了一个有效的游戏，就可以按照顺序玩。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-10-01T20:33:30.410

纸牌？只是一个猜测，但我认为您的计算机需要击败游戏（或接近游戏）才能确定这一点。

另一种选择可能是有几个预设布局（允许获胜，与您当前的水平混合。

在某种程度上，您可以尝试确保 4 个图块之一不超过另一个 X 下方的 X 层。

我看到的大多数游戏都有 shuffle 命令用于当有人卡住时。

我会尝试多种方法，看看哪种效果最好。

# javascript - Javascript 命令仅在未最小化时执行

> ID：159549
> 
> 赞同：0
> 
> 时间：2008-10-01T20:29:12.650
> 
> 标签：javascript, minimize

当我使用未最小化的 JavaScript 文件时，我想登录到控制台。

当我最小化 JavaScript 时，评论已经被删除。我想知道是否有一种方法可以编写一个未注释掉但在我最小化 JavaScript 文件时仍会被删除的命令。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T21:02:54.723

我想如果 Javascript 最小化程序基于一些有趣/聪明/奇怪的代码结构改变了我的代码的行为，我会非常沮丧。你怎么能确定代码结构不是故意存在的？

正如建议的那样，有一个禁用日志记录的变量。然后，作为最小化脚本或批处理作业的一部分，您可以在最小化之前使用 sed（例如）将该变量交换为其非日志状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T20:47:43.730

除非你用什么来最小化你的 JS 支持条件语句，否则我认为你不能这样做。

如果设置了某个变量，为什么不直接记录呢？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T06:47:05.847

如果您的目标只是减少 js 的大小，您可以将日志记录功能分离到一个单独的文件中。

在您的“主要”js中添加一个函数`function doLogging(object){}`，然后在您单独的日志记录函数文件中将该函数替换为`function doLogging(object){/*your logging code*/};`

只需记住在日志记录 js 之前包含您的主要 js。当您缩小时，只需从 html 中注释掉日志记录脚本标签。这样，您将在缩小的 js 中只有一个（或几个）空函数定义，并且在每个 loggingn 操作中调用这些函数的一行代码。

# tsql - String.Format like functionality in T-SQL?

> ID：159554
> 
> 赞同：98
> 
> 时间：2008-10-01T20:29:56.707
> 
> 标签：tsql, string

I'm looking for a built-in function/extended function in T-SQL for string manipulation similar to the `String.Format` method in .NET.

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2015-05-15T13:26:46.467

如果您使用的是 SQL Server 2012 及更高版本，则可以使用`FORMATMESSAGE`. 例如。

```
DECLARE @s NVARCHAR(50) = 'World';
DECLARE @d INT = 123;
SELECT FORMATMESSAGE('Hello %s, %d', @s, @d)
-- RETURNS 'Hello World, 123' 
```

* * *

来自 MSDN 的更多示例：[FORMATMESSAGE](https://docs.microsoft.com/en-us/sql/t-sql/functions/formatmessage-transact-sql)

```
SELECT FORMATMESSAGE('Signed int %i, %d %i, %d, %+i, %+d, %+i, %+d', 5, -5, 50, -50, -11, -11, 11, 11);
SELECT FORMATMESSAGE('Signed int with leading zero %020i', 5);
SELECT FORMATMESSAGE('Signed int with leading zero 0 %020i', -55);
SELECT FORMATMESSAGE('Unsigned int %u, %u', 50, -50);
SELECT FORMATMESSAGE('Unsigned octal %o, %o', 50, -50);
SELECT FORMATMESSAGE('Unsigned hexadecimal %x, %X, %X, %X, %x', 11, 11, -11, 50, -50);
SELECT FORMATMESSAGE('Unsigned octal with prefix: %#o, %#o', 50, -50);
SELECT FORMATMESSAGE('Unsigned hexadecimal with prefix: %#x, %#X, %#X, %X, %x', 11, 11, -11, 50, -50);
SELECT FORMATMESSAGE('Hello %s!', 'TEST');
SELECT FORMATMESSAGE('Hello %20s!', 'TEST');
SELECT FORMATMESSAGE('Hello %-20s!', 'TEST');
SELECT FORMATMESSAGE('Hello %20s!', 'TEST'); 
```

笔记：

*   2012 年无证
*   限制为 2044 个字符
*   要转义 % 符号，您需要将其翻倍。
*   如果您在扩展事件中记录错误，调用`FORMATMESSAGE`会作为（无害的）错误出现

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2009-07-20T12:10:06.890

看看[xp_sprintf](http://msdn.microsoft.com/en-us/library/ms175014.aspx)。下面的例子。

```
DECLARE @ret_string varchar (255)
EXEC xp_sprintf @ret_string OUTPUT, 
    'INSERT INTO %s VALUES (%s, %s)', 'table1', '1', '2'
PRINT @ret_string 
```

结果如下所示：

```
INSERT INTO table1 VALUES (1, 2) 
```

* * *

刚刚发现字符串的最大大小（255 个字符限制）存在问题，因此您可以使用[另一个函数：](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=65584)

```
create function dbo.fnSprintf (@s varchar(MAX), 
                @params varchar(MAX), @separator char(1) = ',')
returns varchar(MAX)
as
begin
declare @p varchar(MAX)
declare @paramlen int

set @params = @params + @separator
set @paramlen = len(@params)
while not @params = ''
begin
    set @p = left(@params+@separator, charindex(@separator, @params)-1)
    set @s = STUFF(@s, charindex('%s', @s), 2, @p)
    set @params = substring(@params, len(@p)+2, @paramlen)
end
return @s
end 
```

要获得与上述相同的结果，请按如下方式调用该函数：

```
print dbo.fnSprintf('INSERT INTO %s VALUES (%s, %s)', 'table1,1,2', default) 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2010-12-21T18:44:51.397

我创建了一个用户定义的函数来模仿 string.format 功能。你可以使用它。

[sql 中的字符串格式](http://stringformat-in-sql.blogspot.com/)

更新：
此版本允许用户更改分隔符。

```
-- DROP function will loose the security settings.
IF object_id('[dbo].[svfn_FormatString]') IS NOT NULL
    DROP FUNCTION [dbo].[svfn_FormatString]
GO

CREATE FUNCTION [dbo].[svfn_FormatString]
(
    @Format NVARCHAR(4000),
    @Parameters NVARCHAR(4000),
    @Delimiter CHAR(1) = ','
)
RETURNS NVARCHAR(MAX)
AS
BEGIN
    /*
        Name: [dbo].[svfn_FormatString]
        Creation Date: 12/18/2020

        Purpose: Returns the formatted string (Just like in C-Sharp)

        Input Parameters:   @Format         = The string to be Formatted
                            @Parameters     = The comma separated list of parameters
                            @Delimiter      = The delimitter to be used in the formatting process

        Format:             @Format         = N'Hi {0}, Welcome to our site {1}. Thank you {0}'
                            @Parameters     = N'Karthik,google.com'
                            @Delimiter      = ','           
        Examples:
            SELECT dbo.svfn_FormatString(N'Hi {0}, Welcome to our site {1}. Thank you {0}', N'Karthik,google.com', default)
            SELECT dbo.svfn_FormatString(N'Hi {0}, Welcome to our site {1}. Thank you {0}', N'Karthik;google.com', ';')
    */
    DECLARE @Message NVARCHAR(400)
    DECLARE @ParamTable TABLE ( Id INT IDENTITY(0,1), Paramter VARCHAR(1000))

    SELECT @Message = @Format

    ;WITH CTE (StartPos, EndPos) AS
    (
        SELECT 1, CHARINDEX(@Delimiter, @Parameters)
        UNION ALL
        SELECT EndPos + (LEN(@Delimiter)), CHARINDEX(@Delimiter, @Parameters, EndPos + (LEN(@Delimiter)))
        FROM CTE
        WHERE EndPos > 0
    )

    INSERT INTO @ParamTable ( Paramter )
    SELECT
        [Id] = SUBSTRING(@Parameters, StartPos, CASE WHEN EndPos > 0 THEN EndPos - StartPos ELSE 4000 END )
    FROM CTE

    UPDATE @ParamTable 
    SET 
        @Message = REPLACE(@Message, '{'+ CONVERT(VARCHAR, Id) + '}', Paramter )

    RETURN @Message
END 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-07T20:37:19.480

有一种方法，但它有其局限性。您可以使用该`FORMATMESSAGE()`功能。`printf()`它允许您使用类似于C 中的函数的 格式来格式化字符串。

但是，最大的限制是它只能处理 sys.messages 表中的消息。这是一篇关于它的文章：[microsoft_library_ms186788](http://msdn.microsoft.com/en-us/library/ms186788.aspx)

遗憾的是没有更简单的方法可以做到这一点，因为有时您想在数据库中格式化字符串/varchar。希望您只是希望以标准方式格式化字符串并且可以使用该`sys.messages`表。

巧合的是，您也可以使用`RAISERROR()`严重性非常低的函数，raiseerror 的文档甚至提到这样做，但结果只被打印出来。因此，您将无法对结果值做任何事情（据我了解）。

祝你好运！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-01T20:35:29.173

Raw t-sql is limited to CHARINDEX(), PATINDEX(), REPLACE(), and SUBSTRING() for string manipulation. But with sql server 2005 and later you can set up user defined functions that run in .Net, which means setting up a string.format() UDF shouldn't be too tough.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-01-30T16:34:23.757

还有一个想法。

虽然这不是一个通用的解决方案 - 它简单且有效，至少对我来说:)

对于一个占位符 {0}：

```
create function dbo.Format1
(
    @String  nvarchar(4000),
    @Param0  sql_variant
)
returns nvarchar(4000)
as
begin
    declare @Null nvarchar(4) = N'NULL';

    return replace(@String, N'{0}', cast(isnull(@Param0, @Null) as nvarchar(4000)));    
end 
```

对于两个占位符 {0} 和 {1}：

```
create function dbo.Format2
(
    @String  nvarchar(4000),
    @Param0  sql_variant,
    @Param1  sql_variant
)
returns nvarchar(4000)
as
begin
    declare @Null nvarchar(4) = N'NULL';

    set @String = replace(@String, N'{0}', cast(isnull(@Param0, @Null) as nvarchar(4000)));
       return     replace(@String, N'{1}', cast(isnull(@Param1, @Null) as nvarchar(4000))); 
end 
```

对于三个占位符 {0}、{1} 和 {2}：

```
create function dbo.Format3
(
    @String  nvarchar(4000),
    @Param0  sql_variant,
    @Param1  sql_variant,
    @Param2  sql_variant
)
returns nvarchar(4000)
as
begin
    declare @Null nvarchar(4) = N'NULL';

    set @String = replace(@String, N'{0}', cast(isnull(@Param0, @Null) as nvarchar(4000)));
    set @String = replace(@String, N'{1}', cast(isnull(@Param1, @Null) as nvarchar(4000))); 
       return     replace(@String, N'{2}', cast(isnull(@Param2, @Null) as nvarchar(4000)));
end 
```

等等...

这种方法允许我们在 SELECT 语句中使用这些函数，并使用 nvarchar、number、bit 和 datetime 数据类型的参数。

例如：

```
declare @Param0 nvarchar(10) = N'IPSUM' ,
        @Param1 int          = 1234567  ,
        @Param2 datetime2(0) = getdate();

select dbo.Format3(N'Lorem {0} dolor, {1} elit at {2}', @Param0, @Param1, @Param2); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-02-09T18:00:32.153

我认为在计算结束位置时会有小的修正。

这是正确的功能

```
**>>**IF OBJECT_ID( N'[dbo].[FormatString]', 'FN' ) IS NOT NULL
DROP FUNCTION [dbo].[FormatString]
GO
/***************************************************
Object Name : FormatString
Purpose : Returns the formatted string.
Original Author : Karthik D V http://stringformat-in-sql.blogspot.com/
Sample Call:
SELECT dbo.FormatString ( N'Format {0} {1} {2} {0}', N'1,2,3' )
*******************************************/
CREATE FUNCTION [dbo].[FormatString](
    @Format NVARCHAR(4000) ,
    @Parameters NVARCHAR(4000)
)
RETURNS NVARCHAR(4000)
AS
BEGIN
    --DECLARE @Format NVARCHAR(4000), @Parameters NVARCHAR(4000) select @format='{0}{1}', @Parameters='hello,world'
    DECLARE @Message NVARCHAR(400), @Delimiter CHAR(1)
    DECLARE @ParamTable TABLE ( ID INT IDENTITY(0,1), Parameter VARCHAR(1000) )
    Declare @startPos int, @endPos int
    SELECT @Message = @Format, @Delimiter = ','**>>**

    --handle first parameter
     set @endPos=CHARINDEX(@Delimiter,@Parameters)
    if (@endPos=0 and @Parameters is not null) --there is only one parameter
        insert into @ParamTable (Parameter) values(@Parameters)
    else begin
        insert into @ParamTable (Parameter) select substring(@Parameters,0,@endPos)
    end

    while @endPos>0
    Begin
        --insert a row for each parameter in the 
        set @startPos = @endPos + LEN(@Delimiter)
        set @endPos = CHARINDEX(@Delimiter,@Parameters, @startPos)
        if (@endPos>0)
            insert into @ParamTable (Parameter) 
                select substring(@Parameters,@startPos,@endPos - @startPos)
            else
                insert into @ParamTable (Parameter) 
                select substring(@Parameters,@startPos,4000)            
    End

    UPDATE @ParamTable SET @Message = 
        REPLACE ( @Message, '{'+CONVERT(VARCHAR,ID) + '}', Parameter )
    RETURN @Message
END
Go
grant execute,references on dbo.formatString to public 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2020-01-03T11:10:26.353

实际上并没有类似string的内置函数。SQL server中提供了.NET的Format函数。

SQL server 中有一个函数**FORMATMESSAGE()**但它模仿 C 的 printf() 函数而不是 .NET 的 string.Format 函数。

```
SELECT FORMATMESSAGE('This is the %s and this is the %s.', 'first variable', 'second variable') AS Result 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-04-29T14:08:53.317

这是我的版本。可以扩展以容纳更多数量的参数，并且可以根据类型扩展格式。目前只有日期和日期时间类型被格式化。

例子：

```
select dbo.FormatString('some string %s some int %s date %s','"abcd"',100,cast(getdate() as date),DEFAULT,DEFAULT)
select dbo.FormatString('some string %s some int %s date time %s','"abcd"',100,getdate(),DEFAULT,DEFAULT) 
```

输出：

```
some string "abcd" some int 100 date 29-Apr-2017
some string "abcd" some int 100 date time 29-Apr-2017 19:40 
```

功能：

```
create function dbo.FormatValue(@param sql_variant)
returns nvarchar(100)
begin
/*
Tejasvi Hegde, 29-April-2017
Can extend formatting here.
*/
    declare @result nvarchar(100)

    if (SQL_VARIANT_PROPERTY(@param,'BaseType') in ('date'))
    begin
       select @result = REPLACE(CONVERT(CHAR(11), @param, 106), ' ', '-')
    end
    else  if (SQL_VARIANT_PROPERTY(@param,'BaseType') in ('datetime','datetime2'))
    begin
       select @result = REPLACE(CONVERT(CHAR(11), @param, 106), ' ', '-')+' '+CONVERT(VARCHAR(5),@param,108)
    end
    else
    begin
       select @result = cast(@param as nvarchar(100))
    end
    return @result

/*
BaseType:
bigint
binary
char
date
datetime
datetime2
datetimeoffset
decimal
float
int
money
nchar
numeric
nvarchar
real
smalldatetime
smallint
smallmoney
time
tinyint
uniqueidentifier
varbinary
varchar
*/   

end;

create function dbo.FormatString(
    @format nvarchar(4000)
    ,@param1 sql_variant = null
    ,@param2 sql_variant = null
    ,@param3 sql_variant = null
    ,@param4 sql_variant = null
    ,@param5 sql_variant = null
    )
returns nvarchar(4000)
begin
/*
Tejasvi Hegde, 29-April-2017

select dbo.FormatString('some string value %s some int %s date %s','"abcd"',100,cast(getdate() as date),DEFAULT,DEFAULT)
select dbo.FormatString('some string value %s some int %s date time %s','"abcd"',100,getdate(),DEFAULT,DEFAULT)
*/

    declare @result nvarchar(4000)

    select @param1 = dbo.formatValue(@param1)
    ,@param2 = dbo.formatValue(@param2)
    ,@param3 = dbo.formatValue(@param3)
    ,@param4 = dbo.formatValue(@param4)
    ,@param5 = dbo.formatValue(@param5)

    select @param2 = cast(@param2 as nvarchar)
    EXEC xp_sprintf @result OUTPUT,@format , @param1, @param2, @param3, @param4, @param5

    return @result

end; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-12-22T23:31:08.870

这是我使用内置的实验发现的

FORMATMESSAGE() 函数

```
sp_addmessage @msgnum=50001,@severity=1,@msgText='Hello %s you are #%d',@replace='replace'
SELECT FORMATMESSAGE(50001, 'Table1', 5) 
```

当您调用 sp_addmessage 时，您的消息模板将存储到系统表 master.dbo.sysmessages 中（在 SQLServer 2000 上验证）。

您必须自己管理从表中添加和删除模板字符串，如果您真正想要的只是向结果屏幕输出一条快速消息，这会很尴尬。

Kathik DV 提供的解决方案看起来很有趣，但不适用于 SQL Server 2000，所以我对其进行了一些修改，这个版本应该适用于所有版本的 SQL Server：

```
IF OBJECT_ID( N'[dbo].[FormatString]', 'FN' ) IS NOT NULL
    DROP FUNCTION [dbo].[FormatString]
GO
/***************************************************
Object Name : FormatString
Purpose : Returns the formatted string.
Original Author : Karthik D V http://stringformat-in-sql.blogspot.com/
Sample Call:
SELECT dbo.FormatString ( N'Format {0} {1} {2} {0}', N'1,2,3' )
*******************************************/
CREATE FUNCTION [dbo].[FormatString](
@Format NVARCHAR(4000) ,
@Parameters NVARCHAR(4000)
)
RETURNS NVARCHAR(4000)
AS
BEGIN
    --DECLARE @Format NVARCHAR(4000), @Parameters NVARCHAR(4000) select @format='{0}{1}', @Parameters='hello,world'
    DECLARE @Message NVARCHAR(400), @Delimiter CHAR(1)
    DECLARE @ParamTable TABLE ( ID INT IDENTITY(0,1), Parameter VARCHAR(1000) )
    Declare @startPos int, @endPos int
    SELECT @Message = @Format, @Delimiter = ','

    --handle first parameter
     set @endPos=CHARINDEX(@Delimiter,@Parameters)
    if (@endPos=0 and @Parameters is not null) --there is only one parameter
        insert into @ParamTable (Parameter) values(@Parameters)
    else begin
        insert into @ParamTable (Parameter) select substring(@Parameters,0,@endPos)
    end

    while @endPos>0
    Begin
        --insert a row for each parameter in the 
        set @startPos = @endPos + LEN(@Delimiter)
        set @endPos = CHARINDEX(@Delimiter,@Parameters, @startPos)
        if (@endPos>0)
            insert into @ParamTable (Parameter) select substring(@Parameters,@startPos,@endPos)
        else
            insert into @ParamTable (Parameter) select substring(@Parameters,@startPos,4000)            
    End

    UPDATE @ParamTable SET @Message = REPLACE ( @Message, '{'+CONVERT(VARCHAR,ID) + '}', Parameter )
    RETURN @Message
END
Go
    grant execute,references on dbo.formatString to public 
```

用法：

```
print dbo.formatString('hello {0}... you are {1}','world,good')
--result: hello world... you are good 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-12-07T20:55:20.277

目前这并不存在（尽管您当然可以编写自己的）。它有一个开放的连接错误：[https](https://connect.microsoft.com/SQLServer/Feedback/Details/3130221) ://connect.microsoft.com/SQLServer/Feedback/Details/3130221 ，在撰写本文时只有一票。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2008-10-01T21:47:04.790

不完全是，但我会在 Simple Talk 上查看“Phil Factor”（geddit？）关于字符串处理（除其他外）的一些[文章。](http://www.simple-talk.com/author/robyn-page-and-phil-factor/)

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2013-11-21T14:39:20.147

这是不好的方法。您应该使用程序集 dll，其中将为您做同样的事情并获得更好的性能。

# iphone - iPhone user's mobile number

> ID：159556
> 
> 赞同：4
> 
> 时间：2008-10-01T20:30:04.817
> 
> 标签：iphone

Can I get user's mobile number (CLI number) in Objective-C on the iPhone from its sim card?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T20:33:24.513

Not with the official SDK. You could ask the user to point to its own contact entry using the AddressBookUI framework's pickers, or a UI of your own design.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-02T03:27:12.023

您可以从 NSUserDefaults 获取用户的电话号码。然后查找他们的通讯录条目。

这种方法是完全没有记录的，并且很容易在注意到的时候中断。

它也很脆弱 - 用户可能有一个错误的地址簿，多次使用相同的 # 等等。

# sql - SQL：从全名字段中解析名字、中间名和姓氏

> ID：159567
> 
> 赞同：47
> 
> 时间：2008-10-01T20:32:30.787
> 
> 标签：sql, sql-server, tsql, parsing

如何使用 SQL 从全名字段中解析名字、中间名和姓氏？

我需要尝试匹配与全名不直接匹配的名称。我希望能够获取全名字段并将其分解为名字、中间名和姓氏。

数据不包括任何前缀或后缀。中间名是可选的。数据格式为“First Middle Last”。

我对一些实用的解决方案感兴趣，可以让我完成 90% 的工作。如前所述，这是一个复杂的问题，因此我将单独处理特殊情况。

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2008-10-01T21:08:45.503

这是一个独立的示例，具有易于操作的测试数据。

在这个例子中，如果你的名字包含三个以上的部分，那么所有“额外”的东西都会放在 LAST_NAME 字段中。对于标识为“titles”的特定字符串（例如“DR”、“MRS”和“MR”）例外。

如果缺少中间名，那么您只会得到 FIRST_NAME 和 LAST_NAME（MIDDLE_NAME 将为 NULL）。

你可以将它粉碎成一个巨大的嵌套的 SUBSTRING 块，但是当你在 SQL 中这样做时，可读性已经够难了。

**编辑——处理以下特殊情况：**

**1 - NAME 字段为 NULL**

**2 - NAME 字段包含前导/尾随空格**

**3 - NAME 字段的名称中有 > 1 个连续空格**

**4 - NAME 字段仅包含名字**

**5 - 在最终输出中包含原始全名作为单独的列，以提高可读性**

**6 - 将特定的前缀列表作为单独的“标题”列处理**

```
SELECT
  FIRST_NAME.ORIGINAL_INPUT_DATA
 ,FIRST_NAME.TITLE
 ,FIRST_NAME.FIRST_NAME
 ,CASE WHEN 0 = CHARINDEX(' ',FIRST_NAME.REST_OF_NAME)
       THEN NULL  --no more spaces?  assume rest is the last name
       ELSE SUBSTRING(
                       FIRST_NAME.REST_OF_NAME
                      ,1
                      ,CHARINDEX(' ',FIRST_NAME.REST_OF_NAME)-1
                     )
       END AS MIDDLE_NAME
 ,SUBSTRING(
             FIRST_NAME.REST_OF_NAME
            ,1 + CHARINDEX(' ',FIRST_NAME.REST_OF_NAME)
            ,LEN(FIRST_NAME.REST_OF_NAME)
           ) AS LAST_NAME
FROM
  (  
  SELECT
    TITLE.TITLE
   ,CASE WHEN 0 = CHARINDEX(' ',TITLE.REST_OF_NAME)
         THEN TITLE.REST_OF_NAME --No space? return the whole thing
         ELSE SUBSTRING(
                         TITLE.REST_OF_NAME
                        ,1
                        ,CHARINDEX(' ',TITLE.REST_OF_NAME)-1
                       )
    END AS FIRST_NAME
   ,CASE WHEN 0 = CHARINDEX(' ',TITLE.REST_OF_NAME)  
         THEN NULL  --no spaces @ all?  then 1st name is all we have
         ELSE SUBSTRING(
                         TITLE.REST_OF_NAME
                        ,CHARINDEX(' ',TITLE.REST_OF_NAME)+1
                        ,LEN(TITLE.REST_OF_NAME)
                       )
    END AS REST_OF_NAME
   ,TITLE.ORIGINAL_INPUT_DATA
  FROM
    (   
    SELECT
      --if the first three characters are in this list,
      --then pull it as a "title".  otherwise return NULL for title.
      CASE WHEN SUBSTRING(TEST_DATA.FULL_NAME,1,3) IN ('MR ','MS ','DR ','MRS')
           THEN LTRIM(RTRIM(SUBSTRING(TEST_DATA.FULL_NAME,1,3)))
           ELSE NULL
           END AS TITLE
      --if you change the list, don't forget to change it here, too.
      --so much for the DRY prinicple...
     ,CASE WHEN SUBSTRING(TEST_DATA.FULL_NAME,1,3) IN ('MR ','MS ','DR ','MRS')
           THEN LTRIM(RTRIM(SUBSTRING(TEST_DATA.FULL_NAME,4,LEN(TEST_DATA.FULL_NAME))))
           ELSE LTRIM(RTRIM(TEST_DATA.FULL_NAME))
           END AS REST_OF_NAME
     ,TEST_DATA.ORIGINAL_INPUT_DATA
    FROM
      (
      SELECT
        --trim leading & trailing spaces before trying to process
        --disallow extra spaces *within* the name
        REPLACE(REPLACE(LTRIM(RTRIM(FULL_NAME)),'  ',' '),'  ',' ') AS FULL_NAME
       ,FULL_NAME AS ORIGINAL_INPUT_DATA
      FROM
        (
        --if you use this, then replace the following
        --block with your actual table
              SELECT 'GEORGE W BUSH' AS FULL_NAME
        UNION SELECT 'SUSAN B ANTHONY' AS FULL_NAME
        UNION SELECT 'ALEXANDER HAMILTON' AS FULL_NAME
        UNION SELECT 'OSAMA BIN LADEN JR' AS FULL_NAME
        UNION SELECT 'MARTIN J VAN BUREN SENIOR III' AS FULL_NAME
        UNION SELECT 'TOMMY' AS FULL_NAME
        UNION SELECT 'BILLY' AS FULL_NAME
        UNION SELECT NULL AS FULL_NAME
        UNION SELECT ' ' AS FULL_NAME
        UNION SELECT '    JOHN  JACOB     SMITH' AS FULL_NAME
        UNION SELECT ' DR  SANJAY       GUPTA' AS FULL_NAME
        UNION SELECT 'DR JOHN S HOPKINS' AS FULL_NAME
        UNION SELECT ' MRS  SUSAN ADAMS' AS FULL_NAME
        UNION SELECT ' MS AUGUSTA  ADA   KING ' AS FULL_NAME      
        ) RAW_DATA
      ) TEST_DATA
    ) TITLE
  ) FIRST_NAME 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-01T20:46:17.697

不知道“全名”的格式很难回答。

它可以是“姓氏，名字中间名”或“名字中间名姓氏”等。

基本上你必须使用**SUBSTRING**功能

```
SUBSTRING ( expression , start , length ) 
```

可能还有**CHARINDEX**函数

```
CHARINDEX (substr, expression) 
```

找出要提取的每个部分的开始和长度。

所以假设格式是“名字姓氏”，你可以（未经测试..但应该接近）：

```
SELECT 
SUBSTRING(fullname, 1, CHARINDEX(' ', fullname) - 1) AS FirstName, 
SUBSTRING(fullname, CHARINDEX(' ', fullname) + 1, len(fullname)) AS LastName
FROM YourTable 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-01T20:50:32.867

反转问题，添加列以保存各个部分并将它们组合起来以获得全名。

这将是*最佳*答案的原因是，无法保证确定一个人已注册为他们的名字，以及他们的中间名是什么。

例如，您将如何拆分它？

```
Jan Olav Olsen Heggelien 
```

这虽然是虚构的，但在挪威是一个合法名称，可以但不必像这样拆分：

```
First name: Jan Olav
Middle name: Olsen
Last name: Heggelien 
```

或者，像这样：

```
First name: Jan Olav
Last name: Olsen Heggelien 
```

或者，像这样：

```
First name: Jan
Middle name: Olav
Last name: Olsen Heggelien 
```

我想在大多数语言中都可以找到类似的情况。

因此，与其尝试解释没有足够信息以使其正确的数据，不如存储正确的解释，并结合起来得到全名。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2015-12-29T08:31:21.320

另一种简单的方法是使用`parsename`：

```
select full_name,
   parsename(replace(full_name, ' ', '.'), 3) as FirstName,
   parsename(replace(full_name, ' ', '.'), 2) as MiddleName,
   parsename(replace(full_name, ' ', '.'), 1) as LastName 
from YourTableName 
```

[来源](https://dba.stackexchange.com/a/42398/83480)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-01T20:40:28.193

除非你有非常非常好的数据，否则这是一个不小的挑战。一种天真的方法是对空格进行标记，并假设三个标记的结果是 [first, middle, last]，而两个标记的结果是 [first, last]，但是您将不得不处理多个单词姓氏（例如“Van Buren”）和多个中间名。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2019-05-27T06:56:10.730

此查询工作正常。

```
SELECT name
    ,Ltrim(SubString(name, 1, Isnull(Nullif(CHARINDEX(' ', name), 0), 1000))) AS FirstName
    ,Ltrim(SUBSTRING(name, CharIndex(' ', name), CASE 
                WHEN (CHARINDEX(' ', name, CHARINDEX(' ', name) + 1) - CHARINDEX(' ', name)) <= 0
                    THEN 0
                ELSE CHARINDEX(' ', name, CHARINDEX(' ', name) + 1) - CHARINDEX(' ', name)
                END)) AS MiddleName
    ,Ltrim(SUBSTRING(name, Isnull(Nullif(CHARINDEX(' ', name, Charindex(' ', name) + 1), 0), CHARINDEX(' ', name)), CASE 
                WHEN Charindex(' ', name) = 0
                    THEN 0
                ELSE LEN(name)
                END)) AS LastName
FROM yourtableName 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-01T20:43:44.877

您确定完整的法定姓名将始终包含名字、中间名和姓氏吗？我认识的人只有一个名字作为法定全名，老实说，我不确定这是他们的名字还是姓氏。:-) 我也认识一些人，他们的法定姓名中有多个名字，但没有中间名。有些人有多个中间名。

然后还有完整法定名称中的名称顺序。据我所知，在某些亚洲文化中，姓氏排在法定全名的首位。

在更实际的说明中，您可以在空格上拆分全名，并将第一个标记作为名字，将最后一个标记（或只有一个名字的唯一标记）作为姓氏。尽管这假设顺序将始终相同。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-07-08T07:32:44.053

这将在字符串是 FirstName/MiddleName/LastName 的情况下工作

```
Select 

DISTINCT NAMES ,

   SUBSTRING(NAMES , 1, CHARINDEX(' ', NAMES) - 1) as FirstName,

   RTRIM(LTRIM(REPLACE(REPLACE(NAMES,SUBSTRING(NAMES , 1, CHARINDEX(' ', NAMES) - 1),''),REVERSE( LEFT( REVERSE(NAMES), CHARINDEX(' ', REVERSE(NAMES))-1 ) ),'')))as MiddleName,

   REVERSE( LEFT( REVERSE(NAMES), CHARINDEX(' ', REVERSE(NAMES))-1 ) ) as LastName

From TABLENAME 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-01T20:59:08.647

就像#1 说的，这不是微不足道的。连字符的姓氏、姓名首字母、双名、逆名顺序和各种其他异常可能会破坏您精心设计的功能。

您可以使用 3rd 方库（插件/免责声明 - 我在此产品上工作）：

[http://www.melissadata.com/nameobject/nameobject.htm](http://www.melissadata.com/nameobject/nameobject.htm)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-01T21:04:30.600

我会将此作为一个迭代过程。

1）将表转储到一个平面文件中。

2）编写一个简单的程序来使用空格作为分隔符来分解您的姓名，其中 first 标记是名字，如果有 3 个标记，则标记 2 是中间名，标记 3 是姓氏。如果有 2 个标记，则第二个标记是姓氏。（Perl、Java 或 C/C++，语言无关紧要）

3) 观察结果。寻找不符合此规则的名称。

4）使用该示例，创建一个新规则来处理该异常......

5) 冲洗并重复

最终，您将获得一个修复所有数据的程序。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-11-01T02:32:31.913

如果您尝试在 PHP 中解析人名，我推荐[Keith Beckman 的 nameparse.php 脚本](http://jonathonhill.net/2009-10-31/human-name-parsing-in-php/)。

复制以防网站出现故障：

```
<?
/*
Name:   nameparse.php
Version: 0.2a
Date:   030507
First:  030407
License:    GNU General Public License v2
Bugs:   If one of the words in the middle name is Ben (or St., for that matter),
        or any other possible last-name prefix, the name MUST be entered in
        last-name-first format. If the last-name parsing routines get ahold
        of any prefix, they tie up the rest of the name up to the suffix. i.e.:

        William Ben Carey   would yield 'Ben Carey' as the last name, while,
        Carey, William Ben  would yield 'Carey' as last and 'Ben' as middle.

        This is a problem inherent in the prefix-parsing routines algorithm,
        and probably will not be fixed. It's not my fault that there's some
        odd overlap between various languages. Just don't name your kids
        'Something Ben Something', and you should be alright.

*/

function    norm_str($string) {
    return  trim(strtolower(
        str_replace('.','',$string)));
    }

function    in_array_norm($needle,$haystack) {
    return  in_array(norm_str($needle),$haystack);
    }

function    parse_name($fullname) {
    $titles         =   array('dr','miss','mr','mrs','ms','judge');
    $prefices       =   array('ben','bin','da','dal','de','del','der','de','e',
                            'la','le','san','st','ste','van','vel','von');
    $suffices       =   array('esq','esquire','jr','sr','2','ii','iii','iv');

    $pieces         =   explode(',',preg_replace('/\s+/',' ',trim($fullname)));
    $n_pieces       =   count($pieces);

    switch($n_pieces) {
        case    1:  // array(title first middles last suffix)
            $subp   =   explode(' ',trim($pieces[0]));
            $n_subp =   count($subp);
            for($i = 0; $i < $n_subp; $i++) {
                $curr               =   trim($subp[$i]);
                $next               =   trim($subp[$i+1]);

                if($i == 0 && in_array_norm($curr,$titles)) {
                    $out['title']   =   $curr;
                    continue;
                    }

                if(!$out['first']) {
                    $out['first']   =   $curr;
                    continue;
                    }

                if($i == $n_subp-2 && $next && in_array_norm($next,$suffices)) {
                    if($out['last']) {
                        $out['last']    .=  " $curr";
                        }
                    else {
                        $out['last']    =   $curr;
                        }
                    $out['suffix']      =   $next;
                    break;
                    }

                if($i == $n_subp-1) {
                    if($out['last']) {
                        $out['last']    .=  " $curr";
                        }
                    else {
                        $out['last']    =   $curr;
                        }
                    continue;
                    }

                if(in_array_norm($curr,$prefices)) {
                    if($out['last']) {
                        $out['last']    .=  " $curr";
                        }
                    else {
                        $out['last']    =   $curr;
                        }
                    continue;
                    }

                if($next == 'y' || $next == 'Y') {
                    if($out['last']) {
                        $out['last']    .=  " $curr";
                        }
                    else {
                        $out['last']    =   $curr;
                        }
                    continue;
                    }

                if($out['last']) {
                    $out['last']    .=  " $curr";
                    continue;
                    }

                if($out['middle']) {
                    $out['middle']      .=  " $curr";
                    }
                else {
                    $out['middle']      =   $curr;
                    }
                }
            break;
        case    2:
                switch(in_array_norm($pieces[1],$suffices)) {
                    case    TRUE: // array(title first middles last,suffix)
                        $subp   =   explode(' ',trim($pieces[0]));
                        $n_subp =   count($subp);
                        for($i = 0; $i < $n_subp; $i++) {
                            $curr               =   trim($subp[$i]);
                            $next               =   trim($subp[$i+1]);

                            if($i == 0 && in_array_norm($curr,$titles)) {
                                $out['title']   =   $curr;
                                continue;
                                }

                            if(!$out['first']) {
                                $out['first']   =   $curr;
                                continue;
                                }

                            if($i == $n_subp-1) {
                                if($out['last']) {
                                    $out['last']    .=  " $curr";
                                    }
                                else {
                                    $out['last']    =   $curr;
                                    }
                                continue;
                                }

                            if(in_array_norm($curr,$prefices)) {
                                if($out['last']) {
                                    $out['last']    .=  " $curr";
                                    }
                                else {
                                    $out['last']    =   $curr;
                                    }
                                continue;
                                }

                            if($next == 'y' || $next == 'Y') {
                                if($out['last']) {
                                    $out['last']    .=  " $curr";
                                    }
                                else {
                                    $out['last']    =   $curr;
                                    }
                                continue;
                                }

                            if($out['last']) {
                                $out['last']    .=  " $curr";
                                continue;
                                }

                            if($out['middle']) {
                                $out['middle']      .=  " $curr";
                                }
                            else {
                                $out['middle']      =   $curr;
                                }
                            }                       
                        $out['suffix']  =   trim($pieces[1]);
                        break;
                    case    FALSE: // array(last,title first middles suffix)
                        $subp   =   explode(' ',trim($pieces[1]));
                        $n_subp =   count($subp);
                        for($i = 0; $i < $n_subp; $i++) {
                            $curr               =   trim($subp[$i]);
                            $next               =   trim($subp[$i+1]);

                            if($i == 0 && in_array_norm($curr,$titles)) {
                                $out['title']   =   $curr;
                                continue;
                                }

                            if(!$out['first']) {
                                $out['first']   =   $curr;
                                continue;
                                }

                        if($i == $n_subp-2 && $next &&
                            in_array_norm($next,$suffices)) {
                            if($out['middle']) {
                                $out['middle']  .=  " $curr";
                                }
                            else {
                                $out['middle']  =   $curr;
                                }
                            $out['suffix']      =   $next;
                            break;
                            }

                        if($i == $n_subp-1 && in_array_norm($curr,$suffices)) {
                            $out['suffix']      =   $curr;
                            continue;
                            }

                        if($out['middle']) {
                            $out['middle']      .=  " $curr";
                            }
                        else {
                            $out['middle']      =   $curr;
                            }
                        }
                        $out['last']    =   $pieces[0];
                        break;
                    }
            unset($pieces);
            break;
        case    3:  // array(last,title first middles,suffix)
            $subp   =   explode(' ',trim($pieces[1]));
            $n_subp =   count($subp);
            for($i = 0; $i < $n_subp; $i++) {
                $curr               =   trim($subp[$i]);
                $next               =   trim($subp[$i+1]);
                if($i == 0 && in_array_norm($curr,$titles)) {
                    $out['title']   =   $curr;
                    continue;
                    }

                if(!$out['first']) {
                    $out['first']   =   $curr;
                    continue;
                    }

                if($out['middle']) {
                    $out['middle']      .=  " $curr";
                    }
                else {
                    $out['middle']      =   $curr;
                    }
                }

            $out['last']                =   trim($pieces[0]);
            $out['suffix']              =   trim($pieces[2]);
            break;
        default:    // unparseable
            unset($pieces);
            break;
        }

    return $out;
    }

?> 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-01T20:46:14.297

1.  获取一个 sql 正则表达式函数。示例：http: [//msdn.microsoft.com/en-us/magazine/cc163473.aspx](http://msdn.microsoft.com/en-us/magazine/cc163473.aspx)
2.  使用正则表达式提取名称。

我推荐 Expresso 用于学习/构建/测试正则表达式。[旧免费版](http://www.codeproject.com/KB/dotnet/expresso.aspx)，[新商业版](http://www.ultrapico.com/Expresso.htm)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-01T20:52:55.387

我不确定 SQL 服务器，但在 postgres 中你可以这样做：

```
SELECT 
  SUBSTRING(fullname, '(\\w+)') as firstname,
  SUBSTRING(fullname, '\\w+\\s(\\w+)\\s\\w+') as middle,
  COALESCE(SUBSTRING(fullname, '\\w+\\s\\w+\\s(\\w+)'), SUBSTRING(fullname, '\\w+\\s(\\w+)')) as lastname
FROM 
public.person 
```

正则表达式可能更简洁一些；但你明白了。顺便说一句，这对于有两个双名的人不起作用（在荷兰，我们有很多'Jan van der Ploeg'），所以我会非常小心结果。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-01T21:09:48.653

我曾经制作了一个 500 个字符的正则表达式来解析任意字符串中的名字、姓氏和中间名。即使使用那个鸣喇叭的正则表达式，由于输入的完全不一致，它也只能得到大约 97% 的准确率。不过，总比没有好。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-01T21:10:08.450

根据已经提出的关于名称中的空格和其他异常的警告，以下代码将至少处理 98% 的名称。（注意：凌乱的 SQL，因为我使用的数据库中没有正则表达式选项。）

**警告：混乱的SQL如下：

```
create table parsname (fullname char(50), name1 char(30), name2 char(30), name3 char(30), name4 char(40));
insert into parsname (fullname) select fullname from ImportTable;
update parsname set name1 = substring(fullname, 1, locate(' ', fullname)),
 fullname = ltrim(substring(fullname, locate(' ', fullname), length(fullname)))
 where locate(' ', rtrim(fullname)) > 0;
update parsname set name2 = substring(fullname, 1, locate(' ', fullname)),
 fullname = ltrim(substring(fullname, locate(' ', fullname), length(fullname)))
 where locate(' ', rtrim(fullname)) > 0;
update parsname set name3 = substring(fullname, 1, locate(' ', fullname)),
 fullname = ltrim(substring(fullname, locate(' ', fullname), length(fullname)))
 where locate(' ', rtrim(fullname)) > 0;
update parsname set name4 = substring(fullname, 1, locate(' ', fullname)),
 fullname = ltrim(substring(fullname, locate(' ', fullname), length(fullname)))
 where locate(' ', rtrim(fullname)) > 0;
// fullname now contains the last word in the string.
select fullname as FirstName, '' as MiddleName, '' as LastName from parsname where fullname is not null and name1 is null and name2 is null
union all
select name1 as FirstName, name2 as MiddleName, fullname as LastName from parsname where name1 is not null and name3 is null 
```

该代码通过创建一个临时表（parsname）并用空格标记全名来工作。任何以 name3 或 name4 值结尾的名称都是不合格的，需要以不同的方式处理。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-01T22:07:24.273

这是一个存储过程，它将找到的第一个单词放入 First Name，将最后一个单词放入 Last Name，并将其间的所有内容放入 Middle Name。

```
create procedure [dbo].[import_ParseName]
(            
    @FullName nvarchar(max),
    @FirstName nvarchar(255) output,
    @MiddleName nvarchar(255) output,
    @LastName nvarchar(255)  output
)
as
begin

set @FirstName = ''
set @MiddleName = ''
set @LastName = ''  
set @FullName = ltrim(rtrim(@FullName))

declare @ReverseFullName nvarchar(max)
set @ReverseFullName = reverse(@FullName)

declare @lengthOfFullName int
declare @endOfFirstName int
declare @beginningOfLastName int

set @lengthOfFullName = len(@FullName)
set @endOfFirstName = charindex(' ', @FullName)
set @beginningOfLastName = @lengthOfFullName - charindex(' ', @ReverseFullName) + 1

set @FirstName = case when @endOfFirstName <> 0 
                      then substring(@FullName, 1, @endOfFirstName - 1) 
                      else ''
                 end

set @MiddleName = case when (@endOfFirstName <> 0 and @beginningOfLastName <> 0 and @beginningOfLastName > @endOfFirstName)
                       then ltrim(rtrim(substring(@FullName, @endOfFirstName , @beginningOfLastName - @endOfFirstName))) 
                       else ''
                  end

set @LastName = case when @beginningOfLastName <> 0 
                     then substring(@FullName, @beginningOfLastName + 1 , @lengthOfFullName - @beginningOfLastName)
                     else ''
                end

return

end 
```

这就是我所说的。

```
DECLARE @FirstName nvarchar(255),
        @MiddleName nvarchar(255),
        @LastName nvarchar(255)

EXEC    [dbo].[import_ParseName]
        @FullName = N'Scott The Other Scott Kowalczyk',
        @FirstName = @FirstName OUTPUT,
        @MiddleName = @MiddleName OUTPUT,
        @LastName = @LastName OUTPUT

print   @FirstName 
print   @MiddleName
print   @LastName 

output:

Scott
The Other Scott
Kowalczyk 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-01T22:22:31.897

正如其他人所说，你不能从简单的程序化方式。

考虑这些例子：

*   总统“乔治·赫伯特·沃克·布什”（First Middle Middle Last）

*   总统刺客“约翰·威尔克斯·布斯”（First Middle Last）

*   吉他手“Eddie Van Halen”（First Last Last）

*   他的妈妈可能称他为 Edward Lodewijk Van Halen (First Middle Last Last)

*   著名的漂流者“玛丽安萨默斯”（First First Last）

*   [新墨西哥州共和党主席](http://www.abqjournal.com/abqnews/index.php?option=com_content&task=view&id=8728&Itemid=2)“Fernando C de Baca”（First Last Last Last）

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-09-11T04:34:23.623

我们当然都明白，没有完美的方法可以解决这个问题，但有些解决方案可以让你走得更远。

特别是，如果您只有一些常见前缀（Mr、Dr、Mrs 等）、中缀（von、de、del 等）、后缀（Jr、III , Sr 等) 等等。如果您有一些常见的名字列表（在各种语言/文化中，如果您的名字多种多样），这也很有帮助，这样您就可以猜测中间的单词是否可能是姓氏的一部分。

BibTeX 还实现了一些启发式方法，让您在其中有所作为；它们被封装在`Text::BibTeX::Name`perl 模块中。这是一个可以完成合理工作的快速代码示例。

```
use Text::BibTeX;
use Text::BibTeX::Name;
$name = "Dr. Mario Luis de Luigi Jr.";
$name =~ s/^\s*([dm]rs?.?|miss)\s+//i;
$dr=$1;
$n=Text::BibTeX::Name->new($name);
print join("\t", $dr, map "@{[ $n->part($_) ]}", qw(first von last jr)), "\n"; 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2011-01-28T22:19:33.963

我遇到的最大问题是像“Bob R. Smith, Jr.”这样的案例。我使用的算法发布在[http://www.blackbeltcoder.com/Articles/strings/splitting-a-name-into-first-and-last-names](http://www.blackbeltcoder.com/Articles/strings/splitting-a-name-into-first-and-last-names)。我的代码在 C# 中，但如果你必须在 SQL 中，你可以移植它。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-06-08T04:25:57.913

@JosephStyons 和 @Digs 的工作很棒！我使用他们的部分工作为 SQL Server 2016 及更高版本创建了一个新函数。这个也处理后缀，以及前缀。

```
CREATE FUNCTION [dbo].[NameParser]
(
    @name nvarchar(100)
)
RETURNS TABLE
AS
RETURN (

WITH prep AS (
    SELECT 
        original = @name,
        cleanName = REPLACE(REPLACE(REPLACE(REPLACE(LTRIM(RTRIM(@name)),'  ',' '),'  ',' '), '.', ''), ',', '')
)
SELECT
    prep.original,
    aux.prefix,
    firstName.firstName,
    middleName.middleName,
    lastName.lastName,
    aux.suffix
FROM
    prep
    CROSS APPLY (
        SELECT 
            prefix =
                CASE 
                    WHEN LEFT(prep.cleanName, 3) IN ('MR ', 'MS ', 'DR ', 'FR ')
                        THEN LEFT(prep.cleanName, 2)
                    WHEN LEFT(prep.cleanName, 4) IN ('MRS ', 'LRD ', 'SIR ')
                        THEN LEFT(prep.cleanName, 3)
                    WHEN LEFT(prep.cleanName, 5) IN ('LORD ', 'LADY ', 'MISS ', 'PROF ')
                        THEN LEFT(prep.cleanName, 4)
                    ELSE ''
                END,
            suffix =
                CASE 
                    WHEN RIGHT(prep.cleanName, 3) IN (' JR', ' SR', ' II', ' IV')
                        THEN RIGHT(prep.cleanName, 2)
                    WHEN RIGHT(prep.cleanName, 4) IN (' III', ' ESQ')
                        THEN RIGHT(prep.cleanName, 3)
                    ELSE ''
                END
    ) aux
    CROSS APPLY (
        SELECT
            baseName = LTRIM(RTRIM(SUBSTRING(prep.cleanName, LEN(aux.prefix) + 1, LEN(prep.cleanName) - LEN(aux.prefix) - LEN(aux.suffix)))),
            numParts = (SELECT COUNT(1) FROM STRING_SPLIT(LTRIM(RTRIM(SUBSTRING(prep.cleanName, LEN(aux.prefix) + 1, LEN(prep.cleanName) - LEN(aux.prefix) - LEN(aux.suffix)))), ' '))
    ) core
    CROSS APPLY (
        SELECT
            firstName = 
                CASE
                    WHEN core.numParts <= 1 THEN core.baseName
                    ELSE LEFT(core.baseName, CHARINDEX(' ', core.baseName, 1) - 1) 
                END

    ) firstName
    CROSS APPLY (
        SELECT
            remainder = 
                CASE
                    WHEN core.numParts <= 1 THEN ''
                    ELSE LTRIM(SUBSTRING(core.baseName, LEN(firstName.firstName) + 1, 999999))
                END
    ) work1
    CROSS APPLY (
        SELECT
            middleName = 
                CASE
                    WHEN core.numParts <= 2 THEN ''
                    ELSE LEFT(work1.remainder, CHARINDEX(' ', work1.remainder, 1) - 1) 
                END
    ) middleName
    CROSS APPLY (
        SELECT
            lastName = 
                CASE
                    WHEN core.numParts <= 1 THEN ''
                    ELSE LTRIM(SUBSTRING(work1.remainder, LEN(middleName.middleName) + 1, 999999))
                END
    ) lastName
)

GO

SELECT * FROM dbo.NameParser('Madonna')
SELECT * FROM dbo.NameParser('Will Smith')
SELECT * FROM dbo.NameParser('Neil Degrasse Tyson')
SELECT * FROM dbo.NameParser('Dr. Neil Degrasse Tyson')
SELECT * FROM dbo.NameParser('Mr. Hyde')
SELECT * FROM dbo.NameParser('Mrs. Thurston Howell, III') 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2018-01-19T00:19:59.190

在 Athena 中检查这个查询是否只有一个空格分隔的字符串（例如名字和中间名组合）：

`SELECT name, REVERSE( SUBSTR( REVERSE(name), 1, STRPOS(REVERSE(name), ' ') ) ) AS middle_name FROM name_table`

如果您希望有两个或更多空格，则可以轻松扩展上述查询。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-04-04T16:53:47.073

基于@hajili 的贡献（这是对 parsename 函数的创造性使用，旨在解析以句点分隔的对象的名称），我对其进行了修改，以便它可以处理数据不包含中间名或当名字是“John and Jane Doe”时。它不是 100% 完美的，但它很紧凑，并且可能会根据业务案例来解决问题。

```
SELECT NAME,
CASE WHEN parsename(replace(NAME, ' ', '.'), 4) IS NOT NULL THEN 
   parsename(replace(NAME, ' ', '.'), 4) ELSE
    CASE WHEN parsename(replace(NAME, ' ', '.'), 3) IS NOT NULL THEN 
    parsename(replace(NAME, ' ', '.'), 3) ELSE
   parsename(replace(NAME, ' ', '.'), 2) end END as FirstName
   ,
CASE WHEN parsename(replace(NAME, ' ', '.'), 3) IS NOT NULL THEN 
   parsename(replace(NAME, ' ', '.'), 2) ELSE NULL END as MiddleName,
   parsename(replace(NAME, ' ', '.'), 1) as LastName
from  {@YourTableName} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2019-07-16T11:31:31.823

员工表有“姓名”列，我们必须将其拆分为名字、中间名和姓氏。如果 name 列的值是两个单词，例如“James Thomas”，则此查询将处理以将中间名保持为空。

```
UPDATE Employees
SET [First Name] = CASE 
        WHEN (len(name) - len(Replace(name, '.', ''))) = 2
            THEN PARSENAME(Name, 3)
        WHEN (len(name) - len(Replace(name, '.', ''))) = 1
            THEN PARSENAME(Name, 2)
        ELSE PARSENAME(Name, 1)
        END
    ,[Middle Name] = CASE 
        WHEN (len(name) - len(Replace(name, '.', ''))) = 2
            THEN PARSENAME(Name, 2)
        ELSE NULL
        END
    ,[Last Name] = CASE 
        WHEN (len(name) - len(Replace(name, '.', ''))) = 2
            THEN PARSENAME(Name, 1)
        WHEN (len(name) - len(Replace(name, '.', ''))) = 1
            THEN PARSENAME(Name, 1)
        ELSE NULL
        END GO

UPDATE Employee
SET [Name] = Replace([Name], '.', ' ') GO 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-07-24T00:30:31.683

我想发布对 hajili 建议的更新，但这个回复太长，无法评论该建议。

我们的问题是“姓，名中间名”，其中一些姓氏中有一个空格。

所以我们想出了：

```
,FullName           = CUST.FULLNAME
,LastName           = PARSENAME(REPLACE(CUST.FULLNAME, ',', '.'),2)
,FirstName          = (CASE WHEN PARSENAME(REPLACE(CUST.FULLNAME, ',', '.'),1) LIKE '% %' THEN PARSENAME(REPLACE(PARSENAME(REPLACE(CUST.FULLNAME, ',', '.'),1), ' ', '.'),2) ELSE PARSENAME(REPLACE(CUST.FULLNAME, ',', '.'),1) END)
,MiddleName         = (CASE WHEN PARSENAME(REPLACE(CUST.FULLNAME, ' ', '.'),1) LIKE '%,%' THEN NULL ELSE PARSENAME(REPLACE(CUST.FULLNAME, ' ', '.'),1) END) 
```

# .net - LINQ to XML 用于小型应用程序是否可以替代小型数据库？

> ID：159568
> 
> 赞同：3
> 
> 时间：2008-10-01T20:33:10.643
> 
> 标签：.net, linq, linq-to-xml

我正在创建一个将部署在 Window 上的小型应用程序。数据库将有少于 10 个表。

不是在客户端上安装数据库，而是使用数据库的 XML 文档和 LINQ 会降低查询性能，等待加载和写入 XML 文件？

如果我使用数据库，我将使用 LINQ to SQL。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T20:35:17.160

我会避免它。我个人会为数据库使用 SqlExpress 之类的东西，或者使用 .mdb 文件。当 Xml 文件开始变大或需要更改格式（即更新表结构）时，问题就出现了，处理变成了 PITA。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T20:39:26.887

您可以使用像 SQLite 这样的嵌入式数据库或 SQL Server 的便携式版本（不记得它叫什么），这样您仍然可以使用 SQL 和 LINQ，但您不需要安装数据库服务器

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T20:42:30.933

如果您选择数据库路由，我更愿意这样做。主要原因之一是您可以在使用数据库时轻松执行许多不同的功能。这些功能包括排序、分页、分组等。您还可以使用 OR 映射器的强大功能来简化您的编码，并用很少的代码行实现持久化、检索操作。

底线是与数据库一起去！

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-05T11:31:11.303

添加一些对 MagicKat 答案的引用：

不是很便携，但免费且有限 -

[SQL Server 2008 速成版](http://www.microsoft.com/express/sql/download/)

Microsoft [*JET*](http://en.wikipedia.org/wiki/Microsoft_Jet_Database_Engine)更适合 Nir ​​的*紧凑*要求。它是嵌入式的（作为 DLL 安装），您可以将 DB 作为单个文件 (.mdb) 移动。从 Wikipedia 文章中，我了解到当前版本是*Microsoft Access Engine*。

# recursion - 从递归到迭代的方法

> ID：159590
> 
> 赞同：417
> 
> 时间：2008-10-01T20:38:46.373
> 
> 标签：recursion, iteration, language-agnostic, computer-science, theory

我在多年的编程中使用了很多递归来解决简单的问题，但我完全意识到有时由于内存/速度问题您需要迭代。

因此，在很久以前的某个时候，我去尝试查找是否存在将通用递归方法转换为迭代的任何“模式”或教科书方法，但一无所获。或者至少我记得没有任何帮助。

*   有一般规则吗？
*   有“模式”吗？

* * *

## 回答 #1

> 赞同：395
> 
> 时间：2008-10-01T21:12:30.660

通常，我通过将通常传递给递归函数的参数推入堆栈来用迭代算法替换递归算法。事实上，您正在用自己的程序堆栈替换程序堆栈。

```
var stack = [];
stack.push(firstObject);

// while not empty
while (stack.length) {

    // Pop off end of stack.
    obj = stack.pop();

    // Do stuff.
    // Push other objects on the stack as needed.
    ...

} 
```

注意：如果内部有多个递归调用并且想要保留调用的顺序，则必须以相反的顺序将它们添加到堆栈中：

```
foo(first);
foo(second); 
```

必须替换为

```
stack.push(second);
stack.push(first); 
```

编辑：文章[堆栈和递归消除](http://cs.saddleback.edu/rwatkins/CS2B/Lab%20Exercises/Stacks%20and%20Recursion%20Lab.pdf)（或[文章备份链接](https://web.archive.org/web/20120227170843/http://cs.saddleback.edu/rwatkins/CS2B/Lab%20Exercises/Stacks%20and%20Recursion%20Lab.pdf)）详细介绍了这个主题。

* * *

## 回答 #2

> 赞同：85
> 
> 时间：2008-10-01T20:55:03.197

实际上，最常见的方法是保留自己的堆栈。这是 C 中的递归快速排序函数：

```
void quicksort(int* array, int left, int right)
{
    if(left >= right)
        return;

    int index = partition(array, left, right);
    quicksort(array, left, index - 1);
    quicksort(array, index + 1, right);
} 
```

以下是我们如何通过保留自己的堆栈来使其迭代：

```
void quicksort(int *array, int left, int right)
{
    int stack[1024];
    int i=0;

    stack[i++] = left;
    stack[i++] = right;

    while (i > 0)
    {
        right = stack[--i];
        left = stack[--i];

        if (left >= right)
             continue;

        int index = partition(array, left, right);
        stack[i++] = left;
        stack[i++] = index - 1;
        stack[i++] = index + 1;
        stack[i++] = right;
    }
} 
```

显然，这个例子没有检查堆栈边界......实际上你可以根据给定左右值的最坏情况来调整堆栈大小。但你明白了。

* * *

## 回答 #3

> 赞同：64
> 
> 时间：2011-12-14T21:42:35.173

似乎没有人解决递归函数在主体中多次调用自身的位置，并处理返回到递归中的特定点（即不是原始递归）。据说[每次递归都可以变成迭代](https://stackoverflow.com/questions/931762/can-every-recursion-be-converted-into-iteration/933979#comment10514125_933979)，看来这应该是可以的。

我刚刚想出了一个如何做到这一点的 C# 示例。假设您有以下递归函数，它的作用类似于后序遍历，并且 AbcTreeNode 是具有指针 a、b、c 的三叉树。

```
public static void AbcRecursiveTraversal(this AbcTreeNode x, List<int> list) {
        if (x != null) {
            AbcRecursiveTraversal(x.a, list);
            AbcRecursiveTraversal(x.b, list);
            AbcRecursiveTraversal(x.c, list);
            list.Add(x.key);//finally visit root
        }
} 
```

迭代解决方案：

```
 int? address = null;
        AbcTreeNode x = null;
        x = root;
        address = A;
        stack.Push(x);
        stack.Push(null)    

        while (stack.Count > 0) {
            bool @return = x == null;

            if (@return == false) {

                switch (address) {
                    case A://   
                        stack.Push(x);
                        stack.Push(B);
                        x = x.a;
                        address = A;
                        break;
                    case B:
                        stack.Push(x);
                        stack.Push(C);
                        x = x.b;
                        address = A;
                        break;
                    case C:
                        stack.Push(x);
                        stack.Push(null);
                        x = x.c;
                        address = A;
                        break;
                    case null:
                        list_iterative.Add(x.key);
                        @return = true;
                        break;
                }

            }

            if (@return == true) {
                address = (int?)stack.Pop();
                x = (AbcTreeNode)stack.Pop();
            }

        } 
```

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2008-10-01T20:45:32.877

努力进行递归调用[Tail Recursion](http://en.wikipedia.org/wiki/Tail_recursion)（最后一条语句是递归调用的递归）。一旦你有了它，将它转换为迭代通常很容易。

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2008-10-01T20:53:27.960

好吧，一般来说，递归可以通过简单地使用存储变量来模拟为迭代。请注意，递归和迭代通常是等价的；一个几乎总是可以转换为另一个。尾递归函数很容易转换为迭代函数。只需将累加器变量设为本地变量，然后迭代而不是递归。这是 C++ 中的一个示例（如果 C 不是为了使用默认参数）：

```
// tail-recursive
int factorial (int n, int acc = 1)
{
  if (n == 1)
    return acc;
  else
    return factorial(n - 1, acc * n);
}

// iterative
int factorial (int n)
{
  int acc = 1;
  for (; n > 1; --n)
    acc *= n;
  return acc;
} 
```

了解我，我可能在代码中犯了一个错误，但想法就在那里。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2010-11-06T16:27:11.603

即使使用堆栈也不会将递归算法转换为迭代。普通递归是基于函数的递归，如果我们使用堆栈，那么它就变成了基于堆栈的递归。但它仍然是递归的。

对于递归算法，空间复杂度为 O(N)，时间复杂度为 O(N)。对于迭代算法，空间复杂度为 O(1)，时间复杂度为 O(N)。

但是，如果我们使用堆栈，那么复杂性仍然是一样的。我认为只有尾递归可以转换为迭代。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2013-04-29T14:43:54.607

[堆栈和递归消除](http://cs.saddleback.edu/rwatkins/CS2B/Lab%20Exercises/Stacks%20and%20Recursion%20Lab.pdf)文章捕获了在堆上外部化堆栈帧的想法，但没有提供一种**直接且可重复**的转换方式。下面是一个。

在转换为迭代代码时，必须注意递归调用可能来自任意深度的代码块。它不仅是参数，还有返回到仍有待执行的逻辑的点以及参与后续条件的变量的状态，这很重要。下面是一种非常简单的方法，可以以最少的更改转换为迭代代码。

考虑这个递归代码：

```
struct tnode
{
    tnode(int n) : data(n), left(0), right(0) {}
    tnode *left, *right;
    int data;
};

void insertnode_recur(tnode *node, int num)
{
    if(node->data <= num)
    {
        if(node->right == NULL)
            node->right = new tnode(num);
        else
            insertnode(node->right, num);
    }
    else
    {
        if(node->left == NULL)
            node->left = new tnode(num);
        else
            insertnode(node->left, num);
    }    
} 
```

迭代代码：

```
// Identify the stack variables that need to be preserved across stack 
// invocations, that is, across iterations and wrap them in an object
struct stackitem 
{ 
    stackitem(tnode *t, int n) : node(t), num(n), ra(0) {}
    tnode *node; int num;
    int ra; //to point of return
};

void insertnode_iter(tnode *node, int num) 
{
    vector<stackitem> v;
    //pushing a stackitem is equivalent to making a recursive call.
    v.push_back(stackitem(node, num));

    while(v.size()) 
    {
        // taking a modifiable reference to the stack item makes prepending 
        // 'si.' to auto variables in recursive logic suffice
        // e.g., instead of num, replace with si.num.
        stackitem &si = v.back(); 
        switch(si.ra)
        {
        // this jump simulates resuming execution after return from recursive 
        // call 
            case 1: goto ra1;
            case 2: goto ra2;
            default: break;
        } 

        if(si.node->data <= si.num)
        {
            if(si.node->right == NULL)
                si.node->right = new tnode(si.num);
            else
            {
                // replace a recursive call with below statements
                // (a) save return point, 
                // (b) push stack item with new stackitem, 
                // (c) continue statement to make loop pick up and start 
                //    processing new stack item, 
                // (d) a return point label
                // (e) optional semi-colon, if resume point is an end 
                // of a block.

                si.ra=1;
                v.push_back(stackitem(si.node->right, si.num));
                continue; 
ra1:            ;         
            }
        }
        else
        {
            if(si.node->left == NULL)
                si.node->left = new tnode(si.num);
            else
            {
                si.ra=2;                
                v.push_back(stackitem(si.node->left, si.num));
                continue;
ra2:            ;
            }
        }

        v.pop_back();
    }
} 
```

请注意代码的结构如何仍然符合递归逻辑，并且修改最少，从而减少了错误数量。为了比较，我用 ++ 和 -- 标记了更改。除了 v.push_back 之外，大多数新插入的块对于任何转换的迭代逻辑都是通用的

```
void insertnode_iter(tnode *node, int num) 
{ 
```

`+++++++++++++++++++++++++`

```
 vector<stackitem> v;
    v.push_back(stackitem(node, num));

    while(v.size())
    {
        stackitem &si = v.back(); 
        switch(si.ra)
        {
            case 1: goto ra1;
            case 2: goto ra2;
            default: break;
        } 
```

`------------------------`

```
 if(si.node->data <= si.num)
        {
            if(si.node->right == NULL)
                si.node->right = new tnode(si.num);
            else
            { 
```

`+++++++++++++++++++++++++`

```
 si.ra=1;
                v.push_back(stackitem(si.node->right, si.num));
                continue; 
ra1:            ; 
```

`-------------------------`

```
 }
        }
        else
        {
            if(si.node->left == NULL)
                si.node->left = new tnode(si.num);
            else
            { 
```

`+++++++++++++++++++++++++`

```
 si.ra=2;                
                v.push_back(stackitem(si.node->left, si.num));
                continue;
ra2:            ; 
```

`-------------------------`

```
 }
        } 
```

`+++++++++++++++++++++++++`

```
 v.pop_back();
    } 
```

`-------------------------`

```
} 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-10-01T20:48:00.530

在谷歌上搜索“继续传递风格”。有一个转换为尾递归样式的通用过程；还有一个将尾递归函数转换为循环的通用过程。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2011-08-25T05:15:56.270

只是消磨时间......递归函数

```
void foo(Node* node)
{
    if(node == NULL)
       return;
    // Do something with node...
    foo(node->left);
    foo(node->right);
} 
```

可以转换为

```
void foo(Node* node)
{
    if(node == NULL)
       return;

    // Do something with node...

    stack.push(node->right);
    stack.push(node->left);

    while(!stack.empty()) {
         node1 = stack.pop();
         if(node1 == NULL)
            continue;
         // Do something with node1...
         stack.push(node1->right);             
         stack.push(node1->left);
    }

} 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2017-08-14T15:09:15.953

想想实际上需要堆栈的东西：

如果我们将递归模式视为：

```
if(task can be done directly) {
    return result of doing task directly
} else {
    split task into two or more parts
    solve for each part (possibly by recursing)
    return result constructed by combining these solutions
} 
```

例如，经典的河内塔

```
if(the number of discs to move is 1) {
    just move it
} else {
    move n-1 discs to the spare peg
    move the remaining disc to the target peg
    move n-1 discs from the spare peg to the target peg, using the current peg as a spare
} 
```

这可以转换为在显式堆栈上工作的循环，方法是将其重述为：

```
place seed task on stack
while stack is not empty 
   take a task off the stack
   if(task can be done directly) {
      Do it
   } else {
      Split task into two or more parts
      Place task to consolidate results on stack
      Place each task on stack
   }
} 
```

对于河内塔，这变为：

```
stack.push(new Task(size, from, to, spare));
while(! stack.isEmpty()) {
    task = stack.pop();
    if(task.size() = 1) {
        just move it
    } else {
        stack.push(new Task(task.size() -1, task.spare(), task,to(), task,from()));
        stack.push(new Task(1, task.from(), task.to(), task.spare()));
        stack.push(new Task(task.size() -1, task.from(), task.spare(), task.to()));
    }
} 
```

关于如何定义堆栈，这里有相当大的灵活性。您可以使您的堆栈成为`Command`执行复杂操作的对象列表。或者你可以反其道而行之，让它成为一个更简单类型的列表（例如，一个“任务”可能是 4 个元素在堆栈中`int`，而不是在堆栈中的一个元素`Task`）。

这意味着堆栈的内存在堆中而不是在 Java 执行堆栈中，但这很有用，因为您可以更好地控制它。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2012-05-23T11:31:20.593

通常，避免堆栈溢出的技术用于递归函数，称为蹦床技术，被 Java 开发人员广泛采用。

[但是，对于 C#，这里](http://qualityofdata.com/2012/02/03/how-to-run-most-of-the-recursive-functions-iteratively/)有一个小辅助方法，可以将递归函数转换为迭代，而无需更改逻辑或使代码难以理解。C# 是一门很好的语言，用它可以创造出惊人的东西。

它通过帮助方法包装方法的一部分来工作。例如下面的递归函数：

```
int Sum(int index, int[] array)
{
 //This is the termination condition
 if (int >= array.Length)
 //This is the returning value when termination condition is true
 return 0;

//This is the recursive call
 var sumofrest = Sum(index+1, array);

//This is the work to do with the current item and the
 //result of recursive call
 return array[index]+sumofrest;
} 
```

变成：

```
int Sum(int[] ar)
{
 return RecursionHelper<int>.CreateSingular(i => i >= ar.Length, i => 0)
 .RecursiveCall((i, rv) => i + 1)
 .Do((i, rv) => ar[i] + rv)
 .Execute(0);
} 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-10-01T20:48:55.600

要寻找的一种模式是函数末尾的递归调用（所谓的尾递归）。这可以很容易地用一段时间来替换。例如，函数 foo：

```
void foo(Node* node)
{
    if(node == NULL)
       return;
    // Do something with node...
    foo(node->left);
    foo(node->right);
} 
```

以调用 foo 结束。这可以替换为：

```
void foo(Node* node)
{
    while(node != NULL)
    {
        // Do something with node...
        foo(node->left);
        node = node->right;
     }
} 
```

这消除了第二次递归调用。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2016-07-08T10:58:28.307

作为此[问题](https://stackoverflow.com/q/38263100/315052)的副本已关闭的问题具有非常具体的数据结构：

[![在此处输入图像描述](https://i.stack.imgur.com/7Ktr0.jpg)](https://i.stack.imgur.com/7Ktr0.jpg)

该节点具有以下结构：

```
typedef struct {
    int32_t type;
    int32_t valueint;
    double  valuedouble;
    struct  cNODE *next;
    struct  cNODE *prev;
    struct  cNODE *child;
} cNODE; 
```

递归删除函数如下所示：

```
void cNODE_Delete(cNODE *c) {
    cNODE*next;
    while (c) {
        next=c->next;
        if (c->child) { 
          cNODE_Delete(c->child)
        }
        free(c);
        c=next;
    }
} 
```

通常，对于多次调用自身（甚至一次）的递归函数，并不总是可以避免堆栈。但是，对于这种特殊的结构，这是可能的。这个想法是将所有节点展平为一个列表。这是通过将当前节点放在`child`顶行列表的末尾来完成的。

```
void cNODE_Delete (cNODE *c) {
    cNODE *tmp, *last = c;
    while (c) {
        while (last->next) {
            last = last->next;   /* find last */
        }
        if ((tmp = c->child)) {
            c->child = NULL;     /* append child to last */
            last->next = tmp;
            tmp->prev = last;
        }
        tmp = c->next;           /* remove current */
        free(c);
        c = tmp;
    }
} 
```

这种技术可以应用于任何可以简化为具有确定性拓扑排序的 DAG 的数据链接结构。当前节点子节点被重新排列，以便最后一个子节点采用所有其他子节点。然后可以删除当前节点，然后遍历可以迭代到剩余的子节点。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2012-05-18T10:06:16.303

递归只不过是从另一个函数调用一个函数的过程，只有这个过程是通过调用一个函数本身来完成的。正如我们所知，当一个函数调用另一个函数时，第一个函数保存其状态（其变量），然后将控制权传递给被调用函数。被调用的函数可以使用同名的变量来调用，例如 fun1(a) 可以调用 fun2(a)。当我们进行递归调用时，没有任何新的事情发生。一个函数通过将相同类型和名称相似的变量（但显然存储在变量中的值不同，只有名称保持不变）传递给自己来调用自己。但在每次调用之前，该函数都会保存其状态，并且此保存过程会继续进行。保存是在堆栈上完成的。

现在堆栈开始发挥作用。

因此，如果您编写一个迭代程序，每次都将状态保存在堆栈中，然后在需要时从堆栈中弹出值，那么您已经成功地将递归程序转换为迭代程序！

证明是简单和分析性的。

在递归中，计算机维护一个堆栈，而在迭代版本中，您将不得不手动维护堆栈。

考虑一下，只需将深度优先搜索（在图上）递归程序转换为 dfs 迭代程序。

祝一切顺利！

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2021-08-21T12:20:59.143

### TLDR

您可以比较下面的源代码，前后对比以直观地理解该方法，而无需阅读整个答案。

我在处理非常大的文本块以生成后缀数组时遇到了一些多键快速排序代码的问题。由于所需的递归深度极深，代码将中止。通过这种方法，终止问题得到了解决。转换后，可以捕获某些作业所需的最大帧数，介于 10K 和 100K 之间，占用 1M 到 6M 内存。不是最佳解决方案，有更有效的方法来生成后缀数组。但无论如何，这是使用的方法。

### 该方法

将递归函数转换为适用于任何情况的迭代解决方案的一般方法是模仿在函数调用和调用返回期间本地编译的代码使用的过程。

举一个需要一些复杂方法的例子，我们有多键快速排序算法。这个函数有三个连续的递归调用，每次调用后，从下一行开始执行。

函数的状态被捕获在堆栈帧中，该堆栈帧被推入执行堆栈。当`sort()`从自身内部调用并返回时，将恢复调用时存在的堆栈帧。这样，所有变量都具有与调用之前相同的值 - 除非它们被调用修改。

### 递归函数

```
def sort(a: list_view, d: int):
    if len(a) <= 1:
        return
    p = pivot(a, d)
    i, j = partition(a, d, p)
    sort(a[0:i], d)
    sort(a[i:j], d + 1)
    sort(a[j:len(a)], d) 
```

采用这个模型，并模仿它，一个列表被设置为堆栈。在此示例中，元组用于模拟帧。如果这是用 C 编码的，则可以使用结构。数据可以包含在数据结构中，而不是一次只推送一个值。

### 重新实现为“迭代”

```
# Assume `a` is view-like object where slices reference
# the same internal list of strings.

def sort(a: list_view):
    stack = []
    stack.append((LEFT, a, 0))                  # Initial frame.

    while len(stack) > 0:
        frame = stack.pop()  

        if len(frame[1]) <= 1:                  # Guard.
            continue

        stage = frame[0]                        # Where to jump to.

        if stage == LEFT: 
            _, a, d = frame                     # a - array/list, d - depth.
            p = pivot(a, d)
            i, j = partition(a, d, p)
            stack.append((MID, a, i, j, d))     # Where to go after "return".
            stack.append((LEFT, a[0:i], d))     # Simulate function call.

        elif stage == MID:                      # Picking up here after "call"
            _, a, i, j, d = frame               # State before "call" restored.
            stack.append((RIGHT, a, i, j, d))   # Set up for next "return".
            stack.append((LEFT, a[i:j], d + 1)) # Split list and "recurse".

        elif stage == RIGHT:
            _, a, _, j, d = frame
            stack.append((LEFT, a[j:len(a)], d)

        else:
           pass 
```

进行函数调用时，函数返回后从何处开始执行的信息包含在堆栈帧中。在此示例中，`if/elif/else`块表示从调用返回后开始执行的点。在 C 中，这可以作为`switch`语句来实现。

在示例中，块被赋予标签；它们通过列表在每个块内的分区方式任意标记。第一个块“LEFT”在左侧拆分列表。“MID”部分表示在中间分割列表的块等。

使用这种方法，模仿呼叫需要两个步骤。首先，一帧被压入堆栈，这将导致在“调用”“返回”之后的当前块之后的块中继续执行。框架中的值指示`if/elif/else`在“调用”之后的循环中落入哪个部分。

然后“调用”帧被压入堆栈。对于此特定示例，在大多数情况下，这会将执行发送到第一个“LEFT”块。这是实际排序完成的地方，无论列表的哪个部分被拆分到那里。

在循环开始之前，推到函数顶部的主帧代表初始调用。然后在每次迭代中，都会弹出一个帧。框架中的“LEFT/MID/RIGHT”值/标签用于落入`if/elif/else`语句的正确块中。该帧用于恢复当前操作所需变量的状态，然后在下一次迭代中弹出返回帧，将执行发送到后续部分。

### 返回值

如果递归函数返回一个自己使用的值，则可以像对待其他变量一样对待它。只需在堆栈帧中为其创建一个字段。如果“被调用者”正在返回一个值，它会检查堆栈以查看它是否有任何条目；如果是这样，则更新堆栈顶部框架中的返回值。对于这个例子，[你可以检查](https://stackoverflow.com/a/69429522/7915759)这个相同方法的另一个例子，以递归到迭代转换。

### 结论

像这样将递归函数转换为迭代函数的方法本质上也是“递归的”。代替进程堆栈用于实际的函数调用，另一个以编程方式实现的堆栈取而代之。

得到了什么？也许在速度上有一些边际改进。或者它可以作为一种绕过某些编译器和/或执行环境（堆栈指针命中保护页）施加的堆栈限制的方法。在某些情况下，可以减少压入堆栈的数据量。增益是否通过模仿我们通过递归实现自动获得的东西来抵消代码中引入的复杂性？

在排序算法的情况下，找到一种方法来实现这个特定的没有堆栈的算法可能具有挑战性，而且有很多迭代排序算法可用，而且速度要快得多。据说任何递归算法都可以迭代实现。当然......但是有些算法在没有被修改到不再是同一个算法的情况下不能很好地转换。

仅仅为了转换递归算法而转换它们可能不是一个好主意。无论如何，对于它的价值，上述方法是一种通用的转换方式，应该适用于几乎任何事情。

如果你发现你真的需要一个迭代版本的递归函数，它不使用自己的内存消耗堆栈，最好的方法可能是废弃代码并使用学术文章中的描述编写你自己的代码，或者工作它写在纸上，然后从头开始编码，或者其他从头开始的方法。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-11-14T04:45:56.847

有一种通用的方法可以通过使用连接多个迭代器供应商的惰性迭代器（返回迭代器的 lambda 表达式）将递归遍历转换为迭代器。请参阅我的[将递归遍历转换为迭代器](http://www.cnblogs.com/weidagang2046/p/lazy-iterator.html%7D)。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2018-06-14T12:03:13.273

使用堆栈将递归函数转换为迭代函数的另一个简单而完整的示例。

```
#include <iostream>
#include <stack>
using namespace std;

int GCD(int a, int b) { return b == 0 ? a : GCD(b, a % b); }

struct Par
{
    int a, b;
    Par() : Par(0, 0) {}
    Par(int _a, int _b) : a(_a), b(_b) {}
};

int GCDIter(int a, int b)
{
    stack<Par> rcstack;

    if (b == 0)
        return a;
    rcstack.push(Par(b, a % b));

    Par p;
    while (!rcstack.empty()) 
    {
        p = rcstack.top();
        rcstack.pop();
        if (p.b == 0)
            continue;
        rcstack.push(Par(p.b, p.a % p.b));
    }

    return p.a;
}

int main()
{
    //cout << GCD(24, 36) << endl;
    cout << GCDIter(81, 36) << endl;

    cin.get();
    return 0;
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2020-04-28T06:20:09.950

我的示例在 Clojure 中，但应该很容易翻译成任何语言。

鉴于此函数`StackOverflow`s 用于较大的 n 值：

```
(defn factorial [n]
  (if (< n 2)
    1
    (*' n (factorial (dec n))))) 
```

我们可以通过以下方式定义使用自己的堆栈的版本：

```
(defn factorial [n]
  (loop [n n
         stack []]
    (if (< n 2)
      (return 1 stack)
      ;; else loop with new values
      (recur (dec n)
             ;; push function onto stack
             (cons (fn [n-1!]
                     (*' n n-1!))
                   stack))))) 
```

其中`return`定义为：

```
(defn return
  [v stack]
  (reduce (fn [acc f]
            (f acc))
          v
          stack)) 
```

这也适用于更复杂的函数，例如[ackermann 函数](https://en.wikipedia.org/wiki/Ackermann_function)：

```
(defn ackermann [m n]
  (cond
    (zero? m)
    (inc n)

    (zero? n)
    (recur (dec m) 1)

    :else
    (recur (dec m)
           (ackermann m (dec n))))) 
```

可以转化为：

```
(defn ackermann [m n]
  (loop [m m
         n n
         stack []]
    (cond
      (zero? m)
      (return (inc n) stack)

      (zero? n)
      (recur (dec m) 1 stack)

      :else
      (recur m
             (dec n)
             (cons #(ackermann (dec m) %)
                   stack))))) 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2013-08-02T21:08:41.573

系统如何使用任何递归函数并使用堆栈执行它的粗略描述：

这是为了展示这个想法而没有细节。考虑这个将打印出图形节点的函数：

```
function show(node)
0\. if isleaf(node):
1\.  print node.name
2\. else:
3\.  show(node.left)
4\.  show(node)
5\.  show(node.right) 
```

例如图表： A->B A->C show(A) 将打印 B, A, C

函数调用意味着保存本地状态和延续点，以便您可以返回，然后跳转您要调用的函数。

例如，假设 show(A) 开始运行。第 3 行的函数调用。 show(B) 意味着 - 将项目添加到堆栈，意思是“您需要在第 2 行继续，局部变量状态节点 = A” - 转到第 0 行，节点 = B。

为了执行代码，系统运行指令。当遇到函数调用时，系统将需要返回的信息推送到原来的位置，运行函数代码，当函数完成时，弹出关于需要去哪里继续的信息。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-11-30T04:56:56.487

此[链接](https://secweb.cs.odu.edu/~zeil/cs361/web/website/Lectures/recursionConversion/page/recursionConversion.html)提供了一些解释，并提出了保持“位置”以便能够在几个递归调用之间到达确切位置的想法：

但是，所有这些示例都描述了递归调用执行*固定*次数的场景。当您遇到以下情况时，事情会变得更加棘手：

```
function rec(...) {
  for/while loop {
    var x = rec(...)
    // make a side effect involving return value x
  }
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-07-01T11:03:05.510

这是一个老问题，但我想添加一个不同的方面作为解决方案。我目前正在做一个项目，在这个项目中我使用了 C# 的洪水填充算法。通常，我一开始使用递归来实现这个算法，但很明显，它导致了堆栈溢出。之后，我将方法从递归更改为迭代。是的，它起作用了，我不再收到堆栈溢出错误。但这一次，由于我将洪水填充方法应用于非常大的结构，因此程序进入了无限循环。出于这个原因，我想到这个函数可能重新进入了它已经访问过的地方。作为对此的最终解决方案，我决定为访问点使用字典。如果该 node(x,y) 已经第一次添加到堆栈结构中，则该 node(x, y) 将作为键保存在字典中。即使稍后尝试再次添加相同的节点，它也不会被添加到堆栈结构中，因为该节点已经在字典中。让我们看看伪代码：

```
startNode = pos(x,y)

Stack stack = new Stack();

Dictionary visited<pos, bool> = new Dictionary();

stack.Push(startNode);

while(stack.count != 0){
    currentNode = stack.Pop();
    if "check currentNode if not available"
        continue;
    if "check if already handled"
        continue;
    else if "run if it must be wanted thing should be handled"      
        // make something with pos currentNode.X and currentNode.X  

        // then add its neighbor nodes to the stack to iterate
        // but at first check if it has already been visited.

        if(!visited.Contains(pos(x-1,y)))
            visited[pos(x-1,y)] = true;
            stack.Push(pos(x-1,y));
        if(!visited.Contains(pos(x+1,y)))
            ...
        if(!visited.Contains(pos(x,y+1)))
            ...
        if(!visited.Contains(pos(x,y-1)))
            ...
} 
```

# design-patterns - Is there anything inherently wrong with long object invocation chains?

> ID：159594
> 
> 赞同：6
> 
> 时间：2008-10-01T20:40:03.763
> 
> 标签：design-patterns, architecture, method-chaining, law-of-demeter

I've organized my code hierarchically and I find myself crawling up the tree using code like the following.

```
File clientFolder = task.getActionPlan().getClientFile().getClient().getDocumentsFolder(); 
```

I'm not drilling down into the `task` object; I'm drilling up to its parents, so I don't think I'm losing anything in terms of encapsulation; but a flag is going off in the back of my mind telling me there's something dirty about doing it this way.

Is this wrong?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-01T21:05:54.340

旗帜是红色的，它用**粗体**表示两件事：

*   为了遵循链，调用代码必须知道整个树结构，这不是很好的封装，并且
*   如果层次结构发生变化，您将需要编辑大量代码

括号中的一件事：

*   使用属性，即 task.ActionPlan 而不是 task.getActionPlan()

一个更好的解决方案可能是 - 假设您需要在子级别的树上公开所有父属性 - 继续并在子级上实现直接属性，即

```
File clientFolder = task.DocumentsFolder; 
```

这至少会从调用代码中隐藏树结构。在内部，属性可能如下所示：

```
class Task {
    public File DocumentsFolder {
        get { return ActionPlan.DocumentsFolder; }
    }
    ...
}
class ActionPlan {
    public File DocumentsFolder {
        get { return ClientFile.DocumentsFolder: }
    }
    ...
}
class ClientFile {
    public File DocumentsFolder {
        get { return Client.DocumentsFolder; }
    }
    ...
}
class Client {
    public File DocumentsFolder {
        get { return ...; } //whatever it really is
    }
    ...
} 
```

但是如果将来树结构发生变化，您只需要更改树中涉及的类中的访问器函数，而不是您调用链的每个地方。

[另外，在属性函数中正确地捕获和报告空值会更容易，这在上面的示例中被省略了]

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T20:46:29.053

Well, every indirection adds one point where it could go wrong.

In particular, any of the methods in this chain could return a null (in theory, in your case you might have methods that cannot possibly do that), and when that happens you'll know it happened *to one of those methods*, but not *which one*.

So if there is any chance any of the methods could return a null, I'd at least split the chain at those points, and store in intermediate variables, and break it up into individual lines, so that a crash report would give me a line number to look at.

Apart from that I can't see any obvious problems with it. If you have, or can make, guarantees that the null-reference won't be a problem, it would do what you want.

What about readability? Would it be clearer if you added named variables? Always write code like you intend it to be read by a fellow programmer, and only incidentally be interpreted by a compiler.

In this case I would have to read the chain of method calls and figure out... ok, it gets a document, it's the document of a client, the client is coming from a ... file... right, and the file is from an action plan, etc. Long chains might make it less readable than, say, this:

```
ActionPlan taskPlan = task.GetActionPlan();
ClientFile clientFileOfTaskPlan = taskPlan.GetClientFile();
Client clientOfTaskPlan = clientFileOfTaskPlan.GetClient();
File clientFolder = clientOfTaskPlan.getDocumentsFolder(); 
```

I guess it comes down to personal opinion on this matter.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T23:04:12.233

[getter 和 setter 是邪恶的](http://www.javaworld.com/javaworld/jw-09-2003/jw-0905-toolbox.html)。一般来说，避免让一个对象用它做某事。而是委派任务本身。

代替

```
Object a = b.getA();
doSomething(a); 
```

做

```
b.doSomething(); 
```

与所有设计原则一样，不要盲目地遵循这一点。如果没有 getter 和 setter，我永远无法编写任何远程复杂的东西，但这是一个很好的指导方针。如果你有很多 getter 和 setter，这可能意味着你做错了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T20:53:24.543

首先，像这样堆叠代码会使在单步调试器中分析 NullPointerExceptions 和检查引用变得很烦人。

除此之外，我认为这一切都归结为：**调用者需要具备所有这些知识吗？**

也许它的功能可以变得更通用；然后可以将 File 作为参数传递。或者，也许 ActionPlan 甚至不应该透露它的实现是基于 ClientFile 的？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T20:59:05.573

我同意提到得墨忒耳法则的海报。您正在做的是对许多这些类的实现以及层次结构本身的结构创建不必要的依赖关系。这将使孤立地测试您的代码变得非常困难，因为您需要初始化十几个其他对象才能获得要测试的类的工作实例。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T21:25:27.523

多么及时。今晚我将在我的博客上写一篇关于这种气味[Message Chains](http://sis36.berkeley.edu/projects/streek/agile/bad-smells-in-code.html#Message+Chains)与其相反的[Middle Man](http://sis36.berkeley.edu/projects/streek/agile/bad-smells-in-code.html#Middle+Man)的文章。

无论如何，一个更深层次的问题是为什么你对似乎是域对象的东西有“get”方法。如果您密切关注问题的轮廓，您会发现告诉任务获取某些东西是没有意义的，或者您正在做的实际上是一个非业务逻辑问题，例如准备 UI 显示，持久化，对象重建等。

在后一种情况下，只要[授权类使用“get”方法就可以了](http://moffdub.wordpress.com/restricted-method-access/)。您如何执行该策略取决于平台和流程。

所以在“get”方法被认为没问题的情况下，你仍然必须面对这个问题。不幸的是，我认为这取决于在链条中导航的类。如果该类与结构（例如，工厂）耦合是合适的，那就顺其自然吧。否则，您应该尝试[隐藏委托](http://www.refactoring.com/catalog/hideDelegate.html)。

编辑：[点击这里查看我的帖子](http://moffdub.wordpress.com/2008/10/01/a-hidden-delegation-of-middle-men/)。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-01T23:37:34.257

你真的会独立使用这些功能中的每一个吗？为什么不让任务拥有一个 GetDocumentsFolder() 方法来为您完成调用所有这些方法的所有脏活？然后，您可以让它完成所有对所有内容进行空值检查的肮脏工作，而无需在不需要修饰的地方修饰您的代码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T20:43:51.040

**The biggest flag in the world.**

You cannot check easily if any of those invokations returns a null object thus making tracking any sort of error next to impossible!

getClientFile() may return null and then getClient() will fail and when you are catching this, assuming you are try-catching you won't have a clue as to which one failed.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T20:44:34.720

How likely is it to get nulls or invalid results? That code is dependent on the successful return of many functions and it could be harder to sort out errors like null pointer exception.

It's also bad for the debugger: less informative since you have to run the functions rather than just watching a few local variables, and awkward to step into the later functions in the chain.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-01T20:44:35.343

Yes. It's not best practice. For one thing, if there's a bug, it's harder to find it. For example, your exception handler might display a stack trace that shows that you have a NullReferenceException on line 121, but which of these methods is returning null? You'd have to dig into the code to find out.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-01T20:45:31.597

This is a subjective question but I don't think there's anything wrong with it up to a point. For instance if the chain extends beyond the readable aread of the editor then you should introduce some locals. For instance, on my browser I can't see the last 3 calls so I have no idea what you're doing :).

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-01T20:45:47.400

Well it depends. You shouldn't have to reach through an object like that. If you control the implementations of those methods, I'd recommend refactoring so that you don't have to do that.

Otherwise, I see no harm in doing what you're doing. It's certainly better than

```
ActionPlan AP = task.getActionPlan();
ClientFile CF = AP.getClientFile();
Client C = CF.getClient();
DocFolder DF = C.getDocumentsFolder(); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-01T20:46:56.493

这样还不错，但是您可能会在 6 个月内阅读此内容时遇到问题。或者同事可能会在维护/编写代码时遇到问题，因为您的对象链非常……长。

而且我认为您不必在代码中引入变量。所以对象确实知道从一个方法跳转到另一个方法所需的一切。（这里出现了一个问题，如果你没有过度设计一点点，但我该告诉谁？）

我将介绍一种“便利方法”。想象一下，您的“任务”中有一个方法 - 对象类似于

```
 task.getClientFromActionPlan(); 
```

那么你肯定可以使用

```
 task.getClientFromActionPlan().getDocumentsFolder(); 
```

更具可读性，如果您正确执行这些“便利方法”（即对于重度使用的对象链），则键入的更少;-)。

Edith 说：我建议的这些便捷方法在我编写它们时通常确实包含 Nullpointer-checking。这样，您甚至可以在其中抛出带有良好错误消息的 Nullpointers（即“尝试从中检索客户端时 ActionPlan 为空”）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-01T20:49:10.980

相关讨论：

[函数链 - 多少算太多？](https://stackoverflow.com/questions/154864/function-chaining-how-many-is-too-many)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-01T20:51:55.217

这个问题非常接近[https://stackoverflow.com/questions/154864/function-chaining-how-many-is-too-many#155407](https://stackoverflow.com/questions/154864/function-chaining-how-many-is-too-many#155407)

总的来说，似乎人们同意太长的链不好，你应该最多坚持一两个链式调用。

虽然我听说 Python 爱好者认为链接很有趣。这可能只是一个谣言......:-)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-10-01T20:57:12.617

根据您的最终目标，您可能希望使用 The Principal of Least Knowledge 来避免严重的耦合并最终使您付出代价。正如 head first 喜欢说的那样.. “只和你的朋友说话。”

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-10-01T21:01:27.597

链接的另一个重要副产品是性能。

在大多数情况下，这没什么大不了的，但尤其是在循环中，您可以通过减少间接性看到性能的合理提升。

链接也使估计性能变得更加困难，您无法判断哪些方法可能会或可能不会做一些复杂的事情。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-02T12:36:26.430

好的，正如其他人指出的那样，代码不是很好，因为您将代码锁定到特定的层次结构。它可能会出现调试问题，而且阅读起来并不好，但主要的一点是执行任务的代码对遍历获取某些文件夹的内容了解太多。美元到甜甜圈，有人会想在中间插入一些东西。（所有任务都在任务列表中，等等）

冒险出去，所有这些类都只是同一事物的特殊名称吗？即它们是分层的，但每个级别可能有一些额外的属性？

所以，从不同的角度，我将简化为一个枚举和一个接口，如果子类不是被请求的东西，它们会在链上进行委托。为了争论，我称它们为文件夹。

```
enum FolderType { ActionPlan, ClientFile, Client, etc }

interface IFolder
{
    IFolder FindTypeViaParent( FolderType folderType )
} 
```

并且每个实现 IFolder 的类可能只是

```
IFolder FindTypeViaParent( FolderType folderType )
{
    if( myFolderType == folderType )
        return this;

    if( parent == null )
        return null;

    IFolder parentIFolder = (IFolder)parent;
    return parentIFolder.FindTypeViaParent(folderType)
} 
```

一种变体是制作 IFolder 接口：

```
interface IFolder
{
    FolderType FolderType { get; }
    IFolder Parent { get; }
} 
```

这允许您将遍历代码外部化。然而，这将控制权从类（可能它们有多个父类）并公开实现。好和坏。

[*杂谈*]

乍一看，这似乎是一个非常昂贵的层次结构。我每次都需要自上而下实例化吗？即，如果某事只需要一项任务，您是否必须自下而上实例化所有内容以确保所有这些后向指针工作？即使它是延迟加载，我是否需要爬上层次结构才能获得根？

再说一遍，层次结构真的是对象身份的一部分吗？如果不是，也许您可​​以将层次结构外部化为 n 叉树。

作为旁注，您可能需要考虑聚合的 DDD（域驱动设计）概念并确定主要参与者是谁。负责的最终所有者对象是什么？例如汽车的轮子。在为汽车建模的设计中，车轮也是物体，但它们归汽车所有。

也许它对你有用，也许它不。就像我说的，这只是在黑暗中的一个镜头。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-01T23:27:10.353

我也会指出得墨忒耳法则。

并添加一篇关于[告诉，不要问的文章](http://www.pragmaticprogrammer.com/articles/tell-dont-ask)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-03-07T11:11:41.800

另一方面，得[墨忒耳法则不是普遍适用](https://stackoverflow.com/questions/67561/do-fluent-interfaces-violate-the-law-of-demeter)的，也不是硬性规则（arrr，[它更像是一个指导方针](http://www.logan.ws/quotes/pirates-of-the-caribbean.asp)！）。

# documentation - 如何说服人们评论他们的代码

> ID：159597
> 
> 赞同：38
> 
> 时间：2008-10-01T20:41:10.797
> 
> 标签：documentation, comments

有什么好的论据可以说服其他人评论他们的代码？

我注意到许多程序员更喜欢在没有注释的情况下编写代码的感知速度，而不是为自己和他人留下一些文档。当我试图说服他们时，我会听到半生不熟的东西，比如“方法/类名应该说明它的作用”等。你会对他们说些什么来改变他们的想法？

如果您反对评论，请留下评论。对于试图说服人们评论代码的人来说，这应该是一种资源，而不是其他方式。:-)

其他相关问题是：[评论代码](https://stackoverflow.com/questions/36432/commenting-code)，[您是否评论您的代码](https://stackoverflow.com/questions/20922/do-you-comment-your-code)以及[您希望您的评论如何](https://stackoverflow.com/questions/121945/how-do-you-like-your-comments-best-practices)。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-10-01T20:45:53.673

只评论“为什么”而不是“什么”。到目前为止，我同意，应该从类或方法或变量名称中清楚它的作用和用途。重构它没有而不是评论它。

如果你采用这种方法，你会得到评论，你会得到有用的评论。程序员喜欢解释他们为什么要做某事。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-10-01T20:43:21.667

向他们展示他们自己 6 个月前的代码。如果他们无法在 2 到 4 分钟内准确理解和概述它的作用，那么您的观点可能已经提出。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2008-10-01T20:51:10.553

我的意见：

我不会。方法/类名应该说明它的作用。如果没有，要么方法或类试图做太多事情，要么命名不当。

我喜欢评论为什么，而不是什么。如果不清楚为什么代码使用一种方法而不是另一种方法，请评论它。如果您必须添加一个 hack 未使用的变量来解决编译器错误，请评论原因。但是像“//连接到数据库”这样的注释是错误代码或错误策略的标志。名为 ConnectToDatabase() 的方法要好得多。如果它有“//Determine DB server IP”，也许应该把它拉到一个名为“DetermineDbServerIPAddress()”的方法中。

设计可以记录在案，但是对于该级别的文档来说，注释通常是一个糟糕的地方。有了设计知识，以及一些关于为什么、什么和如何应该是显而易见的评论。如果不是，与其说服他们评论他们的代码，不如让他们改进它。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-10-01T20:43:16.627

也许这只是必须从经验中学习的东西；具体来说，六个月后回到你自己的代码，并试图弄清楚你在写代码时到底在想什么（或者你在做什么）的经历。这当然让我相信评论并不是一个坏主意。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-10-01T20:43:22.413

给他们一些（至少约 500 行）可怕的、未注释的意大利面条代码来重构。确保变量没有逻辑命名。空格可选。

**看看*他们*有多喜欢它！**

过于苛刻，但它一口气得到两分。

1.  写好你的代码。
2.  评论它，以便您***和其他人***知道它的含义。

我应该强调，这段代码不应该来自他们。注释*对于*理解你自己的代码非常有用，几个月后，它们对于理解*其他人*代码的复杂部分也非常重要。他们需要了解其他人可能必须了解他们在做什么。

最后一个编辑：评论*质量*也很重要。一些开发人员在他们的工作中拥有几乎 2:1 的代码与评论比率，但这并不能使他们成为好的评论。你的代码中可以有非常少的注释，但它仍然很有意义。

1.  解释*你在做什么*。不过，您的代码质量*应该*为您完成大部分工作。
2.  更重要的是，解释*你为什么要做某事*！我已经看到了很多代码，它们准确地说明了某事正在做什么，却不知道为什么开发人员（不幸的是，大多数时候是我）首先认为这是一个好主意。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-10-01T20:48:17.207

提醒他们阅读代码只能告诉他们代码*做*了什么，而不是它*应*该做什么。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-10-01T21:19:37.133

如果您或其他开发人员尚未阅读 Code Complete（或[Code Complete 2](http://www.cc2e.com/)），请停止您正在做的事情并阅读它。

突出的一件事是“一个函数应该只做一件事并且做得很好”。当这样一个函数以它做得好的一件事命名时，还有什么需要评论的？

注释有与他们应该描述的代码不同步的习惯。结果可能比没有原始评论更糟糕。不仅如此，开发人员还*知道*评论可能会老化并且不可信。因此，他们将阅读代码并自己辨别它实际上在做什么！这有点抵消了将评论放在首位的意义。

话虽如此，函数名称也是如此，它可能最初命名得很好，但名称中未提及的超时新操作已添加到其中。

所有评论似乎都将开发人员希望更靠近的代码行分开，以便他们可以在每个屏幕上看到更多内容。我知道我自己对一段代码的反应，其中有很多我必须理解的注释。删除所有评论。现在我可以看到代码是什么。

归根结底，如果你要花时间*把事情做好，*你的时间最好花在重构代码上，以确保它尽可能合理地自我描述，而不是仅仅写评论。这样的练习以其他方式获得了回报，例如识别常见的代码块。

值得牢记的是，许多优秀的开发人员更喜欢编写清晰干净的 C#、Java，而不是那些具有所有假设和歧义的不太精确的人类语言。确实，大多数有常识的人都会知道多少细节才是足够的细节，但优秀的开发人员并不是“大多数人”。这就是为什么我们最终会得到这样的评论`\\adds a to b and store it in c`（好吧，这太极端了，但你明白了）。

要求他们做他们讨厌做的事情，坦率地说，他们不太擅长（即使你确信这是正确的做法）只是一场已经失败的战斗。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-01T20:44:35.127

我会说“昨天我不得不阅读你的一些代码。我能够理解它，但少于或等于 5 行精心挑选的解释它如何实现其目标的评论将使我能够阅读它大约一-第十次，然后我可能会担心理解一个问题。我不傻，你也不聪明，因为你可以写一些难以理解的东西。相反，如果你不会产生可读的文档+代码集合，那么您就不是开发人员了。”

我很早以前就被灌输过：如果你写了一些东西，而一个有合理能力的人看不懂，那是你的错，而不是他或她的错。这适用于自然语言的写作，也适用于编程语言的写作。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-10-01T20:49:21.247

我不是在对你刻薄，但你应该将问题改写为*如何说服其他开发人员作为一个团队工作？*

说真的，有些人认为你可以读懂他们的想法。

如果您是敏捷团队的一员，代码是集体所有的，因此当您看到未注释、笨拙或难以阅读的代码时，请继续更改（重构）它，以便您理解它。如果人们抱怨，请告诉他们原因并坦诚相告。你发现它难以理解，并且没有人拥有代码。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-10-01T21:20:29.300

我们的策略是进行系统的代码审查，并拒绝没有正确记录的代码（通过注释、正确的函数命名和组织等......）。如果审阅者不清楚，你就回到工作台，期间。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-10-01T20:48:15.243

关于评论也有类似的讨论。以下是人们在评论代码时遵循的规则：[关于评论代码，您的“硬性规则”是什么？](https://stackoverflow.com/questions/142830/what-are-your-hard-rules-about-commenting-your-code#142869). 一些答案也有很好的理由说明你想要评论你的代码。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-10-01T20:49:14.817

说服一个人的最好方法是让他们自己意识到这一点。让他们调试注释良好的代码。它将向他们展示好的评论是什么样的——除非他们真正传达了相关的信息（通常是“为什么”，因为代码描述了“什么”），否则评论是没有用的。他们会注意到它是多么容易。然后让他们回到他们的一些旧代码。他们会注意到这有多难。您不仅向他们展示了不该做什么，还向他们展示了该做什么（这更重要）。你不必再做任何事情了。更重要的是，您不必尝试口头说服他们。他们只需要了解以自己的方式注释代码的必要性。这当然是假设需要注释的代码不是自我解释的。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-10-02T00:02:14.853

在您对评论的渴望中表现出智慧，他们将更有可能倾听。

少即是多。

强调质量而不是数量。

在我的团队中，有人推动评论某些 API 中的所有内容。一些开发人员开始使用一种工具，该工具可以通过查看方法名称和签名来自动生成注释。

例如：

```
/// <summary>
/// Gets the Person.
/// </summary>
/// <returns>
/// A Person
/// </returns>
public Person GetPerson()
{

} 
```

你能想出更大的屏幕空间浪费吗？你能想到比阅读没有提供新信息的评论更浪费大脑周期吗？

如果从方法签名上看出来了，就不要说了！如果我能在几秒钟内弄清楚，请不要将其放在评论中。正如其他人所说，告诉我你*为什么*选择这样做，而不是你做*了什么*。编写您的代码，以便它的作用一目了然。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-10-01T20:48:43.633

以身作则。当开发人员看到正确的事情时，他们很容易动摇，所以看到实际的实践可能会鼓励他们做同样的事情。此外，您可以鼓励您的团队采用解决代码可维护性和注释的代码指标。例如，代码分析将为没有摘要文档的方法产生错误。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-10-01T20:53:27.757

我目前工作地点的当前编码标准是注释每个函数。像这样的空白规则是有害的，永远不应该存在。在某些情况下（其中一些很常见）添加注释会降低可读性。

```
class User {
    getUserName() { /* code here */ }
} 
```

在上面的代码中添加函数头有什么意义？你还要说什么 besdies“获取用户名”。并非所有代码都需要注释。我的经验法则是：如果您没有添加函数签名没有的任何有用信息，请跳过注释。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2008-10-01T21:08:34.240

评论应该是彻底的，在意图的层面上写的（为什么不怎么写），而且很少见。

在编写代码时，我理所当然地倾向于合理地大量评论。然后，我回过头来尝试删除尽可能多的注释，而不会降低代码的可理解性。> 80% 的时间这就像提取一个命名良好的方法一样容易，这通常会导致注释只是复制代码本身中的信息。除此之外，如果有一段代码“需要”注释，我会寻找简化它或使其更清晰的方法。

代码应该是自我记录的，使用[正确的技术](https://rads.stackoverflow.com/amzn/click/com/0201485672)，你可以很容易地完成 95% 的工作。一般来说，如果我签入的代码上还有任何注释，我认为这是失败的。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-10-01T22:35:08.543

就看你有多大的力量了...

我发现一个非常有效的方法是让它成为基于同行的代码审查的固定部分——评论点。如果有评论说代码被错误地注释了，我会让开发人员对它进行满意的评论，这基本上意味着他们必须描述足够多的代码，以便我通过打印和阅读来理解它。我也会这样做。

值得注意的是，这在开发人员中很受欢迎，尽管这听起来像是狄更斯式的。发生了两件事。首先，人们开始评论他们的代码。其次，糟糕的注释代码成为开发人员不太理解他们所写内容的标志（否则他们会描述它）。

唯一真正的缺点是，在修改代码以进行错误修复等时，注释必须与代码保持同步。这在真正的开发商店中几乎不可能强制执行，但是一旦根深蒂固了足够的良好实践，它就会自然而然地发生.

顺便说一句，我更喜欢代码本身中的注释，而不是陀思妥耶夫斯基小说作为文档字符串。前者对后来的程序员很有帮助。后者只是一长段过时的文本，填满了文档并误导了所有人。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-10-01T20:49:51.650

让他们使用不熟悉的 API，但在未连接 Internet 的机器上进行编程（如果你现在可以找到他们的话），这样他们就无法访问 API 文档。如果他们试图使用非文档人员的代码，这实际上是他们强迫其他开发人员做的事情！

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-10-01T20:53:03.687

您还必须在这里区分两个不同的评论：

*   **API 注释**（javadoc 或其他类似类型的文档）：您可以要求他们***[在限制场景中使用自己的代码](https://stackoverflow.com/questions/61604/api-documentation-and-value-limits-do-they-match)***（边界条件，如空对象或空字符串或......），看看他们是否真的能记住什么在这种情况下他们自己的功能
    （这就是为什么我要一个*完整的 javadoc 包括 limit-value*）

*   **内部评论**（在源代码中）：您可以要求他们解释他们编写的任何函数，只需选择一个具有***非常[高的圈复杂度级别](https://stackoverflow.com/questions/20702/whats-youra-good-limit-for-cyclomatic-complexity)***的函数，然后看看他们在所有不同的代码工作流和决策分支中挣扎；）

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-10-01T20:47:34.213

好吧，总是有“如果你不评论你的代码，我们会找到其他人来评论他们的”的方法。

更温和地告诉他们，如果他们不记录和评论他们正在做的事情，他们会让团队非常失望。代码不属于个人，除非他们是彻头彻尾的孤狼。它属于团队、群体，无论是公司还是社区。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-10-01T20:48:14.697

“编写代码”=“用特殊语言编写命令序列”+“编写注释”

**写代码的时候注释一下**是不言而喻的！你有没有评论过已经 3 或 4 个月大的代码？（当然你有，除了有趣之外，一切都是如此！）

如果您的项目已经有很好的文档记录，那么添加新代码的程序员可能会被激励以类似的方式编写注释。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-10-01T20:56:39.527

@James Curran 我 100% 同意！我可以阅读您的代码并弄清楚您告诉编译器做什么；但这并不意味着让编译器这样做是您的意图。我知道我不是一个足够自大的程序员，不会相信每次我编写代码时它都会完全按照我的意图去做。此外，我经常发现它可以帮助我在我的代码中发现愚蠢的逻辑错误，方法是在我编写完代码并尝试解释我打算让代码做什么。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-10-01T21:03:39.307

一个想法是指出，每节课写一两句话不到一分钟，每个方法写一个句子不到半分钟。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-10-01T21:04:06.017

告诉他们用 Javadoc 注释记录他们的函数和接口，然后通过 Doxygen 运行代码，为他们的代码生成看起来很酷的 HTML 文档。有时，冷静因素可能是一个很好的动力。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2008-10-01T22:18:07.273

我使用一种微妙的技术：

我将项目中的警告级别设置为报告为错误。我们的持续集成服务器正在构建整个解决方案以及每次签入时的 XML 文档。

如果开发人员不写评论，构建失败！在那之后，他们必须写评论，所以过了一段时间，他们就习惯了。

它在压力方面并不激进，但我发现这是纠正他们行为的好方法。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-10-02T01:57:19.337

如果开发人员必须参与代码审查并接触到良好的评论，他们应该能够获得线索。如果他们不认为这种做法有用，那么他们应该从同行评审员那里获得一些反馈。

如果做不到这一点（假设您是主管/经理），则将其作为绩效评估的一部分。如果你能衡量它，你可以根据它来评估。

确保它是您评分的评论评论，因为被动攻击性开发人员会将每一个最后的陈述记录为不那么微妙的 FU。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2008-11-03T02:19:34.403

我已经成为我所谓*的 Headrick 规则*的坚定信徒，该规则以我的一位同事的名字命名，他发现激励某人做某事的好方法是让他们*不做*这件事感到痛苦。

在你的情况下，要求你的非评论开发人员花一两个小时来解释他们的代码，也许是对“慢”的观众，也许在他们的午餐时间“避免项目滑点”会有很长的路要走。聪明的人——即使是顽固的人——学得很快！

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2010-05-26T11:06:46.287

在我看来（我在这里谈论的是 .Net 编程）如果您必须发表评论，那么您无法使代码可读。答案通常是重构！

但是，如果您觉得必须添加注释，那么它应该始终是“为什么”类型的注释，而不是解释代码功能的注释。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-10-01T21:08:50.857

在实际编码之前写下一个方法/类将做什么，这对正确处理它有很大帮助——而且你已经评论过它。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2008-10-01T21:29:36.640

只雇用优秀的工程师，确保他们的代码隐含地说明意图（使用注释和其他方式）。任何想要工作的人都必须做正确的事。苛刻，但公平，恕我直言。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2008-10-01T21:34:55.677

我也属于评论越少越好的阵营，为了让它发挥作用，它需要清晰简洁的代码。所以这就是我要从他们开始的地方。告诉他们他们不必评论，只要他们写出更好、更清晰、自我评论的代码。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2008-10-01T22:09:02.130

仅在绝对需要时才添加注释，当不清楚为什么代码在做它正在做的事情时。

例如，如果您在十几行代码之上有注释，那么只需使用该方法的好名称重构为一个方法，或者只是在该方法上方添加注释

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2008-10-02T01:42:18.263

几乎是一个反问。真正优秀的程序员实际上不需要太多评论。不幸的是，这些东西很少。因此，您是在告诉人们，如果没有注释，他们的代码将无法阅读。

程序员几乎没有足够的时间来完成漂亮的工作。似乎我们总是急于得到一些东西进行单元测试，看看它是否会开始吐出结果。所以我最终的答案是找到一个工作场所，它的氛围能让普通程序员有时间关注质量。我，我向谷歌申请了两次，两次被拒绝。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2008-11-03T01:46:24.470

在十年的开发中，我从未见过真正告诉我有关代码的有用信息的评论。评论通常是过时的或陈述显而易见的。一旦您编写它们，就需要维护它们。我认为唯一合理的评论是正则表达式或汇编代码。

如果您需要评论，您可能需要将想要评论的内容提取到单独的方法或类中。记录代码的另一种方法是编写测试。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2008-12-24T14:32:19.560

虽然评论可以很好地用于提供对代码的洞察力，但我认为鼓励程序员编写描述性代码比留下评论更有价值。编写具有清晰名称和签名的较小方法最终将比冗长的评论解释本可以更好地编写的代码最终为您提供更好的服务。

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2008-12-24T14:39:11.650

一个可悲的事实是，绝大多数程序员不会正确地注释他们的代码，直到他们最终陷入糟糕的文档的另一端。被困在维护一个缺乏清晰评论的应用程序是很糟糕的。通常紧随其后（IME），代码流中的注释。

是的，这发生在我身上，我现在彻底评论。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2009-01-08T12:15:45.057

我还认为向开发人员展示好的评论有多重要的最好方法是向他展示他自己过去的代码。

也向他们展示像 SandCastle 这样的东西的优势。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2009-11-23T20:34:05.280

“blabla评论为什么不是什么blabla”

每个关于注释代码的问题的简单答案......我的问题是每个人都在谈论“为什么”和“什么”，就像他们每次对每个人来说都是一样的。

显然不是这样。当我发现新事物（API、框架、新项目、工具……）时，会有很多我不理解的东西，或者我什至不知道它的存在。但一段时间后，很多事情变得更有意义。我没有迷失在代码丛林中去理解类的用途。

起初，“为什么”和“什么”是同一个东西，这个东西可以概括为“？”。经过一段时间的学习和理解，“什么”变得越来越容易掌握，最终变得如此明显，以至于我什至忘记了它的存在。随着“是什么”变得“更清晰”，我的脑海里就有更多的资源去问自己“为什么”，我对整个架构的理解也越来越完整。

如果我在学习开始时在代码中添加评论，即使我试图评论“为什么”，我也会评论更有经验的人已经认为显而易见的内容（他们会称之为“什么”并说出评论没用）。跨越较大的学习曲线波之后写的评论将在数量上减少，并且描述被评论事物的一个非常具体的特征（只有达到这种理解水平的人才能理解）。

最后一点是：我从来没有浪费时间阅读评论，而且他们经常减少我的学习时间。我从未见过“评论过多”的代码。我经常阅读对我无用的评论（就像每个人一样），但我从未想过“如果我一直花时间阅读评论做一些更有用的事情！”。鉴于所有现代 IDE 都提供了能够隐藏大评论的 ui，我不明白为什么写一个无用的评论会被认为是不好的。

从更主观的角度来看，我更喜欢在一页代码中看到一些无用的绿色单词，而不是在空白背景上缩进的几个单词。

我更喜欢在代码的明显部分添加无用的注释，而不是在 15 页长的黑暗方法中没有任何注释......

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2011-02-02T18:15:14.440

不知道为什么所有其他答案都在谈论“说服”程序员写评论。对于动物和儿童，我们使用正强化，但对于成年人，我们使用逻辑，好像它有效（它不起作用）。

每次他们写评论时给他们一个cookie——例如，一个真正的cookie，或者一个“很棒的人”——看看它是如何工作的。如果必须，总是会因为不写评论而受到惩罚。当然，你不必成为老板来惩罚：公开嘲笑、蔑视和普遍排斥是足够强大的技术。

# c# - 无法使用 FileIOPermission 复制具有适当权限的文件

> ID：159598
> 
> 赞同：2
> 
> 时间：2008-10-01T20:41:20.610
> 
> 标签：c#, file, permissions, copy

如果我尝试在用户目录中写入，则此代码段效果很好，但是一旦我尝试在 Program Files 中写入，它就会静默执行并且文件没有被复制（没有例外）。如果我尝试将文件复制到 C:\ 或 C:\Windows 中，我会捕获 UnauthorizedAccessException。

您是否知道另一种获得在该目录中写入权限或使其以其他方式工作的方法？

非常感谢任何帮助！谢谢

```
using(FileStream fs=File.Open(source, FileMode.Open)){ }  
try  
{  
    FileIOPermission fp = new FileIOPermission(FileIOPermissionAccess.Write,   
                          AccessControlActions.Change, "C:\\Program Files\\MyPath");  
    fp.Demand();  //<-- no exception but file is not copied
    File.Copy("C:\\Users\\teebot\\Documents\\File.xml","C:\\Program Files\\MyPath\\File.xml",true);  
}  
catch(SecurityExceptions)  
{  
    throw(s);  
} 
catch(UnauthorizedAccessException unauthroizedException)
{
    throw unauthroizedException;
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T20:43:27.017

**不要写在 Program Files 文件夹中。**

这是一个很大的禁忌，尤其是当您的代码在 Vista 中运行或在用户仅获得标准安全性而非管理员权限的公司的机器上运行的那一天时，尤其会引起问题。请改用 Application Data 文件夹。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T20:49:16.237

你在 Vista 上运行吗？如果是这样，那么您可能会遇到文件系统虚拟化。这是 32 位版本的 Vista 中的一项功能，它允许普通用户写入文件系统的受保护部分。这是为了减轻 Vista 的 LUA 功能带来的痛苦而引入的 shim。

简短的版本是操作系统将为某些受保护的根（例如程序文件）创建一个虚拟文件系统。当非管理员尝试对其进行写入时，将创建一个经过编辑的副本而不是原始副本。当您的用户帐户尝试查看文件时，它会看到 edit.s 其他用户帐户只会看到原始文件。

更长的版本：[http ://thelazyadmin.com/blogs/thelazyadmin/archive/2007/04/26/file-system-virtualization.aspx](http://thelazyadmin.com/blogs/thelazyadmin/archive/2007/04/26/file-system-virtualization.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T20:53:23.873

如果您在 Vista 下运行，那么系统只会将写入重定向到程序文件夹，这样做是为了在用户不是管理员（或启用 UAC）时将其配置保留在程序目录中的旧程序将继续工作。

您所要做的就是向您的程序添加一个清单，指定所需的访问级别，然后系统假定您的程序支持 Vista 并关闭所有这些兼容性补丁。

您可以在我的博客上看到清单文件的示例：

[http://www.nbdtech.com/blog/archive/2008/06/16/The-Application-Manifest-Needed-for-XP-and-Vista-Style-File.aspx](http://www.nbdtech.com/blog/archive/2008/06/16/The-Application-Manifest-Needed-for-XP-and-Vista-Style-File.aspx)

（这篇文章的重点是获得正确版本的通用控件，但也有 Vista 安全声明）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T20:46:43.390

代码访问安全授予或拒绝对您的*代码*的权限。它不能用于覆盖授予/拒绝当前用户的权限。

# .net - 如何在构建时自动更新 Web 参考？

> ID：159599
> 
> 赞同：18
> 
> 时间：2008-10-01T20:42:17.860
> 
> 标签：.net, web-services

我有一个 .net 项目，其中包含对服务的 Web 引用。作为每个构建的一部分，我想更新该网络参考。那可能吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-01T21:06:19.753

您可以将 MSBuild 脚本与调用[wsdl.exe的任务一起使用](http://msdn.microsoft.com/en-us/library/7h3ystb6(VS.80).aspx)

```
 <Target Name="UpdateWebReference">
    <Message Text="Updating Web Reference..."/>
    <Exec Command="wsdl.exe /o &quot;$(OutDir)&quot; /n &quot;$(WebServiceNamespace)&quot; &quot$(PathToWebServiceURL)&quot;"/>
  </Target> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T20:45:27.900

此外，当您在生产环境中部署 Web 服务时，请确保将它们设置为动态而非静态。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T12:03:39.847

您可以使用其他回答者提供的方法来执行此操作，但您必须知道这样做可能会导致您的构建失败。如果 WSDL 已更改，生成的代码也将更改，您的代码可能不再编译。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T20:46:27.773

您可以使用 svcutil ( [http://msdn.microsoft.com/en-us/library/aa347733.aspx](http://msdn.microsoft.com/en-us/library/aa347733.aspx) ) 工具为您生成 Web 参考。该工具将生成正确的客户端代理类和正确的配置（它甚至可以将其合并到您的应用程序配置中）。请记住，该工具需要 .Net 3.0 并将生成 WCF 样式的客户端代理和配置。

# html - 通过 http 上传多个文件的最佳客户端浏览器库是什么？

> ID：159600
> 
> 赞同：14
> 
> 时间：2008-10-01T20:42:25.693
> 
> 标签：html, file-upload, uploading, multifile-uploader

上传多个文件的最佳客户端 http 库是什么？如果它可以处理目录，那将是一个巨大的好处。我正在寻找开源或免费的东西。我正在寻找类似 FTP 的东西，但它可以通过浏览器在 http 上运行。当上传超过 5-6 个文件时，通过普通的 HTML 4.x 表单上传多个文件有点麻烦。

随意分享您的个人经历。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-12-23T14:05:04.050

[Uploadify](http://www.uploadify.com/)也是另一个出色的多文件上传器。它是基于 SWFUpload 构建的，并且他们为其添加了新功能。

我发现最有用的一些功能是：

> 用户可以使用 ctrl + 单击所有文件一次上传所有文件
> 
> 在下载文件时，会显示一个队列，其中显示正在下载的文件，包括一个完成栏。
> 
> 文件完成后，它们将从队列中删除
> 
> 它还允许您指定用户可以下载的文件类型（他们只能看到您选择的文件类型）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-01T20:45:34.127

我会为此推荐类似[SWFUpload](http://www.swfupload.org/)的东西。它的主要特点是它对进度条的支持，但它也允许排队文件，这特别方便（这实际上是我今天第二次推荐它）。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-02T01:11:13.317

只是为了确保记录其他选项（SWFUpload 很棒） - 另一个好的解决方案是[FancyUpload2](http://digitarald.de/project/fancyupload/)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-12-30T10:04:21.393

您可以使用基于 Java 的解决方案。我一直在我的一个网页上使用[JumpLoader](http://jumploader.com/)，并且没有遇到任何问题。它还可以**上传目录**，这里提到的其他解决方案不支持。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-01T22:09:57.590

我之前使用的另一个选项是上传然后解压缩 ZIP 文件。我使用[PEAR::Archive_Zip](http://pear.php.net/package/Archive_Zip)来提取。需要更多用户方面的知识，但支持目录和无限文件（取决于分配给 PHP 的内存）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-06-30T20:27:35.290

看看[jquery-html5-upload](http://code.google.com/p/jquery-html5-upload/)它不需要 Flash，并且有一个性感的 jQuery API。

# db2 - DB2 CLI 结果输出

> ID：159615
> 
> 赞同：5
> 
> 时间：2008-10-01T20:44:43.143
> 
> 标签：db2

在 MySQL 中运行命令行查询时，您可以选择使用“ **\G** ”作为语句终止符，而不是在屏幕上水平列出结果集列，而是垂直列出每一列，对应的数据在右侧。有没有办法使用 DB2 命令行实用程序实现相同或相似的事情？

常规 MySQL 结果示例

```
mysql> select * from tagmap limit 2;
+----+---------+--------+
| id | blog_id | tag_id |
+----+---------+--------+
| 16 |       8 |      1 |
| 17 |       8 |      4 |
+----+---------+--------+ 
```

示例替代 MySQL 结果：

```
mysql> select * from tagmap limit 2\G
*************************** 1\. row ***************************
     id: 16
blog_id: 8
 tag_id: 1
*************************** 2\. row ***************************
     id: 17
blog_id: 8
 tag_id: 4
2 rows in set (0.00 sec) 
```

显然，当列是大字符串时，或者当结果集中有很多列时，这会更有用，但这比我可能解释的更好地展示了格式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T06:55:40.227

我认为 DB2 命令行客户端不提供这样的选项。有关一些建议，请参阅[http://www.dbforums.com/showthread.php?t=708079](http://www.dbforums.com/showthread.php?t=708079)。有关 DB2 命令行客户端的更一般信息集，您可以查看 IBM DeveloperWorks 文章[DB2 的命令行处理器和脚本](http://www.ibm.com/developerworks/db2/library/techarticle/adamache/0109adamache.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2021-11-02T16:52:33.453

有点晚了，但是当我搜索仅检索所选数据的选项时发现了这篇文章。

所以`db2 -x <query>`只返回结果。更多选项可以在这里找到：[https ://www.ibm.com/docs/en/db2/11.1?topic=clp-options](https://www.ibm.com/docs/en/db2/11.1?topic=clp-options)

例子：

```
[db2inst1@a21c-db2 db2]$ db2 -n select postschemaver from files.product

POSTSCHEMAVER                   
--------------------------------
147.3                           

  1 record(s) selected.

[db2inst1@a21c-db2 db2]$ db2 -x select postschemaver from files.product        
147.3 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2014-12-23T10:56:45.133

DB2 命令行实用程序始终以表格格式显示数据。即水平行和垂直列。它不支持任何其他格式，如 mysql 的 \G 语句终止符。但是是的，当设置了 DB2_WORKLOAD=ANALYTICS 时，您可以将按列组织的数据存储在 DB2 表中。

```
db2 => connect to coldb

   Database Connection Information

 Database server        = DB2/LINUXX8664 10.5.5
 SQL authorization ID   = BIMALJHA
 Local database alias   = COLDB

db2 => create table testtable (c1 int, c2 varchar(10)) organize by column
DB20000I  The SQL command completed successfully.
db2 => insert into testtable values (2, 'bimal'),(3, 'kumar')
DB20000I  The SQL command completed successfully.
db2 => select * from testtable

C1          C2        
----------- ----------
          2 bimal     
          3 kumar     

  2 record(s) selected.

db2 => terminate
DB20000I  The TERMINATE command completed successfully. 
```

# translation - 如何实现多元文化 Web 应用程序

> ID：159625
> 
> 赞同：3
> 
> 时间：2008-10-01T20:46:10.973
> 
> 标签：translation, multilingual

我相信我们中的一些人已经从事过一个项目，其中不仅要支持 UI，而且还必须支持不同语言的数据。例如 - 例如，能够为我在这里写的内容提供和存储翻译。

更重要的是，我也相信我们中的一些人有一些时间触发的事件（例如当会员访问到期时），应该考虑用户位置来计算，例如根据正确的时区午夜。

最后，还需要根据某些语言支持从右到左的用户界面，并在读取提交的数据文件时使用不同的编码（例如解析文本和 excel 数据）

目前，我将所有实体的所有翻译都存储在一个表上（不太实用，因为在执行 sql 查询以查找问题时很难找到自己），主要在附属程序集上设置 UI 翻译，并且不支持两者时区也不是从右到左的设计。

在应对这些挑战时，您有哪些经验？

**[编辑]**

我假设大多数人认为这种多元文化要求就像构建一个巨大的项目一样。事实上，如果您在以下位置进行在线调查：

1.  答案将只收集到午夜
2.  问卷定义和部分答案来自文本文件（任何语言）以及翻译
3.  根据访问者的不同，问题和响应选项必须以多种语言显示
4.  报告还必须以几种不同的语言显示和生成

可以看出，我们不必在应用程序中走得太远就可以满足这种要求。

[编辑2]

刚刚发现我的问题是重复的

[i18n 在您的项目中](https://stackoverflow.com/questions/898/internationalization-in-your-projects#1462)

第一个答案（通过投票订购时）是如此全面，我必须在某一天至少​​实现其中的一部分。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-02T03:28:46.917

非常非常谨慎。从你所说的关于你试图实现的 i18n 功能的内容来看，我想知道你是否太过分了。

请注意，大男孩（例如 eBay、amazon.com、yahoo、bbc）Web 应用程序实际上以他们想要支持的每种语言提供单独的应用程序。这些 Web 应用程序中的每一个都使用一组通用的核心服务。如果两个甚至说相同语言的不同国家（例如英国和美国）的业务需求差异很大，以至于您确实需要为每个国家提供单独的应用程序，请不要感到惊讶。

另一方面，您可能需要成为下一个 amazon.com。用一种语言交付成功的 Web 应用程序很困难，更不用说多种语言了。如果这对您的网络应用程序的业务需求有意义，那么您不应该害怕偏爱一个用户群（例如，您的亚洲语言使用者）而不是其他用户群。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T20:50:32.413

慢慢来。

把所有事情都想清楚，然后再认真想想你在做什么。请记住，您添加的越多（例如从右到左），您的 QA 周期就越长。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T21:13:57.333

您的难题的主要部分将是在代码方面广泛使用接口，或者通过翻译器将一个数据源传递到需要支持的任何语言，或者为每种语言提供单独的数据源。

时间问题可以由接口处理，因为您可能希望事情以相同的方式运行，但在实现细节上有所不同。在很大程度上，在调整界面以支持不同的语言时，可以将类似的思维过程应用于界面的创建。当你深入了解它时，皮肤就是这样，被皮肤的内容是界面，外观/感觉是实现。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T21:28:11.667

做你的用户需要的。例如，大多数程序员都懂英语，在这个网站上翻译帖子是没有意义的。如果您的许多用户需要翻译，请添加一个带有语言 id 的新表列，并添加另一个列以将已翻译的行链接到其原始行。如果您的目标听觉包含来自中东的用户，请实施从右到左。如果时间精度在一个小时内很关键，则将时区列添加到用户表，依此类推。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T22:06:14.883

如果您使用 *NIX，请使用[gettext](http://www.gnu.org/software/gettext/)。我用过的大多数语言都有一定程度的支持；[例如， PHP](http://php.net/gettext)非常好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-21T17:04:13.950

我将描述我在项目中所做的事情（这不是我的原始架构，但我还是喜欢它）

**提供翻译支持**

需要翻译的文本分为三个不同的类别：

1.  错误文本：像发生在应用业务层深处的错误
2.  UI 文本：显示在用户界面中的文本（标签、按钮、网格标题、菜单）
3.  用户自定义文本：需要根据最终用户的偏好进行翻译的文本（即 - 用户在调查中创建问题，他还可以创建该调查的翻译版本）

对于每个不同的范畴，用于提供翻译服务的模式是不同的——因此我们有：

1.  错误文本：具有访问资源文件的静态函数的库
2.  UI 文本：链接到视图引擎的“Helper”类，提供来自远程程序集的翻译
3.  用户自定义文本：数据库中提供翻译的表（根据翻译实体的 typeID 和对象 id）并通过 1 x N 关系链接到实体

然而，我还没有攻击其他明显的问题，例如处理时区、不同的布局和图片翻译（如果真的有必要的话）。有没有人以不同的方式解决了这个问题？

有没有人解决过其他 i18n 问题？

# visual-studio-2005 - 将 Visual Studio 项目保存在网络驱动器上

> ID：159627
> 
> 赞同：46
> 
> 时间：2008-10-01T20:46:17.680
> 
> 标签：visual-studio-2005, network-drive

我们刚刚从将所有文件本地存储到网络驱动器做了一个转变。问题是我的 VS 项目现在也存储在那里。（目前还没有版本控制系统，正在研究。）我知道我过去听说过这样做的问题，但从未听说过解决方法。有解决办法吗？

所以我的VS安装在本地。这些文件位于网络驱动器上。我怎样才能让它工作？

编辑：我知道应该做什么，但是我现在可以戴上创可贴来解决这个问题并维护网络驱动器吗？

编辑 2：我确定我不理解某些东西，但[Bob King](https://stackoverflow.com/questions/159627/keeping-visual-studio-projects-on-a-network-drive#159702)的想法是正确的。当他回到办公室时，我将与首席 Web 开发人员一起找出临时解决方案，直到我们获得某种版本控制设置。感谢您的想法。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-10-01T20:57:57.467

虽然我们确实使用源代码控制，但我们也确实从网络驱动器（不是共享目录，网络驱动器上的私有目录）运行我们的所有项目。网络驱动器每晚备份一次，并且还使用卷影复制，所以如果您需要在它进入 SC*之前恢复到某些东西，那么您可以。*

要让项目在正确的权限下正确运行，请按照[以下步骤](http://web.archive.org/web/20140514055153/http://msdn.microsoft.com/en-us/library/zdc263t0(VS.80).aspx)操作。

基本上，您只需将共享目录映射到驱动器，然后根据该 URL 授予对所有代码的权限。假设您映射到“N:\”，然后使用“N:\*”作为您的 Url 模式。您需要通配符并不明显，但您确实需要。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2012-04-18T20:00:56.057

这个问题相当笼统，所以我将回答我面临的一个问题。

我在 Mac 上使用 Parallels 虚拟机运行 Visual Studio 2010，同时通过网络共享将所有项目保存在 Mac 端。但是，Visual Studio 不会从那里加载项目程序集文件。尝试单独使用“caspol”设置权限对我没有帮助。

我最终允许 Visual Studio 从网络共享加载程序集的方法是编辑文件“C:\Program Files (x86)\Microsoft Visual Studio 10.0\Common7\IDE\devenv.exe.config”（假设默认安装）。

在 xml "<runtime>" 部分你必须添加

```
<loadFromRemoteSources enabled="true"/> 
```

您可能必须更改该文件的权限以允许写入访问。保存文件。重新启动 Visual Studio。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-06-28T17:20:09.530

为了实际回答这个问题，我从 jcarle.com 复制了这条评论：

使用 Visual Studio 2010 / .NET Framework v4.0 信任网络共享

2011 年 1 月 20 日下午 4:10 如果您像我一样将所有代码存储在服务器上，您可能已经了解了如何使用 CasPol.exe 信任网络共享。但是，当从 Visual Studio 2008 (.NET Framework 2.0/3.0/3.5) 迁移到 Visual Studio 2010 (.NET Framework 4.0) 时，您可能会摸不着头脑。

如果您习惯于使用 Visual Studio 命令提示符快速访问 CasPol，您可能会发现您的某些项目似乎不会尊重您的新 FullTrust 设置。原因是，除非您仔细注意，否则 Visual Studio 命令提示符默认为将 .NET Framework 4.0 文件夹添加到其路径中。如果您的项目仍在 .NET Framework 2.0/3.0/3.5 下运行，则还需要为这些版本设置 CasPol。请注意，我个人在使用 1 作为代码组而不是 1.2 方面也取得了更大的成功。

要信任所有 .NET Framework 版本的网络共享，只需使用以下完整路径为每个版本调用 CasPol：

> C:\Windows\Microsoft.NET\Framework\v2.0.50727\CasPol -m -ag 1 -url file://YourSharePath* FullTrust
> C:\Windows\Microsoft.NET\Framework\v4.0.30319\CasPol -m -ag 1 -url file://YourSharePath* FullTrust

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-01T20:47:40.000

如果您有（或者即使您没有）多个从事项目的人，我不建议您这样做。你只是自找麻烦。

另一方面，如果你是唯一一个工作的人，你将避免很多麻烦。不过，性能将超出预期。至于如何让它工作，你只需从 VS 打开解决方案文件。您可能会遇到安全问题，但可以使用 CASPOL 进行纠正。不过，正如我所说，性能将会很糟糕。同样，完全不推荐。

帮自己和你的团队一个忙，安装 SVN 或其他形式的源代码控制，并尽快将代码放在那里。

编辑：我将部分撤回我的评论。Bob King 在下面解释了他们从网络驱动器运行 VS 项目的原因，这是有道理的。我会说，除非您像 Bob 那样出于特定原因这样做，否则请远离它。否则，在设置这样的开发环境之前，让你的鸭子排成一排。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-02-25T20:51:15.363

我知道这是一个较旧的线程，但这是我在寻求解决类似问题时发现的最好的线程，我在虚拟机上安装了 Visual Studio 2013（使用 Win 8.1）和主机上的代码（Win 7）。虽然我可以打开解决方案，但我无法编译。与此相关的所有其他答案都与旧软件有关，因此我添加了此答案以使用适合我的解决方案更新这个常见问题。

这就是我所做的；制作了一个注册表项，以便能够使用 UNC 路径作为当前目录。

警告：错误地使用注册表编辑器可能会导致严重的系统范围的问题，可能需要您重新安装 Windows NT 才能更正这些问题。Microsoft 不能保证可以解决因使用注册表编辑器而导致的任何问题。使用此工具需要您自担风险。

注册表路径下：HKEY_CURRENT_USER\Software\Microsoft\Command Processor

添加值 DisableUNCCheck REG_DWORD 并将值设置为 0 x 1 (Hex)。

警告：如果启用此功能并启动具有 UNC 名称当前目录的控制台，从该控制台启动应用程序，然后关闭控制台，可能会导致从该控制台启动的应用程序出现问题。

在链接中找到此信息：http: [//support.microsoft.com/kb/156276](http://support.microsoft.com/kb/156276)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-05-24T17:01:45.363

我们把它改写成一个每个人都能回答的问题怎么样？我和最初的海报有完全相同的问题。

我有一份 VB 2008（最近从 VB6 升级）。如果我将我的解决方案存储在备份的网络驱动器上，那么它永远不会运行任何东西。即使在程序集中设置了“allowpartiallytrustedcallers”，它也会在访问模块时给出“部分信任的调用者”错误。如果我将文件存储在我的（未备份的）C: 上，那么它将运行得非常好，直到我把它放在共享驱动器上供所有人使用，我又回到了同样的问题。

这不是一个很大的要求。我只是希望能够将解决方案和可执行文件放在共享驱动器上并运行它，而不需要对安全性进行荒谬的废话。我不应该把我所有的工作都塞进表单文件中。

-编辑：我发现了它为什么忽略 AllowPartiallyTrustedCallers 命令的问题。我正在尝试引用 ADODB，它不允许部分信任。那么，没有网络可执行文件可以访问数据库吗？无论如何，Microsoft 对 Intranet 有什么反对意见？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-01T20:52:47.477

不要这样做。如果您有源代码控制（版本控制），您不希望您的文件在网络驱动器上。它完全绕过了您想要通过使用源代码控制实现的所有目标，因为一旦您的文件位于网络驱动器上，任何人都可以修改它们......即使您当前正在构建项目。咔嚓！

PS：这对我来说听起来像是一个典型的过度工程案例。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-01T20:57:52.550

你有什么具体问题吗？

如果您允许多人打开解决方案，您的第一个问题将是 .NCB 文件 (Intellisense) 将被独占锁定，并且只有一个用户能够浏览类树。当然，您有可能让一个用户的更改覆盖其他用户的更改。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-09-09T22:51:50.413

所以我遇到了类似的问题。Visual Studio 无法识别我为任何驱动器号映射的网络位置。有趣的是，它工作了一天。我建立了我的项目并开始研究它并且没有任何问题。然后，我关闭了，第二天没有任何效果。我无法在代码中读/写文件，无法输出我的可执行文件或任何东西。我的项目是本地的，但我的输出打算在网络上抛出。

无论如何，问题可能与管理员上下文有关，但我在网上挖掘时发现的一种解决方法是让 Visual Studio 以某种方式浏览到有问题的驱动器。有很多方法可以做到这一点，但 VS 将神奇地能够识别映射的驱动器号。我的解决方案是转到项目属性中的调试输出位置，单击浏览并转到我以前在我的网络驱动器上制作的输出位置，瞧！！！

我想提出这个问题，因为我花了半天时间试图弄清楚这一点，并认为它可能会为其他人节省一些时间。非常感谢，祝你好运！！！

埃里克

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-02-28T12:43:48.073

我最近遇到了同样的问题，所以这个答案更多是为了跟踪我自己的知识。无论如何，如果有人觉得它有用，下面是问题和解决方案。

问题：NET 4.0 项目、SVN 存储库、签出文件夹位于本地驱动器上，引用的程序集由构建服务器构建并在网络驱动器上可用。W7 上的 Visual Studio 能够添加引用但无法构建项目。

解决方案：由于 NET 4.0 不再自动为网络程序集提供沙箱，因此您必须通过 machine.config 更新使它们完全受信任。[http://msdn.microsoft.com/en-us/library/dd409252.aspx](http://msdn.microsoft.com/en-us/library/dd409252.aspx)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-04-19T18:14:01.210

我在网络驱动器上打开 Visual Studio 项目时遇到了类似的问题，我通过在本地 C:\ 驱动器上创建指向 UNC 目录的符号链接来修复它

例如

```
mklink /D "C:\Users\Self\Documents" "\\domain.net\users\self\My Documents" 
```

然后您可以使用 C:\Users\Self\Documents\ 路​​径而不是 UNC 路径打开项目

（您必须小心，因为如果您在浏览项目时双击符号链接，Visual Studio 会自动将您重定向到 '\\domain.net..' 路径。我必须复制粘贴 'C: \Users\' 使用驱动器号路径打开它的路径）

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-01T20:52:36.027

如果我理解正确，您的 Visual Studio 项目文件存储在网络驱动器上，您可以从那里运行它们。这就是我所做的，没有任何问题。您需要确保已设置安全策略。您可以使用[Caspol](http://msdn.microsoft.com/en-us/library/cb6t8dtz(VS.80).aspx)来执行此操作，或通过控制面板-管理工具菜单。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-11-24T05:39:29.660

应该警告您，Visual Studio 中的某些功能将拒绝使用网络驱动器。

例如，SQL Express 用户实例的 mdf 文件必须位于本地驱动器中。

再举一个例子，如果你使用 UNC 路径，你必须确保它们足够短。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-03-17T17:30:36.647

我在尝试将 vc11 与在 mac 上运行的并行程序一起使用时发现这很有帮助：http://social.msdn.microsoft.com/Forums/en-US/toolsforwinapps/thread/2ffdcb01-c511-4961-834b-afd5f2fbb8e1 [，](http://social.msdn.microsoft.com/Forums/en-US/toolsforwinapps/thread/2ffdcb01-c511-4961-834b-afd5f2fbb8e1)特别是：

> 1）您可以从本地调试切换到远程调试，并将机器名称设置为'localhost'。这将在您的本地机器上进行远程部署（因此不使用项目的目录）。您无需安装远程调试器工具，也无需启动 msvsmon 即可在 localhost 上工作。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-03-29T14:46:29.023

如果这对其他人有帮助，我必须按照[此处](https://superuser.com/a/69870/45406)列出的步骤将网络共享位置添加到 Windows Intranet 区域。特别是，当我在网络共享上打开一个解决方案时（即使用 VMware Fusion 并从我的 Mac 硬盘上打开一个解决方案），我遇到了 Visual Studio 挂起的问题。在这种情况下，我也遇到了 PostSharp 运行的问题。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-10-01T20:54:42.683

“我怎样才能让它工作？” 你有几个选择：

选择 A： 1\. 将所有文件移回本地硬盘 2\. 在您的机器上实施某种类型的备份软件 3\. 测试上述备份解决方案 4\. 继续编码

选择 B： 1\. 获取免费源代码控制产品之一的副本并实施它。2\. 确保已备份 3\. 测试

选择 C：使用众多可用的在线源代码控制存储库之一。谷歌、SourceForge、CodePlex 等等。

* * *

## 回答 #17

> 赞同：-4
> 
> 时间：2008-10-01T20:54:20.593

好吧，我的问题是你为什么要问这个。将其存储在网络驱动器上时它不起作用吗？我自己没有尝试过，我可以想象的一个问题是从网络驱动器（即来自 bin\Debug 目录，也位于网络驱动器上）运行的 .NET 代码将以沙盒模式运行，除非你弄乱了 CASPOL（或者使用 3.5 SP1，我听说它已经消除了那个障碍）。

如果您有具体问题，请询问。永远不要问“为什么做 X 不起作用？”。

您并不是说您只是一个人还是多个人访问同一个远程驱动器，但我假设您只是每个网络目录的一个人。它是否正确？如果没有，不，没有创可贴。获取版本控制，将文件移回本地磁盘。

# windows - linuXploit_crew 访问了我的网络服务器

> ID：159633
> 
> 赞同：4
> 
> 时间：2008-10-01T20:46:51.640
> 
> 标签：windows, iis, nt

我们运行一个旧的 Windows NT 机器，运行 IIS4.0 的完全修补程序。

今天我们被“linuXploit_crew”袭击了，他们把我们的网站关闭了一两分钟。（幸运的是，我们很快就注意到了网站上的变化，并在攻击后的几分钟内修复了它）。

然而——修复网站后，我只好想弄清楚***这***是怎么发生的。

查看我们的 FTP 日志，我们的 default.asp 文件没有任何变化，我发现 Web 日志没有任何异常。关于如何确定他们如何进入的任何想法？我们在 Cisco 防火墙上只打开了 3 个端口，FTP、HTTP 和 HTTPS (21,80,443)。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T20:49:18.563

NT/IIS4 不再获得安全更新。任何*新的*漏洞都不会**打补丁**。是时候升级了。

一旦您“拥有”足以更改您的站点，您就不一定再信任您的日志 - 它们可能已被攻击者“清理”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-02T00:08:43.217

IIS 7 + .NET 3.5 SP1 应该是一个不错的升级 :)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T07:54:45.497

他们似乎正在使用某种形式的注入攻击：请参阅[http://msdn.microsoft.com/en-us/library/bb355989.aspx?ppud=4](http://msdn.microsoft.com/en-us/library/bb355989.aspx?ppud=4)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T07:59:33.037

仅通过端口 80 就可以进行多种攻击。您在服务器上运行哪些应用程序？asp 和 php 安全漏洞的数量比操作系统/服务器应用程序漏洞的数量高出一个数量级。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-06T03:01:58.787

远离 Windows NT 类系统。IIS 7 的安全性可能还可以，但价格不符合标准。改用 BSD 或 Linux 与 Apache。Centos 如果 Linux 和 OpenBSD 如果 BSD 我的建议。

# asp.net - 如何从 ASP.NET Web 服务实现自定义 JSON 序列化？

> ID：159704
> 
> 赞同：14
> 
> 时间：2008-10-01T20:58:35.577
> 
> 标签：asp.net, web-services, json, serialization

从 WebService 返回自定义类的实例时，有哪些序列化选项？

我们有一些具有许多子集合类属性的类，以及可能根据使用情况设置或不设置的其他属性。这些对象是从用 ScriptService 属性修饰的 ASP.NET .asmx WebService 返回的，因此在由各种 WebMethods 返回时通过 JSON 序列化进行序列化。

问题是开箱即用的序列化返回所有公共属性，无论它们是否被使用，以及返回类名和其他信息的方式比你想要限制数量更详细交通。

目前，对于返回的类，我们添加了处理 JSON 序列化的自定义 javascript 转换器，并将它们添加到 web.config 中，如下所示：

```
<system.web.extensions>
  <scripting>
    <webServices>
      <jsonSerialization>
        <converters>
          <add name="CustomClassConverter" type="Namespace.CustomClassConverter" />
        </converters>
      </jsonSerialization>
    </webServices>
  </scripting>
</system.web.extensions> 
```

但这需要每个类都有一个自定义转换器。是否有任何其他方法可以通过扩展服务、创建自定义序列化程序等来更改开箱即用的 JSON 序列化？

**跟进**
@marxidad：

我们在其他应用程序中使用 DataContractJsonSerializer 类，但是我一直无法弄清楚如何将它应用于这些服务。以下是如何设置服务的示例：

```
[ScriptService]
public class MyService : System.Web.Services.WebService
{
    [WebMethod]
    public CustomClass GetCustomClassMethod
    {
        return new customClass();
    }
} 
```

WebMethods 由 javascript 调用并返回 JSON 序列化的数据。我们能够更改序列化的唯一方法是使用上面提到的 javascript 转换器？

有没有办法告诉 WebService 使用自定义 DataContractJsonSerializer？是否通过 web.config 配置，用属性装饰服务等？

**更新**
好吧，除了像上面那样创建单独的 JavaScriptConverters 之外，我们找不到任何方法来切换开箱即用的 JavaScriptSerializer。

为此，我们为避免创建单独的转换器所做的是创建一个通用的 JavaScriptConverter。我们向我们想要处理的类添加了一个空接口，并且在 Web 服务启动时调用的 SupportedTypes 使用反射来查找实现该接口的任何类型，如下所示：

```
public override IEnumerable<Type> SupportedTypes
{
  get
  {
    foreach (Assembly assembly in AppDomain.CurrentDomain.GetAssemblies())
    {
      AssemblyBuilder dynamicAssemblyCheck = assembly as AssemblyBuilder;
      if (dynamicAssemblyCheck == null)
      {
        foreach (Type type in assembly.GetExportedTypes())
        {
          if (typeof(ICustomClass).IsAssignableFrom(type))
          {
            yield return type;
          }
        }
      }
    }
  }
} 
```

实际实现有点不同，因此类型被缓存，我们可能会重构它以使用自定义属性而不是空接口。

然而，在处理自定义集合时，我们遇到了一个稍微不同的问题。这些通常只是扩展一个通用列表，但使用自定义类而不是 List<> 本身，因为集合类中通常存在自定义逻辑、排序等。

问题是 JavaScriptConverter 的 Serialize 方法返回一个字典，该字典被序列化为 JSON 作为具有关联类型的名称值对，而列表作为数组返回。因此无法使用转换器轻松序列化集合类。解决方案是不将这些类型包含在转换器的 SupportedTypes 中，并且它们完美地序列化为列表。

因此，序列化有效，但是当您尝试以其他方式将这些对象作为 Web 服务调用的参数传递时，反序列化会中断，因为它们不能将输入视为字符串/对象字典列表，这可以' 不会被转换为集合包含的任何自定义类的列表。我们能找到解决这个问题的唯一方法是创建一个泛型类，它是一个字符串/对象字典列表，然后将列表转换为适当的自定义集合类，然后更改任何 Web 服务参数以使用泛型类.

我敢肯定这里有很多问题和违反“最佳实践”的行为，但它为我们完成了工作，而无需创建大量自定义转换器类。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-01T05:31:15.710

我知道这个线程已经安静了一段时间，但我想我会提出，如果您在自定义转换器中覆盖 JavaScriptConverter 的 SupportedTypes 属性，您可以添加应该使用转换器的类型。如有必要，这可以进入配置文件。这样你就不需要每个类的自定义转换器。

我试图创建一个通用转换器，但无法弄清楚如何在 web.config 中识别它。很想知道是否有其他人管理过它。

我在尝试解决上述问题时得到了这个想法，并偶然发现了 Nick Berardi 的“创建更准确的 JSON .NET 序列化程序”（google it）。

为我工作:)

谢谢大家。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T14:30:03.843

如果您不使用代码生成的类，则可以使用[ScriptIgnoreAttribute](http://msdn.microsoft.com/en-us/library/system.web.script.serialization.scriptignoreattribute.aspx)装饰您的属性，以告诉序列化程序忽略某些属性。Xml 序列化具有类似的属性。

当然，如果你想在一个服务方法调用上返回一个类的某些属性，而在不同的服务方法调用上返回同一个类的不同属性，你就不能使用这种方法。如果您想这样做，请在服务方法中返回一个匿名类型。

```
[WebMethod]
[ScriptMethod]
public object GimmieData()
{
    var dalEntity = dal.GimmieEntity(); //However yours works...

    return new
       {
           id = dalEntity.Id,
           description = dalEntity.Desc
       };

} 
```

序列化程序可能不太关心您发送给它的对象的类型，因为它只是将其转换为文本。

我也相信你可以在你的数据实体上实现[ISerializable](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.iserializable.aspx)（如果你有代码生成的数据实体，作为一个部分类）来获得对序列化过程的细粒度控制，但我还没有尝试过。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T06:03:33.613

如果您使用.NET 3.x（或可以），WCF 服务将是您最好的选择。

您可以使用 [DataMember] 属性选择性地控制将哪些属性序列化到客户端。如果您愿意，WCF 还允许对 JSON 序列化和反序列化进行更细粒度的控制。

这是一个很好的入门示例：http: [//blogs.msdn.com/kaevans/archive/2007/09/04/using-wcf-json-linq-and-ajax-passing-complex-types-to-wcf -services-with-json-encoding.aspx](http://blogs.msdn.com/kaevans/archive/2007/09/04/using-wcf-json-linq-and-ajax-passing-complex-types-to-wcf-services-with-json-encoding.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T21:20:41.187

You can use the `System.Runtime.Serialization.Json.`[**`DataContractJsonSerializer`**](http://pietschsoft.com/post/2008/02/NET-35-JSON-Serialization-using-the-DataContractJsonSerializer.aspx) class in the `System.ServiceModel.Web.dll` assembly.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T21:49:21.320

不要肯定地引用我的工作，但我相信这就是您正在寻找的。

```
[WebMethod]
[ScriptMethod(ResponseFormat = ResponseFormat.Json)]
public XmlDocument GetXmlDocument()
{
    XmlDocument xmlDoc = new XmlDocument();
    xmlDoc.LoadXml(_xmlString);
    return xmlDoc;
} 
```

# c# - 可能是糟糕的编码风格......请评论

> ID：159705
> 
> 赞同：0
> 
> 时间：2008-10-01T20:59:04.967
> 
> 标签：c#

我正在检查新名称是否已经存在。

代码 1

```
if(cmbxExistingGroups.Properties.Items.Cast<string>().ToList().Exists(txt => txt==txtNewGroup.Text.Trim())) {
        MessageBox.Show("already exists.", "Add new group");
      } 
```

否则我可以写：

代码 2

```
foreach(var str in cmbxExistingGroups.Properties.Items)
      {
        if(str==txtNewGroup.Text) {
        MessageBox.Show("already exists.", "Add new group");        
            break;
        }   
      } 
```

我写了这两个，并认为我正在利用代码 1 中的语言特性。

...是的：它们都为我工作...我想知道性能：-/

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-01T21:01:42.260

我很欣赏第一个示例的聪明之处（假设它有效），但第二个示例对于必须维护代码的下一个人来说要容易得多。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-01T21:15:08.237

Sometimes just a little indentation makes a world of difference:

```
if (cmbxExistingGroups.Properties.Items
    .Cast<string>().ToList()
    .Exists
     (
         txt => txt==txtNewGroup.Text.Trim()
     )) 
{
    MessageBox.Show("already exists.", "Add new group");
} 
```

Since your using a List<String>, you might as well just drop the Exists predicate and use Contains...use Exists when comparing complex objects by unique values.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-01T21:03:32.583

我以前引用过它，但我会再做一次：

> 编写你的代码，就好像维护它的人是一个知道你住在哪里的杀人狂一样。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T22:51:43.667

The first code bit is fine, except instead of calling `Enumerable.ToList()` and `List<T>.Exists()`, you should just call `Enumerable.Any()` -- it does a lazy evaluation, so it never allocates the memory for the `List<T>`, and it will stop enumerating `cmbxExistingGroups.Properties.Items` and casting them to `string`. Also, calling the trim from inside that predicate means it happens for every item it looks at. It would be best to move it out to the outer scope:

```
string match = txtNewGroup.Text.Trim();
if(cmbxExistingGroups.Properties.Items.Cast<string>().Any(txt => txt==match)) {
    MessageBox.Show("already exists.", "Add new group");
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-01T21:12:01.550

would

```
cmbxExistingGroups.Properties.Items.Contains(text) 
```

not work instead?

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-01T21:15:42.057

There are a few things wrong here:

1) The two bits of code don't do the same thing - the first looks for the trimmed version of txtNewGroup, the second just looks for txtNewGroup

2) There's no point in calling ToList() - that just make things less efficient

3) Using Exists with a predicate is overkill - Contains is all you need here

So, the first could easily come down to:

```
if (cmbxExistingGroups.Properties.Items.Cast<string>.Contains(txtNewGroup.Text))
{
    // Stuff
} 
```

I'd probably create a variable to give "cmbxExistingGroups.Properties.Items.Cast" a meaningful, simple name - but then I'd say it's easier to understand than the explicit foreach loop.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-01T21:03:09.543

编码中的冗长并不总是坏事。我更喜欢第二个代码片段而不是第一个。试想一下，您将不得不维护（甚至更改其功能）第一个示例……嗯。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-01T21:33:46.707

首先，它们不等价。第一个样本对 txtNewSGroup.Text.Trim() 进行检查，第二个省略了修剪。此外，第一个将所有内容都转换为字符串，而第二个使用迭代器中的任何内容。我认为这是一个对象，否则您将不需要演员阵容。

因此，公平地说，与 LINQ 样式中的第二个示例最接近的等价物是：

```
if (mbxExistingGroups.Properties.Items.Cast<string>().Contains(txtNewGroup.Text)) {
   ...
} 
```

这还不错。但是，既然您似乎使用的是旧式 IEnumerable 而不是新式的 IEnumerable<T>，我们为什么不给您另一种扩展方法：

```
public static Contains<T>(this IEnumerable e, T value) {
   return e.Cast<T>().Contains(value);
} 
```

现在我们有：

```
if (mbxExistingGroups.Properties.Items.Contains(txtNewGroup.Text)) {
   ...
} 
```

这是非常可读的国际海事组织。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-01T21:21:17.503

好吧，如果是我，那将是 2 的变体。总是更喜欢可读性而不是单行。此外，请始终提取一种方法以使其更清晰。

你的调用代码变成

```
if( cmbxExistingGroups.ContainsKey(txtNewGroup.Text) )
{
   MessageBox.Show("Already Exists");
} 
```

如果为 Combo Boxes 定义扩展方法

```
public static class ComboBoxExtensions
{
    public static bool ContainsKey(this ComboBox comboBox, string key)
    {
        foreach (string existing in comboBox.Items)
        {
            if (string.Equals(key, existing))
            {
                return true;
            }
        }
        return false;
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-01T21:03:31.023

我同意，选择第二个，因为它对任何从事它的人来说更容易维护，当你在 6-12 个月内回到那个时候，你会更容易记住你在做什么。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-01T21:16:09.607

> both of them works for me ..i am wonodering about the performance

I see no one read the question :) I think I see what you're doing (I don't use this language). The first tries to generate the list and test it in one shot. The second does an explicit iteration and can "short circuit" itself (exit early) if it finds the duplicate early on. The question is whether the "all at once" is more efficient due to the language implementation.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-01T21:21:04.010

The second of the two would perform better, and it would perform the same as other people's samples that use Contains.

The reason why the first one uses an extra trim. plus a conversion to list. so it iterates once for conversion, then starts again to check using exists, and does a trim each time, but will exit iteration if found. The second starts iterating once, has no trim, and will exit if found.

So in short the answer to your question is the second performs much better.

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-02T02:02:58.340

从性能上看：

```
txtNewGroup.Text.Trim() 
```

在循环之外进行控制交互/字符串操作 - 一次，而不是 n 次。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-10-01T21:03:55.437

我想，在 WTF 的每分钟规模上，第一个将不在图表之列。数点数，每行超过两个是潜在问题

# python - What is the naming convention in Python for variable and function names?

> ID：159720
> 
> 赞同：927
> 
> 时间：2008-10-01T21:01:16.757
> 
> 标签：python, variables, function, naming-conventions

Coming from a C# background the naming convention for variables and method names are usually either camelCase or PascalCase:

```
// C# example
string thisIsMyVariable = "a"
public void ThisIsMyMethod() 
```

In Python, I have seen the above but I have also seen underscores being used:

```
# python example
this_is_my_variable = 'a'
def this_is_my_function(): 
```

Is there a more preferable, definitive coding style for Python?

* * *

## 回答 #1

> 赞同：1019
> 
> 时间：2008-10-01T21:05:24.187

See Python [PEP 8: Function and Variable Names](https://www.python.org/dev/peps/pep-0008/#function-and-variable-names):

> Function names should be [lowercase, with words separated by underscores](https://en.wikipedia.org/wiki/Snake_case) as necessary to improve readability.
> 
> Variable names follow the same convention as function names.
> 
> [mixedCase](https://en.wikipedia.org/wiki/MixedCase) is allowed only in contexts where that's already the prevailing style (e.g. [threading.py](https://docs.python.org/library/threading.html)), to retain backwards compatibility.

* * *

## 回答 #2

> 赞同：909
> 
> 时间：2011-12-07T22:44:24.630

The [Google Python Style Guide](https://google.github.io/styleguide/pyguide.html#316-naming) has the following convention:

> `module_name`, `package_name`, `ClassName`, `method_name`, `ExceptionName`, `function_name`, `GLOBAL_CONSTANT_NAME`, `global_var_name`, `instance_var_name`, `function_parameter_name`, `local_var_name`.

A similar naming scheme should be applied to a `CLASS_CONSTANT_NAME`

* * *

## 回答 #3

> 赞同：271
> 
> 时间：2008-10-02T03:53:12.227

David Goodger (in "Code Like a Pythonista" [here](http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html)) describes the PEP 8 recommendations as follows:

*   `joined_lower` for functions, methods, attributes, variables

*   `joined_lower` or `ALL_CAPS` for constants

*   `StudlyCaps` for classes

*   `camelCase` only to conform to pre-existing conventions

* * *

## 回答 #4

> 赞同：52
> 
> 时间：2010-04-25T11:23:57.233

As the [Style Guide for Python Code](http://www.python.org/dev/peps/pep-0008/) admits,

> The naming conventions of Python's library are a bit of a mess, so we'll never get this completely consistent

Note that this refers just to Python's *standard library*. If they can't get *that* consistent, then there hardly is much hope of having a generally-adhered-to convention for *all* Python code, is there?

From that, and the discussion here, I would deduce that it's **not** a horrible sin if one keeps using e.g. Java's or C#'s (clear and well-established) naming conventions for variables and functions when crossing over to Python. Keeping in mind, of course, that it is best to abide with whatever the prevailing style for a codebase / project / team happens to be. As the Python Style Guide points out, *internal consistency* matters most.

^(Feel free to dismiss me as a heretic. :-) Like the OP, I'm not a "Pythonista", not yet anyway.)

* * *

## 回答 #5

> 赞同：37
> 
> 时间：2008-11-05T02:51:29.330

As mentioned, PEP 8 says to use `lower_case_with_underscores` for variables, methods and functions.

I prefer using `lower_case_with_underscores` for variables and `mixedCase` for methods and functions makes the code more explicit and readable. Thus following the [Zen of Python's](http://www.python.org/dev/peps/pep-0020/) "explicit is better than implicit" and "Readability counts"

* * *

## 回答 #6

> 赞同：35
> 
> 时间：2008-10-01T21:12:41.797

There is [PEP 8](http://www.python.org/dev/peps/pep-0008/), as other answers show, but PEP 8 is only the styleguide for the standard library, and it's only taken as gospel therein. One of the most frequent deviations of PEP 8 for other pieces of code is the variable naming, specifically for methods. There is no single predominate style, although considering the volume of code that uses mixedCase, if one were to make a strict census one would probably end up with a version of PEP 8 with mixedCase. There is little other deviation from PEP 8 that is quite as common.

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2008-10-01T21:16:21.680

Most python people prefer underscores, but even I am using python since more than 5 years right now, I still do not like them. They just look ugly to me, but maybe that's all the Java in my head.

I simply like CamelCase better since it fits better with the way classes are named, It feels more logical to have `SomeClass.doSomething()` than `SomeClass.do_something()`. If you look around in the global module index in python, you will find both, which is due to the fact that it's a collection of libraries from various sources that grew overtime and not something that was developed by one company like Sun with strict coding rules. I would say the bottom line is: Use whatever you like better, it's just a question of personal taste.

* * *

## 回答 #8

> 赞同：27
> 
> 时间：2018-06-20T23:49:28.340

further to what @JohnTESlade has answered. [Google's python style guide](https://google.github.io/styleguide/pyguide.html?showone=Naming#Naming) has some pretty neat recommendations,

**Names to Avoid**

*   single character names except for counters or iterators
*   dashes (-) in any package/module name
*   `\__double_leading_and_trailing_underscore__ names` (reserved by Python)

**Naming Convention**

*   "Internal" means internal to a module or protected or private within a class.
*   Prepending a single underscore (_) has some support for protecting module variables and functions (not included with import * from). Prepending a double underscore (__) to an instance variable or method effectively serves to make the variable or method private to its class (using name mangling).
*   Place related classes and top-level functions together in a module. Unlike Java, there is no need to limit yourself to one class per module.
*   Use `CapWords` for class names, but `lower_with_under.py` for module names. Although there are many existing modules named `CapWords.py`, this is now discouraged because it's confusing when the module happens to be named after a class. ("wait -- did I write `import StringIO` or `from StringIO import StringIO`?")

**Guidelines derived from Guido's Recommendations** [![enter image description here](https://i.stack.imgur.com/uBr10.png)](https://i.stack.imgur.com/uBr10.png)

* * *

## 回答 #9

> 赞同：20
> 
> 时间：2008-10-02T03:24:30.327

Personally I try to use CamelCase for classes, mixedCase methods and functions. Variables are usually underscore separated (when I can remember). This way I can tell at a glance what exactly I'm calling, rather than everything looking the same.

* * *

## 回答 #10

> 赞同：16
> 
> 时间：2016-05-09T16:20:04.477

There is a paper about this: [http://www.cs.kent.edu/~jmaletic/papers/ICPC2010-CamelCaseUnderScoreClouds.pdf](http://www.cs.kent.edu/~jmaletic/papers/ICPC2010-CamelCaseUnderScoreClouds.pdf)

TL;DR It says that snake_case is more readable than camelCase. That's why modern languages use (or should use) snake wherever they can.

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-10-01T21:08:19.203

The coding style is usually part of an organization's internal policy/convention standards, but I think in general, the all_lower_case_underscore_separator style (also called snake_case) is most common in python.

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2019-08-22T03:37:53.380

I personally use Java's naming conventions when developing in other programming languages as it is consistent and easy to follow. That way I am not continuously struggling over what conventions to use which shouldn't be the hardest part of my project!

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2021-08-27T20:03:22.990

Lenin has told... I'm from Java/C# world too. And SQL as well. Scrutinized myself in attempts to find first sight understandable examples of complex constructions like list in the dictionary of lists where everything is an object. As for me - camelCase or their variants should become standard for any language. Underscores should be preserved for complex sentences.

* * *

## 回答 #14

> 赞同：-2
> 
> 时间：2008-10-02T03:55:18.257

Typically, one follow the conventions used in the language's standard library.

# oracle - 如何查找可能由连接错误导致的 oracle 错误代码？

> ID：159721
> 
> 赞同：1
> 
> 时间：2008-10-01T21:01:21.700
> 
> 标签：oracle, ora-12560

我想处理当我的网络/数据库连接中断时引发的 OracleException，我在哪里可以找到我可能会收到哪些错误代码？

我想既然我们谈论的是连接中断，这些在技术上将是 TNS 错误，例如 ORA-12560“TNS：协议适配器错误”。但我注意到其他几个取决于连接丢失的确切位置，并希望获得完整列表。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-01T21:15:14.227

查看[Oracle 数据库错误消息 11g 第 1 版 (11.1)](http://download.oracle.com/docs/cd/B28359_01/server.111/b28278/toc.htm)。这里是[TNS 错误的搜索结果](http://www.oracle.com/pls/db111/search?remark=quick_search&word=TNS&partno=b28278)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-01T21:06:25.823

这里有一个完整的列表：http: [//ora-code.com](http://ora-code.com)

但请注意，其中一些，例如“TNS：协议适配器错误”，实际上可能意味着许多不同的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T21:10:30.353

```
ORA-12154 TNS:could not resolve service name"
ORA-12203 TNS:unable to connect to destination"
ORA-12500 TNS:listener failed to start a dedicated server process"
ORA-12545 TNS:name lookup failure"
ORA-12560 TNS:protocol adapter error" 
```

# internet-explorer - 从 IE 中删除“目标另存为...”

> ID：159732
> 
> 赞同：3
> 
> 时间：2008-10-01T21:03:23.473
> 
> 标签：internet-explorer, right-click, popupmenu

有没有办法通过使用组策略或注册表黑客从 Internet Explorer 的右键菜单中删除“目标另存为”？失败了，有一种简单的编程方式吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-01T21:20:38.237

Update: Aside from all my preachings below, here's the answer you are looking for:

There is a Group Policy to turn off the "Save As..." menu item from the File menu in Internet Explorer (IE5+), which can be deployed per-machine or per-user. However, that group policy does not control the "Save Target As..." from the context menu.

Unless you are part of the IT department of the company the user is working for, attempting to limit the user actions in the HTTP agent is never a good idea for multiple reasons:

1.  You should not mess with the user's computer
2.  You might be breaking other applications
3.  You don't know what HTTP agent the user is using
4.  Relying on limiting the user actions is at best futile, as any sofisticated user will probably find a way to circumvent your limitation
5.  It's the quickest way to alienate your users

And even if you are part of the IT department, you should try to limit your control over the user's actions as much as possible.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-01T21:05:46.697

如果您正在尝试为网站实施某种 DRM 方案 - 请不要这样做。它们从不工作，只会惹恼您的用户。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T21:32:43.013

@1800 信息

也许我们可以让斯坦从怀疑中受益？也许他正在为某个试图阻止最终用户下载带有病毒的应用程序的公司 IT 部门工作？我的意思是，有人可能会尝试实现这种功能，但并非出于恶意。

如果是这种情况（您正在为某个公司 IT 部门工作，并且您的任务是阻止人们从 Internet 下载文件），正如其他人所指出的那样，可能有更好的方法来实现您想要实现的目标。

假设他的老板已经让他做这项家务，这是一个相关的问题。

一种选择（但在大多数 IT 环境中可能不受欢迎）是转储 IE 并使用开源浏览器，您可以在其中简单地修改源以删除“另存为...”选项。但是，正如我所说，除非情况发生巨大变化，否则大多数企业 IT 部门永远不会考虑放弃 IE 以支持另一种浏览器。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-01T21:06:16.557

没有。

（这部分只是因为答案最小尺寸限制）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-01T21:23:59.757

更好地描述您为什么要这样做会有所帮助。例如，禁用菜单项不会阻止人们下载文档。他们单击的任何文件链接仍会出现在 Internet 临时文件中。

在逐页的基础上，您可以使用 Javascript 来捕获右键单击事件，并拒绝调整菜单，但即使是中等经验的用户也可以轻松解决这个问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-24T22:25:49.643

您为什么不尝试完全删除右键单击。或者，如果您需要自己的菜单，您可以使用 div 轻松创建自己的弹出窗口。

无法修改默认菜单并禁用菜单的一部分。

查看我如何在此处禁用右键单击上下文菜单：

[http://www.codeproject.com/tips/42554/Javascript-hack-to-disable-Right-Click-and-Text-Se.aspx](http://www.codeproject.com/tips/42554/Javascript-hack-to-disable-Right-Click-and-Text-Se.aspx)

我希望这能帮到您。

# asp.net - 在 ASP.NET 中将 MS Word 文档转换为 PDF

> ID：159744
> 
> 赞同：18
> 
> 时间：2008-10-01T21:05:21.317
> 
> 标签：asp.net, pdf, pdf-generation

已经提出了类似的问题，但与我的完全不同，所以就这样吧。

我们在 ASP.NET Web 服务器上有一组 Microsoft Word 文档，其中包含合并字段，其值是作为用户表单提交的结果而填写的。字段合并后，服务器必须将文档转换为 PDF 并将其流式传输到浏览器。我们的第一个想法是使用 Visual Studio Tools for Office API；但是，我们遇到了[来自 Microsoft 的警告](http://support.microsoft.com/?id=257757)：

> Microsoft 目前不推荐也不支持任何无人值守、非交互式客户端应用程序或组件（包括 ASP、ASP.NET、DCOM 和 NT 服务）的 Microsoft Office 应用程序自动化，因为 Office 可能表现出不稳定的行为和/或在此环境中运行 Office 时出现死锁。

看起来可以使用[Open XML SDK](http://msdn.microsoft.com/en-us/library/aa982683.aspx)完成字段操作，但是在不打开 Word 的情况下将 Word 2007 文档转换为 PDF 的最佳方法是什么？最佳解决方案应该是低成本、可扩展、内存占用少、易于部署并具有 .NET API。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-01-20T09:43:13.320

问题是“MS Word Documents to PDF in ASP.NET”所以我很困惑为什么上面推荐 Aspose.Pdf 和 A​​spose.Pdf.Kit。您需要使用[Aspose.Words](http://www.aspose.com/categories/.net-components/aspose.words-for-.net/default.aspx)，因为它是支持 Microsoft Word 文档到 PDF 转换的组件。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-15T10:53:40.173

它不完全是开源的，但 Aspose 有几个产品可以做到这一点，

[Aspose.Pdf.Kit](http://www.aspose.com/categories/file-format-components/aspose.pdf.kit-for-.net-and-java/default.aspx)

> Aspose.Pdf.Kit 是一个非图形 PDF® 文档操作组件，它使 .NET 和 Java 开发人员能够管理现有的 PDF 文件以及管理嵌入在 PDF 文件中的表单域。Aspose.Pdf 非常适合创建新的 PDF 文件；但是，开发人员通常需要编辑已经存在的 PDF 文档。Aspose.Pdf.Kit 允许他们这样做。Aspose.Pdf.Kit 允许开发人员创建功能强大的应用程序，用于将数据直接合并到 PDF 文档以及更新和管理 PDF 文档。Aspose.Pdf.Kit 是一款出色的产品，可以与我们的其他 PDF 产品配合使用。

和[Aspose.pdf](http://www.aspose.com/categories/file-format-components/aspose.pdf-for-.net-and-java/default.aspx)

> Aspose.Pdf 是一个非图形 PDF® 文档报告组件，它使 .NET 或 Java 应用程序无需使用 Adob​​e Acrobat® 从头开始​​创建 PDF 文档。Aspose.Pdf 价格非常实惠，并提供了丰富的强大功能，包括：压缩、表格、图形、图像、超链接、安全性和自定义字体。Aspose.Pdf 支持通过 API、XML 模板和 XSL-FO 文件创建 PDF 文件。Aspose.Pdf 非常易于使用，并提供了 14 个用 C# 和 Visual Basic 编写的全功能演示。

查看[API](http://www.aspose.com/documentation/file-format-components/aspose.pdf-for-.net-and-java/aspose.pdf-for-.net-api-reference.htm)和[演示](http://www.aspose.com/demos/aspose.words/default.aspx)。您可以免费下载 DLL 进行试用。我以前都用过，效果很好。

还有[iTextSharp](http://itextsharp.sourceforge.net/)，它是 iText 的 C# 端口，一个 Java PDF 转换器。我听说有些人尝试它的结果好坏参半。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-01T21:11:17.107

查看 Microsoft 关于使用 C# 或 VB[将 Word 2007 文档保存为 PDF 和 XPS 格式的资源。](http://msdn.microsoft.com/en-us/library/bb412305.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-15T10:45:45.510

ActivePdf DocConverter - [http://www.activepdf.com/](http://www.activepdf.com/)

但它需要在服务器上安装 Office 才能获得高质量的转换。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-19T09:07:20.450

Aspose.Words 可能是您的最佳选择，但它并不能完美地转换所有视觉元素。

看看[Muhimbi PDF Converter Web 服务](http://www.muhimbi.com/Products/PDF-Converter-Services/summary.aspx)。它作为服务在 Windows 上运行，但可以从任何非 Windows 支持 Web 服务的环境访问，包括 Java 和 .NET。

尽管此解决方案需要将 MS-Office 安装在服务器上（不一定与您的应用程序在同一台服务器上），但它非常健壮并提供完美的转换保真度。它竭尽全力解决微软在其知识库文章中提到的死锁问题。

要生成或修改 MS-Word 文件，我建议使用免费的[Open XML SDK for Microsoft Office](http://www.microsoft.com/downloads/details.aspx?FamilyId=C6E744E5-36E9-45F5-8D8C-331DF206E0D0&displaylang=en)。Eric White 维护了一个[非常好的博客](http://blogs.msdn.com/ericwhite/archive/2010/04/16/office-2010-reaches-rtm.aspx)。

免责声明，我在这个产品上工作。话虽如此，它工作得很好。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-20T11:46:01.280

为此，您应该尝试使用 OpenOffice。它是免费的，支持各种文件转换。我用它来将 DOC 和 DOCX 文件转换为 HTML 格式，效果非常好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-06-21T09:59:11.273

ABCpdf 是另一个流行的组件，它可以让您在 ASP.NET 下将 Word 文档转换为 PDF，但是我相信它也可以使用 Microsoft Office 或 OpenOffice。

[http://www.websupergoo.com/abcpdf-office-docs.htm](http://www.websupergoo.com/abcpdf-office-docs.htm)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-03-24T11:51:41.657

Microsoft PDF add-in for word 似乎是目前最好的解决方案，但您应该考虑到它不会将所有 word 文档正确转换为 pdf，在某些情况下，您会看到 word 和输出 pdf 之间存在巨大差异。不幸的是，我找不到任何可以正确转换所有 word 文档的 api。我发现确保转换 100% 正确的唯一解决方案是通过打印机驱动程序转换文档。缺点是文档会被排队并一一转换，但您可以确定生成的 pdf 与单词 docuemtn 完全一样。我个人更喜欢使用UDC（通用文档转换器）并在服务器上安装了Foxit Reader（免费版），然后通过启动“进程”并将其动词属性设置为“打印”来打印文档。

# silverlight - 使用子域来识别客户端

> ID：159768
> 
> 赞同：0
> 
> 时间：2008-10-01T21:10:12.770
> 
> 标签：silverlight, web-services, subdomain

我正在构建一个 Silverlight 应用程序，而我们希望能够让客户点击如下网址：

http://{client}.domain.com/

并登录，其中 {client} 部分是他们的公司名称。例如，谷歌的将是：

[http://google.domain.com/](http://google.domain.com/)

我想知道是否有人能够在 Silverlight 中使用此子域模型来决定对 Web 服务器的调用，以便您可以切换到特定数据库来运行查询？不幸的是，这对项目来说是非常必要的，因为我们正在努力让他们的员工更容易获得他们公司的软件特定信息。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-01T21:15:18.063

在服务器端，您可以检查 HTTP 1.1 Host 标头以查看用户如何访问您的服务器并在此基础上进行必要的自定义。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T21:19:42.700

我认为你不能单独使用 Silverlight 来做到这一点，我知道你不能在没有 Javascript、Ajax 等问题的情况下做到这一点。这是因为出于安全原因，浏览器对子域的处理方式与子页面不同。

以下想法如何：将重写规则插入您的 Web 服务器软件。因此，如果调用 http: [//google.domain.com，Web](http://google.domain.com)服务器本身会将 URL 重写为类似[http://www.domain.com/google/](http://www.domain.com/google/)的内容（或者更好的是：http: [//www.domain.com/客户/谷歌/](http://www.domain.com/customers/google/)）。那会有帮助吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T21:29:16.343

乔治：

如果它是静态的，那将有所帮助，但唉，这将是动态的。我希望为应用程序进行 1x 部署，并使用[http://google.domain.com/](http://google.domain.com/)想法为用户切换到正确的数据库。我记得当我们建立一个 asp.net 网站时这样做过，使用域上下文来确定要使用什么皮肤等。

Ates：你能解释一下你在说什么吗……听起来你很接近我想要的东西。你看过这样的教程吗？

我想出的唯一另一种方法是拥有一个元数据库，当用户登录时，它会根据需要将它们切换到适当的数据库......只是在想告诉客户端 x 命中：

[http://ClientX.domain.com/](http://ClientX.domain.com/)会比点击[http://www.domain.com/](http://www.domain.com/)并登录更甜蜜。似乎他们要打出自己的名字，并直接从登录屏幕向他们展示个性化的名字，这对客户群来说会更具吸引力。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T22:02:57.807

@Richard B：不，我想不出我以前见过的任何此类教程。我会尽量详细一点。

更详细的服务器端方法：

1.  将 *.example.com 定向到 DNS 设置中的同一 IP。
2.  处理登录的后端应用程序检查`Host`HTTP 标头（例如，某些平台中的“HTTP_HOST”服务器变量）。这将包含客户端用于访问您的服务器的确切 subdomain.example.com。提取子域部分并继续...

也可以有一种仅限客户端的方法。我对 Silverlight 了解不多，但我假设您应该能够将 Silverlight 与 JavaScript 交互。您可以`document.location`使用 JavaScript 读取数据并将其传递给您的 Silverlight 小程序，在该小程序中进一步的数据获取等逻辑将依赖于 JavaScript 传入的子域。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-02T02:52:01.437

@Ates：

这就是我们在编写 ASP.Net 系统时所做的……我们将大量 *.example.com 主机推送到 Web 服务器，并使用 HTTP 标头进行处理。处理 WCF 在客户端和服务器之间推送信息时会出现阻塞......它只能存在于一个域中......

因此，例如，当您拥有 {client}.example.com 和 {sandbox}.example.com 时，WCF 服务无法同时注册到两者。它也不能只注册到 *.example.com 或 example.com，所以这就是 catch 22 的用武之地。其他一切我都有处理的先验知识。

我记得在某些情况下应用程序可以“欺骗”另一个域名的方法。我拿这种情况来说，我需要做这样的配置吗？很多研究，但我相信。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-02T16:34:09.493

将服务放在特定的子域本身（例如 wcf.example.com）上，然后在服务上设置跨域策略文件以允许它访问它，这不是有效吗？

只要这可行，您就可以将 silverlight 加载到正确的子域中，然后将该子域传递给您的服务并让它完成它的工作。

下面的一些例子：

*   [Silverlight 跨域服务](http://timheuer.com/blog/archive/2008/06/10/silverlight-services-cross-domain-404-not-found.aspx)
*   [Silverlight 跨域策略助手](http://timheuer.com/blog/archive/2008/04/06/silverlight-cross-domain-policy-file-snippet-intellisense.aspx)

# oracle - Oracle ROWNUM 伪列

> ID：159769
> 
> 赞同：3
> 
> 时间：2008-10-01T21:10:13.753
> 
> 标签：oracle, rownum

我有一个带有 group by 和 order by 子句的复杂查询，我需要每行返回一个排序的行号 (1...2...(n-1)...n)。使用 ROWNUM （在通过查询的谓词阶段但在查询进行任何排序或聚合之前将值分配给行）给我一个未排序的列表（4...567...123...45 ...）。我不能使用应用程序为每一行计算和分配数字。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-01T21:12:49.880

有没有你不能做的理由

```
SELECT rownum, a.* 
  FROM (<<your complex query including GROUP BY and ORDER BY>>) a 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-01T21:13:10.643

你可以把它作为一个子查询来做，所以有：

```
select q.*, rownum from (select... group by etc..) q 
```

这可能会工作......不知道是否有比这更好的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T21:13:11.890

可以使用内联查询吗？IE

```
SELECT cols, ROWNUM
FROM   (your query) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T21:14:57.267

假设您的查询已经按照您想要的方式排序，并且您只需要一个数字来指示它的顺序是哪一行：

```
SELECT ROWNUM AS RowOrderNumber, Col1, Col2,Col3...
FROM (
    [Your Original Query Here]
) 
```

并将“Colx”替换为查询中列的名称。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-06T19:47:18.150

我有时也会做类似的事情：

```
SELECT * FROM
(SELECT X,Y FROM MY_TABLE WHERE Z=16 ORDER BY MY_DATE DESC)
WHERE ROWNUM=1 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-07-27T14:25:59.817

如果您想使用 ROWNUM 来做任何事情，而不是限制查询中返回的总行数（例如 AND ROWNUM < 10），您需要给 ROWNUM 起别名：

```
 select * 
   (select rownum rn, a.* from 
          (<sorted query>) a))
 where rn between 500 and 1000 
```

# c# - 添加到 SqlException.Data 集合的对象是否需要 [Serializable]？

> ID：159773
> 
> 赞同：0
> 
> 时间：2008-10-01T21:11:32.223
> 
> 标签：c#, .net, sqlexception

添加到 SqlException.Data 集合的对象是否需要 [Serializable]？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-15T21:59:36.727

是的，他们需要。这是因为 ISerializable 在 Exception 类型中的实现将 Data 属性添加到 StreamingContext 中。并且 Data 属性（它是一个 IDictionary）中的所有对象都必须是可序列化的。即使不打算构建分布式应用程序，让异常类和实例可序列化也是一种好习惯。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-13T09:35:51.720

如果异常要跨 appdomain 边界传播，则异常及其包含的数据需要可序列化。

一种这样的场景是客户端-服务器应用程序通过远程通信进行通信。如果服务器抛出异常并且需要在客户端进行处理，框架将不得不对其进行序列化/反序列化。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-04T04:14:57.767

好吧，严格来说，不……您可以将任何类型添加到异常的数据字典中……但是您为什么要问呢？您认为它们将被连载到什么边界？

# ruby - Is Ruby a functional language?

> ID：159797
> 
> 赞同：89
> 
> 时间：2008-10-01T21:16:13.303
> 
> 标签：ruby, functional-programming

Wikipedia says Ruby is a functional language, but I'm not convinced. Why or why not?

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2010-02-25T08:44:22.560

Whether a language is or is not a functional language is unimportant. Functional Programming is a thesis, best explained by Philip Wadler (The Essence of Functional Programming) and John Hughes (Why Functional Programming Matters).

A meaningful question is, 'How amenable is Ruby to achieving the thesis of functional programming?' The answer is 'very poorly'.

I gave a talk on this just recently. [Here are the slides.](http://tmorris.net/posts/what-does-functional-programming-mean/index.html)

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-10-01T23:10:26.773

Ruby does support higher-level functions (see Array#map, inject, & select), but it is still an imperative, Object-Oriented language.

One of the key characteristics of a functional language it that it avoids mutable state. Functional languages do not have the concept of a variable as you would have in Ruby, C, Java, or any other imperative language.

Another key characteristic of a functional language is that it focuses on defining a program in terms of "what", rather than "how". When programming in an OO language, we write classes & methods to hide the implementation (the "how") from the "what" (the class/method name), but in the end these methods are still written using a sequence of statements. In a functional language, you do not specify a sequence of execution, even at the lowest level.

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2008-10-01T21:30:40.927

I most definitely think you can use functional style in Ruby.

One of the most critical aspects to be able to program in a functional style is if the language supports higher order functions... which Ruby does.

That said, it's easy to program in Ruby in a non-functional style as well. Another key aspect of functional style is to not have state, and have real mathematical functions that always return the same value for a given set of inputs. This can be done in Ruby, but it is not enforced in the language like something more strictly functional like Haskell.

So, yeah, it supports functional style, but it also will let you program in a non-functional style as well.

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-10-01T22:01:43.130

I submit that supporting, or having the ability to program in a language in a functional *style* does not a functional language make.

I can even write Java code in a functional style if I want to hurt my collegues, and myself a few ~~months~~ weeks on.

Having a functional language is not only about what you *can* do, such as higher-order functions, first-class functions and currying. It is also about what you *cannot* do, like side-effects in pure functions.

This is important because it is a big part of the reason why functional programs are, or functional code in generel is, easier to reason about. And when code is easier to reason about, bugs become shallower and float to the conceptual surface where they can be fixed, which in turn gives less buggy code.

Ruby is object-oriented at its core, so even though it has reasonably good support for a functional style, it is not itself a functional language.

That's my non-scientific opinion anyway.

**Edit:** In retrospect and with consideration for the fine comments I have recieved to this answer thus far, I think the object-oriented versus functional comparison is one of apples and oranges.

The real differentiator is that of being imparative in execution, or not. Functional languages have the expression as their primary linguistic construct and the order of execution is often undefined or defined as being lazy. Strict execution is possible but only used when needed. In an imparative language, strict execution is the default and while lazy execution is possible, it is often kludgy to do and can have unpredictable results in many edge cases.

Now, *that's* my non-scientific opinion.

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2016-02-19T18:14:15.170

Ruby will have to meet the following requirements in order to be "TRUELY" functional.

**Immutable values:** once a “variable” is set, it cannot be changed. In Ruby, this means you effectively have to treat variables like constants. The is not fully supported in the language, you will have to freeze each variable manually.

**No side-effects:** when passed a given value, a function must always return the same result. This goes hand in hand with having immutable values; a function can never take a value and change it, as this would be causing a side-effect that is tangential to returning a result.

**Higher-order functions:** these are functions that allow functions as arguments, or use functions as the return value. This is, arguably, one of the most critical features of any functional language.

**Currying:** enabled by higher-order functions, currying is transforming a function that takes multiple arguments into a function that takes one argument. This goes hand in hand with partial function application, which is transforming a multi-argument function into a function that takes less arguments then it did originally.

**Recursion:** looping by calling a function from within itself. When you don’t have access to mutable data, recursion is used to build up and chain data construction. This is because looping is not a functional concept, as it requires variables to be passed around to store the state of the loop at a given time.

**Lazy-evaluation, or delayed-evaluation:** delaying processing of values until the moment when it is actually needed. If, as an example, you have some code that generated list of Fibonacci numbers with lazy-evaluation enabled, this would not actually be processed and calculated until one of the values in the result was required by another function, such as puts.

**Proposal (Just a thought)** I would be of great to have some kind of definition to have a `mode` directive to declare files with functional paradigm, example

mode 'functional'

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2008-10-01T21:18:08.523

Ruby is a multi-paradigm language that supports a functional style of programming.

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-01T21:48:53.957

Ruby is an object-oriented language, that can support other paradigms (functional, imperative, etc). However, since everything in Ruby is an object, it's primarily an OO language.

example:

"hello".reverse() = "olleh", every string is a string object instance and so on and so forth.

Read up [here](http://www.ruby-lang.org/en/about/) or [here](http://en.wikipedia.org/wiki/Ruby_programming_language)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-03T10:59:01.267

It depends on your definition of a “functional language”. Personally, I think the term is itself quite problematic when used as an absolute. The are more aspects to being a “functional language” than mere language features and most depend on where you're looking from. For instance, the culture surrounding the language is quite important in this regard. Does it encourage a functional style? What about the available libraries? Do they encourage you to use them in a functional way?

Most people would call Scheme a functional language, for example. But what about Common Lisp? Apart from the multiple-/single-namespace issue and guaranteed tail-call elimination (which some CL implementations support as well, depending on the compiler settings), there isn't much that makes Scheme as a language more suited to functional programming than Common Lisp, and still, most Lispers wouldn't call CL a functional language. Why? Because the culture surrounding it heavily depends on CL's imperative features (like the LOOP macro, for example, which most Schemers would probably frown upon).

On the other hand, a C programmer may well consider CL a functional language. Most code written in any Lisp dialect is certainly much more functional in style than your usual block of C code, after all. Likewise, Scheme is very much an imperative language as compared to Haskell. Therefore, I don't think there can ever be a definite yes/no answer. Whether to call a language functional or not heavily depends on your viewpoint.

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-01T21:26:45.070

Ruby isn't really much of a multi-paradigm language either, I think. Multi-paradigm tends to be used by people wanting to label their favorite language as something which is useful in many different areas.

I'd describe Ruby is an object-oriented scripting language. Yes, functions are first-class objects (sort of), but that doesn't really make it a functional language. IMO, I might add.

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-06-29T09:01:41.183

Recursion is common in functional programming. Almost any language does support recursion, but recursive algorithms are often ineffective if there is no [tail call](http://en.wikipedia.org/wiki/Tail_recursion) optimization (TCO).

Functional programming languages are capable of optimizing tail recursion and can execute such code in constant space. Some Ruby implementations do optimize tail recursion, the other don't, but in general Ruby implementations are not required to do TCO. See [Does Ruby perform Tail Call Optimization?](https://stackoverflow.com/questions/824562/does-ruby-perform-tail-call-optimization)

So, if you write some Ruby functional style and rely on TCO of some particular implementation, your code may be very ineffective in another Ruby interpreter. I think this is why Ruby is not a functional language (neither is Python).

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-07-30T21:32:10.363

Strictly speaking, it doesn't make sense to describe a language as "functional"; most languages are capable of functional programming. Even C++ is.

Functional style is more or less a subset of imperative language features, supported with syntactic sugar and some compiler optimizations like immutability and tail-recursion flattening,

The latter arguably is a minor implementation-specific technicality and has nothing to do with the actual language. The x64 C# 4.0 compiler does tail-recursion optimization, whereas the x86 one doesn't for whatever stupid reason.

Syntactic sugar can usually be worked around to some extent or another, especially if the language has a programmable precompiler (i.e. C's #define).

It might be slightly more meaningful to ask, "does language __ support imperative programming?", and the answer, for instance with Lisp, is "no".

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-03T08:04:46.890

Please, have a look at the beginning of the book: ["A-Great-Ruby-eBook"](http://www.scribd.com/doc/230611/A-Great-Ruby-eBook). It discusses the very specific topic you are asking. You can do different types of programming in Ruby. If you want to program like functionally, you can do it. If you want to program like imperatively, you can do it. It is a definition question how functional Ruby in the end is. Please, see the reply by the user camflan.

# vb.net - VB.Net 自动化 MS Word 的拼写检查功能

> ID：159799
> 
> 赞同：1
> 
> 时间：2008-10-01T21:16:38.963
> 
> 标签：vb.net, winforms, office-2007, office-automation

当前正在开发的应用程序需要使用 MS Word 对应用程序中的某些文本区域执行拼写检查。

我目前有 Office 2007（即 Office 12 com 对象）。

我的问题是，如果我添加 Office 12 对象，那么在具有 Office 2003 的盒子上会发生什么？这既适用于其他开发盒，也适用于最终用户。

我是否认为最终结果将是这些用户无法使用拼写功能？如果我使用 Office 11 对象，这是否意味着如果用户安装了 Office 07，他们将无法执行拼写检查？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-02T05:12:12.970

我们放弃了尝试使用对 Word 的依赖，因为两者都安装了不同的版本或根本没有安装 Office！而是选择[NetSpell](http://www.codeproject.com/KB/string/netspell.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T21:41:19.170

我在这里猜测，但是如果您不能在 2003 安装中使用 2007 PIA（主互操作程序集），您可以尝试通过反射访问 PIA，因为我猜您想要的调用不会在二，然后没关系-您将使用已安装的任何一个。如果你也在安装 PIA，那么你可以让用户告诉你他们有哪些，或者更聪明一点，试试 2007，如果失败，试试 2003。

就像我说的，我猜这里但它可能值得一试。

编辑：我发现这个关于 Office PIA 的[链接。](http://blogs.msdn.com/excel/archive/2006/06/19/636534.aspx)这指的是 Excel，但实际上通常涵盖 Office。我不羡慕你的任务。看起来您需要检测 PIA（可能已安装也可能未安装）并采取相应措施。对我来说，这听起来像是一份反思的工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-05T20:42:26.993

较新版本的 Office 将保持与旧版本 COM 对象的大部分（如果不是全部）兼容性。这意味着如果您想针对 Office 2003 和 2007 进行编程，您将需要使用 Office 11 COM 对象作为依赖项，因为它们是 2003 发布时可用的最新版本。只要您确认您需要的方法在两个版本的 COM 对象中都存在，只要您使用较旧的 COM 对象，您就应该没有问题。

不幸的是，虽然我在自己的工作中使用了这个解决方案，但我还没有使用拼写检查对其进行测试。最后，请确保使用您希望集成的所有版本的 Office 测试您的代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-10T07:04:50.697

我对这个问题的直觉反应是简单地建议你走另一条路。尝试使用第 3 方拼写检查控件。它们相对便宜（您可能会发现一些免费控件）。至少通过这种方式，您可以控制应用程序中包含的控件的版本，并能够依赖它的功能。坦率地说，我很惊讶这个库还没有内置到 Windows 中。当然，Windows 支持的所有语言都很复杂，但现在就用户期望而言，它类似于复制/粘贴。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-25T06:20:07.230

您实际上可以打包在两个版本中工作所需的 office11 和 office12 互操作。这需要一些小工作，但我设法做到了。我在注册表中检查以查看要调用哪个互操作，然后使用正确的版本执行拼写检查。它甚至可以检查您是否安装了 Word，并引发错误警报，如果没有 Word，您将无法进行拼写检查。由于我们需要使用与 Office 绑定的医学词典，因此我们与使用 Word 息息相关。

搜索 interop 或 Com 包装器，我想你会发现你可以很容易地使用它们。

# python - Python 网络服务

> ID：159802
> 
> 赞同：3
> 
> 时间：2008-10-01T21:18:26.433
> 
> 标签：python, web-services

Elementree 已成为与 xml 交互的公认标准。当今使用的流行 Web 服务/SOAP 库是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T21:20:36.333

我不确定一个公认的标准，但我发现[SOAPpy](http://soapy.sourceforge.net/)是一个相当直接且有用的库，用于处理基于 SOAP 的 Web 服务。

> SOAPy 是 Python 的 SOAP/XML 模式库。给定 WSDL 或 SDL 文档，SOAPy 发现 Web 服务的已发布 API，并尽可能透明地将其公开给 Python 应用程序。

IBM 在其网站上提供了一个[很好的演练和示例](http://www.ibm.com/developerworks/library/ws-pyth5/)，用于开始使用 SOAPpy。

[SOAPpy 不再处于积极开发中，而是在Python Web 服务项目](http://pywebsvcs.sourceforge.net/)中被合并到 Zolera SOAP Infrastructure (ZSI) 中。然而，自去年 11 月以来，该项目也[没有太多活动。](http://sourceforge.net/projects/pywebsvcs)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T22:32:39.453

soaplib 非常易于使用并且似乎很活跃。

[http://web.archive.org/web/20090729125144/https://wiki.github.com/jkp/soaplib/](http://web.archive.org/web/20090729125144/https://wiki.github.com/jkp/soaplib/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-10-11T00:58:26.737

老问题，但对于其他提出这个问题的人来说，我在 suds 方面取得了很好的成功： [https ://fedorahosted.org/suds/](https://fedorahosted.org/suds/)

# iphone - 如何将 UITableView 滚动到不包含行的部分？

> ID：159821
> 
> 赞同：34
> 
> 时间：2008-10-01T21:21:57.127
> 
> 标签：iphone, cocoa-touch, scroll

在我正在开发的应用程序中，我有一个普通样式的 UITableView，它可以包含一个包含零行的部分。我希望能够使用 scrollToRowAtIndexPath:atScrollPosition:animated: 滚动到此部分，但由于缺少子行，当我尝试滚动到此部分时出现错误。

Apple 的日历应用程序能够做到这一点，如果您在列表视图中查看您的日历，并且您的日历中没有今天的事件，则会为今天插入一个空白部分，您可以使用工具栏中的“今天”按钮滚动到它在屏幕底部。据我所知，Apple 可能正在使用自定义的 UITableView，或者他们正在使用私有 API ...

我能想到的唯一解决方法是在 0 像素高的地方插入一个空的 UITableCell 并滚动到该位置。但据我了解，拥有不同高度的单元格对于滚动性能确实很不利。无论如何，我还是会尝试一下，也许性能不会太差。

**更新**

由于似乎没有解决方案，我已经向苹果提交了一个错误报告。如果这也影响到您，如果您希望更快地解决此问题，请提交 rdar://problem/6263339（[打开雷达链接）的副本。](http://openradar.appspot.com/radar?id=283)

**更新#2**

我对这个问题有一个不错的解决方法，看看我下面的答案。

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2008-12-08T22:07:18.607

更新：看起来这个错误在 iOS 3.0 中已修复。您可以使用以下内容`NSIndexPath`滚动到包含 0 行的部分：

```
[NSIndexPath indexPathForRow:NSNotFound inSection:section] 
```

对于仍在使用 2.x SDK 维护项目的任何人，我将把我原来的解决方法留在这里。

* * *

找到了一个不错的解决方法：

```
CGRect sectionRect = [tableView rectForSection:indexOfSectionToScrollTo];
[tableView scrollRectToVisible:sectionRect animated:YES]; 
```

上面的代码将滚动表格视图，以便所需部分可见，但不一定位于可见区域的顶部或底部。如果要滚动以使该部分位于顶部，请执行以下操作：

```
CGRect sectionRect = [tableView rectForSection:indexOfSectionToScrollTo];
sectionRect.size.height = tableView.frame.size.height;
[tableView scrollRectToVisible:sectionRect animated:YES]; 
```

根据需要修改 sectionRect 以将所需部分滚动到可见区域的底部或中间。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2019-04-25T06:44:35.120

如果您的部分没有行，请使用此

```
let indexPath = IndexPath(row: NSNotFound, section: section)
tableView.scrollToRow(at: indexPath, at: .middle, animated: true) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-05-28T10:01:45.513

这是一个老问题，但 Apple 仍然没有添加任何有助于或修复该部分没有行的崩溃错误的任何内容。

对我来说，我确实需要在添加时将新部分滚动到中间，所以我现在使用以下代码：

```
if (rowCount > 0) {
    [self.tableView scrollToRowAtIndexPath: [NSIndexPath indexPathForRow: 0 inSection: sectionIndexForNewFolder] 
                          atScrollPosition: UITableViewScrollPositionMiddle
                                  animated: TRUE];
} else { 
    CGRect sectionRect = [self.tableView rectForSection: sectionIndexForNewFolder];
    // Try to get a full-height rect which is centred on the sectionRect
    // This produces a very similar effect to UITableViewScrollPositionMiddle.
    CGFloat extraHeightToAdd = sectionRect.size.height - self.tableView.frame.size.height;
    sectionRect.origin.y -= extraHeightToAdd * 0.5f;
    sectionRect.size.height += extraHeightToAdd;
    [self.tableView scrollRectToVisible:sectionRect animated:YES];
} 
```

希望你喜欢它——正如你所看到的，它基于 Mike Akers 的代码，但是计算滚动到中间而不是顶部。谢谢迈克-你是明星。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2018-01-10T05:16:53.317

一个 Swift 的方法：

```
if rows > 0 {
    let indexPath = IndexPath(row: 0, section: section)
    self.tableView.setContentOffset(CGPoint.zero, animated: true)
    self.tableView.scrollToRow(at: indexPath, at: .top, animated: true)
}

else {
    let sectionRect : CGRect = tableView.rect(forSection: section)
    tableView.scrollRectToVisible(sectionRect, animated: true)
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2020-02-24T11:32:10.257

由于使用：

```
[NSIndexPath indexPathForRow:NSNotFound inSection:EXAMPLE] 
```

在 Xcode 11.3.1（iOS 模拟器 - 13.3）中为我损坏了我决定使用：

```
NSUInteger index = [self.sectionTypes indexOfObject:@(EXAMPLE)];
if (index != NSNotFound) {
    CGRect rect = [self.tableView rectForSection:index];
    [self.tableView scrollRectToVisible:rect animated:YES];
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-01T21:30:07.857

我认为空白行可能是去那里的唯一方法。是否可以重新设计 UI，使“空”行可以显示有用的内容？

我说试试看，看看性能如何。他们对在列表项中使用透明子视图给出了非常可怕的警告，而且我发现它在我的应用程序中并没有那么重要。

# windows - 确定远程 Windows 机器上的登录用户

> ID：159837
> 
> 赞同：1
> 
> 时间：2008-10-01T21:27:15.773
> 
> 标签：windows, administration

有没有办法在给定机器的 IP 地址（或工作站名称）的情况下确定谁登录到特定（远程）机器？

*   有问题的机器位于 Active Directory 域中
*   运行脚本的用户可能在他们的本地或远程计算机上没有任何特殊权限
*   操作系统是Windows XP

任何编程语言都可以，但理想情况下

*   VBScript（是的，我知道）
*   C＃
*   爪哇
*   DOS批处理文件

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-01T21:32:16.617

SysInternals 的 PSloggedon 将从批处理文件中提供此信息，但是用户需要远程计算机上的管理员访问权限。我怀疑您可以在没有管理员访问权限的情况下获取此信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-01T21:32:15.447

根据机器上的许可，很难做到。一种方法是查询远程计算机上的 WMI 并检查 explorer.exe 进程的所有者。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-02T15:48:21.180

您不需要管理员访问权限。只需使用网络 API。在 news://194.177.96.26/comp.os.ms-windows.programmer.win32 上询问常见问题解答

# .net - 是否可以在外部 javascript 文件中插入我的尖括号百分比等于 <%= %> 语法？

> ID：159842
> 
> 赞同：5
> 
> 时间：2008-10-01T21:27:59.577
> 
> 标签：.net, javascript, jquery

通常在将 jQuery 与 asp.net 混合时，我需要在 jQuery 选择器中使用 asp .net 尖括号百分比 <% %> 语法。

如果我想将 JavaScript 从标记中分离到不同的文件中，是否还有一种方法可以评估我的 JavaScript 文件，以便在到达客户端浏览器之前插入尖括号百分比？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-01T21:34:33.010

如果您想`<% code blocks %>`在 JavaScript 文件中评估为 ASP.NET 代码，只需将 JavaScript 放在 ASPX 文件中并从 SCRIPT 元素中引用它。

`script.js.aspx`：

```
function hideElements()
 { <% foreach(var elementId in Request.QueryString["hide"].Split(',') { %>
   jQuery('#' + <%= elementId %>).hide('slow');
   <% } %>
 } 
```

`page.aspx`：

```
<script src="script.js.aspx?hide=<%= GetElementsIds() %>"
        type='text/javascript'></script> 
```

`page.aspx.cs`：

```
public string GetElementIds() 
 {
   return string.Join(",", new []{control1.ClientID, control2.ClientID});
 } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T21:33:02.140

不，您需要重构 JavaScript 以接受该信息作为参数。

所以，而不是

```
jQuery('#<%=MainPanel.ClientId%>').hide('slow'); 
```

做这样的事情：

```
function hidePanel(panelId) {
        jQuery('#' + panelId).hide('slow');
} 
```

您可以从您的页面调用

```
hidePanel('<%=MainPanel.ClientId%>'); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-03T15:00:27.403

我尝试将搜索网格用户控件上的 javascript 与 .ascx 文件中的 html 分开。在第一次迭代中，我使用了 jQuery(document).onReady 函数来附加我的初始化。

问题在于 jQuery 选择器中使用的 <%= %> 标记未正确插入，并且 jQuery 选择器未找到 javascript 所作用的控件。

接下来，我尝试在 Page 初始化中创建一个 json 对象，并使用 asp.net 方法 Page.ClientScript.RegisterClientScriptBlock 将其写出来。这工作正常，但有缺点：在 asp.net 文件和 javascript 文件中硬连接 json 对象的名称和键。这是不利的，因为现在存在“两个事实点”需要维护，而且在最终呈现的页面中存在名称冲突的可能性。

在 asp .net 中并利用 jQuery 的最优雅的解决方案是在 javascript 中创建 ajax 脚本行为。然后在 asp 代码隐藏中，在 IScriptControl 接口的 GetScriptDescriptors() 方法中注册脚本行为的属性，将服务器端控件的 ClientID 作为属性添加到脚本描述符中。

```
// Ajax Javacsript Code below:

Type.registerNamespace('SearchGrid');

// Define the behavior properties
//
ButtonBehavior = function() {
    ButtonBehavior.initializeBase(this);
    this._lnkSearchID = null;
}

// Create the prototype for the behavior
//
//
SearchGrid.ButtonBehavior.prototype = {
initialize: function() {
    SearchGrid.ButtonBehavior.callBaseMethod(this, 'initialize');
    jQuery('#' + this._lnkSearchID).click(function() { alert('We clicked!'); });
},

dispose: function() {
    SearchGrid.ButtonBehavior.callBaseMethod(this, 'dispose');
    jQuery('#' + this._lnkSearchID).unbind();
    }
}

// Register the class as a type that inherits from Sys.Component.
SearchGrid.ButtonBehavior.registerClass('SearchGrid.ButtonBehavior', Sys.Component);

if (typeof (Sys) !== 'undefined') Sys.Application.notifyScriptLoaded(); 
```

* * *

Asp .Net 代码如下：

```
 public partial class SearchGrid : System.Web.UI.UserControl, IScriptControl
    {        
        // Initialization    
        protected override void OnPreRender(EventArgs e)
        {
            if (!this.DesignMode)
            {
                // Test for ScriptManager and register if it exists
                ScriptManager sm = ScriptManager.GetCurrent(Page);    
                if (sm == null)
                    throw new ApplicationException("A ScriptManager control must exist on the current page.");    
                sm.RegisterScriptControl(this);
            }    
            base.OnPreRender(e);
        }
        protected override void Render(HtmlTextWriter writer)
        {
            if (!this.DesignMode)
                sm.RegisterScriptDescriptors(this);

            base.Render(writer);
        }

        // IScriptControl Members
        public IEnumerable<ScriptDescriptor> GetScriptDescriptors()
        {
            ScriptBehaviorDescriptor desc = new ScriptBehaviorDescriptor("SearchGrid.ButtonBehavior", this.ClientID);         
            desc.AddProperty("lnkSearchID", this.lnkSearch.ClientID);
            yield return desc;
        }

        public IEnumerable<ScriptReference> GetScriptReferences()
        {
            ScriptReference reference = new ScriptReference();
            reference.Path = ResolveClientUrl("SearchGrid.ButtonBehavior.js");
            return new ScriptReference[] { reference };
        }       
    } 
```

* * *

此处的优点是，您可以创建独立的可重用控件，其 JavaScript 行为包含在其自己的单独文件（或作为 Web 资源）中，同时传递状态和上下文，否则可能会使用角度、百分比、等于语法进行插值，这是必要的jQuery 来完成它的工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T22:38:56.177

You could also handle .js files as .aspx files; this way you won't lose intellisense and code formatting while you're editing them. Just add this to web.config:

```
<system.webServer>
    <handlers>
       <add name="Dynamic JS" path="*.js" verb="*" type="System.Web.UI.PageHandlerFactory" resourceType="Unspecified"/> 
```

# java - UnsatisfiedLinkError：找不到指定的过程

> ID：159846
> 
> 赞同：13
> 
> 时间：2008-10-01T21:28:31.853
> 
> 标签：java, java-native-interface

我正在用 C++ 编写一些 JNI 代码，以便从 Windows XP 上的小程序中调用。我已经能够成功地运行小程序并加载和调用 JNI 库，甚至可以让它调用其他 DLL 中的函数。我通过设置 PATH 系统环境变量来包含我所有的 DLL 所在的目录来实现这一点。

所以，问题是我添加了另一个使用新外部 DLL 的调用，并且在加载库时突然抛出 UnsatisfiedLinkError。消息是：“找不到指定的过程”。这似乎不是缺少依赖 DLL 的问题，因为我可以删除依赖 DLL 并获得有关缺少依赖 DLL 的不同消息。从我在网上找到的信息来看，这条消息似乎意味着 DLL 中缺少本机 Java 函数实现，但奇怪的是，如果没有这些额外的代码，它可以正常工作。

有谁知道这可能是什么原因造成的？对于 UnsatisifedLinkError，什么样的事情可以给出“找不到指定的过程”消息？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-07T21:47:12.510

我解决了这个问题。这真是太棒了。UnsatisfiedLinkError 的消息“找不到指定的过程”表示找不到根 dll 或**依赖 dll**中的函数。在 JNI 情况下，最可能的原因是未正确导出本机 JNI 函数。但是，如果加载了依赖 DLL 并且该 DLL 缺少其父级所需的函数，则显然会发生这种情况。

例如，我们有一个名为 input.dll 的库。DLL 搜索顺序是始终首先查找应用程序目录，最后查找 PATH 目录。过去，我们总是从与 input.dll 相同的目录中运行可执行文件。但是，windows系统目录下还有另一个input.dll（在DLL搜索顺序的中间）。因此，当从 java 小程序运行它时，如果我在小程序中包含上述代码，这会导致加载 input.dll，它会从系统目录加载 input.dll。因为我们的代码需要 input.dll 中不存在的某些函数（因为它是不同的 DLL），所以加载失败并显示有关缺少过程的错误消息。不是因为 JNI 函数导出错误，而是因为加载了错误的依赖 DLL 而它没有

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-01T23:10:00.813

DLL 有可能是使用 C++（而不是 C）构建的。除非您注意对程序进行 extern，否则这是可能的原因之一。

尝试从 DLL 中导出所有函数。如果列表包含您的功能，那么您很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T21:31:13.033

通常，在链接其他库时，需要链接到相关的 .lib 文件。听起来您没有引用所需的所有 lib 文件。检查未链接的内容并确保将其 lib 添加到链接器的列表中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T01:03:29.147

您是否使用标准 JNI 过程创建了新的外部 DLL？即，使用 javah 等等？如果是这样，那么我不确定出了什么问题。

如果没有，那么您尝试调用的过程尚未导出（如 anjanb 所述）。我知道导出函数的两种方式：单独的导出列表和使用 __declspec(dllexport) 标记特定函数。

[无法从 C 应用程序访问 C++ DLL 中的变量](https://stackoverflow.com/questions/56500/cant-access-variable-in-c-dll-from-a-c-app#56513)有更多关于 DLL 主题的信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-20T12:30:17.073

在调试模式下编译您的 c++ 代码。然后插入 DebugBreak(); 您要开始调试的语句。运行java代码。当遇到 DebugBreak() 语句时，您将看到一个带有 Debug 按钮的弹出窗口。点击它。Dev Studio 将以机器代码打开您的程序。使用调试器跳过两次，您应该能够跳过您的源代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-01-15T12:21:45.380

如果您在 JNI 手册和示例中完成了所有编程问题，但仍然遇到相同的缺失程序错误，则问题可能出在您的路径变量上。执行以下步骤并再次运行：

1.  确保将 JAVA_HOME 变量设置为 JDK 文件夹（不是 JRE，因为 JRE 不包含 jni 标头） 示例： *在环境变量设置面板中定义 var:JAVA_HOME val:C:\Program Files\Java\jdk1.7.0_11*
2.  将**%JAVA_HOME%\bin**添加到路径变量

完成这些步骤后，您的应用程序可以找到 jni 过程名称并以正确的方式链接到 JNI.dll。所以，我希望你不会再遇到这个丢失的程序错误。

# svn - 颠覆差异，包括新文件

> ID：159853
> 
> 赞同：20
> 
> 时间：2008-10-01T21:30:04.440
> 
> 标签：svn, patch

我对使用 Subversion 作为其源代码控制的开源项目进行了一些本地更改。（我没有原始项目存储库的提交访问权限。）

我的更改添加了一个文件，但该文件不包含在“svn diff”的输出中。（可能值得注意的是，新文件是二进制文件，而不是纯文本。）

如何制作包含新文件的[补丁？](http://en.wikipedia.org/wiki/Patch_(Unix))

* * *

```
 $ svn st
   A      tests/foo.zip
 $ svn diff
 $ 
```

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2010-02-12T23:46:35.700

我经历了与 Pozsar 类似的行为。他的回答比普通的 svn diff --force 更适合我。但是，如果在 DOS 机器上运行（例如通过 Cygwin），您可能需要稍微修改他的答案。以下 diff + patch 用于使用 --binary arg 在 Cygwin 中修补我的文本 + 二进制文件：

```
svn diff --force --diff-cmd /usr/bin/diff -x "-au --binary" OLD-URL NEW-URL > mybinarydiff.diff

patch -p0 --binary -i mybinarydiff.diff 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-06-26T21:42:41.553

diff 命令有一个 --force 选项，但它为我的机器上的二进制文件生成了一个不正确的补丁文件。不过，将它与 --diff-cmd 选项一起使用对我有用：

```
svn diff --force --diff-cmd /usr/bin/diff -x -au 
```

我认为这正是你想要的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-01T22:20:27.923

恐怕您的文件是二进制文件的事实正是它不显示的原因。Subversion 的 diff 命令只执行文本差异/补丁（即使 Subversion 内部可以有效地处理版本之间的二进制文件差异）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T21:33:44.260

如果您正在构建补丁，您可能希望使用带有 --new-file 选项的普通旧 'diff' 选项，它将丢失的文件视为空文件。

请注意，此选项的语法实际上可能会有所不同，具体取决于您使用的普通旧差异版本。

# .net - NUnit 测试项目的 log4net 配置部分

> ID：159856
> 
> 赞同：6
> 
> 时间：2008-10-01T21:30:33.470
> 
> 标签：.net, configuration, nunit, log4net

我正在使用名为 AssemblyTest.nunit 的项目运行 NUnit。该测试调用另一个使用 log4net 程序集的程序集。这是使用带有 .net 2.0 框架的 nunit 版本 2.4.3。

在 TestFixtureSetup 中，我正在调用 log4net.Config.XmlConfigurator.Configure( ) 并收到以下错误：

```
System.Configuration.ConfigurationErrorsException：配置系统初始化失败---> System.Configuration.ConfigurationErrorsException：无法识别的配置部分log4net。（C:\path\to\assembly.dll.config 第 7 行）

```

有没有办法在不将配置文件重命名为“AssemblyTest.config”的情况下解决这个问题？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-01-27T10:58:03.037

我遇到了同样的问题，因为我忘记在*configSections*元素中添加*log4net*定义。

 *因此，如果要将*log4net*元素放入 app.config 中，则需要在配置文件的顶部包含*configSections*元素（它告诉*log4net元素的定义位置）。*

试试这样：

```
<configuration>
  <configSections>
    <section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler, log4net" />
  </configSections>
  <log4net>
  ...
  </log4net>
</configuration> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-10-30T02:17:01.173

我不知道为什么你们被困在配置文件中，对于 nunit，如果您想在 nunit 测试运行器的文本输出窗口中查看运行的日志，您需要做的就是遵循代码行，

```
BasicConfigurator.Configure(); 
```

最好添加这一行是Test类的构造函数

例如

```
[TestFixture]
    public class MyTest
    {
        log4net.ILog log = log4net.LogManager.GetLogger(typeof(MyTest));

        public MyTest()
        {
            BasicConfigurator.Configure();
        }

        [SetUp]
        public void SetUp()
        {
           log.Debug(">SetUp");               
        }

        [TearDown]
        public void TearDown()
        {
            log.Debug(">TearDown");
        }

        [Test]
        public void TestNothing()
        {
            log.Debug(">TestNothing");
        }
    } 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-02T14:44:09.680

使用根元素 log4net 为 log4net 创建一个单独的配置文件。

在 TestFixtureSetup 中，为此配置文件创建一个 FileInfo 对象，并将其作为参数提供给 log4net.Config.XmlConfigurator.Configure( )。

# visual-studio - 如何在 Visual Studio 2008 中对我的代码（按方法名称）进行排序？

> ID：159862
> 
> 赞同：12
> 
> 时间：2008-10-01T21:32:37.617
> 
> 标签：visual-studio

除了剪切和粘贴之外，有没有办法在 Visual Studio 2008 中对我的类中的方法进行排序？我喜欢有序的代码。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-01T21:41:07.143

这是一个免费插件，可以满足您的要求：[http ://www.visualstudiogallery.com/ExtensionDetails.aspx?ExtensionID=800978aa-2aac-4440-8bdf-6d1a76a5c23c](http://www.visualstudiogallery.com/ExtensionDetails.aspx?ExtensionID=800978aa-2aac-4440-8bdf-6d1a76a5c23c)

### 更新

不幸的是，该链接已过时。[您可以在http://www.rauchy.net/regionerate/docs/2007/05/download.html](http://www.rauchy.net/regionerate/docs/2007/05/download.html)下载 Regionerate

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-03-29T16:50:23.513

如果您使用 Resharper，您可以更改 Type Members Layout 模板，以便它按您喜欢的方式对您的代码进行排序。请参阅 Resharper>Options>Languages>C#>Type Members Layout。 [替代文字 http://www.jetbrains.com/resharper/features/screenshots/40/automatic_member_layout_full.png](http://www.jetbrains.com/resharper/features/screenshots/40/automatic_member_layout_full.png)

例如，您可以在文件中将具有特定属性的方法放在首位...例如，标有 NUnit 的 [Setup] 和 [TearDown] 的方法可以放在标有 [Test] 的方法之前，方法是放置如下块：

```
<!--Fixture Setup/Teardown-->
<Entry>
  <Match>
    <And>
      <Kind Is="method"/>
      <Or>
        <HasAttribute CLRName="NUnit.Framework.TestFixtureSetUpAttribute" Inherit="true"/>
        <HasAttribute CLRName="NUnit.Framework.TestFixtureTearDownAttribute" Inherit="true"/>
      </Or>
    </And>
  </Match>
 </Entry> 
```

前：

```
<!--Test methods-->
<Entry>
  <Match>
    <And Weight="100">
      <Kind Is="method"/>
      <HasAttribute CLRName="NUnit.Framework.TestAttribute" Inherit="false"/>
    </And>
  </Match>
  <Sort>
    <Name/>
  </Sort>
</Entry> 
```

然后对其他所有内容都有一个包罗万象：

```
<!--All other members-->
<Entry>
  <Sort>
    <Name/>
  </Sort>
</Entry> 
```

模板系统非常强大，应该可以满足您的需求。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T21:33:45.367

您可能会找到或能够制作一个宏来执行此操作，但是 VS 没有内置功能来对您的方法进行排序。一些第三方生产力工具，如[Resharper](http://www.jetbrains.com/resharper/)和[CodeRush](http://www.devexpress.com/Products/Visual_Studio_Add-in/Coding_Assistance/) ，提供了一些重新排序代码的功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T21:34:51.823

ReSharper 具有[代码重新排序](http://www.jetbrains.com/resharper/features/coding_assistance.html#Code_Reordering)功能和[文件结构](http://www.jetbrains.com/resharper/features/navigation_search.html#File_Structure)视图，可让您进行拖放重新排序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T21:36:56.000

Resharper 会以有限的方式做好工作。这取决于你想要多少。例如，它不会根据生命周期或类似的东西在 asp.net 页面中重新排序您的覆盖，但它会保留属性、字段、方法和未明确分组的内容

编辑：顺便说一下，我指的是自动重新排序，也就是重新格式化。

# c# - .Net 中的同步列表视图

> ID：159864
> 
> 赞同：4
> 
> 时间：2008-10-01T21:32:46.600
> 
> 标签：c#, .net, winforms, winapi, listview

我正在开发一个控件，将视图从一个 ListView 绑定到另一个，以便在滚动主 ListView 时，更新子 ListView 视图以匹配。

到目前为止，当单击主滚动条按钮时，我已经能够让子 ListViews 更新他们的视图。问题是当单击并拖动 ScrollBar 本身时，子 ListViews 没有更新。我查看了使用 Spy++ 发送的消息，并且发送了正确的消息。

这是我当前的代码：

```
public partial class LinkedListViewControl : ListView
{
    [DllImport("User32.dll")]
    private static extern bool SendMessage(IntPtr hwnd, UInt32 msg, IntPtr wParam, IntPtr lParam);

    [DllImport("User32.dll")]
    private static extern bool ShowScrollBar(IntPtr hwnd, int wBar, bool bShow);

    [DllImport("user32.dll")]
    private static extern int SetScrollPos(IntPtr hWnd, int wBar, int nPos, bool bRedraw);

    private const int WM_HSCROLL = 0x114;

    private const int SB_HORZ = 0;
    private const int SB_VERT = 1;
    private const int SB_CTL = 2;
    private const int SB_BOTH = 3;
    private const int SB_THUMBPOSITION = 4;
    private const int SB_THUMBTRACK = 5;
    private const int SB_ENDSCROLL = 8;

    public LinkedListViewControl()
    {
        InitializeComponent();
    }

    private readonly List<ListView> _linkedListViews = new List<ListView>();

    public void AddLinkedView(ListView listView)
    {
        if (!_linkedListViews.Contains(listView))
        {
            _linkedListViews.Add(listView);

            HideScrollBar(listView);
        }
    }

    public bool RemoveLinkedView(ListView listView)
    {
        return _linkedListViews.Remove(listView);
    }

    private void HideScrollBar(ListView listView)
    {
        //Make sure the list view is scrollable
        listView.Scrollable = true;

        //Then hide the scroll bar
        ShowScrollBar(listView.Handle, SB_BOTH, false);
    }

    protected override void WndProc(ref Message msg)
    {
        if (_linkedListViews.Count > 0)
        {
            //Look for WM_HSCROLL messages
            if (msg.Msg == WM_HSCROLL)
            {
                foreach (ListView view in _linkedListViews)
                {
                    SendMessage(view.Handle, WM_HSCROLL, msg.WParam, IntPtr.Zero);
                }
            }
        }
    }
} 
```

根据 MS 技术论坛上的[这篇文章](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3111420&SiteID=1)，我尝试捕获和处理 SB_THUMBTRACK 事件：

```
 protected override void WndProc(ref Message msg)
    {
        if (_linkedListViews.Count > 0)
        {
            //Look for WM_HSCROLL messages
            if (msg.Msg == WM_HSCROLL)
            {
                Int16 hi = (Int16)((int)msg.WParam >> 16);
                Int16 lo = (Int16)msg.WParam;

                foreach (ListView view in _linkedListViews)
                {
                    if (lo == SB_THUMBTRACK)
                    {
                        SetScrollPos(view.Handle, SB_HORZ, hi, true);

                        int wParam = 4 + 0x10000 * hi;
                        SendMessage(view.Handle, WM_HSCROLL, (IntPtr)(wParam), IntPtr.Zero);
                    }
                    else
                    {
                        SendMessage(view.Handle, WM_HSCROLL, msg.WParam, IntPtr.Zero);
                    }
                }
            }
        }

        // Pass message to default handler.
        base.WndProc(ref msg);
    } 
```

这将更新子 ListView ScrollBar 的位置，但不会更改子视图中的实际视图。

所以我的问题是：

1.  拖动主 ListView ScrollBar 时是否可以更新子 ListViews？
2.  如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-09T14:18:13.797

我想做同样的事情，在四处搜索后，我在这里找到了你的代码，这有帮助，但当然没有解决问题。但是在玩了它之后，我找到了解决方案。

当我意识到由于滚动按钮起作用时，关键就来了，您可以使用它来使滑块起作用。换句话说，当 SB_THUMBTRACK 事件到来时，我会发出重复的 SB_LINELEFT 和 SB_LINERIGHT 事件，直到我的子 ListView 接近主人所在的位置。是的，这并不完美，但它足够接近。

就我而言，我的主 ListView 称为“reportView”，而我的子 ListView 称为“summaryView”。这是我的相关代码：

```
public class MyListView : ListView
{
    public event ScrollEventHandler HScrollEvent;

    protected override void WndProc(ref System.Windows.Forms.Message msg) 
    {
        if (msg.Msg==WM_HSCROLL && HScrollEvent != null)
            HScrollEvent(this,new ScrollEventArgs(ScrollEventType.ThumbTrack, (int)msg.WParam));

        base.WndProc(ref msg);
    }
} 
```

然后是事件处理程序本身：

```
reportView.HScrollEvent += new ScrollEventHandler((sender,e) => {
    if ((ushort) e.NewValue != SB_THUMBTRACK)
        SendMessage(summaryView.Handle, WM_HSCROLL, (IntPtr) e.NewValue, IntPtr.Zero);
    else {
        int newPos = e.NewValue >> 16;
        int oldPos = GetScrollPos(reportView .Handle, SB_HORZ);                 
        int pos    = GetScrollPos(summaryView.Handle, SB_HORZ);
        int lst;

        if (pos != newPos)
            if      (pos<newPos && oldPos<newPos) do { lst=pos; SendMessage(summaryView.Handle,WM_HSCROLL,(IntPtr)SB_LINERIGHT,IntPtr.Zero); } while ((pos=GetScrollPos(summaryView.Handle,SB_HORZ)) < newPos && pos!=lst);
            else if (pos>newPos && oldPos>newPos) do { lst=pos; SendMessage(summaryView.Handle,WM_HSCROLL,(IntPtr)SB_LINELEFT, IntPtr.Zero); } while ((pos=GetScrollPos(summaryView.Handle,SB_HORZ)) > newPos && pos!=lst);
        }
    }); 
```

很抱歉那里的 while 循环的格式很奇怪，但这就是我喜欢这样编写代码的方式。

下一个问题是摆脱子 ListView 中的滚动条。我注意到您有一个名为 HideScrollBar 的方法。这对我来说真的不起作用。在我的情况下，我发现一个更好的解决方案是将滚动条留在那里，而是“覆盖”它。我也对列标题执行此操作。我只是将我的子控件向上滑动到主控件下以覆盖列标题。然后我拉伸孩子从包含它的面板上掉下来。然后为了在包含面板的边缘提供一点边框，我投入了一个控件来覆盖我的子 ListView 的可见底部边缘。它最终看起来相当不错。

我还添加了一个事件处理程序来同步更改列宽，如下所示：

```
reportView.ColumnWidthChanging += new ColumnWidthChangingEventHandler((sender,e) => {
    summaryView.Columns[e.ColumnIndex].Width = e.NewWidth;
    }); 
```

虽然这一切看起来有点杂乱无章，但它对我有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T14:18:51.777

这只是为了让精神汁液流动而进行的猜想，因此请随心所欲：在主列表的滚动处理程序中，您可以调用子列表的滚动处理程序（从主列表传递发送者和事件参数）吗？

将此添加到您的表单加载中：

```
masterList.Scroll += new ScrollEventHandler(this.masterList_scroll); 
```

其中引用了这个：

```
private void masterList_scroll(Object sender, System.ScrollEventArgs e)
{
    childList_scroll(sender, e);
}

private void childList_scroll(Object sender, System.ScrollEventArgs e)
{
   childList.value = e.NewValue
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-06T18:23:22.467

我将创建自己的类，从 ListView 继承以公开垂直和水平滚动事件。

然后我会在我的表单中创建滚动处理程序来同步两个控件

这是应该允许列表视图发布滚动事件的示例代码：

```
public class MyListView : System.Windows.Forms.ListView
{
    const int WM_HSCROLL = 0x0114;
    const int WM_VSCROLL = 0x0115;

    private ScrollEventHandler evtHScroll_m;
    private ScrollEventHandler evtVScroll_m;

    public event ScrollEventHandler OnHScroll
    {
        add
        {
            evtHScroll_m += value;
        }
        remove
        {
            evtHScroll_m -= value;
        }
    }

    public event ScrollEventHandler OnHVcroll
    {
        add
        {
            evtVScroll_m += value;
        }
        remove
        {
            evtVScroll_m -= value;
        }
    }

    protected override void WndProc(ref System.Windows.Forms.Message msg) 
    { 
        if (msg.Msg == WM_HSCROLL && evtHScroll_m != null) 
            {
            evtHScroll_m(this,new ScrollEventArgs(ScrollEventType.ThumbTrack, msg.WParam.ToInt32()));
            }

        if (msg.Msg == WM_VSCROLL && evtVScroll_m != null)  
        {
            evtVScroll_m(this, new ScrollEventArgs(ScrollEventType.ThumbTrack, msg.WParam.ToInt32()));
        }
        base.WndProc(ref msg); 
    } 
```

现在处理表单中的滚动事件：

设置一个 PInvoke 方法，以便能够向控件发送 Windows 消息：

```
[DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    public static extern int SendMessage(IntPtr hWnd, [MarshalAs(UnmanagedType.U4)] int iMsg, int iWParam, int iLParam); 
```

设置您的事件处理程序（lstMaster 和 lstChild 是两个列表框）：

```
lstMaster.OnVScroll += new ScrollEventHandler(this.lstMaster_OnVScroll);
lstMaster.OnHScroll += new ScrollEventHandler(this.lstMaster_OnHScroll);

const int WM_HSCROLL = 0x0114;      
const int WM_VSCROLL = 0x0115;  

private void lstMaster_OnVScroll(Object sender, System.ScrollEventArgs e)
{    
    SendMessage(lstChild.Handle,WM_VSCROLL,(IntPtr)e.NewValue, IntPtr.Zero); 
}

private void  lstMaster_OnHScroll(Object sender, System.ScrollEventArgs e)
{   
    SendMessage(lstChild.Handle,WM_HSCROLL,(IntPtr)e.NewValue, IntPtr.Zero); 
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-03T09:17:24.110

您的问题的一个简单的解决方案是在父列表视图中处理绘制消息并检查链接列表视图是否显示正确的数据。如果没有，则通过调用 EnsureVisible 方法更新它们以显示正确的数据。

# tfs - 从 SourceSafe 到 Team Foundation Server

> ID：159869
> 
> 赞同：12
> 
> 时间：2008-10-01T21:33:47.877
> 
> 标签：tfs, visual-sourcesafe, tfs-migration

我们的团队希望从 Visual SourceSafe (VSS) 迁移到 Team Foundation Server (TFS)。我知道 TFS 不仅仅是一个版本控制系统，但我还是第一次想以这种方式使用它。

目前，我们的项目组织在由共享部分（公共库）和许多客户项目组成的单一解决方案中。

是否有某种迁移指南可以描述这样的挑战？还是 TFS 强制执行其自己的使用场景（项目版本控制、发布等）？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-02T09:18:16.093

TFS 肯定比仅仅作为一个源存储库有更多的潜力，但是你为什么要首先迁移源控制是完全可以理解的。

选择的迁移实用程序通常是[VSSConverter.exe ，它允许您将 VSS 路径映射到 Team Project 源代码控制路径，并且在](http://msdn.microsoft.com/en-us/library/ms253090(VS.80).aspx)[此](http://msdn.microsoft.com/en-us/library/ms181247(VS.80).aspx)演练中有很好的记录。

CodePlex 上还有另一个工具（[TFS 迁移和同步工具包](http://www.codeplex.com/MigrationSyncToolkit)），但是当我比较这两者时，我确定 VSSConverter 已被更广泛地使用，并且我认为它被普遍接受为 VSS 迁移的首选工具。

似乎这里还有[关于这个线程](https://stackoverflow.com/questions/29838/visual-source-safe-tfs-migration)的更多答案。

现在，我认为您**真正**要问的问题更多是关于创建团队项目和结构化的指导？

在不了解您的具体情况的情况下，这有点难以回答。Patterns and Practices[在 CodePlex 上出版了一本名为 TFS 指南的书，](http://www.codeplex.com/TFSGuide)这可能会有所帮助 - 它描述了很多东西，其中包括建议的团队项目源代码控制结构。它可能有助于为您提供有关如何迁移和/或重新映射解决方案结构的指导。

关于版本控制和分支，请在[此处查看此站点的分支指南](http://www.codeplex.com/BranchingGuidance)- 它对使用 TFS 的一些常见分支/发布管理技术进行了不错的概述。

如果您通读了所有这些内容，您将真正掌握大部分基本的 TFS 基础知识！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-01T22:00:15.413

（请随意对我投反对票，但是...）如果您追求更好的源代码控制，那么 TFS 恕我直言是矫枉过正。我建议您查看 Subversion。[VisualSVN](http://www.visualsvn.com/)是一个极好的（49 美元）Visual Studio 插件，可以与可以说是最好的 SVN 客户端[TortoiseSVN](http://tortoisesvn.net)无缝协作。此外，它们还提供了一个免费的、易于设置的 Windows 软件包，其中包含 Subversion 服务器端的东西，称为 VisualSVN Server。

要了解有关 Subversion 工作方式的所有信息，请参阅伟大的[Red Bean 书](http://svnbook.red-bean.com/)。

（不隶属于 VisualSVN，只是一个 Subversion 粉丝）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-01T21:42:33.223

TFS 和 VSS 是完全不同的野兽。

也就是说，从 VSS 迁移到 TFS 的主要问题通常在开发人员的脑海中。

查看以下博客：

[从 VSS 用户的角度来看 TFS：http://blogs.msdn.com/robcaron/archive/2006/10/29/901115.aspx](http://blogs.msdn.com/robcaron/archive/2006/10/29/901115.aspx)

当然，原来的 [http://sstjean.blogspot.com/2006/10/document-from-vss-to-tfs-introduction.html](http://sstjean.blogspot.com/2006/10/document-from-vss-to-tfs-introduction.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-04T09:19:23.800

当我们从 Sourcesafe 切换到 TFS2005 时，最大的障碍是 Sourcesafe 的共享文件、“Get latest on checkout”方法和 Sourcesafe 中的分支/合并“支持”。每个人都害怕在 Sourcesafe 中进行分支和合并，并且花了一些时间让所有同事相信 TFS 并没有那么糟糕。

我们决定不从 Sourcesafe 迁移文件。我们将 TFS2005 用于一个新项目，并将旧的东西保存在 Sourcesafe 中。我们不想保留多年来增长且相当无组织的项目和文件夹结构。

旧东西现在已成为历史，我们使用 TFS2008 进行所有开发工作。

# asp.net - SqlMembershipProvider 初始化方法未被调用

> ID：159875
> 
> 赞同：0
> 
> 时间：2008-10-01T21:36:15.003
> 
> 标签：asp.net, membership-provider, sqlmembershipprovider

我已经完成了 MembershipProvider 的自定义实现，但由于某种原因，初始化方法没有被调用，因此我的提供者没有从配置参数正确设置，谁首先调用它，我如何让它工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-01T21:53:51.293

I assume this is an ASP.NET application. Do you have a reference to your membership provider in your web.config (it can also be in your machine.config, but this is lesser used)?

You should have something like the following in the system.web section of your web.config:

```
<membership defaultProvider="MyCustomMembershipProvider">
    <providers>
        <clear/>
        <add
            name="MyCustomMembershipProvider"
            type="MyNamespace.MyCustomMembershipProvider"
            connectionStringName="..." ... />
    </providers>
</membership> 
```

Make sure also that your provider is inheriting from the System.Web.Security.MembershipProvider abstract class.

See [this MSDN article](http://msdn.microsoft.com/en-us/library/system.web.security.sqlmembershipprovider.aspx) for more detail and examples.

# coldfusion - 有没有办法让 cffile.oldFileSize 返回正确的值？

> ID：159881
> 
> 赞同：2
> 
> 时间：2008-10-01T21:40:32.823
> 
> 标签：coldfusion, cffile

在 ColdFusion 中使用 cffile 时，在将文件上传到网络服务器后，会创建 cffile 结构，该结构应该具有一个名为“oldFileSize”的值。每次我上传并检查该值时，它都有新文件的大小，而不是覆盖文件的大小。是否有一些设置可以纠正这个问题，或者这是 cf8 中 cffile 中的错误？

澄清：如果您使用 cffile 命令将文件上传到服务器，它将尝试将该文件存储在您在命令中指定的位置。如果目的地已经有一个具有相同名称和路径的文件，那么您的 cffile 命令中的选项之一可以打赌覆盖任何现有文件。如果这样做，将返回一个名为 cffile 的结构，其属性名为“oldFileSize”。该文档指出 oldFileSize 应该是被覆盖的文件的大小。相反，它返回正在上传的文件的大小。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T01:25:05.700

如果 oldfilesize 属性没有正确返回，我会使用 nameconflict=unique 来保留旧文件。然后，您可以使用 cfdirectory 检查旧文件大小，并使用 cffile action="delete" 和 action="rename" 替换旧文件，这样您实际上已经覆盖了旧文件，只能手动进行。

有点工作，但如果你需要信息....

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T17:27:14.890

Ben Doom 对解决问题的方法是正确的，但是如果您没有看到记录在案的行为，***那是一个错误，您应该报告它！***目前，没有可以提交的公共错误跟踪器（尽管有一个推送，我们可能很快就会看到它），因此事实上的标准是将其作为评论发布在文档页面上。

Adobe 工作人员确实阅读并回复了评论，他们可能会回复将修复它，或者承认这是一个错误，但表示目前没有修复它的计划。无论哪种方式，负责任的做法是[报告错误](http://livedocs.adobe.com/coldfusion/8/htmldocs/help.html?content=Tags_f_10.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T21:49:49.073

什么覆盖的文件？当您只提到一个文件时，您似乎在谈论两个文件。

# c# - 可以将数据库初始化调用放在 C# 构造函数中吗？

> ID：159886
> 
> 赞同：9
> 
> 时间：2008-10-01T21:42:17.063
> 
> 标签：c#, database, constructor

我已经看到这是各种代码库，并且想知道这是否普遍不受欢迎。

例如：

```
public class MyClass
{
   public int Id;

   public MyClass()
   {
      Id = new Database().GetIdFor(typeof(MyClass));
   }
} 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-01T21:44:55.263

嗯..我不会。但是话又说回来，我的方法通常涉及不负责检索自己的数据的类。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-01T22:54:47.123

有几个原因通常不被认为是好的设计，其中一些像导致困难的单元测试和处理错误的困难已经被提及。

我选择不这样做的主要原因是您的对象和数据访问层现在非常紧密地耦合，这意味着在其原始设计之外对该对象的任何使用都需要大量返工。例如，如果您遇到一个实例，您需要使用该对象而没有分配任何值来保存该类的新实例，该怎么办？您现在要么必须重载构造函数，然后确保所有其他逻辑都处理这种新情况，要么继承和覆盖。

如果对象和数据访问是分离的，那么您可以创建一个实例，然后不对其进行水合。或者，如果您有一个使用相同实体但使用不同持久层的不同项目，那么这些对象是可重用的。

话虽如此，我过去在项目中采取了更简单的耦合方式:)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-01T21:49:26.560

这也将使为该类编写单元测试变得困难，因为您将无法强制该类使用 db 类的 Mock/Stub 版本。见这里： [http ://en.wikipedia.org/wiki/Dependency_injection](http://en.wikipedia.org/wiki/Dependency_injection)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-01T21:51:41.797

如果您引用数据库连接，则可以使用*一次性模式：*

```
public class MyClass : IDisposable
{
    private Database db;
    private int? _id;

    public MyClass()
    {
        db = new Database();
    }

    public int Id
    {
        get
        {
            if (_id == null) _id = db.GetIdFor(typeof(MyClass));
            return _id.Value;
        }
    }

    public void Dispose()
    {
        db.Close();
    }
} 
```

**用法：**

```
using (var x = new MyClass()) 
{
    /* ... */

} //closes DB by calling IDisposable.Dispose() when going out of "using" scope 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-01T21:49:01.600

是的，你可以做到，但这不是最好的设计，并且构造函数中的错误处理不像其他地方那样整洁。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-01T21:44:51.597

这种方法我能想到的唯一问题是，来自数据库初始化的任何错误都将作为构造函数的异常传播。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-12-03T10:47:28.483

为什么有人想使用模拟对象/存根而不是真实的东西？你同意汽车制造商应该使用纸板模型进行碰撞测试吗？

# visual-studio - 在 Visual Studio 中调试时如何执行 GetLastError()

> ID：159888
> 
> 赞同：51
> 
> 时间：2008-10-01T21:42:41.553
> 
> 标签：visual-studio, debugging, winapi

您正在单步执行 C/C++ 代码，并且刚刚调用了一个失败的 Win32 API（通常返回一些无用的通用错误代码，例如 0）。您的代码不会进行后续的 GetLastError() 调用，您可以检查其返回值以获取更多错误信息。

如何在不重新编译和重现失败的情况下获得错误值？在 Watch 窗口中输入“GetLastError()”不起作用（“语法错误”）。

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-10-01T22:19:05.757

如前所述，`@err`伪寄存器将显示最后一个错误值，并将`@err,hr`错误显示为字符串（如果可以的话）。

根据 Visual Studio 团队成员 Andy Pennell 的说法，从 VS 7 (Visual Studio .NET 2002) 开始，不推荐使用“@”字符来指示伪寄存器 - 他们更喜欢使用“$”（如`$err,hr`） . $ 和@ 都暂时支持。

您还可以在条件断点中使用 $err 伪寄存器；因此，只有当最后一个错误不为零时，您才能中断一行代码。这可能是一个**非常**方便的技巧。

您可能会发现其他一些方便的伪寄存器（来自 John Robbins 的杰出著作，[“Debugging Applications for Microsoft .NET and Microsoft Windows”](https://rads.stackoverflow.com/amzn/click/com/0735615365)）：

*   `$tib`- 显示线程信息块
*   `$clk`- 显示时钟计数（对计时功能有用）。要更轻松地使用它，请放置一块`$clk`手表，然后再放置一块`$clk=0`手表。第二个手表将在显示当前值后清除伪寄存器，因此下一步或跨步只为您提供该操作的时间。请注意，这是一个粗略的时序，其中包括相当多的调试器开销，但它仍然非常有用。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-01T21:46:55.693

`ERR,hr`在监视窗口中通常可以解决问题

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-01T21:59:36.600

“编辑并继续”添加代码，以便您可以看到错误（只是不要创建新的全局变量来存储它）。如果您可以快速调用执行此类错误处理代码的预先存在的函数，它会非常有效。

作为奖励，您也可以将新代码留在那里以备将来使用。

如果你不能做到这一点，那么 QBziZ 是对的，“ERR,hr”做到了。

# ios - 如何在 iPhone 上访问 SQLite 数据库实例？

> ID：159889
> 
> 赞同：38
> 
> 时间：2008-10-01T21:42:50.617
> 
> 标签：ios, iphone, sqlite

我正在开发一个使用内置 SQLite 数据库的 iPhone 应用程序。我正在尝试通过`sqlite3`命令行工具查看和打开数据库，以便可以对其执行任意 SQL。

当我在模拟器中运行我的应用程序时，`.sqlite`它创建的文件位于`~/Library/Application Support/iPhone Simulator/User/Applications/`.

如何在物理 iPhone 上查看该文件？

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2014-09-23T00:53:59.520

Xcode 6.0.1 使用说明

1.  Xcode > 打开 > YourProject
2.  Xcode > 产品 > 运行
3.  Xcode > 窗口 > 设备
4.  （第 1 列 - 选择）设备 > YourDeviceName
5.  （第 2 列 - 选择）已安装的应用程序 > YourAppName
6.  （第 2 列 - 选择）“已安装应用程序”列表下的 Cog
7.  （弹出 - 选择）下载容器...
8.  保存到位置
9.  右键单击“YourAppName.xcappdata”
10.  选择“显示包装内容”
11.  AppData > 文档 > YourDatabase.sqlite

![在此处输入图像描述](https://i.stack.imgur.com/eanQM.png)

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2008-10-01T22:16:03.627

在 Xcode 中选择 window->organizer 并在手机的应用程序部分中展开应用程序旁边的节点。选择应用程序数据旁边的黑色向下箭头并将文件保存在桌面上的任何位置。您的 sqlite 数据库应该在某处。

至于一旦你完成后如何去把它恢复到手机上，我不知道。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-12-26T16:45:05.763

在 XCode 4 中，您按照 Lounges 的建议执行相同的操作，这会将您的应用程序的整个文件结构保存到您选择的目的地。重命名保存为 .sqlite 的 .xcappdata 文件，以便双击打开它，然后您可以从设备中找到该文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T21:43:39.947

与您在模拟器上所做的完全相同。设备和模拟器之间几乎没有（重要的）差异，文件访问和库加载大部分不是其中的一部分。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T22:16:37.387

你的问题仍然有点模糊。“看”是什么意思？您是否创建 SQLite 数据库？如何？您是否将其手动放置在模拟器的文件系统区域中？您是否在问如何在 iPhone 上做到这一点？

最简单的方法是使用 sqlite3 命令行工具预先创建一个空数据库，将其作为应用程序中的资源，然后将其复制到应用程序沙箱的文档文件夹中。您可以通过 NSBundle 的 pathForResource:ofType: 方法获取资源文件夹的路径，然后通过 NSSearchPathForDirectoriesInDomains() 为 NSUserDomainMask 中的 NSDocumentsDirectory 文件夹获取 Documents 文件夹的路径，然后通过 NSFileManager 的方法复制文件。

否则，您可以使用 SQLite 的函数从头开始创建一个新数据库，方法是提供适当的 SQL 命令来定义其模式。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-01-23T04:54:32.040

如果你越狱你的 iPhone，这个可以工作。我不知道为什么有人会在越狱他们的手机时遇到任何问题，因为我已经使用它进行开发很长一段时间并且没有发现任何问题，对于 sqlite 来说也并不少见在设备与模拟器上执行[不同的操作：](https://stackoverflow.com/questions/14462951/ios-sqlite3-memory-management-behaving-differently-between-device-and-simulator)

1.  越狱打破你的手机（网上都有教程）
2.  将您的 cydia 用户级别设置为[开发人员](http://www.jailbreakqa.com/questions/135484/why-cant-i-find-sqlite3-in-cydiatelesphoreo)
3.  将 sqlite3 安装到您的手机中：转到 cydia > manage > sources > cydia/telesphoreo > sqlite3
4.  [使用iphone 隧道](http://code.google.com/p/iphonetunnel-mac/)root ssh 密码ssh 进入您的手机：“alpine”
5.  键入`which sqlite3`以确保您已安装它
6.  浏览到您的数据库的位置..代码中的断点应该告诉您它的位置..在我的代码中它看起来像这样

    ```
    NSArray *paths = NSSearchPathForDirectoriesInDomains (NSDocumentDirectory, NSUserDomainMask, YES); 
    NSString *documentsDirectory = [paths objectAtIndex: 0]; 
    NSString *pathName = [documentsDirectory stringByAppendingPathComponent:filename];
    return pathName; 
    ```

    请注意，如果您在模拟器上运行它......您将获得如下所示的位置： `/Users/admin/Library/Application Support/iPhone Simulator/6.0/Applications/42302574-7722-48C1-BE00-91800443DA7C/Documents/email-524200.edb`

在设备上，它将如下所示： `/var/mobile/Applications/FB73857F-A822-497D-A4B8-FBFB269A8699/Documents/email-523600.edb`

然后只需键入`sqlite3 %dbname%`，您就可以直接在手机上执行 sql 语句.. 无需复制或其他任何内容。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-07-02T00:56:23.680

到目前为止，最简单的方法是使用 iExplorer 从您的应用程序下载文件。然后使用[SQLite Professional 只读](https://itunes.apple.com/us/app/sqlite-professional-read-only/id635299994?mt=12)方式读取文件。甚至认为它不是实时的，但至少它是免费的。:-)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-04-20T21:29:36.840

下载容器方法是我发现最好的方法。但是，您必须小心，有时，如果您尝试通过电子邮件发送或从应用程序中附加它，则发送出去的文件将是空的。

# windows - 确定程序是否在远程桌面上运行

> ID：159910
> 
> 赞同：24
> 
> 时间：2008-10-01T21:49:14.207
> 
> 标签：windows, terminal-services, citrix

有没有一种方法可以确定我的程序何时在远程桌面（终端服务）上运行？

当程序在远程桌面会话上运行时，我想在程序上启用“不活动超时”。由于用户因打开远程桌面会话而臭名昭著，因此我希望我的程序在指定的不活动时间后终止。但是，我不希望为非 RD 用户启用不活动超时。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-01T21:53:17.097

GetSystemMetrics(SM_REMOTESESSION)（如[http://msdn.microsoft.com/en-us/library/aa380798.aspx](http://msdn.microsoft.com/en-us/library/aa380798.aspx)中所述）

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-27T19:46:01.663

这是我使用的 C# 托管代码：

```
/// <summary>
/// Indicates if we're running in a remote desktop session.
/// If we are, then you MUST disable animations and double buffering i.e. Pay your taxes!
/// 
/// </summary>
/// <returns></returns>
public static Boolean IsRemoteSession
{
    //This is just a friendly wrapper around the built-in way
    get
    {
        return System.Windows.Forms.SystemInformation.TerminalServerSession;
    }
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-05-04T14:28:35.973

如果您想了解在您的会话中运行的应用程序，则可以使用以下方法：

```
BOOL IsRemoteSession(void)
{
   return GetSystemMetrics( SM_REMOTESESSION );
} 
```

但通常不适用于任何进程 ID。

* * *

如果您想了解可以在任意会话中运行的任意进程，则可以使用以下方法。

[您可以首先通过调用ProcessIdToSessionId](http://msdn.microsoft.com/en-us/library/aa382990(VS.85).aspx)将进程 ID 转换为会话 ID 。获得会话 ID 后，您可以使用它来调用：[WTSQuerySessionInformation](http://msdn.microsoft.com/en-us/library/aa383838(VS.85).aspx)。您可以指定`WTSInfoClass`为值`WTSIsRemoteSession`，这将为您提供有关该应用程序是否为远程桌面连接的信息。

```
BOOL IsRemoteSession(DWORD sessionID)
{
   //In case WTSIsRemoteSession is not defined for you it is value 29
   return WTSQuerySessionInformation(WTS_CURRENT_SERVER_HANDLE, sessionID, WTSIsRemoteSession, NULL, NULL);
} 
```

# javascript - CSS/JavaScript 使用 Div 使页面部分变灰

> ID：159914
> 
> 赞同：45
> 
> 时间：2008-10-01T21:49:42.567
> 
> 标签：javascript, css

有人知道用 JavaScript 或 CSS 将 HTML 中表单/div 的某个部分基本上变灰的方法吗？

我有一个“*用户配置文件*”表单，我想为“*非高级*”成员禁用其中的一部分，但希望用户查看表单背后的内容并在其顶部放置“*行动号召”。*

有人知道通过 CSS 或 JavaScript 实现此目的的简单方法吗？

编辑：我将确保表单在服务器端不起作用，因此 CSS 或 JavaScript 就足够了。

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2008-10-01T22:02:13.800

将此添加到您的 HTML：

```
<div id="darkLayer" class="darkClass" style="display:none"></div> 
```

这对你的CSS：

```
.darkClass
{
    background-color: white;
    filter:alpha(opacity=50); /* IE */
    opacity: 0.5; /* Safari, Opera */
    -moz-opacity:0.50; /* FireFox */
    z-index: 20;
    height: 100%;
    width: 100%;
    background-repeat:no-repeat;
    background-position:center;
    position:absolute;
    top: 0px;
    left: 0px;
} 
```

最后用 JavaScript 关闭和打开它：

```
function dimOff()
{
    document.getElementById("darkLayer").style.display = "none";
}
function dimOn()
{
    document.getElementById("darkLayer").style.display = "";
} 
```

更改 darkClass 的尺寸以适合您的目的。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2008-10-01T22:09:15.890

你可以试试 jQuery [BlockUI](http://malsup.com/jquery/block/)插件。如果您不介意对 jQuery 的依赖，它非常灵活且易于使用。它支持[元素级](http://malsup.com/jquery/block/#element)阻塞以及覆盖消息，这似乎是您所需要的。

使用它的代码很简单：

```
$('div.profileform').block({
    message: '<h1>Premium Users only</h1>',
}); 
```

您还应该记住，您可能仍需要某种服务器端保护以确保非高级用户无法使用您的表单，因为如果人们使用某些东西，他们很容易访问表单元素像萤火虫。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T11:27:44.083

如果您依靠 CSS 或 JavaScript 来阻止用户编辑表单的一部分，则可以通过禁用 CSS 或 JavaScript 轻松规避。

更好的解决方案可能是在非高级会员的表单之外显示不可编辑的信息，但包括高级会员的相关表单字段。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-09-08T16:25:27.207

```
With opacity

//function to grey out the screen
$(function() {
// Create overlay and append to body:
$('<div id="ajax-busy"/>').css({
    opacity: 0.5, 
    position: 'fixed',
    top: 0,
    left: 0,
    width: '100%',
    height: $(window).height() + 'px',
    background: 'white url(../images/loading.gif) no-repeat center'
    }).hide().appendTo('body');
});

$.ajax({
    type: "POST",
    url: "Page",
    data: JSON.stringify({ parameters: XXXXXXXX }),
    contentType: "application/json; charset=utf-8",
    dataType: "json",
    beforeSend: function() {
        $('#ajax-busy').show();
    },
    success: function(msg) {
        $('#ajax-busy').hide();

    },
    error: function() {
        $(document).ajaxError(function(xhr, ajaxOptions, thrownError) {
            alert('status: ' + ajaxOptions.status + '-' + ajaxOptions.statusText + ' \n' + 'error:\n' + ajaxOptions.responseText);
        });
    }
}); 
```

# sql - 对计数（*）和自连接感到困惑

> ID：159916
> 
> 赞同：0
> 
> 时间：2008-10-01T21:49:57.653
> 
> 标签：sql, join, self-join

我想返回当月和当年的所有申请日期。这一定很简单，但是我想不通。我知道当月有 2 个日期，当年有 90 个日期。右，左，外，内我都试过了，只是把代码扔在墙上，想看看什么会粘住，但都不起作用。我要么两列得到 2，要么两列得到 180。这是我最新的选择声明。

```
SELECT count(a.evdtApplication) AS monthApplicationEntered,  
       count (b.evdtApplication) AS yearApplicationEntered
FROM tblEventDates a 
RIGHT OUTER JOIN tblEventDates b ON a.LOANid = b.loanid 
WHERE datediff(mm,a.evdtApplication,getdate()) = 0 
      AND datediff(yy,a.evdtApplication, getdate()) = 0 
      AND datediff(yy,b.evdtApplication,getdate()) = 0 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T21:59:02.607

您根本不需要任何连接。

您想计算 tblEventDates 中的 loanID 列，并且您想根据与当前月份或当年匹配的日期有条件地进行计算。

所以：

```
SELECT SUM( CASE WHEN Month(a.evdtApplication) = MONTH(GEtDate() THEN 1 END) as monthTotal,
        count(*)
FROM tblEventDates a
WHERE a.evdtApplication BETWEEN '2008-01-01' AND '2008-12-31' 
```

这样做是选择今年的所有活动日期，并将符合您条件的日期相加。如果它与当前月份不匹配，则不会加 1。实际上，甚至不需要为年份做条件，因为您只是查询该年份的所有内容。

# php - 如何在 PHP 中通过 PDO 循环遍历 MySQL 查询？

> ID：159924
> 
> 赞同：30
> 
> 时间：2008-10-01T21:52:17.880
> 
> 标签：php, mysql, pdo

我正在慢慢地将我的所有功能`LAMP websites`从`mysql_`功能转移到`PDO`功能，并且我已经碰到了我的第一堵砖墙。我不知道如何使用参数循环遍历结果。我对以下内容很好：

```
foreach ($database->query("SELECT * FROM widgets") as $results)
{
   echo $results["widget_name"];
} 
```

但是，如果我想做这样的事情：

```
foreach ($database->query("SELECT * FROM widgets WHERE something='something else'") as $results)
{
   echo $results["widget_name"];
} 
```

显然，“其他东西”将是动态的。

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-10-02T00:24:56.530

这是使用 PDO 连接到数据库的示例，告诉它抛出异常而不是 php 错误（将有助于您的调试），并使用参数化语句而不是自己将动态值替换到查询中（强烈推荐）：

```
// connect to PDO
$pdo = new PDO("mysql:host=localhost;dbname=test", "user", "password");

// the following tells PDO we want it to throw Exceptions for every error.
// this is far more useful than the default mode of throwing php errors
$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

// prepare the statement. the placeholders allow PDO to handle substituting
// the values, which also prevents SQL injection
$stmt = $pdo->prepare("SELECT * FROM product WHERE productTypeId=:productTypeId AND brand=:brand");

// bind the parameters
$stmt->bindValue(":productTypeId", 6);
$stmt->bindValue(":brand", "Slurm");

// initialise an array for the results
$products = array();
$stmt->execute();
while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
    $products[] = $row;
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-01T22:04:35.793

根据[PHP 文档](http://ca3.php.net/manual/en/pdo.query.php)，您应该能够执行以下操作：

```
$sql = "SELECT * FROM widgets WHERE something='something else'";
foreach ($database->query($sql) as $row) {
   echo $row["widget_name"];
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-06-14T06:07:07.043

如果您喜欢 foreach 语法，可以使用以下类：

```
// Wrap a PDOStatement to iterate through all result rows. Uses a 
// local cache to allow rewinding.
class PDOStatementIterator implements Iterator
{
    public
        $stmt,
        $cache,
        $next;

    public function __construct($stmt)
    {
        $this->cache = array();
        $this->stmt = $stmt;
    }

    public function rewind()
    {
        reset($this->cache);
        $this->next();
    }

    public function valid()
    {
        return (FALSE !== $this->next);
    }

    public function current()
    {
        return $this->next[1];
    }

    public function key()
    {
        return $this->next[0];
    }

    public function next()
    {
        // Try to get the next element in our data cache.
        $this->next = each($this->cache);

        // Past the end of the data cache
        if (FALSE === $this->next)
        {
            // Fetch the next row of data
            $row = $this->stmt->fetch(PDO::FETCH_ASSOC);

            // Fetch successful
            if ($row)
            {
                // Add row to data cache
                $this->cache[] = $row;
            }

            $this->next = each($this->cache);
        }
    } 
```

}

然后使用它：

```
foreach(new PDOStatementIterator($stmt) as $col => $val)
{
    ...
} 
```

# .net - 如何在 .NET 中使 ListView 行可拖动？

> ID：159925
> 
> 赞同：0
> 
> 时间：2008-10-01T21:52:19.393
> 
> 标签：.net, winforms, controls

我不是最有经验的 GUI 程序员，所以请耐心等待。我有一个自定义列表视图。我希望能够将一行从 ListView 拖到窗体上的另一个控件。我知道如何捕获将对象拖动到控件时触发的事件，但我不确定如何使行本身可拖动。我总是可以拼凑出我自己的解决方案，但我希望有更好（阅读：更简单）的方法来做到这一点。

编辑：我真的很想拖动行的副本，但我总是可以自己解决细节。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-01T22:37:56.350

[http://www.c-sharpcorner.com/UploadFile/skulkarni/ImlementingDragandDropinListViewControls11252005035642AM/ImlementingDragandDropinListViewControls.aspx](http://www.c-sharpcorner.com/UploadFile/skulkarni/ImlementingDragandDropinListViewControls11252005035642AM/ImlementingDragandDropinListViewControls.aspx)

# svn - Is there any reasonable way to migrate from subversion to cvs?

> ID：159926
> 
> 赞同：5
> 
> 时间：2008-10-01T21:52:36.320
> 
> 标签：svn, migration, cvs

My company unwittingly switched from cvs to subversion and now we're all wishing we had cvs back. I know there's tools to migrate history and changes from cvs to svn and there's no equivalent to do the reverse. Any suggestions or ideas on how to do this?

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-01T22:35:13.347

I originally added this as a comment to someone else's answer, but then realized that it was an answer, of sorts. I have done these sorts of transitions before, where there was no existing way to convert from one SCM system to another.

It's not rocket science to write a script that takes the list of commits from your SVN repository, and iterates through them one at a time, merging them into a newly-created CVS repository. Getting all the branches and tags exactly correct might be a bit more work, but if you want to just save revision history for a few branches, it should be pretty easy.

I'm also of the opinion that you won't really gain anything by switching back to CVS, but if you want to do so, then you'll likely be writing your own script. The "svn export" command will undoubtedly be useful in this endeavor.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-01T22:18:29.377

So what is with SVN that your company dislikes so much and CVS does better? The designers of SVN went out of their way to make the SVN experience fairly similar to CVS. If you use the Tortoise client as a front end the experience is very similar. SVN gives you atomic commits, which while not quite up to the standard of Perforce is miles in front of CVS.

I do have to sympathise with your plight. I upgraded our development team & IT Team from CVS to SVN. I got all the right python scripts to upgrade all the version history and we have been using SVN happily for nearly 4 years. About three months ago the IT Team leader decided to "upgrade" all his projects from SVN to guess what? That's right, the heavy lifter of the version control systems: SourceSafe!

I would definately stick with SVN or even look at some of the newer distributed systems such as Mercurial. With these systems there is no central server. They rely on being able to branch & merge across dozens or hundreds of peers. You define your own topology, so for example, you would specify a particular peer as being the one that performs daily builds.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-01T22:07:45.660

I don't think the tools exist to go in the other direction, because there's not much demand for it.

If you really must do it, it shouldn't be very hard to write a script that walks through the history of the SVN repo, getting each revision and committing it to CVS.

BTW, I'm genuinely interested to know what problems you have with SVN.

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-01T21:56:20.977

Not an upgrade. Do not do this.

Seriously, why would you prefer CVS to SVN? CVS is literally a toy that pretends to allow teams to work without explicit communication. It really is terrible.

If you need something other than SVN for whatever reason, look at other version control systems. There are many, and they are almost all better than CVS (in fact, only Visual Source Safe is as poor).

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-01T22:05:40.720

SVN is not great. SVN is better than CVS. If you want to change checkout Mercurial, GIT, Bazaar.

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-02T08:05:32.103

One aspect of git has not been discussed when it has been brought to your attention in all these other answers: git provides a cvs server emulation, so that you might migrate to git (svn to git is easy and well supported) and later use a cvs server interface for accessing the repository in a centralized manner. Nobody has to know you use git in the background and you don't have to deal with distributed backup issues.

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-01T22:11:37.193

Your options are probably realtively limited. Remember that active development of CVS stopped a while ago, so there are probably no tools for you from the CVS developers. And since one of the main goals of svn was to be a better CVS, those developers will probably not have expected anyone to move backwards either.

But if you don't like subversion, why not have a look at the more modern distributed systems (git, mercurial etc)?

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-01T21:59:33.887

when all you have is hammer, everything looks like a nail.

best bet is to learn svn it will make more knowledgeable.

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-01T22:24:56.493

Agree with Corporal Touchy.

SVN is better than CVS, because it was designed to be - it's roughly the same thing, with some simplications and new features.

With Svn, you can move/rename a file without losing its history; you get safer commits (commits are atomic operations) and global revisions.

Anyway, try to get to know it better before swithing back to CVS and even better, try to really understand your needs as a team for a repository.

PS: I think Corporal was talking about [Mercurial](http://www.selenic.com/mercurial/wiki/)

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-10-02T07:33:55.487

svn was supposed to be better than cvs but in some areas that didn't work well. The other distributed tools are a lot faster (svn is slow as hell, even cvs can be faster sometimes), have much more useful features than svn, are developing rapidly (while seeing any new feature in svn takes YEARS). On the other hand svn is quite easy to learn and centralized (this is important for some people).

svn team is focused on own agenda, it's very hard to get support from developers (comparing to other open source projects), some bug reports exists for long time without any interest from developers.

I'm disapointed by how svn project looks and how it's developed but well, maybe that will change in future.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-02T07:25:06.367

the only 2 drawbacks of subversion I can think of users coming from CVS are

*   the speed of checkouts over http(s)
*   the lack of modulaliases

the first one can be solved by using svn(+ssh) which is the more comparable format as CVS uses its own protocol as well. the second one is a little trickier, but can be emulated by svn:externals (which have their own nasty sideeffects) If you encountered any other additional drawbacks, I am all ear..

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-02T07:51:10.453

Just pay attention to one point: Bazzar, Mercurial etc. (who were advised by some people here) are all distributed version control systems. I found it almost impossible to manage big groups of programmers working on the same source code using these kind of tools. In my company we use SVN and it's doing a wonderful job.

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-04-14T22:57:23.397

No idea why you'd want to do this, but going from SVN -> GIT -> CVS might work

You'd run..

```
git svn clone http://thesvnserver ourrepo 
```

Then using the following guide to export back to CVS (not entirely sure this will work):

[http://issaris.blogspot.com/2005/11/cvs-to-git-and-back.html](http://issaris.blogspot.com/2005/11/cvs-to-git-and-back.html)

```
git cvsexportcommit 4a20cbafdf25a141b31a8333284a332d1a4d6072 
```

There's also [`git cvsserver`](http://www.kernel.org/pub/software/scm/git/docs/git-cvsserver.html)

# .net - 动画自定义按钮 ControlTemplate 前景

> ID：159928
> 
> 赞同：2
> 
> 时间：2008-10-01T21:53:15.163
> 
> 标签：.net, silverlight, silverlight-2-rc0

我想根据控件的状态更改/动画自定义按钮控件模板的 Foreground 属性。

在 RC0 之前，我设置了 ContentPresenter 的 Foreground，给它一个 x:Name，并在 VisualStateManager 转换中引用它。

现在，ContentPresenter 不再有 Foreground，因为它不再从 Control 继承。通常，我会在应用于模板控件的样式中设置前景。但我不能从 VisualStateManager 转换/状态中引用它。我也无法将它包装在设置了 Foreground 属性的 TextBlock 中，并且（**编辑**：） Border 没有 Foreground 属性。

非常感谢您的帮助。

### 更新：

我可以解决一些带有边框的已删除属性的问题，但不能解决与字体/文本相关的问题，包括前景。

由于这似乎不可能，在我的特殊情况下，我能够用 TextBlock 替换 ContentPresenter。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T15:56:32.347

[Jesse Liberty](http://jesseliberty.com/2008/09/28/rc0-contentpresenter/)有一篇文章处理这个问题。简而言之，这个想法是您不能，因为您将强制按钮中的任何内容具有特定的前景色，并且该决定应该留给内容本身。

无论如何，也许您可​​能想看看劫持依赖属性的概念，它使用另一个相同类型的属性来满足您的需求。这不是一个好的做法，但肯定会奏效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-05T10:19:39.463

只要按钮内容不复杂，用 TextBlock 替换 ContentPresenter 就可以很好地工作。我有一个示例，其中按钮内容具有图像和文本块。在这种情况下，不显示任何内容。将 ContentPresenter 替换为 ContentControl，您将获得 Foreground 属性。

```
<ControlTemplate TargetType="{x:Type ButtonBase}">
    <ContentControl Content="{TemplateBinding Content}" Foreground="{Binding Foreground}" />
</ControlTemplate> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T22:26:49.887

在您的 ContentControl 周围放置一个边框，并使您的 VSM 适用于该边框控件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-25T18:30:24.883

我想出了一个解决这个问题的方法，类似于我刚刚注意到的现有响应 -

如果您愿意将可以插入模板的可能内容类型限制为文本，那么它会很好地工作：

[http://storypodders.com:8081/bodhiSoftware/node/14](http://storypodders.com:8081/bodhiSoftware/node/14)

# database-design - 一对多对自己

> ID：159934
> 
> 赞同：5
> 
> 时间：2008-10-01T21:54:29.187
> 
> 标签：database-design, data-modeling, table-structure

如何为可以与自身具有一对多关系的实体构建表？具体来说，我正在开发一个跟踪动物繁殖的应用程序。每只动物都有一个ID；它还有一个父亲身份证和一个女士身份证。因此，从父系或母系到其后代，有可能是一对多的。我会倾向于这样的事情：

```
ID INT NOT NULL PRIMARY KEY
SIRE_ID INT 
DAME_ID INT 
```

并将购买并添加到种畜的那些动物记录为空值，并在表格中记录其余的ID。

所以：

1.  有人可以指出我讨论建模这种关系的文章/网页吗？
2.  ID 应该是 INT 还是某种字符串？INT 中的 NULL 表示该动物在数据库中没有父母，但可以使用具有特殊标志值的字符串来表示相同的事情。
3.  这可能最好通过两个表建模吗？我的意思是一张动物表和一张单独的表，仅表明亲属关系，例如：

    动物

    ID INT NOT NULL 主键

    亲属关系

    ID INT NOT NULL PRIMARY KEY FOREIGN KEY

    SIRE_ID INT 主键 外键

    DAME_ID INT 主键 外键

我为上述道歉：我的 SQL 生锈了。我希望它能表达我的想法。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-01T22:04:42.937

好吧，这是一种“正常”的一对多关系，您建议的方法是解决它的经典方法。

请注意，两个表是非规范化的（我无法准确指出 superkey-is-not-well-should-be-subset-of-other-key-fsck-I-forgot 部分在哪里，但我很确定它在某处）；直观的原因是第一个中的一个元组最多匹配第二个中的一个元组，所以除非你有很多动物的父亲和贵妇人 ID 为空，否则这在任何前景中都不是一个好的解决方案（它会降低性能 - 需要加入——并且不会减少存储需求）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-01T22:11:03.170

我认为您只使用一张桌子的布局很好。您肯定希望将 SIRE_ID 和 DAME_ID 保持在与 ID 相同的数据类型中。您还希望将它们声明为 FOREIGN KEY（可能有一个外键指向同一个表，并且外键也可以为空）。

```
ID INT NOT NULL PRIMARY KEY
SIRE_ID INT REFERENCES TABLENAME (ID)
DAME_ID INT REFERENCES TABLENAME (ID) 
```

使用此布局，您可以轻松查找父动物，还可以为给定动物构建后代树（对于 Oracle，有 CONNECT BY）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-01T22:06:00.157

几个月前，我在 MySQL 网站上问了一个类似的问题。我建议你看看我从 Peter Brawley 那里收到的关于这种关系的回复：[http://forums.mysql.com/read.php?135,187196,187196#msg-187196](http://forums.mysql.com/read.php?135,187196,187196#msg-187196)

如果您想进一步研究该主题，那么我建议您查看 Wikipedia 上的 Tree Hierarchies。

另一个建议的架构（将完全标准化）如下所示：

表：动物

身份证 | 姓名 | 品种

表：血统

动物ID | parent_id | parentType（父亲或母亲）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-01T22:05:43.747

INT 是 ID 列的更好选择，如果您应该使用序列来生成唯一 ID，则更适合。

我认为将设计拆分为两个表没有任何好处。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-01T22:14:27.813

我不知道动物繁殖，但听起来您的 Sire_ID 是父亲，而 Dame_ID 是母亲？没问题。每只动物一行，购买的动物为 null sei_和 dame_ID，我不认为有任何问题。

```
[ID],[Sire_ID],[Dame_ID];
0,null,null  (male)
1,null,null  (female)
2,null,null  (female)
3,0,1 (male)
4,0,2 (male)
5,null,null  (female)
6,3,5
7,4,5 
```

等等。您可能会在 while 循环中填充 TreeView 或 XmlNodeList ......

```
While (myAnimal.HasChildren) {
 Animal[] children = GetChildren(Animal.ID)
 for (int x=0; x<children.length; x++) 
  myAnimal.Children.Add(children[x]);
} 
```

在这种情况下，Animal.Children 是动物的集合。因此，myAnimal.Children[0].Father 将返回 myAnimal。.Parent[] 可以是它的两个父母的集合，只要 [0] 始终是一个父母（父亲）并且 [1] 始终是另一个父母（母亲），它就应该起作用。

使 ID 成为自动编号 PK，并通过返回其父项的 ID 以编程方式分配 Sire_ID 和 Dame_ID。尽管如果您真的想要两个父 ID 都可以引用回 ID，但应该不需要外键关系。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T22:06:46.537

使用带有 SQL 的“connect by”子句来告诉它要遵循哪个层次结构。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-01T22:07:22.057

这不是真正的一对多关系，除非动物可以有很多父母。

我会将它保留为一个单独的表，其中包含动物的唯一键 ID、每个父母的一个 int 字段，可能还有一个文本字段用于关于动物的一般注释，如果是这种情况，它是在哪里购买的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-01T22:10:51.143

我认为既然很明显一只动物只有一个父亲和一个大坝，那么使用一张桌子是最有意义的。我的偏好是使用 int 或 bigint 作为行标识符，空值表示没有关系。那么，我可能会使用其他一些方法来唯一地识别动物，这样它们就不会在表中出现两次，并且也会在该列上创建一个唯一索引。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-01T22:13:22.510

好像你想建造像树一样的东西。

类似的东西呢？：

```
 ID          Primary Key,
 Parent_ID   Foreing_Key
 ( data ) 
```

有一些功能可以在与自身有关系的表中进行查询。**请参阅Connect By**的语法：http : [//www.adp-gmbh.ch/ora/sql/connect_by.html](http://www.adp-gmbh.ch/ora/sql/connect_by.html)

# datetime - Changing short date format in Ubuntu

> ID：159950
> 
> 赞同：14
> 
> 时间：2008-10-01T21:57:50.783
> 
> 标签：datetime, ubuntu

How do I change the system-wide short date format in Ubuntu? For example, Thunderbird is showing dates in the DD/MM/YY format, and I would like to change it to MM/DD/YY or YYYY-MM-DD.

The best information I can find so far is in this thread:

[http://ubuntuforums.org/showthread.php?t=193916](http://ubuntuforums.org/showthread.php?t=193916)

Edit: I want to change the system-wide date format, so that all my applications use this new date format.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2017-09-11T14:16:20.393

*   安装并启动“dconf Editor”，导航到 com -> canonical -> indicator -> datetime。
*   将 的值设置`time-format`为`custom`。
*   通过编辑 的值自定义时间和日期格式`custom-time-format`，例如将其设置`%Y-%m-%d %H:%M:%S`为“2017-12-31 23:59:59”格式。
*   重新登录以查看更改的效果。

您也可以通过终端中的命令执行此操作：

```
gsettings set com.canonical.indicator.datetime time-format 'custom'
gsettings set com.canonical.indicator.datetime custom-time-format '%Y-%m-%d %H:%M:%S' 
```

来源：[http ://ubuntuhandbook.org/index.php/2015/12/time-date-format-ubuntu-panel/](http://ubuntuhandbook.org/index.php/2015/12/time-date-format-ubuntu-panel/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2017-03-09T04:39:40.867

此处描述了如何在 2017 年使用[Ubuntu 16.04](https://en.wikipedia.org/wiki/Ubuntu_version_history#Ubuntu_16.04_LTS_.28Xenial_Xerus.29) (Xenial Xerus)执行[此](https://help.ubuntu.com/stable/ubuntu-help/session-formats.html)操作。如果该站点消失，请在下面剪切/粘贴：

**更改日期和测量格式**

您可以控制用于日期、时间、数字、货币和度量的格式，以匹配您所在地区的当地习俗。

*   单击菜单栏最右侧的图标，然后选择系统设置。
*   打开语言支持并选择区域格式选项卡。
*   选择与您要使用的格式最匹配的区域。默认情况下，该列表仅显示使用“语言”选项卡上设置的语言的区域。
*   您必须注销并重新登录才能使这些更改生效。单击菜单栏最右侧的图标，然后选择注销以注销。
*   选择区域后，列表下方的区域会显示日期和其他值的显示方式的各种示例。尽管示例中未显示，但您所在的地区还控制日历中一周的开始日期。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-01T22:24:29.677

Thunderbird uses the system's date format, and that format depends on the system's locale settings. You have two options:

1.  modify the system locale, the instructions are in the forum thread you linked above, or
2.  set `LC_TIME` to a locale that uses the format you want. The [article](http://kb.mozillazine.org/Date_display_format) linked by [Craig H](https://stackoverflow.com/questions/159950/changing-short-date-format-in-ubuntu#159963) suggests `en_DK`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-11-20T06:49:02.443

[这里](https://ccollins.wordpress.com/2009/01/06/how-to-change-date-formats-on-ubuntu/)的说明对我有用，可以创建一个基于`en_US`. 然后 Thunderbird 显示了我想要的日期/时间格式（我更喜欢 YYYY-MM-DD 而不是 MM/DD/YY）。

一段时间后，Thunderbird 中的日期/时间格式变回了`en_US`(MM/DD/YY) 中设置的格式，因为我无意中将 $LC_ALL 设置为`en_US.UTF-8`. 于是，我`sudo gedit /etc/environment`又改成`LC_ALL="en_US.UTF-8"`了`LC_ALL="custom.UTF-8"`。最后，Thunderbird 显示了我想要的日期。

# subsonic - 亚音速和 sp_help_job

> ID：159961
> 
> 赞同：0
> 
> 时间：2008-10-01T22:01:57.967
> 
> 标签：subsonic

subsonic 是否可以访问 dbo.sp_help_job？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-02T05:06:47.837

SubSonic 是一个 ORM 工具，它也封装了 SP，但不会为系统 SP 生成代码，并且该项目是开源的，因此您可以根据需要编辑代码

# c# - C# - 关键字使用 virtual+override 与 new

> ID：159978
> 
> 赞同：215
> 
> 时间：2008-10-01T22:06:52.400
> 
> 标签：c#, syntax, overriding, method-hiding, member-hiding

在基类型“”中声明一个方法，`virtual`然后在子类型中使用“”关键字覆盖它，而不是在子类型中声明匹配方法时`override`简单地使用“ ”关键字有什么区别？`new`

* * *

## 回答 #1

> 赞同：242
> 
> 时间：2008-10-01T22:41:29.277

我总是发现用图片更容易理解这样的事情：

再次，采用约瑟夫戴格尔的代码，

```
public class Foo
{
     public /*virtual*/ bool DoSomething() { return false; }
}

public class Bar : Foo
{
     public /*override or new*/ bool DoSomething() { return true; }
} 
```

如果你然后这样调用代码：

```
Foo a = new Bar();
a.DoSomething(); 
```

*注意：重要的是我们的对象实际上是 a `Bar`，但是我们**将它存储在一个类型的变量中`Foo`**（这类似于强制转换它）*

然后结果将如下所示，具体取决于您是否使用`virtual`/`override`或`new`在声明您的类时。

[![虚拟/覆盖说明图像](https://i.stack.imgur.com/4NrQk.jpg)](https://i.stack.imgur.com/4NrQk.jpg)

* * *

## 回答 #2

> 赞同：192
> 
> 时间：2008-10-01T22:10:01.223

“new”关键字不会覆盖，它表示一个与基类方法无关的新方法。

```
public class Foo
{
     public bool DoSomething() { return false; }
}

public class Bar : Foo
{
     public new bool DoSomething() { return true; }
}

public class Test
{
    public static void Main ()
    {
        Foo test = new Bar ();
        Console.WriteLine (test.DoSomething ());
    }
} 
```

**这将打印为 false，如果您使用覆盖，它将打印为 true。**

（取自 Joseph Daigle 的基本代码）

所以，如果你在做真正的多态，你**应该总是 OVERRIDE**。唯一需要使用“new”的地方是该方法与基类版本没有任何关系。

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2008-10-01T22:15:01.680

下面是一些代码来理解虚拟和非虚拟方法的行为差异：

```
class A
{
    public void foo()
    {
        Console.WriteLine("A::foo()");
    }
    public virtual void bar()
    {
        Console.WriteLine("A::bar()");
    }
}

class B : A
{
    public new void foo()
    {
        Console.WriteLine("B::foo()");
    }
    public override void bar()
    {
        Console.WriteLine("B::bar()");
    }
}

class Program
{
    static int Main(string[] args)
    {
        B b = new B();
        A a = b;
        a.foo(); // Prints A::foo
        b.foo(); // Prints B::foo
        a.bar(); // Prints B::bar
        b.bar(); // Prints B::bar
        return 0;
    }
} 
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-10-01T22:10:18.150

该`new`关键字实际上创建了一个仅存在于该特定类型上的全新成员。

例如

```
public class Foo
{
     public bool DoSomething() { return false; }
}

public class Bar : Foo
{
     public new bool DoSomething() { return true; }
} 
```

该方法存在于两种类型上。当您使用反射并获取 type 的成员时`Bar`，您实际上会发现 2 个调用`DoSomething()`的方法看起来完全一样。通过使用`new`，您可以有效地隐藏基类中的实现，以便当类从`Bar`（在我的示例中）派生时，方法调用`base.DoSomething()`转到`Bar`而不是`Foo`。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-10-01T22:20:31.963

除了技术细节之外，我认为使用 virtual/override 可以在设计上传达很多语义信息。当您声明一个虚拟方法时，您表明您希望实现类可能希望提供它们自己的非默认实现。同样，在基类中省略它，声明了默认方法应该足以满足所有实现类的期望。类似地，可以使用抽象声明来强制实现类提供它们自己的实现。同样，我认为这传达了很多关于程序员期望如何使用代码的信息。如果我同时编写基类和实现类并且发现自己使用 new 我会认真重新考虑不在父类中使方法为虚拟的决定并明确声明我的意图。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-10-01T22:24:02.517

**virtual / override**告诉编译器这两个方法是相关的，并且在某些情况下，当您认为您正在调用第一个（虚拟）方法时，实际上调用第二个（覆盖）方法是正确的。这是多态性的基础。

```
(new SubClass() as BaseClass).VirtualFoo() 
```

将调用子类的重写 VirtualFoo() 方法。

**new**告诉编译器您正在向派生类添加一个与基类中的方法同名的方法，但它们彼此没有关系。

```
(new SubClass() as BaseClass).NewBar() 
```

将调用 BaseClass 的 NewBar() 方法，而：

```
(new SubClass()).NewBar() 
```

将调用子类的 NewBar() 方法。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-01T22:11:50.923

override关键字和new关键字的区别在于前者做方法覆盖，后者做方法隐藏。

查看以下链接以获取更多信息...

[MSDN](http://msdn.microsoft.com/library/default.asp?url=/library/en-us/csref/html/vcwlkversioningtutorial.asp) 和 [其他](http://www.akadia.com/services/dotnet_polymorphism.html)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-07-19T06:51:47.620

*   `new`关键字用于隐藏。- 表示您在运行时隐藏您的方法。输出将基于基类方法。
*   `override`为压倒一切。- 表示您正在使用基类的引用调用派生类方法。输出将基于派生类方法。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-09-06T07:30:48.733

我的解释版本来自使用**属性**来帮助理解差异。

`override`很简单，对吧？基础类型*覆盖*父类型。

`new`也许是误导（对我来说是这样）。使用属性更容易理解：

```
public class Foo
{
    public bool GetSomething => false;
}

public class Bar : Foo
{
    public new bool GetSomething => true;
}

public static void Main(string[] args)
{
    Foo foo = new Bar();
    Console.WriteLine(foo.GetSomething);

    Bar bar = new Bar();
    Console.WriteLine(bar.GetSomething);
} 
```

使用调试器你会注意到它`Foo foo`有**2 个** `GetSomething`属性，因为它实际上有 2 个版本的属性，`Foo`'s 和`Bar`'s，并且要知道要使用哪一个，c#“选择”当前类型的属性。

如果你想使用 Bar 的版本，你会使用 override 或 use`Foo foo`代替。

`Bar bar`只有**1**，因为它想要**全新**的行为`GetSomething`。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-12-05T19:59:34.197

不使用任何方法标记方法意味着：使用对象的编译类型绑定此方法，而不是运行时类型（静态绑定）。

使用方法标记方法`virtual`：使用对象的运行时类型绑定此方法，而不是编译时类型（动态绑定）。

在派生类中标记基类`virtual`方法`override`意味着：这是使用对象的运行时类型绑定的方法（动态绑定）。

在派生类中标记基类`virtual`方法`new`意味着：这是一个新方法，与基类中的同名方法没有关系，应该使用对象的编译时类型（静态绑定）进行绑定。

在派生类中不标记基类`virtual`方法意味着：这个方法被标记为`new`（静态绑定）。

标记一个方法`abstract`意味着：这个方法是虚拟的，但我不会为它声明一个主体，它的类也是抽象的（动态绑定）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-06-30T10:17:30.330

```
using System;  
using System.Text;  

namespace OverrideAndNew  
{  
    class Program  
    {  
        static void Main(string[] args)  
        {  
            BaseClass bc = new BaseClass();  
            DerivedClass dc = new DerivedClass();  
            BaseClass bcdc = new DerivedClass();  

            // The following two calls do what you would expect. They call  
            // the methods that are defined in BaseClass.  
            bc.Method1();  
            bc.Method2();  
            // Output:  
            // Base - Method1  
            // Base - Method2  

            // The following two calls do what you would expect. They call  
            // the methods that are defined in DerivedClass.  
            dc.Method1();  
            dc.Method2();  
            // Output:  
            // Derived - Method1  
            // Derived - Method2  

            // The following two calls produce different results, depending
            // on whether override (Method1) or new (Method2) is used.  
            bcdc.Method1();  
            bcdc.Method2();  
            // Output:  
            // Derived - Method1  
            // Base - Method2  
        }  
    }  

    class BaseClass  
    {  
        public virtual void Method1()  
        {  
            Console.WriteLine("Base - Method1");  
        }  

        public virtual void Method2()  
        {  
            Console.WriteLine("Base - Method2");  
        }  
    }  

    class DerivedClass : BaseClass  
    {  
        public override void Method1()  
        {  
            Console.WriteLine("Derived - Method1");  
        }  

        public new void Method2()  
        {  
            Console.WriteLine("Derived - Method2");  
        }  
    }  
} 
```

# c++ - 如何在 Linux 平台上创建用于用 C++ 编写的临时文件？

> ID：159983
> 
> 赞同：11
> 
> 时间：2008-10-01T22:08:08.700
> 
> 标签：c++, linux, temporary-files

在 C++ 中，在 Linux 上，我如何编写一个函数来返回一个临时文件名，然后我可以打开该文件名进行写入？

文件名应尽可能唯一，以便使用相同函数的另一个进程不会获得相同的名称。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-01T22:13:18.673

使用标准库“mktemp”函数之一：mktemp/mkstemp/mkstemps/mkdtemp。

编辑：普通 mktemp 可能不安全 - mkstemp 是首选。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-01T22:14:34.847

tmpnam() 或任何给你一个名字的东西都容易受到竞争条件的影响。使用为此目的设计的返回句柄的东西，例如 tmpfile()：

```
 #include <stdio.h>

   FILE *tmpfile(void); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-09-21T18:39:14.677

GNU libc 手册讨论了可用的各种选项及其注意事项：

[http://www.gnu.org/s/libc/manual/html_node/Temporary-Files.html](http://www.gnu.org/s/libc/manual/html_node/Temporary-Files.html)

长话短说，正如其他人所提到的，应该只使用 mkstemp() 或 tmpfile() 。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-01T22:14:30.993

人 tmpfile

> tmpfile() 函数以二进制读/写 (w+b) 模式打开一个唯一的临时文件。该文件将在关闭或程序终止时自动删除。ote

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T22:15:07.640

mktemp 应该可以工作，否则可以使用大量可用库之一来生成 UUID。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-01T22:15:29.963

C 标准库中的[tmpnam()](http://www.cplusplus.com/reference/clibrary/cstdio/tmpnam.html)函数就是为了解决这个问题而设计的。还有 tmpfile()，它返回一个打开的文件句柄（并在您关闭它时自动删除它）。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-10-01T22:09:09.573

您应该简单地检查您尝试写入的文件是否已经存在。这是一个锁定问题。文件也有所有者，所以如果你做对了，错误的进程将无法写入它。

# python - Ruby 和 Python 版本的“self”有什么区别？

> ID：159990
> 
> 赞同：6
> 
> 时间：2008-10-01T22:09:16.013
> 
> 标签：python, ruby, language-features

我已经完成了一些 Python，但刚刚开始使用 Ruby
，我可以很好地解释这两种语言中“self”之间的区别。

**乍一看很明显：**
Self 不是 Python 中的关键字，但无论你怎么称呼它，都有一个“类似自我”的值。
Python 方法接收 self 作为显式参数，而 Ruby 没有。
Ruby 有时会使用点符号将方法显式定义为 self 的一部分。

**最初的谷歌搜索显示**
[http://rubylearning.com/satishtalim/ruby_self.html](http://rubylearning.com/satishtalim/ruby_self.html)
[http://www.ibiblio.org/g2swap/byteofpython/read/self.html](http://www.ibiblio.org/g2swap/byteofpython/read/self.html)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T23:32:01.760

Python 旨在支持的不仅仅是面向对象的编程。在方法和函数之间保留相同的接口可以让两种样式更清晰地互操作。

Ruby 从一开始就被构建为面向对象的。甚至文字也是对象（评估 1.class 并得到 Fixnum）。该语言的构建使得 self 是一个保留关键字，无论您身在何处都返回当前实例。

如果您在某个类的实例方法中，则 self 是对所述实例的引用。

如果您在类本身的定义中（而不是在方法中），那么 self 就是类本身：

```
class C
  puts "I am a #{self}"
  def instance_method
    puts 'instance_method'
  end
  def self.class_method
    puts 'class_method'
  end
end 
```

在类定义时，将打印“I am a C”。

直接的“def”定义了一个实例方法，而“def self.xxx”定义了一个类方法。

```
c=C.new

c.instance_method
#=> instance_method
C.class_method
#=> class_method 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-03T03:24:23.190

尽管 webmat 声称，Guido[写道](http://markmail.org/message/n6fs5pec5233mbfg)，显式自我“不是实现黑客——它是一种语义设备”。

> 方法定义签名中显式 self 的原因是语义一致性。如果你写
> 
> C类：def foo（self，x，y）：...
> 
> 这真的和写*一样*
> 
> C类：通过
> 
> def foo(self, x, y): ... C.foo = foo

这是一个有意的设计决定，而不是在以后引入 OO 行为的结果。

Python 中的一切都是对象，包括文字。

另请参阅[为什么必须在方法定义和调用中显式使用“self”？](http://effbot.org/pyfaq/why-must-self-be-used-explicitly-in-method-definitions-and-calls.htm)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-01T22:16:33.237

好吧，我对 Ruby 了解不多。但是关于 Python 的“self”的明显一点是它不是一个“关键字”......它只是一个发送到你的方法的参数的名称。

您可以为此参数使用任何您喜欢的名称。“自我”只是一个约定。

例如 ：

```
class X :
    def __init__(a,val) :
        a.x = val
    def p(b) :
        print b.x

x = X(6)
x.p() 
```

在终端上打印数字 6。在构造函数中，self 对象实际上被称为 a。但是在 p() 方法中，它被称为 b。

更新：2008 年 10 月，Guido 指出，为了让 Python 装饰器足够通用以处理纯函数、方法或类方法，还需要有一个显式的 self：http: [//neopythonic.blogspot.com/2008/10/why -explicit-self-has-to-stay.html](http://neopythonic.blogspot.com/2008/10/why-explicit-self-has-to-stay.html)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-01T22:34:42.850

self 仅用作约定，您可以使用 spam、bacon 或 sausage 代替 self 并获得相同的结果。这只是传递给绑定方法的第一个参数。但坚持使用 self ，因为它会混淆其他人和一些编辑。************