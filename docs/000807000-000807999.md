# StackOverflow 问答 000807000-000807999

# c# - C#/.NET - WinForms - 实例化表单而不显示它

> ID：807005
> 
> 赞同：23
> 
> 时间：2009-04-30T13:47:56.090
> 
> 标签：c#, .net, winforms, events, visibility

我在加载事件期间将表单的可见性更改为 false，并且表单仍然显示自己。绑定 this.Visible = false; 的正确事件是什么？到？我想实例化 Form1 而不显示它。

```
using System;
using System.Windows.Forms;

namespace TestClient
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }

        private void Form1_Load(object sender, EventArgs e)
        {
            this.Visible = false;
        }

    }
} 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-30T14:02:44.637

无论您在显示表单之前尝试设置 Visible 属性多少，它都会弹出。据我了解，这是因为它是当前 ApplicationContext 的 MainForm。让表单自动加载但在应用程序启动时不显示的一种方法是更改​​ Main 方法。默认情况下，它看起来像这样（.NET 2.0 VS2005）：

```
[STAThread]
static void Main()
{
    Application.EnableVisualStyles();
    Application.SetCompatibleTextRenderingDefault(false);
    Application.Run(new Form1());
} 
```

如果您改为这样做，应用程序将启动，加载您的表单并运行，但表单不会显示：

```
[STAThread]
static void Main()
{
    Application.EnableVisualStyles();
    Application.SetCompatibleTextRenderingDefault(false);
    Form1 f = new Form1();
    Application.Run();        

} 
```

我不完全确定这有什么用，但我希望你知道；o)

更新：您似乎不需要将 Visible 属性设置为 false，或提供 ApplicationContext 实例（将在“幕后”为您自动创建）。相应地缩短了代码。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2012-07-28T19:10:57.983

我知道这是一个老问题，但我只是偶然发现了它，很惊讶没有人提到[`SetVisibleCore`](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.setvisiblecore%28v=vs.90%29.aspx)：

```
bool isVisibleCore = false;
protected override void SetVisibleCore(bool value)
{
    base.SetVisibleCore(isVisibleCore);
} 
```

在该代码段中，只要`isVisibleCore`保持为 false，表单将保持不可见。如果在实例化表单时将其设置为 false，则不会像`Visible = false`在 Shown 事件中设置那样获得短暂的可见性。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-02-08T07:35:13.620

我花了一些时间才找到一个正常工作的解决方案。

在属性窗口下将名为 WindowState 的属性设置为 Minimized 并将 ShowInTaskbar 设置为 False。一旦您的表单完全加载，请在下面的代码行中调用。

```
 this.ShowInTaskbar = true;
        this.WindowState = System.Windows.Forms.FormWindowState.Maximized;
        //this.WindowState = System.Windows.Forms.FormWindowState.Normal; 
```

PS：此解决方案在 Visual C# 2008 Express Edition 上测试

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-12-08T23:51:25.363

在设计时将 Opacity 属性设置为 0 并在要显示表单时设置回 100 怎么样？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-01-21T10:30:35.400

我可以接受的解决方案，因此创建表单并在创建时调用 on_load。将 WindowState 设置为最小化，然后在加载时将可见设置为 false 并将 windowstate 设置为正常

```
private void Form1_Load(object sender, EventArgs e)
{
        this.Visible = false;
        this.WindowState = FormWindowState.Normal;
} 
```

什么不起作用：

SetVisibleCore 覆盖解决方案未创建表单

以及

```
Application {
 Form1 f = new Form1();
 Application.Run(); 
```

):

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-10-04T00:06:16.127

对于无闪烁的 Shown 解决方案，还要在加载期间将表单的位置设置为屏幕外：

```
private Point startuplocation;

private void Form1_Load(object sender, EventArgs e)
{
    this.startuplocation = this.Location;
    this.Location = new Point(-1000, -1000);
}

private void Form1_Shown(object sender, EventArgs e) //fires first time shown
{
    this.Visible = false;
    this.Location = this.startuplocation;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-30T13:51:04.803

只需创建一个实例，`Form1`不要调用方法来显示/显示它。但我敢打赌你做错了什么。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-30T13:51:41.340

尝试 VisibleChanged 事件。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-30T13:52:07.407

我的建议是在 IntializeComponent() 调用之后的 _Show 事件之前的事件中实例化表单，例如构造函数。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-30T13:56:53.480

显示的事件可能会给您想要的。尽管表格会在隐藏之前“闪烁”一秒钟。

```
private void Form1_Shown(object sender, EventArgs e)
    {
        this.Visible = false;
    } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-30T14:06:55.717

如果这是您的主要形式，那么可能没有比 Shown 事件更好的地方了。但在这种情况下，你会得到闪烁。

我找不到一个好地方来阻止正在运行的主窗体至少快速显示。即使在加载事件中激活的计时器也不会这样做。

如果它是辅助表单，只需创建它但不显示它。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-30T13:51:27.063

你有没有尝试过

```
this.Hide(); 
```

在`form_load`或`form_activated`事件中

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-30T13:56:39.300

在构造函数上设置可见性，在 init 之后然后 this.Show() 之后

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-30T13:58:58.450

InitializeComponent() 设置 this.Visible = true，因为您指定了表单应该在设计器中可见（或者默认为该表单）。您应该在设计器中将 Visible 设置为 false，它不会被 InitializeComponent() 调用。然后，您可以随时使其可见。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-30T14:01:31.610

拥有`.Visible = false`或`Hide()`在`Load`事件中将导致您的表单短暂显示，因为在它变得物理可见和`Load`事件被触发之间存在时间，尽管文档中的说法相反。

你在打电话`Show()`还是在`ShowDialog()`什么地方？我不确定这种行为是否仍然存在，但至少在框架的过去版本中，调用`ShowDialog()`并没有触发`Load`事件，所以也许这就是你的问题（尽管我认为调用`ShowDialog()`然后隐藏模式表单会很糟糕实践！）

如果您必须为您尝试执行的任何操作创建句柄（以及控件的句柄），更好的做法是将 设置`StartLocation`为`Manual`，然后将该`Position`属性设置为屏幕外位置。这将创建并显示表单，同时使其对用户不可见。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-11-23T15:05:57.777

是的，与应用程序视觉相比，从代码角度来看，真正优雅的一种方式是通过隐藏在构造函数/加载事件中来闪烁表单。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-03-06T01:33:03.367

我同意这真的很令人抓狂，因为 Winform 在初始化一堆控件或填充大 DataGridView 或其他任何东西时通常看起来并不漂亮。您仍然需要存在窗口句柄才能执行此操作，从而创建已提到的所有问题。

这里有一些对我有用的东西，你有两个选择：你可以隐藏你的主窗体直到它准备好，或者你可以显示一些小闪屏让你的用户知道你正在处理它。享受。

```
public partial class MainForm : Form
{
    public MainForm()
    {
        InitializeComponent();
    }
    Size mDeferredSize;
    protected override void OnHandleCreated(EventArgs e)
    {
        // Capture the "real" size...
        mDeferredSize = Size;
        // and set it to nothing...
        Size = new Size(0, 0);
        DoSomeUglyInitialization(showOptionalSplash: true);
        Size = mDeferredSize; // ...and now put it back to the original size    
        base.OnHandleCreated(e);
    }
    private void DoSomeUglyInitialization(bool showOptionalSplash)
    {
        MySplash splash = null; 
        if (showOptionalSplash)
        {
            // We have made some borderless form class with a logo or something...
            splash = new MySplash(); 
            splash.Show();
        }
        // vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv
        // Initialization that REQUIRES A HANDLE, e,g,
        // we might be creating a bunch of controls, or 
        // populating a big DataGridView. Whatever it is,
        // we don't want everyone looking at our biz.
        System.Threading.Thread.Sleep(2500); // (Here simulated...)
        // ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        splash?.Dispose();      
    }
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2018-09-22T17:29:14.527

我为表单设置了这三个属性设置：

```
ShowInTaskbar = false
ShowIcon = false
WindowState = Minimized 
```

# c# - 在未激活的应用程序中模拟鼠标移动/单击/按键

> ID：807010
> 
> 赞同：3
> 
> 时间：2009-04-30T13:49:14.463
> 
> 标签：c#, process, keypress, sendmessage

我知道如何模拟鼠标和键盘事件，但它们的行为就像用户做了它们一样，所以它们会影响活动的窗口。我需要的是模拟其中一个输入，但在一个不活动的窗口中。

我并不是说它被最小化了，例如，想象一下，你有 msPaint 和记事本。记事本在油漆前面。并且您想在绘图窗口的某些坐标中模拟鼠标单击，但不将其设置为活动状态，从而使用户可以继续使用位于绘图前的记事本。

这可能吗？谢谢！

我试过这个：

```
 const int WM_KEYDOWN = 0x100;
        Thread.Sleep(5000);
        Process x = Process.Start(@"C:\WINDOWS\NOTEPAD.EXE");
        PInvokes.PlatformInvokeUSER32.SendMessage(x.MainWindowHandle, WM_KEYDOWN, ((int)Keys.W), 0); 
```

但它不起作用 =( 什么都不做 :(

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T13:58:45.410

您可以尝试[UI 自动化 API](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fms747327.aspx&ei=SK75Sdy3KJi6jAf38pihAw&rct=j&q=microsoft+ui+automation&usg=AFQjCNHsMCv84Cc5H5kxooxXhtG7bucO4Q)。它还支持遗留应用程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T14:23:49.217

也许尝试使用 PostMessage 函数：

```
 [DllImport("user32.dll", CharSet=CharSet.Auto)] 
    private static extern int PostMessage(
            int hWnd, int msg, int wParam, IntPtr lParam); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-15T23:20:22.063

根据目标应用程序，可能会有很多问题。某些应用程序在 WM_KEYDOWN 或 WM_KEYUP 而不是 WM_CHAR 上触发。此外，密钥可能已经关闭并被忽略。对于像网络浏览器这样的目标，您需要获得正确的窗口句柄。Winspector 可以为您获取。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-01T18:27:19.083

您的代码将不起作用，因为 SendMessage 要求您发送的窗口处于活动状态。试试 PostMessage。

# ruby - Ruby: How do I invoke a function via an object reference?

> ID：807011
> 
> 赞同：1
> 
> 时间：2009-04-30T13:49:21.843
> 
> 标签：ruby, idioms, method-dispatch

Consider this contrived example:

```
# Dispatch on value of fruit_kind:

TYPE_A = :apple
TYPE_B = :banana
TYPE_C = :cherry

eating_method = nil

case fruit_kind
  # Methods to use for different kinds of fruit (assume these are
  #  already defined)
  when TYPE_A then eating_method = bite
  when TYPE_B then eating_method = peel
  when TYPE_C then eating_method = om_nom_nom
end 
```

Now I'd like to invoke the target of `eating_method` with some arguments:

```
# Doesn't work; this tries to invoke a method called "eating_method",
# not the reference I defined earlier.
eating_method(some_fruit) 
```

What's the right way to do this in Ruby?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-30T14:03:07.473

Use `send`. Send takes the function name, so use symbols:

```
case fruit_kind
  # Methods to use for different kinds of fruit (assume these are
  #  already defined)
  when TYPE_A then eating_method = :bite
  when TYPE_B then eating_method = :peel
  when TYPE_C then eating_method = :om_nom_nom
end

send(eating_method, some_fruit) 
```

* * *

## EDIT:

By the way, did you know you can make that `case` a little prettier by doing something like this:

```
eating_method = case fruit_kind
  # Methods to use for different kinds of fruit (assume these are
  #  already defined)
  when TYPE_A then :bite
  when TYPE_B then :peel
  when TYPE_C then :om_nom_nom
  else nil
end 
```

Or, as Sii mentions, use a hash instead:

```
fruit_methods = {:apple => :bite, :banana => :peel, :cherry => :om_nom_nom}
send(fruit_methods[fruit_kind], some_fruit) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T14:28:12.873

In Ruby you can use classes and methods as if they are values without too much work, thus you can reduce the amount you actually have to manage in your example to a single definition of Class -> Method and use a generalized algorithm to work with that definition.

Suppose each of your types implement the methods you specify, e.g. Apple.bite(), Banana.peel(), and Cherry.om_nom_nom() are all defined. Also suppose that *fruit* is an instance of *fruit_kind* You can manage the mapping in one place and use a generalized method to do all of the Class specific method evaluation like so:

```
fruit_table = {Apple => :bite, 
               Banana => :peel,
               Cherry => :om_nom_nom}
eating_method = fruit.method(fruit_table[fruit.type])
eating_method.call 
```

Note that the reference *eating_method* is an instance of a method object specific to the instance of fruit. You could pull the table definition out to be a class variable, but you would want to evaluate fruit.method in the context of each time that you are deciding which function to call on an instance you are passed.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T14:03:43.073

The wording confuses me greatly.

You probably want [Object#send](http://www.ruby-doc.org/core/classes/Object.html#M000334) though.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T14:38:59.867

The Ruby object model lets you call methods dynamically using the `Object#send` method which takes a symbol as the method you want to call.

So if you were to have a class called FruitEater you could send the eating method as:

```
 f = FruitEater.new

# Dispatch on value of fruit_kind:

TYPE_A = :apple
TYPE_B = :banana
TYPE_C = :cherry

eating_method = nil

case fruit_kind
  # Methods to use for different kinds of fruit (assume these are
  #  already defined)
  when TYPE_A then eating_method = :bite
  when TYPE_B then eating_method = :peel
  when TYPE_C then eating_method = :om_nom_nom
end

f.send(eating_method) 
```

# c - 在执行系统调用后用 C 语言回答查询

> ID：807013
> 
> 赞同：-1
> 
> 时间：2009-04-30T13:49:35.120
> 
> 标签：c

我做了一个应用程序，它创建一个分区并使用系统调用格式化磁盘......

在这个过程的中间有一个查询要求输入磁盘的大小......我可以在我的应用程序中做些什么来自动回答那个查询？

你能帮我么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-28T20:02:21.873

这当然是可能的，例如[libexpect](http://expect.nist.gov/)但我从未尝试过（但谷歌发现似乎是一个[很好的例子](http://www.developerweb.net/forum/showthread.php?t=3816)）。在我的 Debian 机器上，`man libexpect`说：

```
 libexpect - programmed dialogue library with interactive programs

    This  library  contains functions that allow Expect to be used as a Tcl
    extension or to be used directly from C or C++ (without  Tcl). 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-28T18:19:36.997

也许您可以使用 system() 运行诸如**期望**之类的实用程序来控制进程

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-01T03:51:02.210

根据您的操作系统（例如，Windows 可以这样做），您可以将程序的标准输入重定向为来自程序的输出。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-30T14:16:08.380

幸运的是，您无能为力。:)

# debugging - 如何判断哪个任务死了？

> ID：807017
> 
> 赞同：2
> 
> 时间：2009-04-30T13:50:58.330
> 
> 标签：debugging, embedded, watchdog

我有一个嵌入式系统，它有多个（> 20）任务以不同的优先级运行。我也有运行看门狗任务来检查所有其他任务是否没有卡住。我的看门狗正在工作，因为每逢蓝月亮，它都会重新启动系统，因为任务没有签入。

如何确定哪个任务死亡？

我不能只责怪最旧的任务踢看门狗，因为它可能被没有让步的更高优先级任务推迟。

有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T14:25:40.413

这是先发制人吗？我之所以这么认为，是因为如果其他任务中的一个卡住了，那么看门狗任务就不会运行。

您没有提及操作系统，但是，如果看门狗任务可以检查单个任务是否尚未签入，则*每个*任务和看门狗之间必须有单独的通信通道。

您可能必须修改看门狗以某种方式转储尚未签入的任务编号*并*转储任务控制块和内存，以便您可以进行事后分析。

根据操作系统，这可能容易或困难。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-01T05:47:47.890

每个任务的看门狗要求较高优先级的任务产生足够的时间，以便所有人都可以踢看门狗。要确定哪个任务有问题，您必须找到使其他任务挨饿的任务。您需要测量看门狗检查之间的任务执行时间，以找出真正的罪魁祸首。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-03T09:42:39.697

甚至我最近几周都在处理看门狗重置问题。但幸运的是，在 ramdump 文件中（在 ARM 开发环境中），它有一个中断处理程序跟踪缓冲区，在每个中断处都包含 PC 和 SLR。因此，从跟踪缓冲区中，我可以准确地找出在 WD 重置之前运行的代码部分。

我认为，如果您在每次中断时都有相同的存储 PC、SLR 的机制，那么您可以准确地找出罪魁祸首任务。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T14:26:27.060

根据您的系统和操作系统，可能会有不同的方法。我使用的一种非常低级的方法是在每个任务运行时使 LED 闪烁。您可能需要在 LED 上放置一个示波器，以查看非常快速的任务切换。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T16:48:59.307

对于中断驱动的看门狗，您只需让任务切换器在每次更改时更新当前正在运行的任务编号，以便您识别哪个没有产生。

但是，您建议您自己将看门狗写为任务，所以在重新启动之前，看门狗肯定可以识别饥饿的任务吗？您可以将其存储在热重启后仍然存在的内存中，或通过调试接口发送。这样做的问题是饥饿的任务可能不是有问题的任务：您可能想知道最后几个任务切换（和时间）以便确定原因。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T17:32:19.623

一个简单的餐巾纸背面方法将是这样的：

```
int8_t wd_tickle[NUM_TASKS]

void taskA_main()
{
   ...
   // main loop
   while(1) {
     ...
     wd_tickle[TASKA_NUM]++;
   }
}

... tasks B, C, D... follow similar pattern

void watchdog_task()
{
   for(int i= 0; i < NUM_TASKS; i++) {
     if(0 == wd_tickle[i]) {
       // Egads! The task didn't kick us! Reset and record the task number
     }
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-09T11:14:47.913

你的系统是如何工作的？我总是结合使用软件和硬件看门狗。让我解释...

我的示例假设您正在使用抢占式实时内核，并且您的 cpu/微控制器中有看门狗支持。如果在一定时间内没有被踢，该看门狗将执行重置。你想检查两件事：

1) 周期性系统定时器（“RTOS 时钟”）正在运行（如果没有，“睡眠”之类的功能将不再起作用，您的系统将无法使用）。

2）所有线程都可以在合理的时间内运行。

我的 RTOS (www.lieron.be/micror2k) 提供了在 RTOS 时钟中断处理程序中运行代码的可能性。这是您刷新硬件看门狗的唯一地方，因此您确定时钟一直在运行（如果不是，看门狗将重置您的系统）。

在空闲线程（始终以最低优先级运行）中，刷新“软件看门狗”。这只是将变量设置为某个值（例如 1000）。在 RTOS 时钟中断（启动硬件看门狗的地方）中，递减并检查该值。如果它达到 0，则意味着空闲线程没有运行 1000 个时钟滴答并且您重新启动系统（可以通过在中断处理程序中无限循环以让硬件看门狗重新启动来完成）。

现在回答你原来的问题。我假设系统时钟一直在运行，所以是软件看门狗重置了系统。在 RTOS 时钟中断处理程序中，您可以进行一些“统计收集”，以防出现软件看门狗情况。无需重置系统，您可以查看每个时钟滴答（问题发生后）正在运行的线程，并尝试找出发生了什么。这并不理想，但会有所帮助。

另一种选择是添加多个不同优先级的软件看门狗。让空闲线程将变量 A 设置为 1000，并让（专用）中等优先级线程设置变量 B。在 RTOS 时钟中断处理程序中，检查这两个变量。有了这些信息，您就知道循环线程的优先级是高于“中”还是低于“中”。如果您愿意，可以添加第三个或第四个或您喜欢多少个软件看门狗。最坏的情况，为每个使用的优先级添加一个软件看门狗（尽管会花费你尽可能多的额外线程）。

# c# - ComboBox 绑定到枚举类型的值，同时还具有“空白”条目？

> ID：807030
> 
> 赞同：4
> 
> 时间：2009-04-30T13:54:03.597
> 
> 标签：c#, .net, winforms, combobox, enums

如果我将 WinForms ComboBox 绑定到枚举类型的值，即

```
combo1.DropDownStyle = ComboBoxStyle.DropDownList;
combo1.DataSource = Enum.GetValues(typeof(myEnumType)); 
```

谁知道我怎样才能获得相同的结果，而除了匹配每个枚举值的条目之外，我还可以有一个空白条目表示没有选择？

我不能简单地为枚举类型添加一个特殊值，因为这必须灵活地处理任何枚举类型。

我会很感激你的帮助。

**编辑：**我应该明确我想绑定实际的枚举值而不是它们的名称。如果绑定了实际的枚举值，则 ComboBox 负责调用它们的 ToString() 以获取要显示的文本。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T14:16:02.933

不确定你们是否尝试过所有您发布的代码，但您无法添加项目来执行数据绑定 ComboBox。这是winforms，不是WPF，所以没有“DataBind”功能。

你可以这样做：

```
public static string[] GetEnumValues<T>(bool includeBlank) 
{
    List<string> values = new List<string>((Enum.GetValues(typeof(T)) as T[]).Select(t => t.ToString()));

    if (includeBlank)
    {
        values.Insert(0, string.Empty);
    }

    return values.ToArray();
} 
```

然后

```
combo.DataSource = GetEnumValues<myEnumType>(true); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T14:04:37.440

你可以尝试这样的事情：

（**编辑以反映 Brad_Z 的出色建议**）

```
static IEnumerable<String> getValues<T>(String initialValue)
{
    yield return initialValue;

    foreach (T t in Enum.GetValues(typeof(T)))
        yield return t.ToString();
}

static IEnumerable<String> getValues<T>()
{
    return getValues<T>(String.Empty);
} 
```

这将允许您像这样绑定到此函数的结果：

```
combo1.DataSource = getValues<myEnumType>().ToArray(); 
```

或者像这样，如果您希望为初始项目指定不同的值：

```
combo1.DataSource = getValues<myEnumType>("Select").ToArray(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T15:59:51.950

（请参阅我对我澄清不想绑定到字符串集合的问题的编辑）。

经过更多的摆弄，以下怪物似乎起作用了。combo1.SelectedItem 是对象类型，可以是 DBNull 或（装箱？）枚举值。这段代码是否可取？

```
combo1.DataSource = (new object[] { DBNull.Value }
                        .Concat(Enum.GetValues(refToAnEnumType)
                            .Cast<object>())).ToList() 
```

**编辑：**我看到亚当和安德鲁的方法可以很容易地适应做同样的事情。多谢你们！

# algorithm - 进化图像匹配模拟的新适应度测量

> ID：807034
> 
> 赞同：4
> 
> 时间：2009-04-30T13:56:20.487
> 
> 标签：algorithm, genetic-algorithm, genetic-programming, evolutionary-algorithm

我相信很多人已经看过使用遗传算法生成与样本图像匹配的图像的演示。你从噪声开始，逐渐变得越来越接近目标图像，直到你有一个或多或少精确的副本。

然而，我看到的所有示例都使用了相当简单的逐像素比较，从而导致最终图像的“淡入”相当可预测。我正在寻找的是更新颖的东西：一种比天真的方法更接近我们所认为的“相似”的适应度测量方法。

我没有具体的结果——我只是在寻找比默认值更“有趣”的东西。建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-02T11:33:17.957

我假设您在谈论类似[Roger Alsing 的程序](http://rogeralsing.com/2008/12/07/genetic-programming-evolution-of-mona-lisa/)。

我实现了这个版本，所以我也对替代健身功能感兴趣，尽管我是从提高性能而不是美学的角度来研究它的。由于进化过程的性质，我预计总会有一些“淡入”元素（尽管调整进化运算符可能会影响它的外观）。

除了小图像之外，逐像素比较可能会很昂贵。例如，我使用的 200x200 像素图像有 40,000 像素。每个像素有三个值（R、G 和 B），即必须将 120,000 个值合并到单个图像的适应度计算中。在我的实现中，我在进行比较之前缩小图像，以减少像素。权衡是稍微降低了进化图像的准确性。

在研究替代适应度函数时，我遇到了一些使用[YUV 颜色空间](http://en.wikipedia.org/wiki/YUV)而不是 RGB 的建议，因为这更符合人类的感知。

我的另一个想法是只比较随机选择的像素样本。我不确定如果不尝试它会有多好。由于每次评估所比较的像素都不同，因此将具有维持种群内多样性的效果。

除此之外，您还处于计算机视觉领域。我希望这些依赖于特征提取的技术每张图像的成本会更高，但如果它们导致需要更少的生成来获得可接受的结果，它们总体上可能会更快。您可能想要调查[PerceptualDiff](http://pdiff.sourceforge.net/)库。此外，[此页面](http://www.lac.inpe.br/~rafael.santos/JIPCookbook/6050-howto-compareimages.jsp)显示了一些 Java 代码，可用于根据特征而不是像素来比较图像的相似性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T14:47:08.023

> 一种比天真的方法更接近我们所认为的“相似”的适应度度量。

在软件中实施这样的措施绝对是不平凡的。谷歌“人类视觉模型”，“感知误差度量”的一些起点。您可以回避这个问题 - 只需将候选图像呈现给人类以选择最佳图像，尽管这对人类来说可能有点无聊。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T14:19:34.907

我还没有看过这样的演示（也许你可以链接一个）。但是，您的描述中可能会引发一个有趣的一些原始想法：

*   三种并行运行的不同算法，可能是 RGB 或 HSV。
*   在运行期间移动、旋转或以其他方式稍微更改目标图像。
*   适合度基于像素之间的对比度/值差异，但不知道实际颜色。
*   ...然后用正确的颜色“填充”单个像素？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-01T12:06:53.080

我同意其他贡献者的观点，即这不是微不足道的。我还要补充一点，这在商业上非常有价值——例如，希望保护其视觉 IP 的公司将非常高兴能够在互联网上搜索与其徽标相似的图像。

我对此的天真方法是在多个图像上训练模式识别器，每个图像都从目标图像生成，并对其应用一个或多个变换：例如，旋转几度；无论哪种方式，平移几个像素；同一图像的不同尺度；各种模糊和效果（卷积蒙版在这里很好）。我还会为每个图像添加一些随机噪声。样本越多越好。

训练都可以离线完成，因此不会导致运行时性能出现问题。

一旦你训练了一个模式识别器，你可以将它指向 GA 人口图像，并从识别器中获得一些标量分数。

就个人而言，我喜欢[径向基网络](http://en.wikipedia.org/wiki/Radial_basis_network)。快速训练。我会从太多的输入开始，然后通过主成分分析（IIRC）减少它们。输出可能只是相似性度量和相异性度量。

最后一件事; 无论你采用什么方法——你能写博客、发布演示等等吗？让我们知道你是怎么上去的。

# asp.net - UserControl 事件第一次不起作用

> ID：807049
> 
> 赞同：3
> 
> 时间：2009-04-30T13:59:25.203
> 
> 标签：asp.net, events, user-controls

我在网页中动态调用我的用户控件。当我第一次单击用户控件上的按钮时，事件没有触发。当我第二次单击同一个时，事件正在触发..

谁能帮我？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T14:05:44.770

听起来像按钮 OnClick 事件的连接不会在每次页面加载时发生，这是必需的。

您能否保证在添加控件时以及在回传到页面后执行连接？我总是将我的事件挂钩放在 Page_Init 或 Page_Load 事件处理程序中以及任何回发检查之外。尝试在 Handler 连接上放置一个断点，看看断点是否被“命中”两次。

按钮的事件连接看起来类似于：

```
protected void Page_Load(object sender, EventArgs e)
{
    btnSearch.Click += new EventHandler(btnSearch_Click); // breakpoint on this line
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-04T15:00:14.400

控件的客户端 ID 派生自所有使用[INamingContainer](http://msdn.microsoft.com/en-us/library/system.web.ui.inamingcontainer.aspx "命名容器")接口标记的包含控件的 ID。因此，请确保层次结构中的所有控件都具有固定 ID。

例如，如果您在 Repeater 中有一个 Button 控件，则将按钮的 ID 和中继器连接起来以生成按钮的客户端 ID。因此，转发器和按钮在回发时都应该具有相同的 ID。

您可以将第一个请求的 HTML 与第二个请求的 HTML 进行比较，以快速确定这是否是问题所在。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T14:01:10.927

为您动态创建的控件分配一个 ID——否则不会触发任何事件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T14:10:52.557

您是否在按下按钮之前等待下载整页？

这些事件是 ASP.Net 在页面中隐藏的 javascript 函数，在您单击时可能不存在。

# apache-flex - FLEX：在组件上重复背景？

> ID：807051
> 
> 赞同：0
> 
> 时间：2009-04-30T13:59:39.620
> 
> 标签：apache-flex

我想使用小图像并重复它们作为 Flex 中组件的背景。Flex 组件目前有一个 backgroundImage 属性，它允许您传递一个 URL 或一个用作背景的类。还有一个名为 backgroundSize 的属性，您可以将其设置为“auto”，使其成为图像的大小，或 100% 使其拉伸到组件的大小。没有重复选项。所以我从这里下载了一个扩展名为 RepeatingImage 的 SWFLoader 类的类：[http ://renaun.com/flex2/posts/repeatingimage/index.html](http://renaun.com/flex2/posts/repeatingimage/index.html)这个类允许你设置一个源并重复它。我扩展了这个类，使其具有我想用作背景图像的图像的默认来源，我将新类设置为 backgroundImage。并将 backgroundSize 设置为 100%。我在做的时候以为这是一个非常聪明的解决方案，结果发现它不起作用，我这样做时没有设置背景图像？

所以也许我需要改变一些东西才能使我的方法起作用，或者也许有人有不同的方法，无论哪种方式我都希望能够在组件上设置重复的背景图像？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T14:43:57.500

本网站推荐使用 Degrafa。[背景图像重复](http://bjw.co.nz/developer/flex/83-background-image-repeat-in-flex-3)

似乎大多数手动执行此操作的解决方案都涉及使用以下代码重载 updateDisplayList()：取自[Source](http://blog.creacog.co.uk/2007/06/11/tile-or-repeat-an-image-into-a-flex-application-background-ii/)

```
override protected function updateDisplayList(w:Number,h:Number):void
{
    super.updateDisplayList( w, h );

    graphics.clear();               
    graphics.beginBitmapFill( backgroundBitmapData );          
    graphics.drawRect( 0, 0, w, h );  

    ...
} 
```

# cygwin - cygwin + rsync

> ID：807053
> 
> 赞同：38
> 
> 时间：2009-04-30T14:00:24.267
> 
> 标签：cygwin, rsync

我想通过 rsync 在 Solaris 服务器上备份 Win XP 中的目录。我安装了 cygwin，但是当我输入 rsync 时，我得到“找不到命令”。如何安装 rsync？以及如何安装 ssh。我已经将 Poderosa 安装为 ssh 客户端（一种腻子）。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-04-30T14:03:16.990

再次运行 cygwin setup.exe，然后展开类别以找到“rsync”和“ssh”。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2012-11-23T16:51:03.853

容易得多。运行安装程序，单击“Cygwin 安装程序 - 选择软件包”窗口，然后在左上角的“搜索”框中键入“rsync”。在撰写本文时，这显示了三行，其中之一是“Net”。展开 Net，你会发现 rsync。单击圆形箭头图标将其标记为安装，然后单击右下角的下一步。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-30T14:02:30.737

您仍然需要安装 rsync 包。再次运行 setup.exe 并手动检查软件包（它可能在“网络”或“实用程序”中）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-30T14:17:02.980

运行 setup.exe 时，包选择将设置为“默认”。您需要单击顶层圆形箭头图片，直到它显示“安装”或“完整”（我的记忆让我失望），它也会对*所有*子包执行此操作。

第一次单击它时，请等待几秒钟 - 从“默认”到下一个选项有很长的延迟。

这是最好的方法。一直以来，我都在尝试选择单独的软件包，遇到了麻烦，所以我早就养成了安装*所有东西*的习惯。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-30T15:11:12.770

如果你想要的只是 rsync，BackupPC 项目 (OSS) 有一个稍微修改过的 cygwin 的 rsync 版本，它无需完整的 cygwin 安装即可运行，甚至可以通过 IPC$ 远程安装在 PC 上。[http://sourceforge.net/project/showfiles.php?group_id=34854&package_id=88133](http://sourceforge.net/project/showfiles.php?group_id=34854&package_id=88133)

# c# - C#中嵌入的excel用户控件

> ID：807057
> 
> 赞同：0
> 
> 时间：2009-04-30T14:01:14.607
> 
> 标签：c#

我有一个带有嵌入式 excel 工作表和其他网格控件的用户控件（在 c# 中）。我在表单中有这个用户控件。我需要打印表格，但我发现 DevExpress Xtrareport 不支持嵌入式 Excel 工作表。我可以单独打印 excel 工作表，但我需要打印整个表格，而不仅仅是那个 excel 工作表。我该怎么办？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T14:17:53.617

这是一种快速而肮脏的 Print 扩展方法。就缩放表单和所有这些而言，您可以做的还有很多，但这应该可以帮助您入门。此方法将按原样打印表单，并且对用户可见。

```
 public static class FormExtensions
    {
        public static void PrintForm(this Form f)
        {
            PrintDocument document = new PrintDocument();
            document.PrintPage += (o, e) =>
            {
                Bitmap image = new Bitmap(f.Width, f.Height);
                f.DrawToBitmap(image, e.PageBounds);
                e.Graphics.DrawImage(image, new Point(0, 0));
            };
            document.Print();
        }
    } 
```

# asp.net - WCF 从 Windows 服务而不是 Web 应用程序超时

> ID：807060
> 
> 赞同：1
> 
> 时间：2009-04-30T14:01:59.130
> 
> 标签：asp.net, vb.net, wcf, windows-services, timeout

**大家好**

我目前在从 Windows 服务调用 WCF 服务时遇到问题。我的应用程序解决方案看起来像这样。

*   Web 管理控制台（Web 项目）
*   中央控制（Windows 服务）
    *   WCF 服务，以便 Web 管理控制台可以连接到它并对其进行配置
    *   在节点上使用 WCF 的几个调用（窗口服务）
*   节点（Windows 服务）
    *   WCF 服务以允许中央控制 Windows 服务对其进行配置

Web 管理控制台可以访问中央控制 WCF，但中央控制在尝试连接到节点时会超时。在对此进行测试时，我创建了一个 Launcher 应用程序，它是一个简单的 Windows 窗体项目，它创建每个服务的一个实例，并有几个按钮在每个 Windows 服务中使用 WCF 函数（只是为了查看失败的原因）这个 Launcher 应用程序无法与任何一个 Windows 服务对话。这让我很困惑，所以我在 Web 管理控制台中的 Web 窗体中添加了相同的按钮，它通过 WCF 完美地连接到两个 Windows 服务。我知道 WCF 的东西正在工作，因为我可以通过 IE 访问它并查看所有精彩的 XML（很明显，来自 Web 应用程序的调用工作的事实很好地表明它正在启动和运行）

**简而言之** ，我的 Web 应用程序可以使用我的 Windows 服务中的 WCF 服务，但 Windows 窗体和 Windows 服务不能。为什么是这样！？

我在这个项目上几乎已经没有时间了，所以快速回复会很棒！

**技术/代码详细信息** 我没有在应用程序中使用配置文件。一切都是通过代码创建的，我一直在使用相同的代码在任何地方进行 WCF 调用。此外，我还尝试在任何地方关闭安全性，以防万一。此外，我也在各处使用相同的**svcutil**生成的代理文件，以保持一致

**调用节点的示例**

```
Dim Bind As New WSHttpBinding(SecurityMode.None, True)
Bind.CloseTimeout = New TimeSpan(0, 0, 10)
Bind.OpenTimeout = New TimeSpan(0, 0, 10)
Bind.SendTimeout = New TimeSpan(0, 0, 10)
Dim client As New BN.BNodeServiceClient(Bind, New EndpointAddress("http://localhost:27374/Node"))
client.sendMessage("Test Message")
client.Close() 
```

**节点打开其 WCF**

```
BNodeHost = New ServiceHost(GetType(iBNodeService))
BNodeHost.AddServiceEndpoint(GetType(BNodeService), New WSHttpBinding(SecurityMode.None, True), New Uri("http://localhost:27374/Node"))
Dim metadataBehavior As ServiceModel.Description.ServiceMetadataBehavior
metadataBehavior = BNodeHost.Description.Behaviors.Find(Of _
ServiceModel.Description.ServiceMetadataBehavior)()

If metadataBehavior Is Nothing Then
    metadataBehavior = New ServiceModel.Description.ServiceMetadataBehavior()
    metadataBehavior.HttpGetEnabled = True
    metadataBehavior.HttpGetUrl = New Uri("http://localhost:27374/Node")
    BNodeHost.Description.Behaviors.Add(metadataBehavior)
Else
    BNodeHost.Description.Behaviors.Add(metadataBehavior)
End If

BNodeHost.Open() 
```

在我将不同的位设置为适当的 Windows 服务并尝试向其中添加安装程序之前，这一切都有效。安装程序工作正常并安装启动并允许我在 IE 中查看所有 WCF XML 的服务。

您可能会说，我对 WCF 很陌生，这是我第一个使用它的应用程序。基本位几乎是从不使用配置文件的示例中复制/粘贴/更改作业。

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T16:31:33.030

验证 appconfig 中的所有端点是否与管理员 webapp 的 webconfig 中的设置匹配。每一个都设置不同的超时值，即：

```
<system.serviceModel>
        <bindings>
            <wsHttpBinding>
                <binding name="WSHttpBinding_ILookupService" closeTimeout="00:01:00"
                 openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00"
                 bypassProxyOnLocal="false" transactionFlow="false" hostNameComparisonMode="StrongWildcard"
                 maxBufferPoolSize="524288" maxReceivedMessageSize="65536" messageEncoding="Text"
                 textEncoding="utf-8" useDefaultWebProxy="true" allowCookies="false">
                    <readerQuotas maxDepth="32" maxStringContentLength="8192" maxArrayLength="16384"
                     maxBytesPerRead="4096" maxNameTableCharCount="16384" />
                    <reliableSession ordered="true" inactivityTimeout="00:10:00"
                     enabled="false" />
                    <security mode="Message">
                        <transport clientCredentialType="Windows" proxyCredentialType="None"
                         realm="" />
                        <message clientCredentialType="Windows" negotiateServiceCredential="true"
                         algorithmSuite="Default" establishSecurityContext="true" />
                    </security>
                </binding>
            </wsHttpBinding>
        </bindings>
        <behaviors>
            <endpointBehaviors>
                <behavior name="LargeEndpointBehavior">
                    <dataContractSerializer  ignoreExtensionDataObject="true" maxItemsInObjectGraph="2147483647"/>
                </behavior>
            </endpointBehaviors>
        </behaviors>

        <client>
            <endpoint address="http://localhost:59599/LookupService.svc"
             binding="wsHttpBinding" bindingConfiguration="WSHttpBinding_ILookupService"
             contract="FEEALookupServiceReference.ILookupService" name="WSHttpBinding_ILookupService">
                <identity>
                    <dns value="localhost" />
                </identity>
            </endpoint>
        </client>
    </system.serviceModel> 
```

希望有帮助。祝你好运。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-08T14:00:51.163

我无法正确解决这个问题。Windows 服务到 Windows 服务的通信似乎存在问题。有一种方法可以让它在某处发生，但我没时间了，所以我通过将其中一个位（中央控制）转换为普通的 Windows 应用程序并以这种方式安装它来解决它。工作正常，客户很高兴:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-29T22:08:50.907

检查运行 Windows 服务的用户的权限 - 他们喜欢默认使用可能没有足够权限的网络服务。以具有正确权限的专用用户身份运行它们。

并检查 Windows 防火墙。它喜欢阻止您的一些网络连接。我通常只是把它关掉。

# c# - asp.net 程序影响搜索引擎的结果

> ID：807061
> 
> 赞同：0
> 
> 时间：2009-04-30T14:02:13.903
> 
> 标签：c#, asp.net, search-engine

在 Asp.net 中编码时，我可以做些什么来使我的网站在搜索引擎中的一般关键字中名列前茅？（例如：汽车...假设我的网站是 wwww.joshautos123.com）

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T14:05:20.340

这与 ASP.NET Josh 无关，

您需要开始研究一般的 SEO（搜索引擎优化）

这是一个相当广泛的主题（[更多信息在这里](http://en.wikipedia.org/wiki/Search_engine_optimization)）涵盖了从关键字、内容、url 格式和到许多不同站点/资源的交叉链接的所有内容。

如果您只是开发它（并且不负责营销），那么您能做的最好的事情就是将一个设计良好、干净、符合标准的网站放在一起。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T14:08:22.890

您可以按照您可以实现的方式为您的标题、图像等遵循搜索引擎优化指南。无论如何，您可以阅读[**本教程**](http://professionalaspnet.com/archive/2008/08/16/Search-Engine-Optimization-for-ASP.NET-Web-Sites.aspx)，它将对您有所帮助。

更多信息，您可以创建具有良好元标记的良好母版页。它会帮助你...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T14:07:06.373

这对我来说听起来有点“黑帽子”。

搜索引擎优化最重要的方面是内容，所以只要你有很多与“汽车”相关的好、有意义的内容，你就有很好的机会。

接下来，您需要大量可靠的资源来链接到您，并在链接中使用有意义的关键字。还有一大堆 SEO 技巧

在制作 ASP.NET 应用程序时，您可以确保促进 SEO 最佳实践，但归根结底，如果您的网站充满了废话并且人们认为它不值得链接。你不会得到很好的排名。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T14:15:15.900

大多数 SEO 增强功能可以在 asp.net 之外完成。所以只需将正确的标签和单词添加到 aspx 文件中。或者对于动态页面，从内容生成它们。

但是您还应该记住两件事：首先，在一个 url 下运行您的所有系统。并且所有其他的都应该使用 301 重定向到它（例如，使用 301 重定向将[http://joshautos123.com](http://joshautos123.com)重定向到 www.joshautos123.com）
并且不要将子域用于不同的部分（这会分割您的搜索排名）

其次，您应该使用 asp.net mvc。因为 seo 的一个重要部分是正确的内容（例如标题、真实的汽车名称等）在 URL 中。

其余的答案已经说过了....

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T14:38:49.243

尝试访问此网站作为开始[在 ASP.NET 中使用带有母版页的元标记](http://www.codeproject.com/KB/aspnet/PageTags.aspx)

# c# - 文件路径是 url 吗？

> ID：807062
> 
> 赞同：3
> 
> 时间：2009-04-30T14:02:15.650
> 
> 标签：c#, url, file, naming-conventions, filepath

我在代码中有一个变量，可以将文件路径或 url 作为值。例子：

```
http://someDomain/someFile.dat
file://c:\files\someFile.dat
c:\files\someFile.dat 
```

所以有两种表示文件的方法，我不能忽略其中任何一种。这种变量的正确名称是什么：路径、url、位置？

我正在使用第 3 方 api，因此我无法更改语义或分离更多变量。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-30T14:05:53.893

前两个是 URL，第三个是文件路径。当然，file:/// 协议也只是指一个文件。

使用[Uri](http://msdn.microsoft.com/en-us/library/system.uri.aspx)类时，您可以使用[IsFile](http://msdn.microsoft.com/en-us/library/system.uri.isfile.aspx)和[LocalPath](http://msdn.microsoft.com/en-us/library/system.uri.localpath.aspx)属性来处理 file:/// Uris，在这种情况下，您也应该这样命名它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T14:07:04.797

就个人而言，我将有问题的变量称为“fileName”

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T14:12:10.837

实际上，正式的 URL 是 file:///c|/files/someFile.dat

urls 总是以 protocol:// 开头，然后是路径 + 名称，以 '/' 作为分隔符。邪恶的windows IE有时用'\'代替'/'，但正式用法是'/'。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T14:08:08.007

选择一个您将在内部使用的开始。如果您需要支持 URL，请在内部各处使用 URL，并使用任何可以设置变量的方法检查它是否具有文件路径，并立即将其强制为 URL。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T14:05:13.723

如果您使用的路径包含协议“file://”，那么它实际上是一个 url。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T15:04:06.220

如果这些值对您的应用程序不透明，您可能会发现将它们建模为一个类会更好。否则，每当您要对这些值采取行动时，您可能会发现自己正在编写如下代码：

```
if (variable.StartsWith("http://") || variable.StartsWith("file://")) {
  // 处理网址
}
别的 {
  // 处理文件路径
}

```

您可以将一些有关值处理的功能折叠到您的类中，但最好将其视为不可变值类型。

为您的类使用描述性名称，例如 FileLocation 或任何适合您命名法的名称。然后很自然地声明名为 fileLocation 或 inputFileLocation 的 FileLocation 变量，甚至如果你草率的话，甚至是 fl。

# c++ - object* foo(bar) 有什么作用？

> ID：807073
> 
> 赞同：3
> 
> 时间：2009-04-30T14:03:52.247
> 
> 标签：c++, pointers

对于某些 C 类：

```
C* a = new C();

C* b(a);  //what does it do?

C* b = a;  //is there a difference? 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-30T14:06:55.763

C* b(a) 和 C* b = a 是等价的。与许多语言一样，有不止一种方法可以做到这一点......

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-30T14:18:50.463

请注意，在

```
C* a = new C();
C* b(a); 
```

b 是指向与 a 具有相同值的 C 对象的指针。然而，

```
#include "somefile.h"
C* b(a); 
```

我们可以很容易地将 b 定义为一个函数，它接受一个类型为 a 的对象，并返回一个指向 C 的指针。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-30T15:09:18.580

该标准描述了不同类型的初始化是 8.5，而这两个具体在 8.5/12 下。

```
C* b(a);  //what does it do? 
```

这称为*直接初始化*。如果“b”具有类类型，则编译器将使用“a”作为参数对 C 中的构造函数执行重载解析。对于指针类型，它只是用“a”初始化“b”。

```
C* b = a;  //is there a difference? 
```

该标准确实认为这些在某些情况下是不同的，上述语法称为*复制初始化*。至于直接初始化，因为 'b' 不是类类型，则使用 'a' 的值进行初始化。如果 'a' 和 'b' 是相同的类类型，则使用*直接初始化*。

其中 'b' 是类类型，而 'a' 具有不同的类型（类或非类），则规则略有不同（8.5/14-b1.b3）。所以对于下面的代码：

```
C b = a; 
```

首先，尝试将“a”转换为“C”类型，然后使用这个临时对象来初始化“b”。这很重要，因为您可能会遇到*直接初始化*成功但*复制初始化*失败的情况：

```
class A {
public:
  operator int ();
};

class B {
public:
  B (int);
};

void foo ()
{
  A a;
  B b1 (a);  // Succeeds
  B b2 = a;  // Fails
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-30T14:14:20.177

1.  C* a = 新 C(); 现在它正在创建一个 C 类型的指针，它也通过使用 new 关键字来分配新的内存......

2.  以下语句取决于您的**构造函数逻辑**。C* b(a); //它有什么作用？
3.  你的第一个和第三个陈述是等价的。C* b = a; //有区别吗？

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-04-30T14:13:04.937

第一个创建一个新的 C 实例并将其地址放在 a 中。

第二个是指向函数的声明。该指针可以指向任何接受 a 类型参数的函数，并返回指向 C 类型对象的指针。

第三个声明 b，一个指向 C 类型对象的指针，并用 a 初始化它。

# jquery - 如何使用 JQuery 发送按键触发器

> ID：807083
> 
> 赞同：7
> 
> 时间：2009-04-30T14:06:17.560
> 
> 标签：jquery, html

我如何发送特定keyCode的触发按键，例如。以编程方式使用 JQuery 的文本框上的“9”事件？

这是我打算做的；以编程方式向 TextBox 输入值，然后以编程方式触发 TextBox 上的制表键以退出该字段。

我的代码

```
$("#tags1").val("comp") // Works well

$("#tags1").trigger("keypress",[9]); // Fails!! 
```

加思

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-30T14:30:01.263

jQuery 文档声明它只会传递规范化的事件属性 = jQuery.Event 对象的属性，这似乎不包括特定于事件的数据。

我试过了，即使重用浏览器按键创建的事件对象，也无法将文本插入到文本框中，所以这似乎是不可能的。

为什么不能只改变文本框的值，然后调用 blur() 退出呢？（或将焦点（）放在您要输入的下一个？）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T14:32:15.127

不完全是你问的，但不是使用 keypress 这可能会完成你想要的：

```
$("#tags1").blur(); 
```

甚至

```
$("#tags1").next().focus(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T14:51:43.690

尝试：

```
 $("#tags1").val("comp").trigger("keypress",[9]); 
```

或者

```
 $("#tags1").val("comp").trigger("keypress", [{
    preventDefault:function(){},
    keyCode:9
    }]); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-09-11T12:23:18.823

我创建了一个[简单的 jQuery 插件](https://github.com/marklagendijk/jQuery.tabbable)来解决这个问题。它使用 jQuery UI 的 ':tabbable' 选择器来查找下一个 'tabbable' 元素并选择它。

示例用法：

```
// Simulate tab key
$.tabNext(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-10-24T17:54:19.213

如果您想向输入/文本区域添加值，则触发按键“输入”事件。

像这样触发

```
$('input').val( input_value ).blur(); 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-11-15T20:37:43.950

Try this:

```
$('textarea:input').live('keypress', function(e) {
    if (e.keyCode == 9) {
        e.preventDefault();

        // Press TAB to append a string (keeps the original TEXTAREA text).
        $(this).append("TAB TAB TAB AFTER TEXTAREA TEXT");

        // Press TAB to append a string (keeps the original TEXTAREA text).
        $(this).focus().prepend("TAB TAB TAB BEFORE TEXTAREA TEXT");

        // Press TAB to replace a all text inside TEXTAREA.
        $(this).val("INSERT INTO TEXTAREA / REPLACE EXISTING TEXT");

    }
}); 
```

If you want to add text *inside* the textarea (by the active cursor - like CTRL+V), you might want to use ["Tabby"](http://teddevito.com/demos/textarea.html) [(JS source code](http://teddevito.com/demos/js/jquery.textarea.js)) (jQuery plugin - 254 code lines..!).

You may also find inspiration in the [YUI editor](http://developer.yahoo.com/yui/examples/editor/index.html) which will let you add TABs inside the editor.

# silverlight - Silverlight 应用程序的界面架构

> ID：807092
> 
> 赞同：0
> 
> 时间：2009-04-30T14:07:25.357
> 
> 标签：silverlight, architecture

我正准备开发我的第一个 Silverlight 应用程序。我的教会将主要使用它来输入数据，但还需要生成至少一份报告，最好是在 Excel 中，但 XML/XSLT 并不超出范围......

它将面向 Internet 并将与 SQL Server 2008 db 对话，我将为此创建一个托管在 ISP 上的 Web 服务（db 也托管在 ISP 上）。客户端将混合使用 Windows 和 Mac。

我的问题特别与接口架构有关。我知道 MVVM 现在很适合这个，我对此很满意。我想尽快完成（即接下来的 3-4 周）。我还看到提到 Prism（复合应用程序指南）和 Caliburn。有人对这两个有什么想法吗？该应用程序的初始版本不会很大，因此我认为以后将框架重构到其中不会过于困难。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T14:15:11.143

从您非常熟悉的东西开始，特别是如果您需要快速启动它。遵循良好的编码标准，如果你有一个更大的团队，以后重构到其他框架应该不是问题。

这是一个有用的[pdf](http://download.microsoft.com/download/F/B/8/FB8CA635-296B-487F-965C-8148F08B5319/riaservicesoverviewpreview.pdf)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T14:16:12.857

我自己还没有详细阅读它，但这篇文章看起来相当有用： [RIA Architecture with Silverlight in mind](http://weblogs.asp.net/fredriknormen/archive/2009/04/19/ria-architecture-with-silverlight-in-mind.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-01T00:18:07.993

你是对的，如果这是你在 SL 上的第一次开发，那么增加 MVVM 的复杂性对你没有多大帮助。

我认为一个好的方法可能是做一些简单的事情（例如：好的旧文档/视图可能只是一个好的开始[http://msdn.microsoft.com/en-us/library/4x1xy43a(VS.80)。 aspx](http://msdn.microsoft.com/en-us/library/4x1xy43a(VS.80).aspx)，或者只是打破标准层，UI / BS / DL）。

在那次开发之后，您将学到很多好东西，然后您将能够使用更高级的架构（关于 MVVM，一个非常好的网络广播：[http://blog.lab49\. com/archives/2650](http://blog.lab49.com/archives/2650)它是基于 WPF 的，大多数概念都可以移植到 SL）。

祝你好运，享受 SL 开发。

干杯布劳里奥

# php - php脚本中的最佳MYSQL查询数是多少？

> ID：807095
> 
> 赞同：3
> 
> 时间：2009-04-30T14:07:48.133
> 
> 标签：php, mysql, database

我不是专业的程序员，所以我不能确定这一点。你的脚本在一页发送了多少个 mysql 查询，你的最佳查询数是多少。例如，在 stackoverflow 的主页上，它列出的问题显示了这些问题的作者。是stackoverflow发送mysql查询foreach问题以获取作者信息。或者它发送 1 个查询并获取所有用户数据并将其与问题匹配？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-30T14:16:22.043

我喜欢把我的保持在 8 岁以下。

不过说真的，这没什么意义。如果假设您有理由在一个页面中有 800 个查询，那么您可以继续这样做。您可能会发现每页的查询数量仅取决于您在做什么，尽管在正常情况下我会惊讶地看到超过 50 个（尽管这些天，很难意识到有多少如果你正在抽象你的数据库调用，你正在做）。

**慢查询更重要**

我曾经对某个基于 PHP 的论坛软件感到沮丧，它在一个页面中有 35 个查询并且运行速度非常慢，但那是很久以前的事了，我现在知道特定安装运行缓慢的原因与 35 无关页面中的查询。例如，大部分时间只有一两个查询占用了大部分时间。它只是有几个非常慢的查询，这些查询由放置良好的索引修复。

我认为识别和修复慢查询应该先于识别和消除不必要的查询，因为它可能会产生更大的差异。
甚至考虑到三个快速查询可能比一个慢查询快得多——查询的数量不一定与速度有关。

我有一页（实际上是一种测试用例/诊断工具，旨在仅由管理员运行），它有超过 800 个查询，但它在几秒钟内运行。我想它们都是非常简单的查询。

**尝试缓存**

有多种方法可以缓存应用程序的某些部分，这些方法可以真正减少您执行的查询数量，而不会减少功能。如今，像[memcached](http://www.danga.com/memcached/)这样的库使这变得非常简单，而且运行速度非常快。与减少查询数量相比，这还有助于提高性能。

**如果确实不需要查询，并且性能确实有所不同，则删除/组合它们**

首先考虑寻找慢查询并优化它们，或者缓存它们的结果。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-01T01:03:20.273

不要关注查询的数量。这不是一个有用的指标。相反，您需要查看其他一些内容：

*   有多少查询重复？
*   有多少查询具有相交的数据集？还是另一个的子集？
*   他们需要多长时间才能运行？您是否对常见的进行了分析以检查索引？
*   有多少是不必要的复杂？

    很多次我看到三个更简单的查询一起执行的时间是一个返回相同信息的复杂查询的十分之一。出于同样的原因，SQL 很强大，但不要疯狂地尝试在 SQL 中做一些在 PHP 循环中更容易和更简单的事情。

*   你做了多少渐进式处理？

    如果您无法避免对大型数据集进行更长的查询，请尝试重新安排算法，以便您可以处理来自数据库的数据集。这使您可以在 MySQL 中使用无缓冲查询，从而提高内存使用率。如果您可以在执行此操作的同时提供输出，则可以通过更快地提供第一个输出来提高页面的感知速度。

*   你能缓存多少这些数据？即使将其缓存几秒钟也可以提供极大的帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T14:13:27.527

确实没有最佳的查询数量。显然，您提出的查询越少越好。

如果您使用某种 ORM，例如 Hibernate、Propel、Doctrine 等，它们生成的查询将与您手动编写 SQL 不同。因此，如果 StackOverflow 使用 ORM，他们可能有多个查询访问问题和创建问题的用户。或者他们可能只是使用直接 SQL 的连接。

这实际上取决于您使用的技术以及它在幕后实际执行的操作以生成 SQL。

您应该研究以更好地理解这一点：

*   [延迟加载](http://en.wikipedia.org/wiki/Lazy_loading)
*   [对象关系映射](http://en.wikipedia.org/wiki/Object-relational_mapping)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-30T14:26:25.750

我最近开始重构我的一些旧代码，我意识到我在循环中使用了很多查询，因为那时我不知道如何使用子查询和连接等编写 SQL 查询。所以我去集成这些嵌套查询到一个查询中，这样我就可以一次检索所有数据，然后以嵌套方式循环它。

在某些情况下，这会使页面加载速度显着加快。

Ergo：了解 SQL 的可能性绝对值得学习，这样您就可以开始更多地使用 SQL 而更少地使用 PHP。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T14:27:53.623

我不会说在任何给定脚本上都有最佳数量的查询，而是在优化时你有一个目标；通常，除其他外，时间是主要问题。如果时间是唯一的问题，您可以优化您的查询，以便您可以在比其他查询更短的时间内执行查询。这就是我对优化的看法，我有一个目标，我如何最好地实现它。有什么可以缓存的信息吗？根据您的索引，您的查询中特定顺序的过滤器是否会表现得更好......

我的观点是，最好在 Db 端和应用程序端进行优化。您可能想阅读有关数据库优化的更多信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T14:33:06.730

只要你需要，就够了。这里没有经验法则。一些网站需要大量的数据库访问，而另一些则不需要。

如果按照我的想法编写，那么实际上只有几个 db 调用。在这样的页面上，一个问题的答案，会有：

1) 会话验证，如果您已登录。 2) 当前用户信息，获取屏幕顶部的用户栏和您的奖牌数。3）获取问题信息以及提问者/最后编辑的信息。4）检索此问题中使用的标签计数。5）一次选择所有响应和响应者数据。

就是这样。有趣的部分是这个问题的关键是多少：

```
// this returns one row per revision
select q.*, u.name, u.u_id, u.points, u.gmedal, u.smedals, u.bmedals
from questions q left outer join users on q.u_id = u.u_id
where q_id = :q_id;

// this used to display the tags below the question and the tag counts on the right
select t.name, count(*)
from tags t left join tags q on q.tagid = t.tagid
where t.q_id = :q_id

// this can also get multiple revisions
select a.*, u.name, u.u_id, u.points, u.gmedal, u.smedals, u.bmedals
from answers a left outer join users on a.u_id = u.u_id
where a.q_id = :q_id 
```

这假设各种计数（投票、赞成的问题）都缓存在表中并单独存储。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-01T01:26:13.977

最佳数量是显示用户期望的信息所需的数量。我总是尽量保持在个位数。对于需要几次查询但很少更改的信息，我将结果缓存在一个通用缓存表中，因此它只需要一次查询。将其存储为序列化数组以保留易于访问的结构。

当我第一次安装 WordPress 时，我对基本安装执行了 20 多个查询感到震惊！插件会增加这个数字（有些会增加很多）。但是通过缓存，这可以减少到零（SuperCache）。如果您的内容每 10 分钟更改一次，为什么每次点击都动态生成它？

极端的是像 Facebook 这样的平台，每个页面都是独特的内容，为查看它的用户定制。每次都要查询。

但无论如何，我很少看到需要达到两位数的查询计数。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-04-30T14:19:26.327

如果您优先考虑速度，0 将是最佳选择。

# django - 关于注释 django

> ID：807096
> 
> 赞同：2
> 
> 时间：2009-04-30T14:07:48.803
> 
> 标签：django, annotations

我想创建每个月产品的前五名畅销产品。

我听说这种情况必须使用注释，但我不知道如何使用它。

有人会好心帮助我吗？？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-30T14:12:52.427

您需要提供更多信息，然后任何人才能为您提供有用的答案。描述你知道什么，你尝试过什么，详细说明你希望完成什么。

同时，您可以通过阅读 django 的[聚合文档](http://docs.djangoproject.com/en/dev/topics/db/aggregation/)[`annotate()`](http://docs.djangoproject.com/en/dev/ref/models/querysets/#annotate-args-kwargs)了解 django 的功能，并查看一些示例。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-30T15:12:04.437

注释不是唯一的方法。您也可以使用`extra`聚合，尽管它可能不是很有效，这将依赖于特定于您的数据库的 sql。这种方法在 App Engine 中不起作用，但应该在符合 SQL 的数据库中起作用。

例如，假设您有一个`Product`模型和一个`SalesOrder`模型，其中模型中`SalesOrder`的每个模型都有一个行项目。`product_id``order_date`

```
top_products = Product.objects.extra( 
    select={'num_orders':'select count(product_id) from app_product where app_salesorder.order_date > thirty_days_ago and app_product.id = app_salesorder.product_id'})
        .order_by('-num_orders')[:5] 
```

# c++ - 如何使用带有 libcurl 的 HTTP 在 C/C++ 中上传文件？

> ID：807105
> 
> 赞同：0
> 
> 时间：2009-04-30T14:09:25.633
> 
> 标签：c++, c, upload, file-upload, libcurl

我想使用带有 libcurl 的 HTTP 在 C/C++ 中上传一个文件（在我的例子中是一张图片）。

如果有一个 C/C++ 中的工作示例以及（可选）服务器端的 php 代码，那就太好了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T16:22:05.190

查看[libcurl](http://curl.haxx.se/libcurl/)站点上的[教程。](http://curl.haxx.se/libcurl/c/libcurl-tutorial.html)

# compression - Gzip 与缩小

> ID：807119
> 
> 赞同：134
> 
> 时间：2009-04-30T14:13:38.960
> 
> 标签：compression, gzip, minify

前几天我进行了一场关于缩小 Javascript 和 CSS 与更喜欢使用 Gzip 的人的热烈讨论。

我会称这个人为 X。

X 说 Gzip 已经压缩了代码，因为它压缩了你的文件。

我不同意。Zip 是一种**无损**压缩文件大小的方法。无损意味着必须完美地恢复原件，这意味着必须存储信息才能恢复空格、不需要的字符、注释代码和其他所有内容。这会占用更多空间，因为必须压缩更多空间。

我没有测试的方法，但我相信这段代码的Gzip：

```
.a1 {
    background-color:#FFFFFF;
    padding: 40px 40px 40px 40px;
} 
```

仍将大于此代码的 Gzip：

```
.a1{body:background-color:#FFF;padding:40px} 
```

有没有人可以证明这是对还是错。
并且请不要说“这是正确的，因为这是我一直使用的”。

我在这里要求科学证明。

* * *

## 回答 #1

> 赞同：198
> 
> 时间：2009-04-30T14:20:25.060

测试非常简单。我拿走了你的 js，把它们放在不同的文件中，然后对它们运行 gzip -9。这是结果。这是在运行 Cygwin 和 gzip 1.3.12 的 WinXP 机器上完成的。

```
-rwx------  1 xxxxxxxx mkgroup-l-d     88 Apr 30 09:17 expanded.js.gz

-rwx------  1 xxxxxxxx mkgroup-l-d     81 Apr 30 09:18 minified.js.gz 
```

这是使用真实 JS 示例的进一步测试。源文件为“common.js”，原始文件大小为 73134 字节。缩小后，它达到 26232 字节。

**原始文件：**

```
-rwxrwxrwx 1 xxxxxxxx mkgroup-l-d 73134 Apr 13 11:41 common.js 
```

**缩小文件：**

```
-rwxr-xr-x 1 xxxxxxxx mkgroup-l-d 26232 Apr 30 10:39 common-min.js 
```

**使用 -9 选项压缩的原始文件（与上述版本相同）：**

```
-rwxrwxrwx 1 xxxxxxxx mkgroup-l-d 12402 Apr 13 11:41 common.js.gz 
```

**使用 -9 选项压缩的压缩文件（与上述相同的版本）：**

```
-rwxr-xr-x 1 xxxxxxxx mkgroup-l-d  5608 Apr 30 10:39 common-min.js.gz 
```

如您所见，各种方法之间存在明显差异。最好的办法是压缩和压缩它们。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-05-17T11:55:29.860

这是我不久前使用我网站上的“现实生活”CSS 文件进行的一项测试的结果。[CSS 优化](http://www.cssoptimiser.com/optimize.php)器用于缩小。Ubuntu 附带的标准 Linux 归档应用程序用于 Gzipping。

原始：**28,781**字节
缩小：**22,242**字节
Gzipped：**6,969**字节
Min+Gzip：**5,990**字节

我个人的意见是首先选择 Gzipping，因为这显然是最大的不同。至于缩小，这取决于你的工作方式。您必须保留原始 CSS 文件才能进一步进行编辑。如果每次更改后都不会打扰您缩小它，那么就去做吧。

（注意：还有其他解决方案，例如在提供文件时通过压缩器“按需”运行它，并将其缓存在文件系统中。）

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-04-30T15:05:17.403

测试时要小心：这两个 CSS 片段非常小，因此它们无法从 GZIP 压缩中受益——仅添加 GZIP 的小页眉和页脚（大约 20 字节开销）将失去所获得的收益。实际上，您不会有这么小的 CSS 文件并担心压缩它。

**minify+gzip 压缩的不仅仅是 gzip**

原始问题的答案是，是的，minify + gzip 将获得比 g​​zip 更多的压缩。对于任何重要的示例（即任何有用的超过几百字节的 JS 或 CSS 代码）都是如此。

对于这种效果的示例，[获取可用的压缩和未压缩的 Jquery 源代码](http://docs.jquery.com/Downloading_jQuery)，使用 gzip 压缩它们并查看。

值得注意的是，与优化的 CSS 相比，Javascript 从缩小中获得的好处要多得多，但仍然有好处。

推理：

GZIP 压缩是无损的。这意味着它必须存储所有文本，包括确切的空格、注释、长变量名等，以便以后可以完美地复制它们。另一方面，缩小是有损的。如果你缩小你的代码，你会从你的代码中删除大部分信息，只留下更少的 GZIP 需要保留的信息。

*   缩小会丢弃不必要的空格，仅在出于语法原因需要的地方留下空格。
*   缩小会删除评论。
*   代码缩小可以用更短的名称替换标识符名称，而不会产生副作用。
*   代码缩小可能会对代码进行微不足道的“编译器优化”，这只能通过实际解析代码来实现
*   CSS 缩小可以消除冗余规则或组合具有相同选择器的规则。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-04-30T14:20:40.100

你是对的。

缩小与 gzipping 不同（如果是这种情况，它们将被称为相同）。例如，gzip 不一样：

```
var myIncrediblyLongNameForThisVariableThatDoesNothingButTakeUpSpace = null; 
```

比缩小最终得到类似的东西：

```
var a = null; 
```

当然，我会说在大多数情况下，最好的方法是先压缩 FIRST，然后再压缩 Gzip，而不仅仅是压缩或压缩，尽管有时根据代码，压缩或压缩会比两者都提供更好的结果。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2010-02-20T05:15:49.810

gzip 编码是有优势的。一般规则是：文件越大，压缩效果越好，gzip 会胜出。当然，您可以先缩小，然后再压缩。

但是，如果我们在不超过 100 字节长的一小段文本上讨论 gzip 与缩小，那么“客观”比较是不可靠的，甚至是毫无意义的——除非我们拿出基线文本来建立标准的基准测试方法，类似于 Lorem Ipsum 类型，但用 Javascript 或 CSS 编写。

因此，让我建议使用我的[Fat-Free Minify](http://razorsharpcode.blogspot.com/2010/02/lightweight-javascript-and-css.html) (PHP) 代码对最新版本的 jQuery 和 MooTools（未压缩版本）进行基准测试（只是简单地去除空格和注释，不缩短变量，不使用 baseX 编码）

以下是 minify 与 gzip（保守的 5 级压缩）与 minify+gzip 的结果：

```
MooTools-Core
-------------
Baseline 102,991 bytes
Minified 79,414 (77.1% of original)
Gzipped 27,406 (26.6%)
Minified+Gzipped 22,446 (21.8%)

jQuery
------
Baseline 170,095
Minified 99,735 (58.6% of original)
Gzipped 46,501 (27.3%)
Minified+Gzipped 27,938 (16.4%) 
```

在任何人开枪之前，这不是 JS 库之战。

如您所见，缩小+gzipping 可以更好地压缩**大文件**。缩小代码有其优势，但主要因素是原始代码中存在多少空白和注释。在这种情况下，jQuery 具有更多功能，因此可以提供更好的缩小效果（内联文档中有更多的空格）。Gzip 压缩的优势在于内容中有多少重复。因此，这与缩小与 gzip 无关。他们做事不同。通过使用两者，您可以获得两全其美。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-04-30T14:19:50.663

为什么不两者都用？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-30T14:18:15.393

它很容易测试：只需将您的 css 文本放入文本文件中，然后使用 linux 上的 gzip 之类的存档器压缩文件。

我刚刚完成了这个，碰巧第一个 css 的大小是 184 字节，第二个 css 的大小是 162 字节。

所以，你是对的，即使对于 gzip 文件，空白也很重要，但是从这个小测试中可以看出，对于非常小的文件，压缩文件的大小可能大于原始文件的大小。

这只是由于您的示例的大小非常小，对于较大的文件，gzipping 将使您获得较小的文件。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-05-05T00:52:47.617

我没有看到有人提到 Mangling，所以我在上面发布了我的结果。

以下是我使用 UflifyJS 进行缩小和 Gzip 得出的一些数字。我有大约 20 个文件，它们以大约 2.5MB 的大小与评论和所有内容连接在一起。

连接文件 2.5MB

```
uglify({
    mangle: false
}) 
```

缩小后不变形：929kb

```
uglify({
    mangle: true
}) 
```

缩小和损坏：617kb

现在，如果我将这些文件压缩并压缩，我将分别得到 239kb 和 190kb。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-30T14:18:41.930

有一个非常简单的测试方法：创建一个仅包含空格的文件和另一个真正为空的文件。然后 Gzip 两者并比较它们的大小。带有空格的文件当然会更大。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-30T14:19:07.200

当然，保留布局或其他一些重要内容并删除任何不需要的垃圾（空格、注释、冗余内容等）的“人为”有损压缩将比无损 gZip 压缩更好。

例如，标记或函数名称之类的东西很可能有一定的长度来描述含义。用一个字符长的名称替换它可以节省很多空间，并且在无损压缩中是不可能的。

顺便说一句，对于 CSS，有一些工具，如[CSS 压缩器](http://www.cssdrive.com/index.php/main/csscompressor/)，可以为您完成有损工作。

但是，当结合“有损优化”和无损压缩时，您将获得最佳结果。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-30T14:21:51.640

当然，您可以测试 - 将您的文件写入文件并使用[zlib](http://www.zlib.net/)对其进行 gzip 压缩。您也可以尝试使用“gzip”实用程序。

回到你的问题 - 源的长度和压缩结果之间没有明确的关系。关键是“熵”（源中的每个元素有多么不同）。

所以，这取决于你的来源。例如，许多连续的空格（例如，> 1000）可能会被压缩为与少数（例如，< 10）个空格相同的大小。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-30T14:21:57.147

这是压缩两个文件时的结果

```
bytes  File
45     min.txt
73     min.gz

72     normal.txt
81     normal.gz 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-04-30T14:25:17.983

你是对的，minify+gzip 会减少字节数。虽然没有科学证据。

你怎么没有测试方法？

在一个文件中缩小您的代码，并将其“未缩小”在另一个文件中。上传到能够对输出进行 gzip 压缩的网络服务器（例如，用于 Apache 的 mod_deflate），为 firefox 安装 Firebug 扩展，清除缓存并访问这两个文件。Firebug 的“NET”选项卡将包含传输的确切数据量，比较这些数据，您就有了“经验”证明。

# git - 使用远程服务器处理源代码树的一部分时的 Git 工作流程

> ID：807122
> 
> 赞同：1
> 
> 时间：2009-04-30T14:14:26.790
> 
> 标签：git, version-control

我有一个项目，其中包含每个人都在使用的不同组件。我们有一个服务器端组件，以及 N 个与服务器交互的客户端组件。我自己负责其中一个客户端组件。

我正处于一个我想分支为客户开发新功能的地步。这里的问题是，当我更新客户端时，我想做以下事情：

a) 确保同事所做的所有服务器端更新都进入我的实验分支。b) 将我的实验分支推送到共享仓库，这样人们就可以看到我一直在做的工作。c) 功能完成后合并回主分支。

使用共享存储库时，此特定工作流程的最佳策略是什么？

感谢您的解决方案。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T14:56:12.090

标准工作流程是这样工作的：

1.  `git clone`创建本地存储库。
2.  创建一个跟踪分支`origin/master`。
3.  从您的本地跟踪分支创建您的分支。

现在实现：

1.  条件 a) 您可以从原始存储库中提取。这将对您的本地跟踪分支进行更改。如果没问题。执行`git merge`或`git rebase`将其他人的更改导入您的分支。
2.  条件 b) 用于`git push`在共享存储库上发送您的分支。
3.  条件 c) 完成分支后，将其合并到主分支并将其推送到共享存储库。

这是最简单的做事方式。

您也可以为所有人使用私有/公共存储库。查看 Git 的一些工作流程建议。在这种情况下，您摆脱了推送，只使用`pull/merge`.

# windows - 有什么方法可以知道文件的哪一部分在被某个进程读取后仍在物理 RAM 中

> ID：807124
> 
> 赞同：0
> 
> 时间：2009-04-30T14:14:53.280
> 
> 标签：windows, winapi, file, filesystems

假设我使用了一个读取文件的程序并且该程序已完成。现在，文件的某些部分很可能仍驻留在物理内存中（假设我有大量内存）。

有没有办法知道文件的哪些部分驻留在物理内存中？是否有任何工具可以做到这一点，或者可能是一个 winapi 函数调用？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T14:19:17.450

要记住的几点：

1.  您永远无法直接访问物理 RAM。操作系统为您提供了 RAM 的抽象。它可能是物理 RAM，或在某个硬盘上分页的虚拟内存。你永远不可能知道。
2.  即使某些位仍然隐藏在 RAM 的某些部分（物理或其他）中，操作系统也会将该内存块视为空闲（除非它已经被再次占用）。我怀疑您是否可以在不以某种方式入侵操作系统的情况下访问它。

关于你的评论，让我澄清一下我的观点：

假设您打开了一个文件，将其读入 RAM，对其进行了一些处理，然后关闭了该文件，您的程序已经终止。首先，我认为我们都同意您使用的那部分 RAM 不再被占用，并且被操作系统认为是免费的。这意味着另一个出现并需要一些 RAM 的程序可能会收到该内存块。因此，首先，**该内存块中不再存在任何内容**。它是空的。免费供操作系统自行决定使用。

现在，即使一些随机数据位被留下（请记住，您无法知道它是物理的还是其他的），您也无法直接访问它们。

我希望这可以澄清。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T14:26:51.223

如果您在谈论 Windows，则内容将在 Windows 文件缓存中。

现在没有读取 Windows 文件缓存的工具/API。

但是，您可以通过 CreateFile('\\.\PhysicalMemory') 或名称 \Device\PhysicalMemory 等特殊名称读取物理内存中的所有内容。（注：仅适用于 XP/2000）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-01T10:04:20.067

*> 现在没有读取 Windows 文件缓存的工具/API。*

当然还有api（Win32 st）！

# com - IDL 中不可创建的 coclass 的目的是什么？

> ID：807128
> 
> 赞同：0
> 
> 时间：2009-04-30T14:15:23.997
> 
> 标签：com, interop, com-interop, idl, midl

在 IDL 中声明如下不可创建的 coclass 的原因是什么？

```
[
    uuid(uuidhere),
    noncreatable
]
coclass CoClass {
    [default] interface ICoClass;
}; 
```

我的意思是这样的类无论如何都不会注册到 COM。在 IDL 文件和编译该 IDL 文件生成的类型库中提及它的原因是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T14:42:51.717

当您想阻止客户端使用默认类工厂实例化对象但仍然具有用于日志记录、调试等的正确 CLSID 时，noncreatable 非常有用；[请参阅http://www.eggheadcafe.com/software/aspnet/29555436/noncreatable-atl-object.aspx](http://www.eggheadcafe.com/software/aspnet/29555436/noncreatable-atl-object.aspx)上的示例，该示例以这种方式正确解决。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-01T07:33:32.097

noncreatable 属性只是对对象使用者的提示——.Net 和 VB6，例如，当看到此属性时，将不允许客户端以“正常方式”创建对象，例如通过调用 New CoClass() [VB6]。

然而，COM 服务器的类工厂是决定它是否允许创建给定类的对象的明确权威——所以事实上，有可能一个类被标记为不可创建，然而，类工厂允许对象被创建。创建的。为避免这种情况，请确保相应地更新您的类工厂。

在 IDL 中提及不可创建的类实际上是可选的。但是请注意，无论如何，您至少可以从包含它们中获得一个好处：midl 将创建 CLSID_CoClass 常量等。

# javascript - 使用 jQuery 检测表单中的数据变化

> ID：807159
> 
> 赞同：30
> 
> 时间：2009-04-30T14:19:46.903
> 
> 标签：javascript, jquery

我正在使用带有母版页的 ASP.NET 2.0，我想知道是否有人知道一种方法来检测某个`<div>`或`fieldset`已更改（例如，标记为' `IsDirty`'）中的字段何时？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-04-30T14:27:22.143

您可以为所有输入绑定 Change 事件并将变量标记为 true。像这样。

```
var somethingChanged = false;
$(document).ready(function() { 
   $('input').change(function() { 
        somethingChanged = true; 
   }); 
}); 
```

但是，请记住，如果用户更改了某些内容，然后又更改回原始值，它仍然会被标记为已更改。

**更新：**对于特定的 div 或字段集。只需使用给定字段集或 div 的 id。例子：

```
var somethingChanged = false;
$(document).ready(function() { 
   $('#myDiv input').change(function() { 
        somethingChanged = true; 
   }); 
}); 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2012-08-03T11:53:02.597

## 快速（但很脏）的解决方案

这很快，但它不会处理`ctrl+z`or并且在按下 或键时`cmd+z`会给你一个误报：`shift``ctrl``tab`

```
$('#my-form').on('change keyup paste', ':input', function(e) {
    // The form has been changed. Your code here.
}); 
```

[用这个小提琴测试它。](https://jsfiddle.net/a2otmLxk/)

* * *

## 快速（不那么脏）的解决方案

`shift`这将防止, `ctrl`or 键的误报`tab`，但它不会处理`ctrl+z`or `cmd+z`：

```
$('#my-form').on('change keyup paste', ':input', function(e) {

  var keycode = e.which;

  if (e.type === 'paste' || e.type === 'change' || (
      (keycode === 46 || keycode === 8) || // delete & backspace
      (keycode > 47 && keycode < 58) || // number keys
      keycode == 32 || keycode == 13 || // spacebar & return key(s) (if you want to allow carriage returns)
      (keycode > 64 && keycode < 91) || // letter keys
      (keycode > 95 && keycode < 112) || // numpad keys
      (keycode > 185 && keycode < 193) || // ;=,-./` (in order)
      (keycode > 218 && keycode < 223))) { // [\]' (in order))

    // The form has been changed. Your code here.

  }

}); 
```

[用这个小提琴测试它。](https://jsfiddle.net/h5k60vL7/22/)

* * *

## 完整的解决方案

如果要处理**所有**情况，则应使用：

```
// init the form when the document is ready or when the form is populated after an ajax call
$(document).ready(function() {
  $('#my-form').find(':input').each(function(index, value) {
    $(this).data('val', $(this).val());
  });
})

$('#my-form').on('change paste', ':input', function(e) {
  $(this).data('val', $(this).val());
  // The form has been changed. Your code here.
});

$('#my-form').on('keyup', ':input', function(e) {
  if ($(this).val() != $(this).data('val')) {
    $(this).data('val', $(this).val());
    // The form has been changed. Your code here. 
  }
}); 
```

[用这个小提琴测试它。](https://jsfiddle.net/h5k60vL7/25/)

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2014-05-16T13:16:53.450

一个简单而优雅的解决方案（它实时检测表单元素的变化）：

```
var formChanged = false;

$('#my-div form').on('keyup change paste', 'input, select, textarea', function(){
    formChanged = true;
}); 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2018-04-06T01:37:09.053

对于表单，您可以在加载时序列化内容，然后在稍后比较序列化，例如：

```
$(function(){
    var initdata=$('form').serialize();
    $('form').submit(function(e){
        e.preventDefault();
        var nowdata=$('form').serialize();
        if(initdata==nowdata) console.log('nothing changed'); else console.log('something changed');
        // save
        initdata=nowdata;
        $.post('settings.php',nowdata).done(function(){
            console.log('saved');
        });
    });
}); 
```

请注意，这要求表单元素具有`name`属性。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-30T14:31:04.630

只是为了澄清，因为问题是“在某个字段集/div内”：

```
var somethingChanged = false;
$(document).ready(function() { 
   $('fieldset > input').change(function() { 
        somethingChanged = true; 
   }); 
}); 
```

或者

```
var somethingChanged = false;
$(document).ready(function() { 
   $('div > input').change(function() { 
        somethingChanged = true; 
   }); 
}); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-30T14:35:36.430

您可以给 fieldset 或 div 一个 ID 并将更改事件绑定到它......该事件应该从内部子级传播。

```
var somethingChanged = false;
$('#fieldset_id').change(function(e)
{
    // e.target is the element which triggered the event
    // console.log(e.target);
    somethingChanged = true;
}); 
```

此外，如果您想要一个事件监听功能，您可以将更改事件放在表单上，​​然后检查哪个字段集发生了更改：

```
$('#form_id').change(function(e)
{
    var changedFieldset = $(e.target).parents('fieldset');
    // do stuff
}); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-07-31T00:54:19.733

我在 CoffeeScript 中提出了这段代码（还没有真正经过现场测试）：

*   将类“change_warning”添加到应注意更改的表单。

*   将类“change_allowed”添加到保存按钮。

### change_warning.coffee：

```
window.ChangeWarning = {
    save: ->
        $(".change_warning").each (index,element) ->
            $(element).data('serialized', $(element).serialize())

    changed: (element) ->
        $(element).serialize() != $(element).data('serialized')

    changed_any: ->
        $.makeArray($(".change_warning").map (index,element) -> ChangeWarning.changed(element)).some (f)->f
        # AKA $(".change_warning").any (element) -> ChangeWarning.changed(element)
        # But jQuery collections do not know the any/some method, yet (nor are they arrays)

    change_allowed: ->
        ChangeWarning.change_allowed_flag = true

    beforeunload: ->
        unless ChangeWarning.change_allowed_flag or not ChangeWarning.changed_any()
            "You have unsaved changes"
}

$ ->
    ChangeWarning.save()
    $(".change_allowed").bind 'click', -> ChangeWarning.change_allowed()
    $(window).bind 'beforeunload',     -> ChangeWarning.beforeunload() 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-06-19T21:41:27.907

如果您只想要字段集中的字段，则可以替代 Dw7 的答案，然后您可以在其输入值上调用 serialize() 。注意：serialize()**不会**拾取任何没有“名称”属性的元素。这也适用于选择标签。

```
var initialValues = $('#your-fieldset :input').serialize();

$('form').submit(function(e) {
  e.preventDefault();
  var currentValues = $('#your-fieldset :input').serialize();
  if (currentValues == initialValues) {
    // Nothing has changed
    alert('Nothing was changed');
  }
  else {
    this.submit();
  }
}); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-04-22T20:33:09.130

`.live`现在已弃用并替换为`.on`：

```
var confirmerSortie = false;
$(document).on('change', 'select', function() {
    confirmerSortie = true;
});

$(document).on('change keypress', 'input', function() {
    confirmerSortie = true;
});

$(document).on('change keypress', 'textarea', function() {
    confirmerSortie = true;
}); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-11-03T15:46:47.537

以下解决方案对我有用：

```
$("#myDiv :input").change(function() { $("#myDiv").data("changed",true);});
}

if($("#myDiv").data("changed")) {
console.log('Form data changed hence proceed to submit');  
}
else {
console.log('No change detected!');
}
```

谢谢

# oracle - 从 oracle 数据库读取 nchar 数据时出现问题

> ID：807163
> 
> 赞同：1
> 
> 时间：2009-04-30T14:20:50.300
> 
> 标签：oracle

我有一个 oracle 数据库，其中 nls 字符集设置为 ALS32UTF8，nls nchar 字符集设置为 UTF8。

但是，如果我将任何数据插入表中的 nvarchar 列。

随后，当我进行选择时，我得到的数据是???。

为什么会这样？

有趣的是，使用 TOAD 我可以使用模式浏览器读取正确的 nvarchar 数据 -> 数据

但是，如果我使用 sql 进行选择，我会得到 ???。

任何人都知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T16:11:52.000

您客户端上的 NLS_LANG 设置是什么？有关 NLS 参数的良好参考，请阅读 Oracle 的此[常见问题解答](http://www.oracle.com/technology/tech/globalization/htdocs/nls_lang%20faq.htm)。有关 Unicode 的更多信息，请参阅Joel Spolsky 的[这篇文章](http://www.joelonsoftware.com/articles/Unicode.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-06-30T19:55:13.613

您需要将客户端 NLS_LANG 设置为 utf。

sqlplus 使用这些环境变量（windows 上的注册表参数）：（您可能需要使用 sqlplusw.exe 在 windows 上使用 utf-8。）

NLS_LANG=AMERICAN_AMERICA.AL32UTF8 LC_CTYPE="en_US.UTF-8" ORA_NCHAR_LITERAL_REPLACE=true

另请参阅：[将国家字符插入 oracle NCHAR 或 NVARCHAR 列不起作用](https://stackoverflow.com/q/6509751/92018)

# jira - JIRA 中的图表进度

> ID：807165
> 
> 赞同：4
> 
> 时间：2009-04-30T14:21:42.280
> 
> 标签：jira

使用[JIRA](http://www.atlassian.com/software/jira/)，有一些功能允许您在任何给定时间处理一个问题或各种问题`Start Progress`。`Stop Progress`有没有办法让我回去查看图表或图形表示我的时间在一段时间内是如何度过的？

如果我想看看我在 4 月份处理了多少错误，并查看在每个错误上花费了多少时间（以图形方式），可以这样做吗？如果可以，哪个版本的 JIRA 允许我这样做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T17:10:32.873

我认为您无法看到给定月份在一项任务上花费了多少时间。您可以看到在一项任务上花费了多少时间，但看不到它的时间段。

我相信你已经看过这个： http: [//www.atlassian.com/software/jira/docs/v3.13.3/timetracking_report.html](http://www.atlassian.com/software/jira/docs/v3.13.3/timetracking_report.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T18:49:18.223

[Timesheet Report 和 Portlet](http://confluence.atlassian.com/display/JIRAEXT/Timesheet+report+and+portlet)插件附带一个 Time Sheet Summary 报告- 它显示了您一直在处理的 JIRA 问题的列表以及可配置期间每天的时间。不过，恐怕没有图表。

我认为一般来说，时间跟踪对于编写一个非常好的 JIRA 插件的人来说已经成熟了；我对目前的任何一个都不完全满意。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-05T13:50:48.227

[您可以使用JIRA PDF View Plugin](https://marketplace.atlassian.com/5167)实现此可视化，如下所示：

1.  创建一个过滤器，返回要用于此可视化的问题。运行它并从“查看”下拉菜单中调用插件。
2.  编写一个小 Groovy 脚本来迭代返回的问题集合，并且：
    1.  构建从“月”（键）到包含“totalTimeSpent、issuesWorkedOn、issuesFixed”（值）三元组的数据结构的映射。
    2.  在每个问题上计算“花费时间”记录的总和并将其添加到“totalTimeSpent”。
    3.  相应地增加另外两个计数器。
3.  当您的脚本完成时，您将拥有所有输入数据来绘制时间序列图。
4.  生成一个 JFreeChart *TimeSeriesCollection*数据集。它应该包含 3 个时间*序列*（3 行），用于 3 种类型的值。
5.  创建一个显示单个时间序列图的简单 PDF 模板，该模板采用上一个脚本返回的数据集来呈现时间序列图。检查教程中的[时间序列图表示例](http://midori.hu/products/jira-pdf-view-plugin/documentation/charts#created-vs-resolved)以获取指导。

最终的图表将是这样的：

![在此处输入图像描述](https://i.stack.imgur.com/uyRDm.png)

*免责声明：这是 JIRA 的付费插件，我是一名开发人员。*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-08-27T14:25:52.493

使用 jira的[Tempo 插件](http://www.tempoplugin.com)。这是辉煌的。

# php - 替代松散耦合的MVC？

> ID：807169
> 
> 赞同：7
> 
> 时间：2009-04-30T14:22:40.390
> 
> 标签：php, model-view-controller, design-patterns

我在一家网店工作，是一名 PHP 程序员。大多数时候，我们使用良好的编码实践，但对整个站点的结构并不多。

我现在已经进入了对我们的一些实践感到厌烦的阶段，并且希望以一种有益的方式扩展和简化并生成一些东西，不仅对我，而且对办公室中的混合程序员 Web 开发人员都有帮助。

一位员工给我们留下了一个用 PHP 编写的 MVC 站点，我不得不对其进行一些维护，我知道它是如何工作的，但有我的抱怨，我的主要抱怨是它与依赖于另一个的每个部分紧密耦合。我看到了关注点分离的优势，但这会让除了我查看代码之外的任何人感到困惑。

例如，如果我需要向站点添加一个新页面，我必须添加一个视图，然后添加一个模型，然后更新控制器。制作新页面的临时方法比这更简单，并且不需要程序员。

我的判断是，这是一种更好的构建网站的方法，而不是维护网站。

不过，如果我有一些设计模式，我可以有效地重用代码而不依赖于站点中的多个位置，那就太好了。

所以我的问题是，是否有一种用于构建和维护网站的设计模式更加松散耦合？我不是在寻找 MVC 的细微变化，我需要一些完全不同的东西来查看，也许是某种类型的插件方法。

编辑：

感谢您到目前为止的答案！另一种说法是我希望代码在我的办公室里做得更好。做 IA) 推动 MVC 或 B) 找到/构建一个不会让半程序员感到困惑的替代方案。我们已经将类用于数据库连接和表单帮助等。这个问题的重点是探索 B.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T15:18:21.833

随着框架模板的发展，我发现 MVC 模式是构建应用程序最“松散耦合”的方式之一。

想想接口之类的关系，或者应用程序各部分之间的合同。Model 承诺让 View 和 Controller 可以使用这些数据。没有人关心模型是*如何*做到这一点的。它可以从典型的 DBMS（如 MySQL）、平面文件、外部数据源（如 ActiveResource）读取和写入，只要它完成交易即可。

Controller 承诺将某些数据提供给 View，并依赖 Model 来履行其承诺。视图并不关心控制器是*如何做的。*

视图假设模型和控制器将信守承诺，然后可以在真空中开发。模型和控制器不关心视图是否正在生成 XML、XHTML、JSON、YAML、纯文本等。他们坚持合同的结束。

而且，当然，视图和控制器需要同意某些事情的存在。没有相应控制器活动的视图可能工作正常，但永远无法使用。即使控制器*不做*任何事情，就像静态页面中的情况一样：

```
<?php
class StaticController extends ApplicationController
{

    /**
     * Displays our "about" page.
     */
    public function about ()
    {
        $this->title = 'About Our Organization';
    }
} 
```

然后关联的视图可以只包含静态文本。（是的，我之前已经实现过这样的事情。很高兴将静态视图交给其他人并说“就在上面写。”）

如果将 M、V 和 C 之间的关系视为契约或接口，MVC 突然看起来非常“松散耦合”。警惕独立 PHP 文件的诱惑。一旦您开始包含并需要六个 .inc 文件，或者将您的应用程序逻辑与您的显示（通常是 HTML）混合在一起，您可能会更松散地耦合各个页面，但在此过程中会弄乱重要的方面。

```
<?php
/**
 * Display a user's profile
 */
require_once 'db.php';

$id = $db->real_escape_string($_GET['id']);
$user_res = $db->query("SELECT name,age FROM users WHERE id = $id;");
$user = $user_res->fetch_assoc();

include 'header.php';
?>
<h1><?php echo $user['name']; ?>'s Profile</h1>

<p><?php echo $user['name']; ?> is <?php echo $user['age']; ?> years old!</p>
<?php
include 'footer.php';
?> 
```

是的，“profile.php”和“index.php”完全不相关，但代价是什么？

**编辑：**响应您的编辑：推动 MVC。你说你有“半程序员”，我不确定哪一半（你有擅长 HTML 和 CSS 但不擅长服务器端的前端人员吗？有一些编程经验的作家？）但有MVC 框架，您可以只将视图交给他们，然后说“在这部分工作”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T14:48:46.117

在代码混乱之间总是存在折衷，因为它是高度解构主义的，而代码混乱是因为绝对需要执行 X 的所有内容都随机分散在单个文件中。

后者的问题在于，将事物拆分成整体模块的“直观”方式在人与人之间究竟是不同的。高度分解和分解的代码几乎总是更难缠住你的脑袋，但是一旦你这样做了，维护就变得很容易了。我不同意这会让其他人感到困惑，但作者正在看它。使用像 MVC 这样的大范围模式是因为随着时间的推移，更容易发现它们并处理围绕它们构建的项目。

使用 MVC 的另一个优点是，如果您不坚持分层，通常不会使应用程序更难为追随您的人维护。这是因为现在您有一个预先确定的位置来放置实现新功能的任何方面。

就紧密耦合的考虑而言，如果没有层之间的某种连接，您就无法真正实现功能。松散耦合并不意味着这些层完全不知道彼此——它意味着一个层应该不知道其他层是如何实现的。例如：控制器层不关心您是使用 SQL 数据库还是只是编写二进制文件以在数据访问层持久化数据，只是有一个数据访问层可以为其获取和存储模型对象。它也不关心您是在视图层使用原始 PHP 还是 Smarty，只是它应该使某些对象以某些预定名称可用。视图层一直没有

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T14:50:15.160

我不得不说我并没有真正看到你的 MVC 问题，因为你已经在使用模板了。我有点认为它是当您尝试向应用程序添加结构时自然演变的模式。

当人们第一次开始开发 PHP 应用程序时，代码通常是一团糟。表示逻辑与业务逻辑混合，业务逻辑与数据库逻辑混合。人们通常采取的下一步是开始使用某种模板方法。这是否涉及专门的模板语言（例如 smarty）或只是将表示标记分离到单独的文件中并不重要。

在此之后，我们大多数人发现使用专用函数或类来进行数据库访问逻辑是一个好主意。这实际上不必比为每个常用执行的查询创建专门的函数并将所有这些函数放在一个常用的包含文件中更高级。

这一切对我来说似乎很自然，而且我不认为这是非常有争议的。但是，此时您基本上已经在使用 MVC 方法。除此之外的一切都只是或多或少复杂的尝试，以消除重写常用代码的需要。

我知道这可能不是您想听到的，但我认为您应该重新评估 MVC。有无数的实现，如果真的没有一个适合你的需求，那么你总是可以编写自己的更基本的实现。

这样看：由于您已经在使用模板语言，因此您通常需要先创建一个常规 PHP 文件，然后在每次创建新页面时创建一个模板文件。MVC 不必比这更高级，而且在许多情况下并非如此。甚至可能您真正需要做的就是研究更复杂的方法来处理数据访问并将其添加到您当前的系统中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-01T00:52:26.197

啊......很好的旧 MVC 论点。

我必须维护一个多方面的 PHP 应用程序，其中的一部分是写成“MVC”风格的，但不是全部。更糟糕的是，不同的部分有不同的 MVC 方式，它们都是本土的。有些页面只是自己完成。

主要问题不是框架代码的多样性，而是编码人员显然*不了解*如何抽象 API。**IMO，这是 MVC 框架的最大问题。**我必须使用的几乎所有代码都使用“模型”作为放置函数的地方。维护 是一场*噩梦。*

为了使这个可维护，IME 你需要一些东西：

*   一个独特且定义明确的数据访问层，其 API 边界只负责检索和存储持久性存储，而几乎没有其他问题。

    我不喜欢为此使用“模型”一词，因为这是有争议的。无论调用什么，该层都不应该关心数据是如何存储的，甚至不应该担心数据库句柄之类的事情：这就是数据访问层的*全部*工作。

*   一个非常轻量级的调度器，除了调度之外不会做任何魔法。

现在您可以将其他所有内容放在一个接受请求和参数的地方，可能会从调度程序进行规范化和错误检查，获取所需的数据（通常作为对象），进行所需的更改，保存所需的数据，手数据是需要显示到视图。完成任务的 200 行代码*适用*于这一步。您不需要将位划分到另一个文件中的函数中，这些函数是从其他地方调用的。您甚至可以将视图放在此文件的末尾！理想主义很值得向往，但实用主义需要审视，因为*这是可维护的*。

（好吧，吐槽……）

PHP 缺乏强制执行框架意味着最好的框架做 PHP 所做的事情：它们不碍事。我处理过的一些最易于维护的代码`require()`在顶部有一个语句，使用数据对象进行所有数据操作（看不到 SQL），然后输出由模板函数包围的 HTML，表单控制由一个一致的功能API。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T16:20:10.467

Zend 框架非常松耦合，非常好。一探究竟：

[http://framework.zend.com](http://framework.zend.com)

这篇文章也可能有用：

[http://blog.fedecarg.com/2009/02/22/zend-framework-the-cost-of-flexibility-is-complexity/](http://blog.fedecarg.com/2009/02/22/zend-framework-the-cost-of-flexibility-is-complexity/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T16:28:42.193

你可以试试代码 Igniter。它非常容易学习并且不严格采用 MVC，同时为您的代码提供良好的结构。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T16:00:39.423

当您需要一个新页面时，您必须创建一个新的模型和控制器动作这一事实我认为并不意味着您的 M、V 和 C 层是紧密耦合的。这只是关注点的分离，有助于解耦系统。

也就是说，很有可能彻底搞砸 MVC 的意图（我曾开发过这样的应用程序）并使其组件紧密耦合。例如，一个站点可能将“渲染引擎”直接放在控制器层中。这显然会增加更多的耦合。相反，将设计一个好的 MVC，以便控制器只知道要使用的视图的名称，然后将该名称传递给单独的渲染引擎。

MVC 中糟糕设计的另一个例子是视图中有硬编码的 URL。这是路由引擎的工作。视图应该只知道需要调用的动作和动作需要的参数。然后，路由引擎将提供正确的 URL。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-01T00:37:24.267

Code Igniter 和 Kohana（CI 后代）都可以，但也可以使用松散的 MVC。我喜欢[简单的 php 框架](http://clickontyler.com/simple-php-framework/)。它不会妨碍你，它提供了重要的东西，而不会给你强加一个结构或复杂的约定。

# c# - 新的 asp:chart 控件是否需要安装在服务器上或者可以从 bin 文件夹中使用

> ID：807170
> 
> 赞同：3
> 
> 时间：2009-04-30T14:23:25.180
> 
> 标签：c#, asp.net, hosting, charts

*   我已经在我的机器上安装了新`asp:chart`控件并构建了一个使用它的应用程序。

*   到目前为止一切都运行良好。现在我想在托管环境中部署我的应用程序。

*   如果我的托管服务提供商没有`asp:chart`安装控件，我可以通过将`.dll`bin 文件夹放入我的应用程序吗？

    （我想我是在问它是否必须在 Gac 中找到）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T14:45:36.903

除了将程序集部署到 bin 文件夹之外，您还需要配置一个具有写入权限的文件夹来临时存储图表图像。

在 web.config 下

```
<appSettings>
    <add key="ChartImageHandler" value="storage=file;timeout=20;dir=D:\TEMPDUMP\;"/>
    ... 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T14:27:51.830

它不必在 GAC 中。如果在 bin 文件夹中找不到应用程序，它将在 GAC 中查找。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T14:30:23.600

只需将 .dll 放入 bin 文件夹中即可。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T16:30:10.240

你也可以看看[OpenFlashChart](http://teethgrinder.co.uk/open-flash-chart-2/)，图表看起来更漂亮

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-01T18:47:16.367

还有一步：在将其部署到服务器之前，您必须创建一个目录以用作服务器上图表图像的临时目录，并且必须将其写入 web.config，如下所示：

```
<add key="ChartImageHandler" value="storage=file; timeout=20; dir=c:\tmpimg;" /> 
```

您可以使用任何您想要的目录。不要忘记在此目录中设置正确的权限。牢记安全措施。

# html - 从 DOM 树 (libxml) 获取 html 属性

> ID：807171
> 
> 赞同：0
> 
> 时间：2009-04-30T14:23:26.707
> 
> 标签：html, xml, parsing, libxml2

我正在使用这个程序来显示给定文件中所有 html 标记的列表：

```
#include <cstdio>
#include <libxml/HTMLparser.h>
#include <libxml/tree.h>
#include <iostream>
#include <cstring>

using namespace std;

static void
print_element_names(htmlNodePtr a_node)
{
    htmlNodePtr cur_node = NULL;

    for (cur_node = a_node; cur_node!=NULL; cur_node = cur_node->next) {
            printf("node type: Element, name: %s\n", cur_node->name);
        print_element_names(cur_node->children);
    }
}

int main(int argc, char **argv) {

  htmlDocPtr doc;
  htmlNodePtr root_node;

  doc = htmlReadFile(argv[1], NULL, 0);
  root_node = xmlDocGetRootElement(doc);

  print_element_names(root_node);

    xmlFreeDoc(doc);

    xmlCleanupParser();

    return 0;

} 
```

我如何让它也显示属性（例如`href="something"`for `<a>`）？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T14:39:34.390

似乎没有这样的领域：

```
zajec@linux-lbnn:~/Prog_zesp> g++ `xml2-config --cflags --libs` -o tester tester.cpp
tester.cpp: In function ‘void print_element_names(xmlNode*)’:
tester.cpp:17: error: ‘struct _xmlNode’ has no member named ‘attributes’ 
```

=== 编辑 ===

如果我做这样的事情：

```
if (strcmp((char *)cur_node->name, "a")==0) {
        cout << cur_node->properties->name << endl; 
```

我得到属性的名称 - “href”

如果我更进一步：

```
if (strcmp((char *)cur_node->name, "a")==0) {
            cout << cur_node->properties->children->name << endl; 
```

我得到“文本”，但不是实际链接。

# python - Python 等价于 Perl 的 while (<>) {...}?

> ID：807173
> 
> 赞同：23
> 
> 时间：2009-04-30T14:23:46.067
> 
> 标签：python, stdin

我编写了许多逐行处理文件的小脚本。在 Perl 中，我使用

```
while (<>) {
    do stuff;
} 
```

这很方便，因为它不关心输入来自哪里（文件或标准输入）。

在 Python 中我使用这个

```
if len(sys.argv) == 2: # there's a command line argument
    sys.stdin = file(sys.argv[1])
for line in sys.stdin.readlines():
    do stuff 
```

这似乎不是很优雅。是否有可以轻松处理文件/标准输入的 Python 习语？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-04-30T14:26:51.863

标准库中的 fileinput 模块正是您想要的：

```
import fileinput

for line in fileinput.input(): ... 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-30T14:27:48.880

```
import fileinput
for line in fileinput.input():
    process(line) 
```

这会遍历 sys.argv[1:] 中列出的所有文件的行，如果列表为空，则默认为 sys.stdin。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-30T14:31:06.173

[fileinput](http://docs.python.org/library/fileinput.html)默认为标准输入，因此会稍微简洁一些。

但是，如果您执行大量命令行操作，则此[管道技巧](http://code.activestate.com/recipes/276960/)非常简洁。

# slug - 我应该即时创建一个 slug 还是存储在 DB 中？

> ID：807195
> 
> 赞同：15
> 
> 时间：2009-04-30T14:27:34.280
> 
> 标签：slug

slug 是描述或标题页面的 URL 的一部分，并且通常为该页面改进 SEO 的关键字丰富。例如，在此 URL [PHP/JS - 即时创建缩略图或存储为文件](https://stackoverflow.com/questions/103707/php-js-create-thumbnails-on-the-fly-or-store-as-files)，最后一节“php-js-create-thumbnails-on-the-fly-or-store-as-files”是 slug。

目前，我正在将每个页面的 slug 与数据库中的页面记录一起存储。当页面生成并与页面一起存储时，从 Title 字段生成 slug。但是，我正在考虑动态生成 slug，以防我想更改它。我正在努力找出哪个更好以及其他人做了什么。

到目前为止，我已经为每个人提出了这些优点：

Store slug：-“更快”的处理器不需要每次都生成它（生成一次）

即时生成： - 灵活（可以调整 slug 算法，不需要为整个表重新生成）。- 在 DB 中使用更少的空间 - 从 DB 传输到 App 的数据更少

我还错过了什么，你会怎么做？

编辑：

我只想澄清答案中的误解。slug 对登陆正确的页面没有影响。要理解这一点，只需切断或破坏本网站上的任何部分。例如：

[PHP/JS - 即时创建缩略图或存储为文件](https://stackoverflow.com/questions/103707/php-js-create-thumbnails-on-the-fly-or-store-as-files)

[PHP/JS - 即时创建缩略图或存储为文件](https://stackoverflow.com/questions/103707/php-js-create-thumbnails-on-the-fly-)

[PHP/JS - 即时创建缩略图或存储为文件](https://stackoverflow.com/questions/103707/php-js-create-thumbnails)

都会将您带到同一页面。slug 永远不会被索引。

你不需要保存旧的蛞蝓。如果您登陆的页面有“旧 slug”，那么您可以检测到该页面，然后执行 301 重定向到正确的“slug”页面。在上面的例子中，如果 Stack Overflow 实现了它，那么当你登陆上面任何带有截断 slug 的链接时，它会将 url 中的 slug 与当前 slug 算法生成的那个进行比较，如果不同，它会执行 301重定向到同一页面，但使用新的 slug。

请记住，所有内部生成的链接都将立即使用新算法，并且只有来自外部指向的链接才会使用旧的 slug。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-30T14:29:23.790

更改现有页面的 slug 不是一个非常糟糕的主意吗？一开始它会破坏你所有的链接。

编辑，按照盖伊在问题中的澄清：你仍然需要考虑旧的蛞蝓。例如：如果您更改 slug 算法，Google 可能会开始看到每个页面的多个版本，并且您可能会遭受重复的内容惩罚，或者最多只能在同一页面的多个版本之间共享 PR 和 SERP。为避免这种情况，您需要任何非规范 slug 重定向到的页面的规范版本 - 因此无论如何您都需要数据库中的规范 slug。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-30T14:34:14.967

您可能需要考虑另一件事，如果您希望用户/您自己能够定义自己的 slug，该怎么办。也许算法并不总是足够的。

如果是这样，无论如何您或多或少都需要将其存储在数据库中。

如果不是，我认为这并不重要，您可以即时生成它们，但如果您不确定是否要更改它们或不让它们在数据库中。在我看来，这两种方法都没有真正的性能问题（除非动态生成非常慢或类似的东西）。

选择最灵活的一种。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-30T14:32:58.900

对于 slug 生成，我不认为生成时间应该是一个问题，除非您的 slug 算法非常复杂！同样，存储空间也不是问题。

我会将蛞蝓存储在数据库中，原因很简单，蛞蝓通常构成永久链接的一部分，一旦永久链接在野外出现，它应该被认为是不可变的。能够更改已发布数据的 slug 似乎是个坏主意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-12-21T13:53:31.330

处理 slug 的最佳方法是仅将 slug 的说话部分存储在数据库中，并保留路由部分具有唯一标识符以用于动态生成。否则（如果您将整个 url 或 uri 存储在数据库中），如果您改变了如何调用它们的想法，那么首先重写数据库中的所有 slug 可能会成为一项艰巨的任务。

让我们以这个问题 SO slug 为例：

/questions/807195/should-i-create-a-slug-on-the-fly-or-store-in-db

它的：

```
/route/unique-ID/the-speaking-part-thats-not-so-important 
```

动态部分显然是：

```
/route/unique-ID/ 
```

我将存储在数据库中的是口语部分：

```
the-speaking-part-thats-not-so-important 
```

这使您可以始终改变对路由名称的想法并进行正确的重定向，而不必先查看数据库内部，并且您不会被迫进行数据库更改。唯一 ID 始终是您的数据库数据唯一 ID，因此您可以正确识别它，并且您当然知道您的路线是什么。

并且不要忘记设置规范标签。如果你看一下这个页面代码，它就在那里：

```
<link rel="canonical" href="http://stackoverflow.com/questions/807195/should-i-create-a-slug-on-the-fly-or-store-in-db" /> 
```

这允许搜索引擎识别正确的页面链接并在您有重复内容的情况下忽略其他链接。

# compiler-construction - 被调用者保存调用者传递使用的寄存器？

> ID：807204
> 
> 赞同：2
> 
> 时间：2009-04-30T14:30:10.683
> 
> 标签：compiler-construction, cpu-registers, register-allocation

在编译器设计中，为什么调用者不能将其已用寄存器列表（在调用者保存安排的情况下它将推送）传递给被调用者，以便被调用者可以比较它的而不是调用者或被调用者寄存器保存安排使用的寄存器列表到调用者使用的寄存器。然后只有真正需要推送的寄存器才会被推送。我错过了什么吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-01T02:41:03.393

这是一个有趣的想法。我认为有两件事使它不那么吸引人：

*   无论如何，被调用者必须为最坏的情况保留堆栈空间。
*   为了提高效率，您需要专门的指令来一次性存储和加载寄存器集。摩托罗拉 68000（也可能是 PowerPC）上有这样的说明，但它们并不流行。

下面是它必须如何工作的一点详细说明：您希望调用者将列表打包成一个机器字作为位向量。然后，您将需要被调用者按位并使用其自己的列表，该指令具有保存由结果位向量命名的所有寄存器的指令。

因为您将不得不为最坏的情况在堆栈上保留空间，所以您不会节省太多——在现代、超标量、无序处理器上，写入同一高速缓存行几乎是免费的。

同样，如果您真正想要的是在运行时最小化加载和存储的数量，您只需使用所有调用者保存寄存器。这种策略还使得引发异常和抢先切换线程变得非常便宜，并且许多编译器（如[OCaml](http://caml.inria.fr)）出于这个原因使用它。被调用者保存寄存器是一种尝试减少溢出和重新加载指令的代码大小的技巧。它们在许多情况下都可以工作，并且它们节省空间，因为调用站点的数量远远超过过程定义（平均而言，一个过程包含多个调用）。

有关调用者保存和被调用者保存寄存器之间权衡的更多信息，请参阅[Jack Davidson 和 David Whalley 的一篇不错的论文](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.14.4669&rep=rep1&type=pdf)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T14:32:55.467

这是非常低效的......您将需要解析列表（对于每个函数！）这是完全没有必要的。

# programming-languages - 桌面 Web 监控客户端的推荐实现？

> ID：807205
> 
> 赞同：0
> 
> 时间：2009-04-30T14:30:22.820
> 
> 标签：programming-languages, client, monitoring, desktop

### 背景

我有一个商业想法，其中一个组件涉及一个客户端，成千上万的用户将通过网页下载和安装该客户端。

### 申请要求

版本 1：

申请必须：

*   监控用户桌面上的互联网使用情况，并监控以下区域：

    *   使用的浏览器，
    *   使用小时数
    *   访问的网站
    *   考虑到哪个浏览器选项卡是“活动的”
*   生成此使用情况的报告（以`CSV`或其他易于导出的格式）

*   它需要由用户轻松监控（例如，在 Windows 中，通过系统托盘中的图标允许用户暂停或停止程序）。
*   通过自动更新轻松升级。
*   在内存使用方面需要轻量级。
*   需要方便快捷地安装，
    *   必须能够完全卸载。
*   不会对浏览器或用户的系统性能体验产生不利影响

对于版本 2：

*   能够呈现图形输出（饼图和条形图）
*   多平台（版本 1 仅针对 Windows）
*   集成在线组件

### 问题

鉴于这些要求，您会推荐什么技术实现，以及您会推荐什么平台/语言架构？关键方面是功能和对用户的广泛定义的低影响。ETA 或成本不太重要。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T14:33:31.723

听起来 C# 可以满足您的需求，只要它仅限于 Windows 客户端。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T14:53:00.567

去年我建造了一些与此非常相似的东西。我用 C#。最初它利用了一些 3.5 框架，但由于安装大小的限制，我不得不将其缩回到 2.0 框架。它目前正在监控大约 13,000 台机器。每分钟收集大约 3MB 的数据并将其发送回报表服务器。

客户端机器的范围从具有 256MB RAM 的 Pentium 4 机器（在高达双核 2GB 机器上运行 XP）。

我构建的应用程序不会被最终用户触摸，因此它作为 Windows 服务和 IE 浏览器帮助对象插件的组合运行。BHO 对于准确捕捉浏览器中正在发生的事情是必要的。

唯一真正的挑战是让它在 XP 和 Vista（所有服务包级别）以及 IE 6 和 7 下工作。XP 和 Vista 有不同的安全隐患需要考虑；IE 6 和 7 也有不同的访问模式。

最后，我们决定与 Firefox 或其他浏览器打交道，因为客户根本不关心它。

**更新**

Firefox 仅支持 javascript、c++ 和 xul 代码扩展；使用 c# 将是一个完整的 PITA。如果它可以满足我的需要，我可能会尝试 javascript，因为它更容易。

至于 Chrome，他们最近才开始支持扩展（ 2009 年[3 月 19 日](http://www.chromeplugins.org/extensions/google-chrome-gets-premilinary-support-for-extensionsplugins/)）。您必须更改快捷方式启动属性才能运行它们。所以，我可能会跳过那个浏览器，直到它成熟一点。我想在接下来的一年里，插件的构建方式将会发生很多变化。

关于每分钟的数据量，这是一个汇总值。每个单独的客户每十五分钟左右只检查一次；或在断开工作时重新连接到网络。因此，个人流量非常低，对用户体验没有影响。

**防火墙**

防火墙对我们来说真正无关紧要的原因是数据使用 Web 服务通过端口 80 传输回我们的报告服务器。如果 80 被阻止，那么他们无论如何都无法浏览，所以没有什么可收集的……至于带宽，限制你收集的内容并广播出去。具有长描述性属性/值名称的 XML 不是您的朋友。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T14:36:38.983

Qt 和 C++ 非常适合跨平台客户端——尤其是。如果他们需要以某种方式“节省内存”，而垃圾收集语言（即基本上所有其他语言）通常没有解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T14:45:55.453

我们需要更多信息：

是时候发展一个问题了吗？使用C#，您可以快速开发这样的应用程序；但它不一定具有与 C++ 相同的低级性能。您可以在 C++ 中开发某些部分（内存密集位），而在 C# 中开发其他部分，但是您的客户端必须安装 .NET 框架；更不用说他们可以很容易地对 C# 部分进行逆向工程。

有一个项目三角形，我们需要知道哪两个对您最重要：

![替代文字](https://upload.wikimedia.org/wikipedia/en/thumb/3/33/Project_Triangle.svg/600px-Project_Triangle.svg.png)

# c# - 如果数据库丢失，使 SQLite 连接失败？（删除/移动）

> ID：807208
> 
> 赞同：7
> 
> 时间：2009-04-30T14:30:59.497
> 
> 标签：c#, sqlite

我里面有以下方法`class DBConnection`。我这样调用方法：`SQLiteConnection conn = DBConnection.OpenDB();`当我想打开一个连接时，我可以执行我的查询。当我想关闭连接时，我可以调用类似的方法。

方法：

```
public static SQLiteConnection OpenDB()
{
    try
    {
        //Gets connectionstring from app.config
        string myConnectString =
            ConfigurationManager.ConnectionStrings[
                "LegMedSQLLite.Properties.Settings.LegMedSQLLiteDBConnectionString"].ConnectionString;

        var conn = new SQLiteConnection(myConnectString);

        conn.Open();
        return conn;
    }
    catch (SQLiteException e)
    {
        MessageBox.Show(e.ToString(), "TEST");
        return null;
    }
} 
```

这一切都很好，花花公子。问题是尝试捕获。让我们想象以下场景：

*   数据库文件已被移动/删除。

永远不会抛出异常。实际上，我偶然发现的第一个问题是当我执行我的第一个查询时 - 它认为没有这样的表并且它抛出了自己的异常。我被这个奇怪的现象惊呆了，但我很快发现 SQLite 创建了一个新的 **空**数据库。空意味着**没有表**，什么都没有，只是一个与应该存在的旧数据库同名的 SQLite 数据库文件。

这是一个问题，我希望应用程序在我尝试调用`SQLiteConnection conn = DBConnection.OpenDB();`.

当然，我可以尝试在我的方法中调用 File.Exists，但这似乎不是一个合适的解决方案。有什么帮助吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-30T20:02:01.620

至少在 System.Data.SQLite 中，您可以将“ **`FailIfMissing=True`**”添加到您的连接字符串中。 如果数据库文件不存在，`SQLiteConnection.Open()`将抛出一个。`SQLiteException`

```
string ConnectString = "Data Source=file.sdb; FailIfMissing=True";
DbConnection db = new SQLiteConnection(ConnectString);
db.Open(); // Fails if file.sdb does not exist 
```

有关另一个示例，请参阅[SQLite 连接字符串](http://www.connectionstrings.com/sqlite)示例，查找“禁用创建数据库行为”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T14:37:01.043

我没有使用过 SQLite，但自动创建一个全新的数据库是一种非常奇怪的行为。

您可以`Select top 1 * From Table`在打开连接后立即调整您的 try 块以执行 a，如果它有效，则丢弃结果并继续返回您的`conn`对象。如果失败，则应触发异常处理程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T20:30:03.393

如果要在启动时检测数据库损坏问题，可以执行命令

编译指示完整性检查；

或者

编译指示快速检查；（这更快，但不太彻底）

这将返回值为“ok”的单行。

否则它将报告它遇到的错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-09-15T08:01:25.620

对于 sqlite，请使用：假设您在文本框 txtConnSqlite 中有连接字符串

```
 Using conn As New System.Data.SQLite.SQLiteConnection(txtConnSqlite.Text)
            Dim FirstIndex As Int32 = txtConnSqlite.Text.IndexOf("Data Source=")
            If FirstIndex = -1 Then MsgBox("ConnectionString is incorrect", MsgBoxStyle.Exclamation, "Sqlite") : Exit Sub
            Dim SecondIndex As Int32 = txtConnSqlite.Text.IndexOf("Version=")
            If SecondIndex = -1 Then MsgBox("ConnectionString is incorrect", MsgBoxStyle.Exclamation, "Sqlite") : Exit Sub
            Dim FilePath As String = txtConnSqlite.Text.Substring(FirstIndex + 12, SecondIndex - FirstIndex - 13)
            If Not IO.File.Exists(FilePath) Then MsgBox("Database file not found", MsgBoxStyle.Exclamation, "Sqlite") : Exit Sub
            Try
                conn.Open()
                Dim cmd As New System.Data.SQLite.SQLiteCommand("SELECT * FROM sqlite_master WHERE type='table';", conn)
                Dim reader As System.Data.SQLite.SQLiteDataReader
                cmd.ExecuteReader()
                MsgBox("Success", MsgBoxStyle.Information, "Sqlite")
            Catch ex As Exception
                MsgBox("Connection fail", MsgBoxStyle.Exclamation, "Sqlite")
            End Try
         End Using 
```

我认为您可以轻松地将其转换为 c# 代码

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-30T14:55:48.987

不要追到那个水平。相反，`SQLiteConnection`应该实现 IDisposable，这意味着您应该只返回打开的连接并允许调用代码处理任何异常，以及依赖 Dispose 方法来关闭连接。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-04-30T14:54:35.790

如果无法更改默认 SQLite 行为，那么您可能必须执行 File.Exists。这比连接并创建一个新文件，检查它是否是您想要的数据库，然后在 catch 块中删除新文件要好。

# c# - 当一个接口从另一个接口“继承”时，你怎么称呼它？

> ID：807217
> 
> 赞同：44
> 
> 时间：2009-04-30T14:33:06.700
> 
> 标签：c#, oop, interface

如果我有 B 类：A {}

我说“B类*继承*A 类”或“B 类派生自 A 类”。

但是，如果我改为：

```
 class B : ISomeInterface   {} 
```

说“B 继承 ISomeInterface”是错误的——正确的说法是说“B*实现*ISomeInterface”。

但是，说我有

```
 interface ISomeInterface : ISomeOtherInterface   {} 
```

现在，说“继承”仍然是错误的，但现在说“实现”同样是错误的，因为 ISomeInterface 没有实现任何东西。

那么，你把这种关系称为什么？

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2009-04-30T14:34:20.817

我个人说“扩展”，我*认为*C# 规范在某个地方也使用了这个词（不幸的是，我现在找不到它）——但我记得 Eric Lippert 说他不喜欢它，并想改变它4.0。

我认为这很好，因为它表明您正在扩展原始接口指定的合同。

编辑：查看了 3.0 规范...

规范类型回避了第 13.2 节中的问题。它讨论了从基本接口继承的成员。它谈论一个*类*扩展另一个类，但不是接口

编辑：在 C# 5 规范第 13.1.4 节中，它使用继承：

> 一个接口可以从零个或多个接口类型继承

所以这可能是最好的术语。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-30T14:34:34.543

我称之为“扩展”。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-02-04T03:47:50.387

通常，我称之为过度工程。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-04-09T07:35:16.957

作为**权威来源**，如果您需要有用的报价，我[在 MSDN 上](https://www.microsoft.com/en-us/download/details.aspx?id=55979)看到了描述“**接口继承**”的信息，其中包含 ComboBox、Control、Listbox 和 TextBox 的接口继承结构的实际示例：

并提到了一个显式的基本接口

> **一个接口可以从零个或多个接口继承**，这些接口称为接口的**显式基**接口。

例子：

```
interface IControl
{
   void Paint();
}
interface ITextBox: IControl
{
   void SetText(string text);
}
interface IListBox: IControl
{
   void SetItems(string[] items);
}
interface IComboBox: ITextBox, IListBox {} 
```

来源：

[http://msdn.microsoft.com/en-us/library/aa664578%28VS.71%29.aspx](http://msdn.microsoft.com/en-us/library/aa664578%28VS.71%29.aspx)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-30T14:48:26.820

为什么说 InterfaceB“继承”或“派生自”InterfaceA 是错误的？“实现”是错误的，因为 InterfaceB 不提供实现。从语义上讲，派生接口与派生类非常相似。例如，C++ 根本不区分接口和类。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-30T14:36:24.710

你定义错了。

B ：A 表示“B 继承自 A”。

当我们说“B 实现 InterfaceA”时，这通常意味着 InterfaceA 没有定义功能 - 它只是原型（或者，C++ 中的 PURE）。但是在 C++ 和大多数 OOPL 中，继承和实现共享相同的语法。

所以， InterfaceB : InterfaceA 仍然意味着“InterfaceB 继承 InterfaceA”。

# asp.net - Asp.Net 网站在 IE6 中看起来不错，但在 IE7/IE8 中却不行

> ID：807219
> 
> 赞同：1
> 
> 时间：2009-04-30T14:33:11.503
> 
> 标签：asp.net, webforms, internet-explorer-6, internet-explorer-8

我有一个使用 VS2005 和 mySQl 开发的小网站，它只有 2 个网络表单和登录页面。

在开发和测试阶段，我和我的客户使用的是IE6，看起来还不错，我们没有用其他浏览器测试，因为它是一个小应用程序，只是一个大型桌面应用程序的插件。

客户告诉我，当他安装 IE7 时，网站不喜欢这样'不导航到 Gridview 中的其他页面，但在 IE6 上运行良好，并且没有复杂的东西，只需用小格式规划 GridView。

我安装了 IE8，但它看起来也不太好，即使是在兼容的情况下。

有没有人遇到过同样的问题？，什么应该是最快或最好的解决方案？

我知道，**我不应该再使用网络表单了。**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T14:39:31.647

浏览器版本之间外观不同的唯一原因是您的样式和文档类型。

首先将 doctype 设置为在 quirks 模式下运行。您可以在此处获取[有关它的信息](http://www.alistapart.com/articles/doctype/)。

之后，看看情况是否有所改善。如果没有，我会开始删除您可能正在使用的任何 CSS/样式/主题。然后使用普通的 CSS 构建它。

顺便说一句，在这种情况下，Web 表单不是问题。这是一个样式问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T18:27:10.770

正如 Chris 所提到的，除此之外，浏览器确实存在一些令人讨厌的差异，这些差异有时会让你抓狂，而且 90% 的时间它与 CSS 相关。

所以我建议如下

*   使用一个叫做 IE Tester 的工具，它是一个很棒的工具，可以让你在所有 IE 版本中测试你的网站。
*   如果某些 CSS 规则错误，请使用条件命令来定位 IE 特定版本。
*   我们使用这个工具[http://rafael.adm.br/css_browser_selector/](http://rafael.adm.br/css_browser_selector/)真的很神奇，它可以让你为每个浏览器定义 css 规则而无需 hacking 或条件语句，但缺点是它依赖于 Javascript，但我们没有抱怨。
*   这个脚本[http://dean.edwards.name/IE7/](http://dean.edwards.name/IE7/) 也很棒，它会让 IE 6 像 IE 7 一样运行，这将为您节省大量问题，它再次依赖于 Java 脚本。
*   尽量避免 Hacks，以上方法对你有很大帮助。

希望这可以帮助。

# java - 如何在 Java 5 中使用 ExecutorService 实现任务优先级？

> ID：807223
> 
> 赞同：47
> 
> 时间：2009-04-30T14:33:34.717
> 
> 标签：java, multithreading, concurrency

我正在实现一个线程池机制，我想在其中执行不同优先级的任务。我想有一个很好的机制，我可以向服务提交高优先级任务，并在其他任务之前安排它。任务的优先级是任务本身的固有属性（我是否将该任务表示为 a`Callable`或 a`Runnable`对我来说并不重要）。

现在，从表面上看，我可以使用 a`PriorityBlockingQueue`作为我的任务队列`ThreadPoolExecutor`，但该队列包含对象，这些对象可能是我提交给它`Runnable`的任务，也可能不是。`Runnable`此外，如果我提交了`Callable`任务，则不清楚这将如何映射。

有没有办法做到这一点？我真的不想为此而自己动手，因为那样我更有可能弄错。

（顺便说一句；是的，我知道在这样的事情中，低优先级工作可能会被饿死。对于具有合理保证公平性的解决方案，加分（？！））

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2012-02-25T18:25:44.667

我已经以一种合理的方式解决了这个问题，我将在下面描述它，以供我自己和其他任何使用 Java Concurrent 库遇到这个问题的人参考。

使用 a`PriorityBlockingQueue`作为保留任务以供以后执行的手段确实是朝着正确方向发展的方向。问题是`PriorityBlockingQueue`必须一般实例化以包含`Runnable`实例，并且不可能在接口上调用`compareTo`（或类似的） 。`Runnable`

来解决问题。创建 Executor 时，必须给它一个`PriorityBlockingQueue`. 应该进一步为队列提供一个自定义 Comparator 以进行适当的就地排序：

```
new PriorityBlockingQueue<Runnable>(size, new CustomTaskComparator()); 
```

现在，看看`CustomTaskComparator`：

```
public class CustomTaskComparator implements Comparator<MyType> {

    @Override
    public int compare(MyType first, MyType second) {
         return comparison;
    }

} 
```

到目前为止，一切看起来都很简单。这里有点粘。我们的下一个问题是处理从 Executor 创建 FutureTasks。在 Executor 中，我们必须`newTaskFor`像这样覆盖：

```
@Override
protected <V> RunnableFuture<V> newTaskFor(Callable<V> c) {
    //Override the default FutureTask creation and retrofit it with
    //a custom task. This is done so that prioritization can be accomplished.
    return new CustomFutureTask(c);
} 
```

我们要执行`c`的任务在哪里。`Callable`现在，让我们来看看`CustomFutureTask`：

```
public class CustomFutureTask extends FutureTask {

    private CustomTask task;

    public CustomFutureTask(Callable callable) {
        super(callable);
        this.task = (CustomTask) callable;
    }

    public CustomTask getTask() {
        return task;
    }

} 
```

注意`getTask`方法。我们稍后将使用它来从`CustomFutureTask`我们创建的这个中获取原始任务。

最后，让我们修改我们试图执行的原始任务：

```
public class CustomTask implements Callable<MyType>, Comparable<CustomTask> {

    private final MyType myType;

    public CustomTask(MyType myType) {
        this.myType = myType;
    }

    @Override
    public MyType call() {
        //Do some things, return something for FutureTask implementation of `call`.
        return myType;
    }

    @Override
    public int compareTo(MyType task2) {
        return new CustomTaskComparator().compare(this.myType, task2.myType);
    }

} 
```

可以看到我们`Comparable`在任务中实现了委托给实际`Comparator`的 for `MyType`。

有了它，使用 Java 库为 Executor 自定义优先级！它需要一些弯曲，但这是我能想到的最干净的。我希望这对某人有帮助！

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-30T15:11:25.530

乍一看，您似乎可以为扩展`Runnable`或`Callable<T>`和的任务定义一个接口`Comparable`。`ThreadPoolExecutor`然后用 a包装 a`PriorityBlockingQueue`作为队列，并且只接受实现你的接口的任务。

考虑到您的评论，看起来一种选择是扩展`ThreadPoolExecutor`并覆盖`submit()`方法。参考`AbstractExecutorService`看看默认的是什么样子的；他们所做的就是将`Runnable`or包裹`Callable`在 a`FutureTask`和`execute()`it 中。我可能会通过编写一个实现`ExecutorService`并委托给匿名内部的包装类来做到这一点`ThreadPoolExecutor`。将它们包裹在您优先考虑的东西中，以便您`Comparator`可以完成它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-05-16T01:50:58.693

您可以使用这些辅助类：

```
public class PriorityFuture<T> implements RunnableFuture<T> {

    private RunnableFuture<T> src;
    private int priority;

    public PriorityFuture(RunnableFuture<T> other, int priority) {
        this.src = other;
        this.priority = priority;
    }

    public int getPriority() {
        return priority;
    }

    public boolean cancel(boolean mayInterruptIfRunning) {
        return src.cancel(mayInterruptIfRunning);
    }

    public boolean isCancelled() {
        return src.isCancelled();
    }

    public boolean isDone() {
        return src.isDone();
    }

    public T get() throws InterruptedException, ExecutionException {
        return src.get();
    }

    public T get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException {
        return src.get(timeout, unit);
    }

    public void run() {
        src.run();
    }

    public static Comparator<Runnable> COMP = new Comparator<Runnable>() {
        public int compare(Runnable o1, Runnable o2) {
            if (o1 == null && o2 == null)
                return 0;
            else if (o1 == null)
                return -1;
            else if (o2 == null)
                return 1;
            else {
                int p1 = ((PriorityFuture<?>) o1).getPriority();
                int p2 = ((PriorityFuture<?>) o2).getPriority();

                return p1 > p2 ? 1 : (p1 == p2 ? 0 : -1);
            }
        }
    };
} 
```

**和**

```
public interface PriorityCallable<T> extends Callable<T> {

    int getPriority();

} 
```

**和**这个辅助方法：

```
public static ThreadPoolExecutor getPriorityExecutor(int nThreads) {
    return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS,
            new PriorityBlockingQueue<Runnable>(10, PriorityFuture.COMP)) {

        protected <T> RunnableFuture<T> newTaskFor(Callable<T> callable) {
            RunnableFuture<T> newTaskFor = super.newTaskFor(callable);
            return new PriorityFuture<T>(newTaskFor, ((PriorityCallable<T>) callable).getPriority());
        }
    };
} 
```

**然后像这样使用它 **：****

 **```
class LenthyJob implements PriorityCallable<Long> {
    private int priority;

    public LenthyJob(int priority) {
        this.priority = priority;
    }

    public Long call() throws Exception {
        System.out.println("Executing: " + priority);
        long num = 1000000;
        for (int i = 0; i < 1000000; i++) {
            num *= Math.random() * 1000;
            num /= Math.random() * 1000;
            if (num == 0)
                num = 1000000;
        }
        return num;
    }

    public int getPriority() {
        return priority;
    }
}

public class TestPQ {

    public static void main(String[] args) throws InterruptedException, ExecutionException {
        ThreadPoolExecutor exec = getPriorityExecutor(2);

        for (int i = 0; i < 20; i++) {
            int priority = (int) (Math.random() * 100);
            System.out.println("Scheduling: " + priority);
            LenthyJob job = new LenthyJob(priority);
            exec.submit(job);
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-01-24T10:07:02.333

我将尝试用一个功能齐全的代码来解释这个问题。但在深入研究代码之前，我想解释一下 PriorityBlockingQueue

**PriorityBlockingQueue**：PriorityBlockingQueue 是 BlockingQueue 的一个实现。它接受任务及其优先级，并首先提交具有最高优先级的任务执行。如果任何两个任务具有相同的优先级，那么我们需要提供一些自定义逻辑来决定哪个任务先执行。

现在让我们直接进入代码。

**驱动程序类**：该类创建一个执行器，它接受任务并稍后提交它们以供执行。在这里，我们创建了两个任务，一个具有 LOW 优先级，另一个具有 HIGH 优先级。在这里，我们告诉执行程序运行 MAX 1 个线程并使用 PriorityBlockingQueue。

```
 public static void main(String[] args) {

       /*
       Minimum number of threads that must be running : 0
       Maximium number of threads that can be created : 1
       If a thread is idle, then the minimum time to keep it alive : 1000
       Which queue to use : PriorityBlockingQueue
       */
    PriorityBlockingQueue queue = new PriorityBlockingQueue();
    ThreadPoolExecutor executor = new ThreadPoolExecutor(0,1,
        1000, TimeUnit.MILLISECONDS,queue);

    MyTask task = new MyTask(Priority.LOW,"Low");
    executor.execute(new MyFutureTask(task));
    task = new MyTask(Priority.HIGH,"High");
    executor.execute(new MyFutureTask(task));
    task = new MyTask(Priority.MEDIUM,"Medium");
    executor.execute(new MyFutureTask(task));

} 
```

**MyTask 类**：MyTask 实现 Runnable 并接受优先级作为构造函数中的参数。当这个任务运行时，它会打印一条消息，然后让线程休眠 1 秒。

```
 public class MyTask implements Runnable {

  public int getPriority() {
    return priority.getValue();
  }

  private Priority priority;

  public String getName() {
    return name;
  }

  private String name;

  public MyTask(Priority priority,String name){
    this.priority = priority;
    this.name = name;
  }

  @Override
  public void run() {
    System.out.println("The following Runnable is getting executed "+getName());
    try {
      Thread.sleep(1000);
    } catch (InterruptedException e) {
      e.printStackTrace();
    }
  }

} 
```

**MyFutureTask 类**：由于我们使用 PriorityBlocingQueue 来保存我们的任务，我们的任务必须包装在 FutureTask 中，并且我们的 FutureTask 实现必须实现 Comparable 接口。Comparable接口比较2个不同任务的优先级，提交优先级最高的任务执行。

```
 public class MyFutureTask extends FutureTask<MyFutureTask>
      implements Comparable<MyFutureTask> {

    private  MyTask task = null;

    public  MyFutureTask(MyTask task){
      super(task,null);
      this.task = task;
    }

    @Override
    public int compareTo(MyFutureTask another) {
      return task.getPriority() - another.task.getPriority();
    }
  } 
```

**优先级**：不言自明的优先级。

```
public enum Priority {

  HIGHEST(0),
  HIGH(1),
  MEDIUM(2),
  LOW(3),
  LOWEST(4);

  int value;

  Priority(int val) {
    this.value = val;
  }

  public int getValue(){
    return value;
  }

} 
```

现在当我们运行这个例子时，我们得到以下输出

```
The following Runnable is getting executed High
The following Runnable is getting executed Medium
The following Runnable is getting executed Low 
```

尽管我们先提交了 LOW 优先级，然后再提交 HIGH 优先级任务，但是由于我们使用的是 PriorityBlockingQueue，所以任何具有更高优先级的任务都会先执行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-03-16T10:20:02.367

我的解决方案保留了相同优先级的任务提交顺序。这是对这个[答案的改进](https://stackoverflow.com/a/16834473/1386911)

**任务执行顺序**基于：

1.  优先事项
2.  提交订单（相同优先级）

**测试类：**

```
public class Main {

    public static void main(String[] args) throws InterruptedException, ExecutionException {

        ExecutorService executorService = PriorityExecutors.newFixedThreadPool(1);

        //Priority=0
        executorService.submit(newCallable("A1", 200));     //Defaults to priority=0 
        executorService.execute(newRunnable("A2", 200));    //Defaults to priority=0
        executorService.submit(PriorityCallable.of(newCallable("A3", 200), 0));
        executorService.submit(PriorityRunnable.of(newRunnable("A4", 200), 0));
        executorService.execute(PriorityRunnable.of(newRunnable("A5", 200), 0));
        executorService.submit(PriorityRunnable.of(newRunnable("A6", 200), 0));
        executorService.execute(PriorityRunnable.of(newRunnable("A7", 200), 0));
        executorService.execute(PriorityRunnable.of(newRunnable("A8", 200), 0));

        //Priority=1
        executorService.submit(PriorityRunnable.of(newRunnable("B1", 200), 1));
        executorService.submit(PriorityRunnable.of(newRunnable("B2", 200), 1));
        executorService.submit(PriorityCallable.of(newCallable("B3", 200), 1));
        executorService.execute(PriorityRunnable.of(newRunnable("B4", 200), 1));
        executorService.submit(PriorityRunnable.of(newRunnable("B5", 200), 1));

        executorService.shutdown();

    }

    private static Runnable newRunnable(String name, int delay) {
        return new Runnable() {
            @Override
            public void run() {
                System.out.println(name);
                sleep(delay);
            }
        };
    }

    private static Callable<Integer> newCallable(String name, int delay) {
        return new Callable<Integer>() {
            @Override
            public Integer call() throws Exception {
                System.out.println(name);
                sleep(delay);
                return 10;
            }
        };
    }

    private static void sleep(long millis) {
        try {
            Thread.sleep(millis);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
            throw new RuntimeException(e);
        }
    }

} 
```

**结果：**

> A1 B1 B2 B3 B4 B5 A2 A3 A4 A5 A6 A7 A8
> 
> 第一个任务是 A1，因为插入时队列中没有更高的优先级。B任务优先级为1所以执行较早，A任务优先级为0所以执行较晚，但执行顺序遵循提交顺序：B1，B2，B3，... A2，A3，A4 ...

**解决方案：**

```
public class PriorityExecutors {

    public static ExecutorService newFixedThreadPool(int nThreads) {
        return new PriorityExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS);
    }

    private static class PriorityExecutor extends ThreadPoolExecutor {
        private static final int DEFAULT_PRIORITY = 0;
        private static AtomicLong instanceCounter = new AtomicLong();

        @SuppressWarnings({"unchecked"})
        public PriorityExecutor(int corePoolSize, int maximumPoolSize,
                long keepAliveTime, TimeUnit unit) {
            super(corePoolSize, maximumPoolSize, keepAliveTime, unit, (BlockingQueue) new PriorityBlockingQueue<ComparableTask>(10,
                    ComparableTask.comparatorByPriorityAndSequentialOrder()));
        }

        @Override
        public void execute(Runnable command) {
            // If this is ugly then delegator pattern needed
            if (command instanceof ComparableTask) //Already wrapped
                super.execute(command);
            else {
                super.execute(newComparableRunnableFor(command));
            }
        }

        private Runnable newComparableRunnableFor(Runnable runnable) {
            return new ComparableRunnable(ensurePriorityRunnable(runnable));
        }

        @Override
        protected <T> RunnableFuture<T> newTaskFor(Callable<T> callable) {
            return new ComparableFutureTask<>(ensurePriorityCallable(callable));
        }

        @Override
        protected <T> RunnableFuture<T> newTaskFor(Runnable runnable, T value) {
            return new ComparableFutureTask<>(ensurePriorityRunnable(runnable), value);
        }

        private <T> PriorityCallable<T> ensurePriorityCallable(Callable<T> callable) {
            return (callable instanceof PriorityCallable) ? (PriorityCallable<T>) callable
                    : PriorityCallable.of(callable, DEFAULT_PRIORITY);
        }

        private PriorityRunnable ensurePriorityRunnable(Runnable runnable) {
            return (runnable instanceof PriorityRunnable) ? (PriorityRunnable) runnable
                    : PriorityRunnable.of(runnable, DEFAULT_PRIORITY);
        }

        private class ComparableFutureTask<T> extends FutureTask<T> implements ComparableTask {
            private Long sequentialOrder = instanceCounter.getAndIncrement();
            private HasPriority hasPriority;

            public ComparableFutureTask(PriorityCallable<T> priorityCallable) {
                super(priorityCallable);
                this.hasPriority = priorityCallable;
            }

            public ComparableFutureTask(PriorityRunnable priorityRunnable, T result) {
                super(priorityRunnable, result);
                this.hasPriority = priorityRunnable;
            }

            @Override
            public long getInstanceCount() {
                return sequentialOrder;
            }

            @Override
            public int getPriority() {
                return hasPriority.getPriority();
            }
        }

        private static class ComparableRunnable implements Runnable, ComparableTask {
            private Long instanceCount = instanceCounter.getAndIncrement();
            private HasPriority hasPriority;
            private Runnable runnable;

            public ComparableRunnable(PriorityRunnable priorityRunnable) {
                this.runnable = priorityRunnable;
                this.hasPriority = priorityRunnable;
            }

            @Override
            public void run() {
                runnable.run();
            }

            @Override
            public int getPriority() {
                return hasPriority.getPriority();
            }

            @Override
            public long getInstanceCount() {
                return instanceCount;
            }
        }

        private interface ComparableTask extends Runnable {
            int getPriority();

            long getInstanceCount();

            public static Comparator<ComparableTask> comparatorByPriorityAndSequentialOrder() {
                return (o1, o2) -> {
                    int priorityResult = o2.getPriority() - o1.getPriority();
                    return priorityResult != 0 ? priorityResult
                            : (int) (o1.getInstanceCount() - o2.getInstanceCount());
                };
            }

        }

    }

    private static interface HasPriority {
        int getPriority();
    }

    public interface PriorityCallable<V> extends Callable<V>, HasPriority {

        public static <V> PriorityCallable<V> of(Callable<V> callable, int priority) {
            return new PriorityCallable<V>() {
                @Override
                public V call() throws Exception {
                    return callable.call();
                }

                @Override
                public int getPriority() {
                    return priority;
                }
            };
        }
    }

    public interface PriorityRunnable extends Runnable, HasPriority {

        public static PriorityRunnable of(Runnable runnable, int priority) {
            return new PriorityRunnable() {
                @Override
                public void run() {
                    runnable.run();
                }

                @Override
                public int getPriority() {
                    return priority;
                }
            };
        }
    }

} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T14:42:33.807

每个优先级可以有一个[ThreadPoolExecutor吗？](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ThreadPoolExecutor.html)可以使用ThreadFactory 实例化[ThreadPoolExecutor](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ThreadPoolExecutor.html)，并且您可以拥有自己的[ThreadFactory](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ThreadFactory.html)实现来设置不同的优先级。

```
 class MaxPriorityThreadFactory implements ThreadFactory {
     public Thread newThread(Runnable r) {
         Thread thread = new Thread(r);
         thread.setPriority(Thread.MAX_PRIORITY);
     }
 } 
```

# asp.net - 如何优化 Microsoft AJAX 工具包？

> ID：807225
> 
> 赞同：1
> 
> 时间：2009-04-30T14:33:57.120
> 
> 标签：asp.net, asp.net-ajax

这个比较气人。我正在尝试优化一个非常大的站点，并且正在减少 HTTP 请求的步骤。微软不合作。我包含以下 ScriptResources。我会尝试为每个人抓住一个顶线来区分它们

1.  // 名称：MicrosoftAjax.debug.js 53.5Kb
2.  // 名称：MicrosoftAjaxWebForms.debug.js 14Kb
3.  AjaxControlToolkit.BoxSide = function() { 11.4Kb
4.  /// Sys.UI.DomElement **958 字节！**
5.  // Sys.Timer **982 字节！**
6.  // IDropSource 6.5Kb
7.  AjaxControlToolkit.FloatingBehavior = 函数（元素）{ 2.2Kb
8.  AjaxControlToolkit.BehaviorBase = 函数（元素）{ 5.4Kb
9.  AjaxControlToolkit.DynamicPopulateBehavior = 函数（元素）{ 2.9Kb
10.  AjaxControlToolkit.BoxCorners = function() { 3.6Kb
11.  AjaxControlToolkit.DropShadowBehavior = 函数（元素）{ 3.4Kb
12.  AjaxControlToolkit.ModalPopupBehavior = 函数（元素）{ 5.5Kb

**来吧！** 12个血腥的javascript包括！不到一千字节！获取 dang 数据的一半时间可能都花在了请求上！啊！

无论如何，正如你所看到的，我很生气。有什么方法可以把它们卷起来，然后组合起来吗？喜欢*一个*请求？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T14:41:57.303

> 只需 在您的 ASPX 页面中替换`<asp:ScriptManager ... />` 为即可！`<ajaxToolkit:ToolkitScriptManager> ... />`

[http://blogs.msdn.com/delay/archive/2007/06/11/script-combining-made-easy-overview-of-the-ajax-control-toolkit-s-toolkitscriptmanager.aspx](http://blogs.msdn.com/delay/archive/2007/06/11/script-combining-made-easy-overview-of-the-ajax-control-toolkit-s-toolkitscriptmanager.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T14:40:43.373

您可以编写一个 HTTPModule 来从响应中获取所有 axd/js 文件，将它们组合成一个，然后通过对 HTTPHandler 的请求将它们发送到客户端的浏览器。

您可以查看[Mads Kristensen 的](http://madskristensen.net/post/Compress-WebResourceaxd-in-ASPNET.aspx)网站以了解我在说什么。对于像您这样的问题，有很多文章/解决方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T14:41:53.853

检查这个：

[通过批量下载多个 javascript 来快速加载 ASP.NET 网页](http://weblogs.asp.net/omarzabir/archive/2008/05/10/fast-asp-net-web-page-loading-by-downloading-multiple-javascripts-in-batch.aspx)

此外，一个常见的错误是`<compilation debug=”true”/>`在我见过的一些网站中设置。根据[Scott Gu](http://weblogs.asp.net/scottgu/archive/2006/04/11/Don_1920_t-run-production-ASP.NET-Applications-with-debug_3D001D20_true_1D20_-enabled.aspx)的说法，

*设置后`<compilation debug=”false”/>`，WebResource.axd 处理程序将自动为通过它检索的资源设置一个长缓存策略 - 以便资源仅下载一次到客户端并永久缓存在那里（它也将缓存在任何中间代理服务器上）。*

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T14:43:16.487

问题是如何最小化对服务器的整体请求......

就个人而言，我认为这不是问题，如果这些 js 文件被加载一次。因为它们应该被客户端缓存。也许你想调查一下，为什么这不会发生。其次，ScriptManager 上有一个标签，它限制了你的 js 文件......也许你想查看 CompositeScript 标签......

另外，我建议查看 LoadScriptsBevoreUI 属性并将其设置为 false。然后您的内容会在 javascripts 之前加载。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-01T12:41:01.017

在 ToolkitScriptManager 中使用 CombineScripts=true

# terminology - 信用卡的 3 位数代码的正式名称是什么？

> ID：807238
> 
> 赞同：13
> 
> 时间：2009-04-30T14:36:54.523
> 
> 标签：terminology, credit-card

我正在处理付款表格。卡背面的3位数代码叫什么？我找不到关于如何称呼它的一致参考。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-04-30T14:38:03.647

根据维基百科，它被称为[卡安全码 (CSC)](http://en.wikipedia.org/wiki/Card_Security_Code)，但也被称为其他东西，例如卡验证值 (CVV) 或卡验证码 (CVC)。

> 第二个代码，也是被引用最多的代码是 CVV2 或 CVC2。商家经常要求此 CSC（也称为 CCID 或信用卡 ID）以确保通过 Internet、邮件、传真或电话进行的“无卡”交易。在西欧的许多国家，由于信用卡欺诈的企图增加，现在必须在持卡人不在时提供此代码。

因为这似乎有多个名字，而且它的名字似乎没有印在卡片上，你可能（不幸的是）仍然需要告诉你的用户如何找到代码 - 即将它描述为“卡背面的 3 位数代码”。

* * *

**2018 年更新**

情况并没有改善，现在更糟了——现在有更多不同的名字。但是，如果您愿意，可以根据卡类型使用不同的术语：

*   “CVC2”或“卡验证码”——万事达卡
*   “CVV2”或“卡验证值2”——Visa
*   “CSC”或“卡安全码”——美国运通

*请注意，某些 American Express 和 Discover 卡在卡的正面*使用 4 位代码。有关更多信息，请参阅上面链接的 Wikipedia 文章。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-30T14:41:32.983

您找不到一致的参考，因为它似乎至少有六个不同的名称！

*   信用卡安全码
*   卡验证值（CVV 或 CV2）
*   卡验证值代码 (CVVC)
*   卡验证码 (CVC)
*   验证码（V-Code 或 V Code）
*   卡代码验证 (CCV)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-30T14:39:35.390

它有好几个名字。您很可能听说过它是卡安全码 (CSC) 或卡验证值 (CVV)。

[信用卡安全码](http://en.wikipedia.org/wiki/Card_Security_Code)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-30T14:40:08.150

来自**维基百科**，

卡安全码位于 MasterCard、Visa 和 Discover 信用卡或借记卡的背面，通常是签名条右侧的一组单独的 3 位数字。在美国运通卡上，卡安全代码是一组印刷（非浮雕）的四位数字，位于正面向右。

卡安全码 (CSC)，有时也称为卡验证值 (CVV 或 CV2)、卡验证值代码 (CVVC)、卡验证码 (CVC)、验证码（V-Code 或 V 码）或卡码验证 ( CCV)[1] 是一种用于信用卡或借记卡交易的安全功能，可增强对信用卡欺诈的保护。

实际上有几种类型的安全代码：

```
* The first code, called CVC1 or CVV1, is encoded on the magnetic stripe of the card and used for transactions in person.
* The second code, and the most cited, is CVV2 or CVC2\. This CSC (also known as a CCID or Credit Card ID) is often asked for by merchants for them to secure "card not present" transactions occurring over the Internet, by mail, fax or over the phone. In many countries in Western Europe, due to increased attempts at card fraud, it is now mandatory to provide this code when the cardholder is not present in person.
* Contactless Card and Chip cards may supply their own codes generated electronically, such as iCVV or Dynamic CVV. 
```

不应将 CVC 与以浮雕或印刷数字显示的标准卡帐号混淆。（标准卡号经过称为 Luhn 算法的单独验证算法，用于确定给定卡号是否合适。）

CVC 不应与 PIN 码相混淆，例如 MasterCard SecureCode 或 Visa Verified by Visa。这些代码不会打印或嵌入卡中，而是在交易时使用键盘输入。

# c - C编译器断言-如何实现？

> ID：807244
> 
> 赞同：47
> 
> 时间：2009-04-30T14:37:54.287
> 
> 标签：c, compiler-construction, assertions

在错误情况下，我想实现一个“断言”来防止编译，而不是在运行时失败。

我目前有一个这样定义的，效果很好，但会增加二进制文件的大小。

```
#define MY_COMPILER_ASSERT(EXPRESSION) switch (0) {case 0: case (EXPRESSION):;} 
```

示例代码（无法编译）。

```
#define DEFINE_A 1
#define DEFINE_B 1
MY_COMPILER_ASSERT(DEFINE_A == DEFINE_B); 
```

我该如何实现它以使其不生成任何代码（以最小化生成的二进制文件的大小）？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-04-30T22:41:46.383

纯标准 C 中的编译时断言是可能的，并且一点点预处理器技巧使它的使用看起来像在运行时使用`assert()`.

关键技巧是找到一个可以在编译时评估并且可能导致某些值错误的构造。一个答案是数组的声明不能有负大小。使用 typedef 可以防止成功时分配空间，并保留失败时的错误。

错误消息本身将隐晦地引用负大小的声明（GCC 说“数组 foo 的大小为负”），因此您应该为数组类型选择一个名称，暗示此错误确实是一个断言检查。

另一个需要处理的问题是，在任何编译单元中只能为`typedef`特定类型名称指定一次。因此，宏必须为每个用法安排一个唯一的类型名称来声明。

我通常的解决方案是要求宏有两个参数。第一个是断言为真的条件，第二个是在幕后声明的类型名称的一部分。plinth 的答案暗示使用标记粘贴和`__LINE__`预定义的宏来形成唯一的名称，可能不需要额外的参数。

不幸的是，如果断言检查在包含文件中，它仍然可能与第二个包含文件中相同行号或主源文件中该行号的检查发生冲突。我们可以通过使用宏来掩盖`__FILE__`它，但它被定义为一个字符串常量，并且没有预处理器技巧可以将字符串常量转换回标识符名称的一部分；更不用说合法的文件名可以包含不是标识符合法部分的字符。

所以，我会提出以下代码片段：

```
/** A compile time assertion check.
 *
 *  Validate at compile time that the predicate is true without
 *  generating code. This can be used at any point in a source file
 *  where typedef is legal.
 *
 *  On success, compilation proceeds normally.
 *
 *  On failure, attempts to typedef an array type of negative size. The
 *  offending line will look like
 *      typedef assertion_failed_file_h_42[-1]
 *  where file is the content of the second parameter which should
 *  typically be related in some obvious way to the containing file
 *  name, 42 is the line number in the file on which the assertion
 *  appears, and -1 is the result of a calculation based on the
 *  predicate failing.
 *
 *  \param predicate The predicate to test. It must evaluate to
 *  something that can be coerced to a normal C boolean.
 *
 *  \param file A sequence of legal identifier characters that should
 *  uniquely identify the source file in which this condition appears.
 */
#define CASSERT(predicate, file) _impl_CASSERT_LINE(predicate,__LINE__,file)

#define _impl_PASTE(a,b) a##b
#define _impl_CASSERT_LINE(predicate, line, file) \
    typedef char _impl_PASTE(assertion_failed_##file##_,line)[2*!!(predicate)-1]; 
```

一个典型的用法可能是这样的：

```
#include "CAssert.h"
...
struct foo { 
    ...  /* 76 bytes of members */
};
CASSERT(sizeof(struct foo) == 76, demo_c); 
```

在 GCC 中，断言失败如下所示：

```
$ gcc -c 演示.c
demo.c:32：错误：数组“assertion_failed_demo_c_32”的大小为负
$

```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-30T15:43:47.403

以下`COMPILER_VERIFY(exp)`宏运行良好。

```
// 合并参数（扩展参数之后）
#define GLUE(a,b) __GLUE(a,b)
#define __GLUE(a,b) a ## b

#define CVERIFY(expr, msg) typedef char GLUE (compiler_verify_, msg) [(expr) ? (+1) : (-1)]

#define COMPILER_VERIFY(exp) CVERIFY (exp, __LINE__)

```

它适用于 C 和 C++，并且可以在任何允许使用 typedef 的地方使用。如果表达式为真，它会为 1 个字符的数组生成一个 typedef（这是无害的）。如果表达式为假，它会为 -1 个字符的数组生成 typedef，这通常会导致错误消息。作为参数给出的表达式可以是计算为编译时常量的任何内容（因此涉及 sizeof() 的表达式可以正常工作）。这使得它比

```
#if (表达式)
＃错误
＃万一

```

您仅限于可以由预处理器评估的表达式。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-04-17T10:44:59.960

正如 Leander 所说，静态断言被添加到 C++11 中，现在它们已经添加了。

`static_assert(exp, message)`

例如

```
#include "myfile.hpp"

static_assert(sizeof(MyClass) == 16, "MyClass is not 16 bytes!")

void doStuff(MyClass object) { } 
```

请参阅上面的[cppreference 页面](http://en.cppreference.com/w/cpp/language/static_assert)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-30T14:47:49.753

如果你的编译器设置了一个预处理器宏，如 DEBUG 或 NDEBUG，你可以做这样的事情（否则你可以在 Makefile 中设置）：

```
#ifdef DEBUG
#define MY_COMPILER_ASSERT(EXPRESSION)   switch (0) {case 0: case (EXPRESSION):;}
#else
#define MY_COMPILER_ASSERT(EXPRESSION)
#endif 
```

然后，您的编译器只断言调试版本。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-30T15:07:26.803

我能在 C 中找到的关于静态断言的最佳文章是在[pixelbeat](http://www.pixelbeat.org/programming/gcc/static_assert.html)上。请注意，静态断言被添加到 C++ 0X 中，并且可能会添加到 C1X 中，但这不会持续一段时间。我不知道我提供的链接中的宏是否会增加二进制文件的大小。我怀疑他们不会，至少如果您以合理的优化水平进行编译，但您的里程可能会有所不同。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-30T14:51:26.640

使用“#error”是一个有效的预处理器定义，它会导致编译在大多数编译器上停止。例如，您可以这样做，以防止在调试中编译：

```
 #ifdef DEBUG
#error Please don't compile now
#endif 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-30T15:09:15.117

我知道您对 C 感兴趣，但请看一下 boost 的 C++ [static_assert](http://www.boost.org/doc/libs/1_38_0/doc/html/boost_staticassert.html)。（顺便说一句，这很可能在 C++1x 中可用。）

我们也为 C++ 做了类似的事情：

```
#define COMPILER_ASSERT(expr) enum { ARG_JOIN(CompilerAssertAtLine, __LINE__) = sizeof( char[(expr) ? +1 : -1] ) }

```

显然，这只适用于 C++。 [本文](http://www.pixelbeat.org/programming/gcc/static_assert.html)讨论了一种修改它以在 C 中使用的方法。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-30T14:43:28.780

当您编译最终的二进制文件时，将 MY_COMPILER_ASSERT 定义为空白，以便其输出不包含在结果中。仅按照您的调试方式定义它。

但实际上，您无法以这种方式捕捉每一个断言。有些只是在编译时没有意义（比如断言一个值不为空）。您所能做的就是验证其他#defines 的值。我不确定你为什么要这样做。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-04-24T16:50:11.390

我发现这为 GCC 提供了最不容易混淆的错误消息。其他所有东西都有一些关于负尺寸或其他令人困惑的东西的后缀：

```
#define STATIC_ASSERT(expr, msg)   \
typedef char ______Assertion_Failed_____##msg[1];  __unused \
typedef char ______Assertion_Failed_____##msg[(expr)?1:2] __unused 
```

示例用法：

```
 unsigned char testvar;
 STATIC_ASSERT(sizeof(testvar) >= 8, testvar_is_too_small); 
```

以及 gcc (ARM/GNU C Compiler : 6.3.1) 中的错误消息：

```
conflicting types for '______Assertion_Failed_____testvar_is_too_small' 
```

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-04-30T15:08:25.820

好吧，您可以使用[`static asserts`boost library 中的](http://www.boost.org/doc/libs/1_38_0/doc/html/boost_staticassert.html)。

我相信他们在那里做的是定义一个数组。

```
 #define MY_COMPILER_ASSERT(EXPRESSION) char x[(EXPRESSION)]; 
```

如果 EXPRESSION 为真，它定义`char x[1];`，这是可以的。如果为假，则定义`char x[0];`哪个是非法的。

# c++ - 用于大型 c++ 项目的好、简单的配置库？

> ID：807245
> 
> 赞同：6
> 
> 时间：2009-04-30T14:37:57.513
> 
> 标签：c++, user-interface, configuration

我们正在用 C++ 开发一个相当大的项目，其中许多组件需要配置参数。我们希望使用一个中心位置来配置所有内容（如注册表），最好使用一个漂亮而简单的 GUI（如 Firefox 的`about:config`）和一个简单的 API。

我很确定许多应用程序都存在此类问题，但找不到任何可以轻松用于此问题的可用库。有谁知道一个好的（最好是免费的）库可以用来做这个？

这应该在 Windows 和 Linux 中跨平台工作。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-30T17:55:03.750

[boost::program_options为命令行、环境变量和](http://www.boost.org/doc/libs/1_38_0/doc/html/program_options.html)[配置文件](http://www.boost.org/doc/libs/1_38_0/doc/html/program_options/overview.html#id3763008)的配置提供统一（和跨平台）支持。似乎它应该扩展到注册对各种参数（例如[选项组](http://www.boost.org/doc/libs/1_38_0/doc/html/program_options/howto.html#id3763728)）感兴趣的大型软件系统的多个位。尽管对 GUI 或持久性方面的帮助不大（但是用文本编辑器编辑配置文件有什么问题？）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-02-03T04:40:18.087

我以前使用过 libconfig，工作起来很简单，而且 LGPL。 [http://www.hyperrealm.com/libconfig/](http://www.hyperrealm.com/libconfig/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T14:56:11.853

我使用了来自[TechRepublic/DDJ的](http://www.ddj.com/cpp/202101554)[John Torjo](http://torjo.com/)代码的修改版本（[来源](http://software.techrepublic.com.com/abstract.aspx?docid=80071)）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T16:02:08.780

多[平台](http://www.cs.wustl.edu/~schmidt/ACE-versions-i.html) [ACE](http://www.cs.wustl.edu/~schmidt/ACE.html)库有一个[配置](http://www.dre.vanderbilt.edu/Doxygen/Stable/ace/classACE__Configuration.html)类，它使用具有*Windows .ini*格式的配置文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T17:24:17.660

我经常在[pugxml](http://code.google.com/p/pugixml/ "哈巴狗")周围使用一个简单的包装器。我发现为枚举类型创建一个带有参数验证的配置类等可以使其余代码更加简洁。如果您只是在处理键/值对，则必须在整个代码中验证数据。通过为每个应用程序编写自定义类，您可以将所有内容放在一个地方。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-11-26T15:55:14.333

尝试配置器。没有 GUI，但它是易于使用且灵活的 C++ 库，用于配置文件解析（从最简单的 INI 到具有任意嵌套和语义检查的复杂文件）。仅标题和跨平台。使用 Boost C++ 库。

见： http: [//opensource.dshevchenko.biz/configurator](http://opensource.dshevchenko.biz/configurator)

# .net - 在.net中，如果一个函数返回一个对象，那么只使用函数_as_一个对象是错误的吗？

> ID：807258
> 
> 赞同：1
> 
> 时间：2009-04-30T14:40:33.687
> 
> 标签：.net, vb.net, oop

我有 af(x) 返回用户控件的集合。.Net 让我将 f(x) 名称视为集合。这样做有什么问题吗？

前任）

```
Private Function GetCcB() As Collection(Of Reports_ucColumn)
    Dim cc As New Collection(Of Reports_ucColumn)
    cc.Add(Me.ucColumn0)
    cc.Add(Me.ucColumn1)
    cc.Add(Me.ucColumn2)
    Return cc
End Function 
```

然后稍后，都使用集合中对象的属性，如下所示：

```
 For i As Integer = 0 To csB.Count - 1
        If csB(i).Contains("Invalid") Or csB(i).Contains("Duplicate") Then
            GetCcB.Item(i).isValid = False
            GetCcB.Item(i).title = csB(i)
            If csB(i).Contains("Invalid") Then : GetCcB.Item(i).errCode = "005W"
            Else : GetCcB.Item(i).errCode = "005W" 'todo - chg this once we get a duplicate col err code
            End If
        Else
            GetCcB.Item(i).isValid = True
            GetCcB.Item(i).title = csB(i)
            GetCcB.Item(i).errCode = String.Empty
        End If 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T14:42:38.703

好吧，每次调用 GetCcB 时都会在内存中创建新集合，因此我建议您改用变量。=)

编辑：本质上，GetCcB 返回的对象（集合）是不同的（虽然不是内容），每次调用它并占用堆上的额外内存，垃圾收集器在通过时必须收集这些内存。最好将集合作为变量获取并使用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T14:55:05.820

您想改用[单例](http://www.codeguru.com/columns/vb/article.php/c6563)。它是一个静态类，其属性返回该类的私有字段。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T15:46:39.347

通过在每次使用集合时调用该方法，您的代码实际上在做的是：

```
For i As Integer = 0 To csB.Count - 1
   Dim cc As Collection(Of Reports_ucColumn)
   If csB(i).Contains("Invalid") Or csB(i).Contains("Duplicate") Then
      cc = New Collection(Of Reports_ucColumn)
      cc.Add(Me.ucColumn0)
      cc.Add(Me.ucColumn1)
      cc.Add(Me.ucColumn2)
      cc.Item(i).isValid = False
      cc = New Collection(Of Reports_ucColumn)
      cc.Add(Me.ucColumn0)
      cc.Add(Me.ucColumn1)
      cc.Add(Me.ucColumn2)
      cc.Item(i).title = csB(i)
      If csB(i).Contains("Invalid") Then
         cc = New Collection(Of Reports_ucColumn)
         cc.Add(Me.ucColumn0)
         cc.Add(Me.ucColumn1)
         cc.Add(Me.ucColumn2)
         cc.Item(i).errCode = "005W"
      Else
         cc = New Collection(Of Reports_ucColumn)
         cc.Add(Me.ucColumn0)
         cc.Add(Me.ucColumn1)
         cc.Add(Me.ucColumn2)
         cc.Item(i).errCode = "005W" 'todo - chg this once we get a duplicate col err code
      End If
   Else
      cc = New Collection(Of Reports_ucColumn)
      cc.Add(Me.ucColumn0)
      cc.Add(Me.ucColumn1)
      cc.Add(Me.ucColumn2)
      cc.Item(i).isValid = True
      cc = New Collection(Of Reports_ucColumn)
      cc.Add(Me.ucColumn0)
      cc.Add(Me.ucColumn1)
      cc.Add(Me.ucColumn2)
      cc.Item(i).title = csB(i)
      cc = New Collection(Of Reports_ucColumn)
      cc.Add(Me.ucColumn0)
      cc.Add(Me.ucColumn1)
      cc.Add(Me.ucColumn2)
      cc.Item(i).errCode = String.Empty
   End If
Next 
```

你永远不会写那样的代码，对吗？

您可以将函数转换为具有延迟初始化的属性。然后可以一遍又一遍地使用它，因为集合只创建一次：

```
Private _cc As Collection(Of Reports_ucColumn)

Private Property CcB As Collection(Of Reports_ucColumn)
   Get
      If _cc Is Nothing Then
         _cc = New Collection(Of Reports_ucColumn)
         _cc.Add(Me.ucColumn0)
         _cc.Add(Me.ucColumn1)
         _cc.Add(Me.ucColumn2)
      End If
      Return _cc
   End Get
End Property 
```

（理想情况下，属性应该在类中是公共的，而`_cc`变量应该是私有的，封装在类中，以便只有属性可以访问它。）

从语义上讲，这也很好用。一个函数通常会做一些工作，所以如果你想一遍又一遍地使用结果，你不应该一遍又一遍地调用它。另一方面，属性通常不会做太多工作，如果结果需要创建一些处理，该属性通常会执行延迟初始化或预初始化等操作，以确保工作不会超出必要的范围.

# 64-bit - 如何检测安装了哪种 JRE——32 位与 64 位

> ID：807263
> 
> 赞同：51
> 
> 时间：2009-04-30T14:41:02.030
> 
> 标签：64-bit, 32-bit, nsis, java

在使用 NSIS 安装程序进行安装期间，我需要检查系统上安装了哪个 JRE（32 位与 64 位）。我已经知道我可以检查系统属性“ `sun.arch.data.model`”，但这是特定于 Sun 的。我想知道是否有一个标准的解决方案。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-04-30T18:12:17.937

可以使用“ [os.arch](http://java.sun.com/javase/6/docs/api/java/lang/System.html#getProperties()) ”属性检索正在使用的 JVM 架构：

```
System.getProperty("os.arch"); 
```

“os”部分似乎有点用词不当，或者最初的设计者可能没想到 JVM 会在他们不是为之编写的架构上运行。返回值似乎[不一致](http://javablog.co.uk/2007/05/19/making-jni-cross-platform/)。

NetBeans 安装程序团队正在[解决](http://wiki.netbeans.org/NBINotes)JVM 与 OS 体系结构的问题。引用：

> **x64 位：Java 和系统**
> 
> 跟踪为[问题 143434](http://www.netbeans.org/issues/show_bug.cgi?id=143434)。
> 
> 目前我们使用 JVM 的 x64 位来确定系统（以及 Platform.getHardwareArch()）是否为 64 位。这绝对是错误的，因为可以在 64 位系统上运行 32 位 JVM。如果在 32 位 JVM 上运行，我们应该找到一个解决方案来检查操作系统的真实 64 位。
> 
> *   对于 Windows，可以使用 WindowsRegistry.IsWow64Process()
> *   对于 Linux - 通过检查 'uname -m/-p' == x86_64
> *   对于 Solaris，可以使用例如“isainfo -b”来完成
> *   对于 Mac OSX，它不能使用 uname 参数来完成，可能可以通过创建 64 位二进制文​​件并在平台上执行来解决......（不幸的是，这不起作用:(我只用 x86_64 创建了二进制文件和 ppc64 arch 并在 Tiger 上成功执行..)
> *   对于通用 Unix 支持 - 也不清楚......可能会检查相同的 'uname -m/-p' / 'getconf LONG_BIT' 并将其与一些可能的 64 位值（x86_64、x64、amd64、ia64 ）。

* * *

来自不同 JVM 的示例属性都在 64 位 Ubuntu 8.0.4 上运行：

32 位 IBM 1.5：

```
java.vendor=IBM Corporation
java.vendor.url=http://www.ibm.com/
java.version=1.5.0
java.vm.info=J2RE 1.5.0 IBM J9 2.3 Linux x86-32 j9vmxi3223-20061001 (JIT enabled)
J9VM - 20060915_08260_lHdSMR
JIT  - 20060908_1811_r8
GC   - 20060906_AA
java.vm.name=IBM J9 VM
java.vm.specification.name=Java Virtual Machine Specification
java.vm.specification.vendor=Sun Microsystems Inc.
java.vm.specification.version=1.0
java.vm.vendor=IBM Corporation
java.vm.version=2.3
os.arch=x86
os.name=Linux
os.version=2.6.24-23-generic
sun.arch.data.model=32 
```

64 位太阳 1.6：

```
java.vendor=Sun Microsystems Inc.
java.vendor.url=http://java.sun.com/
java.vendor.url.bug=http://java.sun.com/cgi-bin/bugreport.cgi
java.version=1.6.0_05
java.vm.info=mixed mode
java.vm.name=Java HotSpot(TM) 64-Bit Server VM
java.vm.specification.name=Java Virtual Machine Specification
java.vm.specification.vendor=Sun Microsystems Inc.
java.vm.specification.version=1.0
java.vm.vendor=Sun Microsystems Inc.
java.vm.version=10.0-b19
os.arch=amd64
os.name=Linux
os.version=2.6.24-23-generic
sun.arch.data.model=64 
```

64 位 GNU 1.5：

```
java.vendor=Free Software Foundation, Inc.
java.vendor.url=http://gcc.gnu.org/java/
java.version=1.5.0
java.vm.info=GNU libgcj 4.2.4 (Ubuntu 4.2.4-1ubuntu3)
java.vm.name=GNU libgcj
java.vm.specification.name=Java(tm) Virtual Machine Specification
java.vm.specification.vendor=Sun Microsystems Inc.
java.vm.specification.version=1.0
java.vm.vendor=Free Software Foundation, Inc.
java.vm.version=4.2.4 (Ubuntu 4.2.4-1ubuntu3)
os.arch=x86_64
os.name=Linux
os.version=2.6.24-23-generic 
```

（GNU 版本不报告“sun.arch.data.model”属性；可能其他 JVM 也不报告。）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-11-09T19:53:25.897

我正在使用 NSIS 和 Launch4j 来包装 Java 桌面应用程序。因此，我不仅需要检测任何 JRE，还需要使用 Launch4j 的搜索算法找到的那个。唯一有意义的方法是在 NSIS 安装程序中运行一个简短的 Java 程序。这是Java：

```
    公共类检测JVM {
        私有静态最终字符串键 [] = {
            "sun.arch.data.model",
            "com.ibm.vm.bitmode",
            "os.arch",
        };
        公共静态无效主要（字符串[]参数）{
            布尔打印 = args.length > 0 && "-print".equals(args[0]);
            对于（字符串键：键）{
                字符串属性 = System.getProperty(key);
                if (print) System.out.println(key + "=" + property);
                如果（属性！= null）{
                    int errCode = (property.indexOf("64") >= 0) ？64：32；
                    if (print) System.out.println("err code=" + errCode);
                    System.exit(errCode);
                }
            }
        }
    }

```

用 Launch4J 包装它。使用 GUI 标头类型但也设置为 true。否则错误代码将丢失。（我将所有这些都放在了我的 Netbeans Ant 构建脚本中。

这是使用它的匹配 NSIS 代码：

```
文件 ... ; 解压文件，包括detectjvm.exe。
清除错误
ExecWait '"$INSTDIR\detectjvm.exe"' $0
IfErrors DetectExecError
IntCmp $0 0 DetectError DetectError DoneDetect
检测执行错误：
    StrCpy $0“执行错误”
检测错误：
    MessageBox MB_OK “无法确定 JVM 架构 ($0)。假设为 32 位。”
    转到 NotX64
完成检测：
IntCmp $0 64 X64 NotX64 NotX64
X64：
    文件 ... 64 位 AMD DLL。
    转到完成X64
非X64：
    文件 ... 32 位 x86 DLL。
完成X64：
删除 $INSTDIR\detectjvm.exe

```

这在从没有 SP 的 WinXP 到 Vista 和具有所有 SP、32 位和 64 位的 Win7 的各种机器上运行良好。

请注意，在我的 NSIS 脚本中，我使用了一个现有的包来检查 JVM 是否已安装并首先执行此操作，因此只有在 JVM 安装出现严重问题时才会出现默认的 32 位选择，在这种情况下无论如何，您复制的 DLL 集都无关紧要。

希望这对某人有帮助。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-01-15T03:41:45.117

编写Java代码时，如何区分32位和64位操作？

[http://www.oracle.com/technetwork/java/hotspotfaq-138619.html#64bit_detection](http://www.oracle.com/technetwork/java/hotspotfaq-138619.html#64bit_detection)

> 没有允许您区分 32 位和 64 位操作的公共 API。将 64 位视为一次编写，随处运行传统的另一个平台。但是，如果您想编写特定于平台的代码（为您感到羞耻），系统属性 sun.arch.data.model 的值为“32”、“64”或“unknown”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-12T22:19:31.783

```
import sun.misc.*;

import java.lang.reflect.*;

public class UnsafeTest {
  public static void main(String[] args) throws NoSuchFieldException, IllegalAccessException {
    Field unsafeField = Unsafe.class.getDeclaredField("theUnsafe");
    unsafeField.setAccessible(true);
    Unsafe unsafe = (Unsafe) unsafeField.get(null);
    System.out.println(unsafe.addressSize());
  }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-05-24T14:06:23.817

```
java -version 
```

对于 64 位 java 版本，它将打印：

```
java version "1.8.0_92"
Java(TM) SE Runtime Environment (build 1.8.0_92-b14)
Java HotSpot(TM) ***64-Bit*** Server VM (build 25.92-b14, mixed mode) 
```

对于 32 位，它只是

```
java version "1.8.0_92"
Java(TM) SE Runtime Environment (build 1.8.0_92-b14)
Java HotSpot(TM) Client VM (build 25.92-b14, mixed mode) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T22:03:30.690

系统上可能同时提供 32 位和 64 位 JVM，而且数量很多。

如果您已经为每个受支持的平台提供了 dll - 请考虑制作一个链接并运行的小型可执行文件，以便您可以测试平台是否支持给定的功能。如果可执行链接并运行，则可以安装相应的共享库。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T15:02:12.933

On linux, my (java) vm reports java.vm.name=Java HotSpot(TM) 64-Bit Server VM. The javadocs for System declare that System.getProperty will always have a value for this but are silent on sun.arch.data.model.

Unfortunately they don't specify what the system property will be so some other JVM might just report java.vm.name=Edgar.

BTW, by "installed on the system", I assume you mean "the current running JVM"?

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2016-02-15T20:16:01.313

如果您有要检查的 .exe 的路径，则可以使用[此答案](https://stackoverflow.com/a/35418180/875305)。基本上它只是查看 .exe 文件中的标头并告诉您它在 Windows 上是 64 位还是 32 位。

* * *

## 回答 #9

> 赞同：-6
> 
> 时间：2009-06-04T12:54:14.857

以下代码检查任何 Windows 可执行文件中的 machineType 字段以确定它是 32 位还是 64 位：

```
public class ExeDetect
{
  public static void main(String[] args) throws Exception {
    File x64 = new File("C:/Program Files/Java/jre1.6.0_04/bin/java.exe");
    File x86 = new File("C:/Program Files (x86)/Java/jre1.6.0/bin/java.exe");
    System.out.println(is64Bit(x64));
    System.out.println(is64Bit(x86));
  }

  public static boolean is64Bit(File exe) throws IOException {
    InputStream is = new FileInputStream(exe);
    int magic = is.read() | is.read() << 8;
    if(magic != 0x5A4D) 
        throw new IOException("Invalid Exe");
    for(int i = 0; i < 58; i++) is.read(); // skip until pe offset
    int address = is.read() | is.read() << 8 | 
         is.read() << 16 | is.read() << 24;
    for(int i = 0; i < address - 60; i++) is.read(); // skip until pe header+4
    int machineType = is.read() | is.read() << 8;
    return machineType == 0x8664;
  }
} 
```

请注意，为简洁起见，代码已被压缩...

# vbscript - 将注册表中的数据插入预定义的书签

> ID：807266
> 
> 赞同：0
> 
> 时间：2009-04-30T14:41:22.437
> 
> 标签：vbscript, ms-word

我在当前用户下的注册表中有数据，我想将这些数据添加到 Word 文档中的预定义书签中。现在，问题是，我希望在每个 Word 文档中都使用完全相同的宏，如果找不到预定义的书签，则让宏跳过该步骤。

我已经有了这段代码，我需要在其中预定义注册表中的总数据数组。该宏将注册表中每个子项的值存储到一个字符串中。但除非书签存在，否则不会将值插入书签。好吧，无论如何，这就是这个想法。

```
Public Sub TemplateData()

    Dim objShell
    Dim strShell
    Dim strDataArea
    Dim Values() As String
    Dim Fields

    ' Input the exact same key as in registry
    Fields = Array("DEPARTMENT", "LETTER", "LNAME", "FNAME")

    Set objShell = CreateObject("Wscript.Shell")

    strDataArea = "HKCU\Templates\"
    On Error Resume Next

    For iTeller = 0 To UBound(Fields)

        Dim sBookMarkName, sValue
        sBookMarkName = "Bookmark" & Fields(iTeller)
        sValue = objShell.RegRead(strDataArea & Fields(iTeller))

        Selection.GoTo What:=wdGoToBookmark, Name:=sBookMarkName
        Selection.Delete Unit:=wdCharacter, Count:=0
        Selection.InsertAfter sValue       

    Next
    On Error GoTo 0

End Sub 
```

如果我在 Next 底部设置一个断点，我可以看到它确实找到了书签，但是它以某种方式插入了每个注册表子项的值，直到找到正确的那个。如果我再次运行宏，最初的想法也是让宏删除 bookmkarks 中的任何单词，因为如果注册表中的数据得到更新，宏应该选择它并将其插入到文档中。

任何人都可以在这里找到可能有问题的地方吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-09-10T10:04:03.507

[Word VBA 宏中的错误，尝试将值插入书签](https://stackoverflow.com/questions/943402/vba-word-error-in-macro-trying-to-insert-values-into-bookmarks) 有答案。肯尼自学（重新设置书签）：

```
 ActiveDocument.Bookmarks.Add Range:=Selection.Range, Name:=sBookMarkName 
```

汤姆在使用前帮助检查...

```
If ActiveDocument.Bookmarks.Exists(sBookmarkName) Then
    ... insert using your code
End If 
```

# jquery - jQuery 滑块 UI - 增强功能

> ID：807268
> 
> 赞同：5
> 
> 时间：2009-04-30T14:41:49.033
> 
> 标签：jquery, jquery-ui, slider

我正在尝试 jQuery Slider 并使用一个示例来玩。

**编辑：** 我想让滑块显示值，如标尺，以增加可用性。就像现在一样，我发现很难通过可用性测试。人们抱怨说他们想在开始下滑之前知道他们选择了什么值。

有什么想法可以实现吗？据我搜索，我找不到这个功能是否已经存在或如何做到这一点。

```
<html>
<head>
<link type="text/css" href="http://jqueryui.com/latest/themes/base/ui.all.css" rel="stylesheet" />
<script type="text/javascript" src="http://jqueryui.com/latest/jquery-1.3.2.js"></script>
<script type="text/javascript" src="http://jqueryui.com/latest/ui/ui.core.js"></script>
<script type="text/javascript" src="http://jqueryui.com/latest/ui/ui.slider.js"></script>
<style type="text/css">
    #slider { margin: 10px; }
</style>
<script type="text/javascript">
    $(function() {
        $("#slider").slider({           
            value: 50,
            min: 0,
            max: 99,
            step: 1,
            slide: function(event, ui) {
                $("#amount").val('$' + ui.value);
            }
        });
        $("#amount").val('$' + $("#slider").slider("value"));
    });
</script>
</head>
<body style="font-size:62.5%;">
<div id="slider"></div>
<input type="text" id="amount" style="border:0; color:#f6931f; font-weight:bold;" />
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-01T04:53:07.723

我找到了一个显示哈希标记的自定义 JQuery UI 滑块的示例。

[来自选择元素的 jQuery UI 滑块](http://www.filamentgroup.com/lab/update_jquery_ui_slider_from_a_select_element_now_with_aria_support//)

这应该给你一个很好的起点。如果您需要帮助，请告诉我。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-03T20:51:04.593

这应该会有所帮助，他会在句柄旁边显示值。挺整洁的！：

[http://www.keepthewebweird.com/creating-a-nice-slider-with-jquery-ui/](http://www.keepthewebweird.com/creating-a-nice-slider-with-jquery-ui/)

看教程！！由于某种原因，演示有点偏离。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-01T16:32:33.767

我一直像这样使输入与滑块保持同步

```
<div id='support_slider' class='slider' alt='" + pct + "'></div>
<input id='support_input' class='input' alt='" + pct + "' value='" + pct + "' size='1'/>

$("#support_slider").slider({
    //animate: true,
    min: 0,
    max: 10,
    value: pct,
    slide: function(event, ui) {
            set_sliders_and_input($(this), $(this).next(), $(this).next().attr("value"), ui.value);
    }
});

$("#support_input").keyup(function(event) {
    set_sliders_and_input($(this).prev(), $(this), $(this).attr("alt"), $(this).attr("value"));
});

function set_sliders_and_input(slider, input, oldv, newv) {
    if ( newv < 0 || newv > 100 ) return false;
    var diff = oldv - newv;
    input.attr("value", newv).attr("alt", newv);
    slider.slider('option', 'value', newv);
    GM_setValue('support_pct', newv);
    return true;
} 
```

# jquery - 如何在页面加载时启动 jQuery Fancybox？

> ID：807271
> 
> 赞同：96
> 
> 时间：2009-04-30T14:42:00.283
> 
> 标签：jquery, jquery-plugins, fancybox

我想在页面加载时启动一个 Fancybox（例如[Fancybox 的](http://fancy.klade.lv/)模式或灯箱版本）。我可以将它绑定到隐藏的锚标记并通过 JavaScript 触发该锚标记的单击事件，但我宁愿直接启动 Fancybox 并避免额外的锚标记。

* * *

## 回答 #1

> 赞同：165
> 
> 时间：2009-05-04T17:37:30.933

Fancybox 目前不直接支持自动启动的方式。我能够开始工作的工作是创建一个隐藏的锚标记并触发它的点击事件。确保在包含 jQuery 和 Fancybox JS 文件之后包含触发点击事件的调用。我使用的代码如下：

此示例脚本直接嵌入在 HTML 中，但也可以包含在 JS 文件中。

```
<script type="text/javascript">
    $(document).ready(function() {
        $("#hidden_link").fancybox().trigger('click');
    });
</script> 
```

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2010-09-06T03:14:46.303

我通过在准备好的文档中调用此函数来使其工作：

```
$(document).ready(function () {
        $.fancybox({
            'width': '40%',
            'height': '40%',
            'autoScale': true,
            'transitionIn': 'fade',
            'transitionOut': 'fade',
            'type': 'iframe',
            'href': 'http://www.example.com'
        });
}); 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2014-03-29T07:18:30.350

这很简单：

像这样首先隐藏你的元素：

```
<div id="hidden" style="display:none;">
    Hi this is hidden
</div> 
```

然后调用你的javascript：

```
<script type="text/javascript">
    $(document).ready(function() {
        $.fancybox("#hidden");
    });
</script> 
```

看看下面的图片：

![在此处输入图像描述](https://i.stack.imgur.com/OnZ3T.png)

另一个例子：

```
<div id="example2" style="display:none;">
        <img src="http://theinstitute.ieee.org/img/07tiProductsandServicesiStockphoto-1311258460873.jpg" />
    </div>

 <script type="text/javascript">
        $(document).ready(function() {
            $.fancybox("#example2");
        });
    </script> 
```

![在此处输入图像描述](https://i.stack.imgur.com/y6Job.png)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2012-08-22T19:48:57.193

Window.load（相对于 document.ready()）似乎是[Fancybox 2.0 的 JSFiddler onload 演示中](http://jsfiddle.net/STgGM/)使用的技巧：

```
$(window).load(function()
{
    $.fancybox("test");
}); 
```

请记住，您可能正在其他地方使用 document.ready()，而 IE9 对两者的加载顺序感到不安。这给您留下了两个选择：将所有内容更改为 window.load 或使用 setTimer()。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-05-27T21:03:28.473

或者在你的 fancybox 设置之后在 JS 文件中使用它：

```
$('#link_id').trigger('click'); 
```

我相信 Fancybox 1.2.1 会在我需要这样做时使用默认选项，否则我的测试会使用默认选项。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-02-28T14:59:45.707

为什么这还不是答案之一？：

```
$("#manual2").click(function() {
    $.fancybox([
        'http://farm5.static.flickr.com/4044/4286199901_33844563eb.jpg',
        'http://farm3.static.flickr.com/2687/4220681515_cc4f42d6b9.jpg',
        {
            'href'  : 'http://farm5.static.flickr.com/4005/4213562882_851e92f326.jpg',
            'title' : 'Lorem ipsum dolor sit amet, consectetur adipiscing elit'
        }
    ], {
        'padding'           : 0,
        'transitionIn'      : 'none',
        'transitionOut'     : 'none',
        'type'              : 'image',
        'changeFade'        : 0
    });
}); 
```

现在只需触发您的链接！

从[Fancybox 主页得到这个](http://fancybox.net/home)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-03-30T12:55:14.970

我发现的最好方法是：

```
<script type="text/javascript">
    $(document).ready(function() {
        $.fancybox(
             $("#WRAPPER_FOR_hidden_div_with_content_to_show").html(), //fancybox works perfect with hidden divs
             {
                  //fancybox options
             }
        );
    });
</script> 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-09-16T16:17:44.503

就我而言，以下可以成功运行。页面加载完毕后，立即弹出灯箱。

jQuery：1.4.2

花式盒：1.3.1

```
<body onload="$('#aLink').trigger('click');">
<a id="aLink" href="http://www.google.com" >Link</a></body> 
```

* * *

```
<script type="text/javascript">
    $(document).ready(function() {

        $("#aLink").fancybox({
            'width'             : '75%',
            'height'            : '75%',
            'autoScale'         : false,
            'transitionIn'      : 'none',
            'transitionOut'     : 'none',
            'type'              : 'iframe'
        });
    });
</script> 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2010-11-11T20:16:32.023

亚历克斯的回答很棒。但需要注意的是，这调用了默认的 fancybox 样式。如果你有自己的自定义规则，你应该调用 .trigger 点击那个特定的锚点

```
$(document).ready(function() {
$("#hidden_link").fancybox({ 
    'padding':          0,
    'cyclic':       true,
    'width':        625,
    'height':       350,
    'padding':      0, 
    'margin':      0, 
    'speedIn':      300,
    'speedOut':     300,
    'transitionIn': 'elastic',
    'transitionOut': 'elastic',
    'easingIn':     'swing',
    'easingOut':    'swing',
    'titleShow' : false
}); 
    $("#hidden_link").trigger('click');
}); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-10-14T10:12:26.267

实际上，我设法使用“live”事件仅从外部 JS 文件触发了 fancyBox 链接：

首先，在您未来的动态锚点上添加实时点击事件：

```
$('a.pub').live('click', function() {
  $(this).fancybox(... fancybox parameters ...);
}) 
```

然后，将锚附加到正文：

```
$('body').append('<a class="iframe pub" href="your-url.html"></a>'); 
```

然后通过“点击”锚点触发fancyBox：

```
$('a.pub').click(); 
```

fancyBox 链接现在“几乎”准备好了。为什么是“几乎”？因为看起来你需要在触发第二次点击之前添加一些延迟，否则脚本还没有准备好。

在我们的锚点上使用一些动画是一个快速而肮脏的延迟，但效果很好：

```
$('a.pub').slideDown('fast', function() {
  $('a.pub').click();
}); 
```

给你，你的fancyBox 应该出现在onload 上！

高温高压

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-11-28T18:51:15.307

也许这会有所帮助...这用于全尺寸的 jQuery 日历单击事件（[http://arshaw.com/fullcalendar/](http://arshaw.com/fullcalendar/)）...但它可以更普遍地用于处理 jQuery 启动的fancybox。

```
 eventClick: function(calEvent, jsEvent, view) {
      jQuery("body").after('<a id="link_'+calEvent.url+'" style="display: hidden;" href="http://thisweekinblackness.com/wp-content/uploads/2009/01/steve-urkel.jpg">Steve</a>');
      jQuery('#link_'+calEvent.url).fancybox(); 
      jQuery('#link_'+calEvent.url).click();
      jQuery('#link_'+calEvent.url).remove();
    return false;
  } 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-08-09T15:56:34.157

您还可以使用原生 JavaScript 函数[`setTimeout()`](https://developer.mozilla.org/en/DOM/window.setTimeout)在 DOM 准备好后延迟框的显示。

```
<a id="reference-first" href="#reference-first-message">Test the Popup</a>

<div style="display: none;">
    <div id="reference-first-message" style="width:400px;height:100px;overflow:auto;">
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam quis mi eu elit tempor facilisis id et neque. Nulla sit amet sem sapien. Vestibulum imperdiet porta ante ac ornare. Nulla et lorem eu nibh adipiscing ultricies nec at lacus. Cras laoreet ultricies sem, at blandit mi eleifend aliquam. Nunc enim ipsum, vehicula non pretium varius, cursus ac tortor. Vivamus fringilla congue laoreet. Quisque ultrices sodales orci, quis rhoncus justo auctor in. Phasellus dui eros, bibendum eu feugiat ornare, faucibus eu mi. Nunc aliquet tempus sem, id aliquam diam varius ac. Maecenas nisl nunc, molestie vitae eleifend vel, iaculis sed magna. Aenean tempus lacus vitae orci posuere porttitor eget non felis. Donec lectus elit, aliquam nec eleifend sit amet, vestibulum sed nunc.
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function() {
        $("#reference-first").fancybox({
            'titlePosition'         : 'inside',
            'transitionIn'          : 'fade',
            'transitionOut'         : 'fade',
            'overlayColor'          : '#333',
            'overlayOpacity'        : 0.9
        }).trigger("click");

        //launch on load after 5 second delay
        window.setTimeout('$("#reference-first")', 5000);
    });
</script> 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-03-30T04:47:36.210

如果你没有按钮可以点击。我的意思是，如果您想在 ajax 响应上打开它，那么它会是这样的：

```
$.fancybox({
      href: '#ID',
      padding   : 23,
      maxWidth  : 690,
      maxHeight : 345
}); 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-10-07T05:45:37.160

```
$(document).ready(function() {
    $.fancybox(
      '<p>Yes. It works <p>',
       {
        'autoDimensions'    : false,
        'width'             : 400,
        'height'            : 200,
        'transitionIn'      : 'none',
        'transitionOut'     : 'none'
       }
    );
}); 
```

这会有所帮助..

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-03-12T09:52:06.207

您可以这样放置链接（它将被隐藏。可能在之前`</body>`）

```
<a id="clickbanner" href="image.jpg" rel="gallery"></a> 
```

像这样工作的 rel 属性或类

```
$(document).ready(function() {
    $("a[rel=gallery]").fancybox({
        openEffect  : 'elastic',
        closeEffect : 'elastic',
        maxWidth    : 800,
        maxHeight   : 600
    });
}); 
```

只需使用jquery触发功能即可

```
$( window ).load(function() {
  $("#clickbanner").trigger('click');
}); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-08-02T00:54:58.207

HTML：

```
<a id="hidden_link" href="LinkToImage"></a> 
```

JS：

```
<script type="text/javascript">
    $(document).ready(function() {
        $("#hidden_link").fancybox().trigger('click');
    });
</script> 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-04-28T04:34:25.807

使用 Fancybox 3.5.7 版，我无需任何额外的 Javascript 即可自动启动它。只需添加对您的 Fancybox“组”的引用作为 URL 中的锚链接。

例如，如果这是您的标记：

```
<a href="foo.jpg" data-fancybox="gallery">Click me</a> 
```

只需使用以下链接：

```
https://example.org/slideshow.php#gallery-1 
```

这会在页面加载时自动为我打开幻灯片！

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2009-04-30T14:52:26.387

也许你可以使用[jqmodal](http://dev.iceburg.net/jquery/jqModal/)，它轻量级且易于使用。您可以通过调用显示模态框

```
$('.box').jqmShow() 
```

# .net - 立即找到 Windows.Forms 组件的可见区域的方法？

> ID：807282
> 
> 赞同：1
> 
> 时间：2009-04-30T14:43:43.850
> 
> 标签：.net, winforms, gdi

当我尝试将一些逻辑应用到表单上的定位元素时，我讨厌它，只是因为一些奇怪的问题，比如控件的可见区域受到边框的影响，所以地毯从我下面猛拉出来，实际上，创建在面板的内部可见区域周围有一个 3 像素的边距，完全放弃了我可能想要进行的任何大小计算，并且还偏移了控件的 0,0 点。

更糟糕的是表单控件本身，在大多数情况下，它在标题栏所在的位置有一个巨大的顶部边缘，但不会*（*我记得）偏移 0,0 点，这意味着您放置在该点的控件通常可以甚至看不见。当然，当应用不同的 Windows 主题时，边距是不同的......

知识渊博的人能否让我了解一些更“有趣”的谎言 Windows.Forms 会告诉您有关表单区域和位置以及您是如何应对的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T14:48:16.647

看`Form.ClientRectangle`和`Form.ClientSize`

# ruby-on-rails - 使用 Desert 将测试过程与 Rspec 和 Cucumber 集成到插件中

> ID：807292
> 
> 赞同：0
> 
> 时间：2009-04-30T14:46:52.720
> 
> 标签：ruby-on-rails, plugins, rspec, cucumber

我正在开发一些带有沙漠的 Rails 插件，我想在开发中使用带有 RSpec 和 Cucumber 的测试。RSpec 默认集成在 Desert 插件中，但它给了我一些错误。最后，我创建了一个使用我的插件的最小应用程序，并尝试像没有插件的普通应用程序一样对其进行测试。但我不喜欢那个解决方案，插件失去了它的模块化，RSpec 仍然给我返回了一些错误（他找不到位于插件中的模型/视图/控制器......）。那么我是唯一一个尝试测试沙漠插件（甚至是经典插件）的人吗？有没有人知道这些问题并得到解决方案？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-04-14T19:46:55.397

我在旧版 Rails 2.2.2 应用程序中使用“沙漠”插件，以下帮助我[http://pivotallabs.com/users/joe/blog/articles/985-testing-desert-plugins-in-isolation](http://pivotallabs.com/users/joe/blog/articles/985-testing-desert-plugins-in-isolation)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-07-06T23:04:30.023

你不应该使用沙漠插件，它是一个“老东西”。

# python - Python 对应的 phpMailer php 类在哪里？

> ID：807302
> 
> 赞同：3
> 
> 时间：2009-04-30T14:48:42.183
> 
> 标签：python, email, phpmailer

我是 python 新手。实际上，我正在尝试使用 python 发送特色电子邮件：html 正文、文本替代正文和附件。

因此，我找到了本[教程](http://code.activestate.com/recipes/67083/ "教程 1")并使用 gmail 身份验证对其进行了修改（教程在[此处](http://kutuma.blogspot.com/2007/08/sending-emails-via-gmail-with-python.html "教程 2")找到）

我有atm的代码是：

```
def createhtmlmail (html, text, subject):
"""Create a mime-message that will render HTML in popular
  MUAs, text in better ones"""
import MimeWriter
import mimetools
import cStringIO
from email.MIMEMultipart import MIMEMultipart
from email.MIMEBase import MIMEBase
from email.MIMEText import MIMEText
from email.Utils import COMMASPACE, formatdate
from email import Encoders
import os

out = cStringIO.StringIO() # output buffer for our message 
htmlin = cStringIO.StringIO(html)
txtin = cStringIO.StringIO(text)

writer = MimeWriter.MimeWriter(out)
#
# set up some basic headers... we put subject here
# because smtplib.sendmail expects it to be in the
# message body
#
writer.addheader("Subject", subject)
writer.addheader("MIME-Version", "1.0")
#
# start the multipart section of the message
# multipart/alternative seems to work better
# on some MUAs than multipart/mixed
#
writer.startmultipartbody("alternative")
writer.flushheaders()
#
# the plain text section
#
subpart = writer.nextpart()
subpart.addheader("Content-Transfer-Encoding", "quoted-printable")
pout = subpart.startbody("text/plain", [("charset", 'us-ascii')])
mimetools.encode(txtin, pout, 'quoted-printable')
txtin.close()
#
# start the html subpart of the message
#
subpart = writer.nextpart()
subpart.addheader("Content-Transfer-Encoding", "quoted-printable")
#
# returns us a file-ish object we can write to
#
pout = subpart.startbody("text/html", [("charset", 'us-ascii')])
mimetools.encode(htmlin, pout, 'quoted-printable')
htmlin.close()

#
# Now that we're done, close our writer and
# return the message body
#
writer.lastpart()
msg = out.getvalue()
out.close()
return msg

import smtplib
f = open("/path/to/html/version.html", 'r')
html = f.read()
f.close()
f = open("/path/to/txt/version.txt", 'r')
text = f.read()
subject = "Prova email html da python, con allegato!"
message = createhtmlmail(html, text, subject)
gmail_user = "thegmailaccount@gmail.com"
gmail_pwd = "thegmailpassword"
server = smtplib.SMTP("smtp.gmail.com", 587)
server.ehlo()
server.starttls()
server.ehlo()
server.login(gmail_user, gmail_pwd)
server.sendmail(gmail_user, "example@example.com", message)
server.close() 
```

并且有效..现在只错过附件..而且我无法添加附件（来自[这篇](http://snippets.dzone.com/posts/show/757 "附件")文章）

那么，为什么 php 没有像 phpMailer 这样的 python 类呢？是不是因为，对于一个中等能力的 Python 程序员来说，发送带有附件和替代文本正文的 html 电子邮件非常容易，以至于不需要一个类？还是因为我没找到？

如果我能够编写这样的类，当我对 python 足够好时，这对某人有用吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-30T16:56:26.433

如果你可以原谅一些公然的自我推销，我写了一个[邮件模块](http://pypi.python.org/pypi/mailer/0.3)，它使使用 Python 发送电子邮件变得相当简单。除了 Python smtplib 和电子邮件库之外，没有其他依赖项。

这是一个发送带有附件的电子邮件的简单示例：

```
from mailer import Mailer
from mailer import Message

message = Message(From="me@example.com",
                  To=["you@example.com", "him@example.com"])
message.Subject = "Kitty with dynamite"
message.Body = """Kitty go boom!"""
message.attach("kitty.jpg")

sender = Mailer('smtp.example.com')
sender.login("username", "password")
sender.send(message) 
```

**编辑**：这是发送带有替代文本的 HTML 电子邮件的示例。:)

```
from mailer import Mailer
from mailer import Message

message = Message(From="me@example.com",
                  To="you@example.com",
                  charset="utf-8")
message.Subject = "An HTML Email"
message.Html = """This email uses <strong>HTML</strong>!"""
message.Body = """This is alternate text."""

sender = Mailer('smtp.example.com')
sender.send(message) 
```

**编辑 2**：感谢其中一条评论，我向 pypi 添加了一个新版本的邮件程序，可让您在邮件程序类中指定端口。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T15:22:33.367

Django 在核心中包含您需要的类，[此处的文档](http://docs.djangoproject.com/en/dev/topics/email/#sending-alternative-content-types)

```
from django.core.mail import EmailMultiAlternatives

subject, from_email, to = 'hello', 'from@example.com', 'to@example.com'
text_content = 'This is an important message.'
html_content = '<p>This is an <strong>important</strong> message.</p>'
msg = EmailMultiAlternatives(subject, text_content, from_email, [to])
msg.attach_alternative(html_content, "text/html")
msg.attach_file('/path/to/file.jpg')
msg.send() 
```

在我的设置中，我有：

```
#GMAIL STUFF
EMAIL_USE_TLS = True
EMAIL_HOST = 'smtp.gmail.com'
EMAIL_HOST_USER = 'name@gmail.com'
EMAIL_HOST_PASSWORD = 'password'
EMAIL_PORT = 587 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-02-16T21:18:21.090

只想指出我在找到此线程时正在寻找的[Lamson 项目。](http://lamsonproject.org/)我做了更多搜索并找到了它。它的：

> Lamson 的目标是结束“电子邮件应用程序开发”的地狱。Lamson 并没有停留在 1970 年代，而是采用现代 Web 应用程序框架设计并使用经过验证的脚本语言 (Python)。

它与 Django 很好地集成。但它更适用于基于电子邮件的应用程序。虽然看起来像纯爱。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-21T21:45:25.700

也许您可以尝试使用**turbomail** python-turbomail.org

它更容易和有用:)

```
import turbomail

# ...

message = turbomail.Message("from@example.com", "to@example.com", subject)
message.plain = "Hello world!"

turbomail.enqueue(message) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T15:00:06.963

我建议阅读[SMTP rfc](http://james.apache.org/server/rfclist/smtp/rfc0821.txt)。谷歌搜索表明，这可以通过使用您正在导入但从未使用的 MimeMultipart 类轻松完成。以下是Python 文档站点上的[一些示例。](http://docs.python.org/library/email-examples.html)

# asp.net - 在运行时向表中添加行

> ID：807312
> 
> 赞同：1
> 
> 时间：2009-04-30T14:51:19.947
> 
> 标签：asp.net, user-controls, controls, runtime

在我们的一个页面上，我们有一个表，其中包含在运行时生成的行。我想将这些行的内容移到它们自己的控件中，并在运行时在其上设置属性，以便将演示文稿与代码隐藏分开。但它没有按我预期的方式工作。

如果我的行控件继承自 UserControl，那么我可以这样做以在运行时创建控件：

```
MyControl row = (MyControl)LoadControl("~/controls/MyControl.ascx"); 
```

然后，我想将其添加到我的表中：

```
MyTable.Rows.Add(row); 
```

但是行不继承自 System.Web.UI.HtmlControls.HtmlTableRow 或 System.Web.UI.WebControls.TableRow，所以你不能这样做。但是，如果我让我的控件继承自这两者之一，那么上面的 LoadControl 调用会抱怨该控件不继承自 UserControl。

这里有什么快乐的解决方案？如果需要更多信息，请询问。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T15:21:16.647

我认为您要做的是：

```
 MyControl row = (MyControl)LoadControl("~/controls/MyControl.ascx");
    TableCell newCell = new TableCell();
    newCell.Controls.Add(row);
    TableRow newRow = new TableRow();
    newRow.Cells.Add(newCell);
    MyTable.Rows.Add(newRow); 
```

正如您所说的问题是您的控件不能从多个基类继承，并且您不能将控件直接添加到 Rows 集合中。你需要先把它包起来。可能有更清洁的解决方案，但这一个确实有效。

# java - 在 Java5 中，如何获取运行应用程序的用户的全名？

> ID：807313
> 
> 赞同：1
> 
> 时间：2009-04-30T14:51:21.400
> 
> 标签：java, operating-system, jaas

在 Java5 中，有没有办法获取仅使用 JDK API 运行应用程序的用户的全名？（我知道 JAAS 和第三方库，但它们可能没有安装在目标系统上）。

我知道 System.getProperty("user.name") 但返回的是用户*ID*而不是用户*名*。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-30T15:07:40.953

用户“全名”的概念取决于操作系统，因此无法使用标准 Java API 获取它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T15:12:19.163

```
import java.util.Scanner;
...

System.out.println("Please enter your full name: ");
Scanner sc = new Scanner(System.in);
String name = sc.nextLine(); 
```

;)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T15:25:24.063

作为旁注。在我的一个系统中，我们获取 System.getProperty("user.name") 并使用 ID 查询 USERS 表（在 Oracle 数据库中）以获取其余所需信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T14:58:55.857

恐怕你会得到的一样好。

# java - GWT+Jetty JSP 编译器问题的解决方法？（Java 1.5 源代码级别无法识别）

> ID：807317
> 
> 赞同：22
> 
> 时间：2009-04-30T14:51:56.263
> 
> 标签：java, eclipse, jsp, gwt

正如[这个线程](http://groups.google.com/group/Google-Web-Toolkit/browse_thread/thread/ae8728724c2bf71/e975705066ee6f2c?lnk=gst&q=Syntax+error%2C+%27for+each%27+statements+are+only+available+if+source+level+is+1.5#e975705066ee6f2c)所示，让 JSP 使用新的 Jetty 服务器在 GWT 托管模式下编译似乎存在问题：

```
2\. ERROR in /tmp/Jetty_0_0_0_0_8080_war____ut4fm1/jsp/org/apache/jsp/ 
test_jsp.java (at line 53) 
        new java.util.ArrayList<String>(); 
                                ^^^^^^ 
Syntax error, parameterized types are only available if source level 
is 1.5 
```

有人有解决方法吗？这个[提交](http://code.google.com/p/google-web-toolkit/source/detail?r=5109)可能是相关的。我不知道`org.eclipse.jdt.core.JDTCompilerAdapter`在 Eclipse 之外构建应该使用什么等价物（例如在命令行上）。这对我们采用 GWT 1.6 来说是一个真正的障碍，因此任何指针都受到高度赞赏。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-01T17:05:14.297

这个问题是由 JspServlet 使用的默认值产生的，它使用 1.4 编译源/目标值。

1.  您可以通过添加来配置此 servlet

    ```
    <servlet>
        <servlet-name>jsp</servlet-name>
        <servlet-class>org.apache.jasper.servlet.JspServlet</servlet-class>
        <init-param>
            <param-name>compilerSourceVM</param-name>
            <param-value>1.5</param-value>
        </init-param>
        <init-param>
            <param-name>compilerTargetVM</param-name>
            <param-value>1.5</param-value>
        </init-param>
        <load-on-startup>3</load-on-startup>
    </servlet> 
    ```

2.  还有一个问题，因为您无法使用当前的 jasper-compiler-5.0.28 配置 JspServlet。您应该下载[jasper-compiler-5.0.30](https://raisercostin.googlecode.com/svn/maven2/tomcat/jasper-compiler/5.0.30/jasper-compiler-5.0.30.jar)并确保在 gwt 之前的类路径中。还有其他最新的 jasper 编译器 jar，但我不知道与 jakarta-tomcat-5.0.28 的兼容性如何。 ~~我通过在 GWT 1.6.4 中添加对 jakarta-tomcat-5.0.30 的依赖解决了这个问题。[您可以从http://raisercostin.googlecode.com/files/gwt-windows-1.6.4.raisercostin.zip](http://raisercostin.googlecode.com/files/gwt-windows-1.6.4.raisercostin.zip)下载使用此依赖项编译的 GWT~~

我也在 [http://code.google.com/p/raisercostin/wiki/GwtEclipsePluginDebug](http://code.google.com/p/raisercostin/wiki/GwtEclipsePluginDebug)描述了解决方案。

# vba - VBA 应用程序如何在英语和法语版本的 Windows/Word 中使用正确的内置样式

> ID：807327
> 
> 赞同：4
> 
> 时间：2009-04-30T14:53:33.547
> 
> 标签：vba, ms-word

我开发了一个从数据库中提取数据的 Word 2003 报告生成应用程序。

大多数组织使用英文版的 Windows 和 Office。但是，我们法国办事处的许多用户使用他们的本地版本。如果我使用 Word 的任何内置标题样式 Heading (1-9)，法语版本需要 Titre (1-9)。

在我当前的解决方案中，用户设置了表单选项，VBA 执行以下操作：

```
Dim HeadingStyle as String
Dim HeadingLevel as Integer

If ChooseReportFrm.FrenchOpt.Value = True Then 
 HeadingStyle = "Titre "
Else
 HeadingStyle = "Heading "
End If
...

Call InsertText(HeadingStyle & CStr(HeadingLevel)) 
```

我想让这个过程自动化并且对用户完全透明。我一直在徒劳地寻找一种与位置无关的方式来设置正确的样式，例如枚举常量。有人对更优雅的解决方案有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T15:38:23.687

看看[`WdBuiltinStyle`枚举](http://msdn.microsoft.com/en-us/library/microsoft.office.interop.word.wdbuiltinstyle(VS.80).aspx)。

分配样式时，您可以通过它们的[本地名称](http://msdn.microsoft.com/en-us/library/microsoft.office.interop.word.style.namelocal(office.11).aspx)来执行此操作（这就是您现在似乎所做的），但您也可以使用枚举值之一，在您的情况下将`Style`属性设置为`WdBuiltinStyle.wdStyleHeading1`就可以了。

```
Dim para As Paragraph
Set para = ActiveDocument.Paragraphs(1)

para.Style = WdBuiltinStyle.wdStyleHeading1 
```

# c# - 在什么情况下，来自 ac# 应用程序的 MSDTC 事务会导致 SQL 复制部分（并且静默）失败

> ID：807339
> 
> 赞同：0
> 
> 时间：2009-04-30T14:55:39.733
> 
> 标签：c#, sql, sql-server, replication, msdtc

我们有一个特别奇怪的问题；让我设置场景。***找到的解决方案见下文***

我们有三个 SQL Server 2005 数据库，为了论证，我们称之为：*Alpha*、*Beta*和*Gamma*。

这些数据库之间定义了一种复制关系，如下所示：

所有三个数据库都有一个名为“AnExample”的表，具有相同的模式。复制设置为*Alpha*是提供者，其他两个数据库是订阅者。

1.  使用 MSDTC 事务（由 TransactionScope 处理）的 c#.Net 3.5 应用程序同时读取和写入数据库：Alpha 和 Beta。
2.  此事务中的表“AnExample”仅在 Alpha 上更新。
3.  MSDTC 事务成功提交。
4.  “AnExample”表可能在*Alpha*中更新，更改立即复制到*Gamma*
5.  *Beta*上没有发生任何变化（分析器确认数据库上没有发生任何活动），SQL 日志或事件日志中也没有出现任何错误
6.  使用相同的凭据重新运行在 Management Studio 中更新“AnExample”的相同查询成功（复制到*Beta*）
7.  运行 MSDTC 事务 在*Beta*上写入另一个表，然后使用主应用程序 DAL、连接字符串和配置的测试应用程序对 Alpha 的“AnExample”表进行完全相同的写入（复制到*Beta*发生）

这使我们相信主应用程序中发生了一些变化，这些变化不是孤立发生的。

**可能的线索/红鲱鱼**

我们可以看到的成功测试与主应用程序使用的实际查询之间的唯一区别是隔离级别发生了某种变化。在成功的查询中，它被设置为仅读取已提交的事务隔离级别，而在失败的情况下它被设置为可序列化（尽管没有显式调用来更改代码库或存储过程中的隔离级别）。

我们确实觉得这在某种程度上是一个红鲱鱼，因为在 Management Studio 中使用此隔离级别运行查询再次成功而没有问题。但事实上，这可能是我们尚未发现的另一个问题的征兆。

为了完整起见，这里是无法复制到 Beta（但复制到 Gamma）的查询的设置。

```
-- network protocol: TCP/IP
set quoted_identifier on
set arithabort off
set numeric_roundabort off
set ansi_warnings on
set ansi_padding on
set ansi_nulls on
set concat_null_yields_null on
set cursor_close_on_commit off
set implicit_transactions off
set language us_english
set dateformat mdy
set datefirst 7
set transaction isolation level *serializable* 
```

这有点让人头疼。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T16:28:36.063

我假设这是事务复制？如果是这样，推送给订阅者的更改是由日志阅读器从事务日志中获取的，所以这个问题确实听起来很奇怪。

我会尝试在发布者数据库上运行跟踪，这样您就可以看到复制代理做了什么.. 不知道可能出了什么问题，但也许有些东西会跳出来。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-07T09:33:48.827

所以我们发现了问题所在。如上所述; 我们有一个分布式事务写入*Alpha*然后*Beta*。*然后，对Beta*的写入成功地复制到*Gamma*它以静默方式失败到*Alpha*。然而，有一个遗漏是对*Alpha*的写入实际上正在复制到*Beta*（大型数据库模式的麻烦）。将此写入移至*Beta*意味着复制突然成功。

我还没有看到它记录了通过分布式事务进行的更新不能以一种方式进行复制，但公平地说，这是一个有点模糊的问题，只需确保对复制表的所有写入都发生在同一个数据库上即可解决。

希望这对其他人有帮助。

# wpf - 如何在 WPF 中处理/编辑大量文本？

> ID：807347
> 
> 赞同：9
> 
> 时间：2009-04-30T14:56:32.463
> 
> 标签：wpf, performance, text

使用 WPF 显示和编辑大量无格式文本（就像记事本一样）的好方法是什么？将大字符串加载到 TextBox 会使 UI 无响应。整体性能几乎无法与以前的 Microsoft UI 框架的 TextBox 控件相媲美。

我有什么选择来解决这个问题。我不想在文本控件加载文本时阻止 UI 线程。此外，我可能需要某种“虚拟化”，因为将整个文本加载到控件中可能不是一个好主意（我猜 20MB 的文本会创建很多字形，即使它们不可见）。似乎 TextBox 甚至没有 AppenText() 方法，所以我什至没有办法控制文本的异步加载。

这不是一个普遍的问题吗？似乎 WPF 没有为此提供任何开箱即用的东西。为什么会这样？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-11T19:50:55.460

我不确定这是否有帮助，但您是否尝试过使用[FlowDocumentPageViewer](http://msdn.microsoft.com/en-us/library/system.windows.controls.flowdocumentpageviewer.aspx)和[FlowDocumentReader](http://msdn.microsoft.com/en-us/library/system.windows.controls.flowdocumentreader.aspx)？

它还具有非常好的注释支持，看起来非常适合以文本格式加载文档。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T21:35:00.813

问题在于 TextBox 是单个容器元素。由于容器回收，ListBox 等列表控件的虚拟化非常好。确实没有什么简单的方法可以加快 TextBox 的速度。

但是 TextBox 控件确实有一个 AppendText() 方法：

```
 TextBox tb = new TextBox();
        tb.AppendText("Hello"); 
```

所以是的，您可以使用它来动态添加一些文本，就像您提到的那样。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-08-04T04:08:22.447

SharpDevelop 中的文本编辑器 AvalonEdit 完全是在 WPF 中从头开始编写的，并且针对大量文本进行了优化。它不支持富文本（尽管它支持语法高亮和其他很酷的功能，例如折叠）。我认为这可能完全符合您的要求。

这是开发者写的关于编辑器的文章：

[http://www.codeproject.com/KB/edit/AvalonEdit.aspx](http://www.codeproject.com/KB/edit/AvalonEdit.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T15:01:14.730

您可以只使用带有样式的文本框，为用户提供更多查看文本的空间。Telerik 和其他人可能提供更高级的控件，但如果您不需要编辑选项就足够了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-07T12:44:57.040

您总是可以混合和匹配技术：您可以将 WinForms TextBox 拖放到 WPF 父级上。您会丢失样式、不透明度、动画、变换等内容，但如果重要的是编辑文本，WinForms TextBox 就可以做到这一点。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-11T21:43:31.207

您是否尝试过 WPF [RichTextBox](http://msdn.microsoft.com/en-us/library/system.windows.controls.richtextbox.aspx)？如果你走这条路，你肯定想阅读 FlowDocument 信息。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-10-03T14:21:29.637

您可以使用*FlowDocument*，但这不能开箱即用地绑定到MVVM中*FlowDocument的**Document*属性。

 *另一种解决方案是使用*FlowDocumentScrollViewer*并绑定到其*Document*属性。

（或者您甚至可以使用*FlowDocumentReader*并绑定其*Document*属性，类似于*FlowDocumentScrollViewer*。这为您提供了不同的 UI。）

风景：

```
 <FlowDocumentScrollViewer Document="{Binding FlowDocument, Mode=OneWay}" /> 
```

视图模型：

```
 FlowDocument fd = new FlowDocument();
        Paragraph p = new Paragraph();
        Run r = new Run();
        r.Text = "large text";
        p.Inlines.Add(r);
        fd.Blocks.Add(p);
        FlowDocument = fd;

 private FlowDocument _FlowDocument;
    public FlowDocument FlowDocument
    {
      get{ return _FlowDocument; }
      set
      {
        _FlowDocument = value;
        NotifyOfPropertyChange(nameof(FlowDocument));
      }
    } 
```

另请参阅此以获得额外的性能提示：[https ://docs.microsoft.com/en-us/dotnet/framework/wpf/advanced/optimizing-performance-text#flowdocument-textblock-and-label-controls](https://docs.microsoft.com/en-us/dotnet/framework/wpf/advanced/optimizing-performance-text#flowdocument-textblock-and-label-controls)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-11-04T18:51:05.610

另一种选择是使用[Scintilla.NET](https://github.com/jacobslusser/ScintillaNET)。到目前为止，它对于我看到的大量文本具有最佳性能。加载大文件几乎是瞬间的。即使它是一个 WinForms 控件，您也可以使用 WindowsFormsHost 容器将它嵌入到您的 WPF 窗口中。语法高亮和其他一些功能对于显示未格式化的文本应该绰绰有余。从缺点来看 - 由于这是一个 WinForms 控件，它与其他 WPF UI 元素重叠。调整控件大小也可能存在问题。不幸的是，我没有看到比使用非 WPF 控件而不是默认的 TextBox 和 RichTextBox 更好的选择。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-05-07T12:37:01.427

尝试这样的事情怎么样：

将整个字符串保留在内存中，但在文本框中仅显示它的“切片”。该切片字符串的大小将根据文本框的大小、字体大小等动态计算。

当然，这涉及到很多用于正确显示、同步等的重要代码，但这似乎是可行的方法。

# drupal - Put Links at the End of a Page ( Drupal)

> ID：807352
> 
> 赞同：0
> 
> 时间：2009-04-30T14:57:32.867
> 
> 标签：drupal

Is there a module in Drupal that allows me to put link at the end of a page?

[http://lh6.ggpht.com/_SDci0Pf3tzU/Sfm7vF_MSiI/AAAAAAAAEtY/VX3BXaMOfSM/s400/linksatend.jpg](http://picasaweb.google.com/lh/photo/WDqZY0HqvyVP9bbck2VSUA?feat=embedwebsite)

I tried to use menu and put it as a block at the footer, but the menu items are arranged vertically, instead of horizontally.

Is there anyway to do it without ( preferably) touching the CSS and HTML?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T16:17:53.187

将菜单项从垂直更改为水平只需 1 或 2 个 CSS 规则。这就是为什么我怀疑是否有一个模块。如果您要发布指向您网站或 html + css 的链接，我可以帮助您使用 css。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T16:49:20.430

页面末尾的链接可以由几个不同的东西控制。

首先，检查块管理，看看是否有页脚的内容区域。也许那里有一个控制这些链接的块。

接下来，根据主题的构建情况，检查 Admin > Site Building > Themes > Conigure > (Your theme) 下的配置选项。许多人可以选择更改页脚中显示的链接。

最后，检查 page.tpl.php。它们也可以在模板中硬编码（这很糟糕）并从那里编辑。

在回答您有关“更改链接的模块”的问题时，您可以看到，由于可以从不同的地方控制链接，因此仅用于此目的的模块将毫无意义。正确的方法是在 template.php 中设置适当的选项，以便可以在您的主题设置中进行配置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T19:52:34.933

[使用Nice Menus](http://drupal.org/project/nice_menus)模块可能会有一些运气- 它旨在创建动画菜单，但如果你给它一个平面菜单树，它可能足够接近你想要的。如果这不起作用，大约有 100 个[模块处理导航](http://drupal.org/project/modules?page=1&filters=tid%3A124&solrsort=sort_title%20asc)。

不过，最好的方法是将菜单块放在页脚并修改主题以[使用 CSS 将其展平](http://www.google.com/search?q=css+list+menu+horizontal&ie=utf-8&oe=utf-8&aq=t&rls=org.mozilla:en-US:official&client=firefox-a)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-01T08:22:10.310

假设您不会触摸主题，可能是因为您使用的是未修改的 contrib 主题，您可以使用以下两种方法之一：

*   手动创建块作为自定义 HTML 块，这使您可以完全控制内容。主要缺点是您必须手动维护它，而不是使用 admin/build/menus
*   根据您从[menu_primary_links( )](http://api.drupal.org/api/function/menu_primary_links/6) . 不利的一面是，如果您还没有站点模块，则必须创建一个站点模块，或者如果您将其创建为自定义块，则必须启用 PHP 过滤器。

话虽这么说，我认为如果它是自定义主题，您最好还是修改主题，或者如果它是贡献主题，则为您正在使用的主题创建一个子主题。它的工作量会更少，而且，这是一个外观问题，它属于主题范围而不是模块范围。

# c# - LinFu - can't quite see how to do what I want

> ID：807354
> 
> 赞同：1
> 
> 时间：2009-04-30T14:57:36.343
> 
> 标签：c#, multiple-inheritance, mixins, linfu

Just found LinFu - looks very impressive, but I can't *quite* see how to do what I want to do - which is multiple inheritance by mixin (composition/delegation as I'd say in my VB5/6 days - when I had a tool to generate the tedious repetitive delegation code - it was whilst looking for a C# equivalent that I found LinFu).

FURTHER EDIT: TO clarify what I mean by composition/delegation and mixin.

```
public class Person : NEOtherBase, IName, IAge 
{

    public Person()
    {

    }

    public Person(string name, int age)
    {
        Name = name;
        Age = age;
    }

    //Name "Mixin" - you'd need this code in any object that wanted to
    //use the NameObject to implement IName
    private NameObject _nameObj = new NameObject();

    public string Name
    {
        get { return _nameObj.Name; }
        set { _nameObj.Name = value; }
    }
    //--------------------

    //Age "Mixin" you'd need this code in any object that wanted to
    //use the AgeObject to implement IAge
    private AgeObject _ageObj = new AgeObject();

    public int Age
    {
        get { return _ageObj.Age; }
        set { _ageObj.Age = value; }
    }
    //------------------

}

public interface IName
{
    string Name { get; set; }
}

public class NameObject : IName
{
    public NameObject()
    {}

    public NameObject(string name)
    {
        _name = name;
    }

    private string _name;
    public string Name { get { return _name; } set { _name = value; } }

}

public interface IAge 
{
    int Age { get; set; }
}

public class AgeObject : IAge
{
    public AgeObject()
    {}

    public AgeObject(int age)
    {
        _age = age;
    }

    private int _age;
    public int Age { get { return _age; } set { _age = value; } }

} 
```

Imagine objects with many more properties, used in many more "subclasses" and you start to see the tedium. A code-gernation tool would actually be just *fine*...

So, LinFu.... The mixin example below is fine but I'd want to have an actual Person *class* (as above) - what's the LinFu-esque way of doing that? Or have I missed the whole point?

EDIT: I need to be able to do this with classes that are already subclassed.

```
DynamicObject dynamic = new DynamicObject();

IPerson person = null;

// This will return false
bool isPerson = dynamic.LooksLike<IPerson>();

// Implement IPerson
dynamic.MixWith(new HasAge(18));
dynamic.MixWith(new Nameable("Me"));

// Now that it’s implemented, this
// will be true
isPerson = dynamic.LooksLike<IPerson>();

if (isPerson)
    person = dynamic.CreateDuck<IPerson>();

// This will return “Me”
string name = person.Name;

// This will return ‘18’
int age = person.Age; 
```

# .net - 如何使用 Erlang 与其他网络应用程序交互？

> ID：807355
> 
> 赞同：14
> 
> 时间：2009-04-30T14:57:49.743
> 
> 标签：.net, json, rest, erlang, protocols

我正在学习 erlang，我对 mnesia db 非常着迷。我想使用 erlang 作为后端在 C#/F# 中构建一些真实世界的应用程序。

我正在寻找一个很好的解决方案来与外界的 erlang 节点进行通信。

到目前为止我发现了什么：

**(A) [OTP.net](http://jungerl.cvs.sourceforge.net/jungerl/jungerl/lib/otp.net/)**，一个开源的 .net 库，实现“本机”erlang 通信协议

这里的问题：

*   库不是很成熟
*   我不喜欢从 Java 移植的对象模型（太多几乎完全相同的 BCL 类副本）
*   我不喜欢用于连接的线程模型。
*   需要许多开放的 TCP 端口
*   缺乏安全感

**(B) 在 erlang 中使用端口/套接字**并实现自定义协议。

这里的问题：

*   我没有任何经验
*   难以为未来版本维护/扩展

您对此主题有什么建议和经验吗？

我应该使用 OTP.net 库来满足我的需求还是尝试从头开始实现一个新协议？

JSON 或 REST 解决方案呢？是否有任何 erlang 库可以解决问题？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-04T13:14:18.523

端口/套接字解决方案是一个好主意，并不像看起来那么难。[Google 的协议缓冲区](http://code.google.com/p/protobuf/)正是您所需要的。它非常易于使用、高效且可维护。它具有 C#、erlang、java、python 等的实现（请参阅[OtherLanguages](http://code.google.com/p/protobuf/wiki/OtherLanguages)和[开发人员指南](http://code.google.com/apis/protocolbuffers/docs/overview.html)）

您可以使用协议缓冲区来定义请求和响应协议结构。然后使用它在 erlang 和任何其他支持的语言之间进行通信。本[教程](http://code.google.com/apis/protocolbuffers/docs/tutorials.html)将解释这一切。之后，您需要做的就是通过端口发送响应。

这种方法的优点是：

1.  您可以在未来轻松扩展和更改协议
2.  它比 REST 方法更有效
3.  它目前被 Google 用于其几乎所有的内部 RPC 协议和文件格式

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-30T15:59:09.223

如果你想在 Erlang 中实现一个 REST API，只需要做一件事。使用优秀的[MochiWeb 工具包](http://code.google.com/p/mochiweb/)构建您自己的 HTTP 服务器来实现您的协议。

不要惊慌，它确实比看起来容易。

有许多关于如何做到这一点的教程，包括来自 Pragmatic Programmers的[截屏视频集。](http://www.pragprog.com/screencasts/v-kserl/erlang-in-practice)

它带有一套完整的 json 库，所以你会没事的！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T15:07:52.030

当然，您可以使用 Erlang 进行 REST，请参阅[http://www.infoq.com/articles/vinoski-erlang-rest](http://www.infoq.com/articles/vinoski-erlang-rest) - 如果适合您的应用程序需求，REST 是一种很好的方法。（Pycon Italia Tre，下周在佛罗伦萨举行有关 Erlang/Python 合作的会议，如果您在托斯卡纳附近，请访问 www.pycon.it；-)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-30T15:28:37.940

还有一个用于 Erlang 的[JSON 库](http://www.lshift.net/blog/2007/02/17/json-and-json-rpc-for-erlang)，您可能想研究一下。我没有使用它，所以我不能从经验中说什么。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-01T20:01:36.247

虽然我同意某些 REST 解决方案很有用，但无论您使用 Yaws 还是 Mochikit，您都会发现自己试图定义一些中间“语言”以生成 Mnesia 能够处理的查询。

因此我提出这个建议；无论您为自己考虑什么项目，只需在 erlang 中实现它并使用可用的工具。你会在很多方面得到回报。

然后你总是可以尝试 CouchDB。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-07T16:55:24.630

我们使用 YAWS 和客户端的简单 http 请求/响应实现来做到这一点。YAWS 实现只是在提取参数后将调用委托给适当的 gen_server 进程。

这种方法的唯一缺点是它不是那么快（Google 协议缓冲区会更好）——并且通过在 HTTP 用语中保持连接“活动”有助于降低所有设置成本并减少过时套接字连接的数量。如果您要返回大量数据集，则必须通过流式返回结果来获得更多创意。对于我们的大多数数据请求来说，这不是问题 - 响应可以很容易地放入内存中。

如果协议的原始性能不是那么大的问题，则有一些好处：

*   您可以连接到安全模型（HTTPS 或身份验证）
*   您可以从任何可以发出 Web 请求的东西中调用 API（我们有很多旧的 perl 代码和 Excel 工作表 - 将它们整理出来是微不足道的）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-11-23T02:17:09.000

我们已经重写了 OTP.NET

这个库成熟了很多倍，因为它是为 .NET/CLR 从头开始​​重写的，（不像它的前身是从 Java 转换而来的）

看看这个帖子：

[http://blog.aumcode.com/2013/10/nfx-native-interoperability-of-net-with.html](http://blog.aumcode.com/2013/10/nfx-native-interoperability-of-net-with.html)

# .net - custom serialization converters for a WCF service

> ID：807361
> 
> 赞同：3
> 
> 时间：2009-04-30T15:00:01.270
> 
> 标签：.net, ajax, wcf, serialization, asmx

We are currently using a .asmx web service method which serializes our object to Json to be returned to the client and consumed by MS Ajax code. For some members of the object, we use custom converters via classes that derive from JavaScriptConverter and override the Serialize method. We "wire up" these custom converters in our web.config via the elements:

```
<system.web.extensions>
  <scripting>
    <webServices>
      <jsonSerialization maxJsonLength="2000000">
        <converters>
          <add name="ElementReference" type="OurNamespace.OurJavascriptConverter"> 
```

We are now changing over to a WCF web service. I am unable to find the WCF equivalent.

Thanks for any help.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-03T16:13:27.090

一种方法是将Carlos Figueria 描述的[WCF 原始编程模型与](http://blogs.msdn.com/carlosfigueira/archive/2008/04/17/wcf-raw-programming-model-web.aspx)[JSON.NET](http://james.newtonking.com/projects/json-net.aspx)结合使用。

我发现 JSON.NET 比 WCF JSON 序列化程序更加灵活和可配置。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T15:08:13.730

This might be what you're looking for [http://blogs.msdn.com/carlosfigueira/archive/2008/04/17/wcf-raw-programming-model-web.aspx](http://blogs.msdn.com/carlosfigueira/archive/2008/04/17/wcf-raw-programming-model-web.aspx).

Although it talks about REST, not sure if you're using WCF in that way. Might be usefule though, check it out.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-01T13:19:05.590

默认情况下，WCF 使用`DataContractSerializer`基本 http 模式和`NetDataContractSerializer`一些二进制 tcp 模式。您不能真正为每个类型/属性注入转换器，但您可以通过在合同中添加“行为”（在两端）来*替换序列化程序。*虽然可能，但这不是很便携，建议您坚持使用常规布局，以便“mex”正确理解事物。

有关此类行为的示例，[请参见此处。](http://code.google.com/p/protobuf-net/source/browse/trunk/protobuf-net/ServiceModel/ProtoOperationBehavior.cs)

AFAIK，最可能的替代方案（用于自定义序列化）是自己实现`IXmlSerializable`和做所有事情 - 不好玩。

# compiler-construction - 我在哪里可以找到 Haskell 的完整括号？

> ID：807368
> 
> 赞同：7
> 
> 时间：2009-04-30T15:01:44.353
> 
> 标签：compiler-construction, haskell, ghc

GHCI 中有没有办法显示一个完整的括号版本的语句？我发现自己有时想要这样做来帮助我理解一段我不熟悉的代码。有时，大师们的简洁性会为我们 n00bs 模糊一些东西，而任何能帮助我将这些野兽分开的东西似乎都有帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T15:07:24.370

试试[`ghc -ddump-parsed`](http://haskell.org/ghc/docs/latest/html/users_guide/options-debugging.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T16:15:16.983

wiki 上记录了许多方法：http: [//haskell.org/haskellwiki/Indent#Indenting_Haskell_Mechanically](http://haskell.org/haskellwiki/Indent#Indenting_Haskell_Mechanically)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-01T13:16:55.267

也许与您的问题没有直接关系，但我经常发现无点代码难以阅读。顺便说一句，为表达式[生成无点形式的工具也可以做相反的事情。](http://hackage.haskell.org/cgi-bin/hackage-scripts/package/pointfree)例如：

```
 > unpl const . (1 +)
 (\ e _ -> 1 + e) 
```

好多了！:)

# .net - .Net sln structure

> ID：807384
> 
> 赞同：2
> 
> 时间：2009-04-30T15:06:29.600
> 
> 标签：.net, visual-studio

I have been working on variety of projects at my work. I am thinking to organize all the projects within solutions in the following tree structure:

```
 [Common Libraries]     -- virtual and real folder
    project1
    project2
    ....                -- projects or folders
 [Application Group1]
    [Application1]
       project1         -- console application as example
       projectLib1      -- project library for project1
       [dependency libraries1]
          projectLib1_1  -- dependency project for upper projectLib1
  .... 
```

Basically, the top folder contains all the common libraries and its dependency projects. Virtual folders (real folder as well) are used as a way to group projects and sub-groups. In this way, projects can only see or reference projects in the same level and upper level.

Any comments or other alternative way to organize projects?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-01T08:17:44.643

您可以引用较低的项目，但不能在 Visual Studio 中添加它们。

对我来说似乎有点奇怪，但我发现你可以做到，但你需要编辑 sln 文件中的路径。

有点繁琐，但它有效。

我个人最喜欢的获取资源的方式是：

```
- 小贩
-  产品
- - 版本

```

所以例如

```
-微软
--企业图书馆
---3.1
---4.0
——风格警察
---4.3
-阿帕奇
--Log4net
---1.2.10
---1.2.1

```

ETC

这样，您将永远不会有重复的 Dll，并且您的代码将适合您的公司和产品，每个版本都是一个版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T15:11:06.453

I prefer to put every project in its own folder off the root SVN trunk and then separately organize the solutions in VS as you described.

# c# - What do I need to do for this line of code? (C#)

> ID：807385
> 
> 赞同：0
> 
> 时间：2009-04-30T15:06:38.570
> 
> 标签：c#, class

I'm trying to get an if statment that says if my Points Array at "i" (Initialized in a For Loop) is equal to the X and Y of a Circle (Which is set to smallcircle.X and smallcircle.Y). I know what I need to do in the if statment, but I can't get the if statment itself to work. What is the syntax for that?

Currently Have:

```
if (centerPoints[i] == smallcircle.X, smallcircle.Y) 
```

It doesn't like that one bit.

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-30T15:07:52.437

Probably this:

```
if (centerPoints[i].X == smallcircle.X && centerPoints[i].Y == smallcircle.Y) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-30T15:11:59.553

centerPoints[i] 是 Point 的一个实例，对吧？

在这种情况下，这...

```
if (centerPoints[i] == new Point(smallcircle.X, smallcircle.Y)) 
```

...应该做的伎俩

**更新**

你的圈子是什么类型的？如果它是你的，那么为什么它没有 Point 类型的 Center 属性。这会让你的生活更轻松。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T15:18:44.907

您正在寻找逻辑 AND 运算符，在 C# 中是`&&`. 它用于检查两个条件是否为真。

以便：

```
if( pts[i] == smallcircle.X && pts[i] == smallcircle.Y ) {
 // Both are true so do this...
} 
```

如果要检查 EITHER 条件是否为真，请使用逻辑 OR 运算符 ||：

```
if( pts[i] == smallcircle.X || pts[i] == smallcircle.Y ) {
 // Either one or the other condition is true, so do this...
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-30T15:41:23.463

还有一件事：

如果这是你的 for 循环*唯一*要做的事情，你可以像这样编写整个循环：

```
foreach (Point point in centerPoints.Where(p => p.X == smallcircle.X && p.Y == smallcircle.Y) )
{
    //
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-30T15:07:53.480

```
if ((centerPoints[i].X == smallcircle.X) && (centerPoints[i].Y == smallcircle.Y)) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T15:57:54.547

另一种选择是覆盖结构`Equals()`中的方法`Point`，这是我使用过的一个示例：

```
struct Point
{
    public int X;
    public int Y;

    public Point(int x, int y) { X = x; Y = y; }

    public override bool Equals(object obj)
    {
        return obj is Point && Equals((Point)obj);
    }

    public bool Equals(Point other)
    {
        return (this.X == other.X && this.Y == other.Y);
    }

    public override int GetHashCode()
    {
        return X ^ Y;
    }

    public override string ToString()
    {
        return String.Format("({0}, {1})", X, Y);
    }

    public static bool operator ==(Point lhs, Point rhs)
    {
        return (lhs.Equals(rhs));
    }

    public static bool operator !=(Point lhs, Point rhs)
    {
        return !(lhs.Equals(rhs));
    }

    public static double Distance(Point p1, Point p2) 
    {
        return Math.Sqrt((p1.X - p2.X) * (p1.X - p2.X) + (p1.Y - p2.Y) * (p1.Y - p2.Y));
    }
} 
```

所以你的代码会变成：

```
Point smallcircle = new Point(5, 5);
if (centerPoints[i] == smallcircle)
{
    // Points are the same...
} 
```

# c# - A Job For Reflection?

> ID：807389
> 
> 赞同：1
> 
> 时间：2009-04-30T15:07:12.467
> 
> 标签：c#, .net, reflection

Greetings!

I have a class which is used like a cache:

```
public sealed class MyCache<T> : IDisposable
{
    private ReaderWriterLockSlim theLock = new ReaderWriterLockSlim();
    private Dictionary<int, T> theCache = new Dictionary<int, T>();

    public void Add(int key, T value)
    {
        // ... logic/code to add to the dictionary
    }

    public void Clear()
    {
        theLock.EnterWriteLock();
        try
        {
            theCache.Clear();
        }
        finally
        {
            theLock.ExitWriteLock();
        }
    }
} 
```

This cache is used many times, so there are often multiple instances of this at any given time.

Example 1:

```
public static class SpecialPageCache
{
    public static MyCache<string> SpecialPage = new MyCache<string>();
} 
```

Example 2:

```
public static class DdListCache
{
    public static MyCache<List<int, string>> DdlList = new MyCache<List<int, string>>();
} 
```

And so on.

I have a service that can clear the caches on-demand, but unfortunately, each one has to be cleared like so:

```
private void ClearThemAll()
{
    SpecialPageCache.SpecialPage.Clear();
    DdListCache.DdlList.Clear();
    // repeat for all other caches that may exist ...
} 
```

How can I use reflection (or something else?) to call each cache's Clear() method without having to explcitly do it for each one like I do in the above ClearThemAll() method?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T15:14:18.240

伊克。您必须检查您感兴趣的程序集中的所有类型，并检查所有静态字段。这变得更加有趣，因为它是一个泛型类型。如果你有一个非泛型基类，你的生活会更简单：

```
public abstract class MyCache : IDisposable
{
    public abstract void Clear();
}

public sealed class MyCache<T> : MyCache
{
    // ...
} 
```

然后至少相对容易检测特定字段的类型是否为 a `MyCache`，获取其值并调用`Clear`它，而不会弄乱对泛型类型的反射。

不过，这通常是一个令人讨厌的问题——您确定要像这样清除所有缓存，而没有真正“了解”您正在清除哪些缓存吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T15:27:01.920

```
public interface ICache : IDisposable
{
    void Clear();
}

public interface ICache<T> : ICache
{
}

public abstract class CacheBase<T> : ICache<T>
{

}

public sealed class SpecialPageCache : CacheBase<string>
{
    internal SpecialPageCache()
    {
    }

}

public static class CacheFactory
{
    private static List<ICache> cacheList = new List<ICache>();

    public static TCache Create<TCache>()
        where TCache : ICache, new()
    {
        var result = new TCache();
        cacheList.Add(result);
        return result;
    }

    public static void ClearAll()
    {
        cacheList.ForEach((c) => c.Clear());
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T15:19:45.357

反射听起来很讨厌。在不了解您的对象生命周期的更多信息的情况下，以下方法会起作用吗？

```
public abstract class MyCacheBase : IDisposable {
    public static List<MyCache> caches = new List<MyCache>();

    public MyCacheBase() {
        caches.Add(this); // Add all constructed caches to the list
    }

    public static void ClearAllCaches() {
        foreach (MyCache cache in cache) // clear all constructed
            cache.Clear();               // caches in the list.
    }

    public void Finalize() {
        Dispose();
    }

    public void Dispose() {
        caches.Remove(this);  // Remove disposed classes from the list
    }

    public abstract void Clear();
}

public sealed class MyCache<T> : MyCacheBase
{
    // Rest of the implementation
} 
```

（感谢乔恩注意到通用性。几乎错过了。）

如果你想拥有用户特定的缓存，你可以添加一个用户特定的 CacheFactory 来跟踪通过它创建的缓存，它的 ClearAll() 方法只会清除这些缓存。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T15:23:59.480

为什么需要特别明确他们是否使用需要释放的资源？

我想知道您是否不能使用 System.WeakReference 以便缓存在何时被垃圾收集？

[http://msdn.microsoft.com/en-us/library/system.weakreference.aspx](http://msdn.microsoft.com/en-us/library/system.weakreference.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T15:10:26.033

You could store references to all of your instanced caches in a list. Then iterate same list, and call Clear on each MyCache. =)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T19:05:36.530

如果你真的想做反思，那么你会做这样的事情：

```
List<object> caches;
foreach (object obj in caches)
{
    Type t = obj.GetType();
    MethodInfo m = t.GetMethod("Clear");

    // Object does not have a public instance method named "Clear"
    if (m == null) { continue; }

    m.Invoke(obj, new object[0]);
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T15:34:15.087

这听起来对控制反转容器的工作方式非常熟悉。为什么不只是有类似的东西

`Dictionary<Type, Dictionary<int, object>>`

然后，所有函数都将采用 T 类型，然后使用该类型查找相应的字典。一个静态 MyCache 可以处理您的所有类型，并且可以通过一次调用来处理它。

# c# - 使用空父类只是为了对其他类进行分组。有更好的方法吗？

> ID：807401
> 
> 赞同：1
> 
> 时间：2009-04-30T15:08:25.663
> 
> 标签：c#, oop, coding-style

我有几个在概念上属于一层的类。它们没有共同的属性，这就是为什么它们不需要从某些基类继承。

我还有一些处理这些类的方法。其中一些是以下样式的模板：

```
public SomeClass
{
    public void SomeMethod<T> (T argument) where T : BaseClass
    {
        /* Do something */
    }
} 
```

所以我使用这个 WHERE 关键字只是为了保护代码（我想是我自己的），这样我就不会错误地向这个方法提供其他东西。

自然地，我让那些其他类派生自 BaseClass ，它是空的，除了对其他类进行分组之外没有其他目的（至少现在）。

这可能不是那么好的方法，但无论如何我正在使用它。

有一个更好的方法吗？

编辑：经过考虑，我决定不采用这种方法，只是删除了那个基类。没有它就足够了。无论如何，我不能让代码绝对完美，而且不需要的东西越少越好。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-30T15:16:28.373

使用标记（空）接口而不是基类：

```
public void SomeMethod<T> (T argument) where T : ISomeInterface 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T05:15:05.810

杰夫的回答+1。标记（“标记”）接口在 C# 和 Java 框架中都很常见。它们允许您为“A 类”分配一个通用类型，以便另一个类（“B 类”）可以不知道 A 类的具体类型。

与任何这种灵活的东西一样，它很容易被滥用，但在你的情况下，它肯定能满足要求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T15:24:07.560

也许一个更具体的例子会提供更多的视角。就目前而言，我会说您不应该以这种方式对课程进行分组。

您的 SomeMethod() 方法显然没有引用参数的任何属性（或者如果引用了，它也必须将参数转换为不同的类型）；“从你自己”保护代码的原因是什么？如果您要调用传递未批准对象的方法会发生什么？

如果参数约束是绝对必要的，我会像 Grybyx 那样推荐使用接口。这将使您免于多重继承问题。

# visual-studio - 显示具有不同背景颜色的代码段？

> ID：807404
> 
> 赞同：1
> 
> 时间：2009-04-30T15:09:02.480
> 
> 标签：visual-studio, visual-studio-2008

我们有一个生成源文件的工具，每个生成的文件都有几个部分，用户可以插入自己的代码。我们希望能够用不同于自动生成的背景颜色来标记这些部分。有没有办法在视觉工作室做到这一点？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T15:18:44.127

我不这么认为，你为什么不使用明显的分隔符注释？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T15:36:55.360

这是不可能的。为什么不使用部分类将生成的代码与用户代码分开？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T16:01:53.180

看起来答案是否定的。

[所以我在这里](https://stackoverflow.com/questions/807639/override-visual-studio-syntax-highlighting-through-a-plug-in)问了一个后续问题，关于能够通过插件覆盖 Visual Studio 的语法突出显示。

感谢您的回答！

# iphone - [UITableView reloadData] 是怎么回事？

> ID：807407
> 
> 赞同：22
> 
> 时间：2009-04-30T15:09:48.077
> 
> 标签：iphone, cocoa-touch, uitableview

我有一个具有 UITableView 的应用程序。这个 UITableView 由一个 NSMutableArray 填充（作为一个属性）在 appDelegate 中。您可以将其视为一个电子邮件窗口。它在子类 UITableViewCell 中列出消息。当出现新消息时，我完成了所有代码，下载消息，将数据添加到包含所有消息的 appDelegate 的 NSMutableArray。这段代码工作正常。

现在，一旦新消息被下载并添加到数组中，我将尝试使用以下代码更新我的 UITableView - UITableView 的委托函数不会被调用。

奇怪的是，当我上下滚动 UITableView 时，委托方法最终被调用并且我的部分标题确实发生了变化（它们显示了该部分的消息计数）。他们不应该实时更新而不是等待我的滚动触发刷新吗？此外，新单元格永远不会添加到该部分中！

请帮忙！！

**应用程序代码：**

```
[self refreshMessagesDisplay]; //This is a call placed in the msg download method

-(void)refreshMessagesDisplay{
    [self performSelectorOnMainThread:@selector(performMessageDisplay) withObject:nil waitUntilDone:NO];
}

-(void)performMessageDisplay{
    [myMessagesView refresh];
} 
```

**UITableViewController 代码：**

```
-(void) refresh{
    iPhone_PNPAppDelegate *mainDelegate = (iPhone_PNPAppDelegate *)[[UIApplication sharedApplication] delegate];

    //self.messages is copied from appDelegate to get (old and) new messages.
    self.messages=mainDelegate.messages;

    //Some array manipulation takes place here.

    [theTable reloadData];
    [theTable setNeedsLayout];  //added out of desperation
    [theTable setNeedsDisplay];  //added out of desperation
} 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-30T15:24:06.437

作为一个健全的检查，你是否验证了 theTable 在那一点上不是零？

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-11T15:49:41.470

您可以尝试延迟 reloadData 调用 - 当我尝试在重新排序单元格时更新我的​​ tableview 时遇到了类似的问题，除了如果我在此期间调用 reloadData 应用程序崩溃。

所以这样的事情可能值得一试：

刷新方法：

```
 - (void)refreshDisplay:(UITableView *)tableView {
    [tableView reloadData]; 
} 
```

然后以（比如说）0.5 秒的延迟调用它：

```
[self performSelector:(@selector(refreshDisplay:)) withObject:(tableView) afterDelay:0.5]; 
```

希望它有效...

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-11-16T04:35:39.303

如果您从分派的方法中调用 reloadData，请确保在主队列上执行它。

```
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND,0), ^(void) {

    // hard work/updating here

    // when finished ...
    dispatch_async(dispatch_get_main_queue(), ^(void) {
        [self.myTableView reloadData];
    }); 
}); 
```

..方法形式相同：

```
-(void)updateDataInBackground {
    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND,0), ^(void) {

        // hard work/updating here

        // when finished ...
        [self reloadTable];
    });
}

-(void)reloadTable {
       dispatch_async(dispatch_get_main_queue(), ^(void) {
            [myTableView reloadData];
        }); 
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T15:25:37.603

您是否尝试在刷新方法中设置断点，以确保在调用 reloadData 之前您的消息数组具有正确的内容？

# jquery - 在 ASP .NET MVC 中调用 Action 方法时在页面中心显示加载动画

> ID：807408
> 
> 赞同：27
> 
> 时间：2009-04-30T15:09:58.310
> 
> 标签：jquery

我的应用程序多次调用返回 Json 对象的 Action 方法 (ASP .NET MVC)。当应用程序等待此方法返回其数据时，我想在页面中心显示加载动画。我将如何做到这一点？我知道我应该使用 JQuery，但这就是我所知道的。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-05-02T06:16:16.550

我在 Site.Master 中定义了两个函数：

```
 <script type="text/javascript">
    var spinnerVisible = false;
    function showProgress() {
        if (!spinnerVisible) {
            $("div#spinner").fadeIn("fast");
            spinnerVisible = true;
        }
    };
    function hideProgress() {
        if (spinnerVisible) {
            var spinner = $("div#spinner");
            spinner.stop();
            spinner.fadeOut("fast");
            spinnerVisible = false;
        }
    };
</script> 
```

和特别部分：

```
 <div id="spinner">
        Loading...
    </div> 
```

视觉样式在 CSS 中定义：

```
div#spinner
{
    display: none;
    width:100px;
    height: 100px;
    position: fixed;
    top: 50%;
    left: 50%;
    background:url(spinner.gif) no-repeat center #fff;
    text-align:center;
    padding:10px;
    font:normal 16px Tahoma, Geneva, sans-serif;
    border:1px solid #666;
    margin-left: -50px;
    margin-top: -50px;
    z-index:2;
    overflow: auto;
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-30T19:49:38.950

您可以通过在请求之前显示一个 div（如果您想以模态方式执行此操作，您可以使用[blockUI](http://malsup.com/jquery/block/) - 或许多其他模态对话框插件之一）在请求之前等待，然后等待回调成功作为快速示例，您可以按如下方式使用 $.getJSON（如果要添加正确的错误处理，您可能需要使用 .ajax）

```
$("#ajaxLoader").show(); //Or whatever you want to do
$.getJSON("/AJson/Call/ThatTakes/Ages", function(result) {
    //Process your response
    $("#ajaxLoader").hide();
}); 
```

如果您在应用程序中多次执行此操作并希望集中所有 ajax 调用的行为，您可以使用全局 AJAX 事件：-

```
$("#ajaxLoader").ajaxStart(function() { $(this).show(); })
               .ajaxStop(function() { $(this).hide(); }); 
```

* * *

使用 blockUI 类似，例如标记如下：-

```
<a href="/Path/ToYourJson/Action" id="jsonLink">Get JSON</a>
<div id="resultContainer" style="display:none">
And the answer is:-
    <p id="result"></p>
</div>

<div id="ajaxLoader" style="display:none">
    <h2>Please wait</h2>
    <p>I'm getting my AJAX on!</p>
</div> 
```

并使用 jQuery:-

```
$(function() {
    $("#jsonLink").click(function(e) {
        $.post(this.href, function(result) {
            $("#resultContainer").fadeIn();
            $("#result").text(result.Answer);
        }, "json");
        return false;
    });
    $("#ajaxLoader").ajaxStart(function() {
                          $.blockUI({ message: $("#ajaxLoader") });
                     })
                    .ajaxStop(function() { 
                          $.unblockUI();
                     });
}); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2018-08-08T14:09:18.537

与此处已经公开的解决方案类似的另一种解决方案是这个。在结束 body 标记之前放置这个 html：

```
<div id="resultLoading" style="display: none; width: 100%; height: 100%; position: fixed; z-index: 10000; top: 0px; left: 0px; right: 0px; bottom: 0px; margin: auto;">
    <div style="width: 340px; height: 200px; text-align: center; position: fixed; top: 0px; left: 0px; right: 0px; bottom: 0px; margin: auto; z-index: 10; color: rgb(255, 255, 255);">
        <div class="uil-default-css">
            <img src="/images/loading-animation1.gif" style="max-width: 150px; max-height: 150px; display: block; margin-left: auto; margin-right: auto;" />
        </div>
        <div class="loader-text" style="display: block; font-size: 18px; font-weight: 300;">&nbsp;</div>
    </div>
    <div style="background: rgb(0, 0, 0); opacity: 0.6; width: 100%; height: 100%; position: absolute; top: 0px;"></div>
</div> 
```

最后，在每个导航事件上动态替换`.loader-text element's`内容并打开`#resultloading`div，注意它最初是隐藏的。

```
var showLoader = function (text) {
    $('#resultLoading').show();
    $('#resultLoading').find('.loader-text').html(text);
};

jQuery(document).ready(function () {
    jQuery(window).on("beforeunload ", function () {
        showLoader('Loading, please wait...');
    });
}); 
```

这可以应用于任何使用 jQuery 的基于 html 的项目，您不知道管理区域的哪些页面需要很长时间才能完成加载。

gif 图像为 176x176px，但您可以使用任何透明的 gif 动画，请注意图像大小并不重要，因为它将最大为 150x150px。

此外，可以在单击元素时调用函数 showLoader 以执行将进一步重定向页面的操作，这就是为它提供单个函数的原因。我希望这也可以帮助任何人。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-05-24T12:04:56.443

这就是它的魅力所在。

## CSS

```
#loader {
position:fixed;
left:1px;
top:1px;
width: 100%;
height: 100%;
z-index: 9999;

background: url('../images/ajax-loader100X100.gif') 50% 50% no-repeat rgb(249,249,249);
} 
```

* * *

在body标签内但在容器div之外的_layout文件中。每次页面加载时，它都会显示加载。页面加载后 JS 淡出（秒）

* * *

```
<div id="loader">
</div> 
```

* * *

_layout 文件底部的 JS

* * *

```
<script type="text/javascript">
// With the element initially shown, we can hide it slowly:
 $("#loader").fadeOut(1000);
</script> 
```

# nhibernate - NHibernate: how to map a Point?

> ID：807413
> 
> 赞同：3
> 
> 时间：2009-04-30T15:10:47.780
> 
> 标签：nhibernate

I have a class which contains a collection of Points (PointF's rather).

I want to be able to persist instances of that class using NHibernate.

My class looks somewhat like this (simplified):

```
public class MyClass
{
    public IDictionary<string, PointF> Points = new Dictionary<string, PointF>();

    public void AddPoint( location, PointF position )
    {
        Points.Add(location, position);
    }
} 
```

The mapping of this collection looks like this (simplified):

```
<map name="Points" table="Locations">
   <key column="MyClassId" />
   <index column="LocationName" />
   <composite-element class="System.Drawing.PointF, System.Drawing">
      <property name="X" column="X" />
      <property name="Y" column="Y" />
   </composite-element>
</map> 
```

The problem now is, that NHibernate throws an error while processing the mapping file, since PointF is not a known (mapped) entity.

How can I solve this in the most simple way ? How can I make sure that NHibernate is able to persist my collection of locations (with their coordinates (point) ?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-21T09:11:56.593

问题不在于您没有映射类型`PointF`- 因为您将其映射为复合元素，这是正确的。

映射此类类型时，您需要确保

*   属性是可写的（幸运的是这里的情况）
*   它有一个默认构造函数，这里不是这种情况。

那么在没有默认构造函数的情况下，NH 应该如何创建新的实例呢？它不能。

您的选择是：

*   实现拦截器或 NH 事件。我认为可以在那里注入创建某些类型实例的代码，但我不知道如何。
*   实现一个 NH 用户类型（派生自`ICompositeUserType`），这并不难
*   映射另一种类型（例如，将包装器映射到 PointF）

# asp.net-mvc - ASP.NET MVC 是否需要 IIS？

> ID：807414
> 
> 赞同：8
> 
> 时间：2009-04-30T15:11:00.853
> 
> 标签：asp.net-mvc, iis, requirements

ASP.NET MVC 是否需要 IIS？我可以在没有安装 IIS 的客户端机器上开发一个使用新的 ASP.NET MVC 框架的应用程序吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-30T15:35:38.017

根据我在 Mono 站点[站点链接](http://www.mono-project.com/news/archive/2009/Apr-16.html)上阅读的内容，您还可以使用 Apache 网络服务器在 Mono 下运行 asp.net MVC 站点。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-30T15:21:44.273

在客户端机器上只需要一个浏览器。

[根据下载页面](http://www.asp.net/mvc/download/)，开发者机器上不需要 IIS 。

Visual Web Developer 2008 Express 或 Visual Studio 的普通版将包括用于开发的 Cassini Web 服务器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T16:13:52.713

我想您要问的是，如果您要开发 ASP.NET MVC 应用程序，您需要在本地开发机器上运行 IIS 吗？

答案是，不，你没有。

简而言之，ASP.NET MVC 在技术上可以由任何允许网站本身处理请求而不是处理请求的 Web 服务器的 Web 服务器运行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T15:19:09.897

您需要 IIS 才能使 ASP.NET 正常工作（MVC 或 WebForms）。据我所知，为 MVC 安装 IIS 7 是理想的，但使用 IIS 6 是可能的。

使用与 VS 2008 集成的内置 Web 服务器（如前所述），可以在没有 IIS 的情况下开发 MVC 应用程序，但是对于部署，那就是当您需要 IIS 时。

# css - 具有类 .a 和类 .b 的元素的 CSS 选择器

> ID：807415
> 
> 赞同：32
> 
> 时间：2009-04-30T15:11:01.773
> 
> 标签：css, css-selectors

我需要设计一个同时具有 class`.a`和 class的元素`.b`。我该怎么做？

类出现在 HTML 中的顺序可能会有所不同。

```
<style>
    div.a ? div.b {
        color:#f00;
    }
</style>
<div class="a">text not red</div>
<div class="b">text not red</div>
<div class="a b">red text</div>
<div class="b a">red text</div> 
```

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-04-30T15:18:33.580

这是完全可能的。如果您在一个元素上指定两个类（没有任何空格），则意味着它必须同时具有两个类才能应用该规则。

```
div.a {
  color: blue;
}
div.b {
  color: green;
}
div.a.b {
  color: red;
}
```

```
<div class="a">
  A
</div>
<div class="b">
  B
</div>
<div class="a b">
  AB
</div>
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-30T15:20:20.597

类选择器可以组合：

```
div.a.b {
  color: red;
} 
```

引用[规范](http://www.w3.org/TR/CSS2/selector.html#class-html)：

> 要匹配“类”值的子集，每个值必须以“.”开头。
> 
> 例如，以下规则匹配任何 P 元素，其“类”属性已被分配一个空格分隔的值列表，其中包括“田园”和“海洋”：
> 
> ```
> p.marine.pastoral { color: green } 
> ```
> 
> 此规则匹配 when`class="pastoral blue aqua marine"`但不匹配 for `class="pastoral blue"`。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-30T15:24:21.227

```
div[class~="a"][class~="b"] {
    color: #f00;
} 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2015-02-20T09:05:56.937

```
/* select div tag having class a and b together */
<style>
div.a.b
{ 
    color:#f00;
}
</style>
<div class="a">text not red</div>
<div class="b">text not red</div>
<div class="a b">red text</div>
<div class="b a">red text</div> 
```

* * *

## 回答 #5

> 赞同：-5
> 
> 时间：2009-04-30T15:15:45.927

是的，如果内容动态变化，请使用通用类，或者为什么不使用 JavaScript

# java - Simplest way to query XML in Java

> ID：807418
> 
> 赞同：21
> 
> 时间：2009-04-30T15:11:12.850
> 
> 标签：java, xml

I have small Strings with XML, like:

```
String myxml = "<resp><status>good</status><msg>hi</msg></resp>"; 
```

which I want to query to get their content.

What would be the simplest way to do this?

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-04-30T15:27:06.460

[XPath](http://java.sun.com/javase/6/docs/api/javax/xml/xpath/package-summary.html)使用 Java 1.5 及更高版本，没有外部依赖：

```
String xml = "<resp><status>good</status><msg>hi</msg></resp>";

XPathFactory xpathFactory = XPathFactory.newInstance();
XPath xpath = xpathFactory.newXPath();

InputSource source = new InputSource(new StringReader(xml));
String status = xpath.evaluate("/resp/status", source);

System.out.println("satus=" + status); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-06T20:33:08.407

使用[dom4j](http://www.dom4j.org/)，类似于[McDowell 的解决方案](https://stackoverflow.com/questions/807418/simplest-way-to-query-xml-in-java/807508#807508)：

```
String myxml = "<resp><status>good</status><msg>hi</msg></resp>";

Document document = new SAXReader().read(new StringReader(myxml));
String status = document.valueOf("/resp/msg");

System.out.println("status = " + status); 
```

使用 dom4j 处理 XML 稍微简单一些。[并且存在](https://stackoverflow.com/questions/130095/most-useful-free-java-libraries)其他几个类似的 XML 库。[这里讨论了](https://stackoverflow.com/questions/831865/what-java-xml-library-do-you-recommend-to-replace-dom4j)dom4j 的替代方案。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-05-06T20:38:17.240

以下是如何使用[XOM](http://www.xom.nu)执行此操作的示例：

```
String myxml = "<resp><status>good</status><msg>hi</msg></resp>";

Document document = new Builder().build(myxml, "test.xml");
Nodes nodes = document.query("/resp/status");

System.out.println(nodes.get(0).getValue()); 
```

比起 dom4j，我更喜欢 XOM，因为它的[简单性和正确性](http://www.xom.nu/designprinciples.xhtml)。即使您愿意，XOM 也不会让您创建无效的 XML；-)（例如，在字符数据中使用非法字符）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-30T15:19:10.833

你可以试试[JXPath](http://commons.apache.org/jxpath/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-06T12:55:13.310

在您完成了在 java 中查询 XML 的简单方法之后。看看 XOM。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-06T21:02:29.317

@这个 [答案](https://stackoverflow.com/questions/807418/simplest-way-to-query-xml-in-java/807508#807508)的评论：

你可以创建一个方法让它看起来更简单

```
String xml = "<resp><status>good</status><msg>hi</msg></resp>";

System.out.printf("satus= %s\n", getValue("/resp/status", xml ) ); 
```

实施：

```
public String getValue( String path, String xml ) { 
    return XPathFactory
               .newInstance()
               .newXPath()
               .evaluate( path , new InputSource(
                                 new StringReader(xml)));

} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-30T15:21:09.160

将此字符串转换为 DOM 对象并访问节点：

```
Document dom= DocumentBuilderFactory().newDocumentBuilder().parse(new InputSource(new StringReader(myxml)));
Element root= dom.getDocumentElement();
for(Node n=root.getFirstChild();n!=null;n=n.getNextSibling())
 {
 System.err.prinlnt("Current node is:"+n);
 } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-12-19T00:05:25.327

[这是使用VTD-XML](http://vtd-xml.sf.net)查询 XML 的代码片段

```
import com.ximpleware.*;
public class simpleQuery {

    public static void main(String[] s) throws Exception{
        String myXML="<resp><status>good</status><msg>hi</msg></resp>";
        VTDGen vg = new VTDGen();
        vg.setDoc(myXML.getBytes());
        vg.parse(false);
        VTDNav vn = vg.getNav();
        AutoPilot ap = new AutoPilot(vn);
        ap.selectXPath("/resp/status");
        int i = ap.evalXPath();
        if (i!=-1)
            System.out.println(" result ==>"+vn.toString(i));
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-03-13T11:24:02.130

您可以使用[Jerry](https://jodd.org/jerry/)来查询类似于 jQuery 的 XML。

```
jerry(myxml).$("status") 
```

# wpf - 如何将效果应用于边框但不应用于 WPF 中的内容？

> ID：807420
> 
> 赞同：12
> 
> 时间：2009-04-30T15:11:19.307
> 
> 标签：wpf, border

我有一个 WPF 应用程序，它有一个带有边框的 3rd 方数据网格。我已经使用了`DropShadowEffect`在边框后面放置阴影，但这似乎会在一定程度上影响性能（几乎没有 a 影响`BitmapEffect`，但仍然很明显）并使字体渲染变得模糊。有没有办法以某种方式将效果应用于边框，而不是其内容？

我尝试将内容上的效果设置为`{x:Null}`，但这没有帮助。

这是我想出的示例应用程序。它在边框后面加上一个阴影，但它也在每一行文本后面加上一个阴影。我想要边框后面的阴影，而不是文字。

```
<Window x:Class="WpfEffectTest.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
    <Grid>
        <Border BorderBrush="Black" BorderThickness="10" CornerRadius="5" Margin="25">
            <Border.Effect>
                <DropShadowEffect BlurRadius="10" ShadowDepth="5" />
            </Border.Effect>
            <StackPanel>
                <TextBlock>This is some text</TextBlock>
                <TextBlock>This is some text</TextBlock>
                <TextBlock>This is some text</TextBlock>
                <TextBlock>This is some text</TextBlock>
                <TextBlock>This is some text</TextBlock>
                <TextBlock>This is some text</TextBlock>
            </StackPanel>
        </Border>

    </Grid>
</Window> 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-30T17:39:14.600

来自 gcores 的链接给出了答案，就是将边框及其内容放在同一个网格中，以便内容覆盖边框。

```
<Window x:Class="WpfEffectTest.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
    <Grid>
        <Border BorderBrush="Black" BorderThickness="10" CornerRadius="5" Margin="25">
            <Border.Effect>
                <DropShadowEffect BlurRadius="10" ShadowDepth="5" />
            </Border.Effect>
        </Border>
        <StackPanel Margin="35">
            <TextBlock>This is some text</TextBlock>
            <TextBlock>This is some text</TextBlock>
            <TextBlock>This is some text</TextBlock>
            <TextBlock>This is some text</TextBlock>
            <TextBlock>This is some text</TextBlock>
            <TextBlock>This is some text</TextBlock>
        </StackPanel>
    </Grid>
</Window> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-30T16:12:49.237

一个简单的（黑客？）解决方案是

```
<StackPanel Background="White"> 
```

这应该解决带有阴影问题的文本（虽然不确定性能问题）。问题是 WPF 将效果应用于 set 元素及其在可视树中的所有子元素。这个链接解释得更好： [DropShadowEffect 性能问题](http://social.expression.microsoft.com/Forums/en-US/wpf/thread/7d21c0a0-b638-46a3-9f5e-08dfd97228d3/)

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2016-05-27T08:03:09.997

为所有 TextBlocks 尝试以下块（或类似块）：

```
<TextBlock>
    <TextBlock.Effect>
        <DropShadowEffect BlurRadius="30" ShadowDepth="5" Color="White"/>
    </TextBlock.Effect>
</TextBlock> 
```

# .net - WPF - 如何制作绘制方格纸状正方形的画笔？

> ID：807428
> 
> 赞同：20
> 
> 时间：2009-04-30T15:12:28.587
> 
> 标签：.net, wpf, grid, brush

我如何创建一个画笔来绘制一个规则的、重复的 1 单位粗线网格，在水平轴和垂直轴上均匀分布？想象一下方格纸，如果你愿意的话。

理想情况下，该解决方案将允许控制用于线条和背景（正方形内的区域）的画笔。通过这种方式，背景可以是透明的，因此网格可以用作叠加层。

**编辑**这是一张显示汤姆回答结果的图像：

![](https://i.imgur.com/OE0GL.png)

在本例中，使用网格来合成三层以显示网格是真正透明的。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-30T17:56:22.997

来自[http://msdn.microsoft.com/en-us/library/aa480159.aspx](http://msdn.microsoft.com/en-us/library/aa480159.aspx)

```
<DrawingBrush Viewport="0,0,10,10" 
              ViewportUnits="Absolute"
              TileMode="Tile">
  <DrawingBrush.Drawing>
    <DrawingGroup>
      <GeometryDrawing Geometry="M0,0 L1,0 1,0.1, 0,0.1Z" Brush="Green" />
      <GeometryDrawing Geometry="M0,0 L0,1 0.1,1, 0.1,0Z" Brush="Green" />
    </DrawingGroup>
  </DrawingBrush.Drawing>
</DrawingBrush> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T15:45:39.240

使用画笔。绘图可以包含形状、图像、文本和媒体。

下面的示例使用 DrawingBrush 绘制矩形的填充。

```
Rectangle exampleRectangle = new Rectangle();
exampleRectangle.Width = 75;
exampleRectangle.Height = 75;

// Create a DrawingBrush and use it to
// paint the rectangle.
DrawingBrush myBrush = new DrawingBrush();

GeometryDrawing backgroundSquare =
    new GeometryDrawing(
        Brushes.White,
        null,
        new RectangleGeometry(new Rect(0, 0, 100, 100)));

GeometryGroup aGeometryGroup = new GeometryGroup();
aGeometryGroup.Children.Add(new RectangleGeometry(new Rect(0, 0, 50, 50)));
aGeometryGroup.Children.Add(new RectangleGeometry(new Rect(50, 50, 50, 50)));

LinearGradientBrush checkerBrush = new LinearGradientBrush();
checkerBrush.GradientStops.Add(new GradientStop(Colors.Black, 0.0));
checkerBrush.GradientStops.Add(new GradientStop(Colors.Gray, 1.0));

GeometryDrawing checkers = new GeometryDrawing(checkerBrush, null, aGeometryGroup);

DrawingGroup checkersDrawingGroup = new DrawingGroup();
checkersDrawingGroup.Children.Add(backgroundSquare);
checkersDrawingGroup.Children.Add(checkers);

myBrush.Drawing = checkersDrawingGroup;
myBrush.Viewport = new Rect(0, 0, 0.25, 0.25);
myBrush.TileMode = TileMode.Tile;

exampleRectangle.Fill = myBrush; 
```

来源：[MSDN：WPF 画笔概述](http://msdn.microsoft.com/en-us/library/aa970904.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T15:47:51.077

您可以使用 VisualBrush 在 XAML 中执行此操作。作为为您提供起点的示例，[这里有一篇](http://mark-dot-net.blogspot.com/2007/06/creating-hatched-patterned-brush-in-wpf.html)使用 VisualBrush 创建阴影画笔的博客文章。它非常接近网格 - 并且很容易转换。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-12T20:51:49.743

我使用了一个 16x16 位图，左边缘和下边缘为黑色。然后在我的窗口中，我将背景设置为使用它，平铺。这是 XAML（稍作改动以显示）。

```
<Window.Background>
  <ImageBrush ImageSource="/GraphPaper;component/Background.bmp"
              Stretch="None" TileMode="Tile"
              Viewport="0,0,16,16" ViewportUnits="Absolute" />
</Window.Background> 
```

# ms-access-2007 - MS Access 2007 - 半自动编号

> ID：807440
> 
> 赞同：0
> 
> 时间：2009-04-30T15:16:25.190
> 
> 标签：ms-access-2007

我正在构建自己的 CRM 访问数据库，其中包含联系人列表。我想有一个机会引用一个联系人作为员工，另一个联系人作为客户。有没有一种方法可以使用员工的内部用户 ID（始终为 4 位）和自动编号客户联系人来添加员工？

在我对表格视图中的所有内容都正常工作感到满意之前，我不打算构建表单。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T15:41:52.120

您不能将 ID 分配给自动编号字段。我可能会建议在您的联系人表中添加一个包含员工 ID 号的员工 ID 字段。联系人 ID 仍然是自动编号，因此实质上他们将有两个 ID，但他们的员工 ID 需要存储在不同的字段中。

您可以尝试不同的方法，但您可能会在某个时候遇到重复的 ID。为自动编号客户 ID 使用单独的表格。将客户添加到您的联系人表中时，您将新记录“插入”到单独的客户 ID 表中以获取自动编号 ID。如果您要插入员工，只需使用 EmployeeID 作为联系人 ID。因此，在混合两个 ID 系统时需要非常小心。最好使用 1 个 ID，然后在其他字段中使用另一个 ID。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T16:15:51.070

考虑使用两个表，一个用于联系人字段，另一个用于员工特定字段。将您的自动编号字段放入联系人表中，并将员工 ID 放入员工表中。在员工表中，使用引用联系人表中自动编号字段的外键。

# open-source - 开源物理引擎

> ID：807445
> 
> 赞同：15
> 
> 时间：2009-04-30T15:17:29.230
> 
> 标签：open-source, physics

过去几周我一直在使用[开放动态引擎 (ODE) ，并取得了巨大成功。](http://www.ode.org/)它有一个非常简单的 API，它的模拟至少*看起来很*逼真。（我有时想知道我的碰撞关节参数，但无论如何。）

我唯一的抱怨是它有时是一只狗。如果我天真地模拟 1000 多个相互作用的物体，那么我的表现就会开始下降。

我知道我可以花时间研究他们的空间网格来减少碰撞系统的负载，但是在我努力调整我的代码以使用 ODE 之前，我想知道是否还有**其他值得一看的开源/免费物理引擎在**. 这将是一个商业应用程序，所以我正在寻找比一些大学生的周末项目更可靠、更久经考验的东西。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-30T15:24:50.943

构建一个快速、准确和*稳定*的求解器非常棘手，像 Havok 这样的人对这项技术的保护是可以理解的。也就是说，我知道的免费系统是：

*   **Newton Game Dynamics——**这个以牺牲性能为代价拥有一个非常准确和稳定的求解器而闻名。在过去的几年里，它一直在努力在不牺牲其他两个方面的情况下获得性能。它是一个设计良好的引擎，运行良好，但它仍然是速度较慢的引擎之一。不是开源的。
*   **托卡马克**——恰恰相反。这个太可怕了；甚至他们的演示也不能稳定运行。只需拉起他们的堆叠箱，您就会看到巨大的抖动。我从来没有印象深刻。不过，它是开源的，而且速度非常快。
*   **Bullet——**这个是由前 Havok 员工领导的，他现在受雇于 Sony（虽然我不记得那是 SOE 还是 SCEA）。这是现场的新手，它实际上是开源的。它得到了索尼的大力支持，它很好地跨平台，而且它是由知道自己在做什么的人开发的。
*   **TrueAxis——**最近出现在现场。我对此知之甚少，它并没有真正获得一个实质性的社区。我在这里倾向于持怀疑态度。它可能写得很好，但在一个小社区的帮助下可能很难获得，而且与其他引擎相比，它可能不是一个经过良好测试和稳定的引擎。

我自己是 Bullet 的忠实粉丝，但我听到了一些关于它的杂项投诉。他们中的大多数似乎都集中在糟糕的文档上，或者在一些辅助平台（如 Mac）上偶尔出现问题。在“Big 2”、Havok 和 PhysX 之后，它仍然是我的选择。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-30T15:21:15.820

[Bullet](http://www.continuousphysics.com)非常棒，并且已经在商业上使用（例如：在 Bolt 的制作中，以及一些 PS3/Wii 游戏中）支持许多平台，甚至 nVidia 的 CUDA。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-30T15:23:31.057

[Bullet](http://code.google.com/p/bullet/)可免费用于商业用途，并提供资源。

文档可能会更好，但是有一个论坛和一些示例可以在入门时提供帮助。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-30T15:30:59.570

使用今天的硬件，如果你天真地在 x86 CPU 上模拟 1000 个交互刚体，性能毫无例外地开始下降。如果您现在想要更高的性能，那么最好寻找将工作负载转移到 GPU 的物理引擎。

CPU 具有强大的整数数学和逻辑处理能力，但 GPU 具有更强大的原始浮点计算能力。

如果您仍然希望仅通过使用 CPU 来获得更高的性能，那么您将需要更改您的要求。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-30T15:24:45.593

Farseer非常好。

[http://www.codeplex.com/FarseerPhysics](http://www.codeplex.com/FarseerPhysics)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-30T16:28:22.960

Nvidia的[PhysX](http://en.wikipedia.org/wiki/PhysX)不是**开源**的，但**可免费用于 Windows、Linux 和 PS3**。

引自[http://en.wikipedia.org/wiki/PhysX](http://en.wikipedia.org/wiki/PhysX)：

> Nvidia 向 Windows 和 Linux 用户和开发人员免费提供引擎和 SDK [6]。由于索尼的一揽子购买协议，PlayStation 3 SDK 也可以免费获得。

# api - 如何保护 Flex/AIR 中的 API Key 不被反编译？

> ID：807447
> 
> 赞同：1
> 
> 时间：2009-04-30T15:18:08.213
> 
> 标签：api, security, apache-flex, air, api-key

请不要混淆，越简单越好。

类似的帖子是[在 Ajax Adob​​e AIR 应用程序中与 API 共享机密，](https://stackoverflow.com/questions/294777/shared-secret-with-api-in-an-ajax-adobe-air-app)但我不相信这些可以防止反编译。如果他们这样做，请解释（例如，是什么阻止了某人自己反编译和使用 URLLoader）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-01T11:42:17.973

如果公钥在您的代码中，则没有任何东西可以阻止任何人反编译您的应用程序并获取密钥。

此外 - 如果密钥未加密地从 AIR 应用程序发送到服务器，那么监控网络流量并从那里检索密钥是小菜一碟。因此，即使您通过加密存储密钥来保护密钥，您也几乎被搞砸了。

如果您想保护它，您必须通过您控制的代理服务器发送呼叫并将密钥保存在那里。

# c# - 流畅的接口/扩展方法——将平面列表变成导航树

> ID：807449
> 
> 赞同：1
> 
> 时间：2009-04-30T15:18:33.267
> 
> 标签：c#, tree, extension-methods, fluent, fluent-interface

我目前有一个扩展方法，它将 Tab 类型的 IEnumerable 转换为 TabNode 的分层集合。

```
// If Tab has no parent its ParentId is -1

public class Tab
{
public int TabId { get; set; }
    public string TabName { get; set; }
    public int Level { get; set; }
    public int ParentId { get; set; }

}

public class TabNode
{
    public TabInfo Tab { get; set; }
    public IEnumerable<TabNode> ChildNodes { get; set; }
    public int Depth { get; set; }
} 
```

例如，以下将为您提供一组 TabNodes，它们位于 TabId 为 32 的父级以下 - 最大深度级别为 4。

```
IEnumerable<Tab> tabs = GetTabs();

IEnumerable<TabNode> = tabs.AsNavigationHierarchy(32,4); 
```

这很令人困惑，并且对进一步细化不是很友好。如果我想指定某个级别而不是 ParentID，该怎么办？

我想做的是这样的：

```
IEnumerable<TabNode> = tabs.AsNavigationHierarchy().WithStartLevel(2).WithMaxDepth(5) 
```

我被困在如何优雅地做到这一点。你能帮助我吗？

这是我当前的函数，由我的扩展方法调用（基于我在[www.scip.be](http://www.scip.be/index.php?Page=ArticlesNET23&Lang=EN)上找到的一篇文章）。

```
 private static IEnumerable<TabNode>
      CreateHierarchy(
        IEnumerable<TabInfo> tabs,
        int startTabId,
        int maxDepth,
        int depth)
    {
        IEnumerable<TabInfo> children;

            children = tabs.Where(i => i.ParentId.Equals(startTabId));

        if (children.Count() > 0)
        {
            depth++;

            if ((depth <= maxDepth) || (maxDepth == 0))
            {
                foreach (var childTab in children)
                    yield return
                      new TabNode()
                      {
                          Tab = childTab,
                          ChildNodes =
                            CreateHierarchy(tabs, childTab.TabID, maxDepth, depth),
                          Depth = depth
                      };
            }
        }
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T15:23:20.837

tabs.AsNavigationHeirachy 可以返回一个 HerirchyQuery 对象，您的下一个扩展方法将期望该对象。这将使您可以将它们链接在一起。

# java - 我想最小化@Transactional 的范围吗？

> ID：807457
> 
> 赞同：2
> 
> 时间：2009-04-30T15:19:12.703
> 
> 标签：java, spring, jpa, transactions, annotations

不确定“范围”是否是正确的术语。

我正在使用 Spring 进行 JPA 事务管理（下面有一个 Hibernate）。我执行数据库事务的方法是私有的，但是因为您只能在类或[公共方法上设置 @Transactional](http://static.springframework.org/spring/docs/2.0.x/reference/transaction.html)

> 由于这种机制是基于代理的，只有通过代理传入的“外部”方法调用才会被拦截。这意味着“自调用”，即目标对象中的一个方法调用目标对象的其他方法，即使调用的方法标有@Transactional，也不会在运行时导致实际事务！

我已将类的公共入口点设置为@Transactional。

```
@Transactional
public void run(parameters) {
    //First non-database method, takes a decent amount of time
    Data data = getData();
    //Call to database
    storeData(data);
}

private storeData(data) {
    em.persist(data);
} 
```

这是不好的做法吗？Spring 是否保持开放事务的时间比这里需要的时间更长？我正在考虑将 storeData() 方法移至 DAO 类并将其公开，但作为学术观点，我想知道重构为 public 是否会对性能产生任何好处。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T15:23:14.957

如果数据库上存在大量争用，那么保持事务尽可能小绝对是至关重要的——比公共与私有区别重要得多，后者本身不会影响性能和可伸缩性。所以，要实际...！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T15:23:46.563

在您的代码执行与事务上下文交互的操作之前，事务范围无效，在本例中为 storeData() 方法。getData() 是非事务性的这一事实不应影响代码的并发性能，因为任何数据库锁定只会在达到 storeData() 时发生。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-09-10T10:34:12.897

正如每个人都指出的那样，我们应该使事务尽可能小，以便连接仍然可用于其他请求。可以这样重构吗

```
public void run(parameters) {
  Data data = getData();
  storeData(data);                                                             
 }

@Transactional
public storeDate(data){em.persist(data)} 
```

# linq - 使用 LINQ to SQL 和链式替换

> ID：807463
> 
> 赞同：2
> 
> 时间：2009-04-30T15:20:42.733
> 
> 标签：linq, linq-to-sql, replace

我需要在查询中用其他字符串替换多个字符串

```
from p in dx.Table
where p.Field.Replace("A", "a").Replace("B", "b").ToLower() = SomeVar
select p 
```

它提供了一个很好的带有相关 REPLACE() sql 命令的单个 SQL 语句。

都好 ：）

我需要在应用程序的一些查询中执行此操作......所以我正在寻找这方面的一些帮助；这将像上面一样作为服务器上的单个 SQL 命中/命令工作

环顾四周，我似乎无法使用 RegEx，因为没有 SQL eq

作为一个 LINQ 新手，我有什么好方法可以做到这一点吗？

例如，是否有可能将其作为 IQueryable“var 结果”表示并将其传递给函数以添加所需的 .Replace() 并传回？如果是这样，我可以举一个简单的例子吗？

编辑：这似乎工作！看起来会是个问题吗？

```
var data = from p in dx.Videos select p;
data = AddReplacements(data, checkMediaItem);
theitem = data.FirstOrDefault(); 
```

...

```
public IQueryable<Video> AddReplacements(IQueryable<Video> DataSet, string checkMediaItem)
{
    return DataSet.Where(p =>
            p.Title.Replace(" ", "-").Replace("&", "-").Replace("?", "-") == checkMediaItem);
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-01T17:55:00.700

反转您在此处尝试执行的操作会不会更高效，即重新格式化您要检查的字符串而不是重新格式化数据库中的数据？

```
public IQueryable<Video> AddReplacements(IQueryable<Video> DataSet, string checkMediaItem)
{
    var str = checkMediaItem.Replace("-", "?").Replace("&", "-").Replace("-", " "));
    return DataSet.Where(p => p.Title == str);
} 
```

因此，您现在将数据库中的字段与设定值进行比较，而不是扫描表并转换每一行中的数据并进行比较。

# python - Django m2m 查询，模型的 m2m 关系的不同用户

> ID：807470
> 
> 赞同：1
> 
> 时间：2009-04-30T15:21:37.143
> 
> 标签：python, django, orm, m2m

我有一个带有 m2m 字段的模型模型：

```
user = .. fk user
...
watchers = models.ManyToManyField(User, related_name="boardShot_watchers",  null=True) 
```

我如何为我所有类型为 Model 的条目选择参与此观察者关系的所有不同用户？

我不认为有访问中间 M2M 表的 ORM 方式。

格雷格

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T15:37:33.050

不在您当前的模型中。如果您想显式访问连接表，则需要使其成为 Django 对象模型的一部分。文档解释了如何做到这一点：

[http://www.djangoproject.com/documentation/models/m2m_intermediary/](http://www.djangoproject.com/documentation/models/m2m_intermediary/)

admin 和其他 django.contrib* 组件可以配置为将大多数字段视为 model.ManyToMany 的一样。但这需要一些配置。

# reflection - 反思：仅适用于框架？

> ID：807474
> 
> 赞同：2
> 
> 时间：2009-04-30T15:22:21.027
> 
> 标签：reflection, metaprogramming

曾经与我一起工作并尊重的人曾对我说，在应用程序代码中不需要使用反射，它应该只在框架中使用。他说的是 J2EE 背景，而我在该平台的专业经验通常证明了这一点。尽管我曾经使用 Java 编写过一次或两次反射应用程序代码。

我对 Ruby on Rails 的体验完全不同，因为 Ruby 非常鼓励您编写动态代码。如果没有反射和元编程，Rails 为您提供的大部分功能根本不可能实现，并且许多相同的技术同样适用于您的应用程序代码并很有用。

*   您是否同意反射仅适用于框架的观点？我很想听听您的意见和经验。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T18:14:10.273

有一个老笑话，任何用静态类型语言编写的足够复杂的系统都包含一个不完整的、低劣的 Lisp 实现。

由于随着项目的发展，您的需求往往会变得更加复杂，因此您通常最终会发现静态类型对象系统中的常见习语最终会碰壁。有时寻求反思是最好的解决方案。

我对像 Ruby 这样的动态类型语言和像 C# 这样的静态类型语言很满意，但是 Ruby 中的隐式反射通常会使代码更简单、更容易阅读。（取决于所需的元编程魔法，有时更难编写）。

在 C# 中，我发现了不通过反射就无法解决的问题，因为直到运行时我才拥有信息。一个例子：当试图操作一些第三方代码生成代理到运行在另一个进程中的 Silverlight 对象时，我不得不使用反射来调用一个特定的强类型“通用”版本的方法，因为编组需要调用者假设其他进程中对象的类型是为了从中提取我们需要的数据，而 C# 不允许在运行时指定泛型方法调用的“类型”（反射除外技术）。我想你可能会说我们的工具是一种框架，但我可以很容易地想象一个普通应用程序中面临类似问题的案例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T18:27:27.620

反射使 DRY 更容易。当然可以编写没有反射的 DRY 代码，但它通常更冗长。

如果某些信息以一种方式编码在我的程序中，如果这是最简单的方法，我为什么*不*使用反射来获取它？

听起来他是在专门谈论 Java。在这种情况下，他只是引用了一个特例：在 Java 中，反射是如此的不稳定，它几乎从来都不是做某事的最简单方法。:-) 如您所见，在 Ruby 等其他语言中，通常是这样。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T18:50:49.123

反射肯定在框架中大量使用，但如果使用得当，可以帮助简化应用程序中的代码。

我之前见过的一个例子是使用一个大型接口（20 多种方法）的 JDK 代理来包装（即委托给）一个特定的实现。使用 InvocationHandler 仅覆盖了几个方法，其余方法通过反射调用。

反射可能很有用，但它比执行常规方法调用要慢。请参阅此[反射比较](http://www.jguru.com/faq/view.jsp?EID=246569)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-01T02:31:53.883

Java 中的反射通常不是必需的。这可能是解决某个问题的最快方法，但我宁愿解决导致您认为在应用程序代码中必要的潜在问题。我相信这一点，因为它经常将错误从编译时推到运行时，这对于足够大的软件来说总是一件坏事，以至于测试不是微不足道的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T15:25:17.683

我不同意，我的应用程序使用反射来动态创建提供程序。如果逻辑很简单并且不需要更复杂的模式，我也可以使用反射来控制逻辑流。

在 C# 中，我使用反射从枚举中获取属性，这有助于我确定如何向最终用户显示枚举。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T15:44:12.987

我不同意，反射在应用程序代码中非常有用，我发现自己经常使用它。最近，我不得不使用反射仅从程序集的路径加载程序集（以调查其公共类型）。

这里表达了关于这个主题的几种观点......

[什么是反射，它为什么有用？](https://stackoverflow.com/questions/37628/what-is-reflection-and-why-is-it-useful)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T15:58:49.053

没有其他方法时使用反射！这是性能问题！

如果您以前研究过 .NET 性能缺陷，那么正常反射的速度可能不会让您感到惊讶：重复访问 int 属性的简单测试证明，与直接访问属性相比，使用反射要慢约 1000 倍（比较测量时间的中位数 80% 的平均值）。

看到这个：[.NET 反射 - 性能](http://www.spielwerke.com/www/content/view/64/47/)

MSDN 有一篇非常好的文章，关于[何时应该使用反射？](http://msdn.microsoft.com/en-us/magazine/cc163759.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-30T17:59:42.867

如果您的问题最好通过使用反射来解决，那么您应该使用它。

（请注意，“最佳”的定义是从经验中学到的：）

框架与应用程序的定义也不是非黑即白。有时您的应用程序需要一些框架才能很好地完成工作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-09-16T00:10:09.703

我认为在应用程序代码中不需要使用反射并且它应该只在框架中使用的观察或多或少是正确的。

在某些代码的耦合程度方面，通过反射连接的代码与它们出现时一样松散耦合。

因此，通过反射完成它的工作的代码可以很高兴地完成它在生活中的作用，而对正在使用它的代码一无所知。

# php - 在文本中搜索（可能）数万个标记

> ID：807476
> 
> 赞同：1
> 
> 时间：2009-04-30T15:22:40.217
> 
> 标签：php

我正在维护一个简单的基于 php 的内部 cms。我想搜索保存到系统中的文章文本，以查找最终将有数万个不同标记的内容，以便自动将链接应用到这些标记，并在关联表中建立关系文章和令牌所代表的实体。

做这个的最好方式是什么？有没有比每次保存文章时检索所有令牌及其相关实体/ID 的列表更快/更有效的方法？

我对替换令牌的兴趣不如建立要搜索的令牌列表的最佳方式 - 它们将来自几个不同的表，我认为基于每个请求的数据集需要查询将对数据库和脚本的内存负载造成相当大的负担

编辑：我想我提出的问题不正确。

考虑以下文本：

Steve McMuffin 在 The Stinking Bean 吃了 17 个 Fabulous Furry Fajitas，而 Johnson Fatlumps 吃了 32 个。

我有两个人都在“人”表中，一个在“餐厅”表中的餐厅和一个在“restaurant_menu_item”表中的餐厅菜单项。

我想知道最好的方法，在保存该文本后，自动通过并识别什么是人，什么是餐厅，以及什么是餐厅菜单项*，而不*诉诸自定义标记，因为目标受众几乎没有机会永远做对了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T15:56:30.213

除非你能得到令牌格式的一些保证，否则这总是很困难的（无论如何都是计算上的）。如果没有标记，计算机真的不知道任何特定的字符串具有任何特殊含义，如果不能教它识别格式。

“简单”的答案是遍历每个标记的文本，查看它是否存在并处理它。但是你会遇到两个问题：计算时间和碰撞（正如乍得在他的评论中指出的那样）。

有没有可以强制执行的非常简单的标记？如果短语被 [[brackets]] 包围，MediaWiki 只会创建内部链接。如果您使用 CamelCaseThePhrase，许多 wiki 软件只会创建链接。

我想不出一种方法让应用程序自动知道某些字符组是否有意义，而无需检查每个定义的标记或强制执行某种格式。

你确定你的听众不能处理类似的事情吗

```
SteveMcMuffin ate seventeen FabulousFurryFajitas at
TheStinkingBean, while JohnsonFatlumps ate thirty-two. 
```

或者

```
[[Steve McMuffin]] ate seventeen [[Fabulous Furry Fajitas]] at
[[The Stinking Bean]], while [[Johnson Fatlumps]] ate thirty-two. 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T15:28:24.540

我们也有类似的情况。我们最终使用正则表达式来解析和替换标记。因为原始文章是一个模板，我们将生成替换标记的新文章，我们将缓存生成的文章，因此对模板没有更改意味着没有新的解析。

# svn - 配置 Subversion 以使用系统用户/密码

> ID：807477
> 
> 赞同：4
> 
> 时间：2009-04-30T15:22:47.283
> 
> 标签：svn, apache, webdav

我在Linux 机器上使用[Subversion 1.6.1 和 Apache 。](http://svnbook.red-bean.com/nightly/en/svn.serverconfig.httpd.html#svn.serverconfig.httpd.basic)服务器运行在 http，而不是 https。

我想允许人们使用与通过 SSH 登录机器相同的登录名/密码进行身份验证。SVN 手册只解释了如何使用 HTTP Basic Auth 和 Digest 认证。但是使用这些方法，我需要维护一个单独的用户列表，并且他们不能更改自己的密码。我宁愿只使用系统的用户。

1.  我该怎么做呢？
2.  这是明智的吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T15:29:11.200

我会说这是一个完美的服务器故障问题。

但是，我在 Apache 和 pwauth 中使用 WebDav。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-01T01:54:43.207

该问题提到了基本/摘要身份验证。首先，注意基本/摘要身份验证是指服务器和浏览器之间用于通信用户/密码的协议（在 Apache 2.2 上，使用身份验证前端模块，例如**mod_auth_digest**和**mod_auth_basic**）。

在幕后，Apache 可以使用许多不同的用户/密码信息来源进行检查。**使用“密码文件”的mod_authn_file**是一个常见的文件，听起来好像这就是您所指的。

要访问 Linux 机器上的系统用户/密码，Apache 项目本身不提供任何身份验证后端模块，但有 3rd-party 可用。请参阅这篇文章，这可能会有所帮助：

[**使用mod_authnz_external**进行 Apache 2.2 身份验证](http://blog.innerewut.de/2007/6/26/apache-2-2-authentication-with-mod_authnz_external)

 *** * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T15:24:57.747

有什么特别的理由不只是通过 svn + ssh 访问它，因为他们有帐户？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-01T01:29:05.827

我们对使用[`mod_auth_sspi`](http://sourceforge.net/projects/mod-auth-sspi/). 到目前为止没有问题。

# ruby - 编译 Ruby 1.8.7 Build 160 时出错

> ID：807503
> 
> 赞同：0
> 
> 时间：2009-04-30T15:26:11.550
> 
> 标签：ruby, installation, compilation, zlib

我昨天正在编译 Ruby 1.8.7 的最新版本（因为最新版本还没有二进制文件）。

我按照自述文件中的说明进行操作，但是当我安装 ruby​​ gems 并对其进行更新时，它会显示找不到 zlib.so 的错误。

我很确定我已经下载了 zlib 库等。我还调查了 nmake 日志，这就是错误的样子。

conftest.c(8) : 错误 C2065: 'deflateReset' : 未声明的标识符

我错过了什么吗？

谢谢 ：）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-13T16:32:25.220

对不起，我想通了。您需要下载 zlib 二进制文件并将包含文件夹中的项目放入您的 c++ 包含目录。之后将 zlib1.dll 复制到 ruby​​\bin 目录中。

# linux - Linux 中的线程与进程

> ID：807506
> 
> 赞同：275
> 
> 时间：2009-04-30T15:26:55.510
> 
> 标签：linux, performance, multithreading, process

我最近听到一些人说，在 Linux 中，使用进程而不是线程几乎总是更好，因为 Linux 在处理进程方面非常高效，并且因为与线程相关的问题（例如锁定）非常多。但是，我很怀疑，因为在某些情况下，线程似乎可以带来相当大的性能提升。

所以我的问题是，当面对线程和进程都可以很好地处理的情况时，我应该使用进程还是线程？例如，如果我正在编写 Web 服务器，我应该使用进程还是线程（或组合）？

* * *

## 回答 #1

> 赞同：349
> 
> 时间：2009-04-30T20:59:49.937

Linux 使用 1-1 线程模型，（对内核而言）进程和线程之间没有区别——一切都只是一个可运行的任务。*

在 Linux 上，系统调用`clone`克隆一个任务，具有可配置的共享级别，其中包括：

*   `CLONE_FILES`：共享同一个文件描述符表（而不是创建一个副本）
*   `CLONE_PARENT`: 不要在新任务和旧任务之间建立父子关系（否则，child's `getppid()`= parent's `getpid()`）
*   `CLONE_VM`: 共享相同的内存空间（而不是创建一个[COW](https://en.wikipedia.org/wiki/Copy-on-write)副本）

`fork()`调用`clone(`最少共享`)`和`pthread_create()`调用`clone(`最多共享`)`。**

`fork``pthread_create`由于复制表和为内存创建 COW 映射，因此ing 的成本比 ing 高一点，但 Linux 内核开发人员已经尝试（并成功）最小化了这些成本。

在任务之间切换，如果它们共享相同的内存空间和不同的表，将比不共享它们便宜一点，因为数据可能已经加载到缓存中。然而，即使没有共享任何内容，切换任务仍然非常快——这是 Linux 内核开发人员试图确保（并成功确保）的另一件事。

事实上，如果你在一个多处理器系统上，**不**共享实际上可能对性能有好处：如果每个任务都在不同的处理器上运行，同步共享内存的成本很高。

* * *

* 简化。 `CLONE_THREAD`导致信号传递被共享（需要`CLONE_SIGHAND`，共享信号处理程序表）。

** 简化。`SYS_fork`和系统调用都存在`SYS_clone`，但是在内核中，`sys_fork`和`sys_clone`都是围绕同一个`do_fork`函数的非常薄的包装器，它本身就是围绕`copy_process`. 是的，术语`process`,`thread`和`task`在 Linux 内核中可以互换使用...

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2009-04-30T20:41:08.483

Linux（实际上是 Unix）为您提供了第三种选择。

# 选项 1 - 流程

创建一个独立的可执行文件来处理应用程序的某些部分（或所有部分），并为每个进程单独调用它，例如，程序运行自身的副本以委派任务。

# 选项 2 - 线程

创建一个独立的可执行文件，它以单个线程启动并创建额外的线程来执行某些任务

# 选项 3 - 分叉

仅在 Linux/Unix 下可用，这有点不同。分叉的进程实际上是它自己的进程，有自己的地址空间——子进程（通常）不能做任何事情来影响其父或兄弟的地址空间（不像线程）——所以你得到了额外的健壮性。

但是，内存页面不会被复制，它们是写时复制的，因此通常使用的内存比您想象的要少。

考虑一个包含两个步骤的 Web 服务器程序：

1.  读取配置和运行时数据
2.  服务页面请求

如果您使用线程，则第 1 步将执行一次，第 2 步将在多个线程中完成。如果您使用“传统”流程，则需要为每个流程重复步骤 1 和 2，并且需要复制用于存储配置和运行时数据的内存。如果您使用了 fork()，那么您可以执行第 1 步一次，然后执行 fork()，将运行时数据和配置保留在内存中，不受影响，不复制。

所以真的有三个选择。

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2009-04-30T15:37:58.540

这取决于很多因素。进程比线程更重，启动和关闭成本更高。进程间通信（IPC）也比线程间通信更难更慢。

相反，进程比线程更安全，因为每个进程都在自己的虚拟地址空间中运行。如果一个进程崩溃或缓冲区溢出，它根本不会影响任何其他进程，而如果一个线程崩溃，它会关闭进程中的所有其他线程，如果一个线程有缓冲区溢出，它就会打开所有线程中的安全漏洞。

因此，如果您的应用程序的模块可以大部分独立运行而几乎没有通信，那么如果您能够承担启动和关闭成本，您可能应该使用进程。IPC 对性能的影响将是最小的，并且您对错误和安全漏洞会稍微安全一些。如果您需要获得或拥有大量共享数据（例如复杂数据结构）的所有性能，请使用线程。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-04-30T17:50:04.060

其他人已经讨论了这些考虑因素。

也许重要的区别在于，与线程相比，Windows 中的进程繁重且昂贵，而在 Linux 中，差异要小得多，因此等式在不同的点上取得平衡。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-05-18T15:56:40.813

从前有 Unix，在这个古老的 Unix 中，进程有很多开销，所以一些聪明的人所做的是创建线程，它们将与父进程共享相同的地址空间，他们只需要减少上下文switch，这将使上下文切换更有效。

在当代 Linux (2.6.x) 中，与线程相比，进程的上下文切换在性能上没有太大差异（只有 MMU 的东西是线程的附加内容）。共享地址空间存在问题，这意味着线程中的错误指针可能会破坏父进程的内存或同一地址空间内的另一个线程。

进程受 MMU 保护，因此错误的指针只会导致信号 11 而不会损坏。

我通常会使用进程（在 Linux 中没有太多的上下文切换开销，但是由于 MMU 的内存保护），但是如果我需要一个实时调度程序类，则使用 pthreads，这完全是另一杯茶。

为什么你认为线程在 Linux 上会有如此大的性能提升？你有这方面的任何数据，还是只是一个神话？

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-04-30T16:17:01.800

你的任务有多紧密耦合？

如果他们可以彼此独立生活，那么使用流程。如果它们相互依赖，则使用线程。这样你就可以杀死并重新启动一个错误的进程，而不会干扰其他任务的运行。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2019-04-28T22:43:44.657

I think everyone has done a great job responding to your question. I'm just adding more information about thread versus process in Linux to clarify and summarize some of the previous responses in context of kernel. So, my response is in regarding to kernel specific code in Linux. According to Linux Kernel documentation, there is no clear distinction between thread versus process except thread uses *shared virtual address space* unlike process. Also note, the Linux Kernel uses the term "task" to refer to process and thread in general.

**"There are no internal structures implementing processes or threads, instead there is a struct task_struct that describe an abstract scheduling unit called task"**

Also according to Linus Torvalds, you should NOT think about process versus thread at all and because it's too limiting and the only difference is COE or Context of Execution in terms of "separate the address space from the parent " or shared address space. In fact he uses a web server example to make his point [here](https://www.evanjones.ca/software/threading-linus-msg.html) (which highly recommend reading).

Full credit to [linux kernel documentation](https://linux-kernel-labs.github.io/master/lectures/intro.html)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-04-30T21:33:37.657

更复杂的是，还有[线程本地存储](http://en.wikipedia.org/wiki/Thread-Specific_Storage)和 Unix 共享内存之类的东西。

线程局部存储允许每个线程拥有一个单独的全局对象实例。我唯一一次使用它是在 linux/windows 上构建仿真环境时，用于在 RTOS 中运行的应用程序代码。在 RTOS 中，每个任务都是一个具有自己地址空间的进程，在仿真环境中，每个任务都是一个线程（具有共享地址空间）。通过对单例等事物使用 TLS，我们能够为每个线程拥有一个单独的实例，就像在“真实”RTOS 环境下一样。

共享内存可以（显然）为您提供让多个进程访问同一内存的性能优势，但代价是必须正确同步进程。一种方法是让一个进程在共享内存中创建一个数据结构，然后通过传统的进程间通信（如命名管道）向该结构发送一个句柄。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2015-09-09T20:13:12.997

在我最近使用 LINUX 的工作中，需要注意的一件事是库。如果您使用线程，请确保您可以跨线程使用的任何库都是线程安全的。这让我烧了几次。值得注意的是 libxml2 不是开箱即用的线程安全的。它可以用线程安全的方式编译，但这不是你通过 aptitude install 得到的。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-04-30T15:37:35.080

我必须同意你所听到的。当我们对我们的集群（`xhpl`等等）进行基准测试时，我们总是通过线程获得更好的进程性能。`</anecdote>`

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-04-30T16:04:52.953

线程/进程之间的决定取决于您将使用它来做什么。进程的好处之一是它有一个 PID，可以在不终止父进程的情况下被杀死。

对于 Web 服务器的真实示例，apache 1.3 过去仅支持多个进程，但在 2.0 中，它们添加[了一个抽象](http://httpd.apache.org/docs/2.0/mod/worker.html)，以便您可以在两者之间切换。[评论](http://www.linuxjournal.com/article/4559) [似乎](http://www.whenpenguinsattack.com/2006/01/24/improving-php-performance-on-apache/) [同意](http://www.devside.net/articles/apache-performance-tuning)进程更健壮，但线程可以提供更好的性能（除了进程性能很差并且您只想使用线程的窗口）。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2020-11-21T11:07:21.207

如果您想尽可能创建一个纯进程，您将使用 clone() 并设置所有克隆标志。（或者节省自己的打字工作并打电话`fork()`）

如果您想尽可能地创建一个纯线程，您将使用 clone() 并清除所有克隆标志（或者节省自己的打字工作并调用`pthread_create()`）

有 28 个标志指示共享级别。这意味着您可以创建超过 2.68 亿种任务，具体取决于您要共享的内容。

当我们说 Linux 不区分进程和线程，而是将程序中的任何控制流作为任务暗示时，这就是我们的意思。不区分两者的理由是，嗯，不是唯一定义超过 2.68 亿种口味！

**因此，做出是否使用进程或线程的“完美决定”实际上是决定克隆 28 个资源中的哪一个**

[![在此处输入图像描述](https://i.stack.imgur.com/PwTDC.png)](https://i.stack.imgur.com/PwTDC.png)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2010-06-17T21:22:21.650

对于大多数情况，我更喜欢进程而不是线程。当您有一个相对较小的任务（进程开销>>每个划分的任务单元所花费的时间）并且需要它们之间的内存共享时，线程可能很有用。想想一个大数组。另外（离题），请注意，如果您的 CPU 利用率为 100% 或接近 100%，则多线程或处理将没有任何好处。（实际上它会恶化）

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2018-10-26T15:27:17.973

线程 --> 线程共享内存空间，是对 CPU 的抽象，是轻量级的。进程 --> 进程有自己的内存空间，它是计算机的抽象。要并行化任务，您需要抽象一个 CPU。然而，使用进程而不是线程的优点是安全性、稳定性，而线程使用的内存比进程少，并且延迟更小。网络方面的一个例子是 chrome 和 firefox。在 Chrome 的情况下，每个选项卡都是一个新进程，因此 chrome 的内存使用率高于 firefox，而提供的安全性和稳定性优于 firefox。chrome提供的安全性更好，因为每个选项卡都是一个新进程，不同的选项卡无法窥探给定进程的内存空间。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2021-05-18T18:12:49.083

多线程适用于受虐狂。:)

如果您担心不断创建线程/分叉的环境，可能就像处理请求的 Web 服务器一样，您可以预先分叉进程，必要时可以使用数百个。由于它们在写入时复制并使用相同的内存，直到发生写入，所以速度非常快。它们都可以阻塞，侦听同一个套接字，第一个接受传入 TCP 连接的套接字就可以运行。使用 g++，您还可以将函数和变量指定为紧密放置在内存中（热段），以确保当您写入内存时，并导致复制整个页面，至少随后的写入活动将发生在同一页面上。您确实必须使用分析器来验证这类东西，但如果您担心性能，无论如何您都应该这样做。

由于共享对象上的微妙交互、您没有想到的线程“陷阱”以及由于无法随意重现线程交互问题而非常难以调试，因此线程应用程序的开发时间要长 3 倍到 10 倍。您可能必须进行各种性能检查，例如在每个函数之前和之后检查的所有类中都有不变量，如果出现问题，您可以停止进程并加载调试器。大多数情况下，在生产过程中发生令人尴尬的崩溃，您必须仔细研究核心转储，试图找出哪些线程做了什么。坦率地说，除非您明确共享某些内容，否则当分叉进程同样快速且隐式线程安全时，这不值得头疼。

如果性能如此重要，请添加另一台计算机并进行负载平衡。对于调试多线程应用程序的开发人员成本，即使是由经验丰富的多线程开发人员编写的应用程序，您也可以购买 4 块 40 核英特尔主板，每块 64GB 内存。

话虽如此，在某些不对称情况下并行处理是不合适的，例如，您希望前台线程接受用户输入并立即显示按钮按下，而无需等待一些笨重的后端 GUI 跟上。多处理在几何上不适合的线程的性感使用。许多类似的东西只是变量或指针。它们不是可以在分叉中共享的“句柄”。你必须使用线程。即使您进行了分叉，您也将共享相同的资源并受到线程样式问题的影响。

* * *

## 回答 #16

> 赞同：-3
> 
> 时间：2009-04-30T15:37:49.803

如果你需要共享资源，你真的应该使用线程。

还要考虑线程之间的上下文切换比进程之间的上下文切换便宜得多的事实。

我认为没有理由明确地使用单独的流程，除非您有充分的理由这样做（安全性、经过验证的性能测试等......）

# svn - Cruisecontrol.net 缺少签到

> ID：807511
> 
> 赞同：0
> 
> 时间：2009-04-30T15:27:50.577
> 
> 标签：svn, continuous-integration, cruisecontrol.net

我已经设置了一个 CCNET，总的来说它工作正常。它会轮询 SVN 服务器并在发现任何更改时检查代码。除非，即在构建过程中进行签入时。目前，构建和测试运行大约需要 3 - 4 分钟，如果有人在构建期间签入代码，crusie 控件无法识别签入，并在构建运行后等待直到有签入。

为什么会这样？

这是 ccnet.config 文件的 svn 部分：

```
<sourcecontrol type="svn">
    <executable>svn.exe</executable>
    <trunkUrl>http://*******/svn/repos/psl/AcademyPro/ASP%20.Net/trunk/</trunkUrl>
    <workingDirectory>C:\CrusieControlProjects\AcademyPro\</workingDirectory>
    <username>******</username>
    <password>******</password>
    <autoGetSource>true</autoGetSource>
</sourcecontrol> 
```

**为清晰** 而编辑问题与原子签入无关。签入可以完成，CCNET 构建应用程序并开始运行测试。此时，其他人再次签到。一旦测试运行完成，我希望 CCNET 能够发现在测试运行期间进行的签入。

这不会发生，签入被错过并且我期望的构建被错过。

这是预期的行为，还是我不明白@Jeff Mattfield 在说什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T15:38:46.370

Subversion 提交是原子的。在完成且没有错误之前，它不可用于结帐。在并行提交期间更新或签出存储库会导致该提交之前的存储库状态。

换句话说，CC.NET 在最后一次成功提交后获取存储库包含的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-03T05:41:23.410

我从来没有遇到过这个问题，而且我已经使用 SVN+CCNet 工作了几年了。

1.  你能发布整个CCNet项目配置吗？例如，这可能与触发器有关。
2.  您使用的是哪个版本的 CCNet？
3.  您说 CCNet 仅检测构建**后发生的更改。**好的，但是当您查看项目构建报告（“*自上次构建以来的修改*”）时，它是仅显示在上一次构建之后发生的那些还是所有这些（包括在上一次构建**期间**发生的那些）？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-05T08:43:12.843

检查 ccservice.exe.config / ccnet.exe.config 是否设置了调试日志级别：

```
<configuration>
  <configSections>
  ...
    </log4net>
      <root>
        <level value="DEBUG"/>
      <root>
    </log4net>
  ...
  </configuration>
</configSections> 
```

然后检查 ccnet.log 中的 subversion 输出以获取 subversion 修订版。

```
2009-06-05 10:34:41,816 [15336:DEBUG] [cc-config svn.exe] <logentry
2009-06-05 10:34:41,816 [15336:DEBUG] [cc-config svn.exe]    revision="1057"> 
```

确保该版本是最新版本，并在 svn trunkUrl (http://*******/svn/repos/psl/AcademyPro/ASP%20.Net/trunk/) 路径下提交。

否则，请检查日志和状态文件以获取更多线索。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-08T14:37:30.913

The time on the subversion server was about 2 hours out from the time on the cruisecontrol server. I fixed that and checkins now seem to be running much smoother.

# javascript - javascript 函数中的 sIFR 和 document.write

> ID：807513
> 
> 赞同：1
> 
> 时间：2009-04-30T15:27:55.210
> 
> 标签：javascript, sifr

我正在尝试通过一个javascript循环来设置一些html的样式，该循环通过document.write（）输出html；功能。我的 CSS 样式似乎正确通过，但是由于某种原因我的 sifr 类没有调用我的 flash 文件。我在想这可能与我正在使用的 javascript document.write 函数有关。

我想知道是否可以以这种方式使用 SIFR。如果没有，是否有人可以替代我正在做的事情？

这是我的代码：（基本上，我正在从 XML 文件加载数据并使用 document.write 将其作为 HTML 输出 - 我已将我要引用的代码加粗。我是一名尝试编写 javascript 的设计师，所以在拆分我的功能之前请记住这一点。=）

```
document.write("<h1 class="h1_sifr_green">Tours in the <br />");
document.write(search_term.toUpperCase());
document.write(" area:</h1><br /><br />"); 
```

同样，我的 h1 标签以及我的所有其他 css 类都很好，除了我的 sifr 类。在此先感谢，感谢您提供任何帮助。

这是我的完整代码：

```
<html>
<head>
<link href="../css/colors.css" rel="stylesheet" type="text/css" />
<link href="../css/layout.css" rel="stylesheet" type="text/css" />
<link href="../css/textstyles.css" rel="stylesheet" type="text/css" />
<link href="../css/sifr.css" rel="stylesheet" type="text/css" />

<script type="text/javascript" src="js/sifr.js"></script>
<script type="text/javascript" src="js/sifr-config.js"></script>

<script type="text/javascript">
function parseXML()
{

var search_term=window.location.search.substring(1);  //sets the search_term variable to the URL string query
var tour_name;
var tour_link;
var tour_logo;

try //Internet Explorer
  {
  xmlDoc=new ActiveXObject("Microsoft.XMLDOM");
  }
catch(e)
  {
  try //Firefox, Mozilla, Opera, etc.
    {
    xmlDoc=document.implementation.createDocument("","",null);
    }
  catch(e)
    {
    alert(e.message);
    return;
    }
  }
xmlDoc.async=false;
xmlDoc.load(search_term + ".xml");

x=xmlDoc.documentElement.childNodes;

document.write("<h1 class=\"h1_sifr_green\">Tours in the <br />");
document.write(search_term.toUpperCase());
document.write(" area:</h1><br /><br />");

for (i=0;i<x.length;i++)
  {
  tour_name=xmlDoc.getElementsByTagName("name")[i].firstChild.nodeValue;
  tour_link=xmlDoc.getElementsByTagName("tourlink")[i].firstChild.nodeValue;
  document.write("<a href=\"" + tour_link + "\" class=\"b3 textlink\">" + tour_name + "</a>");
  document.write("<br />");
  }
}

</script>
</head>

<body>
<div id="wrap" style="background-image:url(../images/index_06.jpg); width:550px">
<div style="padding:30px">
<script type="text/javascript" language="JavaScript">
    parseXML();
</script>
</div>

</div>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T16:38:42.857

是的，当您的 .js 文件未正确链接时，一定会喜欢...链接已损坏，已修复链接，问题已解决。

# iphone - 捕获在 UiScrollView 中触摸了哪个子视图，但无法在另一个函数中访问它。

> ID：807516
> 
> 赞同：1
> 
> 时间：2009-04-30T15:28:30.153
> 
> 标签：iphone, uiscrollview

我有添加了子视图（图片）的 UIScrollView。每次用户触摸滚动视图中的图片时，它都会在其顶部切换一个复选标记。

NSMutableIndexSet *picturesArray; <- 在 .h 中声明

```
- (void) touchesEnded: (NSSet *) touches withEvent: (UIEvent *) event {
if (!self.dragging) {
    [self.nextResponder touchesEnded: touches withEvent:event]; 
    NSLog(@"Touch down");
    for (UITouch *touch in touches) {

        for (int i = 1; i <= [self subviews].count; i++)
        {

        if(CGRectContainsPoint([[self viewWithTag:i]frame], [touch locationInView:self])){      
            NSLog(@"touched %d th view",i);

            NSArray *subviews = [[self viewWithTag:i] subviews];
            UIImageView *view = nil;

            view = [subviews objectAtIndex:0];

                if(view.hidden){
                    // add the index
                    [picturesArray addIndex:i]; 
                    view.hidden = NO; //check mark is shown
                }else{
                    [picturesArray removeIndex:i]; 
                    view.hidden = YES; //check mark is not shown
                }

            //  UIImageWriteToSavedPhotosAlbum([(UIImageView *)[self viewWithTag:i]image], nil, nil, nil); <- WORKS IF CALLED

            }

        }   
    }

} 
```

问题1：这是最好的方法吗？似乎使用 for (int i = 1; i <= [self subviews].count; i++) 很慢。我基本上需要捕捉被触摸的子视图。除了通过每个子视图之外，我还没有弄清楚这一点

调用 savePhotos 并基本上搜索触摸了哪些图片并将它们保存到相册。但是，对 UIImageWriteToSavedPhotosAlbum 的调用失败。这与 TouchesEnded 在同一个文件中。但是当在 TouchesEnded 中调用时，它可以工作。

*   (IBAction) savePhotos: (id) sender{

    NSLog(@"索引集为 %@",picturesArray );

    const NSUInteger arrayCount = picturesArray.count;

    NSUInteger *theIndexBuffer = (NSUInteger *)calloc(picturesArray.count, sizeof(NSUInteger)); UIImageWriteToSavedPhotosAlbum([(UIImageView *)[self viewWithTag:0]image], nil, nil, nil);

    [picturesArray getIndexes:theIndexBuffer maxCount:arrayCount inIndexRange:nil];

    for(int i = 0; i < arrayCount; i ++){

    ```
    NSLog(@"Element is %d",theIndexBuffer[i]);      
       UIImageWriteToSavedPhotosAlbum([(UIImageView *)[self viewWithTag:i]image], nil, nil, nil); <- THIS CRASHES 
    ```

    }

}

问题 2：为什么 UIImageWriteToSavedPhotosAlbum 失败了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T20:02:27.280

1) 不使用 UIImageView，而是实现 UIImageView 的子项。然后尝试聆听对各个子视图的触摸，这应该可以解决您的 O(n) 问题

2）某些东西可能会自动释放，请仔细检查您的引用计数是否正确

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T21:15:46.090

1.  尝试 `UIView* targetView = [self hitTest:location withEvent:nil];`

# java - Java Server Page 的生命周期方法有哪些？

> ID：807527
> 
> 赞同：4
> 
> 时间：2009-04-30T15:30:06.437
> 
> 标签：java, jsp, lifecycle

Java Server Page 的生命周期方法有哪些？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T15:32:36.633

*   预翻译：在 JSP 文件被翻译并编译成 Servlet 之前。
*   已翻译：JSP 文件已被翻译并编译为 Servlet。
*   已初始化：在服务方法中处理请求之前，容器调用 jspInit() 来初始化 Servlet。每个 Servlet 实例仅调用一次。
*   服务：为客户请求提供服务。容器为每个请求调用此方法。停止服务：Servlet 实例停止服务。容器调用 jspDestroy() 方法。

# javascript - 如何从 JavaScript 调整表格列的宽度

> ID：807528
> 
> 赞同：3
> 
> 时间：2009-04-30T15:30:41.647
> 
> 标签：javascript, css, column-width

我有 javascript 的问题。
我有一个存储在 TabList 的表格单元格列表。
我想找到最大宽度，然后将此宽度设置为所有宽度。
示例代码在这里，但宽度的设置不起作用。

```
var MaxTabWidth = 0;
for (var i = 0; i < TabList.length-1; i++)
{
  if (TabList[i].offsetWidth>MaxTabWidth) 
    MaxTabWidth = TabList[i].offsetWidth;
}

for (var i = 0; i < TabList.length-1; i++)
{
  TabList[i].style.width = MaxTabWidth+"px";
  // TabList[i].width = MaxTabWidth+"px";
  // TabList[i].offsetWidth = MaxTabWidth+"px";
} 
```

我已经评论了我的尝试..有
什么帮助吗？
[这](https://stackoverflow.com/questions/456859/any-way-to-synchronize-table-column-widths-with-html-css/458762#458762) 对我没有用..

**更新：**
我确定 TabList 是单元格列表，因为我正在检查类名。
我正在循环直到 TabList.length-1，因为我希望最后一个单元格填充表格的其余部分宽度。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-01T09:02:40.683

我建议您从页面中删除所有 css/样式并对其进行测试以隔离问题。像这样的事情经常被 css 复杂化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T15:59:24.060

如果将整个表格的宽度设置为 --i*MaxTabWidth。这会均匀分布列吗？假设您的表名为 myTable。

```
document.getElementById('myTable').width = new String(--i*MaxTabWidth) 
```

编辑：也不会

```
for (var i = 0; i < TabList.length-1; i++) 
```

通过在 TabList.length-2 处停止来跳过最后一列？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T16:07:37.300

对于它的价值，在 jQuery 中，这可以通过以下脚本完成，其中您的表的 id 为“myTable”。如果您对环境有足够的控制权以添加到框架中，我强烈推荐它，因为它使此类任务变得更加容易。

```
 var maxWidth = 0;

    $("#myTable td").each(function() {
        if ($(this).width() > maxWidth) {
            maxWidth = $(this).width();
        }
    });
    $("#myTable td").width(maxWidth); 
```

# continuous-integration - 使用 ccnet 建立农场

> ID：807529
> 
> 赞同：4
> 
> 时间：2009-04-30T15:30:56.467
> 
> 标签：continuous-integration, build-automation, cruisecontrol.net, grid-computing

是否可以使用 CruiseControl.Net 建立构建农场？我们目前有 4 台不同的构建机器在不同的时间构建不同的东西，并且以某种方式手动平衡负载有点头疼。我更愿意指定其中一台作为主构建机器，当它们空闲时将工作委派给其他机器。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-10T17:45:14.837

据我所知，CruiseControl.Net 不支持构建农场 - 至少不是按照您描述的方式操作。CCNet 对“农场”的解释似乎假设项目是手动分配给机器的，并且给定的项目将始终构建在同一台机器上。

如果您想动态选择实际执行构建的机器，则需要创建自己的机制来选择该机器并在其上触发构建。与此相关的可能有相当多的复杂性。例如，如果在前一次提交仍在处理期间发生第二次提交，您可能需要确保不会在两台不同的机器上同时构建同一个项目。

如果有一个所有构建机器都可以访问的共享位置，则可以使用 Filesystem 源代码控制块或 CCNet 的 ForceBuild 机制在指定机器上开始构建，但让所有构建机器针对给定的机器发布它们的输出项目到相同的最终位置。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-12T06:40:38.493

有关可能的解决方案，请参阅[使用 CruiseControl.NET 博客文章对构建场进行负载平衡](http://www.beefycode.com/post/Load-Balancing-the-Build-Farm-with-CruiseControlNET.aspx)

# ruby - Ruby：如何检测套接字的一侧何时关闭

> ID：807539
> 
> 赞同：12
> 
> 时间：2009-04-30T15:32:40.347
> 
> 标签：ruby, sockets

如何检测到套接字是半开的？我正在处理的情况是套接字的另一端发送了一个 FIN 并且 Ruby 应用程序已经确认了该 FIN。有没有办法告诉我套接字处于这种状态？

举个例子：

```
require 'socket'

s = TCPServer.new('0.0.0.0', 5010)

loop do
  c = s.accept

  until c.closed?
    p c.recv(1024)
  end
end 
```

在这种情况下，当我 telnet 到端口 5010 时，我会看到我的所有输入，直到我关闭 telnet 会话。那时，它会以最快的速度一遍又一遍地打印空字符串。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2016-01-18T20:43:24.530

您正在使用阻塞调用 recv，它会在另一端关闭时返回 nil。在您关闭它之前，套接字不会关闭。改变

```
 until c.closed?
    p c.recv(1024)
  end 
```

至

```
while (s = c.recv(1024)) && s > 0
   p s
end
c.close 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2021-01-24T22:54:40.637

你可以结合起来`IO#read`检查`IO#eof?`一下。

```
require 'socket'

server = TCPServer.new('0.0.0.0', 5010)

loop do
  client = server.accept
  client.read(1024) until client.eof?
  puts 'client closed connection'
  client.close
end 
```

# .net - 上传到 IIS Web App 时 PDF 到文本的转换？

> ID：807544
> 
> 赞同：0
> 
> 时间：2009-04-30T15:34:25.180
> 
> 标签：.net, asp.net, pdf, text

我研究了几个 C# DLL，但没有发现任何特别好的。我的要求是：

*   PDF 文档通过 ASPX 页面上传。
*   需要提取文本并将其与 PDF 一起存储在数据库中。
*   解决方案不能为复制 Web 应用程序产生额外费用（因此，如果我*知道*它会起作用，将考虑使用固定费用的解决方案，但不收取每次安装费用）。
*   虽然良好的转换是最重要的，但用户可能希望一次上传*多个*PDF 文件，因此速度也很重要。

将使用文本的下游进程设置为使用[PDFBox](http://incubator.apache.org/pdfbox/)，这似乎运行良好。但：

*   **PDFBox**是用 Java 编写的，所以我需要将它作为一个单独的进程启动并检索结果（我正在通过[IKVM 取消](http://www.ikvm.net/)使用它）。
*   默认情况下，它从磁盘文件中读取，但为了简单和速度，我更喜欢*stdin->stdout*过滤器。修复 PDFBox 很简单，但是从 C# 获取子进程的 I/O 是乏味的。
*   我知道我可以向硬盘驱动器写入一个新磁盘，启动 PDFBox，等待它退出，然后从硬盘驱动器（或其*stdout*）中读取，但这看起来很笨拙，并且可能会更慢。

我很惊讶我找不到 PDF 转换器配方，这似乎是一个常见的要求。那么，任何人都可以帮助我：

*   您使用的罐装转换解决方案*至少与***PDFBox**一样好用。
*   如果在 IIS 后面使用 stdio 过滤器确实是个坏主意，请解释*为什么*.

提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-04T21:38:21.043

我最初询问如何将二进制数据写入**Process.StandardInput** ( *StreamWriter* )，因为它只处理字符数据：答案是使用**Process.StandardInput.BaseStream** ( *Stream* )。

此外，由于两个管道都可能填满（64KB 缓冲区 IIUC），我使用了以下模式：

*   产生一个线程来写入数据，然后设置一个标志，
*   产生一个线程来读取所有返回数据，然后设置一个标志，
*   循环直到设置了两个标志，调用 Thread.Sleep(100)。
*   返回从进程读取的数据。

因此，除了在 WebApp 中放置可执行文件（或需要单独安装）的黑客方面之外，这似乎工作正常——但我仍然需要做一些滥用测试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-08-24T14:50:15.170

如果您有可能在服务器上运行 Process()，则可以使用来自[http://www.foolabs.com/xpdf/](http://www.foolabs.com/xpdf/)的 XPDF，其中一个实用工具是 PDFtoText，它能够提取 PDF 文件中的文本，甚至可以维护一些布局类型。

早在过去，我就听说过 Adob​​e 搜索和 MS Index 服务相结合也可以提取 PDF 文件文本的示例。

# .net - 第 3 方 WinForm .NET 网格控件

> ID：807545
> 
> 赞同：0
> 
> 时间：2009-04-30T15:34:28.050
> 
> 标签：.net, winforms, gridview, controls

有人对第 3 方 WinForm .NET 网格控件有任何经验吗？

在我用下午的时间下载和试用几个网格和/或控制包之前，有人对供应商有意见吗？功能？等等

我将要研究的一些是：

*   XCeed 网格
*   Telerik Grid - WinForms 的 RadControls 的一部分
*   Infragistics NetAdvantage WinClient for WinForms

网上有评论吗？对比图？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T15:36:44.270

这无疑会因为主观而被关闭，但我会继续全力支持[DevExpress](http://www.devexpress.com/Products/NET/DXperience/)控件套件，特别是 XtraGrid。我从未使用过具有如此高的速度、可定制性以及可靠和强大的设计器支持的其他控件。

我在目前的工作中使用 Telerik，虽然我现在拥有的版本比我开始使用的版本好几光年，但我仍然认为它与 DevExpress 的产品相提并论。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-05-28T06:54:33.727

我们对 ComponentOne 的 C1 网格的体验非常糟糕。当美国政府的客户制定了 FIPS 政策并且他们的客户支持只是告诉我们——“是的，你是对的，我们不符合 FIPS”时，我们的脸就炸开了锅。非常感谢，除此之外，所谓的虚拟模式对于大数据来说是没有用的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-11-15T09:43:21.543

我们将 PFGrid 用于 .NET，它重量轻但功能强大：

[http://www.pfgrid.com](http://www.pfgrid.com)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T15:44:24.437

我使用基础设施。它非常强大，但对于简单的任务可能很难设置。我没有遇到任何重大问题或错误。他们的论坛非常适合支持，他们每季度发布一次更新（更频繁地提供严重的错误修复）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-01-24T10:55:07.440

我认为可以合理地说，学习任何强大的网格控件的时间都足够长，以至于你通常在你最了解的那个中更有效率。

然后是您尝试显示的数据“类型”的问题，并且：

*   如果您使用数据集
*   具有数据绑定的海关对象
*   或者只是使用 API 添加行

由于很少有人拥有在所有不同使用方式中使用多个网格控件的最新版本的丰富日常经验，因此我们不太可能得到这个问题的有用答案。

试用试用版也有同样的问题，因为您需要在每个网格上花费很多天才能决定是否喜欢网格的 API。

到目前为止，我发现最好的选择是尝试使用其中一个网格并在进行过程中询问供应商支持问题，我认为支持标准可能比网格本身的标准更重要，因为所有领先的供应商有合理的网格控制。 **在与您相同的时区寻找具有响应支持的供应商可能是最佳决定因素。**

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T15:38:49.647

组件一的 C1.FlexGrid 非常方便。如果您不想花钱，3.5 中的内置网格非常有用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-29T13:22:40.400

我的意见：看看[10Tec iGrid.NET](http://10tec.com/winforms-grid/)。如果您担心学习曲线，那么 iGrid 并非如此。只是一个代码示例，用于设置一个 2 列 4 行的网格，将“abc”放在第一个单元格中并用红色格式化：

```
IGrid1.Cols.Count = 2
IGrid1.Rows.Count = 4
IGrid1.Cells(0, 0).Value = "abc"
IGrid1.Cells(0, 0).ForeColor = Color.Red 
```

还有单元格样式，可用于格式化一系列单元格（如在 MS Word 中），内置分组和树形视图，支持自动过滤和通过附加组件打印。

如果我为这个网格和上面的网格写一个比较图表，我肯定会从价格开始。iGrid 便宜得多，但功能强大且非常稳定。性能也非常好，即使在Win7/Win8下的慢速平板上也是如此。

# java - 具有 2 个互锁实体类的 JPA 删除

> ID：807547
> 
> 赞同：1
> 
> 时间：2009-04-30T15:34:39.797
> 
> 标签：java, jpa

我有 2 个 EJB 3 实体 Bean：

```
@Entity
public class Organisation
{
    @Id
    @Column(length = 64)
    private String guid;

    private String name;

    @ManyToOne(fetch = FetchType.LAZY, cascade = CascadeType.REMOVE)
    @JoinColumn(name = "home_unit_fk", nullable = true)
    private Unit homeUnit;          
}

@Entity
public class Unit
{
    @Id
    @Column(length = 64)
    private String guid;

    private String name;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "organisation_fk", nullable = false)
    private Organisation organisation;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "parent_unit_fk", nullable = true)
    private Unit parentUnit;

    @OneToMany(mappedBy = "parentUnit", fetch = FetchType.LAZY, cascade = CascadeType.REMOVE)
    @OrderBy("shortName")
    @OptimisticLock(excluded = true)
    private Set<Unit> childUnits;   
} 
```

如果我使用标准 Dao 对组织进行删除：

```
public int deleteByGuid(final String guid) 
{
    final Query query = entityManager.createQuery("delete from " + getPersistentClass().getName() + " where guid = :guid");
    query.setParameter("guid", guid);
    return query.executeUpdate();
} 
```

但我得到以下异常：

com.mysql.jdbc.exceptions.jdbc4.MySQLIntegrityConstraintViolationException：无法删除或更新父行：外键约束失败（`config`. `unit`，CONSTRAINT `FK27D184F5D4393D`FOREIGN KEY（`organisation_fk`）REFERENCES `organisation`（`guid`））

我不明白。我究竟做错了什么？JPA/Hibernate 不应该在同一事务中对单元和组织执行删除吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-01T13:32:27.443

批量删除查询不会将对象加载到内存中，它会绕过关联上指定的任何级联。

我会将您的删除方法编码为：

```
public int deleteByGuid(final String guid){
    Organization org = entityManager.find(Organization.class, guid);
    entityManager.remove(org);
} 
```

如果您使用 Query 进行批量更新，则操作将直接委托给数据库。如果要删除子对象，则必须在“数据库”级别设置 DELETE CASCADE 触发器。

通过加载和删除对象，Hibernate 将在“对象”级别触发级联。

更多信息请访问：[http ://twasink.net/blog/2005/04/differences-in-behaviour-between-hibernate-delete-queries-and-the-old-way/](http://twasink.net/blog/2005/04/differences-in-behaviour-between-hibernate-delete-queries-and-the-old-way/)

# asp.net - ASP.net MVC Webforms 视图引擎的缺点？

> ID：807549
> 
> 赞同：7
> 
> 时间：2009-04-30T15:35:31.527
> 
> 标签：asp.net, asp.net-mvc

我目前正在计划一个基于 MVC 的新项目。现在，有几种不同的视图引擎，我只是想知道 Webforms 引擎的哪些缺点可以证明切换是合理的？有些人对此感到[非常强烈](http://twitter.com/codinghorror/statuses/1515727133)，我只是想知道为什么？

我还能在其他视图引擎中保留 .ascx 控件之类的东西，比如[Spark](http://sparkviewengine.com/)或[StringTemplate](http://code.google.com/p/string-template-view-engine-mvc)吗？（好吧，公平地说，这只是使用 RenderPartial 并传入适当的 ViewData，但它仍然是多个视图上常见“块”的模块化）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-30T15:39:57.287

根据我的经验，网络表单引擎唯一真正的缺点是冗长。Spark 更加简洁，并且支持局部（虽然不是 .ascx）和母版页。

你可以并排运行 Spark 和标准的 webforms 引擎，所以如果你遇到任何 spark 不适合你的情况，你仍然可以使用 webforms（虽然我不知道如何在它们之间共享母版页）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T23:18:10.277

[Stephen Walther](http://www.superexpert.com/blog/Default.aspx)有几个使用与 MVC 的 webforms 引擎不同的视图引擎的示例：

*   [ASP.NET MVC 技巧 #19 – 使用 nVelocity 视图引擎](http://www.superexpert.com/blog/archive/2008/07/14/asp-net-mvc-tip-19-use-the-nvelocity-view-engine.aspx)
*   [ASP.NET MVC 技巧 #35 – 使用 NHaml 视图引擎](http://www.superexpert.com/blog/archive/2008/08/20/asp-net-mvc-tip-35-use-the-nhaml-view-engine.aspx)

至于优势与劣势……我个人喜欢经典 asp'ish 风格的“标签汤”感觉。对我来说，感觉就像是一双舒适的旧鞋。

通过明智地使用 HtmlHelpers，标签汤通过具有可重复使用的“位”而大大减少。在经典的 ASP 中，我制作了类助手并将它们包含在页面中。在网络表单中，我滚动了网络控件。现在是 HtmlHelpers。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-06T03:23:56.383

我认为 MVC 视图引擎并没有那么糟糕。我也喜欢坚持“主流”，因为我确信 MVC 2.0 中会有我不想错过的新功能/帮助。我确信其他引擎做了一些非常好的事情，但是每次我偏离标准时，当我们想要升级到下一个技术或版本时，它都会设法找到我。

但是，话虽如此 - 了解其他引擎提供什么的唯一真正方法是用你已经构建或理解的东西来尝试它们，看看你是否喜欢你获得/放弃的感觉和/或能力。

# math - 我应该在我的数学游戏中使用表达式解析器吗？

> ID：807550
> 
> 赞同：7
> 
> 时间：2009-04-30T15:35:36.987
> 
> 标签：math, expression-trees, evaluation

我正在为一个班级写一些儿童数学教育软件。

我将尝试以有趣的方式通过随机生成的不同类型的数学问题向不同技能水平的学生提出问题。

使用基于计算机的数学软件的挫折之一是它的僵化。如果有人参加了在线数学课程，您就会知道参加在线测验并因为您的问题没有完全按照他们的形式或一些奇怪的间距问题而抛出正确答案的挫败感。

所以，最初我想，“我知道！我将在答案框中使用表达式解析器，这样我就可以评估他们输入的任何内容，即使它不是同一种形式，我也可以检查如果答案相同的话。” 所以我启动了我的 IDE 并开始实施[Shutting Yard 算法。](http://en.wikipedia.org/wiki/Shunting_yard_algorithm)

这将解决它不采取最小形式的分数的问题和其他问题。

然而，我突然想到，一个棘手的学生可以简单地将大部分问题输入答案框中，而我的表达式解析器会尽职尽责地解析并将其评估为正确答案！

那么，我不应该在这种情况下使用表达式解析器吗？我真的必须生成单一形式的答案并进行字符串比较吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T15:44:09.103

一种可能的解决方案是记下您的表达式评估器需要多少步来评估问题的原始表达式，并将其与最佳答案进行比较。如果差异太大，那么问题还没有被充分减少，你可以建议学生继续前进。

不过，如果学生提出的答案比您自己对“最佳”的定义更好，请不要感到惊讶！我是几个班级的助教/评分员，最聪明的学生通常在他们的问题集上得到优于教授提供的答案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T15:44:16.607

对于您正在寻找确切答案的简单问题，删除空格并进行字符串比较是合理的。

对于更高级的问题，您可以使用 Shunting Yard Algorithm（或类似算法），但可能对其进行参数化，以便您可以打开/关闭减少以防止棘手的学生。您会注意到“简单”答案仍然可以使用解析器，但您将禁用所有缩减。

例如，在除法问题上，您将禁用“/”减少。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T15:44:19.773

这是一个很好的问题。

如果您正在编写一个表达式系统和一个评估/转换/等效引擎（在某处没有可用的引擎吗？我几乎 100% 确定某处有一个开源引擎），那么它更像是一个教育/代数问题：是学生的答案在代数上更接近原始表达式或预期表达式。

我不确定如何回答，只是一个想法（不一定实用）：也许您的评估引擎可以将转换步骤计算为等效。如果答案对预期的步骤比对原始答案的步骤少，那可能没问题。如果它太接近原版，它不是。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T15:45:12.500

您可以使用表达式解析器，但对答案中允许的表达式的复杂性应用限制。

例如，如果目标是减少 (4/5)*(1/2)，并且您希望允许 (2/5) 或 (4/10)，那么您可以将允许答案的集合限制为树采用 (x/y) 形式，并且也计算为正确的数字。也许您还允许“0.4”，即计算结果为正确数字的 (x) 形式的表达式。

如果您手动对问题进行评分，这正是您将（隐含地）做的事情——您将寻找一个正确但也属于可接受的类别的答案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-12T21:45:19.993

在数学评估软件中执行此操作的常用方法是允许问题设置者指定正确答案中不允许的表达式/字符串。

如果您碰巧对现有软件感兴趣，可以使用开源 Stack [http://www.stack.bham.ac.uk/](http://www.stack.bham.ac.uk/)（或 MapleTA 等各种商业选项）。我怀疑你会遇到的大多数问题 Stack 也遇到过，所以即使你不想使用它，看看它是如何处理事情的也可能是有教育意义的。

# css - 动态数据网格

> ID：807571
> 
> 赞同：0
> 
> 时间：2009-04-30T15:38:54.873
> 
> 标签：css, datagrid

我的项目正在重新设计一个 HTML 数据网格，该网格使用 SQL 查询生成的 XML 和 XSL 构建到一个 HTML 表中。

表的内容在部署时是未知的，因为用于构建 XML 数据的 SQL 是由应用程序在运行时生成的。

鉴于对 CSS 世界中表格的厌恶，我希望有人对 HTML 应该是什么样子以及哪些资源可能有助于处理域的动态特性有更好的建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T15:58:14.203

大多数 Web 开发人员厌恶的不是表格本身，而是它们的误用——人们经常利用表格来定位网页上的内容/元素，这是“不可以”。但是没有人说使用表格来显示表格数据有什么问题——这就是 HTML 表格的用途。

因此，答案取决于来自您的数据库的数据的结构。

.

使用表格来做这样的事情：

订单：

```
--------------------------------------------------------
| Order ID  | Product Name  |  Order Date |  Ordered By |
--------------------------------------------------------
| 1         | blah blah     |  1/1/2009   |  Jane Doe   |
| 2         | blah blah     |  1/1/2009   |  Jane Doe   |
| 3         | blah blah     |  1/1/2009   |  Jane Doe   | 
```

.

不要将表格用于这样的事情：

```
"Hello, Jane Doe.  

Your order (#2), which was received on 1/1/2009, is being processed.  Sorry for the delay.

                                                    - Your friends at ABC Store" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T16:20:48.530

基于fall888 的答案，您可以用表格来做很多事情来构建HTML 中的数据。我可以推荐的一些好东西是：

*   使用`<thead>`、`<tbody>`和`<th>`元素。不要只做一排“粗体” `<td>`。
*   使用`<caption>`元素。
*   使用该`scope`属性将标题与行或列相关联。

Veerle 的博客有两个关于这个主题的优秀教程：

*   [CSS 样式表](http://veerle.duoh.com/blog/comments/a_css_styled_table/)
*   [一个 CSS 样式表版本 2](http://veerle.duoh.com/blog/comments/a_css_styled_table_version_2/)

# xslt - 为元素的每个值的第一次和最后一次出现生成上下文数据

> ID：807578
> 
> 赞同：1
> 
> 时间：2009-04-30T15:41:33.290
> 
> 标签：xslt, xpath

给定以下xml：

```
<container>
    <val>2</val>
    <id>1</id>
</container>
<container>
    <val>2</val>
    <id>2</id>
</container>
<container>
    <val>2</val>
    <id>3</id>
</container>
<container>
    <val>4</val>
    <id>1</id>
</container>
<container>
    <val>4</val>
    <id>2</id>
</container>
<container>
    <val>4</val>
    <id>3</id>
</container> 
```

我想返回类似的东西

```
2 - 1
2 - 3
4 - 1
4 - 3 
```

使用节点集，我已经能够通过以下方式获得最后一次出现：

```
exsl:node-set($list)/container[not(val = following::val)] 
```

但我不知道如何获得第一个。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T15:54:07.270

要获取每个“”组中的第一次和最后一次出现（文档顺序）`<val>`，您可以使用`<xsl:key>`这样的：

```
<xsl:stylesheet 
  version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
>
  <xsl:output method="text" />

  <xsl:key name="ContainerGroupByVal" match="container" use="val" />

  <xsl:variable name="ContainerGroupFirstLast" select="//container[
    generate-id() = generate-id(key('ContainerGroupByVal', val)[1])
    or
    generate-id() = generate-id(key('ContainerGroupByVal', val)[last()])
  ]" />

  <xsl:template match="/">
    <xsl:for-each select="$ContainerGroupFirstLast">
      <xsl:value-of select="val" />
      <xsl:text> - </xsl:text>
      <xsl:value-of select="id" />
      <xsl:value-of select="'&#10;'" /><!-- LF -->
    </xsl:for-each>
  </xsl:template>

</xsl:stylesheet> 
```

* * *

编辑＃1：有点解释，因为这可能不是很明显：

*   `<xsl:key>`返回`<container>`具有给定的所有节点`<val>`。您使用该`key()`函数来查询它。
*   这`<xsl:variable>`就是一切发生的地方。内容如下：
    *   对于文档中的每个`<container>`节点（“ `//container`”）检查...</li>
    *   …如果它与返回的第一个节点或返回的最后一个节点具有相同的唯一 id ( `generate-id()`)`key()``key()`
    *   where`key('ContainerGroupByVal', val)`返回与`<container>`当前匹配的节点集`<val>`
    *   如果唯一 ID 匹配，则将节点包含在选择中
*   `<xsl:for-each>`输出。它也可以是一个`<xsl:apply-templates>`.

* * *

编辑#2：正如 Dimitre Novatchev 在评论中正确指出的那样，您应该警惕使用 " `//`" XPath 速记。如果您可以避免它，请务必这样做——部分原因是它可能会选择您不想要的节点，主要是因为它比更具体的 XPath 表达式慢。例如，如果您的文档如下所示：

```
<containers>
  <container><!-- ... --></container>
  <container><!-- ... --></container>
  <container><!-- ... --></container>
</containers> 
```

那么你应该使用“ `/containers/container`”或“ `/*/container`”而不是“ `//container`”。

* * *

编辑#3：上面的另一种语法是：

```
<xsl:stylesheet 
  version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
>
  <xsl:output method="text" />

  <xsl:key name="ContainerGroupByVal" match="container" use="val" />

  <xsl:variable name="ContainerGroupFirstLast" select="//container[
    count(
        .
      | key('ContainerGroupByVal', val)[1]
      | key('ContainerGroupByVal', val)[last()]
    ) = 2
  ]" />

  <xsl:template match="/">
    <xsl:for-each select="$ContainerGroupFirstLast">
      <xsl:value-of select="val" />
      <xsl:text> - </xsl:text>
      <xsl:value-of select="id" />
      <xsl:value-of select="'&#10;'" /><!-- LF -->
    </xsl:for-each>
  </xsl:template>

</xsl:stylesheet> 
```

说明：XPath 联合运算符“ `|`”将它的参数组合成一个节点集。根据定义，一个节点集不能包含重复的节点——例如：“ `. | . | .`”将创建一个节点集只包含一个节点（当前节点）。

这意味着，如果我们从当前节点（“.”）、“ `key(…)[1]`”节点和“ `key(…)[last()]`”节点创建一个联合节点集，当（且仅当）当前节点等于其他两个节点，在所有其他情况下，计数将为 3。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T15:45:03.907

基本[XPath](http://www.w3schools.com/XPath/default.asp)：

```
//container[position() = 1]  <- this is the first one
//container[position() = last()]  <- this is the last one 
```

下面是一组更详细的[XPath 函数](http://www.w3schools.com/XPath/xpath_functions.asp)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T17:13:51.837

***一、XSLT 1.0***

**与 Tomalak 的解决方案基本相同，但更容易理解** *它也是完整的，因此您只需复制并粘贴 XML 文档和转换，然后只需按下您喜欢的 XSLT IDE 的“转换”按钮即可*：

```
<xsl:stylesheet version="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:output method="text"/>

    <xsl:key name="kContByVal" match="container"
     use="val"/>

    <xsl:template match="/*">
      <xsl:for-each select=
       "container[generate-id()
                 =
                  generate-id(key('kContByVal',val)[1])
                 ]
       ">

       <xsl:variable name="vthisvalGroup"
        select="key('kContByVal', val)"/>

       <xsl:value-of select=
        "concat($vthisvalGroup[1]/val,
              '-',
              $vthisvalGroup[1]/id,
              '&#xA;'
              )
      "/>
       <xsl:value-of select=
        "concat($vthisvalGroup[last()]/val,
              '-',
              $vthisvalGroup[last()]/id,
              '&#xA;'
              )
        "/>
      </xsl:for-each>
    </xsl:template>
</xsl:stylesheet> 
```

当此转换应用于最初提供的 XML 文档（编辑为格式正确）时：

```
<t>
    <container>
        <val>2</val>
        <id>1</id>
    </container>
    <container>
        <val>2</val>
        <id>2</id>
    </container>
    <container>
        <val>2</val>
        <id>3</id>
    </container>
    <container>
        <val>4</val>
        <id>1</id>
    </container>
    <container>
        <val>4</val>
        <id>2</id>
    </container>
    <container>
        <val>4</val>
        <id>3</id>
    </container>
</t> 
```

**产生了想要的结果**：

```
2-1
2-3
4-1
4-3 
```

**请注意**：

1.  **我们使用 Muenchian 方法进行分组**`container`，以便为​​每组具有相同值的此类元素找到一个元素`val`。
2.  **`container`从具有相同`val`值的元素的整个节点列表中**`container`，我们为组中的第一个元素和组中的最后一个元素输出所需的数据`container`。

***二、XSLT 2.0***

**这种转变**：

```
<xsl:stylesheet version="2.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xs="http://www.w3.org/2001/XMLSchema">
    <xsl:output method="text"/>

    <xsl:template match="/*">
      <xsl:for-each-group select="container"
           group-by="val">
        <xsl:for-each select="current-group()[1], current-group()[last()]">
          <xsl:value-of select=
           "concat(val, '-', id, '&#xA;')"/>
        </xsl:for-each>
    </xsl:for-each-group>
    </xsl:template>
</xsl:stylesheet> 
```

**当应用于与上述相同的 XML 文档时，会产生想要的结果**：

```
2-1
2-3
4-1
4-3 
```

**请注意**：

1.  `<xsl:for-each-group>`XSLT 指令的使用。

2.  函数的使用`current-group()`。

# sql-server - 如何减少因数据类型更改而增长的 SQL Server 表的大小

> ID：807579
> 
> 赞同：24
> 
> 时间：2009-04-30T15:41:37.457
> 
> 标签：sql-server, types, database-table

我在 SQL Server 2005 上有一个大小约为 4gb 的表。

（约 1700 万条记录）

我将其中一个字段从数据类型更改`char(30)`为`char(60)`（总共有 25 个字段，其中大部分是`char(10)`所以字符空间的数量加起来约为 300）

这导致表的大小加倍（超过 9GB）

然后我将其更改`char(60)`为`varchar(60)`然后运行一个函数以从数据中删除额外的空格（以便将字段中数据的平均长度减少到大约 15）

这并没有减少表的大小。缩小数据库也无济于事。

除了实际重新创建表结构并复制数据（即 1700 万条记录！）之外，是否有一种不那么激烈的方法可以再次减小大小？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-30T18:22:55.510

即使使用“收缩数据库”，您也没有清理或压缩任何数据。

[DBCC 可清理](http://msdn.microsoft.com/en-us/library/ms174418.aspx)

> 从表或索引视图中删除的可变长度列中回收空间。

但是，*如果有聚集索引*，也应该进行[简单的索引重建](http://technet.microsoft.com/en-us/library/ms188388(SQL.90).aspx)

 *```
ALTER INDEX ALL ON dbo.Mytable REBUILD 
```

[托尼·罗杰森 (Tony Rogerson) 的一个工作示例](https://web.archive.org/web/20170629065414/http://sqlblogcasts.com/blogs/tonyrogerson/archive/2007/08/27/alter-table-drop-column-does-not-reclaim-the-space-the-column-took-it-s-a-meta-data-change-only.aspx)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-04-30T15:57:01.833

那么很明显你没有得到任何空间回来！:-)

当您将文本字段更改为 CHAR(60) 时，它们都会被空格填满。因此，您的所有字段现在实际上都是 60 个字符长。

将其改回 VARCHAR(60) 将无济于事 - 这些字段仍然都是 60 个字符长......

您真正需要做的是在所有字段上运行 TRIM 函数以将它们减少回修剪后的长度，然后进行数据库收缩。

完成此操作后，您需要重建聚集索引以回收一些浪费的空间。聚集索引实际上是您的数据所在的位置 - 您可以像这样重建它：

```
ALTER INDEX IndexName ON YourTable REBUILD 
```

默认情况下，您的主键是您的聚集索引（除非您另有指定）。

马克

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-30T15:53:56.990

我知道我没有按照您的要求回答您的问题，但是您是否考虑过将一些数据存档到历史记录表中并使用更少的行？

大多数时候，乍一看，您可能会认为您一直需要所有这些数据，但当您真正坐下来检查它时，有些情况并非如此。或者至少我以前经历过这种情况。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T15:49:09.327

[我在SQL Server 中](https://stackoverflow.com/questions/487324/sql-server-converting-ntext-to-nvarcharmax)遇到了类似的问题，将 NTEXT 转换为 NVARCHAR(MAX) ，这与将 ntext 更改为 nvarchar(max) 有关。

我必须做一个`UPDATE MyTable SET MyValue = MyValue`才能让它很好地调整所有东西的大小。

这显然需要相当长的时间，有很多记录。关于如何更好地做到这一点，有很多建议。他们的关键之一是一个临时标志，指示它是否已完成，然后在循环中一次更新几千个，直到全部完成。这意味着我对它的工作量有“一些”控制权。

但另一方面，如果你真的想尽可能地缩小数据库，如果你将恢复模式降低为简单，缩小事务日志，重新组织页面中的所有数据，然后将其设置回完整状态，它会有所帮助恢复模式。但要小心，通常不建议缩小数据库，如果您减少活动数据库的恢复模型，您就是在要求出现问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T15:59:35.010

或者，您可以进行全表重建，以确保任何地方都没有多余的数据：

```
CREATE TABLE tmp_table(<column definitions>);
GO
INSERT INTO tmp_table(<columns>) SELECT <columns> FROM <table>;
GO
DROP TABLE <table>;
GO
EXEC sp_rename N'tmp_table', N'<table>';
GO 
```

当然，身份，索引等变得更加复杂......

# c# - C# 中的域驱动开发 - 示例 Web 应用程序

> ID：807581
> 
> 赞同：1
> 
> 时间：2009-04-30T15:41:56.020
> 
> 标签：c#, domain-driven-design

C# / Microsoft 堆栈中的 DDD 是否有任何推荐的示例（当然有源代码）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T15:50:49.103

[MVC 店面](http://blog.wekeroad.com/category/mvc-storefront)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T21:07:56.000

很快就会有一个 S#arp 架构示例。

[http://wiki.sharparchitecture.net/](http://wiki.sharparchitecture.net/)
[http://groups.google.com/group/sharp-architecture](http://groups.google.com/group/sharp-architecture)

**编辑：新的 S#arp 架构版本中包含一个示例应用程序。** [http://code.google.com/p/sharp-architecture/downloads/list](http://code.google.com/p/sharp-architecture/downloads/list)
它位于 src/NothwindSample 文件夹中。显然，它还没有在 wiki 中详细说明。

# excel - Excel 作为网站的后端？

> ID：807585
> 
> 赞同：4
> 
> 时间：2009-04-30T15:43:31.040
> 
> 标签：excel, asp-classic

我老板请来的第三方开发人员设计了一个比我们现在使用的 ASP.NET + MSSQL Server 2005 网站“更好”的系统。

以下是相关规格：

*   Excel + ODBC 作为数据存储
*   使用老式 ASP 构建，而不是 ASP.NET

他的解决方案与古代技术相比有什么明显的问题吗？线程安全等？

让我这么说吧，“有什么可以告诉我的老板（他只是部分技术人员）将这段代码从水中吹出来？”

谢谢，

报复性开发者:)

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-30T15:54:16.707

Excel永远不应该用作数据存储，

1.  它不是数据库

2.  它根本不会同时处理多个用户

3.  不支持事务，因此如果在 odbc 调用过程中发生错误，excel 文件最终可能会被丢弃。（甚至访问会比使用 excel 更好，这没什么好说的）

4.  Excel 是一种电子表格，专为分析数据而非存储数据而设计。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-30T15:59:17.227

直接来自微软： http: [//support.microsoft.com/kb/195951](http://support.microsoft.com/kb/195951)

> 重要提示：虽然 ASP/ADO 应用程序支持多用户访问，但 Excel 电子表格不支持。因此，这种查询和更新信息的方法不支持多用户并发访问。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-01T05:52:53.960

艾伦，以及这里出来的巨大技术原因，我认为你需要问自己“老板为什么要这样做？”

感知就是现实，如果你的老板只是部分技术，那么纯粹的技术推理可能无法通过。

除了明显的架构弱点之外，这个怪物是否有一些**功能**让它对你的老板更有吸引力？通常人们不会故意做愚蠢的事情，在你做[CLM](http://catb.org/jargon/html/C/CLM.html)之前考虑你的老板来自哪里可能对你很有帮助。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-30T15:48:39.483

嗯....它缺乏可扩展性：您只能拥有几个用户。数据重要吗？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-08T02:16:16.543

以下是您可以告诉他的内容：提醒他当两个或更多人需要同时编辑同一个电子表格时发生的噩梦。现在告诉他想象乘以一百个不能互相打电话告诉他们“关闭电子表格以便我可以更新它”的人。*这*就是它的样子。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-30T15:47:21.530

处理单独的 xls 数据存储和 sql server 2005 的同步问题？在我们的 IIS 服务器上，默认禁止经典的 asp 页面。也许这是一个标志，哈哈。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-30T15:48:32.680

糟糕的性能怎么样，因为 Excel 不是为用作数据库而设计的？告诉你的老板 Excel 甚至不是单用户数据库（这就是 MS Access），更不用说为高性能、并发性能而设计的多用户数据库了。

当然，通过使用纯 ASP，您将无法访问所有库 .NET 框架（这当然是 MS 生态系统中所有库开发人员都关注的内容）。但是你问了一个原因，第一个更好。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-30T15:51:01.550

我会相信这些是工作的错误工具（假设它们是你的情况）。这就像使用螺丝刀作为锤子一样。对于一个指甲，它可能需要大量的汗水和眼泪。对于一个真正的项目，通过，这可能是注定的。

我会吹嘘你熟悉的工具——这些工具在性能、安全性、维护（尤其是维护成本）方面有多好。

你可以说他付钱给某人用十年前的技术编写一个新应用程序，可能不会支持更长时间（如果它仍然是......）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-08T01:53:07.130

嗯...行限制？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-30T15:52:26.650

Excel 电子表格甚至可以正确处理并发事务吗？它不是为这种事情而设计的，如果它做了坏事（比如一次只允许一个 ODBC 连接，或者没有正确锁定并发更新），我不会追究它的责任。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-30T15:53:15.853

那个excel文件很快就会被破坏，很多人同时点击它。Excel 作为后端数据存储的可扩展性几乎不存在。它的原生共享工作簿功能很难保持数据完整性......

BTW-这个第三方是你老板的亲戚吗？？？哎呀...

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-30T15:54:42.370

古老的技术本身就是一个明显的问题。你会永远在身边吗？老板很难找到新的开发人员来维护这样的东西。科技世界已经向前发展。

# sql-server-2005 - 在 SQL Server 2005 中安全地修改复制列的数据类型？

> ID：807587
> 
> 赞同：2
> 
> 时间：2009-04-30T15:44:03.520
> 
> 标签：sql-server-2005, replication

我将执行什么命令来安全地更改（即从 int 到 bigint）SQL Server 2005 中复制列的数据类型？

该列不是键。列上有一个非聚集索引。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T15:51:17.010

```
ALTER TABLE MyTable 
    ALTER COLUMN myIntCol bigint 
```

来自[BOL](http://msdn.microsoft.com/en-us/library/ms152562.aspx)：

> 默认情况下，在运行 SQL Server 的发布服务器上进行的以下架构更改会复制到所有 SQL Server 订阅服务器：
> 
> *   更改表
> *   改变视图
> *   改变程序
> *   改变功能
> *   改变触发器

# c# - 重构启用/禁用按钮切换功能

> ID：807594
> 
> 赞同：1
> 
> 时间：2009-04-30T15:44:46.403
> 
> 标签：c#, refactoring

我有以下简单的功能：

```
 private void EnableDisable941ScheduleBButton()
    {
        if (this._uosDepositorFrequency.Value != null)
            this._btnScheduleB.Enabled = ((int)this._uosDepositorFrequency.Value == 0);
    } 
```

它是我试图将其拆分为被动视图和演示者的 Winform 类的成员。很明显，业务逻辑与 UI 布线纠缠在一起。我只是不确定将它们分开的最佳方法。

为了提供一点上下文，该函数是从表单中的三个位置调用的。_uosDepositorFrequency 是一个单选按钮组，只有两个按钮。

有任何想法吗？

更新：

好吧，也许它不像我想象的那么明显。业务规则规定，如果雇主每半周进行一次存款 (_uosDepositorFrequency.Value = 0)，他们需要填写附表 B 表格。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T16:10:24.627

主持人：

```
 if(this._uosDepositorFrequency.Value > 0) //int objects cannot be null
         ViewData["ScheduleBRequired"] = true; 
```

看法：

```
 private     void Draw()
    {
            if ((bool)ViewData["ScheduleBRequired"]){
                    this._btnScheduleB.Enabled = true;
                    this._validatorScheduleB.Active = true; //required data should be checked clientside with js
            }
    } 
```

如果是业务需求，应该填写，应该由演示者触发。用户界面负责遵循演示者的决定。例如是否需要 ScheduleB....

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T15:48:16.113

我不认为这是商业逻辑。对我来说，它看起来像 UI 逻辑。我不会改变它。

虽然如果我使用 wpf，我会将启用状态绑定到数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T15:50:42.300

也许我遗漏了一些东西，但我不确定我在那里看到了业务逻辑。您只是根据表单上的另一个控件是否具有价值来启用/禁用按钮。我认为不需要重构此方法，这对我来说都是视图逻辑。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T16:02:02.867

听起来您将 UI 逻辑和业务规则混淆为一回事。您拥有的代码是 UI 逻辑，不应重构。您所说的业务规则是，如果`_btnScheduleB`值为，`0`则您需要让用户填写表格。您的业​​务逻辑应该是确保`_btnScheduleB`在用户可以继续之前启用时您已经填写了表单。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T16:11:04.843

另一种选择（我并不是说它更好）是让无线电控件的选择更改事件更新模型（雇主实体？），这反过来会触发 UI 订阅的某种 DepositorChanged 事件和相应地启用/禁用计划按钮。观察者模式，或多或少。

也就是说，上述替代方案会产生更多的复杂性，我建议将其留给 UI 代码（添加关于它的注释或使用中间布尔变量向读者说明意图）。特别是如果这是唯一使用该规则的地方。

关于代码的旁注：这是在使用下划线前缀类字段或使用`this.`替代之间进行的宗教辩论。我认为每个人都同意使用两者是多余的......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T16:12:30.173

正如其他人所指出的那样，这使您的 UI 保持一致，因此实际上不是业务逻辑。不过，您可以像这样删除空检查。

```
this._btnScheduleB.Enabled = (int)(this._uosDepositorFrequency.Value ?? 0) == 0; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T16:13:03.167

我不会太担心重构 2 行代码，除非它在当前格式中**真的**没有意义。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-30T21:16:41.737

首先，我要感谢所有回答我问题的人。

我花了一些时间来解决这个问题，我相信我已经想出了一个解决方案。

首先，我将 _uosDepositorFrequency.Value 和 _btnScheduleB.Enabled 公开为公共属性并更新视图界面，​​我还花了一些时间为存款频率定义一个枚举。

```
 public bool EnableScheduleB
    {
        get
        {
            return _btnScheduleB.Enabled;
        }
        set
        {
            _btnScheduleB.Enabled = value;
        }
    }

    public DepositFrequency DepositorFrequency
    {
        get
        {
            return (DepositFrequency)_uosDepositorFrequency.Value;
        }
        set
        {
            _uosDepositorFrequency.Value = (int)value;
        }
    } 
```

然后我将原始函数的主体复制到我的演示者并修改它以使用我刚刚创建的属性。由于 _uosDepositorFrequency 控件已在其他地方初始化，原始函数中的 null 检查结果是不必要的。

```
 public void UpdateScheduleBStatus()
    {
        ReturnView.EnableScheduleB = ReturnView.DepositorFrequency == DepositFrequency.Semiweekly;
    } 
```

最后，_uosDepositorFrequency_ValueChanged 事件处理程序被更新为调用 UpdateScheduleBStatus。

```
 private void _uosDepositorFrequency_ValueChanged(object sender, System.EventArgs e)
    {
        Presenter.UpdateScheduleBStatus();
    } 
```

欢迎评论。

# fluent-nhibernate - 流畅的 NHibernte 更改/约定

> ID：807595
> 
> 赞同：0
> 
> 时间：2009-04-30T15:45:03.330
> 
> 标签：fluent-nhibernate, conventions

我喜欢我在这篇博文 ( [http://marekblotny.blogspot.com/2009/04/conventions-after-rewrite.html](http://marekblotny.blogspot.com/2009/04/conventions-after-rewrite.html) ) 中看到的模式，作者正在检查是否已经更改了表名在应用约定之前。

```
public bool Accept(IClassMap target)
{
    //apply this convention if table wasn't specified with WithTable(..) method
    return string.IsNullOrEmpty(target.TableName);
} 
```

我用于字符串长度的约定接口是 IProperty：

```
public class DefaultStringLengthConvention: IPropertyConvention
{
    public bool Accept(IProperty property) {
        //apply if the string length hasn't been already been specified
        return ??; <------ ??
    }

    public void Apply(IProperty property) {
        property.WithLengthOf(50);
    }
} 
```

我看不到 IProperty 在哪里公开任何告诉我该属性是否已设置的信息。这可能吗？

TIA，贝里尔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T16:48:52.537

`.WithLengthOf()``Action<XmlElement>`在生成 XML 映射时应用的更改列表中添加一个“更改”( )。不幸的是，该字段是`private`并且没有访问更改列表的属性，所以恐怕（目前）没有办法检查属性映射是否已`WithLengthOf`应用于它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-01T19:30:06.977

在出现更好的替代方案之前，您可以使用`HasAttribute("length")`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-06T16:26:58.627

为了在代码中阐明 Stuart 和 Jamie 所说的内容，以下是有效的：

```
public class UserMap : IAutoMappingOverride<User>
{
    public void Override(AutoMap<User> mapping) {
        ...
        const int emailStringLength = 30;
        mapping.Map(x => x.Email)
            .WithLengthOf(emailStringLength)                        // actually set it
            .SetAttribute("length", emailStringLength.ToString());  // flag it is set
        ...

    }
}

public class DefaultStringLengthConvention: IPropertyConvention
{
    public bool Accept(IProperty property) {
        return true;
    }

    public void Apply(IProperty property) {
        // only for strings
        if (!property.PropertyType.Equals(typeof(string))) return;

        // only if not already set
        if (property.HasAttribute("length")) return;

        property.WithLengthOf(50);
    }
} 
```

# ms-access - 在创建手持数据库应用程序时使用什么

> ID：807601
> 
> 赞同：0
> 
> 时间：2009-04-30T15:47:08.690
> 
> 标签：ms-access, vba, windows-ce, jet

哪种程序/编程语言最适合在 Windows 5 CE 手持式扫描仪上创建类似 Access 的数据库？

我们已经尝试过 Visual CE，但它并不是我们真正可以使用的东西。最终，我们希望构建一个系统，我们可以扫描条形码，从下拉列表中选择用户，选择划分、位置和从一个位置移动到另一个位置的基本选项。访问将是完美的，但我似乎找不到任何可比的东西。

任何建议，将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T16:05:47.227

在运行 Windows CE 的条码扫描仪（如符号技术扫描仪）上。您可以轻松地使用 Visual Studio 2005 和 2008 并在 VB.net 或 C# 中进行开发（尽管它至少需要专业版的烦人）。对于数据库后端，有一个 SQl Server Ce，它是设计用于在 ce 设备上运行的 SQL Server 的较小版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T16:09:57.590

我会使用[SQLite](http://www.sqlite.org/)作为您应用程序的数据库后端。它在嵌入式设备中运行良好。它被[广泛使用](http://www.sqlite.org/famous.html)，您可以获得[专业的支持](http://www.sqlite.org/support.html)。

# mysql - 使用 Access 或 MySQL 作为后端数据库

> ID：807602
> 
> 赞同：1
> 
> 时间：2009-04-30T15:47:15.507
> 
> 标签：mysql, database, ms-access, ms-access-2007, backend

我正在编写一个带有访问前端的分布式数据库应用程序。本质上是一个带有一些表格和报告的 mde。我应该使用访问 mdb 来保存后端表还是使用 MySQL 或其他数据库？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T15:49:43.053

我个人会使用 SQL Server Express 或 MySQL。它们比 Access 后端扩展得更好，当您准备好离开 Access 时，您无需转换后端和前端即可完成此操作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-30T16:10:10.633

SQL Server Express 可能是一个很好的解决方案，但它也有一些非常严格的限制。此外，您需要确保其许可证符合您的需求。

如果您的并发性和可伸缩性需求受到限制（例如 10-15 个具有中等 I/O 量的并发用户），则使用 MDB 后端没有任何问题。我不是 Access 的粉丝，但我从经验中知道这通常会奏效。

此外，管理 MDB 后端几乎是免费的，而 MySQL 或 SQL Server Express 则需要一些实际的 DBA 工作。如果你有理由确定你永远不需要它，那么使用更大的东西是没有意义的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T16:11:50.270

对于实际部署，您可能希望使用真正的数据库，而不是 Access/Jet DB 引擎。

话虽如此，访问的好处在于它有一个工具（在菜单中查看）将单个 MDB 文件拆分为数据库和代码。这样做，然后将代码瞄准新的数据源。

您可能需要稍微修改一些查询。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T16:12:29.533

我认为 SQL Server Express 将是您的最佳选择。MySQL 是一个很好的后端数据库，但 Access 与 SQL Serv Express 集成得更好（当然，MS 希望你使用它自己的产品，即使它是免费的），而且 Express 版本非常好，因为它是免费的。如果应用程序最终需要在以后大规模扩展，那么升级到付费 SQL Server 很简单，驱动程序也是一样的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-01T21:05:25.703

我认为您应该定义“分布式数据库应用程序”的含义。据我了解，该术语通常会使 Jet 退出后端的运行。

如果没有说明用户数量、操作环境、安全性和可靠性要求等，没有人可以真正回答您的问题。如果是针对 10 个用户且不是业务线数据，那么 Jet 后端可能是完美的，并且可以进行开发和管理小菜一碟。如果您有 100 个用户，您肯定希望使用服务器后端。如果您有重要的安全考虑（例如，HIPAA 合规性），您可能希望使用具有内置服务器级安全性的数据库，而不是使用 Jet。

但是有很多应用程序都可以使用 Jet 后端——快速且完全可靠。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-05T04:13:21.983

还有第三种选择：您可以使用[EQL Data](http://eqldata.com/)之类的东西，这样您就可以使用普通的 Access 后端，但为每个人提供自己的副本（并在他们之间同步）以帮助解决多用户可伸缩性问题。这样，您就无需考虑使用“真实”数据库后端的复杂性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-11-12T18:57:20.707

选择 MySQL，您需要在每个客户端中安装 MySQL 连接器 (ODBC)。如果您不喜欢分发其他组件，SQL Server Express 将是一个不错的选择，此外，ADO 与 MS SQL 配合得更好。

# windows - 如何在 Subversion 签出期间翻译文件名？

> ID：807608
> 
> 赞同：0
> 
> 时间：2009-04-30T15:48:18.640
> 
> 标签：windows, svn, path, rename

Subversion 是否支持在签出/导出和提交期间翻译文件名路径组件？例如，我可以设置 SVN（客户端或服务器端，没关系）自动替换路径名中的和 ':' 字符，用字符 '+' 替换它们吗？

基本上，Windows 不能容忍文件名中的某些字符（例如 ':'），官方建议当 Windows 客户端可能需要访问您的存储库时不要使用这些字符。有时，这不是一个选项：我们将 Linux /etc/ 配置树保留在 SVN 中，具有接口别名的机器在 'sysconfig/network-scripts' 下具有像 'ifcfg-eth0:0' 这样的文件名。

Subversion 客户端（或我现在正在使用的 Eclipse 编辑器）有什么方法可以在结帐/导出时自动翻译任意路径组件，然后在提交期间重新翻译回来？如果没有，SVN 服务器端钩子脚本有什么办法来处理这个吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T15:51:38.163

您正在寻找 SVN 支持的钩子，但没有用于结帐的钩子。然而，TortoiseSVN 客户端可以。这可能是您正在寻找的，[http](http://tortoisesvn.tigris.org/tsvn_1.5_releasenotes.html#client-side-hooks) ://tortoisesvn.tigris.org/tsvn_1.5_releasenotes.html#client-side-hooks 。

# ajax - SharePoint Ajax Web 部件 web.config 问题

> ID：807620
> 
> 赞同：0
> 
> 时间：2009-04-30T15:50:44.110
> 
> 标签：ajax, sharepoint, web-config, updatepanel

您好我在我的 Web 部件中使用 AJAX Extensions 1.0。当我将它添加到 SharePoint 时效果很好，并且一切运行良好。我还有指向其他应用程序的链接，这些应用程序作为 IFRAME 放在 SharePoint 上。我遇到了从我的 SharePoint web.config 继承的应用程序的问题。我在 IFRAME 中收到此错误：

解析器错误消息：已添加条目“ScriptModule”。

```
Line 98:        <!-- ASP.NET AJAX -->
Line 99:        <httpModules>
Line 100:           <add name="ScriptModule" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
Line 101:       </httpModules>
Line 102:       <compilation debug="true"> 
```

我认为这是因为 SharePoint web.config 也包含这一行。我无法从那里删除它，因为我的 Web 部件需要它。我想添加`<clear/>`我的 IFRAME 应用程序来解决这个问题，但我有很多应用程序，我不确定是否有不止一次的地方需要这样做。有更好的解决方案吗？谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T16:37:59.740

您必须修改全局 web.config。可以通过 WebConfigModification 来完成（不记得类的全名，已经有一段时间了）。我使用的 CodePlex 上提供了 Ajaxify MOSS 功能，它工作得很好。看看那里。 [http://ajaxifymoss.codeplex.com/](http://ajaxifymoss.codeplex.com/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-12T18:28:29.710

尝试这个

`<httpModules> <clear />
<add name="ScriptModule" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
</httpModules>`

# wpf - 什么属性从字符串对象（用于绑定）返回字符串的值？

> ID：807622
> 
> 赞同：1
> 
> 时间：2009-04-30T15:50:52.487
> 
> 标签：wpf, converter

我有一个转换器，它接受一个字符串作为输入并返回一个图标。它用于提供在列表框中使用的图标。当 itemsSource 设置为其项目具有返回字符串的属性的列表时，XAML 如下所示：

```
<Image Source="{Binding FileName, Converter={StaticResource FileNameToIconConverter}}"/> 
```

也就是说，列表中的对象有一个名为 FileName 的属性，它是字符串类型。

但是，我有另一个列表框，其 itemsSource 是一个列表。在这种情况下，可以使用什么属性来检索要发送给转换器的 List 的字符串值？

```
<Image Source="{Binding ??, Converter={StaticResource FileNameToIconConverter}}"/> 
```

谢谢，特德

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T15:57:39.647

我不确定我是否遵循您的问题，但听起来好像您正在绑定到`string`s 列表并且您想直接绑定到字符串而不是`string`类本身的属性？在这种情况下，不要指定路径，或指定“.”。作为路径：

```
<Image Source="{Binding Converter={StaticResource FileNameToIconConverter}}"/> 
```

或者

```
<Image Source="{Binding ., Converter={StaticResource FileNameToIconConverter}}"/> 
```

# .net - 所有内部程序集与具有外部依赖项的程序集

> ID：807624
> 
> 赞同：0
> 
> 时间：2009-04-30T15:51:09.070
> 
> 标签：.net

如果我有两个程序集，一个只包含业务规则（程序集 A），另一个充当外部依赖项（如文件系统、数据库、Web 服务等）的接口（程序集 B），应该 A 引用 B 还是应该B 参考 A?

例如：

如果我有一个 SourceCodeInterpreter 类（程序集 A），它应该实例化一个 SourceCodeFileReader（在程序集 B 中）以读取数据，还是应该 SourceCodeFileReader 在读取源文件后实例化一个 SourceCodeInterpreter 类然后启动解释器？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T16:18:04.810

这一切都取决于将如何使用事物。如果程序集使用在另一个程序集中定义的类型，则需要对其进行引用。我尽量避免在程序集之间添加依赖项，除非它们确实有存在的理由。

在您的示例中，我会尝试将两个程序集分开。您的应用程序最有可能使用这两个程序集。您的应用程序可以引用两者，并且它们可以是独立的。该应用程序将使用 SourceCodeFileReader 读取您的代码，然后将其传递给您的 SourceCodeInterpreter 以解释它。

但是，如果您试图使这需要使用单一类型，我会将“顶级”程序集作为包含对“较低级别详细信息”的引用的程序集。在这种情况下，这可能意味着让解释器引用读者——因为读者是较低级别的，并且本身无用。

# c# - 如何以编程方式检查/设置对网络驱动器的访问权限？

> ID：807627
> 
> 赞同：0
> 
> 时间：2009-04-30T15:51:17.480
> 
> 标签：c#, permissions, network-drive

您如何检查您是否有权访问网络驱动器（但是 - 因为在您之前在此 Windows 会话中至少导航一次并输入名称/密码后它会正常工作）而不等待 IOException 在尝试访问时它？

在那张纸条上，假设我可以通过对话框获取我的用户名/通行证，我该如何设置他们对该网络文件夹的访问权限？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T15:59:27.227

一般来说，我认为最好只处理异常。在检查和尝试访问驱动器之间，您不能 100% 肯定您可以访问。更不用说可能发生的所有其他错误。

# php - htaccess（无重定向）[REWRITEURL]（index.php的文件夹）

> ID：807630
> 
> 赞同：4
> 
> 时间：2009-04-30T15:52:03.000
> 
> 标签：php, .htaccess

我只是想获得一个快速的 htaccess 重定向。IE：

domain.com/subfolderGreen --> domain.com/index.php?folder=subfolderGreen

（注意子文件夹Green 实际上存在）

我一直在尝试，但无法获得所需的正则表达式。

谢谢。一种。

添加：

抱歉，我希望它适用于任何子文件夹，而不仅仅是我正在使用的“subfolderGreen”

RewriteRule ^/([^/]+)/?$ /index.php?folder=$1 [L]

但它不起作用。任何线索？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T16:20:35.647

我认为您的示例会导致无限循环，因为 /index.php 与您正在执行的操作相匹配。试试这个：

```
RewriteRule ^([A-Za-z0-9]+)/?$ /index.php?folder=$1 [L] 
```

如果您希望它适用于所有存在的目录，这可能也适用。

```
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^(.+)/?$ /index.php?folder=$1 [L] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T15:59:52.013

```
RewriteRule ([^/]+)$ index.php?folder=$1 
```

我认为这会奏效。

RewriteRule 在 .htaccess 中使用时有一些令人困惑的问题，需要添加 RewriteBase。

您看到什么错误/问题？如果您想确定它是如何重定向的，添加 [R] 通常可以帮助调试。

最后...... subfolderGreen 是否真的存在？如果存在，可能会导致一些问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T15:55:13.570

我相信它是：

```
RedirectMatch 301 domain.com/(.*) domain.com/index.php?folder=$1 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-30T15:54:42.433

```
RewriteEngine on
RewriteCond %{THE_REQUEST} ^[A-Z]+\ /(([^/\ ]+/)*)/+([^\ ]*)
RewriteRule ^ /%1%3 [L,R=301]
RewriteRule ^([^/]+)/?$ index.php?folder=$1 [L] 
```

如果有人访问 website.com/mypage/////，第 2 行将处理这种情况，因此它默认为 website.com/mypage/（我认为）

# linux - Linux 的 /usr/ldbin/resetpw 变体

> ID：807633
> 
> 赞同：0
> 
> 时间：2009-04-30T15:53:13.323
> 
> 标签：linux, hp-ux

我有一个应用程序可以调用 HPUX resetpw 命令。它在 Linux 中不存在。我可以从我的代码中引用另一个具有类似功能的命令吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T20:40:18.580

如果 'resetpw' 听起来像，你可能需要 linux 上的 'passwd' 命令。

以下是一些对用户帐户管理有用的其他命令。 [http://www.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/s1-users-tools.html](http://www.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/5/html/Deployment_Guide/s1-users-tools.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-19T20:56:03.970

最终通过使用 AD 身份验证避免了整个事情。

# visual-studio - 通过插件覆盖视觉工作室语法突出显示？

> ID：807639
> 
> 赞同：2
> 
> 时间：2009-04-30T15:54:17.050
> 
> 标签：visual-studio, visual-studio-2008, visual-studio-2005

这与[我之前询问的](https://stackoverflow.com/questions/807404/displaying-code-sections-with-a-different-background-color)关于语法突出显示用户定义的代码块的问题有关。

是否可以为 Visual Studio 编写某种插件，它会覆盖语法高亮的方式？我从哪里开始寻找呢？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T16:32:44.370

这个有可能。许多 VS 插件，例如 Visual Assist、Resharper、Code Rush 等，都对 Visual Studio 中的语法高亮工作方式进行了扩展。

如果你想自己写......

查看VSX 参考文档中[有关语法着色的页面。](http://msdn.microsoft.com/en-us/library/bb165803.aspx)

您需要使用的接口是[IVsColorizer2](http://msdn.microsoft.com/en-us/library/microsoft.visualstudio.textmanager.interop.ivscolorizer2.aspx)（或 IVsColorizer）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T16:16:31.910

显然这是可能的，因为[Visual Assist](http://www.wholetomato.com/)做到了。
但我真的不知道在哪里寻找如何去做。也许您可以尝试在 Visual Assist 中戳一下，看看哪个调用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-02T00:50:20.950

如果您今天真的需要它，我会推荐 CodeRush/DXCode，您可以获得免费版本。如果您在他们的[社区论坛](http://community.devexpress.com)中提问，他们通常会非常有帮助地为您指明正确的方向。

如果您可以等待，那么在 Visual Studio X 中进行这种思考应该非常容易

# .net - 寻找 .net 的最佳开源 Mocking 框架

> ID：807646
> 
> 赞同：5
> 
> 时间：2009-04-30T15:55:12.150
> 
> 标签：.net, mocking

我知道这是相当主观的，但我正在潜入测试和学习模拟，我正在尝试确定我应该使用哪个框架。如果你能告诉我你推荐了哪些，最重要**的是为什么它比你用过的其他更好，**我会很高兴。或者，如果有人知道我在哪里可以得到一个也有帮助的并排比较。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-30T16:27:40.387

[起订](http://code.google.com/p/moq/)量是最先进的。它使用 .NET 3.5 和 C# 3.0 的所有功能。这会很有趣：

*   [Moq：应用于 Mock 对象的 Linq、Lambda 和谓词](http://www.hanselman.com/blog/MoqLinqLambdasAndPredicatesAppliedToMockObjects.aspx)
*   [起订量与犀牛模拟的比较](http://haacked.com/archive/2008/03/23/comparing-moq-to-rhino-mocks.aspx)
*   [TDD：起订量简介](http://stephenwalther.com/blog/archive/2008/06/12/tdd-introduction-to-moq.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-02-01T09:10:56.593

我用过 Rhino.Mocks、Moq 和 NMock。我以前更喜欢起订量。

我现在使用 NSubstitute... 并发现它的语法比 moq 的语法要好得多，而且你不会因为权力而牺牲任何东西。

我曾经写过这样的测试：

```
[Test]
public void SomeOtherTest()
{
    //Arrange
    var mock = new Mock<IFoo>();
    var sut = new SystemUnderTest(mock.Object); //never liked doing it this way...
    mock.Setup(m => x.Bar()).Returns("A whole bunch of ceremonial syntax..");
    //Act
    sut.DoSomething();
    //Assert
    mock.Verify(m => m.Baz()); //Baaaaah, more laaaaambdas
} 
```

现在我陶醉于非 lambda-eryness

```
[Test]
public void NSubTest()
{
    var mock = Substitute.For<IFoo>();
    var sut = new SystemUnderTest(mock); //much nicer!
    mock.Bar().Returns("Look ma! No lambdas!");

    sut.DoSomething();

    mock.Received().Baz();
} 
```

最后一点......它在github上......

[http://nsubstitute.github.com/](http://nsubstitute.github.com/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-30T15:58:26.027

我喜欢 RhinoMocks，但它是我唯一用过的 :}

这看起来很有希望： [http ://code.google.com/p/mocking-frameworks-compare/](http://code.google.com/p/mocking-frameworks-compare/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-30T16:08:27.593

我也在使用 RhinoMocks。我特别喜欢 AAA（Arrange-Act-Assert）模式。RhinoMocks 使用此模式可以轻松设置期望并检查它们。语法使用 lambdas 和链接，非常适合 LINQ。语法的相似性有助于理解并使代码更紧凑。我对它的唯一问题，而且不是很大，是为了模拟一个方法，它需要是虚拟的。从某种意义上说，这很好，因为它“迫使”您重构接口，但如果接口不是真正需要的，这可能会很痛苦。它会使模拟某些框架类变得更加困难。您可以通过将类方法标记为虚拟来解决此问题，或者使用框架类创建一个您模拟的包装器。我不认为这些问题是 RhinoMocks 独有的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-02-01T09:41:06.387

您可能会发现 Richard Banks[比较模拟框架的系列文章](http://www.richard-banks.org/2010/07/mocking-comparison-part-1-basics.html)很有用。

***注意**：为了充分披露，我是[NSubstitute](http://nsubstitute.github.com)的合著者，它在比较中表现得非常好。:)*

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T16:30:10.973

我用过 NMock 并认为它很棒。 [http://www.nmock.org/](http://www.nmock.org/)

但是 - 这是我唯一使用过的。

# c# - 仅从特定适配器（例如 192.168.101.1）发送 UDP 广播（255.255.255.255）；在 Windows 上

> ID：807651
> 
> 赞同：2
> 
> 时间：2009-04-30T15:55:52.443
> 
> 标签：c#, windows, udp, broadcast

适用于 Windows XP 或更高版本的解决方案。最好在 C# 或 C++ 中。

我们不想使用子网定向广播（例如 192.168.101.255）进行广播，因为我们尝试联系的设备对此没有响应。相反，我们希望能够仅从特定的 NIC/IPAddress 发送目的地为 255.255.255.255 的 UDP 数据报，这样广播就不会在其他 NIC 上发送出去。

这意味着我们必须绕过 IP 堆栈，这就是问题所在。我们如何绕过 Windows 上的 IP 堆栈，仅从特定的 NIC/MAC 地址发送符合 UDP/IP 的数据报？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-07T14:11:24.960

只需将套接字绑定到所需的接口而不是使用 INADDR_ANY ？

```
// Make a UDP socket
SOCKET s = socket(AF_INET,SOCK_DGRAM,IPPROTO_UDP);
// Bind it to a particular interface
sockaddr_in name={0};
name.sin_family = AF_INET;
name.sin_addr.s_addr = inet_addr("192.168.101.3"); // whatever the ip address of the NIC is.
name.sin_port = htons(PORT);
bind(s,(sockaddr*)name); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-04-19T14:34:25.640

为了使用 WinPcap 在 C# 中发送原始 pcaket，您可以使用[Pcap.Net](http://pcapdotnet.codeplex.com)。它是用 C++/CLI 和 C# 编写的 WinPcap 包装器，包括一个数据包解释和创建框架。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T17:43:31.987

我没有尝试过，但我知道 WinPCap 允许您进行原始[发送](http://www.winpcap.org/docs/docs_40_2/html/group__wpcap__tut8.html)。由于它在相当低的级别上工作，它可能允许您在堆栈上发送足够低的数据以绕过完整的广播。那里有各种 C# 包装器，当然您可以使用那里可用的普通 C/C++ 代码。我认为诀窍可能是绑定到您想要发送出去的正确适配器，它可能会正常工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-02-05T19:33:52.507

[广播地址 255.255.255.255 太笼统了。](http://jc-bell.com/blog/2010/02/05/udp-broadcasts-wrong-source-address/)您必须分别为每个网络接口制作不同的广播地址。

# vb.net - vb.Net 中的游戏开发

> ID：807653
> 
> 赞同：5
> 
> 时间：2009-04-30T15:56:43.567
> 
> 标签：vb.net

VB.Net 的最大限制是什么，阻止人们想用它作为一种语言来开发游戏？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-30T16:01:33.133

高级语言的速度通常使它们远离“严肃的”游戏开发，其中 C 和 C++ 至高无上。然而，越来越多的游戏将游戏逻辑暴露给 Lua 和 Python 等脚本语言。

我听说过使用 VB 开发的独立游戏，例如 Zombie Smashers 系列是由 James Silva 在 VB 中开发的，他最近在 C# .net 中开发了游戏[Dishwasher Dead Samurai 。](http://en.wikipedia.org/wiki/The_Dishwasher)

您可能想要查看Microsoft 推出的 Xbox Live Arcade 框架 ( [XNA )。](http://creators.xna.com/en-US/)您可以在 VB 或 C# 中使用它。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-30T16:26:30.827

由于 C++“慢”，游戏程序员甚至花了很长时间才接受 C++ 而不是 C。我相信多核时代很快就会导致这种情况慢慢消失，因为并行运行比尽可能快地运行单线程重要得多。

还要记住，现在很多处理都是在 GPU 上使用像素/顶点/几何着色器完成的。所以我们看到一些相当高级的游戏是用可能被认为是“慢”的语言编写的。

最后，.NET 并不慢。使游戏开发 imo 变得麻烦的是垃圾收集器的不可预测性（GC 在一场巨大的老板战斗中开始并导致延迟 - 不太好），以及 C# 和本机代码之间发生的任何封送处理。

幸运的是，通过深入了解 .NET 的工作原理，包括 GC 和运行时 - 这两个障碍都可以克服。

如果有的话，强烈建议用托管语言制作游戏原型，无论是 VB.NET、C#、python、ruby 等……然后如果发现它太慢，你可以将它的一部分移植到C++。

.NET 具有托管 C++，这使得本机代码和托管代码之间的互操作相当无缝。这允许在必要时本地编写那些真正关键的部分。但我怀疑情况是否如此。首先最重要的优化将来自数据结构、算法和整体架构。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-30T15:58:34.747

主要问题不是 VB.NET，而是 .NET Framework。

具体来说，游戏开发通常使用 C/C++ 来完成，这样可以获得每一盎司的性能。.NET 框架不适合这一点。

话虽如此，有些游戏是用 .NET 开发的

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T16:02:09.387

部分原因是 vb 通常仍然是一种慢速语言的污名。（由于 .net 框架的通用性，这几乎不像以前那么真实了）

老实说，虽然这取决于您开发的游戏类型，但如果您正在开发高帧率、高级 3-d 图形、最前沿的游戏，那么您将不得不用 C 或 C++ 编写它以获得必要的性能。但是，如果您正在做的事情更像您今天在许多基于 Flash 的游戏中看到的，或者甚至是您在旧游戏中看到的东西，那么恕我直言，您几乎可以用任何语言来做。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T18:09:44.043

至于速度部分，像基于 XNA 的[Visual3D.NET](http://game-engine.visual3d.net/)这样的引擎已经让我相信，从托管游戏引擎中获得良好的性能并非不可能。更重要的是，在任何演示中，CPU 似乎都不是太大的瓶颈，这是使用 C# 唯一有影响的部分。即使在 CPU 受限的情况下，由于引擎仍然是相当单线程的，它仍然只能推动 50-60%，因此对于今天的双核和四核 CPU，以及明天的八核和十六核 CPU，还有很大的改进空间。我认为优化算法以在多核时代很好地扩展将比使用的语言更重要。

为整个引擎使用托管语言的好处是，很容易将相同的高级语言用于游戏逻辑/人工智能，而本机引擎可能会为此使用慢得多的脚本语言。

像 C#/VB.NET 这样的托管语言的使用可能会限制基于 CPU 的东西，比如物理，但话又说回来，XNA的完全托管物理库[JigLibX](http://jiglibx.codeplex.com/)给我留下了深刻的印象。

这都是 C#，但我猜它也适用于 VB.NET，因为它们最终被编译为相同的 IL，除非 VB 编译器有一些我不知道的限制。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T15:59:57.427

VB.NET 与任何其他 .NET 语言没有什么不同。

VB 速度慢的感觉不再是这种情况。

这是带有 XNA（游戏开发工具包）的 VB.NET[的教程列表。](http://www.alanphipps.com/VisualBasicdotNET-XNA.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T17:14:23.987

正如其他人所指出的，.Net 并不慢，但有一些事情不利于游戏开发：

1.  垃圾收集的非确定性
2.  低可移植性（与 C 相比）
3.  缺乏成熟的游戏开发工具/库/框架

至于具体使用VB.Net。亲爱的主为什么？:-)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-30T17:37:23.293

您可以使用 Microsoft XNA Framework for graphics 和一个常规的 WinForms 应用程序来包含您的所有代码。只需安装 XNA 框架并从您的 VB WinForms 应用程序中添加一个引用。

如果您想利用 XNA 提供的所有功能，您需要使用与 XNA 完美集成的 C#。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-04-10T10:19:44.590

那些说网络慢的人是错误的。在运行时，即时 (JIT) 编译器将 IL 转换为本机代码。IL 代码有很多优点。您可以使用 C#/VBNET 编写游戏，并将框架用作 Monogame 或 FNA（即 XNA 的重新实现）。使用 monogame/fna 编写的游戏是多平台的

# asp.net-mvc - 为什么 ValidateInput(False) 不起作用？

> ID：807662
> 
> 赞同：35
> 
> 时间：2009-04-30T15:58:33.280
> 
> 标签：asp.net-mvc, vb.net, tinymce, request.form

我正在将使用 webforms 创建的应用程序转换为使用 vb.net 的 asp.net mvc 框架。我的一个观点有问题。当我提交表单时，我收到黄屏提示“从客户端检测到潜在危险的 Request.Form 值”。我使用 tinymce 作为我的 RTE。我已经设置了视图本身

> 验证请求 =“假”

我知道在 MVC 中，从我目前所读到的观点来看，它并不尊重它。所以我也把它放在控制器动作上。我尝试了不同的设置：

```
<ValidateInput(False), AcceptVerbs(HttpVerbs.Post)> _ 
```

...和...

```
<AcceptVerbs(HttpVerbs.Post), ValidateInput(False)> _ 
```

……还有这样的……

```
<ValidateInput(False)> _
<AcceptVerbs(HttpVerbs.Post)> _ 
```

只是想看看它是否有所作为，但我仍然得到黄屏死机。我只想为这个视图和我的帖子所涉及的控制器中的特定操作设置它。我错过了什么吗？

* * *

## 回答 #1

> 赞同：136
> 
> 时间：2010-03-27T20:32:13.767

使用 asp.net 4，您还需要在 web.config 中配置验证模式。

将以下内容设置为元素的子 `<system.web>`元素：

```
<system.Web>
  ...
  <httpRuntime requestValidationMode="2.0"/> 
```

Asp.Net 4 默认将 requestValidationMode 设置为`4.0`，它告诉系统在 HTTP 请求的 BeginRequst 阶段之前执行请求验证。验证将在系统到达 action 属性之前发生，告诉它不要验证请求，从而使属性无用。设置 requestValidationMode="2.0" 将恢复为 asp.net 2.0 请求验证行为，允许`ValidateInput`属性按预期工作。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-30T16:09:18.090

您确定要发布的控制器操作是您拥有属性的控制器操作吗？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-01-23T18:36:23.463

当您使用自己的实现*IModelBinder*接口的模型绑定器时，您会注意到这些自定义模型绑定器始终验证数据，而不管任何属性。您可以添加几行代码以使自定义模型绑定器尊重操作的*ValidateInput*过滤器：

```
// First check if request validation is required
var shouldPerformRequestValidation = controllerContext.Controller.ValidateRequest && bindingContext.ModelMetadata.RequestValidationEnabled;

// Get value
var valueProviderResult = bindingContext.GetValueFromValueProvider(shouldPerformRequestValidation);
if (valueProviderResult != null)
{
    var theValue = valueProviderResult.AttemptedValue;

    // etc...
} 
```

Martijn Boland 在这里很好地解释了这一点：http: [//blogs.taiga.nl/martijn/2011/09/29/custom-model-binders-and-request-validation/](http://blogs.taiga.nl/martijn/2011/09/29/custom-model-binders-and-request-validation/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-06-13T12:36:45.127

您可以尝试访问像 HttpContext.Request.Unvalidated.Form["FieldName"] 这样的字段

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-08T09:21:43.207

请注意，这些建议不会解决当您必须将 [ValidateInput(false)] 与 FormCollection 结合使用时出现的错误所导致的问题。

请参阅：[ASP.NET MVC 3 ValidateRequest(false) 不适用于 FormCollection](https://stackoverflow.com/questions/4361907/asp-net-mvc-3-validaterequestfalse-not-working-with-formcollection)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-12-18T11:12:26.737

添加以下代码行：

```
GlobalFilters.Filters.Add(new ValidateInputAttribute(false)); 
```

到 Application_Start() 方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-01-29T06:30:18.703

如果您使用输入模型并在所需属性上使用 AllowHtml，您将被解除阻塞。

```
public class InputModel
{
    [AllowHtml]
    public string HtmlInput { get; set; }
}

...
[ValidateInput(false)]
public async Task<ActionResult> ControllerMethod(InputModel model)
{
} 
```

# bash - 在 while 循环中修改 shell 变量不能按预期工作

> ID：807676
> 
> 赞同：1
> 
> 时间：2009-04-30T15:59:53.527
> 
> 标签：bash, shell

这是我写的一个非常简单的 bash 脚本：

```
#!/bin/bash

ITEM_LIST=items.txt
LOG_FILE=log.log

TOTAL_ITEMS=$(wc -l ${ITEM_LIST} | awk '{ print $1 }')
let NOT_FOUND=0

cat ${ITEM_LIST} | while read item; do

    grep "${item}" ${LOG_FILE} > /dev/null
    FOUND=${?}
    if [ ${FOUND} -ne 0 ]; then
        let NOT_FOUND=NOT_FOUND+1
        echo "Item not found [${item}] Item not found number: ${NOT_FOUND}"
    fi

done

echo "Total items: ${TOTAL_ITEMS}"
echo "Total not found items: ${NOT_FOUND}" 
```

我想检查日志文件中是否存在某些项目，计算有多少不存在，并打印某种报告（最后两个回显）。目前，我正在从 cygwin bash shell 运行它。

考虑这两个示例文件：

物品.txt

```
first item
second item
third item
fourth item
fifth item 
```

日志.log

```
blahblah blah blah first item blah blah blah
second blah blah item
blah third item blah 
```

脚本的输出：

```
[17:46:38]:/cygdrive/c/Temp/qpa# ./script2.sh 
Item not found [second item] Item not found number: 1
Item not found [fourth item] Item not found number: 2
Total items: 4
Total not found items: 0 
```

问题：

为什么脚本打印“Total not found items: 0”？它在循环上的每个回显上打印当前总数（都是 NOT_FOUND 变量）。

这个 shell 脚本中有一些不好的做法吗？在哪里以及为什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-30T16:12:42.297

您在这里使用的管道：

```
cat ${ITEM_LIST} | ... 
```

之后将在子 shell 中执行 while 循环。但这意味着`NOT_FOUND`变量不会在父 shell 中更新，而只会在您执行循环的子 shell 中更新。

在该子 shell 实例的末尾包含 echo 命令：

```
cat ${ITEM_LIST} | { 
  while read item; do
    grep "${item}" ${LOG_FILE} > /dev/null
    FOUND=${?}
    if [ ${FOUND} -ne 0 ]; then
        let NOT_FOUND=NOT_FOUND+1
        echo "Item not found [${item}] Item not found number: ${NOT_FOUND}"
    fi
  done

  echo "Total items: ${TOTAL_ITEMS}"
  echo "Total not found items: ${NOT_FOUND}"
} 
```

该问题也在[Bash FAQ 项目](http://mywiki.wooledge.org/BashFAQ/024)中进行了解释。希望这可以帮助。

正如常见问题解答所解释的那样，在这种特殊情况下，您还可以将其重写为：

```
while read item; do
    grep "${item}" ${LOG_FILE} > /dev/null
    FOUND=${?}
    if [ ${FOUND} -ne 0 ]; then
        let NOT_FOUND=NOT_FOUND+1
        echo "Item not found [${item}] Item not found number: ${NOT_FOUND}"
    fi
done < ${ITEM_LIST} 
```

在这种情况下更喜欢第二种选择，因为它会摆脱一种“无用的猫”:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T16:13:54.210

使用[expr](http://linux.about.com/library/cmd/blcmdln_expr.htm)进行数学运算

```
NOT_FOUND=0; NOT_FOUND=`expr ${NOT_FOUND} + 1`; echo ${NOT_FOUND}

1 
```

@litb 是对的，您需要在主脚本中更新 NOT_FOUND，而不是在 pipe 命令生成的子 shell 中。

# c# - 从 Windows 服务加载 GUI 应用程序

> ID：807683
> 
> 赞同：2
> 
> 时间：2009-04-30T16:01:07.953
> 
> 标签：c#, windows, service, launching-application

我正在编写一个 .NET Windows 服务，其作用是启动一个 GUI 应用程序（其源代码不可用）。该操作是一劳永逸的，除了初始命令行参数之外没有任何通信。

该服务应该作为给定的 Windows 帐户运行。

问题：服务启动的应用程序*没有*显示在桌面上。它需要，因为它是一个交互式应用程序。解决办法是什么？

注意：这是系统的规格和设计。服务/应用程序通信和安全性引起的典型问题*不适*用于这种特定情况。

编辑：以本地系统帐户登录时，GUI 元素正确显示，但是，由于 GUI 应用程序需要访问网络驱动器（它无法理解 UNC 映射），它需要以指定的用户帐户运行，并且没有“显示交互元素”设置。

edit2：操作系统是Windows 2003 Server，没有升级计划。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T16:09:26.873

不幸的是，自 Vista 以来，这更成问题......关于为什么在[这篇博文上发布的一些细节。](http://blogs.msdn.com/larryosterman/archive/2005/09/14/466175.aspx)

那篇文章提到了一些潜在的解决方法。 [这是 MSDN 上的一个线程](http://social.msdn.microsoft.com/forums/en-US/windowssecurity/thread/31bfa13d-982b-4b1a-bff3-2761ade5214f/)，详细说明了整个过程，以及您可能面临的一些潜在问题。

但是，我强烈建议您尝试查看是否可以切换到让用户模式应用程序作为启动应用程序运行（当用户登录时），并且与您的服务的任何通信都由该应用程序处理。可靠多了，尤其是在vista、终端服务等情况下。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T18:56:03.680

您可以使用来自 Sysinternals/Microsoft 的免费[自动登录](http://technet.microsoft.com/en-us/sysinternals/bb963905.aspx)实用程序[http://technet.microsoft.com/en-us/sysinternals/bb963905.aspx](http://technet.microsoft.com/en-us/sysinternals/bb963905.aspx)并将您的应用程序放入启动以获取自动登录用户配置文件。之后，您可以将屏幕服务器配置为在几分钟内启动并选中“在恢复时，显示登录屏幕”复选框。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T16:06:30.937

这是黑暗中的一次尝试，但希望能引导您找到某种解决方案。

即使安全不是问题，也可能是问题所在。该服务正在使用与当前登录用户不同的凭据集启动应用程序。这就像远程桌面到用户机器并启动他们会看到的应用程序。

作为测试，也许将服务的凭据更改为当前登录的用户只是为了看看会发生什么。

由于即使用户未登录服务也会运行，如果它启动应用程序会发生什么？您的业​​务规则或功能可能会阻止这种情况发生，但也许 Windows 正在做一些事情来阻止它工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-01T05:59:11.590

您是否希望您的应用程序/服务在启用终端服务器角色时工作？如果是这样，您确实需要执行“轮询服务的应用程序”模型，而不是“启动应用程序的服务”模型。

这样做的原因是，您可能随时有多个用户连接到机器，并且无法知道“控制台”上的用户是谁——事实上，控制台上可能根本没有人。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-09-27T14:02:15.273

这是我过去在任务管理服务中使用的代码，有时需要在交互式会话中运行一些东西。将 wibble.exe 替换为您的应用程序。它应该在 Server 2003（即 NT5）上运行良好。我们没有费心尝试在 NT6 上运行交互模式（太麻烦了），我们让我们的应用程序在服务会话中运行，并编写了我们自己的调试实用程序通过管道与它们对话。

```
STARTUPINFO  sui ;
PROCESS_INFORMATION pi;

ZeroMemory (&sui, sizeof(STARTUPINFO));
sui.cb = sizeof (STARTUPINFO);
sui.wShowWindow = pTask->GetWinStartState();
sui.dwFlags     = STARTF_USESHOWWINDOW;
ZeroMemory (&pi,sizeof(pi));

if (InteractiveMode)
{
   HANDLE  hToken = NULL;
   DWORD dwSessionId = GetCurrentUserSession();

   if (dwSessionId != (DWORD)-1)
   {
      if (WTSQueryUserToken (dwSessionId, &hToken))
      {
         sui.lpDesktop = TEXT("winsta0\\default");
         LPVOID  pEnv = NULL;
         dwCreateFlags |= CREATE_NEW_CONSOLE;
         HMODULE hModu = LoadLibrary(TEXT("Userenv.dll"));

         if (hModu)
         {
            if (CreateEnvironmentBlock (&pEnv, hToken, FALSE))
            {
               dwCreateFlags |= CREATE_UNICODE_ENVIRONMENT;    
            }
            else
            {
               pEnv = NULL;
            }
         }

         bCreatedOk = CreateProcessAsUser (hToken,
                                           NULL,
                                           TEXT("wibble.exe"),
                                           NULL,
                                           NULL,
                                           FALSE,
                                           dwCreateFlags,
                                           pEnv,
                                           NULL,
                                           &sui,
                                           &pi);
      }
      else
      {
         // error case
      }
   }
   else
   {
      // remote session? error case.
   }
} 
```

我在想，您的“指定用户帐户”必须是这里的控制台会话。如果您需要它在指定帐户中运行而该帐户尚未登录，那么您将处于一个全新的伤害世界，加载注册表配置单元等。

# mask - 替换位范围

> ID：807689
> 
> 赞同：6
> 
> 时间：2009-04-30T16:02:11.960
> 
> 标签：mask, boolean-logic, bit

CS中的任何二年级学生都应该能够回答，但我似乎无法理解它......

我有一组位，我需要用不同的组替换一些位。在一个简化的例子中：

10101010 - 原始位设置

00001111 - 显示替换位置的掩码

00001100 - 新位值

10101100 - 结果位设置

另一个例子：

10101010 - 原始位设置

00110011-面具

11111111 - 新位值

10111011 - 结果位设置

通过遍历位来做到这一点是微不足道的。

是否可以使用布尔逻辑（AND、OR 等）来做到这一点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-30T16:08:01.713

```
result = (original & ~mask) | (newbits & mask) 
```

"& ~mask" 部分确保在 | 之前将这些位清除为 0。部分。

“& 掩码”部分确保只使用 newbits 中的正确位。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T17:05:14.960

（新的和面具）或（旧的和非面具）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T16:11:57.493

将要替换的位从原始位中屏蔽掉（通过与掩码的 NOT 进行与运算），然后将新位放入（通过 OR）。

10101010 - 原始位设置

00001111 - 显示替换位置的掩码

00001100 - 新位值

11110000 - 否定掩码

10100000 - 原始位集被屏蔽

10101100 - 新钻头放回

* * *

在 C(++) 代码中，它将是：

out = (in & ~mask) | 新比特；

如果 newbits 包含它们应该替换的位之外的位，并且它们也带有掩码。

# c# - 难倒 C# DateTime ToString() 格式问题

> ID：807690
> 
> 赞同：1
> 
> 时间：2009-04-30T16:02:40.230
> 
> 标签：c#, datetime, rfc822

我从 C# 中的 DateTime 对象上的 ToString() 调用中返回了一些垃圾数据，恐怕我在摸索了一段时间后会被难住。

该函数应该格式化日期以符合 RFC 822（根据 RSS 规范的要求），如下所示：

```
public static string FormatPubDate(DateTime pubDate) 
{
    string _rfc822Format = "ddd, dd MMM yyyy HH:mm:ss";
    string _tmp = pubDate.ToUniversalTime().ToString(_rfc822Format);

    return pubDate.ToString(_tmp + " UT");
} 
```

从我可以阅读的 DateTime ToString() 文档中，这应该是我想要的。

但是，对于某些日期，它会产生垃圾：

```
 Console.WriteLine(FormatPubDate(new DateTime(2008, 12, 16, 13, 44, 33)));
 Console.WriteLine(FormatPubDate(new DateTime(2008, 12, 17, 13, 44, 33)));
 Console.WriteLine(FormatPubDate(new DateTime(2009, 3, 18, 4, 17, 20)));
 Console.WriteLine(FormatPubDate(new DateTime(2009, 4, 30, 10, 44, 33))); 
```

产量：

```
Tue, 16 Dec 2008 19:44:33 UT
We17, 17 Dec 2008 19:44:33 UT
We18, 18 3ar 2009 09:17:20 UT
T10u, 30 Apr 2009 15:44:33 UT 
```

任何想法为什么它返回 We18 而不是 Wed 和 3ar 而不是 Mar？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-30T16:11:04.967

你的问题是最后一个

```
return pubDate.ToString(_tmp + " UT"); 
```

您正在使用格式化值在 ​​DateTime 上执行第二个 ToString()，作为格式化程序...

尝试将其更改为

```
string _rfc822Format = "ddd, dd MMM yyyy HH:mm:ss";
string _tmp = pubDate.ToUniversalTime().ToString(_rfc822Format);

return _tmp + " UT"; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T16:09:41.507

你可以用这个代替吗？：

```
String.Format("{0:r}", dt);  // "Sun, 09 Mar 2008 16:05:07 GMT"   RFC1123 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-30T16:11:23.203

您当前在日期调用 ToString，传入您的 RFC 格式，然后您再次在日期调用 ToString，以您已经转换的日期 +“UT”作为格式，我很惊讶你得到了任何好的结果！

试试这个：

```
public static string FormatPubDate(DateTime pubDate) 
{
    string _rfc822Format = "ddd, dd MMM yyyy HH:mm:ss";
    return pubDate.ToUniversalTime().ToString(_rfc822Format) + " UT";

} 
```

# wcf - 在 VS2008/C# 中使用传统的 web 服务或使用 WCF

> ID：807692
> 
> 赞同：8
> 
> 时间：2009-04-30T16:02:43.707
> 
> 标签：wcf

我在这里有机会进入 WCF，但交付时间有限。我可以在迭代中提供我的服务，如果 WCF 是要走的路，我可以购买额外的时间来克服学习曲线。

现在的常态是什么？WCF是要走的路吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-30T16:09:43.427

我现在已经多次遇到这个问题，所以根据我自己和其他人的经验，只有在你愿意接受学习曲线的情况下才使用 WCF。创建对象很简单，非常直接且易于使用。但...

一些常见的陷阱：

*   默认绑定是 wsHttpBinding，默认情况下是安全的。如果您想使用更传统的东西，请使用 basicHttpBinding。
*   如果您在 IIS 中托管，请确保设置主机标头，否则 xsd uri 引用将全部指向 localhost 或服务器名称。
*   使用 WCF 配置实用程序，它在您配置端点时会有很大帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-30T16:15:16.347

*   微软曾表示 WCF 是 Web 服务的替代品。
*   一旦学习了基本语法，用 WCF 服务替换 Web 服务并不是特别困难。
*   WCF 服务提供了 Web 服务所做的一切，并且允许您在其他上下文中部署相同的组件 - 您可以将组件部署为 Web 服务或坚持使用 Windows 服务以向其他软件提供相同的功能，或者将其插入 -使用您的任何其他代码处理 - 无需更改服务内的代码。
*   可以配置 WCF 以提供更好的安全性。

说真的，拿一份 Juval Lowy 的优秀“Programming WCF Services”并阅读第一章。创建一些服务，很快你就会意识到它并不像乍看起来那么困难。

WCF 是 .NET 中组件的未来。Web 服务已成为过去。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-08T00:30:19.653

这应该是不言而喻的。可惜不是。

答案是 WCF。它取代了旧的 ASMX Web 服务。说 WCF 是未来已经不再准确——它是现在，而 ASMX 是过去，迅速成为古老的历史。

您需要学习的 WCF 子集与使用 ASMX 服务所做的相同非常简单。

1.  您不需要知道 basicHttpBinding 的任何绑定。使用它，您的客户端程序甚至可以继续使用 Web 引用。
2.  您需要学会不要担心您的数据合同被序列化到的 XML 的细节。
3.  您需要了解将被序列化的 DataContract 的唯一部分是那些标记为 [DataMember] 的部分。它是一个“选择加入”模型，而不是您在 XML 序列化器中拥有的“选择退出”模型。
4.  您需要学习使用标有 [ServiceContract] 的接口定义服务的合同
5.  您不需要 [WebService] 类，只需一个实现 [ServiceContract] 接口的类。

这就是全部，真的。你会很快学会的。剩下的就是“肉汁”。这是一种非常丰富的肉汁，里面有很多“肉”，但你可以把它放在一边，或者如果你想吃一点就可以了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T16:12:15.853

如果您的服务需要在多个通信协议上可用并且您需要配置安全性，那么 WCF 是您的最佳选择。

如果该服务只需要通过 HTTP 和/或 HTTPS 可用，如果您有时间限制，ASMX Web 服务将是您的最佳选择

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T00:20:04.920

一旦你得到 WCF 设置，它太棒了！通过 WCF 使用 SQL 和 LINQ 来返回您的数据（对我来说）要快得多！

需要注意的一点：证书！

我们在那里遇到了很多问题！这个[链接](http://blogs.microsoft.co.il/blogs/applisec/archive/2008/04/08/creating-x-509-certificates-using-makecert-exe.aspx)有帮助。

祝你好运！

# asp.net - 每个 team_id 的 ASP.NET MVC 授权和角色

> ID：807699
> 
> 赞同：3
> 
> 时间：2009-04-30T16:04:48.180
> 
> 标签：asp.net, asp.net-mvc

我正在使用 ASP.NET MVC 开始一个项目，但我不知道基于 team_id 处理授权和角色的最佳方法是什么。我阅读的每个博客条目或论坛帖子总是谈论使用 asp.net 成员资格或创建 CustomAuthorize 过滤器来定义全局角色（“admin”、“helpdesk”、“editor”等）。我的应用程序中的问题是没有全局角色。用户将成为 team1 的经理，但无法编辑或查看 team2 的详细信息。所以授权细节是： - 用户可以查看他的团队计划和他的队友可用性，但看不到其他团队 - 团队经理可以编辑团队详细信息，但不能编辑其他团队的详细信息 - 一个团队可以有 1 个或多个经理 - A用户可以是 1 个或多个团队的成员

ATM，我有 3 张桌子来处理这种关系。

```
teams --> teams_users <-- users
team_id   #team_id        user_id
          #user_id
          isManager? 
```

作为最后的手段，我计划在用户登录时将用户当前的 team_id 和 isManager 状态存储在会话变量中，并创建一个 CustomAuthorize 过滤器来检查会话 team_id 是否与 model.team_id 相同。让我知道是否有另一种方法。谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T16:15:30.150

然后我将拥有 2 个角色 - 经理和用户然后我会像您指定的那样绑定数据库。

角色将控制每个用户可以执行的操作（用户可以查看信息，经理可以编辑/创建信息），然后在每个操作中我会快速检查当前用户。对需要的团队执行此操作（即用户是否有权访问团队）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T12:27:29.663

最后，我最终创建了一条自定义路线：

```
/{team_id}/controller/action/{id} 
```

{team_id} 在用户登录后设置，然后自定义过滤器验证用户是否属于每个控制器顶部的团队。每当他更改团队时，{team_id} 都会更新。此外，还有一个“isManager”过滤器来保护特定的经理操作，该操作将检查用户是否是当前团队的经理。谢谢你们的回答

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-24T15:29:27.810

我认为您的解决方案看起来不错。如果您非常依赖 ASP.NET 角色来为您完成初始提升，那么您会遇到很多问题：

用户 1 是团队 1 的经理，也是团队 2 的普通用户。ViewSchedule 对用户是只读的，对经理是可编辑的。ViewSchedule 上的代码：

```
if (User.IsInRole("manager")) {
    if (isTeamManager(userid)) {}
}
else {}

bool isTeamManager(int userid) {
    return db.IsTeamManager(userid) {
} 
```

如果您这样做，那么当用户使用团队 2 时，他将完全错过该块。就 ASP.NET 角色而言，他是一名经理，但不是该团队的经理。没问题，显然我们可以像这样组合条件：

```
if (User.IsInRole("manager") && isTeamManager(userid)) { }
else {} 
```

哦，是的，如果我们调用 isTeamManager() 那么我们已经获得了 User.IsInRole("manager") 提供的唯一信息，所以我们甚至不需要它：

```
if (isTeamManager(userid)) { }
else {} 
```

所以现在我们甚至没有在我们的代码中使用角色。我会坚持你原来的想法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T16:16:15.890

我开发了两个自定义属性来处理这样的情况：RoleOrOwnerAuthorization 和 RoleOrOwnerAssociatedAuthorization。RoleOrOwner 查看系统的当前用户是否与相关数据的用户 ID 相同。也就是说，您有权查看自己的数据。RoleOrOwnerAssociated 检查连接表中是否存在将数据与当前用户相关联的行。例如，我可能有 Groups、GroupLeaders 和 Users，其中 GroupLeaders 是一个将 Groups 链接到 Users 的连接表。要查看组的数据，您需要成为 ViewGroups 角色或组长（由 GroupLeaders 中的一行显示，其中包含组的 id 和您的 id）。我认为这非常有效。

# wpf - 用户控件库和自定义控件库有什么区别？

> ID：807703
> 
> 赞同：189
> 
> 时间：2009-04-30T16:05:51.190
> 
> 标签：wpf, user-controls, custom-controls

我刚刚开始了解 WPF，并想创建一个可重用的 WPF 控件。

当我查看在 Visual Studio 中创建项目的选项时，我看到“WPF 用户控件库”和“WPF 自定义控件库”。我不清楚它们之间有什么区别，我的谷歌搜索也没有找到任何体面的解释。

我想了解它们之间的区别，并在理想情况下查看一些何时使用其中一种的示例。

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2009-04-30T16:26:39.937

实际上，自定义控件是您在代码级别实现的，而您可以将 XAML 用于用户控件。自定义控件扩展了 WPF 控件基类之一并通过代码提供附加功能，因此所有添加的逻辑和表示必须在代码内实现。

用户控件在技术上是一个普通的内容控件，您可以在代码中的某些部分扩展它，但通常通过在其中放置其他控件来扩展它。因此，正如 Kent 提到的，UserControl 是其他控件的集合。这极大地限制了您可以使用用户控件执行的操作。它比完整的自定义控件更易于使用但更受限制。

从运行时的角度来看，这些控件有细微的差别。在构建应用程序并将 UserControl 放入其中时，控件树中将有一个具体的 UserControl 模板。因此，如果我们考虑一个专门按钮的蹩脚示例。如果您使用的是用户控件，您将在`<UserControl>`元素内添加一个按钮。使用自定义控件时，您很可能从按钮派生控件本身。差异将在逻辑树中可见。

虽然自定义控件将提供类似于

*   窗户
    *   自定义按钮

UserControl 会给出一个逻辑树

*   窗户
    *   自定义按钮用户控件
        *   按钮

所以最终 UserControl 只是一个普通的 ContentControl ，您可以对其进行扩展，并且可以为其预定义内容。自定义控件以易于实现为代价提供了更大的灵活性，因为您必须在代码中完成所有逻辑和交互，而不是享受 XAML 的好处。

尽管如此，我认为 Visual Studio 模板并没有太大的不同。很可能 Visual Studio 自定义控件只是创建一个带有空自定义控件的项目，而用户控件项目是一个带有空用户控件的项目。您可以稍后将任何类型的项目添加到项目中。

**更新**

我对何时使用自定义控件和用户控件的看法是，如果您可以使用用户控件完成某些操作并且逻辑树中的额外控件元素不会打扰您，请使用用户控件，因为它们更容易创建和维护。仅当您有理由不使用用户控件时才使用自定义控件。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-04-30T16:07:55.550

A`Control`代表一些可换肤（可模板化）的行为，而 a`UserControl`通常`Control`是特定于应用程序的 s 的更高级别聚合。

更多信息[在这里](http://wangmo.wordpress.com/2007/09/28/user-controls-vs-custom-controls/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2021-12-10T17:42:11.640

# 用户控件库、自定义控件库和 WPF 类库模板之间的区别

要回答最初的问题，两个库模板之间的主要区别在于，一个带有默认的空用户控件，而另一个带有默认的空自定义控件。它们都是 WPF 类库。任何一个项目都可以包含零个或多个用户控件以及零个或多个自定义控件。

此外，正如[Novitchi S](https://stackoverflow.com/a/23292922/184528)和[Cameron Macfarland](https://stackoverflow.com/a/2090973/184528)在单独的帖子中所解释的，自定义控件库还添加了一个`ThemeInfo`程序集属性来解析控件的默认样式/模板的位置。

# 用户控件和自定义控件之间的区别

用户控件是 WPF 控件（包括其他用户控件）的集合，而自定义控件是从 Control 派生的类。

[这篇 MSDN 文章](https://docs.microsoft.com/en-us/dotnet/desktop/wpf/controls/control-authoring-overview?view=netframeworkdesktop-4.8&viewFallbackFrom=netdesktop-5.0)就何时在开发用户控件、自定义控件或从框架元素派生之间进行选择提出了以下建议。

### 如果以下所有条件都适用，请考虑派生`UserControl`：

*   您希望构建控件的方式与构建应用程序的方式类似。
*   您的控件仅包含现有组件。
*   您不需要支持复杂的自定义。

### `Control`如果以下任何一项适用，请考虑派生：

*   您希望通过 ControlTemplate 自定义控件的外观。
*   您希望您的控件支持不同的主题。

### `FrameworkElement`如果以下任何一项适用，请考虑派生：

*   您希望对控件的外观进行精确控制，而不仅仅是简单的元素组合所提供的。
*   您想通过定义自己的呈现逻辑来定义控件的外观。

## 其他 StackOverflow 答案的其他好建议：

[Reed Copsey 解释说](https://stackoverflow.com/a/2992791/184528)“UserControls 旨在将多个 WPF 控件组合在一起，以便从其他控件构建一组功能”，并进一步分享他的经验，“在 WPF 中实际上很少需要 CustomControls，因为WPF 模板选项和附加属性允许您使用标准控件执行几乎任何操作”。

[Mikko Rantanen 类似地分享了他们的观点](https://stackoverflow.com/a/807812/184528)“使用自定义控件和用户控件是，如果您可以使用用户控件完成某些操作并且逻辑树中的额外控件元素不会打扰您，请使用用户控件，因为它们更容易创造和维护。”

# tsql - 如何将选择结果分配给变量？

> ID：807712
> 
> 赞同：77
> 
> 时间：2009-04-30T16:08:33.897
> 
> 标签：tsql, database-cursor

如何将选定的字段值存储到查询中的变量中并在更新语句中使用它？

这是我的程序：

我正在编写一个 SQL Server 2005 T-SQL 存储过程，它执行以下操作：

1.  从发票表中获取发票 ID 列表并将其存储到光标
2.  从光标获取发票 ID -> tmp_key 变量
3.  foreach tmp_key 从客户表中查找发票客户主要联系人 ID
4.  使用主要联系人 ID 更新客户端联系人密钥
5.  关闭光标

这是我的代码：

```
DECLARE @tmp_key int
DECLARE @get_invckey cursor 

set @get_invckey = CURSOR FOR 
    select invckey from tarinvoice where confirmtocntctkey is null and tranno like '%115876'

OPEN @get_invckey 

FETCH NEXT FROM @get_invckey into @tmp_key

WHILE (@@FETCH_STATUS = 0) 
BEGIN 
    SELECT c.PrimaryCntctKey as PrimaryContactKey
    from tarcustomer c, tarinvoice i
    where i.custkey = c.custkey and i.invckey = @tmp_key

    UPDATE tarinvoice set confirmtocntctkey = PrimaryContactKey where invckey = @tmp_key
    FETCH NEXT FROM @get_invckey INTO @tmp_key
END 

CLOSE @get_invckey
DEALLOCATE @get_invckey 
```

如何存储 PrimaryContactKey 并在以下更新语句的 set 子句中再次使用它？我是创建一个游标变量还是创建另一个 int 类型的局部变量？

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2011-01-27T13:50:19.653

我只是遇到了同样的问题并且...

```
declare @userId uniqueidentifier
set @userId = (select top 1 UserId from aspnet_Users) 
```

甚至更短：

```
declare @userId uniqueidentifier
SELECT TOP 1 @userId = UserId FROM aspnet_Users 
```

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2009-04-30T16:16:48.930

```
DECLARE @tmp_key int
DECLARE @get_invckey cursor 

SET @get_invckey = CURSOR FOR 
    SELECT invckey FROM tarinvoice WHERE confirmtocntctkey IS NULL AND tranno LIKE '%115876'

OPEN @get_invckey 

FETCH NEXT FROM @get_invckey INTO @tmp_key

DECLARE @PrimaryContactKey int --or whatever datatype it is

WHILE (@@FETCH_STATUS = 0) 
BEGIN 
    SELECT @PrimaryContactKey=c.PrimaryCntctKey
    FROM tarcustomer c, tarinvoice i
    WHERE i.custkey = c.custkey AND i.invckey = @tmp_key

    UPDATE tarinvoice SET confirmtocntctkey = @PrimaryContactKey WHERE invckey = @tmp_key
    FETCH NEXT FROM @get_invckey INTO @tmp_key
END 

CLOSE @get_invckey
DEALLOCATE @get_invckey 
```

**编辑：**
这个问题比我预期的要多得多。请注意，我并不提倡在回答中使用光标，而是展示如何根据问题分配值。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-04-30T16:13:39.407

试试这个

```
SELECT @PrimaryContactKey = c.PrimaryCntctKey
FROM tarcustomer c, tarinvoice i
WHERE i.custkey = c.custkey 
    AND i.invckey = @tmp_key

UPDATE tarinvoice SET confirmtocntctkey = @PrimaryContactKey 
WHERE invckey = @tmp_key
FETCH NEXT FROM @get_invckey INTO @tmp_key 
```

您可以在循环之外将此变量声明为标准 TSQL 变量。

我还应该注意，这就是您将任何类型的选择放入变量的方式，而不仅仅是在处理游标时。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2013-10-29T15:16:56.187

为了安全地分配变量，您必须使用 SET-SELECT 语句：

```
SET @PrimaryContactKey = (SELECT c.PrimaryCntctKey
    FROM tarcustomer c, tarinvoice i
    WHERE i.custkey = c.custkey 
    AND i.invckey = @tmp_key) 
```

确保你有一个开始和一个结束括号！

SET-SELECT 版本是设置变量的最安全方式的原因是双重的。

**1\. SELECT 返回多个帖子**

如果以下选择导致多个帖子会发生什么？

```
SELECT @PrimaryContactKey = c.PrimaryCntctKey
FROM tarcustomer c, tarinvoice i
WHERE i.custkey = c.custkey 
    AND i.invckey = @tmp_key 
```

`@PrimaryContactKey`将被分配结果中*最后一个帖子*的值。

事实上`@PrimaryContactKey`，结果中的每个帖子都会被分配一个值，因此它将包含 SELECT 命令正在处理的最后一个帖子的值。

哪个帖子是“最后一个”由任何聚集索引确定，或者，如果没有使用聚集索引或主键是聚集的，则“最后一个”帖子将是最近添加的帖子。在最坏的情况下，每次更改表的索引时都可能更改此行为。

使用 SET-SELECT 语句，您的变量将设置为`null`.

**2\. SELECT 不返回任何帖子**

使用第二版代码时，如果您的选择根本不返回结果，会发生什么情况？

与您可能认为变量的值*不会为空*的情况相反- 它会保留*它以前的值！*

这是因为，如上所述，SQL 将为*每个帖子*分配一次值给变量- 这意味着如果结果不包含帖子，它不会对变量做任何事情。因此，变量仍将具有运行语句之前的值。

使用 SET-SELECT 语句，该值将为`null`.

另请参阅：[分配变量时的 SET 与 SELECT？](https://stackoverflow.com/questions/3945361/t-sql-set-versus-select-when-assigning-variables)

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-05-01T19:08:46.810

为什么你需要一个游标？您的整个代码段都可以用它替换，这将在大量行上运行得更快。

```
UPDATE tarinvoice set confirmtocntctkey = PrimaryCntctKey 
FROM tarinvoice INNER JOIN tarcustomer ON tarinvoice.custkey = tarcustomer.custkey
WHERE confirmtocntctkey is null and tranno like '%115876' 
```

# c# - 带有接口列表的接口

> ID：807720
> 
> 赞同：5
> 
> 时间：2009-04-30T16:09:41.680
> 
> 标签：c#, generics, interface

也许我很笨但是...

我有：

```
public interface IRequest
{
    IList<IRequestDetail> Details { get; set; }

    // stuff
}

public interface IRequestDetail
{
    // stuff
} 
```

然后我有：

```
public class MyRequest : IRequest
{
    IList<MyRequestDetail> Details {get; set; }

    // stuff
}

public class MyRequestDetail : IRequestDetail
{
    // stuff
} 
```

它不起作用。

C# 对我很生气，因为 MyRequest 由于没有 IRequestDetail 的 IList 而没有实现接口。

现在，如果我将其更改为 Details 是 IRequestDetail 的 IList，那么我必须在我使用非接口成员的代码中的任何地方将其强制转换为 MyRequestDetail（我有几个请求共享共同的东西，但后来专门化了）。

我有点明白为什么它错了，但不完全！

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-30T16:12:01.050

我认为，基于问题是您希望将详细信息视为通用列表并强制它实现 IRequestDetail。您还希望为实现类更具体地键入它。在这种情况下，您需要使 IRequest 通用。

试试这个：

```
public interface IRequest<T> where T : IRequestDetail
{
    IList<T> Details { get; set; }

    // stuff
}

public class MyRequest : IRequest<MyRequestDetail>
{
    public IList<MyRequestDetail> Details {get; set; }

    // stuff
} 
```

这应该适合你。

**编辑 2017-03-17**

在回复@Robert 的评论时，请参阅下面的扩展代码：

```
public interface IRequestDetail
{

}

public class MyRequestDetail : IRequestDetail
{

}

public interface IRequest<T> where T : IRequestDetail
{
    IList<T> Details { get; set; }

    // stuff
}

public class MyRequest<T> : IRequest<T>
    where T : IRequestDetail
{
    public IList<T> Details { get; set; }

    // stuff
}

public class Consumer
{
    public void MyFunction<T>(IRequest<T> request)
        where T : IRequestDetail
    {

    }

    public void Foo()
    {
        var test = new MyRequest<MyRequestDetail>();
        MyFunction(test);
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T16:22:28.823

精确的。迈克尔有解决办法。问题有点棘手。

它没有显式转换

```
IList<MyRequestDetail> 
```

到

```
IList<IRequestDetail> 
```

因为这意味着您可以将其他对象添加到第二个对象中，这些对象基于不同的类（例如 MyRequestDetail2），它们不是“MyRequestDetail”。这首先是非法的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T16:22:31.243

这是由于 C# 中的协变和逆变。[Eric Lippert 的博客](http://blogs.msdn.com/ericlippert/archive/tags/Covariance+and+Contravariance/default.aspx)上有对这些问题的非常详细、非常清晰的解释（分为许多部分）。

# asp.net - 在页面上动态显示从字节数组派生的图像

> ID：807739
> 
> 赞同：1
> 
> 时间：2009-04-30T16:12:54.340
> 
> 标签：asp.net, vb.net, image, bytearray, codeplex

我正在调用一个 Web 服务，它以字节数组集合的形式返回未知数量的图像。（我不能改变这个）

我需要在单个 aspx 网页上显示每个图像。

我目前正在使用 Microsoft.Web.GeneratedImage 控件； [http://www.codeplex.com/aspnet/Release/ProjectReleases.aspx?ReleaseId=16449](http://www.codeplex.com/aspnet/Release/ProjectReleases.aspx?ReleaseId=16449) 以显示图像。

我遇到的问题是，由于控件调用单独的代码文件来加载图像内容，我使用会话状态来存储字节数组，我对此并不太满意。

这是我的测试项目中的一些代码；

```
 Private Sub btnGetChart_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles btnGetChart.Click
    Dim reportHub As New HubWrapper

    Dim repCharts() As ReportHub.Chart = reportHub.ReportHubChart(Me.ddlReports.SelectedValue, ViewState("params"))

    For Each chart As ReportHub.Chart In repCharts
      Dim sessionKey As String = "img" & System.Guid.NewGuid().ToString

      Dim imgParam As New Microsoft.Web.ImageParameter()
      imgParam.Name = "sessionVar"
      imgParam.Value = sessionKey

      Session(sessionKey) = chart.ChartData

      Dim img As New Microsoft.Web.GeneratedImage
      img.ImageHandlerUrl = "~/chartImageHandler.ashx"
      img.Parameters.Add(imgParam)

      phChart.Controls.Add(img)
    Next
  End Sub 
```

* * *

```
<%@ WebHandler Language="VB" Class="chartImageHandler" %>

Imports System
Imports System.Collections.Specialized
Imports System.Drawing
Imports System.Web
Imports Microsoft.Web

Public Class chartImageHandler
  Inherits ImageHandler

  Implements IRequiresSessionState

  Public Sub New()
    MyBase.New()
    'Set caching settings and add image transformations here
    'EnableServerCache = True

  End Sub

  Public Overrides Function GenerateImage(ByVal parameters As NameValueCollection) As ImageInfo
    Dim byteArry As Byte() = CType(HttpContext.Current.Session(parameters("sessionVar")), Byte())

    HttpContext.Current.Session.Remove(parameters("sessionVar"))

    Return New ImageInfo(byteArry)

  End Function
End Class 
```

实现这一目标的最优雅方式是什么？

欢迎任何输入！

编辑：附加信息；

*   来自 Web 服务的图像来自 SQL Reporting Services。
*   图像通常会一直在变化（没有真正的缓存要求）。
*   图像将是用户特定的。
*   每个页面只调用一次 Web 服务。
*   在生成的图像使用它之后，我实际上是从会话状态处理图像，因为一段时间内不需要再次查看图像。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-14T06:35:46.313

我想您只想在每个页面请求中调用一次您的网络服务。事实上，以某种方式缓存字节数组会很好，这样在用户暂时离开页面然后又回来的情况下，不会再次调用 Web 服务。在这种情况下，在会话中保存字节数组是不可避免的。如果您没有使用 GeneratedImage 控件，您仍然需要将字节数组保存在某处。

我理解您对大型会议的担忧。根据您的应用程序的详细信息，您可以采取一些措施来避免它。是所有图像都指向单个用户，还是一些图像在用户之间共享？图像经常变化吗？如果所有图像都属于单个用户并且经常更改，那么将它们保存在会话中是唯一的解决方案。但是，如果某些用户共享图像或图像不会经常更改，那么您可以在 Web 服务和 Web 应用程序之间创建一个代理。代理会将图像保存在内存或数据库中（或者可能在文件系统中），并通过 URL 映射使它们作为资源可用。您需要根据应用程序的内部定义此映射。它可能是这样的：

```
http://imageproxy/username/photo123123 
```

您还需要创建一个 URL 来返回可用图像的数量：

```
http://imageproxy/username/imagecount 
```

无需使用 GeneratedImage 组件。您可以使用标准的 img 标签轻松构建页面的 html 源代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-15T03:54:54.567

`data:`您可以使用URI 方案 将图像数据直接嵌入到页面源中。[这是维基百科的描述](http://en.wikipedia.org/wiki/Data_URI_scheme)。但是，这不适用于 8 之前的 IE 版本，这可能会使您无法接受这种情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-15T06:44:33.317

在 asp.net 中，您可以直接使用响应对象编写和图像，主要浏览器将能够显示它。但是你不能传递一个字节数组，你需要传递一个内存流。

拿你的`System.Web.HttpContext`

```
Dim ms as New Io.MemoryStream(yourarray)
httpcontext.Response.OutputStream.Write(ms.ToArray,0,ms.Length) 
```

你把它放在一个 display.aspx 页面中，如果“yourarray”是一个代表图像的字节数组，浏览器将显示它。

然后，您可以在任何页面（甚至是纯 html）上使用图像控件并将图像源设置为“display.aspx”，然后您的图像就会显示出来。

现在，由于您有多个图像，您可能需要创建一个控件并创建它的多个实例，一个用于传递相应字节数组的每个图像。

# command-line - TFS 命令行和 SSL/TLS 安全异常

> ID：807740
> 
> 赞同：0
> 
> 时间：2009-04-30T16:13:02.887
> 
> 标签：command-line, tfs, ssl-certificate

我正在尝试使用 tf.exe 命令行来设置新的工作区。我不喜欢安装 Team Explorer 的想法，因此需要 Visual Studio。

从安装了 VS 的另一台机器上运行经过测试的命令会导致这台机器出现安全异常，因为我试图通过 https 连接到 TFS。我得到错误字符串：

> Team Foundation Server https://... 不存在或此时不可访问。技术信息（针对管理员）：底层连接已关闭：无法为 SSL/TLS 安全通道建立信任关系。

我试过了

*   ping 服务器 => 很好
*   通过 IE 访问它 => 必须接受认证，否则没问题

还有什么我可以尝试的吗？

非常感谢， 欧文斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-04T09:26:10.490

我们的 ssl 证书是用一些专有证书签署的（不是由像 Verisign 这样的已知机构颁发的），因此我必须安装颁发者证书作为受信任的根证书。之后一切正常。

非常感谢您的奉献。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T16:36:58.040

您可能需要查看[Team System Web Access](http://msdn.microsoft.com/en-us/library/bb892990.aspx)

它提供对 Team Explorer 的大部分功能的基于 Web 的访问。

> 您可以通过远程连接使用 Team System Web Access 来执行以下功能：
> 
> *   创建、查看、查询和跟踪工作项。
> *   管理项目的文档库。
> *   查看版本控制的文件和相关的版本信息。
> *   通过运行构建和查看构建结果来管理软件构建过程。
> *   生成报告以跟踪团队项目一段时间内的状态和趋势信息

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-31T20:54:40.437

您是否尝试过安装证书？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-11T15:58:35.183

如果您使用的是旧版本，则使用 tfpt.exe（也可能是 tf.exe）也会出现此错误。我们在 TFS 2012 服务器上使用 TFPT 2010 遇到了它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-09-10T20:02:00.447

对于即使在安装证书后也遇到此问题的任何人。在某些情况下，服务器和客户端之间的握手不使用相同的 SSL 或 TLS 版本。我在注册表中使用了以下更改来强制客户端上的 TLS，之后它运行良好：

HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft.NETFramework\v4.0.30319 "SchUseStrongCrypto"=dword:00000001

HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft.NETFramework\v4.0.30319 "SchUseStrongCrypto"=dword:00000001

更多信息在这里：[https](https://docs.microsoft.com/en-us/security-updates/SecurityAdvisories/2015/2960358) ://docs.microsoft.com/en-us/security-updates/SecurityAdvisories/2015/2960358和这里[https://blogs.msdn.microsoft.com/friis/2017/10/09/troubleshooting -tls-ssl-scenario-2/](https://blogs.msdn.microsoft.com/friis/2017/10/09/troubleshooting-tls-ssl-scenario-2/)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-30T16:34:44.380

您是否指定了 TFS 端口？SSL 自动将您丢弃到 443 并且 TFS 正在使用，据我记得端口 8080。

首次连接时，您必须指定完整的 url，包括端口号。例如“ [http://team1server:8080](http://team1server:8080) ”。

# c# - ASP.NET 页面性能

> ID：807742
> 
> 赞同：2
> 
> 时间：2009-04-30T16:13:15.990
> 
> 标签：c#, .net, asp.net

我们有一个相当复杂的页面，它动态加载用户控件（其中一些是嵌套的）。这是一个执行速度非常慢的页面。

动态添加控件会增加瓶颈吗？如果我们在 .NET 缓存对象中添加控件并且如果缓存中已经存在 LoadControl 则不使用它会有所帮助吗？

关于使页面更快的任何其他提示/策略？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-30T16:17:36.043

我们曾经将 ASP.Net 项目的性能提高了一个数量级。这是我们尝试过的事情的列表：

*   尽可能将 SessionState 设置为 false 或 ReadOnly。请注意，设置会话状态的方法对于 ASPage、Web 服务和应用程序是不同的。
*   如果可能，将会话状态存储在进程中。
*   尽可能将 EnableViewState 设置为 false。
*   尽可能使用缓存。
*   如果您不需要从服务器访问控件，请使用 HTML 控件而不是服务器端控件。
*   尽可能避免往返（向服务器提交数据并重新加载页面）。请注意，您只需要往返从服务器读取数据或向服务器写入数据。验证和反馈可以在客户端完成。使用 Page_Load 中的 IsPostBack 属性来避免在回发时重新生成数据。
*   使用 StringBuilder 类进行重复连接。
*   仅在意外情况下使用 try/catch 块；不要将它们用作一般控制结构。
*   尽可能使用早期绑定。换句话说，避免反思。
*   避免使用非托管代码，例如 COM。
*   禁用发布应用程序的调试模式。
*   使用存储过程而不是 SQL 字符串进行数据库访问。
*   使用 DataReader 类而不是 DataSet 来读取数据。
*   尽可能使用限制性最强的类，例如 SqlDataReader 而不是 DbDataReader。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T16:14:58.437

将 Trace="true" 添加到您的 @Page 指令中，您将能够看到哪些方法花费的时间最长。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T16:24:25.683

如果简单地动态加载控件会导致很大的性能成本，我会感到有些惊讶。但是，如果有很多控件，并且它们嵌套很深，那么 ASP.NET 有时将它们呈现为 html 会很慢。显然，按照其他人的建议进行分析以确定瓶颈的真正位置。

对于复杂页面，要检查的一件事是呈现的 html 的大小。使用许多服务器控件，页面大小可以惊人地快速攀升至数兆字节。打开或调整您的 http 压缩可能是您正在寻找的答案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T16:24:50.893

调查性能问题的第一步是确定瓶颈：是网络流量（太多的 HTTP 请求？太多的 HTML 进入管道？）还是服务器上的 CPU 受限？还是太多的数据库调用？

在许多情况下，导致速度变慢的是页面的绝对大小。如果你在页面上包含很多控件，那么就会有很多 HTML，所以如果你在最终渲染的产品上查看源代码并找到 20000 行 HTML/javascript，那么很可能减速太多了通过网络发送的数据。

我建议使用像 YSlow 这样的工具来帮助更好地理解最终渲染的产品。

要查看的关键项目：

*   管理视图状态大小
*   确保隐藏的页面部分设置为 .Visible=False（而不仅仅是 style="display: none;"）
*   集中和整合 javascript
*   最小化 HTTP 请求的数量

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T16:55:46.403

动态加载用户控件绝对不是性能下降的原因。通常会显着阻止 ASPX 页面性能的一件事是视图状态。我会建议将视图状态从页面中移除 [即使您已在某些控件上启用它]。

将完整的视图状态作为会话变量存储在服务器上，并且只传输视图状态字段中的标识符。你可以在[这里](http://www.eggheadcafe.com/articles/20040613.asp)查看完整的文章，文章还给出了性能测量指标。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T16:15:34.987

我怀疑它动态加载控件的行为会减慢它的速度，以及每个控件的行为。他们都打数据库吗？我想看看您是否可以在尝试优化它们的加载之前简化控件的性能（缓存数据库调用等）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T16:19:03.637

我会在页面上做一些分析，看看真正的减速发生在哪里。通常，根据我的经验，我认为实际上可能导致减速的并不是最慢的地方。我发现当事情开始运行缓慢时，最好对我的应用程序/页面进行概要分析，这样我就可以很好地了解我可以最好地加速哪些领域以获得显着的改进。您可能会发现数据库调用过多、用户控件加载或其他您没有考虑过的问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-30T17:25:37.270

网页执行缓慢的原因有很多。您确实需要使用诸如性能向导之类的工具来开始确定正在发生的事情。

我们最新的性能问题归结为匿名类型和 linq。由于所有的 JIT 编译都在进行，所以很容易用这两件事来破坏性能。

# macos - 无法激活 MacPorts 安装的 Zsh

> ID：807748
> 
> 赞同：3
> 
> 时间：2009-04-30T16:13:53.853
> 
> 标签：macos, zsh, macports

通过将以下路径设置为 Settings，我将 MacPorts 安装的未成功 Zsh 作为我的登录 shell

```
/opt/local/bin/zsh 
```

我也把它放在用户帐户的高级选项中。我收到以下错误 [替代文本 http://dl.getdropbox.com/u/175564/macportsError.png](http://dl.getdropbox.com/u/175564/macportsError.png)

我将以下路径设置为失败

```
/opt/local/var/macports/software/zsh/4.2.7_0+mp_completion 
```

再次启动 shell 时出现以下错误

```
login: /opt/local/var/macports/software/zsh/4.2.7_0+mp_completion: Permission denied

[Process completed] 
```

**如何将 Zsh 激活为登录 shell？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T16:30:20.117

正如 Norbert 所说，我认为答案在 /etc/shells 中。我的有这个：

```
# List of acceptable shells for chpass(1).
# Ftpd will not allow users to connect who are not using
# one of these shells.

/bin/bash
/bin/csh
/bin/ksh
/bin/sh
/bin/tcsh
/bin/zsh 
```

添加`/opt/local/bin/zsh`到该列表中，您应该没问题。然后，您应该能够使用`chsh`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-31T23:25:27.590

我知道这个问题已被标记为已回答，但是

/opt/local/var/macports/software/zsh/4.2.7_0+mp_completion

甚至不是 macports 中的可执行文件。这就是你得到错误的原因。Shell 必须是可执行的。

您想将 shell 设置为 /opt/local/bin/zsh 。

这在 Leopard 和雪豹中都对我有用。OSX 实际上并没有使用 /etc 进行配置管理，它使用 NetInfo (Leopard)，现在它使用 Directory Services (Snow Leopard)。您想通过在“系统偏好设置”>“帐户”(SL) 中右键单击您的用户或使用 Netinfo Manager (Leopard) 来设置它

编辑：

雪豹： sudo dscl 。-create /Users/chiggsy UserShell /opt/local/bin/zsh

（创建创建或更新）

编辑：请想象我浑身脏兮兮的，臭不可闻的耻辱。我正在使用 iTerm，并且在我的帐户中更改外壳程序完美无缺。在终端中，我得到了与 OP 相同的结果，并通过编辑 /etc/shells 来修复它。现在，在我看来，我不应该通过简单地使用 3rd 方终端来绕过 /etc/shells 限制，但似乎确实如此。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T16:25:23.967

您是否将 shell 输入到 /etc/shells. 似乎 Mac OS 在那里管理着有效的 shell。我不能确切地说，因为我不在 Mac 上

# c# - WinForms 控件 - 完全初始化后的操作

> ID：807757
> 
> 赞同：0
> 
> 时间：2009-04-30T16:15:31.523
> 
> 标签：c#, winforms, initialization

对于 WinForms 控件，我想在容器初始化控件之后添加一个处理程序（或者甚至更好，在父控件初始化所有包含的控件之后）。

原因：自定义控件有一个自动触发动作的选项。它也应该在首次启用此选项时触发。

但是，此时，其他属性（如事件处理程序）尚未正确连接，因此效果不如预期。

这可能吗？

**[编辑]**

我知道这听起来“有点不寻常”，所以我想澄清一下：

它适用于[这个组件](http://www.codeproject.com/KB/menus/fileselect.aspx)：粗略地，添加一个“自动创建新文档”选项。

我可以在初始化期间或在初始化期间分配属性时创建 DocumentInfo 本身。但是，此时我还应该触发事件来告诉（通常是父窗体）它需要更新 UI。该事件可能尚未连接，或者其他控件仍未初始化，这就是为什么我想延迟事件直到父窗体完全初始化。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T16:19:44.697

您是否尝试过连接到表单的 Load 事件并在那里完成工作？（请注意，每次您显示表格时都会触发...）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T16:28:15.783

我所知道的唯一一件事就是直接从控件中执行此操作，将覆盖 OnVisibleChanged，并在第一次显示控件时处理您的操作。

但是，我会重新考虑这样做的必要性。这将导致您的控件的行为与标准 Windows 窗体控件不同。试图将你的行为与非标准事件挂钩对我来说似乎是维护和可用性的噩梦......

# .net - 观察者模式与事件驱动模型有何不同？

> ID：807778
> 
> 赞同：16
> 
> 时间：2009-04-30T16:20:05.523
> 
> 标签：.net, design-patterns, events, observer-pattern

我是一名高级开发人员，但我没有接受过大量的正式培训，虽然我使用过很多设计模式，并且在我作为开发人员的这些年看到它们使用过，但没有人真的特意去说。“哦，这是一个观察者模式，或者这是一个单例模式。”

阅读了一些设计模式，我遇到了观察者模式，它似乎与 .NET 框架事件的工作方式非常相似。我错过了一些基本的东西吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-30T16:23:45.437

.NET 事件模型几乎是公共语言运行时中观察者模式的集成实现。.NET 语言直接以特定语言的方式实现观察者，使用框架对此的内置支持。

在大多数编程语言中，观察者模式需要定制的开发或库。

它作为 C#、VB.NET 和大多数其他使用 CLR 构建的语言的语言的一部分免费提供。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-12-12T20:46:48.370

来自[MSDN](http://msdn.microsoft.com/en-us/library/ee817669.aspx)

> 熟悉 FCL 中公开的类型的人会注意到，框架中不存在 IObserver、IObservable 或 ObservableImpl 类型。它们缺席的主要原因是 CLR 使它们在一段时间后过时了。虽然您当然可以在 .NET 应用程序中使用这些构造，但委托和事件的引入提供了一种新的、强大的方法来实现观察者模式，而无需开发专用于支持该模式的特定类型。事实上，由于委托和事件是 CLR 的一等成员，因此这种模式的基础被合并到 .NET Framework 的核心中。因此，FCL 在其结构中广泛使用了观察者模式。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-30T16:25:25.150

许多事件模型，如 Java 1.1 及更高版本，以及 .NET 事件模型，基本上都是观察者模式的实现。

请注意，这甚至适用于较旧的机制，例如在 C 中使用回调方法进行事件处理。这是相同的意图，只是实现方式略有不同。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2009-04-30T16:22:51.973

为什么你认为一定有区别？

您不认为 .NET 设计人员也阅读*设计模式*吗？

实际上，观察者模式（就像本书中的所有内容一样）早在 Gof4 对其进行分类和命名之前就已为人所知。它用于实现 .Net 事件模型，以及 Win32 和 Win16 事件模型，可能还有许多其他事件模型。

# svn - 谷歌代码 + SVN 或 GitHub + Git

> ID：807782
> 
> 赞同：59
> 
> 时间：2009-04-30T16:20:16.100
> 
> 标签：svn, git, github, google-code

让我先告诉你，除了 SVN，我从没用过任何东西，而且我也是 Windows 用户。

我有几个简单的开源项目，当我很高兴发布他们的源代码时，其他项目正在进行中。无论哪种方式，我都在考虑使用 Google Code 和 SVN 来共享我的项目的源代码，而不是在我的网站上提供指向源代码的链接。这一直很痛苦，因为每次发布新版本时我都必须更新二进制文件和代码。这也将帮助我在某个地方备份我的代码，而不仅仅是我的本地机器（我曾经有一个本地 Subversion 服务器正在运行）。

我想要从这样的服务中得到的非常简单......**我只想要一个地方来存储我的源代码，人们可以根据需要下载它，这样我就可以控制修订并提供一个简单易用的问题/错误系统，以便人们可以提交错误和类似的东西。**我想他们俩都有这个。

但我不想在他们的网站上托管任何二进制文件。我希望将其托管在我的网站上，以便我可以使用自己的脚本控制下载统计信息。我也不需要 wiki 页面，因为我更喜欢在自己的网站上拥有所有文档。这些服务中是否有任何一种方法可以“禁用”wiki 和下载等功能，并且根本不为我的项目显示它们？

现在，我确信将 Google Code 与 SVN 和 GitHub 与 Git 结合使用有很多优点和缺点（当然），但以下是对我来说重要的每一点，以及我喜欢它们的原因：

**谷歌代码：**

*   与任何 Google 页面一样，复杂性几乎不存在
*   每个人（或几乎每个人）都有一个 Google 帐户，如果人们想使用问题系统报告问题，那就太好了

**GitHub：**

*   可能（或可能不会）比谷歌的页面更复杂（虽然对我来说不是问题）但是......
*   ...具有比 Google 的服务更漂亮的界面
*   它需要人们在 GitHub 上注册才能发布问题
*   我喜欢使用 Git，您可以在本地进行自己的修订（我可以为此使用 TortoiseGit 吗？）

基本上就是这样。不多，我知道...

您能告诉我每个网站/软件的其他常见优缺点吗？请记住，我的项目很简单，我可能是唯一一个会在这些存储库上开发这些项目的人（或者可能不会，但现在我是）。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-04-30T16:34:50.790

Google Code 现在[支持 Mercurial](http://arstechnica.com/open-source/news/2009/04/google-code-adds-mercurial-version-control-system.ars)。Mercurial 应该为您提供 Git 的大部分好处，但您可以获得 Google Code 的成熟度。如果您愿意，您也可以选择在那里进行颠覆。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2011-07-16T08:58:10.693

Google 代码项目托管[现在支持 Git](http://code.google.com/p/support/w/list?q=label:Git)。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-08-25T20:10:22.733

GitHub 有两个主要优势：

1.  它使用 git（呃！）
2.  这是一个非常“社交”的环境。

GitHub 可以*很*容易地为其他人的代码做出贡献，也很容易让他们重新集成。他们还内置了很多很酷的 post-commit 钩子；例如，当我提交到我的一个存储库时，会向我的 Google Groups 公告列表发送一封电子邮件，并且一个机器人会弹出到 irc 频道，给出更改的摘要，然后再次弹出。我知道[至少有一项](http://runcoderun.com)CI 服务会在 GitHub 提交（或者更确切地说，推送）上触发。

如果您打算将其作为一个相当小的、单独的项目，那么您可能不会发现 GitHub 的大多数功能都那么有用。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-04-30T16:37:28.587

我自己对 TortoiseGit 并没有特别积极的体验。我真的很喜欢 git 模型，但是当我尝试在 Windows 上使用它时，我觉得它的一切都很奇怪。我经常最终只使用 cygwin 版本，但即使这样也远非完美。

老实说，对于您想要开源的小型项目，我可能只是托管在谷歌代码上并暂时处理 SVN。如果您已经是 git 专家，情况可能会有所不同，但我不确定学习曲线对于基于 Windows 的小型项目是否值得（尤其是考虑到可能被关闭的 Windows 开发人员的数量）它）。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-04-30T20:12:41.250

这些是 Google Code 的答案（我使用并且非常满意）：

> 但我不想在他们的网站上托管任何二进制文件

所以不要 - Google 服务条款中的任何内容都没有要求您这样做。

> 我也不需要维基页面

wiki 页面，就像 GC 站点上的几乎所有选项卡一样，可以禁用和隐藏。

为什么不为您的项目创建一个 Google 代码页面（大约需要 2 分钟，而且是免费的）并使用管理选项来查看它是否符合您的要求？

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-05-07T21:53:23.603

Github 现在支持 Subversion [http://slashdot.org/submission/1232328/](http://slashdot.org/submission/1232328/)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-30T16:53:33.150

听起来 Google Code 更适合您的需求，即它使用 SVN（现在是 Mercurial，但 SVN 因为那是您最熟悉的）。至于您不太关心的其他功能，那么是的，您可以通过在 UI 中禁用它们的选项卡来禁用它们。

我是 Google Code 的粉丝——它简单直接。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-07-03T20:50:19.173

SVN 是我用过的第一种源代码控制。它工作了一段时间，但在切换到 GIT 后我再也没有回头。听起来阻止你使用 git 的最大问题是一个很好的工具。我使用了一段时间的 tortoiseSVN，并在进行转换时尝试了 tortoiseGit，但不太满意。

试试[Git Extensions](http://code.google.com/p/gitextensions/)，它是迄今为止在任何操作系统上最好的 git gui 界面。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-07-03T20:44:55.017

为什么不两者都用？您可以使用 google 代码来托管项目并使用 github 作为您的存储库。以[robots.org](http://robotium.org)为例。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-10-10T17:57:20.703

很明显，git 正在获胜，它是一个很棒的工具（但它需要时间）。有了谷歌代码 git 支持， github/gcode 之间没有真正的大区别。如果你想在同一个提供商上拥有私有存储库和公共存储库，那么 github 也是如此。另外我正在使用 Eclipse 和 egit 插件（3.7.x）是 eclipse 项目的一部分，但在大多数情况下需要作为插件安装。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-04-30T18:44:44.777

bitbucket [（](https://bitbucket.org/)用于 git 和 mercurial）或[Team Foundation Service](http://tfs.visualstudio.com/)（用于 git 和 TFS（Microsoft CVS））呢？他们都提供 5 个免费的私有仓库和 git 支持。此外，[Bitbucker](http://sourcetreeapp.com/?utm_source=bitbucket-sourcetree&utm_medium=website&utm_campaign=homepage)为 mac 和 windows 提供了一个 git 客户端，TFS 提供了[很多项目管理工具。](http://tfs.visualstudio.com/en-us/home/features/feature-tour/)

我认为 bitbucket 和 tfs 不像 github 那样社交，但是如果您需要私有存储库，也许您想放松这种“社交性”

希望这能带来一些光明。

# search-engine - 爬取整个网站内容

> ID：807786
> 
> 赞同：0
> 
> 时间：2009-04-30T16:20:54.570
> 
> 标签：search-engine

我将内容源指定为内部非共享点网站

例如[http://internal.example.com](http://internal.example.com)

但是，完全爬网只爬取网站根目录中的 22 个页面（有 100 个），除非我指定“自定义 - 指定页面深度和服务器跳数：”并将“页面深度”和“限制服务器跳数”保留为无限

然后让爬行变得精神！

更新：我正在使用 MS Search Server Express 2008

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T17:07:54.223

Wget 非常聪明。这是我用来递归快照站点的命令行。

`wget -r -k -K --no-parent http://internal.example.com/`

[http://gnuwin32.sourceforge.net/packages/wget.htm](http://gnuwin32.sourceforge.net/packages/wget.htm)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T16:29:30.570

您可能想要准确指定用于执行此爬网的工具/技术。另外，你有没有尝试过无限制以外的东西，结果如何？

# regex - Jmeter - 嵌入变量和 $ 的正则表达式问题

> ID：807789
> 
> 赞同：4
> 
> 时间：2009-04-30T16:22:15.627
> 
> 标签：regex, perl, variables, jmeter

问候，

*在 Jmeter 的正则表达式组件中，当表达式同时具有变量和文字“ $* ”时，我遇到了问题。它总是返回失败。当我用硬编码值替换变量时，它工作正常。我已经验证该变量在之前的调用中返回了预期值。

**失败的表达式：（**变量和文字'$'）

```
<option value="${variable}".+?>\$(.+?)</option> 
```

**工作版本：（**无变量）

```
<option value="1".+?>\$(.+?)</option> 
```

或者，如果我删除文字“ *$* ”，它会起作用。

**替代。工作表达式：（**变量，没有文字'$'）

```
<option value="${variable}".+?>(.+?)</option> 
```

想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T19:12:30.863

解决方法是用 \W 或 \S 替换 \$

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-20T03:12:24.160

您可以尝试`[$]`使用反斜杠转义它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T17:06:43.507

您可以使用 BeanShell 函数来完成此操作，该函数可以访问“vars”对象。

例如，vars.get("variable") 等价于 ${variable}。

[链接1](http://jakarta.apache.org/jmeter/usermanual/functions.html) <--在页面上搜索Bean

# asp.net - 为什么每个控件在我们的注册页面上都像是一个单独的页面？

> ID：807793
> 
> 赞同：0
> 
> 时间：2009-04-30T16:22:46.670
> 
> 标签：asp.net, user-controls

对于注册过程，我们有 5 个不同的页面，开发人员将它们塞进了一个页面（5 个部分中的每一个都是一个用户控件）。

一次只有一个控件设置为可见。

似乎每个控件的`page_load`事件都是同时触发的。

这是设计问题还是预期行为？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T16:25:53.370

这就是他们实际工作的方式。由于所有控件都同时在页面上，并且您只是使用可见属性，所有控件加载事件都将被触发。如果您想避免这种情况，请在页面上放置一个多视图，每个控件在该多视图内的自己的视图中（让控件可见为真）然后只需更改多视图当前视图索引，而不是在用户控件上设置可见/不可见.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T16:25:42.263

load 事件将在页面生命周期中的同一点在页面上的所有控件上触发，是的。这是有意的，这样每个控件都可以处理（或不处理）事件并做一些事情，比如从数据库中获取数据等等。

无论控件是否可见，都会触发加载事件。您*可以*通过执行类似的操作来跳过逻辑而不会破坏任何内容

```
 public yadda yadda yadda OnLoad( ... ) {
    if(!this.Visible) return;
    //...
 } 
```

但这需要在加载之前正确设置可见性，并且如果你突然跳过它的所有逻辑，控制也不会中断。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T16:25:46.820

预计它会依次在每个控件上调用 Load。

不管控件是否可见，它仍然在服务器上处理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T16:26:18.860

我不认为这些是“并行”加载的。他们只是一个接一个地很快。

默认禁用所有，并在页面中一次又一次地启用它们。
并且只执行他们自己的 pageLoad 东西，如果它们被启用的话。

另一方面，我强烈建议取消您的注册。永远不需要 5 页的信息，只会吓到可能的新用户。

# c# - LINQ：选择一个对象并更改某些属性而不创建新对象

> ID：807797
> 
> 赞同：256
> 
> 时间：2009-04-30T16:23:23.517
> 
> 标签：c#, linq

我想更改 LINQ 查询结果对象的某些属性，而无需创建新对象并手动设置每个属性。这可能吗？

例子：

```
var list = from something in someList
           select x // but change one property 
```

* * *

## 回答 #1

> 赞同：438
> 
> 时间：2009-04-30T16:28:09.747

我不确定查询语法是什么。但这里是扩展的 LINQ 表达式示例。

```
var query = someList.Select(x => { x.SomeProp = "foo"; return x; }) 
```

这样做是使用匿名方法 vs 和表达式。这允许您在一个 lambda 中使用多个语句。所以你可以将设置属性和返回对象这两个操作组合成这个有点简洁的方法。

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2009-06-12T10:15:04.860

如果您只想更新所有元素的属性，那么

```
someList.All(x => { x.SomeProp = "foo"; return true; }) 
```

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2013-03-21T15:43:41.653

我更喜欢这个。它可以与其他 linq 命令结合使用。

```
from item in list
let xyz = item.PropertyToChange = calcValue()
select item 
```

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2009-04-30T16:32:58.690

不应该有任何 LINQ 魔法阻止你这样做。不要使用投影，尽管它会返回一个匿名类型。

```
User u = UserCollection.FirstOrDefault(u => u.Id == 1);
u.FirstName = "Bob" 
```

这将修改真实对象，以及：

```
foreach (User u in UserCollection.Where(u => u.Id > 10)
{
    u.Property = SomeValue;
} 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-04-30T16:30:20.927

使用标准查询运算符是不可能的 - 它是语言集成查询，而不是语言集成更新。但是您可以在扩展方法中隐藏您的更新。

```
public static class UpdateExtension
{
    public static IEnumerable<Car> ChangeColorTo(
       this IEnumerable<Car> cars, Color color)
    {
       foreach (Car car in cars)
       {
          car.Color = color;
          yield return car;
       }
    }
} 
```

现在您可以按如下方式使用它。

```
cars.Where(car => car.Color == Color.Blue).ChangeColorTo(Color.Red); 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2018-06-14T08:15:31.517

如果您想使用`Where`子句更新项目，则使用 .Where(...) 会截断您的结果，如果您这样做：

```
list = list.Where(n => n.Id == ID).Select(n => { n.Property = ""; return n; }).ToList(); 
```

您可以对列表中的特定项目进行更新，如下所示：

```
list = list.Select(n => { if (n.Id == ID) { n.Property = ""; } return n; }).ToList(); 
```

即使您没有进行任何更改，也请始终返回项目。这样，它将保留在列表中。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-08-25T13:01:29.603

我们经常遇到这种情况，我们希望在列表中包含索引值以及第一个和最后一个指标而不创建新对象。这使您可以知道项目在列表、枚举等中的位置，而无需修改现有类，然后知道您是在列表中的第一项还是最后一项。

```
foreach (Item item in this.Items
    .Select((x, i) => {
    x.ListIndex = i;
    x.IsFirst = i == 0;
    x.IsLast = i == this.Items.Count-1;
    return x;
})) 
```

您可以使用以下方法简单地扩展任何类：

```
public abstract class IteratorExtender {
    public int ListIndex { get; set; }
    public bool IsFirst { get; set; } 
    public bool IsLast { get; set; } 
}

public class Item : IteratorExtender {} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-30T16:33:34.087

```
var item = (from something in someList
       select x).firstordefault(); 
```

会得到`item`, 然后你可以`item.prop1=5;`改变特定的属性。

或者您是否想从数据库中获取项目列表并让它`prop1`将该返回列表中每个项目的属性更改为指定值？如果是这样，您可以这样做（我在 VB 中这样做，因为我更了解它）：

```
dim list = from something in someList select x
for each item in list
    item.prop1=5
next 
```

（`list`将包含您的更改返回的所有项目）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-08-28T11:16:31.400

由于我没有在这里找到我认为最好的解决方案的答案，所以我的方式是：

使用“选择”来修改数据是可能的，但只是一个技巧。无论如何，“选择”不是为此而设计的。它只是在与“ToList”一起使用时执行修改，因为 Linq 在需要数据之前不会执行。无论如何，最好的解决方案是使用“foreach”。在以下代码中，您可以看到：

```
 class Person
    {
        public int Age;
    }

    class Program
    {
        private static void Main(string[] args)
        {
            var persons = new List<Person>(new[] {new Person {Age = 20}, new Person {Age = 22}});
            PrintPersons(persons);

            //this doesn't work:
            persons.Select(p =>
            {
                p.Age++;
                return p;
            });
            PrintPersons(persons);

            //with "ToList" it works
            persons.Select(p =>
            {
                p.Age++;
                return p;
            }).ToList();
            PrintPersons(persons);

            //This is the best solution
            persons.ForEach(p =>
            {
                p.Age++;
            });
            PrintPersons(persons);
            Console.ReadLine();
        }

        private static void PrintPersons(List<Person> persons)
        {
            Console.WriteLine("================");
            foreach (var person in persons)
            {
                Console.WriteLine("Age: {0}", person.Age);
            ;
            }
        }
    } 
```

在“foreach”之前，您还可以进行 linq 选择...

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-03-11T23:47:14.153

2020年我使用这种`MoreLinq` `Pipe`方法。 [https://morelinq.github.io/2.3/ref/api/html/M_MoreLinq_MoreEnumerable_Pipe__1.htm](https://morelinq.github.io/2.3/ref/api/html/M_MoreLinq_MoreEnumerable_Pipe__1.htm)

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2012-09-05T03:57:49.000

```
User u = UserCollection.Single(u => u.Id == 1);
u.FirstName = "Bob" 
```

# c++ - 简单的 cout 然后 cin 允许空白示例？

> ID：807808
> 
> 赞同：2
> 
> 时间：2009-04-30T16:25:46.787
> 
> 标签：c++, stl

寻找一个可以正常工作的简单 getline 示例。

我想在键盘上输入一些内容并将其分配给 std::string，允许空格和制表符。分隔符是回车符。

TIA，伯特

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T16:30:54.263

```
#include <string>
#include <iostream>
#include <ostream>

int main() {
  std::string s;
  std::cout << "Enter a line: ";
  std::getline(std::cin, s);
  std::cout << "You typed this: " << s << std::endl;
  return 0;
} 
```

示例运行：

```
$ ./a.out
输入一行：foo bar
你输入了这个： foo bar

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T16:34:32.290

重要说明：使用 std::cin 后：

```
cin >> myVar; 
```

尾随换行符不会被删除。你必须使用两次 getline

```
std::getline(std::cin, myString);
std::getline(std::cin, myString); 
```

如果您之前从 cin 中提取过，则一次用于换行符，一次用于实际字符串。还有其他方法可以做到这一点。

# asp.net - 选中复选框的禁用必需字段验证器服务器端

> ID：807820
> 
> 赞同：0
> 
> 时间：2009-04-30T16:28:15.470
> 
> 标签：asp.net, controls

我有一个自定义控件，其中包含多个文本框字段和一个复选框。

如果复选框被选中，并且用户提交了表单，如果文本框为空（并且复选框被选中），我需要允许他们继续。

我必须在没有 javascript 的情况下实现它。

问题是在自定义控件的 OnInit 事件中，我连接了文本框及其验证器，我无法访问复选框的值。

* * *

我一直在尝试覆盖复选框的唯一标识，以便在自定义控件的 OnInit 事件中，如果 this.Context.Request.Form["CheckboxId"] = "On"，我可以禁用所需的字段验证器，但只要我覆盖复选框视图状态的 uniqueID 停止工作。

我想到的另一件事是有一个自定义的 requiredfieldvalidator，它在构造函数中采用 Checkbox 并在值为 false 时被禁用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T16:39:56.240

您是否尝试在**Control.Load**事件期间通过重写**Control.OnLoad**方法来执行控件初始化逻辑？
在控件生命周期的那个阶段，您应该能够访问 CheckBox 的值。

作为旁注，如果您想禁用验证，您不必禁用所有**验证器**控件。相反，您可以简单地将提交表单的按钮上的**Button.CausesValidation**属性设置为**False 。**

**更新：**
听起来您正在构建一个**User Control**，这是一个复杂的控件，由多个作为一个单元一起工作的简单控件组成。
如果您想完全在代码中执行此操作，就像使用**自定义控件**一样，您应该从[CompositeControl](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.compositecontrol.aspx)类继承。这给了你两全其美。然后通过覆盖[CreateChildControls](http://msdn.microsoft.com/en-us/library/system.web.ui.control.createchildcontrols.aspx)方法进行子控件初始化。

# floating-point - Jython：将文本解析为包含逗号的浮点数

> ID：807829
> 
> 赞同：1
> 
> 时间：2009-04-30T16:29:49.260
> 
> 标签：floating-point, jython, string-parsing

如何将从工作表扫描的浮点数解析为包含逗号的文本？

```
txt = "1,903.44"
value = float(txt) # This fails due to ',' in string 
```

更新：对不起，我不清楚。我正在使用 jython 2.5，它没有 locale 模块。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T16:32:39.347

```
txt = "1,903.44"
value = float(txt.replace(',', '')) 
```

如果您需要本地化，这不会真正起作用，但如果您知道逗号是分隔符，它就可以解决问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T16:32:44.697

[`locale.atof()`](http://docs.python.org/library/locale.html)之后使用`locale.setlocale(locale.LC_ALL, '')`。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-30T16:33:23.790

你可以去掉逗号：

```
txt = txt.replace(',', '')
value = float(txt) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T16:46:43.307

在处理货币值时，我个人会使用十进制包，以避免使用浮点数时发生[的有据可查的陷阱。](https://stackoverflow.com/questions/723356/when-is-it-appropriate-to-use-floating-precision-data-types)

```
from decimal import Decimal
txt = txt.replace (',', '')
value = Decimal(txt) 
```

正如其他海报所指出的，这仅在您的语言环境使用“，”作为千位分隔符的情况下才有效，但应该让您朝着正确的方向前进。

# c# - 有没有关于使用 C# 客户端创建 C++ 聊天服务器的文章或建议？

> ID：807846
> 
> 赞同：1
> 
> 时间：2009-04-30T16:32:47.333
> 
> 标签：c#, c++, networking, client

我目前的班级正计划创建一个基本的网络游戏，但我们决定承担使用 C# 客户端制作 C++ 服务器的任务。我知道这可能是一项艰巨的任务，但我想知道是否有任何建议可以实现这一目标。

很抱歉，我没有比这更多的信息了。我们才刚刚开始，只是想确保在我们拥有的时间跨度内这是可能的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T16:35:53.487

这工作正常。C# 和 C++ 都以多种方式支持 TCP 和 UDP 网络连接。无论是客户端还是服务器都可以正常工作。

您需要注意的主要问题是决定如何传输数据，并确保您通过线路传递的任何数据包都以相同的方式进行序列化/反序列化。

如果您在双方都使用相同的语言（或至少是库），这会更简单，即：如果您使用 C++/CLI 作为服务器，并坚持使用一些相同的托管 .NET 工具来处理数据传输.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T16:37:19.193

这真的不是什么大问题——只要你想出一个好的协议。线路上的位并不关心用于编写解释它们的程序的语言。

通过协议，我的意思是你需要清楚地了解谁应该在什么时候做什么、说什么以及期望得到什么。

例如，回显服务器及其客户端可能期望

*   客户先说话
*   有一个很好理解的标识符来标记客户端输入的结束
*   客户端将等待服务器响应，然后再次说话
*   有一个很好理解的标识符来标记服务器输出的结束。

等等。由于协议不兼容，在消息之前发送消息长度而不是使用输入标识符结尾的不同客户端将无法与原始服务器一起使用。

协议可以是灵活的，但您必须考虑协议本身的灵活性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-30T16:44:29.707

正如大家所说，如果您的聊天协议设计良好，这根本不是问题。只有当你使用像使用 BinaryFormatter 这样的技巧来直接将 CLR 对象序列化到网络上时，你才会遇到问题......

我建议您在允许的范围内使用现有协议（例如 IRC）和/或库。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-30T16:35:20.743

如果它全部在一个 windows 域中运行，您可以考虑使用 DCOM。否则，我会选择 Web 服务（C++ 的 SOAP 工具包）或者 REST。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T23:41:03.153

对于聊天程序，请尝试使用聊天协议。

检查[XMPP](http://xmpp.org/about/)，看看你是否可以使用它，或者一个精简的版本。从别人的想法开始从来都不是一个坏主意。至少你可以看到你不喜欢它的地方。:)

# c# - 通过 WCF 服务从接口引用方法

> ID：807849
> 
> 赞同：2
> 
> 时间：2009-04-30T16:33:12.450
> 
> 标签：c#, wcf

说我有以下内容：

```
namespace SomeProject
{
    public interface ISomething
    {
        string SomeMethod();
    }
}

namespace SomeService
{
    [DataContract]
    public class CompositeType
    {
        [DataMember]
        public ISomething Something { get; set; }
    }
} 
```

现在，在我的调用代码中，我希望能够做到这一点：

```
SomeService service = new SomeService();
service.Something.SomeMethod(); 
```

`SomeMethod()`除非我将 DataMember 作为实现而不是接口返回，否则不可用。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T16:39:14.727

您的 WCF "DataContract" 就是这样 - 一个数据合同。在您的客户端，您有一个代理对象，它实现了所有数据成员，但没有实现任何方法。您必须拥有原始类/接口定义并在客户端重建完整对象才能执行此类操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T16:39:24.180

这不是您想要使用 WCF 服务的方式。WCF 是关于传输数据，而不是实现。这样做会使您的客户端和服务层感到困惑。

但是，**如果您真的想这样做**，您可以告诉客户端中的代理生成器重新使用任何现有类型...这意味着您可以

1.  在您的客户端中引用“SomeProject”dll
2.  添加服务参考
3.  选择“高级”
4.  选择“在引用的程序集中重用类型”
5.  选择要从哪里获取类型

**同样，我不建议这样做。**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T16:49:55.450

我强烈建议您阅读一些基本的 WCF 教程，以便了解 WCF 的实际*功能*。

查看 O'Reilly 的书籍，Michele Bustamante 的“Learning WCF”，更重要的是 Juval Lowy 的“Programming WCF Services 2nd Edition”。

WCF 是一头复杂的野兽，我建议您在尝试编写代码之前确实需要打下坚实的基础。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-05-16T11:33:04.300

添加服务引用后，您必须使用实现该服务的目标接口的客户端实例。

例如，假设您的接口称为 ICalculator。添加服务引用时自动生成的代码应如下所示：

```
// Define a service contract.
[ServiceContract(Namespace="http://Microsoft.ServiceModel.Samples")]
public interface ICalculator
{
    [OperationContract]
    double Add(double n1, double n2);
    // Other methods are not shown here.
} 
```

现在，为了使用它的操作，您只需创建一个实现该接口的类的实例，该接口也是自动生成的。这是一个例子：

```
// Create a client object with the given client endpoint configuration.
CalculatorClient calcClient = new CalculatorClient("CalculatorEndpoint"));
// Call the Add service operation.
double value1 = 100.00D;
double value2 = 15.99D;
double result = calcClient.Add(value1, value2);
Console.WriteLine("Add({0},{1}) = {2}", value1, value2, result); 
```

# iis - IIS 会话状态

> ID：807854
> 
> 赞同：4
> 
> 时间：2009-04-30T16:34:00.997
> 
> 标签：iis, session-state

这是一个故事问题：

我在 IIS 6.0（Win 2003）中设置了网站，并检查了在 IIS 中设置配置的“允许会话状态”。

如果用户直接导航到我网站上的静态 html 页面（不是 asp 或 aspx 页面），IIS 是否为用户启动会话？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-01T16:39:58.883

不，IIS 不会启动会话。

HTML 页面不由 ASP.Net 管道处理，因此它们不会被视为 Web 应用程序的一部分。如果您点击 HTML 页面，则 Global.asax 文件中的 Session_Start() 不会触发。

您可以通过在“Session_Start”函数中的 global.asax 文件中放置断点并将启动页面设置为简单的 HTML 文件来验证这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-02T16:09:59.413

另请注意，如果用户点击 ASPX 页面，IIS 将不会启动 ASP 会话，只会启动 ASP.Net 会话。会话状态由 ASP 和 ASP.Net ISAPI 过滤器创建，两者几乎是独立的。

# windows - UDP 服务器监听广播

> ID：807855
> 
> 赞同：3
> 
> 时间：2009-04-30T16:34:07.283
> 
> 标签：windows, perl, udp, activeperl

鉴于：
服务器在运行 ActiveState Perl
的 windows xp 上 服务器连接到内部网络和外部网络
内部网络上的计算机正在通过 udp 广播到端口 9722 上的 10.4.255.255

我需要：
收听广播并将消息传递给函数

这是我正在使用的代码：

```
 my $sock;

do {
  eval {
    $sock = IO::Socket::INET->new(LocalPort => 9722, Proto => 'udp')
            or die("Couldn't open the socket: $@");
    1;
  };
  warn($@) and sleep(5) if($@);
} while ($@);

for(my $i = 0;$i < 20;$i++) {
  my $string = 'a';
  $sock->recv($string,1024);
  print &parseInput($string);
} 
```

请注意 &parseInput 返回它传递的原始字符串。

我的问题：
调用 $sock->recv() 后，$string 变为空。使用另一个应用程序，我可以看到毫无疑问有信息正在跨 10.4.255.255 广播，但我无法访问它。
如果可能的话，我想继续使用 IO::Socket::INET。

编辑：我检查了 recv(..) 和 $! 的返回值。recv(..) 和 $! 没有返回值 =“未知错误”。

编辑 2：我正在尝试使用 Socket；现在并具有以下内容：

```
 $proto = getprotobyname('udp');
socket(SOCKET, PF_INET, SOCK_DGRAM, $proto) or die "socket: $!";
setsockopt(SOCKET, SOL_SOCKET, SO_BROADCAST, 1) or die "sockopt: $!";
bind(SOCKET, sockaddr_in(9722, inet_aton('192.168.0.103'))) or die "bind: $!";
recv(SOCKET, $msg, 128, 0) or die "recv: $!"; 
```

它会生成错误——recv: Unknown error at ...

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-07T12:49:03.257

我相信我发现你是主要问题。

接收器必须绑定到任何接口（ INADDR_ANY ）或网络的广播地址（所有网络之一或定向网络）。

这是广播发送方和接收方的示例代码。

使用 setsockopt 时要小心！你必须打包最后一个参数。

```
#!/usr/bin/perl -w
# broadcast sender script
use strict;
use diagnostics;
use Socket;

my $sock;
my $receiverPort = 9722;
my $senderPort = 9721;

socket($sock, PF_INET, SOCK_DGRAM, getprotobyname('udp'))   || die "socket: $!";
setsockopt($sock, SOL_SOCKET, SO_REUSEADDR, pack("l", 1))   || die "setsockopt: $!";
setsockopt($sock, SOL_SOCKET, SO_BROADCAST, pack("l", 1)) or die "sockopt: $!";
bind($sock, sockaddr_in($senderPort, inet_aton('192.168.2.103')))  || die "bind: $!";

while (1) {
    my $datastring = `date`;
    my $bytes = send($sock, $datastring, 0, 
                     sockaddr_in($receiverPort, inet_aton('192.168.2.255')));
    if (!defined($bytes)) { 
        print("$!\n"); 
    } else { 
        print("sent $bytes bytes\n"); 
    }
    sleep(2);
}

#!/usr/bin/perl -w
# broadcast receiver script
use strict;
use diagnostics;
use Socket;

my $sock;

socket($sock, PF_INET, SOCK_DGRAM, getprotobyname('udp'))   || die "socket: $!";
setsockopt($sock, SOL_SOCKET, SO_REUSEADDR, pack("l", 1))   || die "setsockopt: $!";
bind($sock, sockaddr_in(9722, inet_aton('192.168.2.255')))  || die "bind: $!"; 

# just loop forever listening for packets
while (1) {
    my $datastring = '';
    my $hispaddr = recv($sock, $datastring, 64, 0); # blocking recv
    if (!defined($hispaddr)) {
        print("recv failed: $!\n");
        next;
    }
    print "$datastring";
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-01T22:07:14.710

`$sock->recv`检查和的返回值`print "$!\n"`。`$string`变空时会打印什么样的错误信息？您可能需要做`$sock->connect(...)`或`$sock->bind(...)`打电话之前`$sock->recv()`。

# c# - 是联锁的。交换 微软的预期交换方法？

> ID：807862
> 
> 赞同：2
> 
> 时间：2009-04-30T16:35:23.083
> 
> 标签：c#, .net

那么我们不需要实现自己的 Swap 方法吗？Interlocked.Exchange 是 Microsoft 的预期交换方法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-07-01T10:23:02.670

Interlocked.Exchange 不会交换它的参数。只有第一个参数被改变，而不是第二个参数。“交换”是指将第一个参数的新值交换为其旧值。

这使其成为交换功能的一个非常糟糕的选择。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T16:41:40.540

没有理由不这样做，尽管它不是完全通用的：

*   它保证是原子的，即线程安全的；你可能大部分时间都不需要这个。
*   Interlocked.Exchange 仅适用于引用类型：int、long、IntPtr、float 和 double 有不同的重载。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T20:24:33.827

不要将它用于简单的交换操作，因为它会序列化对内存的访问，可能会使 cpu 缓存无效并停止 cpu。如果您需要管理并发，有比 .NET 中的交换更好的方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-22T00:05:52.733

swap(a,b)->t=a,a=b,b=t : 3 个可以拆分的交易

使用联锁交换（a，b）->interlockedExchange（a，interlockedExhcange（b，a））；问题没有解决，因为它仍然是可以拆分的 2 个操作。

目前看来，获得 interlockedSwap 的最佳方法是放置一个关键部分，以确保步骤不会被拆分。

换个角度看，如果 T 是一对< a, b >，您可以构造一个交换了值的新对，然后使用 T 的 interlockedExchange - 但是构建交换对的操作可能会遭受数据剪切如果其他人正在交换，或者在您尝试进行交换时已经被交换。因此，您再次需要一个关键部分，以确保步骤不会被拆分。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-30T16:41:59.103

我更喜欢这个而不是你自己的 Swap 方法。

Interlocked.Exchange 提供了一种原子处理交换的方法。[它基本上是InterlockedExchangedPointer](http://msdn.microsoft.com/en-us/library/ms683609(VS.85).aspx)的托管包装器。

与您自己的交换方法相比，使用它有很多优点，至少在线程情况下是这样。由于这是一个单一的原子操作，因此在线程应用程序中更安全。

# python - 如何在 Python 中将浮点数列表输出到二进制文件

> ID：807863
> 
> 赞同：34
> 
> 时间：2009-04-30T16:35:43.160
> 
> 标签：python, file-io

我在 Python 中有一个浮点值列表：

```
floats = [3.14, 2.7, 0.0, -1.0, 1.1] 
```

我想使用 IEEE 32 位编码将这些值写入二进制文件。在 Python 中执行此操作的最佳方法是什么？我的列表实际上包含大约 200 MB 的数据，因此最好使用“不太慢”的数据。

由于有 5 个值，我只想要一个 20 字节的文件作为输出。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-04-30T17:32:59.170

亚历克斯是绝对正确的，这样做更有效：

```
from array import array
output_file = open('file', 'wb')
float_array = array('d', [3.14, 2.7, 0.0, -1.0, 1.1])
float_array.tofile(output_file)
output_file.close() 
```

然后像这样读取数组：

```
input_file = open('file', 'rb')
float_array = array('d')
float_array.fromstring(input_file.read()) 
```

`array.array`如果您事先知道项目的数量（例如从文件大小或其他机制），对象也有一个`.fromfile`可用于读取文件的方法

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-04-30T16:39:05.103

参见：[Python 的 struct 模块](http://docs.python.org/library/struct.html)

```
import struct
s = struct.pack('f'*len(floats), *floats)
f = open('file','wb')
f.write(s)
f.close() 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-04-30T17:12:01.280

标准库中的数组模块可能比大家建议的结构模块更适合这个任务。使用数组时，200 MB 数据*的*性能应该会更好。

如果您想采用多种选择，请尝试在您的系统上使用[类似这样的配置文件](https://gist.github.com/deanmalmgren/fd1714799dc5b5643b87#file-write_profiler-py)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-04-30T21:33:52.383

我不确定[NumPy](http://numpy.scipy.org/)将如何比较您的应用程序的性能，但它可能值得研究。

使用[NumPy](http://numpy.scipy.org/)：

```
from numpy import array
a = array(floats,'float32')
output_file = open('file', 'wb')
a.tofile(output_file)
output_file.close() 
```

也会产生一个 20 字节的文件。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-12-08T19:15:14.283

我在无意中编写了一个 100+ GB 的 csv 文件时遇到了类似的问题。这里的答案非常有帮助，但为了深入了解它，[我介绍了所有提到的解决方案，然后是一些](https://gist.github.com/deanmalmgren/fd1714799dc5b5643b87#file-write_profiler-py). 所有分析运行都是在 2014 Macbook Pro 上使用 python 2.7 和 SSD 完成的。从我所看到的，`struct`从性能的角度来看，这种方法绝对是最快的：

```
6.465 seconds print_approach    print list of floats
4.621 seconds csv_approach      write csv file
4.819 seconds csvgz_approach    compress csv output using gzip
0.374 seconds array_approach    array.array.tofile
0.238 seconds numpy_approach    numpy.array.tofile
0.178 seconds struct_approach   struct.pack method 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2019-07-02T10:10:58.370

我的“答案”实际上是对各种答案的评论。我无法发表评论，因为我没有 50 声望。

如果要由 Python 读回文件，则使用“pickle”模块。这个工具可以用二进制读写许多东西。

但是问这个问题的方式，说“IEEE 32位编码”，听起来文件会以其他语言读回。在这种情况下，应指定字节顺序。问题是大多数机器都是 x86，采用 little-endian 字节顺序，但排名第一的数据处理语言是 Java/JVM，使用 big-endian 字节顺序。所以Python的“tofile()”会使用C，由于机器是little-endian而使用little endian，然后Java/JVM上的数据处理代码会使用big endian进行解码，导致错误。

使用 JVM：

```
# convert to bytes, BIG endian, for use by Java
import struct
f = [3.14, 2.7, 0.0, -1.0, 1.1]
b = struct.pack('>'+'f'*len(f), *f)

with open("f.bin", "wb") as file:
    file.write(b) 
```

在 Java 方面：

```
try(var stream = new DataInputStream(new FileInputStream("f.bin")))
{
    for(int i = 0; i < 5; i++)
        System.out.println(stream.readFloat());
}
catch(Exception ex) {} 
```

现在的问题是 Python`'f'*len(f)`代码 - 希望解释器实际上不会创建一个超长的“ffffff ...”字符串。

我会使用 numpy 数组和字节交换

```
import numpy, sys
f = numpy.array([3.14, 2.7, 0.0, -1.0, 1.1], dtype=numpy.float32)

if sys.byteorder == "little":
    f.byteswap().tofile("f.bin") # using BIG endian, for use by Java
else:
    f.tofile("f.bin") 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-30T16:38:02.780

看一下[`struct.pack_into`](http://docs.python.org/library/struct.html?highlight=struct#struct.pack_into)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-30T16:40:14.990

struct.pack() 看起来像你需要的。

[http://docs.python.org/library/struct.html](http://docs.python.org/library/struct.html)

# dll - DCOMCNFG：为什么 dll 不显示？

> ID：807865
> 
> 赞同：2
> 
> 时间：2009-04-30T16:36:27.433
> 
> 标签：dll, dcom

我有一个通过 RegSvr32 注册的 COM DLL，但它没有显示在 DComCnfg 中。

关于为什么的任何帮助？

我想我遗漏了一些注册表项，但我不明白为什么会这样，我认为 RegSvr32 为我做到了。

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T17:52:55.970

regsvr32 仅运行您的 DLL 公开的注册功能。如果您的 DLL 中的注册信息有误，regsvr32 对此无能为力。如果您不确定要查找什么，您可以尝试运行 Regmon（通过 sysinternals）并将过滤器设置为 *regsvr32* 左右，然后查找已注册的 GUID。然后在 DCOMCNFG 的详细信息视图中查找它们。如果 regsvr32 成功，您可能会在那里找到它。这将使您了解问题的根源，尽管实际的解决方案取决于您的注册信息中的错误。

另一个远程选项是您有一些 32-64 位冲突，其中 regsvr32 以 32 位运行，而 DCOMCNFG 以 64 位运行，反之亦然。我不确定 DCOMCNFG 在这种情况下会显示什么 - 我从来没有遇到过这个问题，但是 32 位和 64 位有不同的注册表配置单元，也许你没有找对地方。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-01T00:48:02.463

**适用于大多数 32 位 COM 应用程序**

*   将服务器系统文件安装到 c:\Windows\SysWOW64
*   将 .UDL 文件安装到 c:\program Files (x86)\common files\system\OLE DB\Data Links\
*   将所有应用程序文件安装到 c:\program Files (x86)\...</li>
*   将 32 位 SQL Server 2005/2008 安装到 c:\program Files (x86)\...</li>

**通过 DCOMCNFG (DCOM Config) 注册 32 位 COM 应用程序**

*   开始...运行... mmc -32
*   转到文件→添加/删除管理单元并添加“组件服务”
*   条目将自动添加。添加条目后，您可以再次使用 64 位 DCOMCNFG。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-17T14:25:28.617

**在 64 位服务器上注册 32 位 COM 应用程序的另一种方法**

*   开始...运行...C:\WINDOWS\SysWOW64\mmc comexp.msc /32

如此处所述 [http://msdn.microsoft.com...dcomcnfg.exe_and_64-bit_applications](http://msdn.microsoft.com/en-us/library/ms678426%28VS.85%29.aspx#dcomcnfg.exe_and_64-bit_applications)

# sql-server - 如何禁止 SQL 身份验证

> ID：807866
> 
> 赞同：0
> 
> 时间：2009-04-30T16:36:36.280
> 
> 标签：sql-server, ms-access, dsn, sql-authentication

我真的很难过，我不确定是否有人至少可以指出我正确的方向？

我有一个 MS Access 报告应用程序。它有一些本地表，但主要依赖于它链接到的 SQL Server 2005 数据库中的表。它通过系统 DSN 链接到 SQL DB。

我已经构建了一个函数，可以在运行任何报告之前确认所需的表已链接，并且一切正常。每次系统需要连接到 SQL DB 以刷新链接表时，我都会存储一个连接字符串。但是，当用户 FIRST 运行应用程序时，会弹出一个 SQL 身份验证对话框，要求用户输入所请求数据库的用户名和密码。

无论我做什么，我似乎都无法抑制这一点。系统 DSN 是并且必须为 SQL 身份验证设置，但是如果我可以取消此初始对话框，我的代码将负责继续进行身份验证。

谁能帮我这个？我难住了。

非常感谢您的所有建议！

达拉斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-01T21:08:01.953

呃，您使用 SQL 身份验证而不是 Windows 身份验证有什么重要原因吗？后者使得完全没有必要在连接字符串中存储任何用户信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T17:07:08.357

您是否尝试将 SQL 用户名和密码放在连接字符串中？

```
User Id=myUsername;Password=myPassword; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T18:19:46.327

如果您的任何代码在表检查器运行之前尝试访问这些表（甚至是隐藏表单上的下拉菜单），它将尝试并进行身份验证。

您的验证码本身可能就是罪魁祸首。许多人试图通过检查他们是否可以检索记录来进行验证。相反，请验证连接字符串是否与架构定义中的一样：`CurrentDb.TableDefs("MyTable").Connect`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-16T17:19:20.817

呃，如果你要报告 SQL Server 数据……你为什么要使用 Access？

SQL Server 带有一个非常出色的报告系统，称为“SQL Server Reporting Services”。

一旦你掌握了它的窍门，SQL Server 比 MS Access 更容易使用！

直接针对 SQL 更简单，对吧？

在 Reporting Services 中，有几种方法可以阻止 SQL 身份验证提示。

# javascript - val() 和 text() 的区别

> ID：807867
> 
> 赞同：232
> 
> 时间：2009-04-30T16:36:42.503
> 
> 标签：javascript, jquery, html

`val()`jQuery的函数和函数有什么区别`text()`？

你会在哪里使用一个而不是另一个？

* * *

## 回答 #1

> 赞同：296
> 
> 时间：2009-04-30T16:43:06.573

`.val()`适用于输入元素（或任何具有 value 属性的元素？），`.text()`不适用于输入元素。 `.val()`获取输入元素的值——无论类型如何。`.text()`获取所有匹配元素的 innerText（不是 HTML）：

[`.text()`](http://docs.jquery.com/Attributes/text)

> 结果是一个字符串，其中包含所有匹配元素的组合文本内容。此方法适用于 HTML 和 XML 文档。不能用于输入元素。对于输入字段文本，请使用 val 属性。

[`.val()`](http://docs.jquery.com/Attributes/val)

> 获取第一个匹配元素的value属性的内容

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-04-30T16:52:06.087

text() 返回所有匹配元素（如 p、div 等）的组合文本内容 val() 用于获取输入元素（如 input、select 等）的值

根据官方文档 text() 不应与输入元素一起使用

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2018-01-03T08:52:55.310

**val() 用于从所有 html 输入类型（如复选框、文本等）中获取值，其中用户可以选择输入值。** 前任：-

```
<input type="text" id="txt_name" /> 
 <input type="checkbox" name="vehicle" value="Bike" id="chk_byk" class="ss">bike<br>   
<script type="text/javascript">
 $(document).ready(function () {

            $("#btn_submit").click(function () {
                alert($("#chk_byk").val());
            });

            });

    </script> 
```

**其中 text() 用于从用户不会像（p，div 等）那样交互的 html 元素中获取值**

```
 <p id="p1">Hi how are u??</p>
 <div id="dv5">Debendra</div>

 <script type="text/javascript">

        $(document).ready(function () {

            $("#btn_submit").click(function () {
                alert($("#dv5").text());
            });

            });

    </script> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-12-20T08:21:46.913

.val() 函数从输入元素返回值，而 .text() 函数从输入元素以外的元素返回值。我们还可以将字符串参数传递给这些函数来**设置调用元素的值**。下面的代码展示了如何使用 .val() 和 .text() 函数为 DOM 元素设置值：

HTML部分：

```
<form id="form1"><input id="first" type="text" /><input type="submit" /></form>
<div id="second">Click the "Submit Query" to see it work</div> 
```

jQuery部分：

```
$(document).on("submit", "form", function (e) {
    $("#first").val("This input is set by .val() function");
    $("#second").text("A new text is set using .text() function!");
    return false;
}) 
```

演示：http: [//jsfiddle.net/urhys9zj/6/](http://jsfiddle.net/urhys9zj/6/)

# edi - 是否有人在 X12 或 EDIFACT 中有包含二进制数据的示例文件？

> ID：807871
> 
> 赞同：4
> 
> 时间：2009-04-30T16:37:30.783
> 
> 标签：edi, x12, edifact

我正在 EDIFACT 和 X12 中寻找至少一个显示二进制附件的示例文件。

EDIFACT 应该包括包裹在 UNO/UNP 段中的数据，而 X12 需要使用二进制段 BIN 或 BDS 之一。

感谢您的任何帮助，您可以提供。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-12-01T19:05:30.380

这是一个示例 X12 消息：

```
ISA*00*          *01*PASSWORD00*ZZ*X03400000000108*ZZ*X00450000001001*060424*1244*^*00501*000000017*1*T*>
GS*HI*PARTICIPANTID*PAYER123*20060424*1244*17*X*005010X217
ST*278*1234*005010X217
BHT*0007*13*123*20060424*1244
HL*1**20*1
NM1*PR*2*AETNA 1234560010*****PI*PAYER123
HL*2*1*21*1
NM1*1P*1*POPDELL*ROBERT****24*4376557IM 
PER*IC**TE*6515551212*FX*6513332222
HL*3*2*22*1
NM1*IL*1*SMITH*SARA****MI*352584768003G 
N4*KANSAS CITY*MO*64108
DMG*D8*19560414*F
HL*4*3*EV*1
UM*HS*I*88
PWK*04*EL***AC*JONP56789001
HL*5*4*SS*0
SV1*N4>0173042304
MSG* Oxistat Cream, 1%, 60 gram tube
SE*18*1234
GE*1*17
GS*PI*PARTICIPANTID*PAYER123*20060424*1244*17*X*005010X211
ST*275*1234*005010X211
BGN*02*123456789*20060424*1244
NM1*1P*1*POPDELL*ROBERT****24*4376557IM
NM1*PR*2*AETNA 1234560010*****PI*PAYER123
NM1*IL*1*SMITH*SARA****MI*352584768003G
LX*1
TRN*1*JONP56789001
DTP*368*D8*20060331
CAT*AE*HL
EFI*05***************ASC
BIN*4896*<levelone xmlns="urn:hl7-org:v3/cda" xmlns:v3dt="urn:hl7-org:v3/v3dt" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:hl7-org:v3/cda levelone_1.0.attachments.xsd">
    <clinical_document_header>
        <id EX="a123" RT="2.16.840.1.113883.3.933"/>
        <document_type_cd V="99999-7" DN="Imidazole-Related Antifungals Attachment"/>
        <origination_dttm V="2006-01-05"/>
        <provider>
            <provider.type_cd V="PRF"/>
            <person>
                <id EX="4376557IM" RT="2.16.840.1.113883.19.10.1"/>
                <person_name>
                    <nm>
                        <v3dt:GIV V="Robert"/>
                        <v3dt:MID V="J"/>
                        <v3dt:FAM V="Podell"/>
                        <v3dt:SFX V="MD"/>
                    </nm>
                    <person_name.type_cd V="L" S="2.16.840.1.113883.12.200"/>
                </person_name>
            </person>
        </provider>
        <patient>
            <patient.type_cd V="PATSBJ"/>
            <person>
                <id EX="352584768003G" RT="2.16.840.1.113883.19.10.2"/>
                <person_name>
                    <nm>
                        <v3dt:GIV V="Sara"/>
                        <v3dt:MID V="J"/>
                        <v3dt:FAM V="Smith"/>
                    </nm>
                    <person_name.type_cd V="L" S="2.16.840.1.113883.12.200"/>
                </person_name>
            </person>
            <is_known_by>
                <id EX="184569" RT="2.16.840.1.1138863.19.10.3"/>
                <is_known_to>
                    <id EX="352584768003G" RT="2.16.840.1.113883.19.10.2"/>
                </is_known_to>
            </is_known_by>
        </patient>
        <local_header descriptor="Att_ACN">
            <local_attr name="attachment_control_number" value="XA728302"/>
        </local_header>
    </clinical_document_header>
    <body>
        <section>
            <caption>PRESCRIBER INFORMATION</caption>
            <paragraph>
                <caption>PRESCRIBER INFORMATION, NAME</caption>
                <content>Robert J. Podell, MD</content>
            </paragraph>
            <paragraph>
                <caption>PRESCRIBER INFORMATION, IDENTIFIER</caption>
                <content>4376557IM</content>
            </paragraph>
            <paragraph>
                <caption>PRESCRIBER INFORMATION, SPECIALTY TAXONOMY</caption>
                <content>Hepatologist (207RI0008X)</content>
            </paragraph>
        </section>
        <section>
            <caption>PRESCRIBER CONTACT INFORMATION</caption>
            <paragraph>
                <caption>PRESCRIBER CONTACT INFORMATION, PHONE NUMBER</caption>
                <content>(765) 228-1234</content>
            </paragraph>
            <paragraph>
                <caption>PRESCRIBER CONTACT INFORMATION, FAX NUMBER</caption>
                <content>(765) 228-3123</content>
            </paragraph>
        </section>
        <section>
            <caption>DRUG PRESCRIBED</caption>
            <paragraph>
                <caption>DRUG PRESCRIBED, NAME</caption>
                <content>Oxistat Cream, 1%, 60g tube</content>
            </paragraph>
            <paragraph>
                <caption>DRUG PRESCRIBED, DRUG CODE</caption>
                <content>0173-0423-04 (NDC)</content>
            </paragraph>
            <paragraph>
                <caption>DRUG PRESCRIBED, THERAPY TYPE</caption>
                <content>Replacement (RPLRQ)</content>
            </paragraph>
        </section>
        <section>
            <caption>DRUG HISTORY, PRIOR THERAPY FOR DIAGNOSIS</caption>        
            <paragraph>
                <caption>DRUG HISTORY, PRIOR THERAPY FOR DIAGNOSIS - DRUG NAME</caption>
                <content>Tinactin Cream</content>
            </paragraph>
            <paragraph>
                <caption>DRUG HISTORY, PRIOR THERAPY FOR DIAGNOSIS - DRUG CODE</caption>
                <content>0085-0715-07 (NDC)</content>
            </paragraph>
            <paragraph>
                <caption>DRUG HISTORY, PRIOR THERAPY FOR DIAGNOSIS - DURATION OF THERAPY</caption>
                <content>90 days</content>
            </paragraph>
            <paragraph>
                <caption>DRUG HISTORY, PRIOR THERAPY FOR DIAGNOSIS - REASON PRIOR THERAPY DISCONTINUED</caption>
                <content>Not or no longer effective (NTEFF)</content>
            </paragraph>
        </section>
        <section>
            <caption>IMIDAZOLE-RELATED ANTIFUNGALS, RELATED DIAGNOSIS</caption>
            <paragraph>
                <caption>IMIDAZOLE-RELATED ANTIFUNGALS, RELATED DIAGNOSIS</caption>
                <content>Tinea Pedia (ICD-9-CM 110.4)</content>
            </paragraph>
            <paragraph>
                <caption>IMIDAZOLE-RELATED ANTIFUNGALS, RELATED DIAGNOSIS - CONFIRMED BY</caption>
                <content>KOH Preparation (KOH)</content>
            </paragraph>
        </section>

        <section>
            <caption>FUNGAL INFECTION LOCATION</caption>
            <paragraph>
                <content>Between Toes, right foot (OTH)</content>
            </paragraph>
        </section>
        <section>
            <caption>DRUG PRESCRIBED, REASON FOR TOPICAL THERAPY</caption>
            <paragraph>
                <content>Hepatic Dysfunction (HDS)</content>
            </paragraph>
        </section>
        <section>
            <caption>CO-MORBID CONDITION INFORMATION</caption>
            <paragraph>
                <caption>CO-MORBID CONDITION INFORMATION, LIVER DYSFUNCTION INDICATOR</caption>
                <content>yes (Y)</content>
            </paragraph>
            <paragraph>
                <caption>CO-MORBID CONDITION INFORMATION, LIVER DYSFUNCTION CONFIRMED BY</caption>
                <content>Hepatic Function Panel (HFP)</content>
            </paragraph>
        </section>

        <section>
            <caption>MEDICARE ESRD CERTIFICATION INDICATOR</caption>
            <paragraph>
                <content>Yes (Y)</content>
            </paragraph>
        </section>
        <section>
            <caption>IMIDAZOLE-RELATED ANTIFUNGALS, PRIOR THERAPY TYPE</caption>
            <paragraph>
                <content>Topical (TOP)</content>
            </paragraph>
        </section>
    </body>
</levelone>
SE*12*1234
GE*1*17
IEA*2*000000017 
```

# entity-framework - ADO.NET Entity Framework 和 1:* 关系疑难解答

> ID：807872
> 
> 赞同：3
> 
> 时间：2009-04-30T16:37:57.820
> 
> 标签：entity-framework

我正在尝试完成一个简单的任务，即创建一个包含 2 个具有 1:* 关系的表的数据库。

在一张桌子（Foos）中，我有

```
Id
...
... 
```

在其他（酒吧）我有

```
Id
FooId
...
...
... 
```

我创建了一个从 Bars 到 Foos 的外键关系，其中外键表是 Bars 指向 FooId 列，主键表是 Foos 指向 Id 列。

然后我创建了我的 ADO.NET 实体数据模型，它正确地选取了 Foos 和 Bars 表和关系并创建了导航属性。

现在从我的 MVC 应用程序中，我尝试获得这样的 Foo：

```
var foo = (from f in _db.Foos where f.Id == id select f).FirstOrDefault(); 
```

然后我尝试访问 foo 对象的 Bars 属性并没有得到任何结果。但是，如果我检查 _db.Bars 集，我会看到 FooId 设置为正确 ID 的 Bars。

我应该怎么做才能解决为什么关系不起作用？我查看了 MSDN 中有关表关系的许多教程和文档，但没有明显错误。

我正在尝试在 ASP.NET MVC 应用程序中使用它，以防万一。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T16:50:03.237

在 Foos 表上使用包含

var foo = (from f in _db.Foos.Include("Bars") where f.Id == id select f).FirstOrDefault();

# javascript - 如何在页面加载后执行 JavaScript？

> ID：807878
> 
> 赞同：934
> 
> 时间：2009-04-30T16:38:36.803
> 
> 标签：javascript, html, dom, dom-events, pageload

`<script>`我正在使用inside执行外部脚本`<head>`。

现在，由于脚本在页面加载**之前**执行，因此我无法访问`<body>`，除其他外。我想在文档“加载”后执行一些 JavaScript（HTML 完全下载并在 RAM 中）。当我的脚本执行时，是否有任何可以在页面加载时触发的事件？

* * *

## 回答 #1

> 赞同：1053
> 
> 时间：2009-04-30T16:41:16.300

这些解决方案将起作用：

如评论中所述，使用[defer](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script#attr-defer)：

```
<script src="deferMe.js" defer></script> 
```

或者

```
<body onload="script();"> 
```

或者

```
document.onload = function ... 
```

甚至

```
window.onload = function ... 
```

请注意，**最后一个选项是更好的选择，**因为它不[显眼](http://en.wikipedia.org/wiki/Unobtrusive_JavaScript)并且被[认为更标准](https://stackoverflow.com/questions/807878/javascript-that-executes-after-page-load#comment617710_807891)。

* * *

## 回答 #2

> 赞同：361
> 
> 时间：2016-03-19T00:50:30.190

# 请记住，加载页面有多个阶段。顺便说一句，这是纯 JavaScript

### “DOMContentLoaded”

当*初始 HTML 文档已完全加载和解析*时触发此事件，无需等待样式表、图像和子框架完成加载。在这个阶段，您可以根据用户设备或带宽速度以编程方式优化图像和 CSS 的加载。

在加载 DOM 之后执行（在图像和 CSS 之前）：

```
document.addEventListener("DOMContentLoaded", function(){
    //....
}); 
```

> 注意：同步 JavaScript 会暂停 DOM 的解析。如果您希望在用户请求页面后尽快解析 DOM，您可以**将 JavaScript 设为异步**并[优化样式表的加载](https://developers.google.com/speed/docs/insights/OptimizeCSSDelivery)

### “加载”

一个非常不同的事件**load**应该只用于检测*完全加载的页面*。在 DOMContentLoaded 更合适的地方使用 load 是一个非常普遍的错误，所以要小心。

在加载和解析所有内容后执行：

```
window.addEventListener("load", function(){
    // ....
}); 
```

* * *

*MDN 资源：*

[https://developer.mozilla.org/en-US/docs/Web/Events/DOMContentLoaded](https://developer.mozilla.org/en-US/docs/Web/Events/DOMContentLoaded) [https://developer.mozilla.org/en-US/docs/Web/Events/load](https://developer.mozilla.org/en-US/docs/Web/Events/load)

*所有事件的 MDN 列表：*

[https://developer.mozilla.org/en-US/docs/Web/Events](https://developer.mozilla.org/en-US/docs/Web/Events)

* * *

## 回答 #3

> 赞同：207
> 
> 时间：2009-04-30T16:59:58.797

让您的脚本设置一个在加载时运行的函数的合理可移植、非框架方式：

```
if(window.attachEvent) {
    window.attachEvent('onload', yourFunctionName);
} else {
    if(window.onload) {
        var curronload = window.onload;
        var newonload = function(evt) {
            curronload(evt);
            yourFunctionName(evt);
        };
        window.onload = newonload;
    } else {
        window.onload = yourFunctionName;
    }
} 
```

* * *

## 回答 #4

> 赞同：135
> 
> 时间：2009-04-30T16:42:29.370

您可以在正文中放置一个“onload”属性

```
...<body onload="myFunction()">... 
```

或者，如果您使用的是 jQuery，您可以这样做

```
$(document).ready(function(){ /*code here*/ }) 

or 

$(window).load(function(){ /*code here*/ }) 
```

我希望它能回答你的问题。

请注意，$(window).load 将在您的页面上呈现文档后执行。

* * *

## 回答 #5

> 赞同：78
> 
> 时间：2014-01-10T08:52:41.803

如果脚本是在`<head>`文档中加载的，那么可以使用`defer`脚本标签中的属性。

**例子：**

```
<script src="demo_defer.js" defer></script> 
```

**来自[https://developer.mozilla.org](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script)：**

> **推迟**
> 
> 此布尔属性设置为向浏览器指示脚本将在文档被解析之后但在触发 DOMContentLoaded 之前执行。
> 
> *如果 src 属性不存在（即对于内联脚本），则不得使用此属性，在这种情况下，它将不起作用。*
> 
> 要为动态插入的脚本实现类似的效果，请改用 async=false。具有 defer 属性的脚本将按照它们在文档中出现的顺序执行。

* * *

## 回答 #6

> 赞同：33
> 
> 时间：2013-02-05T12:40:15.160

这是一个基于页面加载后延迟js加载的脚本，

```
<script type="text/javascript">
  function downloadJSAtOnload() {
      var element = document.createElement("script");
      element.src = "deferredfunctions.js";
      document.body.appendChild(element);
  }

  if (window.addEventListener)
      window.addEventListener("load", downloadJSAtOnload, false);
  else if (window.attachEvent)
      window.attachEvent("onload", downloadJSAtOnload);
  else window.onload = downloadJSAtOnload;
</script> 
```

**我在哪里放置这个？**

> 将代码粘贴到 HTML 中标记之前的`</body>`位置（靠近 HTML 文件的底部）。

**它有什么作用？**

> 此代码表示等待整个文档加载，然后加载外部文件`deferredfunctions.js`。

这是上面代码的一个例子 - [JS的延迟渲染](https://varvy.com/pagespeed/defer/defer-example-solved.html)

我基于[延迟加载 javascript](https://developers.google.com/speed/docs/insights/BlockingJS#deferJS) pagespeed google 概念编写了这篇文章，也来自这篇文章[Defer loading javascript](https://varvy.com/pagespeed/defer-loading-javascript.html)

* * *

## 回答 #7

> 赞同：22
> 
> 时间：2009-04-30T16:40:17.847

查看 hooking`document.onload`或 jQuery `$(document).load(...)`。

* * *

## 回答 #8

> 赞同：22
> 
> 时间：2020-04-06T16:22:49.237

# JavaScript

```
document.addEventListener('readystatechange', event => { 

    // When HTML/DOM elements are ready:
    if (event.target.readyState === "interactive") {   //does same as:  ..addEventListener("DOMContentLoaded"..
        alert("hi 1");
    }

    // When window loaded ( external resources are loaded too- `css`,`src`, etc...) 
    if (event.target.readyState === "complete") {
        alert("hi 2");
    }
}); 
```

# jQuery 相同：

```
$(document).ready(function() {   //same as: $(function() { 
     alert("hi 1");
});

$(window).load(function() {
     alert("hi 2");
}); 
```

* * *

**注意：** - 不要使用以下标记（因为它会覆盖其他同类声明）：

```
document.onreadystatechange = ... 
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2013-03-26T09:39:35.327

工作**[小提琴](http://jsfiddle.net/aash1010/w9s0pe96/)**`<body onload="myFunction()">`

```
<!DOCTYPE html>
<html>
 <head>
  <script type="text/javascript">
   function myFunction(){
    alert("Page is loaded");
   }
  </script>
 </head>

 <body onload="myFunction()">
  <h1>Hello World!</h1>
 </body>    
</html> 
```

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2014-09-11T19:23:34.707

```
<script type="text/javascript">
  function downloadJSAtOnload() {
   var element = document.createElement("script");
   element.src = "defer.js";
   document.body.appendChild(element);
  }
  if (window.addEventListener)
   window.addEventListener("load", downloadJSAtOnload, false);
  else if (window.attachEvent)
   window.attachEvent("onload", downloadJSAtOnload);
  else window.onload = downloadJSAtOnload;
</script> 
```

[http://www.feedthebot.com/pagespeed/defer-loading-javascript.html](http://www.feedthebot.com/pagespeed/defer-loading-javascript.html)

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2013-03-06T20:39:46.337

如果您使用的是 jQuery，

`$(function() {...});`

相当于

`$(document).ready(function () { })`

或另一种简写：

`$().ready(function () { })`

请参阅[JQuery $function() 触发什么事件？](https://stackoverflow.com/questions/3908724/what-event-does-jquery-function-fire-on)和[https://api.jquery.com/ready/](https://api.jquery.com/ready/)

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2013-07-20T21:13:54.907

我有时会在更复杂的页面上发现，在 window.onload 被触发时并非所有元素都已加载。如果是这种情况，请在您的函数之前添加 setTimeout 以延迟片刻。它并不优雅，但它是一个简单的 hack，渲染效果很好。

```
window.onload = function(){ doSomethingCool(); }; 
```

变成……

```
window.onload = function(){ setTimeout( function(){ doSomethingCool(); }, 1000); }; 
```

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2014-09-11T11:41:40.550

```
document.onreadystatechange = function(){
     if(document.readyState === 'complete'){
         /*code here*/
     }
} 
```

看这里： http: [//msdn.microsoft.com/en-us/library/ie/ms536957 (v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/ie/ms536957(v=vs.85).aspx)

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2009-04-30T16:41:05.957

只需定义`<body onload="aFunction()">`将在页面加载后调用。您在脚本中的代码不是由`aFunction() { }`.

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2013-04-29T11:32:29.427

```
<body onload="myFunction()"> 
```

这段代码运行良好。

但是`window.onload`方法有各种依赖关系。所以它可能不会一直有效。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2020-06-17T17:59:38.047

# 比较

在下面的片段中，我收集了选择的方法并显示了它们的顺序。评论

*   任何现代`document.onload`浏览器都不支持 (X) （从不[触发](https://stackoverflow.com/q/5135638/860099)事件）
*   如果您`<body onload="bodyOnLoad()">`同时使用 (F) 和`window.onload`(E)，那么只会执行第一个（因为它会覆盖第二个）
*   (F) 中给出的事件处理程序`<body onload="...">`由附加`onload`函数包装
*   `document.onreadystatechange`(D) 不覆盖`document .addEventListener('readystatechange'...)`(C) 可能 cecasue`onXYZevent-like`方法独立于`addEventListener`队列（允许添加多个侦听器）。执行这两个处理程序之间可能没有任何反应。
*   所有脚本都在控制台中写入其时间戳 - 但也`div`可以在正文中写入其时间戳的脚本（在脚本执行后单击“整页”链接以查看它）。
*   解决方案`readystatechange`（C，D）由浏览器多次执行，但针对不同的文档状态：
    *   *loading* - 文档正在加载（没有在代码段中触发）
    *   *交互式*- 文档被解析，之前触发`DOMContentLoaded`
    *   *完成*- 文档和资源已加载，之前触发`body/window onload`

```
<html>

<head>
  <script>
    // solution A
    console.log(`[timestamp: ${Date.now()}] A: Head script`);

    // solution B
    document.addEventListener("DOMContentLoaded", () => {
      print(`[timestamp: ${Date.now()}] B: DOMContentLoaded`);
    });

    // solution C
    document.addEventListener('readystatechange', () => {
      print(`[timestamp: ${Date.now()}] C: ReadyState: ${document.readyState}`);
    });

    // solution D
    document.onreadystatechange = s=> {print(`[timestamp: ${Date.now()}] D: document.onreadystatechange ReadyState: ${document.readyState}`)};

    // solution E (never executed)
    window.onload = () => {
      print(`E: <body onload="..."> override this handler`);
    };

    // solution F
    function bodyOnLoad() {
      print(`[timestamp: ${Date.now()}] F: <body onload='...'>`);      
      infoAboutOnLoad(); // additional info
    }

    // solution X
    document.onload = () => {print(`document.onload is never fired`)};

    // HELPERS

    function print(txt) { 
      console.log(txt);
      if(mydiv) mydiv.innerHTML += txt.replace('<','&lt;').replace('>','&gt;') + '<br>';
    }

    function infoAboutOnLoad() {
      console.log("window.onload (after  override):", (''+document.body.onload).replace(/\s+/g,' '));
      console.log(`body.onload==window.onload --> ${document.body.onload==window.onload}`);
    }

    console.log("window.onload (before override):", (''+document.body.onload).replace(/\s+/g,' '));

  </script>
</head>

<body onload="bodyOnLoad()">
  <div id="mydiv"></div>

  <!-- this script must te at the bottom of <body> -->
  <script>
    // solution G
    print(`[timestamp: ${Date.now()}] G: <body> bottom script`);
  </script>
</body>

</html>
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2015-12-12T08:42:00.907

关于如何[检测文档是否已](http://code.askmein.com/how-to-detect-if-document-has-loaded-using-javascript-code/)使用 Javascript 或 Jquery 加载有一个非常好的文档。

使用本机 Javascript 这可以实现

```
if (document.readyState === "complete") {
 init();
 } 
```

这也可以在区间内完成

```
var interval = setInterval(function() {
    if(document.readyState === 'complete') {
        clearInterval(interval);
        init();
    }    
}, 100); 
```

[例如由 Mozilla](https://developer.mozilla.org/en-US/docs/Web/API/Document/readyState)

```
switch (document.readyState) {
  case "loading":
    // The document is still loading.
    break;
  case "interactive":
    // The document has finished loading. We can now access the DOM elements.
    var span = document.createElement("span");
    span.textContent = "A <span> element.";
    document.body.appendChild(span);
    break;
  case "complete":
    // The page is fully loaded.
    console.log("Page is loaded completely");
    break;
} 
```

使用 Jquery 仅检查 DOM 是否准备就绪

```
// A $( document ).ready() block.
$( document ).ready(function() {
    console.log( "ready!" );
}); 
```

要检查是否所有资源都已加载，请使用 window.load

```
 $( window ).load(function() {
        console.log( "window loaded" );
    }); 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2017-12-21T13:32:26.847

将此代码与 jQuery 库一起使用，这将非常好。

```
$(window).bind("load", function() { 

  // your javascript event

}); 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2018-03-08T02:42:57.043

```
$(window).on("load", function(){ ... }); 
```

[.ready()](http://learn.jquery.com/using-jquery-core/document-ready/)最适合我。

```
$(document).ready(function(){ ... }); 
```

[.load()](https://api.jquery.com/load-event/#load-handler)会起作用，但不会等到页面加载完毕。

```
jQuery(window).load(function () { ... }); 
```

对我不起作用，会破坏下一个内联脚本。我还使用 jQuery 3.2.1 以及其他一些 jQuery 分支。

为了隐藏我的网站加载覆盖，我使用以下内容：

```
<script>
$(window).on("load", function(){
$('.loading-page').delay(3000).fadeOut(250);
});
</script> 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2021-04-02T08:16:11.947

您可以在特定脚本文件上编写一个函数，并使用 onload 属性将其调用到您的 body 元素中。

示例：

```
<script>
  afterPageLoad() {
   //your code here
}
</script> 
```

现在使用 script 标签将您的脚本调用到您的 html 页面中：

```
<script src="afterload.js"></script> 
```

进入你的身体元素；像这样添加 onload 属性：

```
<body onload="afterPageLoad();"> 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2021-11-15T07:31:25.457

DOMContentLoaded 事件在初始 HTML 文档完全加载和解析后触发，无需等待样式表、图像和子框架完成加载。

```
document.addEventListener('DOMContentLoaded', (event) => {
    console.log('DOM fully loaded and parsed');
});
```

加载整个页面时会触发 load 事件，包括所有相关资源，例如样式表和图像。这与 DOMContentLoaded 不同，后者在页面 DOM 加载后立即触发，无需等待资源完成加载。

```
window.addEventListener('load', (event) => {
  console.log('page is fully loaded');
});
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2009-04-30T16:47:28.233

正如丹尼尔所说，您可以使用 document.onload。

各种 javascript 框架（jQuery、Mootools 等）都使用自定义事件“domready”，我想这一定更有效。如果您使用 javascript 进行开发，我强烈建议您使用框架，它们会大大提高您的工作效率。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2009-04-30T17:36:51.377

使用[YUI 库](http://developer.yahoo.com/yui)（我喜欢它）：

```
YAHOO.util.Event.onDOMReady(function(){
    //your code
}); 
```

便携又漂亮！但是，如果您不将 YUI 用于其他东西（请参阅其文档），我会说不值得使用它。

注意：要使用此代码，您需要导入 2 个脚本

```
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/yahoo/yahoo-min.js" ></script>
<script type="text/javascript" src="http://yui.yahooapis.com/2.7.0/build/event/event-min.js" ></script> 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2015-03-30T05:43:37.123

我建议使用`asnyc`脚本标签的属性，这可以帮助您在页面加载后加载外部脚本

```
<script type="text/javascript" src="a.js" async></script>
<script type="text/javascript" src="b.js" async></script> 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2015-09-29T08:43:45.973

```
<script type="text/javascript">
$(window).bind("load", function() { 

// your javascript event here

});
</script>
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-03-30T10:43:53.977

我可以通过此代码捕获页面加载

```
<script>
console.log("logger saber");

window.onload = (event) => {
  console.log('page is fully loaded');
document.getElementById("tafahomNameId_78ec7c44-beab-40de-9326-095f474519f4_$LookupField").value = 1;;
};

</script> 
```

# c# - BCL（基类库）与 FCL（框架类库）

> ID：807880
> 
> 赞同：112
> 
> 时间：2009-04-30T16:38:56.180
> 
> 标签：c#, .net, terminology

两者有什么区别？我们可以互换使用它们吗？

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2009-04-30T16:43:27.387

基类库 (BCL) 从字面上看就是基础。它包含基本的基本类型，例如`System.String`和`System.DateTime`。

框架类库 (FCL) 是一个更广泛的库，包含以下全部内容：ASP.NET、WinForms、XML 堆栈、ADO.NET 等等。您可以说 FCL 包括 BCL。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-04-30T16:43:45.590

### [BCL](https://web.archive.org/web/20100816131838/http://en.csharp-online.net/Glossary:Definition_-_Base_Class_Library)：

> 作为 .NET Framework 库，BCL 是 C# 运行时库的标准，也是公共语言基础结构 (CLI) 标准库之一。BCL 提供了表示内置 CLI 数据类型、基本文件访问、集合、自定义属性、格式设置、安全属性、I/O 流、字符串操作等的类型。

### [整箱](https://web.archive.org/web/20091118143949/http://en.csharp-online.net/Introducing_.NET%E2%80%94The_.NET_Framework_Class_Library)：

> .NET Framework 类库正是它的名字所暗示的：一个包含类和其他类型的库，开发人员可以使用它来使他们的生活更轻松。虽然这些类本身是用 C# 编写的，但它们可以在任何基于 CLR 的语言中使用

您将在每种项目类型中使用 BCL 和 FCL 的某些部分。所以 System.Windows.Forms（一个单独的库）或 System.Web，带有来自 mscorlib 和 System.dll 的 BCL

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2016-01-04T18:52:53.620

**BCL**代表基类库，也称为类库 (CL)。BCL 是框架类库 (FCL) 的子集。类库是与 CLR 紧密集成的可重用类型的集合。基类库提供有助于执行日常操作的类和类型，例如处理字符串和原始类型、数据库连接、IO 操作。

而框架类库包含数千个类，用于构建不同类型的应用程序，并提供应用程序所需的所有基本功能和服务。FCL 包括类和服务以支持不同种类的应用程序，例如

*   桌面应用程序，

*   Web 应用程序（ASP.Net、MVC、WCF），

*   移动应用程序，

*   Xbox 应用程序，

*   windows服务等

更多详细信息，请参阅[.Net 中的 BCL/CL 是什么？](https://modernpathshala.com/Forum/Thread/Interview/7307/what-is-base-class-library)

[![在此处输入图像描述](https://i.stack.imgur.com/SxbSG.jpg)](https://i.stack.imgur.com/SxbSG.jpg)

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2012-12-08T15:03:28.690

基类库 (BCL) 是核心类集，用作公共语言运行时的基本 API。mscorlib.dll 中的类以及 System.dll 和 System.core.dll 中的一些类被认为是 BCL 的一部分。它包括命名空间中的类，如 System 、 System.Diagnostics 、 System.Globalization 、 System.Resources 、 System.Text 、 System.Runtime.Serialization 和 System.Data 等。

框架类库 (FCL) 是 BCL 类的超集，指的是 .NET Framework 附带的整个类库。它包括一组扩展的库，包括 Windows Forms、ADO.NET、ASP.NET、语言集成查询、Windows Presentation Foundation、Windows Communication Foundation 等。

因此存在差异，您不能互换使用它们。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-04-30T16:43:04.360

BCL 是 FCL 的子集。BCL 尊重通用语言基础架构的 ECMA 规范。然后微软添加了它们所有的优点，比如数据和 xml，并将其称为框架类库。基本上他们拿走了 BCL 并把它变成了 11！

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2016-01-19T19:58:23.417

以下内容来自《The C# Player's Guide》一书。

BCL 包含所有内置类型、数组、异常、数学库、基本文件 I/O、安全性、集合、反射、网络、字符串操作、线程等。虽然不是一个完美的指南，但一般规则是任何以 System 开头的命名空间都是 BCL 的一部分。

除了 BCL，Microsoft 还随 .NET Framework 提供了更多类。通常，这些附加内容涵盖了广泛的功能领域，例如数据库访问或图形用户界面（Windows 窗体或 WPF）。包括 BCL 在内的整个集合称为框架类库或 FCL。在随意的讨论中，有时人们会互换使用 FCL 和 BCL，这并不完全正确，但对于大多数事情来说可能已经足够了。

# c# - 跨.NET版本的应用程序引用DLL......可能吗？

> ID：807885
> 
> 赞同：1
> 
> 时间：2009-04-30T16:39:27.583
> 
> 标签：c#, .net

我们组织的软件是为 .NET 3.5 框架编译的。我们有一些客户希望插入我们的库，但坚持使用旧版本的 Visual Studio（.NET 3.5 之前的版本），例如 VS 2003。这些客户有没有办法插入我们的应用程序，尽管事实上他们使用的是旧版本的 Visual Studio（因此使用的是旧版本的 .NET）？目前，当他们尝试引用我们的程序集时，他们会收到一个错误（不幸的是，他们不想指定）。

这可能吗？有这方面的经验吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T16:47:45.533

您可以引用和使用使用以前版本的 .NET 框架编写的库，但反之则不行。因此 .NET 3.5 项目可以使用使用 .NET 1.1 编写的库。但是 .NET 1.1 项目不能使用使用 .NET 3.5 编写的库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T16:41:45.063

到目前为止，您只能在一个进程中加载​​一个 CLR 版本。不可能在单个进程中运行 CLR 1.0 和 2.0。这将在 .NET 4.0 中发生变化（您将能够并排加载 .NET 2.0 CLR 和 4.0）。只要在较新版本的运行时中加载整个内容，就可以引用 DLL（这可能会导致旧应用程序出现一些兼容性问题）。如果他们根本不想安装新的 .NET 框架，那将是不可能的。

# c# - 为什么这个方法每次都返回相同的随机字符串？

> ID：807892
> 
> 赞同：5
> 
> 时间：2009-04-30T16:40:28.703
> 
> 标签：c#, .net, text, random, char

我需要创建一组独特的线条来测试我正在从事的不同项目。

所以我创建了一个简单的程序来生成一个 X 长度的随机字符串。

问题是，如果我调用它一次，我会得到一个随机字符串，如果我再次调用它（例如在 for 循环中），我会在整个循环执行过程中得到相同的字符串。

我有一种感觉，它正在被缓存或其他东西，但我不知道.net 这样做了，我现在很困惑。

**调用代码：**

```
 StreamWriter SW = new StreamWriter("c:\\test.txt");
    int x = 100;
    while (x >0)
    {
        SW.WriteLine(RandomString(20));
        x--;
    } 
```

**这是方法：**

```
private static string RandomString(int Length)
{
    StringBuilder sb = new StringBuilder();
    Random randomNumber = new Random();

    for (int i = 0; i <= Length; ++i)
    {
        int x = randomNumber.Next(65, 122);
        sb.Append(Convert.ToChar(x));
    }
    return sb.ToString();        
} 
```

**这是输出：**

```
"VEWMCQ`Fw]TvSFQawYnoB
VEWMCQ`Fw]TvSFQawYnoB
VEWMCQ`Fw]TvSFQawYnoB
VEWMCQ`Fw]TvSFQawYnoB
VEWMCQ`Fw]TvSFQawYnoB
VEWMCQ`Fw]TvSFQawYnoB
..................
VEWMCQ`Fw]TvSFQawYnoB
VEWMCQ`Fw]TvSFQawYnoB
VEWMCQ`Fw]TvSFQawYnoB
VEWMCQ`Fw]TvSFQawYnoB
VEWMCQ`Fw]TvSFQawYnoB" 
```

那么是什么让我认为 Random.next() 总是会返回一个新的随机数？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-30T16:44:31.890

您创建`Random`实例的时间太近了。每个实例都使用系统时钟进行初始化，并且由于时钟没有改变，您会一遍又一遍地获得相同的随机数序列。

创建该类的单个实例`Random`并反复使用它。

使用`using`关键字，以便在`StreamWriter`完成后关闭并处置它。如果使用`for`关键字，循环代码更容易识别。

```
using (StreamWriter SW = new StreamWriter("c:\\test.txt")) {
   Random rnd = new Random();
   for (int x = 100; x > 0; x--) {
      SW.WriteLine(RandomString(rnd, 20));
   }
} 
```

该方法将`Random`对象作为参数。

此外，使用长度以正确的容量初始化 StringBuilder，这样它就不必在循环期间重新分配。`length`在循环中使用 < 运算符而不是 <=，否则您将创建一个比参数指定的字符长一个字符的字符串。

```
private static string RandomString(Random rnd, int length) {
   StringBuilder sb = new StringBuilder(length);
   for (int i = 0; i < length; i++) {
      int x = rnd.Next(65, 122);
      sb.Append((char)x);
   }
   return sb.ToString();        
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-30T16:44:48.693

请参阅MSN 上的[随机构造函数描述](http://msdn.microsoft.com/en-us/library/h343ddh9.aspx)，这部分：

> 默认种子值来自系统时钟并且具有有限的分辨率。因此，通过调用默认构造函数连续创建的不同 Random 对象将具有相同的默认种子值，因此将产生相同的随机数集。

因此，要么在程序开始时只调用一次 Random() 构造函数，要么使用 Random(int32) 构造函数并自己定义一个可变种子。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-30T16:43:00.820

因为您在每次调用中都会创建一个新的 Random 对象。

只需将 randomNumber 从方法中移出并使其成为类成员。

```
private Random randomNumber = new Random();
private static string RandomString(int Length)
{
    StringBuilder sb = new StringBuilder();
    //...
} 
```

所有软件随机生成器都是“伪随机”，它们基于（起始）种子生成一系列数字。使用相同的种子，它们会产生相同的序列。有时这很有用。如果要生成程序以在每次运行时生成相同的序列，可以使用`new Random(0)`.

编辑：显然.Net Random 类是自动播种的，我不知道。因此，正如其他人指出的那样，这是一个时间问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-30T16:45:35.163

类似的问题，很多答案：

[随机字符串生成 - 两个一个接一个产生相同的结果](https://stackoverflow.com/questions/376344/random-string-generation-two-generated-one-after-another-give-same-results)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-30T16:49:44.780

只声明一次 randomNumber

```
 public class MyClass
{
    private static Random randomNumber = new Random();

    private static string RandomString(int Length)
    {
        StringBuilder sb = new StringBuilder();  

        for (int i = 0; i ... Length; ++i)
        {
        int x = MyClass.randomNumber.Next(65, 122);
        sb.Append(Convert.ToChar(x));
        }
        return sb.ToString();        
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-30T16:46:05.070

由于花费的时间很短，随机数的种子都是相同的，实际上您每次都使用相同的种子重新创建随机生成器，因此 Next() 调用返回相同的随机值。

# drupal - Drupal 中菜单项的“a”标签上的唯一 ID

> ID：807902
> 
> 赞同：0
> 
> 时间：2009-04-30T16:42:27.950
> 
> 标签：drupal, drupal-6, menuitem

我正在尝试在菜单项的“a”标签上生成唯一 ID，以便我可以实现 Popups API。

这就是我在 template.php 中的函数的样子：

```
function phptemplate_menu_item_link($link) {
  if (empty($link['options'])) {
    $link['options'] = array();
  }

  // If an item is a LOCAL TASK, render it as a tab
  if ($link['type'] & MENU_IS_LOCAL_TASK) {
    $link['title'] = '<span class="tab">'. check_plain($link['title']) .'</span>';
    $link['options']['html'] = TRUE;
  }

  if (empty($link['type'])) {
    $true = TRUE;
  }

  //get unique id from menu item title
  $css_id = phptemplate_id_safe(str_replace(' ', '_', strip_tags($link['title'])));

  //set unique id for link
  if ($link['menu_name'] == 'primary-links') {
    $link['options']['attributes']['id'] = 'id-' . $css_id;
  }

  return l($link['title'], $link['href'], $link['options']);
} 
```

我正在使用 Zend 进行调试，并且条件语句有效。我已多次清除缓存、浏览器缓存并重建菜单，但似乎无法正常工作。

作为参考， phptemplate_id_safe 是自定义的（显然）并且工作正常。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-02T02:51:13.547

您可能想查看 menu_attributes 或[此论坛帖子](http://drupal.org/node/411638)。

# sql - 如何比较 SQL Server 中的时间？

> ID：807909
> 
> 赞同：64
> 
> 时间：2009-04-30T16:43:11.567
> 
> 标签：sql, sql-server, datetime

我正在尝试比较 SQL 查询中**日期时间字段**中的时间，但我不知道它是否正确。我不想比较日期部分，只是时间部分。

我正在这样做：

```
SELECT timeEvent 
FROM tbEvents 
WHERE convert(datetime, startHour, 8) >= convert(datetime, @startHour, 8) 
```

这是正确的吗？

我问这个是因为我需要知道`08:00:00`是小于还是大于`07:30:00`并且我不想比较日期，只是**时间**部分。

谢谢！

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2009-04-30T18:55:53.900

您的比较会起作用，但会很慢，因为日期会转换为每一行的字符串。要有效地比较两个时间部分，请尝试：

```
declare @first datetime
set @first = '2009-04-30 19:47:16.123'
declare @second datetime
set @second = '2009-04-10 19:47:16.123'

select (cast(@first as float) - floor(cast(@first as float))) -
       (cast(@second as float) - floor(cast(@second as float)))
       as Difference 
```

长解释：SQL 服务器中的日期存储为浮点数。小数点前的数字代表日期。小数点后的数字代表时间。

所以这是一个示例日期：

```
declare @mydate datetime
set @mydate = '2009-04-30 19:47:16.123' 
```

让我们将其转换为浮点数：

```
declare @myfloat float
set @myfloat = cast(@mydate as float)
select @myfloat
-- Shows 39931,8244921682 
```

现在取逗号后面的部分，即时间：

```
set @myfloat = @myfloat - floor(@myfloat) 
select @myfloat
-- Shows 0,824492168212601 
```

将其转换回日期时间：

```
declare @mytime datetime
set @mytime = convert(datetime,@myfloat)
select @mytime
-- Shows 1900-01-01 19:47:16.123 
```

1900-01-01 只是“零”日期；您可以使用 convert 显示时间部分，例如指定格式 108，即时间：

```
select convert(varchar(32),@mytime,108)
-- Shows 19:47:16 
```

datetime 和 float 之间的转换非常快，因为它们基本上以相同的方式存储。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-30T17:02:49.693

```
convert(varchar(5), thedate, 108) between @leftTime and @rightTime 
```

解释：

如果你有`varchar(5)`你会得到`HH:mm`

如果你有`varchar(8)`你得到`HH:mm ss`

108 仅从 SQL 日期获取时间

`@leftTime`并且`@rightTime`是要比较的两个变量

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-30T16:58:15.430

如果您使用的是 SQL Server 2008，则可以执行以下操作：

```
WHERE CONVERT(time(0), startHour) >= CONVERT(time(0), @startTime) 
```

这是一个完整的测试：

```
DECLARE @tbEvents TABLE (
    timeEvent   int      IDENTITY,
    startHour   datetime
)

INSERT INTO @tbEvents (startHour) SELECT DATEADD(hh, 0, GETDATE())
INSERT INTO @tbEvents (startHour) SELECT DATEADD(hh, 1, GETDATE())
INSERT INTO @tbEvents (startHour) SELECT DATEADD(hh, 2, GETDATE())
INSERT INTO @tbEvents (startHour) SELECT DATEADD(hh, 3, GETDATE())
INSERT INTO @tbEvents (startHour) SELECT DATEADD(hh, 4, GETDATE())
INSERT INTO @tbEvents (startHour) SELECT DATEADD(hh, 5, GETDATE())

--SELECT * FROM @tbEvents

DECLARE @startTime  datetime

SET @startTime = DATEADD(mi, 65, GETDATE())

SELECT
    timeEvent,
    CONVERT(time(0), startHour)  AS 'startHour',
    CONVERT(time(0), @startTime) AS '@startTime'
FROM @tbEvents
WHERE CONVERT(time(0), startHour) >= CONVERT(time(0), @startTime) 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-30T19:26:46.073

到目前为止，我在解决方案中注意到的一个（可能很小）问题是，它们似乎都需要函数调用来处理比较。这意味着查询引擎将需要进行全表扫描以查找您所追求的行 - 并且无法使用索引。如果表格不会变得特别大，这可能不会产生任何不利影响（您可以很高兴地忽略这个答案）。

另一方面，如果表变得非常大，则查询的性能可能会受到影响。

我知道您说您不想比较日期部分 - 但是日期时间列中是否存储了实际日期，或者您是否仅使用它来存储时间？如果是后者，您可以使用简单的比较运算符，这将降低 CPU 使用率，并允许查询引擎使用统计信息和索引（如果存在）来优化查询。

但是，如果使用 datetime 列来存储事件的日期和时间，这显然是行不通的。在这种情况下，如果您可以修改应用程序和表结构，将日期和时间分成两个单独的日期时间列，或者创建一个索引视图来选择源表的所有（相关）列，以及包含您希望搜索的时间元素（使用之前的任何答案来计算） - 并更改应用程序以查询视图。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-06-21T20:08:52.397

```
if (cast('2012-06-20 23:49:14.363' as time) between 
    cast('2012-06-20 23:49:14.363' as time) and 
    cast('2012-06-20 23:49:14.363' as time)) 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2014-12-16T23:50:23.980

只需将转换日期时间更改为应该可以解决问题的时间：

```
SELECT timeEvent 
FROM tbEvents 
WHERE convert(time, startHour) >= convert(time, @startHour) 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-11-02T08:45:05.653

使用浮动不起作用。

```
DECLARE @t1 datetime, @t2 datetime
SELECT @t1 = '19000101 23:55:00', @t2 = '20001102 23:55:00'
SELECT CAST(@t1 as float) - floor(CAST(@t1 as float)), CAST(@t2 as float) - floor(CAST(@t2 as float)) 
```

您会看到这些值不一样（SQL Server 2005）。我想用这个方法来检查午夜前后的时间（完整的方法有更多的细节），我正在比较当前时间在 23:55:00 和 00:05:00 之间。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-30T16:49:31.380

使用 Datepart 函数： [DATEPART](http://doc.ddart.net/mssql/sql70/da-db_8.htm) (datepart, date)

例如＃

> 选择日期部分（@YourVar，hh）*60）+ 日期部分（@YourVar，mi）*60）

这将以分钟为单位为您提供一天中的总时间，让您更轻松地进行比较。

如果您的日期相同，您可以使用 DateDiff，否则您需要像上面那样删除日期

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-30T16:55:13.770

添加到其他答案：

您可以创建一个用于从日期时间修剪日期的函数

```
CREATE FUNCTION dbo.f_trimdate (@dat datetime) RETURNS DATETIME AS BEGIN
    RETURN CONVERT(DATETIME, CONVERT(FLOAT, @dat) - CONVERT(INT, @dat))
END 
```

所以这：

```
DECLARE @dat DATETIME
SELECT @dat = '20080201 02:25:46.000'
SELECT dbo.f_trimdate(@dat) 
```

将返回 1900-01-01 02:25:46.000

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-02-11T19:07:14.030

您可以创建两个日期时间变量，并仅设置您需要比较的日期时间。

```
declare  @date1 datetime;
declare  @date2 datetime;

select   @date1 = CONVERT(varchar(20),CONVERT(datetime, '2011-02-11 08:00:00'), 114)
select   @date2 = CONVERT(varchar(20),GETDATE(), 114) 
```

日期将是“1900-01-01”你可以比较一下

```
if @date1 <= @date2
   print '@date1 less then @date2'
else
   print '@date1 more then @date2' 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-30T16:49:51.440

```
SELECT timeEvent 
  FROM tbEvents 
 WHERE CONVERT(VARCHAR,startHour,108) >= '01:01:01' 
```

这告诉 SQL Server 使用样式 108 将当前日期/时间转换为 varchar，即“hh:mm:ss”。如有必要，您还可以替换另一个转换的 '01:01:01'。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-30T16:50:05.123

相信你想用`DATEPART('hour', datetime)`。

参考在这里：

[http://msdn.microsoft.com/en-us/library/ms174420.aspx](http://msdn.microsoft.com/en-us/library/ms174420.aspx)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-04-30T19:22:19.500

我不喜欢依赖存储内部（日期时间是一个浮点数，整数 = 天，小数 = 时间），但我和 Jhonny D. Cano 的答案一样。这是我认识的所有数据库开发人员的方式。绝对不要转换为字符串。如果您必须避免处理为 float/int，那么最好的选择是使用 DatePart() 提取小时/分钟/秒/毫秒

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-30T16:50:31.097

我假设您的 startHour 列和 @startHour 变量都是 DATETIME；在这种情况下，您应该转换为字符串：

```
SELECT timeEvent
FROM tbEvents
WHERE convert(VARCHAR(8), startHour, 8) >= convert(VARCHAR(8), @startHour, 8) 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-05-16T13:18:31.123

以下查询为您提供日期时间

```
select DateAdd(day,-DateDiff(day,0,YourDateTime),YourDateTime) As NewTime from Table 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-02-02T17:05:34.283

@ronmurp 提出了一个有效的问题——cast/floor 方法同时返回不同的值。根据@littlechris 的答案以及解决具有分钟、秒、毫秒分量的时间的更通用的解决方案，您可以使用此函数来计算从一天开始的毫秒数。

```
Create Function [dbo].[MsFromStartOfDay] ( @DateTime datetime )
Returns int
As
  Begin
      Return (
               ( Datepart( ms , @DateTime ) ) +
               ( Datepart( ss , @DateTime ) * 1000 ) +
               ( Datepart( mi , @DateTime ) * 1000 * 60 ) +
               ( Datepart( hh , @DateTime ) * 1000 * 60 * 60 )
              )
  End 
```

我已经验证它在同一时间为两个不同的日期返回相同的 int

```
declare @first datetime
set @first = '1900-01-01 23:59:39.090'
declare @second datetime
set @second = '2000-11-02 23:56:39.090'
Select dbo.MsFromStartOfDay( @first )
Select dbo.MsFromStartOfDay( @second ) 
```

此解决方案并不总是返回您期望的 int。例如，在 SQL 2005 中尝试以下操作，它返回一个以 '557' 而不是 '556' 结尾的 int。

```
set @first = '1900-01-01 23:59:39.556'
set @second = '2000-11-02 23:56:39.556' 
```

我认为这与存储为浮点数的 DateTime 的性质有关。不过，您仍然可以比较这两个数字。当我在.NET 中使用 DateTime.Now() 捕获并存储在 SQL 中的 DateTime 的“真实”数据集上使用这种方法时，我发现计算是准确的。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-06-01T20:57:45.797

### TL;博士

如果您想在搜索中使用索引，请将时间值与日期值分开（出于性能考虑，您可能应该这样做）。您可以：(1) 使用基于函数的索引或 (2) 仅为时间创建一个新列，索引该列并在 you`SELECT`子句中使用它。

* * *

请记住，如果您在 SQL子句中**使用函数，您将****失去任何索引性能提升**，引擎必须执行*扫描搜索*。只需运行您的查询以确认这一点。发生这种情况是因为引擎必须为每个比较处理字段中的每个值，并且转换后的值没有被索引。**`WHERE`*`EXPLAIN SELECT...`***

 ***大多数答案都说使用`float()`, `convert()`, `cast()`,`addtime()`等。同样，如果您这样做，您的数据库将不会使用索引。对于可能没问题的小桌子。

虽然 ( )可以在`WHERE`params中使用函数`where field = func(value)`，因为您不会更改表中每个字段的值。

如果您想继续使用索引，您可以为时间值创建一个基于函数的索引。执行此操作（并支持它）的正确方法可能取决于您的数据库引擎。另一种选择是添加一列以仅存储时间值并索引该列，但首先尝试前一种方法。

* * *

### *编辑 06-02*

在更新数据库以使用新的时间列或使用索引之前进行一些性能测试。在我的测试中，我发现性能提升很小（当我可以看到一些改进时）并且不值得添加新索引的麻烦和开销。

# .net - .NET 类层次结构海报？

> ID：807920
> 
> 赞同：1
> 
> 时间：2009-04-30T16:44:53.280
> 
> 标签：.net

我记得几年前看到一张海报，它在海报中很好地分解了 .NET 框架类层次结构。我在谷歌上找到的每个链接都指向 MSDN 网站上一个不存在的地方。有谁知道在哪里可以找到最新的？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-30T16:46:48.593

这有帮助吗？[http://blogs.msdn.com/brada/archive/2008/01/12/net-framework-3-5-namespace-poster-updated.aspx](http://blogs.msdn.com/brada/archive/2008/01/12/net-framework-3-5-namespace-poster-updated.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-30T16:47:39.090

这是你要找的吗

[http://download.microsoft.com/download/4/a/3/4a3c7c55-84ab-4588-84a4-f96424a7d82d/NET35_Namespaces_Poster_LORES.pdf](http://download.microsoft.com/download/4/a/3/4a3c7c55-84ab-4588-84a4-f96424a7d82d/NET35_Namespaces_Poster_LORES.pdf)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T16:51:20.813

我为 .NET 2.0 找到了这个

[http://blogs.msdn.com/photos/brada/images/524537/original.aspx](http://blogs.msdn.com/photos/brada/images/524537/original.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-31T02:59:05.307

我尝试了海报，但后来我发现 MSDN 更有用，因为：我正在寻找一种方法来快速了解该类型的所有层次结构。

# php - 寻找 PHP 图像库...圆角和调整大小

> ID：807924
> 
> 赞同：2
> 
> 时间：2009-04-30T16:45:22.217
> 
> 标签：php, image-processing

只是在寻找一个好的 PHP 图像库，我想显示带有圆角的图像，进行一些调整大小，并在运行时或在上传时模糊其他一些图片。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-30T16:48:24.440

试试[http://wideimage.sourceforge.net/wiki/MainPage](http://wideimage.sourceforge.net/wiki/MainPage)

它不是开箱即用的，但您可以有一个部分透明的 PNG，您可以将其放在原始图像之上，使其模糊。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T17:09:51.440

我建议看看 ImageMagick。

PHP 中的库也有出色的包装器：[http ://www.imagemagick.org/script/api.php#php](http://www.imagemagick.org/script/api.php#php)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T18:12:24.973

这是我不久前为一个项目所做的肮脏的黑客攻击。它将灰度图像作为透明度贴图应用于另一个图像（黑色是透明的，白色是不透明的。支持将地图缩放到图像比例）。您可以创建一个合适的圆角透明度贴图（包括抗锯齿，哇！）。

它很慢，因为它是纯 php，但无论如何我总是缓存结果。

$image 和 $transparencyMap 是 gd 图像资源，所以你必须自己 imagecreatefromxyz 它们。

```
<?php
function applyTransparencyMap($image, $transparencyMap) {
    if (!function_exists('extractrgb')) {
        function extractrgb($rgb) {
            $a = ($rgb >> 24) & 0xFF;
            $r = ($rgb >> 16) & 0xFF;
            $g = ($rgb >> 8) & 0xFF;
            $b = $rgb & 0xFF;
            return array($r, $g, $b, $a);
        }
    }

    $sx = imagesx($image);
    $sy = imagesy($image);
    $tx = imagesx($transparencyMap);
    $ty = imagesy($transparencyMap);
    $dx = $tx / $sx;
    $dy = $ty / $sy;

    $dimg = imagecreatetransparent(imagesx($image), imagesy($image));

    for ($y = 0; $y<imagesy($image); $y++) {
        for ($x = 0; $x<imagesx($image); $x++) {
            $intcolor                = imagecolorat($image, $x, $y);
            $intalpha                = imagecolorat($transparencyMap, floor($x*$dx), floor($y*$dy-1));
            list($tr, $tg, $tb, $ta) = extractrgb($intalpha);
            $alphaval                = 127-floor(($tr+$tg+$tb)/6);
            list($r, $g, $b, $a)     = extractrgb($intcolor);
            $targetAlpha             = max(0, min(127,$alphaval+$a));
            $sct                     = imagecolorallocatealpha($image, $r, $g, $b, $targetAlpha);
            imagesetpixel($dimg, $x, $y, $sct);
        }
    }

    return $dimg;
}
?> 
```

另一方面，正如apikot建议的那样，更好地使用[wideimage 。](http://wideimage.sourceforge.net/wiki/MainPage)做同样的事情，甚至更多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-20T18:50:26.197

您可以尝试使用此库[http://freelogic.pl/thumbnailer/examples](http://freelogic.pl/thumbnailer/examples)

# .net - 将 ArrayList 转换为分隔文本文件

> ID：807927
> 
> 赞同：2
> 
> 时间：2009-04-30T16:46:00.577
> 
> 标签：.net, vb.net

我之前问过一个关于我的会议计划应用程序的问题，以及如何删除数组中的特定条目。有人提出了使用 ArrayList 而不是普通数组的有趣建议。我正在尝试学习 ArrayList，但没有好的结果。我什至无法让 ToString 方法正常工作以将我想要的内容写入文本文件。

我有三个重要的领域：

*   日是月历1.selectionend
*   ToD 是在时间组合框中选择的任何内容 (cmbTime.text)
*   约会是约会描述的文本框字段中的任何内容（txtAPPT.text）

我的计划是让这三个字段中的每一个在 ArrayList 中都有自己的条目，但是当它保存到文本文件时，这三个字段以逗号分隔每个约会的一行。当然，当文本被加载时，它必须被转换回来。谁能指出我正确的方向或使用 ArrayList 解决此问题的任何其他方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T18:31:15.270

我建议使用包含数据的类的通用列表，而不是数组列表。然后对于逗号分隔的数据，只需覆盖类的 .ToString() 函数以返回它们之间带有逗号的字段。只需构建一个解析函数以将该分隔字符串读回类中，就可以了。

```
Public Overrides Function ToString() As String
        Return Day & ',' & ToD & ',' & Appointment
End Function 
```

如果您不需要用逗号分隔文件，则应考虑使用 XML 序列化将其保存到文件中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T17:05:57.283

我将创建一个类来封装这三个字段，并定义一个 ToString 方法，该方法以逗号分隔的形式输出它们。然后你也可以给这个类一个`Shared`方法来把一个逗号分隔的字符串解析回一个对象。

然后，您的 ArrayList 将保存此类的对象并每行输出一个。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-30T17:06:05.413

我建议您使用类结构作为三个数据字段的持有者。然后，您可以覆盖其 ToString() 以按照您想要的方式输出数据。您可以添加一个函数来初始化给定字符串的数据成员（读取一行文本）。

至于 ArrayList （或者最好是`List<YourHolderClass>`），您可以只执行一个简单的 for/foreach 循环并在每个持有者元素上调用 ToString 。一次将结果写入文件一行

希望这将为您指明正确的方向。

# c# - 如何根据条件将元素从一个 LinkedList 移动到另一个 LinkedList

> ID：807933
> 
> 赞同：1
> 
> 时间：2009-04-30T16:47:22.587
> 
> 标签：c#, .net

我有两个 LinkedList，我想将所有符合某些条件的元素从 LinkedListA 移动到 LinkedListB（LinkedListB 开始时不为空）。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T16:59:22.637

如果您要从列表 a 移动到列表 b 的末尾，请尝试以下方法：

```
// .Net 2.0 compatable
private static void moveFromFirstToSecond<T>(Predicate<T> match, LinkedList<T> first, LinkedList<T> second)
{
    LinkedListNode<T> current = first.First;
    while (current != null)
    {
        LinkedListNode<T> next = current.Next;
        if (match(current.Value))
        {
            second.AddLast(current.Value); // second.AddLast(current) also works
            first.Remove(current);
        }
        current = next;
    }
}

// for strings that start with "W"
LinkedList<string> a = ...
LinkedList<string> b = ...
moveFromFirstToSecond(delegate(string toMatch)
    { return toMatch.StartsWith("W"); }, a, b); 
```

或作为扩展方法：

```
// .Net 3.5 or later
public static void MoveMatches<T>(this LinkedList<T> first, Predicate<T> match, LinkedList<T> other)
{
    LinkedListNode<T> current = first.First;
    while (current != null)
    {
        LinkedListNode<T> next = current.Next;
        if (match(current.Value))
        {
            other.AddLast(current.Value); // other.AddLast(current) also works
            first.Remove(current);
        }
        current = next;
    }
}

// for strings that start with "W"
LinkedList<string> a = ...
LinkedList<string> b = ...
a.MoveMatches(x => x.StartsWith("W"), b); 
```

# c++ - C ++中的“new”和“malloc”和“calloc”有什么区别？

> ID：807939
> 
> 赞同：56
> 
> 时间：2009-04-30T16:47:59.060
> 
> 标签：c++, memory-management, malloc, heap-memory

`new`“ ” 和 “ `malloc`” 和 “ ” 和家庭中的其他人有什么区别`calloc`？

（什么时候）我需要“ `new`”以外的东西吗？

其中一个是使用其他实现的吗？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2009-04-30T16:49:37.277

`new`并且`delete`是 C++ 特定的功能。它们在 C 中不存在。`malloc`是老式的 C 做事方式。大多数时候，您不需要在 C++ 中使用它。

*   `malloc`分配未初始化的内存。分配的内存必须用`free`.
*   `calloc`类似`malloc`，但使用常量 (0) 初始化分配的内存。它需要用`free`.
*   `new`通过调用构造函数初始化分配的内存（如果它是一个对象）。分配的内存`new`应该被释放`delete`（这反过来又调用析构函数）。它不需要您手动指定所需的大小并将其转换为适当的类型。因此，它更现代，更不容易出错。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-04-30T16:51:49.050

**`new`/ `delete`+ `new[]`/ `delete[]`:**

*   `new`/`delete`是从堆中分配内存和释放内存的 C++ 方式。
*   `new[]`并且`delete[]`是分配连续内存数组的 C++ 方法。
*   应该使用，因为它比类型更安全`malloc`
*   应该使用，因为它调用构造函数/析构函数
*   不能以某种`realloc`方式使用，但可以使用placement new来重新使用相同的数据缓冲区
*   不能用 分配`new`和释放数据`free`，也不能用`delete[]`

**`malloc`/ `free`+ 家庭：**

*   `malloc`// `free`family是从堆中分配和释放内存的C方式。
*   `calloc`同`malloc`但也初始化内存
*   如果您可能需要重新分配内存，则应使用
*   数据不能`malloc`用 delete 或 delete[] 分配和释放

也可以在这里查看我的[相关答案](https://stackoverflow.com/questions/184537/in-what-cases-do-i-use-malloc-vs-new/184540#184540)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-30T16:51:01.220

*   `new`分配和调用 ctor（未指定顺序）、`delete`dtor 并释放调用 new 分配的内存
*   `malloc`只分配一些内存，并`free`删除分配的内存`malloc`
*   `new`可以使用`malloc`（尽管标准不要求）实现
*   `calloc`与新分配的内存做同样的事情`malloc`并且零初始化

正如其他帖子所指出的那样：`malloc`/`free`是 C++ 的一部分，与 C 兼容。

另见：[Stroustrup：new vs malloc](http://www.research.att.com/%7Ebs/bs_faq2.html#malloc)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-30T16:51:54.010

除了新的，你不需要任何东西。它是 C++ 中 malloc 的完全替代品。

至于区别： malloc 只是分配内存。新分配的内存并调用构造函数。同样 free 只是释放内存。删除释放内存并调用析构函数。

一句警告：不要混淆这两个成语。结果未定义。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-30T16:50:04.170

使用 new 意味着将在新分配的内存上调用构造函数。如果被分配的东西没有构造函数，那么 new 在功能上与 malloc 相同。并且通常应该优先使用它。

new 可能会或可能不会根据 malloc 实现 - C++ 标准不需要任何一种方法。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-30T16:51:30.453

我记得 new 和 malloc 之间的主要区别是您不能使用 realloc 重新分配 new 分配的内存。因此，如果您想增加/减少内存块的大小，则必须分配一个新块并将所有内容复制过来。

Calloc 允许您初始化分配的内存块，而 malloc 不允许。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-30T16:51:40.440

当您**新建**一个对象时，不仅为该对象分配空间，而且还调用该对象的构造函数。但这是 C++ 完成的方式，**malloc**是*C*中分配内存的旧版本方式。**calloc**与**malloc**相同，只是它将内存清除为所有位为零。

# web-services - 网络服务

> ID：807941
> 
> 赞同：1
> 
> 时间：2009-04-30T16:48:33.597
> 
> 标签：web-services

我有 Web 服务，它使用 IIS 中的集成安全性。现在，我想测试我的网络服务。我创建了一个控制台应用程序并添加了 Web 参考。现在，当我尝试使用网络方法时。它显示401错误。我缺少任何身份验证。我想我需要以编程方式传递用户名和密码。谁能指导我正确的方向。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T16:52:47.673

在控制台应用程序中将 Web 服务凭据设置为 System.Net.CredentialCache.DefaultCredentials

```
MyWebService proxy = new MyWebService();
proxy.Credentials = System.Net.CredentialCache.DefaultCredentials; 
```

**编辑**

以编程方式传递凭据：

```
MyWebService proxy = new MyWebService();
proxy.Credentials = new System.Net.NetworkCredential("username", "password", "domainname"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T16:50:16.543

您需要将桌面上的 windows id 添加到 IIS 中允许的用户。

# ruby - 如何在 Ruby 中创建 .p12 文件？

> ID：807943
> 
> 赞同：3
> 
> 时间：2009-04-30T16:48:51.570
> 
> 标签：ruby, encryption, cryptography, openssl

我查看了[Ruby OpenSSL 文档](http://www.ruby-doc.org/stdlib/libdoc/openssl/rdoc/index.html)，但我无法完全弄清楚我需要将哪些部分放在一起以制作 .p12 文件。

还有[这个教程](http://snippets.dzone.com/posts/show/576)，但评论掩盖了对其正确性的矛盾心理。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T19:28:32.557

来自 ossl_pkcs12.c：

```
/*
* call-seq:
*    PKCS12.create(pass, name, key, cert [, ca, [, key_pbe [, cert_pbe [, key_iter [, mac_iter [, keytype]]]]]])
*
* === Parameters
* * +pass+ - string
* * +name+ - A string describing the key.
* * +key+ - Any PKey.
* * +cert+ - A X509::Certificate.
* * * The public_key portion of the certificate must contain a valid public key.
* * * The not_before and not_after fields must be filled in.
* * +ca+ - An optional array of X509::Certificate's.
* * +key_pbe+ - string
* * +cert_pbe+ - string
* * +key_iter+ - integer
* * +mac_iter+ - integer
* * +keytype+ - An integer representing an MSIE specific extension.
*
* Any optional arguments may be supplied as nil to preserve the OpenSSL defaults.
*
* See the OpenSSL documentation for PKCS12_create(). 
```

*/

所以（未经测试并且可能不正确 - 我对 Ruby 不是很熟悉）：

```
p12 = OpenSSL::PKCS12.create("password", "key", pkey, cert)
p12_bytes = p12.to_der 
```

# asp.net - Web 服务 SoapDocumentMethod OneWay 问题

> ID：807950
> 
> 赞同：0
> 
> 时间：2009-04-30T16:49:39.883
> 
> 标签：asp.net, web-services

首先，我会说我不是在编造这个。我在 asmx 文件中实现了一个 web 方法，如下所示：

```
[WebMethod]
[SoapDocumentMethod(OneWay=true)]
public void Method1(INPUT oInput)
{
   // Call SQL stored procedure SP1
   // Call SQL stored procedure SP2
} 
```

使用 SQL Server Profiler，我看到存储的 SP1 被调用，但 SP2 没有。如果我设置 OneWay=false，SP1 和 SP2 都会被调用。

这是奇怪的部分。我离开 OneWay=true 但我`<trace enabled="true">`在 web 配置文件中设置，SP1 和 SP2 都被调用。不完全是！

在将其降至最低限度后，我将尝试发布更多示例代码。同时，有谁知道 ASP.NET 3.5 SP1 中可能导致此问题的错误？

查尔斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T20:01:22.043

我找到了自己的答案。SP1 和 SP2 之间有一些代码可以访问 Context.Current.Request 对象。评论它解决了我的问题。

结论？如果 OneWay=true，Request 对象似乎不可用。奇怪的是，该设置`<trace enabled="true">`使对象可用。

来自[OneWay 属性](http://msdn.microsoft.com/en-us/library/system.web.services.protocols.soapdocumentmethodattribute.oneway.aspx)的文档：

> 无权使用静态 Current 属性访问 HttpContext。要访问 HttpContext，请从 WebService 派生实现 XML Web 服务方法的类并访问 Context 属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T16:56:12.190

根据[这篇文章](http://blog.davebouwman.net/CommentView,guid,54993801-94b2-44c3-b473-a908ec27a28e.aspx)，当 OneWay=true 时，来自 web.config 的模拟上下文会消失。两个 SP 的安全性是否可能略有不同？

# nhibernate - 我可以使用 NHibernate 以 xml 序列化形式存储对象吗？

> ID：807967
> 
> 赞同：3
> 
> 时间：2009-04-30T16:51:37.943
> 
> 标签：nhibernate, serialization

假设我有这样的课程：

```
public class MyClass
{
    public int Id { get; set; }

    public DateTime Date { get; set; }
    public string String1 { get; set; }
    public string String2 { get; set; }
    public string String3 { get; set; }
    public string String4 { get; set; }
} 
```

是否可以让 NHibernate 将其存储在以下模式中？

```
CREATE TABLE [dbo].[MyClass](
    [Id] [int] IDENTITY(1,1) NOT NULL,
    [Xml] [varchar](max) NOT NULL,
) 
```

Id 映射到 Id 的位置，但所有其他字段都被序列化为 XML（或其他）？我不介意这些其他字段是否必须放在像下面这样的子对象上，如果这有帮助的话：

```
public class MyClass
{
    public int Id { get; set; }

    public AllOtherOptions Options { get; set; }
}

public class AllOtherOptions
{
    public DateTime Date { get; set; }
    public string String1 { get; set; }
    public string String2 { get; set; }
    public string String3 { get; set; }
    public string String4 { get; set; }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-01T13:15:40.433

我正在考虑为即将到来的项目做类似的事情。该项目需要收集大量数据，但只需将少数元素存储在关系数据库中。我还没有开始尝试，但这些是我到目前为止的想法。

您可以通过创建实现 IUserType 的类型来映射 XML 数据类型。如果子类 (AllOtherOptions) 是可序列化的，您应该能够将 XML 字段映射为 MyClass 中的私有成员，并根据需要对 AllOtherOptions 进行序列化/反序列化。您可以动态维护 XML 字段（听起来需要做很多工作），也可以创建一个拦截器来完成它。我的想法是 MyClass 将实现一个接口，例如

```
public interface IXmlObjectContainer
{
    void SerializeChildObjects();
    void DeSerializeChildObjects();
} 
```

并且拦截器会根据需要调用这些方法。这是概念验证的想法。我可能会通过公开成对的 xml 字段和可序列化对象来改进它，以从 IXmlObjectContainer 实现者中删除序列化工作。或者可能通过 XML 字段的 get/set 访问器处理序列化。

更多信息：

1.  [在 NHibernate 中使用 XML 字段](https://www.hibernate.org/368.html)
2.  [IUserType 的另一个 XML 实现](http://gist.github.com/47082)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-11-08T11:16:50.923

我有同样的想法将对象保存在 XML 列中。我的想法是其他的。我从链接中获取代码并将其更改为通用 IUserType 实现。因此，任何 [Serializable] 的字段/道具都可以保存在 XML 列中。

```
public class XmlUserType<T> : IUserType where T : class
{
  public new bool Equals(object x, object y)
  {
    return x == y;
  }

  public int GetHashCode(object x)
  {
    return x.GetHashCode();
  }

  public object NullSafeGet(IDataReader rs, string[] names, object owner)
  {
    if (names.Length != 1)
      throw new InvalidOperationException("names array has more than one element. can't handle this!");

    var val = rs[names[0]] as string;

    if (string.IsNullOrWhiteSpace(val) == false)
    {
      return KRD.Common.GenericXmlSerialization.Deserialize<T>(val);
    }

    return null;
  }

  public void NullSafeSet(IDbCommand cmd, object value, int index)
  {
    var parameter = (DbParameter)cmd.Parameters[index];
    T toSave = value as T;

    if (toSave != null)
    {
      parameter.Value = KRD.Common.GenericXmlSerialization.Serialize(toSave);
    }
    else
    {
      parameter.Value = DBNull.Value;
    }
  }

  public object DeepCopy(object value)
  {
    T toCopy = value as T;

    if (toCopy == null)
      return null;

    string serialized = KRD.Common.GenericXmlSerialization.Serialize(toCopy);

    return KRD.Common.GenericXmlSerialization.Deserialize<T>(serialized);
  }

  public object Replace(object original, object target, object owner)
  {
    throw new NotImplementedException();
  }

  public object Assemble(object cached, object owner)
  {
    var str = cached as string;
    if (string.IsNullOrWhiteSpace(str) == false)
    {
      return null;
    }

    return KRD.Common.GenericXmlSerialization.Deserialize<T>(str);
  }

  public object Disassemble(object value)
  {
    var toCache = value as T;

    if (toCache != null)
    {
      return KRD.Common.GenericXmlSerialization.Serialize(toCache);
    }

    return null;
  }

  public SqlType[] SqlTypes
  {
    get
    {
      return new SqlType[] { new SqlXmlType() };
    }
  }

  public Type ReturnedType
  {
    get { return typeof(XmlDocument); }
  }

  public bool IsMutable
  {
    get { return true; }
  }
}

public class SqlXmlType : SqlType
{
  public SqlXmlType()
    : base(DbType.Xml)
  {
  }
} 
```

FluentNHibernate 的用法：

```
 public class MainObject
  {
    public int Id { get; set; }

    public ObjectAsXml Data { get; set; }
  }

  public class ObjectAsXml
  {
    public string Name { get; set; }

    public int Date { get; set; }

    public ObjectAsXml OtherObject { get; set; }
  }

  private class MainObjectMap : ClassMap<MainObject>
  {
    public MainObjectMap()
    {
      Id(id => id.Id);
      Map(m => m.Data).CustomType<XmlUserType<ObjectAsXml>>().Nullable();
    }
  } 
```

也许它会帮助某人。

# c++ - 在记住路径的同时进行高效的霍夫曼树搜索

> ID：807979
> 
> 赞同：2
> 
> 时间：2009-04-30T16:53:38.173
> 
> 标签：c++, performance, huffman-code

[作为与我关于存储霍夫曼树的有效方法的](https://stackoverflow.com/questions/759707/efficient-way-of-storing-huffman-tree)问题相关的后续问题，我想知道搜索二叉树（基于霍夫曼编码输出）和存储到特定节点的路径的最快和最有效的方法是什么.

这是我目前拥有的：

*   将根节点加入队列
*   当队列不为空时，将项目从队列中弹出
    *   检查它是否是我们正在寻找的
        *   是的：跟随一个头指针回到根节点，而在每个节点上我们访问检查它是左还是右并记下它。
        *   跳出搜索
    *   将左右节点入队

由于这是一棵霍夫曼树，我正在寻找的所有条目都将存在。以上是广度优先搜索，这被认为是霍夫曼树的最佳选择，因为源中的项目更频繁地在树中较高以获得更好的压缩，但是我无法找到跟踪的好方法我们如何使用我放在节点中的头指针不回溯就到达特定节点。

在这种情况下，我还以相反的顺序获取所有右/左路径，例如，如果我们从头到根，我们发现从根开始是右、左、左，我们得到左， 左右。或二进制的 001 ，当我正在寻找的是以有效的方式获得 100 时。

还建议将从根到节点的路径存储为节点内的单独值，但是如果我们有一个大于我们为此目的创建的变量可以容纳的位数的树，那么这将崩溃，并且在那点存储数据也会占用大量内存。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T16:56:55.823

创建一个值 -> 位串的字典，这将为您提供最快的查找。

如果这些值的大小是已知的，那么您可能只需要一个位字符串数组并通过它们的索引来查找这些值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-03T22:53:28.527

If you're decoding Huffman-encoded data one bit at a time, your performance will be poor. As much as you'd like to avoid using lookup tables, that's the only way to go if you care about performance. The way Huffman codes are created, they are left-to-right unique and lend themselves perfectly to a fast table lookup.

# c# - 在 C# 中线程化未知数量的线程

> ID：807984
> 
> 赞同：0
> 
> 时间：2009-04-30T16:55:42.537
> 
> 标签：c#, asp.net, multithreading

我目前正在编写一个站点地图生成器，它可以抓取一个站点的 url 并构建一个 xml 站点地图。由于大部分等待都花在对 uri 的请求上，因此我正在使用线程，特别是在 ThreadPool 对象中构建。

为了让主线程等待未知数量的线程完成，我实现了以下设置。我觉得这不是一个好的解决方案，任何线程专家都可以告诉我这个解决方案存在的任何问题，或者提出更好的实现方法吗？

EventWaitHandle 设置为 EventResetMode.ManualReset

这是线程方法

```
protected void CrawlUri(object o)
    {

        try
        {
            Interlocked.Increment(ref _threadCount);
            Uri uri = (Uri)o;

            foreach (Match match in _regex.Matches(GetWebResponse(uri)))
            {
                Uri newUri = new Uri(uri, match.Value);

                if (!_uriCollection.Contains(newUri))
                {
                    _uriCollection.Add(newUri);
                    ThreadPool.QueueUserWorkItem(_waitCallback, newUri);
                }
            }
        }
        catch
        {
            // Handle exceptions
        }
        finally
        {
            Interlocked.Decrement(ref _threadCount);
        }

        // If there are no more threads running then signal the waithandle
        if (_threadCount == 0)
            _eventWaitHandle.Set();
    } 
```

这是主线程方法

```
// Request first page (based on  host)
Uri root = new Uri(context.Request.Url.GetLeftPart(UriPartial.Authority));

// Begin threaded crawling of the Uri
ThreadPool.QueueUserWorkItem(_waitCallback, root);
Thread.Sleep(5000); // TEMP SOLUTION: Sleep for 5 seconds
_eventWaitHandle.WaitOne();

 // Server the Xml Sitemap
 context.Response.ContentType = "text/xml";
 context.Response.Write(GetXml().OuterXml); 
```

任何想法都非常感谢:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-30T19:53:06.523

好吧，首先您可以创建一个未设置的 ManualResetEvent，这样您就不必在等待它之前睡觉。其次，您需要围绕 Uri 集合进行线程同步。您可能会遇到一个竞争条件，其中一个两个线程通过“此 Uri 尚不存在”检查并且它们添加重复项。另一个竞争条件是两个线程可以通过`if (_threadCount == 0)`检查并且它们都可以设置事件。

最后，您可以通过使用异步 BeginGetRequest 使整个事情变得更加高效。您的解决方案现在保留一个线程来等待每个请求。如果您使用异步方法和回调，您的程序将使用更少的内存（每个线程 1MB），并且几乎不需要进行线程的上下文切换。

这是一个应该说明我在说什么的例子。出于好奇，我确实对其进行了测试（有深度限制）并且它确实有效。

```
public class CrawlUriTool
{
    private Regex regex;
    private int pendingRequests;
    private List<Uri> uriCollection;
    private object uriCollectionSync = new object();
    private ManualResetEvent crawlCompletedEvent;

    public List<Uri> CrawlUri(Uri uri)
    {
        this.pendingRequests = 0;
        this.uriCollection = new List<Uri>();
        this.crawlCompletedEvent = new ManualResetEvent(false);
        this.StartUriCrawl(uri);
        this.crawlCompletedEvent.WaitOne();

        return this.uriCollection;
    }

    private void StartUriCrawl(Uri uri)
    {
        Interlocked.Increment(ref this.pendingRequests);

        HttpWebRequest request = (HttpWebRequest)WebRequest.Create(uri);

        request.BeginGetResponse(this.UriCrawlCallback, request);
    }

    private void UriCrawlCallback(IAsyncResult asyncResult)
    {
        HttpWebRequest request = asyncResult.AsyncState as HttpWebRequest;

        try
        {
            HttpWebResponse response = (HttpWebResponse)request.EndGetResponse(asyncResult);

            string responseText = this.GetTextFromResponse(response); // not included

            foreach (Match match in this.regex.Matches(responseText))
            {
                Uri newUri = new Uri(response.ResponseUri, match.Value);

                lock (this.uriCollectionSync)
                {
                    if (!this.uriCollection.Contains(newUri))
                    {
                        this.uriCollection.Add(newUri);
                        this.StartUriCrawl(newUri);
                    }
                }
            }
        }
        catch (WebException exception)
        {
            // handle exception
        }
        finally
        {
            if (Interlocked.Decrement(ref this.pendingRequests) == 0)
            {
                this.crawlCompletedEvent.Set();
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T17:08:32.317

在执行这种逻辑时，我通常会尝试创建一个对象来表示每个异步任务及其运行所需的数据。我通常会将此对象添加到要完成的任务集合中。线程池安排这些任务，当任务完成时，我会让对象本身从“待完成”集合中删除，可能会在集合本身上发出信号。

因此，当“待完成”集合为空时，您就完成了；每个完成的任务都可能唤醒主线程一次。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-01T01:59:45.020

[您可以查看Task Parallel Library](http://msdn.microsoft.com/en-us/concurrency/default.aspx)的 CTP，这对您来说应该更简单。您正在做的事情可以分为“任务”、块或工作单元，如果您提供任务，TPL 可以为您并行化。它在内部也使用线程池，但它更易于使用，并且提供了许多选项，例如等待所有任务完成。查看[此](http://channel9.msdn.com/pdc2008/TL26/)Channel9 视频，其中解释了可能性，并展示了并行递归遍历树的演示，这似乎非常适用于您的问题。

However, it's still a preview and won't be released until .NET 4.0, so it comes with no warranties and you'll have to manually include the supplied System.Threading.dll (found in the install folder) into your project and I don't know if that's an option to you.

# c# - 为什么不能克隆 IEnumerator？

> ID：807991
> 
> 赞同：10
> 
> 时间：2009-04-30T16:58:03.903
> 
> 标签：c#, .net, ienumerable

在用 C# 实现一个基本的 Scheme 解释器时，令我惊恐的是，我发现了以下问题：

IEnumerator 没有克隆方法！（或者更准确地说，IEnumerable 无法为我提供“可克隆”枚举器）。

我想要什么：

```
interface IEnumerator<T>
{
    bool MoveNext();
    T Current { get; }
    void Reset();
    // NEW!
    IEnumerator<T> Clone();
} 
```

我无法想出一个 IEnumerable 的实现，它无法提供一个有效的可克隆 IEnumerator（向量、链表等），所有这些都能够提供一个简单的 IEnumerator 的 Clone() 实现，如上所述......它会无论如何都比提供 Reset() 方法更容易！）。

没有 Clone 方法意味着枚举序列的任何功能/递归习惯用法都不起作用。

这也意味着我不能“无缝”使 IEnumerable 的行为像 Lisp“列表”（您使用 car/cdr 递归枚举）。即“（cdr *some IEnumerable*）”的唯一实现将非常低效。

**任何人都可以提出一个现实、有用的 IEnumerable 对象示例，该对象无法提供有效的“Clone()”方法吗？“产量”结构是否存在问题？**

任何人都可以提出解决方法吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-30T17:28:06.280

逻辑无懈可击！`IEnumerable`不支持`Clone`，你需要`Clone`，所以你不应该使用`IEnumerable`.

或者更准确地说，您不应该将它用作在 Scheme 解释器上工作的基本基础。为什么不创建一个简单的不可变链表呢？

```
public class Link<TValue>
{
    private readonly TValue value;
    private readonly Link<TValue> next;

    public Link(TValue value, Link<TValue> next)
    {
        this.value = value;
        this.next = next;
    } 

    public TValue Value 
    { 
        get { return value; }
    }

    public Link<TValue> Next 
    {
        get { return next; }
    }

    public IEnumerable<TValue> ToEnumerable()
    {
        for (Link<TValue> v = this; v != null; v = v.next)
            yield return v.value;
    }
} 
```

请注意，该`ToEnumerable`方法可让您以标准 C# 方式方便地使用。

要回答您的问题：

> 任何人都可以提出一个现实、有用的 IEnumerable 对象示例，该对象无法提供有效的“Clone()”方法吗？“产量”结构是否存在问题？

IEnumerable 可以在世界任何地方获取其数据。这是一个从控制台读取行的示例：

```
IEnumerable<string> GetConsoleLines()
{
    for (; ;)
        yield return Console.ReadLine();
} 
```

这样做有两个问题：首先，`Clone`函数编写起来不是特别简单（而且`Reset`毫无意义）。其次，序列是无限的——这是完全可以允许的。序列是惰性的。

另一个例子：

```
IEnumerable<int> GetIntegers()
{
    for (int n = 0; ; n++)
        yield return n;
} 
```

对于这两个示例，您接受的“解决方法”不会有太大用处，因为它只会耗尽可用内存或永远挂断。但这些都是完全有效的序列示例。

要理解 C# 和 F# 序列，您需要查看 Haskell 中的列表，而不是 Scheme 中的列表。

如果您认为无限的东西是红鲱鱼，那么从套接字读取字节怎么样：

```
IEnumerable<byte> GetSocketBytes(Socket s)
{
    byte[] buffer = new bytes[100];
    for (;;)
    {
        int r = s.Receive(buffer);
        if (r == 0)
            yield break;

        for (int n = 0; n < r; n++)
            yield return buffer[n];       
    }
} 
```

如果有一些字节被发送到套接字，这将不是一个无限的序列。然而，为此编写克隆将非常困难。编译器将如何生成 IEnumerable 实现来自动执行它？

一旦创建了克隆，两个实例现在都必须从它们共享的缓冲区系统中工作。这是可能的，但实际上它不是必需的——这不是这些序列的设计使用方式。您将它们纯粹“功能性地”对待，就像值一样，递归地对它们应用过滤器，而不是“强制性地”记住序列中的位置。它比低级`car`/`cdr`操作要干净一些。

**进一步的问题：**

> 我想知道，我需要的最低级别的“原语”是什么，这样我可能想在我的 Scheme 解释器中对 IEnumerable 做的任何事情都可以在 scheme 中实现，而不是作为内置实现。

我认为简短的答案是查看[Abelson 和 Sussman](http://mitpress.mit.edu/sicp/full-text/book/book.html)，尤其[是有关流的部分](http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-24.html#%_sec_3.5)。`IEnumerable`是一个流，而不是一个列表。它们描述了您如何需要特殊版本的地图、过滤器、累积等来使用它们。他们还在 4.2 节中提出了统一列表和流的想法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-30T17:03:00.427

作为一种解决方法，您可以轻松地为进行克隆的 IEnumerator 创建一个扩展方法。只需从枚举器创建一个列表，并将元素用作成员。

但是，您将失去枚举器的流式传输功能 - 因为您是新的“克隆”，所以会导致第一个枚举器完全评估。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-11T11:13:46.090

如果您可以让原始枚举数离开，即。不再使用它，您可以实现一个“克隆”函数，该函数采用原始枚举器，并将其用作一个或多个枚举器的源。

换句话说，你可以构建这样的东西：

```
IEnumerable<String> original = GetOriginalEnumerable();
IEnumerator<String>[] newOnes = original.GetEnumerator().AlmostClone(2);
                                                         ^- extension method
                                                         produce 2
                                                         new enumerators 
```

这些可以在内部共享原始枚举器和一个链表，以跟踪枚举值。

这将允许：

*   无限序列，只要两个枚举器都向前推进（链表将被编写为一旦两个枚举器都通过了特定点，就可以对它们进行 GC）
*   惰性枚举，两个枚举器中的第一个需要一个尚未从原始枚举器中检索到的值，它将获取它并将其存储到链表中，然后再产生它

这里的问题当然是，如果其中一个枚举器远远领先于另一个枚举器，它仍然需要大量内存。

这是源代码。如果您使用 Subversion，您可以下载带有类库的 Visual Studio 2008 解决方案文件，其中包含以下代码，以及单独的单元测试项目。

存储库： http://vkarlsen.serveftp.com:81/svnStackOverflow/ [SO847655](http://vkarlsen.serveftp.com:81/svn/StackOverflow/SO847655)
用户名和密码都是“guest”，不带引号。

请注意，此代码根本不是线程安全的。

```
public static class EnumeratorExtensions
{
    /// <summary>
    /// "Clones" the specified <see cref="IEnumerator{T}"/> by wrapping it inside N new
    /// <see cref="IEnumerator{T}"/> instances, each can be advanced separately.
    /// See remarks for more information.
    /// </summary>
    /// <typeparam name="T">
    /// The type of elements the <paramref name="enumerator"/> produces.
    /// </typeparam>
    /// <param name="enumerator">
    /// The <see cref="IEnumerator{T}"/> to "clone".
    /// </param>
    /// <param name="clones">
    /// The number of "clones" to produce.
    /// </param>
    /// <returns>
    /// An array of "cloned" <see cref="IEnumerator[T}"/> instances.
    /// </returns>
    /// <remarks>
    /// <para>The cloning process works by producing N new <see cref="IEnumerator{T}"/> instances.</para>
    /// <para>Each <see cref="IEnumerator{T}"/> instance can be advanced separately, over the same
    /// items.</para>
    /// <para>The original <paramref name="enumerator"/> will be lazily evaluated on demand.</para>
    /// <para>If one enumerator advances far beyond the others, the items it has produced will be kept
    /// in memory until all cloned enumerators advanced past them, or they are disposed of.</para>
    /// </remarks>
    /// <exception cref="ArgumentNullException">
    /// <para><paramref name="enumerator"/> is <c>null</c>.</para>
    /// </exception>
    /// <exception cref="ArgumentOutOfRangeException">
    /// <para><paramref name="clones"/> is less than 2.</para>
    /// </exception>
    public static IEnumerator<T>[] Clone<T>(this IEnumerator<T> enumerator, Int32 clones)
    {
        #region Parameter Validation

        if (Object.ReferenceEquals(null, enumerator))
            throw new ArgumentNullException("enumerator");
        if (clones < 2)
            throw new ArgumentOutOfRangeException("clones");

        #endregion

        ClonedEnumerator<T>.EnumeratorWrapper wrapper = new ClonedEnumerator<T>.EnumeratorWrapper
        {
            Enumerator = enumerator,
            Clones = clones
        };
        ClonedEnumerator<T>.Node node = new ClonedEnumerator<T>.Node
        {
            Value = enumerator.Current,
            Next = null
        };

        IEnumerator<T>[] result = new IEnumerator<T>[clones];
        for (Int32 index = 0; index < clones; index++)
            result[index] = new ClonedEnumerator<T>(wrapper, node);
        return result;
    }
}

internal class ClonedEnumerator<T> : IEnumerator<T>, IDisposable
{
    public class EnumeratorWrapper
    {
        public Int32 Clones { get; set; }
        public IEnumerator<T> Enumerator { get; set; }
    }

    public class Node
    {
        public T Value { get; set; }
        public Node Next { get; set; }
    }

    private Node _Node;
    private EnumeratorWrapper _Enumerator;

    public ClonedEnumerator(EnumeratorWrapper enumerator, Node firstNode)
    {
        _Enumerator = enumerator;
        _Node = firstNode;
    }

    public void Dispose()
    {
        _Enumerator.Clones--;
        if (_Enumerator.Clones == 0)
        {
            _Enumerator.Enumerator.Dispose();
            _Enumerator.Enumerator = null;
        }
    }

    public T Current
    {
        get
        {
            return _Node.Value;
        }
    }

    Object System.Collections.IEnumerator.Current
    {
        get
        {
            return Current;
        }
    }

    public Boolean MoveNext()
    {
        if (_Node.Next != null)
        {
            _Node = _Node.Next;
            return true;
        }

        if (_Enumerator.Enumerator.MoveNext())
        {
            _Node.Next = new Node
            {
                Value = _Enumerator.Enumerator.Current,
                Next = null
            };
            _Node = _Node.Next;
            return true;
        }

        return false;
    }

    public void Reset()
    {
        throw new NotImplementedException();
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-23T01:51:02.660

这使用反射来创建一个新实例，然后在新实例上设置值。我还发现 C# in Depth 的这一章非常有用。 [迭代器块实现细节：自动生成的状态机](http://csharpindepth.com/Articles/Chapter6/IteratorBlockImplementation.aspx)

```
static void Main()
{
    var counter = new CountingClass();
    var firstIterator = counter.CountingEnumerator();
    Console.WriteLine("First list");
    firstIterator.MoveNext();
    Console.WriteLine(firstIterator.Current);

    Console.WriteLine("First list cloned");
    var secondIterator = EnumeratorCloner.Clone(firstIterator);

    Console.WriteLine("Second list");
    secondIterator.MoveNext();
    Console.WriteLine(secondIterator.Current);
    secondIterator.MoveNext();
    Console.WriteLine(secondIterator.Current);
    secondIterator.MoveNext();
    Console.WriteLine(secondIterator.Current);

    Console.WriteLine("First list");
    firstIterator.MoveNext();
    Console.WriteLine(firstIterator.Current);
    firstIterator.MoveNext();
    Console.WriteLine(firstIterator.Current);
}

public class CountingClass
{
    public IEnumerator<int> CountingEnumerator()
    {
        int i = 1;
        while (true)
        {
            yield return i;
            i++;
        }
    }
}

public static class EnumeratorCloner
{
    public static T Clone<T>(T source) where T : class, IEnumerator
    {
        var sourceType = source.GetType().UnderlyingSystemType;
        var sourceTypeConstructor = sourceType.GetConstructor(new Type[] { typeof(Int32) });
        var newInstance = sourceTypeConstructor.Invoke(new object[] { -2 }) as T;

        var nonPublicFields = source.GetType().GetFields(BindingFlags.NonPublic | BindingFlags.Instance);
        var publicFields = source.GetType().GetFields(BindingFlags.Public | BindingFlags.Instance);
        foreach (var field in nonPublicFields)
        {
            var value = field.GetValue(source);
            field.SetValue(newInstance, value);
        }
        foreach (var field in publicFields)
        {
            var value = field.GetValue(source);
            field.SetValue(newInstance, value);
        }
        return newInstance;
    }
} 
```

此答案也用于以下问题[是否可以克隆 IEnumerable 实例，保存迭代状态的副本？](https://stackoverflow.com/questions/1912498/is-it-possible-to-clone-an-ienumerablet-instance-saving-a-copy-of-the-iteratio/2283801#2283801)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-04-13T23:19:09.450

“可克隆”枚举器的目的主要是为了能够保存迭代位置并能够稍后返回。这意味着，迭代容器必须提供更丰富的接口，而不仅仅是`IEnumerable`. 它实际上是介于`IEnumerable`和之间的东西`IList`。与`IList`您一起工作可以只使用整数索引作为枚举器，或者创建一个简单的不可变包装类，保存对列表和当前位置的引用。

如果您的容器不支持随机访问并且只能向前迭代（如单向链表），它必须至少提供获取下一个元素的能力，具有对前一个元素或您的某些“迭代状态”的引用可以保存在您的迭代器中。因此，界面可能如下所示：

```
interface IIterable<T>
{
    IIterator<T> GetIterator(); // returns an iterator positioned at start
    IIterator<T> GetNext(IIterator<T> prev); // returns an iterator positioned at the next element from the given one
}

interface IIterator<T>
{
    T Current { get; }
    IEnumerable<T> AllRest { get; }
} 
```

请注意，迭代器是**不可变**的，它不能“向前移动”，我们只能要求我们的可迭代容器给我们一个指向下一个位置的新迭代器。这样做的好处是您可以将迭代器存储在您需要的任何地方，例如拥有一堆迭代器并在需要时返回到先前保存的位置。您可以通过分配给变量来保存当前位置以供以后使用，就像使用整数索引一样。

`AllRest`如果您需要使用标准语言迭代功能（如`foraech`或 LinQ ）从给定位置迭代到容器末尾，该属性会很有用。它不会改变迭代器的位置（记住，我们的迭代器是不可变的）。执行可以反复`GetNext`和`yleid return`。

该`GetNext`方法实际上可以是迭代器本身的一部分，如下所示：

```
interface IIterable<T>
{
    IIterator<T> GetIterator(); // returns an iterator positioned at start
}

interface IIterator<T>
{
    T Current { get; }
    IIterator<T> GetNext { get; } // returns an iterator positioned at the next element from the given one
    IEnumerable<T> AllRest { get; }
} 
```

这几乎是一样的。确定下一个状态的逻辑只是从容器实现转移到迭代器实现。请注意，迭代器仍然是**不可变**的。你不能“向前移动”，你只能得到另一个，指向下一个元素。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-30T17:08:37.870

为什么不将此作为扩展方法：

```
public static IEnumerator<T> Clone(this IEnumerator<T> original)
{
    foreach(var v in original)
        yield return v;
} 
```

这基本上会创建并返回一个新的枚举器，而无需完全评估原始枚举器。

编辑：是的，我看错了。Paul 是正确的，这仅适用于 IEnumerable。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-30T22:20:59.337

这可能会有所帮助。它需要一些代码来调用 IEnumerator 上的 Dispose()：

```
class Program
{
    static void Main(string[] args)
    {
        //var list = MyClass.DequeueAll().ToList();
        //var list2 = MyClass.DequeueAll().ToList();

        var clonable = MyClass.DequeueAll().ToClonable();

        var list = clonable.Clone().ToList();
        var list2 = clonable.Clone()ToList();
        var list3 = clonable.Clone()ToList();
    }
}

class MyClass
{
    static Queue<string> list = new Queue<string>();

    static MyClass()
    {
        list.Enqueue("one");
        list.Enqueue("two");
        list.Enqueue("three");
        list.Enqueue("four");
        list.Enqueue("five");
    }

    public static IEnumerable<string> DequeueAll()
    {
        while (list.Count > 0)
            yield return list.Dequeue();
    }
}

static class Extensions
{
    public static IClonableEnumerable<T> ToClonable<T>(this IEnumerable<T> e)
    {
        return new ClonableEnumerable<T>(e);
    }
}

class ClonableEnumerable<T> : IClonableEnumerable<T>
{
    List<T> items = new List<T>();
    IEnumerator<T> underlying;

    public ClonableEnumerable(IEnumerable<T> underlying)
    {
        this.underlying = underlying.GetEnumerator();
    }

    public IEnumerator<T> GetEnumerator()
    {
        return new ClonableEnumerator<T>(this);
    }

    IEnumerator IEnumerable.GetEnumerator()
    {
        return this.GetEnumerator();
    }

    private object GetPosition(int position)
    {
        if (HasPosition(position))
            return items[position];

        throw new IndexOutOfRangeException();
    }

    private bool HasPosition(int position)
    {
        lock (this)
        {
            while (items.Count <= position)
            {
                if (underlying.MoveNext())
                {
                    items.Add(underlying.Current);
                }
                else
                {
                    return false;
                }
            }
        }

        return true;
    }

    public IClonableEnumerable<T> Clone()
    {
        return this;
    }

    class ClonableEnumerator<T> : IEnumerator<T>
    {
        ClonableEnumerable<T> enumerable;
        int position = -1;

        public ClonableEnumerator(ClonableEnumerable<T> enumerable)
        {
            this.enumerable = enumerable;
        }

        public T Current
        {
            get
            {
                if (position < 0)
                    throw new Exception();
                return (T)enumerable.GetPosition(position);
            }
        }

        public void Dispose()
        {
        }

        object IEnumerator.Current
        {
            get { return this.Current; }
        }

        public bool MoveNext()
        {
            if(enumerable.HasPosition(position + 1))
            {
                position++;
                return true;
            }
            return false;
        }

        public void Reset()
        {
            position = -1;
        }
    }

}

interface IClonableEnumerable<T> : IEnumerable<T>
{
    IClonableEnumerable<T> Clone();
} 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-04-30T17:27:15.750

已经有一种方法可以创建一个新的枚举器——与创建第一个枚举器的方式相同：IEnumerable.GetEnumerator。我不确定为什么你需要另一种机制来做同样的事情。

本着[DRY 原则](http://en.wikipedia.org/wiki/Don%27t_repeat_yourself "不要重复自己")的精神，我很好奇为什么您希望在您的可枚举类和您的枚举类中复制创建新 IEnumerator 实例的责任。您将强制枚举器保持超出所需的额外状态。

例如，想象一个链表的枚举器。对于 IEnumerable 的基本实现，该类只需要保留对当前节点的引用。但是为了支持你的克隆，它还需要保留对列表头部的引用——否则它对*没有用处。当您可以直接转到源（IEnumerable）并获取另一个枚举器时，为什么要将那个额外的状态添加到枚举器？

为什么要将需要测试的代码路径数量增加一倍？每次你用一种新的方法来制造一个物体，你都在增加复杂性。

`*`如果您实现了重置，您还需要头指针，但[根据文档](http://msdn.microsoft.com/en-us/library/system.collections.ienumerator.reset.aspx)，重置仅用于 COM 互操作，您可以随意抛出 NotSupportedException。

# oop - 聚合对象

> ID：807993
> 
> 赞同：1
> 
> 时间：2009-04-30T16:58:50.967
> 
> 标签：oop, object, aggregation

如果你有一个 A 类是 B 类和 C 类的集合，那么它对 A 更好吗？

*   存储 B 和 C 的 ID
*   为 B 和 C 加载和存储整个对象（编辑，通过引用对象 B/C 存储，即实例化对象 B 和 C，而不是为 B 和 C 存储 id。
*   存储 ID 并提供提取方法 B 和 C 的方法

我假设这取决于性能要求和其他要求，但我只是在寻找任何一般指导方针或想法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-30T17:27:13.537

在内存中运行的典型程序中，对象几乎总是通过引用作为指针存储，因此您正在存储 B 和 C 的 ID，只是您不自己处理细节，语言对您隐藏它们。

加载和存储“整个对象”是一个有问题的概念。我知道您正在尝试独立于语言，但真正帮助我“获得”面向对象的第一件事是几乎每个对象都应该有自己的生命周期。

如果您有“包含”对象 B 的对象 A，并且您将对对象 B 的引用传递给对象 C，那么对象 A 必须知道有关对象 C 的一些信息，这完全不行。释放对象 B 的生命周期，使对象 A 对对象 C 一无所知，这是使 OO 工作的核心概念之一。

因此，如果这就是您存储整个对象的意思，那么不要 - 永远不要这样做。

数据库和其他存储也是如此。即使一个对象负责销毁另一个对象，它也应该很少包含其他对象的数据。

而且（尽管我认为您的意思是说“拉对象 B 和 C”，而不是“方法”），能够从另一个对象传递一个对象的概念也非常有用，并且通常没有任何问题需要注意：

请记住，对象无法控制自身外部发生的事情。它可以被传递，以半随机顺序调用方法等。因此，尽可能保证对象的安全是有帮助的。如果某些东西以错误的顺序被调用，或者传入了一个无效的变量，或者您发现以某种方式进入了无效状态，则提前失败并大声失败，以便出错的程序员调用它。

您还希望尽可能难以进入非法状态 - 这意味着保持您的对象小而简单，尽可能使变量成为最终变量，并尽量不要有太多参数调用顺序很重要的地方。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-30T17:15:48.417

我倾向于加载和存储整个对象（及其子对象）作为我的默认方法。

有时这会导致加载时间长、内存占用量大或两者兼而有之。然后，您需要确定是否所有加载的对象都被实际使用，或者是否创建了许多对象并且从未访问过。

如果使用了所有对象，则需要一种更具创造性的方法来加载子集、处理它们、处置它们，然后加载下一个子集以将所有内容放入内存中 - 或者只是购买更多内存并使其可用于您的应用程序。

如果许多对象没有使用，最好的方法是在需要时延迟加载子对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T17:05:09.643

这取决于情况。如果对象保留在内存中，那么让 A 包含 B 和 C 会更 OO（也更容易）。我发现如果需要持久化对象，那么 A 存储 ID 会更容易和更有效B 和 C。（这样，如果您需要直接在 A 中而不是 B 和 C 中的数据，则不必将 B 和 C 从数据库、文件等中拉出）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-30T17:07:29.607

这取决于，

如果 B 和 C 很重且加载和构建成本很高，则可能值得推迟加载它们，直到您确定需要它们（延迟初始化）。

如果它们简单且轻量级，也许您只想在任何时候构建它们，您就会得到 Id。

# c# - 如何创建一个 C# 应用程序来决定自己是显示为控制台还是窗口应用程序？

> ID：807998
> 
> 赞同：48
> 
> 时间：2009-04-30T17:00:02.853
> 
> 标签：c#, .net, wpf, winforms

有没有办法启动具有以下功能的 C# 应用程序？

1.  它通过命令行参数确定它是窗口应用程序还是控制台应用程序
2.  它在被要求窗口化时不显示控制台，并且在从控制台运行时不显示 GUI 窗口。

例如，

```
我的应用程序.exe /帮助
```

会在您使用的控制台上输出到标准输出，但是

```
我的应用程序
```

它本身会启动我的 Winforms 或 WPF 用户界面。

到目前为止，我所知道的最好的答案涉及拥有两个单独的 exe 并使用 IPC，但这感觉真的很糟糕。

为了获得上面示例中描述的行为，我有哪些选择和权衡？我也对特定于 Winform 或特定于 WPF 的想法持开放态度。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-04-30T17:10:47.053

使应用程序成为常规的 Windows 应用程序，并在需要时动态创建控制台。

[此链接](http://social.msdn.microsoft.com/Forums/en-US/Vsexpressvb/thread/875952fc-cd2c-4e74-9cf2-d38910bde613)上的更多详细信息（下面的代码）

```
using System;
using System.Windows.Forms;

namespace WindowsApplication1 {
  static class Program {
    [STAThread]
    static void Main(string[] args) {
      if (args.Length > 0) {
        // Command line given, display console
        if ( !AttachConsole(-1) ) { // Attach to an parent process console
           AllocConsole(); // Alloc a new console
        }

        ConsoleMain(args);
      }
      else {
        Application.EnableVisualStyles();
        Application.SetCompatibleTextRenderingDefault(false);
        Application.Run(new Form1());
      }
    }
    private static void ConsoleMain(string[] args) {
      Console.WriteLine("Command line = {0}", Environment.CommandLine);
      for (int ix = 0; ix < args.Length; ++ix)
        Console.WriteLine("Argument{0} = {1}", ix + 1, args[ix]);
      Console.ReadLine();
    }

    [System.Runtime.InteropServices.DllImport("kernel32.dll")]
    private static extern bool AllocConsole();

    [System.Runtime.InteropServices.DllImport("kernel32.dll")]
    private static extern bool AttachConsole(int pid);

  }
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2012-09-14T08:11:10.380

我基本上按照 Eric 的回答中描述的方式进行操作，另外我使用 FreeConsole 分离控制台并使用 SendKeys 命令来获取命令提示符。

```
 [DllImport("kernel32.dll")]
    private static extern bool AllocConsole();

    [DllImport("kernel32.dll")]
    private static extern bool AttachConsole(int pid);

    [DllImport("kernel32.dll", SetLastError = true)]
    private static extern bool FreeConsole();

    [STAThread]
    static void Main(string[] args)
    {
        if (args.Length > 0 && (args[0].Equals("/?") || args[0].Equals("/help", StringComparison.OrdinalIgnoreCase)))
        {
            // get console output
            if (!AttachConsole(-1))
                AllocConsole();

            ShowHelp(); // show help output with Console.WriteLine
            FreeConsole(); // detach console

            // get command prompt back
            System.Windows.Forms.SendKeys.SendWait("{ENTER}"); 

            return;
        }

        // normal winforms code
        Application.EnableVisualStyles();
        Application.SetCompatibleTextRenderingDefault(false);
        Application.Run(new MainForm());

    } 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-30T17:03:35.997

编写两个应用程序（一个控制台，一个窗口），然后编写另一个较小的应用程序，根据给定的参数打开其他应用程序之一（然后可能会自行关闭，因为不再需要它）？

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-30T17:19:25.847

我通过创建两个单独的应用程序来做到这一点。

使用以下名称创建 WPF 应用程序：`MyApp.exe`. 并使用以下名称创建控制台应用程序：`MyApp.com`. 当您像这样在命令行中键入您的应用程序名称时，`MyApp`或者`MyApp /help`（不带`.exe`扩展名）带有扩展名的控制台应用程序`.com`将优先。您可以让您的控制台应用程序`MyApp.exe`根据参数调用。

这正是 devenv 的行为方式。`devenv`在命令行键入将启动 Visual Studio 的 IDE。如果您传递类似的参数`/build`，它将保留在命令行中。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-30T17:05:35.943

注意：我没有测试过这个，但我相信它会工作......

你可以这样做：

使您的应用程序成为 Windows 窗体应用程序。如果您收到控制台请求，请不要显示您的主表单。相反，使用平台调用调用 Windows API 中的[控制台函数](http://msdn.microsoft.com/en-us/library/ms682073(VS.85).aspx)并动态分配控制台。

（或者，使用 API 在控制台应用程序中隐藏控制台，但您可能会看到在这种情况下创建的控制台“闪烁”...）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-30T17:09:01.130

据我所知，exe 中有一个标志，告诉它是作为控制台还是窗口应用程序运行。您可以使用 Visual Studio 附带的工具轻弹标志，但不能在运行时执行此操作。

如果 exe 被编译为控制台，那么如果它不是从一个控制台启动，它将始终打开一个新控制台。如果 exe 是应用程序，则它无法输出到控制台。您可以生成一个单独的控制台 - 但它不会像控制台应用程序那样运行。

我过去我们使用了 2 个单独的 exe。控制台一是表单一的薄包装器（您可以像引用 dll 一样引用 exe，并且您可以使用 [assembly:InternalsVisibleTo("cs_friend_assemblies_2")] 属性来信任控制台一，所以您不要不必暴露比你需要的更多）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-30T18:54:27.883

我将创建一个 Windows 窗体应用程序的解决方案，因为您可以调用两个函数来连接到当前控制台。因此，您可以将程序视为控制台程序。或者默认情况下您可以启动 GUI。

AttachConsole 函数不会创建新的控制台。有关 AttachConsole 的更多信息，请查看[PInvoke：AttachConsole](http://pinvoke.net/default.aspx/kernel32/AttachConsole,.html)

下面是如何使用它的示例程序。

```
using System.Runtime.InteropServices;

namespace Test
{
    /// <summary>
    /// This function will attach to the console given a specific ProcessID for that Console, or
    /// the program will attach to the console it was launched if -1 is passed in.
    /// </summary>
    [DllImport("kernel32.dll", SetLastError = true)]
    private static extern bool AttachConsole(int dwProcessId);

    [DllImport("kernel32.dll", SetLastError = true)]
    private static extern bool FreeConsole();

    [STAThread]
    public static void Main() 
    {   
        Application.ApplicationExit +=new EventHandler(Application_ApplicationExit);
        string[] commandLineArgs = System.Environment.GetCommandLineArgs();

        if(commandLineArgs[0] == "-cmd")
        {
            //attaches the program to the running console to map the output
            AttachConsole(-1);
        }
        else
        {
            //Open new form and do UI stuff
            Form f = new Form();
            f.ShowDialog();
        }

    }

    /// <summary>
    /// Handles the cleaning up of resources after the application has been closed
    /// </summary>
    /// <param name="sender"></param>
    public static void Application_ApplicationExit(object sender, System.EventArgs e)
    {
        FreeConsole();
    }
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-30T17:06:21.450

一种方法是编写一个不显示窗口的窗口应用程序，如果命令行参数表明它不应该显示它。

在显示第一个窗口之前，您始终可以获取命令行参数并检查它们。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-04-11T01:07:09.900

在所有情况下`AttachConsole()`要记住的重要事情是：`AllocConsole()`

```
if (AttachConsole(ATTACH_PARENT_PROCESS))
  {
    System.IO.StreamWriter sw =
      new System.IO.StreamWriter(System.Console.OpenStandardOutput());
    sw.AutoFlush = true;
    System.Console.SetOut(sw);
    System.Console.SetError(sw);
  } 
```

我发现无论有没有 VS 托管过程都可以使用。在调用 To`System.Console.WriteLine`或之前发送输出。我在下面包含了我的方法：`System.Console.out.WriteLine``AttachConsole``AllocConsole`

```
public static bool DoConsoleSetep(bool ClearLineIfParentConsole)
{
  if (GetConsoleWindow() != System.IntPtr.Zero)
  {
    return true;
  }
  if (AttachConsole(ATTACH_PARENT_PROCESS))
  {
    System.IO.StreamWriter sw = new System.IO.StreamWriter(System.Console.OpenStandardOutput());
    sw.AutoFlush = true;
    System.Console.SetOut(sw);
    System.Console.SetError(sw);
    ConsoleSetupWasParentConsole = true;
    if (ClearLineIfParentConsole)
    {
      // Clear command prompt since windows thinks we are a windowing app
      System.Console.CursorLeft = 0;
      char[] bl = System.Linq.Enumerable.ToArray<char>(System.Linq.Enumerable.Repeat<char>(' ', System.Console.WindowWidth - 1));
      System.Console.Write(bl);
      System.Console.CursorLeft = 0;
    }
    return true;
  }
  int Error = System.Runtime.InteropServices.Marshal.GetLastWin32Error();
  if (Error == ERROR_ACCESS_DENIED)
  {
    if (log.IsDebugEnabled) log.Debug("AttachConsole(ATTACH_PARENT_PROCESS) returned ERROR_ACCESS_DENIED");
    return true;
  }
  if (Error == ERROR_INVALID_HANDLE)
  {
    if (AllocConsole())
    {
      System.IO.StreamWriter sw = new System.IO.StreamWriter(System.Console.OpenStandardOutput());
      sw.AutoFlush = true;
      System.Console.SetOut(sw);
      System.Console.SetError(sw);
      return true;
    }
  }
  return false;
} 
```

当我完成输出时，我也调用了这个，以防我需要命令提示符在完成输出时重新显示。

```
public static void SendConsoleInputCR(bool UseConsoleSetupWasParentConsole)
{
  if (UseConsoleSetupWasParentConsole && !ConsoleSetupWasParentConsole)
  {
    return;
  }
  long LongNegOne = -1;
  System.IntPtr NegOne = new System.IntPtr(LongNegOne);
  System.IntPtr StdIn = GetStdHandle(STD_INPUT_HANDLE);
  if (StdIn == NegOne)
  {
    return;
  }
  INPUT_RECORD[] ira = new INPUT_RECORD[2];
  ira[0].EventType = KEY_EVENT;
  ira[0].KeyEvent.bKeyDown = true;
  ira[0].KeyEvent.wRepeatCount = 1;
  ira[0].KeyEvent.wVirtualKeyCode = 0;
  ira[0].KeyEvent.wVirtualScanCode = 0;
  ira[0].KeyEvent.UnicodeChar = '\r';
  ira[0].KeyEvent.dwControlKeyState = 0;
  ira[1].EventType = KEY_EVENT;
  ira[1].KeyEvent.bKeyDown = false;
  ira[1].KeyEvent.wRepeatCount = 1;
  ira[1].KeyEvent.wVirtualKeyCode = 0;
  ira[1].KeyEvent.wVirtualScanCode = 0;
  ira[1].KeyEvent.UnicodeChar = '\r';
  ira[1].KeyEvent.dwControlKeyState = 0;
  uint recs = 2;
  uint zero = 0;
  WriteConsoleInput(StdIn, ira, recs, out zero);
} 
```

希望这可以帮助...

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-30T18:31:28.420

没有1很容易。

No 2 做不到，我不认为。

文档说：

> 对 Write 和 WriteLine 等方法的调用在 Windows 应用程序中无效。

System.Console 类在控制台和 GUI 应用程序中的初始化方式不同。您可以通过查看每个应用程序类型的调试器中的 Console 类来验证这一点。不确定是否有任何方法可以重新初始化它。

演示：创建一个新的 Windows 窗体应用程序，然后将 Main 方法替换为：

```
 static void Main(string[] args)
    {
        if (args.Length == 0)
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new Form1());
        }
        else
        {
            Console.WriteLine("Console!\r\n");
        }
    } 
```

这个想法是任何命令行参数都将打印到控制台并退出。当你不带参数运行它时，你会得到窗口。但是当您使用命令行参数运行它时，什么也没有发生。

然后选择项目属性，将项目类型改为“Console Application”，重新编译。现在，当您使用参数运行它时，您会得到“控制台！” 像你要的那样。当你（从命令行）不带参数运行它时，你会得到窗口。但是在您退出程序之前，命令提示符不会返回。如果您从资源管理器运行程序，将打开一个命令窗口，然后您会看到一个窗口。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-03-11T11:45:15.800

我已经想出了一种方法来做到这一点，包括使用标准输入，但我必须警告你它并不漂亮。

从附加控制台使用标准输入的问题是外壳也会从中读取。这会导致输入有时会进入您的应用程序，但有时会进入 shell。

解决方案是在应用程序生命周期内阻止外壳（尽管从技术上讲，您可以尝试仅在需要输入时阻止它）。我选择这样做的方法是向 shell 发送击键以运行等待应用程序终止的 powershell 命令。

顺便说一句，这也解决了应用程序终止后提示不回来的问题。

我也曾短暂尝试过让它在 powershell 控制台上工作。同样的原则也适用，但我没有得到它来执行我的命令。可能是 powershell 有一些安全检查来防止从其他应用程序运行命令。因为我很少使用powershell，所以我没有研究它。

```
 [DllImport("kernel32.dll", SetLastError = true)]
    private static extern bool AllocConsole();

    [DllImport("kernel32", SetLastError = true)]
    private static extern bool AttachConsole(int dwProcessId);

    private const uint STD_INPUT_HANDLE = 0xfffffff6;
    private const uint STD_OUTPUT_HANDLE = 0xfffffff5;
    private const uint STD_ERROR_HANDLE = 0xfffffff4;

    [DllImport("kernel32.dll")]
    private static extern IntPtr GetStdHandle(uint nStdHandle);
    [DllImport("Kernel32.dll", SetLastError = true)]
    public static extern int SetStdHandle(uint nStdHandle, IntPtr handle);

    [DllImport("kernel32.dll", SetLastError = true)]
    private static extern int GetConsoleProcessList(int[] ProcessList, int ProcessCount);

    [DllImport("user32.dll")]
    public static extern IntPtr SendMessage(IntPtr hWnd, uint Msg, IntPtr wParam, IntPtr lParam);
    [DllImport("user32.dll")]
    public static extern IntPtr PostMessage(IntPtr hWnd, uint Msg, IntPtr wParam, IntPtr lParam);

    /// <summary>
    /// Attach to existing console or create new. Must be called before using System.Console.
    /// </summary>
    /// <returns>Return true if console exists or is created.</returns>
    public static bool InitConsole(bool createConsole = false, bool suspendHost = true) {

        // first try to attach to an existing console
        if (AttachConsole(-1)) {
            if (suspendHost) {
                // to suspend the host first try to find the parent
                var processes = GetConsoleProcessList();

                Process host = null;
                string blockingCommand = null;

                foreach (var proc in processes) {
                    var netproc = Process.GetProcessById(proc);
                    var processName = netproc.ProcessName;
                    Console.WriteLine(processName);
                    if (processName.Equals("cmd", StringComparison.OrdinalIgnoreCase)) {
                        host = netproc;
                        blockingCommand = $"powershell \"& wait-process -id {Process.GetCurrentProcess().Id}\"";
                    } else if (processName.Equals("powershell", StringComparison.OrdinalIgnoreCase)) {
                        host = netproc;
                        blockingCommand = $"wait-process -id {Process.GetCurrentProcess().Id}";
                    }
                }

                if (host != null) {
                    // if a parent is found send keystrokes to simulate a command
                    var cmdWindow = host.MainWindowHandle;
                    if (cmdWindow == IntPtr.Zero) Console.WriteLine("Main Window null");

                    foreach (char key in blockingCommand) {
                        SendChar(cmdWindow, key);
                        System.Threading.Thread.Sleep(1); // required for powershell
                    }

                    SendKeyDown(cmdWindow, Keys.Enter);

                    // i haven't worked out how to get powershell to accept a command, it might be that this is a security feature of powershell
                    if (host.ProcessName == "powershell") Console.WriteLine("\r\n *** PRESS ENTER ***");
                }
            }

            return true;
        } else if (createConsole) {
            return AllocConsole();
        } else {
            return false;
        }
    }

    private static void SendChar(IntPtr cmdWindow, char k) {
        const uint WM_CHAR = 0x0102;

        IntPtr result = PostMessage(cmdWindow, WM_CHAR, ((IntPtr)k), IntPtr.Zero);
    }

    private static void SendKeyDown(IntPtr cmdWindow, Keys k) {
        const uint WM_KEYDOWN = 0x100;
        const uint WM_KEYUP = 0x101;

        IntPtr result = SendMessage(cmdWindow, WM_KEYDOWN, ((IntPtr)k), IntPtr.Zero);
        System.Threading.Thread.Sleep(1);
        IntPtr result2 = SendMessage(cmdWindow, WM_KEYUP, ((IntPtr)k), IntPtr.Zero);
    }

    public static int[] GetConsoleProcessList() {
        int processCount = 16;
        int[] processList = new int[processCount];

        // supposedly calling it with null/zero should return the count but it didn't work for me at the time
        // limiting it to a fixed number if fine for now
        processCount = GetConsoleProcessList(processList, processCount);
        if (processCount <= 0 || processCount >= processList.Length) return null; // some sanity checks

        return processList.Take(processCount).ToArray();
    } 
```

# c++-cli - AssemblyInfo.cpp 是必要的吗？

> ID：807999
> 
> 赞同：5
> 
> 时间：2009-04-30T17:00:06.737
> 
> 标签：c++-cli, metadata, assemblyinfo

我想删除 AssemblyInfo.cpp，因为有时会出现一些元数据错误。

AssemblyInfo.cpp 对任何东西都有用吗？还是可以毫无问题地删除它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2014-04-03T00:05:45.527

我发现了这个文件的一个区别：它与调用[`Assembly.GetReferencedAssemblies`](http://msdn.microsoft.com/query/dev10.query?appId=Dev10IDEF1&l=EN-US&k=k%28SYSTEM.REFLECTION.ASSEMBLY.GETREFERENCEDASSEMBLIES%29;k%28TargetFrameworkMoniker-%22.NETFRAMEWORK,VERSION=V4.0%22%29;k%28DevLang-CSHARP%29&rd=true). 我正在通过将修订号嵌入到我们的 SVN 存储库中来跟踪我们的二进制文件的版本号。最初我也在更新`AssemblyInfo.cpp`，但在二进制文件的文件属性详细信息选项卡中没有发现任何报告。就更新这些细节而言，这个文件似乎对我没有任何帮助，而对 csproj 的类似更新*并非*`AssemblyInfo.cs`如此。为什么区别对？

现在在一个这样的 csproj 中，我们碰巧引用了一个 vcxproj，并且 csproj 使用 .NET`Assembly.GetReferencedAssemblies`方法将其所有引用程序集的版本转储到日志中。我发现该日志中报告的数字不是`VS_VERSIONINFO`我添加的资源给出的 vcxproj 版本（它确实将版本详细信息放入文件属性详细信息选项卡中）。相反，报告的数字实际上与`AssemblyInfo.cpp`.

因此，对于 vcxproj 文件，它看起来`VS_VERSIONINFO`能够更新您在文件属性详细信息选项卡下找到的内容，但`AssemblyInfo.cpp`能够将版本公开为`GetReferencedAssemblies`. 在 C# 中，这两个报告领域似乎是统一的。也许有一种方法可以直接`AssemblyInfo.cpp`以某种方式传播到文件详细信息中，但我最终要做的是将构建信息复制到预构建步骤中的两个位置。也许有人可以找到更好的方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-01-24T10:23:53.853

到目前为止，我的托管 c++ dll 中从未有 AssemblyInfo.cpp，所以我认为没有必要。

（我刚刚添加了文件以获取我的 c++ dll 的版本信息）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T17:02:49.273

为什么不直接修复错误？在那张纸条上，您遇到了什么错误？

该文件提供了诸如版本号之类的信息，这是使用您构建的程序集所必需的。*********