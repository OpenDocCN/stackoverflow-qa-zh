# StackOverflow 问答 000541000-000541999

# c++ - Stringstream 提取整数

> ID：541022
> 
> 赞同：10
> 
> 时间：2009-02-12T12:19:14.850
> 
> 标签：c++, stringstream

为什么我无法将整数值提取到`Num`变量中？

```
#include <sstream>
#include <vector>
#include <iostream>

using namespace std;

int main()
{
    string Digits("1 2 3");
    stringstream ss(Digits);
    string Temp;
    vector<string>Tokens;

    while(ss >> Temp)
        Tokens.push_back(Temp);

    ss.str(Tokens[0]);

    int Num = 0;
    ss >> Num;
    cout << Num;    //output: 0
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-12T12:31:27.660

当流提取最后一个 3 digist "1 2 3" 时，将设置 eof 状态。这不是 str() 成员清除的，你需要自己做。将您的代码更改为：

```
ss.clear();
ss.str(Tokens[0]); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-12T12:27:17.980

你为什么要读入一个临时`string`变量？

您可以从 stringstream 中读取到 int ...

```
int main()
{
    string Digits("1 2 3");
    stringstream ss(Digits);
    int Temp;
    vector<int> Tokens;

    while(ss >> Temp)
        Tokens.push_back(Temp);
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-12T12:22:52.720

您必须重置所有状态标志 (eofbit) 并使流进入良好状态 (goodbit)：

```
ss.clear(); // clear status flags
ss.str(Tokens[0]); 
```

原因是，如果您一直提取到最后，您将到达结尾，并且将在该流上设置 eof 标志。之后，读取操作将被取消，您必须再次清除该标志。无论如何，在清除和重置字符串之后，您可以继续提取整数。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-12T12:47:13.563

STL！:P

```
stringstream ss("1 2 3");
vector<int> Tokens;
copy(istream_iterator<int>(ss), istream_iterator<int>(), back_inserter(Tokens)); 
```

# asp.net - 配置 ASP.NET 开发服务器以连接到 postgres 数据库

> ID：541024
> 
> 赞同：2
> 
> 时间：2009-02-12T12:19:36.377
> 
> 标签：asp.net, postgresql, connection-string

我有一个现有的 ASP.NET 应用程序，它被配置为连接到 MS SQL Server 数据库，我正在尝试修改它以使用 postgres 数据库。

如果可能的话，我想避免修改 C# 代码。

我预计以下更改就足够了：

1.  在这种情况下，添加对合适的 postgres 驱动程序的引用`NauckIT.PostgreSQLProvider.dll`
2.  添加一个`provider`标签来指定要使用的驱动程序，在这种情况下：

```
   <连接字符串>
     <add name="default" connectionString="Server=127.0.0.1;Port=5432;User Id=finnw;Password=XXX;Database=default;Pooling=false"
       providerName="Npgsql" />

   </connectionStrings>

```

但是该`providerName`标签似乎没有任何效果（尽管它本身不会产生错误。）相反，我仍然在浏览器中看到此错误消息：

```
[ArgumentException: Keyword not supported: 'port'.]
   System.Data.Common.DbConnectionOptions.ParseInternal(Hashtable parsetable, String connectionString, Boolean buildChain, Hashtable synonyms, Boolean firstKey) +4907604
   System.Data.Common.DbConnectionOptions..ctor(String connectionString, Hashtable synonyms, Boolean useOdbcRules) +98
   System.Data.SqlClient.SqlConnectionString..ctor(String connectionString) +55 
```

它看起来好像仍在尝试使用 MS SQL Server 驱动程序。

我如何说服它不要这样做？

我使用的是 ASP.NET 开发服务器，而不是 IIS。最初，我认为这可能是问题所在，但[此论坛帖子](http://pgfoundry.org/forum/forum.php?thread_id=1912&forum_id=518)另有建议。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T05:18:58.750

你需要下载和配置你的 PostgreSQL ADO.Net 连接驱动，有几个，最常用的是 Npgsql ( [http://pgfoundry.org/projects/npgsql/](http://pgfoundry.org/projects/npgsql/) )，先下载驱动。（下载 Npgsql2 是新的！）

确保您使用正确的 DbProvider 作为 Npgsql2

确保你的引用中有 Npgsql2 提供程序（无论如何你可以将它添加到你的 web.config 中）：

```
<system.web>
 <compilation>
  <assemblies>
   <add assembly="Npgsql2, Version=1.0.0.0, Culture=neutral, PublicKeyToken=5d8b90d52f46fda7"/>
  </assemblies>
 </compilation>
</system.web> 
```

确保您已按预期安装了 Npgsql2 数据提供程序：（您可以将其添加到您的 web.config 文件中）：

```
<system.data>
 <DbProviderFactories>
  <add name="Npgsql2 Data Provider"
       invariant="Npgsql2"
       description=".Net Framework Data Provider for PostgreSQL" 
       type="Npgsql.NpgsqlFactory, Npgsql2, Version=1.0.0.0, Culture=neutral, PublicKeyToken=5d8b90d52f46fda7" />
 </DbProviderFactories>
</system.data> 
```

像往常一样添加连接字符串：

```
<connectionStrings>
 <add name="Blog"
      connectionString="SERVER=localhost;Database=blogstarterkit;User name=test;Password=test" 
      providerName="Npgsql2"/> <!-- provider invariant name, configured above -->
</connectionStrings> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T12:33:37.873

相当精彩的[http://www.connectionstrings.com/](http://www.connectionstrings.com/)提供了各种连接字符串的示例，您的看起来还可以。不幸的是，您的代码使用的是 SqlClient，这是 .Net 中唯一的 SqlServer 数据库访问。你将不得不破解一些代码......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T12:49:24.417

您需要从使用 System.Data.SqlClient 中的类更改为在 System.Data.Odbc 命名空间中使用它们的类。您还需要获取[ODBC 驱动程序](http://www.postgresql.org/ftp/odbc/versions/msi/)，安装它，并在服务器上设置 ODBC 连接。然后，您可以使用此命名连接来访问您的数据库。

# actionscript-3 - 单个 String.split() 调用用于拆分 CRLF 和空间

> ID：541026
> 
> 赞同：0
> 
> 时间：2009-02-12T12:20:43.847
> 
> 标签：actionscript-3

如何将 string.split() 用于 CRLF 和空格？我需要正则表达式吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T12:40:00.273

不幸的是，AS3 不允许您在字符数组之后进行拆分，例如经典的 OO 语言（C#、Java、C++）。

您必须对 String.Split 的第二个参数使用 RegExp：

\n 匹配换行符。

\r 匹配一个返回字符。

\t 匹配一个制表符。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-07-23T10:54:08.680

```
text.split('\r\n').join('\r');<br/>
text.split('\r').join('\r\n'); 
```

# model-view-controller - 当 dbnull 时，HTML 助手在访问属性时抛出异常

> ID：541028
> 
> 赞同：0
> 
> 时间：2009-02-12T12:22:36.573
> 
> 标签：model-view-controller, strongly-typed-dataset

我刚刚将我的项目升级到 ASP.net MVC RC。不好的是，即使我传递了一个新的数据行，HTML 助手也会从数据集中抛出异常。错误是从 .net 对象类型转换为 dbnull 的结果。

此异常发生在我的 UI 上。我确实在更新时检查 DBnull，但在绑定时不检查。MVC beta 的行为不是这样，我认为这很好。框架不应该在从数据源检索 dbnull 值时抛出异常......

这个问题有解决方案吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T12:44:34.913

1.  将数据集中的值转换为视图模型，即具有与列对应的强类型、命名属性的类的对象集合，其中包含`null`值而不是`DBNull`. 将此模型传递给您的视图。

2.  [在www.codeplex.com 上将](http://www.codeplex.com/aspnet/WorkItem/List.aspx)问题报告为问题。请注意，您可能需要先创建一个免费登录，然后才能提交问题。

# performance - 维护视频网站性能

> ID：541033
> 
> 赞同：1
> 
> 时间：2009-02-12T12:25:42.993
> 
> 标签：performance, video, load-balancing

我正在建立一个在线视频播放网站（如[Youtube](http://youtube.com)）。我的技术挑战是提供大量点击并仍然保持性能。

我目前的解决方案是设置多个后端服务器，让每个服务器缓存一部分视频，这样可以节省从磁盘 I/O 读取视频文件的时间。

另一台前端服务器将哈希`request video ID`以找出视频驻留在哪个服务器上，然后要求客户端浏览器重定向到特定服务器。

我的解决方案很简单，我想知道其他人是否对我的解决方案有更好的想法或任何技术考虑？

* * *

**请注意：我希望将站点设置为在本地工作（而不是依赖于像 Alakami 这样的提供商），因为内容是针对我学校的本地学生的。这基本上是一个“内部网”解决方案。**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T19:49:54.703

如果您的用户分布在世界各地，请尝试使用 Amazon 的 CloudFront（一个 CDN）。如果您的用户是本地化的（美国/欧洲），您可以使用 S3。

此外，您还可以尝试使用 Nginx（一种 Web 服务器），它在处理大文件方面非常有效。

这样，您就不必在应用程序中处理不必要的架构复杂性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T12:53:15.767

当所有用户都请求相同的视频时，您的解决方案将无法正常运行。更好的解决方案是让所有服务器上的所有视频都可用，并使用负载平衡服务器将当前请求重定向到打开的提要数量最少的服务器。

请注意，存储后端（RAID 阵列、SAN）可以以非常高的速率传输数据，因此您通常可以为多个视频服务器使用一个存储系统（即每 N 个视频服务器一个存储系统和 1 个负载平衡器（或两个如果你想要故障转移））。

一个好的解决方案是在协议中有一个“重定向”命令：

1.  客户端向负载均衡器 (LB) 请求视频
2.  LB 告诉客户端使用哪个视频服务器（VS）。这是一个简单的“找到开放提要数量最少的 VS”。
3.  客户端直接连接到 VS（以避免所有开销）
4.  VS 告诉 LB 当前打开的提要数量（此处不要使用增量方法以避免同步问题）
5.  VS 开始将数据流式传输到客户端
6.  当客户端断开连接时，VS 告诉 LB 新的提要数量

[编辑] 让客户端直接连接到视频服务器的主要原因是网络吞吐量。如果所有 VS 都将其数据发送到 LB，然后再将其传递给客户端，那么您将自己限制在 LB 的单（或双）网卡的速度上。如果你有 5 个 VS，直接连接时可以获得 5 倍的吞吐量。此外，当更多用户敲击您的系统时，您可以轻松地扩展您的系统，只需添加另一台视频服务器，将其插入主干网并在 LB 的列表中添加一个条目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T12:28:39.273

您是否在 IIS7 中的 Windows 上托管它？如果是这样，他们有一个模块供 IIS 对视频进行节流，因此它不会更快地流式传输，那么用户实际上可以观看它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T12:28:56.963

一种非常高性能的解决方案是使用像[Akamai](http://www.akamai.com/)这样的数据分发服务。他们在全球范围内提供服务器空间，并且已经解决了性能问题。此外，由于他们在世界各地都有数据中心，因此您的数据不必传输很远，这对 Internet 和您都有好处（因为 Akamai 可以对相同数量的数据收取更低的费用）。

# .net - 工作流基础线程和 WCF OperationContext

> ID：541039
> 
> 赞同：1
> 
> 时间：2009-02-12T12:28:16.013
> 
> 标签：.net, wcf, multithreading, workflow-foundation

我正在使用 WorkFlowServiceHost（在 .net 3.5 中）来托管状态机工作流。我使用 WCF 接收活动来处理对工作流的调用。我正在使用 WCF 授权策略根据消息标头中的信息将声明附加到传入请求。因此，在链条的更下方，我可以使用 ServiceSecurityContext 或仅使用 Thread.CurrentPrincipal 来获取有关请求（角色、用户等）的授权信息。

我知道这对我们不起作用，因为工作流正在分派不同的线程来处理运行时引擎在有工作要做时引发的事件（即接收活动）。关于请求的上下文信息（OperationContext）在工作流中不再可用（除了在运行时线程上随机执行工作时）。

我想做的是在创建工作线程之前获取有关请求（OperationContext）的信息，获取工作线程并将上下文信息附加到它，以便它在工作流实例中可用。

我想在运行时必须有一些事件我可以处理来做到这一点，但我没有想出任何东西。而且我真的不想使用手动工作流调度程序。任何帮助表示赞赏。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-12-02T21:41:17.770

我已经很晚了，但是我在谷歌上搜索“silverlight operationcontext”并找到了你的 SO 问题以及[我正在链接的博客文章](http://msmvps.com/blogs/theproblemsolver/archive/2010/09/21/using-the-wcf-operationcontext-from-a-receive-activity.aspx)（在 Google 结果中一个接一个）。我不知道它是否会有所帮助（他说，差不多两年后）。

我没有与 WCF 合作太多，也没有与 WFF 合作过，所以除了这个链接之外，我真的没有太多要补充的东西。

# java - maven2中的替代插件执行？

> ID：541043
> 
> 赞同：0
> 
> 时间：2009-02-12T12:29:00.287
> 
> 标签：java, maven-2

在包含的配置中，“stop-jetty”执行是否从外部“配置”元素继承任何配置信息？即使我从 stop-jetty 执行中省略它，stopPort 在“stop-jetty”执行中是否会是 9999？任何关于这种继承如何工作的文档参考也很棒。

```
<plugin>
    <groupId>org.mortbay.jetty</groupId>
    <artifactId>maven-jetty-plugin</artifactId>
    <configuration>
        <contextPath>/foobar</contextPath>
        <stopKey>foo</stopKey>
        <stopPort>9999</stopPort>
    </configuration>
    <executions>
        <execution>
            <id>start-jetty</id>
            <phase>pre-integration-test</phase>
            <goals>
                <goal>run</goal>
            </goals>
            <configuration>
                <scanIntervalSeconds>0</scanIntervalSeconds>
                <daemon>true</daemon>
            </configuration>
        </execution>
        <execution>
            <id>stop-jetty</id>
            <phase>post-integration-test</phase>
            <goals>
                <goal>stop</goal>
            </goals>
            <configuration>
                <stopKey>foo</stopKey>  <!-- Is this necessary ??? -->
                <stopPort>9999</stopPort> <!-- Is this necessary ??? -->
            </configuration>
        </execution>
    </executions>
 </plugin> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T13:44:40.947

[此处](http://mojo.codehaus.org/sql-maven-plugin/examples/execute.html)的文档表明`/plugin/configuration`由 each 共享`execution`，因此`/plugin/executions/execution/configuration`有效地继承。

由于插件实现了 JavaBeans 标准，这表明在执行中进行配置也会覆盖。

# iphone - 退出 iphone 应用程序

> ID：541051
> 
> 赞同：0
> 
> 时间：2009-02-12T12:33:39.883
> 
> 标签：iphone, cocoa-touch

是否可以使用目标 c 来表示应用程序关闭？

问候，

托比

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-12T12:35:55.450

您不应该关闭 iPhone 应用程序。您应该等待操作系统向您发出用户已经到别处的信号。阅读人机界面指南。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T14:22:22.243

在 iPhone 上，除非用户触摸手机上的 Home 按钮，否则应用程序不会退出。

因此，即使有某些正当理由导致您的应用程序无法继续，您也不应该退出。只需发出警报，解释为什么您无能为力 - 例如“抱歉，此应用程序需要连接到互联网。请在您有覆盖范围后重试。”

然后用户可以阅读警报，并按通常的方式按主页按钮退出。如果应用程序自行退出，它看起来好像已经崩溃了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T12:50:44.400

之前的评论者是对的，但在某些情况下，您可能希望在您的应用程序中有一个“退出”按钮。只需调用 exit(0) 即可退出应用程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-18T19:44:47.443

Apple 强烈反对让您的应用程序自行退出或通过屏幕上的用户输入退出。正如已经提到的，您可以使用 exit(0) 来强制执行它，但如果您的应用程序正在前往 App Store，则预计会遭到拒绝。我不确定iPhone应用程序的企业分发过程，所以我不知道那里会出现什么问题。

# javascript - 在按钮单击事件结束时调用 JavaScript 函数

> ID：541061
> 
> 赞同：3
> 
> 时间：2009-02-12T12:36:48.067
> 
> 标签：javascript, .net, asp.net, code-behind

在后面的代码中，如何在按钮单击事件结束时调用 JavaScript 函数？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-12T13:03:09.627

如果您在.NET 中工作，您可以尝试

```
ScriptManager.RegisterClientScriptBlock(myButton, this.GetType(), "BlockName", "alert('hello world');", true); 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-12T12:59:10.010

您可能想要 onmouseup 事件：

```
<button onmouseup="alert('You release the mouse button!')">Click me</button> 
```

# c++ - 重新连接设备后的 boost::asio::serial_port 读取

> ID：541062
> 
> 赞同：3
> 
> 时间：2009-02-12T12:37:06.647
> 
> 标签：c++, boost, serial-port, boost-asio

我对从 GPS 设备（USB 串行）读取的 boost::asio::serial_port 类有疑问。连接设备并从中读取工作正常，但是当我断开并重新连接设备时，read_some 不会从端口读取任何字节。

由于 boost 无法检测到串行端口已消失（ is_open() 返回 true ），因此当我没有获取数据时，我会定期取消（）、关闭（）和打开（ GPS_PORT ）设备，重置端口选项在途中。但这也无济于事，输入缓冲区保持为空。

我是否遗漏了什么，或者做错了什么，或者这是 asio 中的错误？有没有标准的方法来检测端口已经消失？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T12:49:24.603

很难说您的具体原因是什么，但实践表明您经常需要禁用`RTS`串行端口的灵敏度。

`RTS`是真实`RS-232`接口上的引脚，当另一侧的设备打开时打开。

`serial_port::read_some`调用查看此信号的底层`Windows API`函数。

由于您没有真正的`RS-323`设备，因此您需要依赖此信号的驱动程序仿真，这可能是错误的（不幸的是经常出现）。

要禁用它，请`serial_port::set_option(DCB)`使用`RTSControl`set to调用`RTS_CONTROL_DISABLE`。

如果`close()`你的手柄没有帮助，它可能是一个问题`boost`。源代码`close()`如下所示：

```
 boost::system::error_code close(implementation_type& impl,
      boost::system::error_code& ec)
  {
    if (is_open(impl))
    {
      if (!::CloseHandle(impl.handle_))
      {
        DWORD last_error = ::GetLastError();
        ec = boost::system::error_code(last_error,
            boost::asio::error::get_system_category());
        return ec;
      }

      impl.handle_ = INVALID_HANDLE_VALUE;
      impl.safe_cancellation_thread_id_ = 0;
    }

    ec = boost::system::error_code();
    return ec;
  } 
```

，即如果`CloseHandle()`由于某种原因失败（或挂起），则内部句柄值不会分配给`INVALID_HANDLE_VALUE`并且`is_open()`将始终返回`true`。

要解决这个问题，请在'ing`is_open()`之后立即检查，如果它返回，则销毁整个实例并再次创建它。`close()``true``boost::asio::serial_port`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T12:53:04.737

`boost::system::system_error`通常，当`read_some`无法再准备好时，您应该获得类型异常。尝试`read`改用，也许它会返回错误并且不只是返回。您也可以尝试异步方法；在这种情况下，当设备断开连接时，处理程序应该得到一个错误对象。

或者，您可以使用该`native()`函数获取端口的句柄并在其上调用 ClearCommError()。它可能会返回错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-05-26T04:42:59.860

尽管 asio 易于处理，但我认为在 Windows 7 上`boost::ip:tcp`处理 boost需要特别小心。 我遇到了类似的问题，并**通过重置 , 的实例来**解决它。 我可以异步读取数据，但在第二次尝试时它没有做同样的事情。 其实是read函数本身没有问题，注册异步读失败，导致第二次try立即返回。`serial_port`
**`boost::asio::io_service`**`io_service_.reset()`

`boost::asio::io_service::run()`

我不确定这与原始海报是否存在相同的问题，因为我正在使用这些天更新的 boost 库。
无论如何，这是我的解决方案：

```
// port open step
port_ = boost::shared_ptr<boost::asio::serial_port>
        (new boost::asio::serial_port(io_service_));
boost::thread t(boost::bind(&boost::asio::io_service::run, &io_service_));
port_->async_read_some(....);
.......

// port close step
port_->cancel();
port_->close();
port_.reset();

io_service_.stop();
io_service_.reset();  // <-- IMPORTANT: this makes serial_port works in repeat use. 
```

# sql-server-2005 - 全文索引目录名称在同一个 SQL 服务器上必须是唯一的吗？(MSSQL 2005)

> ID：541066
> 
> 赞同：0
> 
> 时间：2009-02-12T12:38:39.233
> 
> 标签：sql-server-2005, full-text-search

考虑有一个 MS SQL server 2005 实例，上面有 3 个数据库......开发、RC 和生产。它们都（或多或少）具有相同的模式。他们都有一个“相同”的表格，上面有全文索引。

1.  如果全文索引目录的名称在所有 3 个数据库上都相同，会发生什么情况？
2.  它们是否共享相同的物理目录？
3.  在每个数据库上拥有唯一的目录名称会更好（性能）吗？

它接缝[MSDN 创建全文目录](http://msdn.microsoft.com/en-us/library/ms189520.aspx)并没有给出很好的答案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T12:47:36.480

在 SQL2005 上，目录名称不需要是唯一的。在文件系统上，SQL 将在名称末尾添加一个 4 位数字以使其唯一（例如，“ft_Catalog”变为“ft_Catalog0000”、“ft_Catalog0001”等）。

我更喜欢命名目录，以便包含数据库名称：“ft_cat_[DATABASENAME]”。使查看文件系统更容易。

# c++ - 捕获 c++ 基本异常

> ID：541078
> 
> 赞同：4
> 
> 时间：2009-02-12T12:43:54.087
> 
> 标签：c++, exception, try-catch

在我的项目中，我们有一个基本异常。用于处理显示错误对话框、日志等。我正在寻找一种方法来处理该异常的所有派生类，我认为这会起作用：

```
try
{
  main_loop();
}
catch (const MyExceptionBase* e)
{
  handle_error(e);
} 
```

因为每个抛出的子实例都可以由指向其父实例的指针表示。但是不，当现在抛出异常时，它是一个未处理的异常。

为什么是这样？c++ 只抛出异常作为引用吗？从而使我的 catch 块无用？但是为什么这首先会编译呢？

我能想到的唯一其他方法是：

```
try
{
  main_loop();
}
catch (const ExceptionA& e)
{
  handle_error(e);
}
catch (const ExceptionB& e)
{
  handle_error(e);
}
catch (const ExceptionC& e)
{
  handle_error(e);
} 
```

这似乎有点丑陋。这样做的正确方法是什么？没有基础异常类？还是可以按照我想要的方式解决？

Ps：`handle_error()`做的只是利用基类函数`display_message_box()`并干净地关闭程序。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-12T12:47:24.237

只需混合两种方法：使用基类和使用引用。

```
try
{
  main_loop();
}
catch (const MyExceptionBase& e)
{
  handle_error(e);
} 
```

BTW C++ 可以捕获指针，如果你抛出它们。但这并不可取。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-12T13:58:55.700

你最好的选择是抓住基本参考。但请通过引用而不是指针来完成。例子

```
try
{
  main_loop();
}
catch (const MyExceptionBase& e)
{
  handle_error(e);
} 
```

通过指针捕获异常的问题是它必须由指针抛出。这意味着它将使用 new 创建。

```
throw new ExceptionA(); 
```

这留下了一个相当大的问题，因为它必须在某个时候被删除，否则你有内存泄漏。谁应该负责删除此异常？通常很难做到这一点，这就是为什么大多数人通过参考来捕捉。

一般来说，在 C++ 中，您应该...

> 按引用捕获，按值抛出

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T17:49:45.787

只有`catch( const sometype* ptr )`在抛出指针时才能使用，这在 99% 的情况下是不可取的。

之所以`catch( const sometype& ptr )`有效是因为 r 值可以隐式转换为常量引用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-12T14:02:24.647

我很惊讶你原来的例子不起作用。以下确实有效（至少使用 g++）：

```
class Base { public: virtual ~Base () {} };
class Derived : public Base {};

int main ()
{
  try
  {
    throw new Derived ();
  }
  catch (Base const * b)
  {
    delete b;
  }
} 
```

我也很确定这是为了按照 15.3/3 下的项目符号工作：

> 处理程序的类型为 cv1 T* cv2 并且 E 是指针类型，可以通过两者中的一个或两个将其转换为处理程序的类型

您是否通过公共继承从基本异常类型继承？基类必须是可访问的基类，这将阻止您的异常被捕获。

根据此处的所有其他答案，通过引用进行投掷/捕获的优势在于您无需担心内存的所有权等问题。但是如果上面的示例不起作用 - 那么我不知道为什么引用示例将起作用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T12:47:02.020

这应该有效：

```
try {
  main_loop();
} catch (const MyExceptionBase &e) {
  handle_error(e);
} 
```

我假设 ExceptionA/B/C 都继承自 MyExceptionBase...我认为应该可以正常工作。

PS：您可能还需要考虑从 std::exception 继承 MyExceptionBase 。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-12T16:07:15.520

正如其他人所提到的，您应该捕获对基类异常的引用。

至于为什么它首先编译，与 Java 不同，对于可以抛出或捕获的类型没有任何限制。因此，您可以为任何类型放入一个 catch 块，即使它从未被抛出，您的编译器也会很高兴地编译它。既然你*可以*通过指针抛出，你也可以通过指针捕捉。

# c# - 单元测试继承

> ID：541083
> 
> 赞同：13
> 
> 时间：2009-02-12T12:45:13.897
> 
> 标签：c#, unit-testing, tdd

我有一个关于单元测试的问题。假设我有几个类从父类继承行为。我不想测试所有子类的这种行为。相反，我会测试父类。但是，我还应该提供一个测试来证明该行为在子类中可用。你认为像 Assert.IsTrue(new ChildClass() is ParentClass) 这样的东西有意义吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-12T13:25:20.027

如果您使用的是最先进的单元测试框架，我不理解该声明

> 我不想测试所有子类的这种行为。

如果您将子类的实例交给它们，您的单元测试（针对父类的实例编写）应该不会改变，***前提***是您的子类没有以违反合同的方式覆盖父类行为的某些方面继承的方法。这正是你需要测试的，不是吗？

如果您担心运行测试所需的时间，我会仔细检查以确保您的测试已分区，以便您可以根据您正在积极处理的内容有选择地运行测试（但仍然运行定期完整的投资组合以捕获意外的依赖关系。）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-01-11T00:40:01.310

让你的测试从基类测试继承，[非常]大致像这样。

```
public class MyBaseClass
{
    public virtual void DoStuff() { }
    public virtual void DoOtherStuff() { }
}

public class MySubClass : MyBaseClass
{
    public override void DoOtherStuff()
    {
        // different to to base
    }
}

public abstract class TestOfBaseClass
{
    protected abstract MyBaseClass classUnderTest { get; }

    [TestMethod]
    public void TestDoStuff()
    {
        classUnderTest.DoStuff();
        Assert.StuffWasDone();
    }
}

[TestClass]
public class WhenSubclassDoesStuff : TestOfBaseClass
{
    protected override MyBaseClass classUnderTest
    {
        get { return new MySubClass(); }
    }

    [TestMethod]
    public void ShoudDoOtherStuff()
    {
        classUnderTest.DoOtherStuff();
        Assert.OtherStuffDone();
    }
} 
```

大多数流行的测试框架都会在运行子类测试时运行基础测试中的测试方法。

或者看看类似[https://github.com/gregoryyoung/grensesnitt](https://github.com/gregoryyoung/grensesnitt)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-12T12:52:33.897

我认为编写继承有效的测试是浪费时间。如果您尝试使用基类方法，编译器将检查它们是否可用，假设您没有使用智能感知。我可能会在一个子类中测试行为，然后只在每个修改行为的子类中测试（或行为所依赖的某些状态）。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-12T12:54:33.983

您不想测试对象的类型，**除非**它来自无类型的工厂方法。否则，您正在针对 C# 编译器编写单元测试，这不是您想要做的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T12:55:32.220

C# 编译器会为您处理这种检查。

如果你喜欢你可以写这样的东西：

```
ParentClass childClass = new ChildClass()
var testOutput = childClass.ParentMethod();
Assert.IsNotNull(testOutput); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-06-09T10:38:12.327

我的观点是你的测试结构应该反映你的对象结构，所以如果你有继承自 Class Vehicle 的 Class Car

那么你应该有继承自 Class TestVehicle 的 Class TestCar

通过这样做，Test car 会自动继承所有 Vehicle 测试的正确测试，这意味着如果该功能在 Car 中被覆盖，它很可能会破坏测试，突出显示 Car 中需要 Overriden Test 以支持新行为，如果测试是'没有坏，那么覆盖可能首先是多余的

例如

```
class Vehicle
{
    public virtual bool LicenceRequired
    {
        get{throw new NotImplmentedException()
    }
}
class Bicycle:Vehicle
{
    public override bool LicenceRequired
    {
        get{return false;}
    }
}
class Car:Vehicle
{
    public override bool LicenceRequired
    {
        get{return true;}
    }
}
class TestVehicle
{
    public virtual Void LicenceRequiredTest()
    {
        Try
        {
            LicenceRequired
            Assert.Fail();
        }
        Catch(){}
    }
}
class TestBicycle:TestVehicle
{
    public override void LicenceRequiredTest()
    {
        Assert.IsFalse(LicenceRequired);
    }
}
class TestCar:TestVehicle
{
    public override void LicenceRequiredTest()
    {
        Assert.IsTrue(LicenceRequired);
    }
} 
```

**注意：**只有在测试继承的对象时才应该使用继承，而不仅仅是因为您想对 10 个不相关的对象进行相同的测试。如果你想这样做，我会建议一个静态助手类

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-12T13:05:23.147

您可以使用两种方法来测试基类的*行为：*

1.  创建基类的存根实现，并对存根进行单元测试。只测试公共方法。测试您的私有和受保护方法是没有意义的，因为这些将被您应该在子类中测试的公共方法使用。这种方法不会强制您的基类实现没有错误地隐藏行为。
2.  为执行基类方法的单元测试创​​建测试超类。每当您测试基类的子类时，让您的测试类继承自您的测试超类。这种方法可确保您不会无意中更改基类的行为，但会限制测试的灵活性。

不要费心去验证继承是否真的有效（整个`Assert.IsTrue(new ChildClass() is ParentClass)`事情）。你应该只测试行为。这是 .Net 框架的一个结构特征（继承），您应该相信它有效，否则您会发现自己处于检查框架功能的螺旋式下降中。

# c# - C# 检查文件目标是否有效

> ID：541085
> 
> 赞同：10
> 
> 时间：2009-02-12T12:46:21.383
> 
> 标签：c#, io, sanity-check

是否有标准功能来检查指定目录是否有效？

我问的原因是我从用户那里收到一个绝对目录字符串和文件名，我想彻底检查该位置以检查它是否有效。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-12T12:51:31.247

对于一个文件

```
File.Exists(string) 
```

对于目录

```
Directory.Exists(string) 
```

*注意：* 如果您正在重用一个对象，您应该考虑使用 FileInfo 类与静态 File 类。File 类的静态方法每次都会进行一次可能不必要的安全检查。
[FileInfo](http://msdn.microsoft.com/en-us/library/system.io.fileinfo.aspx) - [DirectoryInfo](http://msdn.microsoft.com/en-us/library/system.io.directoryinfo.aspx) -[文件](http://msdn.microsoft.com/en-us/library/system.io.file.exists.aspx)-[目录](http://msdn.microsoft.com/en-us/library/system.io.directory.exists.aspx)

```
 FileInfo fi = new FileInfo(fName);
 if (fi.Exists)
    //Do stuff 
```

或者

```
DirectoryInfo di = new DirectoryInfo(fName);
 if (di.Exists)
    //Do stuff 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-12T12:49:03.233

```
if(System.IO.File.Exists(fileOrDirectoryPath))
{
    //do stuff
} 
```

这应该可以解决问题！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T12:51:08.890

如果它不能是一个新目录，你可以检查它是否存在。

看起来您也可以使用 Path.GetInvalidPathChars 检查无效字符。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T14:36:33.023

您可能还想考虑有效路径本身并不是 100% 有效的。如果用户提供 C:\windows\System32 或 CD 驱动器，则操作系统在尝试写入时可能会引发异常。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T12:51:06.067

关于检查给定文件或目录是否存在，前面的答案是正确的。Path 类还包含许多可用于验证或操作路径的各种组件的函数。

# c# - 使用任意字符串向左或向右填充 string.format（不是 padleft 或 padright）

> ID：541098
> 
> 赞同：59
> 
> 时间：2009-02-12T12:49:49.767
> 
> 标签：c#, formatting, padding, string.format

我可以使用 String.Format() 用任意字符填充某个字符串吗？

```
Console.WriteLine("->{0,18}<-", "hello");
Console.WriteLine("->{0,-18}<-", "hello");

returns 

->             hello<-
->hello             <- 
```

我现在希望空格是任意字符。我不能使用 padLeft 或 padRight 的原因是因为我希望能够在不同的位置/时间构造格式字符串，然后实际执行格式化。

**--EDIT--**
看到我的问题似乎没有现成的解决方案我想出了这个（在[Think Before Coding 的建议](https://stackoverflow.com/questions/541098/pad-left-or-right-with-string-format-not-padleft-or-padright-with-arbitrary-str/541210#541210)之后）
**--EDIT2--**
我需要一些更复杂的场景，所以我选择了[Think Before Coding's第二个建议](https://stackoverflow.com/questions/541098/pad-left-or-right-with-string-format-not-padleft-or-padright-with-arbitrary-str/541323#541323)

```
[TestMethod]
public void PaddedStringShouldPadLeft() {
    string result = string.Format(new PaddedStringFormatInfo(), "->{0:20:x} {1}<-", "Hello", "World");
    string expected = "->xxxxxxxxxxxxxxxHello World<-";
    Assert.AreEqual(result, expected);
}
[TestMethod]
public void PaddedStringShouldPadRight()
{
    string result = string.Format(new PaddedStringFormatInfo(), "->{0} {1:-20:x}<-", "Hello", "World");
    string expected = "->Hello Worldxxxxxxxxxxxxxxx<-";
    Assert.AreEqual(result, expected);
}
[TestMethod]
public void ShouldPadLeftThenRight()
{
    string result = string.Format(new PaddedStringFormatInfo(), "->{0:10:L} {1:-10:R}<-", "Hello", "World");
    string expected = "->LLLLLHello WorldRRRRR<-";
    Assert.AreEqual(result, expected);
}
[TestMethod]
public void ShouldFormatRegular()
{
    string result = string.Format(new PaddedStringFormatInfo(), "->{0} {1:-10}<-", "Hello", "World");
    string expected = string.Format("->{0} {1,-10}<-", "Hello", "World");
    Assert.AreEqual(expected, result);
} 
```

因为代码有点太多，不能发帖，我把它移到了 github 作为要点： http:
[//gist.github.com/533905#file_padded_string_format_info](http://gist.github.com/533905#file_padded_string_format_info)

人们可以轻松地对其进行分支和任何事情:)

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-02-12T13:50:58.920

还有另一种解决方案。

实现`IFormatProvider`返回一个`ICustomFormatter`将传递给 string.Format ：

```
public class StringPadder : ICustomFormatter
{
  public string Format(string format, object arg,
       IFormatProvider formatProvider)
  {
     // do padding for string arguments
     // use default for others
  }
}

public class StringPadderFormatProvider : IFormatProvider
{
  public object GetFormat(Type formatType)
  { 
     if (formatType == typeof(ICustomFormatter))
        return new StringPadder();

     return null;
  }
  public static readonly IFormatProvider Default =
     new StringPadderFormatProvider();
} 
```

然后你可以像这样使用它：

```
string.Format(StringPadderFormatProvider.Default, "->{0:x20}<-", "Hello"); 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-12T13:27:20.973

您可以将字符串封装在实现 IFormattable 的结构中

```
public struct PaddedString : IFormattable
{
   private string value;
   public PaddedString(string value) { this.value = value; }

   public string ToString(string format, IFormatProvider formatProvider)
   { 
      //... use the format to pad value
   }

   public static explicit operator PaddedString(string value)
   {
     return new PaddedString(value);
   }
} 
```

然后像这样使用：

```
 string.Format("->{0:x20}<-", (PaddedString)"Hello"); 
```

结果：

```
"->xxxxxxxxxxxxxxxHello<-" 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T13:00:44.080

编辑：我误解了你的问题，我以为你在问如何用空格填充。

`string.Format`使用对齐组件无法实现您的要求；`string.Format`总是用空格填充。请参阅[MSDN的](http://msdn.microsoft.com/en-us/library/txafckwd.aspx)*对齐组件*部分：复合格式。

根据 Reflector 的说法，这是在内部运行的代码，`StringBuilder.AppendFormat(IFormatProvider, string, object[])`由以下代码调用`string.Format`：

```
int repeatCount = num6 - str2.Length;
if (!flag && (repeatCount > 0))
{
    this.Append(' ', repeatCount);
}
this.Append(str2);
if (flag && (repeatCount > 0))
{
    this.Append(' ', repeatCount);
} 
```

如您所见，空白被硬编码为用空格填充。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-10-14T09:12:49.450

简单的：

```
 dim input as string = "SPQR"
    dim format as string =""
    dim result as string = ""

    'pad left:
    format = "{0,-8}"
    result = String.Format(format,input)
    'result = "SPQR    "

    'pad right
    format = "{0,8}"
    result = String.Format(format,input)
    'result = "    SPQR" 

```

# eclipse - 如何让 Eclipse 为 Cygwin 的 GDB 提供可执行文件的 posix 路径？

> ID：541099
> 
> 赞同：9
> 
> 时间：2009-02-12T12:49:58.393
> 
> 标签：eclipse, gdb, cygwin

我在 Windows 上使用 Eclipse 使用 Cygwin 的工具链对 C++ 进行编程。我也想用它来调试，但我的问题如下：

*   要调试的可执行文件位于工作区的子文件夹中（我猜这很标准），但不在构建可执行文件的实际项目中。
*   Eclipse 和 GDB 有不同的路径格式：Eclipse 使用 Windows 路径，而 GDB 使用 posix 路径。Eclipse 知道`D:\Path\To\Exe`，而 GDB 需要`/cygdrive/d/Path/To/Exe`.
*   当我在“调试配置...”对话框中输入路径时，Eclipse**坚持认为它可以找到要调试的可执行文件。**在路径正确之前，“调试”按钮将被禁用。
*   Eclipse 似乎没有接受`${workspace_loc}`那个特定的输入框。

是否有一些我不知道的隐藏选项？你以前有过这个问题吗？

# 到目前为止我尝试过的

*   强制 Eclipse 将我输入的路径传递给 GDB ---**不起作用。**
*   摆弄源查找路径和路径映射 ---**不起作用**，它实际上只适用于源文件。
*   为可执行文件所在的输出文件夹创建一个 C++ 项目，这样我就可以在项目中拥有一个指向 exe 的相对路径 ---**不起作用。**

# 我仍然可以尝试的事情

*   使用该`.gdbinit`文件丢弃 Eclipse 给出的路径并使用 posix 路径加载真正的可执行文件 --- 尝试过，但不是很难。
*   将包装器指定为 GDB 的参数 --- 污染了我的工作空间的根。
*   提供我自己的插件来处理案例---添加另一段代码以另一种语言维护。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-24T19:42:58.200

在 Eclipse 中的 Preferences->C/C++->Debug->"Common Source Lookup Path" 中添加新的路径映射。作为编译路径你应该使用类Unix路径（例如/cygdrive/c），作为本地系统路径你应该使用类Windows路径（例如c:）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-24T00:35:29.907

Cygwin 附带一个程序`cygpath`，用于将路径从 windows 转换为 unix，反之亦然，*例如*

```
$ cygpath -u 'c:\Users\Andrew\Documents\svn'
/cygdrive/c/Users/Andrew/Documents/svn 
```

做一个`cygpath --help`了解更多信息。

因此，您可能想为 GDB 编写一个包装器，将任何特定于 Windows 的路径转换为 ​​unix 路径，然后调用真正的 GDB。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-31T12:00:18.340

升级到 Eclipse Ganymede 后问题就消失了。

# python - 使用 Python 的 ElementTree 查找顶级 xml 注释

> ID：541100
> 
> 赞同：3
> 
> 时间：2009-02-12T12:50:15.430
> 
> 标签：python, xml, elementtree

我正在使用 Python 的 ElementTree 解析一个 xml 文件，如下所示：

```
et = ElementTree(file=file("test.xml")) 
```

test.xml 以几行 xml 注释开头。

有没有办法从 et 那里得到这些评论？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T12:55:05.200

对于 ElementTree 1.2.X，有一篇关于[使用 ElementTree 阅读处理说明和评论](http://effbot.org/zone/element-pi.htm) 的文章( [http://effbot.org/zone/element-pi.htm](http://effbot.org/zone/element-pi.htm) )。

* * *

*编辑：*

另一种方法是使用实​​现 ElementTree API 的**lxml.etree 。**来自[lxml.etree 的 ElementTree 兼容性的引用](http://codespeak.net/lxml/compatibility.html) ：

> **ElementTree在解析 XML 时会**忽略注释和处理指令，而****etree 会将它们读入**并分别将它们视为 Comment 或 ProcessingInstruction 元素。**

 *** * *

## 回答 #2

> 赞同：0
> 
> 时间：2020-05-07T07:39:36.177

是的，有办法。

```
from xml.etree import ElementTree

def parseXml (fn):
    try:
        target = ElementTree.TreeBuilder (insert_comments=True)
        parser = ElementTree.XMLParser(target=target, encoding='utf-8')
        et = ElementTree.parse (fn, parser)
    except Exception as e:
        print ("%s: %s" % (fn, str (e)))
        return

    for el in et.getroot ():
        print (el) 
```

同样适用于处理指令 (ElementTree.PI)，仅当 insert_pis=true 时，它​​们才会插入到结果结构中。

# vb.net - 删除一段字符串

> ID：541102
> 
> 赞同：0
> 
> 时间：2009-02-12T12:51:02.103
> 
> 标签：vb.net, string

有谁知道更好的方法来做到这一点？

```
Dim Result1,Result2,FinalResult As String

Result1 = Left(sXMLResponse, sXMLResponse.IndexOf("<start>"))
Result2 = Mid(sXMLResponse, sXMLResponse.IndexOf("<end>"))

FinalResult =Result1 & Result2 
```

肯定有内置的 String.Remove(StringOne, StringTwo) 方法或更优雅的方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T13:08:13.950

你似乎在用旧的 VB6 方式做事。一般推荐使用VB.NET中的.NET函数，即string.Substring而不是Left/Right/Mid/etc。职能。现在看起来您只是想删除字符串之间和字符串中的文本，这可以很容易地在一行中完成。

```
Dim result = sXMLResponse.Substring(0, sXMLResponse.IndexOf("<start>")) & sXMLResponse.Substring(sXMLResponse.IndexOf("<end>") + 5) 
```

实际上，它与您所做的没有什么不同，只是它消除了对临时变量的需要。另请注意，有一个 string.Remove 方法，但需要一个临时变量来计算*count*参数。

当然，您可以等效地使用 RegEx 删除一行中的字符串块，但是对于这样一个简单的任务来说这是相当不必要的，而且肯定会慢很多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T13:26:16.140

你可以试试这个解决方案：

```
Dim stringOne as String="ae234-asd-dddddffdfdff";
Dim stringTwo as String="-asd-";

stringOne.Replace(stringTwo, String.Empty); 
```

但是如果stringOne中有多个stringTwo，则在此解决方案中也将它们删除

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T13:10:11.670

首先，我认为 Remove() 会从另一个字符串中删除一个字符串，这并不是您真正想要的。

您希望能够提取以一个字符串开头并以另一个字符串结尾的字符串。在这种情况下，为什么不自己写呢？就像是：

```
function extractStr (str as string, startStr as string, endStr as string) as string
    dim sPos as integer
    dim ePos as integer

    sPos = instr (str,startStr);
    ePos = instr (str,endStr);

    extractStr = str
    if ePos > 0 then
        extractStr = left (extractStr, ePos + len(endStr))
    end if
    if sPos > 0 then
        extractStr = mid (extractStr, sPos)
    end if
end 
```

# sharepoint - 是否可以使用持续集成技术开发共享点？

> ID：541108
> 
> 赞同：6
> 
> 时间：2009-02-12T12:52:46.720
> 
> 标签：sharepoint, build-process, continuous-integration

我们正在为一些非常严肃的 Sharepoint(MOSS 2007) 开发做准备，包括自定义 Web 部件、列表、母版页和布局等等等。

我们正在评估版本控制，似乎讨论并没有比这更深入。我热衷于我们可以轻松地从源代码控制部署到我们的测试和生产服务器，尽可能少的人工接触，最好在每次签入后完全自动部署。

我以前没有使用过 CI，所以我对 Sharepoint 的可能性以及太复杂以至于无法理解的事情感到有点无知。

我担心如果我们走上了一条太“容易”的道路，那么当我们发布一些新功能后不得不花半天时间设置每个环境时，我们很快就会后悔。

我什至还没有开始思考当用户添加的列表中有实际内容时会发生什么，以及这将如何影响我们在开发方面的工作。

欢迎链接到博客/文档。个人经验非常受欢迎。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T18:25:09.103

我最接近的经验是使用[STSDEV](http://www.codeplex.com/stsdev)构建发布解决方案的项目。自定义构建操作允许我们从目标服务器中删除共享点解决方案、安装新解决方案并重置所需的应用程序池。

花了一些时间来构建，但效果很好。我们没有发布测试使用这个过程，但它可能是可能的。

这是目标文件的示例。不幸的是，它有点复杂。

```
<?xml version="1.0" encoding="utf-8" ?>
<Project DefaultTargets="DebugBuild" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <PackageName>MyFeatures.wsp</PackageName>
    <PackageFile>MyFeatures.wsp</PackageFile>
    <TargetUrl>http://intranet</TargetUrl>
    <ProjectDeploymentFilesFolder>DeploymentFiles</ProjectDeploymentFilesFolder>
    <ProjectRootFilesFolder>$(ProjectDir)\RootFiles</ProjectRootFilesFolder>
    <WssRootFilesFolder>$(ProgramFiles)\Common Files\Microsoft Shared\web server extensions\12</WssRootFilesFolder>
    <ReleaseFolder>$(SolutionDir)Deployment</ReleaseFolder>
    <MAKECAB>"C:\Windows\System32\makecab.exe"</MAKECAB>
    <STSADM>"$(ProgramFiles)\Common Files\Microsoft Shared\web server extensions\12\bin\stsadm.exe"</STSADM>
    <STSDEV>"$(SolutionDir)..\Tools\STSDev\stsdev.exe"</STSDEV>
    <GACUTIL>"C:\Program Files\Microsoft SDKs\Windows\v6.0A\bin\gacutil.exe"</GACUTIL>
    <IISAPP>cscript c:\windows\system32\iisapp.vbs</IISAPP>    
    <WARMUPSITE>"$(SolutionDir)..\Tools\WarmUpServer\AsyncWarmup.bat" "$(SolutionDir)..\Tools\WarmUpServer\"</WARMUPSITE>
    <TIMERJOBSRESTART>net stop SPTimerV3 &amp; net start SPTimerV3</TIMERJOBSRESTART>
  </PropertyGroup>

  <ItemGroup>
    <WSSSourceFiles Include="$(ProjectDir)\RootFiles\**\*.*" />
  </ItemGroup>  

<Target Name="DebugBuild">
  <Message Text="Refreshing Deployment Files..." Importance="high" />
  <Exec Command="$(STSDEV) /refresh $(TargetName) $(ProjectDir)" ContinueOnError="true" />
  <Message Text="Deleting Solution Package File..." Importance="high" />
  <Delete Files="$(ProjectDeploymentFilesFolder)\$(PackageFile)" ContinueOnError="true" />
  <Message Text="Building Solution Package (Debug Version)" Importance="high" />
  <Exec Command="$(MAKECAB) /F $(ProjectDir)\$(ProjectDeploymentFilesFolder)\SolutionPackage.ddf /D CabinetNameTemplate=$(PackageFile)" ContinueOnError="false" />
  <Message Text="" Importance="high" />
  <Message Text="Copying WSP file to CAB" Importance="high" />
  <Delete Files="$(ProjectDeploymentFilesFolder)\$(PackageFile).cab" ContinueOnError="true" />
  <Copy SourceFiles="$(ProjectDeploymentFilesFolder)\$(PackageFile)" DestinationFiles="$(ProjectDeploymentFilesFolder)\$(PackageFile).cab" SkipUnchangedFiles="false" />
  <Message Text="Copying WSP file to release folder: $(ReleaseFolder) from $(ProjectDeploymentFilesFolder)\$(PackageFile)" Importance="high" />
  <Exec Command="attrib -r &quot;$(ReleaseFolder)\$(PackageFile)&quot;" ContinueOnError="true"></Exec>
  <Delete Files="$(ReleaseFolder)\$(PackageFile)" ContinueOnError="true" />
  <Copy SourceFiles="$(ProjectDeploymentFilesFolder)\$(PackageFile)" DestinationFolder="$(ReleaseFolder)" SkipUnchangedFiles="false" />
  <Message Text="" Importance="high" />
</Target>

<Target Name="DebugInstall" DependsOnTargets="DebugBuild">
  <Message Text="Installing Solution..." Importance="high" />
  <Exec Command="$(STSADM) -o addsolution -filename $(ProjectDeploymentFilesFolder)\$(PackageFile)" ContinueOnError="true" />
  <Exec Command="$(STSADM) -o execadmsvcjobs" />
  <Message Text="" Importance="high" />
</Target>

<Target Name="DebugDeploy" DependsOnTargets="DebugInstall">
  <Message Text="Deploying Solution..." Importance="high" />
  <Exec Command="$(STSADM) -o deploysolution -name $(PackageName) -immediate -allowgacdeployment -url http://intranet" />
  <Exec Command="$(STSADM) -o execadmsvcjobs" />
  <Copy SourceFiles="$(TargetDir)$(TargetName).pdb" DestinationFolder="C:\WINDOWS\assembly\GAC_MSIL\MyFeatures\1.0.0.0__ce271be627d58c77" SkipUnchangedFiles="" />
  <Message Text="$(TargetDir)$(TargetName).pdb copied to GAC for debugging." Importance="high" />
  <Message Text="" Importance="high" />
</Target>

<Target Name="DebugDeployForce" DependsOnTargets="DebugInstall">
  <Message Text="Deploying Solution..." Importance="high" />
  <Exec Command="$(STSADM) -o deploysolution -name $(PackageName) -immediate -allowgacdeployment -url http://intranet -force" />
  <Exec Command="$(STSADM) -o execadmsvcjobs" />
  <Copy SourceFiles="$(TargetDir)$(TargetName).pdb" DestinationFolder="C:\WINDOWS\assembly\GAC_MSIL\MyFeatures\1.0.0.0__ce271be627d58c77" SkipUnchangedFiles="" />
  <Message Text="$(TargetDir)$(TargetName).pdb copied to GAC for debugging." Importance="high" />
  <Message Text="" Importance="high" />
</Target>

<Target Name="DebugRedeploy" >
  <Message Text="" Importance="high" />
  <Message Text="Starting sequence of Retract/Delete/Build/Install/Deploy" Importance="high" />
  <CallTarget Targets="DebugRetract" />
  <CallTarget Targets="DebugDelete" />
  <CallTarget Targets="DebugBuild" />
  <CallTarget Targets="DebugInstall" />
  <CallTarget Targets="DebugDeployForce" />
  <Message Text="" Importance="high" />
</Target>      

  <Target Name="DebugRetract" >
  <Message Text="Retracting Solution" />
  <Exec Command="$(STSADM) -o retractsolution -name $(PackageName) -immediate -url http://intranet" ContinueOnError="true" />
  <Exec Command="$(STSADM) -o execadmsvcjobs" />
  <Message Text="" Importance="high" />
</Target>

<Target Name="DebugDelete" DependsOnTargets="DebugRetract">
  <Message Text="Deleting Solution Package from Farm Solution Package Store" />
  <Exec Command="$(STSADM) -o deletesolution -name $(PackageName)" ContinueOnError="true" />
  <Exec Command="$(STSADM) -o execadmsvcjobs" />
  <Message Text="" Importance="high" />
</Target>

   </Project> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T22:16:30.217

看看 Powershell ... 不幸的是，SharePoint 的主要问题之一是缺乏良好的开发和部署过程。一切都应该打包成解决方案并通过 powershell 部署，powershell 还可以管理任何信息清理。要进行版本化，只需将解决方案部署为升级并使用 Powershell 酌情在您的应用程序中进行更新（如果您更新了版本号）。这是很多额外的工作，但效果很好。在最近的一次升级中，我必须对两个 Web 部件进行版本化，然后使用 powershell 循环遍历我的所有约 1,500 个站点，删除旧的 Web 部件并重新添加新的 Web 部件。

随着你的发展，你应该开始开发一个强大的 Powershell 库来执行强大的更新任务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-13T22:47:55.127

唯一要通过某种持续集成来使用 SharePoint 是在使用功能和解决方案包 (wsp) 时。

您只需要以某种方式将您的 wsp 与所有必要的文件/DLL 和配置打包，然后部署它。部署后，您可以创建一个批处理脚本来自动重新激活所有功能。

请注意，所有已自定义（未托管）的文件都不会更新。您必须确保重置站点定义（通过代码它是“SPFile.RevertContentStream”）。

祝你好运！

# python - 如何在 Django-admin 中查找存储为整数的自定义 IP 地址字段？

> ID：541115
> 
> 赞同：3
> 
> 时间：2009-02-12T12:54:42.143
> 
> 标签：python, mysql, django

在我的 Django 模型中，我创建了自定义 MyIPAddressField，它以整数形式存储在 mysql 后端。为此，我实现了 to_python、get_db_prep_value、get_iternal_type（返回 PositiveIntegerField）和 formfield 方法（使用股票 IPAddressField 作为 form_class）。

唯一的问题是在 ModelAdmin 中的内置搜索等情况下的字段查找。那么，问题是如何实现 get_db_prep_lookup 来执行基于字符串的查找类型，如“contains”、“regex”、“startswith”、“endswith”？

Mysql 具有特殊功能 inet_ntoa() 但我不知道如何指示 ORM 在管理员搜索查询中使用它。例如：SELECT inet_ntoa(ip_address) as ip FROM table WHERE ip LIKE '%search_term%'。为什么自定义字段在 python 端而不是在数据库端执行类型转换？

EDIT1：可能还有另一种解决搜索问题的方法 - 不要将整数列转换为字符串，而是将搜索参数拆分为子网/掩码并执行一些二进制数学以将它们与整数 IP 值进行比较。

EDIT2：这是我到目前为止的代码：

模型.py：

```
class MyIPField(models.Field):
    empty_strings_allowed = False

    __metaclass__ = models.SubfieldBase

    def get_db_prep_value(self, value):
        if value is None: return None
        return unpack('!L', inet_aton(value))[0]

    def get_internal_type(self):
        return "PositiveIntegerField"

    def to_python(self, value):
         if type(value).__name__ in ('NoneType', 'unicode'): return value
         return inet_ntoa(pack('!L', value))

    def formfield(self, **kwargs):
        defaults = {'form_class': IPAddressField}
        defaults.update(kwargs)
        return super(MyIPField, self).formfield(**defaults)

class MyManager(models.Manager):
    def get_query_set(self):
        return super(MyManager, self).get_query_set().extra(select={'fakeip': "inet_ntoa(ip)"})

class Address(models.Model):
    # ... other fields are skipped (Note: there was several foreign keys)
    ip = MyIPField(u"IP address", unique=True)

    objects = AddressManager()

    def __unicode__(self):
            return self.ip 
```

管理员.py：

```
class AddressAdmin(admin.ModelAdmin):
    list_display = ('address',)  # ... some fields are skipped from this example
    list_display_links = ('address',)
    search_fields = ('fakeip', )

admin.site.register(Address, AddressAdmin) 
```

但是当我使用管理员更改列表搜索框时，我收到错误“无法将关键字'fakeip'解析到字段中。选择是：ip，id”。是否有可能欺骗 Django 并让它认为 fakeip 是一个真实的领域？

使用标准 IPAddressField（基于字符串）不适合我的需要，以及切换到以正确格式存储的 Postgres。

此外，我查看了 Django 管理内部（options.py 和 views/main.py），我发现没有大量复制/粘贴的情况下自定义 ChangeList 类或搜索机制的简单方法。我认为 Django admin 比它更强大。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T19:55:13.437

您可以指示 ORM 为您的 SQL 查询添加一个额外的字段，如下所示：

```
IPAddressModel.objects.extra(select={'ip': "inet_ntoa(ip_address)"}) 
```

这会为您的对象添加`SELECT inet_ntoa(ip_address) as ip`查询和字段。`ip`您可以在 WHERE 子句中使用新的合成字段。

你确定你真的不想要类似的东西`WHERE (ip_address & 0xffff0000) = inet_aton('192.168.0.0')`吗？或者你*真的*想在你的日志中找到所有包含数字的IP地址`119`吗？

如果`suffix`是来自 CIDR 表示法的 /24：

```
mask = 0xffffffff ^ 0xffffffff >> suffix 
```

添加到 WHERE 子句：

```
(ip_address & mask) = (inet_aton(prefix) & mask) 
```

# .net - 您可以使用 Xceed Grid for .NET 来显示从右到左的脚本，例如阿拉伯语

> ID：541119
> 
> 赞同：0
> 
> 时间：2009-02-12T12:55:20.330
> 
> 标签：.net, grid

Xceed Grid for .NET 控件可以用来显示从右到左的文本吗？我找不到任何文档或示例来执行此操作。有谁知道这是否可能？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-08-13T15:11:07.490

似乎不是，他们不完全支持 RTL，至少不支持他们的网格控制。但是，您可以将网格内的文本框设置为 rtl，但这只是在单元格级别...

我知道，找到任何组件提供商来完全支持 RTL 表单/文本显示是一件很痛苦的事情。你最好的选择是微软内置的datagridview，或者只是等待visual studio 2010：P

# string - 删除“;” 从语句;; 在 C 中

> ID：541123
> 
> 赞同：0
> 
> 时间：2009-02-12T12:56:50.843
> 
> 标签：string

我需要删除“;” 来自 C 中带有“;;”的语句。例如：

```
main()
{
    int i;;
    int j,k;;
    int l;
    for(i=0;i<10;;)
    {}
} 
```

应该变成：

```
main()
{
    int i;
    int j,k;
    int l;
    for(i=0;i<10;;)
    {}
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T13:01:08.227

UltraEdit 可能是一个不错的选择..

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T13:03:16.723

我的第一个答案是错误的，因为我错过了;; 在 for 循环的头部，它确实起到了作用。

以下 perl 脚本将替换所有 ;; 后跟带有单个 ; 的空格。它将对当前目录及其子目录中的所有 C 文件（文件扩展名 .c）执行此操作。

```
 perl -i -p -e 's/;;(\s*)$/;$1/g' `find | grep .c` 
```

感谢 Sean Bright 纠正了我最初的错误。（见评论。）

我只想指出额外的；在行尾不应该真的存在问题。你可以把它们留在那里，或者你可以使用你的文本编辑器来搜索和替换那些无关的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T12:59:50.353

考虑使用**查找和替换**命令。任何体面的文本编辑器都有一个（Notepad++、KWrite，更不用说 Emacs）。搜索**;;** 并将其替换为**;** .

如果您有大量代码并且`;`可能发生在 char* 值中，请使用 regexp :)

编辑：好的，你应该搜索：**;; *\n**然后用**;\n**替换它。

# wcf - 如何从原始 TCP 请求调用 Biztalk net.TCP 服务？

> ID：541128
> 
> 赞同：0
> 
> 时间：2009-02-12T12:58:25.893
> 
> 标签：wcf, oracle, tcp, biztalk

我在 Biztalk 2006 R2 中编写了一个基于 net.tcp 的服务，它在某个位置进行侦听，

```
http://localhost:5060/WCFTcpService
```

我需要使用原始 TCP 请求调用此服务。即
我不想创建代理类并在.NET 客户端应用程序中使用它。我怎么能做到这一点？
实际情况是 Oracle 存储过程将用于与此服务进行通信，并且我被允许调用此服务的唯一方法是将 TCP 请求发送到托管该服务的 Biztalk 服务器。任何帮助或提示将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T18:23:58.187

如果我了解您的问题，我*认为您可能需要从 Oracle 调用外部程序。*不确定您的 Oracle 版本，但大多数较新的版本加强了安全性，但功能就在那里。

查看[此站点](http://www.idevelopment.info/data/Oracle/DBA_tips/PL_SQL/PLSQL_1.shtml)以获取基本入门。更多信息在[这里](http://www.idevelopment.info/data/Oracle/DBA_tips/PL_SQL/PLSQL_17.shtml)。[Oracle 文档](http://download.oracle.com/docs/cd/B12037_01/appdev.101/b10795/adfns_ex.htm)有时也很有用。[使用google 搜索 oracle 外部程序](http://www.google.com/search?hl=en&q=oracle+external+procedure&btnG=Search)可以找到所有这些以及更多内容。

# c# - 来自对象的 DropDownList

> ID：541135
> 
> 赞同：2
> 
> 时间：2009-02-12T13:00:40.333
> 
> 标签：c#, .net, drop-down-menu

如何绑定对象中的 DropDownlist DataText 或 DataValue 字段。当有问题的对象处于第二级时，例如要绑定的对象不在返回对象 Users.ContactDetails.Telephone 的第一级，因为下面的代码不起作用：

```
ddl.DataSource = dal.dal_Users.GetAllUsers();
ddl.DataTextField = "Telephone"; 
```

我已经尝试了一系列想法，但似乎找不到任何关于这是否可以完成的信息。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T13:40:46.930

如果您使用的是 C# 3，那么您可以使用`ConvertAll<>`etension 方法创建一个新的匿名类型，将内部属性向上移动到顶层。

尝试这样的事情：

```
IEnumerable<User> users = dal.dal_Users.GetAllUsers();

ddl.DataSource = users.ConvertAll(u => 
    new { Value = u.Name, Telephone = u.ContactDetails.Telephone });
ddl.DataTextField = "Telephone"; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T13:42:53.370

**编辑：** 我得到了足够多的关于这个话题的反馈，我觉得它值得[写一篇博文](http://toranbillups.com/blog/archive/2009/06/24/Working-with-a-select-box-using-Model-View-Presenter)

在将域对象绑定到 ddl 控件时，我采用的一种方法是从在 constr 中具有重载的基类继承，以允许文本/值仅是原始的“子集”。下面的代码用于模型视图演示器或模型视图 ViewModel 实现，它抽象出 ddl 控件，因此您可以将任何 UI 推送到此业务代码的顶部。

**下面是我如何将 ddl 与用户对象集合绑定的示例，并根据相关对象（工作单元）设置选择**

```
 public void PopulateUserDDL(UnitOfWork UnitOfWorkObject)
 {
     List<User> UserCollection = mUserService.GetUserCollection();  //get a collection of objects to bind this ddl

     List<ILookupDTO> UserLookupDTO = new List<ILookupDTO>();

     UserLookupDTO.Add(new User(" ", "0"));
     //insert a blank row ... if you are into that type of thing

     foreach (var User in UserCollection) {
         UserLookupDTO.Add(new User(User.FullName, User.ID.ToString()));
     }

     LookupCollection LookupCollectionObject = new LookupCollection(UserLookupDTO);
     LookupCollectionObject.BindTo(mView.UserList);

     if (UnitOfWorkObject == null) {
         return;
     }

     if (UserCollection == null) {
         return;
     }

     for (i = 0; i <= UserCollection.Count - 1; i++) {
         if (UserCollection(i).ID == UnitOfWorkObject.User.ID) {
             LookupCollectionObject.SelectedIndex = (i + 1);
             //because we start at 0 instead of 1 (we inserted the blank row above)
             break;
         }
     }
 } 
```

**下面是重载在您的用户对象中的样子**

```
/// <summary>
/// This constr is used when you want to create a new Lookup Collection of ILookupDTO
/// </summary>
/// <param name="txt">The text that will show up for the user in the lookup collection</param>
/// <param name="val">The value that will be attached to the item in the lookup collection</param>
/// <remarks></remarks>
public New(string txt, string val) : base(txt, val)
{
} 
```

**任何实体/域对象/DTO/等的基类都需要以下内容**

```
 public New(string txt, string val)
 {
     mText = txt;
     mValue = val;
 } 
```

**此基类还应实现 ILookupDTO - 因为这将强制您公开本示例中用户对象使用的 Text 和 Value 属性**

```
 public interface ILookupDTO
 {
     string Text {
         get;
         set;
     }
     string Value {
         get;
         set;
     }
 } 
```

**以下是此答案顶部的 bind 方法中使用的 LookupCollection 的定义**

```
 public class LookupCollection
 {
     private readonly IEnumerable<ILookupDTO> dtos;
     private ILookupList mList;

     public LookupCollection(IEnumerable<ILookupDTO> dtos)
     {
         this.dtos = dtos;
     }

     public void BindTo(ILookupList list)
     {
         mList = list;

         mList.Clear();

         foreach (ILookupDTO dto in dtos) {
             mList.Add(dto);
         }
     }

     public int SelectedIndex {
         get { return mList.SelectedIndex; }
         set { mList.SelectedIndex = value; }
     }

     public string SelectedValue {
         get { return mList.SelectedValue; }
         set { mList.SelectedValue = value; }
     }
 } 
```

**下面是 ILookupList 的接口 - 用于每个 UI 特定控件的实现（参见下面的 web 和 wpf 示例）**

```
 public interface ILookupList
 {
     void Add(ILookupDTO dto);
     void Clear();
     int Count();
     int SelectedIndex {
         get;
         set;
     }
     string SelectedValue {
         get;
         set;
     }
 } 
```

**现在在您的代码隐藏中，您需要在视图的只读属性中执行类似的操作**

返回新的 WebLookupList(ddlUsers)

**这是特定于 Web 的 ddl 的实现**

```
 public class WebLookupList : ILookupList
 {

     private readonly ListControl listControl;

     public WebLookupList(ListControl listControl)
     {
         this.listControl = listControl;
     }

     public void Clear()
     {
         listControl.Items.Clear();
     }

     public void Add(Interfaces.ILookupDTO dto)
     {
         listControl.Items.Add(new ListItem(dto.Text, dto.Value));
     }

     public int Count()
     {
         return listControl.Items.Count;
     }

     public int SelectedIndex {
         get { return listControl.SelectedIndex; }
         set { listControl.SelectedIndex = value; }
     }

     public string SelectedValue {
         get { return listControl.SelectedValue; }
         set { listControl.SelectedValue = value; }
     }
 } 
```

****如果使用 wpf 您的视图的只读属性看起来像，****这里是 WPF 特定 ddl 的实现- Return New WPFLookupList(ddlUsers)****

 ****```
 public class WPFLookupList : ILookupList
 {

     private readonly ComboBox combobox;

     public WPFLookupList(ComboBox combobox)
     {
         this.combobox = combobox;
     }

     public void Add(Interfaces.ILookupDTO dto)
     {
         ComboBoxItem item = new ComboBoxItem();
         item.Content = dto.Text;
         item.Tag = dto.Value;

         combobox.Items.Add(item);
     }

     public void Clear()
     {
         combobox.Items.Clear();
     }

     public int Count()
     {
         return combobox.Items.Count;
     }

     public int SelectedIndex {
         get { return combobox.SelectedIndex; }
         set { combobox.SelectedIndex = value; }
     }

     public string SelectedValue {
         get { return combobox.SelectedValue.Tag; }
         set { combobox.SelectedValue.Tag = value; }
     }
 } 
```

**你一次只需要其中一个，但我认为展示这两个将有助于清楚我们正在抽象的内容**

因为这是一个巨大的答案，如果需要，我可以发布一个示例项目以供下载，以显示此操作 - 让我知道

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T14:24:32.940

我能看到这可以在.Net 2.0中完成的唯一方法是这样的

```
 List<Users> userList = dal_Users.GetAllUsers();

  foreach (Users u in userList )
  {
     ListItem li = new ListItem();
     li.Text = u.ContactDetails.Telephone;
     li.Value = u.userID.ToString();
     ddl.Items.Add(li);
  }

  ddl.DataBind(); 
```

# web - 整个网站被劫持！如何防止被劫持？

> ID：541140
> 
> 赞同：10
> 
> 时间：2009-02-12T13:01:21.033
> 
> 标签：web, duplicates, mirroring

*技术解决方案可以在这里找到*：[整个网站被劫持！第 2 部分：如何配置基于名称的虚拟主机？](https://web.archive.org/web/20090629195218/https://stackoverflow.com/questions/548355/entire-website-hijacked-part-2-how-to-configure-name-based-virtual-hosting)

* * *

原始域是[http://neteditr.com](http://neteditr.com)

有问题的模仿网站是[http://kitchen.co.jp](http://kitchen.co.jp)

在阅读了一些文章之后，似乎这种网站劫持是由代理服务器完成的，但究竟是如何从谷歌的搜索页面中删除指向“neteditr.com”的链接，而他们的“kitchen.co.jp”却很高在名单上？大约一个月前，我仍然可以进行“neteditr”搜索，并且 neteditr.com 排名第一。

到目前为止，我已经使用 Google 的 SearchWiki 删除了他们的所有条目，并添加了原始 URL，希望能够给原始域更多的权重。但这仅适用于我自己的 Google 帐户。如果我在没有登录的情况下进行通用搜索，问题仍然存在。

无论如何，我的问题是：

1.  从技术上讲，您如何防止您的网站被镜像到另一个域，我正在使用 Apache 并提供 HTML/JS/PHP/CSS 文件。

*简短的回答：你无法阻止它*

2.  如果你现在被镜像了，你会怎么做？

*简短答案：设置基于名称的虚拟主机。参见上面的技术解决方案。*

3.  谷歌从他们的搜索排名中删除了您的原始域名，并在谷歌的首页上对您的违规者的网站进行了排名。我们[受害者]可以就此向谷歌投诉吗？

*回答：在设置了基于名称的虚拟主机并且不允许有问题的域进行 HTTP 访问后，谷歌应该会自动删除他们的域名*

***编辑

以 stackoverflow.com 为例：

stackoverflow.com IP = 69.59.196.211

这与注册一个名为 stackunderflow.com 的域并将其指向 69.59.196.211 相同。在 Google 中搜索 stackoverflow 时，stackunderflow.com 位于 Google 的首页，而 stackoverflow.com 却无处可寻。他们是怎么做到的？

***编辑 2

在得知 kitchen.go.jp 指向我的原始 IP 后，我得出结论，攻击者没有使用代理服务器。通常在恶意镜像案件中，犯罪者会在镜像内容之上添加自己的广告和色情链接。我的情况并非如此。所以它可能是：

A）老实说，我认为有人只是想让您的编辑器使用日本域（可能是公司的 webfilter 政策？），没有恶意-DrJokepu

B）可能是有人想在将搜索引擎排名切换到不同的内容（即他们的）之前建立搜索引擎排名-Roland Shaw

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-12T13:35:22.450

在 Apache 中，设置[虚拟主机](http://httpd.apache.org/docs/2.2/vhosts/)。您可以禁止访问您的站点，也可以禁止`http://kitchen.co.jp/`除`http://neteditr.com/`.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-12T13:12:59.167

任何网站都可以复制；并且任何不依赖任何服务器端处理（即在客户端上完全用 Javascript 实现，以及相关的 HTML/CSS/图像）都将特别容易，原因很简单，浏览器需要能够下载所有内容，此时可以从浏览器缓存中提取（或中途拦截，或使用恶意客户端下载）。

最好的做法是联系托管副本的 ISP——他们可能需要证据证明他们抄袭了您，反之亦然。如果您让您的律师这样做（作为侵犯版权），它可能会承担更多的责任并更快地采取行动

就谷歌而言，页面排名更高，这取决于他们的算法，这将被归类为商业机密（我假设入站链接的数量在结果中起主要作用）。您可以联系他们要求他们删除这些页面，但我怀疑这会取得很大的成功，因为如果您不提供证据证明您是侵犯版权的受害者，这将是您的反对他们的话

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-12T13:10:56.940

域**kitchen.go.jp**指向**209.20.77.104**。根据 GeoIP 的说法，它位于密苏里州的圣路易斯，这意味着它位于一个拥有强大法律体系的国家，因此您可以起诉他们或向他们发送 DMCA 通知。联系律师。

更新：根据日本网卡 whois 服务 (whois.jprs.jp) 域的联系信息如下：

```
Contact Information:
a. [JPNIC Handle]               SU180JP
c. [Last, First]                Usami, Shinichi
d. [E-Mail]                     s-usami@mail.usamiplanning.co.jp
g. [Organization]               Usami Co.,Ltd.
l. [Division]                    
n. [Title]                      Vice President
o. [TEL]                        0729-48-2801
p. [FAX]                        0729-48-2807
y. [Reply Mail]                 
[Last Update]                   1999/03/04 12:51:46 (JST)
                                form@domain.nic.ad.jp 
```

你应该联系他们。老实说，我认为有人只是想让您的编辑器使用日本域（可能是公司的 webfilter 政策？），没有恶意。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T14:16:25.817

> 从技术上讲，您如何防止您的网站被镜像到另一个域，我正在使用 Apache 并提供 HTML/JS/PHP/CSS 文件。

真的没有办法做到这一点。为了让网络浏览器显示您的内容，您必须向他们发送您的所有 HTML/JS/CSS/图像，这正是有人复制您的网站所需要的。唯一不能在银盘上为他们提供服务的是 PHP。如果不让别人窃取您的网站，就无法将内容提供给您的用户。

# vb.net - 从 VB 调用 .Net 类库 (dll)

> ID：541146
> 
> 赞同：2
> 
> 时间：2009-02-12T13:04:24.990
> 
> 标签：vb.net, com, visual-studio-2005

我使用教程 ( [http://support.microsoft.com/kb/317535](http://support.microsoft.com/kb/317535) ) 创建了一个 VB.NET 类，该类导出用于计算 MD5 校验和的 COM 可见方法。

问题是我需要从类似于 VB（Extra Basic）的语言调用这个 .dll，它只支持 COM 调用。在我的机器上，一切都像一个魅力，但在目标服务器上它根本不起作用。我从“VB like”应用程序中得到“对象创建失败”。

根据教程，唯一需要做的就是使用 regasm 注册 .dll。这行不通。当我注册 .dll 时，我显然做错了。

VS2005 如何使这个 .dll 对 COM 调用可见？

我尝试使用 regsvr32，但无法注册 .dll 并显示以下消息：“xxx.dll 已加载，但未找到 DllRegisterServer 入口点。无法注册此文件”

最好的问候奥斯加尔

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T13:42:31.560

不能使用 Regsvr32.exe，需要 Regasm.exe。您必须使用 /codebase 命令行参数运行它，或者在 GAC 中安装程序集。我认为那是你的问题。

这类注册问题总是很麻烦，至少因为它们需要安装程序而不是 Xcopy.exe。如果版本不正确，则调用 DLL Hell。如果您不使用 GAC，您将不会这样做。考虑使用包含 <clrClass> 元素的清单。采取第一个谷歌命中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T13:12:01.460

您是否尝试过使用 注册 COM DLL [`regsvr32`](http://en.wikipedia.org/wiki/Regsvr32)？我不知道是否`regasm`会自动执行此操作，但显然不会。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T13:24:55.347

听起来您没有在服务器上安装或运行应用程序所需的所有项目。需要注意的一些事情是：

1.  是否安装了 .NET Framework？
2.  确保 COM 正常工作。一些基本的尝试是：
    *   在写字板文档中插入对象。
    *   如果您可以运行 WSCript，请运行一个创建对象的简单 vbscript。
    *   在您的 EXE 上运行[Dependency Walker](http://www.dependencywalker.com/)并确保您拥有所需的一切。
3.  如果上述方法没有让您继续前进，您可以使用[Sysinternals ProcMon](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)来查看您的应用程序正在访问哪些文件和注册表项（并且可能没有找到）。这应该为您提供有关正在发生的事情的线索。

# geometry - 连接两个线段

> ID：541150
> 
> 赞同：8
> 
> 时间：2009-02-12T13:07:06.293
> 
> 标签：geometry

给定两条二维线段 A 和 B，我如何计算连接 A 和 B 的最短二维线段 C 的长度？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-12T13:57:16.190

考虑您的两条线段 A 和 B 分别由两个点表示：

由 A1(x,y)、A2(x,y) 表示的 A 线

线 B 由 B1(x,y) B2(x,y) 表示

首先使用此算法检查两条线是否相交。

**如果它们确实相交**，则两条线之间的距离为零，连接它们的线段就是交点。

**如果它们不相交**，请使用此方法：[http](http://paulbourke.net/geometry/pointlineplane/) ://paulbourke.net/geometry/pointlineplane/计算以下之间的最短距离：

1.  点 A1 和线 B
2.  A2点和B线
3.  B1点和A线
4.  B2点和A线

这四个线段中最短的就是你的答案。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-12T13:12:00.760

[此页面](http://homepage.univie.ac.at/Franz.Vesely/notes/hard_sticks/hst/hst.html)包含您可能正在寻找的信息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-07-11T07:30:37.690

[使用上述Afterlife](https://stackoverflow.com/users/36848/alterlife)和[Rob Parker](https://stackoverflow.com/users/181460/rob-parker)算法的一般思想，这是一组方法的 C++ 版本，用于获取 2 个任意 2D 段之间的最小距离。这将处理重叠段、平行段、相交和非相交段。此外，它使用各种 epsilon 值来防止浮点不精确。最后，除了返回最小距离外，该算法还将为您提供最接近线段 2 的线段 1 上的点（如果线段相交，这也是交点）。如果需要，也可以返回最接近 [p1,p2] 的 [p3,p4] 上的点，但我将把它作为练习留给读者:)

```
// minimum distance (squared) between vertices, i.e. minimum segment length (squared)
#define EPSILON_MIN_VERTEX_DISTANCE_SQUARED 0.00000001

// An arbitrary tiny epsilon.  If you use float instead of double, you'll probably want to change this to something like 1E-7f
#define EPSILON_TINY 1.0E-14

// Arbitrary general epsilon.  Useful for places where you need more "slop" than EPSILON_TINY (which is most places).
// If you use float instead of double, you'll likely want to change this to something like 1.192092896E-04
#define EPSILON_GENERAL 1.192092896E-07

bool AreValuesEqual(double val1, double val2, double tolerance)
{
    if (val1 >= (val2 - tolerance) && val1 <= (val2 + tolerance))
    {
        return true;
    }

    return false;
}

double PointToPointDistanceSquared(double p1x, double p1y, double p2x, double p2y)
{
    double dx = p2x - p1x;
    double dy = p2y - p1y;
    return (dx * dx) + (dy * dy);
}

double PointSegmentDistanceSquared( double px, double py,
                                    double p1x, double p1y,
                                    double p2x, double p2y,
                                    double& t,
                                    double& qx, double& qy)
{
    double dx = p2x - p1x;
    double dy = p2y - p1y;
    double dp1x = px - p1x;
    double dp1y = py - p1y;
    const double segLenSquared = (dx * dx) + (dy * dy);
    if (AreValuesEqual(segLenSquared, 0.0, EPSILON_MIN_VERTEX_DISTANCE_SQUARED))
    {
        // segment is a point.
        qx = p1x;
        qy = p1y;
        t = 0.0;
        return ((dp1x * dp1x) + (dp1y * dp1y));
    }
    else
    {
        t = ((dp1x * dx) + (dp1y * dy)) / segLenSquared;
        if (t <= EPSILON_TINY)
        {
            // intersects at or to the "left" of first segment vertex (p1x, p1y).  If t is approximately 0.0, then
            // intersection is at p1\.  If t is less than that, then there is no intersection (i.e. p is not within
            // the 'bounds' of the segment)
            if (t >= -EPSILON_TINY)
            {
                // intersects at 1st segment vertex
                t = 0.0;
            }
            // set our 'intersection' point to p1.
            qx = p1x;
            qy = p1y;
            // Note: If you wanted the ACTUAL intersection point of where the projected lines would intersect if
            // we were doing PointLineDistanceSquared, then qx would be (p1x + (t * dx)) and qy would be (p1y + (t * dy)).
        }
        else if (t >= (1.0 - EPSILON_TINY))
        {
            // intersects at or to the "right" of second segment vertex (p2x, p2y).  If t is approximately 1.0, then
            // intersection is at p2\.  If t is greater than that, then there is no intersection (i.e. p is not within
            // the 'bounds' of the segment)
            if (t <= (1.0 + EPSILON_TINY))
            {
                // intersects at 2nd segment vertex
                t = 1.0;
            }
            qx = p2x;
            qy = p2y;
            // Note: If you wanted the ACTUAL intersection point of where the projected lines would intersect if
            // we were doing PointLineDistanceSquared, then qx would be (p1x + (t * dx)) and qy would be (p1y + (t * dy)).
        }
        else
        {
            // The projection of the point to the point on the segment that is perpendicular succeeded and the point
            // is 'within' the bounds of the segment.  Set the intersection point as that projected point.
            qx = ((1.0 - t) * p1x) + (t * p2x);
            qy = ((1.0 - t) * p1y) + (t * p2y);
            // for debugging
            //ASSERT(AreValuesEqual(qx, p1x + (t * dx), EPSILON_TINY));
            //ASSERT(AreValuesEqual(qy, p1y + (t * dy), EPSILON_TINY));
        }
        // return the squared distance from p to the intersection point.
        double dpqx = px - qx;
        double dpqy = py - qy;
        return ((dpqx * dpqx) + (dpqy * dpqy));
    }
}

double SegmentSegmentDistanceSquared(   double p1x, double p1y,
                                        double p2x, double p2y,
                                        double p3x, double p3y,
                                        double p4x, double p4y,
                                        double& qx, double& qy)
{
    // check to make sure both segments are long enough (i.e. verts are farther apart than minimum allowed vert distance).
    // If 1 or both segments are shorter than this min length, treat them as a single point.
    double segLen12Squared = PointToPointDistanceSquared(p1x, p1y, p2x, p2y);
    double segLen34Squared = PointToPointDistanceSquared(p3x, p3y, p4x, p4y);
    double t = 0.0;
    double minDist2 = 1E+38;
    if (segLen12Squared <= EPSILON_MIN_VERTEX_DISTANCE_SQUARED)
    {
        qx = p1x;
        qy = p1y;
        if (segLen34Squared <= EPSILON_MIN_VERTEX_DISTANCE_SQUARED)
        {
            // point to point
            minDist2 = PointToPointDistanceSquared(p1x, p1y, p3x, p3y);
        }
        else
        {
            // point - seg
            minDist2 = PointSegmentDistanceSquared(p1x, p1y, p3x, p3y, p4x, p4y);
        }
        return minDist2;
    }
    else if (segLen34Squared <= EPSILON_MIN_VERTEX_DISTANCE_SQUARED)
    {
        // seg - point
        minDist2 = PointSegmentDistanceSquared(p3x, p3y, p1x, p1y, p2x, p2y, t, qx, qy);
        return minDist2;
    }

    // if you have a point class and/or methods to do cross products, you can use those here.
    // This is what we're actually doing:
    // Point2D delta43(p4x - p3x, p4y - p3y);    // dir of p3 -> p4
    // Point2D delta12(p1x - p2x, p1y - p2y);    // dir of p2 -> p1
    // double d = delta12.Cross2D(delta43);
    double d = ((p4y - p3y) * (p1x - p2x)) - ((p1y - p2y) * (p4x - p3x));
    bool bParallel = AreValuesEqual(d, 0.0, EPSILON_GENERAL);

    if (!bParallel)
    {
        // segments are not parallel.  Check for intersection.
        // Point2D delta42(p4x - p2x, p4y - p2y);    // dir of p2 -> p4
        // t = 1.0 - (delta42.Cross2D(delta43) / d);
        t = 1.0 - ((((p4y - p3y) * (p4x - p2x)) - ((p4y - p2y) * (p4x - p3x))) / d);
        double seg12TEps = sqrt(EPSILON_MIN_VERTEX_DISTANCE_SQUARED / segLen12Squared);
        if (t >= -seg12TEps && t <= (1.0 + seg12TEps))
        {
            // inside [p1,p2].   Segments may intersect.
            // double s = 1.0 - (delta12.Cross2D(delta42) / d);
            double s = 1.0 - ((((p4y - p2y) * (p1x - p2x)) - ((p1y - p2y) * (p4x - p2x))) / d);
            double seg34TEps = sqrt(EPSILON_MIN_VERTEX_DISTANCE_SQUARED / segLen34Squared);
            if (s >= -seg34TEps && s <= (1.0 + seg34TEps))
            {
                // segments intersect!
                minDist2 = 0.0;
                qx = ((1.0 - t) * p1x) + (t * p2x);
                qy = ((1.0 - t) * p1y) + (t * p2y);
                // for debugging
                //double qsx = ((1.0 - s) * p3x) + (s * p4x);
                //double qsy = ((1.0 - s) * p3y) + (s * p4y);
                //ASSERT(AreValuesEqual(qx, qsx, EPSILON_MIN_VERTEX_DISTANCE_SQUARED));
                //ASSERT(AreValuesEqual(qy, qsy, EPSILON_MIN_VERTEX_DISTANCE_SQUARED));
                return minDist2;
            }
        }
    }

    // Segments do not intersect.   Find closest point and return dist.   No other way at this
    // point except to just brute-force check each segment end-point vs opposite segment.  The
    // minimum distance of those 4 tests is the closest point.
    double tmpQx, tmpQy, tmpD2;
    minDist2 = PointSegmentDistanceSquared(p3x, p3y, p1x, p1y, p2x, p2y, t, qx, qy);
    tmpD2 = PointSegmentDistanceSquared(p4x, p4y, p1x, p1y, p2x, p2y, t, tmpQx, tmpQy);
    if (tmpD2 < minDist2)
    {
        qx = tmpQx;
        qy = tmpQy;
        minDist2 = tmpD2;
    }
    tmpD2 = PointSegmentDistanceSquared(p1x, p1y, p3x, p3y, p4x, p4y, t, tmpQx, tmpQy);
    if (tmpD2 < minDist2)
    {
        qx = p1x;
        qy = p1y;
        minDist2 = tmpD2;
    }
    tmpD2 = PointSegmentDistanceSquared(p2x, p2y, p3x, p3y, p4x, p4y, t, tmpQx, tmpQy);
    if (tmpD2 < minDist2)
    {
        qx = p2x;
        qy = p2y;
        minDist2 = tmpD2;
    }

    return minDist2;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-12T13:12:23.067

[Gernot Hoffmann](http://www.fho-emden.de/~hoffmann/ "格诺特霍夫曼")论文（算法和 Pascal 代码）：

[http://www.fho-emden.de/~hoffmann/xsegdist03072004.pdf](http://www.fho-emden.de/~hoffmann/xsegdist03072004.pdf)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-12T13:16:37.800

快速提示：如果您想根据点比较距离，则无需计算平方根。

例如，要查看 P-to-Q 的距离是否小于 Q-to-R，只需检查（伪代码）：

```
square(P.x-Q.x) + square(P.y-Q.y) < square(Q.x-R.x) + square(Q.y-R.y) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-15T21:54:30.390

Afterlife 说，“首先使用这个算法检查两条线是否相交”，但他没有说明他的意思是什么算法。显然，重要的是*线段*的交点而不是延长线；任何非平行线段（不包括未定义线的重合端点）都将相交，但线段之间的距离不一定为零。所以我认为他的意思是“线段”而不是“线”。

Afterlife 给出的链接是一种非常优雅的方法，可以找到一条线（或线段，或射线）上与另一个任意点的最近点。这适用于查找从每个端点到另一条线段的距离（将计算的参数 u 限制为对于线段或射线不小于 0，对于线段不大于 1），但它不处理一条线段上的内部点比任一端点更近的可能性，因为它们实际上相交，因此需要对相交进行额外检查。

至于确定线段交点的算法，一种方法是找到延长线的交点（如果平行则完成），然后确定该点是否在两条线段内，例如通过取从交点 T 到两个端点的向量的点积：

((Tx - A1x) * (Tx - A2x)) + ((Ty - A1y) * (Ty - A2y))

如果这是负数（或“零”），则 T 在 A1 和 A2 之间（或在一个端点处）。类似地检查其他线段。如果任一大于“零”，则线段不相交。当然，这取决于首先找到延长线的交点，这可能需要将每条线表示为方程并通过高斯归约（等）求解系统。

但可能有一种更直接的方法，无需求解交点，即取向量 (B1-A1) 和 (B2-A1) 的叉积以及向量 (B1-A2) 和(B2-A2)。如果这些叉积在同一方向，则 A1 和 A2 在 B 线的同一侧；如果它们在相反的方向上，那么它们在 B 线的相对两侧（如果为 0，则一个或两个都*在*B 线上）。同样检查向量 (A1-B1) 和 (A2-B1) 以及 (A1-B2) 和 (A2-B2) 的叉积。如果这些叉积中的任何一个为“零”，或者*两条*线段的端点都落在另一条线的相对两侧，则线段本身必须相交，否则它们不会相交。

当然，您需要一个方便的公式来计算两个向量坐标的叉积。或者，如果您可以确定角度（正或负），则不需要实际的叉积，因为它是我们实际关心的向量之间的角度方向（或角度的正弦，真的） . 但我认为叉积（二维）的公式很简单：

交叉(V1,V2) = (V1x * V2y) - (V2x * V1y)

这是 3-D 叉积向量的 z 轴分量（其中 x 和 y 分量必须为零，因为初始向量在平面 z=0 中），因此您可以简单地查看符号（或“零”）。

因此，您可以使用这两种方法之一来检查 Afterlife 描述的算法中的线段相交（参考链接）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-12T13:19:22.787

[这个页面](http://www.mathhelpforum.com/math-help/advanced-geometry/30770-shortest-distance-between-two-lines.html)有一个很好的简短描述，用于查找两行之间的最短距离，尽管@strager 的链接包含一些代码（在 Fortran 中！）

# c# - 当我的应用程序抛出错误时，显示 windows 错误对话框

> ID：541165
> 
> 赞同：0
> 
> 时间：2009-02-12T13:13:25.810
> 
> 标签：c#, windows

我在 c#.net 中开发 Windows 窗体应用程序。有时我的程序会抛出一个错误，显示 windows 错误对话框（请告诉微软这个问题，发送错误报告，不要发送，bla bla ...）。我不知道为什么显示此对话框。我的程序发生了什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T13:18:32.973

> 我不知道为什么显示此对话框。

因为你没有在你的程序中处理异常，说明一个bug。Windows 的默认手段是显示的对话框。您的工作是防止或处理代码中的所有潜在异常，Windows 不会为您执行此操作（或者更确切地说，它会执行；只是不符合您的喜好）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T14:39:05.230

只是为了扩展康拉德的答案。您可以使用[try..catch](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2F0yd65esw(VS.80).aspx&ei=ezSUScmRAZCCNYW7sfML&usg=AFQjCNEPInhXT3WaFjvHl6S0Kyir_WCSiw&sig2=Eji7qxuhQLKlBHCSqZRaYQ)处理预期的错误。

```
try
{
    // operation that may throw an error
}
catch(Exception ex)
{
    // handle the exception. 
    // You might tell the user about the error with a messagebox
} 
```

# windows - WinAPI - 如何绘制虚线？

> ID：541166
> 
> 赞同：4
> 
> 时间：2009-02-12T13:13:26.123
> 
> 标签：windows, winapi, gdi

我使用 WinAPI GDI 方法创建 HPEN：

`HPEN hPen = CreatePen(PS_DOT, 1, color);`

然后使用方法`MoveToEx`和画线`LineTo`。

事实上画线是*虚线*。3 个空像素，3 个带颜色像素——虚线。

为什么 PS_DOT 样式不画虚线？如何使用 WinAPI 绘制虚线？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T14:00:10.723

这是我在 CodeProject
( [http://www.codeproject.com/KB/GDI/DOTTED_PEN.aspx](http://www.codeproject.com/KB/GDI/DOTTED_PEN.aspx) )上找到的 MaxHacher 的绝妙解决方案

`LOGBRUSH LogBrush;
LogBrush.lbColor = color;
LogBrush.lbStyle = PS_SOLID;
HPEN hPen = ExtCreatePen( PS_COSMETIC | PS_ALTERNATE, 1, &LogBrush, 0, NULL );`

它运作良好！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T13:27:43.640

我过去也有这个问题。我求助于使用 LineDDA 和回调过程。

```
struct LineData{
    CDC* pDC;
    COLORREF crForegroundColor;
    COLORREF crBackgroundColor;
};
.
.
.
LineData* pData = new LineData;
pData->crForegroundColor = crForegroundColor;
pData->crBackgroundColor = crBackgroundColor;
pData->pDC = pdc;

LineDDA(nStartx, nStarty, nEndPointX, nEndPointY, LineDDAProc, (LPARAM) pData);
delete pData;
.
.
.

void 
LineDDAProc(int x, int y, LPARAM lpData)
{
   static short nTemp = 0;

   LineData* pData = (LineData*) lpData;

   if (nTemp == 1)
    pData->pDC->SetPixel(x, y, pData->crForegroundColor);
   else
    pData->pDC->SetPixel(x, y, pData->crBackgroundColor);
   nTemp = (nTemp + 1) % 2;
} 
```

可能不是最有效的绘图算法，但您现在也可以完全控制点间距。我采用这种方法是因为我使用了其他非原生笔样式来进行线条渲染，它们使用了位模式。然后我走位并使用 setpixel 作为“on”位。它运行良好并增加了有用的线条样式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T13:22:19.020

我还没有尝试过，但可能值得检查结果

`HPEN hPen = CreatePen(PS_DOT, 0, color);`

笔宽为零会导致 GDI 始终使笔宽 1 个像素，而不管与设备上下文相关的缩放比例如何。这可能足以获得您想要的点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-10-16T13:58:18.843

我用这个而不是上面的来避免连续两个像素

```
void LineDDAProc(int x, int y, LPARAM lpData)
{
   LineData* pData = (LineData*) lpData;

   if (x%2!=y%2)
    pData->pDC->SetPixel(x, y, pData->crForegroundColor);
} 
```

# javascript - JavaScript 中“this”关键字行为的基本原理是什么？

> ID：541167
> 
> 赞同：8
> 
> 时间：2009-02-12T13:14:30.537
> 
> 标签：javascript, language-design

我是从语言设计的角度来问这个的。所以我试图找出

1.  的行为的基本原理是`this`什么？
2.  的行为在多大程度上`this`是错误的，或者可以改进？

* * *

为了澄清我为什么不安`this`，请考虑以下示例：

```
var a = {};
a.f = function(){ return this; }
var f = a.f;
// f() != a.f() 
```

注意`f()`所属的对象是多么容易丢失：从`a`,分离`this`成为全局对象（`window`对于浏览器）。

现在考虑：

```
var newA = function(){
    var self = {};
    self.f = function(){ return self; }
    return self;
}

var a = newA();
var f = a.f;
// f() == a.f() ! 
```

根本不使用`this`，我们能够建立和维护对象上下文，而不管方法在哪里或如何使用。我不禁想到，凭借闭包提供的力量，它`this`变得多余，甚至可能有点危险......

我不是针对 的仇杀`this`，也不是要开始争论；我只是想更好地理解它。我确实很欣赏“this”可能很有用，但也认识到[它也可能令人困惑](http://groups.google.com/group/comp.lang.javascript/browse_thread/thread/c95c2d8eb232e466#dad2785d7263e699)......当然会让初学者感到困惑，也许在足够模糊的情况下也会让专家感到困惑。

`with`然而，在该语言的其他核心方面似乎可以回避（即 Crockford 和or `new`）的时代，它仍然是该语言中一个被大量使用且似乎备受推崇的部分。那我错过了什么，那是`this`必不可少的吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-12T16:11:55.960

您似乎期望它的行为与某些 OO 语言中的行为一样，它总是指方法所属的对象。

但是在 JavaScript 中，一个*函数*可以附加到多个对象，或者根本没有对象。在您的示例中，您编写了一个旨在在*一个特定对象*的上下文中使用的函数......但是没有什么能阻止我采用该函数并将其附加到任何其他对象。这就是语言的本质——函数是一流的，对象成员是可选的。

因此，*this*指的是调用函数的上下文。现在，它要么是任意对象（通过`.`、`.apply`或指定`.call()`），要么是全局对象。在该语言的未来版本中，它将引用定义函数的上下文：全局函数的全局对象，`this`内部函数的外部对象；您可以将其视为对设计缺陷的更正，因为在实践中能够使用 this 引用全局对象并不是特别有用。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-12T15:50:47.600

我不认为使“这个”不受约束是一个错误。起初有时可能会令人困惑，但它的方式有充分的理由。首先想到的是，由于 JavaScript 不是基于类的语言，函数不与任何特定的类相关联，因此没有一致的方式将“this”自动绑定到正确的对象实例。例如，

```
function Person(first, last, age) {
    this.firstName = first;
    this.lastName = last;
    this.age = age;
}

Person.prototype.getFullName = function() {
    return this.firstName + " " + this.lastName;
}; 
```

"this" 需要引用一个 Person 对象，但是分配给 Person.prototype.getName 的函数没有任何方法知道它将如何使用，因此 "this" 需要绑定到它所调用的任何对象在。

当你有嵌套函数时，这会导致问题。

```
// This is a really contrived example, but I can't think of anything better
Person.prototype.getInfo = function() {
    // get name as "Last, First"
    function getNameLastFirst() {
        // oops. "this" is the global object, *not* the Person
        return this.lastName + ", " + this.firstName;
    }

    // expect something like "Crumley, Matthew: Age 25",
    // but you get "undefined, undefined: Age 25"
    return getNameLastFirst() + ": Age " + this.age;
}; 
```

建议的语法[人工](https://stackoverflow.com/questions/541167/what-are-the-good-and-bad-points-of-the-this-keyword-in-javascript/541304#541304)白痴会很方便，但使用 apply 将“this”绑定到特定对象非常容易：

```
function bind(func, obj) {
    return function() {
        return func.apply(obj, arguments);
    };
}

Person.prototype.getInfo = function() {
    // get name as "Last, First"
    var getNameLastFirst = bind(function () {
        return this.lastName + ", " + this.firstName;
    }, this);

    return getNameLastFirst() + ": Age " + this.age;
}; 
```

或更“传统”的使用闭包的方法：

```
Person.prototype.getInfo = function() {
    var self = this;

    // get name as "Last, First"
    function getNameLastFirst() {
        return self.lastName + ", " + self.firstName;
    }

    return getNameLastFirst() + ": Age " + this.age;
}; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T13:21:26.430

*   不是
*   很多面向对象的东西
*   它的方式很好

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-12T13:47:58.630

我认为未绑定的“this”是一个错误。否则它非常方便。未绑定的“this”打开了误解浏览器事件处理中最明显的上下文的可能性。此外，javascript 库对“this”在事件处理和许多回调构造（如映射、过滤器）中应指的内容有不同的看法。

删除未绑定的“this”可能不会让事情变得更加困难。

编辑：我想一个替代语法示例将使我的立场更清晰。

```
function Foo()
{
    //both this refer to the Foo instance
    this.blah=this.function(){this.bar;};

    //second this refers to baz
    this.blah=baz.function(){this.bar;};

    //second this refers to anonymous function itself
    this.blah=function(){this.bar;};
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T13:35:21.763

*   它应该被称为“自我”
*   任何引用当前对象状态的东西。
*   通过选择“self”作为“this”的名称，并将其显式（作为第一个参数）传递给所有方法。通过这种方式，您可以轻松地将实例方法与静态方法或函数区分开来。

抱歉，但我真的很喜欢 Python ;-)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T16:07:15.643

我*认为*未绑定的“this”关键字是必要的，因为 JavaScript 是一种基于原型的语言。消息灵通的人可能可以在此处填写详细信息。

事实是，虽然非常无益。尤其是如果您想将对象的方法传递给高阶函数，事情就会变得很糟糕（以下示例在 MooTools 的帮助下）：

```
myArray.each(myObject.foo); 
```

将不起作用，因为 myObject.foo 中的“this”将引用 myArray 而不是 myObject。反而：

```
myArray.each(myObject.foo.bind(myObject)) 
```

这对我来说似乎很丑陋。这就是为什么我通常不在 JavaScript 中以面向对象的方式进行编程，而是我非常依赖闭包。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-12T16:08:24.550

将成语`a.f()`视为以下的简写：

```
a.f.call(a); 
```

根据定义，它是对函数的调用`f`，使用范围`a`。

```
var f = a.f;
f(); // f.call(this);
a.f(); // f.call(a); 
```

如果`this`和`a`不是同一个对象，`f()`并且`a.f()`将使用不同的作用域，因此可能表现不同。考虑其他语言中静态方法和类方法之间的区别：

```
class Foo {
public:
    static void a(Foo *scope) {
        // do something with given scope
    };

    void b() {
        a(this); // do something with the scope of this object
    };
};

Foo foo;
Foo bar;

foo.a(&bar) != foo.b(); // just like f() != a.f()
foo.a(&foo) == foo.b(); // just like f.call(a) == a.f() 
```

# c# - C#：比较两个 Linq2Sql 实体不起作用？

> ID：541169
> 
> 赞同：1
> 
> 时间：2009-02-12T13:15:02.920
> 
> 标签：c#, linq-to-sql

谁能向我解释为什么这不起作用？

在数据库中，我们有带 IdEmployee 列的员工。我们还有一些带有外键的表。

假设我们有这样的事情：

```
var employee = dataContext.Employees.First(<some predicate>);
var someEntity = dataContext.SomeEntities.First(<some predicate>); 
```

为什么这不起作用：

```
var something = someEntity.SomeThings.First(t => t.Employee == employee); 
```

虽然这样做：

```
var something = someEntity.SomeThings.First(t => t.IdEmployee == employee.IdEmployee); 
```

我不明白...不是第一个版本应该工作吗？Employee 实体来自相同的数据上下文......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T13:18:46.530

编辑：前面的解释是错误的，因为“它适用于我的机器”：

```
var contract = dataContext.Contracts.First();
var room = dataContext.Rooms.First(r => r.Contract == contract); 
```

您的班级之间的关联必须被打破。

您可以通过使用获取执行的命令

```
 var command = dataContext.GetCommand(
         dataContext.Rooms.Where(r => r.Contract == contract))
     .CommandText; 
```

生成的命令文本是：

```
SELECT ...    FROM [Rooms] AS [t0]
WHERE [t0].[ContractId] = @p0 
```

所以我们可以看到主键是从实体类型中找到的...

* * *

> 第一个版本不应该工作吗？Employee 实体来自相同的数据上下文......

是的，但是 lambda 表达式被转换为 SQL 脚本，而且似乎 linq Sql 脚本生成器并没有尝试找到实体键来生成请求。

linq to Sql 命令构建器使用 lambda 内容作为 Expression<> 树来构建查询文本。要执行此操作，它期望 lambda 包含引用实体属性的表达式。

这里的问题似乎是它引用了实体本身而不是那里的属性。

以下查询

```
var something = someEntity.SomeThings
    .First(t => t.IdEmployee == employee.IdEmployee); 
```

产生类似于

```
SELECT ... FROM SomThings
WHERE IdEmployee = @idEmployee 
```

使用 lambda 中的属性名称找到表列。

在另一种情况下，没有属性名称......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T14:04:11.507

因为延迟加载。someEntity.Employee 属性不是从数据库加载的。如果你还想加载它，你应该在从数据库中检索数据之前使用“DataLoadOptions”，语法如下：

```
DataLoadOptions options = new DataLoadOptions();
  options.LoadWith<SomeThing>(s=>SomeProperty);
  dataContext.LoadOptions = options; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T13:19:04.800

我认为第一个不起作用，因为类型不同，但在第二个中它们不是（你在第二个中处理整数）。

您应该重写 Equals（和 GetHashCode）方法以实现您自己的相等比较。

* * *

编辑

正如您所指出的，*它们必须是相同的类型，否则会在 compile-time 失败*，但我坚持认为实现自己的 Equals 和 GetHashCode 函数可能会很方便。我认为你的问题出在那儿。我现在可以回忆起该链接，但我在某处读到过 .NET 中的相等比较有点棘手。

检查这个例子：

```
using System;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            Employee a = new Employee(1);
            Employee b = new Employee(1);

            Console.WriteLine("a == b := {0}", a == b);
            Console.ReadLine();
        }
    }

    class Employee
    {
        private int id;

        public Employee(int id) { this.id = id; }
    }
} 
```

输出是：

```
a == b := False 
```

这是因为 .NET 在[`GetHashCode`](http://msdn.microsoft.com/en-us/library/system.object.gethashcode.aspx)内部[`Equals`](http://msdn.microsoft.com/en-us/library/system.object.equals.aspx)使用`Object`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T13:21:43.577

`SomeThings`确定何时使用和之类的名称有点棘手`someEntity`，但我相信正在发生的是，当您查看时`someEntity.SomeThings`，`SomeThings`是`Employee`实体的集合。因此，`t`您的 lambda 表达式中的 将引用一个`Employee`对象，使您能够比较它们的属性。

尝试以下

```
var something = someEntity.SomeThings.First(t => t.Equals(employee)); 
```

看看是否效果更好。

编辑：实际上，`.Equals()`语法比`==`我第一次提出的要好......

* * *

EDIT2：正如 Sessiz Saas 建议的那样，这可能是因为延迟加载。下面提供了另一种加载员工对象的方法：

```
var myThings = dataContext.Things.Include("employee"); 
```

但是，请记住，这可能会导致额外的（并且是不必要的，因为无论如何您都可以完成这项工作）数据调用。

# xml - 为什么 MSXML 中的 createProcessingInstruction 会生成不完整的输出？

> ID：541174
> 
> 赞同：6
> 
> 时间：2009-02-12T13:18:25.860
> 
> 标签：xml, vba, ms-access, msxml

以下 VBA 代码生`<?xml version="1.0"?>`成为输出。

```
Dim XML As New DomDocument 
Dim pi As IXMLDOMProcessingInstruction

'.... some code that sets the root element of the document

Set pi = XML.createProcessingInstruction("xml", "version='1.0' encoding='UTF-8'")
        XML.insertBefore pi, XML.documentElement 
```

为什么`encoding="UTF-8"`左撇子？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-12T15:34:42.930

<?xml?>*不是*处理指令。<?xml?> 构造称为[XML 声明](http://www.w3.org/TR/REC-xml/#sec-prolog-dtd)，它遵循与实际处理指令不同的规则。创建名称为“xml”的 PI 格式不正确；以“xml”开头的名称是[保留](http://www.w3.org/TR/REC-xml/#dt-pi)的。

要更改序言的格式，您需要[配置一个 XMLWriter](http://msdn.microsoft.com/en-us/library/ms759110(VS.85).aspx)，设置 'version'、'encoding' 或简单地 'omitXMLDeclaration' 以完全删除它，这非常好，因为 1.0 和 UTF-8 是默认值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T13:29:36.677

无论如何，UTF-8 是默认编码。您指定的内容是多余的，因此序列化程序可能会忽略它。但是，该`version`字段不是可选字段。如果文件有 XML 声明，[则声明必须包含`version`字段](http://www.w3.org/TR/REC-xml/#sec-prolog-dtd)。

# gridview - Gridview 列宽变化

> ID：541177
> 
> 赞同：0
> 
> 时间：2009-02-12T13:18:52.180
> 
> 标签：gridview, width, datasource

我有一个gridview，它的数据源是一个oracle 数据库。我想知道在 Web 浏览器中显示时如何更改列宽（在 gridview 中）。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-15T03:20:53.280

您可以直接使用 GridView 标签设置列：

```
<asp:GridView ID="myGrid" runat="server">
  <Columns>
    <asp:BoundField DataField="myColumn" ControlStyle-Width="25%" />
  </Columns>
</asp:GridView> 
```

您还可以为列分配 CSS 类，然后使用 CSS 设置列宽。

# c# - 高效检索和过滤文件

> ID：541181
> 
> 赞同：3
> 
> 时间：2009-02-12T13:19:42.207
> 
> 标签：c#, linq, performance, file

这个[较早的SO问题](https://stackoverflow.com/questions/163162/can-you-call-directory-getfiles-with-multiple-filters)讨论了如何检索目录树中与多个扩展名之一匹配的所有文件。

例如。检索 C:\ 和所有子目录中的所有文件，匹配 *.log、*.txt、*.dat。

接受的答案是这样的：

```
var files = Directory.GetFiles("C:\\path", "*.*", SearchOption.AllDirectories)
            .Where(s => s.EndsWith(".mp3") || s.EndsWith(".jpg")); 
```

这让我觉得效率很低。如果您在包含数千个文件的目录树上搜索（它使用 SearchOption.AllDirectories），则指定目录树中的每个文件都会加载到内存中，然后才会删除不匹配的内容。（让我想起了 ASP.NET 数据网格提供的“分页”。）

不幸的是，标准的 System.IO.DirectoryInfo.GetFiles 方法一次只接受一个过滤器。

可能只是我缺乏Linq知识，我提到的方式实际上效率低下吗？

其次，有没有更有效的方法可以在使用和不使用 Linq 的情况下执行此操作（无需多次调用 GetFiles）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T14:23:10.280

我分享了您的问题，并在 Matthew Podwysocki 在 codebetter.com 上的出色帖子中找到了[解决](http://codebetter.com)[方案](http://codebetter.com/blogs/matthew.podwysocki/archive/2008/10/16/functional-net-fighting-friction-in-the-bcl-with-directory-getfiles.aspx)。

他使用本机方法实现了一个解决方案，允许您在他的 GetFiles 实现中提供谓词。此外，他使用 yield 语句实现了他的解决方案，有效地将每个文件的内存使用率降至最低。

使用他的代码，您可以编写如下内容：

```
var allowedExtensions = new HashSet<string> { ".jpg", ".mp3" };

var files = GetFiles(
    "C:\\path", 
    SearchOption.AllDirectories, 
    fn => allowedExtensions.Contains(Path.GetExtension(fn))
); 
```

files 变量将指向一个枚举器，该枚举器返回匹配的文件（延迟执行样式）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T13:23:11.233

您对内存消耗是正确的。但是，我认为这是一个相当过早的优化。加载几千个字符串的数组完全没有问题，无论是性能还是内存消耗。然而，读取包含这么多文件的目录*是*- 无论您如何存储/过滤文件名：它总是相对较慢。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T13:27:39.787

如何创建自己的目录遍历函数并使用[C#`yield`运算符](http://msdn.microsoft.com/en-us/library/9k7k7cf0.aspx)？

编辑：我做了一个简单的测试，我不知道它是否正是你需要的。

```
class Program
{
    static string PATH = "F:\\users\\llopez\\media\\photos";

    static Func<string, bool> WHERE = s => s.EndsWith(".CR2") || s.EndsWith(".html");

    static void Main(string[] args)
    {
        using (new Profiler())
        {
            var accepted = Directory.GetFiles(PATH, "*.*", SearchOption.AllDirectories)
                .Where(WHERE);

            foreach (string f in accepted) { }
        }

        using (new Profiler())
        {
            var files = traverse(PATH, WHERE);

            foreach (string f in files) { }
        }

        Console.ReadLine();
    }

    static IEnumerable<string> traverse(string path, Func<string, bool> filter)
    {
        foreach (string f in Directory.GetFiles(path).Where(filter))
        {
            yield return f;
        }

        foreach (string d in Directory.GetDirectories(path))
        {
            foreach (string f in traverse(d, filter))
            {
                yield return f;
            }
        }
    }
}

class Profiler : IDisposable
{
    private Stopwatch stopwatch;

    public Profiler()
    {
        this.stopwatch = new Stopwatch();
        this.stopwatch.Start();
    }

    public void Dispose()
    {
        stopwatch.Stop();
        Console.WriteLine("Runing time: {0}ms", this.stopwatch.ElapsedMilliseconds);
        Console.WriteLine("GC.GetTotalMemory(false): {0}", GC.GetTotalMemory(false));
    }
} 
```

我知道您不能过多地依赖[`GC.GetTotalMemory`](http://msdn.microsoft.com/en-us/library/system.gc.gettotalmemory(VS.71).aspx)内存分析，但在我的所有测试运行中，显示的内存消耗都少了一点（100K）。

```
运行时间：605ms
GC.GetTotalMemory（假）：3444684
运行时间：577ms
GC.GetTotalMemory（假）：3293368
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T13:27:56.620

GetFiles 方法只读取文件名，而不是文件内容，因此虽然读取所有名称可能会很浪费，但我认为这没什么好担心的。

据我所知，唯一的选择是进行多次 GetFiles 调用并将结果添加到集合中，但这会变得笨拙，并且需要您多次扫描文件夹，所以我怀疑它也会更慢。

# javascript - jQuery - 关于“nextWhile”遍历的建议？

> ID：541189
> 
> 赞同：5
> 
> 时间：2009-02-12T13:22:09.363
> 
> 标签：javascript, jquery, jquery-selectors, traversal

jQuery 目前有`.next(filter)`，`.nextAll(filter)`但我需要一些适合其中的东西 - 实际上，a`.nextWhile(filter)`反复执行 next 直到过滤器不再为真，然后停止（而不是继续到最后）。

为了证明这一点，下面是一些简化的 HTML——（实际上，它是动态生成的、随机顺序/数据、更多列、正确的类名等）。

```
<table>
    <thead>
        <tr>
            <th>...</th>
        </tr>
    </thead>
    <tbody>

        <tr class="x"><td>a <button>Show/Hide</button></td></tr>
            <tr class="x y"><td>a1</td></tr>
            <tr class="x y"><td>a2</td></tr>

        <tr class="z"><td>b</td></tr>

        <tr class="z"><td>c</td></tr>

        <tr class="x"><td>d <button>Show/Hide</button></td></tr>
            <tr class="x y"><td>d1</td></tr>
            <tr class="x y"><td>d2</td></tr>
            <tr class="x y"><td>d3</td></tr>

        <tr class="z"><td>e</td></tr>

        <tr class="x"><td>f</td></tr>

        <tr class="x"><td>g <button>Show/Hide</button></td></tr>
            <tr class="x y"><td>g1</td></tr>
            <tr class="x y"><td>g2</td></tr>

    </tbody>
</table> 
```

并针对此运行一些 JavaScript：

```
<script type="text/javascript">
    var $j = jQuery.noConflict();

    $j().ready(init);

    function init()
    {
        $j('tr.y').hide();
        $j('tr.x button').click( toggleRelated );
    }

    function toggleRelated()
    {
        // Only toggles one row
        // $j(this).parents('tr').next('.y').toggle();

        // Toggles unrelated ones also
        $j(this).parents('tr').nextAll('.y').toggle();

        // Not currently a jQuery construct
        // $j(this).parents('tr').nextWhile('.y').toggle();
    }

</script> 
```

有没有一种简单的方法来实现这个`nextWhile`结构？

理想情况下，这需要在不修改当前 HTML 的情况下实现。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2013-03-19T08:55:22.350

在 jQuery 中，您可以使用方法和选择器创建`nextWhile()`等效项。简单的说，和说的一样。[`nextUntil()`](http://api.jquery.com/nextUntil/)[`:not`](http://api.jquery.com/not-selector/)*`while (condition is true) { do something }`**`until (condition is false) { do something }`*

考虑这个技巧示例，您需要选择`.child`第一个之后的所有元素`.parent`：

```
<ul id="test">
  <li class="parent"></li>
  <li class="child"></li>
  <li class="child"></li>
  <li class="child"></li>
  <li class="divider"></li>
  <li class="parent"></li>
  <li class="child"></li>
  <li class="child"></li>
  <li class="child"></li>
</ul> 
```

下面的代码大致相当于*`.nextWhile(".child")`*并选择了三个`.child`元素：

```
$("#test .parent:first").nextUntil(":not(.child)"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T14:01:32.327

***更新：****放弃递归的想法，决定计数和切片（见最后一个例子）。*

**初始尝试：**
*此代码有问题 - 它仅返回最后两项，因此不适用于 3+ 项。*

```
jQuery.fn.nextWhile = function(f)
{
    if( this.next(f).html() )
    {
        return this.next(f).nextWhile(f).andSelf();
    }
    else
    {
        return this;
    }
}; 
```

**当前版本：**

```
jQuery.fn.nextWhile = function(f)
{
    var Next = this.next(f);
    var Pos = 0;

    while( Next.length > 0 )
    {
        Pos++;
        Next = Next.next(f);
    }

    return this.nextAll(f).slice(0,Pos);
} 
```

这似乎工作正常，但我不确定选择所有内容然后只从中切片是否有任何性能损失？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-07-07T11:00:59.503

我的版本：

```
$.fn.extend({
  nextWhile: function(selector) {
    var $result = $([]);
    this.each(function() {
      var $next = $(this).next();
      while ($next.is(selector)) {
        $result = $result.add($next);
        $next = $next.next();
      }
    });
    return $result;
  }
}); 
```

# c# - java的同步关键字的C#版本？

> ID：541194
> 
> 赞同：336
> 
> 时间：2009-02-12T13:23:18.033
> 
> 标签：c#, java, multithreading, synchronization

c# 是否有自己的 java“同步”关键字版本？

即在java中，它可以被指定为一个函数、一个对象或一个代码块，如下所示：

```
public synchronized void doImportantStuff() {
   // dangerous code goes here.
} 
```

或者

```
public void doImportantStuff() {
   // trivial stuff

   synchronized(someLock) {
      // dangerous code goes here.
   }
} 
```

* * *

## 回答 #1

> 赞同：494
> 
> 时间：2009-02-12T14:00:48.800

首先 - 大多数类永远不需要是线程安全的。使用[YAGNI](http://en.wikipedia.org/wiki/You_aren't_gonna_need_it)：仅当您知道您将实际使用它（并对其进行测试）时才应用线程安全。

对于方法级的东西，有`[MethodImpl]`：

```
[MethodImpl(MethodImplOptions.Synchronized)]
public void SomeMethod() {/* code */} 
```

这也可以用于访问器（属性和事件）：

```
private int i;
public int SomeProperty
{
    [MethodImpl(MethodImplOptions.Synchronized)]
    get { return i; }
    [MethodImpl(MethodImplOptions.Synchronized)]
    set { i = value; }
} 
```

请注意，默认情况下，类似字段的事件*是*同步的，而自动实现的属性*则不是*：

```
public int SomeProperty {get;set;} // not synchronized
public event EventHandler SomeEvent; // synchronized 
```

就个人而言，我不喜欢执行`MethodImpl`as it locks`this`或`typeof(Foo)`- 这违反了最佳实践。首选选项是使用您自己的锁：

```
private readonly object syncLock = new object();
public void SomeMethod() {
    lock(syncLock) { /* code */ }
} 
```

请注意，对于类似字段的事件，锁定实现取决于编译器；在较旧的 Microsoft 编译器中，它是`lock(this)`/ `lock(Type)`- 然而，[在较新的编译器中，它使用`Interlocked`](http://marcgravell.blogspot.co.uk/2010/03/revisited-fun-with-field-like-events.html)更新 - 因此线程安全，没有讨厌的部分。

这允许更细粒度的使用，并允许使用`Monitor.Wait`/ `Monitor.Pulse`etc 在线程之间进行通信。

一个相关的[博客条目](http://marcgravell.blogspot.com/2009/02/fun-with-field-like-events.html)（后来[重新访问](http://marcgravell.blogspot.co.uk/2010/03/revisited-fun-with-field-like-events.html)）。

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2009-02-12T13:27:17.417

```
static object Lock = new object();

lock (Lock) 
{
// do stuff
} 
```

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2009-02-12T13:24:36.393

> c# 是否有自己的 java“同步”关键字版本？

否。在 C# 中，您明确地`lock`希望跨异步线程同步处理资源。`lock`打开一个块；它不适用于方法级别。

但是，底层机制是相似的，因为通过在运行时`lock`调用[`Monitor.Enter`](http://msdn.microsoft.com/en-us/library/de0542zz.aspx)（以及随后）来工作。`Monitor.Exit`根据[Sun 文档](http://java.sun.com/docs/books/tutorial/essential/concurrency/locksync.html)，Java 的工作方式相同。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-07-24T13:32:55.067

请注意，带有完整路径的行：`[MethodImpl(MethodImplOptions.Synchronized)]`应该看起来像

`[System.Runtime.CompilerServices.MethodImpl(System.Runtime.CompilerServices.MethodImplOptions.Synchronized)]`

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-12T13:27:38.617

您可以改用该`lock`语句。我认为这只能替代第二个版本。另外，请记住，两者都`synchronized`需要`lock`对对象进行操作。

# embedded - 嵌入式开发人员是否比他们的桌面兄弟更保守？

> ID：541195
> 
> 赞同：12
> 
> 时间：2009-02-12T13:23:26.707
> 
> 标签：embedded, methodology

我在嵌入式领域已经有一段时间了，似乎与我交谈过的大多数程序员的工作方式似乎与 15 年或更长时间前所做的几乎相同：瀑布（ish）开发，命令行工具一小群人使用皮棉。

将此与服务器/桌面环境进行对比，那里似乎有很多与编程的各个方面相关的活动：

*   XP、Scrum、迭代、精益/敏捷
*   持续集成
*   自动化构建
*   自动化单元测试框架
*   重构工具支持

仅仅是嵌入式环境使实施新实践或工具变得更加困难吗？
是[嵌入式程序员的心态使](https://stackoverflow.com/questions/540025/mindset-difference-between-workstation-and-embedded-programmers)他们远离新工具/概念吗？
与以 IT 为重点的领域相比，典型嵌入式行业的管理层是否落后于曲线？

我确实意识到这是一种概括，一些嵌入式项目确实使用了 Scrum、敏捷、CI、自动构建（事实上，我曾在一家自 80 年代以来就已经存在的公司工作）。但我的印象是，这是一个非常小的百分比。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-12T13:47:23.000

我们都习惯了我们的台式电脑偶尔会崩溃的事实（或者至少桌面上的一个应用程序突然消失了）。这没什么大不了的。下一个补丁会修复它。

在嵌入式空间中，您正在构建无法修补的东西。生命可能取决于您的设备（在汽车、电梯或医疗系统中）。大多数设备都已安装，然后必须在无人看管的情况下运行多年。所以嵌入的人往往非常保守。TCP/IP 通常“过于现代”。他们坚持使用具有大约 50 行汇编代码的通信“堆栈”的可信赖串行总线。

更糟糕的是，您根本没有设备上的充足空间，这意味着您无法使用使 TDD 和自动化构建成为幸福的最新编程语言之一。

其次，很多嵌入式开发环境都是专有的。如果您的供应商不支持它，您将无法获得它。Linux 在过去几年开始削弱这一点，但很多设备还不足以运行 Linux。即使是这样，CPU 的能力也将用于其他用途，而不是运行带有源代码的精美操作系统。

所以是的，有强大的力量在后台工作，以保持嵌入式空间在原处。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-12T21:32:57.780

**嵌入式开发人员是否比他们的桌面兄弟更保守？**

是的，因为他们更关心犯错的后果。修补嵌入式设备是一件大事。对于桌面应用程序来说不是那么多。

**在嵌入式世界中，瀑布式开发**是必要的，因为您通常在构建软件的同时构建硬件。您需要尽快知道有多少内存、多少处理器速度、多大的闪存、是否需要任何特殊硬件等等……在您知道这些答案之前，硬件设计无法完成。一旦你决定了，就差不多了。重做电路板的准备时间太长了。如果你搞砸了，那么该软件将不得不解决任何缺点。通常不是理想的情况。

至于**工具**，这在很大程度上取决于供应商提供的内容以及开发人员的任何偏见。在一些项目中，我使用了 XP Embedded，并且得到了桌面开发人员所获得的几乎所有东西。

**XP、Scrum、迭代、精益/敏捷：**

由于大部分设计都是预先完成的（必要时），并且在编写代码时通常没有可用的硬件，因此快速周转过程并没有真正提供太多好处。

**持续集成/自动化构建** 很高兴，但不是真正必要的。什么……打开IDE并按下编译按钮大约需要15秒。

**自动化单元测试**

没有理由不应该这样做，但只有部分代码可以真正自动测试，因为另一部分要么依赖于硬件，要么具有其他一些依赖关系，如时序。因此，您无法真正判断代码是否可以通过自动化测试工作。

**重构工具支持**

嵌入式处理器产品的供应商是处理器。他们提供 IDE 支持以鼓励您购买他们的处理器。他们不可能为一个 Visual Studio 规模的开发团队支付费用，以便将所有的花里胡哨的东西添加到甚至不是他们的产品的 IDE 中。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-12T13:55:04.323

这些我能想到的一些原因：

*   嵌入式团队通常比桌面/Web 团队小。代码库更小。
*   系统测试比单元测试重要得多。软件需要与硬件一起测试。自动化测试是不可能的，只能应用于代码库的一小部分。
*   嵌入式工程师的技能与软件工程师不同。他们与硬件交互，知道如何使用示波器和逻辑分析仪。通常，他们工作中最困难的部分是找出硬件故障。他们没有时间采用现代软件方法。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-12T19:48:16.487

嵌入式程序员大多是电气工程师，而不是计算机科学家或软件工程师。

他们在自己的专业领域表现出色。与大多数计算机程序员相比，它们带来了一种更慢、更有条理的方法。在编程固件时，电气工程师知道的危险程度刚好够。

以下是我注意到电气工程师在 C 语言中所做的一些事情：

*   一个文件中的所有代码
*   数学类变量名称：x、y、z
*   没有或缺少缩进
*   没有标准的评论标题
*   完全没有评论
*   评论太多

在他们的辩护中，EE 没有被训练成为计算机程序员，这不是他们的工作。我认为**软件**是创建嵌入式设备最难的部分。设计 PCB 和选择组件需要技巧，但与 10,000 行代码的复杂性相比，显得相形见绌。

嵌入式程序员还必须处理外观和行为类似于 90 年代 IDE 的 IDE。

*   [MPLAB](http://www.microchip.com/stellent/idcplg?IdcService=SS_GET_PAGE&nodeId=1406&dDocName=en019469&part=SW007002)
*   [AVR 工作室](http://www.atmel.com/dyn/Products/tools_card.asp?tool_id=2725)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-12T20:02:02.053

## 仅仅是嵌入式环境使实施新实践或工具变得更加困难吗？

这部分是规模问题。软件不是产品，产品就是产品。然而，市面上有成千上万种不同类型的微控制器和微处理器，其中最流行的几千种有 3-4 种不完全兼容的不同编译器。

所以一个给定的工具只会被几百或几千名工程师使用。

然而，在windows开发中，有数以百万计的不同层次的程序员——工具直接生产软件，也就是产品，所以它会得到更多的眼球，更多的钱。

工程师推出的每个新产品都可能有不同的处理器。

## 是嵌入式程序员的心态使他们远离新工具/概念吗？

嵌入式程序员通常是软件或固件工程师，而不是程序员。工程意味着在实现之前进行一定数量的设计、设计分析和设计证明——换句话说，在编写第一行代码之前已经完成了大量工作，理想情况下，文档足够具体以至于实现只是转向将文档之类的伪代码转换为可编译代码。

设计阶段需要新的工具和概念，而不是实施阶段。带有智能感知的 IDE 可能不错，但是在编写代码时它已经变得毫无用处了——他们已经知道自己需要什么。

CAD - 计算机辅助设计 - 正在为固件工程师开发工具，这些工具在设计阶段用于开发直接转化为代码的模型和模拟。Matlab 和 simulink 就是很好的例子。设计了整个系统。

事实上，人们可能想知道为什么软件开发人员仍在编写代码，而工程师则在制作数据/程序流程图和状态机图。为什么 UML 在应用程序领域的应用如此缓慢？听起来应用程序开发人员可以使用嵌入式系统工程师常用的一些工具......

## 与以 IT 为重点的领域相比，典型嵌入式行业的管理层是否落后于曲线？

实际上，很可能是相反的。当一个项目开始时，工程师必须选择处理器。

处理器制造商在较旧的芯片上获得的资金较少，因此他们推销最新和最好的芯片，而且它们总体上比以前设计中使用的芯片便宜（通过芯片缩小、更多集成等）。

所以设计实际上是使用了最新最好的芯片。

缺点是编译器和工具通常不成熟。他们只能在旧工具上构建这么多东西，而且由于目标随着每个新处理器的变化而变化，他们不能专注于应用程序程序员可能喜欢的许多不错的功能。特别是因为其中许多功能对嵌入式工程师没有用处。

还有许多其他因素，其中一些被其他答案列举，但它确实是一个不同的领域，即使它们都涉及编程。

-亚当

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-15T19:38:22.603

我还要在这里补充几点：

*   一般来说，嵌入式项目往往比桌面项目小。这减少了对非常复杂的软件过程的需求。
*   嵌入式项目的需求通常是精确的和更好的定义。因此，SCRUM 和敏捷并不是那么重要
*   最后，嵌入式项目通常是软件和硬件的混合体。软件只是项目的一部分，嵌入式开发人员在软件过程中投入的时间更少

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-02-02T20:28:23.423

我同意这里写的很多内容：

*   没有花里胡哨的旧工具（由于 C/C++ 的预处理器指令，可用的重构要少得多，如果有的话）（选择单元测试框架与简单地使用 JUnit 比较耗时）。

*   的确，瀑布感觉更有效率。如果我要打开引擎盖并进入一个难以进入的地方，我会想在那里做尽可能多的事情，而不是在完成每个任务后退出并关闭引擎盖只是为了打开再说一遍。首先创建最重要的功能允许您选择在承诺时发货而不是迟到的想法，当您认为没有什么是可选的时，也很难理解，这可能是真的。然而，当最后期限临近时，输入法总是变得不必要。

*   对系统的较少可见性使得重新访问现有代码以重构或更改功能的风险更大。通常存在时间问题，使用存根和模拟在主机上运行的自动化测试无法捕捉到。被这些问题困扰的人可能很难采取不同的观点。

*   我再补充一个；敏捷/scrum 的语言是工作站程序员的术语。对于一个懂得足够 C 语言来完成工作的嵌入式开发人员来说，什么是类、对象或方法？当“用户”通常被认为是点击和打字的物理人，并且产品没有人的用户界面时，很容易将这个想法视为不适用。这可能会随着 James Grenning 即将出版的关于[C 中 TDD](https://rads.stackoverflow.com/amzn/click/com/193435662X "C语言中的TDD")的书而改变。我一直在阅读测试版电子书，它非常好。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-12T13:48:29.737

我会说它更缺乏好的工具集。当你想使用 C++ 来使用 C 中不存在的编译时特性（模板、命名空间、面向对象等）而不是它的运行时特性（异常、虚函数）时，这真的很令人沮丧——但是设备制造商和第三方只是给你一个 C 编译器，而不是 C++。这可能更多是由于市场规模（数亿台运行 Windows 的 PC，拥有数十万甚至数百万开发人员 - 与数十万 Chip X，拥有数百或数千名开发人员）而不是设备能力的结果。

编辑：w/r/t 稳健性：那里有不同的市场。汽车/电梯/航空/医疗设备市场必须严格消除漏洞。其他市场（玩具、MP3 播放器和其他消费电子产品）可能不那么严格，特别是如果可以在现场升级代码的话。（“糟糕！很抱歉我们删除了您的音乐库！我们刚刚修复了这个错误，您可以在方便时在我们的网站上获取最新版本！”）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-12T20:18:57.707

我会说不同类型的问题环境。

瀑布方法的最大问题是需求变化。在我所经历的每一个环境中，至少存在需求变化的可能性，这意味着成功的方法是那些尽可能长时间地保持灵活性的方法。即使客户已经签署了血案，并且如果他提出更改建议，他会放弃他的左手，未来也会有更改。

在嵌入式编程中，可以预先确定需求。它们来自整个系统的行为，工程师擅长确定系统要求。没有人会在中途说用户现在希望起搏器在接受者跳舞时提供切分脉冲。

一旦需求被冻结而无法解冻，这在为人类使用而设计的软件中永远不会发生，瀑布是一种非常有效的方法。团队从明确规定的需求到整体设计，然后是详细设计，然后是编码，一直验证各个阶段是否正确完成。然后是调试代码的时候了（因为它在编写时永远不会完美），并进行最终测试以确保代码符合要求。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-10-15T21:35:24.807

我还假设某些领域本质上是保守的。例如运输业，火车和飞机的寿命可能在 30 年左右。客户往往需要经过验证的真实实践，这些实践可能源自 IEEE。瀑布是客户所知道的，瀑布是客户所要求的。

# actionscript-3 - 在类外制作静态/类函数

> ID：541196
> 
> 赞同：1
> 
> 时间：2009-02-12T13:23:46.393
> 
> 标签：actionscript-3

如何使用 actionscript 制作类函数，我需要一些静态工具函数，这些函数可以从其他类中轻松使用，例如 **test = tools.rtrim(xx);**

例如，这不会编译：

```
package com.my.tools
{
static function rtrim(string:String):String {
            return string.replace(/\s+$/,"");

        }
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-12T13:26:05.733

它需要附加到类类型而不是包

尝试

```
package com.my.tools
{
     public class Tools
     {
         public static function rtrim(string:String):String 
         {
                return string.replace(/\s+$/,"");
         }
     }
} 
```

然后您可以通过 Tools.rtrim("yourString"); 使用它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-12T17:57:45.113

如果您的工具集合变得很大，那么使用顶级函数也可能很有用。特别是如果您想在其他项目中重用一小部分“工具”而不通过编译未使用的工具来浪费文件大小（如果您将它们全部包含在同一个类中就会发生这种情况）。

为此，您必须在您的包文件夹中为每个函数创建一个文件。每个文件的命名方式应与其相关功能相同。例如，每个名为*rtrim.as*的文件的内容如下所示：

```
package com.my.tools {

    public function rtrim(str:String) : String {

        return string.replace(/\s+$/,"");   
    }
} 
```

然后你只需要在你需要的地方导入顶级函数：

```
package my {

    import com.my.tools.rtrim;  

    public class Test 
    {
        rtrim("bla bla");
    }
} 
```

# .net - 将应用程序从 Dev 迁移到 QA 到 Prod

> ID：541200
> 
> 赞同：0
> 
> 时间：2009-02-12T13:24:59.200
> 
> 标签：.net, deployment

我有许多 web 服务和客户端（单击一次部署），我想知道如何有效地部署。我们有一个 QA 部门负责审查和测试版本，还有一个运营组目前负责“部署”，主要包括将测试版本从 QA 盒复制到 Prod 盒。这个过程很容易出错，因为配置文件没有正确复制，并且没有给出关于是否/何时/如何进行部署的反馈，因此我认为这种部署方法不是最佳实践的方法。

我们正在使用构建机器进行构建，我不想从我的开发机器使用发布。

我一直想知道脚本部署是否是我应该研究的，是否有任何标准方法可以做到这一点。我已经对 TFSDeployer 进行了一些实验，它是一个实用程序，它存在于要部署到的盒子上，并从团队基础服务器中获取事件，然后可以通过 powershell 脚本对其进行操作。我可以在开发/测试机器上看到类似的东西，但对于我不知道的生产服务器。

你如何部署你的网络服务/客户端？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-13T00:41:50.913

我也将 TFSDeployer 用于推送到生产，因为您可以将 TFSDeployer 设置为推送，因此您不必将它安装在生产盒上（这仅意味着您需要为构建帐户/机器配置权限以访问生产）。

一个有用的提示是限制谁可以更改构建质量的权限，并且仅在构建质量达到 UAT 通过级别（或您的组织的任何等效级别）时才允许推送到生产脚本。

# sharepoint - 添加新组 - 访问被拒绝错误

> ID：541203
> 
> 赞同：1
> 
> 时间：2009-02-12T13:25:21.243
> 
> 标签：sharepoint, sharepoint-2007

我们有一个非常奇怪的问题。

我的用户 ID 是场管理员，它是相关站点上的网站集管理员。

如果我添加一个新组（以管理权限），一旦我单击创建组页面上的确定按钮，我就会被抛出**错误：访问被拒绝**页面。

这是奇怪的部分，***组被创建了***。

如果我尝试将用户添加到该组，我会得到拒绝访问页面，但该用户没有被放入该组。

如果我尝试删除组，我会收到一个错误页面，显示**无法完成此操作。请再试一次**。

它似乎只发生在这个站点（及其子站点）上。

任何共享点日志或事件日志中都没有任何内容。

这一定是权限问题，但我不知道是什么。

**编辑------------------------------------ 编辑**

经过更多研究后，我发现[了这篇博客文章](http://www.wictorwilen.se/Post/HTTP-403-Forbidden-in-a-SharePoint-site-when-adding-members.aspx)。它指出 .NET 2.0 修补程序是问题的罪魁祸首，并指出删除它可以解决问题。

我无法删除该修补程序，因为它没有安装。

**我们注定要被这个问题困住吗？**

**结束编辑**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T16:23:39.773

听起来可能 _layouts 中的系统页面之一具有古怪的权限。在您尝试添加/删除组时，在 IIS 日志（不是 SharePoint 日志）中查找用户的 401、403 或 407（或者实际上是任何高于 400 的 HTTP 代码）错误。这可能指向有问题的页面，这将为您提供一些帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-09T18:53:27.043

如果您将共享点 Web 应用程序托管在 IIS/SP 使用的默认位置以外的其他位置；检查以确保用户组已读取到受影响应用程序的 Bin 目录。由于某种原因，当创建此特定应用程序时，它无法像正常情况下那样使用 Read 将用户组添加到 Bin 目录。这很容易测试，失败和成功的一致性。我注意到它影响的唯一一件事是有关通过 Sharepoint 站点 GUI 将新用​​户添加到站点的问题。

这是挖掘我的 SP 日志时收到的错误：

访问 /_layouts/aclinv.aspx 时出现应用程序错误，错误=拒绝访问路径 'D:\ProdSites\SP-ProdSites*****\bin'。在 System.IO.__Error.WinIOError(Int32 errorCode, String maybeFullPath) 在 System.IO.Directory.InternalGetFileDirectoryNames(String path, String userPathOriginal, String searchPattern, Boolean includeFiles, Boolean includeDirs, SearchOption searchOption) 在 System.IO.DirectoryInfo.GetFiles (String searchPattern, SearchOption searchOption) 在 System.IO.DirectoryInfo.GetFiles(String searchPattern) 在 System.Web.Configuration.CompilationSection.LoadAllAssembliesFromAppDomainBinDirectory() 在 System.Web.Configuration.CompilationSection.LoadAssembly(AssemblyInfo ai) 在 System.Web。 Configuration.AssemblyInfo.get_AssemblyInternal() 在...

这是我在 IIS 日志中显示的错误：

2009-09-09 13:48:19 W3SVC1237373898 IP GET /OOD/_layouts/aclinv.aspx GroupId=9&Source=http%INFO2Fpeople%2Easpx%3FMembershipGroupId%3D9 80 域\用户 IP Mozilla/4.0+（兼容；+MSIE+7.0 ;+Windows+NT+5.1;+Trident/4.0;+.NET+CLR+2.0.50727;+.NET+CLR+1.1.4322;+.NET+CLR+3.0.04506.30;+.NET+CLR+3.0 .04506.648;+OfficeLiveConnector.1.4;+OfficeLivePatch.1.3;+86e) 403 0 0

也许人们已经检查过了，但我花了一点时间。我查找了补丁 KB928365，但它不存在（许多其他帖子都建议删除此补丁以解决此问题）。此外，QA 和生产中的行为是不同的，因为我在 QA 中用于将新用户添加到站点的帐户由于包含在 WSS_admin_wpg 组中而提高了特权（可能是因为它是 QA 中的农场管理员？ )

# javascript - 原型和构造函数对象属性

> ID：541204
> 
> 赞同：10
> 
> 时间：2009-02-12T13:25:29.260
> 
> 标签：javascript, prototype, constructor

我有：

```
function Obj1(param)
{
    this.test1 = param || 1;

}

function Obj2(param, par)
{
    this.test2 = param;

} 
```

现在当我这样做时：

```
Obj2.prototype = new Obj1(44);
var obj = new Obj2(55);

alert(obj.constructor) 
```

我有：

```
function Obj1(param) {
    this.test1 = param || 1;
} 
```

但是构造函数一直是Obj2...为什么呢？Obj1 变成了 Obj2 的原型……

有人可以详细解释一下原型链和构造函数属性吗

谢谢

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-12T13:42:00.983

`constructor`是原型对象的常规属性（`DontEnum`设置了标志，因此它不会出现在`for..in`循环中）。如果您替换原型对象，该`constructor`属性也将被替换 - 有关详细信息，请参阅[此说明](http://joost.zeekat.nl/constructors-considered-mildly-confusing.html)。

您可以通过手动设置来解决此问题`Obj2.prototype.constructor = Obj2`，但这样`DontEnum`就不会设置标志。

由于这些问题，依赖于`constructor`类型检查并不是一个好主意：使用`instanceof`or`isPrototypeOf()`代替。

* * *

Andrey Fedorov 提出了为什么`new`不将`constructor`属性分配给实例对象的问题。我想这样做的原因如下：

从同一个构造函数创建的所有对象共享构造函数属性，共享属性驻留在原型中。

真正的问题是 JavaScript 没有对继承层次结构的内置支持。有几种方法可以解决这个问题（你的方法就是其中之一），另一种“本着 JavaScript 精神”的方法如下：

```
function addOwnProperties(obj /*, ...*/) {
    for(var i = 1; i < arguments.length; ++i) {
        var current = arguments[i];

        for(var prop in current) {
            if(current.hasOwnProperty(prop))
                obj[prop] = current[prop];
        }
    }
}

function Obj1(arg1) {
    this.prop1 = arg1 || 1;
}

Obj1.prototype.method1 = function() {};

function Obj2(arg1, arg2) {
    Obj1.call(this, arg1);
    this.test2 = arg2 || 2;
}

addOwnProperties(Obj2.prototype, Obj1.prototype);

Obj2.prototype.method2 = function() {}; 
```

这也使得多重继承变得微不足道。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-12T13:48:05.087

查看[Tom Trenka 的 OOP woth ECMAscript](http://people.apache.org/~martinc/OOP_with_ECMAScript/)，即“继承”页面。*原型中的所有*内容都是继承的，包括`constructor`属性。因此，我们必须自己解开它：

```
Obj2.prototype = new Obj1(42);
Obj2.prototype.constructor = Obj2; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T15:01:00.903

简短版本：“构造函数”不会按照您的想法做，并且不兼容跨浏览器。永远不要使用它。

长版：[JavaScript 中原型继承的约定](https://stackoverflow.com/questions/402538/convention-for-prototype-inheritance-in-javascript/402919#402919)

一般来说：由于（a）基于类和基于原型的 OO 之间的阻抗不匹配，以及（b）JavaScript 对基于原型的 OO 的特殊相当差的解释的奇怪之处，您会感到困惑。

如果您找到一个您喜欢的原型类实现并坚持下去，您可能会更开心。许多图书馆都有。这是我使用的任意一个：

```
Function.prototype.subclass= function() {
    var c= new Function(
        'if (!(this instanceof arguments.callee)) throw(\'Constructor called without "new"\'); '+
        'if (arguments[0]!==Function.prototype.subclass.FLAG && this._init) this._init.apply(this, arguments); '
    );
    if (this!==Object)
        c.prototype= new this(Function.prototype.subclass.FLAG);
    return c;
}
Function.prototype.subclass.FLAG= new Object(); 
```

这是一个如何使用它的示例：

```
// make a new class
var Employee= Object.subclass();

// add members to it
Employee.prototype._LEGS= 2;
Employee.prototype.getLegs= function() {
    return this._LEGS;
};

// optional initialiser, takes arguments from constructor
Employee.prototype._init= function(name) {
    this.name= name;
};

// make a subclass
Manager= Employee.subclass();

// extend subclass method
Manager.prototype._init= function(name, importance) {
    // call base class's method
    Employee.prototype._init.call(this, name);
    this.importance= importance;
}

// all managers are well-known to have three legs
Manager.prototype._LEGS= 3;

// create one
var jake= new Manager('Jake the Peg', 100); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T14:03:29.030

好吧，构造函数属性是 Obj1 的原型（属性）上的任何其他属性。如果您[了解原型的工作原理](http://javascript.crockford.com/prototypal.html)，这可能会有所帮助：

```
>>> obj.hasOwnProperty("constructor")
false

// obj's [[Prototype]] is Obj2.prototype
>>> Obj2.prototype.hasOwnProperty("constructor")
false

// Obj2.prototype's [[Prototype]] is Obj1.prototype
>>> Obj1.prototype.hasOwnProperty("constructor")
true

// Oh?
>>> Obj1.prototype.constructor
Obj1() 
```

啊哈！所以obj没有构造函数，JS去[[Prototype]]链上去，从Obj1.prototype.constructor

我不确定为什么当你使用“new”时，构造函数属性不只是设置在一个对象上。可能是有原因的，也可能只是疏忽。无论哪种方式，我倾向于避免它。

# c# - 可以在 .Net Windows 界面中编辑 Crystal Reports 吗？

> ID：541205
> 
> 赞同：0
> 
> 时间：2009-02-12T13:25:29.603
> 
> 标签：c#, .net, crystal-reports, interop, rtf

我目前正在评估 Crystal Reports 2008 在一个大型企业项目中的使用。我已经在 Visual Studio 中成功使用了 Crystal Reports Basic，但我们需要更多功能。可以在 .Net Windows 界面中编辑这些报告吗？

报告将基于 ADO.NET Xml 数据集生成，并将作为 rpt 文件的 blob 保存到 SQL Server db。我们将检索这些 rpt 文件，以便在使用 C# 中的 Visual Studio 2008 编码的 .Net Windows 应用程序中查看。

我需要根据公式生成隐藏和显示部分/段落的字母，但用户希望能够编辑文本。

一旦创建了报告并在 .Net CrystalReportViewer 控件中显示（在 .Net Windows 应用程序中），有什么方法可以允许用户更改显示的文本并重新保存 rpt 文件？

我知道我可以使用参数，但对于可能包含一些粗体字的大段文本来说，它并不理想。用户可能只会更改几个词，例如信件的收件人。他们坚持认为他们需要能够改变信上的任何内容。

我也知道（使用 Crystal XI 或 2008）我可以导出到 EditableRTF，它不会像标准 RichTextFormat 导出选项那样将文本放在框架中。.Net RichTextBox 组件不显示页眉或页脚，这很痛苦。我可以在 Word 中显示 RTF（即使它们遗漏了报告中的行和框，但这是另一回事），但坦率地说，我对在 .Net 应用程序中部署 Office 互操作组件的故事感到害怕。

当 Crystal 以预览模式显示报表时，您可以单击段落，它知道那里有一个“字段”，因为它用一个框突出显示行。有什么方法可以编辑此文本并再次保存报告？

我面临着对这个工作领域做出估计的压力。水晶里面有可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T14:43:28.877

您已经很好地掌握了 Crystal 的功能，而且您是对的 - “实时”编辑大块报表文本的想法将是艰难的。

“导出到 RTF”选项可能是可行的，前提是您可以使用单向生成（在使用 Crystal 生成报告并开始编辑输出后，您无法在不丢失编辑的情况下重新生成）。

您是否考虑过类似 OneNote 或其他基于 XSLT 的解决方案？看起来您的用户希望对生成的输出进行大量控制，因此您的设计必须考虑到这一点。甚至可能生成输出，然后将其直接发送到文档管理系统中，以便跟踪和控制用户的更改？

# c# - 如何加密密码以便稍后将其保存在数据库或文本文件中？

> ID：541219
> 
> 赞同：9
> 
> 时间：2009-02-12T13:28:48.660
> 
> 标签：c#, .net, security

我希望我的应用程序将加密的密码保存在数据库或文本文件中。假设任何人都可以打开数据库或文本文件，我该怎么做？

**复制**

> [加密/散列数据库中的纯文本密码](https://stackoverflow.com/questions/287517/encrypting-hashing-plain-text-passwords-in-database)

**不重复** 我要求提供特定于 .NET 的代码

编辑：我正在保存密码以备后用。我需要对其进行解码并使用它来登录。它不必是超级安全的，它只需要对人眼来说是不可读的，并且很难用一个简单的脚本来解码。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-18T21:13:12.240

StackOverflow 读者不知道如何编写安全密码方案，您也不知道。如果您要这样做，请坚持使用纯文本来节省时间。从[足够的彩虹表开始：您需要了解的安全密码方案](http://www.matasano.com/log/958/enough-with-the-rainbow-tables-what-you-need-to-know-about-secure-password-schemes/)：

> 彩虹桌很容易被击败。对于每个密码，生成一个随机数（随机数）。用随机数对密码进行哈希处理，并存储哈希和随机数。服务器有足够的信息来验证密码（随机数以明文形式存储）。但即使是一个小的随机值，比如 16 位，彩虹表也是不可行的：现在每个哈希有 65,536 个“变体”，而不是 3000 亿个彩虹表条目，你需要千万亿个。该方案中的随机数称为“盐”。
> 
> 酷吧？是的，Unix crypt——几乎是安全系统中最低的公分母——自 1976 年以来就具有此功能。如果这对您来说是新闻，那么您不应该设计密码系统。用别人的好。

使用[BCrypt](http://derekslager.com/blog/posts/2007/10/bcrypt-dotnet-strong-password-hashing-for-dotnet-and-mono.ashx) - .NET 和 Mono 的强密码散列。这是一个简洁的 .cs 文件，随着密码破解计算机的速度越来越快，它将继续满足您的需求。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-12T13:41:03.903

[BCrypt](http://derekslager.com/blog/posts/2007/10/bcrypt-dotnet-strong-password-hashing-for-dotnet-and-mono.ashx) - .NET 和 Mono 的强密码散列

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-12T13:38:49.383

三重 DES 是一种方法，只要您的意思是“我的系统需要能够调用才能访问资源的密码”。如果您的意思是密码是用户需要能够访问您的系统的东西，可能不想要加密，只需哈希即可。当您存储散列密码值时，它对直接访问数据库的任何人都没有用，但*仍可用于身份验证*。您所做的就是将存储的哈希值与传入密码的哈希值进行比较。如果它们匹配，则您授予访问权限。

无论如何，它并不完美，但它是 99.999% 的人存储密码的方式。

如果您想争辩说您希望在用户丢失/忘记密码时将密码提供给用户，那么请不要。向他们发出一个临时密码（您将其存储在数据库中）并让他们在第一次登录时更改它。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-19T09:26:50.450

将[数据保护 API](http://msdn.microsoft.com/en-us/library/system.security.cryptography.protecteddata.aspx)与用户或机器存储一起使用（例如，您的程序/数据库服务器在每个帐户下运行不同的密钥与每台机器一个密钥）。这将帮助您稍后解码密码，并且您不必记住或存储任何加密密钥。我相信它的缺点是，当您重新安装系统/删除帐户时，您将无法恢复数据。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-12T13:40:42.250

如果您使用加密来安全地存储密码，您也需要将加密“密钥”存储在某处。这将是“薄弱环节”，因为如果有人掌握了加密密钥，他们将能够解密加密的密码。

由于这是我们在这里讨论的密码，因此更好的解决方案是使用单向哈希。您在用户首次创建密码时对密码进行哈希处理（最好使用盐值进行哈希处理）并存储生成的哈希值。由于散列是单向的，没有人可以将散列反转为原始纯文本值。

要检查用户密码是否正确，您只需向用户询问纯文本密码，再次对他们的输入进行哈希处理，然后将生成的哈希值与您存储的哈希值进行比较（当然要考虑盐）。如果两个哈希值相同，则用户输入了正确的密码。

请参阅以下链接以获取更多信息： [使用 Salt 哈希密码](http://www.obviex.com/samples/hash.aspx)

对于加密（如果你需要使用它），我会使用[Rijndael (AES)](http://msdn.microsoft.com/en-us/library/system.security.cryptography.rijndaelmanaged.aspx)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-19T20:19:56.780

根据您的问题，我可以看到两种方法，具体取决于您存储密码的原因。

**A. 如果您只需要使用他们的密码进行身份验证而不需要其他任何东西。**

在这种情况下，使用不可逆的算法（[散列](http://en.wikipedia.org/wiki/Cryptographic_hash_function)）将是您的最佳选择。您需要确保以下几点：

1.  确保在将密码从客户端传输到服务器时加密连接。这将防止它被嗅出。这对于 Web 应用程序来说是微不足道的，因为 Web 服务器正在为您完成繁重的工作。如果不是，它会变得很棘手，并且是另一个问题的主题。

2.  选择可靠的散列算法来防止冲突。我会推荐 SHA-256，即使它确实提供了比 SHA1 或 MD5 更大的结果。微软关于使用他们的算法实现的参考在[这里](http://msdn.microsoft.com/en-us/library/system.security.cryptography.sha256.aspx)。

3.  对密码加盐以防止使用彩虹表的攻击（即在大表中使用预先计算的哈希和明文的相关密码查找密码）。[此处](https://stackoverflow.com/questions/287517/encrypting-hashing-plain-text-passwords-in-database)的答案（位于您的问题中）在 Python 中提供了有关如何执行此操作的良好伪代码。[这里](http://www.obviex.com/samples/hash.aspx)还有一个很好的 .NET 代码示例。

**B. 如果您需要能够读取每个用户的密码以用于验证用户身份之外的其他目的。**

如果我们只讨论在单台计算机（服务器）上存储密码（或任何类型的敏感信息），这种情况很容易。如果是这种情况，使用 Microsoft 数据保护 API 将是一个很好的解决方案，因为它与那台计算机和（取决于您的工作方式）您的应用程序在其下运行的用户相关联，并为您处理最糟糕的工作（创建、存储和使用密钥）。[您可以在此处](http://msdn.microsoft.com/en-us/library/system.security.cryptography.protecteddata.aspx)找到来自 Microsoft 的一些代码参考。如果您在多个系统上需要它并且不愿意在您安装在应用程序上的每个系统上输入密码，那么事情会变得更加复杂，因为您需要从头开始实现很多它。这将是我认为的另一个问题的主题。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-20T18:13:41.957

如果您需要解密密码以供以后使用，并且不必非常安全，请使用此处的方法：

[http://support.microsoft.com/kb/307010](http://support.microsoft.com/kb/307010)

它有据可查，易于理解。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-12T13:38:02.430

你需要再次加密它吗？否则使用散列函数对其进行加密，并使用相同的散列函数加密用户提供的密码，并查看散列是否相等。

不使用 2-way-encryption 的原因是无法解密您的密钥 - 因为一个好的哈希函数会发生冲突。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-20T16:28:16.547

就个人而言，我会使用具有单向加密的东西 - MD5、SHA1 等......

您可以将 FormsAuthentication 类与它的[HashPasswordForStoringInConfigFile](http://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.hashpasswordforstoringinconfigfile.aspx)方法一起使用。验证用户时，对输入的密码进行加密，并与存储的版本进行比较。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-12T13:36:21.513

像 ocdecio 我会使用 TripleDes，我也会将盐保存在数据库中。对我来说，密钥通常是硬编码的，但是每个加密项目的盐应该改变。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-12T13:39:57.650

如果您只需要内部身份验证过程的密码，则不应保存实际密码，而应保存此密码的[哈希值](http://en.wikipedia.org/wiki/Hash_function)。当您需要检查密码是否有效时，您必须对提供的密码运行哈希函数，并将其与您存储在数据库/文件中的哈希值进行比较。您永远无法从哈希中找到原始密码。

如果您需要保留原始密码，则必须对其进行加密。例如，如果您有一个写入密码（公钥）的进程和另一个读取密码（私钥）的进程，则可以使用[公钥基础设施。](http://en.wikipedia.org/wiki/Public_key_infrastructure)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-12T13:40:20.113

您真的需要能够自行检索密码吗？如果您存储密码是为了对某人（或某物）进行身份验证，您应该对其进行哈希处理（使用加盐），然后将该哈希值与希望被验证的一方提供的密码哈希值进行比较。

另一方面，如果您需要存储密码以便能够检索它并将其提供给其他身份验证服务，那么您可能希望将其加密存储。在这种情况下，可以使用任何合适的对称加密算法，例如 TripleDES 或 AES 或 Blowfish。

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2009-02-12T13:45:16.217

简要地：

获取一个大的随机数，您将对其保密，并且只有您的应用程序代码才能访问。

使用 SHA1 等加密算法对密码 + 随机数进行加密，大多数编程语言都有加密框架。

存储散列密码。

稍后当您想要检查输入的密码时，您可以重新散列用户输入并与“虚拟”无法破译的存储密码进行比较。

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2009-02-20T11:19:09.970

这是带有示例代码 .NET 的字符串加密文章

## [http://www.devarticles.com/c/a/VB.Net/String-Encryption-With-Visual-Basic-.NET/3/](http://www.devarticles.com/c/a/VB.Net/String-Encryption-With-Visual-Basic-.NET/3/)

没有必要使用任何花哨的东西，因为任何人只要有一点技巧和决心，无论如何都会打破它。

# c# - 如何将 DateTimePicker 控件设置为特定日期？

> ID：541225
> 
> 赞同：44
> 
> 时间：2009-02-12T13:31:12.413
> 
> 标签：c#, winforms, datepicker

如何在 C# .NET 2.0 中将 DateTimePicker 控件设置为特定日期（昨天的日期）？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-02-12T13:37:32.930

只需要将 value 属性设置在方便的地方（如`InitializeComponent()`）：

```
 dateTimePicker1.Value = DateTime.Today.AddDays(-1); 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2013-08-08T02:22:06.587

如果要设置日期，DateTimePicker.Value 是 DateTime 对象。

```
DateTimePicker.Value = new DateTime(2012,05,28); 
```

这是 DateTime 的构造函数：

```
new DateTime(int year,int month,int date); 
```

我的视觉是2012

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-12T13:42:16.897

您可以设置“值”属性

```
dateTimePicker1.Value = DateTime.Today; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-10-01T14:15:13.973

不知道为什么，但在某些情况下，如果您已绑定 DataTimePicker 并且 BindingSource 控件已定位到新记录，则设置为 Value 属性不会影响绑定字段，因此当您尝试通过 EndEdit() 方法提交更改时的 BindingSource，您收到 Null 值不允许错误。我通过设置直接 DataRow 字段管理了这个问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-12T13:38:12.600

这应该做。

```
DateTimePicker1.Value = DateTime.Now.AddDays(-1).Date; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T13:44:21.120

使用该`Value`物业。

```
MyDateTimePicker.Value = DateTime.Today.AddDays(-1); 
```

`DateTime.Today`保存今天的日期，您可以从中减去 1 天（加 -1 天）变成昨天。

`DateTime.Now`，另一方面，也包含时间信息。`DateTime.Now.AddDays(-1)`将在一天前返回这个时间。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-14T06:26:33.480

```
dateTimePicker1.Value = DateTime.Today(); 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-10-10T08:32:54.983

此外，我们可以将值分配给设计器类中的控件（即 FormName.Designer.cs）。

```
DateTimePicker1.Value = DateTime.Now; 
```

这样你总能得到当前日期......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-09-21T18:55:47.463

仅供参考：如果您正在设置值，但没有看到任何内容 - 您可能会检查是否设置了“CustomFormat” - 我只是点击了这个，它被设置为 1900 年 1 月 1 日的值（我们的 '未设置'值），如果没有设置为 MM/dd/yyyy。

# c++ - 如何构建捕获所有异常的 C++ Dll 包装器？

> ID：541235
> 
> 赞同：15
> 
> 时间：2009-02-12T13:35:01.470
> 
> 标签：c++, winapi, exception, visual-c++

正如标题所说，我们正在寻找一种方法来从一段 C++ 代码中捕获所有异常，并将其包装在一个 dll 中。通过这种方式，我们可以屏蔽使用此 dll 的应用程序，使其免受此 dll 中发生的任何错误。

但是，这在 Windows 下使用 C++ 似乎是不可能的。

例子：

```
void function()
{  
    try  
    {    
        std::list<int>::iterator fd_it;
        fd_it++;  
    } catch(...) {}
} 
```

发生的异常不会被标准 C++ try/catch 块捕获，也不会被`_set_se_translator()`. 相反，DLL 崩溃，并且使用 DLL 的程序被中止。我们使用 Visual C++ 2005 编译，带有选项 /SHa。有谁知道在 C++/Win32 中是否有可能捕捉到这些问题并制作一个坚如磐石的 DLL 包装器？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-12T15:52:06.430

制作坚如磐石的 DLL 包装器的唯一方法是将有缺陷的 DLL 加载到另一个进程中，这样，如果它崩溃，它不会让您的主进程随之瘫痪。

捕获所有 C++ 异常似乎是合理的，但捕获所有结构化异常是另一回事。SEH*似乎*可以帮助您完成大部分工作，因为它允许您捕获访问冲突、被零除异常等。

但是，如果有缺陷的 DLL 碰巧触及了另一个线程堆栈中未提交的页面怎么办？内存访问将出现页面错误，将调用异常处理程序，现在该页面不再是保护页面。当该线程需要增加堆栈时，它将发生访问冲突，并且进程将崩溃。（[这些](http://blogs.msdn.com/larryosterman/archive/2004/05/18/134471.aspx) [帖子](http://blogs.msdn.com/oldnewthing/archive/2006/09/27/773741.aspx)更详细地描述了这种情况。）

另一个可能的问题：有缺陷的 DLL 在持有同步对象时崩溃，但您使用 SEH 来捕获异常。如果您的进程尝试获取相同的同步对象，那么它会死锁而不是崩溃。共享同步对象可能是 C 运行时或操作系统的一部分：如果有缺陷的 DLL 1 加载有缺陷的 DLL 2，`DllMain()`而有缺陷的 DLL 1 持有加载程序锁时，它会在其中崩溃怎么办？下次加载 DLL 时，您的进程会死锁吗？

有关为什么 this（以及`IsBadReadPtr()`类似问题的函数）是对 SEH 的滥用的更多信息：

*   Larry Osterman 的 WebLog：[结构化异常处理被认为是有害的](http://blogs.msdn.com/larryosterman/archive/2004/09/10/228068.aspx)
*   Larry Osterman 的 WebLog：[我应该检查函数的参数吗？](http://blogs.msdn.com/larryosterman/archive/2004/05/18/134471.aspx)
*   Larry Osterman 的 WebLog：[弹性不一定是好事](http://blogs.msdn.com/larryosterman/archive/2008/05/01/resilience-is-not-necessarily-a-good-thing.aspx)
*   旧事物：[IsBadXxxPtr 真的应该被称为 CrashProgramRandomly](http://blogs.msdn.com/oldnewthing/archive/2006/09/27/773741.aspx)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-12T13:49:32.917

在 Windows 上，C++ 有 2 种不同风格的异常：C++ 和 SEH 异常。

SEH 是一种仅限窗口的异常形式（*有点*类似于 UNIX 中的信号）。它更多的是系统级异常。它们将因无效指针访问、对齐问题等操作而被抛出......

如果您想捕获 Windows 上的 C++ 应用程序可能引发的每个异常，您将需要同时捕获两者。幸运的是，有一种方法可以混合使用 C++ 和 SEH 异常。我最近写了一篇关于这个的详细博客文章，它应该可以帮助你。

[http://blogs.msdn.com/jaredpar/archive/2008/01/11/mixing-seh-and-c-exceptions.aspx](http://blogs.msdn.com/jaredpar/archive/2008/01/11/mixing-seh-and-c-exceptions.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-12T13:39:33.360

在标准库容器上增加迭代器永远不会引发 C++ 异常。它可能会给你未定义的行为。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-13T00:48:43.767

下面的代码取自[Zeus](http://www.zeusedit.com) IDE。它将捕获任何 Windows 生成的异常：

**步骤 #1：**定义异常过滤函数

```
 DWORD ExceptionFilter(EXCEPTION_POINTERS *pointers, DWORD dwException)
  {
    //-- we handle all exceptions
    DWORD dwResult = EXCEPTION_EXECUTE_HANDLER;

    switch (dwException)
    {
      case EXCEPTION_ACCESS_VIOLATION:
      case EXCEPTION_DATATYPE_MISALIGNMENT:
      case EXCEPTION_ARRAY_BOUNDS_EXCEEDED:
      case EXCEPTION_FLT_DENORMAL_OPERAND:
      case EXCEPTION_FLT_DIVIDE_BY_ZERO:
      case EXCEPTION_FLT_INEXACT_RESULT:
      case EXCEPTION_FLT_INVALID_OPERATION:
      case EXCEPTION_FLT_OVERFLOW:
      case EXCEPTION_FLT_STACK_CHECK:
      case EXCEPTION_FLT_UNDERFLOW:
      case EXCEPTION_INT_DIVIDE_BY_ZERO:
      case EXCEPTION_INT_OVERFLOW:
      case EXCEPTION_PRIV_INSTRUCTION:
      case EXCEPTION_NONCONTINUABLE_EXCEPTION:
      case EXCEPTION_BREAKPOINT:
        dwResult = EXCEPTION_EXECUTE_HANDLER;
        break;
    }

    return dwResult;
  } 
```

**步骤#2：**将代码包装在*__try*和*__except*中，如下所示：

```
 __try
  {
    // call your dll entry point here
  }
  __except(ExceptionFilter(GetExceptionInformation(), 
                           GetExceptionCode()))
  {
    //-- display the fatal error message
    MessageBox(0, "An unexpected error was caught here!", 
               "Unexpected Error", MB_OK);
  } 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-12T18:59:01.970

*此*代码包含逻辑错误，如果有的话。由于逻辑错误构成错误，请不要吞下异常 - <strong>修复错误！

当然，这是特定于特定代码的。其他人提供了更一般的建议。然而，我发现很多人确实*更*喜欢捕获异常而不是修复逻辑错误，这简直是不可接受的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-03-12T07:05:54.527

Konrad Rudolph：当然，这段代码包含一个“逻辑错误”，它是为了说明可能发生的问题。就像那个人说的那样，他希望能够保护他的 dll 免受任何可能的错误。你不认为这是一个合理的问题吗？听说过供应商产品。我们中的一些人生活在现实世界中，生活在现实问题中。解决别人的问题是不可能的

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-12T15:45:19.597

你看过windows API函数SetUnhandledExceptionFilter吗？

我通常在 DllMain 函数中调用它，并让它在 DLL 崩溃时生成一个小型转储。但是：(a) 我不知道它是否会捕获应用程序异常以及 DLL 异常，并且 (b) 我不知道您是否可以让处理程序返回以使程序执行可以继续。文档说是的，但我从来没有这样做过。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-20T07:08:57.573

捕捉到异常（尤其是 SEH 异常）后，你打算做什么？

实际上，您不能对进程的状态做出任何假设，实际上您唯一的选择是（可选）转储核心并退出。

从长远来看，任何尝试和进行绝对会给您带来问题。

# jquery - 如何加快 jquery :selected 选择器的速度？

> ID：541236
> 
> 赞同：3
> 
> 时间：2009-02-12T13:35:09.440
> 
> 标签：jquery, performance, selector, selected, selectedindex

我在一个包含 3830 个元素的网页中有一个下拉列表。我知道，过度，但无论如何。

在 jquery 中，我使用以下语句获取选定的选项值：

$( "#institutionCombo :selected" ).val();

在找到选择之前有一个明显的停顿。一旦我得到那个值，我就把它插入到页面上的一个文本框中，所以我知道有多快。另外，我已经使用 Firebug 中的断点对其进行了检查。

如果我去老学校并使用这个javascript：

var div = document.getElementById("maindiv");
var select = div.getElementsByTagName("select")[0];
变量 ix = select.selectedIndex;
var instId = select.options[ ix ].value;

这个速度是瞬间的。

当数字变得太高时，jquery 中是否有一些继承会使 :selected 选择器变得如此缓慢？我想在我的脚本中始终使用 jquery，有没有人建议加快在 jquery 中找到选定的选项？

谢谢，

克雷格

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-12T15:45:25.837

获取选择框的 val 时无需调用 :selected。

默认行为是获取 selectedIndex

```
$( "#institutionCombo").val(); 
```

如评论中所述，如果您需要访问该选项的文本，您可以使用

```
$( "#institutionCombo option[value=" + $( "#institutionCombo").val(); + "]").text(); 
```

虽然如果你知道你需要 text 属性并且它不同于你可能只想直接使用 selectedIndex 的值。

```
var combo = $("#institutionCombo").get(0); 
combo = combo ? combo : {selectedIndex: -1}; // handle no combo returned
if (combo.selectedIndex < 0)
  return; // nothing selected
$('#institutionCombo option:eq(' + combo.selectedIndex + ')').text() 
```

这是来自 jquery 源代码的片段（v1.3）

```
val: function( value ) {
    // ...  
    // We need to handle select boxes special
    if ( jQuery.nodeName( elem, "select" ) ) {
        var index = elem.selectedIndex,
            values = [],
            options = elem.options,
            one = elem.type == "select-one";

        // Nothing was selected
        if ( index < 0 )
            return null;

        // Loop through all the selected options
        for ( var i = one ? index : 0, max = one ? index + 1 : options.length; i < max; i++ ) {
            var option = options[ i ];

            if ( option.selected ) {
                // Get the specifc value for the option
                value = jQuery(option).val();

                // We don't need an array for one selects
                if ( one )
                    return value;

                // Multi-Selects return an array
                values.push( value );
            }
        }

        return values;  
    // ...  
}, 
```

当您调用 :selected 选择器时，该选择器将遍历所有选择元素的后代，寻找要设置的 .selected 属性，并将返回一个任意数组。无论哪种方式，它都会循环所有后代，所以不要这样做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T14:19:23.157

你可以这样做：

var ix = $("#institutionCombo").attr("selectedIndex");

var value = $( "#institutionCombo 选项：eq(" + ix +")" ).val();

但是，这实际上就是您在老式代码中所做的事情。

我很惊讶有一个明显的延迟，因为我认为我上面所做的就是 jQuery 代码为 :selected 选择器所做的。

否则，我想知道是否是导致延迟的语法错误，您可能应该这样做

$("#institutionCombo 选项：选择").val();

（注意选项：selected vs :selected）

# java - 如何为 Web 服务实例分配唯一 ID

> ID：541241
> 
> 赞同：0
> 
> 时间：2009-02-12T13:35:30.470
> 
> 标签：java, jakarta-ee, glassfish, jax-rpc

我想在肥皂请求到达我的（GlassFish 2）服务器后立即为其分配一个唯一标识符。我想我为此使用了一个处理程序。

但是我在哪里可以存储这样的 ID？我需要它来关联来自多个类的日志行。为此，我需要某种上下文对象。任何人的想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T15:00:48.533

你想要的是打开一个与客户端的会话（即有状态的 SOAP 而不是无状态的）。[这篇博文](http://tssblog.blogs.techtarget.com/2007/04/27/stateful-soap-and-beans/)包含一些答案。

您必须将会话 ID 传递给客户端。否则，您无法判断第二个请求是否来自同一个客户端。

# java - 从 JBoss 4.0.1 到 4.2.3 尝试 RMI/HTTP 时出现 NamingException

> ID：541242
> 
> 赞同：0
> 
> 时间：2009-02-12T13:35:41.157
> 
> 标签：java, jboss, ejb, rmi

我有一个应用程序试图调用在 JBoss 4.2.3 GA 上运行的 EJB 上的方法。

该应用程序是旧版应用程序；它在访问在 JBoss 4.0.1 上运行的原始服务器时工作。它的 RMI 代码在 JBoss 4.0.1 的 jbossall-client.jar 中。它正在尝试调用一个方法，该方法将为其提供新代码以允许其自我更新。所以我必须让它按原样工作；我能做的唯一改变是在服务器端。在最坏的情况下，我可能不得不设置一个 4.0.1 JBoss 服务器来处理来自旧版本的这些请求。

但与此同时，我想了解它为什么会失败，以及我是否可以采取任何措施来解决它。

现在它在 new InitialContext() 中失败了。

这是堆栈跟踪：

```
javax.naming.NamingException: Failed to retrieve Naming interface [Root exception is java.lang.NullPointerException]
        at org.jboss.naming.HttpNamingContextFactory.getInitialContext(HttpNamingContextFactory.java:69)
        at javax.naming.spi.NamingManager.getInitialContext(NamingManager.java:667)
        at javax.naming.InitialContext.getDefaultInitCtx(InitialContext.java:247)
        at javax.naming.InitialContext.init(InitialContext.java:223)
        at javax.naming.InitialContext.<init>(InitialContext.java:197)
        at Main.main
Caused by: java.lang.NullPointerException
        at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1820)
        at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1719)
        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1305)
        at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1908)
        at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1832)
        at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1719)
        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1305)
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:348)
        at org.jboss.proxy.ClientContainer.readExternal(ClientContainer.java:148)
        at java.io.ObjectInputStream.readExternalData(ObjectInputStream.java:1755)
        at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1717)
        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1305)
        at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1908)
        at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1832)
        at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1719)
        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1305)
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:348)
        at org.jboss.invocation.MarshalledValue.get(MarshalledValue.java:78)
        at org.jboss.naming.HttpNamingContextFactory.getNamingServer(HttpNamingContextFactory.java:123)
        at org.jboss.naming.HttpNamingContextFactory.getInitialContext(HttpNamingContextFactory.java:65)
        ... 17 more 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-01T08:14:05.397

异常来自使用源代码之外未记录的功能（至少据我所知）。这是将 InvokerURL 指定为在客户端解析的系统属性的地方（如果 JBoss 服务器位于 NAT 内，该功能很有用）。

当客户端没有在其系统属性中定义的属性时，它会抛出 NPE 而不是报告它收到的 InvokerURL 的问题。

# sql - 如何对包含数字、字符、字符的 varchar 列（SQL）进行排序？

> ID：541243
> 
> 赞同：3
> 
> 时间：2009-02-12T13:35:53.930
> 
> 标签：sql, sorting

'Order by' 在下面返回此结果

```
05
05/1-1
05/1-2
05/1-3
05/1-4
05/1-5
05/1-6
05/1-7
05/1
05/2-1
05/2-2
05/2-3
05/2-4
05/2
05/3
05/4

```

下面这个顺序是可以的

```
05
05/1
05/1-1
05/1-2
05/1-3
05/1-4
05/1-5
05/1-6
05/1-7
05/2
05/2-1
05/2-2
05/2-3
05/2-4
05/3
05/4

```

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T13:41:45.447

如果可能，请尝试拆分数据，以便任何数字信息都在其自己的字段中。字符串数据和数值数据一起出现在一个字段中总是会产生字符串类型的数据，所以'A2' > 'A11'。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T13:46:07.433

您需要将 varchar 数据转换/转换为数字数据类型，然后对数据执行排序。

您可能还需要拆分数据字符串，因此按 caluse 的示例顺序可能是：

```
order by 
convert(int,left(columnName,2)) asc, 
convert(int,subtring(columnName,4`,2)) 
```

这将取决于哪些字符串元素代表哪些日期组件。

说得通？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T14:52:24.420

更改表格并添加比较列。编写一个小程序，读取字符串并将它们转换为数据库可以转换的格式。在您的情况下，我猜 DATE 是一个不错的候选人。

在一般情况下，使用 VARCHAR 列并将所有数字格式化为五个（或更多）数字（前导零/空格，即右对齐）。

之后，您可以使用比较列对数据进行排序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T21:23:05.323

如果我是你，我会用一个狡猾的表情来点菜。假设在斜杠之前最多有 2 或 3 位数字。如果你写：

```
order by case charindex('/', val)
           when 0 then convert(int, val)
           else convert(int, substr(val, 1, charindex('/', val) -1)
         end * 1000
           + case charindex('/', val)
               when 0 then 0
               else convert(float, replace(substring(val, 1 + charindex('/', val),
                                                     length(val)), '-', '.'))
             end 
```

如果我没有打错任何东西，下面应该将 05 转换为 5000，将 05/1 转换为 5001，将 05/1-1 转换为 5001.1，并且事情应该按照您想要的方式进行排序，假设您在连字符。否则，您可能可以通过使用适当数量的零进行拆分和左填充来解决它，但表达式会变得更加丑陋......

# jsf - 计算 UIComponent clientID 的有效方法？

> ID：541245
> 
> 赞同：1
> 
> 时间：2009-02-12T13:36:42.197
> 
> 标签：jsf

实际上，在我的 JSF 应用程序中，我有这段代码可以根据其 id 计算组件**clientId**：

```
public static String getComponentClientId(String id) {
  try {
    FacesContext fctx = FacesContext.getCurrentInstance();
    UIComponent found = getComponentWithId(fctx.getViewRoot(), id);
    if (found!=null)
      return found.getClientId(fctx);           
    else
      return null;
  } catch (Exception e) {
    return null;
  }     
}
public static UIComponent getComponentWithId(UIComponent parent, String id) {
  for (Iterator<UIComponent> chs = parent.getFacetsAndChildren(); chs.hasNext();) {
    UIComponent ch = chs.next();
    if (ch.getId().equalsIgnoreCase(id))
     return ch;     
    else {
     UIComponent found = getComponentWithId(ch, id);
     if (found!=null)
       return found;
    }
  }
  return null;
} 
```

该方法有效，但它在视图组件树中导航，因此效率非常低，特别是在存在高度填充的页面时。有一种我不知道的聪明方法或 API 可以让工作更快/更容易吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-14T12:40:26.560

从来没听说过。

很难缓存这些信息，因为：

1.  [UIComponent](http://java.sun.com/javaee/5/docs/api/javax/faces/component/UIComponent.html)的一个实例和它的*clientId*之间的关系可以是 1:N。这对于管理其子状态的[UIData等组件是必需的。](http://java.sun.com/javaee/5/docs/api/javax/faces/component/UIData.html)[getClientId](http://java.sun.com/javaee/5/docs/api/javax/faces/component/UIComponent.html#getClientId(javax.faces.context.FacesContext))的返回值可以是上下文相关的。
2.  *UIComponent*实例的生命周期可能不会超过请求。[StateManager](http://java.sun.com/javaee/5/docs/api/javax/faces/application/StateManager.html)的某些实现可以配置为在会话中保存视图状态，在这种情况下，对象的生命周期*可能*会更长，但是让您的代码依赖它会使其变得脆弱，并且很容易引入内存泄漏。
3.  视图可以是动态的。诚然，这是一种极端情况，但可以通过编程方式[添加、删除和移动组件。](http://java.sun.com/javaee/5/docs/api/javax/faces/component/UIComponent.html#getChildren())

在尝试另一种方法之前，我会证明这是一个问题。

* * *

你没有说你需要*clientId*做什么，但我猜它是为了某种形式的 JavaScript 支持。考虑[编写一个自定义组件](http://java.sun.com/javaee/5/docs/tutorial/doc/bnavg.html)并通过其渲染器发出您的标记。这可以与[for](http://java.sun.com/javaee/5/docs/api/javax/faces/component/html/HtmlOutputLabel.html#setFor(java.lang.String))属性一起使用，类似于[标签控件](http://java.sun.com/javaee/javaserverfaces/1.2_MR1/docs/tlddocs/h/outputLabel.html)。在同一个[NamingContainer](http://java.sun.com/javaee/5/docs/api/javax/faces/component/NamingContainer.html)中找到邻居相对容易。你可以在你的渲染器实现中使用这样的代码：

```
// untested code!
String clientId = mycomponent.getClientId(context);
// get id of target control
String _for = mycomponent.getFor();
int n = clientId.lastIndexOf(NamingContainer.SEPARATOR_CHAR);
String targetClientId = clientId.substring(0, n)
        + NamingContainer.SEPARATOR_CHAR + _for;
ResponseWriter writer = context.getResponseWriter();
// write markup 
```

组件通常需要共享一个命名容器来使用彼此的*clientId*，所以这不是一个很大的限制。如果您可以将组件设为子组件，则更容易找到父组件。

当然，这种方法也有问题。它使您的 UI 树变得更大，对生命周期处理和状态管理产生连锁反应。权衡是否值得需要测试。

* * *

编辑：

我在周末考虑了这个问题。由于 50% 的 JSF 查询似乎是关于如何使用 ID 的，因此我写了一篇文章以便向人们推荐它 - [JSF: working with component IDs](http://illegalargumentexception.blogspot.com/2009/02/jsf-working-with-component-ids.html)。In 包括一种使用一些示例代码缓存 ID 的机制*（有点！） 。*

# gcc - 禁用“tempnam”的任何方法都是危险的，最好使用“mkstemp”gcc 警告？

> ID：541246
> 
> 赞同：19
> 
> 时间：2009-02-12T13:37:13.180
> 
> 标签：gcc, warnings

我仅使用 tempnam() 来获取目录名称，因此此安全警告不适用于我的情况。我怎样才能禁用它？我找不到任何开关来做到这一点。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-12T13:46:54.670

如果您真的只想要目录名称，请使用字符串常量宏`P_tmpdir`，定义在`<stdio.h>`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T13:47:27.600

“tempnam() 函数返回一个指向一个字符串的指针，该字符串是一个有效的文件名，因此当 tempnam() 检查时，具有此名称的文件不存在。”

由于检查和稍后创建文件之间的竞争条件而出现警告。

您只想获取目录名称？那应该有什么好处？

就像陌生人已经说过的那样，您可以使用 -Wno-deprecated-declarations 禁用此（以及类似的警告）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-10-02T17:48:15.063

答案是否定的，因为 - 在许多系统上 - 编译实现此功能的 GNU C 库 (glibc) 以便在使用时触发链接器警告。

看：

*   [关于这个问题的 GCC 错误页面](https://gcc.gnu.org/bugzilla/show_bug.cgi?id=97274)- 我不久前提交了这个。
*   [关于这个问题的 GNU ld 错误页面](https://sourceware.org/bugzilla/show_bug.cgi?id=12017)- 于 2010 年提交！
*   [GNU ld 错误页面建议了解决问题的方法](https://sourceware.org/bugzilla/show_bug.cgi?id=26701)- 我不久前提交了这个。

请注意，该问题并非特定于 GCC - 任何链接器都应该发出此警告，其触发器在编译库中是“硬编码”的。

* * *

## 回答 #4

> 赞同：-5
> 
> 时间：2009-02-12T13:42:56.927

您可以使用 GCC 的`-Wno-deprecated-declarations`选项来禁用所有类似这样的警告。不过，我建议您正确处理警告，并听取编译器的建议。

# c# - 在可移动设备/可移动存储上使用 FolderBrowserDialog

> ID：541247
> 
> 赞同：4
> 
> 时间：2009-02-12T13:37:21.010
> 
> 标签：c#, .net, path, folderbrowserdialog

我正在开发一个简单的复制工具来从数码相机上复制文件。我已经编写了文件复制代码，我已经很好地连接了所有内容。

我遇到的问题似乎与 FolderBrowserDialog 有关。在 Vista 中（我还没有检查过 XP），我可以浏览到相机上的目录。但是，FolderBrowserDialog 不会让我选择相机上的目录。OK 按钮显示为灰色。

查看相机上文件的路径，如下所示：

```
Computer\[Camera Name]\Removable storage\AnotherDirectory\ 
```

由于这不是有效路径（而不是 C:\whatever），我猜 FolderBrowserDialog 不喜欢这样。

它可以从有效的路径名正常工作，但不能在相机之外......

有没有人有任何建议来解决这个问题？

**更新**

为了确认 oefe 的问题，路径实际上显示为：

```
Computer\[Camera Name]\Removable storage\AnotherDirectory\ 
```

ChulioMartinez 使用 SHBrowseForFolder 的建议确实有效，我将标记为正确答案。感谢您的帮助 Chulio。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-14T10:36:52.503

我的猜测是该位置没有文件系统表示（路径），例如 c:...\my camera。

您应该能够获取文件夹的 PIDL（它应该是函数的标志之一），并使用 COM shell 接口实现复制。

[SHBrowseFor文件夹](http://msdn.microsoft.com/en-us/library/bb762115%28VS.85%29.aspx)

[使用 PIDL 枚举文件夹](http://www.gtro.com/delphi/shell_e.php)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T20:56:42.867

有没有办法将相机路径映射到驱动器号？（我正在考虑命令提示符中的“subst”或“net use”之类的东西。）也许这会欺骗 FolderBrowserDialog 使其按预期运行？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-15T10:47:43.207

你从哪里得到的路径？从资源管理器中的地址栏？这不显示文件系统路径，而是它的“用户友好”表示。

要获取路径，请右键单击地址栏，然后选择“将地址复制为文本”或“编辑地址”。

# c# - 为 Null 测试 C# 函数指针（委托）

> ID：541255
> 
> 赞同：0
> 
> 时间：2009-02-12T13:39:34.687
> 
> 标签：c#, function, null, delegates

我正在 C# DLL 中测试一个名为 ErrorLoggingMethod 的函数指针，以防止由于空值引起的异常，如下所示，但似乎在运行时，当我真的想测试其委托是否为空时，该函数实际上正在执行。结果我无意中得到了一个空异常——这正是我想要避免的！我的初衷是帮助程序员以防他们忘记设置该委托。在这种情况下，我想提供一个虚拟功能。如果这不起作用，我如何检查委托是否为空？

```
udt.DatabaseConnectionString = InteractiveDatabaseConnection.AddSQLConnection(udt.ErrorLoggingMethod != null ? udt.ErrorLoggingMethod : CMAC_DummyErrorLoggingMethod); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T13:43:48.437

你确定你没有因为存在而得到例外`udt`吗`null`？您没有在上面的代码中调用任何函数，而是将委托传递给 method `AddSQLConnection`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T13:50:41.773

我可能不明白你在问什么，但是......如果你想知道委托在其调用列表中是否有任何方法，你可以检查列表的长度......

```
if (ErrorLoggingMethod.GetInvocationList().Length(0) == 0){
    //Add your default handler to the delegate
} 
```

然后运行您的 AddSQLConnection 方法...

# actionscript-3 - 销毁数组（）

> ID：541263
> 
> 赞同：0
> 
> 时间：2009-02-12T13:41:11.000
> 
> 标签：actionscript-3

如何释放内存和销毁Array，这样可以吗

```
 myarr = null
  myarr = new Array 
```

myarr 的所有旧内容现在都从记忆中释放了吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T13:45:49.697

假设您在另一个变量中没有对数组的另一个引用，那么当 GC 到达时，数组内存将被恢复。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T14:25:20.957

如果没有更多对该数组对象的引用，则垃圾收集 (GC) 系统会收集它。所以当你问“myarr 的所有旧内容**现在都**从记忆中释放出来了吗？”时，答案是它可能是。但是您无法控制 GC 何时使用 Actionscript 虚拟机运行。

所以说真的，当一个对象没有更多的引用时，下次垃圾收集器运行时，它就会被收集。

当您处理数组时，事情也会变得更加复杂。Array 对象可能会被收集，但这并不意味着 Array 引用的对象也会被清理。Array 引用的对象可能是对这些对象的许多引用之一，例如，该 Array 的副本可能存在于您的系统中，这意味着每个 Array 中的每个对象至少存在两个引用。

另请注意，事件侦听器会阻止对象被垃圾收集，除非它们是*弱*事件侦听器

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-12T13:53:48.117

myarr = 没有

.Net 中的垃圾收集无论如何都会对此进行排序。那是如果你在.NET 中。

# php - 当用户下载文件时在另一台服务器上重命名文件 [2] - 使用 PHP

> ID：541265
> 
> 赞同：0
> 
> 时间：2009-02-12T13:41:42.980
> 
> 标签：php, http, file, redirect, http-headers

我今天已经问过这个问题了，但是这次我想知道我是否可以通过 PHP 来实现这个，因为 Javascript 不适合它。

我有一个指向另一台服务器上的文件的链接。如果我将此链接提供给我的用户，则会推出标头以从该服务器下载该文件。

有没有办法让我捕获这些标头和文件并将下载重定向给用户？我想这样做，以便我可以更改下载的文件名，因为它始终是“file.zip”。

这可以用PHP吗？

感谢您的任何帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T13:47:27.320

[您可以使用curl](http://php.net/curl)将文件下载到您的服务器并正确提供它（使用[Content-Disposition](http://www.ietf.org/rfc/rfc2183.txt)标头）。只要您使用 HTTP，就无法仅发送标头并让另一个服务器将内容直接流式传输到客户端。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T13:48:54.603

你可以做到这一点，你可以通过多种方式做到这一点。

1）（简单）将文件复制到您的服务器，然后重命名。将您的下载链接指向此副本。
2）（更难）创建一个存根php文件，称为，从php中的远程服务器读取文件，并将内容流式传输到脚本输出。这将需要您设置适当的标头等，以及设置您的网络服务器以通过 PHP 进行解析。

说真的，我会选择选项 1。（假设您拥有提供内容的合法权利等）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T13:59:07.463

也许您可以使用类似于以下的脚本：

```
<?php
  header("HTTP/1.1 301 Moved Permanently");
  header("Location: http://www.example.com/the_path/file.zip");
  header('Content-Disposition: attachment; filename="alternate_filename.zip"');
  exit();
?> 
```

# c# - 如何轻松合并两个源文件？

> ID：541277
> 
> 赞同：0
> 
> 时间：2009-02-12T13:44:18.653
> 
> 标签：c#, version-control, merge, diff

我正在与另一位在 VS2005 中使用 C# 的同事一起在一个不太复杂的项目中工作。但是，我们没有版本控制系统，我们互相发送我们的最新版本并将更改复制到我们自己的文件中。

我们现在必须将这两个文件（大部分项目是单个表单文件）合并到项目的最后一个版本中。

有什么建议么？也许尝试差异工具？它必须快速完成，并且可能学习如何使用复杂的修订控制程序是不可行的。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-12T13:48:07.413

关于不使用版本控制的讲座我将不介绍，但最好的办法是尝试使用[WinMerge](http://winmerge.org/)之类的差异工具来比较两个文件的差异，然后手动将你们每个人所做的更改合并到一个文件中.

如果您在各自进行任何更改之前都有一个共同文件，那么您可以使用 3 路合并功能生成一个包含您的两个更改的文件。

有人向我指出 WinMerge 不提供 3 路合并，因此请参阅[其他问题](https://stackoverflow.com/questions/460198/best-free-3-way-merge-tool-for-windows)以找到支持它的工具。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T14:30:17.467

我们使用[BeyondCompare](http://www.scootersoftware.com/) - 我们发现它是一个出色的比较和合并工具。

我知道现在需要速度来生成代码的最终版本。

但是，如果您打算开始另一个项目，那么花时间来设置源代码控制系统确实是值得的。在整个项目过程中，您将节省大量时间！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T13:46:37.057

试试[SourceGear DiffMerge](http://www.sourcegear.com/diffmerge/)。我团队的一些成员甚至使用它来代替 Visual Studio 中的标准比较/合并工具。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T13:48:46.413

我认为 WinMerge 非常适合区分和合并文件。

但是，我*肯定会*建议您为自己获取某种源代码控制系统。CVS、Subversion、Git、Mercurial 等等！！！选择哪一个并不重要，买一个就行了。您几乎可以立即获得及时的投资回报，并且您还将了解在所有严肃的软件开发中至关重要的东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T13:46:16.060

试试[WinMerge](http://winmerge.org/)

> WinMerge 是一个适用于 Windows 的开源差异和合并工具。WinMerge 可以比较文件夹和文件，以易于理解和处理的可视文本格式呈现差异。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-04-24T06:31:37.397

因为我只是在寻找完全不同的东西时发现了这个问题，并注意到 WinMerge 不进行 3 路合并的断言。

这曾经是正确的，但是 WinMerge 是在新的管理下，并且已经有一段时间的 3 路合并了。在撰写本文时，当前的 WinMerge 版本是 2.16.2，可在[WinMerge.Org](http://winmerge.org/downloads/)获得（32 位和 64 位的安装包，以及源代码）。

# java - 如何检索与键关联的所有值？

> ID：541286
> 
> 赞同：0
> 
> 时间：2009-02-12T13:46:00.397
> 
> 标签：java, map

我想获取与 Map 中的键关联的所有值。例如，

```
Map tempMap = new HashMap();
tempMap.put("1","X");
tempMap.put("2","Y");
tempMap.put("3","Z");
tempMap.put("1","ABC");
tempMap.put("2","RR");
tempMap.put("1","RT"); 
```

如何检索与键 1 关联的所有值？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-12T13:49:28.127

您必须了解的是，在 Map 中，键是唯一的。

这意味着之后

```
tempMap.put("1","X"); 
```

“1”映射到“X”

之后

```
tempMap.put("1","ABC"); 
```

“1”映射到“ABC”，之前的值（“X”）丢失

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-12T13:51:45.687

来自 HashMap javadoc：

```
public V put(K key, V value) 
```

> 将指定的值与此映射中的指定键相关联。如果映射先前包含键的映射，**则替换**旧值。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T13:47:47.787

不能

尝试使用[google collections](http://code.google.com/p/google-collections/)的 Multimap

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-12T13:50:00.607

我认为你错过了一些重要的东西：

```
Map tempMap = new HashMap();
tempMap.put("1","X");
tempMap.put("2","Y");
tempMap.put("3","Z");
tempMap.put("1","ABC"); // replaces "X"
tempMap.put("2","RR"); // replaces "Y"
tempMap.put("1","RT"); // replaces "ABC" 
```

此外，您应该尽可能使用泛型，因此您的第一行应该是：

```
Map<String, String> tempMap = new HashMap<String, String>(); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-12T14:02:47.503

你可以做的是：

```
Map<String, List<String>> tempMap = new HashMap<String, List<String>>();
tempMap.put("1", new LinkedList<String>());
tempMap.get("1").add("X");
tempMap.get("1").add("Y");
tempMap.get("1").add("Z");

for(String value : tempMap.get("1")) {
  //do something
} 
```

这会将对应于键“1”的值划分到它们自己的列表中，您可以轻松访问该列表。只是不要忘记初始化列表...... else`NullPointerException`会来找你。

尤瓦尔=8-)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T14:04:08.433

为此，您必须将每个键与一组值相关联，并使用相应的逻辑来创建集合并从中输入/删除值，而不是 Map 上的简单 put() 和 get()。

或者您可以使用其中一种现成的 Multimap 实现，例如[Apache commons 中的一种](http://commons.apache.org/collections/api-3.1/org/apache/commons/collections/MultiMap.html)。

# c - Objective-C：BOOL vs bool

> ID：541289
> 
> 赞同：199
> 
> 时间：2009-02-12T13:46:05.263
> 
> 标签：c, objective-c, types, boolean

我看到了“新类型” `BOOL`（`YES`, `NO`）。

我读到这种类型几乎就像一个字符。

为了测试我做了：

```
NSLog(@"Size of BOOL %d", sizeof(BOOL));
NSLog(@"Size of bool %d", sizeof(bool)); 
```

很高兴看到两个日志都显示“1”（有时在 C++ 中 bool 是一个 int 并且它的 sizeof 是 4）

所以我只是想知道 bool 类型是否有问题？

我可以只使用 bool （这似乎有效）而不会失去速度吗？

* * *

## 回答 #1

> 赞同：206
> 
> 时间：2009-02-13T00:43:21.050

根据 中的定义`objc.h`：

```
#if (TARGET_OS_IPHONE && __LP64__)  ||  TARGET_OS_WATCH
typedef bool BOOL;
#else
typedef signed char BOOL; 
// BOOL is explicitly signed so @encode(BOOL) == "c" rather than "C" 
// even if -funsigned-char is used.
#endif

#define YES ((BOOL)1)
#define NO  ((BOOL)0) 
```

所以，是的，你可以假设 BOOL 是一个字符。您可以使用 (C99)`bool`类型，但是 Apple 的所有 Objective-C 框架和大多数 Objective-C/Cocoa 代码都使用 BOOL，因此如果仅使用 BOOL 改变了 typedef，您将不会感到头疼。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2011-06-22T09:01:43.600

如上所述，BOOL 是有符号字符。bool - 来自 C99 标准 (int) 的类型。

布尔 - 是/否。布尔 - 真/假。

查看示例：

```
bool b1 = 2;
if (b1) printf("REAL b1 \n");
if (b1 != true) printf("NOT REAL b1 \n");

BOOL b2 = 2;
if (b2) printf("REAL b2 \n");
if (b2 != YES) printf("NOT REAL b2 \n"); 
```

结果是

> **真实 b1
> 真实 b2
> 非真实 b2**

注意 bool != BOOL。以下结果仅是**ONCE AGAIN - REAL b2**

```
b2 = b1;
if (b2) printf("ONCE AGAIN - REAL b2 \n");
if (b2 != true) printf("ONCE AGAIN - NOT REAL b2 \n"); 
```

如果你想将 bool 转换为 BOOL 你应该使用下一个代码

```
BOOL b22 = b1 ? YES : NO; //and back - bool b11 = b2 ? true : false; 
```

所以，在我们的例子中：

```
BOOL b22 = b1 ? 2 : NO;
if (b22)    printf("ONCE AGAIN MORE - REAL b22 \n");
if (b22 != YES) printf("ONCE AGAIN MORE- NOT REAL b22 \n"); 
```

所以..我们现在得到了什么？:-)

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2015-10-30T15:24:43.380

在撰写本文时，这是 objc.h 的最新版本：

```
/// Type to represent a boolean value.
#if (TARGET_OS_IPHONE && __LP64__)  ||  TARGET_OS_WATCH
#define OBJC_BOOL_IS_BOOL 1
typedef bool BOOL;
#else
#define OBJC_BOOL_IS_CHAR 1
typedef signed char BOOL; 
// BOOL is explicitly signed so @encode(BOOL) == "c" rather than "C" 
// even if -funsigned-char is used.
#endif 
```

这意味着在 64 位 iOS 设备和 WatchOS上与在所有其他设备（OS X、32 位 iOS）上`BOOL`完全一样，它甚至不能被编译器标志覆盖`bool``signed char``-funsigned-char`

这也意味着这个示例代码将在不同的平台上以不同的方式运行（我自己测试过）：

```
int myValue = 256;
BOOL myBool = myValue;
if (myBool) {
    printf("i'm 64-bit iOS");
} else {
    printf("i'm 32-bit iOS");
} 
```

顺便说一句，从不将诸如变量之类的东西分配`array.count`给`BOOL`变量，因为大约 0.4% 的可能值将是负数。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-12T14:08:32.997

您应该使用的 Objective-C 类型是`BOOL`. 没有什么能比得上原生布尔数据类型，因此要确保代码在所有使用`BOOL`. （它在 Apple 框架中定义。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-12T14:02:00.140

是的，BOOL 是根据 objc.h 的有符号字符的 typedef。

不过，我不知道布尔。那是 C++ 的东西，对吧？如果它被定义为一个有符号的字符，其中 1 是 YES/true 而 0 是 NO/false，那么我想你使用哪个并不重要。

但是，由于 BOOL 是 Objective-C 的一部分，因此为了清楚起见，使用 BOOL 可能更有意义（如果其他 Objective-C 开发人员看到使用了 bool，他们可能会感到困惑）。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-05-08T08:12:46.723

bool 和 BOOL 之间的另一个区别是，当您进行键值观察或使用 -[NSObject valueForKey:] 之类的方法时，它们不会完全转换为相同类型的对象。

正如大家在这里所说，BOOL 是字符。因此，它被转换为一个 NSNumber 持有一个字符。该对象与从常规字符（如“A”或“\0”）创建的 NSNumber 无法区分。您已经完全丢失了最初拥有 BOOL 的信息。

但是，bool 被转换为 CFBoolean，其行为与 NSNumber 相同，但保留了对象的布尔值原点。

我不认为这是 BOOL 与 bool 辩论中的争论，但这可能有一天会咬你一口。

一般来说，您应该使用 BOOL，因为这是 Cocoa/iOS API 中随处使用的类型（在 C99 及其本机 bool 类型之前设计）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-02-13T13:20:10.657

已接受的答案已被编辑，其解释变得有点不正确。代码示例已刷新，但下面的文本保持不变。你现在不能假设 BOOL 是一个字符，因为它取决于架构和平台。因此，如果您在 32 位平台（例如 iPhone 5）上运行代码并打印 @encode(BOOL)，您将看到“c”。它对应一个[char 类型](https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html)。但是，如果您在 iPhone 5s（64 位）上运行代码，您将看到“B”。它对应于一个[bool 类型](https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html)。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-12-11T22:51:26.550

如上所述，取决于您的架构，它`BOOL`可能是一种类型，而类型是. 一个简单的实验将展示 BOOL 和 bool 行为不同的原因：`unsigned char``bool``int`

```
bool ansicBool = 64;
if(ansicBool != true) printf("This will not print\n");

printf("Any given vlaue other than 0 to ansicBool is evaluated to %i\n", ansicBool);

BOOL objcBOOL = 64;
if(objcBOOL != YES) printf("This might print depnding on your architecture\n");

printf("BOOL will keep whatever value you assign it: %i\n", objcBOOL);

if(!objcBOOL) printf("This will not print\n");

printf("! operator will zero objcBOOL %i\n", !objcBOOL);

if(!!objcBOOL) printf("!! will evaluate objcBOOL value to %i\n", !!objcBOOL); 
```

令您惊讶`if(objcBOOL != YES)`的是，编译器将评估为 1，因为`YES`实际上是字符代码 1，并且在编译器的眼中，**字符代码 64 当然*不等于*字符代码 1**，因此 if 语句将评估为`YES/true/1`，以下行将跑。但是，由于非零`bool`类型始终计算为整数值 1，因此上述问题不会影响您的代码。如果您想使用`Objective-C BOOL`类型与`ANSI C bool`类型，以下是一些很好的提示：

*   始终分配`YES`or`NO`值，仅此而已。
*   `BOOL`使用 double not运算符转换类型`!!`以避免意外结果。
*   在检查`YES`使用`if(!myBool) instead of if(myBool != YES)`时，使用 not 运算符会更干净，`!`并给出预期的结果。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-04-05T17:15:51.347

我在这里违反惯例。我不喜欢 typedef 的基本类型。我认为这是一个无用的间接删除价值。

1.  当我在您的源代码中看到基本类型时，我会立即理解它。如果它是 typedef，我必须查找它以查看我真正处理的内容。
2.  当移植到另一个编译器或添加另一个库时，它们的 typedef 集可能会发生冲突并导致难以调试的问题。事实上，我刚刚处理完这个问题。在一个库中，布尔值被定义为 int，而在 mingw/gcc 中，它被定义为字符。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-08-29T20:29:21.280

此外，请注意转换的差异，尤其是在使用位掩码时，由于转换为签名字符：

```
bool a = 0x0100;
a == true;  // expression true

BOOL b = 0x0100;
b == false; // expression true on !((TARGET_OS_IPHONE && __LP64__) || TARGET_OS_WATCH), e.g. MacOS
b == true;  // expression true on (TARGET_OS_IPHONE && __LP64__) || TARGET_OS_WATCH 
```

如果 BOOL 是有符号字符而不是布尔值，则将 0x0100 转换为 BOOL 只会删除设置位，结果值为 0。

# c# - 在 C# Web 服务上，我可以找到一个唯一的线程 ID 或一些用于日志记录的 ID？

> ID：541293
> 
> 赞同：0
> 
> 时间：2009-02-12T13:46:47.150
> 
> 标签：c#, .net, web-services, multithreading

我在 C# .NET 3.5 中运行 Web 服务。我想记录各种电话。然而，由于许多用户同时使用相同的功能，因此很难判断哪个日志调用属于哪个。

在 C++ 生活中，我们使用了线程 ID。C# 中的等价物是什么？

我试过了

```
System.Diagnostics.Process proc = System.Diagnostics.Process.GetCurrentProcess();
proc.Id; 
```

但是，这每次都会让我得到相同的 ID。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T13:48:39.627

可能是 Thread.CurrentThread.ManagedThreadId

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-14T19:22:38.043

如果您使用 MS Ent Lib 和他们的记录器，您可以使用 Tracer 类来获得一些不错的日志记录：

例子

```
public Output MyServiceMethod(Input input, string transactionId)
{
    using(new Tracer("MyServiceMethod: " + transactionId))
    {
        ... stuff ...
        return output;
    }
} 
```

您甚至可以嵌套示踪剂。using 中的所有日志记录都将具有您为 Tracer 构造函数提供的字符串作为扩展属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T13:49:41.840

您可以使用`Thread.CurrentThread.ManagedThreadId`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T13:51:12.803

我会用

```
System.Threading.Thread.CurrentThread.ManagedThreadId 
```

此外，由于这是一项 Web 服务，如果客户端来自不同的 IP 地址，您也可以将其记录下来，这可能有助于记录/诊断。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-14T09:31:16.780

如果您使用一些日志框架，例如 log4net，您会注意到线程 ID 会自动为您记录。

这很容易开始。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-14T19:01:39.920

看看 ASP.NET 健康监控。请参阅[ASP.NET 运行状况监视概述](http://msdn.microsoft.com/en-us/library/bb398933.aspx)。它默认记录的事件包含比您可能想要的更多信息：

```
日志名称：应用程序
来源：ASP.NET 2.0.50727.0
日期：2/12/2009 12:57:14
事件编号：1309
任务类别：网络事件
级别：警告
关键词：经典
用户：不适用
电脑：笔记本电脑
描述：
事件代码：3005
事件消息：发生未处理的异常。
活动时间：2/12/2009 12:57:14
活动时间（UTC）：2/12/2009 17:57:14
事件 ID：b08e9d3be7364690a660254dc0a29b6d
事件顺序：5
事件发生：4
事件详细代码：0

应用信息：
    应用域：bba4cebc-1-128789349683310000
    信任级别：完全
    应用程序虚拟路径：/
    应用程序路径：C:\Users\John Saunders\Documents\MVP\projects\WebServices\GeneralSoln\WebService1\
    机器名称：笔记本电脑

处理信息：
    进程号：11560
    进程名称：WebDev.WebServer.exe
    帐户名称：笔记本电脑\约翰桑德斯

异常信息：
    异常类型：MissingMethodException
    异常消息：找不到方法：'无效 System.ServiceModel.Diagnostics.EventLogger.UnsafeLogEvent（System.Diagnostics.TraceEventType，System.ServiceModel.Diagnostics.EventLogCategory，System.ServiceModel.Diagnostics.EventLogEventId，Boolean，System.String[]）' .

索取资料：
    请求网址：http://localhost:5305/Enumerations.asmx
    请求路径：/Enumerations.asmx
    用户主机地址：127.0.0.1
    用户：  
    是否经过身份验证：假
    认证类型：  
    线程帐户名称：Laptop\John Saunders

线程信息：
    线程 ID：4
    线程帐户名称：Laptop\John Saunders
    是否冒充：假
    堆栈跟踪：在 System.Runtime.CompilerServices.RuntimeHelpers.PrepareDelegate(Delegate d)
   在 System.AppDomain.add_UnhandledException（UnhandledExceptionEventHandler 值）
   在 System.ServiceModel.ServiceHostingEnvironment.HookADUnhandledExceptionEvent()
   在 System.ServiceModel.ServiceHostingEnvironment.EnsureInitialized()
   在 System.ServiceModel.ServiceHostingEnvironment.OnEnsureInitialized（对象状态）
   在 System.ServiceModel.PartialTrustHelpers.PartialTrustInvoke（ContextCallback 回调，对象状态）
   在 System.ServiceModel.ServiceHostingEnvironment.SafeEnsureInitialized()
   在 System.ServiceModel.Activation.HttpModule.ProcessRequest（对象发送者，EventArgs e）
   在 System.Web.HttpApplication.SyncEventExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()
   在 System.Web.HttpApplication.ExecuteStep（IExecutionStep 步骤，Boolean& completedSynchronously）

自定义活动详情：

事件 XML：

```

# wpf - 如何在 WPF 中将 Canvas 合并到更大的布局中？

> ID：541295
> 
> 赞同：1
> 
> 时间：2009-02-12T13:46:57.040
> 
> 标签：wpf, canvas

当您尝试将 Canvas 构建到布局中并在侧面具有例如控件并且 Canvas 是绘图区域时，Canvas 似乎不能很好地与其他元素一起使用。

例如，为什么我可以在除画布之外的每个元素周围设置边框？在以下代码中，边框包裹了画布，但画布仅在顶部有边框，而在左侧、右侧或底部没有边框：

```
<Window x:Class="WpfApplication25.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
    <StackPanel>

        <TextBlock DockPanel.Dock="Bottom" Text="Move the slider to reveal the answer:"/>
        <Slider DockPanel.Dock="Bottom" Name="theSlider" 
            HorizontalAlignment="Left" 
            Width="200" 
            Minimum="0" 
            Maximum="1" 
            Value="1" 
            Cursor="Hand"/>

        <Border BorderBrush="Tan" BorderThickness="2">
            <Canvas>
                <TextBlock Canvas.Left="45" Canvas.Top="50" Text="test" FontSize="16"/>
                <Rectangle 
                    Canvas.Left="10" 
                    Canvas.Top="10" 
                    Width="100" 
                    Height="100" 
                    Fill="Silver" 
                    Opacity="{Binding ElementName=theSlider, Path=Value}"
                    />
            </Canvas>
        </Border>
    </StackPanel>
</Window> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T14:07:05.293

从我在 XamlPad 中可以看出，问题似乎是您的 Canvas 没有明确的高度/宽度，并且它的 Horizo​​ntalAlignment 默认位于边框的中间。如果没有明确的高度和宽度，边框似乎会折叠到 0 高度并在宽度上延伸。我的假设是这是因为您的 Border 位于 StackPanel 中，因为将 Border 放置在 Grid 中会使其按预期运行。

你最好的选择是给画布一个明确的高度和宽度。不确定那是您正在寻找的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T15:40:15.117

据我了解您要实现的目标，您应该将控件放在 Grid 的一个单元格中，将 Canvas 放在另一个单元格中。

# c - Eclipse CDT 和未知标签

> ID：541314
> 
> 赞同：3
> 
> 时间：2009-02-12T13:49:03.760
> 
> 标签：c, eclipse, makefile, eclipse-cdt

目前，我们正在考虑将我们的开发环境从 CodeWright（早已被 Borland 抛弃）迁移到 Eclipse。我们正在使用 Eclipse 进行 Perl、PHP 和一些 Windows C++ 开发，并取得了很大的成功。

然而，问题出现在我们的嵌入式环境中，它在 makefile 中使用了一些 Excel 似乎无法理解的定义。这是一个示例（更改了值以保护有罪者）：

```
F_FOO unsigned char foo(ptr *this)
{
} 
```

其中 F_FOO 在 makefile 中定义为

```
F_FOO=@foobar 
```

Eclipse 将突出显示 F_FOO 并将其标记为语法错误。这会导致各种可追溯的悲伤。

在某种程度上，这也发生在 Builder C++ 中的一些代码中，其中 Eclipse 不知道如何处理关键字**__fastcall。**

对此的任何帮助（我知道我们不能成为唯一遇到此问题的人）将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T14:34:59.010

我们在 header 指令中尝试了#defines，但由于项目的大小以及文件的绝对数量，结果证明这是一种不太实用的方法。

围绕 Eclipse 工具，我们找到了一个适合我们的解决方案，详细信息如下：

1.  右键单击有问题的项目。
2.  选择结果菜单底部的属性。
3.  展开 C/C++ 通用
4.  选择路径和符号
5.  在符号下添加违规符号（将值留空）

这对我们有用。我们现在已经恢复了我们软件的完全可追溯性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T18:53:40.470

您可以为 Eclipse 不知道的内容创建一个包含在#defines 中的头文件。然后作为构建的一部分，让它使用该头文件的空版本，因此它实际上并不使用这些定义。

# entity-framework - 实体框架：模型不反映数据库

> ID：541320
> 
> 赞同：0
> 
> 时间：2009-02-12T13:50:23.040
> 
> 标签：entity-framework

我可能认为这一切都错了，但我有以下数据库表：

![替代文字](https://1ponbw.bay.livefilestore.com/y1pUw3xaKZ7RhtNS3GiC5F1NYMad5ZeYI8Wh-jZ8CDajt7MiKO-6vhVmEm8VhlXMkDZTQz9t5gP4gnskgbvDtAYTA/DBImage.jpg)

当我在 VS2008 中运行 EF 向导时，我得到以下模型：

![替代文字](https://1ponbw.bay.livefilestore.com/y1pY5xK0aw6ckqcY5IPaIc45Rfjhy-CSMpdd_l4z-4mMGKbhd5N9VIySd72t-0LXBkYseQY0D2W5mEUUaDzhntcQA/EFImage.jpg)

您会注意到，在 EF 模型中，Entity 没有 EntityTypeID 或 EntityStatusId 字段。相反，它将其显示为导航属性，因此当我实例化实体时，该字段似乎不可寻址（请原谅术语混淆：实体是我的命名空间中的表/类，而不是 EF 命名空间中的）。实例化实体时如何分配 EntityTypeID 和 StatusTypeID？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T14:01:12.483

是的，实体框架隐藏了外键 ID 属性并改为显示导航属性。关于它为什么这样做，[这里](http://blogs.msdn.com/efdesign/archive/2008/10/27/foreign-keys-in-the-conceptual-and-object-models.aspx "概念模型和对象模型中的外键")有一个冗长的讨论。分配对另一个实体的引用的常用方法是分配实体实例，而不是外键 ID 值，如下所示：

```
var foo = new Entity();
var status = (from .... select ...).FirstOrDefault();
foo.StatusCodes = status; 
```

但是，如果您碰巧知道它是什么，则可以直接分配外键 ID：

```
foo.StatusCodesReference = new EntityKey(
   "MyEntityContextName.StatusCodesEntitySetName", "StatusCodeId", value); 
```

显然，替换上面的实际值。

# mysql - 将 MySQL 视图转储为包含数据的表

> ID：541322
> 
> 赞同：12
> 
> 时间：2009-02-12T13:50:56.377
> 
> 标签：mysql, view, export

假设我的数据库中有一个视图，并且我想将一个文件发送给某人以将该视图的输出创建为他们数据库中的一个表。

mysqldump 当然只导出 'create view...' 语句（好吧，它包括创建表，但没有数据）。

我所做的只是将视图复制为真实表并将其转储。但是对于一张大桌子来说，它既慢又浪费：

```
create table tmptable select * from myview 
```

如果没有创建一个模仿 mysqldump 行为的脚本并执行此操作，是否有更好的方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T14:02:28.110

一种选择是对 CSV 文件进行查询并将其导入。要选择 CSV 文件：

来自[http://www.tech-recipes.com/rx/1475/save-mysql-query-results-into-a-text-or-csv-file/](http://www.tech-recipes.com/rx/1475/save-mysql-query-results-into-a-text-or-csv-file/)

```
SELECT order_id,product_name,qty
FROM orders
INTO OUTFILE '/tmp/orders.csv'
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n' 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-19T17:08:53.353

好的，所以根据您的 CSV 失败评论，从 Paul 的回答开始。对其进行以下更改：

```
 - FIELDS TERMINATED BY ','
 + FIELDS TERMINATED BY ',' ESCAPED BY '\' 
```

完成后，在导入方面，您将执行“加载数据文件”并使用相同的终止/封闭/转义语句。

# .net - .NET ORMs - NHibernate（或 SubSonic 或其他）使用实体框架有什么优势？

> ID：541327
> 
> 赞同：5
> 
> 时间：2009-02-12T13:52:29.493
> 
> 标签：.net, nhibernate, entity-framework, orm

我想知道，不使用内置实体框架的主要原因是什么？

我读过它不喜欢它，因为它的实施不好，但这就是全部吗？它仍然是真的吗？（我不记得文章的发布日期）

我知道有很多选择，但我为什么要考虑切换？我对 EF 只有一点经验，我找不到任何好的论据来说明何时使用什么，或者为什么（不）使用什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T13:55:46.693

看看这里，任何其他细节都给我们留言

[何时不使用实体框架](https://stackoverflow.com/questions/517600/when-not-to-use-the-entity-framework)

# python - 是否可以以编程方式构造 Python 堆栈帧并在代码中的任意点开始执行？

> ID：541329
> 
> 赞同：22
> 
> 时间：2009-02-12T13:53:02.923
> 
> 标签：python, serialization, stack, continuations, python-stackless

是否可以在 CPython 中以编程方式构造一个堆栈（一个或多个堆栈帧）并在任意代码点开始执行？想象以下场景：

1.  您有一个工作流引擎，其中的工作流可以用 Python 编写脚本，其中包含一些调用工作流引擎的结构（例如分支、等待/加入）。

2.  阻塞调用（例如等待或加入）在具有某种持久后备存储的事件调度引擎中设置侦听器条件。

3.  您有一个工作流脚本，它调用引擎中的等待条件，等待稍后将发出信号的某些条件。这会在事件分派引擎中设置侦听器。

4.  工作流脚本的状态，包括程序计数器（或等效状态）在内的相关堆栈帧被保留 - 因为等待条件可能会在几天或几个月后发生。

5.  在此期间，工作流引擎可能会停止并重新启动，这意味着必须能够以编程方式存储和重建工作流脚本的上下文。

6.  事件调度引擎触发等待条件拾取的事件。

7.  工作流引擎读取序列化状态和堆栈，并使用堆栈重建线程。然后它在调用等待服务的地方继续执行。

**问题**

这可以用未经修改的 Python 解释器来完成吗？更好的是，谁能指出一些可能涵盖此类事情的文档或以编程方式构造堆栈帧并在代码块中间某处开始执行的代码示例？

**编辑：**为了澄清“未修改的 python 解释器”，我不介意使用 C API（PyThreadState 中是否有足够的信息来做到这一点？）但我不想去探索 Python 解释器的内部结构并拥有建立一个修改过的。

**更新：**通过一些初步调查，可以使用`PyThreadState_Get()`. 这将返回 a 中的线程状态`PyThreadState`（在 中定义`pystate.h`），该状态具有对 中的堆栈帧的引用`frame`。堆栈帧保存在 struct typedef'd to 中`PyFrameObject`，该结构定义在`frameobject.h`. `PyFrameObject`有一个字段`f_lasti`（对[bobince](https://stackoverflow.com/questions/541329/is-it-possible-to-programatically-construct-a-python-stack-frame-and-start-execut/541529#541529)的道具），它有一个程序计数器，表示为距代码块开头的偏移量。

最后一点是个好消息，因为这意味着只要您保留实际编译的代码块，您就应该能够根据需要为尽可能多的堆栈帧重建局部变量并重新启动代码。我想说这意味着理论上可以不必修改python解释器，尽管这意味着代码仍然可能会与特定版本的解释器紧密耦合。

剩下的三个问题是：

*   事务状态和“传奇”回滚，这可能可以通过一种用于构建 O/R 映射器的元类黑客来完成。我确实构建了一次原型，所以我对如何实现这一点有一个很好的了解。

*   稳健地序列化事务状态和任意局部变量。这可以通过读取`__locals__`（可从堆栈帧中获得）并以编程方式构造对 pickle 的调用来完成。但是，我不知道这里可能存在什么问题（如果有的话）。

*   工作流的版本控制和升级。这有点棘手，因为系统没有为工作流节点提供任何符号锚。我们只有锚点 为了做到这一点，我们必须识别所有入口点的偏移量并将它们映射到新版本。手动操作可能可行，但我怀疑很难自动化。如果您想支持此功能，这可能是最大的障碍。

**更新 2：** `PyCodeObject` ( `code.h`) 中有一个 addr ( `f_lasti`)-> 行号映射列表`PyCodeObject.co_lnotab`（如果此处错误，请纠正我）。这可能用于促进将工作流更新到新版本的迁移过程，因为冻结的指令指针可以映射到新脚本中的适当位置，根据行号完成。仍然很混乱，但更有希望。

**更新 3：**我认为这个问题的答案可能是[Stackless Python。](http://www.stackless.com) 您可以暂停任务并将它们序列化。我还没有弄清楚这是否也适用于堆栈。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-12T14:13:19.957

普通 Python 发行版中包含的 expat python 绑定以编程方式构建堆栈帧。但请注意，它依赖于未记录和私有的 API。

[http://svn.python.org/view/python/trunk/Modules/pyexpat.c?rev=64048&view=auto](http://svn.python.org/view/python/trunk/Modules/pyexpat.c?rev=64048&view=auto)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-12T16:59:17.187

您通常想要的是延续，我看到这已经是这个问题的一个标签。

如果您有能力使用系统中的所有代码，您可能想尝试这样做，而不是处理解释器堆栈内部。我不确定这将是多么容易持久。

[http://www.ps.uni-sb.de/~duchier/python/continuations.html](http://www.ps.uni-sb.de/~duchier/python/continuations.html)

在实践中，我会构建您的工作流引擎，以便您的脚本将操作对象提交给经理。经理可以在任何时候腌制一组动作，并允许它们被加载并再次开始执行（通过恢复提交动作）。

换句话说：创建自己的应用程序级堆栈。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-01-25T13:04:32.403

Stackless python 可能是最好的……如果你不介意完全转向不同的 python 发行版。`stackless`可以序列化python 中的**所有内容**，以及它们的 tasklet。如果你想留在标准的 python 发行版中，那么我会使用[dill](https://github.com/uqfoundation/dill)，它可以序列化python 中的**几乎**任何东西。

```
>>> import dill
>>> 
>>> def foo(a):
...   def bar(x):
...     return a*x
...   return bar
... 
>>> class baz(object):
...   def __call__(self, a,x):
...     return foo(a)(x)
... 
>>> b = baz()
>>> b(3,2)
6
>>> c = baz.__call__
>>> c(b,3,2)
6
>>> g = dill.loads(dill.dumps(globals()))
>>> g
{'dill': <module 'dill' from '/Library/Frameworks/Python.framework/Versions/7.2/lib/python2.7/site-packages/dill-0.2a.dev-py2.7.egg/dill/__init__.pyc'>, 'c': <unbound method baz.__call__>, 'b': <__main__.baz object at 0x4d61970>, 'g': {...}, '__builtins__': <module '__builtin__' (built-in)>, 'baz': <class '__main__.baz'>, '_version': '2', '__package__': None, '__name__': '__main__', 'foo': <function foo at 0x4d39d30>, '__doc__': None} 
```

Dill 将它的类型注册到`pickle`注册表中，因此如果您有一些使用的黑盒代码`pickle`并且您无法真正编辑它，那么只需导入 dill 就可以神奇地使其工作而无需猴子修补第 3 方代码。

这是`dill`腌制整个口译会话...

```
>>> # continuing from above
>>> dill.dump_session('foobar.pkl')
>>>
>>> ^D
dude@sakurai>$ python
Python 2.7.5 (default, Sep 30 2013, 20:15:49) 
[GCC 4.2.1 (Apple Inc. build 5566)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import dill
>>> dill.load_session('foobar.pkl')
>>> c(b,3,2)
6 
```

`dill`还有[一些很好的工具](https://github.com/uqfoundation/dill/blob/master/dill/detect.py)可以帮助您了解在代码失败时导致酸洗失败的原因。

您还询问了它用于保存解释器状态的位置？

[IPython](https://github.com/ipython/ipython)可以`dill`用来将解释器会话保存到文件中。[https://nbtest.herokuapp.com/github/ipython/ipython/blob/master/examples/parallel/Using%20Dill.ipynb](https://nbtest.herokuapp.com/github/ipython/ipython/blob/master/examples/parallel/Using%20Dill.ipynb)

[klepto](https://github.com/uqfoundation/klepto)用于`dill`支持避免重新计算的内存、磁盘或数据库缓存。[https://github.com/uqfoundation/klepto/blob/master/tests/test_cache_info.py](https://github.com/uqfoundation/klepto/blob/master/tests/test_cache_info.py)

[mystic](https://github.com/uqfoundation/mystic)通过`dill`保存优化器的状态来保存大型优化作业的检查点，因为它正在进行中。[https://github.com/uqfoundation/mystic/blob/master/tests/test_solver_state.py](https://github.com/uqfoundation/mystic/blob/master/tests/test_solver_state.py)

还有其他几个包用于`dill`保存对象或会话的状态。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-12T14:37:18.730

您可以通过抛出异常并在回溯中向后退一帧来获取现有的堆栈帧。问题是没有办法在代码块的中间（frame.f_lasti）恢复执行。

“可恢复异常”是一个非常有趣的语言理念，尽管很难想出一种合理的方式来与 Python 现有的“try/finally”和“with”块进行交互。

目前，执行此操作的正常方法是简单地使用线程在与其控制器的单独上下文中运行您的工作流。（如果你不介意编译它们，或者协程/greenlets）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-09-12T14:31:32.223

使用标准 CPython，堆栈中 C 和 Python 数据的混合会使这变得复杂。重建调用堆栈需要同时重建 C 堆栈。这确实把它放在了太难的篮子里，因为它可能将实现与特定版本的 CPython 紧密耦合。

Stackless Python 允许对 tasklet 进行腌制，这提供了开箱即用的大部分功能。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-10-06T02:48:16.313

我有同样类型的问题要解决。我想知道原始海报决定做什么。

stackless 声称只要没有关联的“受阻”C 堆栈（受阻是我选择的措辞），它就可以腌制小任务。

我可能会使用 eventlet 并找出某种腌制“状态”的方法，但我真的不想写一个明确的状态机..

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-07-01T12:58:26.830

使用[joblib](http://pythonhosted.org/joblib/)怎么样？

我不太确定这是您想要的，但它似乎符合拥有可以保留哪些阶段的工作流的想法。Joblib 的用例似乎是为了避免重新计算，我不确定这是您在这里尝试做的还是更复杂的事情？

# c# - 在没有外部dll的情况下制作图像负片的有效方法

> ID：541331
> 
> 赞同：4
> 
> 时间：2009-02-12T13:53:54.060
> 
> 标签：c#, .net, winforms, gdi+, imaging

这是在没有任何 dll 的情况下以有效、快速的方式从 C# Windows 窗体中的图像制作底片的解决方案吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-16T01:38:31.117

最好的方法是使用位图数据直接访问像素。

只是添加一些时间细节：

对 8 兆像素图像执行取反（在 2.4 Ghz Core 2 Duo 上）：

*   SetPixel (~22 秒) - 慢 220 倍
*   颜色矩阵，下面的 Matajon 方法（~750 毫秒） - 慢 7 倍
*   直接访问位图数据（~100 毫秒） - 最快

所以，如果你不能有不安全的代码，那么 Color Matrix 比 SetPixel 要好得多。

```
 public static void Negate(Bitmap image)
    {
        const int RED_PIXEL = 2;
        const int GREEN_PIXEL = 1;
        const int BLUE_PIXEL = 0;

        BitmapData bmData = currentImage.LockBits(new Rectangle(0, 0, image.Width, image.Height), ImageLockMode.ReadWrite, image.PixelFormat);

        try
        {
            int stride = bmData.Stride;
            int bytesPerPixel = (currentImage.PixelFormat == PixelFormat.Format24bppRgb ? 3 : 4);

            unsafe
            {
                byte* pixel = (byte*)(void*)bmData.Scan0;
                int yMax = image.Height;
                int xMax = image.Width;

                for (int y = 0; y < yMax; y++)
                {
                    int yPos = y * stride;
                    for (int x = areaSize.X; x < xMax; x++)
                    {
                        int pos = yPos + (x * bytesPerPixel);

                        pixel[pos + RED_PIXEL] = (byte)(255 - pixel[pos + RED_PIXEL]);
                        pixel[pos + GREEN_PIXEL] = (byte)(255 - pixel[pos + GREEN_PIXEL]);
                        pixel[pos + BLUE_PIXEL] = (byte)(255 - pixel[pos + BLUE_PIXEL]);                                                    
                    }

                }
            }
        }
        finally
        {
            image.UnlockBits(bmData);
        }

    } 
```

如果您有兴趣，这里是颜色矩阵的代码：

```
 public static void Negate(Bitmap image)
    {

            Bitmap clone = (Bitmap) image.Clone();

            using (Graphics g = Graphics.FromImage(image))
            {

                // negation ColorMatrix
                ColorMatrix colorMatrix = new ColorMatrix(
                    new float[][]
                        {
                            new float[] {-1, 0, 0, 0, 0},
                            new float[] {0, -1, 0, 0, 0},
                            new float[] {0, 0, -1, 0, 0},
                            new float[] {0, 0, 0, 1, 0},
                            new float[] {0, 0, 0, 0, 1}
                        });

                ImageAttributes attributes = new ImageAttributes();

                attributes.SetColorMatrix(colorMatrix);

                g.DrawImage(clone, new Rectangle(0, 0, clone.Width, clone.Height),
                            0, 0, clone.Width, clone.Height, GraphicsUnit.Pixel, attributes);
           }
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T13:57:56.017

逐个遍历所有像素（Bitmap.GetPixel() 或其他内容）并从 0xff 中减去 RGB 值以创建负色像素。将此像素保存到新图像或使用 (Bitmap.SetPixel()) 在同一位置的同一图像上。

```
 // Retrieve the image.
    var image1 = new Bitmap(@"C:\Documents and Settings\All Users\" 
        + @"Documents\My Music\music.bmp", true);

    int x, y;

    // Loop through the images pixels to reset color.
    for(x=0; x<image1.Width; x++)
    {
        for(y=0; y<image1.Height; y++)
        {
            Color pixelColor = image1.GetPixel(x, y);
            Color newColor = Color.FromArgb(0xff - pixelColor.R
            , 0xff - pixelColor.G, 0xff - pixelColor.B);
            image1.SetPixel(x, y, newColor);
        }
    } 
```

# java - 在 Eclipse 中编辑 xhtml jsp 文件

> ID：541335
> 
> 赞同：2
> 
> 时间：2009-02-12T13:55:24.587
> 
> 标签：java, eclipse, jsp, xhtml

我有一些应该输出 xhtml 的 jsp 文件。他们似乎有正确的文档类型等，但 Eclipse 没有解析 xhtml 属性。例如对于根元素：

```
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
```

我收到警告：“未定义的属性名称 (xmlns)。” 在 Eclipse 中解决这个问题的最佳方法是什么？

编辑：这个特定文件的文档类型显然是错误的，它被设置为：

```
<!DOCTYPE html PUBLIC 
   "-//W3C//DTD XHTML 1.1 Transitional//EN" 
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
```

这显然不存在。Eclipse 现在抱怨 taglib 标签，即：

```
<%@taglib prefix="s" uri="/struts-tags" %> 
```

生成警告：“标签 (jsp:directive.taglib) 应该是一个空元素标签。”

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T15:17:52.923

如果您要输出 xml（在我的理解中 xhtml**是**xml），那么您应该使用 jsp*文档*语法，例如您的

```
<%@taglib prefix="s" uri="/struts-tags" %> 
```

应该是某个顶级标签中的命名空间。对于我正在处理的项目，所有的jsp都是这样的

```
<?xml version="1.0" encoding="UTF-8" ?>
<jsp:root version="2.0"
      xmlns:jsp="http://java.sun.com/JSP/Page"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions">
<jsp:directive.page language="java"
    contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"/>
<jsp:text><![CDATA[<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">]]>
</jsp:text>
<html xmlns="http://www.w3.org/1999/xhtml">
...
</html>
</jsp:root> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T14:02:00.920

这看起来很奇怪，我在 Eclipse 中使用相同的方法，但使用 PHP 时效果很好。

您使用的 DOCTYPE 是什么？我用过

`<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-09T14:57:01.333

如果您使用的是 JSF，请检查您是否获得了两次视图标记。

这就是我解决消息的方式：`Undefined attribute name "xmlns:ui"`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T14:05:17.840

最终，您可以安装 JBoss Tools（ Eclipse 的[更新站点](http://download.jboss.org/jbosstools/updates/stable/)，[指南](http://docs.jboss.org/tools/2.1.0.GA/)），它提供了相当不错的 XHTML/JSP 编辑器。

# architecture - 公司是否应该在所有开发工作中强制使用单一架构？

> ID：541341
> 
> 赞同：0
> 
> 时间：2009-02-12T13:58:47.900
> 
> 标签：architecture, user-interface, doctrine

我知道这是一个略微修辞的问题，但我想听听支持或拒绝这一学说的意见，因为这将帮助我在不使用指定解决方案的请求中建立更好的案例。

一点背景知识：我开发和维护了一个严格在内部使用的大型成熟应用程序（用于 UI 的 VFP，用于中间和后端的 Oracle PL/SQL）。我已经问过我的上级关于用 C# 重写 UI，但我被告知所有未来的开发工作都将在 Java /Spring 中完成。我已经解释过，从桌面应用程序到 Web 应用程序的工作量要比简单地迁移到 C# 要大得多。我还解释了整个 UI 如何必须进行重大重新设计才能过渡到 Web 浏览器。最后，我解释说这个应用程序只在内部使用，因此与外部应用程序所获得的好处相比，拥有一个 Web 架构所实现的好处不会那么多。不幸的是，我的论点并没有动摇他们。

我的一部分很想投降并尝试用 Java 重写，以便获得经验，但我担心这可能是一个项目的灾难，需要四倍于迁移到 C# 所需的时间和精力。

我知道让一个部门只支持一种语言是有好处的，但对我来说，感觉就像我们在用锤子敲螺丝一样。

那么，一家公司在所有开发工作中使用单一解决方案的好处和坏处是什么？此外，是否有其他人发现自己处于类似的情况，即他们选择的语言被拒绝，尽管该选择有所有实际原因？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T14:13:44.137

公平地说，所陈述的问题有点像稻草人的论点。当然，如果我们从字面上理解“不计成本”的条件，答案是**否定的。**

**编辑**：OP 已删除“不计成本”的措辞，但我的其余答案仍应适用。

也就是说，通常实施单一架构的原因是为了节省成本。他们希望每个人都将精力投入到该架构中。如果该架构适合他们处理的大多数问题，则可以降低他们的成本。那么问题就变成了：强制实施架构所节省的成本是否值得偶尔使用它来解决不合适的问题？

在很多情况下，答案仍然是否定的，但不是非黑即白，这取决于你的公司做什么，你的核心竞争力在哪里，以及他们真正有兴趣开发的项目。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T14:09:20.840

我同意你和 Rob Wells 的观点，即强制执行单一架构原则是一个坏主意。在这种情况下，唯一可行的方法是分析每个解决方案（Java 与 C#）的成本，并用实际数字和确凿证据向他们展示。您也可以尝试查看是否有任何案例研究。如果它们不可用，你可能想看看是否有其他公司做过类似的事情，研究它的影响并用它来说服你的管理层。也就是说，这可能比使用 Java 编码更有效（开玩笑 :)）。我希望你能说服你的管理层。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T14:01:19.423

不。

这就像去找一个只能用混凝土工作的建筑师。

您只能将一个解决方案叠加到所有问题空间。

**编辑：**请注意，要让任何管理层相信有价值的 ROI 将来自对成熟系统的重写，这将是**非常困难的。**

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T14:26:48.007

通常不会强加一种架构来使一个项目团队的生活更轻松，因此除非您在使用 Java/Spring 之前使用它，否则您会付出一些代价。

Java 和 webapps 的选择不一定只是一种语言。

公司可能要求单一架构的原因有很多。您需要了解您的公司这样做的原因以及这样做对公司的价值。

这样做的原因可能包括

*   必须保持专业知识只用一种语言和工具链培训人员
*   由于技术相似，因此更容易在项目之间移动人员。
*   使维护更容易，因为以后处理应用程序的员工不必了解多种语言。
*   无需为多种语言购买工具（IDE、重构浏览器等）
*   使使用非 Windows 桌面变得更容易
*   降低支持应用程序的运营成本（例如无需桌面安装，或通过减少他们需要了解的技术数量）
*   IT 总监正在从 Java 工具供应商那里获得反手 :)

因此，采用该架构既有好处，也有成本。您需要表明您至少了解这些好处，并且可以说明为什么在这个项目中使用您的首选语言具有企业意义。

为什么你认为这会是一场灾难？是什么让 Java 如此不适合重写？您需要小心，不要以自己最喜欢的语言并且只会说您还不知道的坏话的人的身份出现。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T14:32:28.257

如果您考虑维护成本，那么限制“认可”架构的选择是有意义的。它使在项目之间移动人员甚至整个团队变得更加容易。

# concurrency - 哪些挑战促进了并行/并发架构的使用？

> ID：541344
> 
> 赞同：4
> 
> 时间：2009-02-12T14:00:04.810
> 
> 标签：concurrency, erlang, parallel-processing, python-stackless, stackless

我对使用内置并行性/并发性的语言的可能性感到非常兴奋，例如[stackless python](http://zope.stackless.com/)和[erlang](http://erlang.org/white_paper.html)，并且坚信我们都必须在不久的将来朝着这个方向前进 - 或者会想要因为这将是获得可扩展性和性能的好方法/简单方法。

但是，我非常习惯于以线性/串行/OOP/功能方式思考解决方案，以至于我正在努力以一种值得使用并发的方式来解决我的任何领域问题。我怀疑我只是需要忘掉很多东西，但我想我会问以下问题：

*   您是否在 stackless 或 erlang 或其他中实现了任何相当大的东西？
*   为什么这是一个不错的选择？这是一个不错的选择吗？你还会做吗？
*   您的问题的哪些特征意味着并发/并行是正确的？
*   您是否重新提出了现有问题以利用并发/并行性？和
*   如果是这样，如何？

有谁愿意分享经验吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-13T16:41:10.857

过去，当台式机只有一个 CPU 时，并行化只适用于“特殊”并行硬件。但是现在台式机通常有 2 到 8 个内核，所以现在并行硬件是标准配置。这是一个很大的区别，因此不仅仅是哪些问题*暗示*了并行性，还在于如何将并行性应用于比以前*更广泛的问题。*

为了利用并行性，您通常需要以某些方式重铸您的问题。并行性在许多方面改变了操场：

*   您会遇到数据一致性和锁定问题。因此，您需要尝试组织您的问题，以便拥有可以由不同线程、进程和计算节点处理的半独立数据结构。
*   如果并行组件执行工作的相对顺序会影响结果，则并行性也会将不*确定性引入您的计算中。*您可能需要防止这种情况，并定义算法的并行版本，该版本对不同的调度顺序具有鲁棒性。
*   当您超越主板内并行性并进入网络/集群/网格计算时，您还会遇到网络带宽、网络故障以及*故障计算节点*的正确管理等问题。您可能需要修改您的问题，以便更容易处理当网络节点出现故障时部分计算丢失的情况。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T22:30:41.400

在我们有操作系统之前，构建应用程序的人会坐下来讨论以下问题：

*   我们将如何在磁盘上存储数据
*   我们将使用什么文件系统结构
*   我们的应用程序将使用什么硬件
*   等等等等

操作系统来自“开发人员库”的集合。

操作系统的美妙之处在于您的 UNWRITTEN 软件具有某些特征，它可以：

*   与永久存储交谈
*   与网络交谈
*   在命令行中运行
*   批量使用
*   与 GUI 对话
*   等等等等

一旦你转移到一个操作系统 - 你就不会回到原来的状态......

Erlang/OTP（即不是 Erlang）是一个应用系统——它运行在两台或多台计算机上。

应用系统的美妙之处在于您的 UNWRITTEN 软件具有某些特征，它可以：

*   两台机器之间的故障转移
*   集群工作
*   等等等等……

你猜怎么着，一旦你转移到一个应用系统——你也不会回去……

你不必使用 Erlang/OTP，Google 在他们的应用引擎中有一个很好的应用系统，所以不要纠结于语言语法。

建立在 Erlang/OTP 堆栈而不是 Google App Engine 上可能有很好的商业理由 - 贵公司的业务开发人员会为您打电话。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T14:32:18.493

The problems will stay almost the same inf future, but the underlying hardware for the realization is changing. To use this, the way of compunication between objects (components, processes, services, how ever you call it) will change. Messages will be sent asynchronously without waiting for a direct response. Instead after a job is done the process will call the sender back with the answer. It's like people working together.

I'm currently designing a lightweighted event-driven architecture based on Erlang/OTP. It's called Tideland EAS. I'm describing the ideas and principles here: [http://code.google.com/p/tideland-eas/wiki/IdeasAndPrinciples](http://code.google.com/p/tideland-eas/wiki/IdeasAndPrinciples). It's not ready, but maybe you'll understand what I mean.

mue

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T21:27:09.807

Erlang 让你并行思考问题。你不会忘记它一秒钟。一段时间后你适应了。不是什么大问题。除了解决方案在每个小角落都变得平行。您必须调整的所有其他语言。要并发。这感觉不自然。然后你最终讨厌你的解决方案。不好玩。

Erlang 最大的优点是它没有全局垃圾收集。它永远不会休息。当您每秒有 10000 次页面浏览时，这很重要。

# c# - 使用带有 2 个选项的下拉列表对绑定到 ObjectDataSource 的 ListBox 进行排序

> ID：541345
> 
> 赞同：1
> 
> 时间：2009-02-12T14:00:07.180
> 
> 标签：c#, asp.net

我在使用下拉列表对 ListBox 进行排序时遇到问题。下拉列表将有 2 个选项：

1.  排序方式 ＃

2.  按类型排序

ListBox 包含一个项目列表，这些项目最初按 # 升序排列。它具有以下格式：

1.  1：红色
2.  2：绿色
3.  3：蓝色
4.  4：红色
5.  5：红色

如果用户选择了Sort By #，如果已经是升序，则应该降序排序，如果是降序，则应该升序排序。如果用户选择按类型排序，它应该对颜色进行排序，然后是#，所以上面的列表变为：

1.  1：红色
2.  4：红色
3.  5：红色
4.  2：绿色
5.  3：蓝色

lisbox 从定义如下的 ObjectDataSource 获取数据：

```
<asp:ObjectDataSource ID="odsColors" runat="server" SelectMethod="GetColors"
        TypeName="XaiSoft.Data">  
</asp:ObjectDataSource> 
```

我已经找出了一种排序方法，但这是我坚持的地方，我不知道该怎么做：

```
public void SortColorList()
{

} 
```

我更新了上述方法以显示我的目标，但出现以下错误：

DataSource 和 DataSourceID 都在“lstColors”上定义。删除一个定义。

```
protected void SortColorList()
{

    XaiSoft.Data.Colors c = new XaiSoft.Data.Colors();
    DataTable dt = c.GetColorList();
    DataView dv = new DataView(dt);

    dv.Sort = "[" + dv.Table.Columns["ColorName"].ColumnName + "] asc";
    lstAuctions.DataSource = dv; //Error happens here.
    lstAuctions.DataBind(); 
```

}

我通过设置 DataSourceId = string.empty; 解决了这个错误。

感谢您的帮助，XaiSoft

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T14:06:33.093

如此处所述创建一个自定义比较器（实现 IComparable），[并](http://devlicio.us/blogs/derik_whittaker/archive/2008/03/28/sorting-list-s-the-net-3-5-way.aspx)使用它对您的集合进行适当的排序。该文章中还列出了其他替代方案（例如使用 Linq）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-13T07:06:17.353

您提到lstAuctions（ListBox）的DataSource是odsColors ObjectDataSource，可能是在控件的属性上设置的（在设计时）。在您的代码隐藏中，您将 lstAuctions 绑定到 dv（DataView）。这似乎可以解释错误：“DataSource 和 DataSourceID 都在 'lstColors' 上定义。删除一个定义。” 但是，我没有在您的代码中看到“lstColors”控件。该问题可能是由页面上的其他内容引起的。

# javascript - 将 jquery 选择器传递给插件中的子功能

> ID：541362
> 
> 赞同：0
> 
> 时间：2009-02-12T14:03:58.903
> 
> 标签：javascript, jquery, function, jquery-plugins

我正在尝试制作一个快速的 jquery 插件（作为学习练习），用于从项目列表（在本例中为 LI）制作一个简单的寻呼机，并且在将当前选择器（this）传递给子时遇到了问题功能。代码如下。

问题是在创建动态导航（插件需要 jquery 1.3）时，我需要传递选择器，因为它是构成寻呼机的实际显示/隐藏的子功能。我正在尝试以下

```
var selector = $(this); 
```

要获取选择器，然后将其传递给脚本底部的子函数，如下所示

```
$(".pageNav a").live("click", function(selector) { 
```

并希望在子功能中使用选择器，如下所示

```
$(selector).hide(); 
```

但我什么也得不到。任何建议将不胜感激，无需为我完成插件！

谢谢

```
(function($) {
$.fn.quickPager = function() {

    //edit this
    var pageSize = 10;
    //leave this
    var selector = $(this);
    var totalRecords = $(this).length;
    var currentPage = 1;
    var pageCounter = 1;

    $(this).each(function(i){
        if(i < pageCounter*pageSize && i >= (pageCounter-1)*pageSize) {
            $(this).addClass("page"+pageCounter);
        }
        else {
            $(this).addClass("page"+(pageCounter+1));
            pageCounter ++;
        }   
    });

    //show/hide the appropriate regions 
    $(this).hide();
    $(".page"+currentPage).show();

    //first check if there is more than one page. If so, build nav
    if(pageCounter > 1) {

        //Build pager navigation
        var pageNav = "<ul class='pageNav'>";   
        for (i=1;i<=pageCounter;i++){

            if (i==1) {
                pageNav += "<li class=currentPage pageNav"+i+"'><a rel='"+i+"' href='#'>Page "+i+"</a></li>";   
            }
            else {
                pageNav += "<li class='pageNav"+i+"'><a rel='"+i+"' href='#'>Page "+i+"</a></li>";
            }

        }
        pageNav += "</ul>";
        $("#pagerContainer").append(pageNav);

        //pager navigation behaviour
        $(".pageNav a").live("click", function(selector) {          
            //grab the REL attribute 
            var clickedLink = $(this).attr("rel");
            currentPage = clickedLink;
            //remove current current (!) page
            $("li.currentPage").removeClass("currentPage");
            //Add current page highlighting
            $(this).parent("li").addClass("currentPage");
            //hide and show relevant links
            //$("ul.paging li").text("TEST");
            $(selector).hide();
            $(selector+".page"+clickedLink).show();
            return false;
        });

    }

}
})(jQuery); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T14:11:19.463

```
var selector = $(this);
$(".pageNav a").live("click", function() {
  // do something
  selector.hide();
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T14:24:49.557

和改变

```
$(selector+".page"+clickedLink).show(); 
```

到

```
selector.find(".page"+clickedLink).show(); 
```

*选择器*不是字符串，它是一个 jQuery 对象，其中包含插件理解为**this的所有元素**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T14:36:40.557

似乎缺少的链接是

```
selector.parent().find(".page"+clickedLink).show(); 
```

感谢您宝贵的帮助夸克。

# xml - XSLT - 如何按属性选择 XML 属性？

> ID：541370
> 
> 赞同：26
> 
> 时间：2009-02-12T14:05:45.577
> 
> 标签：xml, xslt, xpath, xml-attribute

这是我的源 xml 的结构：

```
<root>
<DataSet Value="A">
<Data Value1="1" Value2="anythingA1" />
<Data Value1="2" Value2="anythingA2" />
<Data Value1="3" Value2="anythingA3" />
<Data Value1="4" Value2="anythingA4" />
<Data Value1="5" Value2="anythingA5" />
</DataSet>
</root> 
```

我喜欢从中创建一些变量，例如从所有具有 Value1="2" 和所有具有 Value1="5" 的变量应该导致 myVar1 和anyA2 和 myVar2 和anyA5

我的方法看起来像这样

```
<xsl:variable name="myVarA" select="/DataSet/Data/[@Value1='2']/@Value2" /> 
```

但当然不起作用，因为 Value2 不是 Value1 的孩子。

感谢您提前提供任何提示！

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-02-12T14:08:10.017

只需删除斜线`Data`并在根之前添加：

```
<xsl:variable name="myVarA" select="/root/DataSet/Data[@Value1='2']/@Value2"/> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-12T14:12:50.020

您的 xpath 有两个问题 - 首先您需要从后面`Data`提到的 phihag 中删除子选择器。你也忘了包含`root`在你的 xpath 中。这是您想要执行的操作：

```
select="/root/DataSet/Data[@Value1='2']/@Value2" 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T14:46:54.387

Note: using // at the beginning of the xpath is a bit CPU intensitve -- it will search every node for a match. Using a more specific path, such as /root/DataSet will create a faster query.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T14:16:18.390

尝试这个

```
xsl:variable name="myVarA" select="//DataSet/Data[@Value1='2']/@Value2" /> 
```

'//' 将在任意深度搜索 DataSet

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T14:35:09.297

I would do it by creating a variable that points to the nodes that have the proper value in Value1 then referring to t

```
<xsl:variable name="myVarANode" select="root//DataSet/Data[@Value1='2']" />
<xsl:value-of select="$myVarANode/@Value2"/> 
```

Everyone else's answers are right too - more right in fact since I didn't notice the extra slash in your XPATH that would mess things up. Still, this will also work , and might work for different things, so keep this method in your toolbox.

# sharepoint - 如何在 Sharepoint 2007 中的页面上获取所有 WebpartZone？

> ID：541384
> 
> 赞同：1
> 
> 时间：2009-02-12T14:10:23.413
> 
> 标签：sharepoint, sharepoint-2007, web-parts

有没有办法在 MOSS 2007 中的给定页面上获取所有 WebPartZone？通过遍历所有 Webparts，可以获得带有 webparts 的区域，但空区域将不包括在内。使用 SPLimitedWebPartManager 获取页面上的所有 WebPart。

这需要从布局页面完成。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T05:25:45.693

那么你可以得到SPWebPartManager。然后使用 Zones 属性迭代页面中的 Zones。

有关使用区域的更多信息，请参阅[http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.webparts.webpartmanager.zones.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.webparts.webpartmanager.zones.aspx)。

我认为这可能有效，但您可能应该尝试一下。

**C＃**

```
if(!string.IsNullOrEmpty(this.SPWebPartManager))
{
    WebPartPage l_oPage = (WebPartPage) this.Page;
    SPWebPartManager l_oManager = (SPWebPartManager) l_oPage.Master.FindControl(this.SPWebPartManager);

    if (l_oManager.DisplayMode.Name.Equals(WebPartManager.BrowseDisplayMode.Name))
    {
        foreach (WebZone zone in l_oManager.Zones)
        {
            // Do something with the zone.
        }
    }
} 
```

# c++ - 为什么探查器需要管理权限（在 Windows 上）

> ID：541386
> 
> 赞同：5
> 
> 时间：2009-02-12T14:10:51.570
> 
> 标签：c++, visual-studio, profiling, privileges

我一直在评估 Windows 上本地 C++ 程序的分析器和内存检查工具，所有这些都希望以管理员权限安装*和*运行。我很少在我的机器上以管理员身份登录。如果我需要安装一些东西或做一些需要管理权限的东西，我会使用 runas 并且它工作得很好。

探查器要求管理员权限是否合法，或者探查器开发人员只是懒惰？我在此基础上拒绝所有这些工具是不合理的吗？

我在 XP Pro 机器上使用 VS 2005 进行开发。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T14:12:29.523

因为他们必须查看其他进程的内存，这通常是禁忌。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T19:44:11.503

一些 cpu 分析器实际上使用操作系统中断进行统计平均......显然，如果没有特权，他们就无法做到这一点:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-13T15:38:48.323

我一直在阅读有关此内容的内容，并且我慢慢得出结论，类似分析器的工具通常不需要管理访问权限，但声明您需要它是工具制造商避免所有与不足相关的所有问题的简便方法特权。

所以，我猜他们*很*懒惰，但也有点务实。

如果我错了，请纠正我（我不是 Windows 安全模型方面的专家），但我相信处理这种情况的一种方法是仅在安装时要求管理员权限。然后创建一个 ProfilerUsers 用户组并向该组授予任何必要的权限，然后询问应将哪些计算机用户添加到该组。

我发现的最令人震惊的事情是，许多开发人员一直以管理权限运行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T19:35:05.690

听起来像是开发人员的设计选择。他们可能认为在探查内存或动态更改内存中的代码之前请求管理员权限是个好主意，因为某些类型的恶意软件会出现这种行为。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-13T15:06:32.520

最可能的解释是，它们被实现为专门的调试器，使用 Win32 调试 API，如[DebugActiveProcess()](http://msdn.microsoft.com/en-us/library/ms679295(VS.85).aspx)。这些功能需要 PROCESS_ALL_ACCESS （如文档中所述），我希望您需要管理员权限。

IIRC Visual Studio 调试器也不会（正常）工作，除非您在系统上拥有本地管理员权限，至少对于 C++ 而言。

# python - 在 Python 中从文件名中提取扩展名

> ID：541390
> 
> 赞同：1624
> 
> 时间：2009-02-12T14:11:50.570
> 
> 标签：python, filenames, file-extension

是否有从文件名中提取扩展名的功能？

* * *

## 回答 #1

> 赞同：2405
> 
> 时间：2009-02-12T14:12:46.010

是的。使用`os.path.splitext`（参见[Python 2.X 文档](https://docs.python.org/2/library/os.path.html#os.path.splitext)或[Python 3.X 文档](https://docs.python.org/3/library/os.path.html#os.path.splitext)）：

```
>>> import os
>>> filename, file_extension = os.path.splitext('/path/to/somefile.ext')
>>> filename
'/path/to/somefile'
>>> file_extension
'.ext' 
```

与大多数手动字符串拆分尝试不同，`os.path.splitext`它将正确地`/a/b.c/d`视为没有扩展名而不是有扩展名`.c/d`，并且它将被`.bashrc`视为没有扩展名而不是有扩展名`.bashrc`：

```
>>> os.path.splitext('/a/b.c/d')
('/a/b.c/d', '')
>>> os.path.splitext('.bashrc')
('.bashrc', '') 
```

* * *

## 回答 #2

> 赞同：469
> 
> 时间：2009-02-12T14:15:07.893

```
import os.path
extension = os.path.splitext(filename)[1] 
```

* * *

## 回答 #3

> 赞同：456
> 
> 时间：2016-02-03T21:41:25.727

*3.4 版中的新功能。*

```
import pathlib

print(pathlib.Path('yourPath.example').suffix) # '.example' 
```

我很惊讶还没有人提到[`pathlib`](https://docs.python.org/3/library/pathlib.html)，`pathlib`太棒了！

如果您需要所有后缀（例如，如果您有`.tar.gz`），`.suffixes`将返回它们的列表！

* * *

## 回答 #4

> 赞同：134
> 
> 时间：2011-08-26T09:37:47.917

```
import os.path
extension = os.path.splitext(filename)[1][1:] 
```

仅获取扩展名的文本，而不获取点。

* * *

## 回答 #5

> 赞同：99
> 
> 时间：2012-04-09T18:48:16.173

对于简单的用例，一种选择可能是从点拆分：

```
>>> filename = "example.jpeg"
>>> filename.split(".")[-1]
'jpeg' 
```

文件没有扩展名时没有错误：

```
>>> "filename".split(".")[-1]
'filename' 
```

但是你必须小心：

```
>>> "png".split(".")[-1]
'png'    # But file doesn't have an extension 
```

也不适用于 Unix 系统中的隐藏文件：

```
>>> ".bashrc".split(".")[-1]
'bashrc'    # But this is not an extension 
```

对于一般用途，更喜欢[`os.path.splitext`](https://docs.python.org/3/library/os.path.html#os.path.splitext)

* * *

## 回答 #6

> 赞同：42
> 
> 时间：2012-12-28T07:25:49.757

值得在其中添加一个较低的值，这样您就不会想知道为什么 JPG 没有出现在您的列表中。

```
os.path.splitext(filename)[1][1:].strip().lower() 
```

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2011-10-10T22:48:43.463

上述任何解决方案都有效，但在 linux 上，我发现扩展字符串末尾有一个换行符，这将阻止匹配成功。将`strip()`方法添加到末尾。例如：

```
import os.path
extension = os.path.splitext(filename)[1][1:].strip() 
```

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2013-02-05T00:19:54.070

使用 splitext 时，带有双扩展名的文件会出现问题（例如`file.tar.gz`,`file.tar.bz2`等）

```
>>> fileName, fileExtension = os.path.splitext('/path/to/somefile.tar.gz')
>>> fileExtension 
'.gz' 
```

但应该是：`.tar.gz`

可能的解决方案在[这里](https://stackoverflow.com/questions/6525334/getting-file-extension-using-pattern-matching-in-python)

* * *

## 回答 #9

> 赞同：20
> 
> 时间：2018-08-11T19:23:28.080

你可以在 pathlib 模块中找到一些很棒的东西（在 python 3.x 中可用）。

```
import pathlib
x = pathlib.PurePosixPath("C:\\Path\\To\\File\\myfile.txt").suffix
print(x)

# Output 
'.txt' 
```

* * *

## 回答 #10

> 赞同：16
> 
> 时间：2018-08-12T15:05:56.387

只是`join`所有`pathlib suffixes`。

```
>>> x = 'file/path/archive.tar.gz'
>>> y = 'file/path/text.txt'
>>> ''.join(pathlib.Path(x).suffixes)
'.tar.gz'
>>> ''.join(pathlib.Path(y).suffixes)
'.txt' 
```

* * *

## 回答 #11

> 赞同：15
> 
> 时间：2017-02-27T03:53:05.390

虽然这是一个老话题，但我想知道为什么在这种情况下没有提到一个非常简单的 python api，称为 rpartition：

要获取给定文件绝对路径的扩展名，您只需键入：

```
filepath.rpartition('.')[-1] 
```

例子：

```
path = '/home/jersey/remote/data/test.csv'
print path.rpartition('.')[-1] 
```

会给你：'csv'

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2015-12-20T00:24:08.017

很惊讶这还没有被提及：

```
import os
fn = '/some/path/a.tar.gz'

basename = os.path.basename(fn)  # os independent
Out[] a.tar.gz

base = basename.split('.')[0]
Out[] a

ext = '.'.join(basename.split('.')[1:])   # <-- main part

# if you want a leading '.', and if no result `None`:
ext = '.' + ext if ext else None
Out[] .tar.gz 
```

好处：

*   对于我能想到的任何事情都可以按预期工作
*   没有模块
*   没有正则表达式
*   跨平台
*   易于扩展（例如，扩展没有前导点，只有扩展的最后一部分）

作为函数：

```
def get_extension(filename):
    basename = os.path.basename(filename)  # os independent
    ext = '.'.join(basename.split('.')[1:])
    return '.' + ext if ext else None 
```

* * *

## 回答 #13

> 赞同：11
> 
> 时间：2018-03-15T18:34:13.143

您可以在 a`split`上使用 a `filename`：

```
f_extns = filename.split(".")
print ("The extension of the file is : " + repr(f_extns[-1])) 
```

这不需要额外的库

* * *

## 回答 #14

> 赞同：10
> 
> 时间：2014-02-18T10:55:57.560

```
filename='ext.tar.gz'
extension = filename[filename.rfind('.'):] 
```

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2018-04-18T11:06:25.417

这是一种直接的字符串表示技术：我看到很多解决方案都提到了，但我认为大多数都在关注拆分。但是，Split 在每次出现“。”时都会执行此操作。. 您宁愿寻找的是分区。

```
string = "folder/to_path/filename.ext"
extension = string.rpartition(".")[-1] 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2014-01-03T07:32:02.133

右拆分的另一种解决方案：

```
# to get extension only

s = 'test.ext'

if '.' in s: ext = s.rsplit('.', 1)[1]

# or, to get file name and extension

def split_filepath(s):
    """
    get filename and extension from filepath 
    filepath -> (filename, extension)
    """
    if not '.' in s: return (s, '')
    r = s.rsplit('.', 1)
    return (r[0], r[1]) 
```

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2017-10-30T08:42:15.677

即使这个问题已经得到解答，我也会在正则表达式中添加解决方案。

```
>>> import re
>>> file_suffix = ".*(\..*)"
>>> result = re.search(file_suffix, "somefile.ext")
>>> result.group(1)
'.ext' 
```

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2021-10-11T11:46:17.680

您可以使用以下代码拆分文件名和扩展名。

```
 import os.path
    filenamewithext = os.path.basename(filepath)
    filename, ext = os.path.splitext(filenamewithext)
    #print file name
    print(filename)
    #print file extension
    print(ext) 
```

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2021-11-23T02:31:01.840

# 在 Python 中从文件名中提取扩展名

## Python 操作系统模块 splitext()

**splitext()**函数将文件路径拆分为具有两个值的元组——根和扩展名。

```
import os
# unpacking the tuple
file_name, file_extension = os.path.splitext("/Users/Username/abc.txt")
print(file_name)
print(file_extension) 
```

## 使用 Pathlib 模块获取文件扩展名

Pathlib 模块获取文件扩展名

```
import pathlib
pathlib.Path("/Users/pankaj/abc.txt").suffix
#output:'.txt' 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2020-03-09T02:01:21.150

一个真正的单线，如果你喜欢正则表达式。即使你有额外的“。”也没关系。在中间

```
import re

file_ext = re.search(r"\.([^.]+)$", filename).group(1) 
```

结果见这里：[点击这里](https://regex101.com/r/19IgSG/1)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2020-04-20T23:50:07.987

试试这个：

```
files = ['file.jpeg','file.tar.gz','file.png','file.foo.bar','file.etc']
pen_ext = ['foo', 'tar', 'bar', 'etc']

for file in files: #1
    if (file.split(".")[-2] in pen_ext): #2
        ext =  file.split(".")[-2]+"."+file.split(".")[-1]#3
    else:
        ext = file.split(".")[-1] #4
    print (ext) #5 
```

1.  获取列表中的所有文件名
2.  拆分文件名并检查倒数第二个扩展名，它是否在 pen_ext 列表中？
3.  如果是，则将其与最后一个扩展名加入并将其设置为文件的扩展名
4.  如果不是，那么只需将最后一个扩展名作为文件的扩展名
5.  然后检查一下

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-02-14T16:42:59.273

对于有趣的...只需将扩展名收集在一个字典中，然后在一个文件夹中跟踪所有这些扩展名。然后只需拉出您想要的扩展名。

```
import os

search = {}

for f in os.listdir(os.getcwd()):
    fn, fe = os.path.splitext(f)
    try:
        search[fe].append(f)
    except:
        search[fe]=[f,]

extensions = ('.png','.jpg')
for ex in extensions:
    found = search.get(ex,'')
    if found:
        print(found) 
```

* * *

## 回答 #23

> 赞同：-2
> 
> 时间：2015-04-01T16:56:27.933

```
# try this, it works for anything, any length of extension
# e.g www.google.com/downloads/file1.gz.rs -> .gz.rs

import os.path

class LinkChecker:

    @staticmethod
    def get_link_extension(link: str)->str:
        if link is None or link == "":
            return ""
        else:
            paths = os.path.splitext(link)
            ext = paths[1]
            new_link = paths[0]
            if ext != "":
                return LinkChecker.get_link_extension(new_link) + ext
            else:
                return "" 
```

* * *

## 回答 #24

> 赞同：-2
> 
> 时间：2020-01-04T10:07:17.943

这是在**一行**中同时获取文件名和扩展名**的最简单方法**。

 **```
fName, ext = 'C:/folder name/Flower.jpeg'.split('/')[-1].split('.')

>>> print(fName)
Flower
>>> print(ext)
jpeg 
```

与其他解决方案不同，您不需要为此导入任何包。

* * *

## 回答 #25

> 赞同：-3
> 
> 时间：2015-11-06T20:24:11.197

```
def NewFileName(fichier):
    cpt = 0
    fic , *ext =  fichier.split('.')
    ext = '.'.join(ext)
    while os.path.isfile(fichier):
        cpt += 1
        fichier = '{0}-({1}).{2}'.format(fic, cpt, ext)
    return fichier 
```

* * *

## 回答 #26

> 赞同：-3
> 
> 时间：2021-02-15T09:15:26.307

```
a = ".bashrc"
b = "text.txt"
extension_a = a.split(".")
extension_b = b.split(".")
print(extension_a[-1])  # bashrc
print(extension_b[-1])  # txt 
```

* * *

## 回答 #27

> 赞同：-5
> 
> 时间：2014-08-22T19:19:24.640

```
name_only=file_name[:filename.index(".") 
```

这将为您提供直到第一个“。”的文件名，这将是最常见的。

# c# - ASP.NET：向页面添加控件时生成属性值

> ID：541398
> 
> 赞同：1
> 
> 时间：2009-02-12T14:13:33.700
> 
> 标签：c#, asp.net, user-controls, controls, custom-controls

上下文：ASP.NET 3.5 / C#

你好，

我创建了一个用户控件

```
public partial class MyControl : UserControl
{
    // EDIT: example first used "UniqueId" as property name, which was wrong.
    public Guid MyId { get; set; }
    // ...
} 
```

和这个示例用法

```
<uc1:MyControl 
    ID="myControl" 
    MyId="443CBF34-F75F-11DD-BE2F-68C555D89123"
    runat="server" /> 
```

脚步：

*   将此控件添加到 Web 表单 (aspx)

预期结果：

*   添加用户控件的 HTML，MyId 的唯一值（对应于 Guid.NewGuid()）在设计时在 ASPX HTML 中设置为 MyId 属性值。

实际结果：

*   添加了用户控件的 HTML，在设计时未在 HTML 中为 MyId 属性值设置唯一值。

如果这是不可能的：

*   解决方法 1：是否可以使用服务器控件来实现此目的？如何？
*   解决方法 2：是否可以使用 UserControl 设计模式任务来实现这一点？

澄清：

*   持久化属性值**不是**问题，因为它不会因控件实例而更改，并且由 ASP.NET 通过 aspx 页面中的控件声明自动设置。
*   MyId 属性不需要在运行时呈现。

乙！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-05T19:43:31.167

[Visual Studio .NET 中的自定义设计时控件功能](http://msdn.microsoft.com/en-us/magazine/cc164048.aspx#S6)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-03T01:31:21.180

因此，您只想生成一个仅在设计时使用的唯一 ID？

为什么不覆盖 Object.GetHasCode();

然后将其作为财产曝光？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T14:20:55.400

You have a couple problems here, but first I will answer your questions about the workarounds.

1.  No you are already using a server control.
2.  No design-mode is to just make the lives of the developer easy, it doesn't effect anything else

You have two problems here. There is already a property called `UniqueID` I don't know if you were trying to overload that, but the question wasn't clear. The second problem is that your UniqueID essentially not getting stored anywhere. Try the following code:

```
public Guid UniqueId {
    get { return (Guid)ViewState["MyUserControlUniqueId"]; }
    set { ViewState["MyUserControlUniqueId"] = value; }
} 
```

That will store the GUID in the ViewState so that you can retrieve it on post backs.

**Update:** Given your comment you need to override/use this method to add attributes to the rendered content.

[http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.webcontrol.addattributestorender.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.webcontrol.addattributestorender.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T14:28:11.000

如果我正确理解您的问题，您将在您的用户控件上公开一个名为 MyId 的属性。这允许您在放置该控件的任何位置设置属性。

您还想要的是，呈现的 HTML 也包含此属性和值。

如果是这种情况，属性 MyId 不会传递给 HTML，这只是因为用户控件具有 MyId 作为属性，它在设计器中可见。

在您的用户控件中，您将定义要呈现的标记。例如，如果您有：

```
<asp:Panel runat="Server" Id="myControlDiv">Some other content</asp:Panel> 
```

然后，您可以在您的控件中预渲染事件（或您选择的任何其他地方）放置

```
myControlDiv.Attributes.Add("MyId", SomeGuid.ToString()) 
```

然后它将在 HTML 中输出为

```
<div id="generatedID" MyID="443CBF34-F75F-11DD-BE2F-68C555D89123">Some other content</div> 
```

# lisp - Lisp 代码格式化

> ID：541407
> 
> 赞同：38
> 
> 时间：2009-02-12T14:15:02.543
> 
> 标签：lisp, clojure, code-formatting

一位花时间评论[我关于 Clojure/LISP 语法的其他问题](https://stackoverflow.com/questions/535277/the-clojure-or-lisp-equivalent-of-a-compound-boolean-test)的人指出，我没有以标准 LISP 方式编写示例代码。所以他很友好地重写了代码片段，这是一个很大的帮助。但它在我的脑海中提出了另一个问题。为什么会这样：

```
(if (= a something)
  (if (= b otherthing)
    (foo))) 
```

这是标准 LISP 格式比这种形式更可取：

```
(if (= a something)
  (if (= b otherthing)
    (foo)
  )
) 
```

由于我的 C++ 开发背景，这就是我天真地格式化此代码的方式。我想知道后一种格式是否有任何好处，或者它只是一个根深蒂固的标准（如 QWERTY 键盘）。我并不是要争论——我很难理解为什么第一种形式更可取。第二种形式帮助我更容易地查看代码结构。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-02-12T14:35:52.353

额外行的右括号并不能真正帮助查看代码的结构，因为您可以从缩进级别获得相同的信息。然而，第二种形式占用了几乎两倍的行数，迫使您在阅读代码时更频繁地滚动。

如果您需要更仔细地检查嵌套括号，突出显示匹配括号的编辑器将为您提供帮助。当匹配的括号不是太远时，这也会更容易。

如果表达式太长且太复杂而难以阅读，这也可能表明您应该将部分功能提取到单独的函数中。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-02-12T14:24:03.083

Lisp 代码的缩进方式有点像 Python 中的重要空格，除了它当然是可选的。基本的经验法则是，如果项目不在同一行上，则将列表中的项目垂直放置在另一个之下。

```
(a (b (c (d e)
         (f g))
      (h i j))
   (k l m n)) 
```

甚至不用看括号，你就可以看到`(d e)`and`(f g)`是 的参数`c`，`(c (d e) (f g))`and`(h i j)`是 的参数`b`，`(b (c (d e) (f g)) (h i j))`and`(k l m n)`是 的参数`a`。

对于您的示例，它应该更正确地格式化如下：

```
(if (= a something)
    (if (= b otherthing)
        (foo)))

    ^   ^
  notice how they line up 
```

现在缩进的级别变得有意义，您不再需要依靠平衡括号来获取该信息，并且由于将它们与结束语句放在同一行更紧凑，这就是 lispers 所做的。当然，Lisp 代码不需要以这种方式格式化，但它是人们使用并且可以依赖的相当标准的约定。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-23T15:55:17.380

简单的答案是你的方式不是 Lisp 的漂亮打印机做事的方式。拥有一个真正的格式对代码来说总是一件好事，而 pprint 宏为您提供了语言中内置的格式。

当然，*由于*存在 pprint 宏，因此您不必严格遵循标准代码格式，因为人们可以通过 pprint 运行您的代码并获得他们习惯的内容。然而，由于其他人都使用 pprint，或者手动近似它，如果你不这样做，你将很难阅读代码，而且你没有一个简单的宏可以将他们的代码变成你喜欢的格式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-04-08T10:12:02.510

您可以使用包 Sreafctor: [Homepage](https://github.com/tuhdo/semantic-refactor)重新格式化 Lisp 代码。

一些演示：

*   在 Clojure 中[格式化整个缓冲区演示。](http://i.imgur.com/puTmYJL.gif)我在一个有 10k 行的 Clojure 文件上进行了测试，格式化所有文件大约需要 10 秒（大量时间用于缩进，而不是代码重新排列）。
*   在 Emacs Lisp 中[格式化整个缓冲区演示](http://i.imgur.com/BNWSL7W.gifv)
*   [在一行之间转换 <--> 多行演示](http://i.imgur.com/L8D5tXv.gifv)

可用命令：

*   `srefactor-lisp-format-buffer`: 格式化整个缓冲区
*   `srefactor-lisp-format-defun`: 格式化当前 defun 光标所在的位置
*   `srefactor-lisp-format-sexp`: 格式化当前 sexp 光标所在的位置。
*   `srefactor-lisp-one-line`：将当前同级别的sexp变成一行；使用前缀参数，递归地将所有内部性别转换为一行。

格式化命令也可用于 Common Lisp 和 Scheme。

如果有任何问题，请提交问题报告，我将很乐意修复它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T14:20:58.287

当你有 10 个括号要关闭时，它会变得非常笨重。

当我以前编写 Lisp 时，我在右括号之间留了一个空格，以便在同一行和其余的左括号之间留一个空格，以简化计数，如下所示：

```
（如果（=某事）
  （如果（= b 其他）
    （富）））

```

我想这些天不再需要了，因为编辑更有帮助。

# c# - 如何将函数应用于 IQueryable 实例？

> ID：541409
> 
> 赞同：1
> 
> 时间：2009-02-12T14:15:34.397
> 
> 标签：c#, linq, iqueryable

我已经开始尝试使用 LINQ 实现 IQueryable<T> 数据类型进行查询。例如，我制作了几个这样的函数（扩展方法不适用于特定的 IQueryable 实现，这只是一个临时细节）：

```
public static IQueryable<T> Pow<T>(this IQueryable<T> values, T pow)
{
    var e = BinaryExpression.Power(values.Expression, ConstantExpression.Constant(pow));

    return values.Provider.CreateQuery<T>(e);
} 
```

然后我认为将函数应用于 IQueryable 对象中的每个元素会很有用，但我不太清楚如何构造正确的表达式。方法签名可能如下所示：

```
public static IQueryable<T> Map<T>(this IQueryable<T> values, Expression<Func<T,T>> map)
{
    Expression e = ...

    return values.Provider.CreateQuery<T>(e);
} 
```

我应该如何完成这个方法体？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T14:31:17.403

在我看来，您正在发明[Select](http://msdn.microsoft.com/en-us/library/bb534638.aspx)。我看不出您的 Map 和 Select 已经做了什么之间的区别。它基于表达式和初始 IQueryable<T> 返回一个 IQueryable<U>。

对于 Reduce/Fold 之类的内容，请参阅[Queryable.Aggregate](http://msdn.microsoft.com/en-us/library/system.linq.queryable.aggregate.aspx)函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T14:27:26.990

您正在寻找`.Select()`方法

# asp.net - 在同一域上的 IIS 应用程序之间共享身份验证

> ID：541411
> 
> 赞同：3
> 
> 时间：2009-02-12T14:16:14.147
> 
> 标签：asp.net, iis, authentication, virtual-directory

我在 www.example.com 上有一个 IIS 网站

以及位于 www.example.com/demo/ 的虚拟目录

如何在我的虚拟目录中使用来自 www.example.com 的身份验证 cookie？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T14:21:55.117

You are looking for a [Single Site Login](http://aspalliance.com/1545_Understanding_Single_SignOn_in_ASPNET_20.all) solution. If the article I linked to doesn't help you, there's plenty more on [google](http://www.google.com) when you know what to [search](http://www.google.com/search?ie=UTF-8&oe=UTF-8&sourceid=navclient&gfns=1&q=single+site+login+asp.net) for ;)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T12:19:58.513

cookie 在同一个域中共享，甚至在应用程序之间共享。我使用相同的 cookie 在 Classic ASP 应用程序和 .net 应用程序之间共享身份验证，没有问题。

只需使用相同的规则来加密或存储 cookie。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T14:37:37.060

A solution would be to use integrated authentication. This way the user look up, and authentication authority used, will be the same accost all sites with the servers on the same domain. If you are using something like basic or kerberos authentication then your authentication will not pass between sites even on the same server and possibly between parts of the site that run under different threads, eg a different app pool.

Use session data in asp or cookies to share session information on the same site between pages. Cookies will work even if the virtual folders are shared in a different pool. Just code around the requirements of your virtual directory, in case its shared between multiple sites.

P.S. If you are already using cookies, just have the code in your virtual be the same as what you are using on the other pages.

What are the additional requirements for the virtual? Is it on the same server?

# c# - 如何从父级返回集合的第一个对象

> ID：541415
> 
> 赞同：3
> 
> 时间：2009-02-12T14:16:34.427
> 
> 标签：c#, linq, nhibernate, linq-to-nhibernate

如果可能，我希望使用单个数据库查询来执行以下操作。

```
public class Location
{
    public string URL {get;set;}
    public IList<Page> Pages {get;set;}
}

Page firstPage = Session.Linq<Location>()
                .Where(location => location.URL == "some-location-url")
                .Select(location => location.Pages).FirstOrDefault(); 
```

我的目标是基于当前位置 url，从其 pages 集合中返回第一个 Page 对象。

我现在尝试了许多不同的方法，它们似乎都执行了许多查询来获取所需的 Page 对象。

任何帮助表示赞赏！

忍者戴夫

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T14:22:31.917

这可能是您正在寻找的：

```
Page firstPage = Session.Linq<Page>()
.OrderBy(page => page.Index)
.FirstOrDefault(page=> page.Location.URL == "some-location-url"); 
```

我假设该页面有一个 Location 属性，该属性与它所属的 Location 相关，而 .Index 将是您要订购的属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T14:23:19.933

运行查询反对`Page`而不是反对`Location`：您根本不需要返回`Location`记录。

```
(from p in AllPages
where p.Location.URL == "some-location-url"
select p).FirstOrDefault(); 
```

[几乎总是当我在编写 LINQ 查询时遇到困难，我发现从所涉及的父子关系中最底层的对象开始构建查询很有帮助。]

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T15:17:46.480

您不能直接将订单添加到集合的映射中吗？然后你可以做

```
Page firstPage = Session.Linq<Location>()
              .Where(location => location.URL == "some-location-url")
              .Select(location => location.Pages.FirstOrDefault()).FirstOrDefault(); 
```

FirstOrDefault 可能会阻止 NHibernate 进行所有选择。

对此没有保证，因为我没有设置 linq to nhibernate 来测试它。

# c# - 在后面的代码中更改 Canvas.Left 属性？

> ID：541420
> 
> 赞同：101
> 
> 时间：2009-02-12T14:18:29.587
> 
> 标签：c#, wpf, code-behind, attached-properties

我的 XAML 中有一个矩形，想`Canvas.Left`在后面的代码中更改它的属性：

```
<UserControl x:Class="Second90.Page"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
    Width="400" Height="300" KeyDown="txt_KeyDown">
    <Canvas>
        <Rectangle 
            Name="theObject" 
            Canvas.Top="20" 
            Canvas.Left="20" 
            Width="10" 
            Height="10" 
            Fill="Gray"/>
    </Canvas>
</UserControl> 
```

但这不起作用：

```
private void txt_KeyDown(object sender, KeyEventArgs e)
{
    theObject.Canvas.Left = 50;
} 
```

有谁知道这样做的语法是什么？

* * *

## 回答 #1

> 赞同：170
> 
> 时间：2009-02-12T14:24:05.983

```
Canvas.SetLeft(theObject, 50) 
```

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2009-02-12T14:22:31.697

试试这个

```
theObject.SetValue(Canvas.LeftProperty, 50d); 
```

DependencyObject（大多数 WPF 类的基础）上有一组方法，它们允许对所有依赖项属性进行公共访问。他们是

*   设定值
*   获取值
*   清除值

**编辑**更新了集合以使用双字面值，因为目标类型是双精度值。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-08-16T23:23:10.820

由于我们正在更改“对象”的属性，因此最好使用 JaredPar 建议的方法：

```
theObject.SetValue(Canvas.LeftProperty, 50d); 
```

# basic - 为什么我们要为行号而烦恼？

> ID：541421
> 
> 赞同：41
> 
> 时间：2009-02-12T14:18:45.607
> 
> 标签：basic, line-numbers

当你用 BASIC 写东西时，你需要使用行号。像：

```
10 PRINT "HOME"
20 PRINT "SWEET"
30 GOTO 10 
```

但我想知道：谁提出了使用行号的想法？这真是令人讨厌，并在发展中（双关语）世界中留下了相当大的“回声”！

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2009-02-12T14:23:19.683

当时的想法是，您可以通过使用适当的行号轻松地在程序中的任何地方添加代码。这就是为什么每个人都使用行号 10、20、30.. 所以还有空间：

```
10 PRINT "HOME"
20 PRINT "SWEET"
30 GOTO 10
25 PRINT "HOME" 
```

在 BASIC 可用的第一个接口上，没有闪亮的编辑器，甚至没有 vi 或 emacs（或 DOS 编辑，呵呵）之类的东西。您只能在控制台上打印出您的程序，然后通过首先给出适当的行号来添加新行或替换它们。您无法像现在习惯的那样使用光标浏览“文件”（程序保存在内存中，尽管您可以将副本保存在磁盘上）。

因此，行号不仅需要作为臭名昭著的 GOTO 的标签，而且确实需要告诉解释器您正在编辑的程序流中的哪个位置。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-02-12T14:24:58.183

它有着悠久的历史。

行号实际上来自达特茅斯 BASIC，它是 BASIC 编程语言的原始版本，是所谓的达特茅斯时间共享系统的组成部分。那个 DTSS 有一个基本的 IDE，它只不过是一个交互式命令行。

所以在这个“IDE”中输入的每一行，以一个行号开头，都被添加到程序中，用相同的数字替换任何以前存储的行；其他任何东西都被假定为 DTSS 命令并立即执行。

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2009-02-12T14:28:29.687

在出现 VDT（视频显示终端）之类的东西之前，我们是在打孔卡上编程的老前辈。打孔卡为序列号保留第 72-80 列 - 如果您丢弃了卡片组并且它们都出现故障，您可以将卡片组放入卡片分类器中，该分类器将根据这些序列号对卡片进行排序。在许多方面，BASIC 行号与那些序列号相似。

BASIC 世界的另一个优势是，在过去，BASIC 在运行时被解释。为分支使用标签而不是连续的行号将需要第一次通过来获取所有标签及其位置，就像您使用行号一样，解释器知道它是否需要开始向前或向后扫描目的地。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-02-12T14:25:03.877

过去你没有像 emacs 或 vi 这样的二维编辑器。你所拥有的只是命令行。

您的程序存储在内存中，您可以输入单行命令来编辑单行。

如果您是 Unix 神，您可以使用 ed 或其他东西来完成，但对于 C-64、VIC-20 或 TRS-80 上的 BASIC，您只需覆盖该行。

所以一个会话可能看起来像：

```
$10 PRINT "Hellow World"
$20 GOTO 10
$10 PRINT "Hello World" 
```

现在程序可以正常工作了。

一些较旧的大型机甚至有没有屏幕的线路终端。你的整个会议都是用墨水印在**纸上**的**！**

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-03-07T18:56:48.047

WHO？” 将是发明者 Kemeney 和 Kurtz。

阅读回复后，我查看了“达特茅斯 BASIC”的[Wikipedia 条目](http://en.wikipedia.org/wiki/Dartmouth_BASIC)，并惊讶地发现

> 第一个编译器是在分时系统准备好之前产生的。它被称为 CardBASIC，旨在用于基于标准读卡器的批处理系统。

所以，看起来保罗汤布林“得到了广场”。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2013-03-31T19:59:36.203

Paul Tomblin 的回答是最全面的，但我很惊讶没有人提到 BASIC 项目最初目标的很大一部分是使用分时提供一个对*初学者友好的*交互环境。（Kurtz 和 Kemeny 对“所有学生的普遍访问”的愿景在这方面远远领先于当时的时代。）

为实现这一目标而开发的 BASIC 系统具有 Teletype ASR-33（以及后来的其他）打印终端。当连接到具有分时功能的操作系统时，它们允许在交互模式下编辑和运行 BASIC 程序（与使用穿孔卡片不同），但它们不是光标可寻址的。行号是一种对初学者友好的方式，既可以指定程序语句的顺序，又可以在没有屏幕编辑器的情况下进行明确的编辑。“行编辑器”的 Wikipedia 条目进一步解释了，任何曾经尝试使用行编辑器（例如 Un*x 'ed'）的人都可以理解为什么应该感谢 Kurtz 和 Kemeny 让初学者免于学习神秘以这种方式编辑文本所需的命令序列。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-02-12T14:23:57.827

它们起源于 FORTRAN，BASIC 就是从它衍生而来的。但是，在 FORTRAN 中，只有其他行（如 GOTO 目标）引用的行需要数字。在 BASIC 中，它们有一个次要用途，即允许编辑特定的行。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-12T14:28:04.947

我猜它来自汇编程序，其中每条指令都有一个可以被另一条指令跳转到的地址。

此外，第一台计算机没有太多内存，存储一个行号只需要两个字节（如果做得好的话）。写一个标签需要更多的内存，首先是在定义标签的位置，然后是任何跳转命令。

最后，在过去的美好时光里，没有任何花哨的编辑。唯一的“编辑器”是一个简单的命令行界面，它将以数字开头的所有内容视为程序的一部分，并将其他所有内容视为立即执行的命令。最突出的例子应该是 Commodore 64。

Basic 的较新方言不再需要行号。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-12T15:20:01.000

回到 50 年代，当高级编程语言刚刚起步时，没有终端，没有编辑器，没有监视器（是的，没有监视器），只有打卡机和读卡器（用于将卡片的内容写入和读取到内存中）计算机）和打印机（自然用于打印结果）。后来，磁带被引入，但那是另一回事了。

每张打孔卡都有自己的编号。有几个原因；从纯粹保持它们的顺序，到确定执行顺序。每张卡都是一行代码（以今天的术语）。由于那时还没有 if..then..else 之类的构造，或者任何类似的变体，因此必须以某种方式确定执行顺序。因此引入了 GOTO 语句。它们是循环的基础。“意大利面条代码”一词也来自那个时期，因为写得不好的代码相对难以理解，就像盘子里的意大利面条:)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-12T14:22:18.720

在 Basic 中，如果您没有行号，如何执行

```
GOTO 10 
```

那是一种跳线的方法，一种被发现的好方法……20多年前！

今天，这些行帮助我们捕获错误/异常，因为调试引擎会向我们发送消息，即我们在第 xxx 行遇到异常，我们立即跳转到它！

想象一个没有行号的世界……如果没有行号，记者怎么能得到报酬？

> “既然你知道小说，你必须写一个不超过50行的摘要”

记住这一点？即使在学校，我们也了解行号！

如果它不是发明的，那么已经有人再次发明了，所以我们可以很好地使用它:)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-12T14:41:17.207

并非所有 BASIC 版本都需要行号。例如，QBasic 支持标签。然后你可以跳到那些有 GOTO 的（暂时忽略 Dijkstra 的“Go To Statement Considered Harmful”）。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-12T15:05:09.083

答案已经在上面了。Paul Tomblin 写了它（对 zabzonk 有一个警告）。

实际上，我认为任何没有提到“打孔卡”的答案都是不完整的，如果它既没有提到打孔卡也没有提到 FORTRAN，那就错了。我可以说这绝对是正确的，因为我的父母都经常使用打孔卡（他们从 FORTRAN 66 和 77 开始），然后在 80 年代迁移到 Basic 和 COBOL。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-06-30T21:02:06.367

早期，大多数节目都是通过打孔卡进入的。穿孔卡片通常按顺序输入，通常每张卡片一个指令，标签（JMP/JSR 目标）是单独的指令卡片。

要编辑您的程序，您更换了卡。

后来的实现在该行的右端添加了一个可选的序列号，以便当/如果它们出现故障时，它们可以由自动阅读器重新排序。

Fortran 使用左侧的数字目标标签 (col 1-5) 并在右侧 (73-80) 留下一个保留块用于序列或注释。

最初编写 BASIC 时，决定将序列号向左移动，进入 FORTRAN 的标签字段，并允许覆盖先前卡的内存占用……作为一种编辑模式。这是为交互式开发环境设计的，但也适用于卡片。出于各种原因，在一些早期的实现中使用了卡片。

请记住：在 1970 年代后期，许多计算机都是读卡器和打印机接口。即使有交互模式基础，也经常使用打卡的基础程序。由于许多只是简单地输入 IDE，因此它们的工作方式完全相同。包括最后需要一张“跑步”卡。在这种情况下，可以简单地粘贴一张修正卡和另一张运行卡，以对某个变量进行更改重新运行；同样，在复杂的程序中，只需在运行前添加一个更正的卡片行就足以编辑出问题，而无需花费宝贵的时间来查找错误的卡片本身。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-12T14:23:23.147

我喜欢飞出个未来的机器人教堂，墙上写着类似的东西

```
10 SIN
20 GOTO HELL 
```

在 Speccy 上，您无法编辑没有行号的行。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-12T14:27:24.527

我发现它们在配对时非常有用。当我的配对有键盘时，我不必指向一行，我可以说，“在第 74 行，那不应该是 getMoreBeer() 吗？”

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2009-02-12T14:31:19.837

最初的 DOS 编辑器是一个很棒的实用程序，叫做[edlin](http://en.wikipedia.org/wiki/Edlin)。您只能编辑一行。为了让 BASIC 的许多版本中的生活更加有趣，您可以无序键入行，第 10、20、30、25、5 行，执行将按行号而不是按出现顺序。

# asp.net - 验证表达式的验证

> ID：541423
> 
> 赞同：0
> 
> 时间：2009-02-12T14:19:01.487
> 
> 标签：asp.net, validation, expression

我正在使用 ASP.NET 3.5、VB.NET，并且正在尝试通过正则表达式验证一些输入。

我的表达是：

```
^[a-zA-Z'_''-''/'' ''\''@''&''.'',''ç''Ç''ö''Ö''I''ı ''i''İ''ğ''Ğ''ş''Ş''ü''Ü'\s\d]{1,50}$
```

它适用于我包含的所有特殊字符，除了“ **-** ”。它只是行不通。我试过 Internet Explorer 和 Firefox，同样的问题。如何修复？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T14:21:25.990

- 字符在该上下文中具有特殊含义。用反斜杠转义它或将其列为块中的最后一个字符。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T14:23:49.120

为什么都是单引号？它们是不必要的。

```
^[-a-zA-Z_/\\@&.,çÇöÖIiiiIgGsSüÜ\s\d]{1,50}$
  ^^^
```

将“-”移动到字符类的开头或结尾以使其识别。此外，反斜杠需要正确转义，否则您也无法匹配反斜杠。

请参阅上面的“^”标记。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T14:21:41.043

在正则表达式字符组`[...]`中，减号表示指定合法字符范围的范围。如果您有很多连续符号（所有字母、数字等）并且不想全部列出它们，这很有用。

示例：`[0-9]` 这将匹配所有数字 0、1、2、3、4、5、6、7、8 或 9，但不匹配减号。

要直接匹配减号，请在其前面加上反斜杠：

示例：`[0\-9]` 这将匹配数字 0、减号或数字 9。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T14:23:42.413

您必须通过将 \ 放在它前面来转义 - 字符。然后正则表达式将变为

```
^[a-zA-Z'_''\-''/'' ''\''@''&''.'',''ç''Ç''ö''Ö''I''ı''i''İ''ğ''Ğ''ş''Ş''ü''Ü'\s\d]{1,50}$ 
```

# javascript - Prototype 中 DHTML 窗口/对话框的最佳技术？

> ID：541424
> 
> 赞同：1
> 
> 时间：2009-02-12T14:19:06.730
> 
> 标签：javascript, prototypejs, dhtml

我喜欢[原型](http://www.prototypejs.org/api)，但它没有任何小部件。特别是，它没有为创建窗口/对话框提供任何东西。

我尝试过[Prototype Window](http://prototype-window.xilinus.com/)附加库，但发现它不可靠，并且很长时间没有维护。

有人有任何推荐的解决方案吗？或者任何用于从第一原则创建对话框的配方/模式（即除了原型之外没有库）？我需要模态行为（具有褪色背景效果）并且我必须支持 IE6 以及现代浏览器。

需要明确的是，我不想放弃 Prototype，也不想包含额外的基础库，例如 JQuery。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T14:46:38.973

有几个不错的网站可以看看：

[原型 UI](http://prototype-ui.com/) - 有一个模式对话框。

[Scripteka](http://scripteka.com/) - Prototype 附加组件的母脉。这里有很多很棒的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T20:42:48.330

对于一个非常简单的对话框，请查看以下代码：[http ://snippets.dzone.com/posts/show/3411](http://snippets.dzone.com/posts/show/3411)

非常简单 - 正是我想要的。

代码经过了一些修改。这是对我有用的最终版本：

```
/* 
 * Adapted from http://snippets.dzone.com/posts/show/3411
 */

var Dialog = {};
Dialog.Box = Class.create();
Object.extend(Dialog.Box.prototype, {
  initialize: function(id) {
    this.createOverlay();

    this.dialog_box = $(id);
    this.dialog_box.show = this.show.bind(this);
    this.dialog_box.persistent_show = this.persistent_show.bind(this);
    this.dialog_box.hide = this.hide.bind(this);

    this.parent_element = this.dialog_box.parentNode;

    this.dialog_box.style.position = "absolute";

    var e_dims = Element.getDimensions(this.dialog_box);
    var b_dims = Element.getDimensions(this.overlay);

    this.dialog_box.style.left = ((b_dims.width/2) - (e_dims.width/2)) + 'px';
    this.dialog_box.style.top = this.getScrollTop() + ((this.winHeight() - (e_dims.width/2))/2) + 'px';
    this.dialog_box.style.zIndex = this.overlay.style.zIndex + 1;
  },

  createOverlay: function() {
    if ($('dialog_overlay')) {
      this.overlay = $('dialog_overlay');
    } else {
      this.overlay = document.createElement('div');
      this.overlay.id = 'dialog_overlay';
      Object.extend(this.overlay.style, {
        position: 'absolute',
        top: 0,
        left: 0,
        zIndex: 90,
        width: '100%',
        backgroundColor: '#000',
        display: 'none'
      });
      document.body.insertBefore(this.overlay, document.body.childNodes[0]);
    }
  },

  moveDialogBox: function(where) {
    Element.remove(this.dialog_box);
    if (where == 'back')
      this.dialog_box = this.parent_element.appendChild(this.dialog_box);
    else
      this.dialog_box = this.overlay.parentNode.insertBefore(this.dialog_box, this.overlay);
  },

  show: function(optHeight/* optionally override the derived height, which often seems to be short. */) {
    this.overlay.style.height = this.winHeight()+'px';
    this.moveDialogBox('out');

    this.overlay.onclick = this.hide.bind(this);

    this.selectBoxes('hide');
    new Effect.Appear(this.overlay, {duration: 0.1, from: 0.0, to: 0.3});
    this.dialog_box.style.display = '';

    this.dialog_box.style.left = '0px';

    var e_dims = Element.getDimensions(this.dialog_box);

    this.dialog_box.style.left = (this.winWidth() - e_dims.width)/2 + 'px';

    var h = optHeight || (e_dims.height + 200);
    this.dialog_box.style.top = this.getScrollTop() + (this.winHeight() - h/2)/2 + 'px';
  },

  getScrollTop: function() {
    return (window.pageYOffset)?window.pageYOffset:(document.documentElement && document.documentElement.scrollTop)?document.documentElement.scrollTop:document.body.scrollTop;
  },

  persistent_show: function() {
    this.overlay.style.height = this.winHeight()+'px';
    this.moveDialogBox('out');

    this.selectBoxes('hide');
    new Effect.Appear(this.overlay, {duration: 0.1, from: 0.0, to: 0.3});

    this.dialog_box.style.display = '';
    this.dialog_box.style.left = '0px';
    var e_dims = Element.getDimensions(this.dialog_box);
    this.dialog_box.style.left = (this.winWidth()/2 - e_dims.width/2) + 'px';
  },

  hide: function() {
    this.selectBoxes('show');
    new Effect.Fade(this.overlay, {duration: 0.1});
    this.dialog_box.style.display = 'none';
    this.moveDialogBox('back');
    $A(this.dialog_box.getElementsByTagName('input')).each( function(e) {
      if (e.type != 'submit' && e.type != 'button') e.value = '';
    });
  },

  selectBoxes: function(what) {
    $A(document.getElementsByTagName('select')).each(function(select) {
      Element[what](select);
    });

    if (what == 'hide')
      $A(this.dialog_box.getElementsByTagName('select')).each(function(select){Element.show(select)})
  },

  winWidth: function() {
    if (typeof window.innerWidth != 'undefined')
       return window.innerWidth;
    if (typeof document.documentElement != 'undefined' && typeof document.documentElement.clientWidth != 'undefined' && document.documentElement.clientWidth != 0)
       return document.documentElement.clientWidth;
    return document.getElementsByTagName('body')[0].clientWidth
  },
  winHeight: function() {
    if (typeof window.innerHeight != 'undefined')
      return window.innerHeight
    if (typeof document.documentElement != 'undefined' && typeof document.documentElement.clientHeight != 'undefined' && document.documentElement.clientHeight != 0)
      return document.documentElement.clientHeight;
    return document.getElementsByTagName('body')[0].clientHeight;
  }

}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T14:24:15.920

[Scriptaculous](http://script.aculo.us/)是一个建立在 Prototype 之上的 UI/Widget/效果库。你一定会在那里找到你要找的东西。

# actionscript-3 - （简单）Flex 3 应用程序需要什么 Flash 播放器版本？

> ID：541427
> 
> 赞同：3
> 
> 时间：2009-02-12T14:20:33.030
> 
> 标签：actionscript-3, apache-flex, flex3

Flex 3 应用程序需要什么 Flash 播放器版本？

要求似乎是 FLEX 开发环境中的 HTML WRAPPER/ACTIONSCRIPT 编译器设置；我可以在那里选择什么来最大程度地兼容旧的 Flash 播放器？v8播放器能用吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T14:21:51.310

Flash 播放器 9 及更高版本

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-16T09:44:45.330

Flex 是基于 ActionScript 3 构建的，它是在 flash player 9 中引入的，因此如果您想在其上运行 flex 3 应用程序，V8 播放器将无法工作。

要运行 ActionScript 3，您需要 AVM 2（Actionscript 虚拟机），flash player v8 只包含 AVM 1。而 flash player 9 包含 AVM 1 和 AVM 2 以保持 backword 兼容性。因此，如果您想运行 flex 3 应用程序，您至少需要 flash player 9。V9 或 V10 将为您提供对现有闪存应用程序的所有向后兼容性

# php - 如何在 PHP 中读取任何请求标头

> ID：541430
> 
> 赞同：316
> 
> 时间：2009-02-12T14:21:25.023
> 
> 标签：php, http-headers

我应该如何阅读 PHP 中的任何标头？

例如自定义标题：`X-Requested-With`.

* * *

## 回答 #1

> 赞同：418
> 
> 时间：2009-02-12T14:25:08.587

**IF**：您只需要一个标题，而不是*所有*标题，最快的方法是：

```
<?php
// Replace XXXXXX_XXXX with the name of the header you need in UPPERCASE (and with '-' replaced by '_')
$headerStringValue = $_SERVER['HTTP_XXXXXX_XXXX']; 
```

**ELSE IF**：您将 PHP 作为 Apache 模块运行，或者从 PHP 5.4 开始，使用 FastCGI（简单方法）：

[apache_request_headers()](http://www.php.net/apache_request_headers)

```
<?php
$headers = apache_request_headers();

foreach ($headers as $header => $value) {
    echo "$header: $value <br />\n";
} 
```

**ELSE：**在任何其他情况下，您可以使用（用户态实现）：

```
<?php
function getRequestHeaders() {
    $headers = array();
    foreach($_SERVER as $key => $value) {
        if (substr($key, 0, 5) <> 'HTTP_') {
            continue;
        }
        $header = str_replace(' ', '-', ucwords(str_replace('_', ' ', strtolower(substr($key, 5)))));
        $headers[$header] = $value;
    }
    return $headers;
}

$headers = getRequestHeaders();

foreach ($headers as $header => $value) {
    echo "$header: $value <br />\n";
} 
```

**另请参阅**：
[getallheaders()](http://php.net/manual/en/function.getallheaders.php) - (PHP >= 5.4)~~跨平台版本~~`apache_request_headers()` [apache_response_headers()](http://www.php.net/manual/en/function.apache-response-headers.php)的别名- 获取所有 HTTP 响应标头。
[headers_list()](http://www.php.net/manual/en/function.headers-list.php) - 获取要发送的标头列表。

* * *

## 回答 #2

> 赞同：381
> 
> 时间：2009-02-12T14:23:25.610

```
$_SERVER['HTTP_X_REQUESTED_WITH'] 
```

[RFC3875，4.1.18](http://www.faqs.org/rfcs/rfc3875.html)：

> 如果使用的协议是 HTTP，则名称以开头的元变量`HTTP_`包含从客户端请求标头字段中读取的值。HTTP 标头字段名称转换为大写，所有出现的`-`替换为`_`并`HTTP_`预先提供元变量名称。

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2012-07-29T12:45:21.280

`$_SERVER`您应该在全局变量中找到所有以大写为前缀的 HTTP 标头，`HTTP_`并将破折号 (-) 替换为下划线 (_)。

例如，您`X-Requested-With`可以在以下位置找到：

```
$_SERVER['HTTP_X_REQUESTED_WITH'] 
```

从`$_SERVER`变量创建关联数组可能很方便。这可以通过多种样式完成，但这里有一个输出驼峰键的函数：

```
$headers = array();
foreach ($_SERVER as $key => $value) {
    if (strpos($key, 'HTTP_') === 0) {
        $headers[str_replace(' ', '', ucwords(str_replace('_', ' ', strtolower(substr($key, 5)))))] = $value;
    }
} 
```

现在只需使用`$headers['XRequestedWith']`来检索所需的标题。

PHP 手册`$_SERVER`： http: [//php.net/manual/en/reserved.variables.server.php](http://php.net/manual/en/reserved.variables.server.php)

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2013-01-25T16:15:08.303

自 PHP 5.4.0 起，您可以使用[`getallheaders`](http://php.net/manual/en/function.getallheaders.php)将所有请求标头作为关联数组返回的函数：

```
var_dump(getallheaders());

// array(8) {
//   ["Accept"]=>
//   string(63) "text/html[...]"
//   ["Accept-Charset"]=>
//   string(31) "ISSO-8859-1[...]"
//   ["Accept-Encoding"]=>
//   string(17) "gzip,deflate,sdch"
//   ["Accept-Language"]=>
//   string(14) "en-US,en;q=0.8"
//   ["Cache-Control"]=>
//   string(9) "max-age=0"
//   ["Connection"]=>
//   string(10) "keep-alive"
//   ["Host"]=>
//   string(9) "localhost"
//   ["User-Agent"]=>
//   string(108) "Mozilla/5.0 (Windows NT 6.1; WOW64) [...]"
// } 
```

早些时候，此功能仅在 PHP 作为 Apache/NSAPI 模块运行时才有效。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-11-23T16:08:38.003

`strtolower`由于缺少几个建议的解决方案，RFC2616 (HTTP/1.1) 将标头字段定义为不区分大小写的实体。整个事情，而不仅仅是**价值**部分。

所以像只解析*HTTP_*条目这样的建议是错误的。

最好是这样：

```
if (!function_exists('getallheaders')) {
    foreach ($_SERVER as $name => $value) {
        /* RFC2616 (HTTP/1.1) defines header fields as case-insensitive entities. */
        if (strtolower(substr($name, 0, 5)) == 'http_') {
            $headers[str_replace(' ', '-', ucwords(strtolower(str_replace('_', ' ', substr($name, 5)))))] = $value;
        }
    }
    $this->request_headers = $headers;
} else {
    $this->request_headers = getallheaders();
} 
```

请注意与先前建议的细微差别。这里的函数也适用于 php-fpm (+nginx)。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2016-01-06T09:23:14.720

将标头名称传递给此函数以在不使用`for`循环的情况下获取其值。如果未找到标头，则返回 null。

```
/**
 * @var string $headerName case insensitive header name
 *
 * @return string|null header value or null if not found
 */
function get_header($headerName)
{
    $headers = getallheaders();
    return isset($headerName) ? $headers[$headerName] : null;
} 
```

*注意：这仅适用于 Apache 服务器，请参阅： http: [//php.net/manual/en/function.getallheaders.php](http://php.net/manual/en/function.getallheaders.php)*

*注意：此函数将处理所有标头并将其加载到内存中，它的性能不如`for`循环。*

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2017-09-04T10:23:01.483

我正在使用 CodeIgniter 并使用下面的代码来获取它。将来可能对某人有用。

```
$this->input->get_request_header('X-Requested-With'); 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2014-07-21T00:30:01.357

为简单起见，您可以通过以下方式获得所需的内容：

简单的：

```
$headerValue = $_SERVER['HTTP_X_REQUESTED_WITH']; 
```

或者当您需要一次获得一个时：

```
<?php
/**
 * @param $pHeaderKey
 * @return mixed
 */
function get_header( $pHeaderKey )
{
    // Expanded for clarity.
    $headerKey = str_replace('-', '_', $pHeaderKey);
    $headerKey = strtoupper($headerKey);
    $headerValue = NULL;
    // Uncomment the if when you do not want to throw an undefined index error.
    // I leave it out because I like my app to tell me when it can't find something I expect.
    //if ( array_key_exists($headerKey, $_SERVER) ) {
    $headerValue = $_SERVER[ $headerKey ];
    //}
    return $headerValue;
}
// X-Requested-With mainly used to identify Ajax requests. Most JavaScript frameworks
// send this header with value of XMLHttpRequest, so this will not always be present.
$header_x_requested_with = get_header( 'X-Requested-With' ); 
```

其他标头也在超级全局数组 $_SERVER 中，您可以在此处阅读有关如何获取它们的信息：http: [//php.net/manual/en/reserved.variables.server.php](http://php.net/manual/en/reserved.variables.server.php)

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2018-06-17T18:48:13.427

如果只需要检索一个键，例如`"Host"`需要地址，那么我们可以使用

```
apache_request_headers()['Host'] 
```

这样我们就可以避免循环并将其内联到 echo 输出

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-11-08T15:29:42.173

这就是我的做法。如果 $header_name 未通过，您需要获取所有标题：

```
<?php
function getHeaders($header_name=null)
{
    $keys=array_keys($_SERVER);

    if(is_null($header_name)) {
            $headers=preg_grep("/^HTTP_(.*)/si", $keys);
    } else {
            $header_name_safe=str_replace("-", "_", strtoupper(preg_quote($header_name)));
            $headers=preg_grep("/^HTTP_${header_name_safe}$/si", $keys);
    }

    foreach($headers as $header) {
            if(is_null($header_name)){
                    $headervals[substr($header, 5)]=$_SERVER[$header];
            } else {
                    return $_SERVER[$header];
            }
    }

    return $headervals;
}
print_r(getHeaders());
echo "\n\n".getHeaders("Accept-Language");
?> 
```

在我看来，它比其他答案中给出的大多数示例要简单得多。这也会获取方法（GET/POST/etc.）和获取所有标头时请求的 URI，如果您尝试在日志记录中使用它，这可能很有用。

这是输出：

```
Array ( [HOST] => 127.0.0.1 [USER_AGENT] => Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:28.0) Gecko/20100101 Firefox/28.0 [ACCEPT] => text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 [ACCEPT_LANGUAGE] => en-US,en;q=0.5 [ACCEPT_ENCODING] => gzip, deflate [COOKIE] => PHPSESSID=MySessionCookieHere [CONNECTION] => keep-alive )

en-US,en;q=0.5 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-04-18T16:06:46.320

PHP 7：空合并运算符

```
//$http = 'SCRIPT_NAME';
$http = 'X_REQUESTED_WITH';
$http = strtoupper($http);
$header = $_SERVER['HTTP_'.$http] ?? $_SERVER[$http] ?? NULL;

if(is_null($header)){
    die($http. ' Not Found');
}
echo $header; 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-09-23T11:38:44.090

这是一个简单的方法。

```
// echo get_header('X-Requested-With');
function get_header($field) {
    $headers = headers_list();
    foreach ($headers as $header) {
        list($key, $value) = preg_split('/:\s*/', $header);
        if ($key == $field)
            return $value;
    }
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-12-25T14:33:13.927

这个小的 PHP 片段可能对您有所帮助：

```
<?php
foreach($_SERVER as $key => $value){
echo '$_SERVER["'.$key.'"] = '.$value."<br />";
}
?> 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-01-26T14:59:01.490

```
function getCustomHeaders()
{
    $headers = array();
    foreach($_SERVER as $key => $value)
    {
        if(preg_match("/^HTTP_X_/", $key))
            $headers[$key] = $value;
    }
    return $headers;
} 
```

我使用此函数来获取自定义标头，如果标头从“HTTP_X_”开始，我们将推入数组:)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-12-26T15:08:39.667

如果你有一个 Apache 服务器，这个工作

PHP代码：

```
$headers = apache_request_headers();

foreach ($headers as $header => $value) {
    echo "$header: $value <br />\n";
} 
```

结果：

```
Accept: */*
Accept-Language: en-us
Accept-Encoding: gzip, deflate
User-Agent: Mozilla/4.0
Host: www.example.com
Connection: Keep-Alive 
```

# windows - 在公司范围内安装 .Net 3.5 SP1 框架

> ID：541442
> 
> 赞同：3
> 
> 时间：2009-02-12T14:22:26.877
> 
> 标签：windows, .net-3.5, deployment

我们真的很想开始使用 3.5 框架推出产品，但必须在每台 PC 上安装框架是一件痛苦的事。

我们可以让应用程序在第一次运行时自动更新，但这需要很长时间。

有什么办法可以强制所有PC在一夜之间更新吗？例如通过 Windows 更新...

我们的 PC 混合了 XP 和 Vista

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T14:25:14.530

将 MSI 置于组策略中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T14:26:00.503

您可以通过策略推送 MSI。在这里查看一些想法[。](http://documentation.commvault.com/commvault/release_7_0_0/books_online_1/english_us/deployment/install/msi_with_active_directory_group_policy.htm#Install_Procedure)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T14:26:13.170

您是否考虑过使用 Microsoft 的系统管理服务器 ( [SMS](http://www.microsoft.com/SMServer/default.mspx) ) 和[软件更新服务功能包](http://technet.microsoft.com/en-us/sms/bb676802.aspx)？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T14:33:37.240

通过组策略发布您的安装，为此，您只需要一个MSI版本的程序，并且您必须有权访问组策略管理控制台，当您这样做时，您只需在软件安装菜单下添加新条目（我忘记了选项的确切名称），您也可以稍后像安装它一样卸载它

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T17:18:00.153

这是另一种方式：

下载[pstools](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx)并运行 psexec 进行远程安装

例子：-

psexec \workstation64 -c “c:\folder\dotnetfx35.exe” /q /norestart

# c# - OracleParameter and IN Clause

> ID：541466
> 
> 赞同：21
> 
> 时间：2009-02-12T14:25:21.067
> 
> 标签：c#, .net, oracle

Is there a way to add a parameter to an IN clause using System.Data.OracleClient.

For example:

```
string query = "SELECT * FROM TableName WHERE UserName IN (:Pram)";
OracleCommand command = new OracleCommand(query, conn);
command.Parameters.Add(":Pram", OracleType.VarChar).Value = "'Ben', 'Sam'"; 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-11-03T10:52:57.533

您可以将其包装在 OracleCommandExtension 方法中：

```
public static class OracleCommandExtension
{
    public static OracleCommand AddParameterCollection<TValue>(this OracleCommand command, string name, OracleType type, IEnumerable<TValue> collection)
    {
        var oraParams = new List<OracleParameter>();
        var counter = 0;
        var collectionParams = new StringBuilder(":");
        foreach (var obj in collection)
        {
            var param = name + counter;
            collectionParams.Append(param);
            collectionParams.Append(", :");
            oraParams.Add(new OracleParameter(param, type) { Value = obj });
            counter++;
        }
        collectionParams.Remove(collectionParams.Length - 3, 3);
        command.CommandText = command.CommandText.Replace(":" + name, collectionParams.ToString());
        command.Parameters.AddRange(oraParams.ToArray());
        return command;
    }
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-12T15:12:29.143

You can do it more easily with `ODP.NET`:

1.  Create a `TABLE` type in your database:

    ```
    CREATE TYPE t_varchar2 AS TABLE OF VARCHAR2(4000); 
    ```

2.  Create a collection parameter:

    ```
    OracleParameter param = new OracleParameter();
    param.OracleDbType = OracleDbType.Varchar2;
    param.CollectionType = OracleCollectionType.PLSQLAssociativeArray; 
    ```

3.  Fill the parameter:

    ```
    param = new string[2] {"Ben", "Sam" }; 
    ```

4.  Bind the parameter to the following query:

    ```
    SELECT * FROM TableName WHERE UserName IN (TABLE(CAST(:param AS t_varchar2))); 
    ```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-09-23T21:35:14.637

我知道这是不久前提出的，但不是一个绝妙的答案。

我会做这样的事情 - 请原谅粗糙的伪代码

```
string args[] = {'Ben', 'Sam'};
string bindList = "";
for(int ii=0;ii<args.count;++ii)
{
  if(ii == 0)
  {
   bindList += ":" + ii;
  }
  else
  {
   bindList += ",:" + ii;
  }
  OracleParameter param = new OracleParameter();
  param.dbType = types.varchar;
  param.value = args[ii];
  command.Parameters.Add(param);
}

query = "select * from TableName where username in(" + bindList + ")"; 
```

因此查询最终具有 in(:1,:2) 并且每个都单独绑定。

这里还有一个类似的问题：[Oracle/c#: How do i use bind variables with select statements to return multiple records?](https://stackoverflow.com/questions/2915122/oracle-c-how-do-i-use-bind-variables-with-select-statements-to-return-multiple/3782679)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2018-01-31T11:28:05.617

也许使用不同的方法

```
SELECT * FROM SCOTT.EMP WHERE EMPNO IN (SELECT TO_NUMBER(X.COLUMN_VALUE) FROM XMLTABLE('7788,7900') X); 
```

或者

```
SELECT * FROM SCOTT.EMP WHERE ENAME IN (SELECT X.COLUMN_VALUE.GETSTRINGVAL() FROM XMLTABLE('"SCOTT", "JAMES"') X); 
```

XMLTABLE 的内容可以是单个参数。因此，它应该可以从任何语言中使用。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-05-19T16:31:10.937

您可以使用类似于此处的 Oracle 自定义数据类型：
[http ://www.c-sharpcorner.com/code/2191/pass-collection-to-oracle-stored-procedure-from-net-layer.aspx](http://www.c-sharpcorner.com/code/2191/pass-collection-to-oracle-stored-procedure-from-net-layer.aspx)

在这里：
[https ://stackoverflow.com/a/31466114/1867157](https://stackoverflow.com/a/31466114/1867157)

首先在 Oracle 中创建一个类型并赋予它权限：

```
CREATE TYPE MYSCHEMA.VARCHAR2_TAB_T AS TABLE OF VARCHAR2(4000);
GRANT EXECUTE ON MYSCHEMA.VARCHAR2_TAB_T TO MYROLE 
```

然后创建2个类：

**StringListCustomType.cs**

```
public class StringListCustomType : IOracleCustomType, INullable
{
    public const string Name = "MYSCHEMA.VARCHAR2_TAB_T";

    [OracleArrayMapping()]
    public string[] Array;

    #region IOracleCustomType
    public OracleUdtStatus[] StatusArray { get; set; }

    public void ToCustomObject(OracleConnection con, IntPtr pUdt)
    {
        object objectStatusArray = null;
        Array = (string[])OracleUdt.GetValue(con, pUdt, 0, out objectStatusArray);
        StatusArray = (OracleUdtStatus[])objectStatusArray;
    }

    public void FromCustomObject(OracleConnection con, IntPtr pUdt)
    {
        OracleUdt.SetValue(con, pUdt, 0, Array, StatusArray);
    }
    #endregion

    #region INullable
    public bool IsNull { get; set; }

    public static StringListCustomType Null
    {
        get
        {
            StringListCustomType obj = new StringListCustomType();
            obj.IsNull = true;
            return obj;
        }
    }
    #endregion
} 
```

**StringListCustomTypeFactory.cs**

```
[OracleCustomTypeMapping(StringListCustomType.Name)]
public class StringListCustomTypeFactory : IOracleCustomTypeFactory, IOracleArrayTypeFactory
{
    #region IOracleCustomTypeFactory
    IOracleCustomType IOracleCustomTypeFactory.CreateObject()
    {
        return new StringListCustomType();
    }
    #endregion

    #region IOracleArrayTypeFactory
    Array IOracleArrayTypeFactory.CreateArray(int numElems)
    {
        return new string[numElems];
    }

    Array IOracleArrayTypeFactory.CreateStatusArray(int numElems)
    {
        return new OracleUdtStatus[numElems];
    }
    #endregion
} 
```

然后你可以像这样添加一个参数：

```
dbParameter = new OracleParameter();
dbParameter.ParameterName = "myparamname";
dbParameter.UdtTypeName = StringListCustomType.Name;
dbParameter.OracleDbType = OracleDbType.Array;

if (myarray != null)
{
    StringListCustomType newArray = new StringListCustomType();
    newArray.Array = myarray;
    dbParameter.Value
}
else
{
    dbParameter.Value = StringListCustomType.Null;
} 
```

您的查询将如下所示：

```
SELECT * 
  FROM MYSCHEMA.MYTABLE 
 WHERE MYVARCHARFIELD IN (SELECT COLUMN_VALUE 
                            FROM TABLE(CAST(:myparamname AS MYSCHEMA.VARCHAR2_TAB_T))) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T14:33:50.237

That way your query will be:

```
SELECT * FROM TableName WHERE UserName IN ('''Ben'', ''Sam''');
```

Those two names will be input as one single value.

Have a look at this thread from asktom.oracle.com to find out how to get a dynamic in list.

[http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:210612357425](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:210612357425)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-07-28T05:44:35.133

老问题，但我想分享我的代码。只是一个简单的方法来创建一个可以连接到动态生成的 sql 的字符串，而不会失去绑定参数的性能和安全性：

```
 /// <summary>
    /// 1 - Given an array of int, create one OracleParameter for each one and assigin value, unique named using uniqueParName
    /// 2 - Insert the OracleParameter created into the ref list.
    /// 3 - Return a string to be used to concatenate to the main SQL
    /// </summary>
    /// <param name="orclParameters"></param>
    /// <param name="lsIds"></param>
    /// <param name="uniqueParName"></param>
    /// <returns></returns>
    private static string InsertParameters(ref List<OracleParameter> orclParameters, int[] lsIds, string uniqueParName)
    {
        string strParametros = string.Empty;

        for (int i = 0; i <= lsIds.Length -1; i++)
        {
            strParametros += i == 0 ? ":" + uniqueParName + i : ", :" + uniqueParName + i;

            OracleParameter param = new OracleParameter(uniqueParName + i.ToString(), OracleType.Number);
            param.Value = lsIds[i];
            orclParameters.Add(param);
        }
        return strParametros;
    } 
```

并像这样使用：

```
List<OracleParameter> parameterList = new List<OracleParameter>();
int[] idAr = new int[] { 1, 2, 3, 4};
string idStr = InsertParameters(ref parameterList, idAr, "idTest");
string SQL = " SELECT name FROM tblTest WHERE idTest in ( " + idStr + " )  "; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-08-08T10:24:11.657

我在搜索相同的问题时遇到了它，所以我想添加一个我认为有帮助的答案，因为我不相信上述内容真的能实现它：

[http://forums.asp.net/t/1195359.aspx/1?Using%20bind%20variable%20with%20an%20IN%20clause](http://forums.asp.net/t/1195359.aspx/1?Using%20bind%20variable%20with%20an%20IN%20clause)

如果链接无效，我也会在此处添加答案：

> 回复：使用带有 IN 子句的绑定变量 2007 年 12 月 17 日 06:56 PM|LINK
> 
> 您必须单独添加每个值。像这样的东西（在Mac上写，所以我无法测试它）
> 
> ```
> string sql = "select id, client_id as ClientID, acct_nbr as AcctNbr from acct where acct_nbr in ( %params% )";
>         OracleConnection conn = new OracleConnection(DBConnection);
>         OracleCommand cmd = new OracleCommand();
> 
>         List<string> params=new List<string>();
> 
>         foreach(string acctNbr in AcctNbrs.Split(','))
>         {
>             string paramName=":acctNbr" + params.Count.Tostring();
>             params.Add(paramName)
>             OracleParameter parms = new OracleParameter(paramName, OracleType.VarChar);
>             parms.Value = acctNbr;
>             cmd.Parameters.Add(parms);
> 
>         }
> 
>         cmd.CommandType = CommandType.Text;
>         cmd.CommandText = sql.Replace("%params%",params.ToArray().Join(","));
>         cmd.Connection = conn;
> 
>         OracleDataAdapter da = new OracleDataAdapter(cmd);
>         da.Fill(ds); 
> ```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-06-16T19:18:41.677

虽然这个问题很老，但我解释了我在我的案例中解决它的方式。该示例在 Vb.NET 中，但我认为它同样可以理解。总的来说，解决方案是将 IN 语句转换为一系列 OR 条件及其各自的参数，全部由程序完成。

从包含搜索值的字符串开始，用逗号分隔，没有 Oracle 将使用的字符串引号，并假设您有一个已定义的 OracleCommand，我在示例中将其称为 oraCommando。我所做的是通过拆分具有搜索值的字符串来组装查询字符串，根据需要创建尽可能多的 OR 比较，并使用它们各自的参数为它们分配值。在为查询字符串集合中的参数命名时要特别注意，不要在名称和末尾的数字之间留有空格，使它们都是不同的名称。

```
strCommand & = " UserName = :userName" & puntParam & " " 
```

示例代码将是：

```
dim param as string = "Ben, Sam"
dim strCommand as string = "SELECT * FROM TableName WHERE"
dim puntParam as integer = 0
for each paramAnali as string in split (param, ",")
    puntParam + = 1
    if puntParam> 1 then
        strCommand & = "or"
    end if
    strCommand & = "UserName =: userName" & puntParam.ToString () & ""

    Dim paramNew As New OracleParameter With {
      .ParameterName = "userName" & puntParam.ToString (),
      .OracleDbType = OracleDbType.Varchar2,
      .Direction = ParameterDirection.Input,
      .Value = Trim (paramAnali)}

    oraCommando.Parameters.Add (paramNew)

next 
```

此外，为了不出现参数绑定问题，必须指示 Oracle 命令按名称进行“绑定”。

```
oraCommando.BindByName = True 
```

这样查询就自动调整到接收到的值的个数，无需调整代码。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-10-13T09:06:43.983

```
SELECT * FROM Clients 
WHERE id IN ( 
SELECT trim(regexp_substr(str, '[^,]+', 1, level)) strRows 
FROM (SELECT :Pram as str from dual ) t   
CONNECT BY instr(str, ',', 1, level -1) >0); 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2015-08-05T08:01:07.133

它在 ORACLE 中非常简单。

以下步骤：

1.在oracle中创建默认类型

```
CREATE OR REPLACE TYPE t_varchar_tab AS TABLE OF VARCHAR2(4000); 
```

2.在oracle中创建函数，用于将给定的字符串如“a，b，c”分成“a”，“b”，“c”

```
CREATE OR REPLACE FUNCTION in_list(p_in_list  IN  VARCHAR2)ETURNt_varchar_tab

AS

  l_tab   t_varchar_tab := t_varchar_tab();

  l_text  VARCHAR2(32767) := p_in_list || ',' ;

  l_idx   NUMBER;

BEGIN

  LOOP

    l_idx := INSTR(l_text, ',');

    EXIT WHEN NVL(l_idx, 0) = 0;

    l_tab.extend;

    l_tab(l_tab.last) := TRIM(SUBSTR(l_text, 1, l_idx - 1));

    l_text := SUBSTR(l_text, l_idx + 1);

  END LOOP;

  RETURN l_tab;

END; 
```

3：然后使用以下查询从表中提取数据

```
SELECT * FROM TABLE_NAME EMP WHERE  IN (SELECT * FROM TABLE(in_list(i_input1))); 
```

4.输入参数从c#.net传递到oracle SP，如

```
 cmd.Parameters.Add("i_input1", OracleType.VarChar, 50).Value = "S1,S2"; 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2016-04-07T17:33:12.143

该解决方案不应包含逗号字符或单引号、双引号。我建议您使用临时表，然后从中进行选择。使用常规命令参数填充临时表。

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2009-08-28T13:53:41.160

实际上，我也会尝试这段代码：

```
string query = "SELECT * FROM TableName WHERE UserName IN (:Pram)";
param = new string[2] {"Ben", "Sam" };
OracleCommand command = new OracleCommand(query, conn);
command.ArrayBindCount = param.Length;
command.Parameters.Add(":Pram", OracleType.VarChar).Value = param; 
```

# asp.net-mvc - SelectList 在 MVC DropDownList 中返回为 null

> ID：541467
> 
> 赞同：4
> 
> 时间：2009-02-12T14:25:40.677
> 
> 标签：asp.net-mvc

我在 MVC RC1 表单上使用 Html.DropDownList 帮助程序时遇到问题。

在控制器类中，我创建了一个这样的 SelectList

```
SelectList selectList = new SelectList(db.SiteAreas, "AreaId", "AreaName");
ViewData["AreaId"] = selectList; 
```

或者像这样

```
IEnumerable<SelectListItem> areaList =
    from area in db.SiteAreas
    select new SelectListItem
    {
        Text = area.AreaName,
        Value = area.AreaId.ToString(),
        Selected = false
    };
ViewData["AreaId"] = areaList; 
```

然后使用此调用将其添加到查看器中

```
<% using (Html.BeginForm())
   { %>
   <label for="sitearea">Site Area:</label>
   <span class="hint">The menu option to be highlighted when the page is open </span>
   <br />
   <%= Html.DropDownList("sitearea", (SelectList)ViewData["AreaId"], "Select Area Id")%>
   <%= Html.ValidationMessage("sitearea") %>
   <br />
   <br />
   <input type="submit" value="Add New Page" />
   <% = Html.AntiForgeryToken() %>
<% } %> 
```

所以我也在下拉列表中添加了一个默认选项。如果我运行此页面并单击提交按钮而不执行任何操作，我希望此页面的 POST 操作会触发，并且此下拉列表中的验证代码会告诉我我没有选择选项。

相反，（在将 MVC 源代码附加到我的项目之后），我发现我在 selectextensions.cs 中收到了 ArgumentNullException。

```
$exception  {"Value cannot be null.\r\nParameter name: selectList"} System.Exception {System.ArgumentNullException} 
```

这与称为 SelectInternal 的方法有关，该方法期望其 selectList 参数的值不是 null。

```
private static string SelectInternal(this HtmlHelper htmlHelper, string optionLabel, string name, IEnumerable<SelectListItem> selectList, bool usedViewData, bool allowMultiple, IDictionary<string, object> htmlAttributes) 
{
   if (String.IsNullOrEmpty(name)) {
      throw new ArgumentException(MvcResources.Common_NullOrEmpty, "name");
   }
   if (selectList == null) {
      throw new ArgumentNullException("selectList");
   }  
.. rest of method .. 
```

现在我所做的只是将代码从 MVC beta 1 升级到 RC1，然后突然出现了这种情况。我以前见过对此 SelectInternal 方法的引用，但没有具体的解决方案。那么谁能帮我弄清楚为什么会发生这个错误以及如何解决它？

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T15:59:12.013

想通了，感谢[这个链接](http://forums.asp.net/p/1329660/2663838.aspx)。事实证明，当表单被发送回服务器时，验证实际上是在我的控制器上进行的，但是如果验证失败，控制器会尝试重新显示表单。但是，SelectLists 已在某处设置回 null，因此我也不得不在该页面上重新创建 SelectLists。

我不确定这是 MVC 中的错误还是我自己的错误，但作为参考，有解决方案。干杯。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T14:59:20.970

您是否重新升级到 RC1 刷新？

[http://www.haacked.com/archive/2009/01/30/aspnetmvc-refresh.aspx](http://www.haacked.com/archive/2009/01/30/aspnetmvc-refresh.aspx)

他们解决了很多问题。我几乎 100% 确定我在升级到刷新之前遇到过类似的错误。

忍者戴夫

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T16:01:51.257

这不是 MVC 中的错误，而是设计使然 (AFAIK)

您需要重新设置视图数据并将模型返回到视图。

视图数据只存在于当前请求+1（即回发）。

# wpf - 如何将我的控件样式与当前主题相匹配？(WPF)

> ID：541468
> 
> 赞同：9
> 
> 时间：2009-02-12T14:25:48.617
> 
> 标签：wpf, themes, styles

如果我使用 WPF 创建自定义控件，如何为控件提供与当前应用的主题（Aero、Luna、Classic 等）匹配的样式？

例如，我想在使用 Aero 时应用以下内容：

```
<Style>
    <Setter Property="Background" Value="White"/>
</Style> 
```

但是在使用 Luna 时应用不同的样式：

```
<Style>
    <Setter Property="Background" Value="#DFDFDF"/>
</Style> 
```

我可以以某种方式扩展基本主题以支持我的新控件吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-12T22:53:20.130

一些可能有用的链接：

[http://arbel.net/blog/archive/2006/11/03/Forcing-WPF-to-use-a-specific-Windows-theme.aspx](http://arbel.net/blog/archive/2006/11/03/Forcing-WPF-to-use-a-specific-Windows-theme.aspx)

[http://www.browsoft.com/tutorials/DefaultTheme.html](http://www.browsoft.com/tutorials/DefaultTheme.html)

[http://blogs.msdn.com/wpfsdk/archive/2007/07/31/using-themes-with-custom-controls.aspx](http://blogs.msdn.com/wpfsdk/archive/2007/07/31/using-themes-with-custom-controls.aspx)

基本上，您为自定义控件创建资源字典，命名如下：

```
Classic.xaml (“Classic” Windows 9x/2000 look on Windows XP.)
Luna.NormalColor.xaml (Default blue theme on Windows XP.)
Luna.Homestead.xaml (Olive theme on Windows XP.)
Luna.Metallic.xaml (Silver theme on Windows XP.)
Royale.NormalColor.xaml (Default theme on the Windows XP Media Center Edition operating system.)
Aero.NormalColor.xaml (Default theme on the Windows Vista operating system.) 
```

将控件的不同样式放在这些文件中，它们将根据操作系统的当前主题加载。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T22:24:00.107

您可以通过加载/卸载资源字典在 WPF 中使用不同的主题。这些字典应该包含控件的样式。当您换出字典时，WPF 会将样式应用于您的控件。

例如，如果这是在 WhiteStyle.xaml 中并且您加载了它，您的文本块将全部以白色字体显示文本。

```
<Style TargetType="TextBlock">
    <Setter Property="Foreground" Value="White"/>
</Style> 
```

如果您将其换成 BlackStyle.xaml，其中包含

```
<Style TargetType="TextBlock">
    <Setter Property="Foreground" Value="Black"/>
</Style> 
```

您的文本块将以黑色字体显示文本。WPF 为我们处理了很多细节，我们只需要告诉它细节是什么。

交换资源字典非常简单，我把它留给你自己弄清楚。谷歌搜索“WPF 主题”是一个很好的起点。

# php - PHP并输出一对多结果

> ID：541472
> 
> 赞同：3
> 
> 时间：2009-02-12T14:26:41.640
> 
> 标签：php, mysql, database, one-to-many

到目前为止，我只处理了 php 中的一对一关系，但我遇到了一个涉及一对多关系的问题。我已经坐了几天没有运气，所以我迫切希望有人介入并在我失去理智之前向我展示解决方案。

在我的数据库中有一系列 url，这些 url 由 SELECT 查询以及来自不同表的各种其他字段接收。每个 url 至少有一个与之关联的类别，但可以有多个类别。所以在我的结果中，我可能会看到一些看起来像这样的东西：

```
link_id = 3   url= 'http://www.somesite1.com'   category = 'uncategorised'
link_id = 4   url= 'http://www.somesite2.com'   category = 'travel'
link_id = 4   url= 'http://www.somesite2.com'   category = 'fun'
link_id = 4   url= 'http://www.somesite2.com'   category = 'misc'
link_id = 3   url= 'http://www.somesite3.com'   category = 'uncategorised' 
```

我有这个工作，有点。当我使用while循环和mysql fetch数组循环并打印它们时，结果看起来与上面完全一样。太好了，除了我需要的是它读取类似的内容：

```
link_id = 4   url = 'http://www.somesite2.com'   category = 'travel fun misc' 
```

因此，基本上每个 url 的所有类别都以某种方式组合在一起，因为它们被打印出来。我的第一次尝试让我尝试了一个嵌套的 while 循环，但它没有用，我不确定这是否可行。除此之外，我想知道我是否可能需要一个多维数组（完全猜测，我以前从未使用过）。

我按照上面的链接 id 对这些结果进行排序，所以我知道当前循环迭代中的链接 id 是否与上一次迭代中的链接 id 匹配 - 那么我有一些具有多个类别的东西。我想我是真的很接近，但我就是想不通。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T14:51:39.490

mysql中还有“GROUP_CONCAT”函数。那应该正是您想要实现的目标。

就像是 ：

```
SELECT url, GROUP_CONCAT(category) AS categories FROM yourtable GROUP BY url 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T14:33:42.763

您应该使用连接表。

第一个你有一个链接表

```
id = 1 url = something
id = 2 url = something else 
```

然后你有一个类别表

```
id = 1 category = something
id = 2 category = something else 
```

然后你有一个连接表

```
url_id = 1 category_id = 1
url_id = 1 category_id = 2
url_id = 2 category_id = 1 
```

这至少应该让你开始。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T14:43:22.070

使用以 id 和 url 为键的数组遍历值并将其添加如下：

```
$link_categories[ $id ] .= $category." ";

$result = mysql_query("SElECT * FROM LINKS");

$link_categories = array();

while ($row = mysql_fetch_array($result,MYSQL_ASSOC))
{
    if (!isset($link_categories[$row['link']]))
        $link_categories[$row['link']] = " ";
    else
        $link_categories[$row['link']] .= " ";

    $link_categories[$row['link']] .= $row['category'];
}

print_r($link_categories); 
```

结果是：

```
Array
(
    [http://a.com] =>  test evaluate performance
    [http://b.com] =>  classify reduce
    [http://c.com] =>  allocate
) 
```

这不是这样做的“正确”方式——实际上，关系应该在一个具有一对多关系的单独表中定义。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T14:49:44.330

您需要使用控制中断算法。

```
set last_link variable to null
set combined_category to null
exec query

loop over result set {
    if last_link == null {
        last_link=fetch_link
    }
    if fetch_link==last_link {
        set combined_category+=ltrim(' '.fetch_category)
    } else {
        display html for last_link and combined_category
        set last_link=fetch_link
        set combined_category=fetch_category
    }
}//loop

display html for last_link and combined_category 
```

我将“显示 html”用作通用“工作”事件，您可以将其推送到数组结构等中...

# c# - 在 ListViewSubItem 中放置一个 CheckBox

> ID：541473
> 
> 赞同：5
> 
> 时间：2009-02-12T14:26:47.163
> 
> 标签：c#, winforms, listview

我正在尝试创建一个包含 6 列的 WinForms ListView 控件。前两列将包含文本，但我希望最后四列中有一个复选框。

我知道如何添加带有文本的 ListViewSubItem（为第二列做了），但是如何插入 CheckBox？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-13T13:18:03.437

ListView 不支持这个。只有第一列可以有一个复选框。您可以使用自定义绘图和鼠标点击测试来伪造它，但这需要大量工作。请考虑改用 DataGridView。您可以将列类型更改为 DataGridViewCheckBoxColumn。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-12T14:33:40.907

为 ListView 定义列时，必须将类型更改为复选框

# c# - C# - 如何获取 Mutex 的所有者名称

> ID：541477
> 
> 赞同：7
> 
> 时间：2009-02-12T14:26:59.770
> 
> 标签：c#, synchronization, mutex

我在 2 个应用程序之间有一个共享互斥锁。我想创建一个显示互斥锁当前所有者名称的管理控制台。

如何获取当前拥有 Mutex 的应用程序名称？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T14:31:32.970

我不相信这在用户模式级别是可能的。您必须安装驱动程序或内核插件才能获取此信息。

这几乎与询问“哪个进程打开了此文件”相同的问题？

# sharepoint - 如何在 Sharepoint 中更新网站自定义属性？

> ID：541481
> 
> 赞同：1
> 
> 时间：2009-02-12T14:27:44.337
> 
> 标签：sharepoint

我有一些代码执行以下操作：

```
const string KEY_CHK = "Microsoft.IW.PartCheck";
SPWeb curWeb = SPContext.Current.Web;
if (!curWeb.Properties.ContainsKey(KEY_CHK))
{ 
   curWeb.Properties.Add(KEY_CHK, "true");
   curWeb.Properties.Update();
} 
```

这在 Sharepoint 2007 的母版页中作为 Web 部件运行。

我希望能够以非代码方式更新属性的值。
通过 Sharepoint 管理屏幕，或通过 Sharepoint 设计器。

这可能吗？我在哪里/怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T16:26:29.030

尝试使用来自[http://www.codeplex.com/spm](http://www.codeplex.com/spm)的 SharePoint Manager 2007 。

.b

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T15:11:19.880

不，您不能通过 UI 设置 Web 属性。也许 CodePlex 上有一些东西

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-04T08:00:34.200

你可以试试propertybag manager。它将一个页面添加到您的中央管理员，您可以在其中检查和编辑所有包的属性：

[http://pbs.codeplex.com/](http://pbs.codeplex.com/)

# java - Java中的“实现可运行”与“扩展线程”

> ID：541487
> 
> 赞同：2277
> 
> 时间：2009-02-12T14:28:46.393
> 
> 标签：java, multithreading, runnable, implements, java-threads

从我在 中使用线程的时间开始`Java`，我发现了以下两种编写线程的方法：

使用**工具`Runnable`：**

```
public class MyRunnable implements Runnable {
    public void run() {
        //Code
    }
}
//Started with a "new Thread(new MyRunnable()).start()" call 
```

或者，使用**extends `Thread`：**

```
public class MyThread extends Thread {
    public MyThread() {
        super("MyThread");
    }
    public void run() {
        //Code
    }
}
//Started with a "new MyThread().start()" call 
```

这两个代码块有什么显着差异吗？

* * *

## 回答 #1

> 赞同：1777
> 
> 时间：2009-02-12T14:32:54.340

是的：`Runnable`IMO 是首选方法。您并没有真正专门化线程的行为。你只是给它一些运行的东西。这意味着[组合](http://en.wikipedia.org/wiki/Object_composition)是*哲学*上“更纯粹”的方式。

实际上，这意味着您也可以从另一个类实现*和*`Runnable`扩展......您还可以`Runnable`通过 Java 8 的 lambda 表达式来实现。

* * *

## 回答 #2

> 赞同：604
> 
> 时间：2009-02-12T14:37:05.390

**tl; dr：实现 Runnable 更好。但是，警告很重要**

一般来说，我会推荐使用类似的东西，`Runnable`而不是`Thread`因为它允许您将您的工作与您选择的并发性保持松散耦合。例如，如果您使用 a`Runnable`并且稍后决定这实际上并不需要它自己的`Thread`，您可以调用 threadA.run()。

**警告：**在这里，我强烈反对使用原始线程。我更喜欢使用[Callables](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Callable.html)和[FutureTasks](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/FutureTask.html)（来自 javadoc：“可取消的异步计算”）。现代并发支持的超时、适当取消和线程池的集成对我来说都比一堆原始线程有用得多。

**跟进：**有一个[`FutureTask`构造函数](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/FutureTask.html#FutureTask-java.lang.Runnable-V-)允许您使用 Runnables（如果这是您最熟悉的），并且仍然可以从现代并发工具中受益。 [引用 javadoc](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/FutureTask.html#FutureTask-java.lang.Runnable-V-)：

如果您不需要特定结果，请考虑使用以下形式的构造：

```
Future<?> f = new FutureTask<Object>(runnable, null) 
```

因此，如果我们将它们替换`runnable`为您的`threadA`，我们会得到以下结果：

```
new FutureTask<Object>(threadA, null) 
```

另一个让您更接近 Runnables 的选项是[ThreadPoolExecutor](http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ThreadPoolExecutor.html)。您可以使用[execute](http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ThreadPoolExecutor.html#execute%28java.lang.Runnable%29)方法传入一个 Runnable 以执行“未来某个时间的给定任务”。

如果您想尝试使用线程池，上面的代码片段将变成如下所示（使用[Executors.newCachedThreadPool()](http://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Executors.html#newCachedThreadPool%28%29)工厂方法）：

```
ExecutorService es = Executors.newCachedThreadPool();
es.execute(new ThreadA()); 
```

* * *

## 回答 #3

> 赞同：281
> 
> 时间：2010-03-11T15:50:54.523

故事的道德启示：

*仅当您想要覆盖某些行为时才继承。*

或者更确切地说，它应该被解读为：

*少继承，多接口。*

* * *

## 回答 #4

> 赞同：266
> 
> 时间：2013-03-05T14:26:04.950

那么这么多好的答案，我想添加更多关于这个。这将有助于理解`Extending v/s Implementing Thread`。
Extends 非常紧密地绑定了两个类文件，并且可能会导致一些非常难以处理的代码。

两种方法都做同样的工作，但存在一些差异。
*最常见的区别是*

1.  当您扩展 Thread 类时，之后您将无法扩展您需要的任何其他类。（如您所知，Java 不允许继承多个类）。
2.  当您实现 Runnable 时，您可以为您的类节省空间，以便将来或现在扩展任何其他类。

*但是，实现 Runnable 和扩展 Thread 之间的一个**显着区别**是* `by extending Thread, each of your threads has a unique object associated with it, whereas implementing Runnable, many threads can share the same object instance.`

**下面的例子将帮助你更清楚地理解**

```
//Implement Runnable Interface...
class ImplementsRunnable implements Runnable {

    private int counter = 0;

    public void run() {
        counter++;
        System.out.println("ImplementsRunnable : Counter : " + counter);
    }
}

//Extend Thread class...
class ExtendsThread extends Thread {

    private int counter = 0;

    public void run() {
        counter++;
        System.out.println("ExtendsThread : Counter : " + counter);
    }
}

//Use the above classes here in main to understand the differences more clearly...
public class ThreadVsRunnable {

    public static void main(String args[]) throws Exception {
        // Multiple threads share the same object.
        ImplementsRunnable rc = new ImplementsRunnable();
        Thread t1 = new Thread(rc);
        t1.start();
        Thread.sleep(1000); // Waiting for 1 second before starting next thread
        Thread t2 = new Thread(rc);
        t2.start();
        Thread.sleep(1000); // Waiting for 1 second before starting next thread
        Thread t3 = new Thread(rc);
        t3.start();

        // Creating new instance for every thread access.
        ExtendsThread tc1 = new ExtendsThread();
        tc1.start();
        Thread.sleep(1000); // Waiting for 1 second before starting next thread
        ExtendsThread tc2 = new ExtendsThread();
        tc2.start();
        Thread.sleep(1000); // Waiting for 1 second before starting next thread
        ExtendsThread tc3 = new ExtendsThread();
        tc3.start();
    }
} 
```

**上述程序的输出。**

```
ImplementsRunnable : Counter : 1
ImplementsRunnable : Counter : 2
ImplementsRunnable : Counter : 3
ExtendsThread : Counter : 1
ExtendsThread : Counter : 1
ExtendsThread : Counter : 1 
```

在 Runnable 接口方法中，只创建一个类的一个实例，并且它已被不同的线程共享。因此，计数器的值在每次线程访问时都会增加。

而 Thread 类方法，您必须为每个线程访问创建单独的实例。因此，为每个类实例分配了不同的内存，并且每个实例都有单独的计数器，值保持不变，这意味着不会发生增量，因为没有一个对象引用是相同的。

**何时使用 Runnable？**
当您想从线程组访问相同的资源时，请使用 Runnable 接口。此处避免使用 Thread 类，因为创建多个对象会消耗更多内存，并且会成为很大的性能开销。

实现 Runnable 的类不是线程，而只是一个类。要使 Runnable 成为 Thread，您需要创建 Thread 的实例并将其自身作为目标传入。

`run()`在大多数情况下，如果您只打算覆盖该方法而不打算覆盖其他 Thread 方法，则应该使用 Runnable 接口。这很重要，因为除非程序员打算修改或增强类的基本行为，否则不应将类子类化。

当需要扩展超类时，实现 Runnable 接口比使用 Thread 类更合适。因为我们可以在实现 Runnable 接口的同时扩展另一个类来做一个线程。

我希望这个能帮上忙！

* * *

## 回答 #5

> 赞同：86
> 
> 时间：2009-02-12T14:51:35.123

令我惊讶的一件事还没有被提及，那就是实现`Runnable`使您的课程更加灵活。

如果您扩展线程，那么您正在执行的操作将始终在线程中。但是，如果您实施`Runnable`，则不必如此。你可以在一个线程中运行它，或者将它传递给某种执行器服务，或者只是将它作为一个单线程应用程序中的任务传递（可能稍后运行，但在同一个线程中）。如果您只使用这些选项，则`Runnable`比将自己绑定到`Thread`.

* * *

## 回答 #6

> 赞同：83
> 
> 时间：2013-05-11T08:59:42.730

如果你想实现或扩展任何其他类，那么`Runnable`接口是最可取的，否则，如果你不希望任何其他类扩展或实现，那么`Thread`类是更可取的。

**最常见的区别是**

![在此处输入图像描述](https://i.stack.imgur.com/vLRdp.gif)

当你`extends Thread`上课时，你不能扩展你需要的任何其他课程。（如您所知，Java 不允许继承多个类）。

当你 时`implements Runnable`，你可以为你的班级节省空间，以便将来或现在扩展任何其他班级。

*   Java 不支持多重继承，这意味着您只能在 Java 中扩展一个类，因此一旦扩展 Thread 类，您就失去了机会，并且无法在 Java 中扩展或继承另一个类。

*   在面向对象编程中，扩展类通常意味着添加新功能以及修改或改进行为。如果我们不对 Thread 进行任何修改，则使用 Runnable 接口。

*   Runnable 接口表示一个可以通过普通线程或执行器或任何其他方式执行的任务。因此，将 Task 逻辑分离为 Runnable 而不是 Thread 是一个很好的设计决策。

*   将任务分离为 Runnable 意味着我们可以重用任务，并且可以自由地从不同的方式执行它。因为一旦完成，您就无法重新启动线程。再次 Runnable 与 Thread 的任务，Runnable 是赢家。

*   Java 设计者认识到这一点，这就是为什么 Executor 接受 Runnable 作为 Task 并且他们有执行这些任务的工作线程。

*   继承所有 Thread 方法是额外的开销，仅用于表示可以使用 Runnable 轻松完成的任务。

由[javarevisited.blogspot.com提供](http://javarevisited.blogspot.com/2012/01/difference-thread-vs-runnable-interface.html)

这些是 Java 中 Thread 和 Runnable 之间的一些显着差异。如果您知道 Thread 与 Runnable 的任何其他差异，请通过评论分享。我个人在这种情况下使用 Runnable over Thread 并建议根据您的要求使用 Runnable 或 Callable 接口。

**然而，显着的区别是。**

当你`extends Thread`上课时，你的每个线程都会创建一个唯一的对象并与之关联。当你 时`implements Runnable`，它将同一个对象共享给多个线程。

* * *

## 回答 #7

> 赞同：80
> 
> 时间：2015-05-12T13:50:15.080

`Runnable`实际上，相互比较和`Thread`相互 比较是不明智的。

这两者在多线程中具有依赖和关系，就像`Wheel and Engine`汽车的关系一样。

我想说，多线程只有一种方法，分两步。让我提出我的观点。

**可运行：**
实现`interface Runnable`时意味着您正在创建`run able`位于不同线程中的东西。现在创建可以在线程内运行的东西（可在线程内运行），并不意味着创建线程。
所以这个类`MyRunnable`只不过是一个带有`void run`方法的普通类。它的对象将是一些普通的对象，只有一个`run`在调用时会正常执行的方法。（除非我们在线程中传递对象）。

**Thread:**
`class Thread`，我想说一个非常特殊的类，它能够启动一个新的 Thread，它实际上通过它的`start()`方法启用了多线程。

**为什么不进行比较？**
因为我们需要它们来进行多线程。

对于多线程，我们需要两件事：

*   可以在线程内运行的东西（可运行）。
*   可以启动新线程（Thread）的东西。

所以从技术上和理论上来说，它们都是启动线程所必需的，一个会**运行**，一个会**使其运行**（就像**`Wheel and Engine`**汽车一样）。

这就是为什么你不能启动一个线程，`MyRunnable`你需要将它传递给`Thread`.

**但是**有可能创建和运行一个线程只使用`class Thread`因为 Class`Thread`实现`Runnable`了所以我们都知道`Thread`也是一个`Runnable`里面。

**最后`Thread`，`Runnable`在多线程方面相互补充，而不是竞争对手或替代品。**

* * *

## 回答 #8

> 赞同：46
> 
> 时间：2009-02-12T14:41:22.293

您应该实现 Runnable，但如果您在 Java 5 或更高版本上运行，则不应使用 ExecutorService 来启动它，`new Thread`而是使用[ExecutorService](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorService.html)。有关详细信息，请参阅：[如何在 Java 中实现简单线程](https://stackoverflow.com/questions/125333/how-to-implement-simple-threading-in-java)。

* * *

## 回答 #9

> 赞同：35
> 
> 时间：2009-02-12T14:32:01.487

我不是专家，但我能想到一个实现 Runnable 而不是扩展 Thread 的原因：Java 只支持单继承，所以你只能扩展一个类。

编辑：这最初是说“实现接口需要更少的资源”。同样，但是您需要以任何一种方式创建一个新的 Thread 实例，所以这是错误的。

* * *

## 回答 #10

> 赞同：21
> 
> 时间：2010-10-25T21:41:00.943

我想说还有第三种方式：

```
public class Something {

    public void justAnotherMethod() { ... }

}

new Thread(new Runnable() {
   public void run() {
    instanceOfSomething.justAnotherMethod();
   }
}).start(); 
```

也许这有点受我最近大量使用 Javascript 和 Actionscript 3 的影响，但是这样你的类就不需要实现像`Runnable`.

* * *

## 回答 #11

> 赞同：19
> 
> 时间：2014-07-29T11:24:56.603

随着 Java 8 的发布，现在有了第三种选择。

`Runnable`是一个[函数式接口](https://docs.oracle.com/javase/specs/jls/se8/html/jls-9.html#jls-9.8)，这意味着它的实例可以使用 lambda 表达式或方法引用来创建。

您的示例可以替换为：

```
new Thread(() -> { /* Code here */ }).start() 
```

或者如果你想使用一个`ExecutorService`和一个方法参考：

```
executor.execute(runner::run) 
```

这些不仅比您的示例短得多，而且还具有使用`Runnable`over的其他答案中所述的许多优点`Thread`，例如单一职责和使用组合，因为您没有专门研究线程的行为。`Runnable`如果您只需要像您在示例中所做的那样，这种方式还可以避免创建额外的类。

* * *

## 回答 #12

> 赞同：18
> 
> 时间：2009-02-12T14:33:09.207

实例化接口可以更清晰地分离代码和线程的实现，因此在这种情况下我更愿意实现 Runnable。

* * *

## 回答 #13

> 赞同：16
> 
> 时间：2017-10-01T15:05:06.337

扩展线程和实现 Runnable 的区别在于：

[![在此处输入图像描述](https://i.stack.imgur.com/n1DJO.jpg)](https://i.stack.imgur.com/n1DJO.jpg)

* * *

## 回答 #14

> 赞同：13
> 
> 时间：2012-06-19T23:12:49.857

这里的每个人似乎都认为实现 Runnable 是要走的路，我并不真的不同意他们，但我认为也有扩展 Thread 的情况，事实上你已经在你的代码中展示了它。

如果你实现了 Runnable 那么实现 Runnable 的类无法控制线程名，它是可以设置线程名的调用代码，如下所示：

```
new Thread(myRunnable,"WhateverNameiFeelLike"); 
```

但是，如果您扩展 Thread，那么您可以在类本身中管理它（就像在您的示例中您将线程命名为“ThreadB”）。在这种情况下，您：

A) 可能会给它一个更有用的名称以用于调试目的

B) 强制将该名称用于该类的所有实例（除非您忽略它是一个线程的事实并对其执行上述操作，就好像它是一个 Runnable 但无论如何我们在这里讨论的是约定所以可以忽略我感觉到的这种可能性）。

例如，您甚至可以获取其创建的堆栈跟踪并将其用作线程名称。这可能看起来很奇怪，但取决于代码的结构，它对于调试目的非常有用。

这似乎是一件小事，但是您有一个非常复杂的应用程序，其中有很多线程，并且突然之间事情“停止了”（可能是由于死锁的原因，也可能是因为网络协议中的缺陷会更少显而易见 - 或其他无穷无尽的原因）然后从 Java 获取堆栈转储，其中所有线程都称为 'Thread-1'、'Thread-2'、'Thread-3' 并不总是很有用（这取决于你的线程如何结构化以及您是否可以通过堆栈跟踪有效地判断哪个是哪个 - 如果您使用的多个线程组都运行相同的代码，则并不总是可能的）。

话虽如此，您当然也可以通过创建线程类的扩展来以通用方式执行上述操作，该扩展将其名称设置为其创建调用的堆栈跟踪，然后将其与您的 Runnable 实现而不是标准的 java Thread 类一起使用（见下文），但除了堆栈跟踪之外，可能还有更多特定于上下文的信息，这些信息在线程名称中对调试很有用（对它可以处理的许多队列或套接字之一的引用，例如在这种情况下，您可能更喜欢专门针对这种情况扩展 Thread ，以便您可以让编译器强制您（或使用您的库的其他人）传递某些信息（例如，有问题的队列/套接字）以用于名称）。

下面是一个以调用堆栈跟踪为名称的通用线程示例：

```
public class DebuggableThread extends Thread {
    private static String getStackTrace(String name) {
        Throwable t= new Throwable("DebuggableThread-"+name);
        ByteArrayOutputStream os = new ByteArrayOutputStream();
        PrintStream ps = new PrintStream(os);
        t.printStackTrace(ps);
        return os.toString();
    }

    public DebuggableThread(String name) {
        super(getStackTrace(name));
    }

    public static void main(String[] args) throws Exception {
        System.out.println(new Thread());
        System.out.println(new DebuggableThread("MainTest"));
    }
} 
```

这是比较两个名称的输出示例：

```
Thread[Thread-1,5,main]
Thread[java.lang.Throwable: DebuggableThread-MainTest
    at DebuggableThread.getStackTrace(DebuggableThread.java:6)
    at DebuggableThread.<init>(DebuggableThread.java:14)
    at DebuggableThread.main(DebuggableThread.java:19)
,5,main] 
```

* * *

## 回答 #15

> 赞同：12
> 
> 时间：2010-05-07T04:28:57.637

可运行，因为：

*   为 Runnable 实现留下更大的灵活性来扩展另一个类
*   将代码与执行分开
*   允许您从线程池、事件线程或将来以任何其他方式运行您的可运行文件。

即使您现在不需要任何这些，将来也可能需要。由于重写 Thread 没有任何好处，因此 Runnable 是一个更好的解决方案。

* * *

## 回答 #16

> 赞同：12
> 
> 时间：2014-02-13T09:07:11.560

由于这是一个非常受欢迎的话题，而且好的答案遍布各处，并且处理得非常深入，我觉得将其他人的好答案编译成更简洁的形式是合理的，所以新手可以先简单地了解一下：

1.  您通常扩展一个类来添加或修改功能。因此，*如果您不想***覆盖**任何**线程行为**，请使用 Runnable。

2.  同样，*如果您不需要***继承**线程方法，则可以通过使用 Runnable 来避免这种**开销。**

3.  **单继承**：如果你扩展 Thread，你不能从任何其他类扩展，所以如果这是你需要做的，你必须使用 Runnable。

4.  将领域逻辑与技术手段分开是一个很好的设计，从这个意义上说，最好有一个 Runnable 任务将您的**任务与**您的**runner****隔离开来**。

*****   您可以**多次****执行**同一个 Runnable对象，但是一个 Thread 对象只能启动一次。（也许是原因，为什么 Executors 接受 Runnables，但不接受 Threads。）

    ***   如果您将任务开发为 Runnable，那么您**现在和将来都可以灵活地使用它**。你可以让它通过 Executors 同时运行，也可以通过 Thread 运行。而且您仍然可以像任何其他普通类型/对象一样在同一线程中非并发地使用/调用它。

    *   这也使得在单元测试中分离**任务****逻辑**和并发**方面**变得更加容易。

    ***   如果您对这个问题感兴趣，您可能还对[Callable 和 Runnable 之间的区别](https://stackoverflow.com/questions/141284/the-difference-between-the-runnable-and-callable-interfaces-in-java)感兴趣。******** 

 ******* * *

## 回答 #17

> 赞同：9
> 
> 时间：2014-01-21T16:44:09.417

这在 Oracle 的[定义和启动线程](http://docs.oracle.com/javase/tutorial/essential/concurrency/runthread.html)教程中进行了讨论：

> 您应该使用以下哪个成语？第一个使用 Runnable 对象的习惯用法更通用，因为 Runnable 对象可以继承 Thread 以外的类。第二个习惯用法更容易在简单的应用程序中使用，但受限于您的任务类必须是 Thread 的后代。本课重点介绍第一种方法，它将 Runnable 任务与执行任务的 Thread 对象分开。这种方法不仅更加灵活，而且适用于稍后介绍的高级线程管理 API。

换句话说，实现`Runnable`将在您的类扩展除`Thread`. Java 不支持多重继承。此外，`Thread`在使用某些高级线程管理 API 时，将无法进行扩展。唯一需要扩展`Thread`的情况是在将来不会更新的小型应用程序中。实施起来几乎总是更好，`Runnable`因为随着项目的增长它会更加灵活。设计更改不会产生重大影响，因为您可以在 java 中实现许多接口，但只能扩展一个类。

* * *

## 回答 #18

> 赞同：9
> 
> 时间：2015-08-14T08:07:40.853

最简单的解释是通过实现`Runnable`我们可以将相同的对象分配给多个线程并且每个线程`Thread`共享相同的对象状态和行为。

例如，假设有两个线程，**thread1**将整数放入数组中，**thread2**在数组填满时从数组中取出整数。请注意，为了让**thread2**工作，它需要知道数组的状态，无论**thread1**是否已将其填满。

实现`Runnable`使您可以灵活地共享对象，同时`extends Thread`使您可以为每个线程创建新对象，因此线程1完成的任何更新都会丢失给线程2。

* * *

## 回答 #19

> 赞同：8
> 
> 时间：2016-02-13T09:32:33.490

如果我没记错的话，它或多或少类似于

[接口和抽象类有什么区别？](https://stackoverflow.com/questions/1913098/what-is-the-difference-between-an-interface-and-abstract-class/33957698#33957698)

extends 建立“ **Is A** ”关系&接口提供“ **Has a** ”能力。

首选***实现 Runnable***：

1.  如果您不必扩展 Thread 类并修改 Thread API 默认实现
2.  如果您正在执行火灾并忘记命令
3.  如果您已经在扩展另一个类

首选“***扩展线程***”：

1.  如果您必须覆盖oracle 文档页面中列出的任何这些[Thread方法](https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html)

通常，您不需要覆盖 Thread 行为。因此，在大多数情况下，**实现 Runnable**是首选。

另一方面，使用高级`ExecutorService`或`ThreadPoolExecutorService`API 提供了更多的灵活性和控制力。

看看这个 SE 问题：

[ExecutorService vs Casual Thread Spawner](https://stackoverflow.com/questions/26938210/executorservice-vs-casual-thread-spawner/34923574#34923574)

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2010-03-08T07:03:06.130

将 Thread 类与 Runnable 实现分开还可以避免线程和 run() 方法之间潜在的同步问题。单独的 Runnable 通常在引用和执行可运行代码的方式上提供更大的灵活性。

* * *

## 回答 #21

> 赞同：6
> 
> 时间：2012-08-18T17:47:11.317

`Runnable`是一个接口，而`Thread`是一个实现该接口的类。从设计的角度来看，任务的定义方式和执行方式之间应该有一个清晰的分离。前者是`Runnalbe`实现的责任，后者是`Thread`类的工作。在大多数情况下，实施`Runnable`是正确的做法。

* * *

## 回答 #22

> 赞同：6
> 
> 时间：2013-03-18T10:14:31.730

这就是 SOLID 的S [：](http://en.wikipedia.org/wiki/SOLID_%28object-oriented_design%29)[单一](http://en.wikipedia.org/wiki/Single_responsibility_principle)责任。

*线程*体现了一段代码的*异步执行*的**运行上下文**（如在执行上下文中：堆栈帧、线程 ID 等） 。理想情况下，这段*代码*应该是相同的实现，无论是*同步*的还是*异步*的。

 ***如果在一个实现中将它们捆绑在一起，则会为生成的对象提供两个*不相关*的更改原因：

1.  应用程序中的线程处理（即查询和修改执行上下文）
2.  由一段代码实现的算法（可运行部分）

如果您使用的语言支持部分类或多重继承，那么您可以将每个原因分离到其自己的超类中，但归结为与组合两个对象相同，因为它们的功能集不重叠。那是为了理论。

在实践中，一般来说，一个程序不需要携带比必要的更复杂的东西。如果您有一个线程处理特定任务，而无需更改该任务，则将任务分开类可能没有意义，并且您的代码仍然更简单。

在*Java*的上下文中，由于该工具**已经存在**，因此直接从独立`Runnable`类开始，并将它们的实例传递给`Thread`（或`Executor`）实例可能更容易。一旦*习惯*了这种模式，它并不比简单的可运行线程案例更难使用（甚至阅读）。

* * *

## 回答 #23

> 赞同：6
> 
> 时间：2013-07-25T17:29:00.160

您想要实现接口而不是扩展基类的一个原因是您已经在扩展其他一些类。您只能扩展一个类，但可以实现任意数量的接口。

如果你扩展线程，你基本上是在阻止你的逻辑被除“this”之外的任何其他线程执行。如果您只想让*某个*线程执行您的逻辑，最好只实现 Runnable。

* * *

## 回答 #24

> 赞同：6
> 
> 时间：2013-09-26T05:58:02.810

如果您使用 runnable，您可以节省空间以扩展到您的任何其他类。

* * *

## 回答 #25

> 赞同：6
> 
> 时间：2013-11-22T03:11:51.683

我们可以重新审视我们希望我们的班级表现得像一个的基本原因`Thread`吗？完全没有理由，我们只是想执行一个任务，很可能是异步模式，这恰恰意味着任务的执行必须从我们的主线程分支，如果提前完成，可能会或可能不会等待对于分支路径（任务）。

如果这是整个目的，那么我在哪里看到需要专门的线程。这可以通过从系统的线程池中获取一个 RAW 线程并将其分配给我们的任务（可能是我们类的一个实例）来完成，就是这样。

因此，让我们遵循 OOP 的概念并编写一个我们需要的类型的类。做事有很多方法，以正确的方式做事很重要。

我们需要一个任务，所以编写一个可以在线程上运行的任务定义。所以使用Runnable。

永远记住`implements`是专门用于传递行为并`extends`用于传递特征/属性。

我们不想要线程的属性，而是希望我们的类表现得像一个可以运行的任务。

* * *

## 回答 #26

> 赞同：5
> 
> 时间：2012-01-28T08:31:16.623

是的，如果你调用 ThreadA 调用，那么不需要调用 start 方法，run 方法只是在调用 ThreadA 类之后调用。但是如果使用 ThreadB 调用则需要启动线程来调用 run 方法。如果您有更多帮助，请回复我。

* * *

## 回答 #27

> 赞同：5
> 
> 时间：2012-06-09T19:09:15.987

由于上述所有原因，我发现使用 Runnable 是最有用的，但有时我喜欢扩展 Thread 以便我可以创建自己的线程停止方法并直接在我创建的线程上调用它。

* * *

## 回答 #28

> 赞同：5
> 
> 时间：2012-06-09T19:28:31.597

Java 不支持多重继承，因此如果您扩展 Thread 类，则不会扩展其他类。

例如：如果您创建一个小程序，那么它必须扩展 Applet 类，所以这里创建线程的唯一方法是实现 Runnable 接口

* * *

## 回答 #29

> 赞同：5
> 
> 时间：2014-03-05T06:13:58.437

线程和可运行之间的区别。如果我们使用线程类创建线程，那么线程数等于我们创建的对象数。如果我们通过实现runnable接口来创建线程，那么我们可以使用单个对象来创建多个线程。所以单个对象被多个线程共享。所以它会占用更少的内存

因此，如果我们的数据不敏感，则取决于要求。所以它可以在多个线程之间共享，我们可以使用 Runnable 接口。

* * *

## 回答 #30

> 赞同：5
> 
> 时间：2015-01-03T00:11:56.637

在这里添加我的两美分 - **总是尽可能使用`implements Runnable`。以下是关于为什么不应该使用 `extends Thread`s的两个警告**

1.  理想情况下，您永远不应该扩展 Thread 类；`Thread`应该`final`上课。至少它的方法像`thread.getId()`. 有关与扩展s相关的错误，请参阅[此讨论。](http://jsr166-concurrency.10961.n7.nabble.com/RRWL-with-bad-Thread-getId-implementations-tc9754.html)`Thread`

2.  喜欢解谜的人可以看到扩展 Thread 的另一个副作用。当没有人通知他们时，下面的代码将打印无法访问的代码。

请参阅 [http://pastebin.com/BjKNNs2G](http://pastebin.com/BjKNNs2G)。

```
public class WaitPuzzle {

    public static void main(String[] args) throws InterruptedException {
        DoNothing doNothing = new DoNothing();
        new WaitForever(doNothing).start();
        new WaitForever(doNothing).start();
        new WaitForever(doNothing).start();
        Thread.sleep(100);
        doNothing.start();
        while(true) {
            Thread.sleep(10);
        }
    }

    static class WaitForever extends  Thread {

        private DoNothing doNothing;

        public WaitForever(DoNothing doNothing) {
            this.doNothing =  doNothing;
        }

        @Override
        public void run() {
            synchronized (doNothing) {
                try {
                    doNothing.wait(); // will wait forever here as nobody notifies here
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                System.out.println("Unreachable Code");
            }
        }
    }

    static class DoNothing extends Thread {

        @Override
        public void run() {
            System.out.println("Do Nothing ");
        }
    } 
} 
```

* * *

## 回答 #31

> 赞同：4
> 
> 时间：2015-02-19T05:37:40.550

实现 Runnable 和扩展 Thread 之间的一个区别是，通过扩展 Thread，每个线程都有一个与之关联的唯一对象，而实现 Runnable，许多线程可以共享同一个对象实例。

实现 Runnable 的类不是线程，而只是一个类。要让 Thread 执行 Runnable，您需要创建 Thread 的实例并将 Runnable 实例作为目标传入。

在大多数情况下，如果您只打算覆盖 run() 方法而不打算覆盖其他 Thread 方法，则应该使用 Runnable 接口。这很重要，因为除非程序员打算修改或增强类的基本行为，否则不应将类子类化。

当需要扩展超类时，实现 Runnable 接口比使用 Thread 类更合适。因为我们可以在实现 Runnable 接口的同时扩展另一个类来做一个线程。但是如果我们只是扩展 Thread 类，我们就不能从任何其他类继承。

* * *

## 回答 #32

> 赞同：4
> 
> 时间：2016-04-24T11:41:51.483

对于大多数工作线程来说，最好的方法是将线程完全封装在工作类中，这样就不会受到外部干扰并导致不需要和无效的线程/类状态。

我刚刚发布了一个示例，所以我也将与您分享：

```
/**
 * This worker can only run once
 * @author JayC667
 */
public class ProperThreading {

    private final Thread        mThread         = new Thread(() -> runWorkingLoop());   // if you want worker to be able to run multiple times, move initialisation into startThread()
    private volatile boolean    mThreadStarted  = false;
    private volatile boolean    mStopRequested  = false;

    private final long          mLoopSleepTime;

    public ProperThreading(final long pLoopSleepTime /* pass more arguments here, store in members */ ) {
        mLoopSleepTime = pLoopSleepTime;
    }

    public synchronized void startThread() {
        if (mThreadStarted) throw new IllegalStateException("Worker Thread may only be started once and is already running!");
        mThreadStarted = true;
        mThread.start();
    }

    private void runWorkingLoop() {
        while (!mStopRequested /* && other checks */ ) {
            try {
                // do the magic work here
                Thread.sleep(mLoopSleepTime);

            } catch (final InterruptedException e) {
                break;
            } catch (final Exception e) {
                // do at least some basic handling here, you should NEVER ignore exception unless you know exactly what you're doing, and then it should be commented!
            }
        }
    }

    public synchronized void stopThread() {
        if (!mThreadStarted) throw new IllegalStateException("Worker Thread is not even running yet!");
        mStopRequested = true;
        mThread.interrupt();
    }

} 
```

* * *

## 回答 #33

> 赞同：3
> 
> 时间：2015-07-26T18:01:29.560

线程持有不打算被访问的行为；

*   它的同步锁用于连接等。
*   它具有您可以偶然访问的方法。

但是，如果您将 Thread 子类化，则必须考虑实现更多 Thread。

```
public class ThreadMain {
    public int getId() {
        return 12345678;
    }

    public String getName() {
        return "Hello World";
    }

    public String getState() {
        return "testing";
    }

    public void example() {
        new Thread() {
            @Override
            public void run() {
                System.out.println("id: "+getId()+", name: "+getName()+", state: "+getState());
            }
        }.start();
    }

    public static void main(String[] args) {
        new ThreadMain().example();
    }
} 
```

如果你运行它，你可能会期望

```
id: 12345678, name: Hello World, state: testing 
```

但是，您没有调用您认为的方法，因为您使用的方法`Thread`不是`ThreadMain`，而是您看到类似

```
id: 11, name: Thread-0, state: RUNNABLE 
```

* * *

## 回答 #34

> 赞同：3
> 
> 时间：2019-05-03T14:13:47.450

**1\. 扩展线程接口，就像你让你的类只表现为一个线程。您的新课程将像一个增强线程。**

```
jshell> public class Test extends Thread{
   ...> public Test(String name){
   ...> super(name);
   ...> }
   ...> public void run(){
   ...> System.out.println(Thread.currentThread().getName());
   ...> }
   ...> }
|  created class Test

jshell> Test t1=new Test("MyThread");
t1 ==> Thread[MyThread,5,main] 
```

它创建一个线程，而不是`Test`对象。所以它会像一个线程一样工作。您不能`Test`在线程之间共享类的实例。

**2.实现runnable接口。**

```
jshell> public class Test1 implements Runnable{
   ...> public void run(){
   ...> System.out.println(Thread.currentThread().getName());
   ...> }
   ...> public String getName(){
   ...> return "testing";}
   ...> }
|  created class Test1

jshell> Test1 t1=new Test1();
t1 ==> Test1@396a51ab  --> this creates Test1 object. 
```

该对象可以通过以下方式跨线程共享，

```
jshell> Thread t1=new Thread(t1,"Hai");
t ==> Thread[Hai,5,main]

jshell> Thread t=new Thread(t1,"Hai");
t ==> Thread[Hai,5,main] 
```

我认为关于这个主题已经讨论了很多，认为这可能对基础知识有所帮助。

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2012-07-06T15:12:39.930

这可能不是答案，但无论如何；还有另一种创建线程的方法：

```
Thread t = new Thread() {
    public void run() {
        // Code here
    }
} 
```

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2016-11-10T07:05:51.520

在极少数情况下您只运行一次，由于 DRY，您应该扩展 Thread。如果你多次调用它，你应该实现 Runnable 因为同一个线程不应该重新启动。

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2017-04-23T05:14:01.120

通过扩展线程类，派生类不能扩展任何其他基类，因为java只允许单继承。相反，通过实现可运行接口，该类仍然扩展了其他基类。

> 下面给出了实现 Runnable 和扩展 Thread 之间最显着的区别：

**通过扩展 Thread，派生类本身就是一个线程对象，而实现 Runnable 接口则将同一个对象共享给多个线程。**

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2017-10-22T07:12:17.530

Thread 类定义了几个方法，可以`overriden`通过扩展类。但是要创建一个线程，我们必须重写该`run()`方法。同样适用于`Runnable`。

然而`Runnable`，这是创建线程的首选方法。主要原因是：

1.  由于 Runnable 是一个接口，因此您可以扩展其他类。但是，如果您扩展 Thread，那么该选项就消失了。

2.  如果您不修改或增强大量`Thread`功能并且扩展`Thread`类不是首选方式。

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2022-02-12T14:58:11.043

如果您想分离您的关注点，例如，如果您想创建任务并且谁是处理您的任务的工作人员并不重要，那么使用 Runnable 并将您的工作定义为任务。就像使用 executor service 时一样，您以 Runnable/callable 的形式定义任务，并将它们交给 executor service，然后由 worker 负责。

如果您想自己创建一个工作人员并将该工作人员分配给您的任务，您需要对工作线程进行更多控制，然后使用 Thread 类。

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2014-06-18T07:22:39.580

简单的说法是：如果您实现接口，这意味着您正在实现它的所有方法，并且如果您扩展类，您正在继承您选择的方法......在这种情况下，**只有一个名为 Run() 的方法**，所以**更好地实现 Runnable 接口..**

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2018-09-02T10:02:50.967

我会说实际任务与线程分离。在 Runnable 的情况下，我们可以将任务传递给 Thread、Executor 框架等，而扩展 Thread 任务与线程对象本身相耦合。扩展 Thread 时无法进行任务隔离。这就像我们将任务烧录到 Thread 对象，就像 IC 芯片一样（更具体地说，不会得到任何任务句柄）。

* * *

## 回答 #42

> 赞同：-1
> 
> 时间：2018-04-25T20:21:53.383

您可以共同使用它们

例子 ：

```
public class A implements Runnable{

    @Override
    public void run() {

        while(true){
             System.out.println("Class A is running");
        try {
            Thread.sleep(3000);
        } catch (InterruptedException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }}

    }

}

public class Test {

    public static void main(String[] args) {

        Thread myThread =new Thread(new A());// 1
        myThread.start();
        System.out.println(" executed after thread A");//will never be reached

    }

} 
```

* * *

## 回答 #43

> 赞同：-1
> 
> 时间：2018-12-05T03:58:43.357

Thread 和 Runnable 的主要区别是： - Thread 就像：Worker（执行 Runnable） - Runnable 就像：Job（由 Thread 执行）

# sql-server - 选择与 column2 匹配的 top column1

> ID：541494
> 
> 赞同：0
> 
> 时间：2009-02-12T14:30:27.640
> 
> 标签：sql-server, sql-server-2008

很抱歉问这个问题，但我已经没有想法了

我有这张桌子：

```
[id]    [pid]    [vid]
1        4        6844
1        5        6743
2        3        855
2        6        888
... 
```

我如何查询这个 eg.table 以获得以下结果：

```
[id]    [pid]    [vid]
1        5        6743
2        6        888 
```

我想获得与此 [pid] 匹配的 [vid] 的 [id] 的最高 [pid]

有任何想法吗？

我正在使用 mssql 2008

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T14:37:10.353

单程

```
select t1.* from
(select id,max(pid) as Maxpid
from yourtable
group by id) t2
join yourtable t1 on t2.id = t1.id
and t2.Maxpid = t1.pid 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T14:42:50.073

由于您使用的是 Microsoft SQL Server 2008，因此我建议使用[Common Table Expressions](http://msdn.microsoft.com/en-us/library/ms190766.aspx)和[OVER 子句来完成按](http://msdn.microsoft.com/en-us/library/ms189461.aspx)**id**将结果分组，并仅返回每个组中的第一行（按**pid**排序）。Bliek 的回答显示了一种方法。

（顺便说一下，同样的基本方法对于更有效的分页也非常有用。）

使用“标准”SQL 并没有非常好的方法来做到这一点。SQLMenace 的答案中显示的方法仅适用于可以将子查询用作表的数据库。例如，这是在 SQL Server 2000 中实现此目的的一种方法，但可能不适用于每个主流 RDBMS。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T15:33:44.163

我会使用公用表表达式 (CTE)。这提供了很多这样的可能性：

```
WITH Result (RowNumber, [id], [pid], [vid])
AS
(
    SELECT Row_Number() OVER (PARTITION BY [id]
                              ORDER     BY [vid] DESC)
          ,[id]
          ,[pid]
          ,[vid]
      FROM MyTable
)
SELECT [id]
      ,[pid]
      ,[vid]
  FROM Result
 WHERE RowNumber = 1 
```

# sas - SAS：自动执行文件的时间/将格式应用于数据集以供查看

> ID：541505
> 
> 赞同：1
> 
> 时间：2009-02-12T14:32:34.670
> 
> 标签：sas

这是背景。对不起，时间太长了：
我为 3 个不同的项目进行 SAS 编程。每个项目都有自己的主项目文件夹。每个主项目文件夹都包含一个格式文件夹（其中包含格式目录），然后是其他几个文件夹，每个文件夹都包含程序和数据集。我的大部分工作都是在批处理模式下完成的，所以 SAS 通常是不开放的。不过，有时我想在 SAS 中打开一个数据集来查看特定的内容。当我这样做时，SAS 不知道在哪里寻找合适的格式目录，因为格式目录从不与数据集位于同一文件夹中。所以我目前使用一个指定`nofmterr`选项的 autoexec.sas 文件，这样我的数据集就会打开。

不过，我真的很希望能够以适当的格式打开我的数据集。我编写了一个不同的 autoexec 程序，它使用一个对话框窗口询问我正在处理哪个项目，然后`fmtsearch`相应地设置选项。如果我想先打开 SAS，然后打开数据集，这非常有用。但是，如果 SAS 尚未启动并运行，并且我尝试通过双击打开数据集，则会发生以下情况：autoexec 文件开始运行，然后 SAS 尝试在 autoexec 文件完成运行之前打开数据集。因此，如果我`nofmterr`设置了，数据集将在没有格式的情况下打开，或者如果我没有`nofmterr`设置，数据集将根本无法打开。

所以这是我的问题：有没有办法让 SAS 等到 autoexec 文件完成运行后再尝试打开数据集？或者，有没有其他方法可以解决这个问题？（我不想将所有 3 个格式文件都添加到该`fmtsearch`选项中，因为不同的项目可能具有相同名称的不同格式。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T16:42:30.723

由于数据集是在没有任何代码运行的情况下打开的，这变得非常困难。是否可以将数据集作为代码的参数打开。我设想这样的事情：

```
commandline:/sas ./opends.sas -sysparm "/this/is/the/dataset/location_and_name" 
```

您的代码“opends.sas”将包含您项目的所有相关格式信息。

您甚至可以编写一个预定义所有上述内容的脚本（bash 或批处理，取决于操作系统），并且您可以使用数据集作为参数调用该脚本。

我知道这看起来很麻烦，但这是我根据您的描述想出的第一个解决方案。

--增加20090218

opends.sas 脚本应该接受一个 sysparm 变量，并且根据操作系统，它应该打印数据集或发出打开数据集的命令。

# php - PHP readdir（）不按字母顺序返回文件

> ID：541510
> 
> 赞同：19
> 
> 时间：2009-02-12T14:33:30.517
> 
> 标签：php

我正在阅读带有一些图片的目录，例如使用 readdir() 的非常简单的实现，如下所示：

```
if ($handle = opendir($path)) {
    while (false !== ($szFilename = readdir($handle))) {
    if ($szFilename[0] !== '.') {
        if (is_file($path.$szFilename)) {
                // do stuff
            }
        }
     }
 } 
```

我遇到的问题是文件没有按字母顺序读取，因为 readdir() 状态的文档：

> 返回目录中下一个文件的文件名。文件名按照文件系统存储它们的顺序返回。

另一个奇怪的事情是，在本地测试服务器上，相同的代码效果很好。在这两种情况下，它都在使用 LAMP 堆栈的服务器上运行。

我知道我可以构建一个数组并对其进行排序，但我想知道我在做的事情是否遗漏了一些东西。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-02-12T14:38:29.553

按字母顺序排列：：我认为您误读了您引用的片段...

> 返回目录中下一个文件的文件名。文件名按照文件系统存储它们的顺序返回。

'ls' 会以（通常）字母顺序显示文件的事实并不意味着它们就是这样存储在文件系统上的。恐怕 PHP 的行为符合规范。

如果必须按字母排序，您可能需要考虑使用[scandir](http://uk3.php.net/manual/en/function.scandir.php)作为您努力的基础。:)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-13T05:45:07.830

您可以将所有文件名复制到一个数组中，然后使用

```
<?php
sort($filesArray);
?> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-12T14:36:56.080

我想这里的文档很清楚。

> 它们在文件系统中的存储顺序

与字母顺序不一样

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T14:37:54.500

您误读了文档：

> 文件名按照文件系统存储它们的顺序返回。

表示文件按照创建的顺序返回。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-02-17T03:29:56.627

您可以使用以下几个：

字母排序：

```
<?php
sort($handle);
?> 
```

反向字母排序：

```
<?php
rsort($handle);
?> 
```

# encoding - 解密编码：数据包分析工具

> ID：541517
> 
> 赞同：4
> 
> 时间：2009-02-12T14:35:02.323
> 
> 标签：encoding, packet-capture, packet-sniffers, encryption

为此，我正在寻找比 Wireshark 更好的工具。Wireshark 的问题在于它没有干净地格式化数据层（这是我正在查看的唯一部分），以便我比较不同的数据包并尝试理解第三方编码（它是封闭源代码）。

具体来说，查看数据而不是 TCP/UDP 标头信息的好工具有哪些？特别是，一种格式化数据以进行比较的工具。

**非常具体**：我想要一个比较多个（不仅仅是 2 个）十六进制文件的程序。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-09T13:04:33.710

查看[BreakingPoint Labs 的这篇博文](http://www.breakingpointsystems.com/community/blog/manual-protocol-reverse-engineering)。他们正在讨论手动协议逆向工程和一套基于[PacketFu](http://code.google.com/p/packetfu/)构建的工具，以使这项任务更容易。

与您的问题相关的是一组工具，可以轻松识别和突出数据包的更改。这是一个示例屏幕截图，显示了使用颜色来勾勒数据包差异：（ [来源：][[breakpointsystems.com](http://www.breakingpointsystems.com/default/assets/Image/Blog%20Images/select_two_days.png)][）][![替代文字](https://i.stack.imgur.com/qo3hK.png)](https://i.stack.imgur.com/qo3hK.png)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-03T19:34:10.547

坦率地说，你最好的选择就是自己动手。

获得一种您熟悉的脚本语言并开始解决问题。首先编写一个简单的多路比较，但是一旦您开始找到您认为重要（或您认为可能）的模式，就返回并将它们添加到代码中——从输出中删除它们，突出显示它们，翻译它们换成另一种表示法，用它们的“意义”或对其角色的某种高级描述来替换它们——只要看起来合适。如果你不能决定，那就让它成为一个选项。

你要求可视化软件是因为你想要一些东西来帮助你形成和内化对它们编码的理解。但是您将要进行的比较只是您将使用的过程的一部分（这本质上是科学方法）——您还将形成和修改关于数据包各个部分的含义、它们如何相互作用的猜测， ETC。

没有预先构建的工具可以帮助你，但是一个好的脚本语言（比如 python、ruby 甚至 perl）会有很大帮助。当你形成一个理论时，把它编码并尝试一下。将你的代码混杂在一起，尝试不同的想法，并在你进行过程中构建一袋针对这个问题定制的技巧。

——马库斯

PS 不要陷入尝试使用 C 或 Java 或其他东西来做到这一点的陷阱。你会玩得又快又松，并且应该有一个不需要变量声明、编译等的工具。*一旦你了解它是如何工作的，就会有很多机会来收紧和重写它。*

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-10T08:02:26.067

您的问题不是分析网络数据，而是根据您的需要比较二进制文件。

我将通过任何嗅探器提取应用程序数据，即通过 Zoreadche 或 Wireshark 所描述的 tcpdump（即通过跟随 TCP 会话）。然后将其保存到文件并通过任何文件比较工具进行比较。你可以试试这些（最流行的）：

*   [考试专业版](http://www.prestosoft.com/edp_examdiffpro.asp)。真正快速比较目录。
*   [温默格](http://winmerge.org/)。虽然不如examdiff pro 快，但它是开源的，而且发展迅速。这是我的第一选择。
*   [超越比较](http://www.scootersoftware.com/)。这是我知道的唯一一个文件比较工具，它完全符合您的要求，即同时比较 try 文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-04T14:56:42.343

仅对于 HTTP，我曾经使用过一个很棒的工具，叫做[Effetech](http://www.effetech.com/sniffer/)。
（虽然现在看起来它们似乎支持的不仅仅是 HTTP ......）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T14:44:13.143

问题是应用层的数据不是标准的（很少有例外，比如 HTTP、POP3 等）。如果 Wireshark 等工具不知道格式，则无法解码此信息。

我知道一些旧版本的 Ethereal（现在是 Wireshark）可以选择（您可能必须启用它）来显示有效负载。期望它没有意义，大多数协议都是二进制的！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-05T06:12:40.410

如果您有使用 ethereal 完成的捕获，您可以读取捕获，或者您可以使用 tcpdump 进行捕获。要捕获使用 tcpdump 命令，如**tcpdump -s 0 -qn -X**或**tcpdump -X -r filename**将读取捕获。

```
22:08:33.513650 IP 192.168.32.10.40583 > 69.59.196.211.80: tcp 1261
0x0000:  4500 0521 18ec 4000 4006 322a c0a8 200a  E..!..@.@.2*....
0x0010:  453b c4d3 9e87 0050 b0b6 4b4f 1598 0090  E;.....P..KO....
0x0020:  8018 1920 9b4f 0000 0101 080a 002e 701b  .....O........p.
0x0030:  093c bc38 4745 5420 2f75 7365 7273 2f32  .<.8GET./users/2
0x0040:  3032 3637 2f7a 6f72 6564 6163 6865 2048  0267/zoredache.H
0x0050:  5454 502f 312e 300d 0a48 6f73 743a 2073  TTP/1.0..Host:.s
0x0060:  7461 636b 6f76 6572 666c 6f77 2e63 6f6d  tackoverflow.com 
```

或者还有另一个[tcpick](http://tcpick.sourceforge.net/)可能是您想要的。您可以捕获 tcp 连接的有效负载，并将其显示为十六进制或保存。

# linux - Linux 目录中只有问号

> ID：541533
> 
> 赞同：54
> 
> 时间：2009-02-12T14:37:34.407
> 
> 标签：linux, terminal

我正在我的 .ssh 主目录中列出目录，这给了我一个奇怪的结果：

```
ls -lsa .ssh/
total 0
? ?--------- ? ? ? ?            ? . ·
? ?--------- ? ? ? ?            ? .. ·
? ?--------- ? ? ? ?            ? authorized_keys · 
```

奇怪的是，这只发生在一个用户身上，而且只发生在这个特定的目录中。如果我在 su -l 之后执行 ls，一切都会按预期进行。另一个奇怪的事情是，我的 xterm 以红色闪烁字体显示目录列表！任何想法是什么导致这种情况发生？

谢谢！

**编辑：**
这是作为根目录列出的目录：

```
ls -lsa
total 52
4 drw-------  2 sdd sdd 4096 Feb 10 15:57 .
4 drwx------ 16 sdd sdd 4096 Feb 10 15:57 ..
4 -rw-------  1 sdd sdd 1628 Feb 10 15:57 authorized_keys 
```

我正在使用 ext3。

**Edit2：**
谢谢答案，但我仍然得到这个：

```
chmod -R 600 /home/sdd/.ssh
ls -lsan _ssh.old/
total 0
? ?--------- ? ? ? ?            ? .
? ?--------- ? ? ? ?            ? ..
? ?--------- ? ? ? ?            ? authorized_keys 
```

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2009-02-12T15:01:19.390

当用户无法对文件执行 stat() （需要执行权限）但可以读取目录条目（需要对目录进行读取访问）时，就会发生这种情况。因此，您会获得目录中的文件列表，但无法获得有关文件的任何信息，因为它们无法读取。:) 如果您有一个具有读取权限但不能执行的目录，您会看到这个。有人可能试图错误地保护 .ssh 目录 - 它应该是“chmod 0700 .ssh/”并且归拥有主目录的用户所有。很可能，有人按照说明保护 .ssh*文件*，但将其应用于 .ssh 目录。:)

如果您对任何目录执行 chmod 0600 或 0400，您可以轻松地重现此行为。将执行权限添加到目录，它会正常工作。

# mysql - 为什么 Apache 抱怨我的 mod_perl 程序“断开连接使 1 个活动语句句柄无效”？

> ID：541542
> 
> 赞同：8
> 
> 时间：2009-02-12T14:39:06.307
> 
> 标签：mysql, perl, apache, dbi

> disconnect 使 1 个活动语句句柄无效（在断开连接之前销毁语句句柄或调用完成）

以下从 MySQL 获取数据的代码成功执行，但会导致 Apache 在其错误日志中生成上述消息：

```
my $driver   = "mysql";
my $server   = "localhost:3306";
my $database = "test";
my $url      = "DBI:$driver:$database:$server";
my $user     = "apache";
my $password = "";

#Connect to database
my $db_handle = DBI->connect( $url, $user, $password ) 
    or die $DBI::errstr;

#SQL query to execute
my $sql = "SELECT * FROM tests WHERE id=?";

#Prepare SQL query
my $statement = $db_handle->prepare($sql)
        or die "Couldn't prepare query '$sql': $DBI::errstr\n";

#Execute SQL Query
$statement->execute($idFromSomewhere)
    or die "Couldn't execute query '$sql': $DBI::errstr\n";

#Get query results as hash
my $results = $statement->fetchall_hashref('id');

$db_handle->disconnect(); 
```

*   忽略上述错误/警告会产生任何可怕的后果吗？该代码已经运行了一周，没有任何不良影响。

*   代码有什么问题还是这只是一个无害的警告？

**编辑**

代码通过 mod_perl 执行。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-12T14:43:33.003

你应该`$statement->finish();`先打电话`$db_handle->disconnnect();`。

通常你不需要打电话`finish`，除非你没有得到所有的行。如果使用 循环获得所有结果`fetchrow_array`，则不会在最后调用完成，除非中止循环。

我不确定为什么 MySQL 驱动程序没有在`fetchall_hashref`. 该手册建议您的查询可能由于错误而中止：

> 如果发生错误， fetchall_hashref 会返回到目前为止获取的数据，可能没有。您应该在之后检查 $sth->err（或使用 RaiseError 属性）以发现数据是否完整或由于错误而被截断。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T14:54:38.297

这是由于句柄仍处于活动状态所致。通常它应该自行关闭，但您似乎并没有从中获取所有数据。来自DBI 上的[perldoc ：](http://search.cpan.org/~timb/DBI/DBI.pm#finish)

> 从 SELECT 语句中获取所有数据后，驱动程序应自动为您调用完成。所以你通常不需要显式调用它，除非你知道你没有从语句句柄中获取所有数据。最常见的示例是当您只想获取一行时，但在这种情况下 selectrow_* 方法通常会更好。在每个 fetch 循环之后添加调用完成是一个常见的错误，不要这样做，它可以掩盖真正的问题，例如未捕获的 fetch 错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-03T21:58:30.117

虽然可能不是您收到此*警告*的原因（这是[手册](http://search.cpan.org/dist/DBI/DBI.pm#finish)声称的内容），但我在略有不同的情况下遇到了相同的警告，并想在这里提出建议，而不是提出我自己的问题。

如果您执行查询以获取一些行，您可能会发现自己处于这种情况 - 但只是为了了解是否存在匹配的行。在我的情况下，如果找到匹配项，我们将更新行，否则插入。

因为没有对找到的行进行任何操作，所以我相信这构成了一个适合遵循警告引导的场景。因此，我`finish()`在断开连接之前调用了我的选择处理程序。

**免责声明**：作为 DBI 的新手，可能有更好的方法。`->do()`除了[文档](http://search.cpan.org/dist/DBI/DBI.pm#do)指出重复执行时不应使用它之外，我会使用它——出于某种原因也不鼓励*使用*语句`SELECT`！

这是一些 perl 伪代码，显示了我登陆的内容：

```
$selectHandler = $dbh->prepare($queryString) or die "Cannot prepare: ".$dbh->errstr;
#Loop through a list of keys to check existence {
    $selectHandler.execute($uniqueID);
    $found = 0;
    $found = $selectHandler->fetch();
    if (!$found) {
        # Do an insert of $uniqueID
    } else {
        # Do an update of $uniqueID
    }
#}
# Having not done anything with the selectHandler's result (when rows were 
# found) close it now that the loop is complete
$selectHandler->finish(); # we don't need you any more select handler!
$dbh->disconnect or warn "Disconnection error: $DBI::errstr\n"; 
```

希望这对其他人有所帮助，如果我误导任何人，请随时纠正我的方法。

# sql-server - 我将如何概括多个相邻的多边形？

> ID：541545
> 
> 赞同：9
> 
> 时间：2009-02-12T14:40:20.190
> 
> 标签：sql-server, sql-server-2008, geolocation, geometry, geospatial

当您有一个带有几何类型字段（或地理）的表时，您可以调用该`Reduce()`函数以减少形状的顶点数。效果很好。但是，当多个多边形相邻时（它们共享部分边界），缩小的多边形不一定这样做。

## 例子

SQL批处理：

```
CREATE TABLE #Shapes (
shape geometry,
naam varchar(50)
 )

-- exact:
insert into #Shapes (naam, shape) VALUES ('Area A',Geometry::STGeomFromText('POLYGON ((52.084744368912652 5.1304192959796637, 52.085234231548384 5.1304194002877921, 52.085474282948049 5.1304486630822, 52.0857341082301 5.1304792705923319, 52.086134375073016 5.1306082883384079, 52.086594087770209 5.13079824927263, 52.087194303050637 5.1311187236569822, 52.089074697112665 5.1323992793913931, 52.089834430487826 5.1333390253130347, 52.090353938518092 5.1341692635323852, 52.090254480473 5.1342997345712416, 52.090824429301414 5.13520842681262, 52.09141399711384 5.1360295349486274, 52.091884278226644 5.1365492835175246, 52.092085719574243 5.1367767199408263, 52.092194211203605 5.1368992186617106, 52.092494247804545 5.1372492032188495, 52.092884057915427 5.13754907634854, 52.093083867570385 5.137679290259257, 52.093254011290028 5.1378082139755827, 52.093554640188813 5.1380093733314425, 52.094204571098089 5.1384683684445918, 52.094214495038614 5.1384888619650155, 52.093702809136488 5.1390791568504124, 52.0939114689827 5.1395669728517532, 52.0938675517682 5.1396009074524045, 52.093849835848111 5.1396084928439114, 52.093797143315896 5.1396473892964423, 52.093789743114428 5.1396500989447063, 52.093731224210721 5.13969055645838, 52.093728204024956 5.1396938753314316, 52.093717452138662 5.1397007238119841, 52.09355255169794 5.139717671321705, 52.093311328208074 5.1395945930853486, 52.093306955655407 5.1395602072316251, 52.093115365831181 5.1400826557073742, 52.093052050564438 5.1401469679549336, 52.092979203676805 5.1401289247442037, 52.092756105586886 5.1398569964803755, 52.092737412561 5.1397823067194368, 52.09235419591127 5.1398883965623128, 52.092214386788811 5.1400686172528616, 52.092164272349919 5.1401695687556135, 52.09208471653983 5.1403786691371351, 52.0920239102561 5.1405293103307486, 52.091924546519294 5.1407297900877893, 52.091534494888037 5.1407990844454616, 52.091654436912947 5.1401591910829172, 52.091713753540262 5.1397284107361845, 52.091763769509271 5.1391488309018314, 52.091774359305148 5.1390583129178058, 52.09170373348757 5.1383788494901648, 52.0907391263172 5.1386201300192624, 52.090711282333359 5.1385075189173222, 52.090718721970916 5.1384486802853644, 52.090745792724192 5.1383893731981516, 52.090758387919244 5.1383728119598793, 52.090776969445869 5.1383237342815846, 52.090780415022657 5.1383173598065737, 52.090745287947357 5.1382717578671873, 52.090742629869759 5.1382662602414895, 52.090704807080328 5.1382211977615952, 52.0906867091544 5.1381677808240056, 52.090701617482885 5.1380081428639635, 52.090564404382455 5.138029116065514, 52.09062412660569 5.1386488282587379, 52.090704361908138 5.1396187201607972, 52.09069472597912 5.1397384563460946, 52.090674098813906 5.1398086878471076, 52.090624484543433 5.1397491229489587, 52.090589968811038 5.1397359627815975, 52.090441891923547 5.140045978827402, 52.090305342804641 5.1400443047750741, 52.0902322656475 5.139729289803654, 52.090199632104486 5.1394877941347659, 52.090188750764355 5.1393666968215257, 52.0902532400633 5.1393868076773792, 52.09003754449077 5.1387802169192582, 52.090024582457204 5.1386965749382565, 52.090020758565515 5.1386840578634292, 52.0900124781623 5.1386172670806785, 52.090003480669111 5.1385827830526978, 52.08999918546494 5.1385372205978728, 52.089985796017572 5.1384773049503565, 52.089996868744493 5.1384535257238895, 52.090046249330044 5.138385351980105, 52.090212456043091 5.1382693609882955, 52.090183896290647 5.1379786310671935, 52.090166853580648 5.1378115779987894, 52.0899735938292 5.137785307597369, 52.089885840192437 5.1377143466379493, 52.08985487697646 5.137671007309109, 52.089845903217793 5.1376524229999632, 52.089844238944352 5.1376464897766709, 52.089850628050044 5.1375868958421052, 52.089852778393364 5.137576853302618, 52.089863699774533 5.1374888862706634, 52.089867451693863 5.1373642447870225, 52.089883847394958 5.1373361134901643, 52.089941705111414 5.1372730266302824, 52.090002277167514 5.1372403032146394, 52.090108146462811 5.1372361269295483, 52.09006458793673 5.1368091938053615, 52.089683820260689 5.1369396857917309, 52.089193989204269 5.1364887236994123, 52.088854428613558 5.1373995044268668, 52.088474480202422 5.1383894786704332, 52.088474343996495 5.1383894337341189, 52.088464433038652 5.1383690948872287, 52.088414154422111 5.13834898790222, 52.088394471909851 5.1383694768883288, 52.0883943233639 5.1383694719988853, 52.08832395415709 5.1382487505018526, 52.087933741509914 5.1377592226490378, 52.087544413445592 5.1372594955892383, 52.087484167695806 5.1372292107739481, 52.087364645209163 5.1372284211684018, 52.0869538753575 5.1372190437554366, 52.085683952551335 5.1372596949804574, 52.085304662585258 5.137269108556211, 52.085084051657141 5.1370588609653955, 52.084904317976907 5.137469710316509, 52.084444417446747 5.1384497439414369, 52.084454428168293 5.1385195698547266, 52.084484005579725 5.1385092278942466, 52.084537888644263 5.1385357407853007, 52.084511198022149 5.1389506391238067, 52.084534639492631 5.1391157133039087, 52.084215438459069 5.139372929232195, 52.084103818604156 5.1389697602953825, 52.083964082412422 5.1391396226827055, 52.083963935496286 5.139139630831778, 52.083883681101725 5.1390291205607355, 52.083994359437455 5.1386593720505784, 52.084013982437057 5.1385892418004318, 52.084053878448593 5.1383293403318735, 52.084054407430678 5.1377297231794907, 52.084053982747719 5.1375283871311694, 52.084063940448686 5.1371387927792966, 52.084070490673184 5.13703247718513, 52.084070608951151 5.1370323959272355, 52.084217049471441 5.1370617711960529, 52.0842700656977 5.1370595147110754, 52.084318579515468 5.1370449147663777, 52.084365648221834 5.137017846536426, 52.084410294202549 5.1369791406907863, 52.084451525192954 5.1369308069453, 52.084497402298688 5.1368615722581685, 52.084511263761669 5.1368357082828879, 52.084539652187722 5.1367929205345337, 52.084559679031372 5.1367565956898034, 52.084580525973493 5.1367251129565776, 52.0845936126653 5.1367018828692963, 52.084593039704487 5.1366802926640958, 52.084593520236 5.1366613829106731, 52.084592797560617 5.136602794053033, 52.0845930285151 5.1365417347624449, 52.084591784281656 5.1365062294062227, 52.084592622431977 5.1364672367903337, 52.084591892315075 5.1364289335906506, 52.084595442516729 5.13633631542325, 52.084596794845957 5.1363224481129421, 52.084599652094766 5.13625919749029, 52.084600140111739 5.1362545876124468, 52.084603969780289 5.1361925578721053, 52.084604394622147 5.1361672168131918, 52.084607248043845 5.1361305358165161, 52.084609296828042 5.13606852098146, 52.084609103156254 5.1360535530839115, 52.084611643842678 5.1360064989442122, 52.08461217648793 5.1359452261162533, 52.084612038685009 5.1359415214974433, 52.084614087827504 5.1358594063203782, 52.084640604443848 5.1355516116600484, 52.084642857778817 5.135543460957706, 52.084982043160878 5.1354961035347806, 52.085083917947486 5.1345288194715977, 52.085104202153161 5.1343492493033409, 52.08524441709433 5.1330996853375064, 52.085165794240311 5.1330994283780456, 52.085158604676472 5.1330777355575146, 52.084887840552256 5.1328501671087, 52.084870130718066 5.1327825202649118, 52.084810143569484 5.132734818616882, 52.084766256157309 5.1326845148578286, 52.084753367166229 5.1326649976350005, 52.084720281418413 5.1326657184399664, 52.084673544857651 5.1326567681971937, 52.084627489326522 5.13263783371076, 52.084616634761915 5.1326309095602483, 52.084607382304966 5.1326056816615164, 52.084589018020779 5.1325388213153929, 52.084566780831665 5.1324195361230522, 52.08455663616769 5.1322953840717673, 52.084555578185245 5.1322289216332138, 52.084558193339035 5.1321669477038085, 52.084565328201279 5.1320932512171566, 52.084573237691075 5.1320388016756624, 52.084590001497418 5.1319514436181635, 52.084614846622571 5.1318454830907285, 52.084674907008818 5.1317076328407039, 52.084733415627852 5.1315451303962618, 52.084768428234277 5.1314570531469457, 52.084772500442341 5.131445026723668, 52.084790059469135 5.1313976899708305, 52.084790684864267 5.1313653332182225, 52.084789962507784 5.1313581170979887, 52.084786229995423 5.1313093374080232, 52.084781658835709 5.1312665985897183, 52.084776584757492 5.131205978570506, 52.084776126593319 5.1311985920700378, 52.084773858077824 5.1311737054493278, 52.084770929767942 5.1311195062007151, 52.084764682454988 5.1310441740788519, 52.084762406875207 5.1310067452953634, 52.084759807214141 5.1309909871779382, 52.084745739819482 5.1308908765204251, 52.084737451048568 5.1308199469931424, 52.084731393493712 5.1307550501078367, 52.084726219235463 5.130682019587562, 52.084717591805187 5.130595849588774, 52.084696356672794 5.1304316397290677, 52.084744368912652 5.1304192959796637))', 1) );
insert into #Shapes (naam,  shape) VALUES ('Area B', Geometry::STGeomFromText('POLYGON ((52.089193944586441 5.1364884474314749, 52.089683880347387 5.1369394774090678, 52.090064640389755 5.1368089618626982, 52.090064767515287 5.13680902402848, 52.090108351781964 5.1372362461406738, 52.0900023451254 5.137240494616317, 52.089941830607358 5.1372731845887953, 52.089884013120034 5.1373362265352416, 52.089867649300196 5.13736428650584, 52.089863897534087 5.1374888976570219, 52.089852973818779 5.1375768855214119, 52.089850827719964 5.1375869208953633, 52.08984444080243 5.1376464707614575, 52.089846089016071 5.1376523461555816, 52.089855048116348 5.13767090524721, 52.089885986401136 5.1377142074887443, 52.089973680692943 5.137785122508185, 52.090167043032125 5.1378114717081189, 52.090184094849974 5.1379786091856658, 52.090212659211829 5.138269433286041, 52.090046387117965 5.1383854977954284, 52.089997038751484 5.1384536319841185, 52.089986001565585 5.1384773087642488, 52.0899993844796 5.138537187827751, 52.090003677353721 5.1385827515141784, 52.0900126749184 5.1386172289494425, 52.090020956756526 5.1386840232833055, 52.0900247762911 5.1386965326964855, 52.090037737332914 5.1387801609122805, 52.090253500966355 5.1393869426101446, 52.090253373142332 5.1393870580941439, 52.09018895904866 5.1393668668649326, 52.09019982968524 5.1394877681651483, 52.090232462748588 5.1397292593531256, 52.090305473417473 5.1400441225035083, 52.090441768325739 5.1400458008552627, 52.0905898406636 5.1397357748355716, 52.090624607168138 5.1397489595692605, 52.090674059544682 5.1398083794509937, 52.090694529374325 5.1397384163970843, 52.090704163346672 5.1396187301667995, 52.0906239267189 5.1386488468750029, 52.090564216952771 5.1380289690569043, 52.090701825218275 5.138007998932153, 52.090686907175666 5.1381677433547006, 52.090704979235063 5.1382210930865915, 52.090742795495316 5.13826614478603, 52.090745454392028 5.1382716438933382, 52.090780634433031 5.138317345874384, 52.090777151606311 5.1383238151729582, 52.090758565347642 5.1383729032240808, 52.090745967798135 5.1383894728374937, 52.090718918413778 5.1384487237036574, 52.09071148235433 5.1385074989634694, 52.090739235906476 5.1386199161658359, 52.091703911079094 5.1383786785881966, 52.091774561209604 5.1390583219472319, 52.091763966455993 5.1391488551129392, 52.091713952366263 5.1397284283302724, 52.091654634801671 5.1401592225302011, 52.091534660555041 5.1407988700928273, 52.091924405223438 5.1407296329252166, 52.092023730557614 5.1405292234111544, 52.092084533682055 5.1403785903667165, 52.092164086876437 5.1401694919914007, 52.092214212752879 5.1400685210246593, 52.092354092746973 5.1398882211651653, 52.092737518250942 5.1397820895072073, 52.092756280866688 5.1398568955139261, 52.092979332917338 5.1401287692562034, 52.093051998862443 5.14014675848039, 52.093115186976668 5.1400825616937738, 52.093306944705546 5.1395597066730261, 52.093307103263214 5.139559774659574, 52.093311476645688 5.1395944439214718, 52.093552575019729 5.1397174675798443, 52.093717376162488 5.1397005364784905, 52.093728081547653 5.1396937158987059, 52.093731097411364 5.1396904007997364, 52.093789641978219 5.1396499255206436, 52.09379703433958 5.139647218074332, 52.093849730910733 5.139608321711421, 52.0938674450952 5.1396007388582916, 52.093911277158938 5.13956686834194, 52.093702596845105 5.1390791060402989, 52.094214342534542 5.1384887341409922, 52.094234085874632 5.1384696427267045, 52.094364419566851 5.1384893088412067, 52.094364145770669 5.1383595434017479, 52.094394268468022 5.1381287302356213, 52.09443390479516 5.138148912037261, 52.094484106955747 5.1381194878988437, 52.094514668919146 5.1380682252347469, 52.094674076435417 5.1382088991813486, 52.095094393635229 5.1384881954232995, 52.0952940530714 5.1385585838544232, 52.095604252303019 5.1385889891535044, 52.095554116032766 5.1386696371579523, 52.095534724403237 5.1388492132525849, 52.095524277190037 5.1390082753444624, 52.095594465266913 5.1390487975440919, 52.095594199141487 5.1393494226504117, 52.09559461963309 5.1399783839006, 52.095604153974683 5.1410990775805754, 52.095644179129778 5.1413294123732438, 52.09575448022224 5.1416396433487535, 52.095824270925078 5.1419194503811445, 52.096084321906162 5.1429293346052836, 52.096143952025322 5.1430793148784755, 52.096264120657 5.1433793206233531, 52.096193926805284 5.1433798011214318, 52.096113997035054 5.14339920294765, 52.096024247104872 5.1434492955148228, 52.095944452364236 5.1435387324349744, 52.095874538511147 5.14362958598761, 52.095844099589421 5.143679338650661, 52.095844470186279 5.1438587997111922, 52.095854729064243 5.1440396906996444, 52.095894579105732 5.1441883100385768, 52.095964113250375 5.144369007088244, 52.09580374216273 5.144229786732418, 52.095674295010134 5.1441983953353239, 52.095563816432822 5.14421941922198, 52.095403983902024 5.1442888717546564, 52.095254029380158 5.1443597327452153, 52.094414402963594 5.1447291097138077, 52.094194360597214 5.1448091029165, 52.093554132385179 5.1451087987516075, 52.09298392268829 5.14536870829761, 52.092384074527615 5.1456389861371825, 52.091314621968991 5.1461291963244005, 52.091214230906282 5.1462493549551356, 52.091174073517323 5.1464188823010772, 52.0911739426665 5.146418813848868, 52.09113409327086 5.1462687528401041, 52.091084660668564 5.146199182483377, 52.091033940669149 5.1464488115161657, 52.090953806928624 5.1464084108564867, 52.090854425442245 5.1464496781230418, 52.089684411417693 5.1471287335734814, 52.0895846124041 5.1471190678897267, 52.088994233263378 5.1476095448153067, 52.088864096673205 5.1477386702317744, 52.088784483494237 5.1475289191585034, 52.088713807872537 5.1472491544173726, 52.088664193741309 5.1471487923554067, 52.088594123489734 5.1471287621828763, 52.088524112701435 5.1471597642893574, 52.088323859963566 5.1472586041782051, 52.088194384938106 5.1472490853630006, 52.088083737995476 5.147229231428355, 52.087984558660537 5.1470896604005247, 52.0871439545881 5.144788873847574, 52.086584153570342 5.1431184258301306, 52.086113808001116 5.1425490758657, 52.085764196002856 5.142129332292825, 52.085273851326242 5.1414594290601263, 52.084604130359367 5.1405483337584883, 52.08448414108716 5.1403388837352395, 52.084363697096705 5.1399091542698443, 52.084215331124142 5.1393728284165263, 52.084534444796994 5.1391156225659822, 52.084510998101905 5.1389506384730339, 52.084537685041475 5.1385358115798789, 52.084483979582181 5.1385094355204064, 52.084454281721264 5.138519779080525, 52.084444217151031 5.1384497005492449, 52.084904137838336 5.1374696237373572, 52.08508396637626 5.1370586035773158, 52.085304709049147 5.1372689084542849, 52.085683944402767 5.1372594968589222, 52.08695387118496 5.1372188439127058, 52.087364651495307 5.1372282228088277, 52.087484228890389 5.137229019543156, 52.087544555542991 5.1372593543492258, 52.087933897256818 5.1377590987963755, 52.088324117939919 5.1382486345246434, 52.088394418613781 5.138369242607296, 52.088414155179635 5.1383487726561725, 52.0884645585902 5.1383689332287759, 52.0884744236222 5.1383891381781037, 52.088854240353591 5.1373994332191018, 52.089193944586441 5.1364884474314749))', 1) );
insert into #Shapes (naam,  shape) VALUES ('Area C', Geometry::STGeomFromText('POLYGON ((52.081104027922265 5.1258389879949391, 52.081314665614627 5.1259588550310582, 52.082414517994039 5.1266395719721913, 52.082954646321014 5.1270186660112813, 52.083513987367041 5.127549389610067, 52.083794155623764 5.1278395495610312, 52.084174386574887 5.1282589976908639, 52.084274505455781 5.1284189013796713, 52.08453426125925 5.1288288246141747, 52.085124507819643 5.1299386160409242, 52.08521465482071 5.1300693768952019, 52.0853342462746 5.1301182725468744, 52.0854241597699 5.1300988405710086, 52.0854743384989 5.1304488354362547, 52.085234220619661 5.130419600171515, 52.084744388967557 5.1304194940048324, 52.08439406089019 5.1305090384557843, 52.083914360133932 5.1306285039224422, 52.083414051565342 5.1307787221157923, 52.082813916262239 5.13094844610896, 52.082724283281529 5.1306586048111562, 52.082483787322417 5.1300093204481527, 52.08225411306649 5.1293789464909949, 52.082194455789093 5.1292188489812043, 52.082134172902443 5.1291885531973094, 52.082084508962 5.1290896165883169, 52.082023798371665 5.1288696515839547, 52.081883911043406 5.1281993770971894, 52.081856097793207 5.12798699515406, 52.081856237724423 5.1279869175050408, 52.082000762340613 5.1280515332473442, 52.082027135184035 5.1280940270517021, 52.0820355968099 5.1281161647869, 52.08205282002023 5.1281410993754166, 52.08213594150827 5.1278323108932256, 52.0820438895719 5.1277594091965328, 52.081953932996839 5.1277496579568833, 52.081884289887846 5.1271693162703134, 52.081813924670755 5.1270196131258938, 52.081552422139794 5.1268787173321471, 52.08152364961375 5.1267665265884057, 52.081485387952739 5.1266524291002371, 52.081442847483068 5.1265567842247837, 52.081396028901857 5.1264795880384764, 52.081344932177927 5.1264208389159505, 52.081293396464417 5.1263833287749234, 52.081279310281388 5.1263776289997622, 52.081249886541627 5.1263603481929749, 52.081222431567454 5.12633884719625, 52.081221418222412 5.1263384295161813, 52.081197269726545 5.126324187265709, 52.081195053295232 5.1263138890499249, 52.081184833077714 5.1262332251062617, 52.0811841667945 5.1261982778874859, 52.081168951815926 5.1261331316782162, 52.081164751928249 5.1260440781433525, 52.081066497950815 5.1259329431923106, 52.081104027922265 5.1258389879949391))', 1) );
insert into #Shapes (naam,  shape) VALUES ('Area D', Geometry::STGeomFromText('POLYGON ((52.084103860426694 5.1389694481622428, 52.084363892148971 5.1399091025981294, 52.084484331319835 5.1403388143996294, 52.084604299141489 5.1405482272725367, 52.08527401345782 5.1414593127556145, 52.085764355740025 5.1421292096101565, 52.086113962111995 5.1425489480607212, 52.086584335425869 5.1431183374952525, 52.087144145466013 5.1447888108543749, 52.087984736636635 5.1470895681108679, 52.088083857744529 5.1472290623707631, 52.088194406595086 5.14724888795369, 52.088323822820605 5.1472584035787792, 52.088524032849818 5.14715958177112, 52.088594117900357 5.1471285563893616, 52.08866433496587 5.1471486398950219, 52.088713997742161 5.1472490890882909, 52.088784678140655 5.1475289016962051, 52.088534413350153 5.1477695436890123, 52.088604030199349 5.1479895326774567, 52.08846407078854 5.1481186849763318, 52.088304384844378 5.1482683648355305, 52.087993860917578 5.1484991029959017, 52.087834112113342 5.1486196045298129, 52.0874739959836 5.1487791088875383, 52.087183827068657 5.1488594498950988, 52.087034655727216 5.1488792099405627, 52.086844170233235 5.1489094072021544, 52.086553779430687 5.1488890685141087, 52.086283983197063 5.1488190072122961, 52.086004210880986 5.148699401849246, 52.085884556407109 5.148648968199268, 52.085783737245947 5.148579464526847, 52.085444359574467 5.1483186569530517, 52.08505431888625 5.147909271530807, 52.085063869832084 5.14774867403321, 52.085103993769735 5.1475894195027649, 52.085123664481678 5.1475485048696683, 52.084903807879783 5.1472594002206034, 52.084644382136524 5.1469792136778958, 52.08418409107253 5.1464885615278035, 52.0837237383239 5.1459687419701368, 52.083234543621856 5.145409702023275, 52.082664410911732 5.1448292277490495, 52.082063829526305 5.1443087360821664, 52.082091124779964 5.1440836547198483, 52.081992223858833 5.1440890550147742, 52.08196270884946 5.14405638189055, 52.081944186007604 5.1439888756722212, 52.08194406144986 5.1439872064089114, 52.08192484639585 5.1439289392437786, 52.081920254660311 5.1439031759941996, 52.081906982464716 5.1438652367796749, 52.081898384261621 5.143827152704362, 52.081886463514792 5.1437939475605585, 52.081860758494884 5.143810536588699, 52.081833417158236 5.1438379039788957, 52.081759569933638 5.14407270308584, 52.0816137263635 5.1439596123534246, 52.081454453474372 5.1438598307431391, 52.081304313847795 5.14384896773845, 52.080264462672268 5.1430187125121805, 52.079664091113955 5.1425989381968975, 52.079524534521624 5.14249899610877, 52.079534315969795 5.1424492821097374, 52.079674492839317 5.1419992103874552, 52.079703816364884 5.1418385940623406, 52.079714205814525 5.141648898134008, 52.079727753764018 5.1414623958989978, 52.080252137147674 5.1417998058748831, 52.08029427562046 5.1417563394152745, 52.080314928898588 5.1417286938522011, 52.0803562682122 5.1416860464960337, 52.080404439009726 5.1416505186352879, 52.080450373701751 5.1416298456024379, 52.080458209152553 5.1416284950795994, 52.080495744477957 5.141600257018581, 52.080541761592031 5.141581037081778, 52.080577370766676 5.1415776146752092, 52.080586124956035 5.1415745182313319, 52.080565002281219 5.1411468000151217, 52.080635850084946 5.1411388639826328, 52.081214110314008 5.1410789246463136, 52.081586783519015 5.1409964717458934, 52.081614242866635 5.1412574960850179, 52.081570835318416 5.1413511682767421, 52.08156742547277 5.1413547724810877, 52.081523078051127 5.1414396720759816, 52.081520885843375 5.1414458907124478, 52.0815235725604 5.1414493722841144, 52.081564587075263 5.1415304632391781, 52.081586116692051 5.1416122366208583, 52.081591385416651 5.1417623861789625, 52.081744097638875 5.1417384068481624, 52.081754462670077 5.14239915706246, 52.081888611945665 5.1424242914485125, 52.081887235166505 5.1422738104593009, 52.081907565006986 5.1422072551213205, 52.081948822597042 5.1421398329548538, 52.081990273194968 5.1420943139491024, 52.082000561989844 5.1420720012392849, 52.082041298272088 5.1420040489174426, 52.08205503895892 5.1419854623652519, 52.082057312844228 5.1419532595345077, 52.082057383609936 5.141936854692176, 52.082061406905325 5.1418724298121266, 52.082061399472877 5.1418698709458113, 52.082065169426741 5.1418023992023132, 52.08206505025737 5.1417857583146542, 52.082067978335544 5.1417265709023923, 52.082068552136519 5.1417210444026873, 52.08207146529282 5.1416510321596576, 52.082074348499624 5.1415691960222105, 52.082074102712795 5.1415587870869786, 52.082077217031589 5.141500341455882, 52.082077142713729 5.1414836310842942, 52.082064611044075 5.1414689618560345, 52.08204338257201 5.1414488023146987, 52.0820095549712 5.1414023755017455, 52.08195383178483 5.1413428048418419, 52.0819458400365 5.1413370133377612, 52.081897551489291 5.141270585100548, 52.081845151958987 5.1412304241675884, 52.081783577566966 5.1409387167077512, 52.082063805446388 5.1408189585007031, 52.082534100375206 5.1404983382591407, 52.082604082068428 5.1404395992867649, 52.082693810134288 5.1403690781753832, 52.083284175475136 5.1398683352445742, 52.083963928950048 5.1391394941752653, 52.084103860426694 5.1389694481622428))', 1) );

select naam, shape, shape.Reduce(0.001) as reducedShape from #Shapes

drop table #Shapes 
```

这将返回两组多边形。首先是未约集：

![替代文字](https://www.xs4all.nl/~teund/stackoverflow/areas1.png)

然后是缩减集：

![替代文字](https://www.xs4all.nl/~teund/stackoverflow/areas2.png)

这些形状要简单得多，并且它们的粗略形状确实正确，但我想要的是仍然共享边框部分。所以他们必须在某种程度上一起减少。

我认为您必须首先将它们分解为多段线（从边缘到边缘），然后减少线，然后再次将它们重新组合成多边形。我不知道如何在 T-SQL 中做到这一点。

有任何想法吗？

*编辑：* 我接受了 alphadaogg 的回答。当前的两个答案对我来说并不完全令人信服，但 alphadogg 肯定付出了最大的努力，我非常感谢任何想法的分享。所以赏金给了他。

如果我找到令人满意的方法，我稍后会跟进自我回答。

**跟进**：我与 SqlServer Geo 团队的项目经理 Isaac Kunen 发送了电子邮件。他的有益回应如下：

> 你的问题一点也不罕见，但它不是我们直接支持的：这是一个需要了解你的图形拓扑的操作，我们没有内置这样的东西。本质上，你不想要为每个邻域存储单独的多边形。相反，您希望存储代表边界部分的曲线，并将这些边界重新用于多个多边形。概化时，您会概化共享边界，并且所有从属多边形都会受到影响。
> 
> 你可以自己构建它——正如你引用的线程中的海报所暗示的那样——但这可能是真正的努力。
> 
> 我不知道您正在使用的第三方软件，但这是另一种选择。如果您不想要一个成熟的 GIS，您可以使用像 Safe Software ( [http://www.safe.com](http://www.safe.com) ) 中的 FME 这样的软件包。FME 不做通用拓扑，但我相信它有足够的功能来做你正在寻找的东西。请参阅： http: [//www.safe.com/products/desktop/under-the-hood.php#3b](http://www.safe.com/products/desktop/under-the-hood.php#3b)。
> 
> 我希望这有帮助。
> 
> 干杯，
> 
> -艾萨克

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T14:52:39.700

哇，这是一组非常酷的功能。

看看其他一些可用的方法，这里有一些想法：

在未简化的形状上，使用 .STIntersects（返回布尔值）和 .STIntersection（返回形状）来确定两个形状是否相交以及相交的位置。

对于两个相邻的地图区域，我假设 .STIntersection 应该返回与两者接壤的线段。

然后你可以减少这些线段并重新组装减少的形状。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-17T22:30:06.497

我不确定你如何从你的形状中获得“共享”的 LineStrings。其次，一旦您减少形状的“子集”，因为您的端点可能会从原始端点移动，并且您将无法在减少后使它们匹配。

简而言之，我要做的基本上是使用布尔运算来处理缩小的形状。

首先，做你该做的，即创建一个缩小形状的临时表（称为`#ReducedShapes`）。

然后，我将创建第二个临时表并找到`STIntersection`所有形状之间的重叠区域（使用 ）。在这张表中，我基本上会有 columns和`naam1`，最后一个是 shape 类型。类似（未经测试）：`naam2``intsec`

```
INSERT INTO #IntSecs(naam1, naam2, intsec)
SELECT s1.naam, s2.naam, s1.naam.STIntersection(s2.naam)
FROM #ReducedShapes s1, #ReducedShapes s2 
WHERE s1.naam.STIntersection(s2.naam) IS NOT NULL 
```

这将为您提供形状对重叠位置的列表。实际上，每个重叠都有两行。例如，如果 A 和 B 重叠，您将拥有 and 。对于每次出现，我都会通过并删除两者中的一个。

最后，对于每个重叠，我会从表**中的两个**区域中的一个中减去 ( `STDifference`) 交集。想象一下，你有两个半重叠的正方形 A 和 B。该操作将涉及 A.STDifference(B)，这意味着您保留所有 B 和一半 A。我会将修改后的形状插入到第三个表中（例如）。**`#ReducedShapes``#ModifiedShapes`**

 **两个问题：a) 正如您从“橙色”和“蓝色”形状中看到的那样，它们并没有类似地减少，因此您将获得两种可能的减少之一，具体取决于您如何处理“获胜者”。b）问题的更复杂形式是，根据初始形状的复杂性，您可能会在三个或更多区域之间重叠。您必须根据您的特定需求确定自己的方式来确定哪个形状在该交叉路口“获胜”。目前尚不清楚是否有限制。可能就像通过订购任意挑选获胜者一样简单，也可能更复杂，因为准确性很重要。

不幸的是，上述概念并未解决差距问题。这个有点复杂，我不是 100% 确定如何解决它。但是，如果您创建第三个表格，从所有原始形状中减去（`STDifference`再次）所有修改后的形状（当然，在实际减去之前测试重叠），您将在间隙中留下剩余形状。您想要聚合相邻的形状并指定“获胜颜色”，可能会将其与相关形状合并。`#ModifiedShapes``#Shapes`

这个答案很长，我会这样。我可能会叫错树。根据您的反馈/问题，我会添加到帖子中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-05T22:07:27.407

Isaac 是对的，您可以将要素简化为线，并将它们用作共享边界。

但他提到的软件 - FME - 有一个称为 Generalizer 的转换器，它可以根据您的需要简化它们，同时仍将它们保留为多边形。使用的选项称为“保留共享边界”。您可以从 [此处][1] 下载 FME 并申请 14 天评估许可证以进行试用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-06-01T21:46:00.650

严格来说，这不是您问题的答案，但如果您的最终目标是在浏览器中呈现地图，那么您应该查看 Mike Bostock 的 TopoJSON 项目。

![在此处输入图像描述](https://i.stack.imgur.com/KezOx.png)

TopoJSON 与 GeoJSON 一样，是一种对 javascript 友好的空间文件格式。与 GeoJSON 不同，TopoJSON 仅包含拓扑，因此共享边界仅表示一次。这导致（a）更紧凑的数据和（b）无缝简化。

这里有一个很好的介绍，包括用于推断拓扑的算法的实时可视化：http: [//bost.ocks.org/mike/topology/](http://bost.ocks.org/mike/topology/)

项目维基在这里：[https ://github.com/mbostock/topojson](https://github.com/mbostock/topojson)

# c# - 预构建 MSBuild 任务以更新与构建的 exe 不同步的 AssemblyInfo

> ID：541546
> 
> 赞同：21
> 
> 时间：2009-02-12T14:40:22.013
> 
> 标签：c#, visual-studio, msbuild, prebuild, generated

我在 Visual Studio 2008 中使用调用 msbuild 的预构建任务：

```
C:\WINDOWS\Microsoft.NET\Framework\v3.5\MSBuild.exe $(MSBuildProjectDirectory)\version.targets /p:Configuration=$(ConfigurationName) 
```

在 version.targets 中，我正在更新 AssemblyInfo.cs 文件以替换版本信息：

```
 <FileUpdate
        Encoding="ASCII"
        Files="$(MSBuildProjectDirectory)\Properties\AssemblyInfo.cs"
        Regex="AssemblyInformationalVersion\(&quot;.*&quot;\)\]" 
        ReplacementText="AssemblyInformationalVersion(&quot;Product $(ConfigurationString) ($(buildDate))&quot;)]"
    /> 
```

当我通过 Visual Studio 2008 构建项目时，它的构建没有任何问题。

但是当我查看生成的 exe 的版本信息时，它包含以前的时间戳，即使 AssemblyInfo.cs 已更改为“正确”的时间戳。

似乎主编译任务看不到预构建的更改，并且总是落后。

关于我做错了什么的任何想法？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-14T16:11:01.597

我不认为你做错了什么 - 这是一个错误。

我已经[在这里](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=423670)报告了- 检查您是否可以复制它并添加验证，也许我们可以通过 MS 修复它。

编辑：我尝试了“Si”的建议来更新“BeforeBuild”事件中的文件 - 但是我仍然得到与 Visual Studio 2008/SP1 相同的错误结果。

**更新/解决方法**：MS 已回复错误报告。作为一种解决方法，您可以添加

```
<UseHostCompilerIfAvailable>FALSE</UseHostCompilerIfAvailable> 
```

到您的 csproj 文件。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-09-28T01:47:11.950

技巧+1 `<UseHostCompilerIfAvailable>FALSE</UseHostCompilerIfAvailable>`，尽管接受的解决方案和链接的文章都没有指定**该行应该添加到文件中的*第一个* `<PropertyGroup>`元素`.csproj`**。

这也是仅 Visual Studio 的问题，因为从命令行对同一文件调用**msbuild**`.csproj`（没有技巧）将看到立即编译生成的代码文件（而不是以前的版本）。

另外，我想建议用以下内容标记这个主题，因为我必须挖掘很多才能找到它：

1.  视觉工作室
2.  编译器
3.  构建之前
4.  生成
5.  。网
6.  C＃

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-14T16:41:01.867

有趣的是，我编写了自己的自定义任务，该任务与 BeforeBuild 挂钩，并且运行良好。通过命令行从未遇到过来自 VS 或 MSBuild 的问题。所以我会说探索BeforeBuild更多......

我知道是因为我们使用我们的构建服务器 (CruiseControl.NET) 构建号作为版本的“构建”部分，它内置于所有程序集中（我们在解决方案中的程序集之间共享相同的 AssemblyInfo.cs 和 AssemblyFileVersion）和然后将其推送（通过 FileUpdate 任务）到我们 WiX 项目中的变量，并用于标记 MSI 文件名。

```
<Target Name="BeforeBuild">
  <CallTarget Targets="UpdateAssemblyInfo" />
</Target>

<Target Name="UpdateAssemblyInfo" Condition="'$(CIBuildNumber)' != ''">
  <UpdateVersion Attribute="AssemblyFileVersion"
    AssemblyInfo=".\Properties\AssemblyInfo.cs" 
    BuildNumber="$(CIBuildNumber)" />
</Target> 
```

如果您进行一些谷歌搜索，您应该找到其他示例...对不起，我不能给您 UpdateVersion 代码，我需要我的工作许可，但如果您在网上找不到任何合适的东西，自定义任务很容易写，上面应该有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-06T08:47:47.733

使用类似下面的内容来更改任何文件的任何内容。在这里，我每次创建构建时都会更改 hallo.aspx 中的构建日期值。

* * *

例如 Hallo.aspx 内容

<BuildDate> 12-23.2011 </BuildDate>

* * *

```
<!-- regular expression to get value between html node: "[^<>]+(?=[<])" --> 
  <FileUpdate Files="$(AboutDir)Hallo.aspx" 
    Regex="Builddate[^&lt;&gt;]+(?=[&lt;])" ignoreCase="true" 
    ReplacementText="BuildDate: $(Day)-$(Month)-$(Year)" /> 
```

# visual-studio-2008 - Visual Studio 2008 XML 编辑器消失了？

> ID：541548
> 
> 赞同：2
> 
> 时间：2009-02-12T14:41:00.093
> 
> 标签：visual-studio-2008

我的 Visual Studio xml 编辑器不见了。因此，当我打开例如 web.config 文件时，它会像纯文本文件一样显示。如果我右键单击-> 打开方式：XML 编辑器选项它不再存在。以前有人遇到过这个问题吗？？？我已经尝试修复安装和卸载/安装，但它没有修复它。谢谢您的帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T15:04:05.640

我可以看到在安装/重新安装后幸存的唯一问题是抑制包加载失败。尝试从命令 shell 运行以下命令。我假设 Visual Studio 安装在“C:\Program Files\Microsoft Visual Studio 9.0”位置

```
"c:\program files\microsoft Visual Studio 9.0\common7\ide\devenv.cmd" /ResetSkipPkgs 
```

这将重置所有跳过的包抑制。

如果这有效，那么在启动 VS 或加载文件时的某个时间点，您会看到一个神秘的对话框，上面写着“Some XML Package failed to load ...”并且有一个是/否选项。选择 yes 将阻止 VS 将来加载该包，从而阻止加载 XML 编辑器。

我相信这个值存储在用户注册表配置单元中。所以它有可能在卸载后仍然存在。如果这可行，请让我知道，因为我想提交一个错误。

**编辑**我能够与此 /ResetSkipPkgs 功能的所有者确认此问题将在 Visual Studio 的下一版本（VS2008 之后）中修复。

# ms-access - ShellExecute() returns error code 5 when trying to open mdb file >10MB

> ID：541559
> 
> 赞同：1
> 
> 时间：2009-02-12T14:43:41.257
> 
> 标签：ms-access

I have an MsAccess 2003 application which is a dashboard to launching other MsAccess apps.

I employ the API ShellExecute to launch/open the MsAccess app as below:

```
lngReturn = ShellExecute(Application.hWndAccessApp, _
                            "Open", _
                            AccessMDBName, _
                            "", _
                            "C:\", _
                            SW_SHOWNORMAL) 
```

When this code is deployed to a user's machine which only has MsAccess 2003 runtime installed, an error code =5 is returned when opening an MDB file >10MB I do not get any error for smaller MDB files.

Any idea what could be acting up?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T14:57:58.680

对我来说，10MB 的文件大小似乎不太可能（但没有什么是不可能的）。文件在同一个地方吗？Errorcode=5 表示访问被拒绝。作为启动 Access 的一部分，必须创建或更新 ldb 文件。您的文件是否可能位于不同的位置，并且此人对包含 >10MB 文件的文件夹没有写入权限？C:\ 是 mdb 文件的位置吗？一些公司制定了限制对 C: 驱动器根目录的写访问的策略。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-01-22T03:55:52.800

尝试在默认浏览器中打开网页时，我遇到了同样的问题，并且它（浏览器）由于某种原因而损坏。您可以尝试在资源管理器中单击文件或在命令行中键入文件名，以确保系统自行正确打开文件。因此，如果系统无法打开文件，这可能是原因，那么您可以检查应该打开文件的应用程序。祝你好运。希望这有助于找到问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T16:34:57.900

C:\ 的根目录可能对用户不可写。

您可以做的是删除 c:\ 它将使用当前工作目录。阿拉：

```
lngReturn = ShellExecute(Application.hWndAccessApp, _
                            "Open", _
                            AccessMDBName, _
                            "", _
                            "", _
                            SW_SHOWNORMAL) 
```

对于较小的文件（并且 10MB 不再那么大），MS Access 可能无需向工作目录写入任何内容即可逃脱。

# c++ - 使用具有不同参数的 Boost Tokenizer escaped_list_separator

> ID：541561
> 
> 赞同：4
> 
> 时间：2009-02-12T14:44:53.517
> 
> 标签：c++, string, boost, tokenize

您好，我一直在尝试使用 boost 库标记器类使标记器工作。我在 boost 文档中找到了本教程：

[http://www.boost.org/doc/libs/1 _36 _0/libs/tokenizer/escaped _list _separator.htm](http://www.boost.org/doc/libs/1_36_0/libs/tokenizer/escaped_list_separator.htm)

问题是我无法将参数转义为 _list _separator("","","");

但是如果我修改 boost/tokenizer.hpp 文件，它就可以了。但这不是，理想的解决方案是想知道我是否缺少任何东西来将不同的参数放入转义的_list _separator。

我想用 " 和 ' 将其拆分为空格以进行转义，并且在引用的字符串中没有转义字符。

这用于游戏控制台系统中的参数解析系统。

```
 include <iostream>
include <boost/tokenizer.hpp>
include <string>

int main()
{
    using namespace std;
    using namespace boost;
    string s = "exec script1 \"script argument number one\"";
    string separator1("");//dont let quoted arguments escape themselves
    string separator2(" ");//split on spaces
    string separator3("\"\'");//let it have quoted arguments
    tokenizer<escaped_list_separator<char>(separator1,separator2,separator3)> tok(s);
    for(tokenizer<escaped_list_separator<char>(separator1,separator2,separator3)>::iterator beg=tok.begin(); beg!=tok.end();++beg)
    {
    cout << *beg << "\n";
    }
} 
```

Visual Studio 2005 的错误是错误 C2974：'boost::tokenizer'：'TokenizerFunc' 的模板参数无效，输入预期

编辑：这个问题是由 ferrucio 提出的，并由彼得谢谢大家解释。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-12T15:42:16.157

试试这个：

```
#include <iostream>
#include <boost/tokenizer.hpp>
#include <string>

int main()
{
    using namespace std;
    using namespace boost;
    string s = "exec script1 \"script argument number one\"";
    string separator1("");//dont let quoted arguments escape themselves
    string separator2(" ");//split on spaces
    string separator3("\"\'");//let it have quoted arguments

    escaped_list_separator<char> els(separator1,separator2,separator3);
    tokenizer<escaped_list_separator<char>> tok(s, els);

    for(tokenizer<escaped_list_separator<char>>::iterator beg=tok.begin(); beg!=tok.end();++beg)
    {
        cout << *beg << "\n";
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-12T15:33:27.737

您似乎错误地声明了您的标记器类型。

```
typedef boost::tokenizer< boost::escaped_list_separator<char> > Tokenizer;
boost::escaped_list_separator<char> Separator( '\\', ' ', '\"' );
Tokenizer tok( s, Separator );

for( Tokenizer::iterator iter = tok.begin(); iter != tok.end(); ++iter )
{ cout << *iter << "\n"; } 
```

您想创建一个`boost::tokenizer< boost::escaped_list_separator< char > >`带有`boost::escaped_list_separator< char >`分隔符对象的类型化对象作为其 TokenizerFunc。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-01-24T13:37:12.923

一个相关但不是答案的问题是，如果用户想在结果中输出双引号，则维基百科中描述的嵌入引号（“”）（[如此处](https://en.wikipedia.org/wiki/Comma-separated_values)）应替换为字符串 of `(\\\")`，其中`\\`表示转义char 和`\"`表示引号。这样，引号将显示在输出结果中。以下代码片段是一个示例。

```
typedef boost::escaped_list_separator<char> std_token;
typedef boost::tokenizer<boost::escaped_list_separator<char>> tokenizer;

std_token a_token( "\\", ",", "\"" );
std::string s = "\"Boost,\\\" C++ Libraries\" ";
tokenizer tok{ s, a_token };
for ( const auto &t : tok )
    std::cout << t << '\n'; 
```

[这是一个典型的输出](https://i.stack.imgur.com/2v9WZ.png)

# c# - 用 Linq 分组数据还是不可能的？

> ID：541571
> 
> 赞同：0
> 
> 时间：2009-02-12T14:47:31.060
> 
> 标签：c#, .net, linq, .net-3.5

我有一个具体对象的列表。有些需要分析以决定保留哪一个（当组包含超过 1 个事件时）。

**这是一个简化的示例：**

```
 List<MyObject> arrayObject = new List<MyObject>();
 arrayObject.Add(new MyObject { Id = 1, Name = "Test1", Category = "Cat1"});
 arrayObject.Add(new MyObject { Id = 2, Name = "Test2", Category = "Cat2" });
 arrayObject.Add(new MyObject { Id = 2, Name = "Test2", Category = "Cat3" }); 
```

这将只需要在分析结束时：

```
 arrayObject.Add(new MyObject { Id = 1, Name = "Test1", Category = "Cat1"});
 arrayObject.Add(new MyObject { Id = 2, Name = "Test2", Category = "Cat3" }); 
```

如您所见，带有 Cat2 的 Id2 消失了，因为业务逻辑将其取消了。所以应该做的是能够得到超过1个类别的人，并对其应用逻辑。

**这是我到目前为止所拥有的：**

```
 List<MyObject> arrayObject = new List<MyObject>();
        arrayObject.Add(new MyObject { Id = 1, Name = "Test1", Category = "Cat1"});
        arrayObject.Add(new MyObject { Id = 2, Name = "Test2", Category = "Cat2" });
        arrayObject.Add(new MyObject { Id = 2, Name = "Test2", Category = "Cat3" });

        var filtered = from arrayObject1 in arrayObject
                        group arrayObject by new { arrayObject1.Id, arrayObject1.Name }
                        into g
                        select new { KKey = g.Key, Obj = g };

        foreach(var c in filtered)
        {
            Console.WriteLine(c.KKey + ":" + c.Obj.Count());
            foreach (var cc in c.Obj)
            {
                //Put some Business Logic here to get only 1... but to simplify will just print
                Console.WriteLine("--->" + cc);
            }
        } 
```

**问题是**1) cc 不是 MyObject 类型，其次，我必须通过 new 获取组中的所有属性......我可能有几个不同的对象。

Linq可以吗？因为，我可以在不使用 Linq 的情况下做到这一点......但我正在尝试尽可能多地应用这个框架（3.5）的新东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T14:58:06.650

问题在于：

```
group arrayObject by 
```

它应该说：

```
group arrayObject1 by 
```

# php - how to unrar files using php on windows

> ID：541573
> 
> 赞同：1
> 
> 时间：2009-02-12T14:47:54.303
> 
> 标签：php, windows

how to unrar files using php on windows? Is there any script or codes to make it possible?

Thanks

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-12T14:50:47.013

Check this link out:

[http://us2.php.net/manual/en/book.rar.php](http://us2.php.net/manual/en/book.rar.php)

Using that extension, you can do something like this:

```
$rar_file = rar_open('example.rar') or die("Can't open Rar archive");

$entries = rar_list($rar_file);

foreach ($entries as $entry) {
    echo 'Filename: ' . $entry->getName() . "\n";
    echo 'Packed size: ' . $entry->getPackedSize() . "\n";
    echo 'Unpacked size: ' . $entry->getUnpackedSize() . "\n";

    $entry->extract('/dir/extract/to/');
}

rar_close($rar_file); 
```

# c# - C#：我想将诸如文件路径之类的消息传递给我的表单应用程序（如控制台应用程序），我该怎么做？

> ID：541577
> 
> 赞同：7
> 
> 时间：2009-02-12T14:49:58.513
> 
> 标签：c#, winforms, command-line, arguments

C#：我想将诸如文件路径之类的消息传递给我的表单应用程序（如控制台应用程序），我该怎么做？

有人告诉我，我需要找到添加 string[] args 的主要方法，但我不知道 Windows 窗体中的哪个方法。我的主要方法是 C# Windows 窗体应用程序中的哪个？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-12T14:55:00.170

好的， string[] args = Environment.GetCommandLineArgs() 是一个更好的选择。但我将保留以下答案作为替代。

查找名为 Program.cs 的文件，其中包含以下代码片段...

```
static class Program
{
    /// <summary>
    /// The main entry point for the application.
    /// </summary>
    [STAThread]
    static void Main()
    {
        Application.EnableVisualStyles();
        Application.SetCompatibleTextRenderingDefault(false);
        Application.Run(new Form1());
    }
} 
```

并将其更改为

```
static class Program
{

    public static string[] CommandLineArgs { get; private set;}

    /// <summary>
    /// The main entry point for the application.
    /// </summary>
    [STAThread]
    static void Main(string[] args)
    {
        CommandLineArgs = args;
        Application.EnableVisualStyles();
        Application.SetCompatibleTextRenderingDefault(false);
        Application.Run(new Form1());
    }
} 
```

然后从您的表单访问命令行参数...

```
Program.CommandLineArgs 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T14:56:21.600

您的`Main()`方法位于`Program.cs`文件中，通常如下所示：

```
[STAThread]
static void Main()
{
  Application.EnableVisualStyles();
  Application.SetCompatibleTextRenderingDefault(false);
  Application.Run(new Form1());
} 
```

您应该将其修改`Main()`为以下内容：

```
static void Main(string[] args) 
```

您将可以访问传递的参数。

此外，您可以使用访问参数`Environment.GetCommandLineArgs()`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T14:52:30.970

如果要访问命令行参数，请使用 Environment.CommandLine

```
string args = Environment.CommandLine; 
```

无论您的代码中是否有带有 string[] args 的 main 方法，您都可以执行此操作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-12T14:52:46.243

有一个`Main()`，在里面`Program.cs`。但在 WinForms 应用程序`Environment.GetCommandLineArgs()`中将是一个更好的选择。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-12T14:52:48.507

在您的公共构造函数中，使用以下内容：

字符串[] args = Environment.GetCommandLineArgs();

这将为您提供参数的字符串数组。

# c++ - How can I handle the Return key in a CEdit control?

> ID：541579
> 
> 赞同：12
> 
> 时间：2009-02-12T14:50:17.607
> 
> 标签：c++, windows, mfc, cedit

How can I handle the `Return` key (`VK_RETURN`) in a `CEdit` control? The `CEdit` control is parented to a `CDialog`.

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-12T21:08:55.263

您还可以过滤对话框的 PreTranslateMessage 中的键。如果你得到`WM_KEYDOWN`，`VK_RETURN`打电话`GetFocus`。如果焦点在您的编辑控件上，请调用您在编辑控件中按下返回的处理。

请注意 if 中的子句顺序依赖于短路是有效的。

```
BOOL CMyDialog::PreTranslateMessage(MSG* pMsg)
{
    if (pMsg->message == WM_KEYDOWN &&
        pMsg->wParam == VK_RETURN &&
        GetFocus() == m_EditControl)
    {
        // handle return pressed in edit control
        return TRUE; // this doesn't need processing anymore
    }
    return FALSE; // all other cases still need default processing
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-05-17T09:19:16.133

正确的答案是处理[WM_GETDLGCODE](http://msdn.microsoft.com/en-us/library/ms645425.aspx) / [OnGetDlgCode](http://msdn.microsoft.com/en-us/library/t83978eh.aspx)消息。在那里，您可以指定您希望所有键都由您的班级处理。

```
UINT CMyEdit::OnGetDlgCode()
{
    return CEdit::OnGetDlgCode() | DLGC_WANTALLKEYS;
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T14:58:07.430

确保在控件的对话框资源中设置了编辑控件样式 ES_WANTRETURN

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-03-21T19:12:00.970

默认情况下，该`Return`键关闭 MFC 对话框。这是因为`Return`key 导致`CDialog`'`OnOK()`函数被调用。您可以覆盖该函数以拦截`Return`密钥。我从[这篇文章中](https://support.microsoft.com/en-us/help/102589/how-to-use-the-enter-key-from-edit-controls-in-a-dialog-box)得到了基本的想法（见最后的*方法3*）。

首先，确保您已使用[Class Wizard](https://msdn.microsoft.com/en-us/library/ee748520.aspx)将编辑控件的成员添加到对话框中，例如：

```
CEdit m_editFind; 
```

接下来，您可以将以下函数原型添加到对话框的头文件中：

```
protected:
    virtual void OnOK(); 
```

然后您可以将以下实现添加到对话框的*cpp文件中：*

```
void CMyDialog::OnOK()
{
    if(GetFocus() == &m_editFind)
    {
        // TODO: Add your handling of the Return key here.
        TRACE0("Return key in edit control pressed\n");

        // Call `return` to leave the dialog open.
        return;
    }

    // Default behavior: Close the dialog.
    CDialog::OnOK();
} 
```

请注意：如果您的对话框中有一个带有 ID 的*OK*按钮`IDOK`，那么它也会调用`OnOK()`。如果这对您造成任何问题，那么您必须将按钮重定向到另一个处理函数。如何做到这一点在我上面提到[的文章的](https://support.microsoft.com/en-us/help/102589/how-to-use-the-enter-key-from-edit-controls-in-a-dialog-box)*方法3*中也有描述。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2020-04-27T19:11:36.130

I encounter this problem myself. After a little experiment, a simple way existed if you just want to get the do something (after some editing etc) on the return (not specific for which editor you have focus) - I would just create a invisible default button, and let that button handle the 'return' key instead of default Ok button (of course, Ok button should be set default key to false)

# actionscript-3 - 焦点问题，焦点有时会转到未知对象

> ID：541580
> 
> 赞同：1
> 
> 时间：2009-02-12T14:50:34.737
> 
> 标签：actionscript-3, flex3

> [FocusEvent type="focusIn" bubbles=true cancelable=false eventPhase=3 relatedObject=null shiftKey=false keyCode=0]

当我用鼠标单击 TextField 时，我希望另一个（可编辑）字段获得焦点，但当前焦点在某处丢失..我不知道焦点在哪里。

我为 textfield 创建了一个侦听器，它试图将焦点设置回另一个带有 stage.focus = editfield 的文件，但它不起作用。

我在舞台上也有相同的焦点听众，但没有区别。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T16:24:27.443

由于您在示例中列出了“FocusEvent”，因此我将重点介绍 Flex 解决方案。那不是 Flash AS3 类。

我敢打赌，Flex 正试图自己管理焦点，而这与你设置它的尝试搞砸了。然而，有很多方法可以解决这个问题。

**Flex 是否试图对您不利？**
首先，您可能希望使用 FocusManager 类或 UIComponent setFocus 方法（这取决于您具体需要做什么，我相信 FocusManager 允许您有多个目标对象，而 setFocus 方法要简单得多）而不是舞台焦点。这具有在 Flex 组件系统中本地工作的好处。

**你在听正确的事件吗？**
如果做不到这一点，请尝试确保您正在寻找的 FocusEvent 的目标既不是您的文本字段也不是您的文本字段的子项。（只是为了理智）。如果这不起作用，请确保您只分派了一次事件。接下来，我将尝试使用 MouseEvent.CLICK 而不是 FocusEvent。

**其他一切都失败了吗？**
不幸的是，Flex 通常远非完美。我发现有时我必须使用 setTimeout 来解决它不会以“正确的顺序”触发事件的事实——你调整了某些东西的大小，但是在重新渲染之前调度了“RESIZE”，你改变了字体，并且 TextArea 的 TextWidth 属性不返回正确的数字。解决方法

```
private function myListener( event:FocusEvent ):null
{
    setTimeout( function(){ editfield.setFocus(); }, 35 );
} 
```

# tsql - SQL 2005 T-SQL 编程 - 需要注意的可能陷阱

> ID：541588
> 
> 赞同：1
> 
> 时间：2009-02-12T14:52:10.847
> 
> 标签：tsql

您可能知道[万圣节问题](http://media.techtarget.com/digitalguide/images/Misc/halloween_problem_script.txt)，如果使用不当，SQL 游标可能会成为您的噩梦。

如果不仔细使用 SQL 2005 功能，可能会引入哪些其他细微问题（难以调试和检测）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T14:59:36.617

首先，除非绝对没有其他方法，否则不应使用游标。几乎所有事情都可以根据设置完成。数字表将对此有所帮助。检查 XACT_STATE 以确定交易。还有很多事情需要注意

在此处阅读有关[SQL Server 编程陷阱的一些信息](http://wiki.lessthandot.com/index.php/SQL_Server_Programming_Hacks_-_100%2B_List#Pitfalls)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T15:06:39.907

试图将 SQL 视为编程环境可能是最大的错误。SQL 就是声明你想要什么。如果您曾经使用过游标或循环结构，请问问自己是否有办法将其转换为 INSERT/UPDATE

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T16:11:38.067

1.  在可以具有 NULLS 的列上执行 NOT IN 不会产生结果。
2.  对可以包含空值的列执行 count(cloumn) 只会为您提供非空值的计数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T21:52:55.063

有几个问题浮现在脑海：

*   NULL 处理 - 很多人很难理解 NULL 是与“0”（零）非常不同的野兽，并且您通常无法比较 IF myCol = NULL - 您需要使用“IS NULL”或“IS NOT NULL”等等。

NULL 有它的位置——当它真的意味着没有选择或值时——但在许多情况下，你最好定义一个默认值（在 INT 列上通常为“0”），它表示“无”或“没有选择”等。

*   索引 - 关于索引的很多混淆以及优缺点，优点和缺点是什么。为每一列建立索引是没有意义的——即使你已经确定了在 SELECT ... WHERE 子句中经常使用的列，如果列的选择性不够小（一些专家说，如果列不会选择 1% 或更少的数据，不要打扰索引），通常它不会真正有帮助，因为全表扫描（索引扫描）会更便宜。

而且，使用索引 - 如果您在 WHERE 子句中使用 T-SQL 函数，例如“UPPER(myCol) = (value)”或“LEFT(myCol, 10) = (value)”，那么您将看不到预期的也可以从索引中受益。

索引可以极大地提高您的性能 - 但要明智地索引！

# .net - 如何获取正则表达式以匹配带有空格的项目

> ID：541590
> 
> 赞同：1
> 
> 时间：2009-02-12T14:52:22.157
> 
> 标签：.net, asp.net, vb.net, regex

如果没有空格字符，则以下正则表达式有效，但如果输入有空格字符，则它不起作用（看起来像一个链接，但 JavaScript 不起作用）。

我怎样才能改变它？

正则表达式应该适用于`World`和`The World`。

```
 Dim makebkz As String
    Dim pattern As String = "\(bkz: ([a-z0-9$&.öışçğü\s]+)\)"
    Dim regex As New Regex(pattern, RegexOptions.IgnoreCase)
    Dim myAnchor As New System.Web.UI.HtmlControls.HtmlAnchor()
    Dim postbackRef As String = Page.GetPostBackEventReference(myAnchor, "$1")
    myAnchor.HRef = postbackRef

    str = regex.Replace(str, "(bkz: <a href=javascript:" & myAnchor.HRef & "><font color=""#CC0000"">$1</font></a> )")
    makebkz = str
    Return makebkz 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T14:57:15.810

实际上，有一个空格“字符”。它是一个 '\s' （减去引号）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T15:24:31.410

我认为这条线应该改变：

```
str = regex.Replace(str, "(bkz: <a href=javascript:" & myAnchor.HRef & "><font color=""#CC0000"">$1</font></a> )") 
```

如果我正确阅读了您的代码，您将在 HRef 中包含 $1 （这就是 Page.GetPostBackEventReference(myAnchor, "$1") 正在做的事情），然后在字体标签和 href 之间的文本中替换它，所以您的输出将类似于：

```
(bkz: <a href=javascript:__doPostBack(The World)><font color=""#CC0000"">The World</font></a> ) 
```

如果您将替换功能更新为此，它应该可以工作：

```
str = regex.Replace(str, "(bkz: <a href=""javascript:" & myAnchor.HRef & """><font color=""#CC0000"">$1</font></a> )") 
```

即用引号括起javascript 调用，你的世界会很好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T14:57:16.950

**\s**将匹配任何空白字符。一定要正确地逃避这个。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T15:17:18.150

为了清楚起见，你是说类似的东西`(bkz: world)`有效，但`(bkz: the world)`没有？

您当前拥有的正则表达式将匹配两者（在 RegexBuddy 中验证），并且您的捕获组应该没问题（它应该`world`在第一种情况和`the world`第二种情况下捕获）。

如果事情不正常，`str`在您致电后存储了什么？`Replace`我的猜测是您生成的字符串是问题所在，而不是正则表达式本身。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T14:59:09.707

尝试使空格字符成为条件 \s* 意味着 bkz: 块之间可以有 0 个或多个空格。你也可以使用 \s? 如果有 0 或 1 个空格。

```
Dim pattern As String = "\(bkz:\s*([a-z0-9$&.öışçğü\s]+)\)" 
```

尽管由于您的第二个模式包含对空格的匹配，您可能必须扩展您的表达式以声明括号匹配中的第一个字符不是空格，这里是一个示例。

```
Dim pattern As String = "\(bkz:\s*([a-z0-9$&.öışçğü][a-z0-9$&.öışçğü\s]+)\)" 
```

# configuration - Bugzilla：设置权限以使所有用户的产品只读

> ID：541597
> 
> 赞同：2
> 
> 时间：2009-02-12T14:53:29.597
> 
> 标签：configuration, permissions, bug-tracking, bugzilla

我在多个项目中使用单个 Bugzilla 实例进行问题跟踪。我的一些项目仅限于一组人可见，而其他项目必须仅供所有人使用（即使他们在 bugzilla 中没有用户帐户）。只有经过身份验证的用户才能提交错误。编辑错误也仅限于一小群人和错误报告者本人。

如果我想让一个项目对所有用户只读（不登录），有人知道我必须如何在 bugzilla 中设置权限吗？目前，您只有登录后才能查看错误。

**更新** 正如 sereda 所描述的，“requirelogin”被“关闭”。我也有一个对应于每个产品的组。

对于我设置的每个产品的组访问权限： *ProductXY：强制/强制，条目*

用户通过组属性中的正则表达式（所有用户的“.*”）添加到组中。

但是，当我尝试以匿名用户 bugzilla 的身份打开错误时，“您无权访问错误 #8。要查看此错误，您必须先登录到具有适当权限的帐户。”

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T15:54:52.787

您可以通过在管理 | 中将“requirelogin”设置为关闭，使所有项目默认匿名可读。参数 | 用户认证。然后您需要检查那些您不想公开可见的产品是否具有正确的组安全性（我认为这应该是与每个产品对应的组的强制/强制设置）。

**更新**

我相信对于匿名用户可见的错误，它一定不属于任何组。由于您的所有产品都有“强制”设置，所有产品错误都属于相应的产品组，因此匿名者永远看不到。

我建议将公共产品的组控制更改为“Shown/NA”，然后批量更新所有错误并从所有组中删除它们。

# continuous-integration - CruiseControl.NET：显示生成的文件作为构建历史的一部分

> ID：541604
> 
> 赞同：2
> 
> 时间：2009-02-12T14:54:59.373
> 
> 标签：continuous-integration, cruisecontrol.net

我在 CC.NET 上运行了一个生成 HTML 测试报告的 rake 任务。我希望这些测试报告针对每个构建进行存储，并且在查看构建的详细信息时可以从 CC.NET 网站访问。

有没有办法做到这一点，或者你知道另一个可以做到这一点的持续集成服务器吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-20T18:03:53.650

我得到的最好的方法是将它们移动到一个目录中，然后将该目录设置为可以由项目的外部链接指向的虚拟目录。启用目录浏览，您可以单击上次构建的文件夹等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T18:04:43.957

CruiseControl 的 Java 版本有一个针对此类事情的[工件发布者。](http://cruisecontrol.sourceforge.net/main/configxml.html#artifactspublisher)我很确定 CC.NET 也有类似的发布者。

# symbian - 如何开始使用 Symbian（S60 平台）

> ID：541613
> 
> 赞同：15
> 
> 时间：2009-02-12T14:56:41.803
> 
> 标签：symbian, mobile-phones, nokia, s60, handheld

因此，在我的新工作中，我们使用的平台之一是 S60（诺基亚手机，Symbian OS），我对此感到好奇，并且不时感到需要帮助团队（我实际上是在服务器上工作）这个软件的一面）。

那么任何好的指针/建议/教程和共享经验可能会让我朝着正确的方向前进吗？

谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-13T14:55:55.290

这些天来，我认为*开始*本地（即 C++）Symbian 软件开发几乎是不可能的。诺基亚、索尼和摩托罗拉不再支持他们的旧 Symbian 手机。大多数官方网址都已损坏。仅仅获得签名和部署应用程序所需的证书将是一个挑战。

但是，您仍然应该能够使用 JavaME 开发将在剩余的 Symbian 安装基础上运行的软件，无论其当前大小如何。

无耻插件：[http](http://www.quickrecipesonsymbianos.com) ://www.quickrecipesonsymbianos.com是专门为进入 Symbian OS C++ 生态系统的开发人员编写的最后一本最佳书籍。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-12T21:30:28.457

我已经有几年没有为那个平台编码了。但是 SDK 可在[http://www.newlc.com/Nokia-Series-60-SDK.html获得](http://www.newlc.com/Nokia-Series-60-SDK.html)

[在http://wiki.forum.nokia.com/index.php/KnowledgeBase](http://wiki.forum.nokia.com/index.php/KnowledgeBase)有一个诺基亚论坛和知识库 ，代码片段在[http://wiki.forum.nokia.com/index.php/Portal:KB_Code_Snippets](http://wiki.forum.nokia.com/index.php/Portal:KB_Code_Snippets)

根据开发平台，还有其他 SDK 套件和说明

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-21T04:40:31.870

我强烈建议远离 Symbian。一旦您开始需要多个屏幕，这绝对是一场噩梦。

我的团队目前正在将旧版 Symbian 应用程序转换为 OpenC for S60 上较新的 Qt。这是一个绝对的梦想。本机外观，但具有“真正的”c++。你知道，诸如保证建设之类的事情……等等……

[http://www.qtsoftware.com/developer/technical-preview-qt-for-s60](http://www.qtsoftware.com/developer/technical-preview-qt-for-s60)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T12:55:41.260

如果您正在使用诺基亚手机，我会推荐[诺基亚论坛](http://www.forum.nokia.com/) 他们有很多文档、示例、工具、论坛、wiki

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-26T11:23:05.153

[http://descriptors.blogspot.com/](http://descriptors.blogspot.com/)

Symbian OS 字符串类。（向下滚动页面以获取详细信息）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-12T21:46:46.577

[在http://developer.symbian.com/main/documentation/symbian_cpp/symbian_cpp/index.jsp#rclass](http://developer.symbian.com/main/documentation/symbian_cpp/symbian_cpp/index.jsp#rclass)查看与开发相关的论文。它们涵盖了 Symbian 特定开发的所有方面，包括一些对初学者特别困惑的方面，例如 ActiveScheduler/Active Object 模型和字符串描述符。

# c# - 从 Flex 与 USB 设备通话，反之亦然

> ID：541616
> 
> 赞同：1
> 
> 时间：2009-02-12T14:57:10.117
> 
> 标签：c#, .net, apache-flex, sockets, usb

我的同事面临着在 Flex 中获取用户输入并使用该数据在 USB 设备上执行命令的挑战。我们认为我们需要在机器上运行一个套接字服务器才能做到这一点。我们想发送带有字节数组等的对象，而不仅仅是字符串。

有什么可以帮助我们的吗？我们是否需要编写自己的套接字服务器，恐怕这可能需要一些时间，或者我们可以使用任何现有的远程网关，如 WebORB 或 FluorineFX，并以某种方式使用它来进行通信和序列化，也许通过将它们托管为视窗服务？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T15:51:17.990

结帐 Merapi ( [http://www.merapiproject.net/](http://www.merapiproject.net/) ) Java 到 AIR 桥。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-14T20:49:21.173

这里有几个不同的选择：

1.  Merapi（用 Java 编写的本地套接字服务器）

2.  从头开始编写自己的套接字服务器

3.  编写一个 Java 小程序并使用 ExternalInterface 进行双向通信

我没有使用过#1，但听说过它的好消息。考虑到#1 已经可供您使用，#2 显然需要做很多工作。无论哪种方式，最终用户都需要安装套接字服务器，这可能很麻烦。

我已经完成了#3，它实际上在该应用程序中运行良好。它会在一定程度上限制您可以发送的数据类型。但是，如果小程序已签名/受信任，我认为您实际上可以让它像 Merapi 一样打开本地套接字服务器。

# .net - .NET 中的 SQL 注入

> ID：541620
> 
> 赞同：1
> 
> 时间：2009-02-12T14:57:48.260
> 
> 标签：.net, sql-injection

嗨，我想知道是否有人知道一些好的网站，详细介绍了 .NET Web 应用程序的 SQL 注入预防。任何资源将不胜感激，谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T15:00:53.447

我认为，如果您搜索一下“防止 .NET 中的 sql 注入”，您会发现很多很好的资源。:)

无论如何，一件非常重要的事情是不要使用字符串连接来构建查询。相反，使用参数化查询。ADO.NET 允许以非常简单的方式做到这一点：

```
string sql = "SELECT * FROM Persons WHERE Persons.Lastname LIKE @p_Name";

SqlCommand cmd = new SqlCommand (sql);

cmd.Parameters.Add ("@p_Name", SqlDbType.Varchar).Value = textBox1.Text + "%"; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T15:00:24.133

如果您使用 SqlCommand.Parameters 集合来传递参数并且从不将用户文本注入到您的 Sql 查询文本中，则没有风险。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T15:03:25.297

*   黄金法则：永远不要连接用户输入
*   如果您在 .NET 中编写自己的命令字符串，请使用参数集合
*   如果您使用 LINQ，它通常会为您完成
*   如果您在 TSQL 中编写命令，请[使用 sp_executesql](https://stackoverflow.com/questions/532468/ignoring-a-null-parameter-in-t-sql/532510#532510)或您的供应商的等价物

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T15:01:41.557

首先要知道的是参数化您的查询或使用存储过程......

永远不要在只附加值的代码中使用 ad-hoc sql

仅授予读写权限（或仅读取那些不应写入的页面）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T15:51:08.320

MSDN 杂志文章[Stop SQL Injection Attacks Before they Stop You](http://msdn.microsoft.com/en-us/magazine/cc163917.aspx)似乎相当完整。

[SDL Embraces The Web](http://msdn.microsoft.com/en-us/magazine/cc794277.aspx)虽然包含关于您的特定问题的不太详细的信息，但它是除了防止 SQL 注入攻击之外您应该考虑的*其他*事情的一个很好的来源。

通常的免责声明适用，我不一定同意这些文章中提供的所有信息，但所提供的信息有望让您思考如何在公共网站上缓解 SQL 注入（和其他）攻击。

# c - 在没有 memcpy 的情况下连接两个内存缓冲区

> ID：541634
> 
> 赞同：2
> 
> 时间：2009-02-12T14:59:40.923
> 
> 标签：c, memory-management

在 CI 中有一个函数 foo(char *) 接受一个内存指针。在调用者中，我有两个不同的内存缓冲区，我需要将它们连接起来，这样我就可以传递一个指针 foo()。有没有办法让我做到这一点，而无需实际将一个缓冲区复制到另一个缓冲区的末尾并且不更改 foo() 本身？即使两个缓冲区显示为 foo() 的一个虚拟连续缓冲区

出于性能原因，我需要这个。O(n) 解决方案（其中 n 是缓冲区长度之一）对于我的情况是不可接受的。此外，如果有帮助，Linux 特定的解决方案也可以。

谢谢。尼尔

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T15:12:04.607

是的，有办法。

为缓冲区分配内存，使它们在内存中相邻。

例子：

```
char* a = malloc(a_size + b_size);
char* b = a + a_size; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-13T06:43:45.553

这个问题似乎是在询问是否可以将两个缓冲区（A 和 B）的内容与以下约束连接起来：

*   您不能复制 A 或 B 的内容。
*   您不能更改 A 的地址。
*   该操作必须具有最坏情况复杂度 < O(n)。
*   大概 B 的地址是这样的，即 A 和 B 尚未连接。（正如 JF Sebastian 在他的回答中指出的那样，如果您首先可以连续分配 A 和 B，那么您就完成了。但这似乎是一个退化的情况。）
*   您必须能够从 Linux 内核驱动程序执行此操作（请参阅 Jerome 的回答下的评论）。
*   A 和 B 都不是页面对齐的（请参阅原始问题下的评论）。
*   A 和 B 都不是页面大小的倍数（请参阅原始问题下的评论）。

鉴于这一切，我的回答是否定的：这是不可能的。

是的，操作系统内核可以使用 CPU 的 MMU（内存管理单元，在具有 MMU 的架构上）在内核虚拟地址空间或用户虚拟地址空间中重新映射内存。分配一个连续的虚拟地址空间块，然后通过修改虚拟地址空间块的页表条目以指向 A 和 B 的物理地址，将 A 和 B 重新映射到该缓冲区。

这不会改变 A 本身的虚拟地址（因为旧的虚拟地址仍然有效），但它确实需要您通过不同的虚拟地址访问它。这可能是个问题。

这种重新映射在当今典型 CPU 架构上的粒度是基于页面大小的，并且由于 A 和 B 不是页面对齐的，也不是页面大小的倍数，因此您将无法使它们完全对齐. 这绝对是个问题。

重新映射 N 个字节需要每 M 个字节修改至少一个页表条目，其中 M 是页大小。这意味着重新映射操作无论如何都具有 O(n) 的计算复杂度。其他操作，例如为页表分配更多物理页、刷新缓存和 TLB 等，将产生额外的性能影响。

另外，我想知道这个问题的目标是否以某种方式涉及 DMA（直接内存访问）。当使用需要连续内存的旧设备执行 DMA 时，除非您有 IOMMU 可供使用，否则再多的重新映射都无济于事。一个可以执行分散-聚集 DMA 的现代设备一开始就不需要连续的缓冲区。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T15:02:52.473

为答案的简短道歉，但不，你不能。

正如您自己所说，您要么需要

*   分配一个大缓冲区，并将单独的缓冲区复制到此或
*   更改 foo，以获取多重指针。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T15:03:13.503

不，没有通用的解决方案。

您唯一的希望是，如果您要连接的两个内存区域已经在内存地址空间中彼此紧接。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T15:08:05.397

不，没有这样的解决方案，除非您了解内存分配器的工作原理，再加上纯粹的运气。

当您知道以后需要一个缓冲区时，为什么还要分配两个缓冲区？缓冲区有多大？为什么要避免抄袭？您是否测量过这将是一个瓶颈？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T15:11:24.763

您可以尝试添加另一层间接。它需要您重写 foo 以获取`char *`s 数组，并能够处理字符串之间的边界条件。

```
void foo(char **, int nstrings)
{ 
} 
```

然后连接字符串只是创建一个指针数组的问题：

```
char *strings[2] = { string1, string2 };
foo (strings, 2); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-12T15:08:46.890

是否可以修改`foo()`为采用某种描述要操作的内存位置列表的描述符（例如指向具有指针/长度对的结构数组的指针）？

这样就不需要 O(N) 复制操作。

如果可能的话，这似乎是唯一合理的解决方案。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-12-17T21:30:50.647

看看使用 realloc。一旦你得到第二个缓冲区，你可以调用 realloc 来增加第一个缓冲区的大小。我对 Mac OS 的体验是，这是高度优化的。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-02-12T15:47:30.510

以下是一个非常肮脏的解决方案，但在您的情况下可能是唯一的一个。而且它不会在所有情况下都有效（而且它是不可预测的）。

您可以尝试使用`mmap`. 当调用 mmap 时，你给它一个地址。mmap 将尝试在您给它的地址分配内存。

该解决方案可能是您可以拥有的最好的解决方案。您只需要复制一个`char[]`，两者都不需要。

您可能必须`\0`在第一个结束时删除角色。

并且可以使用`MAP_FIXED`标志：如果 mmap 不能使用地址，它不会分配任何内存空间并返回错误。

例如。

```
char a[20];
char b[20];

mmap(a + 20, 20, PROT_WRITE, MAP_FIXED, 0, 0); 
```

# c# - 如何在 C# 中找到我的机器的完全限定主机名？

> ID：541635
> 
> 赞同：32
> 
> 时间：2009-02-12T14:59:42.763
> 
> 标签：c#, environment-variables

例如：我想要 abc.hyd.mycompany.com 之类的东西。我的要求是解析这个名称并初始化适当的服务。

```
using System.Net;

Dns.GetHostName() // doesn't return fully qualified name it just gives "abc" 
```

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-02-12T15:18:17.587

您可以像这样获得整个 DNS 字符串：

```
System.Net.Dns.GetHostEntry("").HostName 
```

在我工作的地方，我们没有完整的 DNS 名称，但它确实给了我一个三级假域名，而不仅仅是主机名。

编辑 2011/03/17：合并以下标记建议的更改。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-03-17T20:15:42.187

我使用了这个非常相似的方法：

```
var serverName = System.Environment.MachineName; //host name sans domain
var fqhn = System.Net.Dns.GetHostEntry(serverName).HostName; //fully qualified hostname 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T15:25:32.547

如果上述方法不起作用，您还可以尝试从环境中检索它：

```
var dnsName = new StringBuilder();
dnsName.Append(Environment.GetEnvironmentVariable("COMPUTERNAME")).Append(".");
dnsName.Append(Environment.GetEnvironmentVariable("USERDNSDOMAIN")); 
```

# javascript - 将 Excel 粘贴到网页中

> ID：541636
> 
> 赞同：2
> 
> 时间：2009-02-12T15:00:00.343
> 
> 标签：javascript, excel, clipboard

我正在尝试编写一个从剪贴板获取 excel 信息的网页。我希望能够获取 XML 电子表格信息，而不仅仅是文本。

这可能吗？我想在大多数浏览器中这样做，如果不是全部的话。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T15:09:55.530

如果您直接从 Excel 复制并粘贴到 a 中`textarea`，它将是**纯文本的**，由制表符和换行符“\n”分隔。您可以将其解析为数组或其他格式以供您使用。

我怀疑您是否可以将其粘贴到任何其他类型的控件中，因此如果不将文件上传到服务器并通过 AJAX 获取它，您将无法获取 XML。

如果剪贴板包含 XML 的“文本化”版本，如果用户只是执行选择和复制，则默认情况下不会出现这种情况，它可能适用于`textarea`. 您可以在 Excel 中使用 VBA 来完成此技巧。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T19:35:55.267

“大多数浏览器，如果不是全部的话”将包括所有版本？哦亲爱的。

一个人可能永远不应该说永远，但我很怀疑这是可能的，我害怕。您仅限于浏览器和 Excel 协商时同意的格式作为剪贴板对话的两端，并且无法保证每个浏览器都将 XML 规定为选择的接收方式，尤其是当该格式为只有更高版本的 Excel 支持。跨应用程序复制和粘贴*很难*。

如果您必须有 XML，那么我的建议是您规定您的用户保存他们的工作簿，然后上传文件。接受测试替代方案可能更好，它应该在几乎任何可以处理`<textarea>`.

# command-line - 命令行差异实用程序

> ID：541645
> 
> 赞同：7
> 
> 时间：2009-02-12T15:01:35.690
> 
> 标签：command-line, diff

有人可以推荐一个好的（希望是免费的）命令行差异实用程序。我基本上需要从 .Net 启动它以生成某种文本文件，其中包含两个 xml 文件之间的差异。

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-12T15:06:35.960

您始终可以使用windows的[fc文件比较工具中的构建，但虽然不是免费的，但我会推荐](http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/fc.mspx?mfr=true)[Beyond Compare](http://www.scootersoftware.com)。除了是一个非常好的图形差异工具外，它还可以在命令行中使用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-12T15:05:20.330

查看[MSYS](http://www.mingw.org/wiki/msys)，它为您提供*diff*和 Windows 上所有常见的 GNU 实用程序。

正如其他人所说，您还可以通过安装[Cygwin在 Windows 上获得](http://www.cygwin.com/)*diff*和所有这些东西。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T15:15:16.937

GNU utilities for Win32:

[http://unxutils.sourceforge.net](http://unxutils.sourceforge.net)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-12T15:36:10.383

Plain text `diff` don't always manage `xml` nicely.

Here is an existing SO question that might help: [XML Diff and Merge](https://stackoverflow.com/questions/430001/xml-diff-and-merge)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-12T15:10:24.767

好吧，Windows 已经附带了一个：FC.EXE 它可能不是最好的，但可能足以满足您的需要。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-12T15:40:31.853

[WinMerge](http://winmerge.org/) always worked for me. On the other hand, if you want something lightweight extreme, [ExamDiff](http://www.prestosoft.com/) is only one exe file. Neither of them are command line, though.

For that I would recommend just plain diff, in combination with, for example, vim and some plugin, depending on your preferences. Diff comes with unxutils, which someone already gave the link for (see above).

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-12-07T19:11:44.320

我知道这是一个旧线程，但 Microsoft 的 XML Diff and Patch Tool 非常适合您描述的用途：

[http://msdn.microsoft.com/en-us/library/aa302294.aspx](http://msdn.microsoft.com/en-us/library/aa302294.aspx)

重要的区别在于它是一个 XML 比较实用程序，而不是一个文本比较实用程序。如果节点或属性的顺序不同，文本差异实用程序将报告大量误报。

如果您下载示例代码，您可以构建 XmlDiffView，它可用于生成关于 xml 文件之间差异的漂亮 HTML 报告。

我用它来区分大量 app.config 和 web.config 文件，发现它很方便。

# .net - 是一对一还是组件？休眠映射

> ID：541649
> 
> 赞同：2
> 
> 时间：2009-02-12T15:02:03.180
> 
> 标签：.net, asp.net, nhibernate, nhibernate-mapping

假设我有人员和地址类，它们在数据库中有不同的表。

一个人可以有一个地址类。这对我来说是重要的部分。一个人只能**有一个**地址作为子元素，我想将它们保存在数据库中的不同表中。

通常我知道我需要将它们放在同一张桌子上，但我的场景需要这个。

*（而且它看起来像一对多，但我不想只为一个对象收集一个）*

```
Person     Address
-------    -------
id         id
Name       PersonId
           StreetName 
```

和类代码

```
Person                                                 
--------
public virtual long Id{get;set;}
public virtual Address MyAddress {get;set;} 
```

如您所见，当我获得任何 Person 时，我想亲自获得 Address 属性？但它们在不同的表中。如何进行这种映射？

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T17:33:31.613

您不能使用组件映射地址，因为它有自己的表。如果您在一张表中包含所有字段，则可以使用它。从休眠参考：

> 组件元素将子对象的属性映射到父类表的列。

您应该使用一对一的关系来映射场景中的表和类。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T01:43:53.423

要在数据库中强制一对一，您还可以对 Address 表中的 PersonId 设置唯一约束。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T15:30:55.823

Are you sure it's a one to one relationship? I would assume it's a many-to-one relationship as usually more then one person can live at a certain address.

Anyways if it's a many-to-one relationship I'd map them like so. What I would do in your case is remove the PersonId FK from the Address table and put reference the Address Table from the Person table so you'd have something like this.

```
Person    Address
------    -------
id        id
Name      StreetName
AddressId

<many-to-one name="MyAddress" class="Address" column="AddressId"/> 
```

and if you do insist on a one-to-one relationship I would recommend merging the two tables together.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T17:02:28.273

我在 Person mapping 中使用了下面的代码来完成它。

```
<one-to-one lazy="proxy" name="MyAddress" class="Address" property-ref="PersonId" cascade="delete" /> 
```

希望能帮助别人

# c# - 从函数返回日 int 值

> ID：541650
> 
> 赞同：2
> 
> 时间：2009-02-12T15:02:42.570
> 
> 标签：c#, .net, datetime, date

我尝试编写有关天数的任何代码：

```
function xyz("13.02.2009")
{
    return value= 6;
}

function xyz("12.02.2009")
{
    return value= 5;
}

function xyz("14.02.2009")
{
    return value= 7;
} 
```

但是怎么做？

这种方法很好，但我需要 C# 时间特定代码（如时间跨度......）

```
DayOfWeek day = DateTime.ParseExact("13.02.2008", "dd.MM.yyyy", CultureInfo.InvariantCulture).DayOfWeek;
int days = ((int)day - (int)DateTime.Now.DayOfWeek);
if (days &#60;= 0) days += 7;
Console.Write(days); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T15:06:46.053

请注意，DateTime.DayOfWeek 取决于您的区域设置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T15:05:30.143

这`DateTime.DayOfWeek`是你需要的。还有一本不错的 C# 书。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T15:10:50.257

```
DateTime day = DateTime.ParseExact("13.02.2008", "dd.MM.yyyy",CultureInfo.InvariantCulture);
TimeSpan difference = day.Subtract(DateTime.Now);
int days = difference.Days; 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-12T15:05:22.297

```
return (int)(myDateTime.DayOfWeek); 
```

# mysql - 如何在不作为列返回的情况下在 select 语句中创建表达式？

> ID：541655
> 
> 赞同：3
> 
> 时间：2009-02-12T15:03:43.317
> 
> 标签：mysql

我有一些来自数据库的行，我想插入到另一个数据库中。由于有很多行，我想在 mysql 中使用 INSERT .. SELECT ... 构造。我尝试运行的语句如下：

```
set @rank := 1; set @currpoints := 0; set @currgroupcount := 0; 
  SELECT id, @rank := if( @currpoints = points, @rank , @rank + @currgroupcount )
  AS rank, 
  @currgroupcount := if( @currpoints = points, @currgroupcount +1, 1 ) , @currpoints := 
  points
FROM characters
ORDER BY points DESC , name
LIMIT 0 , 30 
```

问题是当结果超过两列时，我无法将选定的行插入数据库。有什么方法可以在不将表达式作为列返回的情况下进行这些所需的增量？如果不可能，您是否知道我可以做些什么作为替代方案，并且仍然能够获得使用 INSERT .. SELECT ... 构造所带来的性能提升？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T15:12:45.523

您可以使用以下方法隐藏增量：

```
SELECT IF(@currpoints := points, id, id) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T15:18:35.293

```
INSERT
INTO new_characters (id, name)
SELECT id, name
FROM (
  SELECT id,
  @rank := if( @currpoints = points, @rank , @rank + @currgroupcount ) AS rank, 
  @currgroupcount := if( @currpoints = points, @currgroupcount +1, 1 ),
  @currpoints := points
  FROM characters
  ORDER BY points DESC , name
  LIMIT 0 , 30
) m 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T15:19:57.037

您当然可以通过使用游标来实现您所需要的，但可能会影响性能。

# sql - 索引查询

> ID：541657
> 
> 赞同：1
> 
> 时间：2009-02-12T15:03:53.643
> 
> 标签：sql

我有一个查询需要很长时间并且经常超时。这是一个基于邻近的邮政编码搜索表值函数。无论如何都要根据查询进行索引，因此不必每次都重新计算所有这些值？邮政编码和邮政编码列表加起来超过一百万行。

这是表格功能。

```
Create  FUNCTION [dbo].[ZipsInRadius] (@zipCode varchar(15), 
    @radius int, @unit char(1))
RETURNS @areaResults TABLE(
    Zip    varchar    (30),
    City    varchar    (255),
    St    varchar (20),
    Lat    decimal    (16,12),
    Long    decimal (16,12))    
BEGIN

    DECLARE @iStartLat decimal(16, 12)
    DECLARE @iStartLong decimal(16, 12)
    SELECT
        @iStartLat = CAST(Latitude AS decimal(16, 12)), 
        @iStartLong = CAST(Longitude AS decimal(16, 12)) 
    FROM zip
    WHERE zipcode  LIKE @zipCode + '%'
    SELECT
        @iStartLat = CAST(Latitude AS decimal(16, 12)), 
        @iStartLong = CAST(Longitude AS decimal(16, 12)) 
    FROM postalcode
    WHERE postalcode  LIKE @zipCode + '%'
    DECLARE @latRange decimal(16, 12)
    DECLARE @longRange decimal(16, 12)

    IF (@unit = 'K')         --Get distance in kilometers
        BEGIN
            SELECT @LatRange = 
               (CAST(@radius / ((6076.0 / 5280.0) * 60.0) 
                AS decimal(16, 12))) * 0.621371
            SELECT @LongRange = 
               (@radius / (((cos(@iStartLat * pi() / 180.0) * 6076.0) 
                / 5280.0) * 60)) * 0.621371
        END
    ELSE                     --Get distance in miles (the default)
        BEGIN
            SELECT @LatRange = CAST(@radius / ((6076.0 / 5280.0) * 60.0) 
                AS decimal(16, 12))
            SELECT @LongRange = 
               @radius / (((cos(@iStartLat * pi() / 180.0) * 6076.0) 
                / 5280.0) * 60)
        END

    DECLARE @lowLatitude decimal(16, 12)
    DECLARE @highLatitude decimal(16, 12)
    DECLARE @lowLongitude decimal (16, 12)
    DECLARE @highLongitude decimal (16, 12)
    SELECT @lowLatitude = @iStartLat - @latRange
    SELECT @highLatitude = @iStartLat + @latRange
    SELECT @lowLongitude = @iStartLong - @longRange
    SELECT @highLongitude = @iStartLong + @longRange

    INSERT INTO @areaResults (zip, city, st, lat, long) 
      SELECT ZIPcode, CITY, STate, LATitude, LONGitude
      FROM Zip Z
      WHERE Z.Latitude <= @highLatitude
                  AND Z.Latitude >= @lowLatitude
            AND Z.Longitude >= @lowLongitude
                  AND Z.Longitude <= @highLongitude     
        INSERT INTO @areaResults (zip, city, st, lat, long)
      SELECT postalcode, CITY, province, LATitude, LONGitude
      FROM postalcode z
      WHERE Z.Latitude <= @highLatitude
                  AND Z.Latitude >= @lowLatitude
            AND Z.Longitude >= @lowLongitude
                  AND Z.Longitude <= @highLongitude
    RETURN
END 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T15:09:04.970

这需要我几毫秒，也许你的方法是错误的看看这里：[SQL Server Zipcode Latitude/Longitude邻近距离搜索](http://blogs.lessthandot.com/index.php/DataMgmt/DataDesign/sql-server-zipcode-latitude-longitude-pr) 2000/2005版本

或者对于 2008 版本，在此处使用地理数据类型：[SQL Server 2008 Proximity Search With The Geography Data Type](http://blogs.lessthandot.com/index.php/DataMgmt/DataDesign/sql-server-2008-proximity-search-with-th)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T15:30:57.197

我会推荐一个关于经度和纬度的多列索引。

最好使用边界框，这通常会加快查询速度。通过我提到的索引，您应该会看到巨大的改进。

附带说明一下，您的纬度/经度存储在十进制（16,12）中。12 位数的精度可能比您需要的多吨。第五个数字（以纬度/经度为单位）代表大约 3 英尺。所以.. 第 12 位数字实际上可能代表纳米（或更小）。通过使用较小的数据类型，您的表（和索引）将更加高效。对于邮政编码搜索尤其如此，因为您拥有的纬度/经度是代表邮政编码中心的一个点，该位置一开始就不是很精确。对于经度，我通常使用 Decimal(8,5)。由于纬度通常在 -90 到 90 的范围内，因此您可以使用 Decimal(7,5) 作为纬度。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T15:56:18.010

您可以尝试强制`INDEX JOIN`索引并查看是否有帮助：

```
CREATE INDEX ix_zip_lat ON zip(lat)

CREATE INDEX ix_zip_long ON zip(long)

SELECT * FROM zip
WITH  (INDEX(ix_zip_lat), INDEX (ix_zip_long))
WHERE lat BETWEEN @lowlat and @hilat
      AND long BETWEEN @lowlong and @hilong 
```

# html - 上传到服务器后出现问题

> ID：541660
> 
> 赞同：0
> 
> 时间：2009-02-12T15:04:24.797
> 
> 标签：html, css, file, hyperlink

这在 MAMP 中一切正常，但我已经上传，现在问题开始了。

这是链接代码的图像和结果的抓取

[第一张图片](http://dl.getdropbox.com/u/236383/link-to-file.tiff)

[第二张图片](http://dl.getdropbox.com/u/236383/result-of-link.tiff)

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T15:11:02.737

您似乎正在发布到静态 HTML 文件。尝试将文件扩展名更改为 php、asp、jsp 等，具体取决于您在服务器端使用的内容。

此外，对于这样的文本内容，您可以简单地复制粘贴文本而不是捕获屏幕截图。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T15:55:56.857

问题解决了，它在 .js 文件中，它指向 POST 并且应该是 GET

# c# - 改进 INSERT INTO - FROM SELECT、SQL 查询

> ID：541669
> 
> 赞同：6
> 
> 时间：2009-02-12T15:05:37.680
> 
> 标签：c#, sql, sql-server, insert

目前我得到了编程生成的这种类型的查询（c#）

```
INSERT INTO TableName (Field1, Field2, Field3)
SELECT Field1, Field2, Field3 FROM TableName2 
```

问题是 SELECT 可以有很多记录的结果（比如一百万），所以它需要很多次，结果是连接超时。

此外，如果我将所有插入分成单个插入（对于这个例子，一百万个插入查询），执行需要很长时间......但它工作......

有没有办法改进这种类型的查询？

我使用 MSSQl 2005

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-12T15:10:24.627

我发现，如果您有很多按顺序执行的 INSERT 语句，您可以通过在每个 xxxx 个插入语句后添加一个“GO”语句来提高性能：

```
...
INSERT INTO Table ( ... ) VALUES ( ... )
INSERT INTO Table ( ... ) VALUES ( ... )
INSERT INTO Table ( ... ) VALUES ( ... )
GO
INSERT INTO Table ( ... ) VALUES ( ... )
INSERT INTO Table ( ... ) VALUES ( ... )
... 
```

另一种可能性可能是确保您的 INSERT INTO .. SELECT FROM 查询不会一次插入所有内容，而是使用某种分页技术：

```
INSERT INTO Table ...
SELECT ...
FROM OtherTable WHERE Id > x and Id < y 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-12T15:08:54.737

好吧，如果它是完整的副本，我想知道您是否不应该研究批量加载工具？

*   批量插入 (TSQL)
*   SqlBulkCopy (.NET)
*   bcp（命令行）
*   ETC

如果你**有**一个`Where`子句，我会检查它是否被适当索引......

此外：

*   可能在执行 INSERT 之前删除索引和触发器（之后重新创建）
*   ~~考虑删除整个表并使用 SELECT INTO ？~~（看评论）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T19:07:25.833

好的，有一些基本问题。

1.  I\O - 如果表不在单独的磁盘上，则在从另一个表读取时插入到表中很可能会导致磁盘争用。将相对的桌子放在物理上不同的主轴上。

2.  事务日志 - 您需要确保您的事务日志在它自己的磁盘上，或者在较小的事务中工作（一次几千行）或使用未记录的 BCP\Bulk Insert。

3.  聚集索引 - 如果您将所有这些行插入到目标表中，并且它的聚集索引（将物理订单数据写入磁盘）没有按顺序写入，那么磁盘 IO 需求会因为页面拆分和重新写入而达到顶峰分配。一个简单的解决方法是在收件人表上创建一个聚集索引，该索引是一个顺序种子键。这通常会确保您在表中获得顺序写入，并且几乎总是在最后。

4.  文件扩展 - 确保您已设置 SQL 以适当的速度扩展文件，例如 10% 左右。否则它将不得不不断调整文件大小并将磁盘归零。还有一些方法可以防止它不得不将磁盘清零，例如在您的组策略中为 Sql Service 用户启用批量文件操作权限。

坦率地说，除了这个和其他一些建议之外，您不太可能在事务中真正快速地插入数百万行。如果您通过 Bulk Insert 执行此操作，它会快得多，尽管从应用程序的角度来看它可能不是您需要的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-12T15:09:15.470

将您正在使用的`CommandTimeout`属性设置为合理的值（10 分钟或其他时间）。`SqlCommand`请记住，`CommandTimeout`以秒为单位。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T16:31:42.450

这里有一些很好的答案。

就像补充一点，如果您在目标表上有索引，它们会减慢操作速度。但是，如果您使用 drop create 技术，重建索引有时可能需要很长时间。

`ORDER BY`如果您不想删除索引，请使用与*目标*`SELECT`聚集索引匹配的索引，这似乎有帮助（可能有助于最大限度地减少页面拆分）。

 ** * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-12T15:11:31.457

你没有指出你用这种方法解决了什么问题。显然，一个 WHERE 会缩小记录集。但是如果结果集不会在新表中被修改，那么为什么要复制数据呢？为什么不直接从Source查询？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-12T15:11:52.233

要么通过使用文件进行批量加载，然后使用 bcp/BULK INSERT 进行批量加载，要么以 5K 左右的批量进行批量加载

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-12T15:13:39.140

首先，永远不要尝试通过 C# 插入一百万条记录。永远不要一次处理一大组记录。这是应该由数据库在数据库中完成的工作。使用批量插入或 SSIS 或 DTS 来执行此操作。然后将其安排为非工作时间的工作。如果它仍然需要太长时间，那么我建议您以数千个批次运行它（您必须使用自己的数据库来查看最佳选择，因为您可以安全处理的数字很大程度上取决于表，索引如何你的服务器速度很快，有多少用户也在尝试对同一张表进行工作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-12T16:26:29.497

我们过去使用的另一种方法是使用我们要移动的主键创建一个临时表并使用 while 循环。通过这种方式，您可以以一种块方式执行此操作，这样您就可以避免在取消并且必须回滚时产生大量事务开销。

基本上你最终要做的是插入表名（...）从表名中选择（...），其中主键在（从临时表中选择前 10000 个键）

您想要在辅助结果集中的前 10000 个，以便您可以将它们从临时表中删除，这样它们就不会再次被处理。

另一种方法是使用游标来减少一次处理的记录数。

另一种循环方法是在 while 循环中执行类似的操作。

将 @stop 声明为 int set @stop = (select count(primaryKey) from tableName where primaryKey not in destinationtable)

while (@stop > 0) 开始事务

插入destinationTable (...) select (...) from sourcetable where primaryKey not in (select primarykey from destinationtable)

犯罪

set @stop = (select count(primaryKey) from tableName where primaryKey not in destinationtable) end

不是最有效的，但它会起作用，并且应该允许您保留事务日志。除非您需要它，否则请确保使用 no lock 关键字，以便在执行此大型移动时不会阻止其他事务（除非您使用 BCP 或 DTS，因为它们要快得多）。

不过，有些话可能是你最好的选择。使用 BCP、DTS 或其他一些批量工具。如果您可以删除索引，它将使事情进展得更快。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-12T19:19:55.320

你有没有通过sql server management studio 测试过sql，看看实际需要多长时间？我会从那里开始。您可以提高选择的性能。并且您可以通过插入表格上的 tabblock 提示来提高性能。

# usability - 宏的速度命名参数

> ID：541670
> 
> 赞同：3
> 
> 时间：2009-02-12T15:06:01.377
> 
> 标签：usability, macros, velocity

我有一个带有几个参数的宏。其中一些是可选的，如果参数为空，它将替换为默认值。

现在的问题是如何让普通网页设计师尽可能容易地做到这一点。除了我的例子之外还有其他可能处理这种情况吗？

示例 1：

这里明显的问题是可选值。

```
#macro (myTag $param1 $param2 $param3)
...
#end 
```

示例 2：

当多次使用同一个宏并且所有变量都没有再次设置时，这里的问题可能是一个问题。

```
#set ($param1="value1") 
#set ($param2="value2") 
#set ($param3="value3") 

#macro (myTag)
...
#end 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-27T04:09:15.423

从 Velocity 1.6 开始，不支持可选或命名参数。最近提交了一个带有此功能的补丁，因此我们可能会在未来的版本中看到它可用。

同时，考虑传入一个列表或值映射。例如，您可以按如下方式传入参数映射（需要 Velocity 1.5 或更高版本）：

```
#macro(myMacro $p)
  item 1: $p.param1
  item 2: $p.param2
#end

#set($params = {"param1" : "val1", "param2":"val2"})
#myMacro($params) 
```

显示：

```
item 1: val1
item 2: val2 
```

要处理可选参数，请在宏中使用#if 来检查参数。向地图添加新元素有点混乱。由于 Java 方法“put”返回一个值，因此您必须使用 #set 来处理返回值。（否则它会显示在结果文本中）。

```
#macro(myMacro $p)
  #if(!$p.param1)#set($dummy = $p.put("param1", "default1"))#end
  #if(!$p.param2)#set($dummy = $p.put("param2", "default2"))#end
  #if(!$p.param3)#set($dummy = $p.put("param3", "default3"))#end

  item 1: $p.param1
  item 2: $p.param2
  item 3: $p.param3
#end

#set($params = {"param1" : "val1", "param2":"val2"})
#myMacro($params) 
```

显示

```
item 1: val1
item 2: val2
item 3: default3 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2022-02-09T23:04:15.410

这是一个 Velocity 宏，它有两个参数，一个颜色和一个对象列表：

```
#macro( tablerows $color $values )
  #foreach( $value in $values )
    <tr><td bgcolor=$color>$value</td></tr>
  #end
#end 
```

然后您可以通过这种方式使用宏：：

```
#set( $greatlakes = ["Superior","Michigan","Huron","Erie","Ontario"] )
#set( $color = "blue" )

<table>
  #tablerows( $color $greatlakes )
</table> 
```

在此处查看完整文档：[Velocity 替代文档](http://people.apache.org/%7Ehenning/velocity/html/ch07.html)

# open-source - 什么是最好的开源 wiki 平台？

> ID：541675
> 
> 赞同：25
> 
> 时间：2009-02-12T15:06:41.747
> 
> 标签：open-source, wiki, wysiwyg

我的任务是为我们的开发人员建立一个 wiki 以共享项目信息（服务器 IP、接口文档、架构图等）。我的经理推荐了 Deki，我也听说过 MediaWiki 和 Twiki。这里的一个项目使用 Trac，但我们不需要它的 SVN 功能，如果可能，我们希望有一个所见即所得的编辑器。我们还想在本地托管这个 wiki。

我找不到很多比较各种 wiki 平台的网络资源，而且以前的堆栈溢出问题并没有真正直接解决这个问题。

最好的维基平台是什么？过去使用过什么是好的/糟糕的？

要求：

*   所见即所得
*   干净的界面
*   便于使用
*   将文件附加到页面
*   用户管理层次结构（用户/组）
*   开源
*   本地托管

如果不重复，则非常相似：[Coding Standard Wiki](https://stackoverflow.com/questions/472882/coding-standard-wiki/472925#472925)

**更新：**
我们决定选择 Deki。出色的界面、所见即所得、用户层次结构和从 VM 映像安装非常简单。我赞成 Deki 帖子，但我将对 wikimatrix 的答案给出最佳答案，因为这是帮助我比较各种 wiki 平台的最佳建议。谢谢！

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-02-12T15:09:33.490

尝试在[Wiki Matrix中比较它们](http://www.wikimatrix.org/)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-12T15:14:20.840

在工作中，我们目前使用[Mindtouch](http://www.mindtouch.com/)的 Deki 。它具有您发布的所有功能。

很棒的产品，但我选择它的主要原因是他们在 VMware 映像上有一个现成的版本。只需下载图像和 VWware 播放器并从您的计算机上运行它。然后，您可以通过浏览器访问它。

当我们有一台 VMware 服务器时，我只是将它移到那里并继续使用它。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-12T15:33:52.947

WYSIWYG 让很多人失望的是，当人们试图粘贴来自其他来源的项目时。

我有一个为非营利组织维护的网站，我使用了[FreeTextBox](http://freetextbox.com/)。它简洁、免费，并且在 ASP.NET 中运行——我需要的所有标准。这个俱乐部的成员根本**不**打算弄清楚 HTML 并用它来使事情变得粗体、下划线等。所以，我给了他们 FTB，它有点像 Microsoft Word。双赢，对吧？

错误的。由于默认情况下我保留了 FTB 为您提供的所有控件，因此人们选择了各种奇怪的废话，主要是字体。组织中的每个人都*喜欢* [Comic Sans](http://bancomicsans.com/)。啊。这是为了编辑一个面向公众的网站，一切看起来都非常不一致——字体的大小，字体的类型，一切。

所以，我进去关掉了大部分我不希望人们做的事情，比如改变字体或大小等等。

你知道人们做了什么吗？他们会在 Microsoft Word 中编辑所有内容，然后将其粘贴进去。他们注意到他们无法在 FTB 中做他们想做的事情，所以他们只是使用 Microsoft Word 来解决这个问题（我确信这就是他们在电子邮件中发送屏幕截图的方式好）。而 FTB 只是接受所有这些，通常也带有非常混乱的换行符，所以事情看起来更加笨拙。FTB 的设计使得当事情变得一团糟时，如果不深入研究 HTML，就很难修复它们，这超出了这些成员的能力范围。

如果我有时间再次接触该站点，我将剥离 FTB 并使用 Stack Overflow 使用的 Markdown 放入 WMD 编辑器之类的东西。我同意不让人们实时看到他们的编辑会是什么样子是“wiki”编辑者忽略的一个问题。但我也认为，让人们在线使用真正的所见即所得编辑器（或至少接受 Word 生成的 HTML-in-the-background 编辑器）是灾难的根源。我喜欢 Stack Overflow 使用的折衷方案——不要让他们使用真正的 HTML，而是让他们实时预览。

因此，尽管所见即所得编辑是您的要求之一，但您可能需要根据您网站的受众重新考虑这一点。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-12T15:10:08.837

我喜欢 mediawiki，我们在这里使用它：[http ://wiki.lessthandot.com/index.php/Main_Page](http://wiki.lessthandot.com/index.php/Main_Page)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-12T15:18:37.740

我不确定“用户管理层次结构（用户/组）”，但[MoinMoin](http://moinmo.in/)涵盖了所有其他基础。

由于 Wiki 通常是扁平的（即每个人都可以做任何事情），我不确定将用户分成两个以上的层次结构（管理员和普通用户）是否有意义。当然，以前从未使用过 Wiki 的人通常会受到恐惧和怀疑的驱使，他们会相信他们必须保护 wiki 免受破坏。

反驳的观点是您不能删除 wiki 中的任何内容，并且 Wikipedia 在 Internet 中存活了多年，几乎没有受到保护。由于“还原”只需单击一下并且价格便宜，因此我认为最好将精力投入到 wiki 引擎的其他功能上。

个人经验的一点说明：所见即所得的编辑器仍处于起步阶段。我发现使用原始编辑模式时我的速度要快得多。不过，该功能可以更轻松地将其出售给高层管理人员（= 认为“Word”==“操作系统”的人）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-12T15:09:47.187

我不知道它是否具有您想要的所有功能......（但我怀疑它可能）

[旋风维基](http://www.screwturn.eu/Wiki.ashx)

没关系...它没有所见即所得的编辑...

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-18T15:29:25.033

FWIW，我强烈推荐 Foswiki.org（前 TWiki）。这是一个非常成熟的 Wiki，具有非常好的所见即所得编辑器以及可靠的 wiki-ML，并且它还允许所有 HTML 标记。

它非常容易安装在许多平台上，并且包含良好的安全措施，包括对用户和组的细粒度访问控制。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-12T15:16:56.030

我们使用[ScrewTurn Wiki](http://www.screwturn.eu/Default.aspx)作为公司的本地wiki。到目前为止，我们还没有遇到任何问题。Afaik，它具有您要求的所有功能。但当然，您应该先尝试一下，特别是如果您需要一个 asp.net wiki 引擎。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-13T04:33:43.633

虽然我主要使用MediaWiki，但它没有所见即所得，也不利于限制*阅读*。如果您想限制编辑（根据您的“用户管理层次结构（用户/组）”），那么它是非常可行的，但是对于限制阅读，基本上可以保证您可以以防水的方式进行。它不是为此而构建的。

也许你应该看看[**TWiki**](http://www.twiki.org/)。它有一个所见即所得的编辑器，你也可以直接用 HTML 编写。这是有益的，因为您没有将寻呼机存储在 wiki 标记的中间层中。

我相信它从头开始也有非常强大的访问控制。对于用户来说，这是相当不错的。我认为安装起来很棘手，但是您没有将轻松安装列为您的要求之一。;) 一旦你过去了，它应该没问题。[它也有一个强大的社区，尽管由于最近的一次，呃，干扰](http://foswiki.org/About/WhyThisFork)，请留意不同名称的分叉。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-13T06:27:05.920

[我喜欢FogBugz](http://www.fogbugz.com)中的 Wiki ，但我使用 FogBugz 所以它当然很方便。

# sql-server - 如何使用 SSIS 指定变量文件名？

> ID：541693
> 
> 赞同：0
> 
> 时间：2009-02-12T15:10:31.193
> 
> 标签：sql-server, ssis, data-import

我是使用 SSIS 进行数据导入的新手——我有几个文件要导入到我的数据库模式中，但我需要每 3 个月运行一次；文件名根据季度更改，例如`SKU1QTR`将变为`SKU2QTR`.

如何使用 SSIS 处理这种情况？有没有办法指定文件名（至少有 6 个这样的文件），或者更好的是，只指定数字部分，因为文件的其余部分始终保持不变？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T15:14:44.460

创建一个脚本任务并执行类似的操作，其中 FlatFileCSV 将是您的连接名称

```
Dts.Connections("FlatFileCSV").ConnectionString = 
"E:\SomeFile" + theDate.ToString("yyyyMMdd") + ".csv" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-19T10:21:44.253

将您的文件名/连接字符串放入配置文件中。如果这确实是唯一不同的地方，那么您甚至可以从命令行运行该软件包，而您根本不需要打开 BIDS。

由于您是自称新手，这有点高级，但它是一种值得了解的技术。

# performance - 内存管理的 90/10 规则？

> ID：541694
> 
> 赞同：5
> 
> 时间：2009-02-12T15:10:46.293
> 
> 标签：performance, memory-management, programming-languages, garbage-collection

大多数程序员都同意垃圾收集是一件很棒的事情，并且在大多数应用程序中是非常值得的开销。然而，我个人的观察是，大多数对象的内存管理是微不足道的，其中可能有 10%-20% 需要考虑诸如引用计数和一般非常复杂的内存管理方案之类的杂项。在我看来，通过保守地手动删除对象生命周期明显的大对象并让 GC 收集其余的对象，假设 GC 实现支持这样的事情，只需一小部分开销即可获得垃圾收集的所有好处. 这将使 GC 运行的频率大大降低，消耗的多余内存也更少，同时仍然避免了实际上难以手动管理的情况。

```
int myFunc() {
    Foo[] foo = new Foo[arbitraryNumber];  // May be too big to stack allocate.
    // do stuff such that the compiler can prove foo doesn't escape.
    // foo is obviously no longer needed, can be automatically deleted here.
    return someInteger;
} 
```

当然，这可能不适用于复制 GC，但为了这篇文章，我们假设我们的 GC 没有复制。为什么这种混合内存管理方案在主流编程语言中显然如此罕见？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T15:23:45.980

因为这种情况太少见了。几乎没有方法是孤立的。它们都接受来自外部的对象或创建对象并将它们传递出去。

一个不访问任何字段、没有参数并且不返回任何东西的方法不能做任何事情。

相反，GC 专注于最常见的情况（90%）并尝试控制这 90%（短暂的临时对象）。这意味着在通常情况下，您要检查的对象较少，其余的则无关紧要。接下来，您使用增量扫描（因此您可以在小冲刺中运行，这些冲刺只会中断很短的时间）。

我曾经试图想出一个更好的 GC 算法，但惨遭失败。他们使用一种接近于奥术的方法。关于[Java 5 GC Performance Tuning](http://java.sun.com/javase/technologies/hotspot/gc/gc_tuning_6.html)的文档应该会给你一些想法。当然还有[维基百科中的 GC 文章](http://en.wikipedia.org/wiki/Garbage_collection_(computer_science))。

归结为：使用 GC 甚至比使用传统的内存分配和释放模式更快。想想经典算法，它只是定位任何可到达的对象并将其复制到一个新的地方。如果您刚刚忘记了一大堆对象（例如，所有已分配对象的 90%），该算法只需要检查其余的（10%）。任何它无法达到的东西，无论有多少，都无关紧要。现在您可能会说复制很昂贵，但是 a) 这不是真的；今天，一个普通的台式机 CPU 可以在不到 100 毫秒的时间内复制 40MB，并且 b) 复制将保护您免受碎片的影响，因此这实际上是*一件好事*。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T15:57:10.380

“大多数程序员都同意垃圾收集是一件很棒的事情，而且在大多数应用程序中，这些开销非常值得。”

笼统的概括...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T15:18:41.780

关于“显然不再需要”的快速说明：这并不容易；）

```
[...]
Foo() {
    someGlobalList.add(this);
}
[...] 
```

除此之外，您能够手动删除大事的想法是一个很好的想法。据我了解，它至少部分是用现代语言实现的（例如`using`，在 C# 中，遗憾的是它实际上并不是免费的）。但是，没有达到你想要的程度。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T15:28:17.500

您所描述的非转义对象的确定性删除语句现代 GC 实现相当有效。大多数分配的对象是从池中分配的，并在方法退出时非常有效地删除 - 很少有最终在较慢的 GC 堆上。

这实际上产生了与您描述的相同的效果，而程序员干预较少。而且由于垃圾收集器是自动的，因此可以减少人为错误的范围（如果您删除了仍然保留引用的内容怎么办）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T15:44:33.373

如果您正在创建一个您希望一次仅在一个方法调用的上下文中使用并且没有终结的对象，那么我建议在做出这种区分的语言中使用值类型而不是引用类型。例如，在 C# 中，您可以将实体声明为 a`struct`而不是 a `class`。然后，您的短期方法本地实例将在堆栈而不是堆上分配，并且它们将在方法返回的那一刻被隐式释放。

而且这种技术可以比您最初的想法更进一步，因为可以将结构传递给其他方法，而不用担心破坏生命周期分析。

对于数组，如题中，可以使用`stackalloc`命令来实现这个效果。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-13T22:46:34.940

这似乎正是 D 管理内存的方式。它收集垃圾，同时允许您在需要时专门删除对象，甚至完全避开 GC 以支持 malloc / free。scoped 关键字似乎可以在堆栈上执行您想要的操作，尽管我不确定它是否实际上在堆栈或堆上分配对象。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-04-08T23:04:51.770

While there may be some benefits to combining manual cleanup with garbage collection, there is substantial benefit for having the garbage collector continue to manage objects between the time they're no longer needed and the time they can be shown to have no surviving rooted references. Among other things, in a non-GC system, it's often very hard to prove when deleting an object that there is no possible way any reference could still exist. If an object is deleted while a reference still exists, an attempt to use that reference could cause arbitrary undefined behavior; guarding against such danger without a GC is in general difficult. By contrast, if one invalidates objects when one is done with them, but leaves the reuse of the former-occupied memory to the GC, one can ensure that an attempt to use the invalidated object will fail in a predictable fashion.

Incidentally, if I were designing a "micro framework", I would have separate heap areas for mutable and immutable objects. Generational garbage collection works best if code can tell whether an object has been written since the gen0 or gen1 was collected. To make such a determination with mutable objects is much more difficult than with immutable ones. On the other hand, manually managing the useful lifetime of mutable objects is generally easier than managing the useful lifetime of immutable objects, since the former should generally have one clear "owner", while the latter will generally not.

# c# - 我可以将 ASP.NET MVC 与常规 ASP.NET Web 表单一起使用吗

> ID：541703
> 
> 赞同：31
> 
> 时间：2009-02-12T15:12:00.177
> 
> 标签：c#, asp.net, .net, asp.net-mvc

我应客户的要求使用 ASP.NET Web 表单构建了一个巨大的站点。问题是我发现 ASP.NET Web 表单有点不直观（仅我个人喜好）。所以我想做的是使用 MVC，但我真的不能指望我的客户为我的完全重写时间付费（他也没有时间）。

所以我要问的是，我能不能同时使用ASP.NET MVC和Web表单，并逐渐越来越多地使用MVC？有小费吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2011-12-13T08:49:40.250

2014 年更新：

> Visual Studio 2013 让我们更接近 One ASP.NET。**不再有 MVC 项目类型或 Web 窗体项目，只有 ASP.NET。如果您想混合使用 Web 表单和 Web API，或者 MVC 和 SignalR，请继续！** 你受到鼓励和支持。NuGet 引入了新特性和功能，而不会破坏现有应用程序。

[VS 13](http://www.asp.net/vnext)

因此，现在鼓励混合使用 Web 表单和 MVC（几乎可以无缝地工作），并且混淆了边界。我猜 MS 意识到有必要让项目慢慢迁移到 MVC，或者只是根据需要迁移部分，并获得两全其美。

* * *

> **MVC 项目：**

将 MVC 与 Web 表单一起使用已经有一段时间了，这当然是可能的，也是一个很好的选择。新的功能和页面可以很容易地添加到具有良好架构设计的 MVC 页面中，例如 DDD（服务存储库、依赖注入等），而旧的东西可以保持原样。在 Web 表单页面中结合 MVC 也可以正常工作，尽管 JS 验证可能存在一些小问题。我会极力推荐它。

从创建 MVC 应用程序 (5 atm) 开始相当容易，然后在启动并运行基本模板后，将旧的 webforms 添加到文件夹中。通过这种方式，您可以正确获得新的 MVC 设置并保持向后兼容性。

*   您可以创建一个 MVC 项目，然后将所有 Webforms 页面复制到一个文件夹中。（我想也可以升级一个项目）
*   设置路由以忽略 URL 中具有该特定文件夹名称的请求。通过这种方式，MVC 和 Web 表单可以一起使用，而不会在 URL 中出现麻烦。
*   Asp.net WebForms *aspx*页面可以驻留在 MVC 中，只要它们没有放在 /Views 文件夹中。
*   在旧语法上使用 Razor，您可以轻松自定义 HTML 帮助程序，并且更简洁。
*   查看 MVC 标准和约定，控制器应该非常轻量级。它不是可以包含尽可能多的逻辑的代码隐藏。
*   视图不应包含超过表示逻辑（无业务逻辑）
*   一切新 => MVC
*   资源、web.config 等可供双方使用
*   菜单不使用 MVC 中的旧站点地图

> **在 webforms .aspx 页面中使用 MVC：**

下面的文本旨在演示如何从 Web 表单页面中使用 MVC。（例如在 MyPage.aspx 中）您可以在 Web 表单中使用 MVC 操作/视图，例如 ajax 来填充页面的一部分或某些 div。

包含 MVC 的 Web 表单可以正常工作，至少在 HTML 中添加 ajax 调用以填充来自 MVC 的 div 时。

在 .aspx 内部

```
..html & webforms code

<div id="fillMeFromMVC">
  <script type="text/javascript">
   $.ajax(... call an MVC action to fill 
      the "fillMeFromMVC" div that this script sits inside of);
 </script>
</div> 
```

这将通过 MVC 填充页面的一部分，您可以干净地执行您的 MVC，而不必担心在 webforms 中做了什么。

> **WebForms 与 MVC：**

至此，您可能已经非常清楚这两种技术之间的差异，但是这里有一些它们之间的比较。它们都有各自的目的和用途。我个人更喜欢 MVC 来完成我需要做的事情，但这可能取决于你想要实现的目标。

如果您在它们后面使用例如 SOA，那么 Web 表单和 MVC 页面都可以使用相同的业务逻辑。**当代码都在后面的页面中并且与 UI 相关联（没有关注点分离）时，Web 表单可能是有害的。凭借坚实的架构和一些可以减少的工作量。**

进一步阅读：

[Webforms 与 MVC（代码项目）](http://www.codeproject.com/Articles/528117/WebForms-vs-MVC)

[ASP.NET WebForms 和 ASP.NET MVC 之间的区别（博客）](http://www.webdevelopmenthelp.net/2013/10/Difference-between-ASP.NET-WebForm-And-ASP.NET-MVC.html)

# c - if(TRUE) 在 C 语言中是个好主意吗？

> ID：541705
> 
> 赞同：16
> 
> 时间：2009-02-12T15:12:06.523
> 
> 标签：c, if-statement

在C编程语言中，我的理解是变量只能在代码块的开头定义，并且变量将具有声明它的块的范围。考虑到这一点，我想知道它是否是被认为是人为创建新范围的不良做法，如下例所示：

```
void foo()
{
     ... Do some stuff ...

     if(TRUE)
     {
         char a;
         int b;

         ... Do some more stuff ...
     }

     ... Do even more stuff ...
 } 
```

假设在宏定义中将 TRUE 设置为 1，这段代码会被认为是“好代码”，还是会让经验丰富的程序员一想到它就畏缩？

感谢您的输入！

编辑：为了回应一些答案，我正在使用的代码需要与一些非常古老的遗留系统一起使用。虽然在 C99 的假设上进行操作会很好，但我们真的不能保证他们会拥有它。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-02-12T15:15:43.677

你甚至不需要 if 语句。您可以使用 {} 创建块

然而，这可能应该是一个单独的功能。

这里的例子：

```
#include <stdio.h>

int
main(int argc, char **argv) {
    int i = 0;
    {
        int i = 10;
        printf("%d\n", i);
    }
    printf("%d\n", i);
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-12T15:15:42.973

据我所知，您可以在没有 if 的情况下创建范围。

只使用这样的大括号：

```
{
    int x;

} 
```

我建议反对

```
if (TRUE) 
```

因为它妨碍了可读性。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-12T15:13:37.987

您可能想为该范围创建一个新函数。
如果它真的需要有自己的范围，它可能无论如何都是一个单独的逻辑函数。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-12T15:15:27.467

由于您可以在没有 if 的情况下制作范围块，这是一个更好的主意。

```
void foo() {
     ... Do some stuff ...
     {
         char a;
         int b;
         ... Do some more stuff ...
     }
     ... Do even more stuff ...
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-12T15:21:41.417

请注意，在 C99 中，允许在块的中间声明局部变量。

C99 是 1999 年 C 标准的版本；大多数现代 C 编译器都支持它。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-12T15:17:52.797

首先，新块不需要是 if 块。它可能只是一段用大括号括起来的代码，如下所示：

```
void foo() {
 ... Do some stuff ...

 {
     char a;
     int b;

     ... Do some more stuff ...
 }

 ... Do even more stuff ...
} 
```

其次，在任何符合 C 标准（我认为是 C99）的现代 C 编译器中，您可以在块中的任何位置声明变量，因此您根本不需要创建新块。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-02-12T15:15:53.503

您可以删除

```
if(TRUE) 
```

并留下大括号，它们本身定义了一个新的语法块 -[复合语句](http://en.wikipedia.org/wiki/C_syntax#Compound_statements)。

这绝对比之前的 false 更干净，但是您可能仍然想问自己为什么要创建一个新块 - 定义一个子例程会更好吗？

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-02-12T15:20:56.347

正如很多答案已经说过的那样，您不需要“如果”的东西。只需创建裸块。但我想再谈一点。在 C 中，您可以在块中的任何位置创建变量声明，而不仅仅是在开始处。在 C89 中，您有这个限制。从 C99 开始（现在已经 10 年了），您不再有这种限制，尽管有些编译器无论如何都会抱怨。但是，如果您告诉 GCC 使用带有 -std=c99 选项的最新“最新”C 标准，则 GCC 不会。

因为仍然存在默认情况下抱怨的编译器，所以我不喜欢混合声明和代码。出于兼容性原因，我会继续将声明放在块的开头。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-02-12T15:14:28.920

我不会称自己经验丰富，但我有点畏缩。

我的问题是 if 语句会导致某人相信某些东西实际上正在被评估......但是在运行时，宏是真或假，它没有改变它是别的东西。您应该包含代码或不包含代码。

如果你的意思是像#ifdef DEBUG 这样你应该这样做以向读者表明这是调试代码......

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-02-12T15:18:17.897

为一些有创造力的人敞开大门：

```
#define TRUE 0
#define FALSE 1 
```

只需使用大括号来声明范围。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-12T15:15:14.427

我认为您不需要 if(true) 部分。

只需要 { } 来确定变量的范围。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-02-12T15:15:24.783

我的回答如下：

这让经验丰富的程序员一想到它就畏缩不前。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-02-13T00:23:50.520

只需在块的开头定义变量或使用其他函数。添加带有空 {} 或任何替代项的人工作用域不是好的做法。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-12T15:19:28.987

C99 允许您在几乎任何地方声明变量。但是，不要在没有充分理由的情况下这样做。首先尝试将您的函数拆分为更小的（可能是内联的）函数。

这种事情可能有意义的唯一地方是当您有一个在函数中间初始化的变量时，例如类似于在 C++ 中创建一个对象。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-02-12T15:20:43.227

我认为您正在处理一些过时的假设。几个月来，我一直在使用 GCC 直接编写 C 代码，您不需要在块的开头声明变量，即使第二版 K&R 说您必须这样做。你可以在任何地方声明你的变量，就像这个不太有用的例子：

```
char* palstring;
palstring = malloc(LARGEST_STRING);
memset(palstring, 0, sizeof palstring);
fgets(palstring, LARGEST_STRING, fin);

char* cur = palstring;
char letter;
letter = *cur; 
```

所以没有必要按照你的建议去做。语言继续前进。

C 语言的另一个很好的补充是可变长度数组，它允许您将数组及其大小传递给函数。在过去，你所能做的就是传递一个指针。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-02-12T15:37:30.300

假设您使用旧的编译器（就像我一样，它是用于旧硬件的），您像其他人建议的那样跳过 if(TRUE) ，并且您有一个非常巨大的功能（女巫你一开始就不应该拥有） ，那我觉得还可以。我做了，但是感觉不太好。。。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-02-12T16:26:38.013

显然我是少数，但我发现“只是大括号”更难阅读，因为它偏离了通常的模式。在（诚然不常见的）我想要一个范围块而不定义另一个函数的情况下，我更喜欢包含“if”，但没有任何宏并带有注释来解释原因：

```
if( 1 ) // just to establish scope
{
   // do stuff here
} 
```

# c# - ftp login using c#

> ID：541712
> 
> 赞同：0
> 
> 时间：2009-02-12T15:13:39.860
> 
> 标签：c#, ftp

How do you Login to FTP using C#?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T15:16:26.717

Here is a very nice FTP Client for C#

[http://www.codeproject.com/KB/IP/ftplibrary.aspx](http://www.codeproject.com/KB/IP/ftplibrary.aspx)

## Snippett from Link

```
//Get the basic FtpWebRequest object with the
//common settings and security
private FtpWebRequest GetRequest(string URI)
{
    //create request
    FtpWebRequest result = (FtpWebRequest)FtpWebRequest.Create(URI);
    //Set the login details
    result.Credentials = GetCredentials();
    //Do not keep alive (stateless mode)
    result.KeepAlive = false;
    return result;
}

/// <summary>
/// Get the credentials from username/password
/// </summary>
private System.Net.ICredentials GetCredentials()
{
    return new System.Net.NetworkCredential(Username, Password);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T15:17:18.243

Native FTP support in .NET is fiddly.

I suggest using the free edtFTPnet component - I have used this in enterprisey applications with no problems whatsoever.

[http://www.enterprisedt.com/products/edtftpnet/overview.html](http://www.enterprisedt.com/products/edtftpnet/overview.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-05-03T20:24:23.963

```
var url = "ftp://server";    
FtpWebRequest request = (FtpWebRequest)FtpWebRequest.Create(url);
request.Credentials = new NetworkCredential(username, password); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T15:16:49.367

Something like:

```
var ftp = System.Net.FtpWebRequest(some url);
ftp.Credentials = something; 
```

I think... :)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-04-25T13:28:18.113

对于任何搜索此主题的人，我只是向戒指扔帽子。这是我最近的做法。我创建了一个 FTPProvider 类来处理连接布线和一个 FTPSettings 类来保持一切模块化。下面的第一行建立连接并返回 FtpWebRequest，您需要执行下载、删除和从 FTP 服务器获取列表等操作。可以[在 msdn 上找到完整的列表和示例。](http://msdn.microsoft.com/en-us/library/system.net.ftpwebrequest.aspx)

```
FtpWebRequest request = FTPProvider.GetFTPRequest(FTPProvider.Settings.FTPPath);

public class FTPProvider
{
    public FTPSettings Settings { get; set; }

    public FtpWebRequest ConnectToFtp(Uri ftpServerUri)
    {
        var request = (FtpWebRequest)WebRequest.CreateDefault(ftpServerUri);
        request.Credentials = new NetworkCredential(Settings.User, Settings.Password);
        return request;
    }

    public FtpWebRequest GetFTPRequest(string filepath)
    {
        var ftpServerUri = new Uri(filepath);
        return ConnectToFtp(ftpServerUri);
    }

}
public class FTPSettings
{
    public string FTPPath;

    public string User;

    public string Password;
} 
```

# actionscript-3 - 当 TextField.selectable = false 时光标消失；

> ID：541713
> 
> 赞同：0
> 
> 时间：2009-02-12T15:14:00.263
> 
> 标签：actionscript-3, flex3

光标消失时

```
TextField.selectable = false; 
```

如何使光标可见但文本字段不可选择（使用鼠标）或 CTRL+A。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T16:05:28.097

我过去见过类似的问题，但我不记得如何复制它。它不再出现在我第一次看到它的项目中，所以我知道从那时起发生的两件事如下。当然，可能还有其他一些变量，但该项目现在正在运行......

我怀疑该字段仍然是可编辑的。那将是我的第一个猜测。我会尝试的第一件事是：

```
//( in a flash.text object ( Flash or Flex ) )
myTxtFld.type = TextFieldType.DYNAMIC;

//( in a mx.controls object ( Flex ) )
myTxtFld.editable = false; 
```

如果这不起作用，请尝试将 TextField 嵌套在具有 MouseEvent.ROLL_OVER 侦听器并将 useHandCursor 设置为 False 的内容中。例如：

```
var spt:Sprite = new Sprite();
spt.useHandCursor = false;
spt.addChild( myTxtFld );
spt.addEventListener( MouseEvent.ROLL_OVER, function( anon:* ){} ); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T15:25:41.343

我相信 flash/as3 将文本光标视为零宽度选择，我看不出应该如何在这里做你想做的事情，除了可能扩展文本字段并将你自己的光标放在鼠标事件上

# html - 有哪些工具可以调试 css？

> ID：541716
> 
> 赞同：8
> 
> 时间：2009-02-12T15:14:30.857
> 
> 标签：html, css

我正在把头发扯下来。人们使用什么工具来调试 CSS 的格式问题？我使用 css 进行了一些相对简单的导航格式，如下所示：

```
/* sub navigation */
.sidenav {
    float: right;
    width: 218px;
}
.sidenav h1 {
    background: #BCB39F url(img/sidenavh1.gif) repeat-x;
    border-bottom: 1px solid #999;
    border-top: 1px solid #CCC;
    color: #4A4A44;
    font-size: 1.2em;
    height: 22px;
    margin: 0;
    padding-left: 12px;
}
.sidenav h1 a {
    color: #554;
    text-decoration: none;
    display: block;
}
.sidenav h1 a:hover {
    background: #D6CCB9;

    color: #654;
} 
```

然后我的页面中有这段代码：

```
<div class="sidenav">
<a href="ceremony">Wedding Ceremony</a> 
<a href="reception">Wedding Reception</a> 
<div class="clearer"></div>
</div> 
```

而且它没有选择风格。它工作正常，所以我在其他地方的一个更改一定是把某些东西弄错了（我怀疑某个地方，但我真的很难找到它是什么。我的其他页面格式很好......）

有什么建议么？

* * *

感谢萤火虫找到答案。

未应用格式，因为链接的格式仅适用于`<h1>`元素中的链接 - 即 html 应该是：

```
<div class="sidenav">
<h1><a href="ceremony">Wedding Ceremony</a></h1>
<h1><a href=reception">Wedding Reception</a></h1>
<div class="clearer"></div>
</div> 
```

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-12T15:17:15.263

[`firebug`](http://www.getfirebug.com/). 还有一个可以在 IE 中运行的纯 javascript 版本，称为[`firebug lite`](http://getfirebug.com/lite.html).

它允许您随时关闭或更改任何`CSS`您想要的。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-12T15:15:59.307

回答实际问题标题：我用的是[FireBug](http://getfirebug.com/)！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-12T15:24:43.280

[Web Developer](https://addons.mozilla.org/en-US/firefox/addon/60)扩展也做了一些不错的事情。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-12T15:16:28.213

Firefox的[Firebug 插件](http://getfirebug.com/)有一些不错的 CSS 调试工具。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-12T15:19:09.987

[Firebug](http://getfirebug.com/)真的是你的朋友！

右键单击页面的一部分，选择“检查元素”，它会告诉您应用于该元素的所有样式。被取代的被划掉，所以你可以准确地看到你哪里出错了。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-12T15:27:03.743

如果您无权访问 Firebug，也可以使用 W3C CSS[验证器。](http://jigsaw.w3.org/css-validator/#validate_by_input)这通常能够指出语法错误。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-12T15:19:35.070

Magilla Gorilla 怀疑缺少“：

```
<a href=reception">Wedding Reception</a> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-12T15:32:54.853

在这种情况下，[萤火虫是救命稻草！](http://www.getfirebug.com/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-03T21:13:15.133

*   [萤火虫](http://www.getfirebug.com/)
*   [Web开发人员](https://addons.mozilla.org/en-US/firefox/addon/60)
*   [DOM 检查器](https://addons.mozilla.org/en-US/firefox/addon/6622)

# c# - 如何对列表进行排序 当用户点击表头时？

> ID：541732
> 
> 赞同：1
> 
> 时间：2009-02-12T15:16:41.897
> 
> 标签：c#, asp.net, asp.net-mvc, sorting

我正在编写一个 asp.net mvc 应用程序，并且我得到了我在表格中显示的服务调用列表。当用户单击表头时，我想告诉我的控制器按该列对列表进行排序。

```
public ActionResult Index(int? page, string sortBy, string sortDirection)
    {
        int pageIndex = page == null ? 0 : (int)page - 1;

        IServiceCallService scService = new ServiceCallService();
        IPagedList<ServiceCall> serviceCalls = scService.GetOpenServiceCalls("").ToPagedList(pageIndex, 2);

        return View("List", serviceCalls);
    } 
```

如何合并 sortBy 和 sortDirection。我想我可以做类似的事情：

```
IPagedList<ServiceCall> serviceCalls = sc.Service.GetOpenServiceCalls("").OrderBy(sortBy).ToPagedList(pageIndex, 2); 
```

但这不起作用，因为我假设 OrderBy 想要一个像 p => p.CreateDate 这样的 lambda 但不知道如何做到这一点。

我知道我可以做到这一点，但它们很丑，我确信 C# 在这里有一些我只是想念的简单的东西。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T15:48:26.173

不要忘记方便的花花公子 DataBinder：

```
var serviceCalls = sc.Service.GetOpenServiceCalls("").OrderBy(call => DataBinder.Eval(call, sortBy));
return serviceCalls.ToPagedList(pageIndex, 2); 
```

来自 Msdn 文档的 DataBinder.Eval

> 使用反射在运行时再次解析和评估数据绑定表达式的对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T15:33:39.920

对通用列表进行排序时，您可以提供一种方法来比较重载的排序`List<T>.Sort()`：

```
public void Sort(
    Comparison<T> comparison
) 
```

[这](http://msdn.microsoft.com/en-us/library/w56d4y5z.aspx)是来自 MSDN 的示例。比较`Comparison<T>`是一个委托，它提供了在排序时比较对象的方法。

我可能错了，但我相信如果您的列表仅包含相同类型的项目并且该类型 implements `IComparable`，则委托可能不是必需的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T19:21:55.113

如果您只是想对列表进行排序，您还可以使用 jQuery 并使用[Table Sorter之类的东西。](http://tablesorter.com/ "表格排序器")它也是实时的，而且都是 ajax-y。

# c# - 我可以在 .Net CF 中获得 MsgWaitForMultipleObjects 的功能吗？

> ID：541745
> 
> 赞同：1
> 
> 时间：2009-02-12T15:18:04.530
> 
> 标签：c#, .net, compact-framework

我们正在将 C++ 应用程序迁移到 .Net CF。我们需要同时监控 UI 和几个外部事件。因此，我想知道我们是否可以`MsgWaitForMultipleObjects`在非托管世界中获得与托管世界相同的功能？

**编辑：** P/Invoke 不是我正在寻找的完整答案，因为我的意思是我们想要我们在非托管世界中拥有的全部功能，这意味着当输入消息被抽取时，事件和其他同步对象也是被监控。由于显而易见的原因，我们无法访问 .Net 中的消息泵。那么我们在哪里为 P/Invoking 着迷`MsgWaitForMultipleObjects`呢？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-17T14:29:21.083

我们需要做的实际上是跳过 Application.Run(Form) 并像在非托管世界中一样滚动我们自己的消息循环。然后我们可以按照原始问题中的描述使用 MsgWaitForMultipleObjects 。这也在[SDF](http://www.opennetcf.com/FreeSoftware/SDF14/tabid/91/Default.aspx)中完成。

# java - 如何确定对象的类别？

> ID：541749
> 
> 赞同：575
> 
> 时间：2009-02-12T15:18:24.763
> 
> 标签：java, inheritance

如果 class`B`和 class`C`扩展 class`A`并且我有一个`B`or类型的对象，`C`我如何确定它是哪个类型的实例？

* * *

## 回答 #1

> 赞同：864
> 
> 时间：2009-02-12T15:21:19.857

```
if (obj instanceof C) {
//your code
} 
```

* * *

## 回答 #2

> 赞同：410
> 
> 时间：2009-02-12T15:20:38.580

使用[Object.getClass()](http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html#getClass%28%29)。它返回对象的运行时类型。

* * *

## 回答 #3

> 赞同：194
> 
> 时间：2014-08-21T12:53:33.420

提出了多个正确答案，但还有更多方法：`Class.isAssignableFrom()`并且只是尝试投射对象（可能会抛出`ClassCastException`）。

## 可能的方法总结

让我们总结一下测试对象`obj`是否为 type 实例的可能方法`C`：

```
// Method #1
if (obj instanceof C)
    ;

// Method #2
if (C.class.isInstance(obj))
    ;

// Method #3
if (C.class.isAssignableFrom(obj.getClass()))
    ;

// Method #4
try {
    C c = (C) obj;
    // No exception: obj is of type C or IT MIGHT BE NULL!
} catch (ClassCastException e) {
}

// Method #5
try {
    C c = C.class.cast(obj);
    // No exception: obj is of type C or IT MIGHT BE NULL!
} catch (ClassCastException e) {
} 
```

## `null`处理上的差异

但处理方式有所不同`null`：

*   在前 2 个方法中，表达式计算为`false`if `obj`is `null`( `null`is not any instance)。
*   第三种方法`NullPointerException`显然会抛出一个。
*   相反，第 4 和第 5 方法接受`null`，因为`null`可以转换为任何类型！

> 要记住：`null` **不是**任何类型的实例，但**可以**转换为任何类型。

## 笔记

*   `Class.getName()`不应该用于执行*“is-instance-of”*测试，因为如果对象不是类型`C`而是它的子类，它可能具有完全不同的名称和包（因此类名显然不匹配）但它是仍然是类型`C`。
*   出于同样的继承原因`Class.isAssignableFrom()`不是*对称*的：如果类型是 的子类，则
    `obj.getClass().isAssignableFrom(C.class)`返回。`false``obj``C`

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2009-02-12T15:22:57.620

您可以使用：

```
Object instance = new SomeClass();
instance.getClass().getName(); //will return the name (as String) (== "SomeClass")
instance.getClass(); //will return the SomeClass' Class object 
```

HTH。但我认为大多数时候将其用于控制​​流或类似的东西并不是一个好习惯......

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2009-02-12T15:25:53.120

对建议的任何方法的任何使用都被认为是基于糟糕的 OO 设计的代码异味。

如果你的设计很好，你不应该发现自己需要使用`getClass()`or `instanceof`。

任何建议的方法都可以，但在设计方面需要牢记。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2014-05-13T09:58:25.540

在这种情况下我们可以使用反射

```
objectName.getClass().getName(); 
```

例子：-

```
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    String name = request.getClass().getName();
}
```

在这种情况下，您将获得对象传递给`HttpServletRequest`接口引用变量的类的名称。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2009-02-12T16:04:32.077

" " 类上还有一个[`.isInstance`](http://java.sun.com/javase/6/docs/api/java/lang/Class.html#isInstance(java.lang.Object))方法。`Class`如果您通过获取对象的类，`myBanana.getClass()`您可以查看您的对象是否与通过`myApple`相同的类的实例`myBanana`

```
myBanana.getClass().isInstance(myApple) 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2019-07-01T09:47:09.860

如果您想在运行时知道，检查`isinstance()`是不够的。采用：

```
if(someObject.getClass().equals(C.class){
    // do something
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-04-14T06:35:49.277

我使用 Java 8 泛型在运行时获取对象实例，而不必使用 switch case

```
 public <T> void print(T data) {
    System.out.println(data.getClass().getName()+" => The data is " + data);
} 
```

传递任何类型的数据，该方法将打印您在调用它时传递的数据类型。例如

```
 String str = "Hello World";
    int number = 10;
    double decimal = 10.0;
    float f = 10F;
    long l = 10L;
    List list = new ArrayList();
    print(str);
    print(number);
    print(decimal);
    print(f);
    print(l);
    print(list); 
```

以下是输出

```
java.lang.String => The data is Hello World
java.lang.Integer => The data is 10
java.lang.Double => The data is 10.0
java.lang.Float => The data is 10.0
java.lang.Long => The data is 10
java.util.ArrayList => The data is [] 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-12-24T06:25:50.627

我在 GeneralUtils 类中使用了打击功能，检查它可能有用

```
 public String getFieldType(Object o) {
    if (o == null) {
        return "Unable to identify the class name";
    }
    return o.getClass().getName();
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-07-03T11:13:46.900

您可以使用**getSimpleName()**。

假设我们有一个对象：**Dog d = new Dog()**，

我们可以使用下面的语句来获取类名：Dog。例如：

**d.getClass().getSimpleName();** // 返回字符串“狗”。

PS：d.getClass() 会给你你的对象的全名。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2022-02-20T05:21:57.533

用于查找**对象**是否特殊的`instanceof` `operator`天气。**`class`**

 **```
booleanValue = (object instanceof class) 
```

> JDK 14 扩展了 instanceof 操作符：可以指定绑定变量；如果 instanceof 运算符的结果为真，则将被测试的对象分配给绑定变量。

请访问官方 Java[文档](https://docs.oracle.com/en/java/javase/14/language/pattern-matching-instanceof-operator.html)以获取更多参考。

## 用于说明用法的示例程序`instanceof` `operator`：

```
import java.util.*;

class Foo{
    @Override 
    public String toString(){
        return "Bar";
    }
}

class Bar{
    public Object reference;
    @Override 
    public String toString(){
        return "Foo";
    }
}
public class InstanceofUsage{
    public static void main(final String ... $){
        final List<Object> list = new ArrayList<>();

        var out = System.out;

        list.add(new String("Foo Loves Bar"));
        list.add(33.3);
        list.add(404_404);
        list.add(new Foo());
        list.add(new Bar());

        for(final var o : list){
            if(o instanceof Bar b && b.reference == null){
                out.println("Bar : Null");
            }   
            if(o instanceof String s){
                out.println("String : "+s);
            }

            if(o instanceof Foo f){
                out.println("Foo : "+f);
            }
        }

    }
} 
```

## 输出：

```
$ javac InstanceofUsage.java && java InstanceofUsage 
String : Foo Loves Bar
Foo : Bar
Bar : Null 
```

# xml - Get original image dimensions when embedding image in WordprocessingML

> ID：541758
> 
> 赞同：2
> 
> 时间：2009-02-12T15:19:50.780
> 
> 标签：xml, ms-word, wordml

I am dynamically creating Word documents using the Velocity template engine. The documents are created in XML (using the Microsoft Office 2003 WordprocessML XML standard).

I am embedding an image (encoded in Base64 format) inside the WordML in the traditional way:

```
<w:pict>  
    <v:shapeType> ... </v:shapeType>    
    <w:binData w:name="wordml://02000002.jpg"> [ encoded data] </w:binData>

    <v:shape id="_x0000_s1026"  
           type="#_x0000_t75"
           style="width:100%;height:100%" 
           o:allowoverlap="f"
           >
        <v:imagedata src="wordml://02000002.jpg" o:title="testimage2">
        </v:imagedata>
    </v:shape>

</w:pict> 
```

The issue is with image sizing / scaling. Note the `style` attribute on the `<v:shape>` tag. Setting height and width to 100% **does not** size the image to its actual size. It sets height and width to approximately 1.04 inches which skews the image. Leaving off the height and width has the same effect. Setting height and width to `auto` has the same effect.

Most annoyingly, if I open the generated document in Word 2003, right click on the image, open the Format Picture dialog, and go to the Size tab it display the correct height and width under "Original size." It even provides a "Reset" button that resizes the image to its original size (assuming the "Relative to original picture size" checkbox is checked.)

I am like: !*@&#^#% ???

**So my question is:**

*Is there anyway in the context of WordML to get the original size values for the image (or instruct Word to **use** the original image size)?*

If someone can help will this question, I promise I will write an in depth blog post to ensure that I will be the *last* person that has to deal with this.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-11-14T06:29:23.240

如果您使用的是 xslt 模板，您可以像这样在模板中编写一些 C# 脚本（它用于元文件（.wmf），但您可以将其重写为 Bitmap 类以与 .jpg 格式一起使用）：

```
<msxsl:script language="C#" implements-prefix="user">
     <msxsl:assembly name="System.Drawing" />
    <msxsl:using namespace="System.Drawing.Imaging" />

     <![CDATA[

          public static double getImageWidthFrom64String(string base64)
            {
            byte[] bytes = Convert.FromBase64String(file);
            System.Drawing.Imaging.Metafile image;
            using (System.IO.MemoryStream ms = new System.IO.MemoryStream(bytes))
            {
                image =
(System.Drawing.Imaging.Metafile)System.Drawing.Imaging.Metafile.FromStream(ms);
            }
       return image.Width;
            }

             public static double getImageHeightFrom64String(string base64)
            {
            byte[] bytes = Convert.FromBase64String(file);
            System.Drawing.Imaging.Metafile image;
            using (System.IO.MemoryStream ms = new System.IO.MemoryStream(bytes))
            {
                image =
(System.Drawing.Imaging.Metafile)System.Drawing.Imaging.Metafile.FromStream(ms);
            }      
            return image.Height;
            }
     ]]>
      </msxsl:script> 
```

然后你可以使用这些函数在你的模板中获得真实的图像大小：

```
<xsl:template match="/ns1:Work/ns1:leaderSignature">
    <ns1:picture>
      <xsl:for-each select="@ns1:*|@*[namespace-uri()='']">
        <xsl:attribute name="{name()}" namespace="{namespace-uri()}">
          <xsl:value-of select="." />
        </xsl:attribute>
      </xsl:for-each>
      <xsl:variable name="filename" select="concat(concat('leadsig',ancestor::ns1:Work/ns1:id),'.wmz')"/>
      <xsl:variable name="file64String" select="."></xsl:variable> 
      <w:r>
        <w:rPr>
          <w:noProof />
        </w:rPr>
        <w:pict>    
          <w:binData w:name="{concat('wordml:\\',$filename)}">
            <xsl:value-of select="." />
          </w:binData>
          <v:shape id="pic3" o:spid="_x0000_s1028"  style="
            width:{user:getImageWidthFrom64String($file64String)};
            height:{user:getImageHeightFrom64String($file64String)};
            position:absolute;         
            text-align:left;
            left:0;
            margin-left:430pt;
            margin-top:192pt;       
            z-index:2;   
            visibility:visible;
            mso-position-horizontal-relative:page;
            mso-position-horizontal:absolute;
            mso-position-vertical-relative:page;
            mso-position-vertical:absolute;   
            mso-wrap-style:square;
            mso-wrap-distance-left:9pt;
            mso-wrap-distance-top:0;
            mso-wrap-distance-right:9pt;
            mso-wrap-distance-bottom:0">         
            <v:imagedata src="{concat('wordml:\\',$filename)}" o:title="" />
           <w10:wrap anchorx="page" anchory="page" />
          </v:shape>
        </w:pict>  
      </w:r>
    </ns1:picture>
  </xsl:template><!--Leader Signature--> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-03-14T16:26:26.220

我不明白您为什么要依靠 WordML 来获取图像大小？您正在将图像输入 Word 文档，您可以使用 Bitmap 类获取图像大小。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-03T14:59:35.033

您需要将“v:shape”元素的“style”属性中的宽度和高度设置为 0px。例如：

```
<v:shape style="width:0px;height:0px" > 
```

并且图像将具有原始大小。

# wcf - 为什么我的 WCF 服务没有响应我在 web.config 中的 baseAddress 设置？

> ID：541762
> 
> 赞同：2
> 
> 时间：2009-02-12T15:20:15.897
> 
> 标签：wcf, rest, asp.net-3.5, endpoint, base-address

我正在尝试通过在Anthony Steele 的[博客文章](http://blogs.conchango.com/anthonysteele/archive/2008/03/15/rest-from-wcf-3-5.aspx)中重新创建项目来学习如何使用 WCF 构建 RESTful 服务。他在他的配置中使用以下 XML 来设置服务的端点。

```
 <host>
      <baseAddresses>
        <add baseAddress="http://localhost:8080/greeter"/>
      </baseAddresses>
    </host> 
```

但是，当我尝试在我的 ASP.NET 3.5 网站的 web.config 中做同样的事情时，我无法导航到我的服务。这是我正在使用的 XML：

```
<system.serviceModel>
  <behaviors>
    <serviceBehaviors>
      <behavior name="GreeterBehavior">
        <serviceMetadata httpGetEnabled="true"/>
        <serviceDebug includeExceptionDetailInFaults="false"/>
      </behavior>
    </serviceBehaviors>
  </behaviors>
  <services>
    <service behaviorConfiguration="GreeterBehavior" name="Greeter">
      <host>
        <baseAddresses>
          <add baseAddress="http://localhost:49268/TestREST/webapi/services/greeter"/>
        </baseAddresses>
      </host>
      <endpoint address="" binding="wsHttpBinding" contract="IGreeter">
        <identity>
          <dns value="localhost"/>
        </identity>
      </endpoint>
      <endpoint address="mex" binding="mexHttpBinding" contract="IMetadataExchange"/>
    </service>
  </services>
</system.serviceModel> 
```

我想我的配置将允许我导航到[http://localhost:49268/TestREST/webapi/services/greeter](http://localhost:49268/TestREST/webapi/services/greeter)并查看我的服务。我得到的只是一条找不到资源的消息——我错过了什么吗？

编辑：我的部分问题是我的绑定是 wsHttpBinding。使用 webHttpBinding 可以让我正确使用该服务 - 除了 baseAddress 配置部分仍然无效。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T16:03:38.383

我的预感是服务端点没有成功创建。

在服务“名称”属性中，您不包括服务类型的 FQN（完全限定名称）。其次，在端点“合同”属性中，您也没有将 FQN 包含到合同类型中。

另一方面，这可能是一个端口问题。为了确保这一点，请尝试运行 Visual Studio 2008 发行版中包含的 WcfTestClient.exe。如果您可以连接到[http://localhost:49268/TestREST/webapi/services/greeter/mex](http://localhost:49268/TestREST/webapi/services/greeter/mex)，那么您知道这不是端口问题。

假设您可以通过 MEX 连接，然后尝试执行一些方法，这些方法可能会映射到[http://localhost:49268/TestREST/webapi/services/greeter](http://localhost:49268/TestREST/webapi/services/greeter)。

如果您在服务器上操作，请在此处查看有关 HttpCfg.exe 的一些有价值的详细信息： [WCF ServiceHost basicHttpBinding 503 error](https://stackoverflow.com/questions/530286/wcf-servicehost-basichttpbinding-503-error/530474#530474)

如果您需要有关 WcfTestClient 的更多详细信息，请在此处查找它们： [Is it possible to make the WcfTestClient work for custom transport channels?](https://stackoverflow.com/questions/484717/error-externally-testing-wcf-udp-custom-transport-channel-sample-from-the-windows)

**以防万一：**逐字复制示例并验证它是否按定义工作，包括配置文件，然后再对其进行最轻微的偏离。

# .net - 如何检测 USB 断开连接事件？（Windows、.NET C# 应用程序）

> ID：541765
> 
> 赞同：16
> 
> 时间：2009-02-12T15:20:46.253
> 
> 标签：.net, events, usb, disconnect

目前我如何做到这一点是我轮询 USB 设备的屏蔽列表（专门为我正在使用的设备屏蔽），如果它在那里，我继续，如果没有，那么我通知用户设备未连接。获取USB设备列表的方法是通过一个USB外设控制器芯片厂商的.NET库提供给我的。

USB设备断开连接的某处是否有事件？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-12T19:40:40.217

我最终使用了这个：http: [//msdn.microsoft.com/en-us/library/aa363480 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa363480(VS.85).aspx)

并遵循此： http: [//www.codeproject.com/KB/system/DriveDetector.aspx](http://www.codeproject.com/KB/system/DriveDetector.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T15:25:50.203

你检查过 Win32_USBControllerDevice 类吗？ [http://msdn.microsoft.com/en-us/library/aa394505(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa394505(VS.85).aspx)

# mysql - mysql随机生成值

> ID：541771
> 
> 赞同：1
> 
> 时间：2009-02-12T15:21:37.017
> 
> 标签：mysql

我需要生成一个随机的字母/数字，以提供给他们来网站输入的用户。我不太了解随机数等，我知道存在种子问题等，但我不确定它们是什么。

所以，我用了这个：

> 从 users_usr 中选择 substrING(md5(concat_ws('-',md5(username_usr), MD5(zip_usr), MD5(id_usr), MD5(created_usr))),-12)

这安全吗？我使用 concat_ws 因为有时 zip 为空，但其他的从来都不是。

是的，我知道这有点短，但是 1\. 他们必须输入他们社交的最后 4 个，2\. 这是 1 次使用，3\. 应用程序中没有显示私人数据， 4\. 我可以使用验证码，但由于没有私人数据，那可能是矫枉过正。

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T15:25:17.727

也许使用[通用唯一标识符](http://dev.mysql.com/doc/refman/5.0/en/miscellaneous-functions.html#function_uuid)就足够了？只是为了保持简单？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-12T15:29:16.717

如果您需要一个随机的字母数字值，为什么要使用这么多变量？像下面这样的东西应该就足够了：

```
md5(rand())
--Flavor: MySql 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T15:44:41.250

了解“随机”字符串的用途会有所帮助。这不是随机的——它是可重复的——而且相当容易重复。您不会以一种容易逆转的方式暴露任何敏感信息，但我猜您确实在寻找一种生成 UUID（普遍唯一 ID）的方法。并非巧合的是，最近的 MySQL 版本有一个名为 UUID 的函数。

[http://dev.mysql.com/doc/refman/5.0/en/miscellaneous-functions.html#function_uuid](http://dev.mysql.com/doc/refman/5.0/en/miscellaneous-functions.html#function_uuid)

这可能会更好地解决您要解决的问题。如果您出于某种原因真的想要一个随机数（顺便说一句，它肯定会发生冲突），请不要担心播种。如果你不指定种子，它会以一种可能比固定看到的更好的方式自我播种。然后，您将该随机数（或一系列随机数）映射到一个字符（可能通过将整数转换为一个字符），并重复此操作，直到您有一串足够长的字符。但值得重复的是，随机数不是保证唯一的数字......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T15:30:45.263

此问题的已删除副本中有人建议使用`UUID()`，我认为这是个好主意。我不认为使用它们有什么大问题`MD5(RAND())`。

当然，您必须存储那些与您的示例无关的内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-10-19T18:32:30.990

```
>>SELECT md5(RAND()+CURRENT_TIMESTAMP()) 
```

# java - 估计 SVG 或 Java 中比例字体的像素

> ID：541774
> 
> 赞同：2
> 
> 时间：2009-02-12T15:23:33.377
> 
> 标签：java, graphics, fonts, svg, font-size

有没有办法估计比例字体使用的像素数？我正在编写在 SVG 中创建图像并将其转换为 Java 中的 PNG 的软件。在这张图片中，我使用的是具有比例字体（16 号）的文本。我有时可以在图片中放置 26 个字符，有时只能放置 19 个字符。这是因为“WWW”比“li1”占用更多空间。如何估计字符串需要的像素数？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T15:32:11.483

看看[FontMetrics](http://java.sun.com/j2se/1.4.2/docs/api/java/awt/FontMetrics.html)类 - 特别是 stringWidth() 方法。

如果您有`g`用于绘画的图形对象

```
g.getFontMetrics(f).stringWidth(message) 
```

# windows-mobile - 如何在 Windows Mobile 的正在运行的应用程序栏中显示最小化的应用程序？

> ID：541782
> 
> 赞同：1
> 
> 时间：2009-02-12T15:25:19.503
> 
> 标签：windows-mobile

如果我的问题看起来很基本，我是一个初学者，很抱歉。我在网上看过，但没有找到任何东西，所以它一定很简单。

我试图让我的应用程序在最小化时显示在 Windows Mobile 的正在运行的应用程序栏中。我使用 ShowWindow(this.Handle, SW_MINIMIZED); 最小化应用程序；它工作正常，但我的应用程序既没有出现在正在运行的应用程序中，也没有出现在设置\内存\正在运行的程序中。当我单击开始菜单中的应用程序图标时，它会显示应用程序的最后状态，因此我得出结论它确实已最小化并且没有关闭。我还将表单中的图标设置为应用程序图标，但无济于事。

有什么我想念的吗？顺便说一句，我正在使用 CF3.5 和 Winmo 6 pro。谢谢杰里米

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T15:29:15.390

“运行程序”小程序简单地枚举所有顶级窗口的表单文本（它不查看进程）。确保您的 Form 设置了 Text 属性并且它会出现。

# c - wait statement in C-component?

> ID：541784
> 
> 赞同：3
> 
> 时间：2009-02-12T15:25:39.847
> 
> 标签：c, wait

Is there a wait statement in c-component? for example, wait for 0.5 second before continuing the process?

thanks!

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-12T15:28:38.480

In POSIX there is

```
usleep(500); 
```

and

```
nanosleep(...); 
```

have a look at the manual of `usleep(3)` and `nanosleep(2)`. **EDIT**: `nanosleep` seems now to be the way to go, `usleep` is even deprecated in `POSIX.2008` according to its manpage!

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-13T07:43:47.793

总结和纠正 Johannes Weiss 帖子中的一个小问题（非德语键盘，抱歉）：

在老式 POSIX 中，您可以使用 usleep() 函数，该函数接受睡眠的微秒数作为无符号整数参数。因此，要睡半秒钟，你会打电话：

```
#include <unistd.h>
usleep(500000); /* Five hundred thousand microseconds is half a second. */ 
```

对于较新的 POSIX 风格的程序（我的 Gentoo Linux 盒子的手册页说它是 POSIX.1-2001），你会使用 nanosleep()，它需要一个指向保持睡眠周期的结构的指针。睡半秒会是这样的：

```
#include <time.h>
struct timespec t;
t.tv_sec = 0;
t.tv_nsec = 500000000; /* Five hundred million nanoseconds is half a second. */
nanosleep(&t, NULL); /* Ignore remainder. */ 
```

nanosleep() 的第二个参数称为“rem”，如果睡眠被某种方式中断，它会接收剩余的时间。为了简单起见，我将其保留为 NULL，在这里。你可以做一个循环，直到 rem 是（足够接近）零，以确保你真的得到你的睡眠，无论任何中断。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-12T15:31:41.580

For Windows there is this function available in the API

```
Sleep(500); 
```

Have a look at its [MSDN](http://msdn.microsoft.com/en-us/library/ms686298%28VS.85%29.aspx) page. It sleeps for the specified amount of milliseconds.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-13T07:20:45.417

sleep 在 POSIX 中也可用，不同之处在于参数指定进程应该休眠的**秒数**而不是毫秒数。

# wpf - 为什么 RichTextBox 上的 MaxLength 属性在 WPF 中不起作用？

> ID：541786
> 
> 赞同：2
> 
> 时间：2009-02-12T15:25:49.643
> 
> 标签：wpf, properties

我正在尝试`MaxLength`在 a 上设置属性，`RichTextBox`但它似乎不起作用。

任何想法可能会发生什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2018-08-16T12:19:26.933

根本问题是 WPF RichTextBox 没有 MaxLength 属性 - 与 Windows.Forms 不同。

这是对@jhony 的anwser 的改进。如果您捕获 PreviewKeyDown 事件并检查长度，您还需要允许用户在达到限制后按 Delete 和 BackSpace。

```
 // In constructor
    this.RichTextBox.PreviewKeyDown += this.EditBox_KeyDown;

    private void EditBox_KeyDown(object sender, KeyEventArgs e)
    {
        if (e.Key != Key.Delete && e.Key != Key.Back)
        {
            var range = new TextRange(this.RichTextBox.Document.ContentStart, this.RichTextBox.Document.ContentEnd);
            if (range.Text.Length > this.MaxLength)
            {
                e.Handled = true;
                return;
            }
        }
    } 
```

您还应该允许使用箭头键，因为您不希望它们被禁用。

要禁用粘贴，请将其放入构造函数中`DataObject.AddPastingHandler(this.RichTextBox, this.EditBox_Paste);`，然后

```
 private void EditBox_Paste(object sender, DataObjectPastingEventArgs e)
    {
        e.CancelCommand();
    } 
```

但是，您可能希望允许粘贴，除非它破坏了 MaxLength，在这种情况下，您需要检查正在插入的文本以及它要替换的文本。那时我决定不在控件中实现 MaxLength，而是通过表单中的其余验证来处理它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-25T19:53:38.117

在您的 KeyDown 事件中添加此代码。

```
private void rLetter_KeyDown(object sender, KeyEventArgs e)
{
       TextRange tr= new TextRange(rLetter.Document.ContentStart,                                                   rLetter.Document.ContentEnd);
       if (tr.Text.Length > 4000 || e.Key == Key.Space || e.Key == Key.Enter)
       {
           e.Handled = true;
           return;
       }
} 
```

我有一些问题，错误是：

> 使用最多 4000 个复制和粘贴文本来测试此代码。

对不起我的英语不好 ..

# c# - 如果已在下拉列表中选择了 Item，SelectedIndexChanged 事件不会触发？

> ID：541789
> 
> 赞同：3
> 
> 时间：2009-02-12T15:26:02.793
> 
> 标签：c#, asp.net

假设我有一个包含 2 个项目的下拉列表，默认情况下，第一个项目被选中。如果我选择单击下拉列表中的第一项，有没有办法让 SelectedIndexChanged() 事件仍然触发？

我以为我可以通过将下拉列表的 SelectedIndex 设置为 -1 来做到这一点，但这不起作用，因为它不显示当前选择的值，所以会产生误导。

我对此的一个问题是下拉列表用于排序。我有排序半工作，如果我选择第二个项目，它将按升序排序，但是如果我现在想使用第二个项目按降序排序，我必须选择另一个项目然后返回到第二项。

即使我添加了 Select By，我认为排序的最佳解决方案是在下拉列表中添加更多项目，例如：

排序数字（Asc）

排序编号（降序）

排序字母（Asc）

排序字母（降序）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-12T15:32:45.290

不幸的是，没有：只有当用户将选择从一项更改为另一项时，该事件才会触发。

您可以考虑将带有“请选择...”文本的项目添加到列表顶部。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T15:31:44.060

只是出于好奇，您的第一个项目应该是可选项目还是类似于“选择下面的内容”？因为您实际上可以将下拉列表的文本值设置为上述引用，并且它不是可选择的项目，所以无论他们选择什么， selectedindexchanged 总是会首先触发。

否则你将不得不做这样的事情：

```
DropDownList1.Items.Insert(0, "Select an Item")
         DropDownList1.SelectedIndex = 0 
```

绑定控件后。

**编辑添加**

我实际上是用我的下拉菜单来做到这一点的：

```
var a = new AddressesBLL();
        cmbPersonAddress1.DataSource = a.GetAddresses();
        cmbPersonAddress1.DataBind();

        //Set the default text to the below text but don't let it be part of the selections on the drop down.
        cmbPersonAddress1.Text = "Please select an existing address..."; 
```

这不会使“请选择现有地址...”成为可选项目。当您公开 ddl 时，第一个可选项目是第一个地址，因此 selectedindexchanged 将始终触发。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T15:48:38.200

如前所述，添加第一项文本以指导用户从列表中选择一项。

如果您是数据绑定项，您希望在之后插入该项。

```
Dropdownlist1.datasource = whatever
Dropdownlist1.datatextfield = "Something"
dropdownlist1.datavaluefield = "ValueField"
dropdownlist1.databind
dropdownlist1.items.insert(0, "----Select Something!----")
dropdownlist1.selectedindex = 0 
```

然后在您的`SelectedIndexChanged`事件中，您可以通过将所有代码包装在 if 语句中来阻止对第一项的操作：

```
If DropDownList1.SelectedIndex <> 0 then
   Do Your Work
End If 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T16:22:34.017

注意：这是基于问题的更新内容。

假设您有一个下拉列表和一个列表框（dropdownlist1 和 listbox1）

您可以在 page_load 事件中设置初始下拉列表，如下所示：

```
dropdownlist1.items.insert(0, "----Select Sort Method----")
dropdownlist1.items.insert(1, new ListItem("Alphabetic Ascending", "AlphaAsc"))
dropdownlist1.items.insert(2, new ListItem("Alphabetic Descending", "AlphaDesc"))
dropdownlist1.items.insert(3, new ListItem("Numeric Ascending", "NumAsc"))
dropdownlist1.items.insert(4, new ListItem("Numeric Descending", "NumDesc"))
dropdownlist1.selectedindex = 0 
```

然后在您的 dropdownlist1.selectedindexchanged 事件中，您将这样处理它：

```
if dropdownlist1.selectedindex <> 0 then
   select case dropdownlist1.selectedvalue
       case "AlphaAsc"
            Insert Code to Sort ListBox1 Alphabetically in ascending order
       case "AlphaDesc"
            Insert Code to sort ListBox1 Alphabetically in descending order
       case "NumAsc"
            Insert code to sort ListBox1 Numerically in ascending order
       case "NumDesc"
            Insert code to sort ListBox1 Numerically in descending order
   end select
end if 
```

注意：如果您希望在选择项目后立即进行排序，则需要确保将 dropdownlist1 的 AutoPostBack 属性设置为 true。

# jquery - 如何在 jquery 中创建可拖动的表格？

> ID：541793
> 
> 赞同：0
> 
> 时间：2009-02-12T15:26:51.840
> 
> 标签：jquery, html, html-table

我有一个表，其列指示数据项的属性。然后将每个项目放入相应的列中，这意味着某些列可能是空的，当然这些列并不都包含相同数量的元素（或者更确切地说，`n`每列中的最后一个元素是空的，除了具有大多数元素）。

无论如何，我想为用户提供一种将数据项从一列拖到另一列的方法。我猜这可以在jquery中完成。我从未使用过 jquery，但在 Google 和 jquery.com 上都进行了一些搜索，但无法找到任何符合我要求的内容。

我只需要使用普通的 HTML 表格并使其单元格可拖动吗？或者在 JQuery（或插件）中有什么东西可以满足我的要求吗？

编辑：Macka 的回复很有帮助，但并没有完全符合我的要求。是否有允许将表格中的单个单元格从一列移动到另一列的东西？我应该能够仅使用 jQuery UI Draggable 插件来做到这一点吗？如果是这样，我现在无法弄清楚如何......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T15:29:21.227

您应该查看[jQuery UI Draggables](http://docs.jquery.com/UI/Draggables)和[这篇文章](http://www.isocra.com/2008/02/table-drag-and-drop-jquery-plugin/)。

# c# - 需要在使用 TcpClient 的类上实现终结器？

> ID：541797
> 
> 赞同：6
> 
> 时间：2009-02-12T15:27:49.107
> 
> 标签：c#, idisposable, finalizer, unmanagedresources

我有一个`MyClass`使用（作为私有字段）`TcpClient`对象的类（比如说）。`MyClass`实现方法中的`IDisposable`调用。`TcpClient.Close``Dispose`

我的问题是`MyClass`还应该实现一个终结器来调用`Dispose(bool Disposing)`以释放`TcpClient’s`非托管资源，以防`MyClass.Dispose`调用代码不调用它？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T15:31:57.833

**不，你不应该。**

因为**你不应该在终结器中调用其他对象的方法**，所以它可能在你的对象之前被终结。

你的 TcpClient 的终结器将被垃圾收集器调用，所以让他去做吧。

Dispose 中的模式是：

```
protected virtual void Dispose(bool disposing)
{
   if (disposing)
   { 
      // dispose managed resources (here your TcpClient)
   }

   // dispose your unmanaged resources 
   // handles etc using static interop methods.
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T15:36:45.250

不，你不应该。

从[这个](http://blogs.msdn.com/bclteam/archive/2007/10/30/dispose-pattern-and-object-lifetime-brian-grunkemeyer.aspx)优秀的帖子：

> 终结与结束对象的生命周期有着根本的不同。从正确性的角度来看，终结器之间没有顺序（关键终结器的特殊情况除外），因此如果您有两个 GC 认为同时死亡的对象，您无法预测哪个终结器将首先完成。这意味着您不能拥有与存储在实例变量中的任何可终结对象交互的终结器。

这是我对一次性/最终确定模式的参考实现，其中包含解释何时使用什么的注释：

```
/// <summary>
    /// Example of how to implement the dispose pattern.
    /// </summary>
    public class PerfectDisposableClass : IDisposable
    {
        /// <summary>
        /// Type constructor.
        /// </summary>
        public PerfectDisposableClass()
        {
            Console.WriteLine( "Constructing" );    
        }

        /// <summary>
        /// Dispose method, disposes resources and suppresses finalization.
        /// </summary>
        public void Dispose()
        {
            Dispose( true );
            GC.SuppressFinalize(this);
        }

        /// <summary>
        /// Disposes resources used by class.
        /// </summary>
        /// <param name="disposing">
        /// True if called from user code, false if called from finalizer.
        /// When true will also call dispose for any managed objects.
        /// </param>
        protected virtual void Dispose(bool disposing)
        {
            Console.WriteLine( "Dispose(bool disposing) called, disposing = {0}", disposing );

            if (disposing)
            {
                // Call dispose here for any managed objects (use lock if thread safety required), e.g.
                // 
                // if( myManagedObject != null )
                // {
                //     myManagedObject.Dispose();
                //     myManagedObject = null;
                //  }
            }
        }

        /// <summary>
        /// Called by the finalizer.  Note that if <see cref="Dispose()"/> has been called then finalization will 
        /// have been suspended and therefore never called.
        /// </summary>
        /// <remarks>
        /// This is a safety net to ensure that our resources (managed and unmanaged) are cleaned up after usage as
        /// we can guarantee that the finalizer will be called at some point providing <see cref="Dispose()"/> is
        /// not called.
        /// Adding a finalizer, however, IS EXPENSIVE.  So only add if using unmanaged resources (and even then try
        /// and avoid a finalizer by using <see cref="SafeHandle"/>).
        /// </remarks>
        ~PerfectDisposableClass()
        {
            Dispose(false);
        }
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T15:34:22.603

不，你不必。TcpClient 是一个围绕非托管套接字的包装类，因此它以应该被处理的方式进行管理。你所做的就足够了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T15:29:38.323

是的，你应该这样做——[微软甚至推荐它](http://msdn.microsoft.com/en-us/library/b1yfkh5e(VS.71).aspx)。

请记住，腰带和吊带代码永远不会让您在凌晨 2:00 被叫到办公室:)

# java - 如何在 Qt 设计器中使控件自动调整大小？

> ID：541802
> 
> 赞同：1
> 
> 时间：2009-02-12T15:29:12.163
> 
> 标签：java, user-interface, qt, qt-jambi

我正在将 Qt Jambi 4.4 用于我正在处理的项目（并在 Qt Designer eclipse 插件中设计窗口）。我想使用的窗口之一是预览窗口，它基本上只是一个带有 QWebView 的窗口。我怎样才能使 QWebView 像窗口一样调整大小？我已将 sizePolicy 设置为水平和垂直位置的扩展。我还需要做什么？

（还请记住，我是 Java 和 eclipse 的新手，需要在这两个主题上以愚蠢的方式与人交谈）

**更新**

只是为了说明这一点，这里有几个截图（我让窗口背景变亮只是为了说明我的观点）：

[替代文字 http://img13.imageshack.us/img13/2103/screenshot2oi7.jpg](http://img13.imageshack.us/img13/2103/screenshot2oi7.jpg)

[替代文字 http://img152.imageshack.us/img152/6250/screenshot1mz9.jpg](http://img152.imageshack.us/img152/6250/screenshot1mz9.jpg)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T17:38:22.587

我不知道占碑，但使用 Qt Designer 只需将焦点放在背景上，然后从工具栏应用布局。然后主小部件将由该布局管理器调整大小 - 如果您不添加该布局管理器，您将获得小部件调整大小但内容保持在其旧位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T15:45:37.490

我没有使用过 qt-jambi，但如果它是 C++ 或 PyQt 中的 Qt，QWebView 会随着窗口大小的变化而自动调整大小。据我所知，设置大小策略/扩展因子、添加 QSpacerItem 对象等只有在大小调整行为不正常时才需要。只需在预览窗口中使用适当的布局进行布局就足够了。如果我误解了这个问题，请告诉我。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-07T23:05:27.120

您需要将 QWebView 放置在布局中，它会跟随其“容器”中的更改。对于 Qt Designer 使用布局，请参阅[http://doc.trolltech.com/4.5/designer-layouts.html](http://doc.trolltech.com/4.5/designer-layouts.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-02T07:10:08.917

来自 Qt Designer 文档：

> 可以通过清除选择（在表单本身上单击鼠标左键）并应用布局来设置表单的顶级布局。顶层布局是必要的，以确保您的小部件在调整窗口大小时能够正确调整大小。

# sql-server - Best Way To Prepare A Read-Only Database

> ID：541808
> 
> 赞同：3
> 
> 时间：2009-02-12T15:29:42.927
> 
> 标签：sql-server, performance, database-design

We're taking one of our production databases and creating a copy on another server for read-only purposes. The read-only database is on SQL Server 2008\. Once the database is on the new server we'd like to optimize it for read-only use.

One problem is that there are large amounts of allocated space for some of the tables that are unused. Another problem I would anticipate would be fragmentation of the indexes. I'm not sure if table fragmentation is an issue.

What are the issues involved and what's the best way to go about this? Are there stored procedures included with SQL Server that will help? I've tried running DBCC SHRINKDATABASE, but that didn't deallocate the unused space.

EDIT: The exact command I used to shrink the database was

```
DBCC SHRINKDATABASE (dbname, 0)
GO 
```

It ran for a couple hours. When I checked the table space using sp_spaceused, none of the unused space had been deallocated.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T16:50:02.793

您可以做几件事：

首先——不要担心绝对分配的数据库大小，除非你在磁盘上运行不足。

其次——Idera 有很多很酷的 SQL Server 工具，其中之一是对数据库进行碎片整理。 [http://www.idera.com/Content/Show27.aspx](http://www.idera.com/Content/Show27.aspx)

第三——删除和重新创建聚集索引本质上也会对表进行碎片整理——它会重新创建所有非聚集索引（也对它们进行碎片整理）。请注意，这可能会扩大您的数据库的分配大小（再次，不要担心）并且需要很长时间（聚集索引重建很昂贵）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T15:48:31.633

您可能希望考虑的一件事是将数据库的恢复模型更改为简单。如果您不打算对数据库执行任何写入活动，那么您也可以从事务日志的自动截断中受益，并消除使用其他恢复模型的管理开销。如果您对索引进行任何重大的结构更改，您始终可以执行临时备份。

您可能还希望将未使用的表放在一个单独的文件组中，远离将要访问的数据文件。也许考虑将未使用的表放在较低级别的磁盘存储上，以从节省成本中受益。

使用 DBCC SHRINKDATABASE 需要考虑的一些事项，您不能缩小到超出数据库的最小大小。

尝试以下列形式发出声明。

```
DBCC SHRINKDATABASE (DBName, TRUNCATEONLY); 
```

干杯，约翰

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T15:33:35.990

I think it will be OK to just recreate it from the backup.

Putting `tables` and `indexes` on separate physical disks is always of help too. Indexes will be rebuilt from scratch when you recreate them on another filegroup, and therefore won't be fragmented.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T16:27:04.253

MSSQL Server 中有一个用于缩小或截断数据库的工具。我想你选择数据库的属性，你会找到它。这可以在复制备份之前或之后完成。

某些形式的复制也可以按照您的意愿进行。

# c# - InitializeComponent 在两个构造函数中，还是在一个构造函数继承中？

> ID：541816
> 
> 赞同：3
> 
> 时间：2009-02-12T15:32:08.800
> 
> 标签：c#, .net, constructor, initialization, components

在对组件模型的影响方面是否存在任何实际差异：

```
class MyComponent : Component {
    public MyComponent() {
        InitializeComponent();
    }

    public MyComponent(IContainer container) {
        container.Add(this);
        InitializeComponent();
    }
} 
```

和：

```
class MyComponent : Component {
    public MyComponent() {
        InitializeComponent();
    }

    public MyComponent(IContainer container) : this() {
        container.Add(this);
    }
} 
```

如果不是，微软为什么要为他们的设计者生成的代码选择第一种方法？

编辑：我的意思是，在初始化组件和将其添加到容器之间的顺序更改是否会有任何副作用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T15:40:10.560

执行顺序不同。在

```
public MyComponent(IContainer container) {
    container.Add(this);
    InitializeComponent();
} 
```

`InitializeComponent()`*之后* 执行`container.Add()`，而这里

```
public MyComponent(IContainer container) : this() {
    container.Add(this);
} 
```

`container.Add()`之后执行`InitializeComponent()`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T15:40:15.240

我相信两者的调用顺序会有所不同。我相信第二种，首先调用this()，然后调用方法的内容。这意味着 InitializeComponent() 将在 container.Add 之前调用。

虽然这可能不会产生很大的不同，但它仍然是一个不同的地方。

# ms-access - Parsing a web form in to a data table

> ID：541831
> 
> 赞同：1
> 
> 时间：2009-02-12T15:35:03.020
> 
> 标签：ms-access, vba, email

has anyone an idea of how to write a dynamic data parser in VBA to capture data from a text file and input it in to a database table (ms access)? The form has about 55 fields, so I'd rather write a code that is capable of picking up the field name from the text than copying a load of text. Is there a smart way to do this and avoid running a third party app to carry out the task?

The web form (which is output from the Joomla component "PERforms") can also attach an XML file, but this doesn't seem compatible for a straightforward record import in to Access.

The format of the data is as below (I've had to add extra carriage returns in order for it to display across multiple lines.:

Field1 : Test

Field2 : Test 2

Field3 : This is the address

Which is a textarea

on the form

Field4 : Field4

I'm fine getting the data somewhere Access can pick it up from, it's only parsing it that's causing me the problem.

As always, your help is most appreciated.

EDit, as requested :

```
Role Applied For: Door Supervisor
Title: Mr

Full Name: John Smith

SIA DL Badge Number: 01300114000000000

Home Address: Catford Road,Bellingham
London

Home Postcode: SE1 1SE

Nationality: Nigerian

I certify that I am entitled to work within the United Kingdom: Yes

Term Time Address: Sheep St, Bellingham
London

Term Time Postcode: se1 1se

Evening Phone Number: 07222284806

Mobile Number: 07922226206

Email Address: yxs@yahoo.co.uk

Most Recent or Current Employer: Employer.Blah 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T22:53:24.620

你考虑过 FileSystemObject 和 textstream 吗？它需要一点编码，但不是那么多。

如果可以的话，Access 可以导入 HTML 表格。

**编辑参考评论。**

请注意，这是一个粗略的大纲，我没有考虑到最后一个字段超过一行。

```
Sub BuildTable()
'Reference Windows Scripting Host Object Model '
Dim fs As FileSystemObject
Dim f As TextStream
Dim strfile
Dim a, fld, fldlist, strSQL

Set fs = CreateObject("Scripting.FileSystemObject")

strfile = "C:\Docs\TestData.txt"
Set f = fs.OpenTextFile(strfile)

Do While AtEndOfStream <> True
    If f.AtEndOfStream Then Exit Do

    a = f.ReadLine

    'Assumes all lines with colons have a field '
    ' at the start '
    If InStr(a, ":") > 0 Then
        fld = Left(a, InStr(a, ":") - 1)
        fldlist = fldlist & ",[" & fld & "] Text(250)"
    End If
Loop

'Run once'
strSQL = "CREATE TABLE ImportData (" & Mid(fldlist, 2) & ")"

CurrentDb.Execute strSQL
End Sub

Sub FillTable()
'Reference Windows Scripting Host Object Model '
Dim fs As FileSystemObject
Dim f As TextStream
Dim rs As DAO.Recordset
Dim strfile
Dim a, fld, dat, lastfield 

Set rs = CurrentDb.OpenRecordset("ImportData")
lastfield = rs.Fields(rs.Fields.Count - 1).Name

Set fs = CreateObject("Scripting.FileSystemObject")

strfile = "C:\Docs\TestData.txt"
Set f = fs.OpenTextFile(strfile)

rs.AddNew
Do While AtEndOfStream <> True
    If f.AtEndOfStream Then Exit Sub

    a = f.ReadLine

    If InStr(a, ":") > 0 Then
        'field and data, assumes all lines with '
        'a colon have a field '
        'If you have tidied the table, now is a '
        'good time to check that this is a field '
        If fld <> "" Then
            rs(fld) = dat

            fld = ""
            dat = ""

        End If

        fld = Left(a, InStr(a, ":") - 1)
        dat = Mid(a, InStr(a, ":") + 1)
    Else
        If Trim(a) <> "" Then
            dat = dat & a
        End If
    End If

    If InStr(a, lastfield) > 0 Then
        rs(fld) = dat

        fld = ""
        dat = ""

        rs.Update
        rs.AddNew
    End If

Loop
End Sub 
```

# java - 知道任何 Java 垃圾收集日志分析工具吗？

> ID：541832
> 
> 赞同：56
> 
> 时间：2009-02-12T15:35:09.027
> 
> 标签：java, performance, logging, garbage-collection

我正在寻找一种工具或脚本，它将从我的 Web 应用程序中获取控制台日志，解析出垃圾收集信息并以有意义的方式显示它。

我正在使用以下标志启动 Sun Java 1.4.2 JVM：

```
-verbose:gc -XX:+PrintGCTimeStamps -XX:+PrintGCDetails 
```

日志输出如下所示：

```
54.736: [Full GC 54.737: [Tenured: 172798K->18092K(174784K), 2.3792658 secs] 257598K->18092K(259584K), [Perm : 20476K->20476K(20480K)], 2.4715398 secs] 
```

如果我有一个工具可以直观地绘制垃圾收集趋势图，那么理解数百个此类日志条目会容易得多。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-13T10:58:18.933

[gcviewer](http://www.tagtraum.com/gcviewer.html)做你想做的事。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-12T17:26:46.200

IBM 的 GC 工具包完全符合您的要求。

[https://www.ibm.com/developerworks/java/jdk/tools/gcmv/](https://www.ibm.com/developerworks/java/jdk/tools/gcmv/)

我不确定它是否与 Sun JVM 的 GC 日志兼容。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-04-06T15:35:37.580

我认为有些人正在添加 Java 探针，这些探针并不能真正解析垃圾收集日志，因为问题指出......

我尝试过其他人（gcviewer、gchisto、IBM 的），我发现用于分析 GC 日志的最佳工具是[HPjmeter](https://web.archive.org/web/20150907141409/https://h20392.www2.hp.com/portal/swdepot/displayProductInfo.do?productNumber=HPJMETER)

它主要用于 HP-UX JVM，但它通常也可以与 Sun JVM 一起使用并且效果很好。

[![替代文字](https://i.stack.imgur.com/ELnke.jpg)](https://i.stack.imgur.com/ELnke.jpg)
[（来源：[xebia.com](http://blog.xebia.com/wp-content/uploads/2008/09/hpjmeter-gctime.jpg)）]

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2015-12-25T08:00:02.027

我尝试了一个在线工具[http://gceasy.io](http://gceasy.io)，它可以读取我的 sun jdk 1.8 gc 日志。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-02-12T15:47:27.530

比 jconsole 更好的是由 Sun 免费开发和分发的 visualvm [。](https://visualvm.dev.java.net/)它有一个名为[gchisto](https://gchisto.dev.java.net/)的 GC 分析插件，可能会对您有所帮助。

**编辑：**抱歉，我没有看到您的 JDK 1.4.2 要求。在那种情况下，visualvm 不会帮助你，唉。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2012-07-18T08:58:59.977

我发现与 IBM 和 Hotspot JVM 日志一起使用并将它们可视化的最强大的工具是 IBM 的 PMAT： [https ://www.ibm.com/developerworks/mydeveloperworks/groups/service/html/communityview?communityUuid=22d56091- 3a7b-4497-b36e-634b51838e11](https://www.ibm.com/developerworks/mydeveloperworks/groups/service/html/communityview?communityUuid=22d56091-3a7b-4497-b36e-634b51838e11)

我发现它比 IBM Support Assistant 中的工具更快并且提供更多详细信息。它正在不断更新，最后是 12 年 7 月。

但是，使用策略 CMS 解析日志似乎有一些问题，但希望可以修复。

PrintGCStats 也非常好，并且提供了很好的统计数据，但随着时间的推移不能用于可视化，这需要一些工作。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-02-12T15:43:50.193

我使用[YourKit java profiler](http://www.yourkit.com/overview/index.jsp)，它可以让你测量这类事情，以及更多，但使用它自己的格式而不是分析日志。它可以在 Java 5 下做更多的事情，但应该在 1.4 下工作。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-12T15:44:47.273

试试Sun 的[VisualGC](http://java.sun.com/performance/jvmstat/visualgc.html)。JDK 4 和 5 版本可以让您很好地了解 eden、generational 和 perm 空间中正在发生的事情。您需要添加一个 JAR 并获取一个 PID，而 Bob 是您的叔叔。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-07-27T07:39:51.397

几年前，John Coomes（Hotspot GC 小组）发布了 PrintGCStats，这是一个 awk 脚本，用于“汇总有关垃圾收集的统计信息，特别是 gc 暂停时间总计、平均值、最大值和标准偏差。”。该脚本的副本托管在 java.net 上：http: [//java.net/projects/printgcstats](http://java.net/projects/printgcstats)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-12T15:40:34.693

[`jconsole`](http://java.sun.com/developer/technicalArticles/J2SE/jconsole.html)可以帮助你很多，但我认为它仅限于 Java 5 及更高版本。有一次我听到 SUN 的某个人在我们大学发表演讲，他说 Java 6 的垃圾收集器比旧的垃圾收集器要好很多，旧的垃圾收集器几乎一直需要复杂的调优来处理大型应用程序。Java 6 GC 在 SMP 上的扩展性似乎要好得多。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-11-12T07:29:11.613

VisualVM 的 gchisto 插件不起作用[https://gchisto.dev.java.net/](https://gchisto.dev.java.net/)

我有一个包含 jdk1.6 的 printgc 的所有详细信息的文件，但找不到读取该文件的工具。以前使用 jdk1.5 我们使用 HPjmeter 它工作正常，但现在使用 jdk1.6 就不行了

尝试以下： IBM Pattern Modeling and Analysis Tool for Java Garbage Collector - 它无法识别该文件。GCCollector 不起作用，它继续读取文件进行分析。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-12T15:39:07.817

试试 JProbe Freeware（Eclipse 插件）之类的分析工具怎么样。

# windows-mobile - 如何检测移动设备上的 ActiveSync 连接？

> ID：541833
> 
> 赞同：4
> 
> 时间：2009-02-12T15:35:12.397
> 
> 标签：windows-mobile, compact-framework, pinvoke

我在 WindowsCE 5.0 设备上使用 CompactFramework 3.5 来构建一个应用程序，该应用程序应该使用主动同步的连接来获取一些数据。

我如何检测移动设备是否在通讯座中并具有活动连接？是否有某种 PInvoke 调用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T16:32:15.460

取决于您要检测连接的哪一侧。对于桌面端，您可以连接一些 ActiveSync 事件。免费的开源[桌面通信库](http://www.opennetcf.com/FreeSoftware/DesktopCommunication/tabid/90/Default.aspx)可以为您提供这些。

对于设备，有几种方法。对于 WinMo，这很容易 - 您可以通过[Microsoft.WindowsMo​​bile.Status 类](http://msdn.microsoft.com/en-us/library/microsoft.windowsmobile.status.aspx)点击来使用状态和通知代理。

对于通用 CE 设备，您可以使用 NOTIFICATION_EVENT_RS232_DETECTED 标志 P/Invoke [CeRunAppAtEvent](http://msdn.microsoft.com/en-us/library/aa932775.aspx)（它可以设置事件，而不仅仅是运行应用程序）。这些 API 也包含在 OpenNETCF 的[智能设备框架](http://smartdeviceframework.com)中，特别是在[DeviceManagement.SerialDeviceDetected 事件中](http://opennetcf.com/library/sdf/html/cb212764-9260-0ce5-e2a8-9d9c4a23fcda.htm)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2016-01-26T13:57:28.787

您还可以使用以下方法检测通讯座：

```
get
{
  return SystemState.GetValue(SystemProperty.CradlePresent).Equals(1);
} 
```

那么好吧

```
get
        {
            return  (int)SystemState.GetValue(SystemProperty.ConnectionsDesktopCount) > 0;
        } 
```

# iframe - 此页面包含安全和非安全项目和 iframe

> ID：541837
> 
> 赞同：3
> 
> 时间：2009-02-12T15:36:28.743
> 
> 标签：iframe, internet-explorer-6

IE 6.0 给我消息“此页面包含安全和非安全项目”，因为我的页面上有 iframe（针对组合框错误）。我尝试在 src 中指出一些不同的东西，但如果不放入空白 html 页面，我似乎无法摆脱这条消息，我想避免这种情况，因此没有服务器调用。有什么解决办法吗？我想我可以使用空白页并且如果没有其他选择并且应该避免服务器跳闸，那么缓存可能永远不会过期？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T16:30:35.290

如果我将 src 设置为 javascript:false; 有用。我通过检查 yui 库使用什么发现了这一点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-02-09T01:55:43.213

可能有几种方法可以使用 javascript 解决这个问题。该`javascript:false;`方法解决了“此页面包含安全和非安全项目”的问题，但它还会将文本“false”输出到 iframe 中，如果您希望它看起来像一个空的 iframe，这是不可取的。

另一种方法是设置`javascript:'';`解决上述问题的 src 属性。

# css - 如何格式化 Blueprint CSS 中的选项卡？

> ID：541839
> 
> 赞同：0
> 
> 时间：2009-02-12T15:36:43.157
> 
> 标签：css, blueprint-css

我在下面插入了一张图片，显示了我目前的立场（css 版本）和我想要的位置（基于表格的版本）。

我最初用表格创建了这个布局，我想转移到基于 css 的版本。我还有很长的路要走。

我正在使用蓝图 CSS。

目前的问题：

*   我想摆脱的标签之间有一个间隙。我如何摆脱这个差距？
*   我想在每个选项卡中添加更多填充。如何在不将标签推到下一行的情况下执行此操作？

![https://lh3.ggpht.com/_wyoBVbEFXVg/SZRAGMj-ocI/AAAAAAAAAqw/O6T987pw6Dw/cssVsTable.gif](https://lh3.ggpht.com/_wyoBVbEFXVg/SZRAGMj-ocI/AAAAAAAAAqw/O6T987pw6Dw/cssVsTable.gif)

```
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Heatmap using BluePrint</title>
    <!-- Framework CSS -->
    <link rel="stylesheet" href="/heatmap/styles/blueprint/screen.css" type="text/css"
        media="screen, projection">
    <link rel="stylesheet" href="/heatmap/styles/blueprint/print.css" type="text/css"
        media="print">
    <!--[if IE]><link rel="stylesheet" href="/heatmap/styles/blueprint/ie.css" type="text/css" media="screen, projection"><![endif]-->
    <style type="text/css">

    body{font-size:70%;font-family:Verdana, "Helvetica Neue", Arial, Helvetica, sans-serif;padding:5px;}    
    table.heatmap td {border: 1px solid black;}
    table.heatmap{border-collapse:collapse;}

    a {color:black;text-decoration: none;}
    a:hover {text-decoration: underline;}

    .list-as-tabs
    {
        margin-left:0px;
    }
    .list-as-tabs, .list-as-tabs li
    {
        display: inline;

    }

    .hover-links
    {
        background-color:#fffdbf;
    }
    .hover-links li a:hover
    {
        background-color:yellow;    
    }    
    table.heatmap tr td {text-align:center;}

    </style>
</head>
<body>

    <div class="container">
        <div class="span-20">
            <div class="prepend-5 span-10">
                <h3>
                    Issuer Heatmap</h3>
            </div>
            <div class="span-5 last">
                <ul class="list-as-tabs">
                    <li><a href="javascript:popUp('legend.htm')">Legend</a></li>
                    <li><a href="http://localhost/heatmap/default.aspx?level=heatmap&feedback=true"><img src="/heatmap/images/lightbulb.gif" alt="Send Feedback about Heatmap." /></a></li>
                    <li><input type="image" src="/heatmap/images/excel-mini.gif" alt="Export Heatmap to Excel." /></li>
                    <li><a href="print.aspx" target="_blank"><img src="/heatmap/images/printer.gif" alt="Print this page." /></a></li>
                </ul>
            </div>
            <div class="prepend-5 span-15 last">
                <ul class="list-as-tabs hover-links">
                    <li><a href="#">View Draft Heatmap</a></li>
                    <li><a href="#">Manage Security</a></li>
                    <li><a href="#">Edit Heatmap and Platforms</a></li>
                    <li><a href="#">View Revision History</a></li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T21:15:47.913

您发布的屏幕截图中的选项卡之间没有间隙。

至于向选项卡添加填充，您可以这样做：

```
.list-as-tabs li a {
    padding: 3px 5px;
} 
```

这给出了 3px 的链接顶部和底部填充以及 5px 的左右填充。这很好，因为它为您提供了更大的点击目标。

您说您不想换行，但从我在屏幕截图中可以看出，根本没有足够的空间。您要么必须使字体更小，要么对选项卡使用较短的短语。也许这个？

```
<ul class="list-as-tabs hover-links">
    <li><a href="#">Draft Heatmap</a></li>
    <li><a href="#">Security</a></li>
    <li><a href="#">Edit Heatmap/Platforms</a></li>
    <li><a href="#">Revision History</a></li>
</ul> 
```

# spring - Spring JavaMailSenderImpl：在哪里设置字符集？

> ID：541846
> 
> 赞同：2
> 
> 时间：2009-02-12T15:39:12.887
> 
> 标签：spring, websphere, jakarta-mail

如果您使用 Spring JavaMailSenderImpl，您在哪里定义发送邮件的字符集？

我们将 Spring JavaMailSenderImpl 与从 Websphere Application Server 6.1 获得的邮件会话一起使用。奇怪的是，在使用相同代码的不同系统上，用于发送电子邮件的字符集是不同的。我正在寻找一种方法来覆盖默认值。

更新：我们不允许更改系统属性。因此，我正在寻找一种方法来在代码或部署描述符、webshpere meail 会话设置或其他任何内容中指定使用的字符集。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-13T18:56:43.810

JavaMailSenderImpl 有一个名为 javaMailProperties 的属性，它是一个 Properties 对象；您可以在那里传递带有 mail.mime.charset 的 Properties 对象，因此它仅适用于您的 JavaMailSenderImpl，而不是系统范围的属性：

```
<bean id="javaMailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
    <property name="host" value="bla" />
    <property name="用户名" value="用户" />
    <property name="password" value="pass" />
    <property name="javaMailProperties"><props>
        <prop key="mail.smtp.auth">真</prop>
        <prop key="mail.smtp.connectiontimeout">5000</prop>
        <prop key="mail.smtp.sendpartial">真</prop>
        <prop key="mail.smtp.userset">true</prop>
        <prop key="mail.mime.charset">ISO-8859-1</prop>
    </props></property>
</豆>

```

# internet-explorer - 在 Internet Explorer 6 中使用透明 PNG 的最佳解决方案是什么？

> ID：541847
> 
> 赞同：3
> 
> 时间：2009-02-12T15:39:50.530
> 
> 标签：internet-explorer, png, internet-explorer-6

IE6 中缺乏适当的 PNG 支持是一个众所周知的问题，有多种解决方案。似乎没有明确的最佳实践或方法。

你认为最好的解决方案是什么，为什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T15:46:33.960

1) 消除对 alpha 透明度的需求

失败了

2）那些绝对必要的Javascript。 [SuperSleight](http://24ways.org/2007/supersleight-transparent-png-in-ie6)是一种选择，但有许多 javascript 实现。

3）贬低IE6或为IE6用户提供单独的CSS

谢天谢地，IE6 正在下降，所以选项 3 现在实际上是合理的。

-亚当

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-28T15:22:08.360

我找到的最好的解决方案是[Unit PNG fix](http://labs.unitinteractive.com/unitpngfix.php)。它体积小、速度快，并且消除了其他解决方案中发现的大部分问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T15:54:22.617

例如，您可以使用 IrfanView 将 *.png 转换为 *.gif。但由于 GIF 格式只能显示 256 种颜色，因此通常会导致质量损失和色阶：(

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T16:04:18.693

您可以使用[pngfix.js](http://homepage.ntlworld.com/bobosola/pnghowto.htm)之类的东西将适当的过滤器应用于 IE6 中的 PNG。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T16:05:17.020

任何解决方案都涉及使用 DirectX AlphaImageLoader

我最喜欢[Twinhelix](http://www.twinhelix.com/css/iepngfix/demo/)解决方案

和[版本 2.0](http://www.twinhelix.com/test/)，仍然没有经过彻底的测试，似乎也适用于背景 PNG。

你不能忽视 IE 6.0，因为它在浏览器市场的份额仍然超过 20%。GIF 透明度低于标准。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-12T16:14:10.557

使用 PNG-8 实现透明度，因为它适用于 IE6。它会像 IE6 下的 GIF 图像一样工作，同时它允许在功能更强大的浏览器中使用 alpha 透明度。

# vim - Latex 的 VIM 中需要哪些插件？

> ID：541848
> 
> 赞同：13
> 
> 时间：2009-02-12T15:40:00.297
> 
> 标签：vim, latex

你最喜欢 VIM 中哪些用于 Latex 编辑的插件？Latex 是否有一些现成的 VIM 变体？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-13T08:04:10.693

实际上，我认为 Vim 包含的默认支持`filetype=tex`已经相当不错了。所以严格来说，不需要插件。

但是，我确实推荐了一些设置，您可以从中挑选并适应自己的口味。请参阅帮助以了解每个命令/设置的作用。

```
setlocal iskeyword+=:,-
setlocal makeprg=pdflatex\ -file-line-error\ -interaction=nonstopmode\ %

inoremap <buffer> { {}<ESC>i
inoremap <buffer> [ []<ESC>i

iab <buffer> ,b \begin{
iab <buffer> ,e \end{
" More abbreviations... 
```

您可以将它们放入`~/.vim/ftplugin/tex.vim`为每个`tex`文件加载它们。以下是我保留的一些全局设置`~/.vimrc`：

```
let g:tex_flavor = "latex"
set suffixes+=.log,.aux,.bbl,.blg,.idx,.ilg,.ind,.out,.pdf 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-12T15:42:14.860

#1： 来自[http://vim-latex.sourceforge.net](http://vim-latex.sourceforge.net)[的 VIM LaTeX 套件](http://vim-latex.sourceforge.net)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-12T15:41:37.203

从[这里](http://www.vim.org/scripts/script_search_results.php?keywords=latex&script_type=&order_by=rating&direction=descending&search=search)选择，取决于您打算做什么。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-12T15:41:29.137

您可能需要 LaTex Suite。见[这里](http://www.vim.org/scripts/script.php?script_id=475)。

**编辑：**我忘了将链接添加到他们的网页，这是[在这里](http://vim-latex.sourceforge.net/)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-17T00:32:08.730

除了上面提到的之外，我建议尝试“live-latex-preview”（[链接](https://github.com/ying17zi/vim-live-latex-preview)）。它有助于在编辑时预览文档。虽然实时预览功能只适用于短文档，但它确实让实验变得更有趣......

# nhibernate - Can I tell if a property is dirty using nhibernate?

> ID：541864
> 
> 赞同：30
> 
> 时间：2009-02-12T15:42:31.927
> 
> 标签：nhibernate

Does anyone know if it is possible to tell if a specific property on an object is dirty (i.e. the property is different to the one stored on the DB) using NHibernate?

The background to this question is that I will have an object with a (relatively) large number of properties on it. I need to be able to pass a parameter (string) to a function that will determine if that specific property has changed during the lifetime of the page.

If I need to I can create a copy of the object and use reflection at the end of the page lifecycle to check the value, but I am reluctant to do this. It would be great if NHibernate could simply tell me if a property was dirty.

Thanks

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T17:13:57.370

这目前无法通过 nHibernate（或 Hibnernate，AFAIK）API 获得。您可以通过在将对象加载到会话时存储对象的状态来自己编写类似的内容，然后比较它们。

注意：我自己没有看到这个，但是，如果你还没有锁定 ORM 选择，你应该看看 Subsonic。许多脏状态在对象本身中被跟踪，您可以确定特定属性是否脏。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2021-01-05T13:07:07.233

可以通过手动检查属性来检查**属性**`IPersistenceContext`是否脏。我从未尝试过，所以我无法提供确切的代码。您可以参考`GetEntityEntryFromPersistenceContext`以下代码示例中的方法并编写自己的代码来执行此操作。

您可以轻松检查整个**实体**是否脏。您可以使用以下实用程序类来了解实体的各种状态，包括脏状态。

```
public static class NHibernateUtil
{
    public static bool IsDirtyEntity<TEntity>(ISession session, TEntity instance) where TEntity : class
    {
        if(IsPersistentEntity(session, instance, true) == false)
        {
            throw new NhBoilerplateException("This is not a persistent entity.");
        }

        ISessionImplementor sessionImpl = session.GetSessionImplementation();
        IPersistenceContext persistenceContext = sessionImpl.PersistenceContext;
        EntityEntry oldEntry = sessionImpl.PersistenceContext.GetEntry(instance);

        if((oldEntry == null) && (instance is INHibernateProxy))
        {
            INHibernateProxy proxy = instance as INHibernateProxy;
            object obj = sessionImpl.PersistenceContext.Unproxy(proxy);
            oldEntry = sessionImpl.PersistenceContext.GetEntry(obj);
        }

        string className = NHibernateProxyHelper.GuessClass(instance).FullName;
        IEntityPersister persister = sessionImpl.Factory.GetEntityPersister(className);
        object[] oldState = oldEntry.LoadedState;
        object[] currentState = persister.GetPropertyValues(instance);
        int[] dirtyProps = persister.FindDirty(currentState, oldState, instance, sessionImpl);

        return (dirtyProps != null);
    }

    public static bool IsProxyEntity<TEntity>(TEntity instance) where TEntity : class
    {
        if((instance is INHibernateProxy) == false)
            return false;
        else
            return true;
    }

    public static bool IsPersistentEntity<TEntity>(ISession session, TEntity instance, bool validateProxy) where TEntity : class
    {
        EntityEntry oldEntry = GetEntityEntryFromPersistenceContext(session, instance);

        if(oldEntry != null)
            return true;

        if(validateProxy == false)
            return false;

        if(IsProxyEntity(instance) == true)
            return true;
        else
            return false;
    }

    public static EntityEntry GetEntityEntryFromPersistenceContext<TEntity>(ISession session, TEntity instance) where TEntity : class
    {
        ISessionImplementor sessionImpl = session.GetSessionImplementation();
        IPersistenceContext persistenceContext = sessionImpl.PersistenceContext;
        EntityEntry oldEntry = persistenceContext.GetEntry(instance);
        return oldEntry;
    }
} 
```

# c# - Wpf style resource for foreground color of selected listbox item

> ID：541866
> 
> 赞同：3
> 
> 时间：2009-02-12T15:42:54.063
> 
> 标签：c#, wpf, listboxitem

Background: I am creating a custom listbox that has radio buttons on each listbox item, so essentially it will be a RadioButtonList. The control is created entirely in code. As of right now the control renders and behaves correctly and supports 2 orientations (Horizontal/Vertical). The listbox uses an ItemTemplate that is a StackPanel with a RadioButton and a TextBlock.

So far I have been able to prevent the background color of the item from changing when the item is selected by using a style that sets it's background to transparent.

**I would like to also do the same for the foreground color.**

Basically, the Selection mode of the ListBox is single, and when an item is selected, I only want it to be reflected by the RadioButton.

I am using the following code to set the ItemContainerStyle:

```
System.Windows.Style style =  
    new System.Windows.Style(typeof(System.Windows.Controls.ListBoxItem));  

System.Windows.Media.SolidColorBrush brush =  
    new System.Windows.Media.SolidColorBrush(System.Windows.Media.Colors.Transparent);  

style.Resources.Add(System.Windows.SystemColors.HighlightBrushKey, brush); 
```

The TextBlock of my template is created using a System.Windows.FactoryFrameworkElement like this:

```
System.Windows.FrameworkElementFactory factoryTextBlock =   
    new System.Windows.FrameworkElementFactory(typeof(System.Windows.Controls.TextBlock));
factoryTextBlock.SetBinding(System.Windows.Controls.TextBlock.TextProperty, new System.Windows.Data.Binding("Description"));  
factoryStackPanel.AppendChild(factoryTextBlock); 
```

The FactoryTextBox is then appended to the FactoryStackPanel and is set as the ItemTemplate of the ListBox.

At the moment, I have the background color being set to Transparent when the item is selected. Since the text gets set to white by default, it visually disappears when the item is selected. I am looking for a way to set a color on the foreground of the textblock when it's selected. For now it can be black, but eventually it will reference a font color at a higher level.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-13T17:25:15.633

这是一个使用 XAML 的示例，我将把转换为 C# 的工作留给您：

```
<Grid xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:sys="clr-namespace:System;assembly=mscorlib"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid.Resources>
        <x:Array x:Key="data" Type="{x:Type sys:String}">
            <sys:String>sphinx</sys:String>
            <sys:String>of</sys:String>
            <sys:String>black</sys:String>
            <sys:String>quartz</sys:String>
        </x:Array>
    </Grid.Resources>
    <ListBox ItemsSource="{StaticResource data}">
        <ListBox.Resources>
            <Style TargetType="{x:Type ListBoxItem}">
                <Style.Triggers>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Foreground" Value="Pink"/>
                    </Trigger>
                </Style.Triggers>
            </Style>
        </ListBox.Resources>
    </ListBox>
</Grid> 
```

# javascript - 在 onsubmit 中确定哪个元素提交了表单

> ID：541869
> 
> 赞同：11
> 
> 时间：2009-02-12T15:43:34.500
> 
> 标签：javascript, html, dhtml

有没有办法确定哪个元素从 onsubmit 处理程序中提交了表单？尝试编写一个知道单击了哪个元素的通用处理程序。例如，给定这种形式：

```
<form onsubmit="onSubmitHandler">
    <input type="submit" name="submit1" />
    <input type="submit" name="submit2" />
</form> 
```

如何在 onSubmitHandler 内部确定单击了哪个提交按钮？我尝试了 event.target/event.srcElement，但这给出了表单，而不是实际的提交按钮。

**更新：我在这里写一个通用控件，所以它不知道表单上有什么。该解决方案需要在不知道和更改表单的 html 的情况下工作。我的后备是遍历 DOM 以查找所有可能导致提交的按钮，但我想避免这种情况。**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T16:18:50.810

另一种解决方案是将事件触发器从表单的提交事件移动到提交元素的 onclick 事件，如下所示：

```
<form name='form1'>  
    <input type="submit" name="submit1" onclick="onSubmitHandler"/>
    <input type="submit" name="submit2" onclick="onSubmitHandler"/>
</form> 
```

在您的处理程序函数中，您可以简单地通过检查事件目标的名称来确定提交元素，如果您需要访问表单的信息或其他元素，您可以从提交元素的“表单”属性中获取。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T16:45:13.493

我不会使用标准的提交按钮类型。

让提交函数接受一个额外的参数来表示提交它的元素，并且按钮将有一个 onclick`this`作为参数发送：

```
<input type="button" onclick="submitHandler(this)"> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T16:54:33.220

> 我的后备是遍历 DOM 以查找所有可能导致提交的按钮，但我想避免这种情况。

...并向它们添加单击侦听器以存储“最后单击”按钮，然后由提交侦听器读取，对吗？

我想不出别的办法了，抱歉。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-12T17:04:01.827

此解决方案适用于 Firefox。我还没有在其他兼容的浏览器或 IE 中检查它。
我对 IE 不太抱有希望，你必须研究它并发布你的结果。

```
<form id="myForm">
    <input type="submit">
    <input type="submit">
</form> 
```

_

```
document.getElementById('myForm').addEventListener( 'submit', function( e ){
    e.preventDefault();
    e.explicitOriginalTarget.style.background = 'red';
}, false ); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-05-11T18:37:42.467

单击事件冒泡，因此您可以向表单本身添加一个“onclick”侦听器，以检查单击目标源是否是提交按钮；如果是这样，请将它的引用存储在与您可以从 onsubmit 处理程序访问的表单相关联的地方。

如果您也想正确处理“Enter”提交的表单，请监听表单的“onkeypress”或“onkeydown”事件，检查“Enter”，如果事件目标不是提交按钮，则清除提交按钮信息.

# project-management - 如果不能降低流失率，是否可以管理流失率高的开发商？

> ID：541870
> 
> 赞同：2
> 
> 时间：2009-02-12T15:43:39.833
> 
> 标签：project-management

我在大学环境中领导一小群程序员，去年刚进入这个职位。虽然我们团队的大多数人都是全职员工，但我们有几个人传统上是研究生助理。

这些助学金的竞争相当激烈，因为他们在工作期间除了薪水之外还能获得免费的研究生学费。我们要求他们至少注册一年，但如果他们能留下两年，我们认为自己很幸运。在那之后，他们获得了硕士学位并继续做更大更好的事情。

正如您可以想象的那样，雇用和重新培训这些职位是时间和资源密集型的。更糟糕的是，到目前为止，他们通常是各自项目的唯一开发人员，而我则担任咨询和监督角色，因此当我们从开发人员切换到开发人员时，与项目本身争吵以对抗熵是一项任务对自己。

我很想向管理员提出聘请全职（和长期）开发人员来取代这两个职位的可能性，但是对于一所处于预算危机中的学校来说，支付两个兼职研究生助理的费用要便宜得多（在工资和福利方面）比支付一名全职开发人员。另外，由于我是这个职位的新手，我想避免看起来好像我无法处理我注册的内容。在可预见的未来，我认为聘用短期研究生助理的做法不会改变。

我的问题：**考虑到员工在工作中可能会被解雇一年，我能做些什么来创建一个有效的培训计划？**

*   我应该投入多少时间来培训他们，而多少时间只是浪费时间？
*   他们应该花多少时间来接受我们的流程和项目？
*   是否有任何特定的培训实践或技术可以帮助解决这种情况？
*   有没有人处理过类似的情况？
*   我是担心太多，还是担心不够？

顺便说一下，我们在 Perl 中完成了绝大多数开发工作。很难找到了解 Perl 的研究生，而另一方面，似乎每个人都至少对 Java 有学术上的了解。因此，我不久前提出了[这个问题。](https://stackoverflow.com/questions/141641/what-constitutes-effective-perl-training-for-non-perl-developers)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T16:12:59.700

你为什么不问学生他们觉得困难的地方，并为他们有困难的部分工作做备忘单、讲座等呢？也许您需要创建一些 Perl 介绍性讲座或购买一些枯树。在 O'Reilly 订阅 Safari 怎么样？不过，在开始培训项目之前，我会问学生他们更喜欢如何学习。每个人都有不同的学习方式。

我还会花一些时间和资金在工作中创造一种专业软件开发的文化。这会很艰难，因为学术程序员通常是新手并且习惯于拼凑解决方案（顺便说一句，我是一名学术程序员），但从长远来看，学生们会感谢你。也许你们都可以每周出去吃一次午餐，讨论编程和其他话题。您可能还想花一些时间进行代码审查，以便人们可以互相学习。

在高流动率的情况下，您肯定需要确保发生知识转移。确保您使用源代码控制并且您的学生理解正确的注释。我还会让学生为后代创建简短的文档。如果他们获得了学分，让他们每学期提交一次进度记录。您可以将它放在项目存储库中的目录中，供任何继承它的人使用。正如其他帖子中提到的，群组 wiki 可以真正帮助知识转移。我们在我们的小组中使用 Mediawiki，并且非常喜欢它。

我应该补充的最后一件事是，我发现为新开发人员保留一个相对容易并且可以在一个月左右完成的项目列表很有帮助。它们是新人适应您的开发环境的好方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T16:04:55.540

1.  这是一个相对的问题，应该根据具体情况来考虑。如果新员工已经了解 Perl，那么您就不需要接受这部分培训（是的，您可以将 Perl 作为强制性先决条件，但这会极大地限制您的申请者数量），他们的第一部分培训应该是例如修复现有应用程序中的错误或引导他们浏览他们将维护的应用程序。不过，鉴于开发人员只在那里呆了一年，这让我认为开发风格会有所不同（如果不是很多的话）。
2.  只要您的流程*有效*，让新人跟上您的流程非常重要。在这种高流动率的环境中，您应该非常重视流程中的文档。Wiki 对本文档来说是一件很棒的事情，因为它是集中的，任何开发人员都可以访问它。让他们尝试自己弄清楚项目是如何工作的（几乎没有文档）是浪费他们的时间和你的时间。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-13T05:58:24.460

您是否考虑过像麦当劳和许多其他高周转率行业一样制作“三环活页夹”？准备一个文件夹，您可以将其打印出来并交给新员工，其中向新员工展示了在您的环境中启动和运行 Perl 的一些基础知识。这应该是一个“hello world”，加上一些基本的正则表达式和数组操作。最后，你的手册应该继续展示你发现自己一直在做的 5 件事的例子。

示例代码可能是针对外部安全系统对用户进行身份验证、遍历记录集或使用 ghostscript 创建 PDF。不管它们是什么，它们都应该涵盖你在 80% 的时间里遇到的基本问题。更重要的是，这些示例应该向用户展示您希望如何编写代码以保持清晰（例如：命名和方法），并让他们了解正在使用的服务器和软件以及通用书籍不会向他们展示的其他实用性。

您不会第一次就做好活页夹，但由于您的员工流动率很高，您将有足够的时间来测试和改进它。

除此之外，我会选择一本 Perl 编程书，并给新用户他们自己的三环活页夹副本，加上“Programming Perl”以保留他们的第一天。每次租用 50 美元的成本，我敢肯定它比替代品便宜很多，而且你会让他们翻转汉堡......我的意思是立即削减代码。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-13T06:08:59.940

也许我对这个问题读得太多了，但是如果你的大学教 java，你为什么要使用 Perl？使用学生已经知道的工具不是更有意义吗？仅此一项就可以显着缩短学习曲线。[当然，一旦你消除了遗留代码]

除此之外，请尝试：

*   将项目分成一个月大小的小块
*   将实习至少重叠 2 个月，如果不是 6 个月，这样新人就可以与老家伙一起工作并接受老家伙的培训
*   记录您拥有的任何可重复的过程（正如 Mark Nold 所建议的）
*   如果研究生比全职专业人士便宜，那就别抱怨了；-) 如果没有，那就去找专业人士。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-12T15:52:48.987

我最初的几个想法是你应该：

1.  雇用该职位，即它以 Perl 为中心，因此将其作为先决条件的重要组成部分。这样你也不需要那种训练。
2.  在入职过程中投入时间，也许可以使用 wiki，以便您可以轻松更新它以帮助他们入职。

**编辑：**一些额外的点：

1.  也许可以聊一聊，看看是否可以将 Perl 引入课程？如果没有，那么在广告发布前 6 个月告知申请人需要了解 Perl。通过这种方式，您将获得具有 Perl 经验并积极展示其积极性的人。
2.  你能打开一些小项目，让潜在的候选人在这六个月内完成吗？
3.  接近您的大型项目的设计，以便它们可以以零碎的方式完成。这就是[ACE 组件](http://www.cs.wustl.edu/~schmidt/ACE.html)是如何完成 iirc 的。
4.  留出一段特定的时间来记录和审查即将离任的研究生所做的工作。
5.  允许至少几周的重叠期，新的研究生可以与即将离开的研究生一起工作。他们可以学习开发环境，并且可以成为对您的 wiki 进行任何更新的试验品。

还有更多...

高温高压

干杯

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-12T15:57:35.167

这是一个泡菜，但它在商业领域并不像你想象的那么罕见。我曾经听说过一个统计数据，整个行业程序员的平均任期约为 18-24 个月。通常情况下，我会建议让更有经验的程序员需要更少的启动时间，并且只需要接受问题领域/技术更新而不是基础知识的培训

我认为你最好的选择是要求比实际执行工作所需的研究生多 30-50%，以考虑学习和加速时间，并投资一些额外的资源进行测试，因为这种环境是错误的秘诀，因为每个人都在工作中学习。此外，考虑到学术安排，这可能很困难，但尽量错开开始日期，以最大限度地增加员工之间的重叠。新员工/老员工的结对编程团队也可能有助于提高一致性并在不牺牲太多生产力的情况下补充培训。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-13T17:42:45.077

*   我应该投入多少时间来培训他们，而多少时间只是浪费时间？ **答：**这不是时间量或浪费量，而是方法。是否可以进行视频培训 - 视频自己培训一​​个人并将其作为后续学生/开发人员的培训。您可以随着时间的推移添加，但它确实会减少您完成相同过程所需的时间。

*   他们应该花多少时间来接受我们的流程和项目？ **答案：**这完全取决于人......分钟。一天最多 2-3 周我猜平均。

*   是否有任何特定的培训实践或技术可以帮助解决这种情况？ **答：**视频培训（自制），让当前的学生/开发人员创建/更新所需信息、兴趣点等的 wiki。

*   有没有人处理过类似的情况？ **答**：过去是 12-18 个月的平均值。营业额 - 我想现在它已经改变了（更长），但是每个公司都有营业额，但由于资源是学生，可能不像你那样被迫。

*   我是担心太多，还是担心不够？ **回答：**因转型而丢失的知识是一个关键的风险领域......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-17T13:44:09.427

您可以考虑将应用程序开源吗？

# vb.net - 在 vb.net 的列表框中限制选择

> ID：541883
> 
> 赞同：3
> 
> 时间：2009-02-12T15:45:54.027
> 
> 标签：vb.net, listbox, selection, web-controls

我正在 vb.net 中创建一个包含列表框的 Web 控件。我知道我可以选择单一或多重选择模式，但我有兴趣将多重选择限制为预定大小。例如，防止用户选择超过 3 个项目。

我尝试将验证器添加到列表框中，这可能是一种前进的方式，但想知道是否有一种方法可以将选择模式更改为与仅指定的两个不同的东西。

任何想法或建议将不胜感激

编辑：不幸的是，由于项目限制，我无法在这个问题上使用 Javascript。我知道很烦人！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T15:48:57.200

您可以尝试处理 SelectedIndexChange 事件之一。通过多项选择，每次触发此事件时，您都可以检查已经选择了多少项目。如果超出您的要求，请让处理程序取消选择刚刚选择的那个。您还可以在列表框下方放置一个红色的小标签，上面写着“抱歉，最多允许 [n] 个选择”。

编辑：刚刚注意到你说 WEB。同样的理论也适用，但必须使用 Javascript 来完成。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T15:52:01.937

在 SelectedIndexChanged 事件上，编写一小段代码来检查所选项目的数量，如果它大于您所需的数量，则取消选择新的选择（或取消选择最旧的选择，或者您希望这样操作）。

# asp.net-mvc - PDF 预览和查看

> ID：541891
> 
> 赞同：6
> 
> 时间：2009-02-12T15:48:12.617
> 
> 标签：asp.net-mvc, visual-studio-2008, pdf, image, asp.net-3.5

我正在创建一个文档查看 Web 应用程序。您登录，它会将您带到一个屏幕，您的所有文档都列在左侧。我想这样做，以便当您翻阅文档时，文档的预览会显示在右侧。从那里您可以单击它以查看完整视图和打印功能。我不是在问如何做所有这些，但我想知道渲染文档预览的最佳方法是什么。这些文档都将是 pdf 并存储在服务器上。我在 Visual Studios 2008 的 asp.net 3.5 mvc 中工作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-15T07:29:11.013

要创建 PDF 预览，请先查看 StackOverflow 上有关该主题的其他一些讨论：

*   [如何预览文件？](https://stackoverflow.com/questions/175528/how-can-i-take-preview-of-documents)
*   [在 Windows 上获取 pdf 的预览 jpeg？](https://stackoverflow.com/questions/502/get-a-preview-jpeg-of-a-pdf-on-windows)

如果这些不能回答你的问题，你可以尝试更多的事情：

*   您可以获得商业渲染器（[PDFViewForNet](http://www.o2sol.com/pdfview4net/overview.htm)、[PDFRasterizer.NET](http://tallcomponents.com/default.aspx?id=pdfrasterizer2)、[ABCPDF](http://www.websupergoo.com/abcpdf-1.htm)、[ActivePDF](http://www.activepdf.com/)，...）。
    不过，大多数都相当昂贵，尤其是如果您只关心制作缩略图的话。
*   有一篇[CodeProject 文章](http://www.codeproject.com/KB/GDI-plus/pdfthumbnail.aspx)展示了如何使用 Adob​​e ActiveX，但它可能已经过时，很容易被新版本破坏，并且其合法性是模糊的。
*   在服务器上安装 GhostScript 并从中请求任何页面的渲染缩略图。
    我做了一个小项目，你可以在[Developer Express 论坛上](http://community.devexpress.com/forums/p/55582/188207.aspx#188207)找到它作为附件。
    请注意 GhostScript 的许可证要求。
    我将它用于内部软件，并且运行良好。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-15T05:54:27.200

[在这里](http://www.asiep.org/Statistiche/) ，我在上传文件时渲染 pdf 文档第一页的 jpeg 缩略图。当用户点击时，他可以下载文档（或直接在浏览器中打开）来阅读和打印它们。

更新：为了创建缩略图，我使用了来自[O2Solutions的名为 PDFView4NET 的 .net 组件](http://www.pdf4net.com/)

# .net - 连接字符串而不是使用一堆 TextBlocks

> ID：541896
> 
> 赞同：96
> 
> 时间：2009-02-12T15:48:38.170
> 
> 标签：.net, wpf, datatemplate

我想在 WPF ItemsControl 中显示客户对象的列表。我为此创建了一个 DataTemplate：

```
 <DataTemplate DataType="{x:Type myNameSpace:Customer}">
        <StackPanel Orientation="Horizontal" Margin="10">
            <CheckBox"></CheckBox>
            <TextBlock Text="{Binding Path=Number}"></TextBlock>
            <TextBlock Text=" - "></TextBlock>
            <TextBlock Text="{Binding Path=Name}"></TextBlock>
        </StackPanel>
    </DataTemplate> 
```

所以我想要的基本上是一个简单的列表（带有复选框），其中包含 NUMBER - NAME。有没有一种方法可以直接在 Binding 部分中连接数字和名称？

* * *

## 回答 #1

> 赞同：185
> 
> 时间：2009-02-12T16:06:58.187

您可能可以使用 StringFormat 属性（在 .NET 3.5 SP1 中）。有用的 WPF 绑定备忘单可以在[这里](http://www.nbdtech.com/blog/archive/2009/02/02/wpf-xaml-data-binding-cheat-sheet.aspx)找到。如果它没有帮助，您总是可以为您的对象编写自己的 ValueConverter 或自定义属性。

刚刚检查过，您可以将 StringFormat 与多重绑定一起使用。在您的情况下，代码将是这样的：

```
<TextBlock>
  <TextBlock.Text>
    <MultiBinding StringFormat=" {0} - {1}">
        <Binding Path="Number"/>
        <Binding Path="Name"/>
    </MultiBinding>
  </TextBlock.Text>
</TextBlock> 
```

我必须用空格开始格式化字符串，否则 Visual Studio 将无法构建，但我认为你会找到解决它的方法 :)

**编辑**
StringFormat 中需要空间以防止解析器将`{0}`其视为实际绑定。其他选择：

```
<!-- use a space before the first format -->
<MultiBinding StringFormat=" {0} - {1}">

<!-- escape the formats -->
<MultiBinding StringFormat="\{0\} - \{1\}">

<!-- use {} before the first format -->
<MultiBinding StringFormat="{}{0} - {1}"> 
```

* * *

## 回答 #2

> 赞同：75
> 
> 时间：2013-02-28T13:46:48.913

如果您想将动态值与静态文本连接，请尝试以下操作：

```
<TextBlock Text="{Binding IndividualSSN, StringFormat= '\{0\} (SSN)'}"/> 
```

**显示器**: 234-334-5566 (SSN)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2014-02-02T10:33:30.573

请参阅我在代码中使用 Run 类的以下示例：

```
 <TextBlock x:Name="..." Width="..." Height="..."
            <Run Text="Area="/>
            <Run Text="{Binding ...}"/>
            <Run Text="sq.mm"/>
            <LineBreak/>
            <Run Text="Min Diameter="/>
            <Run Text="{Binding...}"/>
            <LineBreak/>
            <Run Text="Max Diameter="/>
            <Run Text="{Binding...}"/>
        </TextBlock > 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-12T16:50:42.030

您还可以使用可绑定的运行。有用的东西，特别是如果想添加一些文本格式（颜色、字体粗细等）。

```
<TextBlock>
   <something:BindableRun BoundText="{Binding Number}"/>
   <Run Text=" - "/>
   <something:BindableRun BoundText="{Binding Name}"/>
</TextBlock> 
```

[这是](http://fortes.com/2007/03/bindablerun/)一个原始类：
[这里](http://code.logos.com/blog/2008/01/data_binding_in_a_flowdocument.html)有一些额外的改进。
这一切都在一段代码中：

```
public class BindableRun : Run
    {
        public static readonly DependencyProperty BoundTextProperty = DependencyProperty.Register("BoundText", typeof(string), typeof(BindableRun), new PropertyMetadata(new PropertyChangedCallback(BindableRun.onBoundTextChanged)));

        private static void onBoundTextChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
        {
            ((Run)d).Text = (string)e.NewValue;
        }

        public String BoundText
        {
            get { return (string)GetValue(BoundTextProperty); }
            set { SetValue(BoundTextProperty, value); }
        }

        public BindableRun()
            : base()
        {
            Binding b = new Binding("DataContext");
            b.RelativeSource = new RelativeSource(RelativeSourceMode.FindAncestor, typeof(FrameworkElement), 1);
            this.SetBinding(DataContextProperty, b);
        }
    } 
```

# .net - 来自流的 XML XSL 转换

> ID：541900
> 
> 赞同：1
> 
> 时间：2009-02-12T15:48:48.933
> 
> 标签：.net, xml, xslt

您好我有一个内存流，我在其中使用 XMLTextWriter 写出一些 XML。我想要做的是使用 XSL.transform 功能转换这个 XML。问题是我不想创建临时文件。XML 文件，我想以某种方式使用流将其转换为 XSL。感谢您的任何建议。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T15:56:39.053

只需使用 XmlReader 并将其传递给 Transform 方法。您需要先寻找到流的开头。

```
 stream.Seek(0, SeekOrigin.Begin);
  XmlReader reader = XmlReader.Create(stream, settings);
  XslCompiledTransform transform = new XslCompiledTransform();
  transform.Load(...load your transform...);
  transform.Transform(reader, resultsWriter); 
```

我显然在这里删除了某些元素以简化代码，但您应该明白这一点。

# c# - 如何优化这段代码？

> ID：541903
> 
> 赞同：3
> 
> 时间：2009-02-12T15:49:18.400
> 
> 标签：c#, optimization

当然必须有很多方法来优化以下代码，我基本上必须确保很多文本框不为空，然后读取它们的值：

```
if (foo1.Text.Length != 0 & bar1.Text.Length != 0)
{
    output.Text += myStrings[i] + " / " + foo1.Text + " / " + bar1.Text;
}

if (foo2.Text.Length != 0 & bar2.Text.Length != 0)
{
    output.Text += myStrings[i] + " / " + foo2.Text + " / " + bar2.Text;
}

if (foo3.Text.Length != 0 & bar3.Text.Length != 0)
{
    output.Text += myStrings[i] + " / " + foo3.Text + " / " + bar3.Text;
}

if (foo4.Text.Length != 0 & bar4.Text.Length != 0)
{
    output.Text += myStrings[i] + " / " + foo4.Text + " / " + bar4.Text;
}

if (foo5.Text.Length != 0 & bar5.Text.Length != 0) 
{
    output.Text += myStrings[i] + " / " + foo5.Text + " / " + bar5.Text;
}

if (foo6.Text.Length != 0 & bar6.Text.Length != 0)
    output.Text += myStrings[i] + " / " + foo6.Text + " / " + bar6.Text;

if (foo7.Text.Length != 0 & bar7.Text.Length != 0)
{
    output.Text += myStrings[i] + " / " + foo7.Text + " / " + bar7.Text;
}

if (foo8.Text.Length != 0 & bar8.Text.Length != 0)
{
    output.Text += myStrings[i] + " / " + foo8.Text + " / " + bar8.Text;
}

if (foo9.Text.Length != 0 & bar9.Text.Length != 0)
{
    output.Text += myStrings[i] + " / " + foo9.Text + " / " + bar9.Text;
}

if (foo10.Text.Length != 0 & bar10.Text.Length != 0)
{
    output.Text += myStrings[i] + " / " + foo10.Text + " / " + bar10.Text;
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-12T15:54:04.630

我会将重复的元素放入数组中，然后循环遍历它们。

```
TextBox[] foos = new TextBox[] { foo1, foo2, foo3, /* etc */ };
TextBox[] bars = new TextBox[] { bar1, bar2, bar3, /* etc */ };

for (int i = 0; i <= 10; i++)
    if (foos[i].Text.Length != 0 && bars[i].Text.Length != 0)
        output.Text += myStrings[i] + "/" + foos[i].Text + bars[i].Text; 
```

当然，如果元素确实是按顺序命名的，您可以通过从表单的 Controls 集合中查找控件来填充数组，名称为“foo”+ number.ToString()。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-12T15:51:28.613

我将遍历这些 TextBox 所在的 Controls 集合，然后仅在 TextBox 上进行过滤，然后进行检查和连接。

我也强烈建议使用 StringBuilder 而不是 +=。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-12T16:01:19.510

有很多方法可以重构它。您选择的方法将取决于您的特定场景和需求。

1.  创建一个以 foo 和 bar 作为参数并返回字符串的函数，然后在字符串生成器中聚合该字符串
2.  将 foos 和 bar 放入集合并遍历这些集合。在这种情况下，数组将很有用，并提供了一种相互索引数组的方法。
3.  将第 2 项更进一步，创建一个新类 FooBar，它将 foo 和 bar 放在一起。通过这种方式，您可以创建 FooBars 的集合，并且它们之间不再存在隐式关联，现在它是显式且经过编码的。
4.  将第 3 项更进一步，并认识到您正在聚合一个字符串。如果您使用的是最新版本的 c#，请利用 LINQ (.Select().Aggregate()) 中的 Map/Reduce 将您的 FooBar 转换为相应的字符串，然后将字符串聚合到输出中。

这只是我头顶上的东西。如果你在这方面工作更多，我相信你可以做得更好。:)

（如果这是作业，请添加作业标签。）

编辑：

根据您在另一篇文章中的评论，我不禁想知道一般 UI 的设计，该评论指出将字符串连接在一起需要“很多秒”。10 个字符串本身的时间相当微不足道，但这表明您的外部循环（即生成`i`）运行时间相当长。

If you're in a position where you have the freedom to make such decisions, are you certain that your UI is actually good for the task at hand? A large collection of pairs of text boxes is a difficult user interface in general. Perhaps a `ListView` would be more appropriate. It would implicitly contain a collection, so you wouldn't have to deal with this "ten text boxes" silliness and will be an easier UI for your users to follow in general.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T15:58:00.237

编写一个接受 foo & bar 类型的函数。将所有 foo1 和 bar1 传递给 foo10 和 bar10 给函数以获取值。您还可以创建 foo 和 bar 的数组，并且可以循环并调用该方法来获取字符串。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T15:59:14.757

```
 foreach (Control ctrl in Page.Controls) {
      if (ctrl is TextBox) {
          if (ctrl.Text.Length != 0) {
              output.Text += myStrings[i] + "/" + ctrl.Text;
           }
      }
 } 
```

未经测试，但应该可以工作。有了这个，你的文本框可以被命名为任何东西。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-12T15:53:24.740

你能把 foo1-foo10 变成一个数组，foo[10]，和 bar 一样吗？这将允许您将其表达为一个简单的循环。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-12T15:54:09.637

制作一个具有名为 foo 和 bar 的文本框并且具有如下功能的 WebControl 是否可行：

```
if (foo.Text.Length != 0 & bar.Text.Length != 0)
    return myStrings[i] + " / " + foo.Text + " / " + bar.Text;
else
    return string.Empty; 
```

将其中的十个放在您的页面上，然后使用：

```
output.Text = myControl1.FooBar + myControl2.FooBar + myControl3.FooBar + ... 
```

（仍然有点混乱，但不是那么重复。）

# winforms - 将自定义可序列化对象绑定到控件，以便用户和加载/保存首选项

> ID：541909
> 
> 赞同：0
> 
> 时间：2009-02-12T15:51:13.513
> 
> 标签：winforms, data-binding, c#-3.0, object

好的，因此放弃了使用内置 .NET 配置系统来保存/加载有关每个用户的自定义对象的数据，我已经转向使用可序列化对象。而且，更进一步，我想将它绑定到我的应用程序选项窗口中的控件。

请原谅这个问题的长度，因为它有一些代码块......

一、父对象：

```
[Serializable]
public class ConnectionSettings
{
    public List<Connection> Connections { get; set; }

    public ConnectionSettings()
    {
        Connections = new List<Connection>();
    }
} 
```

因为将保存多个连接，所以我认为这将是存储它们的最简单方法。

Connection 对象的一块：

```
[Serializable]
public class Connection : NotifyBase
{
    private string hostName;
    [DisplayName( "Host Name" )]
    public string HostName
    {
        get { return hostName; }
        set { SetField( ref hostName, value, "HostName" ); }
    }

    /* Other field snipped for your sanity,*/
    /* same format as host name */

    public List<string> Channels { get; set; }

    public Connection()
    {
        Channels = new List<string>();
    }
} 
```

对于表单外观的一般概念：我有一个组合框，它将显示所有已保存连接的主机名，当用户选择主机名时，它将使用它们各自的值填充表单上的其他字段。我意识到这不应该那么难，但由于某种原因，我无法让组合框部分工作，而且我想得越多，我不确定如果我知道如何知道要填充哪个特定连接其他控件...

*更多信息* 问题是，我不确定如何绑定需要绑定的所有内容。我打算离开这个[例子](https://stackoverflow.com/questions/348022/whats-the-way-to-implement-save-load-functionality/348904#348904)。我希望能够为反序列化的 ConnectionSettings （来自文件）中的每个 Connection 对象在组合框中显示主机名，当您选择主机名时，它会填写其余的相关数据到窗体上的其他控件。

非常感谢任何帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-12T16:55:15.200

好吧，我想我已经想通了。我将 ConnectionSettings 更改为继承 List，它似乎工作正常。

# java - Java中的接口命名

> ID：541912
> 
> 赞同：351
> 
> 时间：2009-02-12T15:51:33.090
> 
> 标签：java, interface, naming-conventions

大多数 OO 语言在它们的接口名称前加上大写的 I，为什么 Java 不这样做？不遵守该公约的理由是什么？

为了说明我的意思，如果我想要一个用户界面和一个用户实现，我在 Java 中有两个选择：

> 1.  类 = 用户，接口 = UserInterface
> 2.  类 = UserImpl，接口 = 用户

在大多数语言中：

> 类 = 用户，接口 = IUser

现在，您可能会争辩说，您总是可以为用户实现选择一个最具描述性的名称，问题就消失了，但是 Java 正在推动一种 POJO 方法，并且大多数 IOC 容器都广泛使用 DynamicProxies。这两件事加在一起意味着您将拥有许多带有单个 POJO 实现的接口。

所以，我想我的问题可以归结为：**“是否值得遵循更广泛的接口命名约定，尤其是考虑到 Java 框架的发展方向？”**

* * *

## 回答 #1

> 赞同：355
> 
> 时间：2009-02-12T16:23:43.700

我不喜欢在接口上使用前缀：

*   前缀会损害可读性。

*   在客户端中使用接口是标准的最佳编程方式，因此接口名称应该尽可能简短和愉快。实现类应该更难看以阻止它们的使用。

*   当从抽象类更改为接口时，带有前缀 I 的编码约定意味着重命名该类的所有出现 --- 不好！

* * *

## 回答 #2

> 赞同：129
> 
> 时间：2009-02-12T16:05:12.717

真的有区别吗：

```
class User implements IUser 
```

和

```
class UserImpl implements User 
```

如果我们谈论的只是命名约定？

就我个人而言，我不喜欢在接口之前使用，`I`因为我想对接口进行编码，并且我认为*这*在命名约定方面更为重要。如果您调用接口`IUser`，那么该类的每个使用者都需要知道它的一个`IUser`. 如果您调用该类`UserImpl`，那么只有该类和您的 DI 容器知道该`Impl`部分，而消费者只知道他们正在使用`User`.

再说一次，`Impl`由于没有更好的名称本身而被迫使用的时间很少，因为实现是*根据*实现命名的，因为这很重要，例如

```
class DbBasedAccountDAO implements AccountDAO
class InMemoryAccountDAO implements AccountDAO 
```

* * *

## 回答 #3

> 赞同：81
> 
> 时间：2009-02-12T16:17:16.523

Java 通常不使用 IUser 约定可能有几个原因。

1.  面向对象方法的一部分是您不必知道客户端使用的是接口还是实现类。因此，即使 List 是一个接口而 String 是一个实际的类，也可能会同时传递一个方法——从视觉上区分接口是没有意义的。

2.  一般来说，我们实际上更喜欢在客户端代码中使用接口（例如，更喜欢 List 而不是 ArrayList）。因此，将接口作为异常突出是没有意义的。

3.  Java 命名约定更喜欢具有实际含义的较长名称，而不是匈牙利风格的前缀。这样代码将尽可能具有可读性：List 代表一个列表，而 User 代表一个用户，而不是 IUser。

* * *

## 回答 #4

> 赞同：77
> 
> 时间：2009-02-12T16:15:07.247

还有另一个约定，被包括 Spring 在内的许多开源项目使用。

```
interface User {
}

class DefaultUser implements User {
}

class AnotherClassOfUser implements User {
} 
```

我个人不喜欢“I”前缀，原因很简单，因为它是一个可选的约定。所以如果我采用这个，IIOPConnection 是否意味着 IOPConnection 的接口？如果该类没有“I”前缀怎么办，那么我是否知道它不是接口……这里的答案是否定的，因为并不总是遵循约定，并且对它们进行监管将创建更多约定本身节省​​的工作。

* * *

## 回答 #5

> 赞同：51
> 
> 时间：2010-05-25T03:44:48.273

正如另一位海报所说，通常最好让接口定义功能而不是类型。我倾向于不“实现”诸如“用户”之类的东西，这就是为什么“IUser”通常在此处描述的方式中并不是真正必要的。我经常将类视为名词，将接口视为形容词：

```
class Number implements Comparable{...}  
class MyThread implements Runnable{...}
class SessionData implements Serializable{....} 
```

有时形容词没有意义，但我通常仍会使用接口来建模行为、动作、能力、属性等……而不是类型。

另外，如果您真的只打算创建一个用户并将其称为用户，那么还有一个 IUser 接口有什么意义呢？如果您将有几种不同类型的用户需要实现一个通用接口，那么在接口上附加一个“I”可以节省您选择实现名称的时间吗？

我认为更现实的例子是某些类型的用户需要能够登录到特定的 API。我们可以定义一个 Login 接口，然后有一个带有 SuperUser、DefaultUser、AdminUser、AdministrativeContact 等子类的“User”父类，其中一些将或不会根据需要实现 Login（Loginable？）接口。

* * *

## 回答 #6

> 赞同：44
> 
> 时间：2009-02-12T16:18:11.123

Bob Lee 在一次演讲中说过：

> 如果您只有一个实现，那么接口的意义何在。

因此，您从一种实现开始，即没有接口。后来你决定，好吧，这里需要一个接口，所以你将你的类转换为接口。

那么它就变得很明显了：你原来的类被称为用户。您的界面现在称为用户。也许你有一个 UserProdImpl 和一个 UserTestImpl。如果您的应用程序设计得很好，那么每个类（除了那些实例化用户的类）都将保持不变，并且不会注意到它们突然传递了一个接口。

所以很清楚->接口用户实现UserImpl。

* * *

## 回答 #7

> 赞同：25
> 
> 时间：2009-02-12T16:26:07.173

在 C# 中是

```
public class AdminForumUser : UserBase, IUser 
```

Java会说

```
public class AdminForumUser extends User implements ForumUserInterface 
```

正因为如此，我不认为约定在 java 中对于接口来说几乎同样重要，因为继承和接口实现之间存在明显的区别。我想说只要选择任何你想要的命名约定，只要你是一致的并使用一些东西来向人们展示这些是接口。几年没做java了，但是所有接口都在自己的目录中，这就是惯例。从来没有真正遇到过任何问题。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-02-12T16:06:46.643

根据我的经验，“I”约定适用于旨在为类提供契约的接口，特别是当接口本身不是类的抽象概念时。

例如，在您的情况下，我只希望查看`IUser`您打算拥有的唯一用户是否是`User`. 如果您计划拥有不同类型的用户 - `NoviceUser`、`ExpertUser`等 - 我希望看到一个`User`接口（也许还有一个`AbstractUser`实现一些常见功能的类，例如`get/setName()`）。

我还希望定义功能的接口 - `Comparable`,`Iterable`等 - 以这样的方式命名，而不是像`IComparable`or `IIterable`。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-02-12T22:18:41.927

遵循良好的 OO 原则，您的代码应该（就实际/可能而言）依赖于抽象而不是具体类。例如，通常最好写一个这样的方法：

```
public void doSomething(Collection someStuff) {
    ...
} 
```

比这个：

```
public void doSomething(Vector someStuff) {
    ...
} 
```

如果你遵循这个想法，那么我坚持认为，如果你给接口命名为“User”和“BankAccount”（例如），而不是“IUser”、“UserInterface”或其他变体，你的代码将更具可读性。

唯一应该关心实际具体类的代码是构建具体类的地方。其他一切都应该使用接口编写。

如果你这样做，那么像“UserImpl”这样“丑陋”的具体类名应该从其余代码中安全地隐藏起来，这可以愉快地继续使用“漂亮”的接口名称。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2011-06-13T20:57:43.427

=v= Wicket 框架中也使用了“I”前缀，我很快就习惯了。一般来说，我欢迎任何缩短繁琐 Java 类名的约定。但是，在目录和 Javadoc 中，所有内容都按字母顺序排列在“I”下，这很麻烦。

Wicket 编码实践与 Swing 类似，因为许多控件/小部件实例被构造为具有内联方法声明的匿名内部类。令人讨厌的是，它与 Swing 有 180° 的不同，因为 Swing 对实现类使用前缀（“J”）。

“Impl”后缀是一个很糟糕的缩写，不能很好地国际化。如果我们至少使用“Imp”，它会更可爱（而且更短）。“Impl”用于 IOC，尤其是 Spring，所以我们现在有点坚持使用它。不过，在一个代码库的三个不同部分遵循 3 种不同的约定，它有点分裂。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-12T17:57:25.287

这是一个真正意义上的更广泛的命名约定吗？我更偏向于 C++ 方面，而不是真正了解 Java 和后代。有多少语言社区使用 I 约定？

如果您在此处有独立于语言的商店标准命名约定，请使用它。如果没有，请使用语言命名约定。

# sql - 如何应用目录中的所有 sql 文件？

> ID：541919
> 
> 赞同：3
> 
> 时间：2009-02-12T15:52:40.560
> 
> 标签：sql, ant

我们目前在 Ant 部署过程中运行一个特定的 SQL 脚本。

我们想做的是改变它，以便我们在给定目录中运行所有 SQL 脚本。我们无法弄清楚如何在 Ant 中获取此目录列表并遍历该列表并运行每个 SQL 脚本。有谁知道如何做到这一点？

注意：我们目前使用运行“ ”的Ant`exec`任务运行sql文件`call sqlplus ${id}/${pw}@${db.instance} @${file}`

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-12T16:25:34.443

我会推荐使用 Ant[`SQL`任务](http://ant.apache.org/manual/Tasks/sql.html)。然后，您可以指定以下内容：

```
<sql
    driver="org.database.jdbcDriver"
    url="jdbc:database-url"
    userid="sa"
    password="pass">
  <path>
    <fileset dir=".">
      <include name="data*.sql"/>
    </fileset>
  <path>
</sql> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-07-25T01:57:48.533

我在 oracle 数据库上做基本相同的事情.. 但使用 sqlplus 和应用任务。这允许脚本包含 DDL 语句。

显然只有在你有一个命令行程序可以使用的情况下才能工作。使用 ant 1.8.2 和 antcontrib。

我已经定义了一些宏供使用..（见下文），然后像这样调用

```
<compile_sql connectstring="${db.connect_string}"  >
        <filelist dir="${db_proc.dir}" files="specific_file.sql" />
        <fileset dir="${db_proc.dir}" includes="wildcard*.pks" />
        <fileset dir="${db_proc.dir}" includes="wildcard*.pkb" />
</compile_sql> 
```

宏如下

```
<macrodef name="compile_sql">
    <attribute name="connectstring" />
    <attribute name="dirtostart" default=""/>
    <attribute name="arg1" default=""/>
    <element name="sqllist" implicit="true" description="filesetlist of sql to run"/>
    <sequential>
        <check_missing_files>
            <sqllist/>
        </check_missing_files>
        <apply executable="${sqlplus.exe}"  failonerror="true" verbose="true" skipemptyfilesets="true" ignoremissing="false" dir="@{dirtostart}">
            <arg value="-L"/>
            <arg value="@{connectstring}"/>
            <srcfile prefix="@" />
            <sqllist/>
            <arg value="@{arg1}"/>
            <redirector>
            <globmapper id="sqlout.mapper" 
               from="*"
               to="*.out"/>
            </redirector>
        </apply>

    </sequential>
</macrodef> 
```

和

```
<macrodef name="check_missing_files">
    <element name="checkfilelist" implicit="true" description="filelist of files to check for existance"/>
    <sequential>
    <restrict id="missing.files" xmlns:rsel="antlib:org.apache.tools.ant.types.resources.selectors">
        <resources>
            <checkfilelist/>
        </resources>
        <rsel:not>
            <rsel:exists/>
        </rsel:not>
    </restrict>
    <fail message="These files are missing: ${ant.refid:missing.files}"  >
        <condition >
            <length string="${ant.refid:missing.files}" when="greater" length="0" />
        </condition>
    </fail>
    </sequential>
</macrodef> 
```

# java - Javadoc 注释中的多行代码示例

> ID：541920
> 
> 赞同：578
> 
> 时间：2009-02-12T15:52:42.620
> 
> 标签：java, html, javadoc

我有一个小代码示例，我想将其包含在方法的 Javadoc 注释中。

```
/**
 * -- ex: looping through List of Map objects --
 * <code>
 * for (int i = 0; i < list.size(); i++) {
 *      Map map = (Map)list.get(i);
 *      System.out.println(map.get("wordID"));
 *      System.out.println(map.get("word"));
 * }
 * </code>
 * 
 * @param query - select statement
 * @return List of Map objects
 */ 
```

问题是代码示例显示在 Javadoc 中，没有换行符，因此难以阅读。

```
-- ex: looping through List of Map objects -- for (int i = 0; i list.size(); i++) { Map map = (Map)list.get(i); System.out.println(map.get("wordID")); System.out.println(map.get("word")); } 
Parameters
query - - select statement 
Returns:
List of Map objects 
```

我想我假设代码标签会处理换行符是错误的。在 Javadoc 注释中格式化代码示例的最佳方式是什么？

* * *

## 回答 #1

> 赞同：808
> 
> 时间：2009-02-12T16:26:42.633

除了已经提到的`<pre>`标签之外，您还应该使用`@code`JavaDoc 注释，当涉及到 HTML 实体问题（尤其是泛型）时，这将使生活变得更加轻松，例如：

```
* <pre>
* {@code
* Set<String> s;
* System.out.println(s);
* }
* </pre> 
```

将给出正确的 HTML 输出：

```
Set<String> s;
System.out.println(s); 
```

省略`@code`块（或使用`<code>`标签）将导致 HTML 如下所示：

```
Set s;
System.out.println(s); 
```

[作为参考，可以在此处](https://docs.oracle.com/javase/8/docs/technotes/tools/unix/javadoc.html#CHDJGIJB)找到 Java SE 8 中可用的标记描述的完整列表。

* * *

## 回答 #2

> 赞同：180
> 
> 时间：2012-11-22T12:13:56.307

在 javadoc 注释中包含特定代码示例时，我遇到了非常艰难的时期。我想分享这个。
请注意以下事项：

*   使用 old `<code>`- 标签来防止大括号被解释
*   使用“new” `{@code ...}`- 标记以获取包含在输出中的泛型
*   `@Override`通过“ ”转义 @ 登录，`{@literal @}Override`因为 javadoc 生成器“倾斜”在那里，因为 @ 直接在左大括号之后
*   `{@code`删除and前面的一个空格`{@literal`，以补偿内部空格并保持对齐

javadoc代码：

```
/** this methods adds a specific translator from one type to another type. `
  * i.e.
  * <pre>
  * <code>new BeanTranslator.Builder()
  *   .translate(
  *     new{@code Translator<String, Integer>}(String.class, Integer.class){
  *      {@literal @}Override
  *       public Integer translate(String instance) {
  *         return Integer.valueOf(instance);
  *       }})
  *   .build();
  * </code>
  * </pre>
  * @param translator
  */ 
```

打印为

```
new BeanTranslator.Builder()
  .translate(
    new Translator<String, Integer>(String.class, Integer.class){
      @Override
      public Integer translate(String instance) {
        return Integer.valueOf(instance);
      }})
  .build(); 
```

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2009-02-12T15:59:31.247

java 源代码有很多很好的例子。这是“String.java”头部的一个例子：

```
....
 * is equivalent to:
 * <p><blockquote><pre>
 *     char data[] = {'a', 'b', 'c'};
 *     String str = new String(data);
 * </pre></blockquote><p>
 * Here are some more examples of how strings can be used:
 * <p><blockquote><pre>
 *     System.out.println("abc");
 *     String cde = "cde";
 *     System.out.println("abc" + cde);
 *     String c = "abc".substring(2,3);
 *     String d = cde.substring(1, 2);
 * </pre></blockquote>
... 
```

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2009-02-12T15:56:51.720

用标签括起来你的多行代码`<pre></pre>`。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2011-08-04T12:35:47.850

您需要`<pre></pre>`用于换行符的标签，以及`{@code ... }`用于泛型的标签。但是不允许将左大括号与`<generic>`标签放在同一行，因为这样所有内容都将再次显示在 1 行。

一行显示：

```
* ..
* <pre>
* {@code
* public List<Object> getObjects() {
*    return objects;
* }
* </pre>
* .. 
```

带有换行符的显示：

```
* ..
* <pre>
* {@code
* public List<Object> getObjects() 
* {
*    return objects;
* }
* </pre>
* .. 
```

另一个奇怪的事情是，当您粘贴 的右大括号时`{@code`，它会显示：

```
* ..
* <pre>
* {@code
*   public List<Object> getObjects() 
*   {
*     return objects;
*   }
* }
* </pre>
* .. 
```

输出：

```
public List<Object> getObjects() 
{
   return objects;
}
} 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2014-03-05T10:14:01.967

```
/**
 * <blockquote><pre>
 * {@code
 * public Foo(final Class<?> klass) {
 *     super();
 *     this.klass = klass;
 * }
 * }
 * </pre></blockquote>
 **/ 
```

*   `<pre/>`是保留行所必需的。
*   `{@code`必须有自己的线路
*   `<blockquote/>`只是为了缩进。

```
public Foo(final Class<?> klass) {
    super();
    this.klass = klass;
} 
```

* * *

**使用 JDK8 更新**

正确代码的最低要求是`<pre/>`和`{@code}`。

```
/**
 * test.
 *
 * <pre>{@code
 * <T> void test(Class<? super T> type) {
 *     System.out.printf("hello, world\n");
 * }
 * }</pre>
 */ 
```

产量

```
 <T> void test(Class<? super T> type) {
     System.out.printf("hello, world\n");
 } 
```

并且可选的周围`<blockquote/>`插入一个缩进。

```
/**
 * test.
 *
 * <blockquote><pre>{@code
 * <T> void test(Class<? super T> type) {
 *     System.out.printf("hello, world\n");
 * }
 * }</pre></blockquote>
 */ 
```

产量

```
 <T> void test(Class<? super T> type) {
         System.out.printf("hello, world\n");
     } 
```

插入`<p>`或包围`<p>`并`</p>`产生警告。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2018-08-24T10:33:22.057

这是我的两分钱。

正如其他答案已经说明的那样，您应该**`<pre>` `</pre>`**与**`{@code` `}`**.

### 使用`pre`和`{@code}`

*   把你的代码包裹在里面`<pre>`，`</pre>`防止你的代码折叠成一行；
*   将您的代码包装在内部`{@code` `}`可以防止`<`,`>`以及介于两者之间的所有内容消失。当您的代码包含泛型或 lambda 表达式时，这特别有用。

**注释问题**

当您的代码块包含注释时，可能会出现问题。这可能是因为当`@`符号出现在 Javadoc 行的开头时，它被认为是一个 Javadoc 标记，如`@param`or `@return`。例如，此代码可能会被错误地解析：

```
/**
 * Example usage:
 *
 * <pre>{@code
 * @Override
 * public void someOverriddenMethod() { 
```

在我的情况下，上面的代码将完全消失。

要解决此问题，该行不得以`@`符号开头：

```
/**
 * Example usage:
 *
 * <pre>{@code  @Override
 * public int someMethod() {
 *     return 13 + 37;
 * }
 * }</pre>
 */ 
```

`@code`请注意，和之间有两个空格`@Override`，以保持与下一行对齐。在我的情况下（使用 Apache Netbeans）它被正确呈现。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2013-02-21T15:26:37.790

我能够使用代码 1 中显示的以下片段生成好看的 HTML 文件。

```
 * <pre>
 * {@code
 * A-->B
 *  \
 *   C-->D
 *    \   \
 *     G   E-->F
 * }
 *</pre> 
```

（代码 1）

正如预期的那样，代码 1 变成了图 1 中生成的 javadoc HTML 页面。

```
A-->B
 \
  C-->D
   \   \
    G   E-->F 
```

（图。1）

但是，在 NetBeans 7.2 中，如果您按 Alt+Shift+F（重新格式化当前文件），代码 1 会变成代码 2。

```
 * <
 * pre>
 * {@code
 * A-->B
 *  \
 *   C-->D
 *    \   \
 *     G   E-->F
 * }
 * </pre> 
```

（代码 2）

第一个`<pre>`现在被分成两条线。代码 2 生成生成的 javadoc HTML 文件，如图 2 所示。

```
< pre> A-->B \ C-->D \ \ G E-->F 
```

（图2）

Steve B 的建议（代码 3）似乎给出了最好的结果，并且即使在按下 Alt+Shift+F 后仍按预期格式化。

```
*<p><blockquote><pre>         
* A-->B
*  \
*   C-->D
*    \   \
*     G   E-->F
* </pre></blockquote> 
```

（代码 3）

使用 Code 3 会产生相同的 javadoc HTML 输出，如图 1 所示。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-07-19T09:24:47.633

和之间有一个显着的区别`<blockquote><pre>...`，`<pre>{@code....`前者将省略泛型中的类型声明，但后者将保留它。

`E.g.: List<MyClass> myObject = null;``List myObject = null;`与第一个和`List<MyClass> myObject = null;`第二个一样 显示

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-03-10T10:43:08.420

[我只是在这里](http://docs.oracle.com/javase/1.5.0/docs/tooldocs/windows/javadoc.html#%7B@code%7D)阅读了 Javadoc 1.5 参考，只有带有`<`和的代码`>`必须包含在里面`{@code ...}`。这里有一个简单的例子：

```
 /** 
 * Bla bla bla, for example:
 *
 * <pre>
 * void X() {
 *    List{@code <String>} a = ...;
 *    ...
 * }
 * </pre>
 *
 * @param ...
 * @return ...
 */
 .... your code then goes here ... 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2021-05-12T23:32:26.390

其他两种解决方案的组合似乎很完美：

```
* <pre>{@code
*     {@literal @}Override
*     public void someMethod() {
*         Set<String> s;
*     }
* }</pre> 
```

IE。用于`<pre>{@code`开始和`}</pre>`结束片段。另外，替换`@`为`{@literal @}`.

还没有找到更简单的解决方案。对于几十年来一直在积极发展的语言来说，这是非常可悲的。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-08-29T09:02:09.500

如果您是 Android 开发人员，您可以使用：

```
<pre class=”prettyprint”&gt;

TODO:your code.

</pre> 
```

使用 Java 代码在 Javadoc 中漂亮地打印您的代码。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-12T15:58:40.953

尝试用“pre”替换“code”。HTML 中的 pre 标记将文本标记为预格式化，并且所有换行符和空格都将在您键入时完全显示。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2021-11-03T16:08:45.860

从 Java 18 ( [JEP 413](https://openjdk.java.net/jeps/413) ) 开始，您可以使用`@snippet`标签：

```
/**
 * -- ex: looping through List of Map objects --
 * {@snippet :
 * for (int i = 0; i < list.size(); i++) {
 *      Map map = (Map)list.get(i);
 *      System.out.println(map.get("wordID"));
 *      System.out.println(map.get("word"));
 * }
 * }
 *
 * @param query - select statement
 * @return List of Map objects
 */ 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-09-07T05:28:50.713

我用标签附上了我的示例代码，`<pre class="brush: java"></pre>`并将[SyntaxHighlighter](http://alexgorbatchev.com/SyntaxHighlighter/manual/older_versions.html)用于已发布的 javadocs。它不会伤害 IDE 并使已发布的代码示例美观。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-06-07T15:20:54.200

使用 Java SE 1.6，看起来所有 UPPERCASE PRE 标识符都是在 Javadoc 中执行此操作的最佳方式：

```
/**
 * <PRE>
 * insert code as you would anywhere else
 * </PRE>
 */ 
```

是最简单的方法。

我从 java.awt.Event 方法获得的 javadoc 示例：

```
/**
 * <PRE>
 *    int onmask = SHIFT_DOWN_MASK | BUTTON1_DOWN_MASK;
 *    int offmask = CTRL_DOWN_MASK;
 *    if ((event.getModifiersEx() & (onmask | offmask)) == onmask) {
 *        ...
 *    }
 * </PRE>
 */ 
```

这会产生看起来与常规代码完全相同的输出，常规代码间距和新行完好无损。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-10-28T14:24:12.293

至少在 Visual Studio Code 中，您可以强制 Javadoc 注释通过将其包装在三个反引号中来尊重换行符，如下所示：

```
/** ```markdown
 * This content is rendered in (partial) markdown.
 * 
 * For example, *italic* and **bold** text works, but [links](https://www.google.com) do not.
 * Bonus: it keeps single line-breaks, as seen between this line and the previous.
 ``` */ 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-09-28T16:42:44.600

我通过这两种方式工作没有任何问题：

```
<pre>
<code>
 ... java code, even including annotations
</code>
</pre> 
```

和

```
<pre class="code">
 ... java code, even including annotations
</pre> 
```

当然后者更简单，观察`class="code"`部分

# delphi - 您如何使用版本控制中的第三方组件管理您的 Delphi 项目？

> ID：541924
> 
> 赞同：24
> 
> 时间：2009-02-12T15:53:18.390
> 
> 标签：delphi, version-control, project-structure

安装第三方组件总是需要很长时间，特别是如果您有大型组件，但如果您在多台计算机上设置环境，则需要更多时间。

而且我正在考虑将它们添加到版本控制（Subversion）中，因此使用所有必需组件检查项目总是很容易。

那么您如何管理它，以及在 VCS 中管理它们的最佳实践是什么？

还要考虑其中一些第三方没有源代码，而是作为 Delphi 库。(BPL)。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-12T15:56:14.233

如果我们有源代码，那么我们将它包含在我们的存储库中，在一个单独的文件夹下。

如果我们没有源代码，那么我们只需将最新的二进制文件（bpl、dll 等）保存在存储库中，并在设置文档中包含安装/使用说明。

它看起来像这样：

```
\root
    \third_party_stuff
        \vendor1  --we *do* have the source for this
            \src
            \bin
        \vendor2  --we *do* have the source for this
            \src
            \bin
        \vendor3  --we don't have the source for this one
            \bin
    \our_stuff
        \project1
            \src
            \bin
        \project2
            \src
            \bin 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-12T17:13:15.610

对于 Subversion，我使用外部功能。它可以很容易地在多个项目中使用第三方的东西；当您签出一个项目时，您也会获得外部依赖项。

如果你还没有，你应该得到一份 Pragmatic Version Control Using Subversion。这是一本关于 Subversion 功能和如何做事的好书。虽然它从命令行引用 SVN，但该信息也很容易转换为 TortoiseSVN 中的 GUI。

为了将旧项目的组件重新安装到 Delphi 中，我通常将使用的任何版本的 Delphi 的注册表项导出到项目文件夹中，然后将该 .REG 文件与项目一起检查到 Subversion 中。您可以轻松地签出项目，为相应版本的 Delphi 导出现有的 Delphi 注册表部分，从项目源文件夹中导入 .REG 文件，然后在安装了所有组件的情况下启动 Delphi。

至于“二进制 BPL”问题，真丢脸！如果你有依赖第三方工具的项目，你应该为它们购买源代码。这样，您就可以防止该公司倒闭，或放弃对组件的支持，或不兼容的 Delphi 新版本。我**总是**获得第三方组件的来源；如果源不可用，我会找到不同的产品或自己编写代码。这叫自保。:-)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T06:10:08.847

首先，我同意 Ken 和 Fabricio 的观点，即您**必须**拥有项目中使用的所有组件的源代码。其他任何事情都只是自找麻烦。

我们不将 Subversion 用于我们的源代码控制，但我猜我们所做的仍然适用......

我们从事的每个项目都有该项目中使用的所有组件（源）的完整副本。当我们发布时，我们创建一个发布分支，其中包括组件以及项目源。每个项目都包含它自己的 BPL 目录。

我们总是为我们想要处理的每个项目（或项目的分支）创建单独的快捷方式来运行 Delphi，并使用 -R 命令行参数为该项目的 Delphi 设置设置唯一的注册表项。

然后，我们确保在 Delphi 中覆盖 Path 环境变量以指向我们的项目 BPL 目录，而不是正常的 Delphi BPL 目录。

我们将所有组件的 BPL 和 DCP 输出目录设置为本地项目 BPL 目录。

这允许我们拥有多个版本的 Delphi，多个版本的项目使用不同版本的组件没有任何问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T18:28:54.117

我同意 Ken White 的观点：delphi 3rd party components' used in production code

> **必须有源代码**

时期。仅编译的二进制发行版仅用于评估*目的*。这是我们这里的政策。

至于问题：我实际上并没有将它们放在VCS上。实际上，我使用我的项目编译和工作的最新版本。系统、搜索、库等的混乱......路径不值得。2 JVCL 在同一台机器上或任何新项目的来回版本？啊啊啊。

如果我必须在维护系统中使用旧版本，请删除新 VM 并安装最新版本。有用？行。不是？它一直在 VM 上，直到我找到一种集成到主环境中的方法。

每件事一个版本就足够了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T18:33:49.333

值得一提的是，[LMD](http://www.lmd.de)等一些公司为订阅了支持的客户提供了对他们自己的 SVN 存储库的远程访问。我发现这是为关键问题快速修复错误的好方法。

# python - 如何在 python 中创建新范围

> ID：541926
> 
> 赞同：26
> 
> 时间：2009-02-12T15:53:59.543
> 
> 标签：python, scope

[在许多语言（和地方）中，通过创建这样](https://stackoverflow.com/questions/541705/is-iftrue-a-good-idea-in-c)的块来创建本地范围是一种很好的做法。

```
void foo()
{
     ... Do some stuff ...

     if(TRUE)
     {
         char a;
         int b;

         ... Do some more stuff ...
     }

     ... Do even more stuff ...
 } 
```

如何在 python 中实现这一点而不会出现意外的缩进错误并且不使用某种[*if True:*](https://stackoverflow.com/questions/541705/is-iftrue-a-good-idea-in-c) 技巧

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-12T15:57:19.583

你为什么要在 python 中创建新的作用域？

在其他语言中这样做的正常原因是变量作用域，但这在 python 中不会发生。

```
if True:
    a = 10

print a 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-12T16:10:01.440

在 Python 中，作用域分为三种类型：全局、本地和类。您可以创建专门的“范围”字典以传递给 exec / eval()。此外，您可以使用嵌套范围（在另一个范围内定义一个函数）。我发现这些在我的所有代码中都足够了。

正如 Douglas Leeder 已经说过的，在其他语言中使用它的主要原因是变量作用域，而这在 Python 中并没有真正发生。此外，Python 是我用过的最易读的语言。做一些类似 if-true 技巧的事情（你说你想避免）会违背可读性。在这种情况下，我认为最好的办法是将代码重构为多个函数，或者使用单个作用域。我认为 Python 中可用的作用域足以涵盖所有可能的情况，因此本地作用域实际上并不是必需的。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-12T16:11:08.007

如果您只想创建临时变量并在使用它们后立即对它们进行垃圾收集，您可以使用

```
del varname 
```

当你不再想要它们时。

如果它只是为了美观，您可以使用注释或额外的换行符，但没有额外的缩进。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-12T16:23:30.020

Python 恰好有两个作用域，本地和全局。函数中使用的变量在本地范围内，无论它们是在什么缩进级别创建的。调用嵌套函数将产生您正在寻找的效果。

```
def foo():
  a = 1

  def bar():
    b = 2
    print a, b #will print "1 2"

  bar() 
```

和其他人一样，我不得不问你为什么要在函数中创建一个有限的范围。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-12T15:57:57.430

列表理解（Python 3+）和生成器中的变量是本地的：

```
>>> i = 0
>>> [i+1 for i in range(10)]
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
>>> i
0 
```

但是为什么你需要这个？

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-12T16:21:43.550

> *范围*是 Python 程序的文本区域，其中命名空间可直接访问。这里的“可直接访问”意味着对名称的非限定引用试图在命名空间中找到该名称......

请阅读[文档](http://docs.python.org/tutorial/classes.html#python-scopes-and-name-spaces)并澄清您的问题。

顺便说一句，你不需要`if(TRUE){}`在 C 中，一个简单`{}`的就足够了。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-07-29T17:08:54.820

正如其他答案中所提到的，Python 中没有类似的功能来创建带有块的新范围，但是在编写脚本或 Jupyter Notebook 时，我经常（ab）使用类来引入新的命名空间以获得类似的效果。例如，在您可能有模型“Foo”、“Bar”等以及相关变量的笔记本中，您可能希望创建一个新范围以避免重用名称，例如

```
model = FooModel()
optimizer = FooOptimizer()
...
model = BarModel()
optimizer = BarOptimizer() 
```

或后缀名称，例如

```
model_foo = ...
optimizer_foo = ...

model_bar = ...
optimizer_bar= ... 
```

相反，您可以引入新的命名空间

```
class Foo:
    model = ...
    optimizer = ...
    loss = ....

class Bar:
    model = ...
    optimizer = ...
    loss = ... 
```

然后访问变量为

```
Foo.model
Bar.optimizer
... 
```

我发现以这种方式使用命名空间来创建新的范围使代码更具可读性且不易出错。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-12T16:01:19.323

我认为这是一个明确的信号，表明是时候创建一个新函数并重构代码了。我认为没有理由创建这样的新范围。有什么理由吗？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-12T16:03:19.927

```
def a():
    def b():
        pass
    b() 
```

如果我只是想要一些额外的缩进或调试，我会使用`if True:`

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-10-30T01:35:26.877

像这样，对于任意名称`t`：

```
### at top of function / script / outer scope (maybe just big jupyter cell)
try: t
except NameError:
    class t
        pass
else:
    raise NameError('please `del t` first')

#### Cut here -- you only need 1x of the above -- example usage below ###

t.tempone = 5 # make new temporary variable that definitely doesn't bother anything else.
# block of calls here...
t.temptwo = 'bar' # another one...
del t.tempone # you can have overlapping scopes this way

# more calls
t.tempthree = t.temptwo; del t.temptwo # done with that now too
print(t.tempthree)
# etc, etc -- any number of variables will fit into t.

### At end of outer scope, to return `t` to being 'unused'
del t 
```

以上所有内容都可以在函数 def 中，或者只是脚本中 defs 之外的任何地方。

您可以随时将新元素添加或删除到任意命名的类中。你真的只需要其中之一——然后根据需要管理你的“临时”命名空间。

如果这是在函数体中，则该`del t`语句不是必需的，但是如果包含它，则可以复制/粘贴彼此相距很远的代码块，并让它们按您的期望工作（使用 't' 的不同用法完全独立，每次使用都以 that`try: t...`块开头，以`del t`) 结尾。

这样，如果`t`已经用作变量，您会发现，并且它不会破坏 t，因此您可以找出它是什么。

这比使用一系列 random=named 函数只调用一次更不容易出错——因为它避免了处理它们的名称，或者记住在定义后调用它们，特别是如果你必须重新排序长代码。

这基本上完全符合您的要求：做一个临时的地方来放置您知道肯定不会与其他任何东西发生冲突的东西，并且您负责在您去的时候清理里面的东西。

是的，它很丑陋，而且可能令人气馁——您将被指示将您的工作分解为一组更小、更可重用的函数。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-06-10T17:17:35.480

虽然泄漏范围确实是一个经常有用的功能，但我创建了一个包来模拟块范围（您选择的选择性泄漏，通常是为了得到结果）。

```
from scoping import scoping
a = 2
with scoping():
    assert(2 == a)
    a = 3
    b = 4
    scoping.keep('b')
    assert(3 == a)
assert(2 == a)
assert(4 == b) 
```

[https://pypi.org/project/scoping/](https://pypi.org/project/scoping/)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-12-18T20:22:54.883

正如其他人所建议的那样，在不污染封闭命名空间的情况下执行代码的 python 方法是将其放入类或函数中。这提出了一个轻微且通常无害的问题：定义函数将其名称放在封闭的命名空间中。如果这对您造成伤害，您可以使用 Python 的常规临时变量“_”命名您的函数：

```
def _():
    polluting_variable = foo()
    ...
_() # Run the code before something overwrites the variable. 
```

这可以递归地完成，因为每个本地定义都从封闭范围中屏蔽了定义。

这种事情应该只在非常特殊的情况下才需要。一个有用的例子是使用 Databricks 的`%run`魔法，它在当前笔记本的全局范围内执行另一个笔记本的内容。将子笔记本的命令包装在临时函数中可以防止它们污染全局命名空间。

# javascript - 从 Actionscript 检测 Javascript 的可用性？

> ID：541933
> 
> 赞同：0
> 
> 时间：2009-02-12T15:55:03.863
> 
> 标签：javascript, flash, actionscript, actionscript-2

我想从我的 Flash 项目中打开外部 URL。我通常使用这样的东西：

```
getURL("javascript:newwin=window.open('http://someurl.com','','');"); 
```

但是，如果 Javascript 不可用（在 SWF 未嵌入 HTML 的情况下），那么这将失败。如何检测 Javascript 是否可用？如果它不可用，我可能只是使用 getURL 并给它直接 URL，尽管我只想在无法使用 Javascript 方法的情况下这样做。谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-12T16:36:33.887

要完成您所描述的，最好的方法是让 Flash 调用一个名为“pingJavaScript”的 JavaScript 函数。如果 JavaScript 正在运行，那么该 JavaScript 函数将调用 Flash 电影上的一个名为“receiveJSNotification”的函数。因此，在您的 Flash 电影中，如果调用了该方法，您就知道 JS 正在运行。

要在 Flash 电影和 JavaScript 之间实现可靠的通信，请在电影第一帧的 Actionscript 顶部包含以下内容：

```
import flash.external.ExternalInterface;
import flash.events.Event; 
```

添加一个函数以从 JavaScript 接收“是的，我还活着”：

```
var js_available = false;

function receiveJSNotification(str:String):void {
 _root.js_available = true;
}

ExternalInterface.addCallback("notifyFlash", receiveJSNotification);
ExternalInterface.call("pingJavaScript", null); 
```

在 JavaScript 中：

```
function pingJavaScript()
{
    var movie = getFlash();
    movie.notifyFlash();
}

function getFlash()
{
    var movie = null;
    if (navigator.appName.indexOf('Microsoft') != -1) {
        movie = window['flashmovie'];
    } else {
        movie = document['flashmovie'];
    }
    return movie;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T15:43:21.597

我发现实际上有一种更简单的方法可以做到这一点：

```
public function isThereJavaScript():Boolean{
    return Boolean(ExternalInterface.call("window.location.href.toString"));
} 
```

这不需要 JavaScript 后端。它只是始终如一地工作。如果有调用 JavaScript 的能力，那就意味着必须有一个 window 属性，它有一个非空的 location.href。ExternalInterface 也可用于 AS2 和 AS3。

# regex - 寻找一些 URL 重写帮助

> ID：541934
> 
> 赞同：0
> 
> 时间：2009-02-12T15:55:15.640
> 
> 标签：regex, mod-rewrite, url-rewriting

我的问题很简单，但我似乎找不到答案。我目前正在为网站进行一些 URL 重写，但遇到了问题。目前我最基本的规则是这样的：

```
RewriteRule ^([a-zA-Z]+)/(([a-zA-Z]+)/?$ index.php?mod=$1&com$2 
```

这在大多数情况下都有效，我有一些不适用的特殊情况，但是其中一个页面需要通过 URL 传递大量信息，我想自动重写它。一些例子：

`website.com/asdf/jkl/id/5/page/2`应该成为`website.com/index.php?mod=asdf&com=jkl&id=5&page=2`

`website.com/qwer/yuio/search/keyword/sort/alpha`应该成为`website.com/index.php?mod=qwer&com=yuio&search=keyword&sort=alpha`

这可能吗？我真的可以在这里使用一些帮助...谢谢！:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T16:50:22.810

根据您使用的语言/框架，将重写/调度放在脚本中可能比尝试在 mod_rewrite 中执行所有操作更简单。

例如，如果您使用的是 PHP，给定 URL：

```
http://www.example.com/asdf.php/jkl/id/5/page/2 
```

asf.php 中的脚本可以读取 PATH_INFO 变量，将其拆分为斜线，并将值写入 $_REQUEST 中的预期位置。

那么你所需要的只是一个简单的重写规则来删除'.php'。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T15:59:49.310

您可以使用递归规则：

```
RewriteRule ^([a-zA-Z]+)/([a-zA-Z]+)/?$ index.php?mod=$1&com$2 [L,QSA]
RewriteRule ^([^/]+/[^/]+)/([^/]+)/([^/]+)/?(.*) $1/$4?$2=$3 [QSA] 
```

但是用 PHP 解析请求路径肯定会更容易。

# c# - 在 MSIL 中可以做什么而在 C# 或 VB.NET 中无法做到？

> ID：541936
> 
> 赞同：170
> 
> 时间：2009-02-12T15:55:34.440
> 
> 标签：c#, .net, clr, cil

用 .NET 语言编写的所有代码都编译为 MSIL，但是否有特定任务/操作只能直接使用 MSIL 执行？

让我们在 MSIL 中做的事情也比 C#、VB.NET、F#、j# 或任何其他 .NET 语言更容易。

到目前为止，我们有这个：

1.  尾递归
2.  通用协/逆变（在 C# 4 和 VB 10 中允许）
3.  仅返回类型不同的重载
4.  覆盖访问修饰符
5.  有一个不能从 System.Object 继承的类
6.  过滤的异常（在 VB 和 C# 6 中允许）
7.  调用当前静态类类型的虚方法。
8.  获取值类型的盒装版本的句柄。
9.  做一个尝试/错误。
10.  使用禁止名称。
11.  [为值类型定义自己的无参数构造函数](http://msmvps.com/blogs/jon_skeet/archive/2008/12/10/value-types-and-parameterless-constructors.aspx)。
12.  `raise`使用元素定义事件。
13.  CLR 允许但 C# 不允许的某些转换。
14.  将非`main()`方法设为`.entrypoint`.
15.  直接使用本机`int`和本机`unsigned int`类型。
16.  使用瞬态指针
17.  MethodBodyItem 中的 emitbyte 指令
18.  抛出和捕获非 System.Exception 类型
19.  继承枚举（未验证）
20.  您可以将字节数组视为（小 4 倍）整数数组。
21.  您可以让一个字段/方法/属性/事件都具有相同的名称（未验证）。
22.  您可以从它自己的 catch 块分支回到 try 块。
23.  您可以访问 famandassem 访问说明符（`protected internal`是 fam**或**assem，但现在在 C# 7.2 和 VB 15.5 中允许）
24.  直接访问`<Module>`用于定义全局函数的类或模块初始化程序。
25.  创建和使用基于 1 的非零边界数组
26.  创建开放实例和封闭静态委托，以及 getter/setter 的委托
27.  在不使用临时变量的情况下交换两个值
28.  显式实现任意名称的接口，实现两个接口功能合二为一（VB可以实现）
29.  [声明`vtfixup`（相当于`extern`C 语言）](https://stackoverflow.com/questions/4818850/is-is-possible-to-export-functions-from-a-c-sharp-dll-like-in-vs-c)
30.  指定任意`modopt`或`modreq`

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-02-12T16:06:30.573

MSIL 允许仅在返回类型上有所不同的重载，因为

```
call void [mscorlib]System.Console::Write(string) 
```

或者

```
callvirt int32 ... 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-02-12T16:07:36.110

包括 C# 和 VB 在内的大多数 .Net 语言不使用 MSIL 代码的尾递归特性。

尾递归是函数式语言中常见的一种优化。它发生在方法 A 通过返回方法 B 的值而结束时，这样一旦调用方法 B 就可以释放方法 A 的堆栈。

MSIL 代码显式支持尾递归，对于某些算法，这可能是一个重要的优化。但由于 C# 和 VB 不生成执行此操作的指令，因此必须手动完成（或使用 F# 或其他语言）。

以下是如何在 C# 中手动实现尾递归的示例：

```
private static int RecursiveMethod(int myParameter)
{
    // Body of recursive method
    if (BaseCase(details))
        return result;
    // ...

    return RecursiveMethod(modifiedParameter);
}

// Is transformed into:

private static int RecursiveMethod(int myParameter)
{
    while (true)
    {
        // Body of recursive method
        if (BaseCase(details))
            return result;
        // ...

        myParameter = modifiedParameter;
    }
} 
```

通常的做法是通过将本地数据从硬件堆栈移动到堆分配的堆栈数据结构上来消除递归。在如上图的尾调用递归消除中，堆栈被完全消除，这是一个相当不错的优化。此外，返回值不必经过很长的调用链，而是直接返回。

但是，无论如何，CIL 作为语言的一部分提供了这个特性，但是对于 C# 或 VB，它必须手动实现。（抖动也可以自由地自行进行这种优化，但这是另一个问题。）

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-02-12T16:09:38.210

在 MSIL 中，您可以拥有一个不能从 System.Object 继承的类。

示例代码：使用 ilasm.exe 编译它**更新：**您必须使用“/NOAUTOINHERIT”来防止汇编程序自动继承。

```
// Metadata version: v2.0.50215
.assembly extern mscorlib
{
  .publickeytoken = (B7 7A 5C 56 19 34 E0 89 )                         // .z\V.4..
  .ver 2:0:0:0
}
.assembly sample
{
  .custom instance void [mscorlib]System.Runtime.CompilerServices.CompilationRelaxationsAttribute::.ctor(int32) = ( 01 00 08 00 00 00 00 00 ) 
  .hash algorithm 0x00008004
  .ver 0:0:0:0
}
.module sample.exe
// MVID: {A224F460-A049-4A03-9E71-80A36DBBBCD3}
.imagebase 0x00400000
.file alignment 0x00000200
.stackreserve 0x00100000
.subsystem 0x0003       // WINDOWS_CUI
.corflags 0x00000001    //  ILONLY
// Image base: 0x02F20000

// =============== CLASS MEMBERS DECLARATION ===================

.class public auto ansi beforefieldinit Hello
{
  .method public hidebysig static void  Main(string[] args) cil managed
  {
    .entrypoint
    // Code size       13 (0xd)
    .maxstack  8
    IL_0000:  nop
    IL_0001:  ldstr      "Hello World!"
    IL_0006:  call       void [mscorlib]System.Console::WriteLine(string)
    IL_000b:  nop
    IL_000c:  ret
  } // end of method Hello::Main
} // end of class Hello 
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2009-02-12T16:14:06.767

可以结合使用`protected`和`internal`访问修饰符。在 C# 中，如果您编写`protected internal`一个成员，则可以从程序集和派生类中访问该成员。通过 MSIL，您可以获得一个只能从程序集中的派生类访问的*成员*。（我认为这可能非常有用！）

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2009-02-26T16:06:58.060

哦，我当时没有发现这个。（如果您添加 jon-skeet 标签，则更有可能，但我不经常检查它。）

看起来你已经有了很好的答案。此外：

*   您无法掌握 C# 中值类型的盒装版本。你可以在 C++/CLI
*   您不能在 C# 中进行尝试/错误（“错误”类似于“捕获所有内容并在块的末尾重新抛出”或“最终但仅在失败时”）
*   有很多 C# 禁止但合法 IL 的名称
*   IL 允许您[为值类型定义自己的无参数构造函数](http://msmvps.com/blogs/jon_skeet/archive/2008/12/10/value-types-and-parameterless-constructors.aspx)。
*   您不能在 C# 中使用“raise”元素定义事件。（在 VB 中，您*必须*自定义事件，但“默认”事件不包括一个。）
*   CLR 允许某些转换，但 C# 不允许。如果你`object`在 C# 中通过，这些有时会起作用。有关示例，请参见[uint[]/int[] SO question](https://stackoverflow.com/questions/593730/why-does-int-is-uint-true-in-c)。

如果我想到其他任何事情，我会补充这一点......

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2009-02-12T15:57:54.417

CLR 已经支持泛型协/逆变，但 C# 直到 4.0 才获得此功能

*   [C# 4.0 特性](http://channel9.msdn.com/shows/Going+Deep/Inside-C-40-dynamic-type-optional-parameters-more-COM-friendly/)
*   [协/逆变](http://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science))

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2009-03-13T16:53:57.467

在 IL 中，您可以抛出和捕获任何类型，而不仅仅是从`System.Exception`.

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2009-02-23T16:24:42.053

IL对虚方法调用有`call`和的区别。`callvirt`通过使用前者，您可以强制调用*当前静态类类型*的虚方法，而不是动态类类型中的虚函数。

C# 无法做到这一点：

```
abstract class Foo {
    public void F() {
        Console.WriteLine(ToString()); // Always a virtual call!
    }

    public override string ToString() { System.Diagnostics.Debug.Assert(false); }
};

sealed class Bar : Foo {
    public override string ToString() { return "I'm called!"; }
} 
```

VB 和 IL 一样，可以使用`MyClass.Method()`语法发出非虚拟调用。在上面，这将是`MyClass.ToString()`.

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2009-02-12T16:11:49.080

使用 IL 和 VB.NET，您可以在捕获异常时添加过滤器，但 C# v3 不支持此功能。

这个VB.NET 示例取自[http://blogs.msdn.com/clrteam/archive/2009/02/05/catch-rethrow-and-filters-why-you-should-care.aspx](http://blogs.msdn.com/clrteam/archive/2009/02/05/catch-rethrow-and-filters-why-you-should-care.aspx "Catch、Rethrow 和 Filters - 为什么你应该关心？")（注意**`When ShouldCatch(ex) = True`**捕获子句）：

```
Try
   Foo()
Catch ex As CustomBaseException When ShouldCatch(ex)
   Console.WriteLine("Caught exception!")
End Try 
```

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2011-01-18T11:02:19.080

在 try/catch 中，您可以从它自己的 catch 块重新进入 try 块。所以，你可以这样做：

```
.try {
    // ...

  MidTry:
    // ...

    leave.s RestOfMethod
}
catch [mscorlib]System.Exception {
    leave.s MidTry  // branching back into try block!
}

RestOfMethod:
    // ... 
```

AFAIK 你不能在 C# 或 VB 中做到这一点

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2009-10-16T13:08:52.863

据我所知，没有办法直接在 C# 中创建模块初始值设定项（整个模块的静态构造函数）：

[http://blogs.msdn.com/junfeng/archive/2005/11/19/494914.aspx](http://blogs.msdn.com/junfeng/archive/2005/11/19/494914.aspx)

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2009-02-26T22:53:00.737

`Native types`
您可以直接使用本机 int 和本机 unsigned int 类型（在 c# 中，您只能使用不同的 IntPtr。

`Transient Pointers`
您可以使用临时指针，它们是指向托管类型的指针，但保证不会在内存中移动，因为它们不在托管堆中。不完全确定如何在不弄乱非托管代码的情况下有效地使用它，但它不会仅通过诸如 stackalloc 之类的东西直接暴露给其他语言。

`<Module>`
如果你愿意，你可以在课堂上捣乱（你可以通过反射来做到这一点，而不需要 IL）

`.emitbyte`

> 15.4.1.1 .emitbyte 指令 MethodBodyItem ::= ... | .emitbyte Int32 该指令导致一个无符号的 8 位值直接发送到该方法的 CIL 流中，在该指令出现的位置。[注意：.emitbyte 指令用于生成测试。生成常规程序时不需要它。尾注]

`.entrypoint`
您对此有更多的灵活性，例如，您可以将其应用于不称为 Main 的方法。

阅读[规范](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-335.pdf)我相信你会发现更多。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2010-08-03T15:49:39.703

您可以破解方法覆盖 co/contra-variance，这是 C# 不允许的（这与通用方差不同！）。我有更多关于在[此处](http://www.simple-talk.com/community/blogs/simonc/archive/2010/07/19/93562.aspx)实施的信息，以及[第 1](http://www.simple-talk.com/community/blogs/simonc/archive/2010/07/14/93495.aspx)部分和[第 2部分](http://www.simple-talk.com/community/blogs/simonc/archive/2010/07/16/93516.aspx)

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2009-06-03T04:49:41.030

这里还有一些：

1.  您可以在委托中拥有额外的实例方法。
2.  代表可以实现接口。
3.  您可以在委托和接口中拥有静态成员。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2009-03-02T15:19:04.913

I think the one I kept wishing for (with entirely the wrong reasons) was inheritance in Enums. It doesn't seem like a hard thing to do in SMIL (since Enums are just classes) but it's not something the C# syntax wants you to do.

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2009-10-11T16:17:04.653

20）您可以将字节数组视为（4x 小）整数数组。

我最近使用它来执行快速 XOR 实现，因为 CLR xor 函数对整数进行操作，而我需要对字节流进行 XOR。

测得的结果代码比 C# 中的等效代码（对每个字节执行 XOR）快约 10 倍。

===

我没有足够的 stackoverflow street credz 来编辑问题并将其添加到列表中作为 #20，如果其他人可以这样做会膨胀;-)

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2009-10-16T12:25:26.537

混淆器使用的东西 - 你可以让一个字段/方法/属性/事件都具有相同的名称。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2011-02-17T05:58:34.217

你也可以从 IL 中的 System.Multicast 委托派生一个类，但你不能在 C# 中这样做：

> // 下面的类定义是非法的：
> 
> 公共类 YourCustomDelegate : MulticastDelegate { }

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2010-12-06T17:58:51.363

枚举继承实际上是不可能的：

您可以从 Enum 类继承。但结果并不特别像枚举。它的行为甚至不像一个值类型，而是像一个普通的类。奇怪的是：IsEnum:True, IsValueType:True, IsClass:False

但这并不是特别有用（除非您想混淆一个人或运行时本身。）

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2011-02-17T06:11:39.687

您还可以在 IL 中定义模块级（也称为全局）方法，相比之下，C# 只允许您定义方法，只要它们附加到至少一种类型。

# asp.net - 在文件夹及其子文件夹上创建缓存依赖项

> ID：541940
> 
> 赞同：3
> 
> 时间：2009-02-12T15:56:00.897
> 
> 标签：asp.net, caching, asp.net-2.0, dependencies

在 ASP.NET 中，我想在缓存中存储一​​个对象，该对象依赖于特定文件夹及其子文件夹中的所有文件。仅添加依赖于根文件夹的对象是行不通的。除了在所有文件上创建依赖链之外，还有什么合理的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-12T16:00:23.537

我相信您可以滚动自己的缓存依赖项并使用 FileSystemMonitor 来监视文件系统更改。

更新：下面的示例代码

```
public class FolderCacheDependency : CacheDependency
{
    public FolderCacheDependency(string dirName)
    {
        FileSystemWatcher watcher = new FileSystemWatcher(dirName);
        watcher.Changed += new FileSystemEventHandler(watcher_Changed);
        watcher.Deleted += new FileSystemEventHandler(watcher_Changed);
        watcher.Created += new FileSystemEventHandler(watcher_Changed);
        watcher.Renamed += new RenamedEventHandler(watcher_Renamed);
    }

    void watcher_Renamed(object sender, RenamedEventArgs e)
    {
        this.NotifyDependencyChanged(this, e);
    }

    void watcher_Changed(object sender, FileSystemEventArgs e)
    {
        this.NotifyDependencyChanged(this, e);
    }
} 
```

# iphone - 苹果的单例示例

> ID：541950
> 
> 赞同：0
> 
> 时间：2009-02-12T15:57:29.130
> 
> 标签：iphone, objective-c, cocoa-touch, singleton

在 iPhone 应用程序中使用了 MyGizmoClass 示例，其中我有一个设置和维护数据库信息的对象。

如何消除“MyGizmoClass”可能无法响应“+sharedManager”

警告

有问题的代码行是： NSString *databasePath = [[MyGizmoClass sharedManager]databasePath];

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T21:29:11.657

听起来 +sharedManager 方法没有在标题中声明。您已经多次提到导入标头，但没有说明 +sharedManager 是否是该标头的一部分。您看到的错误表明（a）标头没有被导入（并且您已经说过它是）或（b）标头正在被导入但不包含有问题的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T16:44:22.387

不确定这是否属于评论或答案。

MyGizmoClass.h 被导入到实现文件中（并且在它的头文件中（只是为了看看这是否会停止警告））。但警告仍在发生。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T16:08:18.107

您需要`import`将 MyGizmoClass.h 文件添加到您的实现中。这让编译器知道所有 MyGizomoClass 方法并防止警告。

如果已经是这种情况，那么在 MyGizmoClass 接口（.h 文件）中没有正确定义 sharedManager。

# c++ - Visual Studio：std::string 的乱码调试监视？

> ID：541951
> 
> 赞同：5
> 
> 时间：2009-02-12T15:57:29.457
> 
> 标签：c++, visual-studio, debugging, mixed-mode

当我在 Visual Studio 2005 中调试 C++ 混合（托管/非托管）项目时，我经常从调试手表中得到奇怪的数据，如下所示：（
顺便说一句，变量`i_processName`是 a `const std::string &`）

[替代文字 http://img175.imageshack.us/img175/3561/43419953av1.jpg](http://img175.imageshack.us/img175/3561/43419953av1.jpg)

请注意，该变量实际上包含有效数据 - 如果我将其打印到标准输出，打印的字符串就可以了，感谢您的询问。更简单的数据类型（例如`int`s）（通常？）会显示正确的值。

这也发生在你身上吗？

这是调试时的主要 PITA，所以......关于如何让手表显示正确数据的任何想法，或者是什么原因造成的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-01-08T05:15:21.140

我相信 Aardvark 可能是正确的答案。如果我在编译混合模式时没记错的话，编译器会将尽可能多的 C++ 代码转换为在 CLR 上运行的代码，从而转换为 CLR 拥有的内存。我的猜测是调试器对字符串的保存位置感到困惑 - 非托管或托管内存。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T15:59:39.657

看起来您的调试符号不正确。

检查模块调试窗口（菜单：Debug>Windows）。检查您正在调试的模块是否已“加载符号”。列在符号状态列下。检查列出的符号文件是您认为应该是的文件。您可以右键单击一个模块并获取有关 VS 如何加载符号的更多信息，您也可以重新加载它们。

如果您遇到符号加载问题，您可以在工具>选项>调试>符号下设置路径和其他设置。

糟糕的调用堆栈也会导致类似的问题。确保堆栈没有任何条目，例如“堆栈对于这一点可能不正确......”。可以？

Visual Studio 在可视化工具中混淆原生数据类型和托管数据类型也可能有些奇怪，但我对此表示怀疑。屏幕截图中的弹出窗口看起来像是调试器知道变量是什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-12T16:18:01.950

自定义类型（包括 STL）的调试显示取决于文件夹`autoexp.dat`中的`<install_path>\Common7\Packages\Debugger`文件。确保您的库版本与您的库版本匹配，并且没有保留此文件的旧版本（例如在升级时）。

请注意，您还可以为其他类型编写自己的可视化工具，更多信息[在这里](http://www.virtualdub.org/blog/pivot/entry.php?id=120)和[这里](http://www.developer.com/net/cplus/article.php/3751791)。对于复杂的项目来说，这可以节省大量时间，非常值得为编写自定义可视化器付出（少量）努力。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-12T16:24:55.257

是的，我在调试器中看到了这个问题，
在我的情况下，它连接到**Unicode vs NonUnicode**。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-21T03:36:24.663

一个想法 - std::string 的 STLPort 实现使用拆分缓冲区实现。它有一个小的静态缓冲区（我想说 14 个字符）和一个指向 char 数组的指针。其中一个将是无效的，另一个将包含字符串数据，具体取决于存储字符串的长度。如果您使用的是 STLPort 或类似的实现，您的字符串可视化工具可能正在查看错误的缓冲区，该缓冲区恰好包含垃圾数据。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-04-17T09:55:44.170

这是一个一直存在于 Visual Studio 调试器中的错误，并且仍然出现在 Visual Studio 2019 中。

这是随机的。

有时更改代码并重新编译可以解决问题，有时则不能。

# c# - 使用 html Agility Pack 选择属性值

> ID：541953
> 
> 赞同：10
> 
> 时间：2009-02-12T15:57:39.753
> 
> 标签：c#, .net, xpath, html-agility-pack

我正在尝试使用 html 敏捷包和此 xpath 从 html 文档中检索特定图像：

```
//div[@id='topslot']/a/img/@src 
```

据我所见，它找到了 src-attribute，但它返回了 img-tag。这是为什么？

我希望设置 InnerHtml/InnerText 或其他内容，但两者都是空字符串。OuterHtml 设置为完整的 img-tag。

是否有任何有关 Html Agility Pack 的文档？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2013-03-14T17:03:48.437

如果您使用的是，您可以直接获取该属性`HtmlNavigator`。

```
//Load document from some html string
HtmlDocument hdoc = new HtmlDocument();
hdoc.LoadHtml(htmlContent);

//Load navigator for current document
HtmlNodeNavigator navigator = (HtmlNodeNavigator)hdoc.CreateNavigator();

//Get value from given xpath
string xpath = "//div[@id='topslot']/a/img/@src";
string val = navigator.SelectSingleNode(xpath).Value; 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-23T00:30:58.880

Html Agility Pack[不支持](http://www.codeplex.com/htmlagilitypack/Thread/View.aspx?ThreadId=1720)属性选择。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2013-03-31T07:00:12.783

您可以使用“GetAttributeValue”方法。

例子：

```
//[...] code before needs to load a html document
HtmlAgilityPack.HtmlDocument htmldoc = e.Document;
//get all nodes "a" matching the XPath expression
HtmlNodeCollection AllNodes = htmldoc.DocumentNode.SelectNodes("*[@class='item']/p/a");
//show a messagebox for each node found that shows the content of attribute "href"
foreach (var MensaNode in AllNodes)
{
     string url = MensaNode.GetAttributeValue("href", "not found");
     MessageBox.Show(url);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-06-26T17:31:32.313

Html Agility Pack 很快就会支持它。

[http://htmlagilitypack.codeplex.com/Thread/View.aspx?ThreadId=204342](http://htmlagilitypack.codeplex.com/Thread/View.aspx?ThreadId=204342)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-12-25T14:01:32.843

**使用 Html Agility Pack 读取和写入属性**

您可以读取和设置 HtmlAgilityPack 中的属性。此示例选择 <html> 标记并选择“lang”（语言）属性（如果存在），然后读取和写入“lang”属性。

在下面的示例中，doc.LoadHtml(this.All), "this.All" 是 html 文档的字符串表示形式。

**读和写：**

```
 HtmlAgilityPack.HtmlDocument doc = new HtmlAgilityPack.HtmlDocument();
            doc.LoadHtml(this.All);
            string language = string.Empty;
            var nodes = doc.DocumentNode.SelectNodes("//html");
            for (int i = 0; i < nodes.Count; i++)
            {
                if (nodes[i] != null && nodes[i].Attributes.Count > 0 && nodes[i].Attributes.Contains("lang"))
                {
                    language = nodes[i].Attributes["lang"].Value; //Get attribute
                    nodes[i].Attributes["lang"].Value = "en-US"; //Set attribute
                }
            } 
```

**只读：**

```
 HtmlAgilityPack.HtmlDocument doc = new HtmlAgilityPack.HtmlDocument();
            doc.LoadHtml(this.All);
            string language = string.Empty;
            var nodes = doc.DocumentNode.SelectNodes("//html");
            foreach (HtmlNode a in nodes)
            {
                if (a != null && a.Attributes.Count > 0 && a.Attributes.Contains("lang"))
                {
                    language = a.Attributes["lang"].Value;
                }
            } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-09-06T10:02:43.667

我使用以下方式获取图像的属性。

```
var MainImageString  = MainImageNode.Attributes.Where(i=> i.Name=="src").FirstOrDefault(); 
```

可以指定属性名来获取它的值；如果您不知道属性名称，请在获取节点后给出断点并通过将鼠标悬停在其上来查看其属性。

希望我有所帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-09-01T11:43:15.580

我刚刚遇到这个问题并使用 GetAttributeValue 方法解决了它。

```
//Selecting all tbody elements
IList<HtmlNode> nodes = doc.QuerySelectorAll("div.characterbox-main")[1]
.QuerySelectorAll("div table tbody");

//Iterating over them and getting the src attribute value of img elements.
var data = nodes.Select((node) =>
{
     return new
     {
         name = node.QuerySelector("tr:nth-child(2) th a").InnerText,
         imageUrl = node.QuerySelector("tr td div a img")
         .GetAttributeValue("src", "default-url")
     };
}); 
```

# c# - 您将如何计算字符串中字符串（实际上是字符）的出现次数？

> ID：541954
> 
> 赞同：980
> 
> 时间：2009-02-12T15:57:40.907
> 
> 标签：c#, string

我正在做一些事情，我意识到我想计算`/`我可以在一个字符串中找到多少个 s，然后它让我震惊，有几种方法可以做到，但无法决定最好（或最简单）是什么.

目前我正在使用类似的东西：

```
string source = "/once/upon/a/time/";
int count = source.Length - source.Replace("/", "").Length; 
```

但我一点也不喜欢，有没有人？

我真的不想为此挖掘`RegEx`，是吗？

我知道我的字符串将包含我正在搜索的术语，因此您可以假设...

当然对于**长度 > 1**的字符串*，*

 **```
string haystack = "/once/upon/a/time";
string needle = "/";
int needleCount = ( haystack.Length - haystack.Replace(needle,"").Length ) / needle.Length; 
```

* * *

## 回答 #1

> 赞同：1152
> 
> 时间：2009-02-12T16:02:49.383

如果您使用的是 .NET 3.5，您可以使用 LINQ 在单行中执行此操作：

```
int count = source.Count(f => f == '/'); 
```

如果你不想使用 LINQ，你可以这样做：

```
int count = source.Split('/').Length - 1; 
```

* * *

您可能会惊讶地发现，您的原始技术似乎比这两种方法中的任何一种都快 30%！我刚刚用“/once/on/a/time/”做了一个快速基准测试，结果如下：

> 您原来的 = 12s source.Count
> = 19s
> source.Split = 17s
> foreach （[来自 bobwienholt 的回答](https://stackoverflow.com/a/541976/662581)）= 10s

（时间是 50,000,000 次迭代，因此您不太可能注意到现实世界中的太大差异。）

* * *

## 回答 #2

> 赞同：201
> 
> 时间：2009-02-12T16:00:22.710

```
string source = "/once/upon/a/time/";
int count = 0;
foreach (char c in source) 
  if (c == '/') count++; 
```

必须比`source.Replace()`自身快。

* * *

## 回答 #3

> 赞同：143
> 
> 时间：2010-12-10T15:54:43.873

```
int count = new Regex(Regex.Escape(needle)).Matches(haystack).Count; 
```

* * *

## 回答 #4

> 赞同：88
> 
> 时间：2009-02-12T16:26:14.443

如果您希望能够搜索整个字符串，而不仅仅是字符：

```
src.Select((c, i) => src.Substring(i))
    .Count(sub => sub.StartsWith(target)) 
```

读作“对于字符串中的每个字符，将从该字符开始的其余字符串作为子字符串；如果它以目标字符串开头，则对其进行计数。”

* * *

## 回答 #5

> 赞同：74
> 
> 时间：2012-08-02T08:27:35.413

我进行了一些研究，发现[Richard Watson 的](https://stackoverflow.com/a/6004505/1177288)解决方案在大多数情况下是最快的。这是帖子中每个解决方案的结果表（除了那些使用正则*表达式*的表，因为它在解析像“test {test”这样的字符串时会抛出异常）

```
 Name      | Short/char |  Long/char | Short/short| Long/short |  Long/long |
    Inspite   |         134|        1853|          95|        1146|         671|
    LukeH_1   |         346|        4490|         N/A|         N/A|         N/A|
    LukeH_2   |         152|        1569|         197|        2425|        2171|
Bobwienholt   |         230|        3269|         N/A|         N/A|         N/A|
Richard Watson|          33|         298|         146|         737|         543|
StefanosKargas|         N/A|         N/A|         681|       11884|       12486| 
```

您可以看到，如果在短字符串（10-50 个字符）中查找短子字符串（1-5 个字符）的出现次数，则首选原始算法。

此外，对于多字符子字符串，您应该使用以下代码（基于[Richard Watson 的](https://stackoverflow.com/a/6004505/1177288)解决方案）

```
int count = 0, n = 0;

if(substring != "")
{
    while ((n = source.IndexOf(substring, n, StringComparison.InvariantCulture)) != -1)
    {
        n += substring.Length;
        ++count;
    }
} 
```

* * *

## 回答 #6

> 赞同：66
> 
> 时间：2009-02-12T16:01:43.550

LINQ 适用于所有集合，并且由于字符串只是字符的集合，那么这个漂亮的小单行线怎么样：

```
var count = source.Count(c => c == '/'); 
```

确保您`using System.Linq;`在代码文件的顶部具有`.Count`该名称空间的扩展方法。

* * *

## 回答 #7

> 赞同：57
> 
> 时间：2011-05-14T20:10:14.727

```
string source = "/once/upon/a/time/";
int count = 0;
int n = 0;

while ((n = source.IndexOf('/', n)) != -1)
{
   n++;
   count++;
} 
```

在我的计算机上，它比 5000 万次迭代的每个字符的解决方案快大约 2 秒。

2013 年修订：

将字符串更改为 char[] 并遍历它。将 50m 迭代的总时间再缩短一两秒！

```
char[] testchars = source.ToCharArray();
foreach (char c in testchars)
{
     if (c == '/')
         count++;
} 
```

这仍然更快：

```
char[] testchars = source.ToCharArray();
int length = testchars.Length;
for (int n = 0; n < length; n++)
{
    if (testchars[n] == '/')
        count++;
} 
```

为了更好地衡量，从数组末尾迭代到 0 似乎是最快的，大约 5%。

```
int length = testchars.Length;
for (int n = length-1; n >= 0; n--)
{
    if (testchars[n] == '/')
        count++;
} 
```

我想知道为什么这可能是并且正在谷歌搜索（我记得一些关于反向迭代更快的事情），并且遇到了这个 SO 问题，它已经烦人地使用了字符串到 char[] 技术。不过，我认为在这种情况下，逆转技巧是新的。

[在 C# 中遍历字符串中单个字符的最快方法是什么？](https://stackoverflow.com/questions/8793762/what-is-the-fastest-way-to-iterate-through-individual-characters-in-a-string-in)

* * *

## 回答 #8

> 赞同：47
> 
> 时间：2009-02-12T16:04:24.793

这些都只适用于单字符搜索词...

```
countOccurences("the", "the answer is the answer");

int countOccurences(string needle, string haystack)
{
    return (haystack.Length - haystack.Replace(needle,"").Length) / needle.Length;
} 
```

对于更长的针头可能会更好......

但必须有一种更优雅的方式。:)

* * *

## 回答 #9

> 赞同：20
> 
> 时间：2009-02-12T18:48:28.173

**编辑：**

```
source.Split('/').Length-1 
```

* * *

## 回答 #10

> 赞同：18
> 
> 时间：2013-06-19T10:49:27.733

```
Regex.Matches(input,  Regex.Escape("stringToMatch")).Count 
```

* * *

## 回答 #11

> 赞同：16
> 
> 时间：2016-03-08T15:38:47.987

在 C# 中，一个不错的 String SubString 计数器是这个出人意料的棘手家伙：

```
public static int CCount(String haystack, String needle)
{
    return haystack.Split(new[] { needle }, StringSplitOptions.None).Length - 1;
} 
```

* * *

## 回答 #12

> 赞同：14
> 
> 时间：2011-03-15T16:36:13.233

```
private int CountWords(string text, string word) {
    int count = (text.Length - text.Replace(word, "").Length) / word.Length;
    return count;
} 
```

因为最初的解决方案对于字符来说是最快的，我想它也适用于字符串。所以这是我的贡献。

对于上下文：我在日志文件中寻找“失败”和“成功”之类的词。

Gr，本

* * *

## 回答 #13

> 赞同：13
> 
> 时间：2011-01-07T16:41:17.227

```
string s = "65 fght 6565 4665 hjk";
int count = 0;
foreach (Match m in Regex.Matches(s, "65"))
  count++; 
```

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2013-02-28T18:20:55.343

```
public static int GetNumSubstringOccurrences(string text, string search)
{
    int num = 0;
    int pos = 0;

    if (!string.IsNullOrEmpty(text) && !string.IsNullOrEmpty(search))
    {
        while ((pos = text.IndexOf(search, pos)) > -1)
        {
            num ++;
            pos += search.Length;
        }
    }
    return num;
} 
```

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2014-06-10T15:16:29.983

对于任何想要准备好使用 String 扩展方法的人，

这是我根据已发布的最佳答案使用的内容：

```
public static class StringExtension
{    
    /// <summary> Returns the number of occurences of a string within a string, optional comparison allows case and culture control. </summary>
    public static int Occurrences(this System.String input, string value, StringComparison stringComparisonType = StringComparison.Ordinal)
    {
        if (String.IsNullOrEmpty(value)) return 0;

        int count    = 0;
        int position = 0;

        while ((position = input.IndexOf(value, position, stringComparisonType)) != -1)
        {
            position += value.Length;
            count    += 1;
        }

        return count;
    }

    /// <summary> Returns the number of occurences of a single character within a string. </summary>
    public static int Occurrences(this System.String input, char value)
    {
        int count = 0;
        foreach (char c in input) if (c == value) count += 1;
        return count;
    }
} 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2013-05-01T16:51:50.087

我认为最简单的方法是使用正则表达式。这样，您可以获得与使用 myVar.Split('x') 相同的拆分计数，但在多字符设置中。

```
string myVar = "do this to count the number of words in my wording so that I can word it up!";
int count = Regex.Split(myVar, "word").Length; 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2021-07-14T19:09:33.730

从 .NET 5（Net core 2.1+ 和 NetStandard 2.1）开始，我们有了一个新的迭代速度之王。

“跨度<T>” [https://docs.microsoft.com/en-us/dotnet/api/system.span-1?view=net-5.0](https://docs.microsoft.com/en-us/dotnet/api/system.span-1?view=net-5.0)

并且 String 有一个内置成员，它返回给我们一个 Span<Char>

```
int count = 0;
foreach( var c in source.AsSpan())
{
    if (c == '/')
        count++;
} 
```

我的测试显示比直接 foreach 快 62%。我还比较了 Span<T>[i] 上的 for() 循环，以及此处发布的其他一些循环。请注意，String 上的反向 for() 迭代现在似乎比直接 foreach 运行得慢。

```
Starting test, 10000000 iterations
(base) foreach =   673 ms

fastest to slowest
foreach Span =   252 ms   62.6%
  Span [i--] =   282 ms   58.1%
  Span [i++] =   402 ms   40.3%
   for [i++] =   454 ms   32.5%
   for [i--] =   867 ms  -28.8%
     Replace =  1905 ms -183.1%
       Split =  2109 ms -213.4%
  Linq.Count =  3797 ms -464.2% 
```

更新：2021 年 12 月，Visual Studio 2022，.NET 5 和 6

```
.NET 5
Starting test, 100000000 iterations set
(base) foreach =  7658 ms
fastest to slowest
  foreach Span =   3710 ms     51.6%
    Span [i--] =   3745 ms     51.1%
    Span [i++] =   3932 ms     48.7%
     for [i++] =   4593 ms     40.0%
     for [i--] =   7042 ms      8.0%
(base) foreach =   7658 ms      0.0%
       Replace =  18641 ms   -143.4%
         Split =  21469 ms   -180.3%
          Linq =  39726 ms   -418.8%
Regex Compiled = 128422 ms -1,577.0%
         Regex = 179603 ms -2,245.3%

.NET 6
Starting test, 100000000 iterations set
(base) foreach =  7343 ms
fastest to slowest
  foreach Span =   2918 ms     60.3%
     for [i++] =   2945 ms     59.9%
    Span [i++] =   3105 ms     57.7%
    Span [i--] =   5076 ms     30.9%
(base) foreach =   7343 ms      0.0%
     for [i--] =   8645 ms    -17.7%
       Replace =  18307 ms   -149.3%
         Split =  21440 ms   -192.0%
          Linq =  39354 ms   -435.9%
Regex Compiled = 114178 ms -1,454.9%
         Regex = 186493 ms -2,439.7% 
```

我添加了更多循环并加入了 RegEx，因此我们可以看到在大量迭代中使用它是多么灾难。我认为 for(++) 循环比较可能已经在 .NET 6 中进行了优化，以便在内部使用 Span——因为它的速度几乎与 foreach 跨度相同。

[代码链接](https://github.com/QuickWire/IterationTestApp)

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2015-05-07T10:59:43.100

```
string search = "/string";
var occurrences = (regex.Match(search, @"\/")).Count; 
```

这将在程序每次准确找到“/s”时计数（区分大小写），并且出现的次数将存储在变量“occurrences”中

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2018-12-07T10:06:18.290

我觉得我们缺少某些类型的子字符串计数，比如不安全的逐字节比较。我把原始海报的方法和我能想到的任何方法放在一起。

这些是我制作的字符串扩展。

```
namespace Example
{
    using System;
    using System.Text;

    public static class StringExtensions
    {
        public static int CountSubstr(this string str, string substr)
        {
            return (str.Length - str.Replace(substr, "").Length) / substr.Length;
        }

        public static int CountSubstr(this string str, char substr)
        {
            return (str.Length - str.Replace(substr.ToString(), "").Length);
        }

        public static int CountSubstr2(this string str, string substr)
        {
            int substrlen = substr.Length;
            int lastIndex = str.IndexOf(substr, 0, StringComparison.Ordinal);
            int count = 0;
            while (lastIndex != -1)
            {
                ++count;
                lastIndex = str.IndexOf(substr, lastIndex + substrlen, StringComparison.Ordinal);
            }

            return count;
        }

        public static int CountSubstr2(this string str, char substr)
        {
            int lastIndex = str.IndexOf(substr, 0);
            int count = 0;
            while (lastIndex != -1)
            {
                ++count;
                lastIndex = str.IndexOf(substr, lastIndex + 1);
            }

            return count;
        }

        public static int CountChar(this string str, char substr)
        {
            int length = str.Length;
            int count = 0;
            for (int i = 0; i < length; ++i)
                if (str[i] == substr)
                    ++count;

            return count;
        }

        public static int CountChar2(this string str, char substr)
        {
            int count = 0;
            foreach (var c in str)
                if (c == substr)
                    ++count;

            return count;
        }

        public static unsafe int CountChar3(this string str, char substr)
        {
            int length = str.Length;
            int count = 0;
            fixed (char* chars = str)
            {
                for (int i = 0; i < length; ++i)
                    if (*(chars + i) == substr)
                        ++count;
            }

            return count;
        }

        public static unsafe int CountChar4(this string str, char substr)
        {
            int length = str.Length;
            int count = 0;
            fixed (char* chars = str)
            {
                for (int i = length - 1; i >= 0; --i)
                    if (*(chars + i) == substr)
                        ++count;
            }

            return count;
        }

        public static unsafe int CountSubstr3(this string str, string substr)
        {
            int length = str.Length;
            int substrlen = substr.Length;
            int count = 0;
            fixed (char* strc = str)
            {
                fixed (char* substrc = substr)
                {
                    int n = 0;

                    for (int i = 0; i < length; ++i)
                    {
                        if (*(strc + i) == *(substrc + n))
                        {
                            ++n;
                            if (n == substrlen)
                            {
                                ++count;
                                n = 0;
                            }
                        }
                        else
                            n = 0;
                    }
                }
            }

            return count;
        }

        public static int CountSubstr3(this string str, char substr)
        {
            return CountSubstr3(str, substr.ToString());
        }

        public static unsafe int CountSubstr4(this string str, string substr)
        {
            int length = str.Length;
            int substrLastIndex = substr.Length - 1;
            int count = 0;
            fixed (char* strc = str)
            {
                fixed (char* substrc = substr)
                {
                    int n = substrLastIndex;

                    for (int i = length - 1; i >= 0; --i)
                    {
                        if (*(strc + i) == *(substrc + n))
                        {
                            if (--n == -1)
                            {
                                ++count;
                                n = substrLastIndex;
                            }
                        }
                        else
                            n = substrLastIndex;
                    }
                }
            }

            return count;
        }

        public static int CountSubstr4(this string str, char substr)
        {
            return CountSubstr4(str, substr.ToString());
        }
    }
} 
```

接下来是测试代码...

```
static void Main()
{
    const char matchA = '_';
    const string matchB = "and";
    const string matchC = "muchlongerword";
    const string testStrA = "_and_d_e_banna_i_o___pfasd__and_d_e_banna_i_o___pfasd_";
    const string testStrB = "and sdf and ans andeians andano ip and and sdf and ans andeians andano ip and";
    const string testStrC =
        "muchlongerword amuchlongerworsdfmuchlongerwordsdf jmuchlongerworijv muchlongerword sdmuchlongerword dsmuchlongerword";
    const int testSize = 1000000;
    Console.WriteLine(testStrA.CountSubstr('_'));
    Console.WriteLine(testStrA.CountSubstr2('_'));
    Console.WriteLine(testStrA.CountSubstr3('_'));
    Console.WriteLine(testStrA.CountSubstr4('_'));
    Console.WriteLine(testStrA.CountChar('_'));
    Console.WriteLine(testStrA.CountChar2('_'));
    Console.WriteLine(testStrA.CountChar3('_'));
    Console.WriteLine(testStrA.CountChar4('_'));
    Console.WriteLine(testStrB.CountSubstr("and"));
    Console.WriteLine(testStrB.CountSubstr2("and"));
    Console.WriteLine(testStrB.CountSubstr3("and"));
    Console.WriteLine(testStrB.CountSubstr4("and"));
    Console.WriteLine(testStrC.CountSubstr("muchlongerword"));
    Console.WriteLine(testStrC.CountSubstr2("muchlongerword"));
    Console.WriteLine(testStrC.CountSubstr3("muchlongerword"));
    Console.WriteLine(testStrC.CountSubstr4("muchlongerword"));
    var timer = new Stopwatch();
    timer.Start();
    for (int i = 0; i < testSize; ++i)
        testStrA.CountSubstr(matchA);
    timer.Stop();
    Console.WriteLine("CS1 chr: " + timer.Elapsed.TotalMilliseconds + "ms");

    timer.Restart();
    for (int i = 0; i < testSize; ++i)
        testStrB.CountSubstr(matchB);
    timer.Stop();
    Console.WriteLine("CS1 and: " + timer.Elapsed.TotalMilliseconds + "ms");

    timer.Restart();
    for (int i = 0; i < testSize; ++i)
        testStrC.CountSubstr(matchC);
    timer.Stop();
    Console.WriteLine("CS1 mlw: " + timer.Elapsed.TotalMilliseconds + "ms");

    timer.Restart();
    for (int i = 0; i < testSize; ++i)
        testStrA.CountSubstr2(matchA);
    timer.Stop();
    Console.WriteLine("CS2 chr: " + timer.Elapsed.TotalMilliseconds + "ms");

    timer.Restart();
    for (int i = 0; i < testSize; ++i)
        testStrB.CountSubstr2(matchB);
    timer.Stop();
    Console.WriteLine("CS2 and: " + timer.Elapsed.TotalMilliseconds + "ms");

    timer.Restart();
    for (int i = 0; i < testSize; ++i)
        testStrC.CountSubstr2(matchC);
    timer.Stop();
    Console.WriteLine("CS2 mlw: " + timer.Elapsed.TotalMilliseconds + "ms");

    timer.Restart();
    for (int i = 0; i < testSize; ++i)
        testStrA.CountSubstr3(matchA);
    timer.Stop();
    Console.WriteLine("CS3 chr: " + timer.Elapsed.TotalMilliseconds + "ms");

    timer.Restart();
    for (int i = 0; i < testSize; ++i)
        testStrB.CountSubstr3(matchB);
    timer.Stop();
    Console.WriteLine("CS3 and: " + timer.Elapsed.TotalMilliseconds + "ms");

    timer.Restart();
    for (int i = 0; i < testSize; ++i)
        testStrC.CountSubstr3(matchC);
    timer.Stop();
    Console.WriteLine("CS3 mlw: " + timer.Elapsed.TotalMilliseconds + "ms");

    timer.Restart();
    for (int i = 0; i < testSize; ++i)
        testStrA.CountSubstr4(matchA);
    timer.Stop();
    Console.WriteLine("CS4 chr: " + timer.Elapsed.TotalMilliseconds + "ms");

    timer.Restart();
    for (int i = 0; i < testSize; ++i)
        testStrB.CountSubstr4(matchB);
    timer.Stop();
    Console.WriteLine("CS4 and: " + timer.Elapsed.TotalMilliseconds + "ms");

    timer.Restart();
    for (int i = 0; i < testSize; ++i)
        testStrC.CountSubstr4(matchC);
    timer.Stop();
    Console.WriteLine("CS4 mlw: " + timer.Elapsed.TotalMilliseconds + "ms");

    timer.Restart();
    for (int i = 0; i < testSize; ++i)
        testStrA.CountChar(matchA);
    timer.Stop();
    Console.WriteLine("CC1 chr: " + timer.Elapsed.TotalMilliseconds + "ms");

    timer.Restart();
    for (int i = 0; i < testSize; ++i)
        testStrA.CountChar2(matchA);
    timer.Stop();
    Console.WriteLine("CC2 chr: " + timer.Elapsed.TotalMilliseconds + "ms");

    timer.Restart();
    for (int i = 0; i < testSize; ++i)
        testStrA.CountChar3(matchA);
    timer.Stop();
    Console.WriteLine("CC3 chr: " + timer.Elapsed.TotalMilliseconds + "ms");

    timer.Restart();
    for (int i = 0; i < testSize; ++i)
        testStrA.CountChar4(matchA);
    timer.Stop();
    Console.WriteLine("CC4 chr: " + timer.Elapsed.TotalMilliseconds + "ms");
} 
```

结果：CSX 对应 CountSubstrX，CCX 对应 CountCharX。“chr”在字符串中搜索“_”，“and”在字符串中搜索“and”，“mlw”在字符串中搜索“muchlongerword”

```
CS1 chr: 824.123ms
CS1 and: 586.1893ms
CS1 mlw: 486.5414ms
CS2 chr: 127.8941ms
CS2 and: 806.3918ms
CS2 mlw: 497.318ms
CS3 chr: 201.8896ms
CS3 and: 124.0675ms
CS3 mlw: 212.8341ms
CS4 chr: 81.5183ms
CS4 and: 92.0615ms
CS4 mlw: 116.2197ms
CC1 chr: 66.4078ms
CC2 chr: 64.0161ms
CC3 chr: 65.9013ms
CC4 chr: 65.8206ms 
```

最后，我有一个包含 360 万个字符的文件。它是“derp adfderdserp dfaerpderp deasderp”重复了 100,000 次。我用上述方法在文件中搜索了“derp”这些结果的 100 倍。

```
CS1Derp: 1501.3444ms
CS2Derp: 1585.797ms
CS3Derp: 376.0937ms
CS4Derp: 271.1663ms 
```

所以我的第 4 种方法绝对是赢家，但实际上，如果一个 360 万字符的文件 100 次只用了 1586ms 作为最坏的情况，那么这一切都可以忽略不计。

顺便说一句，我还用 100 次 CountSubstr 和 CountChar 方法扫描了 360 万个字符文件中的 'd' 字符。结果...

```
CS1  d : 2606.9513ms
CS2  d : 339.7942ms
CS3  d : 960.281ms
CS4  d : 233.3442ms
CC1  d : 302.4122ms
CC2  d : 280.7719ms
CC3  d : 299.1125ms
CC4  d : 292.9365ms 
```

据此，原始海报方法对于大海捞针中的单个字符非常不利。

注意：所有值都更新为发布版本输出。第一次发布此内容时，我不小心忘记了在发布模式下构建。我的一些陈述已被修改。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2012-03-10T13:31:02.520

字符串出现的通用函数：

```
public int getNumberOfOccurencies(String inputString, String checkString)
{
    if (checkString.Length > inputString.Length || checkString.Equals("")) { return 0; }
    int lengthDifference = inputString.Length - checkString.Length;
    int occurencies = 0;
    for (int i = 0; i < lengthDifference; i++) {
        if (inputString.Substring(i, checkString.Length).Equals(checkString)) { occurencies++; i += checkString.Length - 1; } }
    return occurencies;
} 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2013-01-25T16:07:28.793

```
string source = "/once/upon/a/time/";
int count = 0, n = 0;
while ((n = source.IndexOf('/', n) + 1) != 0) count++; 
```

理查德沃森答案的变体，字符串中出现字符的次数越多，代码越少，效率越高！

尽管我必须说，在没有对每个场景进行广泛测试的情况下，我确实看到通过使用以下方法可以显着提高速度：

```
int count = 0;
for (int n = 0; n < source.Length; n++) if (source[n] == '/') count++; 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2013-03-29T19:31:43.940

```
 var conditionalStatement = conditionSetting.Value;

            //order of replace matters, remove == before =, incase of ===
            conditionalStatement = conditionalStatement.Replace("==", "~").Replace("!=", "~").Replace('=', '~').Replace('!', '~').Replace('>', '~').Replace('<', '~').Replace(">=", "~").Replace("<=", "~");

            var listOfValidConditions = new List<string>() { "!=", "==", ">", "<", ">=", "<=" };

            if (conditionalStatement.Count(x => x == '~') != 1)
            {
                result.InvalidFieldList.Add(new KeyFieldData(batch.DECurrentField, "The IsDoubleKeyCondition does not contain a supported conditional statement. Contact System Administrator."));
                result.Status = ValidatorStatus.Fail;
                return result;
            } 
```

需要做一些类似于测试字符串中的条件语句的事情。

用单个字符替换我正在寻找的内容并计算单个字符的实例。

显然，在发生这种情况之前，需要检查您正在使用的单个字符是否不存在于字符串中，以避免错误计数。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2014-11-11T12:39:39.913

字符串中的字符串：

在“.. JD JD JD JD etc. and etc. JDJDJDJDJDJDJDJD and etc.”中找到“etc”

```
var strOrigin = " .. JD JD JD JD etc. and etc. JDJDJDJDJDJDJDJD and etc.";
var searchStr = "etc";
int count = (strOrigin.Length - strOrigin.Replace(searchStr, "").Length)/searchStr.Length. 
```

在将其丢弃为不健全/笨拙之前检查性能......

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2015-03-24T11:30:09.217

以为我会把我的扩展方法扔进戒指（有关更多信息，请参阅评论）。我没有做过任何正式的基准测试，但我认为对于大多数情况它必须非常快。

编辑：好的 - 所以这个 SO 问题让我想知道我们当前实现的性能将如何与这里介绍的一些解决方案相提并论。我决定做一些基准测试，发现我们的解决方案非常符合[Richard Watson](https://stackoverflow.com/a/6004505/5569922)提供的解决方案的性能，直到您使用大字符串 (100 Kb +)、大子字符串 (32 Kb + ) 和许多嵌入的重复 (10K +)。那时我们的解决方案慢了大约 2 到 4 倍。鉴于这一点以及我们非常喜欢 Richard Watson 提出的解决方案这一事实，我们相应地重构了我们的解决方案。我只是想让任何可能从中受益的人都可以使用它。

我们的原始解决方案：

```
 /// <summary>
    /// Counts the number of occurrences of the specified substring within
    /// the current string.
    /// </summary>
    /// <param name="s">The current string.</param>
    /// <param name="substring">The substring we are searching for.</param>
    /// <param name="aggressiveSearch">Indicates whether or not the algorithm 
    /// should be aggressive in its search behavior (see Remarks). Default 
    /// behavior is non-aggressive.</param>
    /// <remarks>This algorithm has two search modes - aggressive and 
    /// non-aggressive. When in aggressive search mode (aggressiveSearch = 
    /// true), the algorithm will try to match at every possible starting 
    /// character index within the string. When false, all subsequent 
    /// character indexes within a substring match will not be evaluated. 
    /// For example, if the string was 'abbbc' and we were searching for 
    /// the substring 'bb', then aggressive search would find 2 matches 
    /// with starting indexes of 1 and 2\. Non aggressive search would find 
    /// just 1 match with starting index at 1\. After the match was made, 
    /// the non aggressive search would attempt to make it's next match 
    /// starting at index 3 instead of 2.</remarks>
    /// <returns>The count of occurrences of the substring within the string.</returns>
    public static int CountOccurrences(this string s, string substring, 
        bool aggressiveSearch = false)
    {
        // if s or substring is null or empty, substring cannot be found in s
        if (string.IsNullOrEmpty(s) || string.IsNullOrEmpty(substring))
            return 0;

        // if the length of substring is greater than the length of s,
        // substring cannot be found in s
        if (substring.Length > s.Length)
            return 0;

        var sChars = s.ToCharArray();
        var substringChars = substring.ToCharArray();
        var count = 0;
        var sCharsIndex = 0;

        // substring cannot start in s beyond following index
        var lastStartIndex = sChars.Length - substringChars.Length;

        while (sCharsIndex <= lastStartIndex)
        {
            if (sChars[sCharsIndex] == substringChars[0])
            {
                // potential match checking
                var match = true;
                var offset = 1;
                while (offset < substringChars.Length)
                {
                    if (sChars[sCharsIndex + offset] != substringChars[offset])
                    {
                        match = false;
                        break;
                    }
                    offset++;
                }
                if (match)
                {
                    count++;
                    // if aggressive, just advance to next char in s, otherwise, 
                    // skip past the match just found in s
                    sCharsIndex += aggressiveSearch ? 1 : substringChars.Length;
                }
                else
                {
                    // no match found, just move to next char in s
                    sCharsIndex++;
                }
            }
            else
            {
                // no match at current index, move along
                sCharsIndex++;
            }
        }

        return count;
    } 
```

这是我们修改后的解决方案：

```
 /// <summary>
    /// Counts the number of occurrences of the specified substring within
    /// the current string.
    /// </summary>
    /// <param name="s">The current string.</param>
    /// <param name="substring">The substring we are searching for.</param>
    /// <param name="aggressiveSearch">Indicates whether or not the algorithm 
    /// should be aggressive in its search behavior (see Remarks). Default 
    /// behavior is non-aggressive.</param>
    /// <remarks>This algorithm has two search modes - aggressive and 
    /// non-aggressive. When in aggressive search mode (aggressiveSearch = 
    /// true), the algorithm will try to match at every possible starting 
    /// character index within the string. When false, all subsequent 
    /// character indexes within a substring match will not be evaluated. 
    /// For example, if the string was 'abbbc' and we were searching for 
    /// the substring 'bb', then aggressive search would find 2 matches 
    /// with starting indexes of 1 and 2\. Non aggressive search would find 
    /// just 1 match with starting index at 1\. After the match was made, 
    /// the non aggressive search would attempt to make it's next match 
    /// starting at index 3 instead of 2.</remarks>
    /// <returns>The count of occurrences of the substring within the string.</returns>
    public static int CountOccurrences(this string s, string substring, 
        bool aggressiveSearch = false)
    {
        // if s or substring is null or empty, substring cannot be found in s
        if (string.IsNullOrEmpty(s) || string.IsNullOrEmpty(substring))
            return 0;

        // if the length of substring is greater than the length of s,
        // substring cannot be found in s
        if (substring.Length > s.Length)
            return 0;

        int count = 0, n = 0;
        while ((n = s.IndexOf(substring, n, StringComparison.InvariantCulture)) != -1)
        {
            if (aggressiveSearch)
                n++;
            else
                n += substring.Length;
            count++;
        }

        return count;
    } 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2015-05-29T01:20:20.320

我最初的看法给了我类似的东西：

```
public static int CountOccurrences(string original, string substring)
{
    if (string.IsNullOrEmpty(substring))
        return 0;
    if (substring.Length == 1)
        return CountOccurrences(original, substring[0]);
    if (string.IsNullOrEmpty(original) ||
        substring.Length > original.Length)
        return 0;
    int substringCount = 0;
    for (int charIndex = 0; charIndex < original.Length; charIndex++)
    {
        for (int subCharIndex = 0, secondaryCharIndex = charIndex; subCharIndex < substring.Length && secondaryCharIndex < original.Length; subCharIndex++, secondaryCharIndex++)
        {
            if (substring[subCharIndex] != original[secondaryCharIndex])
                goto continueOuter;
        }
        if (charIndex + substring.Length > original.Length)
            break;
        charIndex += substring.Length - 1;
        substringCount++;
    continueOuter:
        ;
    }
    return substringCount;
}

public static int CountOccurrences(string original, char @char)
{
    if (string.IsNullOrEmpty(original))
        return 0;
    int substringCount = 0;
    for (int charIndex = 0; charIndex < original.Length; charIndex++)
        if (@char == original[charIndex])
            substringCount++;
    return substringCount;
} 
```

使用替换和除法的大海捞针方法产生 21 多秒，而这大约需要 15.2 秒。

在添加一点会添加`substring.Length - 1`到 charIndex 之后进行编辑（就像它应该的那样），它是 11.6 秒。

编辑 2：我使用了一个包含 26 个双字符字符串的字符串，以下是更新为相同示例文本的时间：

大海捞针（OP 版本）：7.8 秒

建议机制：4.6 秒。

编辑 3：添加单个字符的角盒，它达到 1.2 秒。

编辑 4：对于上下文：使用了 5000 万次迭代。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2011-12-09T13:18:27.557

```
str="aaabbbbjjja";
int count = 0;
int size = str.Length;

string[] strarray = new string[size];
for (int i = 0; i < str.Length; i++)
{
    strarray[i] = str.Substring(i, 1);
}
Array.Sort(strarray);
str = "";
for (int i = 0; i < strarray.Length - 1; i++)
{

    if (strarray[i] == strarray[i + 1])
    {

        count++;
    }
    else
    {
        count++;
        str = str + strarray[i] + count;
        count = 0;
    }

}
count++;
str = str + strarray[strarray.Length - 1] + count; 
```

这是为了计算字符出现次数。对于此示例，输出将为“a4b4j3”

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2012-04-04T07:29:47.897

```
string Name = "Very good nice one is very good but is very good nice one this is called the term";
bool valid=true;
int count = 0;
int k=0;
int m = 0;
while (valid)
{
    k = Name.Substring(m,Name.Length-m).IndexOf("good");
    if (k != -1)
    {
        count++;
        m = m + k + 4;
    }
    else
        valid = false;
}
Console.WriteLine(count + " Times accures"); 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2014-08-16T13:26:58.853

如果您[查看此网页](http://cc.davelozinski.com/c-sharp/fastest-way-count-number-times-character-occurs-string "http://cc.davelozinski.com/c-sharp/fastest-way-count-number-times-character-occurs-string")，则会对 15 种不同的方法进行基准测试，包括使用并行循环。

最快的方法似乎是使用单线程 for 循环（如果您的 .Net 版本 < 4.0）或 parallel.for 循环（如果使用具有数千次检查的 .Net > 4.0）。

假设“ss”是您的搜索字符串，“ch”是您的字符数组（如果您要查找的字符不止一个），以下是单线程运行时间最快的代码的基本要点：

```
for (int x = 0; x < ss.Length; x++)
{
    for (int y = 0; y < ch.Length; y++)
    {
        for (int a = 0; a < ss[x].Length; a++ )
        {
        if (ss[x][a] == ch[y])
            //it's found. DO what you need to here.
        }
    }
} 
```

还提供了基准源代码，因此您可以运行自己的测试。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2014-06-14T18:34:35.870

```
string s = "HOWLYH THIS ACTUALLY WORKSH WOWH";
int count = 0;
for (int i = 0; i < s.Length; i++)
   if (s[i] == 'H') count++; 
```

它只是检查字符串中的每个字符，如果该字符是您要搜索的字符，则加一个计数。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2017-11-17T20:33:17.387

对于字符串分隔符的情况（不是 char 情况，如主题所说）：
string source = "@@@once@@@upon@@@a@@@time@@@";
int count = source.Split(new[] { "@@@" }, StringSplitOptions.RemoveEmptyEntries).Length - 1;

海报的原始源值的（“/once/once/a/time/”）自然分隔符是 char '/' 并且响应确实解释了 source.Split(char[]) 选项...

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2020-11-10T16:47:33.957

**计算字符或字符串**

```
 string st = "asdfasdfasdfsadfasdf/asdfasdfas/dfsdfsdafsdfsd/fsadfasdf/dff";
        int count = 0;
        int location = 0;

        while (st.IndexOf("/", location + 1) > 0)
        {
                count++;
                location = st.IndexOf("/", location + 1);
        }
        MessageBox.Show(count.ToString()); 
```

# asp.net - Sys.Application.add_load 模态弹出扩展器的问题

> ID：541956
> 
> 赞同：3
> 
> 时间：2009-02-12T15:57:50.143
> 
> 标签：asp.net, javascript, ajax, asp.net-ajax, ajaxcontroltoolkit

我有当前的问题，让我们解释一下之前的上下文：

我有一个包含表单的模态弹出扩展器。有一个功能“保存并添加新”，当用户单击此按钮时，表单中的数据在回发期间保存在数据库中并重新加载页面。

我希望此 Modal 弹出窗口再次出现在 page_load 上，允许用户输入新数据而无需再次单击显示此 Modal Popup 的按钮。

我试着先这样称呼它：

```
ClientScript.RegisterStartupScript(Page.GetType(), "ModalPopup", "ShowModalPopup(""" & Me.formModalButton.ID & """);", True) 
```

但问题是当函数被调用时，我的 Modal Popup 在页面上尚不存在。因此，代码在

```
var modal = $find('myModal'); 
```

所以，我发现了另一种方式，它**几乎**完美地工作。

```
ClientScript.RegisterStartupScript(Page.GetType(), "ModalPopup", "Sys.Application.add_load(function() {ShowModalPopup(""" & Me.formModalButton.ID & """)};", True) 
```

模态显示在我想要的页面加载上，但问题是如果我单击页面上的任何其他按钮，模态弹出窗口也会再次出现。

示例：我有另一个用于删除数据的 Modal Popup，当我单击按钮时，两个 Modal 都出现了，这并不酷。

有没有人知道如何解决这个问题或更好的方法？

PS我没有调用模态弹出服务器端，因为页面中存在javascript函数，所以我不想在RegisterStartupScript中创建这个函数的副本。

谢谢你的时间。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T16:23:10.410

使用下面的代码片段

```
//Declares gloabal variable
ClientScript.RegisterStartupScript(Page.GetType(),"vardeclaration","var reloadModal;",true);

ClientScript.RegisterStartupScript(Page.GetType(), "ModalPopup", "Sys.Application.add_load(

function() 
{
   reloadModal = function() {ShowAddModalPopup(""" & Me.imgAdd.ID & """);};
   Sys.Application.add_init(reloadModal);
}
);", True) 
```

这将允许您使用

```
function cancelClick()
{
   Sys.application.remove_init(reloadModal);
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-13T15:32:10.133

最后，我找到了解决当前问题的方法。

我仍在使用 ClientScript.Resgister[...] 但这次我还更改了取消按钮的 OnClientClick Javascript 函数。

因此，当这个人选择“保存并添加新”功能时，当页面重新加载并且模式再次显示时，如果他单击取消，我会回发到服务器只是为了重新加载页面并解决那些奇怪的行为。

我还认为，由于我的代码中的更新面板不同，问题可能存在，但我需要它们来使 Modal Popup Extender 工作。

无论如何，我发现它甚至不能在 Opera 和 Safari 中工作，而是整个事情（Ajax 控制工具包 - 模态弹出扩展器）。

这是一个机会，这里的公司不关心其他人，并且官方只支持 IE。就我而言，我想让它至少在 FF 和 Chrome 中也能正常工作。

```
ClientScript.RegisterStartupScript(Page.GetType(), "ModalPopup", "Sys.Application.add_load(function() {ShowAddModalPopup(""" & Me.imgAdd.ID & """)});", True)
                btnCancel.OnClientClick = "resetDefaultValue();__doPostBack('" & btnCancel.ID & "','onclick')" 
```

所以有代码，在FF中也出现另一个错误，

**Sys.WebForms.PageRequestManagerServerErrorException：处理服务器上的请求时发生未知错误。从服务器返回的状态码是：0**

我找到了这个解决方法，它不是最好的，但我为此浪费了足够多的时间......

```
ClientScript.RegisterStartupScript(Page.GetType(), "WorkAroundFF", "Sys.WebForms.PageRequestManager.getInstance().add_endRequest(endRequest); function endRequest(sender, args) { /* Check to see if there's an error on this request.*/ if (args.get_error() != undefined) { $get('Error').style.visibility = ""visible""; /* Let the framework know that the error is handled, so it doesn't throw the JavaScript*/ alert. args.set_errorHandled(true); } }", True) 
```

因此，感谢您的帮助 Ramesh，如果不是我的更新面板，我很确定您的解决方案会起作用。

希望可以帮助别人。

# ruby-on-rails - 控制器中的继承

> ID：541960
> 
> 赞同：0
> 
> 时间：2009-02-12T15:58:11.080
> 
> 标签：ruby-on-rails, ruby

我在我的模型中使用继承。一个事件有不同的类型：

```
Event < activity
Event < training
Event < game 
```

我想将会话数据设置为每种事件类型，例如

```
game.user_id = session[:user_id]
training.user_id = session[:user_id]
activity.user_id = session[:user_id] 
```

我想避免在活动、游戏和训练控制器的每个创建方法中编写 @game.user_id = session[:user_id] , ..., ...

有人知道如何最好地解决这个问题。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T17:14:07.557

也许您正在寻找驻留在 ApplicationController 中的 before_filter？然后在每个控制器中，您可以将 before_filter 设置为在创建操作时运行。

```
ApplicationController
  def set_user_ids
    game.user_id = session[:user_id]
    training.user_id = session[:user_id]
    activity.user_id = session[:user_id]
  end
  ...
end

OneController < ApplicationController
  before_filter :set_user_ids, :only => [:create]
  ...
end

TwoController < ApplicationController
  before_filter :set_user_ids, :only => [:create]
  ...
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-14T23:05:06.527

不要使用 game.user_id，而是可以这样做：

```
game = current_user.games.build(params[:game])
if game.save
  # do something
else
  # do something else
end 
```

对您的其他控制器也重复此操作！

[协会指南](http://guides.rubyonrails.org/association_basics.html)也可能会有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T03:59:09.593

通常，您会希望使用 Rails 提供的内置范围。只是为了充实@Radar 已经发布的内容：

```
class ApplicationController < ActionController::Base
  before_filter :find_current_user

  private
    def find_current_user
      @current_user = User.find( session[:user_id] )
    end
end

class EventsController < ApplicationController
  def create
    @event = @current_user.events.build( params[:event] )
    @event.save!
  end
end 
```

这假设您已经在模型中设置了关联：

```
class User
  has_many :events
end

class Event
  belongs_to :user
end 
```

如果您需要限制用户可以查看或编辑的内容，这也是一种相当方便的机制：

```
class EventsController < ApplicationController
  def index
    @events = @current_user.events # only fetch current users events
  end

  def update
    @event = @current_user.events.find( params[:id] ) # can't update other user's events
    @event.update_attributes!( params[:event] )
  end
end 
```

# cocoa-touch - 检测 iPhone 上的特殊触摸

> ID：541962
> 
> 赞同：3
> 
> 时间：2009-02-12T15:58:13.513
> 
> 标签：cocoa-touch

我在问自己是否有在线示例涵盖了如何检测触摸手势中的形状。

例如矩形或圆形（或更复杂的心脏..）

或确定刷卡的速度（随着时间的推移（比如我正在以 50 英里/小时的速度刷我的 iPhone））

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-12T16:21:30.070

对于非常简单的手势（水平与垂直滑动），计算两次触摸之间 x 和 y 的差异。

```
dy = abs(y2 - y1)
dx = abs(x2 - x1)
f = dy/dx 
```

接近零的 f 是水平滑动。接近 1 的 f 是对角线滑动。一个非常大的 f 是垂直滑动（请记住，dx 可能为零，因此上述不会对所有 x 和 y 产生有效结果）。

如果您对速度感兴趣，毕达哥拉斯可以提供帮助。两次触摸之间经过的距离长度为：

```
l = sqrt(dx*dx + dy*dy) 
```

如果触摸发生在时间 t1 和 t2，则速度为：

```
tdiff = abs(t2 - t1)
s = l/tdiff 
```

由您决定将 s 的哪个值解释为快或慢。

您可以将此方法扩展到更复杂的图形，例如，您的方形可以是水平/垂直/水平/垂直滑动，其起点/终点位于前一次滑动停止的位置。

对于更复杂的图形，使用理想化的形状可能会更好。可以将多边形形状视为理想的形状，并检查是否有一系列触摸

1.  与 pologyon 轮廓上最近点的距离不要太高，并且
2.  所有的触摸都沿着多边形的轮廓沿着相同的方向进行。

你可以从那里进一步改进。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-11-14T18:56:07.073

确实存在用于检测触摸屏上的非简单触摸的其他方法。查看华盛顿大学 1 美元的单笔手势识别器。[http://depts.washington.edu/aimgroup/proj/dollar/](http://depts.washington.edu/aimgroup/proj/dollar/)

它基本上是这样工作的：

1.  将记录的路径重采样为沿路径均匀分布的固定数量的点
2.  旋转路径，使第一个点直接位于路径质心的右​​侧
3.  将路径（非均匀）缩放到固定的高度和宽度
4.  对于每个参考路径，计算输入路径中对应点的平均距离。平均点距离最短的路径是匹配的。

很棒的是，步骤 1-3 的输出是可以添加到已知手势数组中的参考路径。这使得为​​您的应用程序提供手势支持和创建您自己的自定义手势集变得非常容易，只要您认为合适。

这已由 Adam Preble 移植到 iOS，github 上的 repo：http: [//github.com/preble/GLGestureRecognizer](http://github.com/preble/GLGestureRecognizer)

# c# - VS Debug Immediate 窗口在哪个线程中执行命令？

> ID：541963
> 
> 赞同：1
> 
> 时间：2009-02-12T15:58:14.590
> 
> 标签：c#, .net, visual-studio-2008, multithreading, debugging

我有一个多线程的 .Net 应用程序，其中线程本地存储用于保存各种标志。我有理由怀疑在其中一个线程中错误地设置了标志，并希望使用 VS 调试器检查设置标志的时间和位置。

在断点处停止应用程序后，是否可以使用即时窗口检查该线程本地标志？

更具体地说，即时窗口将在哪个线程上执行以下命令

```
Thread.GetData(Thread.GetNamedDataSlot(flagName)) 
```

或者，您能否建议监控每个线程的这些标志的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T16:06:49.327

尝试命名所有线程，然后`?Thread.CurrentThread.Name`在控制台上说。或者显示托管线程 ID。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-12T16:08:29.697

试验

```
Thread.CurrentThread.ManagedThreadId 
```

建议立即窗口做正确的事情并在与带有断点的代码相同的线程中执行。

# android - 如何在 Android 的 ListView 中延迟加载图像

> ID：541966
> 
> 赞同：2037
> 
> 时间：2009-02-12T15:59:00.827
> 
> 标签：android, image, listview, url, universal-image-loader

我正在使用 a`ListView`来显示与这些图像相关的一些图像和标题。我正在从互联网上获取图像。有没有办法延迟加载图像，以便在文本显示时，UI 不会被阻止并且图像在下载时显示？

图像的总数不固定。

* * *

## 回答 #1

> 赞同：1138
> 
> 时间：2009-02-18T03:56:58.083

这是我为保存我的应用当前显示的图像而创建的。请注意，这里使用的“Log”对象是我在 Android 中围绕最终 Log 类的自定义包装器。

```
package com.wilson.android.library;

/*
 Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
*/
import java.io.IOException;

public class DrawableManager {
    private final Map<String, Drawable> drawableMap;

    public DrawableManager() {
        drawableMap = new HashMap<String, Drawable>();
    }

    public Drawable fetchDrawable(String urlString) {
        if (drawableMap.containsKey(urlString)) {
            return drawableMap.get(urlString);
        }

        Log.d(this.getClass().getSimpleName(), "image url:" + urlString);
        try {
            InputStream is = fetch(urlString);
            Drawable drawable = Drawable.createFromStream(is, "src");

            if (drawable != null) {
                drawableMap.put(urlString, drawable);
                Log.d(this.getClass().getSimpleName(), "got a thumbnail drawable: " + drawable.getBounds() + ", "
                        + drawable.getIntrinsicHeight() + "," + drawable.getIntrinsicWidth() + ", "
                        + drawable.getMinimumHeight() + "," + drawable.getMinimumWidth());
            } else {
              Log.w(this.getClass().getSimpleName(), "could not get thumbnail");
            }

            return drawable;
        } catch (MalformedURLException e) {
            Log.e(this.getClass().getSimpleName(), "fetchDrawable failed", e);
            return null;
        } catch (IOException e) {
            Log.e(this.getClass().getSimpleName(), "fetchDrawable failed", e);
            return null;
        }
    }

    public void fetchDrawableOnThread(final String urlString, final ImageView imageView) {
        if (drawableMap.containsKey(urlString)) {
            imageView.setImageDrawable(drawableMap.get(urlString));
        }

        final Handler handler = new Handler() {
            @Override
            public void handleMessage(Message message) {
                imageView.setImageDrawable((Drawable) message.obj);
            }
        };

        Thread thread = new Thread() {
            @Override
            public void run() {
                //TODO : set imageView to a "pending" image
                Drawable drawable = fetchDrawable(urlString);
                Message message = handler.obtainMessage(1, drawable);
                handler.sendMessage(message);
            }
        };
        thread.start();
    }

    private InputStream fetch(String urlString) throws MalformedURLException, IOException {
        DefaultHttpClient httpClient = new DefaultHttpClient();
        HttpGet request = new HttpGet(urlString);
        HttpResponse response = httpClient.execute(request);
        return response.getEntity().getContent();
    }
} 
```

* * *

## 回答 #2

> 赞同：1051
> 
> 时间：2010-06-18T08:04:09.800

我做了一个带有图像的惰性列表（位于 GitHub）[的简单演示。](https://github.com/thest1/LazyList)

> 基本用法
> 
> ```
> ImageLoader imageLoader=new ImageLoader(context); ...
> imageLoader.DisplayImage(url, imageView); 
> ```
> 
> 不要忘记将以下权限添加到您的 AndroidManifest.xml：
> 
> ```
>  <uses-permission android:name="android.permission.INTERNET"/>
>  <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"/> Please 
> ```
> 
> 只创建一个 ImageLoader 实例并在您的应用程序中重用它。这种方式图像缓存将更加有效。

它可能对某人有帮助。它在后台线程中下载图像。图像缓存在 SD 卡和内存中。缓存实现非常简单，对于演示来说已经足够了。我使用 inSampleSize 解码图像以减少内存消耗。我也尝试正确处理回收的视图。

![替代文字](https://i.stack.imgur.com/1NvdB.png)

* * *

## 回答 #3

> 赞同：565
> 
> 时间：2011-12-19T13:53:04.967

我推荐开源仪器**[Universal Image Loader](https://github.com/nostra13/Android-Universal-Image-Loader)**。它最初基于 Fedor Vlasov 的项目**LazyList**并从那时起得到了极大的改进。

*   多线程图像加载
*   可以广泛调整 ImageLoader 的配置（线程执行器、下载器、解码器、内存和磁盘缓存、显示图像选项等）
*   在内存和/或设备的文件系统（或 SD 卡）中缓存图像的可能性
*   “听”加载过程的可能性
*   可以使用单独的选项自定义每个显示图像调用
*   小部件支持
*   安卓 2.0+ 支持

[![](https://i.stack.imgur.com/QzOIL.png)](https://github.com/nostra13/Android-Universal-Image-Loader)

* * *

## 回答 #4

> 赞同：168
> 
> 时间：2010-08-12T11:07:32.407

[Multithreading For Performance](http://android-developers.blogspot.com/2010/07/multithreading-for-performance.html)，Gilles Debunne 的教程。

这来自 Android 开发者博客。建议的代码使用：

*   `AsyncTasks`.
*   一个硬的，有限的大小，`FIFO cache`.
*   一个软的、易于`garbage collect`编辑的缓存。
*   下载时的*占位符* `Drawable`。

![在此处输入图像描述](https://i.stack.imgur.com/xdEVJ.png)

* * *

## 回答 #5

> 赞同：119
> 
> 时间：2010-05-05T13:16:28.717

**更新：请注意，这个答案现在非常无效。Garbage Collector 对 SoftReference 和 WeakReference 采取积极行动，因此此代码不适合新应用程序。** （相反，请尝试其他答案中建议的[Universal Image Loader等库。）](https://github.com/nostra13/Android-Universal-Image-Loader)

感谢 James 提供代码，感谢 Bao-Long 提供使用 SoftReference 的建议。我在 James 的代码上实现了 SoftReference 更改。不幸的是，SoftReferences 导致我的图像被垃圾收集得太快了。在我的情况下，没有 SoftReference 的东西很好，因为我的列表大小是有限的而且我的图像很小。

一年前有一个关于 google 组上的 SoftReferences 的讨论：[link to thread](http://groups.google.com/group/android-developers/browse_thread/thread/ebabb0dadf38acc1)。作为过早垃圾收集的解决方案，他们建议使用 dalvik.system.VMRuntime.setMinimumHeapSize() 手动设置 VM 堆大小的可能性，这对我来说不是很有吸引力。

```
public DrawableManager() {
    drawableMap = new HashMap<String, SoftReference<Drawable>>();
}

public Drawable fetchDrawable(String urlString) {
    SoftReference<Drawable> drawableRef = drawableMap.get(urlString);
    if (drawableRef != null) {
        Drawable drawable = drawableRef.get();
        if (drawable != null)
            return drawable;
        // Reference has expired so remove the key from drawableMap
        drawableMap.remove(urlString);
    }

    if (Constants.LOGGING) Log.d(this.getClass().getSimpleName(), "image url:" + urlString);
    try {
        InputStream is = fetch(urlString);
        Drawable drawable = Drawable.createFromStream(is, "src");
        drawableRef = new SoftReference<Drawable>(drawable);
        drawableMap.put(urlString, drawableRef);
        if (Constants.LOGGING) Log.d(this.getClass().getSimpleName(), "got a thumbnail drawable: " + drawable.getBounds() + ", "
                + drawable.getIntrinsicHeight() + "," + drawable.getIntrinsicWidth() + ", "
                + drawable.getMinimumHeight() + "," + drawable.getMinimumWidth());
        return drawableRef.get();
    } catch (MalformedURLException e) {
        if (Constants.LOGGING) Log.e(this.getClass().getSimpleName(), "fetchDrawable failed", e);
        return null;
    } catch (IOException e) {
        if (Constants.LOGGING) Log.e(this.getClass().getSimpleName(), "fetchDrawable failed", e);
        return null;
    }
}

public void fetchDrawableOnThread(final String urlString, final ImageView imageView) {
    SoftReference<Drawable> drawableRef = drawableMap.get(urlString);
    if (drawableRef != null) {
        Drawable drawable = drawableRef.get();
        if (drawable != null) {
            imageView.setImageDrawable(drawableRef.get());
            return;
        }
        // Reference has expired so remove the key from drawableMap
        drawableMap.remove(urlString);
    }

    final Handler handler = new Handler() {
        @Override
        public void handleMessage(Message message) {
            imageView.setImageDrawable((Drawable) message.obj);
        }
    };

    Thread thread = new Thread() {
        @Override
        public void run() {
            //TODO : set imageView to a "pending" image
            Drawable drawable = fetchDrawable(urlString);
            Message message = handler.obtainMessage(1, drawable);
            handler.sendMessage(message);
        }
    };
    thread.start();
} 
```

* * *

## 回答 #6

> 赞同：105
> 
> 时间：2014-04-04T12:35:07.650

**毕加索**

使用杰克沃顿的毕加索图书馆。（ActionBarSherlock 开发者提供的完美 ImageLoading 库）

一个强大的安卓图像下载和缓存库。

图像为 Android 应用程序添加了急需的上下文和视觉风格。Picasso 允许在您的应用程序中轻松加载图像——通常只需一行代码！

```
Picasso.with(context).load("http://i.imgur.com/DvpvklR.png").into(imageView); 
```

Picasso 会自动处理 Android 上许多常见的图像加载陷阱：

在适配器中处理 ImageView 回收和下载取消。使用最少的内存进行复杂的图像转换。自动内存和磁盘缓存。

[毕加索杰克沃顿图书馆](http://square.github.io/picasso/)

**滑行**

Glide 是一个快速高效的 Android 开源媒体管理框架，它将媒体解码、内存和磁盘缓存以及资源池封装到一个简单易用的界面中。

Glide 支持获取、解码和显示视频静止图像、图像和动画 GIF。Glide 包含一个灵活的 API，允许开发人员插入几乎任何网络堆栈。默认情况下，Glide 使用自定义的基于 HttpUrlConnection 的堆栈，但也包含实用程序库插件到 Google 的 Volley 项目或 Square 的 OkHttp 库。

```
Glide.with(this).load("your-url-here").into(imageView); 
```

Glide 的主要重点是使滚动任何类型的图像列表尽可能平滑和快速，但 Glide 也适用于几乎所有需要获取、调整大小和显示远程图像的情况。

[Glide 图像加载库](https://github.com/bumptech/glide)

**Facebook的壁画**

Fresco 是一个强大的系统，用于在 Android 应用程序中显示图像。

Fresco 负责图像加载和显示，因此您不必这样做。它将从网络、本地存储或本地资源加载图像，并显示一个占位符，直到图像到达。它有两级缓存；一个在内存中，另一个在内部存储中。

[壁画 Github](https://github.com/facebook/fresco)

在 Android 4.x 及更低版本中，Fresco 将图像放在 Android 内存的特殊区域中。这可以让您的应用程序运行得更快 - 并且更少地遭受可怕的 OutOfMemoryError。

[壁画文档](http://frescolib.org/docs/index.html#_)

* * *

## 回答 #7

> 赞同：88
> 
> 时间：2011-10-22T16:44:05.700

高性能加载器 - 在检查了这里建议的方法之后，我使用了[Ben 的解决方案](http://negativeprobability.blogspot.com/2011/08/lazy-loading-of-images-in-listview.html)并进行了一些更改 -

1.  我意识到使用drawable比使用位图更快，所以我使用drawable代替

2.  使用 SoftReference 很好，但它会使缓存的图像被过于频繁地删除，所以我添加了一个包含图像引用的链接列表，防止图像被删除，直到它达到预定义的大小

3.  要打开 InputStream，我使用了 java.net.URLConnection，它允许我使用 Web 缓存（您需要先设置响应缓存，但这是另一回事）

我的代码：

```
import java.util.Map; 
import java.util.HashMap; 
import java.util.LinkedList; 
import java.util.Collections; 
import java.util.WeakHashMap; 
import java.lang.ref.SoftReference; 
import java.util.concurrent.Executors; 
import java.util.concurrent.ExecutorService; 
import android.graphics.drawable.Drawable;
import android.widget.ImageView;
import android.os.Handler;
import android.os.Message;
import java.io.InputStream;
import java.net.MalformedURLException; 
import java.io.IOException; 
import java.net.URL;
import java.net.URLConnection;

public class DrawableBackgroundDownloader {    

private final Map<String, SoftReference<Drawable>> mCache = new HashMap<String, SoftReference<Drawable>>();   
private final LinkedList <Drawable> mChacheController = new LinkedList <Drawable> ();
private ExecutorService mThreadPool;  
private final Map<ImageView, String> mImageViews = Collections.synchronizedMap(new WeakHashMap<ImageView, String>());  

public static int MAX_CACHE_SIZE = 80; 
public int THREAD_POOL_SIZE = 3;

/**
 * Constructor
 */
public DrawableBackgroundDownloader() {  
    mThreadPool = Executors.newFixedThreadPool(THREAD_POOL_SIZE);  
}  

/**
 * Clears all instance data and stops running threads
 */
public void Reset() {
    ExecutorService oldThreadPool = mThreadPool;
    mThreadPool = Executors.newFixedThreadPool(THREAD_POOL_SIZE);
    oldThreadPool.shutdownNow();

    mChacheController.clear();
    mCache.clear();
    mImageViews.clear();
}  

public void loadDrawable(final String url, final ImageView imageView,Drawable placeholder) {  
    mImageViews.put(imageView, url);  
    Drawable drawable = getDrawableFromCache(url);  

    // check in UI thread, so no concurrency issues  
    if (drawable != null) {  
        //Log.d(null, "Item loaded from mCache: " + url);  
        imageView.setImageDrawable(drawable);  
    } else {  
        imageView.setImageDrawable(placeholder);  
        queueJob(url, imageView, placeholder);  
    }  
} 

private Drawable getDrawableFromCache(String url) {  
    if (mCache.containsKey(url)) {  
        return mCache.get(url).get();  
    }  

    return null;  
}

private synchronized void putDrawableInCache(String url,Drawable drawable) {  
    int chacheControllerSize = mChacheController.size();
    if (chacheControllerSize > MAX_CACHE_SIZE) 
        mChacheController.subList(0, MAX_CACHE_SIZE/2).clear();

    mChacheController.addLast(drawable);
    mCache.put(url, new SoftReference<Drawable>(drawable));

}  

private void queueJob(final String url, final ImageView imageView,final Drawable placeholder) {  
    /* Create handler in UI thread. */  
    final Handler handler = new Handler() {  
        @Override  
        public void handleMessage(Message msg) {  
            String tag = mImageViews.get(imageView);  
            if (tag != null && tag.equals(url)) {
                if (imageView.isShown())
                    if (msg.obj != null) {
                        imageView.setImageDrawable((Drawable) msg.obj);  
                    } else {  
                        imageView.setImageDrawable(placeholder);  
                        //Log.d(null, "fail " + url);  
                    } 
            }  
        }  
    };  

    mThreadPool.submit(new Runnable() {  
        @Override  
        public void run() {  
            final Drawable bmp = downloadDrawable(url);
            // if the view is not visible anymore, the image will be ready for next time in cache
            if (imageView.isShown())
            {
                Message message = Message.obtain();  
                message.obj = bmp;
                //Log.d(null, "Item downloaded: " + url);  

                handler.sendMessage(message);
            }
        }  
    });  
}  

private Drawable downloadDrawable(String url) {  
    try {  
        InputStream is = getInputStream(url);

        Drawable drawable = Drawable.createFromStream(is, url);
        putDrawableInCache(url,drawable);  
        return drawable;  

    } catch (MalformedURLException e) {  
        e.printStackTrace();  
    } catch (IOException e) {  
        e.printStackTrace();  
    }  

    return null;  
}  

private InputStream getInputStream(String urlString) throws MalformedURLException, IOException {
    URL url = new URL(urlString);
    URLConnection connection;
    connection = url.openConnection();
    connection.setUseCaches(true); 
    connection.connect();
    InputStream response = connection.getInputStream();

    return response;
}
} 
```

* * *

## 回答 #8

> 赞同：82
> 
> 时间：2012-12-27T23:27:16.260

我遵循了这个 Android 培训，我认为它在不阻塞主 UI 的情况下下载图像做得很好。它还处理缓存和处理许多图像的滚动：[Loading Large Bitmaps Efficiently](http://developer.android.com/training/displaying-bitmaps/load-bitmap.html)

![](https://i.stack.imgur.com/zqoX2.jpg)

* * *

## 回答 #9

> 赞同：72
> 
> 时间：2014-05-22T06:00:49.807

**1\.** [**Picasso**](http://square.github.io/picasso/)允许在您的应用程序中轻松加载图像——通常只需一行代码！

**使用摇篮：**

```
implementation 'com.squareup.picasso:picasso:(insert latest version)' 
```

只需一行代码！

```
Picasso.get().load("http://i.imgur.com/DvpvklR.png").into(imageView); 
```

**2\.** [**Glide**](https://github.com/bumptech/glide)一个专注于平滑滚动的Android图像加载和缓存库

**使用摇篮：**

```
repositories {
  mavenCentral() 
  google()
}

dependencies {
   implementation 'com.github.bumptech.glide:glide:4.11.0'
   annotationProcessor 'com.github.bumptech.glide:compiler:4.11.0'
} 
```

**// 对于一个简单的视图：**

```
 Glide.with(this).load("http://i.imgur.com/DvpvklR.png").into(imageView); 
```

**3\.** [**fresco**](https://github.com/facebook/fresco) 是一个强大的系统，用于在 Android 应用程序中显示图像。Fresco 负责图像的加载和显示，因此您不必这样做。

[**开始使用 Fresco**](http://frescolib.org/docs/index.html)

* * *

## 回答 #10

> 赞同：56
> 
> 时间：2011-08-27T12:54:34.627

我写了一个教程，解释了如何在列表视图中延迟加载图像。我详细介绍了回收和并发问题。我还使用固定线程池来防止产生大量线程。

[Listview教程中的图像延迟加载](http://negativeprobability.blogspot.com/2011/08/lazy-loading-of-images-in-listview.html)

* * *

## 回答 #11

> 赞同：46
> 
> 时间：2009-02-12T20:07:14.413

我这样做的方法是启动一个线程以在后台下载图像并将每个列表项的回调交给它。当图像下载完成后，它会调用回调来更新列表项的视图。

但是，当您回收视图时，此方法效果不佳。

* * *

## 回答 #12

> 赞同：36
> 
> 时间：2011-12-14T10:57:42.687

我只想再添加一个很好的例子，*[XML Adapters](http://developer.android.com/resources/samples/XmlAdapters/index.html)*。因为它被谷歌使用，我也使用相同的逻辑来避免 OutOfMemory 错误。

基本上[这个 ImageDownloader](http://developer.android.com/resources/samples/XmlAdapters/src/com/example/android/xmladapters/ImageDownloader.html)就是你的答案（因为它涵盖了你的大部分要求）。有些你也可以在其中实现。

* * *

## 回答 #13

> 赞同：33
> 
> 时间：2013-06-13T15:17:05.790

我一直在使用新的 Android Volley Library 中的 NetworkImageView `com.android.volley.toolbox.NetworkImageView`，它似乎工作得很好。显然，这与[Google Play](http://en.wikipedia.org/wiki/Google_Play)和其他新的 Google 应用程序中使用的视图相同。绝对值得一试。

*   [Google I/O 2013 凌空图像缓存教程](http://blogs.captechconsulting.com/blog/raymond-robinson/google-io-2013-volley-image-cache-tutorial)

*   [开发者谷歌活动](https://developers.google.com/events/io/sessions/325304728)

* * *

## 回答 #14

> 赞同：33
> 
> 时间：2013-10-15T23:22:19.497

这是Android上的一个常见问题，许多人已经通过多种方式解决了这个问题。在我看来，我见过的最好的解决方案是名为[Picasso](http://square.github.io/picasso/ "毕加索")的相对较新的库。以下是重点：

*   开源，但以`Jake Wharton`ActionBarSherlock 的[名气](http://actionbarsherlock.com/ "动作条夏洛克")为首。
*   使用一行代码从网络或应用程序资源中异步加载图像
*   自动`ListView`检测
*   自动磁盘和内存缓存
*   可以进行自定义转换
*   许多可配置的选项
*   超级简单的API
*   经常更新

* * *

## 回答 #15

> 赞同：29
> 
> 时间：2013-02-12T07:10:14.970

嗯，图片加载时间从网上有很多解决办法。您也可以使用库[Android-Query](https://code.google.com/p/android-query/wiki/ImageLoading)。它将为您提供所有必需的活动。确定你想要做什么并阅读图书馆维基页面。并解决图片加载限制。

这是我的代码：

```
@Override
public View getView(int position, View convertView, ViewGroup parent) {
    View v = convertView;
    if (v == null) {
        LayoutInflater vi = (LayoutInflater)getSystemService(Context.LAYOUT_INFLATER_SERVICE);
        v = vi.inflate(R.layout.row, null);
    }

    ImageView imageview = (ImageView) v.findViewById(R.id.icon);
    AQuery aq = new AQuery(convertView);

    String imageUrl = "http://www.vikispot.com/z/images/vikispot/android-w.png";

    aq.id(imageview).progress(this).image(imageUrl, true, true, 0, 0, new BitmapAjaxCallback() {
        @Override
        public void callback(String url, ImageView iv, Bitmap bm, AjaxStatus status) {
            iv.setImageBitmap(bm);
        }
    ));

    return v;
} 
```

它应该可以解决您的延迟加载问题。

* * *

## 回答 #16

> 赞同：27
> 
> 时间：2012-12-11T18:33:24.047

我认为这个问题在 Android 开发人员中非常流行，并且有很多这样的库声称可以解决这个问题，但似乎只有少数几个是正确的。[AQuery](http://code.google.com/p/android-query/)就是这样一个库，但它在各个方面都比大多数库都好，值得一试。

* * *

## 回答 #17

> 赞同：23
> 
> 时间：2015-02-05T12:45:50.363

你必须试试这个 Universal Loader 是最好的。在对延迟加载进行了许多 RnD 之后，我正在使用它。

[通用图像加载器](https://github.com/nostra13/Android-Universal-Image-Loader)

**特征**

*   多线程图像加载（异步或同步）
*   ImageLoader 配置的广泛定制（线程执行器、下载器、解码器、内存和磁盘缓存、显示图像选项等）
*   每个显示图像调用的许多自定义选项（存根图像、缓存开关、解码选项、位图处理和显示等）
*   内存和/或磁盘（设备的文件系统或 SD 卡）中的图像缓存
*   监听加载过程（包括下载进度）

安卓 2.0+ 支持

![在此处输入图像描述](https://i.stack.imgur.com/iFKcR.png)

* * *

## 回答 #18

> 赞同：22
> 
> 时间：2012-10-16T12:43:25.303

看看[Shutterbug](https://github.com/applidium/Shutterbug)，Applidium 的轻量级 SDWebImage（iOS 上的一个不错的库）移植到 Android。它支持异步缓存，存储失败的 URL，很好地处理并发，并且包含有用的子类。

也欢迎拉取请求（和错误报告）！

* * *

## 回答 #19

> 赞同：18
> 
> 时间：2013-05-06T09:48:19.903

[DroidParts](http://droidparts.org)有[ImageFetcher](https://github.com/yanchenko/droidparts/blob/master/droidparts/src/org/droidparts/net/image/ImageFetcher.java)，需要零配置才能开始。

*   使用磁盘和内存中[最近最少使用](https://en.wikipedia.org/wiki/Cache_algorithms#Examples)(LRU) 缓存。
*   有效地解码图像。
*   支持在后台线程中修改位图。
*   有简单的交叉淡入淡出。
*   具有图像加载进度回调。

以克隆[DroidPartsGram](https://github.com/yanchenko/droidparts/tree/master/droidparts-samples/DroidPartsGram)为例：

![在此处输入图像描述](https://i.stack.imgur.com/DegXF.png)

* * *

## 回答 #20

> 赞同：17
> 
> 时间：2013-01-12T11:00:25.540

Novoda 还有一个很棒的[惰性图像加载库](http://androidimageloader.com/)，许多应用程序，如 Songkick、Podio、SecretDJ 和 ImageSearch 都使用它们的库。

他们的库托管[在](https://github.com/novoda/ImageLoader)Github 上，他们也有一个非常活跃的[问题跟踪器](https://github.com/novoda/ImageLoader/issues)。他们的项目似乎也很活跃，在撰写此回复时有超过 300 次提交。

* * *

## 回答 #21

> 赞同：17
> 
> 时间：2014-08-03T12:19:55.593

给那些犹豫不决的人提供一个快速提示，用于延迟加载图像的库：

有四种基本方法。

1.  DIY => 不是最好的解决方案，但对于一些图像，如果你想不用麻烦使用其他库

2.  Volley 的延迟加载库 => 来自 android 的人。它很好，一切都很好，但文档记录很差，因此使用起来有问题。

3.  Picasso：一个简单有效的解决方案，您甚至可以指定要引入的确切图像大小。它使用起来非常简单，但对于必须处理大量图像的应用程序来说可能不是很“高性能”。

4.  UIL：延迟加载图像的最佳方式。您可以缓存图像（当然需要许可），初始化一次加载器，然后完成您的工作。迄今为止我见过的最成熟的异步图片加载库。

* * *

## 回答 #22

> 赞同：15
> 
> 时间：2013-02-12T23:46:22.570

检查我的[LazyList 分支](https://github.com/nicolasjafelle/LazyList)。基本上，我通过延迟 ImageView 的调用来改进 LazyList 并创建两种方法：

1.  当您需要放置诸如“正在加载图像...”之类的内容时
2.  当您需要显示下载的图像时。

我还通过在这个对象中实现一个[单例](http://en.wikipedia.org/wiki/Singleton_pattern)来改进 ImageLoader 。

* * *

## 回答 #23

> 赞同：15
> 
> 时间：2018-02-26T05:02:17.243

如果你想像 Facebook 一样显示 Shimmer 布局，有一个官方的 facebook 库。[脸书微光安卓](http://facebook.github.io/shimmer-android/)

它负责一切，您只需将所需的设计代码以嵌套方式放在微光框架中。这是一个示例代码。

```
<com.facebook.shimmer.ShimmerFrameLayout
     android:id=“@+id/shimmer_view_container”
     android:layout_width=“wrap_content”
     android:layout_height="wrap_content"
     shimmer:duration="1000">

 <here will be your content to display />

</com.facebook.shimmer.ShimmerFrameLayout> 
```

这是它的java代码。

```
ShimmerFrameLayout shimmerContainer = (ShimmerFrameLayout) findViewById(R.id.shimmer_view_container);
shimmerContainer.startShimmerAnimation(); 
```

在您的 gradle 文件中添加此依赖项。

```
implementation 'com.facebook.shimmer:shimmer:0.1.0@aar' 
```

这是它的样子。[![微光安卓截图](https://i.stack.imgur.com/cP4QU.gif)](https://i.stack.imgur.com/cP4QU.gif)

* * *

## 回答 #24

> 赞同：12
> 
> 时间：2015-07-09T16:16:06.600

以上所有代码都有其自身的价值，但根据我的个人经验，请尝试使用毕加索。

**Picasso** 是专门用于此目的的库，实际上它会自动管理缓存和所有其他网络操作。您必须在项目中添加库，只需编写一行代码即可从远程 URL 加载图像。

请访问这里：[http ://code.tutsplus.com/tutorials/android-sdk-working-with-picasso--cms-22149](http://code.tutsplus.com/tutorials/android-sdk-working-with-picasso--cms-22149)

* * *

## 回答 #25

> 赞同：11
> 
> 时间：2017-03-16T10:11:09.753

使用滑行库。它对我有用，也适用于您的代码。它也适用于图像和 gif。

```
ImageView imageView = (ImageView) findViewById(R.id.test_image); 
    GlideDrawableImageViewTarget imagePreview = new GlideDrawableImageViewTarget(imageView);
    Glide
            .with(this)
            .load(url)
            .listener(new RequestListener<String, GlideDrawable>() {
                @Override
                public boolean onException(Exception e, String model, Target<GlideDrawable> target, boolean isFirstResource) {                       
                    return false;
                }

                @Override
                public boolean onResourceReady(GlideDrawable resource, String model, Target<GlideDrawable> target, boolean isFromMemoryCache, boolean isFirstResource) {
                    return false;
                }
            })
            .into(imagePreview);
} 
```

* * *

## 回答 #26

> 赞同：8
> 
> 时间：2013-07-29T07:06:02.587

我可以推荐一种像魅力一样工作的不同方式：Android Query。

[您可以从此处](http://code.google.com/p/android-query/downloads/list)下载该[JAR](http://en.wikipedia.org/wiki/JAR_%28file_format%29)文件

```
AQuery androidAQuery = new AQuery(this); 
```

举个例子：

```
androidAQuery.id(YOUR IMAGEVIEW).image(YOUR IMAGE TO LOAD, true, true, getDeviceWidth(), ANY DEFAULT IMAGE YOU WANT TO SHOW); 
```

它非常快速和准确，使用它您可以找到更多功能，例如加载时的动画、获取位图（如果需要）等。

* * *

## 回答 #27

> 赞同：8
> 
> 时间：2013-12-16T13:04:26.977

[试试](https://code.google.com/p/android-query/wiki/ImageLoading)Aquery 。它具有非常简单的异步加载和缓存图像的方法。

* * *

## 回答 #28

> 赞同：7
> 
> 时间：2014-01-27T05:33:20.013

[URLImageViewHelper](https://github.com/koush/UrlImageViewHelper)是一个很棒的库，可以帮助您做到这一点。

* * *

## 回答 #29

> 赞同：5
> 
> 时间：2013-07-18T07:16:56.707

```
public class ImageDownloader {

Map<String, Bitmap> imageCache;

public ImageDownloader() {
    imageCache = new HashMap<String, Bitmap>();

}

// download function
public void download(String url, ImageView imageView) {
    if (cancelPotentialDownload(url, imageView)) {

        // Caching code right here
        String filename = String.valueOf(url.hashCode());
        File f = new File(getCacheDirectory(imageView.getContext()),
                filename);

        // Is the bitmap in our memory cache?
        Bitmap bitmap = null;

        bitmap = (Bitmap) imageCache.get(f.getPath());

        if (bitmap == null) {

            bitmap = BitmapFactory.decodeFile(f.getPath());

            if (bitmap != null) {
                imageCache.put(f.getPath(), bitmap);
            }

        }
        // No? download it
        if (bitmap == null) {
            try {
                BitmapDownloaderTask task = new BitmapDownloaderTask(
                        imageView);
                DownloadedDrawable downloadedDrawable = new DownloadedDrawable(
                        task);
                imageView.setImageDrawable(downloadedDrawable);
                task.execute(url);
            } catch (Exception e) {
                Log.e("Error==>", e.toString());
            }

        } else {
            // Yes? set the image
            imageView.setImageBitmap(bitmap);
        }
    }
}

// cancel a download (internal only)
private static boolean cancelPotentialDownload(String url,
        ImageView imageView) {
    BitmapDownloaderTask bitmapDownloaderTask = getBitmapDownloaderTask(imageView);

    if (bitmapDownloaderTask != null) {
        String bitmapUrl = bitmapDownloaderTask.url;
        if ((bitmapUrl == null) || (!bitmapUrl.equals(url))) {
            bitmapDownloaderTask.cancel(true);
        } else {
            // The same URL is already being downloaded.
            return false;
        }
    }
    return true;
}

// gets an existing download if one exists for the imageview
private static BitmapDownloaderTask getBitmapDownloaderTask(
        ImageView imageView) {
    if (imageView != null) {
        Drawable drawable = imageView.getDrawable();
        if (drawable instanceof DownloadedDrawable) {
            DownloadedDrawable downloadedDrawable = (DownloadedDrawable) drawable;
            return downloadedDrawable.getBitmapDownloaderTask();
        }
    }
    return null;
}

// our caching functions
// Find the dir to save cached images
private static File getCacheDirectory(Context context) {
    String sdState = android.os.Environment.getExternalStorageState();
    File cacheDir;

    if (sdState.equals(android.os.Environment.MEDIA_MOUNTED)) {
        File sdDir = android.os.Environment.getExternalStorageDirectory();

        // TODO : Change your diretcory here
        cacheDir = new File(sdDir, "data/ToDo/images");
    } else
        cacheDir = context.getCacheDir();

    if (!cacheDir.exists())
        cacheDir.mkdirs();
    return cacheDir;
}

private void writeFile(Bitmap bmp, File f) {
    FileOutputStream out = null;

    try {
        out = new FileOutputStream(f);
        bmp.compress(Bitmap.CompressFormat.PNG, 80, out);
    } catch (Exception e) {
        e.printStackTrace();
    } finally {
        try {
            if (out != null)
                out.close();
        } catch (Exception ex) {
        }
    }
}

// download asynctask
public class BitmapDownloaderTask extends AsyncTask<String, Void, Bitmap> {
    private String url;
    private final WeakReference<ImageView> imageViewReference;

    public BitmapDownloaderTask(ImageView imageView) {
        imageViewReference = new WeakReference<ImageView>(imageView);
    }

    @Override
    // Actual download method, run in the task thread
    protected Bitmap doInBackground(String... params) {
        // params comes from the execute() call: params[0] is the url.
        url = (String) params[0];
        return downloadBitmap(params[0]);
    }

    @Override
    // Once the image is downloaded, associates it to the imageView
    protected void onPostExecute(Bitmap bitmap) {
        if (isCancelled()) {
            bitmap = null;
        }

        if (imageViewReference != null) {
            ImageView imageView = imageViewReference.get();
            BitmapDownloaderTask bitmapDownloaderTask = getBitmapDownloaderTask(imageView);
            // Change bitmap only if this process is still associated with
            // it
            if (this == bitmapDownloaderTask) {
                imageView.setImageBitmap(bitmap);

                // cache the image

                String filename = String.valueOf(url.hashCode());
                File f = new File(
                        getCacheDirectory(imageView.getContext()), filename);

                imageCache.put(f.getPath(), bitmap);

                writeFile(bitmap, f);
            }
        }
    }

}

static class DownloadedDrawable extends ColorDrawable {
    private final WeakReference<BitmapDownloaderTask> bitmapDownloaderTaskReference;

    public DownloadedDrawable(BitmapDownloaderTask bitmapDownloaderTask) {
        super(Color.WHITE);
        bitmapDownloaderTaskReference = new WeakReference<BitmapDownloaderTask>(
                bitmapDownloaderTask);
    }

    public BitmapDownloaderTask getBitmapDownloaderTask() {
        return bitmapDownloaderTaskReference.get();
    }
}

// the actual download code
static Bitmap downloadBitmap(String url) {
    HttpParams params = new BasicHttpParams();
    params.setParameter(CoreProtocolPNames.PROTOCOL_VERSION,
            HttpVersion.HTTP_1_1);
    HttpClient client = new DefaultHttpClient(params);
    final HttpGet getRequest = new HttpGet(url);

    try {
        HttpResponse response = client.execute(getRequest);
        final int statusCode = response.getStatusLine().getStatusCode();
        if (statusCode != HttpStatus.SC_OK) {
            Log.w("ImageDownloader", "Error " + statusCode
                    + " while retrieving bitmap from " + url);
            return null;
        }

        final HttpEntity entity = response.getEntity();
        if (entity != null) {
            InputStream inputStream = null;
            try {
                inputStream = entity.getContent();
                final Bitmap bitmap = BitmapFactory
                        .decodeStream(inputStream);
                return bitmap;
            } finally {
                if (inputStream != null) {
                    inputStream.close();
                }
                entity.consumeContent();
            }
        }
    } catch (Exception e) {
        // Could provide a more explicit error message for IOException or
        // IllegalStateException
        getRequest.abort();
        Log.w("ImageDownloader", "Error while retrieving bitmap from "
                + url + e.toString());
    } finally {
        if (client != null) {
            // client.close();
        }
    }
    return null;
 }
} 
```

* * *

## 回答 #30

> 赞同：5
> 
> 时间：2013-07-21T17:51:09.000

我遇到了这个问题并实现了 lruCache。我相信您需要 API 12 及更高版本或使用兼容性 v4 库。lurCache 是快速内存，但它也有预算，所以如果您担心可以使用磁盘缓存......这一切都在*[Caching](http://developer.android.com/training/displaying-bitmaps/cache-bitmap.html)* Bitmaps 中描述。

我现在将提供我的实现，它是我从这样的任何地方调用的[单例](http://en.wikipedia.org/wiki/Singleton_pattern)：

```
//Where the first is a string and the other is a imageview to load.

DownloadImageTask.getInstance().loadBitmap(avatarURL, iv_avatar); 
```

这是理想的缓存代码，然后在检索 Web 图像时在适配器的 getView 中调用上述代码：

```
public class DownloadImageTask {

    private LruCache<String, Bitmap> mMemoryCache;

    /* Create a singleton class to call this from multiple classes */

    private static DownloadImageTask instance = null;

    public static DownloadImageTask getInstance() {
        if (instance == null) {
            instance = new DownloadImageTask();
        }
        return instance;
    }

    //Lock the constructor from public instances
    private DownloadImageTask() {

        // Get max available VM memory, exceeding this amount will throw an
        // OutOfMemory exception. Stored in kilobytes as LruCache takes an
        // int in its constructor.
        final int maxMemory = (int) (Runtime.getRuntime().maxMemory() / 1024);

        // Use 1/8th of the available memory for this memory cache.
        final int cacheSize = maxMemory / 8;

        mMemoryCache = new LruCache<String, Bitmap>(cacheSize) {
            @Override
            protected int sizeOf(String key, Bitmap bitmap) {
                // The cache size will be measured in kilobytes rather than
                // number of items.
                return bitmap.getByteCount() / 1024;
            }
        };
    }

    public void loadBitmap(String avatarURL, ImageView imageView) {
        final String imageKey = String.valueOf(avatarURL);

        final Bitmap bitmap = getBitmapFromMemCache(imageKey);
        if (bitmap != null) {
            imageView.setImageBitmap(bitmap);
        } else {
            imageView.setImageResource(R.drawable.ic_launcher);

            new DownloadImageTaskViaWeb(imageView).execute(avatarURL);
        }
    }

    private void addBitmapToMemoryCache(String key, Bitmap bitmap) {
        if (getBitmapFromMemCache(key) == null) {
            mMemoryCache.put(key, bitmap);
        }
    }

    private Bitmap getBitmapFromMemCache(String key) {
        return mMemoryCache.get(key);
    }

    /* A background process that opens a http stream and decodes a web image. */

    class DownloadImageTaskViaWeb extends AsyncTask<String, Void, Bitmap> {
        ImageView bmImage;

        public DownloadImageTaskViaWeb(ImageView bmImage) {
            this.bmImage = bmImage;
        }

        protected Bitmap doInBackground(String... urls) {

            String urldisplay = urls[0];
            Bitmap mIcon = null;
            try {
                InputStream in = new java.net.URL(urldisplay).openStream();
                mIcon = BitmapFactory.decodeStream(in);

            } 
            catch (Exception e) {
                Log.e("Error", e.getMessage());
                e.printStackTrace();
            }

            addBitmapToMemoryCache(String.valueOf(urldisplay), mIcon);

            return mIcon;
        }

        /* After decoding we update the view on the main UI. */
        protected void onPostExecute(Bitmap result) {
            bmImage.setImageBitmap(result);
        }
    }
} 
```

* * *

## 回答 #31

> 赞同：5
> 
> 时间：2013-09-03T12:41:14.543

您可以尝试使用***Aquery* Android**库来延迟加载图像和列表视图...下面的代码可能对您有所帮助.....[从这里下载库](http://code.google.com/p/android-query/downloads/detail?name=android-query-full.0.25.10.jar)。

```
AQuery aq = new AQuery(mContext);
aq.id(R.id.image1).image("http://data.whicdn.com/images/63995806/original.jpg"); 
```

* * *

## 回答 #32

> 赞同：4
> 
> 时间：2013-08-16T20:06:30.020

我使用[droidQuery](http://bit.ly/droidQuery)。从 URL 加载图像有两种机制。第一个（速记）很简单：

```
$.with(myView).image(url); 
```

这可以很容易地添加到`ArrayAdapter`'s`getView(...)`方法中。

* * *

简单的方法将提供更多的控制权，并且具有这里甚至没有讨论的选项（例如缓存和回调），但是可以在此处找到将输出大小指定为 200px x 200px 的基本实现：

```
$.ajax(new AjaxOptions().url(url)
    .type("GET")
    .dataType("image")
    .imageWidth(200).imageHeight(200)
    .success(new Function() {
        @Override
        public void invoke($ droidQuery, Object... params) {
            myImageView.setImageBitmap((Bitmap) params[0]);
        }
    })
    .error(new Function() {
        @Override
        public void invoke($ droidQuery, Object... params) {
            AjaxError e = (AjaxError) params[0];
            Log.e("$", "Error " + e.status + ": " + e.error);
        }
    })
); 
```

* * *

## 回答 #33

> 赞同：4
> 
> 时间：2015-12-03T06:46:15.037

我发现[Glide](https://github.com/bumptech/glide)比`Picasso`. 我正在使用 picasso 加载每个`32`大小的图像，`200-500KB`我总是得到`OOM`. 但是`Glide`解决了我的所有`OOM`问题。

* * *

## 回答 #34

> 赞同：4
> 
> 时间：2015-12-03T09:01:02.687

使用下面的类在列表视图中下载和加载图像。它会在下载后缓存每个图像。还加载图像广告延迟加载。

```
package com.fudiyoxpress.images;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.Collections;
import java.util.Map;
import java.util.WeakHashMap;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

import android.content.Context;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.os.Handler;
import android.widget.ImageView;

import com.fudiyoxpress.R;
import com.fudiyoxpress.config.Config;
import com.fudiyoxpress.twitter.ScaleBitmap;

public class ImageLoader {

    // Initialize MemoryCache
    MemoryCache memoryCache = new MemoryCache();

    FileCache fileCache;

    Context C;

    // Create Map (collection) to store image and image url in key value pair
    private Map<ImageView, String> imageViews = Collections
            .synchronizedMap(new WeakHashMap<ImageView, String>());
    ExecutorService executorService;

    // handler to display images in UI thread
    Handler handler = new Handler();

    public ImageLoader(Context context) {

        C = context;
        fileCache = new FileCache(context);

        // Creates a thread pool that reuses a fixed number of
        // threads operating off a shared unbounded queue.
        executorService = Executors.newFixedThreadPool(5);

    }

    // default image show in list (Before online image download)
    final int stub_id = R.drawable.restlogoplaceholder;

    public void DisplayImage(String url, ImageView imageView, Context context,
            boolean header_flag) {

        Bitmap largeIcon = BitmapFactory.decodeResource(context.getResources(),
                R.drawable.restlogoplaceholder);
        header_flag = false;
        // Store image and url in Map
        imageViews.put(imageView, url);

        // Check image is stored in MemoryCache Map or not (see
        // MemoryCache.java)
        Bitmap bitmap = memoryCache.get(url);

        if (bitmap != null) {
            // if image is stored in MemoryCache Map then
            // Show image in listview row
            Bitmap b = ScaleBitmap
                    .getScaledBitmap(context, bitmap, header_flag);
            imageView.setImageBitmap(b);

        } else {
            // queue Photo to download from url
            queuePhoto(url, imageView, header_flag);

            // Before downloading image show default image
            imageView.setImageBitmap(ScaleBitmap.getScaledBitmap(context,
                    largeIcon, header_flag));

        }
    }

    private void queuePhoto(String url, ImageView imageView, boolean header_flag) {
        // Store image and url in PhotoToLoad object
        PhotoToLoad p = new PhotoToLoad(url, imageView, header_flag);

        // pass PhotoToLoad object to PhotosLoader runnable class
        // and submit PhotosLoader runnable to executers to run runnable
        // Submits a PhotosLoader runnable task for execution

        executorService.submit(new PhotosLoader(p));
    }

    // Task for the queue
    private class PhotoToLoad {
        public String url;
        public ImageView imageView;
        public boolean b;

        public PhotoToLoad(String u, ImageView i, boolean header_flag) {
            url = u;
            imageView = i;
            b = header_flag;
        }
    }

    class PhotosLoader implements Runnable {
        PhotoToLoad photoToLoad;

        PhotosLoader(PhotoToLoad photoToLoad) {
            this.photoToLoad = photoToLoad;
        }

        @Override
        public void run() {
            try {
                // Check if image already downloaded
                if (imageViewReused(photoToLoad))
                    return;
                // download image from web url
                Bitmap bmp = getBitmap(photoToLoad.url);

                // set image data in Memory Cache
                memoryCache.put(photoToLoad.url, bmp);

                if (imageViewReused(photoToLoad))
                    return;

                // Get bitmap to display
                BitmapDisplayer bd = new BitmapDisplayer(bmp, photoToLoad);

                // Causes the Runnable bd (BitmapDisplayer) to be added to the
                // message queue.
                // The runnable will be run on the thread to which this handler
                // is attached.
                // BitmapDisplayer run method will call
                handler.post(bd);

            } catch (Throwable th) {
                // th.printStackTrace();
            }
        }
    }

    private Bitmap getBitmap(String url) {
        File f = fileCache.getFile(url);

        // from SD cache
        // CHECK : if trying to decode file which not exist in cache return null
        Bitmap b = decodeFile(f);
        if (b != null)
            return b;

        // Download image file from web
        try {

            // // download the image
            Bitmap bitmap = null;

            URL imageURL = null;
            try {

                imageURL = new URL(Config.WEB_URL + "/ServeBlob?id=" + url);

                HttpURLConnection connection = (HttpURLConnection) imageURL
                        .openConnection();
                connection.setDoInput(true);
                connection.connect();
                // if(!(new File(imageURL.toString())).exists())
                // {
                // imageURL=new URL("");
                // }
                InputStream inputStream = connection.getInputStream();

                // Constructs a new FileOutputStream that writes to
                // file
                // if file not exist then it will create file
                OutputStream os = new FileOutputStream(f);

                // See Utils class CopyStream method
                // It will each pixel from input stream and
                // write pixels to output stream (file)
                Utils.CopyStream(inputStream, os);

                os.close();

                BitmapFactory.Options options = new BitmapFactory.Options();
                options.inSampleSize = 8;

                bitmap = BitmapFactory.decodeStream(inputStream, null, options);

            } catch (IOException e) {

                // e.printStackTrace();
            }

            // Now file created and going to resize file with defined height
            // Decodes image and scales it to reduce memory consumption
            bitmap = decodeFile(f);

            return bitmap;

        } catch (Throwable ex) {
            ex.printStackTrace();
            if (ex instanceof OutOfMemoryError)
                memoryCache.clear();
            return null;
        }
    }

    // Decodes image and scales it to reduce memory consumption
    private Bitmap decodeFile(File f) {

        try {

            // Decode image size
            BitmapFactory.Options o = new BitmapFactory.Options();
            o.inJustDecodeBounds = true;
            FileInputStream stream1 = new FileInputStream(f);
            BitmapFactory.decodeStream(stream1, null, o);
            stream1.close();

            // Find the correct scale value. It should be the power of 2.

            // Set width/height of recreated image
            final int REQUIRED_SIZE = 85;

            int width_tmp = o.outWidth, height_tmp = o.outHeight;
            int scale = 1;
            while (true) {
                if (width_tmp / 2 < REQUIRED_SIZE
                        || height_tmp / 2 < REQUIRED_SIZE)
                    break;
                width_tmp /= 2;
                height_tmp /= 2;
                scale *= 2;
            }

            // decode with current scale values
            BitmapFactory.Options o2 = new BitmapFactory.Options();
            o2.inSampleSize = scale;
            FileInputStream stream2 = new FileInputStream(f);
            Bitmap bitmap = BitmapFactory.decodeStream(stream2, null, o2);
            stream2.close();
            return bitmap;

        } catch (FileNotFoundException e) {
        } catch (IOException e) {
            e.printStackTrace();
        }
        return null;
    }

    boolean imageViewReused(PhotoToLoad photoToLoad) {

        String tag = imageViews.get(photoToLoad.imageView);
        // Check url is already exist in imageViews MAP
        if (tag == null || !tag.equals(photoToLoad.url))
            return true;
        return false;
    }

    // Used to display bitmap in the UI thread
    class BitmapDisplayer implements Runnable {
        Bitmap bitmap;
        PhotoToLoad photoToLoad;

        public BitmapDisplayer(Bitmap b, PhotoToLoad p) {
            bitmap = b;
            photoToLoad = p;
        }

        public void run() {
            if (imageViewReused(photoToLoad))
                return;

            // Show bitmap on UI
            if (bitmap != null) {
                photoToLoad.imageView.setImageBitmap(ScaleBitmap
                        .getScaledBitmap(C, bitmap, photoToLoad.b));
            } else {

            }
            // photoToLoad.imageView.setImageResource(stub_id);

        }
    }

    public void clearCache() {
        // Clear cache directory downloaded images and stored data in maps
        memoryCache.clear();
        fileCache.clear();
    }

}

package com.fudiyoxpress.images;

import java.util.Collections;
import java.util.Iterator;
import java.util.LinkedHashMap;
import java.util.Map;
import java.util.Map.Entry;
import android.graphics.Bitmap;
import android.util.Log;

public class MemoryCache {

    private static final String TAG = "MemoryCache";

    //Last argument true for LRU ordering
    private Map<String, Bitmap> cache = Collections.synchronizedMap(
            new LinkedHashMap<String, Bitmap>(10,1.5f,true));

   //current allocated size
    private long size=0; 

    //max memory cache folder used to download images in bytes
    private long limit = 1000000; 

    public MemoryCache(){

        //use 25% of available heap size
        setLimit(Runtime.getRuntime().maxMemory()/4);
    }

    public void setLimit(long new_limit){

        limit=new_limit;
        Log.i(TAG, "MemoryCache will use up to "+limit/1024./1024.+"MB");
    }

    public Bitmap get(String id){
        try{
            if(!cache.containsKey(id))
                return null;
            //NullPointerException sometimes happen here http://code.google.com/p/osmdroid/issues/detail?id=78 
            return cache.get(id);
        }catch(NullPointerException ex){
            ex.printStackTrace();
            return null;
        }
    }

    public void put(String id, Bitmap bitmap){
        try{
            if(cache.containsKey(id))
                size-=getSizeInBytes(cache.get(id));
            cache.put(id, bitmap);
            size+=getSizeInBytes(bitmap);
            checkSize();
        }catch(Throwable th){
            th.printStackTrace();
        }
    }

    private void checkSize() {
        Log.i(TAG, "cache size="+size+" length="+cache.size());
        if(size>limit){
            Iterator<Entry<String, Bitmap>> iter=cache.entrySet().iterator();//least recently accessed item will be the first one iterated  
            while(iter.hasNext()){
                Entry<String, Bitmap> entry=iter.next();
                size-=getSizeInBytes(entry.getValue());
                iter.remove();
                if(size<=limit)
                    break;
            }
            Log.i(TAG, "Clean cache. New size "+cache.size());
        }
    }

    public void clear() {
        try{
            //NullPointerException sometimes happen here http://code.google.com/p/osmdroid/issues/detail?id=78 
            cache.clear();
            size=0;
        }catch(NullPointerException ex){
            ex.printStackTrace();
        }
    }

    long getSizeInBytes(Bitmap bitmap) {
        if(bitmap==null)
            return 0;
        return bitmap.getRowBytes() * bitmap.getHeight();
    }
}

package com.fudiyoxpress.images;

import java.io.InputStream;
import java.io.OutputStream;

public class Utils {
    public static void CopyStream(InputStream is, OutputStream os)
    {
        final int buffer_size=1024;
        try
        {

            byte[] bytes=new byte[buffer_size];
            for(;;)
            {
              //Read byte from input stream

              int count=is.read(bytes, 0, buffer_size);
              if(count==-1)
                  break;

              //Write byte from output stream
              os.write(bytes, 0, count);
            }
        }
        catch(Exception ex){}
    }
} 
```

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2014-06-08T09:04:32.357

一些答案已经提到使用各种图像库，如 Universal Image Loader 和 androidimageloader 等。这是一个老问题，但对于仍在寻找类似东西的人来说，有[几个这样的库](http://www.appance.com/category/android/?tag=image-caching)用于图像加载/缓存。

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2014-06-21T08:55:34.480

另一种方法是通过 getView() 方法中的线程中的适配器：

```
Thread pics_thread = new Thread(new Runnable() {
    @Override
    public void run() {
        Bitmap bitmap = getPicture(url);
        if(bitmap != null) {
            runOnUiThread(new Runnable() {
                @Override
                public void run() {
                    holder.imageview.setImageBitmap(bitmap);            
                    adapter.notifyDataSetChanged();
                }                       
            });             
        }       
    }                       
});

pics_thread.start(); 
```

当然，您应该始终缓存图像以避免额外的操作，您可以将图像放入 HashMap 数组中，检查图像是否存在于数组中，如果不存在，则继续线程或从 HashMap 数组中加载图像。还要始终检查您是否没有泄漏内存，位图和可绘制对象通常会占用大量内存。优化代码取决于您。

* * *

## 回答 #37

> 赞同：3
> 
> 时间：2016-01-19T09:59:01.847

您可以使用一些第三方库，例如`Piccaso`或`Volley`用于有效的延迟加载。您还可以通过实施以下内容来创建自己的

1.  实现从 url 下载图片的代码

2.  实现图像存储和检索的缓存机制（使用`LruCache`android进行缓存）

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2020-11-02T16:46:24.977

**更新：**如果您正在寻找 2020 年由 Kotlin Coroutines 支持的解决方案，请尝试使用 Coil。

Coil 是**Coroutine Image Loader**的首字母缩写。

**特征**

1.  **快速：** Coil 执行许多优化，包括内存和磁盘缓存、对内存中的图像进行下采样、重用位图、自动暂停/取消请求等等。
2.  **轻量级：** Coil 为你的 APK 增加了大约 2000 个方法（对于已经使用 OkHttp 和 Coroutines 的应用程序），这与**Picasso**相当，明显少于**Glide**和**Fresco**。
3.  **易于使用：** Coil 的 API 利用 Kotlin 的语言特性来简化和减少样板。
4.  **现代：** Coil 是 Kotlin 优先的，使用现代库，包括 Coroutines、OkHttp、Okio 和 AndroidX Lifecycles。

**摇篮设置：**

线圈在 上可用`mavenCentral()`。

```
implementation("io.coil-kt:coil:1.0.0") 
```

**快速开始**

要将图像加载到 ImageView 中，请使用加载扩展功能：

```
// URL
imageView.load("https://www.example.com/image.jpg")

// Resource
imageView.load(R.drawable.image)

// File
imageView.load(File("/path/to/image.jpg")) 
```

或在后台线程上

```
// Coil (suspends the current coroutine; non-blocking and thread safe)
val request = ImageRequest.Builder(context)
    .data(url)
    .size(width, height)
    .build()
val drawable = context.imageLoader.execute(request).drawable 
```

您也可以从 Picasso/Glide[迁移](https://coil-kt.github.io/coil/migrating/)

完整的文档[在这里](https://coil-kt.github.io/coil/getting_started/)

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2016-06-14T15:49:08.973

除了异步加载数据缓存，你可能需要 UI 缓存，比如[setViewCacheSize](https://developer.android.com/reference/androidx/recyclerview/widget/RecyclerView.Recycler#setViewCacheSize(int))

除了加载可见项目数据，您可能需要加载近似可见项目数据

AndroidX Paging Library 是另一种选择，例如，您可以从 SQLite 数据库加载、缓存和显示 10,000,000 个项目到 RecyclerView。参考[PagedList](https://developer.android.com/reference/androidx/paging/PagedList)

示例：假设列表视图可见项为 [6,7,8,9,10]，您可能需要加载 [6,7,8,9,10] 并预加载项 [1,2,3,4 , 5] & [11, 12, 13, 14, 15]，因为用户可能滚动到前页或后页

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2021-05-11T07:18:17.977

**滑行**

Glide 是一个快速高效的 Android 开源媒体管理框架，它将媒体解码、内存和磁盘缓存以及资源池封装到一个简单易用的界面中。

Glide 支持获取、解码和显示视频静止图像、图像和动画 GIF。Glide 包含一个灵活的 API，允许开发人员插入几乎任何网络堆栈。默认情况下，Glide 使用自定义的基于 HttpUrlConnection 的堆栈，但也包含实用程序库插件到 Google 的 Volley 项目或 Square 的 OkHttp 库。

```
Glide.with(this).load("your-url-here").into(imageView); 
```

Glide 的主要重点是使滚动任何类型的图像列表尽可能平滑和快速，但 Glide 也适用于几乎所有需要获取、调整大小和显示远程图像的情况。

[滑翔库](https://github.com/bumptech/glide)

**毕加索**

使用杰克沃顿的毕加索图书馆。（ActionBarSherlock 开发者提供的完美 ImageLoading 库）

一个强大的安卓图像下载和缓存库。

图像为 Android 应用程序添加了急需的上下文和视觉风格。Picasso 允许在您的应用程序中轻松加载图像——通常只需一行代码！

```
Picasso.with(context).load("your-url-here").into(imageView); 
```

Picasso 会自动处理 Android 上许多常见的图像加载陷阱：

在适配器中处理 ImageView 回收和下载取消。使用最少的内存进行复杂的图像转换。自动内存和磁盘缓存。

[毕加索图书馆](https://github.com/square/picasso)

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2021-08-26T11:36:45.023

这就是使用[Jetpack Compose](https://developer.android.com/jetpack/compose)的方式。

```
implementation("io.coil-kt:coil-compose:1.3.1") // Add the Coil-Compose library 
```

```
Image(
    painter = rememberImagePainter("https://www.example.com/image.jpg"),
    contentDescription = "My image description",
    modifier = Modifier.size(128.dp)
) 
```

感谢 nglauber 和 Gabriele Mariotti 的[这个](https://stackoverflow.com/a/66961850/8583692)和[这个](https://stackoverflow.com/a/66687230/8583692)答案。

# .net - 如何在 WPF 应用程序中拦截 NotImplementedException？

> ID：541970
> 
> 赞同：0
> 
> 时间：2009-02-12T15:59:36.177
> 
> 标签：.net, wpf, exception, messagebox, notimplementedexception

如何在 WPF 应用程序中拦截 NotImplementedException？

在测试正在进行的 WPF 应用程序时，我偶尔会抛出 NotImplementedException：

```
Private Sub ButtonDoSomething_Click(...) Handles ButtonDoSomething.Click
    Throw New NotImplementedException( _
        "ButtonDoSomething_Click() not implemented.")
End Sub 
```

但是，我宁愿这些不会使程序崩溃。

我可以将所有此类异常抛出替换为：

```
MessageBox.Show("ButtonDoSomething_Click() not implemented.", _
    "Not Implemented", MessageBoxButton.OK, MessageBoxImage.Information) 
```

但这似乎有点不雅，如果 NotImplementedException 被埋没在接口之外，这将不起作用。

如何捕获所有此类异常并显示消息框？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-12T16:07:10.887

您可以附加到 Application 类上的 DispatcherUnhandledException 事件，该事件将在发生未处理的异常时引发。在那里，您可以检查传递给事件处理程序的 DispatcherUnhandledExceptionEventArgs 实例的 Exception 属性，以查看它是否属于 NotImplementedException 类型。如果是，则将 Handled 属性设置为 true，然后返回。

应该注意的是，如果您调用 MsgBox 而不是抛出异常，您将遇到必须实际返回某些内容并设置所有 out/ref 参数的问题，这将是额外的开销。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-12T16:08:37.420

查看 Application.DispatcherUnhandledException 或 AppDomain.UnhandledException。两者都可以让您处理其他未处理的异常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-12T22:22:42.293

[您可以使用Debug.Fail](http://msdn.microsoft.com/en-us/library/system.diagnostics.debug.fail.aspx)，而不是抛出 NotImplementedException 或使用 MessageBox 。例如：

```
Debug.Fail("This method is not implemented yet!"); 
```

它将弹出一个带有您提供的文本的消息框，并向您显示堆栈跟踪。

# c# - 扩展 Visual Studio 编辑器

> ID：541974
> 
> 赞同：1
> 
> 时间：2009-02-12T16:00:19.340
> 
> 标签：c#, visual-studio-2008, add-in

我正在编写一个用于扩展 Visual Studio 2008 的加载项（添加自定义功能）。在这样做时，我遇到了一种情况，如果我可以通过工具提示为任何代码行提供自定义消息，那将是一件好事。

执行此 IMO 需要访问 VS 编辑器控件并通过某种方式显示相应的工具提示。这也可以像鼠标悬停时提供工具提示消息的断点一样可视化。

这种实现可能吗？如果是，那该怎么走？如果不是，你建议什么类似的方式？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T16:02:49.320

[在最近的一期 Hanselminutes](http://www.hanselminutes.com/default.aspx?showID=165)中，他们讨论了 VS 2010 编辑器的可扩展性。根据他们所说的，我认为在他们引入这种可扩展性之前，这将是相当困难的（尽管可能是可能的）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T15:42:32.593

是的。您可以在 VS 2008 的代码编辑器上添加更多自定义，甚至可以在 VS 2008 中使用自己的智能感知支持创建自己的语言服务。

只需使用 VS 2008 SDK 即可做到这一点，也可以快速使用 Visual Studio 2008 的独立 shell，MS SQL Server 2008 Management Studio 就是自定义 Visual Studio 独立 shell 的一个示例。

您可以访问 MS Visual Studio 可扩展性：

[http://msdn.microsoft.com/en-us/vsx/default.aspx](http://msdn.microsoft.com/en-us/vsx/default.aspx)

还有很多关于 VS 2008 SDK 的视频：

[http://msdn.microsoft.com/en-us/vsx/bb507746.aspx#extensibility](http://msdn.microsoft.com/en-us/vsx/bb507746.aspx#extensibility)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T15:25:16.643

您应该查看 Resharper 并确定您的加载项是否更适合成为 Resharper 插件。这种方法需要您的用户购买 Resharper，但这种事情正是它所做的。

例如，查看[http://stylecopforresharper.codeplex.com/](http://stylecopforresharper.codeplex.com/)，其中 Resharper 中的此类提示/工具提示内容用于突出显示存在 StyleCop 问题的代码行。

# silverlight - 是否可以在 Silverlight 的工具提示中开始播放视频？

> ID：541975
> 
> 赞同：1
> 
> 时间：2009-02-12T16:00:21.103
> 
> 标签：silverlight, video

在 Silverlight 中，工具提示中可以包含任意数量的元素。

但是，它没有获得焦点，因此您不能在其中进行用户交互。

但是，您能否在工具提示打开后立即开始播放视频，并在工具提示关闭后立即停止视频？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-12T17:49:55.037

这是我在 Stack Overflow 上的第一个答案，所以我请求你幽默。
我认为您可以使用视频画笔在工具提示中运行您的视频。

这是我用来在图表中的条上绘制火灾视频的一些代码，表示用玉米加热。（长篇大论）就在这里，你可以看到它被设置为椭圆的填充。

```
 #region video brush setup
       protected void setupVideo()
       {
           VideoBrush _vb;
           MediaElement mevideo;

           _vb = new VideoBrush();
           mevideo = new MediaElement();
           mevideo.SetValue(Grid.NameProperty, "video");
           Uri videoUri = new Uri("http://www.faxt.com/videos/ezburnboilerfire.wmv", UriKind.Absolute);
           mevideo.Source = videoUri;
           mevideo.Visibility = Visibility.Collapsed;
           mevideo.MediaEnded += new RoutedEventHandler(me_MediaEnded);

           MediaRoot.Children.Add(mevideo);
           _vb.SetSource(mevideo);

           Ellipse el = new Ellipse();
           el.Width = 100;
           el.Height = 100;
           el.Fill = _vb;
           MediaRoot.Children.Add(el);

       } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-12T20:48:30.180

您可以按照 BPerreault 的建议使用 VideoBrush 来完成，但您也可以将 Tooltip.Content 设置为 MediaElement。

这是因为 Tooltip 的 Content 属性继承自 ContentControl，而 ContentControl 的 Content 属性可以是任何类型的对象，例如字符串、UIElement 或 DateTime。当 Content 设置为 UIElement（如 MediaElement）时，UIElement 将显示在 ContentControl 中。当 Content 设置为另一种类型的对象时，该对象的字符串表示形式将显示在 ContentControl 中。（[来自文档](http://msdn.microsoft.com/en-us/library/system.windows.controls.contentcontrol.content(VS.95).aspx)）

它应该是这样的：

```
<TextBlock x:Name="myText" Text="MouseOver and you'll get a ToolTip!">
  <ToolTipService.ToolTip>
    <MediaElement x:Name="myVideo" Source="Butterfly.wmv" Width="300" Height="300" />
  </ToolTipService.ToolTip>
</TextBlock > 
```

# oop - 维护业务类库的两个版本

> ID：541983
> 
> 赞同：1
> 
> 时间：2009-02-12T16:01:14.083
> 
> 标签：oop, compact-framework, frameworks

我们的核心业务应用程序使用业务对象库（C# 项目）。数据访问是使用 Wilson O/R Mapper 完成的（今年夏天我们将迁移到 NHibernate）。该应用程序有 3 个前端 UI：Windows 窗体、ASP.NET 和一个安装在平板电脑上的 Windows 窗体应用程序。这三个前端执行不同的功能，但它们都访问业务类的核心子集。

平板电脑应用程序就是问题所在。我们尝试限制推送到平板电脑的数据量，以减少它们使用 SQL Server 合并复制同步所需的时间。我们遇到的问题是当我们向主应用程序添加新功能时，我们不需要分发到平板电脑，或者如果它是敏感数据，则强烈需要不分发它。其中一些可以通过复制来控制，但我们偶尔会在核心业务对象中引入依赖关系，这些依赖关系必须存在才能使 O/R 映射器工作。

理想情况下，我们将有两个版本的核心业务对象库，Full 和 Compact。这似乎是一场维护噩梦。有什么策略来管理这个吗？还是替代品？Microsoft 如何管理完整而紧凑的 .NET 框架？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-12T16:37:24.587

您可以做的一件事是，如果您可以为每个平台分别编译，您可以使用编译器指令来限制 Tablet PC 平台所需的内容。但是，使用 OR 映射器可能会很困难。

现在在一个理想的世界中，您实际上将拥有您的域对象（映射到 OR 的那些），共享的业务逻辑非常少。然后有一个消耗这些域对象的 BO 层。如果您设法以这种方式分解代码库，理论上您可以根据需要部署单独的层。

但是，在我看来，这更像是您需要执行智能拆分。

您可能需要做的是对代码进行分段，以便 Tablet PC BO 位于核心根 BO 组件中。然后有一个 BO 扩展程序集，其中包含 Winform / Web 应用程序版本所需的其他对象、规则等。

因此，虽然此时您将拥有两个域级别的业务对象组件，但实际上不会有任何重复。因为您的 Tablet PC BO 对象也将是 Winform / Asp.net 应用程序的基础。然后扩展 dll 将只包含更大版本的 hte 应用程序所需的额外内容。

如果您遵循这种方法，它可能会使事情更容易管理。只需从随处需要的通用材料和专用方法中查看它。:)

如果你愿意，我可以更详细地介绍，只是想给你一个基本的打击。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T18:27:26.243

您的问题是关于[Tablet PC](http://www.microsoft.com/windowsxp/tabletpc/default.mspx)，这实际上只是 XP，因此 CF 确实不相关，但是为了问题主题本身，我们仍然可以谈论维护 CF 和 FFx 使用的代码（假设您实际上是说Windows Mobile 或 Windows CE）。

首先要知道的是 CF 程序集是可重定向的。这意味着 CF 程序集可以直接由全框架应用程序使用，无需任何重新编译（假设它不使用任何设备特定的东西，如 P/Invoking coredll 而不检查运行时环境，使用 WindowsMo​​bile 命名空间等）。

如果使用重定向不能让你一直到那里，那么你可以使用编译器指令和部分类来处理维护。[Daniel Moth 在他的 MSDN 文章](http://msdn.microsoft.com/en-us/magazine/cc163387.aspx)中很好地介绍了这些技巧。************************