# StackOverflow 问答 000243000-000243999

# c# - 在 Windows 服务应用程序中使用 UnsafeHeaderParsing

> ID：243021
> 
> 赞同：0
> 
> 时间：2008-10-28T11:54:14.627
> 
> 标签：c#

我有一个 VS2005 Windows 服务，我需要根据 MSDN 的文档使用“useUnsafeHeaderParsing”。

由于这是在我的 Windows 服务中使用的库，因此我没有 web.config 来添加 httpwebrequest 元素并将 useUnsafeHeaderParsing 设置为 true。

我将如何在代码中实现这一目标。我试过[这个](http://social.msdn.microsoft.com/Forums/en-US/netfxnetcom/thread/ff098248-551c-4da9-8ba5-358a9f8ccc57/)和[这个](http://wiki.lessthandot.com/index.php/Setting_unsafeheaderparsing)，但那是不行的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-07-07T04:27:11.373

如果您愿意，您可以通过编程方式启用 unsafeHeaderParsing - 这是我在[Quick and Dirty Feed Parser](http://qdfeed.codeplex.com/)中包含的一个功能，用于打开它 - 它类似于您在问题中链接到的一些功能：

```
private static bool SetUseUnsafeHeaderParsing(bool b)
    {
        Assembly a = Assembly.GetAssembly(typeof(System.Net.Configuration.SettingsSection));
        if (a == null) return false;

        Type t = a.GetType("System.Net.Configuration.SettingsSectionInternal");
        if (t == null) return false;

        object o = t.InvokeMember("Section",
            BindingFlags.Static | BindingFlags.GetProperty | BindingFlags.NonPublic, null, null, new object[] { });
        if (o == null) return false;

        FieldInfo f = t.GetField("useUnsafeHeaderParsing", BindingFlags.NonPublic | BindingFlags.Instance);
        if (f == null) return false;

        f.SetValue(o, b);

        return true;
    } 
```

我已经在生产代码中使用了它，并且它工作正常，无论您部署在什么环境中 - 只要 System.Net.Configuration 命名空间可以通过 GAC 中的某个程序集访问，您就可以开始使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-31T20:44:48.590

我不确定是什么问题。

您不要将 web.config 与 Windows 服务一起使用，而是使用 App.config（当您编译并重命名为 .config 时，它会被移动到部署目录中

我在我的 App.Config 中将此设置用于 Windows 窗体应用程序、Web 应用程序和许多 Windows 服务，没有任何困难。

# c# - 在 XmlReader 中解析 XML 元素

> ID：243022
> 
> 赞同：2
> 
> 时间：2008-10-28T11:55:01.800
> 
> 标签：c#, xmlreader

我正在构建一个需要通过 XML 提要运行的应用程序，但在获取某些元素时遇到了一些麻烦。

我正在使用[Twitter 提要](http://twitter.com/statuses/public_timeline.rss)并希望浏览所有`<item>`元素。我可以很好地连接并从提要中获取内容，但我不知道`item`在循环时如何仅选择元素`reader.Read();`。

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T12:03:58.210

最简单的方法是使用 XPath。要遵循的示例。

```
 string xml = @"<?xml version=""1.0"" encoding=""UTF-8""?>
<rss version=""2.0"">
    <channel>
    <title>Twitter public timeline</title>
    <link>http://twitter.com/public_timeline</link>
    <description>Twitter updates from everyone!</description>
    <language>en-us</language>
    <ttl>40</ttl>

    <item>
      <title>yasu_kobayashi: rTwT: @junm : yayaya</title>
      <description>yasu_kobayashi: rTwT: @junm : yayaya</description>
      <pubDate>Tue, 28 Oct 2008 12:04:48 +0000</pubDate>
      <guid>http://twitter.com/yasu_kobayashi/statuses/978829930</guid>
      <link>http://twitter.com/yasu_kobayashi/statuses/978829930</link>

    </item><item>
      <title>FreeGroup: WikiFortio - foobar http://tinyurl.com/5gvttf</title>
      <description>FreeGroup: WikiFortio - foobar
      http://tinyurl.com/5gvttf</description>
      <pubDate>Tue, 28 Oct 2008 12:04:47 +0000</pubDate>
      <guid>http://twitter.com/FreeGroup/statuses/978829929</guid>
      <link>http://twitter.com/FreeGroup/statuses/978829929</link>

    </item></channel></rss>
        ";
            XPathDocument doc = new XPathDocument(new StringReader(xml));
            XPathNavigator nav = doc.CreateNavigator();

            // Compile a standard XPath expression

            XPathExpression expr;
            expr = nav.Compile("/rss/channel/item");
            XPathNodeIterator iterator = nav.Select(expr);

            // Iterate on the node set

            try
            {
                while (iterator.MoveNext())
                {
                    XPathNavigator nav2 = iterator.Current.Clone();
                    nav2.MoveToChild("title","");
                    Console.WriteLine(nav2.Value);
                    nav2.MoveToParent();
                    nav2.MoveToChild("pubDate","");
                    Console.WriteLine(nav2.Value);

                }
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.Message);
            }
            Console.ReadKey(); 
```

这是 jan 的工作方法

```
 XmlDocument doc2 = new XmlDocument();
        doc2.LoadXml(xml);
        XmlNode root = doc2.DocumentElement;

        foreach (XmlNode item in root.SelectNodes(@"/rss/channel/item"))
        {
            Console.WriteLine(item.SelectSingleNode("title").FirstChild.Value);
            Console.WriteLine(item.SelectSingleNode("pubDate").FirstChild.Value);
        } 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-28T12:28:24.370

替代：

```
// starts as in Vinko Vrsalovic 's answer
// and not including decent eror handling
XmlDocument doc = new XmlDocument(new StringReader(xml)); 

foreach (XmlNode item in doc.SelectNodes(@"/rss/channel/item"))
{
  Console.WriteLine(item.SelectSingleNode("title").Value);
  Console.WriteLine(item.SelectSingleNode("pubDate").Value);
} 
```

我不知道这段代码是较慢还是不好的做法。请发表评论。

我发现它比使用 Navigator 和 Iterator 的另一个更具可读性。

**Edit:** I use an *Xml*Document. An *XPath*Document as in Vinko Vrsalovic 's answer doesn't support this way of working, but is a lot faster: [(MSDN)](http://msdn.microsoft.com/en-us/library/87274khy.aspx)

# asp.net - Asp.net 中的非本地化错误消息

> ID：243024
> 
> 赞同：1
> 
> 时间：2008-10-28T11:55:29.740
> 
> 标签：asp.net, windows, debugging

我安装了波兰语版本的 Windows，因此我收到波兰语的异常消息。有没有办法让asp.net用英文显示错误信息？除了安装英文版的Windows。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T12:03:33.313

尝试将以下内容添加到 web.config 文件的 system.web 部分：

```
<globalization uiCulture="en-US" /> 
```

这应该有效，除非：

*   您已在其他地方明确更改了 uiCulture（例如，多语言网络应用程序可能会更改每个请求的 uiCulture）

*   您遇到的错误发生在处理 web.config 文件之前。

# asp.net - 第一次回发后下拉列表不回发

> ID：243027
> 
> 赞同：1
> 
> 时间：2008-10-28T11:58:44.057
> 
> 标签：asp.net, drop-down-menu

我有这个 ASP.NET 下拉控件，当值不是英国时，它会显示其他文本框控件（这是为了帮助使用邮政编码查找英国地址）。当重新选择英国时，我想隐藏其他控件。我已启用视图状态和 AutoPostBack 为真。我有一个`onSelectedIndexChanged`事件只被触发一次（当下拉值更改为不同的国家时，默认情况下是英国）。

我希望`OnSelectedIndexChanged`每次值不同时都会触发，但事实并非如此。

PS这是代码片段。

```
<asp:DropDownList runat="server" ID="Country2" AutoPostBack="True" OnSelectedIndexChanged="Country2_SelectedIndexChanged" DataSource="<%# RegionList %>" DataTextField="Name" DataValueField="Code" CssClass="dropdown country"></asp:DropDownList>

protected void Country2_SelectedIndexChanged(object sender, EventArgs e)
{
    DropDownList d = (DropDownList)sender;
    addressEntry.CountryPrePostBack_SelectedIndexChanged(d.SelectedItem.Value);
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-31T14:33:39.203

Every time I've ever had something like this happen it's been because of validation controls. Do those additional textboxes have validators attached to them that could be suppressing the postback? A quick way to tell would be to set CausesValidation="false" on the dropdownlist.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-16T14:50:49.370

当第一次回发时引入 javascript 错误时，我看到了类似的行为。

我想我在第一次回发导致显示新 div 时看到了这一点（使用 javascript，而不是代码隐藏），并且 div 不在 HTML 中。所以“show(div)”javascript 引用了一个丢失的对象。

当然，这是一个非常具体的案例，但我建议在第一次回发后检查任何 js 错误。

迈克尔

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T12:12:01.157

你是如何附加事件的？您是否正在使用后面的代码，例如：

```
this.dropDownList.SelectedIndexChanged += new EventHandler(dropDownList_SelectedIndexChanged); 
```

还是您在 ASPX/ASCX 中分配它？

如果是前者，请确保您没有在`!IsPostback`条件内分配它，您需要确保它在每次回发时添加的事件。

您是否尝试过使用调试器来查看回发是否实际发生在后续事件中？可能是您新添加的控件导致验证失败，如果您使用验证器，请确保将下拉列表设置为，`CauseValidation = false`以便每次回发。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-07T01:58:15.973

我只能想到两个问题要问。

1.) 您是否正在填充（绑定）到 page_load 事件的列表？如果是这样，那么您只需要在页面第一次加载时执行此操作。当您绑定到控件（或其他控件）时，它将重置选定的索引。如果启用了视图状态，那么它将保留原始列表。2.) 现在我不会假设上述情况已经正确，因此我会询问是否从该页面的父级启用了视图状态。如果您打开跟踪并查看页面控制列表，您应该能够看到此特定项目的视图状态大小。如果它有一个值，那么您就知道您正在正确设置视图状态。如果没有，那么按照父控件的顺序工作以查看视图状态的结束位置。

Viewstate 是检测回发所必需的，因此查看它是否正常工作很重要。

现在我是一名 VB.net 程序员，我注意到在您的子程序中似乎没有处理程序。在 vb.net 中，我们通常会看到类似

```
Private Sub LinkButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles LinkButton.Click 
```

使事件正确触发的唯一另一种方法是将其包含在按钮中，但您似乎已经正确地做到了。您可能想以我上面提到的方式尝试它，看看这是否对您有任何改变。

安德鲁

# open-source - 数据挖掘开源软件替代品

> ID：243033
> 
> 赞同：17
> 
> 时间：2008-10-28T12:03:57.413
> 
> 标签：open-source, data-mining

我正在评估数据挖掘包。
到目前为止，我已经找到了这两个：

*   [快速矿工](http://rapid-i.com/content/blogcategory/38/69/)*   [维卡](http://www.cs.waikato.ac.nz/~ml/weka/)您对这两个产品有什么经验可以分享，或者有什么其他产品可以推荐给我吗？
谢谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-09-06T18:35:34.150

根据 KDnuggets 2007、2008 和 2009 年年度民意调查，RapidMiner 是全球数据挖掘专家中使用最广泛的开源数据挖掘解决方案： [KDnuggets Data Mining Tool Poll 2009](http://www.kdnuggets.com/polls/2009/data-mining-tools-used.htm)

RapidMiner 是开源的，100% Java，RapidMiner 比 Weka 和 KNIME 更灵活，提供更多的功能。

关于 SVM 实现：Weka 提供了一种这样的实现（LibSVM），而 RapidMiner 提供了四种 SVM 实现（LibSVM、MySVM、EvoSVM、SMO-SVM），其中一些具有更高级的功能。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-28T12:48:09.180

另一种选择是[Orange](http://magix.fri.uni-lj.si/orange/)。它包括各种算法和数据挖掘技术，您可以通过 Python 脚本或 GUI 直接访问它们。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-28T13:31:59.077

重新发明轮子并直接在 R 中编码！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T12:21:22.950

[Pentaho](http://www.pentaho.com/products/data_mining/)非常适合商业智能。所以也许你想看看它。我在这方面有一些经验，主要是做数据仓库的，还挺开心的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-10-22T18:25:46.347

如果您对一些与**频繁模式挖掘、关联规则和顺序模式挖掘相关的****Java**代码感兴趣，我有一个小型开源项目，其中包含与这些主题相关的 42 种算法：[http://www.philippe-fournier-viger。 com/spmf/](http://www.philippe-fournier-viger.com/spmf/)

 **但是，请注意，它不提供任何用户界面。但它提供了一些您在其他数据挖掘包中找不到的非常专业的算法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-28T12:15:45.877

我在一门高中课程中使用过**Weka ，它有一个很好的**[SVM](http://en.wikipedia.org/wiki/Support_vector_machine)实现。这是四五年前的事了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-06-17T02:02:34.697

( [KNIME](http://www.knime.org/) ) 是相当广泛的数据挖掘平台。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-05-31T08:57:07.050

根据 KDnuggets 2011 年民意调查，RapidMiner 再次成为全球使用最广泛的数据挖掘解决方案： [http ://www.kdnuggets.com/2011/05/tools-used-analytics-data-mining.html](http://www.kdnuggets.com/2011/05/tools-used-analytics-data-mining.html)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-12-29T15:23:50.933

Have a look at [ELKI](http://elki.dbs.ifi.lmu.de/), which is like WEKA except it is much much stronger on clustering and outlier detection, while WEKA essentially only does classification well.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-01-06T00:07:22.617

如前所述，Pentaho 是 WEKA 所属的一个强大的商业智能套件。

所以我也推荐 Weka，只是为了你有一个很好的解决方案来扩展你的应用程序和一个很棒的社区。

# mysql - 在 MySQL 中查找两个表的行数差异

> ID：243035
> 
> 赞同：5
> 
> 时间：2008-10-28T12:04:54.917
> 
> 标签：mysql, sql, count, sum

我有两张桌子，一张存储我们购买的产品和数量，另一张存储销售。因此，当前库存是购买表中所有数量列的总和减去出售表中的行数。这如何在 MySQL 中表达。请记住，有许多不同的产品。

**编辑：** 为了让它更难，我还有另一个要求。我有购买表，出售表，但我也有产品表。我想要一份所有产品的清单，我想知道每种产品的可用数量。当前答案的问题是他们只退回我们已经出售或购买的产品。我想要所有的产品。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T12:18:05.560

试试这个

```
 SELECT inv_t.product_id, inventory_total-nvl(sales_total,0)
FROM 
  (SELECT product_id, sum(quantity) as inventory_total
   FROM inventory
   GROUP BY product_id) inv_t LEFT OUTER JOIN
  (SELECT product_id, count(*) AS sales_total 
   FROM sales 
   GROUP BY product_id) sale_t
  ON (inv_t.product_id = sale_t.product_id) 
```

这是一个比其他一些解决方案更好的解决方案，这些解决方案没有考虑到某些产品在销售表中可能没有任何对应行的事实。您要确保此类产品也出现在结果中。

NVL 是一个特定于 Oracle 的函数，它返回第一个参数的值，除非它为 null，在这种情况下它返回第二个参数的值。在所有商业 DBMS 中都有等效的功能——您可以在 MySQL 中使用 CASE 来达到相同的效果。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T12:21:01.840

```
SELECT product AS prd, 
SUM(quantity) - 
  IFNULL((SELECT COUNT(*)
   FROM sells
   WHERE product = prd 
   GROUP BY product), 0)
AS stock 
FROM bought
GROUP BY product; 
```

当销售数量为 0 时，此选项也有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T13:24:36.050

我建议将“库存”和“销售”表制作成视图，以便它们可重用并且最终查询变得非常简单。显然，字段和表名需要更改以匹配您的架构。

```
--First view: list products and the purchased qty
create or replace view product_purchases as
select
  product_id
 ,sum(purchased_qty) as purchased_qty
from
  purchases
group by
  product_id;

--Second view: list of products and the amount sold    
create or replace view product_sales as
select
  product_id
 ,count(*) as sales_qty
from
  sales
group by
  product_id;

--after creating those two views, run this query:
select
  pp.product_id
 ,pp.purchased_qty - ps.sales_qty as on_hand_qty
from
  product_purchases pp
 ,product_sales ps
where ps.product_id = pp.product_id; 
```

# asp.net - Web.Config 回退到 Web Farm 中的全局配置

> ID：243037
> 
> 赞同：1
> 
> 时间：2008-10-28T12:05:42.573
> 
> 标签：asp.net, configuration, web-config, web-farm

这个问题让我们几个人在办公室里难住了。对于将 ASP.NET 应用程序部署到网络场，我们都是新手，而且我的想法很新鲜。

我们有一个网络农场，应用程序被复制到所有这些农场。但是，我们遇到了问题..

尝试从中获取设置时引发异常`appSettings`。经过进一步调查，事实证明该节点实际上并未使用本地节点，`Web.Config`而是回退到`Web.Config`.NET 框架文件夹中（我们通过在此处添加密钥证明了这一点，这些密钥出现在测试页面上）。

我一定遗漏了一些东西，因为我的理解是只要文件在那里，IIS 就应该使用它！其中一台服务器似乎工作正常！

以下是我们已确认的清单：

*   配置文件位于 app 目录中。
*   所述文件的内容是正确的。
*   从 IIS > 站点 > 属性 > ASP.NET > 编辑配置查看文件时，会显示正确的内容。

但是，在运行时使用的文件是全局文件 ( `windows\ms .net\framework\v2\config\web.config`)。

有人对可能出现的问题有任何建议吗？感谢我能得到的所有帮助！

谢谢。

抢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T12:12:02.063

这是 ASP.NET 配置的层次结构。也许这可以帮助理解哪些设置会相互覆盖。

## 服务器

Machine.config：Machine.config 文件包含服务器上所有 Web 应用程序的 ASP.NET 架构。此文件位于配置合并层次结构的顶部。

## 根网

Web.config：服务器的 Web.config 文件与 Machine.config 文件存储在同一目录中，并且包含大多数 system.web 配置部分的默认值。在运行时，此文件在配置层次结构中从顶部倒数第二个合并。

## 网站

Web.config：特定网站的 Web.config 文件包含适用于该网站的设置，并通过该网站的所有 ASP.NET 应用程序和子目录向下继承。

## ASP.NET 应用程序根目录

Web.config：特定 ASP.NET 应用程序的 Web.config 文件位于应用程序的根目录中，包含适用于 Web 应用程序并通过其分支中的所有子目录向下继承的设置。

## ASP.NET 应用程序子目录

Web.config：应用程序子目录的 Web.config 文件包含应用于此子目录的设置，并通过其分支中的所有子目录向下继承。

## 客户端应用程序目录

ApplicationName.config：ApplicationName.config 文件包含 Windows 客户端应用程序（不是 Web 应用程序）的设置。

* * *

了解哪些 ASP.NET 文件和文件夹是通过文件夹和应用程序继承的，这对于开发和故障排除非常重要。

这是一个简短的摘要：

*   web.config 文件一直沿树继承，超过所有应用程序边界。
*   global.asax 仅存在于其应用程序中
*   /bin 和 /app_{folders} 只存在于他们的应用程序中

因此，这意味着根 web.config 文件中设置的任何内容都将沿用整个站点，即使某些文件夹被标记为应用程序也是如此。

如果 web.config 文件具有对程序集的引用，但子应用程序没有这些程序集，这会变得混乱。例如，假设您在站点的根目录中配置了一个 HTTP 模块，并从站点 web.config 文件中引用。如果您有一个名为 /subfolder 的子应用程序被标记为应用程序，那么 /subfolder 将尝试从 /subfolder/bin 加载 HTTP 处理程序。由于它不存在，因此将引发错误。

有多种方法可以解决这个问题。如果 /subfolder 中不需要 HTTP 处理程序，可能最干净的方法是通过在 /subfolder/web.config 文件中添加子句来“删除”引用。您可以使用 . 以下是如何删除子文件夹中的 HTTP 模块的示例：

```
<httpModules>
  <remove name="ErrorLog"/>
</httpModules> 
```

以下是网站 web.config 的样子：

```
<httpModules>
      <add name="ErrorLog"  type="GotDotNet.Elmah.ErrorLogModule, GotDotNet.Elmah, Version=1.0.5527.0, Culture=neutral, PublicKeyToken=978d5e1bd64b33e5" />
</httpModules>print("code sample"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T13:54:36.053

根据您在评论中所说的，我建议使用“Try and Error”。

如果您故意插入错误的条目会发生什么？应用程序是否失败或不影响任何事情？

尝试复制内容，然后从头开始删除并重新创建该文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T19:20:58.307

首先，非常感谢回答的人，我非常感谢您的帮助！

只是关于这个问题的更新。这是一个艰难的！

事实证明，代码或配置没有任何问题。

服务器场似乎发生了一些奇怪的事情（我完全无法控制或访问）。系统管理员重新构建了农场，重新部署了解决方案，一切正常。

我想我们永远不会知道出了什么问题，但至少我们知道这不是开发问题！

再次感谢，罗布

# java - 为什么添加长变量会导致连接？

> ID：243045
> 
> 赞同：2
> 
> 时间：2008-10-28T12:11:23.810
> 
> 标签：java, long-integer, string-concatenation, addition

Java 在执行加法时如何处理长变量？

错误的版本1：

```
Vector speeds = ... //whatever, speeds.size() returns 2
long estimated = 1l;
long time = speeds.size() + estimated; // time = 21; string concatenation?? 
```

错误的版本 2：

```
Vector speeds = ... //whatever, speeds.size() returns 2
long estimated = 1l;
long time = estimated + speeds.size(); // time = 12; string concatenation?? 
```

正确版本：

```
Vector speeds = ... //whatever, speeds.size() returns 2
long estimated = 1l;
long size = speeds.size();
long time = size + estimated; // time = 3; correct 
```

我不明白，为什么 Java 将它们连接起来。

任何人都可以帮助我，为什么连接两个原始变量？

问候，格尔达

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-28T12:28:09.580

我的猜测是你实际上正在做类似的事情：

```
System.out.println("" + size + estimated); 
```

这个表达式是从左到右计算的：

```
"" + size        <--- string concatenation, so if size is 3, will produce "3"
"3" + estimated  <--- string concatenation, so if estimated is 2, will produce "32" 
```

要使其正常工作，您应该执行以下操作：

```
System.out.println("" + (size + estimated)); 
```

再次从左到右评估：

```
"" + (expression) <-- string concatenation - need to evaluate expression first
(3 + 2)           <-- 5
Hence:
"" + 5            <-- string concatenation - will produce "5" 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-28T12:15:22.290

我怀疑你没有看到你认为你看到的东西。Java 不这样做。

请尝试提供一个[简短但完整的程序](http://pobox.com/~skeet/csharp/complete.html)来演示这一点。这是一个简短但完整的程序，它演示了正确的行为，但使用了您的“错误”代码（即反例）。

```
import java.util.*;

public class Test
{
    public static void main(String[] args)
    {
        Vector speeds = new Vector();
        speeds.add("x");
        speeds.add("y");

        long estimated = 1l;
        long time = speeds.size() + estimated;
        System.out.println(time); // Prints out 3
    }
} 
```

# c# - 将每条记录包含 300 个元素的 XML 加载到数据库中

> ID：243049
> 
> 赞同：0
> 
> 时间：2008-10-28T12:12:29.037
> 
> 标签：c#, sql-server, xml, linq, .net-3.5

所以我有这个包含每条记录 300 多个元素的大型 XML 文件，我需要将这些记录插入到数据库表中。XML 文件中的节点名称与 db.xml 中的列名称相同。它们都是字符串。是否有一种自动的方式来映射它们并插入数据，或者我是否必须写出将每列映射到 XML 文件中的每个元素的代码行？使用 SQL Server 2005。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T12:34:31.020

我同意对于 SQL 服务器，使用批量加载或 SQL/XML 是一个不错的选择。

如果数据库不是 SQL 服务器并且本身不支持 xml，另一种选择是使用基本的 xslt 将 xml 转换为 csv 或 tsv；大多数数据库都可以导入分隔文件。

当然，另一个问题是：为什么你有 300 列？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T13:07:15.540

300 列？不是我阅读问题的方式，但我的英语又不是那么好。:) 据我所知，Xml 和数据库表/列之间没有自动映射。但是写动态更新应该没那么难吧？获取所有列名（节点名）并将它们添加到一个字符串（column1、column2 等），然后遍历 xml 以生成值（node1.Value node2.Value 等）。或者，如果您使用的是 Sql Server 2005/2008，请使用[批量插入](http://msdn.microsoft.com/en-us/library/ms188365.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T12:26:25.230

你用的是什么数据库引擎？

SQL 服务器可以使用批量加载或导入/导出向导等方式导入数据。

[Microsoft KB](http://support.microsoft.com/kb/316005) , +[许多其他技术](http://www.google.com/search?q=sql+server+2005+import+xml)

# c# - Response.Redirect 剥离 Header Referrer - 可以将其添加回来吗？

> ID：243057
> 
> 赞同：7
> 
> 时间：2008-10-28T12:16:52.427
> 
> 标签：c#, asp.net, .net, http-headers, response.redirect

我正在使用 Response.Redirect 将用户重定向到另一台服务器以下载文件，而另一台服务器正在检查标头以确保它来自正确的服务器...但是似乎 Response.Redirect 从响应中剥离了标头.

有谁知道我可以如何添加标题？我试过了：

```
Response.AddHeader("Referer", "www.domain.com"); 
```

但是当我检查是否设置了 Referrer 标头时，接收页面测试为 false。

除了显示一个供用户单击的按钮之外，我如何获得此工作的任何建议（我希望尽可能地对用户隐藏 url）。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-29T16:41:38.600

有一个 HTML hack 可用。

```
<form action="http://url.goes.here" id="test" method="GET"></form>
<script type="text/javascript">
  document.getElementById("test").submit();
</script> 
```

如果您需要从后面的代码中触发它，也可以这样做：

```
Response.Write( @"<form action='http://url.goes.here' id='test' method='GET'></form>
                  <script type='text/javascript'>
                     document.getElementById('test').submit();
                  </script> "); 
```

正如 Inkel 可能指出的那样，这是对 Referer[sic] 规范的松散解释。它会做你想做的事。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T13:40:15.613

这将违反Referer（原文如此）标头[定义](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.36 "HTTP/1.1 Header 字段定义：Referer")：

> 为了服务器的利益，Referer[sic] request-header 字段允许客户端指定获取**Request-URI 的资源的地址 (URI)**（“referrer”，尽管头字段拼写错误。）

如果您要重定向，则显然不是添加此标头的情况。

如果您需要此信息，请尝试使用 cookie 或一些会话变量，或者更好的是 URL 中的变量，正如您已经被告知的那样。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T12:24:28.170

我不认为这是可能的。您发送回客户端的是一个 Location 标头，它告诉客户端加载引用的页面而不是它最初请求的页面。在这种情况下，客户端不是来自链接，因此不会设置引用标头。基本上就好像用户在浏览器的地址栏中输入了重定向 URL。

您可以将引用者保存在会话中，或者将其编码为 URL 中的查询参数。就像 Forms 登录对 ReturnUrl 所做的那样。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T12:37:51.993

[Server.Transfer](http://msdn.microsoft.com/en-us/library/y4k58xk7.aspx)是一个选项吗？

不过，您需要注意一些注意事项。EG 保留原始 URL、授权等...更多详细信息在链接中。

在这种情况下，保留原始 URL 可能是有利的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T13:20:44.640

您的第二个服务器获取的引用标头是由浏览器生成的，您不太可能以任何合理的方式更改它。

您是否尝试将引用者添加到 URL，然后在您的第二台服务器上读取？

```
Response.Redirect("url?Referer=" + Server.UrlEncode(Request.UrlReferrer)); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-12-16T16:00:39.943

这是对我有用的先前版本：

```
default.asp

servername = Lcase(Request.ServerVariables("SERVER_NAME"))
Response.Status = "301 Moved Permanently"
Response.AddHeader "Location", "http://yoursite"
Response.AddHeader "Referer", servername
Response.End() 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-04-13T07:55:10.757

我知道这是旧的，但我只是在尝试做类似的事情时遇到它。

我不想将它添加到 URL，因为它有点用我不想要的东西污染了 URL。此外，我不希望人们意外地为该 URL 添加书签。因此，我使用 Cookies 来添加我的数据；

```
string token = vwrApi.GetAuthenticationToken(userId);
Response.Cookies.Add(new HttpCookie("VwrAuthorization", token));
Response.Redirect(returnUrl, true); 
```

当然，这取决于您更改目标服务器查找信息的位置的能力，但至少这是另一种选择。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-28T13:32:15.893

设置一个 auth cookie（带有密钥哈希和 5 分钟到期），发送重定向响应，浏览器将新请求与 auth cookie 一起发送到第二个服务器（如果它是同一个域），第二个服务器检查 cookie，确保只有第一台服务器可以设置它，并将内容发送回浏览器。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-28T14:25:20.547

如果重定向到同一个进程，我会使用 Session 值来存储引用 URI 以允许辅助页面获取它。我在我的系统上使用它来维护将 http 连接重定向到我们的 https 系统之间的引用者。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-03-06T13:13:32.887

我不建议发布 - 大多数网站都会阻止它。只需使用`javascript document.location = '<%:yourURL%>;';`它将自动加载新页面。这对我来说效果很好 - 因为重定向响应不包括推荐人。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2012-06-27T18:09:22.523

您需要发出 307 状态响应并将位置标头设置为您希望将用户重定向到的目标。这将保持原始的referer[sic] 标头完好无损。

```
HttpContext.Current.Response.StatusCode = 307;
HttpContext.Current.Response.AddHeader("Location", "http://stackoverflow.com");
HttpContext.Current.Response.End(); 
```

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2008-10-29T16:47:44.453

+1 对 inkel 的上述评论。

尽管如果您不关心规范并且只想这样做，您可以避免使用 Response.Redirect 而是自己构建响应标头。

```
Response.StatusCode = 302; //temp redirect
Response.Headers.Add("Location", "your/url/here");
Response.Headers.Add("Referer", "something.com");
Response.End(); 
```

这不是我的想法，您可能需要在响应标头中添加一些其他内容。

# python - 在 MacOS 上的 Emacs 中设置 PYTHONPATH？

> ID：243060
> 
> 赞同：17
> 
> 时间：2008-10-28T12:17:35.547
> 
> 标签：python, macos, emacs, environment-variables

Emacs 无法识别我正确的 Python 路径。我认为这是 Emacs 无法识别我的环境变量的普遍问题。我安装了 2007-06-17 的 GNU Emacs 22.1.1（i386-apple-darwin8.9.1，Carbon 版本 1.6.0）。

我已经`PYTHONPATH`在我的`~/.bashrc`. 也许我应该把它设置在别的地方？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-28T13:17:01.307

`.bashrc`仅在 shell 启动时读取；它不会影响 Carbon Emacs。相反，`setenv`请在您的`.emacs`:

```
(setenv "PYTHONPATH" "PATH_STRING_HERE") 
```

您可以设置`PYTHONPATH`整个 Mac OS 会话，方法是将其添加到`~/.MacOSX/environment.plist`（[此处](http://developer.apple.com/documentation/MacOSX/Conceptual/BPRuntimeConfig/Articles/EnvironmentVars.html#//apple_ref/doc/uid/20002093-113982)更多）。除非您安装了 XCode（及其属性列表编辑器），否则您可能不想这样做。

（[通过 Procrastiblog](http://procrastiblog.com/2007/07/09/changing-your-path-in-emacs-compilation-mode/)）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2017-02-13T14:14:43.577

为了不手动复制粘贴：

```
(setenv "PYTHONPATH" (shell-command-to-string "$SHELL --login -c 'echo -n $PYTHONPATH'")) 
```

# c# - 如何在 C# 中创建 EPS 文件？

> ID：243068
> 
> 赞同：5
> 
> 时间：2008-10-28T12:21:38.393
> 
> 标签：c#, .net, vector-graphics, eps

如何在 C# 中创建 EPS 文件？是否有任何可用的开源库，还是我必须求助于[规范](http://www.adobe.com/devnet/postscript/pdfs/5002.EPSF_Spec.pdf)并手动完成？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T12:29:13.743

您可以使用与我在 HTML 到 Postscript 问题中建议的相同原则：[html-to-postscript-conversion](https://stackoverflow.com/questions/238217/html-to-postscript-conversion#238236)

设置起来很笨拙，但是一旦完成，它就可以很好地工作。如果您没有创建 EPS 文件的打印机驱动程序，您可以下载一些免费软件 pdf creator 打印机驱动程序。我相信其中一些也允许您创建 EPS 文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T12:31:42.927

cairo 库[http://www.cairographics.org](http://www.cairographics.org)生成各种图形格式，例如 svf、pdf 或 ps，我认为它具有 c# 的绑定。

# java - WebSphere Portal v.5.1 和 AJP？

> ID：243071
> 
> 赞同：1
> 
> 时间：2008-10-28T12:21:49.110
> 
> 标签：java, apache, websphere, ajp

有没有办法将 WebSphere Portal 配置为接受 AJP 连接？例如 Tomcat/JBoss 和 Oracle 有一个特定的 AJP 端口。我在 WebSphere 中找不到它，而且我已经厌倦了在 IBM 页面上使用谷歌搜索。

谢谢你转发......巴林特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-31T12:35:59.187

[配置 AJP 连接器](http://publib.boulder.ibm.com/wasce/V1.0/Tasks/Tomcat/Ajp.html)

# asp.net - 仅为登录用户动态呈现网页

> ID：243072
> 
> 赞同：1
> 
> 时间：2008-10-28T12:22:06.800
> 
> 标签：asp.net, master-pages

当用户登录到我的站点时，我希望出现一个 css 样式的按钮（这实际上可以是任何东西，即一些特殊的新闻文本项等），您如何通过 asp.net 中的 masterpages 做到这一点？还是有其他方法可以做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T12:26:03.237

查看 ASP.Net 中的 LoginView 控件。它需要两个模板 - 一个用于登录用户，一个用于未登录用户。我想它应该做你想要的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T12:27:13.653

您尚未提供有关您的设置 simon 的大量信息，但假设您使用的是 .NET Membership Provider，那么您可以使用登录视图让您的页面部分呈现不同的登录 Vs。不是

```
 <asp:LoginView>
        <AnonymousTemplate>
            Nothing Displayed
        </AnonymousTemplate>
        <LoggedInTemplate>
            <asp:Button ID="myButton" runat="server">
        </LoggedInTemplate>
    </asp:LoginView> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T12:24:37.793

这篇 MSDN 文章介绍了如何从内容页中查找和操作母版页内容。

[MSDN](http://msdn.microsoft.com/en-us/library/xxwa0ff0(VS.85).aspx)

# objective-c - Objective-C 垃圾回收中的自有对象

> ID：243074
> 
> 赞同：6
> 
> 时间：2008-10-28T12:24:34.877
> 
> 标签：objective-c, cocoa, garbage-collection

我想知道处理在内存管理代码中对象不属于任何特定所有者的情况的推荐方法是什么，即对象自己释放。一个这样的例子可能是 NSWindowController 的子类，它配置、显示和管理单个窗口的输入和输出。控制器对象显示一个窗口并稍后在某个时候释放自己（通常在它管理的窗口或工作表关闭时）。AppKit 也提供了几个例子： NSAnimation 在 startAnimation 中保留自己并在动画完成时释放自己。另一个例子是 NSWindow，它可以配置为在关闭时释放自己。

在自己实现这些“自有”对象时，我看到至少三种不同的 GC 安全模式，但它们都有一些缺点。

一种）。使用 CFRetain/CFRelease。

自有对象在开始其操作之前调用自身的 CFRetain（例如，在窗口控制器示例中，在窗口显示之前）。然后它在完成后调用自身的 CFRelease()（例如，在窗口关闭后的窗口控制器示例中）。

优点：对象的用户不必担心内存管理。
缺点：有点难看，因为需要使用内存管理功能，尽管我们在纯 ObjC 代码中使用 GC。如果没有调用 CFRelease()，泄漏可能很难定位。

乙）。避免使用静态数据结构的自我所有权习语。

对象在开始操作之前将自己添加到数据结构（例如静态可变数组）中，并在完成后将自己从那里移除。

优点：对象的用户不必担心内存管理。不调用内存管理函数。对象有明确的所有者。潜在的泄漏很容易找到。
缺点：如果可以从不同的线程创建对象，则需要锁定。额外的数据结构。

C）。通过要求对象的用户保存对对象的引用（例如，保存到 ivar）来避免自有习惯用法。

优点：不调用内存管理函数。对象有明确的所有者。
缺点：对象的用户必须保留一个引用，即使它不再需要该对象。额外的 ivars。

你会使用什么模式来处理这些情况？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T18:06:32.707

对于 a)，更惯用的替代`CFRetain(foo)`/`CFRelease(foo)`是`[[NSGarbageCollector defaultCollector] disableCollectorForPointer:foo]`/ `[[NSGarbageCollector defaultCollector] enableCollectorForPointer:foo]`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T12:50:22.687

Apple 的推荐是 (c)，但我喜欢 (b) 的声音。静态数据结构允许您向 API 用户隐藏 GC 详细信息，同时避免陷入 CFRetain/CFRelease 级别。正如您所说，它还使调试和单元测试更容易；如果一个对象在完成任务后仍然被静态数据结构引用，你就知道有一个错误。

# asp.net - 在事件回发并执行验证之前禁用对事件单击的 ASP 验证

> ID：243077
> 
> 赞同：0
> 
> 时间：2008-10-28T12:25:54.297
> 
> 标签：asp.net, validation, postback

您能否在事件点击回发并执行验证之前禁用 ASP 验证？这适用于带有 C# 的 ASP。

我想将一些细节加载到一堆带有字段验证器的文本框中。但是，我需要禁用这些文本框的验证才能实际填充它们，因为验证似乎发生在代码执行之前的回发时。

如果您想知道为什么我在加载数据时启用了字段验证器，那是因为这些字段也包含用户输入的数据。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-17T11:37:28.167

按钮具有布尔“原因验证”设置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T13:00:33.820

您想要的是将“EnableClientScript”设置为 false，然后在初始加载完成后，将其重新打开。它将加载客户端验证脚本。

你也可以用“启用”开关做同样的事情。

所以基本上，如果你想要一个按钮来加载你的表单然后打开验证，你可以创建一个启用/禁用所有验证控件的方法，并在成功填充表单后调用它来启用它们。

干杯!

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T12:31:31.477

准备好后关闭验证并手动调用它。

# objective-c - UITableView 之外的 UIImage 和 UILabel

> ID：243079
> 
> 赞同：1
> 
> 时间：2008-10-28T12:26:24.763
> 
> 标签：objective-c, iphone, cocoa-touch, uiimageview, uiimage

看看这张图片：

[替代文字 http://img139.imageshack.us/img139/4488/pi​​cture2ep3.png](http://img139.imageshack.us/img139/4488/picture2ep3.png)

我知道如何使用分组样式添加 UITableView 以及如何在任何表格单元格中添加标签。

但是如何在视图顶部添加图像和标签，例如屏幕。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T13:12:39.413

使用 Interface Builder，您可以将这些（UILabels 和 UIImageViews）拖到您的视图上。如果您使用的是 UITableViewController，您可能希望切换到标准 UIViewController，以便更好地控制视图中的内容。

将它们拖上后，通过插座连接它们（如果您想以编程方式更改/访问它们）或在 IB 中设置它们的内容并完成它。

# c++ - 以编程方式进行 C++ 铸造：可以做到吗？

> ID：243082
> 
> 赞同：5
> 
> 时间：2008-10-28T12:26:37.290
> 
> 标签：c++, casting

假设我有一个**Base**类和几个**Derived**类。有什么方法可以将对象强制转换为派生类之一，而无需编写如下内容：

```
 string typename = typeid(*object).name();
if(typename == "Derived1") {
   Derived1 *d1 = static_cast< Derived1*>(object);
}
else if(typename == "Derived2") {
   Derived2 *d2 = static_cast < Derived2*>(object);
}
...
else {
  ...
} 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-28T12:49:43.453

不。

阅读多态性。几乎每一个“动态转换”情况都是多态性难以实现的例子。

无论您在动态演员阵容中做出的决定都已经做出。只需将实际工作委托给子类即可。

您遗漏了示例中最重要的部分。有用的、多态的工作。

```
string typename = typeid(*object).name();
if(typename == "Derived1") {
   Derived1 *d1 = static_cast< Derived1*>(object);
   d1->doSomethingUseful();
}
else if(typename == "Derived2") {
   Derived2 *d2 = static_cast < Derived2*>(object);
   d2->doSomethingUseful();
}
...
else {
  ...
} 
```

如果每个子类都实现 doSomethingUseful，这一切都简单得多。并且是多态的。

```
object->doSomethingUseful(); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-28T12:34:56.760

您可以使用`dynamic_cast`并测试 NULL，但我**强烈**考虑重构代码。

如果您需要特定于子类的处理，[模板方法](http://en.wikipedia.org/wiki/Template_method_pattern)可能会有所帮助，但在不知道您要达到什么目的的情况下，这只是一个模糊的猜测。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-28T12:38:48.607

```
Derived1* d1 = dynamic_cast< Derived1* >(object);
if (d1 == NULL)
{
    Derived2* d2 = dynamic_cast< Derived2* >(object);
    //etc
} 
```

我的智能指针类型有以下方法，模拟 C# 'is' 和 'as'：

```
template< class Y > bool is() const throw()
    {return !null() && dynamic_cast< Y* >(ptr) != NULL;}
template< class Y > Y* as() const throw()
    {return null() ? NULL : dynamic_cast< Y* >(ptr);} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-28T12:39:28.467

您可以使用 来执行此操作`dynamic_cast`，例如：

```
if ( Derived1* d1 = dynamic_cast<Derived1*>(object) ) {
    // object points to a Derived1
    d1->foo();
}
else if ( Derived2* d2 = dynamic_cast<Derived2*>(object) ) {
    // object points to a Derived2
    d2->bar();
}
else {
    // etc.
} 
```

但正如其他人所说，这样的代码可能表明设计不佳，您通常应该使用[虚函数](http://www.parashift.com/c++-faq-lite/virtual-functions.html)来实现多态行为。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-28T12:32:18.230

通常，这是一个糟糕设计的标志。为什么需要这样做？可能可以重新设计，这样就不需要了。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-28T12:35:45.150

你到底想完成什么？根据我的经验，这样的事情是糟糕设计的标志。重新评估你的类层次结构，因为面向对象设计的目标是让这样的事情变得不必要。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-28T12:34:21.830

您的示例不会移植，因为未指定 name() 的确切格式。您可以尝试连续的`dynamic_cast`s。 `Dynamic_cast`如果转换为错误的类型，则返回空指针。但是，如果您正在做一个像这样的类型切换，那么您的设计就有问题。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-28T13:17:22.553

我认为 dynamic_cast 是要走的路，但我并不特别认为这对于所有可能的情况都是一个糟糕的设计，因为要转换的对象可能是某些第三方模块提供的东西。假设对象是由应用程序作者不知道的插件创建的。并且该特定插件可能会创建 Derived1（作为旧版本）类型对象或 Derived2（作为新版本）类型对象。也许插件接口不是为特定版本而设计的，它只是创建对象，因此应用程序必须进行这种检查以确保正确的转换/执行。在此之后，我们可以安全地调用 object.doSomethingUsefulThatDoesNotExistInDerived1();

# .net - 什么是强类型数据集？

> ID：243083
> 
> 赞同：7
> 
> 时间：2008-10-28T12:27:08.333
> 
> 标签：.net, dataset, strong-typing

什么是强类型数据集？（。网）

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-28T12:29:45.147

强类型数据集是具有特定类型的表及其列的数据集。

你可以说

```
EmployeeDataset ds = ...
EmployeeRow row = ds.Employees.Rows[0];
row.Name = "Joe"; 
```

代替：

```
DataSet ds = ...
DataRow row = ds.Tables["Employees"].Rows[0];
row["Name"] = "Joe"; 
```

这很有帮助，因为您在编译时而不是运行时发现命名错误，并且还强制列上的类型。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T12:29:01.310

简短回答：保证（由编译器）保存特定类型的数据集。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-28T12:37:51.323

看起来 DataSet 已经被介绍过了，但为了完整起见，请注意在 .NET 3.5 中，有一些简单数据访问的好选择；特别是 LINQ to SQL 之类的东西。这具有类似的目标，但为您的数据类保留了更纯粹的简单 OO 模型。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T12:31:42.570

在编译时与特定表紧密结合的数据集，因此您可以使用实际列名而不是索引来访问表的列。

# java - javac错误“代码太大”？

> ID：243097
> 
> 赞同：20
> 
> 时间：2008-10-28T12:30:13.197
> 
> 标签：java, compiler-construction, ant

我有一个单元测试，其中我静态定义了一个非常大的字节数组（超过 8000 个字节）作为我不想每次运行单元测试时读取的文件的字节数据。

```
private static final byte[] FILE_DATA = new byte[] {
12,-2,123,................
} 
```

这在 Eclipse 中编译得很好，但是通过 Ant 脚本编译时出现以下错误：

```
[javac] C:\workspace\CCUnitTest\src\UnitTest.java:72: code too large
[javac]     private static final byte[] FILE_DATA = new byte[] {
[javac]                                 ^ 
```

任何想法为什么以及如何避免这种情况？

* * *

**回答**： Shimi 的回答成功了。我将字节数组移到一个单独的类中，它编译得很好。谢谢！

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-28T12:34:50.817

Java 中的方法在字节码中被限制为 64k。静态初始化以单一方法完成（请参阅[链接](http://www.mail-archive.com/help-bison@gnu.org/msg01990.html)）
您可以尝试从文件加载数组数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T17:12:34.203

您可以在`@BeforeClass`静态方法中从文件中加载字节数组。这将确保它只为所有单元测试加载一次。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-03-25T14:14:54.633

您可以利用内部类，因为每个类都有自己的 64KB 限制。它可能对单个大数组没有帮助，因为内部类将受到与主类相同的静态初始化器限制。但是，您说您设法通过将数组移动到单独的类来解决问题，所以我怀疑您在主类中加载的不仅仅是这个单个数组。

代替：

```
private static final byte[] FILE_DATA = new byte[] {12,-2,123,...,<LARGE>}; 
```

尝试：

```
private static final class FILE_DATA
{
    private static final byte[] VALUES = new byte[] {12,-2,123,...,<LARGE>};
} 
```

然后，您可以访问值`FILE_DATA.VALUES[i]`而不是`FILE_DATA[i]`，但您会受到 128KB 的限制，而不仅仅是 64KB。

# iis - 如何编写 ISAPI 插件？

> ID：243109
> 
> 赞同：5
> 
> 时间：2008-10-28T12:33:10.087
> 
> 标签：iis

有任何链接/教程可用吗？我想为 IIS6.0 写一个简单的 ISAPI 插件。

首选语言 c++

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T12:46:39.903

下面是一个快速（简单）的 ISAPI 过滤器示例。在尝试编写我的第一个 ISAPI 插件时，我发现它非常有用。 [http://blogs.msdn.com/rakkimk/archive/2007/03/01/writing-a-simple-isapi-filter.aspx](http://blogs.msdn.com/rakkimk/archive/2007/03/01/writing-a-simple-isapi-filter.aspx)

祝你好运。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T14:29:14.237

Visual Studio 曾经有一个 ISAPI 向导，非常适合编写插件。如果您有 6.0，它可能仍然存在。VS 2003 在 MFC 下有一个支持 MFC 的 ISAPI（如果你不想要它，不难删除）。

如果你正在做一个扩展（不是一个过滤器）——这是你需要的最少代码：

[http://groups.google.com/group/microsoft.public.platformsdk.internet.server.isapi-dev/browse_thread/thread/d29e1a767cbb4717](http://groups.google.com/group/microsoft.public.platformsdk.internet.server.isapi-dev/browse_thread/thread/d29e1a767cbb4717)

# c# - ASP.NET 会话状态服务器 - 保存未序列化的数据

> ID：243110
> 
> 赞同：1
> 
> 时间：2008-10-28T12:33:44.547
> 
> 标签：c#, .net, session, state

如您所知，在 ASP.NET 中，您可以使用以下三种模式之一存储会话数据：

*   进程内
*   会话状态
*   SQL 服务器

对于 InProc 模式，您可以存储任何类型的数据对象，即使它不可序列化。但是，在会话状态和 SQL Server 模式下，您只能存储序列化数据。

在我的项目中，我有一个现成的门户，它使用“InProc”模式来存储其会话。由于一些可扩展性和故障处理问题，我需要使用会话状态。

此门户在会话上下文中内部存储未序列化对象的问题（即存储的对象不实现 ISerializable 接口）。我无法访问他们的代码。是否有任何解决方法，以便我能够将会话对象存储在 State Server 中而无需更改其代码。如果这有任何帮助，我仍然可以访问他们的 web.config 文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T12:43:11.767

AFAIK，简单的答案是否定的。如果您不介意更改代码，您可以在实际对象和您的对象之间注入一个包装器对象，并让您的包装器处理序列化包装的对象（本质上作为序列化代理） - 但到那时它几乎更容易只需重新编写代码...

它们是什么类型的物体？通常，会话状态的对象是简单的数据类，所以序列化它们不应该有太多问题吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T12:44:28.270

序列化创建对象的表示，可以存储和读取以重新创建对象的状态。

如果一个对象只包含值类型，那么您可能不需要实现 ISerializable，而只需要 [Serializable] 属性。

为了使这个回答对手头的问题更有帮助或更直接：

你不能序列化一个没有以某种方式被定义为可序列化的对象。任何其他重新创建对象的通用方式都可能导致对象的状态与其“序列化”之前的状态不同。

正如 Marc 所提到的，您可以通过创建自己的可序列化“包装器”来做到这一点，但是您需要非常熟悉相关对象，并且该对象需要具有允许在其中重新创建它的方法这样的方式。

# asp.net - 我能否找出在 ASP 回发时会触发哪些控制事件？

> ID：243120
> 
> 赞同：3
> 
> 时间：2008-10-28T12:37:14.243
> 
> 标签：asp.net, events, request

是否有可能在处理程序内部获取将要触发的控制事件列表`Page_Load`？

例如，如果单击了一个按钮，我可以在`button_click`调用事件处理程序之前弄清楚吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T00:39:58.293

不幸的是，询问 __EVENTTARGET 值并不能解决问题。通常，该值将为空。回发处理根据事件目标值（如果有的话）测试控件状态值与表单（例如文本框）发布的值来确定是否应该引发诸如 TextChanged 之类的事件，从而决定要引发哪些事件.

除了将事件处理程序实际连接到您希望为其捕获事件的所有控件之外，我认为没有任何方法可以确定它。不过，基本上可以做框架所做的事情。您需要在创建控件和恢复视图状态之间但在处理发布的值之前执行此操作。您可以将当前控件值（来自视图状态）与发布的值进行比较，基本上确定*将*触发哪些事件。

你的目标是什么？也许有更好的解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T00:49:20.253

您选择了一个非常棘手的问题……原因是事件会以多种方式触发。

1) __EVENTTARGET（如上所述） 2) 如果您的按钮名称是 MyButt，那么您将在查询字符串中看到“MyButt=”。3) 当每个控件（例如 TextBox）检查请求以查看其在 ViewState 中的值是否与发布的不同时，将触发“Text_Changed”。

但是，您可以使用#1 和#2 来检查几个地方。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T12:59:31.920

以下包含单击时按钮的错位 id。

```
Page.Request.Form["__EVENTTARGET"] 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T19:11:31.403

[这是一个](http://www.java2s.com/Code/ASP/Asp-Control/WatchTextBoxCheckBoxandradiobuttonautopostbackactionC.htm)我相信可以回答您的问题的示例。

另一种方法是在调试时设置一些断点。

# apache - 如果可用，如何配置 mod_rewrite 以提供缩小文件？

> ID：243124
> 
> 赞同：2
> 
> 时间：2008-10-28T12:38:50.823
> 
> 标签：apache, mod-rewrite, minify

这就是问题所在：我们有很多 Javascript 和 CSS 文件，我们宁愿将它们缩小。缩小很容易：设置 YUI 压缩器，运行 Ant 任务，它会输出缩小的文件，我们将它们保存在原始文件旁边。

所以我们最终在 DocumentRoot 的某个地方得到了以下目录结构：

```
/
   /js
      /分钟
         foo-min.js
         bar-min.js
      foo.js
      bar.js
      quux.js
   /css
      ...

```

现在我们需要的是 Apache 从**min**子目录提供文件，如果它们的缩小版本不可用，则*回退到提供未压缩文件。*最后一个问题是我无法解决的。

例如：假设我们有一个对**example.com/js/foo.js**的请求——在这种情况下，Apache 应该发送**/js/min/foo-min.js**的内容。没有缩小**的 quux.js**，所以对 /js/quux.js 的请求**返回**/js/quux.js**本身**，而不是 404。最后，如果没有**/js/fred.js**，它应该以 404 结束。

实际上，我正在以这样一种方式设置构建脚本，即未在生产服务器上部署未压缩的文件，但这种配置在集成服务器和开发机器上仍然可能有用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T13:46:14.620

这是最终起作用的配置：

/js/.htaccess:

```
RewriteEngine On

RewriteBase /js

RewriteCond %{REQUEST_URI} ^/js/((.+)\.js)$
RewriteCond %{DOCUMENT_ROOT}/js/min/%2-min.js -f
RewriteRule ^(.+)$ min/%2-min.js [L] 
```

对于**css**目录也是如此。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T12:52:13.870

您可以使用 RewriteCond 来检测缩小文件的存在：

```
RewriteCond %{REQUESTURI} ^/js/(.*\.js)
RewriteCond js/min/%1 -f
RewriteRule %1 min/%1 [L] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T12:43:16.850

是否可以更改您的构建脚本？如果是这样，您可以将它们配置为缩小文件并为它们提供相同的文件名，但前提是提供了正确的标志，例如，`ant productionDeploy`而不是`ant integrationDeploy`. 这样，缩小过程对除了构建脚本之外的所有内容都是完全透明的。

# tags - 您将如何识别用户最活跃的部分？

> ID：243129
> 
> 赞同：0
> 
> 时间：2008-10-28T12:41:05.030
> 
> 标签：tags, tagging

在网站上，所有内容都由工作人员指定的关键字标记（由于其性质，它不是社区驱动的网站）。我能够确定用户最活跃的标签（或者，他们查看最多的标签）。但是，我不确定如何选择列表。出现了一些选项，但它们对我来说似乎不正确。

*   取前 n 个（如果查看的标签少于 n 个，则为 m < n）标签
*   取前 n 个标签，其中 n 是查看的总标签的百分比
*   获取具有 m 个视图的前 n 个标签，其中 n 和 m 是查看的总标签和总页面视图的百分比
*   获取所有标签，无论视图如何

目标是确定用户最感兴趣的内容，并根据分配给内容的标签向他们展示他们可能感兴趣的其他内容。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T12:54:10.590

您可以查看机器学习算法以找到用于评估您选择的有效性的算法。

例如：[http](http://en.wikipedia.org/wiki/Supervised_learning#Approaches_and_algorithms) ://en.wikipedia.org/wiki/Supervised_learning#Approaches_and_algorithms最近邻居和贝叶斯等东西可以帮助您改进建议。

然而，这只是建议“你也想看看这个吗？”有点过头了，但这是提供更好搭配的有趣方法。但是，它需要一些方法来确定您的用户是否重视您的建议（例如“我喜欢这个！”-链接或基于链接所花费时间的日志分析等）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T12:55:53.520

一个简单的解决方案是尝试多个报告并检查哪个报告的信息量更大。您的网站和数据的性质可能意味着某些报告出乎意料地有用，而另一些则没有。例如，如果报告获得“平面”面积图 - 寻找其他东西。

更好地为报告的消费者提供选择和提供反馈的能力。根据他们真正需要的内容调整报告。

PS 我会先从“*获取前 n 个标签，其中 n 和 m 是总标签浏览量和总页面浏览量的百分比*”报告

# php - 如何从 PHP 中的关联数组中删除具有空键的值？

> ID：243132
> 
> 赞同：13
> 
> 时间：2008-10-28T12:42:30.863
> 
> 标签：php, arrays, associative-array

我有一个似乎是空字符串的键，但是 using`unset($array[""]);`不会删除键/值对。我没有看到另一个函数可以满足我的要求，所以我猜它比调用一个函数更复杂。

print_r 上元素的行是`[] => 1`，这向我表明键是空字符串。

使用 var_export，元素被列为`'' => 1`.

使用 var_dump，元素被列为`[""]=>int(1)`.

到目前为止，我已经尝试了所有建议的删除方法，但没有一个删除该元素。我试过了`unset($array[""]);`，`unset($array['']);`但`unset($array[null]);`没有运气。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-28T13:02:29.310

尝试`unset($array[null]);`

如果这不起作用，请通过`var_export`或`var_dump`代替打印数组`print_r`，因为这可以让您查看键的类型。用于`var_export`查看 PHP 语法中的数据。

`var_export($array);`

请注意， var_export 不适用于递归结构。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T12:58:04.280

试过：

```
$someList = Array('A' => 'Foo', 'B' => 'Bar', '' => 'Bah');
print_r($someList);
echo '<br/>';
unset($someList['A']);
print_r($someList);
echo '<br/>';
unset($someList['']);
print_r($someList);
echo '<br/>'; 
```

拿到：

```
Array ( [A] => Foo [B] => Bar [] => Bah )
Array ( [B] => Bar [] => Bah )
Array ( [B] => Bar ) 
```

您也应该分析密钥的来源...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T12:46:13.023

我的猜测是它不是一个空字符串。尝试以下操作，看看你会得到什么：

```
foreach ($array as $index => $value) {
    echo $index;
    echo ' is ';
    echo gettype($index);
    echo "\n";
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T13:04:27.463

尝试使用`var_dump`而不是`print_r`. 这可能会让您更好地了解密钥到底是什么。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T14:43:26.670

不知道该告诉你什么。运行此脚本

```
<?php

$arr = array(
        false   => 1
    ,   true    => 2
    ,   null    => 3
    ,   'test'  => 4
//  ,   ''      => 5
);

print_r( $arr );

foreach ( $arr as $key => $value )
{
    var_dump( $key );
}

unset( $arr[''] );

print_r( $arr ); 
```

我得到以下输出

```
Array
(
    [0] => 1
    [1] => 2
    [] => 3
    [test] => 4
)
int(0)
int(1)
string(0) ""
string(4) "test"
Array
(
    [0] => 1
    [1] => 2
    [test] => 4
) 
```

看看“null”数组键是如何被类型转换为空字符串的？

你确定你没有使用数组的副本吗？如果您从函数内部对 unset() 进行了此调用，那么您可能就是这样。

这是在 PHP 5.2.0 上测试的

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T14:12:17.717

请在该行之前和之后发布您用于删除元素的代码以及您的检查器代码。

我正在寻找的是这样的：

```
var_export($array);
echo "\n";
unset($array[""]);
var_export($array); 
```

`var_export`还请发布两行的完整输出。

我正在寻找这样的东西：

```
array (
  '' => 1,
)
array (
) 
```

# c# - 如何在 C# 中编写条件锁？

> ID：243152
> 
> 赞同：8
> 
> 时间：2008-10-28T12:50:27.663
> 
> 标签：c#, .net, multithreading, locking

问题是我一直在使用[lock 语句](http://msdn.microsoft.com/en-us/library/c5kehkcz.aspx)来保护我的代码的关键部分，但现在，我意识到我可以允许该关键代码的并发执行，前提是满足某些条件。
有没有办法调节锁？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-28T12:59:34.183

我认为这个问题叫“种族条件！”。如果在检查后不久条件从真变为假，但在线程进入代码的关键部分之前怎么办？或者当一个线程正在执行它的过程中？

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-28T13:02:01.383

```
bool locked = false;
if (condition) {
    Monitor.Enter(lockObject);
    locked = true;
}
try {
    // possibly critical section
}
finally {
    if (locked) Monitor.Exit(lockObject);
} 
```

编辑：是的，除非您可以确保在线程进入时条件是恒定的，否则存在竞争条件。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-28T15:29:03.443

我不是线程专家，但听起来您可能正在寻找类似的东西（双重检查锁定）。这个想法是在获取锁之前和之后检查条件。

```
private static object lockHolder = new object();

if (ActionIsValid()) {
  lock(lockHolder) {
    if (ActionIsValid()) {
       DoSomething();    
    }
  }
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-28T12:57:11.723

```
Action doThatThing = someMethod;

if (condition)
{
  lock(thatThing)
  {
     doThatThing();
  }
}
else
{
  doThatThing();
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-28T13:01:08.610

实际上，为了避免竞争条件，我很想在[`ReaderWriterLockSlim`](http://msdn.microsoft.com/en-us/library/system.threading.readerwriterlockslim.aspx)这里使用 - 将并发访问视为读锁，将独占访问视为写锁。这样，如果条件发生变化，您将不会在该区域中仍然盲目执行一些不适当的代码（在错误假设它是安全的情况下）；有点冗长，但是（格式化为空格）：

```
 if (someCondition) {
            lockObj.EnterReadLock();
            try { Foo(); }
            finally { lockObj.ExitReadLock(); }
        } else {
            lockObj.EnterWriteLock();
            try { Foo(); }
            finally { lockObj.ExitWriteLock(); }
        } 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-08-19T16:15:54.070

如果您有许多需要条件锁定的方法/属性，您不想一遍又一遍地重复相同的模式。我提出以下技巧：

## 非重复条件锁模式

使用私有助手`struct`实现`IDisposable`，我们可以封装条件/锁而没有可测量的开销。

```
public void DoStuff()
{
    using (ConditionalLock())
    {
        // Thread-safe code
    }
} 
```

这很容易实现。这是一个演示此模式的示例类：

```
public class Counter
{
    private static readonly int MAX_COUNT = 100;

    private readonly bool synchronized;
    private int count;
    private readonly object lockObject = new object();

    private int lockCount;

    public Counter(bool synchronized)
    {
        this.synchronized = synchronized;
    }

    public int Count
    {
        get
        {
            using (ConditionalLock())
            {
                return count;
            }
        }
    }

    public int LockCount
    {
        get
        {
            using (ConditionalLock())
            {
                return lockCount;
            }
        }
    }

    public void Increase()
    {
        using (ConditionalLock())
        {
            if (count < MAX_COUNT)
            {
                Thread.Sleep(10);
                ++count;
            }
        }
    }

    private LockHelper ConditionalLock() => new LockHelper(this);

    // This is where the magic happens!
    private readonly struct LockHelper : IDisposable
    {
        private readonly Counter counter;
        private readonly bool lockTaken;

        public LockHelper(Counter counter)
        {
            this.counter = counter;

            lockTaken = false;
            if (counter.synchronized)
            {
                Monitor.Enter(counter.lockObject, ref lockTaken);
                counter.lockCount++;
            }
        }

        private void Exit()
        {
            if (lockTaken)
            {
                Monitor.Exit(counter.lockObject);
            }
        }

        void IDisposable.Dispose() => Exit();
    }
} 
```

现在，让我们创建一个小示例程序来证明其正确性。

```
class Program
{
    static void Main(string[] args)
    {
        var onlyOnThisThread = new Counter(synchronized: false);
        IncreaseToMax(c1);

        var onManyThreads = new Counter(synchronized: true);
        var t1 = Task.Factory.StartNew(() => IncreaseToMax(c2));
        var t2 = Task.Factory.StartNew(() => IncreaseToMax(c2));
        var t3 = Task.Factory.StartNew(() => IncreaseToMax(c2));
        Task.WaitAll(t1, t2, t3);

        Console.WriteLine($"Counter(false) => Count = {c1.Count}, LockCount = {c1.LockCount}");
        Console.WriteLine($"Counter(true)  => Count = {c2.Count}, LockCount = {c2.LockCount}");
    }

    private static void IncreaseToMax(Counter counter)
    {
        for (int i = 0; i < 1000; i++)
        {
            counter.Increase();
        }
    }
} 
```

## 输出：

```
Counter(false) => Count = 100, LockCount = 0
Counter(true)  => Count = 100, LockCount = 3002 
```

现在您可以让调用者决定是否需要锁定（代价高昂）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-28T12:58:56.913

我猜你有一些看起来有点像这样的代码：

```
private Monkey GetScaryMonkey(int numberOfHeads){
    Monkey ape = null;        
    lock(this) {
        ape = new Monkey();
        ape.AddHeads(numberOfHeads);            
    }
    return ape;
} 
```

要使这个有条件，你不能这样做：

```
private Monkey GetScaryMonkey(int numberOfHeads){
    if ( numberOfHeads > 1 ) {
         lock(this) {
            return CreateNewMonkey( numberOfHeads );          
        }
    }
    return CreateNewMonkey( numberOfHeads );
} 
```

应该工作，不是吗？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-10T05:52:25.673

如上所述，使用[双重检查锁定模式。](http://en.wikipedia.org/wiki/Double_checked_locking_pattern "维基百科链接：双重检查锁定模式")这就是 IMO 的诀窍 :)

确保您将锁定对象设置为*static*，如 not.that.dave.foley.myopenid.com 的示例中所列。

# load-balancing - 轮询服务器设置

> ID：243156
> 
> 赞同：0
> 
> 时间：2008-10-28T12:53:51.637
> 
> 标签：load-balancing

据我了解，如果您有多个 Web 服务器，那么您需要某种负载均衡器来在您的 Web 服务器之间分配流量。

这是否意味着负载均衡器是网络上的主要连接点？IE。负载均衡器有域名的IP地址吗？

如果是这种情况，那么添加新硬件真的很容易，因为您不必等待任何 dns 传播，对吧？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T12:58:32.547

这个“问题”有几种解决方案。您可以在 DNS 级别进行循环。即让 www.yourdomain.com 指向多个 IP 地址（以及您的所有服务器）。

这不会为您提供负载平衡方面的任何智能，但负载将或多或少随机分布，但您不会对硬件故障有弹性，因为它们仍然需要更改 DNS。

另一方面，您可以使用具有单个 IP 的代理或负载平衡代理，然后将流量分配到多个后端盒。这给了你一个单点故障（代理，你当然可以有几个代理来解决这个问题）并且还会给你带来额外的好处，即能够使用一些指标来更均匀、更智能地分配负载，而不是仅仅使用循环 dns。此设置还可以非常无缝地处理后端的硬件故障。最终用户永远不会看到后端，而只会看到前端。

还有其他问题需要考虑，如果您的页面使用会话或其他智能逻辑，当您的用户（可能）在每次访问时访问不同的服务器时，您可能会遇到同步问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T12:59:38.987

它确实（通常）。这取决于您使用的服务器操作系统和软件，但一般来说，您会针对每个请求访问负载均衡器，然后负载均衡器将根据您现有的方案（循环，至少忙，会话控制，应用程序控制等...）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T03:22:44.353

安迪有部分答案，但为了真正的负载平衡和高可用性，您可能希望在主动被动配置中使用一对硬件负载平衡器，如 F5 bigips。是的，您的域 IP 将托管在这些设备上，并且流量将首先连接到这些设备。Bigips 提供了许多附加功能，包括多种负载平衡方式和一些出色的 url 重写、ssl 加速等。它还允许您在单独的不可路由地址方案上运行 Web 服务器，甚至可以在不同端口上运行多个站点。 F5 处理翻译。引入负载平衡后，您可能需要为您的应用程序考虑其他一些注意事项，例如粘性会话和会话状态，但这是一个不同的主题

# c# - 将输入传递给状态机（c#）

> ID：243170
> 
> 赞同：1
> 
> 时间：2008-10-28T12:57:25.310
> 
> 标签：c#, user-input, state-machine

我会尽力解释我的情况；

在每个应用程序*滴答声*中，我都会查询键盘和鼠标的当前状态，并将它们包装在单独的类和数据结构中。*对于键盘，它是我的Keys*枚举数组（当前按下的每个键的一个项目），对于鼠标，它是一个包含每个按下按钮的坐标增量和布尔值的类。

我还有一个通过状态管理器类管理的基本状态机，它维护堆栈并编组状态。

我想知道的是，如何最好地将输入（快照）传递给我的应用程序可以随时处于的各个状态？

我想尽可能多地处理远离各个状态的输入，以减少状态内的重复逻辑。

或者最好保持输入快照尽可能纯净并将它们传递给状态，以便它们可以保持输入特定逻辑隐藏？

**注意**
这种结构类似于我想象的游戏的工作方式，虽然这个应用程序不是游戏，但它确实需要尽快处理。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T14:25:36.333

为什么每次滴答都查询键盘和鼠标的状态？一个更好的传统解决方案是捕获从键盘和鼠标触发的事件。这样，您只需要在需要时更新状态。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T18:22:19.820

如果您只是在每次滴答声中查询您的键盘和鼠标，我可以保证您会遇到问题。当您查询每个刻度时，您会发现您错过了快速发生的输入（在单个刻度的时域内）。想象一下用户在两个滴答之间按下并释放一个键/按钮的情况（它发生的次数比你想象的要多）——你会完全错过输入。

*尤其是在完全*适合此类输入事件的 C# 中，您应该使用事件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T14:32:29.377

在 XNA 中，他们通过将键盘类设为静态来做到这一点。

```
KeyboardState state = Keyboard.GetState(); 
```

然后，您可以使用上面的代码行访问当前键状态。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T17:23:08.440

您应该触发事件并捕获参数。这将是处理这个问题的最简单、最有效的方法。

```
class YourClass
{    
    //data members ...

    public void OnKeyboardPress(object sender, EventArgs args)
    {
        //handle your logic capturing the state here
    }
}

//elsewhere
someControl.KeyPress += new KeyPressDelegate(yourClassInstance.OnKeyboardPress); 
```

# assembly - 使用 LIB-USB 传输随机字节数时如何修复“错误 -5”？

> ID：243173
> 
> 赞同：4
> 
> 时间：2008-10-28T12:58:08.833
> 
> 标签：assembly, usb

我在使用`LIB-USB`. USB 设备基于 PIC18F4550，具有单个控制端点。PC 前端是用 MSVC 编写的，使用 Lib-Usb 1.12。

在 PC 端，程序首先设置配置，声明接口，然后发送（和接收）控制消息（特定于供应商），所有这些都成功。在传输了看似随机的 # 个字节后（100 到 2000 之间的任意位置），传输停止，并从 usb_control_msg 调用返回**错误 rc=-5 。**

在 PC 端，调用如下所示：

```
ret = usb_set_configuration(udev, 1);  
ret = usb_claim_interface(udev, 0);    
ret = usb_control_msg(udev, USB_TYPE_VENDOR|USB_RECIP_DEVICE, CMD_RESET, 0, 0, buffer, 0, 100);  
ret = usb_control_msg(udev, 0xC0, GET_FIFO_DATA, 0, 0, buffer, 8, 100); 
```

最后一个调用，实际上是从 USB 设备获取数据，连续运行了很多次，但总是在以这种方式传输随机数量的字节（总共 100 到 2000 个）后终止。将管道更改为 EP1 会执行相同的操作，但最终会出现相同的错误。

在 USB 设备 (PIC) 端，描述符非常简单，只有 EP0 管道，如下所示：

```
Device
db 0x12, DEVICE ; bLength, bDescriptorType  
db 0x10, 0x01   ; bcdUSB (low byte), bcdUSB (high byte)  
db 0x00, 0x00   ; bDeviceClass, bDeviceSubClass  
db 0x00, MAX_PACKET_SIZE    ; bDeviceProtocol, bMaxPacketSize  
db 0xD8, 0x04   ; idVendor (low byte), idVendor (high byte)    
db 0x01, 0x00   ; idProduct (low byte), idProduct (high byte)  
db 0x00, 0x00   ; bcdDevice (low byte), bcdDevice (high byte)  
db 0x01, 0x02   ; iManufacturer, iProduct  
db 0x00, NUM_CONFIGURATIONS ; iSerialNumber (none), bNumConfigurations  
Configuration1  
db 0x09, CONFIGURATION  ; bLength, bDescriptorType  
db 0x12, 0x00   ; wTotalLength (low byte), wTotalLength (high byte)    
db NUM_INTERFACES, 0x01 ; bNumInterfaces, bConfigurationValue    
db 0x00, 0xA0   ; iConfiguration (none), bmAttributes    
db 0x32, 0x09   ; bMaxPower (100 mA), bLength (Interface1 descriptor starts here)  
db INTERFACE, 0x00      ; bDescriptorType, bInterfaceNumber  
db 0x00, 0x00   ; bAlternateSetting, bNumEndpoints (excluding EP0)  
db 0xFF, 0x00   ; bInterfaceClass (vendor specific class code), bInterfaceSubClass  
db 0xFF, 0x00   ; bInterfaceProtocol (vendor specific protocol used), iInterface (none) 
```

实际的框架是 Bradley Minch 的汇编语言框架。

如果有人在我很想听之前遇到过此类问题，因为我已经尝试了几乎所有方法来解决它，包括使用不同的管道（EP1，结果相同），之前检查 PIC 上的 UOWN 位写入管道，与 PC 主机握手（在写入数据之前，PC 必须首先发送供应商特定的命令）但无济于事。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-31T02:48:44.773

**它现在有效！**

当然，我现在感觉“像一袋锤子一样聪明” 如果我仔细阅读第 18 节，我会注意到关于在 Vusb 和接地之间添加一个 220nF 电容器的行。在 pin18 和地之间添加了一个 470nF 的电容，这就是它所需要的......现在可靠的传输。

只是另一个案例`"I forgot to read the fine print"`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T15:30:06.360

建议使用高端的 USB 总线分析仪[Lecroy](http://www.lecroy.com/tm/products/ProtocolAnalyzers/usb.asp?menuid=67)和[Ellisys](http://www.ellisys.com/products/usbcompare.php)并且有点贵。[Total Phase](http://www.totalphase.com/products/overview/usb/?gclid=CKOLje-aypYCFQOx1AodqkvEzA)是低端的一个例子。
如果您负担得起，使用总线分析器将帮助您编写固件和 PC 端软件。使用分析仪，您可以确定您的 PC 端的问题（您读取的数据在总线上，但您在软件中看不到它）或固件实现中的问题（您在总线上看不到数据） .

从您的描述中很难理解问题是什么，我不知道错误 -5 是什么意思，如果您可以为此发布定义名称，我可能会更有帮助。
一般来说，以最大数据包大小的倍数从/向设备传输数据是一种很好的做法。[我还建议您仔细阅读USB 规范](http://www.usb.org/developers/docs/)中的相关部分 5.5.3（用于控制传输）和 5.8.3 用于批量传输

**基于提供的第二个日志的附加评论**：

usb 堆栈返回的真正错误在您的日志中及其：
`vendor_class_request(): request failed: status: 0xc0000001, urb-status: 0xc000000c`

Windows Driver kit usb.h 中定义的 URB（usb 请求块）状态为：
`usb.h:#define USBD_STATUS_BUFFER_OVERRUN ((USBD_STATUS)0xC000000CL)`

[我在这里](http://www.jungo.com/support/tech_docs/td55.html)找到了关于这个错误的一个很好的解释。

请忽略这是 WinDriver 定义的错误，它只是从 Windows 重新定义的错误，并且关于它通常意味着什么的解释是正确的。

[这](http://www.osronline.com/showthread.cfm?link=124579)是一个为什么会发生的示例，但是这种行为还有更多潜在的原因。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T02:04:20.290

我没有分析器（至少“还”），但我确实安装了 DebugView 以查看驱动程序在做什么，并带有以下输出跟踪。显示的第一次传输（特定于供应商的传输）成功，而第二次传输失败。从调用返回一个返回码“-5”，表示“I/O 错误”（不是特别有用）。

> 00002674 315.26220703 LIBUSB-DRIVER - vendor_class_request(): type: vendor
> 00002675 315.26223755 LIBUSB-DRIVER - vendor_class_request(): recipient: device
> 00002676 315.26223755 LIBUSB-DRIVER - vendor_class_request(): request: 0x04
> 00002677 315.26223755 LIBUSB-DRIVER - vendor_class_request(): value : 0x0000
> 00002678 315.26223755 LIBUSB-DRIVER - vendor_class_request(): index: 0x0000
> 00002679 315.26223755 LIBUSB-DRIVER - vendor_class_request(): size: 8 00002680 315.26226807 LIBUSB-DRIVER - vendor_class_request(): direction: in
> 00002681 315.26226807 LIBUSB-DRIVER - vendor_class_request() ：超时：100
> 00002682 315.26617432 LIBUSB-DRIVER - vendor_class_request(): 8 bytes transmitted 00002683 315.26721191
> 00002684 315.26721191
> 00002685 315.26721191 LIBUSB-DRIVER - vendor_class_request(): type: vendor
> 00002686 315.26721191 LIBUSB-DRIVER - vendor_class_request(): recipient: device
> 00002687 315.26724243 LIBUSB-DRIVER - vendor_class_request (): request: 0x04
> 00002688 315.26724243 LIBUSB-DRIVER - vendor_class_request(): value: 0x0000
> 00002689 315.26724243 LIBUSB-DRIVER - vendor_class_request(): index: 0x0000
> 00002690 315.26724243 LIBUSB-DRIVER - vendor_class_request(): size: 8 00002691 315.26724243 LIBUSB-DRIVER - vendor_class_request()：方向：在
> 00002692 315.26727295 LIBUSB-DRIVER - vendor_class_request(): timeout: 100
> 00002693 315.27017212 LIBUSB-DRIVER - vendor_class_request(): request failed: status: 0xc0000001, urb-status: 0xc000000c
> 00002694 315.27407837 [3684] LIBUSB_DLL: error: usb_control_msg: sending control message failed , win 错误：连接到系统的设备无法正常工作。
> 00002695 315.27407837 [3684]
> 00002696 315.27511597
> 00002697 315.27514648 LIBUSB-驱动程序-release_interface（）：接口0

# licensing - vmware 和许可

> ID：243174
> 
> 赞同：2
> 
> 时间：2008-10-28T12:58:09.007
> 
> 标签：licensing, vmware

如果我有一台带有单一许可证的 windows xp 计算机（戴尔给我的那个），如果我有 2-3 个 vm 的设置（使用 vmware）用于开发目的，我是否必须拥有所有这些许可证？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T12:59:41.513

阅读您拥有的 OEM 许可证随附的 Microsoft EULA。

它很可能表示您一次只能运行一个副本。所以，是的：您需要多个许可证。

但是，如果您在公司或学校进行开发，则可以使用批量/站点许可证密钥。

# c# - 如何以编程方式获取文件夹结构下的锁定文件列表？

> ID：243178
> 
> 赞同：3
> 
> 时间：2008-10-28T12:58:39.317
> 
> 标签：c#, windows, file, windows-server-2003

跟进这个问题：[如何解锁被 .NET 中的进程锁定的文件](https://stackoverflow.com/questions/242882/how-can-i-unlock-a-file-that-is-locked-by-a-process-in-net)，如何以编程方式获取锁定在特定文件夹及其子文件夹中的文件列表？

我正在使用 Windows 2003、.NET 3.5、C# 3.0。

**更新：**一些背景......基本上我们在共享服务器上归档关闭的网站。从 IIS 中删除站点后，我们将该站点的文件夹结构移动到保存 6 周的存档中。即使 IIS 站点和 FTP 已停止并删除，我们仍然会在移动过程中遇到锁定的文件。因此，最好提前知道还有什么问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T13:12:09.180

正如另一个问题中的回答：[如何检查文件锁定？](https://stackoverflow.com/questions/1304/checking-for-file-lock-in-c)

唯一的方法是尝试全部并在抛出异常时将它们添加到列表中。正如上面的问题中提到的，它不是一个可靠的使用列表，而只是给你一个特定时间点的概述。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T13:26:30.557

实时检测锁定文件的唯一可靠方法是编写设备驱动程序（如[filemon](http://technet.microsoft.com/en-us/sysinternals/bb896642.aspx)），但我认为您不能在 C# 中做到这一点。

# apache - 基于 User-Agent 的 Apache 流量节流

> ID：243179
> 
> 赞同：0
> 
> 时间：2008-10-28T12:58:52.547
> 
> 标签：apache, user-agent, bots, traffic

我们在 Linux 上的 WebSphere 6.0 前面运行 Apache（IBM HTTP Server 6.0.2.0）。我们从不同 IP 地址的特定用户代理处获得过多流量。我们不想阻止 User-Agent 或 IP 地址，但想稍微减慢它们的速度。

对我们来说最好的方案是使用开箱即用的 Apache 配置选项来解决问题。

任何想法或建议将不胜感激。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T13:04:24.157

没有原生方式，但[mod_evasive](http://www.zdziarski.com/projects/mod_evasive/)可能会很好地为您服务。

# sql - 镜像表修改

> ID：243193
> 
> 赞同：0
> 
> 时间：2008-10-28T13:02:04.240
> 
> 标签：sql, sql-server, database, sql-server-2005, database-design

我有一组用于跟踪账单的表格。这些表是从每周运行的 SSIS 进程加载的。

我正在创建第二组表格来跟踪对通过网络进行的账单的调整。我们的一些客户手动输入他们的账单，所有这些条目都需要定期备份（SSIS 馈送数据总是可以再次导入，因此不会备份）。

这种行为是否有最佳实践？我正在考虑实现一个 DDL 触发器，该触发器将解析 ALTER TABLE 调用并更改被调用的表。这有点痛苦，我很好奇是否有更好的方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T13:32:18.110

我个人会将 SSIS 馈送表放在一个数据库中（设置为简单恢复模式），将其他表放在同一服务器上的单独数据库中，该数据库设置为完全恢复模式。然后我会定期在第二个数据库上设置备份。一个典型的备份计划是每周一次完整备份，每晚备份一次，每 15-30 分钟进行一次事务备份，具体取决于输入的数据量。）请务必定期测试恢复备份，并在客户需要时学习如何执行此操作尖叫，因为数据库已关闭；这是一件好事。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-31T00:20:07.083

我最终使用 DDL 触发器将更改从一个表复制到另一个表。唯一的问题是，如果表或列名包含保留字的一部分——VARCHAR 的 ARCH——它会导致修改脚本出现问题。

再次感谢[Brent Ozar在我](https://stackoverflow.com/users/26837/brent-ozar)[写博客](http://facility9.com/2008/10/28/mirroring-table-changes-through-ddl-triggers/)之前错误地检查了我的想法。

```
-- Create pvt and pvtWeb as test tables
CREATE TABLE [dbo].[pvt](
   [VendorID] [int] NULL,
   [Emp1] [int] NULL,
   [Emp2] [int] NULL,
   [Emp3] [int] NULL,
   [Emp4] [int] NULL,
   [Emp5] [int] NULL
) ON [PRIMARY];
GO

CREATE TABLE [dbo].[pvtWeb](
   [VendorID] [int] NULL,
   [Emp1] [int] NULL,
   [Emp2] [int] NULL,
   [Emp3] [int] NULL,
   [Emp4] [int] NULL,
   [Emp5] [int] NULL
) ON [PRIMARY];
GO

IF EXISTS(SELECT * FROM sys.triggers WHERE name = ‘ddl_trigger_pvt_alter’)
   DROP TRIGGER ddl_trigger_pvt_alter ON DATABASE;
GO

-- Create a trigger that will trap ALTER TABLE events
CREATE TRIGGER ddl_trigger_pvt_alter
ON DATABASE
FOR ALTER_TABLE
AS
   DECLARE @data XML;
   DECLARE @tableName NVARCHAR(255);
   DECLARE @newTableName NVARCHAR(255);
   DECLARE @sql NVARCHAR(MAX);

   SET @sql = ”;
   -- Store the event in an XML variable
   SET @data = EVENTDATA();

   -- Get the name of the table that is being modified
   SELECT @tableName = @data.value(‘(/EVENT_INSTANCE/ObjectName)[1]‘, ‘NVARCHAR(255)’);
   -- Get the actual SQL that was executed
   SELECT @sql = @data.value(‘(/EVENT_INSTANCE/TSQLCommand/CommandText)[1]‘, ‘NVARCHAR(MAX)’);

   -- Figure out the name of the new table
   SET @newTableName = @tableName + ‘Web’;

   -- Replace the original table name with the new table name
   -- str_replace is from Robyn Page and Phil Factor’s delighful post on 
   -- string arrays in SQL. The other posts on string functions are indispensible
   -- to handling string input
   --
   -- http://www.simple-talk.com/sql/t-sql-programming/tsql-string-array-workbench/
   -- http://www.simple-talk.com/sql/t-sql-programming/sql-string-user-function-workbench-part-1/
   --http://www.simple-talk.com/sql/t-sql-programming/sql-string-user-function-workbench-part-2/
   SET @sql = dbo.str_replace(@tableName, @newTableName, @sql);

   -- Debug the SQL if needed.
   --PRINT @sql;

   IF OBJECT_ID(@newTableName, N’U’) IS NOT NULL
   BEGIN
       BEGIN TRY
           -- Now that the table name has been changed, execute the new SQL
           EXEC sp_executesql @sql;
       END TRY
       BEGIN CATCH
           -- Rollback any existing transactions and report the full nasty 
           -- error back to the user.
           IF @@TRANCOUNT > 0
               ROLLBACK TRANSACTION;

           DECLARE
               @ERROR_SEVERITY INT,
               @ERROR_STATE    INT,
               @ERROR_NUMBER   INT,
               @ERROR_LINE     INT,
               @ERROR_MESSAGE  NVARCHAR(4000);

           SELECT
               @ERROR_SEVERITY = ERROR_SEVERITY(),
               @ERROR_STATE    = ERROR_STATE(),
               @ERROR_NUMBER   = ERROR_NUMBER(),
               @ERROR_LINE     = ERROR_LINE(),
               @ERROR_MESSAGE  = ERROR_MESSAGE();

           RAISERROR(‘Msg %d, Line %d, :%s’,
               @ERROR_SEVERITY,
               @ERROR_STATE,
               @ERROR_NUMBER,
               @ERROR_LINE,
               @ERROR_MESSAGE);
       END CATCH
   END
GO

ALTER TABLE pvt
ADD test INT NULL;
GO

EXEC sp_help pvt;
GO

ALTER TABLE pvt
DROP COLUMN test;
GO

EXEC sp_help pvt;
GO 
```

# php - 有哪些有用的 PHP 习语？

> ID：243200
> 
> 赞同：10
> 
> 时间：2008-10-28T13:04:47.010
> 
> 标签：php, conventions

我希望改进我的 PHP 编码，并且想知道其他程序员使用哪些特定于 PHP 的技术来提高生产力或解决 PHP 限制。

一些例子：

1.  处理命名空间的类命名约定：`Part1_Part2_ClassName`映射到文件`Part1/Part2/ClassName.php`

2.  `if ( count($arrayName) ) // handles $arrayName being unset or empty`

3.  变量函数名称，例如`$func = 'foo'; $func($bar); // calls foo($bar);`

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-29T03:07:07.217

最终，您将首先通过学习一般良好的编程实践来充分利用 PHP，然后再专注于任何特定于 PHP 的内容。话说回来...

* * *

## 自由申请以获得乐趣和利润：

1.  foreach 循环中的迭代器。几乎没有错误的时间。

2.  围绕类自动加载进行设计。使用`spl_autoload_register()`，不使用`__autoload()`。对于奖励积分，让它递归地扫描目录树，然后随意将您的类重新组织成更合乎逻辑的目录结构。

3.  到处都是打字提示。对标量使用断言。

    ```
    function f(SomeClass $x, array $y, $z) {
        assert(is_bool($z))
    } 
    ```

4.  输出 HTML 以外的内容。

    ```
    header('Content-type: text/xml'); // or text/css, application/pdf, or... 
    ```

5.  学习使用异常。编写一个将错误转换为异常的错误处理程序。

6.  用类常量替换你的`define()`全局常量。

7.  用适当的`Date`类替换您的 Unix 时间戳。

8.  在长函数中，`unset()`当你完成它们时，变量。

* * *

## 带着罪恶感使用：

1.  像数组一样循环对象的数据成员。为他们没有被宣布为私有而感到内疚。这不是像 Python 或 Lisp 这样的异教语言。

2.  使用输出缓冲区来组装长字符串。

    ```
    ob_start();
    echo "whatever\n";
    debug_print_backtrace();
    $s = ob_get_clean(); 
    ```

* * *

## 除非绝对必要，否则可能避免，除非你真的讨厌维护程序员和你自己：

1.  魔术方法 ( `__get`, `__set`, `__call`)

2.  `extract()`

3.  结构化数组——使用对象

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-28T13:19:34.250

我使用 PHP 的经验教会了我一些东西。仅举几例：

*   总是输出错误。这些是我的典型项目的前两行（在开发模式下）：

```
ini_set('display_errors', '1');
error_reporting(E_ALL);
```

*   永远不要使用*automagic*。像 autoLoad 这样的东西将来可能会咬你。

*   始终需要使用`require_once`. 这样你就可以确定你的依赖关系是直接的。

*   使用`if(isset($array[$key]))`而不是`if($array[$key])`. 如果未定义密钥，第二个将引发警告。

*   定义变量时（即使有`for`循环）给它们详细的名称（`$listIndex`而不是`$j`）

*   评论，评论，评论。如果某个特定的代码片段看起来不明显，请发表评论。稍后您可能需要查看它并且可能不记得它的目的是什么。

除此之外，类、函数和变量命名约定取决于您和您的团队。最近我一直在使用[Zend Framework 的命名约定](http://framework.zend.com/manual/en/coding-standard.naming-conventions.html)，因为它们对我来说是正确的。

此外，在开发模式下，我设置了一个错误处理程序，它将在最轻微的错误（甚至警告）处输出错误页面，给我[完整的 backtrace](http://pt2.php.net/manual/en/function.debug-backtrace.php)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-28T13:36:47.930

幸运的是，命名空间在 5.3 和 6 中。我强烈建议不要使用 Path_To_ClassName 习语。它使代码混乱，你永远不能改变你的图书馆结构......永远。

SPL 的自动加载很棒。如果您有条理，它可以为您节省典型的 20 行包含块和每个文件顶部的要求。您还可以在代码库中进行更改，只要 PHP 可以从这些目录中包含，就不会出现任何问题。

自由使用`===`over `==`。例如：

```
if (array_search('needle',$array) == false) {
  // it's not there, i think...
} 
```

如果“needle”在关键零处，将给出假阴性。反而：

```
if (array_search('needle',$array) === false) {
  // it's not there!
} 
```

将永远是准确的。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-28T13:37:21.483

请参阅此问题：[PHP 的隐藏功能](https://stackoverflow.com/questions/61401/hidden-features-of-php)。它有很多非常有用的 PHP 技巧，其中最好的已经排在列表的顶部。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-29T12:17:17.510

1.  启用 NOTICE，如果你真的想 STRICT 错误报告。它可以防止很多错误和代码异味：`ini_set('display_errors', 1); error_reporting(E_ALL && $_STRICT);`
2.  远离全局变量
3.  使尽可能多的函数保持简短。它更容易阅读，并且易于维护。有人说你应该可以在屏幕上看到整个函数，或者至少，函数中循环和结构的开始和结束大括号都应该在你的屏幕上
4.  不要相信用户输入！

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-29T01:26:26.810

我在 PHP 中做的一些事情往往是特定于 PHP 的。

1.  用数组组装字符串。

    很多字符串操作在 PHP 中是昂贵的，所以我倾向于编写算法来减少我所做的字符串操作的离散数量。经典示例是使用循环构建字符串。相反，从 array() 开始，并在循环中进行数组连接。然后在最后 implode() 它。（这也巧妙地解决了尾随逗号问题。）

2.  数组常量非常适合实现函数的命名参数。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-28T14:18:14.913

在过去的 5 年里，我一直在使用 PHP（和 MySQL）进行开发。最近我开始使用一个框架 ( [Zend](http://framework.zend.com) ) 和一个可靠的 javascript 库 ( [Dojo](http://www.dojotoolkit.org) )，它永远改变了我的工作方式(我认为这是一种很好的方式)。

让我想到这一点的是你的第一颗子弹：Zend 框架正是这样做的，因为它是访问“控制器”和“动作”的标准方式。

在封装和抽象不同数据库的问题方面，Zend_Db 做得很好。Dojo 在消除不同浏览器之间的 javascript 不一致方面做得非常出色。

总的来说，值得学习好的 OOP 技术和使用（和阅读！）框架是理解 OOP 问题的一种非常实用的方法。

有关一些值得使用的独立工具，另请参阅：

[Smarty](http://www.smarty.net)（模板引擎） [ADODB](http://adodb.sourceforge.net)（数据库访问抽象）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-17T07:22:39.047

了解不同的类型和`===`运算符，这对于某些功能是必不可少的`strpos()`，您将开始`return false`自己使用。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-29T03:35:24.180

## **在使用它们之前声明变量！**

# visual-studio-2008 - 使用 Visual Studio 2008 为 Sharepoint 2003 开发？

> ID：243201
> 
> 赞同：5
> 
> 时间：2008-10-28T13:04:56.230
> 
> 标签：visual-studio-2008, sharepoint, visual-studio-2003

有没有人有使用 Visual Studio 2008 为 Sharepoint 2003 开发的经验？

由于 Vista 问题，我需要升级到 VS2008，但需要支持 Sharepoint 2003 webparts。Webpart 都非常简单。我能否使用 VS2008 支持这些 webpart？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T15:37:51.227

AFAIK VS2008 仅允许您开箱即用地构建 .NET 2.0/3.0，但是...

我有 VS2005 项目使用 MSBEE 为 WSSv2/SPS2003 吐出 .NET 1.1 程序集和为 WSSv3/MOSS2007 吐出 .NET 2.0，我认为这在 VS2008 中也是可能的。

您将需要使用 MSBEE [http://www.codeplex.com/Wiki/View.aspx?ProjectName=MSBee](http://www.codeplex.com/Wiki/View.aspx?ProjectName=MSBee)

[在 Visual Studio 2008 中使用 .NET 1.1](http://devlicio.us/blogs/ziemowit_skowronski/archive/2008/08/22/working-with-net-1-1-in-visual-studio-2008-and-team-server.aspx)

您还需要掌握一些 MSBUILD 忍者动作，以保持 1 步构建过程并保持理智 [http://brennan.offwhite.net/blog/2006/11/30/7-steps-to-msbuild/](http://brennan.offwhite.net/blog/2006/11/30/7-steps-to-msbuild/)

我将在接下来的几周内升级到 VS2008，并将在此处发布更新。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T14:58:43.863

我使用 vs2008 创建了 .net 2.0 程序集，并与 sharepoint 2007 库链接，然后部署在 sharepoint 服务器上。您将无法使用开箱即用的 vs2008 创建 .net 1.1 程序集 - 因此，如果您需要以 .net 1.1 为目标，您最好的选择是坚持使用虚拟服务器设置。

在 vista（或 xp 上）开发 sharepoint 具有挑战性，因为除非您远程连接到 server2k3，否则您无法逐行调试。我对sharepoint开发者的建议是在vista上安装虚拟服务器，然后在带有sharepoint的虚拟服务器上安装vstudio。如果你打算这样做，你可以坚持使用当前版本的 Visual Studio，然后调试比从 vista 容易得多。

根据您的公司是否有 msdn 订阅，如果您必须购买虚拟服务器许可证等，这可能会更昂贵......但在我看来，让开发更容易是非常值得的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T19:35:41.777

SharePoint 2003 建立在 .NET 1.1 之上，只有 Visual Studio 2003 支持它。我建议你不要使用其他任何东西。

我建议您使用 SharePoint 2003 和 Visual Studio 2003 创建一个虚拟机，并在 VM 中开发所有内容。如果您正在为客户处理项目，这种方法会很有帮助，您可以使用这台机器作为客户环境的副本。

# java - 如何在非 Java 客户端上解释引用命名空间 java: 的 WSDL？

> ID：243206
> 
> 赞同：1
> 
> 时间：2008-10-28T13:06:09.473
> 
> 标签：java, php, soap, nusoap

我正在尝试集成在 Apache Axis 上运行的 SOAP Web 服务。WSDL 使用 URI 指定名称空间，如下所示：

```
<xsd:schema
  xmlns:xsd="http://www.w3.org/2001/XMLSchema"
  xmlns:stns="java:dk.tdc.serviceproviderweb.datatypes"
  elementFormDefault="qualified"
  attributeFormDefault="qualified"
  targetNamespace="java:dk.tdc.serviceproviderweb.datatypes"> 
```

在客户端，我使用的是 PHP，所以命名空间`xmlns:stns`没有意义。我有一些 Java 类文件（及其源代码），似乎对应于这个命名空间。我如何以有意义的方式处理这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T21:04:12.270

好的。似乎我对我的客户端库有一个错误这一事实感到困惑，这使它在 wsdl 上窒息。我从 NuSOAP 切换到 php5 的本机肥皂库，现在一切正常。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T22:54:47.007

您的代码片段是定义“java:dk.tdc.serviceproviderweb.datatypes”名称空间内容的 XML 模式的开头。（targetNamespace 属性表明了这一点）。

因此，只要此架构的其余部分有效，您是在客户端使用 java 还是 PHP 处理此问题并不重要。

# .net - 我可以修复尝试连接到未连接的映射驱动器的 VS 调试器吗

> ID：243209
> 
> 赞同：0
> 
> 时间：2008-10-28T13:06:59.470
> 
> 标签：.net, visual-studio-2008

当我有一个未连接的映射驱动器时，VSTS 2008 SP1 IDE 调试器需要大约 10 秒才能重新获得控制权。

不用说单步是痛苦的。有什么设置可以让它消失吗？

我正在调试一个混合（C#/C++/Web 服务）程序。

更多细节：

该程序根本不使用映射的驱动器。

我在办公室时仅使用映射驱动器连接到服务器。它被映射为 \\192.168.0.3\sharename -> f：不涉及 DNS 服务器。

当我在家时，仅仅为了调试而映射/重新映射只是一种痛苦。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-28T13:17:42.413

您是否尝试过先通过资源管理器建立连接？

另外，您需要使用映射驱动器吗？你有什么理由不能使用UNC？

您可以使用

```
NET USE \\server\share /User:MeMe 
```

建立与资源的连接而不实际为其分配驱动器号。

使其成为批处理文件并在登录时运行。

# java - 桌面应用程序中的 BIRT

> ID：243215
> 
> 赞同：10
> 
> 时间：2008-10-28T13:09:28.000
> 
> 标签：java, report, birt

有人曾经在桌面应用程序中使用过 BIRT 报告吗？我来自 .NET 环境，您可以使用 Crystal Reports 在桌面应用程序中显示报表。BIRT 也可以做到这一点，而无需设置服务器环境吗？

你能给我一些建议如何实现这个目标吗？

提前致谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-30T00:29:07.413

如果您的桌面应用程序是使用 Eclipse Rich Client Platform (RCP) 编写的，那么添加报告是很简单的。您需要做的就是添加 org.eclipse.birt.viewer 插件然后使用它。

这是一篇解释它的文章：http: [//digiassn.blogspot.com/2008/08/birt-launch-birt-rcp-application.html](http://digiassn.blogspot.com/2008/08/birt-launch-birt-rcp-application.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-19T17:43:27.460

有一个 BIRT 运行时允许您从命令行生成报告。阅读[这篇文章](http://digiassn.blogspot.com/2006/07/birt-birt-report-scheduling-without.html)。这将允许您在没有服务器的情况下使用 BIRT。最初在这里注明[是对我自己的问题的回答](https://stackoverflow.com/questions/169512/what-is-the-simplest-way-to-set-up-a-birt-report-viewer-for-a-xulrunner-applica)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T13:12:15.310

对的，这是可能的。我在大约 1-2 年前做的一个项目中使用了它，所以我必须向您提供详细信息。（尽管从那时起事情可能会发生变化）

*这是我*需要的插件：

```
<?xml version="1.0" encoding="UTF-8"?>
<classpath>
    <classpathentry kind="src" path="src"/>
    <classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER"/>
    <classpathentry kind="var" path="JUNIT_HOME/junit.jar" sourcepath="JUNIT_SRC_HOME/junitsrc.zip"/>
    <classpathentry kind="lib" path="lib/log4j-1.2.14.jar"/>
    <classpathentry kind="lib" path="lib/swt.jar"/>
    <classpathentry kind="con" path="SWT_CONTAINER"/>
    <classpathentry kind="lib" path="org.eclipse.birt.chart_2.1.2.v20070205-1728.jar"/>
    <classpathentry kind="lib" path="org.eclipse.birt.chart.device.extension_2.1.2.v20070205-1728.jar"/>
    <classpathentry kind="lib" path="org.eclipse.birt.chart.device.swt_2.1.1.v20070205-1728.jar"/>
    <classpathentry kind="lib" path="org.eclipse.birt.chart.engine_2.1.2.v20070205-1728.jar" sourcepath="C:/Programme/eclipse/plugins/org.eclipse.birt.chart.source_2.2.0.v20070209/src"/>
    <classpathentry kind="lib" path="org.eclipse.birt.chart.engine.extension_2.1.2.v20070205-1728.jar"/>
    <classpathentry kind="lib" path="org.eclipse.birt.chart.runtime_2.1.2.v20070205-1728.jar"/>
    <classpathentry kind="lib" path="org.eclipse.birt.core_2.1.2.v20070205-1728.jar"/>
    <classpathentry kind="lib" path="org.eclipse.emf.common_2.2.1.v200609210005.jar"/>
    <classpathentry kind="lib" path="org.eclipse.emf.ecore_2.2.1.v200609210005.jar"/>
    <classpathentry kind="lib" path="org.eclipse.emf.ecore.xmi_2.2.1.v200609210005.jar"/>
    <classpathentry kind="lib" path="js.jar"/>
    <classpathentry kind="lib" path="com.ibm.icu_3.4.5.jar"/>
    <classpathentry kind="lib" path="org.eclipse.birt.chart.ui_2.1.1.v20070205-1728.jar"/>
    <classpathentry kind="lib" path="org.eclipse.birt.chart.ui.extension_2.1.2.v20070205-1728.jar"/>
    <classpathentry kind="lib" path="lib/hsqldb.jar"/>
    <classpathentry kind="output" path="bin"/>
</classpath> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T13:15:45.647

对的，这是可能的。[这](http://opensource.sys-con.com/node/336872)是一些一般性的描述。我已经在服务器环境中使用过 Birt，但据我所知，有一个 RenderContext 接口，您可以通过该接口以您想要的方式呈现您的报告。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-09-02T18:44:06.480

这是可能的，您可以轻松地在 JeditorPane 中创建报告的预览，您必须下载 BIRT Runtime，然后您可以尝试在 Eclipse 论坛上发布[此帖子中的示例代码。](http://www.eclipse.org/forums/index.php/t/119253/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-01-10T07:14:26.270

```
package com.passport;

import java.io.FileOutputStream;
import java.util.Collection;
import java.util.Iterator;

import org.eclipse.birt.core.framework.Platform;
import org.eclipse.birt.report.engine.api.EngineConfig;
import org.eclipse.birt.report.engine.api.IGetParameterDefinitionTask;
import org.eclipse.birt.report.engine.api.IParameterDefnBase;
import org.eclipse.birt.report.engine.api.IRenderOption;
import org.eclipse.birt.report.engine.api.IReportEngine;
import org.eclipse.birt.report.engine.api.IReportEngineFactory;
import org.eclipse.birt.report.engine.api.IReportRunnable;
import org.eclipse.birt.report.engine.api.IRunAndRenderTask;
import org.eclipse.birt.report.engine.api.RenderOption;

public class EngineReport {
    private static final long serialVersionUID = 1L;       
    private IReportEngine engine=null; 
    private EngineConfig engineconfig = null;
    private IReportEngineFactory factory = null;
    private String sourceReport;
    private String locationReport;
    private String reportRealPath = "";

public static void main(String[] args){
    EngineReport engineReport = new EngineReport();
    engineReport.save("src/com/passport/report.rptdesign","c:/tmp/rep.doc");
}

private void save(String sourceReport, String locationReport) {

    this.sourceReport = sourceReport;
    this.locationReport = locationReport;
    IReportRunnable design = null;
    IRenderOption options = null;
    try {
        String reportFormat = locationReport.substring(locationReport.lastIndexOf('.')+1);
        sourceReport = "src/com/passport/report.rptdesign";
        if ((sourceReport != null && (sourceReport.length() > 0)) ) {

            engineconfig = new EngineConfig();
            reportRealPath = "";  
            Platform.startup(engineconfig);
            factory = (IReportEngineFactory) Platform.createFactoryObject(IReportEngineFactory.EXTENSION_REPORT_ENGINE_FACTORY);            
            engine = factory.createReportEngine(engineconfig);
            design = engine.openReportDesign(reportRealPath+sourceReport);          
            IRunAndRenderTask task = engine.createRunAndRenderTask(design);     

            IGetParameterDefinitionTask taskParam = engine.createGetParameterDefinitionTask( design );
            Collection<?> params = taskParam.getParameterDefns( false );
            String paramName = null;
            Iterator<?> iterOuter = params.iterator( );
            while ( iterOuter.hasNext( ) ) {
                IParameterDefnBase param = (IParameterDefnBase) iterOuter.next( );
                paramName = param.getName( );                   
                if (paramName.equalsIgnoreCase("PR_SOME_PARAM")) {
                    task.setParameterValue(paramName,"someparam");
                }                   
                else if (paramName.equalsIgnoreCase("PR_SOME_PARAM_2")) {
                    task.setParameterValue(paramName,"someparam2");
                }
            }               
            options = new RenderOption();           
            options.setOutputFormat(reportFormat);

            FileOutputStream fos = new FileOutputStream(locationReport);
            options.setOutputStream(fos);
            task.setRenderOption(options);
            task.run();
            task.close();
            engine.destroy();
            fos.close();

        }
    } catch(Exception e) {
        System.out.println(e.toString());
    }
} 
```

}

# php - 您对三元运算符使用哪种编码风格？

> ID：243217
> 
> 赞同：66
> 
> 时间：2008-10-28T13:10:42.630
> 
> 标签：php, language-agnostic, coding-style, ternary-operator

如果它很短，我将它保持在单行中。最近我一直在使用这种风格来处理更长的或嵌套的三元运算符表达式。一个人为的例子：

```
$value = ( $a == $b ) 
            ? 'true value # 1'
            : ( $a == $c )
                ? 'true value # 2'
                : 'false value'; 
```

您个人使用哪种风格，或觉得最易读？

**编辑：（** *关于何时使用三元运算符）*

我通常避免使用超过 2 级的深度三元运算符。当我在 PHP 模板脚本中回显变量时，我更喜欢 2 级深三元运算符而不是 2 级 if-else。

* * *

## 回答 #1

> 赞同：102
> 
> 时间：2008-10-28T13:39:46.533

通常要避免使用三元运算符，但这种形式可以非常易读：

```
 result = (foo == bar)  ? result1 :
           (foo == baz)  ? result2 :
           (foo == qux)  ? result3 :
           (foo == quux) ? result4 : 
                           fail_result; 
```

这样，条件和结果就保持在同一条线上，并且很容易浏览并了解正在发生的事情。

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2008-10-28T13:17:17.500

我尽量不使用三元运算符来编写嵌套条件。它违背了可读性，并且与使用条件相比没有提供额外的价值。

只有当它可以放在一条线上，并且它的含义非常清楚时，我才使用它：

```
$value = ($a < 0) ? 'minus' : 'plus'; 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2008-10-28T13:14:08.600

就个人而言，我只在适合一行的情况下使用三元运算符。如果它需要跨越，那么是时候为好老

```
if else if else 
```

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2008-11-12T07:37:05.867

*我有时*使用的一种风格，因为它没有被提及，所以我提出来，是这样的：

```
$result = ($x == y)
        ? "foo"
        : "bar"; 
```

..但通常只有将它们全部放在一条线上会使其太长。我发现把`= ? :`所有的东西都排好会让它看起来更整洁。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-09-25T02:17:24.647

PHP 嵌套三元运算符的行为不同。

此语法通过了以下所有测试。基于[http://deadlytechnology.com/web-development-tips/php-ternary-syntax/](http://deadlytechnology.com/web-development-tips/php-ternary-syntax/)

```
$myvar = ($x == $y)
?(($x == $z)?'both':'foo')
:(($x == $z)?'bar':'none'); 
```

.

见：[http ://au.php.net/ternary](http://au.php.net/ternary)

Example #3 "Non-obvious Ternary Behaviour" 解释了为什么下面的代码在 PHP 中不起作用。

```
$x = 1;
$y = 2;
$z = 3;   
$myvar = ($x == $y) 
       ? "foo" 
       : ($x == $z) 
         ? "bar" 
         : "none";  
$myvar == 'none'; // Good

$x = 1;
$y = 2;
$z = 1;   
$myvar = ($x == $y) ? "foo" : ($x == $z) ? "bar" : "none";  
$myvar == 'bar'; // Good

$x = 1;
$y = 1;
$z = 3;   
$myvar = ($x == $y) ? "foo" : ($x == $z) ? "bar" : "none";  
$myvar == 'bar'; // Bad!

$x = 1;
$y = 1;
$z = 1;   
$myvar = ($x == $y) ? "foo" : ($x == $z) ? "bar" : "none";  
$myvar == 'bar'; // Bad! 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-10-28T13:15:05.383

三元运算符是编写简单 if 语句的简短有效方法。它们不应该嵌套或难以阅读。请记住：您编写软件一次，但被读取 100 次。它应该比阅读更容易。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-28T13:23:05.990

我倾向于将条件括在括号中： (a == b) ？1 : 0

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-28T13:17:09.780

我会反对普遍的看法。我有点像 Imran 的条件运算符风格。如果它干净地放在一条线上，我将它放在一条线上。如果它不能完全适合一行，我会打破它，但我只使用一个制表符（4 个空格；我已将 VS 设置为为制表符插入空格）用于缩进。我不会立即跳到`if`- `else`，因为很多时候条件运算符在上下文中更有意义。（如果它在上下文中没有意义，但是，我根本不使用它。）

另外，我不嵌套条件运算符。在那一点上，我确实觉得它太难阅读了，是时候使用更冗长的`if`风格`else`了。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-02-04T20:21:49.650

三元条件可以使代码更干净、更优雅，最重要的是，帮助你把重点放在正确的事情上，避免重复自己。考虑使用它们，但这样做不会降低代码的可读性。在 VB.NET 中：

```
 'before refactoring 
    If x = 0 Then                    ' If-Then-Else puts emphasis on flow control
        label = "None"
    Else
        label = Foo.getLabel(x)      '  If-Then-Else forces repeat of assignment line
    End If

    'after refactoring    
    label = If(x = 0, "None", Foo.getLabel(x)) ' ternary If puts emphasis on assignment 
```

请注意，“它的可读性较差”与“我不习惯看到”不同。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-12T07:50:55.963

“人为的例子”是我如何缩进它，除了我会从左边距缩进，而不是基于 ( 或上面一行的任何内容。

对于三元批评者来说——可读性是重点。如果您认为它不会产生更具可读性的代码，请不要使用它。但我发现至少在某些时候情况恰恰相反。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-28T13:13:32.843

我不使用它。我总是觉得试图节省空间和输入源代码，期望小源代码 == 更有效的编译代码。

我觉得它根本不可读，但其中大部分是因为我从不使用它。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-28T13:13:48.567

我倾向于根本不使用三元运算符，因为我发现 if .. else 更具可读性。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-28T13:24:45.783

伊姆兰，你把这个格式化得很漂亮。但是，当嵌套两个以上时，三元运算符确实会变得不可读。if-else 块可以为您提供额外的可理解嵌套级别。除此之外，使用函数或表驱动编程。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-29T14:04:52.927

```
$foo = (isset($bar)) ? $bar : 'default'; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-29T14:22:29.083

我个人只使用它来分配一个变量（在java中），例如：

```
String var = (obj == null) ? "not set" : obj.toString(); 
```

和（其他示例）当使用不允许空参数的函数时，例如：

```
String val; [...]
int var = (val == null) ? 0 : Integer.parseInt(val); 
```

# java - 当类被声明为包私有时，我们应该声明一个公共构造函数吗？

> ID：243218
> 
> 赞同：19
> 
> 时间：2008-10-28T13:10:45.860
> 
> 标签：java, coding-style

我认为在这种情况下，不需要声明公共构造函数，因为无论如何在包之外都无法访问该类。但是当类只有包私有构造函数时是否有一些隐藏的影响？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-28T13:14:39.207

不，您不必声明公共构造函数；包私有构造函数将同样可用。包外的类无论如何都不能使用构造函数，因为它们看不到该类。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-28T13:25:52.773

如果您的类是包私有的，那么修饰符关键字指示的访问级别与构造函数`public`的默认*包私有*访问级别是等效的。

但是，您可以指示您希望该方法具有的行为，以防在开发过程中更改类可见性。当您打开一些以前是内部的 API 时，可能会发生这种情况。在这种情况下，将构造函数声明为包私有看起来更保守，因为您不会同时打开所有门。

# sql-server - Fogbugz 的服务器如何处理负载平衡？

> ID：243223
> 
> 赞同：0
> 
> 时间：2008-10-28T13:12:22.707
> 
> 标签：sql-server, configuration, load-balancing

我记得听 Joel 说他有 2 个不同的服务器所在位置，每个位置都有 2 个前端服务器和 1 个后端服务器。

1.  如果其中一个托管设施出现故障，他如何切换到另一个？（或者它只是需要 24-72 小时才能传播的 DNS 更改？）。

2.  一个 SQL Server 实例上怎么会有这么多数据库？FB 每个帐户都有一个完全独立的数据库。我看不到有超过 200-250 个数据库的单个 SQL Server 实例！而且我敢肯定他们的客户比这多。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T13:38:04.667

他们在其中一个 Stack Overflow 播客中谈到了这一点，但我在成绩单中找不到。

1) 两个中心各自处理大约 1/2 的用户。他们经常（每小时，我想 Joel 说）将事务日志发送到另一个站点。如果站点 A 出现故障，他们会在站点 B 上启动数据库备份，并进行 DNS 切换。它不会是即时的或自动化的，他们也不希望它是这样，因为他们会提出稍微陈旧的数据，并且如果有可能恢复损坏的站点，他们希望避免这种情况。

我不确定他们如何处理 DNS 情况，但是您可以将 DNS 记录上的 TTL 设置为仅几秒钟以限制缓存，并且可以非常快速地进行故障转移。

2）为什么不呢？我不确定每个实例的数据库硬限制，但也没有什么可以阻止您在您的机器上运行多个 SQL Server 实例。我想你更多地受到硬件而不是软件的限制。（您也可以使用 MySQL 数据库后端运行 Fogbugz）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-13T01:51:56.073

这里有几个问题，所以我会打破这些：

**如果其中一个托管设施出现故障，他如何切换到另一个？**

有几种方法可以做到这一点，包括数据库镜像（SQL Server 2005 中的新功能）、日志传送和复制。我在 SQLServerPedia 上录制了[关于 SQL Server 高可用性和灾难恢复选项的播客](http://sqlserverpedia.com/wiki/Log_Shipping)。

**（或者它只是需要 24-72 小时才能传播的 DNS 更改？）**

与提到的另一篇文章一样，您可以将 DNS 生存时间设置得很慢，但更酷的方法是使用数据库镜像。通过镜像，您可以在连接字符串中设置主服务器名称和辅助服务器名称，当第一个服务器没有响应时，您的应用程序将自动尝试第二个服务器。

**一个 SQL Server 实例上怎么会有这么多数据库？FB 每个帐户都有一个完全独立的数据库。我看不到有超过 200-250 个数据库的单个 SQL Server 实例！而且我敢肯定他们的客户比这多。**

我使用过的最大的 SQL Server 有超过一千个数据库，并且我与其他几个在服务器上拥有超过 2,000 个数据库的系统上工作过的 DBA 进行了交谈。这无疑使管理更具挑战性，这是肯定的。

# .net - ASP.NET UserControl 不初始化子控件

> ID：243232
> 
> 赞同：14
> 
> 时间：2008-10-28T13:14:59.003
> 
> 标签：.net, asp.net

在我的页面中，我有以下内容：

```
<aspe:UpdatePanel runat="server" ID="updatePanel">
    <ContentTemplate>
        <local:KeywordSelector runat="server" ID="ksKeywords" />
    </ContentTemplate>
</aspe:UpdatePanel> 
```

该`KeywordSelector`控件是我在同一个程序集中定义的控件，并`local`映射到其命名空间。

该控件由其他几个控件组成，定义如下：

```
<%@ Control Language="C#" AutoEventWireup="true"
            CodeBehind="KeywordSelector.ascx.cs"
            Inherits="Keywords.KeywordSelector" %> 
```

并且有很多自己的服务器控件，都定义为`.designer.cs`文件中的成员。

但是，**在控件的生命周期中，它没有任何子控件对象，也不会生成 HTML**：

1.  `.designer.cs`文件中定义的所有成员都是`null`.
2.  来电`HasControls`退货`false`。
3.  呼吁`EnsureChildControls`什么都不做。
4.  `Controls`集合是空的。

删除`UpdatePanel`并没有什么好处。我试图在一个干净的页面中重现它，`UserControl`并且发生了同样的事情。

我将 ASP.NET over .NET Framework 3.5 SP1 与集成 Web 服务器一起使用。

我在这里想念什么？

**更新#1：**根据 Rob 的评论，我查看`OnInit`并发现它`UserControl`没有检测到它有任何子控件。更何况，`CreateControlCollection`从来不叫！

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-28T14:17:30.123

好吧，我发现了问题：

1.  *与自定义控件相反，*用户**控件必须在**web.config*文件中一一注册。做这个：*

     *`<add tagPrefix="local" tagName="KeywordSelector" src="~/KeywordSelector.ascx" />`

    代替：

    `<add tagPrefix="local" namespace="Keywords" assembly="Keywords" />`* 
**   您永远不应将 a放在与使用它`WebControl`的目录相同的目录中。`Control`这是彻头彻尾的愚蠢。[在这里阅读](http://www.mertner.com/morten/?p=31)。* 

 *谢谢您的帮助。现在，如果我能将自己的答案标记为**答案**...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-10-24T16:04:49.537

在我的情况下，原因是 Resharper 7.1 在 aspx 的顶部添加了不正确的 @Register 指令 - 而不是这个所需的行：

```
<%@ Register Src="~/Controls/Hello/Hello.ascx" TagName="Hello" TagPrefix="p" %> 
```

我错了：

```
<%@ Register TagPrefix="p" Namespace="MyNamespace.WebApp.Controls" Assembly="MyApp.Web" %> 
```

# c# - 将 PDF 保存为 SQL 二进制文件 (.Net)

> ID：243237
> 
> 赞同：2
> 
> 时间：2008-10-28T13:15:45.850
> 
> 标签：c#, .net, binary

我正在使用 ASP/.Net 网页，我想将 pdf 文件作为二进制文件上传到 SQL 数据库中，我正在升级上传控件中的构建，你能建议一种方法吗？我也不需要如何阅读 pdf 并将其显示在网络浏览器中。我将使用 linq 上传和查询我的 sql 数据库。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T13:18:07.810

您可以`VARBINARY(MAX)`在数据库中使用该类型，创建一个 LINQ to SQL 映射并将该`Binary`类型与`byte[]`包含您的 PDF 文件内容的类型一起使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T13:59:32.970

您需要`HttpHandler`将 PDF 提供给用户是错误的，您可以使用一个空的 .aspx 页面来执行此操作，如下所示：

```
<%@ Page Language="C#" AutoEventWireup="false" CodeFile="SendPDF.aspx.vb" Inherits="SendPDF" %> 
```

`SendPDF.aspx.vb`文件看起来像这样：

```
partial class EWTD : System.Web.UI.Page
{

    protected void Page_Load(object sender, System.EventArgs e)
    {
        Response.ContentType = "application/pdf";
        Response.BinaryWrite(GetPDF());
    }

    protected byte[] GetPDF()
    {
        // Here you will retrieve the PDF as an array of bytes
    }

} 
```

它可能需要一些更改才能使其工作的代码，但您可以理解。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T13:18:23.317

您需要将数据保存到数据库中的 BLOB 中，然后在需要时读取它：

[http://www.akadia.com/services/dotnet_read_write_blob.html](http://www.akadia.com/services/dotnet_read_write_blob.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T13:41:02.040

要使用 aspx 将 PDF 显示回用户，您需要使用 HTTPHandler。您只需将 pdf 的字节写入 HTTP 响应，确保正确设置“content-type”标头。这是一个描述解决方案的论坛讨论：

[http://forums.asp.net/p/1120590/1750793.aspx#1750793](http://forums.asp.net/p/1120590/1750793.aspx#1750793)

# c++ - 指向数据成员的数据成员的指针

> ID：243242
> 
> 赞同：2
> 
> 时间：2008-10-28T13:17:19.247
> 
> 标签：c++

我有以下代码（针对这个问题进行了简化）：

```
struct StyleInfo
{
    int width;
    int height;
};

typedef int (StyleInfo::*StyleInfoMember);

void AddStyleInfoMembers(std::vector<StyleInfoMember>& members)
{
    members.push_back(&StyleInfo::width);
    members.push_back(&StyleInfo::height);
} 
```

现在，我们必须对其进行一些重组，我们做了这样的事情：

```
struct Rectangle
{
    int width;
    int height;
};

struct StyleInfo
{
    Rectangle size;
};

typedef int (StyleInfo::*StyleInfoMember);

void AddStyleInfoMembers(std::vector<StyleInfoMember>& members)
{
    members.push_back(&StyleInfo::size::width);
    members.push_back(&StyleInfo::size::height);
} 
```

如果这一切看起来都是一件愚蠢的事情，或者如果你觉得有一个很好的机会在这里应用 BOOST 出于某种原因，我必须警告你，我真的把它简化为手头的问题：

> 错误 C3083：“大小”：“::”左侧的符号必须是类型

我要说明的一点是，我不知道在这里使用什么正确的语法。可能是“StyleInfo”不是从一开始就获取地址的正确类型，但在我的项目中，我可以解决这种问题（那里有一个完整的框架）。我根本不知道如何指向这个成员中的成员。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T15:55:36.853

请记住，指向成员的指针就像成员一样使用。

```
 Obj x;

 int  y = (x.*)ptrMem; 
```

但是像普通成员一样，您不能使用成员访问机制访问子类的成员。因此，您需要做的是像访问对象成员一样访问它（在您的情况下，通过 size 成员）。

```
#include <vector>
#include <iostream>

struct Rectangle
{
    int width;
    int height;
};

struct StyleInfo
{
    Rectangle size;
};

typedef Rectangle   (StyleInfo::*StyleInfoMember);
typedef int         (Rectangle::*RectangleMember);

typedef std::pair<StyleInfoMember,RectangleMember>  Access;

void AddStyleInfoMembers(std::vector<Access>& members)
{
    members.push_back(std::make_pair(&StyleInfo::size,&Rectangle::width));
    members.push_back(std::make_pair(&StyleInfo::size,&Rectangle::height));
}

int main()
{
    std::vector<Access>     data;
    AddStyleInfoMembers(data);

    StyleInfo       obj;
    obj.size.width  = 10;

    std::cout << obj.*(data[0].first).*(data[0].second) << std::endl;
} 
```

我不建议这样做！

另一种选择（我建议更少）是从类的开头找到字节偏移量，然后将其添加到对象地址。显然，这将涉及大量的前后投射，所以这看起来比上面的更糟。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T13:52:20.020

绝对有可能吗？老实说，我不知道，从来没有玩过很多指针到成员。

假设您使用的是非 POD 类型（我知道您不是，但语法必须支持它）。然后指向成员的指针可能必须封装的不仅仅是基指针的偏移量。也可能存在间接性，这取决于多重继承的实现方式。对于多个级别的成员间接，这可能会变得任意复杂，这对于必须具有固定大小的类型来说是很多要求。

也许您需要一个对向量，其类型定义为：

```
typedef Rectangle (StyleInfo::*StyleInfoMember);
typedef int (Rectangle::*RectangleMember); 
```

依次应用每个以到达您想去的地方。当然，这仍然不允许您构建从 StyleInfo 到 StyleInfo 的任意成员的映射向量，因为它们不会全部通过 Rectangle。为此，您可能需要打开一罐仿函数...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T13:55:25.613

size （如`&StyleInfo::size::width`）不是类型的名称。

尝试使用 size->width 或 size.width，具体取决于您的“AddStyleInfoMembers”对尺寸的了解程度。

# windows-error-reporting - 应用程序关闭和 Windows 错误报告

> ID：243244
> 
> 赞同：2
> 
> 时间：2008-10-28T13:17:32.367
> 
> 标签：windows-error-reporting

我们正在尝试更新我们的应用程序，以便提交它以获得 Vista 认证。部分要求是仅处理已知异常并让 Windows 错误报告处理所有未处理的异常。

我们的应用程序中有一个全局异常处理程序（订阅`Application.ThreadException`事件），在那里，我们对已知异常执行某些处理，但如果一个异常未知，我们希望将其抛出以供应用程序终止并 WER 处理。

如果我们重新抛出然后重新创建调用堆栈，我们看不到这样做并维护调用堆栈的方法。

我们已经研究过终止方式，`Environment.FailFast()`但我们认为这不会提供我们需要的异常信息。

我们是否遗漏了一些明显的东西？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T14:42:13.820

为什么不直接抛出一个新异常并将 InnerException 属性设置为未处理的？默认的 StackTrace 属性会将两个跟踪连接在一起。

请记住，如果您从从 WinQual 检索到的内存转储中进行调试，那么它将是一个无论如何都会被捕获的本机异常。几乎总是可以返回本机​​堆栈并检索托管异常，如果您有可用的符号，通常很容易找出问题所在。无论如何，托管异常的堆栈跟踪在这种情况下都是多余的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T14:02:35.130

是的，但是我们在 Application.ThreadException 全局处理程序中，而不是一个 catch 块，所以我们不能只调用 throw，我们必须抛出 e.Exception。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-28T13:59:54.590

是的，正如 Marc 所说，只需使用 THROW，原始异常将被重新抛出，并保留堆栈跟踪信息。

THROW E 将重新启动整个异常堆栈，而原始堆栈信息会丢失。通常这不是您想要的。

或者，您可以抛出一个新异常并将原始异常添加为内部异常。然后你的新例外可能会添加额外的信息。

# sql - 文本（blob）比 varchar/nvarchar 的效率低多少？

> ID：243252
> 
> 赞同：6
> 
> 时间：2008-10-28T13:18:30.960
> 
> 标签：sql, text, varchar

我们正在为一个相当大的项目（大约 600 个用户全天使用它 - 至少对我来说很大 ;-) 做很多大而简单的表单。

这些表格有很多问答类型的部分，因此有些人很自然地键入句子，而另一些人则键入小说。 **对其中一些字段设置字符限制*真的*有多大好处？**

（如有必要/可能，请包括参考资料或引文 - 谢谢！）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T13:24:28.563

如果您对数据大小没有限制，那何必担心。这听起来不像是一个关键任务项目，即使有 600 个用户和数千条记录。使用 CLOB/BLOB 并完成它。我怀疑您是否会在限制大小和冒数据丢失风险方面看到任何重大收益。也就是说，您应该在实施之前布局此类边界。

通常 varchar 最适合存储您希望在逻辑上使用的值并对其执行“全值”比较。文本用于非结构化数据。如果您的项目是带有非结构化文本的调查结果，请使用 CLOB/BLOB

半参考：我有时会处理数十万条呼叫中心记录，在这些记录中我们使用 CLOB 来存储员工和客户之间的对话。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-28T14:09:12.670

我说，关注用户的需求，只在/如果出现这些问题时担心数据库性能问题。问问自己“如果我限制他们可以输入的数据量，我的用户是否会受益”。

我在墙上挂了一幅巨大的空白卡通片，上面写着“这不是软件所做的，而是用户所做的”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-02T20:06:39.867

你没有提到你正在使用哪个 sql server

如果您使用的是 MySql，则使用固定长度字段将表格保持在静态模式在速度方面具有明显优势，但是如果您有任何可变宽度字段，表格将切换为动态表格，您将失去指定字段长度的好处.

[http://dev.mysql.com/doc/refman/5.0/en/static-format.html](http://dev.mysql.com/doc/refman/5.0/en/static-format.html)
[http://dev.mysql.com/doc/refman/5.0/en/dynamic-format.html](http://dev.mysql.com/doc/refman/5.0/en/dynamic-format.html)

当您使用固定长度的列时，Microsoft SQL Server 具有类似的性能提升。对于固定长度的列，服务器确切地知道行中数据的偏移量和长度是多少。对于可变长度列，服务器知道偏移量，但必须将数据的实际长度存储为前面的 2 字节计数器。这有几个含义，在这篇[有趣的文章](http://www.databasejournal.com/features/mssql/article.php/3718066/Disk-Space-Usage-and-SQL-Server-Performance.htm)中讨论了性能作为磁盘空间的函数以及可变长度列的优点。

如果您使用的是 SQL Server 2005 或更新版本，则可以利用 varchar(max)。此列类型具有与 BLOB 相同的 2GB 存储容量，但数据与表数据页一起存储在 8K 块中，而不是单独存储。因此，您获得了大尺寸优势，一次只在页面中使用 8K，快速访问数据库引擎，并且与其他列类型一起使用的相同查询语义与 varchar(max) 一起使用。

最后，在变量列上指定最大长度主要可以让您限制数据库的增长大小。一旦使用可变长度列，您将失去固定大小行的优势，并且 varchar(max) 在保存相同数量的数据时将执行与 varchar(10) 相同的操作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T13:23:09.063

blob 和 text/ntext 存储在行上下文之外，并且仅存储对对象的引用，从而导致更小的行大小，这将提高聚簇索引的性能。

但是由于 text/ntext 不存储与行数据检索需要更长的时间，并且这些字段不能在任何比较语句中使用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T13:28:34.357

来自： http: [//www.making-the-web.com/2008/03/24/saving-bytes-efficient-data-storage-mysql-part-1/](http://www.making-the-web.com/2008/03/24/saving-bytes-efficient-data-storage-mysql-part-1/)

影响大小的 TEXT 和 BLOB 类型有一些变体；他们是：

```
Type -                      Maximum Length -Storage
TINYBLOB, TINYTEXT          255             Length+1 bytes
BLOB, TEXT                  65535           Length+2 bytes
MEDIUMBLOB, MEDIUMTEXT      16777215        Length+3 bytes
LONGBLOB, LONGTEXT          4294967295      Length+4 bytes 
```

# vb.net - VB6升级后的E_NOINTERFACE

> ID：243261
> 
> 赞同：1
> 
> 时间：2008-10-28T13:22:03.763
> 
> 标签：vb.net, com, vb6, vb6-migration

升级暴露 COM 接口的基于 VB 6 的应用程序后，针对先前版本构建的 COM 客户端（在 .NET 中）收到`E_NOINTERFACE`错误。

错误消息（翻译），

> 无法将类型的 COM 对象转换为类型`AProduct.AClass`的接口`AProduct._AClass`...

这里出了什么问题？

错误的原因是什么`E_NOINTERFACE`？

我*认为*一旦接口发布到 COM，就无法更改；应该发布一个可以继承旧接口的新接口（具有唯一 UUID），因此我推断该接口可能已被错误地更新（扩展）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T02:38:29.427

VB 6.0 项目中的版本兼容性设置是什么？（请参阅项目属性的组件选项卡）

如果不是二进制兼容性，那么当您编译 DLL 时，组件公开的接口和事件的 GUID 可能已更改。

查看这些资源以获取更多信息

[如何使用项目和二进制兼容性](http://support.microsoft.com/kb/161137)

[在 Visual Basic 6.0 中设置 COM 组件项目](http://authors.aspalliance.com/stevesmith/articles/vbcomsetup.asp)

# javascript - Flash 电影上的跨浏览器下拉/弹出菜单

> ID：243263
> 
> 赞同：5
> 
> 时间：2008-10-28T13:22:26.023
> 
> 标签：javascript, css, flash, xhtml, drop-down-menu

我需要让我的下拉菜单出现在 Flash 电影的顶部，这是如何跨浏览器完成的？

可以做，IBM做：[http](http://www.ibm.com/us/) ://www.ibm.com/us/ GE也做：http: [//www.ge.com/](http://www.ge.com/)

将 WMODE 设置为透明不适用于 Firefox

将其放入 iframe 在 IE7 下不起作用

有人知道实现这一目标的最佳方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T13:31:25.427

将 wmode 设置为透明，如有必要，像在任何其他元素上一样使用 z-index，这也适用于 Firefox。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T13:38:58.173

这是一个包含所有三种模式的示例：不透明、透明和完全没有 wmode

[http://www.communitymx.com/content/source/E5141/wmodeopaque.htm](http://www.communitymx.com/content/source/E5141/wmodeopaque.htm)

如果您希望在 Flash 电影下显示某些内容，请使用透明，如果您不想显示下面的内容，请使用不透明

并为菜单设置比 Flash 电影更高的 z-index

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T15:19:15.647

Firefox for linux 在一切之上显示闪存。与 wmode 或 z-index 无关。

编辑：我刚刚发现上面描述的 Linux 问题可以“修复”。

您需要在 swf 和要放在其上的图层之间添加一个带有 z-index 的 iframe。iframe 最初需要有 style="display:none" 并且您必须在 flash 插件初始化后使用 javascript 设置 display:block 。iframe 将隐藏它下面的所有 swfs 在 linux 上。

# objective-c - 如何在核心动画中为 onOrderOut 使用自定义动画？

> ID：243266
> 
> 赞同：8
> 
> 时间：2008-10-28T13:23:09.313
> 
> 标签：objective-c, cocoa, core-animation

Core Animation 允许通过在基于 CALayer 的类中实现 actionForKey 方法来自定义动画：

```
- (id<CAAction>)actionForKey:(NSString *)key {
    // Custom animations
    return [super actionForKey:key];
} 
```

然后我可以创建一个动画并将其返回给`onOrderIn`动作（即当图层添加到另一个图层时）。这工作得很好。如果我对`onOrderOut`（即图层从其超层中删除）执行相同操作，则返回的动画将被忽略，而是应用默认动画。

我的目标是放大 ( `onOrderIn`) 和缩小 ( `onOrderOut`) 图层：

```
- (id<CAAction>)actionForKey:(NSString *)key {

    if ([key isEqualToString:@"onOrderIn"] || [key isEqualToString:@"onOrderOut"]) {
        CABasicAnimation *a = [CABasicAnimation animationWithKeyPath:@"transform.scale"];
        a.duration = 0.25;
        a.removedOnCompletion = NO;
        a.fillMode = kCAFillModeBoth;

        if ([key isEqualToString:@"onOrderIn"]) {
            a.fromValue = [NSNumber numberWithFloat:0.0];
            a.toValue = [NSNumber numberWithFloat:1.0];
        } else {
            a.fromValue = [NSNumber numberWithFloat:1.0];
            a.toValue = [NSNumber numberWithFloat:0.0];
        }

        return a;
    }

    return [super actionForKey:key];
} 
```

放大作品，缩小作品。而是使用默认的淡出动画。

代码可能包含一些拼写错误，因为我是在另一台机器上输入的。

任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-08-16T18:52:50.597

[在quartz-dev 邮件列表中](http://lists.apple.com/archives/quartz-dev/2008/Nov/msg00039.html)引用 John Harper的话：

> 为 onOrderOut 键返回任何动画存在一个根本问题——当动画应该运行时，该层不再在树中，所以它没有效果。所以 onOrderOut 对触发动画没有用处；当从树中删除层时，它可能对运行其他代码很有用。
> 
> 我为此找到的最佳解决方案（假设父级上的默认淡入淡出过渡不是您想要的，通常不是）是添加自定义动画以应用您想要的移除效果，然后在 didStop 动画中委托，实际删除层。使用委托属性集和 fillMode=forwards, removedOnCompletion=NO 创建一组动画通常很方便，这样您就可以在动画结束时删除图层，而图层在正常状态下仍然可见.

如果你经常这样做，很容易编写一个通用的超类来启动动画，将动画委托设置为类并实现 +`animationDidStop:`以删除未启用动画的层。这恢复了 CoreAnimation 的即发即弃的特性，您希望在默认实现中出现这种特性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T22:17:38.360

您是否验证过您的方法是用`key`as调用的，`@"onOrderOut"`并且您的方法正在返回正确的动画？

# asp.net - 将 vb.net 数据集中的数据与数组列表中的值进行比较

> ID：243267
> 
> 赞同：3
> 
> 时间：2008-10-28T13:23:14.057
> 
> 标签：asp.net, sql, vb.net, dataset

我正在寻找一种有效的方法来搜索数据集以查看项目是否存在。我有一个约 6000 个项目的数组列表，我需要通过将数组列表中的每个项目与数据集特定列中的数据进行比较来确定数据集中不存在哪些项目。

我试图为数组列表中的每一项循环遍历数据集中的每一项，但这需要很长时间。然后我尝试使用下面的 RowFilter 方法。其中没有一个看起来是有效的。非常感谢任何帮助，因为您可以告诉我我不是一个程序员......

例子：

```
Dim alLDAPUsers As ArrayList
alLDAPUsers = clsLDAP.selectAllStudents

Dim curStu, maxStu As Integer
maxStu = alLDAPUsers.Count

For curStu = 0 To maxStu - 1
     Dim DomainUsername As String = ""
     DomainUsername = alLDAPUsers.Item(curStu).ToString

     Dim filteredView As DataView
     filteredView = dsAllStudents.Tables(0).DefaultView
     filteredView.RowFilter = ""
     filteredView.RowFilter = "szvausr_un = '" & DomainUsername & "'"

     Dim returnedrows As Integer = filteredView.Count
     If returnedrows = 0 Then
          '' Delete the user...
     End If
Next 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T13:32:08.767

您可以通过对列表进行排序并对数据集进行排序来获得更好的性能。然后，您可以将它们放在一起，边走边匹配。尤其如此，因为您可能已经至少（或者，您应该）在创建它的 sql 查询中对数据集进行了排序，从而使该步骤基本上是免费的。

您应该考虑在现有代码上使用通用列表而不是 ArrayList，以及其他一些风格点：

```
Dim LDAPUsers As List(Of String) = clsLDAP.selectAllStudents

For Each DomainUsername As String in LDAPUsers
     Dim filteredView As DataView = dsAllStudents.Tables(0).DefaultView
     filteredView.RowFilter = "szvausr_un = '" & DomainUsername & "'"

     If filteredView.Count = 0 Then
      '' Delete the user...
     End If
Next 
```

这与您的原始片段做同样的事情，但空间只有一半，所以它更干净，更具可读性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T13:30:52.293

尝试将您的数组列表切换到泛型。据我了解，它们比数组列表快得多。

这是以前关于[泛型与数组列表的 SO](https://stackoverflow.com/questions/94884/generics-vs-array-lists)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T13:51:20.897

如果您按照建议使用泛型，则可以有两个字符串列表并执行以下操作：

```
for each s as string in LDAPUsers.Except(AllStudents)
    ''Delete the user (s)
next 
```

其中 LDAPUsers 和 AllStudents 都是 List(Of String)

编辑：

您还可以将 except 更改为：

```
LDAPUsers.Except(AllStudents, StringComparer.InvariantCultureIgnoreCase) 
```

忽略大小写等

编辑2：

获取通用列表可能很简单：

```
Dim LDAPUsers as new List(Of String)(alLDAPUsers.Cast(Of String))
Dim AllStudents as new List(OfString)()

for each dr as DataRow in dsAllStudents.Tables(0).Rows
    AllStudents.Add(dr("szvausr_un"))
next 
```

或者你可以像 Joel 提到的那样选择 Linq-y 的优点，但不幸的是，我对此的了解是有限的……

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-25T22:49:44.983

就像其他人所说的那样，泛型或 linq 会是更好的选择。但是，我想指出您不需要使用**DataView**。数据表有一个**Select**方法...

```
dsAllStudents.Tables(0).Select("szvausr_un = '" & DomainUserName & "'") 
```

它返回一个 DataRows 数组。我确信它的性能会和视图一样差，但我认为它更干净一些。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T13:33:23.567

将 Dim 语句排除在循环之外......您的性能受到重复变量实例化和重新分配的影响。

同时删除您不需要的任何语句（rowfilter = ""）

```
Dim alLDAPUsers As ArrayList
Dim DomainUsername As String
Dim curStu, maxStu As Integer
Dim filteredView As DataView
Dim returnedrows As Integer

alLDAPUsers = clsLDAP.selectAllStudents
maxStu = alLDAPUsers.Count

For curStu = 0 To maxStu - 1
     DomainUsername = alLDAPUsers.Item(curStu).ToString

     filteredView = dsAllStudents.Tables(0).DefaultView
     filteredView.RowFilter = "szvausr_un = '" & DomainUsername & "'"

     returnedrows  = filteredView.Count
     If returnedrows = 0 Then
          '' Delete the user...
     End If
Next 
```

# c++ - 如何在 Windows Mobile 6 上获得“忙碌的轮子”？

> ID：243269
> 
> 赞同：3
> 
> 时间：2008-10-28T13:24:04.757
> 
> 标签：c++, windows-mobile, progress-bar

当事情发生时，Windows Mobile 会弹出一个“忙碌的轮子”——一个旋转的色盘。我在文档中找不到这是如何完成的——有人能指出我正确的方向吗？

我们有一种情况，我们需要提示用户说我们正在做一段时间的事情，但我们不知道需要多长时间。所以我们不能做进度条，因此建议使用这个繁忙的轮子。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T13:31:38.173

使用[SetCursor](http://msdn.microsoft.com/en-us/library/ms940016.aspx) / [LoadCursor](http://msdn.microsoft.com/en-us/library/aa453410.aspx) / [ShowCursor](http://msdn.microsoft.com/en-us/library/aa453730.aspx) API，如下所示：

```
SetCursor(LoadCursor(NULL, IDC_WAIT));

// my code

ShowCursor(FALSE); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-28T13:33:34.723

使用紧凑框架。

纺车：

System.Windows.Forms.Cursor.Current = System.Windows.Forms.Cursors.WaitCursor;

恢复正常：

System.Windows.Forms.Cursor.Current = System.Windows.Forms.Cursors.Default;

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T13:27:07.230

我只是在这里猜测，但我想它是[CWaitCursor](http://msdn.microsoft.com/en-us/library/wc7bzytb%28VS.80%29.aspx)。基本上，您只需在堆栈上创建一个，它会在超出范围而被破坏时出现并消失，例如

```
void DoSomethingSlow()
{
  CWaitCursor cw;
.
.
.
.
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T13:36:47.273

来自：http: [//mobiledeveloper.wordpress.com/2006/07/05/wait-cursor/](http://mobiledeveloper.wordpress.com/2006/07/05/wait-cursor/)

看看 Cursor.Current = Cursors.WaitCursor;

```
try {
 Cursor.Current = Cursors.WaitCursor;
 //Do something time consuming…
}
finally {
 Cursor.Current = Cursors.Default;
} 
```

# java - 如何对抽象类进行单元测试：用存根扩展？

> ID：243274
> 
> 赞同：493
> 
> 时间：2008-10-28T13:25:21.353
> 
> 标签：java, unit-testing, testing, abstract-class

我想知道如何对抽象类和扩展抽象类的类进行单元测试。

我是否应该通过扩展抽象类、存根抽象方法来测试抽象类，然后测试所有具体方法？然后只测试我覆盖的方法，并在单元测试中测试扩展我的抽象类的对象的抽象方法？

我是否应该有一个抽象测试用例可以用来测试抽象类的方法，并在我的测试用例中为扩展抽象类的对象扩展这个类？

请注意，我的抽象类有一些具体的方法。

* * *

## 回答 #1

> 赞同：489
> 
> 时间：2010-06-01T07:01:06.243

有两种使用抽象基类的方式。

1.  您正在专门化您的抽象对象，但所有客户端都将通过其基接口使用派生类。

2.  您正在使用抽象基类来排除设计中对象内的重复，并且客户通过他们自己的接口使用具体实现。！

* * *

**解决方案 1 - 策略模式**

![选项1](https://i.stack.imgur.com/Bu4Vy.png)

如果您遇到第一种情况，那么您实际上有一个由派生类正在实现的抽象类中的虚拟方法定义的接口。

您应该考虑使它成为一个真正的接口，将您的抽象类更改为具体的，并在其构造函数中获取该接口的一个实例。然后，您的派生类将成为这个新接口的实现。

![爱电机](https://i.stack.imgur.com/wPPqA.png)

这意味着您现在可以使用新接口的模拟实例测试您以前的抽象类，并通过现在的公共接口测试每个新实现。一切都很简单且可测试。

* * *

**解决方案 2**

如果您有第二种情况，那么您的抽象类正在充当帮助类。

![抽象助手](https://i.stack.imgur.com/ABrGO.png)

看看它包含的功能。看看是否可以将其中的任何一个推到正在被操纵的对象上以最小化这种重复。如果您还有任何剩余，请考虑使其成为您的具体实现在其构造函数中采用的辅助类并删除它们的基类。

![电机助手](https://i.stack.imgur.com/eySjQ.png)

这再次导致了简单且易于测试的具体类。

* * *

**作为一项规则**

喜欢简单对象的复杂网络，而不是复杂对象的简单网络。

可扩展可测试代码的关键是小型构建块和独立布线。

* * *

**更新：如何处理两者的混合物？**

可以有一个基类来执行这两个角色......即：它有一个公共接口，并且有受保护的辅助方法。如果是这种情况，那么您可以将辅助方法分解为一个类（场景2）并将继承树转换为策略模式。

如果你发现你有一些你的基类直接实现的方法，而另一些是虚拟的，那么你仍然可以将继承树转换为策略模式，但我也会把它作为一个很好的指标，表明职责没有正确对齐，并且可能需要重构。

* * *

**更新 2：抽象类作为垫脚石 (2014/06/12)**

前几天我遇到了一个使用abstract的情况，所以我想探讨一下原因。

我们的配置文件有一个标准格式。这个特殊的工具有 3 个配置文件都采用这种格式。我希望每个设置文件都有一个强类型类，因此，通过依赖注入，一个类可以请求它关心的设置。

我通过拥有一个抽象基类来实现这一点，该基类知道如何解析设置文件格式和暴露这些相同方法的派生类，但封装了设置文件的位置。

我本可以编写一个“SettingsFileParser”，将 3 个类包装起来，然后委托给基类以公开数据访问方法。我选择不这样做*，*因为它会导致 3 个派生类中的*委托*代码比其他任何东西都多。

但是...随着此代码的发展以及这些设置类中的每一个的使用者变得更加清晰。每个设置用户都会要求一些设置并以某种方式对其进行转换（因为设置是文本，他们可以将它们包装在将它们转换为数字等的对象中）。发生这种情况时，我将开始将此逻辑提取到数据操作方法中，并将它们推回到强类型设置类中。这将为每组设置带来更高级别的界面，最终不再意识到它正在处理“设置”。

此时，强类型设置类将不再需要公开底层“设置”实现的“getter”方法。

那时我不再希望他们的公共接口包含设置访问器方法；所以我将改变这个类来封装一个设置解析器类，而不是从它派生。

因此，Abstract 类是：一种让我暂时避免使用委托代码的方法，以及在代码中提醒我稍后更改设计的标记。我可能永远也达不到它，所以它可能会活很长一段时间……只有代码可以说明。

我发现这适用于任何规则......比如“没有静态方法”或“没有私有方法”。它们表明代码中有异味……这很好。它让您一直在寻找您错过的抽象......同时让您继续为您的客户提供价值。

我想象像这样的规则定义了一个景观，可维护的代码存在于山谷中。当您添加新行为时，就像雨点落在您的代码上一样。最初你把它放在它所在的任何地方......然后你重构以允许良好设计的力量推动行为，直到它全部结束在山谷中。

* * *

## 回答 #2

> 赞同：282
> 
> 时间：2008-10-28T13:50:25.077

编写一个 Mock 对象并将它们仅用于测试。它们通常非常非常非常小（从抽象类继承）而不是更多。然后，在您的单元测试中，您可以调用您想要测试的抽象方法。

您应该测试包含一些逻辑的抽象类，就像您拥有的所有其他类一样。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-28T13:47:34.723

我为抽象类和接口做的事情如下：我编写了一个测试，它使用具体的对象。但是测试中没有设置X类型的变量（X是抽象类）。这个测试类没有添加到测试套件中，而是它的子类，它们有一个设置方法，将变量设置为 X 的具体实现。这样我就不会复制测试代码。如果需要，未使用测试的子类可以添加更多测试方法。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-28T13:39:22.667

要专门对抽象类进行单元测试，您应该派生它以用于测试目的、测试 base.method() 结果和继承时的预期行为。

你通过调用一个方法来测试它，所以通过实现它来测试一个抽象类......

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-28T14:19:18.250

如果您的抽象类包含具有商业价值的具体功能，那么我通常会通过创建一个存根抽象数据的测试替身来直接对其进行测试，或者使用模拟框架为我执行此操作。我选择哪一个很大程度上取决于我是否需要编写抽象方法的特定于测试的实现。

我需要执行此操作的最常见情况是当我使用[模板方法模式](http://en.wikipedia.org/wiki/Template_method_pattern)时，例如当我正在构建某种将由第 3 方使用的可扩展框架时。在这种情况下，抽象类定义了我要测试的算法，因此测试抽象基础比测试特定实现更有意义。

然而，我认为这些测试应该**只关注真实业务逻辑的具体实现是**很重要的；你不应该对抽象类的*实现细节*进行单元测试，因为你最终会得到脆弱的测试。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-12-04T07:41:05.363

一种方法是编写一个与您的抽象类相对应的抽象测试用例，然后编写子类化您的抽象测试用例的具体测试用例。对原始抽象类的每个具体子类执行此操作（即，您的测试用例层次结构反映了您的类层次结构）。请参阅 junit recipies 书中的测试接口：http: [//safari.informit.com/9781932394238/ch02lev1sec6](http://safari.informit.com/9781932394238/ch02lev1sec6)。[https://www.manning.com/books/junit-recipes](https://www.manning.com/books/junit-recipes)或[https://www.amazon.com/JUnit-Recipes-Practical-Methods-Programmer/dp/1932394230](https://rads.stackoverflow.com/amzn/click/com/1932394230)如果您没有 safari 帐户。

另请参阅 xUnit 模式中的测试用例超类：http: [//xunitpatterns.com/Testcase%20Superclass.html](http://xunitpatterns.com/Testcase%20Superclass.html)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-28T13:35:55.013

我反对“抽象”测试。我认为测试是一个具体的想法，没有抽象。如果您有共同的元素，请将它们放在帮助方法或类中供所有人使用。

至于测试一个抽象测试类，请确保你问自己你正在测试什么。有几种方法，您应该找出在您的场景中有效的方法。您是否正在尝试在您的子类中测试一种新方法？然后让您的测试仅与该方法交互。您是否正在测试基类中的方法？然后可能只为该类有一个单独的夹具，并根据需要使用尽可能多的测试单独测试每个方法。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-28T14:03:46.703

这是我在设置用于测试抽象类的工具时通常遵循的模式：

```
public abstract class MyBase{
  /*...*/
  public abstract void VoidMethod(object param1);
  public abstract object MethodWithReturn(object param1);
  /*,,,*/
} 
```

我在测试中使用的版本：

```
public class MyBaseHarness : MyBase{
  /*...*/
  public Action<object> VoidMethodFunction;
  public override void VoidMethod(object param1){
    VoidMethodFunction(param1);
  }
  public Func<object, object> MethodWithReturnFunction;
  public override object MethodWithReturn(object param1){
    return MethodWihtReturnFunction(param1);
  }
  /*,,,*/
} 
```

如果在我不期望的时候调用了抽象方法，测试就会失败。在安排测试时，我可以很容易地使用 lambdas 来存根抽象方法，这些方法执行断言、抛出异常、返回不同的值等。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-28T13:36:38.787

如果具体方法调用该策略不起作用的任何抽象方法，并且您希望分别测试每个子类的行为。否则，如您所描述的那样扩展它并存根抽象方法应该没问题，再次提供抽象类的具体方法与子类分离。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-28T13:36:50.863

我想你可能想测试一个抽象类的基本功能......但你可能最好通过扩展类而不覆盖任何方法，并对抽象方法进行最小化的模拟。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-28T14:09:27.503

使用抽象类的主要动机之一是在应用程序中启用多态性——即：您可以在运行时替换不同的版本。事实上，这与使用接口非常相似，只是抽象类提供了一些通用管道，通常称为*模板模式*。

从单元测试的角度来看，有两件事需要考虑：

1.  **您的抽象类与其相关类的交互**。使用模拟测试框架非常适合这种情况，因为它表明您的抽象类与其他类配合得很好。

2.  **派生类的功能**。如果您有为派生类编写的自定义逻辑，则应该单独测试这些类。

编辑：RhinoMocks 是一个很棒的模拟测试框架，它可以在运行时通过从你的类中动态派生来生成模拟对象。这种方法可以为您节省无数小时的手动编写派生类的时间。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-05-16T06:32:51.693

首先，如果抽象类包含一些具体方法，我认为你应该考虑这个例子

```
 public abstract class A 

 {

    public boolean method 1
    {
        // concrete method which we have to test.

    }

 }

 class B extends class A

 {

      @override
      public boolean method 1
      {
        // override same method as above.

      }

 } 

  class Test_A 

  {

    private static B b;  // reference object of the class B

    @Before
    public void init()

      {

      b = new B ();    

      }

     @Test
     public void Test_method 1

       {

       b.method 1; // use some assertion statements.

       }

   } 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2017-01-23T16:06:34.857

在@patrick-desjardins 回答之后，我实现了抽象及其实现类，`@Test`如下所示：

**抽象类 - ABC.java**

```
import java.util.ArrayList;
import java.util.List;

public abstract class ABC {

    abstract String sayHello();

    public List<String> getList() {
        final List<String> defaultList = new ArrayList<>();
        defaultList.add("abstract class");
        return defaultList;
    }
} 
```

由于***抽象类不能被实例化，但可以被子类化***，具体类**DEF.java**如下：

```
public class DEF extends ABC {

    @Override
    public String sayHello() {
        return "Hello!";
    }
} 
```

**@Test**类来测试抽象和非抽象方法：

```
import org.junit.Before;
import static org.hamcrest.MatcherAssert.assertThat;
import static org.hamcrest.Matchers.empty;
import static org.hamcrest.Matchers.is;
import static org.hamcrest.Matchers.not;
import static org.hamcrest.Matchers.contains;
import java.util.Collection;
import java.util.List;
import static org.hamcrest.Matchers.equalTo;

import org.junit.Test;

public class DEFTest {

    private DEF def;

    @Before
    public void setup() {
        def = new DEF();
    }

    @Test
    public void add(){
        String result = def.sayHello();
        assertThat(result, is(equalTo("Hello!")));
    }

    @Test
    public void getList(){
        List<String> result = def.getList();
        assertThat((Collection<String>) result, is(not(empty())));
        assertThat(result, contains("abstract class"));
    }
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2018-01-24T20:28:38.750

如果抽象类适合您的实现，请测试（如上所述）派生的具体类。你的假设是正确的。

为避免将来混淆，请注意这个具体的测试类不是模拟的，而是**假**的。

严格来说，**模拟**由以下特征定义：

*   使用模拟来代替正在测试的主题类的每个依赖项。
*   模拟是接口的伪实现（您可能还记得，作为一般规则，依赖项应该声明为接口；可测试性是这样做的主要原因之一）
*   模拟接口成员的行为——无论是方法还是属性——在测试时提供（同样，通过使用模拟框架）。这样，您可以避免将正在测试的实现与其依赖项的实现耦合（它们都应该有自己的离散测试）。

# tsql - 在 T-SQL 中聚合 GREATEST

> ID：243277
> 
> 赞同：2
> 
> 时间：2008-10-28T13:25:58.747
> 
> 标签：tsql

我的 SQL 生锈了——我有一个简单的要求来计算两列值中较大者的总和：

```
CREATE TABLE [dbo].[Test]
(
    column1 int NOT NULL, 
    column2 int NOT NULL
);

insert into Test (column1, column2) values (2,3)
insert into Test (column1, column2) values (6,3)
insert into Test (column1, column2) values (4,6)
insert into Test (column1, column2) values (9,1)
insert into Test (column1, column2) values (5,8) 
```

在 SQL Server 中没有 GREATEST 函数的情况下，我可以通过以下方式获得两列中较大的一个：

```
select column1, column2, (select max(c) 
                            from (select column1 as c
                                   union all
                                  select column2) as cs) Greatest
  from test 
```

我希望我可以简单地总结它们：

```
select sum((select max(c) 
              from (select column1 as c
                     union all
                    select column2) as cs))
  from test 
```

但没有骰子：

```
Msg 130, Level 15, State 1, Line 7
Cannot perform an aggregate function on an expression containing an aggregate or a subquery. 
```

在不使用过程/临时表的情况下，这在 T-SQL 中是否可行？

更新：Eran，谢谢-我使用了这种方法。然而，我的最终表达有点复杂，我想知道这种情况下的性能：

```
SUM(CASE WHEN ABS(column1 * column2) > ABS(column3 * column4)
         THEN column5 * ABS(column1 * column2) * column6
         ELSE column5 * ABS(column3 * column4) * column6 END) 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-28T13:32:02.760

试试这个：

```
 SELECT SUM(CASE WHEN column1 > column2 
                 THEN column1 
                 ELSE column2 END) 
 FROM test 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T13:29:49.580

试试这个...它不是性能最好的选择，但应该可以。

```
SELECT
  'LargerValue' = CASE 
                   WHEN SUM(c1) >= SUM(c2) THEN SUM(c1)
                   ELSE SUM(c2)
                  END
FROM Test 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T13:34:36.420

```
SELECT
    SUM(MaximumValue)
FROM (
    SELECT 
        CASE WHEN column1 > column2
        THEN
            column1
        ELSE
            column2
        END AS MaximumValue
    FROM
        Test
) A
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T15:34:32.697

仅供参考，更复杂的情况应该没问题，只要所有这些列都是同一个表的一部分。它仍在查找相同数量的行，因此性能应该与更简单的情况非常相似（因为 SQL Server 性能通常受 IO 限制）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-03T08:24:58.027

如何从单行数据中找到最大值

```
 -- eg (empid , data1,data2,data3  )
    select emplid , max(tmp.a)
    from
      (select emplid,date1 from table
      union 
      select emplid,date2 from table 
      union 
      select emplid,date3 from table
    ) tmp , table
    where tmp.emplid = table.emplid 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-05T06:54:19.170

```
select sum(id) from (
    select (select max(c)
        from (select column1 as c
                union all
                select column2) as cs) id
  from test
) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-27T19:32:22.773

对此的最佳答案很简单：

```
;With Greatest_CTE As
(
  Select ( Select Max(ValueField) From ( Values (column1), (column2) ) ValueTable(ValueField) ) Greatest
    From Test
)
Select Sum(Greatest)
  From Greatest_CTE 
```

它比具有两个以上值列的其他答案要好得多。

# c# - 一个类怎么可能没有构造函数？

> ID：243293
> 
> 赞同：12
> 
> 时间：2008-10-28T13:30:24.353
> 
> 标签：c#, .net, constructor, clr

不久前，我询问了有关实例化 HttpContext 对象的问题。现在我学到了我不知道的东西，让我困惑的是你不能说 HttpContext ctx = new HttpContext(); 因为该对象没有构造函数。

但是不是每个类都需要构造函数吗？在 C# 中，如果您不提供，编译器会自动为您提供默认的 cstr。

另外，如果我有一个字符串（例如：“Hello There！”）并且我说 Convert.ToBoolean("Hello") 或任何字符串，它是如何工作的？幕后会发生什么？我想在这种情况下，像 CLR Via C# 这样的书会很方便。

我错过了什么？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-28T13:31:35.023

构造函数可以是私有的或受保护的。
即使该类具有公共构造函数，您也不能创建抽象类的实例。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-28T13:59:39.303

HttpContext 有一个带有两个重载的公共构造函数，但它不是默认的（无参数）一个。

例如，您需要传入一个 SimpleWorkerRequest 实例以实例化一个 HttpContext 实例并将其分配给 HttpContext.Current：

```
//Initialize this stuff with some crap
string appVirtualDir = "/"; 
string appPhysicalDir = @"C:\Documents and Settings\"; 
string page = @"localhost"; 
string query = string.Empty; 
TextWriter output = null;    
//Create a SimpleWorkerRequest object passing down the crap
SimpleWorkerRequest workerRequest = new SimpleWorkerRequest(appVirtualDir, appPhysicalDir, page, query, output);
//Create your fake HttpContext instance 
HttpContext.Current = new HttpContext(workerRequest); 
```

有关详细信息，请参阅[此链接](http://msdn.microsoft.com/en-us/library/system.web.httpcontext.httpcontext.aspx)。

无论如何，有些类没有公共构造函数 - 例如，考虑一个[单例](http://www.dofactory.com/Patterns/PatternSingleton.aspx)类，构造函数是私有的（您可以调用静态 getInstance 方法来获取当前实例，或者如果它为空则创建它）。

干杯

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-28T14:07:11.470

你有3个问题...

**HttpContext** ; 它实际上有两个公共构造函数——但实际上你不应该使用它们。更一般地说，您可以使用非默认构造函数，如下所示`MyType foo = new MyType("abc");`：

**缺少构造函数** 已经很好地覆盖了，但没有：`abstract`/`static`是最简单的，但也没有必要拥有一个*公共*构造函数。

**ToBoolean** Behing 场景，这将在道德上等同于`bool.Parse("Hello")`，它只是检查已知字符串 - 特别是“True”和“False”（使用 OrdinalIgnoreCase，已经处理了 null/trimming/等）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-28T13:33:25.877

例如，单例没有构造函数，或者至少没有公共构造函数。因此，如果您的班级是单身人士，而不是写作

```
MyClass c = new MyClass(); 
```

你会改写

```
MyClass c = MyClass.getInstance(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T13:32:17.033

我相信 HttpContext 构造函数已被标记为私有。这意味着您不能自己实例化它。.net 框架在幕后为您创建了一个...

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-28T13:32:56.923

一言以蔽之：[静态](http://msdn.microsoft.com/en-us/library/98f28cdx(VS.80).aspx)。

否则，一个类可能会在内部或私有实例化（工厂或单例）

西格莱顿：

```
Class A{
public static readonly A Instance = new A();

private A()
{
}

} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-28T13:49:57.247

看看[单例设计模式](http://www.dofactory.com/Patterns/PatternSingleton.aspx)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-28T13:33:17.763

如果您将构造函数设为私有，则无法将类实例化。但在课堂上是可能的。因此，您可以提供一个返回类实例的静态方法。单例模式就是基于此。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2017-08-02T14:40:42.917

在类具有带参数的构造函数之前，编译器不会创建类的默认构造函数。在 HttpContext 类中，它有 2 个带参数的构造函数。因此，当您执行 HttpContext obj = new HttpContext() 时会显示错误。

```
public class Sample
{
    int x;
    public Sample (int x)
    {
        x = 2;
    }
}
public class Program
    {
        static void Main(string[] args)
        {
            Sample s = new Sample();//error is shown
        }
    } 
```

当您删除 Sample 类的上述构造函数时，不会出现错误，因为编译器会创建默认构造函数（没有参数的构造函数）。

# java - 如何在 Eclipse 中强制线程转储？

> ID：243298
> 
> 赞同：29
> 
> 时间：2008-10-28T13:31:01.747
> 
> 标签：java, eclipse, memory-leaks, weblogic

我正在通过 BEA Weblogic Server v9.2 运行时环境在 Eclipse 中启动一个 Weblogic 应用程序。如果这直接从命令行运行，我会执行 ctrl-BREAK 来强制执行线程转储。有没有办法在 Eclipse 中做到这一点？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-28T15:18:07.350

确实（感谢 VonC 指向 SO 线程），Dustin 在对他的消息的评论中指向[jstack](http://java.sun.com/j2se/1.5.0/docs/tooldocs/share/jstack.html "jstack - 堆栈跟踪")。

我在 Eclipse 中运行了一个小的 Java 应用程序（带有 GUI），我可以在 Windows 的进程管理器中看到相关的 javaw.exe 及其 PID 7088（当然，在 Unix 中它更简单）。

如果我在命令提示符下键入`jstack 7088`，则每个线程都有所需的堆栈转储。
凉爽的。

如果我们可以直接从 Eclipse 中执行此操作会更好，但这已经很有用了。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-28T15:48:08.163

您可以在调试模式下执行此操作：进入调试视图中的调试视图，单击已启动的进程并单击暂停，您将获得所有进程的图形堆栈。

注意：这在使用远程调试时也有效，您不需要从 eclipse 启动 weblogic，您可以自己启动它，打开调试端口并为其创建“远程 java 应用程序调试配置”。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-07T23:28:11.357

检查发送信号： [http ://www.latenighthacking.com/projects/2003/sendSignal/](http://www.latenighthacking.com/projects/2003/sendSignal/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-10-13T13:51:20.580

Eclipse Wiki: [How to Report a Deadlock](http://wiki.eclipse.org/How_to_report_a_deadlock)列出了在 Eclipse 中创建线程转储的所有可能选项。根据具体情况，其中一个可能会更好——我个人在 Windows 上最喜欢的是 Adaptj Stacktrace 工具。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-28T23:36:56.830

[StackTrace](http://www.adaptj.com/main/stacktrace)是您可以尝试的另一种选择。从特点：

> 作为*Windows*服务（例如 Tomcat）运行的 Java 进程的线程转储，以*javaw.exe*开始，在任何浏览器中运行的小程序或嵌入在另一个进程中的 JVM。StackTrace 适用于 Windows、Linux 和 Mac OS X。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-07-30T08:22:59.310

如果您更喜欢基于 UI 的解决方案，[visualvm](http://visualvm.java.net/)可能是一个不错的选择。（它的优点还在于它与JDK一起分发）

在 visualvm 中进行线程转储：

1.  连接到进程（远程或本地）和
2.  去`Threads`（标签）-> `Thread Dump`（按钮）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-28T14:59:55.703

您是否尝试使用 java.exe 而不是 javaw.exe （在您的[eclipse.ini](https://stackoverflow.com/questions/142357/what-are-the-best-eclipse-34-jvm-settings#144349)中）启动您的 Eclipse？

这可能会为您提供所需的控制台，[如此错误](https://bugs.eclipse.org/bugs/show_bug.cgi?id=13524)和[此消息](http://dev.eclipse.org/mhonarc/newsLists/news.eclipse.platform/msg15120.html)中所述。

其他想法（在 java 选项方面）可以从这个[其他 SO question](https://stackoverflow.com/questions/66104/why-does-tomcat-55-with-java-14-running-on-windows-xp-32-bit-suddenly-hang)中得出。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-19T16:54:53.237

您可以通过 JVisualVM 连接并获取线程转储。只需右键单击应用程序树中的应用程序节点，然后选择“线程转储”

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-03-16T22:27:43.973

在 linux 上，至少您可以执行 a`ps -ef | grep java`来获取 PID，然后执行 a`kill -3 PID`并将其输出到 Eclipse 控制台。

# java - 如何格式化 JMS 文本消息的正文？

> ID：243306
> 
> 赞同：2
> 
> 时间：2008-10-28T13:31:58.813
> 
> 标签：java, jms

每个人都只是在消息中使用 XML 吗？XML 有什么好的替代品吗？如果您确实使用 XML，您是否定义了 XML 模式以便客户端知道如何向您的服务发送消息？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T13:34:44.860

我们使用 XML，但我认为重要的是为问题量身定制解决方案。我们使用 XML 的原因是我们基本上是在消息中发送一个对象。没有理由它不能是纯文本，如果适用于您发送的消息，使用标头在适当的情况下发送属性。

* * *

我们还没有为我们的 XML 消息定义 XSD 或 DTD，但我们确实有一个描述它们的组成的正式文档，以便其他团队可以使用我们的提要而不会打扰我们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T13:45:48.333

XML、CSV、HTML、一个简单的单词或句子……任何这些都是有效的，具体取决于使用和创建消息的上下文。只需保持简单并发送该上下文所需的内容即可。

它非常灵活，可以适应问题空间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T16:52:31.310

XML 可能是最受欢迎的，JSON 紧随其后 - 但正如其他人在此线程中所说 - XML、CSV、JSON 甚至 HTML 都可以。

XSD 确实被高估了——它们唯一真正的价值是如果您希望您的客户/客户编写代码生成编组代码（例如使用 JAXB），或者如果您想让人们在他们的编辑器/IDE 中使用 XSD 来获得智能完成

# c++ - 保存 Direct3D 设备的状态

> ID：243322
> 
> 赞同：0
> 
> 时间：2008-10-28T13:33:27.513
> 
> 标签：c++, direct3d

状态应至少包括以下内容：

*   通过 SetStreamResource() 设置的所有设置
*   指数

我有一个类，它的 Draw() 函数将调用 SetStreamResource、设置索引并最终调用 DrawIndexedPrimitive()。我想在 Draw() 返回之前恢复设备状态。

我正在寻找与 GDI 的 SaveDC()/RestoreDC() 类似的东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-17T01:39:14.340

状态块是 API 提供的用于保存和恢复设备状态块的机制。我在我的书[The Direct3D Graphics Pipeline](http://www.xmission.com/~legalize/book/download/)中的第 3 章中介绍了状态块的详细信息。您可以从上面的链接下载该章节的 PDF。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-31T14:37:36.583

看起来这些会做到这一点：

```
Microsoft::DirectX::Direct3D::Device::BeginStateBlock
Microsoft::DirectX::Direct3D::Device::EndStateBlock 
```

# asp.net - ASP.NET 无法访问通过内联编码在页面加载中创建的数据表

> ID：243344
> 
> 赞同：0
> 
> 时间：2008-10-28T13:38:24.807
> 
> 标签：asp.net, pageload, inline-code

在代码隐藏文件的 Page_Load 事件中，我正在将数据加载到数据表中。在我的 .aspx 页面中，我有一些内联编码，我想显示这个数据表中的一些数据。但是当我运行程序时，它显示像“错误 64 使用未分配的局部变量 'dtblChild'”这样的错误 dtblChild 是我的 DataTable 对象

代码隐藏中的 Page_Load 是否在加载表单元素后执行？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T14:23:15.590

内联代码在渲染阶段执行。

在页面的[生命周期](http://msdn.microsoft.com/en-us/library/ms178472.aspx)中，渲染发生的时间比加载晚得多

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T14:02:18.610

更“ASP.Net-ish”的方式是这样的：

```
<asp:Repeater ID="MyRepeater" runat="server" DataSource="dtblChild">
    <ItemTemplate>
        <tr><td>Thisss</td></tr>
    </ItemTemplate>
</asp:Repeater> 
```

您可能还需要声明一个 ObjectDatasource 来包装您的数据表，以使其与中继器兼容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T14:08:12.123

如上所述，将您的 dtblChild 绑定到转发器（或 DataGrid）。它会更容易维护。然后在单独的函数中填充 DataTable 并将其绑定到转发器。需要时在 Page_Load 中调用该函数。

```
<table>
<asp:Repeater ID="rptSearchResults" runat="server">
    <ItemTemplate>
        <tr>
            <td><%#DataBinder.Eval(Container.DataItem, "ColumnName") %></td>
        </tr>
    </ItemTemplate>
</asp:Repeater>
</table> 
```

函数加载数据（）{

rptSearchResults.DataSource = dtblChild;

rptSearchResults.DataBind();

}

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T13:49:16.953

是的，页面加载是在所有服务器控件都加载到内存后执行的，但是如果要使用数据表，则必须确保在每次刷新时重新填充数据表。

我认为您的问题表明您绑定到页面的方式存在一些更深层次的问题。

你能发布一些代码吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T13:49:35.407

尝试为此使用中继器控件或 datagridview 而不是`<% %>`蜜蜂蜇伤。太多的内联代码不能很好地与文件后面的代码混合：你会得到意想不到的结果。如果您真的知道自己在做什么，它可以工作，但您必须小心，我不会向任何刚接触 ASP.Net 的人推荐它。

我还建议您花一些时间熟悉[ASP.Net 页面生命周期](http://msdn.microsoft.com/en-us/library/ms178472.aspx)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T13:55:03.463

## 这是我的内联编码

</tr> <% foreach (dtblChild.Rows 中的DataRow dr) { %> <tr><td>Thissss</td></tr> <%

```
 } 
```

%>

在 Page_Load 后面的代码中，我将数据填充到 DataTable 对象（dtblChild）

# .net - 如何在混合（C#/C++）调试中设置数据断点？

> ID：243347
> 
> 赞同：22
> 
> 时间：2008-10-28T13:39:29.343
> 
> 标签：.net, visual-studio-2008, debugging, mixed-mode

我在 C# 中启动我的程序，然后调用一些非托管 C++。

当我在非托管 C++ 中换行时，“新数据断点”菜单项显示为灰色。

有没有办法解决？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-28T15:03:25.383

所以要做到这一点，我必须：

*   将非托管dll设置为启动项目
*   将托管程序设置为启动命令
*   将调试模式设置为**Native**
*   “中断执行”或打断点，使您处于“调试”状态

耶赫

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-28T14:27:41.353

要在混合模式进程的本机部分设置数据断点，请参阅[jyoung 发布的答案](https://stackoverflow.com/a/243643/55721)。

运行纯本机代码以外的任何内容时，Visual Studio 都会禁用数据断点。有关VS 项目经理的部分解释，请参阅[这篇文章。](http://social.msdn.microsoft.com/Forums/en-US/vsdebug/thread/b51134c2-9cc9-43f2-af63-f0401e6621f3/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-05-07T22:55:39.727

建议的解决方案并非始终有效。即使在本机模式下调试时，程序在本机代码段中中断，当尝试设置“新数据断点”时，我也会弹出***“无法设置断点。公共语言运行时不支持数据断点”***

另一种方法是直接从代码中添加数据断点。请参阅[此处](http://www.codeproject.com/Articles/28071/Toggle-hardware-data-read-execute-breakpoints-prog)的文章。

这在混合模式下效果很好，它只需要激活本机调试模式（如上所述）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-01-10T17:27:15.723

一个非常有用的技巧是在特殊情况下从代码中调用断点：

```
If (Condition)
    System.Diagnostics.Debugger.Break() 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2022-02-15T01:42:43.597

另一种方法是附加到过程中。

无需调试器即可正常构建和运行您的软件。

然后在 Visual Studio 中，在顶部菜单中的“Debug / Attach to Process”，找到该进程，在列表中选择它。然后，在“附加到”面板的右侧，单击“选择...”按钮，单击“调试这些代码类型”单选按钮，取消选中除本机以外的所有内容，单击确定，单击附加。

[![在此处输入图像描述](https://i.stack.imgur.com/aUKSR.png)](https://i.stack.imgur.com/aUKSR.png)

然后使用 Debug / Break All 命令中断执行，或者在应用程序的 C++ 部分中的某处击中正常断点。然后，您将能够使用数据断点。

# c# - Environment.TickCount 与 DateTime.Now

> ID：243351
> 
> 赞同：70
> 
> 时间：2008-10-28T13:40:20.293
> 
> 标签：c#, .net, datetime, timespan

可以`Environment.TickCount`用来计算时间跨度吗？

```
int start = Environment.TickCount;
// Do stuff
int duration = Environment.TickCount - start;
Console.WriteLine("That took " + duration " ms"); 
```

因为`TickCount`已签名并且将在 25 天后翻转（需要 50 天才能达到所有 32 位，但如果您想了解数学，则必须废弃已签名的位），看起来风险太大而无法使用。

我正在使用`DateTime.Now`。这是最好的方法吗？

```
DateTime start = DateTime.Now;
// Do stuff
TimeSpan duration = DateTime.Now - start;
Console.WriteLine("That took " + duration.TotalMilliseconds + " ms"); 
```

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2012-01-14T21:42:17.563

**Environment.TickCount**基于[GetTickCount()](http://msdn.microsoft.com/en-us/library/ms724408.aspx) WinAPI 函数。它以毫秒为单位，但它的实际精度约为 15.6 毫秒。所以你不能测量更短的时间间隔（或者你会得到 0）

*注意：*返回值为 Int32，因此此计数器每 ~49.7 天滚动一次。你不应该用它来测量这么长的间隔。

**DateTime.Ticks**是基于[GetSystemTimeAsFileTime](http://msdn.microsoft.com/en-us/library/ms724397.aspx) () WinAPI 函数。它在 100 纳秒（十分之一微秒）内。DateTime.Ticks 的实际精度取决于系统。在 XP 上，系统时钟的增量约为 15.6 ms，与 Environment.TickCount 相同。在 Windows 7 上，它的精度是 1 毫秒（而 Environemnt.TickCount 的仍然是 15.6 毫秒），但是如果使用省电方案（通常在笔记本电脑上），它也可以下降到 15.6 毫秒。

**秒表**基于[QueryPerformanceCounter()](http://msdn.microsoft.com/en-us/library/ms644904.aspx) WinAPI 函数（但如果您的系统不支持高分辨率性能计数器，则使用 DateTime.Ticks）

在使用 StopWatch 之前注意两个问题：

*   它在多处理器系统上可能不可靠（参见 MS [kb895980](http://support.microsoft.com/?scid=kb;en-us;895980)、[kb896256](http://support.microsoft.com/?scid=kb;en-us;896256)）
*   如果 CPU 频率变化，则可能不可靠（阅读[本文](http://www.virtualdub.org/blog/pivot/entry.php?id=106)）

您可以通过简单的测试来评估系统的精度：

```
static void Main(string[] args)
{
    int xcnt = 0;
    long xdelta, xstart;
    xstart = DateTime.UtcNow.Ticks;
    do {
        xdelta = DateTime.UtcNow.Ticks - xstart;
        xcnt++;
    } while (xdelta == 0);

    Console.WriteLine("DateTime:\t{0} ms, in {1} cycles", xdelta / (10000.0), xcnt);

    int ycnt = 0, ystart;
    long ydelta;
    ystart = Environment.TickCount;
    do {
        ydelta = Environment.TickCount - ystart;
        ycnt++;
    } while (ydelta == 0);

    Console.WriteLine("Environment:\t{0} ms, in {1} cycles ", ydelta, ycnt);

    Stopwatch sw = new Stopwatch();
    int zcnt = 0;
    long zstart, zdelta;

    sw.Start();
    zstart = sw.ElapsedTicks; // This minimizes the difference (opposed to just using 0)
    do {
        zdelta = sw.ElapsedTicks - zstart;
        zcnt++;
    } while (zdelta == 0);
    sw.Stop();

    Console.WriteLine("StopWatch:\t{0} ms, in {1} cycles", (zdelta * 1000.0) / Stopwatch.Frequency, zcnt);
    Console.ReadKey();
} 
```

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2008-10-28T13:41:34.097

使用秒表类。msdn 上有一个不错的例子：http: [//msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx)

```
 Stopwatch stopWatch = Stopwatch.StartNew();
    Thread.Sleep(10000);
    stopWatch.Stop();
    // Get the elapsed time as a TimeSpan value.
    TimeSpan ts = stopWatch.Elapsed; 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-07-03T06:59:27.530

为什么担心翻车？只要您测量的持续时间低于 24.9 天并且您计算*相对*持续时间，就可以了。系统运行了多长时间并不重要，只要您只关心运行时间的一部分（而不是直接在开始点和结束点上执行小于或大于比较）。即：

```
 int before_rollover = Int32.MaxValue - 5;
 int after_rollover = Int32.MinValue + 7;
 int duration = after_rollover - before_rollover;
 Console.WriteLine("before_rollover: " + before_rollover.ToString());
 Console.WriteLine("after_rollover: " + after_rollover.ToString());
 Console.WriteLine("duration: " + duration.ToString()); 
```

正确打印：

```
 before_rollover: 2147483642
 after_rollover: -2147483641
 duration: 13 
```

您不必担心符号位。C# 和 C 一样，让 CPU 处理这个问题。

这是我之前在嵌入式系统中遇到的常见情况。例如，我永远不会直接比较 beforerollover < afterrollover。我总是会执行减法以找到考虑翻转的持续时间，然后基于持续时间进行任何其他计算。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-28T13:41:46.187

你可能想要[`System.Diagnostics.StopWatch`](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx).

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2011-06-10T15:37:18.400

如果您正在寻找的功能`Environment.TickCount`但没有创建新`Stopwatch`对象的开销，您可以使用静态`Stopwatch.GetTimestamp()`方法（连同`Stopwatch.Frequency`）来计算长时间跨度。因为`GetTimestamp()`返回 a `long`，它不会在很长一段时间内溢出（超过 100,000 年，在我用来写这个的机器上）。`Environment.TickCount`它也比最大分辨率为 10 到 16 毫秒的精确得多。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2017-04-11T06:43:09.793

Environment.TickCount 似乎比其他解决方案快得多：

```
Environment.TickCount 71
DateTime.UtcNow.Ticks 213
sw.ElapsedMilliseconds 1273 
```

测量结果由以下代码生成：

```
static void Main( string[] args ) {
    const int max = 10000000;
    //
    //
    for ( int j = 0; j < 3; j++ ) {
        var sw = new Stopwatch();
        sw.Start();
        for ( int i = 0; i < max; i++ ) {
            var a = Environment.TickCount;
        }
        sw.Stop();
        Console.WriteLine( $"Environment.TickCount {sw.ElapsedMilliseconds}" );
        //
        //
        sw = new Stopwatch();
        sw.Start();
        for ( int i = 0; i < max; i++ ) {
            var a = DateTime.UtcNow.Ticks;
        }
        sw.Stop();
        Console.WriteLine( $"DateTime.UtcNow.Ticks {sw.ElapsedMilliseconds}" );
        //
        //
        sw = new Stopwatch();
        sw.Start();
        for ( int i = 0; i < max; i++ ) {
            var a = sw.ElapsedMilliseconds;
        }
        sw.Stop();
        Console.WriteLine( $"sw.ElapsedMilliseconds {sw.ElapsedMilliseconds}" );
    }
    Console.WriteLine( "Done" );
    Console.ReadKey();
} 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-10-28T13:42:01.443

采用

```
System.Diagnostics.Stopwatch 
```

它有一个属性叫做

```
EllapsedMilliseconds 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2017-05-03T22:06:45.103

这是该线程中可能是最有用的答案和评论的更新和刷新摘要+额外的基准和变体：

首先第一件事：正如其他人在评论中指出的那样，过去几年情况发生了变化，“现代”Windows (Win XP ++) 和 .NET 以及现代硬件没有或很少有理由不使用 Stopwatch()。有关详细信息，请参阅[MSDN](https://msdn.microsoft.com/en-us/library/windows/desktop/dn553408%28v=vs.85%29.aspx?f=255&MSPPError=-2147217396#Guidance)。语录：

> “QPC 精度是否会受到电源管理或 Turbo Boost 技术引起的处理器频率变化的影响？不会
> **。**如果*处理器具有不变的 TSC*，则 QPC 不受这些变化的影响。如果处理器没有不变的 TSC， QPC 将恢复为不受处理器频率变化或 Turbo Boost 技术影响的平台硬件计时器。
> 
> QPC 在多处理器系统、多核系统和超线程系统上是否可靠工作？
> **是的**
> 
> 如何确定和验证 QPC 在我的机器上工作？
> **您无需执行此类检查。**
> 
> 哪些处理器具有非不变 TSC？[..进一步阅读..]“

但是，如果您不需要 Stopwatch() 的精度，或者至少想确切了解 Stopwatch 的性能（静态与基于实例）和其他可能的变体，请继续阅读：

我从 cskwg 接管了上面的基准测试，并为更多变体扩展了代码。我用几年前的 i7 4700 MQ 和 C# 7 和 VS 2017 进行了测量（更准确地说，用 .NET 4.5.2 编译，尽管是二进制文字，它是 C# 6（使用这个：字符串文字和'使用静态'). 与上述基准相比，尤其是 Stopwatch() 的性能似乎有所提高。

这是一个循环中 1000 万次重复结果的示例，与往常一样，绝对值并不重要，但即使是相对值也可能在其他硬件上有所不同：

**32位，无优化的发布模式：**

> 测量：GetTickCount64() [ms]：275
> 测量：Environment.TickCount [ms]：45
> 测量：DateTime.UtcNow.Ticks [ms]：**167**
> 测量：秒表：.ElapsedTicks [ms]：277
> 测量：秒表：.ElapsedMilliseconds [ ms]：548
> 测量：静态 Stopwatch.GetTimestamp [ms]：193
> 测量：秒表+转换为 DateTime [ms]：551
> 与 DateTime.Now.Ticks [ms] 比较：**9010**

**32 位，发布模式，优化：**

> 实测：GetTickCount64() [ms]：198
> 实测：Environment.TickCount [ms]：39
> 实测：DateTime.UtcNow.Ticks [ms]：66 **（！）**
> 实测：秒表：.ElapsedTicks [ms]：175
> 实测：秒表： .ElapsedMilliseconds [ms]：**491**
> 测量：静态 Stopwatch.GetTimestamp [ms]：175
> 测量：秒表+转换为 DateTime [ms]： **510**
> 与 DateTime.Now.Ticks [ms] 比较：**8460**

**64位，无优化的发布模式：**

> 测量：GetTickCount64() [ms]：205
> 测量：Environment.TickCount [ms]：39
> 测量：DateTime.UtcNow.Ticks [ms]：**127**
> 测量：秒表：.ElapsedTicks [ms]：209
> 测量：秒表：.ElapsedMilliseconds [ ms]：285
> 测量：静态 Stopwatch.GetTimestamp [ms]：187
> 测量：秒表+转换为 DateTime [ms]：319
> 与 DateTime.Now.Ticks [ms] 比较：3040

**64 位，发布模式，优化：**

> 实测：GetTickCount64() [ms]：148
> 实测：Environment.TickCount [ms]：31 **（还值得吗？）**
> 实测：DateTime.UtcNow.Ticks [ms]：76 **（！）**
> 实测：秒表：.ElapsedTicks [ ms]：178
> 测量：秒表：.ElapsedMilliseconds [ms]：226
> 测量：静态 Stopwatch.GetTimestamp [ms]：175
> 测量：秒表+转换为 DateTime [ms]：246
> 与 DateTime.Now.Ticks [ms] 进行比较： 3020

可能非常有趣的是，*创建一个 DateTime 值来打印出秒表时间似乎几乎没有成本*。有趣的是，静态秒表的速度比实际要快一些（正如预期的那样）。一些优化点非常有趣。例如，我无法解释为什么只有 32 位的 Stopwatch.ElapsedMilliseconds 与其他变体相比如此慢，例如静态变体。这和 DateTime.Now 在 64 位上的速度是其速度的两倍多。

您可以看到：仅对于数百万次处决，秒表的时间才开始变得重要。如果情况确实如此（但要提防过早进行微优化），使用 GetTickCount64() 可能会很有趣，但尤其是使用**DateTime.UtcNow**时，您有一个 64 位（长）计时器，其精度低于秒表，但速度更快，这样您就不必乱用 32 位“丑陋”的 Environment.TickCount。

正如预期的那样，DateTime.Now 是迄今为止最慢的。

如果您运行它，代码还会检索您当前的秒表精度等。

这是完整的基准代码：

```
using System.Diagnostics;
using System.Runtime.InteropServices;
using System.Threading;
using static System.Environment; 
```

[...]

```
 [DllImport("kernel32.dll") ]
    public static extern UInt64 GetTickCount64(); // Retrieves a 64bit value containing ticks since system start

    static void Main(string[] args)
    {
        const int max = 10_000_000;
        const int n = 3;
        Stopwatch sw;

        // Following Process&Thread lines according to tips by Thomas Maierhofer: https://codeproject.com/KB/testing/stopwatch-measure-precise.aspx
        // But this somewhat contradicts to assertions by MS in: https://msdn.microsoft.com/en-us/library/windows/desktop/dn553408%28v=vs.85%29.aspx?f=255&MSPPError=-2147217396#Does_QPC_reliably_work_on_multi-processor_systems__multi-core_system__and_________systems_with_hyper-threading
        Process.GetCurrentProcess().ProcessorAffinity = new IntPtr(1); // Use only the first core
        Process.GetCurrentProcess().PriorityClass = ProcessPriorityClass.High;
        Thread.CurrentThread.Priority = ThreadPriority.Highest;
        Thread.Sleep(2); // warmup

        Console.WriteLine($"Repeating measurement {n} times in loop of {max:N0}:{NewLine}");
        for (int j = 0; j < n; j++)
        {
            sw = new Stopwatch();
            sw.Start();
            for (int i = 0; i < max; i++)
            {
                var tickCount = GetTickCount64();
            }
            sw.Stop();
            Console.WriteLine($"Measured: GetTickCount64() [ms]: {sw.ElapsedMilliseconds}");
            //
            //
            sw = new Stopwatch();
            sw.Start();
            for (int i = 0; i < max; i++)
            {
                var tickCount = Environment.TickCount; // only int capacity, enough for a bit more than 24 days
            }
            sw.Stop();
            Console.WriteLine($"Measured: Environment.TickCount [ms]: {sw.ElapsedMilliseconds}");
            //
            //
            sw = new Stopwatch();
            sw.Start();
            for (int i = 0; i < max; i++)
            {
                var a = DateTime.UtcNow.Ticks;
            }
            sw.Stop();
            Console.WriteLine($"Measured: DateTime.UtcNow.Ticks [ms]: {sw.ElapsedMilliseconds}");
            //
            //
            sw = new Stopwatch();
            sw.Start();
            for (int i = 0; i < max; i++)
            {
                var a = sw.ElapsedMilliseconds;
            }
            sw.Stop();
            Console.WriteLine($"Measured: Stopwatch: .ElapsedMilliseconds [ms]: {sw.ElapsedMilliseconds}");
            //
            //
            sw = new Stopwatch();
            sw.Start();
            for (int i = 0; i < max; i++)
            {
                var a = Stopwatch.GetTimestamp();
            }
            sw.Stop();
            Console.WriteLine($"Measured: static Stopwatch.GetTimestamp [ms]: {sw.ElapsedMilliseconds}");
            //
            //
            DateTime dt=DateTime.MinValue; // just init
            sw = new Stopwatch();
            sw.Start();
            for (int i = 0; i < max; i++)
            {
                var a = new DateTime(sw.Elapsed.Ticks); // using variable dt here seems to make nearly no difference
            }
            sw.Stop();
            //Console.WriteLine($"Measured: Stopwatch+conversion to DateTime [s] with millisecs: {dt:s.fff}");
            Console.WriteLine($"Measured: Stopwatch+conversion to DateTime [ms]:  {sw.ElapsedMilliseconds}");

            Console.WriteLine();
        }
        //
        //
        sw = new Stopwatch();
        var tickCounterStart = Environment.TickCount;
        sw.Start();
        for (int i = 0; i < max/10; i++)
        {
            var a = DateTime.Now.Ticks;
        }
        sw.Stop();
        var tickCounter = Environment.TickCount - tickCounterStart;
        Console.WriteLine($"Compare that with DateTime.Now.Ticks [ms]: {sw.ElapsedMilliseconds*10}");

        Console.WriteLine($"{NewLine}General Stopwatch information:");
        if (Stopwatch.IsHighResolution)
            Console.WriteLine("- Using high-resolution performance counter for Stopwatch class.");
        else
            Console.WriteLine("- Using high-resolution performance counter for Stopwatch class.");

        double freq = (double)Stopwatch.Frequency;
        double ticksPerMicroSec = freq / (1000d*1000d) ; // microsecond resolution: 1 million ticks per sec
        Console.WriteLine($"- Stopwatch accuracy- ticks per microsecond (1000 ms): {ticksPerMicroSec:N1}");
        Console.WriteLine(" (Max. tick resolution normally is 100 nanoseconds, this is 10 ticks/microsecond.)");

        DateTime maxTimeForTickCountInteger= new DateTime(Int32.MaxValue*10_000L);  // tickCount means millisec -> there are 10.000 milliseconds in 100 nanoseconds, which is the tick resolution in .NET, e.g. used for TimeSpan
        Console.WriteLine($"- Approximated capacity (maxtime) of TickCount [dd:hh:mm:ss] {maxTimeForTickCountInteger:dd:HH:mm:ss}");
        // this conversion from seems not really accurate, it will be between 24-25 days.
        Console.WriteLine($"{NewLine}Done.");

        while (Console.KeyAvailable)
            Console.ReadKey(false);
        Console.ReadKey();
    } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-28T13:42:12.847

您应该改用[Stopwatch](https://stackoverflow.com/questions/28637/is-datetimenow-the-best-way-to-measure-a-functions-performance)类。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-28T14:23:06.260

我使用 Environment.TickCount 因为：

1.  Stopwatch 类不在 Compact Framework 中。
2.  秒表使用与 TickCount 相同的底层计时机制，因此结果不会或多或少准确。
3.  **TickCount 的环绕问题在宇宙中不太可能受到影响**（您必须让计算机运行 27 天，然后尝试测量恰好跨越环绕时刻的时间），即使您这样做了击中它，结果将是一个巨大的负时间跨度（所以它会脱颖而出）。

话虽如此，如果您可以使用秒表，我也建议您使用它。或者您可以花大约 1 分钟的时间编写一个类似秒表的类，该类包含 Environment.TickCount。

顺便说一句，我在 Stopwatch 文档中没有看到任何提到底层计时器机制的环绕问题，所以如果发现 Stopwatch 遇到同样的问题，我一点也不感到惊讶。但同样，我不会花任何时间担心它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-28T19:34:08.613

我本来想说把它包进一个秒表课，但 Grzenio 已经说对了，所以我会给他一个提振。这种封装因素决定了哪种方式更好，这可能会随着时间而改变。我记得对在某些系统上花费时间的成本感到震惊，因此拥有一个可以实施最佳技术的地方可能非常重要。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-17T00:25:11.097

对于一次性计时，写起来更简单

```
Stopwatch stopWatch = Stopwatch.StartNew();
...dostuff...
Debug.WriteLine(String.Format("It took {0} milliseconds",
                              stopWatch.EllapsedMilliseconds))); 
```

鉴于 ElapsedTicks 字段很长，我猜想 TickCount 中的宇宙不太可能的环绕对于 StopWatch 来说更不用担心。在我的机器上，秒表是高分辨率的，每秒 2.4e9 滴答声。即使按照这样的速度，也需要超过 121 年才能溢出刻度字段。当然，我不知道幕后发生了什么，所以对此持保留态度。但是，我注意到 StopWatch 的文档甚至没有提到环绕问题，而 TickCount 的文档却提到了。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-07-12T11:23:14.443

## 溢出补偿

如前所述，翻转可能在 24.9 天后发生，或者，如果您使用 uint cast，则在 49.8 天后发生。因为不想pInvoke GetTickCount64，所以写了这个溢出补偿。示例代码使用“字节”来保持数字方便。请看一下，它仍然可能包含错误：

```
using System;
namespace ConsoleApp1 {
    class Program {
        //
        static byte Lower = byte.MaxValue / 3;
        static byte Upper = 2 * byte.MaxValue / 3;
        //
        ///<summary>Compute delta between two TickCount values reliably, because TickCount might wrap after 49.8 days.</summary>
        static short Delta( byte next, byte ticks ) {
            if ( next < Lower ) {
                if ( ticks > Upper ) {
                    return (short) ( ticks - ( byte.MaxValue + 1 + next ) );
                }
            }
            if ( next > Upper ) {
                if ( ticks < Lower ) {
                    return (short) ( ( ticks + byte.MaxValue + 1 ) - next );
                }
            }
            return (short) ( ticks - next );
        }
        //
        static void Main( string[] args ) {
            // Init
            Random rnd = new Random();
            int max = 0;
            byte last = 0;
            byte wait = 3;
            byte next = (byte) ( last + wait );
            byte step = 0;
            // Loop tick
            for ( byte tick = 0; true; ) {
                //
                short delta = Delta( next, tick );
                if ( delta >= 0 ) {
                    Console.WriteLine( "RUN: last: {0} next: {1} tick: {2} delta: {3}", last, next, tick, delta );
                    last = tick;
                    next = (byte) ( last + wait );
                }
                // Will overflow to 0 automatically
                step = (byte) rnd.Next( 0, 11 );
                tick += step;
                max++; if ( max > 99999 ) break;
            }
        }
    }
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-07-13T06:36:32.060

## 滴答计数64

对这个新功能做了一些快速测量，我发现（优化，发布 64 位，1000mio 循环）：

```
Environment.TickCount: 2265
Environment.TickCount64: 2531
DateTime.UtcNow.Ticks: 69016 
```

未优化代码的测量结果相似。测试代码：

```
static void Main( string[] args ) {
    long start, end, length = 1000 * 1000 * 1000;
    start = Environment.TickCount64;
    for ( int i = 0; i < length; i++ ) {
        var a = Environment.TickCount;
    }
    end = Environment.TickCount64;
    Console.WriteLine( "Environment.TickCount: {0}", end - start );
    start = Environment.TickCount64;
    for ( int i = 0; i < length; i++ ) {
        var a = Environment.TickCount64;
    }
    end = Environment.TickCount64;
    Console.WriteLine( "Environment.TickCount64: {0}", end - start );
    start = Environment.TickCount64;
    for ( int i = 0; i < length; i++ ) {
        var a = DateTime.UtcNow.Ticks;
    }
    end = Environment.TickCount64;
    Console.WriteLine( "DateTime.UtcNow.Ticks: {0}", end - start );
} 
```

# iis-7 - 查看哪些站点正在使用 IIS 7 中的哪些 IP

> ID：243355
> 
> 赞同：11
> 
> 时间：2008-10-28T13:41:02.820
> 
> 标签：iis-7

有没有办法在 IIS 7 中快速列出哪些站点位于哪个 IP 地址上？

如果我没记错的话，您可以在 IIS 6 中按 IP 对域视图进行排序，这对我查看可用的 IP 有很大帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-29T02:17:16.710

看看[APPCMD](http://learn.iis.net/page.aspx/114/getting-started-with-appcmdexe/#HowToUse)。

例如，要列出机器上的所有站点，请使用以下命令行：

```
 %systemroot%\system32\inetsrv\APPCMD list sites 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T13:45:35.617

你可以试试这个脚本：

```
MachineName = "localhost"
IIsObjectPath = "IIS://" & MachineName & "/w3svc"

WScript.Echo "Checking : " & IISObjectPath

Set IIsObject = GetObject(IIsObjectPath)
for each obj in IISObject
    if (Obj.Class = "IIsWebServer") then
        BindingPath = IIsObjectPath & "/" & Obj.Name

        Set IIsObjectIP = GetObject(BindingPath)
        wScript.Echo BindingPath & " - " & IISObjectIP.ServerComment

        ValueList = IISObjectIP.Get("ServerBindings")
                ValueString = ""
        For ValueIndex = 0 To UBound(ValueList)
            value = ValueList(ValueIndex)
            Values = split(value, ":")
            IP = values(0)
            if (IP = "") then
                IP = "(All Unassigned)"
            end if 
            TCP = values(1)
            if (TCP = "") then
                TCP = "80"
            end if 
            HostHeader = values(2)

            if (HostHeader <> "") then
                    wScript.Echo "    IP = " & IP & " TCP/IP Port = " & TCP & ", HostHeader = " & HostHeader
            else
                    wScript.Echo "    IP = " & IP & " TCP/IP Port = " & TCP 
            end if
                Next                                     
        wScript.Echo ""
        set IISObjectIP = Nothing
    end if
next
set IISObject = Nothing 
```

（来源 www.iisfaq.com）

# erlang - 有人可以解释 Erlang 中 Pid（进程标识符）的结构吗？

> ID：243363
> 
> 赞同：74
> 
> 时间：2008-10-28T13:42:21.240
> 
> 标签：erlang, pid

有人可以解释 Erlang 中 Pid 的结构吗？

Pids 看起来像这样：`<A.B.C>`, eg `<0.30.0>`，但我想知道这三个“位”的含义是什么`A`：`B`和`C`。

`A`似乎总是`0`在本地节点上，但是当 Pid 的所有者位于另一个节点上时，此值会发生变化。

是否可以仅使用 Pid 在远程节点上直接发送消息？类似的东西：`<4568.30.0> ! Message`，而不必显式指定注册进程的名称和节点名称（ `{proc_name, Node} ! Message`）？

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2008-11-04T15:29:26.680

打印的进程 ID <ABC> 由[6](http://github.com/mfoemmel/erlang-otp/blob/R13B/erts/emulator/beam/erl_term.h#L502)组成：

*   A、节点号（0为本地节点，远程节点为任意数字）
*   B、进程号的前15位（进程表的索引）[7](http://github.com/mfoemmel/erlang-otp/blob/R13B/erts/emulator/beam/erl_term.h#L534)
*   C、进程号的第16-18位（与B相同的进程号）[7](http://github.com/mfoemmel/erlang-otp/blob/R13B/erts/emulator/beam/erl_term.h#L534)

在内部，进程号在 32 位仿真器上为 28 位宽。B 和 C 的奇怪定义来自 R9B 和早期版本的 Erlang，其中 B 是一个 15 位进程 ID，C 是一个包装计数器，当达到最大进程 ID 并重用较低的 ID 时，该计数器会递增。

在 erlang 分布中，PID 稍大一些，因为它们包括节点原子以及其他信息。（[分布式PID格式](http://erlang.org/doc/apps/erts/erl_ext_dist.html#8.8)）

当一个内部 PID 从一个节点发送到另一个节点时，它会自动转换为外部/分布式 PID 形式，因此一个节点上的`<0.10.0>`( `inet_db`) 可能最终与`<2265.10.0>`发送到另一个节点时一样。您可以像往常一样发送到这些 PID。

```
% get the PID of the user server on OtherNode
RemoteUser = rpc:call(OtherNode, erlang,whereis,[user]), 

true = is_pid(RemoteUser),

% send message to remote PID
RemoteUser ! ignore_this, 

% print "Hello from <nodename>\n" on the remote node's console.
io:format(RemoteUser, "Hello from ~p~n", [node()]). 
```

更多信息请参见：[内部 PID 结构](http://github.com/mfoemmel/erlang-otp/tree/5b6dd0e84cf0f1dc19ddd05f86cf04b2695d8a9e/erts/emulator/beam/erl_term.h#L498)、 [节点创建信息](http://github.com/mfoemmel/erlang-otp/tree/5b6dd0e84cf0f1dc19ddd05f86cf04b2695d8a9e/erts/emulator/beam/erl_node_container_utils.h#L24)、 [节点创建计数器与 EPMD 的交互](http://erlang.2086793.n4.nabble.com/PID-recycling-td2108252.html#a2108255)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-28T15:09:17.977

如果我没记错的话，格式是`<nodeid,serial,creation>`. 0 是当前节点，就像计算机始终使用主机名“localhost”来引用自身一样。这是旧记忆，所以它可能不是 100% 正确的。

但是，是的。例如，您可以构建 pid `list_to_pid/1`。

```
PidString = "<0.39.0>",
list_to_pid(PidString) ! message. 
```

当然。您只需使用您需要使用的任何方法来构建您的 PidString。可能编写一个生成它的函数并使用它而不是像这样的 PidString：

```
list_to_pid( make_pid_from_term({proc_name, Node}) ) ! message 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-30T23:17:12.320

进程id<ABC>组成：

*   A，节点 id 不是任意的，而是 dist_entry 中该节点的内部索引。（它实际上是节点名称的原子槽整数。）
*   B、进程索引，即proctab中的内部索引，(0 -> MAXPROCS)。
*   C，每次达到 MAXPROCS 时增加的序列号。

2位的创建标签不显示在pid中，而是在内部使用，每次节点重启时都会增加。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-28T14:24:20.830

PID 指的是一个进程和一个节点表。因此，您只能将消息直接发送到 PID，前提是它在您进行调用的节点中是已知的。

[如果您从中进行调用的节点已经知道](http://www.erlang.org/doc/reference_manual/part_frame.html)进程正在运行的节点，那么这可能会起作用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-02-16T13:14:14.157

除了其他人所说的之外，您可能会发现这个简单的实验有助于了解内部发生的情况：

```
1> node().
nonode@nohost
2> term_to_binary(node()).
<<131,100,0,13,110,111,110,111,100,101,64,110,111,104,111,
  115,116>>
3> self().                
<0.32.0>
4> term_to_binary(self()).
<<131,103,100,0,13,110,111,110,111,100,101,64,110,111,104,
  111,115,116,0,0,0,32,0,0,0,0,0>> 
```

因此，您可以将节点名称内部存储在 pid 中。更多信息[请](http://learnyousomeerlang.com/distribunomicon#setting-up-an-erlang-cluster)参阅Learn You Some Erlang。

# c++ - 在 C++ 中动态创建对象

> ID：243365
> 
> 赞同：2
> 
> 时间：2008-10-28T13:43:35.263
> 
> 标签：c++, serialization

我只是在阅读这个[帖子](https://stackoverflow.com/questions/243082/c-casting-programmatically-can-it-be-done)，我突然想到 OP 所询问的那种模式似乎有效。我知道我以前用它来实现对象的动态创建。据我所知，C++ 中没有更好的解决方案，但我想知道是否有任何大师知道更好的方法。通常，当我需要基于编译时未知的事物（例如基于配置文件）创建对象的几个子类之一时，我会遇到这种情况。一旦创建了对象，我就会多态地使用它。

当您使用消息传递方案（通常通过 TCP/IP）时，还有另一种相关情况，其中每条消息都是一个对象。我喜欢将这种模式实现为让每条消息将自己序列化为某个序列化流接口，这在发送端运行良好并且相当干净，但在接收端，我总是发现自己检查消息上的标头以确定类型，然后使用链接文章中的模式构造一个适当的消息对象，然后让它从流中反序列化自己。有时我实现它以便构造和反序列化作为构造函数的一部分同时发生，这似乎更 RAII，但这对于找出类型的 if/else 语句的混乱来说是一个小小的安慰。

有没有更好的解决方案？如果您要推荐一个 3rd 方库，它应该是免费的（最好是开源的），如果您能解释一下该库是如何实现这一壮举的，我将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T13:53:06.883

您在此处描述的称为[工厂](http://en.wikipedia.org/wiki/Factory_method_pattern)模式。一个变体是[建造者](http://en.wikipedia.org/wiki/Builder_pattern)模式。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-28T14:32:24.883

我认为您要问的是如何将对象创建代码与对象本身一起保存。

这通常是我所做的。它假定有一些键可以为您提供类型（int 标记、字符串等）。我创建了一个类，它有一个键到工厂函数的映射，以及一个注册函数，它接受一个键和工厂函数并将其添加到映射中。还有一个 create 函数，它接受一个键，在 map 中查找它，调用工厂函数，并返回创建的对象。例如，使用一个 int 键和一个包含其余信息的流来构建对象。我没有测试，甚至没有编译过这段代码，但它应该给你一个想法。

```
class Factory
{
    public:
    typedef Object*(*Func)(istream& is);
    static void register(int key, Func f) {m[key] = f;}
    Object* create(key, istream& is) {return m[key](is);}
    private:
    std::map<key, func> m;
} 
```

然后在从子对象派生的每个类中，使用适当的键和工厂方法调用 register() 方法。

要创建对象，您只需要这样的东西：

```
while(cin)
{
    int key;
    is >> key;
    Object* obj = Factory::Create(key, is);
    // do something with objects
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-28T13:53:27.863

我建议阅读[有关序列化和反序列化的 C++ FAQ Lite 问题](http://www.parashift.com/c++-faq-lite/serialization.html)。

那里有很多细节，我无法在我的答案中轻松总结，但这些常见问题解答确实涵盖了创建其类型仅在运行时知道的对象。

尤其：

[#36.8](http://www.parashift.com/c++-faq-lite/serialization.html#faq-36.8)

虽然，在最基本的层面上，您可以实现一个类似于以下内容的工厂：

```
Base* Base::get_object(std::string type)
{
    if (type == "derived1") return new Derived1;
    if (type == "derived2") return new Derived2;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T14:03:53.850

阅读经典[的四人帮（又名 GOF](https://rads.stackoverflow.com/amzn/click/com/0201633612)）。考虑 [this site[( [http://www.dofactory.com/Patterns/PatternAbstract.aspx](http://www.dofactory.com/Patterns/PatternAbstract.aspx) ) 的工厂和 C# 中的其他模式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T14:12:50.663

除非我遗漏了什么，否则您不需要 static_cast 来创建一个对象，其运行时类型是您应该从工厂返回的类型的子类，然后以多态方式使用它：

```
class Sub1 : public Super { ... };
class Sub2 : public Super { ... };

Super *factory(int param) {
    if (param == 1) return new Sub1();
    if (param == 2) return new Sub2();
    return new Super();
}

int main(int argc, char **argv) {
    Super *parser = factory(argc);
    parser->parse(argv); // parse declared virtual in Super
    delete parser;
    return 0;
} 
```

OP 在您提到的问题中谈论的模式是从某处获取 Super*，然后通过检查 RTTI 并为程序员已知的所有子类设置 if/else 子句，将其转换为运行时类型。这与“我在创建对象后多态地使用对象”完全相反。

理论上，我首选的反序列化方法是责任链：编写能够查看序列化数据（包括类型标头）并自行决定是否可以从中构造对象的工厂。为了提高效率，让工厂注册他们感兴趣的类型，所以他们不会都查看每个传入的对象，但我在这里省略了：

```
Super *deserialize(char *data, vector<Deserializer *> &factories>) {
    for (int i = 0; i < factories.size(); ++i) { // or a for_each loop
        Super *result = factories[i]->deserialize(data);
        if (result != NULL) return result;
    }
    throw stop_wasting_my_time_with_garbage_data();
} 
```

在实践中，我经常最终写一个大开关，像这样只有一个枚举类型，一些命名常量，也许还有一个在构造后调用的虚拟反序列化方法：

```
Super *deserialize(char *data) {
    uint32_t type = *((uint32_t *)data); // or use a stream
    switch(type) {
        case 0: return new Super(data+4);
        case 1: return new Sub1(data+4);
        case 2: return new Sub2(data+4);
        default: throw stop_wasting_my_time_with_garbage_data();
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T20:17:25.623

工厂模式的基本操作是将标识符映射到特定类型的（通常是新的）实例，其中类型取决于标识符的某些属性。如果你不这样做，那么它就不是工厂。其他一切都是品味问题（即性能、可维护性、可扩展性等）。

# excel - 重置 Excel“查找和替换”对话框参数

> ID：243368
> 
> 赞同：4
> 
> 时间：2008-10-28T13:44:48.567
> 
> 标签：excel, vba

如何以编程方式将 Excel`Find and Replace`对话框参数重置为默认值（“查找内容”、“替换为”、“内部”、“搜索”、“查找范围”、“匹配大小写”、“匹配整个单元格内容”）？

我正在使用`Application.FindFormat.Clear`and`Application.ReplaceFormat.Clear`来重置查找和替换单元格格式。

有趣的是，使用 后`expression.Replace(FindWhat, ReplaceWhat, After, MatchCase, WholeWords)`，`FindWhat`字符串显示在`Find and Replace`对话框中，但不显示`ReplaceWhat`参数。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-01-13T23:15:13.593

您可以使用此宏来重置查找和替换。不幸的是，您必须同时调用它们，因为每个参数都有一个或两个唯一的参数，因此如果您想重置所有内容，那么您就会陷入困境。没有“重置”，所以我发现的唯一方法是使用默认参数执行虚假查找和替换。

```
Sub ResetFind()
    Dim r As Range

    On Error Resume Next  'just in case there is no active cell
    Set r = ActiveCell
    On Error Goto 0

    Cells.Find what:="", _
               After:=ActiveCell, _
               LookIn:=xlFormulas, _
               LookAt:=xlPart, _
               SearchOrder:=xlByRows, _
               SearchDirection:=xlNext, _
               MatchCase:=False, _
               SearchFormat:=False
    Cells.Replace what:="", Replacement:="", ReplaceFormat:=False

    If Not r Is Nothing Then r.Select
    Set r = Nothing
End Sub 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T23:38:11.240

您可以使用以下命令打开填充字段的“替换”对话框：

**Application.Dialogs(xlDialogFormulaReplace).Show -arguments here-**

参数列表是

find_text、replace_text、look_at、look_by、active_cell、match_case、match_byte

* * *

到目前为止，我发现“单击”按钮的唯一方法是使用 SendKey。

* * *

经过大量的研究和测试，我现在确切地知道你想做什么，但不认为它可以完成（没有 SendKey）。Excel 中似乎存在一个错误，无论您尝试将其设置为什么，都不会重置替换值（来自 VBA）。

我确实发现有人在 MSDN 上发布了这种“更快”的方式，所以你可以试一试。

[**比替换更快**](http://social.msdn.microsoft.com/Forums/en-US/vsto/thread/293217af-6c12-4ed2-9021-8eefa71aa98a/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-09-26T14:42:22.773

无需使用 sendkeys 即可轻松引用重置对话框值所需的值。

```
Sub ResetFindReplace()
   'Resets the find/replace dialog box options
   Dim r As Range

   On Error Resume Next

   Set r = Cells.Find(What:="", _
   LookIn:=xlFormulas, _
   SearchOrder:=xlRows, _
   LookAt:=xlPart, _
   MatchCase:=False)

   On Error GoTo 0

   'Reset the defaults

   On Error Resume Next

   Set r = Cells.Find(What:="", _
   LookIn:=xlFormulas, _
   SearchOrder:=xlRows, _
   LookAt:=xlPart, _
   MatchCase:=False)

   On Error GoTo 0
End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-12-13T13:02:37.920

我对此进行了测试，并且可以正常工作。我从几个地方借了零件

```
Sub RR0()   'Replace Reset & Open dialog  (specs: clear settings, search columns, match case)

'Dim r As RANGE         'not seem to need
'Set r = ActiveCell     'not seem to need
On Error Resume Next    'just in case there is no active cell
On Error GoTo 0

Application.FindFormat.Clear          'yes
Application.ReplaceFormat.Clear       'yes

Cells.find what:="", After:=ActiveCell, LookIn:=xlFormulas, LookAt:=xlPart, SearchOrder:=xlByColumns, SearchDirection:=xlNext
Cells.Replace what:="", Replacement:="", ReplaceFormat:=False, MatchCase:=True    'format not seem to do anything
'Cells.Replace what:="", Replacement:="", ReplaceFormat:=False    'orig, wo matchcase not work unless put here - in replace

'If Not r Is Nothing Then r.Select    'not seem to need
'Set r = Nothing

'settings choices:
'match entire cell:  LookAt:=xlWhole,  or:  LookAt:=xlPart,
'column or row:      SearchOrder:=xlByColumns,  or:  SearchOrder:=xlByRows,

Application.CommandBars("Edit").Controls("Replace...").Execute   'YES WORKS
'Application.CommandBars("Edit").Controls("Find...").Execute   'YES same, easier to manipulate
'Application.CommandBars.FindControl(ID:=1849).Execute        'YES full find dialog

'PROBLEM: how to expand options?
'SendKeys ("%{T}")   'alt-T works the first time, want options to stay open

Application.EnableEvents = True           'EVENTS

End Sub 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-10-13T19:20:25.960

Dave Parillo 的解决方案非常好，但它不会重置 Excel 的“查找替换”对话框的格式选项。以下更彻底，并确实重置了这些选项。

```
Sub ResetFindAndReplace()
    Dim oldActive As Range, oldSelection As Range
    On Error Resume Next  ' just in case there is no active cell
    Set oldActive = ActiveCell
    Set oldSelection = Selection
    On Error GoTo 0   
    Cells.Find what:="", _
               After:=ActiveCell, _
               LookIn:=xlFormulas, _
               LookAt:=xlPart, _
               SearchOrder:=xlByRows, _
               SearchDirection:=xlNext, _
               MatchCase:=False, _
               SearchFormat:=False
    Cells.Replace what:="", Replacement:="", ReplaceFormat:=False
    Application.FindFormat.Clear
    ' return selection cell
    If Not oldSelection Is Nothing Then oldSelection.Select 
    ' return active cell
    If Not oldActive Is Nothing Then oldActive.Activate
    Set oldActive = Nothing
End Sub 
```

# python - 使用 POST 在网页中包含动态图像？

> ID：243375
> 
> 赞同：2
> 
> 时间：2008-10-28T13:46:35.477
> 
> 标签：python, html, django, cgi, image

我编写了一个使用 GET 数据动态创建图像的 CGI 脚本。要将此图像包含在我的网页中，我使用以下代码：

```
<img src="image.py?text=xxxxxxxxxxxxxx"> 
```

问题是我希望将来“文本”字段会变得很长，并且 URL 会变得太大。从谷歌搜索那里似乎没有对 URL 长度的固定限制（即取决于浏览器、服务器、代理等）。有没有更好的方法来做到这一点？

如果重要的话，我正在使用 Django 和 Python，我不能使用任何客户端脚本（即 JavaScript）。

干杯，本

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T13:52:34.450

将文本存储在某处（例如数据库），然后通过主键传递。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T14:22:51.690

这将为您提供一个 POST 的图像——您可能不喜欢它

1.  将 iFrame 放在您想要图像的位置并调整大小并删除滚动条
2.  将 src 设置为一个表单，其中隐藏输入设置为您的帖子参数，操作设置为将生成图像的 URL
3.  在 iFrame 的 HTML 的 body.onload 中使用 JavaScript 自动提交表单

    然后，要么：

4.  将内容类型集返回到图像并流式传输图像字节

    或者：

5.  将 post 参数存储在某处并生成一个小 id

6.  使用 url 中的 id 提供带有 img 标签的 HTML -- 在服务器上查找 post 参数

    或者：

7.  生成带有嵌入图像的图像标签的页面

    [http://danielmclaren.net/2008/03/embedding-base64-image-data-into-a-webpage](http://danielmclaren.net/2008/03/embedding-base64-image-data-into-a-webpage)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T14:24:46.490

将已经说过的内容放在一起，创建两个页面怎么样。第一个页面在提交表单时发送一个 POST 请求（可以说是 create_img.py），并带有 text=xxxxxxx... 参数。然后 create_img.py 接受 text 参数并用它创建一个图像并将其（或文件系统引用）插入到数据库中，然后在渲染第二页时，生成 img 标签，如`<img src="render_img.py?row_id=0122">`. 此时，render_img.py 只是查询给定图像的数据库。在创建图像之前，您可以检查它是否已经在数据库中，因此使用相同的文本参数重用/回收以前的图像。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T13:52:14.857

img 使用 GET。你必须想出另一种机制。如何在 image.py 中调用相同的功能并将文件保存为您在 img 标签中引用的临时文件？或者如何在这个 img 标签的呈现过程中将文本的值保存在 db 行中，并使用 row_id 作为传递给 image.py 脚本的内容？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T14:28:54.843

您可以通过压缩 get 参数中的文本来缓解问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T14:48:08.097

从下面的链接看起来你会没事的一段时间;）

[http://www.boutell.com/newfaq/misc/urllength.html](http://www.boutell.com/newfaq/misc/urllength.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-28T16:05:39.690

如果您使用的是 django，也许您可​​以通过模板标签来代替？

就像是：

```
<img src="{% create_image "This is the text that will be displayed" %}"> 
```

create_image 函数将使用虚拟/随机/生成的文件名创建图像，并返回路径。

这避免了必须 GET 或 POST 到脚本，并且图像将具有可管理的文件名。

我可以看到这种方法的一些潜在问题，我只是把这个想法扔在那里；）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-27T01:05:49.193

好的，我参加聚会有点晚了，但您可以混合使用 MHTML（适用于 IE7 及更低版本）和数据 URI 方案（适用于所有其他现代浏览器）。它确实需要在客户端和服务器上进行一些工作，但您最终可以得到

```
newimg.src = 'blah'; 
```

有关如何执行此操作的文章位于[http://gingerbbm.com/?p=127](http://gingerbbm.com/?p=127)。

# c++ - 在将大型 C++ 程序从 VS2005 转换为 VS2008 之前我应该 知道什么？

> ID：243381
> 
> 赞同：5
> 
> 时间：2008-10-28T13:49:29.730
> 
> 标签：c++, visual-studio, visual-c++

在将大型 C++ 程序从 VS2005 转换为 VS2008 之前，有什么我应该知道的吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-28T14:37:12.223

我现在正在解决这个问题。

*运行 WinMerge 以查看我所做的更改...*

好的，这是我必须在一个巨大的 Win32/MFC 客户端应用程序中修复的问题：

一些 MFC 功能已成为虚拟功能（如果我没记错的话，这些功能在过去是没有的 - CWnd::GetMenu 就是其中之一）。还有一些与我们的旧鼠标滚轮支持相关的东西（在 Windows 内置鼠标滚轮支持之前）不知何故坏了（我刚刚删除了这个功能，所以我从来没有真正弄清楚为什么会坏）。

一些 ATL 方法（或方法参数）已更改为 const 原本不是的（搞砸了我的覆盖）。

平台 SDK 较新 - 如果您正确设置 Windows SDK 版本#defines，请小心（我们并非在所有地方 - 这很愚蠢）。您现在可能正在使用更新版本 (Vista/2008) 的 Win32 结构进行构建。这在我的 XP 盒子上并没有那么好用。

STDMETHOD 现在包括 __declspec(nothrow) ，这是 100% 正确的——除了这在我们的代码中发现了一些问题。某些编写的接口会通过 COM 公开，但从未公开，会引发异常。

IDE 有一个[错误](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=366060&wa=wsignin1.0)，如果您没有设置断点以突出显示整行（我*认为*这是 VC++ 的默认设置，也许？），禁用的断点不会在空白处显示空心圆圈。

大多数这些问题是由于我们的代码中的细微错误或 MFC/ATL 库的过度重载造成的。由于其他人的代码都是完美的，你应该没问题；）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T14:10:04.257

在我的工作中，我们将一个大型 C++ 项目从 VS2005 转换为 VS2008。根本没有问题。不用说，您绝对应该保留旧项目的副本以防万一。:)

编辑：我应该提到该项目是独立于平台的，并且没有 gui 组件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T20:00:41.507

如果您必须支持旧平台，请注意：VC2008 是第一个[不能针对 Win9x 或 NT4](https://stackoverflow.com/questions/213711/does-visual-studio-2008-support-windows-98)的版本。出于这个原因，我的公司必须坚持使用 VC2005。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T14:14:27.103

如果您的项目正在使用 MFC，那么您应该知道它在 2008 年有一个相当大的更新，这可能会破坏一些事情。主要是安全和 UI 更新，所以在我看来还是值得做的。

有关 VS 2008 中更改内容的更多一般信息，请参见[此处](http://msdn.microsoft.com/en-us/library/bb386063.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T14:12:35.143

我最近将一个使用 VC++5 编写的项目转换为 VS2008，这是我 10 年来没有接触过的。我刚刚加载了项目并让VS2008转换它。一切都很顺利。（项目现在在这里： http: [//www.codeplex.com/Uptime](http://www.codeplex.com/Uptime)）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T14:41:50.467

根据我们的经验，项目转换得很好。我们遇到的唯一代码更改是删除了 _MIN 和 _MAX - 我们必须将其更改为 std::min() 等。我们的 MFC 内容编译正常。我们最头疼的是获得我们购买的第三方库的 VS 2008 版本，以及构建大型开源包（如 boost、OpenSceneGraph 和 GDAL）的 VS 2008 版本。不是火箭科学——只是有点乏味。[我在我的博客上](http://brianstewart.wordpress.com/2008/08/29/upgrading-to-visual-studio-2008/)写了一个简短的概要。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-28T14:01:06.117

您不能简单地重新编译的语法有什么不同吗？VS 会自动为你转换 .sln 和 vcproj 文件。其余的只是代码，除非你在做一些非常奇怪的事情，否则它应该按原样重新编译。

# c++ - 为什么不能用 LR(1) 解析器解析 C++？

> ID：243383
> 
> 赞同：157
> 
> 时间：2008-10-28T13:49:52.053
> 
> 标签：c++, parsing, grammar, formal-languages

我正在阅读解析器和解析器生成器，并在维基百科的 LR parsing -page 中找到了这个语句：

> 可以使用 LR 解析器的某些变体来解析许多编程语言。一个值得注意的例外是 C++。

为什么会这样？C++ 的哪些特殊属性导致无法使用 LR 解析器进行解析？

使用google，我只发现可以用LR（1）完美解析C，但C ++需要LR（∞）。

* * *

## 回答 #1

> 赞同：241
> 
> 时间：2009-06-17T02:01:10.477

LR 解析器在设计上无法处理模棱两可的语法规则。（早在 1970 年代，当想法被制定出来时，这个理论就变得更容易了）。

C 和 C++ 都允许以下语句：

```
x * y ; 
```

它有两种不同的解析：

1.  它可以是 y 的声明，作为指向类型 x 的指针
2.  它可以是 x 和 y 的乘积，丢弃答案。

现在，您可能会认为后者是愚蠢的，应该被忽略。大多数人会同意你的看法；但是，在某些情况下它可能会产生副作用（例如，如果乘法重载）。但这不是重点。关键是有*两种*不同的解析，因此一个程序可能意味着不同的东西，这取决于它*应该*如何被解析。

编译器必须在适当的情况下接受适当的一个，并且在没有任何其他信息（例如，x 的类型的知识）的情况下必须收集两者以便决定以后做什么。因此，语法必须允许这一点。这使得语法模棱两可。

因此纯 LR 解析无法处理这个问题。许多其他广泛可用的解析器生成器，例如 Antlr、JavaCC、YACC 或传统的 Bison，甚至 PEG 样式的解析器，也不能以“纯”方式使用。

还有很多更复杂的情况（解析模板语法需要任意前瞻，而 LALR(k) 最多可以前瞻 k 个标记），但只需要一个反例就可以击倒*纯*LR（或其他）解析。

大多数真正的 C/C++ 解析器通过使用某种确定性解析器和一个额外的技巧来处理这个示例：它们将解析与符号表集合交织在一起......所以当遇到“x”时，解析器知道 x 是否是一个类型或不，因此可以在两个潜在的解析之间进行选择。但是执行此操作的解析器不是上下文无关的，而 LR 解析器（纯解析器等）（充其量）是上下文无关的。

可以作弊，并在 LR 解析器中添加按规则缩减时间的语义检查来消除歧义。（此代码通常并不简单）。大多数其他解析器类型都有一些方法可以在解析的各个点添加语义检查，可以用来执行此操作。

如果你作弊得够多，你可以让 LR 解析器为 C 和 C++ 工作。GCC 家伙做了一段时间，但放弃了手动编码解析，我认为是因为他们想要更好的错误诊断。

不过，还有另一种方法，它既漂亮又干净，并且可以很好地解析 C 和 C++，而无需任何符号表骇客：[GLR 解析器](http://en.wikipedia.org/wiki/GLR_parser)。这些是完全无上下文的解析器（具有有效的无限前瞻）。GLR 解析器简单地接受*这两种*解析，产生一个表示模糊解析的“树”（实际上是一个主要类似于树的有向无环图）。解析后传递可以解决歧义。

我们在 DMS Software Reengineering Tookit 的 C 和 C++ 前端使用了这种技术（截至 2017 年 6 月，这些工具在 MS 和 GNU 方言中处理完整的 C++17）。它们已被用于处理数百万行大型 C 和 C++ 系统，通过完整、精确的解析生成具有完整源代码详细信息的 AST。（请参阅[AST 了解 C++ 最令人头疼的解析。](https://stackoverflow.com/a/17393852/120163)）

* * *

## 回答 #2

> 赞同：96
> 
> 时间：2008-10-28T14:01:47.253

[Lambda the Ultimate](http://lambda-the-ultimate.org/)上有一个有趣的线程，讨论了[C++ 的 LALR 语法](http://lambda-the-ultimate.org/node/2158#comment-27800)。

它包括一个[博士论文](http://www.computing.surrey.ac.uk/research/dsrg/fog/FogThesis.pdf)的链接，其中包括对 C++ 解析的讨论，其中指出：

> “C++ 语法是模棱两可的，依赖于上下文的，并且可能需要无限前瞻来解决一些歧义”。

它继续给出了一些例子（见 pdf 的第 147 页）。

例子是：

```
int(x), y, *const z; 
```

意义

```
int x;
int y;
int *const z; 
```

相比于：

```
int(x), y, new int; 
```

意义

```
(int(x)), (y), (new int)); 
```

（逗号分隔的表达式）。

这两个标记序列具有相同的初始子序列，但解析树不同，这取决于最后一个元素。在消除歧义之前可以有任意多个标记。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2013-02-13T11:37:38.247

这个问题从来没有像这样定义，而它应该很有趣：

为了让“非上下文无关”的 yacc 解析器能够完美解析这个新语法，对 C++ 语法进行的最小修改是什么？（仅使用一个“hack”：类型名/标识符消歧，解析器通知每个 typedef/class/struct 的词法分析器）

我看到几个：

1.  `Type Type;`禁止。声明为类型名的标识符不能成为非类型名标识符（请注意，这`struct Type Type`不是模棱两可的，仍然可以允许）。

    有 3 种类型`names tokens`：

    *   `types`: 内置类型或由于 typedef/class/struct
    *   模板函数
    *   标识符：函数/方法和变量/对象

    将模板函数视为不同的标记解决了`func<`歧义。如果`func`是模板函数名，则`<`必须是模板参数列表的开头，否则`func`是函数指针并且`<`是比较运算符。

2.  `Type a(2);`是一个对象实例化。 `Type a();`并且`Type a(int)`是函数原型。

3.  `int (k);` 完全禁止，应该写`int k;`

4.  `typedef int func_type();` 并且 `typedef int (func_type)();`被禁止。

    函数 typedef 必须是函数指针 typedef ：`typedef int (*func_ptr_type)();`

5.  模板递归限制为 1024，否则可以将增加的最大值作为选项传递给编译器。

6.  `int a,b,c[9],*d,(*f)(), (*g)()[9], h(char);` 也可以被禁止，取而代之 `int a,b,c[9],*d;` `int (*f)();`

    `int (*g)()[9];`

    `int h(char);`

    每个函数原型或函数指针声明一行。

    一个高度首选的替代方法是更改​​糟糕的函数指针语法，

    `int (MyClass::*MethodPtr)(char*);`

    被重新语法化为：

    `int (MyClass::*)(char*) MethodPtr;`

    这与演员表操作员一致 `(int (MyClass::*)(char*))`

7.  `typedef int type, *type_ptr;` 也可能被禁止：每个 typedef 一行。这样就会变成

    `typedef int type;`

    `typedef int *type_ptr;`

8.  `sizeof int`, `sizeof char`,`sizeof long long`和公司。可以在每个源文件中声明。因此，每个使用该类型的源文件`int`都应该以

    `#type int : signed_integer(4)`

    并且`unsigned_integer(4)`在该指令之外将被禁止，这将是向许多 C++ 头文件中存在`#type` 的愚蠢歧义迈出的一大步`sizeof int`

如果遇到使用歧义语法的 C++ 源代码，实现重新语法化的 C++ 的编译器将移动`source.cpp`一个`ambiguous_syntax`文件夹，并`source.cpp`在编译之前自动创建一个明确的翻译。

如果您知道一些，请添加您的模棱两可的 C++ 语法！

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-09-02T02:05:41.423

正如您在我的[回答](https://stackoverflow.com/questions/1172939/is-any-part-of-c-syntax-context-sensitive/1173038#1173038)中看到的，C++ 包含无法由 LL 或 LR 解析器确定性解析的语法，因为类型解析阶段（通常是解析后）改变了*操作的顺序*，因此 AST 的基本形状（通常期望由第一阶段解析提供）。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-28T14:05:08.370

我认为你非常接近答案。

LR(1) 意味着从左到右的解析只需要一个标记来预测上下文，而 LR(∞) 意味着无限的前瞻。也就是说，解析器必须知道即将到来的所有内容才能确定它现在在哪里。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2018-08-17T14:59:10.853

C++ 中的“typedef”问题可以使用 LALR(1) 解析器进行解析，该解析器在解析时构建符号表（不是纯 LALR 解析器）。“模板”问题可能无法用这种方法解决。这种 LALR(1) 解析器的优点是语法（如下所示）是 LALR(1) 语法（没有歧义）。

```
/* C Typedef Solution. */

/* Terminal Declarations. */

   <identifier> => lookup();  /* Symbol table lookup. */

/* Rules. */

   Goal        -> [Declaration]... <eof>               +> goal_

   Declaration -> Type... VarList ';'                  +> decl_
               -> typedef Type... TypeVarList ';'      +> typedecl_

   VarList     -> Var /','...     
   TypeVarList -> TypeVar /','...

   Var         -> [Ptr]... Identifier 
   TypeVar     -> [Ptr]... TypeIdentifier                               

   Identifier     -> <identifier>       +> identifier_(1)      
   TypeIdentifier -> <identifier>      =+> typedefidentifier_(1,{typedef})

// The above line will assign {typedef} to the <identifier>,  
// because {typedef} is the second argument of the action typeidentifier_(). 
// This handles the context-sensitive feature of the C++ language.

   Ptr          -> '*'                  +> ptr_

   Type         -> char                 +> type_(1)
                -> int                  +> type_(1)
                -> short                +> type_(1)
                -> unsigned             +> type_(1)
                -> {typedef}            +> type_(1)

/* End Of Grammar. */ 
```

可以毫无问题地解析以下输入：

```
 typedef int x;
 x * y;

 typedef unsigned int uint, *uintptr;
 uint    a, b, c;
 uintptr p, q, r; 
```

LRSTAR[解析器生成器](http://lrstar.tech)读取上述语法符号并生成一个解析器，该解析器可以处理“typedef”问题，而不会在解析树或 AST 中产生歧义。（披露：我是创建 LRSTAR 的人。）

# spring - BeanFactory 与 ApplicationContext

> ID：243385
> 
> 赞同：259
> 
> 时间：2008-10-28T13:50:19.307
> 
> 标签：spring, managed-bean, applicationcontext

我对 Spring 框架还很陌生，我一直在使用它并将一些示例应用程序放在一起，以评估 Spring MVC 以用于即将到来的公司项目。到目前为止，我真的很喜欢我在 Spring MVC 中看到的东西，看起来很容易使用，并鼓励你编写对单元测试非常友好的类。

作为一个练习，我正在为我的一个示例/测试项目编写一个主要方法。我不清楚的一件事是`BeanFactory`和之间的确切区别`ApplicationContext`- 适合在哪些条件下使用？

我理解`ApplicationContext`extends `BeanFactory`，但如果我只是写一个简单的 main 方法，我需要`ApplicationContext`提供的额外功能吗？究竟提供了什么样的额外功能`ApplicationContext`？

除了回答“我应该在 main() 方法中使用哪个”之外，关于在这种情况下我应该使用哪种实现，是否有任何标准或指南？我的 main() 方法是否应该被编写为依赖于 XML 格式的 bean/应用程序配置 - 这是一个安全的假设，还是我将用户锁定在特定的东西上？

这个答案在 Web 环境中是否会发生变化 - 如果我的任何课程需要了解 Spring，他们是否更有可能需要`ApplicationContext`？

谢谢你的帮助。我知道很多这些问题可能在参考手册中得到了解答，但是如果没有用细齿梳通读手册，我很难找到这两个接口的明确细分以及每个接口的优缺点。

* * *

## 回答 #1

> 赞同：224
> 
> 时间：2008-10-28T14:04:37.687

春季文档在这方面很棒：[3.8.1。BeanFactory 还是 ApplicationContext？](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#context-introduction-ctx-vs-beanfactory). 他们有一个比较表，我将发布一个片段：

**豆厂**

*   Bean实例化/接线

**应用程序上下文**

*   Bean实例化/接线
*   自动 BeanPostProcessor 注册
*   自动 BeanFactoryPostProcessor 注册
*   方便的 MessageSource 访问（适用于 i18n）
*   应用事件发布

因此，如果您需要应用程序上下文方面提出的任何要点，您应该使用 ApplicationContext。

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2016-01-20T02:29:13.207

> Spring提供了两种IOC容器，一种是is `XMLBeanFactory`，另一种是is `ApplicationContext`。

|  | 豆厂 | 应用程序上下文 |
| --- | --- | --- |
| 注释支持 | 不 | 是的 |
| BeanPostProcessor 注册 | 手动的 | 自动的 |
| 执行 | XMLBeanFactory | 类路径/文件系统/WebXmlApplicationContext |
| 国际化 | 不 | 是的 |
| 企业服务 | 不 | 是的 |
| 应用事件发布 | 不 | 是的 |

[![在此处输入图像描述](https://i.stack.imgur.com/EweA3.jpg)](https://i.stack.imgur.com/EweA3.jpg)

*   `FileSystemXmlApplicationContext`通过完整路径加载的 Bean。
*   `ClassPathXmlApplicationContext`通过 CLASSPATH 加载的 Bean
*   `XMLWebApplicationContext`以及`AnnotationConfigWebApplicationContext`通过 Web 应用程序上下文加载的 bean。
*   `AnnotationConfigApplicationContext`从基于注释的配置中加载 Spring bean。

例子：

```
ApplicationContext applicationContext = new AnnotationConfigApplicationContext(BeansConfiguration.class); 
```

*   `ApplicationContext`是由 a 初始化`ContextLoaderListener`或`ContextLoaderServlet`在 a中定义`web.xml`并在 中定义的容器。`ContextLoaderPlugin``struts-config.xml`

**注意**：从 Spring 3.1 开始`XmlBeanFactory`不[推荐使用](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/xml/XmlBeanFactory.html)`DefaultListableBeanFactory`，而支持and `XmlBeanDefinitionReader`。

* * *

## 回答 #3

> 赞同：50
> 
> 时间：2010-02-28T03:04:00.640

`BeanFactory`对我来说，选择的主要区别`ApplicationContext`似乎是`ApplicationContext`它将预先实例化所有 bean。来自[*Spring*](https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-dependency-resolution)[文档](https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-dependency-resolution)：[_](https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#beans-dependency-resolution)

 *> 在实际创建 bean 时，Spring 会尽可能晚地设置属性并解析依赖关系。这意味着，如果在创建该对象或其依赖项之一时出现问题，则当您请求对象时，正确加载的 Spring 容器稍后会生成异常。例如，bean 会由于缺少或无效的属性而引发异常。某些配置问题的这种潜在的延迟可见性是默认情况下 ApplicationContext 实现预实例化单例 bean 的原因。以在实际需要之前创建这些 bean 的一些前期时间和内存为代价，您会在创建 ApplicationContext 时发现配置问题，而不是稍后。您仍然可以覆盖此默认行为，以便单例 bean 将延迟初始化，而不是预先实例化。

鉴于此，我最初选择`BeanFactory`用于集成/性能测试，因为我不想加载整个应用程序来测试孤立的 bean。但是——如果我错了，有人纠正我——`BeanFactory`不支持`classpath`XML 配置。因此`BeanFactory`，`ApplicationContext`每个都提供了我想要的关键功能，但两者都没有。

据我所知，文档中关于覆盖默认实例化行为的注释发生在配置中，它是每个 bean，所以我不能只在 XML 文件中设置“lazy-init”属性，或者我是坚持维护一个用于测试的版本和一个用于部署的版本。

我最终做的是扩展`ClassPathXmlApplicationContext`延迟加载 bean 以用于测试，如下所示：

```
public class LazyLoadingXmlApplicationContext extends ClassPathXmlApplicationContext {

    public LazyLoadingXmlApplicationContext(String[] configLocations) {
        super(configLocations);
    }

    /**
     * Upon loading bean definitions, force beans to be lazy-initialized.
     * @see org.springframework.context.support.AbstractXmlApplicationContext#loadBeanDefinitions(org.springframework.beans.factory.xml.XmlBeanDefinitionReader)
     */

    @Override
    protected void loadBeanDefinitions(XmlBeanDefinitionReader reader) throws IOException {
        super.loadBeanDefinitions(reader);
        for (String name: reader.getBeanFactory().getBeanDefinitionNames()) {
            AbstractBeanDefinition beanDefinition = (AbstractBeanDefinition) reader.getBeanFactory().getBeanDefinition(name);
            beanDefinition.setLazyInit(true);
        }
    }

} 
```

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2008-10-28T14:08:23.997

为了补充 Miguel Ping 的回答，[文档中的另一部分](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#context-introduction-ctx-vs-beanfactory)也回答了这个问题：

> 短版：使用 ApplicationContext ，除非您有充分的理由不这样做。对于那些正在寻找关于上述建议的“但为什么”的更深入的人，请继续阅读。

（为任何可能阅读此问题的未来 Spring 新手发布此信息）

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2010-02-27T12:04:16.480

1.  `ApplicationContext`是比更优选的方式`BeanFactory`

2.  在新的 Spring 版本`BeanFactory`中被替换为`ApplicationContext`. 但仍然`BeanFactory`存在向后兼容

3.  `ApplicationContext extends BeanFactory`并具有以下好处
    *   它支持短信的国际化
    *   它支持向注册的侦听器发布事件
    *   访问 URL 和文件等资源

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2013-06-04T07:15:46.687

**ApplicationContext：** 它加载spring配置文件中配置的spring bean，并在容器启动时管理spring bean的生命周期。它不会等到**getBean（“springbeanref”）**被调用。

**BeanFactory** 加载spring配置文件中配置的spring bean，在我们调用getBean("springbeanref")时管理spring bean的**生命**周期。所以当我们调用**getBean("springbeanref")**时spring bean生命周期开始.

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2008-11-04T18:39:56.563

我认为最好始终使用 ApplicationContext，除非您像其他人所说的那样处于移动环境中。ApplicationContext 有更多的功能，你肯定想使用诸如RequiredAnnotationBeanPostProcessor、AutowiredAnnotationBeanPostProcessor 和CommonAnnotationBeanPostProcessor 之类的PostProcessor，这将帮助你简化你的Spring 配置文件，你可以在你的bean 中使用@Required、@PostConstruct、@Resource 等注解.

即使你不使用 ApplicationContext 提供的所有东西，最好还是使用它，然后如果你决定使用一些资源东西，比如消息或后处理器，或者其他模式来添加事务建议等，你将已经有一个 ApplicationContext 并且不需要更改任何代码。

如果您正在编写一个独立的应用程序，请使用 ClassPathXmlApplicationContext 在您的主方法中加载 ApplicationContext，并获取主 bean 并调用它的 run()（或任何方法）来启动您的应用程序。如果您正在编写 Web 应用程序，请使用 web.xml 中的 ContextLoaderListener 以便它创建 ApplicationContext 并且您以后可以从 ServletContext 中获取它，无论您使用的是 JSP、JSF、JSTL、struts、Tapestry 等.

另外，请记住，您可以使用多个 Spring 配置文件，您可以通过在构造函数中列出所有文件（或在 ContextLoaderListener 的上下文参数中列出它们）来创建 ApplicationContext，或者您可以只加载一个主配置文件导入语句。您可以使用 <import resource="otherfile.xml" /> 将 Spring 配置文件导入另一个 Spring 配置文件，这在您以编程方式在 main 方法中创建 ApplicationContext 并仅加载一个 Spring 配置文件时非常有用。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2017-10-01T16:19:46.730

**BeanFactory**和**ApplicationContext**的区别如下：

1.  BeanFactory 使用延迟初始化**，但**ApplicationContext 使用急切初始化。在 BeanFactory 的情况下，bean 是在您调用 getBeans() 方法时创建的，但在 ApplicationContext 的情况下，bean 是在创建 ApplicationContext 对象时预先创建的。
2.  BeanFactory 使用语法显式提供资源对象，**但**ApplicationContext 自己创建和管理资源对象。
3.  BeanFactory 不支持国际化**，但**ApplicationContext 支持国际化。
4.  使用 BeanFactory 不支持基于注解的依赖注入，**但**ApplicationContext 支持基于注解的依赖注入。

**使用 BeanFactory：**

```
BeanFactory beanfactory = new XMLBeanFactory(new FileSystemResource("spring.xml"));
 Triangle triangle =(Triangle)beanFactory.getBean("triangle"); 
```

**使用应用程序上下文：**

```
ApplicationContext context = new ClassPathXMLApplicationContext("spring.xml")
Triangle triangle =(Triangle)context.getBean("triangle"); 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-10-28T21:02:39.840

在大多数情况下，ApplicationContext 是首选，除非您需要节省资源，例如在移动应用程序上。

我不确定是否依赖 XML 格式，但我很确定 ApplicationContext 最常见的实现是 XML 实现，例如 ClassPathXmlApplicationContext、XmlWebApplicationContext 和 FileSystemXmlApplicationContext。这是我用过的仅有的三个。

如果您正在开发 Web 应用程序，可以肯定地说您需要使用 XmlWebApplicationContext。

如果您希望您的 bean 了解 Spring，您可以让它们为此实现 BeanFactoryAware 和/或 ApplicationContextAware，因此您可以使用 BeanFactory 或 ApplicationContext 并选择要实现的接口。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2016-01-18T05:59:53.177

基本上我们可以通过两种方式创建spring容器对象

1.  使用 BeanFactory。
2.  使用应用程序上下文。

两者都是接口，

使用实现类，我们可以为 spring 容器创建对象

来到差异

豆工厂：

1.  不支持基于注解的依赖注入。

2.  不支持 I18N。

3.  默认情况下它支持延迟加载。

4.  它不允许配置多个配置文件。

例如：BeanFactory context=new XmlBeanFactory(new Resource("applicationContext.xml"));

应用程序上下文

1.  支持基于注解的依赖注入。-@Autowired, @PreDestroy

2.  支持I18N

3.  它默认支持积极加载。

4.  它允许配置多个配置文件。

例如：
ApplicationContext context=new ClasspathXmlApplicationContext("applicationContext.xml");

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2015-06-30T13:30:38.973

Bean Factory 与 Application Context 的特征矩阵[来自 spring 文档](http://docs.spring.io/spring/docs/2.5.x/reference/beans.html#context-introduction-ctx-vs-beanfactory)

[![在此处输入图像描述](https://i.stack.imgur.com/TqcgB.jpg)](https://i.stack.imgur.com/TqcgB.jpg)

[BeanFactry 和 ApplicationContext 的特性截图]

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2016-01-15T05:32:19.863

**BeanFactory**和**ApplicationContext**都是从 Spring **IOC**容器中获取 bean 的方法，但仍然存在一些差异。

**BeanFactory**是实例化、配置和管理许多 bean 的实际容器。这些 bean 通常相互协作，因此它们之间存在依赖关系。这些依赖关系反映在 BeanFactory 使用的配置数据中。

**BeanFactory**和**ApplicationContext**都是 Java 接口，ApplicationContext 扩展了 BeanFactory。它们都是使用 XML 配置文件进行的配置。简而言之，BeanFactory 提供基本的控制反转 ( **IoC** ) 和依赖注入 ( **DI** ) 功能，而 ApplicationContext 提供**高级**功能。

一个 BeanFactory 由接口“ **org.springframework.beans.factory** ”表示，其中 BeanFactory 有多个实现。

```
ClassPathResource resource = new ClassPathResource("appConfig.xml");
XmlBeanFactory factory = new XmlBeanFactory(resource); 
```

**不同之处**

1.  **BeanFactory**在调用**getBean()**方法时实例化 bean，而 ApplicationContext 在容器启动时实例化 Singleton bean，它不会等待调用 getBean()。

2.  **BeanFactory**不提供对国际化的支持，但**ApplicationContext**提供了对它的支持。

3.  **BeanFactory**与**ApplicationContext**之间的另一个区别是能够将事件发布到注册为侦听器的 bean。

4.  **BeanFactory**接口的流行实现之一是**XMLBeanFactory**而**ApplicationContext**接口的流行实现之一是**ClassPathXmlApplicationContext**。

5.  如果您使用自动布线并使用**BeanFactory** ，则需要使用 API 注册**AutoWiredBeanPostProcessor**，如果您使用 **ApplicationContext** ，您可以在 XML 中进行配置。总之**BeanFactory**可以用于测试和非生产使用，但**ApplicationContext**是功能更丰富的容器实现，应该比**BeanFactory更受青睐**

6.  **BeanFactory**默认支持**延迟**加载，**ApplicationContext**默认支持**Aggressive**加载。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2017-01-06T15:04:33.013

一种。bean factory 和 application context 之间的一个区别是前者仅在您调用 getBean() 方法时实例化 bean，而 ApplicationContext 在容器启动时实例化 Singleton bean，它不等待调用 getBean。

湾。

```
ApplicationContext context = new ClassPathXmlApplicationContext("spring.xml"); 
```

或者

```
ApplicationContext context = new ClassPathXmlApplicationContext{"spring_dao.xml","spring_service.xml}; 
```

您可以根据项目要求使用一个或多个 xml 文件。因为我在这里使用两个 xml 文件，即一个用于服务类的配置详细信息，另一个用于 dao 类。这里 ClassPathXmlApplicationContext 是 ApplicationContext 的子级。

C。BeanFactory Container 是基本容器，它只能创建对象和注入依赖。但是我们不能附加其他服务，如安全、事务、消息传递等来提供我们必须使用 ApplicationContext Container 的所有服务。

d。BeanFactory 不支持国际化，即 i18n，但 ApplicationContext 提供支持。

e. BeanFactory Container 不支持 AutoScanning (Support Annotation based dependency Injection) 的特性，但 ApplicationContext Container 支持。

F。Beanfactory Container 在请求时间之前不会创建 bean 对象。这意味着 Beanfactory Container 会延迟加载 bean。而 ApplicationContext Container 仅在加载时创建 Singleton bean 的对象。这意味着有早期加载。

G。Beanfactory Container 仅支持 bean 的两个范围（单例和原型）。但是 ApplicationContext Container 支持所有的 beans 范围。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-04-27T16:58:43.900

请参阅 Spring Docs 中的此文档：

[](http://static.springsource.org/spring/docs/3.2.x/spring-framework-reference/html/beans.html#context-introduction-ctx-vs-beanfactory)[http://static.springsource.org/spring/docs/3.2.x/spring-framework-reference/html/beans.html#context-introduction-ctx-vs-beanfactory](http://static.springsource.org/spring/docs/3.2.x/spring-framework-reference/html/beans.html#context-introduction-ctx-vs-beanfactory)

5.15.1 BeanFactory 还是 ApplicationContext？

除非您有充分的理由不这样做，否则请使用 ApplicationContext。

因为 ApplicationContext 包含 BeanFactory 的所有功能，所以通常建议在 BeanFactory 上使用它，除了少数情况，例如在 Applet 中内存消耗可能很关键并且额外的几 KB 可能会产生影响。但是，对于大多数典型的企业应用程序和系统，ApplicationContext 是您想要使用的。Spring 2.0 及更高版本大量使用 BeanPostProcessor 扩展点（以实现代理等）。如果你只使用一个普通的 BeanFactory，诸如事务和 AOP 之类的相当多的支持将不会生效，至少在你没有一些额外步骤的情况下不会生效。这种情况可能会令人困惑，因为配置实际上没有任何问题。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-02-26T06:52:30.917

ApplicationContext 是 BeanFactory 的老大哥，这将是 BeanFactory 提供的所有东西以及许多其他东西。

除了标准的 org.springframework.beans.factory.BeanFactory 生命周期功能之外，ApplicationContext 实现检测和调用 ApplicationContextAware bean 以及 ResourceLoaderAware、ApplicationEventPublisherAware 和 MessageSourceAware bean。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2016-02-26T01:19:40.357

在实时场景中，Spring IOC Core 容器（BeanFactory）和 Advanced J2EE 容器（ApplicationContext）的区别如下。

1.  `<bean></bean>`只有当您调用 .getBean() 方法时，BeanFactory 才会为 spring.xml 文件 () 中提到的 bean（即 POJO 类）创建对象，但 ApplicationContext 会为所有 bean 创建对象（`<bean></bean>`如果其范围不是在加载 spring.xml 文件本身时，在 spring.xml 中配置为“原型”。

2.  BeanFactory：（惰性容器，因为它仅在您从用户/主类显式调用时为 bean 创建对象）

    ```
    /*
     * Using core Container - Lazy container - Because it creates the bean objects On-Demand
     */
    //creating a resource
    Resource r = (Resource) new ClassPathResource("com.spring.resources/spring.xml");
    //creating BeanFactory 
    BeanFactory factory=new XmlBeanFactory(r);

    //Getting the bean for the POJO class "HelloWorld.java"
    HelloWorld worldObj1 = (HelloWorld) factory.getBean("test"); 
    ```

    ApplicationContext：（因为在加载 spring.xml 文件本身时创建了所有单例 bean 的对象，所以需要容器）

    ```
    ApplicationContext context = new ClassPathXmlApplicationContext("com/ioc/constructorDI/resources/spring.xml"); 
    ```

3.  从技术上讲，推荐使用 ApplicationContext，因为在实时应用程序中，bean 对象将在应用程序在服务器本身启动时创建。这减少了用户请求的响应时间，因为对象已经可以响应。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-03-06T07:45:08.923

我需要解释 BeanFactory 和 ApplicationContext。

**BeanFactory：** BeanFactory是访问SpringBean容器的根接口。有一个bean容器的基本客户端视图。该接口由包含 bean 定义数量的对象类实现，并且每个都由字符串名称唯一标识
根据 Bean 定义，工厂将返回实例，该实例可能是包含对象的实例或单个共享实例。将返回哪种类型的实例取决于 bean 工厂配置。
通常 Bean 工厂会加载所有的 bean 定义，这些定义存储在 XML 等配置源中。

BeanFactory 是一个最简单的容器，为依赖注入提供基本支持

**应用程序上下文** 应用程序上下文是spring应用程序中的一个中心接口，它为应用程序提供配置信息。它实现了 Bean 工厂接口。

应用程序上下文是一个高级容器，它增加了企业特定功能的高级级别，例如从属性文件解析文本消息的能力......等

ApplicationContext 提供：

用于访问应用程序组件的 Bean 工厂方法。继承自 ListableBeanFactory。以通用方式加载文件资源的能力。继承自 ResourceLoader 接口。向注册的侦听器发布事件的能力。继承自 ApplicationEventPublisher 接口。解决消息的能力，支持国际化。继承自 MessageSource 接口。从父上下文继承。后代上下文中的定义将始终具有优先权。这意味着，例如，整个 Web 应用程序可以使用单个父上下文，而每个 servlet 都有自己的子上下文，该子上下文独立于任何其他 servlet。除了标准的 BeanFactory 生命周期功能，

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2018-01-23T13:00:10.750

我认为值得一提的是，从 Spring 3 开始，如果要创建工厂，还可以使用[`@configuration`](https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/annotation/Configuration.html)注解结合适当的[`@scope`](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Scope.html)

```
@Configuration
public class MyFactory {

    @Bean
    @Scope("prototype")
    public MyClass create() {
        return new MyClass();
    }
} 
```

[`@ComponentScan`](https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/annotation/ComponentScan.html)使用注解或 xml 配置的 Spring 容器应该可以看到您的工厂

[来自 baeldung 网站的 Spring bean scopes 文章](http://www.baeldung.com/spring-bean-scopes)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-04-21T22:01:44.707

对非 Web 应用程序使用 BeanFactory，因为它只支持 Singleton 和 Prototype bean-scopes。

虽然 ApplicationContext 容器确实支持所有 bean-scopes，但您应该将它用于 Web 应用程序。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2018-07-07T17:25:12.657

总之：

**ApplicationContext**包括 BeanFactory 的所有功能。一般推荐使用前者。

有一些有限的情况，例如在移动应用程序中，内存消耗可能很关键。

在这种情况下，使用更轻量级的**BeanFactory**是合理的。但是，在大多数企业应用程序中，**ApplicationContext**是您想要使用的。

更多内容请看我的博文：

[Spring中BeanFactory和ApplicationContext的区别——来自基础的java spring博客](https://www.zoltanraffai.com/blog/difference-between-beanfactory-and-applicationcontext/)

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-06-28T15:25:56.430

**BeanFactory**是指 Spring 容器，它在运行时调用**getBean()**方法后**延迟**实例化 bean 对象。

 ****ApplicationContext**是指 spring 框架，它在部署期间**急切地实例化 bean 对象，而在运行时不调用 getBean() 方法或在此之前调用****getBean()**方法。

# http - REST 到底是什么意思？它是什么，为什么它现在变大了？

> ID：243388
> 
> 赞同：52
> 
> 时间：2008-10-28T13:50:40.397
> 
> 标签：http, rest

一世~~了解（我认为）RESTful-ness 背后的基本思想。语义上使用 HTTP 方法 - GET 获取、PUT 放置、DELETE 删除等……对吗？~~以为我理解 REST 背后的想法，但我认为我将其与 HTTP 实现的细节混淆了。休息背后的驱动理念是什么，为什么这变得很重要？人们是否真的在我的手电筒从未照过的互联网角落里使用了很长时间？

* * *

Google 演讲提到 Atom 发布协议与 RESTful 实现有很多协同作用。对此有什么想法吗？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-07-04T05:59:18.020

这就是 REST 的样子：

```
POST /user
fname=John&lname=Doe&age=25 
```

服务器响应：

```
201 Created
Location: /user/123 
```

将来，您可以检索用户信息：

```
GET /user/123 
```

服务器响应（假设是 XML 响应）：

```
200 OK
<user><fname>John</fname><lname>Doe</lname><age>25</age></user> 
```

更新：

```
PUT /user/123
fname=Johnny 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-28T15:22:47.060

这是我的看法...

制作 RESTful 服务的吸引力在于，我们不是使用数十种功能方法创建 Web 服务，而是标准化了**四种方法**（创建、检索、更新、销毁）：

*   邮政
*   得到
*   放
*   删除

REST 变得越来越流行，因为它还代表了应用层消息格式的标准化。虽然 HTTP 使用 REST 的四个基本动词，但 HTML 的常见 HTTP 消息格式并不是构建应用程序的合同。

我听到的最好的解释是 TCP/IP 与 RSS 的比较。

以太网代表物理网络上的标准化。Internet 协议 (IP) 代表了更高层次的标准化，并且有几种不同的风格（TCP、UDP 等）。“传输控制协议”（保证数据包传递）的引入定义了通信合同，为我们打开了应用层的全新服务集（FTP、Gopher、Telnet、HTTP）。

以此类推，我们采用 XML 作为“协议”，我们现在开始标准化消息格式。**RSS**正迅速成为许多 RESTful 服务的基础。Google 的 GData API 是 RSS/ATOM 变体。

“桌面小工具”很好地体现了这种炒作：一个简单的客户端可以使用通用 API 和消息传递标准来使用基本的 Web 内容或复杂的混搭。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-28T14:23:32.577

HTTP 目前使用不足和误用。

我们通常只使用 HTTP 的两种方法：GET 和 POST，但还有更多：DELETE、PUT 等（[http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html)）

因此，如果我们拥有由 RESTful URL 定义的资源（您的应用程序中的每个域对象都有唯一的 URL，形式为[http://yoursite.com/path/to/the/resource](http://yoursite.com/path/to/the/resource)）和体面的 HTTP 实现，我们可以在您的领域通过写句子：

获取[http://yoursite.com/path/to/the/resource](http://yoursite.com/path/to/the/resource)

删除[http://yoursite.com/path/to/the/resource](http://yoursite.com/path/to/the/resource)

[发布](http://yoursite.com/path/to/the/resource)http://yoursite.com/path/to/the/resource

ETC

建筑很好，一切都很好。

但这只是理论观点，在我之前的答案中发布的所有链接中都描述了现实世界的场景。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2015-09-11T02:46:57.047

让我们回到历史，谈谈 Roy Fielding 的研究——“<a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/fielding_dissertation.pdf" rel="noreferrer">建筑风格和基于网络的软件架构的设计“。它是一篇大论文，谈论了很多各种各样的东西。但是作为一名标准工程师，您想如何解释清楚 REST（Representational State Transfer）的含义，以及它的架构风格是什么。

这是我的解释方式——“什么是 REST”。

请参阅在各种硬件（例如路由器、服务器、防火墙、云基础设施、交换机、LAN、WAN）上运行的 www（万维网）。这个 www（万维网）的总体目标是分发[超媒体](https://en.wikipedia.org/wiki/Hypermedia)。这个万维网配备了各种服务，例如基于信息的服务、网站、youtube 频道、动态网站、静态网站。这个万维网使用 HTTP 协议通过客户端/服务器机制在世界范围内分发超媒体。此 HTTP 协议在 TCP/IP 或其他适当的网络堆栈之上工作。

此[HTTP 协议](http://www.w3.org/Protocols/rfc2616/rfc2616.txt)使用八种方法来管理“分发协议”或“分发架构风格”。这八种方法分别是：OPTIONS、GET、HEAD、POST、PUT、DELETE、TRACE、CONNECT。

但是在这个 HTTP 之上，Web 应用程序正在使用它自己的方式来分发超媒体，例如 Web 应用程序正在使用与客户端和服务器高度相关的 Web 服务，或者 Web 应用程序正在使用它自己设计的客户端/服务器机制的方式来制作这种基于 HTTP 的分发渠道。

[正如Roy Fielding Research](http://www.cs.colorado.edu/~kena/classes/7818/f08/lectures/lecture_9_fielding_disserta.pdf)所说，HTTP 的这八种方法 OPTIONS、GET、HEAD、POST、PUT、DELETE、TRACE、CONNECT 非常成功地在各种硬件资源和网络堆栈与客户端的基础上向世界各地提供超媒体/server 机制，我们为什么不对基于 Web 的应用程序也使用类似的策略。在此 GET、POST、DELETE 和 PUT 上使用最多。所以四种方法将超媒体传送到世界各地。

在 REST API**[架构风格](https://en.wikipedia.org/wiki/Architectural_style)**的应用程序中，Web 应用程序需要设计业务逻辑（驻留在服务器中，例如 Tomcat、Apache HTTP）与所有对象实体集（例如客户是一个实体）和可能的操作（例如“基于检索客户信息”在客户 id') 上。这些实体的那些可能的操作应该设计有四个主要的操作或方法，即创建、检索、更新、删除。这些实体称为资源，它们以 JSON 或 XML 或其他形式**呈现**或**表示。**我们有客户端（浏览器）调用创建、检索、更新、删除**（CRUD）**方法来对驻留在服务器中的此类资源执行适当的功能。

但正如**Representation**的概念所解释的那样，表示业务逻辑或对象的实体的方式。但是“状态转移”呢？

**状态转移**，它谈论从客户端到服务器的“通信状态” 。它讨论了从客户端到服务器的“状态转移”的设计，例如客户端首先调用操作“创建客户”，然后调用此操作将是客户的下一个状态或“客户”可以调用的客户状态。它的状态可能是“检索创建的客户端数据”、“更新客户端数据”或什么

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-28T13:59:55.993

REST 是一种定义和处理资源的架构。

为了更好地理解 REST，您应该查看[面向资源的架构 (ROA)](http://en.wikipedia.org/wiki/Resource_oriented_architecture)，它为实际实施 REST 架构提供了一组指导方针。

REST 不需要通过 HTTP，但它是最常见的。REST 最初是由 HTTP 的创建者之一创建的。

# visual-studio-2008 - 为什么我在创建项目时会在 Visual Studio 2008 中收到安全警告？

> ID：243408
> 
> 赞同：4
> 
> 时间：2008-10-28T13:53:34.307
> 
> 标签：visual-studio-2008

这是错误，基本上是安全警告

[警告信息 http://img357.imageshack.us/img357/7992/visualstudiowarninggr4.jpg](http://img357.imageshack.us/img357/7992/visualstudiowarninggr4.jpg)

（下面是从对话框中截取的文本） WindowsApplication4 的安全警告 __________________________I WindowsApplication4 项目文件已经过定制，当在 Microsoft Visual Studio 中打开时执行定制构建步骤可能会带来安全风险。如果此项目来自不可靠的来源，则可能会损坏您的计算机或泄露您的私人信息。更多详细信息 项目加载选项 0 加载项目以进行浏览 在 Microsoft Visual Studio 中打开项目，提高安全性。此选项允许您浏览项目的内容，但某些功能（例如 IntelliSense）会受到限制。当加载项目进行浏览时，构建、清理、发布或打开设计器等操作仍可能不安全。正常加载项目 在 Microsoft Visual Studio 中正常打开项目。如果您信任来源并了解所涉及的潜在风险，请使用此选项。Microsoft Visual Studio 不限制任何项目功能，并且不会再次提示您输入此项目。询问我此解决方案中的每个项目 OK L 取消

单击更多详细信息按钮时，会得到以下信息：

Microsoft Visual Studio ______ 在项目文件“C:\Users\mgriffiths\Documents\Visual Studio 2008\ProjectATemp\Win dowsApplication4\WindowsApplicdtion4\W in dowsApplication4.vbproj”中找到了引用该文件的项。由于此文件位于系统目录、根目录或网络共享中，因此写入此文件可能是有害的。好的

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-07-27T19:23:52.447

对于每个项目，我也遇到了这个问题。一个快速、简单的修复方法是在注册表中禁用它。对于 Visual Studio 2008，它位于：

```
HKEY_CURRENT_USER\Software\Microsoft\VisualStudio\9.0\Debugger\DisableAttachSecurityWarning

```

该值当前应为 0。将其更改为 1，您将永远不会再看到该对话框。从来没有，我的意思是**从不**，所以如果你正在加载安全警告实际上有用的项目，请小心。

对于 Visual Studio 2005，您可以在同一位置找到密钥，但将“9.0”替换为“8.0”。

如果这不起作用，您可能还需要确保存在以下两个文件夹：

```
%ProgramData%\Microsoft\Windows\开始菜单\程序\启动
%AppData%\Microsoft\Windows\开始菜单\程序\启动\

```

出于某种原因，如果 Visual Studio 2008 无法打开这些文件夹，它会报错。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-07-16T20:43:15.377

After playing around a bit (I'm using Windows XP), I found that VS resets the All Users Startup directory to C:\Documents and Settings\All Users\Start Menu\Programs\Startup. If this directory doesn't exist, it is reset to '' in the registry, and the error is displayed. Adding this directory corrected the issue. I've customized the location of my user directories, including Startup, and it doesn't seem to care about that (in Windows XP, at least).

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-09-18T03:39:57.867

我遇到了同样的问题，终于找到了一个有帮助的答案（托德的答案在这里走向了正确的方向）。查看[此线程](http://social.msdn.microsoft.com/Forums/en-US/windowsazure/thread/33a7a870-bfd1-4d1f-8715-4becca47ef77)中的响应：

> 我们开始理解问题所在。作为一种解决方法，您能否检查一下您的个人资料是否存在以下文件夹？
> 
> C:\Users(user)\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup
> 
> 如果没有，请创建它并重试。如果这不能解决您的问题，请回帖。
> 
> 我们知道它与用户配置文件不存在的 Windows 已知文件夹有关。如果上述文件夹存在，您还可以检查以确保您有以下文件夹：http: [//msdn.microsoft.com/en-us/library/bb762584 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb762584(VS.85).aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T13:57:19.493

这可能是因为您的用户“主”文件夹 (Users\LOGINNAME) 是一个映射网络共享。您可以尝试将您的项目放在另一个非网络共享文件夹中......

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-22T09:20:53.360

自定义 MSBuild 项目的某些部分时会出现安全警告。

![Visual Studio 2008 安全警告](https://i.stack.imgur.com/jV9cb.jpg)

如果您正在使用您的自定义**.targets**文件，您需要注册它 - 让 VS 知道它是一个安全的项目。

编写以下 2 个注册表项来执行此操作：

```
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\<VS_VERSION>\MSBuild\SafeImports]
"<YOUR_NAME>"="<PATH\TO\YOUR\FILE.targets>"

[HKEY_CURRENT_USER\SOFTWARE\Microsoft\VisualStudio\<VS_VERSION>Exp\Configuration\MSBuild\SafeImports]
"<YOUR_NAME>"="<PATH\TO\YOUR\FILE.targets>" 
```

其中**VS_VERSION**是 Visual Studio 版本：9.0 - Visual Studio 2008 10.0 - Visual Studio 2010 等。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-19T08:21:09.160

该安全警告对话框有几个原因：

*   项目文件包含一个或多个非标准 Import 元素。
*   项目文件覆盖一个或多个潜在不安全目标。
*   项目文件会覆盖一个或多个潜在的不安全属性。
*   项目文件定义了一个或多个潜在的不安全项。
*   项目文件包含一个或多个 UsingTask 元素。
*   项目项目位于潜在的不安全位置。

[MSDN 开发中心](http://msdn.microsoft.com/en-us/library/ms228217.aspx)提供了更多详细信息。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-28T14:01:31.733

听起来您正在运行 Vista 并且 UAC 也在运行。您是计算机的管理员吗？一种选择是停止 UAC 服务并尝试运行 VS2008 以查看是否仍然收到该消息。另一种选择是查看“C:\Users\mgriffiths”文件夹的权限以确认权限/系统设置。

让我知道这是否有帮助！联合部队

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-25T03:12:19.600

如果您的项目中没有“包含”您的 javascript 文件，VS 将找不到它。尝试对包含该文件的文件夹进行刷新。这有效地将文件包含在您的 Web 项目（或站点）中。在解决方案资源管理器中，突出显示网站项目（或站点），然后单击解决方案资源管理器工具栏上的刷新图标。

——莫尼科

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-27T00:51:14.960

我在 Windows 7 上遇到了与 VS2008 相同的问题

我创建了路径 C:\Users\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup 但它对我没有帮助。

我发现正确的文件夹是 %APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2011-04-07T17:36:48.677

以下是在 XP 上的窍门。在此对话框中：选择“正常加载项目”单选按钮。取消选中“询问我此解决方案中的每个项目”复选框。单击确定。

# java - 在本机 Hibernate 中设置 FetchMode

> ID：243409
> 
> 赞同：4
> 
> 时间：2008-10-28T13:53:48.317
> 
> 标签：java, hibernate

我需要在我的休眠映射上设置获取模式，以便在某些情况下是渴望的，而在其他情况下是懒惰的。我的默认值（通过 hbm 文件设置）为lazy="true"。如何在代码中覆盖此设置？MyClass 定义了一组 MyClass2 类型，我想将其 FetchMode 设置为 EAGER。

目前，我有类似的东西：

```
Session s = HibernateUtil.getSessionFactory().openSession();
MyClass c = (MyClass)session.get(MyClass.class, myClassID); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T14:15:30.533

你可以尝试这样的事情：（代码从我的头顶上）

```
Criteria crit = session.createCriteria(MyClass.class);
crit.add(Restrictions.eq("id", myClassId));
crit.setFetchMode("myProperty", FetchMode.EAGER);
MyClass myThingy = (MyClass)crit.uniqueResult(); 
```

不过，我相信应该使用 FetchMode.JOIN 或 FetchMode.SELECT 而不是 FetchMode.EAGER。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T15:03:10.063

如果您不使用 Criteria，那么还有一个`JOIN FETCH`关键字会急切地加载连接指定的关联。

```
session.createQuery("select p from Parent p join fetch p.children c") 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T14:34:10.480

主类中有一个静态`initialize(Object)`方法。`Hibernate`您可以使用它来强制加载您的收藏：

```
MyClass c = (MyClass)session.get(MyClass.class, myClassID);
Hibernate.initialize(c.getMySetOfMyClass2()); 
```

但是，延迟获取的默认值就是：*默认*值。您可能想要覆盖特定 Set 的映射中的惰性。

# javascript - 从 Javascript 调用的 ActionScript 中的 NetStream.pause() 问题

> ID：243415
> 
> 赞同：0
> 
> 时间：2008-10-28T13:54:46.177
> 
> 标签：javascript, actionscript-3

我正在开发一个用 MXML+ActionScript 编写的非常简单的播放器，它的函数被导出以供 HTML 页面中的简单 Javascript 调用。

下面提供了这两个代码。

对于 mp3 “路径”，所有播放、暂停、恢复和停止都可以正常工作......
对于 m4a “路径”，启动运行良好，也停止但暂停是窃听
启动 m4a 后，当我点击“暂停”它正确地停止了流。
但是，当我单击返回按钮以恢复时，它根本不会重新开始。

有人知道问题出在哪里吗？
我只使用一个简单的 Apache Web 服务器而不是真正的 Flash Streaming 服务器这一事实是它不起作用的原因吗？

在此先感谢您的帮助。

MXML+ActionScript 3

```
 <?xml version="1.0"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" creationComplete="callBacks()">
    <mx:Script>
        <![CDATA[
                import flash.events.Event;
                import flash.media.Sound;
                import flash.net.URLRequest;
                import flash.external.ExternalInterface;
                public var playingChannel:SoundChannel;
                public var playingSound:Sound;
                public var pausePosition:int=0;
                public var playingUrl:String="";
                public var codec:String="";
                public var playingStream:NetStream;

                public function playSound(url:String):void {
                    if (playingUrl!=url) {
                        if (playingUrl!="") {
                            stopSound();
                        }
                        playingUrl=url;
                        codec=playingUrl.substring(playingUrl.length-3);
                        if (codec=="m4a") {
                            var mySound:SoundTransform;
                            var connect_nc:NetConnection = new NetConnection();
                            connect_nc.connect(null);
                            playingStream=new NetStream(connect_nc);
                            playingStream.play(url);
                        }
                        else if (codec=="mp3") {
                            playingSound=new Sound(new URLRequest(url));
                            playingChannel=playingSound.play();
                        }
                    }
                    else {
                        if (codec=="m4a")
                            playingStream.pause();
                        else
                            playingChannel=playingSound.play(pausePosition);
                    }
                }
                public function pauseSound():void {
                    if (codec=="m4a")
                        playingStream.pause();
                    else if (codec=="mp3") {
                        pausePosition=playingChannel.position;
                        playingChannel.stop();
                    }
                }
                public function stopSound():void {
                    if (codec=="m4a")
                        playingStream.close();
                    else if (codec=="mp3") {
                        pausePosition=0;
                        playingChannel.stop();
                    }
                    playingUrl="";
                }
                public function callBacks():void {
                    ExternalInterface.addCallback("play",playSound);
                    ExternalInterface.addCallback("pause",pauseSound);
                    ExternalInterface.addCallback("stop",stopSound);
                }
        ]]>
    </mx:Script> 
</mx:Application> 
```

和基本的 HTML+Javascript

```
 <html>
<head>
<script src='jquery.js'></script>
<script>
    function play() {
        //alert('clicked');
        var url=$("#url").val();
        var k=url.substring(url.length-3);
        fromFlash('testFlash').play(url);
        var b=document.getElementById('pp');
        b.setAttribute('src','pauseButton.jpg');
        b.setAttribute('onclick','pause()');
    }
    function pause() {
        fromFlash('testFlash').pause();
        var b=document.getElementById('pp');
        b.setAttribute('src','playButton.jpg');
        b.setAttribute('onclick','play()');
    }
    function stop() {
        fromFlash('testFlash').stop();
        var b=document.getElementById('pp');
        b.setAttribute('src','playButton.jpg');
        b.setAttribute('onclick','play()');
    }
    function fromFlash(movieName) {
        var isIE = navigator.appName.indexOf("Microsoft") != -1;
        return (isIE) ? window[movieName] : document[movieName];
    }
</script>
</head>
<body>
<object id="testFlash" width="0" height="0">
    <param name="movie" value="player.swf"></param>
    <param name="allowFullScreen" value="true"></param>
    <embed name="testFlash" src="player.swf" type="application/x-shockwave-flash" allowfullscreen="true" width="0" height="0">
    </embed>
</object>
<input id="url"/>
<span><img id="pp" src="playButton.jpg" onclick="play()"/></span>
<span><img src="stopButton.jpg" onclick="stop()"/></span>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T19:46:54.327

我相信你想`pause()`再次打电话恢复，而不是`play()`。
根据[NetStream 文档](http://livedocs.adobe.com/flash/8/main/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Parts&file=00002564.html#wp392073)，该`pause()`方法用于暂停和恢复。

# wpf - 如何将“this”传递给 XAML 中 ObjectDataProvider 的构造函数？

> ID：243417
> 
> 赞同：2
> 
> 时间：2008-10-28T13:55:25.597
> 
> 标签：wpf, xaml, objectdataprovider

如何将“this”传递给 XAML 中 ObjectDataProvider 的构造函数。

假设我的演讲者课程是：

```
public class ApplicationPresenter(IView view){} 
```

并且我的 UserControl 实现了 IView。

我应该在下面的代码中将什么传递给 ConstructorParameters 以便 UserControl 可以使用默认构造函数创建 ApplicationPresenter？

```
<ObjectDataProvider x:Key="ApplicationPresenterDS" 
ObjectType="{x:Type Fenix_Presenters:ApplicationPresenter}" 
ConstructorParameters="{ ?? what goes here ??}" d:IsDataSource="True" /> 
```

我只需要这样做，以便我可以使用 Blend 2。我知道我可以在后面的代码中执行此操作，但如果我这样做，我无法从 Blend 中实例化该类。我也知道我可以为 ApplicationPresenter 创建一个无参数的构造函数，并将它传递给一个实现 IView 的虚拟类，但如果可能的话，我宁愿在标记中这样做。

我现在的代码是：

```
public MyUserControl()
{
    InitializeComponent();
    DataContext = new ApplicationPresenter(this); 
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T18:50:54.253

我刚开始使用 Wpf，并且误以为我应该尝试在 XAML 中做所有事情。我刚刚从[WindowsClient.net](http://windowsclient.net/)观看了一些视频，这些视频开始澄清一些事情。但是男孩这是一项复杂的技术！！！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T13:58:49.960

我不知道它是否有效，但您可以为您的用户控件命名，例如

```
x:Name="myUserCotrol" 
```

然后在绑定中使用它：

```
... ConstructorParameters="{Binding ElementName=myUserControl}" ... 
```

这可以工作

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-03T21:02:42.407

[正如Rob Relyea 在今年的 PDC 上](http://blogs.windowsclient.net/rob_relyea/archive/2008/10/31/pdc08-news-xaml-in-net-4-xaml2009-amp-system-xaml-dll.aspx)所展示的，下一版本的 XAML 将直接支持这一点（如果内存服务良好）。

# php - 处理/合并多个登录的最佳方式？

> ID：243426
> 
> 赞同：1
> 
> 时间：2008-10-28T13:58:11.990
> 
> 标签：php, security, login

这是场景：存在多个网络系统（主要是lampp / wampp），其中大多数具有单独的登录信息（有些共享）。我们正在考虑以某种方式统一它们的好处/坏处，或者至少使处理用户管理部分更容易。

由于某些系统的性质（它混合了自定义 OSS 系统、内部开发的软件和第 3 方商业软件），我们无法将所有登录屏幕统一到一个屏幕中。

传递的一个想法是一种登录大师大脑，我们可以控制所有用户名的创建、权限、停用等。这仍然会让人们不得不手动登录到每个系统，但至少会减轻管理负担用户管理更轻松。

对于此类问题，是否有任何已知的解决方案涉及（必须考虑）更改尽可能少的代码/系统？

**编辑：** **OpenID 对我们不起作用，**因为我们有不同的登录需求，有些系统我们无法直接控制它们如何处理登录过程（但我们可以控制用户/密码）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T14:20:35.750

我们所做的是将所有登录详细信息集中在一个存储库中（对我们来说是 Active Directory），然后编写 ac# 库来使用我们编写的所有语言（PHP、C、.NET 等）的包装器进行身份验证。然后在每个应用程序的适当位置编写一些胶水代码。除了我们的内部应用程序之外，我们还以这种方式成功登录了 Mediawiki、Subversion、ActiveCollab 和 Apache。

它确实涉及编写合理数量的代码，但不是荒谬的数量，它也适用于未来。我看不到比这更容易的实际解决方案。

阅读您的问题，我注意到这或多或少是您的想法，但它会起作用！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T12:00:48.713

它周围有一个很大的行业，它被称为 IAM - 身份访问管理。IAM 解决方案基本上可以满足您的需求 - 管理用户、用户权限并将其内部状态转换为众多系统。根据集成的可能性，您可能有“SSO” - 某些软件的单点登录，或者您可能有单一身份验证源。前者与后者的不同之处在于，使用 SSO 的用户需要输入一次凭据，而后者只有相同的登录名和密码组合。

此外，IAM 将尽可能地管理用户权限。例如，一个网络设备只能支持一个用户/密码。然后 IAM 解决方案会在用户请求时自动打开终端并登录；假设用户在正确的安全组中。

实施 IAM 解决方案可以大大简化系统管理。

我不能推荐任何特定的解决方案，请记住，从当前方法过渡到 IAM 需要的不仅仅是与不同软件的集成，而且还需要对企业文化进行一些改变，因为一个系统将绑定所有其他系统。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T14:18:15.287

很多人似乎都喜欢 OpenID 做这类事情。不过，我不确定它的 Intranet 功能。

另一个想法是使用您的“大脑”系统将经过身份验证的用户名作为表单帖子传递给姐妹/兄弟应用程序，然后在该系统上处理身份验证并使用发送的内容创建他们的安全票证。

希望你能找到你要找的东西！

干杯!

# asp-classic - 我使用经典的 ASP、IIS6 和 WinServer 2003 R2 得到空白页而不是错误消息

> ID：243457
> 
> 赞同：3
> 
> 时间：2008-10-28T14:05:09.493
> 
> 标签：asp-classic, error-handling, iis-6, windows-server-2003

我们有一个在 WinServer2003 R2 - IIS6 上运行的旧系统，它是使用经典 ASP 编写的。

我们需要捕获所有错误，为此，我将 IIS 配置为将 404 和 500 重定向到自定义页面（自定义错误配置），该页面将信息写入日志文件（此页面创建和管理日志）。

这是奇怪的事情：第一次发生错误时，页面被重定向并且我得到了我的日志文件条目。但是，如果再次加载此页面（我按 F5，或其他用户去那里等），浏览器会收到一个空白页面：没有错误消息并且我的自定义页面被调用过。

如果我重新启动 IIS6，我会得到相同的行为，第一次可以工作，下一次不行。

-> 向浏览器发送 ASP 错误已打开

-> 在我的资源管理器中关闭了显示友好的 http 错误

有什么想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2014-08-27T12:26:18.420

You need to ensure Server Side Debugging is not enabled in the ASP module.

Classic ASP server 500 errors are returned as 200's. An attempt is made at opening the Server Side Debug Application, that then can't be found and IIS subsequently returns a 200 response.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T14:28:23.520

尝试在运行 Fiddler ( [http://www.fiddlertool.com/Fiddler2/version.asp](http://www.fiddlertool.com/Fiddler2/version.asp) ) 或其他可以查看这里和那里发送的内容的工具时执行此操作。

还; 如果您将 IIS 设置为以 IIS 日志格式登录，则错误将显示在日志文件中以错误结尾的请求的行尾。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T05:16:51.400

也许是这个问题

[http://www.webdevbros.net/2006/11/26/ie7-bug-blank-page-white-screen-after-some-refreshs/](http://www.webdevbros.net/2006/11/26/ie7-bug-blank-page-white-screen-after-some-refreshs/)

# ios - UIWebView 将 Objective C 暴露给 JavaScript

> ID：243459
> 
> 赞同：24
> 
> 时间：2008-10-28T14:05:20.413
> 
> 标签：ios, objective-c, iphone, cocoa-touch, uiwebview

*使用iPhone SDK*时如何在 JavaScript 中公开*Objective-C*方法？*`UIWebView`*

 *任何帮助，将不胜感激！

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-28T14:19:42.647

最好的方法是通过自定义链接，然后使用 UIWebView 委托方法`-webView:shouldStartLoadWithRequest:navigationType:`来捕获请求。当您看到带有链接的请求通过时，您就知道您的操作已被触发。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-06T23:50:03.313

QuickConnectiPhone 框架中有一个示例应用程序向您展示如何执行此操作。

QuickConnectiPhone 还为您提供了一个名为“makeCall”的 JavaScript 函数。你向它传递一个命令和一个参数数组，它会将它们传递给你的应用程序的 Objective-C 端进行处理。然后，您可以进行函数调用。

您可以[在 Sourceforge 上](https://sourceforge.net/projects/quickconnect/)找到它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T04:38:36.440

要查看此示例，请查看来自 Github 的 PhoneGap 源代码：

[http://github.com/sintaxi/phonegap/tree/master/iphone/Classes/GlassAppDelegate.m](http://github.com/sintaxi/phonegap/tree/master/iphone/Classes/GlassAppDelegate.m)

# actionscript-3 - Gaia Flash 框架如何访问scaffold.as 文件？

> ID：243462
> 
> 赞同：0
> 
> 时间：2008-10-28T14:06:52.940
> 
> 标签：actionscript-3, class, external, scaffolding, gaia

在 Gaia Flash 框架中，一个名为“Scaffold.as”的文件用于使每个页面成为一个脚手架页面。这是通过代码访问的，

```
new Scaffold(this); 
```

但是该类本身似乎没有被导入。我是否遗漏了 Flash 处理外部类的方式？还是有别的东西在拉它？

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T23:26:06.680

这一切都取决于您的编译方式。我假设您正在使用 Flash IDE 进行编译。Flash 具有源路径查找机制。这可以通过 fla 访问（在 File->Publish Settings->Flash (tab)->ActionScript 下）。如果文件 Scaffold 位于类路径的根级别，则无需导入它。默认类路径包括 Flash 文件所在的目录和一些 Adob​​e 目录。有一种管理类包的机制......我认为它是旧的 Macromedia Extension Manager。它会在安装包时将类复制到默认类路径中 - 可能就是这种情况。我对盖亚本身并不熟悉。

所以有3个选项。首先，文件 Scaffold.as 与您的 fla 位于同一目录中。其次，Scaffold.as 文件位于默认的 Adob​​e 包含目录中。最后，该文件位于 fla 的类路径中引用的目录中。

# .net - 如何映射字典 使用流畅的休眠

> ID：243464
> 
> 赞同：1
> 
> 时间：2008-10-28T14:07:06.650
> 
> 标签：.net, nhibernate, fluent

我正在使用以下内容映射关系

```
<map name="Foo" cascade="all-delete-orphan" lazy="false">
  <key column="FooId"/>
  <index column="FooType" type="Domain.Enum.FooType, Domain"/>
  <element column ="FooStatus" type="Domain.Enum.FooStatus, Domain"/>
</map> 
```

课堂是这样的

```
namespace Domain {
    public class Enum {
        public enum FooType {
            Foo1,
            Foo2,
            ...
      Foo50}
       public enum FooStatus {
           NotNeeded,
           NeededFor1,
           NeededFor2,
      NeededFor3,
      NiceToHave}
    }
} 
```

我可以使用 Fluent Nhibernate 做到这一点吗？如果不能，我可以映射一个混合 Fluent 和 XML 的类吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-05T20:49:36.363

来自 Fluent NHibernate Google 小组的回答我问过同样的问题

简短的回答是否定的，您目前无法使用流畅的界面执行此操作。我最初的 AsMap() 实现相当幼稚，不支持您的方案。我会将其作为一个问题提出并在修复到位后回复您，但与此同时您应该能够通过将 xml 与流利的映射混合来解决它。我知道我们有几个用户目前正在这样做。确切的步骤取决于您的设置方式。

保罗巴图姆

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T14:36:03.380

忘记添加

```
namespace Domain 
{
public virtual IDictionary<FooType, FooStatus> MyFoo { set; get; }
} 
```

# sql-server - 将 SQL Server 2005 数据库的文件附件限制为大于 8000 字节的值

> ID：243469
> 
> 赞同：3
> 
> 时间：2008-10-28T14:07:59.550
> 
> 标签：sql-server, types

我有一个 .Net 应用程序，它允许用户将文件附加到 SQL Server 2005 数据库。我想将文件大小限制为 10MB，所以据我所知，我必须声明数据类型 varbinary(max)，因为我实际上可以指定的最大大小是 8000 字节。但是 varbinary(max) 允许的 ~2GB 文件大小似乎有点过头了。有没有办法让我将它限制在数据库中的 10MB，或者我只需要检查他们是否没有尝试在前端附加更大的东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T14:51:34.113

使用 varbinary(max) 完全没问题，因为它是 varbinary，所以您只会使用内容需要的空间，最多 2 个演出。但是，您可以在数据库中添加一个 CHECK CONSTRAINT，检查上传的 datalength()。我宁愿只检查应用程序中的上传。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T14:57:33.803

稍微偏离主题：虽然这当然是可能的，但我发现将附件直接存储在数据库中通常是一个坏主意。

主要问题是由于大型附件导致整体数据库规模爆炸式增长，这使得备份和其他日常维护变得更加困难。

我建议考虑将文件的路径信息简单地存储在数据库中，并将实际文件存储在共享网络文件夹中。（当然，这意味着您现在必须担心网络文件权限和其他一些问题，但在许多情况下仍然是更好的选择。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T14:17:58.440

我认为您需要在前端进行。您可以像这样限制 web.config 中的 HTTP 请求大小：

```
</configuration>
   </system.web>
      <httpRuntime maxRequestLength="60000"/>
   </system.web>
</configuration> 
```

当用户尝试上传超过指定阈值的文件时，您可能还需要明确检查发布的文件大小。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T14:18:14.960

在 ASP.NET 中，您已经对上传大小有限制（默认值：4MB IIRC）。你可以用它来限制你的下载。

IMO 会更好，因为它在通往数据库的路径上更快，因此您可以最大限度地减少服务器上的过载。

唯一的缺点是，如果用户尝试上传大于 ASP.NET 限制的文件，则会看到错误页面。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T14:20:42.910

啊——我的错。这是一个 VB.Net 桌面应用程序。我忘了提那个。但我想必须在前端处理它的建议仍然成立。

谢谢

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T14:36:00.743

我会检查你的应用程序中的文件限制，你不想通过将它插入数据库的过程，只是为了发现它太大了。

提前一点应用逻辑可以节省时间，并提供更好的用户体验。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-28T14:59:44.907

在前端和数据库中限制附件大小似乎是最佳实践。Kaboing 的检查约束解决方案似乎适合数据库方面的事情。

# windows-server-2008 - windows server 2008防火墙，可以备份设置吗？

> ID：243487
> 
> 赞同：3
> 
> 时间：2008-10-28T14:15:09.583
> 
> 标签：windows-server-2008

是否可以备份 windows server 2008 防火墙设置？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T14:17:05.710

我想这就是你要找的：

[http://www.windowsnetworking.com/articles_tutorials/Configure-Windows-2008-Advanced-Firewall-NETSH-CLI.html](http://www.windowsnetworking.com/articles_tutorials/Configure-Windows-2008-Advanced-Firewall-NETSH-CLI.html)

出口

允许您将防火墙的所有当前配置导出到文件。此命令非常有用，因为如果您不喜欢所做的配置，您可以将所有设置备份到文件并恢复它们。

这是一个例子：

netsh advfirewall 导出“c:\advfirewall.wfw”</p>

# winforms - Windows 窗体中的十进制文本框

> ID：243489
> 
> 赞同：4
> 
> 时间：2008-10-28T14:16:17.023
> 
> 标签：winforms, controls, input, maked-textbox

我正在做一个财务 Winforms 应用程序，但在控制方面遇到了一些问题。

我的客户需要在各处插入十进制值（价格、折扣等），我想避免一些重复验证。

所以我立即尝试了适合我需要的 MaskedTextBox（使用像“€ 00000.00”这样的掩码），如果不是因为焦点和掩码的长度。

我无法预测我的客户将输入应用程序的数量有多大。

我也不能指望他以 00 开始所有内容以达到逗号。一切都应该是键盘友好的。

我是否遗漏了什么，或者根本没有办法（除了编写自定义控件）使用标准的 Windows 窗体控件来实现这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T14:19:27.280

您将需要一个自定义控件。只需捕获控件上的 Validating 事件并检查字符串输入是否可以解析为小数。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-28T14:28:28.183

这两个覆盖的方法为我做了（免责声明：此代码尚未投入生产。您可能需要修改）

```
 protected override void OnKeyPress(KeyPressEventArgs e)
    {
        if (!char.IsNumber(e.KeyChar) & (Keys)e.KeyChar != Keys.Back 
            & e.KeyChar != '.')
        {
            e.Handled = true;
        }

        base.OnKeyPress(e);
    }

    private string currentText;

    protected override void OnTextChanged(EventArgs e)
    {
        if (this.Text.Length > 0)
        {
            float result;
            bool isNumeric = float.TryParse(this.Text, out result);

            if (isNumeric)
            {
                currentText = this.Text;
            }
            else
            {
                this.Text = currentText;
                this.Select(this.Text.Length, 0);
            }
        }
        base.OnTextChanged(e);
    } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-28T14:24:49.360

我认为您不需要自定义控件，只需为验证事件编写一个十进制验证方法，并将其用于您需要验证的所有地方。不要忘记包含[NumberFormatInfo](http://msdn.microsoft.com/en-us/library/system.globalization.numberformatinfo.aspx)，它将处理逗号和数字符号。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T14:22:26.543

MSDN：[Windows 窗体中的用户输入验证](http://msdn.microsoft.com/en-us/library/ms229603.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-03-15T18:10:08.397

您只需要让数字和小数符号通过，并避免使用双小数符号。作为额外的，这会在起始十进制数字前自动添加一个 0。

```
public class DecimalBox : TextBox
{
    protected override void OnKeyPress(KeyPressEventArgs e)
    {
        if (e.KeyChar == ',')
        {
            e.KeyChar = '.';
        }

        if (!char.IsNumber(e.KeyChar) && (Keys)e.KeyChar != Keys.Back && e.KeyChar != '.')
        {
            e.Handled = true;
        }

        if(e.KeyChar == '.' )
        {
            if (this.Text.Length == 0)
            {
                this.Text = "0.";
                this.SelectionStart = 2;
                e.Handled = true;
            }
            else if (this.Text.Contains("."))
            {
                e.Handled = true;
            }
        }

        base.OnKeyPress(e);
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-09-14T22:30:38.927

另一种方法是阻止您不想要的内容，并在完成后格式化。

```
class DecimalTextBox : TextBox
{
    // Handle multiple decimals
    protected override void OnKeyPress(KeyPressEventArgs e)
    {
        if (e.KeyChar == '.')
            if (this.Text.Contains('.'))
                e.Handled = true;

        base.OnKeyPress(e);
    }

    // Block non digits
    // I scrub characters here instead of handling in OnKeyPress so I can support keyboard events (ctrl + c/v/a)
    protected override void OnTextChanged(EventArgs e)
    {
        this.Text = System.Text.RegularExpressions.Regex.Replace(this.Text, "[^.0-9]", "");
        base.OnTextChanged(e);
    }

    // Apply our format when we're done
    protected override void OnLostFocus(EventArgs e)
    {
        if (!String.IsNullOrEmpty(this.Text))
            this.Text = string.Format("{0:N}", Convert.ToDouble(this.Text));

        base.OnLostFocus(e);
    }

} 
```

# vba - 分析 Microsoft Word 的 VBA 代码

> ID：243494
> 
> 赞同：2
> 
> 时间：2008-10-28T14:17:52.340
> 
> 标签：vba, optimization, profiling, ms-word

我有一些使用 VBA 来解析 word 文档并构建一些 XML 输出的遗留代码；

不用说它像狗一样奔跑，但我有兴趣分析它以查看它在哪里发生故障，也许是否有一些选项可以让它更快。

在我开始测量我的结果之前，我不想尝试任何事情，所以分析是必须的——我已经做了一些搜索，但找不到任何可以轻松完成这项工作的东西。布伦特伍德有一种工具吗？这需要修改你的代码，但它没有工作，我跑了一段时间。

任何人都知道任何简单的工作？

更新：代码库大约有 20 个文件，每个文件至少有 100 个方法 - 手动添加每个方法的开始/结束调用是不合适的 - 特别是之后将它们全部删除 - 我实际上正在考虑做某种形式正则表达式来解决这个问题，然后另一个将它们全部删除，但它有点太侵入性但可能是唯一的解决方案。我之前在这里找到了一些不错的计时代码，所以它的计时部分不是问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T16:21:25.117

可以使用模板在每个过程中添加一行：

[http://msdn.microsoft.com/en-us/library/aa191135(office.10).aspx](http://msdn.microsoft.com/en-us/library/aa191135(office.10).aspx)

错误处理程序模板通常包含一些描述的 ExitHere 标签。标签之后的第一行可能是计时器打印。

也可以通过代码修改代码：[“示例：添加 DAO 所需的一些行”](http://wiki.lessthandot.com/index.php/Code_and_Code_Windows)是一个 Access 示例，但可以使用 Word 完成类似的操作。

希望这将缩小范围以寻找问题。然后可以注释掉该行，或者您可以恢复为备份。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T17:13:42.593

使用类和#if 将使“向每个方法添加代码”更容易一些......

***探查器*类模块**：：

```
#If PROFILE = 1 Then

Private m_locationName As String
Private Sub Class_Initialize()
    m_locationName = "unknown"
End Sub

Public Sub Start(locationName As String)
    m_locationName = locationName
    MsgBox m_locationName
End Sub

Private Sub Class_Terminate()
    MsgBox m_locationName & " end"
End Sub

#Else

Public Sub Start(locationName As String)
 'no op
End Sub

#End If 
```

**其他一些代码模块：**

```
' helper "factory" since VBA classes don't have ctor params (or do they?)
Private Function start_profile(location As String) As Profiler
    Set start_profile = New Profiler
    start_profile.Start location
End Function

Private Sub test()
    Set p = start_profile("test")
    MsgBox "do work"
    subroutine
End Sub

Private Sub subroutine()
    Set p = start_profile("subroutine")
End Sub 
```

在项目属性中将*条件编译参数*设置为：

```
PROFILE = 1 
```

删除正常、非配置版本的行。

添加行很痛苦，我不知道有什么方法可以自动获取当前方法名称，这将使向每个函数添加分析行变得容易。您可以使用 VBE 对象模型为您注入代码 - 但我想知道手动执行此操作最终会更快。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T14:31:05.713

插入一堆

```
Debug.Print "before/after foo", Now 
```

在您认为可能会长期运行的片段之前和之后，然后将它们进行比较，瞧，您就在那里。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T07:54:23.500

我的建议是分而治之，通过在几个关键位置插入一些时间线来尝试隔离问题，然后深入研究该区域。

如果问题更加分散且不明显，我建议通过逐步禁用整个代码块来简化，尽可能不破坏流程。这类似于通过逐步对工作表或工作表的部分进行硬编码，直到速度问题消失，才能在 Excel 工作簿中找到减速带。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-14T18:17:19.653

关于那个“**现在**”功能（上图，svinto）......

我使用了“ **Timer** ”函数（在 Excel VBA 中），它返回一个 Single。它似乎工作得很好。拉里

# symbian - 在 Symbian OS 上捕获击键？

> ID：243504
> 
> 赞同：2
> 
> 时间：2008-10-28T14:19:39.263
> 
> 标签：symbian, nokia, microsoft-dynamics, keystroke

如何在 Symbian OS 上的 SMS 编写器中捕获用户击键，特别是对于诺基亚 N73（或任何 symbian 支持的设备[http://en.wikipedia.org/wiki/Symbian_OS#Devices_that_have_used_the_Symbian_OS](http://en.wikipedia.org/wiki/Symbian_OS#Devices_that_have_used_the_Symbian_OS)）？我是 symbian 开发的新手，我正在尝试编写一个应用程序来分析发送 SMS 的人的写作风格。任何信息（或朝着正确的方向推进）都会很棒。

非常感谢，

一种

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T09:24:45.760

实际上，您可以捕获用于 Symbian OS 中任何应用程序的击键。 `RWindowGroup::CaptureKey()`并`RWindowGroup::CaptureLongKey()`允许您的可执行文件从任何应用程序中捕获密钥，无论您的应用程序是否在前台。但是，在这种情况下，这可能会变得乏味 - 这两个功能通过捕获特定的键码和修饰符组合来工作，因此您必须设置大量捕获来处理 SMS 编写器中的所有键组合。

一旦您的可执行文件捕获了事件，您还必须将事件传递给 SMS 编写器。虽然名义上可以使用`RWsSession::SendEventToWindowGroup()`or `TApaTask::SendKey()`，但涉及事件以正确的顺序到达（即按下键、键事件、按下键）和不同 FEP（前端处理器）的行为以供用户输入的复杂性。

因此，尽管按照上述要求做名义上是可行的，但实施和测试将被证明是乏味的，近乎冒险。如果您只想分析写作风格以收集数据（而不是在产品应用程序中），您最好编写自己的 SMS 编写器 - 诺基亚论坛网站上有很多关于编辑器和 SMS 发送的示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T21:50:42.643

好吧，有几个级别可以回答您的问题。

*   击键实际上是由消息编辑器应用程序捕获的。因此，要么它提供了一个 API 来为你提供所有击键（你可以在[http://forum.nokia.com](http://forum.nokia.com)上寻找一个。你会找到消息编辑器 API，但它主要是关于重用 GUI 控件和不是您要查找的内容），或者您需要自己的透明应用程序，该应用程序位于前台并捕获击键，然后再将其反馈给恰好在后面的任何应用程序。幸运的是（出于明显的安全原因），Symbian OS 不允许您这样做。

*   但是，当消息保存在手机内存中时，您可以让自己的应用程序读取消息：当它们保存在草稿文件夹或 SMS 发件箱中时。

强制性无耻插件：我建议阅读[http://www.quickrecipesonsymbianos.com](http://www.quickrecipesonsymbianos.com)的消息传递章节，以了解如何使用 Symbian 消息存储

您感兴趣的类别是：CmsvEntry、CMsvSession、MMsvSessionObserver、CMsvOperation 和 CSmsClientMtm。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T09:33:12.293

在相关的说明中——当我在我的 Symbian 手机上对其 API 感到沮丧时，是否有一个 API 可以检测到所有被按下的键？;-)

# sql - Oracle PL/SQL 查询顺序按 Distinct 问题

> ID：243510
> 
> 赞同：7
> 
> 时间：2008-10-28T14:21:01.583
> 
> 标签：sql, oracle

有谁知道这个查询有什么问题？

```
 SELECT DISTINCT c.CN as ClaimNumber, 
         a.ItemDate as BillReceivedDate, c.DTN as
 DocTrackNumber
         FROM ItemData a,
         ItemDataPage b,
         KeyGroupData c
         WHERE a.ItemTypeNum in (112, 113, 116, 172, 189)
         AND a.ItemNum = b.ItemNum
         AND b.ItemNum = c.ItemNum
         ORDER BY a.DateStored DESC; 
```

我职业生涯的大部分时间都在做 T-Sql，这对我来说看起来是正确的，但是这个查询是针对 Oracle 数据库的，而 Toad 只是将光标放在 Order By 部分的 a.DateStored 上。我相信这对于任何做 PL/SQL 的人来说都是基本的。

谢谢！

[编辑] 供将来参考，SQL*Plus 给出的错误是：“ORA-01791: not a SELECTed expression”

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-28T14:24:58.377

您将需要这样修改查询：

```
SELECT DISTINCT c.CN as ClaimNumber, 
         a.ItemDate as BillReceivedDate, c.DTN as
 DocTrackNumber, a.DateStored
         FROM ItemData a,
         ItemDataPage b,
         KeyGroupData c
         WHERE a.ItemTypeNum in (112, 113, 116, 172, 189)
         AND a.ItemNum = b.ItemNum
         AND b.ItemNum = c.ItemNum
         ORDER BY a.DateStored DESC; 
```

执行 DISTINCT 时，您的 order by 需要是选定的列之一。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T14:24:36.053

没关系，在 SQL Plus 中执行给了我一个更丰富的答案。DateStored 需要在 select 语句中，这样才有效：

```
 SELECT DISTINCT c.CN as ClaimNumber,          
a.ItemDate as BillReceivedDate, 
c.DTN as DocTrackNumber, 
a.DateStored         
FROM ItemData a,         
ItemDataPage b,         
KeyGroupData c         
WHERE a.ItemTypeNum in (112, 113, 116, 172, 189)         
AND a.ItemNum = b.ItemNum         
AND b.ItemNum = c.ItemNum         
ORDER BY a.DateStored DESC; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T14:26:10.387

我认为order by子句的元素也一定在select子句中。

# performance - Oracle 分层查询性能

> ID：243528
> 
> 赞同：1
> 
> 时间：2008-10-28T14:26:17.953
> 
> 标签：performance, oracle, hierarchy

我们正在研究使用 Oracle 分层查询来建模可能非常大的树结构（可能无限宽，深度为 30+）。我的理解是，分层查询提供了一种编写递归连接 SQL 的方法，但与手动编写等效查询相比，它们并没有提供任何真正的性能增强……是这样吗？在性能方面，人们在使用 oracle 分层查询方面有过什么样的体验？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T15:06:06.563

简短的回答是，如果没有分层扩展（连接方式），您将无法编写递归查询。您可以以编程方式发出许多递归链接的查询。

所有数据库的经验法则，尤其是 oracle，是如果您可以在单个查询中发出结果，它几乎总是比以编程方式执行要快。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T15:08:20.973

我的经验是使用小得多的集合，所以我不能说层次查询对大集合的性能有多好。

在进行这些树检索时，您通常有这些选项

*   查询所有内容并在客户端组装树。
*   对树的每一级执行一个查询，建立在您从先前查询结果中知道您需要的内容的基础上
*   使用 Oracle 提供的内置内容（START WITH,CONNECT BY PRIOR）。

在数据库中完成这一切将减少不必要的往返或提取过多数据的浪费查询。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T22:42:57.903

Try partitioning the data within you hierarchical table and then limiting the partition included in the query.

```
CREATE TABLE
    loopy
    (key NUMBER, key_hier number, info VARCHAR2, part NUMBER)
PARTITION BY
    RANGE (part)
    (
    PARTITION low VALUES LESS THAN (1000),
    PARTITION mid VALUES LESS THAN (10000),
    PARTITION high VALUES LESS THAN (MAXVALUE)
    ); 

SELECT
    info
FROM
    loopy PARTITION(mid)
CONNECT BY
    key = key_hier
START WITH
    key = <some value>; 
```

The interesting problem now becomes your partitioning strategy. Oracle provides several options.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T22:17:17.363

I've seen that using connect by can be slow but compared to what? There isn't really another option except building a result set using recursive PL/SQL calls (slower) or doing it on your client side.

You could try separating your data into a mapping (hierarchy definition) and lookup tables (the display data) and then joining them back together. I guess I wouldn't expect much of a gain assuming you are getting the hierarchy data from indexed fields but its worth a try.

Have you tried it using the connect by yet? I'm a big fan of trying different variations.

# nhibernate - 在数据层访问多个数据提供者

> ID：243529
> 
> 赞同：1
> 
> 时间：2008-10-28T14:26:37.843
> 
> 标签：nhibernate, oop, domain-driven-design, dao, data-layers

我正在开发一个使用 DDD 理念开发的业务应用程序。数据库通过 NHibernate 访问，数据层使用 DAO 模式实现。

UML 类图如下所示。

[UML 类图 http://img266.imageshack.us/my.php?image=classdiagramhk0.png](http://img266.imageshack.us/my.php?image=classdiagramhk0.png) [http://img266.imageshack.us/my.php?image=classdiagramhk0.png](http://img266.imageshack.us/my.php?image=classdiagramhk0.png)

不知道设计好不好。你怎么看？

但问题不在于设计好不好。问题是在启动应用程序后，`IDaoFactory`在表示层中实例化并作为参数发送到演示者类（使用 MVC 模式设计），如下所示

```
...
IDaoFactory daoFactory = new NHibernateDaoFactory(); //instantiation in main class
...
SamplePresenterClass s = new SamplePresenterClass(daoFactory);
... 
```

只使用一个数据提供者（这只是一个数据库）很简单。但是现在我们也应该从 XML 中获取数据。在开发的下一阶段，我们应该连接到不同的 Web 服务并操作传入和传出的数据。

来自 XML 的数据将使用一个枚举键来获取。`XMLLoader`我们向数据层添加一个名为的类`ILoader`，并向域添加一个接口。`XMLLoader`有一个方法，其签名是

```
List<string> LoadData(LoaderEnum key) 
```

如果我们在表示层中使用 XMLLoader 实例化 ILoader，如下所示，我们必须将其发送到将从数据层获取一些 XML 数据的对象。

```
ILoader loader = new XMLLoader();
SamplePresenterClass s = new SamplePresenterClass(daoFactory, xmlLoader); 
```

实现 Web 服务访问类之后

```
SamplePresenterClass s = new SamplePresenterClass(daoFactory, xmlLoader, sampleWebServiceConnector1, sampleWebServiceConnector2, ...); 
```

参数将及时增长。我认为我可以在一个类中保存所有数据访问对象的实例并将其传递给所需的演示者（也许单例模式也可以提供帮助）。在领域层必须有一个这样的类，

```
public class DataAccessHolder
{
    private IDaoFactory daoFactory;
    private ILoader loader;
    ...
    public IDaoFactory DaoFactory
    {
        get { return daoFactory; }
        set { daoFactory = value; }
    }
    ...
} 
```

在主类中，可以使用此设计进行实例化，如下所示

```
DataAccessHolder dataAccessHolder = new DataAccessHolder();
dataAccessHolder.DaoFactory = new NHibernateDaoFactory();
dataAccessHolder.Loader = new XMLLoader();
...
SamplePresenterClass s = new SamplePresenterClass(dataAccessHolder); 
```

你觉得这个设计怎么样，或者你能给我推荐一个不同的设计吗？

感谢所有回复...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T14:44:13.520

IMO，使用“全局”或静态 daoFactory 并使其通用会更干净。

```
DaoFactory<SamplePresenterClass>.Create(); // or
DaoFactory<SamplePresenterClass>.Create(id); // etc 
```

然后，你可以定义`DaoFactory<T>`只取，比如说`IDao`，

```
interface IDao
{
    IDaoProvider GetProvider();
}

interface IDaoProvider
{
    IDao Create(IDao instance);
    void Update(IDao instance);
    void Delete(IDao instance);
} 
```

基本上，不是将每个构造函数都传递给您的 DaoFactory，而是使用静态通用 DaoFactory。它的 T 必须继承自 IDao。然后 DaoFactory 类可以在运行时查看 T 提供者：

```
static class DaoFactory<T> where T : IDao, new()
{
    static T Create()
    {
        T instance = new T();
        IDaoProvider provider = instance.GetProvider();

        return (T)provider.Create(instance);
    }
} 
```

`IDaoProvier`根据类，您可以使用 XML、NHibernate、Web 服务等加载内容的通用接口在哪里。（每个`IDao`对象都知道如何连接到它的数据提供者）。

总的来说，虽然不是一个糟糕的设计。添加更多的面向对象，您将拥有一个非常漂亮的设计。例如， 的每个文件都`XmlEnums`可以实现为`IDao`

```
class Cat : IDao
{
    IDaoProvider GetProvider()
    {
        return new XmlLoader(YourEnum.Cat);
    }

    // ...
} 
```

# php - adodb 和访问将 ® 更改为 ®

> ID：243540
> 
> 赞同：1
> 
> 时间：2008-10-28T14:29:11.287
> 
> 标签：php, ms-access, adodb

我用 php 和 adodb 连接到一个访问数据库。带有 ® 等字符的字符串在数据库中保存为 ® 。我该怎么做才能正确存储它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T14:40:12.153

看起来您正在传递一个 UTF8 字符串，但您没有将其存储为 UTF8。以一种或另一种方式更改它，以便它们匹配（最好将您的数据库更改为 UTF8）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T16:38:06.253

@RoBOrg：是的，但我没有找到将其存储为 utf8 的方法。连接字符串已使用 charset=utf8 "DRIVER=Microsoft Access Driver (*.mdb);DBQ=something.mdb;UID=Administrator;Charset=utf8" 并且我在 adodb 中没有发现任何更改存储字符集的可能性用于访问数据库。我正在使用命令文本进行更新。（我之前将此作为评论发送，对不起。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T19:09:48.023

如果您使用命令文本进行更新，我会看看您的连接的 commandText 属性的详细说明方式。我敢打赌，您的字符更新甚至在 INSERT/UPDATE 字符串发送到数据库之前就已完成。

# c# - 程序集以及何时不能选择强命名？

> ID：243547
> 
> 赞同：3
> 
> 时间：2008-10-28T14:32:22.060
> 
> 标签：c#, .net, assemblies

*[不久前，我在 Stack Overflow、 Assembly Names and Versions](https://stackoverflow.com/questions/93455)*上问了以下问题。

现在我意识到我不能用强名称签署我的程序集，因为第 3 方依赖项之一不是强名称程序集，因此我的程序集不可签名。

我试图简单地将程序集文件名 MyAssembly.dll 更改为 MyAssembly.v.1.1.dll 但是当我这样做并引用重命名的程序集时 - 它不会像其他引用一样被复制。似乎是因为文件名和程序集的 Identity 属性不匹配。

我有项目 A 和 B，它们是项目 C 的依赖项。项目 A 需要引用 MyAssembly.dll v.1.0，项目 B 需要引用 MyAssembly.dll v.2.0，因此两者都需要能够位于项目 C 的 bin/发布文件夹。

有什么可做的？我怎样才能解决这个问题？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-30T19:09:53.747

理想情况下，任何自尊的第 3 方程序集开发人员都会签署他们的程序集。我会尝试以下方法：

1.  看看您是否可以联系第 3 方组装提供商并要求他们为您签名。
2.  如果第 3 方汇编提供者是开源的，请使用强名称密钥自行下载和编译源代码。（考虑将此贡献回项目）。

否则，（只要许可证允许）：

1.  像这样尝试[ildasm.exe](http://msdn.microsoft.com/en-us/library/f7dy01k1(VS.80).aspx)和[ilasm.exe](http://msdn.microsoft.com/en-us/library/496e4ekx(VS.80).aspx)：

    ildasm.exe /out:TheAssembly.il TheAssembly.dll

    ilasm.exe TheAssembly.il /key=MyKey.snk /dll /output=TheAssembly.dll

2.  尝试其他人提到的[ILMerge 。](http://research.microsoft.com/~mbarnett/ILMerge.aspx)

否则，您可能需要为您目前在 3rd 方程序集中拥有的功能寻找另一个选项。

祝你好运！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-28T14:47:43.560

一种选择可能是使用[ILMerge](http://research.microsoft.com/~mbarnett/ILMerge.aspx)对第三方程序集进行签名，尽管如果第三方非常定期地对其程序集部署更新，那么更新会有点麻烦。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T20:14:29.467

您可以反汇编第 3 方库并重新编译它，自己签名。当然，如果它违反了任何许可，或者如果您不知道 3rd-party 库的许可（我假设您在使用它时确实如此），您不应该这样做。也就是说，如果您与第 3 方联系，请让他们为您提供签名版本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-18T22:04:03.317

如果您不能要求第三方签署程序集（或者在许多情况下项目已被放弃），您将需要自己签署程序集。许多在线示例（包括 Lloyd 的答案）有时会在往返过程中引起问题。

ILMerge 有其自身的风险，在某些项目中可能无法且难以维护。

我编写了一个应用程序来自动执行任何 .NET 托管程序集的签名，以克服所有这些限制并可靠地执行这个看似简单的任务。这可以根据您的要求从 UI、命令行或编程 API 完成。您可以阅读有关该应用程序的更多信息并在此处下载：http: [//brutaldev.com/post/2013/10/18/NET-Assembly-Strong-Name-Signer](http://brutaldev.com/post/2013/10/18/NET-Assembly-Strong-Name-Signer)

# java - 如何从 MouseEvent 可靠地获取 JTable 中的行索引？

> ID：243553
> 
> 赞同：22
> 
> 时间：2008-10-28T14:33:43.993
> 
> 标签：java, swing, jtable

如何找出用户刚刚单击的 JTable 中的哪一行？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-28T14:36:45.437

试试这个：

`aJTable.rowAtPoint(evt.getPoint());`

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-28T21:50:38.557

如果您只关心听 JTable 上的选择：

```
jTable.getSelectionModel().addListSelectionListener(new ListSelectionListener() {
    public void valueChanged(ListSelectionEvent e) {
        int sel = jTable.getSelectedRow();
    }
}); 
```

# 3d - XNA 中窗口系统的渲染策略（RenderTarget 性能）

> ID：243554
> 
> 赞同：2
> 
> 时间：2008-10-28T14:34:07.080
> 
> 标签：3d, xna, direct3d, xbox360

我目前正在从头开始为 XNA 游戏创建一个窗口系统。我主要为 Windows 开发，但谁知道我将来可能支持哪些平台。如果您知道本机 Direct3D 的这一点，请随时回答，因为性能语义应该相似。如果可能，请考虑如果目标平台是 X-Box 360 会发生什么变化。

我取得了不错的进展，但现在我不确定如何准确地渲染窗口。我想出了四种方法：

*   只需将所有控件直接渲染到屏幕上。这就是我现在所做的。只要控件不是半透明的，就可以通过在状态之间混合来为控件设置动画。我没有找到在任意数量的状态之间制作动画的好方法（假设一个按钮当前正在从按钮向上到按钮向下以及从鼠标悬停到鼠标悬停动画，然后它被禁用。它应该从最后一个状态平滑地混合到新状态。使用这种方法，这仅在最后一个动画完成后播放一个动画时才有效，否则您将在动画中跳跃。

*   将每个顶级窗口和所有控件渲染到一个渲染目标中，然后使用它以半透明的方式将顶级窗口渲染到屏幕上。这使得顶层工作具有半透明性并且易于管理，但不会改变动画的内容。

*   将每个控件渲染到渲染目标中，该目标仅在控件变脏时更新（即必须设置动画或文本已更改）。这样，每个控件的半透明将起作用。

*   和前面一样，但除了解决动画问题之外，每个控件都有第二个渲染目标。每当动画开始时，交换渲染目标，这样我们就有了动画开始时的状态，并将其与目标状态混合到另一个渲染目标中。这不应该比以前的方法增加开销，我们只是有两倍多的渲染目标，在任何给定的帧中，只有一个会被渲染（最多）。但是问题来了：为了让它工作，我需要让“旧”渲染目标保留它的内容。这应该在 Windows 上具有良好的性能，但似乎对 X-Box 360 有严重的性能影响。另一方面，“保留”位仅在动画处于活动状态时才是必需的。

真正的问题来了。欢迎任何澄清的事情。关于性能问题，请记住，这只是游戏的窗口系统——后面的游戏可能会使用许多渲染目标并吸收性能，而且可能比窗口系统更多。假设在绝对最坏的情况下，我们可能有五个顶级窗口，每个屏幕上有 20-40 个控件。

*   如果有的话，您会推荐这些方法中的哪一种，为什么？当然，随意添加另一种方法。
*   假设只有 200 个或 400 个渲染目标可用，假设每个帧只有 20 个渲染目标，是否会对性能产生影响？
*   PreserveContents 对 X-Box 360 的性能影响真的那么糟糕吗？在 Windows 上有多糟糕？
*   可以写入 RenderTarget2D.RenderTargetUsage 属性。在运行时切换它是一个好主意，仅在需要时启用 PreserveContents 吗？
*   您（作为玩家）是否介意控制动画在某些情况下会跳转，例如将鼠标悬停在按钮上，将鼠标移出然后再次移入，因此“正常->悬停”动画从头开始播放两次，因为它是比你慢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-07-15T20:32:36.473

如果您正在为 Xbox 360 进行开发，则必须小心渲染目标。Xbox 360 有一个特殊的内存 (10MB) 来保存渲染目标，包括用于在屏幕上渲染的目标。

只要不超过 10MB，从一个渲染目标切换到另一个渲染目标就没有影响，即使使用 PreserveContents，因为所有渲染目标都存储在这个特殊的内存中。

但是，当您使用 PreserveContents 拥有超过 10MB 的渲染目标时，必须通过不断地从正常内存切换回渲染目标来模拟此属性。

所以渲染目标的数量并不像这些目标的总大小那么重要。您可以使用以下公式了解渲染目标的大小：

```
size (bits) = width  x height x color data size (bits) 
```

Xbox 360 上的颜色数据大小为 32 位，因此，例如，如果您库的用户正在开发他的高清游戏，除了主要目标之外没有其他渲染目标，他将使用：

```
3,515625MB = 29491200 bits = 1280 x 760 x 32 bits 
```

此外，您应该避免动态创建渲染目标。太贵了。您应该创建一个在游戏开始时分配的静态渲染目标池，并让您的 GUI 组件请求它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-09T12:02:20.340

*   如果您希望使用动画进行那种级别的控制（即，一次有多个在同一个控件上进行），那么您将需要进行多次传递。所以要么在着色器中启用这种东西并使用着色器进行多次传递，要么执行标准的 Render->Resolve->Rerender 循环。
*   创建这么多渲染目标确实会影响性能。创建这么多不是一个好主意。您最好使用较少数量的较大尺寸的渲染目标，并将多个控件写入该目标。
*   自从我做任何 360 开发（bugger :( ）以来，已经有很长时间了，但据我所知，它并不是那么好。除非绝对必要，否则我会避免这个选项。希望有更多最新经验的人可以在这里提供帮助。
*   这可能在运行时有效，但可能涉及相当多的幕后工作。我不希望它表现得太好。我敢肯定，如果您不在渲染循环的中间进行操作，那很好。
*   我认为跳动的动画肯定会很烂。恕我直言 ：）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-10T19:27:50.380

Xbox360 有 10MB 的特殊内存用于当前渲染目标。但其余的关于它如何工作的说法并不十分准确。无论使用什么渲染目标，都位于这 10MB 的空间中。否则，您可以拥有任意数量的渲染目标。如果您的渲染目标大于 10MB（例如 1280x720 与一些 AA 多重采样），则 xbox360 使用称为 Predicated Tiling 的技术：http: [//msdn.microsoft.com/en-us/library/bb464139.aspx](http://msdn.microsoft.com/en-us/library/bb464139.aspx)

我很擅长编写窗口系统。我将小部件渲染到渲染目标，然后将小部件目标渲染到窗口目标，将窗口目标渲染到后台缓冲区。这使我可以轻松地添加滚动条并仅将小部件渲染目标的一部分渲染到窗口渲染目标上。如果有更好的方法来处理滚动窗口内容的工作，请告诉我。不确定这是否是最好的性能。

# sql - 从表中删除重复项

> ID：243567
> 
> 赞同：5
> 
> 时间：2008-10-28T14:38:54.387
> 
> 标签：sql, postgresql

数据库类型是 PostGres 8.3。

如果我写：

```
SELECT field1, field2, field3, count(*) 
FROM table1
GROUP BY field1, field2, field3 having count(*) > 1; 
```

我有一些计数超过 1 的行。我怎样才能取出重复项（我仍然希望每个行都有 1 行而不是 +1 行......我不想全部删除它们。）

例子：

```
1-2-3
1-2-3
1-2-3
2-3-4
4-5-6 
```

应该变成：

```
1-2-3
2-3-4
4-5-6 
```

*我找到的唯一答案就[在那里，](http://www.siafoo.net/article/64)但我想知道是否可以在没有哈希列的情况下做到这一点。*

**警告** 我没有唯一编号的 PK，所以我不能使用 min(...) 技术。PK是3个字段。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T14:59:14.690

这是所有表都应具有主键的众多原因之一（不一定是 ID 号或 IDENTITY，而是一个或多个列的组合，用于唯一标识一行并在数据库中强制执行其唯一性）。

你最好的选择是这样的：

```
SELECT field1, field2, field3, count(*) 
INTO temp_table1
FROM table1
GROUP BY field1, field2, field3 having count(*) > 1

DELETE T1
FROM table1 T1
INNER JOIN (SELECT field1, field2, field3
      FROM table1
      GROUP BY field1, field2, field3 having count(*) > 1) SQ ON
            SQ.field1 = T1.field1 AND
            SQ.field2 = T1.field2 AND
            SQ.field3 = T1.field3

INSERT INTO table1 (field1, field2, field3)
SELECT field1, field2, field3
FROM temp_table1

DROP TABLE temp_table1 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T14:58:14.207

一种可能的答案是：

```
CREATE <temporary table> (<correct structure for table being cleaned>);
BEGIN WORK;   -- if needed
INSERT INTO <temporary table> SELECT DISTINCT * FROM <source table>;
DELETE FROM <source table>
INSERT INTO <source table> SELECT * FROM <temporary table>;
COMMIT WORK;  -- needed
DROP <temporary table>; 
```

我不确定事务语句是否需要“工作”，也不确定 PostgreSQL 中是否需要显式 BEGIN。但是这个概念适用于任何 DBMS。

唯一需要注意的是引用约束，尤其是触发的删除操作。如果这些存在，这可能证明不太令人满意。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T15:00:57.353

这将使用[OID](http://www.postgresql.org/docs/8.1/static/datatype-oid.html)对象 ID（如果表是用它创建的）：

```
DELETE FROM table1
WHERE OID NOT IN (SELECT   MIN (OID)
                              FROM table1
                          GROUP BY field1, field2, field3) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T15:04:28.127

好吧，我应该误解一些东西，但我会说：

从表 1 中选择**不同的字段**1、字段 2、字段 3

太容易成为好人？^^

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T15:05:45.877

使用 TSQL，不知道 Postgres 是否支持临时表，但您可以选择临时表，然后循环遍历并删除并将结果插入原始表

```
-- **Disclaimer** using TSQL
-- You could select your records into a temp table with a pk
Create Table #dupes
([id] int not null identity(1,1), f1 int, f2 int, f3 int)

Insert Into #dupes (f1,f2,f3) values (1,2,3)
Insert Into #dupes (f1,f2,f3) values (1,2,3)
Insert Into #dupes (f1,f2,f3) values (1,2,3)
Insert Into #dupes (f1,f2,f3) values (2,3,4)
Insert Into #dupes (f1,f2,f3) values (4,5,6)
Insert Into #dupes (f1,f2,f3) values (4,5,6)
Insert Into #dupes (f1,f2,f3) values (4,5,6)
Insert Into #dupes (f1,f2,f3) values (7,8,9)

Select f1,f2,f3 From #dupes

Declare @rowCount int
Declare @counter int
Set @counter = 1
Set @rowCount = (Select Count([id]) from #dupes)

while (@counter < @rowCount + 1)
    Begin
       Delete From #dupes
       Where [Id] <> 
            (Select [id] From #dupes where [id]=@counter)
                and
            (
                [f1] = (Select [f1] from #dupes where [id]=@counter)
                and
                [f2] = (Select [f2] from #dupes where [id]=@counter)
                and
                [f3] = (Select [f3] from #dupes where [id]=@counter)
            )
       Set @counter = @counter + 1
    End

Select f1,f2,f3 From #dupes -- You could take these results and pump them back into --your original table

Drop Table #dupes 
```

在 MS SQL Server 2000 上对此进行了测试。不熟悉 Postgres 的选项，但也许这会引导您朝着正确的方向前进。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T15:09:07.430

这是我发现的最简单的方法：

Postgre SQL 语法：

```
CREATE TABLE tmp AS SELECT distinct * FROM table1
truncate table table1
insert into table1 select * from tmp
drop table tmp 
```

T-SQL 语法：

```
select distinct * into #tmp from table1
truncate table table1
insert into table1 select * from #tmp
drop table #tmp 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-28T15:23:19.197

这个问题的一个很好的[答案](http://www.mssqltips.com/tip.asp?tip=1103)，但对于 SQL Server。它使用 SQL Server 提供的 ROWCOUNT，效果很好。我从未使用过 PostgreSQL，因此不知道 PostgreSQL 中的 ROWCOUNT 等价物。

# c++ - CTimeSpan.GetDays() 和夏令时

> ID：243568
> 
> 赞同：4
> 
> 时间：2008-10-28T14:39:05.837
> 
> 标签：c++, mfc, dst

我在一个旧的 C++ MFC 程序中发现了一个错误，该程序计算给定日期与固定基准日期的偏移量（以天为单位）。由于某种原因，我们看到结果偏离了一个，我将其追踪到原始程序员使用 CTimeSpan.GetDays() 方法的位置。根据[文档](http://msdn.microsoft.com/en-us/library/14zezc9x.aspx)：

> 请注意，夏令时可能会导致 GetDays 返回一个可能令人惊讶的结果。例如，当 DST 生效时，GetDays 将 4 月 1 日和 5 月 1 日之间的天数报告为 29，而不是 30，因为 4 月的一天缩短了一个小时，因此不算完整的一天。

我建议的解决方法是`(obj.GetTotalHours()+1)/24`改用。我认为这将涵盖所有问题，因为这是每天大约在同一时间运行的批处理作业，但我想在实施它之前我会问这里的聪明人是否有更好的方法。

这只是一个附带问题，但我也很好奇如果程序可以随时运行，将如何处理。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T16:01:03.893

只要事件每天在同一时间发生，您的修复就可以很好地获取两次之间的整个 24 小时时段的数量。否则，表达式中的“+1”可能会导致非一错误。

有时您并不关心事件发生在一天中的什么时间，您只想知道是哪一天。在这种情况下，您需要将小时、分钟和秒归零，然后使用您的公式：

```
CTime startDay(start.GetYear(), start.GetMonth(), start.GetDay(), 0, 0, 0);
CTime finishDay(finish.GetYear(), finish.GetMonth(), finish.GetDay(), 0, 0, 0);
int days = ((finishDay - startDay).GetTotalHours() + 1) / 24; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-05-01T15:02:56.873

对 Mark 建议的内容进行了微小的更改，它无需任何舍入即可工作：只需向构造函数添加一个零参数即可`CTime`。这会强制这两个时间都是标准时间（不是夏令时）。该参数的默认值为 -1，这意味着“如果夏令时有效，则自动计算”。

```
// Discard hours, minutes, seconds, and daylight savings time
CTime startDay(start.GetYear(), start.GetMonth(), start.GetDay(), 0, 0, 0, 0);
CTime endDay(end.GetYear(), end.GetMonth(), end.GetDay(), 0, 0, 0, 0);

// Get number of days apart
CTimeSpan span = endDay - startDay;
int nDays = span.GetDays(); 
```

测试和工作。

# c# - 我的 BackgroundWorker 实例何时会被垃圾回收

> ID：243569
> 
> 赞同：3
> 
> 时间：2008-10-28T14:39:19.707
> 
> 标签：c#, .net, events, garbage-collection, backgroundworker

考虑这个代码块

```
public void ManageInstalledComponentsUpdate()
        {
            IUpdateView view = new UpdaterForm();
            BackgroundWorker worker = new BackgroundWorker();
            Update update = new Update();
            worker.WorkerReportsProgress = true;
            worker.WorkerSupportsCancellation = true;
            worker.DoWork += new DoWorkEventHandler(update.DoUpdate);
            worker.ProgressChanged += new ProgressChangedEventHandler(view.ProgressCallback);
            worker.RunWorkerCompleted += new RunWorkerCompletedEventHandler(view.CompletionCallback);            
            worker.RunWorkerAsync();
            Application.Run(view as UpdaterForm);     
        } 
```

一切都很好，但我想了解为什么对象（工作者、视图和更新）没有被垃圾收集

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-28T14:47:38.440

线程算作根对象；我不确切地知道 BackgroundWorker 是如何运作的，但主线程方法似乎很可能会访问工作实例上的状态；因此，工作线程本身将使 BackgroundWorker 实例保持活动状态，直到（至少）线程退出。

当然; 集合还要求所有其他（活动）对象都已取消引用工作对象；另请注意，堆栈变量的集合在调试/发布中可能不同，并且附加/不附加调试器。

[编辑] 如前所述；工作人员（在您的代码中）上的事件处理程序将使“视图”和“更新”对象保持活动状态（通过委托），但不是相反。只要工人的寿命比“视图”和“更新”短，您就不必对取消订阅事件感到偏执。我已经编辑了代码以包含一个“SomeTarget”对象，该对象仅由工作人员引用：您应该看到这种效果（即目标与工作人员一起死亡）。

当线程死亡时，重新工作人员被收集：这是证明；在工作人员报告退出后，您应该会看到“工作人员已完成”：

```
using System;
using System.ComponentModel;
using System.Threading;
using System.Windows.Forms;
class Demo : Form
{
    class ChattyWorker : BackgroundWorker
    {
        ~ChattyWorker()
        {
            Console.WriteLine("Worker finalized");
        }
    }
    class SomeTarget
    {
        ~SomeTarget()
        {
            Console.WriteLine("Target finalized");
        }
        public SomeTarget()
        {
            Console.WriteLine("Target created");
        }
        public void Foo(object sender, EventArgs args)
        {
            Console.WriteLine("Foo");
        }
    }
    static void Collect(object sender, EventArgs args)
    {
        Console.WriteLine("Collecting...");
        GC.Collect(GC.MaxGeneration, GCCollectionMode.Forced);
    }
    protected override void OnLoad(EventArgs e)
    {
        base.OnLoad(e);

        System.Windows.Forms.Timer timer = new System.Windows.Forms.Timer();
        timer.Interval = 100;
        timer.Tick += Collect;
        timer.Start();

        ChattyWorker worker = new ChattyWorker();
        worker.RunWorkerCompleted += new SomeTarget().Foo;
        worker.DoWork += delegate
        {
            Console.WriteLine("Worker starting");
            for (int i = 0; i < 10; i++)
            {
                Thread.Sleep(250);
                Console.WriteLine(i);
            }
            Console.WriteLine("Worker exiting");
        };
        worker.RunWorkerAsync();
    }
    [STAThread]
    static void Main()
    { // using a form to force a sync context
        Application.Run(new Demo());
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T14:56:50.903

事件处理程序是引用，因此在您将事件处理程序附加到工作人员之前，它不会被视为“无法访问”。

在 ComplitionCallback 中注意解开事件处理程序。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-28T23:13:55.517

这些局部变量对象一直保持活动状态，直到函数退出，也就是表单退出时。因此，在调用 Run 之前将它们清空，或者将它们移动到不同的上下文。

```
public void ManageInstalledComponentsUpdate() {
    UpdaterForm form = new UpdaterForm();
    FireAndForgetWorker( form );
    Application.Run( form );  //does not return until form exits
}

void FireAndForgetWorker( IUpdateView view ) {
    BackgroundWorker worker = new BackgroundWorker();
    Update update = new Update();
    worker.WorkerReportsProgress = true;
    worker.WorkerSupportsCancellation = true;
    worker.DoWork += new DoWorkEventHandler(update.DoUpdate);
    worker.ProgressChanged += new ProgressChangedEventHandler(view.ProgressCallback);
    worker.RunWorkerCompleted += new RunWorkerCompletedEventHandler(view.CompletionCallback);
    worker.RunWorkerAsync();
} 
```

给 vsick 的注意事项：

尝试运行以下程序，您会惊讶于 x 永远存在。

使用系统；

```
class FailsOnGarbageCollection  
{ ~FailsOnGarbageCollection() { throw new NotSupportedException(); } }

class Program{
    static void WaitForever() { while (true) { var o = new object(); } }

    static void Main(string[] args)
    {
        var x = new FailsOnGarbageCollection();
        //x = null; //use this line to release x and cause the above exception
        WaitForever();
    }
} 
```

# xml - 如何将 RollingFileAppender 配置为使用 log4net 按日期和大小滚动？

> ID：243572
> 
> 赞同：26
> 
> 时间：2008-10-28T14:40:01.607
> 
> 标签：xml, configuration, log4net, composite, rollingfileappender

我将 log4net 配置为使用复合 RollingFileAppender 以便当前文件始终命名为**logfile.log**并且所有后续文件都命名为**logfile-YYYY.MM.dd.seq.log**其中**seq**是如果日志超过特定大小的序列号一天之内。不幸的是，我在配置这样的设置方面收效甚微。

**编辑：**

我当前的配置粘贴在下面。它已经根据几个答案进行了更新，这些答案让我足够接近我的需求。这会生成以下格式的文件：**logfile_YYYY.MM.dd.log.seq**

```
<log4net>

    <root>
        <level value="DEBUG" />
        <appender-ref ref="RollingFileAppender" />
    </root>

    <appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender">
        <file value="logs\\logfile"/>
        <staticLogFileName value="false"/>
        <appendToFile value="true"/>
        <rollingStyle value="Composite"/>
        <datePattern value="_yyyy.MM.dd&quot;.log&quot;"/>
        <maxSizeRollBackups value="10"/>
        <maximumFileSize value="75KB"/>
        <layout type="log4net.Layout.PatternLayout">
            <conversionPattern value="%date [%thread] %-5level %logger [%property{NDC}] - %message%newline"/>
        </layout>
        <filter type="log4net.Filter.LevelRangeFilter">
            <param name="LevelMin" value="DEBUG" />
            <param name="LevelMax" value="FATAL" />
        </filter>
    </appender>

</log4net> 
```

一个有趣的笔记，设置

```
<staticLogFileName value="false"/> 
```

为 true 会导致记录器不写入任何文件。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-28T14:49:15.490

我们使用以下内容（在 Log4J 中）：

```
<appender name="roller" class="org.apache.log4j.DailyRollingFileAppender">
    <param name="File" value="Applog.log"/>
    <param name="DatePattern" value="'.'yyyy-MM-dd"/>
    <layout class="org.apache.log4j.PatternLayout">
        <param name="ConversionPattern" value="[slf5s.start]%d{DATE}[slf5s.DATE]%n%p[slf5s.PRIORITY]%n%x[slf5s.NDC]%n%t[slf5s.THREAD]%n%c[slf5s.CATEGORY]%n%l[slf5s.LOCATION]%n%m[slf5s.MESSAGE]%n%n"/>
    </layout>
</appender> 
```

这给了我们**Applog.log.yyyy-MM-dd**文件

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-28T14:48:47.737

根据 log4net RollingFileAppender 源码：

```
protected string GetNextOutputFileName(string fileName)
{
    if (!m_staticLogFileName) 
    {
        fileName = fileName.Trim();

        if (m_rollDate)
        {
            fileName = fileName + m_now.ToString(m_datePattern, System.Globalization.DateTimeFormatInfo.InvariantInfo);
        }

        if (m_countDirection >= 0) 
        {
            fileName = fileName + '.' + m_curSizeRollBackups;
        }
    }

    return fileName;
} 
```

所以我猜不可能生成具有您需要的名称的日志文件。我认为这是类似`logfileYYYY-MM-dd.n.log`或类似的东西。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-07-19T18:02:58.920

尝试将此属性设置为 true：

保留日志文件名扩展值 =“真”

相信这个技巧会对你有所帮助！但是，preserveLogFileNameExtension 属性需要最新版本的 log4net，你可以在这里找到它：[logging.apache.org/log4net/download.html](http://logging.apache.org/log4net/download.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T16:00:48.200

请注意，在这种情况下

```
 <maxSizeRollBackups value="10"/> 
```

将被忽略。

请参阅类似 log4net 问题的[答案](https://stackoverflow.com/questions/95286/log4net-set-max-backup-files-on-rollingfileappender-with-rolling-date#97641)

# unit-testing - 如何在 MonoRail 控制器单元测试中伪造验证错误？

> ID：243580
> 
> 赞同：3
> 
> 时间：2008-10-28T14:42:03.103
> 
> 标签：unit-testing, validation, castle-monorail

我在 Castle 的主干上运行，并尝试对设置了 DTO 验证的控制器操作进行单元测试。控制器继承自 SmartDispatcherController。动作和 DTO 如下所示：

```
 [AccessibleThrough(Verb.Post)]
public void Register([DataBind(KeyReg, Validate = true)] UserRegisterDto dto)
{
    CancelView();
    if (HasValidationError(dto))
    {
        Flash[KeyReg] = dto;
        Errors = GetErrorSummary(dto);
        RedirectToAction(KeyIndex);
    }
    else
    {
        var user = new User { Email = dto.Email };
        // TODO: Need to associate User with an Owning Account
        membership.AddUser(user, dto.Password);
        RedirectToAction(KeyIndex);
    }
}

public class UserRegisterDto
{
    [ValidateNonEmpty]
    [ValidateLength(1, 100)]
    [ValidateEmail]
    public string Email { get; set; }

    [ValidateSameAs("Email")]
    public string EmailConfirm { get; set; }

    [ValidateNonEmpty]
    public string Password { get; set; }

    [ValidateSameAs("Password")]
    public string PasswordConfirm { get; set; }

    // TODO: validate is not empty Guid
    [ValidateNonEmpty]
    public string OwningAccountIdString { get; set; }

    public Guid OwningAccountId
    {
        get { return new Guid(OwningAccountIdString); }
    }

    [ValidateLength(0, 40)]
    public string FirstName { get; set; }

    [ValidateLength(0, 60)]
    public string LastName { get; set; }
} 
```

单元测试如下所示：

```
 [Fact]
public void Register_ShouldPreventInValidRequest()
{
    PrepareController(home, ThorController.KeyPublic, ThorController.KeyHome, HomeController.KeyRegister);

    var dto = new UserRegisterDto { Email = "ff" };
    home.Register(dto);

    Assert.True(Response.WasRedirected);
    Assert.Contains("/public/home/index", Response.RedirectedTo);
    Assert.NotNull(home.Errors);
} 
```

（“home”是我在测试中的 HomeController 实例；home.Errors 包含对 ErrorSummary 的引用，当出现验证错误时应该将其放入 Flash）。

我看到调试器认为 dto 没有验证错误；它显然应该有几个失败，测试运行的方式。

我已经阅读了[Joey 关于此的博客文章](http://joeydotnet.com/blog/archive/2007/10/25/monorail-controller-test-analysis---problem-and-resolution.aspx)，但自从写完这篇文章后，Castle 的树干似乎已经搬走了。有人可以阐明一下吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-27T12:16:59.487

[http://www.candland.net/blog/2008/07/09/WhatsNeededForCastleValidationToWork.aspx](http://www.candland.net/blog/2008/07/09/WhatsNeededForCastleValidationToWork.aspx)似乎包含一个答案。

# sql-server - 将整个 SQL Server 数据库从服务器复制到本地 SQL Express 的最简单方法

> ID：243583
> 
> 赞同：14
> 
> 时间：2008-10-28T14:42:41.463
> 
> 标签：sql-server

我需要将整个数据库从我服务器上的 SQL Server 2005 复制到我的本地 SQL Express，以便运行我的应用程序进行演示。完成这项工作的最快/最简单的方法是什么？

编辑：我对我的服务器的访问权限非常有限，所以我认为我无法访问我可以创建的备份文件，所以它已经失效了。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-28T15:01:01.707

如果数据库不是太大，您可以使用数据库发布向导。

这是来自 Microsoft 的免费工具，它为您创建一个完整的数据库 SQL 脚本（不仅是表和资料，还有所有数据）。

您可以在您的机器上安装该工具，连接到远程服务器并让该工具直接在您的机器上创建脚本。

[您可以在此处](http://www.microsoft.com/downloads/details.aspx?familyid=56E5B1C5-BF17-42E0-A410-371A838E570A&displaylang=en)下载数据库发布向导。

* * *

显然上面的链接在 2019 年不再起作用。
这可能是因为**在较新版本的 SQL Server Management Studio 中，数据库发布向导的功能是开箱即用的**，因此无需单独安装。

它现在称为[Generate and Publish Scripts Wizard](https://docs.microsoft.com/en-us/sql/ssms/scripting/generate-and-publish-scripts-wizard?view=sql-server-ver15)，但它的作用完全相同。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2014-01-07T21:32:05.983

您可以右键单击数据库 -> 任务 -> 生成脚本。您可以在此处选择一个、多个或所有对象。然后在向导的“设置脚本选项”步骤中，单击“高级”。在这里将属性“数据类型”设置为脚本；到架构和数据。

完成这些步骤后，请确保您发布到文件。因为只有文件才能处理大量数据。

现在，您应该编写了所有对象、表和数据的脚本。现在开始运行脚本和中提琴！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-28T14:43:53.973

备份服务器上的数据库，然后在 SQL Express 中本地恢复。

编辑：如果这是您工作的一部分，那么您肯定可以让网络中的某个人为您提供备份..？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-28T14:48:14.323

如果您可以使用 SQL Server Management Studio 登录到两台服务器（Express 和 05 服务器），那么您可以从一个数据库到另一个数据库进行数据库还原。根本不需要备份文件。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-28T14:53:26.090

您可以使用 SSIS 的数据库复制向导，但它一点也不快。那里有 DBA 可以要求您提供备份文件吗？这可能会成为最快的方法。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-28T14:59:30.320

根据您使用的 SQL Server 版本，您可能会从 Microsoft的[SQL Server 数据库发布向导中获得一些帮助。](http://www.microsoft.com/downloads/details.aspx?familyid=56E5B1C5-BF17-42E0-A410-371A838E570A)我在复杂环境中使用此工具的结果喜忧参半，但对于大多数简单的数据库场景来说，它是一个很棒的工具。

我遇到困难的一个例子是一个具有多个不同模式的数据库，每个模式都有自己的所有者和表之间的极端分离（不要问......）。不过，正如我所说，大多数其他情况都很好。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-28T19:17:15.433

## 将数据库保存为 sql 脚本

EMS SQL 管理器（例如）允许您将数据库备份为 .sql 文件中的脚本。然后可以针对任何其他 SQL 服务器运行此文件。只需更新脚本的第一行（CREATE DATABASE ....）。

您甚至可以对脚本进行完全参数化，以包含来自完整或过滤表的数据。

# svn - Tortoise SVN 在分支之间将文件标记为不同但不存在差异

> ID：243586
> 
> 赞同：1
> 
> 时间：2008-10-28T14:43:07.513
> 
> 标签：svn, merge, tortoisesvn

所以我的项目有一个主干，我们可以在其中进行所有开发更改。我们还有一个分支，其参数稍作修改，以适应另一个部门。我们分批工作，一旦完成对主干的一组更改，就切换到分支并合并所有适当的修订。这已经持续了一段时间，但我注意到一些奇怪的行为。如果我打开修订图并比较两个主要修订（主干和分支，我也可以通过 repo 浏览器执行此操作），它会显示两者之间不同的所有文件的列表。问题是当我双击某些文件时，文件中实际上没有文本差异。不应该有任何差异，但应该 t 将其标记为不同，对吗？这使得审计两个分支和跟踪差异变得更加困难，因为大量文件出现在“更改的文件”对话框中。

我注意到了一些事情：

*   两个文件的修订号不同（如预期的那样）

*   我尝试通过合并然后比较分支在测试存储库中重现此问题，但它工作正常（没有差异）

*   我最初认为这可能与 svn:mergeinfo 属性之间的差异有关，但我不再那么确定了。

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T14:45:34.030

一个常见的罪魁祸首是行尾。您的一些开发机器是基于 Windows 的，而其他机器是基于 *nix 的吗？如果不考虑或翻译不同的行结尾，将导致文件不完全匹配。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T18:10:28.283

我认为你实际上得到了过去修改过的所有文件，所以即使内容相同，它们仍然显示为已更改，因为 svn 只是查看历史记录中哪些文件被触摸并从那里工作。您可以尝试进行忽略祖先的合并（在乌龟的某个地方有一个选项）并查看文件是否也显示在那里，afaik 他们不应该。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T22:46:08.803

try the Clean up command, but read this first:

[http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-cleanup.html](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-cleanup.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T14:47:14.933

好吧，我建议尝试使用其他一些合并软件。例如，不确定 Tortoise SVNCompare 是否像 WinMerge 那样明显地突出空格变化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T15:04:52.727

我尝试了两种不同的 diff/merge 软件（winmerge 和 diffmerge），文件完全相同。我只是注意到如果我打开 repo 浏览器，标记主干进行比较，然后将其与分支进行比较，它工作正常。它只显示实际不同的文件*。*但是，当我通过修订图启动它时，它给了我同样的问题。生成的对话框完全相同，除了一个包含大量不同文件的对话框。这可能是 svn/tortoisesvn 的错误还是我错过了其他东西？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T15:09:43.733

检查没有明显差异的两个文件的确切文件大小。还要检查修改日期。

# java - 如何最好地在 Web 应用程序中实现用户可选变量

> ID：243617
> 
> 赞同：1
> 
> 时间：2008-10-28T14:52:38.713
> 
> 标签：java, web-applications, variables, user-input

我有一个基于 Java 的 Web 应用程序和一个新要求，即允许用户将变量放入在生成文档或其他输出时被替换的文本字段中。其他人是如何处理这件事的？

我正在考虑使用一组预定义的变量，例如：
`@BOOKING_NUMBER@`
`@INVOICE_NUMBER@`

然后，当用户输入一些文本时，他们可以指定一个内联变量（从模式或类似中选择它）。例如：

*“这是我需要的一些预订文本`@BOOKING_NUMBER@`”*

在生成一些使用此文本的输出（例如 PDF）时，我会做一个正则表达式并找到所有变量并将它们替换为正确的值：

*“这是我需要的 Booking 10001 的一些文本”*

我最初的想法是类似于 Freemarker，但我认为这对我的用户来说太复杂了，需要他们知道我的 DataModel (eww)。

谢谢阅读！

D.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T15:40:54.137

看看 java.text.MessageFormat - 特别是格式方法 - 因为它是专为您正在寻找的东西而设计的。

IE

```
MessageFormat.format("This is some text for booking {0} that is needed by me, for use with invoice {1}", bookingNumber, invoiceNumber); 
```

您甚至可能希望从资源包中获取模板文本，以支持多种语言，并增加处理 {0} 和 {1} 在某些语言中可能以不同顺序出现的事实的能力。

更新：我刚刚正确阅读了您的原始帖子，并注意到有关 PDF 的评论。这表明模板文本将明显大于一两行。

在这种情况下，您可能想要探索类似[StringTemplate 之](http://www.stringtemplate.org/)类的东西，它似乎更适合此目的 - 此评论仅基于初步调查，因为我没有在愤怒中使用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T15:04:33.477

我以前使用过类似的替换令牌系统。我个人喜欢类似的东西。

[我的价值]

因为用户很容易输入，所以我只是使用替换来将令牌换成真实数据。

# c# - 从 C++ 调用 C# dll 时如何使用 app.config 文件

> ID：243621
> 
> 赞同：0
> 
> 时间：2008-10-28T14:55:20.767
> 
> 标签：c#, .net, c++, interop, app-config

从 C++ 调用 .Net dll 时，如何将`app.config`文件用于 .Net 部分，并且必须在 .Net 运行时启动时读取配置文件中的数据。

如果我使用`foo.dll.config`我调用的有一个，`ConfigurationManager.OpenExeConfiguration("foo.dll")`我可以访问应用程序设置。不过，我想做的是更改 中的一些信息`<system.data>`，即删除 a`DbProviderFactory`并将其替换为新的。

似乎只有将代码放在 exectubales`app.config`文件中才能做到这一点。

但是当我从 C++ 调用 .Net 代码时，我的可执行文件不能有 app.config。

是否有某种方法可以指定`machine.config`在 .Net 运行时启动后肯定会立即运行的配置文件，即使我通过 C++ 调用 .Net dll 也是如此？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T14:59:24.330

您可以拥有 myapp.exe.config，并且被调用的 .Net 程序集将使用它，即使 myapp.exe 是 c++ 应用程序也是如此。我已经使用 outlook.exe.config 为我的 Outlook 插件完成了这项工作。

# mysql - 如何根据 MySQL 中的用户登录设置连接超时

> ID：243644
> 
> 赞同：19
> 
> 时间：2008-10-28T15:03:32.153
> 
> 标签：mysql, timeout

我目前有超过 100 个处于睡眠状态的连接。

某些连接必须保持在睡眠状态（并且不要关闭），因为它是永久连接，但其他一些连接（使用不同的用户名）来自某个 php 脚本，我希望它们很快超时。

是否可以为每个用户设置 wait_timeout？如果是，如何？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-10-28T20:31:39.200

没有针对每个用户的超时配置，但您可以`wait_timeout`动态设置该值。也就是说，在您作为给定用户建立连接后，您可以发出一条语句，将超时值更改为您希望该用户会话的超时值。

在 mysql 命令行客户端中尝试以下实验：

```
mysql> SHOW VARIABLES LIKE 'wait_timeout'; 
```

...显示 28800（即 8 小时），这是默认值`wait_timout`。

```
mysql> SET SESSION wait_timeout = 60;
mysql> SHOW VARIABLES LIKE 'wait_timeout'; 
```

...显示 60。

然后您可以退出会话，重新连接，再次默认`wait_timeout`为 28800。因此它仅限于当前会话的范围。

您还可以打开第二个窗口并启动单独的 mysql 客户端会话，以证明`wait_timeout`在一个会话中更改不会影响其他并发会话。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-11-12T14:04:31.403

您应该在 中设置以下变量`my.conf`：

```
[mysqld]
interactive_timeout=180
wait_timeout=180 
```

`wait_timeout`是**自动连接**的超时（*在我看来，Web 服务器上超过 30 个太多了*）。
`interactive_timeout`是空闲会话的**控制台交互超时**。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-28T20:44:27.193

另一种可能性：MySQL 支持两个不同的超时变量，`wait_timeout`用于非交互式客户端和`interactive_timeout`交互式客户端。

交互式和非交互式客户端之间的区别似乎只是您`CLIENT_INTERACTIVE`在连接时是否指定了选项。

我不知道这是否对您有帮助，因为您需要以某种方式在其参数`mysql_real_connect()`中传递该选项。`client_flag`我不确定您使用的是什么语言或界面，所以我不知道它是否允许您指定此连接标志。

无论如何，如果您可以传递该客户端标志，并且您只需要两种不同类型的用户，那么您可以在 MySQL 服务器配置`wait_timeout`中`interactive_timeout`进行不同的配置，然后在您希望给定会话立即超时时使用具有较短值的用户.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-06-18T17:01:21.380

如果使用[Connector/J](http://dev.mysql.com/doc/refman/5.5/en/connector-j-reference-configuration-properties.html) ，则可以在客户端的 JDBC URL中使用**sessionVariables ，如下所示：**`jdbc:mysql://hostname:3306/schema?sessionVariables=wait_timeout=600`

其他语言的其他连接器可能会允许相同。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-01-25T09:12:14.593

每当用户登录时都会执行init_connect，因此我们可以编写小case语句并根据用户设置值。请注意，超级用户不会执行 init_connect。

`mysql> SET GLOBAL init_connect="SET @@wait_timeout = CASE WHEN CURRENT_USER() LIKE 'app1@%' THEN '30' ELSE @@wait_timeout END";`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T18:21:41.020

我检查了`mysql.user`表格，看起来那里没有设置：

```
+-----------------------+-----------------------------------+------+-----+---------+-------+
| Field                 | Type                              | Null | Key | Default | Extra |
+-----------------------+-----------------------------------+------+-----+---------+-------+
| Host                  | char(60)                          | NO   | PRI |         |       |
| User                  | char(16)                          | NO   | PRI |         |       |
| Password              | char(41)                          | NO   |     |         |       |
| Select_priv           | enum('N','Y')                     | NO   |     | N       |       |
| Insert_priv           | enum('N','Y')                     | NO   |     | N       |       |
| Update_priv           | enum('N','Y')                     | NO   |     | N       |       |
| Delete_priv           | enum('N','Y')                     | NO   |     | N       |       |
| Create_priv           | enum('N','Y')                     | NO   |     | N       |       |
| Drop_priv             | enum('N','Y')                     | NO   |     | N       |       |
| Reload_priv           | enum('N','Y')                     | NO   |     | N       |       |
| Shutdown_priv         | enum('N','Y')                     | NO   |     | N       |       |
| Process_priv          | enum('N','Y')                     | NO   |     | N       |       |
| File_priv             | enum('N','Y')                     | NO   |     | N       |       |
| Grant_priv            | enum('N','Y')                     | NO   |     | N       |       |
| References_priv       | enum('N','Y')                     | NO   |     | N       |       |
| Index_priv            | enum('N','Y')                     | NO   |     | N       |       |
| Alter_priv            | enum('N','Y')                     | NO   |     | N       |       |
| Show_db_priv          | enum('N','Y')                     | NO   |     | N       |       |
| Super_priv            | enum('N','Y')                     | NO   |     | N       |       |
| Create_tmp_table_priv | enum('N','Y')                     | NO   |     | N       |       |
| Lock_tables_priv      | enum('N','Y')                     | NO   |     | N       |       |
| Execute_priv          | enum('N','Y')                     | NO   |     | N       |       |
| Repl_slave_priv       | enum('N','Y')                     | NO   |     | N       |       |
| Repl_client_priv      | enum('N','Y')                     | NO   |     | N       |       |
| Create_view_priv      | enum('N','Y')                     | NO   |     | N       |       |
| Show_view_priv        | enum('N','Y')                     | NO   |     | N       |       |
| Create_routine_priv   | enum('N','Y')                     | NO   |     | N       |       |
| Alter_routine_priv    | enum('N','Y')                     | NO   |     | N       |       |
| Create_user_priv      | enum('N','Y')                     | NO   |     | N       |       |
| ssl_type              | enum('','ANY','X509','SPECIFIED') | NO   |     |         |       |
| ssl_cipher            | blob                              | NO   |     |         |       |
| x509_issuer           | blob                              | NO   |     |         |       |
| x509_subject          | blob                              | NO   |     |         |       |
| max_questions         | int(11) unsigned                  | NO   |     | 0       |       |
| max_updates           | int(11) unsigned                  | NO   |     | 0       |       |
| max_connections       | int(11) unsigned                  | NO   |     | 0       |       |
| max_user_connections  | int(11) unsigned                  | NO   |     | 0       |       |
+-----------------------+-----------------------------------+------+-----+---------+-------+
37 rows in set (0.00 sec) 
```

根据您使用的是 MySQLi 还是 PDO，您的 PHP MySQL 连接应该在请求发生时挂起，或者在 Apache 进程的池中共享。

例如，使用 PDO，要关闭持久连接（我认为这是默认设置），请使用以下命令连接到您的数据库：

$pdo = new PDO($dsn, $user, $pass, Array(PDO::ATTR_PERSISTENT => false));

如果您希望脚本使用持久连接，但在睡眠模式下打开到数据库的连接太多，您应该考虑配置您的 Apache 的, `MaxServers`,`MaxSpareServers`以便在不需要它们时不要有太多的挂起。`MinSpareServers``StartServers`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-07-24T15:08:18.973

[http://www.percona.com/doc/percona-toolkit/2.1/pt-kill.html](http://www.percona.com/doc/percona-toolkit/2.1/pt-kill.html)

可以使用 pt-kill 杀死每个用户的连接。您可以安排这个或设置一个后台作业来处理这个。

# c# - 如何从 .NET 读取 PEM RSA 私钥

> ID：243646
> 
> 赞同：85
> 
> 时间：2008-10-28T15:03:37.363
> 
> 标签：c#, .net, cryptography, rsa

我有一个格式的`RSA`私钥`PEM`，有没有一种直接的方法可以从.NET 中读取它并实例化一个`RSACryptoServiceProvider`以解密用相应公钥加密的数据？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-10-30T20:59:52.527

### 2021 年 3 月 3 日更新

.NET 5 现在支持这个开箱即用。

[要尝试下面的代码片段，请在http://travistidwell.com/jsencrypt/demo/](http://travistidwell.com/jsencrypt/demo/)生成密钥对并加密一些文本

```
var privateKey = @"-----BEGIN RSA PRIVATE KEY-----
{ the full PEM private key } 
-----END RSA PRIVATE KEY-----";

var rsa = RSA.Create();
rsa.ImportFromPem(privateKey.ToCharArray());

var decryptedBytes = rsa.Decrypt(
    Convert.FromBase64String("{ base64-encoded encrypted string }"), 
    RSAEncryptionPadding.Pkcs1
);

// this will print the original unencrypted string
Console.WriteLine(Encoding.UTF8.GetString(decryptedBytes)); 
```

### 原始答案

我解决了，谢谢。万一有人感兴趣，[bouncycastle](http://www.bouncycastle.org/)就成功了，只是因为我缺乏知识和文档而花了我一些时间。这是代码：

```
var bytesToDecrypt = Convert.FromBase64String("la0Cz.....D43g=="); // string to decrypt, base64 encoded

AsymmetricCipherKeyPair keyPair; 

using (var reader = File.OpenText(@"c:\myprivatekey.pem")) // file containing RSA PKCS1 private key
    keyPair = (AsymmetricCipherKeyPair) new PemReader(reader).ReadObject(); 

var decryptEngine = new Pkcs1Encoding(new RsaEngine());
decryptEngine.Init(false, keyPair.Private); 

var decrypted = Encoding.UTF8.GetString(decryptEngine.ProcessBlock(bytesToDecrypt, 0, bytesToDecrypt.Length)); 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2011-03-22T16:58:48.030

关于轻松导入 RSA 私钥，不使用 BouncyCastle 等 3rd 方代码，我认为答案是“不，不单独使用私钥的 PEM”。

但是，正如 Simone 上面提到的，您可以简单地将私钥 (*.key) 的 PEM 和使用该密钥 (*.crt) 的证书文件组合成一个 *.pfx 文件，然后可以轻松导入该文件。

从命令行生成 PFX 文件：

```
openssl pkcs12 -in a.crt -inkey a.key -export -out a.pfx 
```

然后正常使用 .NET 证书类，例如：

```
using System.Security.Cryptography.X509Certificates;

X509Certificate2 combinedCertificate = new X509Certificate2(@"C:\path\to\file.pfx"); 
```

现在您可以按照[MSDN](http://msdn.microsoft.com/en-us/library/system.security.cryptography.x509certificates.x509certificate2.aspx)中的示例通过 RSACryptoServiceProvider 进行加密和解密：

我忽略了要解密，您需要使用 PFX 密码和 Exportable 标志进行导入。（请参阅：[BouncyCastle RSAPrivateKey 到 .NET RSAPrivateKey](https://stackoverflow.com/questions/949727/bouncycastle-rsaprivatekey-to-net-rsaprivatekey)）

```
X509KeyStorageFlags flags = X509KeyStorageFlags.Exportable;
X509Certificate2 cert = new X509Certificate2("my.pfx", "somepass", flags);

RSACryptoServiceProvider rsa = (RSACryptoServiceProvider)cert.PrivateKey;
RSAParameters rsaParam = rsa.ExportParameters(true); 
```

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2008-10-28T15:14:36.967

您可以查看[JavaScience 的](http://www.jensign.com/)[OpenSSLKey](https://gist.github.com/njmube/edc64bb2f7599d33ca5a)源

那里的代码完全可以满足您的需求。

事实上，他们在[这里有很多可用](http://www.jensign.com/cryptoutils/index.html)的加密源代码。

* * *

源代码片段：

```
//------- Parses binary ans.1 RSA private key; returns RSACryptoServiceProvider  ---
public static RSACryptoServiceProvider DecodeRSAPrivateKey(byte[] privkey)
{
        byte[] MODULUS, E, D, P, Q, DP, DQ, IQ ;

        // ---------  Set up stream to decode the asn.1 encoded RSA private key  ------
        MemoryStream  mem = new MemoryStream(privkey) ;
        BinaryReader binr = new BinaryReader(mem) ;    //wrap Memory Stream with BinaryReader for easy reading
        byte bt = 0;
        ushort twobytes = 0;
        int elems = 0;
        try {
                twobytes = binr.ReadUInt16();
                if (twobytes == 0x8130) //data read as little endian order (actual data order for Sequence is 30 81)
                        binr.ReadByte();        //advance 1 byte
                else if (twobytes == 0x8230)
                        binr.ReadInt16();       //advance 2 bytes
                else
                        return null;

                twobytes = binr.ReadUInt16();
                if (twobytes != 0x0102) //version number
                        return null;
                bt = binr.ReadByte();
                if (bt !=0x00)
                        return null;

                //------  all private key components are Integer sequences ----
                elems = GetIntegerSize(binr);
                MODULUS = binr.ReadBytes(elems);

                elems = GetIntegerSize(binr);
                E = binr.ReadBytes(elems) ;

                elems = GetIntegerSize(binr);
                D = binr.ReadBytes(elems) ;

                elems = GetIntegerSize(binr);
                P = binr.ReadBytes(elems) ;

                elems = GetIntegerSize(binr);
                Q = binr.ReadBytes(elems) ;

                elems = GetIntegerSize(binr);
                DP = binr.ReadBytes(elems) ;

                elems = GetIntegerSize(binr);
                DQ = binr.ReadBytes(elems) ;

                elems = GetIntegerSize(binr);
                IQ = binr.ReadBytes(elems) ;

                Console.WriteLine("showing components ..");
                if (verbose) {
                        showBytes("\nModulus", MODULUS) ;
                        showBytes("\nExponent", E);
                        showBytes("\nD", D);
                        showBytes("\nP", P);
                        showBytes("\nQ", Q);
                        showBytes("\nDP", DP);
                        showBytes("\nDQ", DQ);
                        showBytes("\nIQ", IQ);
                }

                // ------- create RSACryptoServiceProvider instance and initialize with public key -----
                RSACryptoServiceProvider RSA = new RSACryptoServiceProvider();
                RSAParameters RSAparams = new RSAParameters();
                RSAparams.Modulus =MODULUS;
                RSAparams.Exponent = E;
                RSAparams.D = D;
                RSAparams.P = P;
                RSAparams.Q = Q;
                RSAparams.DP = DP;
                RSAparams.DQ = DQ;
                RSAparams.InverseQ = IQ;
                RSA.ImportParameters(RSAparams);
                return RSA;
        }
        catch (Exception) {
                return null;
        }
        finally {
                binr.Close();
        }
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-29T22:26:54.130

之间的东西

```
-----BEGIN RSA PRIVATE KEY---- 
```

和

```
-----END RSA PRIVATE KEY----- 
```

是 PKCS#8 PrivateKeyInfo 的 base64 编码（除非它说 RSA ENCRYPTED PRIVATE KEY 在这种情况下它是一个 EncryptedPrivateKeyInfo）。

手动解码并不难，但最好的选择是 P/Invoke 到[CryptImportPKCS8](http://msdn.microsoft.com/en-us/library/aa380208(VS.85).aspx)。

* * *

**更新：** CryptImportPKCS8**[功能](http://msdn.microsoft.com/en-us/library/aa380208%28VS.85%29.aspx)**不再可用于 Windows Server 2008 和 Windows Vista。相反，请使用**[PFXImportCertStore](http://msdn.microsoft.com/en-us/library/aa387314%28v=vs.85%29.aspx)**函数。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-10-25T00:34:19.193

好的，我使用 mac 生成我的自签名密钥。这是我使用的工作方法。

我创建了一个 shell 脚本来加速我的密钥生成。

genkey.sh

```
#/bin/sh

ssh-keygen -f host.key
openssl req -new -key host.key -out request.csr
openssl x509 -req -days 99999 -in request.csr -signkey host.key -out server.crt
openssl pkcs12 -export -inkey host.key -in server.crt -out private_public.p12 -name "SslCert"
openssl base64 -in private_public.p12 -out Base64.key 
```

将 +x 执行标志添加到脚本

```
chmod +x genkey.sh 
```

然后调用 genkey.sh

```
./genkey.sh 
```

我输入密码（重要的是至少在最后包含导出的密码）

```
Enter pass phrase for host.key:
Enter Export Password:   {Important to enter a password here}
Verifying - Enter Export Password: { Same password here } 
```

然后我将 Base64.Key 中的所有内容放入一个名为 sslKey 的字符串中

```
private string sslKey = "MIIJiAIBA...................................." +
                        "......................ETC...................." +
                        "......................ETC...................." +
                        "......................ETC...................." +
                        ".............ugICCAA="; 
```

然后，我使用延迟加载属性获取器来获取带有私钥的 X509 证书。

```
X509Certificate2 _serverCertificate = null;
X509Certificate2 serverCertificate{
    get
    {
        if (_serverCertificate == null){
            string pass = "Your Export Password Here";
            _serverCertificate = new X509Certificate(Convert.FromBase64String(sslKey), pass, X509KeyStorageFlags.Exportable);
        }
        return _serverCertificate;
    }
} 
```

我想走这条路，因为我在 mac 上使用 .net 2.0 和 Mono，并且我想使用没有编译库或依赖项的 vanilla Framework 代码。

我对此的最终用途是 SslStream 以保护与我的应用程序的 TCP 通信

```
SslStream sslStream = new SslStream(serverCertificate, false, SslProtocols.Tls, true); 
```

我希望这对其他人有所帮助。

**笔记**

如果没有密码，我无法正确解锁导出的私钥。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-04-30T21:46:37.810

对于不想使用 Bouncy 并且正在尝试其他答案中包含的一些代码的人，我发现该代码大部分时间都可以工作，但是会遇到一些 RSA 私有字符串，例如我'已包括在下面。通过查看有弹性的代码，我将 wprl 提供的代码调整为

```
 RSAparams.D = ConvertRSAParametersField(D, MODULUS.Length);
    RSAparams.DP = ConvertRSAParametersField(DP, P.Length);
    RSAparams.DQ = ConvertRSAParametersField(DQ, Q.Length);
    RSAparams.InverseQ = ConvertRSAParametersField(IQ, Q.Length);

    private static byte[] ConvertRSAParametersField(byte[] bs, int size)
    {
        if (bs.Length == size)
            return bs;

        if (bs.Length > size)
            throw new ArgumentException("Specified size too small", "size");

        byte[] padded = new byte[size];
        Array.Copy(bs, 0, padded, size - bs.Length, bs.Length);
        return padded;
    }

-----BEGIN RSA PRIVATE KEY-----
MIIEoQIBAAKCAQEAxCgWAYJtfKBVa6Px1Blrj+3Wq7LVXDzx+MiQFrLCHnou2Fvb
fxuDeRmd6ERhDWnsY6dxxm981vTlXukvYKpIZQYpiSzL5pyUutoi3yh0+/dVlsHZ
UHheVGZjSMgUagUCLX1p/augXltAjgblUsj8GFBoKJBr3TMKuR5TwF7lBNYZlaiR
k9MDZTROk6MBGiHEgD5RaPKA/ot02j3CnSGbGNNubN2tyXXAgk8/wBmZ4avT0U4y
5oiO9iwCF/Hj9gK/S/8Q2lRsSppgUSsCioSg1CpdleYzIlCB0li1T0flB51zRIpg
JhWRfmK1uTLklU33xfzR8zO2kkfaXoPTHSdOGQIDAQABAoIBAAkhfzoSwttKRgT8
sgUYKdRJU0oqyO5s59aXf3LkX0+L4HexzvCGbK2hGPihi42poJdYSV4zUlxZ31N2
XKjjRFDE41S/Vmklthv8i3hX1G+Q09XGBZekAsAVrrQfRtP957FhD83/GeKf3MwV
Bhe/GKezwSV3k43NvRy2N1p9EFa+i7eq1e5i7MyDxgKmja5YgADHb8izGLx8Smdd
+v8EhWkFOcaPnQRj/LhSi30v/CjYh9MkxHMdi0pHMMCXleiUK0Du6tnsB8ewoHR3
oBzL4F5WKyNHPvesYplgTlpMiT0uUuN8+9Pq6qsdUiXs0wdFYbs693mUMekLQ4a+
1FOWvQECgYEA7R+uI1r4oP82sTCOCPqPi+fXMTIOGkN0x/1vyMXUVvTH5zbwPp9E
0lG6XmJ95alMRhjvFGMiCONQiSNOQ9Pec5TZfVn3M/w7QTMZ6QcWd6mjghc+dGGE
URmCx8xaJb847vACir7M08AhPEt+s2C7ZokafPCoGe0qw/OD1fLt3NMCgYEA08WK
S+G7dbCvFMrBP8SlmrnK4f5CRE3pV4VGneWp/EqJgNnWwaBCvUTIegDlqS955yVp
q7nVpolAJCmlUVmwDt4gHJsWXSQLMXy3pwQ25vdnoPe97y3xXsi0KQqEuRjD1vmw
K7SXoQqQeSf4z74pFal4CP38U3pivvoE4MQmJeMCfyJFceWqQEUEneL+IYkqrZSK
7Y8urNse5MIC3yUlcose1cWVKyPh4RCEv2rk0U1gKqX29Jb9vO2L7RflAmrLNFuA
J+72EcRxsB68RAJqA9VHr1oeAejQL0+JYF2AK4dJG/FsvvFOokv4eNU+FBHY6Tzo
k+t63NDidkvb5jIF6lsCgYEAlnQ08f5Y8Z9qdCosq8JpKYkwM+kxaVe1HUIJzqpZ
X24RTOL3aa8TW2afy9YRVGbvg6IX9jJcMSo30Llpw2cl5xo21Dv24ot2DF2gGN+s
peFF1Z3Naj1Iy99p5/KaIusOUBAq8pImW/qmc/1LD0T56XLyXekcuK4ts6Lrjkit
FaMCgYAusOLTsRgKdgdDNI8nMQB9iSliwHAG1TqzB56S11pl+fdv9Mkbo8vrx6g0
NM4DluCGNEqLZb3IkasXXdok9e8kmX1en1lb5GjyPbc/zFda6eZrwIqMX9Y68eNR
IWDUM3ckwpw3rcuFXjFfa+w44JZVIsgdoGHiXAdrhtlG/i98Rw==
-----END RSA PRIVATE KEY----- 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2020-02-26T21:43:06.607

我已经尝试了PEM 编码的 PKCS#8 RSA 私钥[的公认答案](https://stackoverflow.com/a/251757)`PemException`，结果是`malformed sequence in RSA private key`消息。原因是它`Org.BouncyCastle.OpenSsl.PemReader`似乎只支持 PKCS#1 私钥。

我能够通过切换到`Org.BouncyCastle.Utilities.IO.Pem.PemReader`（注意类型名称匹配！）这样

```
private static RSAParameters GetRsaParameters(string rsaPrivateKey)
{
    var byteArray = Encoding.ASCII.GetBytes(rsaPrivateKey);
    using (var ms = new MemoryStream(byteArray))
    {
        using (var sr = new StreamReader(ms))
        {
            var pemReader = new Org.BouncyCastle.Utilities.IO.Pem.PemReader(sr);
            var pem = pemReader.ReadPemObject();
            var privateKey = PrivateKeyFactory.CreateKey(pem.Content);

            return DotNetUtilities.ToRSAParameters(privateKey as RsaPrivateCrtKeyParameters);
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-28T15:42:03.310

检查[http://msdn.microsoft.com/en-us/library/dd203099.aspx](http://msdn.microsoft.com/en-us/library/dd203099.aspx)

在密码学应用程序块下。

不知道你是否会得到答案，但值得一试。

**评论后编辑**。

好的，然后检查此代码。

```
using System.Security.Cryptography;

public static string DecryptEncryptedData(stringBase64EncryptedData, stringPathToPrivateKeyFile) { 
    X509Certificate2 myCertificate; 
    try{ 
        myCertificate = new X509Certificate2(PathToPrivateKeyFile); 
    } catch{ 
        throw new CryptographicException("Unable to open key file."); 
    } 

    RSACryptoServiceProvider rsaObj; 
    if(myCertificate.HasPrivateKey) { 
         rsaObj = (RSACryptoServiceProvider)myCertificate.PrivateKey; 
    } else 
        throw new CryptographicException("Private key not contained within certificate."); 

    if(rsaObj == null) 
        return String.Empty; 

    byte[] decryptedBytes; 
    try{ 
        decryptedBytes = rsaObj.Decrypt(Convert.FromBase64String(Base64EncryptedData), false); 
    } catch { 
        throw new CryptographicException("Unable to decrypt data."); 
    } 

    //    Check to make sure we decrpyted the string 
   if(decryptedBytes.Length == 0) 
        return String.Empty; 
    else 
        return System.Text.Encoding.UTF8.GetString(decryptedBytes); 
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-07-18T08:44:27.360

我创建的 PemUtils 库正是这样做的。该代码可在[GitHub 上](https://github.com/huysentruitw/pem-utils)获得，并且可以从[NuGet](https://www.nuget.org/packages?q=pemutils)安装：

```
PM> Install-Package PemUtils 
```

或者如果你只想要一个 DER 转换器：

```
PM> Install-Package DerConverter 
```

从 PEM 数据中读取 RSA 密钥的用法：

```
using (var stream = File.OpenRead(path))
using (var reader = new PemReader(stream))
{
    var rsaParameters = reader.ReadRsaKey();
    // ...
} 
```

# c# - 在 Windows Mobile 上显示表单未最大化且有边框

> ID：243671
> 
> 赞同：1
> 
> 时间：2008-10-28T15:10:05.010
> 
> 标签：c#, winforms, windows-mobile

我需要为需要更新的 Windows Mobile 应用程序 (C# 2.0) 创建一个状态对话框，因此 MessageBox 不可用。我试图创建一个新的 Form 类，更改大小并调用 ShowDialog，但它总是全屏显示（当然减去标题栏）。我可以弄清楚如何将其显示为小的唯一方法是将 FormBorderStyle 设置为 None，但它确实没有边框或标题栏！

我希望它仍然看起来像一个消息框（带有标题栏和边框），但是我需要实际使用一个表单以便我可以更新它。

关于如何做到这一点的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T15:20:31.307

这里的挑战是 WinMo shell 本身。不明显的是表单上的标题（在屏幕顶部）实际上不是您看到的表单的标题 - 它是一个完全不同的应用程序。因此，要让您的表单“浮动”，需要颠覆 shell 处理表单显示的方式。一种快速而肮脏的方法是将 Form BorderStyle 设置为 none，但随后您会丢失标题栏。然后一个选项是在 OnPaint 中使用 FillRect 和 DrawString 手动绘制它。不太难，也不需要任何 P/Invoke 恶作剧，但它确实要求您在布局控件时考虑新的标题。

另一种选择是使用 P/Invoke 并自己操作表单的样式位。这很好用，但请注意在代码中的正确位置执行此操作，因为必须在创建窗口时设置一些位。还要当心外壳，因为它可能想将这些位更改回您身上——因此这种机制需要更多的测试和对细节的关注。IMO 这是一条更好的路线，我[在这里更详细地介绍了它](http://blog.opennetcf.com/ctacke/PermaLink,guid,ccd42b42-9ab4-46ba-974f-2b959da7a488.aspx)。该博客条目并不是专门关于浮动表单的，但它很好地涵盖了样式操作。有关非全屏表单的更具体信息，请参阅[我的其他博客条目](http://blog.opennetcf.com/ctacke/2004/02/02/NonfullscreenFormsOnThePocketPC.aspx)。

# svn - svnserve 如何提供多个存储库？

> ID：243672
> 
> 赞同：3
> 
> 时间：2008-10-28T15:10:05.637
> 
> 标签：svn, svnserve

我已将 svnserve 配置为查看它所服务的存储库的目录“Foo”。现在我将配置从一个存储库更改为多个存储库，所有存储库都包含在一个目录“Bar”中。我重新配置了 svnserve 以查看“Bar”，但现在我的客户找不到任何存储库。我究竟做错了什么？我需要为每个存储库提供一项服务吗？

谢谢，米尔。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T15:52:23.397

您是否将客户端配置为使用 svn://svn-server/Foo ？（假设 Foo 和 Foo2 是您正在服务的目录 Bar 中的存储库）

由于您现在提供“Bar”（“svnserve -r /repositories/Bar”而不是“svnserve -r /repositories/Bar/Foo”），您应该对客户端存储库 URL 进行更改。

另一种解决方案是使用 --listen-port 参数启动具有不同端口的多个 SVN 服务器。这也会改变你的网址。

另一种选择是将新项目添加到您现有的单个存储库中；请注意，您将以这种方式拥有一个存储库配置——这意味着一组用户、更简单的访问控制等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T16:19:01.720

这个关于 svnserve 的[文档](http://svnbook.red-bean.com/en/1.0/ch06s03.html)也可能对你有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T21:36:28.943

看看[svn switch --relocate](http://svnbook.red-bean.com/nightly/en/svn.ref.svn.c.switch.html)。这应该可以帮助您更新存储库路径。

# c++-cli - 将 C++/CLI 与 NUnit 一起使用的限制

> ID：243673
> 
> 赞同：8
> 
> 时间：2008-10-28T15:10:13.653
> 
> 标签：c++-cli, nunit

[This answer](https://stackoverflow.com/questions/13699/choosing-a-c-unit-testing-toolframework#13897) to a question about C++ unit test frameworks暗示了我以前没有想到的一种可能性：使用C++/CLI和NUnit为本地C++代码创建单元测试。

我们将 NUnit 用于 C# 测试，因此将它用于 C++ 的可能性似乎很诱人。

我从未使用过托管 C++，所以我担心这种方法是否有任何实际限制？你们很多人都这样做吗？如果是这样，你的经历是怎样的？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-28T15:24:56.150

我们一直这样做。我们有许多用 C++/CLI 编写的程序集，并使用 C# 和 NUnit 来测试它们。实际上，由于我们的目标是提供与 C# 配合良好的程序集，因此这样做可以确保我们已经实现了这一目标。

您还可以在 C++/CLI 中编写 NUnit 测试并调用非托管 C++。可能最好的方法是将纯非托管 C++ 保存在一个库中，然后制作一个使用 NUnit 并链接到该库的测试程序集。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-11T23:18:23.117

如果您在混合环境中，它工作得非常好，并为您提供参数化测试以及通用测试运行器和框架的好处。

有两个缺点，在大多数情况下都不严重：

1.  如果您真的很挑剔，那么测试将不再在纯本机环境中运行，因此存在某种外部可能性，即某些东西可能在测试中工作但在运行时失败。我认为你必须做一些相当奇特的事情才能做到这一点。

2.  您依赖于能够将 C++ 代码包含到 C++/CLI 程序中。有时这可能会与标题发生冲突，它会强制您的代码使用 UNICODE 构建正常。总的来说，这是一件好事，因为它可以发现大量代码（例如 Win32 调用的 Ansi 变体的不一致使用）。请记住，它只是包含标头，因此它很可能表明您将标头暴露在太高的级别 - 您的某些包含可能应该在您的 cpp 实现文件中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-01-24T20:59:07.127

我的经验是无法使用 NUnit 通过 C++/CLI 测试 C++ 本机代码，因为您将无法加载和使用本机代码。

我尝试使用 nunit 加载与“just thread”链接的基本 c++/cli 测试 dll，这是 c++ 标准线程库的实现。测试 dll 甚至不会加载最新版本的 NUnit (2.6.2)。

所以绝对不是要走的路！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T18:09:23.153

我从来没有使用过，但是没有端口吗？也许[http://cunit.sourceforge.net/documentation.html](http://cunit.sourceforge.net/documentation.html)对你有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-21T09:18:44.853

如果测试需要由非 C++ 开发人员理解或维护，最大的担忧是 C++/CLI 语言（以前的托管 C++）本身的学习曲线。

至少需要 1-2 年的 C++ OOP 经验才能为 C++CLI/NUnit 测试项目做出贡献并解决托管本机代码接口之间出现的各种问题。（通过贡献，我的意思是能够独立工作并能够制作模拟对象，在 C++/CLI 中实现和使用本机接口等以满足所有测试需求。）

有些人可能永远无法掌握 C++/CLI，以至于无法做出贡献。

对于某些类型的具有非常苛刻的测试需求的本机软件库，C++/CLI/NUnit 是唯一能够满足所有单元测试需求同时保持测试代码敏捷并能够响应变化的组合。我推荐这本书[xUnit Test Patterns: Refactoring Test Code](https://rads.stackoverflow.com/amzn/click/com/0131495054)沿着这个方向发展。

# iphone - 保存 iphone 应用程序设置的最佳方法是什么？

> ID：243675
> 
> 赞同：2
> 
> 时间：2008-10-28T15:11:25.507
> 
> 标签：iphone, cocoa-touch, settings

我想允许用户更改应用程序的设置。但我不确定我应该在哪里保存配置。

是否为应用程序分配了任何本地空间？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-28T15:27:11.437

您应该使用`NSUserDefaults`该类来存储设置。这一切都有[据可查](https://developer.apple.com/iphone/library/documentation/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/Reference/Reference.html)。

# c# - C#如何提取PropertyCollection中属性的值？

> ID：243683
> 
> 赞同：2
> 
> 时间：2008-10-28T15:13:00.450
> 
> 标签：c#

如何提取 PropertyCollection 中的属性值？

如果我在下面一行中的“属性”上深入了解是视觉工作室，我可以看到该值，但我如何阅读它？

```
foreach (string propertyName in result.Properties.PropertyNames)
{
  MessageBox.Show(ProperyNames[0].Value.ToString()); <--Wrong!
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T15:41:42.857

使用上面的一些提示，我设法使用下面的代码获得了我需要的东西：

```
 ResultPropertyValueCollection values = result.Properties[propertyName];
    if (propertyName == "abctest")
    { 
      MessageBox.Show(values[0].ToString());
    } 
```

谢谢大家。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T15:20:32.760

尝试这个：

```
foreach (string propertyName in result.Properties.PropertyNames)
{
    MessageBox.Show(result.Properties[propertyName].ToString());
} 
```

或这个：

```
foreach (object prop in result.Properties)
{
     MessageBox.Show(prop.ToString());
} 
```

另外：框架中有几个不同的 PropertyCollections 类。这些示例基于 System.Data 类，但您也可能使用 System.DirectoryServices 类。但是，这些类都不是真正的“反射”。反射指的是不同的东西——即 System.Reflection 命名空间加上几个特殊的运算符。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T15:15:47.637

那个属性名在函数中是大写的吗？

再读一遍，我不得不承认对你对所有这些属性的追求有点困惑。这是您所追求的类属性值还是实例？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T15:22:48.823

PropertyNames 在其他地方不是大写的，下面的代码可以工作并且会显示属性的名称，但我想读取该值。'PropertyName' 只是一个字符串。

```
foreach (string propertyName in result.Properties.PropertyNames)
{
  MessageBox.Show(PropertyName.ToString());
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T15:24:50.613

我不确定您要的是什么，但我认为问题在于您看到的是属性名称而不是它们的值？

如果是这样，原因是您正在枚举 PropertyCollection.PropertyNames 集合而不是 PropertyCollection.Values 集合。尝试这样的事情：

```
foreach (object value in result.Properties.Values)
{  
    MessageBox.Show(property.ToString());
} 
```

* * *

*我假设这个问题指的是 System.DirectoryServices.PropertyCollection 类，而不是 System.Data.PropertyCollection，因为引用了 PropertyNames，但现在我不太确定。如果问题与 System.Data 版本有关，请忽略此答案。*

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T15:28:44.100

VB.NET

```
For Each prop As String In result.Properties.PropertyNames
                MessageBox.Show(result.Properties(prop).Item(0), result.Item(i).Properties(prt).Item(0))
Next 
```

我认为C#看起来像这样......

```
foreach (string property in result.Properties.PropertyNames)
{
  MessageBox.Show(result.Properties[property].Item[0]);
} 
```

如上所述，框架中有几个不同的属性集合。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-28T15:51:28.733

如果将值集合放在“if”中，则只会在实际需要时才检索它，而不是每次通过循环时检索它。只是一个建议... :)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-10-28T15:20:09.407

尝试：

```
foreach (string propertyName in result.Properties.PropertyNames)
{  MessageBox.Show(properyName.ToString()); <--Wrong!
} 
```

# iphone - UIImagePicker 从 UI 获取的图像在顶部和底部被截断

> ID：243689
> 
> 赞同：0
> 
> 时间：2008-10-28T15:15:40.990
> 
> 标签：iphone

我正在使用 UIImagePicker 拍照并保存照片。但似乎它拍摄的照片在顶部和底部被截断，这是 UIImagePicker 拍摄照片时的顶部和底部菜单。我想知道如何拍摄照片的整个屏幕。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-18T14:54:08.177

如果您允许编辑，UIImagePicker 会将所有图像裁剪为 320x320。如果您想要不同大小的东西，您必须查看原始图像和裁剪矩形，两者都在您从选择器返回的editingInfo 字典中。拥有这些后，您可以根据需要调整大小或重新裁剪。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T19:00:19.710

查看在 didFinishPickingImage: 方法中返回的“editingInfo”字典，如果 @"Original" 键有值，那么它就是真实的未裁剪图像（存储为 UIImage 对象）。

从那里您可以查看其他editingInfo 值以查看用户是否裁剪了该图像，然后您可以应用（或获取传递给您的UIImage，这是裁剪后的版本）。如果您从照片库中获取图像，则原始图像不在字典中，您只有图像传入。

# delphi - 警告。Delphi 7，Infopower 4000 中的重复资源

> ID：243691
> 
> 赞同：3
> 
> 时间：2008-10-28T15:16:01.707
> 
> 标签：delphi, compilation, delphi-7

[错误] 警告。重复资源：[错误] 类型 2 (BITMAP)，ID TWWDBRICHEDITMSWORD：[错误] 文件 C:\Borland\Delphi7\ip4000vcl7\LIB\wwrichsp.RES 资源被保留；文件 C:\Borland\Delphi7\ip4000vcl7\LIB\wwrichsp.RES 资源被丢弃。我已经在代码中搜索了相同命名的对象，比如对象。谁能给我一个线索我还能寻找什么。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T16:11:56.913

两个单元都使用相同的资源文件。大概是这样的：

```
{$R wwrichsp.RES} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T07:15:15.070

wwrichedspellxp，wwrichedspell2000；这两个同时存在时就出错。Delete wwrichedspellxp 就OK

# c++ - 正确重载 stringbuf 以替换 MATLAB mex 文件中的 cout

> ID：243696
> 
> 赞同：8
> 
> 时间：2008-10-28T15:17:18.100
> 
> 标签：c++, matlab, cout, mex, stringbuffer

MathWorks 目前不允许您`cout`在 MATLAB 桌面打开时使用 mex 文件，因为它们已重定向标准输出。他们当前的解决方法是提供一个函数[mexPrintf，他们要求您使用它](http://www.mathworks.com/support/tech-notes/1600/1605.html)。在谷歌搜索了一下之后，我认为可以扩展`std::stringbuf`课程来做我需要的事情。这是我到目前为止所拥有的。这是否足够强大，还是我需要重载其他方法或更好的方法来做到这一点？`std::cout`（如果此代码未链接到 mex 可执行文件，则在一般 UNIX 环境中寻找可移植性以及正常使用的能力）

```
class mstream : public stringbuf {
public:
  virtual streamsize xsputn(const char *s, std::streamsize n) 
  {
mexPrintf("*s",s,n);
return basic_streambuf<char, std::char_traits<char>>::xsputn(s,n);
  }
}; 

mstream mout;
outbuf = cout.rdbuf(mout.rdbuf()); 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-28T19:46:45.123

你真的不想重载`std::stringbuf`，你想重载`std::streambuf`或者`std::basic_streambuf`（如果你想支持多种字符类型），你也需要重写溢出方法。

但我也认为你需要重新考虑你的问题的解决方案。

`cout`只是一个`ostream`，所以如果所有的类/函数都接受一个，`ostream`那么你可以传入任何你喜欢的东西。例如`cout`, `ofstream`, 等

如果这太难了，那么我会创建自己的 , 版本`cout`，也许`mycout`可以在编译器时或运行时定义（取决于你想要做什么）。

一个简单的解决方案可能是：

```
#include <streambuf>
#include <ostream>

class mystream : public std::streambuf
{
public:
    mystream() {}

protected:
    virtual int_type overflow(int_type c)
    {
        if(c != EOF)
        {
            char z = c;
            mexPrintf("%c",c);
            return EOF;
        }
        return c;
    }

    virtual std::streamsize xsputn(const char* s, std::streamsize num)
    {
        mexPrintf("*s",s,n);
        return num;
    }
};

class myostream : public std::ostream
{
protected:
    mystream buf;

public:
    myostream() : std::ostream(&buf) {}
};

myostream mycout; 
```

而 cout 版本可能只是：

```
typedef std::cout mycout; 
```

运行时版本需要更多工作，但很容易实现。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-30T01:28:13.467

谢恩，非常感谢你的帮助。这是我的最终工作实现。

```
class mstream : public std::streambuf {
public:
protected:
  virtual std::streamsize xsputn(const char *s, std::streamsize n); 
  virtual int overflow(int c = EOF);
}; 
```

...

```
std::streamsize 
mstream::xsputn(const char *s, std::streamsize n) 
{
  mexPrintf("%.*s",n,s);
  return n;
}

int 
mstream::overflow(int c) 
{
    if (c != EOF) {
      mexPrintf("%.1s",&c);
    }
    return 1;
} 
```

...

```
// Replace the std stream with the 'matlab' stream
// Put this in the beginning of the mex function
mstream mout;
std::streambuf *outbuf = std::cout.rdbuf(&mout); 
```

...

```
// Restore the std stream buffer 
std::cout.rdbuf(outbuf); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-12-22T05:42:26.110

我稍微改变了 OP 的最终实现，添加了构造函数和析构函数。创建此类的对象会自动替换 中的流缓冲区`std::cout`，当对象超出范围时，会恢复原始流缓冲区。雷伊！

```
class mxstreambuf : public std::streambuf {
   public:
      mxstreambuf() {
         stdoutbuf = std::cout.rdbuf( this );
      }
      ~mxstreambuf() {
         std::cout.rdbuf( stdoutbuf );
      }
   protected:
      virtual std::streamsize xsputn( const char* s, std::streamsize n ) override {
         mexPrintf( "%.*s", n, s );
         return n;
      }
      virtual int overflow( int c = EOF ) override {
         if( c != EOF ) {
            mexPrintf( "%.1s", & c );
         }
         return 1;
      }
   private:
      std::streambuf *stdoutbuf;
}; 
```

要在 MEX 文件中使用流缓冲区，只需：

```
mxstreambuf mout;
std::cout << "Hello World!\n"; 
```

......不要担心忘记任何东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T18:19:11.370

`cout`是一个特定的字符输出流。如果您想要 a`cout`写入文件，请使用 a [`fstream`](http://www.cplusplus.com/reference/iostream/fstream/)，尤其是[`ofstream`](http://www.cplusplus.com/reference/iostream/ofstream/). 它们具有`cout`提供的相同接口。此外，如果您想获取他们的缓冲区（使用`rdbuf`），您可以。

# cocoa - Mac 开发入门

> ID：243699
> 
> 赞同：18
> 
> 时间：2008-10-28T15:18:25.570
> 
> 标签：cocoa, macos

一个有经验的 Windows 程序员需要多长时间来学习为 Mac OS X 编写简单的软件？

从哪里开始，需要哪些工具？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-28T15:21:51.023

[这个](https://rads.stackoverflow.com/amzn/click/com/0321503619)。我最近有很多 C# 方面的 Win32 API 背景编程，通过阅读这本书，我能够很快掌握 Objective-C 和 Cocoa。您会惊喜地发现，API 非常丰富而且非常棒。反射是一等公民，它使事情变得非常容易。

Xcode 当然是免费的，可以在您的 Mac OS X 安装盘上找到。

编辑：我花了大约 2 周的时间来加快速度并编写简单的应用程序。我认为这是因为语言和 API 易于学习和使用，而[Aaron Hillegass](http://www.bignerdranch.com/instructors/hillegass.shtml)的[书](https://rads.stackoverflow.com/amzn/click/com/0321503619)帮助很大。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-28T15:23:25.797

您可能想查看[这篇文章](https://stackoverflow.com/questions/162099/best-way-to-get-started-with-mac-development)以获取信息——这几乎是一个重复的问题。绝对只是使用 Xcode，我认为你会发现 Mac 社区非常有帮助 - 至少我有。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-28T15:22:33.597

首先查看[Apple Developer Connection](http://developer.apple.com/)。那里有很多文档。OS X 附带了您开始所需的所有开发工具，只需从 OSX CD 安装 XCode。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T15:23:55.717

我将从这里开始：

[http://www.cocoadevcentral.com/](http://www.cocoadevcentral.com/)

这是一个很棒的网站，有很好的学习 obj-c 和 cocoa 的资源。

这也是一本好书：

[http://oreilly.com/catalog/9780596003012/?CMP=AFC-ak_book&ATT=Learning+Cocoa+with+Objective-C](http://oreilly.com/catalog/9780596003012/?CMP=AFC-ak_book&ATT=Learning+Cocoa+with+Objective-C)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-21T21:26:38.070

好吧，首先你会得到一件连帽衫和一种自鸣得意的权利感......

除了开玩笑之外，Aaron Hillegass 的书、一个好主意和 Apple doco 都是您开始所需要的（哦，是的，还有一台 Mac）。我认为对我来说最大的障碍是搞清楚 Xcode，因为我来自 Visual Studio 背景。

需要多长时间取决于您的兴趣程度和对项目的热情。

自 Mac OS X 10.0 中的 Interface Builder 时代以来，这些工具已经走过了漫长的道路，这是肯定的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-28T15:23:21.537

我想“多长时间”的问题取决于您习惯使用的语言。

在参考资料方面，我听说过关于[“Mac OS X 的 Cocoa 编程”的](http://www.compman.co.uk/scripts/browse.asp?ref=880360)好东西，我很想有时间自己玩一下。不幸的是，日常工作占用了我足够多的时间。:)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-07T00:53:29.723

CS193E（来自斯坦福）是一门不错的课程。很多材料。真正了解类集群、委托等的使用需要一些时间，入门不需要。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-21T21:18:03.360

“Step into XCode”是对开发环境的一个很好的介绍；由于本书通过一个简单的命令行线性回归程序一直到一个相当复杂的应用程序（Core Data、Spotlight 导入程序等）来工作，因此您将通过 osmosis 学到很多东西。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-25T14:55:45.837

1.  这是小事... 在 Windows 上，我喜欢名为“在此处打开命令”的 PowerToy，它允许我从资源管理器中打开 DOS CMD 窗口并自动设置当前目录。在 MAC 上，我得到了“On My Command”，它允许您轻松创建简单的宏，并附带一个有用的库，如“在此处打开终端”、“新文本文件...”等。
2.  安装 Eclipse。我喜欢在 Windows 上使用 Eclipse，它在 MAC 上运行良好，让我有宾至如归的感觉。我什至发现 Eclipse 有 Perl 和 ActionScript 的插件。
3.  学习 Unix（如果你还不知道的话）。在编写 Windows 之前，我有多年的 Unix 经验，它派上了用场。了解 Perl 也有很大帮助。
4.  去年 10 月我开始了我的新职位，那是我从 Windows 切换到 MAC 的时候。到了三月，我对事物的理解已经相当自在了。再说了，我的开发平台是AS2和Flash中的AS2，是跨平台的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-06-25T19:11:45.273

另一种方法是试用[Qt SDK](http://qt.nokia.com/)，并编写在 Windows、Mac 和其他平台上运行的跨平台应用程序。

我是在加入 Qt 软件时开始学习 Qt 的，没过多久我就开始编写简单的软件，尽管我不是开发人员。

# sql - 如何查看 SQL ActiveRecord 生成的内容？

> ID：243701
> 
> 赞同：11
> 
> 时间：2008-10-28T15:18:57.940
> 
> 标签：sql, ruby-on-rails, ruby, activerecord

我想检查 ActiveRecord 生成的一些查询，但我不需要实际运行它们。有没有办法在查询返回结果之前获取查询？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T15:22:31.990

这两篇文章都应该可以帮助你做你想做的事。

[http://weblog.jamisbuck.org/2007/1/8/watching-activerecord-do-it-s-thing](http://weblog.jamisbuck.org/2007/1/8/watching-activerecord-do-it-s-thing)

[http://weblog.jamisbuck.org/2007/1/31/more-on-watching-activerecord](http://weblog.jamisbuck.org/2007/1/31/more-on-watching-activerecord)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T16:20:24.837

我认为它被埋葬在：

```
construct_finder_sql, 
```

[http://groups.google.com/group/rubyonrails-talk/browse_frm/thread/38c492e3939dd9bf/?pli=1](http://groups.google.com/group/rubyonrails-talk/browse_frm/thread/38c492e3939dd9bf/?pli=1)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T16:53:19.157

尾 -f 日志/development.log

在默认设置下或当您将记录器级别设置为调试时工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-27T23:24:48.410

Jamis 的文章已经过时，或者至少不适用于我的 Rails 应用程序（可能是由于其他原因，使用了 3 年的 30,000 行应用程序）。但是，这可以随时在控制台中使用：

```
ActiveRecord::Base.connection.instance_variable_set :@logger, Logger.new(STDOUT) 
```

# sql-server - 如何从 T-SQL 中的 DSN 中选择表中的数据？

> ID：243708
> 
> 赞同：0
> 
> 时间：2008-10-28T15:21:04.677
> 
> 标签：sql-server, tsql, odbc, dsn

如何从只能通过 T-SQL MS SQL Server 中的 ODBC 数据源 (DSN) 访问的数据库中获取数据，任何版本？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T01:23:22.073

阅读以下内容后，我决定创建 SSIS 包以通过 DSN 从另一个数据源获取数据。

> 使用链接服务器，您有更多的灵活性，但也有一些额外的安全问题。您以特定用户的身份链接到其他数据源，并具有该用户对链接服务器的权限。如果您只需要对少数视图的只读访问权限，则应仅授予该用户对这些对象的权限。这还不错，您可以完全控制授予该用户的权限，但是您必须对其进行管理并意识到授予过多权限可能是一个安全问题。
> 
> 考虑使用具有只读权限的链接服务器将数据从特定表/视图复制到另一个数据库中的永久表中，以代替 SSIS 包。您可以定期执行作业以将适当的数据从链接服务器复制到本地数据库并引用应用程序中的本地表。它可能比 SSIS 包更容易实现和维护，并且可能会在以后更新以使其成为实时解决方案。

[来源](http://www.eggheadcafe.com/software/aspnet/32465151/linked-servers-versus-ssi.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T15:29:43.350

选择是容易的部分，但真正的问题是如何连接到数据源。

首先，您从哪里选择数据？您是在编写代码，还是仅使用查询分析器工具 (2000) 或 Management Studio (2005)？

无论如何，您都需要设置与数据库的连接。如果您需要有关 DSN 的连接字符串的帮助，网站 www.connectionstrings.com 非常有帮助。否则，查询工具将提供对话框或向导来帮助您。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T16:07:46.643

您需要将链接服务器添加到源，然后您可以像往常一样查询它。

# c++ - 为什么使用十六进制？

> ID：243712
> 
> 赞同：63
> 
> 时间：2008-10-28T15:22:32.083
> 
> 标签：c++, c, hex

嘿！我在[http://www.gnu.org/software/m68hc11/examples/primes_8c-source.html查看这段代码](http://www.gnu.org/software/m68hc11/examples/primes_8c-source.html)

我注意到在某些情况下他们使用十六进制数字，例如第 134 行：

```
for (j = 1; val && j <= 0x80; j <<= 1, q++) 
```

现在他们为什么要使用 0x80？我对十六进制不是很好，但我发现了一个在线十六进制到十进制，它给了我 128 的 0x80。

同样在第 134 行之前，在第 114 行，他们有这个：

```
small_n = (n & 0xffff0000) == 0; 
```

十六进制到十进制给了我 4294901760 那个十六进制数。所以在这一行中，他们做了一点 AND 并将结果与​​ 0 进行比较？

为什么不直接使用号码？任何人都可以解释一下，并请给出其他情况的例子。

此外，我还看到了大行代码，其中只是十六进制数字，但从未真正理解为什么:(

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2008-10-28T15:25:02.860

在您引用的两种情况下，数字的位模式都很重要，而不是实际数字。

例如，在第一种情况下， `j`随着循环的进行，将是 1，然后是 2、4、8、16、32、64，最后是 128。

在二进制中，即

`0000:0001`, `0000:0010`, `0000:0100`, `0000:1000`, `0001:0000`, `0010:0000`,`0100:0000`和`1000:0000`.

在 C（C23 之前）或 C++（C++14 之前）中没有二进制常量的选项，但在 Hex 中更清晰一些： `0x01`, `0x02`, `0x04`, `0x08`, `0x10`, `0x20`,`0x40`和`0x80`.

在第二个示例中，目标是删除值的低两个字节。因此，给定一个 1,234,567,890 的值，我们希望最终得到 1,234,567,168。
在十六进制中，它更清楚：以 开头`0x4996:02d2`，以 . 结尾`0x4996:0000`。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-28T15:25:49.643

它有点掩码。十六进制值使查看底层二进制表示变得容易。n &`0xffff0000`返回 n 的前 16 位。`0xffff0000`表示“二进制中的 16 个 1 和 16 个 0”

`0x80`表示“1000000”，所以你从“00000001”开始，然后继续向左移动“0000010”、“0000100”等，直到“1000000”

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-10-28T15:37:44.330

十六进制（或八进制）数字和底层位模式之间存在直接映射，十进制则不是这种情况。十进制“9”表示位模式的不同，具体取决于它所在的列以及围绕它的数字 - 它与位模式没有直接关系。在十六进制中，“9”始终表示“1001”，无论是哪一列。9 = '1001'，95 = '*1001*0101' 等等。

作为我 8 位时代的遗迹，我发现 hex 是任何二进制文件的便捷简写。小玩意儿是一种垂死的技能。有一次（大约 10 年前）我在大学看到了第三年的网络论文，其中只有 10%（50 人中的 5 人左右）的人可以计算位掩码。

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-10-28T15:26:08.490

0xffff0000 很容易理解，它是 32 位值的 16 倍“1”和 16 倍“0”，而 4294901760 是魔术。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-10-28T16:51:09.457

我发现 C 系列语言一直支持八进制和十六进制但不支持二进制，这令人抓狂。我一直希望他们能直接支持二进制：

```
int mask = 0b00001111; 
```

许多年/工作前，在从事一个涉及大量位级数学的项目时，我受够了并生成了一个头文件，其中包含所有可能的二进制值（最多 8 位）的定义常量：

```
#define b0        (0x00)
#define b1        (0x01)
#define b00       (0x00)
#define b01       (0x01)
#define b10       (0x02)
#define b11       (0x03)
#define b000      (0x00)
#define b001      (0x01)
...
#define b11111110 (0xFE)
#define b11111111 (0xFF) 
```

它偶尔会使某些位级代码更具可读性。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-28T17:06:34.370

十六进制的最大用途可能是在嵌入式编程中。十六进制数用于屏蔽硬件寄存器中的各个位，或将多个数值拆分为单个 8、16 或 32 位寄存器。

在指定单个位掩码时，很多人从以下方面开始：

```
#define bit_0 1
#define bit_1 2
#define bit_2 4
#define bit_3 8
#define bit_4 16
etc... 
```

过了一会儿，他们前进到：

```
#define bit_0 0x01
#define bit_1 0x02
#define bit_2 0x04
#define bit_3 0x08
#define bit_4 0x10
etc... 
```

然后他们学会了作弊，并让编译器生成值作为编译时优化的一部分：

```
#define bit_0 (1<<0)
#define bit_1 (1<<1)
#define bit_2 (1<<2)
#define bit_3 (1<<3)
#define bit_4 (1<<4)
etc... 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-28T15:29:35.160

有时，十六进制值的可视化表示使代码更具可读性或可理解性。例如，在查看数字的十进制表示时，位掩码或位的使用变得不明显。

这有时与特定值类型必须提供的空间量有关，因此这也可能起作用。

一个典型的例子可能是二进制设置，所以我们不使用十进制来显示一些值，而是使用二进制。

假设一个对象具有一组非排他性的属性，其值为 on 或 off（其中 3 个） - 表示这些属性状态的一种方法是使用 3 位。

有效的表示是十进制的 0 到 7，但这并不那么明显。更明显的是二进制表示：

000, 001, 010, 011, 100, 101, 110, 111

此外，有些人对十六进制非常满意。另请注意，硬编码的幻数就是这样，无论使用哪种编号系统，它都不是那么重要

我希望这会有所帮助。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-28T15:40:58.037

通常使用十六进制数而不是十进制数，这是因为计算机使用位（二进制数），当您使用位时，使用十六进制数也更容易理解，因为从十六进制到二进制比从十进制到二进制更容易.

```
OxFF = 1111 1111 ( F = 1111 ) 
```

但

```
255 = 1111 1111 
```

因为

```
255 / 2 = 127 (rest 1)
127 / 2 = 63 (rest 1)
63 / 2 = 31 (rest 1)
... etc 
```

你能看到吗？从十六进制传递到二进制要简单得多。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-28T15:26:05.150

十六进制或十六进制数字表示 4 位数据，0 到 15 或 HEX 0 到 F。两个十六进制值代表一个字节。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-10-29T23:52:10.277

一个字节有 8 位。十六进制，以 16 为底，很简洁。任何可能的字节值都使用集合 0..9 中的两个字符加上 a、b、c、d、e、f 来表示。

Base 256 会更简洁。每个可能的字节都可以有自己的单个字符，但大多数人类语言不使用 256 个字符，因此 Hex 是赢家。

要了解简洁的重要性，请考虑早在 1970 年代，当您想要检查您的兆字节内存时，它是以十六进制打印出来的。打印输出将使用数千页大纸。八进制会浪费更多的树。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-10-28T18:05:29.010

更准确地说，十六进制和十进制都是数字。基数（以 10、16 为底等）是以更清晰或更方便的方式呈现这些数字的方式。

在讨论“有多少东西”时，我们通常使用小数。当我们在计算机上查看地址或位模式时，通常首选十六进制，因为通常单个字节的含义可能很重要。

十六进制（和八进制）具有它们是 2 的幂的特性，因此它们可以很好地映射分组。十六进制将 4 位映射到一个十六进制半字节 (0-F)，因此一个字节存储在两个半字节 (00-FF) 中。八进制在数字设备 (DEC) 和其他较旧的机器上很流行，但一个八进制数字映射到三位，因此它不能很好地跨越字节边界。

总的来说，基数的选择是一种让你的编程更容易的方法——使用最匹配域的那个。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-28T15:36:56.300

查看文件，这是一些非常棒的代码。希望你擅长 C 而不是将它用作教程......

当您直接在位级别或略高于位级别工作时，十六进制很有用。例如，在一个驱动程序上工作，您直接查看来自设备的位并调整结果，以便其他人可以读取连贯的结果。它是一种紧凑且易于阅读的二进制表示。

# vmware - 您如何组织 VMware Workstation 映像？

> ID：243716
> 
> 赞同：19
> 
> 时间：2008-10-28T15:23:01.803
> 
> 标签：vmware

我目前使用 VMware 工作站为我工作的各种客户创建单独的工作区。因此，对于给定的客户，我只安装特定工作所需的软件，而不必担心客户 #1 的软件 A 会弄乱客户 #2 的软件 B。

使用足够大的硬盘驱动器效果很好，但我不确定我是否充分利用了 VMware。我在设置新工作时经历的步骤是：

1.  对我保存的基本 VMware 映像执行 Windows 更新。
2.  对基础映像进行完整克隆并为新作业重命名
3.  启动新映像并根据需要进行配置/安装。

这样做了一段时间后，我现在有一组 VMware 映像，它们都处于不同的更新级别，除非我手动进入每个映像并启动更新周期。如果在我的所有图像中都需要一些新工具，我还必须四处走动并进行多次手动安装。但是我知道每个图像都是独立的（尽管一次需要 10 + Gb）并且如果单个图像发生任何事情，那么问题就不能传播到任何其他图像中，这让我感到很安全。（请注意，我会定期备份所有图像）

所以我的问题是我这样做是最好的方式，还是应该考虑链接克隆，这样我只需要在我的基本系统上进行 Windows 更新或常见应用程序安装？每种组织事物的方式的优缺点是什么？

此外，虽然我尽量不将数据文件保存在 Image 的本地磁盘中，但我发现与 Images 文件系统相比，与本地硬盘驱动器的共享似乎非常慢，因此我倾向于将工作留在图像中。我应该强迫自己不要在图像中留下数据吗？或者换一种说法，在镜像文件系统中的任何单个文件变得无法访问之前，VMware 镜像会发生多少损坏？

**编辑**

发布此问题后我的一些想法

*   有了完整的克隆，我可以将旧作品归档并从我的主硬盘中删除
*   链接克隆占用的空间比完整克隆少得多，但我担心将链接克隆归档到其他地方。
*   制作完整克隆所需的时间并不太长（5-10 分钟），我通常每周进行一次。
*   然而，我也倾向于做很多“让我们看看全新安装会发生什么”，尤其是当我记录如何为客户端安装应用程序时。
*   我发现我的 VMware 映像会在我的硬盘驱动器上造成大量碎片，因此我最终也做了比使用 VMware 之前更多的碎片整理。我不确定使用链接克隆是否会减少这种情况。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-09T02:46:32.990

我会坚持使用您当前的系统。在这种情况下，拥有独立的图像可以为您提供更多的灵活性。更新和安装可能会花费您更多时间，但这是值得的。这主要是你在做其他事情时可以在后台进行的事情，所以如果你管理好你的时间，那么花在这上面的时间应该可以忽略不计。

此外，将图像保存在自己的磁盘上或至少保存在自己的分区上可能是个好主意。如果你这样做，它不应该对系统其余部分的碎片产生任何影响。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T15:37:43.567

这真的取决于你有什么样的项目和客户。如果您有数十个客户端，则为每个客户端构建一个新的 VM 并不能很好地扩展，因为您必须使它们都保持最新。

正如您所提到的，我会警惕在主机和虚拟机之间传播文件。最好将所有依赖项保存在一个地方。

我也有兴趣在这里查看其他人的 VM 策略。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-09T02:13:17.223

我为 CohesiveFT 工作，他们是 Elastic Server 平台的开发者——所以我有偏见——但我们使用该平台向合作伙伴和客户交付项目。它允许我们为不同的项目设置组装时组件，然后为 VMware、Parallels、Xen 和 EC2 即时将它们构建到 VM 中。该服务具有标记功能，因此您可以标记软件包、服务器规范和模板并保持您的资产正常。

您还可以创建组装门户（想想用于组装虚拟服务器的内容管理系统），您可以控制甚至让客户可以访问自定义他们自己的虚拟服务器。

[http://www.elasticserver.com](http://www.elasticserver.com)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-06T16:19:53.110

您可以在[virt-manager](http://virt-manager.et.redhat.com/faq.html)快速浏览，就像旁边还有什么一样..您永远不知道，您甚至可能喜欢它..我认为拥有这样的工具可以为您带来更大的性能提升和更少的磁盘碎片整理问题。

您可能必须经历陡峭的学习曲线和转换时间才能使其全部工作。

如果更新是您的主要时间花费，请尝试[WSUS](http://technet.microsoft.com/en-us/wsus/default.aspx)，与虚拟机本身无关，但它有助于部署 Windows 更新。

最后，查看 Hanselman 关于[Invirtus](http://www.hanselman.com/blog/InvirtusVirtualMachineOptimizer.aspx)的博客，虚拟机优化处于最佳状态。

# java - 如何在运行时在 java 的 xpath 中禁用 dtd？

> ID：243728
> 
> 赞同：15
> 
> 时间：2008-10-28T15:25:38.897
> 
> 标签：java, xpath, dtd, doctype

我在文件中找到了 dtd，但无法将其删除。当我尝试在 Java 中解析它时，我得到“由：java.net.SocketException：网络无法访问：连接”，因为它的远程 dtd。我可以以某种方式禁用 dtd 检查吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-28T15:29:48.793

您应该能够指定自己的 EntityResolver，或者使用解析器的特定功能？有关一些方法，请参见[此处](https://stackoverflow.com/questions/155101/make-documentbuilderparse-ignore-dtd-references)。

一个更完整的例子：

```
<?xml version="1.0"?>
<!DOCTYPE foo PUBLIC "//FOO//" "foo.dtd">
<foo>
    <bar>Value</bar>
</foo> 
```

和xpath用法：

```
import java.io.File;
import java.io.IOException;
import java.io.StringReader;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.xpath.XPath;
import javax.xml.xpath.XPathFactory;

import org.w3c.dom.Document;
import org.xml.sax.EntityResolver;
import org.xml.sax.InputSource;
import org.xml.sax.SAXException;

public class Main {

    public static void main(String[] args) throws Exception {
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        DocumentBuilder builder = factory.newDocumentBuilder();

        builder.setEntityResolver(new EntityResolver() {

            @Override
            public InputSource resolveEntity(String publicId, String systemId)
                    throws SAXException, IOException {
                System.out.println("Ignoring " + publicId + ", " + systemId);
                return new InputSource(new StringReader(""));
            }
        });
        Document document = builder.parse(new File("src/foo.xml"));
        XPathFactory xpathFactory = XPathFactory.newInstance();
        XPath xpath = xpathFactory.newXPath();
        String content = xpath.evaluate("/foo/bar/text()", document
                .getDocumentElement());
        System.out.println(content);
    }
} 
```

希望这可以帮助...

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2010-03-01T18:13:03.113

这对我有用：

```
 SAXParserFactory saxfac = SAXParserFactory.newInstance();
  saxfac.setValidating(false);
  try {
    saxfac.setFeature("http://xml.org/sax/features/validation", false);
    saxfac.setFeature("http://apache.org/xml/features/nonvalidating/load-dtd-grammar", false);
    saxfac.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);
    saxfac.setFeature("http://xml.org/sax/features/external-general-entities", false);
    saxfac.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
  }
  catch (Exception e1) {
    e1.printStackTrace();
  } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T15:33:40.767

我以前遇到过这个问题。我通过下载和存储 DTD 的本地副本然后针对本地副本进行验证来解决它。您需要编辑 XML 文件以指向本地副本。

```
<!DOCTYPE root-element SYSTEM "filename"> 
```

更多信息在这里： [http ://www.w3schools.com/dtd/dtd_intro.asp](http://www.w3schools.com/dtd/dtd_intro.asp)

我认为您也可以在解析器中手动将某种 validateOnParse 属性设置为“false”。取决于您用于解析 XML 的库。

更多信息在这里：[http ://www.w3schools.com/dtd/dtd_validation.asp](http://www.w3schools.com/dtd/dtd_validation.asp)

# c - 如何在 Visual Studio 中编译 Labview CIN？

> ID：243734
> 
> 赞同：1
> 
> 时间：2008-10-28T15:27:03.433
> 
> 标签：c, visual-studio, labview, cin

我正在尝试使用 Visual Studio 2003 编译 labview CIN。

我已按照[此处](http://zone.ni.com/devzone/cda/tut/p/id/3172)的教程进行操作，但出现以下错误：

> 项目：错误 PRJ0019：工具从“执行自定义构建步骤”返回错误代码

有谁知道是什么原因造成的？我尝试了在专家交流[问题中找到的这个](http://www.experts-exchange.com/Microsoft/Development/.NET/Visual_CPP/Q_23144843.html)[链接](http://detritus.blogs.com/lycangeek/2006/03/building_cins_w.html)，但它似乎不相关。

有没有更简单的方法来使用 Visual Studio 构建 CIN？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T15:42:50.157

好的，解决了。

原来这是与 labview 8.5 捆绑的 lsvbutil.exe 的问题。解决方法是用 8.2 的版本替换

见[http://digital.ni.com/public.nsf/allkb/0029165B53320B2886257369005826A1](http://digital.ni.com/public.nsf/allkb/0029165B53320B2886257369005826A1)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T15:35:05.227

请发布整个错误。您的链接中定义的自定义构建步骤似乎不起作用。

在“自定义构建步骤”->“常规”页面上，键入：

```
"$(CINTOOLS_DIR)\lvsbutil" "$(TargetName)" -d "$(ProjectDir)$(OutDir)" 
```

在命令行字段中并`$(OutDir)$(TargetName).lsb`在输出字段中键入。

尝试将其粘贴到命令行并运行它。我怀疑您没有设置环境变量，或者它们没有指向正确的位置。

# sharepoint - SharePoint 中的跟踪权限

> ID：243742
> 
> 赞同：3
> 
> 时间：2008-10-28T15:28:44.490
> 
> 标签：sharepoint

SharePoint（即 MOSS 2007）中是否有任何类型的“开箱即用”系统，可用于跟踪/管理权限。我们有一个相对较小的安装，但我可以很容易地看到特殊用户/站点的特殊权限失控。我希望在 SharePoint 中有一些预置的东西可以帮助解决这个问题，但如果有的话，我不知道在哪里。

如果这在 SharePoint 中不可用，是否有人会推荐任何第 3 方工具？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-06T18:35:37.117

如果有人好奇，我最终为此使用了[SharePoint SUSHI](http://www.codeplex.com/sushi)。它有一些满足我需要的有用的“安全报告”。还包括其他一些好东西。最好的部分是它是免费的。:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T15:42:00.657

不幸的是，我在 SharePoint 中没有发现任何开箱即用的功能，可用于管理或跟踪用户权限。您总是有机会进行自定义。但是，有一些第三方工具。我发现用于简单管理 SharePoint 的最佳工具是 Universal SharePoint Manager v2007。

该应用程序具有一些出色的工具，可用于分析安全性和有关权限的信息。

这是您最感兴趣的功能的直接链接：[http ://www.idevfactory.com/products/uspm2007/features/sharepoint%20user%20site%20security%20analyzer.aspx](http://www.idevfactory.com/products/uspm2007/features/sharepoint%20user%20site%20security%20analyzer.aspx)

我自己没有使用过 USPM。我使用了具有部分功能的 SWAT 工具。iDevFactory 确实在他们的应用程序方面做得很好，我发现得到你想要的东西是相当不错的蚂蚁。

祝你好运！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T19:36:10.887

这是一个获得好评的免费选项[http://www.codeplex.com/AccessChecker](http://www.codeplex.com/AccessChecker)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-09T10:47:03.103

SharePoint 管理工具包包含一个权限工具，可显示用户或组的有效权限。Becky Bertram 有[一篇关于此的博客文章](http://blog.beckybertram.com/Lists/Posts/Post.aspx?ID=56)。

[请参阅SharePoint 团队博客](http://blogs.msdn.com/sharepoint/archive/2009/08/27/announcing-the-fourth-release-of-the-microsoft-sharepoint-administration-toolkit.aspx)上的下载信息。

# security - 防止网站删除

> ID：243744
> 
> 赞同：1
> 
> 时间：2008-10-28T15:29:14.583
> 
> 标签：security, sharepoint, permissions

在我们的 Sharepoint 实施中，用户已被授予网站集管理员权限。在某些情况下，他们设法删除了一个子网站甚至整个网站集。我希望能够阻止这一点，但不是开发人员，我发现它非常棘手。

我查看[了 MSIT 站点删除捕获工具](http://www.codeplex.com/governance/release/projectreleases.aspx?releaseid=3830)，试图了解它是如何工作的，而且它的接缝相当简单。我想覆盖删除功能并完全阻止它或让用户输入密码。我看不到任何完全覆盖默认行为的方法，因为它看起来像 MSIT 工具只是添加了一些功能（备份站点）然后回退到默认行为。

所以我的问题是，我可以阻止默认行为还是只能在它触发之前或之后添加操作？

提前致谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T02:43:19.167

更改用户权限可能是最好的方法。网站集管理员对于普通用户来说是一个疯狂的访问级别。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T18:53:18.507

两个答案：

1.  如果不自己编写代码或购买产品来帮助您进行“站点生命周期管理”或“站点治理”或他们用来描述此类事情的其他一些模糊术语，您就无法阻止站点删除。
2.  站点删除捕获工具可能对您来说已经足够了。它不会阻止任何类型的删除，但它确实需要一个粗略的备份，（希望）允许您恢复他们删除的任何内容。我们在生产中使用这个工具，它可以工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T19:18:11.967

您可以尝试编辑站点设置 aspx 文件并注释掉删除站点链接，没有设置可以尝试。虽然用户可以通过其他方式删除该站点，但它会阻止最常用的方法。

重要站点的另一种选择是确保该站点具有子站点，如果尚不存在子站点，请创建一个并且不使用任何访问权限。用户不会看到该站点，并且会阻止他们删除父站点。

至于编程，在之前的行为中你可以返回一个 false 来停止动作。只需确保放置一个解决方法，以便您可以删除一个站点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-29T19:14:06.453

网站集管理员有权删除网站，并且应该保持这种状态。我们修改了 MSIT 来做更多的事情

限制用户权限的最佳方法是将用户放入正确的 SharePoint 组（即所有者、成员、访问者），或者您可以创建一个具有正确权限/权限级别的新组。

# plugins - 如何最好地使用 Trac 进行敏捷开发？

> ID：243749
> 
> 赞同：32
> 
> 时间：2008-10-28T15:30:08.917
> 
> 标签：plugins, agile, scrum, trac

我们使用[Trac](http://trac.edgewall.org)作为我们的错误跟踪/开发/wiki 系统，我想知道是否有人有经验并使用了一些 Trac Agile/Scrum 插件或功能？你有什么推荐的吗？

或者将 Trac 票证复制为死树用户故事索引卡和手绘燃尽图会更好吗？

* * *

请注意，我在[这里](https://stackoverflow.com/questions/81144)发现了一个类似的问题。尽管它专门针对 Scrum。他们推荐[Agilo](http://www.agile42.com/cms/pages/download/)。有人试过Agilo吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-10-31T23:12:10.727

对于一个并置的团队，我总是在索引卡上复制用户故事。卡片墙比任何软件工具都更具协作性和易用性。而最重要的是，*它在你的脸上*。

燃烧图表也是如此。以我的经验，软件图表会被少数人在线查看，通常是一种拉动媒介。一张大的手绘海报（定期更换）会引起每个人的注意，并作为临时讨论的孵化器。

能够在您的每日 Scrum 会议中指出它们也是非常有价值的。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-17T20:16:17.783

这就是我们将 Trac 用于像 sprint 一样的 scrum 的方式：

*   我们使用 Trac 中的里程碑来识别 sprint。
*   有一个默认的 Backlog 里程碑，我们收集所有新票证。
*   在每个 sprint 之前，我们将积压的工单移至当前版本。
*   在里程碑页面上，我们可以使用 wiki 语法添加有关 sprint 的回顾和其他信息。

所以现在只是默认的 Trac 功能，没有任何插件来保持它的轻量级。随着我们变得更好，我们可能会添加诸如燃尽图之类的功能，或者可能会切换到另一个工具，但我们希望首先让流程到位。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-01T09:20:11.047

回答晚了，但这更多的是分享我迄今为止与 Trac+Agilo 的经验。

为了快速回答您的问题，Agilo 可能是使用 Trac 进行敏捷开发的最佳选择。

现在来安装和使用安装非常容易。我们使用了他们的最新版本 0.7.3.3。它可以完美地安装在 Trac 0.11 和 Python 2.5 上。不要忘记安装 libjpeg 和 python 映像库。需要注意的是，我们使用了 virtualenv，它使事情变得更容易。

进一步的使用非常简单。对于 wiki，我更喜欢 Trac 的旧式简洁外观，而不是 Agilo 的自定义。除此之外，所有事情都可以正常工作。

在他们的邮件列表中，我注意到他们计划在未来提供多项目支持。总之，我推荐用于 Trac 的 Agilo 插件。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-17T02:09:12.890

是的，我在 Trac 安装中安装了 Agilo。

看起来很酷，包括漂亮的燃尽图。

不幸的是，在我能够真正使用它之前，我离开了我安装它的公司。

安装很痛苦（Ubuntu Ibex）——我在[Agilo Google Group](http://groups.google.com/group/agilo/browse_thread/thread/e5fde28e26b79bf8/628cc626fe4262ca?lnk=gst&q=sasserstyl#628cc626fe4262ca)上记录了精确的步骤。

问题（一如既往）是集成到 PM 和 CEO 喜欢看到的事物的业务端（例如，估计时间与实际时间）。有（如前所述）其他产品可以解决这个问题（我相信 FogBugz 会解决这个问题），但我（和团队）喜欢 Trac，所以我们解决了这个问题。

哦，还有一件事；看起来它引入了相当多的开销（即，您必须在 trac 上花费更多时间才能充分利用它），但就像我说的那样，我没有机会真正在愤怒中使用它。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-11T21:18:49.217

我们之前使用 Trac 和一个燃尽插件，然后去了 Redmine。我们发现 Redmine 对于存储库查看和问题界面来说很糟糕。我们实际上希望再次搬回 Trac。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-28T22:24:18.503

[Bitten](http://bitten.edgewall.org/)是一个用于持续集成的 Trac 插件，可用于在签入时进行自动构建，它提供了敏捷过程的关键部分（快速反馈）。我个人没有使用过任何其他的 Trac 插件，所以我无法评论它们。但是，我怀疑里程碑的本地 Trac 功能可以很容易地被用作迭代标记（其中每个里程碑代表迭代的结束）。由于里程碑已经可以用于标记功能的“到期日期”，因此您不需要太多的修改方式来使用它们。

从那里开始，使用工单作为用户故事，并将它们与里程碑联系起来（我确信这可以在最坏的情况下手动完成）将为您提供一种跟踪速度并让团队了解进度（以及需要进行的更改）的基本方法也做了）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-16T00:03:57.397

我们将 Trac wiki 用于：

*   每个功能的要求列表
*   功能的技术规格列表（如果有）
*   版本列表及其功能
*   已部署的环境，带有指向所有实例的链接
    *   有一个用于发出 Web 请求的宏，因此我们可以列出每个 env 具有的版本等
    *   （有一个 GraphViz 插件，对简单的绘图很有帮助）

每个“功能”的票务系统中还有一张票，用于保持总积压和当前/下一个冲刺的计划。

然后我们在 sprint 计划期间为每个功能写一堆卡片。

事情还有一个更具操作性的方面。我们在 Ops 的每个 sprint 中保留一个人，所以我们有一个人专门负责被团队以外的人打断。团队的其他成员可以专注于交付功能。

每个 bug/ops 任务都会得到一张票，但一旦我们开始处理它，它就会得到一张卡片并开始全面移动。这样它就可以获得可见性，我们不会忘记让测试人员等参与进来。

Scrum 是相当有触觉的，所以我认为把太多的东西放在物理工作环境之外不会很好。但最终你的团队需要找到一个有效的平衡点。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-17T21:19:55.183

对于完全不同的事情，使用[Trac](http://trac.edgewall.org/)进行敏捷开发的最佳方法可能是[将](http://www.redmine.org/wiki/redmine/RedmineMigrate)所有内容迁移到[Redmine](http://www.redmine.org/wiki/redmine/Features)。它支持 Trac 的核心功能以及一些附加功能，包括多个项目、甘特图、论坛、DCVS 等，尽管它看起来还[没有完全](http://www.redmine.org/issues/show/436)实现。一些好事正在酝酿中。

[Daniel Srb](http://www.redmine.org/boards/1/topics/show/1214)（在评论中）有一个他一直在研究的[redmind 敏捷插件](http://www.redmine.org/attachments/916/report.png)，看起来很有希望。您也许可以联系并查看他是否打算发布它（很久以前）。

过去我们已经成功地使用了两种产品，[Trac](http://trac.edgewall.org/)用于门票，[xplanner](http://xplanner.org/)用于规划。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-07-03T14:30:28.190

Agilo for Scrum 摇滚，最新版本使用客户端生成的图表，因此不再有依赖关系，安装更容易:-) [Agile42刚刚发布了一个 Pro 版本，它通过漂亮直观的](http://www.agile42.com)[规划板](http://www.agile42.com/cms/pages/agilo/#agilo_family)丰富了 Agilo 体验，非常酷截屏:-)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-01-06T16:07:07.720

我们最近开始使用 Scrumban。

基本上是看板，每天的站立会议涵盖经典的敏捷 Scrum 问题——你前一天做了什么？你今天打算做什么？你有任何阻滞剂吗？

我们围绕物理看板执行此操作，它非常适合可视化工作流程和团队协作，但我们还希望看板的数字形式能够仔细检查跟踪使用情况与物理板。

为了寻找可行的方法，我发现了这篇[关于在 trac 中重新创建看板的数字版本的聪明帖子](https://stackoverflow.com/questions/1791474/kanban-board-plug-in-for-trac)。

它非常直接和简单，我能够轻松地为我们的工作流程操纵这种方法，并且您可以根据您的敏捷 Scrum 迭代方法对其进行调整（或者如果您能够放弃时间盒方法，请尝试 Scrumban） .

# bash - 如何通过 SSH 远程自动运行命令到并行的多台服务器？

> ID：243750
> 
> 赞同：21
> 
> 时间：2008-10-28T15:30:10.010
> 
> 标签：bash, ssh, command, sysadmin

我已经搜索了一些类似的问题，但除了运行一个命令或一些带有以下项目的命令之外：

```
ssh user@host -t sudo su - 
```

但是，如果我基本上需要一次在（比方说）15 台服务器上运行脚本怎么办。这在 bash 中可行吗？在一个完美的世界中，如果可能的话，我需要避免安装应用程序。为了论证起见，假设我需要在 10 个主机上执行以下操作：

1.  部署一个新的 Tomcat 容器
2.  在容器中部署一个应用程序，并对其进行配置
3.  配置 Apache 虚拟主机
4.  重新加载 Apache

我有一个脚本可以完成所有这些工作，但它依赖于我登录所有服务器，从 repo 中提取一个脚本，然后运行它。如果这在 bash 中不可行，您有什么替代方案？我是否需要更大的锤子，例如 Perl（Python 可能是首选，因为我可以保证 Python 在 RHEL 环境中的所有机器上，这要归功于 yum/up2date）？如果有人可以向我指出任何有用的信息，我们将不胜感激，特别是如果它在 bash 中是可行的。我会满足于 Perl 或 Python，但我就是不知道这些（正在研究）。谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-28T16:16:33.567

您可以运行 che 和 Yang 所示的本地脚本，和/或您可以使用 Here 文档：

```
ssh root@server /bin/sh <<\EOF  
wget http://server/warfile    # Could use NFS here  
cp app.war /location  
command 1  
command 2  
/etc/init.d/httpd restart  
EOF 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-28T16:19:07.260

通常，我只会使用 Expect 的原始 Tcl 版本。您只需要在本地计算机上安装它。如果我在使用 Perl 的程序中，我会使用[Net::SSH::Expect](http://search.cpan.org/dist/Net-SSH-Expect/)来执行此操作。其他语言也有类似的“期望”工具。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-28T22:26:20.480

如何在多台服务器上同时运行命令的问题前几天出现在 Perl 邮件列表中，我将给出与[那里](http://www.nntp.perl.org/group/perl.beginners/2008/10/msg104506.html)相同的建议，即使用`gsh`：

[http://outflux.net/unix/software/gsh](http://outflux.net/unix/software/gsh)

gsh 类似于[已经给出](https://stackoverflow.com/a/243792/32453)`for box in box1_name box2_name box3_name`的 " " 解决方案，但我发现 gsh 更方便。您设置了一个 /etc/ghosts 文件，其中包含您的服务器组，例如 web、db、RHEL4、x86_64 或其他（man ghosts）组，然后在调用 gsh 时使用该组。

```
[pdurbin@beamish ~]$ gsh web "cat /etc/redhat-release; uname -r"
www-2.foo.com: Red Hat Enterprise Linux AS release 4 (Nahant Update 7)
www-2.foo.com: 2.6.9-78.0.1.ELsmp
www-3.foo.com: Red Hat Enterprise Linux AS release 4 (Nahant Update 7)
www-3.foo.com: 2.6.9-78.0.1.ELsmp
www-4.foo.com: Red Hat Enterprise Linux Server release 5.2 (Tikanga)
www-4.foo.com: 2.6.18-92.1.13.el5
www-5.foo.com: Red Hat Enterprise Linux Server release 5.2 (Tikanga)
www-5.foo.com: 2.6.18-92.1.13.el5
[pdurbin@beamish ~]$ 
```

例如，您还可以使用 web+db 或 web-RHEL4 组合或拆分幽灵组。

我还要提到，虽然我从未使用过 shmux，[但它的网站](http://web.taranis.org/shmux)包含一个软件列表（包括 gsh），可让您同时在多个服务器上运行命令。 [Capistrano](http://www.capify.org)已经被提及并且（据我了解）也可能在该列表中。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-28T15:47:56.230

看看期望 ( `man expect`)

我过去曾使用 Expect 完成过类似的任务。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-28T15:52:47.017

您可以将本地脚本通过管道传输到远程服务器并使用一个命令执行它：

```
ssh -t user@host 'sh' < path_to_script 
```

这可以通过使用公钥认证和用脚本包装来执行并行执行来进一步自动化。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-11-09T08:57:27.177

你可以试试[paramiko](http://www.lag.net/paramiko/)。这是一个纯 python ssh 客户端。您可以对 ssh 会话进行编程。无需在远程机器上安装任何东西。

请参阅这篇关于如何使用它[的精彩文章。](http://jessenoller.com/2009/02/05/ssh-programming-with-paramiko-completely-different/)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-28T15:33:34.760

为您提供结构，无需实际代码。

1.  使用 scp 将您的安装/设置脚本复制到目标框。
2.  使用 ssh 在远程机器上调用您的脚本。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-15T09:19:05.020

[pssh](http://www.theether.org/pssh/)可能很有趣，因为与这里提到的大多数解决方案不同，这些命令是并行运行的。

（为了我自己的使用，我编写了一个更简单的小脚本，与 GavinCattell 的非常相似，它[在此处记录 - 法语](http://www.bortzmeyer.org/maintenir-plusieurs-machines-identiques.html)）。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-15T09:53:55.997

您是否看过[Puppet](http://reductivelabs.com/trac/puppet)或[Cfengine 之](http://www.cfengine.com/)类的东西。他们可以做你想做的事，而且可能更多。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-04-30T19:10:16.443

对于那些偶然发现这个问题的人，我将提供一个使用[Fabric](http://fabfile.org)的答案，它完全解决了上述问题：Running absolute commands on multiple hosts over ssh。

安装 fabric 后，您将创建一个`fabfile.py`, 并实现可以在远程主机上运行的*任务。*例如，*重新加载 Apache*的任务可能如下所示：

```
from fabric.api import env, run

env.hosts = ['host1@example.com', 'host2@example.com']

def reload():
    """ Reload Apache """
    run("sudo /etc/init.d/apache2 reload") 
```

然后，在您的本地计算机上运行`fab reload`，​​该`sudo /etc/init.d/apache2 reload`命令将在`env.hosts`.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-28T15:37:21.587

虽然这是一个复杂的话题，但我强烈推荐[Capistrano](http://capistranorb.com/)。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-28T15:43:36.723

您可以像以前一样执行此操作，只需编写脚本而不是手动执行。以下代码远程连接到名为“loca”的机器并在那里运行两个命令。您需要做的只是插入要在其中运行的命令。

```
che@ovecka ~ $ ssh loca 'uname -a; 回声某事_else'
Linux 本地 2.6.25.9 #1 (blahblahblah)
别的东西
```

然后，要遍历所有机器，请执行以下操作：

```
用于 box1_name 中的框 box2_name box3_name
做
   ssh $box 'commmands_to_run_everywhere'
完毕
```

为了使这个 ssh 事情在不输入密码的情况下一直工作，您需要设置密钥身份验证。[您可以在IBM developerworks](http://www.ibm.com/developerworks/library/l-keyc.html)上了解它。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-28T15:45:58.637

[您可以使用cluster ssh](http://debaday.debian.net/2007/12/09/clusterssh-control-serveral-ssh-sessions-via-a-single-interface/ "集群 ssh")之类的工具一次在多台服务器上运行相同的命令。该链接是关于 Debian 软件包每日博客上集群 ssh 的讨论。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-28T17:24:52.790

好吧，对于第 1 步和第 2 步，没有 Tomcat 管理器 Web 界面；您可以使用带有 libwww 插件的 curl 或 zsh 编写脚本。

对于 SSH，您希望：1) 不会提示输入密码（使用密钥） 2) 在 SSH 的命令行上传递命令，这类似于`rsh`在受信任的网络中。

其他帖子已经向您展示了该怎么做，我可能也会使用`sh`，但我很想使用`perl`like`ssh tomcatuser@server perl -e 'do-everything-on-one-line;'`或者您可以这样做：

**要么** `scp the_package.tbz tomcatuser@server:the_place/.`
`ssh tomcatuser@server /bin/sh <<\EOF`
*定义类似的东西，* `TOMCAT_WEBAPPS=/usr/local/share/tomcat/webapps`
`tar xj the_package.tbz` **要么** `rsync rsync://repository/the_package_place`
`mv $TOMCAT_WEBAPPS/old_war $TOMCAT_WEBAPPS/old_war.old`
`mv $THE_PLACE/new_war $TOMCAT_WEBAPPS/new_war`
`touch $TOMCAT_WEBAPPS/new_war`[您通常不必重新启动tomcat]
`mv $THE_PLACE/vhost_file $APACHE_VHOST_DIR/vhost_file`
`$APACHECTL restart`[可能需要以apache用户身份登录才能移动该文件并重新启动]
`EOF`

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-29T14:38:11.813

您需要 DSH 或分布式 shell，它在集群中使用很多。这是链接：[dsh](http://www.netfort.gr.jp/~dancer/software/dsh.html.en)

您基本上有节点组（其中包含节点列表的文件），并且您指定要在哪个节点组上运行命令，然后您将使用 dsh，就像您使用 ssh 在它们上运行命令一样。

```
dsh -a /path/to/some/command/or/script 
```

它将同时在所有机器上运行该命令并返回带有主机名前缀的输出。命令或脚本必须存在于系统上，因此共享的 NFS 目录对这类事情很有用。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2012-06-06T13:06:15.447

创建访问的所有机器的主机名 ssh 命令。通过 Quierati [http://pastebin.com/pddEQWq2](http://pastebin.com/pddEQWq2)

```
#Use in .bashrc
#Use "HashKnownHosts no" in ~/.ssh/config or /etc/ssh/ssh_config 
# If known_hosts is encrypted and delete known_hosts

[ ! -d ~/bin ] && mkdir ~/bin
for host in `cut -d, -f1 ~/.ssh/known_hosts|cut -f1 -d " "`;
  do
    [ ! -s ~/bin/$host ] && echo ssh $host '$*' > ~/bin/$host
done
[ -d ~/bin ] && chmod -R 700 ~/bin
export PATH=$PATH:~/bin 
```

前执行：

```
$for i in hostname{1..10}; do $i who;done 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2013-09-17T20:35:04.620

有一个名为[FLATT（灵活自动化和故障排除工具）](http://flattsolutions.com)的工具，它允许您通过单击按钮在多个 Unix/Linux 主机上执行脚本。它是一个在 Mac 和 Windows 上运行的桌面 GUI 应用程序，但也有一个命令行 java 客户端。
您可以创建批处理作业并在多个主机上重复使用。
需要 Java 1.6 或更高版本。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-29T17:00:16.503

我不确定这种方法是否适用于你想要的一切，但你可以尝试这样的事情：

```
$ cat your_script.sh | ssh your_host bash 
```

它将在远程服务器上运行脚本（位于本地）。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-08-28T19:54:31.430

只需阅读一篇使用[setsid的新](http://linux.die.net/man/2/setsid)[博客](https://www.exratione.com/2014/08/bash-script-ssh-automation-without-a-password-prompt/)，除了主流内核之外，无需任何进一步的安装/配置。在 Ubuntu14.04 下测试/验证。

虽然作者也有非常清晰的解释和示例代码，但这里有一个快速浏览的神奇部分：

```
#----------------------------------------------------------------------
# Create a temp script to echo the SSH password, used by SSH_ASKPASS
#----------------------------------------------------------------------
SSH_ASKPASS_SCRIPT=/tmp/ssh-askpass-script
cat > ${SSH_ASKPASS_SCRIPT} <<EOL
#!/bin/bash
echo "${PASS}"
EOL
chmod u+x ${SSH_ASKPASS_SCRIPT}

# Tell SSH to read in the output of the provided script as the password.
# We still have to use setsid to eliminate access to a terminal and thus avoid
# it ignoring this and asking for a password.
export SSH_ASKPASS=${SSH_ASKPASS_SCRIPT}
......
......
# Log in to the remote server and run the above command.
# The use of setsid is a part of the machinations to stop ssh 
# prompting for a password.
setsid ssh ${SSH_OPTIONS} ${USER}@${SERVER} "ls -rlt" 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-04-20T16:10:08.020

我发现无需安装或配置太多软件的最简单方法是使用普通的旧 tmux。假设您有 9 台 linux 服务器。选择一个盒子作为你的主要。启动一个 tmux 会话：

```
tmux 
```

然后通过执行 8 次创建 9 个拆分 tmux 窗格：

```
ctrl-b + % 
```

[![在此处输入图像描述](https://i.stack.imgur.com/DCOLh.png)](https://i.stack.imgur.com/DCOLh.png)

现在 SSH 进入每个窗格中的每个框。您需要了解一些 tmux 快捷方式。要导航，请按：

```
ctrl+b <arrow-keys> 
```

一旦您登录到每个窗格上的所有框。现在打开窗格同步，它可以让您在每个框中键入相同的内容：

```
ctrl+b :setw synchronize-panes on 
```

现在，当您按任意键时，它将显示在每个窗格上。要关闭它，只需打开关闭即可。要循环调整窗格大小，请按 ctrl+b <空格键>。

这对我来说效果更好，因为我需要查看每个终端输出，因为有时在下载或升级软件时服务器会因任何原因崩溃或挂起。任何问题，您都可以单独隔离和解决。

# vb.net - 如何在 VB.NET 中将 List(Of T) 转换为 ObservableCollection(Of T)？

> ID：243752
> 
> 赞同：20
> 
> 时间：2008-10-28T15:31:49.803
> 
> 标签：vb.net, collections, list

有没有办法在不遍历列表并将项目添加到 ObservableCollection 的情况下做到这一点？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-28T15:36:49.293

不，没有办法直接将列表转换为可观察的集合。您必须将每个项目添加到集合中。但是，下面是允许框架枚举值并为您添加它们的快捷方式。

```
Dim list as new List(of string)
...some stuff to fill the list...
Dim observable as new ObservableCollection(of string)(list) 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-08-25T13:29:59.617

我迟到了，但如果您需要循环，我想分享这个有趣的片段，用于将列表转换为 ObservableCollection：

```
public static ObservableCollection<T> ToObservableCollection<T>(this IEnumerable<T> coll)
{
    var c = new ObservableCollection<T>();
    foreach (var e in coll) c.Add(e);
    return c;
} 
```

您可以将集合传递给 ObservableCollection 构造函数：

```
List<Product> myProds = ......
ObservableCollection<Product> oc = new ObservableCollection<Product>(myProds); 
```

现在你必须将这些翻译成 VB.NET :)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-10-25T13:15:22.327

```
//Create an observable collection TObservable.

ObservableCollection (TObservable) =new ObservableCollection (TObservable)();

//Convert List items(OldListItems) to collection

OldListItems.ForEach(x => TObservable.Add(x)); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-03-04T12:44:39.823

澄清 Junior 在说什么（如果您使用返回 IEnumerable 的 LINQ，请添加一个示例）：

```
//Applications is an Observable Collection of Application in this example
List<Application> filteredApplications = 
      (Applications.Where( i => i.someBooleanDetail )).ToList();
Applications = new ObservableCollection<Application>( filteredApplications ); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-01-30T11:28:22.670

即使我迟到了，我想分享一个对[Junior](https://stackoverflow.com/users/66708/junior-mayhe)答案的快速增强：让开发人员定义用于将可观察集合对象从源集合转换为目标集合的转换器函数。

如下所示：

```
public static ObservableCollection<TDest> ToObservableCollection<TDest, TSource>(this IEnumerable<TSource> coll, Func<TSource, TDest> converter)
    {
        var c = new ObservableCollection<TDest>();
        foreach (var e in coll)
        {
            c.Add(converter(e));
        }
        return c;
    } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-12-25T04:53:36.147

```
ObservableCollection<yourobjectname> result = new ObservableCollection<yourobjectname>(yourobjectlist); 
```

# java - 对java来说不是严格的xpath

> ID：243777
> 
> 赞同：0
> 
> 时间：2008-10-28T15:39:07.933
> 
> 标签：java, xpath

你知道java的任何不严格的xpath吗？（我希望它不检查 dtd 和架构）如果它不关心正确的 xml，那就太酷了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T12:38:42.507

您无需架构有效的 XML 即可使用 XPath。对于非格式良好的 XML，我认为您有两种选择：

*   从文件中生成一个有效的 DOM 树。建议通过 JTidy 或 TagSoup 吸文件。一旦你有了它，你就可以像往常一样使用 XPath。
*   生成一些其他树形模型，然后为 Jaxen 的 XPath 使用定制的导航器。（Jaxen 允许您在所需的任何模型上使用 XPath）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T16:07:12.867

好的，首先，“正确的 xml”可以用几种方式解释。如果您的意思是“格式不正确”（缺少尖括号、重叠元素等），那么任何版本的 xpath 都不会对此做任何有用的事情。使用某种正则表达式会更好。如果您的 XML 格式不正确，我希望您对它的格式不正确有一些线索，否则您就没有希望得到任何结果。

如果您实际上的意思是“无效”，这仅仅意味着它不针对模式或 DTD 进行验证，那么您可以使用与“local-name()”函数进行比较的谓词。例如，如果您想查找“/foo/bar”元素，忽略模式，那么您的 xpath 将如下所示：

```
/*[local-name()='foo']/*[local-name()='bar'] 
```

# sql - SELECT 语句后需要行计数：最佳 SQL 方法是什么？

> ID：243782
> 
> 赞同：42
> 
> 时间：2008-10-28T15:40:58.037
> 
> 标签：sql, odbc, sqlncli

我正在尝试从单个表中选择一列（无连接），并且我需要行数的计数，最好是在开始检索行之前。我已经采用了两种方法来提供我需要的信息。

**方法一：**

```
SELECT COUNT( my_table.my_col ) AS row_count
  FROM my_table
 WHERE my_table.foo = 'bar' 
```

然后

```
SELECT my_table.my_col
  FROM my_table
 WHERE my_table.foo = 'bar' 
```

或**方法 2**

```
SELECT my_table.my_col, ( SELECT COUNT ( my_table.my_col )
                            FROM my_table
                           WHERE my_table.foo = 'bar' ) AS row_count
  FROM my_table
 WHERE my_table.foo = 'bar' 
```

我这样做是因为我的 SQL 驱动程序（SQL Native Client 9.0）不允许我在 SELECT 语句上使用 SQLRowCount，但我需要知道结果中的行数，以便在分配信息之前分配一个数组。不幸的是，在我的程序的这个区域中，使用动态分配的容器不是一个选项。

我担心可能会出现以下情况：

*   SELECT for count 发生
*   出现另一条指令，添加或删除一行
*   SELECT for data 发生，突然数组大小错误。
    - 在最坏的情况下，这将尝试写入超出数组限制的数据并使我的程序崩溃。

方法 2 是否禁止此问题？

另外，这两种方法中的一种会更快吗？如果是这样，是哪个？

最后，是否有更好的方法我应该考虑（也许是一种指示驱动程序使用 SQLRowCount 返回 SELECT 结果中的行数的方法？）

对于那些询问的人，我正在使用带有上述 SQL 驱动程序（由 Microsoft 提供）的 Native C++。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-28T17:23:28.923

如果您使用的是 SQL Server，则在查询之后您可以选择[@@RowCount](https://docs.microsoft.com/en-us/sql/t-sql/functions/rowcount-transact-sql)函数（或者如果您的结果集可能有超过 20 亿行，请使用[RowCount_Big()](https://docs.microsoft.com/en-us/sql/t-sql/functions/rowcount-big-transact-sql)函数）。这将返回前一个语句选择的行数或受插入/更新/删除语句影响的行数。

```
SELECT my_table.my_col
  FROM my_table
 WHERE my_table.foo = 'bar'

SELECT @@Rowcount 
```

或者，如果您想在发送的结果中包含类似于方法 #2 的行数，您可以使用[OVER 子句](https://docs.microsoft.com/en-us/sql/t-sql/queries/select-over-clause-transact-sql)。

```
SELECT my_table.my_col,
    count(*) OVER(PARTITION BY my_table.foo) AS 'Count'
  FROM my_table
 WHERE my_table.foo = 'bar' 
```

与使用子查询获取行数相比，使用 OVER 子句的性能要好得多。使用 @@RowCount 将具有最佳性能，因为 select @@RowCount 语句不会有任何查询成本

更新以回应评论：我给出的示例将给出分区中的行数 - 在这种情况下由“PARTITION BY my_table.foo”定义。每行中列的值是具有相同 my_table.foo 值的行数。由于您的示例查询具有子句“WHERE my_table.foo = 'bar'”，因此结果集中的所有行都将具有相同的 my_table.foo 值，因此列中的值对于所有行都将相同且相等（在这种情况下）这是查询中的行数。

这是一个更好/更简单的示例，说明如何在每行中包含一列，即结果集中的总行数。只需删除可选的 Partition By 子句。

```
SELECT my_table.my_col, count(*) OVER() AS 'Count'
  FROM my_table
 WHERE my_table.foo = 'bar' 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-28T17:21:49.643

只有两种方法可以 100% 确定`COUNT(*)`实际查询会给出一致的结果：

*   与查询相结合`COUNT(*)`，如您的方法 2 中所示。我推荐您在示例中显示的表单，而不是 kogus 评论中显示的相关子查询表单。
*   `SNAPSHOT`在或`SERIALIZABLE`隔离级别 启动事务后，使用两个查询，如您的方法 1 。

使用其中一种隔离级别很重要，因为任何其他隔离级别都允许其他客户端创建的新行在当前事务中可见。阅读 MSDN 文档以[`SET TRANSACTION ISOLATION`](http://msdn.microsoft.com/en-us/library/ms173763.aspx)获取更多详细信息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-28T16:33:44.797

方法 2 将始终返回与您的结果集匹配的计数。

我建议您将子查询链接到您的外部查询，以确保您的计数条件与数据集上的条件匹配。

```
SELECT 
  mt.my_row,
 (SELECT COUNT(mt2.my_row) FROM my_table mt2 WHERE mt2.foo = mt.foo) as cnt
FROM my_table mt
WHERE mt.foo = 'bar'; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-28T16:57:02.487

如果您担心自执行查询和检索结果以来满足条件的行数可能会在几毫秒内发生变化，您可以/应该在事务中执行查询：

```
BEGIN TRAN bogus

SELECT COUNT( my_table.my_col ) AS row_count
FROM my_table
WHERE my_table.foo = 'bar'

SELECT my_table.my_col
FROM my_table
WHERE my_table.foo = 'bar'
ROLLBACK TRAN bogus 
```

这将始终返回正确的值。

此外，如果您使用的是 SQL Server，您可以使用 @@ROWCOUNT 获取受最后一条语句影响的行数，并将*实际*查询的输出重定向到临时表或表变量，这样您就可以完全返回所有内容，并且无需交易：

```
DECLARE @dummy INT

SELECT my_table.my_col
INTO #temp_table
FROM my_table
WHERE my_table.foo = 'bar'

SET @dummy=@@ROWCOUNT
SELECT @dummy, * FROM #temp_table 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T15:50:22.513

这里有一些想法：

*   使用方法 #1 并调整数组的大小以保存额外的结果或使用根据需要自动调整大小的类型（你没有提到你使用的是什么语言，所以我不能更具体）。
*   如果您的数据库支持，您可以在事务中执行方法 #1 中的两个语句，以保证两次计数相同。
*   我不确定您对数据做了什么，但如果可以在不先存储所有结果的情况下处理结果，这可能是最好的方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-28T16:26:41.753

如果您真的担心您的行数会在 select 计数和 select 语句之间发生变化，为什么不先将您的行选择到临时表中呢？这样，您就知道您将保持同步。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-28T15:44:19.747

为什么不将结果放入向量中？这样您就不必事先知道尺寸。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-28T16:14:09.407

您可能想考虑一种更好的模式来处理这种类型的数据。

没有自尊的 SQL 驱动程序会在返回行之前告诉您查询将返回多少行，因为答案可能会改变（除非您使用事务，这会产生自己的问题。）

行数不会改变 - 谷歌的 ACID 和 SQL。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-08-02T14:26:00.293

```
IF (@@ROWCOUNT > 0)
BEGIN
SELECT my_table.my_col
  FROM my_table
 WHERE my_table.foo = 'bar'
END 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-05-09T11:47:10.500

只是添加这个，因为这是谷歌这个问题的最高结果。在 sqlite 中，我使用它来获取行数。

```
WITH temptable AS
  (SELECT one,two
   FROM
     (SELECT one, two
      FROM table3
      WHERE dimension=0
      UNION ALL SELECT one, two
      FROM table2
      WHERE dimension=0
      UNION ALL SELECT one, two
      FROM table1
      WHERE dimension=0)
   ORDER BY date DESC)
SELECT *
FROM temptable
LEFT JOIN
  (SELECT count(*)/7 AS cnt,
                        0 AS bonus
   FROM temptable) counter
WHERE 0 = counter.bonus 
```

# php - 简单网站（Apache/PHP/MySQL + JavaScript）

> ID：243788
> 
> 赞同：3
> 
> 时间：2008-10-28T15:42:07.583
> 
> 标签：php, javascript

我被要求为朋友创建一个相当简单的网站。本质上，用户将登录，填写一组信息，然后提交。然后需要将该数据写入数据库（并在未来读取/呈现）。

我并不是真正的 Web 开发人员（我主要从事 Java/C++），但大约 3 年前，我参与了一个项目，我们使用 WAMP（Windows、Apache、MySQL 和 PHP）创建了一个网站，并带有一点 JavaScript/ AJAX 投入了很好的衡量。我打算再次使用 WAMP，但担心现在可能有更好的工具可用。

那么，对于这样一个简单的网站，WAMP 方法是否合适？

如果是这样，您会推荐使用哪些工具来开发 PHP/Javascript？

最后，我在一篇博文中看到 Stack Overflow 使用了 JQuery。使用这些库是否值得？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T15:49:33.730

假设您要构建的网站托管在 WAMP 堆栈上，那么我会说继续使用它；否则，您可能想坚持使用 Windows/IIS/PHP/MySQL 或 SQL Server。我总是试图确保我的开发环境尽可能地反映生产。

其次，如果用户只是简单地登录，提交表单，然后被认为已经完成，那么使用 Ajax 可能是矫枉过正；但是，如果您肯定要使用 Ajax 路线，那么我绝对建议您使用库。[Prototype](http://prototypejs.org/)或[jQuery](http://jquery.com/)都很好——任何一个都使 Ajax 简单得离谱。

最后，就建议的工具而言，找到适合您正在开发的东西的东西。如果这个站点像您声称的那样简单，那么像[Notepad++](http://notepad-plus.sourceforge.net/uk/site.htm)这样的东西可能就足够了。WAMP/LAMP 堆栈的另一个选项是[Aptana Studio](http://www.aptana.com/)。如果您要使用 Windows/IIS/SQL Server 路线，请使用一些[Microsoft Express](http://www.microsoft.com/Express/)工具。

我可能会走得更远，但是如果您正在构建一个非常简单的站点，请不要花更多时间为可以使用现有工具箱完成的事情配置闪亮的新工具。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T16:53:12.323

我当然会同意汤姆的观点。如果您之前的经验，使用带有一些 js 的 WAMP 堆栈是成功的，那么请坚持下去。

[Notepad++](http://notepad-plus.sourceforge.net/uk/site.htm)对于大多数 Web 开发任务来说是一个非常好的工具，因此，或者像[Aptana Studio](http://www.aptana.com/studio)这样更重要的东西可以很好地处理事情。

根据您对需求的简要描述，我不建议尝试像[Rails](http://www.rubyonrails.org/)这样的新东西。这很好，但要学习的工作比项目真正合理的要多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T16:08:22.460

以此为契机尝试 Ruby on Rails 也不错。根据您的措辞，我假设您可以完全控制环境。作为体验开发者，这应该不难。约定优于配置的方法也简化了开发。

恐怕我帮不上什么忙！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T22:19:31.960

查看[Machform](http://www.appnitro.com/)以创建表单。它非常容易地创建表单并创建存储其信息的数据库，并允许您将结果通过电子邮件发送到某处或访问数据库以进一步处理信息。我使用它，我节省了很多时间。这是我尝试过的最好的“表单创建者”。

我最近还检查了一个名为[concrete5](http://www.concrete5.org/)的cms ，我发现它在stackoverflow 上引用了其他地方。它也有一个表单实用程序。可能是创建简单事物的最快方法。

# oracle - 将自动递增值分配给 Oracle 中的新列

> ID：243790
> 
> 赞同：1
> 
> 时间：2008-10-28T15:43:07.753
> 
> 标签：oracle, plsql

我在一个 Oracle DB 中有这个表，它在 3 个数据列上定义了一个主键。我想删除主键约束以允许这些列具有重复数据的行，并创建一个新列“id”以包含这些行的自动递增整数 ID。我知道如何创建一个序列和触发器来为添加到表中的新行添加一个自动递增的 ID，但是是否可以编写一个 PL/SQL 语句来为表中已经存在的所有行添加唯一的 ID？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T17:07:43.930

创建序列后：

```
update mytable
set id = mysequence.nextval; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T16:00:24.583

如果您只是对序列使用整数，则可以使用 rownum 更新 id。例如

```
update
table
set id = rownum 
```

然后，您需要将序列重置为下一个有效 id。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T22:22:04.763

这是你需要的吗？

```
UPDATE your_table
   SET id = your_seq.nextval; 
```

这假设您不关心主键的顺序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-13T17:36:32.217

首先，您应该检查您的 PCTFREE ......是否有足够的空间让每一行变得更长？

如果您选择了一个非常小的 PCTFREE，或者您的数据有很多增加长度的更新，您可能会开始链接每一行以将其作为更新来执行。

作为 CTAS，你几乎肯定会更好地做到这一点。

创建表 t2 作为 select seq.nextval, t1.* from t1。

下降 t1

将 t2 重命名为 t1。

# javascript - JQuery UI 选项卡导致屏幕“跳转”

> ID：243794
> 
> 赞同：48
> 
> 时间：2008-10-28T15:44:50.557
> 
> 标签：javascript, jquery, jquery-ui, tabs, jquery-ui-tabs

我正在使用最新版本的[jQuery UI tabs](https://jqueryui.com/tabs/)。我的标签位于页面底部。

每次单击选项卡时，屏幕都会跳到顶部。

我怎样才能防止这种情况发生？

请看这个例子：

[http://5bosses.com/examples/tabs/sample_tabs.html](http://5bosses.com/examples/tabs/sample_tabs.html)

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2009-10-28T07:50:35.370

如果您正在为您的标签转换设置动画（即。`.tabs({ fx: { opacity: 'toggle' } });`），那么这就是正在发生的事情：

在大多数情况下，跳转不是由浏览器跟随“#”链接引起的。页面跳转是因为在两个选项卡窗格之间的动画中点，两个选项卡窗格都是完全透明和隐藏的（如 display: none），因此整个选项卡部分的有效高度暂时为零。

如果零高度的选项卡式部分导致页面变短，那么页面似乎会向上跳跃以进行补偿，而实际上它只是调整大小以适应（暂时）较短的内容。说得通？

解决此问题的最佳方法是为选项卡部分设置固定高度。如果这是不可取的（因为您的选项卡内容的高度不同），请改用它：

```
jQuery('#tabs').tabs({
    fx: { opacity: 'toggle' },
    select: function(event, ui) {
        jQuery(this).css('height', jQuery(this).height());
        jQuery(this).css('overflow', 'hidden');
    },
    show: function(event, ui) {
        jQuery(this).css('height', 'auto');
        jQuery(this).css('overflow', 'visible');
    }
}); 
```

它将在选项卡转换之前设置窗格的计算高度。新标签出现后，高度将设置回“自动”。溢出设置为“隐藏”，以防止内容在从短选项卡转到更高选项卡时超出窗格。

这对我有用。希望这可以帮助。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-28T15:56:56.337

如果你有这些方面的东西：

```
<a href="#" onclick="activateTab('tab1');">Tab 1</a>
```

尝试`return false;`在标签激活命令后添加：

```
<a href="#" onclick="activateTab('tab1'); return false;">Tab 1</a>
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-28T22:22:02.533

My guess is that you are animating your tab transitions? I am having the same problem, where the page scroll jumps back to the top with every click.

I found this in the jquery source:

```
 // Show a tab, animation prevents browser scrolling to fragment, 
```

Sure enough, if I have this:

```
$('.tab_container > ul').tabs();    
$('.tab_container > ul').tabs({ fx: { height: 'toggle', opacity: 'toggle', duration: 'fast' } }); 
```

my code jumps to the top and is annoying (but there's animation). If I change that to this:

```
$('.tab_container > ul').tabs();    
//$('.tab_container > ul').tabs({ fx: { height: 'toggle', opacity: 'toggle', duration: 'fast' } }); 
```

there is no tab animation, but switching between tabs is smooth.

I found a way to make it scroll back, but it's not a proper fix, as the browser still jumps to the top after clicking a tab. The scroll happens between the events tabsselect and tabsshow, so the following code jumps back to your tab:

```
var scroll_to_x = 0;
var scroll_to_y = 0;
$('.ui-tabs-nav').bind('tabsselect', function(event, ui) {
    scroll_to_x = window.pageXOffset;
    scroll_to_y = window.pageYOffset;
});
$('.ui-tabs-nav').bind('tabsshow', function(event, ui) {
    window.scroll(scroll_to_x, scroll_to_y);
}); 
```

I'll post any more progress I make.

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-03T18:41:44.250

我得到了一个解决方案......

单击选项卡时如何阻止屏幕跳起：

将包含选项卡的 div 包装在具有固定高度的 div 中。

请参阅此处的示例：http: [//5bosses.com/examples/tabs/sample_tabs.html](http://5bosses.com/examples/tabs/sample_tabs.html)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-07-12T16:02:08.637

我对 jquery ui 的菜单也有同样的问题 - 锚点的 click 事件上的 preventDefault() 会阻止页面滚动回顶部：

```
 $("ul.ui-menu li a").click(function(e) {
      e.preventDefault();
 }); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-03-24T23:16:42.553

Mike 的解决方案很好地展示了这个原理，但它有一个很大的缺点——如果结果页面很短，屏幕无论如何都会跳到顶部！唯一的办法就是记住scrollTop，切换标签后**恢复。**但在恢复之前，适当**放大页面（html标签）**：

（编辑 - 为新的 Jquery UI API 修改 + 大页面的小改进）

```
$(...).tabs({
    beforeActivate: function(event, ui) {
        $(this).data('scrollTop', $(window).scrollTop()); // save scrolltop
    },
    activate: function(event, ui) {
        if (!$(this).data('scrollTop')) { // there was no scrolltop before
            jQuery('html').css('height', 'auto'); // reset back to auto...
                    // this may not work on page where originally
                    // the html tag was of a fixed height...
            return;
        }
        //console.log('activate: scrolltop pred = ' + $(this).data('scrollTop') + ', nyni = ' + $(window).scrollTop());
        if ($(window).scrollTop() == $(this).data('scrollTop')) // the scrolltop was not moved
            return;                // nothing to be done
        // scrolltop moved - we need to fix it
        var min_height = $(this).data('scrollTop') + $(window).height();
            // minimum height the document must have to have that scrollTop
        if ($('html').outerHeight() < min_height) { // just a test to be sure
                            // but this test should be always true
            /* be sure to use $('html').height() instead of $(document).height()
               because the document height is always >= window height!
               Not what you want. And to handle potential html padding, be sure
               to use outerHeight instead!
                   Now enlarge the html tag (unfortunatelly cannot set
               $(document).height()) - we want to set min_height
               as html's outerHeight:
             */
            $('html').height(min_height -
                 ($('html').outerHeight() - $('html').height()));
        }
        $(window).scrollTop($(this).data('scrollTop')); // finally, set it back
    }
}); 
```

也适用于`fx`效果。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-04-28T11:05:15.570

尝试使用`event.preventDefault();`. 在切换选项卡的点击事件上。我的功能如下所示：

```
 $(function() {
        var $tabs = $('#measureTabs').tabs();
        $(".btn-contiue").click(function (event) {
            event.preventDefault();
            $( "#measureTabs" ).tabs( "option", "active", $("#measureTabs").tabs   ('option', 'active')+1  );
        });
    }); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-28T19:55:35.137

谢谢你的帮助。好建议，但我之前尝试过，但没有运气。我认为 JQuery UI 可能会压倒我的努力。

这是每个选项卡的代码：

```
<li class=""><a href="#fragment-2"><span>Two</span></a></li> 
```

我已经尝试过了，但没有成功：

```
<li class=""><a href="#fragment-2" onclick="return false;"><span>Two</span></a></li> 
```

这是一个简单的例子（不返回 false）：http: [//5bosses.com/examples/tabs/sample_tabs.html](http://5bosses.com/examples/tabs/sample_tabs.html)

还有其他建议吗？

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-12-22T02:34:42.550

尝试使用 css 将最小高度添加到每个选项卡内容区域（而不是选项卡本身）。那为我修好了。:)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-02-04T08:53:53.470

我有这样的问题。我的代码是：

```
$("#tabs").tabs({
  hide: {
    effect: "fade",
    duration: "500"
  },
  show: {
    effect: "fade",
    duration: "500"
  }
}); 
```

我只是简单地删除`show`了它，它就像一个魅力！

```
 $("#tabs").tabs({
      hide: {
        effect: "fade",
        duration: "500"
      }
 }); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-16T21:30:00.100

我更喜欢在我的链接中使用 href="#"，它不会将用户带到任何地方，但只要添加 onclick="return false;" 就可以做到这一点。我想，关键不是将用户发送到“#”，这取决于浏览器，它似乎默认为当前页面的顶部。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-29T00:46:19.247

```
> var scroll_to_x = 0; var scroll_to_y =
> 0;
> $('.ui-tabs-nav').bind('tabsselect',
> function(event, ui) {
>     scroll_to_x = window.pageXOffset;
>     scroll_to_y = window.pageYOffset; }); $('.ui-tabs-nav').bind('tabsshow',
> function(event, ui) {
>     window.scroll(scroll_to_x, scroll_to_y); }); 
```

谢谢你的帮助！请让我知道您还发现了什么。

上述功能有效（屏幕不会永久移动）......但是，点击时屏幕非常不稳定。

这是一个简单的例子，展示了点击一个标签如何导致屏幕跳到顶部（没有上面的代码）：http: [//5bosses.com/examples/tabs/sample_tabs.html](http://5bosses.com/examples/tabs/sample_tabs.html)

请注意，没有使用动画。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-03T18:04:53.967

[我从这个页面](http://blog.movalog.com/a/javascript-toggle-visibility/)上的评论中发现了一种更简单的方法，就是简单地删除 href="#"，它就不会再跳到顶部了！我验证了它对我有用。干杯

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-09-30T14:00:33.690

我遇到了同样的问题，而且我的也是自己旋转的，所以如果你在页面底部，浏览器窗口会向上滚动到顶部。为标签容器设置固定高度对我有用。有点奇怪的是，如果您离开窗口或选项卡并返回，它仍然会滚动。不过，这不是世界末日。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-08-25T08:40:19.217

将 href="#" 替换为 href="javascript:void(0);" 在“a”元素中

工作 100%

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-05-09T00:42:40.190

我发现在我的情况下，选项卡`href=#example1`导致页面跳转到`id`. 向选项卡添加固定高度没有任何区别，所以我只是添加了：

`$('.nav-tabs li a').click( function(e) { e.preventDefault(); });`

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2010-10-04T12:58:41.113

你试过了吗：

```
fx: {opacity:'toggle', duration:100} 
```

# sharepoint - 如何更改文档库的地址？

> ID：243799
> 
> 赞同：1
> 
> 时间：2008-10-28T15:47:18.883
> 
> 标签：sharepoint, moss, document-library

我有一个包含多个文档库的站点。其中一位站点用户完全控制了站点，并且在某一时刻，他们没有创建新的文档库，而是将默认文档库从“共享文档”重命名为“通信”。现在他们已经在 Windows 资源管理器中打开了文档库，因此在他们的网络位置中添加了一个条目。该条目的名称是“portal.mydomain.net 上的共享文档”而不是“portal.mydomain.net 上的通信”。这是因为库的地址仍然是“共享文档”。我进入了用户的网络并重命名了该条目，但是我希望也更改地址，以便将来的用户不会遇到同样的问题。

我查看了文档库设置，但找不到更改地址的地方。地址显示在“标题、描述和导航”中，但无法更改它。我尝试在“站点操作”>“站点设置”>“内容和结构”下查看是否有任何方法可以更改那里的地址。但是，当我检查通信文档库并下拉操作菜单时，“移动”显示为灰色。

我*想*我可以将库保存为模板，包含内容并在正确的地址中创建一个新库，但是信息修改的都是错误的。

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T15:53:57.153

在 SharePoint Designer 中重命名文档库会更改地址。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-06-25T15:04:08.577

在 Windows 资源管理器中打开库，然后重命名文件夹。在 2010 年 Sharepoint 基金会工作。

# javascript - 为什么 JAWS 仍会读取隐藏的表单元素？

> ID：243800
> 
> 赞同：2
> 
> 时间：2008-10-28T15:47:42.253
> 
> 标签：javascript, dom, accessibility, screen-readers, jaws-screen-reader

**情况**

我有一个可以通过 JavaScript 显示和隐藏的屏幕区域（类似于“显示/隐藏高级搜索选项”）。在此区域内有表单元素（选择、复选框等）。对于使用屏幕阅读器（在本例中为 JAWS）等辅助技术的用户，我们需要将这些表单元素与标签链接或使用“标题”属性来描述每个元素的用途。我使用 title 属性是因为没有足够的空间放置标签，而且您获得的工具提示对于非屏幕阅读器用户来说很好。

代码看起来像这样：

```
<div id="placeholder" style="display:none;">
  <select title="Month">
    <option>January</option>
    <option>February</option>
    ...
  </select>
</div> 
```

**问题**

通常，JAWS 不会读取隐藏的元素……因为它们是隐藏的，它知道这一点。但是，似乎元素有一个标题集，JAWS 无论如何都会读取它。如果我删除标题，JAWS 什么都不会读取，但显然这是不可访问的标记。

**可能的解决方案**

我的第一个想法是使用隐藏标签而不是标题，如下所示：

```
<div id="placeholder" style="display:none;">
  <label for="month" style="display:none">Month</label>
  <select id="month">...</select>
</div> 
```

这导致完全相同的行为，现在我们失去了非屏幕阅读器用户的工具提示。此外，我们最终生成了两倍的 Html。

第二个选项是仍然使用标签，将其放置在屏幕之外。这样它就会被屏幕阅读器阅读，但不会被视觉用户看到：

```
<div id="placeholder" style="display:none;">
  <label for="month" style="position:absolute;left:-5000px:width:1px;">Month</label>
  <select id="month">...</select>
</div> 
```

这确实有效，但我们再次丢失了工具提示并仍然生成额外的 Html。

我的第三种可能的解决方案是在 JavaScript 中递归遍历 DOM，在隐藏区域时删除标题，并在显示区域时将其添加回来。这也有效......但由于明显的原因非常难看，并且不能很好地扩展到更一般的情况。

还有其他想法吗？为什么 JAWS 会这样？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2015-04-22T23:59:12.953

给项目 aria-hidden="true" 属性，它应该对屏幕阅读器隐藏。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T00:53:17.953

这绝对看起来像 JAWS 中的一个错误，因为规范明确指出 display:none 应该导致元素及其子元素不显示在任何媒体中。

但是，玩说话：听觉属性可能有用吗？我不知道，因为我没有可用的 JAWS。

[http://www.w3.org/TR/CSS2/aural.html#speaking-props](http://www.w3.org/TR/CSS2/aural.html#speaking-props)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-04-15T20:34:38.520

你试过这个吗？

```
<div id="placeholder" style="display:none;">
  <select title="Month" style="speak:none;">
    <option>January</option>
    <option>February</option>
    ...
  </select>
</div> 
```

过去，当我想让 JAWS 阅读一件事并跳过通常会阅读的其他内容时，这对我有用。

# c++ - Windows C 代码上的内存分配

> ID：243802
> 
> 赞同：3
> 
> 时间：2008-10-28T15:47:47.197
> 
> 标签：c++, c, malloc, virtualalloc, heapalloc

我想知道在 Windows C 编程中推荐哪种方法：使用 malloc 或 Win32 HeapAlloc（可能是 VirtualAlloc？）函数。

我已经阅读了 MSDN[内存管理函数](http://msdn.microsoft.com/en-us/library/aa366781(VS.85).aspx)文章和有关 malloc 和 HeapAlloc 的 MSDN 文章，但他们没有说明应该使用哪一个以及在什么情况下使用。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-28T15:54:53.440

坚持使用 malloc ，除非您有令人信服的理由使用不同的东西。它将根据操作系统内存分配原语在底层实现，但自己深入到该层并没有真正的优势。

我相信一些 API 调用需要从 Windows 堆分配的内存块，但是当你遇到它们时你就会知道。

或者如果你想做一些更高级的事情，比如使用共享内存，或者需要直接控制内存页面的权限，那么你需要查看 Windows API 调用，比如 VirtualAlloc。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-29T03:47:36.167

如果您确实有大量数据要处理，或者您无论如何都需要费心创建自己的内存管理器，VirtualAlloc 和朋友可以为您提供一点优势。

否则，使用 malloc() 会更容易，当然也更便携。

VirtualAlloc 有一个称为 MEM_RESET 的漂亮功能，它使内存块中的数据无效，但保持分配状态。这意味着如果它被分页到磁盘，Windows 将不会在您下次访问它时将其分页。如果您有许多可能突然变得不必要的数据，那很好，但是您很快就会有其他东西来填满缓冲区。

它还区分保留地址空间和实际请求内存。如果你有充分的理由去解决所有这些麻烦，那里有一些不错的东西。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-28T16:01:58.057

还有一件事：malloc() 保证是可移植的（至少对于任何 ANSI-C 实现）并且更优雅。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T18:01:36.460

在某些情况下使用 HeapAlloc 等函数，HeapFree 会让您的生活更轻松。一个例子是：一个大型应用程序，您需要在一个模块中分配内存（例如在 library1.dll 中）并在主模块中释放该内存（例如 program.exe）。如果您使用 HeapAlloc、HeapResize 和 HeapFree 函数，这可以安全地完成，但不能使用 C 运行时库（例如 malloc、free、resize）完成。

但是：如果你没有充分的理由，你应该坚持使用 malloc/free/resize 函数。此外，如果您需要更改分配内存的权限（例如：使 if 可执行等），您应该使用 VirtualAlloc、VirtualFree 等函数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T18:06:47.540

您可以制作一个包装器并保留更改实现细节的选项。您甚至可以将这两个选项与您的代码进行比较，然后再决定。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T16:05:44.027

与 Rob 不同，我选择了另一种方式……因为我选择针对 WinAPI 进行编码，所以我使用本机函数而不是 C 运行时函数，反正它们只是围绕它们的一个薄包装。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-02T09:20:48.310

使用 HeapAlloc，您可以为不同的任务/子系统拥有单独的堆。这可以简化大型应用程序的转储分析。

使用 malloc，您只能使用一个堆，但您会获得一些 CRT 作者可能在 OS HeapAlloc 之上实现的分配优化。

除非您想实现自定义堆管理器（您自己的一组 Heap* 函数），否则使用 VirtualAlloc 不会给您带来太多好处。

# c# - 如何在整理好的 xhtml 字符串中转换所有 html 转义字符，以便将其加载到 XmlDocument 中？

> ID：243806
> 
> 赞同：0
> 
> 时间：2008-10-28T15:48:19.007
> 
> 标签：c#, html, xml, xslt, tidy

在 .net Web 应用程序中，我与返回 html 的第 3 方 CMS api 交谈。我需要将其转换为格式良好的 xml，因此我使用 .NET 包装器围绕 HTML tidy。这会生成一个不错的 DOM，但是当使用诸如此类的字符时会出现问题`&nbsp;`。

我需要将它们转换为它们的代码格式`&#160;`，以便 XmlDocument 接受它。

除了使其成为 XHTML 之外，无法在 tidy 包装器上设置更多选项。所以返回字符串后，我需要做一些魔术，但我认为它会归结为使用我自己的映射的正则表达式吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T17:02:42.630

如果您的 .NET 包装器允许您在命令行及其配置文件中提供所有可能的选项，您应该通过将“numeric-entities”和“output-xml”都设置为“true”来获得所需的内容。

# java - 什么时候应该使用 Class 的 java 5 方法转换？

> ID：243811
> 
> 赞同：13
> 
> 时间：2008-10-28T15:49:49.207
> 
> 标签：java, java-5

浏览一些代码我遇到了以下代码

```
trTuDocPackTypdBd.update(TrTuDocPackTypeDto.class.cast(packDto)); 
```

我想知道这种方式铸造是否有任何优势

```
trTuDocPackTypdBd.update((TrTuDocPackTypeDto)packDto); 
```

我已经询问了负责的开发人员，他说他使用它是因为它是新的（这对我来说似乎不是一个特别好的理由），但是当我想要使用该方法时我很感兴趣。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-28T16:05:45.773

这些陈述并不相同。cast 方法是一种普通的方法调用（`invokevirtual`JVM 指令），而另一个是一种语言构造（`checkcast`指令）。在上面显示的情况下，您应该使用第二种形式：`(TrTuDocPackTypeDto) packDto`

`cast`当您有某个变量类型的 Class 实例时，该方法用于使用泛型进行反射式编程。你可以像这样使用它：

```
public <T> Set<T> find(Class<T> clz, Filter criteria) {
  List<?> raw = session.find(clz, criteria); /* A legacy, un-generic API. */
  Set<T> safe = new HashSet<T>();
  for (Object o : raw) 
    safe.add(clz.cast(o));
  return safe;
} 
```

这为您提供了一种安全的方法来避免将原始类型简单地转换为泛型类型的错误选择：

```
/* DO NOT DO THIS! */
List raw = new ArrayList();
...
return (List<Widget>) raw; 
```

编译器会警告您，`Unchecked cast from List to List<Widget>`，这意味着在省略号中，有人可能已将 a 添加`Gadget`到原始列表中，这最终将导致 a`ClassCastException`当调用者迭代返回的（假定的）`Widget`实例列表时。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-28T15:57:50.937

这样做的主要情况（IME）是当您需要安全地转换为通用类/方法时。由于类型擦除，您无法转换为，`T`但如果您已获得`Class<? extends T>`参数，则可以使用该参数进行转换，结果将可分配给 type 的变量`T`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-13T16:58:15.880

我找不到一个可以使用 cast 方法而不能使用 cast 语法的示例。但是，查看代码，似乎在无法进行强制转换的情况下，强制转换方法会抛出没有附加类型信息的 ClassCastException，而强制转换语法会给您一些提示（例如，“无法将 Snoopy 强制转换为 TyrannosorusRex ") :

```
/**
 * Casts an object to the class or interface represented
 * by this <tt>Class</tt> object.
 *
 * @param obj the object to be cast
 * @return the object after casting, or null if obj is null
 *
 * @throws ClassCastException if the object is not
 * null and is not assignable to the type T.
 *
 * @since 1.5
 */
public T cast(Object obj) {
if (obj != null && !isInstance(obj))
    throw new ClassCastException();
return (T) obj;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-13T17:15:25.840

用第一种形式

```
trTuDocPackTypdBd.update(TrTuDocPackTypeDto.class.cast(packDto)); 
```

你可以这样做：

```
public void dynamicCast( Class clazz, Object o ) { 
     this.x = clazz.cast( o );
} 
```

用第二个你不能。铸造类应该是硬编码的。

为什么要首先使用变量进行转换？那是另一个问题。:) 首先想到的是，您不知道（在编译时）将被转换为的类。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2008-10-28T15:54:29.307

这两个陈述是相同的。选择您认为更具可读性的那个。第二种方法在我的经验中更常见，也是我更喜欢的一次。

我倾向于仅在使用反射时才使用 cast 方法，并且在这种情况下读起来更好。在所有其他时间，我发现自己使用的是第二种投射方式。

# asp.net - 需要帮助配置 IIS 以提供 2.0 Web 服务

> ID：243814
> 
> 赞同：0
> 
> 时间：2008-10-28T15:51:43.977
> 
> 标签：asp.net, iis, configuration

我正在尝试在安装了 1.0 和 2.0 的 IIS 上部署 .NET 2.0 Web 服务。此 Web 服务器主要服务于大型 .NET 1.0 应用程序。

我已将 .NET 2.0 Web 服务项目复制到服务器并创建了一个虚拟目录以指向必要的文件夹。

当我在 IIS 中将 ASP.NET 版本设置为 2.0 时，应用程序提示我输入用户名和密码（当我尝试在浏览器中打开站点时），如果我将其设置回 1.0，则不会提示我输入密码，但显然得到一个完整的应用程序错误。

我启用了匿名访问（使用用户名/密码）并将经过身份验证的访问检查为“集成 Windows 身份验证”

如何配置 IIS，以便在将 ASP.NET 版本设置为 2.0 时不会提示我输入密码？

谢谢...

**编辑**我遇到了主要的连接问题，并且显然创建了一些重复的帖子......我将删除那些没有答案的帖子。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T15:57:22.497

您至少需要在其自己的应用程序池中运行每个 Web 服务。您不能在同一个池中混合使用 .net 的框架版本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T16:01:45.703

您应该为您的 .NET 2.0 应用程序配置一个单独的网站和应用程序池。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-28T16:02:51.940

只是为了澄清 Dave 的回答，您实际上只需要 2 个应用程序池，一个用于 .NET 1.1，一个用于 2.0，您可以将运行相关框架的所有应用程序分组以使用适当的应用程序池。这就是说您不需要为 IIS 中的每个站点/服务创建一个新的应用程序池。

# .net - 在.net中按下键

> ID：243816
> 
> 赞同：0
> 
> 时间：2008-10-28T15:52:26.253
> 
> 标签：.net

如何在.net 中的文本框keydown 事件中验证iscontrolkeys？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T16:01:49.523

[这个 msdn 页面应该可以解决问题](http://msdn.microsoft.com/en-us/library/system.windows.forms.keypresseventargs.aspx)- 检查 keypress 中返回的 keypresseventsargs 或者[这个 keydown 页面](http://msdn.microsoft.com/en-us/library/system.windows.forms.keyeventargs(VS.80).aspx)应该允许您查询控制键（使用相关的 .Net 枚举）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T16:09:59.337

在 C# 中，

```
 private void textBox1_KeyDown(object sender, KeyEventArgs e)
    {
        if (e.KeyCode == Keys.ControlKey)
        {
            //Do some work
        }
    } 
```

在 VB.NET 中，

```
 Private  Sub textBox1_KeyDown(ByVal sender As Object, ByVal e As KeyEventArgs)
            If e.KeyCode = Keys.ControlKey Then
                'Do some work'
            End If
       End Sub 
```

# jquery - Asp.Net MVC JQuery 的优点

> ID：243822
> 
> 赞同：4
> 
> 时间：2008-10-28T15:53:46.310
> 
> 标签：jquery, asp.net-mvc, json

我一直在使用 asp.net MVC 开发一个简单的网站，并且开始添加一些 JQuery\JSON 优点。

到目前为止，我的问题是我所有的“视图”都是强类型的，并且我一直在根据来自 ViewData.Model.MyViewsData 的数据构建视图。现在，一旦视图被渲染并且我执行了一个 Ajax 样式请求，我就会以 JSON 形式返回新数据，并且我需要更新我的视图。现在，当我不再有权访问所有原始 ViewData 时，如何使用新数据更新我的视图？

我猜我需要做两件事之一：总是使用 Jquery\JSON 取回数据而忘记使用 ViewData 或对我的视图进行某种部分渲染？！

任何教程或示例将不胜感激。

非常感谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T16:12:13.357

我将 jQuery 和 Monorail 用于 MVC 框架——我们同时使用这两种方法。

[这是 jquery 方法的一个示例](https://remysharp.com/2007/01/20/auto-populating-select-boxes-using-jquery-ajax/)- 忽略它是 php 的事实。方法是一样的，即在 JSON 调用中的 postback 函数中，直接访问 JSON 返回对象以填充通过 css 选择器访问的前端控件。

[替代方法非常相似（](http://encosia.com/2008/03/27/using-jquery-to-consume-aspnet-json-web-services/)[在此处](https://web.archive.org/web/20101122205801/http://encosia.com/2008/03/27/using-jquery-to-consume-aspnet-json-web-services/)存档） - 无需手动设置控件内容，只需应用部分视图中返回的 html（确保取消布局，因为您不希望菜单等只是一个 html 片段）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T17:59:02.283

ViewData 是服务器端的东西。视图引擎使用它在将页面发送到浏览器之前呈现页面。页面交付后，Javascript 在浏览器中运行。因此，当您调用 $.getJson 或其他方式时，您正在严格处理 DOM。

[这是一个通过 JQuery 和 MS MVC 填充选择选项](http://geekswithblogs.net/michelotti/archive/2008/06/28/mvc-json---jsonresult-and-jquery.aspx)的非常简单的示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T19:41:12.403

如果您使用控制器的 JSON 方法为您的 Ajax 请求返回数据，您可以将数据序列化为 Json，然后您可以从 JavaScript 中访问它。例如，如果您在文章/博客文章页面底部有一个评论表单，并且您想通过 jQuery $.post 调用添加评论，您可以在控制器中创建评论对象，使用 "返回 JSON(theNewComment);" 然后在 jQuery 的返回函数中，您可以访问评论对象的属性。你不会得到智能感知，但如果对象被正确创建并返回，数据就会在那里。

此时，您需要使用 jQuery 的 DOM 操作功能将新值插入您的评论列表（或您尝试更新的任何内容）。

由于它是一个 Ajax 调用，因此您不需要所有的 ViewData（因为页面不会刷新），只需要创建/更新的内容。

# python - python中字符的Unicode块

> ID：243831
> 
> 赞同：14
> 
> 时间：2008-10-28T15:56:18.130
> 
> 标签：python, unicode, character-properties

有没有办法在 python 中获取字符的 Unicode 块？[unicodedata](http://www.python.org/doc/2.5.2/lib/module-unicodedata.html)模块似乎没有我需要的东西，而且我找不到它的外部库。

[`Character.UnicodeBlock.of()`](http://java.sun.com/javase/6/docs/api/java/lang/Character.UnicodeBlock.html#of(char))基本上，我需要与java中相同的功能。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-28T22:13:30.197

我也找不到。奇怪的！

幸运的是，Unicode 块的数量非常少。

这个实现接受一个单字符的 Unicode 字符串，就像`unicodedata`. 如果您的输入主要是 ASCII，那么这种线性搜索甚至可能比使用二进制搜索`bisect`或其他方法更快。如果我提交它以包含在 Python 标准库中，我可能会将其编写为通过`struct`C 中静态初始化的数组的二进制搜索。

```
def block(ch):
  '''
  Return the Unicode block name for ch, or None if ch has no block.

  >>> block(u'a')
  'Basic Latin'
  >>> block(unichr(0x0b80))
  'Tamil'
  >>> block(unichr(0xe0080))

  '''

  assert isinstance(ch, unicode) and len(ch) == 1, repr(ch)
  cp = ord(ch)
  for start, end, name in _blocks:
    if start <= cp <= end:
      return name

def _initBlocks(text):
  global _blocks
  _blocks = []
  import re
  pattern = re.compile(r'([0-9A-F]+)\.\.([0-9A-F]+);\ (\S.*\S)')
  for line in text.splitlines():
    m = pattern.match(line)
    if m:
      start, end, name = m.groups()
      _blocks.append((int(start, 16), int(end, 16), name))

# retrieved from http://unicode.org/Public/UNIDATA/Blocks.txt
_initBlocks('''
# Blocks-12.0.0.txt
# Date: 2018-07-30, 19:40:00 GMT [KW]
# © 2018 Unicode®, Inc.
# For terms of use, see http://www.unicode.org/terms_of_use.html
#
# Unicode Character Database
# For documentation, see http://www.unicode.org/reports/tr44/
#
# Format:
# Start Code..End Code; Block Name

# ================================================

# Note:   When comparing block names, casing, whitespace, hyphens,
#         and underbars are ignored.
#         For example, "Latin Extended-A" and "latin extended a" are equivalent.
#         For more information on the comparison of property values,
#            see UAX #44: http://www.unicode.org/reports/tr44/
#
#  All block ranges start with a value where (cp MOD 16) = 0,
#  and end with a value where (cp MOD 16) = 15\. In other words,
#  the last hexadecimal digit of the start of range is ...0
#  and the last hexadecimal digit of the end of range is ...F.
#  This constraint on block ranges guarantees that allocations
#  are done in terms of whole columns, and that code chart display
#  never involves splitting columns in the charts.
#
#  All code points not explicitly listed for Block
#  have the value No_Block.

# Property: Block
#
# @missing: 0000..10FFFF; No_Block

0000..007F; Basic Latin
0080..00FF; Latin-1 Supplement
0100..017F; Latin Extended-A
0180..024F; Latin Extended-B
0250..02AF; IPA Extensions
02B0..02FF; Spacing Modifier Letters
0300..036F; Combining Diacritical Marks
0370..03FF; Greek and Coptic
0400..04FF; Cyrillic
0500..052F; Cyrillic Supplement
0530..058F; Armenian
0590..05FF; Hebrew
0600..06FF; Arabic
0700..074F; Syriac
0750..077F; Arabic Supplement
0780..07BF; Thaana
07C0..07FF; NKo
0800..083F; Samaritan
0840..085F; Mandaic
0860..086F; Syriac Supplement
08A0..08FF; Arabic Extended-A
0900..097F; Devanagari
0980..09FF; Bengali
0A00..0A7F; Gurmukhi
0A80..0AFF; Gujarati
0B00..0B7F; Oriya
0B80..0BFF; Tamil
0C00..0C7F; Telugu
0C80..0CFF; Kannada
0D00..0D7F; Malayalam
0D80..0DFF; Sinhala
0E00..0E7F; Thai
0E80..0EFF; Lao
0F00..0FFF; Tibetan
1000..109F; Myanmar
10A0..10FF; Georgian
1100..11FF; Hangul Jamo
1200..137F; Ethiopic
1380..139F; Ethiopic Supplement
13A0..13FF; Cherokee
1400..167F; Unified Canadian Aboriginal Syllabics
1680..169F; Ogham
16A0..16FF; Runic
1700..171F; Tagalog
1720..173F; Hanunoo
1740..175F; Buhid
1760..177F; Tagbanwa
1780..17FF; Khmer
1800..18AF; Mongolian
18B0..18FF; Unified Canadian Aboriginal Syllabics Extended
1900..194F; Limbu
1950..197F; Tai Le
1980..19DF; New Tai Lue
19E0..19FF; Khmer Symbols
1A00..1A1F; Buginese
1A20..1AAF; Tai Tham
1AB0..1AFF; Combining Diacritical Marks Extended
1B00..1B7F; Balinese
1B80..1BBF; Sundanese
1BC0..1BFF; Batak
1C00..1C4F; Lepcha
1C50..1C7F; Ol Chiki
1C80..1C8F; Cyrillic Extended-C
1C90..1CBF; Georgian Extended
1CC0..1CCF; Sundanese Supplement
1CD0..1CFF; Vedic Extensions
1D00..1D7F; Phonetic Extensions
1D80..1DBF; Phonetic Extensions Supplement
1DC0..1DFF; Combining Diacritical Marks Supplement
1E00..1EFF; Latin Extended Additional
1F00..1FFF; Greek Extended
2000..206F; General Punctuation
2070..209F; Superscripts and Subscripts
20A0..20CF; Currency Symbols
20D0..20FF; Combining Diacritical Marks for Symbols
2100..214F; Letterlike Symbols
2150..218F; Number Forms
2190..21FF; Arrows
2200..22FF; Mathematical Operators
2300..23FF; Miscellaneous Technical
2400..243F; Control Pictures
2440..245F; Optical Character Recognition
2460..24FF; Enclosed Alphanumerics
2500..257F; Box Drawing
2580..259F; Block Elements
25A0..25FF; Geometric Shapes
2600..26FF; Miscellaneous Symbols
2700..27BF; Dingbats
27C0..27EF; Miscellaneous Mathematical Symbols-A
27F0..27FF; Supplemental Arrows-A
2800..28FF; Braille Patterns
2900..297F; Supplemental Arrows-B
2980..29FF; Miscellaneous Mathematical Symbols-B
2A00..2AFF; Supplemental Mathematical Operators
2B00..2BFF; Miscellaneous Symbols and Arrows
2C00..2C5F; Glagolitic
2C60..2C7F; Latin Extended-C
2C80..2CFF; Coptic
2D00..2D2F; Georgian Supplement
2D30..2D7F; Tifinagh
2D80..2DDF; Ethiopic Extended
2DE0..2DFF; Cyrillic Extended-A
2E00..2E7F; Supplemental Punctuation
2E80..2EFF; CJK Radicals Supplement
2F00..2FDF; Kangxi Radicals
2FF0..2FFF; Ideographic Description Characters
3000..303F; CJK Symbols and Punctuation
3040..309F; Hiragana
30A0..30FF; Katakana
3100..312F; Bopomofo
3130..318F; Hangul Compatibility Jamo
3190..319F; Kanbun
31A0..31BF; Bopomofo Extended
31C0..31EF; CJK Strokes
31F0..31FF; Katakana Phonetic Extensions
3200..32FF; Enclosed CJK Letters and Months
3300..33FF; CJK Compatibility
3400..4DBF; CJK Unified Ideographs Extension A
4DC0..4DFF; Yijing Hexagram Symbols
4E00..9FFF; CJK Unified Ideographs
A000..A48F; Yi Syllables
A490..A4CF; Yi Radicals
A4D0..A4FF; Lisu
A500..A63F; Vai
A640..A69F; Cyrillic Extended-B
A6A0..A6FF; Bamum
A700..A71F; Modifier Tone Letters
A720..A7FF; Latin Extended-D
A800..A82F; Syloti Nagri
A830..A83F; Common Indic Number Forms
A840..A87F; Phags-pa
A880..A8DF; Saurashtra
A8E0..A8FF; Devanagari Extended
A900..A92F; Kayah Li
A930..A95F; Rejang
A960..A97F; Hangul Jamo Extended-A
A980..A9DF; Javanese
A9E0..A9FF; Myanmar Extended-B
AA00..AA5F; Cham
AA60..AA7F; Myanmar Extended-A
AA80..AADF; Tai Viet
AAE0..AAFF; Meetei Mayek Extensions
AB00..AB2F; Ethiopic Extended-A
AB30..AB6F; Latin Extended-E
AB70..ABBF; Cherokee Supplement
ABC0..ABFF; Meetei Mayek
AC00..D7AF; Hangul Syllables
D7B0..D7FF; Hangul Jamo Extended-B
D800..DB7F; High Surrogates
DB80..DBFF; High Private Use Surrogates
DC00..DFFF; Low Surrogates
E000..F8FF; Private Use Area
F900..FAFF; CJK Compatibility Ideographs
FB00..FB4F; Alphabetic Presentation Forms
FB50..FDFF; Arabic Presentation Forms-A
FE00..FE0F; Variation Selectors
FE10..FE1F; Vertical Forms
FE20..FE2F; Combining Half Marks
FE30..FE4F; CJK Compatibility Forms
FE50..FE6F; Small Form Variants
FE70..FEFF; Arabic Presentation Forms-B
FF00..FFEF; Halfwidth and Fullwidth Forms
FFF0..FFFF; Specials
10000..1007F; Linear B Syllabary
10080..100FF; Linear B Ideograms
10100..1013F; Aegean Numbers
10140..1018F; Ancient Greek Numbers
10190..101CF; Ancient Symbols
101D0..101FF; Phaistos Disc
10280..1029F; Lycian
102A0..102DF; Carian
102E0..102FF; Coptic Epact Numbers
10300..1032F; Old Italic
10330..1034F; Gothic
10350..1037F; Old Permic
10380..1039F; Ugaritic
103A0..103DF; Old Persian
10400..1044F; Deseret
10450..1047F; Shavian
10480..104AF; Osmanya
104B0..104FF; Osage
10500..1052F; Elbasan
10530..1056F; Caucasian Albanian
10600..1077F; Linear A
10800..1083F; Cypriot Syllabary
10840..1085F; Imperial Aramaic
10860..1087F; Palmyrene
10880..108AF; Nabataean
108E0..108FF; Hatran
10900..1091F; Phoenician
10920..1093F; Lydian
10980..1099F; Meroitic Hieroglyphs
109A0..109FF; Meroitic Cursive
10A00..10A5F; Kharoshthi
10A60..10A7F; Old South Arabian
10A80..10A9F; Old North Arabian
10AC0..10AFF; Manichaean
10B00..10B3F; Avestan
10B40..10B5F; Inscriptional Parthian
10B60..10B7F; Inscriptional Pahlavi
10B80..10BAF; Psalter Pahlavi
10C00..10C4F; Old Turkic
10C80..10CFF; Old Hungarian
10D00..10D3F; Hanifi Rohingya
10E60..10E7F; Rumi Numeral Symbols
10F00..10F2F; Old Sogdian
10F30..10F6F; Sogdian
10FE0..10FFF; Elymaic
11000..1107F; Brahmi
11080..110CF; Kaithi
110D0..110FF; Sora Sompeng
11100..1114F; Chakma
11150..1117F; Mahajani
11180..111DF; Sharada
111E0..111FF; Sinhala Archaic Numbers
11200..1124F; Khojki
11280..112AF; Multani
112B0..112FF; Khudawadi
11300..1137F; Grantha
11400..1147F; Newa
11480..114DF; Tirhuta
11580..115FF; Siddham
11600..1165F; Modi
11660..1167F; Mongolian Supplement
11680..116CF; Takri
11700..1173F; Ahom
11800..1184F; Dogra
118A0..118FF; Warang Citi
119A0..119FF; Nandinagari
11A00..11A4F; Zanabazar Square
11A50..11AAF; Soyombo
11AC0..11AFF; Pau Cin Hau
11C00..11C6F; Bhaiksuki
11C70..11CBF; Marchen
11D00..11D5F; Masaram Gondi
11D60..11DAF; Gunjala Gondi
11EE0..11EFF; Makasar
11FC0..11FFF; Tamil Supplement
12000..123FF; Cuneiform
12400..1247F; Cuneiform Numbers and Punctuation
12480..1254F; Early Dynastic Cuneiform
13000..1342F; Egyptian Hieroglyphs
13430..1343F; Egyptian Hieroglyph Format Controls
14400..1467F; Anatolian Hieroglyphs
16800..16A3F; Bamum Supplement
16A40..16A6F; Mro
16AD0..16AFF; Bassa Vah
16B00..16B8F; Pahawh Hmong
16E40..16E9F; Medefaidrin
16F00..16F9F; Miao
16FE0..16FFF; Ideographic Symbols and Punctuation
17000..187FF; Tangut
18800..18AFF; Tangut Components
1B000..1B0FF; Kana Supplement
1B100..1B12F; Kana Extended-A
1B130..1B16F; Small Kana Extension
1B170..1B2FF; Nushu
1BC00..1BC9F; Duployan
1BCA0..1BCAF; Shorthand Format Controls
1D000..1D0FF; Byzantine Musical Symbols
1D100..1D1FF; Musical Symbols
1D200..1D24F; Ancient Greek Musical Notation
1D2E0..1D2FF; Mayan Numerals
1D300..1D35F; Tai Xuan Jing Symbols
1D360..1D37F; Counting Rod Numerals
1D400..1D7FF; Mathematical Alphanumeric Symbols
1D800..1DAAF; Sutton SignWriting
1E000..1E02F; Glagolitic Supplement
1E100..1E14F; Nyiakeng Puachue Hmong
1E2C0..1E2FF; Wancho
1E800..1E8DF; Mende Kikakui
1E900..1E95F; Adlam
1EC70..1ECBF; Indic Siyaq Numbers
1ED00..1ED4F; Ottoman Siyaq Numbers
1EE00..1EEFF; Arabic Mathematical Alphabetic Symbols
1F000..1F02F; Mahjong Tiles
1F030..1F09F; Domino Tiles
1F0A0..1F0FF; Playing Cards
1F100..1F1FF; Enclosed Alphanumeric Supplement
1F200..1F2FF; Enclosed Ideographic Supplement
1F300..1F5FF; Miscellaneous Symbols and Pictographs
1F600..1F64F; Emoticons
1F650..1F67F; Ornamental Dingbats
1F680..1F6FF; Transport and Map Symbols
1F700..1F77F; Alchemical Symbols
1F780..1F7FF; Geometric Shapes Extended
1F800..1F8FF; Supplemental Arrows-C
1F900..1F9FF; Supplemental Symbols and Pictographs
1FA00..1FA6F; Chess Symbols
1FA70..1FAFF; Symbols and Pictographs Extended-A
20000..2A6DF; CJK Unified Ideographs Extension B
2A700..2B73F; CJK Unified Ideographs Extension C
2B740..2B81F; CJK Unified Ideographs Extension D
2B820..2CEAF; CJK Unified Ideographs Extension E
2CEB0..2EBEF; CJK Unified Ideographs Extension F
2F800..2FA1F; CJK Compatibility Ideographs Supplement
E0000..E007F; Tags
E0100..E01EF; Variation Selectors Supplement
F0000..FFFFF; Supplementary Private Use Area-A
100000..10FFFF; Supplementary Private Use Area-B

# EOF
''') 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2020-09-17T03:28:26.037

```
pip install unicodeblock 
```

第三方库[UnicodeBlock](https://github.com/neuront/pyunicodeblock)执行此操作。这是他们页面中的一个示例：

```
>>> import unicodeblock.blocks
>>> print(unicodeblock.blocks.of('0'))
DIGIT
>>> print(unicodeblock.blocks.of('汉'))
CJK_UNIFIED_IDEOGRAPHS
>>> print(unicodeblock.blocks.of('あ'))
HIRAGANA 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2021-09-08T19:19:18.320

如果块的标题是两个词，则不是很准确

```
def uniblk(one):
  return unicodedata.name(one).split(" ")[0]
uniblk('a') -> LATIN 
```

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2009-12-10T03:00:47.180

unicodedata.name(chr)

# python - 如何在 Python 中将对象的所有属性复制到另一个对象？

> ID：243836
> 
> 赞同：60
> 
> 时间：2008-10-28T15:58:11.420
> 
> 标签：python

是否有一个库方法可以在 Python 中复制同一类的两个（已经存在的）实例之间的所有属性？

我的意思是，像 Apache Commons'`PropertyUtilsBean.copyProperties()`

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-10-28T20:06:09.080

试试`destination.__dict__.update(source.__dict__)`。

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2008-10-28T17:16:27.423

如果您的类没有修改`__getitem__`或`__setitem__`用于特殊属性访问，则所有属性都存储在其中，`__dict__`因此您可以执行以下操作：

```
 nobj.__dict__ = oobj.__dict__.copy()    # just a shallow copy 
```

如果你使用 python 属性，你应该查看`inspect.getmembers()`并过滤掉你想要复制的那些。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-31T01:48:56.437

如果你必须这样做，我想最好的方法是有一个类属性，比如：

```
Class Copyable(object):
    copyable_attributes = ('an_attribute', 'another_attribute') 
```

然后显式地迭代它们并使用`setattr(new, attr, getattr(old, attr))`. 我仍然相信它可以通过更好的设计来解决，并且不推荐它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-29T22:07:04.000

冒着被改装的风险，这有~~什么合适的~~用例吗？

除非我们确切地知道它的用途，否则我们不能明智地将其称为“破碎”。

也许试试这个：

```
firstobject.an_attribute = secondobject.an_attribute
firstobject.another_attribute = secondobject.another_attribute 
```

这是在实例之间复制事物的明智方式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-02-25T05:20:54.400

使用它，您几乎可以将所有内容从一个对象复制到另一个对象：

```
import sys

_target_object = sys.stderr
_target_object_class_type = type( _target_object )

class TargetCopiedObject(_target_object_class_type):
    """
        Which special methods bypasses __getattribute__ in Python?
        https://stackoverflow.com/questions/12872695/which-special-methods-bypasses
    """

    if hasattr( _target_object, "__abstractmethods__" ):
        __abstractmethods__ = _target_object.__abstractmethods__

    if hasattr( _target_object, "__base__" ):
        __base__ = _target_object.__base__

    if hasattr( _target_object, "__bases__" ):
        __bases__ = _target_object.__bases__

    if hasattr( _target_object, "__basicsize__" ):
        __basicsize__ = _target_object.__basicsize__

    if hasattr( _target_object, "__call__" ):
        __call__ = _target_object.__call__

    if hasattr( _target_object, "__class__" ):
        __class__ = _target_object.__class__

    if hasattr( _target_object, "__delattr__" ):
        __delattr__ = _target_object.__delattr__

    if hasattr( _target_object, "__dict__" ):
        __dict__ = _target_object.__dict__

    if hasattr( _target_object, "__dictoffset__" ):
        __dictoffset__ = _target_object.__dictoffset__

    if hasattr( _target_object, "__dir__" ):
        __dir__ = _target_object.__dir__

    if hasattr( _target_object, "__doc__" ):
        __doc__ = _target_object.__doc__

    if hasattr( _target_object, "__eq__" ):
        __eq__ = _target_object.__eq__

    if hasattr( _target_object, "__flags__" ):
        __flags__ = _target_object.__flags__

    if hasattr( _target_object, "__format__" ):
        __format__ = _target_object.__format__

    if hasattr( _target_object, "__ge__" ):
        __ge__ = _target_object.__ge__

    if hasattr( _target_object, "__getattribute__" ):
        __getattribute__ = _target_object.__getattribute__

    if hasattr( _target_object, "__gt__" ):
        __gt__ = _target_object.__gt__

    if hasattr( _target_object, "__hash__" ):
        __hash__ = _target_object.__hash__

    if hasattr( _target_object, "__init__" ):
        __init__ = _target_object.__init__

    if hasattr( _target_object, "__init_subclass__" ):
        __init_subclass__ = _target_object.__init_subclass__

    if hasattr( _target_object, "__instancecheck__" ):
        __instancecheck__ = _target_object.__instancecheck__

    if hasattr( _target_object, "__itemsize__" ):
        __itemsize__ = _target_object.__itemsize__

    if hasattr( _target_object, "__le__" ):
        __le__ = _target_object.__le__

    if hasattr( _target_object, "__lt__" ):
        __lt__ = _target_object.__lt__

    if hasattr( _target_object, "__module__" ):
        __module__ = _target_object.__module__

    if hasattr( _target_object, "__mro__" ):
        __mro__ = _target_object.__mro__

    if hasattr( _target_object, "__name__" ):
        __name__ = _target_object.__name__

    if hasattr( _target_object, "__ne__" ):
        __ne__ = _target_object.__ne__

    if hasattr( _target_object, "__new__" ):
        __new__ = _target_object.__new__

    if hasattr( _target_object, "__prepare__" ):
        __prepare__ = _target_object.__prepare__

    if hasattr( _target_object, "__qualname__" ):
        __qualname__ = _target_object.__qualname__

    if hasattr( _target_object, "__reduce__" ):
        __reduce__ = _target_object.__reduce__

    if hasattr( _target_object, "__reduce_ex__" ):
        __reduce_ex__ = _target_object.__reduce_ex__

    if hasattr( _target_object, "__repr__" ):
        __repr__ = _target_object.__repr__

    if hasattr( _target_object, "__setattr__" ):
        __setattr__ = _target_object.__setattr__

    if hasattr( _target_object, "__sizeof__" ):
        __sizeof__ = _target_object.__sizeof__

    if hasattr( _target_object, "__str__" ):
        __str__ = _target_object.__str__

    if hasattr( _target_object, "__subclasscheck__" ):
        __subclasscheck__ = _target_object.__subclasscheck__

    if hasattr( _target_object, "__subclasses__" ):
        __subclasses__ = _target_object.__subclasses__

    if hasattr( _target_object, "__subclasshook__" ):
        __subclasshook__ = _target_object.__subclasshook__

    if hasattr( _target_object, "__text_signature__" ):
        __text_signature__ = _target_object.__text_signature__

    if hasattr( _target_object, "__weakrefoffset__" ):
        __weakrefoffset__ = _target_object.__weakrefoffset__

    if hasattr( _target_object, "mro" ):
        mro = _target_object.mro

    def __init__(self):
        """
            Override any super class `type( _target_object )` constructor,
            so we can instantiate any kind of replacement object.

            Assures all properties were statically replaced just above. This
            should happen in case some new attribute is added to the python
            language.

            This also ignores the only two methods which are not equal,
            `__init__()` and `__getattribute__()`.

            How do you programmatically set an attribute?
            https://stackoverflow.com/questions/285061/how-do-you-programmatically
        """
        different_methods = set(["__init__", "__getattribute__"])
        attributes_to_check = set( dir( object ) + dir( type ) )
        attributes_to_copy = dir( _target_object )

        # Check for missing magic built-ins methods on the class static initialization
        for attribute in attributes_to_check:

            if attribute not in different_methods \
                    and hasattr( _target_object, attribute ):

                base_class_attribute = self.__getattribute__( attribute )
                target_class_attribute = _target_object.__getattribute__( attribute )

                if base_class_attribute != target_class_attribute:
                    sys.stdout.write(
                            "    The base class attribute `%s` is different from the "
                            "target class:\n%s\n%s\n\n" % ( attribute,
                                                    base_class_attribute, 
                                                    target_class_attribute ) )
        # Finally copy everything it can
        different_methods.update( attributes_to_check )

        for attribute in attributes_to_copy:

            if attribute not in different_methods:
                print( "Setting:", attribute )

                try:
                    target_class_attribute = _target_object.__getattribute__(attribute)
                    setattr( self, attribute, target_class_attribute )

                except AttributeError as error:
                    print( "Error coping the attribute `%s`: %s" % (attribute, error) )

o = TargetCopiedObject()
print( "TargetCopiedObject:", o ) 
```

但是，如果您运行上面的代码，您将看到以下错误：

```
python test.py
Setting: _CHUNK_SIZE
Setting: __del__
Setting: __enter__
Setting: __exit__
Setting: __getstate__
Setting: __iter__
Setting: __next__
Setting: _checkClosed
Setting: _checkReadable
Setting: _checkSeekable
Setting: _checkWritable
Setting: _finalizing
Setting: buffer
Error coping the attribute `buffer`: readonly attribute
Setting: close
Setting: closed
Error coping the attribute `closed`: attribute 'closed' of '_io.TextIOWrapper' objects is not writable
Setting: detach
Setting: encoding
Error coping the attribute `encoding`: readonly attribute
Setting: errors
Error coping the attribute `errors`: attribute 'errors' of '_io.TextIOWrapper' objects is not writable
Setting: fileno
Setting: flush
Setting: isatty
Setting: line_buffering
Error coping the attribute `line_buffering`: readonly attribute
Setting: mode
Setting: name
Error coping the attribute `name`: attribute 'name' of '_io.TextIOWrapper' objects is not writable
Setting: newlines
Error coping the attribute `newlines`: attribute 'newlines' of '_io.TextIOWrapper' objects is not writable
Setting: read
Setting: readable
Setting: readline
Setting: readlines
Setting: seek
Setting: seekable
Setting: tell
Setting: truncate
Setting: writable
Setting: write
Setting: writelines
TargetCopiedObject: <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'> 
```

您只能通过在类静态初始化上复制这些只读属性，就像`__str__`上面的其他内置魔法 python 方法一样：

```
import sys

_target_object = sys.stderr
_target_object_class_type = type( _target_object )

class TargetCopiedObject(_target_object_class_type):
    """
        Which special methods bypasses __getattribute__ in Python?
        https://stackoverflow.com/questions/12872695/which-special-methods-bypasses
    """

    if hasattr( _target_object, "__abstractmethods__" ):
        __abstractmethods__ = _target_object.__abstractmethods__

    if hasattr( _target_object, "__base__" ):
        __base__ = _target_object.__base__

    if hasattr( _target_object, "__bases__" ):
        __bases__ = _target_object.__bases__

    if hasattr( _target_object, "__basicsize__" ):
        __basicsize__ = _target_object.__basicsize__

    if hasattr( _target_object, "__call__" ):
        __call__ = _target_object.__call__

    if hasattr( _target_object, "__class__" ):
        __class__ = _target_object.__class__

    if hasattr( _target_object, "__delattr__" ):
        __delattr__ = _target_object.__delattr__

    if hasattr( _target_object, "__dict__" ):
        __dict__ = _target_object.__dict__

    if hasattr( _target_object, "__dictoffset__" ):
        __dictoffset__ = _target_object.__dictoffset__

    if hasattr( _target_object, "__dir__" ):
        __dir__ = _target_object.__dir__

    if hasattr( _target_object, "__doc__" ):
        __doc__ = _target_object.__doc__

    if hasattr( _target_object, "__eq__" ):
        __eq__ = _target_object.__eq__

    if hasattr( _target_object, "__flags__" ):
        __flags__ = _target_object.__flags__

    if hasattr( _target_object, "__format__" ):
        __format__ = _target_object.__format__

    if hasattr( _target_object, "__ge__" ):
        __ge__ = _target_object.__ge__

    if hasattr( _target_object, "__getattribute__" ):
        __getattribute__ = _target_object.__getattribute__

    if hasattr( _target_object, "__gt__" ):
        __gt__ = _target_object.__gt__

    if hasattr( _target_object, "__hash__" ):
        __hash__ = _target_object.__hash__

    if hasattr( _target_object, "__init__" ):
        __init__ = _target_object.__init__

    if hasattr( _target_object, "__init_subclass__" ):
        __init_subclass__ = _target_object.__init_subclass__

    if hasattr( _target_object, "__instancecheck__" ):
        __instancecheck__ = _target_object.__instancecheck__

    if hasattr( _target_object, "__itemsize__" ):
        __itemsize__ = _target_object.__itemsize__

    if hasattr( _target_object, "__le__" ):
        __le__ = _target_object.__le__

    if hasattr( _target_object, "__lt__" ):
        __lt__ = _target_object.__lt__

    if hasattr( _target_object, "__module__" ):
        __module__ = _target_object.__module__

    if hasattr( _target_object, "__mro__" ):
        __mro__ = _target_object.__mro__

    if hasattr( _target_object, "__name__" ):
        __name__ = _target_object.__name__

    if hasattr( _target_object, "__ne__" ):
        __ne__ = _target_object.__ne__

    if hasattr( _target_object, "__new__" ):
        __new__ = _target_object.__new__

    if hasattr( _target_object, "__prepare__" ):
        __prepare__ = _target_object.__prepare__

    if hasattr( _target_object, "__qualname__" ):
        __qualname__ = _target_object.__qualname__

    if hasattr( _target_object, "__reduce__" ):
        __reduce__ = _target_object.__reduce__

    if hasattr( _target_object, "__reduce_ex__" ):
        __reduce_ex__ = _target_object.__reduce_ex__

    if hasattr( _target_object, "__repr__" ):
        __repr__ = _target_object.__repr__

    if hasattr( _target_object, "__setattr__" ):
        __setattr__ = _target_object.__setattr__

    if hasattr( _target_object, "__sizeof__" ):
        __sizeof__ = _target_object.__sizeof__

    if hasattr( _target_object, "__str__" ):
        __str__ = _target_object.__str__

    if hasattr( _target_object, "__subclasscheck__" ):
        __subclasscheck__ = _target_object.__subclasscheck__

    if hasattr( _target_object, "__subclasses__" ):
        __subclasses__ = _target_object.__subclasses__

    if hasattr( _target_object, "__subclasshook__" ):
        __subclasshook__ = _target_object.__subclasshook__

    if hasattr( _target_object, "__text_signature__" ):
        __text_signature__ = _target_object.__text_signature__

    if hasattr( _target_object, "__weakrefoffset__" ):
        __weakrefoffset__ = _target_object.__weakrefoffset__

    if hasattr( _target_object, "mro" ):
        mro = _target_object.mro

    # Copy all the other read only attributes
    if hasattr( _target_object, "buffer" ):
        buffer = _target_object.buffer

    if hasattr( _target_object, "closed" ):
        closed = _target_object.closed

    if hasattr( _target_object, "encoding" ):
        encoding = _target_object.encoding

    if hasattr( _target_object, "errors" ):
        errors = _target_object.errors

    if hasattr( _target_object, "line_buffering" ):
        line_buffering = _target_object.line_buffering

    if hasattr( _target_object, "name" ):
        name = _target_object.name

    if hasattr( _target_object, "newlines" ):
        newlines = _target_object.newlines

    def __init__(self):
        """
            Override any super class `type( _target_object )` constructor,
            so we can instantiate any kind of replacement object.

            Assures all properties were statically replaced just above. This
            should happen in case some new attribute is added to the python
            language.

            This also ignores the only two methods which are not equal,
            `__init__()` and `__getattribute__()`.

            How do you programmatically set an attribute?
            https://stackoverflow.com/questions/285061/how-do-you-programmatically
        """

        # Add the copied read only atribute to the ignored list, so they
        # do not throw new errors while trying copy they dynamically
        different_methods = set\
        ([
            "__init__",
            "__getattribute__",
            "buffer",
            "closed",
            "encoding",
            "errors",
            "line_buffering",
            "name",
            "newlines",
        ])

        attributes_to_check = set( dir( object ) + dir( type ) )
        attributes_to_copy = dir( _target_object )

        # Check for missing magic built-ins methods on the class static initialization
        for attribute in attributes_to_check:

            if attribute not in different_methods \
                    and hasattr( _target_object, attribute ):

                base_class_attribute = self.__getattribute__( attribute )
                target_class_attribute = _target_object.__getattribute__( attribute )

                if base_class_attribute != target_class_attribute:
                    sys.stdout.write(
                            "    The base class attribute `%s` is different from the "
                            "target class:\n%s\n%s\n\n" % ( attribute,
                                                    base_class_attribute,
                                                    target_class_attribute ) )
        # Finally copy everything it can
        different_methods.update( attributes_to_check )

        for attribute in attributes_to_copy:

            if attribute not in different_methods:
                print( "Setting:", attribute )

                try:
                    target_class_attribute = _target_object.__getattribute__(attribute)
                    setattr( self, attribute, target_class_attribute )

                except AttributeError as error:
                    print( "Error coping the attribute `%s`: %s" % (attribute, error) )

o = TargetCopiedObject()
print( "TargetCopiedObject:", o ) 
```

现在这个新版本完全可以应付一切：

```
python test.py
Setting: _CHUNK_SIZE
Setting: __del__
Setting: __enter__
Setting: __exit__
Setting: __getstate__
Setting: __iter__
Setting: __next__
Setting: _checkClosed
Setting: _checkReadable
Setting: _checkSeekable
Setting: _checkWritable
Setting: _finalizing
Setting: close
Setting: detach
Setting: fileno
Setting: flush
Setting: isatty
Setting: mode
Setting: read
Setting: readable
Setting: readline
Setting: readlines
Setting: seek
Setting: seekable
Setting: tell
Setting: truncate
Setting: writable
Setting: write
Setting: writelines
TargetCopiedObject: <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'> 
```

它的缺点是您需要手动编写 Python 代码来克服只读属性。但是，您可以使用元编程即时编写 Python 代码：

1.  [Python：如何动态生成代码？](https://stackoverflow.com/questions/3974554/python-how-to-generate-the-code-on-the-fly)
2.  [https://en.wikipedia.org/wiki/Metaprogramming](https://en.wikipedia.org/wiki/Metaprogramming)

因此，如果您处理上面的初始代码，您可以编写一个脚本来生成它需要的代码。因此，您可以动态且完全地复制任何 Python 对象。

# asp.net - 需要帮助配置 IIS 以提供 2.0 Web 服务

> ID：243837
> 
> 赞同：0
> 
> 时间：2008-10-28T15:59:40.620
> 
> 标签：asp.net, iis, configuration

我正在尝试在当前为大型 .NET 1.0 Web 应用程序提供服务的 IIS 服务器上部署 ASP.NET 2.0 Web 服务应用程序。

我已经设置了一个适当的虚拟目录并将虚拟目录的 ASP.NET 版本设置为 2.0，当我尝试在 Web 浏览器中浏览该站点时，系统会提示我输入密码。如果我将 ASP.NET 版本设置为 1.0，则不会提示我输入密码，但显然会收到完整的应用程序错误。

如何配置 IIS 以便选择 .NET 2.0 版本而不需要密码提示？

我启用了匿名访问并将“身份验证访问”设置为集成 Windows 身份验证”

任何帮助或建议表示赞赏...

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T16:05:39.017

我会从几件事开始。

1.  确保您有一个单独的应用程序池，您在该池下运行它
2.  确保正确的用户帐户有权访问您的 Web 服务所在的目录。（通常这是网络服务帐户）
3.  如果这之后仍然存在问题，请测试另一个 .NET 2.0 应用程序，如果遇到问题，请尝试通过 aspnet_regiis.exe 应用程序修复或重新安装 ASP.NET。

# wpf - .NET Framework 3.0 (WPF) 的 Visual Studio 2005 扩展

> ID：243843
> 
> 赞同：2
> 
> 时间：2008-10-28T16:01:14.207
> 
> 标签：wpf, visual-studio, visual-studio-2005

Microsoft 是否放弃了对 Visual Studio 2005 上的 Windows Presentation Foundation (WPF) 的支持？

WPF 和 WCF 有一个社区技术预览 (CTP)，但[它不再可供](http://tinyurl.com/5hn2yd)下载。有适用于 Visual Studio 2005[的 Windows Workflow Foundation](http://www.microsoft.com/downloads/details.aspx?FamilyId=5D61409E-1FA3-48CF-8023-E8F38E709BA6&displaylang=en) (WF) 的已发布扩展。

但据我所知，Microsoft 在 Visual Studio 2005 中放弃了对 WPF 的支持，而是将它们作为 Visual Studio 2008 发布。任何人都可以确认或否认这一点吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T17:08:46.660

引用[Stu](https://stackoverflow.com/questions/243843/visual-studio-2005-extensions-for-net-framework-30-wpf#243871)指出的“ [Anthony @ MS](http://blogs.msdn.com/user/Profile.aspx?UserID=11698) ”的[博客文章：](http://blogs.msdn.com/acangialosi/archive/2008/06/27/vs-2005-extensions-for-net-framework-3-0-wpf-wcf-ctp-is-coming-off-the-ms-download-center.aspx)

> **.NET Framework 3.0 (WPF & WCF) CTP 的 VS 2005 Extensions 即将从 MS 下载中心下架**
> 
> 2006 年 11 月，Microsoft 发布了 .NET Framework 3.0 (WPF & WCF) 的 VS 2005 Extensions 的 CTP 版本。我们发布此 CTP 作为权宜之计，旨在为开发人员提供开始开发 .NET Framework 3.0 所需的（尽管非常有限）工具集。在发布代号为 Orcas 的 Visual Studio 2008 之前，这从未打算作为一个完整的产品发布，并且只是作为权宜之计。
> 
> 从那时起，Visual Studio 2008 已经发布，并且 SP1 即将推出。在 VS 2008 中，您拥有一组完全设计用于利用 WCF 和 WPF 引入的功能的工具。一直在使用 CTP 扩展进行开发的用户应该已经将他们的项目迁移到 VS 2008 以利用新功能，这比我们能够在 CTP 中提供的功能要好得多。
> 
> **2008 年 6 月 30 日星期一，** **此 CTP 的许可证将到期。** 下载将从 MS 下载中心删除。此时，任何现有用户都应该努力将他们的项目迁移到 VS 2008，以利用完全支持的 WPF 和 WCF 支持。
> 
> 发布时间：2008 年 6 月 27 日星期五上午 11:34

我想他们最好提前表明他们无意发布最终形式的扩展。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T16:09:09.383

是的，它从未超出CTP。

唯一的选择是手动启动超出 ctp 提供的范围。

我猜他们希望你升级到 VS 2008。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T16:08:00.293

是的，不幸的是，扩展似乎不再受支持 - 请参阅[此](http://blogs.msdn.com/acangialosi/archive/2008/06/27/vs-2005-extensions-for-net-framework-3-0-wpf-wcf-ctp-is-coming-off-the-ms-download-center.aspx)MSDN 博客文章了解更多详细信息。

# c# - 使用 .net 会员提供程序进行编程登录

> ID：243851
> 
> 赞同：7
> 
> 时间：2008-10-28T16:03:49.787
> 
> 标签：c#, .net, unit-testing, asp.net-membership, membership

我正在尝试对在测试中需要当前登录用户的一段代码进行单元测试。使用 .Net 2.0 Membership Provider，我如何以编程方式以用户身份登录此测试？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-07-10T19:33:32.987

```
if(Membership.ValidateUser("user1",P@ssw0rd))
        {
            FormsAuthentication.SetAuthCookie("user1",true); 
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T16:18:09.787

我发现创建一个处理设置和重置 Thread.CurrentPrincipal 的一次性类最方便。

```
 public class TemporaryPrincipal : IDisposable {
        private readonly IPrincipal _cache;

        public TemporaryPrincipal(IPrincipal tempPrincipal) {
            _cache = Thread.CurrentPrincipal;
            Thread.CurrentPrincipal = tempPrincipal;
        }

        public void Dispose() {
            Thread.CurrentPrincipal = _cache;
        }
    } 
```

在测试方法中，您只需使用这样的 using 语句包装您的调用：

```
using (new TemporaryPrincipal(new AnonymousUserPrincipal())) {
    ClassUnderTest.MethodUnderTest();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T19:19:52.963

您的代码实际上需要通过 ASP.NET 登录的用户，还是只需要 CurrentPrincipal？我认为您不需要以编程方式登录您的网站。您可以创建一个[GenericPrincipal](http://msdn.microsoft.com/en-us/library/system.security.principal.genericprincipal.aspx)，设置您需要的属性，并将其附加到，例如 Thread.CurrentPrincipal 或模拟的 HttpContext。如果您的代码实际上需要 RolePrincipal 或其他东西，那么我会更改代码以减少与 ASP.NET 成员身份的耦合。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T19:48:04.420

使用 Membership Provider，您可以使用 Membership.ValidateUser 验证用户。然后，您可以使用 FormsAuthentication.SetAuthCookie 设置身份验证 cookie。只要您有一个 cookie 容器，这应该允许您登录用户。

# asp.net - 需要帮助配置 IIS 以提供 2.0 Web 服务

> ID：243852
> 
> 赞同：0
> 
> 时间：2008-10-28T16:03:57.353
> 
> 标签：asp.net, iis, configuration

我正在尝试在当前为大型 .NET 1.0 Web 应用程序提供服务的 IIS 服务器上部署 ASP.NET 2.0 Web 服务应用程序。

我已经设置了一个适当的虚拟目录并将虚拟目录的 ASP.NET 版本设置为 2.0，当我尝试在 Web 浏览器中浏览该站点时，系统会提示我输入密码。如果我将 ASP.NET 版本设置为 1.0，则不会提示我输入密码，但显然会收到完整的应用程序错误。

如何配置 IIS 以便选择 .NET 2.0 版本而不需要密码提示？

我启用了匿名访问并将“身份验证访问”设置为集成 Windows 身份验证”

任何帮助或建议表示赞赏...

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T16:10:32.877

首先，确保您正在运行两个应用程序池，一个用于任何 .Net 1.1 Web 应用程序，另一个用于任何 .Net 2.0 Web 应用程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T18:18:52.247

一定要跑

```
c:\windows\microsoft.net\framework\v2.0.50727\aspnet_regiis.exe -i 
```

这将确保 ASP.Net 2.0 与 IIS 服务器正确设置。

其次，确保 Temp ASP.Net 文件夹对访问该站点的用户（IUSR_COMPUTERNAME 或 IIS_USER）具有读/写权限。

```
C:\windows\microsoft.net\framework\v2.0.50727\Temporary ASP.NET Files\ 
```

希望有帮助。

# ocaml - 与 Python 的 range 函数等效的 OCaml 习语是什么？

> ID：243864
> 
> 赞同：31
> 
> 时间：2008-10-28T16:06:33.900
> 
> 标签：ocaml

我想创建一个从 1 到 的整数列表`n`。我可以在 Python 中使用`range(1, n+1)`，在 Haskell 中使用：`take n (iterate (1+) 1)`。

什么是正确的 OCaml 习惯用法？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-28T17:13:42.967

没有我知道的成语，但这是一个使用中缀运算符的相当自然的定义：

```
# let (--) i j = 
    let rec aux n acc =
      if n < i then acc else aux (n-1) (n :: acc)
    in aux j [] ;;
val ( -- ) : int -> int -> int list = <fun>
# 1--2;;
- : int list = [1; 2]
# 1--5;;
- : int list = [1; 2; 3; 4; 5]
# 5--10;;
- : int list = [5; 6; 7; 8; 9; 10] 
```

或者，[理解语法扩展](http://dutherenverseauborddelatable.wordpress.com/downloads/comprehension-for-ocaml/)（提供上述语法`[i .. j]`）可能会包含在[OCaml 的“社区版本”的](http://forge.ocamlcore.org/projects/batteries/)未来版本中，因此这可能会变得惯用。不过，如果您不熟悉该语言，我不建议您开始使用语法扩展。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2010-05-28T01:33:00.953

[包括电池](http://batteries.forge.ocamlcore.org)，你可以写

```
let nums = List.of_enum (1--10);; 
```

`--`运算符生成从第一个值到第二个值的枚举。运算符类似，`--^`但枚举一个半开区间（`1--^10`将从 1 到 9 枚举）。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-28T17:07:22.980

干得好：

```
let rec range i j = if i > j then [] else i :: (range (i+1) j) 
```

请注意，这不是尾递归。现代 Python 版本甚至有一个惰性范围。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2018-04-11T17:48:53.590

这适用于基本 OCaml：

`＃ List.init 5 (fun x -> x + 1);; - : int list = [1; 2; 3; 4; 5]`

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2019-04-22T07:28:47.327

从上面跟随亚历克斯考文垂，但更短。

```
let range n = List.init n succ;;    
> val range : int -> int list = <fun>   
range 3;;                           
> - : int list = [1; 2; 3] 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-10-07T19:25:48.543

OCaml 具有用于范围模式匹配的特殊语法：

```
let () =
  let my_char = 'a' in
  let is_lower_case = match my_char with
  | 'a'..'z' -> true (* Two dots define a range pattern *)
  | _ -> false
  in
  printf "result: %b" is_lower_case 
```

要创建范围，您可以使用[`Core`](https://github.com/janestreet/core)：

```
List.range 0 1000 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2020-01-28T20:06:48.267

如果您打算模仿 的懒惰行为`range`，我实际上建议使用该`Stream`模块。就像是：

```
let range (start: int) (step: int) (stop: int): int stream =
    Stream.from (fun i -> let j = i * step + start in if j < stop then Some j else None) 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-12-28T06:33:31.277

如果你使用`open Batteries`（这是标准库的社区版本），你可以`range(1,n+1)`通过`List.range 1 `To n`（注意前面的反引号`To`）来做。

一种更通用的方法（也需要电池）是使用`List.init n f`它返回一个包含 (f 0) (f 1) ... (f (n-1)) 的列表。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-03-19T05:41:34.317

这里的游戏有点晚了，但这是我的实现：

```
let rec range ?(start=0) len =
    if start >= len
    then []
    else start :: (range len ~start:(start+1)) 
```

然后你可以像使用 python 函数一样使用它：

```
range 10 
     (* equals: [0; 1; 2; 3; 4; 5; 6; 7; 8; 9] *)

range ~start:(-3) 3 
     (* equals: [-3; -2; -1; 0; 1; 2] *) 
```

当然，我认为最好的答案是简单地使用 Core，但是如果您只需要一个功能并且您试图避免使用完整的框架，这可能会更好。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2019-07-06T11:49:16.563

想出了这个：

```
let range a b =
  List.init (b - a) ((+) a) 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2022-01-06T20:13:30.983

为了好玩，这是一个非常类似于 Python 的`range`使用惰性序列的实现：

```
let range ?(from=0) until ?(step=1) =
  let cmp = match step with
    | i when i < 0 -> (>)
    | i when i > 0 -> (<)
    | _ -> raise (Invalid_argument "step must not be zero")
  in
  Seq.unfold (function
        i when cmp i until -> Some (i, i + step) | _ -> None
    ) from 
```

因此，您可以通过以下方式获得从 1 到的整数列表`n`：

```
# let n = 10;;
val n : int = 10
# List.of_seq @@ range ~from:1 (n + 1);;
- : int list = [1; 2; 3; 4; 5; 6; 7; 8; 9; 10] 
```

它还提供了其他类似 Python 的行为，例如倒数：

```
# List.of_seq @@ range ~from:20 2 ~step:(-3);;
- : int list = [20; 17; 14; 11; 8; 5]

(* you have to use a negative step *)
# List.of_seq @@ range ~from:20 2;;
- : int list = []

# List.of_seq @@ range 10 ~step:0;;
Exception: Invalid_argument "step must not be zero". 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-04-26T19:36:13.867

如果您不需要“step”参数，实现此功能的一种简单方法是：

`let range start stop = List.init (abs @@ stop - start) (fun i -> i + start)`

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-01-30T07:31:20.170

Personnaly 我为此使用了 ocaml 的范围库

> ```
>  (* print sum of all values between 1 and 50, adding 4 to all elements and excluding 53 *)
>  Range.(from 1 50 |> map ((+) 4) |> filter ((!=) 53) |> fold (+) 0 |> print_int);; 
> ```

# python - 如何合并两个 python 迭代器？

> ID：243865
> 
> 赞同：28
> 
> 时间：2008-10-28T16:07:12.883
> 
> 标签：python, merge, iterator

我有两个迭代器，一个`list`和一个`itertools.count`对象（即一个无限值生成器）。我想将这两者合并到一个结果迭代器中，它将在两者之间交替产生值：

```
>>> import itertools
>>> c = itertools.count(1)
>>> items = ['foo', 'bar']
>>> merged = imerge(items, c)  # the mythical "imerge"
>>> merged.next()
'foo'
>>> merged.next()
1
>>> merged.next()
'bar'
>>> merged.next()
2
>>> merged.next()
Traceback (most recent call last):
    ...
StopIteration 
```

最简单、最简洁的方法是什么？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-10-28T16:14:02.387

生成器将很好地解决您的问题。

```
def imerge(a, b):
    for i, j in itertools.izip(a,b):
        yield i
        yield j 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-28T16:59:35.040

你可以做一些几乎完全符合@Pramod 最初建议的事情。

```
def izipmerge(a, b):
  for i, j in itertools.izip(a,b):
    yield i
    yield j 
```

这种方法的优点是，如果 a 和 b 都是无限的，您不会耗尽内存。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-12-05T22:39:29.963

我也同意不需要 itertools。

但是为什么停在2？

```
 def tmerge(*iterators):
    for values in zip(*iterators):
      for value in values:
        yield value 
```

处理从 0 开始的任意数量的迭代器。

更新：DOH！一位评论者指出，除非所有迭代器的长度相同，否则这将不起作用。

正确的代码是：

```
def tmerge(*iterators):
  empty = {}
  for values in itertools.izip_longest(*iterators, fillvalue=empty):
    for value in values:
      if value is not empty:
        yield value 
```

是的，我只是尝试使用长度不等的列表和包含 {} 的列表。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-10-28T16:12:19.597

我会做这样的事情。这将是最节省时间和空间的，因为您不会有将对象压缩在一起的开销。如果两者都是无限的`a`，这也将起作用。`b`

```
def imerge(a, b):
    i1 = iter(a)
    i2 = iter(b)
    while True:
        try:
            yield i1.next()
            yield i2.next()
        except StopIteration:
            return 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-10-28T16:15:15.707

您可以使用`zip`以及`itertools.chain`. 这**仅**在第一个列表是**有限**的情况下才有效：

```
merge=itertools.chain(*[iter(i) for i in zip(['foo', 'bar'], itertools.count(1))]) 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-03-23T01:48:00.413

我更喜欢这种更简洁的另一种方式：

```
iter = reduce(lambda x,y: itertools.chain(x,y), iters) 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-03-30T14:09:21.860

Python 鲜为人知的特性之一是您可以在生成器表达式中包含更多 for 子句。对于扁平化嵌套列表非常有用，例如从 zip()/izip() 获得的列表。

```
def imerge(*iterators):
    return (value for row in itertools.izip(*iterators) for value in row) 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-28T22:03:08.500

我不确定您的应用程序是什么，但您可能会发现 enumerate() 函数更有用。

```
>>> items = ['foo', 'bar', 'baz']
>>> for i, item in enumerate(items):
...  print item
...  print i
... 
foo
0
bar
1
baz
2 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-11-09T00:10:16.300

这是一个优雅的解决方案：

```
def alternate(*iterators):
    while len(iterators) > 0:
        try:
            yield next(iterators[0])
            # Move this iterator to the back of the queue
            iterators = iterators[1:] + iterators[:1]
        except StopIteration:
            # Remove this iterator from the queue completely
            iterators = iterators[1:] 
```

使用实际队列以获得更好的性能（如 David 所建议）：

```
from collections import deque

def alternate(*iterators):
    queue = deque(iterators)
    while len(queue) > 0:
        iterator = queue.popleft()
        try:
            yield next(iterator)
            queue.append(iterator)
        except StopIteration:
            pass 
```

即使某些迭代器是有限的而其他迭代器是无限的，它也可以工作：

```
from itertools import count

for n in alternate(count(), iter(range(3)), count(100)):
    input(n) 
```

印刷：

```
0
0
100
1
1
101
2
2
102
3
103
4
104
5
105
6
106 
```

如果/当所有迭代器都用尽时，它也会正确停止。

如果要处理非迭代器可迭代对象，例如列表，可以使用

```
def alternate(*iterables):
    queue = deque(map(iter, iterables))
    ... 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-06T00:08:15.180

一起使用 izip 和链：

```
>>> list(itertools.chain.from_iterable(itertools.izip(items, c))) # 2.6 only
['foo', 1, 'bar', 2]

>>> list(itertools.chain(*itertools.izip(items, c)))
['foo', 1, 'bar', 2] 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-28T21:34:43.410

为什么需要 itertools？

```
def imerge(a,b):
    for i,j in zip(a,b):
        yield i
        yield j 
```

在这种情况下，至少 a 或 b 之一的长度必须是有限的，因为 zip 将返回一个列表，而不是一个迭代器。如果您需要一个迭代器作为输出，那么您可以选择 Claudiu 解决方案。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-05T22:46:37.250

使用`itertools.izip()`，而不是`zip()`在其他一些答案中，将提高性能：

正如“pydoc itertools.izip”所示：

> 像 zip() 函数一样工作，但通过返回迭代器而不是列表来消耗更少的内存。

即使其中一个迭代器是无限的，Itertools.izip 也将正常工作。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-26T23:04:50.880

一个简洁的方法是使用带有 itertools.cycle() 的生成器表达式。它避免了创建一个长链（）的元组。

```
generator = (it.next() for it in itertools.cycle([i1, i2])) 
```

# php - WordPress插件开发

> ID：243873
> 
> 赞同：3
> 
> 时间：2008-10-28T16:08:14.910
> 
> 标签：php, wordpress, plugins, resources

除了 CODEX 之外，您还推荐哪些资源来帮助刚开始创建插件的人帮助创建 WordPress 插件。我有一个想法，但需要比 CODEX 中的内容更好的解释才能开始。

更新：有没有我可以买的书来帮助我解决这个问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T16:23:14.990

编写完 MyBlogLog 插件（即原始插件）后，我发现 Wordpress Hooks 列表（不记得链接的副手）非常有用，Codex 和 WP 安装文件中的示例代码也是如此。阅读其他开发人员的插件也是一种很好的学习方式，因为您可以看到他们如何实现事物并使用这些技术为自己节省一些研发时间。

无论如何，你想要创造什么？

**编辑：**

我对此发表了评论，但以防万一它丢失......

对于您的特定需求，您将希望存储数据并能够管理和检索它，因此您需要在插件中创建自定义数据库表。请参阅此法典链接：

[http://codex.wordpress.org/Creating_Tables_with_Plugins](http://codex.wordpress.org/Creating_Tables_with_Plugins)

然后，您可以使用此 Codex 页面上的技术将您的管理代码添加到管理屏幕中：

[http://codex.wordpress.org/Adding_Administration_Menus](http://codex.wordpress.org/Adding_Administration_Menus)

如果您想在页面上显示项目，您可以自己编写一个自定义 PHP WP Page 模板来直接查询数据库：

[http://codex.wordpress.org/Pages#Page_Templates](http://codex.wordpress.org/Pages#Page_Templates)

或者只是在您的插件上添加一个钩子过滤器，以根据您指定的关键字将结果写入页面：

[http://codex.wordpress.org/Plugin_API#Filters](http://codex.wordpress.org/Plugin_API#Filters)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-29T04:15:31.867

这是一组关于如何做 Wordpress 插件的[有用链接。](http://www.devlounge.net/extras/how-to-write-a-wordpress-plugin)请注意，它是相对“先进的”（因为它在过程中引入了许多面向对象的方法）。你真的应该先阅读 Wordpress Codex 的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T19:27:08.207

尽管在 Codex 中仍能找到技术上的信息，但 Codex 包含指向外部资源的链接。很抱歉没有发布直接链接，但再看一遍，你应该找到它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-24T23:05:42.393

我认为最重要的资源之一是其他插件中使用的代码。

不一定做你做的事情，但那些使用的人有你想要实现的功能。

例如，如果您想了解如何创建选项页面，如果您了解其他所有人的操作方式，您将很快完成。

# vb.net - VB.NET 导入类

> ID：243878
> 
> 赞同：1
> 
> 时间：2008-10-28T16:09:52.520
> 
> 标签：vb.net

**编辑：**这是不小心发布了两次。原文：[VB.NET 导入类](https://stackoverflow.com/questions/243900/vb-net-importing-classes)

我已经看到了一些导入*类*而不是命名空间的代码，从而使该类的所有静态成员/方法都可用。这是VB的特性吗？还是其他语言也这样做？

测试类.vb

```
public class TestClass
    public shared function Somefunc() as Boolean
        return true
    end function
end class 
```

主类.vb

```
imports TestClass

public class MainClass
    public sub Main()
        Somefunc()
    end sub
end class 
```

这些文件位于 App_Code 目录中。只是好奇，因为我以前从未想过这样做，也没有在任何地方读过它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T16:15:38.717

通过使用“HideModuleNameAttribute”，您可以在不识别其父级的情况下调用方法。

例子：

```
Public Class TestClassCaller
    Public Sub New()
        SomeMethod()
    End Sub

End Class

<HideModuleName()> _
    Public Module TestClass
    Public Sub SomeMethod()

    End Sub
End Module 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T16:45:01.590

[Imports](http://msdn.microsoft.com/en-us/library/7f38zh8x(VS.80).aspx)只创建对类的引用，它不会创建它的实例以供使用。

您在新类中看到该函数的原因是它是一个[共享](http://msdn.microsoft.com/en-us/library/zc2b427x(VS.80).aspx)函数，不需要父级创建一个实例即可使用。

干杯!

# iis - 需要帮助配置 IIS 以提供 2.0 Web 服务

> ID：243886
> 
> 赞同：0
> 
> 时间：2008-10-28T16:10:54.653
> 
> 标签：iis

我正在尝试在当前为大型 .NET 1.0 Web 应用程序提供服务的 IIS 服务器上部署 ASP.NET 2.0 Web 服务应用程序。

我已经设置了一个适当的虚拟目录并将虚拟目录的 ASP.NET 版本设置为 2.0，当我尝试在 Web 浏览器中浏览该站点时，系统会提示我输入密码。如果我将 ASP.NET 版本设置为 1.0，则不会提示我输入密码，但显然会收到完整的应用程序错误。

如何配置 IIS 以便选择 .NET 2.0 版本而不需要密码提示？

我启用了匿名访问并将“身份验证访问”设置为集成 Windows 身份验证”

我应该提一下，我在此服务器上配置了另一个 2.0 Web 服务应用程序，与此相同，它工作正常。任何帮助或建议表示赞赏...

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-03T17:43:35.210

如果您收到提示，那么您很可能在 VDir 上有安全配置问题。

有几件事要检查 -

1.  您的身份验证设置为什么 - 匿名或 Windows 集成。
2.  如果您设置为匿名，匿名用户组是否有权限？
3.  如果您设置为 WIA，IIS_WPG 是否有权限？
4.  您的应用程序池以什么方式运行？如果它是本地帐户或域帐户，您是否将该帐户添加到 IIS_WPG？
5.  比较此 VDIR 上的权限与有效的权限
6.  最后，您使用的是什么网址？如果它不是机器名称，Kerberos 可能是问题吗？您是否正确设置了 SPN？你是否关闭了协商？

# asp.net - JavaScript 中 window.onback 的意外行为？

> ID：243887
> 
> 赞同：1
> 
> 时间：2008-10-28T16:10:54.873
> 
> 标签：asp.net, javascript, back-button

我正在使用 window.onback = history.forward(); 以防止用户重新提交数据。我知道这是一个 hack，我也不喜欢它，但这不是这个问题的目的。问题是代码阻止其他页面返回到带有代码的页面。让我澄清一下。

PageA.aspx 中包含 JavaScript 代码。用户提交 PageA，点击返回，但没有任何反应。那挺好的。*现在用户单击没有*代码的 PageB.aspx 的链接。当用户单击后退按钮时，应该将她带到 PageA.aspx，但它没有。它表现出与 PageB 具有无返回 JavaScript 代码相同的行为。

这是我在 PageA.aspx 中实现它的方式：

```
<script type="text/javascript">
window.onback = history.forward();
</script> 
```

我已确认此代码仅在 PageA.aspx 中，而不在主文件、包含文件或其他任何内容中。这是一个在 SharePoint 2007 中运行的 ASP.NET 2.0 应用程序。浏览器是 IE7。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T16:51:26.210

我没有时间（或 SharePoint07）来重现您的环境和场景，但是如果您在 JavaScript 中进行位置测试呢？

像这样的东西：

```
<script type="text/javascript">
if (window.location.indexOf("PageA.aspx", 0) > 0)
{
   window.onback = history.forward();
}
</script> 
```

我无法解释发生了什么，但这应该有助于限制黑客攻击的范围。

# asp.net - 推出整个网站，还是只更改页面/元素？(ASP.NET)

> ID：243893
> 
> 赞同：2
> 
> 时间：2008-10-28T16:12:34.340
> 
> 标签：asp.net, webserver, production, rollout

我们使用 ASP.NET、C#

在对我们的某个网站进行更新时，我们会推出整个网站，而不是仅更新已更改的页面或部分。这让我害怕。

这是一个好主意吗？我应该只推出更改吗？

我应该把我的网站分成更小的项目吗？

什么是最佳实践？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T16:14:16.100

您应该始终推出整个网站。因为实际的可执行代码主要包含在 DLL 中，所以实际上不能像使用旧的 ASP 那样只推出已更改的页面。如果您的网站的某些部分实际上是独立的，您可以将它们分成单独的项目，并单独部署每个完整部分。

此外，如果建立整个站点让您感到害怕，您可能需要更好的测试或质量保证标准。应该始终有一个可以随时上线的整个站点的副本，以防服务器死机，您必须更换它，或者出现其他问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T16:15:41.650

取决于您在部署之前如何进行测试。

如果您（自动）在发布之前测试所有内容，这并不是文件传输开销的唯一缺点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T16:58:49.987

如果项目作为一个整体进行测试，则最好使用完整转储；但是，当您的更改单独进行回归测试时，通常可以接受单个页面。只需确保您的程序集引用已正确版本化:)

# javascript - javascript 闭包和函数放置

> ID：243894
> 
> 赞同：3
> 
> 时间：2008-10-28T16:12:35.853
> 
> 标签：javascript, performance, coding-style, structure, closures

函数的放置是否会影响范围内闭包的性能？如果是这样，放置这些功能的最佳位置在哪里？如果不是，那么闭包的隐含关联是否足以在逻辑上将函数放置在另一个地方？

例如，如果**foo**不依赖于 localState 的值，**那么****localState**可以从**foo**访问这一事实是否会对**foo**的执行时间、内存使用等产生影响？

```
(function(){
    var localState;

    function foo(){
        // code
    }

    function bar(){
        // code
        return localState;
    }
})(); 
```

换句话说，这会是一个更好的选择吗？如果是，为什么？

```
(function(){
    function foo(){
        // code
    }

    var localState;

    function bar(){
        // code
        return localState;
    }
})(); 
```

[Darius Bacon在](https://stackoverflow.com/users/27024/darius-bacon)[下面](https://stackoverflow.com/questions/243894/javascript-closures-and-function-placement#243942)建议，上面的两个示例是相同的，因为可以从块内的任何位置访问**localState 。**但是，下面的示例**foo**在块外定义可能是不同的情况。你怎么看？

```
function foo(){
    // code
}

(function(){

    var localState;

    function bar(){
        // code
        foo();
        return localState;
    }
})(); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T16:23:27.483

这两个片段都是等价的，因为它们都是在您正在创建的匿名函数的（相同）环境中定义的。我认为您可以`localState`从`foo`任何一种方式访问​​。

话虽如此...如果您正在创建的环境中有大量变量，那么`foo`的执行时间可能会受到影响，因为变量查找可能需要更长的时间。如果您在定义的函数中不再使用大量变量`foo`，并且`foo`也不需要它们，那么`foo`将导致它们不被垃圾收集，因此这也可能是一个问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-28T20:46:53.210

狗，我希望声明的顺序是 JavaScript 解释器抽象出来的东西。在任何情况下，如果存在性能差异，那么它就会成为过早优化弊端的典型代表。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-29T14:12:34.423

Javascript 中的每个函数都是一个闭包。仅当函数引用该变量时，才会产生解析变量值的运行时。例如，在这个例子中，即使 x 没有被 y 直接引用，函数 y 也会捕获 x 的值：

```
var x = 3;
function y() eval("x");
y();
3 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T16:22:35.583

我认为不会有任何性能开销，因为 java 脚本不使用函数堆栈的概念。它支持词法作用域。在闭包调用中执行相同的状态。附带说明一下，在您的示例中，您似乎没有执行任何语句！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-28T16:22:15.740

var 或 function 声明的范围是它出现的整个块，无论声明在块中的哪个位置；所以它会影响效率是令人惊讶的。

也就是说，“function foo()”在此块中是在“var localState”之前还是之后都无关紧要。*“function foo()”是在这个块中还是在一个封闭的块中可能*很重要（如果它可以提升到更高的范围，因为它不使用*任何*局部变量）；这取决于您的 Javascript 编译器的详细信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-14T14:44:13.413

在您的示例中，差异并不重要。即使 foo 在全局范围内，您也不会有问题。

但是，请记住，如果您使用将函数分配给变量的方式来声明您的函数，那么它们的声明顺序可能会成为一个很大的问题。

为了更好地了解，请尝试以下两个示例：

```
CheckOne();
function CheckOne() {
    alert('check...check one.');
}

CheckTwo();
var CheckTwo = function() {
    alert('check...check two.');
}; 
```

第二个和第一个之间的唯一区别是它们用于声明其函数的样式。第二个生成参考错误。

干杯。

# php - PHP：在循环中使用之前声明变量的正确方法

> ID：243897
> 
> 赞同：7
> 
> 时间：2008-10-28T16:12:47.397
> 
> 标签：php, performance, loops

我有一个内置循环的变量。就像是：

```
$str = "";
for($i = 0; $i < 10; $i++) $str .= "something"; 
```

如果省略了 $str = "" ，我会收到未定义的变量通知，但我认为 php 在第一次看到未声明的变量时会自动声明一个变量？

我该怎么做？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-28T16:15:59.980

您得到未定义的变量，因为您将自身的值与另一个值连接起来。

相当于

> `$str = $str . "something";`

所以，它不能说初始值是多少。这相当于：

> `$str = [undefined value] . "something";`

`[undefined value]`和串联的结果是什么`"something"`？翻译不能说...

因此，您必须先放入`""`变量以启动变量的值，就像您所做的那样。

高温高压

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-28T16:18:32.487

如果你真的需要让它更清洁，你可以这样做：

```
for($i = 0, $str = ''; $i < 10; $i++) $str .= "something"; 
```

但你所拥有的是我通常所做的。vlceBerg 解释得很好。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-28T16:17:22.003

不使用自动声明功能更安全——这就是它发出通知的原因。通知是最低级别的警告，默认不会显示。如果您打开它们，大多数较旧的 PHP 应用程序会发出大量通知。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T16:21:40.983

自动声明的 PHP 变量被注册为未定义，这就是您收到通知的原因。

通常最好在使用 PHP 变量之前声明它们，尽管我们中间的许多懒惰者，包括我自己并不总是这样做。

# php - 大型自定义调查/报告应用程序 - 最佳实践

> ID：243898
> 
> 赞同：4
> 
> 时间：2008-10-28T16:13:00.827
> 
> 标签：php, reporting, scaling, survey

### 情况

当您学习社会科学时，您经常会遇到在线调查（在线科学数据收集）的需求。**这就是我最初使用PHP**的主要原因之一。

最近，这些调查应用程序越来越多。增加了**很多复杂性**：报告（闪存图表、PDF 生成）、数据聚合、不同级别的聚合（例如公司单位）、针对所涉及公司的问卷模块选择等。

现在，我发现自己面临着一个复杂的数据收集和报告应用程序，该应用程序**变得缓慢且难以维护**。

我的一个平台每天有多达 100 个新用户，并且汇总/报告了**数千个用户** *乘以* **数百个数据项** *乘以* **几十个层次结构级别**的数据。

### 我的问题

*   PHP/mysql 是否还有路要走？
*   像 codeIgnitor 这样的框架可以作为此类应用程序的基础还是我应该从头开始开发所有东西？
*   您知道我可以用作基础的任何类型的调查特定框架吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T17:01:58.343

PHP/mysql 对于这个规模应该没问题，但你必须调整它并给它足够的资源。

例如，如果您的架构没有经过深思熟虑，您将遇到各种性能障碍。数据的存储和索引方式可能是影响报告性能的最重要因素。我在 mysql 中有 60-100gb 的数据，对于轻度复杂的查询具有亚秒级的响应时间。重要的因素是：

*   我的数据被索引为我使用它的方式
*   我使用的查询经过深思熟虑、测试和优化

接下来，您必须为您的 MySQL 服务器提供足够的资源。如果您在共享托管服务器上运行您的应用程序并且您使用的是开箱即​​用的设置，那么 mysql 可能无法在超过几百 mb 的数据时运行良好。确保您的缓存经过调整，您的表类型对您的应用程序有意义，并且您有足够的内存和足够快的磁盘来满足您的性能需求。

最后，当我们的数据集变大时，我们都会使用一个技巧：在 cron 上而不是按需生成报告。如果生成闪存图需要 2 分钟，则每 5 分钟运行一次 cron 以生成数据。将其粘贴在某个文件中，然后将其吐出到图形软件中，而不是实时查询数据库。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T17:17:35.363

> PHP/mysql 是否还有路要走？

是的，PHP/MYSQL (LAMP) 已成功用于数百个用户群比您的用户群大得多的站点。

> 像 codeIgnitor 这样的框架可以作为此类应用程序的基础还是我应该从头开始开发所有东西？

没有框架（或自定义构建的框架）构建的非平凡 PHP 站点往往会很快变得草率。PHP 框架现在是入门的标准，我个人推荐[Zend 框架](http://framework.zend.com)。它是一个非常健壮的框架，为许多常见的 PHP 任务（数据库、日期、JSON、RPC、REST 的替换/增强）提供了工具，并为 Web 应用程序开发提供了一种有组织的方法：使用[Zend_Controller的](http://framework.zend.com/manual/en/zend.controller.html)[MVC](http://en.wikipedia.org/wiki/Model-view-controller)。

> 您知道我可以用作基础的任何类型的调查特定框架吗？

我不知道，但您可能想尝试使用[Zend_Form](http://framework.zend.com/manual/en/zend.form.quickstart.html#zend.form.quickstart.config)从配置文件中自动生成表单元素（类型、过滤器、消毒剂、验证器）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-02-07T13:57:30.953

您应该查看开源 Limesurvey 应用程序。

它使用 PHP/Mysql，因此可以解决您关于 PHP 是否适合该任务的问题之一。

Limesurvey 之前的版本是用 CodeIgniter 编写的，但是在对 CodeIgniter 许可证的不确定和混淆之后，项目负责人更改为 Yii 框架。

你的第三个问题上面已经回答了。

参考资料： [https ://www.limesurvey.org/](https://www.limesurvey.org/)

# vb.net - VB.NET 导入类

> ID：243900
> 
> 赞同：4
> 
> 时间：2008-10-28T16:13:38.737
> 
> 标签：vb.net, import

我已经看到了一些导入*类*而不是命名空间的代码，从而使该类的所有静态成员/方法都可用。这是VB的特性吗？还是其他语言也这样做？

测试类.vb

```
public class TestClass
    public shared function Somefunc() as Boolean
        return true
    end function
end class 
```

主类.vb

```
imports TestClass

public class MainClass
    public sub Main()
        Somefunc()
    end sub
end class 
```

这些文件位于 App_Code 目录中。只是好奇，因为我以前从未想过这样做，也没有在任何地方读过它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-29T12:33:55.420

使用此功能的原因之一是模拟 Visual Basic 6.0 的 GlobalMultiUse Option for Instancing。Visual Basic 6.0 无法跨 DLL 边界公开模块。相反，您将实例化属性设置为`GlobalMultiUse`. 它主要用于实用程序类，例如导出一系列数学函数的类。

每次使用 调用类的子例程或函数时`GlobalMultiUse Instancing`，Visual Basic 6.0 都会在调用函数之前在后台实例化一个类。

它可以被滥用来生成具有所有优点和缺点的全局函数/变量。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T16:44:10.813

是的，它是[Visual Basic 语言的一项功能](http://msdn.microsoft.com/en-us/library/7f38zh8x.aspx)。[虽然您可以使用C# 的 using 语句](http://msdn.microsoft.com/en-us/library/sf0df423.aspx)创建别名，但您似乎无法将共享类导入范围。老实说，我只在已经使用过它的遗留项目中使用过一次。我看到了一些价值，但我担心它可能对您的代码的未来可维护性造成弊大于利。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T06:01:32.497

每当我大量使用同一个库时，我都会使用它。一个很好的例子是 System.Math。

C# 不支持这一点，我觉得这很烦人。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T16:17:55.437

实际上，该功能是可用的，因为它是一个[共享](http://msdn.microsoft.com/en-us/library/zc2b427x(VS.80).aspx)功能。如果要删除 shared 修饰符，您仍然必须创建该类的实例才能访问它。

要在默认情况下实现对类中所有变量和所有函数的访问，您需要继承它。

据我所知，[导入](http://visualbasic.about.com/od/usingvbnet/l/bldykImportsa.htm)一个类基本上是直接引用它，而不是创建它的任何实例供您使用。

为清楚起见进行编辑：链接中有 VB 特定链接，因此，解释了与 VB.NET 相关的功能

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2011-04-18T02:08:14.677

等等，等等，等等……

今天早上我发现我们可以使用这个方法/函数派生任何需要引用的类中的所有对象（类）；

```
Protected Overrides Sub Finalize()
    MyBase.Finalize()
End Sub 
```

# inversion-of-control - Smalltalk 和 IoC

> ID：243905
> 
> 赞同：9
> 
> 时间：2008-10-28T16:14:38.157
> 
> 标签：inversion-of-control, smalltalk

我看到很多 .Net 和 Java 的 IoC 框架。有谁知道为什么 Smalltalk 没有等效的框架。这更像是一个哲学问题。我想知道 Smalltalk 的做事方式是否有某些东西排除了拥有 IoC 框架的必要性。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T16:45:25.600

[MVC](http://en.wikipedia.org/wiki/Model_view_controller)是在 Smalltalk 上发明的，可以说是最初[的控制反转](http://en.wikipedia.org/wiki/Inversion_of_control)框架。虽然比其 java 同类产品更轻量，但它具有保存数据的模型的基本概念，一个视图呈现数据以响应从控制器传播的事件。

不那么轻率的是，Java 实际上需要大量框架支持才能在没有过多样板代码的情况下创建 Web 应用程序。Smalltalk 支持诸如[continuation](http://en.wikipedia.org/wiki/Continuations)之类的编程习惯用法，这允许作者假装他们不是真的在编写事件驱动的代码。 [Seaside](http://en.wikipedia.org/wiki/Seaside_(software))就是这样工作的，通过更灵活的开发范式赋予 IoC 的好处。

编辑：MVC 是 Smalltalk 中 UI 的框架（可以说它并不是真正的框架，但类库已经内置了对它的支持）。它具有控制属性的反转，因为视图和模型响应控制器调度的事件 - 不要调用我们，我们会调用你的属性。控制反转是框架内的一种设计模式，用于减少 Java 应用程序中对大量样板的需求。在应用程序框架的某些定义中，控制反转是被视为区分框架与库的主要属性。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-28T20:17:28.243

函数是 smalltalk 中的一等公民，因此很容易在没有框架的情况下拥有 IoC。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-07T11:06:49.157

我认为 IOC 或依赖注入模式解决了 Smalltalk 环境中不存在的问题。Smalltalk 是一种无类型的动态语言，使用消息传递进行通信。这使得对象在语言级别上本质上是松散耦合的。任何对象都可以向另一个对象发送消息，而无需考虑类型，只要它可以处理消息即可。因此，正如您可能猜到的那样，在任何给定时间更改依赖项都是相对容易和自然的。只需决定在何处、何时以及如何更改依赖项。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-06T00:22:59.640

这有几个可能的原因。一个是我们没有费心使用“IoC”限定符，这本质上是多余的——因为将某些东西称为框架意味着控制流的反转。

另一个是 Smalltalk 语言以闭包的形式提供对“IoC”流的直接支持。使用闭包进行编程的一个结果是，在框架中发现的控制流似乎并没有那么明显的不同，以至于让人产生一种从“正常”流感“倒转”的感觉。相反，通过闭包，控制流一直在这两种观点之间来回切换，并且无处不在。即使在单个语句中。

第三个原因也许是，即使没有闭包，所描述的“控制反转”也不是与框架唯一相关的——在大多数涉及 I/O 的代码形式中都可以找到相同的流程。

第四，Smalltalkers 可能比其他人更多地使用这类流，因为我们更多地依赖于对象的概念和它们之间发送的消息，而不是结构的概念和成员函数的调用。在没有闭包的情况下，这两种观点是等价的，可以互换的，但是闭包的加入改变了结果——使用中的控制流感是效果之一。

最后，人们甚至可以考虑将 REPL 风格的控制流描述为“更简单”，但“正常”流的“倒置”意义，在几乎在其他任何地方都使用它的意义上是正常的。

总之，Smalltalk 存在相同类型的框架。我们对它们的描述略有不同。差异至少部分是由于 Smalltalk 中闭包的存在和利用，许多其他环境尚未提供 - 特别是 C++、C# 和 Java。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-09-01T02:06:28.450

在Java中，当您编写类似的东西时会创建一个依赖项

MyClass32 temp = this.theThing();

现在你的代码依赖于 MyClass32 类。没有它，您的代码将无法工作。该类中的任何更改都可能使您的代码无法编译，这需要对您的代码进行大量额外更改，这可能需要在依赖于您的类中进行进一步的代码更改。很多额外的工作。

在 Smalltalk 中你会写 temp := self theThing;

无论#getTheThing 返回什么，您的代码都将起作用。您的代码不依赖于 MyClass32 类。您唯一的依赖是“临时”必须理解您发送给它的任何消息。

所以从某种意义上说，依赖注入框架的目的是让像 Java 这样的静态类型语言更像是动态类型语言。

也就是说，我在 Smalltalk 中经常遵循一种设计模式：创建一个类方法，如返回 SOME 类的 MyClass。它不需要有 NAME 'MyCLass'。它可能是几个班级之一，晚上返回不同的班级。这种模式出现在 Smalltalk MVC 中，其中视图类具有方法 #defaultControllerClass，该方法通常由子类重新定义。

# java - 使用 XSL 转换器的 GZip HttpResponse

> ID：243912
> 
> 赞同：-1
> 
> 时间：2008-10-28T16:15:55.173
> 
> 标签：java, xslt, gzip, servlets, transformer

我的 Servlet 中有以下代码，但是当 IE 访问该页面时，它返回一个空白的 html 页面。如果我直接在 StreamResult 构造函数中使用 response.getOutputStream()，页面加载正常。我错过了什么？

**response**是 HttpServletResponse 的一个实例，而**xsl**是 XSLTC TransformerFactory 的 Transformer 的一个实例

```
response.setHeader("Content-Encoding", "gzip");
GZIPOutputStream gzipOut = new GZIPOutputStream(response.getOutputStream());
Result outputResult = new StreamResult(gzipOut);

xsl.transform(xmlSource, outputResult); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T18:15:23.093

我猜你没有关闭 gzipOut 流，因此它没有发送“页脚”信息。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-10-28T21:55:24.757

Turns out there is a .finish() on this stream that is required. It is similar to flush, but since it is a different call, the Transformer does not know to use it.

# c# - 列表视图 C# 保持选中状态

> ID：243914
> 
> 赞同：12
> 
> 时间：2008-10-28T16:16:07.233
> 
> 标签：c#, listview, controls

我有一个列表视图，双击后，一条记录会打开一个新表单以显示详细信息，但列表视图中的记录丢失了“选择”......我怎么知道点击了哪条记录？？？

谢谢

玛丽亚若昂

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-10-28T16:21:12.137

listview 控件具有默认为 True 的*HideSelection*属性。将此设置为 False，即使控件失去焦点，当前行也将保持突出显示。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-28T16:19:07.010

尝试将列表视图上的 HideSelection 属性设置为 false。它默认启用。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-04-19T21:53:02.283

请注意，失去焦点时选择将变为“灰色”，聚焦时将变为“蓝色”。失去焦点时保持蓝色更加困难......您必须覆盖 ListView::DrawItem

# asp.net - 如何使用 SVN 推出 ASP.NET 网站？

> ID：243918
> 
> 赞同：2
> 
> 时间：2008-10-28T16:17:09.213
> 
> 标签：asp.net, svn, deployment, rollout

我们使用 ASP.NET / C#。

我们在本地工作，在本地测试，通过 SVN 签入我们的代码和二进制文件。

在我们的服务器上，我们将来自 SVN 的最新“构建”直接签入到我们的 IIS Web 目录中。

这是一个好的做法，还是我们应该为推出做其他事情？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T16:39:24.580

为什么要检查它？您可以轻松地创建一个脚本来将它（干净，没有 .svn 目录，没有混乱）导出到 IIS 目录。

SVN 支持导出功能，[SVN 导出](http://svnbook.red-bean.com/en/1.5/svn-book.html#svn.ref.svn.c.export)

编辑：刚刚注意到这已经在 SO: [Link](https://stackoverflow.com/questions/175056/svn-checkout-or-export-for-production-environment)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T16:33:49.443

我认为这种做法没有问题。我想它可以使您的部署变得简单，并且您可以在任何给定时间检查当前正在使用的修订版本。

也许其他人会提出相关问题，但我真的看不出不这样做的任何主要原因。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T16:34:10.503

我做了同样的事情，但有一个例外......我首先在同一台服务器上将最新版本签出到该站点的开发版本，以确保服务器端没有任何奇怪的问题。这种情况很少见，但以前就发生过。

不确定是否有更好的方法，但到目前为止它对我来说效果很好。

# java - 在 Java 中清理错误的 XML

> ID：243919
> 
> 赞同：7
> 
> 时间：2008-10-28T16:17:17.933
> 
> 标签：java, xml

我正在使用返回无效的“XML”的第三方库，因为它包含无效字符以及未声明的实体。我需要使用 Java XML 解析器来解析这个 XML，但它令人窒息。

有没有一种通用的方法来清理这个 XML 使其变得有效？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T16:41:32.830

我认为您的选择类似于：

*   [标签汤](http://home.ccil.org/~cowan/XML/tagsoup/)
*   [JTidy](http://jtidy.sourceforge.net/)
*   自己滚。

前两个是重量级的，因为它们旨在解析格式不正确的 HTML。如果您知道问题是由于编码和实体造成的，但在其他方面格式良好，我建议您自己动手：

*   将编码标准化为 UTF-8
*   对 > 和 < 字符（文本实体）之间的文本使用标准编码器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-28T16:42:59.707

听起来您需要弄清楚是否有一种方法可以在移交给解析器之前自己自动清理数据。某些字符如何无效、在声明的字符集中无效或未转义的 XML 元字符（例如“<”）？

对于未声明的实体，我曾经通过使用错误处理程序配置 SAX 解析器来解决这个问题，该错误处理程序基本上忽略了这些错误。这也可能对你有帮助。请参阅[错误处理程序](http://java.sun.com/javase/6/docs/api/org/xml/sax/ErrorHandler.html)API。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T16:40:12.257

试试[http://jtidy.sourceforge.net/](http://jtidy.sourceforge.net/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-26T06:35:10.690

对于非法字符，我建议实现过滤阅读器；只需用空格转换它们（假设这些是控制字符），或者去掉。

未声明的实体比较棘手；一些 xml 解析器允许您定义要使用的替代 DTD（[Woodstox](http://woodstox.codehaus.org)至少这样做。如果是这样，您可以注入确实声明您需要的实体的 DTD。

# iphone - 在 Cocoa touch 中存储静态引用数组/字典的最佳方式

> ID：243929
> 
> 赞同：0
> 
> 时间：2008-10-28T16:19:07.587
> 
> 标签：iphone, objective-c, cocoa-touch

我有几个数组数组或字典数组，我想将它们存储在我的 iPhone 应用程序中。此列表是静态的，不会被应用程序或用户修改。有时可能会显示它们，但更有可能的是它们会被迭代并与某些输入值进行比较。存储这些数组的最佳方式是 CoreData/SQLite 数据存储、头文件还是我没有想到的东西？我可以看到创建一个仅将这些数组存储在其中以供访问的类，但我不确定这是否是最佳途径。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-28T16:53:11.310

使用属性列表文件。使用 NSDictionary +dictionaryWithContentsofFile: 加载它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-28T21:43:35.013

我会做以下事情：

```
@implementation DataSource
+ (NSArray *)someData
{
  static NSArray *data = nil;
  if (!data) {
    data = [[NSArray arrayWithObjects:..., nil] retain];
  }
  return data;
}
@end 
```

额外的数组或字典数组将作为类方法添加到该类上。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-31T17:40:20.507

我会选择 plist 方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-28T18:49:17.783

根据您想要修改或本地化项目的频率以及您的查找时间要求，静态数组也可能是要走的路。然而，对于常量数据，SQLite 可能不是采用的方法，除非您有复杂的查询要求（而不仅仅是按索引）。

# language-agnostic - 计算二维向量的叉积

> ID：243945
> 
> 赞同：104
> 
> 时间：2008-10-28T16:22:27.923
> 
> 标签：language-agnostic, math, vector, 2d

来自维基百科：

> 叉积是在**三维**欧几里得空间中对两个向量进行二元运算，产生另一个向量，该向量垂直于包含两个输入向量的平面。

鉴于定义仅在三个（[或七个、一和零](https://en.wikipedia.org/wiki/Seven-dimensional_cross_product#Consequences_of_the_defining_properties)）维度中定义，如何计算两个二维向量的叉积？

我见过两种实现。一个返回一个新向量（但只接受一个向量），另一个返回一个标量（但是是两个向量之间的计算）。

实现 1（返回一个标量）：

```
float CrossProduct(const Vector2D & v1, const Vector2D & v2) const
{
    return (v1.X*v2.Y) - (v1.Y*v2.X);
} 
```

实现 2（返回一个向量）：

```
Vector2D CrossProduct(const Vector2D & v) const
{
    return Vector2D(v.Y, -v.X);
} 
```

为什么不同的实现？我将使用标量实现做什么？我将向量实现用于什么？

我问的原因是因为我自己正在编写一个 Vector2D 类并且不知道使用哪种方法。

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2008-10-28T16:39:04.160

实现 1 返回将由输入向量的常规 3D 叉积产生的向量的大小，将其 Z 值隐式设为 0（即将 2D 空间视为 3D 空间中的平面）。3D 叉积将垂直于该平面，因此具有 0 个 X 和 Y 分量（因此返回的标量是 3D 叉积向量的 Z 值）。

请注意，由 3D 叉积产生的向量的大小也等于两个向量之间的平行四边形的*面积，这为实现 1 提供了另一个目的。*另外，这个区域是有符号的，可以用来判断从V1旋转到V2是逆时针方向还是顺时针方向。还应注意，实现 1 是由这两个向量构建的 2x2 矩阵的行列式。

实现 2 返回一个垂直于输入向量的向量，该向量仍然在同一个 2D 平面中。不是经典意义上的叉积，而是“给我一个垂直向量”意义上的一致。

请注意，3D 欧几里得空间在叉积运算下是封闭的——也就是说，两个 3D 向量的叉积返回另一个 3D 向量。上述两种 2D 实现方式都与此不一致。

希望这可以帮助...

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2008-10-28T16:40:55.560

**简而言之：**这是数学黑客的简写符号。

**长解释：**

您不能在 2D 空间中对向量进行叉积。那里没有定义操作。

然而，假设 2D 向量通过将其 z 坐标设置为零来扩展为 3D，则评估两个向量的叉积通常很有趣。这与在 xy 平面上使用 3D 矢量相同。

如果您以这种方式扩展向量并计算这种扩展向量对的叉积，您会注意到只有 z 分量具有有意义的值：x 和 y 将始终为零。

这就是为什么结果的 z 分量通常简单地作为标量返回的原因。例如，此标量可用于查找 2D 空间中三个点的绕组。

从纯数学的角度来看，2D 空间中的叉积不存在，标量版本是 hack，返回 2D 向量的 2D 叉积根本没有意义。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-28T16:58:27.290

叉积的另一个有用特性是它的大小与两个向量之间角度的正弦有关：

> | 斧头 | = |一个| . |b| . 正弦（θ）

或者

> 正弦(θ) = | 斧头 | / (|a| . |b|)

因此，在上面的实现 1 中，如果预先知道`a`和`b`是单位向量，那么该函数的结果正是该 sine() 值。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2015-03-15T12:13:45.707

实现 1 是两个向量的**perp 点积**。我所知道的关于 2D 图形的最佳参考是出色的[Graphics Gems](http://www.graphicsgems.org)系列。如果您正在从事 2D 临时工作，那么拥有这些书籍**非常重要。**第 IV 卷有一篇名为“Perp Dot 产品的乐趣”的文章，其中介绍了它的很多用途。

**perp 点积**的一个主要用途是获得`sin`两个向量之间角度的缩放，就像**点积**返回`cos`角度的缩放一样。当然，您可以同时使用**点积**和**perp 点积**来确定两个向量之间的角度。

[这](http://johnblackburne.blogspot.co.il/2012/02/perp-dot-product.html)是关于它的帖子，这[是](http://mathworld.wolfram.com/PerpDotProduct.html)Wolfram Math World 文章。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2018-06-05T15:33:46.843

一个有用的 2D 矢量运算是返回标量的叉积。我用它来查看多边形中的两个连续边是向左还是向右弯曲。

来自[Chipmunk2D](https://chipmunk-physics.net/)来源：

```
/// 2D vector cross product analog.
/// The cross product of 2D vectors results in a 3D vector with only a z component.
/// This function returns the magnitude of the z value.
static inline cpFloat cpvcross(const cpVect v1, const cpVect v2)
{
        return v1.x*v2.y - v1.y*v2.x;
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-09T11:09:25.067

我在计算中使用 2d 叉积来找到对象的新正确旋转，该对象在相对于其质心的任意点处受到力矢量的作用。（标量 Z 一。）

# objective-c - 使用 NSLayoutManager 停止文本换行

> ID：243947
> 
> 赞同：0
> 
> 时间：2008-10-28T16:22:47.423
> 
> 标签：objective-c, cocoa, text, nslayoutmanager

给定任意的单行字符串，我的目标是将其渲染为位图表示。但是，我无法事先找出它的尺寸，所以我只能获取字形范围的边界矩形并在画布不够大时调整画布的大小。不幸的是，如果画布对于字符串不够宽，但足够高以使文本可以换行，布局管理器会认为这是最好的。如何阻止布局管理器包装文本？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T19:41:17.443

您应该能够首先使用`-[NSString sizeWithAttributes:]`给定的一组绘图属性获取字符串的边界框，然后相应地调整视图大小并实际绘制字符串。

# silverlight - 在silverlight中设置背景图像

> ID：243956
> 
> 赞同：2
> 
> 时间：2008-10-28T16:24:47.607
> 
> 标签：silverlight

我目前有一个 Silverlight 应用程序，它通过几个实时数据图表进行旋转。但是，每个页面都有两个用户控件：一个用于顶部的信息框，另一个用于显示图表。我试图向显示它们的母版页添加背景图像，以便图像位于所有内容的后面，但是一旦加载，它们就会用空白画布覆盖图像。

到目前为止，使用户控件的背景透明的尝试都没有效果。

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T00:29:22.760

您需要将背景设置为在宿主控件本身上是透明的，而不仅仅是在加载的 xaml 文件中。如果您使用对象标签，您将执行以下操作：

```
<object data="data:application/x-silverlight-2," type="application/x-silverlight-2" width="100%" height="100%">
    <param name="source" value="[your xap file]"/>
    <param name="background" value="transparent" />
         ....
</object> 
```

因为实际的 silverlight 宿主控件具有背景颜色，如果您不将其设置为透明，它将默认为白色，无论您的画布是否透明，它都会覆盖您的背景。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-29T09:40:46.017

它现在运行良好。它需要

```
<param name="windowless" value="true" /> 
```

以及将背景设置为透明。

感谢您的帮助，非常感谢。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T16:38:40.933

用户控件内部肯定有一些白色背景的东西，您可能会使用 Blend 或使用[Silverlight Spy](http://firstfloorsoftware.com/silverlightspy/)找到它。Spy 是一款出色的应用程序，可让您查看正在运行的应用程序的可视化树等。

# security - 登录页面的最佳实践？

> ID：243957
> 
> 赞同：20
> 
> 时间：2008-10-28T16:24:50.133
> 
> 标签：security, login, usability, shibboleth

我正在使用[Shibboleth](http://en.wikipedia.org/wiki/Shibboleth_(Internet2))开发一个单点登录登录页面，该页面将用于各种 Web 应用程序。显然，我们希望使该页面尽可能安全和可用，同时限制网络钓鱼诈骗的影响。

**设计登录页面时要记住哪些最佳实践？**

围绕这个问题提出的一些问题：

*   登录页面在每个显示器上始终看起来都一样重要吗？
*   反之，登录页面采用随机设计是否有益？
*   登录页面与所有其他页面看起来一样更好，还是应该有自己独特的设计？
*   如果登录页面有自己独特的设计，它是否应该包含您网站设计中的其他常量元素（例如全局导航）？
*   登录页面是否适合为用户提供附加内容（例如最新消息）？
*   是否应该包括任何额外的安全功能来帮助确保人们的安全？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-28T18:07:19.943

可用性说明：

我个人**讨厌**网站在密码字段和登录按钮之间放置“忘记密码”或“忘记用户名”或“帮助”链接。作为键盘用户，我不应该在它们上按 Tab 键来访问提交按钮。

更好的是，还捕获密码字段上的 Enter 按键，以便我可以使用 Enter 键自动提交。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-28T16:41:47.277

在您的登录页面中保持相同的设计将让您的用户知道他们正在尝试登录您的页面，如果设计更改随机用户可能认为该网站已被移动，或者他们是钓鱼的受害者。所以我建议保持与您的内容页面相同的准则

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-28T17:13:45.137

无论您设计什么，网络钓鱼者都可以模仿它。完全防止网络钓鱼是一个难题。*在用户登录之前*，您基本上必须有一些方法来识别您的用户。一些银行现在就这样做了。您输入您的姓名，然后他们会向您显示您自己选择的图像，然后，一旦您确定它是相同的图像，您就输入您的密码。这可能比您的站点所需的复杂程度更高。

在技​​术方面，美国银行通过使用称为 PassMark 的 Flash 本地共享对象来实现这一点。您的浏览器会默默地将此数据发送回银行。如果您删除 LSO，您将不会看到您的图像，因为 BofA 无法识别您的身份。即使这样仍然容易受到中间人攻击。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-28T16:46:12.010

在我访问的许多应用程序中，我仍然会看到另一件“不合时宜”的事情，如果指定的凭据无效，请不要指出哪个是无效的。只需说“无效的用户/密码组合”而不是“无效的密码”之类的话，这将阻止这些人通过社会工程了解访问您网站的用户群。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-15T20:33:37.427

Smashing Magazine 对登录表单进行了相当完整的综述。 [Web 表单设计模式：注册表单](http://www.smashingmagazine.com/2008/07/04/web-form-design-patterns-sign-up-forms/ "关联")

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-28T16:49:11.877

[包括应用级DOS预防](http://msmvps.com/blogs/omar/archive/2007/03/24/prevent-denial-of-service-dos-attacks-in-your-web-application.aspx)

登录失败不具体。通用的“登录失败”而不是“未知用户名”。

使用验证码或其他图灵测试。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-28T17:56:25.707

看起来很简单，但如果应用程序需要，请使用 HTTPS。哎呀，即使它不保证，因为人们倾向于重复使用相同的密码。这些天你可以便宜地获得 SSL 证书。如果他们从您的网站上提取密码，他们可以在其他地方尝试。甚至许多银行都没有安全线路上的登录页面。它发布到一个 HTTPS 页面，但仍然没有保护中间人类型的攻击。

我同意 Omniwombat。网络钓鱼是一个很难很好解决的问题，而且似乎不可能完全解决。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-01-12T09:34:38.553

像用户和保安一样思考：如果你让他们每次登录都做验证码，他们会对此感到厌烦。

如果您试图阻止拒绝服务，那么可能只有在特定时间段内有足够的（失败？）登录尝试后才会出现验证码。

考虑使用 NTLM、OpenID 或 Shibboleth 使大多数用户的登录尽可能自动化。

不要让人们去一个单独的页面注册。大概您将拥有用户名和密码字段，以及一个登录/提交按钮。只需添加一个“注册为新用户”按钮，以便新用户可以使用现有的用户名/密码字段。如果您需要为新用户收集更多详细信息，请弹出一个表单（使用 DHTML，而不是弹出窗口）来收集它们。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-28T16:48:37.310

在某些情况下有用的提示：您可以通过将 autocomplete="off" 添加到密码字段来禁用客户端密码保存。

这不适用于所有浏览器（如果我记得，IE 6+ 和 Firefox 3+）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-28T18:16:24.307

到目前为止，我所见过的阻止网络钓鱼的最好方法是银行的登录界面。登录分 3 部分完成，首先用户输入他们的帐号（借记卡号、信用卡号...），第二步将随机列出用户指定的 3 个问题中的 1 个（例如：你上的是哪所高中对于 10 年级），最后一部分，如果前两个成功，则显示用户在注册时指定的图像和一些文本，密码字段如下。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-28T16:51:09.940

意识到您的用户通常会在该页面上花费 10 秒，只要您的用户 ID 和密码的放置位置很明显，它看起来如何并不重要。除此之外，如果我忘记密码，请不要成为那些提供通过电子邮件向我发送密码的网站之一。至少让我相信它隐藏在一个很好的盐渍哈希中，你永远无法检索它。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-10T15:10:41.037

@Joe Lencioni，以及其他对 Shibboleth 感兴趣的人

您的网站页面应该在每个页面上具有整体相同的外观和感觉。

关于 Shibboleth 和 SSO。请务必注意您的组织与哪个角色相关联。您是身份提供者 - IdP（对用户进行身份验证，然后将响应发送给 SP），还是服务提供者 - SP（将根据 IdP 发送的响应和属性授予身份验证。

如果您是 SP，您可以灵活地将用户链接到 IdP 以供他们登录。许多 SP 创建自己的 WAYF（您来自哪里）页面，该页面会将用户重定向到 IdP 的登录页面。

如果您是 IdP，您应该有一个用户看起来熟悉的登录页面，以便他们可以登录，然后使用 SP 授予正确访问所需的属性重定向到 SP。

就网络钓鱼诈骗而言，保持 Shibboleth 元数据最新非常重要。我相信许多联合会建议每 (1) 小时下载一次元数据。

许多 Shibboleth 问题可以在这里回答：[https ://spaces.internet2.edu/display/SHIB2/Home](https://spaces.internet2.edu/display/SHIB2/Home)

希望这可以帮助你。

# asp.net - 如何让 ASP.NET AJAX 使用 GZip 压缩发送其 JSON 响应？

> ID：243959
> 
> 赞同：7
> 
> 时间：2008-10-28T16:26:26.963
> 
> 标签：asp.net, ajax, json, gzip

我在 IIS7 中启用了压缩，它在所有响应上都按预期工作，除了那些由 ASP.NET AJAX 构建的响应。我有一个向客户端提供数据的 Web 服务。直接调用 Web 服务时，它被正确压缩。但是，当它通过 ASP.NET AJAX 调用时，JSON 响应不会被压缩。

如何让 ASP.NET AJAX 使用 GZip 压缩发送其 JSON 响应？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-29T14:38:22.547

这应该开箱即用。要验证我的 ASP.NET AJAX JSON 响应是否使用 GZip 压缩：

1.  下载 Fiddler（2.1.9 版本是最新的）

2.  在 IE 7 中启用 Fiddler：工具 -> Fiddler2

3.  由于所有流量都通过代理路由，因此您需要设置 Fiddler 以在 HTTP 标头中应用 accept-encoding:Gzip。规则 -> 应用 GZip 编码

4.  通过提琴手访问您的网站。如果您的站点位于本地主机上，则 IE7 不会通过 fiddler 进行路由。Fiddler 2.1.8 有一个简洁的功能，将 localhost (127,0.0.1) 映射到[http://ipv4.fiddler](http://ipv4.fiddler)和[http://ipv6.fiddler](http://ipv6.fiddler)

5.  在 Fiddler 会话中找到 asmx 请求。

要验证请求是使用 gzip 编码发出的，请查看顶部面板中的 Request-Headers。您应该看到**“客户端：accept-encoding:gzip,deflate”**

要验证响应是否使用 gzip 编码发送，请查看底部面板中的 Response-Headers。您应该看到**“传输：内容编码：gzip”**

我在 Vista Business SP1 上安装了 IIS 7，没有其他配置，我的项目使用 ASP.NET AJAX 和标准 Web 服务。

希望有帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T00:39:55.687

还要确保 JSON 请求在 HTTP 标头中有例如 accept-encoding:gzip。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-29T00:27:40.643

您需要检查 .asmx 文件扩展名是否在要压缩的文件类型列表中，这就是 ajax json 的来源。

# python - 我应该为 PyDev 下载哪个 Eclipse 包？

> ID：243962
> 
> 赞同：62
> 
> 时间：2008-10-28T16:33:20.710
> 
> 标签：python, eclipse, package, pydev

我应该选择哪个 Eclipse 包来使用[PyDev](http://www.pydev.org/)进行 Python 开发？

Eclipse 主页上没有告诉我选择什么，而且 PyDev 文档假定我已经安装了 Eclipse。我选择哪个 Eclipse 包有关系吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-28T16:39:43.397

如果你只是打算做 Python 开发，我会选择[Platform Runtime Binary](http://download.eclipse.org/eclipse/downloads/)。

之后，我会按照说明[http://pydev.org/download.html](http://pydev.org/download.html)和[http://pydev.org/manual_101_root.html](http://pydev.org/manual_101_root.html)安装 PyDev。

我对 Python 开发使用相同的设置。我还有用于 Ruby on Rails 开发的 RadRails 插件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-28T21:52:00.223

PyDev 已被[Aptana](http://www.aptana.com)收购，因此您可能也想检查一下。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-12-27T17:25:14.097

假设使用 Python，仅此而已 - 我将获得 Eclipse 的“运行时二进制”版本，并添加[PyDev](http://pydev.org/)扩展。这样 Eclipse 启动速度快如闪电，消耗的内存更少，通常也更少妨碍您。最重要的是，您始终可以添加您发现需要的任何扩展/插件。运行时通常在 50MB 左右，而不是 SDK 或其他版本通常的 100+。

您总是可以在这里找到最新版本：

[http://download.eclipse.org/eclipse/downloads/](http://download.eclipse.org/eclipse/downloads/)

在此发布时，这将是 3.6.1：

[http://download.eclipse.org/eclipse/downloads/drops/R-3.6.1-201009090800/index.php#PlatformRuntime](http://download.eclipse.org/eclipse/downloads/drops/R-3.6.1-201009090800/index.php#PlatformRuntime)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T17:04:32.957

如果你刚开始，我会推荐你[​​ python easyeclipse](http://www.easyeclipse.org/site/distributions/python.html)。

Pydev 与其他扩展一起使用时可能会出现一些不兼容问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-08-01T01:31:35.007

一个有用的快捷方式是下载[EasyEclipse for PyDev](http://www.easyeclipse.org/site/plugins/pydev.html)。这是已经为 pydev 预配置的 Eclipse 版本，并且似乎比自己收集所有 Eclipse 部分更容易安装。不幸的是，它使用了一个相当旧的 PyDev 版本，但这很容易通过转到`Help > Software Updates >`并让 Eclipse 获取最新版本来解决（在执行此操作之前，您需要将 PyDev 位置更改为 SourceForge）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-04-29T18:39:53.460

我更喜欢你应该使用**Luna**，它是 Java 开发人员创建 Java EE 和 Web 应用程序的工具，当然你可以将 PyDev 添加到它。

当你开始使用 python、eclipse 和 pydev 时，你可能需要一步一步的过程。

遵循这些简单的步骤或观看此[视频](https://www.youtube.com/watch?v=fAa80SpQJHo)。

**第 1 步：**下载并安装 Eclipse(Luna)

**第 2 步：**打开 Eclipse >> 帮助 >> 安装新软件...

**第 3 步：**在“使用”文本字段中输入： http: [//pydev.org/updates](http://pydev.org/updates)

**第 4 步：**选择复选框 PyDev >> 下一个 >> 下一个 >> 完成

**第 5 步：**它会安装，但稍后会打开一个新框架，确保选中“Brainwy Software,PyDev,Brainwy >> OK

单击确定后，Eclipse 将重新启动。

**第6步：**点击文件>>新建>>项目>> PyDev项目>>

现在您必须添加解释器。

**第 7 步：**单击“请在继续之前配置解释器”

**第八步：**点击“手动配置”

**第 9 步：**单击“新建”，然后给解释器名称（python 2.xx 或 python 3.xx 您正在使用的版本）或您喜欢的任何其他名称。

**第 10 步：**单击“浏览”以提供路径。

如果您使用的是 Windows，它可能位于 C: 驱动器中，

如果您使用的是 Ubuntu，它将位于“/usr/bin/python2.x”或在终端中使用命令“whereis python”。

**第 11 步：**在此之后选择解释器 >> 完成。

你很高兴。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-01-06T23:24:30.697

我推荐[http://www.liclipse.com/](http://www.liclipse.com/)如果你想要一个简单直接的设置（特别是对于 web 开发，因为它也有 web 相关内容的编辑器，比如 html、css、javascript）或者只获取平台运行时二进制文件（它是发布的最轻量的 Eclipse，包含 Pydev 所需的东西，大约 47 MB​​——它可以在：http: [//download.eclipse.org/eclipse/downloads/ 获得](http://download.eclipse.org/eclipse/downloads/)，选择你想要的版本，然后寻找平台运行时二进制文件）。

安装说明位于： http: [//pydev.org/manual_101_install.html](http://pydev.org/manual_101_install.html)（然后是入门手册）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-11T09:09:21.313

pydev 和 Python2.6 不适用于 C++ 的 eclipse。下载经典版本，你应该很好。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-02T23:02:36.987

我认为 Eclipse 的 Aptana 发行版是目前获取 PyDev 的最简单方法……尤其是因为它现在对完整版是免费的。如果您从这里下载 Studio：http: [//www.aptana.org/](http://www.aptana.org/) 一旦 PyDev 启动并运行，您就可以从他们的插件管理器轻松安装它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-11-27T08:04:07.510

通常没有人提及，但Eclipse在其 DLTK（动态语言工具包）插件集中[确实支持 Python 。](http://specialmeaning.blogspot.com/2016/04/setting-up-eclipse-native-python.html)您当然可能想尝试一下。

无论如何，它的功能不如[PyDev](http://www.pydev.org)插件，因此您可以安全地使用它。PyDev 要求接受其容易受到 MIM 攻击的证书。

您可能需要考虑[PyCharm IDE](https://www.jetbrains.com/pycharm/)，因为它还包含 PyDev[工作](http://www.pydev.org/history_pydev.html)。PyCharm 团队拥有自己的 PyDev 分支，并在其调试器上做了一些工作。关于这次合作的一些[细节。](https://blog.jetbrains.com/pycharm/2016/05/debugger-interview-with-pydev-and-pycharm/)

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-10-28T17:07:04.213

我使用 J2EE Eclipse 进行 Python 和 Java 开发。它运作良好。但是 Classic Eclipse 应该足够了。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2015-08-30T09:10:57.700

我会得到 [JetBrains PyCharm Community Edition 4.5.3]。它是免费的、功能齐全的，最重要的是，它专门用于 Python 开发。

还有 3 个其他 IDE 也很棒，每个都支持 30 多种语言，不需要插件，通过添加插件可以增加 18 种语言。查看 --> 括号、Atom 和 Visual Studio 代码。他们都是免费的。我建议先检查 PyCharm。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2016-06-13T14:35:25.510

Easy Eclipse for python 是一款不错的轻量级工具。但是，您不会从中获得任何额外的功能。

我尝试从 Django 学习开始，但是这个版本还不够。如果你只选择简单的 python 代码，它是一个非常好的工具。

# sql-server - 如何在 SQL Server 中使用 sp_send_dbmail 指定回复地址

> ID：243966
> 
> 赞同：4
> 
> 时间：2008-10-28T16:34:25.217
> 
> 标签：sql-server, sp-send-dbmail

我需要向某人发送电子邮件，并希望他们能够简单地回复电子邮件，而无需指定电子邮件地址。

使用 sp_send_dbmail 将回复地址设置为发送它的配置文件的名称。

可以更改此内容以指定回复，因此看起来它来自我。

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2014-10-01T13:41:24.013

更新：显然在 SQL Server 2008 中添加了“@reply_to”参数。

SQL Server 2005 没有“回复”参数：http `sp_send_dbmail`:
[//msdn.microsoft.com/en-us/library/ms190307%28v=sql.90%29.aspx](http://msdn.microsoft.com/en-us/library/ms190307%28v=sql.90%29.aspx)

但 SQL Server 2008（2008 R2、2012 等）确实有一个“回复”参数（@reply_to = 'yourReplyToEmailAddress'），位于：http `sp_send_dbmail`:
[//msdn.microsoft.com/en-us/library/ms190307% 28v=sql.100%29.aspx](http://msdn.microsoft.com/en-us/library/ms190307%28v=sql.100%29.aspx)

> [ @reply_to= ] 'reply_to'
>       是电子邮件消息的“回复地址”的值。它只接受一个电子邮件地址作为有效值。这是一个可选参数，用于覆盖邮件配置文件中的设置。此参数的类型为 varchar(MAX)。SMTP 安全设置确定是否接受这些覆盖。如果未指定参数，则默认为 NULL。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-28T19:51:21.060

不在 sp 中发送 dbmail 本身

回复地址只是文本，可以在个人资料中设置。

例如，我配置 bob@bob.com 但电子邮件帐户是 private@isp.com

点击回复，它会转到 bob@bob.com

因此，配置 sp 使用的配置文件以显示这一点。

[显示“外发电子邮件消息中显示的电子邮件地址”的行。这里](http://msdn.microsoft.com/en-us/library/ms190658.aspx)

[sp 发送 dbmail 帮助。回复地址无参数](http://msdn.microsoft.com/en-us/library/ms190307.aspx)

# c++ - 你认为这种技术“不好”吗？

> ID：243967
> 
> 赞同：22
> 
> 时间：2008-10-28T16:34:31.597
> 
> 标签：c++, coding-style

有时您需要在某些非严重错误条件下跳过部分方法的执行。您可以为此使用*异常*，但通常不建议在正常的应用程序逻辑中使用异常，仅用于异常情况。

所以我做了一个这样的把戏：

```
do
{
   bool isGood = true;

   .... some code

   if(!isGood)
       break;

   .... some more code

   if(!isGood)
       break;

   .... some more code

 } while(false);

 ..... some other code, which has to be executed. 
```

我使用将运行一次的“假”循环，我可以通过*break*或*continue*中止它。

我的一些同事不喜欢这样，他们称之为“坏习惯”。我个人觉得这种方法很巧妙。但是你怎么看？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-10-28T17:27:54.047

不好的做法，这取决于。

我在这段代码中看到的是一种非常有创意的方式，可以用较少硫磺味的关键字编写“goto”。

此代码有多种替代方案，根据情况可能会更好，也可能不会更好。

## 您的 do/while 解决方案

如果您有很多代码，您的解决方案很有趣，但会在某些有限的点评估此处理的“退出”：

```
do
{
   bool isError = false ;

   /* some code, perhaps setting isError to true */
   if(isError) break ;
   /* some code, perhaps setting isError to true */
   if(isError) break ;
   /* some code, perhaps setting isError to true */
}
while(false) ;

// some other code 
```

问题是你不能轻易使用你的“if(isError) break;” 是一个循环，因为它只会退出内部循环，而不是你的 do/while 块。

当然，如果故障发生在另一个函数内部，该函数必须返回某种错误代码，并且您的代码不能忘记正确解释错误代码。

我不会讨论使用 ifs 甚至嵌套 ifs 的替代方案，因为经过一番思考，我发现它们对于您的问题的解决方案不如您自己的解决方案。

## 将 goto 称为... goto

也许您应该清楚地说明您正在使用 goto，并记录您选择此解决方案而不是其他解决方案的原因。

至少，它会显示代码可能有问题，并提示审阅者验证或使您的解决方案无效。

你仍然必须打开一个块，而不是破坏，使用 goto。

```
{
   // etc.
   if(/*some failure condition*/) goto MY_EXIT ;
   // etc.

   while(/* etc.*/)
   {
      // etc.
      for(/* etc.*/)
      {
         // etc.
         if(/*some failure condition*/) goto MY_EXIT ;
         // etc.
      }
      // etc.
      if(/*some failure condition*/) goto MY_EXIT ;
      // etc.
   }

   // etc.
}

MY_EXIT:

// some other code 
```

这样，当您通过 goto 退出块时，您无法使用 goto 绕过某些对象构造函数（这是 C++ 禁止的）。

这个问题解决了进程退出嵌套循环的问题（使用 goto 退出嵌套循环是 B. Stroustrup 给出的一个有效使用 goto 的例子），但它不能解决某些函数调用可能失败并被忽略的事实（因为有人未能正确测试他们的返回码，如果有的话）。

当然，现在，您可以从多个点、多个循环嵌套深度退出您的进程，所以如果出现问题...

## 试着抓

如果代码不应该失败（因此，失败是例外的），或者即使代码结构可能失败，但退出过于复杂，那么以下方法可能更清晰：

```
try
{
   // All your code
   // You can throw the moment something fails
   // Note that you can call functions, use reccursion,
   // have multiple loops, etc. it won't change
   // anything: If you want to exit the process,
   // then throw a MyExitProcessException exception.

   if(/* etc. */)
   {
      // etc.
      while(/* etc.*/)
      {
         // etc.
         for(/* etc.*/)
         {
            // etc.
            if(/*some failure condition*/) throw MyExitProcessException() ;
            // etc.
         }
         // etc.

         callSomeFunction() ;
         // the function will throw if the condition is met
         // so no need to test a return code

         // etc.
      }
      // etc.
   }

   // etc.
}
catch(const MyExitProcessException & e)
{
   // To avoid catching other exceptions, you should
   // define a "MyExitProcessException" exception
}

// some other code 
```

如果上面代码中的某些条件，或者上面代码调用的某些函数内部不满足，则抛出异常。

这比您的 do/while 解决方案要重一些，但具有相同的优点，甚至可以从内部循环或内部调用函数中止处理。

## 讨论

您的需求似乎来自这样一个事实，您可以执行一个复杂的过程（代码、函数调用、循环等），但您想在某些情况下中断它（可能是失败，或者因为它比例外情况更早成功） . 如果你可以用不同的方式重写它，你应该这样做。但也许，没有别的办法。

让我们假设。

**如果您可以使用 try/catch 对其进行编码，请执行此操作**：要中断一段复杂的代码，抛出异常是正确的解决方案（您可以在异常对象中添加失败/成功信息这一事实不应被低估）。之后你会有一个更清晰的代码。

现在，如果您遇到速度瓶颈，那么将抛出的异常作为退出来解决问题并不是最快的方法。

没有人可以否认你的解决方案是一个美化的 goto。不会有 goto-spaghetti 代码，因为 do/while 不会让你这样做，但它仍然是语义 goto。这可能是一些人可能会认为此代码“不好”的原因：他们在没有清楚地找到其关键字的情况下闻到 goto。

仅在这种情况下（并且在这种性能，经过分析验证）情况下，您的解决方案似乎还可以，并且比使用 if 的替代方案更好），但质量低于 goto 解决方案（恕我直言），至少不会隐藏自己在一个错误的循环后面。

## 结论

就我而言，我发现您的解决方案很有创意，但我会坚持抛出异常的解决方案。

所以，按照优先顺序：

1.  使用 try/catch
2.  使用转到
3.  使用你的 do/while 循环
4.  使用 ifs/嵌套 ifs

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-10-28T16:39:22.850

您几乎只是将“goto”伪装成假循环。无论您是否喜欢 goto，使用真正的不加掩饰的 goto 都将遥遥领先。

就个人而言，我只是把它写成

```
bool isGood = true;

   .... some code

   if(isGood)
   {
   .... some more code
   }

   if(isGood)
   {
   .... some more code
   } 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-10-28T16:40:09.633

为什么要使用假循环？你可以用一种方法做同样的事情，它可能不会被认为是“坏习惯”，因为它更符合预期。

```
someMethod()
{
   .... some code

   if(!isGood)
       return;

   .... some more code

   if(!isGood)
       return;

   .... some more code

 } 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-10-28T16:39:29.307

您在难以识别的习语中具有复杂的非线性控制流。所以，是的，我认为这种技术很糟糕。

花一些时间尝试弄清楚这是否可以写得更好一点可能是值得的。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-10-28T17:18:21.087

这令人费解且令人困惑，我会立即将其废弃。

考虑这个替代方案：

```
private void DoSomething()
{
   // some code
   if (some condition)
   {
      return;
   }
   // some more code
   if (some other condition)
   {
      return;
   }
   // yet more code
} 
```

还可以考虑将上面的代码分解成多个方法。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-28T16:42:36.773

```
public bool Method1(){ ... }
public bool Method2(){ ... }

public void DoStuff(){
    bool everythingWorked = Method1() && Method2();
    ... stuff you want executed always ...
} 
```

之所以可行，是由于一种称为短路逻辑的东西。如果 Method1 返回 false，则不会调用 Method2。

这还有一个额外的好处，您可以将您的方法分成更小的块，这将更容易进行单元测试。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-28T16:47:44.907

您要做的是非本地故障恢复。这是`goto`为了什么。用它。（实际上，这就是异常处理的用途——但如果你不能使用它，'goto' 或 'setjmp/longjmp' 是下一个最好的东西）。

这个模式、`if(succeeded(..))`模式和“goto cleanup”，所有这三个在语义和结构上都是等价的。使用代码项目中最常见的一种。一致性很有价值。

我会提醒`if(failed(..)) break;`一点，如果你尝试嵌套循环，你会产生一个令人惊讶的结果：

```
do{
   bool isGood = true;
   .... some code
   if(!isGood)
       break;
   .... some more code
   for(....){
      if(!isGood)
          break; // <-- OOPS, this will exit the 'for' loop, which 
                 //  probably isn't what the author intended
      .... some more code
   }
} while(false);
..... some other code, which has to be executed. 
```

也`goto cleanup`没有`if(succeeded(..))`这个惊喜，所以我鼓励使用这两个中的一个。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-10-28T16:48:40.383

基本上你刚刚描述了goto。我一直在 C 中使用 goto。我不认为这很糟糕，除非你用它来模拟一个循环（永远不要那样做！）。我在 C 中 goto 的典型用法是模拟异常（C 没有异常）：

```
// Code

if (bad_thing_happened) goto catch;

// More code

if (bad_thing_happened) goto catch;

// Even more code

finally:

// This code is executed in any case
// whether we have an exception or not,
// just like finally statement in other
// languages

return whatever;

catch:

// Code to handle bad error condition

// Make sure code tagged for finally
// is executed in any case
goto finally; 
```

除了 catch 和 finally 的顺序相反的事实，我看不出为什么这个代码应该是坏的，只是因为它使用了 goto，如果一个真正的 try/catch/finally 代码**完全**像这样工作并且不使用 goto。这是没有意义的。因此我看不出为什么你的代码应该被标记为 BAD。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-28T16:39:00.167

只要代码可读，我对此没有任何问题。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-28T17:21:38.897

我多年来一直使用这个成语。我发现它比类似的嵌套或串行 ifs、“goto onError”或具有多个返回更可取。上面带有嵌套循环的示例需要注意。我总是在“do”上添加注释，以使任何不熟悉该习语的人都清楚。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-28T17:46:33.090

无论好坏，我在几个地方都使用了这个结构。但是，它的开始有明确的记录：

```
 /* This is a one-cycle loop that simplifies error handling */
    do
    {
        ...modestly complex code, including a nested loop...
    } while (0); 
```

这是在 C 中，而不是在 C++ 中 - 所以异常不是一种选择。如果我使用 C++，我会认真考虑使用异常来处理异常。Jeremy 提出的重复测试成语也是有道理的；我用得更频繁了。RAII 也会对我有很大帮助；可悲的是，C 并不容易支持。使用更多功能会有所帮助。通过重复测试来处理嵌套循环内部的中断。

我不会把它归类为伟大的风格。我不会自动将其归类为“坏”。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-11-11T15:02:16.797

重构。在大多数情况下，干净的解决方案是将此代码拆分为一个较小的辅助函数，您可以从中返回，而不是打破您的非实际循环。

然后你可以用你的break代替return，现在人们在阅读它时可以立即理解你的代码，而不必停下来想知道为什么你做了这个实际上没有循环的循环。

是的，我想说这仅仅是因为它的行为不像读者所期望的那样，这是一种不好的做法。最小意外原则，等等。当我看到一个循环时，我希望它会循环，如果没有，我必须停下来想知道*为什么*。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-28T16:41:24.140

这取决于替代品是什么。**您必须承认您发布的代码有些丑陋。**我不会说很清楚。这是一种黑客行为。因此，如果使用其他一些编码解决方案会更糟，那么可以。但如果你有更好的选择，**不要让“已经足够好”的借口安慰你了。**

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-28T16:47:57.293

这是一个非常奇怪的成语。它使用循环来处理它不想要的东西，并可能导致混淆。我想这将跨越一页以上，对于大多数人来说，这将是一个惊喜，这将永远不会运行超过一次。

如何使用更常用的语言功能，如函数？

```
bool success = someSensibleFunctionName();

if(success)
{
   ...
}

someCommonCodeInAnotherFunction(); 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-28T16:52:13.447

我会考虑这种不好的做法。我认为如果您将其设为函数并将中断更改为返回，它会更惯用，并且通常更清晰。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-10-28T17:00:12.480

如果您的代码所做的不是现有构造的简单含义，那么这是您冒险进入“可爱”领域的好兆头。

在这种情况下，您有一个只会运行一次的“循环”。代码的任何读者都需要仔细检查以弄清楚发生了什么。

如果它不是“好”的情况确实是例外，那么抛出异常将是更好的选择。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-10-28T17:00:23.947

将您的代码拆分为更小的功能元素块 - 这样您就可以将上面的代码拆分为一个返回而不是中断的函数。

我不知道上述是否是不好的做法，但它的可读性有点差，可能会让其他可能需要维护源代码的人感到困惑。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-10-28T17:05:31.080

> 您可以为此使用异常，但通常不建议在正常的应用程序逻辑中使用异常，仅用于异常情况。

使用异常没有任何问题。异常是应用程序逻辑的一部分。关于异常的指导原则是它们在运行时应该相对较少。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-10-28T17:07:44.010

对我来说，你所做的事情在很多方面都很糟糕。可以通过将该代码放入方法中来替换循环。

我个人认为，如果你必须放一个！在您的条件面前，那么您正在寻找错误的东西。为了可读性，使您的布尔匹配您正在检查的内容。您确实在检查是否有错误或某些不良情况，所以我更喜欢：

```
`If (isError)
{
   //Do whatever you need to do for the error and
   return;
}` 
```

`超过 ````
If (!isGood)
{
  //Do something
}

```` 

因此，请检查您真正想要检查的内容并将异常检查保持在最低限度。你的目标应该是可读性而不是棘手。想想可怜的灵魂将不得不出现并维护您的代码。

28 年前我做的第一件事是一个 Fortran 程序，它总是需要检查是否有可用的图形设备。有人做出了为此 LNOGRAF 调用布尔值的重大决定，因此如果有可用的图形设备，这将是错误的。我相信它之所以这样设置是因为效率不高，如果有图形设备，对设备的检查返回零。在整个代码中，所有检查都是为了查看图形设备是否可用。它充满了：

如果 (.NOT. LNOGRAF)

我不认为有一个单一的：

如果（LNOGRAF）

在节目中。这被用于 B-52 和巡航导弹的任务规划软件。它确实教会了我为我真正要检查的变量命名。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-10-28T17:25:22.943

那么函数式方法呢？

```
 void method1()
        {
            ... some code
            if( condition )
                method2();
        }

        void method2()
        {
            ... some more code
            if( condition )
                method3();
        }

        void method3()
        {
            ... yet more code
            if( condition )
                method4();
        } 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-10-28T18:12:55.873

我会说您的解决方案可能是正确的解决方案，但这取决于。Paul Tomblin 发布了一个更好的答案（一系列 if 管）......如果可以使用的话。

当在循环过程中进行昂贵的对象初始化时，不能使用 Paul 的解决方案。如果创建的对象在后面的步骤中使用，do while (0) 解决方案更好。

也就是说，应该改进变量命名。此外，为什么要如此重用“转义”变量？而是明确地捕获每个单独的错误条件并中断循环，以便清楚导致每个点发生中断的原因。

其他人建议使用函数调用。同样，如果由于在任何给定步骤中可能传递的 args 的数量而给函数调用增加了不必要的复杂性，这可能不是一个理想的分解。

其他人认为这是一个难以理解的成语。好吧，首先您可以按照循环顶部的建议发表评论。其次，do-while(0) 是所有 C 程序员都应该立即识别的宏中的一个正常且常见的习惯用法，所以我不买它。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-10-28T19:28:58.123

首先，如果您只想回答这个代码结构或习语是否“坏”，我认为是。但是，我认为这是分解不良的症状，而不是您拥有的代码是“好”还是“坏”。

我认为必须进行更好的分析和重构才能进一步解决问题的根源，而不仅仅是查看代码。如果您可以执行以下操作：

```
if (condition1(...) && condition2(...) && condition3(...) && ... && conditionN(...)) {
    // code that ought to run after all conditions
};
// code that ought to run whether all conditions are met or not 
```

然后我认为它会更“可读”和更惯用。这样，您可以制作如下功能：

```
bool conditionN(...) {
    if (!real_condition) return false;
    // code that ought to run
    return true;
}; 
```

您将受益于更好的分解和编译器的帮助，以产生 && 将带来的必要短路。编译器甚至可以在函数中内联代码以生成比手动编码循环更好的代码。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-10-28T16:37:59.857

我认为这项技术基本上没有问题。我认为我会确保将 bool 命名为比 isGood 更具描述性的名称。虽然，现在我看了一下，为什么将循环中的所有代码都放在一个 if(!isGood) 块中不起作用？循环只执行一次。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-10-28T17:05:28.290

**如果在if(!isGood)**之间拆分代码break; 分成单独的函数，最终可能会得到几十个只包含几行的函数，因此执行者不会简化任何事情。我不能使用**return**因为我还没有准备好离开这个函数，我还想在那里做一些事情。我接受可能我应该为我想要执行的每个代码部分满足单独的**if(isGood) {...}**条件，但有时这会导致很多花括号。但我想我接受人们并不真正喜欢这种类型的建筑，所以一切都是风向标！
感谢您的回答。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-10-28T18:25:29.827

元评论：当你编码时，你的目标首先应该是清晰、可维护的代码。你不应该放弃效率祭坛上的易读性，除非你描述并证明它是必要的并且它实际上可以改善事情。绝地思维技巧应该被避免。总是认为下一个维护你的代码的人是一个非常卑鄙的精神病患者，你的家庭住址。以我为例。

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2008-10-28T16:43:46.430

我想我不得不同意你的同事只是因为可读性，乍一看你并不清楚你想用这段代码完成什么。

为什么不直接使用

```
if(isGood)
{
...Execute more code
} 
```

?

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2008-10-28T17:47:41.090

我认为人们在这里并不诚实。

如果我，作为您的团队负责人，会看到这样的代码，那么您将接受一对一的讨论，并标记为团队的潜在问题，因为那段代码特别可怕。

我说您应该听取您的同事的意见，并按照此处发布的任何建议重写它。

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2008-10-28T18:24:04.120

这就是例外。你不能继续这个逻辑，因为出了点问题。即使恢复是微不足道的，它仍然是一个例外。如果您有充分的理由不使用异常，例如当您使用不支持异常的语言进行编程时，请使用条件块，而不是循环。

# functional-programming - 功能点与 kloc 比率作为软件指标......“名称调整”指标？

> ID：243971
> 
> 赞同：0
> 
> 时间：2008-10-28T16:37:32.480
> 
> 标签：functional-programming, metric

您如何看待使用功能点到代码行的度量作为度量？

这让我想起了旧游戏节目“Name That Tune”。“我可以用三个音符来命名那首曲子！” 我可以在 0.1 klocs 中编写该功能！这有用吗？

它似乎肯定会促进图书馆的使用，但这是你想要的吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-28T16:43:56.350

我认为这是一个可怕的想法。就像按他们编写的代码行向程序员支付报酬一样糟糕。

一般来说，我更喜欢简洁的代码而不是冗长的代码，但前提是它仍然清楚地表达了程序员的意图。最大化每个 kloc 的功能点将鼓励每个人尽可能简短地编写他们的代码，这超出了简洁性和神秘性。它还将鼓励人们将相邻的代码行合并为一行，即使这种合并在其他情况下是不可取的，只是为了减少代码行数。允许的最大行长度也将成为一个问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-28T16:43:19.863

如果您严格执行代码标准，KLOC 是可以容忍的，有点像使用报告的页面要求：不要将五个语句放在一行或从代码中删除大部分空白。

我想你可以决定它对你的环境有多有效的一种方法是查看几个不同的应用程序和模块，粗略估计代码的质量，并将其与代码的大小进行比较。如果您可以证明您的组织内的代码质量是一致的，那么 KLOC 就不是一个糟糕的指标。

在某些方面，您将面临使用任何类似指标的相同战斗。如果你计算特性或功能点，或者只是特性或模块，你仍然希望以某种方式对它们进行加权。最终，您需要对要收集的客观数据进行某种主观补充。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-28T17:50:31.990

“您如何看待使用功能点到代码行的度量作为度量？”

不明白这个问题。对于给定的语言和团队，上述比率是一个简单的统计事实。它趋向于具有较小标准偏差的平均值。

There are lots of degrees of freedom: how you count function points, what language you're using, how (collectively) clever the team is. If you don't change those things, the value stays steady.

After a few projects together, you have a solid expectation that 1200 function points will be 12,000 lines of code in your preferred language/framework/team organization.

KSloc / FP is a bare statistical observation. Clearly, there's something else about this that's bothering you. Could you be more specific in your question?

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T18:22:28.430

All metrics suck. My theory has always been that if you *have* to have them, then use the easiest thing you can to gather them and be done with it and onto important things.

That generally means something along the lines of

```
grep -c ";" *.h *.cpp | awk -F: '/:/ {x += $2} END {print x}' 
```

If you are looking for a "metric" to track code efficency, don't. If you insist, again try something stupid but easy like source file size (see grep command above, w/o the awk pipe) or McCabe (with a counter program).

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-28T18:44:39.587

The metric of Function Points to Lines of Code is actually used to generate the language level charts (actually, it is Function Points to Statements) to give an approximate sense of how powerful a programming language is. Here is an example: [http://web.cecs.pdx.edu/~timm/dm/functionpoints.html](http://web.cecs.pdx.edu/~timm/dm/functionpoints.html)

I wouldn't recommend using that ratio for anything else, except high level approximations like the language level chart.

Promoting library usage is a good thing, but the other thing to keep in mind is you will lose in the ratio when you are building the libraries, and will only pay it off with dividends of savings over time. Bean-counters won't understand that.

I personally would like to see a Function point to ABC metric ratio -- as I am curious about how the ABC metric (which indicates size and includes complexity as part of the info) would relate - perhaps linear, perhaps exponential, etc... www.softwarerenovation.com/ABCMetric.pdf

# ssas - SSAS 自定义分组查询

> ID：243985
> 
> 赞同：0
> 
> 时间：2008-10-28T16:41:19.350
> 
> 标签：ssas, olap

我的事实表看起来像这样

```
yesterday a
yesterday a
yesterday a
yesterday b
yesterday b
yesterday c
today     a
today     a
today     b
today     b
tommorow  a
tommorow  a
tommorow  c
tommorow  d 
```

最后我需要一个这样的Excel报告

```
 repetition count
               1     2     3
yesterday      1     1     1
today          0     2     0
tomorow        2     1     0 
```

如何在 SSAS 2k5 中创建“重复计数”维度？请记住，我的事实表稍微复杂一些，而且我还有更多其他维度。

我的想法是在 DSV 中创建一个命名查询，但我怀疑过滤是否能正常工作。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-13T23:29:25.827

我认为您需要使用 GROUP BY 和计数进行视图，以便将如下数据加载到多维数据集中

```
yesterday a 3
yesterday b 2
yesterday c 1
today     a 2
today     b 2
tomorrow  a 2
tomorrow  c 1
tomorrow  d 1 
```

然后，您可以使用计数列作为重复计数维度的键，并根据行计数聚合类型创建度量。

# caching - 您在客户端缓存资源多长时间？

> ID：243989
> 
> 赞同：3
> 
> 时间：2008-10-28T16:42:15.933
> 
> 标签：caching, pragma

我的一个网站将在数据库中托管常用的图像、javascript 和 CSS 样式表。由于这些不太可能每天都在更改，因此我将在这些上使用一些客户端缓存来减少服务器负载。

您将这些缓存多久？几天？更多的？

如果我更新资源，我可能不会重复使用相同的名称两次，所以我不应该有过时的数据问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T16:47:39.433

如果您在更新时更改名称，那么您将拥有永远缓存的奢侈。如果您可以更改名称，这是一个很大的优势。

当涉及到脚本和 CSS 时，这也是一个好主意，因为即使您另有规定，某些客户端机器也会持续缓存。

# java - 如何将一个巨大的 zip 文件拆分为多个卷？

> ID：243992
> 
> 赞同：13
> 
> 时间：2008-10-28T16:42:40.863
> 
> 标签：java, zip

当我通过 创建 zip 存档时`java.util.zip.*`，有没有办法将生成的存档拆分为多个卷？

假设我的整个存档有一个`filesize`，`24 MB`我想将它分成 3 个文件，每个文件的大小限制为 10 MB。
是否有具有此功能的 zip API？或者任何其他好的方法来实现这一点？

谢谢托尔斯滕

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-28T16:52:07.317

检查：[http ://saloon.javaranch.com/cgi-bin/ubb/ultimatebb.cgi?ubb=get_topic&f=38&t=004618](http://saloon.javaranch.com/cgi-bin/ubb/ultimatebb.cgi?ubb=get_topic&f=38&t=004618)

*我不知道有任何公共 API 可以帮助您做到这一点。（尽管如果您不想以编程方式执行此操作，可以使用诸如 WinSplitter 之类的实用程序来执行此操作）*

*我没有尝试过，但是使用 ZippedInput/OutputStream 时的每个 ZipEntry 都有一个压缩大小。在创建压缩文件时，您可能会粗略估计压缩文件的大小。如果您需要 2MB 的压缩文件，则可以在条目的累积大小变为 1.9MB 后停止写入文件，清单文件和其他 zip 文件特定元素需要 0.1MB。* *因此，简而言之，您可以在 ZippedInputStream 上编写一个包装器，如下所示：*

```
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.zip.ZipEntry;
import java.util.zip.ZipOutputStream;

public class ChunkedZippedOutputStream {

    private ZipOutputStream zipOutputStream;

    private final String path;
    private final String name;

    private long currentSize;
    private int currentChunkIndex;
    private final long MAX_FILE_SIZE = 16000000; // Whatever size you want
    private final String PART_POSTFIX = ".part.";
    private final String FILE_EXTENSION = ".zip";

    public ChunkedZippedOutputStream(String path, String name) throws FileNotFoundException {
        this.path = path;
        this.name = name;
        constructNewStream();
    }

    public void addEntry(ZipEntry entry) throws IOException {
        long entrySize = entry.getCompressedSize();
        if ((currentSize + entrySize) > MAX_FILE_SIZE) {
            closeStream();
            constructNewStream();
        } else {
            currentSize += entrySize;
            zipOutputStream.putNextEntry(entry);
        }
    }

    private void closeStream() throws IOException {
        zipOutputStream.close();
    }

    private void constructNewStream() throws FileNotFoundException {
        zipOutputStream = new ZipOutputStream(new FileOutputStream(new File(path, constructCurrentPartName())));
        currentChunkIndex++;
        currentSize = 0;
    }

    private String constructCurrentPartName() {
        // This will give names is the form of <file_name>.part.0.zip, <file_name>.part.1.zip, etc.
        return name + PART_POSTFIX + currentChunkIndex + FILE_EXTENSION;
    }
} 
```

*上面的程序只是一种方法的提示，无论如何都不是最终的解决方案*。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-29T02:34:13.990

如果目标是让输出与 pkzip 和 winzip 兼容，我不知道有任何开源库可以做到这一点。我们对我们的一个应用程序有类似的要求，我最终编写了自己的实现（与 zip 标准兼容）。如果我记得，对我们来说最困难的事情是我们必须即时生成单个文件（大多数 zip 实用程序的工作方式是它们创建大 zip 文件，然后再返回并拆分它 - 这更容易实现。花了大约一天的时间来编写和 2 天的时间来调试。

zip 标准解释了文件格式的外观。如果你不怕卷起袖子，这绝对是可行的。您必须自己实现一个 zip 文件生成器，但您可以使用 Java 的 Deflator 类为压缩数据生成分段流。您必须自己生成文件和节标题，但它们只是字节 - 一旦您深入研究就不会太难了。

这是[zip 规范](http://www.pkware.com/documents/casestudies/APPNOTE.TXT)- K 部分包含您正在寻找的具体信息，但您还需要阅读 A、B、C 和 F。如果您正在处理非常大的文件（我们曾经是），您也必须使用 Zip64 的东西 - 但对于 24 MB，您很好。

如果您想潜入并尝试一下-如果遇到问题，请回帖，我会看看是否可以提供一些指示。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2019-04-29T22:12:29.127

对于它的价值，我喜欢在任何地方使用**try-with-resources**。如果你喜欢这种设计模式，那么你会喜欢这个。此外，如果条目大于所需的零件尺寸，这也解决了空零件的问题。在最坏的情况下，您*至少*将拥有与条目一样多的部分。

在：

> 我的存档.zip

出去：

> my-archive.part1of3.zip
> my-archive.part2of3.zip
> my-archive.part3of3.zip

注意：我正在使用日志记录和 Apache Commons FilenameUtils，但请随意使用工具包中的内容。

```
/**
 * Utility class to split a zip archive into parts (not volumes)
 * by attempting to fit as many entries into a single part before
 * creating a new part. If a part would otherwise be empty because
 * the next entry won't fit, it will be added anyway to avoid empty parts.
 *
 * @author Eric Draken, 2019
 */
public class Zip
{
    private static final int DEFAULT_BUFFER_SIZE = 1024 * 4;

    private static final String ZIP_PART_FORMAT = "%s.part%dof%d.zip";

    private static final String EXT = "zip";

    private static final Logger logger = LoggerFactory.getLogger( MethodHandles.lookup().lookupClass() );

    /**
     * Split a large archive into smaller parts
     *
     * @param zipFile             Source zip file to split (must end with .zip)
     * @param outZipFile          Destination zip file base path. The "part" number will be added automatically
     * @param approxPartSizeBytes Approximate part size
     * @throws IOException Exceptions on file access
     */
    public static void splitZipArchive(
        @NotNull final File zipFile,
        @NotNull final File outZipFile,
        final long approxPartSizeBytes ) throws IOException
    {
        String basename = FilenameUtils.getBaseName( outZipFile.getName() );
        Path basePath = outZipFile.getParentFile() != null ? // Check if this file has a parent folder
            outZipFile.getParentFile().toPath() :
            Paths.get( "" );
        String extension = FilenameUtils.getExtension( zipFile.getName() );
        if ( !extension.equals( EXT ) )
        {
            throw new IllegalArgumentException( "The archive to split must end with ." + EXT );
        }

        // Get a list of entries in the archive
        try ( ZipFile zf = new ZipFile( zipFile ) )
        {
            // Silliness check
            long minRequiredSize = zipFile.length() / 100;
            if ( minRequiredSize > approxPartSizeBytes )
            {
                throw new IllegalArgumentException(
                    "Please select a minimum part size over " + minRequiredSize + " bytes, " +
                        "otherwise there will be over 100 parts."
                );
            }

            // Loop over all the entries in the large archive
            // to calculate the number of parts required
            Enumeration<? extends ZipEntry> enumeration = zf.entries();
            long partSize = 0;
            long totalParts = 1;
            while ( enumeration.hasMoreElements() )
            {
                long nextSize = enumeration.nextElement().getCompressedSize();
                if ( partSize + nextSize > approxPartSizeBytes )
                {
                    partSize = 0;
                    totalParts++;
                }
                partSize += nextSize;
            }

            // Silliness check: if there are more parts than there
            // are entries, then one entry will occupy one part by contract
            totalParts = Math.min( totalParts, zf.size() );

            logger.debug( "Split requires {} parts", totalParts );
            if ( totalParts == 1 )
            {
                // No splitting required. Copy file
                Path outFile = basePath.resolve(
                    String.format( ZIP_PART_FORMAT, basename, 1, 1 )
                );
                Files.copy( zipFile.toPath(), outFile );
                logger.debug( "Copied {} to {} (pass-though)", zipFile.toString(), outFile.toString() );
                return;
            }

            // Reset
            enumeration = zf.entries();

            // Split into parts
            int currPart = 1;
            ZipEntry overflowZipEntry = null;
            while ( overflowZipEntry != null || enumeration.hasMoreElements() )
            {
                Path outFilePart = basePath.resolve(
                    String.format( ZIP_PART_FORMAT, basename, currPart++, totalParts )
                );
                overflowZipEntry = writeEntriesToPart( overflowZipEntry, zf, outFilePart, enumeration, approxPartSizeBytes );
                logger.debug( "Wrote {}", outFilePart );
            }
        }
    }

    /**
     * Write an entry to the to the outFilePart
     *
     * @param overflowZipEntry    ZipEntry that didn't fit in the last part, or null
     * @param inZipFile           The large archive to split
     * @param outFilePart         The part of the archive currently being worked on
     * @param enumeration         Enumeration of ZipEntries
     * @param approxPartSizeBytes Approximate part size
     * @return Overflow ZipEntry, or null
     * @throws IOException File access exceptions
     */
    private static ZipEntry writeEntriesToPart(
        @Nullable ZipEntry overflowZipEntry,
        @NotNull final ZipFile inZipFile,
        @NotNull final Path outFilePart,
        @NotNull final Enumeration<? extends ZipEntry> enumeration,
        final long approxPartSizeBytes
    ) throws IOException
    {
        try (
            ZipOutputStream zos =
                new ZipOutputStream( new FileOutputStream( outFilePart.toFile(), false ) )
        )
        {
            long partSize = 0;
            byte[] buffer = new byte[DEFAULT_BUFFER_SIZE];
            while ( overflowZipEntry != null || enumeration.hasMoreElements() )
            {
                ZipEntry entry = overflowZipEntry != null ? overflowZipEntry : enumeration.nextElement();
                overflowZipEntry = null;

                long entrySize = entry.getCompressedSize();
                if ( partSize + entrySize > approxPartSizeBytes )
                {
                    if ( partSize != 0 )
                    {
                        return entry;    // Finished this part, but return the dangling ZipEntry
                    }
                    // Add the entry anyway if the part would otherwise be empty
                }
                partSize += entrySize;
                zos.putNextEntry( entry );

                // Get the input stream for this entry and copy the entry
                try ( InputStream is = inZipFile.getInputStream( entry ) )
                {
                    int bytesRead;
                    while ( (bytesRead = is.read( buffer )) != -1 )
                    {
                        zos.write( buffer, 0, bytesRead );
                    }
                }
            }
            return null;    // Finished splitting
        }
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-07-06T16:10:21.680

下面的代码是我根据所需大小将目录结构中的 zip 文件拆分为块的解决方案。我发现以前的答案很有用，所以想用类似但更简洁的方法做出贡献。这段代码可以满足我的特定需求，我相信还有改进的余地。

```
import java.io.*;
import java.util.Enumeration;
import java.util.zip.ZipEntry;
import java.util.zip.ZipFile;
import java.util.zip.ZipInputStream;
import java.util.zip.ZipOutputStream;

class ChunkedZip {
    private final static long MAX_FILE_SIZE = 1000 * 1000 * 1024; //  around 1GB 
    private final static String zipCopyDest = "C:\\zip2split\\copy";

    public static void splitZip(String zipFileName, String zippedPath, String coreId) throws IOException {

        System.out.println("process whole zip file..");
        FileInputStream fis = new FileInputStream(zippedPath);
        ZipInputStream zipInputStream = new ZipInputStream(fis);
        ZipEntry entry = null;
        int currentChunkIndex = 0;
        //using just to get the uncompressed size of the zipentries
        long entrySize = 0;
        ZipFile zipFile = new ZipFile(zippedPath);
        Enumeration enumeration = zipFile.entries();

        String copDest = zipCopyDest + "\\" + coreId + "_" + currentChunkIndex + ".zip";

        FileOutputStream fos = new FileOutputStream(new File(copDest));
        BufferedOutputStream bos = new BufferedOutputStream(fos);
        ZipOutputStream zos = new ZipOutputStream(bos);
        long currentSize = 0;

        try {
            while ((entry = zipInputStream.getNextEntry()) != null && enumeration.hasMoreElements()) {

                ZipEntry zipEntry = (ZipEntry) enumeration.nextElement();
                System.out.println(zipEntry.getName());
                System.out.println(zipEntry.getSize());
                entrySize = zipEntry.getSize();

                ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
                //long entrySize = entry.getCompressedSize();
                //entrySize = entry.getSize(); //gives -1

                if ((currentSize + entrySize) > MAX_FILE_SIZE) {
                    zos.close();
                    //construct a new stream
                    //zos = new ZipOutputStream(new FileOutputStream(new File(zippedPath, constructCurrentPartName(coreId))));
                    currentChunkIndex++;
                    zos = getOutputStream(currentChunkIndex, coreId);
                    currentSize = 0;

                } else {
                    currentSize += entrySize;
                    zos.putNextEntry(new ZipEntry(entry.getName()));
                    byte[] buffer = new byte[8192];
                    int length = 0;
                    while ((length = zipInputStream.read(buffer)) > 0) {
                        outputStream.write(buffer, 0, length);
                    }

                    byte[] unzippedFile = outputStream.toByteArray();
                    zos.write(unzippedFile);
                    unzippedFile = null;
                    outputStream.close();
                    zos.closeEntry();
                }
                //zos.close();
            }
        } finally {
            zos.close();
        }
    }

    public static ZipOutputStream getOutputStream(int i, String coreId) throws IOException {
        System.out.println("inside of getOutputStream()..");
        ZipOutputStream out = new ZipOutputStream(new FileOutputStream(zipCopyDest + "\\" + coreId + "_" + i + ".zip"));
        // out.setLevel(Deflater.DEFAULT_COMPRESSION);
        return out;
    }

    public static void main(String args[]) throws IOException {
        String zipFileName = "Large_files_for_testing.zip";
        String zippedPath = "C:\\zip2split\\Large_files_for_testing.zip";
        String coreId = "Large_files_for_testing";
        splitZip(zipFileName, zippedPath, coreId);
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-01-21T14:56:30.833

这是我的解决方案：

```
public abstract class ZipHelper {

    public static NumberFormat formater = NumberFormat.getNumberInstance(new Locale("pt", "BR"));

    public static List<Path> zip(Collection<File> inputFiles, long maxSize) throws IOException {

        byte[] buffer = new byte[1024];
        int count = 0;
        long currentZipSize = maxSize;
        List<Path> response = new ArrayList<>();
        ZipOutputStream zip = null;
        for (File currentFile : inputFiles) {
            long nextFileSize = currentFile.length();
            long predictedZipSize = currentZipSize + nextFileSize;
            boolean needNewFile = predictedZipSize >= maxSize;
            System.out.println("[=] ZIP current (" + formater.format(currentZipSize) + ") + next file (" + formater.format(nextFileSize) + ") = predicted (" + formater.format(predictedZipSize) + ") > max (" + formater.format(maxSize) + ") ? " + needNewFile);
            if (needNewFile) {
                safeClose(zip);
                Path tmpFile = Files.createTempFile("teste-", (".part." + count++ + ".zip"));
                System.out.println("[#] Starting new file: " + tmpFile);
                zip = new ZipOutputStream(Files.newOutputStream(tmpFile));
                zip.setLevel(Deflater.BEST_COMPRESSION);
                response.add(tmpFile);
                currentZipSize = 0;
            }
            ZipEntry zipEntry = new ZipEntry(currentFile.getName());
            System.out.println("[<] Adding to ZIP: " + currentFile.getName());
            zip.putNextEntry(zipEntry);
            FileInputStream in = new FileInputStream(currentFile);
            zip.write(in.readAllBytes());
            zip.closeEntry();
            safeClose(in);
            long compressed = zipEntry.getCompressedSize();
            System.out.println("[=] Compressed current file: " + formater.format(compressed));
            currentZipSize += zipEntry.getCompressedSize();
        }
        safeClose(zip);
        return response;
    }

    public static void safeClose(Closeable... closeables) {
        if (closeables != null) {
            for (Closeable closeable : closeables) {
                if (closeable != null) {
                    try {
                        System.out.println("[X] Closing: (" + closeable.getClass() + ") - " + closeable);
                        closeable.close();
                    } catch (Throwable ex) {
                        System.err.println("[!] Error on close: " + closeable);
                        ex.printStackTrace();
                    }
                }
            }
        }
    }
} 
```

和控制台输出：

```
[?] Files to process: [\data\teste\TestFile(1).pdf, \data\teste\TestFile(2).pdf, \data\teste\TestFile(3).pdf, \data\teste\TestFile(4).pdf, \data\teste\TestFile(5).pdf, \data\teste\TestFile(6).pdf, \data\teste\TestFile(7).pdf]
[=] ZIP current (3.145.728) + next file (1.014.332) = predicted (4.160.060) > max (3.145.728) ? true
[#] Starting new file: C:\Users\Cassio\AppData\Local\Temp\teste-3319961516431535912.part.0.zip
[<] Adding to ZIP: TestFile(1).pdf
[X] Closing: (class java.io.FileInputStream) - java.io.FileInputStream@3d99d22e
[=] Compressed current file: 940.422
[=] ZIP current (940.422) + next file (1.511.862) = predicted (2.452.284) > max (3.145.728) ? false
[<] Adding to ZIP: TestFile(2).pdf
[X] Closing: (class java.io.FileInputStream) - java.io.FileInputStream@49fc609f
[=] Compressed current file: 1.475.178
[=] ZIP current (2.415.600) + next file (2.439.287) = predicted (4.854.887) > max (3.145.728) ? true
[X] Closing: (class java.util.zip.ZipOutputStream) - java.util.zip.ZipOutputStream@cd2dae5
[#] Starting new file: C:\Users\Cassio\AppData\Local\Temp\teste-8849887746791381380.part.1.zip
[<] Adding to ZIP: TestFile(3).pdf
[X] Closing: (class java.io.FileInputStream) - java.io.FileInputStream@4973813a
[=] Compressed current file: 2.374.718
[=] ZIP current (2.374.718) + next file (2.385.447) = predicted (4.760.165) > max (3.145.728) ? true
[X] Closing: (class java.util.zip.ZipOutputStream) - java.util.zip.ZipOutputStream@6321e813
[#] Starting new file: C:\Users\Cassio\AppData\Local\Temp\teste-6305809161676875106.part.2.zip
[<] Adding to ZIP: TestFile(4).pdf
[X] Closing: (class java.io.FileInputStream) - java.io.FileInputStream@79be0360
[=] Compressed current file: 2.202.203
[=] ZIP current (2.202.203) + next file (292.918) = predicted (2.495.121) > max (3.145.728) ? false
[<] Adding to ZIP: TestFile(5).pdf
[X] Closing: (class java.io.FileInputStream) - java.io.FileInputStream@22a67b4
[=] Compressed current file: 230.491
[=] ZIP current (2.432.694) + next file (4.197.512) = predicted (6.630.206) > max (3.145.728) ? true
[X] Closing: (class java.util.zip.ZipOutputStream) - java.util.zip.ZipOutputStream@57855c9a
[#] Starting new file: C:\Users\Cassio\AppData\Local\Temp\teste-17160527941340008316.part.3.zip
[<] Adding to ZIP: TestFile(6).pdf
[X] Closing: (class java.io.FileInputStream) - java.io.FileInputStream@3b084709
[=] Compressed current file: 3.020.115
[=] ZIP current (3.020.115) + next file (1.556.237) = predicted (4.576.352) > max (3.145.728) ? true
[X] Closing: (class java.util.zip.ZipOutputStream) - java.util.zip.ZipOutputStream@3224f60b
[#] Starting new file: C:\Users\Cassio\AppData\Local\Temp\teste-14050058835776413808.part.4.zip
[<] Adding to ZIP: TestFile(7).pdf
[X] Closing: (class java.io.FileInputStream) - java.io.FileInputStream@63e2203c
[=] Compressed current file: 1.460.566
[X] Closing: (class java.util.zip.ZipOutputStream) - java.util.zip.ZipOutputStream@1efed156
[>] Generated ZIP files(s): [C:\Users\Cassio\AppData\Local\Temp\teste-3319961516431535912.part.0.zip, C:\Users\Cassio\AppData\Local\Temp\teste-8849887746791381380.part.1.zip, C:\Users\Cassio\AppData\Local\Temp\teste-6305809161676875106.part.2.zip, C:\Users\Cassio\AppData\Local\Temp\teste-17160527941340008316.part.3.zip, C:\Users\Cassio\AppData\Local\Temp\teste-14050058835776413808.part.4.zip] 
```

# c# - 在 Vista 上设置文件夹权限

> ID：243995
> 
> 赞同：2
> 
> 时间：2008-10-28T16:43:36.693
> 
> 标签：c#, security, file-permissions

我正在尝试在 vista 计算机上设置文件夹及其所有子项的权限。我到目前为止的代码是这样的。

```
 public static void SetPermissions(string dir)
        {
            DirectoryInfo info = new DirectoryInfo(dir);
            DirectorySecurity ds = info.GetAccessControl();            
            ds.AddAccessRule(new FileSystemAccessRule(@"BUILTIN\Users", 
                             FileSystemRights.FullControl, 
                             InheritanceFlags.ContainerInherit,
                             PropagationFlags.None, 
                             AccessControlType.Allow));

            info.SetAccessControl(ds);            
        } 
```

但是它没有像我期望的那样工作。
即使我以管理员身份运行代码，它也不会设置权限。

我正在使用的文件夹位于 C:\ProgramData\<my folder> 中，我可以手动更改它的权限就好了。

任何人都想指出我正确的方向。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-28T20:43:00.953

所以答案是两方面的。首先，在对文件夹设置权限之前创建了一个子文件夹，我需要或在权限上再添加一个标志以使其成为文件夹和文件都继承权限。

```
public static void SetPermissions(string dir)
        {
            DirectoryInfo info = new DirectoryInfo(dir);
            DirectorySecurity ds = info.GetAccessControl();            
            ds.AddAccessRule(new FileSystemAccessRule(@"BUILTIN\Users", 
                             FileSystemRights.FullControl,
                             InheritanceFlags.ObjectInherit |
                             InheritanceFlags.ContainerInherit,
                             PropagationFlags.None,
                             AccessControlType.Allow));
            info.SetAccessControl(ds);            
        } 
```

在那之后，每件事似乎都在工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-28T16:54:30.370

这可能是一个愚蠢的问题，但您是否尝试过手动执行相同的操作（例如使用资源管理器）？Vista 有一些目录，即使是管理员组中的用户也无法在不采取额外步骤的情况下进行修改。我认为您首先需要采取两个步骤。

首先，使用 Explorer 对代码进行相同的修改。如果失败，请排除故障。

其次，在您在自己的用户文件夹下创建的目录上测试您的代码。你不应该需要管理员权限来做到这一点；登录帐户应该能够更改例如 c:\Users\yourname\documents 下文件夹的 ACL。

我还将单步调试调试器中的代码，并在调用 SetAccessControl 之前查看“ds”对象。这可能会向你展示一些意想不到的东西，让你走上正确的道路。`*******