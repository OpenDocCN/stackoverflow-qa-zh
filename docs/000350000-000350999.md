# StackOverflow 问答 000350000-000350999

# sql-server - 带或不带索引的批量插入

> ID：350003
> 
> 赞同：11
> 
> 时间：2008-12-08T16:11:01.197
> 
> 标签：sql-server, performance, bulkinsert

在评论中我读到

> 顺便说一句，有时删除表的索引并在批量插入操作后重新创建它们会更快。

这是真的？在什么情况下？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-08T16:54:48.253

与乔尔一样，我会回应这样的说法，是的，这可能是真的。我发现识别他提到的场景的关键在于数据的分布，以及您在特定表上拥有的索引的大小。

在我曾经支持的一个应用程序中，它定期批量导入 180 万行，表上有 4 个索引，1 个索引有 11 列，表中总共有 90 列。带索引的导入需要 20 多个小时才能完成。删除索引、插入和重新创建索引只需要 1 小时 25 分钟。

所以它可能是一个很大的帮助，但很多都归结为您的数据、索引和数据值的分布。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-08T16:13:32.283

是的，它是真实的。当插入期间表上有索引时，服务器将需要不断地重新排序/分页表以保持索引是最新的。如果您删除索引，它可以只添加行而不用担心，然后在您重新创建索引时一次构建所有索引。

* * *

当然，例外情况是导入数据已经按索引顺序排列。事实上，我应该注意到我现在正在研究一个观察到这种相反效果的项目。我们希望减少大型导入（从大型机系统夜间转储）的运行时间。我们尝试删除索引、导入数据并重新创建它们。它实际上*显着增加*了导入完成的时间。但是，这并不典型。它只是表明您应该始终首先测试您的特定系统。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-08T22:42:16.397

删除和重新创建索引时应该考虑的一件事是，它应该只在数据库使用量低的期间运行的自动化进程上完成。当索引被删除时，它不能用于其他用户可能同时运行的其他查询。如果您在生产时间这样做，您的用户可能会开始抱怨超时。

# algorithm - 从确定的项目列表中最适合人们选择的算法，其中每个项目只有一个可用？

> ID：350005
> 
> 赞同：7
> 
> 时间：2008-12-08T16:11:13.550
> 
> 标签：algorithm, language-agnostic

女士们先生们，

我和我最好的朋友每年都会做一次“秘密圣诞老人”式的礼物交换，今年我一直在想一些方法让它变得有趣。我们有六个人参与其中，我想设计一个小程序，让我们六个人从 1 到 5 对他们喜欢的礼物接受者以及他们喜欢的送礼者进行排名。

所以，假设我们被称为 A、B、C、D、E 和 F。

A 提交两个列表：

> 清单 1 - 我最想送礼物的人：B、D、C、F、E
> 
> 清单 2 - 我最想收到礼物的人：F、D、E、B、C

我们六个人都将提交这两个列表，所以我总共有 12 个列表。我想我的问题是现在继续为每个人分配礼物接受者的最佳算法是什么？

我想到了这样的事情：

如果两个人都在他们的相反列表中选择了对方（即 A 最想给 B，B 最想从 A 得到）然后我立即将 A 分配给 B。所以现在 A 从我们的礼物接受者列表中删除B 从我们的送礼者池中移除。

一旦我分配了“完美匹配”，我有点迷失了，是否有针对这种情况的建立算法？显然它只是为了娱乐价值，但肯定有类似东西的“真实”应用吗？也许时间表或什么？

我的 Google-fu 让我失望了，但我有一种感觉，这可能只是因为我自己的搜索词不够精确。

干杯，（我猜是节日快乐），Rob

* * *

## 更新/第 2 部分

好的，[Ying Xiao](https://stackoverflow.com/users/30202/ying-xiao)通过推荐用于[稳定婚姻问题的](http://en.wikipedia.org/wiki/Stable_marriage_problem)[Gale Shapley 算法](http://en.wikipedia.org/wiki/Stable_marriage_problem)来救援，我已经在 Python 中实现了它，它很有效。然而，这只是我的一个想法。我猜在我们的六个最好的朋友组中，有三对“超级好”的朋友，所以我感觉我们最终会得到三对 AB、CD、EF 和 BA、DC、FE 的礼物给予和接受。

有没有我们可以设计的算法，既考虑了人们的排名，又限制了两个人形成一个“封闭的群体”？也就是说，如果A被分配给B买礼物，B**不能**被分配给A买礼物吗？也许我需要解决[马厩室友问题](http://en.wikipedia.org/wiki/Stable_roommates_problem)？

相关问题：

*   [秘密圣诞老人算法。](https://stackoverflow.com/questions/273567/secret-santa-algorithm)
*   [什么是最好的低技术协议来模拟从帽子里抽出名字并确保保密？](https://stackoverflow.com/questions/268682/what-is-the-best-low-tech-protocol-to-simulate-drawing-names-out-of-a-hat-and-e)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-08T18:04:21.560

Gale-Shapley 算法（用于稳定婚姻问题）仅适用于每个人都有所有其他参与者的排名列表时——您可能能够也可能无法将您的问题转换为该形式（让每个人都对每个人进行排名*）*。

另外，请注意，它优化的目的是不同的：它试图找到一组**稳定的婚姻**，没有一对人会“私奔”，因为他们更喜欢彼此而不是现在的伴侣。这不是您在 Secret Santa 应用程序中关心的事情。

您想要的（取决于您对“最佳”的定义）是**最大权重二分匹配**，它解决了上述两个反对意见：将“给予者”放在一侧，将“接收者”放在另一侧（所以每个副本都有两个副本人，在这种情况下），给每条边一个权重，对应于给予者对接收者的排名，现在是[分配问题](http://en.wikipedia.org/wiki/Assignment_problem)。您可以为此使用[匈牙利算法](http://en.wikipedia.org/wiki/Hungarian_algorithm)，或更简单（较慢）的算法。您还可以改变分配权重的方式以针对不同的事物进行优化（例如，最大化获得第一选择的人数，或最小化任何人获得的最差选择等）

如果您确实使用 Gale-Shapley 稳定婚姻算法，请注意它对于“提议者”是最优的（男性最优和女性最差），因此请务必将“给予者”作为“提议者”，而不是副手反之亦然。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-08T16:46:51.793

为每个人创建两个虚拟人，一个“给予者”和一个“接受者”。现在使用 Gale Shapley 算法将给予者集与接收者集进行匹配。在 O(n^2) 时间内运行。

[http://en.wikipedia.org/wiki/Stable_marriage_problem](http://en.wikipedia.org/wiki/Stable_marriage_problem)

# asp.net - 可扩展性案例研究

> ID：350009
> 
> 赞同：6
> 
> 时间：2008-12-08T16:11:57.713
> 
> 标签：asp.net, mysql, scalability

我开始从网站上构建一个社区网站，我的网络框架将是 Asp.net 和 Mysql。

我想尽早开始规划基础架构的一些可扩展性，因为我预计网站上线时会出现高流量。

**是否有任何案例研究可供您推荐阅读，其中 asp.net 或 mysql 已被缩放并展示了良好的缩放技术？**

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-08T16:35:05.030

我认为为该特定组合找到参考材料可能是一个挑战。许多 .NET 商店坚持使用 SQL Server，很少使用 MySQL（至少在规模上如此）。

一般来说，适合：

*   遵循通用[.NET 实践以实现可伸缩性](http://msdn.microsoft.com/en-us/library/ms998530.aspx)。剔除不适合你的东西。
*   了解数据库性能和各种设计策略的含义，例如非规范化（何时以及为什么）。
*   考虑像[memcached](http://en.wikipedia.org/wiki/Memcached)这样的进程外缓存。
*   审查有关[MySQL 性能](http://oreilly.com/catalog/9780596101718/)的书籍。其中大部分都集中在 UNIX 平台上。Windows 用户在应用其中一些做法时可能会遇到问题。
*   阅读其他人如何扩展他们的站点（[构建可扩展站点](http://oreilly.com/catalog/9780596102357/)和[容量规划的艺术](http://oreilly.com/catalog/9780596518578/)）
*   考虑如何优化您的网页设计，使其更具可扩展性。你在使用 AJAX 吗？找出过度投票可能产生的影响等。
*   了解如何衡量应用程序和数据库的性能（起点[ASP.NET](http://www.google.com/search?hl=en&q=measuring+asp.net+performance)和[MySQL](http://www.google.com/search?hl=en&q=measuring+mysql+performance&btnG=Search)）。
*   制定扩展架构的计划（1 台服务器到 2 台服务器，多台服务器等），以便您有一些参考框架来制定有关在系统中构建事物的决策。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-25T13:05:38.537

我只知道一个**非常好的**资源来阅读有关可伸缩性技术的案例研究，我真的很惊讶没有人提到它。[**高可扩展性**](http://highscalability.com/)

有很多“开箱即用”的例子和不同的缩放技术，我认为这对于任何对该主题感兴趣的人来说都是一本好书。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-08T16:42:34.673

BrianLy 在这里说得最好：

> “制定扩展架构的计划（从 1 台服务器扩展到 2 台服务器，扩展到多台服务器等），以便您在做出有关在系统中构建事物的决策时有一些参考框架。”

作为一个论坛，我经常说，“引用真实”。他的所有点都非常出色，但这一点却是很多人忽略的关键点。如果您在一台破旧的旧服务器上运行，那么您的代码和数据库的可扩展性并不重要。硬件可能没有你的代码那么重要，改进它超过某个点会很快带来收益递减，但不要忘记让你的硬件达到那个点。如果你有垃圾硬件，或者甚至是好的硬件但还不够，你的网站就会被炸毁。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T20:46:38.253

对于 mysql 扩展，您可能会发现这很有趣：[danga livejournal](http://www.scribd.com/doc/269855/danga-com-livejournal-backend)

# perl - 如何在 Perl 中组合哈希？

> ID：350018
> 
> 赞同：103
> 
> 时间：2008-12-08T16:13:20.270
> 
> 标签：perl, dictionary, hash, merge

将两个散列组合成 %hash1 的最佳方法是什么？我一直都知道 %hash2 和 %hash1 总是有唯一的键。如果可能的话，我也更喜欢一行代码。

```
$hash1{'1'} = 'red';
$hash1{'2'} = 'blue';
$hash2{'3'} = 'green';
$hash2{'4'} = 'yellow'; 
```

* * *

## 回答 #1

> 赞同：177
> 
> 时间：2008-12-08T16:17:06.893

## 快速回答 (TL;DR)

```
    %hash1 = (%hash1, %hash2)

    ＃＃ 要不然 ...

    @hash1{keys %hash2} = 值 %hash2;

    ## 或带有引用...

    $hash_ref1 = { %$hash_ref1, %$hash_ref2 };

```

## 概述

*   **上下文：** Perl 5.x
*   **问题：**用户希望将两个哈希¹合并为一个变量

## 解决方案

*   对简单变量使用上面的语法
*   对复杂的嵌套变量使用 Hash::Merge

## 陷阱

*   当两个哈希都包含一个或多个重复键时该怎么办
    *   （参见例如[Perl - Merge hash contains duplicate keys](https://stackoverflow.com/questions/46945713)）
    *   （参见[Perl hashes: how to deal with duplicate keys and get possible pair](https://stackoverflow.com/questions/17216007)）
*   具有空值的键值对是否应该覆盖具有非空值的键值对？
    *   首先是什么构成了空值与非空值？（例如`undef`，零，空字符串`false`，，假...）

## 也可以看看

*   [关于合并哈希的 PM 帖子](http://www.perlmonks.org/?node_id=524456)
*   [PM 分类问答哈希联合](http://www.perlmonks.org/?node_id=157715)
*   [Perl 食谱 5.10。合并哈希](http://pleac.sourceforge.net/pleac_perl/hashes.html)
*   websearch://perlfaq "合并两个哈希"
*   websearch://perl 合并哈希
*   [https://metacpan.org/pod/Hash::Merge](https://metacpan.org/pod/Hash::Merge)

* * *

## 脚注

¹ *（又名[关联数组](https://stackoverflow.com/questions/tagged/associative-array)，又名[字典](https://stackoverflow.com/questions/tagged/dictionary)）

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-12-08T17:08:26.697

查看[perlfaq4：如何合并两个哈希](http://learn.perl.org/faq/perlfaq4.html#How-do-I-merge-two-hashes)。Perl 文档中已经有很多很好的信息，您可以立即获得，而不必等待其他人回答。:)

* * *

在您决定合并两个散列之前，您必须决定如果两个散列包含相同的键并且您想保留原始散列的原样，该怎么做。

如果要保留原始哈希，请将一个哈希 (%hash1) 复制到新哈希 (%new_hash)，然后将另一个哈希 (%hash2) 中的密钥添加到新哈希中。检查密钥是否已存在于 %new_hash让您有机会决定如何处理重复项：

```
my %new_hash = %hash1; # make a copy; leave %hash1 alone

foreach my $key2 ( keys %hash2 )
    {
    if( exists $new_hash{$key2} )
        {
        warn "Key [$key2] is in both hashes!";
        # handle the duplicate (perhaps only warning)
        ...
        next;
        }
    else
        {
        $new_hash{$key2} = $hash2{$key2};
        }
    } 
```

如果您不想创建新的哈希，您仍然可以使用这种循环技术；只需将 %new_hash 更改为 %hash1。

```
foreach my $key2 ( keys %hash2 )
    {
    if( exists $hash1{$key2} )
        {
        warn "Key [$key2] is in both hashes!";
        # handle the duplicate (perhaps only warning)
        ...
        next;
        }
    else
        {
        $hash1{$key2} = $hash2{$key2};
        }
    } 
```

如果您不在乎一个散列会覆盖另一个散列的键和值，则可以只使用散列切片将一个散列添加到另一个散列。在这种情况下，来自 %hash2 的值会替换来自 %hash1 的值，因为它们具有共同的键：

```
@hash1{ keys %hash2 } = values %hash2; 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2013-02-13T12:02:30.420

这是一个老问题，但在我的 Google 搜索“perl 合并哈希”中排名很高——但它没有提到非常有用的 CPAN 模块[Hash::Merge](https://metacpan.org/pod/Hash%3a%3aMerge)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2017-09-15T19:23:11.193

对于哈希引用。您应该使用如下花括号：

```
$hash_ref1 = {%$hash_ref1, %$hash_ref2}; 
```

而**不是**上面使用括号的建议答案：

```
$hash_ref1 = ($hash_ref1, $hash_ref2); 
```

# c# - 在代码中设置 WPF 图像源

> ID：350027
> 
> 赞同：353
> 
> 时间：2008-12-08T16:15:29.377
> 
> 标签：c#, .net, wpf, image

我正在尝试在代码中设置 WPF 图像的源。图像作为资源嵌入到项目中。通过查看示例，我提出了以下代码。由于某种原因它不起作用 - 图像不显示。

通过调试我可以看到流包含图像数据。那么有什么问题呢？

```
Assembly asm = Assembly.GetExecutingAssembly();
Stream iconStream = asm.GetManifestResourceStream("SomeImage.png");
PngBitmapDecoder iconDecoder = new PngBitmapDecoder(iconStream, BitmapCreateOptions.PreservePixelFormat, BitmapCacheOption.Default);
ImageSource iconSource = iconDecoder.Frames[0];
_icon.Source = iconSource; 
```

图标定义如下：`<Image x:Name="_icon" Width="16" Height="16" />`

* * *

## 回答 #1

> 赞同：448
> 
> 时间：2009-10-30T18:02:05.263

在遇到与您相同的问题并阅读后，我发现了解决方案 - [Pack URIs](http://msdn.microsoft.com/en-us/library/aa970069.aspx)。

我在代码中做了以下事情：

```
Image finalImage = new Image();
finalImage.Width = 80;
...
BitmapImage logo = new BitmapImage();
logo.BeginInit();
logo.UriSource = new Uri("pack://application:,,,/AssemblyName;component/Resources/logo.png");
logo.EndInit();
...
finalImage.Source = logo; 
```

或者更短，通过使用另一个 BitmapImage 构造函数：

```
finalImage.Source = new BitmapImage(
    new Uri("pack://application:,,,/AssemblyName;component/Resources/logo.png")); 
```

URI 分为几部分：

*   权威：`application:///`
*   路径：编译成引用程序集的资源文件的名称。路径必须符合以下格式：`AssemblyShortName[;Version][;PublicKey];component/Path`

    *   AssemblyShortName：被引用程序集的短名称。
    *   ;Version [可选]：包含资源文件的引用程序集的版本。这在加载两个或多个具有相同短名称的引用程序集时使用。
    *   ;PublicKey [可选]：用于签署引用程序集的公钥。这在加载两个或多个具有相同短名称的引用程序集时使用。
    *   ;component：指定被引用的程序集是从本地程序集引用的。
    *   /Path：资源文件的名称，包括其路径，相对于所引用程序集的项目文件夹的根目录。

后面的三个斜杠`application:`必须用逗号替换：

> 注意：包 URI 的授权组件是一个嵌入式 URI，它指向一个包，必须符合 RFC 2396。此外，“/”字符必须替换为“，”字符和保留字符，例如“%”和 ”？” 必须逃脱。有关详细信息，请参阅 OPC。

当然，请确保将图像上的构建操作设置为`Resource`.

* * *

## 回答 #2

> 赞同：185
> 
> 时间：2009-08-26T04:19:11.940

```
var uriSource = new Uri(@"/WpfApplication1;component/Images/Untitled.png", UriKind.Relative);
foo.Source = new BitmapImage(uriSource); 
```

这将在名为“Images”的文件夹中加载名为“Untitled.png”的图像，其“Build Action”在名为“WpfApplication1”的程序集中设置为“Resource”。

* * *

## 回答 #3

> 赞同：77
> 
> 时间：2010-01-06T17:47:13.723

这是更少的代码，可以在一行中完成。

```
string packUri = "pack://application:,,,/AssemblyName;component/Images/icon.png";
_image.Source = new ImageSourceConverter().ConvertFromString(packUri) as ImageSource; 
```

* * *

## 回答 #4

> 赞同：49
> 
> 时间：2010-12-12T17:48:45.370

好简单：

要动态设置菜单项的图像，只需执行以下操作：

```
MyMenuItem.ImageSource = 
    new BitmapImage(new Uri("Resource/icon.ico",UriKind.Relative)); 
```

...而“icon.ico”可以位于任何地方（目前它位于“资源”目录中）并且必须作为资源链接...

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2011-11-17T09:24:18.610

最简单的方法：

```
var uriSource = new Uri("image path here");
image1.Source = new BitmapImage(uriSource); 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2015-05-09T10:25:51.900

这是我的方式：

```
internal static class ResourceAccessor
{
    public static Uri Get(string resourcePath)
    {
        var uri = string.Format(
            "pack://application:,,,/{0};component/{1}"
            , Assembly.GetExecutingAssembly().GetName().Name
            , resourcePath
        );

        return new Uri(uri);
    }
} 
```

用法：

```
new BitmapImage(ResourceAccessor.Get("Images/1.png")) 
```

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2011-02-13T17:09:08.160

您也可以将其减少为一行。这是我用来设置主窗口图标的代码。它假定 .ico 文件被标记为内容并被复制到输出目录。

```
 this.Icon = new BitmapImage(new Uri("Icon.ico", UriKind.Relative)); 
```

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2009-02-09T22:37:41.403

你有没有尝试过：

```
Assembly asm = Assembly.GetExecutingAssembly();
Stream iconStream = asm.GetManifestResourceStream("SomeImage.png");
BitmapImage bitmap = new BitmapImage();
bitmap.BeginInit();
bitmap.StreamSource = iconStream;
bitmap.EndInit();
_icon.Source = bitmap; 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2017-05-15T09:47:19.517

如果您的图像存储在 ResourceDictionary 中，则只需一行代码即可：

```
MyImage.Source = MyImage.FindResource("MyImageKeyDictionary") as ImageSource; 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2009-07-10T10:06:13.477

这是一个动态设置图像路径的示例（图像位于磁盘上的某个位置，而不是作为资源构建）：

```
if (File.Exists(imagePath))
{
    // Create image element to set as icon on the menu element
    Image icon = new Image();
    BitmapImage bmImage = new BitmapImage();
    bmImage.BeginInit();
    bmImage.UriSource = new Uri(imagePath, UriKind.Absolute);
    bmImage.EndInit();
    icon.Source = bmImage;
    icon.MaxWidth = 25;
    item.Icon = icon;
} 
```

## 对图标的思考...

首先想到，您会认为 Icon 属性只能包含图像。但它实际上可以包含任何东西！`Image`当我以编程方式尝试将属性直接设置为带有图像路径的字符串时，我偶然发现了这一点。结果是它没有显示图像，而是路径的实际文本！

这导致了一种替代方法，不必为图标制作图像，而是使用带有符号字体的文本来显示简单的“图标”。以下示例使用包含“软盘”符号的[Wingdings 字体。](https://en.wikipedia.org/wiki/Wingdings)这个符号实际上是字符`<`，它在 XAML 中具有特殊含义，因此我们必须使用编码版本`&lt;`来代替。这就像做梦一样！下面将软盘符号显示为菜单项上的图标：

```
<MenuItem Name="mnuFileSave" Header="Save" Command="ApplicationCommands.Save">
  <MenuItem.Icon>
    <Label VerticalAlignment="Center" HorizontalAlignment="Center" FontFamily="Wingdings">&lt;</Label>
  </MenuItem.Icon>
</MenuItem> 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2010-07-05T09:05:21.393

还有一种更简单的方法。如果图像作为 XAML 中的资源加载，并且相关代码是该 XAML 内容的代码隐藏：

```
Uri iconUri = new Uri("pack://application:,,,/ImageNAme.ico", UriKind.RelativeOrAbsolute);
NotifyIcon.Icon = BitmapFrame.Create(iconUri); 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-12-08T16:24:50.420

将框架放入 VisualBrush：

```
VisualBrush brush = new VisualBrush { TileMode = TileMode.None };

brush.Visual = frame;

brush.AlignmentX = AlignmentX.Center;
brush.AlignmentY = AlignmentY.Center;
brush.Stretch = Stretch.Uniform; 
```

将 VisualBrush 放入 GeometryDrawing

```
GeometryDrawing drawing = new GeometryDrawing();

drawing.Brush = brush;

// Brush this in 1, 1 ratio
RectangleGeometry rect = new RectangleGeometry { Rect = new Rect(0, 0, 1, 1) };
drawing.Geometry = rect; 
```

现在将 GeometryDrawing 放入 DrawingImage：

```
new DrawingImage(drawing); 
```

把它放在你的图片来源上，瞧！

不过，您可以更轻松地做到这一点：

```
<Image>
    <Image.Source>
        <BitmapImage UriSource="/yourassembly;component/YourImage.PNG"></BitmapImage>
    </Image.Source>
</Image> 
```

在代码中：

```
BitmapImage image = new BitmapImage { UriSource="/yourassembly;component/YourImage.PNG" }; 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2010-01-15T02:04:40.110

还有一种更简单的方法。如果图像作为 XAML 中的资源加载，并且相关代码是该 XAML 的代码隐藏：

这是 XAML 文件的资源字典 - 您关心的唯一行是带有键“PosterBrush”的 ImageBrush - 其余代码只是为了显示上下文

```
<UserControl.Resources>
        <ResourceDictionary>
            <ImageBrush x:Key="PosterBrush" ImageSource="..\Resources\Images\EmptyPoster.jpg" Stretch="UniformToFill"/>

        </ResourceDictionary>
    </UserControl.Resources> 
```

现在，在后面的代码中，你可以这样做

```
ImageBrush posterBrush = (ImageBrush)Resources["PosterBrush"]; 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2010-03-24T20:29:21.997

如何从嵌入的资源图标和图像中加载图像（Arcturus 的更正版本）：

假设您要添加一个带有图像的按钮。你该怎么办？

1.  添加到项目文件夹图标并将图像 ClickMe.png 放在这里
2.  在“ClickMe.png”的属性中，将“BuildAction”设置为“Resource”
3.  假设您编译的程序集名称是“Company.ProductAssembly.dll”。
4.  现在是时候在 XAML 中加载我们的图像了

    ```
    <Button Width="200" Height="70">
      <Button.Content>
        <StackPanel>
          <Image Width="20" Height="20">
            <Image.Source>
              <BitmapImage UriSource="/Company.ProductAssembly;component/Icons/ClickMe.png"></BitmapImage>
              </Image.Source>
          </Image>
          <TextBlock HorizontalAlignment="Center">Click me!</TextBlock>
        </StackPanel>
      </Button.Content>
    </Button> 
    ```

完毕。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2010-07-04T15:23:44.430

我是 WPF 的新手，但不是 .NET。

我花了五个小时尝试将 PNG 文件添加到 .NET 3.5（Visual Studio 2010）中的“WPF 自定义控件库项目”并将其设置为图像继承控件的背景。

与 URI 相关的任何东西都不起作用。我无法想象为什么没有通过 IntelliSense 从资源文件中获取 URI 的方法，可能是：

```
Properties.Resources.ResourceManager.GetURI("my_image"); 
```

我尝试了很多 URI 并使用了 ResourceManager 和 Assembly 的 GetManifest 方法，但都有异常或 NULL 值。

在这里，我编写了对我有用的代码：

```
// Convert the image in resources to a Stream
Stream ms = new MemoryStream()
Properties.Resources.MyImage.Save(ms, ImageFormat.Png);

// Create a BitmapImage with the stream.
BitmapImage bitmap = new BitmapImage();
bitmap.BeginInit();
bitmap.StreamSource = ms;
bitmap.EndInit();

// Set as source
Source = bitmap; 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-04-11T08:14:43.723

如果你已经有一个流并且知道格式，你可以使用这样的东西：

```
static ImageSource PngStreamToImageSource (Stream pngStream) {
    var decoder = new PngBitmapDecoder(pngStream,
        BitmapCreateOptions.PreservePixelFormat, BitmapCacheOption.Default);
    return decoder.Frames[0];
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2015-04-11T08:57:54.693

你只是错过了一点。

要从任何程序集中获取嵌入式资源，您必须在文件名中提及程序集名称，正如我在这里提到的：

```
Assembly asm = Assembly.GetExecutingAssembly();
Stream iconStream = asm.GetManifestResourceStream(asm.GetName().Name + "." + "Desert.jpg");
BitmapImage bitmap = new BitmapImage();
bitmap.BeginInit();
bitmap.StreamSource = iconStream;
bitmap.EndInit();
image1.Source = bitmap; 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-10-11T19:36:03.660

如果您想在可执行文件旁边找到它（相对于可执行文件）

```
img.Source = new BitmapImage(new Uri(AppDomain.CurrentDomain.BaseDirectory + @"\Images\image.jpg", UriKind.Absolute)); 
```

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2021-06-28T17:59:43.900

强制选择 UriKind 将是正确的：

```
Image.Source = new BitmapImage(new Uri("Resources/processed.png", UriKind.Relative)); 
```

UriKind 选项：

```
UriKind.Relative // relative path
UriKind.Absolute // exactly path 
```

# java - 跨平台可执行/运行时交付方法

> ID：350036
> 
> 赞同：2
> 
> 时间：2008-12-08T16:16:46.113
> 
> 标签：java, flash, silverlight, cross-platform

我需要帮助来寻找最能满足以下要求的交付方式：

*   我们希望向我的客户提供一个文件。
*   客户端应该能够从操作系统外壳启动此文件 - 就像在 Windows 上运行“.exe”一样。
*   启动后，程序/脚本应该能够显示带有 HTML 内容的窗口。这可以使用独立程序、运行时或在浏览器中运行来完成。
*   我们需要能够在交付的文件中嵌入资源，例如 mp3 文件，稍后我可以通过编程方式提取该文件。
*   理想情况下，该解决方案应该在 Windows、Mac 和 Linux 机器上运行。不完美的跨平台互操作性是可以接受的，但我们希望尽可能广泛的渗透。
*   客户不需要预先安装任何东西（除非它是透明地完成的），预先配置任何东西，或者批准任何事情来实现这一点。

例如：

*   我们可以使用用 C++ 编写的常规可执行文件来执行此操作，但它不会是跨平台的。
*   我们可以使用 sliverlight XAP 文件、adobe Flex 文件或 Java JAR，但 Internet Explorer 在启动本地内容时会警告用户。此外，这些方法意味着我们的穿透力并不完美，即使在这些情况下它是可以接受的。
*   我们可以使用 python（或等效）脚本，但 python 解释器的安装基础（渗透）不够好。
*   使用标准 HTML 是不够的，因为在其中嵌入资源很困难。在 HTML 中嵌入 Silverlight XAML 或 uuencoded 内容会导致 IE 显示警告。
*   使用类似于 jpeg 的东西作为交付方法还不够丰富，因为我们需要显示 HTML。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T16:31:21.560

> *..但是当本地内容启动时，Internet Explorer 会警告用户。*

我不明白，IE 说“嘿，这个应用程序正在尝试运行*你的*文件！”有什么问题？

我并不是说你没有充分的理由，只是，我不明白。

IE 只会在应用程序尚未下载并尝试访问本地资源时警告用户，例如，如果从类似这样的小程序或 JNLP 运行[：（](http://java.sun.com/docs/books/tutorial/uiswing/components/filechooser.html)单击您看到的第一个橙色按钮）

但是，如果用户下载 jar 并从计算机上运行它（双击它），该应用程序是本地的并且可以毫无问题地运行。

jar 文件毕竟是一个 zip 文件，因此您可以附加您的 mp3 文件。所需平台支持双击，HTML 内容可以是本地文件（与 mp3 文件一起解压缩）或互联网网页。

Java 已经预装在这些操作系统上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T16:30:19.347

“当本地内容启动时，Internet Explorer 会警告用户”

这是有原因的。他们如何将你优秀、表现良好、礼貌的应用程序与病毒区分开来？

由于您的应用程序与病毒之间的界限非常非常模糊，因此请使用 Silverlight XAP 文件、adobe Flex 文件或 Java JAR 中的任何一个。

IE业务是好事，不是坏事。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T16:35:11.803

您可以尝试使用“Jetty”应用服务器。

这假设目标机器上有一个工作的 java 环境。

Jetty 是 java servlet 容器，但可以在单个可执行 jar 中配置所有内容（Web 服务器、html 模板、应用程序等），它会启动 Web 服务器并打开默认页面。

jar 文件的确切启动方式因平台而异，但用户界面将是相同的，并且作为一个 java 应用程序，您几乎可以执行它启动的任何操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T16:50:41.147

听起来[MIME HTML](http://en.wikipedia.org/wiki/MHTML)完全符合您的要求 - 不幸的是，除 IE 之外的许多浏览器都不支持它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T17:09:24.977

我会调查 Adob​​e AIR。它可以在桌面应用程序中显示 HTML 和 Flex 内容，而无需使用 Web 浏览器。但是，这将需要安装 AIR 运行时，我也不确定 Linux 版本是否已超出 beta 阶段。

[http://www.adobe.com/products/air/](http://www.adobe.com/products/air/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T17:25:58.690

您还可以为每个平台使用二进制文件。

根据您的描述，该应用程序非常简单，从一个 platf 移植到另一个听起来只是重新编译并提供基于 dist 的二进制文件的问题。

这是一个选项吗？

# linux - 如何指示 cron 每两周执行一次作业？

> ID：350047
> 
> 赞同：76
> 
> 时间：2008-12-08T16:18:40.853
> 
> 标签：linux, unix, cron, scheduling

我想通过 cron 运行一项作业，该作业将在每个星期二的给定时间执行。因为每个星期二都很容易：

```
0 6 * * Tue 
```

但是如何在“每个第二个星期二”（或者如果您愿意 - 每个第二周）做到这一点？我不想在它自己的脚本中实现任何逻辑，但只在 cron 中保留定义。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2013-10-09T17:21:37.453

## 回答

*修改您的周二 cron 逻辑以从 epoch 开始*每隔一周执行一次。

知道一周有 604800 秒（忽略 DST 变化和闰秒，谢谢），并使用 GNU 日期：

```
0 6 * * Tue expr `date +\%s` / 604800 \% 2 >/dev/null || /scripts/fortnightly.sh 
```

## 在旁边

日历算术令人沮丧。

@xahtep 的回答非常棒，但正如[@Doppelganger 在评论](https://stackoverflow.com/a/350061/132382)中指出的那样，它会在某些年份范围内失败。该[`date`](http://pubs.opengroup.org/onlinepubs/000095399/utilities/date.html)实用程序的“一年中的一周”说明符都无济于事。一月初的某个星期二不可避免地会重复上一年最后一个星期二的周平价：2016-01-05 (%V)、2018-01-02 (%U) 和 2019-01-01 (%W) .

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2008-12-08T16:25:55.363

怎么样，`crontab`即使在前五个字段中没有完全定义它，它也会保留它：

```
0 6 * * Tue expr `date +\%W` \% 2 > /dev/null || /scripts/fortnightly.sh 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2015-10-20T04:22:08.410

[pilcrow的回答](https://stackoverflow.com/a/19278657/132382)很棒。但是，它会导致 fortnightly.sh 脚本每*偶数*周运行一次（自纪元以来）。如果您需要脚本在*奇数*周运行，您可以稍微调整他的答案：

```
0 6 * * Tue expr \( `date +\%s` / 604800 + 1 \) \% 2 > /dev/null || /scripts/fortnightly.sh 
```

将 1 更改为 0 会将其移回偶数周。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-10-09T15:50:45.053

也许有点笨，但也可以创建两个 cronjobs，每个第一个星期二一个，每个第三个星期二一个。

第一个cronjob：

```
0 0 8 ? 1/1 TUE#1 * 
```

第二个cronjob：

```
0 0 8 ? 1/1 TUE#3 * 
```

不确定这里的语法，我使用[http://www.cronmaker.com/](http://www.cronmaker.com/)来制作这些。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2021-06-30T09:11:40.110

就像是

```
0 0 1-7,15-21 * 2 
```

将在本月的第一个和第三个星期二。

注意：不要将它与 vixie cron（包含在 RedHat 和 SLES 发行版中）一起使用，因为它会在日期和星期几字段之间生成一个或，而不是一个和。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-11-15T19:20:10.890

如果您想根据给定的开始日期执行此操作：

```
0 6 * * 1 expr \( `date +\%s` / 86400 - `date --date='2018-03-19' +\%s` / 86400 \) \% 14 == 0 > /dev/null && /scripts/fortnightly.sh 
```

应该从 2018-03-19 开始每隔一个星期一触发一次

表达式为：如果...，则在星期一早上 6 点运行

1 - 获取今天的日期，以秒为单位，除以一天中的秒数以转换为天数

2 - 对开始日期执行相同操作，将其转换为自纪元以来的天数

3 - 获取两者之间的差异

4 - 除以 14 并检查余数

5- 如果余数为零，则您处于两周周期

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-12-21T05:19:13.450

### 我发现上述方法的一些额外限制在某些极端情况下可能会失败。例如，考虑：

> @xahtep 和 @Doppelganger 讨论了使用`%W`上述特定年份界限的问题。
> 
> @pilcrow 的答案在某种程度上解决了这个问题，但它也会在某些边界上失败。此主题和/或其他相关主题的答案使用一天中的秒数（与一周相比），出于相同的原因，这在某些边界上也会失败。

这是因为这些方法依赖于 UTC 时间（日期 +%s）。考虑一个案例，我们在每个第二个星期二的凌晨 1 点和晚上 10 点运行一项工作。

假设 GMT-2：

*   当地时间凌晨 1 点 = UTC**昨天晚上 11 点**
*   当地时间晚上 10 点 =**今天UTC 晚上 8 点**

如果我们每天只检查一次，这不是问题，但如果我们检查多次——或者如果我们接近 UTC 时间并且发生夏令时，脚本不会认为这些是同一天。

为了解决这个问题，我们需要根据我们的*本地*时区而不是 UTC 计算与 UTC 的偏移量。我在 BASH 中找不到简单的方法来执行此操作，因此我开发了一种解决方案，该解决方案使用 Perl 中的快速单行来计算与 UTC 的偏移量（以秒为单位）。

这个脚本利用了 date +%z，它输出本地时区。

### bash 脚本：

```
TZ_OFFSET=$( date +%z | perl -ne '$_ =~ /([+-])(\d{2})(\d{2})/; print eval($1."60**2") * ($2 + $3/60);' )
DAY_PARITY=$(( ( `date +%s` + ${TZ_OFFSET} ) / 86400 % 2 )) 
```

然后，确定这一天是偶数还是奇数：

```
if [ ${DAY_PARITY} -eq 1 ]; then
...
else
...
fi 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-08-26T23:03:49.217

这里有很多很好的答案。根据评论，我看到了相当多的困惑和沮丧。我对这个答案的意图不仅是回答 OPs 问题[如何指示 cron 每两周执行一次作业？](https://stackoverflow.com/questions/350047/how-to-instruct-cron-to-execute-a-job-every-second-week)，但也为将来可能会阅读此内容的人们消除了一些困惑。

**TL;DR：**
crontab 条目如下所示：

```
\<minute\> \<hour\> * * \<Day of Week\> expr \\( $( date+\\%s ) \\/ 604800 \\% 2 \\) > /dev/null && \<command to run on odd weeks\> || \<command to run on even weeks\> 
```

**Crontab 条目：**
所有 crontab 条目 [使用`crontab -e`] 都具有以下格式，根据手册页：
1：执行 [command] 的分钟
范围：0-59
2：一天中执行 [command] 的时间
范围： 0-23 3：执行 [command] 的
日期 范围：1-31
4：执行 [command] 的月份
范围：1-12
5：执行 [command] 的星期几
范围：检查你的人page，可以是 0-6、1-7 或 0-7
6：执行命令
注意，还有 @ 值，这里不再讨论。

*nix 的某些版本允许表达式：
`*/2`= 范围内的
`1 + */2`每个偶数 = 范围内的每个奇数
`1,15`= 第一个和第 15 个
`2-8`= 第二个到第八个（包括）

一些版本也允许人类可读的单词，例如二月或星期三。

对于月份，*/2 将在 2 月、4 月、6 月、8 月、10 月、12 月执行。

对于星期几，*/2 将在偶数日运行——查看你的手册页以查看星期几是如何编号的。Tue/2 不是一个有效的表达式。

**人类可读（日历）**
问题 您需要知道的一些常数：一年
有 365.2464*天*（为方便起见，我们将四舍五入为 365）。
一年有12*个月*。
一周有7*天*。
一天有 86,400*秒*。

因此，
1个月是4-1/3周
[即3个月是13周]
1年是52-1/7周

*日历数学的祸根：*
半月 = 每半个月 = 2x/月 = 每年 24 次。
双周 = 每隔一周（两周一次） = 每年 26 次。
注意：这些术语经常被误用。
有些年份有 51 周，有些年份有 53 周，大多数有 52 周。如果我的 cron 每隔奇数周运行一次（`date +%W`模式 2），而这一年有 51 或 53 周，它也会在下一周运行，即新的第 1 周年。相反，如果我的 cron 每偶数周运行一次，它将跳过 2 周。不是我想要的。

CRON 可以支持半月，不支持双周！半月：每月
的第一天总是在 1 号和 7 号之间。下半周总是发生在 15 日和 21 日之间。
Semi-monthly 将​​有 2 个值，一个在上半月，另一个在下半月。如：
`2,16`

**Unix 时间**
在非常高的级别上，*nix 时间是 2 个值：
`date +%s`= 自 Epoch (01/01/1970 00:00:00) 以来的秒数
`date +%N`= 小数秒（以纳秒为单位）
因此，*nix 中的时间是`date +%s.%N`

*Nix 使用纪元时间。/etc/shadow 文件包含上次更改密码的日期。它是 %s 除以 86,400 的整数部分。

**Factino**
GPS 卫星将时间测量为“自纪元时间以来的周数”和“一周内的（小数）秒。
注意：纪元周与年份无关。一年有 51、52 ​​或 53 周并不重要。纪元周永不翻转。

***Nix date +%W 中的双周时间算法是***一年*
中的周数，而不是纪元周。*nix 没有纪元周值，但可以计算。 Epoch Week = Integer( Epoch Seconds / Seconds_per_Day / Days_per_Week ) Fortnightly = Epoch_Week Modulo 2 Fortnightly 的值将始终为 0 或 1，因此，当 Fortnightly = 0 在每个偶数周运行时运行命令，1 = 每个奇数周运行。

 ***每两周计算一次）**
第一种方式（bc）：
`date +"%s / 604800 % 2" | bc`
这将生成“[Epoch Seconds] / 604800 % 2”
然后将答案发送到基本计算器 bc，它会进行数学运算并将答案回显到 STDOUT 和任何错误到 STDERR .
返回码为 0。

第二种方式（expr）：
在这种情况下，将表达式发送到 expr 并让它进行数学运算 `expr $( date +%s ) / 604800 % 2`
expr 命令进行数学运算，将答案回显到 STDOUT，错误到 STDERR。如果答案为0，则返回码为1，否则返回码为0。
这样，我不关心答案是什么，只关心返回码。考虑一下：

```
$ expr 1 % 2 && echo Odd || echo Even
1
Odd 
$ expr 2 % 2 && echo Odd || echo Even 
0 
Even 
```

由于结果无关紧要，我可以将 STDOUT 重定向到 /dev/null。在这种情况下，我会离开 STDERR，以防发生意外情况，我会看到错误消息。

**Crontab 条目**
在 crontab 中，百分号和括号有特殊的含义，所以需要用反斜杠 (\) 进行转义。
首先，我需要决定是要在偶数周还是奇数周运行。或者，也许，在奇数周运行 Command_O，在偶数周运行 command_E。然后，我需要转义所有特殊字符。
由于 expr 仅评估 WEEKS，因此有必要指定一周中的特定日期（和时间）进行评估，例如每周二下午 3:15。因此，我的 crontab 条目的前 5 个文件（时间条目）将是：
`15 3 * * TUE`
我的 cron 命令的第一部分将是 expr 命令，STDOUT 发送为 null：

```
expr \\( $( date+\\%s ) \\/ 604800 \\% 2 \\) > /dev/null 
```

第二部分将是评估器，`&&`或者`||`
第三部分将是我要运行的命令（或脚本）。看起来像这样：

```
expr \\( $( date+\\%s ) \\/ 604800 \\% 2 \\) > /dev/null && \<command_O\> || \<command_E\> 
```

希望这将澄清一些混乱

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-06-30T09:25:28.133

试试这个

```
0 0 1-7,15-21 * 2 
```

每月运行 2 次，在星期二和至少相隔一周。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2016-11-23T12:43:26.170

如果您只想要第二周的每个星期二：

00 06 * * 2#2

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2013-05-06T08:47:32.923

语法“/2”不符合工作日。所以我添加到上面的智能只是在 MonthDay 提交时使用 1,15。

0 6 1,15 * * /scripts/fornightly.sh > /dev/null 2>&1

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2020-02-07T00:15:41.247

0 0 */14 * *

每月第 14 天 00:00 运行

* * *

## 回答 #13

> 赞同：-4
> 
> 时间：2013-02-22T11:11:56.840

Cron 提供了“每隔一个”语法“/2”。只需在适当的时间单位字段后面加上“/2”，它将“每隔一次”执行 cronjob。在你的情况...

```
0 6 * * Tue/2 
```

以上应该每隔一个星期二执行一次。

* * *

## 回答 #14

> 赞同：-4
> 
> 时间：2013-11-26T19:59:16.697

为什么不喜欢

```
0 0 1-7,15-21,29-31 * 5 
```

这合适吗？

# .net - 您如何在托管 C++ 中处理 IDisposable？

> ID：350052
> 
> 赞同：21
> 
> 时间：2008-12-08T16:21:23.670
> 
> 标签：.net, idisposable, managed-c++

我正在尝试在托管 C++（.NET 2.0）中处理 IDisposable 对象（FileStream^ fs）并收到错误消息

> Dispose' : 不是 'System::IO::FileStream 的成员

它说我应该调用析构函数。会打电话

```
fs->~FileStream(); 
```

调用 FileStream 对象的 dispose 方法？为什么我不能调用 Dispose？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-08T16:29:36.290

正确的模式是只删除对象：

```
delete fs; 
```

这将被转换为对 Dispose() 的调用。

有关幕后发生的事情的一些细节，请参阅[这篇文章。](http://dotnetdebug.net/2005/08/22/managed-c-destructor/)这个成语的好处是它允许你写：

```
{
  FileStream fs(...)
  ...
} 
```

并正确调用 Dispose 方法......相当于 C# 中的 using 块。文件流对象仍分配在托管堆上。

# php - PHP 框架 - 它们只是个人喜好吗？

> ID：350053
> 
> 赞同：6
> 
> 时间：2008-12-08T16:22:41.110
> 
> 标签：php, frameworks, preferences

我是 PHP 框架领域的新手，经过初步调查，我提出了以下流行选择列表：

*   CakePHP
*   代码点火器
*   Symfony
*   曾德

我尽量不重复“哪个最好？” 问题，这似乎只是个人喜好。是这样吗？一个真的比另一个“更好”吗？各自的优势和劣势是什么？

如果问题太宽泛，我深表歉意，但任何澄清将不胜感激。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-08T16:30:57.193

框架的问题在于它们是完美的，以至于你需要它们来做一些它们不适合做的事情。

除了 Zend 之外，我已经使用过您列出的所有主要 PHP 框架，这是我可以快速告诉您的：

*   CakePHP 强制执行 OOP，让您快速启动和运行，拥有一个很棒的社区和相对较好的文档，包含您期望的所有功能。

*   CodeIgniter 为您提供前三个中最大的空间。不完全强制执行 OOP，它由您决定。三者中最容易实现和分发的。很棒的社区，他们使文档与新版本保持同步。我喜欢把它看作是你想做的任何事情的完美骨架，你想怎么做。此外，三者中最快的。

*   Symfony 毫无疑问是三者中最强大且最接近 RoR 的。期望必须学习 PEAR 并有权访问远程服务器上的 SSH。非常慢，如果您想开发大型应用程序，我不建议在共享主机上使用它。它确实强制执行了一些奇怪的做法，并且您会在视图中看到比您特别喜欢的更多的 PHP，但是它有一个工具可以帮助您开始为每个问题寻找解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-11T03:49:21.890

当我正在寻找一个在共享托管环境中运行良好的 PHP 框架时，我偶然发现了这个（旧）问题；速度很重要，因为在共享主机中 CPU 时间是最严格的限制。

# java - Java 等价于 std::deque

> ID：350063
> 
> 赞同：13
> 
> 时间：2008-12-08T16:26:35.330
> 
> 标签：java, collections, deque

我是来自 C++/STL 的相对较新的 Java 程序员，我正在寻找具有这些特征的类（据我了解，C++ std::deque 具有）：

1.  O(1) 在开头/结尾插入/删除的性能
2.  按索引查找的 O(1) 性能
3.  是可增长的集合（不需要固定大小的界限）

有与此等效的Java吗？我发现 Java 1.6 [ArrayDeque] 类具有插入/删除和可增长的特性，但似乎没有按索引查找，除非您调用不会为 O(1) 的 toArray()。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-08T16:35:52.643

Java 的原始集合有一个带有 get(int idx) 方法的 ArrayDeque。

[http://sourceforge.net/projects/pcj](http://sourceforge.net/projects/pcj)

我不能保证这个项目的质量。

另一种方法是获取 JDK ArrayDeque 源并自己添加 get(int idx) 方法。应该比较容易。

编辑：如果您打算以高度多线程的方式使用双端队列，我会选择“修补 JDK 的 ArrayDeque”路线。此实现已经过彻底测试，并在新的 java.util.concurrent ForkJoin 框架中使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T17:11:00.997

我的默认方法是将我自己的类组合在一起，将 ArrayList 作为底层实现（例如，将我自己的类的索引映射到 ArrayList 索引）......但我讨厌重新发明轮子，尤其是当很有可能搞砸时......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T21:06:51.340

有趣...我刚读完[*Java 泛型和集合*](http://books.google.com/books?id=3keGb40PWJsC&pg=PA226a)，它简要讨论了这种集合，包括指向[Java 专家时事通讯](http://www.javaspecialists.co.za/archive/Issue027.html)的链接，其中包括一个 CircularArrayList，它可能满足我的需要。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-07-14T17:44:46.743

这是一个用[Java 实现的即用型循环缓冲区 CircularArrayList](http://www.du-preez.com/2011/software-development/circulararraylist-for-java)。但是，它在创建后不可增长。（*免责声明：此链接指向我自己的网站*）

网上流传的另一种选择是[来自 Java 专家时事通讯的](http://www.javaspecialists.co.za/archive/Issue027.html)选择。我从来没有用过那个，原因如下：

1.  它不完整 - （“此方法留给读者作为练习”）
2.  它不支持与 Java 集合框架中的其他集合一致的通用元素类型。
3.  它不必要地复杂，因此可能有错误，而不是遵循 AbstractList 的 Javadoc 推荐的扩展过程。

# authentication - IIS 匿名用户身份验证不适用于 AD 凭据

> ID：350065
> 
> 赞同：4
> 
> 时间：2008-12-08T16:26:56.187
> 
> 标签：authentication, iis, active-directory, anonymous

我有一个 asp.net 应用程序目录，我想在 Directory Sercurity 选项卡中使用匿名身份验证。

如果我使用 Windows 2000 之前的样式 DOMAIN\USERNAME 作为用户名，一切都很好。

如果我使用 AD 样式 (UPN) usename@domain.local，则会收到 401.1 登录失败。

我尝试了许多变体，但无法使其正常工作。如果我从“浏览”框中选择用户，则 AD 名称会出现在框中，但会填写 Windows 2000 之前的名称。对于 SQL Server 2005 也是如此。

似乎 UPN 不是“真实的”，对吗？鉴于它不是必需的，也不必是唯一的；这似乎很奇怪。

我是对的吗，因为这不受支持？IIS 7 会有什么不同吗？

我希望这样做，因为 Windows 2000 之前的用户名的 20 个字符的限制不足以实现基于角色的安全性，我希望申请来自该网站的不同 Web 服务（应用程序目录）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-23T05:07:27.530

UPN 后缀应该可以工作，尽管 IIS 框和域控制器之间存在服务包差异时会出现错误。有一个补丁。这个[链接](http://forums.iis.net/p/1149978/1872165.aspx)详细讨论了这个问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T14:01:23.780

您确定它是 domain.local 而不是 domain.com。如果域\用户名有效，则 username@domain.com 应该有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T22:38:46.483

**更新 1：** 我在 Windows 2003 sp 2 上尝试过。在登录“目录安全”中，我选中了启用匿名访问复选框（并且只有这个框）并输入 ausername@mydomain.com 和 ausername 密码。该站点是纯 asp.net，没有 sql 后端。

您可以使用 usename@domain.local 登录服务器吗？你能在不同的域上测试这个吗？这可能是一些有线 dns 解析问题。

**更新0：**

我在 iis 6 上对其进行了测试，并且 username@domain.com 组合在我的机器上运行良好。

关于名称的“真实性”。没有名称是“真实的”，实际帐户只是一个 GUID。这些名称只是为了方便。

# iphone - 如何在 iPhone 上的指定时间运行应用程序？

> ID：350067
> 
> 赞同：2
> 
> 时间：2008-12-08T16:27:59.867
> 
> 标签：iphone, scheduled-tasks

我正在开发一个待办事项列表应用程序。我正在寻找任何方法在任务到期时提醒用户，即使应用程序没有运行。有没有办法将程序设置为在指定时间运行而无需用户交互？或者无论如何都可以发出警报？

**编辑：**如何将项目添加到日历？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-08T16:30:49.113

不，直到[推送通知服务](http://www.engadget.com/2008/06/09/iphone-push-notification-service-for-devs-announced/)发布。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-08T16:32:26.783

您现在最好的选择是允许用户向日历添加提醒 - 如果没有推送服务，则没有您的应用程序运行时没有通知。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T19:22:39.483

正如史蒂夫乔布斯本人非常清楚的那样，iPhone SDK 将不支持后台进程。此外，没有 API 可以访问 iPhone 上的日历。

如果这些事情对您很重要，您应该提交增强请求： [Apple Bug Reporter](http://bugreporter.apple.com)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T16:36:23.623

但即使推送发布后，您也无法让应用程序独立提醒用户。您必须运行一个服务器，以便在任务接近到期时向人们推送通知，这意味着您必须将每个人的任务列表同步到您的服务器。

# sql - 如何从 UDF 参数提供 SELECT 语句的 FROM 子句

> ID：350081
> 
> 赞同：1
> 
> 时间：2008-12-08T16:30:36.430
> 
> 标签：sql, sql-server, user-defined-functions

在我正在移植到 Web 的应用程序中，我们目前在运行时根据指定的“模板”字符串在运行时动态访问不同的表。既然我们正在迁移到 SQL 服务器，我想将执行此操作的负担移回数据库，因此我不必弄乱动态 GridView。我想编写一个表值 UDF，其中一个参数用于表名，一个用于查询 WHERE 子句。

我为我的 UDF 输入了以下内容，但显然它不起作用。有没有办法获取某种类型的 varchar 或字符串并获得可以在 FROM 子句中工作的表引用？

```
CREATE FUNCTION TemplateSelector 
(   
@template varchar(40),
@code varchar(80)
)
RETURNS TABLE 
AS
RETURN 
(
SELECT * FROM @template WHERE ProductionCode = @code
) 
```

或获得与此概念类似的结果集的其他方式。基本上表中的所有记录都由 varchar @template 与 @code 的匹配 ProductionCode 指示。

我收到错误“必须声明表变量“@template””，因此 SQL 服务器可能是我试图从表变量中选择的东西。

编辑时：是的，我不需要在函数中执行此操作，我可以运行存储过程，我只是之前没有编写过它们中的任何一个。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T16:37:23.903

```
CREATE PROCEDURE TemplateSelector 
(   
    @template varchar(40),
    @code varchar(80)
)

AS
EXEC('SELECT * FROM ' + @template + ' WHERE ProductionCode = ' + @code) 
```

这有效，尽管它不是 UDF。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T16:36:56.137

执行此操作的唯一方法是使用 exec 命令。

此外，您必须将其移出存储过程而不是函数。显然函数不能执行动态sql。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T16:43:30.490

唯一可行的方法是使用动态 SQL，但是，函数中的 SqlServer 不支持动态 SQL。

很抱歉，我很确定不可能在函数中执行此操作。

如果您正在使用存储过程，那将是可能的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T17:14:57.010

此外，应该注意的是，替换查询中的表名，破坏了 SQL Server 缓存查询执行计划的能力。这几乎将使用 UDF 或 SP 的优势降低到零。您不妨直接调用 SQL 查询。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T17:33:24.133

我希望能够处理的表数量有限，因此我可以使用 IF 编写一些东西，测试 @template 是否与多个值匹配，并为每个匹配运行

```
SELECT * FROM TEMPLATENAME WHERE ProductionCode = @code 
```

听起来这是一个更好的选择

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T17:59:08.683

如果您有许多具有相同结构的表，这通常意味着您没有以正常形式设计数据库。您应该将这些统一到一张表中。您可能需要为该表多提供一个属性列来区分数据集。

# dos - DOS系统路径

> ID：350095
> 
> 赞同：4
> 
> 时间：2008-12-08T16:34:06.983
> 
> 标签：dos, cmd

有没有办法通过批处理文件（或powershell脚本）以编程方式将所有文件夹`c:\Program Files`放入系统变量中`PATH`？我依赖于命令行，真的想从命令行启动一个程序。

是的，我嫉妒 Linux shell。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-08T16:46:32.060

将“C:\Program Files”作为参数传入此批处理文件：

```
@echo off

FOR /D %%G IN (%1\*) DO PATH "%%G";%path% 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-08T17:35:44.113

Doing this is very likely to break your computer, in the sense of invoking DLL Hell. As you invoke each executable, the OS will look through each directory in `PATH` to find each DLL or even EXE referenced by that executable. It becomes highly likely that the OS will find the wrong ones as you add more directories to the `PATH`.

So, a best practice is to avoid increasing the `PATH`, and even to decrease it. Rather than implicit dependencies, make them explicit.

Instead, I recommend this approach:

1.  Create a `bin` directory within your user home directory
2.  Add that `bin` directory to your user `PATH` variable
3.  Create a Windows CMD script in the `bin` directory for each application that you want to invoke from the command line (same name as the executable that you would type)
4.  In each script, invoke `SetLocal`, add the application's install directory (under `%ProgramFiles%`) to the `PATH`, then invoke the executable with the arguments from the command line
5.  Remove the relevant directory from the `PATH`, so that this script becomes the only way to invoke the executable

# asp.net - 服务器控制和视图状态

> ID：350101
> 
> 赞同：1
> 
> 时间：2008-12-08T16:35:15.560
> 
> 标签：asp.net, webforms, servercontrols

好吧，是时候展示我对所有 Web 表单的知识完全缺乏了，但是就到这里吧。我正在扩展 Panel 控件和 OnPreRender 在其中粘贴一些其他控件（为简单起见，我们只说 1 个文本框）。从这里我只是让 Panels Render 方法做它的事情。

我遇到的问题是，显然每次重新呈现此控件时，它只是将相同的 TextBox 再次粘贴在面板中，并使用我在 OnPreRender 方法中编码的值。现在我实际上不想每次都重新填充面板，

我想在第一次加载时将文本框控件粘贴在那里，并让它们从控件/视图状态缓存中重新加载。在这种情况下，以我在面板中仅粘贴单个文本框的示例为例，如果文本框的值发生更改并且发生回发，我希望该值保持更改后的值。

我知道的非常基本的网络表单东西，但我从来没有在我的时间里创建自定义控件。任何帮助表示赞赏。

克里斯。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T16:51:44.997

您需要在 OnInit 中（重新）创建子控件（文本框） - 以便在调用 LoadViewState 和 ProcessPostBackData 时它就在那里。

有关详细信息，请参阅[服务器控制生命周期](http://www.digcode.com/default.aspx?page=ed51cde3-d979-4daf-afae-fa6192562ea9&article=d3ba7954-6235-446f-9801-584539cbb6bf)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T16:49:28.527

ASP.NET 中的动态控件很棘手，尤其是当您不熟悉 Web 表单和页面生命周期时。如果您可以避免动态控制，请这样做。改用 controlName.Visible=false 和其他技巧。

如果你一定要读[这篇文章](http://aspnet.4guysfromrolla.com/articles/092904-1.aspx)。经验法则，在页面生命周期的早期添加控件，在页面生命周期的后期引用它们。PreRender 几乎是最后，一个不常见的添加和使用控件的地方。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T17:11:46.097

不确定这是否适用于 .Net 的所有版本（我认为是 2.0 或更高版本），但有一个名为 CreateChildControls 的方法实际上并不是生命周期的一部分，它基本上在任何时候调用 EnsureChildControls 方法。默认情况下，如果它不是回发，它会在 PreRender 之前调用。所以基本上你的代码看起来像这样：

```
public class SomeControl : WebControl, INamingContainer
{
  private TextBox someTextBox;

  protected override void CreateChildControls()
  {
    base.CreateChildControls();

    someTextBox= new TextBox();
    someTextBox.ID = "tbxMain";

    Controls.Add(textboxToCheck);
  }
} 
```

现在不应该的部分是，除非您调用 EnsureChildControls，否则在 ViewState 负载填充控件上的公共属性之前，您不能 100% 确定控件存在。这是什么意思？好吧，取之前的代码并为 CssClass 添加一个属性：

```
public class SomeControl : WebControl, INamingContainer
{
  private TextBox someTextBox;

  protected override void CreateChildControls()
  {
    base.CreateChildControls();

    someTextBox= new TextBox();
    someTextBox.ID = "tbxMain";

    Controls.Add(textboxToCheck);
  }

  public String CssClass { get; set; }
} 
```

在 CreateChildControls 你不会想要这个：

```
someTextBox.CssClass = CssClass; 
```

由于尚无法确定控件是否存在。有几种方法可以处理这个问题：

公共字符串 CssClass { 获取 { EnsureChildControls(); 返回一些Textbox.CssClass；}

```
 set
 { 
   EnsureChildControls();
   someTextbox.CssClass = value;
 } 
```

在此示例中，我正在调用 EnsureChildControls（假设您在 CreateChildControls 方法中的文本框上设置 CssValue）并从文本框中设置或获取。

另一种方法是将依赖于控件公共属性的任何内容放在 OnPreRender 方法中：

```
protected override void OnPreRender(EventArgs e)
{
  someTextbox.CssClass = CssClass;
} 
```

从而避免了在 ViewState 加载期间担心属性已经被填充的混乱。

一注：

INamingContainer 的使用可能很重要。基本上，所做的只是确保父控件上的控件具有在页面上唯一的 id，方法是将父控件的名称（可能更多）应用于 id。基本上，如果父 ID 是 Parent 而子控件 ID 是 Child，则 ID 可能会显示为 Parent_Child。这将解决 ViewState 无法正确填充属性或根本不填充属性的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T16:48:43.740

在您的代码中，如果您需要视图状态的服务，您将需要管理视图状态信息的恢复。

这里的一个很好的例子是Microsoft 的[View State 示例](http://msdn.microsoft.com/en-us/library/1whwt1k7.aspx)。代码示例中还引用了其他一些项目，但它应该能让您走上正确的道路。

# vb.net - 如何在 VB.NET 中动态调用委托链

> ID：350120
> 
> 赞同：1
> 
> 时间：2008-12-08T16:45:57.117
> 
> 标签：vb.net, delegates

有人知道是否可以动态创建调用链并调用它？

假设我有两个 A 类和 B 类：

```
public class A
    public function Func() as B
        return new B()
    end function
end class

public class B
   public function Name() as string
      return "a string";
   end function
end class 
```

我希望能够同时获取Func *()*和*Name()的**MethodInfo*并动态调用它们，以便我可以获得类似于*A.Func().Name()*的调用。

 ***我知道我可以使用*Delegate.CreateDelegate*创建可以从两个*MethodInfo*对象调用的委托，但这样我只能分别调用这两个函数，而不是作为调用链的一部分。

我想要两个使用表达式树的 .NET 3.5 解决方案，如果可能的话，还有一个与 .NET 2.0 兼容的解决方案

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T17:04:05.597

您使用的是 .NET 3.5 吗？如果是这样，构建一个表达式树来表示它应该相对简单。我没有足够的 expression-tree-fu 在没有打开 VS 的情况下轻松编写相关树，但是如果您确认这是一个选项，我将开始在记事本中工作（来自我的 Eee ......因此缺少 VS ）。

编辑：好的，作为表达式树，您需要类似（C# 代码，但我相信您可以翻译）：

```
// I assume you've already got fMethodInfo and nameMethodInfo.
Expression fCall = Expression.Call(null, fMethodInfo);
Expression nameCall = Expression.Call(fCall, nameMethodInfo);
Expression<Func<string>> lambda = Expression.Lambda<Func<string>>(nameCall, null);
Func<string> compiled = lambda.Compile(); 
```

这是未经测试的，但我认为它应该工作......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T09:21:47.433

您不需要在第一个表达式之前添加此行：

```
Expression ctorCall = Expression.Constructor(A) 
```

并在创建 fCall 时将该表达式作为第一个参数传递

否则我们会错过链的起点，并且在运行代码时会出现异常

# exchange-server - 使用带有 C++ 的 MAPI，我如何打开另一个用户的收件箱？

> ID：350124
> 
> 赞同：1
> 
> 时间：2008-12-08T16:48:22.150
> 
> 标签：exchange-server, mapi

我希望编写一个自动监控脚本，以编程方式从另一个用户的 Exchange 2003 收件箱中检索信息。我有工作的 C++ 代码来登录 MAPI 并连接到我自己的收件箱。我还可以使用控制面板->邮件小程序将另一个用户的邮箱配置到我的个人资料中，我的代码可以通过这种方式访问​​。但是，这是在我安装了 Outlook 的桌面上完成的，它提供了更丰富的邮件配置文件编辑器。

由于这将在服务器上运行，我宁愿根本不安装 Outlook。相反，我可以安装[MAPI 客户端](http://www.microsoft.com/downloads/details.aspx?familyid=E17E7F31-079A-43A9-BFF2-0A110307611E&displaylang=en)。`MAPILogonEx()`然后，我创建了一个简单的 MAPI 应用程序，它使用`MAPI_LOGON_UI`标志弹出邮件配置文件向导。但是，基本 MAPI 客户端不具备配置其他用户邮箱的功能。作为要求，我只能将这个脚本作为监控应用程序的服务帐户运行，所以我不能告诉它作为我想要的邮箱的帐户运行。

是否仍然可以使用基本 MAPI 客户端连接到另一个用户的邮箱（假设已授予权限）？或者是否绝对有必要为此功能安装 Outlook？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-11T22:17:03.887

我强烈建议使用 Microsoft Exchange MAPI 客户端（如您所链接的那样）。它被设计为比这些库的 Outlook 版本更强大。您应该会发现在扩展 MAPI 方面，Outlook 和 Exchange Server 之间的 API 没有什么不同。

您将需要使用扩展 MAPI（如 Cain TS Random 所述）来打开其他邮件存储，当然您的应用程序需要在 Exchange 服务器上以具有适当权限的 Windows 用户身份登录。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T19:33:43.547

我明白了......我不确定如何明确地做到这一点；`CreateStoreEntryID`这通常是使用错误标志调用的副作用。你想要做的可能是：

1.  `IID_IExchangeManageStore`从您的默认消息存储中获取
2.  称呼`CreateStoreEntryID`
3.  然后通过入口ID打开那个商店

    ```
    LPEXCHANGEMANAGESTORE mapiObject = NULL;

    store->QueryInterface( IID_IExchangeManageStore, (LPVOID *) &mapiObject);

    mapiObject->CreateStoreEntryID( server, mailbox, OPENSTORE_TAKE_OWNERSHIP | 
        OPENSTORE_USE_ADMIN_PRIVILEGE, &len, &buffer);

    //Call OpenEntry on the entry id 
    ```

如果需要更详细的示例，请在 MFC MAPI 项目的源代码中搜索`CreateStoreEntryID`. 如果您还有其他问题，最好的回答是`microsoft.public.win32.programmer.messaging`新闻组。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T18:17:23.513

您是否查看过 ConfigureMsgService？我相信这适用于 Exchange MAPI，或者您是说您尝试过但没有用？

# c# - LINQ 查询返回多个结果

> ID：350126
> 
> 赞同：1
> 
> 时间：2008-12-08T16:48:42.540
> 
> 标签：c#, asp.net, linq, sql-server-2000

我正在尝试编写一个文本框，它将在 5 个 DB 列上进行搜索，并将返回给定搜索的每个结果，例如。“红”会返回：红球、红威廉姆斯等。人们尝试过的任何例子或类似的东西。我的搜索示例代码。

谢谢。

```
 ItemMasterDataContext db = new ItemMasterDataContext();

    string s = txtSearch.Text.Trim();
    var q = from p in db.ITMSTs
            where p.IMITD1.Contains(s) ||
             p.IMITD2.Contains(s) ||
             p.IMMFNO.Contains(s) ||
             p.IMITNO.Contains(s) ||
             p.IMVNNO.Contains(s)
            select p;

    lv.DataSource = q;
    lv.DataBind(); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T17:08:11.313

您的示例中的“q”将是`IQueryable<ITMST>`. 我不认为 WebControl 的 Datasource 属性知道如何处理它。尝试将该行写为：

```
 lv.DataSource = q.ToList(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T19:05:23.213

你所拥有的通常是人们使用 linq 会做的事情。如果您想变得更复杂并使用数据库通配符，请查看 System.Data.Linq 中的 SqlMethods 类。

@James Curran 您可以分配 DataSource 属性 q ，它会正常工作。唯一不同的是查询何时被执行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T19:44:33.743

你可以做这样的事情（语法可能是关闭的）

```
using(var db = new ItemMasterDataContext())
{
    var s = txtSearch.Text.Trim();
    var result = from p in db.ITMSTs select p;

    if( result.Any(p=>p.IMITD1.Contains(s))
         lv.DataSource = result.Where(p=>p.IMITD1.Contains(s))
    else if ( result.Any(p=>p.IMITD2.Contains(s))
        lv.DataSource = result.Where(p=>p.IMITD1.Contains(s))

    lv.DataBind();
} 
```

或者您可能想使用此[链接](http://msdn.microsoft.com/en-us/library/bb345073.aspx)或MSDN 中的此[链接](http://msdn.microsoft.com/en-us/library/system.linq.expressions.expression.orelse.aspx)。

编码快乐！！

# iphone - iPhone是“cron-able”吗？

> ID：350128
> 
> 赞同：3
> 
> 时间：2008-12-08T16:48:47.907
> 
> 标签：iphone, cron, scheduling

注意 - 我还没有深入研究 Apple 的 iPhone SDK。

但是，基于最近提出的另一个[问题](https://stackoverflow.com/questions/350067/how-can-i-run-an-app-at-a-specified-time-on-the-iphone)，我想知道如果 iPhone 没有 crontab 功能，它是否正在运行一些精简版的 Mac OS X。

如果是这样，您将如何访问它？

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-08T18:26:23.013

iPhone 确实运行 cron - 但您将无法在仅使用 SDK 开发的任何应用程序中使用它。绝对不支持通过警报或计时器（例如 crontab）的后台进程或后台启动。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-08T16:50:41.600

似乎 cron 默认在 iPhone 上运行，您只需要能够编辑 crontab 文件——~~无论~~是 root文件~~还是用户~~文件，但显然不是用户文件。

睡眠和 cron 存在问题，但在该链接上有很好的讨论。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-09-21T19:58:20.490

看来 iPhone 不再运行 crons 也没有 crontab（2012，iPhone 4s 越狱，iOS 5.01）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-07-31T16:08:33.327

您不能在未越狱的 iPhone 上使用 cron。

也许您可以利用推送通知服务：让 cron（或其他调度程序）在另一台机器上运行，在适当的时间向手机发送通知。

# php - 如何检查是否已经分配了 Smarty 变量？

> ID：350129
> 
> 赞同：8
> 
> 时间：2008-12-08T16:48:49.670
> 
> 标签：php, smarty, template-engine

如何检查是否已将特定值分配给 Smarty，如果未分配（默认）值？

回答：

```
if ($this->cismarty->get_template_vars('test') === null) {
   $this->cismarty->assign('test', 'Default value');
} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-08T16:59:14.577

**聪明的 2**

```
if ($smarty->get_template_vars('foo') === null) 
{
   $smarty->assign('foo', 'some value');
} 
```

**灵巧3**

```
if ($smarty->getTemplateVars('foo') === null) 
{
   $smarty->assign('foo', 'some value');
} 
```

请注意，对于**Smarty 3**，您将不得不使用它`$smarty->getTemplateVars`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T17:27:38.780

`get_template_vars()`如果您没有设置变量，将返回 null，所以您可以这样做

```
if ($smarty->get_template_vars('test') === null) {
    echo "'test' is not assigned or is null";
} 
```

但是，如果您分配了一个变量但设置为 null，则该检查将失败，在这种情况下您可以这样做

```
$tmp = $smarty->get_template_vars();
if (!array_key_exists('test', $tmp)) {
    echo "'test' is not assigned";
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T17:02:42.403

很确定你可以这样做：

```
if (!isset($smarty['foo'])) 
{
    $smarty->assign('foo', 'some value');
} 
```

# asp.net - asp.net gridview 与编写 innerhtml

> ID：350131
> 
> 赞同：0
> 
> 时间：2008-12-08T16:49:26.093
> 
> 标签：asp.net, optimization

我不使用 asp.net 中的 gridview 从存储过程查询简单表，而是自己在服务器代码中编写 html，对我有什么性能优势。我确信我的代码在输出上肯定会更简洁。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T17:01:23.637

我将提出一个替代解决方案。如果您不需要 GridView 的任何功能，为什么不使用中继器。

中继器使其易于实现，但也允许您完全控制生成的源。没有字符串连接性能的问题。

我发现中继器在 GridViews 上的性能提升很小。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T16:55:15.427

不，使用 GridView 没有性能优势。一般来说，GridView 会降低一点性能，因为项目被写入到 ViewState 中，并且生成了额外的 HTML。您从 GridView 获得的好处包括可以轻松使用或创建的命令事件和参数、允许您跟踪大型结果集中的关键字段的 DataKey“属性包”以及许多其他内容。我将添加这个警告，即使是非常简单的结果集返回，我也使用了 GridViews，并且没有发现任何重大的性能问题。

如果您只是从表查询中进行一些输出，而不是担心与结果本身的数据进行太多交互，那么“滚动您自己的”将提供一个很好的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T16:55:17.690

好吧，当然这取决于您的实施。您几乎可以肯定构建运行速度比股票网格视图更快的东西。

问题是，你怎么知道？.Net 中字符串连接的默认系统本质上非常慢，因此很容易意外地构建比普通网格视图慢得多的东西。您当然可以进行测试，但开发时间投资可能会超过服务器性能的提升。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T17:13:48.167

在使用 GridView 和使用 StringBuilder 生成 HTML 之间存在另一种可能性。我说的是使用 ASP Table 类。当我所做的只是吐出数据时，我已经看到在标准 GridView 上使用它们的速度优势令人印象深刻。作为额外的奖励，我可以在我的输出中添加一个按钮（或链接按钮）并将其与事件处理程序连接起来，并且在这方面仍然可以获得 GridView 的功能。

你会这样使用它：

```
Dim tab As New Table
For Each row In DataTable.Rows
  Dim tabRow as New TableRow
  For Each col In row.Columns
    dim tabCol as New TableColumn
    tabCol .Text = row(col)
    tabRow.Controls.Add(tabCol )
  Next
  tab.Rows.Add(tabRow)
Next 
Page.Controls.Add(tab) 
```

# objective-c - 将 iPhone openGLES 应用程序移植到 OSX？

> ID：350139
> 
> 赞同：5
> 
> 时间：2008-12-08T16:52:07.243
> 
> 标签：objective-c, cocoa, macos, opengl, opengl-es

为 iPhone 开发是我对 Objective-c 的第一次体验，也是对 xcode 的第一次深入体验。使用 openGL 将 openGLES iPhone 应用程序移植到 OSX 桌面会有多困难？我不是在问用户界面——显然桌面上没有可可触摸 UI。我专门询问应用程序委托和 openGLES 层。有什么重大障碍吗？是否像在 cocoa 类型的项目中简单地创建一个新的应用程序委托一样简单？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-09T02:51:16.957

我已经开始研究同样的事情，并且看起来重 OpenGL 的应用程序将是最容易向后移植到 Mac 的应用程序之一。OpenGL ES 中的几乎所有内容都存在于桌面上的 OpenGL 中（除了一些定点的东西），因此代码可以保持不变。

在 iPhone 上处理 OpenGL 的方式是通过核心动画层 (CAEAGLLayer)，而不是特定的视图。因此，您应该能够将其传输到基于 Leopard 的桌面应用程序，尽管您需要将对 EAGL 类的所有引用转换为它们的 OpenGL 等效项（例如，EAGLContext 到 NSOpenGLContext）。你可以渲染成一个自己显示的 CAOpenGLLayer，或者使用那个层来支持一个自定义的 NSView。

桌面 Cocoa 应用程序的基本结构与 Cocoa Touch 不同，但您应该能够从其中一个 Xcode 模板开始，然后从 Cocoa Touch 应用程序中添加回您的组件。

同样，我还没有为我的应用程序这样做，但它看起来相当简单。

# vim - Vim：NERD_tree 插件。需要帮助了解博主 .vimrc 添加以简化此插件

> ID：350140
> 
> 赞同：1
> 
> 时间：2008-12-08T16:52:26.307
> 
> 标签：vim

所以我基本上是 Vim 的初学者，但我确实知道基本的东西（打开文件、编辑、移动、基本的 grep、.vimrc 等）

我会先提交这个链接

[http://weblog.jamisbuck.org/2008/11/17/vim-follow-up](http://weblog.jamisbuck.org/2008/11/17/vim-follow-up)

如果您向下滚动到显示“NERD___tree”的位置，它会解释它是什么并提供指向主页的链接。我已经安装了 NERD_tree，到目前为止一切顺利。

唯一的问题是，这个人（JamisBuck）在 .vimrc 文件中添加了一行以简化它的使用（我猜想在 NERD_tree 和实际文件之间切换，因为据我所知，没有快速的方法可以做到除了输入：

```
:NERDTree 
```

每次都不太理想。以下是他添加到 .vimrc 文件中的代码：

```
map <leader>d :execute 'NERDTreeToggle ' . getcwd()<CR> 
```

他没有确切解释什么是和/或如何使用它，所以如果有人可以给我一个简短的解释和/或向我指出一个资源以了解更多关于此的信息，那将不胜感激。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T16:58:16.763

我想说`:help leader`会给你你需要的东西，默认情况下是一个反斜线。

因此，`map <leader>d`将在您执行时启动`\d`。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-08T17:02:15.413

根据[vim 文档](http://vimdoc.sourceforge.net/htmldoc/map.html)，

```
<Leader> 
```

是一个特殊变量，在定义映射时替换为“mapleader”的值。所以：

```
map <leader>d :execute 'NERDTreeToggle ' . getcwd()<CR> 
```

正在将 mapleader 和“d”映射到切换。如果您查看链接的页面，在页面的前面，他说：

```
I’ve got my <Leader> character (:h mapleader) mapped to the comma 
(since it’s easier to reach than the backspace character).

let mapleader = "," 
```

所以据我所知，切换应该是“，d”。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-08T19:15:13.023

除了其他人所说的（d 映射到命令），命令本身：

```
:execute 'NERDTreeToggle ' . getcwd()<CR> 
```

只是使用第一个参数作为当前工作目录执行 NERDTreeToggle 命令。最后是回车，只是模拟按下回车键。

这意味着当 NERD 树打开时，它将位于当前工作目录中。

# linux - 如何找出给定用户的组？

> ID：350141
> 
> 赞同：266
> 
> 时间：2008-12-08T16:53:19.067
> 
> 标签：linux, unix, command-line, sysadmin

在 Unix/Linux 中，如何通过命令行找出给定用户所在的组？

* * *

## 回答 #1

> 赞同：386
> 
> 时间：2008-12-08T16:54:28.020

```
groups 
```

或者

```
groups user 
```

* * *

## 回答 #2

> 赞同：105
> 
> 时间：2008-12-08T16:54:28.643

这个显示了用户的 uid 以及他们所属的所有组（及其 gid）

```
id userid 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2015-04-13T22:02:42.020

在 Linux/OS X/Unix 上显示您（或可选指定的用户）所属的组，使用：

```
id -Gn [user] 
```

这相当于`groups [user]`在 Unix 上已经过时的实用程序。

在 OS X/Unix 上，`id -p [user]`建议使用该命令进行正常交互。

参数说明：

> `-G`, `--groups`- 打印所有组 ID
> 
> `-n`, `--name`- 打印名称而不是数字，对于`-ugG`
> 
> `-p`- 使输出可读。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T17:14:25.780

或者只是研究 /etc/groups（好吧，如果它使用带有 ldap 的 pam，这可能不起作用）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-05-04T13:51:58.033

下面是集成到 ansible 并以 CSV 格式生成仪表板的脚本。

```
sh collection.sh

#!/bin/bash

HOSTNAME=`hostname -s`

for i in `cat /etc/passwd| grep -vE "nologin|shutd|hal|sync|root|false"|awk -F':' '{print$1}' | sed 's/[[:space:]]/,/g'`; do groups $i; done|sed s/\:/\,/g|tr -d ' '|sed -e "s/^/$HOSTNAME,/"> /tmp/"$HOSTNAME"_inventory.txt

sudo cat /etc/sudoers| grep -v "^#"|awk '{print $1}'|grep -v Defaults|sed '/^$/d;s/[[:blank:]]//g'>/tmp/"$HOSTNAME"_sudo.txt

paste -d , /tmp/"$HOSTNAME"_inventory.txt /tmp/"$HOSTNAME"_sudo.txt|sed 's/,[[:blank:]]*$//g' >/tmp/"$HOSTNAME"_inventory_users.txt 
```

我的输出存储在下面的文本文件中。

```
cat /tmp/ANSIBLENODE_sudo.txt
cat /tmp/ANSIBLENODE_inventory.txt
cat /tmp/ANSIBLENODE_inventory_users.txt 
```

# perl - 如何在 IIS 下设置 LC_ALL 和 LANG？

> ID：350150
> 
> 赞同：1
> 
> 时间：2008-12-08T16:56:26.097
> 
> 标签：perl, iis, cgi, locale

我正在尝试在 IIS 下运行一些 Perl CGI 脚本。我收到以下消息：

```
 CGI Error
The specified CGI application misbehaved by not returning a complete set of HTTP headers. The headers it did return are:

perl: warning: Setting locale failed.
perl: warning: Please check that your locale settings:
    LC_ALL = (unset),
    LANG = (unset)
    are supported and installed on your system.
perl: warning: Falling back to the standard locale ("C"). 

```

我发现只有当我“使用”我们的内部库时才会出现问题，但它确实是一个很大的库（使用许多其他东西），所以我更愿意知道在哪里看。当我从命令行运行相同的脚本时，脚本运行得很好。我尝试将“LANG”设置为“C”，然后将“LC_ALL”设置为“C”，但没有效果。

欢迎任何指点！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T17:22:46.947

The LANG and LC_ALL environment variables are set for your shell, but they aren't set for IIS. I'm not an IIS person, but the docs say that IIS is a service and you have to set those ahead of time then reboot.

Alternatively, you can set these variables as soon your script starts to compile (and before you load your large library that is causing the problems:

```
BEGIN {
 $ENV{LC_ALL} = ...;
 $ENV{LANG} = ...;
 }

```

Get the values that you should use by looking at the ones you have in your shell.

Good luck,

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T17:00:23.623

似乎您的 Perl 应用程序正在将其错误发送到浏览器，并且在发送标头之前发生错误。

如果您使用的是 CGI 模块，则第一个可能是由`use CGI::CARP qw(fatalsToBrowser)`.

在这种情况下`fatalsToBrowser`，弊大于利，所以我建议您暂时将其关闭。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T17:17:18.877

The [perldoc for locale](http://www.perl.com/doc/manual/html/pod/perllocale.html#LOCALE_PROBLEMS) might help you. It even features a troubleshooting section.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T17:21:28.200

You can suppress this error by setting PERL_BADLANG=0, though that, like LC_ALL, needs to be set *before* your Perl script runs.

# xml - How modular should be a XML schema?

> ID：350158
> 
> 赞同：1
> 
> 时间：2008-12-08T16:57:47.467
> 
> 标签：xml, xsd

Talking about **schema definitions**, what are you used to doing:

1.  put everything inside a unique and big bang XML schema?
2.  use a domain modularization approach, putting all entities that referes to the same context together?
3.  or just use a schema per entity?

I´ve read in a best practice document from a famous/private integration tool, that you should modularize due to performance boost and so on.

What is the best approach?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T17:01:31.280

One per namespace. Why do you need to break up a schema? I'd also quote the Rules of [Optimization Club](http://fetter.org/optimization.html).

**Edit:** If you have many entities that are disjoint from each other (like plugins), it may make sense to start applying DRY/modularization principle, and break out the common parts.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-29T21:16:45.447

A schema per entity is spreading things out a bit too much, I think. Typically for a given system, I have a single schema that has all the most common types. That way when I talk about "foo:bar" in one xsd and "foo:bar" in another xsd I know they're equivalent. Then, each context of data go in another schema.

For instance, if we're talking about a finance system, I'd have one xsd with types like order number, invoice number, vendor name, etc... things that all kinds of documents would need. Then there would be one xsd for "invoicing", one for "ordering", one for "accounts", and so on. These schemas may refer to one another as well, and they would each have their own namespace to keep things tidy for any non-common types that happen to have similar names.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T17:06:30.973

Personally from my experience, I've heard that there isn't too much of a difference either way from a performance standpoint.

In my opinion though, I find a single nested schema to be much easier to understand, follow, and relate to the source document.

# javascript - 在 Ext 中使用 XTemplate 和 SimpleStore

> ID：350163
> 
> 赞同：2
> 
> 时间：2008-12-08T16:59:35.123
> 
> 标签：javascript, json, extjs

我目前正在向一些旧代码添加一些功能。曾经有一个模板，它采用一个平面数组并吐出一些 HTML，现在数据来自一个读取一些 JSON 的简单存储。

```
var allwords = [
    ['abacteriano', 'abacteriano'],
    ['abacterial', 'abacteriano'],
    ['abciximab', 'abciximab'], ...
] 
```

所以我的simplestore是这样的：

```
 termStore = new Ext.data.SimpleStore({
        fields: ['term', 'lookup'],
        data: allwords
    }); 
```

当我在组合框中使用 termStore 时，这绝对可以正常工作。但是我很难让它与 XTemplate 一起玩。

似乎 extjs 中的语法不能很好地与 SO 配合使用，所以这个位不会在代码块中......

所以我想我会描述它：p

本质上它是一个简单的模板，它试图通过执行 {term} 从传递的集合中获取值

然后我尝试通过执行以下操作来应用它：

```
tpl.overwrite(Ext.get("contentbox"), termStore); 
```

这给了我一个“无效的对象初始化程序”的 JS 错误

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-16T17:38:05.997

XTemplate 适用于简单的对象或数组，而不是 afaik，simplestores。尝试将其绑定到您的 allwords 数组。

# java - 用于保护 java/jsp 的 SQL/javascript 注入的 Lib

> ID：350177
> 
> 赞同：2
> 
> 时间：2008-12-08T17:03:44.973
> 
> 标签：java, security, jsp, sql-injection, javascript-injection

任何人都知道一个好的库，我可以在插入字符串之前运行它们，可以去掉 sql/javascript 代码？在jsp页面中运行。

理想情况下，lib 将是：

*   自由
*   轻的
*   便于使用

提前感谢 SO 社区，他们会很高兴地回复 :)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T17:11:27.267

Apache Commons lang StringEscapeUtils 将为您提供一些帮助。它逃脱，不剥离。

[http://commons.apache.org/lang/api/org/apache/commons/lang/StringEscapeUtils.html](http://commons.apache.org/lang/api/org/apache/commons/lang/StringEscapeUtils.html)

编辑：转义可以使您免受注入攻击，因为它确保用户输入的数据不会作为代码执行，而是始终作为数据呈现给用户。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-08T17:07:22.033

您需要依赖数据库 api 的机制来使用参数化查询。如果您*首先*动态构建一个 sql 字符串，*然后*想要清理已完成的查询字符串，那么您做错了。那只是自找麻烦。

* * *

编辑：重新阅读您的问题后，我似乎误解了您的要求。我坚持我最初的评论对于您问题的 sql 注入部分是准确的。为此，您肯定需要真正的查询参数。

至于过滤掉javascript，我认为还没有真正的*标准*方法。我知道 Jeff 在 SO 发布了他们在此处使用的代码，但我没有方便的链接。如果我能找到它，我会发布它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-08T17:46:39.350

看看OWASP 上的[AntiSamy](http://www.owasp.org/index.php/Category:OWASP_AntiSamy_Project)。我认为这可能是您正在寻找的。我目前不在 Java 中工作，所以我不能告诉你它是如何执行的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T17:13:11.133

您要说的是，对于添加到字符串中的每个可能条目，我必须首先删除“恶意”数据。是的，这是有道理的，因为我无法分辨哪个是作为输入添加的，什么是查询本身的一部分。

好的，我想我需要重新开始更改一些代码:) api 的问题仍然存在:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T18:13:03.743

c:out 标签默认转义 XML。这对于存储用户输入很方便，因为绑定的值仍然是用户的输入，但浏览器生成的源将使用转义条目。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T18:20:17.113

为了防止 SQL 注入，请使用 PreparedStatement 对象。如果您正在使用一些持久层，请确保它正在使用 PreparedStatement 对象。对于恶意 HTML 和 JavaScript，请使用 . 默认情况下，这会转义 XML 字符。您还可以使用 fn tld 中的 JSTL 函数 escapeXml。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-13T18:23:26.747

只是在这里改写其他人给出的建议：

OP 希望防止 SQL 和 JavaScript 注入攻击。

通过确保使用参数化查询/绑定变量向数据库提供用户输入，可以防止 SQL 注入攻击。在 Java 世界中，使用[PMD](http://pmd.sourceforge.net/)（和[PMD 规则](http://www.gdssecurity.com/l/t.php)）和[Findbugs](http://findbugs.sourceforge.net/)（这些规则默认内置在 Findbugs 中）将帮助您确定代码库中易受 SQL 注入攻击的位置。OWASP 有一篇关于[防止 Java 中的 SQL 注入](http://www.owasp.org/index.php/Preventing_SQL_Injection_in_Java)的好文章。

就脚本注入而言，防止执行攻击者注入的脚本的最安全方法是确保用户输入在用作输出时以编码格式显示 - 对于 Web 应用程序，这将是HTML 编码。[这个 OWASP 页面](http://www.owasp.org/index.php/How_to_perform_HTML_entity_encoding_in_Java)向您展示了如何在 Java 中执行 HTML 编码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-12-31T04:48:43.900

如果您想保护您的应用程序免受 javascript 注入，则需要检测或挂钩以您的 javascript 作为参数的方法，对于 mongodb，eval() 方法可以在 mongo 服务器上执行 javascript。您可以按照下面的链接来减轻 ssjs 攻击。 [https://www.sciencedirect.com/science/article/pii/S1568494619305022](https://www.sciencedirect.com/science/article/pii/S1568494619305022)

# c# - C# 或 VB 中的动态逻辑表达式解析/评估？

> ID：350181
> 
> 赞同：10
> 
> 时间：2008-12-08T17:05:20.400
> 
> 标签：c#, vb.net, expression

最好的方法是评估如下表达式：
(A And B) Or (A And C) Or (Not B And C)
or
(A && B) || (A && C) || (!B && C)

在运行时，我计划将上述表达式转换为以下表达式：
(True And False) Or (True And False) Or (Not False And True)
or
(True && False) || (真 && 假) || （！假 && 真）

条件： 1) 直到运行时才知道逻辑表达式。2) number 变量及其值直到运行时才知道。3) 变量值永远不会为空。

我知道我可以使用在运行时根据输入生成的类和方法创建一个简单的组合，但有没有更好的方法。我以前做过。使用字符串生成器编写代码，然后调用编译器。之后，您加载程序集并调用该方法。

建议？

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-08T17:15:03.140

如果您使用的是 .NET3.5，那么您可以解析文本并使用 Expression 类创建一个抽象语法树。然后创建一个合适的 LambdaExpression 实例并将其编译为委托，然后您可以执行该委托。

为这种相当简单的语法构建解析器和语法树构建器是一项非常有趣的练习，并且执行起来会比调用编译器快一些（在我看来它也更整洁）。

如果您不使用 .NET3.5，那么自己实现解释的抽象语法树也并不复杂。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-08T17:16:29.380

请注意：您所说的两个最终条件不一定是等价的。C# 中的 && 运算符将使用短路求值，而`And`VB 中的逻辑运算符则不使用。如果您想确保语句是等价的，请将一个用户翻译`And`成`AndAlso`和一个用户翻译`Or`成`OrElse`。

对于简单的表达式，您可能不会注意到差异。但是，如果条件可能会产生副作用，或者如果两者之间的性能差异是一个问题，那么这可能很重要。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-08T20:33:20.853

您可以通过以下方式轻松做到这一点：

1.  一个解析器生成器（如上面提到的 ANTLR），它将布尔表达式作为输入并生成一个中缀列表和
2.  评估反向波兰表示法堆栈的代码。

语法看起来像这样：

```
program: exprList ;

exprList: expr { Append($1); }
    | expr OR exprList { Append(OR); }
    | expr AND exprList { Append(AND); }
    | NOT exprList { Append(NOT); }
    | ( exprList ) { /* Do nothing */ }
    ;

expr: var { Append($1); }
    | TRUE { Append(True); }
    | FALSE { Append(False); }
    ; 
```

要进行评估，请执行以下操作：

```
for each item in list
    if item is symbol or truth value, push onto RPN stack
    else if item is AND, push (pop() AND pop())
    else if item is OR, push (pop() OR pop())
    else if item is NOT, push (NOT pop())

result = pop() 
```

对于符号，您必须在运行时替换真值。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-12-01T07:48:49.310

您可以使用[https://github.com/mrazekv/logicalparser](https://github.com/mrazekv/logicalparser)

它是编写逻辑表达式的简单库（使用优先表评估，允许 OR、NOT、AND 运算符和 >、>=、<=、< 整数变量和 = 字符串变量）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T17:12:59.807

您可以编写一个简单的解释器/解析器。[使用ANTLR 之](http://www.antlr.org/)类的东西并重用现有的语法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T17:18:21.823

如果您使用的是 .NET 3.5，则可以创建 Lambda 表达式。然后您可以从中创建一个委托并作为标准委托/方法调用。互联网上有很多关于 Lambda 表达式的示例。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-08T17:24:00.253

一种解决方案是将表达式组装为字符串，然后将其发送到 SQL Server 或任何您的数据库进行评估。用 1=1 或 0=1 分别替换 True 和 False 的实际变量，您最终会得到如下查询：

SELECT 1 WHERE (1=1 And 0=1) Or (1=1 And 1=1) Or (Not 0=1 And 1=1)

然后，当您运行查询时，当结果为真时，您会得到 1。可能不是最优雅的解决方案，但它会起作用。很多人可能会建议不要这样做，但无论如何我都会把它作为一种可能的解决方案扔出去。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-04-25T16:48:06.480

这不是最好的答案，但我自己前段时间遇到了这个问题。

这是我的旧代码：VB.Net - 根本没有保修！

[https://cloud.downfight.de/index.php/s/w92i9Qq1Ia216XB](https://cloud.downfight.de/index.php/s/w92i9Qq1Ia216XB)

```
Dim BoolTermParseObjekt As New BoolTermParse
MsgBox(BoolTermParseObjekt.parseTerm("1 und (((0 oder 1 und (0 oder 4))) oder 2)").ToString) 
```

这段代码使用多个 '(', ')', 'and', 'or' 加上 'other things' 的字符串，并通过用布尔值替换这些东西来将逻辑分解为布尔值。所以：

无论我想评估什么“其他事情”，我都必须在“'funktionen ausführen und zurückgeben，einzelwert！”的评论中输入 Function resolveTerm() 。在第 2 页。现在唯一的评估是“如果数字大于 1”

问候

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-04-04T19:51:53.373

看看我的图书馆，[Proviant](https://github.com/Genfood/Proviant)。它是一个 .NET 标准库，使用[Shunting Yard 算法](https://en.wikipedia.org/wiki/Shunting-yard_algorithm)来评估布尔表达式。

它还可以为您的表达式生成一个真值表。

您也可以实现自己的语法。

# flash - Silverlight 应用程序可以嵌入到 PowerPoint 中吗？

> ID：350183
> 
> 赞同：8
> 
> 时间：2008-12-08T17:06:15.437
> 
> 标签：flash, silverlight, powerpoint

Silverlight 应用程序可以嵌入到 PowerPoint 中吗？我们目前正在权衡 Silverlight 与 Flash 的优缺点，并且主要对图表控件感兴趣。高层希望在 PowerPoint 演示文稿中包含美观的动态图表，并能够在未来将这些图表迁移到在线解决方案中。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-08T18:06:57.217

所有 Silverlight 应用程序都需要托管在浏览器中，因此您需要在 PPT 中获取 HTML 页面。这可以通过在使用 VBA 的页面中嵌入 Winforms 浏览器控件来完成。

托管 Silverlight 控件的 XAP 文件和网页需要托管在可用的 Web 服务器上，或者将文件本地放置在将运行演示文稿的每台 PC 上，这会引入额外的依赖关系。

您可能遇到的另一个问题是将“动态图表”链接到数据。如果您能够让所有数据都是静态的并封装在 Silverlight 控件中，那么这可能是可行的，但如果您需要将图表连接到您的 powerpoint 演示文稿中的数据，您最终可能需要进行大量编码来获得这个去工作。

**长话短说**，我建议 Silverlight 可能***不是***将视觉内容嵌入 PowerPoint 的正确工具。它确实是专为在线/网络部署而设计的。

# mysql - char vs varchar 在股票数据库中的性能

> ID：350195
> 
> 赞同：13
> 
> 时间：2008-12-08T17:11:28.610
> 
> 标签：mysql, sql, performance, varchar

我正在使用 mySQL 建立一个股票期权数据库。大约有 330,000 行（每行是 1 个选项）。我是 SQL 新手，所以我试图确定选项符号（从 4 到 5 个字符不等）、股票代码（从 1 到 5 个字符不等）、公司名称（从 5 到 60 不等）等字段类型人物）。

我想优化速度。两者都创建数据库（随着新的价格数据出现，每 5 分钟发生一次——我没有实时数据馈送，但它接近实时，因为我得到了一个包含 330,000 行的新文本文件交付给我每 5 分钟一次；这个新数据完全取代了以前的数据），同时也提高了查找速度（将有一个基于 Web 的前端，许多用户可以在其中运行即席查询）。

如果我不关心空间（因为数据库的生命周期是 5 分钟，并且每行可能包含 300 个字节，所以整个事情可能是 100MB）那么构建字段的最快方法是什么？

实际上，对于数字字段同样的问题：int(11) 和 int(7) 之间是否存在性能差异？对于查询和排序，一种长度是否比另一种更好？

谢谢！

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-12-08T18:07:17.637

在 MyISAM 中，制作固定宽度的记录有一些好处。VARCHAR 是可变宽度。CHAR 是固定宽度的。如果您的行只有固定宽度的数据类型，那么整行都是固定宽度的，并且 MySQL 在计算该表中行的空间需求和偏移量时获得了一些优势。也就是说，优势可能很小，并且几乎不值得拥有固定宽度的填充 CHAR 列（其中 VARCHAR 可以更紧凑地存储）所带来的其他成本（例如缓存效率）所抵消的微小收益。

它变得更有效的断点取决于您的应用程序，除非您测试两种解决方案并使用最适合您的应用程序使用的数据的一种，否则这是无法回答的。

关于 INT(7) 与 INT(11)，这与存储或性能无关。一个常见的误解是 MySQL 对 INT 类型的参数与数据大小有关——它没有。MySQL 的 INT 数据类型始终为 32 位。括号中的参数是指使用 ZEROFILL 显示值时要填充的位数。例如，INT(7) 将显示 0001234，而 INT(11) 将显示 00000001234。但这种填充仅在显示值时发生，而不是在存储或数学计算期间发生。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-08T17:21:26.793

If the actual data in a field can vary a lot in size, varchar is better because it leads to smaller records, and smaller records mean a faster DB (more records can fit into cache, smaller indexes, etc.). For the same reason, using smaller ints is better if you need maximum speed.

OTOH, if the variance is small, e.g. a field has a maximum of 20 chars, and most records actually are nearly 20 chars long, then char is better because it allows some additional optimizations by the DB. However, this really only matters if it's true for ALL the fields in a table, because then you have fixed-size records. If speed is your main concern, it might even be worth it to move any non-fixed-size fields into a separate table, if you have queries that use only the fixed-size fields (or if you only have shotgun queries).

In the end, it's hard to generalize because a lot depends on the access patterns of your actual app.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-08T18:08:25.000

鉴于您的系统限制，我建议使用 varchar，因为您对数据所做的任何事情都必须适应您放置的任何填充以使用固定宽度的字符。这意味着在某个地方有更多代码需要调试，并且更容易出错。话虽如此：

> 应用程序的主要瓶颈是由于每五分钟删除和重新创建数据库。您不会从选择 char 而不是 varchar 之类的微增强功能中获得太多性能优势。我相信您有一些更严重的架构问题需要解决。- 公主

我同意上述评论。在您担心 char 和 varchar 之间的区别之前，您的架构中有更大的鱼要炸。一方面，如果您有一个 Web 用户尝试运行临时查询并且数据库正在重新创建过程中，您将收到错误（即“数据库不存在”或只是“超时”类型的问题）。

我建议您（至少）为最新的报价数据（带有时间戳）、股票代码表和历史表构建（至少）一个报价表。您的网络用户将查询股票代码表以获取最新数据。如果您的 5 分钟文件中出现一个不存在的符号，那么在将新信息发布到报价表之前让导入脚本创建它就足够简单了。所有其他都得到更新，查询默认为当天的数据。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-07T19:10:25.020

我绝对不会每次都重新创建数据库。相反，我会执行以下操作：

*   读入更新/快照文件并根据每一行创建一些对象。
*   为每一行获取符号/选项名称（唯一）并将其设置在数据库中

如果是我，我也会有一个所有符号和当前价格数据的内存缓存。

价格数据永远不是 int - 您可以使用字符。

公司名称可能不是唯一的，因为特定公司有很多选择。那应该是一个索引，您可以仅使用公司的 id 来节省空间。

正如其他人也指出的那样-您的网络客户端不需要访问实际的数据库并进行查询-您可能只需访问缓存即可。（尽管这实际上取决于您向客户公开哪些表和数据以及他们想要哪些数据）

拥有其他用户的查询访问权限也是不继续删除和创建数据库的原因。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-04T15:30:00.027

还要记住，创建数据库取决于您使用的任何实际数据库实现。如果您曾经从 MySQL 移植到 Postgresql，您会发现一个非常令人不快的事实，即在 postgresql 中创建数据库是一个相对非常缓慢的操作。例如，它比读取和写入表行慢几个数量级。

看起来有一个应用程序设计问题需要先解决，然后再优化性能以选择适当的数据类型。

# vba - 从 Excel 2003 升级到 2007 会导致以前工作的 vba 出现“堆栈溢出错误”

> ID：350202
> 
> 赞同：0
> 
> 时间：2008-12-08T17:13:16.733
> 
> 标签：vba, excel-2007, locking, cells

以下 VBA 代码在 Excel 2003 中运行良好，但在 Excel 2007 中会导致*堆栈溢出错误*。根据下拉菜单选择解锁或锁定某些单元格需要该代码。我需要能够在 Excel 2003 和 2007 中运行代码。请帮忙。

```
Private Sub Worksheet_Change(ByVal Target As Range)
   If [E28] = "NO" Then
     ActiveSheet.Unprotect ("PASSWORD")
     [K47:K53].Locked = False
     [K47:K53].Interior.ColorIndex = 16
     [K47:K53].ClearContents
     ActiveSheet.Protect ("PASSWORD")
   Else
     ActiveSheet.Unprotect ("PASSWORD")
     [K47:K53].Interior.ColorIndex = 0
     'Next line is optional, remove preceding apostrophe if protection should stay on.
     ActiveSheet.Protect ("PASSWORD")
   End If
End Sub 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T17:28:26.547

The stack overflow almost certainly comes from recursion. Not sure why you aren't getting a stack overflow in Excel 2003 - perhaps an error is being raised before the stack overflows.

You can protect against infinite recursion something like the following:

```
Private m_bInChange As Boolean

Private Sub Worksheet_Change(ByVal Target As Range)
If m_bInChange Then Exit Sub
On Error GoTo ErrHandler
    m_bInChange = True
    If [E28] = "NO" Then
        ActiveSheet.Unprotect ("PASSWORD")
        [K47:K53].Locked = False
        [K47:K53].Interior.ColorIndex = 16
        [K47:K53].ClearContents
        ActiveSheet.Protect ("PASSWORD")
    Else
        ActiveSheet.Unprotect ("PASSWORD")
        [K47:K53].Interior.ColorIndex = 0
        'Next line is optional, remove preceding apostrophe if protection should stay on.
        ActiveSheet.Protect ("PASSWORD")
    End If

    m_bInChange = False
    Exit Sub
ErrHandler:
    m_bInChange = False
    Exit Sub
End Sub 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T18:20:57.937

每当工作表中的任何单元格发生更改时，都会调用您的方法。您的“否”块会更改目标单元格的内容，从而导致再次调用该方法。

选项：

1.  按照乔的建议使用标志变量，看看你是否已经在执行
2.  测试“目标”值以查看它是否为 E28，如果这是您要捕获的单元格更改。就像是

    如果 Target.Address <> "$E$28" 然后退出 Sub

# c# - Don't Change URL in Browser When Clicking

> ID：350207
> 
> 赞同：-1
> 
> 时间：2008-12-08T17:14:03.173
> 
> 标签：c#, asp.net, url

I have an ASP.NET page that uses a menu based on `asp:LinkButton` control in a Master page. When a user selects a menu item, an `onclick` handler calls a method in my C# code. The method it calls just does a `Server.Transfer()` to a new page. From what I have read, this is not supposed to change the URL displayed in the browser.

The problem is it that the URL changes in the browser as the user navigates the menu to different pages.

Here is an item in the menu:

```
<asp:LinkButton id="foo" runat="server" onclick="changeToHelp"><span>Help</span>
</asp:LinkButton> 
```

In my C# code, I handle the event with a method like:

```
protected void changeToHelp(object sender, EventArgs e)
{
    Server.Transfer("Help.aspx");
} 
```

Any ideas how I can navigate through the menu without the browser's URL bar changing?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2015-02-09T05:08:42.760

您可以使用 iframe 来确保浏览器的 URL 不会更改。在 Page_Load 中，您可以将 iframe 的 src 属性更改为 help.aspx

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T17:18:17.177

Try `Server.Execute("Help.aspx")` instead. You can preserve the form if you need by using

```
Server.Execute("Help.aspx",true); 
```

# wpf - WPF：在将成为另一个 ListBox 模板的模板中使用 ListBox

> ID：350214
> 
> 赞同：1
> 
> 时间：2008-12-08T17:17:24.430
> 
> 标签：wpf, templates, listbox

我有一个 ListBox，它的 ItemSource 是一个 ObjectDataProvider，它是 ObservableCollection 的一个实例。ObservableCollection 是 ObservableCollections 的集合。ListBox 的 ItemTemplate 是一个 DataTemplate，它为列表框的每个项目创建一个 ListBox。为了更好地说明这一点，我试图在 WPF 中重新创建一个纸牌游戏。基本上，您可以从一手牌中创建书籍。在你拥有一本有效的书后，你可以选择将它制作成一本将进入 ObservableCollection 的书。我遇到的问题是 ListBox 的每个项目都是一个 ListBox，它的 ItemSource 是一本书，即卡片的 ObservableCollection。我认为外部 ListBox 的源或模板没有问题，但我很难理解我是如何做到的 m 将 ListBox 项目的来源设置为每本书的卡片集合。从本质上讲，我的问题可能令人困惑并且是一个难以掌握的概念，但基本上我试图弄清楚如何在将成为另一个 ListBox 模板的模板中使用 ListBox。如果有人知道如何解决这个问题，我将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-09T00:08:52.493

使用 Card 如下所示：

```
 public class Card
{

    private string _name;

    public Card(string name)
    {
        _name = name;
    }

    public string Name
    {
        get { return _name; }
        set { _name = value; }
    }
} 
```

和预订如下：

```
public class Book
{
    private readonly ObservableCollection<Card> _cards;

    public Book(ObservableCollection<Card> cards)
    {
        _cards = cards;
    }

    public ObservableCollection<Card> Cards
    {
        get { return _cards; }
    }
} 
```

然后在窗口中创建您的 ListBox：

```
<ListBox
        ItemsSource="{Binding ElementName=Window, Path=Books}"
        ItemTemplate="{StaticResource MainListTemplate}" /> 
```

并在窗口的资源中放置：

```
<Window.Resources>
    <ResourceDictionary>

        <DataTemplate
            x:Key="InsideListTemplate">
            <TextBlock
                Text="{Binding Name}" />

        </DataTemplate>

        <DataTemplate
            x:Key="MainListTemplate">
            <ListBox
                ItemsSource="{Binding Cards}"
                ItemTemplate="{StaticResource InsideListTemplate}" />

        </DataTemplate>

    </ResourceDictionary>
</Window.Resources> 
```

您的 ListBox 使用 MainListTemplate，其中包含一个 ListBox。该 ListBox 的 ItemsSource 是您的卡片列表，而 ItemTemplate 是 InsideListTemplate。我把它当作一个简单的 TextBlock 但你可以做任何你需要的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-09T08:57:06.967

不要将 ListBox 放在 ListBox 中，这将创建一个非常混乱的 UI，因为您将拥有多个“级别”的选定项目。

如果您需要单个 ListBox，每个项目内都有一个集合，则可以将 ItemsControl 放在 ListBox 内；如果需要多个列表框，则可以将 ListBox 放在 ItemsControl 内。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T15:50:53.920

感谢您的回复。虽然我确实同意这两种回答，并且总是很高兴收到有关不良编码实践的通知，但第一个答案确实起到了作用。我的 DataTemplate 中的 ListBox 的 ItemsSource 有问题。在学习 WPF 的过程中，我迷上了使用 ObjectDataProvider(s) 作为我的 ItemsSource。由于 ObjectDataProvider 只是集合的一个实例，当我更新它时，我所有“书籍”的卡片来源都是相同的。将我的 ItemsSource 绑定源直接更改为可观察的集合“Cards”就可以了。

尽管在 UI 方面可能会令人困惑，但我不确定我是否会允许选择任一列表中的项目。我的意图仅仅是为了球员书籍的视觉表现。我可能需要允许外部列表中的项目可以选择，以便能够将卡片从书中移回主手，但我还不确定。

再次感谢您的帮助。

谢谢，布兰登

# javascript - Strange caching of .js file in firefox/tomcat/eclipse

> ID：350220
> 
> 赞同：1
> 
> 时间：2008-12-08T17:19:46.597
> 
> 标签：javascript, eclipse, internet-explorer, firefox, jsp

I'm developing `.jsp` using eclipse and tomcat.

My `.jsp` outputs html to pull in some javascript from a `.js` file. The `jsp` outputs the code which hooks up the function `mapTool` to the mousedown event. `imfMapFunctions5101.js` contains the mapTool(e) function.

**The changes I make to the .js file do not take affect when I run in firefox, although they do when I run in IE.**

in the .jsp:

```
out.println("<script language=\"JavaScript\" type=\"text/javascript\" src=\"imfMapFunctions5101.js\"></script>");  

....    

out.println("function startup() {");
      out.println("  hideLayer(\"loadMap\");");
      out.println("  if (document.layers) {");
      out.println("    document.captureEvents(Event.MOUSEDOWN | Event.MOUSEMOVE | Event.MOUSEUP);");
      out.println("  }");
      out.println("  document.onmousedown = mapTool;");
      out.println("  **alert(document.onmousedown);**") //pops up the event code in the browser

; 
....... 
```

The javascript event code in `imfMapFunctions5101.js`:

```
function mapTool (e) {
    **alert('mapTool'); //my alert**

  if (dTools.activeTool == "Drill Down Identify") {
    showLayer("loadData");
..... 
```

when `alert(document.onmousedown);` pops up in IE I can see the event code with my added alerts:

```
function mapTool (e) {
    **alert('mapTool'); //my alert**

  if (dTools.activeTool == "Drill Down Identify") {
    showLayer("loadData");

.... 
```

In firefox the event code that pops up does NOT contain my alert:

```
function mapTool (e) {

  if (dTools.activeTool == "Drill Down Identify") {
    showLayer("loadData"); 
```

It's like the file is caching and firefox insists on getting the old cached .js file. Pretty sure that's not what happening. Have tried updating the .jsp timestamp, renaming the javascript to a bogus name, then back again.

What's going on?

ANy help much appreciated?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T17:27:16.987

try refreshing the page wile clearing cache: shift+click on refresh button, or clearing the cache under tools->clear private data

# vba - How does the VBA immediate window differ from the application runtime?

> ID：350227
> 
> 赞同：0
> 
> 时间：2008-12-08T17:21:41.973
> 
> 标签：vba, excel

I've encountered a very strange bug in VBA and wondered if anyone could shed some light?

I'm calling a worksheet function like this:

```
Dim lMyRow As Long
lMyRow = WorksheetFunction.Match(vItemID, rngMyRange.Columns(1), 0) 
```

This is intended to get the row of the item I pass in. Under certain circumstances (although I can't pin down exactly when), odd things happen to the call to the Match function.

If I execute that line in the immediate window, I get the following:

```
lMyRow = WorksheetFunction.Match(vItemID, rngMyRange.Columns(1), 0)
?lMyRow
10 
```

i.e. the lookup works, and lMyRow gets a value assigned to it. If I let that statement execute in the actual code, I lMyRow gets a value of 0.

This seems very odd! I don't understand how executing something in the immediate window can succeed in assigning a value, where the same call, at the same point in program execution can give a value of 0 when it runs normally in code!

The only thing I can think of is that it's some odd casting thing, but I get the same behaviour taking if the variable to which I'm assigning is an int, a double, or even a string.

I don't even know where to begin with this - help!!

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-18T23:06:44.630

您没有分配函数名称，因此该函数将始终返回零（如果您期望长）。看来你应该有

`makeTheLookup = lMyRow`

在您的功能结束时。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T18:23:27.700

即时窗口和正常代码运行之间的唯一区别是范围。即时窗口中的代码在当前应用程序范围内运行。如果当前没有运行，这意味着全局范围。放入 VBA 函数中的代码仅限于函数范围。

所以我的猜测是你的变量之一超出了范围。

我会在该行的函数中放置一个断点并添加手表以找出未设置的变量。

如果您的 vba 代码模块顶部没有 Option Explicit，您应该添加它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T17:45:42.477

我不知道你是否还在看这个，但我会这样写：

```
Function makeTheLookup(vItemID As Variant, rngMyRange as Range)as Long
    makeTheLookUp = WorksheetFunction.Match(vItemID, rngMyRange.Columns(1), 0)
End Function 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T15:04:45.137

感谢大家的回答-我应该在下面拨打电话的方式上更具体一些：

```
Function makeTheLookup(vItemID As Variant, rngMyRange as Range)

Dim lMyRow As Long
lMyRow = WorksheetFunction.Match(vItemID, rngMyRange.Columns(1), 0)

End Function 
```

奇怪的是，我将这两个参数传递给函数，所以我看不出它们在函数内部和外部有什么不同。也就是说，我仍然完全不知道是什么原因造成的，特别是因为这是一个非常间歇性的问题

是否有任何简单的方法可以将函数上下文中的范围对象与即时窗口上下文中的范围对象进行比较并判断它们是否不同？鉴于该范围是一种引用类型，感觉就像我应该能够比较两个指针，但我不知道如何在 VBA 中做到这一点！

顺便说一句，我正在使用 Excel 2007，尽管我不确定这是否有什么不同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-11T13:14:47.883

正如上面提到的，这绝对是一个范围问题。或者一个不起眼的错误。

我会尝试使用`Debug.print`语句以及 Watch，看看它们是否匹配，然后从那里获取。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T18:16:30.757

我无法重现 Excel 2007 的问题。

这是我使用的代码：

```
Sub test()

Dim vItemID As Variant
Dim lMyRow As Long
Dim rngMyRange As Range

    Set rngMyRange = ActiveWorkbook.Sheets(1).Range("A1:Z256")

    vItemID = 8
    lMyRow = WorksheetFunction.Match(vItemID, rngMyRange.Columns(1), 0)

    Debug.Print lMyRow

End Sub 
```

这听起来可能很愚蠢，但您确定 Match 函数的所有参数在您的宏和即时窗口中都相同吗？也许范围对象已经改变？

# python - 康威的人生游戏

> ID：350230
> 
> 赞同：-2
> 
> 时间：2008-12-08T17:22:56.293
> 
> 标签：python, conways-game-of-life, cellular-automata

我目前正在编写一个关于康威生命游戏的程序，我真的是 python 的初学者，我根本不知道如何开始。任何人都可以帮助我吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T17:24:05.400

[http://plife.sourceforge.net/](http://plife.sourceforge.net/)

把 50 英镑寄给我 :)

（我在开玩笑，当然）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-08T17:30:30.537

您可能不需要付费来学​​习 python。实现元胞自动机是一个好的开始项目。开始使用 python 的最佳位置是[官方教程](http://docs.python.org/tutorial/)，您可以通过[深入了解 python](http://www.diveintopython.org/)来学习。

[此处](https://stackoverflow.com/questions/348506/starting-from-scratchi-need-some-direction)和[此处](https://stackoverflow.com/questions/348376/intro-book-on-cs-for-girlfriend)的答案也可能会有所帮助。

如果你能忍受自我赞美和自以为是的话，[Wolfram 的书](https://rads.stackoverflow.com/amzn/click/com/1579550088)是了解元胞自动机的好方法，但不要太认真地对待这本书本身（这是一个单独的问题，可以填满几篇博客文章）。他还有一[组](https://rads.stackoverflow.com/amzn/click/com/0201626640)关于这些东西的论文，作为一本书出版，详细介绍了所有细节。当然，如果你只是在谷歌上搜索元胞自动机和康威的游戏，你会发现无数的实现和解释。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-09T11:53:01.467

您可能会在这里获得一些很好的文档：[http](http://www.imdb.com/title/tt0085959/) ://www.imdb.com/title/tt0085959/ 。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-22T10:24:17.860

我碰巧发表了[一篇](http://www.thinkbottomup.com.au/site/blog/Game_of_Life_in_XAML_WPF_using_embedded_Python)关于使用嵌入式 Python 在 XAML/WPF 中实现 John Conway 的生命游戏的博客。你可能会感兴趣。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T17:25:01.017

试试这里。

[http://www.elance.com/p/landing/buyer.html](http://www.elance.com/p/landing/buyer.html)

[http://www.rentacoder.com/RentACoder/DotNet/default.aspx](http://www.rentacoder.com/RentACoder/DotNet/default.aspx)

在这些地方，您可以雇用人员为您做小型的自由职业。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T11:43:26.290

pygame.org 网站上有一些人已经完成了他们的人生游戏版本。也许他们会有所帮助： [Pygame.org - 搜索“生活”](http://www.pygame.org/tags/life)

# php - Symfony VS CakePHP：哪一个最接近 PHP

> ID：350232
> 
> 赞同：2
> 
> 时间：2008-12-08T17:23:38.757
> 
> 标签：php, frameworks

我主要是 Rails 开发人员，但有时我必须用 PHP 编写代码。因为 stackoverflow.com*更喜欢可以回答*的问题，所以我想知道两者中哪一个最接近 PHP？

有时，我的印象是 CakePHP 是一个过时的 Rails 副本，它想要看起来像 Ruby，但却失败了，从而把最好的 PHP 抛在了后面。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T17:38:21.377

有很多关于 php 框架问题的问题。例如：

*   [php-框架-决策分析-瘫痪](https://web.archive.org/web/20081219171154/https://stackoverflow.com/questions/249984/php-framework-decision-analysis-paralysis)
*   [什么-php-framework-you-choose-for-a-new-application-and-why](https://web.archive.org/web/20081218134615/https://stackoverflow.com/questions/2648/what-php-framework-would-you-choose-for-a-new-application-and-why)
*   [which-php-framework-is-closest-to-ruby-on-rails-cakephp-codeigniter](https://web.archive.org/web/20081223150145/https://stackoverflow.com/questions/117406/which-php-framework-is-closest-to-ruby-on-rails-cakephp-codeigniter)

我认为这个问题不会带来任何新的发现。除此之外我认为选择的框架越来越多是 Zend Framework (IMHO)。

你如何定义亲密？

所有框架都是 100% 用 PHP 编写的，没有一个更接近 PHP。他们是PHP。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T17:31:49.863

我喜欢 symfony，因为它没有将 PHP4 兼容性作为业务目标。这让框架摆脱了 PHP4 的一些笨拙和限制，并利用了 PHP5 中更强大的 OOP。

# actionscript-3 - 如何修复浮点不精确的输出？

> ID：350240
> 
> 赞同：4
> 
> 时间：2008-12-08T17:26:15.817
> 
> 标签：actionscript-3, algorithm, language-agnostic, math, floating-point

我正在做一些浮点操作，最终得到以下数字：

```
-0.5
-0.4
-0.3000000000000000004
-0.2000000000000000004
-0.1000000000000000003
1.10E-16
0.1
0.2
0.30000000000000000004
0.4
0.5 
```

算法如下：

```
var inc:Number = nextMultiple(min, stepSize);
trace(String(inc));

private function nextMultiple(x:Number, y:Number) {
    return Math.ceil(x/y)*y;
} 
```

我理解浮点数不能总是用一个字节准确表示的事实。例如 1/3。我也知道我的步长**是 0.1**。如果我有步长，我怎么能得到正确的输出？

奇怪的是，这是我第一次遇到这种类型的问题。也许我玩的浮动不够。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-08T17:33:01.093

与语言无关的解决方案是将您的数字存储为整数步数，前提是您知道步长，而不是浮点数。

与语言无关的解决方案是找出您的语言对[printf](http://www.cplusplus.com/reference/clibrary/cstdio/printf.html)的实现是什么。

```
printf ("float: %.1f\n", number); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-08T17:30:33.547

正如您所认识到的，二进制数的有限浮点精度是您的问题。解决此问题的一种方法是不进行浮点数学运算。将问题转换为整数，然后转换回输出。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T17:32:34.540

如果您使用的是具有圆形功能的语言，则可以使用它。

**编辑**

为了回应关于四舍五入的评论，这里有一个 c# 示例：

```
float value = 1.0F;

for (int i = 0; i < 20; i++)
{
    value -= 0.1F;
    Console.WriteLine(Math.Round(value, 1).ToString() + " : " + value.ToString());
} 
```

结果是：

0.9：0.9

0.8 : 0.8

0.7：0.6999999

0.6：0.5999999

（ETC）

四舍五入确实解决了精度问题。我并不是说它比做整数数学然后除以 10 更好，只是它有效。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-08T17:33:14.383

要么使用整数而不是浮点类型，要么使用“点”是小数点的浮点类型（例如，.NET 中的[System.Decimal](http://msdn.microsoft.com/en-us/library/system.decimal.aspx)）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T17:32:46.617

对于您的具体问题，在实际使用某事物的值之前，从 -5 数到 5 并除以 10。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T21:32:40.360

我做了以下，

```
var digitsNbr:Number = Math.abs(Math.ceil(((Math.log(stepSize) / Math.log(10))) + 1));      
tickTxt.text = String(inc.toPrecision(digitsNbr)); 
```

它效率不高，但我没有很多步骤。

====== 我应该将步数的 nbr 作为 int 并按步相乘...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-11T19:52:00.903

如果您没有 printf，或者如果步骤不只是 10 的幂（例如，如果您想四舍五入到最接近的 0.2），那么听起来您需要一个量化器：

q(x,u) = u*floor(x/u + 0.5);

“u”是步长（在您的情况下为 0.1）， floor() 找到不大于其输入的最大整数，“+ 0.5”是四舍五入到最接近的整数。

所以基本上，你除以步长，四舍五入到最接近的整数，然后乘以步长。

编辑：哦，没关系，无论如何你基本上都是这样做的，它乘以 u 的步骤是引入舍入误差。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-21T11:46:58.753

只需缩放数字以获得整数，然后进行数学运算并将它们缩放回浮点数以进行显示：

```
//这将四舍五入到小数点后3位
变量 NUM_SCALE = 1000；

函数 scaleUpNumber(n) {
    返回 (Math.floor(n * NUM_SCALE));
}
函数 scaleDnNumber(n) {
    返回（n / NUM_SCALE）；
}

var answ = scaleUpNumber(2.1) - scaleUpNumber(3.001);
警报（scaleDnNumber（answ））；// 显示：-0.901

```

更改 NUM_SCALE 以增加/减少十进制地图位置

|/|斧头

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-31T15:54:14.660

这有点违反直觉，但我对其进行了测试并且它有效（AS3 中的示例）：

```
var inc:Number = nextMultiple(min, stepSize);
trace(String(inc));

private function nextMultiple(x:Number, y:Number) {
    return Math.ceil(x/y)*(y*10)/10;
} 
```

所以我唯一添加的是乘以`y`10，然后除以 10。这不是通用解决方案，但适用于您的 stepSize。

[编辑：]这里的逻辑似乎是你乘以一个足够大的数字，以便最后一个十进制数字“从比例上掉下来”，然后再除以得到一个四舍五入的数字。也就是说，上面使用*Math.round()*的示例更具可读性并且更好，因为代码明确说明了传入的数字会发生什么。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-31T15:57:51.363

如果您的语言支持，最好的选择是使用 Decimal 数据类型。小数被添加到许多语言中以解决这个确切的问题。

# .net - RegEx for extracting HTML Image properties

> ID：350250
> 
> 赞同：0
> 
> 时间：2008-12-08T17:30:04.453
> 
> 标签：.net, html, regex, html-content-extraction

I need a RegEx pattern for extracting all the properties of an image tag.

As we all know, there are lots of malformed HTML out there, so the pattern has to cover those possibilities.

I was looking at this solution [https://stackoverflow.com/questions/138313/how-to-extract-img-src-title-and-alt-from-html-using-php](https://stackoverflow.com/questions/138313/how-to-extract-img-src-title-and-alt-from-html-using-php "How to Extract img src title and alt") but it didn't quite get it all:

I come up something like:

```
(alt|title|src|height|width)\s*=\s*["'][\W\w]+?["'] 
```

Is there any possibilities I'll be missing or a more efficient simple pattern?

EDIT:
Sorry, I will be more specific, I'm doing this using .NET so it's on the server side.
I've already a list of img tags, now I just need to parse the properties.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T17:35:28.343

> As we all know, there are lots of malformed HTML out there, so the pattern has to cover those possibilities.

It won't. Use a HTML parser if you have to parse "evil" (from an unknown source) HTML.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T17:36:38.993

If performance is not a big concern I'd go with an html parser (like [BeautifulSoup](http://www.crummy.com/software/BeautifulSoup/) in python) if you are doing this server-side or [jquery](http://jquery.com) or just plain javascript if you are doing it client-side. Granted it is overkill but it is a lot quicker, less likely to have bugs (since they've thought of the corner cases), and it will handle the potential malformedness.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-03T06:52:29.480

您最好的选择是使用[HTML Agility Pack](http://www.codeplex.com/htmlagilitypack)之类的东西，而不是使用正则表达式。它旨在处理大量案例，并且由于敲定边缘案例，可以为您省去很多麻烦

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-03T08:41:42.210

Before comitting yourself to regex, see what it can do: [RegEx match open tags except XHTML self-contained tags](https://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags/1732454#1732454)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-03T08:57:47.647

```
/<img(\s+([a-z]{3,})=(["']([^"']*)["']|[\S]))+\s*/?>/i 
```

一个 match_all 将返回（格式取决于您的库，但关键索引是）：

```
0 -> image tag
1 -> attribute
2 -> attribute name
3 -> attribute value (with enclosing quotes if exists)
4 -> attribute value (without enclosing quotes if it has them, otherwise empty, use 3) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T17:36:05.470

If you want **all** attribute values, might I suggest using the DOM? Something like `element.attributes` will work well.

If you insist on a regex `//\b\w+="[^"]+"//` should get everything.

# javascript - 在“Facebox”框中定位元素

> ID：350255
> 
> 赞同：4
> 
> 时间：2008-12-08T17:32:04.840
> 
> 标签：javascript, jquery, facebox

这是我的链接：

[http://tinyurl.com/6j727e](http://tinyurl.com/6j727e)

如果单击 test.php 中的链接，它将在使用 jquery 'facebox' 脚本的模式框中打开。

我试图对这个框中的点击事件采取行动，如果你查看 test.php 的源代码，你会看到我试图在模式框中找到链接的位置。

```
 $('#facebox .hero-link').click(alert('click!')); 
```

但是，它没有检测到点击，而且奇怪的是，点击事件在页面加载时运行。

然而，关闭按钮确实有一个内置的点击事件来关闭盒子，我怀疑我的本土点击事件被某种方式阻止了，但我无法弄清楚。

任何人都可以帮忙吗？通常它是项目的最后一部分，它一直在阻碍我，就像往常一样；）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-08T17:47:20.207

首先，您在文档加载时收到警报的原因是该`#click`方法将函数作为参数。相反，您将返回值传递给它`alert`，它会立即显示警报对话框并返回 null。

事件绑定不起作用的原因是因为在文档加载时`#facebox .hero-link`还不存在。我认为您有两个选项可以帮助您解决此问题。

**选项1）仅在显示facebox后才绑定click事件。就像是：**

```
$(document).bind('reveal.facebox', function() {
  $('#facebox .hero-link').click(function() { alert('click!'); });
}); 
```

**选项 2) 考虑使用[jQuery Live Query 插件](http://brandonaaron.net/docs/livequery/)**

> Live Query 通过绑定事件或自动触发匹配元素的回调来利用 jQuery 选择器的强大功能，即使在页面加载和 DOM 更新之后也是如此。

jQuery Live Query 在识别到 Facebox 修改了 DOM 时会自动绑定 click 事件。然后你应该只需要写这个：

```
$('#facebox .hero-link').click(function() { alert('click!'); }); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T19:14:44.147

或者使用事件委托

这基本上将事件挂钩到容器而不是每个元素，并在容器事件中查询 event.target。

它有很多好处，因为您可以减少代码噪音（无需重新绑定），而且浏览器内存更容易（dom 中绑定的事件更少）

快速示例[在这里](http://pastebin.me/4922b20867e9d)

用于轻松事件委托的[jQuery 插件](http://www.danwebb.net/2008/2/8/event-delegation-made-easy-in-jquery)

PS 事件委托预计将在即将推出的下一个版本 (1.3) 中出现。

# excel - 如何在不使用 VBA 的情况下在 Excel 中执行反向字符串搜索？

> ID：350264
> 
> 赞同：178
> 
> 时间：2008-12-08T17:34:09.623
> 
> 标签：excel, excel-formula

我有一个包含字符串列表的 Excel 电子表格。每个字符串由几个单词组成，但每个字符串中的单词数量不同。

使用内置 Excel 函数（无 VBA），有没有办法隔离每个字符串中的最后一个单词？

例子：

```
  你被归类为人类吗？-> 人类？
否定，我是肉冰棒->冰棒
                  阿齐兹！光！-> 光！
```

* * *

## 回答 #1

> 赞同：224
> 
> 时间：2008-12-08T18:27:04.290

这个已经过测试并且确实有效（基于 Brad 的原始帖子）：

```
=RIGHT(A1,LEN(A1)-FIND("|",SUBSTITUTE(A1," ","|",
     LEN(A1)-LEN(SUBSTITUTE(A1," ",""))))) 
```

如果您的原始字符串可能包含管道“|” 字符，然后用不会出现在您的源中的其他字符替换上面的两个字符。（我怀疑布拉德的原作被破坏了，因为翻译中删除了一个不可打印的字符）。

奖励：它是如何工作的（从右到左）：

`LEN(A1)-LEN(SUBSTITUTE(A1," ",""))`– 原始字符串中的空格计数
`SUBSTITUTE(A1," ","|", ... )`– 仅用 a 替换*最后一个*空格`|`
`FIND("|", ... )`– 查找被替换的绝对位置`|`（即最后一个空格）
`Right(A1,LEN(A1) - ... ))`– 返回之后的所有字符`|`

**编辑：**考虑源文本不包含空格的情况，将以下内容添加到公式的开头：

```
=IF(ISERROR(FIND(" ",A1)),A1, ... ) 
```

现在制作整个公式：

```
=IF(ISERROR(FIND(" ",A1)),A1, RIGHT(A1,LEN(A1) - FIND("|",
    SUBSTITUTE(A1," ","|",LEN(A1)-LEN(SUBSTITUTE(A1," ","")))))) 
```

或者您可以使用`=IF(COUNTIF(A1,"* *")`其他版本的语法。

当原始字符串可能在最后一个位置包含空格时，在计算所有空格时添加一个修剪函数：使函数如下：

```
=IF(ISERROR(FIND(" ",B2)),B2, RIGHT(B2,LEN(B2) - FIND("|",
    SUBSTITUTE(B2," ","|",LEN(TRIM(B2))-LEN(SUBSTITUTE(B2," ","")))))) 
```

* * *

## 回答 #2

> 赞同：90
> 
> 时间：2012-03-02T01:31:54.400

这是我成功使用的技术：

```
=TRIM(RIGHT(SUBSTITUTE(A1, " ", REPT(" ", 100)), 100)) 
```

要获取字符串中的第一个单词，只需从 RIGHT 更改为 LEFT

```
=TRIM(LEFT(SUBSTITUTE(A1, " ", REPT(" ", 100)), 100)) 
```

此外，将 A1 替换为包含文本的单元格。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2013-06-01T01:03:56.937

杰里答案的更强大的版本：

```
=TRIM(RIGHT(SUBSTITUTE(TRIM(A1), " ", REPT(" ", LEN(TRIM(A1)))), LEN(TRIM(A1)))) 
```

无论字符串的长度、前导或尾随空格或其他任何内容如何，​​它都有效，而且它仍然非常简短和简单。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-12-08T18:12:41.497

我在谷歌上找到[了这个](http://www.tech-archive.net/Archive/Excel/microsoft.public.excel.worksheet.functions/2006-09/msg02157.html)，在 Excel 2003 中测试过，它对我有用：

```
=IF(COUNTIF(A1,"* *"),RIGHT(A1,LEN(A1)-LOOKUP(LEN(A1),FIND(" ",A1,ROW(INDEX($A:$A,1,1):INDEX($A:$A,LEN(A1),1))))),A1) 
```

[编辑]我没有足够的代表发表评论，所以这似乎是最好的地方......布拉德C的答案也不适用于尾随空格或空单元格......
[第二次编辑]实际上，它不适用于单字也...

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-08T17:52:00.993

```
=RIGHT(A1,LEN(A1)-FIND("`*`",SUBSTITUTE(A1," ","`*`",LEN(A1)-LEN(SUBSTITUTE(A1," ",""))))) 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-10-27T01:00:36.230

这是非常干净和紧凑的，而且效果很好。

```
{=RIGHT(A1,LEN(A1)-MAX(IF(MID(A1,ROW(1:999),1)=" ",ROW(1:999),0)))} 
```

它不会因为没有空格或一个单词而出现错误陷阱，但这很容易添加。

**编辑：**
这处理尾随空格、单个单词和空单元格场景。我还没有找到破解它的方法。

```
{=RIGHT(TRIM(A1),LEN(TRIM(A1))-MAX(IF(MID(TRIM(A1),ROW($1:$999),1)=" ",ROW($1:$999),0)))} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-05-13T13:41:20.330

```
=RIGHT(TRIM(A1),LEN(TRIM(A1))-FIND(CHAR(7),SUBSTITUTE(" "&TRIM(A1)," ",CHAR(7),
LEN(TRIM(A1))-LEN(SUBSTITUTE(" "&TRIM(A1)," ",""))+1))+1) 
```

这是非常强大的——它适用于没有空格、前导/尾随空格、多个空格、多个前导/尾随空格的句子......我使用 char(7) 作为分隔符而不是竖线“|” 以防万一这是所需的文本项。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-07-24T07:22:32.297

要添加到 Jerry 和 Joe 的答案中，如果您想在最后一个单词之前找到文本，您可以使用：

```
=TRIM(LEFT(SUBSTITUTE(TRIM(A1), " ", REPT(" ", LEN(TRIM(A1)))), LEN(SUBSTITUTE(TRIM(A1), " ", REPT(" ", LEN(TRIM(A1)))))-LEN(TRIM(A1)))) 
```

在 A1 中使用“我的小猫”将导致“我的小”（乔和杰瑞的会给出“猫”

就像 Jerry 和 Joe 隔离最后一个词一样，这将把所有东西都放在那个词的左边（然后把它修剪回来）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-01-21T14:00:37.993

想象一下字符串可以反转。然后真的很容易。而不是处理字符串：

```
"My little cat" (1) 
```

你和你一起工作

```
"tac elttil yM" (2) 
```

在`=LEFT(A1;FIND(" ";A1)-1)`A2 中，你得到`"My"`(1) 和`"tac"`(2)，它是反向`"cat"`的，即 (1) 中的最后一个单词。

有一些 VBA 可以反转字符串。我更喜欢公共 VBA 功能[`ReverseString`](http://www.vbaexpress.com/kb/getarticle.php?kb_id=188)。

按照说明安装上述内容。然后在 A1 中使用您的字符串，例如，`"My little cat"`在 A2 中使用此函数：

```
=ReverseString(LEFT(ReverseString(A1);IF(ISERROR(FIND(" ";A1));
  LEN(A1);(FIND(" ";ReverseString(A1))-1)))) 
```

你会`"cat"`在 A2 中看到。

上面的方法假设单词用空格分隔。该`IF`子句适用于包含单个单词的单元格 = 单元格中没有空格。注意：原始字符串`TRIM`也`CLEAN`很有用。原则上，它从 A1 反转整个字符串，并简单地在反转的字符串中找到与最后一个（反转的）单词（即，`"tac "`）相邻的第一个空格。`LEFT`选择这个词，另一个字符串反转重新构成词的原始顺序 ( `" cat"`)。语句`-1`末尾的删除空白。`FIND`

这个想法是很容易提取字符串中的第一个（！）单词，`LEFT`并`FIND`使用第一个空格。但是，对于最后一个（！）单词，`RIGHT`当您尝试这样做时，该函数是错误的选择，因为不幸的是 FIND 没有您要分析字符串的方向的标志。

因此，整个字符串被简单地颠倒了。`LEFT`并`FIND`正常工作，但提取的字符串是相反的。但是，一旦您知道如何反转字符串，他就没什么大不了了。公式中的第一条`ReverseString`语句完成了这项工作。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-07-01T12:33:17.453

```
=LEFT(A1,FIND(IF(
 ISERROR(
  FIND("_",A1)
 ),A1,RIGHT(A1,
  LEN(A1)-FIND("~",
   SUBSTITUTE(A1,"_","~",
    LEN(A1)-LEN(SUBSTITUTE(A1,"_",""))
   )
  )
 )
),A1,1)-2) 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-06-08T03:47:54.610

复制到一列，选择该列，然后 HOME > Editing > Find & Select, Replace：

[![找什么：](https://i.stack.imgur.com/CMrzN.jpg)](https://i.stack.imgur.com/CMrzN.jpg)

`Replace All`.

星号后面有一个空格。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-08-21T18:29:10.637

我翻译成 PT-BR，因为我也需要这个。

（请注意，我已将空格更改为，`\`因为我只需要路径字符串的文件名。）

```
=SE(ÉERRO(PROCURAR("\",A1)),A1,DIREITA(A1,NÚM.CARACT(A1)-PROCURAR("|", SUBSTITUIR(A1,"\","|",NÚM.CARACT(A1)-NÚM.CARACT(SUBSTITUIR(A1,"\","")))))) 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-07-13T09:35:13.577

实现此目的的另一种方法如下

```
=IF(ISERROR(TRIM(MID(TRIM(D14),SEARCH("|",SUBSTITUTE(TRIM(D14)," ","|",LEN(TRIM(D14))-LEN(SUBSTITUTE(TRIM(D14)," ","")))),LEN(TRIM(D14))))),TRIM(D14),TRIM(MID(TRIM(D14),SEARCH("|",SUBSTITUTE(TRIM(D14)," ","|",LEN(TRIM(D14))-LEN(SUBSTITUTE(TRIM(D14)," ","")))),LEN(TRIM(D14))))) 
```

[![在此处输入图像描述](https://i.stack.imgur.com/1j3D3.png)](https://i.stack.imgur.com/1j3D3.png)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-05-27T10:49:34.857

您也可以通过反转字符串并找到第一个空格来实现这一点

`=MID(C3,2+LEN(C3)-SEARCH(" ",CONCAT(MID(C3,SEQUENCE(LEN(C3),,LEN(C3),-1),1))),LEN(A1))`

1.  反转字符串

`CONCAT(MID(C3,SEQUENCE(LEN(C3),,LEN(C3),-1),1))`

2.  找到反转字符串中的第一个空格

`SEARCH(" ",...`

3.  从字符串的长度中取出在反转字符串中找到的空间的位置并返回该部分

`=MID(C3,2+LEN(C3)-SEARCH...`

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2012-10-18T17:38:11.187

我也有这样的任务，当我完成后，使用上述方法，我想到了一个新方法：你为什么不这样做：

1.  反转字符串（“string one”变为“eno gnirts”）。
2.  使用旧的 Find（从左到右硬编码）。
3.  再次将其反转为可读字符串。

这听起来如何？

# iis - IIS 应用程序池中内存限制的最佳做法

> ID：350277
> 
> 赞同：10
> 
> 时间：2008-12-08T17:37:01.257
> 
> 标签：iis, memory

我想知道人们使用什么作为限制 IIS 上的内存的最佳实践 [5/6/7]。我在具有 4GB 物理内存且没有 /3GB 开关的 32 位 Web 服务器上运行。我目前将我的应用程序池限制为 1GB 已用内存。这是不是太低了？有什么想法吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-08T22:20:09.343

应用程序池中的所有限制都是针对表现不佳的应用程序。更具体地说：

1.  防止坏应用干扰好应用。
2.  尝试尽可能多地保持不良应用程序运行。

有鉴于此，答案当然是：视情况而定。

如果您的应用程序正在泄漏，那么它会在 1.2 - 1.6 Gb 左右崩溃（如果内存可用）。所以 1 Gb 是明智的。如果在正常运行期间您的应用程序消耗不超过 100 Mb 并且您在服务器上有许多应用程序池，那么您应该将限制设置得更低，以防止一个应用程序损坏其他应用程序。

总结：1 Gb 是明智的。达到限制应被视为应用程序崩溃，应进行调试和修复。

[David Wang 博客](http://blogs.msdn.com/david.wang/default.aspx)是关于这些问题的一个很好的资源。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-23T00:05:15.597

[MS Field Engineer 有一篇](http://blogs.msdn.com/pfedev/archive/2009/01/22/memory-based-recycling-in-iis-6-0.aspx)关于这个主题的精彩文章。

# c# - 进程启动和模拟

> ID：350278
> 
> 赞同：7
> 
> 时间：2008-12-08T17:37:36.043
> 
> 标签：c#, .net, iis-5

我在 ASP.NET 2.0 的模拟上下文中启动进程时遇到问题。

我正在我的 Web 服务代码中启动新进程。IIS 5.1、.NET 2.0

```
[WebMethod]
public string HelloWorld()
{
    string path = @"C:\KB\GetWindowUser.exe";
    ProcessStartInfo startInfo = new ProcessStartInfo();
    startInfo.WorkingDirectory = Path.GetDirectoryName(path);
    startInfo.FileName = path;
    startInfo.UseShellExecute = false;
    startInfo.CreateNoWindow = true;
    startInfo.ErrorDialog = false;
    startInfo.RedirectStandardOutput = true;
    startInfo.RedirectStandardError = true;
    Process docCreateProcess = Process.Start(startInfo);

    string errors = docCreateProcess.StandardError.ReadToEnd();
    string output = docCreateProcess.StandardOutput.ReadToEnd();
} 
```

“C:\KB\GetWindowUser.exe”是包含以下代码的控制台应用程序：

```
static void Main(string[] args)
{
    Console.WriteLine("Windows: " + WindowsIdentity.GetCurrent().Name);
} 
```

当我在没有模拟的情况下调用 Web 服务时，一切正常。

当我打开模拟时，以下错误写入 Web 服务代码中的“错误”变量：

未处理的异常: System.Security.SecurityException: 访问被拒绝。\r\n\r\n 在 System.Security.Principal.WindowsIdentity.GetCurrentInternal(TokenAccessLevels desiredAccess, Boolean threadOnly)\r\n 在 System.Security.Principal.WindowsIdentity .GetCurrent()\r\n at ObfuscatedMdc.Program.Main(String[] args)\r\n失败的程序集区域是:\r\nMyComputer

模拟用户是本地管理员，可以访问 C:\KB\GetWindowUser.exe 可执行文件。

当我在 ProcesStartInfo 属性域、用户和密码中明确指定窗口用户时，我收到以下消息：http: [//img201.imageshack.us/img201/5870/pstartah8.jpg](http://img201.imageshack.us/img201/5870/pstartah8.jpg)

是否可以从 asp.net (IIS 5.1) 使用与 ASPNET 不同的凭据启动进程？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T18:59:56.190

您必须将特权代码放入 GAC（或以完全信任的方式运行）。

GAC 中的代码必须声明 XXXPermission，其中 XXX 是您请求的任何权限，无论是模拟、访问硬盘驱动器还是您拥有的权限。

您应该在之后立即恢复断言。

您应该确保您放在 GAC 中的 DLL 上的 API 没有被滥用的机会。例如，如果您正在编写一个允许用户通过命令行应用程序备份服务器的网站，那么您的 API 应该旧时公开一个类似“BackUp()”的方法，而不是“LaunchAribitraryProcess(string path)”

web.config 文件也必须设置模拟，否则您将遇到 NTFS 权限问题以及 CAS。

这是[完整的解释](http://msdn.microsoft.com/en-us/library/aa302425.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-12T02:32:39.033

您也可以尝试将代码包装在里面

```
using (Impersonator person = new Impersonator("domainName", "userName",
"password")
{
    // do something requiring special permissions
} 
```

如 [http://www.devnewsgroups.net/group/microsoft.public.dotnet.framework.windowsforms/topic62740.aspx中所述](http://www.devnewsgroups.net/group/microsoft.public.dotnet.framework.windowsforms/topic62740.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T18:01:19.630

你到底想做什么？我不太明白您的代码在创建不同的可执行文件方面有什么意义。它看起来很奇怪。或许先说明您要解决的业务问题会更有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T18:26:07.647

看起来您正试图让 IIS 服务模拟具有比服务本身更高权限的用户（在本例中为管理员）。Windows 将此作为安全漏洞加以阻止，因为此时您基本上是在乞求某人接管您的系统。可能有一种方法可以解决这个限制，但不要这样做——这是为了你自己好。

相反，让 IIS 模拟具有有限权限的用户，该用户具有您需要的权限。例如，创建一个用户帐户，该帐户仅拥有您希望 Web 服务写入的文件夹，或任何其他适当的权限组合。如果冒充受限用户，您将不会看到此错误代码，但应该仍然能够调用您在此处拥有的良性可执行文件。

# c# - How to restore minimized window without flicker

> ID：350287
> 
> 赞同：6
> 
> 时间：2008-12-08T17:46:28.243
> 
> 标签：c#, windows, winapi

I've made an expose-clone for Vista that sometimes need to restore a minimized window. I've managed to do this with the SetWindowPlacement function. The problem is that this also repaints the window which looks like crap after the window nicely has slided into the screen.

This is the code i use to bring a window to the top and give it focus:

```
 private static void ActivateWindow(IntPtr windowToShow)
    {
        RectAPI r = new RectAPI();
        Win32.GetWindowRect(windowToShow, ref r);

        if (r.top == -32000) //r.top is -32000 if the window is in minimized state
        {
            WINDOWPLACEMENT wp = new WINDOWPLACEMENT();
            Win32.GetWindowPlacement(windowToShow, ref wp);

            if (wp.flags == WindowPlacementFlags.WPF_RESTORETOMAXIMIZED)
                wp.showCmd = cmdShow.SW_SHOWMAXIMIZED;
            else
                wp.showCmd = cmdShow.SW_RESTORE;

            Win32.SetWindowPlacement(windowToShow, ref wp);
        }

        Win32.SetForegroundWindow(windowToShow);
    } 
```

If i use it on a window that is already restored it will only call SetForegroundWindow and the window will get to the top of the z-order and get focus without any flicker.

But if i call it on a minimized window I also have to use SetWindowPlacement to bring back the window to restored state. This is what causes the window to repaint and flicker :/

There has to be a way to restore a minimized window without the flicker because the built in window manager does this.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T22:06:07.890

一种方法是使用双缓冲技术：绘制到屏幕外的位图，然后恢复，然后将位图blit 到屏幕上。但是，如果恢复最小化窗口是唯一需要它的场景，这似乎有点过头了。也许其他人会有更好的想法？

此外，如果您绘制整个窗口客户区，您可以禁用 WM_ERASEBKGND（或者说您处理了它但不做任何事情）以避免不必要的填充背景然后重绘序列。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T23:02:56.793

[MSDN 上的此链接](http://msdn.microsoft.com/en-us/library/b367a457.aspx)将解释您希望如何处理您的案例中的窗口绘画。窗口刷新或最小化/最大化等窗口事件将需要重新绘制窗口或窗口区域。

编码快乐！！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T12:50:20.757

我是 OP……不小心吃了我的饼干。

研究了 windows flip3d 和任务栏如何更接近地管理它，并且他们实际上在开始拇指动画**之前重新绘制了窗口。**尝试最小化一个窗口，然后用flip3d恢复它，在恢复之前你会在3d窗口上看到一个小闪烁。

用我的应用程序尝试了同样的事情，它看起来好多了，不完美但可以接受：/

# asp.net - 什么时候可以在页面上禁用事件验证？

> ID：350291
> 
> 赞同：2
> 
> 时间：2008-12-08T17:49:09.080
> 
> 标签：asp.net, asp.net-ajax

我正在使用 ASP.NET ajax 从页面中动态添加/删除控件，而不使用完整的回发。用户界面非常复杂。在某些情况下，当页面上的控件导致完整回发时，通过异步回发更改控件后，我收到此错误：

[无效的回发或回调参数。使用 '<pages enableEventValidation="true"/>' 启用事件验证](https://stackoverflow.com/questions/228969/aspnet-invalid-postback-or-callback-argument-event-validation-is-enabled-using)

我可以通过在页面级别设置 EnableEventValidation="false" 来修复它。

这样做有什么影响？有时可以这样做还是这是一种黑客行为？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T19:44:03.293

如果你有一个所见即所得的输入文本框或一个需要 HTML 的文本框，那么你必须禁用验证或做一些 JavaScript hack。

问题是您需要提供彻底的验证以防止 XSS 等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T18:21:25.643

我肯定会说这是一个黑客。

就降低代码复杂性而言，您是否尝试过从某些控件继承并将大量代码放在它们后面？这听起来绝对像是重构的案例！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-03T15:43:31.990

它在他们的数据库教程中特别指出，目前您必须禁用 EventValidation。这是一个错误。 [http://www.asp.net/AJAX/AjaxControlToolkit/Samples/Walkthrough/CCDWithDB.aspx](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/Walkthrough/CCDWithDB.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T17:57:44.617

它可能不会直接回答您的问题，或者似乎相关......

但是，如果您的 UI 非常复杂，则它可能有问题。出于显而易见的原因，遵循 KISS 是一个好主意。

如果您的 UI 很复杂，那么您很可能不理解它，因此您会遇到更多问题，其中很多您可能永远不会注意到。您的问题和错误将不容易追踪或找出，并且很可能是模糊的，并从问题的实际原因中删除。

其次，如果它对您来说很复杂，并且您编写了它，那么任何使用它的人都可能无法理解。即使您只是想管理代码，复杂性也可能反映在演示文稿中。

我建议你看看重新设计 UI，这样它就不会那么复杂了。无论如何，如果您再次查看它总是会更好，通常直到第三次或第四次尝试解决问题时才会有好的解决方案。

# javascript - 如何让 jQuery 选择带有 . （句号）在他们的身份证？

> ID：350292
> 
> 赞同：179
> 
> 时间：2008-12-08T17:49:42.573
> 
> 标签：javascript, jquery, jquery-selectors

给定以下类和控制器操作方法：

```
public School
{
  public Int32 ID { get; set; }
  publig String Name { get; set; }
  public Address Address { get; set; }
}

public class Address
{
  public string Street1 { get; set; }
  public string City { get; set; }
  public String ZipCode { get; set; }
  public String State { get; set; }
  public String Country { get; set; }
}

[Authorize(Roles = "SchoolEditor")]
[AcceptVerbs(HttpVerbs.Post)]
public SchoolResponse Edit(Int32 id, FormCollection form)
{
  School school = GetSchoolFromRepository(id);

  UpdateModel(school, form);

  return new SchoolResponse() { School = school };
} 
```

以及以下形式：

```
<form method="post">
  School: <%= Html.TextBox("Name") %><br />
  Street: <%= Html.TextBox("Address.Street") %><br />
  City:  <%= Html.TextBox("Address.City") %><br />
  Zip Code: <%= Html.TextBox("Address.ZipCode") %><br />
  Sate: <select id="Address.State"></select><br />
  Country: <select id="Address.Country"></select><br />
</form> 
```

我能够更新学校实例和学校的地址成员。这是相当不错的！感谢 ASP.NET MVC 团队！

但是，如何使用 jQuery 选择下拉列表以便我可以预先填充它？我意识到我可以在服务器端执行此操作，但页面上还会有其他影响列表的动态元素。

以下是我到目前为止所拥有的，它不起作用，因为选择器似乎与 ID 不匹配：

```
$(function() {
  $.getJSON("/Location/GetCountryList", null, function(data) {
    $("#Address.Country").fillSelect(data);
  });
  $("#Address.Country").change(function() {
    $.getJSON("/Location/GetRegionsForCountry", { country: $(this).val() }, function(data) {
      $("#Address.State").fillSelect(data);
    });
  });
}); 
```

* * *

## 回答 #1

> 赞同：303
> 
> 时间：2008-12-08T17:53:45.513

来自[谷歌群组](http://groups.google.com/group/jquery-en/browse_thread/thread/ba072168939b245a?pli=1)：

> 在每个特殊字符前使用两个反斜杠。
> 
> jQuery 选择器中的反斜杠转义下一个字符。但是您需要其中两个，因为反斜杠也是 JavaScript 字符串的转义字符。第一个反斜杠转义第二个反斜杠，在字符串中为您提供一个实际的反斜杠 - 然后转义 jQuery 的下一个字符。

所以，我猜你在看

```
$(function() {
  $.getJSON("/Location/GetCountryList", null, function(data) {
    $("#Address\\.Country").fillSelect(data);
  });
  $("#Address\\.Country").change(function() {
    $.getJSON("/Location/GetRegionsForCountry", { country: $(this).val() }, function(data) {
      $("#Address\\.State").fillSelect(data);
    });
  });
}); 
```

另请查看[如何通过具有 CSS 表示法中使用的字符的 ID 选择元素？](https://learn.jquery.com/using-jquery-core/faq/how-do-i-select-an-element-by-an-id-that-has-characters-used-in-css-notation/)关于 jQuery 常见问题解答。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-20T18:35:43.040

如果 id 包含空格，则不能使用 jQuery id 选择器。使用属性选择器：

```
$('[id=foo bar]').show(); 
```

如果可能，还要指定元素类型：

```
$('div[id=foo bar]').show(); 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2014-04-28T11:34:20.420

为 Jquery 转义：

```
function escapeSelector(s){
    return s.replace( /(:|\.|\[|\])/g, "\\$1" );
} 
```

用法示例：

```
e.find('option[value='+escapeSelector(val)+']') 
```

更多信息[在这里](http://learn.jquery.com/using-jquery-core/faq/how-do-i-select-an-element-by-an-id-that-has-characters-used-in-css-notation/)。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-01-29T20:57:31.527

刚刚发布的 ASP.NET MVC 候选版本修复了这个问题，它现在将 ID 属性的点替换为下划线。

```
<%= Html.TextBox("Person.FirstName") %> 
```

呈现给

```
<input type="text" name="Person.FirstName" id="Person_FirstName" /> 
```

有关更多信息，请查看从第 14 页开始的发行说明。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-02-04T12:36:48.483

这记录在[jQuery Selectors 文档](http://api.jquery.com/category/selectors/)中：

> 要将任何元字符（例如 `!"#$%&'()*+,./:;<=>?@[\]^`{|}~`）用作名称的文字部分，必须使用两个反斜杠对其进行转义：`\\`. 例如，带有 的元素 `id="foo.bar"`可以使用选择器`$("#foo\\.bar")`。

简而言之，前缀`.`with`\\`如下：

```
$("#Address\\.Country") 
```

# 为什么`.`在我的 ID 中不起作用？

问题是`.`具有特殊意义的，后面的字符串被解释为类选择器。所以`$('#Address.Country')`会匹配`<div id="Address" class="Country">`。

当转义为`\\.`时，点将被视为没有特殊意义的普通文本，与您想要的 ID 匹配`<div id="Address.Country">`。

这适用于所有`!"#$%&'()*+,./:;<=>?@[\]^`{|}~`在 jQuery 中作为选择器具有特殊意义的字符。只需预先`\\`将它们视为普通文本。

# 为什么是 2 `\\`？

如 bdukes 回答中所述，我们需要 2 个`\`字符是有原因的。`\`将转义 JavaScript 中的以下字符。当 JavaScript 解释字符串时`"#Address\.Country"`，它会看到`\`, 解释它的意思是在字符串作为参数传入时*将后面的字符乱写*并*删除*`$()`它。这意味着 jQuery 仍会将字符串视为`"#Address.Country"`.

这就是第二个`\`发挥作用的地方。第一个告诉 JavaScript 将第二个解释为文字（非特殊）字符。这意味着第二个将被 jQuery 看到并理解以下 `.` 字符是文字​​字符。

呸！也许我们可以想象一下。

```
//    Javascript, the following \ is not special.
//         | 
//         |
//         v    
$("#Address\\.Country");
//          ^ 
//          |
//          |
//      jQuery, the following . is not special. 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-10-02T12:51:34.087

使用两个反斜杠没关系，它的工作。但是，如果您使用的是动态名称，我的意思是变量名称，则需要替换字符。

如果您不想更改变量名称，可以这样做：

```
var variable="namewith.andother";    
var jqueryObj = $(document.getElementById(variable)); 
```

比你有你的 jquery 对象。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-05-17T15:06:46.793

我用 jquery docs 给出的解决方案解决了这个问题

我的功能：

```
//funcion to replace special chars in ID of  HTML tag

function jq(myid){

//return "#" + myid.replace( /(:|\.|\[|\]|,)/g, "\\$1" );
return myid.replace( /(:|\.|\[|\]|,)/g, "\\$1" );

} 
```

注意：我删除了“#”，因为在我的代码中我将 ID 与另一个文本连接起来

字体： [带有特殊字符的 Jquery Docs 选择元素](http://learn.jquery.com/using-jquery-core/faq/how-do-i-select-an-element-by-an-id-that-has-characters-used-in-css-notation/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-08T19:13:30.750

只是附加信息：检查此[ASP.NET MVC 问题 #2403](http://www.codeplex.com/aspnet/WorkItem/View.aspx?WorkItemId=2403)。

在问题得到解决之前，我使用我自己的扩展方法，如 Html.TextBoxFixed 等，它只是在 id 属性（而不是在 name 属性中）用下划线替换点，这样你就可以像 $("#Address_Street") 一样使用 jquery但在服务器上，它就像 Address.Street。

示例代码如下：

```
public static string TextBoxFixed(this HtmlHelper html, string name, string value)
{
    return html.TextBox(name, value, GetIdAttributeObject(name));
}

public static string TextBoxFixed(this HtmlHelper html, string name, string value, object htmlAttributes)
{
    return html.TextBox(name, value, GetIdAttributeObject(name, htmlAttributes));
}

private static IDictionary<string, object> GetIdAttributeObject(string name)
{
    Dictionary<string, object> list = new Dictionary<string, object>(1);
    list["id"] = name.Replace('.', '_');
    return list;
}

private static IDictionary<string, object> GetIdAttributeObject(string name, object baseObject)
{
    Dictionary<string, object> list = new Dictionary<string, object>();
    list.LoadFrom(baseObject);
    list["id"] = name.Replace('.', '_');
    return list;
} 
```

# ruby-on-rails - What is the earliest callback one can hook in the Rails Framework?

> ID：350298
> 
> 赞同：1
> 
> 时间：2008-12-08T17:53:16.590
> 
> 标签：ruby-on-rails, callback

I have found the before_dispatch and after_dispatch in dispatcher.rb but I need to access something earlier. Like around when Rails.public_path is defined.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-14T23:42:59.323

不确定您要做什么，但是您可以看一下`config/boot.rb`（请不要更改）。在那里，您会发现它会加载文件（`config/preinitializer.rb`如果存在）。不过，这可能有点矫枉过正，您可能可以通过在`config/initializers/`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-10T16:09:32.953

如果是 Mongrel 或 Apache 需要，你确定不能通过配置来完成吗？

# ruby-on-rails - API Key + Secret Key 签名的 Rails 插件

> ID：350299
> 
> 赞同：15
> 
> 时间：2008-12-08T17:53:18.307
> 
> 标签：ruby-on-rails, ruby, api, security, api-key

是否有 Rails 插件或 ruby​​gem 可以为您提供将 api 添加到 Rails 应用程序的起点？我们要使用 API Key/Secret Key 模型，API 也应该是可版本化的。有没有什么东西可以给我们一些，如果不是全部的话？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-04-02T06:48:14.677

查看 AuthLogic 的这个插件：

[http://github.com/phurni/authlogic_api](http://github.com/phurni/authlogic_api)

我认为这可以满足您的需求。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-12T15:54:18.223

[OAuth 插件](http://code.google.com/p/oauth/)可能对密钥有用。看起来[OAuth](http://oauth.net/)仅用于用户身份验证，但如果您自动生成访问令牌并将其提供给开发人员，而不是使用请求令牌和帐户授权进行交互式用户进程，那么您基本上拥有一个非常安全的 API 密钥系统。而且插件会很好地插入。

除此之外，对 rails 路由的一些很好的使用（在 get、post、put 等上调用不同操作的条件以及 /api/v1/ 的前缀）和格式（format.xml、format.js 等） ) 提供了一种非常好的方式来构建 RESTful API，而无需真正需要插件。

# c# - Web forwarding proxy in C# or PHP available?

> ID：350303
> 
> 赞同：0
> 
> 时间：2008-12-08T17:55:19.673
> 
> 标签：c#, php, proxy, http-headers, forwarding

I have some shared server web hosting in the States (I'm from the UK), which allows me to publish PHP and .NET applications. I cannot install my own software onto the remote server, but I'd like to set up a web forwarding proxy for accessing sites that serve different content depending on what country you're from.

My C# and ASP.NET skills are OK, but my PHP is very limited. Are there any solutions that anyone would recommend for this sort of problem? The proxies I've investigated all seem to require installation on the server machine itself, whereas I'm just looking for something that's accessible from a URL.

Obviously, as the requests are coming from the UK, the headers will have to be manipulated by the proxy before forwarding them on. I was going to code my own HTTP handler in C#, but I don't want to reinvent the wheel if there's something out there already ;)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T10:27:21.467

也许这个脚本对你有帮助？[代理服务器](http://sourceforge.net/projects/poxy/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T19:24:03.287

虽然很老，但 Org.Mentalis.Proxy 可能是 C# 中示例代理实现的一个很好的起点。你可以在这里找到它：[http ://www.mentalis.org/soft/projects/proxy/](http://www.mentalis.org/soft/projects/proxy/)

# javascript - 如何知道用户当前是否正在使用 Javascript 阅读页面？

> ID：350308
> 
> 赞同：9
> 
> 时间：2008-12-08T17:58:17.953
> 
> 标签：javascript, ajax

我正在制作一个带有动态内容的网页，该网页通过 AJAX 轮询进入视图。页面 JS 偶尔会下载更新的信息并在用户阅读其他信息时将其呈现在页面上。这种事情对带宽和处理时间来说是昂贵的。我希望在未查看页面时暂停轮询。

我注意到我打开的大多数网页大部分时间都在最小化或未查看的标签中。我希望能够暂停脚本，直到实际查看页面。

我不知道该怎么做，它似乎试图突破 html DOM 的沙箱并进入用户的系统。如果 JS 引擎不知道它的渲染环境，这可能是不可能的。我什至从未见过其他网站这样做（并不是说用户打算看到它......）

因此，我认为这是一个有趣的讨论问题。您将如何编写一个 CPU 很重的 Web 应用程序以在不使用时暂停？给用户一个暂停按钮是不可靠的，我希望它是自动的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T18:13:28.577

你最好的解决方案是这样的：

```
 var inactiveTimer;
 var active = true;
 function setTimer(){
  inactiveTimer = setTimeOut("stopAjaxUpdateFunction()", 120000); //120 seconds
 }
 setTimer();
 document.onmouseover = function() { clearTimeout ( inactiveTimer ); 
                                     setTimer(); 
                                     resumeAjaxUpdate();
  }; //clear the timer and reset it.
 function stopAjaxUpdateFunction(){
  //Turn off AJAX update
  active = false;   
 }
 function resumeAjaxUpdate(){
  if(active == false){
   //Turn on AJAX update
   active = true;
  }else{
   //do nothing since we are still active and the AJAX update is still on.
  }    
 } 
```

stopAjaxUpdateFunction 应该停止 AJAX 更新进度。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-08T18:06:23.863

如何设置一个“不活动超时”，每次在 DOM 中接收到鼠标或键盘事件时都会重置它？我相信这就是大多数 IM 程序决定你“离开”的方式（尽管他们通过在系统范围级别挂钩输入消息来做到这一点）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-08T18:01:30.787

我之前在一个研究项目中研究过这个问题。当时（2-3 年前）我没有找到从浏览器获取有关您是否被最小化的信息的方法:(

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-08T18:28:31.433

首先检查窗口何时失去焦点并获得焦点。

```
window.onblur = function () { /* stop */ };
window.onfocus =  function () { /* start */ }; 
```

此外，由于各种原因，用户可能会停止阅读页面而不会导致其失去焦点（例如，他起身并离开计算机）。在这种情况下，您必须假设在一段时间不活动（没有鼠标或键盘事件）之后，用户的注意力已经离开了页面。执行此操作的代码在另一个答案中进行了描述。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-04T00:52:41.897

我知道您已经接受了一个答案，但出于各种原因，我个人会结合使用此处提到的几个答案，包括：

*   使用鼠标事件只会疏远精通基于键盘浏览的用户。
*   使用模糊/焦点事件不允许去泡茶的用户;-)

我很可能会使用以下内容作为指导：

```
var idleTimer, userIsIdle, pollingTimer;
document.onkeydown = document.onmousemove = resetTimer;

window.onload = function () {
    pollingTimer = window.setTimeout(runPollingFunction, 30000);
    resetTimer();

    /* IE's onblur/onfocus is buggy */ 
    if (window.navigator.appName == "Microsoft Internet Explorer")
        document.onfocusin  = resetTimer,
        document.onfocusout = setIdle;
    else
        window.onfocus = resetTimer,
        window.onblur = setIdle;
}
function resetTimer() {
    if (userIsIdle)
        setBack();

    window.clearTimeout(idleTimer);
    idleTimer = window.setTimeout(setIdle, 120000); // 2 minutes of no activity    
}
function setIdle() {
    userIsIdle = true;
    window.clearTimeout(pollingTimer); // Clear the timer that initiates polling
    window.clearTimeout(setIdle);
}
function setBack() {
    userIsIdle = false;
    runPollingFunction(); // call the polling function to instantly update page
    pollingTimer = window.setTimeout(runPollingFunction, 300000);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T18:07:12.567

您可以监听 mousemove 和 keypress 事件。如果其中一个在过去 X 秒内被触发，则继续进行更新。否则不要更新。

它并不完美，但我认为这是你可以用纯 JS 做的最好的事情。

如果您想冒险进入 Flash、Silverlight 或 Java 的世界，您可以从浏览器中获取更多信息。

# .net - 带有页面刷新和书签的 ASP.NET ViewState 回发

> ID：350310
> 
> 赞同：4
> 
> 时间：2008-12-08T17:59:13.583
> 
> 标签：.net, asp.net, post, postback, viewstate

ASP.NET ViewState 功能有时可能是一把双刃剑。我的大部分项目都依赖它，它大大加快了开发速度。

我的问题是，有时用户会尝试刷新页面，这会导致视图状态丢失，有时用户可能想要为页面添加书签，但是当取回时，视图状态将丢失。

当用户尝试刷新页面时，现代浏览器将显示一个愚蠢的对话框，该页面是根本不希望的 POST 操作（例如 asp 回发）的结果。

我想知道他们是一种继续使用 ViewState 和回发模型但没有刷新对话框缺点的方法。（如果可能的话，为页面添加书签。）

我可能想要做的一个例子是在它们旁边有一个带有记录和复选框的页面，用户可以选择检查他们想要删除的所有记录，然后单击删除按钮。用户单击删除后，记录在服务器上进行分析，新页面列出所有使用确认删除按钮选择的记录。现在，如果用户单击刷新，他们会得到这个愚蠢的框来确认他们是否要发布。

我知道 ViewState 是使用 Post Back 模型的结果，这意味着大多数 asp.net 页面都是 POST 操作的结果，但我想知道是否有任何解决方法。

我认为可能有效的解决方法：
在 Page_Unload 事件中，在使用唯一 id 的会话中保存视图状态，并将用户重定向到具有唯一 id 作为查询字符串参数的同一页面，在页面加载后使用 url 中的唯一 id视图状态从会话中加载并注入当前页面。这种方法将允许用户刷新页面并始终返回相同的结果。

PS 我知道我可以使用`Response.Redirect()`和/或查询字符串，但我想使用简单的`ViewState`

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-10T14:55:06.153

我的 2 美分：与其使用**ViewState**沙袋的简单性，不如使用**Session**的简单性——这确实是同样的简单性，您不必担心页面刷新和其他东西。此外，会话更加灵活，因为您可以使用它来存储不仅仅是内置类型而不影响性能（您也可以使用 ViewState 来存储，但会影响性能）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T10:02:17.070

我将在这里一次发表我的意见。

对话警告您重复发帖的事实是 IMO 的一件好事。如果它是一个结帐页面并且重新提交会以某种方式最终再次向用户的信用卡重新收费怎么办。我同意对话中的措辞可能会更好，但我们就在我们所在的位置。

如果您考虑书签行为，这意味着我将想要一次又一次地重新访问该页面，但我的会话很可能在此之前就已经结束了。因此，您可以将视图状态保存到 GUID，但随后您可能必须将该视图状态永久保存在数据库中。如果页面同时发生变化怎么办？该视图状态现在将无效。

当然，在您的情况下，您需要一个查询字符串参数，该参数将从数据库中加载您的用户数据并在 page_load 期间正常填充页面？www.my-site.com/Customer.aspx?Id=90401 或类似的东西。

我的建议是不要与工具作斗争。希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-01T01:01:57.597

@Asaf - 我没有否决你的答案，但这里有几个原因：

1）不能在查询字符串中存储复杂类型 2）查询字符串在 IE 中被限制在 2Kb 左右，这不是很多 3）误用 GET 方法 - GET 字面意思是“获取”数据（例如google 的搜索栏）和 POST 用于将数据“发布”到服务器以操作服务器上的数据（例如联系表格）。4) 任何依赖 Page.IsPostBack 的东西都会停止工作。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-21T13:18:02.970

这可能不是一个优雅的解决方案，但我认为如果您将表单方法更改为 GET，它可以解决您的书签问题和刷新问题。

这与使用查询字符串*相同*，但 VIEWSTATE 的抽象保持不变。

# nhibernate - 在 NHibernate 中使用中间表上的附加数据

> ID：350311
> 
> 赞同：1
> 
> 时间：2008-12-08T18:00:01.553
> 
> 标签：nhibernate, nhibernate-mapping

我正在从事一个项目，该项目用于将有关产品的信息输入到文档中。一个部分有一个表格，可以根据特定产品的需要多次填写。然后可以在多个相关文档中共享此表格上的信息。典型的多对多情况。不同之处在于，在中间表上，我想为该特定文档的该表单条目存储特定信息。

以下是一些表定义来说明这一点：

```
Document(
  Id int identity(1,1),
  Name nvarchar(256)
)

Form(
  Id int identity(1,1),
  FormData nvarchar(max)
)

DocumentForms(
  DocumentId int,
  FormId int,
  DocumentFormNumber varchar(64)
) 
```

还有一些课程：

```
public class Document{
  public int Id { get; protected set; }
  protected IList<Form> Forms { get; set; }
}

public class Form {
  public int Id { get; protected set; }
  public string DocumentFormNumber { get; set; }
  public string FormData { get; set; }
} 
```

作为与 Document 的多对多关系的一部分，在读取表单时，是否有一种方法可以创建支持读取附加数据的映射？加载具有多对多关系的数据时是否需要使用存储过程？我仍然需要能够加载 Form 对象而不将它们作为文档的一部分，但是一旦将它们添加到文档中，我需要它们具有基于一些简单规则生成的数字。但这个数字显然是特定于文件的。因此，虽然下一个文档可能使用相同的表单数据，但它需要一个新编号。

关于如何实现这一点的任何建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T20:06:16.133

我在 Billy McCafferty 的博客文章中找到了[答案](http://devlicio.us/blogs/billy_mccafferty/archive/2008/07/11/when-to-use-many-to-one-s-vs-many-to-many-with-nhibernate.aspx)。

# c# - 在 ASP.NET 页面上显示 XML 的最简单方法

> ID：350314
> 
> 赞同：3
> 
> 时间：2008-12-08T18:01:04.890
> 
> 标签：c#, asp.net, xml, vb.net

我在 XmlDocument 中有一些 XML，我想在 ASP.NET 页面上显示它。（XML 应该在一个控件中；该页面将包含其他内容。）现在，我们正在为此使用 Xml 控件。麻烦的是，XML 显示时没有缩进。丑陋。

看来我应该为它创建一个 XSLT，但这似乎有点无聊。我宁愿把它扔到一个控件中，让它自动解析 XML 并正确缩进。有没有简单的方法可以做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T18:07:34.970

您可以尝试使用 XmlWriter/XmlTextWriter，设置 writer 的 Indentation 属性，写入 StringBuilder 或 MemoryStream，然后在 <pre> 标签内输出结果

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T18:06:12.163

一种快速（且肮脏）的方法是使用 IFrame。

事实上，XSLT 是格式化 XML 以供显示的“理想”方式。另一种选择是手动解析它以进行显示。

要使用 iframe：ASPX 端：

```
< iframe runat="server" id="myXMLFrame" src="~/MyXmlFile.xml" /></pre> 
```

代码方面：

```
myXMLFrame.src = Page.ResolveClientUrl("~/MyXmlFile.xml") 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T12:48:32.697

[在 IE 中查看时，您可以在http://www.dpawson.co.uk/xsl/sect4/N10301.html#d15977e117](http://www.dpawson.co.uk/xsl/sect4/N10301.html#d15977e117)找到 IE 用于将 XML 转换为 HTML 的 XSLT 的略微修改版本。

我已经在 WinForms 应用程序的 WebBrowser 控件中使用了它，而且它的工作原理很吸引人。不过，我还没有在 FireFox/Chrome/Safari/Operat 中测试过它。

# sql - 一个 400GB 表，一个查询 - 需要调整的想法 (SQL2005)

> ID：350318
> 
> 赞同：13
> 
> 时间：2008-12-08T18:02:56.837
> 
> 标签：sql, sql-server, database, performance, indexing

我有一个要优化的大表。我正在使用 MS-SQL 2005 服务器。我将尝试描述它的使用方式，如果有人有任何建议，我将不胜感激。

该表大约 400GB，有 1 亿行，每天插入 100 万行。该表有 8 列、1 个数据列和 7 列用于查找/排序。

```
 k1 k2 k3 k4 k5 k6 k7 d1 
```

在哪里

```
 k1: varchar(3), primary key - clustered index, 10 possible values
 k2: bigint, primary key - clustered index, total rows/10 possible values
 k3: int, 10 possible values
 k4: money, 100 possible values
 k5: bool
 k6: bool
 k7: DateTime 
```

只运行一个选择查询，如下所示：

```
 SELECT TOP(g) d1 FROM table WITH(NOLOCK)
  WHERE k1 = a
  AND k3 = c
  AND k4 = d
  AND k5 = e
  AND k6 = f
  ORDER BY k7 
```

其中 g = 大约 100 万 这个查询我们每天运行大约 10 次（通常在插入发生时），大约需要 5-30 分钟。

所以我目前只有两个主键列上的聚集索引。我的问题是：我应该添加哪些索引来提高此查询的性能？

每列上的单独索引是一个不错的选择吗？我认为单个索引将占用大约 5-8GB。DB 服务器总共有 8GB RAM。

请不要说最好的事情是实验。这类似于“我不知道，自己解决”:)

非常感谢任何提示！

* * *

由 doofledorfer 编辑——

您在这里引起了过早优化的爆发，如果不是直接建议“最好的事情就是进行实验”的话。如果您需要有用的帮助，您需要澄清一些问题。

-- 多夫多夫

* * *

编辑：对迄今为止的帖子的评论现在连同查询计划一起发布在下面 - Flibble 先生

* * *

> 您可能受 I/O 限制

是的，它不受 CPU 限制。磁盘访问量很高。似乎使用了所有可用的 RAM。它是否被明智地使用还有待观察。

> 你说你不能分割数据，因为所有的数据都用完了：不可能

我的意思是所有数据都在某个时候使用 - 并不是每个用户在每个查询中都使用所有数据。我当然可以拆分数据，但到目前为止，我不明白为什么对表进行分区比使用聚集索引更好。

> 为什么选择这些类型 VARCHAR 可能应该是 INT，因为它只能是几个值。其余的都足够明智，Money 代表现实生活中的货币价值，而 bigint 是 ID，而 bools 是 onny、offy 类型的东西 :)
> 
> 有机会我们可以看看插入语句、TSQL 或 bulkinsert

TSQL。它基本上是 INSERT INTO 表值（k1，k2，k3，k4，k5，k6，d1）。唯一有趣的是尝试了许多重复插入，并且使用 k1 & k2 PK 约束来防止重复数据进入数据库。我在设计时（现在）相信这是一种最快的找出重复数据的方法。

> 你能告诉你的插入发生的频率吗 每 10 分钟左右插入运行（ADO.NET）一次可能 10K 并且需要几分钟。我估计目前一整天的插入占用了一天中 40% 的时间。
> 
> DateTime 字段是否包含插入日期？实际上还有另一个 DateTime 列，但它不会在任何 SELECT 查询中检索到，所以为了简单起见，我没有提到它。
> 
> 你是怎么想到这一天的。
> 
> 如果您只对最后的数据感兴趣，删除/归档无用的数据可能是有意义的（每天早上从头开始）

我只对最近的数据不感兴趣。查询可能会选择一些最先插入到表中的数据，一直到几分钟前插入的数据。但是当数据被过滤时，这并不意味着数据库中的所有数据都在该查询中被请求。

> 如果只有一个“插入器”和一个“读取器”，您可能希望切换到一种专门的类型（hashmap/list/deque/stack）或更详细的编程语言。

目前我可能会坚持使用 MSSQL。它还没有坏，只是有点慢。

liggett78，您建议在列 k1、k4、k5、k6、k3 上使用聚集索引还是在这些列上使用非聚集索引？

* * *

我现在的主要问题是我应该扩展当前的聚集索引以包含 k4（这是具有下一个最可能值的 col）还是应该只向 k4 添加一个非聚集索引。

将所有 k1-k6 添加到聚集索引是一种选择吗？然后在 ORDER BY 的 DateTime 列上有一个单独的非聚集索引？我是否正确地认为这不会导致数据库大小的任何重大增加，而只会影响插入时间。任何人都可以猜测这将对插入物产生的影响吗？

我认为，如果向所有列添加索引将使数据库大小翻倍，那么如果没有大的（即硬件）更改，这是不可行的。

* * *

以下计划是在 DATE 列上使用索引（非聚集）运行的。

编辑：不确定您是否可以看到下面的 XML，所以这里有一个链接：[http ://conormccarthy.com/box/queryplan.sqlplan.txt](http://conormccarthy.com/box/queryplan.sqlplan.txt)

```
<?xml version="1.0" encoding="utf-16"?>
<ShowPlanXML xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" Version="1.0" Build="9.00.1399.06" xmlns="http://schemas.microsoft.com/sqlserver/2004/07/showplan">
  <BatchSequence>
    <Batch>
      <Statements>
        <StmtSimple StatementCompId="1" StatementEstRows="11111" StatementId="1" StatementOptmLevel="FULL" StatementSubTreeCost="625.754" StatementText="SELECT TOP(11111) d1 FROM hands WITH (NOLOCK) &#xD;&#xA;                                WHERE k4 = '10' &#xD;&#xA;                                AND k6 = 1 &#xD;&#xA;                                AND k5 = 1  &#xD;&#xA;                                AND k1 = 'IPN'  &#xD;&#xA;                                AND k3 BETWEEN 2 AND 10  &#xD;&#xA;                                ORDER BY k7 DESC&#xD;&#xA;&#xD;&#xA;" StatementType="SELECT">
          <StatementSetOptions ANSI_NULLS="false" ANSI_PADDING="false" ANSI_WARNINGS="false" ARITHABORT="true" CONCAT_NULL_YIELDS_NULL="false" NUMERIC_ROUNDABORT="false" QUOTED_IDENTIFIER="false" />
          <QueryPlan DegreeOfParallelism="1" CachedPlanSize="36">
            <MissingIndexes>
              <MissingIndexGroup Impact="81.7837">
                <MissingIndex Database="[MYDB]" Schema="[dbo]" Table="[Hands]">
                  <ColumnGroup Usage="EQUALITY">
                    <Column Name="[k1]" ColumnId="1" />
                    <Column Name="[k4]" ColumnId="7" />
                    <Column Name="[k5]" ColumnId="9" />
                    <Column Name="[k6]" ColumnId="10" />
                  </ColumnGroup>
                  <ColumnGroup Usage="INEQUALITY">
                    <Column Name="[k3]" ColumnId="6" />
                  </ColumnGroup>
                  <ColumnGroup Usage="INCLUDE">
                    <Column Name="[d1]" ColumnId="3" />
                    <Column Name="[k7]" ColumnId="4" />
                  </ColumnGroup>
                </MissingIndex>
              </MissingIndexGroup>
            </MissingIndexes>
            <RelOp AvgRowSize="75" EstimateCPU="0.0011111" EstimateIO="0" EstimateRebinds="0" EstimateRewinds="0" EstimateRows="11111" LogicalOp="Top" NodeId="0" Parallel="false" PhysicalOp="Top" EstimatedTotalSubtreeCost="625.754">
              <OutputList>
                <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="d1" />
              </OutputList>
              <RunTimeInformation>
                <RunTimeCountersPerThread Thread="0" ActualRows="11111" ActualEndOfScans="1" ActualExecutions="1" />
              </RunTimeInformation>
              <Top RowCount="false" IsPercent="false" WithTies="false">
                <TopExpression>
                  <ScalarOperator ScalarString="(11111)">
                    <Const ConstValue="(11111)" />
                  </ScalarOperator>
                </TopExpression>
                <RelOp AvgRowSize="83" EstimateCPU="135.557" EstimateIO="0" EstimateRebinds="0" EstimateRewinds="0" EstimateRows="11111" LogicalOp="Filter" NodeId="1" Parallel="false" PhysicalOp="Filter" EstimatedTotalSubtreeCost="625.753">
                  <OutputList>
                    <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="d1" />
                    <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k7" />
                  </OutputList>
                  <RunTimeInformation>
                    <RunTimeCountersPerThread Thread="0" ActualRows="11111" ActualEndOfScans="0" ActualExecutions="1" />
                  </RunTimeInformation>
                  <Filter StartupExpression="false">
                    <RelOp AvgRowSize="96" EstimateCPU="318.331" EstimateIO="0" EstimateRebinds="0" EstimateRewinds="0" EstimateRows="195691" LogicalOp="Inner Join" NodeId="2" Parallel="false" PhysicalOp="Nested Loops" EstimatedTotalSubtreeCost="625.404">
                      <OutputList>
                        <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="d1" />
                        <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k7" />
                        <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k3" />
                        <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k4" />
                        <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k5" />
                        <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k6" />
                      </OutputList>
                      <RunTimeInformation>
                        <RunTimeCountersPerThread Thread="0" ActualRows="341958" ActualEndOfScans="0" ActualExecutions="1" />
                      </RunTimeInformation>
                      <NestedLoops Optimized="false" WithOrderedPrefetch="true">
                        <OuterReferences>
                          <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k1" />
                          <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="HandId" />
                          <ColumnReference Column="Expr1003" />
                        </OuterReferences>
                        <RelOp AvgRowSize="32" EstimateCPU="330.366" EstimateIO="790.88" EstimateRebinds="0" EstimateRewinds="0" EstimateRows="195691" LogicalOp="Index Scan" NodeId="4" Parallel="false" PhysicalOp="Index Scan" EstimatedTotalSubtreeCost="2.88444">
                          <OutputList>
                            <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k1" />
                            <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="HandId" />
                            <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k7" />
                          </OutputList>
                          <RunTimeInformation>
                            <RunTimeCountersPerThread Thread="0" ActualRows="341958" ActualEndOfScans="0" ActualExecutions="1" />
                          </RunTimeInformation>
                          <IndexScan Ordered="true" ScanDirection="BACKWARD" ForcedIndex="false" NoExpandHint="false">
                            <DefinedValues>
                              <DefinedValue>
                                <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k1" />
                              </DefinedValue>
                              <DefinedValue>
                                <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="HandId" />
                              </DefinedValue>
                              <DefinedValue>
                                <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k7" />
                              </DefinedValue>
                            </DefinedValues>
                            <Object Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Index="[ix_dateplayed]" />
                            <Predicate>
                              <ScalarOperator ScalarString="[MYDB].[dbo].[Hands].[k1]=N'IPN'">
                                <Compare CompareOp="EQ">
                                  <ScalarOperator>
                                    <Identifier>
                                      <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k1" />
                                    </Identifier>
                                  </ScalarOperator>
                                  <ScalarOperator>
                                    <Const ConstValue="N'IPN'" />
                                  </ScalarOperator>
                                </Compare>
                              </ScalarOperator>
                            </Predicate>
                          </IndexScan>
                        </RelOp>
                        <RelOp AvgRowSize="88" EstimateCPU="0.0001581" EstimateIO="0.003125" EstimateRebinds="195691" EstimateRewinds="0" EstimateRows="1" LogicalOp="Clustered Index Seek" NodeId="6" Parallel="false" PhysicalOp="Clustered Index Seek" EstimatedTotalSubtreeCost="621.331">
                          <OutputList>
                            <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="d1" />
                            <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k3" />
                            <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k4" />
                            <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k5" />
                            <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k6" />
                          </OutputList>
                          <RunTimeInformation>
                            <RunTimeCountersPerThread Thread="0" ActualRows="341958" ActualEndOfScans="0" ActualExecutions="341958" />
                          </RunTimeInformation>
                          <IndexScan Lookup="true" Ordered="true" ScanDirection="FORWARD" ForcedIndex="false" NoExpandHint="false">
                            <DefinedValues>
                              <DefinedValue>
                                <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="d1" />
                              </DefinedValue>
                              <DefinedValue>
                                <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k3" />
                              </DefinedValue>
                              <DefinedValue>
                                <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k4" />
                              </DefinedValue>
                              <DefinedValue>
                                <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k5" />
                              </DefinedValue>
                              <DefinedValue>
                                <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k6" />
                              </DefinedValue>
                            </DefinedValues>
                            <Object Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Index="[PK_Hands]" TableReferenceId="-1" />
                            <SeekPredicates>
                              <SeekPredicate>
                                <Prefix ScanType="EQ">
                                  <RangeColumns>
                                    <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k1" />
                                    <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="HandId" />
                                  </RangeColumns>
                                  <RangeExpressions>
                                    <ScalarOperator ScalarString="[MYDB].[dbo].[Hands].[k1]">
                                      <Identifier>
                                        <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k1" />
                                      </Identifier>
                                    </ScalarOperator>
                                    <ScalarOperator ScalarString="[MYDB].[dbo].[Hands].[HandId]">
                                      <Identifier>
                                        <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="HandId" />
                                      </Identifier>
                                    </ScalarOperator>
                                  </RangeExpressions>
                                </Prefix>
                              </SeekPredicate>
                            </SeekPredicates>
                          </IndexScan>
                        </RelOp>
                      </NestedLoops>
                    </RelOp>
                    <Predicate>
                      <ScalarOperator ScalarString="[MYDB].[dbo].[Hands].[k4]=($10.0000) AND [MYDB].[dbo].[Hands].[k6]=(1) AND [MYDB].[dbo].[Hands].[k5]=(1) AND [MYDB].[dbo].[Hands].[k3]&gt;=(2) AND [MYDB].[dbo].[Hands].[k3]&lt;=(10)">
                        <Logical Operation="AND">
                          <ScalarOperator>
                            <Compare CompareOp="EQ">
                              <ScalarOperator>
                                <Identifier>
                                  <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k4" />
                                </Identifier>
                              </ScalarOperator>
                              <ScalarOperator>
                                <Const ConstValue="($10.0000)" />
                              </ScalarOperator>
                            </Compare>
                          </ScalarOperator>
                          <ScalarOperator>
                            <Compare CompareOp="EQ">
                              <ScalarOperator>
                                <Identifier>
                                  <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k6" />
                                </Identifier>
                              </ScalarOperator>
                              <ScalarOperator>
                                <Const ConstValue="(1)" />
                              </ScalarOperator>
                            </Compare>
                          </ScalarOperator>
                          <ScalarOperator>
                            <Compare CompareOp="EQ">
                              <ScalarOperator>
                                <Identifier>
                                  <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k5" />
                                </Identifier>
                              </ScalarOperator>
                              <ScalarOperator>
                                <Const ConstValue="(1)" />
                              </ScalarOperator>
                            </Compare>
                          </ScalarOperator>
                          <ScalarOperator>
                            <Compare CompareOp="GE">
                              <ScalarOperator>
                                <Identifier>
                                  <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k3" />
                                </Identifier>
                              </ScalarOperator>
                              <ScalarOperator>
                                <Const ConstValue="(2)" />
                              </ScalarOperator>
                            </Compare>
                          </ScalarOperator>
                          <ScalarOperator>
                            <Compare CompareOp="LE">
                              <ScalarOperator>
                                <Identifier>
                                  <ColumnReference Database="[MYDB]" Schema="[dbo]" Table="[Hands]" Column="k3" />
                                </Identifier>
                              </ScalarOperator>
                              <ScalarOperator>
                                <Const ConstValue="(10)" />
                              </ScalarOperator>
                            </Compare>
                          </ScalarOperator>
                        </Logical>
                      </ScalarOperator>
                    </Predicate>
                  </Filter>
                </RelOp>
              </Top>
            </RelOp>
          </QueryPlan>
        </StmtSimple>
      </Statements>
    </Batch>
  </BatchSequence>
</ShowPlanXML> 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-08T23:01:19.807

正如我在评论中暗示的那样，我使用一个接近 8 TB 的 Oracle 表完成了这项工作，该表由超过 20 亿行组成，每天以 4000 万行的速度增长。然而，在我的例子中，用户是 200 万（并且还在增长）的客户，他们通过 24x7 的网络访问这些数据，并且实际上任何行都可能被访问。哦，必须在两分钟内实时添加新行。

您可能受 I/O 限制，而不是 CPU 或内存限制，因此优化磁盘访问至关重要。你的内存很好——绰绰有余。使用多个内核会有所帮助，但如果 I/O 未并行化，则会受到限制。

有几个人建议拆分数据，这应该被认真对待，因为它比任何其他解决方案都更好、更有效（没有什么比完全不接触数据更快）。

您说您不能拆分数据，因为所有数据都已使用：不可能！您的用户不可能每天翻阅 100 万行或总共 1 亿行。因此，了解您的用户是如何实际使用数据的——在这种情况下查看每个查询。

更重要的是，我们并不是说您应该删除数据，而是说拆分数据。将表结构克隆为多个名称相似的表，可能基于时间（每个表可能一个月）。将数据复制到相关表中，删除原表。创建一个对新表执行联合的视图，其名称与原始表相同。更改您的插入处理以针对最新的表（假设它是适当的），并且您的查询仍应针对新视图工作。

您的精明用户现在可以开始针对表的一个子集发出他们的查询，甚至可能只针对最新的一个。不精通的用户可以继续使用所有表的视图。

您现在有一个数据管理策略，即归档最旧的表并将其删除（当然，更新视图定义）。同样，您将需要定期创建一个新表并更新该数据端的视图定义。

期望不能使用唯一索引：它们的扩展不会超过大约一到两百万行。您可能还必须修改其他一些策略/建议。一亿行和 400 GB，您已经进入了另一个处理领域。

除此之外，使用其他建议——使用 SQL Server 和操作系统中已有的许多工具分析实际性能。应用许多众所周知的调优技术，这些技术在网络或书籍中很容易获得。

但是，不要尝试！有这么多数据，你没有时间做实验，风险太大。仔细研究可用的技术和你的实际表现细节，然后一次选择一个步骤，给每个步骤几个小时到几天的时间来揭示它的影响。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-08T18:15:35.797

帮助我更多地了解这张桌子。如果您的 PK 是 k1,k2，则您不必选择任何其他列来获得完全唯一的记录。

你的意思是说k1到7是PK？如果是这样，那么声明它，它将是一个聚集索引。查询性能应该会显着提高。

order by 增加了很多开销。考虑找到一个更好的选项，它可以返回较小的数据集。了解为什么需要返回大约一百万条记录可能有助于我提供更好的解决方案。

编辑：我觉得我并不孤单，我怀疑开始优化的最佳位置是在您的物理表设计中。你对此有任何控制权吗？不知道每列存储什么，我无法提供非常具体的想法，但一个非常通用的方法如下：将 K1、3、4、5 和 6（k2 似乎与表中的值直接相关）放在自己的表中用一个唯一的 int 作为 PK。然后创建一个 FK 关系回到这个表。您在主表上的 PK 然后将包括此字段 k2 和 k7。现在，您的查询将优化器将在您的新表中执行相当便宜的查找，返回一条记录，然后仅通过 PK 对您的主表执行索引查找。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-08T18:20:06.193

看起来您只想要最早的“g”记录？也许只有最近的“g”记录？

基本上，您希望您的查询仅读取最新/最旧的记录。您不想查询整个 400GB 吗？如果是这种情况，您可能会考虑归档 400GB 的大部分，或者将最近插入的记录保存在您可以查询的“当前”表中。您可以通过双重插入或通过表上的触发器（颤抖）使当前表中的记录保持最新。但基本前提是您对尽可能小的表运行查询。这基本上是穷人的表分区。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-08T19:19:49.957

这是我要做的：

*   不要在每一列上创建单个索引。你会浪费空间，他们不会帮助你太多（如果有的话）
*   保留主键，但在日期列上创建聚集索引，因为这是您在 ORDER BY 中使用的。这样，数据库引擎将开始扫描集群键，将列与您提供的值进行比较，并输出满足条件的行。
*   您不需要任何其他索引。我相信即使 k4 的 1 亿个值中的 100 个值也会被优化器认为是较差的选择性（尽管您至少可以尝试）。
*   如果您根据某些日期范围进行选择，例如仅来自上个月、一周、一年等的数据，您可能希望根据日期列将大表划分为“较小”的表。这些 10 值列也将是分区键的良好候选者。

顺便说一句，您在查询中指定整个 PK - 假设 AND'ing 在 WHERE - 这将恰好选择 1 行。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-09T02:09:22.033

好的，

让我们尝试用统计数据来解决这个问题。在尝试创建任何索引之前，您应该询问哪种键组合可以提供更好的选择性：

1.  K1 : 10 个不同的值
2.  K3 : 100 个不同的值
3.  k4 : 10 个不同的值
4.  k5 : 2 个不同的值
5.  k6 : 2 个不同的值

如果我们制作一个 k1,k3,k4,k5,和 k6 的复合键，这意味着该键将只有 40,000 种不同的组合（10 * 100 * 10 * 2 * 2）。这意味着如果我们有 100,000,000 条记录除以 40,000，统计上我们将拥有 2,500 条不同记录的子集，将应用顺序搜索来完成 WHERE 子句的其他限制。

如果我们推断这个结果并将它们与当前执行时间（30 分钟）进行比较，使用一个键（k1）统计生成 1000 万条不同记录的子集，我们得到：

10,000,000 次记录 * X 秒 = 30 * 60 秒 * 2,500 次记录

=> X 秒 = 0.45 秒

还不错吧？再好不过了。如果我们从复合索引中消除 k5 和 k6 怎么样？从统计上讲，我们将有一个包含 10,000 条不同记录的子集，将在其中执行顺序搜索。理论上，这需要多少时间？让我们来看看：

10,000,000 次记录 * X 秒 = 30 * 60 * 10,000 次记录

=> X 秒 = 1.8 秒

由于我们希望以最小的索引足迹与可能的最佳性能进行权衡，我会说 k1 + K3 + K4 上的索引尽可能好。

希望这可以帮助，

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-08T18:20:19.390

首先，花一天时间在后台运行 SQL Profiler。在一天结束时，将跟踪数据保存到文件中，然后让优化向导对其进行处理并评估您当前的索引。这应该告诉您更改索引字段、排序顺序等是否可以给您带来任何显着收益。不要让向导进行更改。如果百分比性能提升看起来很显着（> 30% 恕我直言），请继续自己进行更改。

您的索引必须偏大。您可能需要安排一项工作（隔夜，每周几次）来执行以下操作：

*   将超过特定年龄的数据移动到历史记录表
*   对索引进行碎片整理
*   重新计算指标

一旦你调整了索引，这将保持它的速度。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-08T18:11:42.107

为什么要聚集在主键上？
哪些列可以为 NULL？
VARCHAR 的长度是多少？
查询计划现在给你什么？

您通过提供无意义的列名来妨碍我们。

即使聚集索引是正确的，也应该优先选择更具选择性的字段。

我可以根据信息不足提出建议，但提供一些帮助会更好。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-08T18:18:41.327

使用 SQL Profiler 计算出要创建的索引，它旨在为您计算出该信息并建议改进的执行配置文件。

你在k3，k4上有外键吗？

尝试将 k1，k2 转换为整数并将它们设为外键，它会使用更少的存储空间，我曾想过，我认为它应该更快（虽然我可能错了，我猜 SQL Server 缓存了这些值）。更重要的是，如果您需要更新一个值，它会更容易。您只需更改外键行的名称 - 然后您不必更新 1 亿个主键或其他任何内容。

提高查询速度的一个好技巧是放入一个子查询，将您的记录集大小减少到更易于管理的大小。

在：

```
SELECT TOP(g) d1 
FROM table WITH(NOLOCK)  
WHERE k1 = a  WHERE k2 = b  WHERE k3 = c  WHERE k4 = d  WHERE k5 = e  WHERE k6 = f  
ORDER BY k7 
```

哪个，我想应该是

```
SELECT TOP(g) d1 
FROM table WITH(NOLOCK)  
WHERE k1 = a AND k2 = b  AND k3 = c AND k4 = d AND k5 = e AND k6 = f 
ORDER BY k7 
```

可能会有一些数据立即将记录集从 1000 万行减少到 10000 行。

例如

```
SELECT TOP(g) d1 
FROM (SELECT * 
      FROM table k1=a AND k2=a WITH(NOLOCK)) 
WHERE AND k3 = c AND k4 = d AND k5 = e AND k6 = f 
ORDER BY k7 
```

这假设您可以通过一个或两个 WHERE 参数大量减少初始数据集 - 这几乎是肯定的。

DBA 可能有更多、更好的解决方案！

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-08T18:42:16.383

很难给你一个非常有意义的答案。您是否查看过磁盘 I/O 成本？您将数据库文件保存在哪里 - 也许是 I/O 停滞不前？这里有很多变量会影响性能。也许是您的 UI 或其他显示数据所花费的时间，也许是网络所花费的时间？

如果您使用的是 SQL Server 2005 企业版，也许最简单的方法（您会看到最大收益的地方是对表进行分区）。

同样，在无法访问实际查询计划的情况下，perfmon stats 很难准确地告诉您问题出在哪里。您的问题根本不足以让我们继续下去 - 一切都只是猜测。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-12T00:48:07.047

您是否考虑过创建代理标识列（bigint 类型）并将其用作聚集索引？然后将您的主键创建为非聚集唯一索引。

对于这种大小的表，索引和页面碎片很可能是一个很大的性能问题。代理聚集索引将确保所有插入都在表的末尾，这几乎可以完全消除页面碎片（除非行被删除）。更少的页面碎片 == 每个 IO 更多的页面，这是一件非常好的事情。

这也将允许您定期对正在查询的唯一索引进行碎片整理，这将使其更加有效。经常这样做，或者至少定期监视该表上的索引碎片。

这些性能改进可能非常显着——如果您当前的 PK 高度分散，则索引查找可能涉及比应有的更多的 IO。

一旦你实现了这个，考虑（又名，尝试它并测量;-) 在列 k7 上添加一个非聚集索引。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-08T18:45:59.777

显示查询计划输出 - 任何没有开始的调优冒险都是不幸的。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-08T21:53:24.170

分区和并行化 - 检查查询计划，如果它没有显示查询是并行化的，那么找出它不并行化的原因。您可能需要将查询分成几个步骤，然后将结果汇总在一起。

如果是跨多个物理磁盘分区数据，则添加更多内核。它有很多工作要做，一旦你从它的原始索引中找出了地狱，就只剩下体力了。

不要假设 SQL Server 只会使用您的所有内核。通常，您必须正确设计查询，以便可以使用多个核心。检查查询计划中第一个节点的属性以查看 DOP（并行度）。如果它的 1 你在浪费核心......

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-06-20T17:41:01.070

看起来您没有充分利用聚集索引，并且有大量重复数据。

您的聚集索引似乎构造如下：

```
create clustered index IX_Clustered on Table(k1 ASC, k2 ASC) 
```

但是，您的其他 k* 列仅代表 40,000 种可能的排列。

> 10 (k1) * 10 (k3) * 100 (k4) * 2 (k5) * 2 (k6) = 40,000

您应该将这 4 个键的唯一组合提取到一个单独的表中，并为每个键赋予一个唯一的 int（主键“newPK”）。

请原谅伪代码：

```
create table SurrogateKey(
  newPK int -- /*primary key*/
, k1, k3, k4, k5, k6
)

constraint: newPK is primary key, clustered
constraint: k1, k3, k4, k5, k6 is unique 
```

该表将只有 40,000 行，并且查找主键 newPK 的速度非常快。然后，您可以在大表中查找单个整数。

您现有的表应更改为具有以下列：

*   新PK
*   k2 （这真的不是一个键，可能只是一个序列号）
*   d1
*   k7 日期时间

鉴于上述情况，您可以将聚集索引更改为：

```
create clustered index IX_Clustered on Table(newPK ASC) 
```

你可以沿着这个寻找。它保证比您现在的查询更快（相当于索引扫描+键查找的性能）。

```
declare @pk int
select @pk = newPK 
from SurrogateKey
where
      k1 = @k1
  and k3 = @k3
  and k4 = @k4
  and k5 = @k5
  and k6 = @k6

select top(g1) d1, k2, k7
from Table with(read uncommitted)
where newPK = @pk
order by k7 
```

您的插入语句也需要修改以查询/插入 SurrogateKey 表。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-08T21:38:55.887

感谢你的帮助。

我对原始帖子中的错误进行了 3 次编辑。

1) WHERE 应该是 AND。

2) k4 应该是 MONEY 而不是 VARCHAR。此外，k1 的长度为 3。

3) k2 不应该在 WHERE 子句中。正如 doofledorfer 正确指出的那样，除了完整的主键之外，拥有任何其他 WHERE 语句是没有意义的。

以下是您的问题的答案：

> 为什么要聚集在主键上？

我的印象是 PK 默认设置为聚集索引。我没有改变它。

> 哪些列可以为 NULL？

没有任何。

> VARCHAR 的长度是多少？

我在列类型上犯了一个错误。唯一剩下的 VARCHAR 长度为 3。

> 查询计划现在给你什么？

发表在下一篇文章中。

> 帮助我更多地了解这张桌子。如果您的 PK 是 k1,k2，则您不必选择任何其他列来获得完全唯一的记录。这是一个错误。PK 的 k2 部分不在 WHERE 子句中。
> 
> 了解为什么需要返回大约一百万条记录可能有助于我提供更好的解决方案。

数据库包含每日记录（d1 TEXT 列）或数据。人们需要访问大量此类数据才能生成自己的报告。他们需要按多个值对其进行过滤，并按时间排序。

> 看起来您只想要最早的“g”记录？也许只有最近的“g”记录？

是的，最新的。但我有一定数量的。我事先不知道开始日期。

> 你在k3，k4上有外键吗？不，这是数据库中唯一的表。

注释：

> 即使聚集索引是正确的，也应该优先选择更具选择性的字段。

WHERE 子句中不使用更具选择性的索引（编辑后！）。所以我认为在这种情况下它不应该排在第一位吗？

> 您可能希望将超过特定年龄的数据移动到历史记录表

目前使用了所有数据，因此修剪不是一种选择。

> 您可能需要对索引进行碎片整理

目前我没有。如果这个线程被证明是富有成效的，将会调查它。

> 添加单个索引，其中包含 k1-k6 列；那应该是最好的。

其他人可以评论这个建议吗？Liggett78 评论说，由于日期列排序，这将使 DB 的大小增加一倍而没有太大帮助。请注意，DATE 列不在 WHERE 子句中，它仅用于对数据进行排序。

> 尝试将 k1，k2 转换为整数并将它们设为外键，它会使用更少的存储空间，我曾想过，我认为它应该更快（虽然我可能错了，我猜 SQL Server 缓存了这些值）。

k2 是一个 bigint（原始帖子中的错误）。因此，将 k1 更改为 int（从 VARCHAR(3)）是一种选择。我们真的认为这会产生很大的不同吗？人们真的认为将表拆分为 k1,k2,d1 和 k1,k2,k3,k4,k5,k7 并使用外键会有所改善吗？

> 提高查询速度的一个好技巧是放入一个子查询，将您的记录集大小减少到更易于管理的大小。可能会有一些数据立即将记录集从 1000 万行减少到 10000 行。
> 
> 例如 SELECT TOP(g) d1 FROM (SELECT * FROM table WHERE k1=a WITH(NOLOCK)) WHERE AND k3 = c AND k4 = d AND k5 = e AND k6 = f ORDER BY k7

很有意思。这真的有帮助吗？如果 SQL Server 本身不以类似的方式削减数据，它似乎会非常愚蠢。

> 也许是你的 UI 所花费的时间，或者是否显示数据，也许是网络所花费的时间？

没有用户界面。移动数据肯定存在网络问题，但我只关心查询开始返回结果所花费的时间（我正在使用 ADO.NET 数据阅读器） - 一次一件事:)

> .. [to] 看到最大的收获... 分区表

聚集索引不会有同样的效果吗？

> 保留主键，但在日期列上创建聚集索引，因为这是您在 ORDER BY 中使用的。这样，数据库引擎将开始扫描集群键，将列与您提供的值进行比较，并输出满足条件的行。

听起来像一个合理的计划！还有其他支持者吗？

总结一下建议：

1）在所有键上创建单独的索引：大多数人对此投反对票？

2) 在具有最不同值的键上创建单独的索引。

*3）在某些*列上创建多列索引，首先具有最不同值的列。

4）向它扔内存。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-09T00:36:42.640

这听起来很有趣。

几个问题：

*   为什么选择这些类型？varchar、钱、bigint、int、bool？是否有理由或只是愿意增加一些乐趣？
*   有没有机会我们可以看看 insert 语句、TSQL 或 bulkinsert ？
*   您能说出您的插入发生的频率吗（是批量插入还是随机插入？）
*   DateTime 字段是否包含插入日期？
*   你是怎么来的？（过去三个月一个人/一天的想法还是一个 20 人的团队疯狂地工作？）

一些事实对我来说似乎很重要：

*   你每天插入一百万行
*   你只想要最后一百万个数据

我想到了几句话：

*   如果您只对最后的数据感兴趣，删除/归档无用的数据可能是有意义的（每天早上从头开始）
*   如果只有一个“插入器”和一个“读取器”，您可能希望切换到一种专门的类型（hashmap/list/deque/stack）或更详细的编程语言。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-09T02:56:01.220

I think a clustered index on K7 is the only thing of any value. The rest of your where clause has such low selectivity that it's a waste of time.

Unless you can take advantage of some specific knowledge of your values (maybe k5 is only true if k4 < 0, or something), you're pretty much looking at a clustered index scan. Might as well make it the field that you're ordering by.

Looking at the low numbers of distinct values in k3 - k6, you'd probably only need to read < 1.5 million rows to get your top 1 million. That's probably the best you're going to do - especially since any other plan would need you to order by k7 anyway to evaluate your TOP clause.

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-12-08T18:18:47.817

您需要创建一个索引，以尽可能快地减少可能返回的行数。

因此，要创建的最简单的索引将在列 k4 上，因为它可能具有最多数量的不同值。只需要索引 k4 的初始子字符串，其中 k4 的预期值在该子字符串中不同。这将减小索引的大小，并加快访问速度。

k7 也应该被索引，因为这将大大提高 orderby 子句的速度。

您可能还需要试验（我知道，我知道，您说过不要试验，但这可能会有所帮助......）按以下顺序创建多列索引：k4、k1、k2、k3。这也是为了尽可能快地减少可能返回的行数。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-12-08T18:20:03.993

这是一个想法，如果您使用所有 Lookup 值创建第二个表，然后不使用`where`连接表并在新的 Lookup 表上执行 where 子句，该怎么办。

另外，如果可能的话，我认为如果您发布几行数据和示例查询会有所帮助。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-12-08T18:24:59.443

添加单个索引，其中包含 k1-k6 列；那应该是最好的。

此外，如果您可以在每个查询之前运行 sp_updatestats。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-12-12T03:18:28.537

什么是 D1，是十进制还是长字符，请您详细说明一下。我的建议是将聚集索引创建为 (K7, k2, k1, k4)，然后在 (k3) 上创建一个附加索引（在两个 bool 值上创建索引几乎没有意义，除非值分布在 30% 左右/70% 之间的值，或者如果您的表很宽，如果 d1)。

此更改根本不会对您的插入速度产生太大影响，同时为您提供了对聚集索引的粗略通用答案。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2008-12-08T18:53:03.163

我会使用索引调整向导来获得更好的答案。

但是，如果是我，我会尝试在 K3、K4 上建立索引（按照您最常查询的顺序）（您已经为 K1 和 K2 编制了索引）并在 K7 上建立了单独的索引。我不相信添加布尔字段会提高索引性能。

请记住，索引越多，插入速度就越慢。随着您拥有的插入数量，这是一个真正的问题。因此，真正唯一真正的答案是，您必须尝试使用​​自己的数据和硬件，并找到最适合您个人情况的方法。这不是您想听到的事实并没有降低它的真实性，索引非常依赖于您的应用程序实际工作方式和数据结构。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-12-08T19:42:26.650

我会说 8 GB 的 RAM 不足以容纳 400 GB 的表。如果一个索引单独占用 5-8 GB，服务器就没有机会将相关数据保存在内存中。所以有很多很多的硬盘读取使查询变慢。

在我看来，增加 RAM 的数量并将数据库置于快速 RAID 上（也许在多个 RAID 上拆分？）将最有帮助。

编辑：要确定您真正的瓶颈是什么，请运行 Windows 的[Performance Monitor](http://www.databasepronews.com/databasepronews-51-20041207UsingPerformanceMonitortoIdentifySQLServerHardwareBottlenecks.html)。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-06-20T18:46:59.110

你可以试试：

```
alter table MyTable
    add constraint PK_MyTable
        primary key nonclustered (k1, k2)
create clustered index IX_MyTable
    on MyTable(k4, k1, k3, k5, k6, k7)
    --decreasing order of cardinality of the filter columns 
```

这将确保您的重复插入继续出错。

这也可能指示 SQL Server 一次性过滤`(k1, k3, k4, k5, k6)`和排序`(k7 asc)`，从而允许 SQL Server 流式传输查询结果，而无需先对一百万个结果进行排序的中间步骤。一旦 SQL Server 找到匹配的第一行`(k1, k3, k4, k5, k6)`，接下来的一百万行左右的行都将匹配同一个过滤器，并且已经按 排序`(k7 asc)`。所有过滤和排序都将基于聚集索引一起完成。

如果页面是连续存储的，并且 SQL Server 知道如何优化，那就是几次磁盘搜索，沿着索引查找第一个匹配的行，然后是一万页左右的大顺序磁盘读取。这应该比要求 SQL Server 到处寻找行，然后要求 SQL Server 在 tempdb 中对它们进行排序要快！

您必须保持警惕并确保聚集索引始终处于良好状态。如果插入时间过慢，您可能还必须降低页面填充因子。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-12-08T23:26:29.927

您的查询计划基本上显示以下内容：

*   第一个操作是聚集索引查找，比较 k1、handId?、d1、k3-k6
*   其次是对k1，handId的整个索引扫描？和k7
*   第三当然是建立最终结果集的join
*   排序 ORDER BY
*   TOP n（过滤器）

该计划提出了一个指数，该指数应将 perm 提高 81% - k1、k4、k5、k6、k3 + 包括 d1 和 k7。我不知道构建这样一个索引并查看结果需要多长时间，但正如我在这里评论的那样，它实际上会使你的表大小翻倍，因为几乎每一列都存在于索引中。插入也会变慢。

正如许多人所建议的那样，分区是这里最好的策略，例如，让一个表的 k3 值从 1 到 3，另一个从 4 到 7，第三个从 8 到 10。使用 SQL Server Enterprise 分区是使用检查此列的约束，查询优化器将根据列的参数值确定要扫描/查找的 n 个表中的哪个表。

# visual-studio - 在 Visual Studio 中打开特定行号的文件

> ID：350323
> 
> 赞同：58
> 
> 时间：2008-12-08T18:04:41.513
> 
> 标签：visual-studio, command-line

我有一个实用程序（grep），它给了我一个文件名列表和一个行号。在我确定 devenv 是打开文件的正确程序后，我想确保它在指定的行号处打开。在 emacs 中，这将是：

```
emacs +140 filename.c 
```

对于 Visual Studio (devenv)，我没有发现任何类似的东西。我发现的最接近的是：

```
devenv /Command "Edit.Goto 140" filename.c 
```

但是，这会为每个此类文件创建一个单独的 devenv 实例。我宁愿有一些使用现有实例的东西。

这些变体重新使用现有的 devenv，但不要转到指示的行：

```
devenv /Command "Edit.Goto 140" /Edit filename.c
devenv /Command  /Edit filename.c "Edit.Goto 140" 
```

我认为使用多个“/Command”参数可能会做到这一点，但我可能没有正确的参数，因为我要么得到错误，要么根本没有响应（除了打开一个空的 devenv）。

我可以为 devenv 编写一个特殊的宏，但我希望其他没有该宏的人可以使用这个实用程序。而且我不清楚如何使用“/Command”选项调用该宏。

有任何想法吗？

* * *

好吧，似乎没有办法按照我的意愿做到这一点。因为看起来我需要有专门的代码来启动 Visual Studio，所以我决定使用 EnvDTE，如下所示。希望这会对其他人有所帮助。

```
#include "stdafx.h"

//-----------------------------------------------------------------------
// This code is blatently stolen from http://benbuck.com/archives/13
//
// This is from the blog of somebody called "BenBuck" for which there
// seems to be no information.
//-----------------------------------------------------------------------

// import EnvDTE
#pragma warning(disable : 4278)
#pragma warning(disable : 4146)
#import "libid:80cc9f66-e7d8-4ddd-85b6-d9e6cd0e93e2" version("8.0") lcid("0") raw_interfaces_only named_guids
#pragma warning(default : 4146)
#pragma warning(default : 4278)

bool visual_studio_open_file(char const *filename, unsigned int line)
{
    HRESULT result;
    CLSID clsid;
    result = ::CLSIDFromProgID(L"VisualStudio.DTE", &clsid);
    if (FAILED(result))
        return false;

    CComPtr<IUnknown> punk;
    result = ::GetActiveObject(clsid, NULL, &punk);
    if (FAILED(result))
        return false;

    CComPtr<EnvDTE::_DTE> DTE;
    DTE = punk;

    CComPtr<EnvDTE::ItemOperations> item_ops;
    result = DTE->get_ItemOperations(&item_ops);
    if (FAILED(result))
        return false;

    CComBSTR bstrFileName(filename);
    CComBSTR bstrKind(EnvDTE::vsViewKindTextView);
    CComPtr<EnvDTE::Window> window;
    result = item_ops->OpenFile(bstrFileName, bstrKind, &window);
    if (FAILED(result))
        return false;

    CComPtr<EnvDTE::Document> doc;
    result = DTE->get_ActiveDocument(&doc);
    if (FAILED(result))
        return false;

    CComPtr<IDispatch> selection_dispatch;
    result = doc->get_Selection(&selection_dispatch);
    if (FAILED(result))
        return false;

    CComPtr<EnvDTE::TextSelection> selection;
    result = selection_dispatch->QueryInterface(&selection);
    if (FAILED(result))
        return false;

    result = selection->GotoLine(line, TRUE);
    if (FAILED(result))
        return false;

    return true;
} 
```

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2010-09-09T15:31:58.787

使用 VS2008 **SP1**，您可以使用以下命令行在现有实例的特定行打开文件：

```
devenv /edit FILE_PATH /command "edit.goto FILE_LINE" 
```

[来源](http://msdn.microsoft.com/en-us/library/xee0c8y7%28VS.80%29.aspx)

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2012-05-23T16:20:07.683

在详细阐述 Harold 问答时，我将 C++ 解决方案（我首先采用的）改编为 C#。它要简单得多（那是我的第一个 C# 程序！）。只需创建一个项目，添加对“envDTE”和“envDTE80”的引用并删除以下代码：

```
using System;
using System.Collections.Generic;
using System.Text;

namespace openStudioFileLine
{
    class Program    
    {
        [STAThread]
        static void Main(string[] args)     
        {
            try          
            {
                String filename = args[0];
                int fileline;
                int.TryParse(args[1], out fileline);
                EnvDTE80.DTE2 dte2;
                dte2 = (EnvDTE80.DTE2)System.Runtime.InteropServices.Marshal.GetActiveObject("VisualStudio.DTE");
                dte2.MainWindow.Activate();
                EnvDTE.Window w = dte2.ItemOperations.OpenFile(filename, EnvDTE.Constants.vsViewKindTextView);
                ((EnvDTE.TextSelection)dte2.ActiveDocument.Selection).GotoLine(fileline, true);
            }
            catch (Exception e)          
            {          
                Console.Write(e.Message);      
            }
        }
    }
} 
```

一个然后只是调用`openStudioFileLine path_to_file numberOfLine`。

希望能有所帮助！

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2013-07-05T12:26:53.780

根据[reder](https://stackoverflow.com/a/10724025/199154)的答案，我已经发布[了带有 source 的存储库](https://github.com/diimdeep/VisualStudioFileOpenTool)，[这里是 binary(.net2.0)](https://github.com/diimdeep/VisualStudioFileOpenTool/blob/master/VisualStudioFileOpenTool/bin/Release/VisualStudioFileOpenTool.exe)

我还添加了对多个 VS 版本的支持

```
usage: <version> <file path> <line number> 

Visual Studio version                 value 
VisualStudio 2002                     2 
VisualStudio 2003                     3 
VisualStudio 2005                     5 
VisualStudio 2008                     8 
VisualStudio 2010                    10 
VisualStudio 2012                    12 
VisualStudio 2013                    13 
```

使用 GrepWin 的示例：

```
VisualStudioFileOpenTool.exe 12 %path% %line% 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-11-21T21:16:59.940

很老的线程，但它让我开始了，所以这是另一个例子。这个[AutoHotkey](http://AhkScript.org)函数打开一个文件，并将光标放在特定的行和列上。

```
; http://msdn.microsoft.com/en-us/library/envdte.textselection.aspx
; http://msdn.microsoft.com/en-us/library/envdte.textselection.movetodisplaycolumn.aspx
VST_Goto(Filename, Row:=1, Col:=1) {
    DTE := ComObjActive("VisualStudio.DTE.12.0")
    DTE.ExecuteCommand("File.OpenFile", Filename)
    DTE.ActiveDocument.Selection.MoveToDisplayColumn(Row, Col)
} 
```

致电：

```
VST_Goto("C:\Palabra\.NET\Addin\EscDoc\EscDoc.cs", 328, 40) 
```

您可以将它逐行翻译成 VBScript 或 JScript。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-10-20T18:42:59.160

这是 Harold 解决方案的 Python 变体：

```
import sys
import win32com.client

filename = sys.argv[1]
line = int(sys.argv[2])
column = int(sys.argv[3])

dte = win32com.client.GetActiveObject("VisualStudio.DTE")

dte.MainWindow.Activate
dte.ItemOperations.OpenFile(filename)
dte.ActiveDocument.Selection.MoveToLineAndOffset(line, column+1) 
```

它显示了如何转到指定的行+列。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-09-26T06:33:11.470

这是 Harold 解决方案的 VBS 变体：[link to .vbs script](https://github.com/evgeny-panasyuk/open-in-msvs.el/blob/master/open-in-msvs.vbs)。

```
open-in-msvs.vbs full-path-to-file line column 
```

Windows 本身支持 VBScript - 无需编译或任何额外的解释器。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-09-26T07:27:00.750

**这是我为 Visual Studio 2017 (15.9.7) 工作的 C# 解决方案**

对于其他版本的 VS 只需更改版本号（即“VisualStudio.DTE.14.0”）

待办事项： *添加参考->搜索'envdte'->检查envdte复选框->单击确定*

```
using EnvDTE;        

private static void OpenFileAtLine(string file, int line)
{
    DTE dte = (DTE)  Marshal.GetActiveObject("VisualStudio.DTE.15.0");
    dte.MainWindow.Visible = true;
    dte.ExecuteCommand("File.OpenFile", file);
    dte.ExecuteCommand("Edit.GoTo", line.ToString());
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-05-15T17:28:50.387

这里的参考是用 C# 编写的 ENVDE（使用VisualStudio 中的[O2 平台](http://O2platform.com)来获取对实时 DTE 对象的引用）

```
var visualStudio = new API_VisualStudio_2010();

var vsDTE = visualStudio.VsAddIn.VS_Dte;
//var document = (Document)vsDTE.ActiveDocument;
//var window =  (Window)document.Windows.first();           
var textSelection  = (TextSelection)vsDTE.ActiveDocument.Selection;
var selectedLine = 1;
20.loop(100,()=>{
                    textSelection.GotoLine(selectedLine++);
                    textSelection.SelectLine();
                });
return textSelection; 
```

这段代码做了一个小动画，选择了 20 行（间隔为 100 毫秒）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-01-28T19:20:20.710

强制执行 a并跳转到行号的正确`wingrep`命令行是：`syntax``new instance`

```
"C:\Program Files (x86)\Microsoft Visual Studio 14.0\Common7\IDE\devenv.exe" $F /command "edit.goto $L" 
```

将 替换`studio version number`为适合您的设置的正确版本。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-02-25T15:08:41.573

这些 C# 对项目引用的依赖是完全不必要的。事实上，这里的大部分代码都过于冗长。你只需要这个。

```
using System.Reflection;
using System.Runtime.InteropServices;

private static void OpenFileAtLine(string file, int line) {
    object vs = Marshal.GetActiveObject("VisualStudio.DTE");
    object ops = vs.GetType().InvokeMember("ItemOperations", BindingFlags.GetProperty, null, vs, null);
    object window = ops.GetType().InvokeMember("OpenFile", BindingFlags.InvokeMethod, null, ops, new object[] { file });
    object selection = window.GetType().InvokeMember("Selection", BindingFlags.GetProperty, null, window, null);
    selection.GetType().InvokeMember("GotoLine", BindingFlags.InvokeMethod, null, selection, new object[] { line, true });
} 
```

简单吧？

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-12-10T22:42:19.597

@Mungo64 发布的版本对我有用，但当然版本号总是在变化，所以我制作了一个自动搜索直到找到它的版本。

添加参考->搜索'envdte'->检查envdte复选框->单击确定

//使用EnvDTE；//我没有使用 using 指令，因为它会导致我正在使用的另一个模块中的歧义。

```
private static void OpenFileAtLine(string file, int line)
{
    //The number needs to be rolled to the next version each time a new version of visual studio is used... 
    EnvDTE.DTE dte = null;

    for (int i = 25; i > 8; i--) {
        try
        {
            dte = (EnvDTE.DTE)Marshal.GetActiveObject("VisualStudio.DTE." + i.ToString() + ".0");
        }
        catch (Exception ex)
        {
            //don't care... just keep bashing head against wall until success
        }
    }

    //the following line works fine for visual studio 2019:
    //EnvDTE.DTE dte = (EnvDTE.DTE)Marshal.GetActiveObject("VisualStudio.DTE.16.0");
    dte.MainWindow.Visible = true;
    dte.ExecuteCommand("File.OpenFile", file);
    dte.ExecuteCommand("Edit.GoTo", line.ToString());
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-08T18:31:33.410

我想不出用直接命令行选项来做到这一点的方法。看起来您将不得不为它编写一个宏。据说，您可以像这样调用它们。

```
devenv /command "Macros.MyMacros.Module1.OpenFavoriteFiles" 
```

因此，您可能可以创建一个带有文件名和行号的宏，然后打开文件并跳转到正确的位置。但是，我不知道您是否可以在某处指定相同实例标志。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-02-24T13:23:38.813

我正要问这个问题，因为当您在调试 Web 应用程序时遇到“黄屏死机”时，您想快速转到它在堆栈跟踪中提供给您的文件和行，例如：

```
[ContractException: Precondition failed: session != null]
   System.Diagnostics.Contracts.__ContractsRuntime.TriggerFailure(ContractFailureKind kind, String msg, String userMessage, String conditionTxt, Exception inner) in C:\_svn\IntegratedAdaptationsSystem\Source\IntegratedAdaptationsSystem\IAS_UI\Controllers\CustomErrorsPageController.cs:0
   System.Diagnostics.Contracts.__ContractsRuntime.ReportFailure(ContractFailureKind kind, String msg, String conditionTxt, Exception inner) in C:\_svn\IntegratedAdaptationsSystem\Source\IntegratedAdaptationsSystem\IAS_UI\Controllers\CustomErrorsPageController.cs:0
   System.Diagnostics.Contracts.__ContractsRuntime.Requires(Boolean condition, String msg, String conditionTxt) in C:\_svn\IntegratedAdaptationsSystem\Source\IntegratedAdaptationsSystem\IAS_UI\Controllers\CustomErrorsPageController.cs:0
   IAS_UI.Web.IAS_Session..ctor(HttpSessionStateBase session) in C:\_svn\IntegratedAdaptationsSystem\Source\IntegratedAdaptationsSystem\IAS_UI\Web\IAS_Session.cs:15
   IAS_UI.Controllers.ServiceUserController..ctor() in C:\_svn\IntegratedAdaptationsSystem\Source\IntegratedAdaptationsSystem\IAS_UI\Controllers\ServiceUserController.cs:41 
```

假设我想在第 41 行访问 ServiceUserController.cs。通常我会打开 Visual Studio 并手动执行此操作，但随后我编写了一个小的 Autohotkey 脚本来执行此操作。

要打开它，您将突出显示文件名和行号，例如`ServiceUserController.cs:41`，然后按您的快捷方式`Alt + v`。这是它的代码：

```
$!v::
if (NOT ProcessExists("devenv.exe"))
{
    MsgBox, % "Visual Studio is not loaded"
}
else
{
    IfWinExist, Microsoft Visual Studio
    {
        ToolTip, Opening Visual Studio...
        c := GetClip()

        if (NOT c) {
            MsgBox, % "No text selected"
        }
        else 
        {
            WinActivate ; now activate visual studio
            Sleep, 50
            ; for now assume that there is only one instance of visual studio - handling of multiple instances comes in later

            arr := StringSplitF(c, ":")

            if (arr.MaxIndex() <> 2) {
                MsgBox, % "Text: '" . c . "' is invalid."
            }
            else {
                fileName := arr[1]
                lineNumber := arr[2]

                ; give focus to the "Find" box
                SendInput, ^d 

                ; delete the contents of the "Find" box
                SendInput, {Home}
                SendInput, +{End}
                SendInput, {Delete}

                ; input *** >of FILENAME *** into the "Find" box
                SendInput, >of{Space}
                SendInput, % fileName

                ; select the first entry in the drop down list
                SendInput, {Down}
                SendInput, {Enter}

                ; lineNumber := 12 remove later

                ; open the go to line dialog
                SendInput, ^g
                Sleep, 20

                ; send the file number and press enter
                SendInput, % lineNumber
                SendInput {Enter}
            }
        }    
        ToolTip
    }
}
return 
```

您需要在它之前粘贴以下“实用程序功能”：

```
GetClip()
{
    ClipSaved := ClipboardAll
    Clipboard=
    Sleep, 30
    Send ^c
    ClipWait, 2
    Sleep, 30
    Gc := Clipboard
    Clipboard := ClipSaved
    ClipSaved=

    return Gc
}

ProcessExists(procName)
{
    Process, Exist, %procName%

    return (ErrorLevel != 0)
}

StringSplitF(str, delimeters)
{
    Arr := Object()

    Loop, parse, str, %delimeters%,
    {
        Arr.Insert(A_LoopField)
    }

    return Arr
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-07-24T10:58:59.350

只要 Visual Studio 尚未打开，使用此命令对我有用。"C:\Program Files (x86)\Microsoft Visual Studio 14.0\Common7\IDE\devenv.exe" /edit "ABSOLUTEFILEPATH_FILENAME.CPP" /command "Edit.GoTo 164"

如果它已经打开，那么有时它会工作并进入正确的路线，但随后它就会停止工作，我从来没有弄清楚为什么。看起来微软已经意识到了这个问题，但表示他们“不会修复”它，除非有更多的人抱怨。所以如果它仍然是一个问题，我建议在这里评论：[https ://connect.microsoft.com/VisualStudio/Feedback/Details/1128717](https://connect.microsoft.com/VisualStudio/Feedback/Details/1128717)

# windows - 我怎样才能拥有便携式 Emacs？

> ID：350345
> 
> 赞同：27
> 
> 时间：2008-12-08T18:14:25.550
> 
> 标签：windows, emacs, text-editor, portability, portable-applications

有没有办法从 USB 驱动器运行 Emacs？我是 Windows 用户，我希望能够在任何没有安装 Emacs 的 PC 上使用它。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-12-08T18:21:01.447

是的，Windows 的“普通”Emacs 发行版已经过预编译，无需任何安装即可运行。只需[从通常的地方获取一个 *.zip 文件，将其](http://ftp.gnu.org/gnu/windows/emacs/)解压到 U 盘上，即可直接使用。（实际的二进制文件在“bin/”目录中。）

您可能想要做的唯一一件事就是将其设置为始终在 USB 磁盘而不是硬盘驱动器上查找“.emacs”；看

```
 (info "(emacs) Windows HOME") 
```

关于如何做到这一点。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-08T22:21:07.190

您可以[在 PortableApps.com 上阅读与 Emacs 相关的页面](http://portableapps.com/search/node/emacs)，如果他们尚未将 Emacs 移植到他们的可移植应用程序集，请请求他们将 Emacs 添加到[文本编辑器](http://portableapps.com/apps/development)列表中。有了足够多的请求，他们最终会这样做。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-06-16T14:32:23.447

这里有一个便携式应用程序版本的 emacs 23.2 的 beta 版本[。](http://portableapps.com/node/23470)初始测试在这里工作正常。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-07-14T11:59:46.010

在 USB 驱动器的根目录中创建一个名为 home 的目录。

在 site-lisp 文件夹中创建 site-start.el，然后复制它，你就可以开始了。

```
(defvar %~dp0 (substring data-directory 0 3)) (defvar usb-home-dir (concat %~dp0 "home/"))
(setenv "HOME" usb-home-dir) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-20T16:18:31.800

我已将 emacs 移植到可移植应用程序格式。

[http://esnm.sourceforge.net/download.html](http://esnm.sourceforge.net/download.html)

# sql - 我可以使用语音识别编写 SQL 吗？

> ID：350348
> 
> 赞同：37
> 
> 时间：2008-12-08T18:15:38.447
> 
> 标签：sql, speech-recognition, ergonomics, naturallyspeaking, code-by-voice

我打字时手腕痛，我想开始使用语音识别编写 SQL 语句、存储过程和视图。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-12-08T18:15:48.057

是的。SQL 非常适合语音识别（就像编程语言一样非常适合，也就是说），因为它的词汇量有限且结构类似句子。除了格式化 SQL 使其看起来不错之外，我可以比打字快得多。然而，口授代码并不适合所有人。一开始可能会非常令人沮丧。尝试并坚持下去的人可能是那些别无选择的人。

我使用 Dragon NaturallySpeaking 10 Professional。专业版具有创建这样的自定义词汇表所需的工具。版本 9 也应该可以正常工作。它很贵，所以如果可能的话，尽量让你工作的公司付钱。还要买一个像样的耳机麦克风。NaturallySpeaking 附带的还不够好（但您可能想先尝试一下，看看它是否适合您）。[KnowBrainer](http://www.knowbrainer.com/)是麦克风推荐的好地方。

**2009-01-05 更新**：我在下面添加了特定于在 SQL Server Management Studio 中听写的提示。

**2012-01-04 更新**：我一直在跟踪 Microsoft 的 WSR 很长一段时间，希望可以添加工具来轻松地从头开始创建一个完全自定义的词汇表，就像我在本教程中使用 NaturallySpeaking 所做的那样。不幸的是，这似乎只能通过 API (SAPI) 来完成。我没有时间写那个代码，所以我会继续使用 NaturallySpeaking 来写代码，直到出现更好的代码。

# 准备

## 清理您的数据库名称和代码

口述“ `SELECT PT_17, PT_28, PT_29 FROM HIK.dbo.PATINFO`”会让人头疼，但我想这是可能的。你必须设置很多发音，因为 NaturallySpeaking 不知道 " `PT_17`" 的发音。这对于听写更可取：

```
SELECT Patient.FirstName, Patient.MiddleName, Patient.LastName FROM Claim.dbo.Patient AS Patient WHERE Patient.LastName LIKE '%smith%' 
```

我切换到我的 TSQL 词汇表来指示上述语句。声明之前的所有内容都按其`LIKE`出现的方式说出。`'%smith%'`被规定为“开放单引号百分号 sierra mike 印度探戈酒店百分号关闭单引号 [PAUSE] 复合-那个”。使用一致的表别名和始终在它们前面的字段有助于提高准确性，因为 NaturallySpeaking 会统计一个单词出现在另一个单词附近的频率。

## 创建 SQL 关键字的单词列表

每行写一个词。您可以选择在单词后面加上反斜杠 (\) 和发音。NaturallySpeaking 使用一个小的备用单词词典来确定您添加到词汇表中的单词的发音，因此它可以毫无问题地确定`SELECT`、`FROM`和`WHERE`的发音方式。它有时可以找出一个复合词，并且它会为之类的东西做出最好的猜测`XACT_ABORT`。我会为这些案例提供发音。您使用的数据库将确定列表包含哪些单词 - 检查您的文档以获取关键字列表。您的列表看起来像这样，但要长得多。

```
SELECT
WHERE
FROM
XACT_ABORT\exact-abort
MAXDOP
NOLOCK\no-lock
LEN
RETURNS
CURSOR
MONEY 
```

还要加上这些词

```
\New-Line
\New-Paragraph
\All-Caps
\All-Caps-On
\All-Caps-Off
\Cap
\Caps-On
\Caps-Off
\No-Caps
\No-Caps-On
\No-Caps-Off
\No-Space
\No-Space-On
\No-Space-Off
\space-bar
\tab-key
a\alpha
b\bravo
c\charlie
d\delta
e\echo
f\foxtrot
g\golf
h\hotel
i\india
j\juliet
k\kilo
l\lima
m\mike
n\november
o\oscar
p\papa
q\quebec
r\romeo
s\sierra
t\tango
u\uniform
v\victor
w\whiskey
x\xray
y\yankee
z\zulu
PM
AM
one
two
three
four
five
six
seven
eight
nine
ten
eleven
twelve
thirteen
fourteen
fifteen
sixteen
seventeen
eighteen
nineteen
twenty
thirty
fourty
fifty
sixty
seventy
eighty
ninety
hundred
thousand
million
billion
trillion 
```

保留此列表，因为您可能会对其进行多次修改并重新创建您的词汇表以使其以您喜欢的方式获得。

## 创建数据库对象名称的单词列表

这就是我在 SQL Server 中的操作方式：

```
SELECT DISTINCT * FROM 
(
SELECT DISTINCT [name] FROM Database1.[dbo].[sysobjects] WHERE xtype not IN ('F', 'S', 'PK', 'D', 'UQ') 
UNION 
SELECT DISTINCT column_name AS [name] FROM Database1.information_schema.[columns]
UNION
SELECT DISTINCT [name] FROM Database2.[dbo].[sysobjects] WHERE xtype not IN ('F', 'S', 'PK', 'D', 'UQ') 
UNION 
SELECT DISTINCT column_name AS [name] FROM Database2.information_schema.[columns]
...
) AS UnionTable 
```

将结果复制并粘贴到文本文件中。

## 为您的数据库对象名称创建发音

使用与上述相同的发音格式。创建这些的一种简单方法是使用正则表达式搜索和替换功能。在 SQL Server Management Studio 或 Visual Studio 中，以下（非标准）正则表达式将为两个单词混合大小写名称创建发音。

```
Find: ^{[A-Z][a-z]+}{[A-Z][a-z]+}$
Replace: \0\\\1-\2 
```

查看发音并清理任何看起来不正确的内容。对于首字母缩略词，`ASP`变为“ASP”。保留此列表。如果您决定为其他编程语言制作词汇表，如果您是数据库开发人员，您可能会包含这些词。

## 创建一个包含所有 SQL 代码（视图、过程等）的文本文档

SQL 服务器：

```
SELECT * FROM Database1.dbo.[View] UNION SELECT * FROM Database1.dbo.Routine UNION
SELECT * FROM Database2.dbo.[View] UNION SELECT * FROM Database2.dbo.Routine 
...
ORDER BY [Name] 
```

删除注释和文字字符串。正则表达式搜索和替换适用于此。

# 建立你的词汇量

如果您还没有安装 NaturallySpeaking 并创建一个新用户。

## 创建一个新词汇

点击“NaturallySpeaking | Manage Vocabularies...”。单击新建。将词汇命名为适当的名称，例如“SQL”。基于“基本通用 - 空听写”。当它询问您是否要扫描电子邮件或文档时，请单击取消。

## 导入单词

单击“单词|导入”。添加您创建的两个单词列表并导入它们。

## 适应写作风格

单击“工具|精度中心”。单击“将文档中的单词添加到词汇表”。使用默认设置，然后选择您创建的包含您的代码的文档。

## 尝试听写一些 SQL

您可能想要指示的第一件事是选择语句。请记住，SELECT 是用于在 NaturallySpeaking 中开始选择文本的命令。正因为如此，在口述之前，您需要说“Cap”，这样 NaturallySpeaking 就不会感到困惑。就是这样。好吧，至少足以让你开始。根据需要修改您的单词列表、发音和单词属性。您还可以采取其他措施来提高准确性和口述速度。当我想到它们时，我将编辑这篇文章并将它们添加到这里。

## 听写 SQL Server Management Studio 的提示

如果您指示进入 SQL Server Management Studio，您可能会注意到性能非常缓慢。尝试以下方法来缓解这种情况：

*   关闭所有工具栏（创建宏以访问常用功能）
*   尽可能少地打开窗格和文档
*   一次只打开一个数据库
*   完成后隐藏搜索结果 (Ctrl+R)
*   如果一切都失败了，关闭并重新打开管理工作室
*   [在编辑窗口中显示制表位](https://stackoverflow.com/questions/332574/how-can-i-see-where-the-tab-stops-are-in-the-sql-server-management-studio-editor)，以便更轻松地格式化 SQL。

SQL Server 2000 的查询分析器没有这些问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2015-01-08T03:29:09.873

[http://voicecode.io](http://voicecode.io)

我最近发布了 VoiceCode，这是我为解决我自己的 RSI 问题而创建的一种语音编码解决方案。

我用它在 Sublime Text 和 Xcode 中进行编码，以及一般的计算机使用。它适用于以包括 SQL 在内的任何语言编写代码。该解决方案的优点在于，所有命令都可以链接到“命令短语”中，因此您不必像使用其他语音命令解决方案那样在每个单独的命令之间暂停。

它内置支持所有标准变量名格式（snake case、camel case 等），内置命令用于键盘快捷键的每个排列（即 command-shift-5、command-option-shift-T 等） , 具有光标移动命令、应用程序切换命令、窗口切换命令、符号组合命令，如“=>”、“||”、“>=”等，等等。此外，添加您自己的自定义命令也非常容易。

# seo - 搜索引擎优化的 URL 格式提示？

> ID：350352
> 
> 赞同：1
> 
> 时间：2008-12-08T18:17:01.923
> 
> 标签：seo

我正在寻找符合 SEO 的网站的 url 编码提示。

我有我需要的变量列表！

hypen = 用于分割位置，Leeds-UK-England
space = 下划线表示出现空格的位置
hypen = 加号用于某些英国位置 (stafford-upon-avon)
正斜杠 = 用于事物名称的感叹号。

选择的人是坏的还是好的？有没有更好的，我很确定我需要所有数据才能正确解码 url。

我的“搜索引擎优化”给了我一份不好但不好的事情清单。我搜索了这些，谷歌似乎给出了相同类型的结果。

干杯，萨基

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T18:35:44.477

Google 过去不将下划线识别为单词分隔符 - 请参阅[2005 年的这篇文章](http://www.mattcutts.com/blog/dashes-vs-underscores/)。这已成为公认的智慧，您会在 SEO 上找到的大多数“专家”和文章仍然会推荐这一点。

然而，[去年这种情况发生了变化](http://news.cnet.com/8301-10784_3-9748779-7.html)：下划线现在被识别为单词分隔符，因此它为 URL 设计打开了大门。这现在允许使用破折号作为破折号和下划线作为一些认为更自然的空格。我还没有发现很多人已经赶上了这件事，包括我专业打交道的 SEO 顾问。

至于适合您的用例的好的系统，我建议询问一些非技术人员（同事、朋友、家人等），看看他们喜欢什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T18:22:19.777

空格连字符是常用且首选的方法。

# .net - Unity中的“列表注入”？

> ID：350353
> 
> 赞同：1
> 
> 时间：2008-12-08T18:17:06.590
> 
> 标签：.net, dependency-injection, inversion-of-control, unity-container

我有一个项目即将推出，该项目将涉及通过相同的接口连接到一对多的后端系统；我们称它为 IBacksideProvider。

我想使用 Unity 在运行时注入这些提供程序。问题是因为我们谈论的是 1...n 个后端系统，所以我需要注册 1...n 个 IBacksideProvider 的实现。Unity 不支持开箱即用。

[然而，这篇博文](http://blog.ashmind.com/index.php/2008/09/08/comparing-net-di-ioc-frameworks-part-2/)表明这是可以做到的。我想知道是否有人这样做过或知道如何使用 Unity 以便能够做到这一点。TIA。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T18:44:42.260

为什么这不起作用？ [http://msdn.microsoft.com/en-us/library/cc440943.aspx](http://msdn.microsoft.com/en-us/library/cc440943.aspx)

> 要根据命名注册从容器中检索对象实例列表，请使用 ResolveAll 方法并为对象类型（注册类型）指定一个值。ResolveAll 方法返回非默认（命名）注册类型的 IEnumerable 泛型列表，您可以在代码中遍历这些类型以检查每个对象。

```
IEnumerable<IMyObject> objects = myContainer.ResolveAll<IMyObject>(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-06T23:50:07.930

Unity 从 2008 年 11 月左右发布的 1.2 版开始支持数组注入。这是您目前可以做的最好的事情，而无需将统一容器注入到您的对象中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-15T05:43:14.300

[LinFu.IOC](http://www.codeproject.com/KB/cs/LinFu_IOC.aspx "林福")支持构造函数、属性、方法甚至字段的 IEnumerable<T> 和 IList<T> 注入，开箱即用。AFAIK，它是该博客上为数不多的真正支持列表注入的容器之一。

# .net - 如何在 .NET 中生成 GIF 图像？

> ID：350354
> 
> 赞同：5
> 
> 时间：2008-12-08T18:17:08.587
> 
> 标签：.net, image, gif, image-generation

是否有一个 .NET 库可以用来以编程方式生成我自己的 GIF 图像？

至少我想逐个像素地构建它。更好的是支持文本和形状。

这是我正在尝试做的一个例子。我在 Photoshop 中模拟了这个……

[数字线图形 http://img143.imageshack.us/img143/5458/dollarlineot9.gif](http://img143.imageshack.us/img143/5458/dollarlineot9.gif)

你有什么建议吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-08T18:28:12.230

```
Bitmap bmp = new Bitmap(xSize, ySize, PixelFormat.Format32bppArgb);
using (Graphics g = Graphics.FromImage(bmp)) {
  // Use g and/or bmp to set pixels, draw lines, show text, etc...
}
bmp.Save(filename, ImageFormat.Gif); 
```

任务完成

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-08T18:33:21.347

请注意，除了该`bmp.Save(filename, ImageFormat.Gif);`方法之外，还有一种方法`bmp.Save(stream, ImageFormat.Gif);` 允许您创建图像并将其输出到网页，而无需将其保存到服务器硬盘中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-08T18:37:05.910

这是对命名空间中的类进行此操作的开始`System.Drawing`。它绘制了一条带有两个框的线，以展示对形状的支持，而不是简单地设置像素。

```
// add a reference to System.Drawing.dll
using System;
using System.Drawing;
using System.Drawing.Imaging;

namespace ConsoleApplication2
{
    class Program
    {
        static void Main(string[] args)
        {
            Bitmap bmp = new Bitmap(400, 100);

            using (Graphics g = Graphics.FromImage(bmp))
            {
                g.FillRectangle(Brushes.White, 0.0f, 0.0f, 400f, 100f);

                // draw line
                using (Pen p = new Pen(Color.Black, 1.0f))
                {
                    g.DrawLine(p, 0, 49, 399, 49);
                }

                // Draw boxes at start and end
                g.FillRectangle(Brushes.Blue, 0, 47, 5, 5);
                g.FillRectangle(Brushes.Blue, 394, 47, 5, 5);
            }

            bmp.Save("test.gif", ImageFormat.Gif);
            bmp.Dispose();
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-08T18:27:26.553

为什么不直接使用 System.Drawing 命名空间？你需要的一切都应该在那里。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-08T18:41:21.017

如何使用 HTTPHandler 创建图像并在流中发送的示例（使用此处已发布的图像代码）。

采用：

```
<img src="createChart.ashx?data=1"/> 
```

代码：

```
public class CreateChart : IHttpHandler
{
     public void ProcessRequest(HttpContext context)
     {
        string data = context.QueryString["data"]; // Or get it from a POST etc

        Bitmap image = new Bitmap(xSize, ySize, PixelFormat.Format32bppArgb);
        using (Graphics g = Graphics.FromImage(Image)) 
        {
           // Use g to set pixels, draw lines, show text, etc...
        }
        BinaryStream s = new BinaryStream();

        image.Save(s, ImageFormat.Gif);

        context.Response.Clear();
        context.Response.ContentType = "image/gif";
        context.Response.BinaryWrite(s);
        context.Response.End();
     }

     public bool IsReusable { get { return false; } }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T18:23:51.583

为什么不使用图表控件而不是尝试生成 GIF？除非要求严格生成这个特定的 GIF，否则我认为使用图表控件可以为您提供更大的灵活性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-08T18:25:27.990

我喜欢[我公司的产品](http://www.atalasoft.com/products/dotimage/photopro/default.aspx)。您将能够读/写 GIF 并用整块布料创建它们。它是桌面应用程序的运行时免版税，许可用于服务器。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-08T18:39:01.850

[使用 ASP.NET 即时生成图像](http://www.informit.com/articles/printerfriendly.aspx?p=25487)（2002 年 2 月 22 日）作者：Stephen Walther

# session - 对于 Web 应用程序，如何在会话超时/用户退出时关闭所有相关的浏览器窗口？

> ID：350372
> 
> 赞同：1
> 
> 时间：2008-12-08T18:21:27.720
> 
> 标签：session, browser, timeout

假设用户在许多不同的浏览器窗口中打开了我的 Web 应用程序。一段时间后，他超时/退出应用程序。

我想关闭所有相关的浏览器窗口。我们该如何处理呢？

（我认为 GMAIL 会这样做）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T19:37:00.407

如果您维护对任何子窗口的引用，则可以结合使用[window.close()](http://www.w3schools.com/HTMLDOM/met_win_close.asp)和[setTimeout()](http://www.w3schools.com/js/js_timing.asp)。

请注意，在关闭用户的窗口时您应该小心谨慎，因为它可能会导致糟糕的用户体验。想象一下，我打开了我的银行网站来查看一个帐户的交易，以便我可以清算/核对它们。但在中间我跑去吃午饭什么的。当我回来时，我发现我所有的窗口都已关闭，我必须重新登录，即使我不需要，因为我只是在查看一个相对静态的数据列表。或者更糟糕的是，如果关闭窗口没有正确编码，我可能会发现我的浏览器已经完全关闭，这绝对是一种糟糕的体验。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T20:59:35.527

不。就一般用户而言，您的网站无权关闭用户的窗口，如果您尝试，他们会讨厌您的网站。如果您认为您的网站的正常运行取决于能够关闭用户的浏览器，那么您就错了。

此外，您无法指望您尝试关闭用户窗口或执行类似的此类操作是否成功。因此，无论用户在浏览器中做什么，都要花时间让您的网站正常运行。此外，这种方式更容易。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T18:27:55.897

编写一个脚本，当焦点被带到窗口（对于您的应用程序）时，它会检查会话是否仍然有效。如果不是，则发送命令关闭窗口。

# .net - 如何根据构建配置有条件地部署 app.config？

> ID：350377
> 
> 赞同：18
> 
> 时间：2008-12-08T18:22:37.903
> 
> 标签：.net, deployment, configuration, msbuild

我有三个自定义构建配置 { Dev、Qs、Prd }。所以，我有三个应用程序配置 { Dev.config、Qs.config、Prd.config }。我知道如何编辑 .csproj 文件以根据当前的构建配置输出正确的文件。

```
<Target Name="AfterBuild">
   <Delete Files="$(TargetDir)$(TargetFileName).config" />
   <Copy SourceFiles="$(ProjectDir)$(Configuration).config" DestinationFiles="$(TargetDir)$(TargetFileName).config" />
</Target> 
```

我的问题是，我需要有**六个**构建配置 { Dev、Qs、Prd} x { Debug、Release }。我需要支持每个环境的调试和发布设置（优化、pdb 等）。但是，应用程序配置值在调试/发布之间不会改变。

如何使构建脚本尽可能通用并仅使用三个应用程序配置？我不想硬编码太多的条件字符串。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-08T21:40:02.217

我们使用 csproj 文件中的选择元素修复了这个问题。我们设置了几种不同的配置，所以我们所做的就是将此块放入您的 proj 文件中，您可以使用 VS 的配置来帮助您。我确实想支持 Rob 的建议以移动传递的 app.config。一段时间以来，我一直在朝着这个方向前进。

```
 <Choose>
<When Condition=" '$(Configuration)' == 'Debug' ">
  <ItemGroup>
    <None Include="App.config" />
    <None Include="Release\App.config" />
  </ItemGroup>
</When>
<Otherwise>
  <ItemGroup>
    <None Include="Release\App.config">
      <Link>App.config</Link>
    </None>
  </ItemGroup>
</Otherwise> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-08T18:45:55.050

类似的东西

```
<PropertyGroup Condition="'$(Configuration)'=='Dev_Debug' OR '$(Configuration)'=='Dev_Release'" >
    <CfgFileName>Dev</CfgFileName>
</PropertyGroup>
<!-- similar for Qs & Prd -->
<Target ...>...$(CfgFileName).config... 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T19:30:25.363

我建议你的问题表明你已经`app.config`过时了——是时候转向更好的解决方案，并开始解决一些相关问题了。

一方面，您永远不应该将配置文件自动部署到生产环境中，并且您应该期望运营支持人员强烈拒绝任何这样做的尝试。当然，如果你是运营支持人员，那么你应该自己拒绝。相反，您的版本应该包含一些手动更新配置文件的说明，并带有一个示例进行说明。生产配置对于较小的措施来说太重要了，除非您根本不重视您的生产系统。

对于测试和其他环境也是如此，但程度较轻，因此您实际上只需要`app.config`填充您自己的开发工作。

一种选择是将多个配置嵌入到单个`app.config`中，这对于小型、相对不重要的应用程序或在开发/发布的早期阶段是合理的。例如，创建一个名为类似的配置设置`target-env`，其中包含您在代码中用于选择其他配置设置的值，例如通过将该值添加到其他配置设置的键上。

我的偏好是完全过去`app.config`，或者最少使用它。在这种情况下，我更愿意将足够的配置数据放入一个文件中，以允许我的应用程序/系统连接到它的数据库，然后我将剩余的配置详细信息放入一个特殊的数据库表中。这有很多优点，例如让数据库“了解”它所代表的环境（开发、测试、生产等）并将配置和其他数据保持在一起。然后，部署包可以在配置和环境差异方面保持沉默——代码只是访问其配置数据并相应地采取行动，因此相同的部署包适用于任何环境。

然而，这种方法的一个关键成功因素是您的应用程序代码必须“知道”它对配置的期望，并且它必须“知道”拒绝不正确/不完整的配置。这是你应该花时间的地方，而不是试图绕过`app.config`.

这通常意味着创建您自己的类来访问配置数据，然后在整个应用程序中使用该类。这也带来了许多其他好处，例如强类型配置数据：而不是 a `String`，返回 a`DateTime`或 a `Url`，或 an `Integer`，或 a `Currency`，或任何最适合配置数据和应用程序的东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-12-03T09:19:28.027

使用构建服务器怎么样？
自从我在 .NET 中工作以来已经有很长时间了，但是您不能使用 Hudson(-like) 服务器来管理您的构建配置吗？不是更容易吗？
那么NAnt呢？不符合你的需要吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T18:26:18.990

我想采用的最后一个解决方案是创建 6 个应用程序配置，每个自定义配置 1 个

{ `Dev_Debug.config`, `Dev_Release.config`, `Qs_Debug.config`, `...`, `Prd_Release.config`}。

尽管通过该设置，我可以维护通用构建脚本，而不使用条件字符串。

# bash - sudo nohup nice <-- 按什么顺序？

> ID：350381
> 
> 赞同：21
> 
> 时间：2008-12-08T18:23:31.083
> 
> 标签：bash, unix, sudo, nohup, nice

所以我有一个脚本，我想以 root 身份运行，没有挂断并且很好。我应该按什么顺序输入命令？

sudo nohup nice foo.bash &

或者

nohup 不错的 sudo foo.bash &

等等

我怀疑这并不重要，但希望那些**真正**了解的人有一些见解。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-05-09T11:19:44.313

如果需要负面的友好，我会这样做：sudo nohup nice 命令，因为根据 `info coreutils' nohup 应该先于*nice*。如果我想要一个负的 nice 值，sudo 必须在前面，因为只有 root 能够使用负的 nice 值。

如果需要积极的友好，我会简单地做： nohup nice sudo 命令 这确保 nohup 和 nice 不以 root 权限运行。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-12-15T20:22:37.300

sudo 可能不尊重善良。至少，它不在我的机器上（Ubuntu 9.04）。运行这个：

```
nice sudo nice
sudo nice nice 
```

打印出 0 和 10。（请注意，没有命令的 'nice' 会打印出当前的 niceness。）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-08T18:32:27.540

```
~ $ sudo nohup nice whoami
nohup: ignoring input and appending output to `nohup.out'
~ $ sudo cat nohup.out 
root 
```

第一种和第二种方法之间的区别在于谁拥有 nohup.out 文件。`sudo`首先将使其归根用户所有，`nohup`然后 sudo 将使其归您的用户所有。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-08T18:31:48.243

sudo 应该放在最后，这样 nohup 和 nice 就不会以 root 权限运行。

所以后者

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-06-11T10:44:42.597

**不同意**其他答案。我建议：

`sudo nohup nice foo.sh`

我观察到**nohup sudo** *#fail* - 即 nohup 并不总是转移到 sudo 的子子进程（这是针对 Ubuntu 上的某些 /etc/init.d 脚本委托给其他脚本的）。不知道为什么，当然令人惊讶，但确实如此，并且花了很长时间进行调试。

（我注意到其他人报告 niceness 没有通过，所以似乎最好把它放在最后......尽管如果对你的操作系统有疑问，请尽早放置 nice，因为 nice 不生效通常比 nohup 不生效更不是问题！）

请注意，**sudo nohup**使 nohup.out 归 root 所有，正如已经提到的，但这已通过以下方式修复：

`sudo nohup nice foo.sh >> /tmp/foo.stdout.log 2>> /tmp/foo.stderr.log`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-08T18:32:37.133

我猜他们都做了一个 exec* 系统调用来将球传给下一个，所以，无论顺序如何，它都不会留下任何挂起的进程。

我会说 nohup 应该是最后一个，这样另外两个就不会破坏信号处理程序。（我确定 nice 不会使用信号，但 sudo 可以。）

然后，sudo 和 nice，这一切都取决于你想用 nice 改变调度优先级的方式。

*   如果你想提高优先级（即，给 nice 一个负值），请先执行 sudo。
*   如果您想降低优先级（给出一个正值），请在 sudo 之前执行，因为您不需要 root 权限。

# .net - CodeRush 行业技巧

> ID：350383
> 
> 赞同：33
> 
> 时间：2008-12-08T18:24:53.953
> 
> 标签：.net, visual-studio, coderush

我很早以前就在使用[CodeRush](http://en.wikipedia.org/wiki/CodeRush)，现在我打算再次使用它。我已经安装了试用版，但我忘记了除了`Alt`+ `Home`（放下标记）之外的所有很酷的功能。当你不知道一些很酷的技巧时，它真的就像在烧钱（因为它对个人使用来说并不便宜）。

你喜欢它什么？你最好的特点是什么？

我最好的功能是标记： `Alt`+ `Home`（并使用转义返回）

**目前我最喜欢的**

*   `p` `s` `space`/`p` `i` `space`等模板来创建属性。
*   `c` `c` `space`创建构造函数。
*   按下`Tab`可在对标识符的引用之间导航。
*   `Shift`+`F12`在新的酷窗口中查找参考。
*   `Ctrl`++`Shift`用于`.`最近的文件。
*   `Ctrl`++`Shift`用于`Q`跳转到任何函数/类。
*   `f` `e` `space`/`p` `i` `space`用于“for 循环”。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-08T18:58:48.737

我最近安装了 Xpress 版本并进行了类似的搜索。[这份备忘单](http://community.devexpress.com/blogs/markmiller/archive/2008/11/24/shortcuts-and-templates-quick-start-sheets-for-coderush.aspx)是我目前发现的。顺便说一句，XPress 版本非常笨拙，所以我正在尝试获得许可证的资金。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-07T16:10:09.263

我经常使用这些：

*   `/`将注释或取消注释突出显示的代码块。

*   `b`将突出显示的选择包裹在大括号中。

*   `Ctrl`+`3`将选择包装到一个区域中。

*   `tc`将生成一个 try/catch 块。

*   `mbs`将写入 a`MessageBox.Show("");`并将光标放在引号中。

*   `cws`会做同样的事情，但使用`Console.Writeline`.

*   `m`将创建一个方法块（ms 将执行一个返回类型字符串的方法块）。

*   `.`将创建一个评论块。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-07-22T03:24:01.860

`NumPad+Plus`将您的选择范围扩大一个级别。

尝试一下。这是崇高的:)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-10T14:06:53.070

`F2`- 改名

严格来说，这是 RefactorPro 的快捷方式，因为重命名功能适用于 RefactorPro。（但是，由于 RefactorPro 包含在 CodeRush 的价格中，这应该不是问题）

我认为它也是默认禁用的。

您应该能够使用`DevExpress\Options...\IDE\Shortcuts`屏幕搜索`F2`并重新启用它。

`F2`当您已经习惯`F2`了资源管理器中文件和文件夹的功能时，使用它来重命名变量和方法是非常自然的。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-02-05T16:35:04.110

**搜索类型**

QuickNav ( `Ctrl`+ `Shift`+ `Q`) 有时可能有点过分......

如果您知道您正在寻找类型，请使用附加参数“ **AllTypes,, AllVisibilities, CurrentSolution** ”（不带引号）将`Ctrl`+绑定`T`到**QuickNav**

 **这将允许您仅搜索当前解决方案中的类型

这些参数可以根据您的喜好进行调整。有关详细信息，请参阅[http://community.devexpress.com/forums/p/66380/225556.aspx#225556](http://community.devexpress.com/forums/p/66380/225556.aspx#225556)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-07T16:19:14.817

rt / rf = 返回真假

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-02-08T08:49:04.467

**搜索会员**

QuickNav ( **Ctrl+Shift+Q** ) 有时可能有点过分......

如果您知道您正在寻找一种方法，请使用“ **AllTypes、AllMembers、AllVisibilities、CurrentFile** ”的附加参数将**Ctrl+M**绑定到**QuickNav**（不带引号）

 **这将允许您仅搜索当前文件中的成员。

这些参数可以根据您的喜好进行调整。有关详细信息，请参阅[http://community.devexpress.com/forums/p/66380/225556.aspx#225556](http://community.devexpress.com/forums/p/66380/225556.aspx#225556)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-09-16T10:52:03.843

这是一个用于生成保护条款的简单 CodeRush 模板。

在方法中键入**inx** `space`，而剪贴板上有一个变量引用，您将获得...

```
If [VariableName] Is nothing Then
    return 
End If 
```

或者

```
if ([VariableName] == null)
{
    return;
} 
```

...取决于您当前使用的语言。

此模板在[DevExpress 网络研讨会](http://devexpress.com/Support/Webinars/series-details.xml?series=CodeRush%20Feature%20Workshop)中经常被称为**If Not Null**或**If Null Exit**

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-11T10:39:43.543

这是[DevExpress Coderush 论坛上的旧帖子](http://community.devexpress.com/forums/t/57572.aspx)：

其中是 Mark Miller 的设置建议，以增强 CodeRush 的默认“嵌入括号”功能。

一旦到位......突出显示一些文本并点击'（'。您的选择将包含在括号中，更重要的是您的插入符号将在选择的左侧。（类似适用于右括号）

VB.Net 用户与 CInt、CStr 等一起使用的理想选择

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-09-14T23:45:07.727

VS.NET 内部

按“Ctrl + Shift + Alt + O”将列出所有 DX 选项（将快捷键放在搜索框中将带您进入键盘绑定）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-02-05T14:25:16.890

[CR_MetricShader](http://code.google.com/p/dxcorecommunityplugins/wiki/CR_MetricShader)：是 CodeRush 或 CodeRush Xpress 的免费开源插件，当您的方法的复杂性失控时，它可以让您直观地看到。

它会将您的方法的背景颜色更改为与您选择的指标相关的严重程度。

与 CodeRush 的内置指标（以及 CodeRush Xpress 中的隐藏指标）一起使用，并与您可能选择自己创建的任何指标兼容。

# asp.net - 实现 Paul Johnson 的 Web Widget 代码时出现问题，它在 VS 2008 中有效，但在部署到 IIS 6.0 时无效

> ID：350393
> 
> 赞同：2
> 
> 时间：2008-12-08T18:28:07.127
> 
> 标签：asp.net, iis-6, web-config, widget, ihttphandler

使用[Paul Johnson 的 Web Widgets](http://blogs.msdn.com/pajohn/archive/2008/06/18/web-widgets-with-net-part-one.aspx)页面中的说明，我创建了自己的自定义小部件。但是，因为我正在部署到 IIS 6.0，所以我使用了[推荐的 web.config 更改](http://blogs.msdn.com/pajohn/archive/2008/06/18/web-widgets-with-net-part-one.aspx#8998840)来呈现页面，因为 IIS 7.0 配置管理选项在 IIS 6.0 中不可用。

使用 VS 2008 调试时，小部件会正确呈现。但是，一旦将文件和更新的 web.config 部署到运行 IIS 6.0 的 Windows 2003 Server 并且引用的地址呈现的错误是“找不到页面”。

开发机器是 Windows Vista 机器，但是由于 VS 2008 使用自己的内部 Web 服务器而不是 Vista 的 IIS 7.0 进行调试，我不相信这会成为问题。

任何调试此问题的帮助将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T17:22:49.710

他的指示是不完整的。您还需要将 .jss 的应用程序配置中的脚本映射添加到 windows\microsoft.NET\framework\vXXXX\ 目录中的 aspnet_isapi.dll。

IIS6 不执行 Cassini 固有的集成管道，并且在 IIS7 中是默认设置。

**编辑**：详细信息

*   在 IIS 管理器中打开应用程序属性。
*   选择主目录选项卡
*   单击配置...
*   在 .aspx 的映射列表中选择条目，单击编辑...
*   高亮并复制Executable文本框的内容，点击取消
*   单击添加...
*   粘贴到可执行文本框中
*   在 Extension 文本框中输入 .jss
*   输入 GET。HEAD in Limit to: 框
*   您可能需要禁用验证文件是否存在

好的，很多。

现在，扩展名为 .jss 的 URL 将移交给 ASP.NET 进行处理。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-30T15:42:31.703

我必须进行的其他一些更改...

配置更改（处理程序应映射到 EventsWidget，而不是 WidgetBase）：

```
<system.web>
<httpHandlers>
<add verb="GET,HEAD" path="eventswidget.jss" type="Demo1.Handlers.EventsWidget, Demo1" validate="false" />
</httpHandlers>
</system.web> 
```

EventsWidget.BuildOutput 应该返回 Javascript（取决于您在 Default.aspx 中设置“脚本”标签的方式）：

```
Public Overrides Function BuildOutput() As String
    Dim sOutput As String = "document.write('<br><b>Hello World</b>');"
    Return sOutput
End Function 
```

# sql - 在 SQL Server 中测试空格

> ID：350400
> 
> 赞同：7
> 
> 时间：2008-12-08T18:31:24.640
> 
> 标签：sql, sql-server, whitespace

我的表中有一些空白值，我似乎无法在 IF 语句中捕获它们。

我试过了

`IF @value = ''`并且`if @value = NULL`没有一个人能捕捉到空白值。有什么方法可以测试 varchar 是否完全是空格？

啊哈！原来我正在测试 null 错误。谢谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-08T18:47:34.843

```
ltrim(rtrim(isNull(@value,''))) = '' 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-08T18:35:36.067

要与 NULL 进行比较，请使用 IS NULL 关键字。

```
--Generic example:
SELECT *
FROM MY_TABLE
WHERE SOME_FIELD IS NULL;

--Instead of    

SELECT *
FROM MY_TABLE
WHERE SOME_FIELD = NULL; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-08T18:32:58.383

如果长度（@value）= 0 或@value 为空

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-08T18:33:59.940

```
(LTRIM(RTRIM(@Value))='' 
```

应该做的伎俩。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-09T15:23:13.600

其中 length(rtrim(ltrim(yourcolumnname))) = 0 或 yourcolumnname 为空

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-05-08T23:50:54.073

我只是做了一些测试，发现了一些有趣的东西。我曾经这样写我的查询：

```
SELECT *
FROM TableA
WHERE Val IS NOT NULL
AND LEN(RTRIM(LTRIM(Val))) > 0 
```

但是，您实际上不需要检查 null，您需要做的就是在修剪值后检查长度。

```
SELECT *
FROM TableA
WHERE LEN(RTRIM(LTRIM(Val))) > 0 
```

此选择会清除空值以及仅包含空格的任何列。

事实证明，您不需要修剪该值，因为 SQL Server 忽略尾随空格，所以您实际上需要它：SELECT * FROM TableA WHERE LEN(Val) > 0

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-10-20T09:42:02.170

`LTRIM`与其使用AND执行过多的字符串操作`RTRIM`，不如在表达式中搜索第一个“非空格”。

```
SELECT
            *
    FROM
            [Table]
    WHERE
            COALESCE(PATINDEX('%[^ ]%', [Value]), 0) > 0 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-08T18:37:22.680

您可能有多个空格 (' ') 的字段，因此如果您修剪它，您将获得更好的结果：

```
where ltrim(yourcolumnname) = '' 
```

# design-patterns - 代理、装饰器、适配器和桥接模式有何不同？

> ID：350404
> 
> 赞同：444
> 
> 时间：2008-12-08T18:32:06.513
> 
> 标签：design-patterns, decorator, bridge, proxy-pattern

我在看代理模式，对我来说，它看起来很像装饰器、适配器和桥接模式。我是不是误会了什么？有什么不同？为什么我要使用代理模式而不是其他模式？您过去是如何在现实世界的项目中使用它们的？

* * *

## 回答 #1

> 赞同：709
> 
> 时间：2008-12-08T18:56:19.287

Proxy、Decorator、Adapter 和 Bridge 都是“包装”类的变体。但它们的用途不同。

*   **当你想延迟实例化一个对象，或者隐藏你正在调用远程服务的事实，或者控制对对象的访问时，可以使用**代理。****

***   **Decorator**也称为“智能代理”。当您想向对象添加功能但不扩展该对象的类型时使用此选项。这允许您在运行时这样做。

    *   **当您有一个抽象接口并且您希望将该接口映射到另一个具有相似功能但接口不同的对象时，将使用**适配器。****

    ***   **Bridge**与 Adapter 非常相似，但是当您同时定义抽象接口和底层实现时，我们将其称为 Bridge。即，您不适应某些遗留或第三方代码，您是所有代码的设计者，但您需要能够交换不同的实现。

    *   **外观**是一个或多个类的子系统的更高级别（阅读：更简单）的接口。假设您有一个复杂的概念，需要多个对象来表示。对那组对象进行更改是令人困惑的，因为您并不总是知道哪个对象具有您需要调用的方法。是时候编写一个外观，它为您可以对对象集合执行的所有复杂操作提供高级方法。示例：学校部门的领域模型，具有`countStudents()`、`reportAttendance()`、`assignSubstituteTeacher()`等方法。**** 

 ***** * *

## 回答 #2

> 赞同：222
> 
> 时间：2011-08-27T00:19:35.933

[正如比尔的回答所说，他们的用例是不同的](https://stackoverflow.com/questions/350404/how-do-the-proxy-decorator-adaptor-and-bridge-patterns-differ/350471#350471)。

他们的结构也是如此。

*   **Proxy**和**Decorator**都具有与其包装类型相同的接口，但代理在后台创建一个实例，而装饰器在构造函数中获取一个实例。

*   **Adapter**和**Facade**的接口都与它们封装的接口不同。但是适配器派生自现有接口，而外观创建一个新接口。

*   **Bridge**和**Adapter**都指向现有类型。但是桥将指向一个抽象类型，而适配器可能指向一个具体类型。桥将允许您在运行时配对实现，而适配器通常不会。

* * *

## 回答 #3

> 赞同：64
> 
> 时间：2013-04-23T15:22:00.333

我对这个问题的看法。

所有四种模式都有很多共同点，所有四种模式有时都被非正式地称为包装器或包装器模式。所有人都使用组合，包装主题并在某个时候将执行委托给主题，将一个方法调用映射到另一个方法调用。它们使客户不必构建不同的对象并复制所有相关数据。如果使用得当，它们可以节省内存和处理器。

通过促进松散耦合，它们使曾经稳定的代码更少暴露于不可避免的变化，并且对于其他开发人员来说更好地可读。

**适配器**

适配器使主题（适配器）适应不同的接口。通过这种方式，我们可以将对象添加到名义上不同类型的集合中。

适配器只向客户端公开相关方法，可以限制所有其他方法，揭示特定上下文的使用意图，例如调整外部库，使其看起来不那么通用，更专注于我们的应用程序需求。适配器增加了我们代码的可读性和自我描述。

适配器保护一个团队免受其他团队的易失性代码的影响；与离岸团队打交道时的救星工具；-)

较少提及的目的是防止主题类过多的注释。有这么多基于注释的框架，这变得比以往任何时候都更重要。

适配器有助于绕过 Java 仅单继承的限制。它可以将多个适配器组合在一个信封下，给人以多重继承的印象。

代码方面，适配器是“瘦”的。除了简单地调用适配器方法和进行此类调用所需的偶尔数据转换之外，它不应向适配器类添加太多代码。

JDK 或基本库中没有很多好的适配器示例。应用程序开发人员创建适配器，以使库适应应用程序特定的接口。

**装饰器**

装饰器不仅委托，不仅将一个方法映射到另一个，他们做的更多，他们修改一些主体方法的行为，它可以决定根本不调用主体方法，委托给不同的对象，一个辅助对象。

装饰器通常（透明地）向包装对象添加功能，例如记录、加密、格式化或压缩到主题。这个新功能可能会带来很多新代码。因此，装饰器通常比适配器“胖”得多。

装饰器必须是主题接口的子类。它们可以透明地使用而不是其主题。请参阅 BufferedOutputStream，它仍然是 OutputStream，可以这样使用。这是与适配器的主要技术差异。

整个装饰器系列的教科书示例很容易在 JDK - Java IO 中。所有类如[BufferedOutputStream](http://docs.oracle.com/javase/8/docs/api/java/io/BufferedOutputStream.html)、[FilterOutputStream](http://docs.oracle.com/javase/8/docs/api/java/io/FilterOutputStream.html)和[ObjectOutputStream](http://docs.oracle.com/javase/8/docs/api/java/io/ObjectOutputStream.html)都是[OutputStream](http://docs.oracle.com/javase/8/docs/api/java/io/OutputStream.html)的装饰器。它们可以是洋葱层，其中一个装饰器再次装饰，增加更多功能。

**代理**

代理不是典型的包装器。被包装的对象，即代理主体，在创建代理时可能还不存在。代理经常在内部创建它。它可能是按需创建的重对象，也可能是不同JVM或不同网络节点中的远程对象，甚至是非Java对象，本机代码中的组件。它根本不需要包装或委托给另一个对象。

最典型的例子是远程代理、重对象初始化器和访问代理。

*   远程代理 - 主题位于远程服务器、不同的 JVM 甚至非 Java 系统上。代理将方法调用转换为 RMI/REST/SOAP 调用或任何需要的调用，保护客户端免受底层技术的影响。

*   延迟加载代理 - 仅在第一次使用或第一次密集使用时完全初始化对象。

*   访问代理——控制对主题的访问。

**正面**

立面与最少知识的设计原则（得墨忒耳法则）密切相关。Facade 与 Adapter 非常相似。它们都包裹，它们都将一个对象映射到另一个对象，但它们的意图不同。Facade 将复杂结构的主体、复杂对象图展平，简化了对复杂结构的访问。

Facade 包装了一个复杂的结构，为它提供了一个平面接口。这可以防止客户端对象暴露于主体结构中的内部关系，从而促进松散耦合。

**桥**

适配器模式的更复杂变体，其中不仅实现不同，而且抽象也不同。它为委托增加了一种间接性。额外的代表团是桥梁。它甚至将适配器与适配接口解耦。它比其他任何包装模式都增加了复杂性，因此请谨慎应用。

**构造函数的区别**

查看构造函数时，模式差异也很明显。

*   **代理**未包装现有对象。构造函数中没有主题。

*   **装饰器**和**适配器**确实包装了已经存在的对象，并且通常
    在构造函数中提供。

*   **Facade**构造函数获取整个对象图的根元素，否则它看起来与 Adapter 相同。

现实生活中的例子[——JAXB 编组适配器](https://bitbucket.org/espinosa/a-java-playground/src/078ae4a51f4a2f384fd87c727b7becbba3e4fe2f/src/main/java/my/code/a001/adapter/BinaryResourceBatchJaxbAdapter.java?at=master)。此适配器的目的是将一个简单的平面类映射到外部所需的更复杂的结构，并防止使用过多的注释“污染”主题类。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2008-12-21T20:18:24.573

许多 GoF 模式存在大量重叠。它们都建立在多态性的力量之上，有时只是在意图上真正不同。（战略与状态）

[阅读Head First Design Patterns](https://rads.stackoverflow.com/amzn/click/com/0596007124)后，我对模式的理解增加了 100 倍。

我强烈推荐它！

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2016-01-29T16:17:24.283

专家的所有好的答案都已经解释了每种模式代表什么。

我将*装饰*关键点。

***装饰师：***

1.  *在运行时向对象添加行为*。继承是实现这一功能的关键，这既是这种模式的优点也是缺点。
2.  它修改接口的*行为*。

例如（带有链接）：与*&**接口**`java.io`相关的包类`InputStream``OutputStream`*

```
FileOutputStream fos1 = new FileOutputStream("data1.txt");  
ObjectOutputStream out1 = new ObjectOutputStream(fos1); 
```

***代理：***

1.  *将它用于延迟初始化，通过缓存对象和控制对客户端/调用者的访问来提高性能*。它可以提供替代行为或调用真实对象。在此过程中，它可能会创建新的对象。
2.  与允许链接对象的*装饰器*不同，代理*不允许链接。*

例如：`java.rmi`包类。

***适配器：***

1.  *它允许两个不相关的接口通过不同的对象一起工作*，可能扮演相同的角色。
2.  *它修改了原来的界面*。

例如`java.io.InputStreamReader`（`InputStream`返回一个`Reader`）

***桥：***

1.  *它允许抽象和实现独立变化*。
2.  它使用*组合而不是继承*。

例如，集合类在`java.util`. `List`由 实施`ArrayList`。

**关键说明：**

1.  ***适配器***为其主题提供了不同的接口。***代理***提供相同的接口。***装饰器***提供了一个增强的接口。
2.  ***Adapter***改变了对象的接口， ***Decorator***增强了对象的职责。
3.  ***Decorator***和***Proxy***用途不同但结构相似
4.  ***适配器***在设计完成后就可以工作；***Bridge***让它们先于它们工作。
5.  ***Bridge***是预先设计的，让抽象和实现独立变化。***改装适配器***以使无关的类一起工作
6.  ***装饰器***旨在让您无需子类化就可以向对象添加职责。

查看有关各种设计模式示例的出色 SE 问题/文章

[何时使用装饰器模式？](https://stackoverflow.com/questions/1549743/when-to-use-the-decorator-pattern/37504043#37504043)

[什么时候使用桥接模式？它与适配器模式有何不同？](https://stackoverflow.com/questions/319728/when-do-you-use-the-bridge-pattern-how-is-it-different-from-adapter-pattern/37514779#37514779)

[代理模式和装饰器模式的区别](https://stackoverflow.com/questions/18618779/differences-between-proxy-and-decorator-pattern/36476818#36476818)

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-12-08T18:53:35.250

它们非常相似，它们之间的线条非常灰色。我建议您阅读 c2 wiki 中的[代理模式](http://c2.com/cgi/wiki?ProxyPattern)和[装饰器模式](http://c2.com/cgi/wiki?DecoratorPattern)条目。

那里的条目和讨论相当广泛，它们还链接到其他相关文章。顺便说一句，当想知道不同模式之间的细微差别时，c2 wiki 非常棒。

总结 c2 条目，我会说装饰器添加/更改行为，但代理更多地与访问控制有关（延迟实例化、远程访问、安全性等）。但就像我说的，它们之间的界线是灰色的，我看到对代理的引用很容易被视为装饰器，反之亦然。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-10-12T23:47:46.143

[这是来自Head First Design Patterns](https://rads.stackoverflow.com/amzn/click/com/0596007124)的引述

定义属于书。例子属于我。

**装饰者**- 不改变界面，但增加责任。假设您有一个汽车接口，当您为不同型号的汽车（s、sv、sl）实现此接口时，您可能需要为某些型号**添加更多责任**。比如有天窗、安全气囊等。

**适配器**- 将一个接口转换为另一个。你有一个汽车接口，你希望它像吉普车一样工作。所以你开着车，改装它，然后变成一辆吉普车。**因为它不是真正的吉普车。但表现得像吉普车。**

**Facade** - 使界面更简单。假设您有汽车、飞机、船舶接口。实际上，您所需要的只是一门将人们从一个位置发送到另一个位置的课程。您希望外观来决定使用什么车辆。**然后，您将所有这些接口引用**收集在 1 个保护伞下，并让它决定/委托以保持简单。

Head First：“外观不仅简化了接口，还将客户端与组件子系统解耦。外观和适配器可以包装多个类，但外观的目的是简化，而适配器的目的是将接口转换为不同的东西。 "

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2013-04-21T10:30:41.900

所有四种模式都涉及用外部对象/类包装内部对象/类，因此它们在结构上非常相似。我将按目的概述差异：

*   **代理**将访问封装在外部到内部。
*   **装饰器**修改或扩展内部与外部的行为。
*   **适配器**将接口从内部转换为外部。
*   **Bridge**将行为的不变部分（外部）与可变或平台相关部分（内部）分开。

通过内部和外部对象之间的接口变化：

*   在**Proxy**接口中是相同的。
*   在**装饰器**接口中是相同的。
*   **适配器**接口在形式上有所不同，但实现相同的目的。
*   **桥**接口在概念上是不同的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-08T18:36:53.773

我在使用 Web 服务时经常使用它。代理模式可能应该重命名为更实用的东西，比如“包装模式”。我还有一个库，它是 MS Excel 的代理。它可以很容易地自动化 Excel，而不必担心背景细节，比如什么版本已安装（如果有）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-03-03T09:45:03.463

说到细节实现，我发现 Proxy 和 Decorator、Adapter、Facade 之间的区别......在这些模式的常见实现中，有一个目标对象被一个封闭对象包裹。客户端使用封闭对象而不是目标对象。而目标对象实际上在一些封闭对象的方法中起着重要的作用。

但是在Proxy的情况下，封闭对象可以自己播放一些方法，它只是在客户端调用一些需要目标对象参与的方法时初始化目标对象。这就是惰性初始化。在其他模式的情况下，封闭对象实际上是基于目标对象。因此，目标对象始终与构造函数/设置器中的封闭对象一起初始化。

另一件事是，代理与目标完全一样，而其他模式为目标添加了更多功能。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-10-22T13:06:51.100

我想为 Bill Karwing 的答案添加示例（顺便说一句，这很棒。）我还添加了一些我觉得缺少的关键实现差异

引用的部分来自 [ [https://stackoverflow.com/a/350471/1984346]](https://stackoverflow.com/a/350471/1984346])的回答（Bill Karwing）

> Proxy、Decorator、Adapter 和 Bridge 都是“包装”类的变体。但它们的用途不同。
> 
> *   **当你想延迟实例化一个对象，或者隐藏你正在调用远程服务的事实，或者控制对对象的访问时，可以使用**代理。****

 **ProxyClass 和 ObjectClass 被代理，应该实现相同的接口，所以它们是可互换的

**示例 - 代理昂贵的对象**

```
class ProxyHumanGenome implements GenomeInterface  {
    private $humanGenome = NULL; 

    // humanGenome class is not instantiated at construct time
    function __construct() {
    }

    function getGenomeCount() {
        if (NULL == $this->humanGenome) {
            $this->instantiateGenomeClass(); 
        }
        return $this->humanGenome->getGenomeCount();
    }
} 
class HumanGenome implement GenomeInterface { ... } 
```

> *   **Decorator**也称为“智能代理”。当您想向对象添加功能但不扩展该对象的类型时使用此选项。这允许您在运行时这样做。

DecoratorClass 应该（可以）实现 ObjectClass 的扩展接口。所以 ObjectClass 可以被 DecoratorClass 替换，但反之则不行。

**示例 - 添加附加功能**

```
class DecoratorHumanGenome implements CheckGenomeInterface  {

    // ... same code as previous example

    // added functionality
    public function isComplete() {
        $this->humanGenome->getCount >= 21000
    }
}

interface CheckGenomeInterface extends GenomeInterface {

    public function isComplete();

}

class HumanGenome implement GenomeInterface { ... } 
```

> *   **当您有一个抽象接口并且您希望将该接口映射到另一个具有相似功能但接口不同的对象时，将使用**适配器。****

 ****实现差异 Proxy、Decorator、Adapter**

适配器为其主题提供了不同的接口。代理提供相同的接口。装饰器提供了一个增强的接口。

> *   **Bridge**与 Adapter 非常相似，但是当您同时定义抽象接口和底层实现时，我们将其称为 Bridge。即，您不适应某些遗留或第三方代码，您是所有代码的设计者，但您需要能够交换不同的实现。
>     
>     
> *   **外观**是一个或多个类的子系统的更高级别（阅读：更简单）的接口。假设您有一个复杂的概念，需要多个对象来表示。对那组对象进行更改是令人困惑的，因为您并不总是知道哪个对象具有您需要调用的方法。是时候编写一个外观，它为您可以对对象集合执行的所有复杂操作提供高级方法。示例：学校部门的领域模型，具有`countStudents()`、`reportAttendance()`、 `assignSubstituteTeacher()`等方法。

此答案中的大部分信息来自**[https://sourcemaking.com/design_patterns](https://sourcemaking.com/design_patterns)**，我推荐它作为设计模式的**优秀资源**。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-12-11T11:55:53.973

我相信代码会给出清晰的想法（也可以补充其他答案）。请看下面，（关注类实现和包装的类型）

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace TestConsole
{
    class Program
    {
        static void Main(string[] args)
        {
            /* Proxy */

            Console.WriteLine(Environment.NewLine);
            Console.WriteLine("PROXY");
            Console.WriteLine(Environment.NewLine);

            //instead of creating here create using a factory method, the facory method will return the proxy
            IReal realProxy = new RealProxy();
            Console.WriteLine("calling do work with the proxy object ");
            realProxy.DoWork();

            Console.WriteLine(Environment.NewLine);
            Console.WriteLine("ADAPTER");
            Console.WriteLine(Environment.NewLine);

            /*Adapter*/
            IInHand objectIHave = new InHand();
            Api myApi = new Api();
            //myApi.SomeApi(objectIHave); /*I cant do this, use a adapter then */
            IActual myAdaptedObject = new ActualAdapterForInHand(objectIHave);
            Console.WriteLine("calling api with  my adapted obj");
            myApi.SomeApi(myAdaptedObject);

            Console.WriteLine(Environment.NewLine);
            Console.WriteLine("DECORATOR");
            Console.WriteLine(Environment.NewLine);

            /*Decorator*/
            IReady maleReady = new Male();
            Console.WriteLine("now male is going to get ready himself");
            maleReady.GetReady();

            Console.WriteLine(Environment.NewLine);

            IReady femaleReady = new Female();
            Console.WriteLine("now female is going to get ready her self");
            femaleReady.GetReady();

            Console.WriteLine(Environment.NewLine);

            IReady maleReadyByBeautician = new Beautician(maleReady);
            Console.WriteLine("now male is going to get ready by beautician");
            maleReadyByBeautician.GetReady();

            Console.WriteLine(Environment.NewLine);

            IReady femaleReadyByBeautician = new Beautician(femaleReady);
            Console.WriteLine("now female is going to get ready by beautician");
            femaleReadyByBeautician.GetReady();

            Console.WriteLine(Environment.NewLine);

            Console.ReadLine();

        }
    }

    /*Proxy*/

    public interface IReal
    {
        void DoWork();
    }

    public class Real : IReal
    {
        public void DoWork()
        {
            Console.WriteLine("real is doing work ");
        }
    }

    public class RealProxy : IReal
    {
        IReal real = new Real();

        public void DoWork()
        {
            real.DoWork();
        }
    }

    /*Adapter*/

    public interface IActual
    {
        void DoWork();
    }

    public class Api
    {
        public void SomeApi(IActual actual)
        {
            actual.DoWork();
        }
    }

    public interface IInHand
    {
        void DoWorkDifferently();
    }

    public class InHand : IInHand
    {
        public void DoWorkDifferently()
        {
            Console.WriteLine("doing work slightly different ");
        }
    }

    public class ActualAdapterForInHand : IActual
    {
        IInHand hand = null;

        public ActualAdapterForInHand()
        {
            hand = new InHand();
        }

        public ActualAdapterForInHand(IInHand hnd)
        {
            hand = hnd;
        }

        public void DoWork()
        {
            hand.DoWorkDifferently();
        }
    }

    /*Decorator*/

    public interface IReady
    {
        void GetReady();
    }

    public class Male : IReady
    {
        public void GetReady()
        {
            Console.WriteLine("Taking bath.. ");
            Console.WriteLine("Dress up....");
        }
    }

    public class Female : IReady
    {
        public void GetReady()
        {
            Console.WriteLine("Taking bath.. ");
            Console.WriteLine("Dress up....");
            Console.WriteLine("Make up....");
        }
    }

    //this is a decorator
    public class Beautician : IReady
    {
        IReady ready = null;

        public Beautician(IReady rdy)
        {
            ready = rdy;
        }

        public void GetReady()
        {
            ready.GetReady();
            Console.WriteLine("Style hair ");

            if (ready is Female)
            {
                for (int i = 1; i <= 10; i++)
                {
                    Console.WriteLine("doing ready process " + i);
                }

            }
        }
    }

} 
```

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2014-03-21T14:10:38.550

设计模式不是数学，它是艺术和软件工程的结合。对于这种要求，您不必使用代理、桥接等。设计模式是为了解决问题而创建的。如果您预计会出现设计问题，请使用它。根据经验，您将了解具体问题，使用哪种模式。如果你擅长扎实的设计原则，你会在不知道它是模式的情况下实现设计模式。常见的例子是战略和工厂模式

因此，更多地关注可靠的设计原则、干净的编码原则和 ttd

# algorithm - 以最佳方式将任务分配给工人

> ID：350411
> 
> 赞同：3
> 
> 时间：2008-12-08T18:33:38.350
> 
> 标签：algorithm, language-agnostic

很长一段时间以来，我一直在研究一个在多台机器上执行分布式构建的综合构建系统。它正确处理依赖关系并且似乎可以很好地扩展，因此我们添加了更多项目和更多机器，但看起来它可以执行得更好。

我遇到的问题是资源分配之一。我有一个可用机器列表和一个我想要构建的项目列表，每台机器还列出了安装的软件、操作系统、编译器版本等......每个项目都列出了它需要的东西。当需要分配工作时，我可以运行一个列出可能分配的数据库查询。现在我需要尽可能有效地执行这些任务。

最小的例子是两个项目 1 和 2，有两台机器 A 和 B。机器 A 可以构建任何一个项目，但机器 B 只能构建项目 1。所以我最终得到了一个对 (A,1), (A,2 ), (B,1)。如果我按顺序处理分配，机器 A 构建项目 1，我必须等到它完成才能构建项目 2。将机器 A 分配给项目 2 并将机器 B 分配给项目 1 可能会更好。但是。 .. 机器 A 可能比机器 B 快得多，完全不使用机器 B 可能是正确的答案。

我敢肯定，这是之前已经多次解决的那种“运筹学”问题。我不一定需要最佳解决方案......只是尝试比我更好的东西 - 似乎我经常以任务排队和机器空闲而结束，更好的分配可以避免。欢迎提出任何建议。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T18:54:08.200

您试图解决的问题等同于经典的作业车间调度问题。找到一个最优的时间表是 NP 难的。

人们已经发明了许多启发式方法来生成时间表，但哪些是好的是高度依赖于问题的。

一些常见的启发式方法是：

*   首先安排最短的任务。
*   首先安排最高度约束的任务，例如，首先选择可以在最少机器上运行的任务。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T18:51:42.853

首先，我的偏好是“拉”模型。

每台机器在空闲时从中央服务器拉取任务。

中央服务器提供一种优先级队列，包按依赖顺序排列。每台机器都向中央服务器发出请求，并被分配一些工作要做。

您有一种池化模型，其中有任务分类，以及具有匹配分类的机器池。例如，池 1 中的机器可以构建某些东西。池 2 中的机器可以构建任何东西。将它们视为“技能”，您会发现这是一种项目管理问题。

如果你的机器真的很慢，你必须手动将它们优化到一个单独的池中，这样它们只会得到没有依赖关系的小分支。

这可能就是你所需要的。但是，如果您想要进一步优化，这是您的下一步。

在你运行了几次之后——并且对性能有一些期望——然后你可以编写一个模块来尝试让每台机器尽可能地忙碌。这种调度正是像 Microsoft Project 这样的事情。

给定任务，具有持续时间和依赖关系，您正在尝试进行“资源平衡”。您希望每个资源（在您的情况下编译客户端）尽可能忙碌，以符合每个客户的技能和生产力。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T18:44:29.497

乍一看，我建议在每台机器上运行一个 Windows 服务，其中一台机器也运行主服务来协调分配。主服务轮询每台机器是否正在处理分配，如果不是，则开始处理队列中它能够处理的任何分配。

# ssis - 如何将变量或参数从 .NET 传递到包？

> ID：350412
> 
> 赞同：2
> 
> 时间：2008-12-08T18:33:42.157
> 
> 标签：ssis, parameters

在 C# 中，我调用的是 SSIS 包。我必须传递 3 个参数，我该怎么做？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T18:48:06.027

package.Variables["YOUR_VAR_1"].Value = "这是测试";

package.Variables["YOUR_VAR_2"].Value = 100;

应该做的伎俩。

# c++ - 您如何协调常见的 C++ 命名约定与库的命名约定

> ID：350419
> 
> 赞同：45
> 
> 时间：2008-12-08T18:36:35.940
> 
> 标签：c++, coding-style, naming-conventions

大多数 C++ 命名约定规定使用`camelCaseIdentifiers`: 以大写字母开头的类名称 ( `Person`, `Booking`) 和以小写字母开头的字段和变量名称 ( `getPrice()`, `isValid()`, `largestValue`)。这些建议与 C++ 库的命名约定完全不一致，后者涉及类 ( `string`, `set`, `map`, `fstream`) 和`names_joined_with_an_underscore`方法和字段 ( `find_first_of`, `lower_bound`, `reverse_iterator`, `first_type`) 的小写名称。更复杂的是操作系统和 C 库函数，它们涉及 C 和 Unix 中的压缩小写名称以及 Windows 中以大写字母开头的函数。

结果我的代码一团糟，因为一些标识符使用 C++ 库、C 或操作系统命名约定，而其他标识符使用规定的 C++ 约定。编写包装库功能的类或方法是痛苦的，因为类似的事物以不同风格的名称结尾。

那么，您如何协调这些不同的命名约定呢？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-08T18:54:11.070

Diomidis，我和你一样痛苦，多年来我一直在不同方案之间切换，试图找到适用于我使用的不同库/框架（MFC 和/或 STL/Boost）的东西。在使用单个框架（例如 STL）时，您可以尝试复制它使用的命名约定，但是当您引入不同的框架时，它很容易分崩离析。

最后，我为我编写的所有新代码采用了单一样式（基于 Google C++ 样式指南），并在适当的时候重构旧代码以使用这种样式。你不能很容易地协调不同的命名约定，所以不要浪费时间去尝试。为您的团队/部门/公司实施一个方案并坚持下去 - 但不要担心在使用混合方案时代码看起来有多“丑陋”。

恕我直言，Google C++ 指南非常好 - 有一些小的修改。在此处查看指南：

[https://google.github.io/styleguide/cppguide.html#Naming](https://google.github.io/styleguide/cppguide.html#Naming)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-12-08T18:49:25.667

采用 C++ 的一种方式`naming_convention`，这是当今文献中大多数代码示例所做的。

我慢慢看到这些约定进入生产代码，但这是与在许多地方仍然盛行的 MFC 命名约定的斗争。

与旧标准作斗争的其他风格差异是使用尾随下划线而不是`m_`表示成员。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-08T18:50:24.323

为什么需要调和？只要代码可以编译，并且您可以完成工作，就不用担心。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-08T18:49:48.660

在代码风格方面，我往往是一个完美主义者，这一直困扰着我。我希望有一个通用标准，但没有。在我的职业生涯中，我发现只要单个项目的程序员保持一致，那就是你所希望的最好的。

归根结底，我认为它归结为知道方法、对象或函数来自哪个库。如果您知道这一点，那么就很容易记住该库使用的约定，假设该项目不包含很多库。我已经尝试调整自己的代码以匹配我使用的库的代码，但它始终是一个移动的目标，最后只是令人沮丧。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-08T18:51:05.490

在我正在从事的项目中，我遵循我的项目的代码约定。当我调用其他东西时，我使用该库的 API。

我还要补充一点，库的包装是一个坏主意（我正在处理的代码库中有很多），因为它通常由解决自己问题的开发人员完成，并且通常不适合使用由所有其他开发人员。另一方面，高质量的包装是昂贵的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-08T19:46:17.017

老实说，我会按原样使用库并坚持自己的编码风格。你*可以*把它包起来，但这似乎有点矫枉过正。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-08T18:50:50.920

最喜欢的报价::

> 关于标准的最好的事情是有这么多可供选择！

我的建议是采用贵公司代码中最常出现的库约定（可能是 C++ 库，我相信 boost 也坚持使用它），并将*其*作为您的标准。否则，您可能根本就没有。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-08T18:58:39.000

好吧，既然我们不能改变标准库的实现方式，我想我们将不得不忍受它。至于调和 - 不久前在编写一些 Win32 API 的东西时，我尝试在 PascalCasing 中命名我自己的方法，就像在 API 中完成的那样，但感觉不对。所以我回到用 camelCase 命名我的方法。我同意这是一团糟，但另一种选择是使您的样式适应您使用的每个新框架或库，然后您提到的问题是在单个项目中拥有多个使用不同约定的库。所以我的建议是——坚持你自己的方法和类的感觉。或者 - 在企业环境中 - 坚持贵公司的最佳实践和指导方针。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-08T19:35:32.953

我似乎记得很久以前读过他们故意使标准库与推荐的编码约定不同，以避免命名冲突。但是，我现在找不到任何提到这一点的参考资料。我记得读过你不应该在类型名称中使用前导小写字母，因为它们是为标准库保留的。我认为使用下划线也会发生类似的事情。我真的不认为多个命名约定是一个问题，因为它清楚地将标准代码与项目中的代码分开。我总是在我的项目中使用大写驼峰式大小写类型和小驼峰式大小写方法/成员来编写代码。我现在的工作场所除了类型之外还使用大写的骆驼案例来表示方法，这让我非常恼火。但是，他们也喜欢匈牙利疣，

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-02-07T21:10:08.787

你应该接受差异。

当人们看到 remove_copy_if 的使用时，他们会立即知道这是一个算法。这实际上是一个积极的特征，因为算法带有某些保证（或缺乏）。

我们还为我们自己的自定义算法使用命名约定。

# asp-classic - 经典的 ASP gremlims，每当使用 HTML 特殊字符时都会在文本中插入一个 Â

> ID：350429
> 
> 赞同：5
> 
> 时间：2008-12-08T18:42:13.480
> 
> 标签：asp-classic, utf-8

我在一个较旧的经典 ASP 站点上工作，并且有一个表单允许用户输入一些文本（进入多行文本框），如果他们添加像 ® （注册商标）这样的 html 字符，它会正确插入。但是当他们去编辑数据时，使用相同的表格，更新会在注册商标前添加一个随机的“Â”（抑扬符）。内容类型为 utf-8。

有任何想法吗？

谢谢你给这个的任何时候。它一直让我发疯。-m

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-09T11:02:57.230

根本问题是 Response.Codepage 对表单帖子的影响。

当您将表单发送到指定内容编码为 UTF-8 的客户端时，浏览器将假定表单帖子的内容应以 UTF-8 编码发送。

现在接收帖子的操作页面将（有点反直觉地）使用值**`Response.Codepage`**来告知它帖子中的字符是如何编码的。这并不明显，因为我们倾向于认为发送者的工作是定义其发送内容的编码。此外，认为与我们想要在响应中发送的内容的编码有关的属性与初始请求的接收方式有任何关系，这也不是一个自然的飞跃。在这种情况下，它确实如此。

发生的事情是您的表单正在发布字符的 UTF-8 编码版本，但接收的页面没有将其 Response.Codepage 设置为 65001（UTF-8 代码页）。它可能设置为系统 OEM 代码页，如 1252。因此，字符的 UTF-8 编码被解释为两个单独的字符。

我对 ASP 中良好字符处理的建议是：-

*   将所有页面保存为 UTF-8
*   在所有页面的顶部包含 <%@ codepage=65001
*   在所有页面的顶部包含 <% Response.CharSet = "UTF-8" %>
*   将发布的数据存储在 unicode 字段类型中，例如 SQL Servers NVARCHAR 类型。

这里重要的是，在您读取 ASP 页中的表单值之前，您需要确保将 Response.Codepage 设置为与发送者编码匹配的代码页，并且这不会自动发生。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T18:45:51.727

我猜您使用的编辑器不适用于 UTF-8，并且正在将所有内容转换为 ASCII。

简单的答案是停止在 HTML 页面中使用特殊字符。版权符号应写为`&copy;`或`&#169;`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T18:48:32.000

根据我对这个确切问题的经验，我发现这些字符弹出了很多，因为 1）用户在输入内容（即西班牙语）时使用的是非英语字符集（和键盘），以及 2）内容不是转换为 UTF-8。你在正确的轨道上，检查标题中的内容类型，但如果这种情况继续发生，你真的必须通过转换器运行内容。许多年前，这个问题给我带来了数小时的痛苦，经典 ASP （我希望我仍然可以访问代码以提供进一步的帮助）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T22:24:52.470

® 是 ® 存储为 UTF-8 时的样子，但显示为 ASCII/ISO-8859-1/Windows-1252。使用`meta`标记不足以确保您的页面以 UTF-8 格式提供。您还需要在 Content-Type HTTP 标头中设置编码。此标头通常使用某些服务器范围的设置或以编程方式设置。

我不知道 ASP，但这似乎是你应该如何设置该标题：

[HtmlEncode UTF-8](https://stackoverflow.com/questions/250609/htmlencode-utf-8)

这可能会提供更多信息：

[http://technet.microsoft.com/en-us/library/bb742422.aspx#EBAA](http://technet.microsoft.com/en-us/library/bb742422.aspx#EBAA)

如果您的数据存储在数据库中，您还需要确保数据也以 UTF-8 格式存储，或者在存储和检索数据时进行转换。

# visual-studio - Visual Web Developer 2005 Express 加载非常缓慢

> ID：350433
> 
> 赞同：1
> 
> 时间：2008-12-08T18:43:37.080
> 
> 标签：visual-studio, visual-studio-express, visual-web-developer

我承认我根本不是 Visual Studio 产品的专家。我正在使用 Visual Web Developer 2005 Express Edition，并且正在尝试加载其他人的项目。

这个项目恰好是一个有很多页面的网站。

加载 VWD 后，它要求打开一个项目，然后我选择解决方案文件。然后它继续需要很长时间才能加载。状态栏指示正在加载引用，其中许多似乎位于 System.Web.* 区域中。似乎它在一些不同的包之间来回移动。加载时间为 20 至 30 分钟或更长。其他一些人表示，当他们转到文件 > 打开网站...并从那里选择项目目录时，他们的项目可以正常打开。任何想法可能是什么问题以及如何解决它？

编辑：大约一个小时后，它终于完成了加载。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-08T18:48:15.997

你那台电脑有多少内存？我非常怀疑这个问题是否与实际的参考加载直接相关。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T18:52:02.370

我也需要很长时间才能加载 VWD 项目，跨越五台具有不同 RAM 量的不同机器，一直到 2GB，这对于任何实际用途来说都应该足够了。我已经学会了忍受它。

不过有一个建议，更新到 2008 年。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T17:14:23.953

我最终找到了自己的解决方案。

我缺少其中一项资源（Crystal Reports），因为它不适用于 VWD 的 Express 版本。它没有警告我这一点，而是出于某种原因整天尝试加载引用。

解决方案似乎是删除 web.config 文件并从 SVN 重新创建它。

如果你能解释为什么会发生这种情况，你就能得到一个成功的答案。

# ios - 子控制器更新父表视图中单元格的标签

> ID：350440
> 
> 赞同：3
> 
> 时间：2008-12-08T18:46:00.167
> 
> 标签：ios, objective-c, iphone, cocoa-touch

我有一个导航视图，其中包含一个像出生日期一样简单的单元格。单击该特定行时，一个新的控制器会使用 UIDatePicker 被推入视图。一旦选择了新日期，我想我需要在 viewWillDisappear: 中为该特定单元格的 UITextField 值做一些事情。对我来说最好的方法是什么？我是否需要在 childController 中传入对单元格 indexPath 的引用，将其设置在那里，然后重新加载 tableView 的数据？

另一个棘手的花絮是，假设我的 tableView 数据源是一个带有键/值对的字典。当我在 tableView 上调用 reloadData 时，它会重新读取该字典，而不会注意我的子控制器所做的日期更改。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T19:20:19.130

首先，重新加载数据的最佳位置是在特定的 UIViewController 的 viewWillAppear: 方法中。这样您就不必担心对其他控制器中的表的引用。

其次，如果我没有误解，我认为你需要重新审视对象。只要您在编辑（子）控制器中更改的是对表（父）控制器使用的同一对象的引用，数据就会被同步。另一方面，如果您正在为每个控制器重新加载数据（例如，从文件中），我会看看您的应用架构是如何工作的。对象是你的朋友。充分利用这一点。

# asp.net - 如何在基于 DataKey 的 ASP.NET GridView 中设置选定的行？

> ID：350453
> 
> 赞同：9
> 
> 时间：2008-12-08T18:50:34.477
> 
> 标签：asp.net, gridview

我想要类似于以下伪代码的东西：

```
myGridView.SelectedIndex = myGridView.DataKeys.IndexOf("mySpecificKey"); 
```

我已经进行了一些 Intellisense 探索，但我还没有找到一种明显的方法来做到这一点。如果找不到 DataKey，我想将 SelectedIndex 设置为 -1。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-08T18:59:05.177

我结束了

```
 For n As Integer = 0 To myGridView.DataKeys.Count - 1
            If myGridView.DataKeys(n).Value = myKeyObj Then
                myGridView.SelectedIndex = n
            End If
        Next 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-12-10T16:25:40.790

您是否考虑过 Linq 方法？

用法：

```
GridView1.SelectedIndex = GridView1.DataKeys.IndexOf(id); 
```

代码：

```
public static class WebControlsEx
{
    public static int IndexOf(this DataKeyArray dataKeyArray, object value)
    {
        if (dataKeyArray.Count < 1) throw new InvalidOperationException("DataKeyArray contains no elements.");
        var keys = dataKeyArray.Cast<DataKey>().ToList();
        var key = keys.SingleOrDefault(k => k.Value.Equals(value));
        if (key == null) return -1;
        return keys.IndexOf(key);
    }
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-08-14T05:21:22.000

这很有效，而且很简短：

```
 int MyId = 22;

        foreach (GridViewRow gvRow in gridview1.Rows)
        {
            if ((int)gridview1.DataKeys[gvRow.DataItemIndex].Value == MyId)
            {
                gridview1.SelectedIndex = gvRow.DataItemIndex;
                break;
            }
        } 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-01-07T11:17:41.737

如果启用了分页，您上面的方法仅搜索 GridView 的当前页面。要搜索整个 GridView，您需要查看其 DataSource 并使用它来获取适当的值。

就我而言，我需要为用户提供一种快速搜索特定客户端的方法，因此我添加了一个启用 AJAX 的组合框和 OnSelectedIndexChanged，我使用它来定位适当的 GridView 行并选择它：

```
 Dim i As Integer, DataSetIndex As Integer
        Dim SelectedRowIndex As Integer
        Dim dv As DataView = ObjectDataSourceClients.Select
        Dim dt As DataTable = dv.ToTable

        For i = 0 To dt.Rows.Count - 1
            If dt.Rows(i)("Client_ID") = ComboBoxClientSearch.SelectedValue Then
                DataSetIndex = i
                Exit For
            End If
        Next

        GridViewAllClients.PageIndex = DataSetIndex \ GridViewAllClients.PageSize
        SelectedRowIndex = DataSetIndex - (GridViewAllClients.PageSize * GridViewAllClients.PageIndex)
        GridViewAllClients.SelectedIndex = SelectedRowIndex

        GridViewAllClients.DataBind() 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-04-09T15:44:14.740

好吧，大部分都是错的。菲尔是唯一有效的。答案不起作用。Phil 的答案的问题在于它与 asp.net 中的 SQL DataTable 相关联，没有人使用这些数据表。有些人会这样做，但是当您开始使用被丢弃的设计模式时。

我的示例详细说明了逐行迭代并切换页面索引和重新绑定。我无法搜索实际的 DataSource 属性，因为它绑定到 LinqDataSource 控件，我无法获取实际数据。并且搜索 DataSource 可能无论如何都不起作用，因为您有搜索、排序等来更改数据并获取它的实际行索引不会是网格（或其他控件）的索引。

我使用隐藏的 asp:HiddenControl 来保留该值，因为 jQuery 函数实际上执行回发。grdLocations 是网格视图

```
grdLocations.SelectedIndex = -1;

        bool found = false;
        int index = 0;
        int pageIndex = 0;
        for (int i = 0; i < grdLocations.PageCount; i++)
        {
            for (index = 0; index < grdLocations.DataKeys.Count; index++)
            {
                if (Convert.ToInt32(grdLocations.DataKeys[index].Value.ToString())  == Convert.ToInt32(hidCurrentRigId.Value))
                {
                    found = true;
                    break;
                }
            }

            if (found)
                    break;

            pageIndex++;
            grdLocations.PageIndex = pageIndex;
            grdLocations.DataBind();
        }

        if (found)
        {
            grdLocations.PageIndex = pageIndex;
            grdLocations.SelectedIndex = index;
        } 
```

这将迭代网格视图中的每个页面并选择正确的数据键。

现在添加如果您想要基于行查找页面的最简单方法，请在此示例控制台应用程序中使用此数学。这使它变得非常简单

```
 class Program
{
    static void Main(string[] args)
    {
        int rowIndex = 27;
        int pageCount = 7;
        int currentPage = 3;
        int pageSize = 10;

        Console.WriteLine("Page = " + (rowIndex / pageSize).ToString());
        Console.WriteLine("Row = " + ( rowIndex % pageSize).ToString());
        Console.ReadLine();
    }
} 
```

希望这可以帮助某人。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-10-07T21:43:23.250

```
//grab the current datakeyValue
 int orderID = (int)this.GridView1.SelectedDataKey.Value;

//do something 
gridView.databind();

//set back the selected row int the gridView
 for (int i = 0; i <= this.GridView1.DataKeys.Count - 1; i++)
 {
   if ((int)GridView1.DataKeys[i].Value == orderID)
    {
       this.GridView1.SelectedIndex = i;
   }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-07-14T07:54:49.090

试试这个 Linq 方法：

```
grdMyGrid.SelectedIndex = grdMyGrid.DataKeys.OfType<DataKey>().ToList<DataKey>().FindIndex(dk => (string)dk.Value == "myKey"); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-12-14T13:53:31.487

在您的 GridView_RowDataBound() 事件中添加这样的内容：

```
Dim p As Catalog.Product = CType(e.Row.DataItem, Catalog.Product)
If p IsNot Nothing Then

    If p.Bvin = MySpecificID Then
        e.Row.RowState = DataControlRowState.Selected
    End If

End If 
```

在此示例中，我们将 GridView 绑定到类型为 Catalog.Product 的自定义对象的集合，并且 DataKey 被命名为 Bvin - 您需要根据绑定的内容调整数据类型和键名。

请注意，此事件已每行运行一次，因此无需循环。但是，应注意防止数据访问等事情发生多次。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-12-18T12:05:33.930

基本上，如果您已经拥有 GridViewRow 的实例，那么请执行以下操作：

```
gridView.SelectedIndex = gridViewRowToBeSelected.RowIndex; 
```

# c# - C# 互操作：将新工作表添加到现有文件后，excel 进程未退出

> ID：350454
> 
> 赞同：8
> 
> 时间：2008-12-08T18:50:46.803
> 
> 标签：c#, excel, com, interop, pia

> **可能重复：**
> [如何在 C# 中正确清理 Excel 互操作对象](https://stackoverflow.com/questions/158706/how-to-properly-clean-up-excel-interop-objects-in-c-sharp)

我在这里阅读了许多其他关于在使用 .Net-Excel 互操作时管理 COM 引用的线程，以确保 Excel 进程在退出时正确退出，到目前为止，这些技术一直运行良好，但我最近遇到了一个将新工作表添加到现有工作簿文件时出现问题。

下面的代码留下了一个僵尸 Excel 进程。

如果我将工作表添加到新创建的工作簿文件中，它会正常退出。如果我运行不包括该`.Add()`行的代码，它会很好地退出。（我正在读取的现有文件是一个由注释掉的代码创建的空文件）

有任何想法吗？

```
//using Excel = Microsoft.Office.Interop.Excel;
//using System.Runtime.InteropServices;
public static void AddTest()
{
  string filename = @"C:\addtest.xls";
  object m = Type.Missing;
  Excel.Application excelapp = new Excel.Application();
  if (excelapp == null) throw new Exception("Can't start Excel");
  Excel.Workbooks wbs = excelapp.Workbooks;

  //if I create a new file and then add a worksheet,
  //it will exit normally (i.e. if you uncomment the next two lines
  //and comment out the .Open() line below):
  //Excel.Workbook wb = wbs.Add(Excel.XlWBATemplate.xlWBATWorksheet);
  //wb.SaveAs(filename, m, m, m, m, m, 
  //          Excel.XlSaveAsAccessMode.xlExclusive,
  //          m, m, m, m, m);

  //but if I open an existing file and add a worksheet,
  //it won't exit (leaves zombie excel processes)
  Excel.Workbook wb = wbs.Open(filename,
                               m, m, m, m, m, m,
                               Excel.XlPlatform.xlWindows,
                               m, m, m, m, m, m, m);

  Excel.Sheets sheets = wb.Worksheets;

  //This is the offending line:
  Excel.Worksheet wsnew = sheets.Add(m, m, m, m) as Excel.Worksheet; 

  //N.B. it doesn't help if I try specifying the parameters in Add() above

  wb.Save();
  wb.Close(m, m, m);

  //overkill to do GC so many times, but shows that doesn't fix it
  GC();
  //cleanup COM references
  //changing these all to FinalReleaseComObject doesn't help either
  while (Marshal.ReleaseComObject(wsnew) > 0) { } 
  wsnew = null;
  while (Marshal.ReleaseComObject(sheets) > 0) { }
  sheets = null;
  while (Marshal.ReleaseComObject(wb) > 0) { }
  wb = null;
  while (Marshal.ReleaseComObject(wbs) > 0) { }
  wbs = null;
  GC();
  excelapp.Quit();
  while (Marshal.ReleaseComObject(excelapp) > 0) { }
  excelapp = null;
  GC();
}

public static void GC()
{
  System.GC.Collect();
  System.GC.WaitForPendingFinalizers();
  System.GC.Collect();
  System.GC.WaitForPendingFinalizers();
} 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-10T15:56:51.410

我做过类似的事情。我创建一个 Excel 文件或打开一个现有的。我删除所有工作表并添加我自己的工作表。这是我用来确保关闭所有引用的代码：

```
 workbook.Close(true, null, null);
            excelApp.Quit();

            if (newSheet != null)
            {
                System.Runtime.InteropServices.Marshal.ReleaseComObject(newSheet);
            }
            if (rangeSelection != null)
            {
            System.Runtime.InteropServices.Marshal.ReleaseComObject(rangeSelection);
            }
            if (sheets != null)
            {
                System.Runtime.InteropServices.Marshal.ReleaseComObject(sheets);
            }
            if (workbook != null)
            {
                System.Runtime.InteropServices.Marshal.ReleaseComObject(workbook);
            }
            if (excelApp != null)
            {
                System.Runtime.InteropServices.Marshal.ReleaseComObject(excelApp);
            }

            newSheet = null;
            rangeSelection = null;
            sheets = null;
            workbook = null;
            excelApp = null;

            GC.Collect(); 
```

我已经用许多不同的选项对此进行了测试，但我还没有失败。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-08T19:14:31.480

我手头没有代码，但我确实遇到了类似的问题。如果我没记错的话，我最终检索了 excel 实例的进程 ID，并将其杀死（在适当的等待期之后，并且当其他方法失败时）。

我想我用过：

`GetWindowThreadProcessId`（通过P/Invoke）在excel对象的hwnd属性上获取进程id，然后用来`Process.GetProcessById`获取进程对象。一旦我这样做了，我就会调用`Kill`这个过程。

编辑：我不得不承认，这不是理想的解决方案，但是如果您找不到未发布的流氓界面，那么这将以真正的蛋壳/大锤方式修复它。;)

EDIT2：您不必`Kill`立即调用进程对象......您可以先尝试调用`Close`，然后再使用`Kill`.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-02-16T15:27:50.273

这是我杀死您使用 Office12 .Net 互操作库创建的 Excel 的完整代码：享受，-Alan。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Runtime.InteropServices;
using System.Diagnostics;
using Microsoft.Office.Interop.Excel;

class Program
{

    /// <summary> 
    /// Win32 API import for getting the process Id. 
    /// The out param is the param we are after. I have no idea what the return value is. 
    /// </summary> 
    [DllImport("user32.dll")]
    private static extern IntPtr GetWindowThreadProcessId(IntPtr hWnd, out IntPtr ProcessId); 

    static void Main(string[] args)
    {
        var app = new Application();
        IntPtr hwnd = new IntPtr(app.Hwnd);
        IntPtr processId;
        IntPtr foo = GetWindowThreadProcessId(hwnd, out processId);
        Process proc = Process.GetProcessById(processId.ToInt32());
        proc.Kill(); // set breakpoint here and watch the Windows Task Manager kill this exact EXCEL.EXE
        app.Quit(); // should give you a "Sorry, I can't find this Excel session since you killed it" Exception.
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-08-09T21:02:49.927

这对我来说非常好，没有任何例外。

```
Public Class ExcelHlpr

    Declare Function EndTask Lib "user32.dll" (ByVal hWnd As IntPtr, ByVal ShutDown As Boolean, ByVal Force As Boolean) As Integer

    Dim cXlApp As Microsoft.Office.Interop.Excel.Application

    Public Function GetExcel() As Microsoft.Office.Interop.Excel.Application
        cXlApp = New Microsoft.Office.Interop.Excel.Application
        Return cXlApp
    End Function

    Public Function EndExcel() As Integer
        Dim xlHwnd As New IntPtr(cXlApp.Hwnd)
        Return EndTask(xlHwnd, False, True)
    End Function

End Class 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T20:22:00.440

我知道不是很有建设性，但我完全按照上面所示测试了代码，我的 Excel 进程按预期退出，我的 C:\addtest.xls 有 8 张新工作表，没有运行 Excel 进程。
互操作版本可能是我想知道的原因吗？我用 11 和 12 进行了测试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T15:04:04.383

我正在使用 VB.NET 3.5 SP1，以下代码仍然打开 EXCEL.EXE：

```
 xlWorkbook.Close(SaveChanges:=False)
        xlApplication.Quit()

        System.Runtime.InteropServices.Marshal.ReleaseComObject(xlRange)
        System.Runtime.InteropServices.Marshal.ReleaseComObject(xlWorksheet)
        System.Runtime.InteropServices.Marshal.ReleaseComObject(xlSheets)
        System.Runtime.InteropServices.Marshal.ReleaseComObject(xlWorkbook)
        System.Runtime.InteropServices.Marshal.ReleaseComObject(xlApplication)

        xlRange = Nothing
        xlWorksheet = Nothing
        xlSheets = Nothing
        xlWorkbook = Nothing
        xlApplication = Nothing

        GC.GetTotalMemory(False)
        GC.Collect()
        GC.WaitForPendingFinalizers()

        GC.Collect()
        GC.WaitForPendingFinalizers()
        GC.Collect()
        GC.GetTotalMemory(True) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T14:44:49.727

安德鲁，这是我发现有效的代码。我想我把它贴在这里给其他遇到的人：

```
namespace WindowHandler
{
using System;
using System.Text;
using System.Collections;
using System.Runtime.InteropServices;

/// <summary>
/// Window class for handling window stuff.
/// This is really a hack and taken from Code Project and mutilated to this small thing.
/// </summary>
public class Window
{
    /// <summary>
    /// Win32 API import for getting the process Id.
    /// The out param is the param we are after. I have no idea what the return value is.
    /// </summary>
    [DllImport("user32.dll")]
    private static extern IntPtr GetWindowThreadProcessId(IntPtr hWnd, out IntPtr ProcessId);

    /// <summary>
    /// Gets a Window's process Id.
    /// </summary>
    /// <param name="hWnd">Handle Id.</param>
    /// <returns>ID of the process.</returns>
    public static IntPtr GetWindowThreadProcessId(IntPtr hWnd)
    {
        IntPtr processId;
        IntPtr returnResult = GetWindowThreadProcessId(hWnd, out processId);

        return processId;
    }
}
} 
```

# .net - 寻找一种更好的方法来改变父窗体的大小

> ID：350463
> 
> 赞同：2
> 
> 时间：2008-12-08T18:53:40.120
> 
> 标签：.net, winforms, c#-2.0

我有一个简单的应用程序，它显示拖到它上面的图片。我希望应用程序根据它显示的图片调整自身大小。下面的代码就是这样做的：

```
// Load the picture
Bitmap picture = new Bitmap(s);

// Calculate the size of the main form
this.Size = new Size(picture.Width + 
                       (this.pictureBox.Padding.All + 
                        this.pictureBox.Margin.All + 
                        this.tableLayoutPanel.Padding.All + 
                        this.tableLayoutPanel.Margin.All) * 2, 
                     picture.Height + 
                       (int)this.tableLayoutPanel.RowStyles[1].Height + 
                       (this.pictureBox.Padding.All + 
                        this.pictureBox.Margin.All + 
                        this.tableLayoutPanel.Padding.All + 
                        this.tableLayoutPanel.Margin.All) * 2);
 // Display the file.
 this.pictureBox.Image = picture; 
```

它认为我需要一些帮助来改进这一点是相当明显的。随着表格变得越来越复杂，适当尺寸的计算也将变得越来越复杂。建议？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T20:10:14.333

您可以查看 Forms 属性：

*   Form.AutoSize
*   Form.AutoSizeMode

这些，再加上设置 PictureBox 的 AutoSizeMode 应该会给你你正在寻找的效果（无需编写任何代码）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-08T19:18:30.147

您可以计算旧图片和新图片之间的大小差异，然后将表单的大小调整该数量......只要表单上的所有其他内容保持相同大小即可。

# sql-server-2005 - SQL 存储过程排序规则上下文

> ID：350469
> 
> 赞同：2
> 
> 时间：2008-12-08T18:55:28.133
> 
> 标签：sql-server-2005, collation

嘿，我遇到了一个似乎与整理有关的问题，但我不确定。

我正在针对我的生产数据库的备份进行开发。SQL Server 2005 环境中的唯一区别（我现在知道）是我的本地主机具有“SQL_Latin1_General_CP1_CS_AS”（区分大小写）作为排序规则，而生产环境具有“SQL_Latin1_General_CP1_CI_AS”（不区分大小写）。

当我在本地执行存储过程时，它会抛出“必须声明标量变量“@firstName””错误。

*已*声明变量“@FirstName” 。

现在，数据库本身是“SQL_Latin1_General_CP1_CI_AS”作为排序规则，那么为什么存储过程不在不区分大小写的上下文中运行呢？

我已经在网上查看了这个，他们基本上说我必须重建我的 SQLserver。

数据库上下文不应该胜过服务器上下文进行排序吗？

顺便说一句，master 和 tempdb 都是“SQL_Latin1_General_CP1_CS_AS”区分大小写的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T19:54:09.263

这是一个糟糕的情况。当您尝试执行任何涉及 varchars 的操作时，您无法控制排序规则的任何事情（例如 SELECT INTO 临时表）都会中断**。**服务器默认排序规则将胜过您未明确强制排序规则的任何内容，这将是您现有存储过程代码的大部分（如果不是全部）。

此问题的正常解决方案是*使用正确的排序规则重新安装 SQL Server 实例*。是的，你***确实***需要这样做。我对此的了解是二手的，但我了解（从获得 MS 技术支持参与此问题的人那里）在技术上可以更改 SQL Server 实例上的默认排序规则，但该过程是技术性的并且容易出错，并且一个错误可能会使服务器处于无法使用的状态。显然，此过程不受 Microsoft 官方支持，建议的过程是重新安装 SQL Server 实例。

# ruby-on-rails - 您推荐哪些工具来分析 Rails 应用程序？

> ID：350470
> 
> 赞同：45
> 
> 时间：2008-12-08T18:56:17.663
> 
> 标签：ruby-on-rails, ruby, profiling

我一直在寻找 Rails 的分析工具。我目前正在玩和测试 ruby​​-prof 和 railsbench，但我对要使其正常工作所需的调整和修改量感到有点沮丧。

虽然我不介意（太多）调整，但我想知道是否有其他更直接且易于使用的工具来分析 Rails 应用程序？您推荐哪些工具？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-12-10T13:50:26.033

您也可以使用[内置的分析器](http://wiki.rubyonrails.org/rails/pages/ProfilerScript)：

```
$ ruby script/performance/profiler 'User.new' 5
  %   cumulative   self              self     total
 time   seconds   seconds    calls  ms/call  ms/call  name
189.25     1.76      1.76        1  1760.00  1760.00  Profiler__.start_profile
 43.01     2.16      0.40      115     3.48     3.91  ActiveRecord::ConnectionAdapters::Column#simplified_type
  8.60     2.24      0.08       15     5.33     8.67  Array#each
  7.53     2.31      0.07      115     0.61     5.39  ActiveRecord::ConnectionAdapters::Column#initialize
  6.45     2.37      0.06      115     0.52     0.52  ActiveRecord::ConnectionAdapters::Column#type_cast
  5.38     2.42      0.05      690     0.07     0.07  Regexp#===
  0.00     2.69      0.00       10     0.00     0.00  Process.times
  0.00     2.69      0.00       10     0.00     0.00  Benchmark.times 
```

请注意，对于 Rails 3，您可以使用`rails profiler`.

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-12-08T20:39:43.040

[New Relic](http://www.newrelic.com/ruby)提供 Rails 配置文件，包括[免费的“Lite”](http://www.newrelic.com/ruby)版本。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-12-23T13:08:22.627

机架错误非常酷[http://github.com/brynary/rack-bug](http://github.com/brynary/rack-bug)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-08T19:19:57.163

[http://rails-analyzer.rubyforge.org/](http://rails-analyzer.rubyforge.org/)可能是您正在寻找的。

我强烈推荐生产日志分析器以获得最耗时操作的清晰列表以及操作分析器。

补充：对于生产日志分析器，您不需要任何配置，它只解析生产日志并为您提供最耗时的操作列表，包括最小/最大/中值时间。很高兴看到您应该在哪里进行更多分析/优化。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-11-04T22:35:28.137

另一个值得一试的是 Mini Profiler：[https ://github.com/SamSaffron/MiniProfiler/tree/master/Ruby](https://github.com/SamSaffron/MiniProfiler/tree/master/Ruby)

它在 StackExchange 上使用（尽管此版本已移植到 Ruby）。

这是一个 Railscast：[http: //railscasts.com/episodes/368-miniprofiler?view=asciicast](http://railscasts.com/episodes/368-miniprofiler?view=asciicast)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-09T05:05:53.567

如果你在 OSX Leopard 下，你可以试试 DTrace。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-09T05:00:00.677

您还应该看看 FiveRuns 的[TuneUp](http://www.fiveruns.com/products/tuneup)。它是完全免费的，可以作为插件安装到您的 Rails 应用程序中。请记住，它确实会将数据发送回他们的服务器（大多数是非常无害的信息），但这可能会打扰某些人（即政府机构会对此非常不满）。我想你会惊讶于这个工具考虑到它是免费的。

它的另一个不错的功能是您可以发布您的运行数据以供其他人评论并帮助您诊断长查询或错误代码。

# asp.net - SQL Server 模板驱动的数据输入问题

> ID：350482
> 
> 赞同：0
> 
> 时间：2008-12-08T18:59:54.083
> 
> 标签：asp.net, sql, sql-server

基于[这个关于动态访问表](https://stackoverflow.com/questions/350081/how-do-i-supply-the-from-clause-of-a-select-statement-from-a-udf-parameter)的问题的答案，我决定退后几步，从更大的角度获得一些建议。

我正在重新审视我正在使用 ASP.NET 为 Web 重写的 Windows 窗体应用程序的数据库设计。此外，我已将我们的数据库移植到 Sql Server，因此它可以处理更多流量，因为 Access 数据库已经负担过重。因此，由于看到 SQL Server 可以做什么，我一直在重新审视我的数据库设计决策，以及它们对我的用户界面设计的影响。

目前windows界面显示最近的代码列表：

```
02691 AFF1
32391 Lot# 23 
```

等等。

对于每个代码，在 Productions 表中都有一条记录，其开头为：

```
ProductionCode varchar(80),
Template       varchar(50),
... 
```

模板代表多个表之一，也是模板字段定义的外键。所有这些信息都用于从代码开始动态构建 DataGrid。

有一个 ScoreField 表，它代表所有模板中的所有字段，除了 ProductionCode（在所有模板中作为外键）。

```
ScoreField

Template       varchar(50)
Field          varchar(50)
Formatting     varchar(50)  // This is a .NET style formatting string, say 0.00 or ##
... 
```

然后是模板表本身，它包含一个生产代码、每个测试的时间以及测试收集的任何数据。

所以为了创建我的数据网格，我从

```
SELECT * FROM ProductionRun WHERE ProductionCode = @Code 
```

实际上，我只得到一个结果，或者如果没有得到结果，则中止该过程。

其中代码是用户选择的代码字符串（使用下拉菜单，而不是容易注入的东西）

然后我做：

```
SELECT * FROM ScoreField WHERE Template = @Template 
```

@Template 实际上是返回 ProductionRun 的一条记录的 Template 字段值。

然后我做：

```
SELECT * FROM @Template WHERE ProductionCode = @Code 
```

但实际上，我只是将第一部分中获得的模板名称连接起来。

然后我使用 ScoreField 的结果为每个匹配结果添加列并设置格式等。

但当然，由于这一切都是在运行时完成的，我无法使用数据绑定，而必须以编程方式填写我的所有数据。

因此，通过重新访问此数据库，我正在寻找另一种更好的方法。我在不同的表中有数据，我想对数据应用格式，并且能够在一个界面中完成所有操作，而不是强迫用户猜测他们的数据在哪个模板中。我希望能够添加模板而不会过多地破坏系统。

显然，这不是一个简单的编程问题，而是一个最佳实践问题，但我一直在寻找一些灵感和/或示例来让我走上一条不同的道路。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T20:55:19.717

鉴于您在上面的评论，我可能会将其建模如下。

```
CREATE TABLE dbo.Products (
    product_code    VARCHAR(10) NOT NULL,
    product_name    VARCHAR(50) NOT NULL,
    CONSTRAINT PK_Products PRIMARY KEY CLUSTERED (product_code)
    )
GO
CREATE TABLE dbo.Measurement_Types (
    measurement_type_code           VARCHAR(10)     NOT NULL,
    measurement_type_description    VARCHAR(255)    NOT NULL,
    format                          VARCHAR(20)     NOT NULL,
    CONSTRAINT PK_Measurement_Types PRIMARY KEY CLUSTERED (measurement_type_code)
    )
GO
CREATE TABLE dbo.Measurements (
    product_code            VARCHAR(10)     NOT NULL,
    measurement_type_code   VARCHAR(10)     NOT NULL,
    measurement_value       DECIMAL(10, 4)  NOT NULL,
    CONSTRAINT PK_Measurements PRIMARY KEY CLUSTERED (product_code, measurement_type_code),
    CONSTRAINT FK_Measurements_Products FOREIGN KEY (product_code) REFERENCES dbo.Products (product_code),
    CONSTRAINT FK_Measurements_Measurement_Types FOREIGN KEY (measurement_type_code) REFERENCES dbo.Measurement_Types (measurement_type_code)
    )
GO 
```

如果测量是历史的，则添加 DATETIME 列。此外，不知道数据类型的细节显然可能会改变。

由于每种产品类型可以有不同数量的测量值，因此您最终可能会使用该格式动态构建数据网格，并根据需要添加列。我知道您说过您想避免这种情况，但是制作通用应用程序是要付出代价的（我知道您的应用程序并不完全通用，但是您尝试制作的应用程序越开放或“自由形式” ，越难优化，需要做出的妥协就越多）。

一种可能性是创建一个包含您想要支持的最大列数的数据网格，然后有一个存储过程或视图返回该列数，而不管实际测量是否可用于产品类型。然后，您仍然可以绑定到该 SP 或视图，并简单地隐藏在运行时未使用的列。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T19:11:15.620

用户试图实际看到的数据是什么。最好的办法是从设计数据库开始，它基于它所拥有的数据，而不是基于你最终如何将它显示到某个前端。

如果您以不同的格式获取不同的数据，那么尝试将所有数据强制转换为单一类型的结果可能是个坏主意，以便您可以使用数据绑定。

# performance - 作为开发人员，您在 vanilla OS X 系统上进行了哪些更改或安装？

> ID：350492
> 
> 赞同：10
> 
> 时间：2008-12-08T19:01:29.637
> 
> 标签：performance, macos, system-administration

例如，这些是我在启动新机器时经常做的一些事情：

1.  安装“Visor” - 通过 F1 为您提供始终可用的 HUD 样式终端窗口。
2.  安装“Clix”——运行一百万条系统定制命令行指令。
3.  安装“默认应用程序” - 不言自明。
4.  将“Terminal.app”设置为在登录时自动打开和隐藏。
5.  安装“Inconsolata”字体并将其设置为终端和文本编辑的默认字体。

只有在采取了这些基本步骤之后，我才能开始处理更私人的事情。

**那么，面对空白的 macSlate 时，您需要采取哪些基本步骤？**

*注意：是的，这个问题的灵感来自[@Roddy](https://stackoverflow.com/questions/344468/as-a-developer-what-changes-do-you-make-to-a-vanilla-windows-install)针对 Windows 平台的问题。*

**更新：**太好了，谢谢！到目前为止，一些非常有趣的答案。

***具体结果：***我现在是 MacPorts 转换者，我的终端使用标准的左字、右字、键盘命令行为……

**更新2：**我忘了提到[Charles](http://www.charlesproxy.com/)，世界上最伟大的调试http代理应用程序（恕我直言）。它是共享软件，100% 名副其实。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T19:07:18.920

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T02:41:10.033

以下是我使用的一些到目前为止尚未提及的：

**系统配置**

*   打开[全键盘访问](http://support.apple.com/kb/HT2840 "全键盘访问")。
*   关闭[自动登录](http://docs.info.apple.com/article.html?artnum=61295)。
*   给我的电脑起一个[很酷的名字](http://namingschemes.com/Main_Page)。

**有用的默认值**

*   在 Finder 的标题栏中 [显示完整路径](http://www.macosxhints.com/article.php?story=20071101210524604)
    *   `defaults write com.apple.finder _FXShowPosixPathInTitle -bool YES`
*   [显示 Safari 开发者菜单](http://www.macosxhints.com/article.php?story=20030110063041629)
    *   `defaults write com.apple.Safari IncludeDebugMenu`1

**其他软件**

*   [硬件咆哮者](http://growl.info/documentation/hardwaregrowler.php)（免费）
    *   使用边框样式设置无停靠图标（有关说明，请参见上面的链接）。我喜欢这个小工具。
*   [抗 RSI](http://tech.inhelsinki.nl/antirsi/)（免费）
    *   拯救你自己。
*   [OpenTerminalHere](http://jo.irisson.free.fr/?p=59)（免费）
    *   很棒的迷你应用程序，可在当前 Finder 窗口的目录中打开终端。
*   [MacVim](http://code.google.com/p/macvim/)（免费）
    *   我最喜欢的通用编辑器。
*   [xScope](http://iconfactory.com/software/xscope)（商业）
    *   任何类型的 UI 工作的好工具。

**Xcode 配置**

*   将构建产品放入`~/Build`
    *   将所有内容保存在一个易于清洁的地方，并使项目间的依赖关系正常工作。
    *   可以选择放入中间构建文件`~/Build/_Intermediate`以使其更整洁。
*   如果还没有，请选中“自动插入结束“}”
*   设置组织名称
    *   `defaults write com.apple.Xcode PBXCustomTemplateMacroDefinitions '{ORGANIZATIONNAME = "Yoyodyne Industries";}'`
*   代码完成（我认为这些是早期版本中的默认值）
    *   选中“在弹出列表中显示争论”。
    *   选中“为完成插入参数占位符”。
    *   选择“自动建议：延迟 0.50 秒”

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-08T19:04:24.560

安装 Xcode、iPhone SDK、TextMate。

将终端、XCode、TextMate 添加到扩展坞。

从扩展坞中删除 iMovie、iDVD、... 图标。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-08T20:56:13.833

在 Terminal.app 中左右添加单词：

[http://blog.macromates.com/2006/word-movement-in-terminal/](http://blog.macromates.com/2006/word-movement-in-terminal/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T02:40:44.217

对我来说，第一件事是设置区分大小写的文件系统。没有它，我绝不会运行 UNIX 衍生产品。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T19:12:33.590

我安装了 PostgreSQL 和 Eclipse，在我之前使用 Mac 的工作中我也是这样做的。

然后我从 Dock 中删除了所有不必要的图标，并将我的工作图标和终端放在那里。

我还安装了 Pages，它是一个很好的文档编辑器，供文档使用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-08T19:19:58.210

我安装了 X11 和 Xcode 工具，然后获取 MacPorts 并使用它来获取 doxygen、windowmaker 和可能的其他一些工具。我下载了 OmniGraffle，并从 GraffleTopia 获得 UML 模板。OmniOutliner 也是一项要求；最后我得到了 WarBlade 来找点乐子 ;-)

哦，这些天我也从 clang 网站上获取了 scan-build，虽然我没有足够一致地使用它，还记得我第一次回答的时候。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-08T20:52:48.117

我最近才这样做。我安装了：

*   亚丁
*   火狐
*   开发者工具
*   水银
*   SubEtha编辑

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-08T21:14:01.567

我的必备应用程序：

1.  [Quicksilver](http://www.blacktree.com/) - 我离不开的应用程序启动器
2.  [BBEdit](http://www.barebones.com/products/bbedit/)和[TextMate](http://macromates.com/) - 两者都是程序员的优秀文本编辑器
3.  [Perian](http://www.perian.org/) - 为 Quicktime 添加了对更多视频格式的支持
4.  [Flip4Mac WMV](http://www.microsoft.com/windows/windowsmedia/player/wmcomponents.mspx) - 为 Quicktime 添加对 Windows 媒体格式的支持
5.  [Skim](http://skim-app.sourceforge.net/) - 优秀的 PDF 阅读器
6.  [Yummy FTP](http://www.yummysoftware.com/) - 可能是 Mac 上最好的 FTP 客户端
7.  [Google Notifier](http://toolbar.google.com/gmail-helper/notifier_mac.html) - 菜单栏中的自动电子邮件提醒
8.  [Letterbox](http://harnly.net/software/letterbox/) - 宽屏 Mail.app 插件
9.  [info.xhead](http://www.xheadsoftware.com/info_xhead.asp) - 安全的个人数据库软件
10.  [Little Snitch](http://www.obdev.at/products/littlesnitch/index.html) - 监控传入和传出网络连接
11.  [VMWare Fusion](http://www.vmware.com/products/fusion/) - Windows 虚拟化

Xcode 和 Eclipse 很简单。

# .net-3.5 - DataContractSerializer：处理您不知道且无权访问其类型的对象

> ID：350499
> 
> 赞同：5
> 
> 时间：2008-12-08T19:03:21.097
> 
> 标签：.net-3.5, serialization, datacontractserializer

我有一个类（称为容器），它使用 DataContractSerializer 进行序列化和反序列化。该类包含其他类的集合，所有这些类都继承相同的基类（称为 ContentsBase），但具有不同的派生类。应用程序可能会传递一个序列化的 Container 对象，该对象包含 ContentsBase 派生对象**，我不知道或无法访问其实现**——也就是说，编译的代码在本地**不可用。**我需要通过“忽略”我不知道的类型来反序列化这个对象（我不需要往返它们）。

有什么办法可以做到这一点，除了采用序列化的 XML 并编写一些自定义代码来通过它并在反序列化之前删除未知元素，还是我唯一的选择？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-11-25T23:00:41.370

序列化代理和序列化绑定器

# c# - 如何尝试将字符串转换为 Guid

> ID：350500
> 
> 赞同：197
> 
> 时间：2008-12-08T19:03:27.667
> 
> 标签：c#

我没有找到 Guid 的 TryParse 方法。我想知道其他人如何处理将字符串格式的 guid 转换为 guid 类型。

```
Guid Id;
try
{
    Id = new Guid(Request.QueryString["id"]);
}
catch
{
    Id = Guid.Empty;
} 
```

* * *

## 回答 #1

> 赞同：340
> 
> 时间：2008-12-08T19:04:29.067

```
new Guid(string) 
```

您还可以查看使用`TypeConverter`.

* * *

## 回答 #2

> 赞同：130
> 
> 时间：2013-01-16T12:35:37.847

使用这样的代码：

```
new Guid("9D2B0228-4D0D-4C23-8B49-01A698857709") 
```

而不是“9D2B0228-4D0D-4C23-8B49-01A698857709”你可以设置你的字符串值

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2012-04-17T14:25:48.063

```
Guid.TryParse() 
```

[https://docs.microsoft.com/en-us/dotnet/api/system.guid.tryparse](https://docs.microsoft.com/en-us/dotnet/api/system.guid.tryparse)

或者

```
Guid.TryParseExact() 
```

[https://docs.microsoft.com/en-us/dotnet/api/system.guid.tryparseexact](https://docs.microsoft.com/en-us/dotnet/api/system.guid.tryparseexact)

在 .NET 4.0（或 3.5？）

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-10T18:31:23.347

这会让你非常接近，我在生产中使用它并且从未发生过碰撞。但是，如果您查看反射器中 guid 的构造函数，您将看到它所做的所有检查。

```
 public static bool GuidTryParse(string s, out Guid result)
    {
        if (!String.IsNullOrEmpty(s) && guidRegEx.IsMatch(s))
        {
            result = new Guid(s);
            return true;
        }

        result = default(Guid);
        return false;
    }

    static Regex guidRegEx = new Regex("^[A-Fa-f0-9]{32}$|" +
                          "^({|\\()?[A-Fa-f0-9]{8}-([A-Fa-f0-9]{4}-){3}[A-Fa-f0-9]{12}(}|\\))?$|" +
                          "^({)?[0xA-Fa-f0-9]{3,10}(, {0,1}[0xA-Fa-f0-9]{3,6}){2}, {0,1}({)([0xA-Fa-f0-9]{3,4}, {0,1}){7}[0xA-Fa-f0-9]{3,4}(}})$", RegexOptions.Compiled); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-08T19:07:10.123

不幸的是，没有 TryParse() 等价物。如果您创建一个 System.Guid 的新实例并传入字符串值，您可以捕获它在无效时抛出的三个可能的异常。

那些是：

*   参数NullException
*   格式异常
*   溢出异常

我已经看到了一些实现，如果您只是尝试验证它而不是创建它，您可以在创建实例之前对字符串执行正则表达式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-07-02T19:18:20.223

如果你想要的只是一些非常基本的错误检查，你可以只检查字符串的长度。

```
 string guidStr = "";
              if( guidStr.Length == Guid.Empty.ToString().Length )
                 Guid g = new Guid( guidStr ); 
```

# c# - 初始化对象中的集合？

> ID：350502
> 
> 赞同：9
> 
> 时间：2008-12-08T19:04:10.770
> 
> 标签：c#, .net, oop

如果一个对象具有一个集合属性，该对象应该创建集合对象还是让消费者检查 null？我知道消费者不应该假设，只是想知道如果从未添加过集合对象，大多数人是否会创建集合对象。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-08T19:34:21.753

您还可以使用“惰性初始化器”模式，其中集合不会被初始化，直到（并且除非）有人访问它的属性获取器......这避免了在父对象为其他对象实例化的情况下创建它的开销不需要收集的目的...

```
 public class Division
    {
        private int divId;
        public int DivisionId { get; set; }

        private Collection<Employee> emps;
        public Collection<Employee> Employees
        { get {return emps?? (emps = new Collection<Employee>(DivisionId));}} 
    } 
```

编辑：通常，这种实现模式不是线程安全的……在第一个线程完成修改之前，两个不同的线程可以将 emps 读取为 null 。在这种情况下，这可能并不重要，因为 DivisionId 是不可变的，尽管两个线程都会获得不同的集合，但它们都是有效的。因此，当第二个线程结束时，emps 将是一个有效的集合。“可能”是因为第一个线程可能在第二个线程重置它之前开始使用 emps。那将不是线程安全的。Jon Skeet 的另一个稍微复杂一点的实现是线程安全的（参见[这篇关于 SIngletons](http://www.yoda.arachsys.com/csharp/singleton.html)的文章，了解他关于如何解决这个问题的示例/讨论。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-08T19:08:56.767

这取决于您的 API 和用户之间的合同。

就个人而言，我喜欢让 Object 管理其集合的合同，即在创建时实例化它们，并确保它们不能通过 setter 设置为 null - 可能通过提供管理集合的方法而不是设置集合本身.

即 addFoo(Foo toAdd) 而不是 setFooSet(Set set) 等等。

但这取决于你。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-08T19:09:07.107

我通常会创建集合，然后提供从内部集合添加/删除项目的方法，而不是让类的使用者担心检查是否为空。这也使您能够更好地控制集合发生的情况。最终，这取决于它的用途，但如果您的类有一个集合，那么很可能不仅仅是为了让类的使用者可以拥有这些对象的集合。否则，他们为什么要使用你的课程？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-08T19:09:36.203

虽然我在这里所说的无论如何都不是通用的，但我认为集合最适合作为私有属性，应该由对象本身的公共方法访问。因此，对象负责根据需要创建和销毁它们。这样，就无法从外部代码将其设置为 null。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-08T19:28:24.697

我更喜欢在实例化时创建集合，在包含对象中提供添加/删除方法，如果需要，提供添加和删除整个外部集合的 addAll/removeAll 方法。我从不允许调用者访问集合对象以获取或设置 - 但是，我可以提供一个返回集合的副本（可能是不可变的）的 getter。

我也有提供不可变包装视图的写时复制实现，因为任何突变都会创建一个新的底层集合。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-08T19:08:14.160

我创建了一个空集合。当然，它有一点内存成本，但还不够大，无需担心。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-08T19:08:50.790

IMO，这就是 IEnumerable 很好的地方。

就个人而言，我喜欢将我的“集合”属性初始化为空列表。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-08T19:10:29.633

如果集合是对象的固有部分，那么对象通常应该创建它（并且不允许用户将其设置为不同的集合实例）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-08T19:10:47.447

我已经尝试了两种方法，当我发现我已经实例化它时，我通常会很高兴。或者，您可以在一组可以为您处理检查的方法后面隐藏消费者的实现。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-08T19:37:21.777

作为一般规则，我认为对象应该创建集合并提供操作它的方法；添加/获取/删除。遵循此规则时，您不应提供直接设置集合的方法。如果为了方便需要setSomeCollection(Collection someCollection) 之类的方法，该方法的实现不应该在对象内设置引用，而是将方法参数集合中的值复制到对象内的集合中；

```
public void setSomeCollection(Collection someCollection) {
   this.someCollection.clear();
   this.someCollection.addAll(someCollection);
} 
```

您应该这样做，这样您的 API 的客户端就无法访问您的类维护的集合。如果他们这样做，他们可以在不使用您的类的对象的情况下对其进行操作，并违反您的类保证的约束。

如果提供 getter 也是如此；您应该返回您的内部收藏的副本，或者它的只读版本。Apache commons-collections 和 google-collections 提供了在集合周围创建不可变包装器的方法，以及 java.util 包中 Java 附带的包装器；java.util.Collections.unmodifiable*。

# c# - 什么是在 ASP.NET 中处理会话/“flash”样式消息的好设置

> ID：350505
> 
> 赞同：1
> 
> 时间：2008-12-08T19:04:39.550
> 
> 标签：c#, asp.net, user-interface

我正在构建 ASP.NET 2.0 网站，目前我正在为 DAL、一些业务对象和其他各种共享内容构建一些本地程序集。我已经组合了一组基本的对象来处理 UI 的消息（即错误和其他状态消息）。它包括：

*   **StatusMessage**有一个 text 属性和一个 color 属性来描述要显示的消息。它还有一个静态的 Send 方法，该方法创建自己的实例并将其放入 Session 变量中。

*   **StatusMessageDisplay**基本上是一个 Label 对象，重写了 Refresh 方法以从会话中获取 StatusMessage，清除 Session 变量并显示消息。

总的来说，这工作得相当好。但是，有几件事我不喜欢它：

1.  它一次只能处理一条消息，如果在显示之前发送了两条消息，则第一条将丢失。我可以列出要显示的消息，但我不确定是否要开始在 Session 对象中构建列表。

2.  它与 Session 相关联，因此与 HttpContext 相关联。我尽量不要在 Session 对象中投入太多，而且 HttpContext 很难用于测试。目前我正在将 HttpContext 包装在另一个我可以模拟以进行测试的对象中。

3.  在我当前的实现中，如果从 AJAX 请求传递消息，则消息显示延迟（下一个同步请求），因为 StatusMessageDisplay 控件不是 AJAX 感知/触发的。

在我开始着手解决这些问题之前，我想了解一下其他人发现什么对解决这些问题有用。我真正想要的是像 Rails 中的 flash 对象一样的东西，或者可能是更好的选择？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T19:12:20.660

使用`List<StatusMessage>`会话中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T19:31:23.133

要在任何呼叫上刷新消息，请将其放在自己的位置`UpdatePanel`，并将其`RenderMode`设置为`Always`.

# c++ - 在 windows 下使用 start 启动应用程序

> ID：350507
> 
> 赞同：1
> 
> 时间：2008-12-08T19:05:53.603
> 
> 标签：c++, windows, mfc

我注意到我可以通过编写**start filename**来启动一个带有关联处理程序的程序。但是，对于某些文件，我得到的只是一个控制台，我不知道为什么。我正在尝试在 MFC 中填充列表控件，并且我希望程序及其关联的处理程序在我双击选择时运行。有没有更好的方法，或者解释为什么这不起作用？
这是可能是问题的代码：

```
 int selection = listControl.GetCurSel();
CString text;
listControl.GetText(selection,text);
string std_str = StringUtils::CStringToString(text);
string st = string("start \"")+std_str+string("\"");
const char* command = st.c_str();
system(command); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T19:15:37.703

如果命令行上的第一个参数`start`用双引号括起来，它将使用它作为窗口标题而不是命令。它很蹩脚，但这就是它的作用......

尝试

```
string st = string("start \"\" \"")+std_str+string("\""); 
```

反而。

但是，如果您试图让文件的 shell 处理程序在您的进程中执行，那么执行此操作而不是调用`start`命令的更好、更简洁的方法是使用[`ShellExecute()`](http://msdn.microsoft.com/en-us/library/bb762153.aspx)或[`ShellExecuteEx()`](http://msdn.microsoft.com/en-us/library/bb762154.aspx)Win32 API。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T19:12:32.670

我相信 start 使用与文件扩展名关联的文件处理程序。

基本上它将使用文件扩展名来查找要运行的应用程序。
听起来您正在使用的文件的扩展名导致控制台的默认处理程序正在启动。

您可以从阅读 MS 文档开始：http:
[//msdn.microsoft.com/en-us/library/53ezey2s.aspx](http://msdn.microsoft.com/en-us/library/53ezey2s.aspx)

# licensing - 您将如何编译/设计具有不同功能集的分层应用程序

> ID：350514
> 
> 赞同：2
> 
> 时间：2008-12-08T19:08:47.950
> 
> 标签：licensing, build-process, release, desktop-application

在您拥有诸如 Lite、Normal、Ultimate 层和重叠功能集之类的东西可能会减少功能的情况下，从开发的角度来看，使事情保持简单的最简单方法是什么？

我只使用具有单片许可证、启用/禁用特定组件/功能的子功能许可证或席位/资源许可证的应用程序。我有一些想法，但一些新的见解会很好。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T19:27:20.223

我研究过具有服务层的应用程序。虽然这可能不是最好的方法，但这是我所看到的。

1) 找出所有层级共有的功能。通用功能不需要任何逻辑，因为它们可供所有人使用。

2）不常见的功能应该以细粒度的方式分解。因此它们可以一次启用/禁用一个。

3) 将特征矩阵分配给层。

我们有一个许可应用程序，它基本上是一堆包含所有细粒度功能的复选框。选择“Lite”将选中相应的框，因此在生成许可证代码时，它将包含这些功能。

在启动时，许可服务器被安全地查询。（这是一个服务器应用程序，因此它不会经常启动/停止，并且可以保证互联网）允许的功能列表将返回给应用程序。

在代码中，您只需检查天气是否启用了某个功能，然后让许可服务器确定用户所在的层级。

* * *

我在 PC 游戏中看到的另一种用于演示磁盘的方法是为每一层设置一个编译目标。

 ``#DEFINE TIER_NORMAL 1

#DEFINE TIER_LITE etc.

then

#ifdef TIER_NORMAL

do tier normal stuff` 

`#endif`

请注意，您必须跟踪 3 个不同的二进制文件，这可能会很痛苦。但结果是您没有交付用户未付费的代码。在较小的项目中可能比获得许可服务器更容易。

# python - 在 Python 中获取列表中较小的 n 个元素

> ID：350519
> 
> 赞同：13
> 
> 时间：2008-12-08T19:10:10.210
> 
> 标签：python, algorithm, sorting

我需要在 Python 中获取列表中较少的 n 个数字。我需要它非常快，因为它是性能的关键部分，并且需要重复很多次。

n 通常不大于 10，并且列表通常包含大约 20000 个元素。每次我调用该函数时，列表总是不同的。无法就地进行排序。

最初，我编写了这个函数：

```
def mins(items, n):
    mins = [float('inf')]*n
    for item in items:
        for i, min in enumerate(mins):
            if item < min:
                mins.insert(i, item)
                mins.pop()
                break
    return mins 
```

但是这个函数无法击败对整个列表进行排序的简单 sorted(items)[:n] 。这是我的测试：

```
from random import randint, random
import time

test_data = [randint(10, 50) + random() for i in range(20000)]

init = time.time()
mins = mins(test_data, 8)
print 'mins(items, n):', time.time() - init

init = time.time()
mins = sorted(test_data)[:8]
print 'sorted(items)[:n]:', time.time() - init 
```

结果：

```
mins(items, n): 0.0632939338684
sorted(items)[:n]: 0.0231449604034 
```

sorted()[:n] 快三倍。我相信这是因为：

1.  insert() 操作代价高昂，因为 Python 列表不是链表。
2.  sorted() 是一个优化的 c 函数，我的是纯 python。

有什么办法可以打败 sorted()[:n] 吗？我应该使用 C 扩展，还是 Pyrex 或 Psyco 或类似的东西？

提前感谢您的回答。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-08T19:27:39.770

你实际上想要一个排序的分钟序列。

```
mins = items[:n]
mins.sort()
for i in items[n:]:
    if i < mins[-1]: 
        mins.append(i)
        mins.sort()
        mins= mins[:n] 
```

这运行*得*更快，因为您甚至没有查看分钟，除非它的值可证明大于给定项目。大约是原始算法时间的 1/10。

这在我的戴尔上运行时间为零。我必须运行 10 次才能获得可测量的运行时间。

```
mins(items, n): 0.297000169754
sorted(items)[:n]: 0.109999895096
mins2(items)[:n]: 0.0309998989105 
```

使用`bisect.insort`而不是附加和排序可能会进一步加快头发的速度。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-08T20:01:12.493

```
import heapq

nlesser_items = heapq.nsmallest(n, items) 
```

[这是S.Lott 算法](https://stackoverflow.com/questions/350519/getting-the-lesser-n-elements-of-a-list-in-python#350568)的正确版本：

```
from bisect    import insort
from itertools import islice

def nsmallest_slott_bisect(n, iterable, insort=insort):
    it   = iter(iterable)
    mins = sorted(islice(it, n))
    for el in it:
        if el <= mins[-1]: #NOTE: equal sign is to preserve duplicates
            insort(mins, el)
            mins.pop()

    return mins 
```

表现：

```
$ python -mtimeit -s "import marshal; from nsmallest import nsmallest$label as nsmallest; items = marshal.load(open('items.marshal','rb')); n = 10"\
 "nsmallest(n, items)" 
```

```
nsmallest_heapq
100 个循环，3 个循环中的最佳：每个循环 12.9 毫秒
nsmallest_slott_list
100 个循环，3 个循环中的最佳：每个循环 4.37 毫秒
nsmallest_slott_bisect
100 个循环，3 个循环中的最佳：每个循环 3.95 毫秒

```

`nsmallest_slott_bisect`比's快**3 倍**（对于 n=10，len(items)=20000）。只是稍微慢一点。不清楚为什么 heapq 的 nsmallest 这么慢；它的算法几乎与上面介绍的相同（对于小 n）。`heapq``nsmallest``nsmallest_slott_list`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-08T19:32:09.323

一种可能性是使用[bisect](http://docs.python.org/library/bisect.html)模块：

```
import bisect

def mins(items, n):
    mins = [float('inf')]*n
    for item in items:
        bisect.insort(mins, item)
        mins.pop()
    return mins 
```

但是，这对我来说要快一点：

```
mins(items, n): 0.0892250537872
sorted(items)[:n]: 0.0990262031555 
```

使用 psyco 确实可以加快速度：

```
import bisect
import psyco
psyco.full()

def mins(items, n):
    mins = [float('inf')]*n
    for item in items:
        bisect.insort(mins, item)
        mins.pop()
    return mins 
```

结果：

```
mins(items, n): 0.0431621074677
sorted(items)[:n]: 0.0859830379486 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-08T19:37:25.723

如果速度是最重要的，最快的方法是使用 c。Psyco 有前期成本，但可能会很快。我会推荐 Cython 用于 python -> c 编译（pf Pyrex 的更新）。

用 c 手工编码是最好的，并且允许您使用特定于您的问题域的数据结构。

但请注意：

> “在 C 中编译错误的算法可能不会比在 Python 中正确的算法快”@S.Lott

我想添加 S.Lott 的评论，以便引起注意。Python 是一种出色的原型语言，您可以在其中解决您打算稍后转换为较低级别语言的算法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-03-12T16:02:43.640

为什么不直接在 O(N) 时间内调用 select_n_th 元素，然后将数组按第 n_th 元素分成两部分，这应该是最快的。

ps：如果您不指定 n 最小元素的顺序，则此 O(N) 算法有效。下面的链接似乎可以执行选择算法。 [http://code.activestate.com/recipes/269554-select-the-nth-smallest-element/](http://code.activestate.com/recipes/269554-select-the-nth-smallest-element/)

假设数组没有重复的元素，代码对我有用。效率仍然取决于问题规模，如果 n<10，可能 O(logn*N) 算法就足够了。

```
import random
import numpy as np
def select(data, n):
    "Find the nth rank ordered element (the least value has rank 0)."
    data = list(data)
    if not 0 <= n < len(data):
        raise ValueError('not enough elements for the given rank')
    while True:
        pivot = random.choice(data)
        pcount = 0
        under, over = [], []
        uappend, oappend = under.append, over.append
        for elem in data:
            if elem < pivot:
                uappend(elem)
            elif elem > pivot:
                oappend(elem)
            else:
                pcount += 1
        if n < len(under):
            data = under
        elif n < len(under) + pcount:
            return pivot
        else:
            data = over
            n -= len(under) + pcount

def n_lesser(data,n):
    data_nth = select(data,n)
    ind = np.where(data<data_nth)
    return data[ind] 
```

# emacs - 如何计算 Emacs 中打开的缓冲区/文件的数量？

> ID：350526
> 
> 赞同：9
> 
> 时间：2008-12-08T19:11:41.440
> 
> 标签：emacs, lisp

时不时地，当我打算按 Cx 或 Cc 时，我不小心在 Emacs 中按了 Cx Cc。当然，这会在没有确认的情况下关闭所有打开的帧和缓冲区。我知道我可以让 Emacs 提示“你确定要退出吗？”，但我不想一直这样做，这会很烦人。我只是希望它在打开超过 N 个文件（或缓冲区）时执行此操作。

所以我想将 Cx Cc 绑定到一个函数，如下所示：

```
(if (< number of open buffers n)
    (save-buffers-kill-emacs)
    (are-you-sure)) 
```

但我不知道如何获取打开缓冲区的数量（或打开的帧数，或打开的文件数等）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-08T19:40:23.910

这就是我使用的：

```
(defun count-buffers (&optional display-anyway)
  "Display or return the number of buffers."
  (interactive)
  (let ((buf-count (length (buffer-list))))
    (if (or (interactive-p) display-anyway)
    (message "%d buffers in this Emacs" buf-count)) buf-count)) 
```

我偷了它~~，但不记得从哪里来~~. 来自约翰·斯特迪（ [John Sturdy](http://www.cb1.com/~john)），他听起来像个迷人的家伙；可从[他的网站](http://www.cb1.com/~john/computing/emacs/lisp/startup/buffer-misc.el)获得。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-08T21:08:12.280

此外，您可以考虑使用桌面模式，它会在您再次启动 Emacs 时自动恢复您的缓冲区。只需添加

```
(desktop-save-mode 1) 
```

到你的`.emacs`. 请参阅[GNU Emacs 手册](http://www.gnu.org/software/emacs/manual/html_node/emacs/Saving-Emacs-Sessions.html)或[Emacswiki](http://www.emacswiki.org/emacs/DeskTop)。

# compact-framework - Windows CE 在重置时删除 .NET CF

> ID：350539
> 
> 赞同：8
> 
> 时间：2008-12-08T19:14:54.193
> 
> 标签：compact-framework, windows-ce

我正在为专有的 Windows CE 4.2 设备编写 C# 应用程序（对此我没有规格或几乎任何其他信息。我可以访问文件系统，基本上就是这样。）我也无法得到原厂商的支持。

现在，我可以很好地安装 .NET Compact 框架，并且一切正常。但是每隔一段时间，当设备重置时，它*会删除*框架、GAC 以及与之相关的所有内容。

我知道这不仅仅是硬重置跳回出厂默认设置，因为：

1.  它记得注册表设置（如果我再次尝试安装，它说框架已经安装，并询问我是否要重新安装。显然注册表项仍然存在）
2.  即使我将框架安装到可移动闪存卡上，文件也会被删除。（但是，存储卡上的其他文件将被保留）

我知道没有什么可做的，但也许一些 Windows CE 专家能够告诉我为什么会发生这种情况，以及是否有一些理智的方法可以避免它。我对 Windows CE 了解不多，所以就我所知，这可能是完全标准的行为。

就此而言，有关如何自己进一步解决此问题的任何建议？目前，我能看到的最佳解决方案是在每次启动时简单地重新安装所有内容，但这似乎有点笨拙。

**编辑：** 重置后，文件系统根目录中的 GACLOG.TXT 包含

> CGACUTIL：初始化 2008 年 12 月 8 日
> 
> 20:43:57.000 CGACUTIL：初始化
> 
> 2008 年 12 月 8 日 20:43:57.000
> 
> **删除 Microsoft .NET CF 3.5.GAC**
> 
> 2008 年 12 月 8 日 20:43:57.000 CGACUTIL：完成
> 
> 2008 年 12 月 8 日 20:43:57.000
> 
> 2008 年 12 月 8 日 20:43:57.000 退出

所以，是的，它肯定会删除 GAC。为什么，以及如何阻止它？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-09T02:27:10.517

您在此处看到的一些 Windows CE 和 CF 行为提供了这种行为。不幸的是，没有真正好的解决方案，但我至少可以给你一些指导。

1.  Windows CE 存储当前对象存储，包括文件系统中的文件，而不是专门存储在 RAM 中的持久存储上。这包括添加到 \Windows 文件夹的任何文件和/或文件夹（这在您的情况下是关键）。当设备断电时——通常是在软复位或硬复位中，这些数据会丢失。
2.  CE 注册表可以（并且可能在您的设备上）存储在持久存储中。这可能在文件系统中（作为配置单元）或在某个不可见的位置（OEM 可以通过两种不同的方式存储它）。这*不会*在重置时丢失。只有已保存且未刷新的项目会丢失。
3.  作为 #2 的附录 - 调用 RegFlushKey API 时会刷新注册表更改。安装 CAB会**自动**调用它（所以安装 CF 会这样做）。一些 OEM 还选择在定期计时器上刷新。
4.  当 CF GAC 的项目不在图像中时，该文件将**移动**到 \Windows 文件夹。当组件被卸载时，它们被**放回**（我在几年前向 CF 团队抱怨过，但无济于事）。

这意味着如果您将 CF 安装到存储卡并运行您的应用程序，则会发生以下情况：

1.  CF 文件在解压 CAB 期间被复制到持久存储
2.  安装 reg 键是写的
3.  注册表已刷新（已保存）
4.  应用程序运行
5.  CF 文件被移动（未复制）到易失性的 \Windows。

现在，如果您在加载 CF 程序集时重置设备 - 噗！没有更多的CF。您的应用程序在存储卡上，但不在 GAC 中，因此它仍然存在但无法再运行。

hack 解决方案：使用本机应用程序“引导”来启动您的应用程序。让它在运行时检查 \Windows 中的 CF 文件，如果它们不存在，则从持久存储中的某个位置安装 CF CAB（将其标记为只读，以便 wceload 不会删除它）。

另一种选择是将 CF 程序集与您的应用程序一起分发，而不是 GAC 它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-01-07T11:19:33.513

我知道这是一个非常古老的问题，但是由于我遇到了与问题中提到的相同的问题，因此我进行了大量研究以使其正常工作。我设法在不使用本机引导应用程序的情况下做到了。

1）我事先使用[MSCEInf](http://freewareppc.com/utilities/msceinf.shtml "理学硕士")提取了CF cab。我复制了提取的数据（其中包含一个 \Windows 文件夹）和 SD 卡上的原始 cab，并在完全启动后将其插入我的设备中。

2) 现在，首先安装 cab，在同一张 SD 卡或其他一些 NAND 存储上选择一个空文件夹（如果需要，创建一个）。

3) 将之前从 CF cab 中提取的 \Windows 文件夹的内容复制到安装 CF 的同一文件夹中。如果提示要求覆盖任何文件，请始终选择“否”。

4) 确保任何使用/需要 CF 的应用程序都位于同一文件夹内。您也可以将属于应用程序的任何子文件夹原封不动地放在那里。

无论如何，这对我有用。应用程序继续工作，重启后也是如此。

希望这可以帮助！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T19:22:10.700

我认为您需要在安装某些内容后运行 RegSave 以保存注册表设置。我必须在较旧的（.Net 之前）版本的 Windows CE 中执行此操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-10-26T08:48:00.723

在我的 DataLogic Memor CE 上，我现在可以通过手动保存“会话”（无论这意味着什么）来使新的 .Net 安装在冷启动时存活下来。它位于此处：（
`Start | Settings | Control Panel | Files Admin | Save session`
按下“保存会话”按钮后对话框仍然打开，但您可以关闭该对话框。）

这（显然）仍然需要手动操作，所以这只是另一种解决方法。
只申请几台设备（在开发/试用期间）会更快，但额外的安装文件或“ctacke”的黑客代码可能更适合大容量。

它也确实意味着有一种方法可以通过软件使新的 .Net 安装持久化。所以也许有人可能会被触发想出如何做到这一点，并与世界分享？

PS：我不知道这个手动保存有多通用（如果它也适用于其他设备或其他品牌或其他 CE 版本）。我也不知道它是否是*干净*启动持久的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-01-09T00:50:15.600

我已经集思广益了几个小时，终于开始为基于 WinCE 7 的硬件设备配置和项目构建编写用户指南。将很快推出。感谢 SO 参与我的研究

# ruby-on-rails - Rails 用户访问插件

> ID：350546
> 
> 赞同：5
> 
> 时间：2008-12-08T19:16:18.980
> 
> 标签：ruby-on-rails, permissions, acl, access-control

有很多 Rails 插件可以处理用户权限。我对 hobo gem 中的实现印象深刻，但我不确定我是否可以只使用这个功能而不是其他部分。GateKeeper 是一个非常聪明的实现，但有一些错误，虽然它足够小，我可能自己可以修复它。Restful_ACL 为您提供了一个用于检查创建的类方法，这意味着您无法对相关实例进行任何检查（不确定它是否会进行范围查找）。

我想要提供 ActiveRecord#find 的范围版本的东西，它只找到当前用户被允许看到的东西。这应该足够强大，您只能看到您或您的一位朋友拥有的画廊中的图片。

作为奖励，它可以防止您无权执行的创建或更新（在 before_* 或验证步骤中），包括将您自己的记录与不同的用户或画廊相关联，或创建此类记录。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T21:17:24.820

[您可以使用declarative_authorization](http://github.com/stffn/declarative_authorization/tree/master)插件在模型级别上执行一些非常复杂的授权技巧。尽管如此，我自己更喜欢[rails-authorization-plugin](http://github.com/DocSavage/rails-authorization-plugin/tree/master) - 使用这个你可以定义模型级别的角色（例如，某人是资源的所有者）和控制器级别的权限（例如，只有资源的所有者或管理员可以获取资源）。我发现这种方法更加简洁，特别是如果您正在追求一种干净的 REST 方法。如果您有这样的要求：

```
GET /posts 
```

您真正应该返回的是*所有帖子*，而不仅仅是当前用户的帖子。为此，您应该有不同的路线：

```
GET /users/:user_id/posts 
```

其中 :user_id 设置为当前用户的 ID。然后应该在适当的操作中反映这种差异：

```
def index
  user = User.find(params[:user_id]) unless params[:user_id].blank?
  @posts =
   if user
    # get all posts of a user
    user.posts.all
   else
    # get all posts 
    Post.all
   end
end 
```

现在，您真正拥有的是两个授权上下文 - “获取用户的所有帖子”和“获取所有帖子”，您通常希望为两者设置不同的权限（例如，“只有管理员可以获取所有帖子”和“仅用户自己或管理员可以获取用户的所有帖子”）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-01T19:04:29.333

我有一个gem，它完全是关于能够根据对象的角色指定对象的权限。你可以看看这里：http: [//github.com/nakajima/roleful/tree/master](http://github.com/nakajima/roleful/tree/master)。它适用于`before_filter`您暗示的那种方法。

至于只允许用户访问与他们有某种关系的事物，我认为您正在寻找 Rails 关联代理的主要候选人。我喜欢 Milan Novota 的片段，尽管我会稍微修改一下：

```
def index
  @posts = user_repo.posts
end

private

def user_repo
  # find_by_id is **much** faster than regular find,
  # plus it just returns nil when there's no record
  if user = User.find_by_id(params[:user_id])
    # returns the association proxy
    user.posts
  else
    # returns the class
    User
  end
end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T20:48:14.693

你可以看看[lockdown](http://github.com/stonean/lockdown)。我还没有在项目中实现这个，但它可以为你节省一些工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-10T01:51:51.130

回想起来，我只会使用 Hobo 模式。它是最简单和最灵活的。

# apache - 如何重写这个 RewriteRule？

> ID：350584
> 
> 赞同：0
> 
> 时间：2008-12-08T19:34:08.947
> 
> 标签：apache, mod-rewrite

我有这个重写规则

```
RewriteRule (.*)/([^/\.]+).css$ include/style/styleRedir.php?css=$2.css [L,NC]

```

与以下内容匹配：

```
某个文件夹/foo.css

```

并将它们重写为：

```
包括/样式/styleRedir.php?css=foo.css

```

但是它不匹配：

```
foo.css

```

所以我尝试将其更改为：

```
RewriteRule (.*)(/?)([^/\.]+).css$ include/style/styleRedir.php?css=$3.css [L,NC]

```

但随后它将重写为：

```
包括/样式/styleRedir.php?css=.css

```

那么我怎样才能制作这个 RewriteRule 以便它可以重写 foo.css 以包含/style/styleRedir.php?css=foo.css

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T20:24:43.180

我没有安装 Apache 来测试，但你有没有尝试添加 /？到第一组？

```
RewriteRule (.*/?)([^/\.]+).css$ include/style/styleRedir.php?css=$2.css [L,NC] 
```

或者，为什么不是 2 条规则？

```
RewriteRule (.*)/([^/\.]+).css$ include/style/styleRedir.php?css=$2.css [L,NC]
RewriteRule /?([^/\.]+).css$ include/style/styleRedir.php?css=$1.css [L,NC] 
```

# c++ - 为应用程序设置默认光标

> ID：350586
> 
> 赞同：3
> 
> 时间：2008-12-08T19:34:24.327
> 
> 标签：c++, qt

在 Qt 应用程序中，是否有设置应用程序默认光标的等效`QApplication::setFont`项，通过在特定小部件上设置一个来覆盖？

`QApplication::setOverrideCursor`覆盖所有特定于小部件的小部件，我希望本地小部件能够优先处理这个，但如果我没有指定一个，仍然使用我的光标。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T04:46:24.103

QWidget 要么使用 QWidget::setCursor 指定的光标，要么回退它的父级光标设置。因此，只需为您的主窗口设置光标就可以了。

新的顶级窗口和对话框在创建时需要设置光标，因为它们不是可以继承的父级。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T14:12:41.713

那非常接近我的需要，但是它似乎没有被其他窗口继承。我想虽然 setFont 没有等价物，所以我必须单独处理其他人。

# sql - 在 Access 中使用 SELECT DISTINCT、SELECT COUNT 和 UPDATE 计数出现次数

> ID：350587
> 
> 赞同：1
> 
> 时间：2008-12-08T19:34:37.773
> 
> 标签：sql, ms-access

在 Access 中，我有一张这样的表：

```
Date      | EmployeeNum | Award
11-JAN-08 | 34          | GoldStar
13-JAN-08 | 875         | BronzeTrophy
13-JAN-08 | 34          | BronzeTrophy
18-JAN-08 | 875         | BronzeTrophy 
```

我想有一张桌子像这样计算它们：

```
EmployeeNum | GoldStar | BronzeTrophy
34          |    1     |      1
875         |    0     |      2 
```

我希望能够通过运行查询或类似的东西来生成这个表。我试过把它放到一个查询中，但我不确定我做得对。我试过使用 UPDATE 和 SET = SELECT COUNT 没有太多成功。

我该怎么做？我应该这样尝试吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T19:43:53.387

您将需要一个交叉表（又名数据透视）查询。尝试以下 SQL 并进行修改以满足您的需要：

```
TRANSFORM Count(MyTable.EmployeeNum) AS AantalVanEmployeeNum
SELECT MyTable.EmployeeNum
FROM MyTable
GROUP BY MyTable.EmployeeNum
PIVOT MyTable.Award; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T19:51:20.893

在 Access 中，尝试“/View/数据透视表视图”。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-08T21:00:35.590

我会使用下面的查询来获取您的总数：

```
SELECT EmployeeNum, 
       SUM(Case [Award] WHEN 'GoldStar' THEN 1 ELSE 0 END) As [GoldStar], 
       SUM(CASE [Award] WHEN 'BronzeTrophy' THEN 1 ELSE 0 END) As [BronzeTrophy]
FROM MyTable
Group By EmployeeNum 
```

# svn - Subversion - 使用 SVNParentPath 时如何控制单个存储库的用户访问？

> ID：350588
> 
> 赞同：2
> 
> 时间：2008-12-08T19:34:45.527
> 
> 标签：svn, security, version-control

我有 subversion 存储库，可以正常工作，所有用户都需要密码身份验证。我的配置发布在下面。如何修改此配置，以便允许单个用户对我的一个存储库具有只读访问权限？

提供的示例需要使用 SVNParentPath 而不是 SVNPath。前者允许您指定包含多个颠覆存储库的目录。

```
<VirtualHost *:80>
    ServerAdmin apache@mycompany.org
    DocumentRoot "d:/Apache2/htdocs/"
    ServerName code.mycompany.org
    ErrorLog "logs/src.mycompany.org-error.log"
    CustomLog "logs/src.mycompany.org-access.log" common
    SetOutputFilter DEFLATE

    <Location />
      DAV svn
      SVNParentPath D:\SVN
      AuthType Basic
      AuthName "My Repository"
      AuthUserFile conf/myteam.pwd
      Require valid-user
    </Location>   
</VirtualHost> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T21:40:58.643

我自己使用 SVN Book 解决了这个问题。

首先，确保您在 AuthUserFile 中设置了一些用户。接下来，为授权规则创建一个文件 (conf/myteam.authz)。像这样填充这个文件。

```
[groups]
my-developers = BrianLy
external-developers = JamesKL

[/]
@my-developers = rw

[repository-name-here:/path/here]
@external-developers = r 
```

这将创建 2 个组，然后为其分配权限。我的团队拥有对所有存储库的开发人员访问权限。第二条规则指定第二组对特定存储库的访问权限有限。

然后通过在 AuthUserFile 下面添加此行来更新您的 Apache 配置

```
AuthzSVNAccessFile conf/myteam.authz 
```

重新启动 Apache（必需）

# .net - IdbConnection 与 SqlConnection

> ID：350599
> 
> 赞同：12
> 
> 时间：2008-12-08T19:38:03.837
> 
> 标签：.net, design-decisions, vendor-neutrality

当我编写应用程序时，我使用 System.Data 接口（IDbConnection、IDbCommand、IDataReader、IDbDataParameter 等...）。我这样做是为了减少对供应商的依赖。除非，我正在做一个简单的测试应用程序，否则在咨询时这似乎是合乎道德的事情。

但是，我看到的所有代码似乎都使用 System.Data.SqlClient 命名空间类或其他供应商特定类。在杂志和书籍中，很容易将其归结为 Microsoft 的影响力和他们的营销策略，只针对 SQLServer 进行编程。但它看起来就像我看到的几乎所有 .NET 代码都使用 SQLServer 特定类。

我意识到供应商特定的类具有更多功能，例如向 SqlCommand 对象添加参数是一种方法，而将其添加到 IDbCommand 是令人讨厌的 4 多行代码。但话又说回来; 为这些限制编写一个小助手类非常简单。

我还想知道当 SQLServer 是当前目标客户端时针对接口进行编程是否过度设计，因为它不是立即需要的。但我不认为这是因为针对接口进行编程的成本如此之低，因为减少供应商依赖性提供了如此巨大的好处。

您是否使用供应商特定的数据类或接口？

编辑：总结下面的一些答案，并提出我在阅读它们时的一些想法。

使用接口实现供应商中立性的可能陷阱：

*   嵌入在您的 SELECT 语句中的供应商特定关键字（我所有的 ins、upd 和 del 都在 procs 中，所以这不是问题）
*   直接绑定数据库可能会导致问题。
*   除非您的连接实例化是集中式的，否则无论如何都需要调用供应商特定的类。

使用接口的积极原因：

*   根据我的经验，客户一直很欣赏转移到不同供应商的能力（即使没有行使）。
*   在可重用代码库中使用接口

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T19:44:38.050

要考虑的一件事是您切换数据库的实际机会。在大多数情况下，这永远不会发生。即便如此，这也将是一次重大的重写，即使您使用与数据库无关的类。在这种情况下，最好使用功能更丰富且能帮助您更快完成项目的那个。

话虽如此，我认为在大多数情况下，您应该使用自己创建的层，在实际的 .Net API 之上，这样如果您必须更改必须使用的类，那么它就不会那么多了一个问题。即使您留在同一个数据库上，您也永远不知道何时必须切换访问数据库的方式。任何从 ASP 迁移到 ASP.Net（ADODB 与 ADO.Net）的人都可以告诉您这是多么痛苦。

所以我认为最好的解决方案是使用功能更丰富的数据库特定 API，并在其之上构建您自己的层，以便您可以在必要时轻松更换它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-08T19:42:51.160

您必须为类提供的 SQL 有所不同，具体取决于您正在与之交谈的数据库引擎的类型，因此即使您设法编写所有代码来使用接口，您仍然需要编写多组 SQL。

或者，您可以像我们所做的那样，编写我们自己的层来处理我们使用的所有语法，这不是不同引擎提供的所有语法，但足以设法编写一个之前正确重写的 SQL执行。

基本上我们已经创建了一个函数语法，我们在函数名称前加上前缀`SQL::`，这让我们的代码可以识别需要重写的特殊函数。然后将它们解析出来并正确重写，甚至在必要时交换参数顺序。

可以做一些小的事情，比如返回当前服务器日期和时间的函数的名称，但也可以做更大的事情，比如如何选择查询的前 N ​​行。

此外，SQL Server 的参数写为@name，其中 OleDb 使用位置（只需在需要参数的位置添加 ?），我们的代码也处理这些差异。

从某种意义上说，我们不太担心需要编写的 SQL 是有回报的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-08T19:46:45.660

我正在写一些类似于 lassevk 所说的东西，但他打败了我。

*此外*，您必须在某个时候与真实的数据库交谈。您也许可以不用接口代码来包装大部分数据访问，这是个好主意。但最终，如果您使用的是 SQL Server，您将希望创建一个真实的 SqlClient.SqlConnection 实例。Access、Oracle 或 MySQL 也是如此。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-08T19:50:24.327

您应该尝试编写与数据库无关的代码。也许您现在不觉得它有用，但将来您可能会利用它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-08T19:41:22.037

我在直接进行数据库工作的地方使用供应商特定的类（除非我被告知我们最终可能会使用不同的数据库 - 发生的次数：一次）。

但是，如果我最终将一些非 db 特定代码分解为单独的类，我通常会制作方法参数接口 - 特别是如果我认为它在其他项目中有用，并且我不依赖任何特定的直接访问类的特点。

基本上，套用爱因斯坦的话说：使解决方案尽可能简单，但不要更简单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T14:39:08.553

查看 Microsoft 的模式和实践组的企业库。他们那里的数据访问代码显示了提供者独立性的一些良好实现。

[http://msdn.microsoft.com/en-us/library/cc467894.aspx](http://msdn.microsoft.com/en-us/library/cc467894.aspx)

# java - Java 代码模板的 Eclipse 自定义变量

> ID：350600
> 
> 赞同：11
> 
> 时间：2008-12-08T19:38:08.283
> 
> 标签：java, eclipse, templates

如何添加要插入 Java 代码模板的新变量。如何将变量添加到 Window->Preferences->Java->Code Style->Code Templates->Code->New Java Files->Edit->Insert Variable... 的列表中？

目前我的新文件是通过以下方式创建的：

```
${filecomment}
${package_declaration}
${typecomment}
${type_declaration} 
```

我希望他们用类似的东西来创建：

```
${begin_filecomment}
${package_declaration}
${typecomment}
${type_declaration}
${end_filecomment} 
```

其中 begin_filecomment 和 end_filecomment 出现在插入变量列表中。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-20T01:45:22.447

是的，您确实可以在此列表中添加一个变量。查看名为的扩展点

org.eclipse.ui.editors.templates

你会知道怎么做的。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-08T19:41:13.860

我很确定“变量”列表是由 Eclipse 生成的，并且无法添加新的模板变量。

你想成为什么样`${begin_filecomment}`的人`${end_filecomment}`？只需在编辑框中输入内容 - 没有任何内容表明您不能将静态内容放入其中。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-07-03T14:37:04.790

要贡献一个新变量，您需要创建一个插件并实现 org.eclipse.ui.editors.templates 扩展点。

您必须提供一个 org.eclipse.jface.text.templates.TemplateVariableResolver 的子类，它将实现各种解析方法来将占位符解析为您想要的值。

有关扩展点的帮助和提供 ant 变量的示例，请参见[此处。](http://help.eclipse.org/stable/index.jsp?topic=/org.eclipse.platform.doc.isv/reference/extension-points/org_eclipse_ui_editors_templates.html)

正如 matt b 所说，您通常只需要将文本定义为样板文件，因此为此实现一个变量是多余的。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-10-27T12:41:37.597

并查看[http://ahoehma.wordpress.com/2009/08/24/use-maven-artifact-version-in-eclipse-templates/](http://ahoehma.wordpress.com/2009/08/24/use-maven-artifact-version-in-eclipse-templates/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-30T09:09:12.330

我没试过，但也许你可以编辑 JDT jar 中的模板文件：

```
eclipse\plugins\org.eclipse.jdt.ui_*.jar\templates\ 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-10-27T12:37:08.853

请参阅 [http://thomaswabner.wordpress.com/2009/08/21/use-your-own-variable-in-eclipse-code-templates/](http://thomaswabner.wordpress.com/2009/08/21/use-your-own-variable-in-eclipse-code-templates/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-04-28T22:27:05.043

为了增加对话，我还想在模板中插入一个自定义变量。我的问题是我想在模板中插入一个来自 jsp/jstl 定义的变量。

（即`<c:set var="myVariable" value="${requestScope.variableName}" />`）

这显然引起了一些问题，因为模板已经使用`${}`语法来帮助解析自己的变量。

如此简单的解决方案，我在模板中添加了一个额外`$`的模式。两个`$$`符号将它解析为一个`$`符号，因此给了我我想要的东西。希望这对发帖者或有类似情况的人有所帮助。

# svn - SVN/Tortoise - 标签生成

> ID：350603
> 
> 赞同：12
> 
> 时间：2008-12-08T19:38:50.450
> 
> 标签：svn, change-management

在 Clearcase 中，我可以为给定的一组文件生成一个“标签”，并始终返回该标签以重新生成所有文件，就像我生成标签时一样。

我如何在 Subversion 中做到这一点？我正在使用 Tortoise 前端 [Windows] 到 SVN，但我不确定如何完成此功能。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-08T19:56:26.733

事实上，在 SVN 中，**每个提交都会创建一个 'label'**。您可以随时返回每个修订（提交）。

理论上，分支和标签之间**没有区别。**只是一个分支被进一步开发并与来自不同开发人员的提交合并，而没有人应该提交一个标签。

标签通常被赋予一个更详细的名称，例如“RC 1.5 - 它最终似乎稳定的那一天”。

这就解释了为什么 Tortoise 中的“创建分支/标签”是其中之一。

本质上，svn 只是将最后一个修订版本的副本创建到另一个目录（例如标签）中。该副本当然不是完整副本，而是普通差异，因此是连续的修订号。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-08T19:43:43.887

相当于颠覆中的标签是“标签”（即在文件夹中创建一个分支，用于标记修订的特定目的）。在回购浏览器中，右键单击“复制到...”，然后选择一个新的文件夹名称。

[http://svnbook.red-bean.com/en/1.5/svn.branchmerge.tags.html](http://svnbook.red-bean.com/en/1.5/svn.branchmerge.tags.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-08-19T12:29:38.880

请参阅[Tortoise SVN“日常使用指南”的“分支/标记”部分](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-branchtag.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-08T19:42:13.330

`Tags`相当于 Subversion 中的标签。

标签是通过`copy`命令或在 TortoiseSVN`Branch/Tag`菜单选项中创建的。

按照约定，`tags`被复制到`tags`Subversion 存储库中的路径。

顺便说一句，TortoiseSVN 帮助做得很好——**日常使用指南**非常有帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-08T19:43:37.320

你可以通过两种方式做到这一点。

1.  提交文件的当前状态，现在您可以随时*恢复*到此版本并恢复文件的状态

2.  使用您当前的文件创建一个新标签，然后继续在主干中工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T19:43:16.633

使用 svn copy 并在 tags 文件夹中创建一个副本。这比其他任何东西都更约定俗成，但大多数存储库都会有称为主干、标签和分支的文件夹。

不要担心创建额外的副本——它并没有真正复制所有这些文件——副本在颠覆中很便宜。

例如：

```
svn copy /trunk/foo /tags/foo-1.0 
```

# php - PHP MySQL fetch数组函数的问题

> ID：350608
> 
> 赞同：1
> 
> 时间：2008-12-08T19:41:00.350
> 
> 标签：php, mysql

我有一个包含 2 个表的数据库。

其中一个表包含一行，其中包含从 0 到 10 的数字。

在 PHP 中，我这样做：

```
$query = "SELECT ".$param." FROM issues WHERE ".$param." >=0";
$result = @mysql_query($query) or showError("query failed");
if (!($record = mysql_fetch_array($result))) return null;
return $record; 
```

$param 包含行的名称。

我有点希望得到一个包含数字 0 到 10 的数组，但我得到了一个包含 2 个元素的数组：

```
array(
    [0] = 0
    [row_name] = 0
    .
    .
    . // AND SO ON
) 
```

就是这样。

我以前从未使用过这些函数，并且[www.php.net](http://www.php.net)没有任何真正有帮助的示例......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-08T19:44:41.420

我不确定您要在这里实现什么，但我认为您想要的是：

```
// query...
$records = array();
while($r = mysql_fetch_array($result)) {
    $records[] = $r;
}
return $records; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-08T20:04:49.303

您想在一次调用中获得所有结果。使用您的方法，您必须像 Paolo 向您展示的那样循环结果。但是将 PDO 与[fetchAll](http://no.php.net/manual/en/pdostatement.fetchall.php)一起使用可能会更好。如果您正在学习 PHP 数据库连接，请学习[PDO](http://no.php.net/manual/en/intro.pdo.php)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T19:57:07.527

默认情况下[mysql_fetch_array](http://it.php.net/mysql_fetch_array)返回普通数组和关联数组，因此您可以按位置 ($result[0]) 或按名称 ($result['user_name'])' 访问值：

```
array mysql_fetch_array  ( resource $result  [, int $result_type  ] ) 
```

> result_type：要获取的数组类型。它是一个常量，可以采用以下值：MYSQL_ASSOC、MYSQL_NUM 和 MYSQL_BOTH 的默认值。

# eclipse - 是否可以让 Eclipse 忽略一个特定文件的语法检查/格式化？

> ID：350611
> 
> 赞同：1
> 
> 时间：2008-12-08T19:41:24.080
> 
> 标签：eclipse, syntax, format, syntax-highlighting

我使用 Eclipse 作为 Ruby/Rails 开发的 IDE（使用 Aptana 插件）。我有一个非常非常大的文件，其中包含数千行数据的初始数据加载。当这个文件打开时，一切都停止了（在 Windows 和 Linux 上），大概是因为 Eclipse 试图解析和格式化/语法检查文件。输入一个单词需要一分钟以上才能完成。

有没有办法让我标记这个文件，让 Eclipse 跳过它进行格式/语法检查？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T20:00:12.450

您可以尝试将除大文件之外的所有文件放入[工作集中](http://www.brooksandrus.com/blog/2005/06/19/organizing-eclipse-projects-with-working-sets/)，然后将该工作集设为默认文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T20:34:24.330

在导航器中，右键单击文件并选择打开方式 -> 文本编辑器。这将导致文件在每次访问时都以纯文本形式打开。

# database - 在与另一个表有关系的表中插入行

> ID：350617
> 
> 赞同：1
> 
> 时间：2008-12-08T19:42:59.333
> 
> 标签：database, database-design, jpa, insert

在我的数据库模式中，我有一个已识别的实体。标识符可以重复使用，因此与实体存在一对多的关系。示例：一个人可以有一个昵称。昵称不是唯一的，可以在许多人之间共享。所以架构可能看起来像：

```
PERSON
id
name
nickname_id

NICKNAME
id
name 
```

问题是插入一个新人时，我必须先查询`NICKNAME`昵称是否存在。如果没有，那么我必须在`NICKNAME`. 插入多人时，这可能会很慢，因为每个人插入都会导致查询`NICKNAME`。

我可以通过首先查询所有昵称的昵称来优化大型插入。JPA 查询语言：

```
SELECT n FROM NICKNAME n WHERE name in ('Krusty', 'Doppy', 'Flash', etc) 
```

然后根据需要创建新昵称，然后在人员上设置nickname_id。

这使软件有点复杂，因为它必须将昵称临时存储在内存中。此外，一些数据库对`IN`子句的参数有限制（SQL Server 是 2100 左右），所以我执行了多个查询。

我很好奇其他人是如何处理这个问题的。更具体地说，当一个数据库被规范化并且一个实体与另一个实体有关系时，插入一个新实体基本上会导致必须检查另一个实体。对于大型插入，这可能会很慢，除非将操作提升到代码域中。有没有办法自动插入相关的表行？

仅供参考，我正在使用 Hibernate 的 JPA 实现

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T19:56:57.200

我不确定 ORM 是否可以处理这个问题，但是在直接 SQL 中你可以：

1.  创建名称/昵称对表，
2.  INSERT INTO NicknameTable SELECT Nickname FROM temp WHERE Nickname NOT IN (SELECT Nickname FROM NicknameTable)
3.  在知道昵称存在的情况下插入主表。

在您的示例中，您可以只拥有一个可为空的昵称列而没有另​​一个表，除非一个人可以拥有多个昵称。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T20:05:03.080

说实话？我会在 Person 表中将昵称设为 varchar 列，而忘记 Nickname 表。昵称是一个人的属性，而不是一个单独的实体。

这是一个简化的例子，你的“标识符”真的*从*实体关系中受益吗？

**编辑：**好的，明白这只是一个人为的例子。这个问题很好，因为它经常出现。

标准 SQL 支持一种带有可选“ `...ON DUPLICATE KEY UPDATE...`”子句的 INSERT 语句形式。对该语法的支持因数据库品牌而异。如果您`UNIQUE`在 Nickname 表中为标识符名称添加约束，则重复条目将调用`UPDATE`子句的一部分（您可以进行虚拟更新，而不是更改任何内容）。

```
CREATE TABLE Nickname (
  id SERIAL PRIMARY KEY,
  name VARCHAR(20) UNIQUE
);

INSERT INTO Nickname (name) VALUES ("Bill")
  ON DUPLICATE KEY UPDATE name = name; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T20:34:06.297

```
INSERT INTO Person(Name, NicknameID)
    VALUES(:name, (SELECT id FROM Nickname WHERE Name = :nickname)) 
```

如果 INSERT 由于昵称不存在而失败，则插入昵称，然后插入人员记录。

我假设 :name 和 :nickname 标识包含用户名和昵称的主机变量 - 当从 SQL 中省略该 person.id 列时，它将自动分配一个值。适应你的情况。

如果您认为大多数昵称实际上都是唯一的，您可以简单地尝试无条件地插入昵称，但忽略如果昵称已经存在时发生的错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-02T13:11:52.260

或者，也许“合并”声明会有所帮助？它提供了插入新值或更新现有值的选项。语法和支持因数据库而异，但可能比“ON DUPLICATE”选项更常见。

# groovy - 如何在 grep 中使用 groovy 中的变量？

> ID：350620
> 
> 赞同：3
> 
> 时间：2008-12-08T19:43:20.690
> 
> 标签：groovy, grep

我需要从file.txt中查找具有一堆名称的行，例如`clientLogin=a@yahoo.com`。`clientLogin=b@gmail.com`

file.txt 有垃圾，即`email=a@yahoo.com email=b@gmail.com`. 我需要过滤掉这些

一旦我得到这些行，我需要为 gmail 和 yahoo grep 并得到他们的计数

```
List l = new ArrayList{a@yahoo.com, b@gmail.com}
def gmail = ['sh','-c','grep "clientLogin="$l.get(0) file.txt' | grep gmail | wc -l ]
def yahoo = ['sh','-c','grep "clientLogin="$l.get(1) file.txt' | grep yahoo| wc -l ] 
```

这行不通。如何动态替换 $l.get(1) 值？

* * *

问题是 ${l.get(0)} 必须在“”内，即：

```
def gmail = ['sh','-c','grep "clientLogin=${l.get(0)}" file.txt' | grep gmail | wc -l ] 
```

使它看起来像：

```
def gmail = ['sh','-c','grep "clientLogin=a@yahoo.com" file.txt' | grep gmail | wc -l ] 
```

但`clientLogin=${l.get(0)}`不会产生结果。我不确定我哪里出错了。

感谢您的建议，但至少在我尝试时不会产生结果。

* * *

file.txt 有很多垃圾和类似的模式：

```
Into the domain clientLogin=a@yahoo.com exit on 12/01/2008 etc.. 
```

因此我愿意

```
def ex = ['sh','-c','grep "domain clientLogin=$client" file.txt'| grep "something more" | wc -l] 
```

这样我就可以根据需要链接 grep 并最终达到我需要的计数。

如果我使用，我不确定是否可以链接 greps

```
def ex = ['grep', "$client", 'file.txt'] 
```

感谢您的输入。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T06:09:49.240

您已经在使用 groovy，是否使用正则表达式为您提供答案？

```
def file = new File("file.txt")    
file.delete() // clear out old version for multiple runs
file <<  """
foobar clientLogin=a@yahoo.com baz quux   # should match a@yahoo.com
foobar email=a@yahoo.com baz quux
foobar email=b@gmail.com bal zoom
foobar clientLogin=a@yahoo.com baz quux   # should match a@yahoo.com
foobar clientLogin=b@gmail.com bal zoom   # should match b@gmail.com
foobar email=b@gmail.com bal zoom
"""

def emailList = ["a@yahoo.com", "b@gmail.com"]
def emailListGroup = emailList.join('|')
def pattern = /(?m)^.*clientLogin=($emailListGroup).*$/

def resultMap = [:]

(file.text =~ pattern).each { fullLine, email ->
    resultMap[email] = resultMap[email] ? resultMap[email] + 1 : 1
}

assert resultMap["a@yahoo.com"] == 2
assert resultMap["b@gmail.com"] == 1 
```

对我来说，这比试图解决一个进程并使用它更干净，而且它只会挑选出你正在寻找的带有“clientLogin =（email）”的确切行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T20:01:36.363

我不确定您是否需要“sh”和“-c”。我能够让它工作：

```
def client = 'foo@bar.com'
def ex = ['grep', "$client", 'file.txt']

def proc = ex.execute()
proc.waitFor()

println "return: ${proc.exitValue()}"
println "stderr: ${proc.err.text}"
println "stdout: ${proc.in.text}" 
```

[Groovy 的文档](http://groovy.codehaus.org/Executing+External+Processes+From+Groovy)也可以为您提供帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T22:49:08.567

您需要在变量表达式周围使用 {}。那是：

```
 "${l.get(0)}" 
```

有关更多信息，请参阅[Groovy 字符串](http://groovy.codehaus.org/JN1525-Strings)文档。

完整示例：

```
List l = new ArrayList{a@yahoo.com, b@gmail.com}
def gmail = ['sh','-c','grep "clientLogin="${l.get(0)} file.txt' | grep gmail | wc -l ]
def yahoo = ['sh','-c','grep "clientLogin="${l.get(1)} file.txt' | grep yahoo| wc -l ] 
```

# asp.net - 在 ASP.NET 中访问 Active Directory？

> ID：350628
> 
> 赞同：6
> 
> 时间：2008-12-08T19:44:36.180
> 
> 标签：asp.net, active-directory, credentials

我使用控制台应用程序编写一些测试代码：

```
 /// <summary>
    /// Returns AD information for a specified userID.
    /// </summary>
    /// <param name="ntID"></param>
    /// <returns></returns>
    public ADUser GetUser(string ntID)
    {            
        DirectorySearcher search = new DirectorySearcher();         
        search.Filter = String.Format("(cn={0})", ntID);

        search.PropertiesToLoad.Add("mail");
        search.PropertiesToLoad.Add("givenName");
        search.PropertiesToLoad.Add("sn");
        search.PropertiesToLoad.Add("displayName");
        search.PropertiesToLoad.Add("userPrincipalName");            
        search.PropertiesToLoad.Add("cn");

        SearchResult result = search.FindOne();

        return new ADUser(result);
    } 
```

这在控制台应用程序中运行良好。但是，当我将其移至 ASP.NET 应用程序时，我收到一条关于不知道正确域的错误消息。

在 ASPNET 帐户上运行时访问 AD 是否缺少技巧？

**编辑**：仅传递一个 LDAP://domain 连接字符串是不够的，因为它需要一个实际的登录名/密码。因为它在机器上的本地帐户上运行，所以我不确定要使用什么 AD L/P。我可以以某种方式将访问用户帐户委托给此吗？

**编辑#2**：当尝试使用身份模拟时，我得到一个 DirectoryServicesCOMException ：

### 身份验证机制未知。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T19:47:22.273

是的。您需要给它一个目录连接字符串。控制台应用程序（以您的身份运行）使用您的凭据运行，包括目录访问权限。ASP.NET 应用程序使用 ASPNET 用户的凭据运行，这些凭据对于运行应用程序的系统是本地的，而不是目录全局的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T19:51:13.967

或者，您可以在 web.config 中指定 identity impersonate=true 并且对 Active Directory 的请求将作为调用用户而不是 Machine\ASPNET 发送

编辑：如果您收到身份验证错误，请参阅 PIPTHEGEEK 的帖子，您将不得不信任您的 Web 服务器进行委派，但是要小心信任委派（因为它会打开另一罐针对安全类型的蠕虫）。您必须允许 Web 服务器将当前用户的凭据传递给 AD。

如果可能，请转到计算机的 AD 属性，选择委派选项卡，然后选择“信任此计算机以委派给任何服务（仅限 Kerberos）

看看这是否有效。如果是这样，您可以使用第三个选项进一步细化权限

“信任这台计算机仅委派指定的服务”

然后选择“仅使用 Kerberos”

并在“此帐户可以提供委托凭证的服务”中，添加相关服务信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T19:57:35.527

如果它是使用 Windows 身份验证的 Intranet 应用程序，那么您可以将 AD 调用包装在用户的模拟上下文中。

就像是：

```
using (((System.Security.Principal.WindowsIdentity)User.Identity).Impersonate())
{
    // Do your AD stuff here
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-08T19:58:20.737

解决此问题的最简单方法是让您的 Web 应用程序池作为具有所需访问权限的域帐户运行。这避免了您必须管理密码的安全存储。不要忘记使该帐户成为 IIS_WPG 本地组的成员。如果您决定使用模拟，则必须配置 Kerberos 委派以及将 ASP.NET 配置更改为模拟。这将涉及使应用程序池作为域帐户运行，授予该域帐户委派凭据的权限（AD 用户和计算机 MMC 中帐户属性的委派选项卡）。然后确保网站设置为在元数据库中使用 negoiate（这是 IIS6 上的默认设置，不确定其他版本）并为新域帐户注册 SPN。

编辑：您的“未知身份验证”错误听起来像是错误配置的委派。检查您的应用程序池正在运行的帐户是否受委派信任，IIS 是否设置为仅使用 Windows 身份验证，以及是否为应用程序池身份帐户注册了有效的 SPN。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-06-27T12:33:48.497

您也可以尝试在登录中包含域

```
adSharepointUsers = new DirectoryEntry("LDAP://MyDomain","MyDomain/ADUser","password"); 
```

# networking - 确保网络冗余：如何在不停机的情况下从默认 ISP 切换到备用 ISP

> ID：350631
> 
> 赞同：-1
> 
> 时间：2008-12-08T19:44:49.063
> 
> 标签：networking

这是情况。我正在与之合作的这家小公司希望拥有冗余的互联网访问权限。他们在办公室运行大量服务——网站、POP+SMTP 服务器，并使用 VPN 从家里访问网络共享。他们有来自 2 个 ISP 的 2 个独立互联网连接（一个是本地有线电视提供商，另一个是 DSL）。如果他们的默认连接断开，他们会切换到备份。

不幸的是，他们现在的设置方式每次发生这种情况时都必须更改其 DNS 记录，这意味着每次切换最多会导致几个小时的停机时间。他们希望完全冗余，并且能够在不停机的情况下在网络之间切换。那怎么能做到呢？

是否可以在远程数据中心设置服务器，将 DNS 指向它并让它将网络流量转发到正确的 IP？

如果这只是一个 Web 应用程序，我会设置一个基本服务器并使用 301 重定向或类似的东西。我真的不在乎是否每次都必须手动切换，因为他们有一两个专门的 IT 人员可以做到这一点。但他们也需要以这种方式重定向他们的 POP、SMTP 和 VPN 流量。

所以它几乎就像负载平衡，但不是真的。是否存在可以提供此功能的现有解决方案？您将如何提供这样的 ISP 冗余？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T19:59:04.370

上次我这样做时，我有自己的 ASN，并与两个 ISP 进行了 BGP，宣布我自己的 /24（您可以从任何一个 ISP 或 ARIN 获得）。你可以沿着这条路线走，但它的设置相当多。随机的 Cable/DSL ISP 可能不会与您一起设置。这确实消除了所有故障点并使切换完全透明。

您还可以将 DNS 记录上的 TTL 降低到 5 分钟左右。这不会是即时切换，但 5 分钟可能已经足够快了。

否则，您当然可以在 colo 中使用远程服务器，但这当然会成为单点故障。对于如何重定向流量，您有两种选择：

*   GRE/等 隧道：您从存储箱运行两条隧道，一条连接到您办公室的每个连接。双向隧道传输所有相关流量，您最终会从办公室的 colo 获得一些 IP。然后，您可以运行路由协议（甚至是简单的协议，例如 RIP）来自动进行故障转移，或者甚至同时使用两个 ISP 来增加带宽。这可以在 Linux 机器或 Cisco 路由器上相当容易地实现。我认为瞻博网络可以，但我从未使用过它们。故障转移是透明的（例如，不会中断 VPN 连接）。当心 MTU 问题。如果您的办公室连接不执行反向路径过滤（或可以为您设置例外），则您不必将传出流量通过隧道传输回 colo。
*   NAT。可能会或可能不会与您正在运行的任何协议一起使用，但您可以在 colo 设置 1:1 静态 NAT 以重定向流量。轻松完成常见的 TCP 协议，也许你的 VPN 也是如此。几乎什么都可以。故障转移不透明；现有连接将超时。也可以在每个连接的基础上使用这两个连接来获得额外的带宽。流量必须通过隧道返回科罗拉多。
*   明显的第三个答案：将服务移至 colo。还具有防止停电的优点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T20:02:46.720

我认为[DynDns](http://www.dyndns.com/services/dns/custom/) “自定义 DNS”服务可能会对您的情况有所帮助 - 您的域名后面的 IP 可能会动态更新（许多路由器都内置了对它的支持）。

更新：为了减少停机时间，您可以创建一个简单的脚本，每隔一段时间 ping 一次主要 ISP，并在失败的情况下将 DynDNS 更新到次要的（并以相同的方式返回）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-03-05T01:31:14.717

这有点晚了，但答案是循环 DNS。使用两个 IP 地址 1.1.1.1 和 2.2.2.2 设置您的网络服务器 (www.example.com)。当人们尝试访问 www.example.com 时，浏览器会自动随机尝试一个，如果第一个没有应答，则切换到另一个，然后缓存结果，直到浏览器关闭或连接再次失败。无需停机，如果首先选择错误的 IP 地址，则在第一次连接时只会出现短暂的瞬间。

实际上，您甚至可以同时在两个 IP 地址上运行一个网络服务器；这被称为“超简单负载平衡”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-18T16:40:15.267

您可以使用 default-nexthop 设置路由映射。

这将处理传出流量而不是传入冗余，这将需要一个至少为 /24 的块的 AS 编号和 BGP 公告，因为 ISP 不会宣布小于 /24 块的任何内容。

# c# - 关于 .Net Compact Framework 开发的书籍

> ID：350637
> 
> 赞同：2
> 
> 时间：2008-12-08T19:47:56.953
> 
> 标签：c#, .net, compact-framework

我正在寻找一本关于使用 .Net Compact Framework 进行开发的书。有人有任何提示吗？

谢谢。你的，托马斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T20:23:02.153

这本[“](https://rads.stackoverflow.com/amzn/click/com/0735623589) Microsoft® 移动开发手册”无疑是最好的一本。

一些作者还参与了开源 OpenNETCF 产品，因此他们绝对知道他们在说什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T20:21:13.763

以下书籍足以满足您的需求：

*   [Microsoft® 移动开发手册](https://rads.stackoverflow.com/amzn/click/com/0735623589)
*   [使用 C# 进行 .NET Compact Framework 编程（Microsoft .NET 开发系列）](https://rads.stackoverflow.com/amzn/click/com/0321174038)
*   [Microsoft .NET Compact Framework（核心参考）](https://rads.stackoverflow.com/amzn/click/com/0735617252)

# asp.net - 如何将 Web 表单保存到 MySQL 数据库中？

> ID：350638
> 
> 赞同：1
> 
> 时间：2008-12-08T19:48:05.797
> 
> 标签：asp.net, mysql, data-access-layer

我有一个 ASP.Net 表单，我想将它保存到数据库中，有什么想法吗？？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T20:06:34.917

你最好的选择是阅读像[NHibernate这样的](http://www.nhibernate.org)[ORM](http://en.wikipedia.org/wiki/Object-relational_mapping)。如果您将它与[myGeneration 之](http://www.mygenerationsoftware.com/)类的代码生成器一起使用，那么您可以轻松地不必担心数据访问的“更难”部分。

对象关系映射器基本上为您完成了所有艰苦的工作——您使用代码生成器，将其指向您的数据库，然后它生成（大部分）您需要获取数据的数据访问代码。此时，您将函数写入对象的 Save() 或 Update()，而不必担心幕后进行的数据访问。给你一个想法，在我了解 DAL（数据访问层）之前，我使用 NHibernate 并手工制作了与数据库通信所需的 XML。后来，我发现了 myGeneration 并使用了它。尽管如此，它还是让我不必编写 SQL 语句来访问我的数据库中的数据。对于通用[CRUD](http://en.wikipedia.org/wiki/Create,_read,_update_and_delete)操作，通常无法击败 ORM。

如果您最终想要以“艰难的方式”来做，那么您需要阅读[数据集](http://www.devarticles.com/c/a/ADO.NET/Datasets-in-Microsoft.Net/)在 .NET 中的工作方式，更具体地说，是[.NET 中数据库驱动应用程序](http://my.safaribooksonline.com/0672322471)的概念。不幸的是，如果不更深入地了解您希望从何种形式提取哪些特定数据以及您的数据库的结构，我们就无法“请发送代码”。

# javascript - 如何禁用由子元素触发的 mouseout 事件？

> ID：350639
> 
> 赞同：109
> 
> 时间：2008-12-08T19:48:12.147
> 
> 标签：javascript, jquery, events

让我详细描述一下这个问题：

我想在悬停在元素上时显示绝对定位的 div。使用 jQuery 真的很简单，而且效果很好。但是当鼠标移过其中一个子元素时，它会触发包含 div 的 mouseout 事件。悬停子元素时，如何防止 javascript 触发包含元素的 mouseout 事件。

用 jQuery 做到这一点的最好和最短的方法是什么？

这是一个简化的示例来说明我的意思：

html:

```
<a>Hover Me</a>
<div>
  <input>Test</input>
  <select>
    <option>Option 1</option>
    <option>Option 2</option>
  </select>
</div> 
```

Javascript/jQuery：

```
$('a').hover( function() { $(this).next().show() }
              function() { $(this).next().hide() } ); 
```

* * *

## 回答 #1

> 赞同：217
> 
> 时间：2009-07-24T17:04:29.853

这个问题有点老了，但前几天我遇到了这个问题。

使用最新版本的 jQuery 执行此操作的最简单方法是使用`mouseenter`and`mouseleave`事件而不是`mouseover`and `mouseout`。

您可以使用以下方法快速测试行为：

```
$(".myClass").on( {
   'mouseenter':function() { console.log("enter"); },
   'mouseleave':function() { console.log("leave"); }
}); 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-08T20:16:59.203

为简单起见，我将重新组织 html 以将新显示的内容放入 mouseover 事件绑定到的元素中：

```
<div id="hoverable">
  <a>Hover Me</a>
  <div style="display:none;">
    <input>Test</input>
    <select>
      <option>Option 1</option>
      <option>Option 2</option>
    </select>
  </div>
</div> 
```

然后，您可以执行以下操作：

```
$('#hoverable').hover( function() { $(this).find("div").show(); },
                       function() { $(this).find("div").hide(); } ); 
```

* * *

*注意：我不推荐使用内联 css，但这样做是为了让示例更易于理解。*

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2015-09-18T10:21:58.563

是的，伙计们，使用`.mouseleave`而不是`.mouseout`：

```
$('div.sort-selector').mouseleave(function() {
    $(this).hide();
}); 
```

甚至可以结合使用它`live`：

```
$('div.sort-selector').live('mouseleave', function() {
    $(this).hide();
}); 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-12-08T20:30:03.090

您正在寻找与 javascript 的防止事件冒泡等效的 jQuery。

看一下这个：

[http://docs.jquery.com/Events/jQuery.Event#event.stopPropagation.28.29](http://docs.jquery.com/Events/jQuery.Event#event.stopPropagation.28.29)

基本上，您需要在子 DOM 节点中捕获事件，然后停止它们在 DOM 树上的传播。另一种方法，虽然实际上没有被建议（因为它可能会严重干扰页面上的现有事件），但将事件捕获设置为页面上的特定元素，它将接收所有事件。这对于 DnD 行为等很有用，但绝对不适合您的情况。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-08T20:28:25.560

我只是检查鼠标坐标是否在 mouseout 事件中的元素之外。

它可以工作，但是对于这样一个简单的事情有很多代码:(

```
function mouseOut(e)
{
    var pos = GetMousePositionInElement(e, element);
    if (pos.x < 0 || pos.x >= element.size.X || pos.y < 0 || pos.y >= element.size.Y)
    {
        RealMouseOut();
    }
    else
    {
         //Hit a child-element
    }
} 
```

为了可读性而减少的代码不能开箱即用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-11-15T16:46:44.860

我通过添加`pointer-events: none;`我的子元素 css解决了这个问题

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-08T21:08:02.437

我同意瑞恩的观点。

您的问题是“下一个” div 不是 A 的“子”。HTML 或 jQuery 无法知道您的“a”元素与 DOM 中的子 div 相关。包装它们并将鼠标悬停在包装器上意味着它们是关联的。

但请注意，他的代码不符合最佳实践。不要在元素上设置隐藏样式内联；如果用户有 CSS 但没有 javascript，则元素将隐藏并且无法显示。更好的做法是将该声明放在 document.ready 事件中。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-08T20:25:51.273

我通常看到的处理方式是在将鼠标从 HoverMe 元素移动之间有大约 1/2 秒的延迟。将鼠标移动到悬停的元素中时，您需要设置一些变量来表示您正在悬停在元素上，然后如果设置了此变量，则基本上停止悬停的部分隐藏。然后，您必须从悬停的元素中添加类似的隐藏函数 OnMouseOut，以使其在您移开鼠标时消失。对不起，我不能给你任何代码，或者更具体的东西，但我希望这能为你指明正确的方向。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-04-02T13:44:00.747

这是一个古老的问题，但它永远不会过时。正确答案应该是**bytebrite**给出的答案。

我只想指出 mouseover/mouseout 和 mouseenter/mouseleave 之间的区别。[您可以在此处](http://api.jquery.com/mouseleave/ "jQuery冒泡")阅读非常有用的说明（转到页面最底部的工作演示）。使用`mouseout`时，当鼠标进入另一个元素时，即使它是子元素，事件也会停止。另一方面，当您使用 时`mouseleave`，当鼠标悬停在子元素上时不会触发事件，这是 OP 想要实现的行为。

# sql-server - SQL Server 工具编写删除语句的脚本，这些语句在它们之前有检查存在语句？

> ID：350640
> 
> 赞同：1
> 
> 时间：2008-12-08T19:48:32.130
> 
> 标签：sql-server

我已经尝试过 SQL Server 2008 Management Studio 和其他第三方工具来编写所有数据库对象（视图、SP 和表）的脚本，但我无法生成一个文件脚本，该脚本的删除语句前面带有“如果存在”。 ." 每个对象的声明。

我需要“如果存在”语句，因此如果对象不存在，我不会收到任何错误。该工具不一定适用于 sql server 2008。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T19:56:06.203

SQL 2008 Management Studio 可以做到这一点。右键单击数据库名称并选择 Tasks->Generate Scripts...选中“所有数据库对象”框，然后在下一个屏幕上将 Include If NOT EXISTS 设置为 True（这也将执行 If Exists...虽然它并不明显）和 Script Drop 为 True。我认为这对你有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T20:14:29.130

设置“结果为文本”并运行以下脚本。将结果剪切并粘贴到窗口中并运行。如果需要，您可以修改脚本以过滤掉某些表。

```
select 'if object_id ('''+ s.name + '.' + t.name + 
       ''') is not null drop table ' + s.name + '.' + t.name +
       char (10) + 'go'
  from sys.schemas s
  join sys.tables t
    on t.schema_id = s.schema_id 
```

会产生如下结果：

```
--------------------------------------------------------------------------
if object_id ('dim.Dim1') is not null drop table dim.Dim1
go
if object_id ('dim.TestSnapshot') is not null drop table dim.TestSnapshot
go
if object_id ('fact.Test') is not null drop table fact.Test
go 
```

# xml - 检查节点集是否包含 XSLT 中的任何值

> ID：350641
> 
> 赞同：7
> 
> 时间：2008-12-08T19:48:51.163
> 
> 标签：xml, xslt

我需要一些有关 XSLT 语法的帮助。这是我的场景，我有一个 XML 文件需要转换为不同外观的 XML 文件，我有几个部分，如果特定节点集不包含任何值，则不应处理整个部分。

下面是一个 XML 示例：

```
<Dates>
    <Date>
        <VALUE1></VALUE1>
        <VALUE2></VALUE2>
        <VALUE3></VALUE3>
        <VALUE4></VALUE4>
        <VALUE5>3333</VALUE5>
    </Date>
    <Date>
        <VALUE1>AAAA</VALUE1>
        <VALUE2></VALUE2>
        <VALUE3>JJJJ</VALUE3>
        <VALUE4></VALUE4>
        <VALUE5>12345</VALUE5>
    </Date>
</Dates> 
```

[xml截图](http://img162.imageshack.us/my.php?image=xmlscreenshotgk7.gif)

这是我的 XSLT，带有无法正常工作的 if 语句

```
<xsl:for-each select="Level1/Level2/Level3">
    <xsl:if test="@VALUE1!=''">                    
    <MyDates>               
            <value_1>
                <xsl:value-of select="VALUE1"/> 
            </value_1>
            <value_2>
                <xsl:value-of select="VALUE2"/> 
            </value_2>
            <value_3>
                <xsl:value-of select="VALUE3"/> 
            </value_3>
            <value_4>
                <xsl:value-of select="VALUE4"/> 
            </value_4>       
    </MyDates>
    </xsl:if>   
</xsl:for-each> 
```

如您所见，我基本上希望所有节点（VALUE1、VALUE2、VALUE3 等）都有值，否则不处理并继续下一部分

（如果你看不到 XML 来想，我也做了一个屏幕截图）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-08T20:20:15.640

您正在尝试将 xml 元素与文档中不存在的名称“Level1”、“Level2”等进行匹配。然后，您正在寻找最后一个元素的 VALUE1 属性。

我*想*你想要这样的东西：

```
<xsl:for-each select="Dates">
    <MyDates>
        <xsl:for-each select="Date">
        <xsl:if test="not(*[.=''])">
            <MyDate>
                <value_1>
                    <xsl:value-of select="VALUE1"/> 
                </value_1>
                <value_2>
                    <xsl:value-of select="VALUE2"/> 
                </value_2>
                <value_3>
                    <xsl:value-of select="VALUE3"/> 
                </value_3>
                <value_4>
                    <xsl:value-of select="VALUE4"/> 
                </value_4>               
            </MyDate>
        </xsl:if>
        </xsl:for-each>
    </MyDates>
</xsl:for-each> 
```

只要对应的 Date 元素中的*每个*值都不为空，这将添加一个新的 MyDate 元素。

它的作用是

1.  为每个 Dates 元素创建一个新的 MyDates 元素。
2.  检查每个日期元素。`*`匹配所有孩子。`[.='']`意思是“空的”。最后，它将所有内容包装在一个 not 中。这意味着 if 仅在没有任何子项为空时才会通过。
3.  如果它没有为空的子元素，它会创建一个新的 MyDate 元素，其中包含每个值的副本。

您可能还想查看 W3Schools [XSL](http://www.w3schools.com/xsl/default.asp)和[XPath](http://www.w3schools.com/xpath/default.asp)教程。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-09T02:19:22.310

您还没有很好地定义“节点具有价值”是什么意思。

**最有可能的是，您会考虑一个元素，它有一个只有空格的文本子元素，没有价值。在这种情况下，以下是一种解决方案**：

```
<xsl:stylesheet 版本="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:output omit-xml-declaration="yes" indent="yes"/>

```

```
 <xsl:template match="Date[not(*[not(normalize-space())])]">
       <xsl:copy-of select="."/>
     </xsl:template>

     <xsl:template match="text()"/> 
```

```
</xsl:样式表>

```

**如果“Date”甚至包含一个没有内容或只有空格的子元素，则“Date”元素的此模板将不匹配**。

**当此转换应用于以下 XML 文档时**：

```
<日期>
    <日期>
        <VALUE1></VALUE1>
        <VALUE2> </VALUE2>
        <VALUE3></VALUE3>
        <VALUE4></VALUE4>
        <VALUE5>3333</VALUE5>
    </日期>
    <日期>
        <VALUE1>AAAA</VALUE1>
        <VALUE2>1</VALUE2>
        <VALUE3>JJJJ</VALUE3>
        <VALUE4>1</VALUE4>
        <VALUE5>12345</VALUE5>
    </日期>
</日期>

```

**产生正确的结果**：

```
<日期>
    <VALUE1>AAAA</VALUE1>
    <VALUE2>1</VALUE2>
    <VALUE3>JJJJ</VALUE3>
    <VALUE4>1</VALUE4>
    <VALUE5>12345</VALUE5>
</日期>

```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-05-07T20:42:13.050

我想你也可以这样做。而不是检查节点。VALUE1/text() 将检查节点内是否有一些文本。您可能要确保这些没有空白。此外，您可以查看 VALUE1 元素是否有子节点。

```
<xsl:if test="VALUE1/text()">                    

</xsl:if>   

<xsl:if test="VALUE1/child::node()">                    

</xsl:if> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-08T20:27:40.630

@ 是多余的 - 它指的是 XML 属性。

您正在尝试测试一个元素，所以只需删除 @。

此外：

*   Level1/Level2/Level3 错误
*   您只测试 VALUE1 但想要测试所有值（可以使用 * 完成）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-24T08:49:25.680

```
<xsl:for-each select="Level1/Level2/Level3">
<MyDates>
    <xsl:if test="VALUE1!=''">
        <value_1>
            <xsl:value-of select="VALUE1"/>
        </value_1>
    </xsl:if>
    <xsl:if test="VALUE2!=''">
        <value_2>
            <xsl:value-of select="VALUE2"/>
        </value_2>
    </xsl:if>
    <xsl:if test="VALUE3!=''">
        <value_3>
            <xsl:value-of select="VALUE3"/>
        </value_3>
    </xsl:if>
    <xsl:if test="VALUE4!=''">
        <value_4>
            <xsl:value-of select="VALUE4"/>
        </value_4>
    </xsl:if>
</MyDates> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-04-17T21:55:23.400

```
<xsl:template match="Dates">
<table border="1">
<tr bgcolor="#9acd32"><th>NAME</th><th>INVALUE</th></tr>
 <xsl:for-each select="Date">
  <xsl:if test="(VALUE1 != '') and (VALUE2 != '') and (VALUE3 != '') and (VALUE4 != '') and (VALUE5 != '')" >
     <tr><td>VALUE1</td><td><xsl:value-of select="VALUE1"></xsl:value-of></td></tr>
     <tr><td>VALUE2</td><td><xsl:value-of select="VALUE2"></xsl:value-of></td></tr>
     <tr><td>VALUE3</td><td><xsl:value-of select="VALUE3"></xsl:value-of></td></tr>
     <tr><td>VALUE4</td><td><xsl:value-of select="VALUE4"></xsl:value-of></td></tr>
     <tr><td>VALUE5</td><td><xsl:value-of select="VALUE5"></xsl:value-of></td></tr>
 </xsl:if>
 </xsl:for-each>
</table>
</xsl:template>
</xsl:stylesheet> 
```

# iphone - 所有父控制器的一个日期选择器 UIViewController

> ID：350645
> 
> 赞同：1
> 
> 时间：2008-12-08T19:50:10.020
> 
> 标签：iphone, objective-c, cocoa-touch

想不出一种直观的方式来解释这个问题的主题，对此我深表歉意。我的问题如下：

我有几个 UIViewController 需要调用 UIDatePicker。我不想多次继承 Date Picker，因为它是同一个接口。我遇到的问题是弄清楚 Cocoa/Objective-C 提供了哪些工具，以便我抽象我的子控制器，因此它不需要知道实例化它的父控制器是谁。父控制器只需要通过将 self 传递给某个子控制器实例变量来告诉子控制器他们是谁。问题在于，如果不导入类的接口文件，子控制器就无法访问父级的方法/实例变量。这再次意味着孩子认识每个打电话给它的父母。

寻找解决此问题的最佳方法，这似乎是非常普遍的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-20T20:38:08.467

如果您正在创建自定义 UIDatePicker 子类，或者您只是在几个不同的自定义 UIViewController 子类中实现 UIDatePicker 委托方法，则问题并不明显。

无论哪种情况，我认为委托和协议的某种组合是您正在寻找的。

> 父控制器只需要通过将 self 传递给某个子控制器实例变量来告诉子控制器他们是谁

这正是委托的用途。在您的 Objective-C 类中将其声明为类型 id。如果您喜欢使用通常的语义，您可以将其设为属性。

```
id delegate; 
```

现在，解决第二个问题：

> 问题在于，如果不导入类的接口文件，子控制器就无法访问父级的方法/实例变量

你肯定不想直接访问 ivars，而在 Objective-C 中，你总是可以向任何对象发送任何消息（你会收到编译器警告，但这不是错误）。

不过，有一种方法可以消除这些警告，称为协议。协议就像一个 Java 接口；它允许您定义方法列表，并且类可以声明它们实现了协议。

创建协议的语法如下所示：

```
@protocol ProtocolName

- (void)sometMethod;

@end 
```

当你声明你的类时，你说它实现了这样的协议：

```
@interface MyClass <MyProtocol> 
```

使用逗号分隔的列表来实现多个协议。

您想知道的最后一个技巧是如何定义一个要求受让人实现特定协议的指针。回到我们之前的委托实现，我们可以添加相同的尖括号语法，它告诉编译器我们期望我们分配的对象来实现这个协议。

```
id<MyProtocol> delegate; 
```

您可以在自己的文件中声明协议，并且只需将该协议文件导入任何使用该协议的类中。您还可以将其与上述 August 的建议结合使用，并在通用基础控制器对象中实现通用功能，让每个自定义控制器子类化该基础。

（协议的另一个概述：[http](http://en.wikipedia.org/wiki/Objective-C#Protocols) ://en.wikipedia.org/wiki/Objective-C#Protocols ）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T20:02:42.007

您可以拥有一个“基本”视图控制器，例如 BaseViewController。该控制器将包含任何特定于日期选择器的代码。然后，所有相关的视图控制器都将成为该基本控制器的子类。根据需要为每个控制器自定义行为，但您仍将在每个控制器中拥有基本的选择器处理代码。如果您为所有这些控制器使用单个 nib，请确保将其“文件所有者”对象类设置为您的 BaseViewController。所有子类仍然可以正常访问笔尖。

# python - 为什么我的 Python C 扩展会泄漏内存？

> ID：350647
> 
> 赞同：6
> 
> 时间：2008-12-08T19:51:04.073
> 
> 标签：python, c, refcounting

下面的函数接受一个 python 文件句柄，从文件中读取打包的二进制数据，创建一个 Python 字典并返回它。如果我无休止地循环它，它将不断消耗 RAM。我的 RefCounting 有什么问题？

```
static PyObject* __binParse_getDBHeader(PyObject *self, PyObject *args){

PyObject *o; //generic object
PyObject* pyDB = NULL; //this has to be a py file object

if (!PyArg_ParseTuple(args, "O", &pyDB)){
    return NULL;
} else {
    Py_INCREF(pyDB);
    if (!PyFile_Check(pyDB)){
        Py_DECREF(pyDB);
        PyErr_SetString(PyExc_IOError, "argument 1 must be open file handle");
        return NULL;
    }
}

FILE *fhDB = PyFile_AsFile(pyDB);

long offset = 0;
DB_HEADER *pdbHeader = malloc(sizeof(DB_HEADER));
fseek(fhDB,offset,SEEK_SET); //at the beginning
fread(pdbHeader, 1, sizeof(DB_HEADER), fhDB );
if (ferror(fhDB)){
    fclose(fhDB);
    Py_DECREF(pyDB);
    PyErr_SetString(PyExc_IOError, "failed reading database header");
    return NULL;
}
Py_DECREF(pyDB);

PyObject *pyDBHeader = PyDict_New();
Py_INCREF(pyDBHeader);

o=PyInt_FromLong(pdbHeader->version_number);
PyDict_SetItemString(pyDBHeader, "version", o);
Py_DECREF(o);

PyObject *pyTimeList = PyList_New(0);
Py_INCREF(pyTimeList);

int i;
for (i=0; i<NUM_DRAWERS; i++){
    //epochs
    o=PyInt_FromLong(pdbHeader->last_good_test[i]);
    PyList_Append(pyTimeList, o);
    Py_DECREF(o);
}
PyDict_SetItemString(pyDBHeader, "lastTest", pyTimeList);
Py_DECREF(pyTimeList);

o=PyInt_FromLong(pdbHeader->temp);
PyDict_SetItemString(pyDBHeader, "temp", o);
Py_DECREF(o);

free(pdbHeader);
return (pyDBHeader);
} 
```

谢谢参观，

拉森MTL

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-08T20:04:32.643

`PyDict_New()`返回一个新的参考，检查[文档](http://docs.python.org/c-api/dict.html)中的`PyDict`. 因此，如果您在创建后立即增加引用计数，则您有两个对其的引用。当您将其作为结果值返回时，一个会转移给调用者，但另一个永远不会消失。

您也不需要 incref `pyTimeList`。当您创建它时，它就是您的。但是，您需要对其进行 decref，但您只需对其进行一次 decref，因此它也会泄漏。

您也不需要调用`Py_INCREF`. `pyDB`这是一个借用的引用，只要你的函数没有返回它就不会消失，因为它仍然在较低的堆栈帧中被引用。

只有当您想将引用保留在另一个结构中的某个地方时，您才需要增加引用计数。

参照。API[文档](http://docs.python.org/c-api/arg.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-08T20:12:44.017

OT：使用连续调用`PyList_Append`是一个性能问题。由于您事先知道将获得多少结果，因此您可以使用：

```
PyObject *pyTimeList = PyList_New(NUM_DRAWERS);
int i;
for (i=0; i<NUM_DRAWERS; i++){
    o = PyInt_FromLong(pdbHeader->last_good_test[i]);
    PyList_SET_ITEM(pyTimeList, i, o);
} 
```

请注意，您可能不会减少`o`after call的引用计数`PyList_SET_ITEM`，因为它“窃取”了引用。检查[文档](http://docs.python.org/c-api/list.html)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-08T20:18:09.497

我不知道 Python-C。但是，我对 COM 引用计数的经验表明，新创建的引用计数对象的引用计数为**1**。所以你的 Py_INCREF(pyDB) 在 PyArg_ParseTuple(args, "O", &pyDB) 和 PyObject *pyDBHeader = PyDict_New(); 是罪魁祸首。他们的引用计数已经是 2。

# c# - C#/Winform：在 HTML 页面中输入数据，提交表单

> ID：350649
> 
> 赞同：2
> 
> 时间：2008-12-08T19:51:17.630
> 
> 标签：c#, multithreading, http, interop, backgroundworker

我有一个带有 BackgroundWorker 的 Winform。BackgroundWorker，除其他外，必须对页面进行 HTTP 调用，填写一些数据，提交表单，并检索“单击”提交按钮后返回的 HTML。在执行此操作时，我遇到了许多障碍：

1.  无法发布数据，因为目标网络服务器不 405 支持该方法。
2.  再次不能使用 WebClient.UploadValues，因为网络服务器不支持 POST。
3.  无法使用 WebBrowser 控件，因为 BackgroundWorkers 在 COM 互操作方面很糟糕，并且引发了一个异常，表明它必须在 STA 线程中（单线程单元）
4.  无法运行另一个单独的线程，因为 BW 必须坐下来等待结果才能继续（不能，或者至少我不知道一种不会崩溃的方法）
5.  无法更改线程的 ApartmentState，因为它是 BackgroundWorker，如果被告知进入 STA 模式，它会抛出

我应该怎么做才能解决这个问题？

[编辑]：应用入口点已经用 [STAThread] 属性标记。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T20:02:45.220

您是否尝试过使用[WebClient.UploadValues](http://msdn.microsoft.com/en-us/library/system.net.webclient.uploadvalues(VS.80).aspx)并将 Method 参数设置为 "GET" ？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T19:58:57.227

不要使用后台工作人员？

如果你这样做，你可以将 ApartmentState 设置为你想要的。只需记住在将数据推回任何表单控件时调用/BeginInvoke。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T20:03:42.397

在这种情况下不支持 POST 的网络服务器是什么？可比较的 HTML 表单有什么作用？POST 还是 GET？做同样的事情。我怀疑 WebClient 或 HttpWebRequest 会做得很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T20:03:58.573

我很不确定你到底在问什么。如果你运行一个后台进程并且它失败了，你会通过 RunWorkerCompletedEvent 得到这个报告。如果您然后查看事件参数，您可以判断该过程是否成功（通过 RunWorkerCompletedEventArgs.Error 属性）。

根据错误，您可以重新启动您的请求或向用户显示错误。

我希望我没有完全偏离轨道。

# svn - 如何使用 git-svn 使 svn:external 保持最新？

> ID：350651
> 
> 赞同：52
> 
> 时间：2008-12-08T19:52:06.773
> 
> 标签：svn, git, version-control, dvcs

将我的存储库视为 SVN 存储库，我得到：

```
svn co http://myrepo/foo/trunk foo
...
foo/
  bar/
  baz/ -> http://myrepo/baz/trunk 
```

将其视为 Git 存储库，我得到：

```
git svn clone http://myrepo/foo --trunk=trunk --branches=branches --tags=tags
...
foo/
  bar/ 
```

我可以将 baz 克隆到其他地方的本地计算机并添加符号链接，但这只是一个 hack。有没有办法`git svn rebase`在更新其他所有内容时自动提取这些更改，就像这样`svn up`做一样？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-08T21:31:23.233

我见过的将 svn externals 与 git-svn 集成的最佳方法是这个[脚本](http://github.com/andrep/git-svn-clone-externals/tree/master)，它将你的 externals 克隆到 .git_externals/ 目录中，并创建你需要的符号链接和排除文件。我发现这是一个简单直接的解决方案。YMMV。

这是使用 git-svn 处理 svn 外部的其他选项的[较旧概述。](http://panthersoftware.com/articles/view/3/svn-s-svn-externals-to-git-s-submodule-for-rails-plugins)在我看来，它们看起来有点过于复杂，并且在随后的 Git 使用中容易崩溃。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-01-23T18:47:45.377

我最终使用的解决方案只是符号链接到`git-svn`我本地盒子上的其他克隆。这工作得很好：它允许我提交更改，它允许我在项目 A 上进行本地更改，只是为了让它们进入项目 B。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-11-07T17:45:02.183

我刚刚编写了一个简短的脚本，它将所有`svn:externals`当前文件检出`HEAD`到根目录并将它们从 git 存储库中排除。

将它放置到`.git/hooks/post-checkout`它会在工作树发生变化时保持这些外部结帐是最新的，例如由于`git svn rebase`or `git-checkout`。

```
#!/bin/bash
set -eu

revision=$(git svn info | sed -n 's/^Revision: \([1-9][0-9]*\)$/\1/p')
git svn -r${revision} propget svn:externals | head -n-1 | {
    while read checkout_args
    do
        checkout_dirname=$(echo ${checkout_args} | cut -d' ' -f3)
        svn checkout ${checkout_args}
        if [ -z $(grep ${checkout_dirname} .git/info/exclude) ]
        then
            echo ${checkout_dirname} >> .git/info/exclude
        fi
    done
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-04-09T17:42:19.570

我还为我制作了一个脚本（Perl 和 Ruby 变体都可用），它位于[http://github.com/liyanage/git-tools/](http://github.com/liyanage/git-tools/)。

*   递归检查所有 svn:externals
*   可以重复运行，以防大型存储库的克隆中途中止。发生在我身上很多。它从中断的地方继续。
*   将它找到并处理的所有 svn:externals 条目添加到 .git/info/exclude
*   将遇到的所有 svn:ignore 条目添加到 .git/info/exclude
*   可以在第一次运行后定期运行 svn:rebase 在所有克隆的子沙箱中，发现新的外部和新的 svn:ignores

更新：我不再维护这个脚本。它的递归克隆和更新 SVN 存储库的功能以及其他与 git 相关的功能在我正在积极维护的这个较新的项目中可用：http: [//liyanage.github.com/git-tools/](http://liyanage.github.com/git-tools/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-01-21T13:46:44.070

仅作记录：我遵循[了这个](https://stackoverflow.com/a/11520782/158074)建议并尝试使用[SmartGit](http://www.syntevo.com/smartgithg/index.html)处理`svn:externals`.

SmartGit 是迄今为止我见过的 Git 最好的 GUI 客户端。关于`svn:externals`，它不仅正确地获取它们，而且还提供了对外部存储库进行“快速快照”（只读，仅 HEAD 克隆）的选项。

不幸的是，它不能免费用于商业用途（而且我发现许可证价格有点太高了——是的，我是个小气鬼）。不过，它可以免费用于非商业目的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-08-18T16:37:35.497

我决定编写一个“简单”的 perl 脚本来为我处理所有这些事情。我最近把它放到了github上，试试看，也许会有所帮助：http: [//github.com/sushdm/git_svn_externals/](http://github.com/sushdm/git_svn_externals/)。

它本质上为所有找到的外部对象执行 git-svn clone，它递归地查找它们，克隆它们，将它们符号链接到适当的位置，并排除所有 .git_externals 目录和符号链接，以便您仍然可以使用“git svn dcommit”。

祝你好运。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-03-10T17:27:19.890

试试这个 python 脚本[https://bitbucket.org/nytmyn/gitsvnext/overview](https://bitbucket.org/nytmyn/gitsvnext/overview)

签出 svn externals 在您的 git 存储库中运行以下命令

```
python /../gitsvnext/run update 
```

运行它以知道将什么放入 .git/info/exclude

```
python /../gitsvnext/run list 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-08-03T03:14:42.800

这就是我所做的。

首先，我创建了一个空的 SVN 存储库（与 git 相同的根目录）：

```
svn checkout --depth empty http://path/to/repo . 
```

这在 git 根目录中创建了空的 svn 存储库。关键是它包含 SVN 外部属性。

接下来我只检查外部（我放在 PATH cygwin 工具中）：

```
svn propget svn:externals | sed -e 's/ / .\//' | sed -e 's/\'//g' | xargs -L1 svn co 
```

# asp.net - 如何将 Enter 键与 aspx 页面上的按钮相关联？

> ID：350655
> 
> 赞同：5
> 
> 时间：2008-12-08T19:52:27.443
> 
> 标签：asp.net, ascx

我有一个 asp.net ascx 控制文件，我已将控件放在一个 aspx 页面上。aspx 页面有一个按钮，当我在键盘上按 Enter 时，我希望它触发该按钮的事件处理程序。有没有办法设置这个？

我正在使用一个带有按钮的母版页，所以现在当我按下回车键时，该按钮的事件处理程序就会触发。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-08T20:09:58.997

DefaultButton 也适用于面板，因此您可以在每个面板中设置一个默认按钮，并让 Enter 键单击当前具有焦点的任何面板中的按钮。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T19:55:47.933

这在 IE 中很微妙。您需要向控件添加一个文本框，将显示设置为无，并将可见性设置为隐藏，这不应该影响控件的外观，因为此文本框将被隐藏，输入应该正常工作，这是一个 IE 问题

编辑：如果您使用引入 defaultButton 的 .NET 2.0，请忽略这一点

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T19:55:19.917

试试这个：

```
<form id="form1" runat="server" defaultbutton="myButton"> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-08T19:57:48.570

Page.Form.DefaultButton -[此处为 msdn 链接](http://msdn.microsoft.com/en-us/library/system.web.ui.htmlcontrols.htmlform.defaultbutton.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-14T09:00:15.027

只是一个小提示：如果您的按钮是 LinkBut​​ton，则不能使用“defaultButton”属性，它不适用于此，取自此处：http: [//msdn.microsoft.com/en-us/library/system。 web.ui.htmlcontrols.htmlform.defaultbutton.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.htmlcontrols.htmlform.defaultbutton.aspx)

# asp.net - 显示国际文本

> ID：350659
> 
> 赞同：2
> 
> 时间：2008-12-08T19:54:26.907
> 
> 标签：asp.net, gridview, unicode, character-encoding, globalization

我希望创建一个 ASP.net 页面，该页面将具有 GridView 或 Repeater 之类的控件，并且要在此页面中显示的数据可以是 unicode 或 Utf-8 。我真的很难显示像希伯来语和一些亚洲语言这样的语言。

如何在 ASP.net 页面上显示任何类型的语言？我已尝试使用元标记选项和 <@ Page> 选项来设置编码，但它不起作用。我错过了什么？？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T20:13:35.963

理想情况下，这一切都应该由您的环境透明地处理。不幸的是，“环境”还为您提供了一些工具来搞砸事情。

有两件事需要发生。您的服务器需要知道它应该发送给客户端的编码是什么，而浏览器需要知道该编码是什么。通常，IIS 设置为发出 UTF-8，这正是您想要的，句号。

如果您通过[http://web-sniffer.net/](http://web-sniffer.net/)之类的方式查看其中一个页面的标题，您可以看到您的服务器告诉浏览器它正在发送什么。您可以也应该发送指定相同编码 (UTF-8)的[HTML 元标记。](http://www.w3.org/International/O-charset "HTML 元标记")

您还可以在 web.config 中指定编码，并且大概在 ASP.Net 页面声明中。但是，这应该是多余的。

您无需在任何服务器端编写器中指定此编码，只要您使用当前 http 上下文传递给您的编码即可。

围绕从右到左的语言可能存在更多可能需要额外调整的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T20:09:06.160

确保 Response.Charset = UTF-8。

# windows - Vim: \n 与 \r

> ID：350661
> 
> 赞同：26
> 
> 时间：2008-12-08T19:55:11.307
> 
> 标签：windows, unix, vim

我有一段时间没有在 Unix 系统中使用 vim，但我记得没有 \r，它总是 \n。

我在 Windows 下使用 gVim，当我*搜索*换行符时，我使用 \n。搜索 \r 不会返回任何内容。但是当我*替换*字符时，我必须使用 \r's。\n给我^@

谁能解释这里发生了什么？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-12-08T20:37:10.970

看起来你在问两件事。一个问题是`\r`与`\n`其他人已经涵盖的问题。

另一个问题是`\n`在替换的右侧。如果您查看`:h s/\n`，它表示`\n`在替换的替换部分插入`<NUL>`/ `<NL>`，而不是换行符。

如果您执行 a`:%s/\n/\n/`并在十六进制编辑器中保存并打开文件，则所有`^@`字符都是 ASCII 0（NUL 字符）。为什么 Vim 开发人员使用`\n`左侧表示行尾而`\n`右侧表示 NUL，这超出了我的理解。但这种特殊行为与 Windows 与 Unix 无关。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-12-08T20:24:20.543

查找：

```
:set fileformat=unix
:set fileformat=dos 
```

这可以在任一平台上使用以切换到其他编码。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-04T21:18:55.680

在幕后，Vim 使用 \r （回车）来保存行尾（无论文件格式如何，这仅在文件被读取或写入时才重要）。Vim 使用 \n 来表示 NUL。但是，您将 EOL 搜索为 \n，但在替换中，\n 代表 NUL。它在 :h sub-replace-sepcial 中有解释。搜索 \r 将找到不属于文件格式 EOL 的回车符。:h 文件格式有很长的解释。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-08T20:21:43.060

vim 对回车符 (\r) 和换行符 (\n) 做了一些处理。例如，如果您在 Unix 中并且 vi 显示以 '^M' 结尾的行，因为它们是 Windows 文本文件，那么摆脱它们的简单方法是输入命令

```
:%s/^V^M/^V^M/g 
```

它看起来不应该做任何事情，但它确实可以。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-08T21:29:15.717

> ```
> :%s/^V^M/^V^M/g 
> ```

类似地，以下做同样的事情（我认为），并且更容易输入。

```
:%s/\r/\r/g 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-08T20:01:52.650

在 unix 下，在 vim 中，`^V`+`<enter>`给了我一个`^M`字符`\r`。

此外，除非您告诉 vim 以二进制模式编辑文件，否则您无法`\r`在 vim 中找到文件，也就是说，不使用自动检测行尾的默认自动模式。（它应该打印`[dos]`在状态中。）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-08T20:06:58.550

我认为问题可能在于 Windows 和 Unix 换行的方式。Unix 的格式是 \n（换行），但对于 Windows，它是 \r\n（回车，换行）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-08T20:20:43.360

在 Windows 中，如果您以文本模式打开文件，\n 将被解释为换行符和换行符。*nix 系统通常不是这种情况。

# specifications - 这里谁实际上保持他们的项目规范是最新的？

> ID：350679
> 
> 赞同：0
> 
> 时间：2008-12-08T19:59:09.283
> 
> 标签：specifications

是的，当我们阅读项目规范以及它们如何帮助保持项目**按时**并**在范围内**等时，我们都会感到**温暖和模糊。**

 ****这里有谁真正为一家保持最新规范的公司工作？

如果这样做，这是什么原因？是您拥有庞大团队的主要原因吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T20:09:58.623

Cor..**什么是项目规范？**

我们倾向于从具有明确时间表等的想法开始，然后销售团队与客户交谈并承诺地球。然后我们的项目规范就消失了！

因此，我们不维护项目规范主要是因为：

*   销售承诺太多。
*   我们有一个小团队，没有太多时间可以用来编写文档。
*   我们经常不得不非常快速地（通常是尽快）扭转任何变化，这使得几乎没有时间更新任何文档（如果有的话）！

我认为这一切都好吗？**不！**但在这个时候，我们很难找到出路！有很多事情要做（明智的工作和流程改进）。

我的家庭项目似乎要好得多，但我的规格也宽松得多，而且我知道我是如何工作的——因此我可以让这个过程更适合我。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T20:15:20.703

如果您使用 TDD，那么您应该有一个根据定义始终是最新的规范。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T20:01:01.060

如果它在您召开团队会议的白板上，那么您就是金子。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T11:44:37.940

项目规范很少保持最新这一事实是重新考虑其形式的一个强有力的理由，至少当它们以印刷文档的形式呈现时。我对这些东西最痛苦的经历是，它们通常在印刷和分发之前就已经过时了。此后的每个人都可能在经过手工注释后拥有不同的版本。

无论如何，“项目规范”的目的是什么？我想它可能包括部分或全部

*   建筑学
*   业务需求
*   性能限制
*   外部接口
*   法律约束

可能还有更多。如果不考虑在编码开始之前尝试修复上述所有问题的（可疑）智慧，如果任何这些类别在项目生命周期内没有改变，我会感到惊讶，对于任何大到足以编写规范的项目。

有什么方法可以以可执行测试的形式交付给定的要求？如果需求不能以一组定义满足需求的测试的形式表达，那么它可能根本就不是一个很好表达的需求，因此规范是不完整的。

我想知道像 Ward Cunningham 的[FIT 框架](http://fit.c2.com/)之类的东西可能不是更好的做事方式吗？因此，标准保存在 Wiki 中，在同一页面上定义接受度的测试。

什么样的系统或项目不会受到这种方法的影响？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T20:11:07.827

最好的方法是提取 func 的相关位。/ 设计规范。然后将它们作为“标题”包含在实际代码中。

然后可以使用 Javadoc 或类似的方法提取这些标头。

这样，开发人员可以在更新代码时更新“标题”，并使整个项目保持同步。

对我们来说很有效。

# wpf - 在 WPF 中创建 DIP 开关控件

> ID：350686
> 
> 赞同：0
> 
> 时间：2008-12-08T20:01:24.303
> 
> 标签：wpf, xaml, user-controls, properties

为了让自己更多地了解 WPF，我正在尝试构建一个简单的应用程序。在我工作的地方，我们有一些硬件有一组 8 个 DIP 开关，用于设置从 0 到 255 的地址（作为 8 位数字）。这是一个简单的概念，我想将它构建到 WPF Windows 应用程序中，允许用户查看给定地址的 DIP 开关设置。我在 WinForms 中构建了一个类似的应用程序，它可以简单地显示/隐藏 DIP 开关的图片。我想将它移植到 WPF 并做一些更优雅的事情。

我用字符串和数字完成了一些简单的数据绑定，使它们显示在标签中，并且我已经完成了一些关于用户控件的介绍性工作。

我想做的是创建一个模拟单个 DIP 开关的用户控件，该控件将具有一个布尔值 true 或 false 的“State”属性。然后我可以将其中的 8 个放在我的窗口中并将它们绑定到我的代码。

在 XAML 中，我将绘制 DIP 开关，滑动部分将根据 State 属性的真/假值移动到打开或关闭位置。一旦我弄清楚了，也许我可以稍后制作动画。

在这一点上，我正在寻找一个概念概述......我将如何在用户控件中创建这个属性，并让它的值影响图形开关的位置？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T09:22:17.977

您可以通过替换 CheckBox 的模板轻松创建 DIP 开关控件，如果您想知道如何创建自己的模板化控件，请阅读 Charles Petzold 在[http://msdn.microsoft.com/en上的“Templates for Uncommon Controls” -我们/杂志/cc135986.aspx](http://msdn.microsoft.com/en-us/magazine/cc135986.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T20:22:24.090

您可以这样做的一种方法是使用控件模板来自定义 WPF RadioButton 类的外观。单选按钮控件模板的代码[可在 msdn 上找到](http://msdn.microsoft.com/en-us/library/ms751600.aspx)。

您应该能够创建自己的 UserControl，然后将此代码粘贴到 UserControl.Resources 节点中，然后开始修改 RadioButton 的外观，同时保留其所有属性，这应该使其易于用作布尔指示器.

“子弹”的样式可以很容易地被翻转或未翻转的 DIP 开关的图像或矢量图形替换。

> ID：350697
> 
> 赞同：
> 
> 时间：
> 
> 标签：

None

# shell - 文件中的 Shell 脚本编号行

> ID：350701
> 
> 赞同：4
> 
> 时间：2008-12-08T20:05:48.053
> 
> 标签：shell, sed, awk

我需要找到一种更快的方法来使用 awk 和 sed 等工具以特定方式对文件中的行进行编号。我需要以这种方式对每行的第一个字符进行编号：1,2,3,1,2,3,1,2,3 等。

例如，如果输入是这样的：

```
line 1
line 2
line 3
line 4
line 5
line 6
line 7 
```

输出需要如下所示：

```
1line 1
2line 2
3line 3
1line 4
2line 5
3line 6
1line 7 
```

这是我所拥有的一部分。$lines 是数据文件中的行数除以 3。因此，对于 21000 行的文件，我处理此循环 7000 次。

```
export i=0
while [ $i -le $lines ]
do
    export start=`expr $i \* 3 + 1`
    export end=`expr $start + 2`
    awk NR==$start,NR==$end $1 | awk '{printf("%d%s\n", NR,$0)}' >> data.out
    export i=`expr $i + 1`
done 
```

基本上，这一次抓取 3 行，对它们进行编号，然后添加到输出文件中。它很慢......然后一些！我不知道另一种更快的方法来做到这一点......有什么想法吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-08T20:12:25.030

试试这个`nl`命令。

请参阅[https://linux.die.net/man/1/nl](https://linux.die.net/man/1/nl)`man nl` （或另一个链接，指向您在谷歌搜索“man nl”时出现的文档或在 shell 提示符下运行时出现的文本版本）。

> 如果省略了文件参数，nl 实用程序从命名文件或标准输入读取行，应用可配置的行编号过滤操作并将结果写入标准输出。

**编辑：**不，那是错误的，我很抱歉。该`nl`命令没有重新开始每`n`行编号的选项，它只有在找到模式后重新开始编号的选项。我会将这个答案设为社区 wiki 答案，因为它可能会帮助某人了解`nl`.

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-08T20:19:40.990

这很慢，因为您一遍又一遍地阅读相同的行。此外，您启动一​​个`awk`进程只是为了将其关闭并启动另一个进程。最好一次完成整个事情：

```
awk '{print ((NR-1)%3)+1 $0}' $1 > data.out 
```

如果您希望在数字后有一个空格：

```
awk '{print ((NR-1)%3)+1, $0}' $1 > data.out 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-08T20:09:43.757

想到 Perl：

```
perl -pe '$_ = (($.-1)%3)+1 . $_' 
```

应该管用。毫无疑问，有一个 awk 等价物。基本上，`((line# - 1) MOD 3) + 1`.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-11-21T23:55:00.143

这可能对您有用：

```
 sed 's/^/1/;n;s/^/2/;n;s/^/3/' input 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-10-24T14:25:21.700

另一种方法是使用 grep 并匹配所有内容。例如，这将枚举文件：

```
grep -n '.*' <<< `ls -1` 
```

输出将是：

```
1:file.a
2:file.b
3:file.c 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-08T20:19:36.263

```
awk '{printf "%d%s\n", ((NR-1) % 3) + 1, $0;}' "$@" 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-08T20:23:54.413

Python

```
import sys
for count, line in enumerate(sys.stdin):
    stdout.write( "%d%s" % ( 1+(count % 3), line ) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-04T14:30:36.673

你不需要为此离开 bash：

```
i=0; while read; do echo "$((i++ % 3 + 1)) $REPLY"; done < input 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-10T04:17:42.180

这应该可以解决问题。$_ 将打印整行。

```
awk '{print ((NR-1)%3+1) $_}' < input
1line 1
2line 2
3line 3
1line 4
2line 5
3line 6
1line 7

# cat input 
  line 1
  line 2
  line 3
  line 4
  line 5
  line 6
  line 7 
```

# c# - 你对 C# 缩小有什么建议吗？

> ID：350705
> 
> 赞同：3
> 
> 时间：2008-12-08T20:07:04.010
> 
> 标签：c#, xaml, minify

我需要在一些 Silverlight .cs 和 .xmal 文件中缩小一些 C# 代码。对于维护一个代码库并运行“工具”来为项目生成缩小代码，您有什么技巧？

是否有任何工具（如 Resharper）可以做到这一点？如果不是完全，部分或以某种方式提供帮助......

编辑：我意识到不需要 C# 缩小。这是我正在做的一个练习，从表面上看没有任何意义。（这不是家庭作业。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T20:29:18.070

源代码混淆器怎么样？它们通常缩写名称等 - 当然会删除空格。

例如，[here](http://www.semdesigns.com/Products/Obfuscators/CSharpObfuscator.html)和 demo [here](http://www.semdesigns.com/Products/Obfuscators/CSharpObfuscationExample.html)（尽管您可能希望尽可能禁用字符串编码）。请注意，这不是直接推荐：这只是我第一次使用[C# code obfuscator](http://www.google.com/search?q=c%23+code+obfuscator)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T20:10:24.973

那有必要吗？据我了解，编译后的 .Net 程序集将通过网络发送，而不是 C#（或任何语言）源代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-05T05:03:54.260

以下是来自其他 10k 参赛者的两个“经验教训”帖子：

[关于 MIX 10K 挑战的思考](https://web.archive.org/web/20110104170434/http://www.bluerosegames.com/SilverlightBrassTacks/post/Thoughts-on-the-MIX-10K-challenge.aspx)

[MIX09 10K 智能编码挑战](http://bragosphere.blogspot.com/2009/01/blog-post.html)

# asp.net - 上传前设置文件路径和名称属性

> ID：350734
> 
> 赞同：2
> 
> 时间：2008-12-08T20:15:59.593
> 
> 标签：asp.net, file-upload

如果您知道希望最终用户上传的文件的本地路径和文件名（通过浏览器）。那么是否可以为 HTML 文件输入元素（或任何上传控件）预先设置这些属性？因此，当用户单击“浏览”以选择要上传的文件时，对话框已预先选择了文件名。

顺便说一句，假设这是针对本地存在必要目录/文件的 Intranet。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T20:20:19.057

除非它是自定义上传控件，否则出于安全原因不能这样做。

如果一个 html 页面可以设置使用 javascript 上传的文件，例如，任意 html 页面可以从客户端计算机上传任何文件（可以通过 javascript 触发表单提交）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T20:17:24.973

出于安全原因，这种与文件上传控件的交互类型被禁用。

# .net - 如何查看“原始”PNG 图像数据

> ID：350736
> 
> 赞同：2
> 
> 时间：2008-12-08T20:16:23.760
> 
> 标签：.net, png, c#-2.0, bmp

我正在尝试编写一个将每像素 48 位 PNG 文件转换为专有（拜耳）格式的应用程序。

下面的代码（[此处](http://www.devsource.com/c/a/Languages/Image-Processing-in-C/)提供）适用于某些 PNG 文件格式，但是当我尝试真正的 48 位 PNG 时，代码会引发异常 - 是否有替代方案？

```
 static public byte[] BitmapDataFromBitmap(Bitmap objBitmap)
    {
        MemoryStream ms = new MemoryStream();
        objBitmap.Save(ms, ImageFormat.BMP);  // GDI+ exception thrown for > 32 bpp
        return (ms.GetBuffer());
    }

    private void Bayer_Click(object sender, EventArgs e)
    {
        if (this.pictureName != null)
        {
            Bitmap bmp = new Bitmap(this.pictureName);
            byte[] bmp_raw = BitmapDataFromBitmap(bmp);
            int bpp = BitConverter.ToInt32(bmp_raw, 28); // 28 - BMP header defn.

            MessageBox.Show(string.Format("Bits per pixel = {0}", bpp));
        }
    } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T20:46:05.680

BMP 编码器不支持 48bpp 格式。您可以使用 Bitmap.LockBits() 方法对像素进行破解。虽然 PixelFormat 的 MSDN 库文章说 48bpp 被视为 24bpp 图像，但我确实看到了 6 字节像素与此代码：

```
 Bitmap bmp = new Bitmap(@"c:\temp\48bpp.png");
  BitmapData bd = bmp.LockBits(new Rectangle(0, 0, bmp.Width, bmp.Height),
    ImageLockMode.ReadOnly, PixelFormat.Format48bppRgb);
  // Party with bd.Scan0
  //...
  bmp.UnlockBits(bd); 
```

# svn - 如何将 git log（或 svn log）限制为与特定文件有关的修订？

> ID：350753
> 
> 赞同：11
> 
> 时间：2008-12-08T20:21:27.213
> 
> 标签：svn, git, logging

我想查看文件的一系列差异。我会满足于简单的日志列表，仅限于那些修改文件的条目。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-08T20:32:18.297

`svn log filename`

或者

```
svn log URL 
```

我还建议添加`--limit N`以仅显示最近的条目：

```
svn log main.cpp --limit 4 
```

这些可以应用于文件或项目，顺便说一句。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-08T20:25:29.950

`git log [filename]`. 如果你想看看发生了什么变化，`git log -p [filename]`.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-08T20:28:16.653

单个文件的 SVN 日志

> svn 日志文件名.php

SVN diff 用于修订 1033 和 1191 之间文件的更改

> svn -r 1033:1191 差异文件名.php

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-22T15:35:47.503

就 SVN 而言，如果当前版本中不存在相关文件，您还需要指定一个 peg 版本：

`svn log path@some_revision_where_the_path_existed`

如果省略 peg 修订，则默认为 HEAD（对于 url）或 BASE（对于工作副本路径）。

另请注意，如果文件已被删除并随后在没有将其连接到旧文件的历史记录的情况下复活（信不信由你，我已经看到这种技术在应用深度重构或技术转变时有充分的理由应用），svn日志将仅显示与该特定挂钩修订相关的更改。

如果您想查看与特定路径相关联的所有更改，您必须执行存储库根目录的 svn log -v，然后通过更改的路径过滤结果。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-04-09T10:08:46.917

Git：如果文件从当前分支中删除（或者被 Git 视为模棱两可的参数）：

```
git log -- [filename] 
```

# c++ - Emacs 和 C++

> ID：350768
> 
> 赞同：3
> 
> 时间：2008-12-08T20:24:58.670
> 
> 标签：c++, emacs

又到了清理我的 emacs 设置的时候了。在我清理它之前，您是否会推荐任何超越 c++-mode、cedet、ecb、speedbar 等的软件包？尤其是过去五年中的新事物。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T22:57:53.387

[这可能会有所帮助！](https://stackoverflow.com/questions/271924/what-is-your-favourite-plugin-in-emacs)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-08T13:48:14.027

你可能会喜欢我为 C 编程添加的一些东西，包括夹板、cdecl、scons 对制作项目的支持和 xcscope。

[http://richardriley.net/default/projects/emacs/dotprogramming](http://richardriley.net/default/projects/emacs/dotprogramming)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T06:59:23.727

I use msf-abbrevs package for inserting code snippets as i type special code words - something like for, if, etc, but with highliting of positions, that should be filled out, and moving between them with TAB key

# javascript - TinyMCE - 从单词粘贴

> ID：350777
> 
> 赞同：7
> 
> 时间：2008-12-08T20:28:31.910
> 
> 标签：javascript, content-management-system, ms-word, tinymce

我正在尝试配置 TinyMCE，以便它接受来自 Microsoft Word 的粘贴并在预期的 HTML 层次结构中清理它。

我们的大部分编辑人员使用单换行符表示换行符，使用双回车符表示段落。但是，MS Word 的输出将下一行放在一个单独的段落中（除非您按 shift-enter 进行回车）和一个空白段落，其中包含两个回车的不间断空格。有没有办法清理这个输入？我试过玩插件，但找不到任何神奇的组合。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-09T05:36:38.760

我在[这个插件](http://www.tinymce.com/wiki.php/Plugin:paste)上取得了成功。

# sql - SQL查询从日志表计算访问持续时间

> ID：350780
> 
> 赞同：1
> 
> 时间：2008-12-08T20:29:24.340
> 
> 标签：sql, mysql, duration

我有一个带有字段 ID、PLAYER、TIMESTAMP 和 ACTION 的 MySQL 表 LOGIN_LOG。ACTION 可以是“登录”或“注销”。只有大约 20% 的登录有伴随的注销行。对于那些这样做的人，我想计算平均持续时间。

我在想类似的东西

```
select avg(LL2.TIMESTAMP - LL1.TIMESTAMP)
from LOGIN_LOG LL1
inner join LOGIN_LOG LL2 on LL1.PLAYER = LL2.PLAYER and LL2.TIMESTAMP > LL1.TIMESTAMP
left join LOGIN_LOG LL3 on LL3.PLAYER = LL1.PLAYER
  and LL3.TIMESTAMP between LL1.TIMESTAMP + 1 and LL2.TIMESTAMP - 1
  and LL3.ACTION = 'login'
where LL1.ACTION = 'login' and LL2.ACTION = 'logout' and isnull(LL3.ID) 
```

这是最好的方法，还是有更有效的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T20:41:50.667

鉴于您拥有的数据，您可能无法做任何更快的事情，因为您必须查看 LOGIN 和 LOGOUT 记录，并确保两者之间的同一用户没有其他 LOGIN（或 LOGOUT？）记录.

或者，找到一种方法来确保断开连接记录注销，以便数据完整（而不是 20% 完整）。但是，查询可能仍然必须确保满足所有条件，因此它不会对查询有太大帮助。

如果你能把数据变成LOGIN和相应的LOGOUT时间都在同一条记录中的格式，那么你可以极大地简化查询。我不清楚 SessionManager 是否为您这样做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T20:35:10.413

你有一个可以使会话超时的 SessionManager 类型的对象吗？因为可以在那里记录超时，并且您可以从中获取上次活动时间和超时时间。

或者您记录网站/服务上的所有活动，因此您可以直接查询网站/服务访问时长，并查看他们执行了哪些活动。对于网站，Apache 日志分析器可能会生成所需的统计信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T20:40:24.770

我同意 JeeBee，但 SessionManager 类型对象的另一个优点是您可以处理 sessionEnd 事件并编写一个包含活动时间的注销行。这样，您可能会从 20% 的伴随注销行变为 100% 的伴随注销行。对于所有会话，查询活动时间将变得微不足道且一致。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T20:42:27.153

如果只有 20% 的用户实际注销，则此搜索不会为您提供每个会话的非常准确的时间。衡量平均用户会话时长的更好方法是计算操作之间的平均时间，或 avg。每页时间。然后，这可以乘以每次访问的平均页面/操作数，以提供更准确的时间。

此外，您可以确定平均值。每个页面的时间，然后让您的会话结束时间 = 到该点的会话时间 + 在他们最后一页上花费的平均时间。这将为您提供更细粒度（和准确）的每次会话花费的时间测量。

关于给定的 SQL，它似乎比您真正需要的要复杂。这种统计操作通常可以在数据库外部的代码中更好地处理/更易于维护，您可以在其中拥有您选择的任何语言的全部功能，而不仅仅是 SQL 用于统计计算的相当复杂的能力

# mysql - 在 MySQL 中使用十六进制数字

> ID：350787
> 
> 赞同：11
> 
> 时间：2008-12-08T20:34:12.617
> 
> 标签：mysql, hex

我有一个存储过程，需要将十六进制数转换为等效的十进制数。我已经阅读了 UNHEX() 函数的文档，但它返回的是一个二进制值。我想做的是这样的：

```
CREATE PROCEDURE foo( hex_val VARCHAR(10) )
BEGIN
    DECLARE dec_val INTEGER;

    SET dec_val = UNHEX( hex_val );

    -- Do something with the decimal value
    select dec_val;
END 
```

我错过了什么？如何将 UNHEX() 的值转换为无符号整数？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-12-08T20:40:55.723

您可以使用该[`CONV()`](http://dev.mysql.com/doc/refman/5.0/en/mathematical-functions.html#function_conv)功能在碱基之间进行转换。

```
SET dec_val = CONV(hex_val, 16, 10); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-08T20:39:43.057

```
conv(hex_val, 16, 10) 
```

将以 16 为底的数字转换为以 10 为底的数字。 UNHEX 函数做了完全不同的事情，它将成对的十六进制数字转换为字符。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-04-09T09:25:53.227

cast(conv(hex_val, 16, 10) as unsigned integer) 应该可以解决问题....

# ruby - apache的ProxyRemote可以用来代理HTTPS请求到mongrel进行处理吗？

> ID：350789
> 
> 赞同：1
> 
> 时间：2008-12-08T20:34:44.767
> 
> 标签：ruby, apache, mongrel

所以我有一个用 ruby​​ 编写的自定义代理，它使用 mongrel 来处理一些相当复杂的缓存逻辑。这对 http 和 ftp 请求都很有效，但是由于 mongrel 不是为处理 https 请求而设计的，所以我希望将整个事情放在 apache 前面，并使用 ProxyRemote 命令传递给 mongrel 以处理 https 请求。

这类事情很容易通过 apache 中的 ProxyPass 和 ProxyPassReverse 命令镜像某些站点目录结构，但我看不到使用 ProxyRemote 的方法。

问题是 mongrel 不处理为建立安全请求而发出的 CONNECT 请求。因此，虽然我能够在代理本身内处理 https 请求，但实际上不支持直接将代理与 https 请求一起使用。

似乎最简单的解决方案是让 apache 处理 https 请求，然后简单地将 http 请求本身（减去 CONNECT）传递给 mongrel 并让它适当地处理它并将其返回给 apache，然后返回给客户端。

所以我的问题是，有没有办法让 ProxyRemote 的工作方式与 ProxyPass 处理 HTTP 请求的方式相同（即将未加密的请求传递给 mongrel）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-01T23:18:16.190

Just use ProxyPass and ProxyPassReverse, the connection between your reverse proxy (apache) and your mongrel will see normal plain http :), no magic necessary (especially not CONNECT, afaik thats only possbile for forward proxies, but I'm not sure).

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T20:40:36.860

哼，你试过吗？

我一直在使用 apache 来执行 https 并使用旧的默认 .htaccess mod_rewrite 规则传递请求。

# java - 如何使用 Apache Commons 以多部分形式读取其他参数

> ID：350794
> 
> 赞同：4
> 
> 时间：2008-12-08T20:35:47.043
> 
> 标签：java, apache-commons, multipartform-data

我有一个文件上传表单，该表单被发布回 servlet（使用 multipart/form-data 编码）。在 servlet 中，我尝试使用 Apache Commons 来处理上传。但是，我在表单中还有一些其他字段，它们只是普通字段。如何从请求中读取这些参数？

例如，在我的 servlet 中，我有这样的代码可以在上传的文件中读取：

```
 // Create a factory for disk-based file items
    FileItemFactory factory = new DiskFileItemFactory();
    // Create a new file upload handler
    ServletFileUpload upload = new ServletFileUpload(factory);
    // Parse the request
    Iterator /* FileItem */ items = upload.parseRequest(request).iterator();
    while (items.hasNext()) {
        FileItem thisItem = (FileItem) items.next();
        ... do stuff ...
    } 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-08T20:54:48.970

你可以尝试这样的事情：

```
while (items.hasNext()) {
        FileItem thisItem = (FileItem) items.next();
        if (thisItem.isFormField()) {
            if (thisItem.getFieldName().equals("somefieldname") {
                String value = thisItem.getString();
                // Do something with the value
            }
        }

    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-11-02T20:17:28.997

花了我几天的时间来解决这个问题，但它就在这里并且它有效，你可以读取多部分数据、文件和参数，这里是代码：

```
 try {

        ServletFileUpload upload = new ServletFileUpload();
        FileItemIterator iterator = upload.getItemIterator(req);
        while(iterator.hasNext()){

            FileItemStream item = iterator.next();
            InputStream stream = item.openStream();
            if(item.isFormField()){
                if(item.getFieldName().equals("vFormName")){

                    byte[] str = new byte[stream.available()];
                    stream.read(str);
                    full = new String(str,"UTF8");
                }
            }else{
                byte[] data = new byte[stream.available()];
                stream.read(data);
                base64 = Base64Utils.toBase64(data);
            }
        }

    } catch (FileUploadException e) {

        e.printStackTrace();
    } 
```

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2008-12-08T20:39:36.457

你试过 request.getParam() 了吗？

# python - Django 如何知道呈现表单字段的顺序？

> ID：350799
> 
> 赞同：100
> 
> 时间：2008-12-08T20:37:44.730
> 
> 标签：python, django, django-forms

如果我有一个 Django 表单，例如：

```
class ContactForm(forms.Form):
    subject = forms.CharField(max_length=100)
    message = forms.CharField()
    sender = forms.EmailField() 
```

我调用这个表单实例的 as_table() 方法，Django 将按照上面指定的顺序呈现字段。

我的问题是 Django 如何知道定义类变量的顺序？

（还有我如何覆盖这个顺序，例如当我想从类的**init**方法中添加一个字段时？）

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2015-12-28T23:05:23.590

Django 1.9 的新功能是**[Form.field_order](https://docs.djangoproject.com/en/stable/ref/forms/api/#django.forms.Form.field_order)**和**[Form.order_fields()](https://docs.djangoproject.com/en/stable/ref/forms/api/#django.forms.Form.order_fields)**。

```
# forms.Form example
class SignupForm(forms.Form):

    password = ...
    email = ...
    username = ...

    field_order = ['username', 'email', 'password']

# forms.ModelForm example
class UserAccount(forms.ModelForm):

    custom_field = models.CharField(max_length=254)

    def Meta:
        model = User
        fields = ('username', 'email')

    field_order = ['username', 'custom_field', 'password'] 
```

* * *

## 回答 #2

> 赞同：90
> 
> 时间：2009-07-28T00:12:20.463

**[注意：这个答案现在已经完全过时了 - 请参阅下面的讨论，以及更多最近的答案]。**

如果`f`是一个表单，它的字段是`f.fields`，它是一个`django.utils.datastructures.SortedDict` （它按照添加的顺序显示项目）。在表单构造之后，f.fields 有一个 keyOrder 属性，它是一个列表，其中包含按照它们应该出现的顺序的字段名称。您可以将其设置为正确的顺序（尽管您需要小心以确保您不会省略项目或添加额外内容）。

这是我刚刚在当前项目中创建的示例：

```
class PrivEdit(ModelForm):
    def __init__(self, *args, **kw):
        super(ModelForm, self).__init__(*args, **kw)
        self.fields.keyOrder = [
            'super_user',
            'all_districts',
            'multi_district',
            'all_schools',
            'manage_users',
            'direct_login',
            'student_detail',
            'license']
    class Meta:
        model = Privilege 
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2008-12-08T21:12:56.517

我继续回答我自己的问题。以下是未来参考的答案：

在 Django`form.py`中，使用该方法执行一些黑魔法，`__new__`最终`self.fields`按照类中定义的顺序将类变量加载到其中。 `self.fields`是一个 Django`SortedDict`实例（定义在 中`datastructures.py`）。

所以要覆盖它，比如在我的示例中，您希望 sender 首先出现，但需要将其添加到**init**方法中，您可以这样做：

```
class ContactForm(forms.Form):
    subject = forms.CharField(max_length=100)
    message = forms.CharField()
    def __init__(self,*args,**kwargs):
        forms.Form.__init__(self,*args,**kwargs)
        #first argument, index is the position of the field you want it to come before
        self.fields.insert(0,'sender',forms.EmailField(initial=str(time.time()))) 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2011-04-21T16:53:43.070

字段按照它们在 ModelClass._meta.fields 中定义的顺序列出。但是如果你想改变Form中的顺序，你可以使用keyOrder函数来完成。例如 ：

```
class ContestForm(ModelForm):
  class Meta:
    model = Contest
    exclude=('create_date', 'company')

  def __init__(self, *args, **kwargs):
    super(ContestForm, self).__init__(*args, **kwargs)
    self.fields.keyOrder = [
        'name',
        'description',
        'image',
        'video_link',
        'category'] 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-12-22T00:13:52.920

使用 Django >= 1.7 你必须修改`ContactForm.base_fields`如下：

```
from collections import OrderedDict

...

class ContactForm(forms.Form):
    ...

ContactForm.base_fields = OrderedDict(
    (k, ContactForm.base_fields[k])
    for k in ['your', 'field', 'in', 'order']
) 
```

这个技巧在 Django Admin 中使用`PasswordChangeForm`：[Github 上的源代码](https://github.com/django/django/blob/1.7/django/contrib/auth/forms.py#L338)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-12-08T20:52:25.027

表单字段有一个用于创建顺序的属性，称为`creation_counter`. `.fields`属性是一个字典，因此简单地添加到字典并更改`creation_counter`所有字段中的属性以反映新的顺序就足够了（尽管从未尝试过）。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-05-15T22:03:32.970

在 Field 类中使用计数器。按该计数器排序：

```
import operator
import itertools

class Field(object):
    _counter = itertools.count()
    def __init__(self):
        self.count = Field._counter.next()
        self.name = ''
    def __repr__(self):
        return "Field(%r)" % self.name

class MyForm(object):
    b = Field()
    a = Field()
    c = Field()

    def __init__(self):
        self.fields = []
        for field_name in dir(self):
            field = getattr(self, field_name)
            if isinstance(field, Field):
                field.name = field_name
                self.fields.append(field)
        self.fields.sort(key=operator.attrgetter('count'))

m = MyForm()
print m.fields # in defined order 
```

输出：

```
[Field('b'), Field('a'), Field('c')] 
```

* * *

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2015-03-03T22:18:34.967

从 Django 1.7 开始，表单使用不支持附加运算符的 OrderedDict。所以你必须从头开始重建字典.​​.....

```
class ChecklistForm(forms.ModelForm):

  class Meta:
    model = Checklist
    fields = ['name', 'email', 'website']

  def __init__(self, guide, *args, **kwargs):
    self.guide = guide
    super(ChecklistForm, self).__init__(*args, **kwargs)

    new_fields = OrderedDict()
    for tier, tasks in guide.tiers().items():
      questions = [(t['task'], t['question']) for t in tasks if 'question' in t]
      new_fields[tier.lower()] = forms.MultipleChoiceField(
        label=tier,
        widget=forms.CheckboxSelectMultiple(),
        choices=questions,
        help_text='desired set of site features'
      )

    new_fields['name'] = self.fields['name']
    new_fields['email'] = self.fields['email']
    new_fields['website'] = self.fields['website']
    self.fields = new_fields 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-03-31T09:53:37.127

供将来参考：自从新形式以来，情况发生了一些变化。这是从您无法控制的基本表单类中重新排序字段的一种方法：

```
def move_field_before(form, field, before_field):
    content = form.base_fields[field]
    del(form.base_fields[field])
    insert_at = list(form.base_fields).index(before_field)
    form.base_fields.insert(insert_at, field, content)
    return form 
```

此外，还有一些关于`base_fields`此处使用的 SortedDict 的文档：http: [//code.djangoproject.com/wiki/SortedDict](http://code.djangoproject.com/wiki/SortedDict)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2014-12-05T18:19:05.613

如果是`fields = '__all__'`：

```
class AuthorForm(ModelForm):
    class Meta:
        model = Author
        fields = '__all__' 
```

或被`exclude`使用：

```
class PartialAuthorForm(ModelForm):
    class Meta:
        model = Author
        exclude = ['title'] 
```

**然后 Django 引用模型中定义**的字段顺序。这让我很生气，所以我想我会提到它。它在[ModelForm 文档](https://docs.djangoproject.com/en/dev/topics/forms/modelforms/)中被引用：

> 如果使用其中任何一个，则字段在表单中出现的顺序将是字段在模型中定义的顺序，ManyToManyField 实例最后出现。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-09-09T13:17:11.593

在 django 1.9 表单中排序字段的最简单方法是在表单中`field_order`使用[Form.field_order](https://docs.djangoproject.com/en/1.9/ref/forms/api/#django.forms.Form.field_order)

这是一个小例子

```
class ContactForm(forms.Form):
     subject = forms.CharField(max_length=100)
     message = forms.CharField()
     sender = forms.EmailField()
     field_order = ['sender','message','subject'] 
```

这将按照您在`field_order`dict.xml 中指定的顺序显示所有内容。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-08-22T14:14:27.560

`fields`在内部类中使用`Meta`对我有用`Django==1.6.5`：

```
#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
Example form declaration with custom field order.
"""

from django import forms

from app.models import AppModel

class ExampleModelForm(forms.ModelForm):
    """
    An example model form for ``AppModel``.
    """
    field1 = forms.CharField()
    field2 = forms.CharField()

    class Meta:
        model = AppModel
        fields = ['field2', 'field1'] 
```

就如此容易。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-12-05T12:05:19.150

我用它来移动字段：

```
def move_field_before(frm, field_name, before_name):
    fld = frm.fields.pop(field_name)
    pos = frm.fields.keys().index(before_name)
    frm.fields.insert(pos, field_name, fld) 
```

这在 1.5 中有效，我有理由确定它在更新的版本中仍然有效。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-08T20:41:55.983

它与用于定义表单类的元类有关。我认为它保留了字段的内部列表，如果您插入到列表的中间，它可能会起作用。自从我查看该代码以来已经有一段时间了。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-06-09T16:26:35.873

这些答案都不适合我，实际上，您不必做任何自定义，您只需在模型类中按照您想要的顺序对字段进行排序。例如...下面的代码

```
from django.db import models

class Student(models.Model):
    class Meta:
        verbose_name_plural = "categories"

    id = models.AutoField(primary_key=True)
    name = models.CharField(max_length=300)
    nick_name = models.CharField(max_length=300)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

    def __str__(self):
        return self.name 
```

您的模型管理界面将完全按照您在这种情况下声明的顺序显示字段`(id, name, nick_name )`

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-11-05T09:10:17.360

要添加一些东西，你可以使用这个（Django 3+）：

```
class ...(forms.ModelForm):
    field = ...

    class Meta:
        model = Xxxxxx
        fields = '__all__'

    field_order = ['field', '__all__'] 
```

`__all__`作品

# c++ - MFC 等价于 Java File#isDirectory()

> ID：350811
> 
> 赞同：1
> 
> 时间：2008-12-08T20:41:07.953
> 
> 标签：c++, mfc, path, directory

是否有与MFC中的 Java File 方法**isDirectory()等效的方法？**我试过用这个：

```
 static bool isDirectory(CString &path) {
  return GetFileAttributes(path) & FILE_ATTRIBUTE_DIRECTORY;   
} 
```

但它似乎不起作用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T20:43:01.443

# CFileFind::IsDirectory()

[http://msdn.microsoft.com/en-us/library/scx99850(VS.80).aspx](http://msdn.microsoft.com/en-us/library/scx99850(VS.80).aspx)

编辑：

```
 #include <afxwin.h>
  #include <iostream>

  using namespace std;

  CFileFind finder;

  fileName += _T("c:\\aDirName");
  if (finder.FindFile(fileName))
  {
        if (finder.FindNextFIle())
        {            
              if (finder.IsDirectory())
              {
                    // Do directory stuff...
              }
        }
  } 
```

如果您将文件名更改为具有通配符，您可以执行

```
 while(finder.findNextFile()) {... 
```

获取所有匹配的文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T22:35:48.440

抱歉，问题的答案可能“不一致”，但您可能会发现它很有用，因为每当我在 Windows 中需要这样的东西时，我不使用 MFC，而是使用常规的 Windows API：

```
//not completely tested but after some debug I'm sure it'll work
bool IsDirectory(LPCTSTR sDirName)
{
    //First define special structure defined in windows
    WIN32_FIND_DATA findFileData; ZeroMemory(&findFileData, sizeof(WIN32_FIND_DATA));
    //after that call WinAPI function finding file\directory
    //(don't forget to close handle after all!)
    HANDLE hf = ::FindFirstFile(sDirName, &findFileData);
    if (hf  ==  INVALID_HANDLE_VALUE) //also predefined value - 0xFFFFFFFF
    return false;
    //closing handle!
    ::FindClose(hf);
    // true if directory flag in on
    return (findFileData.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY) != 0;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-30T03:59:26.683

请求的 MFC 解决方案：a_FSItem 路径 ot 要测试的项目（检查 CFile::GetStatus() 以获得所需的要求）。

```
 CFileStatus t_aFSItemStat;
  CFile::GetStatus( a_FSItem, t_aFSItemStat );

  if ( ( t_aFSItemStat.m_attribute & CFile::directory )
    return true;

  return false; 
```

如果您希望将卷根包含为有效目录，只需将其添加到测试中

```
t_aFSItemStat.m_attribute & CFile::volume 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-03T03:12:42.443

它不是 MFC，但我使用这个：

```
bool IsValidFolder(LPCTSTR pszPath)
{
    const DWORD dwAttr = ::GetFileAttributes(pszPath);
    if(dwAttr != 0xFFFFFFFF)
    {
        if((FILE_ATTRIBUTE_DIRECTORY & dwAttr) &&
           0 != _tcscmp(_T("."), pszPath) &&
           0 != _tcscmp(_T(".."), pszPath))
        {
            return true;
        }
    }

    return false;
} 
```

# c# - Newbie LINQ Question: Is Paging in LINQ Queries Possible?

> ID：350819
> 
> 赞同：14
> 
> 时间：2008-12-08T20:42:08.870
> 
> 标签：c#, linq-to-xml

Is it possible to using "paging" functionality in Linq queries? Let's say I have some XML like this:

```
<Root>
    <BetaSection>
        <Choices>
            <SetA>
                <Choice id="choice1">Choice One</Choice> 
                <Choice id="choice2">Choice Two</Choice>
                <Choice id="choice3">Choice Three</Choice>
                .
                .
                .
                <Choice id="choice48">Choice Forty-Eight</Choice>
                <Choice id="choice49">Choice Forty-Nine</Choice>
                <Choice id="choice50">Choice Fifty</Choice>
            </SetA>
        </Choices>
    </BetaSection>
</Root> 
```

If I wanted to implement paging functionality, would I be able to provide an offset to a LINQ query such that I could start at the 11th element and end on the 20th element? If so, would the query be any different if the data was a list of objects instead of XML?

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-08T20:46:58.690

```
var q = from X in Choices.Skip((page-1)*pageSize).Take(pageSize)
        select X; 
```

Now, if you need a where clause in it, it gets a bit trickier:

```
var q = (from X in Choices
         where x.SomeField == SomeValue
         select X).Skip((page-1)*pageSize).Take(pageSize); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-08T20:47:15.240

Absolutely - `Skip()` and `Take()` achieve paging, and are supported by pretty-much all LINQ providers.

In this case it looks like you are using LINQ-to-Xml, so feel free to ignore the following bit - but for general info: note that if the data is coming from a database via a stored procedure, it is hard to page at the server. You can, however, compose (i.e. page) "UDF"s. LINQ-to-SQL supports UDFs (via `[FunctionAttribute]`), but not Entity Framework. If you are using auto-generated database queries this isn't an issue.

Note that with xml, you could also do a lot with xpath - here using `XmlDocument`:

```
foreach (XmlElement el in doc.SelectNodes(
  "/Root/BetaSection/Choices/SetA/Choice[position() > 11 and position() < 20]"))
{
    Console.WriteLine(el.GetAttribute("id"));
} 
```

or with `Skip()`/`Take()` (still with `XmlDocument`):

```
foreach (var el in doc.SelectNodes(
  "/Root/BetaSection/Choices/SetA/Choice").Cast<XmlElement>()
  .Skip(10).Take(10))
{
    Console.WriteLine(el.GetAttribute("id"));
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-08T20:47:26.893

Take a look to the [Queryable.Skip](http://msdn.microsoft.com/en-us/library/bb357513.aspx) and [Queryable.Take](http://msdn.microsoft.com/en-us/library/bb300906.aspx) methods.

Also see this useful [extension methods](http://solidcoding.blogspot.com/2007/11/paging-with-linq.html) for paging,

with that methods you can do this like this:

```
List<string> names = new List<string>();
names.AddRange(new string[]{"John","Frank","Jeff","George","Bob","Grant", "McLovin"});

foreach (string name in names.Page(2, 2))
{
    Console.WriteLine(name);
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-08T21:01:29.080

James Curran has it right, you can simplify that by creating an extension method for reuse later on.

You could also modify the code to return you an object that can track how many items total are in the list and how many pages there should be based on the pageSize and pageIndex.

```
public static IQueryable<T> ToPageOfList<T>(this IQueryable<T> source, int pageIndex, int pageSize)
{
    return source.Skip(pageIndex * pageSize).Take(pageSize);
}

//Example
var g = (from x in choices select x).ToPageOfList(1, 20); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-08T20:46:04.510

```
var pagedData = aDataSource.Skip(20).Take(10); 
```

That way, you are skipping 20 elements and taking the next 10

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-08T20:46:54.430

The "Take" and "Skip" extension methods provide for this.

```
myQueryable = myQueryable.Skip(10).Take(10); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-08T20:47:26.007

Yes it is. You'd have to get the XML into a proper DataSource format and then this thread over on the MSDN forums should provide the necessary steps to give you the ability on how to implement it...

[MSDN - LINQ with pagination](http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=2708072&SiteID=1)

# vb.net - 组合框 KeyDown 事件处理程序多次触发

> ID：350832
> 
> 赞同：0
> 
> 时间：2008-12-08T20:45:58.583
> 
> 标签：vb.net, combobox, keydown

在 VB.NET 中，我在 WinForm 表单上有一个组合框。该表单允许用户输入要搜索的查询。当用户按 Enter 键时，将对数据库执行查询，并将结果作为 DataTable 返回。然后将 DataTable 绑定到 Combobox，用户可以选择他们正在寻找的选项。

在大多数情况下，这工作得很好。但是，我们发现代码正在执行多次。如果我写出查询并按一次 Enter 键，我可以单步执行代码两次或三次。如果不需要，我不想多次向数据库发送相同的查询。为什么代码会多次执行的任何想法或建议？

这是有问题的代码。Combobox 和 Function 名称已更改以保护无辜者。:)

```
Private Sub cbx_KeyDown(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles cbx.KeyDown

    Me.Cursor = Cursors.IBeam
    If e.KeyData = Keys.Enter Then
        Me.Cursor = Cursors.WaitCursor
        PerformSearch()
        Me.Cursor = Cursors.Default
    End If
    Me.Cursor = Cursors.Default

End Sub 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T22:25:36.290

具有讽刺意味的是，在执行搜索后添加 cbx.Focus() 可以解决问题。这是解决方案。

```
Private Sub cbx_KeyDown(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles cbx.KeyDown

    Me.Cursor = Cursors.IBeam
    If e.KeyData = Keys.Enter Then
        Me.Cursor = Cursors.WaitCursor
        PerformSearch()
        cbx.Focus()
        Me.Cursor = Cursors.Default
    End If
    Me.Cursor = Cursors.Default

End Sub 
```

# c# - 您将如何在单个 ASP.Net MVC Web 应用程序中构建访问者和管理功能？

> ID：350836
> 
> 赞同：5
> 
> 时间：2008-12-08T20:46:13.620
> 
> 标签：c#, asp.net, asp.net-mvc

因此，我一直在为我的一群朋友开发一个小型 Web 应用程序（站点），并意识到事情需要改变。该应用程序有两个方面

1.  面向公众的一面，为访问者和非管理员提供动态数据，以及
2.  管理员可以更新或创建要提供的动态数据的管理端。

该应用程序最初是一个单独的 webforms 项目，由单独的页面和文件夹的 web.config 安全性划分。然后它发展成为独立的项目（MVC 管理端和 Web 表单前端）。由于部署问题，我后来不得不把它带到今天的位置，一个混合了 MVC（管理员）和 Web 表单（公共）的 Web 应用程序。

现在我正在考虑将其迁移到单个 MVC 项目。我想通过像 /Admin 这样的 URL 让我的管理职能从我面向公众的一面绝望，但我不知道该怎么做。我已经阅读了很多关于将控制器分组到模块中的主题，但还不确定这是正确的。

*   我是否应该只创建与公共应用程序的其余部分内联的管理功能并确定用户是否已登录？
*   还是应该创建与公共控制器（EventAdminController vs CalendarController）分开的管理控制器？
*   别人做了什么？

欢迎提出建议，感谢stackoverflow。

* * *

是的，我正在使用 Microsoft 的 ASP.Net MVC 框架。Darryl，您是说将我的视图放在 Admin 文件夹中并使用 web.config（检查安全性和角色）保护它还是将我的控制器放在 Admin 文件夹中？

我的假设是您说要将控制器放在 Admin 文件夹中，例如在控制器下。这仍然意味着 /Controllers 中的 HomeController 与 /Controllers/Admin 中的 HomeAdminController 不同。在这种情况下，您可以为每个路由配置特定的路由，但我看不出将控制器放在不同的文件夹中如何简单地保护它们（除非在操作上使用 Authorize 属性）。

至于将视图放在不同的文件夹中，我可以看到这在理论上是如何工作的。但是控制器（理论上没有任何授权属性）是否仍会执行到返回视图的点？然后我会期待重定向或错误。无论哪种方式，如果您无法访问视图，我都不想执行我的控制器操作，并且宁愿不进行任何内部操作预检查。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T22:33:24.170

我们有一个类似的问题，我们正在创建一个非常大的 ASP.NET MVC 应用程序，并将功能划分为我们使用的过程非常类似于[Phil Haack 的这篇文章的](http://haacked.com/archive/2008/11/04/areas-in-aspnetmvc.aspx)区域。通过创建区域，您可以为每个区域而不是整个应用程序拥有唯一的控制器名称，您可以更轻松地分离模块，并且可以共享身份验证和基本的通用功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T20:59:34.950

在我正在处理的 MVC 项目中，我将所有管理内容放在管理文件夹中。要查看 admin 文件夹，您必须经过身份验证并拥有正确的角色。我的控制器往往非常小，大多数逻辑都在控制器使用的业务层中。

# c# - 如何最小化 ASP.NET C# 项目 DLL 大小？

> ID：350843
> 
> 赞同：8
> 
> 时间：2008-12-08T20:47:33.243
> 
> 标签：c#, asp.net, visual-studio-2008

我正在开发一个项目，在 Visual Studio 2008 中，该 DLL 目前超过 20 MB。有没有办法分析那个 DLL，搜索这个大小的主要贡献者？

我怀疑在解决方案中的较小项目中打破它会有所帮助，但我正在寻找一个更快的解决方案（虽然不是更好，但恐怕）。

作为旁注，我们收到“意外错误写入元数据”错误，我们认为它与 DLL 大小有关。但是，当重新启动 Visual Studio 2008 时，错误消失了。直到它再次出现，经过几次重建。磁盘空间不是问题。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-08T20:52:13.843

约瑟！您是否有可能在 dll 中嵌入了一些巨大的 resx 文件（或其他嵌入式内容）？也许将这些视为外部内容？我首先查看项目树中的文件...... 20Mb 必须来自某个明显的地方 - 大型图形等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T21:18:27.190

[PE Explorer](http://www.heaventools.com/overview.htm)将向您显示内容。

[这](http://wiki.answers.com/Q/How_do_you_open_.dll_files_to_see_what_is_written_inside)也可能有帮助？

更新： [Dependency Walker](http://www.dependencywalker.com/)也可以在这里提供帮助。您可以在“配置文件模式”下运行它，该模式通过执行您的应用程序并观察它以查看它加载的内容来工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T20:57:18.170

Microsoft.SharePoint.dll 为 9Mb。即使对于像 SharePoint 这样的复杂产品，DLL 也被分离到单独的项目中。

如果您有一个大型项目并且资源没有任何来源，我是否建议您将项目拆分为不同的程序集？

我看到了您在 VS2003 环境中遇到的确切错误（Microsoft 在[support.microsoft.com](http://support.microsoft.com/default.aspx?scid=kb;EN-US;843552)上显示了该错误）。但是，由于您使用的是 VS2008，因此也可能是由于磁盘空间问题。

您是否确认 Visual Studio 使用的所有磁盘都未满/几乎满？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T21:26:50.810

哎呀！发现一堆（50 多个）使用 Crystal Reports 生成的巨大报表模板，每个大约 1MB。

我们所要做的就是将它们排除在项目之外。

# .net - Google Base 查询问题

> ID：350847
> 
> 赞同：0
> 
> 时间：2008-12-08T20:50:53.923
> 
> 标签：.net, gdata-api, google-base

我正在使用 .NET 库查询 Google Base，就像本页所述。

[http://code.google.com/apis/base/docs/2.0/developers_guide_dotnet.html](http://code.google.com/apis/base/docs/2.0/developers_guide_dotnet.html)

当我运行查询时，会返回 GBaseFeed，它通常会将 TotalRecords 属性设置为 35 之类的值，但在 Entries 集合中，它通常没有项目或项目很少。其他时候，查询返回条目中预期的所有 35 个项目。有没有人见过这种行为或知道是什么原因造成的？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-08T23:36:35.790

经过更多研究后，Google Base 提要中的 TotalResults 属性似乎基本上不起作用，可能不应该依赖。

# iphone - 可以在 iPhone 上使用 NSUserDefaults 保存整数数组吗？

> ID：350848
> 
> 赞同：8
> 
> 时间：2008-12-08T20:51:33.127
> 
> 标签：iphone, objective-c, cocoa-touch

是否可以在 iPhone 上使用 NSUserDefaults 保存整数数组？我在我的 .h 文件中声明了一个数组：`int playfield[9][11]`它填充了文件中的整数并确定了游戏场地的布局。我希望能够有几个保存槽，用户可以在其中保存他们的游戏。如果我做：

```
NSUserDefaults *prefs = [NSUserDefaults standardUserDefaults];
[prefs setObject: playfield forKey: @"slot1Save"]; 
```

我得到一个指针错误。如果可以保存一个整数数组，那么最好的方法是什么，然后再检索它？

提前致谢！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-08T21:19:20.760

您可以使用 NSData 包装器保存和检索数组

即（无错误处理）

节省

```
NSData *data = [NSData dataWithBytes:&playfield length:sizeof(playfield)];
[prefs setObject:data forKey:@"slot1Save"]; 
```

加载

```
NSData *data = [prefs objectForKey:@"slot1Save"];
memcpy(&playfield, data.bytes, data.length); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-08T21:20:34.720

来自[Apple 的 NSUserDefaults 文档](http://developer.apple.com/DOCUMENTATION/Cocoa/Reference/Foundation/Classes/NSUserDefaults_Class/Reference/Reference.html)：

> 默认值必须是一个属性列表，即以下实例（或集合实例的组合）：NSData、NSString、NSNumber、NSDate、NSArray 或 NSDictionary。

这就是您收到指针错误的原因。

您有几个选项（按照推荐使用的顺序）：

1.  使用`NSArray`of `NSArray`s 存储`playField`在您的应用程序中
2.  将 playField 保留为 的数组`int`，但在保存到 之前用数字填充 NSArray `NSUserDefaults`。
3.  编写您自己的子类`NSArchiver`以在整数数组和`NSData`.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-08T21:10:50.497

您必须将其转换为对象。您可以使用 NSArray 或 NSDictionary。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T07:51:32.933

只需使用 NSArray 而不是普通的 C 数组即可轻松解决您的问题。

# c# - 最小二乘 C# 库

> ID：350852
> 
> 赞同：19
> 
> 时间：2008-12-08T20:52:29.270
> 
> 标签：c#, math, numerical

我正在寻找执行多项式最小二乘回归并正在寻找一个 C# 库来为我进行计算。

我传入数据点和多项式的次数（二阶、三阶等），它返回 C0、C1、C2 等常量值或计算值“预测”。

注意：我正在使用最小二乘法创建一些关于磁盘使用情况、数据库大小和表大小的预测报告。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-08-21T19:55:38.000

这是 C# 代码的链接，可以做到这一点：[http ://www.trentfguidry.net/post/2009/08/01/Linear-Regression-of-Polynomial-Coefficients.aspx](http://www.trentfguidry.net/post/2009/08/01/Linear-Regression-of-Polynomial-Coefficients.aspx)

祝你好运！

**编辑：**显然上面的链接已损坏。我不久前提出了另一个解决方案：http: [//procbits.com/2011/05/02/linear-regression-in-c-sharp-least-squares/](http://procbits.com/2011/05/02/linear-regression-in-c-sharp-least-squares/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T21:16:23.357

在一般情况下，您需要一个“优化器”或“最小化器”。看[http://en.wikipedia.org/wiki/Optimization_(mathematics)#Solvers](http://en.wikipedia.org/wiki/Optimization_(mathematics)#Solvers)获取一些例子。我看到第一个链接（[http://en.wikipedia.org/wiki/IMSL_Numerical_Libraries](http://en.wikipedia.org/wiki/IMSL_Numerical_Libraries)）声称具有 c# 支持。

* * *

编辑：对于您建议的有限用途（线性或二次多项式），您可以转到 Numerical Recipies 的任何副本，获取直接实现，然后翻译成您的语言。一般的最小化器是矫枉过正的。

但也请注意，多项式可能不是很差的预测因子。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-10-21T20:17:51.390

您可以在 GPL 许可证 2.0 下查看库表格 ALGLIB。他们有 C#、C++、...的源代码

[http://www.alglib.net/interpolation/leastsquares.php](http://www.alglib.net/interpolation/leastsquares.php)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T20:54:39.080

您可能想查看[alglib](http://www.alglib.net/interpolation/linearleastsquares.php)。它使用 C++ 而不是 C#，但您也许可以在其上编写一个包装器。

# excel - Excel ODBC 和 64 位服务器

> ID：350858
> 
> 赞同：11
> 
> 时间：2008-12-08T20:54:57.643
> 
> 标签：excel, 64-bit, odbc, windows-server-2008, 32-bit

使用 ASP.NET 我需要更新一个 excel 模板。

我们的服务器在 64 位模式下运行 Windows 2008。

我正在使用以下代码访问 excel 文件：

```
 ...
    string connection = 
@"Provider=MSDASQL;Driver={Microsoft Excel Driver (*.xls)};DBQ=" + path + ";";
    ... 
```

如果应用程序池设置为启用 32 位应用程序，则代码按预期工作；但是我使用的 oracle 驱动程序失败了，因为它只有 64 位。

如果启用 32 位应用程序设置为 false，则 excel 代码将失败并出现以下错误：

> 未找到数据源名称且未指定默认驱动程序

有什么建议么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-05-11T18:11:46.410

Microsoft Office 团队刚刚**发布**了**[64 位驱动程序](http://www.microsoft.com/downloads/details.aspx?familyid=C06B8369-60DD-4B64-A44B-84B371EDE16D&displaylang=en)**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-02T17:26:19.397

Microsoft release a 64bit OLEDB FOR ODBC in 2008/04/04 [http://www.microsoft.com/downloads/details.aspx?FamilyID=000364db-5e8b-44a8-b9be-ca44d18b059b&DisplayLang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=000364db-5e8b-44a8-b9be-ca44d18b059b&DisplayLang=en)

Now you should able to run everything 64bit, can u try it and let us know the result and personally I think Microsoft should release a 64bit Jet Oledb 4.0, if the development team has no time to do it then just put it in codeplex.com and let other programmers do it.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-03-25T22:38:56.987

还有**2010 Office System Driver Beta: Data Connectivity Components** [Link](http://www.microsoft.com/downloads/details.aspx?familyid=C06B8369-60DD-4B64-A44B-84B371EDE16D&displaylang=en#Overview)，它允许我们从 64 位环境打开 Excel 2007 (XLS)。

> 此下载将安装一组组件，非 Microsoft Office 应用程序可以使用这些组件从 Microsoft Office 2010 Beta 文件中读取数据

我们的连接字符串

```
@"Provider=Microsoft.ACE.OLEDB.12.0;Data Source= " + filePath + ";Extended Properties=\"Excel 12.0;HDR=YES;\"" 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T21:22:56.033

没有发布 64 位的办公驱动程序。

此链接上的（当前）最后一篇文章： [MSDN 论坛](http://social.msdn.microsoft.com/forums/en-US/sqlintegrationservices/thread/213b90cb-5aea-41be-b935-fa995b6322ca/)详细介绍了一种麻烦且丑陋的解决方法。如果您愿意，您还可以将 Windows 服务替换为 COM 公开的程序集。不过还是很丑。:)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-06-11T10:18:43.237

安装 32 位 Oracle 驱动程序并启用 32 位应用程序？

# sql - 忽略 Oracle DUP_VAL_ON_INDEX 异常有多糟糕？

> ID：350860
> 
> 赞同：10
> 
> 时间：2008-12-08T20:55:32.027
> 
> 标签：sql, oracle, exception, plsql

如果用户至少查看过一次对象，我有一张桌子，我正在记录，因此：

```
 HasViewed
     ObjectID  number (FK to Object table)
     UserId    number (FK to Users table) 
```

这两个字段都不是 NULL 并且一起形成主键。

我的问题是，因为我不在乎有人查看了对象多少次（在第一次之后），所以我有两种处理插入的选项。

*   执行 SELECT count(*) ... 如果没有找到记录，则插入一条新记录。
*   总是只插入一条记录，如果它抛出一个 DUP_VAL_ON_INDEX 异常（表明已经有这样的记录），忽略它。

选择第二个选项的缺点是什么？

更新：

我想最好的说法是：“异常引起的开销是否比初始选择引起的开销更糟？”

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-09T10:59:47.580

我通常会插入并捕获 DUP_VAL_ON_INDEX 异常，因为这是最简单的代码。这比在插入之前检查是否存在更有效。我不认为这样做是“难闻的气味”（可怕的短语！），因为我们处理的异常是由 Oracle 引发的——它不像将你自己的异常作为流控制机制引发。

感谢 Igor 的评论，我现在对此运行了两个不同的基准测试：（1）除了第一个之外的所有插入尝试都是重复的，（2）所有插入都不重复。现实将介于这两种情况之间。

注意：在 Oracle 10.2.0.3.0 上执行的测试。

**案例1：大部分重复**

似乎最有效的方法（通过一个重要因素）是在插入时检查是否存在：

```
prompt 1) Check DUP_VAL_ON_INDEX
begin
   for i in 1..1000 loop
      begin
         insert into hasviewed values(7782,20);
      exception
         when dup_val_on_index then
            null;
      end;
   end loop
   rollback;
end;
/

prompt 2) Test if row exists before inserting
declare
   dummy integer;
begin
   for i in 1..1000 loop
      select count(*) into dummy
      from hasviewed
      where objectid=7782 and userid=20;
      if dummy = 0 then
         insert into hasviewed values(7782,20);
      end if;
   end loop;
   rollback;
end;
/

prompt 3) Test if row exists while inserting
begin
   for i in 1..1000 loop
      insert into hasviewed
      select 7782,20 from dual
      where not exists (select null
                        from hasviewed
                        where objectid=7782 and userid=20);
   end loop;
   rollback;
end;
/ 
```

结果（运行一次以避免解析开销后）：

```
1) Check DUP_VAL_ON_INDEX

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.54
2) Test if row exists before inserting

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.59
3) Test if row exists while inserting

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.20 
```

**案例2：没有重复**

```
prompt 1) Check DUP_VAL_ON_INDEX
begin
   for i in 1..1000 loop
      begin
         insert into hasviewed values(7782,i);
      exception
         when dup_val_on_index then
            null;
      end;
   end loop
   rollback;
end;
/

prompt 2) Test if row exists before inserting
declare
   dummy integer;
begin
   for i in 1..1000 loop
      select count(*) into dummy
      from hasviewed
      where objectid=7782 and userid=i;
      if dummy = 0 then
         insert into hasviewed values(7782,i);
      end if;
   end loop;
   rollback;
end;
/

prompt 3) Test if row exists while inserting
begin
   for i in 1..1000 loop
      insert into hasviewed
      select 7782,i from dual
      where not exists (select null
                        from hasviewed
                        where objectid=7782 and userid=i);
   end loop;
   rollback;
end;
/ 
```

结果：

```
1) Check DUP_VAL_ON_INDEX

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.15
2) Test if row exists before inserting

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.76
3) Test if row exists while inserting

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.71 
```

在这种情况下，DUP_VAL_ON_INDEX 以一英里的优势获胜。请注意，“插入前选择”在这两种情况下都是最慢的。

因此，您似乎应该根据插入是否重复的相对可能性来选择选项 1 或 3。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T21:11:45.050

我认为您的第二种选择没有缺点。我认为这是对命名异常的完全有效的使用，而且它避免了查找开销。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T21:15:38.960

试试这个？

```
SELECT 1
FROM TABLE
WHERE OBJECTID = 'PRON_172.JPG' AND
      USERID='JCURRAN' 
```

如果那里有一个，它应该返回 1，否则返回 NULL。

在您的情况下，忽略它看起来很安全，但为了性能，应该避免公共路径上的异常。一个要问的问题，“例外情况有多普遍？” 少到可以忽略吗？还是应该使用很多其他方法？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T21:21:39.853

通常，异常处理速度较慢；但是，如果它很少发生，那么您将避免查询的开销。
我认为这主要取决于异常的频率，但如果性能很重要，我建议对这两种方法进行一些基准测试。

一般来说，将常见事件视为异常是一种难闻的气味；因此，您也可以从另一个角度看到。
如果是异常，则应将其视为异常-您的方法是正确的。
如果这是一个常见事件，那么您应该尝试显式处理它 - 然后检查记录是否已插入。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-05T08:43:37.410

恕我直言，最好使用选项 2：除了已经说过的之外，您应该考虑**线程安全**。如果您使用选项 1 并且如果多个线程正在执行您的 PL/SQL 块，则可能有两个或多个线程同时触发 select 并且当时没有记录，这将最终导致所有线程插入和你会得到唯一的约束错误。

# wpf - 没有设置宽度的 WPF RichTextBox

> ID：350863
> 
> 赞同：28
> 
> 时间：2008-12-08T20:56:21.870
> 
> 标签：wpf, richtextbox

我有以下 XAML 代码：

```
<Window x:Class="RichText_Wrapping.Window1"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
Title="Window1">
<Grid>
    <RichTextBox Height="100" Margin="2" Name="richTextBox1">
        <FlowDocument>
            <Paragraph>
                This is a RichTextBox - if you don't specify a width, the text appears in a single column
            </Paragraph>
        </FlowDocument>
    </RichTextBox>
</Grid> 
```

...如果您在 XAML 中创建此窗口，您会看到，当您不指定窗口的宽度时，它会将文本包装在单列中，一次一个字母。有什么我想念的吗？如果这是控件中的已知缺陷，是否有任何解决方法？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2010-04-14T00:48:58.920

这是 WPF RichTextBox 的一个已确认错误。要修复它，将 FlowDocument 的 PageWidth 绑定到 RichTextBox 宽度，即

```
<RichTextBox Name="rtb">
    <FlowDocument Name="rtbFlowDoc" PageWidth="{Binding ElementName=rtb, Path=ActualWidth}" />
</RichTextBox> 
```

* * *

编辑：给 FlowDocument 一个名称，以便您可以在后面的代码中访问它，并且永远不要在代码隐藏中新建流文档。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-03T17:07:39.463

尝试将 FlowDocument 的宽度（一种方式）绑定到容器 RichTextBox 的宽度。

为我工作...

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-02-08T21:32:33.940

[本文](http://social.msdn.microsoft.com/Forums/en/wpf/thread/6cd49173-b06d-4749-85aa-f6ab46c7d4af)中的方法对我有用：

> WPF RichTextBox 不提供将其宽度调整为文本的功能。据我所知，RichTextBox 在其可视化树中使用 FlowDocumentView 来呈现 Flowdocument。它将占用可用空间来呈现其内容，因此它不会根据内容调整其大小。由于这是一个内部类，我们似乎无法覆盖布局过程以让 RichTextBox 调整其大小以适应文本。
> 
> 因此，我认为您的方法是正确的方向。不幸的是，根据我的研究，没有直接的方法来测量 RichTextBox 中渲染文本的大小。
> 
> 我们可以尝试一种解决方法。我们可以递归地遍历 RichTextBox 中的流文档以检索所有 Run 和 Paragraph 对象。然后我们将它们转换为 FormattedText 以获得大小。
> 
> [本文](http://www.wpfmentor.com/2009/01/how-to-transfer-rich-text-from.html)演示如何将 FlowDocument 转换为 FormattedText。我还使用该文章中的 FlowDocumentExtensions 类编写了一个简单的示例。

```
 public Window2()
    {
      InitializeComponent();

      StackPanel layoutRoot = new StackPanel();
      RichTextBox myRichTextBox = new RichTextBox() { Width=20};

      this.Content = layoutRoot;
      layoutRoot.Children.Add(myRichTextBox);

      myRichTextBox.Focus();
      myRichTextBox.TextChanged += new TextChangedEventHandler((o,e)=>myRichTextBox.Width=myRichTextBox.Document.GetFormattedText().WidthIncludingTrailingWhitespace+20);
    }

  public static class FlowDocumentExtensions
  {
    private static IEnumerable<TextElement> GetRunsAndParagraphs(FlowDocument doc)
    {
      for (TextPointer position = doc.ContentStart;
        position != null && position.CompareTo(doc.ContentEnd) <= 0;
        position = position.GetNextContextPosition(LogicalDirection.Forward))
      {
        if (position.GetPointerContext(LogicalDirection.Forward) == TextPointerContext.ElementEnd)
        {
          Run run = position.Parent as Run;

          if (run != null)
          {
            yield return run;
          }
          else
          {
            Paragraph para = position.Parent as Paragraph;

            if (para != null)
            {
              yield return para;
            }
          }
        }
      }
    }

    public static FormattedText GetFormattedText(this FlowDocument doc)
    {
      if (doc == null)
      {
        throw new ArgumentNullException("doc");
      }

      FormattedText output = new FormattedText(
        GetText(doc),
        CultureInfo.CurrentCulture,
        doc.FlowDirection,
        new Typeface(doc.FontFamily, doc.FontStyle, doc.FontWeight, doc.FontStretch),
        doc.FontSize,
        doc.Foreground);

      int offset = 0;

      foreach (TextElement el in GetRunsAndParagraphs(doc))
      {
        Run run = el as Run;

        if (run != null)
        {
          int count = run.Text.Length;

          output.SetFontFamily(run.FontFamily, offset, count);
          output.SetFontStyle(run.FontStyle, offset, count);
          output.SetFontWeight(run.FontWeight, offset, count);
          output.SetFontSize(run.FontSize, offset, count);
          output.SetForegroundBrush(run.Foreground, offset, count);
          output.SetFontStretch(run.FontStretch, offset, count);
          output.SetTextDecorations(run.TextDecorations, offset, count);

          offset += count;
        }
        else
        {
          offset += Environment.NewLine.Length;
        }
      }

      return output;
    }

    private static string GetText(FlowDocument doc)
    {
      StringBuilder sb = new StringBuilder();

      foreach (TextElement el in GetRunsAndParagraphs(doc))
      {
        Run run = el as Run;
        sb.Append(run == null ? Environment.NewLine : run.Text);
      }
      return sb.ToString();
    }
  } 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-08T21:42:27.330

我复制粘贴了你的代码，它不在一个列中，你有一个小的地方的宽度吗？例如，可能在后面的代码中定义。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-03-25T18:10:59.150

我注意到只有当我的默认`ScrollViewer`样式显式设置时我才会遇到这个问题`HorizontalScrollBarVisibility=Hidden`。
删除此设置器（无论如何都是默认值`Hidden`）为我修复了我的`RichTextBox`.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-02-14T09:02:05.930

仅作记录，因为我认为这个线程缺少一些解释，**原因是**：RichTextBox MeasureOverride 实现就是这样。我不会称其为错误，也许只是一个糟糕的设计行为，正如上面提到的那样，FlowDocument 由于其复杂性而测量起来并不便宜。底线，通过绑定 MinWidth 或将其包装在限制容器中来避免无限的 Width 约束。

```
 /// <summary>
    /// Measurement override. Implement your size-to-content logic here.
    /// </summary>
    /// <param name="constraint">
    /// Sizing constraint.
    /// </param>
    protected override Size MeasureOverride(Size constraint)
    {
        if (constraint.Width == Double.PositiveInfinity)
        {
            // If we're sized to infinity, we won't behave the same way TextBox does under
            // the same conditions.  So, we fake it.
            constraint.Width = this.MinWidth;
        }
        return base.MeasureOverride(constraint);
    } 
```

# iphone - 单击 UITableViewCell 中的 UITextField

> ID：350868
> 
> 赞同：19
> 
> 时间：2008-12-08T20:57:32.380
> 
> 标签：iphone, objective-c, cocoa-touch

我有一个问题，当在 a`textField`中单击 a`UITableViewCell`时，该方法`tableView:didSelectRowAtIndexPath:`不会被调用。问题是，我需要滚动`tableView`到正确的位置，否则键盘会直接越过第一响应者。

然后我必须像这样移动代码：

```
[[self tableView] scrollToRowAtIndexPath:indexPath atScrollPosition:UITableViewScrollPositionTop animated:YES]; 
```

在我的`tableView`委托方法和我的`UITextField`委托方法中，`textFieldDidBeginEditing:`.

最好的方法是创建一个新方法，将被单击的单元格/文本字段的 indexPath 传递给它，然后从 tableView 委托和`UITextField`委托中调用该方法？更好的解决方法？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2011-09-30T01:53:25.890

我发现以下效果很好（假设您在表格视图控制器中）

```
- (void)textFieldDidBeginEditing:(UITextField *)textField{  
    CGPoint pnt = [self.tableView convertPoint:textField.bounds.origin fromView:textField];
    NSIndexPath* path = [self.tableView indexPathForRowAtPoint:pnt];
    [self.tableView scrollToRowAtIndexPath:path atScrollPosition:UITableViewScrollPositionTop animated:YES];
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-02T12:04:11.230

有几种方法可以解决此问题。发生的情况是 tableViewCell 将触摸事件委托给其子视图，这导致文本字段而不是您的单元格来处理触摸。

要解决这个问题：

*   将 UITextfield 的 userinteractionEnabled 属性设置为 NO，然后在收到 didSelectRowAtIndexPath 消息时重新启用 userInteractionEnabled 并调用 TextField 的 becomeFirstResponder。在 v2.2 上，你甚至不需要设置 userInteractionEnabled 标志，我没有用其他版本测试过这个，但是文档很清楚你应该启用这个。在 tableViewController 你只需要保存 indexpath 直到你得到 UIKeyboardDidShow 消息

*   为向您的 tableViewController 报告的 UITextField 创建一个委托，以便您可以从那里设置滚动偏移量。

*   注册键盘事件，然后通过检查文本字段处于编辑模式来找出滚动偏移量

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-08T21:15:42.157

您可以将您的控制器设置为您的 UITextField 的代表，然后调整您的表格视图`textFieldDidBeginEditing:`或`textFieldShouldBeginEditing:`

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-01-08T19:07:39.470

我没有在网络上找到任何适合我的解决方案。经过几天的谷歌搜索和试验，我终于把这个问题搞定了。正如您将在本文末尾看到的那样，这是 Apple iPhone 中的一个复杂错误。

如果你遇到像我这样的问题如下：

2.  tableviewcell 大于 iphone 屏幕的一半（不要与 Apple 的 UICatalog 的示例混淆，其中的 tableview 单元格小于 50 点，此处不适用。），

3.  单元格中有多个 uitexfields 或单元格中有 uitextfield 和 uitextview 或 uiwebview 的组合，

4.  在 uitextfields 和 uitextview 或 uiwebview 之间点击会导致不可预测的滚动位置，或者单击的 uitextfield 跳出视图或被键盘覆盖。它仅在键盘出现在 tableviewcell 中并且随后无法正常工作时第一次工作。

在阅读了与此类似的帖子后，我取得了重大突破：[http](http://alanduncan.net/old/index.php?q=node/13) ://alanduncan.net/old/index.php?q=node/13他们也没有完全正确。痛苦是由 UIKeyboard 事件中的错误引起的。当键盘第一次出现时，它会发出 UIKeyboardWillShowNotification 和 UIKeybaordDidShowNotification。iPhone 中存在一个错误，即第一个 UIKeyboardWillShowNotification 与随后的 UIKeyboardWillShowNotification 不同。解决方案是观察 UIKeyboardDidShowNotification。因此，当您的单元格出现时，添加以下代码

```
 NSNotificationCenter*nc=[NSNotificationCenter defaultCenter];
    [nc addObserver:self selectorselector(keyboardDidShow name:UIKeyboardDidShowNotification object:self.window]; 
```

在keyboardDidShow 函数中，我们需要滚动TABLEVIEW，而不是上面帖子中建议的tableviewcell。或者您可能会看到各种对象分开，而不是一起滚动。

```
(void)keyboardDidShow:(NSNotification *)notif
{
    //1\. see which field is calling the keyboard
    CGRect frame;
    if([textField_no1 isFirstResponder])
    frame=textField_no1.frame;
    else if([textField_no2 isFirstResponder])
    frame=textField_no2.frame;
    else if([textField_no3 isFirstResponder])
    frame=textField_no3.frame;
    else if([textView isFirstResponder])
    frame=textView.frame;
    else return;
    CGRect rect=self.superview.frame;

    //2\. figure out how many pixles to scroll up or down to the posistion set by theKeyBoardShowUpHorizon.

    //remove the complexity when the tableview has an offset
    [((UITableView*)[self.superview).setContentOffset:CGPointMake(0,0) animated:YES];

    int pixelsToMove=rect.origin.y+ frame.origin.y-theKeyBoardShowUpHorizon;

    //3\. move the uitableview, not uitableviewcell
    [self moveViewUpOrDownByPixels:pixelsToMove];

}

- (void)moveViewUpOrDownByPixels:(int)pixels
{

   [UIView beginAnimations:nil context:NULL];
   [UIView setAnimationDuration:0.6];

   //find the position of the UITableView, the superView of this tableview cell.
   CGRect rect=self.superview.frame;

   //moves tableview up (when pixels >0) or down (when pixels <0)
   rect.origin.y -= pixels;
   rect.size.height += pixels;
   self.superview.frame = rect;
   [UIView commitAnimations];
} 
```

要恢复 tableView，您需要在每次出现 tableviewcell 的 UIKeyboardDidHideNotification 上添加观察者（而不是其他帖子建议的 UIKeyboardWillHideNotification，以避免闪烁），然后将 tableview 放回原来的位置。

```
[nc addObserver:self selectorselector(keyboarDidHide) name:UIKeyboardDidHideNotification object:nil];

- (void)keyboardDidHideNSNotification*)notif
{
    //we have moved the tableview by number of pixels reflected in (self.superview.frame.origin.y). We need to move it back
    [self moveViewUpOrDownByPixels:self.superview.frame.origin.y];
} 
```

当您的单元格通过 [[NSNotificationCenter defaultCenter] removeObserver:... 消失时，不要忘记删除两个观察者。

仅此而已。我希望 Apple iPhone 团队有一天能解决这个问题，也许几个月后会在 4.0 中解决。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-10-28T09:15:48.410

我找到了解决方案。

1.  在界面生成器中打开 .xib 文件。
2.  选择表格视图
3.  从 IB 菜单中选择 Tools->Size Inspector On Scroll View Size Section，将**Inset -> Bottom 值**修改为 100, 150,250，具体取决于您的表格视图有多大。

**代码**

```
-(void) textFieldDidBeginEditing:(UITextField *)textField 
{
    UITableViewCell *cell = (UITableViewCell *) [[textField superview] superview];
    [self.tableView scrollToRowAtIndexPath:[tableView indexPathForCell:cell]
    atScrollPosition:UITableViewScrollPositionBottom animated:YES];
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-05-07T14:18:55.423

我发现这实际上很容易做到。

UITextField 委托方法 textFieldDidBeginEditing 将为您提供文本字段，然后您可以使用以下方法将其映射到 indexPath：

```
self.currentIndexPath = [self.tableView indexPathForRowAtPoint:textField.frame.origin]; 
```

然后您可以将单元格滚动到视图中（即在您的 UIKeyboardDidShowNotification 键盘通知处理程序中）：

```
[self.tableView scrollToRowAtIndexPath:self.currentIndexPath atScrollPosition:UITableViewScrollPositionNone animated:YES]; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-03-28T01:24:22.000

不会为 UITextField 嵌入单元格调用 didSelectRowAtIndexPath；因此，滚动逻辑需要在别处。

```
- (void)textFieldDidBeginEditing:(UITextField *)textField {
    NSIndexPath *indexPath = [NSIndexPath indexPathForRow:0 inSection:1];
    UITableViewCell *cell = [_tableView cellForRowAtIndexPath:indexPath];
    [_tableView setContentOffset:CGPointMake(0, cell.frame.size.height) animated:YES];
} 
```

确保将 textField 委托连接到 self

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-13T06:19:02.407

注册 UIKeyboardWillShowNotification 和 UIKeyboardWillHideNotification，然后在通知处理程序中根据需要调整您的视图。其中一个示例应用程序显示了如何执行此操作，但我忘记了哪个...SQLiteBooks，或者可能是 EditableDetailView。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-09T01:30:30.310

我在同样的问题上苦苦挣扎，我在 UITableViewCells 中有 UITextFields，并且在编辑它时无法让视图滚动到该字段。我的解决方案的核心如下。

此代码的关键是创建 UITextField 的行。它不是在 CGRectMake() 函数中硬编码 ax 和 y 值，而是使用它所在的单元格中的 x 和 y （+/- 任何您想要的单元格边缘的偏移量，如下所示）。UITextField* 中的硬编码 x 和 y 值为每个 UITextField* 为每个单元格提供*相同*的x、y 框架位置（它显然在显示时被单元格框架覆盖），因此当您调用“scrollRectToVisible”代码时，它不会似乎有它应该滚动到的正确坐标。

1）创建单元格，并使用单元格的框架 x 和 y 值将 UITextField* 添加到单元格（我在这里包括可选的偏移量

```
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {

    UITableViewCell* cell;
    cell = [tableView dequeueReusableCellWithIdentifier:@"UITableViewCell"];
    cell = [[[UITableViewCell alloc] initWithFrame:CGRectZero reuseIdentifier:@"UITableViewCell"] autorelease]; 

    //this is the critical part: make sure your UITextField* frame is based on the frame of the cell in which it's being placed.
    UITextField* txtField = [[UITextField alloc] initWithFrame:CGRectMake(cell.frame.origin.x+20, cell.frame.origin.y+9, 280, 31)];
    txtField.delegate = self;

    [cell addSubview:txtField];
    return cell;
} 
```

2) 在 textFieldDidBeginEditing 中调整滚动视图

```
-(void) textFieldDidBeginEditing:(UITextField *)textField {

    CGRect textFieldRect = [textField frame];
    [self.tableView scrollRectToVisible:textFieldRect animated:YES];
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-08-04T20:31:02.497

由于没有简单的方法来确定用户是点击了文本字段还是通过`becomeFirstResponder`.

我能想出的最优雅的解决方案是实现一个`hitTest:withEvent:`on cell 子类，并且基本上假装在选择单元格之前文本字段不存在。

```
- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event {
    UIView *view = [super hitTest:point withEvent:event];

    if(view == self.textField && !self.selected) {
        return self;
    }

    return view;
} 
```

`tableView:didSelectRowAtIndexPath:`然后应该手动使文本字段成为第一响应者。

```
- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {
    TextFieldCell* cell = [self.tableView cellForRowAtIndexPath:indexPath];

    [cell.textField becomeFirstResponder]

    [self.tableView scrollToRowAtIndexPath:indexPath atScrollPosition:UITableViewScrollPositionTop animated:YES];
} 
```

最后，我们必须在完成编辑时取消选择该行。这可以通过 UITextField 委托或通过键盘通知来完成，无论您喜欢什么。

```
- (void)textFieldDidEndEditing:(UITextField *)textField {
   [self.view endEditing:YES];
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-12-23T15:51:20.807

我们有一个名为[TPKeyboardAvoiding](https://github.com/NarayanaRao35/TPKeyboardAvoiding)的控制器，它处理有关 tableview 和 scrollview 的动态自动滚动的所有事情。您可以从下面的代码下载示例代码。 [https://github.com/NarayanaRao35/TPKeyboardAvoiding](https://github.com/NarayanaRao35/TPKeyboardAvoiding)

# windows - 我可以有多个 php.ini 文件吗？

> ID：350880
> 
> 赞同：3
> 
> 时间：2008-12-08T21:01:07.037
> 
> 标签：windows, configuration, php

我想`include_path`在我的*php.ini*文件 ( `C:\Windows\php.ini`) 中设置变量。

但是，我希望`include_path`托管在同一 Windows 服务器上的不同站点具有不同的值。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T21:07:44.950

[http://php.net/manual/en/configuration.file.php](http://php.net/manual/en/configuration.file.php)说：

> 在这些位置搜索 php.ini（按顺序）：
> 
> . . .

您可以查看此列表，看看其中一种技术是否对您的情况有帮助。例如，您可以设置环境变量`PHPRC`，或者您可以在每个当前工作目录中放置不同的 php.ini 文件，假设每个虚拟主机都有不同的 cwd。

请注意，当使用 Apache 和 mod_php 或其他将 PHP 嵌入 Web 服务器的模块（例如 FastCGI）时，php.ini 文件在 Web 服务器启动时被读取一次。当您以 CGI 方式使用 PHP 时，php.ini 文件会在每个 Web 请求期间被读取，因此您有更多机会使用不同的 php.ini。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-08T21:13:57.417

假设您在 httpd.conf 文件中有正确的 AllowOverride 设置，您可以从 .htaccess 文件设置 php include_path。这是一个示例：

.htaccess

```
php_value include_path "d:\path\to\include" 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-08T21:28:14.893

据我了解，更重要的是为每个服务器/站点拥有单独的包含路径，然后是多个 php.ini 文件？我说尽可能将您的代码保留在 PHP 中。

然后你可以设置 include_path [`set_include_path or ini_set`](http://no.php.net/set_include_path)。

在 apache 中，您可以将其设置在虚拟域或 .htaccess 文件中`php_value include_path "<first path to look>:<second path>:<etc>:."`。IIS 可能有类似的方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-08T21:06:28.260

不幸的是，我认为你不能。但是，一些网络服务器可以单独更改 PHP 设置......使用 mod_php 的 Apache 具有可以在各种虚拟主机上设置的 php_value 设置，IIS 可能有类似的设置，但我不确定。

[`set_include_path`](http://us2.php.net/manual/en/function.set-include-path.php)还可以在运行时覆盖包含路径。

PS TF2 工程师赢得胜利。

# language-agnostic - 以最少的代码字符创建、排序和打印包含 100 个随机整数的列表

> ID：350885
> 
> 赞同：21
> 
> 时间：2008-12-08T21:01:57.847
> 
> 标签：language-agnostic, code-golf, rosetta-stone

您可以编写最少多少代码来创建、排序（升序）和打印 100 个随机正整数的列表？最少的代码是指包含在整个源文件中的字符，所以开始缩小。

我有兴趣使用任何和所有编程语言查看答案。让我们尝试为每种语言保留一个答案，编辑以前的答案以更正或简化。如果您无法编辑，请发表评论？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-12-08T23:05:21.233

J中的10个字符：

```
/:~100?9e9 
```

解释：

`/:~` 对数组进行排序（从技术上讲，将列表排序的置换向量应用于自身）

`x ? limit`返回 x 个小于限制的随机数

`9e9`(9000000000) 是一个合理的上限，可以用 3 个字符表示。!9 (9 阶乘) 更小，但需要少一个字符。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-12-23T22:44:45.867

PHP 中的[xkcd 样式：](http://xkcd.com/221/)

```
for($i=0;$i<100;$i++) echo "4\n"; 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-12-08T21:16:36.990

Linux，命令行：

```
% od -dAn -N40 /dev/random | tr ' ' '\n' | sort -nu
4959
6754
8133
10985
11121
14413
17335
20754
21317
30008
30381
33494
34935
41210
41417
43054
48254
51279
54055
55306 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-12-08T21:09:54.057

我的条目：

```
echo enter a bunch of ints, hit control-D when done
cat - | sort -n 
```

或者，根据评论中的亚当：

```
echo enter a bunch of ints, hit control-D when done
sort -n 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-12-08T21:59:58.543

# C＃

```
using System;
using System.Linq;
class A {
    static void Main() {
        var r=new Random();
        new A[100].Select(i=>r.Next()).OrderBy(i=>i).ToList().ForEach(Console.WriteLine);
    }
} 
```

**编辑**：制作完整的程序。假设可以删除换行符和空格，但为了清楚起见保留了:)

**编辑**：变得更短......我敢有人改进这个......我已经尝试了一个小时。

**编辑**：我认为这有点短。

**编辑**：我认为这更短。呃，让我停下来。

**编辑**：多一行，少一个字符。值得商榷...

* * *

**解释**

`A[100]`- 任何旧事物的数组 - 在这种情况下是 A（这是一个不错的短名称）。内容被完全忽略，重要的是数组的大小。

`.Select(i=>r.Next())`- 生成可枚举的 100 个 r.Next() 值。

`.OrderBy(i=>i)`- 按顺序对前一个进行排序。

`.ToList()`- 将排序后的 int 可枚举转换为 List，这样我们就可以使用 ForEach。

`ForEach(Console.WriteLine)`- 调用 Console.WriteLine 100 次，传入列表中的每个整数值。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-01-04T07:32:47.080

### 数学，28 个字符

```
Sort@RandomInteger[2^32, 100] 
```

这给出了 {0,...,2^32} 中的 100 个（排序的）随机整数。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-12-08T21:45:19.180

Common Lisp，int 介于 0 和 10000 之间（没有上限，但您必须选择一个）。

```
(sort (loop repeat 100 collect (random 10000)) #'<) 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-06-28T02:36:45.587

## APL

13 个字符：

```
a[⍋a←100?9e8] 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-12-08T23:16:56.780

红宝石的尝试：

```
p [].tap{|a|100.times{a<<rand(9e9)}}.sort 
```

（少了八个字符，但需要`tap`Ruby 1.9 的红隼）

- 对于红宝石 1.8：

```
p (0..?d).map{rand 1<<32}.sort 
```

30 个字符。（可以通过更改回 9e9 来修剪 2，但有问题的评论说范围应该是 MaxInt32。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-12-09T14:24:17.777

F＃

```
let r = new System.Random();;

[ for i in 0..100 -> r.Next()] |> List.sort (fun x y -> x-y);; 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2009-07-31T17:22:52.740

**哈斯克尔：**

```
import Random
import List
main=newStdGen>>=print.sort.(take 100).randomRs(0,2^32) 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-12-08T21:59:01.133

在 BASH 中：

```
for i in `seq 100`; do echo $RANDOM; done | sort -n 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-12-08T21:20:19.747

Python 打印 100 个随机排序的整数

```
import random,sys
print sorted(random.randint(1,sys.maxint)for x in range(100)) 
```

[@Adam](https://stackoverflow.com/questions/350885/create-sort-and-print-a-list-of-random-ints-in-the-least-chars-of-code#350912)已经击败了我，但我认为使用 randint() 和 sys.maxint 无论如何都足以发布。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-12-09T03:34:55.667

[APL](http://en.wikipedia.org/wiki/APL_programming_language)（交互式）：

如果您希望数字 0-99（或 1-100，取决于您将工作区中的索引原点设置为 0 还是 1）是唯一的，则需要 8 个字符，如下所示：

`↑100?100`

如果您不关心唯一性，请执行以下操作（9 个字符）：

`↑?100ρ100`

想要更大的数字？只需将您的上限 N 替换为每行的第二个 100，您的随机数将在 0 - N-1 范围内（如果您的索引原点设置为 1，则为 1-N）。

如果您想保证您的数字范围为 0-99（或 0 - N-1，如果您要获得更大的上限），而不管索引原点设置如何，只需将上述任一行括在括号中并添加

`-⎕IO`

到最后（其中 ⎕ 是 APL 的四边形字符）。那是额外的6个字符。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-12-09T13:44:14.627

Javascript：（通过[JSDB](http://www.jsdb.org)或 Mozilla 的[Rhino](http://www.mozilla.org/rhino/shell.html)在 shell 模式下使用）

```
x=[];for(i=0;i<100;i++){x.push((Math.random()+"").slice(-8));};x.sort(); 
```

这是一个完整的测试运行：

```
c:\>java org.mozilla.javascript.tools.shell.Main
Rhino 1.7 release 1 2008 03 06
js> x=[];for(i=0;i<100;i++){x.push((Math.random()+"").slice(-8));};x.sort();
01499626,02403545,02800791,03320788,05748566,07789074,08998522,09040705,09115996,09379424,10940262,11743066,13806434,14113139,14336231,14382956,15581655,16573104,20043435,21234726,21473566,22078813,22378284,22884394,24241003,25108788,25257883,26286262,28212011,29596596,32566749,33329346,33655759,34344559,34666071,35159796,35310143,37233867,37490513,37685305,37845078,38525696,38589046,40538689,41813718,43116428,43658007,43790468,43791145,43809742,44984312,45115129,47283875,47415222,47434661,54777726,55394134,55798732,55969764,56654976,58329996,59079425,59841404,60161896,60185483,60747905,63075065,69348186,69376617,69680882,70145733,70347987,72551703,73122949,73507129,73609605,73979604,75183751,82218859,83285119,85332552,85570024,85968046,86236137,86700519,86974075,87232105,87839338,88577428,90559652,90587374,90916279,90934951,94311632,94422663,94788023,96394742,97573323,98403455,99465016 
```

编辑：看起来我可以通过直接分配而不是“推送”将它缩短几个字符，而且我不需要 {}：

```
x=[];for(i=0;i<100;i++)x[i]=(Math.random()+"").slice(-8);x.sort(); 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2009-08-03T15:34:33.170

电源外壳 ：

35 个字符（使用 PowerShell 社区扩展，替换`Get-Random`）：

```
0..99|%{[int]((random)*10000)}|sort 
```

20 个字符（普通 PowerShell v2）：

```
0..99|%{random}|sort 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-12-08T21:38:21.720

Perl，比 nrich 的版本短了整整 8 个字节，并且在“使用警告”下运行；:)

```
perl -wle "$,=' ';print sort map {int rand 100} 1..100" 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-12-08T21:52:44.437

爪哇：

```
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.Random;

class Rnd {
    public static void main(String[] args) {
        List<Integer> list = new ArrayList<Integer>(100);
        for (int i = 0; i < 100; i++) list.add(new Random().nextInt());
        Collections.sort(list);
        System.out.println(list);
    }
} 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-12-08T23:24:02.710

时髦的：

```
r=new Random()
List l=[]
100.times{ l << r.nextInt(1000) }
l.sort().each { println it } 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2008-12-09T14:02:31.720

Windows BATCH：160。这会在数字中添加前导零，但否则排序会有点混乱（因为排序按字符排序 - 它对数字一无所知）。

```
@echo off
set n=%random%.tmp
call :a >%n%
type %n%|sort
del /Q %n%
exit /B 0
:a
for /L %%i in (1,1,100) do call :b
exit /B 0
:b
set i=00000%random%
echo %i:~-5% 
```

作为单线和更短的方式（72）：

```
cmd/v/c"for /l %x in (0,1,99)do @(set x=0000!RANDOM!&echo !x:~-5!)"|sort 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2008-12-23T22:40:17.763

## Clojure

```
(defn gen-rands []
(sort (take 100 (repeatedly #(rand-int Integer/MAX_VALUE))))) 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2009-07-31T17:43:41.623

在 OCaml 中：

```
List.sort compare (let rec r = function 0 -> [] | a -> (Random.int 9999)::(r (a-1)) in r 100);; 
```

编辑：在 OCaml 中，在顶层键入将打印出列表，但如果您希望将列表打印到标准输出：

```
List.iter (fun x -> Printf.printf "%d\n" x) (List.sort compare (let rec r = function 0 -> [] | a -> (Random.int 9999)::(r (a-1)) in r 100));; 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-12-08T21:09:40.390

C＃：

```
using System;
using System.Collections.Generic;

class App
{
  static void Main()
  {
    List<int> TheList = new List<int>();
    Random r = new Random();
    for ( int i = 0; i < 10; i++ )
      TheList.Add(r.Next());
    TheList.Sort();
    foreach ( int i in TheList )
      Console.WriteLine(i);
  }
} 
```

如果您要获取原始字符数，则可以将其压缩更多。但基本上就是这样。

**编辑：**尝试2：

```
using System;

class App
{
  static void Main()
  {
    Random r= new Random();
    for ( int i = 0, j=0; i < 100; i++ )
      Console.WriteLine(j+=r.Next(int.MaxValue/100));
  }
} 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-12-08T21:12:47.810

Python（交互式）：

```
import random
[int(9*random.random())] 
```

什么？它创建一个包含一个随机整数的列表，对其进行排序（简单地），然后将其打印出来。

好的，这是一个严肃的答案

```
import random
sorted([int(9*random.random()) for x in range(9)]) 
```

它在 [0, 9) 中生成 9 个随机整数，对它们进行排序，然后打印它们（在交互式 shell 中）。

这是一个较短的变体，实际上产生了所需的 100：

```
from random import*
sorted(randint(0,9)for x in' '*100) 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2008-12-08T21:22:59.927

Tcl 死了。

# tcl 万岁。

创建一个 RANDOM (0-99) 长度列表并将 RANDOM (0-99) 整数放入其中。

也打印到屏幕上，并且可以完全按照 tcl 文件或 tcl shell 中所示的方式运行。

```
set l {}
proc r {} {expr { int(floor(rand()*99)) }}
for {set i 0} {$i<[r]} {incr i} {lappend l [r]}
puts [lsort -integer $l] 
```

* * *

# PHP 也不错。

完全确定锻炼

```
 <?
for($i=100;$i--;$l[]=rand());
sort($l);
print_r($l); 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2008-12-08T22:06:31.757

```
mzscheme -e "(sort (build-list 100 (λ x (random 9))) <)" 
```

他说最少的字符，而不是最少的字节。=)

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2008-12-08T23:04:10.877

C＃

如果您可以对数组大小施加限制，那么：

```
Array.ForEach(Guid.NewGuid().ToByteArray().OrderBy(c => c).ToArray(), c => Console.WriteLine(c)); 
```

否则，可以采用限制较少（但稍微冗长）的角度：

```
var r = new Random();
(new int[100]).Select(i => r.Next()).OrderBy(i => i).ToList().ForEach(Console.WriteLine); 
```

好吧，我想这是我最后一次回到这个...

**116 个字符**：

```
using System;
class A
{
    static void Main()
    {
        var r=new Random();
        var n=1D;
        for(int i=0;i<100;i++,Console.WriteLine(n+=r.Next()));
    }
} 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2008-12-09T14:55:38.150

C++ 不是这项工作的正确工具，但这里有：

```
#include <algorithm>
#include <stdio.h>

#define each(x) n=0; while(n<100) x

int main()
{
     int v[100], n;
     srand(time(0));
     each(v[n++]=rand());
     std::sort(v, v+100);
     each(printf("%d\n",v[n++]));
} 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2008-12-23T01:08:03.847

mackenir：改进了 7 个字符：

```
namespace System.Linq {
    class A {
        static void Main() {
            var r = new Random();
            new A[100].Select( i => r.Next() ).OrderBy( i => i ).ToList().ForEach( Console.WriteLine );
        }
    }
} 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2009-01-03T03:00:18.987

带升压的 C++。太糟糕了#include已经是所有文本的一半了:)

```
#include <boost/bind.hpp>
#include <algorithm>
#include <vector>
#include <iterator>
#include <cstdlib>
int main() {
    using namespace std;
    vector<int> a(100);
    transform(a.begin(), a.end(), a.begin(), boost::bind(&rand));
    sort(a.begin(), a.end());
    copy(a.begin(), a.end(), ostream_iterator<int>(cout, "\n"));
} 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2009-01-04T08:04:58.137

```
#!perl

print join "\n", sort { $a <=> $b } map { int rand 0xFFFFFFFF } 1 .. 100;

```

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2009-06-28T02:15:25.130

167 个字符的普通旧 c 代码：

```
main(){int i=100,x[i],n=i;while(i)x[--i]=rand();for(i=0;i<n;i++){int b=x[i],m=i,j=0;for(;j<n;j++)if(x[j]<x[m])m=j;x[i]=x[m];x[m]=b;}i=n;while(i)printf("%d ",x[--i]);} 
```

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2009-06-28T03:34:57.530

**Java，再次**

```
import java.util.*;
class R
{
    public static void main(String[]a)
    {
        List x=new Stack();
        while(x.size()<100)x.add((int)(Math.random()*9e9));
        Collections.sort(x);
        System.out.print(x);
    }
} 
```

我不认为它可以比这更短。我还剪掉了不必要的空间。

LE：哦，是的，它可以:) 受丁的帖子的启发..

```
import java.util.*;
class R
{
    public static void main(String[]a)
    {
        Set x=new TreeSet();
        while(x.size()<100)x.add((int)(Math.random()*9e9));
        System.out.print(x);
    }
} 
```

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2009-08-05T20:46:16.443

序言，78 个字符：

```
r([]).
r([H|T]):-random(0,1000000,H),r(T).
f(L):-length(R,100),r(R),sort(R,L). 
```

REPL 中的用法：

```
| ?- f(X).

X = [1251,4669,8789,8911,14984,23742,56213,57037,63537,91400,92620,108276,119079,142333,147308,151550,165893,166229,168975,174102,193298,205352,209594,225097,235321,266204,272888,275878,297271,301940,303985,345550,350280,352111,361328,364440,375854,377868,385223,392425,425140,445678,450775,457946,462066,468444,479858,484924,491882,504791,513519,517089,519866,531646,539337,563568,571166,572387,584991,587890,599029,601745,607147,607666,608947,611480,657287,663024,677185,691162,699737,710479,726470,726654,734985,743713,744415,746582,751525,779632,783294,802581,802856,808715,822814,837585,840118,843627,858917,862213,875946,895935,918762,925689,949127,955871,988494,989959,996765,999664]

yes 
```

正如我的一些老师所说，这是不言自明的:-)

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2010-02-22T07:40:23.957

## Golfscript - 15 个字符

```
[100.{rand}+*]$ 
```

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2010-02-25T02:20:52.083

xkcd 风格的 Python 答案 - 比当前答案更短！

```
print [4]*100 
```

真正的答案，63 个字符：

```
from random import*;print sorted(randrange(9e9)for i in[0]*100) 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2008-12-08T21:15:34.730

打印在 C++ 中排序的 [0,100] 范围内的随机 100 个随机数

```
srand((unsigned int)time(NULL)); list<int> r;
for (int i=0;i<100;i++) r.push_back((int)((100)*rand()/(float)RAND_MAX));
r.sort();
for (list<int>::iterator j=r.begin();j!=r.end();j++) cout << *j << endl; 
```

如果您不关心奇偶校验，请替换`r.push_back((int)((100)*rand()/(float)RAND_MAX))`为`r.push_back(rand()%(101))`

--

这是一个 200 个字符的完整程序：

```
#include <algorithm>
#include <iostream>
#include <random>
using namespace std;int main(){int a[100];generate_n(a,100,tr1::mt19937());sort(a,a+100);for(int i=0;i<100;++i){cout<<a[i]<<endl;}return 0;} 
```

数组符号比我能找到的任何标准容器都要短。 `tr1::mt19937`是我能找到的最短的随机数生成器。 `using namespace std;`比几个实例短`std::`。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2008-12-08T21:18:07.283

Common Lisp（我记得，可能有一些细节错误）：

```
(setf a '(99 61 47))
(setf a (sort a))
(princ a) 
```

数字当然是随机的；我现在通过掷骰子选择了它们。

（也许我们可以把定义收紧一点？）

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2008-12-08T21:30:59.740

Perl 命令行：

```
perl -e 'print $_, "\n" foreach sort map {int rand 10} (1..10)' 
```

打印 0 到 9 之间的 10 个整数并对其进行排序。

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2008-12-08T21:41:04.197

爪哇：

```
 public void randList()
  {
  final int NUM_INTS = 100;
  Random r = new Random();
  List<Integer> s = new ArrayList<Integer>();

  for(int i = 0; i < NUM_INTS; i++)
    s.add(r.nextInt());

  Collections.sort(s);

  for(Integer i : s)
    System.out.println(i);
  } 
```

可能会更短，但上面的内容非常清楚并且大部分符合最佳实践。这将生成警告（原始类型）并且具有错误的变量名称，但会更短一些。

```
 void rl()
  {
  Random r = new Random();
  List s = new ArrayList();

  for(int i = 0; i < 100; i++)
    s.add(r.nextInt());

  for(Object i : s)
    System.out.println((Integer) i);
  } 
```

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2008-12-08T21:42:02.150

我不会接受它作为程序规范，太不精确了！:-)

卢阿版本：

```
t=table;l={}for i=1,20 do l[#l+1]=math.random(99)end;t.sort(l)print(t.concat(l,' ')) 
```

可能会稍微缩短，也可能会有更智能的代码。

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2008-12-08T21:59:05.830

一个命令行 PHP 单行（是的，尾随分号是必需的......）

```
php -r 'while (++$i % 101) $j[] = rand(0, 99); sort($j); echo implode(" ", $j)."\n";' 
```

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2008-12-08T23:07:53.007

**VB - 151 个字符**：

可悲的是，它不如 C# 优雅......

```
Sub Main()
    Dim r = New Random
    Enumerable.Range(1, 100) _
      .Select(Function(i) r.Next) _
      .OrderBy(Function(i) i) _
      .ToList _
      .ForEach(AddressOf Console.WriteLine)
End Sub 
```

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2008-12-09T00:33:00.450

这不是一个玩笑。这是我目前能做的最好的。:)

JavaScript：

```
a=[];for(i=0;i<100;i++){b=Math.round(Math.random()*100);a[i]=b;}c=0;
while(c==0){c=1;for(j=0;j<99;j++){if(a[j]>a[j+1]){d=a[j];a[j]=a[j+1];a[j+1]=d;c=0;}}}
for(k=0;k<100;k++)document.write(a[k],"<br>") 
```

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2008-12-09T04:47:24.587

这是我可以用 Delphi 2007 Win32 控制台应用程序做的最好的事情（除了删除一些换行符和缩进）：

```
{$APPTYPE CONSOLE}
var a:array[0..99] of integer; i,j,k:integer;
begin
  FOR i:=0 to 99 DO a[i]:=random(maxint)+1;
  FOR i:=0 to 98 DO
    FOR j:=i+1 to 99 DO
      IF a[j]<a[i] THEN begin
        k:=a[i]; a[i]:=a[j]; a[j]:=k
      end;
  FOR i:=0 to 99 DO writeln(a[i])
end. 
```

AFAIK，没有一个标准单元包含排序程序，所以我不得不写我知道的最短的一个。此外，由于我没有调用 Randomize，因此每次运行时都会产生相同的结果。

编辑：我采用“正整数”来表示整数类型范围内的每个正（非零）数，因此使用 maxint（系统常数）和“+1”来确保它不为零。

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2008-12-09T13:56:58.190

普通的旧 C，没有那么小以至于被混淆：

```
#include <stdio.h>
#include <stdlib.h>
static int cmp(const void *a, const void *b)
{
    return *(const int *) a > *(const int *) b;
}
int main(void)
{
    int x[100], i;
    for(i = 0; i < 100; i++)
            x[i] = rand();
    qsort(x, 100, sizeof *x, cmp);
    for(i = 0; i < 100; i++)
            printf("%d\n", x[i]);
    return 0;
} 
```

这在 Linux 中使用 gcc 4.1.2 构建而没有警告。在实际代码中，我当然会：

*   返回 EXIT_SUCCESS 而不是 0
*   只写 100 一次，并`sizeof x`用于剩余的引用

* * *

## 回答 #47

> 赞同：0
> 
> 时间：2008-12-09T14:55:23.890

[派克](http://pike.ida.liu.se/)

```
void main() {
  array a=({});
  while (sizeof(a)<100) a+=({random(1<<30)});
  sort(a);
  foreach (a, int b) write("%d\n",b);
} 
```

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2008-12-18T15:02:49.380

我无法编辑或评论，所以这里是 Java v3（前 2 个有负数）：

```
import java.util.TreeSet;

class Test {

    public static void main(String[] args) {
        Collection<Double> s = new TreeSet<Double>();
        while (s.size() < 100) s.add(Math.random());
        System.out.println(s);
    }
} 
```

* * *

## 回答 #49

> 赞同：0
> 
> 时间：2008-12-23T21:50:57.630

Erlang，157 个字符

```
-module (intpr).
-export ([q/0]).
q() ->
    lists:foldl(
    fun(X,A)->io:format("~p,",[X]),A end, 
    n, 
    lists:sort( 
        lists:map(fun(_)->random:uniform(100) end, lists:seq(1,100)) 
    )
    ). 
```

当然这不是最好的 erlang 解决方案，基本上它会创建一个从 1 到 100 的列表（只是因为我没有找到更好/更短的初始化列表的方法）并使用随机整数（<100）映射每个项目，然后结果列表已排序。最后，列表是“折叠的”，用作浏览所有项目并打印它们的一种方式。

* * *

## 回答 #50

> 赞同：0
> 
> 时间：2008-12-24T00:44:13.007

你会认为 SQL 会擅长这种事情：-

```
SELECT * FROM
(SELECT TRUNC(dbms_random.value(1,100)) r
FROM user_objects
WHERE rownum < 101)
ORDER BY r 
```

这是 108 个字符的 Oracle 版本。有人可能会在使用 TOP 100 语法的不同变体中做得更好。

编辑，82 个字符：

```
select trunc(dbms_random.value(1,100))
from dual 
connect by level < 101
order by 1 
```

* * *

## 回答 #51

> 赞同：0
> 
> 时间：2009-01-04T07:23:02.903

Delphi...按字母排序的版本

```
program PrintRandomSorted;

{$APPTYPE CONSOLE}
uses SysUtils,Classes;

var I:Byte;
begin
  with TStringList.Create do
  begin
    for I in [0..99] do
      Add(IntToStr(Random(MaxInt)));
    Sort; Write(Text); Free;
  end;
end. 
```

* * *

正确排序，使用泛型..

```
program PrintRandomSorted;
{$APPTYPE CONSOLE}
uses SysUtils, generics.collections;
var I:Byte;S:String;
begin
  with TList<Integer>.Create do
  begin
    for I in [0..99] do Add(Random(MaxInt));
    Sort;
    for I in [0..99] do WriteLn(Items[I]);
    Free;
  end;
end. 
```

* * *

## 回答 #52

> 赞同：0
> 
> 时间：2009-01-29T09:33:55.963

请注意，没有人用 C 或 C++ 给出答案？

一旦它们被称为高级语言（与汇编程序相比）。好吧，我想现在他们是低级的。

* * *

## 回答 #53

> 赞同：0
> 
> 时间：2009-07-31T17:39:15.470

蟒蛇，71个字符

```
import random
print sorted(random.randint(0,2**31)for i in range(100)) 
```

* * *

## 回答 #54

> 赞同：0
> 
> 时间：2009-07-31T17:58:25.057

冷融合：

```
<cfloop index="i" to="100" from="1">
    <cfset a[i] = randrange(1,10000)>
</cfloop>

<cfset ArraySort(a, "numeric")>

<cfdump var="#a#"> 
```

* * *

## 回答 #55

> 赞同：0
> 
> 时间：2009-08-03T15:25:30.563

Qt4 版本 (c++)，116 个字符。

```
#include <QtCore>
int main(){QList<int>l;int i=101;while(--i)l<<qrand()%101;qSort(l);foreach(i,l)printf("%d\n",i);}

-> wc -c main.cpp
116 main.cpp 
```

* * *

## 回答 #56

> 赞同：0
> 
> 时间：2009-08-03T16:19:53.657

C＃

```
var sequence = Enumerable.Range(1, 100)
                         .OrderBy(n => n * n * (new Random()).Next());

foreach (var el in sequence.OrderBy(n => n))
    Console.Out.WriteLine(el); 
```

F＃

```
let rnd = System.Random(System.DateTime.Now.Millisecond)

List.init 100 (fun _ -> rnd.Next(100)) 
|> List.sort 
|> List.iter (fun (x: int) -> System.Console.Out.WriteLine(x)) 
```

* * *

## 回答 #57

> 赞同：0
> 
> 时间：2009-12-08T10:47:26.150

C 没有分配一个数组（基本上是在最后一个打印的值上添加一个随机整数，隐式排序）：

```
#include <stdlib.h>

int main(int argc, char **argv) {
    int i;
    unsigned long baseline = 0;
    srand(atoi(argv[1]));
    for ( i = 0 ; i < 100 ; i++ ) {
        baseline += rand();
        printf("%ld\n", baseline);
    }

} 
```

通过通常的混淆+换行符的删除，可以减少到 136 个字符。

ps：很明显，在命令行上使用 $RANDOM 运行。

* * *

## 回答 #58

> 赞同：0
> 
> 时间：2010-02-20T12:30:47.457

C＃

```
var r=new Random();
var l=from i in new C[100] let n=r.Next() orderby n select n; 
```

81 个字符（包括换行符）

* * *

## 回答 #59

> 赞同：0
> 
> 时间：2010-02-20T12:44:32.820

MATLAB：

```
arrayfun( @(x) display(x), sort( rand(1,100) ) ) 
```

* * *

## 回答 #60

> 赞同：0
> 
> 时间：2010-02-22T03:49:59.767

**使用 C - 152 个字符**

```
main(){int a=100,b,t,x[a];while(a--)x[a]=rand();a=100;while(b=a--)while(b--)if(x[a]>x[b]){t=x[a];x[a]=x[b];x[b]=t;}a=100;while(a--)printf("%d\n",x[a]);} 
```

或扩大

```
#include <stdio.h>
int main()
{
    int a=100,b,t,x[a];

    while(a--)x[a]=rand();
    a=100;

    while(b=a--)
        while(b--)
            if(x[a]>x[b])
            {
                t=x[a];
                x[a]=x[b];
                x[b]=t;
            }

    a=100;
    while(a--)
        printf("%d\n",x[a]);
} 
```

* * *

## 回答 #61

> 赞同：0
> 
> 时间：2010-02-23T05:56:16.803

: [_](http://www.r-project.org "R")

`sort(round(runif(100)*99+1))`

* * *

## 回答 #62

> 赞同：0
> 
> 时间：2010-02-23T09:16:08.883

**Windows 命令外壳 - 71 个字符**

```
cmd/v/c"for /L %i in (0,1,99)do @set r=     !random!&echo !r:~-5!"|sort 
```

* * *

## 回答 #63

> 赞同：0
> 
> 时间：2010-05-20T02:28:21.430

**斯卡拉：（61 个字符）**

```
1 to 100 map {_ ⇒ Random.nextInt} sortBy identity foreach println 
```

**编辑：**

通过定义内联可以进一步压缩**（56 个字符）**`identity`。

```
1 to 100 map {_ ⇒ Random.nextInt} sortBy {i ⇒ i} foreach println 
```

# apache - 如何在 Apache Tomcat 中创建“别名”？

> ID：350901
> 
> 赞同：10
> 
> 时间：2008-12-08T21:08:49.270
> 
> 标签：apache, tomcat, aliases, context.xml

我正在开发一个允许用户上传附件的 Web 应用程序。这些附件存储在与 Web 应用程序不同的驱动器上。如何为该驱动器创建一个别名（相当于 Apache HTTP 服务器的别名），以便用户可以下载这些附件？

目前我正在创建一个上下文文件并将其转储到 CATALINA_HOME/conf/Catalina/localhost 中，但它经常被随机删除。上下文文件名为 attachments.xml，内容如下所示。我还阅读了有关虚拟主机的信息，但如果我理解正确，那么虚拟主机不是我想要的。我正在使用 6.0.18 版的 Apache Tomcat。

*附件.xml：*

```
<?xml version="1.0" encoding="UTF-8"?>
<Context docBase    = "e:\uploads\attachments"
     reloadable = "true"
     crossContext   = "true">
</Context> 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-09T13:36:04.940

我花了很多时间研究这个问题，找到了解决上下文文件随机删除的解决方案。我在 Apache 的网站上的主机配置部分找到了这段摘录：

> 您可以在此 Host 元素中嵌套一个或多个 Context 元素，每个元素代表与此虚拟主机关联的不同 Web 应用程序。

虚拟主机存储在位于*CATALINA_HOME\conf的**server.xml*文件中。Tomcat 配置了*localhost*作为默认主机。因此，如果我们从第一篇文章中添加*附件.xml的内容，我们会得到以下内容：*

 ***```
<Host name="localhost"  appBase="webapps"
    unpackWARs="true" autoDeploy="true"
    xmlValidation="false" xmlNamespaceAware="false">

    <Context path="/attachments"
             docBase="e:\uploads\attachments"
             reloadable="true"
             crossContext="true" />
</Host> 
```

我认为，这与定义类似于 Apache 的 HTTP 服务器的别名非常接近。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-14T10:35:15.727

有多种选择。

1.  使用 Apache 作为前端，通过 mod_jk 或 mod_proxy 委托给 tomcat
2.  在您自己的应用程序中提供下载 servlet，为请求的文件提供服务
3.  制作您希望 tomcat 交付 Web 应用程序的目录

每个都有一些缺点和一些优点。出于多种原因，我非常喜欢第一种解决方案：

*   我的主要原因适用于 unixoid 系统，你显然不是在谈论：只有 root 可以绑定低于 1024 的端口，例如 80。因此，tomcat 需要以 root 身份运行（我知道有机制允许用户绑定到低端口，但我从来没有使用过它们）。Apache 通常以 root 身份启动，但一旦绑定端口 80，就会放弃这些权限。
*   据说 Apache 在提供静态资源方面比 tomcat 好很多（我从来没有测量过，但很难相信相反）
*   您显然知道如何在 apache 中创建别名 - 这样做很简单。

关于下载 servlet：

这样，您将拥有一个为您的静态资源提供服务的 servlet，您可以将其绑定到 URL“/download/*”（例如，在还处理文件上传的应用程序中）您将获得：

*   您只需要配置一次文件存储的目录
*   如果您需要，您可以轻松实施权限检查（例如下载需要登录）
*   您只需部署一个完全独立的应用程序。
*   下载 servlet 很简单 - 找到文件，在输出流中设置它的名称和文件类型并逐字节流式传输，然后关闭输出流（确保处理攻击文件名，如“/download/../../ ../../etc/passwd" 或 "/download/C:/WINDOWS/someimportantfile.xxx")，例如通过使用获取基目录作为单独参数的 java.io.File 构造函数。

第三种选择有一些严重的缺点，如果你不特别注意它们，就会让你受到攻击：

*   Tomcat 不提供目录，而是提供 webapps。因此“E:/upload/attachments”至少需要一个名为“WEB-INF”的目录，其中包含“web.xml”。注意不要从上传的 Web 应用程序中提供对该目录和文件的写访问权限。有了这个规定，您可以让 tomcat 为目录提供服务。
*   但是：将包含的 web.xml 配置为不将“*.jsp”作为 jsp 提供，否则 tomcat 不仅会传递 jsp 文件，还会执行它们。`<% System.exit(0); %>`想象一下有人上传带有或更多恶意内容的“index.jsp” 。

一个额外的想法：你不需要额外的`crosscontext="true"`. 这意味着您部署的只是为您的文件提供服务的 web 应用程序可以访问其他 web 应用程序，例如能够管理它们或访问它们的私有数据。通常你根本不需要那个，在你的问题的情况下你肯定不想要那个。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-10-03T19:26:18.583

See the initial part of my newer question for ways to do this by editing the context.xml file [How do I add aliases to a Servlet Context in java?](https://stackoverflow.com/questions/12715331/how-do-i-add-aliases-to-a-servelet-context-in-java-code). According to several people now, it is no longer necessary (2012: Tomcat 6 or 7) to use Apache for performance reasons over Tomcat for serving static content.

# windows - Windows 上的 git-svn。从哪里获得二进制文件？

> ID：350907
> 
> 赞同：67
> 
> 时间：2008-12-08T21:11:38.750
> 
> 标签：windows, svn, git

我想将 git 用作针对远程 SVN 存储库的本地存储库。[我从http://code.google.com/p/msysgit/downloads/list](http://code.google.com/p/msysgit/downloads/list)安装了 1.6.0.2 版。

根据文档同步是通过命令完成的

```
git svn 
```

或一个单独的命令包装器，称为

```
git-svn 
```

它们在我的安装中都不可用，而且我找不到 Windows 二进制文件的单独下载。

我目前正在使用 MSYS 构建。我必须切换到cygwin吗？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2011-03-15T15:08:42.203

git-svn 安装在最新版本的 msysgit 中。但是，有一点需要注意：虽然 git-svn 在 C:\Program Files\git\libexec 中显示为“git-svn”，但 svn 实际上是作为 git 可执行文件的参数调用的，因此：

```
git svn clone http://example.com/svn/repo/ 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-08T23:24:29.743

[这个早期版本](http://msysgit.googlecode.com/files/Git-1.5.5-preview20080413.exe)有工作的 git-svn。我认为您安装的当前版本中的 git-svn 是固定的，但可能不是。Git-svn 绝对不能在 Git 1.5.6.1 的 windows 版本中工作。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-03-15T18:05:06.807

安装[cygwin](http://www.cygwin.com)，选择Devel类别下的git-svn包。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-09T18:01:57.383

该`git svn`命令是用 Perl 编写的，需要 Subversion Perl 库。`svn`命令行命令的存在是不够的`git-svn`。

我没有`git svn`在 Windows 上使用过（仅在 Unix 和 Mac OS X 上），所以我不能真正提供更多细节，但希望这能为您指明正确的方向。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-08T21:21:40.257

我不知道 git，但我知道对于 Mercurial，例如，您必须安装 SVN 才能从 SVN 转换为 Mercurial（并返回）。也许 git 也一样？

SVN 本身就相当大，因此并发系统可能不想将其与他们的软件一起分发，从而使下载变得臃肿。

我使用了[Slik SVN](http://www.sliksvn.com/ "颠覆 |  斯利克SVN")的命令行 SVN 客户端，不是太大并且安装干净。

当然，等待更明智的答案，或搜索网络以确认我的信息... :-) 虽然拥有 SVN 客户端并没有什么坏处，因为很多项目都使用它。

# java - 使用 wait/notifyAll 正确同步 Java 线程？

> ID：350914
> 
> 赞同：1
> 
> 时间：2008-12-08T21:13:28.213
> 
> 标签：java, concurrency, thread-safety

这是我的应用程序的简化版本，显示了我在做什么。

```
/*
in my app's main():

    Runner run = new Runner();

    run.dowork();

*/

class Runner
{
    private int totalWorkers = 2;
    private int workersDone = 0;

    public synchronized void workerDone()
    {
        workersDone++;
        notifyAll();
    }

    public synchronized void dowork()
    {
        workersDone = 0;

        //<code for opening a file here, other setup here, etc>

        Worker a = new Worker(this);
        Worker b = new Worker(this);

        while ((line = reader.readLine()) != null)
        {
            //<a large amount of processing on 'line'>

            a.setData(line);
            b.setData(line);

            while (workersDone < totalWorkers)
            {
                wait();
            }               
        }
    }
}

class Worker implements Runnable
{
    private Runner runner;
    private String data;

    public Worker(Runner r)
    {
        this.runner = r;
        Thread t = new Thread(this);
        t.start();
    }

    public synchronized void setData(String s)
    {
        this.data = s;
        notifyAll();
    }

    public void run
    {
        while (true)
        {
            synchronized(this)
            {
                wait();

                //<do work with this.data here>

                this.runner.workerDone();
            }
        }
    }
} 
```

这里的基本概念是我有一群工作人员，他们都独立地对传入的数据行进行一些处理，并在他们喜欢的任何地方写出数据 - 他们不需要将任何数据报告回主线程或彼此共享数据。

我遇到的问题是这段代码死锁了。我正在阅读一个超过 100 万行的文件，我很幸运在我的应用程序停止响应之前获得了 100 行。

实际上，工人们都在做不同数量的工作，所以我想等到他们都完成后再去下一条生产线。

我不能让工作人员以不同的速度处理并在内部对数据进行排队，因为我正在处理的文件太大而无法放入内存。

我不能给每个工人自己的 FileReader 来独立获取“线”，因为我在工人看到它之前就在线上进行了大量处理，并且不想在每个工人中重新进行处理。

我知道我在 Java 中缺少一些相当简单的同步方面，但我被困在这一点上。如果有人能解释我在这里做错了什么，我将不胜感激。我相信我误解了同步的某些方面，但我没有尝试修复它的想法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T21:23:38.427

直接使用`synchronized`,`wait()`和`notify()`绝对是棘手的。

幸运的是，[Java 并发 API](http://java.sun.com/javase/6/docs/api/java/util/concurrent/package-summary.html)为这类事情提供了一些非常直观的控制对象。特别是看[`CyclicBarrier`](http://java.sun.com/javase/6/docs/api/java/util/concurrent/CyclicBarrier.html)and [`CountDownLatch`](http://java.sun.com/javase/6/docs/api/java/util/concurrent/CountDownLatch.html); 其中之一几乎肯定会是您正在寻找的东西。

对于这种情况，您可能还会发现一个[`ThreadPoolExecutor`](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ThreadPoolExecutor.html)很方便的。

这是您的代码段的一个简单示例/转换，它产生以下输出（当然没有死锁）：

> 读取线：1号线
> 等待工作完成在线：1号
> 线 在线工作：1号线 在线
> 工作：1号线
> 读取线：2号线 在线
> 等待工作完成：2号线 在线
> 工作：2号线
> 在线工作：第 2
> 行 读取行：第 3 行
> 等待在线工作完成：第 3
> 行 在线工作：第 3 行 在线
> 工作：第 3 行
> 全部工作完成！

```
public class Runner
{

    public static void main(String args[]) {
        Runner r = new Runner();
        try {
            r.dowork();
        } catch (IOException e) {
            // handle
            e.printStackTrace();
        }
    }

    CyclicBarrier barrier;
    ExecutorService executor;
    private int totalWorkers = 2;

    public Runner() {
        this.barrier = new CyclicBarrier(this.totalWorkers + 1);
        this.executor = Executors.newFixedThreadPool(this.totalWorkers);
    }

    public synchronized void dowork() throws IOException
    {
        //<code for opening a file here, other setup here, etc>
        //BufferedReader reader = null;
        //String line;

        final Worker worker = new Worker();

        for(String line : new String[]{"Line 1", "Line 2", "Line 3"})
        //while ((line = reader.readLine()) != null)
        {
            System.out.println("Read line: " + line);
            //<a large amount of processing on 'line'>

            for(int c = 0; c < this.totalWorkers; c++) {
                final String curLine = line;
                this.executor.submit(new Runnable() {
                    public void run() {
                        worker.doWork(curLine);
                    }
                });
            }

            try {
                System.out.println("Waiting for work to be complete on line: " + line);
                this.barrier.await();
            } catch (InterruptedException e) {
                // handle
                e.printStackTrace();
            } catch (BrokenBarrierException e) {
                // handle
                e.printStackTrace();
            }
        }

        System.out.println("All work complete!");
    }

    class Worker
    {
        public void doWork(String line)
        {
            //<do work with this.data here>
            System.out.println("Working on line: " + line);

            try {
                Runner.this.barrier.await();
            } catch (InterruptedException e) {
                // handle
                e.printStackTrace();
            } catch (BrokenBarrierException e) {
                // handle
                e.printStackTrace();
            }
        }
    }    
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T21:23:15.043

恕我直言，您错误地放置了“workersDone = 0”。

```
public synchronized void dowork()
        {
                // workersDone = 0;

                //<code for opening a file here, other setup here, etc>

                Worker a = new Worker(this);
                Worker b = new Worker(this);

                while ((line = reader.readLine()) != null)
                {
                        workersDone = 0;

                        //<a large amount of processing on 'line'>

                        a.setData(line);
                        b.setData(line);

                        while (workersDone < totalWorkers)
                        {
                                wait();
                        }                               
                }
        } 
```

# visual-studio - 运行 Web Developer Express 时如何清除 IE 的缓存？

> ID：350918
> 
> 赞同：2
> 
> 时间：2008-12-08T21:14:04.673
> 
> 标签：visual-studio, internet-explorer, caching

我正在尝试为我正在开发的网站调试一些仅限 IE 的问题。我正在运行 WDE，因为 IE 没有 Firebug。我想看看某些更改是否修复了错误，但无论我做什么，IE 都不会接受我的更改。我已经尝试了以下所有方法：

*   停止并重新启动调试环境
*   关闭和重新打开 WDE
*   关闭和重新打开 IE
*   清除 IE 的“临时网络文件”
*   发誓微软开发了如此糟糕的软件

有什么帮助吗？我可以清除驱动器上某处的一些缓存文件吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T21:19:50.200

IE 开发工具栏有*“清除浏览器缓存...”*和*“清除该域的浏览器缓存...”*菜单项。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T21:17:03.310

你试过ctrl+f5吗？它重新加载当前页面并清除缓存。如果即使在那之后您的更改也没有传播，那么您的代码中的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-10-22T06:15:59.943

添加这个：

```
window.applicationCache.addEventListener('updateready', function (e)
{
  if (window.applicationCache.status == window.applicationCache.UPDATEREADY)
  {
    window.applicationCache.swapCache();
    if (confirm('A new version of this site is available. Load it?'))
     window.location.reload();
  }
}, false); 
```

我在网络的某个地方找到了这个解决方案。对不起，我不记得作者了。当我在 IE 中使用 JavaScript 调试 Web 应用程序时，它适用于我。

# perl - 我如何告诉 CPAN.pm 从哪里获取模块？

> ID：350919
> 
> 赞同：13
> 
> 时间：2008-12-08T21:15:11.987
> 
> 标签：perl, yaml, cpan

这是 CPAN 的完整安装命令和输出：

```
sudo perl -MCPAN -e "install Bundle::CPAN"
CPAN: Storable loaded ok (v2.13)
Going to read /home/delgreco/.cpan/Metadata
  Database was generated on Mon, 08 Dec 2008 03:27:10 GMT
CPAN: LWP::UserAgent loaded ok (v2.033)
CPAN: Time::HiRes loaded ok (v1.55)
CPAN: YAML loaded ok (v0.39)
Warning: YAML version '0.39' is too low, please upgrade!
I'll continue but problems are *very* likely to happen.
Your urllist is empty! The urllist can be edited. E.g. with 'o conf urllist
push ftp://myurl/'

Could not fetch authors/id/A/AN/ANDK/Bundle-CPAN-1.857.tar.gz
Giving up on '/home/delgreco/.cpan/sources/authors/id/A/AN/ANDK/Bundle-CPAN-1.857.tar.gz'
Note: Current database in memory was generated on Mon, 08 Dec 2008 03:27:10 GMT

        ...propagated at /usr/lib/perl5/5.8.5/CPAN.pm line 3417. 
```

这对我有用，谢谢...

> cpan> o conf urllist [http://cpan.yahoo.com/](http://cpan.yahoo.com/)

当然，Bundle::CPAN 安装在其他依赖项上继续失败，但至少我现在有一个 YAML 0.68。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-08T21:35:15.753

这看起来很重要：

```
你的 urllist 是空的！可以编辑 urllist。例如，使用 'o conf urllist push ftp://myurl/'

```

也许 run `sudo cpan`，然后`o conf init`或`o conf urllist push http://cpan.yahoo.com/`（例如）让你`urllist`理顺？然后尝试进行安装。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T17:47:08.147

当您第一次使用 CPAN 模块时，系统会询问您“您准备好进行交互式配置了吗？”。你可能会回答“不”。选择了默认配置选项，因此没有配置 CPAN 存储库镜像供您从中提取模块 tarball。

正如其他人所指出的，您可以使用 CPAN shell 中的 o conf urllist 命令配置该选项。

我个人的偏好是创建一个“miniCPAN”，一个基本上包含每个模块的最新版本的本地存储库（比拉取所有 CPAN 小得多，后者将包含每个模块的许多过时版本）。为此，请配置一个 CPAN 镜像存储库以临时使用，从中安装 CPAN::Mini 模块，然后使用将安装的 minicpan 命令行程序来创建您的存储库。现在使用 o conf urllist pop 删除您配置的 CPAN 镜像，并使用 o conf urllist push file:///path/to/your/minicpan 告诉 CPAN 模块从现在开始从您的本地镜像安装。您可以将 minicpan 命令放在 cron 中以定期更新，或者只要您想刷新就从命令行运行它。

minicpan 命令的格式是

```
minicpan -l /path/to/your/local/minicpan-repository -r http://example.com/url/of/CPAN/mirror 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T21:16:04.293

猜测：

```
sudo perl -MCPAN -e "install YAML" 
```

# php - PHP new 运算符返回引用

> ID：350920
> 
> 赞同：3
> 
> 时间：2008-12-08T21:15:17.960
> 
> 标签：php, reference

我正在使用一些旧的 PHP 代码，其中包含以下内容：

```
$someVar =& new SomeClass(); 
```

**new**运算符是否曾经返回一个值，嗯，不是通过引用？（打字感觉很奇怪。我觉得我疯了。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T21:25:54.477

它是许多关于 PHP 4 中 OOP 的旧书籍中教授的那种优化技术之一。

基本上，在内存中创建的初始对象是应用程序无法访问的对象，除非您通过引用返回实例。否则，您将获得该对象的副本 - 唯一的问题是原始存在没有符号。有点傻

但是，PHP 4 中的对象创建、传递和引用是一个巨大的混乱。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-08T21:19:25.410

那是PHP4代码。从文档中：（现已删除）

> 默认情况下，“new”不返回引用，而是返回一个副本。

~~[1]： http: [//no.php.net/manual/en/language.oop.newref.php](http://no.php.net/manual/en/language.oop.newref.php)~~

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-24T13:54:57.480

另请参阅我的答案[，](https://stackoverflow.com/questions/475990/php-by-reference#476023)其中包括一个简单的代码示例来说明问题。

# c++ - printf("something\n") 输出 "something" (附加空间) (g++/linux/用 gedit 读取输出文件)

> ID：350922
> 
> 赞同：0
> 
> 时间：2008-12-08T21:15:37.460
> 
> 标签：c++, printing, stdout, stdin

我有一个简单的 C++ 程序，它读取`stdin`using`scanf`并将结果返回到`stdout`using `printf`：

```
 #include <iostream>
using namespace std;

int main()
{
    int n, x;
    int f=0, s=0, t=0;

    scanf("%d",&n); scanf("%d",&x);

    for(int index=0; index<n; index++)
    {
        scanf("%d",&f);
        scanf("%d",&s);
        scanf("%d",&t);

        if(x < f)
        {
            printf("first\n");
        }
        else if(x<s)
        {
            printf("second\n");
        }
        else if(x<t)
        {
            printf("third\n");
        }
        else
        {
            printf("empty\n");
        }
    }

    return 0;
}
```

我正在用 g++ 编译并在 linux 下运行。我使用文本文件作为输入执行程序，并将输出通过管道传输到另一个文本文件，如下所示：

> 程序 <in.txt> out.txt

问题是 out.txt 看起来像这样：

> 结果1_
> 结果2_ 结果
> 3_
> ...

其中 '_' 是每行末尾的额外空格。我正在 gedit 中查看 out.txt。

如何在没有额外空间的情况下产生输出？

我的输入文件如下所示：

> 2 123
> 123 123 123
> 123 234 212

**编辑：**我能够找到解决此问题的方法：`printf("\rfoo");` 感谢您的输入！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T21:45:17.213

行尾字符是：

```
System  Hex     Value   Type
Mac     0D      13      CR
DOS     0D 0A   13 10   CR LF
Unix    0A      10      LF 
```

对于每个系统上的行尾，您可以：

```
printf("%c", 13);
printf("%c%c", 13, 10);
printf("%c", 10); 
```

你可以像这样使用它

```
printf("empty");
printf("%c", 10); 
```

维基百科换行文章[在这里。](http://en.wikipedia.org/wiki/Newline)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T21:45:21.537

`printf()`尝试从您的语句中删除“\n” ，然后再次运行代码。如果输出文件看起来像一个长单词（没有空格），那么您知道在文本之后插入的唯一内容是 '\n'。

我假设您用来读取 out.txt 文件的编辑器只是让它*看起来*在输出之后有一个额外的空间。

如果还是不确定，可以编写一个快速程序读入 out.txt 并确定每个字符的 ASCII 码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T21:56:51.123

好的，这有点难以弄清楚，因为示例程序有很多错误：

```
g++ -o example example.cc
example.cc: In function 'int main()':
example.cc:19: error: 'k' was not declared in this scope
example.cc:22: error: 'o' was not declared in this scope
example.cc:24: error: 'd' was not declared in this scope
make: *** [example] Error 1 
```

但这不会是您的输入文件；您的 scanf 将加载您在`int`s 中输入的任何内容。这个例子，虽然：

```
/* scan -- try scanf */
#include <stdio.h>

int main(){
    int n ;
    (void) scanf("%d",&n);
    printf("%d\n", n);
    return 0;
} 
```

产生了这个结果：

```
bash $ ./scan | od -c
42
0000000    4   2  \n                                                    
0000003 
```

在 Mac OS/X 上。给我们一份您实际运行的代码的副本，以及 od -c 的结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T21:39:28.130

正如 timhon 所问的，这里需要更多信息，您在哪个环境下工作？Linux、Windows、Mac？另外，您使用的是什么文本编辑器来显示这些额外的空格？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T21:41:30.093

我的猜测是你的空间并不是真正的空间。跑

```
od -hc out.txt 
```

仔细检查它是否真的是一个空间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T21:46:16.683

首先，您提供的代码示例未编译为 o 和 d 未定义...

其次，您可能在从输入文件中读取的行的末尾有空格。试试用vi打开看看。否则，您可以在输出之前在每一行上调用一个修剪函数并完成它。

祝你好运！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-08T21:46:40.410

确保您正在查看您期望的程序的输出；这有一个语法错误（没有“;”之后`int n`）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-01T03:52:26.017

我觉得它甚至不接近这个，但如果你在 Windows 上运行它，你会得到 \r\n 作为行终止符，并且，也许，在 *nix 下，在非 Windows 感知的文本编辑器下，你'将得到 \r 作为公共空格，因为 \r 不可打印。

远射，最好的测试方法是使用十六进制编辑器并自己查看文件。

# java - TestNG 中的超时测试

> ID：350941
> 
> 赞同：6
> 
> 时间：2008-12-08T21:18:56.707
> 
> 标签：java, multithreading, testng

由于库升级（easymock 2.2 -> 2.4），我们的测试已经开始锁定。我想暂停一下个人测试，所有这些测试。这个想法是识别锁定的测试 - 我们目前正在猜测 - 并修复它们。

这可能吗，最好是在套件范围内？我们有 400 个测试，每个方法甚至每个类都这样做会很耗时。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T21:32:15.557

[套件标签](http://code.google.com/p/testng/source/browse/trunk/src/main/org/testng/xml/XmlSuite.java)可以具有超时属性。此超时将用作所有测试方法的默认值。

这个默认超时可以在每个测试方法的基础上被覆盖。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T21:47:32.123

如果套件级别被证明是错误的方法（即“网络太宽”，因为您最终标记了太多带有超时限制的方法），您需要定义一个自定义[IAnnotationTransformer](http://testng.org/doc/documentation-main.html#annotationtransformers) ，对于每个难以辨认的函数，它将给出您有机会修改 @Test 注释（例如使用[setTimout() 方法](http://code.google.com/p/testng/source/browse/trunk/src/main/org/testng/annotations/ITestAnnotation.java)）。
（`setTimout(0)`取消超时指令）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-09-30T03:03:06.667

很晚了，但是：运行`jstack -l <PID>`会给你堆栈转储，你可以检查它以找出哪些调用被卡住了。您可能需要采样几次以确保它们被卡住。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-08T21:51:21.930

您可以搜索并用“@Test(timeout=)”替换“@Test”应该可以找到锁定的测试，之后可以撤消。

# database-design - 多列主键？

> ID：350950
> 
> 赞同：7
> 
> 时间：2008-12-08T21:21:00.413
> 
> 标签：database-design

例如，我有 2 个表，`Users`并且`UserRelations`，它是一对多的关系。

对于`UserRelations`表，我可以有一个标识列并将其作为主键：

```
[RelationID] [int] IDENTITY(1,1) NOT NULL,
[UserID] [int] NOT NULL,
[TargetID] [int] NOT NULL, 
```

或者我可以像这样设计表格：

```
[UserID] [int] NOT NULL,
[TargetID] [int] NOT NULL, 
```

并使`UserID`+`TargetID`成为主键。

我的问题是每种设计的含义是什么，哪个对性能更好？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-08T21:28:14.737

如果您使用前一种设计，带有多余的标识列，则没有限制插入具有相同 UserID 和 TargetID 的两行。您必须`UNIQUE`在其他两列上创建一个约束，这无论如何都会创建一个复合索引。

另一方面，一些框架（例如Rails）坚持每个表都有一个代理键`id`，因此“正确”的设计可能无法正常工作。这取决于您编写什么代码来使用这个表格设计。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-08T22:33:37.803

这几乎是一个宗教问题。对于每个说使用非智能代理键的人，其他人指出代理键可以被认为是多余的，等等等等。所以做任何对你和你的团队来说最舒服的事情。

如果您决定使用代理键，您还应该对自然键（在本例中为多列）设置唯一约束，以保持数据的完整性。

我通常会选择一个额外的代理键，因为自然键有时缺少许多理想的（不一定是必需的）主键特征：

*   唯一值：主键必须唯一标识表中的每一行。
*   非智能：主键最好没有嵌入的语义含义。换句话说，它不应该描述实体的特征。客户 ID **12345**通常比**RoadWarrior**更受欢迎。
*   不随时间变化：主键的值通常不应该改变。更改主键值意味着您正在更改实体的身份，这通常没有意义。我更喜欢非智能键，因为它们不太可能改变。
*   单一属性：主键应具有尽可能少的属性。单属性主键是可取的，因为它们更易于应用程序使用，并且它们简化了外键的实现。
*   数字：当它们是数字时，管理唯一值通常更容易。大多数数据库系统具有启用自动递增主键属性的内部例程。

从性能的角度来看，我怀疑在大多数情况下差别不大。但与任何性能问题一样，您应该衡量您担心的地方。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-08T21:39:10.473

据我了解（实际上，在实践中它是有道理的），主键标识一些唯一数据......至少在规范化表中。如果表中的数据需要由键更明确地标识，则应使用复合主键（其中包含多个列的主键）。

例如，在存储当前和过去约会的表格中，客户可以多次出现在表格中，您可以设置如下表格：

AppointmentDate、CustomerID、AppointmentReason

其中 AppointmentDate 和 CustomerID 是复合主键，标识 AppointmentReason 的唯一信息。

我们使用 AppointmentDate 和 CustomerID 作为主复合键，因为多个客户可以在同一天同时进行约会。如果我们只是使用 AppointmentDate 作为主键，我们可能会遇到主键唯一性约束的问题。

对于您的情况，了解有关将包含哪种数据的更多信息会有所帮助，但我可以将 UserID 和 TargetID 作为复合主键，如果 TargetID 出现在 UserRelations 表中，则将其作为外键桌子。我会这样做是因为如果您有一个名为 RelationID 的主键，您最终会得到一个重复的 User 列，这可能会对性能产生不利影响，并且根本不会使您的表标准化。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-08T21:38:15.480

您“应该”始终尝试在每个表上建立“有意义的”或“自然的”主键或唯一索引，以帮助维护数据的完整性。当这意味着多列（或“复合”键）时，确实会影响性能 - 特别是在其他依赖表中使用与外键相同的多列键时，或在用于查询中的搜索谓词的索引等中使用相同的多列键时.

当这些性能影响变得显着时（甚至可能在它们之前，您应该切换到使用无意义的“代理”键（通常是整数），用于所有这些其他目的（FK、连接、索引、查询搜索谓词, 应用代码实体标识符等）

但始终保留有意义的键或唯一索引，以保持表数据完整性

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-09T13:18:40.903

通过对描述关系的表使用复合主键，就性能而言，我已经获得了很好的结果。声明主键有两种效果：

您会得到要求每个参与列都为非空的约束，并且需要参与列的唯一性，一起考虑。

在给定主键的情况下，您将获得一个索引，该索引可提供对单个行的快速访问。大多数 DBMS 都会为您创建此索引。

该索引的有用程度取决于查询优化器、主键声明中列的顺序以及数据的使用模式。有时，在复合主键中第一个以外的列上通过您自己创建的索引来补充自动索引可能很有用。

通过声明复合主键获得的约束通常比通过创建代理键并声明主键获得的约束更有用。

同样，以上所有内容都与描述实体之间或实体之间关系的表有关。描述实体的表应该有一个简单的主键。最好是自然密钥，但在给定数据不提供可靠密钥的情况下，可能需要代理密钥。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-08T21:33:33.137

主键是索引与唯一性约束的组合。添加 RelationID 列不会帮助您保持唯一性（因为仍然可以插入相同的 UserID+TargetID 对 - 它们只会获得不同的 RelationID）也不会帮助数据访问（因为如果您将在用户之间加入，则需要 UserID 上的索引和用户关系）。所以第二个似乎是更好的解决方案。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-08T22:26:09.737

只是为了搅动锅，您可能需要在这里添加第三列：“关系”。每当我有一个用户：用户关系表时，我都会遇到两个具有多个关系的用户并且需要将它们分开：

```
David Jeff Mentor
David Jeff Sponsor 
```

在某个时候，指导可能会结束，但您仍然需要赞助商链接。虽然现在可能只有一种关系类型，但将来可能会改变。所以你的主键变成了 UserId、TargetId、RelationshipType。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-03-22T08:10:55.880

我将在这里投入我的两分钱，因为我相信在其他没有明确呈现的综合答案中存在完形*。*

1.  由于 Date、Codd 等人设计的用于描述概念模型（即实体、属性、关系、键）的术语已被供应商用来描述该模型的物理实现的属性（表、列），因此出现了混淆、记录、索引）。在我们讨论这个问题时，理解这两个域保持独立和可识别是至关重要的。
2.  第一范式表明每个**关系**在**概念模型**中都有一个**主键**。仅存在于物理模型中的*人工密钥*不符合条件；但请注意，一些所谓的人工钥匙不在物理模型中，而实际上在概念模型中。（这方面的一个例子是美国和加拿大的 SSN/SIN，因为没有它，概念模型中的唯一性就无法保证。）下面将详细介绍这一点，但为了避免混淆，我以后将概念模型中的主键称为自然**键**。（多个候选者将是候选自然键。）
******   当前 RDBMS 实现中的*主键约束有多种用途。*一种是对*物理记录*施加唯一性约束，以允许不属于此（物理）主键约束的所有字段就地更新；当自然键的字段可能随时间变化时，因此必须确保没有这样的字段成为物理模型中主键约束的一部分。*   *Primary Key Constraint*的另一个用途是启用从相关表中的外键查找，这最终通过最窄的*Primary Key Constraint*来最有效地解决。为此，自然键对*主键约束*做出了糟糕的选择，因为它们通常太宽（人类可理解）而无法获得最佳索引大小和高度。*   From this I infer a corollary: that the most efficient translation to the Physical Model of a Natural Key from the Conceptual Model is usually a Uniqueness Constraint combined with a distinct and disjoint artificial Primary Key Constraint. Note that in cases (such as SSN/SIN) where the Natural Key is required to have an artificial component, it is desired to have an additional artificial Primary Key Constraint that resides wholly in the Physical Model; this because it is necessary to allow for the externally-visible artifical number to be changed and/or re-assigned. (How many knew that US SSN's are re-used some months after death?)*****

 ****** * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-08T21:25:58.783

假设您正在使用 UserRelations 表在用户和目标之间建立多对多关系，那么第一个是不正确的。您希望 UserID+TargetID 是唯一的，否则您最终可能会有多个冗余条目加入同一个用户和目标。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-08T21:28:14.143

关联用户的适当方法 -> 目标是您拥有的第二个选项，因为这是实际强制查找表的引用完整性的方法。

如果没有主键，或者在 UserId 和 TargetId 列中没有唯一性，则可能会有重复的条目，这很可能会导致意外结果。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-08T22:38:49.073

特别针对您的问题：无论如何，您都需要自然多列上的唯一键。是否将其设为主要取决于您。

添加代理键是一个样式问题，并且通常是某些框架所要求的。如果你添加它，在大多数情况下让它成为主要的，只是因为这是框架所期望的。从功能上讲，只要两者都是唯一的，否则就没有区别。

# c# - 单元测试期间的 C# 扩展方法异常

> ID：350951
> 
> 赞同：4
> 
> 时间：2008-12-08T21:21:24.797
> 
> 标签：c#, .net, unit-testing, exception, extension-methods

使用 Visual Studio 2008 / C# / VS 单元测试。

我有一个非常简单的扩展方法，它会告诉我对象是否属于特定类型：

```
public static bool IsTypeOf<T, O>(this T item, O other)
{
    if (!(item.GetType() is O))
        return false;
    else
        return true;
} 
```

它会被称为：

```
Hashtable myHash = new Hashtable();
bool out = myHash.IsTypeOf(typeof(Hashtable)); 
```

当我在调试模式下运行代码或调试单元测试时，该方法工作得很好。然而，在我刚刚在上下文中运行所有单元测试的那一刻，我神秘地得到了这个方法的 MissingMethodException。奇怪的是，同一个类中的另一个扩展方法没有问题。

我倾向于问题不是扩展方法本身。我试过删除临时文件，关闭/重新打开/清理/重建解决方案等。到目前为止，没有任何效果。

有没有人在任何地方遇到过这种情况？

*编辑：这是代码的简化示例。基本上，这是我能够在没有周围代码包袱的情况下创建的最小的可重现示例。当放入单元测试时，这个单独的方法也会单独抛出 MissingMethodException，就像上面一样。有问题的代码并没有完成手头的任务，就像乔恩提到的那样，它更多的是我目前关注的异常的来源。*

**解决方案：我尝试了许多不同的方法，同意 Marc 将其视为参考问题的思路。删除引用、清理/重建、重新启动 Visual Studio 不起作用。最终，我最终在我的硬盘驱动器中搜索已编译的 DLL，并将其从任何没有意义的地方删除。删除除 TestResults 文件夹中的所有实例后，我就能够成功地重建并重新运行单元测试。**

**至于方法的内容，我是在单元测试中发现问题的，但始终无法让这个概念发挥作用。由于 O 是一个 RunTimeType，我似乎没有太多访问它的权限，并尝试使用 IsAssignableFrom() 来让函数正确返回。目前，此功能已从我的验证方法中删除，以便下次重新访问。但是，在删除它之前，我仍然遇到了用许多其他方法开始这篇文章的原始问题。**

**后解决方案：实际的方法并不像我想象的那么复杂。这是实际的工作方法：**

```
public static void IsTypeOf<T>(this T item, Type type)
{
    if (!(type.IsAssignableFrom(item.GetType())))
        throw new ArgumentException("Invalid object type");
} 
```

**和单元测试来验证它：**

```
[TestMethod]
public void IsTypeOfTest()
{
    Hashtable myTable = new Hashtable();
    myTable.IsTypeOf(typeof(Hashtable));

    try
    {
        myTable.IsTypeOf(typeof(System.String));
        Assert.Fail("Type comparison should fail.");
    }
    catch (ArgumentException)
    { }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T21:47:11.377

通常，这`MissingMethodException`意味着您正在加载与构建期间引用的不同版本的 dll，并且您正在加载的实际 dll（在运行时）没有编译器找到的方法（在编译时） .

检查您是否以某种方式获得了不同项目引用的各种版本的 dll。可能是当您在调试模式下运行它时，其他一些代码会首先加载*正确*的dll，但是在上下文中运行时，其他代码不会运行 - 因此会加载*不正确*的版本。

如果最近添加了失败的方法，这将加倍适用，因此可能不在引用的旧版本中。

如果您使用的是完整的程序集版本控制，您可能能够查看调试输出以准确了解加载了哪些程序集。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T21:29:30.443

我在这里推测。

对方法施加约束，看看是否有帮助 `Pseudocode`

`public static bool IsTypeOf(this T item, O other) Where T: object, O: Type { }`

另外，这个方法在哪个类？

编辑：这个类是正在测试的程序集的一部分吗？

# c# - 在 WinForms 应用程序中禁用重绘

> ID：350956
> 
> 赞同：2
> 
> 时间：2008-12-08T21:23:18.553
> 
> 标签：c#, .net, user-interface, winapi

我正在开发一个 C#.Net 应用程序，其中有一个令人讨厌的错误。主窗口有许多选项卡，每个选项卡上都有一个网格。当从一个选项卡切换到另一个选项卡时，或者在网格中选择不同的行时，它会进行一些后台处理，并且在此期间菜单会在重绘时闪烁（文件、帮助等菜单项以及窗口图标和标题）。

我首先尝试在切换选项卡/行（WM_SETREDRAW 消息）时禁用窗口上的重绘。在一种情况下，它可以完美运行。另一方面，它解决了直接的错误（标题/菜单闪烁），但在禁用重绘和再次启用它之间，窗口对于鼠标点击是“透明的” - 有一个小窗口（<1秒）我可以点击比如说，它会突出显示我桌面上的一个图标，就好像该应用程序根本不存在一样。如果我在后台运行其他东西（比如 Firefox），它实际上会在点击时获得焦点（并绘制浏览器的一部分，比如地址栏。）

这是我添加的代码。

```
m = new Message();
m.HWnd = System.Windows.Forms.Application.OpenForms[0].Handle; //top level
m.WParam = (IntPtr)0; //disable redraw
m.LParam = (IntPtr)0; //unused
m.Msg = 11; //wm_setredraw
WndProc(ref m); 
```

<snip> - 应用程序在此部分中忽略点击（在一种情况下）

```
m = new Message();
m.HWnd = System.Windows.Forms.Application.OpenForms[0].Handle; //top level
m.WParam = (IntPtr)1; //enable
m.LParam = (IntPtr)0; //unused
m.Msg = 11; //wm_setredraw
WndProc(ref m);

System.Windows.Forms.Application.OpenForms[0].Refresh(); 
```

有谁知道a）是否有办法解决这里的透明应用程序问题，或者b）如果我一开始就做错了，这应该以其他方式解决吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T22:08:14.673

`Control`为此目的，对派生的类进行了调用。它们是`SuspendLayout`和`PerformLayout`。当它们打开`Control`并`Form`派生自`Control`时，您`Form`也拥有它们。

这些调用足以满足大多数更新，但在其他情况下，仅使用隐藏控件`Visible = false`就足够了。为了在控件隐藏然后重新显示期间停止闪烁，我通常将控件绘制到我在`PictureBox`更新期间显示的位图中。这在更新树、选项卡控件或列表时很有用（在最后一个示例中可以在更新期间关闭排序）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T01:02:46.957

您所描述的行为对于 .NET winforms 应用程序来说是不正常的。您在示例中使用 WndProc 并发送消息这一事实表明，此表单还有许多其他不寻常的事情（我猜涉及的线程不止一个）。选项卡式界面中常见的另一种可能性是您的表单只是简单地重载了控件。有时这会导致奇怪的行为。

我从来没有目睹或听说过像你描述的那样遥远的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T15:16:29.760

您可以尝试覆盖您不想渲染的控件上的 Paint 方法，并通过某个全局布尔值来控制它（=当某个布尔值为真时忽略所有绘制。）如果您的控件是第 3 方，则将其子类化并在那里覆盖它。

然后当您满意时，将 bool 设置为 false 并让控件再次绘制（当您使用 .Refresh 再次打开它时可能必须强制绘制？）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-12T14:20:01.540

如果这是一个自定义控件，您可以尝试一些[控件样式](http://msdn.microsoft.com/en-us/library/system.windows.forms.controlstyles.aspx)标志：我认为 DoubleBuffered 或 AllPaintingInWmPaint 可能会有所帮助。[您可以使用Control.SetStyle](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.setstyle.aspx)更改样式位（这是受保护的，这就是您需要在自己的自定义 Control 类中执行此操作的原因）。

# sql - 帮助索引

> ID：350961
> 
> 赞同：1
> 
> 时间：2008-12-08T21:24:09.630
> 
> 标签：sql, mysql

好的，我在 mysql 方面不是很好，但我知道索引会在这里帮助我，但是我做了一些插件，但找不到可以帮助的...

有人有什么想法吗？

```
 explain 
select `users_usr`.`id_usr` AS `id_usr`,
`users_usr`.`firstname_usr` AS `firstname_usr`,
`users_usr`.`lastname_usr` AS `lastname_usr`,`users_usr`.`social_usr` AS `social_usr`,`users_usr`.`address1_usr` AS `address1_usr`,
`users_usr`.`address2_usr` AS `address2_usr`,`users_usr`.`city_usr` AS `city_usr`,`users_usr`.`state_usr` AS `state_usr`,`users_usr`.`zip_usr` AS `zip_usr`,
`users_usr`.`email_usr` AS `email_usr`,`credit_acc`.`given_credit_acc` AS `given_credit_acc`,`credit_acc`.`credit_used_acc` AS `credit_used_acc`,
`credit_acc`.`date_established_acc` AS `date_established_acc`,`credit_acc`.`type_acc` AS `type_acc`,`credit_acc`.`bureau_status_acc` AS `bureau_status_acc`,
sum((`credit_balance`.`debit_acc` - `credit_balance`.`credit_acc`)) AS `balance` 

from (((`users_usr` 
left join `credit_acc` on((`users_usr`.`id_usr` = `credit_acc`.`uid_usr`))) 
left join `cfc_cfc` on((`credit_acc`.`id_cfc` = `cfc_cfc`.`id_cfc`))) 
join `credit_acc` `credit_balance` on((`credit_balance`.`credit_used_acc` = `credit_acc`.`id_acc`))) 

where ((`credit_acc`.`type_acc` = _latin1'init') 
and (`credit_acc`.`status_acc` = _latin1'active') 
and (`credit_acc`.`linetype_acc` = _latin1'personal')) 

group by `credit_balance`.`credit_used_acc` order by `users_usr`.`id_usr` 
```

给我

```
id  select_type  table           type    possible_keys                        key              key_len  ref                                  rows  Extra                          
------  -----------  --------------  ------  -----------------------------------  ---------------  -------  ---------------------------------  ------  -------------------------------
     1  SIMPLE       credit_balance  index   credit_used_acc,cash_report_index    credit_used_acc  40       (NULL)                              14959  Using temporary; Using filesort
     1  SIMPLE       credit_acc      eq_ref  PRIMARY,type_acc,type_acc_2,uid_usr  PRIMARY          8        cc.credit_balance.credit_used_acc       1  Using where                    
     1  SIMPLE       cfc_cfc         eq_ref  PRIMARY                              PRIMARY          4        cc.credit_acc.id_cfc                    1  Using index                    
     1  SIMPLE       users_usr       eq_ref  PRIMARY,id_usr                       PRIMARY          4        cc.credit_acc.uid_usr                   1

Table       Non_unique  Key_name           Seq_in_index  Column_name              Collation  Cardinality  Sub_part  Packed  Null    Index_type  Comment
----------  ----------  -----------------  ------------  -----------------------  ---------  -----------  --------  ------  ------  ----------  -------
credit_acc           0  PRIMARY                       1  id_acc                   A                14016    (NULL)  (NULL)          BTREE              
credit_acc           1  type_acc                      1  type_acc                 A                   11    (NULL)  (NULL)  YES     BTREE              
credit_acc           1  type_acc                      2  date_acc                 A                14016    (NULL)  (NULL)  YES     BTREE              
credit_acc           1  type_acc                      3  affiliate_aff            A                14016    (NULL)  (NULL)  YES     BTREE              
credit_acc           1  type_acc_2                    1  type_acc                 A                   11    (NULL)  (NULL)  YES     BTREE              
credit_acc           1  type_acc_2                    2  date_acc                 A                14016    (NULL)  (NULL)  YES     BTREE              
credit_acc           1  type_acc_2                    3  complete_acc             A                14016    (NULL)  (NULL)  YES     BTREE              
credit_acc           1  type_acc_2                    4  commission_refunded_acc  A                14016    (NULL)  (NULL)  YES     BTREE              
credit_acc           1  credit_used_acc               1  credit_used_acc          A                14016    (NULL)  (NULL)  YES     BTREE              
credit_acc           1  credit_used_acc               2  id_acc                   A                14016    (NULL)  (NULL)          BTREE              
credit_acc           1  credit_used_acc               3  type_acc                 A                14016    (NULL)  (NULL)  YES     BTREE              
credit_acc           1  uid_usr                       1  uid_usr                  A                 7008    (NULL)  (NULL)  YES     BTREE              
credit_acc           1  cash_report_index             1  credit_used_acc          A                 7008    (NULL)  (NULL)  YES     BTREE              
credit_acc           1  cash_report_index             2  type_acc                 A                14016    (NULL)  (NULL)  YES     BTREE              
credit_acc           1  cash_report_index             3  date_established_acc     A                14016    (NULL)  (NULL)  YES     BTREE 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-08T21:38:32.797

您的 EXPLAIN 输出显示您已经拥有*可能*有用的索引，但查询引擎已决定不使用它们。

[http://dev.mysql.com/doc/refman/5.0/en/using-explain.html](http://dev.mysql.com/doc/refman/5.0/en/using-explain.html)说：

> **使用临时**
> 
> 为了解析查询，MySQL 需要创建一个临时表来保存结果。如果查询包含以不同方式列出列的 GROUP BY 和 ORDER BY 子句，通常会发生这种情况。

您的查询包括：

```
GROUP BY `credit_balance`.`credit_used_acc` 
ORDER BY `users_usr`.`id_usr` 
```

您在这两个子句中命名不同的列，因此这意味着查询需要一个临时表并在磁盘上对其结果进行排序。磁盘 I/O 是 SQL 性能的大敌。这对性能的不利影响可能比您可以通过应用索引来弥补。

所以我建议尝试删除该`ORDER BY`子句，看看它是否摆脱了“使用临时”评论。

**编辑**好的，我做了更多的测试，并更仔细地查看了你的表定义。

我认为您有很多冗余索引，不适用于当前查询。可能是索引对其他查询有用，或者它们可能只是您实验的剩余物。

一项观察是您的加入`cfc_cfc`是不必要的，但我从您的评论中看到您已将其删除。不过，它似乎并没有修复 EXPLAIN 报告。

另一个观察是你的`LEFT JOIN`是不必要的；这可能是因为无论如何您在这些列的子句中`INNER JOIN`都有条件。`WHERE`将其作为外连接没有任何目的，外连接往往速度较慢。

索引对于您在连接条件、行限制或 GROUP BY 或 ORDER BY 子句中使用的列可能很有用。MySQL 在给定查询中每个表不能使用多个索引，因此定义复合索引是有意义的。但是您应该在查询中使用的列上定义索引。如果只使用三列索引的第 2 列和第 3 列（即不是索引中的第一列），则索引无效。

当然，为所有主键和外键约束隐式创建了索引，但这是我创建的唯一额外索引：

```
KEY columns_used_in_query (uid_usr, type_acc, status_acc, linetype_acc), 
```

如果您将条件放在子句或连接条件中，那么优化计划应该无关紧要`WHERE`，只要它们不是外部连接条件的一部分。但我确实注意到，在所有其他条件相同的情况下，优化器似乎会根据您首先定义的索引来选择索引！

我仍然没有消除 EXPLAIN 报告中的临时表和文件排序注释，但我认为这些更改将加快查询速度。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T21:53:33.970

收回其中的一部分，然后重新开始。

这是我对您的查询的解释。

```
uu.select uu.id_usr,  
uu.firstname_usr,  
uu.lastname_usr,   
uu.social_usr,  
uu.address1_usr,  
uu.address2_usr,  
uu.city_usr,  
uu.state_usr,  
uu.zip_usr,  
uu.email_usr,  
ca.given_credit_acc,  
ca.credit_used_acc,  
ca.date_established_acc,  
ca.type_acc,  
ca.bureau_status_acc,  
sum(cb.debit_acc - cb.credit_acc) AS `balance`   

from users_usr AS uu  

left join credit_acc AS ca on uu.id_usr = ca.uid_usr  

join credit_acc AS cb on ca.credit_used_acc = ca.id_acc  

where ca.type_acc = 'init'   
  and ca.status_acc = 'active'   
  and ca.linetype_acc = 'personal'  

group by cb.credit_used_acc  
order by uu.id_usr 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T22:12:36.800

您的查询（具有连接、位置、组和排序的可优化部分）可以简化为：

```
SELECT  
    uu.select uu.id_usr,    
    ca.given_credit_acc,    
    ca.credit_used_acc,    
    ca.type_acc,    
    sum(cb.debit_acc - cb.credit_acc) AS `balance`     

FROM   
    users_usr AS uu    

LEFT JOIN   
    credit_acc AS ca on uu.id_usr = ca.uid_usr    
    AND ca.type_acc = 'init'  
    AND ca.status_acc = 'active'     
    AND ca.linetype_acc = 'personal'    
    -- credit_acc needs an index on uid_usr + type_acc _ status_acc  

JOIN   
    credit_acc AS cb on ca.credit_used_acc = ca.id_acc    
    -- credit_acc needs an index on credit_used_acc  

GROUP BY cb.credit_used_acc    
ORDER BY uu.id_usr 
```

请注意，我将 WHERE 子句移到了 JOIN 中——MySQL 似乎喜欢这种调整。

注意关于索引的注释。看看您是否可以使这种简化工作（和优化），然后添加回其他字段。

你怎么看，比尔？

# netbeans - 如何使用 xdebug 使 NetBeans 不会停在第一行？

> ID：350966
> 
> 赞同：24
> 
> 时间：2008-12-08T21:27:42.243
> 
> 标签：netbeans, xdebug, netbeans6.5

我正在使用 NetBeans 6.5 开发 PHP，并且我有 xdebug 设置。有没有办法告诉它不要在每个请求的文件的第一行停止？JIT 模式不会解决这个问题，因为我不希望它在我捕获的每个异常时都停止。

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-12-08T22:19:54.803

我刚刚找到我的答案，你去工具>选项> PHP（部分），有一个“停止在第一行”的复选框

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-22T15:47:26.617

对于 Mac 用户，您可以转到 Netbeans > Preferences... 并在 PHP 部分下找到它

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-12-15T10:50:38.847

工具 -> 选项 -> Php -> 调试 -> 取消选中“在第一行停止” -> 应用 -> 确定。

[![在此处输入图像描述](https://i.stack.imgur.com/ao8CZ.png)](https://i.stack.imgur.com/ao8CZ.png)

[![在此处输入图像描述](https://i.stack.imgur.com/sV8zj.png)](https://i.stack.imgur.com/sV8zj.png)

# windows - 如何使我的程序与 DEP 兼容？

> ID：350977
> 
> 赞同：9
> 
> 时间：2008-12-08T21:30:35.777
> 
> 标签：windows, winforms

我有一个 Windows 窗体 (.net 3.0) 项目，由于 DEP 错误，该项目无法在我客户的 vista 计算机上运行。它在我的 vista 机器上运行，并在虚拟机中的 vista sp1 的干净版本中运行。我无法找到使我的程序 DEP（数据执行保护）兼容的方法。我真的不能对最终用户机器做任何事情，它只需要运行。有什么办法可以摆脱这个最新的 vista 开发噩梦吗？我的程序使用 devexpress 控件、sql express 和 .net 即网络浏览器控件。我已经跳出了ie控制，但无济于事。我有其他程序在同一台机器上使用 devexpress 和 sql express，它们运行正常。我无法在用户的计算机上调试它。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-08T21:59:16.437

DEP 以两种模式之一运行：

1) 硬件 DEP 适用于可以将内存页标记为不可执行的 CPU。这有助于防止某些漏洞，例如缓冲区溢出。

2) 软件 DEP 适用于不支持硬件 DEP 的 CPU。它不会阻止数据页中的代码执行，而是阻止 SEH 覆盖（另一种攻击类型）。

在具有支持它的 CPU 的 Windows XP 上，默认情况下，硬件 DEP 仅对某些 Windows 系统二进制文件启用，也对选择“选择加入”的程序启用。

在具有支持它的 CPU 的 Vista 上，几乎所有进程都默认启用硬件 DEP。这有时会产生问题，通常对于较旧的程序和驱动程序，以及尚未进行任何 Vista 测试的 ISV。

所以我怀疑第一步是发现你是在处理软件还是硬件 DEP。另外，您使用的是 C#/VB 还是托管 C++？您是否使用任何本机代码或组件？如果您的应用程序使用本机组件或使用旧 ATL 框架构建的 ActiveX 控件，那么您的应用程序很可能会因硬件 DEP 而失败。

从 .NET Framework 2.0 SP1 开始，我相信 C# 编译器会发出与 DEP 兼容的托管代码。但是，如果您的应用程序正在生成 DEP 异常，那么您可以尝试清除可执行文件的 IMAGE_DLLCHARACTERISTICS_NX_COMPAT 标志。为此，您可以使用 VC 工具集中的 EDITBIN.EXE，如下所示：

```
editbin.exe /NXCOMPAT:NO <your binary> 
```

如果您使用的是 Visual Studio，则可以将构建后步骤添加到可执行文件的项目中。您需要设置环境，以便可以解决 EDITBIN 的依赖关系。当我使用本机代码作为我的应用程序的一部分时，构建后步骤如下所示：

```
call $(DevEnvDir)..\tools\vsvars32.bat
editbin.exe /NXCOMPAT:NO $(TargetPath) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-08T21:49:48.517

旧版本的 ATL 不支持 DEP，因此如果您使用任何使用 ATL 构建的 ActiveX 控件，并且是基于该版本的 ATL（我认为是 7.1 及以下版本）构建的，您将收到 DEP 错误。

作为最后的手段，您实际上可以通过调用 API 函数来禁用进程的 DEP `SetProcessDEPPolicy`：.

[有关SetProcessDEPPolicy](http://blogs.msdn.com/michael_howard/archive/2008/01/29/new-nx-apis-added-to-windows-vista-sp1-windows-xp-sp3-and-windows-server-2008.aspx)的更多信息

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-08T22:01:05.857

.NET 2.0 SP1 附带的编译器打开可执行文件头中的 NXCOMPAT 标志。您可以通过运行带有 /NXCOMPAT:NO 选项的 EditBin.exe 在 Post Build 步骤中关闭该标志。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-07-10T22:36:55.800

FWIW，值得明确指出的是，在许多情况下，应用程序并非“与 DEP 不兼容”，而是无论如何都将崩溃，而 DEP 则“介入以挽救局面”。很多时候，一旦你禁用了 DEP，你会发现你遇到了一个“普通”的 AV。

如果您的项目完全是用 .NET 3.0 编写的，几乎可以肯定是这种情况，因为 .NET 不会做任何触发 DEP 的“疯狂”事情（例如函数重击等）。

要进行调试，请安装调试器或启用 Watson 生成 .DMP 文件，然后将该 .DMP 文件带到开发人员的机器上并找出问题所在。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T21:45:46.090

首先尝试找出您的程序在哪里以及如何失败。你能在你的系统上复制这个问题吗？为系统上的应用程序启用 DEP？当您可以复制问题并获得错误（访问冲突）时，您可以寻求修复您的程序。

有关 DEP 的信息，请参阅[MSDN 文章](http://msdn.microsoft.com/en-us/library/aa366553.aspx)。

# java - 在 Java 中从 GUI 切换到命令提示符？

> ID：350978
> 
> 赞同：-1
> 
> 时间：2008-12-08T21:30:54.950
> 
> 标签：java, user-interface, cmd

我的教授分配了一个通过 GUI 运行模拟的项目。要对其进行编辑，我们需要创建一个“新建”菜单项。我们还没有学会如何从 GUI 中获取数据，而且我们的书根本没有涉及它。

我想要做的是，当点击“新建”命令时，焦点会转移回 CMD 提示符，即 System.out 所在的位置。再次开始工作并提示用户输入。

但是，当我尝试实现这一点时，我的程序崩溃了。我能做些什么来解决这个问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-08T21:37:12.487

System.out 是否在终端（非 Java）窗口中？如果是这样，我认为这将比您想象的要困难得多。

我很想将 System.in / System.out 重定向到 GUI 上的 JTextPane （这样，改变焦点等会容易得多。我认为你需要尝试解释你在做什么你的问题好一点，当你的程序崩溃时可能会发布一个堆栈跟踪。

无论如何，要在单击“新”菜单项时执行某些操作，您需要执行以下操作：

```
menuItem.addActionListener(new ActionListener() {
   public void actionPerformed(ActionEvent e) {
       // Code here to be performed when the item is clicked
   }
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T21:46:49.520

看起来您并没有保留对新创建的 GUI 的引用。据我记得，如果没有对 FoxGui 对象的引用，Java 将垃圾收集该对象（以及任何其他对象）。尝试创建一个全局变量来存储对新创建的 FoxGui 对象的引用。就像是...

```
FoxGui MyGUIRef;
public void actionPerformed(ActionEvent event) 
{ 
    System.out.println("Item: " + event.getActionCommand());

    // File Menu Controls
   if (event.getActionCommand().equals("New"))
   {
       MyGUIRef = runNew();
   }
}

//Now returns a reference to FoxGui
private FoxGui runNew()
{
     return new FoxGui(....)
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T22:00:35.717

你知道吗？我找到了一个真正简单的解决方案，JOptionPane。我只需要找到一个很好的例子。它会很好地满足我的需求。感谢所有的帮助。我会检查所有帮助过的人。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-09-15T11:36:12.060

我知道这是很晚的答案，但在任何地方......

只有一种方法可以完全按照您的意愿行事。

1.  首先你需要记住通过 java -jar jarname.jar 从 CMD 运行你的项目
2.  捕捉点击动作并执行 system.in

信息：

这是唯一的解决方案，因为 GUI 从不将焦点放在 CMD 上，但如果 GUI 从 CMD 运行，您可以轻松使用 System.in。

问候，格雷格

# automated-tests - 代码覆盖率通用函数/参数？

> ID：350981
> 
> 赞同：1
> 
> 时间：2008-12-08T21:31:16.557
> 
> 标签：automated-tests, code-coverage, generics

我正在为我的应用程序处理一些代码覆盖率。现在，我知道代码覆盖率是一项与您创建的测试类型和您希望为其进行代码覆盖率的语言相关联的活动。

我的问题是：有没有可能的方法来做一些通用代码覆盖？就像在中一样，我们是否可以拥有一组功能/测试用例，可以运行（以及针对被测应用程序的更具体的测试）以获得 10% 或更多代码的代码覆盖率？

更像是，如果我想为代码覆盖构建一个框架，那么制作通用框架的最佳方法是什么？是否有可能使某些功能自动化或通用化？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T22:23:23.753

我不确定通用覆盖工具是否是圣杯，原因如下：

1.  覆盖不是目标，而是工具。它告诉你代码的哪些部分没有被测试完全命中。它没有说明测试有多好。
2.  生成的测试无法猜测代码的语义。为您生成测试的框架只能从阅读您的代码中推断出意义，这本质上可能是错误的，因为单元测试的重点是查看代码是否真的像您预期的那样表现。
3.  因为自动化框架会产生人为的覆盖，你永远无法判断一段代码是用适当的单元测试测试的，还是由框架表面测试的。我宁愿让未经测试的代码显示为未发现，所以我解决了这个问题。

您可以做的（我已经做过 ;-)）是编写一个通用测试来测试 Java bean。通过反射，您可以根据 Java bean 的 Sun 规范测试 Java bean。断言 equals 和 hashcode 都实现了（或者都没有实现），看到 getter 实际上返回了你用 setter 推入的值，检查所有属性是否都有 getter 和 setter。

例如，您可以对任何实现“可比”的东西执行相同的基本技巧。

这很容易做到，易于维护，并迫使您拥有干净的豆子。至于其余的单元测试，我尝试专注于首先和彻底地测试重要部分。

覆盖范围可能会给人一种虚假的安全感。常识不能自动化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T21:41:19.157

这通常通过将静态代码分析（Coverity、Klockwork 或它们的免费类似物）与动态分析相结合来实现，方法是针对已检测的应用程序（分析器 + 内存检查器）运行测试。不幸的是，这很难自动化测试算法，大多数工具都是一种“记录器”，能够记录流量/密钥/信号 - 取决于域并重放它们（具有最小的更改/替换，如会话 ID/用户/等）

# google-search - 网页需要多长时间才能保存到 Google 缓存中？

> ID：350986
> 
> 赞同：4
> 
> 时间：2008-12-08T21:33:24.930
> 
> 标签：google-search

我听到很多人询问信息在 Google 缓存中保留多长时间。对我来说，这无关紧要（至少在有人诽谤我的名字之前）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T22:19:13.793

这取决于。与静态网站相比，Google 更频繁地访问频繁更改的页面。如果 google 不知道您的网站存在，它如何访问（并缓存）您的网站？

如果您的网站托管在一个新的未知网络地址上，您应该告诉 google 访问您。或者，您可以在整个网络上放置大量指向您网站的链接。

如果您在当前缓存的网站上创建了一篇新文章，谷歌会在一两天内找到。或者可能更快。（但您确实需要指向那篇新文章的链接。）正如我所说：这一切都取决于；）

提示：您可能有权访问站点日志，它会告诉您 googlebot 浏览您的站点的频率！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-08T22:07:06.110

可能没有一个好的答案，或者至少在 Googleplex 之外可能没有一个好的答案。

为了让 Google 抓取和缓存您的页面，通常必须有人链接到您，或者您必须请求他们抓取您的网站。

您可以通过设置[站点地图](http://www.google.com/support/webmasters/bin/answer.py?answer=40318&topic=13450)来影响它访问您网站的频率，但据我所知，Google 不保证它会在任何特定的时间表上抓取您的网站。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-08T22:32:46.103

谷歌缓存一直存在，直到谷歌由于 404 错误、302 位置重定向或特定过期元标题（noindex、nosnippet、noarchive）在下一次抓取时将其删除。也可以手动从谷歌删除链接。

缓存：[http](http://www.google.com/support/webmasters/bin/answer.py?answer=35306&ctx=sibling) ://www.google.com/support/webmasters/bin/answer.py?answer=35306&ctx= sibling 删除：[http ://www.google.com/support/webmasters/bin/answer.py?hl =zh&answer=35301](http://www.google.com/support/webmasters/bin/answer.py?hl=en&answer=35301)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T21:56:44.743

好吧，一个页面永远保存在 Google 缓存中:-)

而且我认为它在被抓取时会保存在谷歌缓存中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T22:21:35.847

您可以做的最好的事情是设置适当的缓存控制 HTTP 标头并希望 Google 关注它们。

# vb.net - 为什么 VB.net 如此冗长？可以减脂吗？

> ID：350991
> 
> 赞同：2
> 
> 时间：2008-12-08T21:34:45.643
> 
> 标签：vb.net, programming-languages

语言会随着成熟而变得更加冗长吗？感觉就像每个新版本的 VB.net 都获得了更多的语法。是否可以像关键字“Dim”那样减少一些脂肪？C# 也感觉自版本 1 以来它的语法越来越多。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-08T21:44:26.063

这就是VB的习语。所有语言都有一个成语，并且有很多用于冗长和拼写的。谢谢你的幸运星，你不是`WRITING IN COBOL`。

C# 是从类 C 语言演变而来的，在 C 传统中，简洁和简洁受到重视，因此大括号，而`&&`不是区分大小写的小写代码。在 VB 习语中，长的不言自明的关键字是好的，简洁的关键字或神秘的符号是不好的，因此，不区分大小写，但倾向于将您的关键字大写。基本上，坚持使用您使用的语言的习语。如果您使用（或必须使用）VB，请习惯冗长 - 这是故意的。`||``int``integer``MustInherit``Dim blah as Integer`

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-08T21:44:44.330

C# 确实获得了更多的语法，但在某种程度上使其*不那么*冗长。

几乎 C# 3.0 中的每个功能都允许您用更少的代码做更多的事情。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-12-08T22:09:57.867

冗长并没有错，事实上它通常是一件非常好的事情。

我假设你有有意义的变量名？描述性方法名称？那么为什么输入'end if'而不是'}'会出现问题。它实际上根本不是问题，如果有的话，C# 的简洁性更像是一个问题，它试图尽可能地适应尽可能少的字符——这意味着它更难阅读，而不是更容易。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-12-08T22:43:18.953

好吧...承认这感觉很尴尬，但我喜欢在 VB.NET 中使用 Dim。是的，它没有服务于任何特定用途，以后无法通过使用“As”来推断……但对我来说，声明语句以 Dim 开头绝对是“打败你的头”。这意味着当有人浏览代码时，他们甚至不必考虑这些语句的含义，即使是一微秒。像 C# 这样的语言有足够明显的声明，但如果你只是浏览它，你可能需要考虑片刻（即使是最短暂的片刻）。

在某些类型的语句的开头有一个特殊的关键字是“非常明显的”。在 VB.NET 中，赋值以“Dim”开头，对方法的调用（可以）以“Call”开头，赋予它们一种 If、For 和其他构造已经具备的“左侧一致性”：你得到了最简单的要点仅通过查看它的开头即可了解该行发生了什么。使用这些几乎可以为您提供相当于左侧列的功能，您可以非常快速地向下浏览并了解某种基本级别上正在发生的事情的要点（“好吧，我们在这里宣布事情......我们是在这里打电话给其他东西......”）。

对某些人来说，这可能看起来不合理甚至愚蠢……但它确实使每个语句的目的足够明确，以至于浏览起来感觉更快（至少对我而言）……尤其是在浏览其他人编写的不熟悉的代码时。

我想，最终归结为“不同的人不同的笔触”。我不介意为了明显的目的而输入额外的三个字符。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-12-08T21:47:23.903

VB.NET 本身就很棒，它使代码更加清晰。

例如，我喜欢你如何描述你的结局。

End while vs } End for vs } End if vs }

实际上，由于智能，打字时冗长不是问题。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-12-08T22:25:04.887

冗长和可读性通常是齐头并进的。最近我开始害怕“优雅”这个词，因为它通常翻译成“有趣但不太容易读懂”

当然，编写代码的人总是说“嗯，它对我来说更具可读性，因为它更短/更优雅。

那是废话。阅读更明确的东西总是更容易，除非你阅读困难，以至于你需要两个小时才能读完一本迪克和简的小说。

请注意，我不是在谈论裁员，只是明确说明您的愿望。

作为一名程序员，编写优雅的表达式要有趣得多，但我发现自己在看别人的“优雅”，一段时间后甚至是自己的“优雅”，我会把它改成更明确、更易读和当我意识到虽然写起来很有趣，但我只是花更多的时间阅读/调试它而不是一开始写它。

另一方面， DIM 只是愚蠢的 :)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-12-09T01:11:24.380

我在这里稍微超出了我的深度。

我喜欢大家所说的冗长。没有人想知道我们在任何自然语言（例如英语）中都没有多个嵌套括号吗？事实上，嵌套括号确实需要缩进的约定才能使其清晰易读。在自然语言中，我们使用冗长的从句和多个句子来避免或至少解释分层括号。

同样在某种意义上，我不会说 vb 的语法比 c# 多得多。在某个代码块中，它实际上并没有比 c# 更多的词法标记（是吗？）。它的语法与 c# 大致相同，只是语法标记更长，例如“End Sub”而不是“}”。对于大多数句法管道，VB 版本只会更多地打字（如果您宣誓放弃智能感知），而且与“End Sub”相比，“}”是模棱两可的，因为它也意味着“End If”和其他东西的全部负载. 这并没有使它在某种意义上更简洁，代码中仍然存在相同数量的标记，但是来自更简短标记标记的较小子集。但是 C# 中不同的标记根据上下文有不同的含义，这要求您在阅读代码时仍然在脑海中记住那个嵌套级别，以便获得，例如，如果您失去位置，您正在阅读什么样的代码块，即使代码块的结尾可能在查看您可能需要查看代码块的开头。即使不是这种情况，&&真的比AndAlso更好吗？

我认为 Dim 相当没用，与 c# 相比是一个额外的词法标记，但我想至少它与 linq 一致，vb 不需要 var 命令。我想不出任何其他候选人。也许我没有想象力。

我敢肯定有人会过来告诉我我错了:) 我最好的猜测是无论如何都与个人喜好有关。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-12-08T22:04:17.253

那么C#应该去掉“;” 在每一条线的尽头:)

默认应该是简单的方法去这样的“新行”而不是“;” 如果您希望在同一行中出现诸如 2 个语句的异常，则需要使用分隔符，例如“：”或“；”

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-08T21:39:00.707

有些人喜欢这样。我怀疑像 Dim 这样的东西是出于遗留原因而留下的。

VB 确实有一些不错的捷径。例如转换例程。例如 CInt、CStr 等

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-04-02T20:57:42.443

好的，我是一个通过 C# 来到 .Net 的老 C 程序员，现在我在 VB.Net 中工作我不得不说，起初我对冗长感到震惊，但我又回到了 C#，我不得不承认我现在更喜欢 VB.Net。

我可以编写可读性更好且不那么神秘的 VB 代码，并且它确实不会占用更多空间（尤其是如果您将所有 C# 花括号放在自己的行上）而且 Visual Studio 中的编辑器会处理大部分对我来说冗长。

我喜欢`Dim X As List(Of SomeType)`阅读方式，而不是`List<sometype> X`

分号现在很麻烦。花括号很烦人。
我确实有点想念数组引用的方括号。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-08T22:00:37.480

自从我看到这个...

[小写关键字？](http://www.panopticoncentral.net/archive/2007/07/20/21212.aspx)

...我一直希望它会被包含在语言中。令人惊讶的是，如果没有所有大写关键字，它的可读性会更高。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-02-28T08:28:31.883

C# 不是一种用户友好的语言，需要多行代码才能完成与 VB.Net 相同的任务。C# 不支持可选参数，with/end with 等。甚至 db 连接在 C# 中也需要更多代码。不过，《星球大战》的粉丝们喜欢 C#，因为你在编程时可以像尤达一样说话。

我的 0.02 美元：VB.Net 的智能感知功能、快捷方式、逻辑可读性等使其成为一种优越的语言。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-08T21:47:50.953

是的，我知道你的意思，它可能有点啰嗦，我发现它变得难以阅读，因为有太多的关键字并且很难看到它背后的逻辑，但是有些人喜欢它。

我最近才开始用 C# 编写我所有的东西，我必须说我越来越喜欢它，因为我刚刚切掉了 VB 并从现在开始说正确的 C#，所以如果你担心你可以随时切换。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-08T22:20:32.777

我不喜欢 VB 的一件事是

```
print("ByVal sender as object, ByVal e as EventArgs"); 
```

与 C#

```
object sender, Eventargs e 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-08T23:12:14.263

使用预处理器......并失去任何被其他人（或您自己在几年内，也许......）阅读的希望。

我会回答那些抱怨 Lua 冗长的人经常会回答的问题：如果你想要一种简洁的语言，你知道在哪里可以找到它。周围有很多语言，即使您将自己限制在 CLR 中，为什么要抱怨您选择的语言呢？（我知道，你可能会从事一个你没有开始的项目，等等）。

那不是火焰什么的。有许多语言是有原因的。有些人喜欢它们超级简洁、接近数学符号，而另一些人则喜欢它们（或多或少）冗长，发现它们更具可读性。有各种口味的语言！

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-12-08T21:37:50.053

这样做只会使您的代码更难阅读。

# asp.net - 为什么这段代码会停止？VB ASP.NET

> ID：350993
> 
> 赞同：1
> 
> 时间：2008-12-08T21:36:13.067
> 
> 标签：asp.net, vb.net, code-behind

嘿，我正在使用 Visual Studio 2003 进行编码。我的程序运行良好，直到我引入了一个使用 CreateObject 制作的 dll。代码：

```
Set docs2 = server.CreateObject("DocGetter.Form1")
docs2.GetDocument oXMLDom,numID 
```

它似乎被困在这段代码中。我已经使用 regasm 注册了 dll。还有什么可能是错的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T22:40:54.527

在项目中添加对 dll 的引用并像这样实例化对象：

```
Dim docs2 As New DocGetter.Form1() 
```

如果这没有意义，那么就修复它。没有充分的理由在 .Net 代码中使用 CreateObject。（好吧，这有点夸张。但校长是合理的）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T01:04:07.127

我敢打赌，这个函数不是用这个名称和/或参数定义的。

```
docs2.GetDocument oXMLDom,numID 
```

但是由于您实例化对象的方式，编译器无法知道这一点……我想。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T22:04:23.043

你能澄清一下 - 这是一个网络应用程序还是一个客户端（winform）应用程序？Form1 听起来像一个winform。ASP.NET 在服务器上运行，因此显示表单是不合适的——它会发生在服务器上，而不是客户端。简而言之，不要这样做！

我也看不到“存储过程”的位置，所以我删除了标签。

你想做什么？在客户端显示更复杂的内容的选项包括：

*   dhtml
*   闪光
*   银光
*   clickonce [需要 windows 客户端]
*   ocx [不推荐]

# emacs - 如何更改 Emacs 中的滚动条颜色？

> ID：350995
> 
> 赞同：3
> 
> 时间：2008-12-08T21:36:40.710
> 
> 标签：emacs, customization

是否可以更改emacs中的滚动条颜色？（注意：不是 XEmacs）

如果重要的话，我在 Ubuntu 8.10 上运行 emacs 22。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T22:04:34.010

在什么环境下？例如，在 Carbon EMACS 中，滚动条小部件来自 carbon 原生集合；如果是这样，你不能真正改变颜色。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-16T15:52:24.180

[有关ScrollBars](http://www.emacswiki.org/emacs/ScrollBar)的信息，请参阅 Emacs Wiki 站点

从网站引用：

> GnuEmacs 可以绘制自己的“本机”滚动条，这些滚动条非常可定制。在我看来，这也为 ColorTheme 的用户提供了最好的结果。详情如下：
> 
> 使用传递给 ./configure 的以下选项构建 GnuEmacs：
> 
> ```
>  --without-toolkit-scroll-bars --with-x-toolkit=no 
> ```
> 
> 然后尝试 ColorTheme，或者：
> 
> ```
> M-x customize-face RET scroll-bar RET 
> ```
> 
> 您可以设置前景/背景颜色、边框颜色/宽度等。有一个单独的变量称为滚动条宽度。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T21:51:46.750

无耻地取自[XEmacs 的常见问题解答](http://www.xemacs.neoscientists.org/Documentation/21.5/html/xemacs-faq_5.html)

以下是如何使用资源更改滚动条颜色的回顾：

```
! Motif scrollbars

Emacs*XmScrollBar.Background: skyblue
Emacs*XmScrollBar.troughColor: lightgray

! Athena scrollbars

Emacs*Scrollbar.Foreground: skyblue
Emacs*Scrollbar.Background: lightgray 
```

请注意 Athena 小部件的 Scrollbar 的大小写。************`****************